Released PSU*4*22 SEQ #20
Extracted from mail message
**KIDS**:PSU*4.0*22^

**INSTALL NAME**
PSU*4.0*22
"BLD",10709,0)
PSU*4.0*22^PHARMACY BENEFITS MANAGEMENT^0^3170822^y
"BLD",10709,1,0)
^^76^76^3170822^
"BLD",10709,1,1,0)
This patch will resolve the following issues.
"BLD",10709,1,2,0)
 
"BLD",10709,1,3,0)
1. R15508923FY17 - PBM IV Total Cost column incorrect
"BLD",10709,1,4,0)
 
"BLD",10709,1,5,0)
  
"BLD",10709,1,6,0)
Defect Tracking System Ticket(s) & Overview:
"BLD",10709,1,7,0)
--------------------------------------------
"BLD",10709,1,8,0)
 
"BLD",10709,1,9,0)
1. R15508923FY17 - PBM IV Total Cost column incorrect 
"BLD",10709,1,10,0)
  
"BLD",10709,1,11,0)
Problem: 
"BLD",10709,1,12,0)
--------
"BLD",10709,1,13,0)
The PBMAMIS reports generated by the Manual Pharmacy Statistics [PSU PBM
"BLD",10709,1,14,0)
MANUAL] option sometimes will calculate the Total Cost column incorrectly.
"BLD",10709,1,15,0)
There is a specific situation where the cost from an IV order of one type can
"BLD",10709,1,16,0)
be added to the cost of a different IV type. Below you can see all the all
"BLD",10709,1,17,0)
the reports generated by the that are affected by this issue:
"BLD",10709,1,18,0)
  
"BLD",10709,1,19,0)
IV AMIS Summary for MMM DD,YYYY through MMM DD,YYYY for DIVISION NAME
"BLD",10709,1,20,0)
 
"BLD",10709,1,21,0)
                    LVPs    LVPs   LVPs   LVPs  LVPs       Total    NET LVPs
"BLD",10709,1,22,0)
Division            DISP    RET    DES    CAN   DISP       Cost     DISP
"BLD",10709,1,23,0)
-----------------------------------------------------------------------------
"BLD",10709,1,24,0)
DIVISION NAME        999    999    999    999    999 $    999.99 $   999.99
"BLD",10709,1,25,0)
-----------------------------------------------------------------------------
"BLD",10709,1,26,0)
Total                999    999    999    999    999 $    999.99 $   999.99
"BLD",10709,1,27,0)
 
"BLD",10709,1,28,0)
 
"BLD",10709,1,29,0)
                                                NET               Cost/
"BLD",10709,1,30,0)
                    IVPBs   IVPBs  IVPBs  IVPBs IVPBs    Total    NET IVPBs
"BLD",10709,1,31,0)
Division            DISP    RET    DES    CAN   DISP     Cost     DISP
"BLD",10709,1,32,0)
-----------------------------------------------------------------------------
"BLD",10709,1,33,0)
DIVISION NAME        999    999    999    999    999 $    999.99 $   999.99
"BLD",10709,1,34,0)
-----------------------------------------------------------------------------
"BLD",10709,1,35,0)
Total                999    999    999    999    999 $    999.99 $   999.99
"BLD",10709,1,36,0)
 
"BLD",10709,1,37,0)
  
"BLD",10709,1,38,0)
                                                NET               Cost/
"BLD",10709,1,39,0)
                   TPNs    TPNs    TPNs   TPNs  TPNs     Total    NET TPNs
"BLD",10709,1,40,0)
Division           DISP    RET     DES    CAN   DISP     Cost     DISP
"BLD",10709,1,41,0)
-----------------------------------------------------------------------------
"BLD",10709,1,42,0)
DIVISION NAME        999    999    999    999    999 $    999.99 $   999.99
"BLD",10709,1,43,0)
-----------------------------------------------------------------------------
"BLD",10709,1,44,0)
Total                999    999    999    999    999 $    999.99 $   999.99
"BLD",10709,1,45,0)
 
"BLD",10709,1,46,0)
 
"BLD",10709,1,47,0)
                                                NET               Cost/
"BLD",10709,1,48,0)
                    CHEMO   CHEMO  CHEMO  CHEMO CHEMO     Total   NET CHEMOs
"BLD",10709,1,49,0)
Division            DISP    RET    DES    CAN   DISP      Cost    DISP
"BLD",10709,1,50,0)
-----------------------------------------------------------------------------
"BLD",10709,1,51,0)
DIVISION NAME        999    999    999    999    999 $    999.99 $   999.99
"BLD",10709,1,52,0)
-----------------------------------------------------------------------------
"BLD",10709,1,53,0)
Total                999    999    999    999    999 $    999.99 $   999.99
"BLD",10709,1,54,0)
 
"BLD",10709,1,55,0)
 
"BLD",10709,1,56,0)
                                                NET               Cost/
"BLD",10709,1,57,0)
                   SYRs    SYRs   SYRs   SYRs   SYRs     Total    NET SYRs
"BLD",10709,1,58,0)
Division           DISP    RET    DES    CAN    DISP     Cost     DISP
"BLD",10709,1,59,0)
-----------------------------------------------------------------------------
"BLD",10709,1,60,0)
DIVISION NAME        999    999    999    999    999 $    999.99 $   999.99
"BLD",10709,1,61,0)
-----------------------------------------------------------------------------
"BLD",10709,1,62,0)
Total                999    999    999    999    999 $    999.99 $   999.99
"BLD",10709,1,63,0)
 
"BLD",10709,1,64,0)
 
"BLD",10709,1,65,0)
The discrepancy happens for patients with an order that has an internal
"BLD",10709,1,66,0)
number that matches the number of a subsequent record of the last IV counted
"BLD",10709,1,67,0)
for the Total Cost, then the cost of that order will get included into the
"BLD",10709,1,68,0)
total even if it is of the different type.
"BLD",10709,1,69,0)
 
"BLD",10709,1,70,0)
 
"BLD",10709,1,71,0)
Resolution:
"BLD",10709,1,72,0)
-----------
"BLD",10709,1,73,0)
Modified the routines PSUV6, PSUV7, PSUV8, PSUV9 and PSUV10 to include the 
"BLD",10709,1,74,0)
patient Social Security Number (SSN) when comparing the order number for
"BLD",10709,1,75,0)
calculating the total for the IV type. This will prevent an order from a
"BLD",10709,1,76,0)
different to be included in the total for the wrong IV type.
"BLD",10709,4,0)
^9.64PA^^
"BLD",10709,6.3)
2
"BLD",10709,"ABPKG")
n
"BLD",10709,"KRN",0)
^9.67PA^779.2^20
"BLD",10709,"KRN",.4,0)
.4
"BLD",10709,"KRN",.401,0)
.401
"BLD",10709,"KRN",.402,0)
.402
"BLD",10709,"KRN",.403,0)
.403
"BLD",10709,"KRN",.5,0)
.5
"BLD",10709,"KRN",.84,0)
.84
"BLD",10709,"KRN",3.6,0)
3.6
"BLD",10709,"KRN",3.8,0)
3.8
"BLD",10709,"KRN",9.2,0)
9.2
"BLD",10709,"KRN",9.8,0)
9.8
"BLD",10709,"KRN",9.8,"NM",0)
^9.68A^5^5
"BLD",10709,"KRN",9.8,"NM",1,0)
PSUV6^^0^B32881706
"BLD",10709,"KRN",9.8,"NM",2,0)
PSUV7^^0^B32744206
"BLD",10709,"KRN",9.8,"NM",3,0)
PSUV8^^0^B33106616
"BLD",10709,"KRN",9.8,"NM",4,0)
PSUV9^^0^B33509589
"BLD",10709,"KRN",9.8,"NM",5,0)
PSUV10^^0^B33361051
"BLD",10709,"KRN",9.8,"NM","B","PSUV10",5)

"BLD",10709,"KRN",9.8,"NM","B","PSUV6",1)

"BLD",10709,"KRN",9.8,"NM","B","PSUV7",2)

"BLD",10709,"KRN",9.8,"NM","B","PSUV8",3)

"BLD",10709,"KRN",9.8,"NM","B","PSUV9",4)

"BLD",10709,"KRN",19,0)
19
"BLD",10709,"KRN",19.1,0)
19.1
"BLD",10709,"KRN",101,0)
101
"BLD",10709,"KRN",409.61,0)
409.61
"BLD",10709,"KRN",771,0)
771
"BLD",10709,"KRN",779.2,0)
779.2
"BLD",10709,"KRN",870,0)
870
"BLD",10709,"KRN",8989.51,0)
8989.51
"BLD",10709,"KRN",8989.52,0)
8989.52
"BLD",10709,"KRN",8994,0)
8994
"BLD",10709,"KRN","B",.4,.4)

"BLD",10709,"KRN","B",.401,.401)

"BLD",10709,"KRN","B",.402,.402)

"BLD",10709,"KRN","B",.403,.403)

"BLD",10709,"KRN","B",.5,.5)

"BLD",10709,"KRN","B",.84,.84)

"BLD",10709,"KRN","B",3.6,3.6)

"BLD",10709,"KRN","B",3.8,3.8)

"BLD",10709,"KRN","B",9.2,9.2)

"BLD",10709,"KRN","B",9.8,9.8)

"BLD",10709,"KRN","B",19,19)

"BLD",10709,"KRN","B",19.1,19.1)

"BLD",10709,"KRN","B",101,101)

"BLD",10709,"KRN","B",409.61,409.61)

"BLD",10709,"KRN","B",771,771)

"BLD",10709,"KRN","B",779.2,779.2)

"BLD",10709,"KRN","B",870,870)

"BLD",10709,"KRN","B",8989.51,8989.51)

"BLD",10709,"KRN","B",8989.52,8989.52)

"BLD",10709,"KRN","B",8994,8994)

"BLD",10709,"QDEF")
^^^^NO^^^^NO^^NO
"BLD",10709,"QUES",0)
^9.62^^
"BLD",10709,"REQB",0)
^9.611^1^1
"BLD",10709,"REQB",1,0)
PSU*4.0*4^2
"BLD",10709,"REQB","B","PSU*4.0*4",1)

"MBREQ")
0
"PKG",541,-1)
1^1
"PKG",541,0)
PHARMACY BENEFITS MANAGEMENT^PSU^PHARMACY BENEFITS MANAGEMENT
"PKG",541,20,0)
^9.402P^^
"PKG",541,22,0)
^9.49I^1^1
"PKG",541,22,1,0)
4.0^3050622^3050826^66481
"PKG",541,22,1,"PAH",1,0)
22^3170822
"PKG",541,22,1,"PAH",1,1,0)
^^76^76^3170822
"PKG",541,22,1,"PAH",1,1,1,0)
This patch will resolve the following issues.
"PKG",541,22,1,"PAH",1,1,2,0)
 
"PKG",541,22,1,"PAH",1,1,3,0)
1. R15508923FY17 - PBM IV Total Cost column incorrect
"PKG",541,22,1,"PAH",1,1,4,0)
 
"PKG",541,22,1,"PAH",1,1,5,0)
  
"PKG",541,22,1,"PAH",1,1,6,0)
Defect Tracking System Ticket(s) & Overview:
"PKG",541,22,1,"PAH",1,1,7,0)
--------------------------------------------
"PKG",541,22,1,"PAH",1,1,8,0)
 
"PKG",541,22,1,"PAH",1,1,9,0)
1. R15508923FY17 - PBM IV Total Cost column incorrect 
"PKG",541,22,1,"PAH",1,1,10,0)
  
"PKG",541,22,1,"PAH",1,1,11,0)
Problem: 
"PKG",541,22,1,"PAH",1,1,12,0)
--------
"PKG",541,22,1,"PAH",1,1,13,0)
The PBMAMIS reports generated by the Manual Pharmacy Statistics [PSU PBM
"PKG",541,22,1,"PAH",1,1,14,0)
MANUAL] option sometimes will calculate the Total Cost column incorrectly.
"PKG",541,22,1,"PAH",1,1,15,0)
There is a specific situation where the cost from an IV order of one type can
"PKG",541,22,1,"PAH",1,1,16,0)
be added to the cost of a different IV type. Below you can see all the all
"PKG",541,22,1,"PAH",1,1,17,0)
the reports generated by the that are affected by this issue:
"PKG",541,22,1,"PAH",1,1,18,0)
  
"PKG",541,22,1,"PAH",1,1,19,0)
IV AMIS Summary for MMM DD,YYYY through MMM DD,YYYY for DIVISION NAME
"PKG",541,22,1,"PAH",1,1,20,0)
 
"PKG",541,22,1,"PAH",1,1,21,0)
                    LVPs    LVPs   LVPs   LVPs  LVPs       Total    NET LVPs
"PKG",541,22,1,"PAH",1,1,22,0)
Division            DISP    RET    DES    CAN   DISP       Cost     DISP
"PKG",541,22,1,"PAH",1,1,23,0)
-----------------------------------------------------------------------------
"PKG",541,22,1,"PAH",1,1,24,0)
DIVISION NAME        999    999    999    999    999 $    999.99 $   999.99
"PKG",541,22,1,"PAH",1,1,25,0)
-----------------------------------------------------------------------------
"PKG",541,22,1,"PAH",1,1,26,0)
Total                999    999    999    999    999 $    999.99 $   999.99
"PKG",541,22,1,"PAH",1,1,27,0)
 
"PKG",541,22,1,"PAH",1,1,28,0)
 
"PKG",541,22,1,"PAH",1,1,29,0)
                                                NET               Cost/
"PKG",541,22,1,"PAH",1,1,30,0)
                    IVPBs   IVPBs  IVPBs  IVPBs IVPBs    Total    NET IVPBs
"PKG",541,22,1,"PAH",1,1,31,0)
Division            DISP    RET    DES    CAN   DISP     Cost     DISP
"PKG",541,22,1,"PAH",1,1,32,0)
-----------------------------------------------------------------------------
"PKG",541,22,1,"PAH",1,1,33,0)
DIVISION NAME        999    999    999    999    999 $    999.99 $   999.99
"PKG",541,22,1,"PAH",1,1,34,0)
-----------------------------------------------------------------------------
"PKG",541,22,1,"PAH",1,1,35,0)
Total                999    999    999    999    999 $    999.99 $   999.99
"PKG",541,22,1,"PAH",1,1,36,0)
 
"PKG",541,22,1,"PAH",1,1,37,0)
  
"PKG",541,22,1,"PAH",1,1,38,0)
                                                NET               Cost/
"PKG",541,22,1,"PAH",1,1,39,0)
                   TPNs    TPNs    TPNs   TPNs  TPNs     Total    NET TPNs
"PKG",541,22,1,"PAH",1,1,40,0)
Division           DISP    RET     DES    CAN   DISP     Cost     DISP
"PKG",541,22,1,"PAH",1,1,41,0)
-----------------------------------------------------------------------------
"PKG",541,22,1,"PAH",1,1,42,0)
DIVISION NAME        999    999    999    999    999 $    999.99 $   999.99
"PKG",541,22,1,"PAH",1,1,43,0)
-----------------------------------------------------------------------------
"PKG",541,22,1,"PAH",1,1,44,0)
Total                999    999    999    999    999 $    999.99 $   999.99
"PKG",541,22,1,"PAH",1,1,45,0)
 
"PKG",541,22,1,"PAH",1,1,46,0)
 
"PKG",541,22,1,"PAH",1,1,47,0)
                                                NET               Cost/
"PKG",541,22,1,"PAH",1,1,48,0)
                    CHEMO   CHEMO  CHEMO  CHEMO CHEMO     Total   NET CHEMOs
"PKG",541,22,1,"PAH",1,1,49,0)
Division            DISP    RET    DES    CAN   DISP      Cost    DISP
"PKG",541,22,1,"PAH",1,1,50,0)
-----------------------------------------------------------------------------
"PKG",541,22,1,"PAH",1,1,51,0)
DIVISION NAME        999    999    999    999    999 $    999.99 $   999.99
"PKG",541,22,1,"PAH",1,1,52,0)
-----------------------------------------------------------------------------
"PKG",541,22,1,"PAH",1,1,53,0)
Total                999    999    999    999    999 $    999.99 $   999.99
"PKG",541,22,1,"PAH",1,1,54,0)
 
"PKG",541,22,1,"PAH",1,1,55,0)
 
"PKG",541,22,1,"PAH",1,1,56,0)
                                                NET               Cost/
"PKG",541,22,1,"PAH",1,1,57,0)
                   SYRs    SYRs   SYRs   SYRs   SYRs     Total    NET SYRs
"PKG",541,22,1,"PAH",1,1,58,0)
Division           DISP    RET    DES    CAN    DISP     Cost     DISP
"PKG",541,22,1,"PAH",1,1,59,0)
-----------------------------------------------------------------------------
"PKG",541,22,1,"PAH",1,1,60,0)
DIVISION NAME        999    999    999    999    999 $    999.99 $   999.99
"PKG",541,22,1,"PAH",1,1,61,0)
-----------------------------------------------------------------------------
"PKG",541,22,1,"PAH",1,1,62,0)
Total                999    999    999    999    999 $    999.99 $   999.99
"PKG",541,22,1,"PAH",1,1,63,0)
 
"PKG",541,22,1,"PAH",1,1,64,0)
 
"PKG",541,22,1,"PAH",1,1,65,0)
The discrepancy happens for patients with an order that has an internal
"PKG",541,22,1,"PAH",1,1,66,0)
number that matches the number of a subsequent record of the last IV counted
"PKG",541,22,1,"PAH",1,1,67,0)
for the Total Cost, then the cost of that order will get included into the
"PKG",541,22,1,"PAH",1,1,68,0)
total even if it is of the different type.
"PKG",541,22,1,"PAH",1,1,69,0)
 
"PKG",541,22,1,"PAH",1,1,70,0)
 
"PKG",541,22,1,"PAH",1,1,71,0)
Resolution:
"PKG",541,22,1,"PAH",1,1,72,0)
-----------
"PKG",541,22,1,"PAH",1,1,73,0)
Modified the routines PSUV6, PSUV7, PSUV8, PSUV9 and PSUV10 to include the 
"PKG",541,22,1,"PAH",1,1,74,0)
patient Social Security Number (SSN) when comparing the order number for
"PKG",541,22,1,"PAH",1,1,75,0)
calculating the total for the IV type. This will prevent an order from a
"PKG",541,22,1,"PAH",1,1,76,0)
different to be included in the total for the wrong IV type.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
5
"RTN","PSUV10")
0^5^B33361051^B34787468
"RTN","PSUV10",1,0)
PSUV10 ;BIR/DAM - IV SYRINGE AMIS Summary Data ;11 March 2004
"RTN","PSUV10",2,0)
 ;;4.0;PHARMACY BENEFITS MANAGEMENT;**4,22**;MARCH, 2005;Build 2
"RTN","PSUV10",3,0)
 ;
"RTN","PSUV10",4,0)
 ;This routine gathers IV SYRINGE AMIS summary data
"RTN","PSUV10",5,0)
 ;No DBIA's needed
"RTN","PSUV10",6,0)
 ;
"RTN","PSUV10",7,0)
EN ;Entry point to gather AMIS data.  Called from PSUV3
"RTN","PSUV10",8,0)
 ;
"RTN","PSUV10",9,0)
 K PSUIVA      ;Array to hold temporary data
"RTN","PSUV10",10,0)
 ;
"RTN","PSUV10",11,0)
 ;Initialize variables for column totals
"RTN","PSUV10",12,0)
 ;
"RTN","PSUV10",13,0)
 S (PSUDIV,PSUCT)=0
"RTN","PSUV10",14,0)
 F  S PSUDIV=$O(^XTMP(PSUIVSUB,"RECORDS",PSUDIV)) Q:PSUDIV=""  D EN1
"RTN","PSUV10",15,0)
 Q
"RTN","PSUV10",16,0)
 ;
"RTN","PSUV10",17,0)
EN1 ;EN CONTINUED
"RTN","PSUV10",18,0)
 ;
"RTN","PSUV10",19,0)
 S PSUOR=""
"RTN","PSUV10",20,0)
 N LDSP,LREC,LDES,CLAN,NDSP,LTOT,CNDSP
"RTN","PSUV10",21,0)
 F  S PSUCT=$O(^XTMP(PSUIVSUB,"RECORDS",PSUDIV,PSUCT)) Q:PSUCT=""  D
"RTN","PSUV10",22,0)
 .K PSUAMIS
"RTN","PSUV10",23,0)
 .M PSUAMIS(PSUDIV,PSUCT)=^XTMP(PSUIVSUB,"RECORDS",PSUDIV,PSUCT)
"RTN","PSUV10",24,0)
 .;
"RTN","PSUV10",25,0)
 .S PSUP=$P($G(PSUAMIS(PSUDIV,PSUCT)),U,5)      ;parent record
"RTN","PSUV10",26,0)
 .;
"RTN","PSUV10",27,0)
 .S PSUTYP=$P($G(PSUAMIS(PSUDIV,PSUCT)),U,6)    ;IV TYPE
"RTN","PSUV10",28,0)
 .;
"RTN","PSUV10",29,0)
 .I PSUTYP="S" S PSUOR=$P($G(PSUAMIS(PSUDIV,PSUCT)),U,4)_"^"_$P($G(PSUAMIS(PSUDIV,PSUCT)),U,8) ;IV order #^Patient SSN
"RTN","PSUV10",30,0)
 .;
"RTN","PSUV10",31,0)
 .D LVPDSP
"RTN","PSUV10",32,0)
 .D LVPREC
"RTN","PSUV10",33,0)
 .D LVPDES
"RTN","PSUV10",34,0)
 .D LVPCAN
"RTN","PSUV10",35,0)
 .D LVPNET
"RTN","PSUV10",36,0)
 .D LVPTOT
"RTN","PSUV10",37,0)
 .D CNET
"RTN","PSUV10",38,0)
 .D REC
"RTN","PSUV10",39,0)
 D TOTAL
"RTN","PSUV10",40,0)
 ;
"RTN","PSUV10",41,0)
 Q
"RTN","PSUV10",42,0)
 ;
"RTN","PSUV10",43,0)
LVPDSP ;Gather SYR Dispensed data
"RTN","PSUV10",44,0)
 ;
"RTN","PSUV10",45,0)
 I PSUTYP="S",PSUP="P" D                         ;SYRs Dispensed
"RTN","PSUV10",46,0)
 .N DSP
"RTN","PSUV10",47,0)
 .S DSP=$P($G(PSUAMIS(PSUDIV,PSUCT)),U,29)
"RTN","PSUV10",48,0)
 .S $P(PSUIVA(PSUDIV),U,1)=$P($G(PSUIVA(PSUDIV)),U,1)+DSP
"RTN","PSUV10",49,0)
 ;
"RTN","PSUV10",50,0)
 Q
"RTN","PSUV10",51,0)
 ;
"RTN","PSUV10",52,0)
LVPREC ;Gather SYR Recycled data
"RTN","PSUV10",53,0)
 ;
"RTN","PSUV10",54,0)
 I PSUTYP="S",PSUP="P" D                         ;SYR's recycled
"RTN","PSUV10",55,0)
 .N REC
"RTN","PSUV10",56,0)
 .S REC=$P($G(PSUAMIS(PSUDIV,PSUCT)),U,30)
"RTN","PSUV10",57,0)
 .S $P(PSUIVA(PSUDIV),U,2)=$P($G(PSUIVA(PSUDIV)),U,2)+REC
"RTN","PSUV10",58,0)
 ;
"RTN","PSUV10",59,0)
 Q
"RTN","PSUV10",60,0)
 ;
"RTN","PSUV10",61,0)
LVPDES ;Gather SYR Destroyed data
"RTN","PSUV10",62,0)
 ;
"RTN","PSUV10",63,0)
 I PSUTYP="S",PSUP="P" D                        ;SYR's destroyed
"RTN","PSUV10",64,0)
 .N DES
"RTN","PSUV10",65,0)
 .S DES=$P($G(PSUAMIS(PSUDIV,PSUCT)),U,31)
"RTN","PSUV10",66,0)
 .S $P(PSUIVA(PSUDIV),U,3)=$P($G(PSUIVA(PSUDIV)),U,3)+DES
"RTN","PSUV10",67,0)
 ;
"RTN","PSUV10",68,0)
 Q
"RTN","PSUV10",69,0)
 ;
"RTN","PSUV10",70,0)
LVPCAN ;Gather SYR Cancelled data
"RTN","PSUV10",71,0)
 ;
"RTN","PSUV10",72,0)
 I PSUTYP="S",PSUP="P" D                         ;SYR's cancelled
"RTN","PSUV10",73,0)
 .N CAN
"RTN","PSUV10",74,0)
 .S CAN=$P($G(PSUAMIS(PSUDIV,PSUCT)),U,32)
"RTN","PSUV10",75,0)
 .S $P(PSUIVA(PSUDIV),U,4)=$P($G(PSUIVA(PSUDIV)),U,4)+CAN
"RTN","PSUV10",76,0)
 ;
"RTN","PSUV10",77,0)
 Q
"RTN","PSUV10",78,0)
 ;
"RTN","PSUV10",79,0)
LVPNET ;Calculate net amount of SYR's Dispensed
"RTN","PSUV10",80,0)
 ;
"RTN","PSUV10",81,0)
 I PSUTYP="S",PSUP="P" D
"RTN","PSUV10",82,0)
 .N NET
"RTN","PSUV10",83,0)
 .S NET=$P($G(PSUAMIS(PSUDIV,PSUCT)),U,11)
"RTN","PSUV10",84,0)
 .S $P(PSUIVA(PSUDIV),U,5)=$P($G(PSUIVA(PSUDIV)),U,5)+NET
"RTN","PSUV10",85,0)
 Q
"RTN","PSUV10",86,0)
 ;
"RTN","PSUV10",87,0)
LVPTOT ;Calculate Total cost
"RTN","PSUV10",88,0)
 ;
"RTN","PSUV10",89,0)
 N NDIS,COST,PSUOR1
"RTN","PSUV10",90,0)
 S PSUCTA=0
"RTN","PSUV10",91,0)
 F  S PSUCTA=$O(PSUAMIS(PSUDIV,PSUCTA)) Q:PSUCTA=""  D
"RTN","PSUV10",92,0)
 .S PSUOR1=$P(PSUAMIS(PSUDIV,PSUCTA),U,4)_"^"_$P(PSUAMIS(PSUDIV,PSUCTA),U,8)
"RTN","PSUV10",93,0)
 .Q:(PSUOR1'=PSUOR)
"RTN","PSUV10",94,0)
 .S NDIS=$P($G(PSUAMIS(PSUDIV,PSUCTA)),U,33)
"RTN","PSUV10",95,0)
 .S COST=$P($G(PSUAMIS(PSUDIV,PSUCTA)),U,22)
"RTN","PSUV10",96,0)
 .S $P(PSUIVA(PSUDIV),U,6)=$P($G(PSUIVA(PSUDIV)),U,6)+(NDIS*$G(COST))
"RTN","PSUV10",97,0)
 .;
"RTN","PSUV10",98,0)
 .;Truncate cost to 2 decimal places
"RTN","PSUV10",99,0)
 .N A,B,C
"RTN","PSUV10",100,0)
 .;
"RTN","PSUV10",101,0)
 .I $P(PSUIVA(PSUDIV),U,6)'["." D  Q
"RTN","PSUV10",102,0)
 ..S $P(PSUIVA(PSUDIV),U,6)=$P(PSUIVA(PSUDIV),U,6)_".00"
"RTN","PSUV10",103,0)
 .;
"RTN","PSUV10",104,0)
 .S A=$F($P(PSUIVA(PSUDIV),U,6),".")  ;Find 1st position after decimal
"RTN","PSUV10",105,0)
 .;
"RTN","PSUV10",106,0)
 .S B=$E($P(PSUIVA(PSUDIV),U,6),1,(A-1)) ;Extract dollars and decimal
"RTN","PSUV10",107,0)
 .;
"RTN","PSUV10",108,0)
 .S C=$E($P(PSUIVA(PSUDIV),U,6),A,(A+1)) ;Extract cents after decimal
"RTN","PSUV10",109,0)
 .I $L(C)'=2 S C=$E(C,1)_0
"RTN","PSUV10",110,0)
 .;
"RTN","PSUV10",111,0)
 .S $P(PSUIVA(PSUDIV),U,6)=B_C
"RTN","PSUV10",112,0)
 Q
"RTN","PSUV10",113,0)
 ;
"RTN","PSUV10",114,0)
CNET ;Calculate Cost per Net SYR's dispensed
"RTN","PSUV10",115,0)
 ;
"RTN","PSUV10",116,0)
 N CNET,TCOST
"RTN","PSUV10",117,0)
 ;
"RTN","PSUV10",118,0)
 S CNET=$P($G(PSUIVA(PSUDIV)),U,5)
"RTN","PSUV10",119,0)
 S TCOST=$P($G(PSUIVA(PSUDIV)),U,6)
"RTN","PSUV10",120,0)
 ;
"RTN","PSUV10",121,0)
 I CNET'="",CNET'=0,TCOST'="" D
"RTN","PSUV10",122,0)
 .S $P(PSUIVA(PSUDIV),U,7)=TCOST/CNET
"RTN","PSUV10",123,0)
 .;
"RTN","PSUV10",124,0)
 .;Truncate cost to 2 decimal places
"RTN","PSUV10",125,0)
 .N A,B,C
"RTN","PSUV10",126,0)
 .;
"RTN","PSUV10",127,0)
 .I $P(PSUIVA(PSUDIV),U,7)'["." D  Q
"RTN","PSUV10",128,0)
 ..S $P(PSUIVA(PSUDIV),U,7)=$P(PSUIVA(PSUDIV),U,7)_".00"
"RTN","PSUV10",129,0)
 .;
"RTN","PSUV10",130,0)
 .S A=$F($P(PSUIVA(PSUDIV),U,7),".")  ;Find 1st position after decimal
"RTN","PSUV10",131,0)
 .;
"RTN","PSUV10",132,0)
 .S B=$E($P(PSUIVA(PSUDIV),U,7),1,(A-1)) ;Extract dollars and decimal
"RTN","PSUV10",133,0)
 .;
"RTN","PSUV10",134,0)
 .S C=$E($P(PSUIVA(PSUDIV),U,7),A,(A+1)) ;Extract cents after decimal
"RTN","PSUV10",135,0)
 .I $L(C)'=2 S C=$E(C,1)_0
"RTN","PSUV10",136,0)
 .;
"RTN","PSUV10",137,0)
 .S $P(PSUIVA(PSUDIV),U,7)=B_C
"RTN","PSUV10",138,0)
 ;
"RTN","PSUV10",139,0)
 Q
"RTN","PSUV10",140,0)
 ;
"RTN","PSUV10",141,0)
TOTAL ;Add up column totals and place into ^XTMP global
"RTN","PSUV10",142,0)
 ;
"RTN","PSUV10",143,0)
 S PSUDI=0
"RTN","PSUV10",144,0)
 F  S PSUDI=$O(PSUIVA(PSUDI)) Q:PSUDI=""  D
"RTN","PSUV10",145,0)
 .S LDSP=$G(LDSP)+$P(PSUIVA(PSUDI),U,1)   ;Total SYR's dispensed
"RTN","PSUV10",146,0)
 .;
"RTN","PSUV10",147,0)
 .S LREC=$G(LREC)+$P(PSUIVA(PSUDI),U,2)   ;Total SYR's recycled
"RTN","PSUV10",148,0)
 .;
"RTN","PSUV10",149,0)
 .S LDES=$G(LDES)+$P(PSUIVA(PSUDI),U,3)   ;Total SYR's destroyed
"RTN","PSUV10",150,0)
 .;
"RTN","PSUV10",151,0)
 .S CLAN=$G(CLAN)+$P(PSUIVA(PSUDI),U,4)   ;Total SYR's cancelled
"RTN","PSUV10",152,0)
 .;
"RTN","PSUV10",153,0)
 .S NDSP=$G(NDSP)+$P(PSUIVA(PSUDI),U,5)   ;Total Net SYR's dispensed
"RTN","PSUV10",154,0)
 .;
"RTN","PSUV10",155,0)
 .S LTOT=$G(LTOT)+$P(PSUIVA(PSUDI),U,6)   ;Total of Total cost
"RTN","PSUV10",156,0)
 .;
"RTN","PSUV10",157,0)
 .I $G(NDSP) S CNDSP=$G(LTOT)/NDSP D
"RTN","PSUV10",158,0)
 ..I CNDSP'["." S CNDSP=CNDSP_".00" Q
"RTN","PSUV10",159,0)
 ..N A,B,C
"RTN","PSUV10",160,0)
 ..S A=$F(CNDSP,".")  ;Find 1st position after decimal
"RTN","PSUV10",161,0)
 ..S B=$E(CNDSP,1,(A-1))   ;Extract dollars and decimal
"RTN","PSUV10",162,0)
 ..S C=$E(CNDSP,A,(A+1))   ;Extract cents after decimal
"RTN","PSUV10",163,0)
 ..I $L(C)'=2 S C=$E(C,1)_0
"RTN","PSUV10",164,0)
 ..S CNDSP=B_C
"RTN","PSUV10",165,0)
 ;
"RTN","PSUV10",166,0)
 I '$D(LDSP) S LDSP=0
"RTN","PSUV10",167,0)
 I '$D(LREC) S LREC=0
"RTN","PSUV10",168,0)
 I '$D(LDES) S LDES=0
"RTN","PSUV10",169,0)
 I '$D(CLAN) S CLAN=0
"RTN","PSUV10",170,0)
 I '$D(NDSP) S NDSP=0
"RTN","PSUV10",171,0)
 I '$D(LTOT) S LTOT="0.00"
"RTN","PSUV10",172,0)
 I '$D(CNDSP) S CNDSP="0.00"
"RTN","PSUV10",173,0)
 ;
"RTN","PSUV10",174,0)
 S ^XTMP(PSUIVSUB,"SYRTOT")=$G(LDSP)_U_$G(LREC)_U_$G(LDES)_U_$G(CLAN)_U_$G(NDSP)_U_$G(LTOT)_U_$G(CNDSP)
"RTN","PSUV10",175,0)
 ;
"RTN","PSUV10",176,0)
 Q
"RTN","PSUV10",177,0)
 ;
"RTN","PSUV10",178,0)
REC ;Place contents of arrays into ^XTMP globals
"RTN","PSUV10",179,0)
 ;
"RTN","PSUV10",180,0)
 M ^XTMP(PSUIVSUB,"SYR",PSUDIV)=PSUIVA(PSUDIV)   ;SYR RECORDS
"RTN","PSUV10",181,0)
 ;
"RTN","PSUV10",182,0)
 Q
"RTN","PSUV6")
0^1^B32881706^B34047613
"RTN","PSUV6",1,0)
PSUV6 ;BIR/DAM - IV LVP AMIS Summary Data ;11 March 2004
"RTN","PSUV6",2,0)
 ;;4.0;PHARMACY BENEFITS MANAGEMENT;**4,22**;MARCH, 2005;Build 2
"RTN","PSUV6",3,0)
 ;
"RTN","PSUV6",4,0)
 ;This routine gathers IV LVP AMIS Summary data
"RTN","PSUV6",5,0)
 ;No DBIA's needed
"RTN","PSUV6",6,0)
 ;
"RTN","PSUV6",7,0)
EN ;Entry point to gather AMIS data.  Called from PSUV3
"RTN","PSUV6",8,0)
 ;
"RTN","PSUV6",9,0)
 K PSUIVA      ;Array to hold temporary data
"RTN","PSUV6",10,0)
 ;
"RTN","PSUV6",11,0)
 ;Initialize variables for column totals
"RTN","PSUV6",12,0)
 ;
"RTN","PSUV6",13,0)
 S (PSUDIV,PSUCT)=0
"RTN","PSUV6",14,0)
 F  S PSUDIV=$O(^XTMP(PSUIVSUB,"RECORDS",PSUDIV)) Q:PSUDIV=""  D EN1
"RTN","PSUV6",15,0)
 Q
"RTN","PSUV6",16,0)
 ;
"RTN","PSUV6",17,0)
EN1 ;EN CONTINUED
"RTN","PSUV6",18,0)
 ;
"RTN","PSUV6",19,0)
 S PSUOR=""
"RTN","PSUV6",20,0)
 N LDSP,LREC,LDES,CLAN,NDSP,LTOT,CNDSP
"RTN","PSUV6",21,0)
 F  S PSUCT=$O(^XTMP(PSUIVSUB,"RECORDS",PSUDIV,PSUCT)) Q:PSUCT=""  D
"RTN","PSUV6",22,0)
 .K PSUAMIS
"RTN","PSUV6",23,0)
 .M PSUAMIS(PSUDIV,PSUCT)=^XTMP(PSUIVSUB,"RECORDS",PSUDIV,PSUCT)
"RTN","PSUV6",24,0)
 .;
"RTN","PSUV6",25,0)
 .S PSUP=$P($G(PSUAMIS(PSUDIV,PSUCT)),U,5)      ;Parent record
"RTN","PSUV6",26,0)
 .;
"RTN","PSUV6",27,0)
 .S PSUTYP=$P($G(PSUAMIS(PSUDIV,PSUCT)),U,6)    ;IV TYPE
"RTN","PSUV6",28,0)
 .;
"RTN","PSUV6",29,0)
 .I PSUTYP="A" S PSUOR=$P($G(PSUAMIS(PSUDIV,PSUCT)),U,4)_"^"_$P($G(PSUAMIS(PSUDIV,PSUCT)),U,8) ;IV order^Patient SSN
"RTN","PSUV6",30,0)
 .D LVPDSP
"RTN","PSUV6",31,0)
 .D LVPREC
"RTN","PSUV6",32,0)
 .D LVPDES
"RTN","PSUV6",33,0)
 .D LVPCAN
"RTN","PSUV6",34,0)
 .D LVPNET
"RTN","PSUV6",35,0)
 .D LVPTOT
"RTN","PSUV6",36,0)
 .D CNET
"RTN","PSUV6",37,0)
 .D REC
"RTN","PSUV6",38,0)
 D TOTAL
"RTN","PSUV6",39,0)
 ;
"RTN","PSUV6",40,0)
 Q
"RTN","PSUV6",41,0)
 ;
"RTN","PSUV6",42,0)
LVPDSP ;Gather LVP Dispensed data
"RTN","PSUV6",43,0)
 ;
"RTN","PSUV6",44,0)
 I PSUTYP="A",PSUP="P" D                         ;LVPs Dispensed
"RTN","PSUV6",45,0)
 .N DSP
"RTN","PSUV6",46,0)
 .S DSP=$P($G(PSUAMIS(PSUDIV,PSUCT)),U,29)
"RTN","PSUV6",47,0)
 .S $P(PSUIVA(PSUDIV),U,1)=$P($G(PSUIVA(PSUDIV)),U,1)+DSP
"RTN","PSUV6",48,0)
 ;
"RTN","PSUV6",49,0)
 Q
"RTN","PSUV6",50,0)
 ;
"RTN","PSUV6",51,0)
LVPREC ;Gather LVP Recycled data
"RTN","PSUV6",52,0)
 ;
"RTN","PSUV6",53,0)
 I PSUTYP="A",PSUP="P" D                         ;LVP's recycled
"RTN","PSUV6",54,0)
 .N REC
"RTN","PSUV6",55,0)
 .S REC=$P($G(PSUAMIS(PSUDIV,PSUCT)),U,30)
"RTN","PSUV6",56,0)
 .S $P(PSUIVA(PSUDIV),U,2)=$P($G(PSUIVA(PSUDIV)),U,2)+REC
"RTN","PSUV6",57,0)
 ;
"RTN","PSUV6",58,0)
 Q
"RTN","PSUV6",59,0)
 ;
"RTN","PSUV6",60,0)
LVPDES ;Gather LVP Destroyed data
"RTN","PSUV6",61,0)
 ;
"RTN","PSUV6",62,0)
 I PSUTYP="A",PSUP="P" D                        ;LVP's destroyed
"RTN","PSUV6",63,0)
 .N DES
"RTN","PSUV6",64,0)
 .S DES=$P($G(PSUAMIS(PSUDIV,PSUCT)),U,31)
"RTN","PSUV6",65,0)
 .S $P(PSUIVA(PSUDIV),U,3)=$P($G(PSUIVA(PSUDIV)),U,3)+DES
"RTN","PSUV6",66,0)
 ;
"RTN","PSUV6",67,0)
 Q
"RTN","PSUV6",68,0)
 ;
"RTN","PSUV6",69,0)
LVPCAN ;Gather LvP Cancelled data
"RTN","PSUV6",70,0)
 ;
"RTN","PSUV6",71,0)
 I PSUTYP="A",PSUP="P" D                         ;LVP's cancelled
"RTN","PSUV6",72,0)
 .N CAN
"RTN","PSUV6",73,0)
 .S CAN=$P($G(PSUAMIS(PSUDIV,PSUCT)),U,32)
"RTN","PSUV6",74,0)
 .S $P(PSUIVA(PSUDIV),U,4)=$P($G(PSUIVA(PSUDIV)),U,4)+CAN
"RTN","PSUV6",75,0)
 ;
"RTN","PSUV6",76,0)
 Q
"RTN","PSUV6",77,0)
 ;
"RTN","PSUV6",78,0)
LVPNET ;Calculate net amount of LVP's Dispensed
"RTN","PSUV6",79,0)
 ;
"RTN","PSUV6",80,0)
 I PSUTYP="A",PSUP="P" D
"RTN","PSUV6",81,0)
 .N NET
"RTN","PSUV6",82,0)
 .S NET=$P($G(PSUAMIS(PSUDIV,PSUCT)),U,11)
"RTN","PSUV6",83,0)
 .S $P(PSUIVA(PSUDIV),U,5)=$P($G(PSUIVA(PSUDIV)),U,5)+NET
"RTN","PSUV6",84,0)
 ;
"RTN","PSUV6",85,0)
 Q
"RTN","PSUV6",86,0)
 ;
"RTN","PSUV6",87,0)
LVPTOT ;Calculate Total cost
"RTN","PSUV6",88,0)
 ;
"RTN","PSUV6",89,0)
 N NDIS,COST,PSUOR1
"RTN","PSUV6",90,0)
 S PSUCTA=0
"RTN","PSUV6",91,0)
 F  S PSUCTA=$O(PSUAMIS(PSUDIV,PSUCTA)) Q:PSUCTA=""  D
"RTN","PSUV6",92,0)
 .S PSUOR1=$P(PSUAMIS(PSUDIV,PSUCTA),U,4)_"^"_$P(PSUAMIS(PSUDIV,PSUCTA),U,8)
"RTN","PSUV6",93,0)
 .Q:(PSUOR1'=PSUOR)
"RTN","PSUV6",94,0)
 .S NDIS=$P($G(PSUAMIS(PSUDIV,PSUCTA)),U,33)
"RTN","PSUV6",95,0)
 .S COST=$P($G(PSUAMIS(PSUDIV,PSUCTA)),U,22)
"RTN","PSUV6",96,0)
 .S $P(PSUIVA(PSUDIV),U,6)=$P($G(PSUIVA(PSUDIV)),U,6)+(NDIS*$G(COST))
"RTN","PSUV6",97,0)
 .;
"RTN","PSUV6",98,0)
 .;Truncate cost to 2 decimal places
"RTN","PSUV6",99,0)
 .N A,B,C
"RTN","PSUV6",100,0)
 .;
"RTN","PSUV6",101,0)
 .I $P(PSUIVA(PSUDIV),U,6)'["." D  Q
"RTN","PSUV6",102,0)
 ..S $P(PSUIVA(PSUDIV),U,6)=$P(PSUIVA(PSUDIV),U,6)_".00"
"RTN","PSUV6",103,0)
 .;
"RTN","PSUV6",104,0)
 .S A=$F($P(PSUIVA(PSUDIV),U,6),".")  ;Find 1st position after decimal
"RTN","PSUV6",105,0)
 .;
"RTN","PSUV6",106,0)
 .S B=$E($P(PSUIVA(PSUDIV),U,6),1,(A-1)) ;Extract dollars and decimal
"RTN","PSUV6",107,0)
 .;
"RTN","PSUV6",108,0)
 .S C=$E($P(PSUIVA(PSUDIV),U,6),A,(A+1)) ;Extract cents after decimal
"RTN","PSUV6",109,0)
 .I $L(C)'=2 S C=$E(C,1)_0
"RTN","PSUV6",110,0)
 .;
"RTN","PSUV6",111,0)
 .S $P(PSUIVA(PSUDIV),U,6)=B_C
"RTN","PSUV6",112,0)
 Q
"RTN","PSUV6",113,0)
 ;
"RTN","PSUV6",114,0)
CNET ;Calculate Cost per Net LVP's dispensed
"RTN","PSUV6",115,0)
 ;
"RTN","PSUV6",116,0)
 N CNET,TCOST
"RTN","PSUV6",117,0)
 ;
"RTN","PSUV6",118,0)
 S CNET=$P($G(PSUIVA(PSUDIV)),U,5)
"RTN","PSUV6",119,0)
 S TCOST=$P($G(PSUIVA(PSUDIV)),U,6)
"RTN","PSUV6",120,0)
 ;
"RTN","PSUV6",121,0)
 I CNET'="",CNET'=0,TCOST'="" D
"RTN","PSUV6",122,0)
 .S $P(PSUIVA(PSUDIV),U,7)=TCOST/CNET
"RTN","PSUV6",123,0)
 .;
"RTN","PSUV6",124,0)
 .;Truncate cost to 2 decimal places
"RTN","PSUV6",125,0)
 .N A,B,C
"RTN","PSUV6",126,0)
 .;
"RTN","PSUV6",127,0)
 .I $P(PSUIVA(PSUDIV),U,7)'["." D  Q
"RTN","PSUV6",128,0)
 ..S $P(PSUIVA(PSUDIV),U,7)=$P(PSUIVA(PSUDIV),U,7)_".00"
"RTN","PSUV6",129,0)
 .;
"RTN","PSUV6",130,0)
 .S A=$F($P(PSUIVA(PSUDIV),U,7),".")  ;Find 1st position after decimal
"RTN","PSUV6",131,0)
 .;
"RTN","PSUV6",132,0)
 .S B=$E($P(PSUIVA(PSUDIV),U,7),1,(A-1)) ;Extract dollars and decimal
"RTN","PSUV6",133,0)
 .;
"RTN","PSUV6",134,0)
 .S C=$E($P(PSUIVA(PSUDIV),U,7),A,(A+1)) ;Extract cents after decimal
"RTN","PSUV6",135,0)
 .I $L(C)'=2 S C=$E(C,1)_0
"RTN","PSUV6",136,0)
 .;
"RTN","PSUV6",137,0)
 .S $P(PSUIVA(PSUDIV),U,7)=B_C
"RTN","PSUV6",138,0)
 ;
"RTN","PSUV6",139,0)
 Q
"RTN","PSUV6",140,0)
 ;
"RTN","PSUV6",141,0)
TOTAL ;Add up column totals and place into ^XTMP global
"RTN","PSUV6",142,0)
 ;
"RTN","PSUV6",143,0)
 S PSUDI=0
"RTN","PSUV6",144,0)
 F  S PSUDI=$O(PSUIVA(PSUDI)) Q:PSUDI=""  D
"RTN","PSUV6",145,0)
 .S LDSP=$G(LDSP)+$P(PSUIVA(PSUDI),U,1)   ;Total LVP's dispensed
"RTN","PSUV6",146,0)
 .;
"RTN","PSUV6",147,0)
 .S LREC=$G(LREC)+$P(PSUIVA(PSUDI),U,2)   ;Total LVP's recycled
"RTN","PSUV6",148,0)
 .;
"RTN","PSUV6",149,0)
 .S LDES=$G(LDES)+$P(PSUIVA(PSUDI),U,3)   ;Total LVP's destroyed
"RTN","PSUV6",150,0)
 .;
"RTN","PSUV6",151,0)
 .S CLAN=$G(CLAN)+$P(PSUIVA(PSUDI),U,4)   ;Total LVP's cancelled
"RTN","PSUV6",152,0)
 .;
"RTN","PSUV6",153,0)
 .S NDSP=$G(NDSP)+$P(PSUIVA(PSUDI),U,5)   ;Total Net LVP's dispensed
"RTN","PSUV6",154,0)
 .;
"RTN","PSUV6",155,0)
 .S LTOT=$G(LTOT)+$P(PSUIVA(PSUDI),U,6)   ;Total of Total cost
"RTN","PSUV6",156,0)
 .;
"RTN","PSUV6",157,0)
 .I $G(NDSP) S CNDSP=$G(LTOT)/NDSP D
"RTN","PSUV6",158,0)
 ..I CNDSP'["." S CNDSP=CNDSP_".00" Q
"RTN","PSUV6",159,0)
 ..N A,B,C
"RTN","PSUV6",160,0)
 ..S A=$F(CNDSP,".")  ;Find 1st position after decimal
"RTN","PSUV6",161,0)
 ..S B=$E(CNDSP,1,(A-1))   ;Extract dollars and decimal
"RTN","PSUV6",162,0)
 ..S C=$E(CNDSP,A,(A+1))   ;Extract cents after decimal
"RTN","PSUV6",163,0)
 ..I $L(C)'=2 S C=$E(C,1)_0
"RTN","PSUV6",164,0)
 ..S CNDSP=B_C
"RTN","PSUV6",165,0)
 ;
"RTN","PSUV6",166,0)
 I '$D(LDSP) S LDSP=0
"RTN","PSUV6",167,0)
 I '$D(LREC) S LREC=0
"RTN","PSUV6",168,0)
 I '$D(LDES) S LDES=0
"RTN","PSUV6",169,0)
 I '$D(CLAN) S CLAN=0
"RTN","PSUV6",170,0)
 I '$D(NDSP) S NDSP=0
"RTN","PSUV6",171,0)
 I '$D(LTOT) S LTOT="0.00"
"RTN","PSUV6",172,0)
 I '$D(CNDSP) S CNDSP="0.00"
"RTN","PSUV6",173,0)
 ;
"RTN","PSUV6",174,0)
 S ^XTMP(PSUIVSUB,"LVPTOT")=LDSP_U_LREC_U_LDES_U_CLAN_U_NDSP_U_LTOT_U_CNDSP
"RTN","PSUV6",175,0)
 ;
"RTN","PSUV6",176,0)
 Q
"RTN","PSUV6",177,0)
 ;
"RTN","PSUV6",178,0)
REC ;Place contents of arrays into ^XTMP globals
"RTN","PSUV6",179,0)
 ;
"RTN","PSUV6",180,0)
 M ^XTMP(PSUIVSUB,"LVP",PSUDIV)=PSUIVA(PSUDIV)   ;LVP RECORDS
"RTN","PSUV6",181,0)
 ;
"RTN","PSUV6",182,0)
 Q
"RTN","PSUV7")
0^2^B32744206^B34147277
"RTN","PSUV7",1,0)
PSUV7 ;BIR/DAM - IV PB AMIS Summary Data ;11 March 2004
"RTN","PSUV7",2,0)
 ;;4.0;PHARMACY BENEFITS MANAGEMENT;**4,22**;MARCH, 2005;Build 2
"RTN","PSUV7",3,0)
 ;
"RTN","PSUV7",4,0)
 ;This routine gathers IV Piggyback AMIS summary data
"RTN","PSUV7",5,0)
 ;No DBIA's needed
"RTN","PSUV7",6,0)
 ;
"RTN","PSUV7",7,0)
EN ;Entry point to gather AMIS data.  Called from PSUV3
"RTN","PSUV7",8,0)
 ;
"RTN","PSUV7",9,0)
 K PSUIVA      ;Array to hold temporary data
"RTN","PSUV7",10,0)
 ;
"RTN","PSUV7",11,0)
 ;Initialize variables for column totals
"RTN","PSUV7",12,0)
 ;
"RTN","PSUV7",13,0)
 S (PSUDIV,PSUCT)=0
"RTN","PSUV7",14,0)
 F  S PSUDIV=$O(^XTMP(PSUIVSUB,"RECORDS",PSUDIV)) Q:PSUDIV=""  D EN1
"RTN","PSUV7",15,0)
 Q
"RTN","PSUV7",16,0)
 ;
"RTN","PSUV7",17,0)
EN1 ;EN CONTINUED
"RTN","PSUV7",18,0)
 ;
"RTN","PSUV7",19,0)
 S PSUOR=""
"RTN","PSUV7",20,0)
 N LDSP,LREC,LDES,CLAN,NDSP,LTOT,CNDSP
"RTN","PSUV7",21,0)
 F  S PSUCT=$O(^XTMP(PSUIVSUB,"RECORDS",PSUDIV,PSUCT)) Q:PSUCT=""  D
"RTN","PSUV7",22,0)
 .K PSUAMIS
"RTN","PSUV7",23,0)
 .M PSUAMIS(PSUDIV,PSUCT)=^XTMP(PSUIVSUB,"RECORDS",PSUDIV,PSUCT)
"RTN","PSUV7",24,0)
 .;
"RTN","PSUV7",25,0)
 .S PSUP=$P($G(PSUAMIS(PSUDIV,PSUCT)),U,5)      ;Parent record
"RTN","PSUV7",26,0)
 .;
"RTN","PSUV7",27,0)
 .S PSUTYP=$P($G(PSUAMIS(PSUDIV,PSUCT)),U,6)    ;IV TYPE
"RTN","PSUV7",28,0)
 .;
"RTN","PSUV7",29,0)
 .I PSUTYP="P" S PSUOR=$P($G(PSUAMIS(PSUDIV,PSUCT)),U,4)_"^"_$P($G(PSUAMIS(PSUDIV,PSUCT)),U,8) ;IV order #^Patient SSN
"RTN","PSUV7",30,0)
 .;
"RTN","PSUV7",31,0)
 .D LVPDSP
"RTN","PSUV7",32,0)
 .D LVPREC
"RTN","PSUV7",33,0)
 .D LVPDES
"RTN","PSUV7",34,0)
 .D LVPCAN
"RTN","PSUV7",35,0)
 .D LVPNET
"RTN","PSUV7",36,0)
 .D LVPTOT
"RTN","PSUV7",37,0)
 .D CNET
"RTN","PSUV7",38,0)
 .D REC
"RTN","PSUV7",39,0)
 D TOTAL
"RTN","PSUV7",40,0)
 ;
"RTN","PSUV7",41,0)
 Q
"RTN","PSUV7",42,0)
 ;
"RTN","PSUV7",43,0)
LVPDSP ;Gather PB Dispensed data
"RTN","PSUV7",44,0)
 ;
"RTN","PSUV7",45,0)
 I PSUTYP="P",PSUP="P" D                         ;PBs Dispensed
"RTN","PSUV7",46,0)
 .N DSP
"RTN","PSUV7",47,0)
 .S DSP=$P($G(PSUAMIS(PSUDIV,PSUCT)),U,29)
"RTN","PSUV7",48,0)
 .S $P(PSUIVA(PSUDIV),U,1)=$P($G(PSUIVA(PSUDIV)),U,1)+DSP
"RTN","PSUV7",49,0)
 ;
"RTN","PSUV7",50,0)
 Q
"RTN","PSUV7",51,0)
 ;
"RTN","PSUV7",52,0)
LVPREC ;Gather PB Recycled data
"RTN","PSUV7",53,0)
 ;
"RTN","PSUV7",54,0)
 I PSUTYP="P",PSUP="P" D                         ;PB's recycled
"RTN","PSUV7",55,0)
 .N REC
"RTN","PSUV7",56,0)
 .S REC=$P($G(PSUAMIS(PSUDIV,PSUCT)),U,30)
"RTN","PSUV7",57,0)
 .S $P(PSUIVA(PSUDIV),U,2)=$P($G(PSUIVA(PSUDIV)),U,2)+REC
"RTN","PSUV7",58,0)
 ;
"RTN","PSUV7",59,0)
 Q
"RTN","PSUV7",60,0)
 ;
"RTN","PSUV7",61,0)
LVPDES ;Gather PB Destroyed data
"RTN","PSUV7",62,0)
 ;
"RTN","PSUV7",63,0)
 I PSUTYP="P",PSUP="P" D                        ;PB's destroyed
"RTN","PSUV7",64,0)
 .N DES
"RTN","PSUV7",65,0)
 .S DES=$P($G(PSUAMIS(PSUDIV,PSUCT)),U,31)
"RTN","PSUV7",66,0)
 .S $P(PSUIVA(PSUDIV),U,3)=$P($G(PSUIVA(PSUDIV)),U,3)+DES
"RTN","PSUV7",67,0)
 ;
"RTN","PSUV7",68,0)
 Q
"RTN","PSUV7",69,0)
 ;
"RTN","PSUV7",70,0)
LVPCAN ;Gather PB Cancelled data
"RTN","PSUV7",71,0)
 ;
"RTN","PSUV7",72,0)
 I PSUTYP="P",PSUP="P" D                         ;PB's cancelled
"RTN","PSUV7",73,0)
 .N CAN
"RTN","PSUV7",74,0)
 .S CAN=$P($G(PSUAMIS(PSUDIV,PSUCT)),U,32)
"RTN","PSUV7",75,0)
 .S $P(PSUIVA(PSUDIV),U,4)=$P($G(PSUIVA(PSUDIV)),U,4)+CAN
"RTN","PSUV7",76,0)
 ;
"RTN","PSUV7",77,0)
 Q
"RTN","PSUV7",78,0)
 ;
"RTN","PSUV7",79,0)
LVPNET ;Calculate net amount of PB's Dispensed
"RTN","PSUV7",80,0)
 ;
"RTN","PSUV7",81,0)
 I PSUTYP="P",PSUP="P" D
"RTN","PSUV7",82,0)
 .N NET
"RTN","PSUV7",83,0)
 .S NET=$P($G(PSUAMIS(PSUDIV,PSUCT)),U,11)
"RTN","PSUV7",84,0)
 .S $P(PSUIVA(PSUDIV),U,5)=$P($G(PSUIVA(PSUDIV)),U,5)+NET
"RTN","PSUV7",85,0)
 Q
"RTN","PSUV7",86,0)
 ;
"RTN","PSUV7",87,0)
LVPTOT ;Calculate Total cost
"RTN","PSUV7",88,0)
 ;
"RTN","PSUV7",89,0)
 N NDIS,COST,PSUOR1
"RTN","PSUV7",90,0)
 S PSUCTA=0
"RTN","PSUV7",91,0)
 F  S PSUCTA=$O(PSUAMIS(PSUDIV,PSUCTA)) Q:PSUCTA=""  D
"RTN","PSUV7",92,0)
 .S PSUOR1=$P(PSUAMIS(PSUDIV,PSUCTA),U,4)_"^"_$P(PSUAMIS(PSUDIV,PSUCTA),U,8)
"RTN","PSUV7",93,0)
 .Q:(PSUOR1'=PSUOR)
"RTN","PSUV7",94,0)
 .S NDIS=$P($G(PSUAMIS(PSUDIV,PSUCTA)),U,33)
"RTN","PSUV7",95,0)
 .S COST=$P($G(PSUAMIS(PSUDIV,PSUCTA)),U,22)
"RTN","PSUV7",96,0)
 .S $P(PSUIVA(PSUDIV),U,6)=$P($G(PSUIVA(PSUDIV)),U,6)+(NDIS*$G(COST))
"RTN","PSUV7",97,0)
 .;
"RTN","PSUV7",98,0)
 .;Truncate cost to 2 decimal places
"RTN","PSUV7",99,0)
 .N A,B,C
"RTN","PSUV7",100,0)
 .;
"RTN","PSUV7",101,0)
 .I $P(PSUIVA(PSUDIV),U,6)'["." D  Q
"RTN","PSUV7",102,0)
 ..S $P(PSUIVA(PSUDIV),U,6)=$P(PSUIVA(PSUDIV),U,6)_".00"
"RTN","PSUV7",103,0)
 .;
"RTN","PSUV7",104,0)
 .S A=$F($P(PSUIVA(PSUDIV),U,6),".")  ;Find 1st position after decimal
"RTN","PSUV7",105,0)
 .;
"RTN","PSUV7",106,0)
 .S B=$E($P(PSUIVA(PSUDIV),U,6),1,(A-1)) ;Extract dollars and decimal
"RTN","PSUV7",107,0)
 .;
"RTN","PSUV7",108,0)
 .S C=$E($P(PSUIVA(PSUDIV),U,6),A,(A+1)) ;Extract cents after decimal
"RTN","PSUV7",109,0)
 .I $L(C)'=2 S C=$E(C,1)_0
"RTN","PSUV7",110,0)
 .;
"RTN","PSUV7",111,0)
 .S $P(PSUIVA(PSUDIV),U,6)=B_C
"RTN","PSUV7",112,0)
 Q
"RTN","PSUV7",113,0)
 ;
"RTN","PSUV7",114,0)
CNET ;Calculate Cost per Net PB's dispensed
"RTN","PSUV7",115,0)
 ;
"RTN","PSUV7",116,0)
 N CNET,TCOST
"RTN","PSUV7",117,0)
 ;
"RTN","PSUV7",118,0)
 S CNET=$P($G(PSUIVA(PSUDIV)),U,5)
"RTN","PSUV7",119,0)
 S TCOST=$P($G(PSUIVA(PSUDIV)),U,6)
"RTN","PSUV7",120,0)
 ;
"RTN","PSUV7",121,0)
 I CNET'="",CNET'=0,TCOST'="" D
"RTN","PSUV7",122,0)
 .S $P(PSUIVA(PSUDIV),U,7)=TCOST/CNET
"RTN","PSUV7",123,0)
 .;
"RTN","PSUV7",124,0)
 .;Truncate cost to 2 decimal places
"RTN","PSUV7",125,0)
 .N A,B,C
"RTN","PSUV7",126,0)
 .;
"RTN","PSUV7",127,0)
 .I $P(PSUIVA(PSUDIV),U,7)'["." D  Q
"RTN","PSUV7",128,0)
 ..S $P(PSUIVA(PSUDIV),U,7)=$P(PSUIVA(PSUDIV),U,7)_".00"
"RTN","PSUV7",129,0)
 .;
"RTN","PSUV7",130,0)
 .S A=$F($P(PSUIVA(PSUDIV),U,7),".")  ;Find 1st position after decimal
"RTN","PSUV7",131,0)
 .;
"RTN","PSUV7",132,0)
 .S B=$E($P(PSUIVA(PSUDIV),U,7),1,(A-1)) ;Extract dollars and decimal
"RTN","PSUV7",133,0)
 .;
"RTN","PSUV7",134,0)
 .S C=$E($P(PSUIVA(PSUDIV),U,7),A,(A+1)) ;Extract cents after decimal
"RTN","PSUV7",135,0)
 .I $L(C)'=2 S C=$E(C,1)_0
"RTN","PSUV7",136,0)
 .;
"RTN","PSUV7",137,0)
 .S $P(PSUIVA(PSUDIV),U,7)=B_C
"RTN","PSUV7",138,0)
 ;
"RTN","PSUV7",139,0)
 Q
"RTN","PSUV7",140,0)
 ;
"RTN","PSUV7",141,0)
TOTAL ;Add up column totals and place into ^XTMP global
"RTN","PSUV7",142,0)
 ;
"RTN","PSUV7",143,0)
 S PSUDI=0
"RTN","PSUV7",144,0)
 F  S PSUDI=$O(PSUIVA(PSUDI)) Q:PSUDI=""  D
"RTN","PSUV7",145,0)
 .S LDSP=$G(LDSP)+$P(PSUIVA(PSUDI),U,1)   ;Total PB's dispensed
"RTN","PSUV7",146,0)
 .;
"RTN","PSUV7",147,0)
 .S LREC=$G(LREC)+$P(PSUIVA(PSUDI),U,2)   ;Total PB's recycled
"RTN","PSUV7",148,0)
 .;
"RTN","PSUV7",149,0)
 .S LDES=$G(LDES)+$P(PSUIVA(PSUDI),U,3)   ;Total PB's destroyed
"RTN","PSUV7",150,0)
 .;
"RTN","PSUV7",151,0)
 .S CLAN=$G(CLAN)+$P(PSUIVA(PSUDI),U,4)   ;Total PB's cancelled
"RTN","PSUV7",152,0)
 .;
"RTN","PSUV7",153,0)
 .S NDSP=$G(NDSP)+$P(PSUIVA(PSUDI),U,5)   ;Total Net PB's dispensed
"RTN","PSUV7",154,0)
 .;
"RTN","PSUV7",155,0)
 .S LTOT=$G(LTOT)+$P(PSUIVA(PSUDI),U,6)   ;Total of Total cost
"RTN","PSUV7",156,0)
 .;
"RTN","PSUV7",157,0)
 .I $G(NDSP) S CNDSP=$G(LTOT)/NDSP D
"RTN","PSUV7",158,0)
 ..I CNDSP'["." S CNDSP=CNDSP_".00" Q
"RTN","PSUV7",159,0)
 ..N A,B,C
"RTN","PSUV7",160,0)
 ..S A=$F(CNDSP,".")  ;Find 1st position after decimal
"RTN","PSUV7",161,0)
 ..S B=$E(CNDSP,1,(A-1))   ;Extract dollars and decimal
"RTN","PSUV7",162,0)
 ..S C=$E(CNDSP,A,(A+1))   ;Extract cents after decimal
"RTN","PSUV7",163,0)
 ..I $L(C)'=2 S C=$E(C,1)_0
"RTN","PSUV7",164,0)
 ..S CNDSP=B_C
"RTN","PSUV7",165,0)
 ;
"RTN","PSUV7",166,0)
 I '$D(LDSP) S LDSP=0
"RTN","PSUV7",167,0)
 I '$D(LREC) S LREC=0
"RTN","PSUV7",168,0)
 I '$D(LDES) S LDES=0
"RTN","PSUV7",169,0)
 I '$D(CLAN) S CLAN=0
"RTN","PSUV7",170,0)
 I '$D(NDSP) S NDSP=0
"RTN","PSUV7",171,0)
 I '$D(LTOT) S LTOT="0.00"
"RTN","PSUV7",172,0)
 I '$D(CNDSP) S CNDSP="0.00"
"RTN","PSUV7",173,0)
 ;
"RTN","PSUV7",174,0)
 S ^XTMP(PSUIVSUB,"PBTOT")=LDSP_U_LREC_U_LDES_U_CLAN_U_NDSP_U_LTOT_U_CNDSP
"RTN","PSUV7",175,0)
 ;
"RTN","PSUV7",176,0)
 Q
"RTN","PSUV7",177,0)
 ;
"RTN","PSUV7",178,0)
REC ;Place contents of arrays into ^XTMP globals
"RTN","PSUV7",179,0)
 ;
"RTN","PSUV7",180,0)
 M ^XTMP(PSUIVSUB,"PB",PSUDIV)=PSUIVA(PSUDIV)   ;PB RECORDS
"RTN","PSUV7",181,0)
 ;
"RTN","PSUV7",182,0)
 Q
"RTN","PSUV8")
0^3^B33106616^B34528842
"RTN","PSUV8",1,0)
PSUV8 ;BIR/DAM - IV TPN AMIS Summary Data ;11 March 2004
"RTN","PSUV8",2,0)
 ;;4.0;PHARMACY BENEFITS MANAGEMENT;**4,22**;MARCH, 2005;Build 2
"RTN","PSUV8",3,0)
 ;
"RTN","PSUV8",4,0)
 ;This routine gathers IV TPN AMIS summary data
"RTN","PSUV8",5,0)
 ;No DBIA's needed
"RTN","PSUV8",6,0)
 ;
"RTN","PSUV8",7,0)
EN ;Entry point to gather AMIS data.  Called from PSUV3
"RTN","PSUV8",8,0)
 ;
"RTN","PSUV8",9,0)
 K PSUIVA      ;Array to hold temporary data
"RTN","PSUV8",10,0)
 ;
"RTN","PSUV8",11,0)
 ;Initialize variables for column totals
"RTN","PSUV8",12,0)
 ;
"RTN","PSUV8",13,0)
 S (PSUDIV,PSUCT)=0
"RTN","PSUV8",14,0)
 F  S PSUDIV=$O(^XTMP(PSUIVSUB,"RECORDS",PSUDIV)) Q:PSUDIV=""  D EN1
"RTN","PSUV8",15,0)
 Q
"RTN","PSUV8",16,0)
 ;
"RTN","PSUV8",17,0)
EN1 ;EN CONTINUED
"RTN","PSUV8",18,0)
 ;
"RTN","PSUV8",19,0)
 S PSUOR=""
"RTN","PSUV8",20,0)
 N LDSP,LREC,LDES,CLAN,NDSP,LTOT,CNDSP
"RTN","PSUV8",21,0)
 F  S PSUCT=$O(^XTMP(PSUIVSUB,"RECORDS",PSUDIV,PSUCT)) Q:PSUCT=""  D
"RTN","PSUV8",22,0)
 .K PSUAMIS
"RTN","PSUV8",23,0)
 .M PSUAMIS(PSUDIV,PSUCT)=^XTMP(PSUIVSUB,"RECORDS",PSUDIV,PSUCT)
"RTN","PSUV8",24,0)
 .;
"RTN","PSUV8",25,0)
 .S PSUP=$P($G(PSUAMIS(PSUDIV,PSUCT)),U,5)      ;parent record
"RTN","PSUV8",26,0)
 .;
"RTN","PSUV8",27,0)
 .S PSUTYP=$P($G(PSUAMIS(PSUDIV,PSUCT)),U,6)    ;IV TYPE
"RTN","PSUV8",28,0)
 .;
"RTN","PSUV8",29,0)
 .I PSUTYP="H" S PSUOR=$P($G(PSUAMIS(PSUDIV,PSUCT)),U,4)_"^"_$P($G(PSUAMIS(PSUDIV,PSUCT)),U,8) ;IV order #^Patient SSN
"RTN","PSUV8",30,0)
 .D LVPDSP
"RTN","PSUV8",31,0)
 .D LVPREC
"RTN","PSUV8",32,0)
 .D LVPDES
"RTN","PSUV8",33,0)
 .D LVPCAN
"RTN","PSUV8",34,0)
 .D LVPNET
"RTN","PSUV8",35,0)
 .D LVPTOT
"RTN","PSUV8",36,0)
 .D CNET
"RTN","PSUV8",37,0)
 .D REC
"RTN","PSUV8",38,0)
 D TOTAL
"RTN","PSUV8",39,0)
 ;
"RTN","PSUV8",40,0)
 Q
"RTN","PSUV8",41,0)
 ;
"RTN","PSUV8",42,0)
LVPDSP ;Gather TPN Dispensed data
"RTN","PSUV8",43,0)
 ;
"RTN","PSUV8",44,0)
 I PSUTYP="H",PSUP="P" D                         ;TPNs Dispensed
"RTN","PSUV8",45,0)
 .N DSP
"RTN","PSUV8",46,0)
 .S DSP=$P($G(PSUAMIS(PSUDIV,PSUCT)),U,29)
"RTN","PSUV8",47,0)
 .S $P(PSUIVA(PSUDIV),U,1)=$P($G(PSUIVA(PSUDIV)),U,1)+DSP
"RTN","PSUV8",48,0)
 ;
"RTN","PSUV8",49,0)
 Q
"RTN","PSUV8",50,0)
 ;
"RTN","PSUV8",51,0)
LVPREC ;Gather TPN Recycled data
"RTN","PSUV8",52,0)
 ;
"RTN","PSUV8",53,0)
 I PSUTYP="H",PSUP="P" D                         ;TPN's recycled
"RTN","PSUV8",54,0)
 .N REC
"RTN","PSUV8",55,0)
 .S REC=$P($G(PSUAMIS(PSUDIV,PSUCT)),U,30)
"RTN","PSUV8",56,0)
 .S $P(PSUIVA(PSUDIV),U,2)=$P($G(PSUIVA(PSUDIV)),U,2)+REC
"RTN","PSUV8",57,0)
 ;
"RTN","PSUV8",58,0)
 Q
"RTN","PSUV8",59,0)
 ;
"RTN","PSUV8",60,0)
LVPDES ;Gather TPN Destroyed data
"RTN","PSUV8",61,0)
 ;
"RTN","PSUV8",62,0)
 I PSUTYP="H",PSUP="P" D                        ;TPN's destroyed
"RTN","PSUV8",63,0)
 .N DES
"RTN","PSUV8",64,0)
 .S DES=$P($G(PSUAMIS(PSUDIV,PSUCT)),U,31)
"RTN","PSUV8",65,0)
 .S $P(PSUIVA(PSUDIV),U,3)=$P($G(PSUIVA(PSUDIV)),U,3)+DES
"RTN","PSUV8",66,0)
 ;
"RTN","PSUV8",67,0)
 Q
"RTN","PSUV8",68,0)
 ;
"RTN","PSUV8",69,0)
LVPCAN ;Gather TPN Cancelled data
"RTN","PSUV8",70,0)
 ;
"RTN","PSUV8",71,0)
 I PSUTYP="H",PSUP="P" D                         ;TPN's cancelled
"RTN","PSUV8",72,0)
 .N CAN
"RTN","PSUV8",73,0)
 .S CAN=$P($G(PSUAMIS(PSUDIV,PSUCT)),U,32)
"RTN","PSUV8",74,0)
 .S $P(PSUIVA(PSUDIV),U,4)=$P($G(PSUIVA(PSUDIV)),U,4)+CAN
"RTN","PSUV8",75,0)
 ;
"RTN","PSUV8",76,0)
 Q
"RTN","PSUV8",77,0)
 ;
"RTN","PSUV8",78,0)
LVPNET ;Calculate net amount of TPN's Dispensed
"RTN","PSUV8",79,0)
 ;
"RTN","PSUV8",80,0)
 I PSUTYP="H",PSUP="P" D
"RTN","PSUV8",81,0)
 .N NET
"RTN","PSUV8",82,0)
 .S NET=$P($G(PSUAMIS(PSUDIV,PSUCT)),U,11)
"RTN","PSUV8",83,0)
 .S $P(PSUIVA(PSUDIV),U,5)=$P($G(PSUIVA(PSUDIV)),U,5)+NET
"RTN","PSUV8",84,0)
 Q
"RTN","PSUV8",85,0)
 ;
"RTN","PSUV8",86,0)
LVPTOT ;Calculate Total cost
"RTN","PSUV8",87,0)
 ;
"RTN","PSUV8",88,0)
 N NDIS,COST,PSUOR1
"RTN","PSUV8",89,0)
 S PSUCTA=0
"RTN","PSUV8",90,0)
 F  S PSUCTA=$O(PSUAMIS(PSUDIV,PSUCTA)) Q:PSUCTA=""  D
"RTN","PSUV8",91,0)
 .S PSUOR1=$P(PSUAMIS(PSUDIV,PSUCTA),U,4)_"^"_$P(PSUAMIS(PSUDIV,PSUCTA),U,8)
"RTN","PSUV8",92,0)
 .Q:(PSUOR1'=PSUOR)
"RTN","PSUV8",93,0)
 .S NDIS=$P($G(PSUAMIS(PSUDIV,PSUCTA)),U,33)
"RTN","PSUV8",94,0)
 .S COST=$P($G(PSUAMIS(PSUDIV,PSUCTA)),U,22)
"RTN","PSUV8",95,0)
 .S $P(PSUIVA(PSUDIV),U,6)=$P($G(PSUIVA(PSUDIV)),U,6)+(NDIS*$G(COST))
"RTN","PSUV8",96,0)
 .;
"RTN","PSUV8",97,0)
 .;Truncate cost to 2 decimal places
"RTN","PSUV8",98,0)
 .N A,B,C
"RTN","PSUV8",99,0)
 .;
"RTN","PSUV8",100,0)
 .I $P(PSUIVA(PSUDIV),U,6)'["." D  Q
"RTN","PSUV8",101,0)
 ..S $P(PSUIVA(PSUDIV),U,6)=$P(PSUIVA(PSUDIV),U,6)_".00"
"RTN","PSUV8",102,0)
 .;
"RTN","PSUV8",103,0)
 .S A=$F($P(PSUIVA(PSUDIV),U,6),".")  ;Find 1st position after decimal
"RTN","PSUV8",104,0)
 .;
"RTN","PSUV8",105,0)
 .S B=$E($P(PSUIVA(PSUDIV),U,6),1,(A-1)) ;Extract dollars and decimal
"RTN","PSUV8",106,0)
 .;
"RTN","PSUV8",107,0)
 .S C=$E($P(PSUIVA(PSUDIV),U,6),A,(A+1)) ;Extract cents after decimal
"RTN","PSUV8",108,0)
 .I $L(C)'=2 S C=$E(C,1)_0
"RTN","PSUV8",109,0)
 .;
"RTN","PSUV8",110,0)
 .S $P(PSUIVA(PSUDIV),U,6)=B_C
"RTN","PSUV8",111,0)
 Q
"RTN","PSUV8",112,0)
 ;
"RTN","PSUV8",113,0)
CNET ;Calculate Cost per Net TPN's dispensed
"RTN","PSUV8",114,0)
 ;
"RTN","PSUV8",115,0)
 N CNET,TCOST
"RTN","PSUV8",116,0)
 ;
"RTN","PSUV8",117,0)
 S CNET=$P($G(PSUIVA(PSUDIV)),U,5)
"RTN","PSUV8",118,0)
 S TCOST=$P($G(PSUIVA(PSUDIV)),U,6)
"RTN","PSUV8",119,0)
 ;
"RTN","PSUV8",120,0)
 I CNET'="",CNET'=0,TCOST'="" D
"RTN","PSUV8",121,0)
 .S $P(PSUIVA(PSUDIV),U,7)=TCOST/CNET
"RTN","PSUV8",122,0)
 .;
"RTN","PSUV8",123,0)
 .;Truncate cost to 2 decimal places
"RTN","PSUV8",124,0)
 .N A,B,C
"RTN","PSUV8",125,0)
 .;
"RTN","PSUV8",126,0)
 .I $P(PSUIVA(PSUDIV),U,7)'["." D  Q
"RTN","PSUV8",127,0)
 ..S $P(PSUIVA(PSUDIV),U,7)=$P(PSUIVA(PSUDIV),U,7)_".00"
"RTN","PSUV8",128,0)
 .;
"RTN","PSUV8",129,0)
 .S A=$F($P(PSUIVA(PSUDIV),U,7),".")  ;Find 1st position after decimal
"RTN","PSUV8",130,0)
 .;
"RTN","PSUV8",131,0)
 .S B=$E($P(PSUIVA(PSUDIV),U,7),1,(A-1)) ;Extract dollars and decimal
"RTN","PSUV8",132,0)
 .;
"RTN","PSUV8",133,0)
 .S C=$E($P(PSUIVA(PSUDIV),U,7),A,(A+1)) ;Extract cents after decimal
"RTN","PSUV8",134,0)
 .I $L(C)'=2 S C=$E(C,1)_0
"RTN","PSUV8",135,0)
 .;
"RTN","PSUV8",136,0)
 .S $P(PSUIVA(PSUDIV),U,7)=B_C
"RTN","PSUV8",137,0)
 ;
"RTN","PSUV8",138,0)
 Q
"RTN","PSUV8",139,0)
 ;
"RTN","PSUV8",140,0)
TOTAL ;Add up column totals and place into ^XTMP global
"RTN","PSUV8",141,0)
 ;
"RTN","PSUV8",142,0)
 S PSUDI=0
"RTN","PSUV8",143,0)
 F  S PSUDI=$O(PSUIVA(PSUDI)) Q:PSUDI=""  D
"RTN","PSUV8",144,0)
 .S LDSP=$G(LDSP)+$P(PSUIVA(PSUDI),U,1)   ;Total TPN's dispensed
"RTN","PSUV8",145,0)
 .;
"RTN","PSUV8",146,0)
 .S LREC=$G(LREC)+$P(PSUIVA(PSUDI),U,2)   ;Total TPN's recycled
"RTN","PSUV8",147,0)
 .;
"RTN","PSUV8",148,0)
 .S LDES=$G(LDES)+$P(PSUIVA(PSUDI),U,3)   ;Total TPN's destroyed
"RTN","PSUV8",149,0)
 .;
"RTN","PSUV8",150,0)
 .S CLAN=$G(CLAN)+$P(PSUIVA(PSUDI),U,4)   ;Total TPN's cancelled
"RTN","PSUV8",151,0)
 .;
"RTN","PSUV8",152,0)
 .S NDSP=$G(NDSP)+$P(PSUIVA(PSUDI),U,5)   ;Total Net TPN's dispensed
"RTN","PSUV8",153,0)
 .;
"RTN","PSUV8",154,0)
 .S LTOT=$G(LTOT)+$P(PSUIVA(PSUDI),U,6)   ;Total of Total cost
"RTN","PSUV8",155,0)
 .;
"RTN","PSUV8",156,0)
 .I $G(NDSP) S CNDSP=$G(LTOT)/NDSP D
"RTN","PSUV8",157,0)
 ..I CNDSP'["." S CNDSP=CNDSP_".00" Q
"RTN","PSUV8",158,0)
 ..N A,B,C
"RTN","PSUV8",159,0)
 ..S A=$F(CNDSP,".")  ;Find 1st position after decimal
"RTN","PSUV8",160,0)
 ..S B=$E(CNDSP,1,(A-1))   ;Extract dollars and decimal
"RTN","PSUV8",161,0)
 ..S C=$E(CNDSP,A,(A+1))   ;Extract cents after decimal
"RTN","PSUV8",162,0)
 ..I $L(C)'=2 S C=$E(C,1)_0
"RTN","PSUV8",163,0)
 ..S CNDSP=B_C
"RTN","PSUV8",164,0)
 ;
"RTN","PSUV8",165,0)
 I '$D(LDSP) S LDSP=0
"RTN","PSUV8",166,0)
 I '$D(LREC) S LREC=0
"RTN","PSUV8",167,0)
 I '$D(LDES) S LDES=0
"RTN","PSUV8",168,0)
 I '$D(CLAN) S CLAN=0
"RTN","PSUV8",169,0)
 I '$D(NDSP) S NDSP=0
"RTN","PSUV8",170,0)
 I '$D(LTOT) S LTOT="0.00"
"RTN","PSUV8",171,0)
 I '$D(CNDSP) S CNDSP="0.00"
"RTN","PSUV8",172,0)
 ;
"RTN","PSUV8",173,0)
 S ^XTMP(PSUIVSUB,"TPNTOT")=$G(LDSP)_U_$G(LREC)_U_$G(LDES)_U_$G(CLAN)_U_$G(NDSP)_U_$G(LTOT)_U_$G(CNDSP)
"RTN","PSUV8",174,0)
 ;
"RTN","PSUV8",175,0)
 Q
"RTN","PSUV8",176,0)
 ;
"RTN","PSUV8",177,0)
REC ;Place contents of arrays into ^XTMP globals
"RTN","PSUV8",178,0)
 ;
"RTN","PSUV8",179,0)
 M ^XTMP(PSUIVSUB,"TPN",PSUDIV)=PSUIVA(PSUDIV)   ;TPN RECORDS
"RTN","PSUV8",180,0)
 ;
"RTN","PSUV8",181,0)
 Q
"RTN","PSUV9")
0^4^B33509589^B34939396
"RTN","PSUV9",1,0)
PSUV9 ;BIR/DAM - IV Chemotherapy AMIS Summary Data ;11 March 2004
"RTN","PSUV9",2,0)
 ;;4.0;PHARMACY BENEFITS MANAGEMENT;**4,22**;MARCH, 2005;Build 2
"RTN","PSUV9",3,0)
 ;
"RTN","PSUV9",4,0)
 ;This routine gathers IV CHEMO AMIS summary data
"RTN","PSUV9",5,0)
 ;No DBIA's needed
"RTN","PSUV9",6,0)
 ;
"RTN","PSUV9",7,0)
EN ;Entry point to gather AMIS data.  Called from PSUV3
"RTN","PSUV9",8,0)
 ;
"RTN","PSUV9",9,0)
 K PSUIVA      ;Array to hold temporary data
"RTN","PSUV9",10,0)
 ;
"RTN","PSUV9",11,0)
 ;Initialize variables for column totals
"RTN","PSUV9",12,0)
 ;
"RTN","PSUV9",13,0)
 S (PSUDIV,PSUCT)=0
"RTN","PSUV9",14,0)
 F  S PSUDIV=$O(^XTMP(PSUIVSUB,"RECORDS",PSUDIV)) Q:PSUDIV=""  D EN1
"RTN","PSUV9",15,0)
 Q
"RTN","PSUV9",16,0)
 ;
"RTN","PSUV9",17,0)
EN1 ;EN CONTINUED
"RTN","PSUV9",18,0)
 ;
"RTN","PSUV9",19,0)
 S PSUOR=""
"RTN","PSUV9",20,0)
 N LDSP,LREC,LDES,CLAN,NDSP,LTOT,CNDSP
"RTN","PSUV9",21,0)
 F  S PSUCT=$O(^XTMP(PSUIVSUB,"RECORDS",PSUDIV,PSUCT)) Q:PSUCT=""  D
"RTN","PSUV9",22,0)
 .K PSUAMIS
"RTN","PSUV9",23,0)
 .M PSUAMIS(PSUDIV,PSUCT)=^XTMP(PSUIVSUB,"RECORDS",PSUDIV,PSUCT)
"RTN","PSUV9",24,0)
 .;
"RTN","PSUV9",25,0)
 .S PSUP=$P($G(PSUAMIS(PSUDIV,PSUCT)),U,5)      ;parent record
"RTN","PSUV9",26,0)
 .;
"RTN","PSUV9",27,0)
 .S PSUTYP=$P($G(PSUAMIS(PSUDIV,PSUCT)),U,6)    ;IV TYPE
"RTN","PSUV9",28,0)
 .;
"RTN","PSUV9",29,0)
 .I PSUTYP="C" S PSUOR=$P($G(PSUAMIS(PSUDIV,PSUCT)),U,4)_"^"_$P($G(PSUAMIS(PSUDIV,PSUCT)),U,8) ;IV order #^Patient SSN
"RTN","PSUV9",30,0)
 .;
"RTN","PSUV9",31,0)
 .D LVPDSP
"RTN","PSUV9",32,0)
 .D LVPREC
"RTN","PSUV9",33,0)
 .D LVPDES
"RTN","PSUV9",34,0)
 .D LVPCAN
"RTN","PSUV9",35,0)
 .D LVPNET
"RTN","PSUV9",36,0)
 .D LVPTOT
"RTN","PSUV9",37,0)
 .D CNET
"RTN","PSUV9",38,0)
 .D REC
"RTN","PSUV9",39,0)
 D TOTAL
"RTN","PSUV9",40,0)
 ;
"RTN","PSUV9",41,0)
 Q
"RTN","PSUV9",42,0)
 ;
"RTN","PSUV9",43,0)
LVPDSP ;Gather CHEMO Dispensed data
"RTN","PSUV9",44,0)
 ;
"RTN","PSUV9",45,0)
 I PSUTYP="C",PSUP="P" D                         ;CHEMOs Dispensed
"RTN","PSUV9",46,0)
 .N DSP
"RTN","PSUV9",47,0)
 .S DSP=$P($G(PSUAMIS(PSUDIV,PSUCT)),U,29)
"RTN","PSUV9",48,0)
 .S $P(PSUIVA(PSUDIV),U,1)=$P($G(PSUIVA(PSUDIV)),U,1)+DSP
"RTN","PSUV9",49,0)
 ;
"RTN","PSUV9",50,0)
 Q
"RTN","PSUV9",51,0)
 ;
"RTN","PSUV9",52,0)
LVPREC ;Gather CHEMO Recycled data
"RTN","PSUV9",53,0)
 ;
"RTN","PSUV9",54,0)
 I PSUTYP="C",PSUP="P" D                         ;CHEMO's recycled
"RTN","PSUV9",55,0)
 .N REC
"RTN","PSUV9",56,0)
 .S REC=$P($G(PSUAMIS(PSUDIV,PSUCT)),U,30)
"RTN","PSUV9",57,0)
 .S $P(PSUIVA(PSUDIV),U,2)=$P($G(PSUIVA(PSUDIV)),U,2)+REC
"RTN","PSUV9",58,0)
 ;
"RTN","PSUV9",59,0)
 Q
"RTN","PSUV9",60,0)
 ;
"RTN","PSUV9",61,0)
LVPDES ;Gather CHEMO Destroyed data
"RTN","PSUV9",62,0)
 ;
"RTN","PSUV9",63,0)
 I PSUTYP="C",PSUP="P" D                        ;CHEMO's destroyed
"RTN","PSUV9",64,0)
 .N DES
"RTN","PSUV9",65,0)
 .S DES=$P($G(PSUAMIS(PSUDIV,PSUCT)),U,31)
"RTN","PSUV9",66,0)
 .S $P(PSUIVA(PSUDIV),U,3)=$P($G(PSUIVA(PSUDIV)),U,3)+DES
"RTN","PSUV9",67,0)
 ;
"RTN","PSUV9",68,0)
 Q
"RTN","PSUV9",69,0)
 ;
"RTN","PSUV9",70,0)
LVPCAN ;Gather CHEMO Cancelled data
"RTN","PSUV9",71,0)
 ;
"RTN","PSUV9",72,0)
 I PSUTYP="C",PSUP="P" D                         ;CHEMO's cancelled
"RTN","PSUV9",73,0)
 .N CAN
"RTN","PSUV9",74,0)
 .S CAN=$P($G(PSUAMIS(PSUDIV,PSUCT)),U,32)
"RTN","PSUV9",75,0)
 .S $P(PSUIVA(PSUDIV),U,4)=$P($G(PSUIVA(PSUDIV)),U,4)+CAN
"RTN","PSUV9",76,0)
 ;
"RTN","PSUV9",77,0)
 Q
"RTN","PSUV9",78,0)
 ;
"RTN","PSUV9",79,0)
LVPNET ;Calculate net amount of CHEMO's Dispensed
"RTN","PSUV9",80,0)
 ;
"RTN","PSUV9",81,0)
 I PSUTYP="C",PSUP="P" D
"RTN","PSUV9",82,0)
 .N NET
"RTN","PSUV9",83,0)
 .S NET=$P($G(PSUAMIS(PSUDIV,PSUCT)),U,11)
"RTN","PSUV9",84,0)
 .S $P(PSUIVA(PSUDIV),U,5)=$P($G(PSUIVA(PSUDIV)),U,5)+NET
"RTN","PSUV9",85,0)
 Q
"RTN","PSUV9",86,0)
 ;
"RTN","PSUV9",87,0)
LVPTOT ;Calculate Total cost
"RTN","PSUV9",88,0)
 ;
"RTN","PSUV9",89,0)
 N NDIS,COST,PSUOR1
"RTN","PSUV9",90,0)
 S PSUCTA=0
"RTN","PSUV9",91,0)
 F  S PSUCTA=$O(PSUAMIS(PSUDIV,PSUCTA)) Q:PSUCTA=""  D
"RTN","PSUV9",92,0)
 .S PSUOR1=$P(PSUAMIS(PSUDIV,PSUCTA),U,4)_"^"_$P(PSUAMIS(PSUDIV,PSUCTA),U,8)
"RTN","PSUV9",93,0)
 .Q:(PSUOR1'=PSUOR)
"RTN","PSUV9",94,0)
 .S NDIS=$P($G(PSUAMIS(PSUDIV,PSUCTA)),U,33)
"RTN","PSUV9",95,0)
 .S COST=$P($G(PSUAMIS(PSUDIV,PSUCTA)),U,22)
"RTN","PSUV9",96,0)
 .S $P(PSUIVA(PSUDIV),U,6)=$P($G(PSUIVA(PSUDIV)),U,6)+(NDIS*$G(COST))
"RTN","PSUV9",97,0)
 .;
"RTN","PSUV9",98,0)
 .;Truncate cost to 2 decimal places
"RTN","PSUV9",99,0)
 .N A,B,C
"RTN","PSUV9",100,0)
 .;
"RTN","PSUV9",101,0)
 .I $P(PSUIVA(PSUDIV),U,6)'["." D  Q
"RTN","PSUV9",102,0)
 ..S $P(PSUIVA(PSUDIV),U,6)=$P(PSUIVA(PSUDIV),U,6)_".00"
"RTN","PSUV9",103,0)
 .;
"RTN","PSUV9",104,0)
 .S A=$F($P(PSUIVA(PSUDIV),U,6),".")  ;Find 1st position after decimal
"RTN","PSUV9",105,0)
 .;
"RTN","PSUV9",106,0)
 .S B=$E($P(PSUIVA(PSUDIV),U,6),1,(A-1)) ;Extract dollars and decimal
"RTN","PSUV9",107,0)
 .;
"RTN","PSUV9",108,0)
 .S C=$E($P(PSUIVA(PSUDIV),U,6),A,(A+1)) ;Extract cents after decimal
"RTN","PSUV9",109,0)
 .I $L(C)'=2 S C=$E(C,1)_0
"RTN","PSUV9",110,0)
 .;
"RTN","PSUV9",111,0)
 .S $P(PSUIVA(PSUDIV),U,6)=B_C
"RTN","PSUV9",112,0)
 Q
"RTN","PSUV9",113,0)
 ;
"RTN","PSUV9",114,0)
CNET ;Calculate Cost per Net CHEMO's dispensed
"RTN","PSUV9",115,0)
 ;
"RTN","PSUV9",116,0)
 N CNET,TCOST
"RTN","PSUV9",117,0)
 ;
"RTN","PSUV9",118,0)
 S CNET=$P($G(PSUIVA(PSUDIV)),U,5)
"RTN","PSUV9",119,0)
 S TCOST=$P($G(PSUIVA(PSUDIV)),U,6)
"RTN","PSUV9",120,0)
 ;
"RTN","PSUV9",121,0)
 I CNET'="",CNET'=0,TCOST'="" D
"RTN","PSUV9",122,0)
 .S $P(PSUIVA(PSUDIV),U,7)=TCOST/CNET
"RTN","PSUV9",123,0)
 .;
"RTN","PSUV9",124,0)
 .;Truncate cost to 2 decimal places
"RTN","PSUV9",125,0)
 .N A,B,C
"RTN","PSUV9",126,0)
 .;
"RTN","PSUV9",127,0)
 .I $P(PSUIVA(PSUDIV),U,7)'["." D  Q
"RTN","PSUV9",128,0)
 ..S $P(PSUIVA(PSUDIV),U,7)=$P(PSUIVA(PSUDIV),U,7)_".00"
"RTN","PSUV9",129,0)
 .;
"RTN","PSUV9",130,0)
 .S A=$F($P(PSUIVA(PSUDIV),U,7),".")  ;Find 1st position after decimal
"RTN","PSUV9",131,0)
 .;
"RTN","PSUV9",132,0)
 .S B=$E($P(PSUIVA(PSUDIV),U,7),1,(A-1)) ;Extract dollars and decimal
"RTN","PSUV9",133,0)
 .;
"RTN","PSUV9",134,0)
 .S C=$E($P(PSUIVA(PSUDIV),U,7),A,(A+1)) ;Extract cents after decimal
"RTN","PSUV9",135,0)
 .I $L(C)'=2 S C=$E(C,1)_0
"RTN","PSUV9",136,0)
 .;
"RTN","PSUV9",137,0)
 .S $P(PSUIVA(PSUDIV),U,7)=B_C
"RTN","PSUV9",138,0)
 ;
"RTN","PSUV9",139,0)
 Q
"RTN","PSUV9",140,0)
 ;
"RTN","PSUV9",141,0)
TOTAL ;Add up column totals and place into ^XTMP global
"RTN","PSUV9",142,0)
 ;
"RTN","PSUV9",143,0)
 S PSUDI=0
"RTN","PSUV9",144,0)
 F  S PSUDI=$O(PSUIVA(PSUDI)) Q:PSUDI=""  D
"RTN","PSUV9",145,0)
 .S LDSP=$G(LDSP)+$P(PSUIVA(PSUDI),U,1)   ;Total CHEMO's dispensed
"RTN","PSUV9",146,0)
 .;
"RTN","PSUV9",147,0)
 .S LREC=$G(LREC)+$P(PSUIVA(PSUDI),U,2)   ;Total CHEMO's recycled
"RTN","PSUV9",148,0)
 .;
"RTN","PSUV9",149,0)
 .S LDES=$G(LDES)+$P(PSUIVA(PSUDI),U,3)   ;Total CHEMO's destroyed
"RTN","PSUV9",150,0)
 .;
"RTN","PSUV9",151,0)
 .S CLAN=$G(CLAN)+$P(PSUIVA(PSUDI),U,4)   ;Total CHEMO's cancelled
"RTN","PSUV9",152,0)
 .;
"RTN","PSUV9",153,0)
 .S NDSP=$G(NDSP)+$P(PSUIVA(PSUDI),U,5)   ;Total Net CHEMO's dispensed
"RTN","PSUV9",154,0)
 .;
"RTN","PSUV9",155,0)
 .S LTOT=$G(LTOT)+$P(PSUIVA(PSUDI),U,6)   ;Total of Total cost
"RTN","PSUV9",156,0)
 .;
"RTN","PSUV9",157,0)
 .I $G(NDSP) S CNDSP=$G(LTOT)/NDSP D
"RTN","PSUV9",158,0)
 ..I CNDSP'["." S CNDSP=CNDSP_".00" Q
"RTN","PSUV9",159,0)
 ..N A,B,C
"RTN","PSUV9",160,0)
 ..S A=$F(CNDSP,".")  ;Find 1st position after decimal
"RTN","PSUV9",161,0)
 ..S B=$E(CNDSP,1,(A-1))   ;Extract dollars and decimal
"RTN","PSUV9",162,0)
 ..S C=$E(CNDSP,A,(A+1))   ;Extract cents after decimal
"RTN","PSUV9",163,0)
 ..I $L(C)'=2 S C=$E(C,1)_0
"RTN","PSUV9",164,0)
 ..S CNDSP=B_C
"RTN","PSUV9",165,0)
 ;
"RTN","PSUV9",166,0)
 I '$D(LDSP) S LDSP=0
"RTN","PSUV9",167,0)
 I '$D(LREC) S LREC=0
"RTN","PSUV9",168,0)
 I '$D(LDES) S LDES=0
"RTN","PSUV9",169,0)
 I '$D(CLAN) S CLAN=0
"RTN","PSUV9",170,0)
 I '$D(NDSP) S NDSP=0
"RTN","PSUV9",171,0)
 I '$D(LTOT) S LTOT="0.00"
"RTN","PSUV9",172,0)
 I '$D(CNDSP) S CNDSP="0.00"
"RTN","PSUV9",173,0)
 ;
"RTN","PSUV9",174,0)
 S ^XTMP(PSUIVSUB,"CHTOT")=$G(LDSP)_U_$G(LREC)_U_$G(LDES)_U_$G(CLAN)_U_$G(NDSP)_U_$G(LTOT)_U_$G(CNDSP)
"RTN","PSUV9",175,0)
 ;
"RTN","PSUV9",176,0)
 Q
"RTN","PSUV9",177,0)
 ;
"RTN","PSUV9",178,0)
REC ;Place contents of arrays into ^XTMP globals
"RTN","PSUV9",179,0)
 ;
"RTN","PSUV9",180,0)
 M ^XTMP(PSUIVSUB,"CH",PSUDIV)=PSUIVA(PSUDIV)   ;CHEMO RECORDS
"RTN","PSUV9",181,0)
 ;
"RTN","PSUV9",182,0)
 Q
"VER")
8.0^22.2
"BLD",10709,6)
^20
**END**
**END**

