Released PSU*4*1 SEQ #19
Extracted from mail message
**KIDS**:PSU*4.0*1^

**INSTALL NAME**
PSU*4.0*1
"BLD",6121,0)
PSU*4.0*1^PHARMACY BENEFITS MANAGEMENT^0^3160418^y
"BLD",6121,1,0)
^^9^9^3160418^
"BLD",6121,1,1,0)
This patch addresses the following problem:
"BLD",6121,1,2,0)
  
"BLD",6121,1,3,0)
INC1244256
"BLD",6121,1,4,0)
                       The pharmacy patient IV report of the Pharmacy 
"BLD",6121,1,5,0)
Benefits Management (PBM) extract does not calculate values for returned, 
"BLD",6121,1,6,0)
destroyed, or canceled IV orders. This is because the inpatient option 
"BLD",6121,1,7,0)
Returns and Destroyed Entry (IV)(PSJI RETURNS) does not place a value for 
"BLD",6121,1,8,0)
the DAILY USAGE field that the PBM software is checking in order to add 
"BLD",6121,1,9,0)
the total number of returned, destroyed, or canceled IVs. 
"BLD",6121,4,0)
^9.64PA^^
"BLD",6121,6)
4^
"BLD",6121,6.3)
5
"BLD",6121,"KRN",0)
^9.67PA^8989.52^19
"BLD",6121,"KRN",.4,0)
.4
"BLD",6121,"KRN",.401,0)
.401
"BLD",6121,"KRN",.402,0)
.402
"BLD",6121,"KRN",.403,0)
.403
"BLD",6121,"KRN",.5,0)
.5
"BLD",6121,"KRN",.84,0)
.84
"BLD",6121,"KRN",3.6,0)
3.6
"BLD",6121,"KRN",3.8,0)
3.8
"BLD",6121,"KRN",9.2,0)
9.2
"BLD",6121,"KRN",9.8,0)
9.8
"BLD",6121,"KRN",9.8,"NM",0)
^9.68A^2^1
"BLD",6121,"KRN",9.8,"NM",2,0)
PSUV1^^0^B77562738
"BLD",6121,"KRN",9.8,"NM","B","PSUV1",2)

"BLD",6121,"KRN",19,0)
19
"BLD",6121,"KRN",19.1,0)
19.1
"BLD",6121,"KRN",101,0)
101
"BLD",6121,"KRN",409.61,0)
409.61
"BLD",6121,"KRN",771,0)
771
"BLD",6121,"KRN",870,0)
870
"BLD",6121,"KRN",8989.51,0)
8989.51
"BLD",6121,"KRN",8989.52,0)
8989.52
"BLD",6121,"KRN",8994,0)
8994
"BLD",6121,"KRN","B",.4,.4)

"BLD",6121,"KRN","B",.401,.401)

"BLD",6121,"KRN","B",.402,.402)

"BLD",6121,"KRN","B",.403,.403)

"BLD",6121,"KRN","B",.5,.5)

"BLD",6121,"KRN","B",.84,.84)

"BLD",6121,"KRN","B",3.6,3.6)

"BLD",6121,"KRN","B",3.8,3.8)

"BLD",6121,"KRN","B",9.2,9.2)

"BLD",6121,"KRN","B",9.8,9.8)

"BLD",6121,"KRN","B",19,19)

"BLD",6121,"KRN","B",19.1,19.1)

"BLD",6121,"KRN","B",101,101)

"BLD",6121,"KRN","B",409.61,409.61)

"BLD",6121,"KRN","B",771,771)

"BLD",6121,"KRN","B",870,870)

"BLD",6121,"KRN","B",8989.51,8989.51)

"BLD",6121,"KRN","B",8989.52,8989.52)

"BLD",6121,"KRN","B",8994,8994)

"BLD",6121,"QDEF")
^^^^NO^^^^NO^^NO
"BLD",6121,"QUES",0)
^9.62^^
"BLD",6121,"REQB",0)
^9.611^^
"MBREQ")
0
"PKG",541,-1)
1^1
"PKG",541,0)
PHARMACY BENEFITS MANAGEMENT^PSU^PHARMACY BENEFITS MANAGEMENT
"PKG",541,20,0)
^9.402P^^
"PKG",541,22,0)
^9.49I^1^1
"PKG",541,22,1,0)
4.0^3050622^3050826^66481
"PKG",541,22,1,"PAH",1,0)
1^3160418^1231
"PKG",541,22,1,"PAH",1,1,0)
^^9^9^3160418
"PKG",541,22,1,"PAH",1,1,1,0)
This patch addresses the following problem:
"PKG",541,22,1,"PAH",1,1,2,0)
  
"PKG",541,22,1,"PAH",1,1,3,0)
INC1244256
"PKG",541,22,1,"PAH",1,1,4,0)
                       The pharmacy patient IV report of the Pharmacy 
"PKG",541,22,1,"PAH",1,1,5,0)
Benefits Management (PBM) extract does not calculate values for returned, 
"PKG",541,22,1,"PAH",1,1,6,0)
destroyed, or canceled IV orders. This is because the inpatient option 
"PKG",541,22,1,"PAH",1,1,7,0)
Returns and Destroyed Entry (IV)(PSJI RETURNS) does not place a value for 
"PKG",541,22,1,"PAH",1,1,8,0)
the DAILY USAGE field that the PBM software is checking in order to add 
"PKG",541,22,1,"PAH",1,1,9,0)
the total number of returned, destroyed, or canceled IVs. 
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","PSUV1")
0^2^B77562738^B78186878
"RTN","PSUV1",1,0)
PSUV1 ;BIR/CFL - Extract Data of PBM IV Module ; 6/10/15 3:28pm
"RTN","PSUV1",2,0)
 ;;4.0;PHARMACY BENEFITS MANAGEMENT;**1**;MARCH, 2005;Build 5
"RTN","PSUV1",3,0)
 ;DBIAs
"RTN","PSUV1",4,0)
 ; Reference to file #55   supported by DBIA 2497
"RTN","PSUV1",5,0)
 ; Reference to file #59.5 supported by DBIA 2499
"RTN","PSUV1",6,0)
 ; Reference to file #40.8 supported by DBIA 2438
"RTN","PSUV1",7,0)
 ; Reference to file #7    supported by DBIA 2495
"RTN","PSUV1",8,0)
 ; Reference to file #49   supported by DBIA 10093
"RTN","PSUV1",9,0)
 ; Reference to file #52.6 supported by DBIA 436
"RTN","PSUV1",10,0)
 ; Reference to file #50   supported by DBIA 221
"RTN","PSUV1",11,0)
 ; Reference to file #52.7 supported by DBIA 437
"RTN","PSUV1",12,0)
 ; Reference to file #2    supported by DBIA 10035 and 2701
"RTN","PSUV1",13,0)
 ; Reference to file #200  supported by DBIA 10060
"RTN","PSUV1",14,0)
 ;
"RTN","PSUV1",15,0)
IVDATA ;Loop through IV data
"RTN","PSUV1",16,0)
 N PSUDOC1
"RTN","PSUV1",17,0)
 K PSUSSNA,PSUORDA
"RTN","PSUV1",18,0)
 ; *34 |==>
"RTN","PSUV1",19,0)
 S PSUIVDT=PSUSDT\1-.0001 ;use 1st day of extract for 'stop date' scan
"RTN","PSUV1",20,0)
 S PSUTEDT=PSUEDT\1+.2359
"RTN","PSUV1",21,0)
 F  S PSUIVDT=$O(^PS(55,"AIV",PSUIVDT)) Q:'PSUIVDT  D
"RTN","PSUV1",22,0)
 .S PSUPDA=""
"RTN","PSUV1",23,0)
 .F  S PSUPDA=$O(^PS(55,"AIV",PSUIVDT,PSUPDA)) Q:'PSUPDA  D
"RTN","PSUV1",24,0)
 ..S PSUODA=""
"RTN","PSUV1",25,0)
 ..F  S PSUODA=$O(^PS(55,"AIV",PSUIVDT,PSUPDA,PSUODA)) Q:'PSUODA  D
"RTN","PSUV1",26,0)
 ...S ^XTMP("PSU_"_PSUJOB,"PSUHLD",PSUODA)=""   ;should be the D0's for file 55.01 ; <==| *34
"RTN","PSUV1",27,0)
 ...S COUNT=0
"RTN","PSUV1",28,0)
 ...S PSUDIV=""
"RTN","PSUV1",29,0)
 ...K PSUIV
"RTN","PSUV1",30,0)
 ...; screen test patients
"RTN","PSUV1",31,0)
 ...Q:$$TESTPAT^PSUTL1(PSUPDA)
"RTN","PSUV1",32,0)
 ...S XX=$$VALI^PSUTL(55.01,"PSUPDA,PSUODA",.02) Q:XX>PSUTEDT  ;*34
"RTN","PSUV1",33,0)
 ...K PSUIV ;*34
"RTN","PSUV1",34,0)
 ...D GETS^PSUTL(55.01,"PSUPDA,PSUODA",".01;.02;.03;.04;.06;.08;.09;.22;104;106;108","PSUIV","I")
"RTN","PSUV1",35,0)
 ...;.01-Order num;.02-Start Dt;.03-Stop Dt;.04-Type;.06-Provider
"RTN","PSUV1",36,0)
 ...;104-Ward;106-Chemotherapy Type;108-Intermittent Syringe
"RTN","PSUV1",37,0)
 ...Q:'$D(PSUIV)
"RTN","PSUV1",38,0)
 ...;VMP OIFO BAY PINES;ELR;PSU*3*35 ADDED NEXT LINE
"RTN","PSUV1",39,0)
 ...Q:$G(PSUIV(.06,"I"))'>0
"RTN","PSUV1",40,0)
 ...S ^XTMP("PSU_"_PSUJOB,"PSUPIEN",PSUPDA)=""     ;Patient IEN's ;*34
"RTN","PSUV1",41,0)
 ...D MOVEI^PSUTL("PSUIV")
"RTN","PSUV1",42,0)
 ...S PSUIV(.02)=PSUIV(.02)\1
"RTN","PSUV1",43,0)
 ...S PSUIV(.03)=PSUIV(.03)\1
"RTN","PSUV1",44,0)
 ...I PSUIV(.22)'="" S PSUDIV=$$VALI^PSUTL(59.5,PSUIV(.22),.02)
"RTN","PSUV1",45,0)
 ...S PSUFAC=$$VALI^PSUTL(40.8,PSUDIV,1) S:PSUFAC="" PSUFAC=PSUSNDR
"RTN","PSUV1",46,0)
 ...S PSUFAC(PSUFAC)=""
"RTN","PSUV1",47,0)
 ...S PSUOUTP=$S(PSUIV(104)=.5:"Y",1:"N")
"RTN","PSUV1",48,0)
 ...S DFN=PSUPDA D PID^VADPT
"RTN","PSUV1",49,0)
 ...S PSUSSN=$TR(VA("PID"),"^-","")
"RTN","PSUV1",50,0)
 ...D ICN
"RTN","PSUV1",51,0)
 ...K PSUDOC
"RTN","PSUV1",52,0)
 ...D GETS^PSUTL(200,"PSUIV(.06)","9;29;53.5","PSUDOC","I")
"RTN","PSUV1",53,0)
 ...D MOVEI^PSUTL("PSUDOC")
"RTN","PSUV1",54,0)
 ...I $G(PSUDOC(9))="" S PSUVSSN1=999999999
"RTN","PSUV1",55,0)
 ...I $G(PSUDOC(9))'="" S PSUVSSN1=PSUDOC(9)
"RTN","PSUV1",56,0)
 ...S ^XTMP("PSU_"_PSUJOB,"PSUPDR",PSUVSSN1,PSUIV(.06))=""
"RTN","PSUV1",57,0)
 ...S (PSUPCLS,PSUSP1,PSUSP2)=""
"RTN","PSUV1",58,0)
 ...I $D(PSUDOC(53.5)),PSUDOC(53.5)'="" D
"RTN","PSUV1",59,0)
 ....S PSUPCLS=$$VALI^PSUTL(7,PSUDOC(53.5),1)
"RTN","PSUV1",60,0)
 ....I PSUPCLS="" S PSUPCLS=$$VALI^PSUTL(7,PSUDOC(53.5),.01)
"RTN","PSUV1",61,0)
 ...S PSUPSV=$S($L($G(PSUDOC(29))):$$VAL^PSUTL(49,PSUDOC(29),.01),1:"")
"RTN","PSUV1",62,0)
 ...S PSUPSV=$$UPPER^PSUTL(PSUPSV),PSUSERV=""
"RTN","PSUV1",63,0)
 ...I $L(PSUPSV),$D(PSECT(PSUPSV)) S PSUSERV=PSECT(PSUPSV)
"RTN","PSUV1",64,0)
 ...S SPECPTR=$$GET^XUA4A72(PSUIV(.06),PSUIVDT)
"RTN","PSUV1",65,0)
 ...S PSUSP1=$P($G(SPECPTR),U,3),PSUSP2=$P($G(SPECPTR),U,4)
"RTN","PSUV1",66,0)
 ...D OCCAMT
"RTN","PSUV1",67,0)
 ...I PSUFND D
"RTN","PSUV1",68,0)
 ....D GETRATE^PSUV2(PSUIV(.04))
"RTN","PSUV1",69,0)
 ....D SETTOT
"RTN","PSUV1",70,0)
 ....S RECTYP=""
"RTN","PSUV1",71,0)
 ....D ADDTIV
"RTN","PSUV1",72,0)
 ....D SOLUTN
"RTN","PSUV1",73,0)
 I $D(^XTMP(PSUIVSUB,"RECORDS")) D SETSUM^PSUV2
"RTN","PSUV1",74,0)
 Q
"RTN","PSUV1",75,0)
 ;
"RTN","PSUV1",76,0)
ICN ;Find patient ICN 
"RTN","PSUV1",77,0)
 ;
"RTN","PSUV1",78,0)
 N PSUPICN,PSUPICN1,PSUICN
"RTN","PSUV1",79,0)
 S PSUPTN=0
"RTN","PSUV1",80,0)
 I $G(PSUSSN),PSUSSN'="" D
"RTN","PSUV1",81,0)
 .F  S PSUPTN=$O(^DPT("SSN",PSUSSN,PSUPTN)) Q:PSUPTN=""  D
"RTN","PSUV1",82,0)
 ..S PSUPICN1=$$GETICN^MPIF001(PSUPTN) D
"RTN","PSUV1",83,0)
 ...I PSUPICN1'[-1 D
"RTN","PSUV1",84,0)
 ....S ^XTMP("PSU_"_PSUJOB,"PSUPICN")=PSUPICN1
"RTN","PSUV1",85,0)
 ...I PSUPICN1[-1 S ^XTMP("PSU_"_PSUJOB,"PSUPICN")=""
"RTN","PSUV1",86,0)
 Q
"RTN","PSUV1",87,0)
 ;
"RTN","PSUV1",88,0)
 ;
"RTN","PSUV1",89,0)
OCCAMT ;Calculate the number of dispensing occurrences
"RTN","PSUV1",90,0)
 S (PSUFND,PSUDISP,PSUPULL,OCC,PSUDISPT,PSURECT,PSUDEST,PSUCAN)=0
"RTN","PSUV1",91,0)
 F  S OCC=$O(^PS(55,PSUPDA,"IV",PSUODA,"LAB",OCC)) Q:'OCC  D
"RTN","PSUV1",92,0)
 .K PSUOCC
"RTN","PSUV1",93,0)
 .D GETS^PSUTL(55.1111,"PSUPDA,PSUODA,OCC","1;2;4;6","PSUOCC","I")
"RTN","PSUV1",94,0)
 .D MOVEI^PSUTL("PSUOCC")
"RTN","PSUV1",95,0)
 .S PSUOCC(1)=PSUOCC(1)\1
"RTN","PSUV1",96,0)
 .I PSUOCC(1)<PSUSDT!(PSUOCC(1)>PSUTEDT) Q  ;*34
"RTN","PSUV1",97,0)
 .S PSUFND=1
"RTN","PSUV1",98,0)
 .I $G(PSUOCC(6))=1,$G(PSUOCC(2))=1 D
"RTN","PSUV1",99,0)
 ..S PSUDISP=PSUDISP+$G(PSUOCC(4))
"RTN","PSUV1",100,0)
 ..S PSUDISPT=PSUDISP                        ;Total IV dispensed
"RTN","PSUV1",101,0)
 ..S PSUPULL=PSUPULL+$G(PSUOCC(4))
"RTN","PSUV1",102,0)
 ..S ^XTMP(PSUIVSUB,"TYPE_"_PSUIV(.04),PSUFAC)=PSUOCC(4)+$G(^XTMP(PSUIVSUB,"TYPE_"_PSUIV(.04),PSUFAC))
"RTN","PSUV1",103,0)
 ..I PSUOUTP="Y" D  ; Total outpatient IV's dispensed
"RTN","PSUV1",104,0)
 ...S ^XTMP(PSUIVSUB,"ODISP",PSUFAC)=$G(^XTMP(PSUIVSUB,"ODISP",PSUFAC))+PSUOCC(4)
"RTN","PSUV1",105,0)
 .;I PSUOCC(2)=2!(PSUOCC(2)=4) S PSUDISP=PSUDISP-PSUOCC(4)
"RTN","PSUV1",106,0)
 .I PSUOCC(2)=2 D
"RTN","PSUV1",107,0)
 ..S PSURECT=$G(PSURECT)+PSUOCC(4),PSUDISP=PSUDISP-PSUOCC(4)               ;Total IV Recycled
"RTN","PSUV1",108,0)
 .I PSUOCC(2)=3 D
"RTN","PSUV1",109,0)
 ..S PSUDEST=$G(PSUDEST)+PSUOCC(4),PSUDISP=PSUDISP-PSUOCC(4)               ;Total IV Destroyed
"RTN","PSUV1",110,0)
 .I PSUOCC(2)=4 D
"RTN","PSUV1",111,0)
 ..S PSUCAN=$G(PSUCAN)+PSUOCC(4),PSUDISP=PSUDISP-PSUOCC(4)                 ;Total IV Cancelled
"RTN","PSUV1",112,0)
 Q
"RTN","PSUV1",113,0)
SETTOT ;Set totals
"RTN","PSUV1",114,0)
 ; Total number of IV's ordered
"RTN","PSUV1",115,0)
 S ^XTMP(PSUIVSUB,"ORD",PSUFAC)=$G(^XTMP(PSUIVSUB,"ORD",PSUFAC))+1
"RTN","PSUV1",116,0)
 ; Total number of IV patients
"RTN","PSUV1",117,0)
 I '$D(^XTMP(PSUIVSUB,"PAT",PSUSSN,PSUFAC)) D
"RTN","PSUV1",118,0)
 .S ^XTMP(PSUIVSUB,"SSN",PSUFAC)=$G(^XTMP(PSUIVSUB,"SSN",PSUFAC))+1
"RTN","PSUV1",119,0)
 .S ^XTMP(PSUIVSUB,"PAT",PSUSSN,PSUFAC)=""
"RTN","PSUV1",120,0)
 .S PSUDIV=PSUFAC D GETDIV^PSUV3 I PSUDIVNM'="" D
"RTN","PSUV1",121,0)
 ..S ^XTMP("PSU_"_PSUJOB,"PSUDIV",PSUDIVNM,PSUSSN)=""  ;Pt demo summary
"RTN","PSUV1",122,0)
 .I PSUDIVNM="" S ^XTMP("PSU_"_PSUJOB,"PSUDIV",PSUDIV,PSUSSN)=""
"RTN","PSUV1",123,0)
 I PSUOUTP="Y" D
"RTN","PSUV1",124,0)
 .; Total outpatient IV's ordered
"RTN","PSUV1",125,0)
 .S ^XTMP(PSUIVSUB,"OORD",PSUFAC)=$G(^XTMP(PSUIVSUB,"OORD",PSUFAC))+1
"RTN","PSUV1",126,0)
 Q
"RTN","PSUV1",127,0)
ADDTIV ;Loop through each additive
"RTN","PSUV1",128,0)
 S (PSUNITS,ADTIV)=0
"RTN","PSUV1",129,0)
 F  S ADTIV=$O(^PS(55,PSUPDA,"IV",PSUODA,"AD",ADTIV)) Q:'ADTIV  D
"RTN","PSUV1",130,0)
 .K PSUADDTV,PSUGNRIC,PSUADD
"RTN","PSUV1",131,0)
 .D GETS^PSUTL(55.02,"PSUPDA,PSUODA,ADTIV",".01;.02","PSUADDTV","I")
"RTN","PSUV1",132,0)
 .D MOVEI^PSUTL("PSUADDTV")
"RTN","PSUV1",133,0)
 .D GETS^PSUTL(52.6,"PSUADDTV(.01)",".01;1;7","PSUGNRIC","I")
"RTN","PSUV1",134,0)
 .D MOVEI^PSUTL("PSUGNRIC")
"RTN","PSUV1",135,0)
 .S PSUPNAM=PSUGNRIC(.01)
"RTN","PSUV1",136,0)
 .S PSUDGU=$$VAL^PSUTL(52.6,PSUADDTV(.01),2)
"RTN","PSUV1",137,0)
 .S PSUDGDA=PSUGNRIC(1)
"RTN","PSUV1",138,0)
 .D GETS^PSUTL(50,"PSUDGDA",".01;2;20;21;22;25;31;51;52;3","PSUADD","I")
"RTN","PSUV1",139,0)
 .D MOVEI^PSUTL("PSUADD")
"RTN","PSUV1",140,0)
 .S PSUGNM=PSUADD(.01)
"RTN","PSUV1",141,0)
 .S PSUDCLS=PSUADD(2)
"RTN","PSUV1",142,0)
 .S PSUPRNM=PSUADD(21)
"RTN","PSUV1",143,0)
 .S PSUNDC=PSUADD(31)
"RTN","PSUV1",144,0)
 .S PSUNFI=PSUADD(51)
"RTN","PSUV1",145,0)
 .S PSUNADR=PSUADD(20)
"RTN","PSUV1",146,0)
 .S PSUNDCL=PSUADD(22)
"RTN","PSUV1",147,0)
 .S PSUDEA=PSUADD(3)
"RTN","PSUV1",148,0)
 .S PSUNAF=$S(PSUADD(52):"N/F",1:"")
"RTN","PSUV1",149,0)
 .D SETVAR
"RTN","PSUV1",150,0)
 .S PSUSTRN=+PSUADDTV(.02)
"RTN","PSUV1",151,0)
 .;
"RTN","PSUV1",152,0)
 .;DAM  Add AMIS Additive data
"RTN","PSUV1",153,0)
 .N PSUTDSP1
"RTN","PSUV1",154,0)
 .S PSUTDSP1=$G(PSUDISPT)*PSUSTRN       ;Total Additive units dispens
"RTN","PSUV1",155,0)
 .;
"RTN","PSUV1",156,0)
 .N PSURCY1
"RTN","PSUV1",157,0)
 .S PSURCY1=$G(PSURECT)*PSUSTRN         ;Total Additive units recycled
"RTN","PSUV1",158,0)
 .;
"RTN","PSUV1",159,0)
 .N PSUDES1
"RTN","PSUV1",160,0)
 .S PSUDES1=$G(PSUDEST)*PSUSTRN      ;Total Additive units destroyed
"RTN","PSUV1",161,0)
 .;
"RTN","PSUV1",162,0)
 .N PSUCAN1
"RTN","PSUV1",163,0)
 .S PSUCAN1=$G(PSUCAN)*PSUSTRN         ;Total Additive units cancelled
"RTN","PSUV1",164,0)
 .;END DAM
"RTN","PSUV1",165,0)
 .S PSUNITS=PSUDISP*PSUSTRN
"RTN","PSUV1",166,0)
 .S PSUBAGS=PSUPULL*PSUSTRN
"RTN","PSUV1",167,0)
 .S PSUDCST=PSUGNRIC(7)
"RTN","PSUV1",168,0)
 .S RECIND="A"
"RTN","PSUV1",169,0)
 .D CALC
"RTN","PSUV1",170,0)
 .D SETREC^PSUV2
"RTN","PSUV1",171,0)
 .D SETDRUG^PSUV2
"RTN","PSUV1",172,0)
 Q
"RTN","PSUV1",173,0)
SOLUTN ;Loop through each solution
"RTN","PSUV1",174,0)
 S (PSUNITS,SOLDA)=0 F  S SOLDA=$O(^PS(55,PSUPDA,"IV",PSUODA,"SOL",SOLDA)) Q:'SOLDA  D
"RTN","PSUV1",175,0)
 .K PSUSOL,GENRIC,SOLDRUG
"RTN","PSUV1",176,0)
 .D GETS^PSUTL(55.11,"PSUPDA,PSUODA,SOLDA",".01;1","PSUSOL","I")
"RTN","PSUV1",177,0)
 .D MOVEI^PSUTL("PSUSOL")
"RTN","PSUV1",178,0)
 .D GETS^PSUTL(52.7,"PSUSOL(.01)",".01;1;7","GENRIC","I")
"RTN","PSUV1",179,0)
 .D MOVEI^PSUTL("GENRIC")
"RTN","PSUV1",180,0)
 .S PSUPNAM=GENRIC(.01)
"RTN","PSUV1",181,0)
 .S PSUDGU="ML"
"RTN","PSUV1",182,0)
 .S PSUDGDA=GENRIC(1)
"RTN","PSUV1",183,0)
 .D GETS^PSUTL(50,"PSUDGDA",".01;2;20;21;22;25;31;51;52;3","SOLDRUG","I")
"RTN","PSUV1",184,0)
 .D MOVEI^PSUTL("SOLDRUG")
"RTN","PSUV1",185,0)
 .S PSUGNM=SOLDRUG(.01)
"RTN","PSUV1",186,0)
 .S PSUDCLS=SOLDRUG(2)
"RTN","PSUV1",187,0)
 .S PSUPRNM=SOLDRUG(21)
"RTN","PSUV1",188,0)
 .S PSUNDC=SOLDRUG(31)
"RTN","PSUV1",189,0)
 .S PSUNFI=SOLDRUG(51)
"RTN","PSUV1",190,0)
 .S PSUNADR=SOLDRUG(20)
"RTN","PSUV1",191,0)
 .S PSUNDCL=SOLDRUG(22)
"RTN","PSUV1",192,0)
 .S PSUDEA=SOLDRUG(3)
"RTN","PSUV1",193,0)
 .S PSUNAF=$S(SOLDRUG(52):"N/F",1:"")
"RTN","PSUV1",194,0)
 .D SETVAR
"RTN","PSUV1",195,0)
 .S VOLUME=+PSUSOL(1)
"RTN","PSUV1",196,0)
 .;
"RTN","PSUV1",197,0)
 .;DAM ADD AMIS SOLUTION DATA
"RTN","PSUV1",198,0)
 .N PSUTSOL1
"RTN","PSUV1",199,0)
 .S PSUTSOL1=$G(PSUDISPT)*VOLUME    ;Total Solution units dispense
"RTN","PSUV1",200,0)
 .;
"RTN","PSUV1",201,0)
 .N PSUTRS1
"RTN","PSUV1",202,0)
 .S PSUTRS1=$G(PSURECT)*VOLUME       ;Total Solution units recycl
"RTN","PSUV1",203,0)
 .;
"RTN","PSUV1",204,0)
 .N PSUTDS1
"RTN","PSUV1",205,0)
 .S PSUTDS1=$G(PSUDEST)*VOLUME     ;Total Solution units destroyed
"RTN","PSUV1",206,0)
 .;
"RTN","PSUV1",207,0)
 .N PSUTCS1
"RTN","PSUV1",208,0)
 .S PSUTCS1=$G(PSUCAN)*VOLUME        ;Total Solution units cancelled
"RTN","PSUV1",209,0)
 .;END DAM
"RTN","PSUV1",210,0)
 .S PSUNITS=PSUDISP*VOLUME
"RTN","PSUV1",211,0)
 .S PSUBAGS=PSUPULL*VOLUME
"RTN","PSUV1",212,0)
 .S PSUDCST=GENRIC(7)
"RTN","PSUV1",213,0)
 .S RECIND="S"
"RTN","PSUV1",214,0)
 .D CALC
"RTN","PSUV1",215,0)
 .D SETREC^PSUV2
"RTN","PSUV1",216,0)
 .D SETDRUG^PSUV2
"RTN","PSUV1",217,0)
 Q
"RTN","PSUV1",218,0)
SETVAR ;Setup common variables for IV Additives and Solutions
"RTN","PSUV1",219,0)
 I PSUGNM="" S PSUGNM="UNKNOWN GENERIC NAME"
"RTN","PSUV1",220,0)
 I PSUPRNM="" S PSUPRNM="UNKNOWN VA PRODUCT NAME"
"RTN","PSUV1",221,0)
 I PSUNDC="" S PSUNDC="No NDC"
"RTN","PSUV1",222,0)
 I PSUNFI=1 S PSUNFI="N/F"
"RTN","PSUV1",223,0)
 S (PSIVNFI,PSIVNFR)=""
"RTN","PSUV1",224,0)
 I $$VERSION^XPDUTL("PSN")'<4 D
"RTN","PSUV1",225,0)
 .S PSIVNFI=$$FORMI^PSNAPIS(PSUNADR,PSUNDCL)
"RTN","PSUV1",226,0)
 .S PSIVNFR=$$FORMR^PSNAPIS(PSUNADR,PSUNDCL)>0
"RTN","PSUV1",227,0)
 Q
"RTN","PSUV1",228,0)
CALC ;Do calculations for additives and solutions
"RTN","PSUV1",229,0)
 S ^XTMP(PSUIVSUB,"CST",PSUFAC)=(PSUNITS*PSUDCST)+$G(^XTMP(PSUIVSUB,"CST",PSUFAC))
"RTN","PSUV1",230,0)
 S RECTYP=""
"RTN","PSUV1",231,0)
 S COUNT=COUNT+1
"RTN","PSUV1",232,0)
 S:COUNT=1 RECTYP="P"
"RTN","PSUV1",233,0)
 I PSUOUTP="Y" D
"RTN","PSUV1",234,0)
 .S ^XTMP(PSUIVSUB,"OCST",PSUFAC)=(PSUDCST*PSUBAGS)+$G(^XTMP(PSUIVSUB,"OCST",PSUFAC))
"RTN","PSUV1",235,0)
 I PSUIV(.04)="P" D
"RTN","PSUV1",236,0)
 .S ^XTMP(PSUIVSUB,"SPIG",PSUFAC)=(PSUDCST*PSUBAGS)+$G(^XTMP(PSUIVSUB,"SPIG",PSUFAC))
"RTN","PSUV1",237,0)
 I PSUIV(.04)="A" D
"RTN","PSUV1",238,0)
 .S ^XTMP(PSUIVSUB,"SADM",PSUFAC)=(PSUDCST*PSUBAGS)+$G(^XTMP(PSUIVSUB,"SADM",PSUFAC))
"RTN","PSUV1",239,0)
 I PSUIV(.04)="H" D
"RTN","PSUV1",240,0)
 .S ^XTMP(PSUIVSUB,"SHYP",PSUFAC)=(PSUDCST*PSUBAGS)+$G(^XTMP(PSUIVSUB,"SHYP",PSUFAC))
"RTN","PSUV1",241,0)
 I PSUIV(.04)="S" D
"RTN","PSUV1",242,0)
 .S ^XTMP(PSUIVSUB,"SSYR",PSUFAC)=(PSUDCST*PSUBAGS)+$G(^XTMP(PSUIVSUB,"SSYR",PSUFAC))
"RTN","PSUV1",243,0)
 I PSUIV(.04)="C" D
"RTN","PSUV1",244,0)
 .S ^XTMP(PSUIVSUB,"SCHEM",PSUFAC)=(PSUDCST*PSUBAGS)+$G(^XTMP(PSUIVSUB,"SCHEM",PSUFAC))
"RTN","PSUV1",245,0)
 Q
"VER")
8.0^22.0
"BLD",6121,6)
^19
**END**
**END**

