Released PSX*2*76 SEQ #67
Extracted from mail message
**KIDS**:PSX*2.0*76^

**INSTALL NAME**
PSX*2.0*76
"BLD",8792,0)
PSX*2.0*76^CMOP^0^3140311^y
"BLD",8792,1,0)
^^12^12^3140311^
"BLD",8792,1,1,0)
This patch modifies the Consolidate Mail Outpatient Pharmacy (CMOP) v2.0 
"BLD",8792,1,2,0)
application as described below:
"BLD",8792,1,3,0)
 
"BLD",8792,1,4,0)
        1. A correction was made to make sure Bad Address Indicator(BAI) 
"BLD",8792,1,5,0)
is for error messages in mailman, when the BAI is set
"BLD",8792,1,6,0)
        2. A correction was made to the Data Dictionary for the input 
"BLD",8792,1,7,0)
transform and the description of The CMOP System file (550), fields were 
"BLD",8792,1,8,0)
Non-CS Days to Transmit (#11) and CS Days to Transmit (#12).
"BLD",8792,1,9,0)
        3. A correction was mad to the CMOP User Manual to update the Drug
"BLD",8792,1,10,0)
Enter/Edit (PSS Drug Enter/Edit) option.
"BLD",8792,1,11,0)
        4. A correction made to not duplicate Patient Address error
"BLD",8792,1,12,0)
message in Mailman messages
"BLD",8792,4,0)
^9.64PA^550^1
"BLD",8792,4,550,0)
550
"BLD",8792,4,550,2,0)
^9.641^550^1
"BLD",8792,4,550,2,550,0)
CMOP SYSTEM  (File-top level)
"BLD",8792,4,550,2,550,1,0)
^9.6411^12^2
"BLD",8792,4,550,2,550,1,11,0)
NON-CS DAYS TO TRANSMIT
"BLD",8792,4,550,2,550,1,12,0)
CS DAYS TO TRANSMIT
"BLD",8792,4,550,222)
y^n^p^^^^n^^n
"BLD",8792,4,550,224)

"BLD",8792,4,"APDD",550,550)

"BLD",8792,4,"APDD",550,550,11)

"BLD",8792,4,"APDD",550,550,12)

"BLD",8792,4,"B",550,550)

"BLD",8792,6.3)
5
"BLD",8792,"ABPKG")
n
"BLD",8792,"KRN",0)
^9.67PA^779.2^20
"BLD",8792,"KRN",.4,0)
.4
"BLD",8792,"KRN",.401,0)
.401
"BLD",8792,"KRN",.402,0)
.402
"BLD",8792,"KRN",.403,0)
.403
"BLD",8792,"KRN",.5,0)
.5
"BLD",8792,"KRN",.84,0)
.84
"BLD",8792,"KRN",3.6,0)
3.6
"BLD",8792,"KRN",3.8,0)
3.8
"BLD",8792,"KRN",9.2,0)
9.2
"BLD",8792,"KRN",9.8,0)
9.8
"BLD",8792,"KRN",9.8,"NM",0)
^9.68A^2^2
"BLD",8792,"KRN",9.8,"NM",1,0)
PSXMISC1^^0^B47206332
"BLD",8792,"KRN",9.8,"NM",2,0)
PSXBPSUT^^0^B6577149
"BLD",8792,"KRN",9.8,"NM","B","PSXBPSUT",2)

"BLD",8792,"KRN",9.8,"NM","B","PSXMISC1",1)

"BLD",8792,"KRN",19,0)
19
"BLD",8792,"KRN",19.1,0)
19.1
"BLD",8792,"KRN",101,0)
101
"BLD",8792,"KRN",409.61,0)
409.61
"BLD",8792,"KRN",771,0)
771
"BLD",8792,"KRN",779.2,0)
779.2
"BLD",8792,"KRN",870,0)
870
"BLD",8792,"KRN",8989.51,0)
8989.51
"BLD",8792,"KRN",8989.52,0)
8989.52
"BLD",8792,"KRN",8994,0)
8994
"BLD",8792,"KRN","B",.4,.4)

"BLD",8792,"KRN","B",.401,.401)

"BLD",8792,"KRN","B",.402,.402)

"BLD",8792,"KRN","B",.403,.403)

"BLD",8792,"KRN","B",.5,.5)

"BLD",8792,"KRN","B",.84,.84)

"BLD",8792,"KRN","B",3.6,3.6)

"BLD",8792,"KRN","B",3.8,3.8)

"BLD",8792,"KRN","B",9.2,9.2)

"BLD",8792,"KRN","B",9.8,9.8)

"BLD",8792,"KRN","B",19,19)

"BLD",8792,"KRN","B",19.1,19.1)

"BLD",8792,"KRN","B",101,101)

"BLD",8792,"KRN","B",409.61,409.61)

"BLD",8792,"KRN","B",771,771)

"BLD",8792,"KRN","B",779.2,779.2)

"BLD",8792,"KRN","B",870,870)

"BLD",8792,"KRN","B",8989.51,8989.51)

"BLD",8792,"KRN","B",8989.52,8989.52)

"BLD",8792,"KRN","B",8994,8994)

"BLD",8792,"QUES",0)
^9.62^^
"BLD",8792,"REQB",0)
^9.611^2^2
"BLD",8792,"REQB",1,0)
PSX*2.0*64^1
"BLD",8792,"REQB",2,0)
PSX*2.0*69^1
"BLD",8792,"REQB","B","PSX*2.0*64",1)

"BLD",8792,"REQB","B","PSX*2.0*69",2)

"FIA",550)
CMOP SYSTEM
"FIA",550,0)
^PSX(550,
"FIA",550,0,0)
550I
"FIA",550,0,1)
y^n^p^^^^n^^n
"FIA",550,0,10)

"FIA",550,0,11)

"FIA",550,0,"RLRO")

"FIA",550,0,"VR")
2.0^PSX
"FIA",550,550)
1
"FIA",550,550,11)

"FIA",550,550,12)

"MBREQ")
0
"PKG",82,-1)
1^1
"PKG",82,0)
CMOP^PSX^Consolidated Mail Outpatient Pharmacy
"PKG",82,20,0)
^9.402P^^
"PKG",82,22,0)
^9.49I^1^1
"PKG",82,22,1,0)
2.0^3091028^2970414^1
"PKG",82,22,1,"PAH",1,0)
76^3140311
"PKG",82,22,1,"PAH",1,1,0)
^^12^12^3140311
"PKG",82,22,1,"PAH",1,1,1,0)
This patch modifies the Consolidate Mail Outpatient Pharmacy (CMOP) v2.0 
"PKG",82,22,1,"PAH",1,1,2,0)
application as described below:
"PKG",82,22,1,"PAH",1,1,3,0)
 
"PKG",82,22,1,"PAH",1,1,4,0)
        1. A correction was made to make sure Bad Address Indicator(BAI) 
"PKG",82,22,1,"PAH",1,1,5,0)
is for error messages in mailman, when the BAI is set
"PKG",82,22,1,"PAH",1,1,6,0)
        2. A correction was made to the Data Dictionary for the input 
"PKG",82,22,1,"PAH",1,1,7,0)
transform and the description of The CMOP System file (550), fields were 
"PKG",82,22,1,"PAH",1,1,8,0)
Non-CS Days to Transmit (#11) and CS Days to Transmit (#12).
"PKG",82,22,1,"PAH",1,1,9,0)
        3. A correction was mad to the CMOP User Manual to update the Drug
"PKG",82,22,1,"PAH",1,1,10,0)
Enter/Edit (PSS Drug Enter/Edit) option.
"PKG",82,22,1,"PAH",1,1,11,0)
        4. A correction made to not duplicate Patient Address error
"PKG",82,22,1,"PAH",1,1,12,0)
message in Mailman messages
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
2
"RTN","PSXBPSUT")
0^2^B6577149^B5985053
"RTN","PSXBPSUT",1,0)
PSXBPSUT ;BIR/MFR - BPS (ECME) Utilities ;13 Mar 2002  10:31 AM
"RTN","PSXBPSUT",2,0)
 ;;2.0;CMOP;**48,63,65,69,76**;11 Apr 97;Build 5
"RTN","PSXBPSUT",3,0)
 ;Reference to ^PS(52.5, supported by DBIA #1978
"RTN","PSXBPSUT",4,0)
 ;Reference to ^PSOSULB1 supported by DBIA #2478
"RTN","PSXBPSUT",5,0)
 ;
"RTN","PSXBPSUT",6,0)
XMIT(REC) ; Checks if the prescription will be transmitted to CMOP or not
"RTN","PSXBPSUT",7,0)
 ; Input:  REC  - Pointer to SUSPENSE file (#52.5)
"RTN","PSXBPSUT",8,0)
 ; Output: XMIT - 0 - NO  /  1 - YES 
"RTN","PSXBPSUT",9,0)
 N VADM,DFN,RX,PSXOK,PSXBAOK,VAPA
"RTN","PSXBPSUT",10,0)
 I '$D(^PS(52.5,REC,0)) Q 0
"RTN","PSXBPSUT",11,0)
 I $P(^PS(52.5,REC,0),"^",7)="" Q 0
"RTN","PSXBPSUT",12,0)
 S RX=$P($G(^PS(52.5,REC,0)),"^",1) I RX="" Q 0
"RTN","PSXBPSUT",13,0)
 S DFN=$$GET1^DIQ(52,RX,2,"I") D DEM^VADPT I $G(VADM(6))'="" Q 0
"RTN","PSXBPSUT",14,0)
 D ADD^VADPT I (($G(VAPA(1))="")!($G(VAPA(4))="")!($P($G(VAPA(5)),"^",2)="")!($G(VAPA(6))'>0)!($P($G(VAPA(11)),"^",2)'>0)) Q 0
"RTN","PSXBPSUT",15,0)
 I ($P(^PS(52.5,REC,0),"^",3)'=DFN) Q 0
"RTN","PSXBPSUT",16,0)
 S PSXOK=0 D CHKDATA^PSXMISC1 I PSXOK Q 0
"RTN","PSXBPSUT",17,0)
 I '$$ADDROK^PSXMISC1(RX) Q 0  ;for PSX*2*69
"RTN","PSXBPSUT",18,0)
 Q 1
"RTN","PSXBPSUT",19,0)
 ;
"RTN","PSXBPSUT",20,0)
EXCEL() ; - Returns whether to capture data for Excel report.
"RTN","PSXBPSUT",21,0)
 ; Output: EXCEL = 1 - YES (capture data) / 0 - NO (DO NOT capture data)
"RTN","PSXBPSUT",22,0)
 ;
"RTN","PSXBPSUT",23,0)
 N EXCEL,DIR,DIRUT,DTOUT,DUOUT,DIROUT,Y
"RTN","PSXBPSUT",24,0)
 ;
"RTN","PSXBPSUT",25,0)
 S DIR(0)="Y",DIR("B")="NO",DIR("T")=DTIME W !
"RTN","PSXBPSUT",26,0)
 S DIR("A")="Do you want to capture report data for an Excel document"
"RTN","PSXBPSUT",27,0)
 S DIR("?")="^D HEXC^PSXBPSUT"
"RTN","PSXBPSUT",28,0)
 D ^DIR K DIR I $D(DIRUT)!$D(DTOUT)!$D(DUOUT)!$D(DIROUT) Q "^"
"RTN","PSXBPSUT",29,0)
 K DIROUT,DTOUT,DUOUT,DIRUT
"RTN","PSXBPSUT",30,0)
 S EXCEL=0 I Y S EXCEL=1
"RTN","PSXBPSUT",31,0)
 ;
"RTN","PSXBPSUT",32,0)
 ;Display Excel display message
"RTN","PSXBPSUT",33,0)
 I EXCEL=1 D EXMSG
"RTN","PSXBPSUT",34,0)
 ;
"RTN","PSXBPSUT",35,0)
 Q EXCEL
"RTN","PSXBPSUT",36,0)
 ;
"RTN","PSXBPSUT",37,0)
HEXC ; - 'Do you want to capture data...' prompt
"RTN","PSXBPSUT",38,0)
 W !!,"      Enter:  'Y'    -  To capture detail report data to transfer"
"RTN","PSXBPSUT",39,0)
 W !,"                        to an Excel document"
"RTN","PSXBPSUT",40,0)
 W !,"              '<CR>' -  To skip this option"
"RTN","PSXBPSUT",41,0)
 W !,"              '^'    -  To quit this option"
"RTN","PSXBPSUT",42,0)
 Q
"RTN","PSXBPSUT",43,0)
 ;
"RTN","PSXBPSUT",44,0)
 ;Display the message about capturing to an Excel file format
"RTN","PSXBPSUT",45,0)
 ; 
"RTN","PSXBPSUT",46,0)
EXMSG ;
"RTN","PSXBPSUT",47,0)
 W !!?5,"Before continuing, please set up your terminal to capture the"
"RTN","PSXBPSUT",48,0)
 W !?5,"detail report data. On some terminals, this can  be  done  by"
"RTN","PSXBPSUT",49,0)
 W !?5,"clicking  on the 'Tools' menu above, then click  on  'Capture"
"RTN","PSXBPSUT",50,0)
 W !?5,"Incoming  Data' to save to  Desktop. This  report  may take a"
"RTN","PSXBPSUT",51,0)
 W !?5,"while to run."
"RTN","PSXBPSUT",52,0)
 W !!?5,"Note: To avoid  undesired  wrapping of the data  saved to the"
"RTN","PSXBPSUT",53,0)
 W !?5,"      file, please enter '0;256;999' at the 'DEVICE:' prompt.",!
"RTN","PSXBPSUT",54,0)
 Q
"RTN","PSXBPSUT",55,0)
 ;
"RTN","PSXMISC1")
0^1^B47206332^B46713652
"RTN","PSXMISC1",1,0)
PSXMISC1 ;BIR/WPB,BAB-Transmission Data Validation ;MAR 1,2002@13:13:34
"RTN","PSXMISC1",2,0)
 ;;2.0;CMOP;**3,18,23,28,30,42,41,52,54,58,64,76**;11 Apr 97;Build 5
"RTN","PSXMISC1",3,0)
 ;Reference to ^PSDRUG(  supported by DBIA #1983
"RTN","PSXMISC1",4,0)
 ;Reference to ^PS(52.5, supported by DBIA #1978
"RTN","PSXMISC1",5,0)
 ;Reference to ^PSRX(    supported by DBIA #1977
"RTN","PSXMISC1",6,0)
 ;Reference to ^PS(55,   supported by DBIA #2228
"RTN","PSXMISC1",7,0)
 ;Reference to PROD2^PSNAPIS supported by DBIA #2531
"RTN","PSXMISC1",8,0)
 ;Reference to ^PSSLOCK supported by DBIA #2789
"RTN","PSXMISC1",9,0)
 ;Reference to CHKRX^PSOBAI supported by DBIA #4910
"RTN","PSXMISC1",10,0)
CHKDATA ;checks the data elements in PSRX before putting the rx in 550.2
"RTN","PSXMISC1",11,0)
 Q:'$D(^PS(52.5,REC,0))
"RTN","PSXMISC1",12,0)
 K DRUGCHK,PSXRXERR,PSXDGST,WARNS
"RTN","PSXMISC1",13,0)
 S (RXN,PSXPTR)=$P($G(^PS(52.5,REC,0)),"^",1) I PSXPTR="" S PSXOK=8 Q
"RTN","PSXMISC1",14,0)
 D PSOL^PSSLOCK(RXN) S PSOMSG=+PSOMSG ; sets PSOMSG
"RTN","PSXMISC1",15,0)
 I ($P(^PS(52.5,REC,0),U,3)'=XDFN)!($P(^PSRX(PSXPTR,0),U,2)'=XDFN) S PSXOK=8 Q
"RTN","PSXMISC1",16,0)
 I '$D(^PSRX(PSXPTR,0)) S PSXOK=8 Q
"RTN","PSXMISC1",17,0)
 S RXNUM=$P($G(^PSRX(PSXPTR,0)),"^",6),RXEX=$P($G(^PSRX(PSXPTR,0)),"^",1)
"RTN","PSXMISC1",18,0)
 I $G(^PSDRUG(RXNUM,"ND"))'="" D
"RTN","PSXMISC1",19,0)
 .S PTRA=$P($G(^PSDRUG(RXNUM,"ND")),U,1),PTRB=$P($G(^PSDRUG(RXNUM,"ND")),U,3)
"RTN","PSXMISC1",20,0)
 .I $G(PTRA)'="" S ZX=$$PROD2^PSNAPIS(PTRA,PTRB),DRUGCHK=$P($G(ZX),"^",3)
"RTN","PSXMISC1",21,0)
 S:$G(DRUGCHK)'="" PSXDGST=$P(ZX,"^",2)_"^"_$P(ZX,"^")
"RTN","PSXMISC1",22,0)
 I '$D(DRUGCHK) S DRUGCHK=0
"RTN","PSXMISC1",23,0)
 S:'$D(^PSDRUG("AQ",RXNUM)) PSXOK=1
"RTN","PSXMISC1",24,0)
 S:$G(DRUGCHK)'=1 PSXOK=1
"RTN","PSXMISC1",25,0)
 I $P(^PSDRUG(RXNUM,2),"^",3)'["O" S PSXOK=1,PSXCK=RXNUM D UNMARK^PSXUTL
"RTN","PSXMISC1",26,0)
 S:$P($G(^PSRX(PSXPTR,"STA")),U,1)'=5 PSXOK=5
"RTN","PSXMISC1",27,0)
 ;gets the fill number by ordering thru the refill node for the last
"RTN","PSXMISC1",28,0)
 ;refill number
"RTN","PSXMISC1",29,0)
 S FILNUM=0 F REF=0:0 S REF=$O(^PSRX(PSXPTR,1,REF)) Q:REF'>0  S:REF>0 FILNUM=REF S:REF="" FILNUM=0
"RTN","PSXMISC1",30,0)
 ;I $G(PSXFLAG)=2 S PSXOK=0 Q
"RTN","PSXMISC1",31,0)
 S RXF=FILNUM
"RTN","PSXMISC1",32,0)
 S REL=$S(RXF>0:$P($G(^PSRX(RXN,1,RXF,0)),U,18),RXF=0:$P($G(^PSRX(RXN,2)),U,13),1:"") I $G(REL)'="" S PSXOK=6
"RTN","PSXMISC1",33,0)
 S:((PSXOK=0)&(FILNUM>0)&($P($G(^PSRX(PSXPTR,1,FILNUM,0)),"^",2)'="M")) PSXOK=3
"RTN","PSXMISC1",34,0)
 S:((PSXOK=0)&(FILNUM'>0)&($P($G(^PSRX(PSXPTR,0)),"^",11)'="M")) PSXOK=3
"RTN","PSXMISC1",35,0)
 I $G(^PS(52.5,REC,"P"))="1" S PSXOK=4
"RTN","PSXMISC1",36,0)
 S PSXDIV=$S(FILNUM=0:$P($G(^PSRX(PSXPTR,2)),U,9),FILNUM>0:$P($G(^PSRX(PSXPTR,1,FILNUM,0)),"^",9),1:"")
"RTN","PSXMISC1",37,0)
 ;If trans div does not match Rx div eliminate
"RTN","PSXMISC1",38,0)
 I PSXDIV'=PSOSITE S PSXOK=7 Q
"RTN","PSXMISC1",39,0)
 ; Changes for Controlled subs 
"RTN","PSXMISC1",40,0)
 N PSXCSC,PSXCSD S PSXCSRX=""
"RTN","PSXMISC1",41,0)
 S PSXCSC=$P($G(^PSDRUG(RXNUM,0)),"^",3)
"RTN","PSXMISC1",42,0)
 ;Can't trans DEA schedule 1 or 2
"RTN","PSXMISC1",43,0)
 I $G(PSXCSC)[1!$G(PSXCSC)[2 S PSXOK=10 Q
"RTN","PSXMISC1",44,0)
 ;If CS must be DEA 3-5 to qualify
"RTN","PSXMISC1",45,0)
 F PSXCSD=3:1:5 I PSXCSC[PSXCSD S PSXCSRX=1
"RTN","PSXMISC1",46,0)
 ;If not CS drug and CS trans eliminate
"RTN","PSXMISC1",47,0)
 I ($G(PSXCSRX)<1)&($G(PSXCS)=1) S PSXOK=9 Q
"RTN","PSXMISC1",48,0)
 ;If CS drug and not CS trans eliminate
"RTN","PSXMISC1",49,0)
 I ($G(PSXCSRX)=1)&($G(PSXCS)<1) S PSXOK=9 Q
"RTN","PSXMISC1",50,0)
 ; Checks for do not mail and expiration date thereof
"RTN","PSXMISC1",51,0)
 ; moved to under NOGO
"RTN","PSXMISC1",52,0)
 ;
"RTN","PSXMISC1",53,0)
 G:PSXOK'=0 STOP
"RTN","PSXMISC1",54,0)
NOGO ;any rx that does not pass the following checks will not be transmitted
"RTN","PSXMISC1",55,0)
 ;and an error message will be generated and sent to the user who
"RTN","PSXMISC1",56,0)
 ;initiated the transmission.  All that pass the checks will be sent.
"RTN","PSXMISC1",57,0)
 S RXERR=0,PSXRXERR=RXEX_"^"_RXF
"RTN","PSXMISC1",58,0)
 I RXEX[" " S RXERR=13,PSXRXERR=PSXRXERR_"^"_RXERR
"RTN","PSXMISC1",59,0)
 S QTY=$S(RXF>0:$P($G(^PSRX(RXN,1,RXF,0)),U,4),RXF=0:$P($G(^PSRX(RXN,0)),U,7),1:"") G:$G(QTY)'=""&($G(QTY)>0)&(QTY?.N)!(QTY?.N1".".N) NG1 S RXERR=2,PSXRXERR=PSXRXERR_"^"_RXERR
"RTN","PSXMISC1",60,0)
NG1 S PHY=$S(RXF>0:$P($G(^PSRX(RXN,1,RXF,0)),U,17),RXF=0:$P($G(^PSRX(RXN,0)),U,4),1:"") I PHY="" S RXERR=3,PSXRXERR=PSXRXERR_"^"_RXERR
"RTN","PSXMISC1",61,0)
 S DAYS=$S(RXF>0:$P($G(^PSRX(RXN,1,RXF,0)),U,10),RXF=0:$P($G(^PSRX(RXN,0)),U,8),1:"") I (DAYS'>0)!(DAYS="") S RXERR=4,PSXRXERR=PSXRXERR_"^"_RXERR
"RTN","PSXMISC1",62,0)
 S PHARCLK=$S(RXF>0:$P($G(^PSRX(RXN,1,RXF,0)),U,7),RXF=0:$P($G(^PSRX(RXN,0)),U,16),1:"") I PHARCLK="" S RXERR=9,PSXRXERR=PSXRXERR_"^"_RXERR
"RTN","PSXMISC1",63,0)
 S DRUG=$P($G(^PSRX(RXN,0)),U,6),PSTAT=$P($G(^(0)),U,3),FDATE=$P($G(^PSRX(RXN,2)),U,2)
"RTN","PSXMISC1",64,0)
 D TSTSIG
"RTN","PSXMISC1",65,0)
 S DFN=$P($G(^PSRX(RXN,0)),U,2) D ADD^VADPT I (($G(VAPA(1))="")!($G(VAPA(4))="")!($P($G(VAPA(5)),"^",2)="")!($G(VAPA(6))'>0)!($P($G(VAPA(11)),"^",2)'>0)),(($$BADADR^DGUTL3(DFN))'>0) S RXERR=10,PSXRXERR=PSXRXERR_"^"_RXERR
"RTN","PSXMISC1",66,0)
 D DEM^VADPT
"RTN","PSXMISC1",67,0)
 I VADM(1)["MERGING" S RXERR=17,PSXRXERR=PSXRXERR_"^"_RXERR
"RTN","PSXMISC1",68,0)
 ;MVP OIFO BAY PINES;ELR;PSX*2*52  CHANGED RXERR FROM 10 TO 19. ADDED NEW ERROR IN PSXERR
"RTN","PSXMISC1",69,0)
 I $G(VA("PID"))["000-00" S RXERR=19,PSXRXERR=PSXRXERR_"^"_RXERR ; SSN ["000-00" indicates test patient
"RTN","PSXMISC1",70,0)
 S (CNTR,XC,DUPFLG)=0,DUPRX="" F  S XC=$O(^PSRX("B",RXEX,XC)) Q:XC'>0  S CNTR=CNTR+1,DUPRX=DUPRX_"^"_XC
"RTN","PSXMISC1",71,0)
 I CNTR>1 D
"RTN","PSXMISC1",72,0)
 .Q:$P(DUPRX,"^",3)=""
"RTN","PSXMISC1",73,0)
 .F I2=2:1 S I1=$P(DUPRX,"^",I2) Q:I1=""  S PSREC=$O(^PS(52.5,"B",I1,"")) Q:$G(PSREC)'>0  S:($P(^PS(52.5,PSREC,0),"^",2)<PSXDTRG&($P(^PS(52.5,PSREC,0),"^",7)="Q")) DUPFLG=1
"RTN","PSXMISC1",74,0)
 S:$G(DUPFLG)>0 PSXRXERR=PSXRXERR_"^"_"14"
"RTN","PSXMISC1",75,0)
 K CNTR,XC,DUPRX,I2,I1,PSREC,DUPFLG
"RTN","PSXMISC1",76,0)
 I $D(^PSRX(PSXPTR,4,0)) D
"RTN","PSXMISC1",77,0)
 .S RXERR=""
"RTN","PSXMISC1",78,0)
 .S ZX=0 F  S ZX=$O(^PSRX(PSXPTR,4,ZX)) Q:ZX'>0  D
"RTN","PSXMISC1",79,0)
 ..I $P(^PSRX(PSXPTR,4,ZX,0),"^",3)=RXF&($P(^PSRX(PSXPTR,4,ZX,0),"^",4)'=3) S RXERR=12
"RTN","PSXMISC1",80,0)
 ..I $P(^PSRX(PSXPTR,4,ZX,0),"^",3)=RXF&($P(^PSRX(PSXPTR,4,ZX,0),"^",4)=3) S RXERR=""
"RTN","PSXMISC1",81,0)
 .I RXERR'="" S PSXRXERR=PSXRXERR_"^"_RXERR
"RTN","PSXMISC1",82,0)
 I DRUG="" S RXERR=5,PSXRXERR=PSXRXERR_"^"_RXERR
"RTN","PSXMISC1",83,0)
 I DRUG S WARNS=$P(^PSDRUG(DRUG,0),"^",8) D
"RTN","PSXMISC1",84,0)
 .;IF USING NEW WARNING SOURCE, LENGTH OF OLD WARNINGS DOESN'T MATTER
"RTN","PSXMISC1",85,0)
 .I '$D(PSSWSITE) S PSSWSITE=+$O(^PS(59.7,0))
"RTN","PSXMISC1",86,0)
 .I $P($G(^PS(59.7,PSSWSITE,10)),"^",10)="N" Q
"RTN","PSXMISC1",87,0)
 .I $G(WARNS) S:$L(WARNS)>11 RXERR=16,PSXRXERR=PSXRXERR_"^"_RXERR
"RTN","PSXMISC1",88,0)
 I SIG="" S RXERR=6,PSXRXERR=PSXRXERR_"^"_RXERR
"RTN","PSXMISC1",89,0)
 I PSTAT="" S RXERR=7,PSXRXERR=PSXRXERR_"^"_RXERR
"RTN","PSXMISC1",90,0)
 I FDATE'?7N S RXERR=8,PSXRXERR=PSXRXERR_"^"_RXERR
"RTN","PSXMISC1",91,0)
 I '$$MAILOK(RXN) D
"RTN","PSXMISC1",92,0)
 . S COM="Removed from CMOP Suspense - Mail Status Change" D NOW^%DTC S DTTM=% K % D ACTLOG^PSXRPPL
"RTN","PSXMISC1",93,0)
 . D DELETE^PSXRPPL S PSXOK=1
"RTN","PSXMISC1",94,0)
 . ;MVP OIFO BAY PINES;ELR;PSX*2*5 DELETE MM MSG FOR DO NOT MAIL
"RTN","PSXMISC1",95,0)
 . ;S RXERR=15,PSXRXERR=PSXRXERR_"^"_RXERR ;mail message to users
"RTN","PSXMISC1",96,0)
 I $D(^TMP($J,"PSXBAI",DFN)),'$G(^TMP($J,"PSXBAI",DFN)) D
"RTN","PSXMISC1",97,0)
 . S PSXOK=8
"RTN","PSXMISC1",98,0)
 . D CHKACT(PSXPTR)
"RTN","PSXMISC1",99,0)
 . I '$G(PSXFIRST) K PSXRXERR Q
"RTN","PSXMISC1",100,0)
 . S COM="Bad Address Indicator or Foreign Address. Not removed from CMOP Suspense" D NOW^%DTC S DTTM=% K % D ACTLOG^PSXRPPL
"RTN","PSXMISC1",101,0)
 . S RXERR=20,PSXRXERR=PSXRXERR_"^"_RXERR ;mail message to users
"RTN","PSXMISC1",102,0)
PSOMSG I +PSOMSG=0 S RXERR=18,PSXRXERR=PSXRXERR_"^"_RXERR ; from PSSLOCK
"RTN","PSXMISC1",103,0)
 I $P($G(PSXRXERR),"^",3)'="" S PSXOK=8 D ER7^PSXERR
"RTN","PSXMISC1",104,0)
STOP K DAYS,DRUG,FDATE,PHARCLK,PHY,PSTAT,QTY,RXERR,RXEX,SIG,VAPA(1),DRUGCHK,PTRA,PTRB,REL,RXNUM,PHARCLK1,ZX,VAPA(4),VAPA(5),VAPA(6)
"RTN","PSXMISC1",105,0)
 Q
"RTN","PSXMISC1",106,0)
 ;
"RTN","PSXMISC1",107,0)
TSTSIG ; include testing for BAD characters in SIG
"RTN","PSXMISC1",108,0)
 I $P(^PSRX(RXN,"SIG"),"^",2)'>0 S SIG=$P(^PSRX(RXN,"SIG"),"^") D TSTCHAR
"RTN","PSXMISC1",109,0)
 I $P(^PSRX(RXN,"SIG"),"^",2)=1 N L S L=0 F  S L=$O(^PSRX(RXN,"SIG1",L)) Q:L'>0  S SIG=$G(^PSRX(RXN,"SIG1",L,0)) D TSTCHAR Q:SIG=""
"RTN","PSXMISC1",110,0)
 Q
"RTN","PSXMISC1",111,0)
TSTCHAR ; test each character of SIG for certain characters
"RTN","PSXMISC1",112,0)
 N I,C
"RTN","PSXMISC1",113,0)
 I '$D(^TMP($J,"PSXCHAR")) D
"RTN","PSXMISC1",114,0)
 . F I=0:1:31 S ^TMP($J,"PSXCHAR",I)=""
"RTN","PSXMISC1",115,0)
 . F I=92,94,124,127 S ^TMP($J,"PSXCHAR",I)=""
"RTN","PSXMISC1",116,0)
 F I=1:1:$L(SIG) S C=$A($E(SIG,I)) I $D(^TMP($J,"PSXCHAR",C)) S SIG="" Q
"RTN","PSXMISC1",117,0)
 Q
"RTN","PSXMISC1",118,0)
MAILOK(TRX) ; return 1 if patient still in mail status & ok to CMOP
"RTN","PSXMISC1",119,0)
 N PSOMDT,PSOMC,DFN
"RTN","PSXMISC1",120,0)
 S DFN=$P(^PSRX(TRX,0),"^",2),PSOMDT=$P($G(^PS(55,DFN,0)),"^",5),PSOMC=$P($G(^PS(55,DFN,0)),"^",3)
"RTN","PSXMISC1",121,0)
 I (PSOMC>1&(PSOMDT>DT))!(PSOMC>1&(PSOMDT<1)) Q 0
"RTN","PSXMISC1",122,0)
 Q 1
"RTN","PSXMISC1",123,0)
ADDROK(TRX) ; return 1 if not foreign and not bad address indicator 
"RTN","PSXMISC1",124,0)
 N DFN,PSOFORGN
"RTN","PSXMISC1",125,0)
 S DFN=$P($G(^PSRX(TRX,0)),"^",2) I DFN="" Q:0
"RTN","PSXMISC1",126,0)
 ;BHW;PSX*2*64;Changed Quit below from Q:+(^TMP... to Q +(^TMP...
"RTN","PSXMISC1",127,0)
 I $D(^TMP($J,"PSXBAI",DFN)) Q +(^TMP($J,"PSXBAI",DFN))
"RTN","PSXMISC1",128,0)
 D ADD^VADPT
"RTN","PSXMISC1",129,0)
 S PSOFORGN=$P($G(VAPA(25)),"^",2) I PSOFORGN'="",PSOFORGN'["UNITED STATES" S PSOFORGN=1
"RTN","PSXMISC1",130,0)
 I PSOFORGN S ^TMP($J,"PSXBAI",DFN)=0 Q 0
"RTN","PSXMISC1",131,0)
 I $T(CHKRX^PSOBAI)']"" S ^TMP($J,"PSXBAI",DFN)=1 Q 1
"RTN","PSXMISC1",132,0)
 N PSORX,PSOBADR
"RTN","PSXMISC1",133,0)
 S PSORX=TRX
"RTN","PSXMISC1",134,0)
 S PSOBADR=$$CHKRX^PSOBAI(PSORX)
"RTN","PSXMISC1",135,0)
 I '$P(PSOBADR,"^") S ^TMP($J,"PSXBAI",DFN)=1 Q 1
"RTN","PSXMISC1",136,0)
 I $P(PSOBADR,"^",2)=1 S ^TMP($J,"PSXBAI",DFN)=1 Q 1
"RTN","PSXMISC1",137,0)
 S ^TMP($J,"PSXBAI",DFN)=0
"RTN","PSXMISC1",138,0)
 Q 0
"RTN","PSXMISC1",139,0)
 ;
"RTN","PSXMISC1",140,0)
CHKACT(RXN) ; SEE IF FILL IS ALREADY ON ACTIVITY LOG FOR FOREIGN OR BAD ADDRESS
"RTN","PSXMISC1",141,0)
 N JJ,RFCNT,XX,COM
"RTN","PSXMISC1",142,0)
 S PSXFIRST=1
"RTN","PSXMISC1",143,0)
 S COM="Bad Address Indicator or Foreign Address."
"RTN","PSXMISC1",144,0)
 S RFCNT=0 F RF=0:0 S RF=$O(^PSRX(RXN,1,RF)) Q:'RF  S RFCNT=$S(RF<6:RF,1:RF+1)
"RTN","PSXMISC1",145,0)
 S JJ=0 F  S JJ=$O(^PSRX(RXN,"A",JJ)) Q:'JJ  S XX=$G(^PSRX(RXN,"A",JJ,0)) I $P(XX,"^",4)=RFCNT,$P(XX,"^",5)[COM S PSXFIRST=0 Q
"RTN","PSXMISC1",146,0)
 Q
"VER")
8.0^22.0
"^DD",550,550,11,0)
NON-CS DAYS TO TRANSMIT^NJ2,0X^^2;1^K:+X'=X!(X>10)!(X<0)!(X?.E1"."1.N) X
"^DD",550,550,11,3)
Type a number between 0 and 10, 0 Decimal Digits
"^DD",550,550,11,21,0)
^^2^2^3140124^
"^DD",550,550,11,21,1,0)
The number of days into the future the NON-CS process will look to pick up
"^DD",550,550,11,21,2,0)
prescriptions for a patient already in the transmission.
"^DD",550,550,11,"DT")
3140124
"^DD",550,550,12,0)
CS DAYS TO TRANSMIT^NJ2,0X^^2;2^K:+X'=X!(X>10)!(X<0)!(X?.E1"."1.N) X
"^DD",550,550,12,3)
Type a number between 0 and 10, 0 Decimal Digits
"^DD",550,550,12,21,0)
^^2^2^3021204^
"^DD",550,550,12,21,1,0)
The number of days into the future the CS process will look to pick up
"^DD",550,550,12,21,2,0)
prescriptions for a patient already in the transmission.
"^DD",550,550,12,"DT")
3140124
"BLD",8792,6)
^67
**END**
**END**

