Released PSX*2*77 SEQ #68
Extracted from mail message
**KIDS**:PSX*2.0*77^

**INSTALL NAME**
PSX*2.0*77
"BLD",9273,0)
PSX*2.0*77^CMOP^0^3151110^y
"BLD",9273,1,0)
^^1^1^3140922^
"BLD",9273,1,1,0)
HAPE EDI Revenue project - NCPDP Continuous Maintenance Standards
"BLD",9273,4,0)
^9.64PA^^0
"BLD",9273,6.3)
3
"BLD",9273,"INIT")

"BLD",9273,"KRN",0)
^9.67PA^779.2^20
"BLD",9273,"KRN",.4,0)
.4
"BLD",9273,"KRN",.401,0)
.401
"BLD",9273,"KRN",.402,0)
.402
"BLD",9273,"KRN",.403,0)
.403
"BLD",9273,"KRN",.5,0)
.5
"BLD",9273,"KRN",.84,0)
.84
"BLD",9273,"KRN",3.6,0)
3.6
"BLD",9273,"KRN",3.8,0)
3.8
"BLD",9273,"KRN",9.2,0)
9.2
"BLD",9273,"KRN",9.8,0)
9.8
"BLD",9273,"KRN",9.8,"NM",0)
^9.68A^2^2
"BLD",9273,"KRN",9.8,"NM",1,0)
PSXBPSMS^^0^B21102458
"BLD",9273,"KRN",9.8,"NM",2,0)
PSXMSGS^^0^B29772543
"BLD",9273,"KRN",9.8,"NM","B","PSXBPSMS",1)

"BLD",9273,"KRN",9.8,"NM","B","PSXMSGS",2)

"BLD",9273,"KRN",19,0)
19
"BLD",9273,"KRN",19.1,0)
19.1
"BLD",9273,"KRN",101,0)
101
"BLD",9273,"KRN",409.61,0)
409.61
"BLD",9273,"KRN",771,0)
771
"BLD",9273,"KRN",779.2,0)
779.2
"BLD",9273,"KRN",870,0)
870
"BLD",9273,"KRN",8989.51,0)
8989.51
"BLD",9273,"KRN",8989.52,0)
8989.52
"BLD",9273,"KRN",8994,0)
8994
"BLD",9273,"KRN","B",.4,.4)

"BLD",9273,"KRN","B",.401,.401)

"BLD",9273,"KRN","B",.402,.402)

"BLD",9273,"KRN","B",.403,.403)

"BLD",9273,"KRN","B",.5,.5)

"BLD",9273,"KRN","B",.84,.84)

"BLD",9273,"KRN","B",3.6,3.6)

"BLD",9273,"KRN","B",3.8,3.8)

"BLD",9273,"KRN","B",9.2,9.2)

"BLD",9273,"KRN","B",9.8,9.8)

"BLD",9273,"KRN","B",19,19)

"BLD",9273,"KRN","B",19.1,19.1)

"BLD",9273,"KRN","B",101,101)

"BLD",9273,"KRN","B",409.61,409.61)

"BLD",9273,"KRN","B",771,771)

"BLD",9273,"KRN","B",779.2,779.2)

"BLD",9273,"KRN","B",870,870)

"BLD",9273,"KRN","B",8989.51,8989.51)

"BLD",9273,"KRN","B",8989.52,8989.52)

"BLD",9273,"KRN","B",8994,8994)

"BLD",9273,"QDEF")
^^^^NO^^^^NO^^NO
"BLD",9273,"QUES",0)
^9.62^^
"BLD",9273,"REQB",0)
^9.611^2^2
"BLD",9273,"REQB",1,0)
PSX*2.0*48^2
"BLD",9273,"REQB",2,0)
PSX*2.0*41^2
"BLD",9273,"REQB","B","PSX*2.0*41",2)

"BLD",9273,"REQB","B","PSX*2.0*48",1)

"MBREQ")
0
"PKG",534,-1)
1^1
"PKG",534,0)
CMOP^PSX
"PKG",534,20,0)
^9.402P^^
"PKG",534,22,0)
^9.49I^1^1
"PKG",534,22,1,0)
2.0^2990901^3061113^66481
"PKG",534,22,1,"PAH",1,0)
77^3151110
"PKG",534,22,1,"PAH",1,1,0)
^^1^1^3151110
"PKG",534,22,1,"PAH",1,1,1,0)
HAPE EDI Revenue project - NCPDP Continuous Maintenance Standards
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
2
"RTN","PSXBPSMS")
0^1^B21102458^B11444984
"RTN","PSXBPSMS",1,0)
PSXBPSMS ;BIRM/BSR - BPS (ECME) Utilities ;10/29/98  2:13 PM
"RTN","PSXBPSMS",2,0)
 ;;2.0;CMOP;**48,77**;11 Apr 97;Build 3
"RTN","PSXBPSMS",3,0)
 ;Reference to $$RXFLDT^PSOBPSUT supported by IA 4701
"RTN","PSXBPSMS",4,0)
 ;
"RTN","PSXBPSMS",5,0)
EN ;Main entry point.
"RTN","PSXBPSMS",6,0)
 N EMCNT,DFN,ORCNT,PATCNT,DIV,RX,RFL,DFN,SSN,PATNM,PTLST,VADM
"RTN","PSXBPSMS",7,0)
 K ^TMP("PSXEPHOUT",$J)
"RTN","PSXBPSMS",8,0)
 S ^XTMP("PSXBPSMS",0)=$$FMADD^XLFDT(DT,35)_"^"_DT
"RTN","PSXBPSMS",9,0)
 S DIV="",(EMCNT,ORCNT,PATCNT)=0
"RTN","PSXBPSMS",10,0)
 F  S DIV=$O(^TMP("PSXEPHIN",$J,DIV)) Q:DIV=""  D
"RTN","PSXBPSMS",11,0)
 .D HEADER(DIV)
"RTN","PSXBPSMS",12,0)
 .S RX="" F  S RX=$O(^TMP("PSXEPHIN",$J,DIV,RX)) Q:RX=""  D
"RTN","PSXBPSMS",13,0)
 ..S RFL=+$G(^TMP("PSXEPHIN",$J,DIV,RX))
"RTN","PSXBPSMS",14,0)
 ..S ^XTMP("PSXBPSMS",1,RX,RFL,DT)=""
"RTN","PSXBPSMS",15,0)
 ..S DFN=+$P(^PSRX(RX,0),"^",2) D DEM^VADPT
"RTN","PSXBPSMS",16,0)
 ..S SSN=$E($P(VADM(2),U),6,9),PATNM=(VADM(1))
"RTN","PSXBPSMS",17,0)
 ..S ORCNT=$G(ORCNT)+1 D PATCNT(PATNM_SSN)
"RTN","PSXBPSMS",18,0)
 ..D FORMAT
"RTN","PSXBPSMS",19,0)
 .D FOOTER(DIV)
"RTN","PSXBPSMS",20,0)
 D MAIL,CLEAN
"RTN","PSXBPSMS",21,0)
 Q
"RTN","PSXBPSMS",22,0)
 ;
"RTN","PSXBPSMS",23,0)
 ; Format Row
"RTN","PSXBPSMS",24,0)
FORMAT ;
"RTN","PSXBPSMS",25,0)
 N LTXT
"RTN","PSXBPSMS",26,0)
 S LTXT=$$GET1^DIQ(52,RX,.01)_"/"_RFL
"RTN","PSXBPSMS",27,0)
 S $E(LTXT,17)=$E(PATNM,1,18)_"("_SSN_")",$E(LTXT,42)=$E($$GET1^DIQ(52,RX,6),1,23)
"RTN","PSXBPSMS",28,0)
 S $E(LTXT,67)=$$TRANS(RX,RFL)
"RTN","PSXBPSMS",29,0)
 D STORELN(LTXT)
"RTN","PSXBPSMS",30,0)
 Q
"RTN","PSXBPSMS",31,0)
 ;
"RTN","PSXBPSMS",32,0)
 ;Count patients.
"RTN","PSXBPSMS",33,0)
PATCNT(NAMSSN) ;
"RTN","PSXBPSMS",34,0)
 I '$D(PTLST(NAMSSN)) D
"RTN","PSXBPSMS",35,0)
 .S PTLST(NAMSSN)=""
"RTN","PSXBPSMS",36,0)
 .S PATCNT=$G(PATCNT)+1
"RTN","PSXBPSMS",37,0)
 Q
"RTN","PSXBPSMS",38,0)
 ;
"RTN","PSXBPSMS",39,0)
 ;Build header.
"RTN","PSXBPSMS",40,0)
HEADER(DIV) ;
"RTN","PSXBPSMS",41,0)
 D STORELN("Division: "_$$GET1^DIQ(59,DIV,.01))
"RTN","PSXBPSMS",42,0)
 D STORELN($TR($J("",79)," ","-"))
"RTN","PSXBPSMS",43,0)
 D STORELN("                                                                NOT TRANSMITTED")
"RTN","PSXBPSMS",44,0)
 D STORELN("RX#/Fill        PATIENT(LAST4)           DRUG                     1ST DT  #DAYS")
"RTN","PSXBPSMS",45,0)
 D STORELN($TR($J("",79)," ","-"))
"RTN","PSXBPSMS",46,0)
 Q
"RTN","PSXBPSMS",47,0)
 ;       
"RTN","PSXBPSMS",48,0)
 ;Output patient count & prescriptions count & division number
"RTN","PSXBPSMS",49,0)
FOOTER(DIVN) ;
"RTN","PSXBPSMS",50,0)
 D STORELN(" ")
"RTN","PSXBPSMS",51,0)
 D STORELN("Total "_$$GET1^DIQ(59,DIVN,.01)_": "_PATCNT_" Patients and "_ORCNT_" Prescriptions.")
"RTN","PSXBPSMS",52,0)
 D STORELN(" ")
"RTN","PSXBPSMS",53,0)
 K PTLST S (ORCNT,PATCNT)=0
"RTN","PSXBPSMS",54,0)
 Q
"RTN","PSXBPSMS",55,0)
 ;
"RTN","PSXBPSMS",56,0)
 ;Build and Send email to provider.
"RTN","PSXBPSMS",57,0)
MAIL ;
"RTN","PSXBPSMS",58,0)
 N PSBMSG,M1,Y,USER,XMTEXT,XMDUZ,XMSUB,XMY
"RTN","PSXBPSMS",59,0)
 S PSBMSG(1)="The prescriptions listed in this message did not transmit to CMOP for one of"
"RTN","PSXBPSMS",60,0)
 S PSBMSG(2)="the reasons below:"
"RTN","PSXBPSMS",61,0)
 S PSBMSG(3)=" "
"RTN","PSXBPSMS",62,0)
 S PSBMSG(4)="        A response from the third party payer was not received"
"RTN","PSXBPSMS",63,0)
 S PSBMSG(5)=" "
"RTN","PSXBPSMS",64,0)
 S PSBMSG(6)="        OR"
"RTN","PSXBPSMS",65,0)
 S PSBMSG(7)=" "
"RTN","PSXBPSMS",66,0)
 S PSBMSG(8)="        The prescriptions are non-billable in VistA"
"RTN","PSXBPSMS",67,0)
 S PSBMSG(9)=" "
"RTN","PSXBPSMS",68,0)
 S PSBMSG(10)="The prescriptions will remain in the CMOP queue and will transmit when the"
"RTN","PSXBPSMS",69,0)
 S PSBMSG(11)="response from the third party payer is received, or the non-billable issue"
"RTN","PSXBPSMS",70,0)
 S PSBMSG(12)="is resolved.  Examples of non-billable issues are prescriptions for"
"RTN","PSXBPSMS",71,0)
 S PSBMSG(13)="sensitive medications that need Release of Information and prescriptions"
"RTN","PSXBPSMS",72,0)
 S PSBMSG(14)="for non-billable drugs (e.g., OTC products for CHAMPVA and TRICARE patients)."
"RTN","PSXBPSMS",73,0)
 S PSBMSG(15)=" "
"RTN","PSXBPSMS",74,0)
 S M1=16
"RTN","PSXBPSMS",75,0)
 S Y="" F  S Y=$O(^TMP("PSXEPHOUT",$J,"M",Y)) Q:Y=""  D
"RTN","PSXBPSMS",76,0)
 .S PSBMSG(M1)=$P(^TMP("PSXEPHOUT",$J,"M",Y),"^"),M1=M1+1
"RTN","PSXBPSMS",77,0)
 ; Send email to all users who hold a security key
"RTN","PSXBPSMS",78,0)
 S USER=0
"RTN","PSXBPSMS",79,0)
 I $D(^XUSEC("PSXMAIL")) D
"RTN","PSXBPSMS",80,0)
 .F  S USER=$O(^XUSEC("PSXMAIL",USER)) Q:'USER  S XMY(USER)=""
"RTN","PSXBPSMS",81,0)
 E  D
"RTN","PSXBPSMS",82,0)
 .F  S USER=$O(^XUSEC("PSXCMOPMGR",USER)) Q:'USER  S XMY(USER)=""
"RTN","PSXBPSMS",83,0)
 ;
"RTN","PSXBPSMS",84,0)
 N DIV,SITES
"RTN","PSXBPSMS",85,0)
 S DIV="",SITES=""
"RTN","PSXBPSMS",86,0)
 F  S DIV=$O(^TMP("PSXEPHIN",$J,DIV)) Q:DIV=""  S SITES=SITES_$$GET1^DIQ(59,DIV_",",.01,"E")_","
"RTN","PSXBPSMS",87,0)
 S XMSUB=$E("ePharmacy CMOP Not TRANSMITTED Rxs - "_$E(SITES,1,$L(SITES)-1),1,65)
"RTN","PSXBPSMS",88,0)
 S XMTEXT="PSBMSG(",XMDUZ=.5
"RTN","PSXBPSMS",89,0)
 D ^XMD
"RTN","PSXBPSMS",90,0)
 Q
"RTN","PSXBPSMS",91,0)
 ;
"RTN","PSXBPSMS",92,0)
 ;Store E-mail line for later use.
"RTN","PSXBPSMS",93,0)
STORELN(LINE) ;
"RTN","PSXBPSMS",94,0)
 S EMCNT=EMCNT+1
"RTN","PSXBPSMS",95,0)
 S ^TMP("PSXEPHOUT",$J,"M",EMCNT)=LINE
"RTN","PSXBPSMS",96,0)
 Q
"RTN","PSXBPSMS",97,0)
 ;
"RTN","PSXBPSMS",98,0)
TRANS(RX,RFL) ;
"RTN","PSXBPSMS",99,0)
 I '$G(RX) Q ""
"RTN","PSXBPSMS",100,0)
 I $G(RFL)="" Q ""
"RTN","PSXBPSMS",101,0)
 N TDT,CNT,FDT
"RTN","PSXBPSMS",102,0)
 S CNT=0,FDT=9999999
"RTN","PSXBPSMS",103,0)
 S TDT="" F  S TDT=$O(^XTMP("PSXBPSMS",1,RX,RFL,TDT)) Q:'TDT  D
"RTN","PSXBPSMS",104,0)
 . S CNT=CNT+1
"RTN","PSXBPSMS",105,0)
 S FDT=$O(^XTMP("PSXBPSMS",1,RX,RFL,""))
"RTN","PSXBPSMS",106,0)
 I FDT=9999999 S FDT="        "
"RTN","PSXBPSMS",107,0)
 E  S FDT=$E(FDT,4,5)_"/"_$E(FDT,6,7)_"/"_($E(FDT,2,3))
"RTN","PSXBPSMS",108,0)
 Q FDT_$E("    ",1,5-$L(CNT))_CNT
"RTN","PSXBPSMS",109,0)
 ;
"RTN","PSXBPSMS",110,0)
 ;Clean all remaining arrays and variables
"RTN","PSXBPSMS",111,0)
 ;Purge ^XTMP data older than 30 days
"RTN","PSXBPSMS",112,0)
CLEAN ;
"RTN","PSXBPSMS",113,0)
 K ^TMP("PSXEPHOUT",$J),^TMP("PSXEPHIN",$J)
"RTN","PSXBPSMS",114,0)
 ; Purge ^XTMP data older than 30 days
"RTN","PSXBPSMS",115,0)
 N FDT,RX,RFL,TDT
"RTN","PSXBPSMS",116,0)
 S FDT=$$FMADD^XLFDT(DT,-30)
"RTN","PSXBPSMS",117,0)
 S RX="" F  S RX=$O(^XTMP("PSXBPSMS",1,RX)) Q:'RX  D
"RTN","PSXBPSMS",118,0)
 . S RFL="" F  S RFL=$O(^XTMP("PSXBPSMS",1,RX,RFL)) Q:RFL=""  D
"RTN","PSXBPSMS",119,0)
 .. S TDT="" F  S TDT=$O(^XTMP("PSXBPSMS",1,RX,RFL,TDT)) Q:'TDT  D
"RTN","PSXBPSMS",120,0)
 ... I TDT<FDT K ^XTMP("PSXBPSMS",1,RX,RFL,TDT)
"RTN","PSXBPSMS",121,0)
 Q
"RTN","PSXMSGS")
0^2^B29772543^B24952454
"RTN","PSXMSGS",1,0)
PSXMSGS ;BIR/WPB - Miscellaneous Message Handler ;01 JUL 1997  1:55 PM
"RTN","PSXMSGS",2,0)
 ;;2.0;CMOP;**1,2,4,24,23,27,30,41,77**;11 Apr 97;Build 3
"RTN","PSXMSGS",3,0)
 ;Reference to ^PS(59    supported by DBIA #1976
"RTN","PSXMSGS",4,0)
 ;Reference to File #200 supported by DBIA #10060
"RTN","PSXMSGS",5,0)
 ;Reference to DIQ^PSODI supported by DBIA #4858
"RTN","PSXMSGS",6,0)
 ;Reference to STATUS^PSOBPSUT supported by DBIA #4701
"RTN","PSXMSGS",7,0)
 ;
"RTN","PSXMSGS",8,0)
CAN ;Q:'$D(^TMP("PSXCAN1",$J))
"RTN","PSXMSGS",9,0)
 S DV="" F  S DV=$O(^TMP("PSXCAN1",$J,DV)) Q:DV=""  S DIVN=$P(^PS(59,DV,0),"^") D PNM
"RTN","PSXMSGS",10,0)
 Q
"RTN","PSXMSGS",11,0)
PNM S XMSUB=DIVN_" CMOP Not Dispensed Rx List, ",XMDUZ=.5,XMDUN="CMOP Manager"
"RTN","PSXMSGS",12,0)
 D XMZ^XMA2 G:XMZ<0 CAN
"RTN","PSXMSGS",13,0)
 N SYM,RXN
"RTN","PSXMSGS",14,0)
 S LCNT=1,^XMB(3.9,XMZ,2,LCNT,0)="Not Dispensed Rx Report for the "_DIVN_" Division.",LCNT=LCNT+1
"RTN","PSXMSGS",15,0)
 S ^XMB(3.9,XMZ,2,LCNT,0)="",LCNT=LCNT+1
"RTN","PSXMSGS",16,0)
 S ^XMB(3.9,XMZ,2,LCNT,0)="The following prescriptions were not dispensed by the vendor:  ",LCNT=LCNT+1
"RTN","PSXMSGS",17,0)
 S ^XMB(3.9,XMZ,2,LCNT,0)="",LCNT=LCNT+1
"RTN","PSXMSGS",18,0)
 S DFN="" F  S DFN=$O(^TMP("PSXCAN1",$J,DV,DFN)) Q:DFN=""  S PNM=$P(^DPT(DFN,0),"^"),SSN1=$P(^DPT(DFN,0),"^",9),SPS=(47-$L(PNM)),PSXSSN=$E(SSN1,1,3)_"-"_$E(SSN1,4,5)_"-"_$E(SSN1,6,9) D
"RTN","PSXMSGS",19,0)
 .F I=1:1:SPS S SP=$G(SP)_" "
"RTN","PSXMSGS",20,0)
 .S ^XMB(3.9,XMZ,2,LCNT,0)="Patient: "_PNM_SP_"SSN: "_PSXSSN,LCNT=LCNT+1
"RTN","PSXMSGS",21,0)
 .S ^XMB(3.9,XMZ,2,LCNT,0)="",LCNT=LCNT+1
"RTN","PSXMSGS",22,0)
 .S RX1="" F  S RX1=$O(^TMP("PSXCAN1",$J,DV,DFN,RX1)) Q:RX1=""  D
"RTN","PSXMSGS",23,0)
 ..S NODE=^TMP("PSXCAN1",$J,DV,DFN,RX1)
"RTN","PSXMSGS",24,0)
 ..S REASON=$P(NODE,"^",6),BT=$P(NODE,"^",8),FIL=$P(NODE,"^",7)
"RTN","PSXMSGS",25,0)
 ..S RXN=$O(^PSRX("B",RX1,""))
"RTN","PSXMSGS",26,0)
 ..S SYM=$S(+$$RXAPI1(RXN,105,"I"):"$",1:"")_$$ECME(RXN)
"RTN","PSXMSGS",27,0)
 ..S FLL=$S(FIL>0:"REFILL "_FIL,FIL=0:"ORIGINAL",1:"")
"RTN","PSXMSGS",28,0)
 ..S DRGN=$S($P($G(NODE),"^",1)'="":$P(NODE,"^",1),1:"UNKNOWN")
"RTN","PSXMSGS",29,0)
 ..S DRGI=$P(NODE,"^",4),CMOPYN=$P(NODE,"^",5),QY=$P(NODE,"^",3)
"RTN","PSXMSGS",30,0)
 ..S ^XMB(3.9,XMZ,2,LCNT,0)="  Rx #: "_RX1_SYM_" "_$S(FIL'>0:"(ORG)",FIL>0:"(REF"_FIL_")",1:"")_"  Qty: "_QY_"  Trans #: "_BT,LCNT=LCNT+1
"RTN","PSXMSGS",31,0)
 ..S ^XMB(3.9,XMZ,2,LCNT,0)="  Drug: "_DRGN,LCNT=LCNT+1
"RTN","PSXMSGS",32,0)
 ..S ^XMB(3.9,XMZ,2,LCNT,0)="  Transmitted under CMOP ID: "_$G(DRGI),LCNT=LCNT+1
"RTN","PSXMSGS",33,0)
 ..S ^XMB(3.9,XMZ,2,LCNT,0)="  Reason: "_REASON,LCNT=LCNT+1
"RTN","PSXMSGS",34,0)
 ..I $G(CMOPYN)=1 S ^XMB(3.9,XMZ,2,LCNT,0)=" Note: Local Drug File entry is no longer MARKED for CMOP  ",LCNT=LCNT+1
"RTN","PSXMSGS",35,0)
 ..S:$P(NODE,"^",2)'=$G(DRGI) ^XMB(3.9,XMZ,2,LCNT,0)=" Note: Local Drug File entry is no longer MATCHED to transmitted CMOP I.D. ",LCNT=LCNT+1
"RTN","PSXMSGS",36,0)
 ..S ^XMB(3.9,XMZ,2,LCNT,0)="  ",LCNT=LCNT+1
"RTN","PSXMSGS",37,0)
 ..K CMOPYN,FLL,FIL,BT,REASON,DRGI,DRGN,QY,I,SP,SPS,SP1
"RTN","PSXMSGS",38,0)
 S ^XMB(3.9,XMZ,2,LCNT,0)="Instructions:  Prescriptions cannot be processed at CMOP for the reason listed",LCNT=LCNT+1
"RTN","PSXMSGS",39,0)
 S ^XMB(3.9,XMZ,2,LCNT,0)="above.  Please review the prescription and take the appropriate action(s).",LCNT=LCNT+1
"RTN","PSXMSGS",40,0)
 S ^XMB(3.9,XMZ,2,LCNT,0)="If you have any questions, contact your CMOP contact person.",LCNT=LCNT+1
"RTN","PSXMSGS",41,0)
 S ^XMB(3.9,XMZ,2,0)="^3.92A^"_LCNT_"^"_LCNT_"^"_DT,XMDUN="CMOP Manager"
"RTN","PSXMSGS",42,0)
 K XMY D GRP S XMDUZ=.5 D ENT1^XMD
"RTN","PSXMSGS",43,0)
 K XMY,XMDUZ,XMSUB,XMDUN,REASON,RXN,LCNT,XMZ,FILL,FIL,TDT,TDTM,BAT,DOMAIN,PTR,XPTR,FACDOM
"RTN","PSXMSGS",44,0)
 Q
"RTN","PSXMSGS",45,0)
INVREL S XMSUB="CMOP Release Return Problems",XMDUZ=DUZ,XMDUN="CMOP Manager"
"RTN","PSXMSGS",46,0)
 D XMZ^XMA2 G:XMZ<0 INVREL
"RTN","PSXMSGS",47,0)
 S LCNT=1
"RTN","PSXMSGS",48,0)
 S RXNN="" F  S RXNN=$O(^TMP($J,"PSXINV",RXNN)) Q:RXNN=""  D
"RTN","PSXMSGS",49,0)
 .S ^XMB(3.9,XMZ,2,LCNT,0)=RXNN_" has already been marked as processed",LCNT=LCNT+1
"RTN","PSXMSGS",50,0)
 S ^XMB(3.9,XMZ,2,0)="^3.92A^"_LCNT_"^"_LCNT_"^"_DT,XMDUN="CMOP Manager",XMDUZ=DUZ
"RTN","PSXMSGS",51,0)
 K XMY S XMY(DUZ)="" D ENT1^XMD
"RTN","PSXMSGS",52,0)
 Q
"RTN","PSXMSGS",53,0)
AUTOMSG N TSK D NOW^%DTC S DTE=$$FMTE^XLFDT(%,1),SITE=$P($G(PSXSYS),U,3) K %
"RTN","PSXMSGS",54,0)
 I $G(PSXCS)'=1 G NONCS ; If not controlled subs 
"RTN","PSXMSGS",55,0)
 D OPTSTAT^XUTMOPT("PSXR SCHEDULED CS TRANS",.TSK)
"RTN","PSXMSGS",56,0)
 S DTTM=$P($G(TSK(1)),U,2),NUM=+$P($G(TSK(1)),U,3),THRU=$$GET1^DIQ(550,+PSXSYS,12)
"RTN","PSXMSGS",57,0)
 G MSG1
"RTN","PSXMSGS",58,0)
NONCS ;
"RTN","PSXMSGS",59,0)
 D OPTSTAT^XUTMOPT("PSXR SCHEDULED NON-CS TRANS",.TSK)
"RTN","PSXMSGS",60,0)
 S DTTM=$P($G(TSK(1)),U,2),NUM=+$P($G(TSK(1)),U,3),THRU=$$GET1^DIQ(550,+PSXSYS,11)
"RTN","PSXMSGS",61,0)
MSG1 S XMDUZ=.5,XMSUB="CMOP "_$S($G(PSXCS)=1:"CS ",1:"")_"Auto-Transmission Schedule",LCNT=1
"RTN","PSXMSGS",62,0)
 I DTTM S Y=DTTM X ^DD("DD") S DTTM=Y I 1
"RTN","PSXMSGS",63,0)
 E  S DTTM="NONE - Canceled",(NUM,THRU)=""
"RTN","PSXMSGS",64,0)
 D XMZ^XMA2 G:XMZ<1 AUTOMSG
"RTN","PSXMSGS",65,0)
 S ^XMB(3.9,XMZ,2,LCNT,0)=$S(DTTM["NONE":"<CANCEL> ",1:"")_$S($G(PSXCS)=1:"CS ",1:"")_"Auto-transmission Schedule.",LCNT=LCNT+1
"RTN","PSXMSGS",66,0)
 S ^XMB(3.9,XMZ,2,LCNT,0)="",LCNT=LCNT+1
"RTN","PSXMSGS",67,0)
 S ^XMB(3.9,XMZ,2,LCNT,0)="Facility                       :  "_SITE,LCNT=LCNT+1
"RTN","PSXMSGS",68,0)
 S ^XMB(3.9,XMZ,2,LCNT,0)="Date Initiated                 :  "_$P(DTE,":",1,2),LCNT=LCNT+1
"RTN","PSXMSGS",69,0)
 S ^XMB(3.9,XMZ,2,LCNT,0)="Begin Automatic Transmissions  :  "_DTTM,LCNT=LCNT+1
"RTN","PSXMSGS",70,0)
 S ^XMB(3.9,XMZ,2,LCNT,0)="Number of days to transmit thru:  "_$S((($G(THRU)'>0)&(+NUM)):"Current date",1:$G(THRU)),LCNT=LCNT+1
"RTN","PSXMSGS",71,0)
 S ^XMB(3.9,XMZ,2,LCNT,0)="Scheduling Frequency (hours)   :  "_NUM,LCNT=LCNT+1
"RTN","PSXMSGS",72,0)
 S ^XMB(3.9,XMZ,2,LCNT,0)="Initiating Official            :  "_$$GET1^DIQ(200,DUZ,.01),LCNT=LCNT+1
"RTN","PSXMSGS",73,0)
 S ^XMB(3.9,XMZ,2,0)="^3.92A^"_LCNT_"^"_LCNT_"^"_DT,XMDUN="CMOP Manager"
"RTN","PSXMSGS",74,0)
 K XMY S XMDUZ=.5
"RTN","PSXMSGS",75,0)
 D GRP^PSXNOTE
"RTN","PSXMSGS",76,0)
 ;S XMY(DUZ)=""
"RTN","PSXMSGS",77,0)
 D ENT1^XMD
"RTN","PSXMSGS",78,0)
 Q
"RTN","PSXMSGS",79,0)
GRP I '$D(^XUSEC("PSXMAIL")) G GRP1
"RTN","PSXMSGS",80,0)
 F MDUZ=0:0 S MDUZ=$O(^XUSEC("PSXMAIL",MDUZ)) Q:MDUZ'>0  S XMY(MDUZ)="",XQA(MDUZ)=""
"RTN","PSXMSGS",81,0)
 K MDUZ
"RTN","PSXMSGS",82,0)
 G:'$D(XMY) GRP1
"RTN","PSXMSGS",83,0)
 Q
"RTN","PSXMSGS",84,0)
GRP1 F XDUZ=0:0 S XDUZ=$O(^XUSEC("PSXCMOPMGR",XDUZ)) Q:XDUZ'>0  S XMY(XDUZ)="",XQA(XDUZ)=""
"RTN","PSXMSGS",85,0)
 K XDUZ
"RTN","PSXMSGS",86,0)
 Q
"RTN","PSXMSGS",87,0)
 ;
"RTN","PSXMSGS",88,0)
RXAPI1(IEN,FLD,FORMAT) ;
"RTN","PSXMSGS",89,0)
 ; Use standard PRE APIs to get Prescription data
"RTN","PSXMSGS",90,0)
 ; Reference to DIQ^PSODI supported by DBIA #4858
"RTN","PSXMSGS",91,0)
 ;
"RTN","PSXMSGS",92,0)
 ; Input
"RTN","PSXMSGS",93,0)
 ;   IEN: Prescription file IEN
"RTN","PSXMSGS",94,0)
 ;   FLD: Prescription field
"RTN","PSXMSGS",95,0)
 ;   FORMAT: E-External (Default)
"RTN","PSXMSGS",96,0)
 ;           I-Internal
"RTN","PSXMSGS",97,0)
 ;           N-Do not return nulls       
"RTN","PSXMSGS",98,0)
 ; Output: Data from Prescription in requested format
"RTN","PSXMSGS",99,0)
 ;
"RTN","PSXMSGS",100,0)
 I '$G(IEN)!($G(FLD)="") Q ""
"RTN","PSXMSGS",101,0)
 N DIQ,DIC,PSXARR,X,Y,D0,PSODIY
"RTN","PSXMSGS",102,0)
 N I,J,C,DA,DRS,DIL,DI,DIQ1,PSXDIQ
"RTN","PSXMSGS",103,0)
 S PSXDIQ="PSXARR"
"RTN","PSXMSGS",104,0)
 S PSXDIQ(0)=$S($G(FORMAT)="":"E",1:FORMAT)
"RTN","PSXMSGS",105,0)
 D DIQ^PSODI(52,52,.FLD,.IEN,.PSXDIQ) ;DBIA 4858
"RTN","PSXMSGS",106,0)
 Q $S(PSXDIQ(0)="N":$G(PSXARR(52,IEN,FLD)),1:$G(PSXARR(52,IEN,FLD,PSXDIQ(0))))
"RTN","PSXMSGS",107,0)
 ;
"RTN","PSXMSGS",108,0)
ECME(RX) ;
"RTN","PSXMSGS",109,0)
 ; Returns "e" if last Rx/Refill is Electronically Billable (3rd party)
"RTN","PSXMSGS",110,0)
 ; Reference to STATUS^PSOBPSUT supported by DBIA #4701
"RTN","PSXMSGS",111,0)
 ;
"RTN","PSXMSGS",112,0)
 ; Input:
"RTN","PSXMSGS",113,0)
 ;     RX: Prescription IEN (required)
"RTN","PSXMSGS",114,0)
 ; Output:
"RTN","PSXMSGS",115,0)
 ;   Null: Not electronically billable to ePharmacy
"RTN","PSXMSGS",116,0)
 ;    'e': Electronically billable to ePharmacy
"RTN","PSXMSGS",117,0)
 ;
"RTN","PSXMSGS",118,0)
 I '$G(RX) Q ""
"RTN","PSXMSGS",119,0)
 Q $S($$STATUS^PSOBPSUT(RX)'="":"e",1:"")
"VER")
8.0^22.0
"BLD",9273,6)
^68
**END**
**END**

