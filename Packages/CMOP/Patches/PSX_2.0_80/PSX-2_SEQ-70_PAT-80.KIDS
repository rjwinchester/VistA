Released PSX*2*80 SEQ #70
Extracted from mail message
**KIDS**:PSX*2.0*80^

**INSTALL NAME**
PSX*2.0*80
"BLD",10179,0)
PSX*2.0*80^CMOP^0^3160519^y
"BLD",10179,1,0)
^^5^5^3160519^
"BLD",10179,1,1,0)
This patch modifies the Consolidate Mail Outpatient Pharmacy (CMOP) v2.0 
"BLD",10179,1,2,0)
application as described below:
"BLD",10179,1,3,0)
 
"BLD",10179,1,4,0)
     1. PSXR BATCH INQUIRY [View Transmission] Option was getting hung
"BLD",10179,1,5,0)
up when being run.
"BLD",10179,4,0)
^9.64PA^^
"BLD",10179,6.3)
4
"BLD",10179,"KRN",0)
^9.67PA^779.2^20
"BLD",10179,"KRN",.4,0)
.4
"BLD",10179,"KRN",.401,0)
.401
"BLD",10179,"KRN",.402,0)
.402
"BLD",10179,"KRN",.403,0)
.403
"BLD",10179,"KRN",.5,0)
.5
"BLD",10179,"KRN",.84,0)
.84
"BLD",10179,"KRN",3.6,0)
3.6
"BLD",10179,"KRN",3.8,0)
3.8
"BLD",10179,"KRN",9.2,0)
9.2
"BLD",10179,"KRN",9.8,0)
9.8
"BLD",10179,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",10179,"KRN",9.8,"NM",1,0)
PSXSTAT^^0^B27680486
"BLD",10179,"KRN",9.8,"NM","B","PSXSTAT",1)

"BLD",10179,"KRN",19,0)
19
"BLD",10179,"KRN",19.1,0)
19.1
"BLD",10179,"KRN",101,0)
101
"BLD",10179,"KRN",409.61,0)
409.61
"BLD",10179,"KRN",771,0)
771
"BLD",10179,"KRN",779.2,0)
779.2
"BLD",10179,"KRN",870,0)
870
"BLD",10179,"KRN",8989.51,0)
8989.51
"BLD",10179,"KRN",8989.52,0)
8989.52
"BLD",10179,"KRN",8994,0)
8994
"BLD",10179,"KRN","B",.4,.4)

"BLD",10179,"KRN","B",.401,.401)

"BLD",10179,"KRN","B",.402,.402)

"BLD",10179,"KRN","B",.403,.403)

"BLD",10179,"KRN","B",.5,.5)

"BLD",10179,"KRN","B",.84,.84)

"BLD",10179,"KRN","B",3.6,3.6)

"BLD",10179,"KRN","B",3.8,3.8)

"BLD",10179,"KRN","B",9.2,9.2)

"BLD",10179,"KRN","B",9.8,9.8)

"BLD",10179,"KRN","B",19,19)

"BLD",10179,"KRN","B",19.1,19.1)

"BLD",10179,"KRN","B",101,101)

"BLD",10179,"KRN","B",409.61,409.61)

"BLD",10179,"KRN","B",771,771)

"BLD",10179,"KRN","B",779.2,779.2)

"BLD",10179,"KRN","B",870,870)

"BLD",10179,"KRN","B",8989.51,8989.51)

"BLD",10179,"KRN","B",8989.52,8989.52)

"BLD",10179,"KRN","B",8994,8994)

"BLD",10179,"QDEF")
^^^^^^^^^^YES
"BLD",10179,"QUES",0)
^9.62^^
"BLD",10179,"REQB",0)
^9.611^1^1
"BLD",10179,"REQB",1,0)
PSX*2.0*41^1
"BLD",10179,"REQB","B","PSX*2.0*41",1)

"MBREQ")
0
"PKG",534,-1)
1^1
"PKG",534,0)
CMOP^PSX
"PKG",534,20,0)
^9.402P^^
"PKG",534,22,0)
^9.49I^1^1
"PKG",534,22,1,0)
2.0
"PKG",534,22,1,"PAH",1,0)
80^3160519
"PKG",534,22,1,"PAH",1,1,0)
^^5^5^3160519
"PKG",534,22,1,"PAH",1,1,1,0)
This patch modifies the Consolidate Mail Outpatient Pharmacy (CMOP) v2.0 
"PKG",534,22,1,"PAH",1,1,2,0)
application as described below:
"PKG",534,22,1,"PAH",1,1,3,0)
 
"PKG",534,22,1,"PAH",1,1,4,0)
     1. PSXR BATCH INQUIRY [View Transmission] Option was getting hung
"PKG",534,22,1,"PAH",1,1,5,0)
up when being run.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","PSXSTAT")
0^1^B27680486^B27758719
"RTN","PSXSTAT",1,0)
PSXSTAT ;BIR/WPB-Routine to Display Statistics ;08 APR 1997 2:06 PM
"RTN","PSXSTAT",2,0)
 ;;2.0;CMOP;**41,80**;11 Apr 97;Build 4
"RTN","PSXSTAT",3,0)
 ;Reference to ^PS(59 supported by DBIA #1976
"RTN","PSXSTAT",4,0)
 ;
"RTN","PSXSTAT",5,0)
EXIT K RETRAN,RETRANS,SENDR,STAT,TDATE,X,Y,BAT,CLOSED,CNT,DIV,DPT,FILL,LINE
"RTN","PSXSTAT",6,0)
 K %ZIS,PSXLION,SYSTEM,SYS,CDOM,FDOM,FAC,SYSSTAT,PP,PURG,XX,XMIT,PDTTM
"RTN","PSXSTAT",7,0)
 K CMOP,NAME,RX,COMFLAG,PSXBAT,SS,ACT,AA,ACTIVE,SSN,SS,RECVD,NOTE,STATUS
"RTN","PSXSTAT",8,0)
 K TT,ZZ,DIR,DIROUT,DIRUT,DTOUT,DUOUT
"RTN","PSXSTAT",9,0)
 S:$D(ZTQUEUED) ZTREQ="@"
"RTN","PSXSTAT",10,0)
 Q
"RTN","PSXSTAT",11,0)
QUE S ZTRTN="RPT^PSXSTAT",ZTIO=PSXLION,ZTSAVE("COMFLAG")="",ZTSAVE("PSXBAT")="",ZTSAVE("DTAIL")="",ZTDESC="CMOP Transmission Inquiry Report" D ^%ZTLOAD
"RTN","PSXSTAT",12,0)
 I $D(ZTSK)[0 W !!,"Job Canceled"
"RTN","PSXSTAT",13,0)
 E  W !!,"Job Queued"
"RTN","PSXSTAT",14,0)
 D HOME^%ZIS
"RTN","PSXSTAT",15,0)
 Q
"RTN","PSXSTAT",16,0)
BATCH ;displays the status of a batch - called from the CMOP MGR menu
"RTN","PSXSTAT",17,0)
 S COMFLAG=0
"RTN","PSXSTAT",18,0)
BB S BAT="A" S BAT=$O(^PSX(550.2,BAT),-1) S PSXBAT=BAT
"RTN","PSXSTAT",19,0)
 I $G(PSXBAT)=""!($G(PSXBAT)=0) W !,"A transmission has not been created yet." Q
"RTN","PSXSTAT",20,0)
 S:$G(PSXBAT) PSXBATNM=$$GET1^DIQ(550.2,PSXBAT,.01)
"RTN","PSXSTAT",21,0)
 ;S DIC(0)="AEMQZ",DIC="^PSX(550.2,",DIC("B")=$G(PSXBATNM),DIC("S")="I $D(^PSX(550.2,""B"",+Y))" D ^DIC K DIC G:$D(DTOUT)!($D(DUOUT))!($G(Y)'>0) EXIT S PSXBAT=+Y K Y
"RTN","PSXSTAT",22,0)
 S DIC(0)="AEMQZ",DIC="^PSX(550.2,",DIC("B")=$G(PSXBATNM) D ^DIC K DIC G:$D(DTOUT)!($D(DUOUT))!($G(Y)'>0) EXIT S PSXBAT=+Y K Y
"RTN","PSXSTAT",23,0)
 S:$G(PSXBAT) PSXBATNM=$$GET1^DIQ(550.2,PSXBAT,.01)
"RTN","PSXSTAT",24,0)
 ;S TT=$O(^PSX(550.2,"B",$G(PSXBATNM),"")) I $G(TT)'>0 W !,"Transmission "_PSXBAT_" doesn't exist." K TT,PSXBAT,BAT,X,Y G BATCH
"RTN","PSXSTAT",25,0)
 W !
"RTN","PSXSTAT",26,0)
DEV ;I COMFLAG=0 S %ZIS="Q" D ^%ZIS S PSXLION=ION I POP W !,"NO DEVICE SELECTED" G EXIT
"RTN","PSXSTAT",27,0)
 ;I $D(IO("Q")) D QUE,EXIT Q
"RTN","PSXSTAT",28,0)
 ;Called by Taskman to produce Statistical Report
"RTN","PSXSTAT",29,0)
RPT S Y=$P($G(^PSX(550.2,PSXBAT,0)),U,6) X ^DD("DD") S TDATE=Y K Y
"RTN","PSXSTAT",30,0)
 S RETRAN=$P($G(^PSX(550.2,PSXBAT,1)),U,3)
"RTN","PSXSTAT",31,0)
 S DIV=$P($G(^PS(59,$P($G(^PSX(550.2,PSXBAT,0)),U,3),0)),U,1)
"RTN","PSXSTAT",32,0)
 S CMOP=$P($G(^PSX(550,$P($G(^PSX(550.2,PSXBAT,0)),U,4),0)),U,1)
"RTN","PSXSTAT",33,0)
 S SENDR=$P($G(^VA(200,$P($G(^PSX(550.2,PSXBAT,0)),U,5),0)),U,1)
"RTN","PSXSTAT",34,0)
 S Y=$P($G(^PSX(550.2,PSXBAT,1)),U,4) X ^DD("DD") S CLOSED=Y K Y
"RTN","PSXSTAT",35,0)
 S Y=$P($G(^PSX(550.2,PSXBAT,1)),U,1) X ^DD("DD") S RECVD=Y K Y
"RTN","PSXSTAT",36,0)
 S STAT=$P($G(^PSX(550.2,PSXBAT,0)),U,2) S STATUS=$S(STAT=1:"Opened",STAT=2:"Transmitted",STAT=3:"Acknowledged",STAT=4:"Closed",STAT=5:"Retransmitted",1:"")
"RTN","PSXSTAT",37,0)
 I $G(COMFLAG)'=1 W @IOF,!!!,?30,"View Transmission"
"RTN","PSXSTAT",38,0)
 W !!!,"Division",?25,":",?27,DIV
"RTN","PSXSTAT",39,0)
 W !,"CMOP",?25,":",?27,CMOP
"RTN","PSXSTAT",40,0)
 W !,"Transmission number",?25,":",?27,PSXBAT,?50,"Status",?62,":  ",?65,STATUS
"RTN","PSXSTAT",41,0)
 I $G(RETRAN)'="" W !,"Retransmission of batch",?25,":",?27,RETRAN
"RTN","PSXSTAT",42,0)
 W !,"Sender",?25,":",?27,SENDR
"RTN","PSXSTAT",43,0)
 W !,"Transmission date/time",?25,":",?27,TDATE
"RTN","PSXSTAT",44,0)
 I RECVD'="" W !,"Received date/time",?25,":",?27,RECVD
"RTN","PSXSTAT",45,0)
 I CLOSED'="" W !,"Closed date/time",?25,":",?27,CLOSED
"RTN","PSXSTAT",46,0)
 W !,"Beginning order number",?25,":",?27,$P($G(^PSX(550.2,PSXBAT,1)),U,5),?50,"Total orders:",?65,$P($G(^PSX(550.2,PSXBAT,1)),U,7)
"RTN","PSXSTAT",47,0)
 W !,"Ending order number",?25,":",?27,$P($G(^PSX(550.2,PSXBAT,1)),U,6),?50,"Total Rxs   : ",?65,$P($G(^PSX(550.2,PSXBAT,1)),U,8)
"RTN","PSXSTAT",48,0)
 I $G(COMFLAG)'=1&($D(^PSX(550.2,PSXBAT,3,1,0))) W !!,"Comments: " S CNT=0 F  S CNT=$O(^PSX(550.2,PSXBAT,3,CNT)) Q:CNT'>0  S NOTE=$G(^PSX(550.2,PSXBAT,3,CNT,0)) W !,NOTE
"RTN","PSXSTAT",49,0)
 ;I $G(COMFLAG)'=1 W ! S DIR(0)="E",DIR("A")="Press RETURN to continue" D ^DIR K DIR W @IOF
"RTN","PSXSTAT",50,0)
 I $G(COMFLAG)'=1 W ! S DIR(0)="Y",DIR("A")="View another transmission",DIR("B")="NO" D ^DIR K DIR I $G(Y)=1 W @IOF G BATCH
"RTN","PSXSTAT",51,0)
 I COMFLAG=1 D EDIT
"RTN","PSXSTAT",52,0)
 G EXIT
"RTN","PSXSTAT",53,0)
 Q
"RTN","PSXSTAT",54,0)
COMM ;code to enter the comment field of PSX(550.2 - called from the
"RTN","PSXSTAT",55,0)
 ;CMOP MGR menu
"RTN","PSXSTAT",56,0)
 S COMFLAG=1
"RTN","PSXSTAT",57,0)
 G BB
"RTN","PSXSTAT",58,0)
EDIT L +^PSX(550.2,PSXBAT):30 I '$T W !!,"This record is currently in use, try later." Q
"RTN","PSXSTAT",59,0)
 S DA=PSXBAT,DIE="^PSX(550.2,",DR="16" D ^DIE K DIE,DA,DR L -^PSX(550.2,PSXBAT)
"RTN","PSXSTAT",60,0)
 Q
"RTN","PSXSTAT",61,0)
COMM514 ; Enter batch comments in 552.1  called from option PSX COMMENT
"RTN","PSXSTAT",62,0)
 S CFLAG=1
"RTN","PSXSTAT",63,0)
 D SHOW G:$G(REC)="" EXIT1
"RTN","PSXSTAT",64,0)
 S DA=REC K Y L +PSX(552.1,DA):600
"RTN","PSXSTAT",65,0)
 S DIE="^PSX(552.1,",DR="15" D ^DIE L -^PSX(552.1,DA) K DIE,DR,DA
"RTN","PSXSTAT",66,0)
EXIT1 K REC,DTOUT,DIRUT,DIROUT,DUOUT,DIC,DIC(0),NODE0,NODE1,NODE2,NODEP,Y,X,STAT,I,CFLAG
"RTN","PSXSTAT",67,0)
 Q
"RTN","PSXSTAT",68,0)
SHOW S DIC=552.1,DIC(0)="AEQMZ",DIC("A")="FACILITY BATCH REFERENCE:  " D ^DIC K DIC S REC=+Y G:(+Y<1)!($G(DTOUT))!($G(DUOUT)) EXIT1
"RTN","PSXSTAT",69,0)
 S NODE0=$G(^PSX(552.1,+Y,0)),NODE1=$G(^PSX(552.1,+Y,1)),NODE2=$G(^PSX(552.1,+Y,2)),NODEP=$G(^PSX(552.1,+Y,"P")),STAT=$P(NODE0,"^",2)
"RTN","PSXSTAT",70,0)
 I $G(CFLAG)="" W @IOF,!!!,?28,"VIEW TRANSMISSION"
"RTN","PSXSTAT",71,0)
SHOW1 W !!,"Transmission",?17,":",?19,$P(NODE0,"^",1),?39,"Transmitted",?52,":",?54,$$FMTE^XLFDT($P(NODE0,"^",3),"1P")
"RTN","PSXSTAT",72,0)
 W !,"Status",?17,":",?19,$S(STAT=1:"Received",STAT=2:"Queued",STAT=3:"Processed",STAT=4:"Closed",STAT=5:"Hold",STAT=6:"Printed",STAT=99:"Rejected",1:""),?39,"Received",?52,":",?54,$$FMTE^XLFDT($P(NODE0,"^",4),"1P")
"RTN","PSXSTAT",73,0)
 W !,"Division",?17,":",?19,$E($P(NODEP,"^",1),1,18) I "34"[$G(STAT) W ?39,"Processed",?52,":",?54,$$FMTE^XLFDT($P(NODE0,"^",6),"1P")
"RTN","PSXSTAT",74,0)
 W !,"Sender",?17,":",?19,$E($P(NODEP,"^",3),1,18) I $G(STAT)=4 W ?39,"Closed",?52,":",?54,$$FMTE^XLFDT($P(NODE0,"^",5),"1P")
"RTN","PSXSTAT",75,0)
 W !,"Beginning order #",?17,":",?19,$P(NODE1,"^",1),?39,"Total orders",?52,":",?54,$P(NODE1,"^",3)
"RTN","PSXSTAT",76,0)
 W !,"Ending order #",?17,":",?19,$P(NODE1,"^",2),?39,"Total Rx's",?52,":",?54,$P(NODE1,"^",4)
"RTN","PSXSTAT",77,0)
 I $G(NODE2)'="" W !,"Retransmission of ",$P(NODE2,"^",2)
"RTN","PSXSTAT",78,0)
 I $G(CFLAG)'=1,($G(^PSX(552.1,REC,3,0)))'="" W !!,"Comments: " F I=0:0 S I=$O(^PSX(552.1,REC,3,I)) Q:I'>0  W $G(^PSX(552.1,REC,3,I,0)),!
"RTN","PSXSTAT",79,0)
 ;I $G(CFLAG)'=1 W ! S DIR(0)="E",DIR("A")="Press RETURN to continue" D ^DIR K DIR W @IOF
"RTN","PSXSTAT",80,0)
 I $G(CFLAG)'=1 W ! S DIR(0)="Y",DIR("A")="View another transmission",DIR("B")="NO" D ^DIR K DIR I $G(Y)=1 W @IOF G SHOW
"RTN","PSXSTAT",81,0)
 I $G(CFLAG)="" D EXIT1
"RTN","PSXSTAT",82,0)
 Q
"VER")
8.0^22.0
"BLD",10179,6)
^70
**END**
**END**

