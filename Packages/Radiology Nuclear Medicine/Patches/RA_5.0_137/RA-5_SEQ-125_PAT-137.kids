Released RA*5*137 SEQ #125
Extracted from mail message
**KIDS**:RA*5.0*137^

**INSTALL NAME**
RA*5.0*137
"BLD",10071,0)
RA*5.0*137^RADIOLOGY/NUCLEAR MEDICINE^0^3180116^y
"BLD",10071,1,0)
^^9^9^3171219^
"BLD",10071,1,1,0)
This patch addresses the following issues:
"BLD",10071,1,2,0)
 
"BLD",10071,1,3,0)
Historic radiolgy patient demographic updates to PACS.
"BLD",10071,1,4,0)
'Mass Override to Complete' option removal.
"BLD",10071,1,5,0)
Status Tracking of Exams addition of pregnancy screen prompt.
"BLD",10071,1,6,0)
Outside Report Entry/Edit bypass of pregnancy screen requirement. 
"BLD",10071,1,7,0)
Status tracking display of printsets with SSANs enabled.
"BLD",10071,1,8,0)
Registered Request Printer.
"BLD",10071,1,9,0)
Images Acquired indicator on radiology reports. 
"BLD",10071,4,0)
^9.64PA^79.1^1
"BLD",10071,4,79.1,0)
79.1
"BLD",10071,4,79.1,2,0)
^9.641^79.1^1
"BLD",10071,4,79.1,2,79.1,0)
IMAGING LOCATIONS  (File-top level)
"BLD",10071,4,79.1,2,79.1,1,0)
^9.6411^28^1
"BLD",10071,4,79.1,2,79.1,1,28,0)
REGISTERED REQUEST PRINTER
"BLD",10071,4,79.1,222)
y^n^p^^^^n^^n
"BLD",10071,4,79.1,224)

"BLD",10071,4,"APDD",79.1,79.1)

"BLD",10071,4,"APDD",79.1,79.1,28)

"BLD",10071,4,"B",79.1,79.1)

"BLD",10071,6.3)
4
"BLD",10071,"KRN",0)
^9.67PA^779.2^20
"BLD",10071,"KRN",.4,0)
.4
"BLD",10071,"KRN",.4,"NM",0)
^9.68A^1^1
"BLD",10071,"KRN",.4,"NM",1,0)
RA IMAGE LOC LIST    FILE #79.1^79.1^0
"BLD",10071,"KRN",.4,"NM","B","RA IMAGE LOC LIST    FILE #79.1",1)

"BLD",10071,"KRN",.401,0)
.401
"BLD",10071,"KRN",.402,0)
.402
"BLD",10071,"KRN",.402,"NM",0)
^9.68A^2^2
"BLD",10071,"KRN",.402,"NM",1,0)
RA STATUS CHANGE    FILE #70^70^0
"BLD",10071,"KRN",.402,"NM",2,0)
RA SITE MANAGER    FILE #79.1^79.1^0
"BLD",10071,"KRN",.402,"NM","B","RA SITE MANAGER    FILE #79.1",2)

"BLD",10071,"KRN",.402,"NM","B","RA STATUS CHANGE    FILE #70",1)

"BLD",10071,"KRN",.403,0)
.403
"BLD",10071,"KRN",.5,0)
.5
"BLD",10071,"KRN",.84,0)
.84
"BLD",10071,"KRN",3.6,0)
3.6
"BLD",10071,"KRN",3.8,0)
3.8
"BLD",10071,"KRN",9.2,0)
9.2
"BLD",10071,"KRN",9.8,0)
9.8
"BLD",10071,"KRN",9.8,"NM",0)
^9.68A^10^9
"BLD",10071,"KRN",9.8,"NM",2,0)
RASITE^^0^B13056737
"BLD",10071,"KRN",9.8,"NM",3,0)
RAREG1^^0^B30837568
"BLD",10071,"KRN",9.8,"NM",4,0)
RAREG3^^0^B29955259
"BLD",10071,"KRN",9.8,"NM",5,0)
RAESO^^0^B11039001
"BLD",10071,"KRN",9.8,"NM",6,0)
RASTREQ^^0^B63019681
"BLD",10071,"KRN",9.8,"NM",7,0)
RAUTL8^^0^B71419275
"BLD",10071,"KRN",9.8,"NM",8,0)
RADLQ1^^0^B35197870
"BLD",10071,"KRN",9.8,"NM",9,0)
RAHLRS^^0^B27750372
"BLD",10071,"KRN",9.8,"NM",10,0)
RASTEXT^^0^B35874954
"BLD",10071,"KRN",9.8,"NM","B","RADLQ1",8)

"BLD",10071,"KRN",9.8,"NM","B","RAESO",5)

"BLD",10071,"KRN",9.8,"NM","B","RAHLRS",9)

"BLD",10071,"KRN",9.8,"NM","B","RAREG1",3)

"BLD",10071,"KRN",9.8,"NM","B","RAREG3",4)

"BLD",10071,"KRN",9.8,"NM","B","RASITE",2)

"BLD",10071,"KRN",9.8,"NM","B","RASTEXT",10)

"BLD",10071,"KRN",9.8,"NM","B","RASTREQ",6)

"BLD",10071,"KRN",9.8,"NM","B","RAUTL8",7)

"BLD",10071,"KRN",19,0)
19
"BLD",10071,"KRN",19,"NM",0)
^9.68A^3^3
"BLD",10071,"KRN",19,"NM",1,0)
RA EXAMSTATUS MASS OVERRIDE^^1^
"BLD",10071,"KRN",19,"NM",2,0)
RA ADT^^0
"BLD",10071,"KRN",19,"NM",3,0)
RA HL7 MENU^^2
"BLD",10071,"KRN",19,"NM","B","RA ADT",2)

"BLD",10071,"KRN",19,"NM","B","RA EXAMSTATUS MASS OVERRIDE",1)

"BLD",10071,"KRN",19,"NM","B","RA HL7 MENU",3)

"BLD",10071,"KRN",19.1,0)
19.1
"BLD",10071,"KRN",101,0)
101
"BLD",10071,"KRN",409.61,0)
409.61
"BLD",10071,"KRN",771,0)
771
"BLD",10071,"KRN",779.2,0)
779.2
"BLD",10071,"KRN",870,0)
870
"BLD",10071,"KRN",8989.51,0)
8989.51
"BLD",10071,"KRN",8989.52,0)
8989.52
"BLD",10071,"KRN",8994,0)
8994
"BLD",10071,"KRN","B",.4,.4)

"BLD",10071,"KRN","B",.401,.401)

"BLD",10071,"KRN","B",.402,.402)

"BLD",10071,"KRN","B",.403,.403)

"BLD",10071,"KRN","B",.5,.5)

"BLD",10071,"KRN","B",.84,.84)

"BLD",10071,"KRN","B",3.6,3.6)

"BLD",10071,"KRN","B",3.8,3.8)

"BLD",10071,"KRN","B",9.2,9.2)

"BLD",10071,"KRN","B",9.8,9.8)

"BLD",10071,"KRN","B",19,19)

"BLD",10071,"KRN","B",19.1,19.1)

"BLD",10071,"KRN","B",101,101)

"BLD",10071,"KRN","B",409.61,409.61)

"BLD",10071,"KRN","B",771,771)

"BLD",10071,"KRN","B",779.2,779.2)

"BLD",10071,"KRN","B",870,870)

"BLD",10071,"KRN","B",8989.51,8989.51)

"BLD",10071,"KRN","B",8989.52,8989.52)

"BLD",10071,"KRN","B",8994,8994)

"BLD",10071,"QDEF")
^^^^^^^^^^YES
"BLD",10071,"QUES",0)
^9.62^^
"BLD",10071,"REQB",0)
^9.611^7^6
"BLD",10071,"REQB",2,0)
RA*5.0*95^2
"BLD",10071,"REQB",3,0)
RA*5.0*93^2
"BLD",10071,"REQB",4,0)
RA*5.0*8^2
"BLD",10071,"REQB",5,0)
RA*5.0*47^2
"BLD",10071,"REQB",6,0)
RA*5.0*90^2
"BLD",10071,"REQB",7,0)
MAG*3.0*183^0
"BLD",10071,"REQB","B","MAG*3.0*183",7)

"BLD",10071,"REQB","B","RA*5.0*47",5)

"BLD",10071,"REQB","B","RA*5.0*8",4)

"BLD",10071,"REQB","B","RA*5.0*90",6)

"BLD",10071,"REQB","B","RA*5.0*93",3)

"BLD",10071,"REQB","B","RA*5.0*95",2)

"FIA",79.1)
IMAGING LOCATIONS
"FIA",79.1,0)
^RA(79.1,
"FIA",79.1,0,0)
79.1IP
"FIA",79.1,0,1)
y^n^p^^^^n^^n
"FIA",79.1,0,10)

"FIA",79.1,0,11)

"FIA",79.1,0,"RLRO")

"FIA",79.1,0,"VR")
5.0^RA
"FIA",79.1,79.1)
1
"FIA",79.1,79.1,28)

"KRN",.4,323,-1)
0^1
"KRN",.4,323,0)
RA IMAGE LOC LIST^3170616.152^^79.1^^^3170616
"KRN",.4,323,"%D",0)
^^1^1^2940608^
"KRN",.4,323,"%D",1,0)
Generates a list of locations from the Imaging Location file.
"KRN",.4,323,"F",1)
"Location:";C18~.01;C28;""~"Division:";C18~25;C28;""~"Inactivation Date:";C18~19;C37;""~"Imaging Type:";C14~6;C28;""~"Credit Method:";C13~21;C28;""~
"KRN",.4,323,"F",2)
W:$P($G(^RA(79.1,D0,0)),"^",21)="" ?28,"Regular Credit";"";Z;"W:$P($G(^RA(79.1,D0,0)),"^",21)="" ?28,"Regular Credit""~"DSS ID:";C20~22;C28;""~
"KRN",.4,323,"F",3)
"Allow 'Released/Unverified':";C18~17;C47;""~"";S2~"Flash Card Parameters:";C5~"Jacket Label Parameters:";C50~"----------------------";C5~
"KRN",.4,323,"F",4)
"------------------------";C50~"Default Printer:";C5~3;"";C22~"Default Printer :";C50~5;"";C68;L11~"Cards Per Visit:";C5~2;"";C22~
"KRN",.4,323,"F",5)
"Labels Per Visit:";C50~4;"";C68;L11~"Default Format :";C5~7;"";C22~"Default Format  :";C50~11;"";C68;L11~"";S2~"Exam Label Parameters:";C5~
"KRN",.4,323,"F",6)
"Order Parameters:";C50~"----------------------";C5~"-----------------";C50~"Default Printer: [Flash Card Printer]";C5~"Default Printer:";C50~
"KRN",.4,323,"F",7)
16;"";C68;L11~"Labels Per Exam:";C5~8;"";C22~"Cancellation Ptr:";C50~24;"";C68;L11~"Default Format :";C5~9;"";C22~"Registered Ptr:";C50~28;"";C68;L11~
"KRN",.4,323,"F",8)
"";S2~"Radiopharmaceutical";C50~"Reporting Parameters:";C5~"Dosage Ticket Parameters";C50~"---------------------";C5~"------------------------";C50~
"KRN",.4,323,"F",9)
"Default Printer:";C5~10;"";C22;L25~"Default Printer:";C50~23;"";C68;L11~"Default Header:";C5~12;"";C21~"Default Footer:";C5~13;"";C21~
"KRN",.4,323,"F",10)
"DX Codes in Rpt:";C5~18;"";C22~"Voice Dictation auto-print:";C5~26;"";C33~"";S2~"Allowable Cam/Equip/Rms For This Location:";C5~
"KRN",.4,323,"F",11)
"------------------------------------------";C5~100,.01;"";C10~"";S2~"Default CPT Modifiers for this location:";C5~
"KRN",.4,323,"F",12)
"----------------------------------------";C5~135,.01;"";C10~135,W $P($$MOD^ICPTMOD(X,"I"),"^",3);"";Z;"W $P($$MOD^ICPTMOD(X,"I"),"^",3)"~"";S2~
"KRN",.4,323,"F",13)
"'Stat' Alert Recipients For This Location:";C5~"Urgent Request Alerts?: ";C50~20;"";C75~"------------------------------------------";C5~150,.01;"";C10~
"KRN",.4,323,"H")
Imaging Location List
"KRN",.402,230,-1)
0^1
"KRN",.402,230,0)
RA STATUS CHANGE^3170616.1534^^70^^^3180112
"KRN",.402,230,"%D",0)
^^2^2^2940607^^^
"KRN",.402,230,"%D",1,0)
 
"KRN",.402,230,"%D",2,0)
This template is used for the Status Tracking of Exams option.
"KRN",.402,230,"DIAB",1,2,70.03,12)
NUCLEAR MED DATA:
"KRN",.402,230,"DIAB",2,2,70.03,9)
80;REQ
"KRN",.402,230,"DIAB",2,4,70.21,5)
DOSE ADMINISTERED//^S X=$P($G(^RADPTN(DA(1),"NUC",DA,0)),"^",4);T
"KRN",.402,230,"DIAB",7,2,70.03,1)
2;REQ
"KRN",.402,230,"DIAB",8,2,70.03,8)
32;REQ
"KRN",.402,230,"DR",1,70)
I '$D(RANEXT)!('$D(RADTE))!('$D(RACN))!('$D(RASK))!('$D(RAMDV))!('$D(DUZ))!('$D(RANXT72))!('$D(RACN0)) W !,$C(7),"Must have RANEXT, RADTE, RACN, RASK, RAMDV, RANXT72, RACN0 and DUZ defined to use this template" S Y="@99";
"KRN",.402,230,"DR",1,70,1)
2///^S X=RADTE;@99;S RAREM="let calling rtn kill RA- vars, due early out from exm status not changed";
"KRN",.402,230,"DR",2,70.02)
50///^S X=RACN;
"KRN",.402,230,"DR",3,70.03)
S RANXT72(.6)=$G(^RA(72,RANXT72,.6));S RAOPRC=$P($G(^RADPT(DA(2),"DT",DA(1),"P",DA,0)),U,2);S:'$D(RAPRI) RAPRI=RAOPRC;S:$P(RASK,"^",2)'["Y" Y="@03";I $G(RAPRTSET) D WHY1^RASTED S Y="@03";12;I X="" S Y=15;70;@15;15;
"KRN",.402,230,"DR",3,70.03,1)
I X="",$P(RAMDV,"^",28) W !,"     Primary Interpreting Staff required for this division",$C(7),! S Y="@15";I X="" S Y="@03";60;@03;S:$P(RASK,"^",3)'["Y" Y="@049";@05;2R~;S RAPRI=+X;S RAREM="did user change the procedure ?";
"KRN",.402,230,"DR",3,70.03,2)
I RAPRI=RAOPRC S Y="@049";S RAREM="if procedures change, make sure CM associations are preserved...";D CHGPRC^RAUTL21(RAOPRC,RAPRI,.DA);D WARNPRC^RAUTL;I RAWHICH=0 S Y="@049";I RAWHICH=2 S Y="@047";
"KRN",.402,230,"DR",3,70.03,3)
W !,"... Deleting radiopharms ...",!;500///@;@047;I RAWHICH=1 S Y="@049";W !,"... Deleting medications ...",!;K ^RADPT(DA(2),"DT",DA(1),"P",DA,"RX");@049;I '$P(RAMDV,U,7)!($P(^RAMIS(71,RAPRI,0),U,6)'="B") S Y="@051";
"KRN",.402,230,"DR",3,70.03,4)
W !?3,$C(7),"A 'detailed' procedure or a 'series' of procedures is required!";2///@;S Y="@05";@051;S:'$$FUTC^RACPTCSV Y="@05";S RAREM="determine if CM is used for this procedure";S RAZCM=$O(^RAMIS(71,RAPRI,"CM","B",""));
"KRN",.402,230,"DR",3,70.03,5)
10//^S X=$S(RAZCM'="":"YES",1:"NO");S RAZCM(0)=X;S:$E(RAZCM(0))="N" Y=$$PRGCM^RAMAINU(.DA);D:$E(RAZCM(0))="Y"&('+$O(^RADPT(DA(2),"DT",DA(1),"P",DA,"CM",0))) STUFCM70^RAMAINU(.DA,RAPRI);S X=X;225;
"KRN",.402,230,"DR",3,70.03,6)
D:+$O(^RADPT(DA(2),"DT",DA(1),"P",DA,"CM",0))=0 UPXCM^RAMAINU(.DA,"N");@225;S:$P(RASK,"^",13)'["Y" Y="@063";125;@063;S:$P(RASK,"^",14)'["Y" Y="@067";@065;D:$T(DISCMOD^RACPTMSC)]"" DISCMOD^RACPTMSC;135;
"KRN",.402,230,"DR",3,70.03,7)
S:'$$FUTCMOD^RACPTCSV Y="@065";@067;S:$P(RASK,"^",4)'["Y" Y="@09";50;@09;S:$P(RASK,"^",5)'["Y" Y="@12";I $G(RAPRTSET) D WHY2^RASTED S Y="@12";13;I X="" S Y="@12";13.1;@12;S:$P(RASK,"^",6)'["Y" Y="@25";18;@25;
"KRN",.402,230,"DR",3,70.03,8)
S:$P(RASK,"^")'["Y" Y="@11";175;S RATCXX=$$TCPROMPT^RAO7XX;@11;S Y=$$ASKPREG^RAUTL8();S RAOIFN=$P($G(^RADPT(RADFN,"DT",RADTI,"P",RACNI,0)),U,11);W !,"    PREGNANT AT TIME OF ORDER ENTRY: ",$$GET1^DIQ(75.1,$G(RAOIFN)_",",13);32R~;
"KRN",.402,230,"DR",3,70.03,9)
S RAPRSCR=$$PRSCR^RAUTL8(RADFN,RADTI,RACNI,"I") K:RAPRSCR="n" ^RADPT(RADFN,"DT",RADTI,"P",RACNI,"PCOMM") S:RAPRSCR="n" Y="@8001" K RAPRSCR;80R~;@8001;S:'($P(RASK,"^",7)["Y"&($P(^RAMIS(71,RAPRI,0),"^",5)="y")) Y="@14";
"KRN",.402,230,"DR",3,70.03,10)
K RA65 S RA65="P";200///^S X=$$RXMEDIT^RAPSAPI3(.RA65,","_RACNI_","_RADTI_","_RADFN_",",70.03,200,RADTE);S:$G(RA65("RESULT"))'="" Y="MEDICATIONS";@14;S:$P($G(^RA(79.2,+$P(RADT0,"^",2),0)),"^",5)'="Y" Y="@75";
"KRN",.402,230,"DR",3,70.03,11)
S:$$NORADIO^RASTREQN(RAPRI,.RANXT72) Y="@75";S RAIEN702=$$EN1^RANMPT1(RADFN,RADTE,RACN);S:RAIEN702=-1 Y="@75";500////^S X=RAIEN702;
"KRN",.402,230,"DR",3,70.03,12)
^70.2^RADPTN(^^S I(2,0)=D2 S I(1,0)=D1 S I(0,0)=D0 S Y(1)=$S($D(^RADPT(D0,"DT",D1,"P",D2,0)):^(0),1:"") S X=$P(Y(1),U,28),X=X  S D(0)=+X S X=$S(D(0)>0:D(0),1:"");@75;S:'$D(RAIEN702) Y="@80";
"KRN",.402,230,"DR",3,70.03,13)
S:$O(^RADPTN(+$G(RAIEN702),"NUC",0)) Y="@80";K RAIEN702;500///@;@80;K RA65;3///^S X=$P(RANEXT,"^");S RA70033=X;
"KRN",.402,230,"DR",4,70.04)
.01:2;
"KRN",.402,230,"DR",4,70.09)
.01;
"KRN",.402,230,"DR",4,70.1)
.01;
"KRN",.402,230,"DR",4,70.11)
.01;
"KRN",.402,230,"DR",4,70.12)
.01;
"KRN",.402,230,"DR",4,70.14)
.01;
"KRN",.402,230,"DR",4,70.15)
S:$G(X)="" Y=0;.01///^S X=$$RXMEDIT^RAPSAPI3(.RA65,DA_","_RACNI_","_RADTI_","_RADFN_",");2;S:$P(RASK,"^",8)'["Y" Y="@13";3//^S X="NOW";4//^S X=$P($G(^VA(200,DUZ,0)),"^");@13;
"KRN",.402,230,"DR",4,70.2)
D DISDEF^RASTREQN(RAIEN702);K RA65 S RA65="R";100///^S X=$$RXMEDIT^RAPSAPI3(.RA65,","_DA_",",70.2,100,RADTE);S:$G(RA65("RESULT"))'="" Y="RADIOPHARMACEUTICALS";
"KRN",.402,230,"DR",4,70.3135)
.01;
"KRN",.402,230,"DR",4,70.3225)
.01;
"KRN",.402,230,"DR",5,70.21)
S:$G(X)="" Y=0;.01///^S X=$$RXMEDIT^RAPSAPI3(.RA65,DA_","_DA(1)_",");S RAPSDRUG=+X;S RADIOPH=$O(^RAMIS(71,RAPRI,"NUC","B",+$G(RAPSDRUG),0)),(RAHI,RALOW)="";
"KRN",.402,230,"DR",5,70.21,1)
S RADIOPH=$G(^RAMIS(71,RAPRI,"NUC",+$G(RADIOPH),0)),RAHI=$P(RADIOPH,"^",5),RALOW=$P(RADIOPH,"^",6);S:"Y"'[$P(RANXT72(.6),"^",3) Y="@1005";@1000;W:RAHI]""!(RALOW]"")!($P(RADIOPH,"^",2)]"") !!;
"KRN",.402,230,"DR",5,70.21,2)
W:RAHI]"" "High Dose: ",RAHI_" mCi" W:RALOW]"" ?27,"Low Dose: ",RALOW_" mCi" W:$P(RADIOPH,"^",2)]"" ?53,"Usual Dose: ",$P(RADIOPH,"^",2)_" mCi";W:RAHI]""!(RALOW]"")!($P(RADIOPH,"^",2)]"") !;4;
"KRN",.402,230,"DR",5,70.21,3)
S Y=$$VALDOS^RASTREQN(RALOW,RAHI,X,"@1000","@1005","@99",0);@1005;S:"Y"'[$P(RANXT72(.6),"^",4) Y="@1010";5//^S X="NOW";6//^S X=$P($G(^VA(200,DUZ,0)),"^");@1010;S:"Y"'[$P(RANXT72(.6),"^") Y="@1020";@1015;
"KRN",.402,230,"DR",5,70.21,4)
W:RAHI]""!(RALOW]"")!($P(RADIOPH,"^",2)]"") !!;W:RAHI]"" "High Dose: ",RAHI_" mCi" W:RALOW]"" ?27,"Low Dose: ",RALOW_" mCi" W:$P(RADIOPH,"^",2)]"" ?53,"Usual Dose: ",$P(RADIOPH,"^",2)_" mCi";
"KRN",.402,230,"DR",5,70.21,5)
W:RAHI]""!(RALOW]"")!($P(RADIOPH,"^",2)]"") !;7T~//^S X=$P($G(^RADPTN(DA(1),"NUC",DA,0)),"^",4);S RADOSE=X;S Y=$$VALDOS^RASTREQN(RALOW,RAHI,RADOSE,"@1015","@1020","@99",1);@1020;
"KRN",.402,230,"DR",5,70.21,6)
S:'$D(RADOSE) RADOSE=$P($G(^RADPTN(DA(1),"NUC",DA,0)),"^",7);S RANM702=$G(^RADPTN(DA(1),"NUC",DA,0));S:$P(^RAMIS(71,RAPRI,0),"^",19)'="y"!('RADOSE) Y="@1030";S:$P(RANM702,"^",2)]""&($P(RANM702,"^",3)]"") Y="@1030";3;2;@1030;
"KRN",.402,230,"DR",5,70.21,7)
S:"Y"'[$P(RANXT72(.6),"^",5) Y="@1040";8//^S X=$S($P($G(RANM702),"^",5)]"":$$FMTE^XLFDT($P(RANM702,"^",5),1),1:"NOW");9//^S X=$P($G(^VA(200,DUZ,0)),"^");@1040;
"KRN",.402,230,"DR",5,70.21,8)
S:$P(RANM702,"^",10)]""!($P($G(^RAMIS(71,RAPRI,0)),"^",19)'="y") Y="@1050";10;@1050;S:"Y"'[$P(RANXT72(.6),"^",7) Y="@1060";11//^S X=$$GET1^DIQ(71.6,+$P(RADIOPH,"^",3)_",",.01);S RAR1=+X;S:'+$O(^RAMIS(71.6,RAR1,"SITE",0)) Y="@1070";
"KRN",.402,230,"DR",5,70.21,9)
12//^S X=$$GET1^DIQ(71.7,+$P(RADIOPH,"^",4)_",",.01);@1070;S:'($P($G(^RADPTN(DA(1),"NUC",DA,0)),"^",11)]""&($P($G(^RAMIS(71.6,RAR1,0)),"^",3)="Y")) Y="@1080";12.5;@1080;@1060;S:"Y"'[$P(RANXT72(.6),"^",8) Y="@1090";13;@1090;
"KRN",.402,230,"DR",5,70.21,10)
S:"Y"'[$P(RANXT72(.6),"^",9) Y="@1100";14;15//^S X=$$EXTERNAL^DILFD(71.08,7,"",$P(RADIOPH,"^",7));@1100;
"KRN",.402,230,"ROUOLD")
RACTTK
"KRN",.402,232,-1)
0^2
"KRN",.402,232,0)
RA SITE MANAGER^3170616.1514^^79.1^^^3171115
"KRN",.402,232,"%D",0)
^^2^2^2940607^
"KRN",.402,232,"%D",1,0)
This template is used by the IRM service for defining input and
"KRN",.402,232,"%D",2,0)
printing devices for the radiology/nuclear medicine package.
"KRN",.402,232,"DR",1,79.1)
N RA791,RA792;S RA791=$G(^RA(79.1,DA,0));S RA792=$G(^RA(79.2,+$P(RA791,"^",6),0));W !!,"Default Printers:",!,"-----------------";3;5;16;10;S:$P(RA792,"^",5)'="Y" Y="@10";23;@10;24;28;
"KRN",19,11177,-1)
2^3
"KRN",19,11177,0)
RA HL7 MENU^Radiology HL7 Menu^^M^2177^^^^^^^18
"KRN",19,11177,10,0)
^19.01IP^4^4
"KRN",19,11177,10,4,0)
14009^ADT
"KRN",19,11177,10,4,"^")
RA ADT
"KRN",19,11177,"U")
RADIOLOGY HL7 MENU
"KRN",19,14009,-1)
0^2
"KRN",19,14009,0)
RA ADT^Send ADT HL7 message to PACS^^R^^RA MGR^^^^^^RADIOLOGY/NUCLEAR MEDICINE
"KRN",19,14009,1,0)
^^5^5^3171218^
"KRN",19,14009,1,1,0)
This option can be used to send a patient demographic update (A08) and a 
"KRN",19,14009,1,2,0)
patient identifier update (A47) HL7 message to a CPACS.
"KRN",19,14009,1,3,0)
 
"KRN",19,14009,1,4,0)
This option requires that VistA Imaging patch MAG*3*183 be installed and 
"KRN",19,14009,1,5,0)
the IHE interface be setup/enabled.
"KRN",19,14009,25)
RAADT^RAHLRS
"KRN",19,14009,"U")
SEND ADT HL7 MESSAGE TO PACS
"KRN",19,14050,-1)
1^1
"KRN",19,14050,0)
RA EXAMSTATUS MASS OVERRIDE
"MBREQ")
0
"ORD",5,.4)
.4;5;;;EDEOUT^DIFROMSO(.4,DA,"",XPDA);FPRE^DIFROMSI(.4,"",XPDA);EPRE^DIFROMSI(.4,DA,$E("N",$G(XPDNEW)),XPDA,"",OLDA);;EPOST^DIFROMSI(.4,DA,"",XPDA);DEL^DIFROMSK(.4,"",%)
"ORD",5,.4,0)
PRINT TEMPLATE
"ORD",7,.402)
.402;7;;;EDEOUT^DIFROMSO(.402,DA,"",XPDA);FPRE^DIFROMSI(.402,"",XPDA);EPRE^DIFROMSI(.402,DA,$E("N",$G(XPDNEW)),XPDA,"",OLDA);;EPOST^DIFROMSI(.402,DA,"",XPDA);DEL^DIFROMSK(.402,"",%)
"ORD",7,.402,0)
INPUT TEMPLATE
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"PKG",18,-1)
1^1
"PKG",18,0)
RADIOLOGY/NUCLEAR MEDICINE^RA^REGISTERS PATIENTS,RECORDS EXAMS,PROFILES,AMIS REPORTS
"PKG",18,20,0)
^9.402P^^
"PKG",18,22,0)
^9.49I^1^1
"PKG",18,22,1,0)
5.0^3051109^2980407^50
"PKG",18,22,1,"PAH",1,0)
137^3180116
"PKG",18,22,1,"PAH",1,1,0)
^^9^9^3180116
"PKG",18,22,1,"PAH",1,1,1,0)
This patch addresses the following issues:
"PKG",18,22,1,"PAH",1,1,2,0)
 
"PKG",18,22,1,"PAH",1,1,3,0)
Historic radiolgy patient demographic updates to PACS.
"PKG",18,22,1,"PAH",1,1,4,0)
'Mass Override to Complete' option removal.
"PKG",18,22,1,"PAH",1,1,5,0)
Status Tracking of Exams addition of pregnancy screen prompt.
"PKG",18,22,1,"PAH",1,1,6,0)
Outside Report Entry/Edit bypass of pregnancy screen requirement. 
"PKG",18,22,1,"PAH",1,1,7,0)
Status tracking display of printsets with SSANs enabled.
"PKG",18,22,1,"PAH",1,1,8,0)
Registered Request Printer.
"PKG",18,22,1,"PAH",1,1,9,0)
Images Acquired indicator on radiology reports. 
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
9
"RTN","RADLQ1")
0^8^B35197870^B33800278
"RTN","RADLQ1",1,0)
RADLQ1 ;HISC/GJC AISC/MJK,RMO-Delq Status/Incomplete Rpt's ;18 Dec 2017 1:15 PM
"RTN","RADLQ1",2,0)
 ;;5.0;Radiology/Nuclear Medicine;**15,97,47,137**;Mar 16, 1998;Build 4
"RTN","RADLQ1",3,0)
 ;'RALL' will be defined in the entry action of RA INCOMPLETE
"RTN","RADLQ1",4,0)
 I $D(DUZ),($O(RACCESS(DUZ,""))']"") D CHECK^RADLQ3(DUZ)
"RTN","RADLQ1",5,0)
 S X=$$DIVLOC^RAUTL7() K ^TMP($J,"RADLQ")
"RTN","RADLQ1",6,0)
 I X K:$D(RAPSTX) RAPSTX K RAQUIT,X,I,POP Q  ; Selection process aborted.
"RTN","RADLQ1",7,0)
 S INVMAXDT=9999999.9999,RAXIT=0
"RTN","RADLQ1",8,0)
 S RAHD(0)=$S($D(RALL):"Incomplete Exam",1:"Delinquent Status")
"RTN","RADLQ1",9,0)
 S RAHD(0)=RAHD(0)_" Report" W @IOF,!?(IOM-$L(RAHD(0))\2),RAHD(0)
"RTN","RADLQ1",10,0)
 D DISPXAM^RADLQ3 ; Display xam statuses
"RTN","RADLQ1",11,0)
 I RAXIT D EXIT^RADLQ3 Q
"RTN","RADLQ1",12,0)
DEV D DATE^RAUTL I RAPOP D EXIT^RADLQ3 Q  ; Quit if device not selected
"RTN","RADLQ1",13,0)
 S RABEG=INVMAXDT-ENDDATE,RAEND=INVMAXDT-BEGDATE K DIR,X,Y
"RTN","RADLQ1",14,0)
 S DIR(0)="SO^I:INPATIENT;O:OUTPATIENT;B:BOTH"
"RTN","RADLQ1",15,0)
 S DIR("?",1)="This report can be broken out by"
"RTN","RADLQ1",16,0)
 S DIR("?")="Outpatient, Inpatient, or Both."
"RTN","RADLQ1",17,0)
 S DIR("A")="Report to include" D ^DIR K DIR
"RTN","RADLQ1",18,0)
 I $D(DIRUT) D EXIT^RADLQ3 Q
"RTN","RADLQ1",19,0)
 S RASORT1=Y
"RTN","RADLQ1",20,0)
 W !!?5,"Now that you have selected ",Y(0)
"RTN","RADLQ1",21,0)
 W " do you want to sort by",!?5,"Patient or Date ?" K X,Y
"RTN","RADLQ1",22,0)
 S DIR(0)="SO^P:PATIENT;D:DATE"
"RTN","RADLQ1",23,0)
 S DIR("?",1)="This allows you the flexibility to further"
"RTN","RADLQ1",24,0)
 S DIR("?")="sort the report by Patient or Date." D ^DIR K DIR
"RTN","RADLQ1",25,0)
 I $D(DIRUT) D EXIT^RADLQ3 Q
"RTN","RADLQ1",26,0)
 S RASORT2=Y D ZEROUT^RADLQ3("RADLQ")
"RTN","RADLQ1",27,0)
 I '$D(^TMP($J,"RADLQ")) D EXIT^RADLQ3 Q
"RTN","RADLQ1",28,0)
 K RACCESS(DUZ,"DIV-IMG") W !
"RTN","RADLQ1",29,0)
 S ZTRTN="START^RADLQ1" S:$D(RALL) ZTSAVE("RALL")=""
"RTN","RADLQ1",30,0)
 F RASV="RAHD(","RACRT(","RABEG","RAEND","RASORT1","RASORT2","INVMAXDT","RAXIT","RADIVNM","RAMDIV" D
"RTN","RADLQ1",31,0)
 . S ZTSAVE(RASV)=""
"RTN","RADLQ1",32,0)
 . Q
"RTN","RADLQ1",33,0)
 S ZTSAVE("^TMP($J,""RA D-TYPE"",")=""
"RTN","RADLQ1",34,0)
 S ZTSAVE("^TMP($J,""RADLQ"",")=""
"RTN","RADLQ1",35,0)
 S ZTSAVE("^TMP($J,""RA I-TYPE"",")=""
"RTN","RADLQ1",36,0)
 D ZIS^RAUTL I RAPOP D EXIT^RADLQ3 Q
"RTN","RADLQ1",37,0)
START ; start processing here
"RTN","RADLQ1",38,0)
 U IO S $P(RALN1,"-",(IOM+1))=""
"RTN","RADLQ1",39,0)
 S:$D(ZTQUEUED) ZTREQ="@"
"RTN","RADLQ1",40,0)
 S $P(RALN2,"=",(IOM+1))="",(RAPG,RASTI)=0
"RTN","RADLQ1",41,0)
 F  S RASTI=$O(^RADPT("AS",RASTI)) Q:'RASTI  D  Q:RAXIT
"RTN","RADLQ1",42,0)
 . D RADFN:$S($D(RALL):1,$D(RACRT(RASTI)):1,1:0)
"RTN","RADLQ1",43,0)
 . Q
"RTN","RADLQ1",44,0)
 K RADIV("I") D:'RAXIT PRINT^RADLQ2
"RTN","RADLQ1",45,0)
 I 'RAXIT D
"RTN","RADLQ1",46,0)
 . S RADIVNM=$$DIVTOT^RACMP("RADLQ") Q:'RADIVNM
"RTN","RADLQ1",47,0)
 . S RAXIT=$$EOS^RAUTL5() Q:RAXIT  S RAFLAG="" D HDR^RADLQ2
"RTN","RADLQ1",48,0)
 . D:'RAXIT LIST^RADLQ3
"RTN","RADLQ1",49,0)
 . Q
"RTN","RADLQ1",50,0)
 S RAXIT=$$EOS^RAUTL5() ;cause screen pause for user
"RTN","RADLQ1",51,0)
 D EXIT^RADLQ3
"RTN","RADLQ1",52,0)
 Q
"RTN","RADLQ1",53,0)
RADFN ; $ order through rad patients ien's
"RTN","RADLQ1",54,0)
 S RADFN=0
"RTN","RADLQ1",55,0)
 F  S RADFN=$O(^RADPT("AS",RASTI,RADFN)) Q:'RADFN  D  Q:RAXIT
"RTN","RADLQ1",56,0)
 . F RADTI=RABEG-1:0 S RADTI=$O(^RADPT("AS",RASTI,RADFN,RADTI)) Q:'RADTI!(RADTI>RAEND)  D  Q:RAXIT
"RTN","RADLQ1",57,0)
 .. S RADTE=INVMAXDT-RADTI D RACNI
"RTN","RADLQ1",58,0)
 .. Q
"RTN","RADLQ1",59,0)
 . Q
"RTN","RADLQ1",60,0)
 Q
"RTN","RADLQ1",61,0)
RACNI ; $ order through case #
"RTN","RADLQ1",62,0)
 S RACNI=0
"RTN","RADLQ1",63,0)
 F  S RACNI=$O(^RADPT("AS",RASTI,RADFN,RADTI,RACNI)) Q:'RACNI  D SORT  Q:RAXIT
"RTN","RADLQ1",64,0)
 Q
"RTN","RADLQ1",65,0)
SORT ; sort logic
"RTN","RADLQ1",66,0)
 S RAREGEX(0)=$G(^RADPT(RADFN,"DT",RADTI,0)) Q:RAREGEX(0)']""
"RTN","RADLQ1",67,0)
 S RADIV("I")=+$P(RAREGEX(0),"^",3) Q:RADIV("I")=0
"RTN","RADLQ1",68,0)
 S RADIV("I")=$S($D(^RA(79,RADIV("I"),0)):$P(^(0),"^"),1:0)
"RTN","RADLQ1",69,0)
 S RADIV=$S($D(^DIC(4,RADIV("I"),0)):$P(^(0),"^"),1:0)
"RTN","RADLQ1",70,0)
 Q:'$D(^TMP($J,"RA D-TYPE",RADIV))
"RTN","RADLQ1",71,0)
 S RADIV=RADIV("I"),RAPAT(0)=$G(^DPT(RADFN,0))
"RTN","RADLQ1",72,0)
 S RANME=$S($P(RAPAT(0),"^")]"":$P(RAPAT(0),"^"),1:"Unknown")
"RTN","RADLQ1",73,0)
 S RASSN=$$SSN^RAUTL
"RTN","RADLQ1",74,0)
 S RAEXAM(0)=$G(^RADPT(RADFN,"DT",RADTI,"P",RACNI,0)) Q:RAEXAM(0)']""
"RTN","RADLQ1",75,0)
 S RAIPHY="Unknown"
"RTN","RADLQ1",76,0)
 S:$P(RAEXAM(0),"^",15)]"" RAIPHY=$P($G(^VA(200,+$P(RAEXAM(0),"^",15),0)),"^")
"RTN","RADLQ1",77,0)
 S:$P(RAEXAM(0),"^",12)]""&(RAIPHY="Unknown") RAIPHY=$P($G(^VA(200,+$P(RAEXAM(0),"^",12),0)),"^")
"RTN","RADLQ1",78,0)
 K RATECH S RATD4=+$O(^RADPT(RADFN,"DT",RADTI,"P",RACNI,"TC",0))
"RTN","RADLQ1",79,0)
 I RATD4 D  ; Obtain the first 'tech' encountered
"RTN","RADLQ1",80,0)
 . S RATECH=$E($$GET1^DIQ(200,+$G(^RADPT(RADFN,"DT",RADTI,"P",RACNI,"TC",RATD4,0))_",",.01),1,15)
"RTN","RADLQ1",81,0)
 . Q
"RTN","RADLQ1",82,0)
 K RATD4 S:'$L($G(RATECH)) RATECH="Unknown"
"RTN","RADLQ1",83,0)
 S RACN=+$P(RAEXAM(0),"^"),RAPRC=+$P(RAEXAM(0),"^",2)
"RTN","RADLQ1",84,0)
 S RAPRC=$S($D(^RAMIS(71,RAPRC,0)):$P(^(0),"^"),1:"Unknown")
"RTN","RADLQ1",85,0)
 S RAST=+$P(RAEXAM(0),"^",3),RADT=$P(RADTE,".")
"RTN","RADLQ1",86,0)
 S RAITYPE("I")=$S($D(^RA(72,RAST,0)):+$P(^(0),"^",7),1:0)
"RTN","RADLQ1",87,0)
 S RAITYPE=$S($D(^RA(79.2,RAITYPE("I"),0)):$P(^(0),"^"),1:"Unknown")
"RTN","RADLQ1",88,0)
 Q:'$D(^TMP($J,"RA I-TYPE",RAITYPE))
"RTN","RADLQ1",89,0)
 S:'$D(^RA(72,RAST,0)) RAST="Unknown"
"RTN","RADLQ1",90,0)
 S:$D(^RA(72,RAST,0)) RAST=$P(^(0),"^")
"RTN","RADLQ1",91,0)
 S RADT=$E(RADT,4,5)_"/"_$E(RADT,6,7)_"/"_$E(RADT,2,3)
"RTN","RADLQ1",92,0)
 ; 6th piece: Ward Location          <-> 8th piece: Principal Clinic
"RTN","RADLQ1",93,0)
 ; 9th piece: Contact/Sharing Source <-> 17th piece: Report Text
"RTN","RADLQ1",94,0)
 F RA=6,8,9,17 S RA(RA)=+$P(RAEXAM(0),"^",RA)
"RTN","RADLQ1",95,0)
 S RA("R")=$G(^RADPT(RADFN,"DT",RADTI,"P",RACNI,"R"))
"RTN","RADLQ1",96,0)
 S RAWHE=$S($D(^DIC(42,RA(6),0)):$P(^(0),"^"),$D(^SC(RA(8),0)):$P(^(0),"^"),$D(^DIC(34,RA(9),0)):$P(^(0),"^"),RA("R")]"":RA("R"),1:"Unknown")
"RTN","RADLQ1",97,0)
 S RAVAR=$S($D(^DIC(42,RA(6),0)):"I",1:"O")
"RTN","RADLQ1",98,0)
 Q:RASORT1'="B"&(RASORT1'=RAVAR)
"RTN","RADLQ1",99,0)
 S RARP=$S(+$O(^RARPT(RA(17),"R",0)):"Yes",+$O(^RARPT(RA(17),"I",0)):"Yes",1:"No")
"RTN","RADLQ1",100,0)
 S RAVRFIED=$P($G(^RARPT(RA(17),0)),U,5) S RAVRFIED=$S(RAVRFIED="D":"Draft",RAVRFIED="R":"Released",RAVRFIED="PD":"Prb Drft",RAVRFIED="V":"Verified",RAVRFIED="EF":"Elec. F.",1:"No Rpt")
"RTN","RADLQ1",101,0)
 I $D(ZTQUEUED) D STOPCHK^RAUTL9 S:$G(ZTSTOP)=1 RAXIT=1 Q:RAXIT
"RTN","RADLQ1",102,0)
 ;S ^TMP($J,"RADLQ",RADIV,RAITYPE,RAVAR,$S(RASORT2="P":RANME,1:$P(RADTE,".")),$S(RASORT2="P":$P(RADTE,"."),1:RANME),RACN)=RACN_"^"_RAPRC_"^"_RAST_"^"_RADT_"^"_RAWHE_"^"_RARP_"^"_RASSN_"^"_RAVRFIED_"^"_RAIPHY_"^"_RATECH
"RTN","RADLQ1",103,0)
 N RASSAN,RACNDSP S RASSAN=$$SSANVAL^RAHLRU1(RADFN,RADTI,RACNI)
"RTN","RADLQ1",104,0)
 I ($O(^RARPT(RA(17),2005,0))) S RACN=RACN_" i" I RASSAN]"" S RASSAN=RASSAN_"i" ;Images captured indicator -P137/KLM
"RTN","RADLQ1",105,0)
 S RACNDSP=$S((RASSAN'=""):RASSAN,1:RACN)
"RTN","RADLQ1",106,0)
 I $$USESSAN^RAHLRU1() D
"RTN","RADLQ1",107,0)
 .S ^TMP($J,"RADLQ",RADIV,RAITYPE,RAVAR,$S(RASORT2="P":RANME,1:$P(RADTE,".")),$S(RASORT2="P":$P(RADTE,"."),1:RANME),RACN)=RACNDSP_"^"_RAPRC_"^"_RAST_"^"_RADT_"^"_RAWHE_"^"_RARP_"^"_RASSN_"^"_RAVRFIED_"^"_RAIPHY_"^"_RATECH
"RTN","RADLQ1",108,0)
 I '$$USESSAN^RAHLRU1() D
"RTN","RADLQ1",109,0)
 .S ^TMP($J,"RADLQ",RADIV,RAITYPE,RAVAR,$S(RASORT2="P":RANME,1:$P(RADTE,".")),$S(RASORT2="P":$P(RADTE,"."),1:RANME),RACN)=RACN_"^"_RAPRC_"^"_RAST_"^"_RADT_"^"_RAWHE_"^"_RARP_"^"_RASSN_"^"_RAVRFIED_"^"_RAIPHY_"^"_RATECH
"RTN","RADLQ1",110,0)
 S ^TMP($J,"RADLQ")=+$G(^TMP($J,"RADLQ"))+1
"RTN","RADLQ1",111,0)
 S ^TMP($J,"RADLQ",RADIV)=+$G(^TMP($J,"RADLQ",RADIV))+1
"RTN","RADLQ1",112,0)
 S ^TMP($J,"RADLQ",RADIV,RAITYPE)=+$G(^TMP($J,"RADLQ",RADIV,RAITYPE))+1
"RTN","RADLQ1",113,0)
 S ^TMP($J,"RADLQ",RADIV,RAITYPE,RAVAR)=+$G(^TMP($J,"RADLQ",RADIV,RAITYPE,RAVAR))+1
"RTN","RADLQ1",114,0)
 Q
"RTN","RAESO")
0^5^B11039001^B27993971
"RTN","RAESO",1,0)
RAESO ;HISC/CAH,GJC AISC/SAW-Override Exam Status to Complete ;16 Jan 2018 9:30 AM
"RTN","RAESO",2,0)
 ;;5.0;Radiology/Nuclear Medicine;**47,137**;Mar 16, 1998;Build 4
"RTN","RAESO",3,0)
 ;Mass override exam status to complete - REMOVED P137 /KLM
"RTN","RAESO",4,0)
SINGLE ;Override Single Exam Status to 'COMPLETE'
"RTN","RAESO",5,0)
 D SET^RAPSET1 I $D(XQUIT) K XQUIT Q
"RTN","RAESO",6,0)
 N RAXIT,RASAVDR S RAXIT=0 D CZECH Q:RAXIT
"RTN","RAESO",7,0)
 S RAVW="" D ^RACNLU G EXIT1:"^"[X W ! S I="",$P(I,"-",80)="" W I
"RTN","RAESO",8,0)
 N RASSAN,RACNDSP S RASSAN=$$SSANVAL^RAHLRU1(RADFN,RADTI,RACNI)
"RTN","RAESO",9,0)
 S RACNDSP=$S((RASSAN'=""):RASSAN,1:RACN)
"RTN","RAESO",10,0)
 I $$USESSAN^RAHLRU1() W !?1,"Name     : ",$E(RANME,1,25),?40,"Pt ID       : ",RASSN,!?1,"Case No. : ",RACNDSP,?40,"Procedure   : ",$E(RAPRC,1,25)
"RTN","RAESO",11,0)
 I '$$USESSAN^RAHLRU1() W !?1,"Name     : ",$E(RANME,1,25),?40,"Pt ID       : ",RASSN,!?1,"Case No. : ",RACN,?40,"Procedure   : ",$E(RAPRC,1,25)
"RTN","RAESO",12,0)
 W !?1,"Exam Date: ",RADATE,?40,"Technologist: " I $O(^RADPT(RADFN,"DT",RADTI,"P",RACNI,"TC",0))>0,$D(^VA(200,+^($O(^(0)),0),0)) W $E($P(^(0),"^"),1,25)
"RTN","RAESO",13,0)
 W !?40,"Req Phys    : ",$E($S($D(^VA(200,+$P(Y(0),"^",14),0)):$P(^(0),"^"),1:""),1,25),! S I="",$P(I,"-",80)="" W I
"RTN","RAESO",14,0)
 I $P($G(^RADPT(RADFN,"DT",RADTI,0)),U,2)'=$O(^RA(79.2,"B",RAIMGTY,0)) W !,"Sorry, your sign-on imaging type, ",RAIMGTY,!,"doesn't match the imaging type of this exam.",! G SINGLE
"RTN","RAESO",15,0)
 I $D(^RA(72,"AA",RAIMGTY,0,+RAST)) W !!?3,$C(7),"...exam 'cancelled' therefore override is not allowed." G SINGLE
"RTN","RAESO",16,0)
 I $D(^RA(72,"AA",RAIMGTY,9,+RAST)) W !!?3,$C(7),"...exam is already 'complete'." G SINGLE
"RTN","RAESO",17,0)
ASKOVR R !!,"Are you sure? No// ",X:DTIME S:'$T!(X="")!(X["^") X="N" G SINGLE:"Nn"[$E(X) I "Yy"'[$E(X) W:X'["?" $C(7) W !!?3,"Enter 'YES' to override exam status to 'COMPLETE', or 'NO' not to." G ASKOVR
"RTN","RAESO",18,0)
 W !?3,"...will now attempt override..." S DA=RADFN,DIE="^RADPT(",DR="[RA OVERRIDE]",RASAVDR=DR D ^DIE K DE,DQ,DIE,DR I '$D(Y) W !?6,"...exam status is now '",$P(^RA(72,$O(^RA(72,"AA",RAIMGTY,9,0)),0),"^"),"'.",! D ^RAORDC K DR
"RTN","RAESO",19,0)
 G SINGLE
"RTN","RAESO",20,0)
EXIT1 K %,%DT,%I,%X,%Y,D,D0,D1,D2,D3,DA,DI,DIC,J,POP,RADFN,RADIV,RADTI,RACNI
"RTN","RAESO",21,0)
 K RANME,RASSN,RADATE,RADTE,RACN,RAHEAD,RAI,RAPRC,RAPIFN,RARPT,RAST,RAVW
"RTN","RAESO",22,0)
 K W,X,XQUIT,Y,^TMP($J,"RAEX")
"RTN","RAESO",23,0)
 Q
"RTN","RAESO",24,0)
CZECH ; Check for a 'Complete' exam status for a particular imaging type
"RTN","RAESO",25,0)
 I '+$O(^RA(72,"AA",RAIMGTY,9,0)) D
"RTN","RAESO",26,0)
 . S RAXIT=1
"RTN","RAESO",27,0)
 . W !?5,"An Examination Status of 'Complete' must be defined for an"
"RTN","RAESO",28,0)
 . W !?5,"Imaging Type of: "_RAIMGTY_".  Please contact your"
"RTN","RAESO",29,0)
 . W !?5,"Radiology/Nuclear Medicine ADPAC for further assistance.",$C(7)
"RTN","RAESO",30,0)
 . Q
"RTN","RAESO",31,0)
 Q
"RTN","RAHLRS")
0^9^B27750372^B12807617
"RTN","RAHLRS",1,0)
RAHLRS ;HIRMFO/CRT/PDW - Resend HL7 messages for selected cases ;16 Jan 2018 9:32 AM
"RTN","RAHLRS",2,0)
 ;;5.0;Radiology/Nuclear Medicine;**25,54,60,71,82,95,137**;Mar 16, 1998;Build 4
"RTN","RAHLRS",3,0)
 ;
"RTN","RAHLRS",4,0)
 ; Utility to RESEND HL7 messages
"RTN","RAHLRS",5,0)
 ;
"RTN","RAHLRS",6,0)
 ;Integration Agreements
"RTN","RAHLRS",7,0)
 ;----------------------
"RTN","RAHLRS",8,0)
 ;SENDA08^MAGDHLE (6761 - Private)
"RTN","RAHLRS",9,0)
 ;^MAG(2006.1, IHE flag (6860 - Private)
"RTN","RAHLRS",10,0)
 ;$$PATCH^XPDUTL(10141 - Supported)
"RTN","RAHLRS",11,0)
 ;
"RTN","RAHLRS",12,0)
 ;;02/14/2006 BAY/KAM RA*5*71 Add ability to update exam data to V/R
"RTN","RAHLRS",13,0)
 N RACNI,RADFN,RADTI,RARPT,X
"RTN","RAHLRS",14,0)
 ;
"RTN","RAHLRS",15,0)
 D SETVARS Q:$G(RAIMGTY)=""
"RTN","RAHLRS",16,0)
 ;
"RTN","RAHLRS",17,0)
 F  S X=$$RACNLU(.RADFN,.RADTI,.RACNI) Q:+X'>0  D  Q:QUIT<0
"RTN","RAHLRS",18,0)
 .D RESEND(RADFN,RADTI,RACNI,.QUIT)
"RTN","RAHLRS",19,0)
 Q
"RTN","RAHLRS",20,0)
 ;
"RTN","RAHLRS",21,0)
RACNLU(RADFN,RADTI,RACNI) ; Select Case Number
"RTN","RAHLRS",22,0)
 ;
"RTN","RAHLRS",23,0)
 N RANOSCRN S RANOSCRN="" ; Don't limit cases to current Imaging Type
"RTN","RAHLRS",24,0)
 S (RADFN,RADTI,RADFN)=""
"RTN","RAHLRS",25,0)
 D ^RACNLU
"RTN","RAHLRS",26,0)
 Q X
"RTN","RAHLRS",27,0)
 ;
"RTN","RAHLRS",28,0)
RESEND(RADFN,RADTI,RACNI,QUIT) ; re-send exam message(s) to HL7 subscribers
"RTN","RAHLRS",29,0)
 ;
"RTN","RAHLRS",30,0)
 N RAED,RASSSX,RARPST ;added RASSSX,RARPST, RA*5*95
"RTN","RAHLRS",31,0)
 ;
"RTN","RAHLRS",32,0)
 S QUIT=0
"RTN","RAHLRS",33,0)
 I '$D(DT) D ^%DT S DT=Y
"RTN","RAHLRS",34,0)
 ;
"RTN","RAHLRS",35,0)
 S RAED=$$RAED(RADFN,RADTI,RACNI)
"RTN","RAHLRS",36,0)
 S QUIT=$$OK(RADFN,RADTI,RACNI)
"RTN","RAHLRS",37,0)
 I QUIT>0 D
"RTN","RAHLRS",38,0)
 .I RAED[",REG," D
"RTN","RAHLRS",39,0)
 ..D EN^DDIOL("Re-sending 'EXAM REGISTERD' HL7 message...",,"!!,?6")
"RTN","RAHLRS",40,0)
 ..D REG^RAHLRPC
"RTN","RAHLRS",41,0)
 .I RAED[",CANCEL," D
"RTN","RAHLRS",42,0)
 ..D EN^DDIOL("Re-sending 'EXAM CANCELLED' HL7 message...",,"!,?6")
"RTN","RAHLRS",43,0)
 ..D CANCEL^RAHLRPC
"RTN","RAHLRS",44,0)
 .I RAED[",EXAM," D
"RTN","RAHLRS",45,0)
 ..S $P(^RADPT(RADFN,"DT",RADTI,"P",RACNI,0),"^",30)="" ;Reset sent flag
"RTN","RAHLRS",46,0)
 ..D EN^DDIOL("Re-sending 'EXAMINED' HL7 message...",,"!,?6")
"RTN","RAHLRS",47,0)
 ..N RAEXMDUN D 1^RAHLRPC ;*60 Newed RAEXMDUN to prevent variable leak
"RTN","RAHLRS",48,0)
 .I RAED[",RPT," D
"RTN","RAHLRS",49,0)
 ..D EN^DDIOL("Re-sending 'REPORT VERIFIED' HL7 message...",,"!,?6")
"RTN","RAHLRS",50,0)
 ..;If EF report, set up RASSSX() to exclude VR subscribers, RA*5*95
"RTN","RAHLRS",51,0)
 ..I $G(RARPST)="EF" D HLXMSG^RARTE5
"RTN","RAHLRS",52,0)
 ..D RPT^RAHLRPC
"RTN","RAHLRS",53,0)
 Q
"RTN","RAHLRS",54,0)
 ;
"RTN","RAHLRS",55,0)
RAED(RADFN,RADTI,RACNI) ; identify correct ^RAHLRPC entry point(s)
"RTN","RAHLRS",56,0)
 ;
"RTN","RAHLRS",57,0)
 ; removed RARPTST from new, RA*5*95
"RTN","RAHLRS",58,0)
 N RASTAT,RAIMTYP,RAORD,RETURN
"RTN","RAHLRS",59,0)
 S (RARPST,RASTAT)=""
"RTN","RAHLRS",60,0)
 ;
"RTN","RAHLRS",61,0)
 S RETURN=",REG,"
"RTN","RAHLRS",62,0)
 ;
"RTN","RAHLRS",63,0)
 S RASTAT=$$GET1^DIQ(70.03,RACNI_","_RADTI_","_RADFN,3,"I")
"RTN","RAHLRS",64,0)
 ;
"RTN","RAHLRS",65,0)
 S RAIMTYP=$$GET1^DIQ(72,+RASTAT,7)
"RTN","RAHLRS",66,0)
 S RAORD=$$GET1^DIQ(72,+RASTAT,3)
"RTN","RAHLRS",67,0)
 ;
"RTN","RAHLRS",68,0)
 S:RAORD=0 RETURN=RETURN_"CANCEL,"
"RTN","RAHLRS",69,0)
 ;
"RTN","RAHLRS",70,0)
 I $$GET1^DIQ(72,+RASTAT,8)="YES" D  ; Generate Examined HL7 Message
"RTN","RAHLRS",71,0)
 .S RETURN=RETURN_"EXAM,"
"RTN","RAHLRS",72,0)
 ;
"RTN","RAHLRS",73,0)
 I RETURN'[",EXAM," D
"RTN","RAHLRS",74,0)
 .; also check previous statuses for 'Generate Examined HL7 Message'
"RTN","RAHLRS",75,0)
 .F  S RAORD=$O(^RA(72,"AA",RAIMTYP,RAORD),-1) Q:+RAORD<1  D  Q:RETURN[",EXAM,"
"RTN","RAHLRS",76,0)
 ..S RASTAT=$O(^RA(72,"AA",RAIMTYP,RAORD,0))
"RTN","RAHLRS",77,0)
 ..I $$GET1^DIQ(72,+RASTAT,8)="YES" S RETURN=RETURN_"EXAM,"
"RTN","RAHLRS",78,0)
 ;
"RTN","RAHLRS",79,0)
 I RARPT]"" D  ; Check if Verified or Elect. Filed report exists
"RTN","RAHLRS",80,0)
 .S RARPST=$$GET1^DIQ(74,RARPT,5,"I")
"RTN","RAHLRS",81,0)
 .I "^V^EF^"[("^"_RARPST_"^") S RETURN=RETURN_"RPT," ;RA*5*95
"RTN","RAHLRS",82,0)
 ;
"RTN","RAHLRS",83,0)
 Q RETURN
"RTN","RAHLRS",84,0)
 ;
"RTN","RAHLRS",85,0)
OK(RADFN,RADTI,RACNI) ; Get User to confirm continue
"RTN","RAHLRS",86,0)
 ;
"RTN","RAHLRS",87,0)
 N X,RAEXST
"RTN","RAHLRS",88,0)
 ;
"RTN","RAHLRS",89,0)
 S RAEXST=$$GET1^DIQ(70.03,RACNI_","_RADTI_","_RADFN,3)
"RTN","RAHLRS",90,0)
 ;
"RTN","RAHLRS",91,0)
 S X="",$P(X,"=",70)=""
"RTN","RAHLRS",92,0)
 D EN^DDIOL(X,"","!?5")
"RTN","RAHLRS",93,0)
 S DIR("A")="Re-send all HL7 messages for this '"_RAEXST_"' case?"
"RTN","RAHLRS",94,0)
 S DIR(0)="Y",DIR("B")="YES" D ^DIR
"RTN","RAHLRS",95,0)
 I Y="^" Q -1
"RTN","RAHLRS",96,0)
 Q Y
"RTN","RAHLRS",97,0)
 ;
"RTN","RAHLRS",98,0)
SETVARS ; Setup key Rad/Nuc Med variables
"RTN","RAHLRS",99,0)
 ;
"RTN","RAHLRS",100,0)
 I $O(RACCESS(DUZ,""))="" D SETVARS^RAPSET1(0)
"RTN","RAHLRS",101,0)
 Q:'($D(RACCESS(DUZ))\10)  ; user does not have location access
"RTN","RAHLRS",102,0)
 I $G(RAIMGTY)="" D SETVARS^RAPSET1(1) K:$G(RAIMGTY)="" XQUIT
"RTN","RAHLRS",103,0)
 Q
"RTN","RAHLRS",104,0)
 ;
"RTN","RAHLRS",105,0)
RAADT ;Send patient demographic update (A47/A08) to PACS - P137/KLM
"RTN","RAHLRS",106,0)
 ;check if MAG*3*183 is installed
"RTN","RAHLRS",107,0)
 I '$$PATCH^XPDUTL("MAG*3.0*183") W !,"You need imaging patch MAG*3.0*183 installed to use this option!" Q
"RTN","RAHLRS",108,0)
 ;check if the IHE switch is on
"RTN","RAHLRS",109,0)
 I $$GET1^DIQ(2006.1,1,3.01,"I")'="Y" W !!,"IHE is not enabled!",!,"See MAG*3.0*183 patch instructions to setup/enable ADT messages to PACS." Q
"RTN","RAHLRS",110,0)
 W !!,"This option will send patient demographic updates for selected patients.",!
"RTN","RAHLRS",111,0)
 W !,"It is recommended that you task this if you select 'ALL' patients.",!!
"RTN","RAHLRS",112,0)
 N RADFN,DIR,Y
"RTN","RAHLRS",113,0)
 S RADIC="^RADPT(",RADIC(0)="QEAMZ",RAUTIL="RA PATA08"
"RTN","RAHLRS",114,0)
 S RADIC("A")="Select Patient(s): "
"RTN","RAHLRS",115,0)
 W !! D EN1^RASELCT(.RADIC,RAUTIL)
"RTN","RAHLRS",116,0)
 K DIC,RADIC,RAUTIL
"RTN","RAHLRS",117,0)
 I $O(^TMP($J,"RA PATA08",""))="" W !!?3,$C(7),"No Patient selected." G EXIT
"RTN","RAHLRS",118,0)
 S %=1 W !,"Would you like to task this Job" D YN^DICN G:%<1 EXIT
"RTN","RAHLRS",119,0)
 I %=1 D  G EXIT
"RTN","RAHLRS",120,0)
 .S ZTIO="",ZTSAVE("^TMP($J,""RA PATA08"",")=""
"RTN","RAHLRS",121,0)
 .S ZTDESC="Rad/Nuc Med Patient Demographic Update to PACS",ZTRTN="TADT^RAHLRS"
"RTN","RAHLRS",122,0)
 .D ^%ZTLOAD
"RTN","RAHLRS",123,0)
 .I $D(ZTSK) W !,"Task# "_ZTSK,!!
"RTN","RAHLRS",124,0)
 .Q
"RTN","RAHLRS",125,0)
TADT ;task entry or fall through
"RTN","RAHLRS",126,0)
 S RACT=0
"RTN","RAHLRS",127,0)
 S RAPN="" F  S RAPN=$O(^TMP($J,"RA PATA08",RAPN)) Q:RAPN=""  D
"RTN","RAHLRS",128,0)
 .S RADFN=0 F  S RADFN=$O(^TMP($J,"RA PATA08",RAPN,RADFN)) Q:RADFN=""  D
"RTN","RAHLRS",129,0)
 ..D SENDA08^MAGDHLE(RADFN)
"RTN","RAHLRS",130,0)
 ..S RACT=RACT+1
"RTN","RAHLRS",131,0)
 ..Q
"RTN","RAHLRS",132,0)
 .Q
"RTN","RAHLRS",133,0)
 I '$D(ZTQUEUED) W !!,"Demographic updates sent for "_RACT_" patients"
"RTN","RAHLRS",134,0)
EXIT K ^TMP($J,"RA PATA08"),RAPN,RADFN,ZTDESC,ZTRTN,RACT,ZTSAVE,ZTIO,ZTSK,ZTQUEUED,%
"RTN","RAHLRS",135,0)
 Q
"RTN","RAREG1")
0^3^B30837568^B30150241
"RTN","RAREG1",1,0)
RAREG1 ;HISC/CAH,FPT,DAD AISC/MJK,RMO-Register Patient ;16 Jan 2018 10:02 AM
"RTN","RAREG1",2,0)
 ;;5.0;Radiology/Nuclear Medicine;**7,21,93,137**;Mar 16, 1998;Build 4
"RTN","RAREG1",3,0)
 ; 07/15/2008 BAY/KAM rem call 249750 RA*5*93 Correct DIK Calls
"RTN","RAREG1",4,0)
ASKORD I $D(RAVSTFLG),$G(YY)]"",$P(YY,U,5) D ASET G PACS
"RTN","RAREG1",5,0)
 ; radparfl = 1 if user chose detail-to-parent conversion
"RTN","RAREG1",6,0)
 ; radparpr = ien of file 74 of parent proc to replace detail proc
"RTN","RAREG1",7,0)
 K RADPARPR,RADPARFL
"RTN","RAREG1",8,0)
 S RAOLP=0,RAOVSTS="3;5;8" W ! D ^RAORDS G Q1:$D(RAOUT) G EXAM:$D(RAORDS)
"RTN","RAREG1",9,0)
 S RARD("A")="Do you want to Request an Exam for "_RANME_"? ",RARD(0)="S",RARD(1)="Yes^enter a request.",RARD(2)="No^not enter a request.",RARD("B")=2 D SET^RARD K RARD G Q1:$E(X)'="Y"
"RTN","RAREG1",10,0)
 W !!?3,"...requesting an exam for ",RANME,"...",! D ^RAORD1
"RTN","RAREG1",11,0)
EXAM ;
"RTN","RAREG1",12,0)
 ; block mixture of single proc with parent procedures
"RTN","RAREG1",13,0)
 N RA6,RA7,RA8 S RA6="",RA7=0,RA8=0
"RTN","RAREG1",14,0)
 F  S RA6=$O(RAORDS(RA6)) Q:'RA6  S:$P($G(^RAMIS(71,$P(^RAO(75.1,+RAORDS(RA6),0),U,2),0)),U,6)="P" RA7=1 S:$P($G(^RAMIS(71,$P(^RAO(75.1,+RAORDS(RA6),0),U,2),0)),U,6)'="P" RA8=1
"RTN","RAREG1",15,0)
 I RA7,RA8 W !!?7,$C(7),"You may not register a mixture of single and parent procedures.",! G Q1
"RTN","RAREG1",16,0)
 ;
"RTN","RAREG1",17,0)
 I $G(RADPARFL) D  G:Y<1 Q1 ; process detail-to-parent
"RTN","RAREG1",18,0)
 . D PSETPNT^RAREG4
"RTN","RAREG1",19,0)
 . Q
"RTN","RAREG1",20,0)
 S RAPARENT=+$P($G(^RADPT(RADFN,"DT",RADTI,0)),U,5)
"RTN","RAREG1",21,0)
 K ^TMP($J,"RAREG1") S (RAEXIT,RAQUIT,RASKIPIT,RACNICNT)=0
"RTN","RAREG1",22,0)
 D RSBIT^RAREG3
"RTN","RAREG1",23,0)
 F RAOLP=1:1 S RAOIFN=$G(RAORDS(RAOLP)) Q:'RAOIFN!RAEXIT!RAQUIT  D
"RTN","RAREG1",24,0)
 . D PROCESS^RAREG4
"RTN","RAREG1",25,0)
 . Q
"RTN","RAREG1",26,0)
 I RAEXIT,RAPARENT D EXAMDEL^RAREG2
"RTN","RAREG1",27,0)
 I $D(^TMP($J,"RAREG1")) D UOSM^RAREG2
"RTN","RAREG1",28,0)
PACS I $D(^TMP($J,"RAREG1")) S RACNT=0 F  S RACNT=$O(^TMP($J,"RAREG1",RACNT)) Q:'RACNT  D
"RTN","RAREG1",29,0)
 .S RAREGTMP=$G(^TMP($J,"RAREG1",RACNT)),RADFN=$P(RAREGTMP,U,1),RADTI=$P(RAREGTMP,U,2),RACNI=$P(RAREGTMP,U,3)
"RTN","RAREG1",30,0)
 .D REG^RAHLRPC
"RTN","RAREG1",31,0)
 .Q
"RTN","RAREG1",32,0)
 K RAREGTMP
"RTN","RAREG1",33,0)
 D:$D(RADPARFL) CKDUPORD^RAREG2 ; ck for dupl procs in outstndg orders
"RTN","RAREG1",34,0)
Q I '$D(RAREC) W !!?3,$C(7),"No exams entered for this visit. Must delete..." S DA(1)=RADFN,DA=RADTI,DIK="^RADPT("_DA(1)_",""DT""," D ^DIK W "...deletion complete!" K RAPX
"RTN","RAREG1",35,0)
 D PRNRQ^RAREG3 ;print request when exam is registered - P137 /KLM
"RTN","RAREG1",36,0)
 D LABEL^RAREG3
"RTN","RAREG1",37,0)
Q1 D Q4^RAREG4
"RTN","RAREG1",38,0)
 G PAT^RAREG
"RTN","RAREG1",39,0)
 ;
"RTN","RAREG1",40,0)
 ;CN entry point is called every time a new case number is assigned.
"RTN","RAREG1",41,0)
 ;The next available CN and last date CN's were "recycled" is stored in
"RTN","RAREG1",42,0)
 ;^RA(79.2,1,"CN")=Next availabe CN ^ date last recycled.
"RTN","RAREG1",43,0)
 ;This routine uses the next available CN unless it has been used for
"RTN","RAREG1",44,0)
 ;the same exam date before (DUP checks for duplicate case/date pair).
"RTN","RAREG1",45,0)
 ;Then the next available CN is calculated and written to the first
"RTN","RAREG1",46,0)
 ;piece of ^RA(79.2,1,"CN").  The node is locked during this transaction.
"RTN","RAREG1",47,0)
CN ;VARIABLES RATYPE,RADT AND RASET MUST EXIST AT THIS POINT
"RTN","RAREG1",48,0)
 ; 11/05/2008 BAY/KAM rem call 273496 RA*5*93 Add lock timeout to next line
"RTN","RAREG1",49,0)
 L +^RA(79.2,RATYPE,"CN"):$S($G(DILOCKTM)>0:DILOCKTM,1:3) D CAL:'$D(^RA(79.2,RATYPE,"CN")),CAL:DT>$P(^("CN"),"^",2),CAL:+^("CN")>99999 S RAX=+^RA(79.2,RATYPE,"CN") D DUP
"RTN","RAREG1",50,0)
 ; need recalculate if DUP returns an over 99999 value
"RTN","RAREG1",51,0)
 I RAX>99999 D CAL S RAX=+^RA(79.2,RATYPE,"CN") D DUP
"RTN","RAREG1",52,0)
 I 'RASET S X=RAX G CNQ
"RTN","RAREG1",53,0)
 I $D(X),X'="N",X'=RAX W !!,$C(7),"New case number must be equal to '",RAX,"'. OK? YES// " R RANS:DTIME K X I RANS["N"!(RANS["n")!('$T) G CNQ
"RTN","RAREG1",54,0)
 S X=RAX
"RTN","RAREG1",55,0)
 ; get next available short case number for future registration
"RTN","RAREG1",56,0)
 ; re-set "CN" node if future short case number >99999
"RTN","RAREG1",57,0)
 ; NOTE1: find and store next free case number for future use 091300
"RTN","RAREG1",58,0)
 F RAJ=(^RA(79.2,RATYPE,"CN")+1):1 I '$D(^RADPT("AE",RAJ)) S ^("CN")=RAJ_"^"_$P(^RA(79.2,RATYPE,"CN"),"^",2) Q
"RTN","RAREG1",59,0)
 ; if the next free case no. for future use is >99999, need recalculate
"RTN","RAREG1",60,0)
 I +^RA(79.2,RATYPE,"CN")>99999 D CAL
"RTN","RAREG1",61,0)
CNQ L -^RA(79.2,RATYPE,"CN")
"RTN","RAREG1",62,0)
 I $D(X),X>99999 W !!?3,$C(7),"You have reached the maximum limit for case numbers (99,999).",!?3,"You must first complete/purge your old exams before you can proceed." K X
"RTN","RAREG1",63,0)
 K RAJ,RATYPE,RASET,RAX,RANS,RADT Q
"RTN","RAREG1",64,0)
DUP ;Check to prevent use of same case number/date pair ;ch
"RTN","RAREG1",65,0)
 ; both short and long case numbers will be checked for duplicates 091500
"RTN","RAREG1",66,0)
 S RADTE99=$S('$D(RADTE):"",1:$E(RADTE,4,5)_$E(RADTE,6,7)_$E(RADTE,2,3))
"RTN","RAREG1",67,0)
 I '$D(^RADPT("AE",RAX)),'$D(^RADPT("ADC",RADTE99_"-"_RAX)) G DUPQ
"RTN","RAREG1",68,0)
 ; also check ADC xref while searching for next available number 08/15/00
"RTN","RAREG1",69,0)
 ; note2: even though the current available case number is being
"RTN","RAREG1",70,0)
 ;        stored, the next free case number for future use will be
"RTN","RAREG1",71,0)
 ;        found and stored later, see note1 above     091300
"RTN","RAREG1",72,0)
 F RAJ=(^RA(79.2,RATYPE,"CN")+1):1 I '$D(^RADPT("AE",RAJ)),'$D(^RADPT("ADC",RADTE99_"-"_RAJ)) S ^("CN")=RAJ_"^"_$P(^RA(79.2,RATYPE,"CN"),"^",2) S RAX=+^RA(79.2,RATYPE,"CN") Q
"RTN","RAREG1",73,0)
DUPQ K RADTE99 Q
"RTN","RAREG1",74,0)
 ;
"RTN","RAREG1",75,0)
 ; the CAL section is called if :
"RTN","RAREG1",76,0)
 ;       there isn't a ^RA(79.2,RATYPE,"CN")
"RTN","RAREG1",77,0)
 ;   or  today's date is after the date in ^RA(79.2,RATYPE,"CN") piece 2
"RTN","RAREG1",78,0)
 ;   or  ^RA(79.2,RATYPE,"CN") piece 1 is > 99999, this is
"RTN","RAREG1",79,0)
 ;       checked in two places :
"RTN","RAREG1",80,0)
 ;         before using this piece 1 as the next case number
"RTN","RAREG1",81,0)
 ;         and after calculating future free case number
"RTN","RAREG1",82,0)
 ;   or  DUP section returns a case number > 99999
"RTN","RAREG1",83,0)
 ; 
"RTN","RAREG1",84,0)
 ; the first calculation starts from today's date and finds the date
"RTN","RAREG1",85,0)
 ; for the next Saturday
"RTN","RAREG1",86,0)
 ;      %Y=day of week, 6 being Saturday
"RTN","RAREG1",87,0)
 ;
"RTN","RAREG1",88,0)
 ; the second calculation starts from ^RADPT("AE",1 and finds the
"RTN","RAREG1",89,0)
 ; lowest  n  where  ^RADPT("AE",n) doesn't exist anymore.
"RTN","RAREG1",90,0)
 ;
"RTN","RAREG1",91,0)
 ; then the results are used to replace ^RA(79.2,RATYPE,"CN")
"RTN","RAREG1",92,0)
 ;     where
"RTN","RAREG1",93,0)
 ;       piece  1  is the next free case number
"RTN","RAREG1",94,0)
 ;       piece  2  is the date for next Saturday
"RTN","RAREG1",95,0)
 ;       RATYPE is always  1   by design
"RTN","RAREG1",96,0)
 ;
"RTN","RAREG1",97,0)
CAL K RAXX S:$D(X) RAXX=X S RAX=DT F RAII=0:0 S X1=RAX,X2=1 D C^%DTC S RAX=X D H^%DTC Q:%Y=6
"RTN","RAREG1",98,0)
 D YMD^%DTC F RAJ=1:1 I '$D(^RADPT("AE",RAJ)) S ^RA(79.2,RATYPE,"CN")=RAJ_"^"_X S:$D(RAXX) X=RAXX Q
"RTN","RAREG1",99,0)
 K RAJ,RAXX,RAX,RAII Q
"RTN","RAREG1",100,0)
PROC(Y) Q $P($G(^RAMIS(71,+Y,0)),U)
"RTN","RAREG1",101,0)
ASET ; register extra cases for a exam/print set that has no VALID report yet
"RTN","RAREG1",102,0)
 ; there may be a stub report from imaging for this set
"RTN","RAREG1",103,0)
 S RAREC="" ; prevent Q  from deleting the exam at "DT" level
"RTN","RAREG1",104,0)
 S (RAEXIT,RAQUIT,RASKIPIT,RACNICNT)=0 K ^TMP($J,"RAREG1")
"RTN","RAREG1",105,0)
 N RAFIRST S RAFIRST=$O(^RADPT(RADFN,"DT",RADTI,"P",0)) Q:'RAFIRST
"RTN","RAREG1",106,0)
 S RAOIFN=$P(^RADPT(RADFN,"DT",RADTI,"P",RAFIRST,0),"^",11) ;imagg order ien
"RTN","RAREG1",107,0)
 N DIR
"RTN","RAREG1",108,0)
PS1 S DIR(0)="Y",DIR("A")="For "_RANME_"'s exam set -- register another descendent exam (Y/N)"
"RTN","RAREG1",109,0)
 W ! D ^DIR Q:'Y
"RTN","RAREG1",110,0)
 N RAPARENT S RAPARENT=1 D ORDER^RAREG2 ;preserve EXAM SET stored data
"RTN","RAREG1",111,0)
 Q:RAQUIT  ;6/18/96
"RTN","RAREG1",112,0)
 K RAPRC S RAPARENT=1 D EXAMLOOP^RAREG2 ;prevent undef RAPROC in EXAMLOOP
"RTN","RAREG1",113,0)
 ; RACNI is set by edit tmpl that's used in EXAMLOOP^RAREG2
"RTN","RAREG1",114,0)
 ; quit if registration was incomplete <-- rareg2 deleted entire case
"RTN","RAREG1",115,0)
 Q:'$G(^RADPT(RADFN,"DT",RADTI,"P",RACNI,0))
"RTN","RAREG1",116,0)
 S RAPROC=$P($G(^RAO(75.1,+$G(RAOIFN),0)),U,2) ;ien of parent procedure
"RTN","RAREG1",117,0)
 ; set value of MEMBER OF SET
"RTN","RAREG1",118,0)
 ;    can't call memset^rareg2 to set MEMBER OF SET, due possiblity of
"RTN","RAREG1",119,0)
 ;    orig. proc being a single procedure that got converted to printset
"RTN","RAREG1",120,0)
 N RA25 S RA25=$P($G(^RADPT(RADFN,"DT",RADTI,"P",RAFIRST,0)),U,25)
"RTN","RAREG1",121,0)
 I RA25 N D,D0,DA,DI,DIC,DIE,DQ,DR,X,Y S DA(2)=RADFN,DA(1)=RADTI,DA=RACNI,DR="25///"_RA25,DIE="^RADPT("_RADFN_",""DT"","_RADTI_",""P""," D ^DIE
"RTN","RAREG1",122,0)
 G:RA25'=2 PS1
"RTN","RAREG1",123,0)
 ; combined report need more processing
"RTN","RAREG1",124,0)
 G:'$G(RA17) PS1 G:'$D(^RARPT(+$G(RA17),0))#2 PS1
"RTN","RAREG1",125,0)
 ; since there's a stub rpt from imaging (RA17), set piece 17
"RTN","RAREG1",126,0)
 D SET17^RAREG2(RADFN,RADTI,RACNI)
"RTN","RAREG1",127,0)
 ; copy over any dx/res/staff
"RTN","RAREG1",128,0)
 D COPYFROM^RAREG2(RACNI)
"RTN","RAREG1",129,0)
 ; insert rec in 74.05
"RTN","RAREG1",130,0)
 N RARPT,RARPTN,RA1,RAFDA,RAIEN,RAMSG,RAERR,RAXIT
"RTN","RAREG1",131,0)
 S RARPT=RA17,RARPTN=$P(^RARPT(RARPT,0),U),RA1=$P($G(^RADPT(RADFN,"DT",RADTI,"P",RACNI,0)),U)
"RTN","RAREG1",132,0)
 D:RA1 INSERT^RARTE2
"RTN","RAREG1",133,0)
 G PS1
"RTN","RAREG3")
0^4^B29955259^B17775791
"RTN","RAREG3",1,0)
RAREG3 ;HISC/CAH,DAD,FPT,GJC-Register Rad/NM Patient (cont.) ;16 Jan 2018 10:04 AM
"RTN","RAREG3",2,0)
 ;;5.0;Radiology/Nuclear Medicine;**8,137**;Mar 16, 1998;Build 4
"RTN","RAREG3",3,0)
 ;
"RTN","RAREG3",4,0)
RSBIT ; renumber selections by imaging type
"RTN","RAREG3",5,0)
 ; The RAORDS array has the list of orders the user selected to register
"RTN","RAREG3",6,0)
 ; in the order the user entered them. This subroutine will reorganize
"RTN","RAREG3",7,0)
 ; the array so the orders are arranged by imaging type of their
"RTN","RAREG3",8,0)
 ; procedure starting with the imaging type the user is currently signed
"RTN","RAREG3",9,0)
 ; on with followed by the ascending internal entry number of the
"RTN","RAREG3",10,0)
 ; remaining imaging types.
"RTN","RAREG3",11,0)
 ;
"RTN","RAREG3",12,0)
 Q:'$D(RAORDS)
"RTN","RAREG3",13,0)
 K RALOOP,RAORDST
"RTN","RAREG3",14,0)
 F RALOOP=1:1 Q:'$D(RAORDS(RALOOP))  D
"RTN","RAREG3",15,0)
 .S RAON=+$P(RAORDS(RALOOP),U,1) Q:'RAON
"RTN","RAREG3",16,0)
 .S RAPN=+$P(^RAO(75.1,RAON,0),U,2) Q:'RAPN
"RTN","RAREG3",17,0)
 .S RAIN=+$P(^RAMIS(71,RAPN,0),U,12) Q:'RAIN
"RTN","RAREG3",18,0)
 .S RAORDST(RAIN,RALOOP)=RAON
"RTN","RAREG3",19,0)
 .Q
"RTN","RAREG3",20,0)
 S RAIMGTYN=+$O(^RA(79.2,"B",RAIMGTY,0)) Q:'RAIMGTYN
"RTN","RAREG3",21,0)
 K RAORDS S (RALOOP,RAIN)=0
"RTN","RAREG3",22,0)
 I $D(RAORDST(RAIMGTYN)) F  S RAIN=$O(RAORDST(RAIMGTYN,RAIN)) Q:'RAIN  S RALOOP=RALOOP+1,RAORDS(RALOOP)=+RAORDST(RAIMGTYN,RAIN) K RAORDST(RAIMGTYN,RAIN)
"RTN","RAREG3",23,0)
 I $D(RAORDST) S RAIMGTYN=0 F  S RAIMGTYN=$O(RAORDST(RAIMGTYN)) Q:'RAIMGTYN  S RAIN=0 F  S RAIN=$O(RAORDST(RAIMGTYN,RAIN)) Q:'RAIN  S RALOOP=RALOOP+1,RAORDS(RALOOP)=+RAORDST(RAIMGTYN,RAIN)
"RTN","RAREG3",24,0)
 K RAIMGTYN,RAIN,RALOOP,RAON,RAORDST,RAPN
"RTN","RAREG3",25,0)
 Q
"RTN","RAREG3",26,0)
SETDISV ; when registering procedures of different imaging types set imaging
"RTN","RAREG3",27,0)
 ; location default value in DIC("B") if only one location associated with
"RTN","RAREG3",28,0)
 ; imaging type.
"RTN","RAREG3",29,0)
 N RACNT,RAITNHLD,RAITNXT,RALOOP
"RTN","RAREG3",30,0)
 S (RACNT,RAITNXT)=0
"RTN","RAREG3",31,0)
 F RALOOP=0:0 S RAITNXT=$O(^RA(79.1,"BIMG",RAITN,RAITNXT)) Q:'RAITNXT  S RACNT=RACNT+1,RAITNHLD=RAITNXT
"RTN","RAREG3",32,0)
 ;I RACNT=1 S ^DISV(+DUZ,"^RA(79.1,")=RAITNHLD
"RTN","RAREG3",33,0)
 I RACNT=1,RAITNHLD,$G(^RA(79.1,RAITNHLD,0))]"" S DIC("B")=$P($G(^SC(+^(0),0)),"^")
"RTN","RAREG3",34,0)
 Q
"RTN","RAREG3",35,0)
SL ; switch locations
"RTN","RAREG3",36,0)
 ; Prompt the user to switch locations if the current sign-on imaging
"RTN","RAREG3",37,0)
 ; type does not match the procedure's imaging type.
"RTN","RAREG3",38,0)
 ; comment out 06/10/97 D EXAMSET^RAREG2 S RAPARENT=0
"RTN","RAREG3",39,0)
 S RAITN=$P(^RAMIS(71,+$P(Y,U,2),0),U,12)
"RTN","RAREG3",40,0)
 I RAITN'=+$O(^RA(79.2,"B",RAIMGTY,0)) D
"RTN","RAREG3",41,0)
 .S RAMLCHLD=RAMLC,RAYHOLD=Y,RAPROLOC=$P(^RA(79.2,RAITN,0),U,1),RAMDIVHD=RAMDIV
"RTN","RAREG3",42,0)
 .D LABEL
"RTN","RAREG3",43,0)
 .W !!?7,"Current Imaging Type: ",RAIMGTY
"RTN","RAREG3",44,0)
 .W !?5,"Procedure Imaging Type: ",RAPROLOC
"RTN","RAREG3",45,0)
 .W !!,"You must switch to a location of ",RAPROLOC," imaging type.",!!
"RTN","RAREG3",46,0)
 .D SETDISV
"RTN","RAREG3",47,0)
 .K RAMLC S RASWLOC=""
"RTN","RAREG3",48,0)
 .D SET^RAPSET1
"RTN","RAREG3",49,0)
 .K RASWLOC
"RTN","RAREG3",50,0)
 .I '$D(RAMLC) S RAQUIT=1,RAMLC=RAMLCHLD Q
"RTN","RAREG3",51,0)
 .I RAMDIVHD'=RAMDIV W !!,"You have switched Divisions from: ",$P(^DIC(4,+RAMDIVHD,0),U),!,?30,"to: ",$P(^DIC(4,+RAMDIV,0),U),!
"RTN","RAREG3",52,0)
 .D DT Q:RAQUIT
"RTN","RAREG3",53,0)
 .S Y=RAYHOLD
"RTN","RAREG3",54,0)
 .Q
"RTN","RAREG3",55,0)
 K RAITN,RAMDIVHD,RAMLCHLD,RAPROLOC,RAYHOLD
"RTN","RAREG3",56,0)
 Q
"RTN","RAREG3",57,0)
DT ; prompt for new imaging date/time when imaging type changes
"RTN","RAREG3",58,0)
 Q:'$D(^RADPT(RADFN,"DT",RADTI,0))
"RTN","RAREG3",59,0)
 N RAHRS S RAHRS=+$P($G(^RA(79,+RAMDIV,.1)),"^",24) ;How many hrs in adv?
"RTN","RAREG3",60,0)
 R !!,"Imaging Exam Date/Time: NOW// ",X:DTIME
"RTN","RAREG3",61,0)
 I '$T!(X=" ")!(X="^") S RAQUIT=1 Q
"RTN","RAREG3",62,0)
 S:X="" RANOW="",X="NOW"
"RTN","RAREG3",63,0)
 I X="NOW" S RADTICHK=9999999.9999-($E($$NOW^XLFDT,1,12)) I $D(^RADPT(RADFN,"DT",RADTICHK,0)) D SUB1MIN K RADTICHK
"RTN","RAREG3",64,0)
 S %DT(0)=-$$FMADD^XLFDT($$NOW^XLFDT,0,RAHRS,0,0),%DT="ETXR"
"RTN","RAREG3",65,0)
 D ^%DT K %DT G DT:Y<0
"RTN","RAREG3",66,0)
DT1 S RADTE=Y,RADTI=9999999.9999-RADTE I $D(^RADPT(RADFN,"DT",RADTI,0)) W !,$C(7),"Patient already has exams entered for this date/time.",!,"....use 'Add Exams to Last Visit' option." G DT
"RTN","RAREG3",67,0)
DT2 K RADTEBAD S RADTEBAD=$O(^RADPT(RADFN,"DT","B",RADTE)) I RADTEBAD[RADTE D SUB1MIN S RADTE=X,RADTI=RADTICHK G DT2
"RTN","RAREG3",68,0)
 K RADTEBAD
"RTN","RAREG3",69,0)
 I $D(RANOW),$D(RAWARD) S RACAT="INPATIENT"
"RTN","RAREG3",70,0)
 I '$D(RANOW) K RAWARD,RABED,RASER D ^RASERV S:$D(RAWARD) RACAT="INPATIENT"
"RTN","RAREG3",71,0)
 Q
"RTN","RAREG3",72,0)
SUB1MIN ; subtract 1 minute from NOW to get an unused date/time
"RTN","RAREG3",73,0)
 F RALOOP=1:1 S X=$$FMADD^XLFDT(RADTE,0,0,-RALOOP,0) S RADTICHK=9999999.9999-X Q:'$D(^RADPT(RADFN,"DT",RADTICHK,0))
"RTN","RAREG3",74,0)
 K RALOOP
"RTN","RAREG3",75,0)
 Q
"RTN","RAREG3",76,0)
 ;
"RTN","RAREG3",77,0)
LABEL ; *** Print labels
"RTN","RAREG3",78,0)
 I $D(RAPX) D
"RTN","RAREG3",79,0)
 . W ! S RAPX=RADFN,RAZIS=1
"RTN","RAREG3",80,0)
 . S RASAV2=$G(^RADPT(+$G(RADFN),"DT",+$G(RADTI),0))
"RTN","RAREG3",81,0)
 . S RASAV3=$G(^RADPT(+$G(RADFN),"DT",+$G(RADTI),"P",$S($G(RACNI):RACNI,1:+$O(^RADPT(+$G(RADFN),"DT",+$G(RADTI),"P",0))),0))
"RTN","RAREG3",82,0)
 . D FLH^RAFLH K RANUMF
"RTN","RAREG3",83,0)
 . I $P(RAMDV,U,8) D JAC^RAJAC
"RTN","RAREG3",84,0)
 . S RADFN=RAPX K RAZIS
"RTN","RAREG3",85,0)
 . I $P($G(^DIC(195.4,1,"UP")),U,2) D ^RTQ5
"RTN","RAREG3",86,0)
 . K RAPX
"RTN","RAREG3",87,0)
 . Q
"RTN","RAREG3",88,0)
 Q
"RTN","RAREG3",89,0)
 ;
"RTN","RAREG3",90,0)
PRNRQ ;Print Request at Registration - P137/KLM
"RTN","RAREG3",91,0)
 I '$D(RAPX) Q  ;registration process aborted
"RTN","RAREG3",92,0)
 I '$D(RAORDS) Q  ;no order array
"RTN","RAREG3",93,0)
 N RAJ,RAOIFN,RAILOC,RAION,RAARY
"RTN","RAREG3",94,0)
 S RAJ=0 F  S RAJ=$O(RAORDS(RAJ)) Q:RAJ=""  D
"RTN","RAREG3",95,0)
 .S RAOIFN=$G(RAORDS(RAJ)) Q:RAOIFN=""
"RTN","RAREG3",96,0)
 .S RAILOC=$$GET1^DIQ(75.1,RAOIFN,20,"I") Q:RAILOC=""  ;get i-loc from order
"RTN","RAREG3",97,0)
 .S RAION=$$GET1^DIQ(79.1,RAILOC,28) Q:RAION=""  ;Registered Request printer defined?
"RTN","RAREG3",98,0)
 .;Orders for registered exams may span modalities
"RTN","RAREG3",99,0)
 .;order status is active/registered - build RAARY(DEVICE NAME,ORDER IEN)
"RTN","RAREG3",100,0)
 .I $$GET1^DIQ(75.1,RAOIFN,5,"I")=6 S RAARY(RAION,RAOIFN)=""
"RTN","RAREG3",101,0)
 .;End RAJ loop on RAORDS
"RTN","RAREG3",102,0)
 ;Setup task vars for each reg req device with orders
"RTN","RAREG3",103,0)
 I $D(RAARY) D
"RTN","RAREG3",104,0)
 .S RAION="" F  S RAION=$O(RAARY(RAION)) Q:RAION=""  D
"RTN","RAREG3",105,0)
 ..N RAORS
"RTN","RAREG3",106,0)
 ..S ZTIO=RAION
"RTN","RAREG3",107,0)
 ..S RAOIFN=0 F  S RAOIFN=$O(RAARY(RAION,RAOIFN)) Q:RAOIFN=""  D
"RTN","RAREG3",108,0)
 ...S RAORS(RAOIFN)=""
"RTN","RAREG3",109,0)
 ...;End RAOIFN loop - Order IEN
"RTN","RAREG3",110,0)
 ..S ZTDESC="Rad/Nuc Med Registered Request Print"
"RTN","RAREG3",111,0)
 ..S ZTDTH=$H,ZTRTN="PRNRQ1^RAREG3"
"RTN","RAREG3",112,0)
 ..S ZTSAVE("RADFN")="",ZTSAVE("RAORS(")="" D ^%ZTLOAD
"RTN","RAREG3",113,0)
 ..K ZTIO,ZTDTH,ZTSAVE,ZTDESC,ZTRTN
"RTN","RAREG3",114,0)
 ..I $D(ZTSK) W !!,"Task "_ZTSK_": registered request(s) queued to print on device ",RAION,!
"RTN","RAREG3",115,0)
 ..;End RAION loop - Device Name
"RTN","RAREG3",116,0)
 .;End RAARY
"RTN","RAREG3",117,0)
 K RAORS,RAION,RAJ,RAILOC,RAARY,RAOIFN
"RTN","RAREG3",118,0)
 Q
"RTN","RAREG3",119,0)
PRNRQ1 ;task entry point - P137
"RTN","RAREG3",120,0)
 N RAPAGE,RAX,RAOIFN
"RTN","RAREG3",121,0)
 S RAPAGE=0,RAX="" ;needed for ^RAORD5
"RTN","RAREG3",122,0)
 S RAOIFN=0 F  S RAOIFN=$O(RAORS(RAOIFN)) Q:RAOIFN=""  D
"RTN","RAREG3",123,0)
 .U IO D ^RAORD5
"RTN","RAREG3",124,0)
 K RAPAGE,RAX,RAOIFN
"RTN","RAREG3",125,0)
 Q
"RTN","RASITE")
0^2^B13056737^B12723351
"RTN","RASITE",1,0)
RASITE ;HISC/CAH,FPT,GJC AISC/MJK,RMO-IRM Menu ;16 Jun 2017 1:58 PM
"RTN","RASITE",2,0)
 ;;5.0;Radiology/Nuclear Medicine;**137**;Mar 16, 1998;Build 4
"RTN","RASITE",3,0)
2 ;;Device Specifications
"RTN","RASITE",4,0)
 F  D  Q:%
"RTN","RASITE",5,0)
 . W !!,"Do you want to see a 'help' message on printer assignment"
"RTN","RASITE",6,0)
 . S %=2 D YN^DICN
"RTN","RASITE",7,0)
 . I %=0 W !!?3,"Enter 'Yes' to see the help message, or 'No' not to."
"RTN","RASITE",8,0)
 . Q
"RTN","RASITE",9,0)
 I %=-1 D Q2 QUIT
"RTN","RASITE",10,0)
 I %=1 D DEVHLP
"RTN","RASITE",11,0)
21 ; Select a location and answer the default printer prompts.
"RTN","RASITE",12,0)
 W ! S DIC="^RA(79.1,",DIC(0)="AELMQ",DIC("A")="Select Imaging Location: ",DLAYGO=79.1 D ^DIC K DIC,DLAYGO G Q2:Y<0
"RTN","RASITE",13,0)
 S DA=+Y,DIE="^RA(79.1,",DR="[RA SITE MANAGER]" D ^DIE
"RTN","RASITE",14,0)
 K DE,DQ,DIE,DR D Q2 G 21
"RTN","RASITE",15,0)
Q2 K %,%W,%X,%Y,C,D,D0,D1,DA,DI,DIWF,DIWL,DIW,DIWR,DIWT,DLAYGO,DN,I,POP,RAI,RAJ,X,Y,Z
"RTN","RASITE",16,0)
 K DISYS,RA791,RA792
"RTN","RASITE",17,0)
 Q
"RTN","RASITE",18,0)
 ;
"RTN","RASITE",19,0)
3 ;;Failsoft Parameters
"RTN","RASITE",20,0)
 S DIC="^RA(79.2,",DIC(0)="AEMQ" D ^DIC K DIC G:Y<0 Q3 S DA=+Y,DIE="^RA(79.2,",DIE("NO^")="",DR="[RA IMAGE PARAMETERS]" D ^DIE K %,%DT,%X,%Y,D,D0,D1,DA,DE,DI,DLAYGO,DQ,DIE,DR,DIC,X
"RTN","RASITE",21,0)
Q3 K I,POP,DDER,DDH,DISYS Q
"RTN","RASITE",22,0)
 ;
"RTN","RASITE",23,0)
5 ;;Imaging Type Activity Log
"RTN","RASITE",24,0)
 S L=0,DIC="^RA(79.2,",FLDS="[RA ACTIVITY LOG]",FR="A",TO="ZZZZ",BY="#.01" D EN1^DIP K FR,TO,FLDS,BY,DHD,POP Q
"RTN","RASITE",25,0)
 ;
"RTN","RASITE",26,0)
DD71 ;entry point for input transform, 71.03, .01 field
"RTN","RASITE",27,0)
 ;imaging type in procedure file should have associated AMIS codes
"RTN","RASITE",28,0)
 ; radiology - AMIS codes ien's are 1:26
"RTN","RASITE",29,0)
 ; nuclear medicine - AMIS codes ien is 25:27
"RTN","RASITE",30,0)
 Q:'$D(DA(1))
"RTN","RASITE",31,0)
 N RAIMAG,RAIMAGA S RAIMAG=$$ITYPE(DA(1)),RAIMAGA=$P(RAIMAG,U,3)
"RTN","RASITE",32,0)
 Q:$S(RAIMAGA="NM"&(X=25):1,RAIMAGA="NM"&(X=26):1,RAIMAGA="NM"&(X=27):1,RAIMAGA'="NM"&(X'>26):1,1:0)
"RTN","RASITE",33,0)
 W !?5,"Select Radiology AMIS codes for Radiology imaging type procedures,",!?5,"Nuclear Medicine AMIS codes for Nuclear Medicine procedures",*7
"RTN","RASITE",34,0)
 K X Q
"RTN","RASITE",35,0)
ITYPE(X) ;get image type for procedure in 71
"RTN","RASITE",36,0)
 ;INPUT = IEN of Rad/Nuc Med Procedure file, in X
"RTN","RASITE",37,0)
 ;OUTPUT = IEN of imaging type file (79.2)^name (.01)^abbreviation (3)
"RTN","RASITE",38,0)
 S RASERIES=$S($P($G(^RAMIS(71,+X,0)),U,6)="S":1,1:0)
"RTN","RASITE",39,0)
 S X=+$P($G(^RAMIS(71,X,0)),U,12)
"RTN","RASITE",40,0)
 Q $$IMAG(X)
"RTN","RASITE",41,0)
IMAG(X) ;set string of passed image type
"RTN","RASITE",42,0)
 ;INPUT=ien of image type, in x
"RTN","RASITE",43,0)
 ;OUTPUT=Internal Entry Number of image type^name (.01)^abbreviation (3)
"RTN","RASITE",44,0)
 N Y
"RTN","RASITE",45,0)
 S Y=$G(^RA(79.2,X,0))
"RTN","RASITE",46,0)
 Q +X_U_$P(Y,U)_U_$P(Y,U,3)
"RTN","RASITE",47,0)
DEVHLP ; Display printer assignment help text to the user.
"RTN","RASITE",48,0)
 ;Add registered request printer to help text -P137/KLM
"RTN","RASITE",49,0)
 D HOME^%ZIS W @IOF
"RTN","RASITE",50,0)
 W !,"Default Printer Assignments:",!,"----------------------------"
"RTN","RASITE",51,0)
 W !,"There are seven imaging location parameters that the coordinator will"
"RTN","RASITE",52,0)
 W !,"not be able to enter.  They are the default printers; specifically, the"
"RTN","RASITE",53,0)
 W !,"default flash card/exam label, jacket label, request, registered request,"
"RTN","RASITE",54,0)
 W !,"request cancellation, radiopharmaceutical dosage ticket, and report printers."
"RTN","RASITE",55,0)
 W !,"Once you have assigned these printer names to a location, the module"
"RTN","RASITE",56,0)
 W !,"will automatically route output to the appropriate printer without having"
"RTN","RASITE",57,0)
 W !,"to ask the user. NOTE:  If you have more than one imaging location within"
"RTN","RASITE",58,0)
 W !,"an imaging type the Division parameter 'Ask Imaging Location' must be set"
"RTN","RASITE",59,0)
 W !,"to 'yes' in order to print cancelled requests on the request cancellation"
"RTN","RASITE",60,0)
 W !,"printer."
"RTN","RASITE",61,0)
 Q
"RTN","RASTEXT")
0^10^B35874954^B34738271
"RTN","RASTEXT",1,0)
RASTEXT ;HISC/CAH,FPT,GJC AISC/TMP,TAC,RMO-Called by Status Tracking display,edit. Allow selection/edit of case if called from edit option ;18 Dec 2017 12:39 PM
"RTN","RASTEXT",2,0)
 ;;5.0;Radiology/Nuclear Medicine;**48,47,137**;Mar 16, 1998;Build 4
"RTN","RASTEXT",3,0)
 S RAED=1 ;If called from beginning of routine, allow case edit
"RTN","RASTEXT",4,0)
 ;If called at EN1, display exams by status but don't allow editing
"RTN","RASTEXT",5,0)
EN1 D SET^RAPSET1 I $D(XQUIT) K RAED,XQUIT Q
"RTN","RASTEXT",6,0)
 D HOME^%ZIS S:'$D(RAED) RAED=0 S (RACTR,RAORD,RAXIT)=0 K RASTAT,RADTI
"RTN","RASTEXT",7,0)
 N RADLOCS,RAQUIT,RATEMP,RATOTAL S (RATOTAL,X)=0
"RTN","RASTEXT",8,0)
 F  S X=$O(^RA(79.1,X)) Q:X'>0  D
"RTN","RASTEXT",9,0)
 . S Y=$G(^RA(79.1,X,0)),Y(6)=+$P(Y,U,6) Q:'Y(6)
"RTN","RASTEXT",10,0)
 . I $D(RACCESS(DUZ,"LOC",+X)),(Y(6)=+$O(^RA(79.2,"B",RAIMGTY,0))),($D(RACCESS(DUZ,"DIV",+RAMDIV,X))) D
"RTN","RASTEXT",11,0)
 .. S RATOTAL=RATOTAL+1,RATEMP=$P($G(^SC(+$P(Y,"^"),0)),"^")_"^"_X
"RTN","RASTEXT",12,0)
 .. Q
"RTN","RASTEXT",13,0)
 . Q
"RTN","RASTEXT",14,0)
 I 'RATOTAL D  D Q QUIT
"RTN","RASTEXT",15,0)
 . W !?5,"Your access to Imaging Locations is nonexistent."
"RTN","RASTEXT",16,0)
 . W !?5,"Contact your ADPAC for further assistance."
"RTN","RASTEXT",17,0)
 . Q
"RTN","RASTEXT",18,0)
 W !!?5,"Current Division: ",$P(^DIC(4,+RAMDIV,0),U,1)
"RTN","RASTEXT",19,0)
 W !?5,"Current Imaging Type: ",RAIMGTY,!
"RTN","RASTEXT",20,0)
 I RATOTAL=1 D
"RTN","RASTEXT",21,0)
 . N DIR,DIROUT,DIRUT,DTOUT,DUOUT S DIR(0)="E" D ^DIR
"RTN","RASTEXT",22,0)
 . S:'+Y RAXIT=1 Q:RAXIT
"RTN","RASTEXT",23,0)
 . S ^TMP($J,"RADLOCS",$P(RATEMP,"^"),$P(RATEMP,"^",2))=""
"RTN","RASTEXT",24,0)
 . S RADLOCS($P(RATEMP,"^"),$P(RATEMP,"^",2))="",RAQUIT=0
"RTN","RASTEXT",25,0)
 . Q
"RTN","RASTEXT",26,0)
 I RAXIT D Q QUIT
"RTN","RASTEXT",27,0)
 K X,Y I RATOTAL>1 D
"RTN","RASTEXT",28,0)
 . N RAARRY,RADIC,RAUTIL
"RTN","RASTEXT",29,0)
 . S RADIC="^RA(79.1,",(RAARRY,RAUTIL)="RADLOCS",RADIC(0)="QEAFMZ"
"RTN","RASTEXT",30,0)
 . S RADIC("A")="Select the Location(s) you wish to track: "
"RTN","RASTEXT",31,0)
 . S RADIC("B")="All"
"RTN","RASTEXT",32,0)
 . S RADIC("S")="I $D(RACCESS(DUZ,""DIV"",+RAMDIV,+Y)),(+$P(^(0),""^"",6)=+$O(^RA(79.2,""B"",RAIMGTY,0)))"
"RTN","RASTEXT",33,0)
 . D EN1^RASELCT(.RADIC,RAUTIL,RAARRY)
"RTN","RASTEXT",34,0)
 . Q
"RTN","RASTEXT",35,0)
 I +$G(RAQUIT) D Q Q
"RTN","RASTEXT",36,0)
 K ^TMP($J,"RADLOCS")
"RTN","RASTEXT",37,0)
 S RAIMGTYI=$O(^RA(79.2,"B",RAIMGTY,0)) G Q:'RAIMGTYI
"RTN","RASTEXT",38,0)
 ; set up RASEQARR(order seq)=ien of file 72
"RTN","RASTEXT",39,0)
 ; if order seq is null, set it to -1, -2, etc., so each img typ gets
"RTN","RASTEXT",40,0)
 ; gets a different negative subscript to represent a null order seq
"RTN","RASTEXT",41,0)
 S X=0 F  S X=$O(^RADPT("AS",X)) Q:X'=+X  I $P($G(^RA(72,X,0)),U,7)=RAIMGTYI,$P(^(0),U,5)="Y" S RAX=$P(^(0),U,3) D:RAX=""  S RASEQARR(RAX)=X
"RTN","RASTEXT",42,0)
 . S RAX=$O(RASEQARR(""))
"RTN","RASTEXT",43,0)
 . I RAX>0 S RAX=-1 Q
"RTN","RASTEXT",44,0)
 . S:RAX<0 RAX=RAX-1
"RTN","RASTEXT",45,0)
 S RAORD=""
"RTN","RASTEXT",46,0)
 F  K ^TMP($J,"RASTEXT") S RAORD=$O(RASEQARR(RAORD)) Q:RAORD=""!(RAORD>8)  S RASTAT=RASEQARR(RAORD) I $D(^RA(72,+RASTAT,0)),$P(^(0),"^",5)="Y" D START I RACTR S RACTR=0 D SCRN Q:RAQ
"RTN","RASTEXT",47,0)
 I 'RACTR&('$D(RADTI)) W *7,!,"No incomplete statuses on file"
"RTN","RASTEXT",48,0)
 G Q
"RTN","RASTEXT",49,0)
START S (RACTR,RAQ)=0 F RADFN=0:0 S RADFN=$O(^RADPT("AS",RASTAT,RADFN)) Q:RADFN'>0  F RADTI=0:0 S RADTI=$O(^RADPT("AS",RASTAT,RADFN,RADTI)) Q:RADTI'>0  I $D(^RADPT(RADFN,"DT",RADTI,0)) S Y=^(0) D GETCN
"RTN","RASTEXT",50,0)
 Q
"RTN","RASTEXT",51,0)
GETCN Q:'$D(^RA(79.1,+$P(Y,"^",4),0))  ;If imaging loc is broken pointer
"RTN","RASTEXT",52,0)
 Q:'$D(RADLOCS($P($G(^SC(+$P($G(^RA(79.1,+$P(Y,"^",4),0)),"^"),0)),"^")))
"RTN","RASTEXT",53,0)
 F RACNI=0:0 S RACNI=$O(^RADPT("AS",RASTAT,RADFN,RADTI,RACNI)) Q:RACNI'>0  I $D(^RADPT(RADFN,"DT",RADTI,"P",RACNI,0)) S Y(0)=^(0) D EXT
"RTN","RASTEXT",54,0)
 Q
"RTN","RASTEXT",55,0)
EXT ;p137/KLM - updated for printset SSAN display - use RACNI. 
"RTN","RASTEXT",56,0)
 ;Also use RADTI~RADFN combo for third subscript to allow for two studies with same d/t.
"RTN","RASTEXT",57,0)
 S:$D(^XUSEC("RA MGR",DUZ))!(RAMDIV=+$P(Y,"^",3)) RAY=+Y_"~"_RADFN,^TMP($J,"RASTEXT",RAY,RACNI)=RADFN_"^"_+Y(0)_"^"_$P(Y(0),"^",2)_"^"_$P(Y(0),"^",18),RACTR=1
"RTN","RASTEXT",58,0)
 Q
"RTN","RASTEXT",59,0)
 ;
"RTN","RASTEXT",60,0)
 ;p137 - Modified SCRN F-loop below to accomdate the new RADTI string format (RADTI~RADFN) 
"RTN","RASTEXT",61,0)
 ;Note that RADTI is actually the FM D/T of the study
"RTN","RASTEXT",62,0)
SCRN D HD S RADTI="" Q:RAQ!(RAXIT)  F  S RADTI=$O(^TMP($J,"RASTEXT",RADTI)) Q:RAQ!(RADTI="")  F I1=0:0 S I1=$O(^TMP($J,"RASTEXT",RADTI,I1)) Q:I1'>0!(RAXIT)  D:$$LMAX HD D WRT D:$$LMAX SELECT^RASTEXT1 Q:RAQ!(RADTI'>0)!(RAXIT)
"RTN","RASTEXT",63,0)
 Q:RAQ!(RAXIT)  D:$$LMAX HD
"RTN","RASTEXT",64,0)
 D SELECT^RASTEXT1 Q:RAQ!(RAXIT)
"RTN","RASTEXT",65,0)
 G SCRN:RADTI=0
"RTN","RASTEXT",66,0)
 Q
"RTN","RASTEXT",67,0)
 ;
"RTN","RASTEXT",68,0)
 ;p137 - Updated WRT for new RADTI format (RADTI~RADFN) 
"RTN","RASTEXT",69,0)
WRT I $P($P(RADTI,"~"),".")=DT S X=$P(RADTI,"~") D TIME^RAUTL1 S RATI=X
"RTN","RASTEXT",70,0)
 I $P($P(RADTI,"~"),".")'=DT S RATI=$E($P(RADTI,"~"),4,5)_"/"_$E($P(RADTI,"~"),6,7)_"/"_$E($P(RADTI,"~"),2,3)
"RTN","RASTEXT",71,0)
 S RACTR=RACTR+1
"RTN","RASTEXT",72,0)
 N RASSAN,RACNDSP,RADFNXX,RADTIXX,RACNIXX
"RTN","RASTEXT",73,0)
 S RADFNXX=+^TMP($J,"RASTEXT",RADTI,I1),RADTIXX=9999999.9999-$P(RADTI,"~")
"RTN","RASTEXT",74,0)
 S RACNIXX=I1,RASSAN=$$SSANVAL^RAHLRU1(RADFNXX,RADTIXX,RACNIXX)
"RTN","RASTEXT",75,0)
 S RACNDSP=$S((RASSAN'=""):RASSAN,1:$P(^TMP($J,"RASTEXT",RADTI,I1),"^",2))
"RTN","RASTEXT",76,0)
 I $$USESSAN^RAHLRU1() D
"RTN","RASTEXT",77,0)
 .W !,?1,RACNDSP,?18,$J(RATI,8),?27,$E($S($D(^DPT(+^TMP($J,"RASTEXT",RADTI,I1),0)):$P(^(0),"^"),1:"Unknown"),1,18),?46,$S($D(^RAMIS(71,+$P(^TMP($J,"RASTEXT",RADTI,I1),"^",3),0)):$E($P(^(0),"^"),1,25),1:"Unknown")
"RTN","RASTEXT",78,0)
 I '$$USESSAN^RAHLRU1() D
"RTN","RASTEXT",79,0)
 .W !,?1,$P(^TMP($J,"RASTEXT",RADTI,I1),"^",2),?10,$J(RATI,8),?20,$E($S($D(^DPT(+^TMP($J,"RASTEXT",RADTI,I1),0)):$P(^(0),"^"),1:"Unknown"),1,20),?42,$S($D(^RAMIS(71,+$P(^TMP($J,"RASTEXT",RADTI,I1),"^",3),0)):$E($P(^(0),"^"),1,25),1:"Unknown")
"RTN","RASTEXT",80,0)
 W:$D(^RA(78.6,+$P(^TMP($J,"RASTEXT",RADTI,I1),"^",4),0)) ?72,$E($P(^(0),"^"),1,8)
"RTN","RASTEXT",81,0)
 Q
"RTN","RASTEXT",82,0)
 ;
"RTN","RASTEXT",83,0)
HD N RADIVHD,RAGENTXT
"RTN","RASTEXT",84,0)
 S X=$H D NOW^RAUTL1 S RATIME=X,RASTOUT=$S($D(^RA(72,RASTAT,0)):$P(^(0),"^"),1:"")
"RTN","RASTEXT",85,0)
 S RALOC(0)=$P(RAMLC,"^"),RALOC(1)=$P($G(^RA(79.1,RALOC(0),0)),"^")
"RTN","RASTEXT",86,0)
 S RALOC=$P($G(^SC(RALOC(1),0)),"^"),RADIV=$P($G(^DIC(4,+RAMDIV,0)),"^")
"RTN","RASTEXT",87,0)
 S RADIVHD="Division: "_RADIV
"RTN","RASTEXT",88,0)
 S RAGENTXT="Exam Status Tracking Module"
"RTN","RASTEXT",89,0)
 W @IOF,!?1,RAGENTXT,?39,RADIVHD
"RTN","RASTEXT",90,0)
 W !?1,"Date    : ",$E(DT,4,5),"/",$E(DT,6,7),"/",$E(DT,2,3),"  ",RATIME,?39,"Status  : ",RASTOUT
"RTN","RASTEXT",91,0)
 W !?1,"Locations: " S X="" F  S X=$O(RADLOCS(X)) Q:X']""  W:($X+$L(X))>IOM !?($X+5) W X W:$O(RADLOCS(X))'="" ?($X+5)
"RTN","RASTEXT",92,0)
 I $$USESSAN^RAHLRU1() D
"RTN","RASTEXT",93,0)
 .W !!?1,"Case #",?18,"Date",?27,"Patient",?46,"Procedure",?72,"Equip/Rm",!
"RTN","RASTEXT",94,0)
 .W ?1,"----------------",?18,"----",?27,"-------",?46,"---------",?72,"--------"
"RTN","RASTEXT",95,0)
 I '$$USESSAN^RAHLRU1() D
"RTN","RASTEXT",96,0)
 .W !!?1,"Case #",?10,"Date",?20,"Patient",?42,"Procedure",?72,"Equip/Rm",!
"RTN","RASTEXT",97,0)
 .W ?1,"------",?10,"----",?20,"-------",?42,"---------",?72,"--------"
"RTN","RASTEXT",98,0)
 Q
"RTN","RASTEXT",99,0)
Q ; Kill and quit
"RTN","RASTEXT",100,0)
 K %,%H,%W,%Y,%Y1,A,C,DIC,I,I1,ORX,POP,RACNI,RACNT,RACONTIN,RACS,RACTR,RADA,RADATE,RADFN,RADIV,RADTI,RAED,RAJ1,RAI,RAIMAGE,RALOC,RAMIS,RANODE,RAORD,RAPRIT,RAQ,RASTAT,RASTOUT,RATI,RATICTR,RATIME,RATXTLP,RAX,RAXIT,SDCLST,X,XQUIT,Y
"RTN","RASTEXT",101,0)
 K RASEQARR,RAY
"RTN","RASTEXT",102,0)
 K ^TMP($J,"RASTEXT"),^TMP($J,"RAEX")
"RTN","RASTEXT",103,0)
 D KILLVAR^RAUTL2,KMV^RAUTL15
"RTN","RASTEXT",104,0)
 K DIOV,RAOR,X1
"RTN","RASTEXT",105,0)
 Q
"RTN","RASTEXT",106,0)
LMAX() ;
"RTN","RASTEXT",107,0)
 Q:($Y+4)>IOSL 1
"RTN","RASTEXT",108,0)
 Q 0
"RTN","RASTREQ")
0^6^B63019681^B56283063
"RTN","RASTREQ",1,0)
RASTREQ ;HISC/CAH,GJC AISC/MJK-Status Requirements Check Routine ;04 Aug 2017 10:01 AM
"RTN","RASTREQ",2,0)
 ;;5.0;Radiology/Nuclear Medicine;**1,10,23,40,56,99,90,137**;Mar 16, 1998;Build 4
"RTN","RASTREQ",3,0)
 ;Supported IA #10104 UP^XLFSTR
"RTN","RASTREQ",4,0)
 ;Supported IA #1367 LKUP^XPDKEY
"RTN","RASTREQ",5,0)
 ;Supported IA #10060 ^VA(200
"RTN","RASTREQ",6,0)
 ;Supported IA #10076 ^XUSEC(
"RTN","RASTREQ",7,0)
 ;Supported IA #2056 GET1^DIQ and GETS^DIQ
"RTN","RASTREQ",8,0)
 ; Called by 
"RTN","RASTREQ",9,0)
 ; (1) Stat Track's [RA STATUS CHANGE]'s fld EXAM STATUS' input transform
"RTN","RASTREQ",10,0)
 ; (2) ASK+22^RASTED, if user "^" out of stat trk editing
"RTN","RASTREQ",11,0)
 ; (3) Cancel an Exam's [RA CANCEL]'s fld EXAM STATUS' input transform
"RTN","RASTREQ",12,0)
 ; (4) Enter Last Past Visit Before DHCP's [RA LAST PAST VISIT]'s ""
"RTN","RASTREQ",13,0)
 ;
"RTN","RASTREQ",14,0)
 ; Instead of using RAIMGTY, recalculate
"RTN","RASTREQ",15,0)
 ; the imaging type using the imaging type on the exam node because
"RTN","RASTREQ",16,0)
 ; status updating through report entry/edit, batch verify, and several
"RTN","RASTREQ",17,0)
 ; other options is NOT screened by sign-on imaging type, so does not
"RTN","RASTREQ",18,0)
 ; stay the same through a user's session.
"RTN","RASTREQ",19,0)
 ;
"RTN","RASTREQ",20,0)
 ; 'RAMES1' is used to display which Exam Status required fields are
"RTN","RASTREQ",21,0)
 ; not populated.  This only applies to the 'Status Tracking Of Exams'
"RTN","RASTREQ",22,0)
 ; option.
"RTN","RASTREQ",23,0)
 ;
"RTN","RASTREQ",24,0)
 ; If tracking ^-out, this rtn would be called outside of edt tmpl,
"RTN","RASTREQ",25,0)
 ; and thus the DA vars would not be defined, so we need to set them here
"RTN","RASTREQ",26,0)
 ;
"RTN","RASTREQ",27,0)
 N RASAVY M RASAVY=Y  ;save the value of Y, patch #90
"RTN","RASTREQ",28,0)
 S:'$D(DA)#2 DA=RACNI S:'$D(DA(1))#2 DA(1)=RADTI S:'$D(DA(2))#2 DA(2)=RADFN
"RTN","RASTREQ",29,0)
 ; If Fileman enter/edit, we need to define RADFN, RADTI, RACNI so the
"RTN","RASTREQ",30,0)
 ; nuc med checks won't bomb
"RTN","RASTREQ",31,0)
 S:'$D(RACNI)#2 RACNI=DA S:'$D(RADTI)#2 RADTI=DA(1) S:'$D(RADFN)#2 RADFN=DA(2)
"RTN","RASTREQ",32,0)
 ;
"RTN","RASTREQ",33,0)
 S RAIMGTYI=+$P($G(^RADPT(DA(2),"DT",DA(1),0)),U,2),RAIMGTYJ=$P($G(^RA(79.2,+RAIMGTYI,0)),U,1),RASAVTYJ=RAIMGTYJ
"RTN","RASTREQ",34,0)
 S RAMES1="W:$G(K)=$P($G(^RA(72,+$G(RANXT72),0)),U,3)&('$D(ZTQUEUED)#2) !?3,""No '"",RAZ,""'"",?35,"" entered for this exam.""" ; display if at the ranext exm stat level
"RTN","RASTREQ",35,0)
 S RAXX=+$G(X)
"RTN","RASTREQ",36,0)
 I '$D(^RA(72,RAXX,0))!(RAIMGTYJ']"") D  M Y=RASAVY Q
"RTN","RASTREQ",37,0)
 . K X W:'$D(ZTQUEUED)#2 !?3,"Error: cannot determine Imaging Type of exam.  Contact IRM."
"RTN","RASTREQ",38,0)
 . K RAMES1,RAXX
"RTN","RASTREQ",39,0)
 . Q
"RTN","RASTREQ",40,0)
 N RA,RASN,RASTI,RADES,RAOKAY,RA3
"RTN","RASTREQ",41,0)
 ; RADES = order seq. desired, RAOKAY= actual order seq. okay'd
"RTN","RASTREQ",42,0)
 S X1=$G(^RA(72,RAXX,0)),RADES=$P(X1,U,3)
"RTN","RASTREQ",43,0)
 I $$LKUP^XPDKEY(+$P(X1,"^",4))]"",'$D(^XUSEC($$LKUP^XPDKEY(+$P(X1,"^",4)),DUZ)) K X W:'$D(ZTQUEUED)#2 !?3,"You do not have the proper access privileges to ",!?3,"change this exam to this status" M Y=RASAVY Q
"RTN","RASTREQ",44,0)
 S RAJ=^RADPT(DA(2),"DT",DA(1),"P",DA,0),RAOR=-1
"RTN","RASTREQ",45,0)
 S RABEFORE=$P($G(^RA(72,+$P(RAJ,U,3),0)),U,3) ; current order seq
"RTN","RASTREQ",46,0)
 ; Don't need to set RAORDIFN,RACS,RAPRIT,RAF5
"RTN","RASTREQ",47,0)
 I '$D(^RA(72,"AA",RAIMGTYJ,0,RAXX)) D LOOP^RASTREQ1 S RAIMGTYJ=RASAVTYJ
"RTN","RASTREQ",48,0)
 I $D(^RA(72,"AA",RAIMGTYJ,0,RAXX)) D CANCEL^RASTREQ1
"RTN","RASTREQ",49,0)
 S RAIMGTYJ=RASAVTYJ
"RTN","RASTREQ",50,0)
 ; Can't use X to determine if status change to next was successful
"RTN","RASTREQ",51,0)
 ; due to looping thru all status levels for this img type
"RTN","RASTREQ",52,0)
 ; chk if calculated order is at NEXT or higher level
"RTN","RASTREQ",53,0)
 ; RAAFTER is set in rastreq1; it has 2 meanings :
"RTN","RASTREQ",54,0)
 ;   upon return from rastreq1, RAAFTER means highest seq order qualified
"RTN","RASTREQ",55,0)
 ;   upon exit from this rtn,   RAAFTER means actual seq order used
"RTN","RASTREQ",56,0)
 I RABEFORE<RAAFTER D  G MSG
"RTN","RASTREQ",57,0)
 . I RADES<RAAFTER S RAOKAY=RADES
"RTN","RASTREQ",58,0)
 . E  S RAOKAY=RAAFTER
"RTN","RASTREQ",59,0)
 . Q
"RTN","RASTREQ",60,0)
 I RAAFTER<RABEFORE D  G MSG
"RTN","RASTREQ",61,0)
 . I RADES<RAAFTER S RAOKAY=RADES
"RTN","RASTREQ",62,0)
 . E  S RAOKAY=RAAFTER
"RTN","RASTREQ",63,0)
 . Q
"RTN","RASTREQ",64,0)
 ; at this point RAAFTER=RABEFORE
"RTN","RASTREQ",65,0)
 I RADES<RAAFTER S RAOKAY=RADES
"RTN","RASTREQ",66,0)
 E  S RAOKAY=RABEFORE
"RTN","RASTREQ",67,0)
MSG I RAOKAY=RABEFORE K X W:'$D(ZTQUEUED)#2 !?5," ...exam status not changed" G KOUT2
"RTN","RASTREQ",68,0)
 S X=$O(^RA(72,"AA",RAIMGTYJ,RAOKAY,0))
"RTN","RASTREQ",69,0)
 S:$D(RANEXT) RANEXT=^RA(72,+X,0) ;set existing RANEXT to ok'd status
"RTN","RASTREQ",70,0)
 I RAOKAY<RABEFORE W:'$D(ZTQUEUED)#2 !?5," ...exam status backed down to '",$P($G(^RA(72,+X,0)),U),"'" G KOUT2
"RTN","RASTREQ",71,0)
 I RAOKAY<RADES W:'$D(ZTQUEUED)#2 !!?5," ...though upgraded, new status level (",$P($G(^RA(72,+$O(^RA(72,"AA",RAIMGTYJ,RAOKAY,0)),0)),U),")",!?5,"is not as high as the desired level (",$P($G(^RA(72,+$O(^RA(72,"AA",RAIMGTYJ,RADES,0)),0)),U),")",!
"RTN","RASTREQ",72,0)
KOUT1 ; check for higher qualifying status(es)
"RTN","RASTREQ",73,0)
 G:RAOKAY'<RAAFTER!(RAOKAY=9) KOUT2 S RA3=RAOKAY
"RTN","RASTREQ",74,0)
 W !!,"This case also qualifies for higher status(es) :",!
"RTN","RASTREQ",75,0)
 F  S RA3=$O(^RA(72,"AA",RAIMGTYJ,RA3)) Q:RA3=""  Q:RA3>RAAFTER  W:'$D(ZTQUEUED)#2 ?$X+4,$P($G(^RA(72,$O(^(RA3,0)),0)),U)
"RTN","RASTREQ",76,0)
 W:'$D(ZTQUEUED)#2 !!,"Since Status Tracking can only upgrade one status at a time,",!,"please edit this exam again.",!
"RTN","RASTREQ",77,0)
KOUT2 S RAAFTER=RAOKAY ;return as actual seq order used, not nec. highest
"RTN","RASTREQ",78,0)
 K RAIMGTYI,RAIMGTYJ,RAMES1,RAZ,RAXX,RAJ,RAS,RAK,RAE,X1,RASAVTYJ
"RTN","RASTREQ",79,0)
 M Y=RASAVY
"RTN","RASTREQ",80,0)
 Q
"RTN","RASTREQ",81,0)
 ;
"RTN","RASTREQ",82,0)
1 ;Technologist Check
"RTN","RASTREQ",83,0)
 N DIERR
"RTN","RASTREQ",84,0)
 S RA("TECH")="" I $O(^RADPT(DA(2),"DT",DA(1),"P",DA,"TC",0))>0 S RA("TECH")=+^($O(^(0)),0) S RA("TECH")=$$GET1^DIQ(200,RA("TECH")_",",.01)
"RTN","RASTREQ",85,0)
 I RA("TECH")']"" K X S RAZ="technologist" X:$D(RAMES1) RAMES1
"RTN","RASTREQ",86,0)
 K RA("TECH") Q
"RTN","RASTREQ",87,0)
 ;
"RTN","RASTREQ",88,0)
2 ;Interpreting Physician Check
"RTN","RASTREQ",89,0)
 N DIERR
"RTN","RASTREQ",90,0)
 I $$GET1^DIQ(200,$P(RAJ,"^",12)_",",.01)="",$$GET1^DIQ(200,$P(RAJ,"^",15)_",",.01)="" K X S RAZ="interpreting staff or resident" X:$D(RAMES1) RAMES1
"RTN","RASTREQ",91,0)
 Q
"RTN","RASTREQ",92,0)
 ;
"RTN","RASTREQ",93,0)
3 ;Detailed Procedure Check
"RTN","RASTREQ",94,0)
 S RAZ="detailed procedure" I '$D(^RAMIS(71,+$P(RAJ,"^",2),0)) K X X:$D(RAMES1) RAMES1 Q
"RTN","RASTREQ",95,0)
 S RAJ1=$G(^RAMIS(71,+$P(RAJ,"^",2),0)) I "DS"'[$P(RAJ1,"^",6) K X X:$D(RAMES1) RAMES1 Q
"RTN","RASTREQ",96,0)
 S RAZ="detailed procedure (no CPT code)" I $P(RAJ1,"^",9)']"" K X X:$D(RAMES1) RAMES1 Q
"RTN","RASTREQ",97,0)
 Q
"RTN","RASTREQ",98,0)
 ;
"RTN","RASTREQ",99,0)
4 ;Film Data Check
"RTN","RASTREQ",100,0)
 I '$O(^RADPT(DA(2),"DT",DA(1),"P",DA,"F",0)) K X S RAZ="film data" X:$D(RAMES1) RAMES1
"RTN","RASTREQ",101,0)
 Q
"RTN","RASTREQ",102,0)
 ;
"RTN","RASTREQ",103,0)
5 ;Diagnostic Code Check
"RTN","RASTREQ",104,0)
 I '$D(^RA(78.3,+$P(RAJ,"^",13),0)) K X S RAZ="diagnostic code" X:$D(RAMES1) RAMES1
"RTN","RASTREQ",105,0)
 Q
"RTN","RASTREQ",106,0)
 ;
"RTN","RASTREQ",107,0)
6 ;Camera/Equipment/Room Check
"RTN","RASTREQ",108,0)
 S RAE=$S($D(RAMDV):$P(RAMDV,"^",9),1:1) I RAE,'$D(^RA(78.6,+$P(RAJ,"^",18),0)) K X S RAZ="camera/equip/room" X:$D(RAMES1) RAMES1
"RTN","RASTREQ",109,0)
 Q
"RTN","RASTREQ",110,0)
 ;
"RTN","RASTREQ",111,0)
11 ;Report Entered and not just a stub rec for Img/PACS Check
"RTN","RASTREQ",112,0)
 I '$D(^RARPT(+$P(RAJ,"^",17),0)) G NORPT
"RTN","RASTREQ",113,0)
 ; since there's a rpt ptr, must check if the rpt is just a stub rpt
"RTN","RASTREQ",114,0)
 N RA17,RA0 ; use logic from RAREG
"RTN","RASTREQ",115,0)
 S RA17=+$P(RAJ,"^",17)
"RTN","RASTREQ",116,0)
 I $$STUB^RAEDCN1(RA17) G NORPT ; rpt is an image stub
"RTN","RASTREQ",117,0)
 Q
"RTN","RASTREQ",118,0)
NORPT ; either no report yet, or report is stub
"RTN","RASTREQ",119,0)
 K X S RAZ="report" X:$D(RAMES1) RAMES1
"RTN","RASTREQ",120,0)
 Q
"RTN","RASTREQ",121,0)
 ;
"RTN","RASTREQ",122,0)
12 ;Report Verified Check
"RTN","RASTREQ",123,0)
 D 11:$P(RAS,"^",11)'="Y" I $D(^RARPT(+$P(RAJ,"^",17),0)),$P(^(0),"^",5)'="V" K X S RAZ="report verification" X:$D(RAMES1) RAMES1
"RTN","RASTREQ",124,0)
 Q
"RTN","RASTREQ",125,0)
 ;
"RTN","RASTREQ",126,0)
16 ;Impression Entry Check
"RTN","RASTREQ",127,0)
 ; In Phase 1, for Elec. filed rpts, skip this even if div. param requires it
"RTN","RASTREQ",128,0)
 I $D(^RARPT(+$P(RAJ,"^",17),0)),$P(^(0),"^",5)="EF" Q
"RTN","RASTREQ",129,0)
 I $O(^RARPT(+$P(RAJ,"^",17),"I",0))'>0 K X S RAZ="impression" X:$D(RAMES1) RAMES1
"RTN","RASTREQ",130,0)
 Q
"RTN","RASTREQ",131,0)
13 ;Procedure Modifers Check
"RTN","RASTREQ",132,0)
 I '$O(^RADPT(DA(2),"DT",DA(1),"P",DA,"M",0)) K X S RAZ="procedure modifier" X:$D(RAMES1) RAMES1
"RTN","RASTREQ",133,0)
 Q
"RTN","RASTREQ",134,0)
14 ;CPT Modifiers Check
"RTN","RASTREQ",135,0)
 I '$O(^RADPT(DA(2),"DT",DA(1),"P",DA,"CMOD",0)) K X S RAZ="CPT modifiers" X:$D(RAMES1) RAMES1
"RTN","RASTREQ",136,0)
 Q
"RTN","RASTREQ",137,0)
 ;
"RTN","RASTREQ",138,0)
32 ;Pregnancy screen check - P137/KLM
"RTN","RASTREQ",139,0)
 I $$PTSEX^RAUTL8(DA(2))'="F" Q
"RTN","RASTREQ",140,0)
 N RAPTAGE
"RTN","RASTREQ",141,0)
 S RAPTAGE=$$PTAGE^RAUTL8(DA(2),"") I ((RAPTAGE<12)!(RAPTAGE>55)) Q
"RTN","RASTREQ",142,0)
 I $D(^RARPT(+$P(RAJ,"^",17),0)),$P(^(0),"^",5)="EF" D  Q  ;outside report
"RTN","RASTREQ",143,0)
 .N RAFDA
"RTN","RASTREQ",144,0)
 .;If this is an outside report and nothing is entered
"RTN","RASTREQ",145,0)
 .;for pregnancy screen, we stuff a 'u'(unknown) and
"RTN","RASTREQ",146,0)
 .;'OUTSIDE STUDY' to keep it consistent with the importer.
"RTN","RASTREQ",147,0)
 .Q:$P(^RADPT(DA(2),"DT",DA(1),"P",DA,0),U,32)]""
"RTN","RASTREQ",148,0)
 .S RAFDA(70.03,DA_","_DA(1)_","_DA(2)_",",32)="u"
"RTN","RASTREQ",149,0)
 .S RAFDA(70.03,DA_","_DA(1)_","_DA(2)_",",80)="OUTSIDE STUDY"
"RTN","RASTREQ",150,0)
 .D FILE^DIE("K","RAFDA")
"RTN","RASTREQ",151,0)
 .K RAFDA
"RTN","RASTREQ",152,0)
 .Q  ;end outside report logic
"RTN","RASTREQ",153,0)
 ;otherwise, if not defined, don't complete
"RTN","RASTREQ",154,0)
 I $$GET1^DIQ(70.03,DA_","_DA(1)_","_DA(2),32)']"" K X S RAZ="Pregnancy screen" X:$D(RAMES1) RAMES1
"RTN","RASTREQ",155,0)
 K RAPTAGE
"RTN","RASTREQ",156,0)
 Q
"RTN","RASTREQ",157,0)
 ;
"RTN","RASTREQ",158,0)
HELP ; Called from 'Help Text' node in DD(70.03,3,4).
"RTN","RASTREQ",159,0)
 N E,RA
"RTN","RASTREQ",160,0)
 S RAJ=$G(^RADPT(DA(2),"DT",DA(1),"P",DA,0))
"RTN","RASTREQ",161,0)
 S RAIMGTYI=+$P($G(^RADPT(DA(2),"DT",DA(1),0)),U,2),RAIMGTYJ=$P($G(^RA(79.2,+RAIMGTYI,0)),U,1)
"RTN","RASTREQ",162,0)
 I RAIMGTYJ']"" W !,"ERROR:  Cannot determine imaging type of exam!" K FL,K,N,RAIMGTYI,RAIMGTYJ,RAS,RAJ Q
"RTN","RASTREQ",163,0)
 W !,"This exam meets the requirements for the following statuses:"
"RTN","RASTREQ",164,0)
 F K=0:0 S K=$O(^RA(72,"AA",RAIMGTYJ,K)) Q:K'>0  D
"RTN","RASTREQ",165,0)
 . S X="",E=+$O(^RA(72,"AA",RAIMGTYJ,K,0)) Q:E'>0
"RTN","RASTREQ",166,0)
 . I $D(^RA(72,E,0)) D
"RTN","RASTREQ",167,0)
 .. S RA(0)=$G(^RA(72,E,0)),N=$P(RA(0),U),RAS=$G(^RA(72,E,.1))
"RTN","RASTREQ",168,0)
 .. I $L(RAS) D HELP1 I $D(X) W !?10,N S FL="" ;removed D 3, done inside HELP1
"RTN","RASTREQ",169,0)
 .. Q
"RTN","RASTREQ",170,0)
 . Q
"RTN","RASTREQ",171,0)
 W:'$D(FL) !?10,"Does not meet the requirements of any status."
"RTN","RASTREQ",172,0)
 W ! K RAS,RAJ,N,K,FL,RAIMGTYI,RAIMGTYJ
"RTN","RASTREQ",173,0)
 Q
"RTN","RASTREQ",174,0)
HELP1 ; Called from 'HELP' above and 'STUFF^RASTREQ1'
"RTN","RASTREQ",175,0)
 ; 'RAJ' -> 0 node of the examination
"RTN","RASTREQ",176,0)
 ; 'E'   -> ien of the examination status
"RTN","RASTREQ",177,0)
 ; Both 'RAJ' & 'E' set in 'HELP' & 'STUFF^RASTREQ1'
"RTN","RASTREQ",178,0)
 ;
"RTN","RASTREQ",179,0)
 N RADIO,RADIOUZD,RAS5 S RADIO=$S($G(^RA(72,E,.5))]"":$G(^(.5)),1:"N")
"RTN","RASTREQ",180,0)
 S:$P($G(^RA(79.2,+RAIMGTYI,0)),"^",5)="Y" RADIOUZD=""
"RTN","RASTREQ",181,0)
 ;
"RTN","RASTREQ",182,0)
 ; Phase 1 Outside Reporting 100% outside work, skip all except Diag. Code
"RTN","RASTREQ",183,0)
 I $D(^RARPT(+$P(RAJ,"^",17),0)),$P(^(0),"^",5)="EF" S RAS5=$P(RAS,U,5),RAS="",$P(RAS,U,5)=RAS5 K RADIOUZD
"RTN","RASTREQ",184,0)
 ;
"RTN","RASTREQ",185,0)
 F RAK=1:1 Q:$P(RAS,"^",RAK,99)']""  D:$P(RAS,"^",RAK)="Y" @RAK
"RTN","RASTREQ",186,0)
 I $D(X),$P(RAS,"^",3)'="Y",$D(^RA(72,"AA",RAIMGTYJ,9,E)) D 3
"RTN","RASTREQ",187,0)
 I $D(X),$P(RAS,"^",16)'="Y",$D(^RA(72,"AA",RAIMGTYJ,9,E)),$D(^RA(79,+$P(^RADPT(DA(2),"DT",DA(1),0),"^",3),.1)),$P(^(.1),"^",16)="Y" D 16
"RTN","RASTREQ",188,0)
 I $D(X),$D(^RA(72,"AA",RAIMGTYJ,9,E)) D 32 ;Check Preg screen -P137 /KLM
"RTN","RASTREQ",189,0)
 I $D(RADIOUZD) D  ;if Radiopharm Used, then check req'd NucMed flds
"RTN","RASTREQ",190,0)
 . D EN1^RASTREQN(RADIO,RAJ)
"RTN","RASTREQ",191,0)
 . I $D(X),($$UP^XLFSTR($P($G(^RA(72,E,.6)),"^",11)="Y")) D EN1^RADOSTIK(RADFN,RADTI,RACNI)
"RTN","RASTREQ",192,0)
 . Q
"RTN","RASTREQ",193,0)
 Q
"RTN","RAUTL8")
0^7^B71419275^B73540763
"RTN","RAUTL8",1,0)
RAUTL8 ;HISC/CAH-Utility routines ;16 Jan 2018 7:33 AM
"RTN","RAUTL8",2,0)
 ;;5.0;Radiology/Nuclear Medicine;**45,72,99,90,137**;Mar 16, 1998;Build 4
"RTN","RAUTL8",3,0)
 ;
"RTN","RAUTL8",4,0)
 ;Called by File 70, Exam subfile, Procedure Fld 2 Input transform
"RTN","RAUTL8",5,0)
 ;RA*5*45: modified -  logic in PRC1, ASK, ASK1, & MES1 subroutines
"RTN","RAUTL8",6,0)
 ;          removed -  MES subroutine
"RTN","RAUTL8",7,0)
 ;RA*5*72 03/23/2006 BAY/GJC/KAM Remedy Call 136200 Correct UNDEF issue
"RTN","RAUTL8",8,0)
 ;RA*5.0*99 added utility for pt age and pt sex
"RTN","RAUTL8",9,0)
 ;
"RTN","RAUTL8",10,0)
 ;Supported IA #10061 reference to ^VADPT
"RTN","RAUTL8",11,0)
 ;Supported IA #10103 reference to ^XLFDT
"RTN","RAUTL8",12,0)
 ;Supported IA #10142 reference to EN^DDIOL
"RTN","RAUTL8",13,0)
 ;Supported IA #2056 reference to GET1^DIQ and GETS^DIQ
"RTN","RAUTL8",14,0)
 ;Supported IA #10104 reference to UP^XLFSTR
"RTN","RAUTL8",15,0)
 ;Supported IA #10076 reference to ^XUSEC
"RTN","RAUTL8",16,0)
 ;Supported IA #2055 reference to EXTERNAL^DILFD
"RTN","RAUTL8",17,0)
 ;Supported IA #2378 reference to ORCHK^GMRAOR
"RTN","RAUTL8",18,0)
 ;
"RTN","RAUTL8",19,0)
PRC G PRC1:'$D(^RADPT(DA(2),"DT","AP",X)) ; check for C.M. reaction
"RTN","RAUTL8",20,0)
 N RADUP S RADUP=+$$DPDT^RAUTL8(X,.DA)
"RTN","RAUTL8",21,0)
 I RADUP D ASK Q:'$D(X)
"RTN","RAUTL8",22,0)
PRC1 ; Check for C.M. reaction on this patient
"RTN","RAUTL8",23,0)
 ; +X is the IEN of the Rad/Nuc Med Procedure in file 71
"RTN","RAUTL8",24,0)
 ; RA*5*72 - Changed next line to preserve variables
"RTN","RAUTL8",25,0)
 N RAGMRAOR S RAGMRAOR=$$GMRAOR(DA(2)) Q:RAGMRAOR'=1
"RTN","RAUTL8",26,0)
 D CONTRAST^RAUTL2(+X) ;displays contrast(s) associated with procedure
"RTN","RAUTL8",27,0)
 ;use RAPMSG for CONTRAST REACTION MESSAGE field 25, file 79
"RTN","RAUTL8",28,0)
 S RAPMSG=$G(^RA(79,+$P(^RADPT(DA(2),"DT",DA(1),0),"^",3),"CON"))
"RTN","RAUTL8",29,0)
 D:RAPMSG'="" EN^DDIOL("..."_RAPMSG_"...","","!?3")
"RTN","RAUTL8",30,0)
 D EN^DDIOL("","","!") ;line feed
"RTN","RAUTL8",31,0)
 K RAPMSG
"RTN","RAUTL8",32,0)
 D:$P($G(^RAMIS(71,+X,0)),U,20)="Y" MES1 ;message only if CM used
"RTN","RAUTL8",33,0)
 Q
"RTN","RAUTL8",34,0)
ASK ; Prompt user for yes/no response
"RTN","RAUTL8",35,0)
 N RAX D EN^DDIOL("Procedure is already entered for this date. Is it ok to continue? No// ","","!!?3")
"RTN","RAUTL8",36,0)
ASK1 R RAX:DTIME
"RTN","RAUTL8",37,0)
 S:'$T!(RAX="")!(RAX["^")!("Nn"[$E(RAX)) RAX="N"
"RTN","RAUTL8",38,0)
 K:RAX="N" X Q:'$D(X)
"RTN","RAUTL8",39,0)
 I "Yy"'[$E(RAX) S RAPMSG(1)="Enter 'YES' to register patient for this procedure, or 'NO' to edit the",RAPMSG(2)="above procedure. No// ",RAPMSG(1,"F")="!!?3",RAPMSG(2,"F")="!?3" D EN^DDIOL(.RAPMSG) K RAPMSG G ASK1
"RTN","RAUTL8",40,0)
 Q
"RTN","RAUTL8",41,0)
 ;
"RTN","RAUTL8",42,0)
MES1 ; display procedure acceptance message
"RTN","RAUTL8",43,0)
 R !?5,"...Type 'OK' to acknowledge or '^' to select another procedure   ==> ",RAX:DTIME
"RTN","RAUTL8",44,0)
 S RAX=$$UP^XLFSTR(RAX)
"RTN","RAUTL8",45,0)
 I '$T!(RAX["^")!(RAX="OK") K:RAX'="OK" X K RAX,RAI Q
"RTN","RAUTL8",46,0)
 G MES1
"RTN","RAUTL8",47,0)
 ;
"RTN","RAUTL8",48,0)
STATSEL ;Select one or more order statuses
"RTN","RAUTL8",49,0)
 ;INPUT VARIABLES:
"RTN","RAUTL8",50,0)
 ;   RANO() array contains status codes prohibited from selection
"RTN","RAUTL8",51,0)
 ;OUTPUT VARIABLES:
"RTN","RAUTL8",52,0)
 ;   RAST is a string of status codes selected (ex: 1^3^8)
"RTN","RAUTL8",53,0)
 ;   RAORST() is an array of selected status codes and status names
"RTN","RAUTL8",54,0)
 ;     (ex:   RAORST(1)="DISCONTINUED", RAORST(3)="HOLD", ... )
"RTN","RAUTL8",55,0)
 K RAST,RAORST W ! S RAORSTS=$P(^DD(75.1,5,0),U,3) F I=1:1 S X=$P(RAORSTS,";",I) Q:X=""  S X1=$P(X,":",1) I '$D(RANO(X1)) S X2=$P(X,":",2),RAORST(X1)=X2
"RTN","RAUTL8",56,0)
 W !!,"Select statuses to include on report.",! S X1="" F  S X1=$O(RAORST(X1)) Q:X1=""  W !?5,$J(X1,2,0)_"   "_RAORST(X1)
"RTN","RAUTL8",57,0)
STAT W ! K DIR S DIR(0)="L" D ^DIR Q:'$D(Y(0))
"RTN","RAUTL8",58,0)
 S RAST="" F I=1:1 S RASTX=$P(Y(0),",",I) Q:RASTX=""  I $D(RAORST(RASTX)) S RAST=RAST_"^"_RASTX
"RTN","RAUTL8",59,0)
 S RAST=$E(RAST,2,99) I RAST="" W !,"  ?? Sorry, invalid status selection.  Please try again.",! G STAT
"RTN","RAUTL8",60,0)
 S I="" F  S I=$O(RAORST(I)) Q:I=""  I RAST'[I K RAORST(I)
"RTN","RAUTL8",61,0)
 K RASTX,I,X,X1,X2 Q
"RTN","RAUTL8",62,0)
 ;
"RTN","RAUTL8",63,0)
 ;INPUT TRANSFORM FOR SECONDARY INTERPRETING RESIDENT
"RTN","RAUTL8",64,0)
S() ; do not enter primary OR SAME SEC in secondary interpreting resident
"RTN","RAUTL8",65,0)
 I '$D(X)!('$D(DA(3))) G S2
"RTN","RAUTL8",66,0)
 I '$D(^RADPT(DA(3),"DT",DA(2),"P",DA(1),0)) G S2
"RTN","RAUTL8",67,0)
 I $D(^RADPT(DA(3),"DT",DA(2),"P",DA(1),"SRR","B",+Y)) Q 0 ;SAME SEC RES
"RTN","RAUTL8",68,0)
 I $P(^RADPT(DA(3),"DT",DA(2),"P",DA(1),0),"^",12)=+Y Q 0
"RTN","RAUTL8",69,0)
 Q 1
"RTN","RAUTL8",70,0)
S2 I '$D(^RADPT(DA(2),"DT",DA(1),"P",DA,0)) Q 0
"RTN","RAUTL8",71,0)
 I $D(^RADPT(DA(2),"DT",DA(1),"P",DA,"SRR","B",+Y)) Q 0 ;SAME SEC RES
"RTN","RAUTL8",72,0)
 I $P(^RADPT(DA(2),"DT",DA(1),"P",DA,0),"^",12)=+Y Q 0
"RTN","RAUTL8",73,0)
 Q 1
"RTN","RAUTL8",74,0)
 ;INPUT TRANSFORM FOR SECONDARY INTERPRETING STAFF
"RTN","RAUTL8",75,0)
SSR() ; do not enter primary OR SAME SEC in secondary interpreting staff
"RTN","RAUTL8",76,0)
 I '$D(X)!('$D(DA(3))) G SSR2
"RTN","RAUTL8",77,0)
 I '$D(^RADPT(DA(3),"DT",DA(2),"P",DA(1),0)) G SSR2
"RTN","RAUTL8",78,0)
 I $D(^RADPT(DA(3),"DT",DA(2),"P",DA(1),"SSR","B",+Y)) Q 0 ;SAME SEC STF
"RTN","RAUTL8",79,0)
 I $P(^RADPT(DA(3),"DT",DA(2),"P",DA(1),0),"^",15)=+Y Q 0
"RTN","RAUTL8",80,0)
 Q 1
"RTN","RAUTL8",81,0)
SSR2 I '$D(^RADPT(DA(2),"DT",DA(1),"P",DA,0)) Q 0
"RTN","RAUTL8",82,0)
 I $D(^RADPT(DA(2),"DT",DA(1),"P",DA,"SSR","B",+Y)) Q 0 ;SAME SEC STF
"RTN","RAUTL8",83,0)
 I $P(^RADPT(DA(2),"DT",DA(1),"P",DA,0),"^",15)=+Y Q 0
"RTN","RAUTL8",84,0)
 Q 1
"RTN","RAUTL8",85,0)
 ;INPUT TRANSFORM FOR PRIMARY INTERPRETING RESIDENT
"RTN","RAUTL8",86,0)
 ; *** NOT USED - See EN ***
"RTN","RAUTL8",87,0)
PRRS() ; do not enter secondary into primary interpreting resident screen
"RTN","RAUTL8",88,0)
 ; called from input transform ^DD(70.03,12,0)
"RTN","RAUTL8",89,0)
 I $D(^RADPT(DA(2),"DT",DA(1),"P",DA,"SRR","B",+Y)) Q 0
"RTN","RAUTL8",90,0)
 Q 1
"RTN","RAUTL8",91,0)
 ;INPUT TRANSFORM FOR PRIMARY INTERPRETING STAFF
"RTN","RAUTL8",92,0)
 ; *** NOT USED - See EN ***
"RTN","RAUTL8",93,0)
PSRS() ; do not enter secondary into primary interpreting staff screen
"RTN","RAUTL8",94,0)
 ; called from input transform ^DD(70.03,15,0)
"RTN","RAUTL8",95,0)
 I $D(^RADPT(DA(2),"DT",DA(1),"P",DA,"SSR","B",+Y)) Q 0
"RTN","RAUTL8",96,0)
 Q 1
"RTN","RAUTL8",97,0)
EN(X,FLD,RA) ;Input transform screen for Primary Staff, Primary Res
"RTN","RAUTL8",98,0)
 ;Used by fields 70.03,12 & 70.03,15.  If 'Primary' is found in
"RTN","RAUTL8",99,0)
 ; the 'Secondary' multiple then delete the 'Secondary' entry.
"RTN","RAUTL8",100,0)
 ; X = 'Primary' IEN,  FLD = 'Secondary' mult. to check,  RA = DA array
"RTN","RAUTL8",101,0)
 N DA,DEL,HDR,IEN,NODE,SAVEX,SUBDD,XREF
"RTN","RAUTL8",102,0)
 S NODE=$S(FLD=60:"SSR",FLD=70:"SRR",1:""),SAVEX=X
"RTN","RAUTL8",103,0)
 S SUBDD=$S(FLD=60:70.11,FLD=70:70.09,1:""),(IEN,DEL)=0
"RTN","RAUTL8",104,0)
 I (NODE="")!(X'>0)!(FLD'>0)!(SUBDD'>0) Q
"RTN","RAUTL8",105,0)
 F  S IEN=$O(^RADPT(RA(2),"DT",RA(1),"P",RA,NODE,"B",X,IEN)) Q:IEN'>0  D
"RTN","RAUTL8",106,0)
 . S XREF=0
"RTN","RAUTL8",107,0)
 . F  S XREF=$O(^DD(SUBDD,.01,1,XREF)) Q:XREF'>0  D
"RTN","RAUTL8",108,0)
 .. S (D0,DA(3))=RA(2),(D1,DA(2))=RA(1),(D2,DA(1))=RA,(D3,DA)=IEN,X=SAVEX
"RTN","RAUTL8",109,0)
 .. I $G(^DD(SUBDD,.01,1,XREF,2))]"" X ^(2)
"RTN","RAUTL8",110,0)
 .. Q
"RTN","RAUTL8",111,0)
 . K ^RADPT(RA(2),"DT",RA(1),"P",RA,NODE,IEN,0) S DEL=DEL+1
"RTN","RAUTL8",112,0)
 . Q
"RTN","RAUTL8",113,0)
 I DEL D
"RTN","RAUTL8",114,0)
 . S HDR=$G(^RADPT(RA(2),"DT",RA(1),"P",RA,NODE,0)) Q:HDR=""
"RTN","RAUTL8",115,0)
 . S HDR(3)=+$O(^RADPT(RA(2),"DT",RA(1),"P",RA,NODE,0))
"RTN","RAUTL8",116,0)
 . S HDR(4)=$P(HDR,U,4)-DEL
"RTN","RAUTL8",117,0)
 . S:HDR(3)'>0 HDR(3)="" S:HDR(4)'>0 HDR(4)=""
"RTN","RAUTL8",118,0)
 . S $P(^RADPT(RA(2),"DT",RA(1),"P",RA,NODE,0),U,3,4)=HDR(3)_U_HDR(4)
"RTN","RAUTL8",119,0)
 . Q
"RTN","RAUTL8",120,0)
 S X=SAVEX
"RTN","RAUTL8",121,0)
 Q
"RTN","RAUTL8",122,0)
DPDT(RAPRC,RAY) ; Check for registration of duplicate procedures on the same
"RTN","RAUTL8",123,0)
 ; date/time.  Called from PRC above.
"RTN","RAUTL8",124,0)
 ; INPUT VARIABLES
"RTN","RAUTL8",125,0)
 ; 'RAPRC' --> IEN of the procedure (71)
"RTN","RAUTL8",126,0)
 ; 'RAY'   --> DA array i.e, DA, DA(1), & DA(2)
"RTN","RAUTL8",127,0)
 ; OUTPUT VARIABLES
"RTN","RAUTL8",128,0)
 ; 'RAFLG' --> RAFLG=1 procedure registered for this date/time
"RTN","RAUTL8",129,0)
 ;         --> RAFLG=0 initial registration for procedure@date/time
"RTN","RAUTL8",130,0)
 N RA72,RABDT,RACIEN,RAEDT,RAFLG,RAI S RAFLG=0
"RTN","RAUTL8",131,0)
 S RABDT=RAY(1)\1,RAEDT=RABDT_".9999",RAI=RABDT-.0000001
"RTN","RAUTL8",132,0)
 F  S RAI=$O(^RADPT(RAY(2),"DT","AP",RAPRC,RAI)) Q:RAI'>0!(RAI>RAEDT)  D  Q:RAFLG
"RTN","RAUTL8",133,0)
 . Q:RAI=RAY(1)  ; At this point our exam status is 'WAITING FOR EXAM'
"RTN","RAUTL8",134,0)
 . S RACIEN=$O(^RADPT(RAY(2),"DT","AP",RAPRC,RAI,0)) Q:'RACIEN
"RTN","RAUTL8",135,0)
 . S RA72=+$P($G(^RADPT(RAY(2),"DT",RAI,"P",RACIEN,0)),U,3) ;xam stat
"RTN","RAUTL8",136,0)
 . S RA72(3)=$P($G(^RA(72,RA72,0)),U,3)
"RTN","RAUTL8",137,0)
 . I RA72(3)'=0 S RAFLG=1 ; cancelled exams are not taken into account
"RTN","RAUTL8",138,0)
 . Q
"RTN","RAUTL8",139,0)
 Q RAFLG
"RTN","RAUTL8",140,0)
SCRN(RADA,RARS,Y,RALVL) ; check if the primary or secondary int'ng staff
"RTN","RAUTL8",141,0)
 ; or resident has access to a location or locations which have
"RTN","RAUTL8",142,0)
 ; an imaging type which match the imaging type of the examination.
"RTN","RAUTL8",143,0)
 ; This screen will also check the classification of the individual to 
"RTN","RAUTL8",144,0)
 ; ensure that they are active and valid for the field being edited.
"RTN","RAUTL8",145,0)
 ;
"RTN","RAUTL8",146,0)
 ; Called from DD's: ^DD(70.03,12 - ^DD(70.03,15  - ^DD(70.03,60
"RTN","RAUTL8",147,0)
 ;                   ^DD(70.03,70 - ^DD(70.09,.01 - ^DD(70.11,.01
"RTN","RAUTL8",148,0)
 ;
"RTN","RAUTL8",149,0)
 ; Input variables:  RADA-> DA array, maps to RADFN, RADTI & RACNI
"RTN","RAUTL8",150,0)
 ;                   RARS-> Classification: Resident("R") or Staff("S")
"RTN","RAUTL8",151,0)
 ;                      Y-> selected resident/staff
"RTN","RAUTL8",152,0)
 ;                   RALVL-> "PRI"=Primary physician, "SEC"=Secondary
"RTN","RAUTL8",153,0)
 ;
"RTN","RAUTL8",154,0)
 ; Output variable: $S(1:I-Types & classification match, resident/staff
"RTN","RAUTL8",155,0)
 ;                      ok,0:no match re-select resident/staff)
"RTN","RAUTL8",156,0)
 ;
"RTN","RAUTL8",157,0)
 I $S('$D(^VA(200,+Y,"RA")):1,'$P(^("RA"),U,3):1,DT'>$P(^("RA"),U,3):1,1:0),($D(^VA(200,"ARC",RARS,+Y)))
"RTN","RAUTL8",158,0)
 Q:'$T 0 ; failed the classification part of the screen
"RTN","RAUTL8",159,0)
 Q:$D(^XUSEC("RA ALLOC",+Y)) 1 ; Resident/Staff has access to all loc's!
"RTN","RAUTL8",160,0)
 N RA7002,RACCESS
"RTN","RAUTL8",161,0)
 ; adjust RADA() due Fileman's unpredictable retention of DA() levels
"RTN","RAUTL8",162,0)
 I RALVL="SEC" D
"RTN","RAUTL8",163,0)
 . I '$D(RADA(3)) S RA7002=$G(^RADPT(RADA(2),"DT",RADA(1),0))
"RTN","RAUTL8",164,0)
 . I $D(RADA(3)),(RADA(2)'=RADA(3)) S RA7002=$G(^RADPT(RADA(3),"DT",RADA(2),0))
"RTN","RAUTL8",165,0)
 . I $D(RADA(3)),(RADA(2)=RADA(3)) S RA7002=$G(^RADPT(RADA(2),"DT",RADA(1),0))
"RTN","RAUTL8",166,0)
 I RALVL="PRI" S RA7002=$G(^RADPT(RADA(2),"DT",RADA(1),0))
"RTN","RAUTL8",167,0)
 D VARACC^RAUTL6(+Y) ; set-up access array for selected resident/staff
"RTN","RAUTL8",168,0)
 Q:'$D(RACCESS(+Y,"IMG",+$P(RA7002,"^",2))) 0 ; no i-type match
"RTN","RAUTL8",169,0)
 Q 1
"RTN","RAUTL8",170,0)
 ;
"RTN","RAUTL8",171,0)
CMEDIA(RADFN,RADTI,RACNI) ;return the CM used with an exam
"RTN","RAUTL8",172,0)
 ;input: RADFN=patient DFN, RADTI=inv. date/time of exam, RACNI=exam IEN
"RTN","RAUTL8",173,0)
 ;return: contrast media administered to the patient during an exam
"RTN","RAUTL8",174,0)
 N RAI,RAS S RAI=0,RAS=""
"RTN","RAUTL8",175,0)
 F  S RAI=$O(^RADPT(RADFN,"DT",RADTI,"P",RACNI,"CM",RAI)) Q:'RAI  D
"RTN","RAUTL8",176,0)
 .S RAI(0)=$P($G(^RADPT(RADFN,"DT",RADTI,"P",RACNI,"CM",RAI,0)),U)
"RTN","RAUTL8",177,0)
 .S RAS=RAS_$$EXTERNAL^DILFD(70.3225,.01,"",RAI(0))_", "
"RTN","RAUTL8",178,0)
 Q $P(RAS,", ",1,($L(RAS,", ")-1))
"RTN","RAUTL8",179,0)
 ;
"RTN","RAUTL8",180,0)
GMRAOR(RADA2) ;look for a contrast media reaction
"RTN","RAUTL8",181,0)
 N D,D0,D1,D2,D3,DA,DC,DD,DFN,DG,DH,DI,DIC,DIE,DIEDA,DIEL,DIETMP,DIEXREF,DIFLD,DIIENS,DIOV,DIP,DK,DL,DLAYGO,DM,DN,DOV,DP,DQ,DR,X,Y
"RTN","RAUTL8",182,0)
 Q $$ORCHK^GMRAOR(RADA2,"CM")
"RTN","RAUTL8",183,0)
 ;
"RTN","RAUTL8",184,0)
PTAGE(DFN,RADTST) ;return pt age, added by p#99
"RTN","RAUTL8",185,0)
 ;input = DFN pt ien
"RTN","RAUTL8",186,0)
 ;      = RADTST date to process pt age from; if blank, use today's date
"RTN","RAUTL8",187,0)
 ;output = pt age
"RTN","RAUTL8",188,0)
 N RADAYS,VADM,VA,VAERR,%,RAYSAVE,RAXSAVE
"RTN","RAUTL8",189,0)
 M RAYSAVE=Y,RAXSAVE=X   ;save value of Y and X, patch #90
"RTN","RAUTL8",190,0)
 S:RADTST="" RADTST=$$DT^XLFDT()
"RTN","RAUTL8",191,0)
 D DEM^VADPT   ; $P(VADM(3),"^") DOB of patient, internal
"RTN","RAUTL8",192,0)
 S RADAYS=$$FMDIFF^XLFDT(RADTST,$P(VADM(3),"^"),3)
"RTN","RAUTL8",193,0)
 M X=RAXSAVE,Y=RAYSAVE
"RTN","RAUTL8",194,0)
 Q RADAYS\365.25
"RTN","RAUTL8",195,0)
 ;
"RTN","RAUTL8",196,0)
PTSEX(DFN) ;return pt sex, added by p#99
"RTN","RAUTL8",197,0)
 ;input = pt dfn
"RTN","RAUTL8",198,0)
 ;output = pt sex (M=for MALE, F=for FEMALE)
"RTN","RAUTL8",199,0)
 ;save value of Y and X; patch #90
"RTN","RAUTL8",200,0)
 N VADM,VA,VAERR,%,RAYSAVE,RAXSAVE M RAYSAVE=Y,RAXSAVE=X D DEM^VADPT
"RTN","RAUTL8",201,0)
 M Y=RAYSAVE,X=RAXSAVE
"RTN","RAUTL8",202,0)
 Q $P(VADM(5),U)
"RTN","RAUTL8",203,0)
PRSCR(RADFN,RADTI,RACNI,RAFRMT) ;return pregnancy screen
"RTN","RAUTL8",204,0)
 ;input: radfn = pt dfn
"RTN","RAUTL8",205,0)
 ;       radti = inverse dt
"RTN","RAUTL8",206,0)
 ;       racni = ien of exam sub
"RTN","RAUTL8",207,0)
 ;       rafrmt = E for External format or I for Internal format
"RTN","RAUTL8",208,0)
 ;return = pregnancy screen
"RTN","RAUTL8",209,0)
 N RAIENS,RAOUT
"RTN","RAUTL8",210,0)
 S RAIENS=RACNI_","_RADTI_","_RADFN_","
"RTN","RAUTL8",211,0)
 D GETS^DIQ(70.03,RAIENS,"32",RAFRMT,"RAOUT")
"RTN","RAUTL8",212,0)
 Q $G(RAOUT(70.03,RAIENS,32,RAFRMT))
"RTN","RAUTL8",213,0)
PRSCOM(RADFN,RADTI,RACNI) ;return pregnancy screen comment
"RTN","RAUTL8",214,0)
 ;input: radfn = pt dfn
"RTN","RAUTL8",215,0)
 ;       radti = inverse dt
"RTN","RAUTL8",216,0)
 ;       racni = ien of exam sub
"RTN","RAUTL8",217,0)
 ;return = pregnancy screen comment
"RTN","RAUTL8",218,0)
 N RAIENS,RAOUT
"RTN","RAUTL8",219,0)
 S RAIENS=RACNI_","_RADTI_","_RADFN_","
"RTN","RAUTL8",220,0)
 D GETS^DIQ(70.03,RAIENS,"80","E","RAOUT")
"RTN","RAUTL8",221,0)
 Q $G(RAOUT(70.03,RAIENS,80,"E"))
"RTN","RAUTL8",222,0)
PRCEXA(RADFN) ;return a previous case exam
"RTN","RAUTL8",223,0)
 ;input:  radfn = pt dfn
"RTN","RAUTL8",224,0)
 ;
"RTN","RAUTL8",225,0)
 ;output: racexa(0) =radti^racni, where radti=inverse date ien and racni=record ien
"RTN","RAUTL8",226,0)
 N RADTIEN,RACNIEN
"RTN","RAUTL8",227,0)
 S RADTIEN=$O(^RADPT(RADFN,"DT",0)),RACNIEN=9999,RACNIEN=$O(^RADPT(RADFN,"DT",RADTIEN,"P",RACNIEN),-1)
"RTN","RAUTL8",228,0)
 Q RADTIEN_U_RACNIEN
"RTN","RAUTL8",229,0)
PRACTO(RADFN) ;returns previous active order IEN of file #75.1 or null if no previous order
"RTN","RAUTL8",230,0)
 ;input  radfn = pt dfn
"RTN","RAUTL8",231,0)
 ;output  = ien of #75.1
"RTN","RAUTL8",232,0)
 N RA751IEN,RA751PR
"RTN","RAUTL8",233,0)
 S RA751PR=""
"RTN","RAUTL8",234,0)
 S RA751IEN=" " F  S RA751IEN=$O(^RAO(75.1,"B",RADFN,RA751IEN),-1) Q:RA751IEN'>0!$G(RA751PR)  D
"RTN","RAUTL8",235,0)
 .I $$GET1^DIQ(75.1,RA751IEN,5)="ACTIVE" S RA751PR=RA751IEN
"RTN","RAUTL8",236,0)
 Q RA751PR
"RTN","RAUTL8",237,0)
PAOE() ;Entry point to enter Pregnancy field of file 75.1.  This label is being called from
"RTN","RAUTL8",238,0)
 ;RA ORDER EXAM input template.
"RTN","RAUTL8",239,0)
 ;RETURN value:  0 if unsuccessful (up arrow, timeout or problem occured), 1 if successful.
"RTN","RAUTL8",240,0)
 N DIR,DIROUT,DIRUT,DUOUT,DTOUT,Y,X S DIR(0)="75.1,13"
"RTN","RAUTL8",241,0)
 S DIR("B")=$S($G(RAPREG)="y":"YES",$G(RAPREG)="n":"NO",$G(RAPREG)="u":"UNKNOWN",1:"")
"RTN","RAUTL8",242,0)
 S DIR("A")="PREGNANT AT TIME OF ORDER ENTRY" D ^DIR
"RTN","RAUTL8",243,0)
 Q:$D(DIRUT)!$D(DUOUT)!$D(DTOUT)!$D(DIROUT) 0
"RTN","RAUTL8",244,0)
 S RAPREG=$P(Y,"^")
"RTN","RAUTL8",245,0)
 Q 1
"RTN","RAUTL8",246,0)
 ;
"RTN","RAUTL8",247,0)
ASKSEX() ;RA*5.0*99 - Determine the sex of the patient by asking the user.
"RTN","RAUTL8",248,0)
 ;Called from the RA ORDER EXAM compiled input template.
"RTN","RAUTL8",249,0)
 ;
"RTN","RAUTL8",250,0)
 ;Question: "THE SEX OF THIS PATIENT IS NOT AVAILABLE. IS PATIENT FEMALE"
"RTN","RAUTL8",251,0)
 ;If 'Yes' Y=1; if 'No' Y=0
"RTN","RAUTL8",252,0)
 ;The default presented to the user: 'No'
"RTN","RAUTL8",253,0)
 ;
"RTN","RAUTL8",254,0)
 ;Return: the place holder value ('Y' is reset in the RA ORDER EXAM input template)
"RTN","RAUTL8",255,0)
 ;necessary for branching within that template.
"RTN","RAUTL8",256,0)
 ;
"RTN","RAUTL8",257,0)
 N DIR,DTOUT,DUOUT,DIROUT,DIRUT,RAY,X S RAY=Y S DIR(0)="Y",DIR("B")="No"
"RTN","RAUTL8",258,0)
 S DIR("A")="THE SEX OF THIS PATIENT IS NOT AVAILABLE. IS PATIENT FEMALE"
"RTN","RAUTL8",259,0)
 S DIR("?")="Enter 'YES' if patient is female, or 'NO' if patient is male."
"RTN","RAUTL8",260,0)
 D ^DIR
"RTN","RAUTL8",261,0)
 Q $S($D(DIRUT):"@999",Y=0:"@130",1:RAY)
"RTN","RAUTL8",262,0)
 ;
"RTN","RAUTL8",263,0)
ASKPREG() ;RA*5.0*99 - Evaluate the conditions to present the PREGNANCY
"RTN","RAUTL8",264,0)
 ;SCREENING (70.03 ; 32) prompt to the user. Called from the RA EXAM EDIT
"RTN","RAUTL8",265,0)
 ;input template & the RA REGISTER compiled input template.
"RTN","RAUTL8",266,0)
 ;
"RTN","RAUTL8",267,0)
 ;Input: RA0(17) (global) The IEN of the report associated with this exam.
"RTN","RAUTL8",268,0)
 ;                Note: no IEN will exist when the case is being registered.
"RTN","RAUTL8",269,0)
 ;        RADFN  (global) the IEN of the patient
"RTN","RAUTL8",270,0)
 ;            Y  (global) the place holder for the RA EXAM EDIT input template. 
"RTN","RAUTL8",271,0)
 ;
"RTN","RAUTL8",272,0)
 ;Return: the place holder value (Y = $$ASKPREG^RAUTL8) necessary for
"RTN","RAUTL8",273,0)
 ;branching within these templates.
"RTN","RAUTL8",274,0)
 ;
"RTN","RAUTL8",275,0)
 ;P137/KLM - Removed report status check. Pregnancy screen will be presented
"RTN","RAUTL8",276,0)
 ;regardless of the report status.
"RTN","RAUTL8",277,0)
 ;
"RTN","RAUTL8",278,0)
 N %,DIERR,RAERR,RAGE,VAERR,X,RAY S RAY=Y
"RTN","RAUTL8",279,0)
 S RAGE=$$PTAGE^RAUTL8(RADFN,"")
"RTN","RAUTL8",280,0)
 I $$PTSEX^RAUTL8(RADFN)'="F"!((RAGE>55)!(RAGE<12)) S RAY="@8001"
"RTN","RAUTL8",281,0)
 Q RAY
"RTN","RAUTL8",282,0)
 ;
"VER")
8.0^22.2
"^DD",79.1,79.1,28,0)
REGISTERED REQUEST PRINTER^P3.5'^%ZIS(1,^0;25^Q
"^DD",79.1,79.1,28,3)
Enter the device receiving the registered request.
"^DD",79.1,79.1,28,21,0)
^^2^2^3170616^
"^DD",79.1,79.1,28,21,1,0)
This field specifies the device where the registered request will be 
"^DD",79.1,79.1,28,21,2,0)
output.
"^DD",79.1,79.1,28,"DT")
3170616
"BLD",10071,6)
^125
**END**
**END**

