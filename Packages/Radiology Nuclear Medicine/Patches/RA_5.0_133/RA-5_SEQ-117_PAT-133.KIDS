Released RA*5*133 SEQ #117
Extracted from mail message
**KIDS**:RA*5.0*133^

**INSTALL NAME**
RA*5.0*133
"BLD",9880,0)
RA*5.0*133^RADIOLOGY/NUCLEAR MEDICINE^0^3170210^y
"BLD",9880,1,0)
^^3^3^3161216^
"BLD",9880,1,1,0)
Radiology requests have functionality added to update hold reasons for 
"BLD",9880,1,2,0)
requests in a HOLD status. Please review FORUM's Patch Module description 
"BLD",9880,1,3,0)
and installation instructions for RA*5.0*133 before installing this patch.
"BLD",9880,4,0)
^9.64PA^75.2^1
"BLD",9880,4,75.2,0)
75.2
"BLD",9880,4,75.2,2,0)
^9.641^75.2^1
"BLD",9880,4,75.2,2,75.2,0)
RAD/NUC MED REASON  (File-top level)
"BLD",9880,4,75.2,2,75.2,1,0)
^9.6411^5^1
"BLD",9880,4,75.2,2,75.2,1,5,0)
NATIONAL
"BLD",9880,4,75.2,222)
y^n^p^^^^n^^n
"BLD",9880,4,75.2,224)

"BLD",9880,4,"APDD",75.2,75.2)

"BLD",9880,4,"APDD",75.2,75.2,5)

"BLD",9880,4,"B",75.2,75.2)

"BLD",9880,6.3)
4
"BLD",9880,"INID")
^n
"BLD",9880,"INIT")
RAI133PO
"BLD",9880,"KRN",0)
^9.67PA^779.2^20
"BLD",9880,"KRN",.4,0)
.4
"BLD",9880,"KRN",.401,0)
.401
"BLD",9880,"KRN",.402,0)
.402
"BLD",9880,"KRN",.402,"NM",0)
^9.68A^1^1
"BLD",9880,"KRN",.402,"NM",1,0)
RA DIVISION PARAMETERS    FILE #79^79^0
"BLD",9880,"KRN",.402,"NM","B","RA DIVISION PARAMETERS    FILE #79",1)

"BLD",9880,"KRN",.403,0)
.403
"BLD",9880,"KRN",.5,0)
.5
"BLD",9880,"KRN",.84,0)
.84
"BLD",9880,"KRN",3.6,0)
3.6
"BLD",9880,"KRN",3.8,0)
3.8
"BLD",9880,"KRN",9.2,0)
9.2
"BLD",9880,"KRN",9.8,0)
9.8
"BLD",9880,"KRN",9.8,"NM",0)
^9.68A^4^4
"BLD",9880,"KRN",9.8,"NM",1,0)
RAORD^^0^B65150624
"BLD",9880,"KRN",9.8,"NM",2,0)
RAORDP^^0^B32264519
"BLD",9880,"KRN",9.8,"NM",3,0)
RAMAIN^^0^B36625128
"BLD",9880,"KRN",9.8,"NM",4,0)
RAORDU^^0^B27367921
"BLD",9880,"KRN",9.8,"NM","B","RAMAIN",3)

"BLD",9880,"KRN",9.8,"NM","B","RAORD",1)

"BLD",9880,"KRN",9.8,"NM","B","RAORDP",2)

"BLD",9880,"KRN",9.8,"NM","B","RAORDU",4)

"BLD",9880,"KRN",19,0)
19
"BLD",9880,"KRN",19,"NM",0)
^9.68A^3^3
"BLD",9880,"KRN",19,"NM",1,0)
RA ORDERREASON UPDATE^^0
"BLD",9880,"KRN",19,"NM",2,0)
RA ORDER^^2
"BLD",9880,"KRN",19,"NM",3,0)
RA REASON EDIT^^0
"BLD",9880,"KRN",19,"NM","B","RA ORDER",2)

"BLD",9880,"KRN",19,"NM","B","RA ORDERREASON UPDATE",1)

"BLD",9880,"KRN",19,"NM","B","RA REASON EDIT",3)

"BLD",9880,"KRN",19.1,0)
19.1
"BLD",9880,"KRN",19.1,"NM",0)
^9.68A^^
"BLD",9880,"KRN",101,0)
101
"BLD",9880,"KRN",409.61,0)
409.61
"BLD",9880,"KRN",771,0)
771
"BLD",9880,"KRN",779.2,0)
779.2
"BLD",9880,"KRN",870,0)
870
"BLD",9880,"KRN",8989.51,0)
8989.51
"BLD",9880,"KRN",8989.52,0)
8989.52
"BLD",9880,"KRN",8994,0)
8994
"BLD",9880,"KRN","B",.4,.4)

"BLD",9880,"KRN","B",.401,.401)

"BLD",9880,"KRN","B",.402,.402)

"BLD",9880,"KRN","B",.403,.403)

"BLD",9880,"KRN","B",.5,.5)

"BLD",9880,"KRN","B",.84,.84)

"BLD",9880,"KRN","B",3.6,3.6)

"BLD",9880,"KRN","B",3.8,3.8)

"BLD",9880,"KRN","B",9.2,9.2)

"BLD",9880,"KRN","B",9.8,9.8)

"BLD",9880,"KRN","B",19,19)

"BLD",9880,"KRN","B",19.1,19.1)

"BLD",9880,"KRN","B",101,101)

"BLD",9880,"KRN","B",409.61,409.61)

"BLD",9880,"KRN","B",771,771)

"BLD",9880,"KRN","B",779.2,779.2)

"BLD",9880,"KRN","B",870,870)

"BLD",9880,"KRN","B",8989.51,8989.51)

"BLD",9880,"KRN","B",8989.52,8989.52)

"BLD",9880,"KRN","B",8994,8994)

"BLD",9880,"QDEF")
^^^^NO^^^^NO^^
"BLD",9880,"QUES",0)
^9.62^^
"BLD",9880,"REQB",0)
^9.611^3^3
"BLD",9880,"REQB",1,0)
RA*5.0*87^2
"BLD",9880,"REQB",2,0)
RA*5.0*15^2
"BLD",9880,"REQB",3,0)
RA*5.0*57^2
"BLD",9880,"REQB","B","RA*5.0*15",2)

"BLD",9880,"REQB","B","RA*5.0*57",3)

"BLD",9880,"REQB","B","RA*5.0*87",1)

"FIA",75.2)
RAD/NUC MED REASON
"FIA",75.2,0)
^RA(75.2,
"FIA",75.2,0,0)
75.2I
"FIA",75.2,0,1)
y^n^p^^^^n^^n
"FIA",75.2,0,10)

"FIA",75.2,0,11)

"FIA",75.2,0,"RLRO")

"FIA",75.2,0,"VR")
5.0^RA
"FIA",75.2,75.2)
1
"FIA",75.2,75.2,5)

"INIT")
RAI133PO
"KRN",.402,219,-1)
0^1
"KRN",.402,219,0)
RA DIVISION PARAMETERS^3161209.1307^^79^^^3161209
"KRN",.402,219,"%D",0)
^^2^2^2991001^^^
"KRN",.402,219,"%D",1,0)
This template is used to input division parameters into the
"KRN",.402,219,"%D",2,0)
radiology/nuclear medicine package.
"KRN",.402,219,"DIAB",1,1,79.01,0)
ALL
"KRN",.402,219,"DR",1,79)
W !!,"Division-wide Order Entry Parameters:",!,"------------------------------------";.121//no;.119////^S X="y";75;W !!,"Exam Entry/Edit Parameters:",!,"---------------------------";.17//no;.19//no;.16//yes;.11////^S X="Y";
"KRN",.402,219,"DR",1,79,1)
S:X="N" Y="@10";.111//no;@10;.124;W !!,"Films Reporting Parameters:",!,"---------------------------";.112//no;.113//yes;.114//yes;.116//yes;.117////^S X="Y";.118//no;.122//no;.125//yes;.126;.127//no;.128//no//;
"KRN",.402,219,"DR",1,79,2)
W !!,"Miscellaneous Division Parameters:",!,"----------------------------------";.12//no;.18//no;25;125;W !!,"HL7 Applications Associated with this Division:",!,"-----------------------------------------------";.129;
"KRN",.402,219,"DR",1,79,3)
W !!,"Imaging Locations Associated with this Division:",!,"------------------------------------------------";50;W !!,"Division Parameters have been set!",!;S Y="";
"KRN",.402,219,"DR",2,79.01)
.01
"KRN",.402,219,"DR",2,79.02)
.01;
"KRN",19,1790,-1)
2^2
"KRN",19,1790,0)
RA ORDER^Radiology/Nuclear Med Order Entry Menu^^M^50^^^^^^^
"KRN",19,1790,10,0)
^19.01IP^13^12
"KRN",19,1790,10,13,0)
13907
"KRN",19,1790,10,13,"^")
RA ORDERREASON UPDATE
"KRN",19,1790,"U")
RADIOLOGY/NUCLEAR MED ORDER EN
"KRN",19,8745,-1)
0^3
"KRN",19,8745,0)
RA REASON EDIT^Reason Edit^^R^^^^^^^^
"KRN",19,8745,1,0)
^19.06^2^2^3161209^^^
"KRN",19,8745,1,1,0)
This option allows ADPACs to modify and add reasons that can be selected
"KRN",19,8745,1,2,0)
by users who are cancelling and holding Imaging orders.
"KRN",19,8745,25)
14^RAMAIN
"KRN",19,8745,"U")
REASON EDIT
"KRN",19,13907,-1)
0^1
"KRN",19,13907,0)
RA ORDERREASON UPDATE^Update a Hold Request^^R^^^^^^^^RADIOLOGY/NUCLEAR MEDICINE
"KRN",19,13907,1,0)
^19.06^4^4^3161215^^
"KRN",19,13907,1,1,0)
This option allows the user to update the hold reason for a request that
"KRN",19,13907,1,2,0)
is already in a HOLD status. The user will be asked to select a reason
"KRN",19,13907,1,3,0)
from the 'Rad/Nuc Med Reason' file (#75.2). Only requests with a status
"KRN",19,13907,1,4,0)
of HOLD can be selected.
"KRN",19,13907,25)
6^RAORD
"KRN",19,13907,"U")
UPDATE A HOLD REQUEST
"MBREQ")
0
"ORD",7,.402)
.402;7;;;EDEOUT^DIFROMSO(.402,DA,"",XPDA);FPRE^DIFROMSI(.402,"",XPDA);EPRE^DIFROMSI(.402,DA,$E("N",$G(XPDNEW)),XPDA,"",OLDA);;EPOST^DIFROMSI(.402,DA,"",XPDA);DEL^DIFROMSK(.402,"",%)
"ORD",7,.402,0)
INPUT TEMPLATE
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"PKG",18,-1)
1^1
"PKG",18,0)
RADIOLOGY/NUCLEAR MEDICINE^RA^REGISTERS PATIENTS,RECORDS EXAMS,PROFILES,AMIS REPORTS
"PKG",18,20,0)
^9.402P^^
"PKG",18,22,0)
^9.49I^1^1
"PKG",18,22,1,0)
5.0^3051109^2980407^50
"PKG",18,22,1,"PAH",1,0)
133^3170210
"PKG",18,22,1,"PAH",1,1,0)
^^3^3^3170210
"PKG",18,22,1,"PAH",1,1,1,0)
Radiology requests have functionality added to update hold reasons for 
"PKG",18,22,1,"PAH",1,1,2,0)
requests in a HOLD status. Please review FORUM's Patch Module description 
"PKG",18,22,1,"PAH",1,1,3,0)
and installation instructions for RA*5.0*133 before installing this patch.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
5
"RTN","RAI133PO")
0^^B7168541^n/a
"RTN","RAI133PO",1,0)
RAI133PO ;WOIFO/KLM-Rad/NM Post-init Driver, patch 133;11/03/16
"RTN","RAI133PO",2,0)
 ;;5.0;Radiology/Nuclear Medicine;**133**;November 3, 2016;Build 4
"RTN","RAI133PO",3,0)
 ;New standardized reasons to be used for updating 
"RTN","RAI133PO",4,0)
 ;requests in a HOLD status. Standardized reasons
"RTN","RAI133PO",5,0)
 ;provided here will not be editable by the site.
"RTN","RAI133PO",6,0)
 ;
"RTN","RAI133PO",7,0)
EN      ;Entry pt for post-install
"RTN","RAI133PO",8,0)
 N RACHK
"RTN","RAI133PO",9,0)
 ;
"RTN","RAI133PO",10,0)
 ;Load new reasons file 75.2
"RTN","RAI133PO",11,0)
 S RACHK=$$NEWCP^XPDUTL("POST1","EN1^RAI133PO")
"RTN","RAI133PO",12,0)
 ;
"RTN","RAI133PO",13,0)
 ;Check Rad/Nuc Med Divisions for request/exam status tracking
"RTN","RAI133PO",14,0)
 S RACHK=$$NEWCP^XPDUTL("POST2","EN2^RAI133PO")
"RTN","RAI133PO",15,0)
 Q
"RTN","RAI133PO",16,0)
EN1     ;Load national entries into RAD/NUC MED REASON file #75.2
"RTN","RAI133PO",17,0)
 N RAI,RAREA,RAMSG
"RTN","RAI133PO",18,0)
 F RAI=1:1 S RAREA=$T(REA+RAI) Q:RAREA=""  D
"RTN","RAI133PO",19,0)
 .S RA01=$P(RAREA,";",3),RA3=$P(RAREA,";",4)
"RTN","RAI133PO",20,0)
 .N RAFDA,RAR S RAR="RAFDA(75.2,""?+1,"")" ;FDA root -Check for existing entry
"RTN","RAI133PO",21,0)
 .S @RAR@(.01)=RA01 ;Reason
"RTN","RAI133PO",22,0)
 .S @RAR@(2)=3      ;Type of reason=hold request
"RTN","RAI133PO",23,0)
 .S @RAR@(3)=RA3    ;Synonym
"RTN","RAI133PO",24,0)
 .S @RAR@(4)="i"    ;Nature of order activity=Policy
"RTN","RAI133PO",25,0)
 .S @RAR@(5)="Y"    ;NATIONAL flag = YES prevents local modifications
"RTN","RAI133PO",26,0)
 .D UPDATE^DIE(,"RAFDA","","RAMSG(1)") K RAFDA
"RTN","RAI133PO",27,0)
 .I $D(RAMSG(1,"DIERR"))#2 S RATXT="An error occured filing data for "_RA01
"RTN","RAI133PO",28,0)
 .E  S RATXT=RA01_" filed"
"RTN","RAI133PO",29,0)
 .D MES^XPDUTL(RATXT)  K RATXT,RAMSG
"RTN","RAI133PO",30,0)
 Q
"RTN","RAI133PO",31,0)
EN2     ;Check all divisions to be sure Request / Exam Status Tracking is enabled
"RTN","RAI133PO",32,0)
 N RADIV,RAFDA,RACHK
"RTN","RAI133PO",33,0)
 S RADIV="" F  S RADIV=$O(^RA(79,"B",RADIV)) Q:'RADIV  D
"RTN","RAI133PO",34,0)
 .I $P($G(^RA(79,RADIV,.1)),"^",19)'="y"!($P($G(^RA(79,RADIV,.1)),"^",10)'="Y") D
"RTN","RAI133PO",35,0)
 ..S RAFDA(79,RADIV_",",.119)="y"
"RTN","RAI133PO",36,0)
 ..S RAFDA(79,RADIV_",",.11)="Y"
"RTN","RAI133PO",37,0)
 ..D FILE^DIE("","RAFDA","RAMSG(1)") K RAFDA
"RTN","RAI133PO",38,0)
 ..I $D(RAMSG(1,"DIERR"))#2 S RATXT="Problem updating Rad/Nuc Med Division data"
"RTN","RAI133PO",39,0)
 ..E  S RATXT="Rad/Nuc Med Divisions updated"
"RTN","RAI133PO",40,0)
 ..S RACHK=$$UPCP^XPDUTL("POST2",RADIV)
"RTN","RAI133PO",41,0)
 I '$D(RATXT) S RATXT="No Rad/Nuc Med Divisions updates needed"
"RTN","RAI133PO",42,0)
 D BMES^XPDUTL(RATXT)  K RATXT,RAMSG
"RTN","RAI133PO",43,0)
 Q
"RTN","RAI133PO",44,0)
REA     ;REASON;SYNONYM
"RTN","RAI133PO",45,0)
 ;;CALLED VETERAN FOR APPT;CALL
"RTN","RAI133PO",46,0)
 ;;MYHEALTHYVET CONTACT;MHV
"RTN","RAI133PO",47,0)
 ;;LETTER SENT TO CALL VA;LETTER
"RTN","RAI133PO",48,0)
 ;;RESCHED CALL BY VETERAN;RESCHED
"RTN","RAI133PO",49,0)
 ;;MRI SAFETY REVIEW;MRISAFETY
"RTN","RAI133PO",50,0)
 ;;RADIOLOGIST REVIEW;RADREV
"RTN","RAI133PO",51,0)
 ;;COMMUNITY CARE APPT;COMCARE
"RTN","RAI133PO",52,0)
 ;;WAITING ON OUTSIDE IMAGES;OUTIMAGE
"RTN","RAI133PO",53,0)
 ;;FUTURE APPOINTMENT;FUTUREAPT
"RTN","RAI133PO",54,0)
 ;;NON RADIOLOGY CONSULT;NONRADCON
"RTN","RAMAIN")
0^3^B36625128^B33760656
"RTN","RAMAIN",1,0)
RAMAIN ;HISC/FPT,GJC,CAH AISC/MJK,RMO;VMP/PW-Utility File Maintenance ;7/24/02  14:45
"RTN","RAMAIN",2,0)
 ;;5.0;Radiology/Nuclear Medicine;**31,43,50,54,87,133**;Mar 16, 1998;Build 4
"RTN","RAMAIN",3,0)
 ;
"RTN","RAMAIN",4,0)
 ; 11/15/07 BAY/KAM RA*5*87 Rem Call 205080 Option File Access
"RTN","RAMAIN",5,0)
3 ;;Major AMIS Code Enter/Edit
"RTN","RAMAIN",6,0)
 N RAI F RAI=1:1:5 W !?9,$P($T(REMIND+RAI),";;",2)
"RTN","RAMAIN",7,0)
 S DIR(0)="Y",DIR("B")="No"
"RTN","RAMAIN",8,0)
 S DIR("A")="          add/change any AMIS codes and weight"
"RTN","RAMAIN",9,0)
 S DIR("A",1)="          Do you have approval from Radiology Service VACO to"
"RTN","RAMAIN",10,0)
 D ^DIR K DIR Q:$D(DIRUT)  Q:'Y
"RTN","RAMAIN",11,0)
L3 S DIC="^RAMIS(71.1,",DIC(0)="AEMQ" W ! D ^DIC K DIC I Y<0 K D,X,Y,DDH,I,POP,DISYS Q
"RTN","RAMAIN",12,0)
 S DA=+Y,DIE="^RAMIS(71.1,",DR=".01;2" D ^DIE K %,%W,%Y,D0,DA,DE,DQ,DIE,DR,DI,I,POP G L3
"RTN","RAMAIN",13,0)
REMIND ;;
"RTN","RAMAIN",14,0)
 ;;+----------------------------------------------------------+
"RTN","RAMAIN",15,0)
 ;;| New entries and modifications to existing entries are    |
"RTN","RAMAIN",16,0)
 ;;| prohibited without approval from Radiology Service VACO. |
"RTN","RAMAIN",17,0)
 ;;+----------------------------------------------------------+
"RTN","RAMAIN",18,0)
 ;
"RTN","RAMAIN",19,0)
4 ;;Film Type Enter/Edit
"RTN","RAMAIN",20,0)
 K DD,DIC,DLAYGO,DO
"RTN","RAMAIN",21,0)
 S DIC="^RA(78.4,",DIC(0)="AEMQL",DLAYGO=78.4 W ! D ^DIC
"RTN","RAMAIN",22,0)
 K DD,DIC,DLAYGO,DO
"RTN","RAMAIN",23,0)
 I +Y<0 D  D Q4 Q
"RTN","RAMAIN",24,0)
 . D DSPLNKS^RAMAIN1
"RTN","RAMAIN",25,0)
 . K D,DI,X,Y
"RTN","RAMAIN",26,0)
 . Q
"RTN","RAMAIN",27,0)
 S DA=+Y,DIE="^RA(78.4,",DR=".01;2;3;4;5;S:+X'=1 Y=""@1"";6;@1"
"RTN","RAMAIN",28,0)
 D ^DIE S RA784=$G(^RA(78.4,DA,0)),RA784(1)=$P(RA784,U)
"RTN","RAMAIN",29,0)
 S RA784(5)=+$P(RA784,U,4),RA784(6)=$P(RA784,U,5)
"RTN","RAMAIN",30,0)
 I RA784(5),(RA784(6)']"") D
"RTN","RAMAIN",31,0)
 . N DIE,DR
"RTN","RAMAIN",32,0)
 . W !!?5,$C(7),"'"_RA784(1)_"' has been defined as a wasted film size."
"RTN","RAMAIN",33,0)
 . W !?5,"If a particular film size is deemed as a wasted piece of"
"RTN","RAMAIN",34,0)
 . W !?5,"film, the wasted piece of film must be associated with an"
"RTN","RAMAIN",35,0)
 . W !?5,"unwasted piece of film."
"RTN","RAMAIN",36,0)
 . W !!?5,"Redefining '"_RA784(1)_"' as an unwasted film size."
"RTN","RAMAIN",37,0)
 . S DIE="^RA(78.4,",DR="5///@" D ^DIE W "   Done!"
"RTN","RAMAIN",38,0)
 . Q
"RTN","RAMAIN",39,0)
 K %,D0,DA,DE,DQ,DIE,DR,RA784,X,Y G 4
"RTN","RAMAIN",40,0)
Q4 K I,POP,DISYS,DDH
"RTN","RAMAIN",41,0)
 Q
"RTN","RAMAIN",42,0)
 ;
"RTN","RAMAIN",43,0)
5 ;;Diagnostic Code Enter/Edit
"RTN","RAMAIN",44,0)
 S DIC="^RA(78.3,",DIC(0)="AEMQL",DLAYGO=78.3 W ! D ^DIC K DIC,DLAYGO I Y<0 K D,X,Y,POP,I Q
"RTN","RAMAIN",45,0)
 S DA=+Y,DIE="^RA(78.3,",DR="2:5" D ^DIE K %,D0,DA,DE,DQ,DIE,DR,I,DI G 5
"RTN","RAMAIN",46,0)
 ;
"RTN","RAMAIN",47,0)
6 ;;Flash Card/Label Formatter
"RTN","RAMAIN",48,0)
 W:'$D(RAFLH) !!?5,">>> Exam Label/Report Header/Report Footer/Flash Card Formatter <<<"
"RTN","RAMAIN",49,0)
 S DIC="^RA(78.2,",DIC(0)="AEMQL",DLAYGO=78.2 W ! D ^DIC K DIC,DLAYGO G Q6:Y<0 S (RAFLH,DA)=+Y,DIE="^RA(78.2,",DR="[RA FLASH CARD EDIT]" D ^DIE K DE,DQ,DIE,DR I '$D(^RA(78.2,RAFLH,0)) G Q6
"RTN","RAMAIN",50,0)
 S RAFMT=RAFLH,RAK=0
"RTN","RAMAIN",51,0)
 F  S RAK=$O(^RA(78.7,RAK)) Q:RAK'>0  D SETFLH^RAFLH2(RAK)
"RTN","RAMAIN",52,0)
 D CMP^RAFLH1
"RTN","RAMAIN",53,0)
 W !!,"<<<<<<----------------------------Column No.------------------------------>>>>>>"
"RTN","RAMAIN",54,0)
 W !!,"0--------1---------2---------3---------4---------5---------6---------7---------8"
"RTN","RAMAIN",55,0)
 W !,"1        0         0         0         0         0         0         0         0",! S RATEST="",RANUM=1,RAFFLF="!" D PRT^RAFLH K RAFFLF W !! G 6
"RTN","RAMAIN",56,0)
Q6 S RAK=0 F  S RAK=$O(^RA(78.7,RAK)) Q:RAK'>0  D KILFLH^RAFLH2(RAK)
"RTN","RAMAIN",57,0)
 K %,%W,%X,%Y,D,D0,D1,DA,FL,RA787,RATEST,RAII,RAK,RAFLH,RAFMT,RANUM,X,Y
"RTN","RAMAIN",58,0)
 K POP,I,DDH,DUOUT,DI,DISYS
"RTN","RAMAIN",59,0)
 Q
"RTN","RAMAIN",60,0)
 ;
"RTN","RAMAIN",61,0)
7 ;;Complication Type Enter/Edit
"RTN","RAMAIN",62,0)
 S DIC="^RA(78.1,",DIC(0)="AEMQL",DLAYGO=78.1 W ! D ^DIC K DIC,DLAYGO I Y<0 K D,X,Y G Q7
"RTN","RAMAIN",63,0)
 S DA=+Y,DIE="^RA(78.1,",DR=".01;2" D ^DIE K %,D,D0,DA,DE,DQ,DIE,DR D Q7 G 7
"RTN","RAMAIN",64,0)
Q7 K DI,DISYS,I,POP Q
"RTN","RAMAIN",65,0)
 ;
"RTN","RAMAIN",66,0)
8 ;;Sharing/Contract Agreement Entry/Edit
"RTN","RAMAIN",67,0)
 S DIC="^DIC(34,",DIC(0)="AELMQ",DIC("A")="Select Agreement/Contract: ",DLAYGO=34 W ! D ^DIC K DIC,DLAYGO I Y<0 K D,X,Y,I,POP Q
"RTN","RAMAIN",68,0)
 S DA=+Y,DIE="^DIC(34,",DR=".01:3" D ^DIE K %,%W,%X,%Y,D,D0,DA,DE,DQ,DIE,DR,X,Y,DI,DISYS G 8
"RTN","RAMAIN",69,0)
 ;
"RTN","RAMAIN",70,0)
9 ;;Standard Reports
"RTN","RAMAIN",71,0)
 S DIC="^RA(74.1,",DIC(0)="AEMQL",DLAYGO=74.1 W ! D ^DIC K DIC,DLAYGO I Y<0 K D,X,Y D Q9 Q
"RTN","RAMAIN",72,0)
 S DA=+Y,DIE="^RA(74.1,",DR="[RA STANDARD REPORT ENTRY]" D ^DIE K %,%W,%X,%Y,C,D,D0,DA,DE,DQ,DIE,DR,X,Y D Q9 G 9
"RTN","RAMAIN",73,0)
Q9 K DDH,DI,DISYS,I,J,POP
"RTN","RAMAIN",74,0)
 Q
"RTN","RAMAIN",75,0)
 ;
"RTN","RAMAIN",76,0)
10 ;;Procedure Modifiers Entry
"RTN","RAMAIN",77,0)
 K DD,DO,DLAYGO,DIC,DA,DINUM,X,Y
"RTN","RAMAIN",78,0)
 ;S (DIC,DLAYGO)="^RAMIS(71.2,",DIC(0)="AEMQL"
"RTN","RAMAIN",79,0)
 ; 11/15/07 BAY/KAM RA*5*87 Rem Call 205080 Changed next line to set DLAYGO equal to the file number instead of the file root
"RTN","RAMAIN",80,0)
 S DIC="^RAMIS(71.2,",DLAYGO=71.2,DIC(0)="AEMQL"
"RTN","RAMAIN",81,0)
 S DIC("A")="Select Procedure Modifier: ",DIC("W")="D PROHLP^RAMAIN"
"RTN","RAMAIN",82,0)
 W ! D ^DIC K DIC,DLAYGO I +Y'>0 K D,X,Y,POP,I,DDH,DG,DISYS,DUOUT Q
"RTN","RAMAIN",83,0)
 S DIE="^RAMIS(71.2,",DA=+Y,DR="3;4" D ^DIE
"RTN","RAMAIN",84,0)
 K %W,%X,%Y,D,DIE,DO,DD,DLAYGO,DA,DR,X,Y,POP,I,D0,DI,DISYS,DQ,C G 10
"RTN","RAMAIN",85,0)
 ;
"RTN","RAMAIN",86,0)
11 ;;Reports Distribution Edit
"RTN","RAMAIN",87,0)
 S DIC="^RABTCH(74.3,",DIC(0)="AEMQ" W ! D ^DIC K DIC I Y<0 K D,X,Y,I,POP Q
"RTN","RAMAIN",88,0)
 S DA=+Y,DIE="^RABTCH(74.3,",DR="[RA DISTRIBUTION EDIT]" D ^DIE K %,%W,%X,%Y,D,D0,DA,DE,DQ,DIE,DR,X,Y,DI,DISYS,I,POP G 11
"RTN","RAMAIN",89,0)
 ;
"RTN","RAMAIN",90,0)
12 ;;Rad/Nuc Med Procedure Message Enter/Edit
"RTN","RAMAIN",91,0)
 S DIC="^RAMIS(71.4,",DIC(0)="AELMQ",DLAYGO=71.4
"RTN","RAMAIN",92,0)
 W ! D ^DIC K DIC,DLAYGO I Y<0 K D,DTOUT,DUOUT,X,Y Q
"RTN","RAMAIN",93,0)
 S DA=+Y
"RTN","RAMAIN",94,0)
 L +^RAMIS(71.4,DA):3 I '$T D  G 12 ;*54
"RTN","RAMAIN",95,0)
 . K DIR S DIR(0)="EA",DIR("A")="Sorry, someone else is editing that entry. <cr> - continue " D ^DIR K DIR
"RTN","RAMAIN",96,0)
 K RAMLNA,RAMLNB S RAMSGDA=DA ;*50
"RTN","RAMAIN",97,0)
 S RAMLNA=$G(^RAMIS(71.4,DA,0)) ;*50
"RTN","RAMAIN",98,0)
 S DIE="^RAMIS(71.4,",DR=.01 D ^DIE
"RTN","RAMAIN",99,0)
 S RAMLNB=$G(^RAMIS(71.4,+$G(DA),0)) ;*50
"RTN","RAMAIN",100,0)
 I RAMLNB'=RAMLNA S DA=RAMSGDA D ORDITMS^RAMAIN3 ;*50
"RTN","RAMAIN",101,0)
 L -^RAMIS(71.4,RAMSGDA) ;*54
"RTN","RAMAIN",102,0)
 K %,%W,%X,%Y,D0,DA,DE,DQ,DR,DIE,X,Y,RAMLNA,RAMLNB,RAMSGDA
"RTN","RAMAIN",103,0)
 G 12
"RTN","RAMAIN",104,0)
 ;
"RTN","RAMAIN",105,0)
13 ;;Cost of Procedure Enter/Edit
"RTN","RAMAIN",106,0)
 I '$D(RACCESS(DUZ)) D SET^RAPSET1 I $D(XQUIT) K RACCESS,XQUIT Q
"RTN","RAMAIN",107,0)
 ; ask img type
"RTN","RAMAIN",108,0)
 K ^TMP($J,"RA I-TYPE") D SELIMG^RAUTL7 G:$G(RAQUIT) 139
"RTN","RAMAIN",109,0)
 N RA0,RA1,RA2 S RA0="",RA2=""
"RTN","RAMAIN",110,0)
131 S RA0=$O(^TMP($J,"RA I-TYPE",RA0)) G:RA0="" 133
"RTN","RAMAIN",111,0)
132 S RA1=$O(^TMP($J,"RA I-TYPE",RA0,0)) G:'RA1 131
"RTN","RAMAIN",112,0)
 S RA2=RA1_U_RA2 G 131
"RTN","RAMAIN",113,0)
133 G:RA2="" 139 S DIC="^RAMIS(71,",DIC(0)="AEMQ"
"RTN","RAMAIN",114,0)
 ; restrict choice of procedure by img type selected
"RTN","RAMAIN",115,0)
 S DIC("S")="I RA2[$P(^(0),U,12)"
"RTN","RAMAIN",116,0)
 W ! D ^DIC K DIC I Y<0 K %,DTOUT,DUOUT,DIC,X,Y G 139
"RTN","RAMAIN",117,0)
 S DA=+Y,DIE="^RAMIS(71,",DR=10 D ^DIE
"RTN","RAMAIN",118,0)
 K D,D0,DA,DDH,DI,DIC,DIE,DQ,DR,X
"RTN","RAMAIN",119,0)
 G 133
"RTN","RAMAIN",120,0)
139 K ^TMP($J,"RA I-TYPE"),RAQUIT
"RTN","RAMAIN",121,0)
 Q
"RTN","RAMAIN",122,0)
 ;
"RTN","RAMAIN",123,0)
 ;RA REASON EDIT /RA*5*133
"RTN","RAMAIN",124,0)
14 ;;Reason Enter/Edit
"RTN","RAMAIN",125,0)
 S DIC="^RA(75.2,",DIC(0)="AEQL",DLAYGO=75.2 W ! D ^DIC K DIC,DLAYGO I Y<0 K DIC,DA Q
"RTN","RAMAIN",126,0)
 I $P(^RA(75.2,+Y,0),"^",5)="Y" W !!?10,"***National standardized reason - NO EDITING!***" G 14
"RTN","RAMAIN",127,0)
 S DA=+Y,DIE="^RA(75.2,",DR="2:4" D ^DIE K DIE,DR,DA,Y G 14
"RTN","RAMAIN",128,0)
 Q
"RTN","RAMAIN",129,0)
PROHLP ; Help displays the modifiers and all associated imaging types.
"RTN","RAMAIN",130,0)
 D:'$D(IOM) HOME^%ZIS
"RTN","RAMAIN",131,0)
 N RAIT,RAIT1,RAIT2,RAIT3 Q:'+$O(^RAMIS(71.2,+Y,1,0))  ; Quit, no data
"RTN","RAMAIN",132,0)
 S (RAIT,RAIT3)=0
"RTN","RAMAIN",133,0)
 F  S RAIT=+$O(^RAMIS(71.2,+Y,1,RAIT)) W:'RAIT ")" Q:'RAIT  D
"RTN","RAMAIN",134,0)
 . S RAIT1=+$G(^RAMIS(71.2,+Y,1,RAIT,0))
"RTN","RAMAIN",135,0)
 . S RAIT2=$P($G(^RA(79.2,RAIT1,0)),"^",3)
"RTN","RAMAIN",136,0)
 . W:($X+5)>IOM !?2 W ?$X+1 W:'RAIT3 "(" W RAIT2 S RAIT3=1
"RTN","RAMAIN",137,0)
 . Q
"RTN","RAMAIN",138,0)
 Q
"RTN","RAORD")
0^1^B65150624^B51748830
"RTN","RAORD",1,0)
RAORD ;HISC/CAH,FPT,GJC AISC/RMO-Rad/NM Order Entry Main Menu ;3/13/98  12:16
"RTN","RAORD",2,0)
 ;;5.0;Radiology/Nuclear Medicine;**133**;Mar 16, 1998;Build 4
"RTN","RAORD",3,0)
2 ;;Schedule a Request
"RTN","RAORD",4,0)
 N RAPTLOCK
"RTN","RAORD",5,0)
21 ; Patient lookup
"RTN","RAORD",6,0)
 S DIC="^DPT(",DIC(0)="AEMQ" W ! D ^DIC K DIC G Q2:Y<0
"RTN","RAORD",7,0)
 I $$ORVR^RAORDU()'<3 D  G:'RAPTLOCK 21
"RTN","RAORD",8,0)
 . S RAPTLOCK=$$LK^RAUTL19(+Y_";DPT(")
"RTN","RAORD",9,0)
 . Q
"RTN","RAORD",10,0)
 S RADFN=+Y,RANME=$S($D(^DPT(RADFN,0)):$P(^(0),"^"),1:"Unknown")
"RTN","RAORD",11,0)
 S (RAOFNS,RAOPTN)="Schedule",RAOVSTS="3;5"
"RTN","RAORD",12,0)
 W ! D ^RAORDS G Q2:'$D(RAORDS)
"RTN","RAORD",13,0)
 S %DT("A")="Schedule Request Date/Time: ",%DT="AEFXT"
"RTN","RAORD",14,0)
 W ! D ^%DT K %DT G Q2:Y<0 S RAOSCH=Y,RAOLP=0
"RTN","RAORD",15,0)
 F  S RAOLP=+$O(RAORDS(RAOLP)) Q:'RAOLP!('+$G(RAORDS(RAOLP)))  D
"RTN","RAORD",16,0)
 . S RAOIFN=$G(RAORDS(RAOLP)),RAOSTS=8 D ^RAORDU
"RTN","RAORD",17,0)
 . Q
"RTN","RAORD",18,0)
 D Q2 G 21
"RTN","RAORD",19,0)
Q2 ; Unlock if appropriate, kill vars
"RTN","RAORD",20,0)
 I $$ORVR^RAORDU()'<3,(+$G(RAPTLOCK)),(+$G(RADFN)) D
"RTN","RAORD",21,0)
 . D ULK^RAUTL19(RADFN_";DPT(")
"RTN","RAORD",22,0)
 K %DT,C,D,D0,DA,I,RADFN,RADIV,RANME,RAOFNS,RAOIFN,RAOLP,RAORDS,RAOSCH
"RTN","RAORD",23,0)
 K RAOPTN,RAOSTS,RAOVSTS,X,Y
"RTN","RAORD",24,0)
 K RAPARENT
"RTN","RAORD",25,0)
 K A1,D1,DDER,DDH,DI,DIPGM,POP,^TMP($J,"PRO-ORD")
"RTN","RAORD",26,0)
 Q
"RTN","RAORD",27,0)
 ;
"RTN","RAORD",28,0)
3 ;;Cancel a Request
"RTN","RAORD",29,0)
 N RAPTLOCK,RAXIT S RAXIT=0,RAPKG=""
"RTN","RAORD",30,0)
31 ; Patient lookup
"RTN","RAORD",31,0)
 S DIC="^DPT(",DIC(0)="AEMQ" W ! D ^DIC K DIC G Q3:Y<0
"RTN","RAORD",32,0)
 I $$ORVR^RAORDU()'<3 D  G:'RAPTLOCK 31
"RTN","RAORD",33,0)
 . S RAPTLOCK=$$LK^RAUTL19(+Y_";DPT(")
"RTN","RAORD",34,0)
 . Q
"RTN","RAORD",35,0)
 S RADFN=+Y,RANME=$S($D(^DPT(RADFN,0)):$P(^(0),"^"),1:"Unknown")
"RTN","RAORD",36,0)
 S (RAOFNS,RAOPTN)="Cancel"
"RTN","RAORD",37,0)
 D CHKUSR^RAUTL2 S RAOVSTS=$S(RAMSG:"3;5;8",1:"5")
"RTN","RAORD",38,0)
 W ! D ^RAORDS G Q3:'$D(RAORDS)
"RTN","RAORD",39,0)
 D REASON G Q3:RAXIT!(+$G(OREND))
"RTN","RAORD",40,0)
ENCAN ;OE/RR Entry Point for the CANCEL ACTION Option
"RTN","RAORD",41,0)
 K ORSTRT,ORSTOP,ORTO,ORTX,ORIT,ORCOST,ORPURG
"RTN","RAORD",42,0)
 I $D(RAPKG) W !?3,"...will now 'CANCEL' selected request(s)..."
"RTN","RAORD",43,0)
 S RAOLP=0
"RTN","RAORD",44,0)
 F  S RAOLP=+$O(RAORDS(RAOLP)) Q:'RAOLP!('+$G(RAORDS(RAOLP)))  D
"RTN","RAORD",45,0)
 . S RAOIFN=$G(RAORDS(RAOLP)),RAOSTS=1 D ^RAORDU
"RTN","RAORD",46,0)
 . I $D(RAPKG),$D(^RAO(75.1,RAOIFN,0)),$D(^RAMIS(71,+$P(^(0),"^",2),0)) W !?10,"...",$P(^(0),"^")," cancelled..."
"RTN","RAORD",47,0)
 . ; Print Cancelled Requests if appropriate
"RTN","RAORD",48,0)
 . K RA751,RA791 S RA751=$G(^RAO(75.1,RAOIFN,0))
"RTN","RAORD",49,0)
 . S RA791=$G(^RA(79.1,+$P(RA751,"^",20),0))
"RTN","RAORD",50,0)
 . I $P(RA791,"^",24)]""!(+$P($G(^RA(79.1,+$O(^RA(79.1,0)),0)),"^",24)) D
"RTN","RAORD",51,0)
 .. K RACRHD,RAION,RAPGE,RAX S RAPGE=0,(RACRHD,RAX)=""
"RTN","RAORD",52,0)
 .. ; RAOIFN already defined, RADFN may/maynot be defined!
"RTN","RAORD",53,0)
 .. I '$D(RADFN) N RADFN S RADFN=+$P(RA751,"^")
"RTN","RAORD",54,0)
 .. S RAION=$S($P(RA791,"^",24)]"":$P(RA791,"^",24),1:+$P($G(^RA(79.1,+$O(^RA(79.1,0)),0)),"^",24))
"RTN","RAORD",55,0)
 .. S RAION=$$GET1^DIQ(3.5,RAION_",",.01)
"RTN","RAORD",56,0)
 .. D PCR ; Print Cancelled Request subroutine
"RTN","RAORD",57,0)
 .. K RACRHD,RAION,RAPGE,RAX
"RTN","RAORD",58,0)
 .. Q
"RTN","RAORD",59,0)
 . K RA751,RA791
"RTN","RAORD",60,0)
 . Q
"RTN","RAORD",61,0)
Q3 ; unlock if appropriate, kill variables
"RTN","RAORD",62,0)
 I $$ORVR^RAORDU()'<3,(+$G(RAPTLOCK)),(+$G(RADFN)) D
"RTN","RAORD",63,0)
 . D ULK^RAUTL19(RADFN_";DPT(")
"RTN","RAORD",64,0)
 K %,%DT,C,D,D0,DA,POP,RADFN,RADIV,RAMSG,RANME,RAOFNS,RAOIFN,RAOLP
"RTN","RAORD",65,0)
 K RAOPTN,RAORDS,RAOSTS,RAOVSTS I $D(RAPKG) K OREND,RAPKG
"RTN","RAORD",66,0)
 I '$D(N)!($D(RAOREA)<10) K RAPARENT,X,Y
"RTN","RAORD",67,0)
 I '$D(N)!($D(RAOREA)<10) K RAOREA G Q35
"RTN","RAORD",68,0)
 I $D(RAOREA)>1,$G(N) K RAOREA(N),N I $D(RAOREA)<10 K RAOREA
"RTN","RAORD",69,0)
 K RAPARENT,X,Y
"RTN","RAORD",70,0)
Q35 K DIPGM,I
"RTN","RAORD",71,0)
 Q
"RTN","RAORD",72,0)
CHECK ; Check on the status of the order
"RTN","RAORD",73,0)
 S OREND=$S(ORSTS=5:0,ORSTS=11:0,1:1) W:OREND !!,"Only orders in a Pending or Unreleased status can be cancelled.",$C(7)
"RTN","RAORD",74,0)
 Q
"RTN","RAORD",75,0)
REASON ; Select a Cancel Reason
"RTN","RAORD",76,0)
 S DIC("A")="Select CANCEL REASON: ",DIC("S")="I $P(^(0),U,2)=1!($P(^(0),U,2)=9)",DIC="^RA(75.2,",DIC(0)="AEMQ"
"RTN","RAORD",77,0)
 W ! D ^DIC K DIC
"RTN","RAORD",78,0)
 I +Y<0,(X["^") S RAXIT=1 Q
"RTN","RAORD",79,0)
 I +Y<0 W !!?3,"A Cancel Reason is required to proceed." G REASON
"RTN","RAORD",80,0)
 S OREND=0,RAOREA($S($D(ORPK):ORPK,$D(ORIFN):ORIFN,1:1))=+Y
"RTN","RAORD",81,0)
 Q
"RTN","RAORD",82,0)
4 ;;Hold a Request
"RTN","RAORD",83,0)
 N RAPTLOCK
"RTN","RAORD",84,0)
40 ; Patient lookup
"RTN","RAORD",85,0)
 S DIC="^DPT(",DIC(0)="AEMQ" W ! D ^DIC K DIC G Q4:Y<0
"RTN","RAORD",86,0)
 I $$ORVR^RAORDU()'<3 D  G:'RAPTLOCK 40
"RTN","RAORD",87,0)
 . S RAPTLOCK=$$LK^RAUTL19(+Y_";DPT(")
"RTN","RAORD",88,0)
 . Q
"RTN","RAORD",89,0)
 S RADFN=+Y,RANME=$S($D(^DPT(RADFN,0)):$P(^(0),"^"),1:"Unknown")
"RTN","RAORD",90,0)
 S (RAOFNS,RAOPTN)="Hold",RAOVSTS="5;8"
"RTN","RAORD",91,0)
 W ! D ^RAORDS G Q4:'$D(RAORDS)
"RTN","RAORD",92,0)
41 ; Select a Hold Reason
"RTN","RAORD",93,0)
 S DIC("A")="Select HOLD REASON: ",DIC("S")="I $P(^(0),U,2)=3!($P(^(0),U,2)=9)",DIC="^RA(75.2,",DIC(0)="AEMQ" W ! D ^DIC K DIC
"RTN","RAORD",94,0)
 I +Y<0,(X["^") D Q4 Q
"RTN","RAORD",95,0)
 I +Y<0 W !!?3,"A Hold Reason is required to proceed." G 41
"RTN","RAORD",96,0)
 S RAOREA=+Y
"RTN","RAORD",97,0)
 W !?3,"...will now 'HOLD' selected request(s)..." S RAOLP=0
"RTN","RAORD",98,0)
 F  S RAOLP=+$O(RAORDS(RAOLP)) Q:'RAOLP!('+$G(RAORDS(RAOLP)))  D
"RTN","RAORD",99,0)
 . S RAOIFN=$G(RAORDS(RAOLP)),RAOSTS=3 D ^RAORDU
"RTN","RAORD",100,0)
 . I $D(^RAO(75.1,RAOIFN,0)),$D(^RAMIS(71,+$P(^(0),"^",2),0)) W !?10,"...",$P(^(0),"^")," held..."
"RTN","RAORD",101,0)
 . Q
"RTN","RAORD",102,0)
 D Q4 G 40
"RTN","RAORD",103,0)
Q4 ; unlock if appropriate, kill variables
"RTN","RAORD",104,0)
 I $$ORVR^RAORDU()'<3,(+$G(RAPTLOCK)),(+$G(RADFN)) D
"RTN","RAORD",105,0)
 . D ULK^RAUTL19(RADFN_";DPT(")
"RTN","RAORD",106,0)
 K %DT,C,D,D0,DA,I,POP,RADFN,RADIV,RANME,RAOFNS,RAOIFN,RAOLP,RAORDS
"RTN","RAORD",107,0)
 K RAOPTN,RAOREA,RAOSTS,RAOVSTS,X,Y
"RTN","RAORD",108,0)
 K D1,DDER,DI,DIPGM,DISYS,DUOUT,RAPARENT,^TMP($J,"PRO-ORD"),^("XQALSET")
"RTN","RAORD",109,0)
 Q
"RTN","RAORD",110,0)
 ;
"RTN","RAORD",111,0)
6 ;;Udate a HOLD REASON /RA*5*133
"RTN","RAORD",112,0)
 N RAPTLOCK
"RTN","RAORD",113,0)
60 ; Patient lookup
"RTN","RAORD",114,0)
 S DIC="^DPT(",DIC(0)="AEMQ" W ! D ^DIC K DIC G 64:Y<0
"RTN","RAORD",115,0)
 S RADFN=+Y,RANME=$S($D(^DPT(RADFN,0)):$P(^(0),"^"),1:"Unknown")
"RTN","RAORD",116,0)
 S (RAOFNS,RAOPTN)="Update hold reason",RAOVSTS="3"
"RTN","RAORD",117,0)
 W ! D ^RAORDS G 64:'$D(RAORDS)
"RTN","RAORD",118,0)
61 ; Select a Hold Reason
"RTN","RAORD",119,0)
 S DIC("A")="Select HOLD REASON: ",DIC("S")="I $P(^(0),U,2)=3",DIC="^RA(75.2,",DIC(0)="AEMQ" W ! D ^DIC K DIC
"RTN","RAORD",120,0)
 I +Y<0,(X["^ ") D 64 Q
"RTN","RAORD",121,0)
 I +Y<0 W !!?3,"A Hold Reason is required to proceed." G 61
"RTN","RAORD",122,0)
 S RAOREA=+Y
"RTN","RAORD",123,0)
 W !?3,"...will now update the hold reason for the selected request(s)..." S RAOLP=0
"RTN","RAORD",124,0)
 F  S RAOLP=+$O(RAORDS(RAOLP)) Q:'RAOLP!('+$G(RAORDS(RAOLP)))  D
"RTN","RAORD",125,0)
 . S RAOIFN=$G(RAORDS(RAOLP)),RAOSTS=3 D ^RAORDU
"RTN","RAORD",126,0)
 . I $D(^RAO(75.1,RAOIFN,0)),$D(^RAMIS(71,+$P(^(0),"^",2),0)) W !?10,"...",$P(^(0),"^")," updated..."
"RTN","RAORD",127,0)
 . Q
"RTN","RAORD",128,0)
 D 64 G 60
"RTN","RAORD",129,0)
64 ; unlock if appropriate, kill variables
"RTN","RAORD",130,0)
 K %DT,C,D,D0,DA,I,POP,RADFN,RADIV,RANME,RAOFNS,RAOIFN,RAOLP,RAORDS
"RTN","RAORD",131,0)
 K RAOPTN,RAOREA,RAOSTS,RAOVSTS,X,Y
"RTN","RAORD",132,0)
 K D1,DDER,DI,DIPGM,DISYS,DUOUT,RAPARENT,^TMP($J,"PRO-ORD"),^("XQALSET")
"RTN","RAORD",133,0)
 Q
"RTN","RAORD",134,0)
 ;
"RTN","RAORD",135,0)
9 ;;Print Selected Requests by Patient
"RTN","RAORD",136,0)
 K ^TMP($J,"RA PRINT HS BY PAT")
"RTN","RAORD",137,0)
 S DIC="^DPT(",DIC(0)="AEMQ" W ! D ^DIC K DIC G Q9:Y<0 S RADFN=+Y,RANME=$S($D(^DPT(RADFN,0)):$P(^(0),"^"),1:"Unknown"),RAOFNS="Print",RAOVSTS="1;2;3;5;6;8" W ! D ^RAORDS G Q9:'$D(RAORDS)
"RTN","RAORD",138,0)
 S RAOIFNS="" F RAOLP=1:1 Q:'$D(RAORDS(RAOLP))  S RAOIFNS=RAOIFNS_+RAORDS(RAOLP)_";"
"RTN","RAORD",139,0)
 W ! K DIR,DIROUT,DIRUT,DTOUT,DUOUT
"RTN","RAORD",140,0)
 S DIR(0)="Y",DIR("B")="No"
"RTN","RAORD",141,0)
 S DIR("?")="Answer 'Y'es to print the report, 'N'o to quit."
"RTN","RAORD",142,0)
 S DIR("A")="Do you wish to generate a Health Summary Report"
"RTN","RAORD",143,0)
 D ^DIR G:$D(DIRUT) Q9 S RAGMTS=+Y
"RTN","RAORD",144,0)
 S ZTRTN="START9^RAORD",ZTSAVE("RADFN")="",ZTSAVE("RAOIFNS")=""
"RTN","RAORD",145,0)
 S ZTSAVE("RAGMTS")="" S:$D(RAOPT) ZTSAVE("RAOPT(")=""
"RTN","RAORD",146,0)
 W ! D ZIS^RAUTL G Q9:RAPOP
"RTN","RAORD",147,0)
 ;
"RTN","RAORD",148,0)
START9 ; Start printing requests
"RTN","RAORD",149,0)
 U IO S RAX="" N RA751
"RTN","RAORD",150,0)
 F RAOLP=1:1 S RAOIFN=$P(RAOIFNS,";",RAOLP) Q:'RAOIFN!(RAX["^")  D
"RTN","RAORD",151,0)
 . S RAPGE=0 D ^RAORD5 Q:RAX["^"
"RTN","RAORD",152,0)
 . D CRCHK^RAORD6 Q:RAX["^"
"RTN","RAORD",153,0)
 . Q:'RAGMTS  ; quit if 'No' to 'generate a Health Summary Report'.
"RTN","RAORD",154,0)
 . S RA751(0)=$G(^RAO(75.1,RAOIFN,0)),RA751(2)=$P(RA751(0),"^",2)
"RTN","RAORD",155,0)
 . S GMTSTYP=$P($G(^RAMIS(71,+RA751(2),0)),"^",13)
"RTN","RAORD",156,0)
 . I GMTSTYP>0,('$D(^TMP($J,"RA PRINT HS BY PAT",GMTSTYP,RADFN))) D
"RTN","RAORD",157,0)
 .. W:$Y>0 @IOF D ENX^GMTSDVR(RADFN,GMTSTYP)
"RTN","RAORD",158,0)
 .. S ^TMP($J,"RA PRINT HS BY PAT",GMTSTYP,RADFN)=""
"RTN","RAORD",159,0)
 .. Q
"RTN","RAORD",160,0)
 . Q
"RTN","RAORD",161,0)
Q9 K %DT,C,D,D0,DA,DFN,GMTSTYP,I,POP,RACNI,RADFN,RADIV,RADTI,RANME,RAOFNS
"RTN","RAORD",162,0)
 K RAOIFN,RAOIFNS,RAOLP,RAORDS,RAOSTS,RAOVSTS,RAPARENT,RAPGE,RAPOP,RAX
"RTN","RAORD",163,0)
 K RAGMTS,VAI,VAIN,X,Y,Z,^TMP($J,"RA PRINT HS BY PAT")
"RTN","RAORD",164,0)
 K RAMES,ZTDESC,ZTRTN,ZTSAVE
"RTN","RAORD",165,0)
 K DIR,DIROUT,DIRUT,DTOUT,DUOUT
"RTN","RAORD",166,0)
 K DIPGM,DISYS,DIW,DIWT,DN,RA6,RA7,^TMP($J,"PRO-ORD")
"RTN","RAORD",167,0)
 W ! D CLOSE^RAUTL
"RTN","RAORD",168,0)
 Q
"RTN","RAORD",169,0)
KILL ; kill variables - called from RAORD1
"RTN","RAORD",170,0)
 K %,%DT,D,D0,D1,DA,DFN,DIC,DIK,DIROUT,DIRUT,DIV,DR,DTOUT,DUOUT,DWPK,J,OREND,RABLNK,RACNT,RACT,RADIV,RAEXMUL,RAFIN,RAFIN1,RAI,RAILOC,RAIMGTYI,RAIP,RAJ,RAL0,RALOC,RALIFN,RALOCFLG
"RTN","RAORD",171,0)
 K RAMOD,RAMT,RANUM,RAOIFN,RAORD0,RAOUT,RAPIFN,RAPRC,RAPRI,RAPREG,RAPREOP1,RAREASK,RAREQDT,RAREQPRT,RARU,RARX,RASEQ,RAS3,RASEX,RASKPREG,RASTOP,RASX,RAWHEN,RAX,VAERR,VA200,VAI,VAIP,X,Y
"RTN","RAORD",172,0)
 K RAACI
"RTN","RAORD",173,0)
 I '$D(RAPKG),$G(XQORS)>1,$G(^TMP("XQORS",$J,XQORS-1,"ITM"))'=$G(^("TOT")) Q  ;don't kill clin hist if order entry quick orders not all proccessed
"RTN","RAORD",174,0)
 K ^TMP($J,"RAWP")
"RTN","RAORD",175,0)
 Q
"RTN","RAORD",176,0)
PCR ; Print Cancelled Requests.  Called from the 'Cancel A Request' option.
"RTN","RAORD",177,0)
 N I,ZTDESC,ZTDTH,ZTIO,ZTRTN,ZTSAVE,ZTSK
"RTN","RAORD",178,0)
 S ZTDESC="Rad/Nuc Med Cancelled Request Print",ZTDTH=$H,ZTIO=RAION
"RTN","RAORD",179,0)
 S ZTRTN="^RAORD5"
"RTN","RAORD",180,0)
 F I="RACRHD","RADFN","RAOIFN","RAPGE","RAX" S ZTSAVE(I)=""
"RTN","RAORD",181,0)
 D ^%ZTLOAD W:$D(ZTSK) !!?3,$C(7),"Task "_ZTSK_": cancellation queued to print on device ",RAION,!
"RTN","RAORD",182,0)
 D HOME^%ZIS
"RTN","RAORD",183,0)
 Q
"RTN","RAORDP")
0^2^B32264519^B27179434
"RTN","RAORDP",1,0)
RAORDP ;HISC/CAH,FPT AISC/DMK-Log of Pending/Hold Requests ;4/17/96  11:28
"RTN","RAORDP",2,0)
 ;;5.0;Radiology/Nuclear Medicine;**15,133**;Mar 16, 1998;Build 4
"RTN","RAORDP",3,0)
 ;
"RTN","RAORDP",4,0)
 ; This report looks at all orders in file 75.1 with status=5 (pending)
"RTN","RAORDP",5,0)
 ; or status=3 (hold) and field 21 (Desired Date) within the date range
"RTN","RAORDP",6,0)
 ; selected.
"RTN","RAORDP",7,0)
 ;
"RTN","RAORDP",8,0)
 W !!,"This option will generate a list of requests for a selected date",!,"range with the status of 'PENDING' or 'HOLD'",!
"RTN","RAORDP",9,0)
 K DIR S DIR(0)="S^H:HOLD;P:PENDING",DIR("A")="Select REQUEST STATUS",DIR("B")="P" D ^DIR K DIR
"RTN","RAORDP",10,0)
 I $D(DIRUT) D KILL Q
"RTN","RAORDP",11,0)
 W ! S RAREQSTA=$S(Y="P":5,1:3)
"RTN","RAORDP",12,0)
 S RANOSCRN="" D OMA^RAUTL13 K RANOSCRN I '$L($O(RALOC(0)))!($G(RAQUIT)=1) D KILL Q
"RTN","RAORDP",13,0)
 S RADDT=1 D DATE^RAUTL K RADDT G KILL:RAPOP S RAOBEG=BEGDATE,RAOEND=ENDDATE+.9 K BEGDATE,ENDDATE
"RTN","RAORDP",14,0)
 S ZTRTN="START^RAORDP",ZTSAVE("RALOC(")="",ZTSAVE("RAOBEG")="",ZTSAVE("RAOEND")="",ZTSAVE("RAREQSTA")=""
"RTN","RAORDP",15,0)
 W !!,"This report requires a 132 column output device." D ZIS^RAUTL G KILL:RAPOP
"RTN","RAORDP",16,0)
START ; start report processing
"RTN","RAORDP",17,0)
 U IO S QQ="",$P(QQ,"=",132)="=",RALOCNM="",RAOLOC="",RAHDR="LOG OF "_$S(RAREQSTA=5:"PENDING",1:"HOLD")_" REQUESTS",RAHDRDSH="",$P(RAHDRDSH,"-",$L(RAHDR))="-"
"RTN","RAORDP",18,0)
 S RAOBEG("X")=+$E(RAOBEG,4,5)_"/"_+$E(RAOBEG,6,7)_"/"_$E(RAOBEG,2,3)
"RTN","RAORDP",19,0)
 S RAOEND("X")=+$E(RAOEND,4,5)_"/"_+$E(RAOEND,6,7)_"/"_$E(RAOEND,2,3)
"RTN","RAORDP",20,0)
 S X="NOW",%DT="T" D ^%DT D D^RAUTL S RARUNDTE=Y K %DT
"RTN","RAORDP",21,0)
 I $D(ZTQUEUED) S ZTREQ="@"
"RTN","RAORDP",22,0)
 F  S RALOCNM=$O(RALOC(RALOCNM)) Q:RALOCNM=""  S RA791IEN="" F  S RA791IEN=$O(RALOC(RALOCNM,RA791IEN)) Q:RA791IEN=""  S RALOC1(RA791IEN)=0,RALOCIT(+$P(^RA(79.1,RA791IEN,0),"^",6))=""
"RTN","RAORDP",23,0)
 K RALOCNM,RA791IEN S RADFN=0
"RTN","RAORDP",24,0)
 F  S RADFN=$O(^RAO(75.1,"AS",RADFN)) Q:'RADFN!($D(RAEOS))  D
"RTN","RAORDP",25,0)
 .S RAOIFN=0 F  S RAOIFN=$O(^RAO(75.1,"AS",RADFN,RAREQSTA,RAOIFN)) Q:'RAOIFN!($D(RAEOS))  D
"RTN","RAORDP",26,0)
 ..I $D(^RAO(75.1,RAOIFN,0)) S RAO(0)=^(0),RAODT=$P(RAO(0),"^",21),RAOREA=$P(RAO(0),"^",10),RAOPHY=$P(RAO(0),"^",14),RALADT=$P(RAO(0),"^",18),RAILOC=$P(RAO(0),"^",20),RAIMTYP=$P(RAO(0),"^",3) D
"RTN","RAORDP",27,0)
 ...I $D(RALOC1(+RAILOC)) D SETTMP Q
"RTN","RAORDP",28,0)
 ...I RAILOC="",$D(RALOCIT(+RAIMTYP)) D SETTMP
"RTN","RAORDP",29,0)
 I $D(RAEOS) D KILL Q
"RTN","RAORDP",30,0)
 S RAILOC=""
"RTN","RAORDP",31,0)
 F  S RAILOC=$O(RALOC1(RAILOC)) Q:RAILOC=""!($D(RAEOS))  S RACNT=0 D CONT
"RTN","RAORDP",32,0)
KILL W !
"RTN","RAORDP",33,0)
 K ^TMP($J,"RA")
"RTN","RAORDP",34,0)
 K CNT,DIC,DIROUT,DIRUT,DTOUT,DUOUT,I,QQ,RACNT,RADFN,RADDT,RADLOCS,RADT,RAEOS,RAHDR,RAHDRDSH,RAILOC,RAIMTYP,RALOC,RALOC1,RALOCIT
"RTN","RAORDP",35,0)
 K RALOCS,RALOCSAV,RALOCN,RAO,RAOBEG,RAODT,RAOEND,RAOIFN,RAOLOC,RAORD0,RAPOP,RAPR,RAQUIT,RARDT,RAREQSTA,BEGDATE,ENDDATE,RARUNDTE
"RTN","RAORDP",36,0)
 K X,Y,RAMES,RALADT,RAOPHY,RAOREA,RADD,ZTDESC,ZTRTN,ZTSAVE
"RTN","RAORDP",37,0)
 D CLOSE^RAUTL
"RTN","RAORDP",38,0)
 K POP,DDH,DISYS,DFN,VAERR
"RTN","RAORDP",39,0)
 Q
"RTN","RAORDP",40,0)
CONT ;
"RTN","RAORDP",41,0)
 I $E(IOST,1,2)="C-",RAOLOC]"",RAOLOC'=RAILOC D EOS Q:$D(RAEOS)
"RTN","RAORDP",42,0)
 D HDR Q:$D(RAEOS)
"RTN","RAORDP",43,0)
 I +RALOC1(RAILOC)=0 W !?2,"No requests "_$S(RAREQSTA=5:"pending",1:"on hold")_" for "_RAOBEG("X")_" to "_RAOEND("X")_".",! I $E(IOST,1,2)="C-"&($O(RALOC1(RAILOC))]"") D EOS Q:$D(RAEOS)  D  Q
"RTN","RAORDP",44,0)
 .S RAOLOC(0)=$O(RALOC1(RAILOC)) S:RAOLOC(0)]"" RAOLOC=RAOLOC(0) K RAOLOC(0)
"RTN","RAORDP",45,0)
 S RADT=0 F  S RADT=$O(^TMP($J,"RA",RAILOC,RADT)) Q:'RADT!($D(RAEOS))  D DATE S RADFN=0 F  S RADFN=$O(^TMP($J,"RA",RAILOC,RADT,RADFN)) Q:'RADFN!($D(RAEOS))  D MORE
"RTN","RAORDP",46,0)
 Q
"RTN","RAORDP",47,0)
MORE ; 
"RTN","RAORDP",48,0)
 S RARDT=0 F  S RARDT=$O(^TMP($J,"RA",RAILOC,RADT,RADFN,RARDT)) Q:'RARDT!($D(RAEOS))  S RAPR=0 F  S RAPR=$O(^TMP($J,"RA",RAILOC,RADT,RADFN,RARDT,RAPR)) Q:'RAPR!($D(RAEOS))  D
"RTN","RAORDP",49,0)
 .S RAOPHY=0 F  S RAOPHY=$O(^TMP($J,"RA",RAILOC,RADT,RADFN,RARDT,RAPR,RAOPHY)) Q:'RAOPHY!($D(RAEOS))  S RALADT=0 F  S RALADT=$O(^(RAOPHY,RALADT)) Q:'RALADT!($D(RAEOS))  S RAO=0 F  S RAO=$O(^(RALADT,RAO)) Q:'RAO!($D(RAEOS))  D
"RTN","RAORDP",50,0)
 ..N RAREA S RAOREA=$G(^TMP($J,"RA",RAILOC,RADT,RADFN,RARDT,RAPR,RAOPHY,RALADT,RAO))
"RTN","RAORDP",51,0)
 ..S RAORD0=^RAO(75.1,+RAO,0),RACNT=RACNT+1
"RTN","RAORDP",52,0)
 ..K RALOCN,RARLOCN
"RTN","RAORDP",53,0)
 ..D IPOP^RAUTL13
"RTN","RAORDP",54,0)
 ..D WRT
"RTN","RAORDP",55,0)
 Q
"RTN","RAORDP",56,0)
WRT ;
"RTN","RAORDP",57,0)
 S Y=RADT D DD^%DT S RADD=Y S Y=$P(RALADT,".") D DD^%DT S RALADT=Y
"RTN","RAORDP",58,0)
 W !,$S($D(^DPT(RADFN,0)):$E($P(^(0),"^"),1,19),1:"Unknown"),?21,$E($P(^DPT(RADFN,0),"^",9),6,9),?27,$S($D(^RAMIS(71,RAPR,0)):$E($P(^(0),"^"),1,24),1:"Unknown"),?53,$P(RADD,"@")
"RTN","RAORDP",59,0)
 S Y=$P(RARDT,".") D DD^%DT W ?67,Y
"RTN","RAORDP",60,0)
 W ?81,$S(RAREQSTA=3:RALADT,1:$E($$GET1^DIQ(200,RAOPHY,.01),1,19))
"RTN","RAORDP",61,0)
 I RAREQSTA=3 W ?95,$E($$GET1^DIQ(75.2,RAOREA,.01),1,28)
"RTN","RAORDP",62,0)
 E  W ?102,$E(RALOCN,1,28)
"RTN","RAORDP",63,0)
 ;I $L($G(RARLOCN)) W !?36,"Requesting Loc: ",RARLOCN
"RTN","RAORDP",64,0)
 S RAOLOC=RAILOC
"RTN","RAORDP",65,0)
 I ($Y+6)>IOSL D EOS Q:$D(RAEOS)  D:RACNT<RALOC1(RAILOC) HDR Q:$D(RAEOS)  I RACNT=RALOC1(RAILOC) S RAOLOC(0)=$O(RALOC1(RAILOC)) S:RAOLOC(0)]"" RAOLOC=RAOLOC(0) K RAOLOC(0)
"RTN","RAORDP",66,0)
 Q
"RTN","RAORDP",67,0)
HDR ; header
"RTN","RAORDP",68,0)
 W:$Y>0 @IOF
"RTN","RAORDP",69,0)
 W !?(80-$L(RAHDR)/2),RAHDR
"RTN","RAORDP",70,0)
 W !?14,"Includes requests scheduled from ",RAOBEG("X")," to ",RAOEND("X") ;W !?(80-$L(RAHDR)/2),RAHDRDSH
"RTN","RAORDP",71,0)
 W !,"IMAGING LOCATION: ",$S('RAILOC:"Unknown",$D(^RA(79.1,RAILOC,0)):$S($D(^SC($P(^(0),"^"),0)):$P(^(0),"^"),1:"Unknown"),1:"Unknown"),?51,"Run Date: ",RARUNDTE,!
"RTN","RAORDP",72,0)
 W !,"PATIENT NAME",?21,"SSN",?27,"PROCEDURE",?53,"DATE DESIRED",?67,"DATE ORDERED"
"RTN","RAORDP",73,0)
 W ?81,$S(RAREQSTA=3:"HOLD DATE",1:"ORDERING PROVIDER")
"RTN","RAORDP",74,0)
 I RAREQSTA=3 W ?95,"HOLD REASON",!,QQ,!!
"RTN","RAORDP",75,0)
 E  W ?102,"PT LOC",!,QQ,!!
"RTN","RAORDP",76,0)
 I $D(ZTQUEUED) D STOPCHK^RAUTL9 S:$G(ZTSTOP)=1 RAEOS=""
"RTN","RAORDP",77,0)
 Q
"RTN","RAORDP",78,0)
DATE ; Output 'Desired Date'
"RTN","RAORDP",79,0)
 ;S Y=RADT D DD^%DT S X=$L(Y)+32 W !!?(80-X/2),"Desired Date (Time optional): ",Y,!?(80-X/2) S Y="",$P(Y,"-",X)="-" W Y,!
"RTN","RAORDP",80,0)
 Q
"RTN","RAORDP",81,0)
SETTMP ; set-up ^TMP($J
"RTN","RAORDP",82,0)
 I $D(ZTQUEUED) D STOPCHK^RAUTL9 S:$G(ZTSTOP)=1 RAEOS="" Q:$D(RAEOS)
"RTN","RAORDP",83,0)
 I $S('RAODT:0,'RADFN:0,'$P(RAO(0),"^",16):0,'$P(RAO(0),"^",2):0,1:1),RAODT'<RAOBEG,RAODT'>RAOEND S ^TMP($J,"RA",$S(RAILOC:RAILOC,1:"UNKNOWN"),$P(RAO(0),"^",21),RADFN,$P(RAO(0),"^",16),$P(RAO(0),"^",2),RAOPHY,RALADT,RAOIFN)=RAOREA D
"RTN","RAORDP",84,0)
 .I RAILOC="" S:'$D(RALOC1("UNKNOWN")) RALOC1("UNKNOWN")=0 S RALOC1("UNKNOWN")=RALOC1("UNKNOWN")+1 Q
"RTN","RAORDP",85,0)
 .S:RAILOC>0 RALOC1(RAILOC)=RALOC1(RAILOC)+1
"RTN","RAORDP",86,0)
 Q
"RTN","RAORDP",87,0)
EOS ; end of screen
"RTN","RAORDP",88,0)
 S X=$$EOS^RAUTL5
"RTN","RAORDP",89,0)
 S:X=1 RAEOS=""
"RTN","RAORDP",90,0)
 Q
"RTN","RAORDU")
0^4^B27367921^B27668360
"RTN","RAORDU",1,0)
RAORDU ;HISC/CAH - AISC/RMO-Update Request Status ;9/7/04 11:01am
"RTN","RAORDU",2,0)
 ;;5.0;Radiology/Nuclear Medicine;**18,41,57,133**;Mar 16, 1998;Build 4
"RTN","RAORDU",3,0)
 ; last modif JULY 5,00
"RTN","RAORDU",4,0)
 ;The variables RAOIFN and RAOSTS must be defined. The variable
"RTN","RAORDU",5,0)
 ;RAOREA is set when Canceling and Holding a request. The
"RTN","RAORDU",6,0)
 ;variable RAOSCH is set when Scheduling a request.
"RTN","RAORDU",7,0)
 ; RAOSTS=request status of exam
"RTN","RAORDU",8,0)
 ; RAESTAT=min stat exams same dt/tm^max stat^1(if stat found) 0(else)
"RTN","RAORDU",9,0)
 N RAESTAT
"RTN","RAORDU",10,0)
 I RAOSTS=2,($$PARNT^RASETU(RAOIFN,RADFN)),($P($G(RAEXM0),"^",25)) D  Q:RAOSTS=6
"RTN","RAORDU",11,0)
 . S RAESTAT=$$EN1^RASETU(RAOIFN,RADFN)
"RTN","RAORDU",12,0)
 . S RAOSTS=$S((+RAESTAT'<1)&(+RAESTAT'>8):6,1:RAOSTS)
"RTN","RAORDU",13,0)
 . K:RAOSTS=6 ORIFN,ORETURN
"RTN","RAORDU",14,0)
 . I '$D(RAF1),(+RAESTAT=9) D
"RTN","RAORDU",15,0)
 .. W !?3,"...will now designate request status as 'COMPLETE'..."
"RTN","RAORDU",16,0)
 .. W !?10,"...request status successfully updated."
"RTN","RAORDU",17,0)
 .. Q
"RTN","RAORDU",18,0)
 . Q
"RTN","RAORDU",19,0)
 I $D(ORSTS),ORSTS=11,$P(^RAO(75.1,RAOIFN,0),"^",5)=11 S ORIFN=+$P(^(0),"^",7),ORSTS="K",DA=RAOIFN,DIK="^RAO(75.1," D DELETE,^DIK K DIK D:ORIFN ST^ORX K ORSTS Q
"RTN","RAORDU",20,0)
 K N I $D(RAOREA)>1 S N=$S($D(RAOIFN):RAOIFN,$D(ORPK):ORPK,1:1) I '$D(RAOREA(N)) S N=$O(RAOREA(0))
"RTN","RAORDU",21,0)
 S DA=RAOIFN,DIE="^RAO(75.1,",DR="10///"_$S($D(RAOREA)&(RAOSTS=1!(RAOSTS=3)):"/^S X="_$S($D(N):RAOREA(N),1:RAOREA),'$D(^RAO(75.1,RAOIFN,0)):"",$P(^(0),"^",10):"@",1:"")_";I 1;5///^S X="_RAOSTS
"RTN","RAORDU",22,0)
 I $D(RAVSTFLG),$D(RAVLEDTI) S DR=DR_";17///^S X="_(9999999.9999-RAVLEDTI)
"RTN","RAORDU",23,0)
 S DR=DR_";18///^S X=""NOW"";23///"_$S($D(RAOSCH)&(RAOSTS=8):"^S X="_RAOSCH,'$D(^RAO(75.1,RAOIFN,0)):"",$P(^(0),"^",23):"@",1:"")
"RTN","RAORDU",24,0)
 S RADIV=$$SITE(),RADIV=$S($D(^RA(79,RADIV,0)):RADIV,1:$O(^RA(79,0)))
"RTN","RAORDU",25,0)
 I $D(^RA(79,+RADIV,.1)),$P(^(.1),"^",19)="y" D SETLOG
"RTN","RAORDU",26,0)
 D ^DIE K DE,DQ,DIE,DR I $$ORVR^RAORDU()=2.5 S ORIFN=$S($D(^RAO(75.1,RAOIFN,0)):+$P(^(0),"^",7),1:0),ORETURN("ORSTS")=RAOSTS D:ORIFN RETURN^ORX K ORIFN,ORETURN
"RTN","RAORDU",27,0)
 ;
"RTN","RAORDU",28,0)
 ; if oe/rr v.3 or greater do the following
"RTN","RAORDU",29,0)
 ; .send a discontinue or hold message to oe/rr if request status in file
"RTN","RAORDU",30,0)
 ;  75.1 is discontinued (1) or hold (3).
"RTN","RAORDU",31,0)
 ; .send a complete message to oe/rr if request status in file 75.1 is 
"RTN","RAORDU",32,0)
 ;  complete.
"RTN","RAORDU",33,0)
 ; .send a scheduled message to oe/rr if request status is active (6) or
"RTN","RAORDU",34,0)
 ;  scheduled (8) AND the request was not a rollback from a status of
"RTN","RAORDU",35,0)
 ;  complete.
"RTN","RAORDU",36,0)
 ;
"RTN","RAORDU",37,0)
 I $$ORVR^RAORDU()'<3 D
"RTN","RAORDU",38,0)
 . D:(RAOSTS=1)!(RAOSTS=3) EN1^RAO7CH(RAOIFN)
"RTN","RAORDU",39,0)
 . D:RAOSTS=2 EN1^RAO7CMP(RAOIFN)
"RTN","RAORDU",40,0)
 . I (RAOSTS=6) Q:$G(RA18PCHG,0)=1  ;P18 quit if procedure was changed - do not send "SC" message,because "XX" have been sent already
"RTN","RAORDU",41,0)
 . I ((RAOSTS=6)!(RAOSTS=8))&($P($G(RAORDB4),"^",5)'=2) D
"RTN","RAORDU",42,0)
 .. D EN1^RAO7SCH(RAOIFN)
"RTN","RAORDU",43,0)
 .. Q
"RTN","RAORDU",44,0)
 . Q
"RTN","RAORDU",45,0)
 ; ***** PCE changes follow *****
"RTN","RAORDU",46,0)
 I $$PCE^RAWORK(),(RAOSTS=2),$G(RASAVDR)'="[RA OVERRIDE]" D
"RTN","RAORDU",47,0)
 . N RA7003 S RA7003=$G(^RADPT(RADFN,"DT",RADTI,"P",RACNI,0))
"RTN","RAORDU",48,0)
 . Q:$P(RA7003,"^",24)="Y"  ; quit if clinic stop credited
"RTN","RAORDU",49,0)
 . ;BILLING AWARE PHASE II, NO LONGER SENDING TO PTF
"RTN","RAORDU",50,0)
 . ;I $P(RA7003,"^",6)]"",($P(^DIC(42,$P(RA7003,"^",6),0),"^",3)'="D") Q
"RTN","RAORDU",51,0)
 . ;omit quit since both inpatient and outpatient data are sent to PCE
"RTN","RAORDU",52,0)
 . D COMPLETE^RAPCE(RADFN,RADTI,RACNI)
"RTN","RAORDU",53,0)
 . Q
"RTN","RAORDU",54,0)
 ; PFSS 1B project. If the request status is discontinue then send the delete event to IBB
"RTN","RAORDU",55,0)
 I RAOSTS=1 D DC^RABWIBB(RAOIFN)  ; Requirement 8
"RTN","RAORDU",56,0)
 Q
"RTN","RAORDU",57,0)
 ;
"RTN","RAORDU",58,0)
SETLOG K N I $D(RAOREA)>1 S N=$S($D(RAOIFN):RAOIFN,$D(ORPK):ORPK,1:1) I '$D(RAOREA(N)) S N=$O(RAOREA(0))
"RTN","RAORDU",59,0)
 S DR=DR_";75///^S X=$$NOW^XLFDT()",DR(2,75.12)="2////^S X="_RAOSTS_";3////^S X="_$S($G(RADUZ):RADUZ,1:DUZ)_";4///"_$S($D(RAOREA)&(RAOSTS=1!(RAOSTS=3)):"/^S X="_$S($D(N):RAOREA(N),1:RAOREA),1:"")
"RTN","RAORDU",60,0)
 Q
"RTN","RAORDU",61,0)
SETORD ;Create request in OE/RR file and add OE/RR order number to file 75.1
"RTN","RAORDU",62,0)
 ; if oe/rr v.3 or greater send an hl7 message when creating a new request/order.
"RTN","RAORDU",63,0)
 I $$ORVR^RAORDU()'<3 D EN1^RAO7NEW(RAOIFN) Q
"RTN","RAORDU",64,0)
 Q:$$ORVR^RAORDU()'=2.5
"RTN","RAORDU",65,0)
 N RAPRGST S RAPRGST=$P(RAORD0,"^",13)
"RTN","RAORDU",66,0)
 K RAMOD S $P(RABLNK," ",41)="" F I=0:0 S I=$O(^RAO(75.1,RAOIFN,"M","B",I)) Q:'I  I $D(^RAMIS(71.2,+I,0)) S RAMOD=$S('$D(RAMOD):$P(^(0),"^"),1:RAMOD_", "_$P(^(0),"^"))
"RTN","RAORDU",67,0)
 I $$ORVR^RAORDU()=2.5 S (RAPRCD,ORTX(1))=$P($G(^RAMIS(71,+$P(RAORD0,"^",2),0)),"^")_"," D
"RTN","RAORDU",68,0)
 .I $D(RAMOD) S ORTX(2)="Modifiers: "_$E(RAMOD,1,80)_","
"RTN","RAORDU",69,0)
 .S ORTX(3)="Urgency: "_$S($P(RAORD0,"^",6)=1:"STAT",$P(RAORD0,"^",6)=2:"URGENT",1:"ROUTINE")_","
"RTN","RAORDU",70,0)
 .I $P(RAORD0,"^",19)]"" S X=$P(RAORD0,"^",19),ORTX(3)=ORTX(3)_" Transport: "_$S(X="a":"AMBULATORY",X="p":"PORTABLE",X="s":"STRETCHER",1:"WHEELCHAIR")_","
"RTN","RAORDU",71,0)
 .I $D(RASEX),RASEX'="M" S ORTX(3)=ORTX(3)_" Pregnant: "_$S(RAPRGST="n":"NO",RAPRGST="y":"YES",RAPRGST="u":"UNKNOWN",1:"")
"RTN","RAORDU",72,0)
 S ORIT=$P(RAORD0,"^",2)_";RAMIS(71,"
"RTN","RAORDU",73,0)
 S DIC="^RA(79.2,",DIC(0)="N",X=+$P(^RAMIS(71,+$P(RAORD0,"^",2),0),"^",12) D ^DIC K DIC,RABLNK,RAMOD,RAPRCD S ORPURG=$S(Y<0:30,$D(^RA(79.2,+Y,.1)):+$P(^(.1),"^",6),1:30)
"RTN","RAORDU",74,0)
 S ORVP=RADFN_";DPT(",ORL=RALIFN_";SC(",ORNP=RAPIFN S ORPCL=$O(^ORD(101,"B","RA OERR EXAM",0))_";ORD(101,",ORPK=RAOIFN,ORSTS=$P(RAORD0,"^",5),ORSTRT=$P(RAORD0,"^",21) D FILE^ORX
"RTN","RAORDU",75,0)
 I $D(ORIFN),ORIFN]"" S DA=RAOIFN,DIE="^RAO(75.1,",DR="7////^S X="_ORIFN D ^DIE K DE,DQ,DIE,DR
"RTN","RAORDU",76,0)
 Q
"RTN","RAORDU",77,0)
OERR ;Set ^XUTL("OR",$J,"RA",IFN of oerr,IFN of Rad/Nuc Med order)
"RTN","RAORDU",78,0)
 I $D(ORIFN),ORIFN,$D(RAOIFN),RAOIFN S ^XUTL("OR",$J,"RA",ORIFN,RAOIFN)=RADIV
"RTN","RAORDU",79,0)
 K RADR1 Q
"RTN","RAORDU",80,0)
DELETE W:'$D(ZTQUEUED) !,"Since this order has not been released will delete instead of cancel...",!
"RTN","RAORDU",81,0)
 Q
"RTN","RAORDU",82,0)
 ;
"RTN","RAORDU",83,0)
ORVR() ;returns version number of OE/RR
"RTN","RAORDU",84,0)
 ;returns 0 if OE/RR is not installed
"RTN","RAORDU",85,0)
 ;
"RTN","RAORDU",86,0)
 ;Q 3.0 ;for testing purposes
"RTN","RAORDU",87,0)
 Q $S('$D(^ORD(100.99,0)):0,'$D(^DD(100,0,"VR")):0,1:^("VR"))
"RTN","RAORDU",88,0)
 ;
"RTN","RAORDU",89,0)
ORQUIK() ;returns 1 if CPRS Order Dialogue file 101.41 exists
"RTN","RAORDU",90,0)
 ;this means the quick order conversion to file 101.41 has been
"RTN","RAORDU",91,0)
 ;done and users should no longer be allowed to edit quick order
"RTN","RAORDU",92,0)
 ;parameters in the Common Procedure file 71.3.  The quick order
"RTN","RAORDU",93,0)
 ;conversion can be done prior to installing 3.0
"RTN","RAORDU",94,0)
 Q $S('$D(^ORD(101.41,0)):0,1:1)
"RTN","RAORDU",95,0)
 ;
"RTN","RAORDU",96,0)
SITE() ; Determine the value of RADIV
"RTN","RAORDU",97,0)
 ; +$P(RA1,"^",22)=Requesting Location
"RTN","RAORDU",98,0)
 ; +$P(RA2,"^",15)=Division (pntr to 40.8)
"RTN","RAORDU",99,0)
 Q:$D(RADIV)#2 RADIV
"RTN","RAORDU",100,0)
 N RA1,RA2,RADIVSON
"RTN","RAORDU",101,0)
 S RA1=$G(^RAO(75.1,RAOIFN,0))
"RTN","RAORDU",102,0)
 S RA2=$G(^SC(+$P(RA1,"^",22),0))
"RTN","RAORDU",103,0)
 S RADIVSON=+$$SITE^VASITE(DT,+$P(RA2,"^",15))
"RTN","RAORDU",104,0)
 Q $S(RADIVSON<0:0,1:RADIVSON)
"VER")
8.0^22.0
"^DD",75.2,75.2,5,0)
NATIONAL^S^Y:YES;^0;5^Q
"^DD",75.2,75.2,5,3)
Select 'YES' to prevent local modifications to this reason.
"^DD",75.2,75.2,5,21,0)
^.001^2^2^3161209^^
"^DD",75.2,75.2,5,21,1,0)
Flag to indicate a standardized entry provided by national. If this flag
"^DD",75.2,75.2,5,21,2,0)
is set, the entry cannot be modified.
"^DD",75.2,75.2,5,"DT")
3161209
"BLD",9880,6)
^117
**END**
**END**

