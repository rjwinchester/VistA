Released RA*5*158 SEQ #142
Extracted from mail message
**KIDS**:RA*5.0*158^

**INSTALL NAME**
RA*5.0*158
"BLD",10795,0)
RA*5.0*158^RADIOLOGY/NUCLEAR MEDICINE^0^3190718^y
"BLD",10795,1,0)
^^3^3^3190418^
"BLD",10795,1,1,0)
Patch one hundred and fifty-eight for the VistA Radiology/Nuclear
"BLD",10795,1,2,0)
Medicine 5.0 application. Please review FORUM's Patch Module description
"BLD",10795,1,3,0)
and installation instructions for RA*5.0*158 before installing this patch.
"BLD",10795,4,0)
^9.64PA^71.3^1
"BLD",10795,4,71.3,0)
71.3
"BLD",10795,4,71.3,2,0)
^9.641^71.3^1
"BLD",10795,4,71.3,2,71.3,0)
RAD/NUC MED COMMON PROCEDURE  (File-top level)
"BLD",10795,4,71.3,2,71.3,1,0)
^9.6411^.01^1
"BLD",10795,4,71.3,2,71.3,1,.01,0)
PROCEDURE
"BLD",10795,4,71.3,222)
y^n^p^^^^n^^n
"BLD",10795,4,71.3,224)

"BLD",10795,4,"APDD",71.3,71.3)

"BLD",10795,4,"APDD",71.3,71.3,.01)

"BLD",10795,4,"B",71.3,71.3)

"BLD",10795,6.3)
2
"BLD",10795,"INIT")
RAIPS158
"BLD",10795,"KRN",0)
^9.67PA^1.5^24
"BLD",10795,"KRN",.4,0)
.4
"BLD",10795,"KRN",.401,0)
.401
"BLD",10795,"KRN",.402,0)
.402
"BLD",10795,"KRN",.403,0)
.403
"BLD",10795,"KRN",.5,0)
.5
"BLD",10795,"KRN",.84,0)
.84
"BLD",10795,"KRN",1.5,0)
1.5
"BLD",10795,"KRN",1.6,0)
1.6
"BLD",10795,"KRN",1.61,0)
1.61
"BLD",10795,"KRN",1.62,0)
1.62
"BLD",10795,"KRN",3.6,0)
3.6
"BLD",10795,"KRN",3.8,0)
3.8
"BLD",10795,"KRN",9.2,0)
9.2
"BLD",10795,"KRN",9.8,0)
9.8
"BLD",10795,"KRN",9.8,"NM",0)
^9.68A^8^8
"BLD",10795,"KRN",9.8,"NM",1,0)
RADD2^^0^B32807085
"BLD",10795,"KRN",9.8,"NM",2,0)
RAUTL17^^0^B18028998
"BLD",10795,"KRN",9.8,"NM",3,0)
RAO7MFN^^0^B53390914
"BLD",10795,"KRN",9.8,"NM",4,0)
RAMAIN2^^0^B65131513
"BLD",10795,"KRN",9.8,"NM",5,0)
RAO7RO1^^0^B8486631
"BLD",10795,"KRN",9.8,"NM",6,0)
RAO7RON1^^0^B31114736
"BLD",10795,"KRN",9.8,"NM",7,0)
RAIPS158^^0^B22138051
"BLD",10795,"KRN",9.8,"NM",8,0)
RAHLR1^^0^B28687576
"BLD",10795,"KRN",9.8,"NM","B","RADD2",1)

"BLD",10795,"KRN",9.8,"NM","B","RAHLR1",8)

"BLD",10795,"KRN",9.8,"NM","B","RAIPS158",7)

"BLD",10795,"KRN",9.8,"NM","B","RAMAIN2",4)

"BLD",10795,"KRN",9.8,"NM","B","RAO7MFN",3)

"BLD",10795,"KRN",9.8,"NM","B","RAO7RO1",5)

"BLD",10795,"KRN",9.8,"NM","B","RAO7RON1",6)

"BLD",10795,"KRN",9.8,"NM","B","RAUTL17",2)

"BLD",10795,"KRN",19,0)
19
"BLD",10795,"KRN",19,"NM",0)
^9.68A^1^1
"BLD",10795,"KRN",19,"NM",1,0)
RA REASON EDIT^^1^
"BLD",10795,"KRN",19,"NM","B","RA REASON EDIT",1)

"BLD",10795,"KRN",19.1,0)
19.1
"BLD",10795,"KRN",101,0)
101
"BLD",10795,"KRN",409.61,0)
409.61
"BLD",10795,"KRN",771,0)
771
"BLD",10795,"KRN",779.2,0)
779.2
"BLD",10795,"KRN",870,0)
870
"BLD",10795,"KRN",8989.51,0)
8989.51
"BLD",10795,"KRN",8989.52,0)
8989.52
"BLD",10795,"KRN",8994,0)
8994
"BLD",10795,"KRN","B",.4,.4)

"BLD",10795,"KRN","B",.401,.401)

"BLD",10795,"KRN","B",.402,.402)

"BLD",10795,"KRN","B",.403,.403)

"BLD",10795,"KRN","B",.5,.5)

"BLD",10795,"KRN","B",.84,.84)

"BLD",10795,"KRN","B",1.5,1.5)

"BLD",10795,"KRN","B",1.6,1.6)

"BLD",10795,"KRN","B",1.61,1.61)

"BLD",10795,"KRN","B",1.62,1.62)

"BLD",10795,"KRN","B",3.6,3.6)

"BLD",10795,"KRN","B",3.8,3.8)

"BLD",10795,"KRN","B",9.2,9.2)

"BLD",10795,"KRN","B",9.8,9.8)

"BLD",10795,"KRN","B",19,19)

"BLD",10795,"KRN","B",19.1,19.1)

"BLD",10795,"KRN","B",101,101)

"BLD",10795,"KRN","B",409.61,409.61)

"BLD",10795,"KRN","B",771,771)

"BLD",10795,"KRN","B",779.2,779.2)

"BLD",10795,"KRN","B",870,870)

"BLD",10795,"KRN","B",8989.51,8989.51)

"BLD",10795,"KRN","B",8989.52,8989.52)

"BLD",10795,"KRN","B",8994,8994)

"BLD",10795,"QDEF")
^^^^^^^^^^YES
"BLD",10795,"QUES",0)
^9.62^^
"BLD",10795,"REQB",0)
^9.611^5^4
"BLD",10795,"REQB",2,0)
RA*5.0*86^2
"BLD",10795,"REQB",3,0)
RA*5.0*124^2
"BLD",10795,"REQB",4,0)
RA*5.0*129^2
"BLD",10795,"REQB",5,0)
RA*5.0*138^2
"BLD",10795,"REQB","B","RA*5.0*124",3)

"BLD",10795,"REQB","B","RA*5.0*129",4)

"BLD",10795,"REQB","B","RA*5.0*138",5)

"BLD",10795,"REQB","B","RA*5.0*86",2)

"FIA",71.3)
RAD/NUC MED COMMON PROCEDURE
"FIA",71.3,0)
^RAMIS(71.3,
"FIA",71.3,0,0)
71.3P
"FIA",71.3,0,1)
y^n^p^^^^n^^n
"FIA",71.3,0,10)

"FIA",71.3,0,11)

"FIA",71.3,0,"RLRO")

"FIA",71.3,0,"VR")
5.0^RA
"FIA",71.3,71.3)
1
"FIA",71.3,71.3,.01)

"INIT")
RAIPS158
"KRN",19,14166,-1)
1^1
"KRN",19,14166,0)
RA REASON EDIT
"MBREQ")
0
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"PKG",18,-1)
1^1
"PKG",18,0)
RADIOLOGY/NUCLEAR MEDICINE^RA^REGISTERS PATIENTS,RECORDS EXAMS,PROFILES,AMIS REPORTS
"PKG",18,22,0)
^9.49I^1^1
"PKG",18,22,1,0)
5.0^3051109^2980407^50
"PKG",18,22,1,"PAH",1,0)
158^3190718
"PKG",18,22,1,"PAH",1,1,0)
^^3^3^3190718
"PKG",18,22,1,"PAH",1,1,1,0)
Patch one hundred and fifty-eight for the VistA Radiology/Nuclear
"PKG",18,22,1,"PAH",1,1,2,0)
Medicine 5.0 application. Please review FORUM's Patch Module description
"PKG",18,22,1,"PAH",1,1,3,0)
and installation instructions for RA*5.0*158 before installing this patch.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
8
"RTN","RADD2")
0^1^B32807085^B26464377
"RTN","RADD2",1,0)
RADD2 ;HISC/GJC/CAH-Radiology Data Dictionary Utility Routine ;30 May 2019 8:39 AM
"RTN","RADD2",2,0)
 ;;5.0;Radiology/Nuclear Medicine;**84,47,124,158**;Mar 16, 1998;Build 2
"RTN","RADD2",3,0)
 ;
"RTN","RADD2",4,0)
 ;Integration Agreements
"RTN","RADD2",5,0)
 ;----------------------
"RTN","RADD2",6,0)
 ;EN^DDIOL(10142); FILE^DIE(2053);NOTE^ORX3(868);MES^XPDUTL(10141)
"RTN","RADD2",7,0)
 ;
"RTN","RADD2",8,0)
EN1(RA71) ; Input transform for the .01 field (Procedure) for the Rad/Nuc
"RTN","RADD2",9,0)
 ; Med Common Procedure file i.e, ^RAMIS(71.3 (reworked for RA*5.0*158)
"RTN","RADD2",10,0)
 ; Procedure must not have an inactive date before today in file 71
"RTN","RADD2",11,0)
 ; Procedure in file 71 must have same imaging type as the one
"RTN","RADD2",12,0)
 ;   selected before editing this record in file 71.3
"RTN","RADD2",13,0)
 ;
"RTN","RADD2",14,0)
 ; A PARENT type procedure must have at least one descendent
"RTN","RADD2",15,0)
 ; Output:
"RTN","RADD2",16,0)
 ; -If at least one descendant return one
"RTN","RADD2",17,0)
 ; -else return 0
"RTN","RADD2",18,0)
 ;
"RTN","RADD2",19,0)
 ; Input:
"RTN","RADD2",20,0)
 ; RA71 = IENS of entries in ^RAMIS(71,
"RTN","RADD2",21,0)
 ; RAIMGTYI = IEN of an IMAGING TYPE record (global scope)
"RTN","RADD2",22,0)
 ;
"RTN","RADD2",23,0)
 Q:'$G(RAIMGTYI) 0
"RTN","RADD2",24,0)
 ;
"RTN","RADD2",25,0)
 S RA71("I")=$G(^RAMIS(71,+RA71,"I")),RA71(0)=$G(^RAMIS(71,+RA71,0))
"RTN","RADD2",26,0)
 ;parent procedure?
"RTN","RADD2",27,0)
 S RAPARENT=$S($P(RA71(0),"^",6)="P":1,1:0)
"RTN","RADD2",28,0)
 ;does the parent have a descendant?
"RTN","RADD2",29,0)
 S:RAPARENT RAPFLG=+$O(^RAMIS(71,+RA71,4,0))
"RTN","RADD2",30,0)
 ;
"RTN","RADD2",31,0)
 ;if no "I" node or "I" node null ok, if DT is before today ok, else not ok
"RTN","RADD2",32,0)
 S RA71ACTIVE=$S(RA71("I")="":1,DT<RA71("I"):1,1:0)
"RTN","RADD2",33,0)
 Q:RA71ACTIVE=0 0
"RTN","RADD2",34,0)
 ;
"RTN","RADD2",35,0)
 ;match i-type?
"RTN","RADD2",36,0)
 S RA71ITYPE=$S(RAIMGTYI=$P($G(RA71(0)),"^",12):1,1:0)
"RTN","RADD2",37,0)
 Q:RA71ITYPE=0 0
"RTN","RADD2",38,0)
 ;
"RTN","RADD2",39,0)
 ;if active, w/i-type match & non-parent quit 1
"RTN","RADD2",40,0)
 Q:RAPARENT=0 1
"RTN","RADD2",41,0)
 ;
"RTN","RADD2",42,0)
 ;if active, w/i-type match & parent w/descendant quit 1
"RTN","RADD2",43,0)
 Q:RAPARENT&RAPFLG 1
"RTN","RADD2",44,0)
 ;
"RTN","RADD2",45,0)
 K RA71ACTIVE,RA71ITYPE,RAPARENT,RAPFLG
"RTN","RADD2",46,0)
 Q 0
"RTN","RADD2",47,0)
 ;
"RTN","RADD2",48,0)
CH(RAY,RAX) ; This subroutine will fire off the 'Radiology Request Cancel
"RTN","RADD2",49,0)
 ; /Hold' notification as defined in the 'OE/RR NOTIFICATIONS' file.
"RTN","RADD2",50,0)
 ; Only if request is either cancelled or held.  Called from the set
"RTN","RADD2",51,0)
 ; logic of the 'ACHN' xref in ^DD(75.1,5) field definition.
"RTN","RADD2",52,0)
 ;
"RTN","RADD2",53,0)
 ; Input variables:
"RTN","RADD2",54,0)
 ; 'RAX'=Request status of the order, $S(X=1:'discontinued',X=3:'hold')
"RTN","RADD2",55,0)
 ; 'RAY'=ien of the order in the RAD/NUC MED ORDERS file.
"RTN","RADD2",56,0)
 ;
"RTN","RADD2",57,0)
 Q:(RAY'=+RAY)  Q:(RAX'=1)&(RAX'=3)
"RTN","RADD2",58,0)
 N %,C,D,D0,DA,DC,DDER,DE,DG,DH,DI,DIC,DIE,DIEDA,DIEL,DIFLD,DIP,DIW,DIWT
"RTN","RADD2",59,0)
 N DK,DL,DM,DN,DP,DQ,DR,DU,DV,DW,I,J,N,ORBPMSG,ORBXDATA,ORIFN,ORNOTE,ORVP
"RTN","RADD2",60,0)
 N RA751,RADFN,RANME,RAOIFN,RAOLP,RAOPTN,RAORDS,RAOREA,RAOSTS,RAPARENT
"RTN","RADD2",61,0)
 N RAPRC,RAXIT,X,Y
"RTN","RADD2",62,0)
 S RA751=$G(^RAO(75.1,RAY,0)) Q:RA751']""
"RTN","RADD2",63,0)
 S RAOIFN=RAY,RADFN=+$P(RA751,"^")
"RTN","RADD2",64,0)
 S RAPRC=$P($G(^RAMIS(71,+$P(RA751,"^",2),0)),"^"),ORVP=RADFN_";DPT("
"RTN","RADD2",65,0)
 S ORBPMSG=$S(RAX=1:"Discontinued - ",1:"On hold - ")_$E(RAPRC,1,17)
"RTN","RADD2",66,0)
 S ORBXDATA=RAOIFN_","_RADFN,ORIFN=+$P(RA751,"^",7),ORNOTE(26)=1
"RTN","RADD2",67,0)
 D NOTE^ORX3
"RTN","RADD2",68,0)
 Q
"RTN","RADD2",69,0)
INACOM(RAD0) ; Check inactive date on the Rad/Nuc Med Procedure file (71)
"RTN","RADD2",70,0)
 ; for the Common Procedure before setting our inactive procedure to
"RTN","RADD2",71,0)
 ; active.  Called from the 'RA COMMON PROCEDURE EDIT' input template.
"RTN","RADD2",72,0)
 ; Option: Common Procedure Enter/Edit (13^RAMAIN2)
"RTN","RADD2",73,0)
 ; Input : RAD0-ien of Rad/Nuc Med Common Procedure
"RTN","RADD2",74,0)
 ; Output: if Common cannot be re-activated, reset the 'Inactive' field
"RTN","RADD2",75,0)
 ;         to 'yes'.
"RTN","RADD2",76,0)
 N RAINA S RAINA=$P($G(^RAMIS(71,+$P($G(^RAMIS(71.3,RAD0,0)),"^"),"I")),"^")
"RTN","RADD2",77,0)
 Q:RAINA=""!(RAINA>DT) "@15" ; we can inactivate the common
"RTN","RADD2",78,0)
 N RAFDA,RAMSG
"RTN","RADD2",79,0)
 S RAFDA(71.3,RAD0_",",4)="Y" D FILE^DIE("","RAFDA","") S RAMSG(1)=$C(7)
"RTN","RADD2",80,0)
 S RAMSG(2)="You cannot add this procedure to the common procedure list"
"RTN","RADD2",81,0)
 S RAMSG(3)="because it is inactivated in the Rad/Nuc Med Procedures file."
"RTN","RADD2",82,0)
 S RAMSG(4)="You must first re-activate the procedure through the 'Procedure"
"RTN","RADD2",83,0)
 S RAMSG(5)="Enter/Edit' option.",RAMSG(6)="" D MES^XPDUTL(.RAMSG)
"RTN","RADD2",84,0)
 Q "@10" ; reset 'Inactive' to 'yes', re-edit field.
"RTN","RADD2",85,0)
 ;
"RTN","RADD2",86,0)
EN2() ; called from ^DD(74,0,"ID","WRITE")
"RTN","RADD2",87,0)
 ; display long case #'s in the same print set as current record
"RTN","RADD2",88,0)
 N RA1,RA2
"RTN","RADD2",89,0)
 S RA1=0,RA2=""
"RTN","RADD2",90,0)
 ; F  S RA1=$O(^RARPT(Y,1,"B",RA1)) Q:'RA1  S RA2=RA2_$S(RA2="":"-",1:",-")_$P(RA1,"-",2)
"RTN","RADD2",91,0)
 F  S RA1=$O(^RARPT(Y,1,"B",RA1)) Q:'RA1  S RA2=RA2_$S(RA2="":"-",1:",-")_$P(RA1,"-",$L(RA1,"-"))  ;P47 to accommodate possible SSAN format
"RTN","RADD2",92,0)
 Q RA2
"RTN","RADD2",93,0)
USUAL(RADA,RAX) ; To insure that the USUAL DOSE value falls between the
"RTN","RADD2",94,0)
 ; HIGH ADULT DOSE and the LOW ADULT DOSE.
"RTN","RADD2",95,0)
 ; Input Variables:
"RTN","RADD2",96,0)
 ;     RADA -> top level/sub-file level IEN's
"RTN","RADD2",97,0)
 ;      RAX -> value input by the user
"RTN","RADD2",98,0)
 ; Output Variable: $S(1: value is accepted, 0: value not accepted)
"RTN","RADD2",99,0)
 ;
"RTN","RADD2",100,0)
 Q:RAX="" 0 ; X does not exist
"RTN","RADD2",101,0)
 N RA7108,RAH,RAL S RA7108=$G(^RAMIS(71,RADA(1),"NUC",RADA,0))
"RTN","RADD2",102,0)
 S RAH=$P(RA7108,"^",5),RAL=$P(RA7108,"^",6)
"RTN","RADD2",103,0)
 S RAH=$S(RAH="":99999.9999,1:RAH),RAL=$S(RAL="":.0001,1:RAL)
"RTN","RADD2",104,0)
 I (+RAX<RAL)!(+RAX>RAH) D  Q 0 ; value is not accepted
"RTN","RADD2",105,0)
 . N RARRY S RARRY(1)="The 'USUAL DOSE' must fall within the range of: "
"RTN","RADD2",106,0)
 . S RARRY(1)=RARRY(1)_RAL_" - "_RAH_" "
"RTN","RADD2",107,0)
 . D EN^DDIOL(.RARRY)
"RTN","RADD2",108,0)
 . Q
"RTN","RADD2",109,0)
 E  Q 1 ; value accepted
"RTN","RADD2",110,0)
 ;
"RTN","RADD2",111,0)
RANGE(RADA) ; Determine the range in which the 'USUAL DOSE' must fall
"RTN","RADD2",112,0)
 ; Input Variables:
"RTN","RADD2",113,0)
 ;     RADA  -> top level/sub-file level IEN's
"RTN","RADD2",114,0)
 ; Output Variable:
"RTN","RADD2",115,0)
 ;     RANGE -> the range in which the 'USUAL DOSE' must fall
"RTN","RADD2",116,0)
 N RA7108,RAH,RAL
"RTN","RADD2",117,0)
 S RA7108=$G(^RAMIS(71,RADA(1),"NUC",RADA,0))
"RTN","RADD2",118,0)
 S RAH=$P(RA7108,"^",5),RAL=$P(RA7108,"^",6)
"RTN","RADD2",119,0)
 S RAH=$S(RAH="":99999.9999,1:RAH),RAL=$S(RAL="":.0001,1:RAL)
"RTN","RADD2",120,0)
 Q RAL_"-"_RAH
"RTN","RADD2",121,0)
MEDOSE(RAY,RADT) ; Determine if this individual (RAY) is authorized to
"RTN","RADD2",122,0)
 ; administer medications.  Called from ^DD(70.15,4,12.1)
"RTN","RADD2",123,0)
 ; Input : RAY (pnt to 200) - the individual being checked at the moment 
"RTN","RADD2",124,0)
 ;         RADT - Date of the examination
"RTN","RADD2",125,0)
 ; Output: '1' - user is authorized to administer medications, else '0'
"RTN","RADD2",126,0)
 ;
"RTN","RADD2",127,0)
 Q:$D(^VA(200,"ARC","R",RAY)) 1 ; Rad/Nuc Med Class: Resident
"RTN","RADD2",128,0)
 Q:$D(^VA(200,"ARC","S",RAY)) 1 ; Rad/Nuc Med Class: Staff
"RTN","RADD2",129,0)
 Q:$D(^VA(200,"ARC","T",RAY)) 1 ; Rad/Nuc Med Class: Technologist
"RTN","RADD2",130,0)
 Q:$D(^XUSEC("ORES",RAY)) 1 Q:$D(^XUSEC("ORELSE",RAY)) 1
"RTN","RADD2",131,0)
 N RAUTH S RAUTH=$G(^VA(200,RAY,"PS"))
"RTN","RADD2",132,0)
 ; If authorized to write med orders ($P(RAUTH,"^")=1) and inactivation
"RTN","RADD2",133,0)
 ; date null -OR- inactivation date greater than or equal to the exam
"RTN","RADD2",134,0)
 ; date individual is authorized.
"RTN","RADD2",135,0)
 Q:+$P(RAUTH,"^")&($S('$P(RAUTH,"^",4):1,$P(RAUTH,"^",4)'<RADT:1,1:0)) 1
"RTN","RADD2",136,0)
 Q 0
"RTN","RADD2",137,0)
 ;
"RTN","RADD2",138,0)
PRIDXIXK(DA,X) ;This subroutine executes the KILL logic for the 'new style' AD cross-
"RTN","RADD2",139,0)
 ;reference on the 'PRIMARY DIAGNOSTIC CODE' (data dictionary: 70.03; field: 13)
"RTN","RADD2",140,0)
 ;Input: DA - an array where DA(2)=RADFN, DA(1)=RADTI, & DA=RACNI
"RTN","RADD2",141,0)
 ;        X - the primary diagnostic code value (this field points to file 78.3)
"RTN","RADD2",142,0)
 N RACNI,RADFN,RADTI,RAFDA,RAIENS,RAX
"RTN","RADD2",143,0)
 S RADFN=DA(2),RADTI=DA(1),RACNI=DA,RAX=X ;save the variables just in case
"RTN","RADD2",144,0)
 S RAIENS=DA_","_DA(1)_","_DA(2)_",",RAFDA(70.03,RAIENS,20)="@"
"RTN","RADD2",145,0)
 D FILE^DIE(,"RAFDA") ;delete data in 'DIAGNOSTIC PRINT DATE' (DD: 70.03; field: 20)
"RTN","RADD2",146,0)
 K ^RADPT("AD",RAX,RADFN,RADTI,RACNI)
"RTN","RADD2",147,0)
 Q
"RTN","RADD2",148,0)
 ;
"RTN","RADD2",149,0)
AEASSET(RAX,RADA,RAXREF) ;determine is the examination status of the
"RTN","RADD2",150,0)
 ;study is either CANCELED or COMPLETE. This routine will set the "AS"
"RTN","RADD2",151,0)
 ; or "AE" xref SET logic (new style). 
"RTN","RADD2",152,0)
 ;
"RTN","RADD2",153,0)
 ; Note: The first numeric subscript of the "AE" xref is the
"RTN","RADD2",154,0)
 ;       CASE NUMBER (70.03;.01). Since the .01 field cannot
"RTN","RADD2",155,0)
 ;       be changed because of business rules, the "AE" xref
"RTN","RADD2",156,0)
 ;       does not have set/kill logic in the CASE NUMBER field.
"RTN","RADD2",157,0)
 ;
"RTN","RADD2",158,0)
 ;       The first numeric subscript of the "AS" xref is the
"RTN","RADD2",159,0)
 ;       EXAMINATION STATUS IEN (70.03;3). 
"RTN","RADD2",160,0)
 ;
"RTN","RADD2",161,0)
 ;
"RTN","RADD2",162,0)
 ;input: RAX = value of 'X' passed into from ^DD(70.03,3,0)
"RTN","RADD2",163,0)
 ;             'X' is the IEN of a record in the EXAMINATION
"RTN","RADD2",164,0)
 ;             STATUS (#72) file.
"RTN","RADD2",165,0)
 ;      RADA = the DA array: DA(2) think RADFN, DA(1) think
"RTN","RADD2",166,0)
 ;             RADTI & DA think RACNI.
"RTN","RADD2",167,0)
 ;    RAXREF = one of two values: "AS" or "AE"
"RTN","RADD2",168,0)
 ;
"RTN","RADD2",169,0)
 ;
"RTN","RADD2",170,0)
 ;ORDER value for CANCELED is zero (0), ORDER value for CANCELED is nine (9)
"RTN","RADD2",171,0)
 ;ORDER values 0, 1 & 9 are RESERVED. RAIMGTY is set in the input transform
"RTN","RADD2",172,0)
 N RAIMGTY,RAY2,RAY3,RAY S RAY=$P($G(^RA(72,RAX,0)),U,3) ;ORDER value
"RTN","RADD2",173,0)
 Q:RAY=""  S RAY2=$G(^RADPT(RADA(2),"DT",RADA(1),0))
"RTN","RADD2",174,0)
 S RAY3=$G(^RADPT(RADA(2),"DT",RADA(1),"P",RADA,0)) ;70.03
"RTN","RADD2",175,0)
 S RAIMGTY=$P($G(^RA(79.2,+$P(RAY2,U,2),0)),U) Q:RAIMGTY=""
"RTN","RADD2",176,0)
 ;^RA(72,"AA","GENERAL RADIOLOGY",1,1)="" 4th subscript is ORDER,
"RTN","RADD2",177,0)
 ;the 5th is IEN of file 72
"RTN","RADD2",178,0)
 Q:'$D(^RA(72,"AA",RAIMGTY,RAY,RAX))#2  ;the "AA" must be preserved
"RTN","RADD2",179,0)
 Q:RAY=0!(RAY=9)  ;the study is canceled or complete or broken
"RTN","RADD2",180,0)
 S:RAXREF="AE"&($P(RAY3,U)>0) ^RADPT("AE",$E(+RAY3,1,30),RADA(2),RADA(1),RADA)=""
"RTN","RADD2",181,0)
 S:RAXREF="AS" ^RADPT("AS",$E(RAX,1,30),RADA(2),RADA(1),RADA)=""
"RTN","RADD2",182,0)
 Q
"RTN","RADD2",183,0)
 ;
"RTN","RADD2",184,0)
AEKILL(RADA) ;execute the KILL logic for the "AE" xref on the
"RTN","RADD2",185,0)
 ;EXAM STATUS field (70.03;3)
"RTN","RADD2",186,0)
 ;input: RADA = the DA array: DA(2) think RADFN, DA(1) think
"RTN","RADD2",187,0)
 ;              & DA think RACNI.
"RTN","RADD2",188,0)
 N RAY3 S RAY3=$G(^RADPT(RADA(2),"DT",RADA(1),"P",RADA,0)) ;70.03
"RTN","RADD2",189,0)
 K ^RADPT("AE",$E(+RAY3,1,30),RADA(2),RADA(1),RADA)
"RTN","RADD2",190,0)
 Q
"RTN","RADD2",191,0)
 ;
"RTN","RAHLR1")
0^8^B28687576^B26243078
"RTN","RAHLR1",1,0)
RAHLR1 ;HISC/GJC - Generate Common Order (ORM) Message ;18 Jul 2019 9:17 AM
"RTN","RAHLR1",2,0)
 ;;5.0;Radiology/Nuclear Medicine;**47,125,129,158**;Mar 16, 1998;Build 2
"RTN","RAHLR1",3,0)
 ;Generates msg whenever a case is registered or cancelled or examined
"RTN","RAHLR1",4,0)
 ;              registered   cancelled   examined   complete
"RTN","RAHLR1",5,0)
 ; Order control : NW            CA         XO         XO
"RTN","RAHLR1",6,0)
 ; Order status  : IP            CA         IP         CM
"RTN","RAHLR1",7,0)
 ;
"RTN","RAHLR1",8,0)
 ;Integration Agreements
"RTN","RAHLR1",9,0)
 ;----------------------
"RTN","RAHLR1",10,0)
 ;$$GET1^DIQ(10060); NPFON^MAG7UFO(5021); $$FMTHL7^XLFDT(10103)
"RTN","RAHLR1",11,0)
 ;$$HLNAME^XLFNAME(3065); $$NS^XUAF4(2171); $$KSP^XUPARAM(2541)
"RTN","RAHLR1",12,0)
 ;
"RTN","RAHLR1",13,0)
 ;IA: 767 global read on ^DGSL(38.1,D0,0)
"RTN","RAHLR1",14,0)
 ;IA: 10039 global read on ^DIC(42,D0,44)
"RTN","RAHLR1",15,0)
 ;IA: 10040 global read on ^SC(D0
"RTN","RAHLR1",16,0)
 ;
"RTN","RAHLR1",17,0)
EN(RADFN,RADTI,RACNI,RAEID) ;Called from RA REG*, RA EXAMINED*, & RA CANCEL*
"RTN","RAHLR1",18,0)
 ;event driver protocols whose HL7 version exceeds version 2.3.
"RTN","RAHLR1",19,0)
 ;
"RTN","RAHLR1",20,0)
 ; Input Variables (from RAHLR):
"RTN","RAHLR1",21,0)
 ;  RADFN=file 2 IEN (DFN)
"RTN","RAHLR1",22,0)
 ;  RADTI=file 70 Exam subrec IEN (inverse date/time of exam)
"RTN","RAHLR1",23,0)
 ;  RACNI=file 70 Case subrecord IEN
"RTN","RAHLR1",24,0)
 ;  RAEID=ien of the event driver protocol (defined in RAHLRPC)
"RTN","RAHLR1",25,0)
 ;  RACN0=^RADPT(RADFN,"DT",RADTI,"P",RACNI,0)
"RTN","RAHLR1",26,0)
 ; Output variables:
"RTN","RAHLR1",27,0)
 ;  HLA("HLS", array containing HL7 msg
"RTN","RAHLR1",28,0)
 ;
"RTN","RAHLR1",29,0)
 N RAPID,RAPV1,RAORC,RAOBR,RAOBX,RAX,X,XX,I,I1,I2,I3,II
"RTN","RAHLR1",30,0)
 ;initialize Rad/Nuc Med specific variables
"RTN","RAHLR1",31,0)
 D:'$D(HLFS)!'$D(HL) INIT^RAHLRU
"RTN","RAHLR1",32,0)
 D INIT
"RTN","RAHLR1",33,0)
 ;RA*5*82 RAEXEDT= Override the EXM conditions if Case edited
"RTN","RAHLR1",34,0)
 I '$G(RAEXEDT),$G(RAEXMDUN)=1,$P(RAZXAM,U,30)'="" Q  ;last chance to stop exm'd msg if it's already been sent
"RTN","RAHLR1",35,0)
 ;
"RTN","RAHLR1",36,0)
PID ;compile the PID segment
"RTN","RAHLR1",37,0)
 D PID^RAHLRU1(+RADFN)
"RTN","RAHLR1",38,0)
 ;
"RTN","RAHLR1",39,0)
PV1 ;compile the PV1 segment determine if the patient is
"RTN","RAHLR1",40,0)
 ;an inpatient or outpatient by looking at the exam record
"RTN","RAHLR1",41,0)
 D PV1^RAHLRU1(+RADFN)
"RTN","RAHLR1",42,0)
 ;
"RTN","RAHLR1",43,0)
ORC ;build the 'common order segment (ORC) segment
"RTN","RAHLR1",44,0)
 ;RACANC is the status of the exam 'cancelled'? If ORDER (#3) field in
"RTN","RAHLR1",45,0)
 ;the EXAMINATION STATUS (#72) file is set to zero, the exam has been
"RTN","RAHLR1",46,0)
 ;cancelled. If order is set to nine, the exam is complete.
"RTN","RAHLR1",47,0)
 S RAXAMSTS=$P($G(^RA(72,+$P(RAZXAM,U,3),0)),U,3)
"RTN","RAHLR1",48,0)
 S RACANC=$S(RAXAMSTS=0:1,1:0),RACOMP=$S(RAXAMSTS=9:1,1:0)
"RTN","RAHLR1",49,0)
 S RAORC(2)=$S(RACANC:"CA",$G(RAEXMDUN)=1:"XO",1:"NW")
"RTN","RAHLR1",50,0)
 ; define ORC-2 & ORC-3 to 'site id-mmddyy-case#' ex: 141-041106-6
"RTN","RAHLR1",51,0)
 ; 9/2008 -- check Site Acc Number division parameter (79,.131) and only
"RTN","RAHLR1",52,0)
 ; use the long site specific acc num if set to YES, else use old form
"RTN","RAHLR1",53,0)
 ;
"RTN","RAHLR1",54,0)
 ;iff pset: build the following unique patient/study identifier
"RTN","RAHLR1",55,0)
 ;@Indy INC6620428
"RTN","RAHLR1",56,0)
 ;ORC(4)=141-76-6809282.8562
"RTN","RAHLR1",57,0)
 ;1st piece = 141 (station # 3 chars fixed)
"RTN","RAHLR1",58,0)
 ;2nd piece = 76 (patient DFN)
"RTN","RAHLR1",59,0)
 ;3rd piece = 6809282.8562 (inverse date/time of study)
"RTN","RAHLR1",60,0)
 I $P(RAZXAM,U,25)=2 D  ;DD - 70.03;25 (combined report)
"RTN","RAHLR1",61,0)
 .S RAORC(5)=$P(RAPID(3),HLCS)_"-"_RADTI
"RTN","RAHLR1",62,0)
 .Q
"RTN","RAHLR1",63,0)
 ;
"RTN","RAHLR1",64,0)
 S (RAORC(3),RAORC(4))=RAZDAYCS
"RTN","RAHLR1",65,0)
 S RAORC(6)=$S(RACANC:"CA",RACOMP:"CM",1:"IP")
"RTN","RAHLR1",66,0)
 ;
"RTN","RAHLR1",67,0)
 ;new logic in determining the value of order status (ORC-5)
"RTN","RAHLR1",68,0)
 ;discovered in the development and testing of p47 on 01/14/2010
"RTN","RAHLR1",69,0)
 ;Variables:
"RTN","RAHLR1",70,0)
 ;  RA101Z - defined in RAHLRPC
"RTN","RAHLR1",71,0)
 ;   RAOPT - array set/killed in the entry/exit actions in options:
"RTN","RAHLR1",72,0)
 ;- [RA HL7 MESSAGE RESEND]
"RTN","RAHLR1",73,0)
 ;- [RA HL7 RESEND BY DATE RANGE]
"RTN","RAHLR1",74,0)
 ;  these two options may impact the definition of ORC-5
"RTN","RAHLR1",75,0)
 I $E($O(RAOPT("")),1,6)="RESEND",($E($G(RA101Z),1,6)="RA REG") S RAORC(6)="IP"
"RTN","RAHLR1",76,0)
 ;Executing the RA REG* event driver(s) should send an order control (ORC-1)
"RTN","RAHLR1",77,0)
 ;value of 'NW' & an order status value of 'IP' when the aforementioned options
"RTN","RAHLR1",78,0)
 ;are exercised.
"RTN","RAHLR1",79,0)
 ;
"RTN","RAHLR1",80,0)
 ;Quantity/Timing ORC-7.4 SCHEDULED DATE (TIME optional) 75.1;23
"RTN","RAHLR1",81,0)
 ;Priority ORC-7.6 REQUEST URGENCY of order 75.1;6
"RTN","RAHLR1",82,0)
 S RAORC(8)=$$REPEAT^RAHLRU1($E(HLECH,1),3)_$$FMTHL7^XLFDT($P(RAZORD,U,23))_$$REPEAT^RAHLRU1($E(HLECH,1),2)_$S($P(RAZORD,U,6)=1:"S",$P(RAZORD,U,6)=2:"A",1:"R")
"RTN","RAHLR1",83,0)
 ;Parent ORC-8 MEMBER OF SET (70.03;25); PURGED DATE (70.03,40)
"RTN","RAHLR1",84,0)
 S RAORC(9)=$$PARENT(RAPURGE,$P(RAZXAM,U,25))
"RTN","RAHLR1",85,0)
 ;Note: ORC-8 & OBR-29 share the same value
"RTN","RAHLR1",86,0)
 ;
"RTN","RAHLR1",87,0)
 ;S RAORC(10)=$$FMTHL7^XLFDT($P(RAZORD,U,16)) ;transaction d/t (order)
"RTN","RAHLR1",88,0)
 S RAORC(10)=$$FMTHL7^XLFDT($P(RAZRXAM,U)) ;transaction d/t (exam d/t registered)
"RTN","RAHLR1",89,0)
 ;
"RTN","RAHLR1",90,0)
 ;Entered By ORC-10 (USER ENTERING REQUEST) 75.1;15
"RTN","RAHLR1",91,0)
 I $P(RAZORD,U,15),($$GET1^DIQ(200,$P(RAZORD,U,15),.01)'="") D
"RTN","RAHLR1",92,0)
 .S RAZNME("FILE")=200,RAZNME("IENS")=$P(RAZORD,U,15)
"RTN","RAHLR1",93,0)
 .S RAZNME("FIELD")=.01
"RTN","RAHLR1",94,0)
 .S RAORC(11)=$P(RAZORD,U,15)_$E(HLECH)_$$HLNAME^XLFNAME(.RAZNME,"S",$E($G(HLECH)))
"RTN","RAHLR1",95,0)
 .Q
"RTN","RAHLR1",96,0)
 ;Ordering Provider ORC-12 (REQUESTING PHYSICIAN) 75.1;14
"RTN","RAHLR1",97,0)
 I $P(RAZORD,U,14),($$GET1^DIQ(200,$P(RAZORD,U,14),.01)'="") D
"RTN","RAHLR1",98,0)
 .K RAZNME S RAZNME("FILE")=200,RAZNME("IENS")=$P(RAZORD,U,14)
"RTN","RAHLR1",99,0)
 .S RAZNME("FIELD")=.01
"RTN","RAHLR1",100,0)
 .S RAORC(13)=$P(RAZORD,U,14)_$E(HLECH)_$$HLNAME^XLFNAME(.RAZNME,"S",$E($G(HLECH)))
"RTN","RAHLR1",101,0)
 .Q
"RTN","RAHLR1",102,0)
 ;Enterer's Location ORC-13 (USER ENTERING REQUEST)
"RTN","RAHLR1",103,0)
 S RASERSEC=$$ESCAPE^RAHLRU($$GET1^DIQ(200,$P(RAZORD,U,15),29))
"RTN","RAHLR1",104,0)
 S RAORC(14)=RASERSEC ;SERVICE/SECTION
"RTN","RAHLR1",105,0)
 ;
"RTN","RAHLR1",106,0)
 ;Call Back Phone numbers of Ordering Provider ORC-14
"RTN","RAHLR1",107,0)
 D
"RTN","RAHLR1",108,0)
 .N RAX,I,M S M="",I=0
"RTN","RAHLR1",109,0)
 .D NPFON^MAG7UFO("RAX",$P(RAZORD,U,14))
"RTN","RAHLR1",110,0)
 .F  S I=$O(RAX(I)) Q:'I  S M=M_$$ESCAPE^RAHLRU($G(RAX(I,1,1)))_$E(HLECH)_$G(RAX(I,2,1))_$E(HLECH)_$G(RAX(I,3,1))_$E(HLECH,2)
"RTN","RAHLR1",111,0)
 .S:$L(M) RAORC(15)=$E(M,1,$L(M)-1)
"RTN","RAHLR1",112,0)
 ;
"RTN","RAHLR1",113,0)
 ;Enterer's Organization ORC-17 (USER ENTERING REQUEST)
"RTN","RAHLR1",114,0)
 S RASERSEC(0)=+$$GET1^DIQ(200,$P(RAZORD,U,15),29,"I") ;pointer to 49
"RTN","RAHLR1",115,0)
 S RASERSEC(1)=$$GET1^DIQ(49,RASERSEC(0),1) ;abbr. of service/section
"RTN","RAHLR1",116,0)
 S RAORC(18)=RASERSEC(1)_$E(HLECH)_RASERSEC_$E(HLECH)_"VISTA49"
"RTN","RAHLR1",117,0)
 ;build the ORC segment; set the HLA array
"RTN","RAHLR1",118,0)
 D BLSEG^RAHLRU1("ORC",.RAORC)
"RTN","RAHLR1",119,0)
 K RACANC,RACOMP,RASERSEC,RAXAMSTS,RAZNME,RAZPHONE
"RTN","RAHLR1",120,0)
 ;
"RTN","RAHLR1",121,0)
 D:$T(EN^RAHLR1A)]"" EN^RAHLR1A ;continue building the OBR, OBX, & ZDS segments
"RTN","RAHLR1",122,0)
 ;
"RTN","RAHLR1",123,0)
 ; Broadcast the HL7 message and cleanup the symbol table
"RTN","RAHLR1",124,0)
 D GENERATE^RAHLRU
"RTN","RAHLR1",125,0)
 Q
"RTN","RAHLR1",126,0)
 ;
"RTN","RAHLR1",127,0)
INIT ;initialize some basic package specific variables
"RTN","RAHLR1",128,0)
 S:'($D(U)#2) U="^"
"RTN","RAHLR1",129,0)
 S RAZRXAM=$G(^RADPT(RADFN,"DT",RADTI,0)) ;reg. exam zero node
"RTN","RAHLR1",130,0)
 S RAZXAM=$G(^RADPT(RADFN,"DT",RADTI,"P",RACNI,0)) ;exam zero node
"RTN","RAHLR1",131,0)
 S RAPURGE=+$G(^RADPT(RADFN,"DT",RADTI,"P",RACNI,"PURGE"))
"RTN","RAHLR1",132,0)
 S RAZDTE=9999999.9999-RADTI ;FM internal date/time
"RTN","RAHLR1",133,0)
 ; Check if SSAN is to be used:
"RTN","RAHLR1",134,0)
 I $$USESSAN^RAHLRU1()=1 D  ;use SSAN as accession
"RTN","RAHLR1",135,0)
 .S RAZDAYCS=$P(RAZXAM,"^",31)
"RTN","RAHLR1",136,0)
 .; It could be that an old study is being resent
"RTN","RAHLR1",137,0)
 .; so build the SSAN on the fly.
"RTN","RAHLR1",138,0)
 .S:RAZDAYCS="" RAZDAYCS=$$ACCNUM^RAAPI(RADFN,RADTI,RACNI)
"RTN","RAHLR1",139,0)
 .Q
"RTN","RAHLR1",140,0)
 ; odd, but v2.4 protocols activated w/o SSANs being used
"RTN","RAHLR1",141,0)
 E  D
"RTN","RAHLR1",142,0)
 .; Legacy Accession Number:  mmddyy-case#
"RTN","RAHLR1",143,0)
 .S RAZDAYCS=$E(RAZDTE,4,7)_$E(RAZDTE,2,3)_"-"_+RAZXAM
"RTN","RAHLR1",144,0)
 .Q
"RTN","RAHLR1",145,0)
 ;
"RTN","RAHLR1",146,0)
 S RAZORD=$G(^RAO(75.1,+$P(RAZXAM,U,11),0)) ;rad/nuc med order zero node
"RTN","RAHLR1",147,0)
 S RAZORD1=$P($G(^RAO(75.1,+$P(RAZXAM,U,11),.1)),U) ;rad/nuc  reason for study
"RTN","RAHLR1",148,0)
 S RAZPROC=$G(^RAMIS(71,+$P(RAZXAM,U,2),0)) ;exam specific procedure
"RTN","RAHLR1",149,0)
 Q
"RTN","RAHLR1",150,0)
 ;
"RTN","RAHLR1",151,0)
PARENT(PRGE,PRNT) ;Define fields ORC-8 & OBR-29 known as PARENT
"RTN","RAHLR1",152,0)
 ; input: PRGE=purge date of the exam (if applicable)
"RTN","RAHLR1",153,0)
 ;        PRNT=parent/descendant if yes, specify if exam or printset
"RTN","RAHLR1",154,0)
 ;return: VALUE=ORIGINAL ORDER PURGED if purged, EXAMSET: proc_name
"RTN","RAHLR1",155,0)
 ;        if examset, PRINTSET: proc_name if printset, or null.
"RTN","RAHLR1",156,0)
 N VALUE ;RA5P125
"RTN","RAHLR1",157,0)
 I PRGE,(PRGE'>DT) S VALUE="ORIGINAL ORDER PURGED"
"RTN","RAHLR1",158,0)
 I PRNT S VALUE=$S(PRNT=1:"Examset: ",1:"Printset: ")_$P($G(^RAMIS(71,+$P(RAZORD,U,2),0)),U)
"RTN","RAHLR1",159,0)
 Q $G(VALUE)
"RTN","RAHLR1",160,0)
 ;
"RTN","RAIPS158")
0^7^B22138051^n/a
"RTN","RAIPS158",1,0)
RAIPS158 ;HISC/GJC post-install routine ;05 Jun 2019 8:37 AM
"RTN","RAIPS158",2,0)
 ;;5.0;Radiology/Nuclear Medicine;**158**;Mar 16, 1998;Build 2
"RTN","RAIPS158",3,0)
 ;
"RTN","RAIPS158",4,0)
 ;Routine              IA          Type
"RTN","RAIPS158",5,0)
 ;-------------------------------------
"RTN","RAIPS158",6,0)
 ; ^%ZTLOAD            10063        (S)
"RTN","RAIPS158",7,0)
 ;  FILE^DIE           2053         (S)
"RTN","RAIPS158",8,0)
 ;  DT^XLFDT           10103        (S)
"RTN","RAIPS158",9,0)
 ;  FMADD^XLFDT        10103        (S)
"RTN","RAIPS158",10,0)
 ;  UNWIND^%ZTER       1621         (S)
"RTN","RAIPS158",11,0)
 ;  ^%ZTER             1621         (S)
"RTN","RAIPS158",12,0)
 ; FILESEC^DDMOD       2916         (S)
"RTN","RAIPS158",13,0)
 ;  DQ^XUFILE1         7078         (P)
"RTN","RAIPS158",14,0)
 ;
"RTN","RAIPS158",15,0)
 N RACHX1 S RACHX1=$$NEWCP^XPDUTL("POST1","EN^RAIPS158")
"RTN","RAIPS158",16,0)
 Q
"RTN","RAIPS158",17,0)
 ;
"RTN","RAIPS158",18,0)
EN ;delete the ORIGINAL PROCEDURE? (field: [#8]) flag
"RTN","RAIPS158",19,0)
 ; for all procedures in the RAD/NUC MED PROCEDURES [#71]
"RTN","RAIPS158",20,0)
 ; file.
"RTN","RAIPS158",21,0)
 ;
"RTN","RAIPS158",22,0)
 ; ^XTMP(namespaced- subscript,0)=purge date^create date^last file 71 IEN
"RTN","RAIPS158",23,0)
 ; (both dates will be in VA FileMan internal date format). TTL = fifteen days
"RTN","RAIPS158",24,0)
 ;
"RTN","RAIPS158",25,0)
 I '$D(^XTMP("RA158",0))#2 D
"RTN","RAIPS158",26,0)
 .S ^XTMP("RA158",0)=$$FMADD^XLFDT($$DT^XLFDT(),15,0,0,0)_U_$$DT^XLFDT()_U
"RTN","RAIPS158",27,0)
 .Q
"RTN","RAIPS158",28,0)
 ;
"RTN","RAIPS158",29,0)
 K RATXT,RAY N ZTDESC,ZTDTH,ZTIO,ZTRTN,ZTSAVE
"RTN","RAIPS158",30,0)
 S RAY=+$P($G(^XTMP("RA158",0)),U,3)
"RTN","RAIPS158",31,0)
 S:RAY>0 RAY=(RAY-0.1)
"RTN","RAIPS158",32,0)
 S ZTIO="",ZTRTN="EN1^RAIPS158",ZTSAVE("RAY")=""
"RTN","RAIPS158",33,0)
 S (ZTDESC,RATXT(1))="RA158 post: Delete the ORIGINAL PROCEDURE? flag from file [#71]."
"RTN","RAIPS158",34,0)
 S ZTDTH=$H D ^%ZTLOAD
"RTN","RAIPS158",35,0)
 S RATXT(2)="Task: "_$S($G(ZTSK)>0:ZTSK,1:"in error")
"RTN","RAIPS158",36,0)
 D BMES^XPDUTL(.RATXT) K RATXT,RAY
"RTN","RAIPS158",37,0)
 ;
"RTN","RAIPS158",38,0)
 D EN2 ;add new cancel reasons to file 75.2
"RTN","RAIPS158",39,0)
 ;
"RTN","RAIPS158",40,0)
 D EN3 ;remove TYPE OF REASON value for all non-national records in file 75.2
"RTN","RAIPS158",41,0)
 ;
"RTN","RAIPS158",42,0)
 D EN4 ;remove user access to the RAD/NUC MED REASON [#75.2]
"RTN","RAIPS158",43,0)
 ;
"RTN","RAIPS158",44,0)
 D EN5 ;set file security for 75.2 all "@" except for "RD" & "AUDIT"
"RTN","RAIPS158",45,0)
 ;
"RTN","RAIPS158",46,0)
 QUIT
"RTN","RAIPS158",47,0)
 ;
"RTN","RAIPS158",48,0)
EN1 ; entry point to loop [#71] called from EN tag.
"RTN","RAIPS158",49,0)
 ;
"RTN","RAIPS158",50,0)
 N $ESTACK,$ETRAP S $ETRAP="D ABEND^RAIPS158"
"RTN","RAIPS158",51,0)
 ;
"RTN","RAIPS158",52,0)
 S RAROOT=$NA(^RAMIS(71))
"RTN","RAIPS158",53,0)
 ;variable RAY set above
"RTN","RAIPS158",54,0)
 F  S RAY=$O(^RAMIS(71,RAY)) Q:RAY'>0  D
"RTN","RAIPS158",55,0)
 .Q:$P(@RAROOT@(RAY,0),U,8)'="Y"
"RTN","RAIPS158",56,0)
 .S RAFDA(71,RAY_",",8)="@" D FILE^DIE("","RAFDA")
"RTN","RAIPS158",57,0)
 .K RAFDA S $P(^XTMP("RA158",0),U,3)=RAY
"RTN","RAIPS158",58,0)
 .Q
"RTN","RAIPS158",59,0)
 K RAROOT,RAY
"RTN","RAIPS158",60,0)
 S:$D(ZTQUEUED)#2 ZTREQ="@"
"RTN","RAIPS158",61,0)
 Q
"RTN","RAIPS158",62,0)
 ;
"RTN","RAIPS158",63,0)
ABEND ;come here on error
"RTN","RAIPS158",64,0)
 S $P(^XTMP("RA158",0),U,3)=$G(RAY)
"RTN","RAIPS158",65,0)
 D ^%ZTER ; record the error
"RTN","RAIPS158",66,0)
 D UNWIND^%ZTER ; unwind the stack, return to caller.
"RTN","RAIPS158",67,0)
 Q
"RTN","RAIPS158",68,0)
 ;
"RTN","RAIPS158",69,0)
EN2 ;add new cancel reasons...
"RTN","RAIPS158",70,0)
 S RAR="RAFDA(75.2,""?+1,"")" ;FDA root - check for existing entry w/?
"RTN","RAIPS158",71,0)
 F RAI=1:1 S RAREA=$T(REA+RAI) Q:RAREA=""  D
"RTN","RAIPS158",72,0)
 .S RA01=$P(RAREA,";",3),RA3=$P(RAREA,";",4)
"RTN","RAIPS158",73,0)
 .S @RAR@(.01)=RA01 ;Reason
"RTN","RAIPS158",74,0)
 .S @RAR@(2)=1      ;Type of reason=cancel request
"RTN","RAIPS158",75,0)
 .S @RAR@(3)=RA3    ;Synonym
"RTN","RAIPS158",76,0)
 .S @RAR@(4)="i"    ;Nature of order activity=Policy
"RTN","RAIPS158",77,0)
 .S @RAR@(5)="Y"    ;NATIONAL flag = YES prevents local modifications
"RTN","RAIPS158",78,0)
 .D UPDATE^DIE(,"RAFDA","","RAMSG(1)") K RAFDA
"RTN","RAIPS158",79,0)
 .I $D(RAMSG(1,"DIERR"))#2 S RATXT="An error occured filing data for "_RA01
"RTN","RAIPS158",80,0)
 .E  S RATXT=RA01_" filed"
"RTN","RAIPS158",81,0)
 .D MES^XPDUTL(RATXT)
"RTN","RAIPS158",82,0)
 .K RATXT,RAMSG
"RTN","RAIPS158",83,0)
 K RAI,RAR,RAREA
"RTN","RAIPS158",84,0)
 Q
"RTN","RAIPS158",85,0)
 ;
"RTN","RAIPS158",86,0)
EN3 ;remove type of reason (#2) off non-national reason
"RTN","RAIPS158",87,0)
 S RAY=0 F  S RAY=$O(^RA(75.2,RAY)) Q:RAY'>0  D
"RTN","RAIPS158",88,0)
 .Q:$P(^RA(75.2,RAY,0),U,5)="Y"  ;national - hands off
"RTN","RAIPS158",89,0)
 .S RAFDA(75.2,RAY_",",2)="@"
"RTN","RAIPS158",90,0)
 .D FILE^DIE("","RAFDA","")
"RTN","RAIPS158",91,0)
 .K RAFDA
"RTN","RAIPS158",92,0)
 .Q
"RTN","RAIPS158",93,0)
 K RAY
"RTN","RAIPS158",94,0)
 Q
"RTN","RAIPS158",95,0)
 ;
"RTN","RAIPS158",96,0)
EN4 ;remove user access to the RAD/NUC MED REASON [#75.2]
"RTN","RAIPS158",97,0)
 N RATXT,ZTDESC,ZTDTH,ZTIO,ZTRTN
"RTN","RAIPS158",98,0)
 S ZTIO="",RATXT(1)="",ZTRTN="TSK^RAIPS158"
"RTN","RAIPS158",99,0)
 S (ZTDESC,RATXT(2))="RA158: remove user access to the RAD/NUC MED REASON [#75.2]"
"RTN","RAIPS158",100,0)
 S ZTDTH=$H D ^%ZTLOAD S RATXT(3)="Task: "_$S($G(ZTSK)>0:ZTSK,1:"in error")
"RTN","RAIPS158",101,0)
 D BMES^XPDUTL(.RATXT)
"RTN","RAIPS158",102,0)
 Q
"RTN","RAIPS158",103,0)
 ;
"RTN","RAIPS158",104,0)
EN5 ;set file security for 75.2 all "@" except for "RD" & "AUDIT"
"RTN","RAIPS158",105,0)
 K ^TMP("DIERR",$J)
"RTN","RAIPS158",106,0)
 S RASEC752("DD")="@"
"RTN","RAIPS158",107,0)
 S RASEC752("RD")=""
"RTN","RAIPS158",108,0)
 S RASEC752("WR")="@"
"RTN","RAIPS158",109,0)
 S RASEC752("DEL")="@"
"RTN","RAIPS158",110,0)
 S RASEC752("LAYGO")="@"
"RTN","RAIPS158",111,0)
 S RASEC752("AUDIT")=""
"RTN","RAIPS158",112,0)
 D FILESEC^DDMOD(75.2,.RASEC752)
"RTN","RAIPS158",113,0)
 I $D(^TMP("DIERR",$J))>0 K RATXT D
"RTN","RAIPS158",114,0)
 .S RATXT(1)="Error when setting security access codes for the"
"RTN","RAIPS158",115,0)
 .S RATXT(2)="RAD/NUC MED REASON [#75.2] file." D BMES^XPDUTL(.RATXT)
"RTN","RAIPS158",116,0)
 .K RATXT
"RTN","RAIPS158",117,0)
 .Q
"RTN","RAIPS158",118,0)
 K ^TMP("DIERR",$J),RASEC752
"RTN","RAIPS158",119,0)
 Q
"RTN","RAIPS158",120,0)
 ;
"RTN","RAIPS158",121,0)
TSK ;remove user access to the RAD/NUC MED REASON [#75.2]
"RTN","RAIPS158",122,0)
 ;file.
"RTN","RAIPS158",123,0)
 N XUW S XUW=75.2 D DQ^XUFILE1
"RTN","RAIPS158",124,0)
 Q
"RTN","RAIPS158",125,0)
 ;
"RTN","RAIPS158",126,0)
 ;Note: type of reason = cancel request; Nature of order = policy; national = yes
"RTN","RAIPS158",127,0)
REA ;reason table
"RTN","RAIPS158",128,0)
 ;;CC-IMAGING CONSULT DC/ADMIN CLOSURE POLICY;CC ADMIN CLOSE
"RTN","RAIPS158",129,0)
 ;;CC-IMAGING CONSULT DC PT CX'D;CC CANCEL
"RTN","RAIPS158",130,0)
 ;;CC-IMAGING CONSULT DC PT NO SHOW;CC NO SHOW
"RTN","RAIPS158",131,0)
 ;;CC-IMAGING CONSULT DC UNABLE TO CONTACT;CC NO RESPONSE
"RTN","RAIPS158",132,0)
 ;;OBSOLETE ORDER;OBSOLETE
"RTN","RAIPS158",133,0)
 ;;UNABLE TO CONTACT THE PATIENT;NO RESPONSE
"RTN","RAIPS158",134,0)
 ;;FUTURE DD/CID GREATER THAN 390 DAYS;FUTURE > 390
"RTN","RAIPS158",135,0)
 ;;PATIENT NO SHOWED;NO SHOW
"RTN","RAIPS158",136,0)
 ;;DUPLICATE ORDER;DUPLICATE
"RTN","RAIPS158",137,0)
 ;;PATIENT REFUSED;REFUSED EXAM
"RTN","RAIPS158",138,0)
 ;;EXAM CANCELLED;EXAM CANCELLED
"RTN","RAIPS158",139,0)
 ;;OTHER;OTHER
"RTN","RAIPS158",140,0)
 ;;IMAGES UNAVAILABLE;NO IMAGES
"RTN","RAMAIN2")
0^4^B65131513^B63318644
"RTN","RAMAIN2",1,0)
RAMAIN2 ;HISC/GJC-Radiology Utility File Maintenance (Part Two) ;19 Apr 2019 2:40 PM
"RTN","RAMAIN2",2,0)
 ;;5.0;Radiology/Nuclear Medicine;**45,62,71,65,127,138,158**;Mar 16, 1998;Build 2
"RTN","RAMAIN2",3,0)
 ; 08/12/2005 bay/kam Remedy Call 104630 Patch 62
"RTN","RAMAIN2",4,0)
 ; 03/02/2006 BAY/KAM Remedy Call 131482 Patch RA*5*71
"RTN","RAMAIN2",5,0)
 ; 
"RTN","RAMAIN2",6,0)
 ;Supported IA #10141 reference to MES^XPDUTL
"RTN","RAMAIN2",7,0)
 ;Supported IA #10142 reference to EN^DDIOL
"RTN","RAMAIN2",8,0)
 ;Supported IA #10103 reference to DT^XLFDT
"RTN","RAMAIN2",9,0)
 ; 
"RTN","RAMAIN2",10,0)
2 ;;Procedure Enter/Edit
"RTN","RAMAIN2",11,0)
 ; *** This subroutine once resided in RAMAIN i.e, '2^RAMAIN'. ***
"RTN","RAMAIN2",12,0)
 ; RA PROCEDURE option
"RTN","RAMAIN2",13,0)
 N RACTIVE,RAENALL,RAY,RAFILE,RASTAT,RAXIT,RAIEN,RANEW,RASEED,RANEWPRO K ^XTMP("RAMAIN4",$J)
"RTN","RAMAIN2",14,0)
 S (RAENALL,RANEW71,RAXIT,RANEW)=0 K ^XTMP("RAMAIN4",$J)
"RTN","RAMAIN2",15,0)
 N RADIO,RAPTY,RAASK,RAROUTE ;used by the edit template
"RTN","RAMAIN2",16,0)
 F  D  Q:$G(RAXIT)=0!($G(RAXIT)="")!($G(^XTMP("RAMAIN4",$J,"RAEND"))=1)  G:$G(^XTMP("RAMAIN4",$J,"RAEND"))=1 END
"RTN","RAMAIN2",17,0)
 . K DA,DD,DIC,DINUM,DLAYGO,DO,RACMDIFF,RATRKCMA,RATRKCMB
"RTN","RAMAIN2",18,0)
 . S DIC="^RAMIS(71,",DIC(0)="QEAMLZ",DLAYGO=71,DIC("DR")=6
"RTN","RAMAIN2",19,0)
 . W ! D ^DIC K D,DD,DIC,DINUM,DLAYGO,DO
"RTN","RAMAIN2",20,0)
 . I $G(Y)<0!($G(Y)="") S ^XTMP("RAMAIN4",$J,"RAEND")=1 Q
"RTN","RAMAIN2",21,0)
 . S (DA,RADA)=+Y,RAY=Y,RAFILE=71
"RTN","RAMAIN2",22,0)
 . ;RA*5*71 changed next line for Remedy Call 131482
"RTN","RAMAIN2",23,0)
 . S RANEW71=$S($P(Y,U,3)=1:1,1:0) ;used in template, edit CPT Code if new rec.
"RTN","RAMAIN2",24,0)
 . L +^RAMIS(RAFILE,RADA):5
"RTN","RAMAIN2",25,0)
 . I '$T D  Q
"RTN","RAMAIN2",26,0)
 .. W !?5,"This record is currently being edited by another user."
"RTN","RAMAIN2",27,0)
 .. W !?5,"Try again later!",$C(7) S RAXIT=1
"RTN","RAMAIN2",28,0)
 .. Q
"RTN","RAMAIN2",29,0)
 . Q
"RTN","RAMAIN2",30,0)
21 ;ENTRY POINT FROM RANPRO, RA*5.0*127
"RTN","RAMAIN2",31,0)
 S (RAENALL,RANEW71,RAXIT,RANEW)=0 S:$G(RACTIVE)="" RACTIVE="" K ^XTMP("RAMAIN4",$J)
"RTN","RAMAIN2",32,0)
 I RACTIVE="" S RACTIVE=$P($G(^RAMIS(71,RADA,"I")),"^")
"RTN","RAMAIN2",33,0)
 S RAFILE=71,RAY=RAYY S:$G(RASTAT)="" RASTAT=$S(RACTIVE="":1,RACTIVE>DT:1,1:0)
"RTN","RAMAIN2",34,0)
 D  ;ENTER INTO STRUCTURE PROCESS
"RTN","RAMAIN2",35,0)
 . S RAPNM=$P($G(Y(0)),U) ;proc. name for display purposes in template
"RTN","RAMAIN2",36,0)
 . S RACTIVE=$P($G(^RAMIS(71,RADA,"I")),"^")
"RTN","RAMAIN2",37,0)
 . S RASTAT=$S(RACTIVE="":1,RACTIVE>DT:1,1:0)
"RTN","RAMAIN2",38,0)
 . D TRKCMB^RAMAINU(DA,.RATRKCMB) ;tracks existing
"RTN","RAMAIN2",39,0)
 . ; CM definition before editing. RATRKCMB ids the before CM values
"RTN","RAMAIN2",40,0)
 . I $G(RANEW)=1 Q  ;RA*50*127 NEW PROCEDURE
"RTN","RAMAIN2",41,0)
 . S DIE="^RAMIS(71,",DR="[RA PROCEDURE EDIT]" D ^DIE
"RTN","RAMAIN2",42,0)
 . S RACPT=$P(^RAMIS(71,RADA,0),U,9)
"RTN","RAMAIN2",43,0)
 . K RAPNM S RAPROC(0)=$G(^RAMIS(71,RADA,0))
"RTN","RAMAIN2",44,0)
 . ;
"RTN","RAMAIN2",45,0)
 . ;check for data consistency between the 'CONTRAST MEDIA USED' &
"RTN","RAMAIN2",46,0)
 . ;'CONTRAST MEDIA' fields.
"RTN","RAMAIN2",47,0)
 . D CMINTEG^RAMAINU1(RADA,RAPROC(0))
"RTN","RAMAIN2",48,0)
 . ;
"RTN","RAMAIN2",49,0)
 . D TRKCMA^RAMAINU(RADA,RATRKCMB,.RATRKCMA,.RACMDIFF)
"RTN","RAMAIN2",50,0)
 . I $O(^RAMIS(71,RADA,"NUC",0)),($P(RAPROC(0),"^",2)=1) D DELRADE(RADA)
"RTN","RAMAIN2",51,0)
 . S RACTIVE=$P($G(^RAMIS(71,RADA,"I")),"^")
"RTN","RAMAIN2",52,0)
 . S RASTAT=RASTAT_"^"_$S(RACTIVE="":1,RACTIVE>DT:1,1:0)
"RTN","RAMAIN2",53,0)
 . ; 08/12/2005 104630 KAM - added '$G(RANEW71) to next line
"RTN","RAMAIN2",54,0)
 . I RAPROC(0)]"",("^B^P^"'[(U_$P(RAPROC(0),"^",6)_U)),('+$P(RAPROC(0),"^",9)),'+$G(RANEW71) D
"RTN","RAMAIN2",55,0)
 .. K %,C,D0,DE,DI,DIE,DQ,DR
"RTN","RAMAIN2",56,0)
 .. W !?5,$C(7),"...no CPT code entered..."
"RTN","RAMAIN2",57,0)
 .. W !?5,"...will change type to a 'broad' procedure.",!
"RTN","RAMAIN2",58,0)
 .. S DA=RADA,DIE="^RAMIS(71,",DR="6///B" D ^DIE
"RTN","RAMAIN2",59,0)
 .. Q
"RTN","RAMAIN2",60,0)
 . ;08/12/2005 104630 - KAM added next 5 lines
"RTN","RAMAIN2",61,0)
 . I RAPROC(0)]"",("^B^P^"'[(U_$P(RAPROC(0),"^",6)_U)),('+$P(RAPROC(0),"^",9)),+$G(RANEW71) D
"RTN","RAMAIN2",62,0)
 .. K %,C,D0,DE,DI,DIK,DQ,DR
"RTN","RAMAIN2",63,0)
 .. W !?5,$C(7),"...no CPT code entered..."
"RTN","RAMAIN2",64,0)
 .. W !?5,"...will delete the record at this time.",!
"RTN","RAMAIN2",65,0)
 .. S DIK="^RAMIS(71,",DA=RADA D ^DIK K DIK
"RTN","RAMAIN2",66,0)
 . ;if an active parent w/o descendants, inactivate the parent
"RTN","RAMAIN2",67,0)
 . I $P(RASTAT,U,2),($P(RAPROC(0),U,6)="P"),('$O(^RAMIS(71,RADA,4,0))) D
"RTN","RAMAIN2",68,0)
 .. K D,D0,D1,DA,DI,DIC,DIE,DQ,DR
"RTN","RAMAIN2",69,0)
 .. W !!?5,"Inactivating this parent procedure - no descendents.",!,$C(7)
"RTN","RAMAIN2",70,0)
 .. S DA=RADA,DIE="^RAMIS(71,",DR="100///"_$S($D(DT):DT,1:$$DT^XLFDT())
"RTN","RAMAIN2",71,0)
 .. D ^DIE K D,D0,D1,DA,DI,DIC,DIE,DQ,DR S $P(RASTAT,U,2)=0 ;inactive
"RTN","RAMAIN2",72,0)
 .. Q
"RTN","RAMAIN2",73,0)
 . I $P($G(^RA(79.2,+$P(RAPROC(0),U,12),0)),U,5)="Y",(+$O(^RAMIS(71,RADA,"NUC",0))) D VRDIO(RADA)
"RTN","RAMAIN2",74,0)
 . I "^B^P^"[(U_$P(RAPROC(0),U,6)_U),($P(RAPROC(0),U,9)]"") D
"RTN","RAMAIN2",75,0)
 .. K %,D,D0,DA,DE,DIC,DIE,DQ,DR
"RTN","RAMAIN2",76,0)
 .. S DA=RADA,DIE="^RAMIS(71,",DR="9///@" D ^DIE
"RTN","RAMAIN2",77,0)
 .. W !!?5,"...CPT code deleted because "_$S($P(RAPROC(0),U,6)="B":"Broad",1:"Parent")_" procedures",!?5,"should not have CPT codes.",!,$C(7)
"RTN","RAMAIN2",78,0)
 .. Q
"RTN","RAMAIN2",79,0)
 . K %,%X,%Y,C,D,D0,D1,DA,DE,DI,DIE,DQ,DR,RAIMAG,RAMIS,RAPROC,X,Y
"RTN","RAMAIN2",80,0)
 .;send Orderable Item HL7 msg to CPRS if the ORDER DIALOG (#101.41)
"RTN","RAMAIN2",81,0)
 .;file exists unconditionally
"RTN","RAMAIN2",82,0)
 .D:$$ORQUIK^RAORDU()=1 PROC^RAO7MFN(RAENALL,RAFILE,RASTAT,RAY)
"RTN","RAMAIN2",83,0)
 .;
"RTN","RAMAIN2",84,0)
 . L -^RAMIS(RAFILE,RADA) K RADA
"RTN","RAMAIN2",85,0)
 .;unconditionally update the parent procedure if the descendent
"RTN","RAMAIN2",86,0)
 .I $O(^RAMIS(71,"ADESC",+RAY,0)) D UPDATP^RAO7UTL(RAY)
"RTN","RAMAIN2",87,0)
 .;has been edited
"RTN","RAMAIN2",88,0)
 . Q
"RTN","RAMAIN2",89,0)
 I $G(RANEW)=1 D EN^RANPRO(RAYY,RATYPE,RANEW)  ;RA*5.0*127 NEW PROCEDURE
"RTN","RAMAIN2",90,0)
 K DIR,RACMDIFF,RATRKCMA,RATRKCMB
"RTN","RAMAIN2",91,0)
 I $G(^XTMP("RAMAIN4",$J,"RAEND"))=1 G END
"RTN","RAMAIN2",92,0)
 D EXIT G END
"RTN","RAMAIN2",93,0)
 Q
"RTN","RAMAIN2",94,0)
 ;W !,?3,"Running validity check on CPT and stop codes." H 1 D ^RAPERR G EXIT  ;RA*5*127
"RTN","RAMAIN2",95,0)
22 ; RA*5*127
"RTN","RAMAIN2",96,0)
 K DIR
"RTN","RAMAIN2",97,0)
 S DIR(0)="YAO",DIR("B")="NO"
"RTN","RAMAIN2",98,0)
 S DIR("A")="Want to run a validity check on CPT and stop codes? "
"RTN","RAMAIN2",99,0)
 S DIR("?",1)="Answer 'YES' to print a list of Radiology/Nuclear Medicine Procedures"
"RTN","RAMAIN2",100,0)
 S DIR("?",2)="with missing or invalid CPT's and/or Credit Clinic Stop Code(s)."
"RTN","RAMAIN2",101,0)
 S DIR("?",3)="Broad procedures with invalid codes are included for information"
"RTN","RAMAIN2",102,0)
 S DIR("?",4)="only.  Inactive procedures are not required to have valid codes."
"RTN","RAMAIN2",103,0)
 S DIR("?",5)="To be valid, Stop Codes must be in the Imaging Stop Codes file 71.5;"
"RTN","RAMAIN2",104,0)
 S DIR("?",6)="CPT's must be nationally active."
"RTN","RAMAIN2",105,0)
 S DIR("?")="Please answer 'YES' or 'NO'."
"RTN","RAMAIN2",106,0)
 W ! D ^DIR K DIR G:$D(DIRUT) EXIT
"RTN","RAMAIN2",107,0)
 D:Y ^RAPERR
"RTN","RAMAIN2",108,0)
EXIT K RADA,RANEW71,X,Y
"RTN","RAMAIN2",109,0)
 Q
"RTN","RAMAIN2",110,0)
13 ;;Rad/Nuc Med Common Procedure File Enter/Edit
"RTN","RAMAIN2",111,0)
 ; RA COMMON PROCEDURE option RA5P158
"RTN","RAMAIN2",112,0)
 N RADA,RAENALL,RAY,RAFILE,RALOW,RAMIS713,RASTAT,RAIMGTYI S RAENALL=0
"RTN","RAMAIN2",113,0)
 W ! D EN1^RAUTL17 G:Y'>0 Q13 S RAIMGTYI=Y
"RTN","RAMAIN2",114,0)
131 S DIC="^RAMIS(71.3,",DIC(0)="AELMQZ",DLAYGO=71.3
"RTN","RAMAIN2",115,0)
 S DIC("S")="I $$SCRN713^RAMAIN2(+$P(^(0),U),RAIMGTYI)"
"RTN","RAMAIN2",116,0)
 S DIC("W")="W $$DICW713^RAMAIN2($P($G(^(0)),U,4))"
"RTN","RAMAIN2",117,0)
 W ! D ^DIC K DIC,DLAYGO,D,X
"RTN","RAMAIN2",118,0)
 I Y<0 D Q13 G RESEQ
"RTN","RAMAIN2",119,0)
 ; If a sequence # exists, the Common Proc. is active
"RTN","RAMAIN2",120,0)
 MERGE RAY=Y S RADA=+Y,RAFILE=71.3 L +^RAMIS(RAFILE,RADA):5
"RTN","RAMAIN2",121,0)
 I '$T D  G Q13
"RTN","RAMAIN2",122,0)
 . W !?5,"This record is currently being edited by another user."
"RTN","RAMAIN2",123,0)
 . W !?5,"Try again later!",$C(7)
"RTN","RAMAIN2",124,0)
 . Q
"RTN","RAMAIN2",125,0)
 S RASTAT=$S($P(Y(0),"^",4)]"":1,1:0)_"^"
"RTN","RAMAIN2",126,0)
 I '+$P(RASTAT,"^") S RALOW=$$LOW(RAIMGTYI)
"RTN","RAMAIN2",127,0)
 S DA=RADA,DIE="^RAMIS(71.3,",DR="[RA COMMON PROCEDURE EDIT]" D ^DIE
"RTN","RAMAIN2",128,0)
 S RAMIS713(0)=$G(^RAMIS(71.3,RADA,0))
"RTN","RAMAIN2",129,0)
 ; If the procedure is different than the one originally selected and
"RTN","RAMAIN2",130,0)
 ; the CPRS Order Dialog file exists, send the Orderable Item Update
"RTN","RAMAIN2",131,0)
 ; message to CPRS.
"RTN","RAMAIN2",132,0)
 I $P(RAMIS713(0),"^")'=$P(RAY,"^",2),($$ORQUIK^RAORDU()=1) D
"RTN","RAMAIN2",133,0)
 . S RASTAT=RASTAT_0 D PROC^RAO7MFN(RAENALL,RAFILE,RASTAT,RAY)
"RTN","RAMAIN2",134,0)
 . S RAY=RADA_"^"_$P($G(^RAMIS(71.3,RADA,0)),"^")_"^"_1,RASTAT=0_"^"
"RTN","RAMAIN2",135,0)
 . Q
"RTN","RAMAIN2",136,0)
 K %,%X,%Y,C,D,D0,DA,DE,DI,DIE,DQ,DR,X,Y
"RTN","RAMAIN2",137,0)
 S RASTAT=RASTAT_$S($P($G(^RAMIS(71.3,+RAY,0)),"^",4)]"":1,1:0)
"RTN","RAMAIN2",138,0)
 ; If before & after statuses differ, and the CPRS Order Dialog file
"RTN","RAMAIN2",139,0)
 ; exists, send the Orderable Item Update message to CPRS.
"RTN","RAMAIN2",140,0)
 I $$ORQUIK^RAORDU()=1,(($P(RASTAT,"^")+$P(RASTAT,"^",2))=1) D
"RTN","RAMAIN2",141,0)
 . D PROC^RAO7MFN(RAENALL,RAFILE,RASTAT,RAY)
"RTN","RAMAIN2",142,0)
 . Q
"RTN","RAMAIN2",143,0)
 L -^RAMIS(RAFILE,RADA)
"RTN","RAMAIN2",144,0)
 G 131
"RTN","RAMAIN2",145,0)
Q13 K DDC,DDH,DISYS,I,POP,RA713
"RTN","RAMAIN2",146,0)
 Q
"RTN","RAMAIN2",147,0)
RESEQ ;Resequence the common procedure list
"RTN","RAMAIN2",148,0)
 N D,D0,DI,DQ,H,I,J,CNT,DIC,DIE,DR,DA,TXT,X
"RTN","RAMAIN2",149,0)
 I $D(XPDNM) D  ; if called during package install
"RTN","RAMAIN2",150,0)
 . S TXT(1)=" "
"RTN","RAMAIN2",151,0)
 . S TXT(2)="Resequencing the Rad/Nuc Med Common Procedure List."
"RTN","RAMAIN2",152,0)
 . Q
"RTN","RAMAIN2",153,0)
 E  W !!?5,"Resequencing the Rad/Nuc Med Common Procedure List"
"RTN","RAMAIN2",154,0)
 S DIE="^RAMIS(71.3,",(I,CNT)=0
"RTN","RAMAIN2",155,0)
 F  S I=$O(^RAMIS(71.3,"AA",RAIMGTYI,I)) Q:I'>0  D
"RTN","RAMAIN2",156,0)
 . S J=0
"RTN","RAMAIN2",157,0)
 . F  S J=$O(^RAMIS(71.3,"AA",RAIMGTYI,I,J)) Q:J'>0  I $D(^RAMIS(71.3,J,0)) D
"RTN","RAMAIN2",158,0)
 .. S DA=J,CNT=CNT+1 N I,J
"RTN","RAMAIN2",159,0)
 .. S DR="3////^S X=CNT" D ^DIE W:'$D(XPDNM) "."
"RTN","RAMAIN2",160,0)
 .. Q
"RTN","RAMAIN2",161,0)
 . Q
"RTN","RAMAIN2",162,0)
 I $D(XPDNM) D  ; if called during package install
"RTN","RAMAIN2",163,0)
 . S TXT(2)=$G(TXT(2))_"  Done!"
"RTN","RAMAIN2",164,0)
 . D MES^XPDUTL(.TXT)
"RTN","RAMAIN2",165,0)
 . Q
"RTN","RAMAIN2",166,0)
 E  W "  Done!"
"RTN","RAMAIN2",167,0)
 Q
"RTN","RAMAIN2",168,0)
LOW(X) ; Find the lowest available sequence number for a procedure within
"RTN","RAMAIN2",169,0)
 ; a specific Imaging Type.  Seq. #'s range from 1 to 40.  If the
"RTN","RAMAIN2",170,0)
 ; range changes in the DD i.e, ^DD(71.3,3, this code as well as the 
"RTN","RAMAIN2",171,0)
 ; code if EN3^RAUTL18 must also be altered.
"RTN","RAMAIN2",172,0)
 ; If RAHIT is passed back as "", there is no available sequence number.
"RTN","RAMAIN2",173,0)
 N RA,RAHIT S RAHIT=""
"RTN","RAMAIN2",174,0)
 F RA=1:1:40 D  Q:RAHIT
"RTN","RAMAIN2",175,0)
 . Q:$D(^RAMIS(71.3,"AA",X,RA))
"RTN","RAMAIN2",176,0)
 . S:RAHIT="" RAHIT=RA
"RTN","RAMAIN2",177,0)
 . Q
"RTN","RAMAIN2",178,0)
 Q RAHIT
"RTN","RAMAIN2",179,0)
VRDIO(RADA) ; Validate the 'Usual Dose' field within the 'Default Radiopha-
"RTN","RAMAIN2",180,0)
 ; rmaceuticals' multiple.  'Usual Dose' must fall within the 'Low Adult
"RTN","RAMAIN2",181,0)
 ; Dose' & 'High Adult Dose' range.  This subroutine will display the
"RTN","RAMAIN2",182,0)
 ; Radiopharmaceutical in question along with the values in question if
"RTN","RAMAIN2",183,0)
 ; inconsistencies are found.
"RTN","RAMAIN2",184,0)
 ;
"RTN","RAMAIN2",185,0)
 ; Input Variable: 'RADA' the ien of the Procedure
"RTN","RAMAIN2",186,0)
 N RANUC S RADA(1)=RADA,RADA=0 D EN^DDIOL("","","!")
"RTN","RAMAIN2",187,0)
 F  S RADA=$O(^RAMIS(71,RADA(1),"NUC",RADA)) Q:RADA'>0  D
"RTN","RAMAIN2",188,0)
 . S RANUC(0)=$G(^RAMIS(71,RADA(1),"NUC",RADA,0))
"RTN","RAMAIN2",189,0)
 . Q:$P(RANUC(0),"^",2)=""  ; no need to validate, nothing input
"RTN","RAMAIN2",190,0)
 . I '$$USUAL^RADD2(.RADA,$P(RANUC(0),"^",2)) D
"RTN","RAMAIN2",191,0)
 .. N RARRY S RARRY(1)="For Radiopharmaceutical: "
"RTN","RAMAIN2",192,0)
 .. S RARRY(1)=RARRY(1)_$$EN1^RAPSAPI(+$P(RANUC(0),"^"),.01)_$C(7)
"RTN","RAMAIN2",193,0)
 .. S RARRY(2)="" D EN^DDIOL(.RARRY,"")
"RTN","RAMAIN2",194,0)
 .. Q
"RTN","RAMAIN2",195,0)
 . Q
"RTN","RAMAIN2",196,0)
 Q
"RTN","RAMAIN2",197,0)
DELRADE(RADA) ; Delete the Default Radiopharmaceuticals multiple 
"RTN","RAMAIN2",198,0)
 N RADA1 S RADA1=0
"RTN","RAMAIN2",199,0)
 W !!?3,"Deleting default radiopharmaceuticals for this procedure...",!
"RTN","RAMAIN2",200,0)
 F  S RADA1=$O(^RAMIS(71,RADA,"NUC",RADA1)) Q:RADA1'>0  D
"RTN","RAMAIN2",201,0)
 . K %,%X,%Y,D,D0,DA,DI,DIC,DIE,DQ,DR,X,Y
"RTN","RAMAIN2",202,0)
 . S DA(1)=RADA,DA=RADA1,DIE="^RAMIS(71,"_RADA_",""NUC"","
"RTN","RAMAIN2",203,0)
 . S DR=".01///@" D ^DIE
"RTN","RAMAIN2",204,0)
 . Q
"RTN","RAMAIN2",205,0)
 K %,%X,%Y,D,D0,DA,DI,DIC,DIE,DQ,DR,X,Y
"RTN","RAMAIN2",206,0)
 Q
"RTN","RAMAIN2",207,0)
 ;
"RTN","RAMAIN2",208,0)
END ;KILL LOGIC AND END ROUTINE
"RTN","RAMAIN2",209,0)
 K RACODE,RACPT,RAGOLD,RAMATCH,RANEW71,RANM,RAPROIEN,RATYPE,RAYY
"RTN","RAMAIN2",210,0)
 K DDC,DDH,DISYS,I,POP,RA713,DIK,DA
"RTN","RAMAIN2",211,0)
 Q
"RTN","RAMAIN2",212,0)
 ;
"RTN","RAMAIN2",213,0)
SCRN713(Y,RAIMGTYI) ;screen common procedures by i-type
"RTN","RAMAIN2",214,0)
 ;RAIMGTYI set above in 13^RAMAIN2
"RTN","RAMAIN2",215,0)
 ;'Y' = the IEN of the common procedure as it exists in file 71
"RTN","RAMAIN2",216,0)
 ;'RAIMGTYI' = IEN of the imaging type for the common procedure
"RTN","RAMAIN2",217,0)
 QUIT:(RAIMGTYI=$P($G(^RAMIS(71,Y,0)),U,12)) 1
"RTN","RAMAIN2",218,0)
 Q 0
"RTN","RAMAIN2",219,0)
 ;
"RTN","RAMAIN2",220,0)
DICW713(RAX) ;display the sequence number or a message is the sequence
"RTN","RAMAIN2",221,0)
 ;number is missing. ^DD(71.3,3,0)="SEQUENCE NUMBER" 0;4
"RTN","RAMAIN2",222,0)
 ;'RAX' the sequence number or null statement
"RTN","RAMAIN2",223,0)
 N RASEQTXT S RASEQTXT="   "_$S(RAX>0:"("_RAX_")",1:"(no sequence number)")
"RTN","RAMAIN2",224,0)
 Q RASEQTXT
"RTN","RAMAIN2",225,0)
 ;
"RTN","RAO7MFN")
0^3^B53390914^B40096491
"RTN","RAO7MFN",1,0)
RAO7MFN ;HISC/GJC-Create MFN orderable item update msg ;24 Apr 2019 2:22 PM
"RTN","RAO7MFN",2,0)
 ;;5.0;Radiology/Nuclear Medicine;**1,6,10,18,45,158**;Mar 16, 1998;Build 2
"RTN","RAO7MFN",3,0)
 ;Last midification by SS for P18 JUN 19, 2000
"RTN","RAO7MFN",4,0)
 ;Last modification: 12.16.03 patch 45 Contrast Media by CPT gjc
"RTN","RAO7MFN",5,0)
PROC(RAENALL,RAFILE,RASTAT,RAY) ; Entry point to update a single procedure.
"RTN","RAO7MFN",6,0)
 ; 'RAY'    <> is the same as 'Y' when passed back from DIC after
"RTN","RAO7MFN",7,0)
 ;             lookup on file 71 & file 71.3
"RTN","RAO7MFN",8,0)
 ; 'RAENALL'<> single procedure (0) or whole file update (1) flag
"RTN","RAO7MFN",9,0)
 ; 'RAFILE' <> file # of the file being edited (71 or 71.3)
"RTN","RAO7MFN",10,0)
 ; 'RASTAT' <> Procedure file (71) status: 0 inactive^1 active
"RTN","RAO7MFN",11,0)
 ;             Com. Proc. file (71.3) Seq. # status: 0 inactive^1 active
"RTN","RAO7MFN",12,0)
 ;             1st piece: status before edit, 2nd piece: status after
"RTN","RAO7MFN",13,0)
 ;                        edit.
"RTN","RAO7MFN",14,0)
 ; This entry point can be called from 2^RAMAIN2 or 13^RAMAIN2
"RTN","RAO7MFN",15,0)
 ; This routine assumes that RAVAR is defined as an array or global
"RTN","RAO7MFN",16,0)
 ;  root in which to place the output.
"RTN","RAO7MFN",17,0)
 ;
"RTN","RAO7MFN",18,0)
 Q:'$D(RAY)!('$D(RAFILE))!('$D(RASTAT))!('$D(RAENALL))
"RTN","RAO7MFN",19,0)
 S RAFNUM=71,RAFNAME=$P($G(^DIC(RAFNUM,0)),"^"),RAXIT=0
"RTN","RAO7MFN",20,0)
 S:'$D(RATSTMP) RATSTMP=$$NOW^XLFDT()
"RTN","RAO7MFN",21,0)
 S:'$D(RACNT) RACNT=0 S:'$D(RAINCR) RAINCR="S RACNT=RACNT+1"
"RTN","RAO7MFN",22,0)
 S:'$D(RASUB) RASUB="""RAO7"""
"RTN","RAO7MFN",23,0)
 D:'$D(RAHLFS)!('$D(RAECH)) EN1^RAO7UTL
"RTN","RAO7MFN",24,0)
 I 'RAENALL,('$D(RAVAR)) D
"RTN","RAO7MFN",25,0)
 . S RAVAR="^TMP("_RASUB_","_RATSTMP_","
"RTN","RAO7MFN",26,0)
 . S RAVARBLE="^TMP("_RASUB_","_RATSTMP_")"
"RTN","RAO7MFN",27,0)
 . Q
"RTN","RAO7MFN",28,0)
 I RAFILE=71 D
"RTN","RAO7MFN",29,0)
 . S RA71(0)=$G(^RAMIS(RAFILE,+RAY,0))
"RTN","RAO7MFN",30,0)
 . S RA71("I")=$G(^RAMIS(RAFILE,+RAY,"I"))
"RTN","RAO7MFN",31,0)
 . I $D(^RAMIS(71.3,"B",+RAY)) D
"RTN","RAO7MFN",32,0)
 .. S RA713(0)=$G(^RAMIS(71.3,+$O(^RAMIS(71.3,"B",+RAY,0)),0))
"RTN","RAO7MFN",33,0)
 .. Q
"RTN","RAO7MFN",34,0)
 . Q
"RTN","RAO7MFN",35,0)
 I RAFILE=71.3 D
"RTN","RAO7MFN",36,0)
 . S RA713(0)=$G(^RAMIS(RAFILE,+RAY,0))
"RTN","RAO7MFN",37,0)
 . ; if RA713(0)="" then the common procedure was deleted
"RTN","RAO7MFN",38,0)
 . S RASVIEN=$S(+RA713(0)>0:+RA713(0),1:+$P(RAY,"^",2))
"RTN","RAO7MFN",39,0)
 . S RA71(0)=$G(^RAMIS(71,RASVIEN,0))
"RTN","RAO7MFN",40,0)
 . S RA71("I")=$G(^RAMIS(71,RASVIEN,"I"))
"RTN","RAO7MFN",41,0)
 . K RASVIEN
"RTN","RAO7MFN",42,0)
 . Q
"RTN","RAO7MFN",43,0)
 Q:$$PROCNDE^RAO7UTL(.RA71)  ; Does the Proc. have Proc-Types & I-Types
"RTN","RAO7MFN",44,0)
 I RAFILE=71 D
"RTN","RAO7MFN",45,0)
 .I +$P(RAY,"^",3) D
"RTN","RAO7MFN",46,0)
 ..;new entry, add to master file whether active or inactive
"RTN","RAO7MFN",47,0)
 ..S RAMFE="MAD"
"RTN","RAO7MFN",48,0)
 ..Q
"RTN","RAO7MFN",49,0)
 .I '+$P(RAY,"^",3),(+$P(RASTAT,"^",2)) D
"RTN","RAO7MFN",50,0)
 ..;now active regardless of prior status, update master file
"RTN","RAO7MFN",51,0)
 ..S RAMFE="MUP"
"RTN","RAO7MFN",52,0)
 ..Q
"RTN","RAO7MFN",53,0)
 .I '+$P(RAY,"^",3),('+$P(RASTAT,"^",2)) D
"RTN","RAO7MFN",54,0)
 ..;now inactive regardless of prior status, deactivate master file
"RTN","RAO7MFN",55,0)
 ..S RAMFE="MDC"
"RTN","RAO7MFN",56,0)
 ..Q
"RTN","RAO7MFN",57,0)
 .Q
"RTN","RAO7MFN",58,0)
 ; If RAMFE is still not defined, must be an addition to common orders
"RTN","RAO7MFN",59,0)
 ; 'Update' to OE since procedure is already in their master file
"RTN","RAO7MFN",60,0)
 I RAFILE=71.3 S RAMFE="MUP"
"RTN","RAO7MFN",61,0)
 ;
"RTN","RAO7MFN",62,0)
 ; If parent with no descendents, send deactivate msg even if active
"RTN","RAO7MFN",63,0)
 I $P($G(RA71(0)),"^",6)="P",'$O(^RAMIS(71,$S(RAFILE=71.3:+$P(RAY,"^",2),1:+RAY),4,0)) S RAMFE="MDC"
"RTN","RAO7MFN",64,0)
 ;
"RTN","RAO7MFN",65,0)
 ;* begin 1 * build the non-repeating message segments (MSH, MFI) once
"RTN","RAO7MFN",66,0)
 I 'RAENALL D
"RTN","RAO7MFN",67,0)
 . X RAINCR
"RTN","RAO7MFN",68,0)
 . S @(RAVAR_RACNT_")")=$$MSH^RAO7UTL("MFN^M01") X RAINCR ;P18 event type
"RTN","RAO7MFN",69,0)
 . D MFI^RAO7UTL("UPD") ;P18
"RTN","RAO7MFN",70,0)
 . Q
"RTN","RAO7MFN",71,0)
 ;* end 1 *
"RTN","RAO7MFN",72,0)
 ;
"RTN","RAO7MFN",73,0)
 ;if var1 '= var2 translated:
"RTN","RAO7MFN",74,0)
 ;the user changed the procedure for this common...
"RTN","RAO7MFN",75,0)
 ;if the current pointed to procedure (var1) differs
"RTN","RAO7MFN",76,0)
 ;from the original pointed to procedure (var2)
"RTN","RAO7MFN",77,0)
 I RAFILE=71.3,$P(RAMIS713(0),U)>0,($P(RAMIS713(0),U)'=$P(RAY,U,2)) D
"RTN","RAO7MFN",78,0)
 .;first tackle the 'changed to' procedure (is common)
"RTN","RAO7MFN",79,0)
 .S RA713(0)=RAMIS713(0)
"RTN","RAO7MFN",80,0)
 .S RA71(0)=$G(^RAMIS(71,+RAMIS713(0),0))
"RTN","RAO7MFN",81,0)
 .S RA71("I")=$G(^RAMIS(71,+RAMIS713(0),"I"))
"RTN","RAO7MFN",82,0)
 .D MSGBODY($P($G(RA713(0)),"^",4)) ;pass sequence number
"RTN","RAO7MFN",83,0)
 .;now tackle the 'changed from' procedure (not common)
"RTN","RAO7MFN",84,0)
 .S RA713(0)=$P(RAY,U,2)_"^^^" ;4th piece seq. num.
"RTN","RAO7MFN",85,0)
 .S RA71(0)=$G(^RAMIS(71,+RA713(0),0))
"RTN","RAO7MFN",86,0)
 .S RA71("I")=$G(^RAMIS(71,+RA713(0),"I"))
"RTN","RAO7MFN",87,0)
 .D MSGBODY(0) ;'0' indicates not a common
"RTN","RAO7MFN",88,0)
 .Q
"RTN","RAO7MFN",89,0)
 D MSGBODY("") ;determine the common flag on the fly.
"RTN","RAO7MFN",90,0)
 ;
"RTN","RAO7MFN",91,0)
 I 'RAENALL D
"RTN","RAO7MFN",92,0)
 . D MSG^XQOR("RA ORDERABLE ITEM UPDATE",RAVARBLE)
"RTN","RAO7MFN",93,0)
 . D PURGE^RAO7UTL
"RTN","RAO7MFN",94,0)
 . Q
"RTN","RAO7MFN",95,0)
 X:RAENALL RAINCR
"RTN","RAO7MFN",96,0)
 ;
"RTN","RAO7MFN",97,0)
 Q
"RTN","RAO7MFN",98,0)
ENALL ; Whole Rad/Nuc Med Procedure file update.  Called only when Rad/Nuc
"RTN","RAO7MFN",99,0)
 ; Med or OE/RR are being installed.
"RTN","RAO7MFN",100,0)
 QUIT  ;never execute this code disabled w/RA5P158
"RTN","RAO7MFN",101,0)
 Q:'$D(XPDNM)  ; quit if not KIDS, xists during pre/post inits
"RTN","RAO7MFN",102,0)
 ; & environment check routines.
"RTN","RAO7MFN",103,0)
 L +^RAMIS(71.3):300 D ^RACOMDEL L -^RAMIS(71.3)
"RTN","RAO7MFN",104,0)
 L +^RAMIS(71):300
"RTN","RAO7MFN",105,0)
 I '$T D  Q
"RTN","RAO7MFN",106,0)
 . N TXT S TXT(1)=" "
"RTN","RAO7MFN",107,0)
 . S TXT(2)="Another user is editing a record in the "
"RTN","RAO7MFN",108,0)
 . S TXT(2)=TXT(2)_$P($G(^DIC(71,0)),"^")
"RTN","RAO7MFN",109,0)
 . S TXT(3)="file.  Try again later!"
"RTN","RAO7MFN",110,0)
 . S XPDQUIT=1 D MES^XPDUTL(.TXT)
"RTN","RAO7MFN",111,0)
 . Q
"RTN","RAO7MFN",112,0)
 N RA,RACNT,RAECH,RAENALL,RAFILE,RAFNAME,RAFNUM,RAHLFS,RAINCR,RASTAT
"RTN","RAO7MFN",113,0)
 N RASUB,RATSTMP,RAVAR,RAXIT,RAY
"RTN","RAO7MFN",114,0)
 S (RA,RACNT)=0,RAENALL=1,RATSTMP=$$NOW^XLFDT(),RAINCR="S RACNT=RACNT+1"
"RTN","RAO7MFN",115,0)
 S RASUB="""RAO7""",RAVAR="^TMP("_RASUB_","_RATSTMP_","
"RTN","RAO7MFN",116,0)
 S RAVARBLE="^TMP("_RASUB_","_RATSTMP_")"
"RTN","RAO7MFN",117,0)
 D EN1^RAO7UTL ; sets up RAECH & RAHLFS
"RTN","RAO7MFN",118,0)
 S (RAFILE,RAFNUM)=71,RAFNAME=$P($G(^DIC(RAFNUM,0)),"^"),RASTAT="0^1"
"RTN","RAO7MFN",119,0)
 X RAINCR S @(RAVAR_RACNT_")")=$$MSH^RAO7UTL("MFN^M01") X RAINCR ;P18 event type
"RTN","RAO7MFN",120,0)
 D MFI^RAO7UTL("REP")
"RTN","RAO7MFN",121,0)
 F  S RA=$O(^RAMIS(71,RA)) Q:RA'>0  D  D PURGE1^RAO7UTL
"RTN","RAO7MFN",122,0)
 . S RA(0)=$G(^RAMIS(71,RA,0)),RA("I")=$G(^RAMIS(71,RA,"I"))
"RTN","RAO7MFN",123,0)
 . Q:$P(RA("I"),"^")]""&($P(RA("I"),"^")'>DT)  ; inactive date present
"RTN","RAO7MFN",124,0)
 . S RAY=RA_"^"_$P(RA(0),"^")_"^"_1 D PROC(RAENALL,RAFILE,RASTAT,RAY)
"RTN","RAO7MFN",125,0)
 . Q
"RTN","RAO7MFN",126,0)
 D EN^ORMFN(RAVARBLE) K @RAVARBLE,RAVARBLE
"RTN","RAO7MFN",127,0)
 L -^RAMIS(71) ; unlock whole file
"RTN","RAO7MFN",128,0)
PARM ;Send Div params for SUBMIT TO prompt and allowing BROAD procedures
"RTN","RAO7MFN",129,0)
 ;to OE3 so they can populate their OE/RR Parameter Instance file
"RTN","RAO7MFN",130,0)
 N DIK S DIK="^RA(79,",DIK(1)=".121^AC1" D ENALL^DIK
"RTN","RAO7MFN",131,0)
 N DIK S DIK="^RA(79,",DIK(1)=".17^AC" D ENALL^DIK
"RTN","RAO7MFN",132,0)
 Q
"RTN","RAO7MFN",133,0)
 ;
"RTN","RAO7MFN",134,0)
MSGBODY(RASEQNUM) ;Build the HL7 message to be broadcast to CPRS RA5P158
"RTN","RAO7MFN",135,0)
 ;if the common is question has a sequence number use it
"RTN","RAO7MFN",136,0)
 ;Input: RASEQNUM > 0 if a common procedure (w/seq. #)
"RTN","RAO7MFN",137,0)
 ;       RASEQNUM = 0 if not a common procedure (w/o seq. #)
"RTN","RAO7MFN",138,0)
 ;       RASEQNUM = "" if common procedure status is settled w/ old logic
"RTN","RAO7MFN",139,0)
 ;               
"RTN","RAO7MFN",140,0)
 S RACPT(0)=$$NAMCODE^RACPTMSC(+$P(RA71(0),"^",9),DT)
"RTN","RAO7MFN",141,0)
 S:RAFILE=71 RAIEN71=+RAY S:RAFILE=71.3 RAIEN71=+$P(RAY,"^",2)
"RTN","RAO7MFN",142,0)
 S RAXT71=$P(RA71(0),"^")
"RTN","RAO7MFN",143,0)
 S RAIMGAB=$P($G(^RA(79.2,+$P(RA71(0),"^",12),0)),"^",3)
"RTN","RAO7MFN",144,0)
 S RAPHYAP=$S($P(RA71(0),"^",11)="":"","Yy"[$P(RA71(0),"^",11):"Y",1:"N")
"RTN","RAO7MFN",145,0)
 S RACOST=$P(RA71(0),"^",10),RAPRCTY=$P(RA71(0),"^",6)
"RTN","RAO7MFN",146,0)
 S:RASEQNUM>0 RACMNOR="Y"
"RTN","RAO7MFN",147,0)
 S:RASEQNUM=0 RACMNOR="N"
"RTN","RAO7MFN",148,0)
 ;if this is not a case where the procedure for the common was not changed
"RTN","RAO7MFN",149,0)
 ;determine if it is to be a common from the old logic pre 158
"RTN","RAO7MFN",150,0)
 S:RASEQNUM="" RACMNOR=$S($P($G(RA713(0)),"^",4)]"":"Y",1:"N")
"RTN","RAO7MFN",151,0)
 ;
"RTN","RAO7MFN",152,0)
 ;determine CM associations for active & inactive procedures
"RTN","RAO7MFN",153,0)
 S RACMCODE=$$CMEDIA^RAO7UTL(RAIEN71,$P(RA71(0),U,6)) ;ien, proc. type
"RTN","RAO7MFN",154,0)
 S RAINACT=$S(RA71("I")]"":$$HLDATE^HLFNC(RA71("I"),"DT"),1:"")
"RTN","RAO7MFN",155,0)
 S @(RAVAR_RACNT_")")="MFE"_RAHLFS_RAMFE_RAHLFS_RAHLFS_RAINACT_RAHLFS
"RTN","RAO7MFN",156,0)
 S @(RAVAR_RACNT_")")=@(RAVAR_RACNT_")")_$P(RACPT(0),"^")
"RTN","RAO7MFN",157,0)
 S @(RAVAR_RACNT_")")=@(RAVAR_RACNT_")")_RAECH(1)
"RTN","RAO7MFN",158,0)
 S @(RAVAR_RACNT_")")=@(RAVAR_RACNT_")")_$P(RACPT(0),"^",2)
"RTN","RAO7MFN",159,0)
 S @(RAVAR_RACNT_")")=@(RAVAR_RACNT_")")_RAECH(1)_"CPT4"
"RTN","RAO7MFN",160,0)
 S @(RAVAR_RACNT_")")=@(RAVAR_RACNT_")")_RAECH(1)_RAIEN71
"RTN","RAO7MFN",161,0)
 S @(RAVAR_RACNT_")")=@(RAVAR_RACNT_")")_RAECH(1)_RAXT71
"RTN","RAO7MFN",162,0)
 S @(RAVAR_RACNT_")")=@(RAVAR_RACNT_")")_RAECH(1)_"99RAP"
"RTN","RAO7MFN",163,0)
 K RAINACT X RAINCR
"RTN","RAO7MFN",164,0)
 S @(RAVAR_RACNT_")")="ZRA"_RAHLFS_RAIMGAB_RAHLFS_RAPHYAP
"RTN","RAO7MFN",165,0)
 S @(RAVAR_RACNT_")")=@(RAVAR_RACNT_")")_RAHLFS_RACOST_RAHLFS
"RTN","RAO7MFN",166,0)
 S @(RAVAR_RACNT_")")=@(RAVAR_RACNT_")")_$G(RACMCODE)_RAHLFS
"RTN","RAO7MFN",167,0)
 S @(RAVAR_RACNT_")")=@(RAVAR_RACNT_")")_RACMNOR_RAHLFS
"RTN","RAO7MFN",168,0)
 S @(RAVAR_RACNT_")")=@(RAVAR_RACNT_")")_RAPRCTY_RAHLFS
"RTN","RAO7MFN",169,0)
 ; Check the synonym (1), message (3) and the Education Description
"RTN","RAO7MFN",170,0)
 ; "EDU" multiples for data
"RTN","RAO7MFN",171,0)
 N I,J,K,RAPMSG S RAPMSG=0
"RTN","RAO7MFN",172,0)
 F RAMULT="^RAMIS(71,"_RAIEN71_",1,","^RAMIS(71,"_RAIEN71_",3,","^RAMIS(71,"_RAIEN71_",""EDU""," D
"RTN","RAO7MFN",173,0)
 . I RAMULT=("^RAMIS(71,"_RAIEN71_",""EDU"","),($$UP^XLFSTR($P(RA71(0),"^",17))'="Y") Q  ; display Ed Descr not set to yes, quit
"RTN","RAO7MFN",174,0)
 . Q:'+$O(@(RAMULT_"0)"))  ; no data for 1 synonym, 3 message, "EDU" desc multiple
"RTN","RAO7MFN",175,0)
 . S (I,J)=0,K=""
"RTN","RAO7MFN",176,0)
 . F  S J=$O(@(RAMULT_J_")")) Q:J'>0  D
"RTN","RAO7MFN",177,0)
 .. S K=$G(@(RAMULT_J_",0)"))
"RTN","RAO7MFN",178,0)
 .. I RAMULT=("^RAMIS(71,"_RAIEN71_",1,") D  Q
"RTN","RAO7MFN",179,0)
 ... X RAINCR S I=I+1
"RTN","RAO7MFN",180,0)
 ... S @(RAVAR_RACNT_")")="ZSY"_RAHLFS_I_RAHLFS_$P(K,"^")
"RTN","RAO7MFN",181,0)
 ... Q
"RTN","RAO7MFN",182,0)
 .. I RAMULT=("^RAMIS(71,"_RAIEN71_",3,") D
"RTN","RAO7MFN",183,0)
 ... X RAINCR S I=I+1,RAPMSG=1
"RTN","RAO7MFN",184,0)
 ... S @(RAVAR_RACNT_")")="NTE"_RAHLFS_I_RAHLFS_RAHLFS_$P($G(^RAMIS(71.4,+K,0)),"^")
"RTN","RAO7MFN",185,0)
 ... Q
"RTN","RAO7MFN",186,0)
 .. I RAMULT=("^RAMIS(71,"_RAIEN71_",""EDU"",") D
"RTN","RAO7MFN",187,0)
 ... I RAPMSG D
"RTN","RAO7MFN",188,0)
 .... X RAINCR S I=I+1
"RTN","RAO7MFN",189,0)
 .... S @(RAVAR_RACNT_")")="NTE"_RAHLFS_I_RAHLFS_RAHLFS_" "
"RTN","RAO7MFN",190,0)
 .... S RAPMSG=0
"RTN","RAO7MFN",191,0)
 .... Q
"RTN","RAO7MFN",192,0)
 ... X RAINCR S I=I+1
"RTN","RAO7MFN",193,0)
 ... S @(RAVAR_RACNT_")")="NTE"_RAHLFS_I_RAHLFS_RAHLFS_K
"RTN","RAO7MFN",194,0)
 ... Q
"RTN","RAO7MFN",195,0)
 .. Q
"RTN","RAO7MFN",196,0)
 . Q
"RTN","RAO7MFN",197,0)
 Q
"RTN","RAO7MFN",198,0)
 ;
"RTN","RAO7RO1")
0^5^B8486631^B8274058
"RTN","RAO7RO1",1,0)
RAO7RO1 ;HISC/FPT-RAD/NM Error Messages ;23 Apr 2019 1:15 PM
"RTN","RAO7RO1",2,0)
 ;;5.0;Radiology/Nuclear Medicine;**2,75,86,158**;Mar 16, 1998;Build 2
"RTN","RAO7RO1",3,0)
 ;
"RTN","RAO7RO1",4,0)
EN1(RAERR) ; errors encountered with OE v3.0 back & frontdoor transmission
"RTN","RAO7RO1",5,0)
 S RAEMSG=$P($T(MSG+RAERR),";",4)
"RTN","RAO7RO1",6,0)
 I RAEMSG]"" Q RAEMSG
"RTN","RAO7RO1",7,0)
 Q "Error # "_RAERR_" does not exist"
"RTN","RAO7RO1",8,0)
 ;
"RTN","RAO7RO1",9,0)
 ;Note: Error code nine (9) disappears with the release of CPRS GUI V27. P86
"RTN","RAO7RO1",10,0)
 ;
"RTN","RAO7RO1",11,0)
MSG ; error messages
"RTN","RAO7RO1",12,0)
 ;;1;Missing/Invalid Order Control
"RTN","RAO7RO1",13,0)
 ;;2;Missing/Invalid Patient ID
"RTN","RAO7RO1",14,0)
 ;;3;Missing/Invalid Patient Location
"RTN","RAO7RO1",15,0)
 ;;4;Missing/Invalid User DUZ
"RTN","RAO7RO1",16,0)
 ;;5;Missing/Invalid REQUEST URGENCY
"RTN","RAO7RO1",17,0)
 ;;6;Missing/Invalid REQUESTING PHYSICIAN
"RTN","RAO7RO1",18,0)
 ;;7;Entered Date/Time is in the Future
"RTN","RAO7RO1",19,0)
 ;;8;Invalid Procedure, Inactive, no Imaging Type or no Procedure Type
"RTN","RAO7RO1",20,0)
 ;;9;Patient Class disagrees with Patient Location
"RTN","RAO7RO1",21,0)
 ;;10;Invalid ISOLATION PROCEDURES
"RTN","RAO7RO1",22,0)
 ;;11;Invalid MODIFIER(s)
"RTN","RAO7RO1",23,0)
 ;;12;Missing/Invalid IMAGING LOCATION or not the same as procedure's
"RTN","RAO7RO1",24,0)
 ;;13;Missing/Invalid MODE OF TRANSPORT
"RTN","RAO7RO1",25,0)
 ;;14;Missing/Invalid PREGNANT value
"RTN","RAO7RO1",26,0)
 ;;15;Missing/Invalid CLINICAL HISTORY FOR EXAM
"RTN","RAO7RO1",27,0)
 ;;16;Missing/Invalid Placer Number
"RTN","RAO7RO1",28,0)
 ;;17;Missing/Invalid OBX Value Type
"RTN","RAO7RO1",29,0)
 ;;18;Missing/Invalid CONTRACT/SHARING SOURCE
"RTN","RAO7RO1",30,0)
 ;;19;Missing/Invalid RESEARCH SOURCE
"RTN","RAO7RO1",31,0)
 ;;20;Missing/Invalid PRE-OP SCHEDULED DATE/TIME
"RTN","RAO7RO1",32,0)
 ;;21;Error Filing New Entry
"RTN","RAO7RO1",33,0)
 ;;22;Missing/Invalid Filler Number
"RTN","RAO7RO1",34,0)
 ;;23;Missing/Invalid Cancel or Hold Reason
"RTN","RAO7RO1",35,0)
 ;;24;
"RTN","RAO7RO1",36,0)
 ;;25;Current status will not permit request to be put in DISCONTINUED status
"RTN","RAO7RO1",37,0)
 ;;26;Error filing Placer Number
"RTN","RAO7RO1",38,0)
 ;;27;Missing/Invalid CATEGORY OF EXAM
"RTN","RAO7RO1",39,0)
 ;;28;Invalid REQUEST DATE (TIME optional)
"RTN","RAO7RO1",40,0)
 ;;29;CATEGORY OF EXAM cannot be Research AND Contract/Sharing
"RTN","RAO7RO1",41,0)
 ;;30;Error Filing New Entry in Request Status Times multiple
"RTN","RAO7RO1",42,0)
 ;;31;Imaging Type mismatch between the Procedure and Imaging Location
"RTN","RAO7RO1",43,0)
 ;;32;Parent procedure does not have descendents
"RTN","RAO7RO1",44,0)
 ;;33;Imaging Type mismatch between the Procedure and MODIFIER(s)
"RTN","RAO7RO1",45,0)
 ;;34;*** REMOVED W/RA*5.0*158 ***;Invalid MODFIERS(s) for a series procedure
"RTN","RAO7RO1",46,0)
 ;;35;FileMan rejected date/time
"RTN","RAO7RO1",47,0)
 ;;36;Invalid Approving Rad/Nuc Med physician
"RTN","RAO7RO1",48,0)
 ;;37;Rad/Nuc Med order not placed in a DISCONTINUED status
"RTN","RAO7RO1",49,0)
 ;;38;Missing REASON FOR STUDY value
"RTN","RAO7RO1",50,0)
 ;;39;Invalid REASON FOR STUDY value
"RTN","RAO7RON1")
0^6^B31114736^B30720358
"RTN","RAO7RON1",1,0)
RAO7RON1 ;HISC/GJC,FPT-Request message from OE/RR. (frontdoor) ;19 Jun 2019 1:36 PM
"RTN","RAO7RON1",2,0)
 ;;5.0;Radiology/Nuclear Medicine;**69,75,98,129,158**;Mar 16, 1998;Build 2
"RTN","RAO7RON1",3,0)
 ;
"RTN","RAO7RON1",4,0)
 ;------------------------- Variable List -------------------------------
"RTN","RAO7RON1",5,0)
 ; RADATA=HL7 data minus seg. hdr    RAHDR=Segment header
"RTN","RAO7RON1",6,0)
 ; RAHLFS="|"                        RAMSG=HL7 message passed in
"RTN","RAO7RON1",7,0)
 ; RAOBR12=danger code               RAOBR18=modifier
"RTN","RAO7RON1",8,0)
 ; RAOBR19=Img. Loc. pntr (79.1)     RAOBR30=trans. mode
"RTN","RAO7RON1",9,0)
 ; RAOBR31=Reason for Study          RAOBX2=format of observ. value
"RTN","RAO7RON1",10,0)
 ; RAOBR4=univ. trans. mode          RAOBX5=observ. value
"RTN","RAO7RON1",11,0)
 ; RAOBX3=observ. ID                 RAORC10=entered by (200
"RTN","RAO7RON1",12,0)
 ; RAORC1=order control              RAORC15=order effective D/T
"RTN","RAO7RON1",13,0)
 ; RAORC12=ordering provider (200)   RAORC2=placer order #_"^OR"
"RTN","RAO7RON1",14,0)
 ; RAORC16=order control reason      RAORC7=start dt/freq. of service
"RTN","RAO7RON1",15,0)
 ; RAORC3=filler order #_"^RA"       RAPID5=patient name (2)
"RTN","RAO7RON1",16,0)
 ; RAPID3=patient ID                 RAPV12=patient class
"RTN","RAO7RON1",17,0)
 ; RAPV119=visit #                   RASEG=message seg. including header
"RTN","RAO7RON1",18,0)
 ; RAPV13=patient location (44)
"RTN","RAO7RON1",19,0)
 ; ----------------------------------------------------------------------
"RTN","RAO7RON1",20,0)
 ;
"RTN","RAO7RON1",21,0)
OBR ; breakdown the 'OBR' segment
"RTN","RAO7RON1",22,0)
 S RAOBR4=$P(RADATA,RAHLFS,4)
"RTN","RAO7RON1",23,0)
 F I=1:1:$L(RAOBR4,RAECH(1)) S RAOBR4(I)=$P(RAOBR4,RAECH(1),I)
"RTN","RAO7RON1",24,0)
 I RAOBR4(1)'="" S RACPTIEN=+$O(^ICPT("B",RAOBR4(1),0)) S:'RACPTIEN RAERR=8 Q:RAERR  ;RA*5*69
"RTN","RAO7RON1",25,0)
 S RAERR=$$EN2^RAO7VLD(71,+RAOBR4(4),RAOBR4(5)) S:RAERR RAERR=8 Q:RAERR
"RTN","RAO7RON1",26,0)
 I $$UP^XLFSTR($P($G(^RAMIS(71,+RAOBR4(4),0)),"^",6))="P" D  Q:RAERR
"RTN","RAO7RON1",27,0)
 . S RAERR=$$EN6^RAO7VLD(+RAOBR4(4)) S:RAERR RAERR=32
"RTN","RAO7RON1",28,0)
 . Q
"RTN","RAO7RON1",29,0)
 I RAOBR4(1)'="" S:'$D(^RAMIS(71,"D",RACPTIEN,+RAOBR4(4))) RAERR=8 Q:RAERR  ;RA*5*69
"RTN","RAO7RON1",30,0)
 S RAOBR4(4,"I-TYPE")=+$P($G(^RAMIS(71,+RAOBR4(4),0)),"^",12)
"RTN","RAO7RON1",31,0)
 S RANEW(75.1,"+1,",2)=RAOBR4(4)
"RTN","RAO7RON1",32,0)
 S RAIT=$P(^RAMIS(71,+RAOBR4(4),0),U,12)
"RTN","RAO7RON1",33,0)
 S RAERR=$$EN3^RAO7VLD(79.2,RAIT) Q:RAERR
"RTN","RAO7RON1",34,0)
 S RANEW(75.1,"+1,",3)=RAIT
"RTN","RAO7RON1",35,0)
 S RAOBR12=$P(RADATA,RAHLFS,12)
"RTN","RAO7RON1",36,0)
 S RAOBR12=$S($E(RAOBR12)="":"n","yYiI"[$E(RAOBR12):"y",1:"n")
"RTN","RAO7RON1",37,0)
 S RAERR=$$EN1^RAO7VLD(75.1,24,"E",RAOBR12,"RASULT","") S:RAERR RAERR=10 Q:RAERR
"RTN","RAO7RON1",38,0)
 S RANEW(75.1,"+1,",24)=RAOBR12
"RTN","RAO7RON1",39,0)
 S RAOBR18=$P(RADATA,RAHLFS,18)
"RTN","RAO7RON1",40,0)
 N RAIMAG ;RASERIES removed w/RA5P158 by GJC
"RTN","RAO7RON1",41,0)
 F I=1:1:$L(RAOBR18,RAECH(2)) S:$L($P(RAOBR18,RAECH(2),I))>0 RAOBR18(I)=$P(RAOBR18,RAECH(2),I)
"RTN","RAO7RON1",42,0)
 S I=0 F  S I=$O(RAOBR18(I)) Q:I'>0  D  Q:RAERR
"RTN","RAO7RON1",43,0)
 . S RAMODIEN=+$O(^RAMIS(71.2,"B",RAOBR18(I),0))
"RTN","RAO7RON1",44,0)
 . S:'RAMODIEN RAERR=11 Q:RAERR
"RTN","RAO7RON1",45,0)
 . S RAIMAG=$P($G(^RAMIS(71,+RAOBR4(4),0)),U,12) ; type of imaging
"RTN","RAO7RON1",46,0)
 . S:'$D(^RAMIS(71.2,"AB",RAIMAG,RAMODIEN)) RAERR=33 Q:RAERR
"RTN","RAO7RON1",47,0)
 . ;S RASERIES=$S($P($G(^RAMIS(71,+RAOBR4(4),0)),"^",6)="S":1,1:0) RA5P158 by GJC
"RTN","RAO7RON1",48,0)
 . ;S:RASERIES&($P($G(^RAMIS(71.2,RAMODIEN,0)),U,2)]"") RAERR=34 Q:RAERR RA5P158 by GJC
"RTN","RAO7RON1",49,0)
 . S RAPLCHLD=RAPLCHLD+1
"RTN","RAO7RON1",50,0)
 . S RANEW(75.1125,"+"_RAPLCHLD_",+1,",.01)=RAMODIEN
"RTN","RAO7RON1",51,0)
 . Q
"RTN","RAO7RON1",52,0)
 S RAOBR19=$P(RADATA,RAHLFS,19),RAOBR19(1)=$P(RAOBR19,U,1)
"RTN","RAO7RON1",53,0)
 S RAOBR19(2)=$P(RAOBR19,U,2),RAOBR19(3)=+RAOBR19(1)
"RTN","RAO7RON1",54,0)
 I RAOBR19(3) D  Q:RAERR
"RTN","RAO7RON1",55,0)
 . S RAOBR19(3,"I-TYPE")=+$P($G(^RA(79.1,+RAOBR19(3),0)),"^",6)
"RTN","RAO7RON1",56,0)
 . I RAOBR4(4,"I-TYPE")'=RAOBR19(3,"I-TYPE") S RAERR=31
"RTN","RAO7RON1",57,0)
 . Q
"RTN","RAO7RON1",58,0)
 S RANEW(75.1,"+1,",20)=$S(RAOBR19(3)>0:RAOBR19(3),1:"")
"RTN","RAO7RON1",59,0)
 S X=$P(RADATA,RAHLFS,30)
"RTN","RAO7RON1",60,0)
 S RAOBR30=$S(X="CART":"s",X="PORT":"p",X="WALK":"a",X="WHLC":"w",1:"")
"RTN","RAO7RON1",61,0)
 I RAOBR30']"" S RAERR=13
"RTN","RAO7RON1",62,0)
 S:'RAERR RAERR=$$EN1^RAO7VLD(75.1,19,"E",RAOBR30,"RASULT","")
"RTN","RAO7RON1",63,0)
 S:RAERR RAERR=13 Q:RAERR
"RTN","RAO7RON1",64,0)
 S RANEW(75.1,"+1,",19)=RAOBR30
"RTN","RAO7RON1",65,0)
 ;--- Reason for Study P75 ---
"RTN","RAO7RON1",66,0)
 ;CPRS will not pass 'Reason for Study' data until OR*3.0*243
"RTN","RAO7RON1",67,0)
 ;(GUI CPRS V27) is released. Define a default Reason for Study 
"RTN","RAO7RON1",68,0)
 I '$$PATCH^XPDUTL("OR*3.0*243") S RAOBR31="See Clinical History:"
"RTN","RAO7RON1",69,0)
 E  D  Q:RAERR  ;CPRS V27 is installed
"RTN","RAO7RON1",70,0)
 .S RAOBR31=$P($P(RADATA,RAHLFS,31),RAECH(1),2)
"RTN","RAO7RON1",71,0)
 .S:RAOBR31="" RAERR=38 Q:RAERR
"RTN","RAO7RON1",72,0)
 .S RAERR=$$EN1^RAO7VLD(75.1,1.1,"E",RAOBR31,"RASULT","")
"RTN","RAO7RON1",73,0)
 .S:RAERR RAERR=39
"RTN","RAO7RON1",74,0)
 .Q
"RTN","RAO7RON1",75,0)
 D CCS(.RAOBR31) ;P129 - strip CCs
"RTN","RAO7RON1",76,0)
 S:'RAERR RANEW(75.1,"+1,",1.1)=RAOBR31
"RTN","RAO7RON1",77,0)
 K RAOBR31
"RTN","RAO7RON1",78,0)
 Q
"RTN","RAO7RON1",79,0)
OBX ; breakdown the 'OBX' segment
"RTN","RAO7RON1",80,0)
 S RAOBX2=$P(RADATA,RAHLFS,2)
"RTN","RAO7RON1",81,0)
 S RAERR=$S(RAOBX2="TX":0,RAOBX2="CE":0,RAOBX2="TS":0,1:1) Q:RAERR=17
"RTN","RAO7RON1",82,0)
 S RAOBX3=$P(RADATA,RAHLFS,3)
"RTN","RAO7RON1",83,0)
 S RAOBX5=$P(RADATA,RAHLFS,5)
"RTN","RAO7RON1",84,0)
 F I=1:1:$L(RAOBX3,RAECH(1)) S RAOBX3(I)=$P(RAOBX3,RAECH(1),I)
"RTN","RAO7RON1",85,0)
 S X=RAOBX3(2) D UPPER^RAUTL4 S RAOBX3(2)=Y
"RTN","RAO7RON1",86,0)
 ;
"RTN","RAO7RON1",87,0)
 ;P75 check to see if CLINICAL HISTORY data is passed. If data is passed, and not yet
"RTN","RAO7RON1",88,0)
 ;determined if valid continue to check for validity until:
"RTN","RAO7RON1",89,0)
 ;1-valid data is found
"RTN","RAO7RON1",90,0)
 ;2-no data left to validate
"RTN","RAO7RON1",91,0)
 I RAOBX3(1)=2000.02 D
"RTN","RAO7RON1",92,0)
 .;check if a null value is sent for CLINICAL HISTORY which is
"RTN","RAO7RON1",93,0)
 .;possible if the CPRS user does not enter a CLINICAL HISTORY
"RTN","RAO7RON1",94,0)
 .I RAOBX5="",$P(RACLIN,U)'=1 Q
"RTN","RAO7RON1",95,0)
 .;now if data was sent (RAOBX5'="") set the data received from CPRS flag
"RTN","RAO7RON1",96,0)
 .S $P(RACLIN,U)=1
"RTN","RAO7RON1",97,0)
 .;now that we know the CPRS user intended to send CLINICAL HISTORY data
"RTN","RAO7RON1",98,0)
 .;radiology has to validate the format of that data. $$EN4^RAO7VLD(str)
"RTN","RAO7RON1",99,0)
 .;returns 1 if the data passed in was valid, else 0. Once we establish
"RTN","RAO7RON1",100,0)
 .;that valid data has been sent, all subsequent data is accepted, valid
"RTN","RAO7RON1",101,0)
 .;or not.
"RTN","RAO7RON1",102,0)
 .S:$$EN4^RAO7VLD(RAOBX5) $P(RACLIN,U,2)=1
"RTN","RAO7RON1",103,0)
 .;now, if the current character string or any other character string
"RTN","RAO7RON1",104,0)
 .;of data representing the CLINICAL HISTORY has been accepted as valid
"RTN","RAO7RON1",105,0)
 .;($P(RACLIN,U,2)=1) save the character string
"RTN","RAO7RON1",106,0)
 .I $P(RACLIN,U,2)=1 D
"RTN","RAO7RON1",107,0)
 ..S RAWP=RAWP+1 D CCS(.RAOBX5) ;P129
"RTN","RAO7RON1",108,0)
 ..S ^TMP("RAWP",$J,RAWP)=RAOBX5
"RTN","RAO7RON1",109,0)
 ..Q
"RTN","RAO7RON1",110,0)
 ;
"RTN","RAO7RON1",111,0)
 I RAOBX3(1)=2000.33 D  Q:RAERR
"RTN","RAO7RON1",112,0)
 .S RAERR=$$EN1^RAO7VLD(75.1,13,"E",RAOBX5,"RASULT","") S:RAERR RAERR=14 Q:RAERR
"RTN","RAO7RON1",113,0)
 .S RAPREG=$E(RAOBX5),RAPREG=$S(RAPREG="N"!(RAPREG="n"):"n",RAPREG="Y"!(RAPREG="y"):"y",1:"u")
"RTN","RAO7RON1",114,0)
 .S RANEW(75.1,"+1,",13)=RAPREG
"RTN","RAO7RON1",115,0)
 I RAOBX3(1)=34!(RAOBX2="CE") D  Q:RAERR
"RTN","RAO7RON1",116,0)
 .S RAERR=$$EN2^RAO7VLD(34,$P(RAOBX5,RAECH(1)),$P(RAOBX5,RAECH(1),2)) Q:RAERR
"RTN","RAO7RON1",117,0)
 .S RANEW(75.1,"+1,",9)=+RAOBX5
"RTN","RAO7RON1",118,0)
 I RAOBX3(2)["RESEARCH" D  S:RAERR RAERR=18 Q:RAERR
"RTN","RAO7RON1",119,0)
 .S RAERR=$$EN1^RAO7VLD(75.1,9.5,"E",RAOBX5,"RASULT","") S:RAERR RAERR=19 Q:RAERR
"RTN","RAO7RON1",120,0)
 .S RANEW(75.1,"+1,",9.5)=RAOBX5
"RTN","RAO7RON1",121,0)
 I RAOBX3(2)["PRE-OP" D  Q:RAERR
"RTN","RAO7RON1",122,0)
 .S RAOBX5=$$FMDATE^HLFNC(RAOBX5)
"RTN","RAO7RON1",123,0)
 .S RAERR=$$EN1^RAO7VLD(75.1,12,"E",RAOBX5,"RASULT","") S:RAERR RAERR=20 Q:RAERR
"RTN","RAO7RON1",124,0)
 .S RANEW(75.1,"+1,",12)=RAOBX5
"RTN","RAO7RON1",125,0)
 I $D(RANEW(75.1,"+1,",9))&($D(RANEW(75.1,"+1,",9.5))) S RAERR=29
"RTN","RAO7RON1",126,0)
 Q
"RTN","RAO7RON1",127,0)
 ;
"RTN","RAO7RON1",128,0)
CCS(RAX) ;does a string have unprintable 
"RTN","RAO7RON1",129,0)
 ; control characters? If 'yes' strip them out.
"RTN","RAO7RON1",130,0)
 ;
"RTN","RAO7RON1",131,0)
 ;'RAX' the string checked for CCs (by reference)
"RTN","RAO7RON1",132,0)
 ;
"RTN","RAO7RON1",133,0)
 I RAX?.e1.c.e D  Q
"RTN","RAO7RON1",134,0)
 .D SCC ;'RAX' is changed!
"RTN","RAO7RON1",135,0)
 .Q
"RTN","RAO7RON1",136,0)
 Q
"RTN","RAO7RON1",137,0)
 ;
"RTN","RAO7RON1",138,0)
SCC ;strip out unprintable CCs.
"RTN","RAO7RON1",139,0)
 ;
"RTN","RAO7RON1",140,0)
 ;'RAX' the string w/unprintable CCs
"RTN","RAO7RON1",141,0)
 ;'RAE' is each character of 'RAX'
"RTN","RAO7RON1",142,0)
 K RAE,RAI S RAXX=""
"RTN","RAO7RON1",143,0)
 F RAI=1:1:$L(RAX) D
"RTN","RAO7RON1",144,0)
 .S RAE=$E(RAX,RAI)
"RTN","RAO7RON1",145,0)
 .S:RAE'?1C RAXX=RAXX_RAE K RAE
"RTN","RAO7RON1",146,0)
 .Q
"RTN","RAO7RON1",147,0)
 S RAX=RAXX
"RTN","RAO7RON1",148,0)
 K RAI,RAXX
"RTN","RAO7RON1",149,0)
 Q
"RTN","RAO7RON1",150,0)
 ;
"RTN","RAUTL17")
0^2^B18028998^B16524260
"RTN","RAUTL17",1,0)
RAUTL17 ;HISC/DAD-RAD/NUC MED COMMON PROCEDURE FILE (#71.3) UTILITIES ;19 Apr 2019 3:32 PM
"RTN","RAUTL17",2,0)
 ;;5.0;Radiology/Nuclear Medicine;**158**;Mar 16, 1998;Build 2
"RTN","RAUTL17",3,0)
EN1 ; *** Get an imaging type
"RTN","RAUTL17",4,0)
 ; Input:  None
"RTN","RAUTL17",5,0)
 ; Output: The variable 'Y' will be one of the following
"RTN","RAUTL17",6,0)
 ;         -1 = No imaging type selected (up-arrow, time-out, etc.)
"RTN","RAUTL17",7,0)
 ;          0 = No active imaging types found
"RTN","RAUTL17",8,0)
 ;        IEN = IMAGING TYPE file (#79.2) IEN
"RTN","RAUTL17",9,0)
 N DIC,RAI,RAIMGTYI,X
"RTN","RAUTL17",10,0)
 ; *** Get active imaging types (must have at least one imaging
"RTN","RAUTL17",11,0)
 ;     location and at least one procedure to be active)
"RTN","RAUTL17",12,0)
 S (RAI,RAIMGTYI)=0
"RTN","RAUTL17",13,0)
 F  S RAIMGTYI=$O(^RA(79.2,RAIMGTYI)) Q:RAIMGTYI'>0  D
"RTN","RAUTL17",14,0)
 . I $O(^RAMIS(71,"AIMG",RAIMGTYI,0)),$O(^RA(79.1,"BIMG",RAIMGTYI,0)) D
"RTN","RAUTL17",15,0)
 .. S RAIMGTYI(RAIMGTYI)=1
"RTN","RAUTL17",16,0)
 .. Q
"RTN","RAUTL17",17,0)
 . Q
"RTN","RAUTL17",18,0)
 S RAIMGTYI=+$O(RAIMGTYI(0))
"RTN","RAUTL17",19,0)
 ; *** No active imaging types
"RTN","RAUTL17",20,0)
 I RAIMGTYI'>0 D  S Y=0 G EN1EXIT
"RTN","RAUTL17",21,0)
 . W !!?5,"No 'active' imaging types were found.  For an imaging"
"RTN","RAUTL17",22,0)
 . W !?5,"type to be active it must be assigned to at least one"
"RTN","RAUTL17",23,0)
 . W !?5,"imaging location and at least one procedure."
"RTN","RAUTL17",24,0)
 . Q
"RTN","RAUTL17",25,0)
 ; *** Only one active imaging type
"RTN","RAUTL17",26,0)
 I $O(RAIMGTYI(RAIMGTYI))'>0 S Y=RAIMGTYI G EN1EXIT
"RTN","RAUTL17",27,0)
 ; *** display the imaging types available for selection
"RTN","RAUTL17",28,0)
 W !,"Select one of the following imaging types:"
"RTN","RAUTL17",29,0)
 F  S RAI=$O(RAIMGTYI(RAI)) Q:RAI'>0  W !?3,$$GET1^DIQ(79.2,RAI_",",.01)
"RTN","RAUTL17",30,0)
 ; *** Prompt for active imaging type
"RTN","RAUTL17",31,0)
 K DIC S DIC="^RA(79.2,",DIC(0)="AEMQ",DIC("A")="Select IMAGING TYPE: "
"RTN","RAUTL17",32,0)
 S DIC("S")="I $G(RAIMGTYI(+Y))"
"RTN","RAUTL17",33,0)
 W ! D ^DIC S Y=+Y
"RTN","RAUTL17",34,0)
EN1EXIT Q
"RTN","RAUTL17",35,0)
 ;
"RTN","RAUTL17",36,0)
EN2(RAIMGTYI,RA71) ; *** Common procedure file error check
"RTN","RAUTL17",37,0)
 ; Input:  RAIMGTYI = IMAGING TYPE file (#79.2) IEN
"RTN","RAUTL17",38,0)
 ;         RA71 = PROCEDURE file (#71) IEN (Optional)
"RTN","RAUTL17",39,0)
 ; Output: Number_of_Common_Proccedures ^ $S(Duplicate_Sequence#:1,1:0)
"RTN","RAUTL17",40,0)
 ;
"RTN","RAUTL17",41,0)
 N RA713,RACNT,RAD0,RADUP,RASEQ
"RTN","RAUTL17",42,0)
 S (RASEQ,RACNT,RADUP)=0
"RTN","RAUTL17",43,0)
 F  S RASEQ=$O(^RAMIS(71.3,"AA",RAIMGTYI,RASEQ)) Q:RASEQ'>0  D
"RTN","RAUTL17",44,0)
 . S RA713=0
"RTN","RAUTL17",45,0)
 . F  S RA713=$O(^RAMIS(71.3,"AA",RAIMGTYI,RASEQ,RA713)) Q:RA713'>0  D
"RTN","RAUTL17",46,0)
 .. S RACNT=RACNT+1 I $G(RASEQ(RASEQ)) S RADUP=1
"RTN","RAUTL17",47,0)
 .. S RASEQ(RASEQ)=$S($G(RASEQ(RASEQ)):RASEQ(RASEQ)_U,1:"")_RA713
"RTN","RAUTL17",48,0)
 .. Q
"RTN","RAUTL17",49,0)
 . Q
"RTN","RAUTL17",50,0)
 I $G(RA71),RADUP'>0 D
"RTN","RAUTL17",51,0)
 . S RA713=0 K RASEQ
"RTN","RAUTL17",52,0)
 . F  S RA713=$O(^RAMIS(71.3,"B",RA71,RA713)) Q:RA713'>0  D
"RTN","RAUTL17",53,0)
 .. S RA713(0)=$G(^RAMIS(71.3,RA713,0)),RASEQ=$P(RA713(0),U,4)
"RTN","RAUTL17",54,0)
 .. I RASEQ S RASEQ(RASEQ)=""
"RTN","RAUTL17",55,0)
 .. Q
"RTN","RAUTL17",56,0)
 . S RASEQ=0
"RTN","RAUTL17",57,0)
 . F  S RASEQ=$O(RASEQ(RASEQ)) Q:RASEQ'>0!RADUP  D
"RTN","RAUTL17",58,0)
 .. I $O(^RAMIS(71.3,"AA",RAIMGTYI,RASEQ,0)) S RADUP=1
"RTN","RAUTL17",59,0)
 .. Q
"RTN","RAUTL17",60,0)
 . Q
"RTN","RAUTL17",61,0)
 Q RACNT_U_RADUP
"RTN","RAUTL17",62,0)
 ;
"RTN","RAUTL17",63,0)
EN3(D0) ; *** imaging type of a procedure
"RTN","RAUTL17",64,0)
 ; Input:  RAD/NUC MED PROCEDURE file (#71) IEN
"RTN","RAUTL17",65,0)
 ; Output: IMAGING TYPE file (#79.2) IEN
"RTN","RAUTL17",66,0)
 Q +$P($G(^RAMIS(71,+D0,0)),U,12)
"RTN","RAUTL17",67,0)
 ;
"RTN","RAUTL17",68,0)
EN5(RAD0,RAIMGTYI,RASEQ,SK) ; *** Update ^RAMIS(71.3,"AA", xref
"RTN","RAUTL17",69,0)
 ; Input:  RAD0  = RAD/NUC MED COMMON PROCEDURE file (#71.3) IEN
"RTN","RAUTL17",70,0)
 ;         RAPRC = PROCEDURE file (#71) IEN
"RTN","RAUTL17",71,0)
 ;         RASEQ = Sequence number
"RTN","RAUTL17",72,0)
 ;         SK    = Set/Kill flag: $S(SK="S":Set_xref,SK="K":Kill_xref)
"RTN","RAUTL17",73,0)
 I (RASEQ'>0)!(RAIMGTYI'>0) Q
"RTN","RAUTL17",74,0)
 I SK="S" S ^RAMIS(71.3,"AA",RAIMGTYI,RASEQ,RAD0)=""
"RTN","RAUTL17",75,0)
 I SK="K" K ^RAMIS(71.3,"AA",RAIMGTYI,RASEQ,RAD0)
"RTN","RAUTL17",76,0)
 Q
"RTN","RAUTL17",77,0)
 ;
"RTN","RAUTL17",78,0)
EN6(RAIMGTYI,RA71) ; *** Common procedure file error messages
"RTN","RAUTL17",79,0)
 ;Invoked when .01 field of file 71.3 is edited, allowing the user
"RTN","RAUTL17",80,0)
 ;to change the procedure that the .01 field points to
"RTN","RAUTL17",81,0)
 ; Input:  RAIMGTYI = IMAGING TYPE file (#79.2) IEN
"RTN","RAUTL17",82,0)
 ;         RA71 = PROCEDURE file (#71) IEN
"RTN","RAUTL17",83,0)
 N RA,RACNT,RADUP
"RTN","RAUTL17",84,0)
 S RA=$$EN2(RAIMGTYI,RA71),RACNT=$P(RA,U),RADUP=$P(RA,U,2)
"RTN","RAUTL17",85,0)
 I RACNT>40!RADUP D  K X
"RTN","RAUTL17",86,0)
 . N RATXT
"RTN","RAUTL17",87,0)
 . S RATXT(1)=""
"RTN","RAUTL17",88,0)
 . S RATXT(2)="Changing/ADDING this procedure would cause the following"
"RTN","RAUTL17",89,0)
 . S RATXT(3)="problem(s) in the Rad/Nuc Med Common Procedure file:"
"RTN","RAUTL17",90,0)
 . S RATXT(4)=""
"RTN","RAUTL17",91,0)
 . I RACNT>40 S RATXT(10)="   More than 40 common procedures with the same imaging type."
"RTN","RAUTL17",92,0)
 . I RADUP S RATXT(20)="   Two or more procedures with the same sequence number."
"RTN","RAUTL17",93,0)
 . S RATXT(30)=""
"RTN","RAUTL17",94,0)
 . S RATXT(31)="In order to change this procedure you must first"
"RTN","RAUTL17",95,0)
 . S RATXT(32)="inactivate it in the Rad/Nuc Med Common Procedure file."
"RTN","RAUTL17",96,0)
 . S RATXT(33)=""
"RTN","RAUTL17",97,0)
 . D EN^DDIOL(.RATXT)
"RTN","RAUTL17",98,0)
 . Q
"RTN","RAUTL17",99,0)
 Q
"RTN","RAUTL17",100,0)
DESC(RAD0,RAY) ; Detemine if a procedure qualifies as a descendent for this
"RTN","RAUTL17",101,0)
 ; parent procedure.  Descendent must be either a detailed or series
"RTN","RAUTL17",102,0)
 ; type procedure, must be of same imaging type of the parent, and must
"RTN","RAUTL17",103,0)
 ; not be inactive.  Called from ^DD(71.05,.01,0)
"RTN","RAUTL17",104,0)
 ; 'RAD0' ien of parent procedure in file 71
"RTN","RAUTL17",105,0)
 ; 'RAY'  ien of pointed to procedure in file 71
"RTN","RAUTL17",106,0)
 ; Returns: 'RA' i.e, 0:invalid procedure, 1:valid procedure
"RTN","RAUTL17",107,0)
 ; RAPARNT: zero node of parent procedure
"RTN","RAUTL17",108,0)
 ; RAPARNT(12): i-type of parent procedure
"RTN","RAUTL17",109,0)
 ; RADESC     : zero node of descendent procedure
"RTN","RAUTL17",110,0)
 ; RADESC("I"): inactivation date (if any) of descendent
"RTN","RAUTL17",111,0)
 ; RADESC(6)  : procedure type of descendent
"RTN","RAUTL17",112,0)
 ; RADESC(12) : i-type of descendent procedure
"RTN","RAUTL17",113,0)
 Q:RAD0'>0!(RAY'>0) 0
"RTN","RAUTL17",114,0)
 Q:'$D(^RAMIS(71,RAD0,0))!('$D(^RAMIS(71,RAY,0))) 0
"RTN","RAUTL17",115,0)
 N RA,RAI,RADESC,RAPARNT S RA=0
"RTN","RAUTL17",116,0)
 S RAPARNT=$G(^RAMIS(71,RAD0,0)),RAPARNT(12)=+$P(RAPARNT,U,12)
"RTN","RAUTL17",117,0)
 S RADESC=$G(^RAMIS(71,RAY,0)),RADESC(6)=$P(RADESC,U,6)
"RTN","RAUTL17",118,0)
 S RADESC(12)=$P(RADESC,U,12)
"RTN","RAUTL17",119,0)
 S RADESC("I")=+$G(^RAMIS(71,RAY,"I"))
"RTN","RAUTL17",120,0)
 S RAI=$S(RADESC("I")=0:1,RADESC("I")>DT:1,1:0)
"RTN","RAUTL17",121,0)
 I RADESC(12)=RAPARNT(12),("^D^S^"[(U_RADESC(6)_U)),(RAI) S RA=1
"RTN","RAUTL17",122,0)
 Q RA
"RTN","RAUTL17",123,0)
 ;
"RTN","RAUTL17",124,0)
EN713(RAX) ;is this procedure from file 71 already a common procedure?
"RTN","RAUTL17",125,0)
 ;RAX = PROCEDURE [.01] field value from 71.3 (ptr to file 71)
"RTN","RAUTL17",126,0)
 ;
"RTN","RAUTL17",127,0)
 ;returns 1 if the PROCEDURE field value is not a duplicate, else 0
"RTN","RAUTL17",128,0)
 Q:+$O(^RAMIS(71.3,"B",+RAX,0))=0 1
"RTN","RAUTL17",129,0)
 D EN^DDIOL("`"_$P($G(^RAMIS(71,+RAX,0)),"^")_"' already exists as a Common Procedure.")
"RTN","RAUTL17",130,0)
 Q 0
"RTN","RAUTL17",131,0)
 ;
"VER")
8.0^22.2
"^DD",71.3,71.3,.01,0)
PROCEDURE^R*P71'X^RAMIS(71,^0;1^S DIC("S")="I $$EN1^RADD2(Y)" D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X D:$D(X) EN6^RAUTL17($P($G(^RAMIS(71,X,0)),U,12),X)
"^DD",71.3,71.3,.01,1,0)
^.1
"^DD",71.3,71.3,.01,1,1,0)
71.3^B
"^DD",71.3,71.3,.01,1,1,1)
S ^RAMIS(71.3,"B",$E(X,1,30),DA)=""
"^DD",71.3,71.3,.01,1,1,2)
K ^RAMIS(71.3,"B",$E(X,1,30),DA)
"^DD",71.3,71.3,.01,1,1,"%D",0)
^^1^1^2940518^
"^DD",71.3,71.3,.01,1,1,"%D",1,0)
     Regular 'B' cross reference assigned by FileMan.
"^DD",71.3,71.3,.01,1,2,0)
71.3^AD^MUMPS
"^DD",71.3,71.3,.01,1,2,1)
S:$P(^RAMIS(71.3,DA,0),U,3)]"" ^RAMIS(71.3,"AC",$P(^(0),U,3),$E(X,1,30),DA)=""
"^DD",71.3,71.3,.01,1,2,2)
K:$P(^RAMIS(71.3,DA,0),U,3)]"" ^RAMIS(71.3,"AC",$P(^(0),U,3),$E(X,1,30),DA)
"^DD",71.3,71.3,.01,1,2,"%D",0)
^^1^1^2940518^
"^DD",71.3,71.3,.01,1,2,"%D",1,0)
Used to look-up common procedures by procedure name.
"^DD",71.3,71.3,.01,1,3,0)
71.3^AE^MUMPS
"^DD",71.3,71.3,.01,1,3,1)
D EN5^RAUTL17(DA,$$EN3^RAUTL17(X),$P($G(^RAMIS(71.3,DA,0)),U,4),"S")
"^DD",71.3,71.3,.01,1,3,2)
D EN5^RAUTL17(DA,$$EN3^RAUTL17(X),$P($G(^RAMIS(71.3,DA,0)),U,4),"K")
"^DD",71.3,71.3,.01,1,3,3)
Do not delete.
"^DD",71.3,71.3,.01,1,3,"%D",0)
^^3^3^2941011^
"^DD",71.3,71.3,.01,1,3,"%D",1,0)
This cross-reference updates the 'AA' cross-reference when the procedure
"^DD",71.3,71.3,.01,1,3,"%D",2,0)
changes.  It sets/kills the following node:
"^DD",71.3,71.3,.01,1,3,"%D",3,0)
^RAMIS(71.3,"AA",Imaging_Type_IEN,Sequence_Number,DA)
"^DD",71.3,71.3,.01,1,3,"DT")
2941011
"^DD",71.3,71.3,.01,3)
Enter a procedure name.
"^DD",71.3,71.3,.01,12)
Only active of like i-type non-parents -or- active of like i-type parents with one or more descendants
"^DD",71.3,71.3,.01,12.1)
S DIC("S")="I $$EN1^RADD2(Y)"
"^DD",71.3,71.3,.01,21,0)
^^2^2^2950720^^
"^DD",71.3,71.3,.01,21,1,0)
This field is an "active" entry from your RAD/NUC MED PROCEDURES file
"^DD",71.3,71.3,.01,21,2,0)
(#71).
"^DD",71.3,71.3,.01,"DT")
3190418
"^DD",71.3,71.3,.01,"LAYGO",1,0)
I $$EN713^RAUTL17(X)
"BLD",10795,6)
^142
**END**
**END**

