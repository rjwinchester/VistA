Released RA*5*156 SEQ #139
Extracted from mail message
**KIDS**:RA*5.0*156^

**INSTALL NAME**
RA*5.0*156
"BLD",10702,0)
RA*5.0*156^RADIOLOGY/NUCLEAR MEDICINE^0^3190315^y
"BLD",10702,1,0)
^^3^3^3190227^
"BLD",10702,1,1,0)
Patch one hundred and fifty-six for the VistA Radiology/Nuclear
"BLD",10702,1,2,0)
Medicine 5.0 application. Please review FORUM's Patch Module description
"BLD",10702,1,3,0)
and installation instructions for RA*5.0*156 before installing this patch.
"BLD",10702,4,0)
^9.64PA^^
"BLD",10702,6.3)
1
"BLD",10702,"KRN",0)
^9.67PA^1.5^24
"BLD",10702,"KRN",.4,0)
.4
"BLD",10702,"KRN",.401,0)
.401
"BLD",10702,"KRN",.402,0)
.402
"BLD",10702,"KRN",.402,"NM",0)
^9.68A^1^1
"BLD",10702,"KRN",.402,"NM",1,0)
RA EXAM EDIT    FILE #70^70^0
"BLD",10702,"KRN",.402,"NM","B","RA EXAM EDIT    FILE #70",1)

"BLD",10702,"KRN",.403,0)
.403
"BLD",10702,"KRN",.5,0)
.5
"BLD",10702,"KRN",.84,0)
.84
"BLD",10702,"KRN",1.5,0)
1.5
"BLD",10702,"KRN",1.6,0)
1.6
"BLD",10702,"KRN",1.61,0)
1.61
"BLD",10702,"KRN",1.62,0)
1.62
"BLD",10702,"KRN",3.6,0)
3.6
"BLD",10702,"KRN",3.8,0)
3.8
"BLD",10702,"KRN",9.2,0)
9.2
"BLD",10702,"KRN",9.8,0)
9.8
"BLD",10702,"KRN",9.8,"NM",0)
^9.68A^4^4
"BLD",10702,"KRN",9.8,"NM",1,0)
RAUTL8^^0^B72237581
"BLD",10702,"KRN",9.8,"NM",2,0)
RAPXRM^^0^B18914362
"BLD",10702,"KRN",9.8,"NM",3,0)
RAO7PC1^^0^B34284367
"BLD",10702,"KRN",9.8,"NM",4,0)
RAHLRS^^0^B29109552
"BLD",10702,"KRN",9.8,"NM","B","RAHLRS",4)

"BLD",10702,"KRN",9.8,"NM","B","RAO7PC1",3)

"BLD",10702,"KRN",9.8,"NM","B","RAPXRM",2)

"BLD",10702,"KRN",9.8,"NM","B","RAUTL8",1)

"BLD",10702,"KRN",19,0)
19
"BLD",10702,"KRN",19.1,0)
19.1
"BLD",10702,"KRN",101,0)
101
"BLD",10702,"KRN",409.61,0)
409.61
"BLD",10702,"KRN",771,0)
771
"BLD",10702,"KRN",779.2,0)
779.2
"BLD",10702,"KRN",870,0)
870
"BLD",10702,"KRN",8989.51,0)
8989.51
"BLD",10702,"KRN",8989.52,0)
8989.52
"BLD",10702,"KRN",8994,0)
8994
"BLD",10702,"KRN","B",.4,.4)

"BLD",10702,"KRN","B",.401,.401)

"BLD",10702,"KRN","B",.402,.402)

"BLD",10702,"KRN","B",.403,.403)

"BLD",10702,"KRN","B",.5,.5)

"BLD",10702,"KRN","B",.84,.84)

"BLD",10702,"KRN","B",1.5,1.5)

"BLD",10702,"KRN","B",1.6,1.6)

"BLD",10702,"KRN","B",1.61,1.61)

"BLD",10702,"KRN","B",1.62,1.62)

"BLD",10702,"KRN","B",3.6,3.6)

"BLD",10702,"KRN","B",3.8,3.8)

"BLD",10702,"KRN","B",9.2,9.2)

"BLD",10702,"KRN","B",9.8,9.8)

"BLD",10702,"KRN","B",19,19)

"BLD",10702,"KRN","B",19.1,19.1)

"BLD",10702,"KRN","B",101,101)

"BLD",10702,"KRN","B",409.61,409.61)

"BLD",10702,"KRN","B",771,771)

"BLD",10702,"KRN","B",779.2,779.2)

"BLD",10702,"KRN","B",870,870)

"BLD",10702,"KRN","B",8989.51,8989.51)

"BLD",10702,"KRN","B",8989.52,8989.52)

"BLD",10702,"KRN","B",8994,8994)

"BLD",10702,"QDEF")
^^^^^^^^^^YES
"BLD",10702,"QUES",0)
^9.62^^
"BLD",10702,"REQB",0)
^9.611^4^4
"BLD",10702,"REQB",1,0)
RA*5.0*137^2
"BLD",10702,"REQB",2,0)
RA*5.0*124^2
"BLD",10702,"REQB",3,0)
RA*5.0*153^2
"BLD",10702,"REQB",4,0)
RA*5.0*143^2
"BLD",10702,"REQB","B","RA*5.0*124",2)

"BLD",10702,"REQB","B","RA*5.0*137",1)

"BLD",10702,"REQB","B","RA*5.0*143",4)

"BLD",10702,"REQB","B","RA*5.0*153",3)

"KRN",.402,235,-1)
0^1
"KRN",.402,235,0)
RA EXAM EDIT^3190228.1029^^70^^^3190301
"KRN",.402,235,"%D",0)
^.4021^1^1^3090722^^^^
"KRN",.402,235,"%D",1,0)
This template is used to edit exams.
"KRN",.402,235,"DIAB",1,2,70.03,9)
PRINCIPAL CLINIC;REQ
"KRN",.402,235,"DIAB",1,2,70.03,13)
NUCLEAR MED DATA:
"KRN",.402,235,"DIAB",1,4,70.21,5)
DOSE ADMINISTERED//^S X=RADRAWN;T
"KRN",.402,235,"DIAB",2,2,70.03,10)
32;REQ
"KRN",.402,235,"DIAB",2,4,70.21,3)
ACTIVITY DRAWN (in mCi);T
"KRN",.402,235,"DIAB",3,2,70.03,8)
WARD;REQ
"KRN",.402,235,"DIAB",4,2,70.03,1)
2;REQ
"KRN",.402,235,"DIAB",4,2,70.03,8)
SERVICE;REQ
"KRN",.402,235,"DIAB",4,2,70.03,10)
80;REQ
"KRN",.402,235,"DIAB",5,2,70.03,8)
BEDSECTION;REQ
"KRN",.402,235,"DIAB",6,4,70.21,6)
PRESCRIBED DOSE BY MD OVERRIDE;T
"KRN",.402,235,"DIAB",8,2,70.03,8)
RESEARCH SOURCE;REQ
"KRN",.402,235,"DIAB",13,2,70.03,8)
CONTRACT/SHARING SOURCE;REQ
"KRN",.402,235,"DR",1,70)
I '$D(RADTE)!('$D(RACN))!('$D(RAQUICK))!('$D(RAMDV)) W !?3,$C(7),"You must have the variables for 'Case Number','Exam Date' and",!?3,"'Rad/Nuc Med Division' defined to continue!" S Y="@999";S RAPOP=0 D USER^RAUTL S:RAPOP Y="@999";
"KRN",.402,235,"DR",1,70,1)
2///^S X=RADTE;@999;K RAOIFN,RAY,RAR,RA0,RACAT,RAI,RAIEN702,RANUZD1,RAQRYST;
"KRN",.402,235,"DR",2,70.02)
50///^S X=RACN;@800;
"KRN",.402,235,"DR",3,70.03)
S RAREM="RANUZD1 = case's Img typ's 'Radiopharm Used'";S:$P($G(^RA(79.2,+$P($G(^RADPT(DA(2),"DT",DA(1),0)),"^",2),0)),"^",5)="Y" RANUZD1="";S RAY=^RADPT(DA(2),"DT",DA(1),"P",DA,0) F RAI=1:1:18 S RA0(RAI)=$P(RAY,U,RAI);
"KRN",.402,235,"DR",3,70.03,1)
S RAR=$S($D(^RADPT(DA(2),"DT",DA(1),"P",DA,"R")):^("R"),1:""),RAPRI=RA0(2);S RAQRYST=$$CHKSTAT^RANPROU() S Y=$S(RAQRYST=0:"@21",RAQRYST=1:"@20",1:"@999");@20;2R~;S RAPRI=+X;S RAREM="did user change the procedure ?";
"KRN",.402,235,"DR",3,70.03,2)
I RAPRI=RA0(2) S Y="@19";S RAREM="if procedures change, make sure CM associations are preserved...";D CHGPRC^RAUTL21(RA0(2),RAPRI,.DA);D WARNPRC^RAUTL;I RAWHICH=0 S Y="@19";I RAWHICH=2 S Y="@17";
"KRN",.402,235,"DR",3,70.03,3)
W !,"... Deleting radiopharms ...",!;500///@;@17;I RAWHICH=1 S Y="@19";W !,"... Deleting Medications ...",!;K ^RADPT(DA(2),"DT",DA(1),"P",DA,"RX");@19;I '$P(RAMDV,U,7)!($P(^RAMIS(71,+RAPRI,0),U,6)'="B") S Y="@21";
"KRN",.402,235,"DR",3,70.03,4)
W !?3,$C(7),"A 'detailed' procedure or a 'series' of procedures is required!";2///@;S Y="@20";@21;S:'$$FUTC^RACPTCSV Y="@20";S RAREM="determine if CM is used for this procedure";S RAZCM=$O(^RAMIS(71,RAPRI,"CM","B",""));
"KRN",.402,235,"DR",3,70.03,5)
10//^S X=$S(RAZCM'="":"YES",1:"NO");S RAZCM(0)=X;S:$E(RAZCM(0))="N" Y=$$PRGCM^RAMAINU(.DA);D:$E(RAZCM(0))="Y"&('+$O(^RADPT(DA(2),"DT",DA(1),"P",DA,"CM",0))) STUFCM70^RAMAINU(.DA,RAPRI);S X=X;225;
"KRN",.402,235,"DR",3,70.03,6)
D:+$O(^RADPT(DA(2),"DT",DA(1),"P",DA,"CM",0))=0 UPXCM^RAMAINU(.DA,"N");@225;S:RAQRYST=0 Y="@125";125;@125;@37;D:$T(DISCMOD^RACPTMSC)]"" DISCMOD^RACPTMSC;135;S:'$$FUTCMOD^RACPTCSV Y="@37";4;S RACAT=X;S:RA0(4)=RACAT Y="@4";
"KRN",.402,235,"DR",3,70.03,7)
S:RA0(8)']"" Y="@1";8///@;@1;S:RA0(9)']"" Y="@2";9///@;@2;S:RA0(6)']"" Y="@10";6///@;@10;S:RA0(7)']"" Y="@11";7///@;@11;S:$P(RAY,"^",19)']"" Y="@3";19///@;@3;S:RAR']"" Y="@4";9.5///@;@4;
"KRN",.402,235,"DR",3,70.03,8)
S Y=$S(RACAT="I":"@5",RACAT="E":"@12",RACAT="R":"@6","CS"[RACAT:"@7",1:"@8");@5;6R~;7R~;19R~;S Y="@100";@6;9.5R~;@12;I '$D(VADMVT) S DFN=DA(2),VAINDT=9999999.9999-DA(1) D ADM^VADPT2;S Y=$S(VADMVT:"@5",1:"@8");@7;9R~;S Y="@100";@8;
"KRN",.402,235,"DR",3,70.03,9)
8R~;@100;S:RAQRYST=0 Y="@1410";14;@1410;175;S RATCXX=$$TCPROMPT^RAO7XX;S Y=$$ASKPREG^RAUTL8();S RAOIFN=$P($G(^RADPT(RADFN,"DT",RADTI,"P",RACNI,0)),U,11);
"KRN",.402,235,"DR",3,70.03,10)
W !,"    PREGNANT AT TIME OF ORDER ENTRY: ",$$GET1^DIQ(75.1,$G(RAOIFN)_",",13);32R~;S RAPRSCR=$$PRSCR^RAUTL8(RADFN,RADTI,RACNI,"I") K:RAPRSCR="n" ^RADPT(RADFN,"DT",RADTI,"P",RACNI,"PCOMM") S:RAPRSCR="n" Y="@8001" K RAPRSCR;80R~;
"KRN",.402,235,"DR",3,70.03,11)
@8001;16//^S X=$S($D(^RA(78.1,"B","NO COMPLICATION")):"NO COMPLICATION",1:"");S:'$D(^RA(78.1,+X,0)) Y="@130";S:$P(^RA(78.1,+X,0),U)="NO COMPLICATION" Y="@130";16.5;@130;S:'$P(RAMDV,U,9) Y="@140";18;@140;50;@99;
"KRN",.402,235,"DR",3,70.03,12)
S:'$D(RANUZD1) Y="@700";S RAREM="skip radio section if case' Img Typ's 'RADIO...USED' is NEVER";S:$P(^RAMIS(71,+RAPRI,0),U,2)=1 Y="@700";S RAIEN702=$$EN1^RANMPT1(RADFN,RADTE,RACN);S:RAIEN702=-1 Y="@700";500////^S X=RAIEN702;
"KRN",.402,235,"DR",3,70.03,13)
^70.2^RADPTN(^^S I(2,0)=D2 S I(1,0)=D1 S I(0,0)=D0 S Y(1)=$S($D(^RADPT(D0,"DT",D1,"P",D2,0)):^(0),1:"") S X=$P(Y(1),U,28),X=X  S D(0)=+X S X=$S(D(0)>0:D(0),1:"");@700;S RA00=$O(^RADPTN("AA",RADFN,RADTE,RACN,0));S:'RA00 Y="@710";
"KRN",.402,235,"DR",3,70.03,14)
S:$O(^RADPTN(RA00,"NUC",0)) Y="@710";K RAIEN702;500///@;@710;S RACT=$S(RAQUICK:"C",1:"P");100///^S X="""NOW""";S RAREM="here, DIE is ^RADPT(-,'DT',-,'P',";S RA00=$O(@(DIE_DA_",""RX"","_"0)"));
"KRN",.402,235,"DR",3,70.03,15)
S RA00=$G(@(DIE_DA_",""RX"","_+RA00_",0)"));S:RA00]"" Y="@720";S RASKMEDS=$P(^RAMIS(71,+RAPRI,0),U,5) S:RASKMEDS=""!("Yy"'[RASKMEDS) Y="@790";@720;K RA65 S RA65="P";
"KRN",.402,235,"DR",3,70.03,16)
200///^S X=$$RXMEDIT^RAPSAPI3(.RA65,","_RACNI_","_RADTI_","_RADFN_",",70.03,200,RADTE);S:$G(RA65("RESULT"))'="" Y="MEDICATIONS";@790;K RA65;
"KRN",.402,235,"DR",4,70.04)
.01;2;
"KRN",.402,235,"DR",4,70.07)
2///^S X=RACT;3////^S X=RADUZ;4///^S X=RATCXX;S:RATCXX'="" Y="@18";4///@;K ^RADPT(RADFN,"DT",RADTI,"P",RACNI,"L",DA,"TCOM");@18;K RATCXX;
"KRN",.402,235,"DR",4,70.1)
.01;
"KRN",.402,235,"DR",4,70.12)
.01;
"KRN",.402,235,"DR",4,70.15)
S:$G(X)="" Y=0;.01///^S X=$$RXMEDIT^RAPSAPI3(.RA65,DA_","_RACNI_","_RADTI_","_RADFN_",");2;S:$P(RA00,U,3)="" Y="@740";3//^S X="NOW";@740;S:$P(RA00,U,4)="" Y="@750";4//^S X=$P($G(^VA(200,DUZ,0)),"^");@750;
"KRN",.402,235,"DR",4,70.2)
D DISDEF^RASTREQN(RAIEN702);K RA65 S RA65="R";100///^S X=$$RXMEDIT^RAPSAPI3(.RA65,","_DA_",",70.2,100,RADTE);S:$G(RA65("RESULT"))'="" Y="RADIOPHARMACEUTICALS";
"KRN",.402,235,"DR",4,70.3135)
.01;
"KRN",.402,235,"DR",4,70.3225)
.01;
"KRN",.402,235,"DR",5,70.21)
S:$G(X)="" Y=0;.01///^S X=$$RXMEDIT^RAPSAPI3(.RA65,DA_","_DA(1)_",");S RAPSDRUG=X;S:'$G(D0) Y="@500";S RAREM="NOTE: here, DIE is ^RADPTN(D0,'NUC',";S:DIE'[",""NUC""" Y="@500";S RA00=$G(@(DIE_DA_",0)"));S:RA00="" Y="@500";@210;
"KRN",.402,235,"DR",5,70.21,1)
S RADIOPH=$O(^RAMIS(71,$G(RAPRI),"NUC","B",+$G(RAPSDRUG),0)),(RALOW,RAHI,RADRAWN,RADOSE,RASKMEDS)="";S:'RADIOPH Y="@220";S RADIOPH=$G(^RAMIS(71,$G(RAPRI),"NUC",RADIOPH,0)),RALOW=$P(RADIOPH,U,6),RAHI=$P(RADIOPH,U,5);@220;
"KRN",.402,235,"DR",5,70.21,2)
S:$P(RA00,U,4)="" Y="@230";@225;W:RAHI]""!(RALOW]"")!($P(RADIOPH,U,2)]"") !! W:RAHI]"" "High Dose :",RAHI_" mCi" W:RALOW]"" ?27,"Low Dose :",RALOW_" mCi" W:$P(RADIOPH,U,2)]"" ?53,"Usual Dose :",$P(RADIOPH,U,2)_" mCi";
"KRN",.402,235,"DR",5,70.21,3)
W:RAHI]""!(RALOW]"")!($P(RADIOPH,U,2)]"") !;4T~;S RADRAWN=X;S Y=$$VALDOS^RASTREQN(RALOW,RAHI,RADRAWN,"@225","@230","@999",0);@230;S:$P(RA00,U,5)="" Y="@240";5;@240;S:$P(RA00,U,6)="" Y="@250";6;@250;
"KRN",.402,235,"DR",5,70.21,4)
W:RAHI]""!(RALOW]"")!($P(RADIOPH,U,2)]"") !! W:RAHI]"" "High Dose: ",RAHI_" mCi" W:RALOW]"" ?27,"Low Dose: ",RALOW_" mCi" W:$P(RADIOPH,U,2)]"" ?53,"Usual Dose: ",$P(RADIOPH,U,2)," mCi";W:RAHI]""!(RALOW]"")!($P(RADIOPH,U,2)]"") !;
"KRN",.402,235,"DR",5,70.21,5)
7T~//^S X=RADRAWN;S RADOSE=X;S:RALOW]""&(X<RALOW)&(X'="") Y="@255";S:RAHI]""&(X>RAHI) Y="@255";S Y="@258";@255;D WARN^RANMED1;R !!,"OK to continue (Y/N) ?: N//",RAASK;W !;S RAASK=$E(RAASK);S:"Yy"'[RAASK!(RAASK="") Y="@250";
"KRN",.402,235,"DR",5,70.21,6)
S RAREM="is fil 71's PROMPT FOR RADIOPHARM RX yes ?";@258;S RAASK=$P($G(^RAMIS(71,+RAPRI,0)),U,19) S:RAASK=""!("Yy"'[RAASK) Y="@270";@260;3;2T~;@270;8//^S X=$S($P($G(^RADPTN(DA(1),"NUC",DA,0)),"^",5)]"":$P(^(0),"^",5),1:"NOW");
"KRN",.402,235,"DR",5,70.21,7)
9//^S X=$P(^VA(200,+$G(DUZ),0),U);@290;S:$P(RA00,U,6)="" Y="@310";6;@310;S RAREM="Note: 'RAASK' may not be defined, hit global for 'Prompt For Radiopharm RX'";S:$P($G(^RAMIS(71,RAPRI,0)),"^",19)'="y" Y="@320";10;@320;
"KRN",.402,235,"DR",5,70.21,8)
S:$P(RA00,U,11)="" Y="@330";11;@330;S:$P(RA00,U,12)="" Y="@335";12;@335;S:'$D(@(DIE_DA_",""SITX"")")) Y="@340";12.5;@340;S:$P(RA00,U,13)="" Y="@350";13;@350;S:$P(RA00,U,14)="" Y="@360";14;@360;S:$P(RA00,U,15)="" Y="@500";15;@500;
"KRN",.402,235,"ROUOLD")
RACTEX
"MBREQ")
0
"ORD",7,.402)
.402;7;;;EDEOUT^DIFROMSO(.402,DA,"",XPDA);FPRE^DIFROMSI(.402,"",XPDA);EPRE^DIFROMSI(.402,DA,$E("N",$G(XPDNEW)),XPDA,"",OLDA);;EPOST^DIFROMSI(.402,DA,"",XPDA);DEL^DIFROMSK(.402,"",%)
"ORD",7,.402,0)
INPUT TEMPLATE
"PKG",18,-1)
1^1
"PKG",18,0)
RADIOLOGY/NUCLEAR MEDICINE^RA^REGISTERS PATIENTS,RECORDS EXAMS,PROFILES,AMIS REPORTS
"PKG",18,22,0)
^9.49I^1^1
"PKG",18,22,1,0)
5.0^3051109^2980407^50
"PKG",18,22,1,"PAH",1,0)
156^3190315
"PKG",18,22,1,"PAH",1,1,0)
^^3^3^3190315
"PKG",18,22,1,"PAH",1,1,1,0)
Patch one hundred and fifty-six for the VistA Radiology/Nuclear
"PKG",18,22,1,"PAH",1,1,2,0)
Medicine 5.0 application. Please review FORUM's Patch Module description
"PKG",18,22,1,"PAH",1,1,3,0)
and installation instructions for RA*5.0*156 before installing this patch.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
4
"RTN","RAHLRS")
0^4^B29109552^B27750372
"RTN","RAHLRS",1,0)
RAHLRS ;HIRMFO/CRT/PDW - Resend HL7 messages for selected cases ;11 Mar 2019 10:07 AM
"RTN","RAHLRS",2,0)
 ;;5.0;Radiology/Nuclear Medicine;**25,54,60,71,82,95,137,156**;Mar 16, 1998;Build 1
"RTN","RAHLRS",3,0)
 ;
"RTN","RAHLRS",4,0)
 ; Utility to RESEND HL7 messages
"RTN","RAHLRS",5,0)
 ;
"RTN","RAHLRS",6,0)
 ;Integration Agreements
"RTN","RAHLRS",7,0)
 ;----------------------
"RTN","RAHLRS",8,0)
 ;SENDA08^MAGDHLE       (6761 - Private)
"RTN","RAHLRS",9,0)
 ;^MAG(2006.1, IHE flag (6860 - Private)
"RTN","RAHLRS",10,0)
 ;$$PATCH^XPDUTL        (10141 - Supported)
"RTN","RAHLRS",11,0)
 ;$$KSP^XUPARAM("INST") (2541 - Supported) 
"RTN","RAHLRS",12,0)
 ;
"RTN","RAHLRS",13,0)
 ;;02/14/2006 BAY/KAM RA*5*71 Add ability to update exam data to V/R
"RTN","RAHLRS",14,0)
 N RACNI,RADFN,RADTI,RARPT,X
"RTN","RAHLRS",15,0)
 ;
"RTN","RAHLRS",16,0)
 D SETVARS Q:$G(RAIMGTY)=""
"RTN","RAHLRS",17,0)
 ;
"RTN","RAHLRS",18,0)
 F  S X=$$RACNLU(.RADFN,.RADTI,.RACNI) Q:+X'>0  D  Q:QUIT<0
"RTN","RAHLRS",19,0)
 .D RESEND(RADFN,RADTI,RACNI,.QUIT)
"RTN","RAHLRS",20,0)
 Q
"RTN","RAHLRS",21,0)
 ;
"RTN","RAHLRS",22,0)
RACNLU(RADFN,RADTI,RACNI) ; Select Case Number
"RTN","RAHLRS",23,0)
 ;
"RTN","RAHLRS",24,0)
 N RANOSCRN S RANOSCRN="" ; Don't limit cases to current Imaging Type
"RTN","RAHLRS",25,0)
 S (RADFN,RADTI,RADFN)=""
"RTN","RAHLRS",26,0)
 D ^RACNLU
"RTN","RAHLRS",27,0)
 Q X
"RTN","RAHLRS",28,0)
 ;
"RTN","RAHLRS",29,0)
RESEND(RADFN,RADTI,RACNI,QUIT) ; re-send exam message(s) to HL7 subscribers
"RTN","RAHLRS",30,0)
 ;
"RTN","RAHLRS",31,0)
 N RAED,RASSSX,RARPST ;added RASSSX,RARPST, RA*5*95
"RTN","RAHLRS",32,0)
 ;
"RTN","RAHLRS",33,0)
 S QUIT=0
"RTN","RAHLRS",34,0)
 I '$D(DT) D ^%DT S DT=Y
"RTN","RAHLRS",35,0)
 ;
"RTN","RAHLRS",36,0)
 S RAED=$$RAED(RADFN,RADTI,RACNI)
"RTN","RAHLRS",37,0)
 S QUIT=$$OK(RADFN,RADTI,RACNI)
"RTN","RAHLRS",38,0)
 I QUIT>0 D
"RTN","RAHLRS",39,0)
 .I RAED[",REG," D
"RTN","RAHLRS",40,0)
 ..D EN^DDIOL("Re-sending 'EXAM REGISTERD' HL7 message...",,"!!,?6")
"RTN","RAHLRS",41,0)
 ..D REG^RAHLRPC
"RTN","RAHLRS",42,0)
 .I RAED[",CANCEL," D
"RTN","RAHLRS",43,0)
 ..D EN^DDIOL("Re-sending 'EXAM CANCELLED' HL7 message...",,"!,?6")
"RTN","RAHLRS",44,0)
 ..D CANCEL^RAHLRPC
"RTN","RAHLRS",45,0)
 .I RAED[",EXAM," D
"RTN","RAHLRS",46,0)
 ..S $P(^RADPT(RADFN,"DT",RADTI,"P",RACNI,0),"^",30)="" ;Reset sent flag
"RTN","RAHLRS",47,0)
 ..D EN^DDIOL("Re-sending 'EXAMINED' HL7 message...",,"!,?6")
"RTN","RAHLRS",48,0)
 ..N RAEXMDUN D 1^RAHLRPC ;*60 Newed RAEXMDUN to prevent variable leak
"RTN","RAHLRS",49,0)
 .I RAED[",RPT," D
"RTN","RAHLRS",50,0)
 ..D EN^DDIOL("Re-sending 'REPORT VERIFIED' HL7 message...",,"!,?6")
"RTN","RAHLRS",51,0)
 ..;If EF report, set up RASSSX() to exclude VR subscribers, RA*5*95
"RTN","RAHLRS",52,0)
 ..I $G(RARPST)="EF" D HLXMSG^RARTE5
"RTN","RAHLRS",53,0)
 ..D RPT^RAHLRPC
"RTN","RAHLRS",54,0)
 Q
"RTN","RAHLRS",55,0)
 ;
"RTN","RAHLRS",56,0)
RAED(RADFN,RADTI,RACNI) ; identify correct ^RAHLRPC entry point(s)
"RTN","RAHLRS",57,0)
 ;
"RTN","RAHLRS",58,0)
 ; removed RARPTST from new, RA*5*95
"RTN","RAHLRS",59,0)
 N RASTAT,RAIMTYP,RAORD,RETURN
"RTN","RAHLRS",60,0)
 S (RARPST,RASTAT)=""
"RTN","RAHLRS",61,0)
 ;
"RTN","RAHLRS",62,0)
 S RETURN=",REG,"
"RTN","RAHLRS",63,0)
 ;
"RTN","RAHLRS",64,0)
 S RASTAT=$$GET1^DIQ(70.03,RACNI_","_RADTI_","_RADFN,3,"I")
"RTN","RAHLRS",65,0)
 ;
"RTN","RAHLRS",66,0)
 S RAIMTYP=$$GET1^DIQ(72,+RASTAT,7)
"RTN","RAHLRS",67,0)
 S RAORD=$$GET1^DIQ(72,+RASTAT,3)
"RTN","RAHLRS",68,0)
 ;
"RTN","RAHLRS",69,0)
 S:RAORD=0 RETURN=RETURN_"CANCEL,"
"RTN","RAHLRS",70,0)
 ;
"RTN","RAHLRS",71,0)
 I $$GET1^DIQ(72,+RASTAT,8)="YES" D  ; Generate Examined HL7 Message
"RTN","RAHLRS",72,0)
 .S RETURN=RETURN_"EXAM,"
"RTN","RAHLRS",73,0)
 ;
"RTN","RAHLRS",74,0)
 I RETURN'[",EXAM," D
"RTN","RAHLRS",75,0)
 .; also check previous statuses for 'Generate Examined HL7 Message'
"RTN","RAHLRS",76,0)
 .F  S RAORD=$O(^RA(72,"AA",RAIMTYP,RAORD),-1) Q:+RAORD<1  D  Q:RETURN[",EXAM,"
"RTN","RAHLRS",77,0)
 ..S RASTAT=$O(^RA(72,"AA",RAIMTYP,RAORD,0))
"RTN","RAHLRS",78,0)
 ..I $$GET1^DIQ(72,+RASTAT,8)="YES" S RETURN=RETURN_"EXAM,"
"RTN","RAHLRS",79,0)
 ;
"RTN","RAHLRS",80,0)
 I RARPT]"" D  ; Check if Verified or Elect. Filed report exists
"RTN","RAHLRS",81,0)
 .S RARPST=$$GET1^DIQ(74,RARPT,5,"I")
"RTN","RAHLRS",82,0)
 .I "^V^EF^"[("^"_RARPST_"^") S RETURN=RETURN_"RPT," ;RA*5*95
"RTN","RAHLRS",83,0)
 ;
"RTN","RAHLRS",84,0)
 Q RETURN
"RTN","RAHLRS",85,0)
 ;
"RTN","RAHLRS",86,0)
OK(RADFN,RADTI,RACNI) ; Get User to confirm continue
"RTN","RAHLRS",87,0)
 ;
"RTN","RAHLRS",88,0)
 N X,RAEXST
"RTN","RAHLRS",89,0)
 ;
"RTN","RAHLRS",90,0)
 S RAEXST=$$GET1^DIQ(70.03,RACNI_","_RADTI_","_RADFN,3)
"RTN","RAHLRS",91,0)
 ;
"RTN","RAHLRS",92,0)
 S X="",$P(X,"=",70)=""
"RTN","RAHLRS",93,0)
 D EN^DDIOL(X,"","!?5")
"RTN","RAHLRS",94,0)
 S DIR("A")="Re-send all HL7 messages for this '"_RAEXST_"' case?"
"RTN","RAHLRS",95,0)
 S DIR(0)="Y",DIR("B")="YES" D ^DIR
"RTN","RAHLRS",96,0)
 I Y="^" Q -1
"RTN","RAHLRS",97,0)
 Q Y
"RTN","RAHLRS",98,0)
 ;
"RTN","RAHLRS",99,0)
SETVARS ; Setup key Rad/Nuc Med variables
"RTN","RAHLRS",100,0)
 ;
"RTN","RAHLRS",101,0)
 I $O(RACCESS(DUZ,""))="" D SETVARS^RAPSET1(0)
"RTN","RAHLRS",102,0)
 Q:'($D(RACCESS(DUZ))\10)  ; user does not have location access
"RTN","RAHLRS",103,0)
 I $G(RAIMGTY)="" D SETVARS^RAPSET1(1) K:$G(RAIMGTY)="" XQUIT
"RTN","RAHLRS",104,0)
 Q
"RTN","RAHLRS",105,0)
 ;
"RTN","RAHLRS",106,0)
RAADT ;Send patient demographic update (A47/A08) to PACS - P137/KLM
"RTN","RAHLRS",107,0)
 ;check if MAG*3*183 is installed
"RTN","RAHLRS",108,0)
 I '$$PATCH^XPDUTL("MAG*3.0*183") W !,"You need imaging patch MAG*3.0*183 installed to use this option!" Q
"RTN","RAHLRS",109,0)
 ;check if the IHE interface is enabled 
"RTN","RAHLRS",110,0)
 ;Get appropriate entry from IMAGING SITE PARAMETERS based on institution from Kernel Site Params
"RTN","RAHLRS",111,0)
 N RA20061 S RA20061=$O(^MAG(2006.1,"B",$$KSP^XUPARAM("INST"),"")) Q:RA20061<1  ;DBIA 2541,6860
"RTN","RAHLRS",112,0)
 I $$GET1^DIQ(2006.1,RA20061,3.01,"I")'="Y" W !!,"IHE is not enabled!",!,"See MAG*3.0*183 patch instructions to setup/enable ADT messages to PACS." Q
"RTN","RAHLRS",113,0)
 W !!,"This option will send patient demographic updates for selected patients.",!
"RTN","RAHLRS",114,0)
 W !,"It is recommended that you task this if you select 'ALL' patients.",!!
"RTN","RAHLRS",115,0)
 N RADFN,DIR,Y
"RTN","RAHLRS",116,0)
 S RADIC="^RADPT(",RADIC(0)="QEAMZ",RAUTIL="RA PATA08"
"RTN","RAHLRS",117,0)
 S RADIC("A")="Select Patient(s): "
"RTN","RAHLRS",118,0)
 W !! D EN1^RASELCT(.RADIC,RAUTIL)
"RTN","RAHLRS",119,0)
 K DIC,RADIC,RAUTIL
"RTN","RAHLRS",120,0)
 I $O(^TMP($J,"RA PATA08",""))="" W !!?3,$C(7),"No Patient selected." G EXIT
"RTN","RAHLRS",121,0)
 S %=1 W !,"Would you like to task this Job" D YN^DICN G:%<1 EXIT
"RTN","RAHLRS",122,0)
 I %=1 D  G EXIT
"RTN","RAHLRS",123,0)
 .S ZTIO="",ZTSAVE("^TMP($J,""RA PATA08"",")=""
"RTN","RAHLRS",124,0)
 .S ZTDESC="Rad/Nuc Med Patient Demographic Update to PACS",ZTRTN="TADT^RAHLRS"
"RTN","RAHLRS",125,0)
 .D ^%ZTLOAD
"RTN","RAHLRS",126,0)
 .I $D(ZTSK) W !,"Task# "_ZTSK,!!
"RTN","RAHLRS",127,0)
 .Q
"RTN","RAHLRS",128,0)
TADT ;task entry or fall through
"RTN","RAHLRS",129,0)
 S RACT=0
"RTN","RAHLRS",130,0)
 S RAPN="" F  S RAPN=$O(^TMP($J,"RA PATA08",RAPN)) Q:RAPN=""  D
"RTN","RAHLRS",131,0)
 .S RADFN=0 F  S RADFN=$O(^TMP($J,"RA PATA08",RAPN,RADFN)) Q:RADFN=""  D
"RTN","RAHLRS",132,0)
 ..D SENDA08^MAGDHLE(RADFN)
"RTN","RAHLRS",133,0)
 ..S RACT=RACT+1
"RTN","RAHLRS",134,0)
 ..Q
"RTN","RAHLRS",135,0)
 .Q
"RTN","RAHLRS",136,0)
 I '$D(ZTQUEUED) W !!,"Demographic updates sent for "_RACT_" patients"
"RTN","RAHLRS",137,0)
EXIT K ^TMP($J,"RA PATA08"),RAPN,RADFN,ZTDESC,ZTRTN,RACT,ZTSAVE,ZTIO,ZTSK,ZTQUEUED,%
"RTN","RAHLRS",138,0)
 Q
"RTN","RAO7PC1")
0^3^B34284367^B47162808
"RTN","RAO7PC1",1,0)
RAO7PC1 ;HISC/GJC,SS-Procedure Call utilities. ;04 Mar 2019 11:57 AM
"RTN","RAO7PC1",2,0)
 ;;5.0;Radiology/Nuclear Medicine;**1,16,18,26,36,45,75,143,156**;Mar 16, 1998;Build 1
"RTN","RAO7PC1",3,0)
 ;
"RTN","RAO7PC1",4,0)
EN1(RADFN,RABDT,RAEDT,RAEXN,RACINC) ;
"RTN","RAO7PC1",5,0)
 ;
"RTN","RAO7PC1",6,0)
 ; DBIA#2043 - Return list of exams within date range
"RTN","RAO7PC1",7,0)
 ;
"RTN","RAO7PC1",8,0)
 ; ** See routines RAO7PC1A and RAO7PC2 for additional comments **
"RTN","RAO7PC1",9,0)
 ; ** and output node descriptions                              **
"RTN","RAO7PC1",10,0)
 ;
"RTN","RAO7PC1",11,0)
 ; Input: RADFN-> Patient IEN        RABDT-> beginning date
"RTN","RAO7PC1",12,0)
 ;        RAEDT-> ending date        RAEXN-> max # of exams
"RTN","RAO7PC1",13,0)
 ;        RACINC-> include cancelled exams? (1 if yes, default no)
"RTN","RAO7PC1",14,0)
 ;
"RTN","RAO7PC1",15,0)
 ; Output:
"RTN","RAO7PC1",16,0)
 ; ^TMP($J,"RAE1",Patient IEN,Exam ID)=Procedure name^Case number^
"RTN","RAO7PC1",17,0)
 ;       Report status^Abnormal alert flag^Report ien^
"RTN","RAO7PC1",18,0)
 ;       Exam status order #~Exam status name^
"RTN","RAO7PC1",19,0)
 ;       Imaging location name^Imaging type abbr~
"RTN","RAO7PC1",20,0)
 ;       Imaging type name^abnormal results flag^CPT Code
"RTN","RAO7PC1",21,0)
 ;       ^CPRS Order ien^Images exist flag
"RTN","RAO7PC1",22,0)
 ;
"RTN","RAO7PC1",23,0)
 ;if there are one or more CPT modifiers:
"RTN","RAO7PC1",24,0)
 ; ^TMP($J,"RAE1",Patient IEN,Exam ID,"CMOD",n)=CPT Mod^CPT Mod Name
"RTN","RAO7PC1",25,0)
 ;                                         n+1)=CPT Mod^CPT Mod Name
"RTN","RAO7PC1",26,0)
 ;
"RTN","RAO7PC1",27,0)
 ;if CPRS asks to display parent procs, and case is descendent of parent:
"RTN","RAO7PC1",28,0)
 ; ^TMP($J,"RAE1",Patient IEN,Exam ID,"CPRS")=memb of set^parent prc name
"RTN","RAO7PC1",29,0)
 ;
"RTN","RAO7PC1",30,0)
 ; Note: It is possible for the ^TMP global data returned to contain
"RTN","RAO7PC1",31,0)
 ;       'No Report' and a Report file ien for the same exam.  This is
"RTN","RAO7PC1",32,0)
 ;       because Imaging can create a report stub in the Report file,
"RTN","RAO7PC1",33,0)
 ;       but no report interpretation exists and no status is assigned
"RTN","RAO7PC1",34,0)
 ;       to the report record.
"RTN","RAO7PC1",35,0)
 ;
"RTN","RAO7PC1",36,0)
 ; Exam ID: exam date/time (inverse) concatenated with the case IEN
"RTN","RAO7PC1",37,0)
 ; Abnormal alert flag:  Y or blank
"RTN","RAO7PC1",38,0)
 ; Abnormal results flag:  Y or blank, may be turned on even if
"RTN","RAO7PC1",39,0)
 ;     abnormal alert flag is not
"RTN","RAO7PC1",40,0)
 ;
"RTN","RAO7PC1",41,0)
 Q:'RADFN!('RABDT)!('RAEDT)
"RTN","RAO7PC1",42,0)
 N RAEXNP S RAEXNP=RAEXN ;save original value of RAEXN
"RTN","RAO7PC1",43,0)
 ; if last char RAEXNP has "P", then count max no. by parent and 
"RTN","RAO7PC1",44,0)
 ; single, not by individual cases
"RTN","RAO7PC1",45,0)
 S RACINC=+$G(RACINC)
"RTN","RAO7PC1",46,0)
 Q:RABDT>RAEDT  ; quit if ending date before beginning date
"RTN","RAO7PC1",47,0)
 K ^TMP($J,"RAE1") S RAEXN=+$G(RAEXN)
"RTN","RAO7PC1",48,0)
 S:$P(RABDT,".",2) RABDT=RABDT\1 S:$P(RAEDT,".",2) RAEDT=RAEDT\1
"RTN","RAO7PC1",49,0)
 N RABNOR,RACNST,RACNT,RACPT,RACSE,RADIAG,RAIBDT,RAIEDT,RAILOC,RAITY
"RTN","RAO7PC1",50,0)
 N RANO,RAPRC,RAREX,RARPT,RARPTST
"RTN","RAO7PC1",51,0)
 N RAXAM,RAXID,RAXIT,RAXSTAT,RABNORMR,RASHOCAN
"RTN","RAO7PC1",52,0)
 S RACNST=9999999.9999
"RTN","RAO7PC1",53,0)
 S RAIBDT=RACNST-(RAEDT+.9999),RAIEDT=RACNST-(RABDT-.0001)
"RTN","RAO7PC1",54,0)
 S (RACNT,RAXIT)=0
"RTN","RAO7PC1",55,0)
 F  S RAIBDT=$O(^RADPT(RADFN,"DT",RAIBDT)) Q:RAIBDT'>0!(RAIBDT>RAIEDT)  D  Q:RAXIT
"RTN","RAO7PC1",56,0)
 . D SETDATA^RAO7PC1A ; obtain exam data, set ^TMP($J,"RAE1",Patient IEN,Exam ID)
"RTN","RAO7PC1",57,0)
 . Q
"RTN","RAO7PC1",58,0)
 Q
"RTN","RAO7PC1",59,0)
EN2(RADFN) ;
"RTN","RAO7PC1",60,0)
 ;
"RTN","RAO7PC1",61,0)
 ; DBIA#2012 - Return last 7 days of non-cancelled exams
"RTN","RAO7PC1",62,0)
 ;
"RTN","RAO7PC1",63,0)
 ; Input: RADFN-> Patient IEN
"RTN","RAO7PC1",64,0)
 ;
"RTN","RAO7PC1",65,0)
 ; Output:
"RTN","RAO7PC1",66,0)
 ; ^TMP($J,"RAE7",Patient IEN,Exam ID)=procedure name^case number^
"RTN","RAO7PC1",67,0)
 ;       report status^imaging location IEN^imaging location name^
"RTN","RAO7PC1",68,0)
 ;       contrast medium or media used
"RTN","RAO7PC1",69,0)
 ;       Note: Single characters in parenthesis indicate contrast
"RTN","RAO7PC1",70,0)
 ;       involvement: (I)=Iodinated ionic; (N)=Iodinated non-ionic;
"RTN","RAO7PC1",71,0)
 ;        (L)=Gadolinium; (C)=Oral Cholecystographic; (G)=Gastrografin;
"RTN","RAO7PC1",72,0)
 ;        (B)=Barium; (M)=unspecified contrast media
"RTN","RAO7PC1",73,0)
 ;
"RTN","RAO7PC1",74,0)
 ; Exam ID: exam date/time (inverse) concatenated with the case IEN
"RTN","RAO7PC1",75,0)
 ;
"RTN","RAO7PC1",76,0)
 Q:'RADFN  D EN2^RAO7PC1A Q
"RTN","RAO7PC1",77,0)
 ;
"RTN","RAO7PC1",78,0)
EN3(X) ; DBIA#2265 - Return narrative text for exam(s)
"RTN","RAO7PC1",79,0)
 ; Input:
"RTN","RAO7PC1",80,0)
 ; X-> Exam id in one of two forms:
"RTN","RAO7PC1",81,0)
 ;   1) Pat. DFN^inv. exam date^Case IEN
"RTN","RAO7PC1",82,0)
 ;      Retrieves a single report for a single exam
"RTN","RAO7PC1",83,0)
 ;   2) Pat. DFN^inv. exam date^
"RTN","RAO7PC1",84,0)
 ;      Retrieves all reports for a set of exams ordered on one order
"RTN","RAO7PC1",85,0)
 ;
"RTN","RAO7PC1",86,0)
 ; Note:  Input delimiter can be any of the following: ^~\&;-
"RTN","RAO7PC1",87,0)
 ;        a delimiter may be a single space i.e, " "
"RTN","RAO7PC1",88,0)
 ;
"RTN","RAO7PC1",89,0)
 ; Output:
"RTN","RAO7PC1",90,0)
 ; ^TMP($J,"RAE2",Patient IEN,case IEN,procedure name)=report status^
"RTN","RAO7PC1",91,0)
 ; abnormal alert flag^CPRS Order ien^amended report?
"RTN","RAO7PC1",92,0)
 ; ^TMP($J,"RAE2",Patient IEN,case IEN,procedure name,"CM",n)=contrast
"RTN","RAO7PC1",93,0)
 ; media used during exam (internal)^contrast media used during exam
"RTN","RAO7PC1",94,0)
 ; (external)
"RTN","RAO7PC1",95,0)
 ; ^TMP($J,"RAE2",Patient IEN,case IEN,procedure name,"D",n)=diagnostic
"RTN","RAO7PC1",96,0)
 ; code (n=1, this is the primary code)
"RTN","RAO7PC1",97,0)
 ; ^TMP($J,"RAE2",Patient IEN,case IEN,procedure name,"H",n)=clin history
"RTN","RAO7PC1",98,0)
 ; (a line of text)
"RTN","RAO7PC1",99,0)
 ; ^TMP($J,"RAE2",Patient IEN,case IEN,procedure name,"I",n)=impression
"RTN","RAO7PC1",100,0)
 ; (a line of text)
"RTN","RAO7PC1",101,0)
 ; ^TMP($J,"RAE2",Patient IEN,case IEN,procedure name,"M",n)=modifier
"RTN","RAO7PC1",102,0)
 ; (external format)
"RTN","RAO7PC1",103,0)
 ; ^TMP($J,"RAE2",Patient IEN,case IEN,procedure name,"P")=primary
"RTN","RAO7PC1",104,0)
 ; interpreting staff IEN^primary interpreting resident IEN^date
"RTN","RAO7PC1",105,0)
 ; report entered
"RTN","RAO7PC1",106,0)
 ; ^TMP($J,"RAE2",Patient IEN,case IEN,procedure name,"R",n)=report
"RTN","RAO7PC1",107,0)
 ; (a line of text)
"RTN","RAO7PC1",108,0)
 ; ^TMP($J,"RAE2",Patient IEN,case IEN,procedure name,"RFS")=REASON
"RTN","RAO7PC1",109,0)
 ; FOR STUDY; the reason the study was conducted (a line of text)
"RTN","RAO7PC1",110,0)
 ; ^TMP($J,"RAE2",Patient IEN,case IEN,procedure name,"V",n)=verifier IEN
"RTN","RAO7PC1",111,0)
 ; ^signature block name
"RTN","RAO7PC1",112,0)
 ; ^TMP($J,"RAE2",Patient IEN,case IEN,procedure name,"TCOM",1)=techno-
"RTN","RAO7PC1",113,0)
 ; logist comment (a line of text)
"RTN","RAO7PC1",114,0)
 ; ^TMP($J,"RAE2",Patient IEN,"PRINT_SET")=null (IFF this is a printset)
"RTN","RAO7PC1",115,0)
 ; ^TMP($J,"RAE2",Patient IEN,"ORD")=name of ordered procedure for
"RTN","RAO7PC1",116,0)
 ;  examsets and printsets
"RTN","RAO7PC1",117,0)
 ; ^TMP($J,"RAE2",Patient IEN,"ORD",case IEN)=name of ordered procedure
"RTN","RAO7PC1",118,0)
 ;  for that case; not part of an examset or printset
"RTN","RAO7PC1",119,0)
 ;
"RTN","RAO7PC1",120,0)
 K RAU,^TMP($J,"RAE2") S RAU=$$DEL(X)
"RTN","RAO7PC1",121,0)
 I RAU="" K RAU Q
"RTN","RAO7PC1",122,0)
 Q:'$P(X,RAU)!('$P(X,RAU,2))  ; Quit if no Pat. DFN -or- no inv. exam DT
"RTN","RAO7PC1",123,0)
 N RACIEN,RADFN,RAINVXDT,RAPSET,RAQRYST,RAY3,Y S RAPSET=0
"RTN","RAO7PC1",124,0)
 S RADFN=$P(X,RAU),RAINVXDT=$P(X,RAU,2),RACIEN=+$P(X,RAU,3)
"RTN","RAO7PC1",125,0)
 K RAU Q:'($D(^RADPT(RADFN,"DT",RAINVXDT,0))#2)
"RTN","RAO7PC1",126,0)
SS I RACIEN D CASE^RAO7PC2(RACIEN) D SVTCOM^RAUTL11(RADFN,RAINVXDT,RACIEN) Q  ;P18 mod by SS
"RTN","RAO7PC1",127,0)
 S Y=0
"RTN","RAO7PC1",128,0)
 F  S Y=$O(^RADPT(RADFN,"DT",RAINVXDT,"P",Y)) Q:Y'>0  D
"RTN","RAO7PC1",129,0)
 . ; * RA5P156 begin *
"RTN","RAO7PC1",130,0)
 . S RAY3=$G(^RADPT(RADFN,"DT",RAINVXDT,"P",Y,0))
"RTN","RAO7PC1",131,0)
 . ;get the exam status pointer, find the order number
"RTN","RAO7PC1",132,0)
 . ;quit if the order number is zero ('canceled')
"RTN","RAO7PC1",133,0)
 . ;even if you allow canceling of 'complete' studies
"RTN","RAO7PC1",134,0)
 . ;& allow reports on canceled studies the 'Cancel an
"RTN","RAO7PC1",135,0)
 . ;Exam' option prevents the cancel action
"RTN","RAO7PC1",136,0)
 . S RAQRYST=$P($G(^RA(72,+$P(RAY3,U,3),0)),U,3) Q:RAQRYST=0
"RTN","RAO7PC1",137,0)
 . ; * RA5P156 end gjc *
"RTN","RAO7PC1",138,0)
 . D CASE^RAO7PC2(Y)
"RTN","RAO7PC1",139,0)
 . D SVTCOM^RAUTL11(RADFN,RAINVXDT,Y) ;P18 save TCOM in ^TMP
"RTN","RAO7PC1",140,0)
 . S RAPSET=0 ;P18 modified 
"RTN","RAO7PC1",141,0)
 . Q
"RTN","RAO7PC1",142,0)
 Q
"RTN","RAO7PC1",143,0)
 ;
"RTN","RAO7PC1",144,0)
EN30(RAOIFN) ; DBIA#2266 - Return narrative text for exam(s). To be used
"RTN","RAO7PC1",145,0)
 ; with the EN3 entry point above.
"RTN","RAO7PC1",146,0)
 ; Input: RAOIFN -> the ien of Rad/Nuc Med Order
"RTN","RAO7PC1",147,0)
 Q:'RAOIFN  ; order passed in as 0 or null
"RTN","RAO7PC1",148,0)
 Q:'$D(^RAO(75.1,RAOIFN,0))  ; no such order
"RTN","RAO7PC1",149,0)
 Q:'$D(^RADPT("AO",RAOIFN))  ; no exam associated with this order
"RTN","RAO7PC1",150,0)
 N RADFN,RADTI,RACNI,RAXSET
"RTN","RAO7PC1",151,0)
 S RADFN=+$O(^RADPT("AO",RAOIFN,0)) Q:'RADFN
"RTN","RAO7PC1",152,0)
 ; * RA5P156 begin *
"RTN","RAO7PC1",153,0)
 ; This order IEN will be unique for patient 'RADFN'
"RTN","RAO7PC1",154,0)
 ; but this same order could be associated with more
"RTN","RAO7PC1",155,0)
 ; than one study.
"RTN","RAO7PC1",156,0)
 S RADTI=0 F  S RADTI=$O(^RADPT("AO",RAOIFN,RADFN,RADTI)) Q:RADTI'>0  D
"RTN","RAO7PC1",157,0)
 .S RAXSET=+$P($G(^RADPT(RADFN,"DT",RADTI,0)),"^",5) ; set if RAXSET=1
"RTN","RAO7PC1",158,0)
 .I RAXSET D EN3(RADFN_"^"_RADTI_"^") Q  ; exam set, hit EN3 code
"RTN","RAO7PC1",159,0)
 .; the following code is executed for non-exam set examinations
"RTN","RAO7PC1",160,0)
 .S RACNI=+$O(^RADPT("AO",RAOIFN,RADFN,RADTI,0)) Q:'RACNI
"RTN","RAO7PC1",161,0)
 .D EN3(RADFN_"^"_RADTI_"^"_RACNI)
"RTN","RAO7PC1",162,0)
 .Q
"RTN","RAO7PC1",163,0)
 ; * RA5P156 end gjc *
"RTN","RAO7PC1",164,0)
 Q
"RTN","RAO7PC1",165,0)
EN4(RABBRV,RAARY) ; Return Imaging Locations
"RTN","RAO7PC1",166,0)
 ; Input: RABBRV-> Abbreviation for I-Type    RAARY-> data storage array
"RTN","RAO7PC1",167,0)
 ;
"RTN","RAO7PC1",168,0)
 ; Output:
"RTN","RAO7PC1",169,0)
 ; array name(location IEN)=File 79.1 IEN^File 44 name^division IEN
"RTN","RAO7PC1",170,0)
 ; ^division name
"RTN","RAO7PC1",171,0)
 ;
"RTN","RAO7PC1",172,0)
 Q:RABBRV']""  ; quit no I-Type abbreviation
"RTN","RAO7PC1",173,0)
 Q:RAARY']""  ;  quit no data storage array
"RTN","RAO7PC1",174,0)
 N RADIV,RAITY,RALOC,RAX
"RTN","RAO7PC1",175,0)
 S RAITY=+$O(^RA(79.2,"C",RABBRV,0)) Q:'RAITY
"RTN","RAO7PC1",176,0)
 S RAX=0 F  S RAX=$O(^RA(79.1,"BIMG",RAITY,RAX)) Q:RAX'>0  D
"RTN","RAO7PC1",177,0)
 . S RADIV(79)=$G(^RA(79.1,RAX,"DIV"))
"RTN","RAO7PC1",178,0)
 . S RALOC(0)=$G(^RA(79.1,RAX,0))
"RTN","RAO7PC1",179,0)
 . Q:$P(RALOC(0),"^",19)]""  ;inactive DT present, can't be a future DT
"RTN","RAO7PC1",180,0)
 . S RALOC=$P($G(^SC(+RALOC(0),0)),U)
"RTN","RAO7PC1",181,0)
 . S RALOC=$S(RALOC]"":RALOC,1:"Unknown")
"RTN","RAO7PC1",182,0)
 . S RADIV=+$P($G(^RA(79,+RADIV(79),0)),U),RADIV(4)=$G(^DIC(4,RADIV,0))
"RTN","RAO7PC1",183,0)
 . S RADIV=$S($P(RADIV(4),U)]"":$P(RADIV(4),U),1:"Unknown")
"RTN","RAO7PC1",184,0)
 . S @(RAARY_"("_RAX_")")=RAX_U_RALOC_U_+RADIV(79)_U_RADIV
"RTN","RAO7PC1",185,0)
 . Q
"RTN","RAO7PC1",186,0)
 Q
"RTN","RAO7PC1",187,0)
CASE(RAOIFN,RARRAY) ; Return the case numbers and the total number of
"RTN","RAO7PC1",188,0)
 ; case numbers associated with a particular order.
"RTN","RAO7PC1",189,0)
 ; Input: RAOIFN-order ien (75.1)
"RTN","RAO7PC1",190,0)
 ;        RARRAY-data storage (local array)
"RTN","RAO7PC1",191,0)
 ; Return: RATTL-n^x where n is the number of cases in the array
"RTN","RAO7PC1",192,0)
 ;               x=PRINTSET if a single report covers many cases.
"RTN","RAO7PC1",193,0)
 ;               -1 if error (invalid order ien)
"RTN","RAO7PC1",194,0)
 ;               -2 no registered case to date -OR- case(s) cancelled
"RTN","RAO7PC1",195,0)
 ;               If -1 or -2, second piece of RATTL gives the reason
"RTN","RAO7PC1",196,0)
 ;         RARRAY-local data array, array_name(case #)
"RTN","RAO7PC1",197,0)
 N RATTL S RATTL="" D CASE^RAO7PC1A
"RTN","RAO7PC1",198,0)
 Q RATTL
"RTN","RAO7PC1",199,0)
DEL(X) ; Determine the delimiter used to seperate the data
"RTN","RAO7PC1",200,0)
 ; Input: 'X'-> data seperated by a delimiter (first & second pieces
"RTN","RAO7PC1",201,0)
 ; will follow null)
"RTN","RAO7PC1",202,0)
 N Y,Z
"RTN","RAO7PC1",203,0)
 F Y="^","~","\","&",";","-"," " S Z=$F(X,Y) I +Z Q
"RTN","RAO7PC1",204,0)
 Q $S(+Z>0:Y,1:"") ; pass back the delimiter used, or null if not found
"RTN","RAPXRM")
0^2^B18914362^B18223107
"RTN","RAPXRM",1,0)
RAPXRM ;HOIFO/SWM,GJC - API for Clinical Reminders ;04 Mar 2019 12:02 PM
"RTN","RAPXRM",2,0)
 ;;5.0;Radiology/Nuclear Medicine;**33,56,153,156**;Mar 16, 1998;Build 1
"RTN","RAPXRM",3,0)
 ; IA #3731 documents entry point EN1
"RTN","RAPXRM",4,0)
 ; IA #4113 grants use of rtn PXRMSXRM
"RTN","RAPXRM",5,0)
 ; IA #4114 grants use of direct Set and Kill, use of ^PXRMINDX(70
"RTN","RAPXRM",6,0)
 ;Supported IA #2056 GET1^DIQ
"RTN","RAPXRM",7,0)
 ;Supported IA #2052 GET1^DID
"RTN","RAPXRM",8,0)
 ;Supported IA #10141 BMES^XPDUTL, MES^XPDUTL
"RTN","RAPXRM",9,0)
 ;Supported IA #10103 NOW^XLFDT
"RTN","RAPXRM",10,0)
 ;Supported IA #2171 $$NNT^XUAF4
"RTN","RAPXRM",11,0)
 ;
"RTN","RAPXRM",12,0)
EN1(RADAS,RARM) ;retrieve data from Clin. Rem.'s new style index "ACR"
"RTN","RAPXRM",13,0)
 ; Input:
"RTN","RAPXRM",14,0)
 ; RADAS = last subscript of (required), for example:
"RTN","RAPXRM",15,0)
 ;      ^PXRMINDX(70,"IP",43,1,2,2920720.1049,"2;DT;7079279.895;P;3;0")
"RTN","RAPXRM",16,0)
 ;      ^PXRMINDX(70,"PI",9,3,45,2921204.155,"9;DT;7078795.8449;P;1;0")
"RTN","RAPXRM",17,0)
 ; RARM = array name passed by reference (required)
"RTN","RAPXRM",18,0)
 ; Output:
"RTN","RAPXRM",19,0)
 ;     RARM("aaa") = external value, eg.:
"RTN","RAPXRM",20,0)
 ; RARM("EXAM D/T") = Exam Date and time in yyymmdd.hhmm format
"RTN","RAPXRM",21,0)
 ; RARM("EXAM STATUS") = Exam Status name
"RTN","RAPXRM",22,0)
 ; RARM("PROCEDURE") = Procedure name
"RTN","RAPXRM",23,0)
 ; RARM("INTERPRETING PHYSICIAN") = Primary Staff; else Primary Resident
"RTN","RAPXRM",24,0)
 ;     If exam node doesn't exist, then RARM is undefined
"RTN","RAPXRM",25,0)
 ; RARM("RPT STATUS") = Report status name
"RTN","RAPXRM",26,0)
 ; RARM("DIV") = Rad/Nuc Med Division Name (file 4) ^ Station #
"RTN","RAPXRM",27,0)
 ; RARM("I-LOC") = Imaging Location name
"RTN","RAPXRM",28,0)
 ;
"RTN","RAPXRM",29,0)
 K RARM ; clear output var
"RTN","RAPXRM",30,0)
 ; validate RADAS string
"RTN","RAPXRM",31,0)
 Q:$P(RADAS,";",2)'="DT"  Q:$P(RADAS,";",4)'="P"  Q:$P(RADAS,";",6)'="0"
"RTN","RAPXRM",32,0)
 N RA0,RADFN,RADTI,RACNI,X,I,J,RARPT,RAY2
"RTN","RAPXRM",33,0)
 S RADFN=$P(RADAS,";"),RADTI=$P(RADAS,";",3),RACNI=$P(RADAS,";",5)
"RTN","RAPXRM",34,0)
 S RAY2=$G(^RADPT(RADFN,"DT",RADTI,0)) Q:RAY2=""
"RTN","RAPXRM",35,0)
 ;* begin P156 *
"RTN","RAPXRM",36,0)
 ;RAD/NUC MED DIVISION (#79) pointer --> $P(RAY2,U,3) DINUM'ed RA5P153
"RTN","RAPXRM",37,0)
 S RARM("DIV")=$$NNT^XUAF4(+$P(RAY2,U,3)) ;division name (file 4)
"RTN","RAPXRM",38,0)
 ;IMAGING LOCATION (#79.1) --> $P(RAY2,U,4)
"RTN","RAPXRM",39,0)
 S RARM("I-LOC")=$$GET1^DIQ(79.1,+$P(RAY2,U,4),.01) ;(if X = 0 or null func returns null)
"RTN","RAPXRM",40,0)
 ;* end P156/gjc
"RTN","RAPXRM",41,0)
 S RA0=$G(^RADPT(RADFN,"DT",RADTI,"P",RACNI,0))
"RTN","RAPXRM",42,0)
 Q:RA0=""
"RTN","RAPXRM",43,0)
 S RARM("EXAM D/T")=9999999.9999-RADTI
"RTN","RAPXRM",44,0)
 S RARM("EXAM STATUS")=$P($G(^RA(72,+$P(RA0,U,3),0)),U)
"RTN","RAPXRM",45,0)
 S RARM("PROCEDURE")=$P($G(^RAMIS(71,+$P(RA0,U,2),0)),U)
"RTN","RAPXRM",46,0)
 S X=$S($P(RA0,U,15):+$P(RA0,U,15),$P(RA0,U,12):+$P(RA0,U,12),1:"")
"RTN","RAPXRM",47,0)
 S:X'="" X=$$GET1^DIQ(200,X,.01)
"RTN","RAPXRM",48,0)
 S RARM("INTERPRETING PHYSICIAN")=X
"RTN","RAPXRM",49,0)
 ;
"RTN","RAPXRM",50,0)
 ; RARM("PDX")=Primary DX text
"RTN","RAPXRM",51,0)
 ;             this node won't exist if there's no data for Prim DX
"RTN","RAPXRM",52,0)
 ; RARM("SDX",n)=Secondary DX text at ^RADPT(-,"DT",-,"P",-,"DX",n,0)
"RTN","RAPXRM",53,0)
 ;             the n may have gaps if a Secondary DX was deleted
"RTN","RAPXRM",54,0)
 ;
"RTN","RAPXRM",55,0)
 S RARPT=$P(RA0,U,17) S RARM("RPT STATUS")=$$UL^RAO7PC1A($$RSTAT^RAO7PC1A())
"RTN","RAPXRM",56,0)
 S:$P(RA0,U,13)'="" RARM("PDX")=$P($G(^RA(78.3,+$P(RA0,U,13),0)),U)
"RTN","RAPXRM",57,0)
 S I=0
"RTN","RAPXRM",58,0)
 F  S I=$O(^RADPT(RADFN,"DT",RADTI,"P",RACNI,"DX",I)) Q:'I  I $D(^(I,0)) S J=+$G(^(0)) I J S RARM("SDX",I)=$P($G(^RA(78.3,J,0)),U)
"RTN","RAPXRM",59,0)
 Q
"RTN","RAPXRM",60,0)
 ;===============================================================
"RTN","RAPXRM",61,0)
 ; RAD section copied from former location  RAD^PXRMSXRO
"RTN","RAPXRM",62,0)
RAD ;Build the index for RAD/NUC MED PATIENT.
"RTN","RAPXRM",63,0)
 N D0,D1,D2,DA,DAS,DFN,END,ENTRIES,GLOBAL,IND,NE,NERROR,PROC
"RTN","RAPXRM",64,0)
 N START,TEMP,TENP,TEXT
"RTN","RAPXRM",65,0)
 ;Don't leave any old stuff around.
"RTN","RAPXRM",66,0)
 K ^PXRMINDX(70)
"RTN","RAPXRM",67,0)
 S GLOBAL=$$GET1^DID(70,"","","GLOBAL NAME")
"RTN","RAPXRM",68,0)
 S ENTRIES=$P(^RADPT(0),U,4)
"RTN","RAPXRM",69,0)
 S TENP=ENTRIES/10
"RTN","RAPXRM",70,0)
 S TENP=+$P(TENP,".",1)
"RTN","RAPXRM",71,0)
 I TENP<1 S TENP=1
"RTN","RAPXRM",72,0)
 D BMES^XPDUTL("Building index for RAD DATA")
"RTN","RAPXRM",73,0)
 S TEXT="There are "_ENTRIES_" entries to process."
"RTN","RAPXRM",74,0)
 D MES^XPDUTL(TEXT)
"RTN","RAPXRM",75,0)
 S START=$H
"RTN","RAPXRM",76,0)
 S (D0,IND,NE,NERROR)=0
"RTN","RAPXRM",77,0)
 F  S D0=+$O(^RADPT(D0)) Q:D0=0  D
"RTN","RAPXRM",78,0)
 . S IND=IND+1
"RTN","RAPXRM",79,0)
 . I IND#TENP=0 D
"RTN","RAPXRM",80,0)
 .. S TEXT="Processing entry "_IND
"RTN","RAPXRM",81,0)
 .. D MES^XPDUTL(TEXT)
"RTN","RAPXRM",82,0)
 . I IND#10000=0 W "."
"RTN","RAPXRM",83,0)
 . S DFN=$P($G(^RADPT(D0,0)),U,1)
"RTN","RAPXRM",84,0)
 . I DFN="" D  Q
"RTN","RAPXRM",85,0)
 .. S ETEXT=D0_" no patient"
"RTN","RAPXRM",86,0)
 .. D ADDERROR^PXRMSXRM(GLOBAL,ETEXT,.NERROR) Q
"RTN","RAPXRM",87,0)
 . S D1=0
"RTN","RAPXRM",88,0)
 . F  S D1=+$O(^RADPT(D0,"DT",D1)) Q:D1=0  D
"RTN","RAPXRM",89,0)
 .. S DATE=$P($G(^RADPT(D0,"DT",D1,0)),U,1)
"RTN","RAPXRM",90,0)
 .. S DA=D0_";DT;"_D1
"RTN","RAPXRM",91,0)
 .. I DATE="" D  Q
"RTN","RAPXRM",92,0)
 ... S ETEXT=DA_" no date"
"RTN","RAPXRM",93,0)
 ... D ADDERROR^PXRMSXRM(GLOBAL,ETEXT,.NERROR) Q
"RTN","RAPXRM",94,0)
 .. S D2=0
"RTN","RAPXRM",95,0)
 .. F  S D2=+$O(^RADPT(D0,"DT",D1,"P",D2)) Q:D2=0  D
"RTN","RAPXRM",96,0)
 ... S TEMP=$G(^RADPT(D0,"DT",D1,"P",D2,0))
"RTN","RAPXRM",97,0)
 ... S DAS=DA_";P;"_D2_";0"
"RTN","RAPXRM",98,0)
 ... S PROC=$P(TEMP,U,2)
"RTN","RAPXRM",99,0)
 ... I PROC="" D  Q
"RTN","RAPXRM",100,0)
 .... S ETEXT=DAS_" no procedure"
"RTN","RAPXRM",101,0)
 .... D ADDERROR^PXRMSXRM(GLOBAL,ETEXT,.NERROR) Q
"RTN","RAPXRM",102,0)
 ... S ^PXRMINDX(70,"IP",PROC,DFN,DATE,DAS)=""
"RTN","RAPXRM",103,0)
 ... S ^PXRMINDX(70,"PI",DFN,PROC,DATE,DAS)=""
"RTN","RAPXRM",104,0)
 ... S NE=NE+1
"RTN","RAPXRM",105,0)
 S END=$H
"RTN","RAPXRM",106,0)
 S TEXT=NE_" RAD/NUC MED PATIENT results indexed."
"RTN","RAPXRM",107,0)
 D MES^XPDUTL(TEXT)
"RTN","RAPXRM",108,0)
 D DETIME^PXRMSXRM(START,END)
"RTN","RAPXRM",109,0)
 ;If there were errors send a message.
"RTN","RAPXRM",110,0)
 I NERROR>0 D ERRMSG^PXRMSXRM(NERROR,GLOBAL)
"RTN","RAPXRM",111,0)
 ;Send a MailMan message with the results.
"RTN","RAPXRM",112,0)
 D COMMSG^PXRMSXRM(GLOBAL,START,END,NE,NERROR)
"RTN","RAPXRM",113,0)
 S ^PXRMINDX(70,"GLOBAL NAME")=$$GET1^DID(70,"","","GLOBAL NAME")
"RTN","RAPXRM",114,0)
 S ^PXRMINDX(70,"BUILT BY")=DUZ
"RTN","RAPXRM",115,0)
 S ^PXRMINDX(70,"DATE BUILT")=$$NOW^XLFDT
"RTN","RAPXRM",116,0)
 Q
"RTN","RAPXRM",117,0)
 ;
"RTN","RAPXRM",118,0)
 ;===============================================================
"RTN","RAPXRM",119,0)
KRAD(X,DA) ;Delete index for RAD/NUC MED PATIENT file.
"RTN","RAPXRM",120,0)
 N DAS,DATE
"RTN","RAPXRM",121,0)
 S DATE=9999999.9999-DA(1)
"RTN","RAPXRM",122,0)
 S DAS=DA(2)_";DT;"_DA(1)_";P;"_DA_";0"
"RTN","RAPXRM",123,0)
 K ^PXRMINDX(70,"IP",X(1),DA(2),DATE,DAS)
"RTN","RAPXRM",124,0)
 K ^PXRMINDX(70,"PI",DA(2),X(1),DATE,DAS)
"RTN","RAPXRM",125,0)
 Q
"RTN","RAPXRM",126,0)
 ;
"RTN","RAPXRM",127,0)
 ;===============================================================
"RTN","RAPXRM",128,0)
SRAD(X,DA) ;Set index for RAD/NUC MED PATIENT file.
"RTN","RAPXRM",129,0)
 ;DA(2)=DFN, DA(1)=EXAM DATE (inverse date), DA=Examinations Entry
"RTN","RAPXRM",130,0)
 ;X(1)=PROCEDURE
"RTN","RAPXRM",131,0)
 N DAS,DATE
"RTN","RAPXRM",132,0)
 S DATE=9999999.9999-DA(1)
"RTN","RAPXRM",133,0)
 S DAS=DA(2)_";DT;"_DA(1)_";P;"_DA_";0"
"RTN","RAPXRM",134,0)
 S ^PXRMINDX(70,"IP",X(1),DA(2),DATE,DAS)=""
"RTN","RAPXRM",135,0)
 S ^PXRMINDX(70,"PI",DA(2),X(1),DATE,DAS)=""
"RTN","RAPXRM",136,0)
 Q
"RTN","RAPXRM",137,0)
 ;
"RTN","RAUTL8")
0^1^B72237581^B71419275
"RTN","RAUTL8",1,0)
RAUTL8 ;HISC/CAH-Utility routines ;14 Mar 2019 4:11 PM
"RTN","RAUTL8",2,0)
 ;;5.0;Radiology/Nuclear Medicine;**45,72,99,90,137,156**;Mar 16, 1998;Build 1
"RTN","RAUTL8",3,0)
 ;
"RTN","RAUTL8",4,0)
 ;Called by File 70, Exam subfile, Procedure Fld 2 Input transform
"RTN","RAUTL8",5,0)
 ;RA*5*45: modified -  logic in PRC1, ASK, ASK1, & MES1 subroutines
"RTN","RAUTL8",6,0)
 ;          removed -  MES subroutine
"RTN","RAUTL8",7,0)
 ;RA*5*72 03/23/2006 BAY/GJC/KAM Remedy Call 136200 Correct UNDEF issue
"RTN","RAUTL8",8,0)
 ;RA*5.0*99 added utility for pt age and pt sex
"RTN","RAUTL8",9,0)
 ;
"RTN","RAUTL8",10,0)
 ;Supported IA #10061 reference to ^VADPT
"RTN","RAUTL8",11,0)
 ;Supported IA #10103 reference to ^XLFDT
"RTN","RAUTL8",12,0)
 ;Supported IA #10142 reference to EN^DDIOL
"RTN","RAUTL8",13,0)
 ;Supported IA #2056 reference to GET1^DIQ and GETS^DIQ
"RTN","RAUTL8",14,0)
 ;Supported IA #10104 reference to UP^XLFSTR
"RTN","RAUTL8",15,0)
 ;Supported IA #10076 reference to ^XUSEC
"RTN","RAUTL8",16,0)
 ;Supported IA #2055 reference to EXTERNAL^DILFD
"RTN","RAUTL8",17,0)
 ;Supported IA #2378 reference to ORCHK^GMRAOR
"RTN","RAUTL8",18,0)
 ;
"RTN","RAUTL8",19,0)
PRC G PRC1:'$D(^RADPT(DA(2),"DT","AP",X)) ; check for C.M. reaction
"RTN","RAUTL8",20,0)
 N RADUP S RADUP=+$$DPDT^RAUTL8(X,.DA)
"RTN","RAUTL8",21,0)
 I RADUP D ASK Q:'$D(X)
"RTN","RAUTL8",22,0)
PRC1 ; Check for C.M. reaction on this patient
"RTN","RAUTL8",23,0)
 ; +X is the IEN of the Rad/Nuc Med Procedure in file 71
"RTN","RAUTL8",24,0)
 ; RA*5*72 - Changed next line to preserve variables
"RTN","RAUTL8",25,0)
 N RAGMRAOR S RAGMRAOR=$$GMRAOR(DA(2)) Q:RAGMRAOR'=1
"RTN","RAUTL8",26,0)
 D CONTRAST^RAUTL2(+X) ;displays contrast(s) associated with procedure
"RTN","RAUTL8",27,0)
 ;use RAPMSG for CONTRAST REACTION MESSAGE field 25, file 79
"RTN","RAUTL8",28,0)
 S RAPMSG=$G(^RA(79,+$P(^RADPT(DA(2),"DT",DA(1),0),"^",3),"CON"))
"RTN","RAUTL8",29,0)
 D:RAPMSG'="" EN^DDIOL("..."_RAPMSG_"...","","!?3")
"RTN","RAUTL8",30,0)
 D EN^DDIOL("","","!") ;line feed
"RTN","RAUTL8",31,0)
 K RAPMSG
"RTN","RAUTL8",32,0)
 D:$P($G(^RAMIS(71,+X,0)),U,20)="Y" MES1 ;message only if CM used
"RTN","RAUTL8",33,0)
 Q
"RTN","RAUTL8",34,0)
ASK ; Prompt user for yes/no response
"RTN","RAUTL8",35,0)
 N RAX D EN^DDIOL("Procedure is already entered for this date. Is it ok to continue? No// ","","!!?3")
"RTN","RAUTL8",36,0)
ASK1 R RAX:DTIME
"RTN","RAUTL8",37,0)
 S:'$T!(RAX="")!(RAX["^")!("Nn"[$E(RAX)) RAX="N"
"RTN","RAUTL8",38,0)
 K:RAX="N" X Q:'$D(X)
"RTN","RAUTL8",39,0)
 I "Yy"'[$E(RAX) S RAPMSG(1)="Enter 'YES' to register patient for this procedure, or 'NO' to edit the",RAPMSG(2)="above procedure. No// ",RAPMSG(1,"F")="!!?3",RAPMSG(2,"F")="!?3" D EN^DDIOL(.RAPMSG) K RAPMSG G ASK1
"RTN","RAUTL8",40,0)
 Q
"RTN","RAUTL8",41,0)
 ;
"RTN","RAUTL8",42,0)
MES1 ; display procedure acceptance message
"RTN","RAUTL8",43,0)
 R !?5,"...Type 'OK' to acknowledge or '^' to select another procedure   ==> ",RAX:DTIME
"RTN","RAUTL8",44,0)
 S RAX=$$UP^XLFSTR(RAX)
"RTN","RAUTL8",45,0)
 I '$T!(RAX["^")!(RAX="OK") K:RAX'="OK" X K RAX,RAI Q
"RTN","RAUTL8",46,0)
 G MES1
"RTN","RAUTL8",47,0)
 ;
"RTN","RAUTL8",48,0)
STATSEL ;Select one or more order statuses
"RTN","RAUTL8",49,0)
 ;INPUT VARIABLES:
"RTN","RAUTL8",50,0)
 ;   RANO() array contains status codes prohibited from selection
"RTN","RAUTL8",51,0)
 ;OUTPUT VARIABLES:
"RTN","RAUTL8",52,0)
 ;   RAST is a string of status codes selected (ex: 1^3^8)
"RTN","RAUTL8",53,0)
 ;   RAORST() is an array of selected status codes and status names
"RTN","RAUTL8",54,0)
 ;     (ex:   RAORST(1)="DISCONTINUED", RAORST(3)="HOLD", ... )
"RTN","RAUTL8",55,0)
 K RAST,RAORST W ! S RAORSTS=$P(^DD(75.1,5,0),U,3) F I=1:1 S X=$P(RAORSTS,";",I) Q:X=""  S X1=$P(X,":",1) I '$D(RANO(X1)) S X2=$P(X,":",2),RAORST(X1)=X2
"RTN","RAUTL8",56,0)
 W !!,"Select statuses to include on report.",! S X1="" F  S X1=$O(RAORST(X1)) Q:X1=""  W !?5,$J(X1,2,0)_"   "_RAORST(X1)
"RTN","RAUTL8",57,0)
STAT W ! K DIR S DIR(0)="L" D ^DIR Q:'$D(Y(0))
"RTN","RAUTL8",58,0)
 S RAST="" F I=1:1 S RASTX=$P(Y(0),",",I) Q:RASTX=""  I $D(RAORST(RASTX)) S RAST=RAST_"^"_RASTX
"RTN","RAUTL8",59,0)
 S RAST=$E(RAST,2,99) I RAST="" W !,"  ?? Sorry, invalid status selection.  Please try again.",! G STAT
"RTN","RAUTL8",60,0)
 S I="" F  S I=$O(RAORST(I)) Q:I=""  I RAST'[I K RAORST(I)
"RTN","RAUTL8",61,0)
 K RASTX,I,X,X1,X2 Q
"RTN","RAUTL8",62,0)
 ;
"RTN","RAUTL8",63,0)
 ;INPUT TRANSFORM FOR SECONDARY INTERPRETING RESIDENT
"RTN","RAUTL8",64,0)
S() ; do not enter primary OR SAME SEC in secondary interpreting resident
"RTN","RAUTL8",65,0)
 I '$D(X)!('$D(DA(3))) G S2
"RTN","RAUTL8",66,0)
 I '$D(^RADPT(DA(3),"DT",DA(2),"P",DA(1),0)) G S2
"RTN","RAUTL8",67,0)
 I $D(^RADPT(DA(3),"DT",DA(2),"P",DA(1),"SRR","B",+Y)) Q 0 ;SAME SEC RES
"RTN","RAUTL8",68,0)
 I $P(^RADPT(DA(3),"DT",DA(2),"P",DA(1),0),"^",12)=+Y Q 0
"RTN","RAUTL8",69,0)
 Q 1
"RTN","RAUTL8",70,0)
S2 I '$D(^RADPT(DA(2),"DT",DA(1),"P",DA,0)) Q 0
"RTN","RAUTL8",71,0)
 I $D(^RADPT(DA(2),"DT",DA(1),"P",DA,"SRR","B",+Y)) Q 0 ;SAME SEC RES
"RTN","RAUTL8",72,0)
 I $P(^RADPT(DA(2),"DT",DA(1),"P",DA,0),"^",12)=+Y Q 0
"RTN","RAUTL8",73,0)
 Q 1
"RTN","RAUTL8",74,0)
 ;INPUT TRANSFORM FOR SECONDARY INTERPRETING STAFF
"RTN","RAUTL8",75,0)
SSR() ; do not enter primary OR SAME SEC in secondary interpreting staff
"RTN","RAUTL8",76,0)
 I '$D(X)!('$D(DA(3))) G SSR2
"RTN","RAUTL8",77,0)
 I '$D(^RADPT(DA(3),"DT",DA(2),"P",DA(1),0)) G SSR2
"RTN","RAUTL8",78,0)
 I $D(^RADPT(DA(3),"DT",DA(2),"P",DA(1),"SSR","B",+Y)) Q 0 ;SAME SEC STF
"RTN","RAUTL8",79,0)
 I $P(^RADPT(DA(3),"DT",DA(2),"P",DA(1),0),"^",15)=+Y Q 0
"RTN","RAUTL8",80,0)
 Q 1
"RTN","RAUTL8",81,0)
SSR2 I '$D(^RADPT(DA(2),"DT",DA(1),"P",DA,0)) Q 0
"RTN","RAUTL8",82,0)
 I $D(^RADPT(DA(2),"DT",DA(1),"P",DA,"SSR","B",+Y)) Q 0 ;SAME SEC STF
"RTN","RAUTL8",83,0)
 I $P(^RADPT(DA(2),"DT",DA(1),"P",DA,0),"^",15)=+Y Q 0
"RTN","RAUTL8",84,0)
 Q 1
"RTN","RAUTL8",85,0)
 ;INPUT TRANSFORM FOR PRIMARY INTERPRETING RESIDENT
"RTN","RAUTL8",86,0)
 ; *** NOT USED - See EN ***
"RTN","RAUTL8",87,0)
PRRS() ; do not enter secondary into primary interpreting resident screen
"RTN","RAUTL8",88,0)
 ; called from input transform ^DD(70.03,12,0)
"RTN","RAUTL8",89,0)
 I $D(^RADPT(DA(2),"DT",DA(1),"P",DA,"SRR","B",+Y)) Q 0
"RTN","RAUTL8",90,0)
 Q 1
"RTN","RAUTL8",91,0)
 ;INPUT TRANSFORM FOR PRIMARY INTERPRETING STAFF
"RTN","RAUTL8",92,0)
 ; *** NOT USED - See EN ***
"RTN","RAUTL8",93,0)
PSRS() ; do not enter secondary into primary interpreting staff screen
"RTN","RAUTL8",94,0)
 ; called from input transform ^DD(70.03,15,0)
"RTN","RAUTL8",95,0)
 I $D(^RADPT(DA(2),"DT",DA(1),"P",DA,"SSR","B",+Y)) Q 0
"RTN","RAUTL8",96,0)
 Q 1
"RTN","RAUTL8",97,0)
EN(X,FLD,RA) ;Input transform screen for Primary Staff, Primary Res
"RTN","RAUTL8",98,0)
 ;Used by fields 70.03,12 & 70.03,15.  If 'Primary' is found in
"RTN","RAUTL8",99,0)
 ; the 'Secondary' multiple then delete the 'Secondary' entry.
"RTN","RAUTL8",100,0)
 ; X = 'Primary' IEN,  FLD = 'Secondary' mult. to check,  RA = DA array
"RTN","RAUTL8",101,0)
 N DA,DEL,HDR,IEN,NODE,SAVEX,SUBDD,XREF
"RTN","RAUTL8",102,0)
 S NODE=$S(FLD=60:"SSR",FLD=70:"SRR",1:""),SAVEX=X
"RTN","RAUTL8",103,0)
 S SUBDD=$S(FLD=60:70.11,FLD=70:70.09,1:""),(IEN,DEL)=0
"RTN","RAUTL8",104,0)
 I (NODE="")!(X'>0)!(FLD'>0)!(SUBDD'>0) Q
"RTN","RAUTL8",105,0)
 F  S IEN=$O(^RADPT(RA(2),"DT",RA(1),"P",RA,NODE,"B",X,IEN)) Q:IEN'>0  D
"RTN","RAUTL8",106,0)
 . S XREF=0
"RTN","RAUTL8",107,0)
 . F  S XREF=$O(^DD(SUBDD,.01,1,XREF)) Q:XREF'>0  D
"RTN","RAUTL8",108,0)
 .. S (D0,DA(3))=RA(2),(D1,DA(2))=RA(1),(D2,DA(1))=RA,(D3,DA)=IEN,X=SAVEX
"RTN","RAUTL8",109,0)
 .. I $G(^DD(SUBDD,.01,1,XREF,2))]"" X ^(2)
"RTN","RAUTL8",110,0)
 .. Q
"RTN","RAUTL8",111,0)
 . K ^RADPT(RA(2),"DT",RA(1),"P",RA,NODE,IEN,0) S DEL=DEL+1
"RTN","RAUTL8",112,0)
 . Q
"RTN","RAUTL8",113,0)
 I DEL D
"RTN","RAUTL8",114,0)
 . S HDR=$G(^RADPT(RA(2),"DT",RA(1),"P",RA,NODE,0)) Q:HDR=""
"RTN","RAUTL8",115,0)
 . S HDR(3)=+$O(^RADPT(RA(2),"DT",RA(1),"P",RA,NODE,0))
"RTN","RAUTL8",116,0)
 . S HDR(4)=$P(HDR,U,4)-DEL
"RTN","RAUTL8",117,0)
 . S:HDR(3)'>0 HDR(3)="" S:HDR(4)'>0 HDR(4)=""
"RTN","RAUTL8",118,0)
 . S $P(^RADPT(RA(2),"DT",RA(1),"P",RA,NODE,0),U,3,4)=HDR(3)_U_HDR(4)
"RTN","RAUTL8",119,0)
 . Q
"RTN","RAUTL8",120,0)
 S X=SAVEX
"RTN","RAUTL8",121,0)
 Q
"RTN","RAUTL8",122,0)
DPDT(RAPRC,RAY) ; Check for registration of duplicate procedures on the same
"RTN","RAUTL8",123,0)
 ; date/time.  Called from PRC above.
"RTN","RAUTL8",124,0)
 ; INPUT VARIABLES
"RTN","RAUTL8",125,0)
 ; 'RAPRC' --> IEN of the procedure (71)
"RTN","RAUTL8",126,0)
 ; 'RAY'   --> DA array i.e, DA, DA(1), & DA(2)
"RTN","RAUTL8",127,0)
 ; OUTPUT VARIABLES
"RTN","RAUTL8",128,0)
 ; 'RAFLG' --> RAFLG=1 procedure registered for this date/time
"RTN","RAUTL8",129,0)
 ;         --> RAFLG=0 initial registration for procedure@date/time
"RTN","RAUTL8",130,0)
 N RA72,RABDT,RACIEN,RAEDT,RAFLG,RAI S RAFLG=0
"RTN","RAUTL8",131,0)
 S RABDT=RAY(1)\1,RAEDT=RABDT_".9999",RAI=RABDT-.0000001
"RTN","RAUTL8",132,0)
 F  S RAI=$O(^RADPT(RAY(2),"DT","AP",RAPRC,RAI)) Q:RAI'>0!(RAI>RAEDT)  D  Q:RAFLG
"RTN","RAUTL8",133,0)
 . Q:RAI=RAY(1)  ; At this point our exam status is 'WAITING FOR EXAM'
"RTN","RAUTL8",134,0)
 . S RACIEN=$O(^RADPT(RAY(2),"DT","AP",RAPRC,RAI,0)) Q:'RACIEN
"RTN","RAUTL8",135,0)
 . S RA72=+$P($G(^RADPT(RAY(2),"DT",RAI,"P",RACIEN,0)),U,3) ;xam stat
"RTN","RAUTL8",136,0)
 . S RA72(3)=$P($G(^RA(72,RA72,0)),U,3)
"RTN","RAUTL8",137,0)
 . I RA72(3)'=0 S RAFLG=1 ; cancelled exams are not taken into account
"RTN","RAUTL8",138,0)
 . Q
"RTN","RAUTL8",139,0)
 Q RAFLG
"RTN","RAUTL8",140,0)
SCRN(RADA,RARS,Y,RALVL) ; check if the primary or secondary int'ng staff
"RTN","RAUTL8",141,0)
 ; or resident has access to a location or locations which have
"RTN","RAUTL8",142,0)
 ; an imaging type which match the imaging type of the examination.
"RTN","RAUTL8",143,0)
 ; This screen will also check the classification of the individual to 
"RTN","RAUTL8",144,0)
 ; ensure that they are active and valid for the field being edited.
"RTN","RAUTL8",145,0)
 ;
"RTN","RAUTL8",146,0)
 ; Called from DD's: ^DD(70.03,12 - ^DD(70.03,15  - ^DD(70.03,60
"RTN","RAUTL8",147,0)
 ;                   ^DD(70.03,70 - ^DD(70.09,.01 - ^DD(70.11,.01
"RTN","RAUTL8",148,0)
 ;
"RTN","RAUTL8",149,0)
 ; Input variables:  RADA-> DA array, maps to RADFN, RADTI & RACNI
"RTN","RAUTL8",150,0)
 ;                   RARS-> Classification: Resident("R") or Staff("S")
"RTN","RAUTL8",151,0)
 ;                      Y-> selected resident/staff
"RTN","RAUTL8",152,0)
 ;                   RALVL-> "PRI"=Primary physician, "SEC"=Secondary
"RTN","RAUTL8",153,0)
 ;
"RTN","RAUTL8",154,0)
 ; Output variable: $S(1:I-Types & classification match, resident/staff
"RTN","RAUTL8",155,0)
 ;                      ok,0:no match re-select resident/staff)
"RTN","RAUTL8",156,0)
 ;
"RTN","RAUTL8",157,0)
 I $S('$D(^VA(200,+Y,"RA")):1,'$P(^("RA"),U,3):1,DT'>$P(^("RA"),U,3):1,1:0),($D(^VA(200,"ARC",RARS,+Y)))
"RTN","RAUTL8",158,0)
 Q:'$T 0 ; failed the classification part of the screen
"RTN","RAUTL8",159,0)
 Q:$D(^XUSEC("RA ALLOC",+Y)) 1 ; Resident/Staff has access to all loc's!
"RTN","RAUTL8",160,0)
 N RA7002,RACCESS
"RTN","RAUTL8",161,0)
 ; adjust RADA() due Fileman's unpredictable retention of DA() levels
"RTN","RAUTL8",162,0)
 I RALVL="SEC" D
"RTN","RAUTL8",163,0)
 . I '$D(RADA(3)) S RA7002=$G(^RADPT(RADA(2),"DT",RADA(1),0))
"RTN","RAUTL8",164,0)
 . I $D(RADA(3)),(RADA(2)'=RADA(3)) S RA7002=$G(^RADPT(RADA(3),"DT",RADA(2),0))
"RTN","RAUTL8",165,0)
 . I $D(RADA(3)),(RADA(2)=RADA(3)) S RA7002=$G(^RADPT(RADA(2),"DT",RADA(1),0))
"RTN","RAUTL8",166,0)
 I RALVL="PRI" S RA7002=$G(^RADPT(RADA(2),"DT",RADA(1),0))
"RTN","RAUTL8",167,0)
 D VARACC^RAUTL6(+Y) ; set-up access array for selected resident/staff
"RTN","RAUTL8",168,0)
 Q:'$D(RACCESS(+Y,"IMG",+$P(RA7002,"^",2))) 0 ; no i-type match
"RTN","RAUTL8",169,0)
 Q 1
"RTN","RAUTL8",170,0)
 ;
"RTN","RAUTL8",171,0)
CMEDIA(RADFN,RADTI,RACNI) ;return the CM used with an exam
"RTN","RAUTL8",172,0)
 ;input: RADFN=patient DFN, RADTI=inv. date/time of exam, RACNI=exam IEN
"RTN","RAUTL8",173,0)
 ;return: contrast media administered to the patient during an exam
"RTN","RAUTL8",174,0)
 N RAI,RAS S RAI=0,RAS=""
"RTN","RAUTL8",175,0)
 F  S RAI=$O(^RADPT(RADFN,"DT",RADTI,"P",RACNI,"CM",RAI)) Q:'RAI  D
"RTN","RAUTL8",176,0)
 .S RAI(0)=$P($G(^RADPT(RADFN,"DT",RADTI,"P",RACNI,"CM",RAI,0)),U)
"RTN","RAUTL8",177,0)
 .S RAS=RAS_$$EXTERNAL^DILFD(70.3225,.01,"",RAI(0))_", "
"RTN","RAUTL8",178,0)
 Q $P(RAS,", ",1,($L(RAS,", ")-1))
"RTN","RAUTL8",179,0)
 ;
"RTN","RAUTL8",180,0)
GMRAOR(RADA2) ;look for a contrast media reaction
"RTN","RAUTL8",181,0)
 N D,D0,D1,D2,D3,DA,DC,DD,DFN,DG,DH,DI,DIC,DIE,DIEDA,DIEL,DIETMP,DIEXREF,DIFLD,DIIENS,DIOV,DIP,DK,DL,DLAYGO,DM,DN,DOV,DP,DQ,DR,X,Y
"RTN","RAUTL8",182,0)
 Q $$ORCHK^GMRAOR(RADA2,"CM")
"RTN","RAUTL8",183,0)
 ;
"RTN","RAUTL8",184,0)
PTAGE(DFN,RADTST) ;return pt age, added by p#99
"RTN","RAUTL8",185,0)
 ;input = DFN pt ien
"RTN","RAUTL8",186,0)
 ;      = RADTST date to process pt age from; if blank, use today's date
"RTN","RAUTL8",187,0)
 ;output = pt age
"RTN","RAUTL8",188,0)
 N RADAYS,VADM,VA,VAERR,%,RAYSAVE,RAXSAVE
"RTN","RAUTL8",189,0)
 M RAYSAVE=Y,RAXSAVE=X   ;save value of Y and X, patch #90
"RTN","RAUTL8",190,0)
 S:RADTST="" RADTST=$$DT^XLFDT()
"RTN","RAUTL8",191,0)
 D DEM^VADPT   ; $P(VADM(3),"^") DOB of patient, internal
"RTN","RAUTL8",192,0)
 S RADAYS=$$FMDIFF^XLFDT(RADTST,$P(VADM(3),"^"),3)
"RTN","RAUTL8",193,0)
 M X=RAXSAVE,Y=RAYSAVE
"RTN","RAUTL8",194,0)
 Q RADAYS\365.25
"RTN","RAUTL8",195,0)
 ;
"RTN","RAUTL8",196,0)
PTSEX(DFN) ;return pt sex, added by p#99
"RTN","RAUTL8",197,0)
 ;input = pt dfn
"RTN","RAUTL8",198,0)
 ;output = pt sex (M=for MALE, F=for FEMALE)
"RTN","RAUTL8",199,0)
 ;save value of Y and X; patch #90
"RTN","RAUTL8",200,0)
 N VADM,VA,VAERR,%,RAYSAVE,RAXSAVE M RAYSAVE=Y,RAXSAVE=X D DEM^VADPT
"RTN","RAUTL8",201,0)
 M Y=RAYSAVE,X=RAXSAVE
"RTN","RAUTL8",202,0)
 Q $P(VADM(5),U)
"RTN","RAUTL8",203,0)
PRSCR(RADFN,RADTI,RACNI,RAFRMT) ;return pregnancy screen
"RTN","RAUTL8",204,0)
 ;input: radfn = pt dfn
"RTN","RAUTL8",205,0)
 ;       radti = inverse dt
"RTN","RAUTL8",206,0)
 ;       racni = ien of exam sub
"RTN","RAUTL8",207,0)
 ;       rafrmt = E for External format or I for Internal format
"RTN","RAUTL8",208,0)
 ;return = pregnancy screen
"RTN","RAUTL8",209,0)
 N RAIENS,RAOUT
"RTN","RAUTL8",210,0)
 S RAIENS=RACNI_","_RADTI_","_RADFN_","
"RTN","RAUTL8",211,0)
 D GETS^DIQ(70.03,RAIENS,"32",RAFRMT,"RAOUT")
"RTN","RAUTL8",212,0)
 Q $G(RAOUT(70.03,RAIENS,32,RAFRMT))
"RTN","RAUTL8",213,0)
PRSCOM(RADFN,RADTI,RACNI) ;return pregnancy screen comment
"RTN","RAUTL8",214,0)
 ;input: radfn = pt dfn
"RTN","RAUTL8",215,0)
 ;       radti = inverse dt
"RTN","RAUTL8",216,0)
 ;       racni = ien of exam sub
"RTN","RAUTL8",217,0)
 ;return = pregnancy screen comment
"RTN","RAUTL8",218,0)
 N RAIENS,RAOUT
"RTN","RAUTL8",219,0)
 S RAIENS=RACNI_","_RADTI_","_RADFN_","
"RTN","RAUTL8",220,0)
 D GETS^DIQ(70.03,RAIENS,"80","E","RAOUT")
"RTN","RAUTL8",221,0)
 Q $G(RAOUT(70.03,RAIENS,80,"E"))
"RTN","RAUTL8",222,0)
PRCEXA(RADFN) ;return a previous case exam
"RTN","RAUTL8",223,0)
 ;input:  radfn = pt dfn
"RTN","RAUTL8",224,0)
 ;
"RTN","RAUTL8",225,0)
 ;output: racexa(0) =radti^racni, where radti=inverse date ien and racni=record ien
"RTN","RAUTL8",226,0)
 N RADTIEN,RACNIEN
"RTN","RAUTL8",227,0)
 S RADTIEN=$O(^RADPT(RADFN,"DT",0)),RACNIEN=9999,RACNIEN=$O(^RADPT(RADFN,"DT",RADTIEN,"P",RACNIEN),-1)
"RTN","RAUTL8",228,0)
 Q RADTIEN_U_RACNIEN
"RTN","RAUTL8",229,0)
PRACTO(RADFN) ;returns previous active order IEN of file #75.1 or null if no previous order
"RTN","RAUTL8",230,0)
 ;input  radfn = pt dfn
"RTN","RAUTL8",231,0)
 ;output  = ien of #75.1
"RTN","RAUTL8",232,0)
 N RA751IEN,RA751PR
"RTN","RAUTL8",233,0)
 S RA751PR=""
"RTN","RAUTL8",234,0)
 S RA751IEN=" " F  S RA751IEN=$O(^RAO(75.1,"B",RADFN,RA751IEN),-1) Q:RA751IEN'>0!$G(RA751PR)  D
"RTN","RAUTL8",235,0)
 .I $$GET1^DIQ(75.1,RA751IEN,5)="ACTIVE" S RA751PR=RA751IEN
"RTN","RAUTL8",236,0)
 Q RA751PR
"RTN","RAUTL8",237,0)
PAOE() ;Entry point to enter Pregnancy field of file 75.1.  This label is being called from
"RTN","RAUTL8",238,0)
 ;RA ORDER EXAM input template.
"RTN","RAUTL8",239,0)
 ;RETURN value:  0 if unsuccessful (up arrow, timeout or problem occured), 1 if successful.
"RTN","RAUTL8",240,0)
 N DIR,DIROUT,DIRUT,DUOUT,DTOUT,Y,X S DIR(0)="75.1,13"
"RTN","RAUTL8",241,0)
 S DIR("B")=$S($G(RAPREG)="y":"YES",$G(RAPREG)="n":"NO",$G(RAPREG)="u":"UNKNOWN",1:"")
"RTN","RAUTL8",242,0)
 S DIR("A")="PREGNANT AT TIME OF ORDER ENTRY" D ^DIR
"RTN","RAUTL8",243,0)
 Q:$D(DIRUT)!$D(DUOUT)!$D(DTOUT)!$D(DIROUT) 0
"RTN","RAUTL8",244,0)
 S RAPREG=$P(Y,"^")
"RTN","RAUTL8",245,0)
 Q 1
"RTN","RAUTL8",246,0)
 ;
"RTN","RAUTL8",247,0)
ASKSEX() ;RA*5.0*99 - Determine the sex of the patient by asking the user.
"RTN","RAUTL8",248,0)
 ;Called from the RA ORDER EXAM compiled input template.
"RTN","RAUTL8",249,0)
 ;
"RTN","RAUTL8",250,0)
 ;Question: "THE SEX OF THIS PATIENT IS NOT AVAILABLE. IS PATIENT FEMALE"
"RTN","RAUTL8",251,0)
 ;If 'Yes' Y=1; if 'No' Y=0
"RTN","RAUTL8",252,0)
 ;The default presented to the user: 'No'
"RTN","RAUTL8",253,0)
 ;
"RTN","RAUTL8",254,0)
 ;Return: the place holder value ('Y' is reset in the RA ORDER EXAM input template)
"RTN","RAUTL8",255,0)
 ;necessary for branching within that template.
"RTN","RAUTL8",256,0)
 ;
"RTN","RAUTL8",257,0)
 N DIR,DTOUT,DUOUT,DIROUT,DIRUT,RAY,X S RAY=Y S DIR(0)="Y",DIR("B")="No"
"RTN","RAUTL8",258,0)
 S DIR("A")="THE SEX OF THIS PATIENT IS NOT AVAILABLE. IS PATIENT FEMALE"
"RTN","RAUTL8",259,0)
 S DIR("?")="Enter 'YES' if patient is female, or 'NO' if patient is male."
"RTN","RAUTL8",260,0)
 D ^DIR
"RTN","RAUTL8",261,0)
 Q $S($D(DIRUT):"@999",Y=0:"@130",1:RAY)
"RTN","RAUTL8",262,0)
 ;
"RTN","RAUTL8",263,0)
ASKPREG() ;RA*5.0*99 - Evaluate the conditions to present the PREGNANCY
"RTN","RAUTL8",264,0)
 ;SCREENING (70.03 ; 32) prompt to the user. Called from the RA EXAM EDIT
"RTN","RAUTL8",265,0)
 ;input template & the RA REGISTER compiled input template.
"RTN","RAUTL8",266,0)
 ;
"RTN","RAUTL8",267,0)
 ;Input vars
"RTN","RAUTL8",268,0)
 ;   RADFN - The DFN of the patient (global)
"RTN","RAUTL8",269,0)
 ; RAQRYST - The value returned by the function: CHKSTAT^RANPROU().
"RTN","RAUTL8",270,0)
 ;           Is RAQRYST is zero if study is complete (order #9).
"RTN","RAUTL8",271,0)
 ;           Checked in the RA EXAM EDIT input template.
"RTN","RAUTL8",272,0)
 ;       Y - The initial place holder value from the RA EXAM EDIT input
"RTN","RAUTL8",273,0)
 ;           template.
"RTN","RAUTL8",274,0)
 ;
"RTN","RAUTL8",275,0)
 ;Output var
"RTN","RAUTL8",276,0)
 ;     RAY - The place holder variable returned by this function.
"RTN","RAUTL8",277,0)
 ;           Either the place holder value is unchanged or is changed
"RTN","RAUTL8",278,0)
 ;           if pregnancy is possible or if the study is complete. 
"RTN","RAUTL8",279,0)
 ; 
"RTN","RAUTL8",280,0)
 ;
"RTN","RAUTL8",281,0)
 ;Return: the place holder value (Y = $$ASKPREG^RAUTL8) necessary for
"RTN","RAUTL8",282,0)
 ;branching within these templates.
"RTN","RAUTL8",283,0)
 ;
"RTN","RAUTL8",284,0)
 ;P137/KLM - Removed report status check. Pregnancy screen will be presented
"RTN","RAUTL8",285,0)
 ;regardless of the report status.
"RTN","RAUTL8",286,0)
 ;
"RTN","RAUTL8",287,0)
 N %,DIERR,RAERR,RAGE,VAERR,X,RAY S RAY=Y
"RTN","RAUTL8",288,0)
 S RAGE=$$PTAGE^RAUTL8(RADFN,"")
"RTN","RAUTL8",289,0)
 I $$PTSEX^RAUTL8(RADFN)'="F"!((RAGE>55)!(RAGE<12)) S RAY="@8001"
"RTN","RAUTL8",290,0)
 S:$G(RAQRYST)=0 RAY="@8001" ;P156/gjc
"RTN","RAUTL8",291,0)
 Q RAY
"RTN","RAUTL8",292,0)
 ;
"VER")
8.0^22.2
"BLD",10702,6)
^139
**END**
**END**

