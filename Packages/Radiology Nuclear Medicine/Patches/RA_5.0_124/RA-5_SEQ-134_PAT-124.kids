Released RA*5*124 SEQ #134
Extracted from mail message
**KIDS**:RA*5.0*124^

**INSTALL NAME**
RA*5.0*124
"BLD",9325,0)
RA*5.0*124^RADIOLOGY/NUCLEAR MEDICINE^0^3181107^y
"BLD",9325,1,0)
^^3^3^3180904^^^
"BLD",9325,1,1,0)
Patch one hundred and twenty-four for the VistA Radiology/Nuclear 
"BLD",9325,1,2,0)
Medicine 5.0 application. Please review FORUM's Patch Module description
"BLD",9325,1,3,0)
and installation instructions for RA*5.0*124 before installing this patch.
"BLD",9325,4,0)
^9.64PA^70^1
"BLD",9325,4,70,0)
70
"BLD",9325,4,70,2,0)
^9.641^70.03^1
"BLD",9325,4,70,2,70.03,0)
EXAMINATIONS  (sub-file)
"BLD",9325,4,70,2,70.03,1,0)
^9.6411^3^1
"BLD",9325,4,70,2,70.03,1,3,0)
EXAM STATUS
"BLD",9325,4,70,222)
y^n^p^^^^n^^n
"BLD",9325,4,70,224)

"BLD",9325,4,"APDD",70,70.03)

"BLD",9325,4,"APDD",70,70.03,3)

"BLD",9325,4,"B",70,70)

"BLD",9325,6.3)
4
"BLD",9325,"ABPKG")
n
"BLD",9325,"INI")
RAIPR124
"BLD",9325,"INIT")
RAIPS124
"BLD",9325,"KRN",0)
^9.67PA^779.2^20
"BLD",9325,"KRN",.4,0)
.4
"BLD",9325,"KRN",.401,0)
.401
"BLD",9325,"KRN",.402,0)
.402
"BLD",9325,"KRN",.402,"NM",0)
^9.68A^2^2
"BLD",9325,"KRN",.402,"NM",1,0)
RA EXAM EDIT    FILE #70^70^0
"BLD",9325,"KRN",.402,"NM",2,0)
RA CANCEL    FILE #70^70^1^
"BLD",9325,"KRN",.402,"NM","B","RA CANCEL    FILE #70",2)

"BLD",9325,"KRN",.402,"NM","B","RA EXAM EDIT    FILE #70",1)

"BLD",9325,"KRN",.403,0)
.403
"BLD",9325,"KRN",.5,0)
.5
"BLD",9325,"KRN",.84,0)
.84
"BLD",9325,"KRN",3.6,0)
3.6
"BLD",9325,"KRN",3.8,0)
3.8
"BLD",9325,"KRN",9.2,0)
9.2
"BLD",9325,"KRN",9.8,0)
9.8
"BLD",9325,"KRN",9.8,"NM",0)
^9.68A^16^14
"BLD",9325,"KRN",9.8,"NM",3,0)
RAIPS124^^0^B9199604
"BLD",9325,"KRN",9.8,"NM",4,0)
RAEDCN^^0^B86443933
"BLD",9325,"KRN",9.8,"NM",5,0)
RAEDCN1^^0^B33553428
"BLD",9325,"KRN",9.8,"NM",6,0)
RANPROU^^0^B6016594
"BLD",9325,"KRN",9.8,"NM",7,0)
RARTE1^^0^B66328918
"BLD",9325,"KRN",9.8,"NM",8,0)
RAORDC^^0^B22908747
"BLD",9325,"KRN",9.8,"NM",9,0)
RASETU^^0^B6507799
"BLD",9325,"KRN",9.8,"NM",10,0)
RADLQ1^^0^B35681929
"BLD",9325,"KRN",9.8,"NM",11,0)
RARTE2^^0^B52409178
"BLD",9325,"KRN",9.8,"NM",12,0)
RADD2^^0^B26464377
"BLD",9325,"KRN",9.8,"NM",13,0)
RAIPR124^^0^B221656
"BLD",9325,"KRN",9.8,"NM",14,0)
RARTE^^0^B45769333
"BLD",9325,"KRN",9.8,"NM",15,0)
RARTE5^^0^B105969926
"BLD",9325,"KRN",9.8,"NM",16,0)
RAREG1^^0^B34544181
"BLD",9325,"KRN",9.8,"NM","B","RADD2",12)

"BLD",9325,"KRN",9.8,"NM","B","RADLQ1",10)

"BLD",9325,"KRN",9.8,"NM","B","RAEDCN",4)

"BLD",9325,"KRN",9.8,"NM","B","RAEDCN1",5)

"BLD",9325,"KRN",9.8,"NM","B","RAIPR124",13)

"BLD",9325,"KRN",9.8,"NM","B","RAIPS124",3)

"BLD",9325,"KRN",9.8,"NM","B","RANPROU",6)

"BLD",9325,"KRN",9.8,"NM","B","RAORDC",8)

"BLD",9325,"KRN",9.8,"NM","B","RAREG1",16)

"BLD",9325,"KRN",9.8,"NM","B","RARTE",14)

"BLD",9325,"KRN",9.8,"NM","B","RARTE1",7)

"BLD",9325,"KRN",9.8,"NM","B","RARTE2",11)

"BLD",9325,"KRN",9.8,"NM","B","RARTE5",15)

"BLD",9325,"KRN",9.8,"NM","B","RASETU",9)

"BLD",9325,"KRN",19,0)
19
"BLD",9325,"KRN",19,"NM",0)
^9.68A^3^3
"BLD",9325,"KRN",19,"NM",1,0)
RA AUTO DISCONTINUE PROCESS^^1^
"BLD",9325,"KRN",19,"NM",2,0)
RA CANCEL^^0
"BLD",9325,"KRN",19,"NM",3,0)
RA UNVERIFY^^0
"BLD",9325,"KRN",19,"NM","B","RA AUTO DISCONTINUE PROCESS",1)

"BLD",9325,"KRN",19,"NM","B","RA CANCEL",2)

"BLD",9325,"KRN",19,"NM","B","RA UNVERIFY",3)

"BLD",9325,"KRN",19.1,0)
19.1
"BLD",9325,"KRN",19.1,"NM",0)
^9.68A^1^1
"BLD",9325,"KRN",19.1,"NM",1,0)
RA UNVERIFY^^0
"BLD",9325,"KRN",19.1,"NM","B","RA UNVERIFY",1)

"BLD",9325,"KRN",101,0)
101
"BLD",9325,"KRN",409.61,0)
409.61
"BLD",9325,"KRN",771,0)
771
"BLD",9325,"KRN",779.2,0)
779.2
"BLD",9325,"KRN",870,0)
870
"BLD",9325,"KRN",8989.51,0)
8989.51
"BLD",9325,"KRN",8989.52,0)
8989.52
"BLD",9325,"KRN",8994,0)
8994
"BLD",9325,"KRN","B",.4,.4)

"BLD",9325,"KRN","B",.401,.401)

"BLD",9325,"KRN","B",.402,.402)

"BLD",9325,"KRN","B",.403,.403)

"BLD",9325,"KRN","B",.5,.5)

"BLD",9325,"KRN","B",.84,.84)

"BLD",9325,"KRN","B",3.6,3.6)

"BLD",9325,"KRN","B",3.8,3.8)

"BLD",9325,"KRN","B",9.2,9.2)

"BLD",9325,"KRN","B",9.8,9.8)

"BLD",9325,"KRN","B",19,19)

"BLD",9325,"KRN","B",19.1,19.1)

"BLD",9325,"KRN","B",101,101)

"BLD",9325,"KRN","B",409.61,409.61)

"BLD",9325,"KRN","B",771,771)

"BLD",9325,"KRN","B",779.2,779.2)

"BLD",9325,"KRN","B",870,870)

"BLD",9325,"KRN","B",8989.51,8989.51)

"BLD",9325,"KRN","B",8989.52,8989.52)

"BLD",9325,"KRN","B",8994,8994)

"BLD",9325,"PRET")

"BLD",9325,"QDEF")
^^^^NO^^^^NO^^YES
"BLD",9325,"QUES",0)
^9.62^^
"BLD",9325,"REQB",0)
^9.611^8^5
"BLD",9325,"REQB",2,0)
RA*5.0*113^2
"BLD",9325,"REQB",5,0)
RA*5.0*127^2
"BLD",9325,"REQB",6,0)
RA*5.0*135^2
"BLD",9325,"REQB",7,0)
RA*5.0*141^2
"BLD",9325,"REQB",8,0)
RA*5.0*144^2
"BLD",9325,"REQB","B","RA*5.0*113",2)

"BLD",9325,"REQB","B","RA*5.0*127",5)

"BLD",9325,"REQB","B","RA*5.0*135",6)

"BLD",9325,"REQB","B","RA*5.0*141",7)

"BLD",9325,"REQB","B","RA*5.0*144",8)

"FIA",70)
RAD/NUC MED PATIENT
"FIA",70,0)
^RADPT(
"FIA",70,0,0)
70IP
"FIA",70,0,1)
y^n^p^^^^n^^n
"FIA",70,0,10)

"FIA",70,0,11)

"FIA",70,0,"RLRO")

"FIA",70,0,"VR")
5.0^RA
"FIA",70,70)
1
"FIA",70,70.03)
1
"FIA",70,70.03,3)

"INI")
RAIPR124
"INIT")
RAIPS124
"IX",70,70,"AE",0)
70^AE^This cross reference is used to lookup exams that are active/incomplete.^MU^^F^IR^W^70.03^^^^^S
"IX",70,70,"AE",.1,0)
^^2^2^3180412^
"IX",70,70,"AE",.1,1,0)
This cross reference executed for the EXAM STATUS (70.03;3) field creates 
"IX",70,70,"AE",.1,2,0)
an index that tracks every case number for an active exam in the package.
"IX",70,70,"AE",1)
D AEASSET^RADD2(X,.DA,"AE")
"IX",70,70,"AE",2)
D AEKILL^RADD2(.DA)
"IX",70,70,"AE",2.5)
K ^RADPT("AE")
"IX",70,70,"AE",11.1,0)
^.114IA^1^1
"IX",70,70,"AE",11.1,1,0)
1^F^70.03^3^30^1^F
"IX",70,70,"AE",11.1,1,3)

"IX",70,70,"AS",0)
70^AS^This cross reference is used to produce a list of active/incomplete exams.^MU^^F^IR^W^70.03^^^^^S
"IX",70,70,"AS",.1,0)
^^6^6^3180412^
"IX",70,70,"AS",.1,1,0)
This cross reference is used to create a list of active/incomplete exams. 
"IX",70,70,"AS",.1,2,0)
The second subscript after the "AS" is the IEN of the imaging type 
"IX",70,70,"AS",.1,3,0)
constrained exam status record in the EXAMINATION STATUS (#72) file.
"IX",70,70,"AS",.1,4,0)
 
"IX",70,70,"AS",.1,5,0)
The most frequented options that rely on this cross reference are:
"IX",70,70,"AS",.1,6,0)
RA INCOMPLETE, RA DELINQUENT & RA STATRACK.
"IX",70,70,"AS",1)
D AEASSET^RADD2(X,.DA,"AS")
"IX",70,70,"AS",2)
K ^RADPT("AS",$E(X,1,30),DA(2),DA(1),DA)
"IX",70,70,"AS",2.5)
K ^RADPT("AS")
"IX",70,70,"AS",11.1,0)
^.114IA^1^1
"IX",70,70,"AS",11.1,1,0)
1^F^70.03^3^30^1^F
"IX",70,70,"AS",11.1,1,3)

"KRN",.402,235,-1)
0^1
"KRN",.402,235,0)
RA EXAM EDIT^3180322.155^^70^^^3181101
"KRN",.402,235,"%D",0)
^.4021^1^1^3090722^^^^
"KRN",.402,235,"%D",1,0)
This template is used to edit exams.
"KRN",.402,235,"DIAB",1,2,70.03,9)
PRINCIPAL CLINIC;REQ
"KRN",.402,235,"DIAB",1,2,70.03,13)
NUCLEAR MED DATA:
"KRN",.402,235,"DIAB",1,4,70.21,5)
DOSE ADMINISTERED//^S X=RADRAWN;T
"KRN",.402,235,"DIAB",2,2,70.03,10)
80;REQ
"KRN",.402,235,"DIAB",2,4,70.21,3)
ACTIVITY DRAWN (in mCi);T
"KRN",.402,235,"DIAB",3,2,70.03,8)
WARD;REQ
"KRN",.402,235,"DIAB",4,2,70.03,1)
2;REQ
"KRN",.402,235,"DIAB",4,2,70.03,8)
SERVICE;REQ
"KRN",.402,235,"DIAB",5,2,70.03,8)
BEDSECTION;REQ
"KRN",.402,235,"DIAB",6,4,70.21,6)
PRESCRIBED DOSE BY MD OVERRIDE;T
"KRN",.402,235,"DIAB",8,2,70.03,8)
RESEARCH SOURCE;REQ
"KRN",.402,235,"DIAB",9,2,70.03,9)
32;REQ
"KRN",.402,235,"DIAB",13,2,70.03,8)
CONTRACT/SHARING SOURCE;REQ
"KRN",.402,235,"DR",1,70)
I '$D(RADTE)!('$D(RACN))!('$D(RAQUICK))!('$D(RAMDV)) W !?3,$C(7),"You must have the variables for 'Case Number','Exam Date' and",!?3,"'Rad/Nuc Med Division' defined to continue!" S Y="@999";S RAPOP=0 D USER^RAUTL S:RAPOP Y="@999";
"KRN",.402,235,"DR",1,70,1)
2///^S X=RADTE;@999;K RAOIFN,RAY,RAR,RA0,RACAT,RAI,RAIEN702,RANUZD1;
"KRN",.402,235,"DR",2,70.02)
50///^S X=RACN;@800;
"KRN",.402,235,"DR",3,70.03)
S RAREM="RANUZD1 = case's Img typ's 'Radiopharm Used'";S:$P($G(^RA(79.2,+$P($G(^RADPT(DA(2),"DT",DA(1),0)),"^",2),0)),"^",5)="Y" RANUZD1="";S RAY=^RADPT(DA(2),"DT",DA(1),"P",DA,0) F RAI=1:1:18 S RA0(RAI)=$P(RAY,U,RAI);
"KRN",.402,235,"DR",3,70.03,1)
S RAR=$S($D(^RADPT(DA(2),"DT",DA(1),"P",DA,"R")):^("R"),1:""),RAPRI=RA0(2);S RA124=$$CHKSTAT^RANPROU() S Y=$S(RA124=0:"@21",RA124=1:"@20",1:"@999") K RA124;@20;2R~;S RAPRI=+X;S RAREM="did user change the procedure ?";
"KRN",.402,235,"DR",3,70.03,2)
I RAPRI=RA0(2) S Y="@19";S RAREM="if procedures change, make sure CM associations are preserved...";D CHGPRC^RAUTL21(RA0(2),RAPRI,.DA);D WARNPRC^RAUTL;I RAWHICH=0 S Y="@19";I RAWHICH=2 S Y="@17";
"KRN",.402,235,"DR",3,70.03,3)
W !,"... Deleting radiopharms ...",!;500///@;@17;I RAWHICH=1 S Y="@19";W !,"... Deleting Medications ...",!;K ^RADPT(DA(2),"DT",DA(1),"P",DA,"RX");@19;I '$P(RAMDV,U,7)!($P(^RAMIS(71,+RAPRI,0),U,6)'="B") S Y="@21";
"KRN",.402,235,"DR",3,70.03,4)
W !?3,$C(7),"A 'detailed' procedure or a 'series' of procedures is required!";2///@;S Y="@20";@21;S:'$$FUTC^RACPTCSV Y="@20";S RAREM="determine if CM is used for this procedure";S RAZCM=$O(^RAMIS(71,RAPRI,"CM","B",""));
"KRN",.402,235,"DR",3,70.03,5)
10//^S X=$S(RAZCM'="":"YES",1:"NO");S RAZCM(0)=X;S:$E(RAZCM(0))="N" Y=$$PRGCM^RAMAINU(.DA);D:$E(RAZCM(0))="Y"&('+$O(^RADPT(DA(2),"DT",DA(1),"P",DA,"CM",0))) STUFCM70^RAMAINU(.DA,RAPRI);S X=X;225;
"KRN",.402,235,"DR",3,70.03,6)
D:+$O(^RADPT(DA(2),"DT",DA(1),"P",DA,"CM",0))=0 UPXCM^RAMAINU(.DA,"N");@225;125;@37;D:$T(DISCMOD^RACPTMSC)]"" DISCMOD^RACPTMSC;135;S:'$$FUTCMOD^RACPTCSV Y="@37";4;S RACAT=X;S:RA0(4)=RACAT Y="@4";S:RA0(8)']"" Y="@1";8///@;@1;
"KRN",.402,235,"DR",3,70.03,7)
S:RA0(9)']"" Y="@2";9///@;@2;S:RA0(6)']"" Y="@10";6///@;@10;S:RA0(7)']"" Y="@11";7///@;@11;S:$P(RAY,"^",19)']"" Y="@3";19///@;@3;S:RAR']"" Y="@4";9.5///@;@4;
"KRN",.402,235,"DR",3,70.03,8)
S Y=$S(RACAT="I":"@5",RACAT="E":"@12",RACAT="R":"@6","CS"[RACAT:"@7",1:"@8");@5;6R~;7R~;19R~;S Y="@100";@6;9.5R~;@12;I '$D(VADMVT) S DFN=DA(2),VAINDT=9999999.9999-DA(1) D ADM^VADPT2;S Y=$S(VADMVT:"@5",1:"@8");@7;9R~;S Y="@100";@8;
"KRN",.402,235,"DR",3,70.03,9)
8R~;@100;14;175;S RATCXX=$$TCPROMPT^RAO7XX;S Y=$$ASKPREG^RAUTL8();S RAOIFN=$P($G(^RADPT(RADFN,"DT",RADTI,"P",RACNI,0)),U,11);W !,"    PREGNANT AT TIME OF ORDER ENTRY: ",$$GET1^DIQ(75.1,$G(RAOIFN)_",",13);32R~;
"KRN",.402,235,"DR",3,70.03,10)
S RAPRSCR=$$PRSCR^RAUTL8(RADFN,RADTI,RACNI,"I") K:RAPRSCR="n" ^RADPT(RADFN,"DT",RADTI,"P",RACNI,"PCOMM") S:RAPRSCR="n" Y="@8001" K RAPRSCR;80R~;@8001;16//^S X=$S($D(^RA(78.1,"B","NO COMPLICATION")):"NO COMPLICATION",1:"");
"KRN",.402,235,"DR",3,70.03,11)
S:'$D(^RA(78.1,+X,0)) Y="@130";S:$P(^RA(78.1,+X,0),U)="NO COMPLICATION" Y="@130";16.5;@130;S:'$P(RAMDV,U,9) Y="@140";18;@140;50;@99;S:'$D(RANUZD1) Y="@700";S RAREM="skip radio section if case' Img Typ's 'RADIO...USED' is NEVER";
"KRN",.402,235,"DR",3,70.03,12)
S:$P(^RAMIS(71,+RAPRI,0),U,2)=1 Y="@700";S RAIEN702=$$EN1^RANMPT1(RADFN,RADTE,RACN);S:RAIEN702=-1 Y="@700";500////^S X=RAIEN702;
"KRN",.402,235,"DR",3,70.03,13)
^70.2^RADPTN(^^S I(2,0)=D2 S I(1,0)=D1 S I(0,0)=D0 S Y(1)=$S($D(^RADPT(D0,"DT",D1,"P",D2,0)):^(0),1:"") S X=$P(Y(1),U,28),X=X  S D(0)=+X S X=$S(D(0)>0:D(0),1:"");@700;S RA00=$O(^RADPTN("AA",RADFN,RADTE,RACN,0));S:'RA00 Y="@710";
"KRN",.402,235,"DR",3,70.03,14)
S:$O(^RADPTN(RA00,"NUC",0)) Y="@710";K RAIEN702;500///@;@710;S RACT=$S(RAQUICK:"C",1:"P");100///^S X="""NOW""";S RAREM="here, DIE is ^RADPT(-,'DT',-,'P',";S RA00=$O(@(DIE_DA_",""RX"","_"0)"));
"KRN",.402,235,"DR",3,70.03,15)
S RA00=$G(@(DIE_DA_",""RX"","_+RA00_",0)"));S:RA00]"" Y="@720";S RASKMEDS=$P(^RAMIS(71,+RAPRI,0),U,5) S:RASKMEDS=""!("Yy"'[RASKMEDS) Y="@790";@720;K RA65 S RA65="P";
"KRN",.402,235,"DR",3,70.03,16)
200///^S X=$$RXMEDIT^RAPSAPI3(.RA65,","_RACNI_","_RADTI_","_RADFN_",",70.03,200,RADTE);S:$G(RA65("RESULT"))'="" Y="MEDICATIONS";@790;K RA65;
"KRN",.402,235,"DR",4,70.04)
.01;2;
"KRN",.402,235,"DR",4,70.07)
2///^S X=RACT;3////^S X=RADUZ;4///^S X=RATCXX;S:RATCXX'="" Y="@18";4///@;K ^RADPT(RADFN,"DT",RADTI,"P",RACNI,"L",DA,"TCOM");@18;K RATCXX;
"KRN",.402,235,"DR",4,70.1)
.01;
"KRN",.402,235,"DR",4,70.12)
.01;
"KRN",.402,235,"DR",4,70.15)
S:$G(X)="" Y=0;.01///^S X=$$RXMEDIT^RAPSAPI3(.RA65,DA_","_RACNI_","_RADTI_","_RADFN_",");2;S:$P(RA00,U,3)="" Y="@740";3//^S X="NOW";@740;S:$P(RA00,U,4)="" Y="@750";4//^S X=$P($G(^VA(200,DUZ,0)),"^");@750;
"KRN",.402,235,"DR",4,70.2)
D DISDEF^RASTREQN(RAIEN702);K RA65 S RA65="R";100///^S X=$$RXMEDIT^RAPSAPI3(.RA65,","_DA_",",70.2,100,RADTE);S:$G(RA65("RESULT"))'="" Y="RADIOPHARMACEUTICALS";
"KRN",.402,235,"DR",4,70.3135)
.01;
"KRN",.402,235,"DR",4,70.3225)
.01;
"KRN",.402,235,"DR",5,70.21)
S:$G(X)="" Y=0;.01///^S X=$$RXMEDIT^RAPSAPI3(.RA65,DA_","_DA(1)_",");S RAPSDRUG=X;S:'$G(D0) Y="@500";S RAREM="NOTE: here, DIE is ^RADPTN(D0,'NUC',";S:DIE'[",""NUC""" Y="@500";S RA00=$G(@(DIE_DA_",0)"));S:RA00="" Y="@500";@210;
"KRN",.402,235,"DR",5,70.21,1)
S RADIOPH=$O(^RAMIS(71,$G(RAPRI),"NUC","B",+$G(RAPSDRUG),0)),(RALOW,RAHI,RADRAWN,RADOSE,RASKMEDS)="";S:'RADIOPH Y="@220";S RADIOPH=$G(^RAMIS(71,$G(RAPRI),"NUC",RADIOPH,0)),RALOW=$P(RADIOPH,U,6),RAHI=$P(RADIOPH,U,5);@220;
"KRN",.402,235,"DR",5,70.21,2)
S:$P(RA00,U,4)="" Y="@230";@225;W:RAHI]""!(RALOW]"")!($P(RADIOPH,U,2)]"") !! W:RAHI]"" "High Dose :",RAHI_" mCi" W:RALOW]"" ?27,"Low Dose :",RALOW_" mCi" W:$P(RADIOPH,U,2)]"" ?53,"Usual Dose :",$P(RADIOPH,U,2)_" mCi";
"KRN",.402,235,"DR",5,70.21,3)
W:RAHI]""!(RALOW]"")!($P(RADIOPH,U,2)]"") !;4T~;S RADRAWN=X;S Y=$$VALDOS^RASTREQN(RALOW,RAHI,RADRAWN,"@225","@230","@999",0);@230;S:$P(RA00,U,5)="" Y="@240";5;@240;S:$P(RA00,U,6)="" Y="@250";6;@250;
"KRN",.402,235,"DR",5,70.21,4)
W:RAHI]""!(RALOW]"")!($P(RADIOPH,U,2)]"") !! W:RAHI]"" "High Dose: ",RAHI_" mCi" W:RALOW]"" ?27,"Low Dose: ",RALOW_" mCi" W:$P(RADIOPH,U,2)]"" ?53,"Usual Dose: ",$P(RADIOPH,U,2)," mCi";W:RAHI]""!(RALOW]"")!($P(RADIOPH,U,2)]"") !;
"KRN",.402,235,"DR",5,70.21,5)
7T~//^S X=RADRAWN;S RADOSE=X;S:RALOW]""&(X<RALOW)&(X'="") Y="@255";S:RAHI]""&(X>RAHI) Y="@255";S Y="@258";@255;D WARN^RANMED1;R !!,"OK to continue (Y/N) ?: N//",RAASK;W !;S RAASK=$E(RAASK);S:"Yy"'[RAASK!(RAASK="") Y="@250";
"KRN",.402,235,"DR",5,70.21,6)
S RAREM="is fil 71's PROMPT FOR RADIOPHARM RX yes ?";@258;S RAASK=$P($G(^RAMIS(71,+RAPRI,0)),U,19) S:RAASK=""!("Yy"'[RAASK) Y="@270";@260;3;2T~;@270;8//^S X=$S($P($G(^RADPTN(DA(1),"NUC",DA,0)),"^",5)]"":$P(^(0),"^",5),1:"NOW");
"KRN",.402,235,"DR",5,70.21,7)
9//^S X=$P(^VA(200,+$G(DUZ),0),U);@290;S:$P(RA00,U,6)="" Y="@310";6;@310;S RAREM="Note: 'RAASK' may not be defined, hit global for 'Prompt For Radiopharm RX'";S:$P($G(^RAMIS(71,RAPRI,0)),"^",19)'="y" Y="@320";10;@320;
"KRN",.402,235,"DR",5,70.21,8)
S:$P(RA00,U,11)="" Y="@330";11;@330;S:$P(RA00,U,12)="" Y="@335";12;@335;S:'$D(@(DIE_DA_",""SITX"")")) Y="@340";12.5;@340;S:$P(RA00,U,13)="" Y="@350";13;@350;S:$P(RA00,U,14)="" Y="@360";14;@360;S:$P(RA00,U,15)="" Y="@500";15;@500;
"KRN",.402,235,"ROUOLD")
RACTEX
"KRN",.402,2363,-1)
1^2
"KRN",.402,2363,0)
RA CANCEL    FILE #70
"KRN",19,1739,-1)
0^2
"KRN",19,1739,0)
RA CANCEL^Cancel an Exam^^R^^^^^^^^^^1^1
"KRN",19,1739,1,0)
^19.06^11^11^3050719^^^^
"KRN",19,1739,1,1,0)
This function allows the user to cancel an exam on record if a report has
"KRN",19,1739,1,2,0)
not already been filed for that exam.  An exam is
"KRN",19,1739,1,3,0)
often cancelled if the patient cannot have the exam performed.  
"KRN",19,1739,1,4,0)
For example, the patient may become ill while waiting to have the
"KRN",19,1739,1,5,0)
procedure performed.
"KRN",19,1739,1,6,0)
 
"KRN",19,1739,1,7,0)
Once the examination is 'CANCELLED', the user will be prompted to
"KRN",19,1739,1,8,0)
answer with a 'YES' or 'NO' to cancel the request associated with
"KRN",19,1739,1,9,0)
this exam. If 'YES', the request will also be cancelled and the request 
"KRN",19,1739,1,10,0)
status updated to 'CANCELLED'. If 'NO', the request status will be updated
"KRN",19,1739,1,11,0)
to 'HOLD' and may be selected for registration at a future date.
"KRN",19,1739,15)
K RACAN124
"KRN",19,1739,20)
S RACAN124=""
"KRN",19,1739,25)
CANCEL^RAEDCN
"KRN",19,1739,"U")
CANCEL AN EXAM
"KRN",19,1765,-1)
0^3
"KRN",19,1765,0)
RA UNVERIFY^Unverify a Report for Amendment^^R^^RA UNVERIFY^^^^^^
"KRN",19,1765,1,0)
^19.06^7^7^3180613^^^
"KRN",19,1765,1,1,0)
This option allows the supervisor to unverify a report.  This option
"KRN",19,1765,1,2,0)
should not be given to other users.  As the report is unverified, a copy
"KRN",19,1765,1,3,0)
of it is saved for medical/legal purposes, and the report can be amended
"KRN",19,1765,1,4,0)
using any option that allows report edit.  After the amended report is
"KRN",19,1765,1,5,0)
re-verified, displays and printouts of the report will always have a
"KRN",19,1765,1,6,0)
notation at the top to call attention to the fact that it has been
"KRN",19,1765,1,7,0)
amended.
"KRN",19,1765,25)
UNVER^RARTE1(0)
"KRN",19,1765,"U")
UNVERIFY A REPORT FOR AMENDMEN
"KRN",19,14108,-1)
1^1
"KRN",19,14108,0)
RA AUTO DISCONTINUE PROCESS
"KRN",19.1,619,-1)
0^1
"KRN",19.1,619,0)
RA UNVERIFY^Unverify a report
"KRN",19.1,619,1,0)
^^4^4^3180330^
"KRN",19.1,619,1,1,0)
This security key gives the user supervisor-type privilege to back a
"KRN",19.1,619,1,2,0)
report down from a Report Status value of 'Verified'. This key supersedes
"KRN",19.1,619,1,3,0)
the RA MGR key which, prior to this patch, was required to back down a
"KRN",19.1,619,1,4,0)
verified report.
"MBREQ")
0
"ORD",3,19.1)
19.1;3;;;KEY^XPDTA1;KEYF1^XPDIA1;KEYE1^XPDIA1;KEYF2^XPDIA1;;KEYDEL^XPDIA1
"ORD",3,19.1,0)
SECURITY KEY
"ORD",7,.402)
.402;7;;;EDEOUT^DIFROMSO(.402,DA,"",XPDA);FPRE^DIFROMSI(.402,"",XPDA);EPRE^DIFROMSI(.402,DA,$E("N",$G(XPDNEW)),XPDA,"",OLDA);;EPOST^DIFROMSI(.402,DA,"",XPDA);DEL^DIFROMSK(.402,"",%)
"ORD",7,.402,0)
INPUT TEMPLATE
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"PKG",18,-1)
1^1
"PKG",18,0)
RADIOLOGY/NUCLEAR MEDICINE^RA^REGISTERS PATIENTS,RECORDS EXAMS,PROFILES,AMIS REPORTS
"PKG",18,22,0)
^9.49I^1^1
"PKG",18,22,1,0)
5.0^3051109^2980407^50
"PKG",18,22,1,"PAH",1,0)
124^3181107
"PKG",18,22,1,"PAH",1,1,0)
^^3^3^3181107
"PKG",18,22,1,"PAH",1,1,1,0)
Patch one hundred and twenty-four for the VistA Radiology/Nuclear 
"PKG",18,22,1,"PAH",1,1,2,0)
Medicine 5.0 application. Please review FORUM's Patch Module description
"PKG",18,22,1,"PAH",1,1,3,0)
and installation instructions for RA*5.0*124 before installing this patch.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
14
"RTN","RADD2")
0^12^B26464377^B18850431
"RTN","RADD2",1,0)
RADD2 ;HISC/GJC/CAH-Radiology Data Dictionary Utility Routine ;08 Jun 2018 1:47 PM
"RTN","RADD2",2,0)
 ;;5.0;Radiology/Nuclear Medicine;**84,47,124**;Mar 16, 1998;Build 4
"RTN","RADD2",3,0)
 ;
"RTN","RADD2",4,0)
 ;Integration Agreements
"RTN","RADD2",5,0)
 ;----------------------
"RTN","RADD2",6,0)
 ;EN^DDIOL(10142); FILE^DIE(2053);NOTE^ORX3(868);MES^XPDUTL(10141)
"RTN","RADD2",7,0)
 ;
"RTN","RADD2",8,0)
EN1(RAX,RAY) ; Input transform for the .01 field (Procedure) for the Rad/Nuc
"RTN","RADD2",9,0)
 ; Med Common Procedure file i.e, ^RAMIS(71.3
"RTN","RADD2",10,0)
 ; Procedure must not have an inactive date before today in file 71
"RTN","RADD2",11,0)
 ; Procedure in file 71 must have same imaging type as the one
"RTN","RADD2",12,0)
 ;   selected before editing this record in file 71.3
"RTN","RADD2",13,0)
 ; If 'Parent' type procedure, it must have at least 1 descendent
"RTN","RADD2",14,0)
 ; 'RAX' is the value of the .01 field in ^RAMIS(71.3,
"RTN","RADD2",15,0)
 ; 'RAY' are ien's of entries in ^RAMIS(71,
"RTN","RADD2",16,0)
 I '$G(RAIMGTYI) Q 0
"RTN","RADD2",17,0)
 I $S('$D(^("I")):1,'^("I"):1,DT'>^("I"):1,1:0),$S(RAIMGTYI=$P($G(^RAMIS(71,+RAY,0)),"^",12):1,1:0),$S($P(^RAMIS(71,+RAY,0),U,6)'="P":1,$O(^RAMIS(71,+RAY,4,0)):1,1:0)
"RTN","RADD2",18,0)
 Q $T
"RTN","RADD2",19,0)
 ;
"RTN","RADD2",20,0)
CH(RAY,RAX) ; This subroutine will fire off the 'Radiology Request Cancel
"RTN","RADD2",21,0)
 ; /Hold' notification as defined in the 'OE/RR NOTIFICATIONS' file.
"RTN","RADD2",22,0)
 ; Only if request is either cancelled or held.  Called from the set
"RTN","RADD2",23,0)
 ; logic of the 'ACHN' xref in ^DD(75.1,5) field definition.
"RTN","RADD2",24,0)
 ;
"RTN","RADD2",25,0)
 ; Input variables:
"RTN","RADD2",26,0)
 ; 'RAX'=Request status of the order, $S(X=1:'discontinued',X=3:'hold')
"RTN","RADD2",27,0)
 ; 'RAY'=ien of the order in the RAD/NUC MED ORDERS file.
"RTN","RADD2",28,0)
 ;
"RTN","RADD2",29,0)
 Q:(RAY'=+RAY)  Q:(RAX'=1)&(RAX'=3)
"RTN","RADD2",30,0)
 N %,C,D,D0,DA,DC,DDER,DE,DG,DH,DI,DIC,DIE,DIEDA,DIEL,DIFLD,DIP,DIW,DIWT
"RTN","RADD2",31,0)
 N DK,DL,DM,DN,DP,DQ,DR,DU,DV,DW,I,J,N,ORBPMSG,ORBXDATA,ORIFN,ORNOTE,ORVP
"RTN","RADD2",32,0)
 N RA751,RADFN,RANME,RAOIFN,RAOLP,RAOPTN,RAORDS,RAOREA,RAOSTS,RAPARENT
"RTN","RADD2",33,0)
 N RAPRC,RAXIT,X,Y
"RTN","RADD2",34,0)
 S RA751=$G(^RAO(75.1,RAY,0)) Q:RA751']""
"RTN","RADD2",35,0)
 S RAOIFN=RAY,RADFN=+$P(RA751,"^")
"RTN","RADD2",36,0)
 S RAPRC=$P($G(^RAMIS(71,+$P(RA751,"^",2),0)),"^"),ORVP=RADFN_";DPT("
"RTN","RADD2",37,0)
 S ORBPMSG=$S(RAX=1:"Discontinued - ",1:"On hold - ")_$E(RAPRC,1,17)
"RTN","RADD2",38,0)
 S ORBXDATA=RAOIFN_","_RADFN,ORIFN=+$P(RA751,"^",7),ORNOTE(26)=1
"RTN","RADD2",39,0)
 D NOTE^ORX3
"RTN","RADD2",40,0)
 Q
"RTN","RADD2",41,0)
INACOM(RAD0) ; Check inactive date on the Rad/Nuc Med Procedure file (71)
"RTN","RADD2",42,0)
 ; for the Common Procedure before setting our inactive procedure to
"RTN","RADD2",43,0)
 ; active.  Called from the 'RA COMMON PROCEDURE EDIT' input template.
"RTN","RADD2",44,0)
 ; Option: Common Procedure Enter/Edit (13^RAMAIN2)
"RTN","RADD2",45,0)
 ; Input : RAD0-ien of Rad/Nuc Med Common Procedure
"RTN","RADD2",46,0)
 ; Output: if Common cannot be re-activated, reset the 'Inactive' field
"RTN","RADD2",47,0)
 ;         to 'yes'.
"RTN","RADD2",48,0)
 N RAINA S RAINA=$P($G(^RAMIS(71,+$P($G(^RAMIS(71.3,RAD0,0)),"^"),"I")),"^")
"RTN","RADD2",49,0)
 Q:RAINA=""!(RAINA>DT) "@15" ; we can inactivate the common
"RTN","RADD2",50,0)
 N RAFDA,RAMSG
"RTN","RADD2",51,0)
 S RAFDA(71.3,RAD0_",",4)="Y" D FILE^DIE("","RAFDA","") S RAMSG(1)=$C(7)
"RTN","RADD2",52,0)
 S RAMSG(2)="You cannot add this procedure to the common procedure list"
"RTN","RADD2",53,0)
 S RAMSG(3)="because it is inactivated in the Rad/Nuc Med Procedures file."
"RTN","RADD2",54,0)
 S RAMSG(4)="You must first re-activate the procedure through the 'Procedure"
"RTN","RADD2",55,0)
 S RAMSG(5)="Enter/Edit' option.",RAMSG(6)="" D MES^XPDUTL(.RAMSG)
"RTN","RADD2",56,0)
 Q "@10" ; reset 'Inactive' to 'yes', re-edit field.
"RTN","RADD2",57,0)
 ;
"RTN","RADD2",58,0)
EN2() ; called from ^DD(74,0,"ID","WRITE")
"RTN","RADD2",59,0)
 ; display long case #'s in the same print set as current record
"RTN","RADD2",60,0)
 N RA1,RA2
"RTN","RADD2",61,0)
 S RA1=0,RA2=""
"RTN","RADD2",62,0)
 ; F  S RA1=$O(^RARPT(Y,1,"B",RA1)) Q:'RA1  S RA2=RA2_$S(RA2="":"-",1:",-")_$P(RA1,"-",2)
"RTN","RADD2",63,0)
 F  S RA1=$O(^RARPT(Y,1,"B",RA1)) Q:'RA1  S RA2=RA2_$S(RA2="":"-",1:",-")_$P(RA1,"-",$L(RA1,"-"))  ;P47 to accommodate possible SSAN format
"RTN","RADD2",64,0)
 Q RA2
"RTN","RADD2",65,0)
USUAL(RADA,RAX) ; To insure that the USUAL DOSE value falls between the
"RTN","RADD2",66,0)
 ; HIGH ADULT DOSE and the LOW ADULT DOSE.
"RTN","RADD2",67,0)
 ; Input Variables:
"RTN","RADD2",68,0)
 ;     RADA -> top level/sub-file level IEN's
"RTN","RADD2",69,0)
 ;      RAX -> value input by the user
"RTN","RADD2",70,0)
 ; Output Variable: $S(1: value is accepted, 0: value not accepted)
"RTN","RADD2",71,0)
 ;
"RTN","RADD2",72,0)
 Q:RAX="" 0 ; X does not exist
"RTN","RADD2",73,0)
 N RA7108,RAH,RAL S RA7108=$G(^RAMIS(71,RADA(1),"NUC",RADA,0))
"RTN","RADD2",74,0)
 S RAH=$P(RA7108,"^",5),RAL=$P(RA7108,"^",6)
"RTN","RADD2",75,0)
 S RAH=$S(RAH="":99999.9999,1:RAH),RAL=$S(RAL="":.0001,1:RAL)
"RTN","RADD2",76,0)
 I (+RAX<RAL)!(+RAX>RAH) D  Q 0 ; value is not accepted
"RTN","RADD2",77,0)
 . N RARRY S RARRY(1)="The 'USUAL DOSE' must fall within the range of: "
"RTN","RADD2",78,0)
 . S RARRY(1)=RARRY(1)_RAL_" - "_RAH_" "
"RTN","RADD2",79,0)
 . D EN^DDIOL(.RARRY)
"RTN","RADD2",80,0)
 . Q
"RTN","RADD2",81,0)
 E  Q 1 ; value accepted
"RTN","RADD2",82,0)
 ;
"RTN","RADD2",83,0)
RANGE(RADA) ; Determine the range in which the 'USUAL DOSE' must fall
"RTN","RADD2",84,0)
 ; Input Variables:
"RTN","RADD2",85,0)
 ;     RADA  -> top level/sub-file level IEN's
"RTN","RADD2",86,0)
 ; Output Variable:
"RTN","RADD2",87,0)
 ;     RANGE -> the range in which the 'USUAL DOSE' must fall
"RTN","RADD2",88,0)
 N RA7108,RAH,RAL
"RTN","RADD2",89,0)
 S RA7108=$G(^RAMIS(71,RADA(1),"NUC",RADA,0))
"RTN","RADD2",90,0)
 S RAH=$P(RA7108,"^",5),RAL=$P(RA7108,"^",6)
"RTN","RADD2",91,0)
 S RAH=$S(RAH="":99999.9999,1:RAH),RAL=$S(RAL="":.0001,1:RAL)
"RTN","RADD2",92,0)
 Q RAL_"-"_RAH
"RTN","RADD2",93,0)
MEDOSE(RAY,RADT) ; Determine if this individual (RAY) is authorized to
"RTN","RADD2",94,0)
 ; administer medications.  Called from ^DD(70.15,4,12.1)
"RTN","RADD2",95,0)
 ; Input : RAY (pnt to 200) - the individual being checked at the moment 
"RTN","RADD2",96,0)
 ;         RADT - Date of the examination
"RTN","RADD2",97,0)
 ; Output: '1' - user is authorized to administer medications, else '0'
"RTN","RADD2",98,0)
 ;
"RTN","RADD2",99,0)
 Q:$D(^VA(200,"ARC","R",RAY)) 1 ; Rad/Nuc Med Class: Resident
"RTN","RADD2",100,0)
 Q:$D(^VA(200,"ARC","S",RAY)) 1 ; Rad/Nuc Med Class: Staff
"RTN","RADD2",101,0)
 Q:$D(^VA(200,"ARC","T",RAY)) 1 ; Rad/Nuc Med Class: Technologist
"RTN","RADD2",102,0)
 Q:$D(^XUSEC("ORES",RAY)) 1 Q:$D(^XUSEC("ORELSE",RAY)) 1
"RTN","RADD2",103,0)
 N RAUTH S RAUTH=$G(^VA(200,RAY,"PS"))
"RTN","RADD2",104,0)
 ; If authorized to write med orders ($P(RAUTH,"^")=1) and inactivation
"RTN","RADD2",105,0)
 ; date null -OR- inactivation date greater than or equal to the exam
"RTN","RADD2",106,0)
 ; date individual is authorized.
"RTN","RADD2",107,0)
 Q:+$P(RAUTH,"^")&($S('$P(RAUTH,"^",4):1,$P(RAUTH,"^",4)'<RADT:1,1:0)) 1
"RTN","RADD2",108,0)
 Q 0
"RTN","RADD2",109,0)
 ;
"RTN","RADD2",110,0)
PRIDXIXK(DA,X) ;This subroutine executes the KILL logic for the 'new style' AD cross-
"RTN","RADD2",111,0)
 ;reference on the 'PRIMARY DIAGNOSTIC CODE' (data dictionary: 70.03; field: 13)
"RTN","RADD2",112,0)
 ;Input: DA - an array where DA(2)=RADFN, DA(1)=RADTI, & DA=RACNI
"RTN","RADD2",113,0)
 ;        X - the primary diagnostic code value (this field points to file 78.3)
"RTN","RADD2",114,0)
 N RACNI,RADFN,RADTI,RAFDA,RAIENS,RAX
"RTN","RADD2",115,0)
 S RADFN=DA(2),RADTI=DA(1),RACNI=DA,RAX=X ;save the variables just in case
"RTN","RADD2",116,0)
 S RAIENS=DA_","_DA(1)_","_DA(2)_",",RAFDA(70.03,RAIENS,20)="@"
"RTN","RADD2",117,0)
 D FILE^DIE(,"RAFDA") ;delete data in 'DIAGNOSTIC PRINT DATE' (DD: 70.03; field: 20)
"RTN","RADD2",118,0)
 K ^RADPT("AD",RAX,RADFN,RADTI,RACNI)
"RTN","RADD2",119,0)
 Q
"RTN","RADD2",120,0)
 ;
"RTN","RADD2",121,0)
AEASSET(RAX,RADA,RAXREF) ;determine is the examination status of the
"RTN","RADD2",122,0)
 ;study is either CANCELED or COMPLETE. This routine will set the "AS"
"RTN","RADD2",123,0)
 ; or "AE" xref SET logic (new style). 
"RTN","RADD2",124,0)
 ;
"RTN","RADD2",125,0)
 ; Note: The first numeric subscript of the "AE" xref is the
"RTN","RADD2",126,0)
 ;       CASE NUMBER (70.03;.01). Since the .01 field cannot
"RTN","RADD2",127,0)
 ;       be changed because of business rules, the "AE" xref
"RTN","RADD2",128,0)
 ;       does not have set/kill logic in the CASE NUMBER field.
"RTN","RADD2",129,0)
 ;
"RTN","RADD2",130,0)
 ;       The first numeric subscript of the "AS" xref is the
"RTN","RADD2",131,0)
 ;       EXAMINATION STATUS IEN (70.03;3). 
"RTN","RADD2",132,0)
 ;
"RTN","RADD2",133,0)
 ;
"RTN","RADD2",134,0)
 ;input: RAX = value of 'X' passed into from ^DD(70.03,3,0)
"RTN","RADD2",135,0)
 ;             'X' is the IEN of a record in the EXAMINATION
"RTN","RADD2",136,0)
 ;             STATUS (#72) file.
"RTN","RADD2",137,0)
 ;      RADA = the DA array: DA(2) think RADFN, DA(1) think
"RTN","RADD2",138,0)
 ;             RADTI & DA think RACNI.
"RTN","RADD2",139,0)
 ;    RAXREF = one of two values: "AS" or "AE"
"RTN","RADD2",140,0)
 ;
"RTN","RADD2",141,0)
 ;
"RTN","RADD2",142,0)
 ;ORDER value for CANCELED is zero (0), ORDER value for CANCELED is nine (9)
"RTN","RADD2",143,0)
 ;ORDER values 0, 1 & 9 are RESERVED. RAIMGTY is set in the input transform
"RTN","RADD2",144,0)
 N RAIMGTY,RAY2,RAY3,RAY S RAY=$P($G(^RA(72,RAX,0)),U,3) ;ORDER value
"RTN","RADD2",145,0)
 Q:RAY=""  S RAY2=$G(^RADPT(RADA(2),"DT",RADA(1),0))
"RTN","RADD2",146,0)
 S RAY3=$G(^RADPT(RADA(2),"DT",RADA(1),"P",RADA,0)) ;70.03
"RTN","RADD2",147,0)
 S RAIMGTY=$P($G(^RA(79.2,+$P(RAY2,U,2),0)),U) Q:RAIMGTY=""
"RTN","RADD2",148,0)
 ;^RA(72,"AA","GENERAL RADIOLOGY",1,1)="" 4th subscript is ORDER,
"RTN","RADD2",149,0)
 ;the 5th is IEN of file 72
"RTN","RADD2",150,0)
 Q:'$D(^RA(72,"AA",RAIMGTY,RAY,RAX))#2  ;the "AA" must be preserved
"RTN","RADD2",151,0)
 Q:RAY=0!(RAY=9)  ;the study is canceled or complete or broken
"RTN","RADD2",152,0)
 S:RAXREF="AE"&($P(RAY3,U)>0) ^RADPT("AE",$E(+RAY3,1,30),RADA(2),RADA(1),RADA)=""
"RTN","RADD2",153,0)
 S:RAXREF="AS" ^RADPT("AS",$E(RAX,1,30),RADA(2),RADA(1),RADA)=""
"RTN","RADD2",154,0)
 Q
"RTN","RADD2",155,0)
 ;
"RTN","RADD2",156,0)
AEKILL(RADA) ;execute the KILL logic for the "AE" xref on the
"RTN","RADD2",157,0)
 ;EXAM STATUS field (70.03;3)
"RTN","RADD2",158,0)
 ;input: RADA = the DA array: DA(2) think RADFN, DA(1) think
"RTN","RADD2",159,0)
 ;              & DA think RACNI.
"RTN","RADD2",160,0)
 N RAY3 S RAY3=$G(^RADPT(RADA(2),"DT",RADA(1),"P",RADA,0)) ;70.03
"RTN","RADD2",161,0)
 K ^RADPT("AE",$E(+RAY3,1,30),RADA(2),RADA(1),RADA)
"RTN","RADD2",162,0)
 Q
"RTN","RADD2",163,0)
 ;
"RTN","RADLQ1")
0^10^B35681929^B35197870
"RTN","RADLQ1",1,0)
RADLQ1 ;HISC/GJC AISC/MJK,RMO-Delq Status/Incomplete Rpt's ;30 Mar 2018 1:20 PM
"RTN","RADLQ1",2,0)
 ;;5.0;Radiology/Nuclear Medicine;**15,97,47,137,124**;Mar 16, 1998;Build 4
"RTN","RADLQ1",3,0)
 ;'RALL' will be defined in the entry action of RA INCOMPLETE
"RTN","RADLQ1",4,0)
 I $D(DUZ),($O(RACCESS(DUZ,""))']"") D CHECK^RADLQ3(DUZ)
"RTN","RADLQ1",5,0)
 S X=$$DIVLOC^RAUTL7() K ^TMP($J,"RADLQ")
"RTN","RADLQ1",6,0)
 I X K:$D(RAPSTX) RAPSTX K RAQUIT,X,I,POP Q  ; Selection process aborted.
"RTN","RADLQ1",7,0)
 S INVMAXDT=9999999.9999,RAXIT=0
"RTN","RADLQ1",8,0)
 S RAHD(0)=$S($D(RALL):"Incomplete Exam",1:"Delinquent Status")
"RTN","RADLQ1",9,0)
 S RAHD(0)=RAHD(0)_" Report" W @IOF,!?(IOM-$L(RAHD(0))\2),RAHD(0)
"RTN","RADLQ1",10,0)
 D DISPXAM^RADLQ3 ; Display xam statuses
"RTN","RADLQ1",11,0)
 I RAXIT D EXIT^RADLQ3 Q
"RTN","RADLQ1",12,0)
DEV D DATE^RAUTL I RAPOP D EXIT^RADLQ3 Q  ; Quit if device not selected
"RTN","RADLQ1",13,0)
 S RABEG=INVMAXDT-ENDDATE,RAEND=INVMAXDT-BEGDATE K DIR,X,Y
"RTN","RADLQ1",14,0)
 S DIR(0)="SO^I:INPATIENT;O:OUTPATIENT;B:BOTH"
"RTN","RADLQ1",15,0)
 S DIR("?",1)="This report can be broken out by"
"RTN","RADLQ1",16,0)
 S DIR("?")="Outpatient, Inpatient, or Both."
"RTN","RADLQ1",17,0)
 S DIR("A")="Report to include" D ^DIR K DIR
"RTN","RADLQ1",18,0)
 I $D(DIRUT) D EXIT^RADLQ3 Q
"RTN","RADLQ1",19,0)
 S RASORT1=Y
"RTN","RADLQ1",20,0)
 W !!?5,"Now that you have selected ",Y(0)
"RTN","RADLQ1",21,0)
 W " do you want to sort by",!?5,"Patient or Date ?" K X,Y
"RTN","RADLQ1",22,0)
 S DIR(0)="SO^P:PATIENT;D:DATE"
"RTN","RADLQ1",23,0)
 S DIR("?",1)="This allows you the flexibility to further"
"RTN","RADLQ1",24,0)
 S DIR("?")="sort the report by Patient or Date." D ^DIR K DIR
"RTN","RADLQ1",25,0)
 I $D(DIRUT) D EXIT^RADLQ3 Q
"RTN","RADLQ1",26,0)
 S RASORT2=Y D ZEROUT^RADLQ3("RADLQ")
"RTN","RADLQ1",27,0)
 I '$D(^TMP($J,"RADLQ")) D EXIT^RADLQ3 Q
"RTN","RADLQ1",28,0)
 K RACCESS(DUZ,"DIV-IMG") W !
"RTN","RADLQ1",29,0)
 S ZTRTN="START^RADLQ1" S:$D(RALL) ZTSAVE("RALL")=""
"RTN","RADLQ1",30,0)
 F RASV="RAHD(","RACRT(","RABEG","RAEND","RASORT1","RASORT2","INVMAXDT","RAXIT","RADIVNM","RAMDIV" D
"RTN","RADLQ1",31,0)
 . S ZTSAVE(RASV)=""
"RTN","RADLQ1",32,0)
 . Q
"RTN","RADLQ1",33,0)
 S ZTSAVE("^TMP($J,""RA D-TYPE"",")=""
"RTN","RADLQ1",34,0)
 S ZTSAVE("^TMP($J,""RADLQ"",")=""
"RTN","RADLQ1",35,0)
 S ZTSAVE("^TMP($J,""RA I-TYPE"",")=""
"RTN","RADLQ1",36,0)
 D ZIS^RAUTL I RAPOP D EXIT^RADLQ3 Q
"RTN","RADLQ1",37,0)
START ; start processing here
"RTN","RADLQ1",38,0)
 U IO S $P(RALN1,"-",(IOM+1))=""
"RTN","RADLQ1",39,0)
 S:$D(ZTQUEUED) ZTREQ="@"
"RTN","RADLQ1",40,0)
 S $P(RALN2,"=",(IOM+1))="",(RAPG,RASTI)=0
"RTN","RADLQ1",41,0)
 F  S RASTI=$O(^RADPT("AS",RASTI)) Q:'RASTI  D  Q:RAXIT
"RTN","RADLQ1",42,0)
 . D RADFN:$S($D(RALL):1,$D(RACRT(RASTI)):1,1:0)
"RTN","RADLQ1",43,0)
 . Q
"RTN","RADLQ1",44,0)
 K RADIV("I") D:'RAXIT PRINT^RADLQ2
"RTN","RADLQ1",45,0)
 I 'RAXIT D
"RTN","RADLQ1",46,0)
 . S RADIVNM=$$DIVTOT^RACMP("RADLQ") Q:'RADIVNM
"RTN","RADLQ1",47,0)
 . S RAXIT=$$EOS^RAUTL5() Q:RAXIT  S RAFLAG="" D HDR^RADLQ2
"RTN","RADLQ1",48,0)
 . D:'RAXIT LIST^RADLQ3
"RTN","RADLQ1",49,0)
 . Q
"RTN","RADLQ1",50,0)
 ; is RAXIT set to one? If yes, skip $$EOS call /p124/
"RTN","RADLQ1",51,0)
 S:RAXIT=0 RAXIT=$$EOS^RAUTL5() ;cause screen pause for user
"RTN","RADLQ1",52,0)
 ;
"RTN","RADLQ1",53,0)
 D EXIT^RADLQ3
"RTN","RADLQ1",54,0)
 Q
"RTN","RADLQ1",55,0)
RADFN ; $ order through rad patients ien's
"RTN","RADLQ1",56,0)
 S RADFN=0
"RTN","RADLQ1",57,0)
 F  S RADFN=$O(^RADPT("AS",RASTI,RADFN)) Q:'RADFN  D  Q:RAXIT
"RTN","RADLQ1",58,0)
 . F RADTI=RABEG-1:0 S RADTI=$O(^RADPT("AS",RASTI,RADFN,RADTI)) Q:'RADTI!(RADTI>RAEND)  D  Q:RAXIT
"RTN","RADLQ1",59,0)
 .. S RADTE=INVMAXDT-RADTI D RACNI
"RTN","RADLQ1",60,0)
 .. Q
"RTN","RADLQ1",61,0)
 . Q
"RTN","RADLQ1",62,0)
 Q
"RTN","RADLQ1",63,0)
RACNI ; $ order through case #
"RTN","RADLQ1",64,0)
 S RACNI=0
"RTN","RADLQ1",65,0)
 F  S RACNI=$O(^RADPT("AS",RASTI,RADFN,RADTI,RACNI)) Q:'RACNI  D SORT  Q:RAXIT
"RTN","RADLQ1",66,0)
 Q
"RTN","RADLQ1",67,0)
SORT ; sort logic
"RTN","RADLQ1",68,0)
 S RAREGEX(0)=$G(^RADPT(RADFN,"DT",RADTI,0)) Q:RAREGEX(0)']""
"RTN","RADLQ1",69,0)
 S RADIV("I")=+$P(RAREGEX(0),"^",3) Q:RADIV("I")=0
"RTN","RADLQ1",70,0)
 S RADIV("I")=$S($D(^RA(79,RADIV("I"),0)):$P(^(0),"^"),1:0)
"RTN","RADLQ1",71,0)
 S RADIV=$S($D(^DIC(4,RADIV("I"),0)):$P(^(0),"^"),1:0)
"RTN","RADLQ1",72,0)
 Q:'$D(^TMP($J,"RA D-TYPE",RADIV))
"RTN","RADLQ1",73,0)
 S RADIV=RADIV("I"),RAPAT(0)=$G(^DPT(RADFN,0))
"RTN","RADLQ1",74,0)
 S RANME=$S($P(RAPAT(0),"^")]"":$P(RAPAT(0),"^"),1:"Unknown")
"RTN","RADLQ1",75,0)
 S RASSN=$$SSN^RAUTL
"RTN","RADLQ1",76,0)
 S RAEXAM(0)=$G(^RADPT(RADFN,"DT",RADTI,"P",RACNI,0)) Q:RAEXAM(0)']""
"RTN","RADLQ1",77,0)
 S RAIPHY="Unknown"
"RTN","RADLQ1",78,0)
 S:$P(RAEXAM(0),"^",15)]"" RAIPHY=$P($G(^VA(200,+$P(RAEXAM(0),"^",15),0)),"^")
"RTN","RADLQ1",79,0)
 S:$P(RAEXAM(0),"^",12)]""&(RAIPHY="Unknown") RAIPHY=$P($G(^VA(200,+$P(RAEXAM(0),"^",12),0)),"^")
"RTN","RADLQ1",80,0)
 K RATECH S RATD4=+$O(^RADPT(RADFN,"DT",RADTI,"P",RACNI,"TC",0))
"RTN","RADLQ1",81,0)
 I RATD4 D  ; Obtain the first 'tech' encountered
"RTN","RADLQ1",82,0)
 . S RATECH=$E($$GET1^DIQ(200,+$G(^RADPT(RADFN,"DT",RADTI,"P",RACNI,"TC",RATD4,0))_",",.01),1,15)
"RTN","RADLQ1",83,0)
 . Q
"RTN","RADLQ1",84,0)
 K RATD4 S:'$L($G(RATECH)) RATECH="Unknown"
"RTN","RADLQ1",85,0)
 S RACN=+$P(RAEXAM(0),"^"),RAPRC=+$P(RAEXAM(0),"^",2)
"RTN","RADLQ1",86,0)
 S RAPRC=$S($D(^RAMIS(71,RAPRC,0)):$P(^(0),"^"),1:"Unknown")
"RTN","RADLQ1",87,0)
 S RAST=+$P(RAEXAM(0),"^",3),RADT=$P(RADTE,".")
"RTN","RADLQ1",88,0)
 S RAITYPE("I")=$S($D(^RA(72,RAST,0)):+$P(^(0),"^",7),1:0)
"RTN","RADLQ1",89,0)
 S RAITYPE=$S($D(^RA(79.2,RAITYPE("I"),0)):$P(^(0),"^"),1:"Unknown")
"RTN","RADLQ1",90,0)
 Q:'$D(^TMP($J,"RA I-TYPE",RAITYPE))
"RTN","RADLQ1",91,0)
 S:'$D(^RA(72,RAST,0)) RAST="Unknown"
"RTN","RADLQ1",92,0)
 S:$D(^RA(72,RAST,0)) RAST=$P(^(0),"^")
"RTN","RADLQ1",93,0)
 S RADT=$E(RADT,4,5)_"/"_$E(RADT,6,7)_"/"_$E(RADT,2,3)
"RTN","RADLQ1",94,0)
 ; 6th piece: Ward Location          <-> 8th piece: Principal Clinic
"RTN","RADLQ1",95,0)
 ; 9th piece: Contact/Sharing Source <-> 17th piece: Report Text
"RTN","RADLQ1",96,0)
 F RA=6,8,9,17 S RA(RA)=+$P(RAEXAM(0),"^",RA)
"RTN","RADLQ1",97,0)
 S RA("R")=$G(^RADPT(RADFN,"DT",RADTI,"P",RACNI,"R"))
"RTN","RADLQ1",98,0)
 S RAWHE=$S($D(^DIC(42,RA(6),0)):$P(^(0),"^"),$D(^SC(RA(8),0)):$P(^(0),"^"),$D(^DIC(34,RA(9),0)):$P(^(0),"^"),RA("R")]"":RA("R"),1:"Unknown")
"RTN","RADLQ1",99,0)
 S RAVAR=$S($D(^DIC(42,RA(6),0)):"I",1:"O")
"RTN","RADLQ1",100,0)
 Q:RASORT1'="B"&(RASORT1'=RAVAR)
"RTN","RADLQ1",101,0)
 S RARP=$S(+$O(^RARPT(RA(17),"R",0)):"Yes",+$O(^RARPT(RA(17),"I",0)):"Yes",1:"No")
"RTN","RADLQ1",102,0)
 S RAVRFIED=$P($G(^RARPT(RA(17),0)),U,5) S RAVRFIED=$S(RAVRFIED="D":"Draft",RAVRFIED="R":"Released",RAVRFIED="PD":"Prb Drft",RAVRFIED="V":"Verified",RAVRFIED="EF":"Elec. F.",1:"No Rpt")
"RTN","RADLQ1",103,0)
 I $D(ZTQUEUED) D STOPCHK^RAUTL9 S:$G(ZTSTOP)=1 RAXIT=1 Q:RAXIT
"RTN","RADLQ1",104,0)
 ;S ^TMP($J,"RADLQ",RADIV,RAITYPE,RAVAR,$S(RASORT2="P":RANME,1:$P(RADTE,".")),$S(RASORT2="P":$P(RADTE,"."),1:RANME),RACN)=RACN_"^"_RAPRC_"^"_RAST_"^"_RADT_"^"_RAWHE_"^"_RARP_"^"_RASSN_"^"_RAVRFIED_"^"_RAIPHY_"^"_RATECH
"RTN","RADLQ1",105,0)
 N RASSAN,RACNDSP S RASSAN=$$SSANVAL^RAHLRU1(RADFN,RADTI,RACNI)
"RTN","RADLQ1",106,0)
 I ($O(^RARPT(RA(17),2005,0))) S RACN=RACN_" i" I RASSAN]"" S RASSAN=RASSAN_"i" ;Images captured indicator -P137/KLM
"RTN","RADLQ1",107,0)
 S RACNDSP=$S((RASSAN'=""):RASSAN,1:RACN)
"RTN","RADLQ1",108,0)
 I $$USESSAN^RAHLRU1() D
"RTN","RADLQ1",109,0)
 .S ^TMP($J,"RADLQ",RADIV,RAITYPE,RAVAR,$S(RASORT2="P":RANME,1:$P(RADTE,".")),$S(RASORT2="P":$P(RADTE,"."),1:RANME),RACN)=RACNDSP_"^"_RAPRC_"^"_RAST_"^"_RADT_"^"_RAWHE_"^"_RARP_"^"_RASSN_"^"_RAVRFIED_"^"_RAIPHY_"^"_RATECH
"RTN","RADLQ1",110,0)
 I '$$USESSAN^RAHLRU1() D
"RTN","RADLQ1",111,0)
 .S ^TMP($J,"RADLQ",RADIV,RAITYPE,RAVAR,$S(RASORT2="P":RANME,1:$P(RADTE,".")),$S(RASORT2="P":$P(RADTE,"."),1:RANME),RACN)=RACN_"^"_RAPRC_"^"_RAST_"^"_RADT_"^"_RAWHE_"^"_RARP_"^"_RASSN_"^"_RAVRFIED_"^"_RAIPHY_"^"_RATECH
"RTN","RADLQ1",112,0)
 S ^TMP($J,"RADLQ")=+$G(^TMP($J,"RADLQ"))+1
"RTN","RADLQ1",113,0)
 S ^TMP($J,"RADLQ",RADIV)=+$G(^TMP($J,"RADLQ",RADIV))+1
"RTN","RADLQ1",114,0)
 S ^TMP($J,"RADLQ",RADIV,RAITYPE)=+$G(^TMP($J,"RADLQ",RADIV,RAITYPE))+1
"RTN","RADLQ1",115,0)
 S ^TMP($J,"RADLQ",RADIV,RAITYPE,RAVAR)=+$G(^TMP($J,"RADLQ",RADIV,RAITYPE,RAVAR))+1
"RTN","RADLQ1",116,0)
 Q
"RTN","RAEDCN")
0^4^B86443933^B69681618
"RTN","RAEDCN",1,0)
RAEDCN ;HISC/CAH,FPT,GJC,SS AISC/MJK,RMO-Edit Exams by Case Number ;10 Apr 2018 2:03 PM
"RTN","RAEDCN",2,0)
 ;;5.0;Radiology/Nuclear Medicine;**5,13,10,18,28,31,34,45,85,97,124**;Mar 16, 1998;Build 4
"RTN","RAEDCN",3,0)
 ;
"RTN","RAEDCN",4,0)
 ; 06/11/2007 KAM/BAY RA*5*85 Remedy Call 174790 Change Exam Cancel
"RTN","RAEDCN",5,0)
 ;            to allow only descendent exams with stub report
"RTN","RAEDCN",6,0)
 ;
"RTN","RAEDCN",7,0)
 ;last modified by SS JUNE 21,2000 for P18
"RTN","RAEDCN",8,0)
START D SET^RAPSET1 I $D(XQUIT) K XQUIT,RAFLG,RADR,POP,RAQUICK Q
"RTN","RAEDCN",9,0)
START1 ;
"RTN","RAEDCN",10,0)
 N RAERR
"RTN","RAEDCN",11,0)
 D ^RACNLU S RAERR=0 G EXIT:X="^"
"RTN","RAEDCN",12,0)
 I RADR="[RA DIAGNOSTIC BY CASE]" D  I RAERR R !?5,"Press RETURN to exit:",RAXIT:DTIME G EXIT
"RTN","RAEDCN",13,0)
 .N RAPRTSET,RAMEMARR,RA3,RA7003,RA17
"RTN","RAEDCN",14,0)
 .D EN2^RAUTL20(.RAMEMARR)
"RTN","RAEDCN",15,0)
 .S RA3=99
"RTN","RAEDCN",16,0)
 .; disallow case that is a member of a printset, fld 25 = 2
"RTN","RAEDCN",17,0)
 .I RAPRTSET W ! D WHYMSG2^RASTED S RAERR=1 Q
"RTN","RAEDCN",18,0)
 .S RA7003=$G(^RADPT(RADFN,"DT",RADTI,"P",RACNI,0))
"RTN","RAEDCN",19,0)
 .S RA17=$P(RA7003,U,17)
"RTN","RAEDCN",20,0)
 .; disallow case that has no report or has stub report
"RTN","RAEDCN",21,0)
 .I 'RA17!($$STUB^RAEDCN1(+RA17)) S RAERR=1 W !?3,$C(7),"No report has been entered yet for this exam, therefore it cannot be edited.",! Q
"RTN","RAEDCN",22,0)
 .; disallow case that has an elec. filed report
"RTN","RAEDCN",23,0)
 .I $P($G(^RARPT(+RA17,0)),U,5)="EF" S RAERR=1 D WARN1 Q
"RTN","RAEDCN",24,0)
 .Q
"RTN","RAEDCN",25,0)
 I $D(^RA(72,"AA",RAIMGTY,9,+RAST)),'$D(^XUSEC("RA MGR",+$G(DUZ))) W !!?3,$C(7),"You do not have the appropriate access privileges to edit completed exams." G START1
"RTN","RAEDCN",26,0)
 I $D(^RA(72,"AA",RAIMGTY,0,+RAST)) W !!?3,$C(7),"Exam has been 'cancelled' therefore it cannot be edited." G START1
"RTN","RAEDCN",27,0)
 I RADR="[RA DIAGNOSTIC BY CASE]",$D(^RARPT(RARPT,0)),$P(^(0),"^",5)="V" W !!?3,$C(7),"A report has been verified for this exam, therefore it cannot be edited.",! G START
"RTN","RAEDCN",28,0)
 S DA=RADFN,DIE("NO^")="OUTOK",DIE="^RADPT(",DR=RADR
"RTN","RAEDCN",29,0)
 I $D(RAFLG("EDIT"))!($D(RAFLG("DIAG"))) D  G:+$G(RAXIT) START1
"RTN","RAEDCN",30,0)
 . S RADADA=RADTI,RADIE="^RADPT("_RADFN_",""DT"","
"RTN","RAEDCN",31,0)
 . S RAXIT=$$LOCK^RAUTL12(RADIE,RADADA)
"RTN","RAEDCN",32,0)
 . Q
"RTN","RAEDCN",33,0)
 I RADR="[RA EXAM EDIT]" D
"RTN","RAEDCN",34,0)
 . N RADISPLY
"RTN","RAEDCN",35,0)
 . S RADISPLY=$G(^RAMIS(71,+$P($G(^RADPT(+RADFN,"DT",+RADTI,"P",+RACNI,0)),U,2),0)) ; set $ZR to 71 for prccpt^radd1, not call raprod since diff col
"RTN","RAEDCN",36,0)
 . S RADISPLY=$$PRCCPT^RADD1()
"RTN","RAEDCN",37,0)
 . W !,?24,RADISPLY
"RTN","RAEDCN",38,0)
 .;
"RTN","RAEDCN",39,0)
 .;save 'before' CM data value to compare against the possible 'after'
"RTN","RAEDCN",40,0)
 .;value
"RTN","RAEDCN",41,0)
 .D TRK70CMB^RAMAINU(RADFN,RADTI,RACNI,.RATRKCMB) ;RA*5*45
"RTN","RAEDCN",42,0)
 .;
"RTN","RAEDCN",43,0)
 . Q
"RTN","RAEDCN",44,0)
 D:RADR'="[RA NO PURGE SPECIFICATION]" SVBEFOR^RAO7XX(RADFN,RADTI,RACNI) ;P18 save before edit to compare it in RAUTL1 later
"RTN","RAEDCN",45,0)
 D ^DIE K DIE("NO^"),DE,DQ,DIE,DR,RAZCM
"RTN","RAEDCN",46,0)
 D:RADR'="[RA NO PURGE SPECIFICATION]" UP1^RAUTL1
"RTN","RAEDCN",47,0)
 ;
"RTN","RAEDCN",48,0)
 ;1) check data consistency between 'CONTRAST MEDIA USED' & 'CONTRAST
"RTN","RAEDCN",49,0)
 ;MEDIA'
"RTN","RAEDCN",50,0)
 ;2) check 'before' CM data against 'after' CM data, file in audit log
"RTN","RAEDCN",51,0)
 ;if necessary. Remember, contrast media asked when in input template:
"RTN","RAEDCN",52,0)
 ;RA EXAM EDIT (RA*5*45)
"RTN","RAEDCN",53,0)
 I RADR="[RA EXAM EDIT]" D
"RTN","RAEDCN",54,0)
 .S RACMDA=RACNI,RACMDA(1)=RADTI,RACMDA(2)=RADFN
"RTN","RAEDCN",55,0)
 .D XCMINTEG^RAMAINU1(.RACMDA) ;1
"RTN","RAEDCN",56,0)
 .D TRK70CMA^RAMAINU(RADFN,RADTI,RACNI,RATRKCMB) ;2
"RTN","RAEDCN",57,0)
 .K RACMDA Q
"RTN","RAEDCN",58,0)
 ;
"RTN","RAEDCN",59,0)
 I $D(RAFLG("EDIT"))!($D(RAFLG("DIAG"))) D UNLOCK^RAUTL12(RADIE,RADADA)
"RTN","RAEDCN",60,0)
 K RATRKCMB,RADUZ,RAZZ W ! G START1:'+$G(RAXIT)
"RTN","RAEDCN",61,0)
 ;
"RTN","RAEDCN",62,0)
EXIT ;clean up symbol table and exit
"RTN","RAEDCN",63,0)
 K %,%DT,%W,%X,%Y,%Y1,A,C,D0,D1,D2,DA,DIC,DIE,DIV,DK,I,ORIFN,ORVP,POP,RACN,RACNI,RACS,RACT,RADADA,RADATE,RADFN,RADIE,RADIV,RADR,RADTE,RADTI,RAEXFM,RAEXLBLS,RAFIN,RAFL,RAFLG,RAFLH,RAFLHFL,RAHEAD,RAI,RAJ
"RTN","RAEDCN",64,0)
 K RAMES,RANME,RANUM,RAOIFN,RAOR,RAORDIFN,RAOREA,RAORIFN,RAOSEL,RAOSTS,RAPOP,RAPRI,RAPRC,RAQUICK,RAPRIT,RARPT,RARPTZ,RASN,RASSN,RAST,RASTI,RAVW,X,XQUIT,VAINDT,VADMVT,Y,^TMP($J,"RAEX")
"RTN","RAEDCN",65,0)
 K %H,%I,D,D3,DDER,DI,DIW,DIWF,DIWI,DIWL,DIWR,DIWT,DIWTC,DIWX,DN,GMRAL,RAEXOR
"RTN","RAEDCN",66,0)
 K J,SDCLST,R1,RA,RACANC,RACN0,RACPT,RACPTNDE,RADA,RAEND,RAFELIG,RAFST
"RTN","RAEDCN",67,0)
 K RAIX,RAN,RAOBR4,RAPRCNDE,RAPROC,RAPROCIT,RAPRV,RAXIT,VA,VADM,VAERR,Z
"RTN","RAEDCN",68,0)
 K DFN,DIPGM,DISYS,DQ,DR,HLN,HLRESLT,HLSAN,RAAFTER,RABEFORE,X0
"RTN","RAEDCN",69,0)
 K DLAYGO,DDH,RADFLTP
"RTN","RAEDCN",70,0)
 Q
"RTN","RAEDCN",71,0)
 ;
"RTN","RAEDCN",72,0)
DIAG N RADIAG,RAXIT
"RTN","RAEDCN",73,0)
 S RAXIT=0,RAFLG("DIAG")="",RADR="[RA DIAGNOSTIC BY CASE]" G START
"RTN","RAEDCN",74,0)
 ;
"RTN","RAEDCN",75,0)
SAVE S RADR="[RA NO PURGE SPECIFICATION]" G START
"RTN","RAEDCN",76,0)
 ;
"RTN","RAEDCN",77,0)
EDIT ; Case No. Exam Edit
"RTN","RAEDCN",78,0)
 N RAEDIT,RAXIT
"RTN","RAEDCN",79,0)
 N RAREM,RANUZD1,RAPSDRUG,RA00,RADIOPH,RALOW,RAHI,RADRAWN,RAASK,RADOSE,RASKMEDS,RAWHICH ;these are used by the edit template
"RTN","RAEDCN",80,0)
 S RAXIT=0,RAFLG("EDIT")="",RAQUICK=1,RADR="[RA EXAM EDIT]" G START
"RTN","RAEDCN",81,0)
 ;
"RTN","RAEDCN",82,0)
CANCEL ;new w/RA5p124
"RTN","RAEDCN",83,0)
 D SET^RAPSET1 ;checks for DUZ if not defined we exit
"RTN","RAEDCN",84,0)
 I $D(XQUIT) K XQUIT Q
"RTN","RAEDCN",85,0)
 ;
"RTN","RAEDCN",86,0)
 ;check for EXAM CANCELLED ("C") 0 if found, else 1
"RTN","RAEDCN",87,0)
 Q:$$CKREASON^RAEDCN1("C")=1  ;RA5P124
"RTN","RAEDCN",88,0)
 ;
"RTN","RAEDCN",89,0)
 ;*** this code down to ASKCAN stays w/124 ***
"RTN","RAEDCN",90,0)
 D ^RACNLU G EXIT:X="^" I $D(^RA(72,"AA",RAIMGTY,0,+RAST)) W !?3,$C(7),"This exam has already been cancelled!" G EXIT
"RTN","RAEDCN",91,0)
 I $D(^RA(72,+RAST,0)),$P(^(0),"^",6)'="y" W !?3,$C(7),"This exam is in the '",$P(^(0),"^"),"' status and cannot be 'CANCELLED'." G EXIT
"RTN","RAEDCN",92,0)
 ; 06/11/2007 KAM/BAY *85 Added descendent check to next line
"RTN","RAEDCN",93,0)
ASKIMG I RARPT,($$STUB^RAEDCN1(RARPT)),($$PSET^RAEDCN1(RADFN,RADTI,RACNI)) D  G:"Nn"[$E(X) EXIT G:"Yy"[$E(X) ASKCAN W:X'["?" $C(7) W !!?3,"Enter 'YES' to cancel a descendent exam with images, or 'NO' not to." G ASKIMG
"RTN","RAEDCN",94,0)
 . S X=RANME_"'s Case No. "_$E(RADTE,4,7)_$E(RADTE,1,2)_"-"_RACN
"RTN","RAEDCN",95,0)
 . W !!?10,"----------------------------------",$C(7)
"RTN","RAEDCN",96,0)
 . W !?10,X
"RTN","RAEDCN",97,0)
 . W !?10,"This descendent exam has associated images.",$C(7)
"RTN","RAEDCN",98,0)
 . W !?10,"----------------------------------",$C(7)
"RTN","RAEDCN",99,0)
 . I '$D(^XUSEC("RA MGR",DUZ)) D  S X="N" Q
"RTN","RAEDCN",100,0)
 .. W !!?3,"** You do not have the  RA MGR  key to cancel an exam with images. **",$C(7)
"RTN","RAEDCN",101,0)
 .. R !!?10,"Press RETURN to continue.",X:DTIME
"RTN","RAEDCN",102,0)
 .. Q
"RTN","RAEDCN",103,0)
 . R !!,"Do you really want to cancel this exam with images? NO//",X:DTIME S:'$T!(X="")!(X["^") X="N"
"RTN","RAEDCN",104,0)
 . Q
"RTN","RAEDCN",105,0)
 ;
"RTN","RAEDCN",106,0)
 I RARPT W !?3,$C(7),"A report has been filed for this case. Therefore cancellation is not allowed!" G EXIT
"RTN","RAEDCN",107,0)
 ;
"RTN","RAEDCN",108,0)
 ;is someone editing this patient record? if yes, quit (check moved w/RA5p124)
"RTN","RAEDCN",109,0)
 L +^RADPT(RADFN):1 I '$T W !,$C(7),"Someone else is editing the patient you selected",!,"Please try later" K RADTE,RACN,RAPOP,RADUZ G EXIT
"RTN","RAEDCN",110,0)
 ; you set a lock, you must clear it!
"RTN","RAEDCN",111,0)
 ;
"RTN","RAEDCN",112,0)
ASKCAN ;interact with the user use DIR RA5p124
"RTN","RAEDCN",113,0)
 N %,DIR,DIROUT,DIRUT,DTOUT,DUOUT,RAY2,RAY3,X,Y
"RTN","RAEDCN",114,0)
 S DIR(0)="Y",DIR("B")="NO"
"RTN","RAEDCN",115,0)
 S DIR("?")="Enter 'YES' to cancel this exam. or 'NO' not to."
"RTN","RAEDCN",116,0)
 S DIR("A")="Do you wish to cancel this exam now"
"RTN","RAEDCN",117,0)
 D ^DIR
"RTN","RAEDCN",118,0)
 ;Yes/No: Y=1 for yes else Y=0 for no
"RTN","RAEDCN",119,0)
 ;$D(DIRUT) indicates caret or timeout
"RTN","RAEDCN",120,0)
 I $D(DIRUT)!(Y=0) D  Q
"RTN","RAEDCN",121,0)
 .L -^RADPT(RADFN) ;unlock
"RTN","RAEDCN",122,0)
 .D EXIT ;cleanup vars
"RTN","RAEDCN",123,0)
 .Q
"RTN","RAEDCN",124,0)
 ;/ end askcan /
"RTN","RAEDCN",125,0)
 ;
"RTN","RAEDCN",126,0)
 ;When an exam is cancelled & it is associated with data in the Nuc
"RTN","RAEDCN",127,0)
 ;Med Exam Data file (70.2) ask the user if this pointer to 70.2 is
"RTN","RAEDCN",128,0)
 ;to be deleted.  Also delete the flag 'Dosage Ticket Printed?' which
"RTN","RAEDCN",129,0)
 ;indicates that the dosage ticket had printed for this exam.
"RTN","RAEDCN",130,0)
 D DELPNT^RAUTL20(RADFN,RADTI,RACNI)
"RTN","RAEDCN",131,0)
 ;
"RTN","RAEDCN",132,0)
 ;get TECHNOLOGIST COMMENT & REASON FOR CANCELLATION (both optional)
"RTN","RAEDCN",133,0)
 K DIR,DIROUT,DIRUT,DTOUT,DUOUT
"RTN","RAEDCN",134,0)
 S RATCOM=$$GETTCOM^RAUTL11(RADFN,RADTI,RACNI) ;pseudo default
"RTN","RAEDCN",135,0)
 S DIR(0)="70.07,4A",DIR("A")="TECHNOLOGIST COMMENT: "_RATCOM_"//" D ^DIR
"RTN","RAEDCN",136,0)
 I $D(DUOUT)#2!($D(DTOUT)#2) L -^RADPT(RADFN) D EXIT QUIT 
"RTN","RAEDCN",137,0)
 S RATCOM=$P(Y,U)
"RTN","RAEDCN",138,0)
 ;
"RTN","RAEDCN",139,0)
 K DIR,DIROUT,DIRUT,DTOUT,DUOUT
"RTN","RAEDCN",140,0)
 S DIR(0)="70.03,3.5^^I ""^1^9^""[(U_$P(^(0),U,2)_U)",DIR("A")="REASON FOR CANCELLATION" D ^DIR
"RTN","RAEDCN",141,0)
 I $D(DUOUT)#2!($D(DTOUT)#2) L -^RADPT(RADFN) D EXIT QUIT
"RTN","RAEDCN",142,0)
 S RAREASON=+Y ;a pointer value
"RTN","RAEDCN",143,0)
 ;
"RTN","RAEDCN",144,0)
 ;(we've not canceled the exam just yet)
"RTN","RAEDCN",145,0)
 S RAY2=$G(^RADPT(RADFN,"DT",RADTI,0)) ;70.02
"RTN","RAEDCN",146,0)
 S RAY3=$G(^RADPT(RADFN,"DT",RADTI,"P",RACNI,0)) ;70.03
"RTN","RAEDCN",147,0)
 S RAOIFN=+$P(RAY3,U,11)
"RTN","RAEDCN",148,0)
 ;
"RTN","RAEDCN",149,0)
 ;In EXMCAN^RAORDC the logic (EN1^RASETU) is called to check
"RTN","RAEDCN",150,0)
 ;if there are multiple studies registered for the same date/time.
"RTN","RAEDCN",151,0)
 ;RAEXOR = the ORDER of the exam status for the exam in play
"RTN","RAEDCN",152,0)
 ;RAOSTS = is the request status the order will be set to.
"RTN","RAEDCN",153,0)
 S (RAEXOR,RAOSTS)=0 D EXMCAN^RAORDC
"RTN","RAEDCN",154,0)
 ;
"RTN","RAEDCN",155,0)
 ;check if the user times out or ^'s out (function returns -1)
"RTN","RAEDCN",156,0)
 ;when asked if they want to cancel the order in RAORDC.
"RTN","RAEDCN",157,0)
 I RAOSTS=-1 L -^RADPT(RADFN) Q
"RTN","RAEDCN",158,0)
 ;
"RTN","RAEDCN",159,0)
 ;cancel the exam, update exam status tracking and activity logs
"RTN","RAEDCN",160,0)
 D CANCEL^RAEDCN1
"RTN","RAEDCN",161,0)
 ;release the lock
"RTN","RAEDCN",162,0)
 L -^RADPT(RADFN)
"RTN","RAEDCN",163,0)
 ;
"RTN","RAEDCN",164,0)
PACS ;call all RA CANCEL* event drivers only if the order status
"RTN","RAEDCN",165,0)
 ;and exam status have been updated! this is a new LOCK series
"RTN","RAEDCN",166,0)
 D CANCEL^RAHLRPC
"RTN","RAEDCN",167,0)
 D EXIT ;cleanup
"RTN","RAEDCN",168,0)
 QUIT
"RTN","RAEDCN",169,0)
 ;
"RTN","RAEDCN",170,0)
 ;
"RTN","RAEDCN",171,0)
DUP ; Option: RA FLASH
"RTN","RAEDCN",172,0)
 N RAREGX,RAYN D SET^RAPSET1 I $D(XQUIT) K XQUIT,POP Q
"RTN","RAEDCN",173,0)
DUP1 D ^RACNLU G EXIT:X="^"
"RTN","RAEDCN",174,0)
 G EXIT:'$D(^RADPT(RADFN,"DT",RADTI,0))
"RTN","RAEDCN",175,0)
 S RAREGX(0)=$G(^RADPT(RADFN,"DT",RADTI,0))
"RTN","RAEDCN",176,0)
 S RAREGX(4)=+$P(RAREGX(0),"^",4)
"RTN","RAEDCN",177,0)
 I +$G(RAMLC)'=RAREGX(4) D  I $P(RAYN,"^",2) D EXIT QUIT
"RTN","RAEDCN",178,0)
 . W !!?3,"Your sign-on location is: "
"RTN","RAEDCN",179,0)
 . W $P($G(^SC(+$G(^RA(79.1,+$G(RAMLC),0)),0)),"^")_".  The location"
"RTN","RAEDCN",180,0)
 . W !?3,"of case ",RACN," is "
"RTN","RAEDCN",181,0)
 . W $P($G(^SC(+$G(^RA(79.1,RAREGX(4),0)),0)),"^"),".",!
"RTN","RAEDCN",182,0)
 . K DIR,DIROUT,DIRUT,DTOUT,DUOUT S DIR(0)="Y",DIR("B")="Yes"
"RTN","RAEDCN",183,0)
 . S DIR("?")="Enter 'Y'es to switch locations or 'N'o exit the option."
"RTN","RAEDCN",184,0)
 . S DIR("A")="Do you wish to switch Imaging Locations" D ^DIR
"RTN","RAEDCN",185,0)
 . S RAYN=+Y_"^"_$S($D(DIRUT):1,1:0)
"RTN","RAEDCN",186,0)
 . K DIR,DIROUT,DIRUT,DTOUT,DUOUT  Q:'+RAYN  ; quit if no
"RTN","RAEDCN",187,0)
 . D KILL^RAPSET1,SET^RAPSET1 ; else switch locations
"RTN","RAEDCN",188,0)
 . I $D(XQUIT) S $P(RAYN,"^",2)=1 K XQUIT
"RTN","RAEDCN",189,0)
 . Q
"RTN","RAEDCN",190,0)
 S ION=$P(RAMLC,"^",3) ; imaging location flash card printer (if any)
"RTN","RAEDCN",191,0)
 G EXIT:'$D(^RADPT(RADFN,"DT",RADTI,"P",RACNI,0)) S Y=^(0),Y=$S($D(^RAMIS(71,+$P(Y,"^",2),0)):$P(^(0),"^",3),1:"")
"RTN","RAEDCN",192,0)
 ; if Y, then convert the pointer value 'Y' to the .01 value of
"RTN","RAEDCN",193,0)
 ; the procedure flash card printer (if any)
"RTN","RAEDCN",194,0)
 I Y]"",$D(^%ZIS(1,+Y,0)) D
"RTN","RAEDCN",195,0)
 . S Y(0)=$$GET1^DIQ(3.5,+Y,.01) ; .01 value for proc flash card printer
"RTN","RAEDCN",196,0)
 . S:Y(0)'=$P(RAMLC,"^",3) ION=Y(0) K Y(0)
"RTN","RAEDCN",197,0)
 . ; if flash card printer for the imaging location differs from
"RTN","RAEDCN",198,0)
 . ; the procedure flash card printer, default (print to) to the flash
"RTN","RAEDCN",199,0)
 . ; card printer for the procedure.
"RTN","RAEDCN",200,0)
 . Q
"RTN","RAEDCN",201,0)
 S RAMES="W !!,""Duplicates queued to print on "",ION,"".""",RAFLH=$S($P(RAMLC,"^",7):$P(RAMLC,"^",7),1:1),RAEXFM=$S($P(RAMLC,"^",9):$P(RAMLC,"^",9),1:1),RAFLHFL=RACNI
"RTN","RAEDCN",202,0)
FLH ; Flash Cards
"RTN","RAEDCN",203,0)
 R !,"How many flash cards? 1// ",X:DTIME G DUP1:'$T!(X["^") S:X="" X=1 S RANUM=X I '(RANUM?.N)!(RANUM>20) W !?3,$C(7),"Must be a whole number less than 21!" G FLH
"RTN","RAEDCN",204,0)
EXM ; Exam Labels
"RTN","RAEDCN",205,0)
 R !,"How many exam labels? 1// ",X:DTIME G DUP1:'$T!(X["^") S:X="" X=1 S RAEXLBLS=X I '(RAEXLBLS?.N)!(RAEXLBLS>20) W !?3,$C(7),"Must be a whole number less than 21!" G EXM
"RTN","RAEDCN",206,0)
 S IOP="Q" S:ION]"" RADFLTP=ION
"RTN","RAEDCN",207,0)
 K RAFL D Q^RAFLH,EXIT G DUP1
"RTN","RAEDCN",208,0)
 ;
"RTN","RAEDCN",209,0)
SETVARS ; Setup key Rad/Nuc Med variables
"RTN","RAEDCN",210,0)
 I $O(RACCESS(DUZ,""))="" D SETVARS^RAPSET1(0)
"RTN","RAEDCN",211,0)
 Q:'($D(RACCESS(DUZ))\10)  ; user does not have location access
"RTN","RAEDCN",212,0)
 I $G(RAIMGTY)="" D SETVARS^RAPSET1(1) K:$G(RAIMGTY)="" XQUIT
"RTN","RAEDCN",213,0)
 Q
"RTN","RAEDCN",214,0)
WARN1 W !?3,"An electronically filed report has already been entered for this case.",!?3,"Please use the 'Outside Report Entry/Edit' option to change or enter",!?3,"diagnostic code for this case.",!!
"RTN","RAEDCN",215,0)
 Q
"RTN","RAEDCN1")
0^5^B33553428^B15841829
"RTN","RAEDCN1",1,0)
RAEDCN1 ;HISC/GJC-Utility routine for RAEDCN ;06 Nov 2018 9:23 AM
"RTN","RAEDCN1",2,0)
 ;;5.0;Radiology/Nuclear Medicine;**18,45,93,106,113,124**;Mar 16, 1998;Build 4
"RTN","RAEDCN1",3,0)
 ; last modif by SS for P18
"RTN","RAEDCN1",4,0)
 ; 07/15/2008 BAY/KAM rem call 249750 RA*5*93 Correct DIK Calls
"RTN","RAEDCN1",5,0)
 ;
"RTN","RAEDCN1",6,0)
 ;Routine              IA          Type
"RTN","RAEDCN1",7,0)
 ;-------------------------------------
"RTN","RAEDCN1",8,0)
 ;APPERROR^%ZTER       1621        (S)
"RTN","RAEDCN1",9,0)
 ;
"RTN","RAEDCN1",10,0)
UNDEF ; Message for undefined imaging types
"RTN","RAEDCN1",11,0)
 I '+$G(RAMLC) D  Q
"RTN","RAEDCN1",12,0)
 . W !?5,"Imaging Location data is not defined, "
"RTN","RAEDCN1",13,0)
 . W "contact IRM.",$C(7)
"RTN","RAEDCN1",14,0)
 . Q
"RTN","RAEDCN1",15,0)
 W !?5,"An Imaging Type was not defined for the following Imaging"
"RTN","RAEDCN1",16,0)
 W !?5,"Location: "_$P(^SC($P($G(^RA(79.1,+RAMLC,0)),U),0),U)_"."
"RTN","RAEDCN1",17,0)
 Q
"RTN","RAEDCN1",18,0)
 ;
"RTN","RAEDCN1",19,0)
STUB(RARPT) ; Determine if this is an imaging stub report.
"RTN","RAEDCN1",20,0)
 ; Input : RARPT: IEN of the report record
"RTN","RAEDCN1",21,0)
 ; Output: 1 if an imaging stub report, else 0
"RTN","RAEDCN1",22,0)
 ;
"RTN","RAEDCN1",23,0)
 ;new business rules with the advent of RA*5.0*106. An
"RTN","RAEDCN1",24,0)
 ;'images collected' (Activity Log, TYPE OF ACTION field)
"RTN","RAEDCN1",25,0)
 ;event no longer defines a stub report. A stub report is
"RTN","RAEDCN1",26,0)
 ;defined as a report with the following traits:
"RTN","RAEDCN1",27,0)
 ;-------------------------------------------------------
"RTN","RAEDCN1",28,0)
 ;* Has attached images
"RTN","RAEDCN1",29,0)
 ;* Does not have a REPORT STATUS value
"RTN","RAEDCN1",30,0)
 ;* Does not have impression text
"RTN","RAEDCN1",31,0)
 ;* Does not have a problem statement
"RTN","RAEDCN1",32,0)
 ;* Does not have report text
"RTN","RAEDCN1",33,0)
 ;
"RTN","RAEDCN1",34,0)
 ;sanity check
"RTN","RAEDCN1",35,0)
 Q:RARPT'>0 0 Q:'($D(^RARPT(RARPT,0))#2) 0
"RTN","RAEDCN1",36,0)
 ;
"RTN","RAEDCN1",37,0)
 I $P(^RARPT(RARPT,0),U,5)="",$O(^RARPT(RARPT,2005,0)),'$D(^RARPT(RARPT,"I")),'$D(^("P")),'$D(^("R")) Q 1
"RTN","RAEDCN1",38,0)
 Q 0
"RTN","RAEDCN1",39,0)
 ;
"RTN","RAEDCN1",40,0)
PSET(RADFN,RADTI,RACNI) ; Determine if this exam is part of a printset.
"RTN","RAEDCN1",41,0)
 ; Input: RADFN-patient dfn <-> RADTI-exam timestamp <-> RACNI-exam ien
"RTN","RAEDCN1",42,0)
 ; Output: 1 if part of a printset, else 0
"RTN","RAEDCN1",43,0)
 Q $S($P($G(^RADPT(RADFN,"DT",RADTI,"P",RACNI,0)),"^",25)=2:1,1:0)
"RTN","RAEDCN1",44,0)
 ;
"RTN","RAEDCN1",45,0)
CKREASON(X) ;check file 75.2 ; P18 moved it from RAEDCN because the routine's length exceeded limit
"RTN","RAEDCN1",46,0)
 ; 0=OKAY, 1=BAD
"RTN","RAEDCN1",47,0)
 ; don't check for var RAOREA, because it's not set this early
"RTN","RAEDCN1",48,0)
 I X="C",$O(^RA(75.2,"B","EXAM CANCELLED",0)) Q 0
"RTN","RAEDCN1",49,0)
 I X="D",$O(^RA(75.2,"B","EXAM DELETED",0)) Q 0
"RTN","RAEDCN1",50,0)
 W !!?5,$S(X="C":"Cancellation",1:"Deletion")," cannot be done, because your file #75.2,"
"RTN","RAEDCN1",51,0)
 W !?5,"RAD/NUC MED REASON, does not have ""EXAM ",$S(X="C":"CANCELLED",1:"DELETED"),"""","."
"RTN","RAEDCN1",52,0)
 W !!?5,"Please notify your ADPAC.",!
"RTN","RAEDCN1",53,0)
 K DIR S DIR(0)="E",DIR("A")="Press RETURN for menu options" D ^DIR K DIR,DIROUT,DIRUT,DTOUT,DUOUT
"RTN","RAEDCN1",54,0)
 Q 1
"RTN","RAEDCN1",55,0)
 ;
"RTN","RAEDCN1",56,0)
DEL ; 'Exam Deletion' option (RA DELETEXAM)
"RTN","RAEDCN1",57,0)
 D SETVARS^RAEDCN Q:'($D(RACCESS(DUZ))\10)!('$D(RAIMGTY))
"RTN","RAEDCN1",58,0)
 S RAXIT=$$CKREASON^RAEDCN1("D") I RAXIT K RAXIT Q  ;P18
"RTN","RAEDCN1",59,0)
DEL1 D ^RACNLU G EXIT^RAEDCN:X="^"
"RTN","RAEDCN1",60,0)
 I RARPT W !?3,$C(7),"A report has been filed for this case. Therefore deletion is not allowed!" G DEL1
"RTN","RAEDCN1",61,0)
ASKDEL R !!,"Do you wish to delete this exam? NO// ",X:DTIME S:'$T!(X="")!(X["^") X="N" G DEL1:"Nn"[$E(X) I "Yy"'[$E(X) W:X'["?" $C(7) W !!,"Enter 'YES' to delete this exam, or 'NO' not to." G ASKDEL
"RTN","RAEDCN1",62,0)
 L +^RADPT(RADFN,"DT",RADTI):1 I '$T W !,$C(7),"Someone else is editing an exam for this patient on the date/time",!,"you selected. Please try Later" G DEL1
"RTN","RAEDCN1",63,0)
 S RADELFLG="" D ^RAORDC
"RTN","RAEDCN1",64,0)
 ; trigger RA CANCEL protocol on xam delete if xam not already cancelled
"RTN","RAEDCN1",65,0)
 S RA7003=$G(^RADPT(RADFN,"DT",RADTI,"P",RACNI,0)),X=+$P(RA7003,"^",3)
"RTN","RAEDCN1",66,0)
 ; no rpt filed, xam status exists & not cancelled -OR- xam status
"RTN","RAEDCN1",67,0)
 ; non-existent.
"RTN","RAEDCN1",68,0)
 I $P($G(^RA(72,X,0)),U,3)'=0 D
"RTN","RAEDCN1",69,0)
 . K RAIENS,RAERR S RAIENS=""_RACNI_","_RADTI_","_RADFN_","_"",RAFDA(70.03,RAIENS,3)="CANCELLED" D FILE^DIE("KSE","RAFDA","RAERR") K RAIENS,RAERR,RAFDA D CANCEL^RAHLRPC
"RTN","RAEDCN1",70,0)
 . Q
"RTN","RAEDCN1",71,0)
 K RA7003 S RABULL="",DA(2)=RADFN,DA(1)=RADTI,DA=RACNI
"RTN","RAEDCN1",72,0)
 S RAYY=$P($G(^RADPT(RADFN,"DT",RADTI,"P",RACNI,1)),U,1)
"RTN","RAEDCN1",73,0)
 ;S DIK="^RADPT(DA(2),""DT"",DA(1),""P""," D ^DIK
"RTN","RAEDCN1",74,0)
 S DIK="^RADPT("_DA(2)_",""DT"","_DA(1)_",""P""," D ^DIK
"RTN","RAEDCN1",75,0)
 W !?10,"...deletion of exam complete."
"RTN","RAEDCN1",76,0)
 ; --- delete the associated Rad dosage record RA5p113 ---
"RTN","RAEDCN1",77,0)
 D:RAYY>0 DEL^RADUTL(RAYY)
"RTN","RAEDCN1",78,0)
 ; --- end RA5P113
"RTN","RAEDCN1",79,0)
 K %,D,D0,D1,D2,DA,DIC,DIK,RADELFLG,RABULL,RAPRTZ,RAAFTER,RABEFORE,RAYY
"RTN","RAEDCN1",80,0)
 ; Check if one exam or multiple exams exists below "DT" node.
"RTN","RAEDCN1",81,0)
 ; If no exams are present, delete "DT" node.
"RTN","RAEDCN1",82,0)
 I '+$O(^RADPT(RADFN,"DT",RADTI,"P",0)) D
"RTN","RAEDCN1",83,0)
 . K DA,DIK S DA(1)=RADFN,DA=RADTI
"RTN","RAEDCN1",84,0)
 . ; S DIK="^RADPT(DA(1),""DT""," D ^DIK
"RTN","RAEDCN1",85,0)
 . S DIK="^RADPT("_DA(1)_",""DT""," D ^DIK
"RTN","RAEDCN1",86,0)
 . K DA,DIK Q
"RTN","RAEDCN1",87,0)
 L -^RADPT(RADFN,"DT",RADTI)
"RTN","RAEDCN1",88,0)
 G DEL1
"RTN","RAEDCN1",89,0)
 ;
"RTN","RAEDCN1",90,0)
VIEW ; 'View Exam by Case No.' option (RA VIEWCN)
"RTN","RAEDCN1",91,0)
 D SETVARS^RAEDCN Q:'($D(RACCESS(DUZ))\10)!('$D(RAIMGTY))
"RTN","RAEDCN1",92,0)
 S RAVW="" D ^RACNLU G EXIT^RAEDCN:X="^" K RAFL D ^RAPROD D EXIT^RAEDCN G VIEW
"RTN","RAEDCN1",93,0)
 ;
"RTN","RAEDCN1",94,0)
 ;
"RTN","RAEDCN1",95,0)
CANCEL ;cancel exam status
"RTN","RAEDCN1",96,0)
 N DA,DIERR,RA124EXST,RAERR,RAERROR,RAFDA,RAIENS,RAR
"RTN","RAEDCN1",97,0)
 ;get correct imaging type/cancelled
"RTN","RAEDCN1",98,0)
 ;is RAIMGTY defined? if so use it, else set it
"RTN","RAEDCN1",99,0)
 ;Note: RAY2 & RAY3 are defined in RAEDCN.
"RTN","RAEDCN1",100,0)
 ;
"RTN","RAEDCN1",101,0)
 I '$D(RAIMGTY)#2 D
"RTN","RAEDCN1",102,0)
 .S RAIMGTY=$P($G(^RA(79.2,+$P(RAY2,U,2),0)),U) ;xternal
"RTN","RAEDCN1",103,0)
 .Q
"RTN","RAEDCN1",104,0)
 I RAIMGTY="" D  Q
"RTN","RAEDCN1",105,0)
 .D ERROR("RA: IMAGING TYPE DEFINITION ERROR")
"RTN","RAEDCN1",106,0)
 .W !!,"WARNING: CANCEL AN EXAM option aborted: Imaging Type definition error.",!!
"RTN","RAEDCN1",107,0)
 .Q
"RTN","RAEDCN1",108,0)
 S RA124EXST=$O(^RA(72,"AA",RAIMGTY,0,0)) ;IEN file 72
"RTN","RAEDCN1",109,0)
 ; for cancelled (order # = 0 4th subscript)
"RTN","RAEDCN1",110,0)
 I RA124EXST="" D  Q
"RTN","RAEDCN1",111,0)
 .D ERROR("RA: INVALID EXAM STATUS")
"RTN","RAEDCN1",112,0)
 .W !!,"WARNING: CANCEL AN EXAM option aborted: Exam Status definition error.",!!
"RTN","RAEDCN1",113,0)
 .Q
"RTN","RAEDCN1",114,0)
 ;
"RTN","RAEDCN1",115,0)
 ;update 70.03, field 3 EXAM STATUS
"RTN","RAEDCN1",116,0)
 S DA(2)=RADFN,DA(1)=RADTI,DA=RACNI
"RTN","RAEDCN1",117,0)
 S RAIENS=$$IENS^DILF(.DA) K DA
"RTN","RAEDCN1",118,0)
 ;
"RTN","RAEDCN1",119,0)
 S RAFDA(70.03,RAIENS,3)=RA124EXST
"RTN","RAEDCN1",120,0)
 ;update 70.03, field 3.5 REASON FOR CANCELLATION
"RTN","RAEDCN1",121,0)
 S:$G(RAREASON)'="" RAFDA(70.03,RAIENS,3.5)=RAREASON
"RTN","RAEDCN1",122,0)
 D FILE^DIE(,"RAFDA","RAERROR")
"RTN","RAEDCN1",123,0)
 I $D(DIERR)#2 S RADESC="RA: ERROR UPDATING SUB-DD;FIELD: 70.03;3 or 70.03;3.5" D ERROR(RADESC)
"RTN","RAEDCN1",124,0)
 ;
"RTN","RAEDCN1",125,0)
 ;do I care about editing 70.03 ; 3.5? REASON FOR CANCELLATION
"RTN","RAEDCN1",126,0)
 ;
"RTN","RAEDCN1",127,0)
ALOG ;update activity (70.03 ; 100) log
"RTN","RAEDCN1",128,0)
 K DIERR,RAERROR,RAFDA
"RTN","RAEDCN1",129,0)
 S RAR=$NA(RAFDA(70.07,"+1,"_RAIENS))
"RTN","RAEDCN1",130,0)
 ;.01 - log date
"RTN","RAEDCN1",131,0)
 S @RAR@(.01)=$E($$NOW^XLFDT(),1,12) ;internal
"RTN","RAEDCN1",132,0)
 ;field #: 2 - type of action
"RTN","RAEDCN1",133,0)
 S @RAR@(2)="X" ; 'X' = cancelled internal
"RTN","RAEDCN1",134,0)
 ;field #: 3 - computer user
"RTN","RAEDCN1",135,0)
 S @RAR@(3)=DUZ ;internal
"RTN","RAEDCN1",136,0)
 ;field #4: technologist comment "TCOM" node
"RTN","RAEDCN1",137,0)
 ;internal
"RTN","RAEDCN1",138,0)
 S:$G(RATCOM)'="" @RAR@(4)=RATCOM ;internal
"RTN","RAEDCN1",139,0)
 D UPDATE^DIE("","RAFDA","RAIENS","RAERROR") ;file as internal what if error?
"RTN","RAEDCN1",140,0)
 I $D(DIERR)#2 S RADESC="RA: ERROR UPDATING 'ACTIVITY LOG' (70.03 ; 100) MULTIPLE" D ERROR(RADESC)
"RTN","RAEDCN1",141,0)
 ;
"RTN","RAEDCN1",142,0)
XSTIME ;update exam status times (70.03 ; 75) log
"RTN","RAEDCN1",143,0)
 K RAIENS(1),DIERR,RAERROR,RAFDA
"RTN","RAEDCN1",144,0)
 S RAR=$NA(RAFDA(70.05,"+1,"_RAIENS))
"RTN","RAEDCN1",145,0)
  ;.01 - status change date/time
"RTN","RAEDCN1",146,0)
 S @RAR@(.01)=$E($$NOW^XLFDT(),1,12) ;internal
"RTN","RAEDCN1",147,0)
 ;field #: 2 - new status
"RTN","RAEDCN1",148,0)
 S @RAR@(2)=RA124EXST ;internal
"RTN","RAEDCN1",149,0)
 ;field #: 3 - computer user
"RTN","RAEDCN1",150,0)
 S @RAR@(3)=DUZ ;internal
"RTN","RAEDCN1",151,0)
 D UPDATE^DIE("","RAFDA","RAIENS","RAERROR")
"RTN","RAEDCN1",152,0)
 I $D(DIERR)#2 S RADESC="RA: ERROR UPDATING 'EXAM STATUS TIMES' (70.03 ; 75) MULTIPLE" D ERROR(RADESC)
"RTN","RAEDCN1",153,0)
 ;
"RTN","RAEDCN1",154,0)
 W !!?3,"... exam cancellation complete."
"RTN","RAEDCN1",155,0)
 Q
"RTN","RAEDCN1",156,0)
 ;
"RTN","RAEDCN1",157,0)
ERROR(RADESC) ;trip error trap hit primarily for CANCEL AN EXAM
"RTN","RAEDCN1",158,0)
 D APPERROR^%ZTER(RADESC)
"RTN","RAEDCN1",159,0)
 Q
"RTN","RAEDCN1",160,0)
 ;
"RTN","RAIPR124")
0^13^B221656^n/a
"RTN","RAIPR124",1,0)
RAIPR124 ;HISC/GJC pre-install routine ;12 Apr 2018 4:02 PM
"RTN","RAIPR124",2,0)
 ;;5.0;Radiology/Nuclear Medicine;**124**;Mar 16, 1998;Build 4
"RTN","RAIPR124",3,0)
 ;
"RTN","RAIPR124",4,0)
 ;Routine              IA          Type
"RTN","RAIPR124",5,0)
 ;-------------------------------------
"RTN","RAIPR124",6,0)
 ; ^DIK                10013        (S)
"RTN","RAIPR124",7,0)
 ;
"RTN","RAIPR124",8,0)
 N RACHX1,RACHX2
"RTN","RAIPR124",9,0)
 S RACHX1=$$NEWCP^XPDUTL("PRE1","EN1^RAIPR124")
"RTN","RAIPR124",10,0)
 Q
"RTN","RAIPR124",11,0)
 ;
"RTN","RAIPR124",12,0)
EN1 ;Delete the EXAM STATUS field (70.03;3) from
"RTN","RAIPR124",13,0)
 ;the RAD/NUC MED PATIENT (#70) data dictionary.
"RTN","RAIPR124",14,0)
 ;
"RTN","RAIPR124",15,0)
 N %,DA,DIK,Y,X
"RTN","RAIPR124",16,0)
 S DIK="^DD(70.03,",DA=3,DA(1)=70.03
"RTN","RAIPR124",17,0)
 D ^DIK
"RTN","RAIPR124",18,0)
 Q
"RTN","RAIPR124",19,0)
 ;
"RTN","RAIPS124")
0^3^B9199604^n/a
"RTN","RAIPS124",1,0)
RAIPS124 ;HISC/GJC post-install routine ;08 Jun 2018 1:06 PM
"RTN","RAIPS124",2,0)
 ;;5.0;Radiology/Nuclear Medicine;**124**;Mar 16, 1998;Build 4
"RTN","RAIPS124",3,0)
 ;
"RTN","RAIPS124",4,0)
 ;Routine              File     IA          Type
"RTN","RAIPS124",5,0)
 ;----------------------------------------------
"RTN","RAIPS124",6,0)
 ; ^%ZTLOAD                     10063       (S)
"RTN","RAIPS124",7,0)
 ; D EN^DIEZ                    10002       (S)
"RTN","RAIPS124",8,0)
 ; ENALL^DIK                    10013       (S)
"RTN","RAIPS124",9,0)
 ; $$ROUSIZE^DILF               2649        (S) 
"RTN","RAIPS124",10,0)
 ;                     ^DD(     6892        (P)
"RTN","RAIPS124",11,0)
 ;
"RTN","RAIPS124",12,0)
 N RACHKP1,RACHKP2
"RTN","RAIPS124",13,0)
 S RACHKP1=$$NEWCP^XPDUTL("POST1","EN1^RAIPS124")
"RTN","RAIPS124",14,0)
 S RACHKP2=$$NEWCP^XPDUTL("POST2","EN2^RAIPS124")
"RTN","RAIPS124",15,0)
 S RACHKP2=$$NEWCP^XPDUTL("POST3","EN3^RAIPS124")
"RTN","RAIPS124",16,0)
 S RACHKP2=$$NEWCP^XPDUTL("POST4","EN4^RAIPS124")
"RTN","RAIPS124",17,0)
 Q
"RTN","RAIPS124",18,0)
 ;
"RTN","RAIPS124",19,0)
EN1 ;cleanup this mess left from patch 130: DATE DESIRED (Not guaranteed) FLD #21
"RTN","RAIPS124",20,0)
 ; "AP" is a new style for Use a DIK call. Look at every ^DD(75.1,21,1,x
"RTN","RAIPS124",21,0)
 N RAR,RAY,RAX
"RTN","RAIPS124",22,0)
 S RAR=$NA(^DD(75.1,21,1)),RAY=0
"RTN","RAIPS124",23,0)
 F  S RAY=$O(@RAR@(RAY)) Q:'RAY  S RAX=$G(^(RAY,0)) I RAX="75.1^AC^MUMPS" D
"RTN","RAIPS124",24,0)
 .D DELIX^DDMOD(75.1,21,RAY,"W")
"RTN","RAIPS124",25,0)
 .Q
"RTN","RAIPS124",26,0)
 Q
"RTN","RAIPS124",27,0)
 ;
"RTN","RAIPS124",28,0)
EN2 ;re-index the "AD" cross reference SCHEDULED DATE (TIME optional) 75.1;23
"RTN","RAIPS124",29,0)
 ;
"RTN","RAIPS124",30,0)
 N RATXT,ZTDESC,ZTDTH,ZTIO,ZTRTN S ZTIO="",RATXT(1)=""
"RTN","RAIPS124",31,0)
 S ZTRTN="EN21^RAIPS124",(ZTDESC,RATXT(2))="RA124: re-index of the 'SCHEDULED DATE (TIME optional)' ""AD"" xref."
"RTN","RAIPS124",32,0)
 S ZTDTH=$H D ^%ZTLOAD S RATXT(3)="Task: "_$S($G(ZTSK)>0:ZTSK,1:"in error")
"RTN","RAIPS124",33,0)
 D BMES^XPDUTL(.RATXT)
"RTN","RAIPS124",34,0)
 Q
"RTN","RAIPS124",35,0)
 ;
"RTN","RAIPS124",36,0)
EN21 ; re-index the existing 'SCHEDULED DATE (TIME optional)' fld #23 "AD" xref
"RTN","RAIPS124",37,0)
 ;
"RTN","RAIPS124",38,0)
 K DA,DIC,DIK K ^RAO(75.1,"AD") ;kill the corrupted "AD" xref
"RTN","RAIPS124",39,0)
 S DIK="^RAO(75.1,",DIK(1)="23^AD" D ENALL^DIK
"RTN","RAIPS124",40,0)
 K DA,DIC,DIK
"RTN","RAIPS124",41,0)
 Q
"RTN","RAIPS124",42,0)
 ;
"RTN","RAIPS124",43,0)
EN3 ;recompile input templates associated with the EXAM STATUS 
"RTN","RAIPS124",44,0)
 ;(70.03;3) field run in the foreground as part of the post-install
"RTN","RAIPS124",45,0)
 ; ^DD(70.03,3,0)="EXAM STATUS"
"RTN","RAIPS124",46,0)
 ; ^DIE("AF",sub-file,field,template_IEN)=""
"RTN","RAIPS124",47,0)
 N DMAX,RADMAX,RAY,X,Y S RAY=0,RADMAX=$$ROUSIZE^DILF()
"RTN","RAIPS124",48,0)
 F  S RAY=$O(^DIE("AF",70.03,3,RAY)) Q:RAY=""  D  ;Y = IEN of compiled template
"RTN","RAIPS124",49,0)
 .S DMAX=RADMAX
"RTN","RAIPS124",50,0)
 .;^DIE(1220,"ROU")="^RACTQE"
"RTN","RAIPS124",51,0)
 .;^DIE(1220,"ROUOLD")="RACTQE"
"RTN","RAIPS124",52,0)
 .S X=$P($G(^DIE(RAY,"ROU")),U,2) ;X = compiled template routine name
"RTN","RAIPS124",53,0)
 .S:X="" X=$G(^DIE(RAY,"ROUOLD")) ;"ROU" not defined, check "ROUOLD"
"RTN","RAIPS124",54,0)
 .Q:X=""  ;missing compiled template routine namespace 
"RTN","RAIPS124",55,0)
 .S Y=RAY D EN^DIEZ
"RTN","RAIPS124",56,0)
 .Q
"RTN","RAIPS124",57,0)
 Q
"RTN","RAIPS124",58,0)
 ;
"RTN","RAIPS124",59,0)
EN4 ;task re-index "AE" & "AS" new style xrefs (70.03;3)
"RTN","RAIPS124",60,0)
 N RATXT,ZTDESC,ZTDTH,ZTIO,ZTRTN S ZTIO="",RATXT(1)=""
"RTN","RAIPS124",61,0)
 S ZTRTN="EN41^RAIPS124",(ZTDESC,RATXT(2))="RA124: re-index of the 'EXAM STATUS'' ""AE"" & ""AS"" xrefs."
"RTN","RAIPS124",62,0)
 S ZTDTH=$H D ^%ZTLOAD S RATXT(3)="Task: "_$S($G(ZTSK)>0:ZTSK,1:"in error")
"RTN","RAIPS124",63,0)
 D BMES^XPDUTL(.RATXT)
"RTN","RAIPS124",64,0)
 ;
"RTN","RAIPS124",65,0)
 Q
"RTN","RAIPS124",66,0)
 ;
"RTN","RAIPS124",67,0)
EN41 ;re-index the "AE" & "AS" new style xrefs
"RTN","RAIPS124",68,0)
 ; EXAM STATUS field (70.03;3)
"RTN","RAIPS124",69,0)
 N DA,DIC,DIK,RADFN,RADTI,X S RADFN=0
"RTN","RAIPS124",70,0)
 K ^RADPT("AE") ;kill the "AE" xref
"RTN","RAIPS124",71,0)
 K ^RADPT("AS") ;kill the "AS" xref
"RTN","RAIPS124",72,0)
 F  S RADFN=$O(^RADPT(RADFN)) Q:RADFN'>0  D
"RTN","RAIPS124",73,0)
 .S RADTI=0
"RTN","RAIPS124",74,0)
 .F  S RADTI=$O(^RADPT(RADFN,"DT",RADTI)) Q:RADTI'>0  D
"RTN","RAIPS124",75,0)
 ..S DIK="^RADPT("_RADFN_",""DT"","_RADTI_",""P"","
"RTN","RAIPS124",76,0)
 ..S DIK(1)="3^AE^AS",DA(2)=RADFN,DA(1)=RADTI
"RTN","RAIPS124",77,0)
 ..D ENALL^DIK K DA,DIC,DIK,X
"RTN","RAIPS124",78,0)
 ..Q
"RTN","RAIPS124",79,0)
 .Q
"RTN","RAIPS124",80,0)
 Q
"RTN","RAIPS124",81,0)
 ;
"RTN","RANPROU")
0^6^B6016594^B5444307
"RTN","RANPROU",1,0)
RANPROU ;BPFO/CLT - NEW RADIOLOGY PROCEDURES UTILITIES ;22 Mar 2018 10:24 AM
"RTN","RANPROU",2,0)
 ;;5.0;Radiology/Nuclear Medicine;**127,124**;Mar 16, 1998;Build 4
"RTN","RANPROU",3,0)
 ;
"RTN","RANPROU",4,0)
CPT(DA,RAX) ;Ask for CPT Code when the 'Procedure Enter/Edit' option
"RTN","RANPROU",5,0)
 ;is exercised. Called from input template: W RADIOLOGY PROCEDURE
"RTN","RANPROU",6,0)
 ;Input: DA=ien of new record being edited & RAX=procedure name
"RTN","RANPROU",7,0)
 N DIR,DIROUT,DIRUT,DTOUT,DUOUT,RAFDA,RAYN,X,Y S RAYN=0
"RTN","RANPROU",8,0)
 F  D  Q:+RAYN!($D(DIRUT)#2)
"RTN","RANPROU",9,0)
 .K X,Y S DIR(0)="71.11,9" D ^DIR Q:$D(DIRUT)#2
"RTN","RANPROU",10,0)
 .;Y=N^S where N=record ien & S=.01 value of the record
"RTN","RANPROU",11,0)
 .W !!,"Note: If an erroneous CPT Code is accepted it cannot be changed; the",!,"procedure must be inactivated."
"RTN","RANPROU",12,0)
 . I $G(RA7111DA)="" S RA7111DA=$G(^TMP("RA7111DA",$J))
"RTN","RANPROU",13,0)
 . S RAX=$P($G(^RAMRPF(71.11,RA7111DA,0)),U,1) W !!,"Are you adding '"_$P(Y,U,2)_"' as the CPT Code for the new Rad/Nuc Med Procedure",!,"'"_RAX_"'? NO// "
"RTN","RANPROU",14,0)
 .;S RAX=$P($G(^RAMRPF(71.11,1,0)),U,1) W !!,"Are you adding '"_$P(Y,U,2)_"' as the CPT Code for the new Rad/Nuc Med Procedure",!,"'"_RAX_"'? NO// "
"RTN","RANPROU",15,0)
 .R RAYN:DTIME
"RTN","RANPROU",16,0)
 .I '$T!(RAYN["^") S RAYN=-1 Q
"RTN","RANPROU",17,0)
 .S RAYN=$E(RAYN) S:RAYN="" RAYN="N"
"RTN","RANPROU",18,0)
 .I "YyNn"'[RAYN W !?3,"Enter 'Y' to accept the CPT Code, or 'N' to reject the CPT Code or '^' to",!?3,"exit without selecting a CPT Code."
"RTN","RANPROU",19,0)
 .I  W !?5,"Note: If an erroneous CPT Code is accepted it cannot be changed; the",!?5,"procedure must be inactivated."
"RTN","RANPROU",20,0)
 .S:"Yy"[RAYN RAYN="1^Y"
"RTN","RANPROU",21,0)
 .S:"Nn"[RAYN RAYN=0
"RTN","RANPROU",22,0)
 .Q
"RTN","RANPROU",23,0)
 I $P(RAYN,U,2)="Y" S RAFDA(71.11,DA_",",9)=$P(Y,U) D FILE^DIE("","RAFDA")
"RTN","RANPROU",24,0)
 Q
"RTN","RANPROU",25,0)
 ;
"RTN","RANPROU",26,0)
CHKSTAT() ;Check the status of the study. If the
"RTN","RANPROU",27,0)
 ; exam status of the study is complete bypass the
"RTN","RANPROU",28,0)
 ; editing of the PROCEDURE (70.03 ; 2) field. This
"RTN","RANPROU",29,0)
 ; function is called from [RA EXAM EDIT] grzeis P124
"RTN","RANPROU",30,0)
 ;
"RTN","RANPROU",31,0)
 ; Variables
"RTN","RANPROU",32,0)
 ; ---------
"RTN","RANPROU",33,0)
 ; Input : none
"RTN","RANPROU",34,0)
 ; Return: -1 if missing exam status,
"RTN","RANPROU",35,0)
 ;         0 if exam COMPLETE, else 1.
"RTN","RANPROU",36,0)
 ;
"RTN","RANPROU",37,0)
 ; The following variables must exist: RAY (0 node 70.03) &
"RTN","RANPROU",38,0)
 ; the RA0 array RA0(1...18) where the subscript indicates
"RTN","RANPROU",39,0)
 ; the piece of the parsed zero node: Ex: RA0(3) = EXAM STATUS pointer
"RTN","RANPROU",40,0)
 ; RAX(3) is the ORDER value of the record in file 72.
"RTN","RANPROU",41,0)
 ;
"RTN","RANPROU",42,0)
 I RA0(3)="" W !?3,"MISSING EXAM STATUS, EXIT CASE EDIT!",! Q -1
"RTN","RANPROU",43,0)
 N RAX S RAX=$G(^RA(72,RA0(3),0)),RAX(3)=$P(RAX,U,3)
"RTN","RANPROU",44,0)
 Q $S(RAX(3)=9:0,1:1)
"RTN","RANPROU",45,0)
 ;
"RTN","RAORDC")
0^8^B22908747^B20640927
"RTN","RAORDC",1,0)
RAORDC ;HISC/CAH,FPT,GJC,DAD AISC/RMO-Check Request Status against Exam Status ;23 Mar 2018 11:06 AM
"RTN","RAORDC",2,0)
 ;;5.0;Radiology/Nuclear Medicine;**113,124**;Mar 16, 1998;Build 4
"RTN","RAORDC",3,0)
 ;
"RTN","RAORDC",4,0)
 ;The variables RADFN, RADTI and RACNI must be defined. The variable
"RTN","RAORDC",5,0)
 ;RADELFLG is set when the exam is being deleted.  This routine is
"RTN","RAORDC",6,0)
 ;called after an exam status is updated, to update the order status.
"RTN","RAORDC",7,0)
 ;Called from RAEDCN after exam cancel or delete, from RAESO after
"RTN","RAORDC",8,0)
 ;override single exam to complete, from RASTED after exam status is
"RTN","RAORDC",9,0)
 ;updated successfully, and from RAUTL1 after exam status update.
"RTN","RAORDC",10,0)
 G Q:'$D(^RADPT(RADFN,"DT",RADTI,"P",RACNI,0)) S RAEXM0=^(0),RAEXOR=$S($D(RADELFLG):0,$D(^RA(72,+$P(RAEXM0,"^",3),0)):$P(^(0),"^",3),1:""),RAOIFN=+$P(RAEXM0,"^",11) G Q:'$D(^RAO(75.1,RAOIFN,0)) S (RAORD0,RAORDB4)=^(0)
"RTN","RAORDC",11,0)
 S RAOSTS=$S(RAEXOR=0:0,RAEXOR>0&(RAEXOR<9):6,RAEXOR=9:2,1:"") D EXMCAN:RAOSTS=0,EXMCOM:RAOSTS=2,^RAORDU:RAOSTS=6&(RAOSTS'=$P(RAORD0,"^",5))
"RTN","RAORDC",12,0)
 ;
"RTN","RAORDC",13,0)
 ;Check for studies that are COMPLETE (w/order=9). May be single studies,
"RTN","RAORDC",14,0)
 ;multiple studies per patient event: examsets, printsets, add exams to 
"RTN","RAORDC",15,0)
 ;last visit get radiation dose data if the proper conditions are met.
"RTN","RAORDC",16,0)
 I RAOSTS=2!(RAOSTS=6) D  ; ACTIVE (6) or COMPLETE (2)
"RTN","RAORDC",17,0)
 .N RAIT,RAY2,RAY3 S RAY2=$G(^RADPT(RADFN,"DT",RADTI,0))
"RTN","RAORDC",18,0)
 .S RAIT=$P($G(^RA(79.2,+$P(RAY2,U,2),0)),U,3)
"RTN","RAORDC",19,0)
 .I RAIT'="RAD",(RAIT'="CT") Q
"RTN","RAORDC",20,0)
 .S RAIT=$S(RAIT="RAD":"FLUORO",1:"CT") ;MAG requires "FLUORO"
"RTN","RAORDC",21,0)
 .S RAY3=$G(^RADPT(RADFN,"DT",RADTI,"P",RACNI,0))
"RTN","RAORDC",22,0)
 .Q:$P($G(^RA(72,+$P(RAY3,U,3),0)),U,3)'=9  ;must be COMPLETE
"RTN","RAORDC",23,0)
 .D GETDOSE^RADUTL ;RA*5.0*113 w/MAG*3.0*137
"RTN","RAORDC",24,0)
 .Q
"RTN","RAORDC",25,0)
 ;
"RTN","RAORDC",26,0)
 I $P($G(RAORDB4),"^",5)=2,(RAOSTS'=2) D
"RTN","RAORDC",27,0)
 . ; Prior request status complete ($P(RAORDB4,"^",5)=2), new request
"RTN","RAORDC",28,0)
 . ; status (RAOSTS) not complete & OE/RR version not less than 3 issue
"RTN","RAORDC",29,0)
 . ; roll back message
"RTN","RAORDC",30,0)
 . D:$$ORVR^RAORDU()'<3 EN2^RAO7CH(RAOIFN)
"RTN","RAORDC",31,0)
 . ; Delete 'V' file pointers if PCE installed & outpatient
"RTN","RAORDC",32,0)
 . I $P(RAEXM0,"^",6)]"",($P(^DIC(42,$P(RAEXM0,"^",6),0),"^",3)'="D") Q
"RTN","RAORDC",33,0)
 . D:$$PCE^RAWORK() UNCOMPL^RAPCE1(RADFN,RADTI,RACNI)
"RTN","RAORDC",34,0)
 . Q
"RTN","RAORDC",35,0)
Q K RABLNK,RACAT,RAEXM0,RAEXOR,RAILP,RAMIFN,RAMOD,RAMODA,RAMODD,RAOIFN,RAORD0,RAORDB4,RAOSTS,RAPRC,RARSH,RASHA,X
"RTN","RAORDC",36,0)
 I '$D(N)!($D(RAOREA)<10) K RAOREA Q
"RTN","RAORDC",37,0)
 I $D(RAOREA)>1,$G(N) K RAOREA(N) I $D(RAOREA)<10 K RAOREA
"RTN","RAORDC",38,0)
 Q
"RTN","RAORDC",39,0)
 ;
"RTN","RAORDC",40,0)
EXMCAN ; Update request status to cancel or hold.
"RTN","RAORDC",41,0)
 ;This logic is called based on changes for RA5P124.
"RTN","RAORDC",42,0)
 ;RA5P124 comments will be added where necessary.
"RTN","RAORDC",43,0)
 N RAXIT S RAXIT=0
"RTN","RAORDC",44,0)
 S RAOREA=$S($D(RAOREA):RAOREA,1:$O(^RA(75.2,"B",$S($D(RADELFLG):"EXAM DELETED",1:"EXAM CANCELLED"),0)))
"RTN","RAORDC",45,0)
 ;
"RTN","RAORDC",46,0)
ASKCAN ;logic to determine whether studies tied to the order meet the criteria
"RTN","RAORDC",47,0)
 ;to discontinue or hold the order. At this point RAOIFN, RADFN, RADTI, RACNI
"RTN","RAORDC",48,0)
 ;RAY2 (70.02 node), RAY3 (70.03) node and RACAN124 are set.
"RTN","RAORDC",49,0)
 ;
"RTN","RAORDC",50,0)
 ;check for descendents
"RTN","RAORDC",51,0)
 S RA=$O(^RADPT("AO",RAOIFN,RADFN,RADTI,0))
"RTN","RAORDC",52,0)
 I RA,$O(^RADPT("AO",RAOIFN,RADFN,RADTI,RA)) D  Q:RAXIT
"RTN","RAORDC",53,0)
 . ; If # descendents > 1 do not assume the order is to be deleted or canceled
"RTN","RAORDC",54,0)
 . N RAESTAT S RAESTAT=$$EN1^RASETU(RAOIFN,RADFN)
"RTN","RAORDC",55,0)
 . ;RAESTAT = min ORDER number value for all descendents_"^"_max ORDER number value for all descendents
"RTN","RAORDC",56,0)
 . ;          _"^"_$S(All_desc ORDER number values=0:1,1:0)
"RTN","RAORDC",57,0)
 . Q:+$P(RAESTAT,"^",3)  ; all other exams have been canceled
"RTN","RAORDC",58,0)
 . S RAXIT=1 ; if ramaining xams complete -or- at least one of the other
"RTN","RAORDC",59,0)
 . ;           xams not cancelled, take appropriate action, quit EXMCAN
"RTN","RAORDC",60,0)
 . I +RAESTAT=9 S RAOSTS=2 D ^RAORDU S RAOSTS=0 Q  ; all xams complete
"RTN","RAORDC",61,0)
 . W !!?5,"Please note, however, that more than one procedure is associated"
"RTN","RAORDC",62,0)
 . W !?5,"with the procedure's Parent request.  The Parent request will not"
"RTN","RAORDC",63,0)
 . W !?5,"be canceled or put or hold unless all the registered descendent"
"RTN","RAORDC",64,0)
 . W !?5,"procedures are canceled or deleted.",!,$C(7)
"RTN","RAORDC",65,0)
 . Q
"RTN","RAORDC",66,0)
 ;
"RTN","RAORDC",67,0)
 W ! S RAOSTS=$$YNCAN() Q:RAOSTS=-1
"RTN","RAORDC",68,0)
 I RAOSTS=1,$D(RADELFLG) D
"RTN","RAORDC",69,0)
 . ; Remove EXAM SET flag if parent order deleted
"RTN","RAORDC",70,0)
 . N DA,DIE,DR
"RTN","RAORDC",71,0)
 . S DIE="^RADPT("_RADFN_",""DT"",",DA(1)=RADFN,DA=RADTI,DR="5///@"
"RTN","RAORDC",72,0)
 . D ^DIE
"RTN","RAORDC",73,0)
 . Q
"RTN","RAORDC",74,0)
 I RAOSTS=3 S (DIE,DIC)="^RAO(75.1,",DIC(0)="AEQM",DA=RAOIFN,DR="25" W ! D ^DIE K DIE,DIC,DA,DR
"RTN","RAORDC",75,0)
 D ^RAORDU W !?10,"...request status updated to ",$S(RAOSTS=1:"discontinued",1:"hold"),"."
"RTN","RAORDC",76,0)
 Q
"RTN","RAORDC",77,0)
 ;
"RTN","RAORDC",78,0)
EXMCOM ; Code moved to EXMCOM^RAORDC1 to save on space.  To update request
"RTN","RAORDC",79,0)
 ; statuses for complete exams.
"RTN","RAORDC",80,0)
 D EXMCOM^RAORDC1 Q
"RTN","RAORDC",81,0)
 ;
"RTN","RAORDC",82,0)
DELMOD S DA(1)=RAOIFN,DA=RAMIFN,DIK="^RAO(75.1,"_DA(1)_",""M""," D ^DIK K DA,DIK S RAMODD=""
"RTN","RAORDC",83,0)
 Q
"RTN","RAORDC",84,0)
 ;
"RTN","RAORDC",85,0)
ADDMOD S X=$S($D(^RAMIS(71.2,RAILP,0)):$P(^(0),"^"),1:"") I X'="" S:'$D(^RAO(75.1,RAOIFN,"M",0)) ^(0)="^75.1125PA^^" S DIC(0)="L",DLAYGO=75.1,DA(1)=RAOIFN,DIC="^RAO(75.1,RAOIFN,""M""," D ^DIC K DA,DIC S RAMODA=""
"RTN","RAORDC",86,0)
 Q
"RTN","RAORDC",87,0)
 ;
"RTN","RAORDC",88,0)
YNCAN() ;ask if the order is to be canceled
"RTN","RAORDC",89,0)
 ;DIR returns:
"RTN","RAORDC",90,0)
 ; X - Unprocessed user response
"RTN","RAORDC",91,0)
 ; Y - Processed user response.
"RTN","RAORDC",92,0)
 N %,DIR,DIROUT,DIRUT,DTOUT,DUOUT
"RTN","RAORDC",93,0)
 S DIR(0)="Y",DIR("B")="No"
"RTN","RAORDC",94,0)
 S DIR("?",1)="Required, enter 'YES' If the request should be cancelled or 'NO' to put"
"RTN","RAORDC",95,0)
 S DIR("?")="it on hold."
"RTN","RAORDC",96,0)
 S DIR("A")="Do you want to cancel the request associated with this exam"
"RTN","RAORDC",97,0)
 D ^DIR
"RTN","RAORDC",98,0)
 ;Yes/No: Y=1 for yes/cancel; else Y=0 for no/hold
"RTN","RAORDC",99,0)
 ;
"RTN","RAORDC",100,0)
 Q $S(Y=1:1,Y=0:3,1:-1)
"RTN","RAORDC",101,0)
 ;
"RTN","RAREG1")
0^16^B34544181^B33386427
"RTN","RAREG1",1,0)
RAREG1 ;HISC/CAH,FPT,DAD AISC/MJK,RMO-Register Patient ;30 Oct 2018 8:39 AM
"RTN","RAREG1",2,0)
 ;;5.0;Radiology/Nuclear Medicine;**7,21,93,137,144,124**;Mar 16, 1998;Build 4
"RTN","RAREG1",3,0)
 ; 07/15/2008 BAY/KAM rem call 249750 RA*5*93 Correct DIK Calls
"RTN","RAREG1",4,0)
 ;
"RTN","RAREG1",5,0)
 ;  Supported IA #1621 reference APPERROR^%ZTER  function call 
"RTN","RAREG1",6,0)
 ;
"RTN","RAREG1",7,0)
ASKORD I $D(RAVSTFLG),$G(YY)]"",$P(YY,U,5) D ASET G PACS
"RTN","RAREG1",8,0)
 ; radparfl = 1 if user chose detail-to-parent conversion
"RTN","RAREG1",9,0)
 ; radparpr = ien of file 74 of parent proc to replace detail proc
"RTN","RAREG1",10,0)
 K RADPARPR,RADPARFL
"RTN","RAREG1",11,0)
 S RAOLP=0,RAOVSTS="3;5;8" W ! D ^RAORDS G Q1:$D(RAOUT) G EXAM:$D(RAORDS)
"RTN","RAREG1",12,0)
 S RARD("A")="Do you want to Request an Exam for "_RANME_"? ",RARD(0)="S",RARD(1)="Yes^enter a request.",RARD(2)="No^not enter a request.",RARD("B")=2 D SET^RARD K RARD G Q1:$E(X)'="Y"
"RTN","RAREG1",13,0)
 W !!?3,"...requesting an exam for ",RANME,"...",! D ^RAORD1
"RTN","RAREG1",14,0)
EXAM ;
"RTN","RAREG1",15,0)
 ; block mixture of single proc with parent procedures
"RTN","RAREG1",16,0)
 N RA6,RA7,RA8 S RA6="",RA7=0,RA8=0
"RTN","RAREG1",17,0)
 F  S RA6=$O(RAORDS(RA6)) Q:'RA6  S:$P($G(^RAMIS(71,$P(^RAO(75.1,+RAORDS(RA6),0),U,2),0)),U,6)="P" RA7=1 S:$P($G(^RAMIS(71,$P(^RAO(75.1,+RAORDS(RA6),0),U,2),0)),U,6)'="P" RA8=1
"RTN","RAREG1",18,0)
 I RA7,RA8 W !!?7,$C(7),"You may not register a mixture of single and parent procedures.",! G Q1
"RTN","RAREG1",19,0)
 ;
"RTN","RAREG1",20,0)
 I $G(RADPARFL) D  G:Y<1 Q1 ; process detail-to-parent
"RTN","RAREG1",21,0)
 . D PSETPNT^RAREG4
"RTN","RAREG1",22,0)
 . Q
"RTN","RAREG1",23,0)
 S RAPARENT=+$P($G(^RADPT(RADFN,"DT",RADTI,0)),U,5)
"RTN","RAREG1",24,0)
 K ^TMP($J,"RAREG1") S (RAEXIT,RAQUIT,RASKIPIT,RACNICNT)=0
"RTN","RAREG1",25,0)
 D RSBIT^RAREG3
"RTN","RAREG1",26,0)
 F RAOLP=1:1 S RAOIFN=$G(RAORDS(RAOLP)) Q:'RAOIFN!RAEXIT!RAQUIT  D
"RTN","RAREG1",27,0)
 . D PROCESS^RAREG4
"RTN","RAREG1",28,0)
 . Q
"RTN","RAREG1",29,0)
 I RAEXIT,RAPARENT D EXAMDEL^RAREG2
"RTN","RAREG1",30,0)
 I $D(^TMP($J,"RAREG1")) D UOSM^RAREG2
"RTN","RAREG1",31,0)
PACS I $D(^TMP($J,"RAREG1")) S RACNT=0 F  S RACNT=$O(^TMP($J,"RAREG1",RACNT)) Q:'RACNT  D
"RTN","RAREG1",32,0)
 .S RAREGTMP=$G(^TMP($J,"RAREG1",RACNT)),RADFN=$P(RAREGTMP,U,1),RADTI=$P(RAREGTMP,U,2),RACNI=$P(RAREGTMP,U,3)
"RTN","RAREG1",33,0)
 .D REG^RAHLRPC
"RTN","RAREG1",34,0)
 .Q
"RTN","RAREG1",35,0)
 K RAREGTMP
"RTN","RAREG1",36,0)
 D:$D(RADPARFL) CKDUPORD^RAREG2 ; ck for dupl procs in outstndg orders
"RTN","RAREG1",37,0)
Q I '$D(RAREC) W !!?3,$C(7),"No exams entered for this visit. Must delete..." S DA(1)=RADFN,DA=RADTI,DIK="^RADPT("_DA(1)_",""DT""," D ^DIK W "...deletion complete!" K RAPX
"RTN","RAREG1",38,0)
 D PRNRQ^RAREG3 ;print request when exam is registered - P137 /KLM
"RTN","RAREG1",39,0)
 D LABEL^RAREG3
"RTN","RAREG1",40,0)
Q1 D Q4^RAREG4
"RTN","RAREG1",41,0)
 G PAT^RAREG
"RTN","RAREG1",42,0)
 ;
"RTN","RAREG1",43,0)
 ;CN entry point is called every time a new case number is assigned.
"RTN","RAREG1",44,0)
 ;The next available CN and last date CN's were "recycled" is stored in
"RTN","RAREG1",45,0)
 ;^RA(79.2,1,"CN")=Next availabe CN ^ date last recycled.
"RTN","RAREG1",46,0)
 ;This routine uses the next available CN unless it has been used for
"RTN","RAREG1",47,0)
 ;the same exam date before (DUP checks for duplicate case/date pair).
"RTN","RAREG1",48,0)
 ;Then the next available CN is calculated and written to the first
"RTN","RAREG1",49,0)
 ;piece of ^RA(79.2,1,"CN").  The node is locked during this transaction.
"RTN","RAREG1",50,0)
CN ;VARIABLES RATYPE,RADT AND RASET MUST EXIST AT THIS POINT
"RTN","RAREG1",51,0)
 ; 11/05/2008 BAY/KAM rem call 273496 RA*5*93 Add lock timeout to next line
"RTN","RAREG1",52,0)
 L +^RA(79.2,RATYPE,"CN"):$S($G(DILOCKTM)>0:DILOCKTM,1:3) D CAL:'$D(^RA(79.2,RATYPE,"CN")),CAL:DT>$P(^("CN"),"^",2),CAL:+^("CN")>99999 S RAX=+^RA(79.2,RATYPE,"CN") D DUP
"RTN","RAREG1",53,0)
 ; need recalculate if DUP returns an over 99999 value
"RTN","RAREG1",54,0)
 I RAX>99999 D CAL S RAX=+^RA(79.2,RATYPE,"CN") D DUP
"RTN","RAREG1",55,0)
 I 'RASET S X=RAX G CNQ
"RTN","RAREG1",56,0)
 I $D(X),X'="N",X'=RAX W !!,$C(7),"New case number must be equal to '",RAX,"'. OK? YES// " R RANS:DTIME K X I RANS["N"!(RANS["n")!('$T) G CNQ
"RTN","RAREG1",57,0)
 S X=RAX
"RTN","RAREG1",58,0)
 ; get next available short case number for future registration
"RTN","RAREG1",59,0)
 ; re-set "CN" node if future short case number >99999
"RTN","RAREG1",60,0)
 ; NOTE1: find and store next free case number for future use 091300
"RTN","RAREG1",61,0)
 F RAJ=(^RA(79.2,RATYPE,"CN")+1):1 I '$D(^RADPT("AE",RAJ)) S ^("CN")=RAJ_"^"_$P(^RA(79.2,RATYPE,"CN"),"^",2) Q
"RTN","RAREG1",62,0)
 ; if the next free case no. for future use is >99999, need recalculate
"RTN","RAREG1",63,0)
 I +^RA(79.2,RATYPE,"CN")>99999 D CAL
"RTN","RAREG1",64,0)
CNQ L -^RA(79.2,RATYPE,"CN")
"RTN","RAREG1",65,0)
 I $D(X),X>99999 W !!?3,$C(7),"You have reached the maximum limit for case numbers (99,999).",!?3,"You must first complete/purge your old exams before you can proceed." K X
"RTN","RAREG1",66,0)
 K RAJ,RATYPE,RASET,RAX,RANS,RADT Q
"RTN","RAREG1",67,0)
DUP ;Check to prevent use of same case number/date pair ;ch
"RTN","RAREG1",68,0)
 ; both short and long case numbers will be checked for duplicates 091500
"RTN","RAREG1",69,0)
 S RADTE99=$S('$D(RADTE):"",1:$E(RADTE,4,5)_$E(RADTE,6,7)_$E(RADTE,2,3))
"RTN","RAREG1",70,0)
 I '$D(^RADPT("AE",RAX)),'$D(^RADPT("ADC",RADTE99_"-"_RAX)) G DUPQ
"RTN","RAREG1",71,0)
 ; also check ADC xref while searching for next available number 08/15/00
"RTN","RAREG1",72,0)
 ; note2: even though the current available case number is being
"RTN","RAREG1",73,0)
 ;        stored, the next free case number for future use will be
"RTN","RAREG1",74,0)
 ;        found and stored later, see note1 above     091300
"RTN","RAREG1",75,0)
 F RAJ=(^RA(79.2,RATYPE,"CN")+1):1 I '$D(^RADPT("AE",RAJ)),'$D(^RADPT("ADC",RADTE99_"-"_RAJ)) S ^("CN")=RAJ_"^"_$P(^RA(79.2,RATYPE,"CN"),"^",2) S RAX=+^RA(79.2,RATYPE,"CN") Q
"RTN","RAREG1",76,0)
DUPQ K RADTE99 Q
"RTN","RAREG1",77,0)
 ;
"RTN","RAREG1",78,0)
 ; the CAL section is called if :
"RTN","RAREG1",79,0)
 ;       there isn't a ^RA(79.2,RATYPE,"CN")
"RTN","RAREG1",80,0)
 ;   or  today's date is after the date in ^RA(79.2,RATYPE,"CN") piece 2
"RTN","RAREG1",81,0)
 ;   or  ^RA(79.2,RATYPE,"CN") piece 1 is > 99999, this is
"RTN","RAREG1",82,0)
 ;       checked in two places :
"RTN","RAREG1",83,0)
 ;         before using this piece 1 as the next case number
"RTN","RAREG1",84,0)
 ;         and after calculating future free case number
"RTN","RAREG1",85,0)
 ;   or  DUP section returns a case number > 99999
"RTN","RAREG1",86,0)
 ; 
"RTN","RAREG1",87,0)
 ; the first calculation starts from today's date and finds the date
"RTN","RAREG1",88,0)
 ; for the next Saturday
"RTN","RAREG1",89,0)
 ;      %Y=day of week, 6 being Saturday
"RTN","RAREG1",90,0)
 ;
"RTN","RAREG1",91,0)
 ; the second calculation starts from ^RADPT("AE",1 and finds the
"RTN","RAREG1",92,0)
 ; lowest  n  where  ^RADPT("AE",n) doesn't exist anymore.
"RTN","RAREG1",93,0)
 ;
"RTN","RAREG1",94,0)
 ; then the results are used to replace ^RA(79.2,RATYPE,"CN")
"RTN","RAREG1",95,0)
 ;     where
"RTN","RAREG1",96,0)
 ;       piece  1  is the next free case number
"RTN","RAREG1",97,0)
 ;       piece  2  is the date for next Saturday
"RTN","RAREG1",98,0)
 ;       RATYPE is always  1   by design
"RTN","RAREG1",99,0)
 ;
"RTN","RAREG1",100,0)
CAL K RAXX S:$D(X) RAXX=X S RAX=DT F RAII=0:0 S X1=RAX,X2=1 D C^%DTC S RAX=X D H^%DTC Q:%Y=6
"RTN","RAREG1",101,0)
 D YMD^%DTC F RAJ=1:1 I '$D(^RADPT("AE",RAJ)) S ^RA(79.2,RATYPE,"CN")=RAJ_"^"_X S:$D(RAXX) X=RAXX Q
"RTN","RAREG1",102,0)
 K RAJ,RAXX,RAX,RAII Q
"RTN","RAREG1",103,0)
PROC(Y) Q $P($G(^RAMIS(71,+Y,0)),U)
"RTN","RAREG1",104,0)
ASET ; register extra cases for a exam/print set that has no VALID report yet
"RTN","RAREG1",105,0)
 ; there may be a stub report from imaging for this set
"RTN","RAREG1",106,0)
 S RAREC="" ; prevent Q  from deleting the exam at "DT" level
"RTN","RAREG1",107,0)
 S (RAEXIT,RAQUIT,RASKIPIT,RACNICNT)=0 K ^TMP($J,"RAREG1")
"RTN","RAREG1",108,0)
 N RAFIRST S RAFIRST=$O(^RADPT(RADFN,"DT",RADTI,"P",0)) Q:'RAFIRST
"RTN","RAREG1",109,0)
 S RAOIFN=$P(^RADPT(RADFN,"DT",RADTI,"P",RAFIRST,0),"^",11) ;imagg order ien
"RTN","RAREG1",110,0)
 N DIR
"RTN","RAREG1",111,0)
PS1 S DIR(0)="Y",DIR("A")="For "_RANME_"'s exam set -- register another descendent exam (Y/N)"
"RTN","RAREG1",112,0)
 W ! D ^DIR Q:'Y
"RTN","RAREG1",113,0)
 N RAPARENT S RAPARENT=1 D ORDER^RAREG2 ;preserve EXAM SET stored data
"RTN","RAREG1",114,0)
 Q:RAQUIT  ;6/18/96
"RTN","RAREG1",115,0)
 K RAPRC S RAPARENT=1 D EXAMLOOP^RAREG2 ;prevent undef RAPROC in EXAMLOOP
"RTN","RAREG1",116,0)
 ; RACNI is set by edit tmpl that's used in EXAMLOOP^RAREG2
"RTN","RAREG1",117,0)
 ; quit if registration was incomplete <-- rareg2 deleted entire case
"RTN","RAREG1",118,0)
 Q:'$G(^RADPT(RADFN,"DT",RADTI,"P",RACNI,0))
"RTN","RAREG1",119,0)
 S RAPROC=$P($G(^RAO(75.1,+$G(RAOIFN),0)),U,2) ;ien of parent procedure
"RTN","RAREG1",120,0)
 ; set value of MEMBER OF SET
"RTN","RAREG1",121,0)
 ;    can't call memset^rareg2 to set MEMBER OF SET, due possiblity of
"RTN","RAREG1",122,0)
 ;    orig. proc being a single procedure that got converted to printset
"RTN","RAREG1",123,0)
 N RA25 S RA25=$P($G(^RADPT(RADFN,"DT",RADTI,"P",RAFIRST,0)),U,25)
"RTN","RAREG1",124,0)
 I RA25 N D,D0,DA,DI,DIC,DIE,DQ,DR,X,Y S DA(2)=RADFN,DA(1)=RADTI,DA=RACNI,DR="25///"_RA25,DIE="^RADPT("_RADFN_",""DT"","_RADTI_",""P""," D ^DIE
"RTN","RAREG1",125,0)
 G:RA25'=2 PS1
"RTN","RAREG1",126,0)
 ; combined report need more processing
"RTN","RAREG1",127,0)
 ; KLM/p144 RA17 gets corrupt with 'Add Exam to Last Visit', log it and set it again.
"RTN","RAREG1",128,0)
 I $D(RA17) D
"RTN","RAREG1",129,0)
 .N RASVTN S RASVTN=$P($G(^RADPT(RADFN,"DT",RADTI,"P",RAFIRST,0)),U,17)
"RTN","RAREG1",130,0)
 .I RASVTN'=RA17 D APPERROR^%ZTER("RA ADDEXAM - PS1^RAREG1") S RA17=RASVTN
"RTN","RAREG1",131,0)
 ;
"RTN","RAREG1",132,0)
 G:'$G(RA17) PS1 G:'$D(^RARPT(+$G(RA17),0))#2 PS1
"RTN","RAREG1",133,0)
 ; since there's a stub rpt from imaging (RA17), set piece 17
"RTN","RAREG1",134,0)
 D SET17^RAREG2(RADFN,RADTI,RACNI)
"RTN","RAREG1",135,0)
 ; copy over any dx/res/staff
"RTN","RAREG1",136,0)
 D COPYFROM^RAREG2(RACNI)
"RTN","RAREG1",137,0)
 ; insert rec in 74.05
"RTN","RAREG1",138,0)
 N RARPT,RARPTN,RA1,RAFDA,RAIEN,RAMSG,RAERR,RAXIT
"RTN","RAREG1",139,0)
 S RARPT=RA17,RARPTN=$P(^RARPT(RARPT,0),U),RA1=$P($G(^RADPT(RADFN,"DT",RADTI,"P",RACNI,0)),U)
"RTN","RAREG1",140,0)
P124 ;begin RA5P124 update
"RTN","RAREG1",141,0)
 I RA1 D
"RTN","RAREG1",142,0)
 .N RACCSTR S RACCSTR=$P(RARPTN,"-",1,($L(RARPTN,"-"))-1)_"-"_RA1
"RTN","RAREG1",143,0)
 .D:($D(^RARPT("B",RACCSTR,RARPT))=0) INSERT^RARTE2
"RTN","RAREG1",144,0)
 .Q
"RTN","RAREG1",145,0)
 ;end RA5P124 update
"RTN","RAREG1",146,0)
 G PS1
"RTN","RARTE")
0^14^B45769333^B44678185
"RTN","RARTE",1,0)
RARTE ;HISC/FPT,GJC AISC/MJK,RMO-Edit/Delete Reports ;26 Oct 2018 12:43 PM
"RTN","RARTE",2,0)
 ;;5.0;Radiology/Nuclear Medicine;**18,34,45,56,99,47,124**;Mar 16, 1998;Build 4
"RTN","RARTE",3,0)
 ;Supported IA #3544 ^VA(200,"ARC"
"RTN","RARTE",4,0)
 ;Supported IA #10076 ^XUSEC(
"RTN","RARTE",5,0)
 ;Supported IA #2056 ^GET1^DIQ
"RTN","RARTE",6,0)
 ;Supported IA #10009 YN^DICN
"RTN","RARTE",7,0)
 ; last modification by SS for P18 June 14,2000
"RTN","RARTE",8,0)
 ;
"RTN","RARTE",9,0)
 D SET^RAPSET1 I $D(XQUIT) K XQUIT Q
"RTN","RARTE",10,0)
 W !!?3,"Note: To enter receipt of OUTSIDE INTERPRETED REPORTS,",!?3,"please use the 'Outside Report/Entry Edit' option.",!
"RTN","RARTE",11,0)
 N RAXIT,RADRS,RASUBY0 S RAXIT=0 ;RADRS=copy (1=diag, 2=resid,staff)
"RTN","RARTE",12,0)
 I $D(RANOSCRN) S X=$$DIVLOC^RAUTL7() I X D Q^RARTE4 QUIT
"RTN","RARTE",13,0)
 ;
"RTN","RARTE",14,0)
 ;1. DO NOT KILL the RASIG variable; the RASIG() array is needed in
"RTN","RARTE",15,0)
 ;   the edit template [RA REPORT EDIT] later
"RTN","RARTE",16,0)
 ;2. The RAELESIG canNOT store file 74's ien, as no rpt has been picked
"RTN","RARTE",17,0)
 ;   from this call to ES^RASIGU
"RTN","RARTE",18,0)
 ;
"RTN","RARTE",19,0)
 I $D(^XUSEC("RA VERIFY",DUZ)),($$GET1^DIQ(200,DUZ_",",20.4)]""),($D(^VA(200,"ARC","R",DUZ))!($D(^VA(200,"ARC","S",DUZ)))) D  Q:'$D(RAELESIG)
"RTN","RARTE",20,0)
 . W ! D ES^RASIGU S:%=1 RAELESIG=""
"RTN","RARTE",21,0)
 . K:'$D(RAELESIG) %,%W,%Y,%Y1,C,X,X1,X2
"RTN","RARTE",22,0)
 . Q
"RTN","RARTE",23,0)
 K RABTCH I $P(RAMDV,"^",13) D ASKBTCH^RARTE1 G Q1^RARTE4:X["^" D 1^RABTCH:"Yy"[$E(X) I '$D(RABTCH) W " ...no batch selected",!
"RTN","RARTE",24,0)
START K RAVER S RAVW="",RAREPORT=1 D ^RACNLU G Q^RARTE4:"^"[X
"RTN","RARTE",25,0)
 S RASUBY0=Y(0) ; save value of y(0)
"RTN","RARTE",26,0)
 G:$P(^RA(72,+RAST,0),"^",3)>0 DISPLAY
"RTN","RARTE",27,0)
 I $D(^XUSEC("RA MGR",DUZ)) G DISPLAY
"RTN","RARTE",28,0)
 G:$P(RAMDV,"^",22)=1 DISPLAY
"RTN","RARTE",29,0)
 W $C(7),!!,"The STATUS for this case is CANCELLED. You may not enter a report.",!! D INCRPT^RARTE4 G START
"RTN","RARTE",30,0)
 ;
"RTN","RARTE",31,0)
DISPLAY ; Display exam specific info, edit/enter the report
"RTN","RARTE",32,0)
 N RA18EX S RA18EX=0 ;P18 for quit if uparrow inside PUTTCOM
"RTN","RARTE",33,0)
 N RASSAN,RACNDSP S RASSAN=$$SSANVAL^RAHLRU1(RADFN,RADTI,RACNI)
"RTN","RARTE",34,0)
 S RACNDSP=$S((RASSAN'=""):RASSAN,1:RACN)
"RTN","RARTE",35,0)
 I '($D(^RADPT(RADFN,"DT",RADTI,"P",RACNI,0))#2) D  D Q^RARTE4 QUIT
"RTN","RARTE",36,0)
 . I $$USESSAN^RAHLRU1() W !!?2,"Case #: ",RACNDSP," for ",RANME S RAXIT=1
"RTN","RARTE",37,0)
 . I '$$USESSAN^RAHLRU1() W !!?2,"Case #: ",RACN," for ",RANME S RAXIT=1
"RTN","RARTE",38,0)
 . W !?2,"Procedure: '",$E(RAPRC,1,45),"' has been deleted"
"RTN","RARTE",39,0)
 . W !?2,"by another user!",$C(7)
"RTN","RARTE",40,0)
 . Q
"RTN","RARTE",41,0)
 ;Lock case node so no one else can edit rpt pointer during this session
"RTN","RARTE",42,0)
 S RAPNODE="^RADPT("_RADFN_",""DT"","_RADTI_",""P"","
"RTN","RARTE",43,0)
 S RAXIT=$$LOCK^RAUTL12(RAPNODE,RACNI) I RAXIT D INCRPT^RARTE4 G START
"RTN","RARTE",44,0)
 S RAI="",$P(RAI,"-",80)="" W !,RAI
"RTN","RARTE",45,0)
 W !?1,"Name     : ",$E(RANME,1,25),?40,"Pt ID       : ",RASSN
"RTN","RARTE",46,0)
 I $$USESSAN^RAHLRU1() W !?1,"Case No. : ",RACNDSP,?40,"Exm. St     : ",$E($P($G(^RA(72,+RAST,0)),"^"),1,22),!?1,"Procedure: ",$E(RAPRC,1,45)
"RTN","RARTE",47,0)
 I '$$USESSAN^RAHLRU1() W !?1,"Case No. : ",RACN,?18,"Exm. St: ",$E($P($G(^RA(72,+RAST,0)),"^"),1,12),?40,"Procedure   : ",$E(RAPRC,1,25)
"RTN","RARTE",48,0)
 ;check for contrast media; display if CM data exists (patch 45)
"RTN","RARTE",49,0)
 S RACMDATA=$$CMEDIA^RAUTL8(RADFN,RADTI,RACNI)
"RTN","RARTE",50,0)
 D:$L(RACMDATA) CMEDIA(RACMDATA)
"RTN","RARTE",51,0)
 K RACMDATA
"RTN","RARTE",52,0)
 S RA18EX=$$PUTTCOM2^RAUTL11(RADFN,RADTI,RACN," Tech.Comment: ",15,70,-1,0) ;P18
"RTN","RARTE",53,0)
 I RA18EX=-1 Q  ;P18
"RTN","RARTE",54,0)
 N RAPRTSET,RAMEMARR,RA1
"RTN","RARTE",55,0)
 D EN2^RAUTL20(.RAMEMARR)
"RTN","RARTE",56,0)
 I RAPRTSET D
"RTN","RARTE",57,0)
 . S RA1=""
"RTN","RARTE",58,0)
 . F  S RA1=$O(RAMEMARR(RA1)) Q:RA1=""!(RA18EX=-1)  I RA1'=RACNI D
"RTN","RARTE",59,0)
 .. I $$USESSAN^RAHLRU1() W !,?1,"Case No. : ",$P(RAMEMARR(RA1),U)
"RTN","RARTE",60,0)
 .. I '$$USESSAN^RAHLRU1() W !,?1,"Case No. : ",+RAMEMARR(RA1)
"RTN","RARTE",61,0)
 .. I $$USESSAN^RAHLRU1() W:$P(RAMEMARR(RA1),"^",4)]"" ?40,"Exm. St     : ",$E($P($G(^RA(72,$P(RAMEMARR(RA1),"^",4),0)),"^"),1,22) W !?1,"Procedure: ",$E($P($G(^RAMIS(71,+$P(RAMEMARR(RA1),"^",2),0)),"^"),1,45)
"RTN","RARTE",62,0)
 .. I '$$USESSAN^RAHLRU1() W:$P(RAMEMARR(RA1),"^",4)]"" ?18,"Exm. St: ",$E($P($G(^RA(72,$P(RAMEMARR(RA1),"^",4),0)),"^"),1,12) W ?40,"Procedure   : ",$E($P($G(^RAMIS(71,+$P(RAMEMARR(RA1),"^",2),0)),"^"),1,26)
"RTN","RARTE",63,0)
 ..;check printset for contrast media; display if CM data exists
"RTN","RARTE",64,0)
 ..S RACMDATA=$$CMEDIA^RAUTL8(RADFN,RADTI,RA1)
"RTN","RARTE",65,0)
 ..D:$L(RACMDATA) CMEDIA(RACMDATA)
"RTN","RARTE",66,0)
 ..K RACMDATA
"RTN","RARTE",67,0)
 ..I $P(RAMEMARR(RA1),"^")["-" S RA18EX=$$PUTTCOM2^RAUTL11(RADFN,RADTI,$P($P(RAMEMARR(RA1),"^"),"-",3)," Tech.Comment: ",15,70,-1,0) Q:RA18EX=-1
"RTN","RARTE",68,0)
 ..I $P(RAMEMARR(RA1),"^")'["-" S RA18EX=$$PUTTCOM2^RAUTL11(RADFN,RADTI,+RAMEMARR(RA1)," Tech.Comment: ",15,70,-1,0) Q:RA18EX=-1  ;P18
"RTN","RARTE",69,0)
 .. Q
"RTN","RARTE",70,0)
 . Q
"RTN","RARTE",71,0)
SS1 I RA18EX=-1 Q  ;P18
"RTN","RARTE",72,0)
 W !?1,"Exam Date: ",RADATE,?40,"Technologist: " I $O(^RADPT(RADFN,"DT",RADTI,"P",RACNI,"TC",0))>0,$D(^VA(200,+^($O(^(0)),0),0)) W $E($P(^(0),"^"),1,25)
"RTN","RARTE",73,0)
 W !?1,"Req Phys    : ",$E($S($D(^VA(200,+$P(Y(0),"^",14),0)):$P(^(0),"^"),1:""),1,25)
"RTN","RARTE",74,0)
 ; p99: get pt sex and display pregnancy data
"RTN","RARTE",75,0)
 I $$PTSEX^RAUTL8(RADFN)="F" D
"RTN","RARTE",76,0)
 .N RA3,RAPCOMM S RA3=$G(^RADPT(RADFN,"DT",RADTI,"P",RACNI,0))
"RTN","RARTE",77,0)
 .S RAPCOMM=$G(^RADPT(RADFN,"DT",RADTI,"P",RACNI,"PCOMM"))
"RTN","RARTE",78,0)
 .W:$P(RA3,U,32)'="" !?1,"Pregnancy Screen: ",$S($P(RA3,"^",32)="y":"Patient answered yes",$P(RA3,"^",32)="n":"Patient answered no",$P(RA3,"^",32)="u":"Patient is unable to answer or is unsure",1:"")
"RTN","RARTE",79,0)
 .W:$P(RA3,U,32)'="n"&$L(RAPCOMM) !?1,"Pregnancy Screen Comment: ",RAPCOMM
"RTN","RARTE",80,0)
 S Y(0)=RASUBY0
"RTN","RARTE",81,0)
 W !,RAI
"RTN","RARTE",82,0)
 ;end p99
"RTN","RARTE",83,0)
 I $D(^RARPT(+RARPT,0)) S RA1=$P(^(0),"^",5) I "^V^EF^"[("^"_RA1_"^") W !?3,$C(7),"Report has already been ",$S(RA1="V":"verified",1:"electronically filed"),! D UNLOCK^RAUTL12(RAPNODE,RACNI) D INCRPT^RARTE4 G START
"RTN","RARTE",84,0)
 ;Create new rpt, or skip to IN to edit existing report
"RTN","RARTE",85,0)
 G IN^RARTE4:$D(^RARPT(+RARPT,0))
"RTN","RARTE",86,0)
 G:'RAPRTSET NEW G:$P(^RA(72,+RAST,0),"^",3)>0 NEW
"RTN","RARTE",87,0)
 ; case is part of a print set, AND is cancelled
"RTN","RARTE",88,0)
 N RA2 S (RA1,RA2)=""
"RTN","RARTE",89,0)
 F  S RA1=$O(RAMEMARR(RA1)) Q:RA1=""  S:$P(RAMEMARR(RA1),"^",3)]"" RA2=$P(RAMEMARR(RA1),"^",3)
"RTN","RARTE",90,0)
 G:RA2="" NEW
"RTN","RARTE",91,0)
 W !!,$C(7),"Other cases of this cancelled case ",RACNDSP,"'s print set are entered in a report already",!!,"You may NOT create a new report for this cancelled case,",!,"but you may include this cancelled case in the existing report."
"RTN","RARTE",92,0)
 W !!,"Do you want to include this cancelled case in the same report",!,"as the others in the print set ?"
"RTN","RARTE",93,0)
 S %=2 D YN^DICN
"RTN","RARTE",94,0)
 W:%>0 "...",$S(%=1:"Include",1:"Skip")," this case"
"RTN","RARTE",95,0)
P124 ;RA5P124 update: don't add an accession to OTHER CASE#
"RTN","RARTE",96,0)
 ;that is the .01 value of the report record
"RTN","RARTE",97,0)
 I %=1 S $P(^RADPT(RADFN,"DT",RADTI,"P",RACNI,0),"^",17)=RA2,RARPT=RA2,RARPTN=$P(^RARPT(RARPT,0),"^"),RA1=RACN D
"RTN","RARTE",98,0)
 .N RACCSTR S RACCSTR=$P(RARPTN,"-",1,($L(RARPTN,"-"))-1)_"-"_RACN
"RTN","RARTE",99,0)
 .D:($D(^RARPT("B",RACCSTR,RARPT))=0) INSERT^RARTE2
"RTN","RARTE",100,0)
 .Q
"RTN","RARTE",101,0)
 ;end RA5P124 update
"RTN","RARTE",102,0)
 D UNLOCK^RAUTL12(RAPNODE,RACNI) D INCRPT^RARTE4 G START
"RTN","RARTE",103,0)
NEW G:'RAPRTSET NEW1
"RTN","RARTE",104,0)
 L +^RADPT(RADFN,"DT",RADTI):0 G:$T NEW1
"RTN","RARTE",105,0)
 W !!?10,$C(7),"** This case belongs to a printset,",?68,"**",!?10,"** and someone else is currently doing REPORT ENTRY/EDIT",?68,"**"
"RTN","RARTE",106,0)
 W !?10,"** on another case for this same printset,",?68,"**",!?10,"** so you may not enter a new report.",?68,"**"
"RTN","RARTE",107,0)
 H 2 D UNLOCK^RAUTL12(RAPNODE,RACNI) D INCRPT^RARTE4 G START
"RTN","RARTE",108,0)
NEW1 ;
"RTN","RARTE",109,0)
 I $L(RACNDSP,"-")>1 S RARPTN=RACNDSP
"RTN","RARTE",110,0)
 I $L(RACNDSP,"-")<2 S RARPTN=$E(RADTE,4,7)_$E(RADTE,2,3)_"-"_RACN
"RTN","RARTE",111,0)
 W !?3,"...report not entered for this exam...",!?10,"...will now initialize report entry..."
"RTN","RARTE",112,0)
 S I=+$P(^RARPT(0),"^",3)
"RTN","RARTE",113,0)
 G LOCK^RARTE4
"RTN","RARTE",114,0)
 Q
"RTN","RARTE",115,0)
 ;
"RTN","RARTE",116,0)
CMEDIA(X) ;check if contrast media is associated with the report (exam)
"RTN","RARTE",117,0)
 ;variables assumed to exist X: the string of contrast media used
"RTN","RARTE",118,0)
 ;delimited by the comma.
"RTN","RARTE",119,0)
 N Y W !," Contrast :"
"RTN","RARTE",120,0)
 F Y=1:1 Q:$P(X,", ",Y)=""  W ?12,$P(X,", ",Y) W:$P(X,", ",Y+1)'="" !
"RTN","RARTE",121,0)
 Q
"RTN","RARTE1")
0^7^B66328918^B66239828
"RTN","RARTE1",1,0)
RARTE1 ;HISC/CAH,FPT,GJC AISC/MJK,RMO-Edit/Delete a Report ;01 Nov 2018 8:32 AM
"RTN","RARTE1",2,0)
 ;;5.0;Radiology/Nuclear Medicine;**2,15,17,23,31,68,56,47,124**;Mar 16, 1998;Build 4
"RTN","RARTE1",3,0)
 ;Private IA #4793 DELETE^WVRALINK, CREATE^WVRALINK 
"RTN","RARTE1",4,0)
 ;Supported IA #10035
"RTN","RARTE1",5,0)
 ;Supported IA #10007
"RTN","RARTE1",6,0)
 ;11/07/2005 KAM/BAY 110020 - Correct DUZ ID from Talk Technology
"RTN","RARTE1",7,0)
 ;                            During the Unverify process
"RTN","RARTE1",8,0)
DEL D SET^RAPSET1 I $D(XQUIT) K XQUIT Q
"RTN","RARTE1",9,0)
 S (RAPRG74,RAXIT)=0
"RTN","RARTE1",10,0)
 S DIC("A")="Select Report Day-Case#: "
"RTN","RARTE1",11,0)
 S DIC("W")="S RA0=^(0) W ""   "",$S($D(^DPT(+$P(RA0,""^"",2),0)):$P(^(0),""^""),1:""Unknown"") K RA0 W ""   "",$$FLD^RARTFLDS(+Y,""PROC"")"
"RTN","RARTE1",12,0)
 S DIC("S")="I $P(^(0),U,5)'=""X""" ;select only non-deleted reports
"RTN","RARTE1",13,0)
 S DIC="^RARPT(",DIC(0)="AEMQZ" D ^DIC K DIC G END:Y<0
"RTN","RARTE1",14,0)
 S RA0=Y(0),(DA,RAIEN)=+Y
"RTN","RARTE1",15,0)
 I $O(^RARPT(RAIEN,2005,0)) D  D END Q
"RTN","RARTE1",16,0)
 . W !!?5,"Cannot delete a report that is associated with an image."
"RTN","RARTE1",17,0)
 . W !?5,"Contact your Imaging Coordinator for further assistance.",!
"RTN","RARTE1",18,0)
 . S DIR(0)="E",DIR("A")="Press RETURN to continue"
"RTN","RARTE1",19,0)
 . D ^DIR K DIR,DIRUT,DUOUT
"RTN","RARTE1",20,0)
 . Q  ;08/23/00
"RTN","RARTE1",21,0)
 D CHK17^RARTE3 ;see this subroutine for values of RAOK
"RTN","RARTE1",22,0)
 G:RAOK=1 END ;can't del rpt w/o RACN or RACNI so avoid err at UP1^RAUTL1
"RTN","RARTE1",23,0)
 S RAXIT=$$LOCK^RAUTL12("^RARPT(",RAIEN)
"RTN","RARTE1",24,0)
 I RAXIT K RAXIT D END Q  ; record locked by another
"RTN","RARTE1",25,0)
ASKDEL ; ask if deletion is appropriate
"RTN","RARTE1",26,0)
 R !!,"Do you wish to delete this report? NO// ",X:DTIME
"RTN","RARTE1",27,0)
 S:'$T!(X="")!(X["^") X="N"
"RTN","RARTE1",28,0)
 I "Nn"[$E(X) D UNLOCK^RAUTL12("^RARPT(",RAIEN) G DEL
"RTN","RARTE1",29,0)
 I "Yy"'[$E(X) D  G ASKDEL
"RTN","RARTE1",30,0)
 . W:X'["?" $C(7)
"RTN","RARTE1",31,0)
 . W !!?3,"Enter 'YES' to delete this report, or 'NO' not to."
"RTN","RARTE1",32,0)
 . Q
"RTN","RARTE1",33,0)
 ; comment out next line, these 3 vars are already set by CHK17^RARTE3
"RTN","RARTE1",34,0)
 ;S RADFN=+$P(RA0,"^",2),RADTI=9999999.9999-$P(RA0,"^",3),RACN=$P(RA0,"^",4)
"RTN","RARTE1",35,0)
 G:RAOK=2 AD2 ;don't remove piece 17 if rpt doesn't match exm's rpt ptr
"RTN","RARTE1",36,0)
 ; del other member's REPORT TEXT xrefs, and set pointer to #74 as null
"RTN","RARTE1",37,0)
 D DEL17^RARTE2(RAIEN) ;del ptrs to file 74 excluding lead case of prtset
"RTN","RARTE1",38,0)
 S RACNI=$O(^RADPT(RADFN,"DT",RADTI,"P","B",RACN,0))
"RTN","RARTE1",39,0)
 G:'$D(^RADPT(RADFN,"DT",RADTI,"P",+RACNI,0))#2 AD2
"RTN","RARTE1",40,0)
 ; kill any xrefs for file #70's REPORT TEXT
"RTN","RARTE1",41,0)
 S DA(2)=RADFN,DA(1)=RADTI,DA=RACNI D ENKILL^RAXREF(70.03,17,RAIEN,.DA)
"RTN","RARTE1",42,0)
 ; set REPORT TEXT to null
"RTN","RARTE1",43,0)
 S $P(^RADPT(RADFN,"DT",RADTI,"P",+RACNI,0),"^",17)=""
"RTN","RARTE1",44,0)
AD2 K RAXIT S RAPRG74=1 ;RAPRG74 used in kill logic file 74 fld .01
"RTN","RARTE1",45,0)
 D MARKDEL^RARTE7 ; mark report deleted, save DXs, remov DXs fm case(s)
"RTN","RARTE1",46,0)
 W !?10,"...report deletion complete."
"RTN","RARTE1",47,0)
 D:RAOK'=2 UP1^RAUTL1 ;skip update status if report doesn't belong to exm
"RTN","RARTE1",48,0)
 D UPDTPNT^RAUTL9(RAIEN) ; Update pointers in 74.2, and 74.4!
"RTN","RARTE1",49,0)
 D UNLOCK^RAUTL12("^RARPT(",RAIEN) ; unlock report
"RTN","RARTE1",50,0)
 I RAOK'=2,$T(DELETE^WVRALINK)]"" D DELETE^WVRALINK(RADFN,RADTI,RACNI) ; women's health, skip if report doesn't belong to exm
"RTN","RARTE1",51,0)
END K %,%Y,D0,DA,DIC,DIE,RAJ1,DIK,RADFN,RADTI,RACN,RACNI,RA0,RAIEN,RAOR
"RTN","RARTE1",52,0)
 K RADUZ,RAORDIFN,RAPRG74,RASN,RASTI,Y
"RTN","RARTE1",53,0)
 K RADATE,RADTE,X
"RTN","RARTE1",54,0)
 K RA791,RACANC,RACN0,RACPT,RACPTNDE,RAI,RAN,RAOBR4,RAPKG,RAPRCNDE,RAPROC,RAPROCIT,RAPRV,RASULT,RAXIT
"RTN","RARTE1",55,0)
 K C,D,D1,DDER,DDH,DFN,DI,DISYS,DIWF,DIWL,DIWR,DQ,DR,GMRAL,HLN,HLRESLT,HLSAN,I,VA,VADM,VAERR,X0
"RTN","RARTE1",56,0)
 Q
"RTN","RARTE1",57,0)
 ;
"RTN","RARTE1",58,0)
UNVER(RAXRPT) ; unverify a report
"RTN","RARTE1",59,0)
 ; Input: if RAXRPT>0 then we know the report we wish to delete
"RTN","RARTE1",60,0)
 ;                    this requires no user interaction.
"RTN","RARTE1",61,0)
 ;           RAXRPT=0 user is prompted for the report they wish to
"RTN","RARTE1",62,0)
 ;                    delete (interactive)
"RTN","RARTE1",63,0)
 ;
"RTN","RARTE1",64,0)
 I 'RAXRPT D SET^RAPSET1 G Q:$D(XQUIT)
"RTN","RARTE1",65,0)
 I RAXRPT N X S X=RAXRPT
"RTN","RARTE1",66,0)
 S RAXIT=0,DIC="^RARPT(",DIC("S")="I $P(^(0),U,5)=""V"""
"RTN","RARTE1",67,0)
 S DIC(0)=$S('RAXRPT:"AEMQZ",1:"NZ")
"RTN","RARTE1",68,0)
 D DICW,^DIC K DIC I Y<0 D Q Q
"RTN","RARTE1",69,0)
 S RA74B4=$G(Y(0))
"RTN","RARTE1",70,0)
 S (RARPT,DA)=+Y,RADFN=$P(Y(0),U,2)
"RTN","RARTE1",71,0)
 S RADTI=9999999.9999-$P(Y(0),"^",3),RACN=$P(Y(0),"^",4)
"RTN","RARTE1",72,0)
 I 'RAXRPT S DR="D EN1^RAUTL9 I $D(DIRUT) S Y=""@99"";S:RASTATX'=""PD"" Y=""@10"";25;@10;5////^S X=RASTATX;S:X=""V"" Y=""@99"";9///@;17///@;100///NOW;@99"
"RTN","RARTE1",73,0)
 S:RAXRPT DR="5////^S X=""D"";9///@;17///@;100///NOW"
"RTN","RARTE1",74,0)
 ;11/07/2005 KAM/BAY 110020 Modified next line to look for voice recognition
"RTN","RARTE1",75,0)
 S DIE="^RARPT(",DR(2,74.01)="2////U;3////"_$S(($D(RAQUIET)#2)&($D(RASUB)#2):$G(^TMP("RARPT-REC",$J,RASUB,"RAVERF")),1:DUZ)
"RTN","RARTE1",76,0)
 S RAXIT=$$LOCK^RAUTL12("^RARPT(",RARPT)
"RTN","RARTE1",77,0)
 I RAXIT D Q QUIT
"RTN","RARTE1",78,0)
 D ^DIE K DE,DQ,DIE,DR D UNLOCK^RAUTL12("^RARPT(",RARPT)
"RTN","RARTE1",79,0)
 N RA1,RA2,RA3,RA4 S RA1=RADFN,RA2=RADTI,RA3=RACN,RA4=RARPT
"RTN","RARTE1",80,0)
 S RA(0)=$G(^RARPT(RARPT,0)),RA(5)=$P(^RARPT(RARPT,0),"^",5)
"RTN","RARTE1",81,0)
 S RA(7)=$P(^RARPT(RARPT,0),"^",7),RA(10)=$P(^RARPT(RARPT,0),"^",10)
"RTN","RARTE1",82,0)
 I RA(5)'="V" D
"RTN","RARTE1",83,0)
 . I RA(7)]"" D ENKILL^RAXREF(74,7,RA(7),RARPT) S $P(^RARPT(RARPT,0),"^",7)=""
"RTN","RARTE1",84,0)
 . I RA(10)]"" D ENKILL^RAXREF(74,10,RA(10),RARPT) S $P(^RARPT(RARPT,0),"^",10)=""
"RTN","RARTE1",85,0)
 . N RADDEN,RAUTOE S (RADDEN,RAUTOE)="" D ^RARTR,EN1^RARTE3(RA4)
"RTN","RARTE1",86,0)
 . Q
"RTN","RARTE1",87,0)
 S RADFN=RA1,RADTI=RA2,RACN=RA3,RARPT=RA4
"RTN","RARTE1",88,0)
 S RACNI=$O(^RADPT(RADFN,"DT",RADTI,"P","B",RACN,0)) I $D(^RADPT(RADFN,"DT",RADTI,"P",+RACNI,0)) D UP1^RAUTL1 I $D(^RABTCH(74.4,"B",RARPT)) D
"RTN","RARTE1",89,0)
 .S DA=0 F  S DA=$O(^RABTCH(74.4,"B",RARPT,DA)) Q:'DA  D
"RTN","RARTE1",90,0)
 ..S DIK="^RABTCH(74.4," D ^DIK
"RTN","RARTE1",91,0)
 ..Q
"RTN","RARTE1",92,0)
 .Q
"RTN","RARTE1",93,0)
 I "^V^EF^"'[("^"_$P($G(^RARPT(RARPT,0)),"^",5)_"^"),$T(DELETE^WVRALINK)]"" D DELETE^WVRALINK(RADFN,RADTI,RACNI) ; women's health
"RTN","RARTE1",94,0)
 ;
"RTN","RARTE1",95,0)
Q ; Kill and quit
"RTN","RARTE1",96,0)
 K DFN,DI,DIW,DIWF,DIWI,DIWL,DIWT,DIWTC,DIWX,RAACNT,RANUM,RAST,RAWHOVER
"RTN","RARTE1",97,0)
 K %,%DT,%W,%Y,%Y1,C,D,D0,D1,DA,DIC,DIE,DIK,DR,RA,RACN,RACNI,RADATE
"RTN","RARTE1",98,0)
 K RADFN,RADIV,RADTE,RADTI,RAJ,RAOR,RAORDIFN,RARPT,RASET,RASN,RASTATX
"RTN","RARTE1",99,0)
 K RASTI,RAXIT,X,XQUIT,Y,RA74B4,DDH,DIPGM,DISYS,I,RADUZ
"RTN","RARTE1",100,0)
 Q
"RTN","RARTE1",101,0)
 ;
"RTN","RARTE1",102,0)
STD S (RALR,RALI)=1
"RTN","RARTE1",103,0)
STD1 S DIC="^RA(74.1,",DIC("A")="Select 'Standard' Report to Copy: ",DIC(0)="AEMQ" D ^DIC K DIC("A") Q:Y<0
"RTN","RARTE1",104,0)
ASKSEL W:$$IMPRPT(RARPT) !!,"Report already exists.  This will over-write it."
"RTN","RARTE1",105,0)
 W !,"Are you sure you want the '",$P(Y,"^",2),"' standard report? No// " R X:DTIME G STD1:'$T!(X="")!(X["^")!("Nn"[$E(X))
"RTN","RARTE1",106,0)
 I "Yy"'[$E(X) W:X'["?" $C(7) W !!?3,"Enter 'YES' to select the '",$P(Y,"^",2),"' standard report, or 'NO' not to." G ASKSEL
"RTN","RARTE1",107,0)
 I RALR=1,RALI=1 K ^RARPT(RARPT,"R"),^("I")
"RTN","RARTE1",108,0)
 F I=1:1 Q:'$D(^RA(74.1,+Y,"R",I,0))  S ^RARPT(RARPT,"R",RALR,0)=^(0),RALR=RALR+1
"RTN","RARTE1",109,0)
 F I=1:1 Q:'$D(^RA(74.1,+Y,"I",I,0))  S ^RARPT(RARPT,"I",RALI,0)=^(0),RALI=RALI+1
"RTN","RARTE1",110,0)
ASKADD R !!,"Do you want to add another standard to this report? No// ",X:DTIME Q:'$T!(X="")!(X["^")!("Nn"[$E(X))  I "Yy"'[$E(X) W:X'["?" $C(7) W !!?3,"Enter 'YES' to add another standard to this report, or 'NO' not to." G ASKADD
"RTN","RARTE1",111,0)
 S (^RARPT(RARPT,"R",RALR,0),^RARPT(RARPT,"I",RALI,0))="",RALR=RALR+1,RALI=RALI+1 W ! G STD1
"RTN","RARTE1",112,0)
 ;
"RTN","RARTE1",113,0)
EDTRPT ; Called from 'RARTE4' and 'RARTVER'.
"RTN","RARTE1",114,0)
 N RAXIT S RACT=$S('+$G(^RARPT(RARPT,"T")):"I",1:"E")
"RTN","RARTE1",115,0)
 S:'$D(^RARPT(RARPT,"T")) ^("T")=""
"RTN","RARTE1",116,0)
 S DA=RARPT,DR="[RA REPORT EDIT]",DIE="^RARPT(" D ^DIE K DE,DQ ;,RAFLAGK
"RTN","RARTE1",117,0)
 I $D(Y),RACT="V",'$P(^RARPT(RARPT,0),"^",9) W !,$C(7),"You must enter a verifying Interpreting Physician to 'VERIFY' a report.",!?3,"...report status will now be changed to 'DRAFT'." S DA=RARPT,DR="5///D" D ^DIE K DE,DQ ;Q
"RTN","RARTE1",118,0)
 Q:$D(RAONLINE)&($G(RARDX)="E")
"RTN","RARTE1",119,0)
 ; move PACS line to its own subroutine
"RTN","RARTE1",120,0)
 ;I $D(RAFLAGK) K RAFLAGK Q
"RTN","RARTE1",121,0)
 G:$D(Y) PACS
"RTN","RARTE1",122,0)
 ;Since report editing is not necessarily screened by sign-on imaging
"RTN","RARTE1",123,0)
 ;type, use the imaging type on the exam record   ;ch
"RTN","RARTE1",124,0)
 S RAIMGTYI=$P($G(^RADPT(RADFN,"DT",RADTI,0)),U,2),RAIMGTYJ=$P($G(^RA(79.2,+RAIMGTYI,0)),U)
"RTN","RARTE1",125,0)
 S X=+$O(^RA(72,"AA",RAIMGTYJ,9,0)),DA(2)=RADFN,DA(1)=RADTI,DA=RACNI,DIE="^RADPT("_DA(2)_",""DT"","_DA(1)_",""P""," K RAIMGTYI,RAIMGTYJ
"RTN","RARTE1",126,0)
 S DR=13_$S(RACT'="V":"",'$D(^RA(72,X,.1)):"",$P(^(.1),"^",5)'="Y":"",1:"R")_";I $D(^RA(78.3,+X,0)),$P(^(0),""^"",4)=""y"" S RAAB=1"
"RTN","RARTE1",127,0)
 ;
"RTN","RARTE1",128,0)
 ;lock the correct sub-file (pset?)
"RTN","RARTE1",129,0)
 D DXLOC
"RTN","RARTE1",130,0)
 ;
"RTN","RARTE1",131,0)
 I RACT="V",$P($G(^RA(72,X,.1)),"^",5)="Y" S DIE("NO^")="BACK"
"RTN","RARTE1",132,0)
 I 'RAXIT D ^DIE K DA,DE,DQ,DIE,DR
"RTN","RARTE1",133,0)
 I RAXIT!($P(^RADPT(RADFN,"DT",RADTI,"P",RACNI,0),U,13)="")!($D(Y)) D DXULOC G PACS
"RTN","RARTE1",134,0)
 S DR="50///"_RACN
"RTN","RARTE1",135,0)
 S DR(2,70.03)=13.1
"RTN","RARTE1",136,0)
 S DR(3,70.14)=.01_";I $D(^RA(78.3,+X,0)),$P(^(0),""^"",4)=""y"" S RAAB=1"
"RTN","RARTE1",137,0)
 S DA(1)=RADFN,DA=RADTI,DIE="^RADPT("_DA(1)_",""DT"","
"RTN","RARTE1",138,0)
 ;
"RTN","RARTE1",139,0)
 I 'RAXIT D ^DIE K DA,DE,DQ,DIE,DR
"RTN","RARTE1",140,0)
 ;
"RTN","RARTE1",141,0)
COPYDX ;if we have a printset copy over the Dx code data (both primary & secondary)
"RTN","RARTE1",142,0)
 ;to all our descendents before building our HL7 ORU messsages.
"RTN","RARTE1",143,0)
 I RAPRTSET S RADRS=1,RAXIT=0 D COPY^RARTE2 ;P47
"RTN","RARTE1",144,0)
 ;unlock the correct sub-file (pset?)
"RTN","RARTE1",145,0)
 D DXULOC
"RTN","RARTE1",146,0)
 ;
"RTN","RARTE1",147,0)
PACS I ($P(^RARPT(RARPT,0),U,5)="V")!($P(^(0),U,5)="R") D RPT^RAHLRPC
"RTN","RARTE1",148,0)
 ;pre p124: "^V^EF" post p124 "^V^EF^"
"RTN","RARTE1",149,0)
 I "^V^EF^"[("^"_$P(^RARPT(RARPT,0),U,5)_"^"),$T(CREATE^WVRALINK)]"" D CREATE^WVRALINK(RADFN,RADTI,RACNI) ; women's health
"RTN","RARTE1",150,0)
 Q
"RTN","RARTE1",151,0)
 ;
"RTN","RARTE1",152,0)
ASKBTCH R !!,"Do you want to batch print reports? Yes// ",X:DTIME S:'$T X="^" S:X="" X="Y" Q:X["^"  I "Nn"'[$E(X),"Yy"'[$E(X) W:X'["?" $C(7) W !!?3,"Enter 'YES' to batch print reports, or 'NO' not to." G ASKBTCH
"RTN","RARTE1",153,0)
 Q
"RTN","RARTE1",154,0)
 ;
"RTN","RARTE1",155,0)
ASKPRT R !!,"Do you want to print batch now? No// ",X:DTIME S:'$T!(X="")!(X["^") X="N" I "Nn"'[$E(X),"Yy"'[$E(X) W:X'["?" $C(7) W !!?3,"Enter 'YES' to print this batch, or 'NO' not to." G ASKPRT
"RTN","RARTE1",156,0)
 Q
"RTN","RARTE1",157,0)
DICW ; Build DIC("W") string
"RTN","RARTE1",158,0)
 N DO D DO^DIC1
"RTN","RARTE1",159,0)
 S DIC("W")=$S($G(DIC("W"))]"":DIC("W")_" ",1:"")_"W ""   "",$$FLD^RARTFLDS(+Y,""PROC"")"
"RTN","RARTE1",160,0)
 Q
"RTN","RARTE1",161,0)
IMPRPT(Y) ; Does the report we are currently editing have either Report
"RTN","RARTE1",162,0)
 ; or Impression Text?
"RTN","RARTE1",163,0)
 ; Input : 'Y' - the ien of the report being edited
"RTN","RARTE1",164,0)
 ; Output: '1' - either impression or report text exists, '0' - neither
"RTN","RARTE1",165,0)
 ;               report or impression text exists.
"RTN","RARTE1",166,0)
 Q $S(+$O(^RARPT(Y,"I",0)):1,+$O(^RARPT(Y,"R",0)):1,1:0)
"RTN","RARTE1",167,0)
 ;
"RTN","RARTE1",168,0)
DXLOC ;lock the correct RAD/NUC MED PATIENT sub-file
"RTN","RARTE1",169,0)
 S:'RAPRTSET RAXIT=$$LOCK^RAUTL12("^RADPT("_RADFN_",""DT"","_RADTI_",""P"",",RACNI)
"RTN","RARTE1",170,0)
 S:RAPRTSET RAXIT=$$LOCK^RAUTL12("^RADPT("_RADFN_",""DT"",",RADTI)
"RTN","RARTE1",171,0)
 Q
"RTN","RARTE1",172,0)
 ;
"RTN","RARTE1",173,0)
DXULOC ;unlock the correct RAD/NUC MED PATIENT sub-file
"RTN","RARTE1",174,0)
 D:'RAPRTSET UNLOCK^RAUTL12("^RADPT("_RADFN_",""DT"","_RADTI_",""P"",",RACNI)
"RTN","RARTE1",175,0)
 D:RAPRTSET UNLOCK^RAUTL12("^RADPT("_RADFN_",""DT"",",RADTI)
"RTN","RARTE1",176,0)
 Q
"RTN","RARTE1",177,0)
 ;
"RTN","RARTE2")
0^11^B52409178^B32141462
"RTN","RARTE2",1,0)
RARTE2 ;HISC/SWM,GJC-Edit/Delete a Report ;07 Nov 2018 1:30 PM
"RTN","RARTE2",2,0)
 ;;5.0;Radiology/Nuclear Medicine;**10,31,47,124**;Mar 16, 1998;Build 4
"RTN","RARTE2",3,0)
 ; known vars-->RADFN,RACNI,RADTI,RARPT,RARPTN
"RTN","RARTE2",4,0)
 ;
"RTN","RARTE2",5,0)
 ;Routine              IA          Type
"RTN","RARTE2",6,0)
 ;-------------------------------------
"RTN","RARTE2",7,0)
 ; ^DIR               10026        (S)
"RTN","RARTE2",8,0)
 ; APPERROR^%ZTER     1621         (S)
"RTN","RARTE2",9,0)
 ;
"RTN","RARTE2",10,0)
PTR ; if the current study is the master study for
"RTN","RARTE2",11,0)
 ; the print set the accession of the master study
"RTN","RARTE2",12,0)
 ; is the .01 value of the master pset report record.
"RTN","RARTE2",13,0)
 ; All secondary studies will have their accession
"RTN","RARTE2",14,0)
 ; numbers filed in the OTHER CASE# multiple under
"RTN","RARTE2",15,0)
 ; that master pset report record. 
"RTN","RARTE2",16,0)
 ;
"RTN","RARTE2",17,0)
 ;RARPTN: the value of the .01 field of our master pset
"RTN","RARTE2",18,0)
 ;        report record (accession #)
"RTN","RARTE2",19,0)
 ;
"RTN","RARTE2",20,0)
 S RAXIT=0
"RTN","RARTE2",21,0)
 I '$D(RADFN)!'$D(RACNI)!'$D(RADTI)!'$D(RARPT)!'$D(RARPTN) D  Q
"RTN","RARTE2",22,0)
 . S RAXIT=1 Q:$G(RARIC)
"RTN","RARTE2",23,0)
 . I '$D(RAQUIET) W !!,$C(7),"Missing data (routine RARTE2)",! S RAOUT=$$EOS^RAUTL5() Q
"RTN","RARTE2",24,0)
 . S RAERR="Missing data needed by routine RARTE2"
"RTN","RARTE2",25,0)
 . Q
"RTN","RARTE2",26,0)
 ;
"RTN","RARTE2",27,0)
PTR2 ;find descendent, if part of the pset build accession #, if descendent canceled
"RTN","RARTE2",28,0)
 ;set flag on array.
"RTN","RARTE2",29,0)
 ;from RAHLO1: RARPTN=RALONGCN
"RTN","RARTE2",30,0)
 ;
"RTN","RARTE2",31,0)
 N RAO1,RA1ARY,RACCSTR
"RTN","RARTE2",32,0)
 ;RAO1    - study IEN (think RACNI)
"RTN","RARTE2",33,0)
 ;RACCSTR - front end of the accession (excludes case #) in this part
"RTN","RARTE2",34,0)
 ;          of the code (changes to full accession # in PTR3)
"RTN","RARTE2",35,0)
 ;RA1ARY  - this will be the array where our accession #s are stored
"RTN","RARTE2",36,0)
 ;          RA1ARY(RAO1,accession #)=""
"RTN","RARTE2",37,0)
 ;
"RTN","RARTE2",38,0)
 S RACCSTR=$P(RARPTN,"-",1,($L(RARPTN,"-")-1)) ;Ex: 141-040618 -or- 040618
"RTN","RARTE2",39,0)
 ;
"RTN","RARTE2",40,0)
 ;save off the accession # stored in the .01 field of the report
"RTN","RARTE2",41,0)
 ;we do not want this accession # set in the OTHER CASE# multiple
"RTN","RARTE2",42,0)
 S RA1ARY(0,RARPTN)=""
"RTN","RARTE2",43,0)
 ;
"RTN","RARTE2",44,0)
 S RAO1=0 K RAOX
"RTN","RARTE2",45,0)
 F  S RAO1=$O(^RADPT(RADFN,"DT",RADTI,"P",RAO1)) Q:'RAO1  D
"RTN","RARTE2",46,0)
 .S RAO1(0)=$G(^RADPT(RADFN,"DT",RADTI,"P",RAO1,0))
"RTN","RARTE2",47,0)
 .;get the order # of the exam status for this study RAOX(3)
"RTN","RARTE2",48,0)
 .S RAOX(3)=$P(^RA(72,+$P(RAO1(0),U,3),0),U,3)
"RTN","RARTE2",49,0)
 .I $$SILENT()=1,RAOX(3)=0 Q:$$ASK()'=1
"RTN","RARTE2",50,0)
 .;set the report pointer for the study in question
"RTN","RARTE2",51,0)
 .S $P(^RADPT(RADFN,"DT",RADTI,"P",RAO1,0),U,17)=RARPT
"RTN","RARTE2",52,0)
 .;build the accession number: +RAO1(0) = case number
"RTN","RARTE2",53,0)
 .S RAOX=RACCSTR_"-"_+RAO1(0)
"RTN","RARTE2",54,0)
 .I $P(RAO1(0),U,25)=2,('$D(RA1ARY(0,RAOX))#2) S RA1ARY(RAO1,RAOX)=""
"RTN","RARTE2",55,0)
 .Q
"RTN","RARTE2",56,0)
 K RAOX
"RTN","RARTE2",57,0)
 ;
"RTN","RARTE2",58,0)
PTR3 ; -RAO1: reused for $O subscript (think RACNI)
"RTN","RARTE2",59,0)
 ;     -RACCSTR: now represents the full accession #
"RTN","RARTE2",60,0)
 ;               Ex: 141-040618-12345 -or- 040618-12345
"RTN","RARTE2",61,0)
 ;     -RARPT: record # of RIS report in file #74
"RTN","RARTE2",62,0)
 ;
"RTN","RARTE2",63,0)
 S RAO1=0 F  S RAO1=$O(RA1ARY(RAO1)) Q:'RAO1  D
"RTN","RARTE2",64,0)
 .S RACCSTR=$O(RA1ARY(RAO1,"")) ;accession #
"RTN","RARTE2",65,0)
 .; do not file this accession # into the
"RTN","RARTE2",66,0)
 .; OTHER CASE# (#4.5) multiple if it already exists
"RTN","RARTE2",67,0)
 .; *** Milwaukee RIS issue: .01 overwritten & duplicate
"RTN","RARTE2",68,0)
 .; accessions in OTHER CASE# mult (124 T1) ***
"RTN","RARTE2",69,0)
 .D:($D(^RARPT("B",RACCSTR,RARPT))=0) INSERT
"RTN","RARTE2",70,0)
 .Q
"RTN","RARTE2",71,0)
 ;
"RTN","RARTE2",72,0)
 ;note: * I $G(RARIC) REPORT TEXT (70.03;17) is set in routine RARIC
"RTN","RARTE2",73,0)
 ;      * I $D(RAQUIET) REPORT TEXT is set in routine RAHLO1
"RTN","RARTE2",74,0)
 ;      * through the backdoor, REPORT TEXT is set in tag^routine(s):
"RTN","RARTE2",75,0)
 ;        - LOCK^RARTE4
"RTN","RARTE2",76,0)
 ;        - LOCK^RARTE5
"RTN","RARTE2",77,0)
 ;       
"RTN","RARTE2",78,0)
 ;      + noted b/c there was a hard set of the REPORT TEXT field in this code prior
"RTN","RARTE2",79,0)
 ;        to RA*5.0*124.
"RTN","RARTE2",80,0)
 Q
"RTN","RARTE2",81,0)
 ;
"RTN","RARTE2",82,0)
INSERT ; add subrec to file #74's subfile #74.05
"RTN","RARTE2",83,0)
 N RAFDA,RAIEN,RAMSG
"RTN","RARTE2",84,0)
 S RAIEN="?+1,"_RARPT_",",RAFDA(74.05,RAIEN,.01)=RACCSTR
"RTN","RARTE2",85,0)
 D UPDATE^DIE("","RAFDA","RAIEN","RAMSG")
"RTN","RARTE2",86,0)
 I $D(RAMSG) D  Q
"RTN","RARTE2",87,0)
 . S RAXIT=1 Q:$G(RARIC)
"RTN","RARTE2",88,0)
 . I '$D(RAQUIET) W !!,$C(7),"Error encountered while setting sub-records (routine RARTE2)",! S RAOUT=$$EOS^RAUTL5() Q  ;error detected
"RTN","RARTE2",89,0)
 . S RAERR="Error encountered while setting sub-recs from RARTE2"
"RTN","RARTE2",90,0)
 Q
"RTN","RARTE2",91,0)
 ;
"RTN","RARTE2",92,0)
DEL17(RAIEN) ;del other print set members' pointer to #74
"RTN","RARTE2",93,0)
 Q:'$D(RADFN)!('$D(RADTI))
"RTN","RARTE2",94,0)
 N RA4,RA1 D EN3^RAUTL20(.RA4)
"RTN","RARTE2",95,0)
 Q:'$O(RA4(0))
"RTN","RARTE2",96,0)
 S RA1=""
"RTN","RARTE2",97,0)
D18 S RA1=$O(RA4(RA1)) Q:RA1=""
"RTN","RARTE2",98,0)
 ; kill xrefs, if any, for file #70's REPORT TEXT
"RTN","RARTE2",99,0)
 S DA(2)=RADFN,DA(1)=RADTI,DA=RA1
"RTN","RARTE2",100,0)
 ; if this exam's piece 17 doesn't match RAIEN, then don't remove pc17
"RTN","RARTE2",101,0)
 I $P($G(^RADPT(RADFN,"DT",RADTI,"P",RA1,0)),"^",17)'=RAIEN G D18
"RTN","RARTE2",102,0)
 D ENKILL^RAXREF(70.03,17,RAIEN,.DA)
"RTN","RARTE2",103,0)
 ; set REPORT TEXT to null
"RTN","RARTE2",104,0)
 S:$D(^RADPT(RADFN,"DT",RADTI,"P",RA1,0)) $P(^(0),"^",17)=""
"RTN","RARTE2",105,0)
 G D18
"RTN","RARTE2",106,0)
COPY ;copy physicians and diagnoses
"RTN","RARTE2",107,0)
 Q:'$D(RADFN)!('$D(RADTI))!('$D(RACNI))!('$D(RAMEMARR))!('$D(RADRS))
"RTN","RARTE2",108,0)
 W !!,"... now copying ",$S(RADRS=1:"Diagnostic Codes",1:"Staff & Resident data")," to other cases in this print set ...",!
"RTN","RARTE2",109,0)
 N RA1,RA2,RA3
"RTN","RARTE2",110,0)
 N RA1PR,RA1PS ;prim res/staff
"RTN","RARTE2",111,0)
 N RA1SR,RA1SS ; sec res/staff arrays--(ien subfile #70.11)=ien file #200
"RTN","RARTE2",112,0)
 N RA1PD,RA1SD ; prim diag, then sec diags array
"RTN","RARTE2",113,0)
 N RAFDA,RAIEN,RAMSG
"RTN","RARTE2",114,0)
 ;prim res, prim staff, prim diag
"RTN","RARTE2",115,0)
 S RA1=^RADPT(RADFN,"DT",RADTI,"P",RACNI,0) S:RADRS=2 RA1PR=$P(RA1,"^",12),RA1PS=$P(RA1,"^",15) S:RADRS=1 RA1PD=$P(RA1,"^",13)
"RTN","RARTE2",116,0)
 ;sec residents
"RTN","RARTE2",117,0)
 I RADRS=2,$O(^RADPT(RADFN,"DT",RADTI,"P",RACNI,"SRR",0)) S RA1=0 F  S RA1=$O(^RADPT(RADFN,"DT",RADTI,"P",RACNI,"SRR",RA1)) Q:+RA1'=RA1  S RA1SR(RA1)=+^(RA1,0)
"RTN","RARTE2",118,0)
 ;sec staff
"RTN","RARTE2",119,0)
 I RADRS=2,$O(^RADPT(RADFN,"DT",RADTI,"P",RACNI,"SSR",0)) S RA1=0 F  S RA1=$O(^RADPT(RADFN,"DT",RADTI,"P",RACNI,"SSR",RA1)) Q:+RA1'=RA1  S RA1SS(RA1)=+^(RA1,0)
"RTN","RARTE2",120,0)
 ;sec diagnoses
"RTN","RARTE2",121,0)
 I RADRS=1,$O(^RADPT(RADFN,"DT",RADTI,"P",RACNI,"DX",0)) S RA1=0 F  S RA1=$O(^RADPT(RADFN,"DT",RADTI,"P",RACNI,"DX",RA1)) Q:+RA1'=RA1  S RA1SD(RA1)=+^(RA1,0)
"RTN","RARTE2",122,0)
 ;loop thru other cases of this printset
"RTN","RARTE2",123,0)
 S RA1=0
"RTN","RARTE2",124,0)
COPYLOOP S RA1=$O(RAMEMARR(RA1)) G:RA1="" COPYREF G:RA1=RACNI COPYLOOP ;skip what's done already
"RTN","RARTE2",125,0)
 ;
"RTN","RARTE2",126,0)
 ; copy primary staff and resident via Fileman
"RTN","RARTE2",127,0)
 I RADRS=2 D
"RTN","RARTE2",128,0)
 . S DA(2)=RADFN,DA(1)=RADTI,DA=RA1
"RTN","RARTE2",129,0)
 . S DIE="^RADPT("_DA(2)_",""DT"","_DA(1)_",""P"","
"RTN","RARTE2",130,0)
 . S DR="12////"_RA1PR_";15////"_RA1PS
"RTN","RARTE2",131,0)
 . D ^DIE K DA,DIE,DR ; no locking
"RTN","RARTE2",132,0)
 . Q
"RTN","RARTE2",133,0)
 ;
"RTN","RARTE2",134,0)
 ; copy primary diagnostic code via Fileman
"RTN","RARTE2",135,0)
 I RADRS=1 D
"RTN","RARTE2",136,0)
 . S DA(2)=RADFN,DA(1)=RADTI,DA=RA1
"RTN","RARTE2",137,0)
 . S DIE="^RADPT("_DA(2)_",""DT"","_DA(1)_",""P"","
"RTN","RARTE2",138,0)
 . S DR="13////"_RA1PD
"RTN","RARTE2",139,0)
 . D ^DIE K DA,DIE,DR ; no locking
"RTN","RARTE2",140,0)
 . Q
"RTN","RARTE2",141,0)
 ;
"RTN","RARTE2",142,0)
 S RA2=RA1_","_RADTI_","_RADFN ;stem for dataserver call
"RTN","RARTE2",143,0)
 S DA(3)=RADFN,DA(2)=RADTI,DA(1)=RA1 ;base vars for DIK call
"RTN","RARTE2",144,0)
 I RADRS=2 S RA3=0 D KIL3 G:RAXIT Q ; sec res
"RTN","RARTE2",145,0)
 I RADRS=2 S RA3=0 D KIL4 G:RAXIT Q ; sec staff
"RTN","RARTE2",146,0)
 I RADRS=1 S RA3=0 D KIL5 G:RAXIT Q ; sec diag
"RTN","RARTE2",147,0)
 G COPYLOOP
"RTN","RARTE2",148,0)
KIL3 S RA3=$O(^RADPT(RADFN,"DT",RADTI,"P",RA1,"SRR",RA3)) G:RA3="" COPY3
"RTN","RARTE2",149,0)
 S DA=RA3
"RTN","RARTE2",150,0)
 S DIK="^RADPT("_DA(3)_",""DT"","_DA(2)_",""P"","_DA(1)_",""SRR"","
"RTN","RARTE2",151,0)
 D ^DIK
"RTN","RARTE2",152,0)
 G KIL3
"RTN","RARTE2",153,0)
COPY3 K RAFDA,RAIEN,RAMSG S RA3=$O(RA1SR(RA3)) Q:'RA3  Q:RAXIT
"RTN","RARTE2",154,0)
UP3 ;
"RTN","RARTE2",155,0)
 S RAFDA(70.09,"?+2,"_RA2_",",.01)=RA1SR(RA3)
"RTN","RARTE2",156,0)
 D UPDATE^DIE("","RAFDA","RAIEN","RAMSG") G:'$D(RAMSG) COPY3
"RTN","RARTE2",157,0)
 S RAXIT=1 W !!,$C(7),"Error encountered while in adding rec ",RA3," to sub-file 70.09" Q
"RTN","RARTE2",158,0)
KIL4 S RA3=$O(^RADPT(RADFN,"DT",RADTI,"P",RA1,"SSR",RA3)) G:RA3="" COPY4
"RTN","RARTE2",159,0)
 S DA=RA3
"RTN","RARTE2",160,0)
 S DIK="^RADPT("_DA(3)_",""DT"","_DA(2)_",""P"","_DA(1)_",""SSR"","
"RTN","RARTE2",161,0)
 D ^DIK
"RTN","RARTE2",162,0)
 G KIL4
"RTN","RARTE2",163,0)
COPY4 K RAFDA,RAIEN,RAMSG S RA3=$O(RA1SS(RA3)) Q:'RA3  Q:RAXIT
"RTN","RARTE2",164,0)
UP4 ;
"RTN","RARTE2",165,0)
 S RAFDA(70.11,"?+2,"_RA2_",",.01)=RA1SS(RA3)
"RTN","RARTE2",166,0)
 D UPDATE^DIE("","RAFDA","RAIEN","RAMSG") G:'$D(RAMSG) COPY4
"RTN","RARTE2",167,0)
 S RAXIT=1 W !!,$C(7),"Error encountered while in adding rec ",RA3," to sub-file 70.11" Q
"RTN","RARTE2",168,0)
KIL5 S RA3=$O(^RADPT(RADFN,"DT",RADTI,"P",RA1,"DX",RA3)) G:RA3="" COPY5
"RTN","RARTE2",169,0)
 S DA=RA3
"RTN","RARTE2",170,0)
 S DIK="^RADPT("_DA(3)_",""DT"","_DA(2)_",""P"","_DA(1)_",""DX"","
"RTN","RARTE2",171,0)
 D ^DIK
"RTN","RARTE2",172,0)
 G KIL5
"RTN","RARTE2",173,0)
COPY5 K RAFDA,RAIEN,RAMSG S RA3=$O(RA1SD(RA3)) Q:'RA3  Q:RAXIT
"RTN","RARTE2",174,0)
UP5 ;
"RTN","RARTE2",175,0)
 S RAFDA(70.14,"?+2,"_RA2_",",.01)=RA1SD(RA3)
"RTN","RARTE2",176,0)
 D UPDATE^DIE("","RAFDA","RAIEN","RAMSG") G:'$D(RAMSG) COPY5
"RTN","RARTE2",177,0)
 S RAXIT=1 W !!,$C(7),"Error encountered while in adding rec ",RA3," to sub-file 70.14" Q
"RTN","RARTE2",178,0)
COPYREF ; clear out Fileman vars and quit
"RTN","RARTE2",179,0)
 K DA,DIK
"RTN","RARTE2",180,0)
 Q  ; don't need to re-xref again
"RTN","RARTE2",181,0)
Q K DA Q
"RTN","RARTE2",182,0)
 ;
"RTN","RARTE2",183,0)
SILENT() ;ask to include canceled cases if interactive
"RTN","RARTE2",184,0)
 ;RARIC: set in CREATE^RARIC
"RTN","RARTE2",185,0)
 ;RAQUIET: set in the RIS' HL7 bridge routine
"RTN","RARTE2",186,0)
 Q:$G(RARIC)!($D(RAQUIET)) 0
"RTN","RARTE2",187,0)
 Q 1
"RTN","RARTE2",188,0)
 ;
"RTN","RARTE2",189,0)
ASK() ;include canceled case in report?
"RTN","RARTE2",190,0)
 N DIRUT,DUOUT,DTOUT,DIR,X,Y,RAX
"RTN","RARTE2",191,0)
 S DIR(0)="Y",DIR("B")="No"
"RTN","RARTE2",192,0)
 S DIR("A",1)="Case "_+$P(RAO1(0),U)_" on this printset has been canceled."
"RTN","RARTE2",193,0)
 S DIR("A")="Do you want to include it in the report anyway" D ^DIR
"RTN","RARTE2",194,0)
 I $D(DIRUT) S Y=-1
"RTN","RARTE2",195,0)
 S RAX=$S(Y=1:"In",1:"Ex")_"clude case "_+$P(RAO1(0),U)
"RTN","RARTE2",196,0)
 W !!,RAX
"RTN","RARTE2",197,0)
 Q Y ;'1' for yes, '0' for no
"RTN","RARTE2",198,0)
 ;
"RTN","RARTE5")
0^15^B105969926^B103201399
"RTN","RARTE5",1,0)
RARTE5 ;HISC/SWM AISC/MJK,RMO-Enter/Edit Outside Reports ;26 Oct 2018 12:49 PM
"RTN","RARTE5",2,0)
 ;;5.0;Radiology/Nuclear Medicine;**56,95,97,47,141,124**;Mar 16, 1998;Build 4
"RTN","RARTE5",3,0)
 ;Private IA #4793 CREATE^WVRALINK
"RTN","RARTE5",4,0)
 ;Controlled IA #3544 ^VA(200
"RTN","RARTE5",5,0)
 ;Supported IA #2056 GET1^DIQ
"RTN","RARTE5",6,0)
 ;Supported IA #10013 IX1^DIK
"RTN","RARTE5",7,0)
 ;Supported IA #10141 MES^XPDUTL
"RTN","RARTE5",8,0)
 ; adapted from RARTE, RARTE1, RARTE4
"RTN","RARTE5",9,0)
 F I=1:1:10 W !?3,$P($T(INTRO+I),";;",2)
"RTN","RARTE5",10,0)
 W ! D SET^RAPSET1 I $D(XQUIT) K XQUIT Q
"RTN","RARTE5",11,0)
 N RAXIT,RASUBY0,RA18EX,RAPRTSET,RAMEMARR,RA1,RA7003
"RTN","RARTE5",12,0)
 S RAXIT=0
"RTN","RARTE5",13,0)
 K RASSS,RASSSX ;clear HL7 exclusion vars
"RTN","RARTE5",14,0)
 I $D(RANOSCRN) S X=$$DIVLOC^RAUTL7() I X D Q1 QUIT
"RTN","RARTE5",15,0)
 ;
"RTN","RARTE5",16,0)
 ; only require any Radiology Classification in New Person file
"RTN","RARTE5",17,0)
 S X=0 F I="C","R","S","T" S:$D(^VA(200,"ARC",I,DUZ)) X=1
"RTN","RARTE5",18,0)
 I 'X W !,"Your user account is missing a Radiology classification.",! D INCRPT Q
"RTN","RARTE5",19,0)
 ;
"RTN","RARTE5",20,0)
START S RAFIRST=0 ;=1 for 1st time rpt given "EF" rpt status
"RTN","RARTE5",21,0)
 K RAVER,RAX S (RAVW,RAX)="",RAREPORT=1 D ^RACNLU G Q1:"^"[X
"RTN","RARTE5",22,0)
 ; RACNLU defines RADFN, RADTI, RACNI, RARPT
"RTN","RARTE5",23,0)
 S RASUBY0=Y(0) ; save value of y(0)
"RTN","RARTE5",24,0)
 N RASSAN,RACNDSP S RASSAN=$P(RASUBY0,U,31)
"RTN","RARTE5",25,0)
 S RACNDSP=$S((RASSAN'=""):RASSAN,1:$P(RASUBY0,U,1))
"RTN","RARTE5",26,0)
 G:$P(^RA(72,+RAST,0),"^",3)>0 CONTIN
"RTN","RARTE5",27,0)
 I $D(^XUSEC("RA MGR",DUZ)) G CONTIN
"RTN","RARTE5",28,0)
 G:$P(RAMDV,"^",22)=1 CONTIN
"RTN","RARTE5",29,0)
 W $C(7),!!,"The STATUS for this case is CANCELLED. You may not enter a report.",!! D INCRPT G START
"RTN","RARTE5",30,0)
 ;
"RTN","RARTE5",31,0)
CONTIN ; continue
"RTN","RARTE5",32,0)
 S RAXIT=0 D DISPLAY^RARTE6
"RTN","RARTE5",33,0)
 I RA18EX=-1 D INCRPT G START
"RTN","RARTE5",34,0)
 ; raprtset is defined in display^rarte6
"RTN","RARTE5",35,0)
 S RAPNODE="^RADPT("_RADFN_",""DT"","_RADTI_",""P"","
"RTN","RARTE5",36,0)
 S RA7003=@(RAPNODE_RACNI_",0)")
"RTN","RARTE5",37,0)
 S RAXIT=$$LOCK^RARTE6(RAPNODE,RACNI) I RAXIT D INCRPT G START
"RTN","RARTE5",38,0)
 ;
"RTN","RARTE5",39,0)
 ; Real rpt must have fld 5="EF" & fld 18 w/ data.  Stub rpt allowed
"RTN","RARTE5",40,0)
 I $D(^RARPT(+RARPT,0)),(($P(^(0),"^",5)'="EF")!($P(^(0),"^",18)="")),'$$STUB^RAEDCN1(+RARPT) W !?3,$C(7),"Only Electronically Filed reports can be selected!",! D UNLOCK^RAUTL12(RAPNODE,RACNI) D INCRPT G START
"RTN","RARTE5",41,0)
 ;Create new rpt, or skip to IN to edit existing report
"RTN","RARTE5",42,0)
 G IN:$D(^RARPT(+RARPT,0))
"RTN","RARTE5",43,0)
 ;
"RTN","RARTE5",44,0)
 G:'RAPRTSET NEW G:$P(^RA(72,+RAST,0),"^",3)>0 NEW
"RTN","RARTE5",45,0)
 ; case is part of a print set, AND is cancelled
"RTN","RARTE5",46,0)
 N RA2 S (RA1,RA2)=""
"RTN","RARTE5",47,0)
 F  S RA1=$O(RAMEMARR(RA1)) Q:RA1=""  S:$P(RAMEMARR(RA1),"^",3)]"" RA2=$P(RAMEMARR(RA1),"^",3)
"RTN","RARTE5",48,0)
 G:RA2="" NEW
"RTN","RARTE5",49,0)
 W !!,$C(7),"Other cases of this cancelled case ",RACN,"'s print set are entered in a report already",!!,"You may NOT create a new report for this cancelled case,",!,"but you may include this cancelled case in the existing report."
"RTN","RARTE5",50,0)
 W !!,"Do you want to include this cancelled case in the same report",!,"as the others in the print set ?"
"RTN","RARTE5",51,0)
 S %=2 D YN^DICN
"RTN","RARTE5",52,0)
 W:%>0 "...",$S(%=1:"Include",1:"Skip")," this case"
"RTN","RARTE5",53,0)
P124 ;fix for RA5P124
"RTN","RARTE5",54,0)
 I %=1 S $P(^RADPT(RADFN,"DT",RADTI,"P",RACNI,0),"^",17)=RA2,RARPT=RA2,RARPTN=$P(^RARPT(RARPT,0),"^"),RA1=RACN D
"RTN","RARTE5",55,0)
 .N RACCSTR S RACCSTR=$P(RARPTN,"-",1,($L(RARPTN,"-"))-1)_"-"_RACN
"RTN","RARTE5",56,0)
 .D:($D(^RARPT("B",RACCSTR,RARPT))=0) INSERT^RARTE2
"RTN","RARTE5",57,0)
 .Q
"RTN","RARTE5",58,0)
 ;end fix RA5P124
"RTN","RARTE5",59,0)
 D UNLOCK^RAUTL12(RAPNODE,RACNI) D INCRPT G START
"RTN","RARTE5",60,0)
NEW G:'RAPRTSET NEW1
"RTN","RARTE5",61,0)
 L +^RADPT(RADFN,"DT",RADTI):DILOCKTM G:$T NEW1
"RTN","RARTE5",62,0)
 W !!?10,$C(7),"** This case belongs to a printset, and someone else is",?68,"**",!?10,"** editing another case from this printset, or entering",?68,"**"
"RTN","RARTE5",63,0)
 W !?10,"** a report for this printset, so you may not enter a",?68,"**",!?10,"** new report.",?68,"**"
"RTN","RARTE5",64,0)
 H 2 D UNLOCK^RAUTL12(RAPNODE,RACNI) D INCRPT G START
"RTN","RARTE5",65,0)
 ;
"RTN","RARTE5",66,0)
NEW1 ;
"RTN","RARTE5",67,0)
 I $L(RACNDSP,"-")>1 S RARPTN=RACNDSP
"RTN","RARTE5",68,0)
 I $L(RACNDSP,"-")<2 S RARPTN=$E(RADTE,4,7)_$E(RADTE,2,3)_"-"_RACN
"RTN","RARTE5",69,0)
 W !?3,"...report not entered for this exam...",!?10,"...will now initialize report entry..."
"RTN","RARTE5",70,0)
 S I=+$P(^RARPT(0),"^",3)
"RTN","RARTE5",71,0)
 ;
"RTN","RARTE5",72,0)
LOCK ;Try to lock next avail IEN, if locked - fail, if used - increment again
"RTN","RARTE5",73,0)
 S I=I+1 S RAXIT=$$LOCK^RARTE6("^RARPT(",I) I RAXIT D UNLOCK2^RARTE4 D INCRPT G START
"RTN","RARTE5",74,0)
 ;don't check ^RARPT("B",RARPTN) due cloaked deleted reports
"RTN","RARTE5",75,0)
 I $D(^RARPT(I)) D UNLOCK^RAUTL12("^RARPT(",I) G LOCK
"RTN","RARTE5",76,0)
 S ^RARPT(I,0)=RARPTN,RARPT=I,^(0)=$P(^RARPT(0),"^",1,2)_"^"_I_"^"_($P(^(0),"^",4)+1),^DISV($S($D(DUZ)#2:DUZ,1:0),"^RARPT(")=I S:'$D(^RARPT(RARPT,"T")) ^("T")=""
"RTN","RARTE5",77,0)
 S ^RARPT(RARPT,0)=RARPTN_"^"_RADFN_"^"_RADTE_"^"_RACN_"^EF",DIK="^RARPT(",DA=RARPT D IX1^DIK
"RTN","RARTE5",78,0)
 K %,D,D0,DA,DI,DIC,DIE,DQ,DR,X,Y
"RTN","RARTE5",79,0)
 S DA(2)=RADFN,DA(1)=RADTI,DA=RACNI
"RTN","RARTE5",80,0)
 S DIE="^RADPT("_RADFN_",""DT"","_RADTI_",""P"","
"RTN","RARTE5",81,0)
 S DR="17////"_RARPT D ^DIE
"RTN","RARTE5",82,0)
 K %,D,D0,DA,DI,DIC,DIE,DQ,DR,RAY1,X,Y
"RTN","RARTE5",83,0)
 ;if printset -- set pc 17 in subfile 70.03 and subrec in subfile 74.05
"RTN","RARTE5",84,0)
 I RAPRTSET D PTR^RARTE2
"RTN","RARTE5",85,0)
 I RAXIT D UNLOCK2^RARTE4,UNLOCK^RAUTL12("^RARPT(",RARPT) G Q1
"RTN","RARTE5",86,0)
 W !,RAI
"RTN","RARTE5",87,0)
 G IN0
"RTN","RARTE5",88,0)
IN ;edit existing rpt, so lock rpt fr the 1st time
"RTN","RARTE5",89,0)
 S RAXIT=$$LOCK^RARTE6("^RARPT(",RARPT) I RAXIT D UNLOCK2^RARTE4 G Q1
"RTN","RARTE5",90,0)
IN0 ;skip to here if rpt created in this session and already locked
"RTN","RARTE5",91,0)
 ; Flag first time EF report is made if piece 18 has no data  yet
"RTN","RARTE5",92,0)
 I $P(^RARPT(RARPT,0),U,18)="" S RAFIRST=1
"RTN","RARTE5",93,0)
 ; save DXs before edit
"RTN","RARTE5",94,0)
 S RANY1=$$ANYDX^RARTE7(.RAA1) ;1=has DXs, 0=no DXs, RAA1() stores DXs
"RTN","RARTE5",95,0)
 ; Ask if copy standard report
"RTN","RARTE5",96,0)
 I $P(RAMDV,"^",12) D STD^RARTE1 I X="^" S RAXIT=1,RAX=X G UNCASE
"RTN","RARTE5",97,0)
 ;  Ask Report Date
"RTN","RARTE5",98,0)
 S DR="8",DA=RARPT,DIE="^RARPT(" D ^DIE K DE,DQ
"RTN","RARTE5",99,0)
 ; y is defined if user "^" out
"RTN","RARTE5",100,0)
 I $D(Y) K Y G UNCASE
"RTN","RARTE5",101,0)
 ;   Display Clinical History
"RTN","RARTE5",102,0)
 D CHPRINT^RAUTL9
"RTN","RARTE5",103,0)
 ; report status before editing
"RTN","RARTE5",104,0)
 S RACT=$P(^RARPT(RARPT,0),U,5)
"RTN","RARTE5",105,0)
 ; Edit Report Text and enter Diagnostic code(s)
"RTN","RARTE5",106,0)
 D ERPT
"RTN","RARTE5",107,0)
 ; Resident and Staff not asked and not copied to other cases of printset
"RTN","RARTE5",108,0)
 ; continue to check sufficient data even if RAXIT=1 at this point
"RTN","RARTE5",109,0)
UNCASE ; 
"RTN","RARTE5",110,0)
 D UNLOCK^RAUTL12(RAPNODE,RACNI) ;unlock case
"RTN","RARTE5",111,0)
 ; copy diags to other cases of printset
"RTN","RARTE5",112,0)
 ; and unlock case "DT" level after copying is done
"RTN","RARTE5",113,0)
 I RAPRTSET S RADRS=1 D COPY^RARTE2 L -^RADPT(RADFN,"DT",RADTI)
"RTN","RARTE5",114,0)
 ; first time EF rpt made -- del rpt & xrefs if no rpt txt & impression
"RTN","RARTE5",115,0)
 I RAFIRST S RAXIT=$$CCAN(RARPT)
"RTN","RARTE5",116,0)
 I RAX="^" S RAXIT=1
"RTN","RARTE5",117,0)
 D UNLOCK^RAUTL12("^RARPT(",RARPT) ;unlock report
"RTN","RARTE5",118,0)
 G:RAXIT PRT
"RTN","RARTE5",119,0)
 ;
"RTN","RARTE5",120,0)
 ;  "EF" was stuffed in LOCK+5 for new rpts but not stub rpt yet
"RTN","RARTE5",121,0)
 I $P(^RARPT(RARPT,0),U,5)'="EF" D SETFF^RARTE6(74,5,RARPT,"EF")
"RTN","RARTE5",122,0)
 W !!?5,"Report status is stored as ""Electronically Filed""."
"RTN","RARTE5",123,0)
 ; Stuff in initial entry date only once
"RTN","RARTE5",124,0)
 I RAFIRST D SETFF^RARTE6(74,18,RARPT,"NOW","E")
"RTN","RARTE5",125,0)
 ;   Stuff in Activity Log subfile at all times
"RTN","RARTE5",126,0)
 D SETALOG^RARTE6("+1,"_RARPT_",","F","")
"RTN","RARTE5",127,0)
 ;
"RTN","RARTE5",128,0)
 ; transmit to women's health each time this point is reached
"RTN","RARTE5",129,0)
 ; COPY^WVRALINK will stop if the same case number is already in 790.1
"RTN","RARTE5",130,0)
 ;
"RTN","RARTE5",131,0)
 I $P(^RARPT(RARPT,0),U,5)="EF",$T(CREATE^WVRALINK)]"" D CREATE^WVRALINK(RADFN,RADTI,RACNI) ; women's health
"RTN","RARTE5",132,0)
 ;
"RTN","RARTE5",133,0)
PRT I RAXIT S RAXIT=0 D UNLOCK2^RARTE4 D INCRPT G START
"RTN","RARTE5",134,0)
 ;
"RTN","RARTE5",135,0)
 ; report status after editing
"RTN","RARTE5",136,0)
 S RACT=$P(^RARPT(RARPT,0),U,5)
"RTN","RARTE5",137,0)
 ; ---
"RTN","RARTE5",138,0)
 ; set RAHLTCPB to prevent broadcast ORM messages
"RTN","RARTE5",139,0)
 N RAHLTCPB S RAHLTCPB=1
"RTN","RARTE5",140,0)
 ;
"RTN","RARTE5",141,0)
 ; update case's exam status only if exam status isn't COMPLETE
"RTN","RARTE5",142,0)
 ; and isn't CANCEL
"RTN","RARTE5",143,0)
 ; and ((birads not required) or (birads required and entered))
"RTN","RARTE5",144,0)
 S RA2=$$GET1^DIQ(72,+$P(RA7003,U,3)_",",3)
"RTN","RARTE5",145,0)
 I RA2'=9,(RA2'=0) D
"RTN","RARTE5",146,0)
 .I 'RABIREQ D UP1^RAUTL1 Q
"RTN","RARTE5",147,0)
 .I RABIDAT D UP1^RAUTL1 Q
"RTN","RARTE5",148,0)
 .E  W !!?5,"Exam status not recalculated due to missing BI-RADS code."
"RTN","RARTE5",149,0)
 .Q
"RTN","RARTE5",150,0)
 S RANY2=$$ANYDX^RARTE7(.RAA2) ;RAA2() store DXs after edit
"RTN","RARTE5",151,0)
 ; check if new/changed diagnostic codes, send alert if nec.
"RTN","RARTE5",152,0)
 D ALERT^RARTE7
"RTN","RARTE5",153,0)
 K RAAB
"RTN","RARTE5",154,0)
 ; broadcast if EF rpt made first time, or any DX changed/added/del'd
"RTN","RARTE5",155,0)
 I $O(RAA2(0))!(RAFIRST) D
"RTN","RARTE5",156,0)
 .D HLXMSG ;find VR subscribers to exclude
"RTN","RARTE5",157,0)
 .D RPT^RAHLRPC
"RTN","RARTE5",158,0)
 .Q
"RTN","RARTE5",159,0)
PRT1 R !!,"Do you wish to print this report? No// ",X:DTIME S:'$T!(X["^") X="N" S:X="" X="N" ;030497
"RTN","RARTE5",160,0)
 I "Nn"[$E(X) D INCRPT G START
"RTN","RARTE5",161,0)
 I "Yy"'[$E(X) W:X'["?" $C(7) W !!?3,"Enter 'YES' to print this report, or 'NO' not to." G PRT1
"RTN","RARTE5",162,0)
 S ION=$P(RAMLC,"^",10),IOP=$S(ION]"":"Q;"_ION,1:"Q")
"RTN","RARTE5",163,0)
 S RAMES="W !!?3,""Report has been queued for printing on device "",ION,""."""
"RTN","RARTE5",164,0)
 D Q^RARTR D INCRPT G START ; queue rpt, cleanup, startover
"RTN","RARTE5",165,0)
 ;
"RTN","RARTE5",166,0)
Q1 K %,%DT,%W,%Y,%Y1,C,D0,D1,DA,DIC,DIE,DR,OREND,RABTCH,RABTCHN,RACN,RACNI,RACOPY,RACS,RACT,RADATE,RADFN,RADTE,RADTI,RADUZ,RAELESIG,RAFIN,RAHEAD,RAI,RAJ1
"RTN","RARTE5",167,0)
 K RALI,RALR,RANME,RANUM,RAOR,RAORDIFN,RAPNODE,RAPRC,RAPRIT,RAQUIT,RAREPORT,RARES,RARPDT,RARPT,RARPTN,RARPTZ,RARTPN,RASET,RASI,RASIG,RASN,RASSN,RAST,RAST1,RASTI,RASTFF,RAVW,XQUIT,W,X,Y
"RTN","RARTE5",168,0)
 K D,D2,DDER,DI,DIPGM,DLAYGO,J,RAEND,RAF5,RAFL,RAFST,RAIX,RAPOP,RAY1
"RTN","RARTE5",169,0)
 K ^TMP($J,"RAEX")
"RTN","RARTE5",170,0)
 K POP,DUOUT,RAFDA,RATEXT,RADIR0,RAXIT,RAX
"RTN","RARTE5",171,0)
 D INCRPT
"RTN","RARTE5",172,0)
 Q
"RTN","RARTE5",173,0)
INCRPT ; Kill extraneous variables to avoid collisions.
"RTN","RARTE5",174,0)
 ; Incomplete report information, select another case #.
"RTN","RARTE5",175,0)
 K DA,DIE,DR,RATXT
"RTN","RARTE5",176,0)
 K %,%DT,D,D0,D1,D2,DI,DIC,DIWT,DN,I,J,RAA1,RAA2
"RTN","RARTE5",177,0)
 K RABIENS,RABIDAT,RABIREQ,RACN,RACNI,RACT
"RTN","RARTE5",178,0)
 K RADATE,RADRS,RADTE,RADTI,RAFIN,RAFIRST,RAI,RALI,RALR,RANME,RAPRC,RARPT
"RTN","RARTE5",179,0)
 K RARPTN,RASSN,RAST,RAVW,RASSS,RASSSX,X
"RTN","RARTE5",180,0)
 Q
"RTN","RARTE5",181,0)
CCAN(IEN74) ;Check canned report for Outside Reporting
"RTN","RARTE5",182,0)
 ; adapted from EN3^RAUTL15
"RTN","RARTE5",183,0)
 ; outputs:  0 if report is kept
"RTN","RARTE5",184,0)
 ;           1 if report is deleted due to no canned text entered
"RTN","RARTE5",185,0)
 ;
"RTN","RARTE5",186,0)
 N RAPRG74,RATXT
"RTN","RARTE5",187,0)
 ; keep report if it is linked to images
"RTN","RARTE5",188,0)
 I $O(^RARPT(IEN74,2005,0))>0 Q 0
"RTN","RARTE5",189,0)
 ;
"RTN","RARTE5",190,0)
 ;del canned report if missing both REPORT TEXT and IMPRESSION TEXT
"RTN","RARTE5",191,0)
 I '$O(^RARPT(IEN74,"I",0)),'$O(^RARPT(IEN74,"R",0)) D  Q 1
"RTN","RARTE5",192,0)
 .; un-link rpt from other cases of printset
"RTN","RARTE5",193,0)
 .D DEL17^RARTE2(IEN74)
"RTN","RARTE5",194,0)
 .; exec field's xrefs' KILL logic
"RTN","RARTE5",195,0)
 .S DA(2)=RADFN,DA(1)=RADTI,DA=RACNI
"RTN","RARTE5",196,0)
 .D ENKILL^RAXREF(70.03,17,IEN74,.DA)
"RTN","RARTE5",197,0)
 .;
"RTN","RARTE5",198,0)
 .;del piece 17 from case record
"RTN","RARTE5",199,0)
 .S $P(^RADPT(RADFN,"DT",RADTI,"P",RACNI,0),"^",17)="" K DA,X
"RTN","RARTE5",200,0)
 .;
"RTN","RARTE5",201,0)
 .; Del report ptr from batch and distribution files
"RTN","RARTE5",202,0)
 .D UPDTPNT^RAUTL9(IEN74)
"RTN","RARTE5",203,0)
 .;
"RTN","RARTE5",204,0)
 .; Del entry from Report file
"RTN","RARTE5",205,0)
 .S DA=IEN74,DIK="^RARPT(" D ^DIK
"RTN","RARTE5",206,0)
 .S RATXT(1)=" "
"RTN","RARTE5",207,0)
 .S RATXT(2)="   Outside canned report not complete.  Must Delete......deletion complete!"
"RTN","RARTE5",208,0)
 .S RATXT(3)=$C(7) D MES^XPDUTL(.RATXT)
"RTN","RARTE5",209,0)
 .; also delete any diagnostic codes from case record
"RTN","RARTE5",210,0)
 .I RAPRTSET D DELDXPRT ;del DXs from printset cases
"RTN","RARTE5",211,0)
 .I 'RAPRTSET D DELDX ;del DXs from standalone case
"RTN","RARTE5",212,0)
 .Q
"RTN","RARTE5",213,0)
 Q 0
"RTN","RARTE5",214,0)
ERPT ; Edit report text, impression, and enter/edit diagnostic codes
"RTN","RARTE5",215,0)
 ;remove lock case commands here since case is still locked
"RTN","RARTE5",216,0)
 S $P(RATXT,"+",52)=""
"RTN","RARTE5",217,0)
 W !!?5,RATXT,!?8,"Required:  REPORT TEXT and/or IMPRESSION TEXT",!?5,RATXT
"RTN","RARTE5",218,0)
 S RAXIT=0 ; here, =1 means user "^" out
"RTN","RARTE5",219,0)
 S DA=RARPT,DIE="^RARPT("
"RTN","RARTE5",220,0)
 S DR="200;I X=""^"" S Y=""@8"";300;I X'=""^"" S Y=""@9"";@8;S RAXIT=1;@9"
"RTN","RARTE5",221,0)
 D ^DIE
"RTN","RARTE5",222,0)
 ; subseq edit -- Report Text and Impression Text cannot both be empty
"RTN","RARTE5",223,0)
 I 'RAFIRST,'$O(^RARPT(RARPT,"I",0)),'$O(^RARPT(RARPT,"R",0)) G ERPT
"RTN","RARTE5",224,0)
 ; dont quit on "^" if mammography study
"RTN","RARTE5",225,0)
 D CKREQ^RABIRAD ;check if BIRADS diag is required
"RTN","RARTE5",226,0)
 I RAXIT=1,'RABIREQ Q
"RTN","RARTE5",227,0)
DIAG ; Diagnostic codes
"RTN","RARTE5",228,0)
 ; (code taken from routine RARTE1)
"RTN","RARTE5",229,0)
 S RAIMGTYI=$P($G(^RADPT(RADFN,"DT",RADTI,0)),U,2),RAIMGTYJ=$P($G(^RA(79.2,+RAIMGTYI,0)),U)
"RTN","RARTE5",230,0)
 S X=+$O(^RA(72,"AA",RAIMGTYJ,9,0)),DA(2)=RADFN,DA(1)=RADTI,DA=RACNI,DIE="^RADPT("_DA(2)_",""DT"","_DA(1)_",""P""," K RAIMGTYI,RAIMGTYJ
"RTN","RARTE5",231,0)
 ; ask Prim. Diag, required if site require diag, don't ck abnormal here
"RTN","RARTE5",232,0)
 S DR=13_$S('$D(^RA(72,X,.1)):"",$P(^(.1),"^",5)'="Y":"",1:"R")
"RTN","RARTE5",233,0)
 ; allow user to "^" exit
"RTN","RARTE5",234,0)
 D ^DIE K DA,DE,DQ,DIE,DR
"RTN","RARTE5",235,0)
 I ($P(^RADPT(RADFN,"DT",RADTI,"P",RACNI,0),U,13)="")!($D(Y)) S RAXIT=0 G PACS
"RTN","RARTE5",236,0)
 S DR="50///"_RACN
"RTN","RARTE5",237,0)
 S DR(2,70.03)=13.1
"RTN","RARTE5",238,0)
 S DR(3,70.14)=.01 ; don't ck abnormal here
"RTN","RARTE5",239,0)
 S DA(1)=RADFN,DA=RADTI,DIE="^RADPT("_DA(1)_",""DT"","
"RTN","RARTE5",240,0)
 D ^DIE K DA,DE,DQ,DIE,DR
"RTN","RARTE5",241,0)
 I $D(Y) K Y S RAXIT=1 ;$D(Y) means user "^" out
"RTN","RARTE5",242,0)
PACS ; do not broadcast ORU message at this point
"RTN","RARTE5",243,0)
 ;
"RTN","RARTE5",244,0)
 ; if BIRADS required, ck if BIRADS entered, if not, go back to ask diag
"RTN","RARTE5",245,0)
 I RABIREQ D CKDATA^RABIRAD I 'RABIDAT I $$ASK^RABIRAD G DIAG
"RTN","RARTE5",246,0)
 ; move WV outside of this in case rpt is deleted due insufficient data
"RTN","RARTE5",247,0)
 Q
"RTN","RARTE5",248,0)
 ;
"RTN","RARTE5",249,0)
HLXMSG ; set up RASSSX() of VR subscribers to exclude from ORM msg broadcast
"RTN","RARTE5",250,0)
 N RA,XX
"RTN","RARTE5",251,0)
 ; q if there are no HL applications that use the 4 RA HL7 protocols
"RTN","RARTE5",252,0)
 Q:'$$GETAP^RAHLRS1(.XX)
"RTN","RARTE5",253,0)
 S RA=$NA(XX)
"RTN","RARTE5",254,0)
 F  S RA=$Q(@RA) Q:RA=""  I RA'["RA-TALK",(RA'["RA-PSCRIBE"),(RA'["RA-SCIMAGE"),(RA'["RA-RADWHERE") S RASSS(@RA)=""
"RTN","RARTE5",255,0)
 ; RASSS(ien #771)
"RTN","RARTE5",256,0)
 ; RASSSX(ien #101 driver, ien #101 subscriber)=".01 value of driver"
"RTN","RARTE5",257,0)
 D:$D(RASSS)>1 GETSUB^RAHLRS1(.RASSS,.RASSSX)
"RTN","RARTE5",258,0)
 Q
"RTN","RARTE5",259,0)
DELDX ; del any Prim. and Sec. DXs from standalone case
"RTN","RARTE5",260,0)
 S RAFDA(70.03,RACNI_","_RADTI_","_RADFN_",",13)="@" ;Prim DX
"RTN","RARTE5",261,0)
 D FILE^DIE("","RAFDA")
"RTN","RARTE5",262,0)
 K RAFDA
"RTN","RARTE5",263,0)
 D KILSEC^RARTE7(70.14,RACNI)
"RTN","RARTE5",264,0)
 Q
"RTN","RARTE5",265,0)
DELDXPRT ;del any Prim. and Sec. DXs from all cases in printset
"RTN","RARTE5",266,0)
 S RA1=0
"RTN","RARTE5",267,0)
 F  S RA1=$O(RAMEMARR(RA1)) Q:RA1=""  D
"RTN","RARTE5",268,0)
 .S RAFDA(70.03,RA1_","_RADTI_","_RADFN_",",13)="@" ;Prim DX
"RTN","RARTE5",269,0)
 .D FILE^DIE("","RAFDA")
"RTN","RARTE5",270,0)
 .K RAFDA
"RTN","RARTE5",271,0)
 .D KILSEC^RARTE7(70.14,RA1)
"RTN","RARTE5",272,0)
 .Q
"RTN","RARTE5",273,0)
 Q
"RTN","RARTE5",274,0)
INTRO ;
"RTN","RARTE5",275,0)
 ;;+--------------------------------------------------------+
"RTN","RARTE5",276,0)
 ;;|                                                        |
"RTN","RARTE5",277,0)
 ;;|  This option is for entering canned text for           |
"RTN","RARTE5",278,0)
 ;;|  outside work:  interpreted report done outside,       |
"RTN","RARTE5",279,0)
 ;;|  and images made outside this facility.                |
"RTN","RARTE5",280,0)
 ;;|                                                        |
"RTN","RARTE5",281,0)
 ;;|  For a printset, the canned text must apply to all     |
"RTN","RARTE5",282,0)
 ;;|  cases within the printset.                            |
"RTN","RARTE5",283,0)
 ;;|                                                        |
"RTN","RARTE5",284,0)
 ;;+--------------------------------------------------------+
"RTN","RASETU")
0^9^B6507799^B4778388
"RTN","RASETU",1,0)
RASETU ;HISC/DAD-Determine Order Status for an Exam Set ;11 Apr 2018 12:07 PM
"RTN","RASETU",2,0)
 ;;5.0;Radiology/Nuclear Medicine;**15,124**;Mar 16, 1998;Build 4
"RTN","RASETU",3,0)
 ;
"RTN","RASETU",4,0)
 ;Routine reads through all cases generated from a single order
"RTN","RASETU",5,0)
 ;to gather information about the case statuses needed to determine
"RTN","RASETU",6,0)
 ;what status the order should be updated to
"RTN","RASETU",7,0)
 ;Input:   RADFN=Patient ien     <->     RAOIFN=order IEN
"RTN","RASETU",8,0)
 ;Output:  RASTATUS array with status info about exam set passed back
"RTN","RASETU",9,0)
 ;         format: min status_"^"_max status_"^"_$S(All_Statuses=0:1,1:0)
"RTN","RASETU",10,0)
EN1(RAOIFN,RADFN) ;
"RTN","RASETU",11,0)
 Q:'($D(^RADPT("AO",RAOIFN,RADFN))\10) "^^"
"RTN","RASETU",12,0)
 ; save current RACNI so we'd know which exam to skip
"RTN","RASETU",13,0)
 ; in the loop below if Exam Deletion is being processed, because
"RTN","RASETU",14,0)
 ; 1. the exam node hasn't been killed off yet,
"RTN","RASETU",15,0)
 ; 2. the exam node may have a non-cancelled exam status,
"RTN","RASETU",16,0)
 ;    which would throw off the loop calculation below
"RTN","RASETU",17,0)
 ;
"RTN","RASETU",18,0)
 ; if called from the RA CANCEL option skip the exam
"RTN","RASETU",19,0)
 ; we intend to cancel b/c at this time it does not
"RTN","RASETU",20,0)
 ; have a exam status value of cancelled. The exam
"RTN","RASETU",21,0)
 ; will be updated to a cancelled exam status just
"RTN","RASETU",22,0)
 ; before the option has completed  (patch 124)
"RTN","RASETU",23,0)
 ;
"RTN","RASETU",24,0)
 ;
"RTN","RASETU",25,0)
 N RACNISAV S RACNISAV=$G(RACNI)
"RTN","RASETU",26,0)
 ;
"RTN","RASETU",27,0)
 N RACNI,RADTI,RAORDER,RAPROC,RASTATUS
"RTN","RASETU",28,0)
 S RAORDER=$G(^RAO(75.1,RAOIFN,0))
"RTN","RASETU",29,0)
 I RAORDER="" Q "^^"
"RTN","RASETU",30,0)
 S RAPROC=+$P(RAORDER,U,2) ;             Procedure IEN
"RTN","RASETU",31,0)
 S RASTATUS("ORD")=$P(RAORDER,U,5) ;     Initial status
"RTN","RASETU",32,0)
 S RASTATUS("MAX")=-1 ;                  Largest status found
"RTN","RASETU",33,0)
 S RASTATUS("MIN")=10 ;                  Smallest non-zero status found
"RTN","RASETU",34,0)
 S RASTATUS("NUL")=1 ;                   $S(All_Statuses=0:1,1:0)
"RTN","RASETU",35,0)
 ;
"RTN","RASETU",36,0)
 S RADTI=0
"RTN","RASETU",37,0)
 F  S RADTI=$O(^RADPT("AO",RAOIFN,RADFN,RADTI)) Q:RADTI'>0  D
"RTN","RASETU",38,0)
 . S RACNI=0
"RTN","RASETU",39,0)
 . F  S RACNI=$O(^RADPT("AO",RAOIFN,RADFN,RADTI,RACNI)) Q:RACNI'>0  D
"RTN","RASETU",40,0)
 .. I $D(RADELFLG),RACNISAV=RACNI Q  ;skip if Exam Deletion
"RTN","RASETU",41,0)
 .. ;the variable RACAN124 is set in the ENTRY ACTION field of the [RA
"RTN","RASETU",42,0)
 .. ;CANCEL] record in the OPTION file (killed in EXIT ACTION field)
"RTN","RASETU",43,0)
 .. I $D(RACAN124),RACNISAV=RACNI Q  ;p124
"RTN","RASETU",44,0)
 .. S RASTATUS=+$P($G(^RADPT(RADFN,"DT",RADTI,"P",RACNI,0)),U,3)
"RTN","RASETU",45,0)
 .. S RASTATUS(0)=$P($G(^RA(72,RASTATUS,0)),U,3) Q:RASTATUS(0)=""
"RTN","RASETU",46,0)
 .. I RASTATUS(0)>RASTATUS("MAX") S RASTATUS("MAX")=RASTATUS(0)
"RTN","RASETU",47,0)
 .. I (RASTATUS(0)),(RASTATUS(0)<RASTATUS("MIN")) D
"RTN","RASETU",48,0)
 ... S RASTATUS("MIN")=RASTATUS(0)
"RTN","RASETU",49,0)
 ... Q
"RTN","RASETU",50,0)
 .. I RASTATUS(0)>0 S RASTATUS("NUL")=0
"RTN","RASETU",51,0)
 .. Q
"RTN","RASETU",52,0)
 . Q
"RTN","RASETU",53,0)
 Q RASTATUS("MIN")_"^"_RASTATUS("MAX")_"^"_RASTATUS("NUL")
"RTN","RASETU",54,0)
 ;
"RTN","RASETU",55,0)
PARNT(RAOIFN,RADFN) ; Based on the patient and the order number, determine
"RTN","RASETU",56,0)
 ;                 if the exams are part of an exam set.
"RTN","RASETU",57,0)
 ;  Input: 'RAOIFN' -> Order #            'RADFN' -> Patient ien
"RTN","RASETU",58,0)
 ; Output: $S(Exam Set:1,1:0)
"RTN","RASETU",59,0)
 ;
"RTN","RASETU",60,0)
 Q:'($D(^RADPT("AO",RAOIFN,RADFN))\10) 0
"RTN","RASETU",61,0)
 N RADTI,RARXM
"RTN","RASETU",62,0)
 S RADTI=+$O(^RADPT("AO",RAOIFN,RADFN,0)) Q:'RADTI 0
"RTN","RASETU",63,0)
 S RARXM(0)=$G(^RADPT(RADFN,"DT",RADTI,0))
"RTN","RASETU",64,0)
 Q +$P(RARXM(0),"^",5)
"UP",70,70.03,-2)
70^DT
"UP",70,70.03,-1)
70.02^P
"UP",70,70.03,0)
70.03
"VER")
8.0^22.2
"^DD",70,70.03,3,0)
EXAM STATUS^R*P72'X^RA(72,^0;3^S DIC("S")="N RAIMGTY S RAIMGTY=+$P($G(^RADPT(DA(2),""DT"",DA(1),0)),U,2) I $P(^RA(72,+Y,0),U,7)=RAIMGTY" D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X D ^RASTREQ:'$D(RAOVER)&($D(X))
"^DD",70,70.03,3,.1)
STATUS OF THIS EXAM
"^DD",70,70.03,3,1,0)
^.1^^0
"^DD",70,70.03,3,3)
Select the appropriate Exam Status.
"^DD",70,70.03,3,4)
D HELP^RASTREQ
"^DD",70,70.03,3,10)
SYSTEM DETERMINED
"^DD",70,70.03,3,12)
Choose only those Exam statuses that have the same Imaging Type of our Registered Exam.
"^DD",70,70.03,3,12.1)
S DIC("S")="N RAIMGTY S RAIMGTY=+$P($G(^RADPT(DA(2),""DT"",DA(1),0)),U,2) I $P(^RA(72,+Y,0),U,7)=RAIMGTY"
"^DD",70,70.03,3,21,0)
^.001^4^4^3180608^^^^
"^DD",70,70.03,3,21,1,0)
This field points to the 'EXAMINATION STATUS' file (#72) to indicate the
"^DD",70,70.03,3,21,2,0)
current status of this Imaging exam.  The status is determined and updated
"^DD",70,70.03,3,21,3,0)
by the system according to the information entered during the various data
"^DD",70,70.03,3,21,4,0)
entry processes.
"^DD",70,70.03,3,23,0)
^^16^16^3180608^
"^DD",70,70.03,3,23,1,0)
'EXAM STATUS' has been updated with the release of RA*5.0*124. Prior to 
"^DD",70,70.03,3,23,2,0)
patch 124 the "AS" and "AE" cross references (xrefs) were traditional
"^DD",70,70.03,3,23,3,0)
style xrefs with M code in their specific SET and KILL logic. The "AS"
"^DD",70,70.03,3,23,4,0)
xref utilized the 9.2 (overflow node) to execute M code.
"^DD",70,70.03,3,23,5,0)
 
"^DD",70,70.03,3,23,6,0)
With the release of patch 124, the traditional xref structure for the "AS"
"^DD",70,70.03,3,23,7,0)
& "AE" has been replaced with 'new style' xref structure.
"^DD",70,70.03,3,23,8,0)
 
"^DD",70,70.03,3,23,9,0)
 
"^DD",70,70.03,3,23,10,0)
Note: The first numeric subscript of the "AE" xref is the CASE NUMBER
"^DD",70,70.03,3,23,11,0)
(70.03;.01). Since the .01 field cannot be changed because of business
"^DD",70,70.03,3,23,12,0)
rules, the "AE" xref does not have set/kill logic in the CASE NUMBER
"^DD",70,70.03,3,23,13,0)
field.
"^DD",70,70.03,3,23,14,0)
   
"^DD",70,70.03,3,23,15,0)
The first numeric subscript of the "AS" xref is the EXAMINATION STATUS
"^DD",70,70.03,3,23,16,0)
IEN (70.03;3).
"^DD",70,70.03,3,"DT")
3180412
"BLD",9325,6)
^134
**END**
**END**

