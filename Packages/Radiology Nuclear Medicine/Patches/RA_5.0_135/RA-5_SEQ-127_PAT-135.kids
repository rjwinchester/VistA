Released RA*5*135 SEQ #127
Extracted from mail message
**KIDS**:RA*5.0*135^

**INSTALL NAME**
RA*5.0*135
"BLD",10065,0)
RA*5.0*135^RADIOLOGY/NUCLEAR MEDICINE^0^3180329^y
"BLD",10065,1,0)
^^3^3^3171005^
"BLD",10065,1,1,0)
Patch one hundred and thirty-five for the VistA Radiology/Nuclear Medicine
"BLD",10065,1,2,0)
5.0 application. Please review FORUM's Patch Module description and 
"BLD",10065,1,3,0)
installation instructions for RA*5.0*135 before installing this patch.
"BLD",10065,4,0)
^9.64PA^75.1^1
"BLD",10065,4,75.1,0)
75.1
"BLD",10065,4,75.1,2,0)
^9.641^75.1^1
"BLD",10065,4,75.1,2,75.1,0)
RAD/NUC MED ORDERS  (File-top level)
"BLD",10065,4,75.1,2,75.1,1,0)
^9.6411^21^1
"BLD",10065,4,75.1,2,75.1,1,21,0)
DATE DESIRED (Not guaranteed)
"BLD",10065,4,75.1,222)
y^n^p^^^^n^^n
"BLD",10065,4,75.1,223)
I ($D(^RAO(75.1,"BDD"))\10)=0
"BLD",10065,4,75.1,224)

"BLD",10065,4,"APDD",75.1,75.1)

"BLD",10065,4,"APDD",75.1,75.1,21)

"BLD",10065,4,"B",75.1,75.1)

"BLD",10065,6.3)
7
"BLD",10065,"INI")
RAIPR135
"BLD",10065,"INID")
^n^n
"BLD",10065,"INIT")
RAIPS135
"BLD",10065,"KRN",0)
^9.67PA^779.2^20
"BLD",10065,"KRN",.4,0)
.4
"BLD",10065,"KRN",.401,0)
.401
"BLD",10065,"KRN",.402,0)
.402
"BLD",10065,"KRN",.403,0)
.403
"BLD",10065,"KRN",.5,0)
.5
"BLD",10065,"KRN",.84,0)
.84
"BLD",10065,"KRN",3.6,0)
3.6
"BLD",10065,"KRN",3.8,0)
3.8
"BLD",10065,"KRN",9.2,0)
9.2
"BLD",10065,"KRN",9.8,0)
9.8
"BLD",10065,"KRN",9.8,"NM",0)
^9.68A^4^4
"BLD",10065,"KRN",9.8,"NM",1,0)
RAUTODC^^0^B64769813
"BLD",10065,"KRN",9.8,"NM",2,0)
RABUL^^0^B5711827
"BLD",10065,"KRN",9.8,"NM",3,0)
RAIPS135^^0^B13391098
"BLD",10065,"KRN",9.8,"NM",4,0)
RAIPR135^^0^B1362436
"BLD",10065,"KRN",9.8,"NM","B","RABUL",2)

"BLD",10065,"KRN",9.8,"NM","B","RAIPR135",4)

"BLD",10065,"KRN",9.8,"NM","B","RAIPS135",3)

"BLD",10065,"KRN",9.8,"NM","B","RAUTODC",1)

"BLD",10065,"KRN",19,0)
19
"BLD",10065,"KRN",19,"NM",0)
^9.68A^1^1
"BLD",10065,"KRN",19,"NM",1,0)
RA AUTO DISCONTINUE PROCESS^^0
"BLD",10065,"KRN",19,"NM","B","RA AUTO DISCONTINUE PROCESS",1)

"BLD",10065,"KRN",19.1,0)
19.1
"BLD",10065,"KRN",101,0)
101
"BLD",10065,"KRN",409.61,0)
409.61
"BLD",10065,"KRN",771,0)
771
"BLD",10065,"KRN",779.2,0)
779.2
"BLD",10065,"KRN",870,0)
870
"BLD",10065,"KRN",8989.51,0)
8989.51
"BLD",10065,"KRN",8989.52,0)
8989.52
"BLD",10065,"KRN",8994,0)
8994
"BLD",10065,"KRN","B",.4,.4)

"BLD",10065,"KRN","B",.401,.401)

"BLD",10065,"KRN","B",.402,.402)

"BLD",10065,"KRN","B",.403,.403)

"BLD",10065,"KRN","B",.5,.5)

"BLD",10065,"KRN","B",.84,.84)

"BLD",10065,"KRN","B",3.6,3.6)

"BLD",10065,"KRN","B",3.8,3.8)

"BLD",10065,"KRN","B",9.2,9.2)

"BLD",10065,"KRN","B",9.8,9.8)

"BLD",10065,"KRN","B",19,19)

"BLD",10065,"KRN","B",19.1,19.1)

"BLD",10065,"KRN","B",101,101)

"BLD",10065,"KRN","B",409.61,409.61)

"BLD",10065,"KRN","B",771,771)

"BLD",10065,"KRN","B",779.2,779.2)

"BLD",10065,"KRN","B",870,870)

"BLD",10065,"KRN","B",8989.51,8989.51)

"BLD",10065,"KRN","B",8989.52,8989.52)

"BLD",10065,"KRN","B",8994,8994)

"BLD",10065,"QUES",0)
^9.62^^
"BLD",10065,"REQB",0)
^9.611^4^2
"BLD",10065,"REQB",3,0)
RA*5.0*75^2
"BLD",10065,"REQB",4,0)
RA*5.0*130^2
"BLD",10065,"REQB","B","RA*5.0*130",4)

"BLD",10065,"REQB","B","RA*5.0*75",3)

"FIA",75.1)
RAD/NUC MED ORDERS
"FIA",75.1,0)
^RAO(75.1,
"FIA",75.1,0,0)
75.1IP
"FIA",75.1,0,1)
y^n^p^^^^n^^n
"FIA",75.1,0,10)
I ($D(^RAO(75.1,"BDD"))\10)=0
"FIA",75.1,0,11)

"FIA",75.1,0,"RLRO")

"FIA",75.1,0,"VR")
5.0^RA
"FIA",75.1,75.1)
1
"FIA",75.1,75.1,21)

"INI")
RAIPR135
"INIT")
RAIPS135
"IX",75.1,75.1,"AP",0)
75.1^AP^Used to screen duplicate requests at time of entry.^R^^R^IR^I^75.1^^^^^S
"IX",75.1,75.1,"AP",.1,0)
^^1^1^3160823^
"IX",75.1,75.1,"AP",.1,1,0)
Used to screen duplicate requests at time of entry.
"IX",75.1,75.1,"AP",1)
S ^RAO(75.1,"AP",$E(X(1),1,30),$E(X(2),1,30),$E(X(3),1,14),DA)=""
"IX",75.1,75.1,"AP",2)
K ^RAO(75.1,"AP",$E(X(1),1,30),$E(X(2),1,30),$E(X(3),1,14),DA)
"IX",75.1,75.1,"AP",2.5)
K ^RAO(75.1,"AP")
"IX",75.1,75.1,"AP",11.1,0)
^.114IA^3^3
"IX",75.1,75.1,"AP",11.1,1,0)
1^F^75.1^.01^30^1^F
"IX",75.1,75.1,"AP",11.1,1,3)

"IX",75.1,75.1,"AP",11.1,2,0)
2^F^75.1^2^30^2^F
"IX",75.1,75.1,"AP",11.1,2,3)

"IX",75.1,75.1,"AP",11.1,3,0)
3^F^75.1^21^14^3^F
"IX",75.1,75.1,"AP",11.1,3,2)
S X=9999999.9999-X
"IX",75.1,75.1,"AP",11.1,3,3)

"IX",75.1,75.1,"BDD",0)
75.1^BDD^A cross reference on the DATE DESIRED (Not guaranteed) fld.^R^^F^IR^I^75.1^^^^^LS
"IX",75.1,75.1,"BDD",.1,0)
^^8^8^3170607^
"IX",75.1,75.1,"BDD",.1,1,0)
A cross reference has been created on the DATE DESIRED (Not guaranteed)
"IX",75.1,75.1,"BDD",.1,2,0)
field which will allow the VistA RIS application to check radiology orders
"IX",75.1,75.1,"BDD",.1,3,0)
for inactivity.
"IX",75.1,75.1,"BDD",.1,4,0)
 
"IX",75.1,75.1,"BDD",.1,5,0)
Inactivity on orders falling under existing business rules will have the 
"IX",75.1,75.1,"BDD",.1,6,0)
REQUEST STATUS of that order changed to 'Discontinued'.
"IX",75.1,75.1,"BDD",.1,7,0)
 
"IX",75.1,75.1,"BDD",.1,8,0)
This cross reference was introduced in RA*5.0*135.
"IX",75.1,75.1,"BDD",1)
S ^RAO(75.1,"BDD",$E(X,1,30),DA)=""
"IX",75.1,75.1,"BDD",2)
K ^RAO(75.1,"BDD",$E(X,1,30),DA)
"IX",75.1,75.1,"BDD",2.5)
K ^RAO(75.1,"BDD")
"IX",75.1,75.1,"BDD",11.1,0)
^.114IA^1^1
"IX",75.1,75.1,"BDD",11.1,1,0)
1^F^75.1^21^30^1^F
"IX",75.1,75.1,"BDD","NOREINDEX")
0
"KRN",19,14036,-1)
0^1
"KRN",19,14036,0)
RA AUTO DISCONTINUE PROCESS^Discontinue orders in radiology and update CPRS.^^R^^^^^^^^RADIOLOGY/NUCLEAR MEDICINE^^
"KRN",19,14036,1,0)
^^7^7^3171018^
"KRN",19,14036,1,1,0)
This option, exported with RA*5.0*135, will discontinue radiology orders 
"KRN",19,14036,1,2,0)
within a specified timeframe. All the orders discontinued in the 
"KRN",19,14036,1,3,0)
RADIOLOGY/NUCLEAR MEDICINE (RIS) application will be discontinued in the 
"KRN",19,14036,1,4,0)
COMPUTERIZED PATIENT RECORD SYSTEM (CPRS) application.
"KRN",19,14036,1,5,0)
 
"KRN",19,14036,1,6,0)
Please refer to the Forum Patch Module for more information on RIS patch 
"KRN",19,14036,1,7,0)
RA*5.0*135.
"KRN",19,14036,20)

"KRN",19,14036,25)
EN1^RAUTODC
"KRN",19,14036,"U")
DISCONTINUE ORDERS IN RADIOLOG
"MBREQ")
0
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"PKG",18,-1)
1^1
"PKG",18,0)
RADIOLOGY/NUCLEAR MEDICINE^RA^REGISTERS PATIENTS,RECORDS EXAMS,PROFILES,AMIS REPORTS
"PKG",18,20,0)
^9.402P^^
"PKG",18,22,0)
^9.49I^1^1
"PKG",18,22,1,0)
5.0^3051109^2980407^50
"PKG",18,22,1,"PAH",1,0)
135^3180329
"PKG",18,22,1,"PAH",1,1,0)
^^3^3^3180329
"PKG",18,22,1,"PAH",1,1,1,0)
Patch one hundred and thirty-five for the VistA Radiology/Nuclear Medicine
"PKG",18,22,1,"PAH",1,1,2,0)
5.0 application. Please review FORUM's Patch Module description and 
"PKG",18,22,1,"PAH",1,1,3,0)
installation instructions for RA*5.0*135 before installing this patch.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
4
"RTN","RABUL")
0^2^B5711827^B5625174
"RTN","RABUL",1,0)
RABUL ;HISC/FPT,GJC AISC/DMK-Generate 'RAD/NUC MED REQUEST CANCELLED' or 'RAD/NUC MED REQUEST HELD' Bulletin ;16 Jun 2017 2:27 PM
"RTN","RABUL",2,0)
 ;;5.0;Radiology/Nuclear Medicine;**2,15,75,135**;Mar 16, 1998;Build 7
"RTN","RABUL",3,0)
 ; ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
"RTN","RABUL",4,0)
 ; The variables DA and RAOSTS must be defined.
"RTN","RABUL",5,0)
 ; The variable DA must be greater than 0, and RAOSTS must
"RTN","RABUL",6,0)
 ; equal 1 (cancelled) or 3 (held) for the RAD/NUC MED REQUEST CANCELLED
"RTN","RABUL",7,0)
 ; or the  RAD/NUC MED REQUEST HELD bulletin to execute.
"RTN","RABUL",8,0)
 ; Called from: ^DD(75.1,5,0) fifth piece
"RTN","RABUL",9,0)
 ; ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
"RTN","RABUL",10,0)
 ;                     ***** Variable List *****
"RTN","RABUL",11,0)
 ; 'RADFN' -> IEN of the patient in the PATIENT file (2)
"RTN","RABUL",12,0)
 ; 'RAFN1' -> internal format of a FM date/time data element
"RTN","RABUL",13,0)
 ; 'RAFN2' -> FM data definition for RAFN1, used in XTERNAL^RAUTL5
"RTN","RABUL",14,0)
 ; 'Z'     -> Zero node of the RADIOLOGY/NUCLEAR MEDICINE ORDERS
"RTN","RABUL",15,0)
 ;            file (75.1)
"RTN","RABUL",16,0)
 ; Format: Data to be fired;local var name;XMB array representation
"RTN","RABUL",17,0)
 ; Patient ; RANAME ; XMB(1)      <---> Req. Physician ; RARPHY ; XMB(5)
"RTN","RABUL",18,0)
 ; Patient SSN ; RASSN ; XMB(2)   <---> Req. Location ; RARLOC ; XMB(6)
"RTN","RABUL",19,0)
 ; Procedure ; RAPNAM ; XMB(3)    <---> Reason ; RARCR ; XMB(7)
"RTN","RABUL",20,0)
 ; Date Desired ; RADTDS ; XMB(4) <---> Current User ; RAUSER ; XMB(8)
"RTN","RABUL",21,0)
 ;
"RTN","RABUL",22,0)
EN(RAX) ; Pass in the request status (RAX)
"RTN","RABUL",23,0)
 ; also called during request status edit.
"RTN","RABUL",24,0)
 Q:+$G(DA)'>0  Q:$G(RA135TIME)=1  ;RA5P135
"RTN","RABUL",25,0)
 Q:+$G(RAOSTS)'=1&(+$G(RAOSTS)'=3)
"RTN","RABUL",26,0)
 N RADFN,RADTDS,RAFN1,RAFN2,RASSN,RAUSER,RAXMB,Z
"RTN","RABUL",27,0)
 S RAXMB="RAD/NUC MED REQUEST",Z=$G(^RAO(75.1,DA,0))
"RTN","RABUL",28,0)
 S (RADFN,RANAME)=+$P(Z,U)
"RTN","RABUL",29,0)
 S RANAME=$S($D(^DPT(RANAME,0)):$P(^(0),U),1:"Unknown")
"RTN","RABUL",30,0)
 S RASSN=$$SSN^RAUTL(),RAPNAM=+$P(Z,U,2)
"RTN","RABUL",31,0)
 S RAPNAM=$S($D(^RAMIS(71,RAPNAM,0)):$P(^(0),U),1:"Unknown")
"RTN","RABUL",32,0)
 S RARLOC=+$P(Z,U,22)
"RTN","RABUL",33,0)
 S RARLOC=$S($D(^SC(RARLOC,0)):$P(^(0),U),1:"Unknown")
"RTN","RABUL",34,0)
 S RAFN1=$P(Z,U,21),RAFN2=$P($G(^DD(75.1,21,0)),U,2)
"RTN","RABUL",35,0)
 S RADTDS=$$XTERNAL^RAUTL5(RAFN1,RAFN2)
"RTN","RABUL",36,0)
 S:RADTDS']"" RADTDS="Unknown" S RARPHY=+$P(Z,U,14)
"RTN","RABUL",37,0)
 S RARPHY=$S($D(^VA(200,RARPHY,0)):$P(^(0),U),1:"Unknown")
"RTN","RABUL",38,0)
 S RARCR=+$P(Z,U,10)
"RTN","RABUL",39,0)
 S RARCR=$S($D(^RA(75.2,RARCR,0)):$P(^(0),U),1:"Unknown")
"RTN","RABUL",40,0)
 S:RARCR="Unknown" RARCR=$S($P(Z,U,27)]"":$P(Z,U,27),1:"Unknown")
"RTN","RABUL",41,0)
 S RAUSER=$S($D(^VA(200,DUZ,0)):$P(^(0),U),1:"Unknown")
"RTN","RABUL",42,0)
 ; --- P75 define the REASON FOR STUDY ---
"RTN","RABUL",43,0)
 S RASTYREA=$P($G(^RAO(75.1,DA,.1)),U)
"RTN","RABUL",44,0)
 S:RASTYREA="" RASTYREA="Unknown" ;req'd if missing error
"RTN","RABUL",45,0)
 ;
"RTN","RABUL",46,0)
 S XMB(1)=RANAME,XMB(2)=RASSN,XMB(3)=RAPNAM,XMB(4)=RASTYREA,XMB(5)=RADTDS
"RTN","RABUL",47,0)
 S XMB(6)=RARPHY,XMB(7)=RARLOC,XMB(8)=RARCR,XMB(9)=RAUSER
"RTN","RABUL",48,0)
 S XMB=RAXMB_$S(RAX=1:" CANCELLED",1:" HELD")
"RTN","RABUL",49,0)
 D ^XMB:$D(^XMB(3.6,"B",XMB))
"RTN","RABUL",50,0)
 K RANAME,RAPNAM,RARLOC,RARPHY,RARCR,RASTYREA,XMB,XMB0,XMC0,XMDT,XMM,XMMG
"RTN","RABUL",51,0)
 Q
"RTN","RABUL",52,0)
OE3(DA) ; Trigger the Rad/Nuc Med Request Cancelled bulletin when
"RTN","RABUL",53,0)
 ; the order is discontinued through CPRS (frontdoor).
"RTN","RABUL",54,0)
 ; Input: DA-ien of the Rad/Nuc Med order record
"RTN","RABUL",55,0)
 S RAOSTS=$P($G(^RAO(75.1,DA,0)),"^",5)
"RTN","RABUL",56,0)
 I RAOSTS'=1 K RAOSTS Q  ; status must be discontinued
"RTN","RABUL",57,0)
 D EN(RAOSTS) K RAOSTS
"RTN","RABUL",58,0)
 Q
"RTN","RAIPR135")
0^4^B1362436^n/a
"RTN","RAIPR135",1,0)
RAIPR135 ;HISC/GJC pre-install routine ;26 Jan 2018 12:14 PM
"RTN","RAIPR135",2,0)
 ;;5.0;Radiology/Nuclear Medicine;**135**;Mar 16, 1998;Build 7
"RTN","RAIPR135",3,0)
 ;
"RTN","RAIPR135",4,0)
 ;Routine              IA          Type
"RTN","RAIPR135",5,0)
 ;-------------------------------------
"RTN","RAIPR135",6,0)
 ; UPDATE^DIE          2053        (S)
"RTN","RAIPR135",7,0)
 ;
"RTN","RAIPR135",8,0)
 N RACHX1,RACHX2
"RTN","RAIPR135",9,0)
 S RACHX1=$$NEWCP^XPDUTL("PRE1","EN1^RAIPR135")
"RTN","RAIPR135",10,0)
 Q
"RTN","RAIPR135",11,0)
 ;
"RTN","RAIPR135",12,0)
EN1 ;Add "OBSOLETE ORDER-P135 (automated)" to the 'RAD/NUC MED REASON'
"RTN","RAIPR135",13,0)
 ;   #75.2 file.
"RTN","RAIPR135",14,0)
 ;
"RTN","RAIPR135",15,0)
 N RAERR,RAFDA,RAIEN,RAR,RATXT,RAX
"RTN","RAIPR135",16,0)
 S RAX="OBSOLETE ORDER-P135 (automated)"
"RTN","RAIPR135",17,0)
 S RAR=$NA(RAFDA(75.2,"?+1,")) ;RAFDA root
"RTN","RAIPR135",18,0)
 ;.01 - NAME
"RTN","RAIPR135",19,0)
 S @RAR@(.01)=RAX
"RTN","RAIPR135",20,0)
 ;field #: 5 - NATIONAL
"RTN","RAIPR135",21,0)
 S @RAR@(5)="Y"
"RTN","RAIPR135",22,0)
 ;field #: 4 - NATURE OF ORDER ACTIVITY
"RTN","RAIPR135",23,0)
 S @RAR@(4)="i"
"RTN","RAIPR135",24,0)
 ;field #: 2 - TYPE OF REASON
"RTN","RAIPR135",25,0)
 S @RAR@(2)=""
"RTN","RAIPR135",26,0)
 D UPDATE^DIE("E","RAFDA","RAIEN","RAERR")
"RTN","RAIPR135",27,0)
 I $D(RAERR) D
"RTN","RAIPR135",28,0)
 .S RATXT(1)="Error: """_RAX_""" could not be added."
"RTN","RAIPR135",29,0)
 .S RATXT(2)="Contact the developers of RA*5.0*135 to address this issue."
"RTN","RAIPR135",30,0)
 .D BMES^XPDUTL(.RATXT)
"RTN","RAIPR135",31,0)
 .Q
"RTN","RAIPR135",32,0)
 Q
"RTN","RAIPR135",33,0)
 ;
"RTN","RAIPS135")
0^3^B13391098^n/a
"RTN","RAIPS135",1,0)
RAIPS135 ;HISC/GJC post-install routine ;28 Mar 2018 1:59 PM
"RTN","RAIPS135",2,0)
 ;;5.0;Radiology/Nuclear Medicine;**135**;Mar 16, 1998;Build 7
"RTN","RAIPS135",3,0)
 ;
"RTN","RAIPS135",4,0)
 ;Routine              IA          Type
"RTN","RAIPS135",5,0)
 ;-------------------------------------
"RTN","RAIPS135",6,0)
 ; ^%ZTLOAD            10063        (S)
"RTN","RAIPS135",7,0)
 ; $$FIND1^DIC          2051        (S)
"RTN","RAIPS135",8,0)
 ; $$FMADD^XLFDT       10103        (S)
"RTN","RAIPS135",9,0)
 ; $$NOW^XLFDT         10103        (S)
"RTN","RAIPS135",10,0)
 ; $$FMTE^XLFDT        10103        (S)          
"RTN","RAIPS135",11,0)
 ; $$NEWCP^XPDUTL      10141        (S)
"RTN","RAIPS135",12,0)
 ; $$PROD^XUPROD        4440        (S)
"RTN","RAIPS135",13,0)
 ; UPDATE^DIE           2053        (S)
"RTN","RAIPS135",14,0)
 ; D EN^DIEZ           10002        (S) 
"RTN","RAIPS135",15,0)
 ; $$ROUSIZE^DILF       2649        (S)
"RTN","RAIPS135",16,0)
 ; OPTSTAT^XUTMOPT()    1472        (S)
"RTN","RAIPS135",17,0)
 ; ^DIE("AF",           2022        (C)
"RTN","RAIPS135",18,0)
 ; ^DIC(19.2, schedule  6826        (P)
"RTN","RAIPS135",19,0)
 ;            option
"RTN","RAIPS135",20,0)
 ; OPTSTAT^XUTMOPT      1472        (S)
"RTN","RAIPS135",21,0)
 ;
"RTN","RAIPS135",22,0)
 N RACHX1,RACHX2
"RTN","RAIPS135",23,0)
 S RACHX1=$$NEWCP^XPDUTL("POST1","EN1^RAIPS135")
"RTN","RAIPS135",24,0)
 S RACHX2=$$NEWCP^XPDUTL("POST2","EN2^RAIPS135")
"RTN","RAIPS135",25,0)
 S RACHX3=$$NEWCP^XPDUTL("POST3","EN3^RAIPS135")
"RTN","RAIPS135",26,0)
 Q
"RTN","RAIPS135",27,0)
 ;
"RTN","RAIPS135",28,0)
EN1 ;part 1: recompile 75.1 input templates
"RTN","RAIPS135",29,0)
 ;
"RTN","RAIPS135",30,0)
ENDIEZ ;run in the foreground as part of the post-install
"RTN","RAIPS135",31,0)
 ; ^DD(75.1,21,0)="DATE DESIRED (Not guaranteed) 
"RTN","RAIPS135",32,0)
 ; ^DIE("AF",file,field,template_IEN)=""
"RTN","RAIPS135",33,0)
 N DMAX,RADMAX,RAY,X,Y S RAY=0,RADMAX=$$ROUSIZE^DILF()
"RTN","RAIPS135",34,0)
 F  S RAY=$O(^DIE("AF",75.1,21,RAY)) Q:RAY=""  D  ;Y = IEN of compiled template
"RTN","RAIPS135",35,0)
 .S DMAX=RADMAX
"RTN","RAIPS135",36,0)
 .S X=$P(^DIE(RAY,"ROU"),U,2) ;X = compiled template routine name
"RTN","RAIPS135",37,0)
 .S Y=RAY D:X'="" EN^DIEZ
"RTN","RAIPS135",38,0)
 .Q
"RTN","RAIPS135",39,0)
 ;
"RTN","RAIPS135",40,0)
 ; part 2: re-index of the "BDD" 'DATE DESIRED (not guaranteed)' (tasked)
"RTN","RAIPS135",41,0)
 ;
"RTN","RAIPS135",42,0)
 N RATXT,ZTDESC,ZTDTH,ZTIO,ZTRTN S ZTIO=""
"RTN","RAIPS135",43,0)
 S ZTRTN="EN2^RAUTODC",(ZTDESC,RATXT(1))="RA135: re-index of the 'DATE DESIRED (Not guaranteed)' ""BDD"" xref"
"RTN","RAIPS135",44,0)
 ;
"RTN","RAIPS135",45,0)
 S ZTDTH=$H D ^%ZTLOAD S RATXT(2)="Task: "_$S($G(ZTSK)>0:ZTSK,1:"in error")
"RTN","RAIPS135",46,0)
 D BMES^XPDUTL(.RATXT)
"RTN","RAIPS135",47,0)
 Q
"RTN","RAIPS135",48,0)
 ;
"RTN","RAIPS135",49,0)
EN2 ;Schedule option RA AUTO DISCONTINUE PROCESS to discontinue pending, hold & scheduled
"RTN","RAIPS135",50,0)
 ; (check Scheduled D/T) from the beginning of time through May 31st 2015@2359.
"RTN","RAIPS135",51,0)
 ; This option will be run once and be deleted from the OPTION SCHEDULING file.
"RTN","RAIPS135",52,0)
 ; A future RIS patch will delete the RA AUTO DISCONTINUE PROCESS option.
"RTN","RAIPS135",53,0)
 ;
"RTN","RAIPS135",54,0)
 ; Note: do not fire bulletins, do not fire notifications (toggle on/off)
"RTN","RAIPS135",55,0)
 ;
"RTN","RAIPS135",56,0)
 ; if "OBSOLETE ORDER-P135 (automated)" has not been added quit...
"RTN","RAIPS135",57,0)
 N RATXT I $$FIND1^DIC(75.2,"","X","OBSOLETE ORDER-P135 (automated)","B")=0 D  QUIT
"RTN","RAIPS135",58,0)
 .S RATXT(1)="Error: 'OBSOLETE ORDER-P135 (automated)' could not be found."
"RTN","RAIPS135",59,0)
 .S RATXT(2)="Contact the developers of RA*5.0*135 to address this issue."
"RTN","RAIPS135",60,0)
 .D BMES^XPDUTL(.RATXT)
"RTN","RAIPS135",61,0)
 .Q
"RTN","RAIPS135",62,0)
 ;
"RTN","RAIPS135",63,0)
 N DIFROM,RADEV,RAERR,RAFDA,RAFREQ,RAIEN,RAOPT,RAR,RAUSER,RAWHEN,X,Y
"RTN","RAIPS135",64,0)
 S RAOPT="RA AUTO DISCONTINUE PROCESS" ;xported w/135
"RTN","RAIPS135",65,0)
 ;jobs in production are tasked off for tomorrow @21:00; jobs in mirror run today in an hour 
"RTN","RAIPS135",66,0)
 S RAWHEN=$S($$PROD^XUPROD()=1:$$FMADD^XLFDT(DT,1)_".21",1:$$FMADD^XLFDT($E($$NOW^XLFDT(),1,12),0,1,0,0))
"RTN","RAIPS135",67,0)
 S RAUSER="POSTMASTER"
"RTN","RAIPS135",68,0)
 S RAWHEN=$$FMTE^XLFDT(RAWHEN) ;use external
"RTN","RAIPS135",69,0)
 S RAR=$NA(RAFDA(19.2,"?+1,")) ;RAFDA root
"RTN","RAIPS135",70,0)
 ;.01 - option to be scheduled
"RTN","RAIPS135",71,0)
 S @RAR@(.01)=RAOPT
"RTN","RAIPS135",72,0)
 ;field #: 2 - QUEUED TO RUN AT WHAT TIME
"RTN","RAIPS135",73,0)
 S:$D(RAWHEN) @RAR@(2)=RAWHEN
"RTN","RAIPS135",74,0)
 ;field #: 3 - DEVICE FOR QUEUED JOB OUTPUT
"RTN","RAIPS135",75,0)
 S:$D(RADEV) @RAR@(3)=RADEV
"RTN","RAIPS135",76,0)
 ;field #: 6 - RESCHEDULING FREQUENCY
"RTN","RAIPS135",77,0)
 S:$D(RAFREQ) @RAR@(6)=RAFREQ
"RTN","RAIPS135",78,0)
 ;field #: 11 - USER TO RUN TASK
"RTN","RAIPS135",79,0)
 S:$D(RAUSER) @RAR@(11)=RAUSER
"RTN","RAIPS135",80,0)
 D UPDATE^DIE("E","RAFDA","RAIEN","RAERR")
"RTN","RAIPS135",81,0)
 I $D(RAERR) D
"RTN","RAIPS135",82,0)
 .S RATXT(1)="Error: """_RAOPT_""" could not be scheduled."
"RTN","RAIPS135",83,0)
 .S RATXT(2)="Contact the developers of RA*5.0*135 to address this issue."
"RTN","RAIPS135",84,0)
 .D BMES^XPDUTL(.RATXT)
"RTN","RAIPS135",85,0)
 .Q
"RTN","RAIPS135",86,0)
 I $G(RAIEN(1))>0 D
"RTN","RAIPS135",87,0)
 .K RA192,RATXT S RATXT(1)=""
"RTN","RAIPS135",88,0)
 .D OPTSTAT^XUTMOPT(RAOPT,.RA192)
"RTN","RAIPS135",89,0)
 .S RATXT(2)=RAOPT_" Task: "_$P($G(RA192(1)),U) ;task # ^ D/T scheduled
"RTN","RAIPS135",90,0)
 .D BMES^XPDUTL(.RATXT) K RA192,RATXT
"RTN","RAIPS135",91,0)
 .Q
"RTN","RAIPS135",92,0)
 Q
"RTN","RAIPS135",93,0)
 ;
"RTN","RAIPS135",94,0)
EN3 ;re-index the "AS" cross reference missed in RA*5.0*130
"RTN","RAIPS135",95,0)
 ;
"RTN","RAIPS135",96,0)
 N RATXT,ZTDESC,ZTDTH,ZTIO,ZTRTN S ZTIO="",RATXT(1)=""
"RTN","RAIPS135",97,0)
 S ZTRTN="EN3^RAUTODC",(ZTDESC,RATXT(2))="RA135: re-index of the 'REQUEST STATUS' ""AS"" xref."
"RTN","RAIPS135",98,0)
 ;
"RTN","RAIPS135",99,0)
 S ZTDTH=$H D ^%ZTLOAD S RATXT(3)="Task: "_$S($G(ZTSK)>0:ZTSK,1:"in error")
"RTN","RAIPS135",100,0)
 D BMES^XPDUTL(.RATXT)
"RTN","RAIPS135",101,0)
 Q
"RTN","RAIPS135",102,0)
 ;
"RTN","RAUTODC")
0^1^B64769813^n/a
"RTN","RAUTODC",1,0)
RAUTODC ;HISC/GJC discontinue expired rad orders ;30 Jan 2018 9:01 AM
"RTN","RAUTODC",2,0)
 ;;5.0;Radiology/Nuclear Medicine;**135**;Mar 16, 1998;Build 7
"RTN","RAUTODC",3,0)
 ;
"RTN","RAUTODC",4,0)
 ; *** WORKING: INTERNAL ONLY ***
"RTN","RAUTODC",5,0)
 ;
"RTN","RAUTODC",6,0)
EN1 ;entry point for initial mass discontinue action
"RTN","RAUTODC",7,0)
 ;check for all imaging types no bulletins/alerts
"RTN","RAUTODC",8,0)
 ;EN^RABUL is the bulletin routine.
"RTN","RAUTODC",9,0)
 ;
"RTN","RAUTODC",10,0)
 ;Routine              IA          Type
"RTN","RAUTODC",11,0)
 ;-------------------------------------
"RTN","RAUTODC",12,0)
 ; $$EC^%ZOSV          10097        (S)
"RTN","RAUTODC",13,0)
 ; ^%ZTER               1621        (S)
"RTN","RAUTODC",14,0)
 ; $$S^%ZTLOAD         10063        (S)
"RTN","RAUTODC",15,0)
 ; $$*^XLFDT           10103        (S)
"RTN","RAUTODC",16,0)
 ; ^XMD                10070        (S) 
"RTN","RAUTODC",17,0)
 ; EN^XPAR              2263        (S)
"RTN","RAUTODC",18,0)
 ; ENVAL^XPAR           2263        (S)
"RTN","RAUTODC",19,0)
 ; $$KSP^XUPARAM        2541        (S)
"RTN","RAUTODC",20,0)
 ; OUT^XPDMENU(p1,p2)   1157        (S)
"RTN","RAUTODC",21,0)
 ; ENALL^DIK           10013        (S)
"RTN","RAUTODC",22,0)
 ;
"RTN","RAUTODC",23,0)
 ;
"RTN","RAUTODC",24,0)
 ; *************************************************************
"RTN","RAUTODC",25,0)
 ; *** now that we've disabled all the notifications we need ***
"RTN","RAUTODC",26,0)
 ; *** to restore them if we run into an error. so we set    ***
"RTN","RAUTODC",27,0)
 ; *** the error trap code                                   ***
"RTN","RAUTODC",28,0)
 S X="ERROR^RAUTODC",@^%ZOSF("TRAP")
"RTN","RAUTODC",29,0)
 ; *************************************************************
"RTN","RAUTODC",30,0)
 ;
"RTN","RAUTODC",31,0)
 ;OE/RR NOTIFICATIONS IEN/NAME: 26/IMAGING REQUEST CANCEL/HELD
"RTN","RAUTODC",32,0)
 ;
"RTN","RAUTODC",33,0)
 ;                  *** variable list ***
"RTN","RAUTODC",34,0)
 ;RA135TIME: flag that mass DC is running (see RABUL)
"RTN","RAUTODC",35,0)
 ;RAIEN    : IEN of 'IMAGING REQUEST CANCEL/HELD' notification
"RTN","RAUTODC",36,0)
 ;RADD21   : DATE DESIRED (Not guaranteed) value from "BDD" xref
"RTN","RAUTODC",37,0)
 ;RADUZ    : the user performing these action on file 75.1 (POSTMASTER)
"RTN","RAUTODC",38,0)
 ;RAEDTM   : end date for mass DC process (no bulletins; no notifications)
"RTN","RAUTODC",39,0)
 ;RAENT    : entity USR-DUZ, DIV-DUZ(2), SYS-domain, PKG-package
"RTN","RAUTODC",40,0)
 ;RAIEN    : IEN of IMAGING REQUEST CANCEL/HELD notification (26)
"RTN","RAUTODC",41,0)
 ;RANOTE   : array of the 'IMAGING REQUEST CANCEL/HELD' notification setting
"RTN","RAUTODC",42,0)
 ;RAOIFN   : IEN of the record in RAD/NUC MED ORDERS file 75.1
"RTN","RAUTODC",43,0)
 ;RAOREQST : the REQUEST STATUS of each order record hit in file 75.1
"RTN","RAUTODC",44,0)
 ;RAOSTS   : internal FM variable for DISCONTINUED (1) req'd for ^RAORDU
"RTN","RAUTODC",45,0)
 ;RAQUIT   : indicates if the mass dc has been stopped or ran past time
"RTN","RAUTODC",46,0)
 ;RAREQSTS : hold (3)/pending (5)/scheduled (8) - the REQUEST STATUS static string
"RTN","RAUTODC",47,0)
 ;           used to compare against each record's REQUEST STATUS value against
"RTN","RAUTODC",48,0)
 ;RASAV    : carbon copy of RANOTE, the original notification values (enabled/disabled)
"RTN","RAUTODC",49,0)
 ;         : used to reset notifications to their original settings when the process
"RTN","RAUTODC",50,0)
 ;           has finished, has errored or has stopped.
"RTN","RAUTODC",51,0)
 ;
"RTN","RAUTODC",52,0)
 ;w/o the reason we cannot go forward.
"RTN","RAUTODC",53,0)
 S RAOREA(1)=$$GETREA()
"RTN","RAUTODC",54,0)
 I RAOREA(1)'>0 D  K RAOREA Q
"RTN","RAUTODC",55,0)
 .N RAX S RAX(1)="'OBSOLETE ORDER-P135 (automated)' not found in file 75.2"
"RTN","RAUTODC",56,0)
 .D EMAIL(.RAX)
"RTN","RAUTODC",57,0)
 .Q
"RTN","RAUTODC",58,0)
 ;
"RTN","RAUTODC",59,0)
 ; check notifications against: OR PARAM COORDINATOR MENU
"RTN","RAUTODC",60,0)
 ;
"RTN","RAUTODC",61,0)
 N RAERR
"RTN","RAUTODC",62,0)
 ;
"RTN","RAUTODC",63,0)
 ;prevents bulletins from firing (RABUL in DD 75.1, fld: 5)
"RTN","RAUTODC",64,0)
 S RA135TIME=1
"RTN","RAUTODC",65,0)
 ;
"RTN","RAUTODC",66,0)
 S RAQUIT=0,RAREQSTS="^3^5^8^"
"RTN","RAUTODC",67,0)
 ;
"RTN","RAUTODC",68,0)
 ;--- get notifications ---
"RTN","RAUTODC",69,0)
 K RANOTE S RAPAR="ORB PROCESSING FLAG"
"RTN","RAUTODC",70,0)
 S RAINT="IMAGING REQUEST CANCEL/HELD"
"RTN","RAUTODC",71,0)
 D GETNOTE(.RANOTE,RAPAR,RAINT)
"RTN","RAUTODC",72,0)
 ;
"RTN","RAUTODC",73,0)
 ;RAERR is returned: RAERR=0 if no error, else error
"RTN","RAUTODC",74,0)
 I RAERR'=0 D  Q
"RTN","RAUTODC",75,0)
 .N RAX S RAX(1)="GETNOTE^RAUTODC failed."
"RTN","RAUTODC",76,0)
 .D EMAIL(.RAX)
"RTN","RAUTODC",77,0)
 .Q
"RTN","RAUTODC",78,0)
 ;--- end get notifications ---
"RTN","RAUTODC",79,0)
 ;
"RTN","RAUTODC",80,0)
 ;save off the original definition of the notification values in RASAV
"RTN","RAUTODC",81,0)
 K RASAV M RASAV=RANOTE
"RTN","RAUTODC",82,0)
 ;
"RTN","RAUTODC",83,0)
 ;must save off the original IMAGING REQUEST CANCEL/HELD notification definitions
"RTN","RAUTODC",84,0)
 ;in XTMP to ensure resetting them to their correct values in case of error.
"RTN","RAUTODC",85,0)
 S RADESC="RA5_0P135: save off the original value of the IMAGING REQUEST CANCEL/HELD notification per parameter"
"RTN","RAUTODC",86,0)
 K ^XTMP("RA5_0P135",0) S ^XTMP("RA5_0P135",0)=$$FMADD^XLFDT($$DT^XLFDT(),30,0,0,0)_"^"_$$DT^XLFDT()_"^"_RADESC
"RTN","RAUTODC",87,0)
 K RADESC M ^XTMP("RA5_0P135")=RANOTE
"RTN","RAUTODC",88,0)
 ;
"RTN","RAUTODC",89,0)
 ; RASAV save the original values of at each notification value @ each
"RTN","RAUTODC",90,0)
 ; level: user, team, service, location, division, system & package. 
"RTN","RAUTODC",91,0)
 ; disable notifications if set to enabled. Use RANOTE as the reference.
"RTN","RAUTODC",92,0)
 ; Place options 'Cancel a Request' & 'Hold a Request' out of order 
"RTN","RAUTODC",93,0)
 D DISABLE,OOO(1)
"RTN","RAUTODC",94,0)
 ;
"RTN","RAUTODC",95,0)
 K RAERR
"RTN","RAUTODC",96,0)
 ;
"RTN","RAUTODC",97,0)
 N RADD21,RADUZ S RADD21=0
"RTN","RAUTODC",98,0)
 S RADUZ=.5 ;POSTMASTER
"RTN","RAUTODC",99,0)
 ;
"RTN","RAUTODC",100,0)
 ;turn off notifications and bulletins for all events up to May 31st 2015@23:59
"RTN","RAUTODC",101,0)
 S RAEDTM=3150531.2359
"RTN","RAUTODC",102,0)
 ;
"RTN","RAUTODC",103,0)
 ; set to 'Discontinue' request status internal value
"RTN","RAUTODC",104,0)
 ; used when calling ^RAORDU (fixed value)
"RTN","RAUTODC",105,0)
 S RAOSTS=1
"RTN","RAUTODC",106,0)
 ;
"RTN","RAUTODC",107,0)
 ;track statistics: how many records, how long did it take?
"RTN","RAUTODC",108,0)
 S RAQST=$$NOW^XLFDT() ;start time w/seconds
"RTN","RAUTODC",109,0)
 S RAQDC=0 ;count the # of orders DC'd.
"RTN","RAUTODC",110,0)
 ;
"RTN","RAUTODC",111,0)
 ;"BDD" cross reference on the added w/RA*5.0*135
"RTN","RAUTODC",112,0)
 F  S RADD21=$O(^RAO(75.1,"BDD",RADD21)) Q:RADD21=""!(RADD21>RAEDTM)  D  Q:RAQUIT
"RTN","RAUTODC",113,0)
 .;
"RTN","RAUTODC",114,0)
 .S RAOIFN=0 F  S RAOIFN=$O(^RAO(75.1,"BDD",RADD21,RAOIFN)) Q:RAOIFN=""  D  Q:RAQUIT
"RTN","RAUTODC",115,0)
 ..S RAOIFN(0)=$G(^RAO(75.1,RAOIFN,0)) Q:RAOIFN(0)=""
"RTN","RAUTODC",116,0)
 ..;
"RTN","RAUTODC",117,0)
 ..;only hold (3)/pending (5)/scheduled (8) orders are DC'd
"RTN","RAUTODC",118,0)
 ..;RAREQSTS="^3^5^8^"
"RTN","RAUTODC",119,0)
 ..S RAOREQST=$P(RAOIFN(0),U,5)
"RTN","RAUTODC",120,0)
 ..Q:RAREQSTS'[(U_RAOREQST_U)
"RTN","RAUTODC",121,0)
 ..;
"RTN","RAUTODC",122,0)
 ..;
"RTN","RAUTODC",123,0)
 ..; Request Status='Scheduled' check the 'SCHEDULED DATE/TIME'
"RTN","RAUTODC",124,0)
 ..; 'DATE DESIRED (not Guaranteed)' fields
"RTN","RAUTODC",125,0)
 ..; if 'SCHEDULED DATE/TIME' > 05/31/2015@2359 -OR-
"RTN","RAUTODC",126,0)
 ..; 'DATE DESIRED (not Guaranteed)' > 06/01/2015
"RTN","RAUTODC",127,0)
 ..; quit
"RTN","RAUTODC",128,0)
 ..I RAOREQST=8,(($$8()>RAEDTM)) Q
"RTN","RAUTODC",129,0)
 ..;
"RTN","RAUTODC",130,0)
 ..;
"RTN","RAUTODC",131,0)
 ..; RAOIFN & RAOREA(n) are defined above. RAOSTS
"RTN","RAUTODC",132,0)
 ..; is set above (to a value of one) outside the
"RTN","RAUTODC",133,0)
 ..; RADD21 FOR loop above RAOIFN, RAOREA(n) & RADD21
"RTN","RAUTODC",134,0)
 ..; are required when calling ^RAORDU
"RTN","RAUTODC",135,0)
 ..D ^RAORDU
"RTN","RAUTODC",136,0)
 ..S RAQDC=RAQDC+1 ;increment the DC'd order total
"RTN","RAUTODC",137,0)
 ..Q
"RTN","RAUTODC",138,0)
 .;
"RTN","RAUTODC",139,0)
 .I $$S^%ZTLOAD() S (ZTSTOP,RAQUIT)=1 D  Q
"RTN","RAUTODC",140,0)
 ..;re-enable the notifications, place options back in order
"RTN","RAUTODC",141,0)
 ..D ENABLE,OOO(0)
"RTN","RAUTODC",142,0)
 ..S RATXT(1)="RA*5.0*135 mass DC process stopped: "_$$NOW^XLFDT()
"RTN","RAUTODC",143,0)
 ..D EMAIL(.RATXT) K RATXT
"RTN","RAUTODC",144,0)
 ..Q
"RTN","RAUTODC",145,0)
 .Q
"RTN","RAUTODC",146,0)
 ;
"RTN","RAUTODC",147,0)
 ;only remove the task from the task log if not stopped (ZTSTOP=0)
"RTN","RAUTODC",148,0)
 S:$D(ZTQUEUED)&($G(ZTSTOP,0)=0) ZTREQ="@"
"RTN","RAUTODC",149,0)
 ;
"RTN","RAUTODC",150,0)
 ; the process completed successfully: no error; not stopped
"RTN","RAUTODC",151,0)
 ; re-enable the notifications, place options back in order 
"RTN","RAUTODC",152,0)
 D:RAQUIT=0 ENABLE,OOO(0)
"RTN","RAUTODC",153,0)
 ;
"RTN","RAUTODC",154,0)
 D STATS ;track DC'd statistics, email results to proper audience
"RTN","RAUTODC",155,0)
 ;
"RTN","RAUTODC",156,0)
KILL ; Kill variables
"RTN","RAUTODC",157,0)
 K RA135TIME,RADD21,RADUZ,RAEDTM,RAENT,RAIEN,RANOTE,RAOIFN
"RTN","RAUTODC",158,0)
 K RAOREA,RAOREQST,RAQDC,RAQFIN,RAQST,RAQUIT,RAREQSTS,RASAV
"RTN","RAUTODC",159,0)
 Q
"RTN","RAUTODC",160,0)
 ;
"RTN","RAUTODC",161,0)
 ;                 *** utilities ***
"RTN","RAUTODC",162,0)
 ;
"RTN","RAUTODC",163,0)
GETREA() ;get the generic discontinue reason IEN
"RTN","RAUTODC",164,0)
 ;the record has a .01 of 'OBSOLETE ORDER-P135 (automated)'
"RTN","RAUTODC",165,0)
 ;the "B" xref stores 'OBSOLETE ORDER-P135 (automated' thirty chars
"RTN","RAUTODC",166,0)
 Q $O(^RA(75.2,"B","OBSOLETE ORDER-P135 (automated",0))
"RTN","RAUTODC",167,0)
 ;
"RTN","RAUTODC",168,0)
DISABLE ;disable the notifications that were enabled
"RTN","RAUTODC",169,0)
 S RAENT="" F  S RAENT=$O(RANOTE(RAENT)) Q:RAENT=""  D
"RTN","RAUTODC",170,0)
 .S RAIEN=$O(RANOTE(RAENT,0)) Q:RAIEN=0
"RTN","RAUTODC",171,0)
 .;RAIEN=IEN of the value 'IMAGING REQUEST CANCEL/HELD' `26
"RTN","RAUTODC",172,0)
 .D:$G(RANOTE(RAENT,RAIEN))'="D" NOTEVT(RAENT,1) ;disable
"RTN","RAUTODC",173,0)
 .;note: if not 'D'isabled then the notification
"RTN","RAUTODC",174,0)
 .;      is either 'E'nabled or 'M'andatory
"RTN","RAUTODC",175,0)
 .Q
"RTN","RAUTODC",176,0)
 Q
"RTN","RAUTODC",177,0)
 ;
"RTN","RAUTODC",178,0)
ENABLE ;enable the notifications that were disabled
"RTN","RAUTODC",179,0)
 N RAIEN,RAENT
"RTN","RAUTODC",180,0)
 S RAENT="" F  S RAENT=$O(RASAV(RAENT)) Q:RAENT=""  D
"RTN","RAUTODC",181,0)
 .S RAIEN=$O(RANOTE(RAENT,0)) Q:RAIEN=0
"RTN","RAUTODC",182,0)
 .;RAIEN should be the IEN of the value "IMAGING REQUEST CANCEL/HELD" `26
"RTN","RAUTODC",183,0)
 .;RASAV is the array of notifications defnitions before our total disable action
"RTN","RAUTODC",184,0)
 .D:$G(RASAV(RAENT,RAIEN))'="D" NOTEVT(RAENT,0) ;enable
"RTN","RAUTODC",185,0)
 .;note: if not 'E'nabled or 'M'andatory then the
"RTN","RAUTODC",186,0)
 .;      notification was 'D'isabled.
"RTN","RAUTODC",187,0)
 .Q
"RTN","RAUTODC",188,0)
 Q
"RTN","RAUTODC",189,0)
 ;
"RTN","RAUTODC",190,0)
8() ;get SCHEDULED DATE (TIME optional) fld: #23
"RTN","RAUTODC",191,0)
 Q $P(RAOIFN(0),U,23)
"RTN","RAUTODC",192,0)
 ;
"RTN","RAUTODC",193,0)
GETNOTE(ARY,PAR,INST) ; gets both enabled & disabled
"RTN","RAUTODC",194,0)
 D ENVAL^XPAR(.ARY,PAR,INST,.RAERR)
"RTN","RAUTODC",195,0)
 ;RAERR is returned: RAERR=0 if no error, else error
"RTN","RAUTODC",196,0)
 I RAERR'=0 D
"RTN","RAUTODC",197,0)
 .N RATXT S RATXT(1)="RAERR = "_$G(RAERR),RATXT(2)="INST = "_INST
"RTN","RAUTODC",198,0)
 .S RATXT(3)="RANOTE = "_$G(RANOTE),RATXT(4)="PAR = "_PAR
"RTN","RAUTODC",199,0)
 .S RATXT(5)="Error @ GETNOTE^RAUTODC"
"RTN","RAUTODC",200,0)
 .D EMAIL(.RATXT)
"RTN","RAUTODC",201,0)
 Q
"RTN","RAUTODC",202,0)
 ;
"RTN","RAUTODC",203,0)
NOTEVT(RAENT,Y) ;
"RTN","RAUTODC",204,0)
 ;RAENT = array value of notification (#100.9) values
"RTN","RAUTODC",205,0)
 ; for "IMAGING REQUEST CANCEL/HELD"
"RTN","RAUTODC",206,0)
 ;Y = 1 disable, 0 enable
"RTN","RAUTODC",207,0)
 ;
"RTN","RAUTODC",208,0)
 ;RAIEN is global in scope RAIEN should be 26
"RTN","RAUTODC",209,0)
 N RAPAR,RAY S RAPAR="48"
"RTN","RAUTODC",210,0)
 I Y=1 S RAY="D"
"RTN","RAUTODC",211,0)
 E  S RAY=$G(RASAV(RAENT,RAIEN))
"RTN","RAUTODC",212,0)
 S RAY(0)=$S(RAY="D":"Disabled",RAY="E":"Enabled",1:"Mandatory")
"RTN","RAUTODC",213,0)
 D EN^XPAR(RAENT,RAPAR,RAIEN,.RAY,.ERR)
"RTN","RAUTODC",214,0)
 ;
"RTN","RAUTODC",215,0)
 Q
"RTN","RAUTODC",216,0)
 ;
"RTN","RAUTODC",217,0)
OOO(Y) ;place options 'Cancel a Request' & 'Hold a Request' in/out of order
"RTN","RAUTODC",218,0)
 ;input: Y = 1 to set options out of order (OOO)
"RTN","RAUTODC",219,0)
 ;       Y = 0 to set options back in order
"RTN","RAUTODC",220,0)
 S RAX=$S(Y=1:"<<< RA*5.0*135 >>>",1:"@")
"RTN","RAUTODC",221,0)
 F RAI="RA ORDERCANCEL","RA ORDERHOLD" D OUT^XPDMENU(RAI,RAX)
"RTN","RAUTODC",222,0)
 K RAI,RAX
"RTN","RAUTODC",223,0)
 Q
"RTN","RAUTODC",224,0)
 ;
"RTN","RAUTODC",225,0)
ERROR ;come here on error
"RTN","RAUTODC",226,0)
 N RAERR,RATXT
"RTN","RAUTODC",227,0)
 S RAERR=$$EC^%ZOSV ;get error code
"RTN","RAUTODC",228,0)
 ;record error
"RTN","RAUTODC",229,0)
 D ^%ZTER
"RTN","RAUTODC",230,0)
 ;restore notifications, place options back in order
"RTN","RAUTODC",231,0)
 D ENABLE,OOO(0)
"RTN","RAUTODC",232,0)
 ;build email
"RTN","RAUTODC",233,0)
 s RATXT(1)=$G(ZTDESC,"RA*5.0*135 part one")_" has encountered an error."
"RTN","RAUTODC",234,0)
 S RATXT(2)="$ZE: "_RAERR
"RTN","RAUTODC",235,0)
 ;send email
"RTN","RAUTODC",236,0)
 D EMAIL(.RATXT)
"RTN","RAUTODC",237,0)
 Q
"RTN","RAUTODC",238,0)
 ;
"RTN","RAUTODC",239,0)
EMAIL(RAX) ;email error to us
"RTN","RAUTODC",240,0)
 ;RAX = error text array
"RTN","RAUTODC",241,0)
 N D0,D1,DIC,XMDUN,XMDUZ,XMSUB,XMY
"RTN","RAUTODC",242,0)
 S XMY("greg.cebelinski@domain.ext")=""
"RTN","RAUTODC",243,0)
 S XMY("kerry.milligan@domain.ext")=""
"RTN","RAUTODC",244,0)
 S XMSUB="RA*5.0*135@"_$$KSP^XUPARAM("WHERE")
"RTN","RAUTODC",245,0)
 S XMDUZ=.5,XMTEXT="RAX("
"RTN","RAUTODC",246,0)
 D ^XMD S RAMSGNUM=XMZ
"RTN","RAUTODC",247,0)
 Q
"RTN","RAUTODC",248,0)
 ;
"RTN","RAUTODC",249,0)
 ;
"RTN","RAUTODC",250,0)
EN2 ; re-index the new 'DATE DESIRED (Not guaranteed)' (#21) "BDD" xref
"RTN","RAUTODC",251,0)
 ;
"RTN","RAUTODC",252,0)
 K DA,DIC,DIK S DIK="^RAO(75.1,",DIK(1)="21^BDD" D ENALL^DIK
"RTN","RAUTODC",253,0)
 K DA,DIC,DIK
"RTN","RAUTODC",254,0)
 Q
"RTN","RAUTODC",255,0)
 ;
"RTN","RAUTODC",256,0)
EN3 ; re-index the existing 'REQUEST STATUS' (#5) "AS" xref.
"RTN","RAUTODC",257,0)
 ;
"RTN","RAUTODC",258,0)
 K DA,DIC,DIK K ^RAO(75.1,"AS") ;kill the corrupted "AS" xref
"RTN","RAUTODC",259,0)
 S DIK="^RAO(75.1,",DIK(1)="5^AS" D ENALL^DIK
"RTN","RAUTODC",260,0)
 K DA,DIC,DIK
"RTN","RAUTODC",261,0)
 Q
"RTN","RAUTODC",262,0)
 ;
"RTN","RAUTODC",263,0)
STATS ;track DC'd statistics: how many records, how long did it take.
"RTN","RAUTODC",264,0)
 ; email to RA REQUEST CANCELLED & POSTMASTER.
"RTN","RAUTODC",265,0)
 ;
"RTN","RAUTODC",266,0)
 N I,RAQFIN,RATEXT,RAX,XMDUZ,XMMG,XMSUB,XMTEXT,XMY,XMZ
"RTN","RAUTODC",267,0)
 S RAX="DC'd order process ",XMDUZ=.5 ;postmaster
"RTN","RAUTODC",268,0)
 S RAQFIN=$$NOW^XLFDT() ;w/seconds
"RTN","RAUTODC",269,0)
 S XMSUB="RA135: # of DC'd orders over time statistics"
"RTN","RAUTODC",270,0)
 S RATEXT(1)=RAX_"started: "_$$FMTE^XLFDT(RAQST,"1P") ;RAQST is global
"RTN","RAUTODC",271,0)
 S RATEXT(2)=RAX_"finished: "_$$FMTE^XLFDT(RAQFIN,"1P")
"RTN","RAUTODC",272,0)
 S RATEXT(3)="Total # of orders DC'd: "_RAQDC,RATXT(4)=""
"RTN","RAUTODC",273,0)
 S RATEXT(5)="DC'd process duration: "_$$FMDIFF^XLFDT(RAQFIN,RAQST,3)
"RTN","RAUTODC",274,0)
 F I="G.RA REQUEST CANCELLED","POSTMASTER" S XMY(I)=""
"RTN","RAUTODC",275,0)
 S XMTEXT="RATEXT("
"RTN","RAUTODC",276,0)
 D ^XMD
"RTN","RAUTODC",277,0)
 Q
"RTN","RAUTODC",278,0)
 ;
"VER")
8.0^22.2
"^DD",75.1,75.1,21,0)
DATE DESIRED (Not guaranteed)^D^^0;21^S %DT="ETX" D ^%DT S X=Y K:Y<1 X
"^DD",75.1,75.1,21,.1)
REQUESTED DATE (TIME optional)
"^DD",75.1,75.1,21,1,0)
^.1
"^DD",75.1,75.1,21,1,1,0)
75.1^AC^MUMPS
"^DD",75.1,75.1,21,1,1,1)
S ^RAO(75.1,"AP",+$P(^RAO(75.1,DA,0),U),+$P(^(0),U,2),9999999.9999-$E(X,1,30),DA)=""
"^DD",75.1,75.1,21,1,1,2)
K ^RAO(75.1,"AP",+$P(^RAO(75.1,DA,0),U),+$P(^(0),U,2),9999999.9999-$E(X,1,30),DA)
"^DD",75.1,75.1,21,1,1,"%D",0)
^^1^1^2911113^
"^DD",75.1,75.1,21,1,1,"%D",1,0)
This cross-reference is used for the verification process in OE/RR.
"^DD",75.1,75.1,21,1,1,"DT")
2911113
"^DD",75.1,75.1,21,3)
Enter the date on which you would like the exam done.
"^DD",75.1,75.1,21,10)
MEDICAL ADMINISTRATION SERVICE OR RAD/NUC MED SERVICE
"^DD",75.1,75.1,21,21,0)
^^2^2^2960709^^
"^DD",75.1,75.1,21,21,1,0)
This field contains the date for which the rad/nuc med exam is requested.
"^DD",75.1,75.1,21,21,2,0)
This field should not be interpreted as an appointment date.
"^DD",75.1,75.1,21,"DT")
3171024
"BLD",10065,6)
^127
**END**
**END**

