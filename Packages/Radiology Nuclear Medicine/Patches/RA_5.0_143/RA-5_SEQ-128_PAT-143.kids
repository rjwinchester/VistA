Released RA*5*143 SEQ #128
Extracted from mail message
**KIDS**:RA*5.0*143^

**INSTALL NAME**
RA*5.0*143
"BLD",10407,0)
RA*5.0*143^RADIOLOGY/NUCLEAR MEDICINE^0^3180412^y
"BLD",10407,1,0)
^^4^4^3180412^
"BLD",10407,1,1,0)
This patch will resolve the following issues in the RADIOLOGY/NUCLEAR 
"BLD",10407,1,2,0)
MEDICINE (RA) package:
"BLD",10407,1,3,0)
 
"BLD",10407,1,4,0)
1) RA REPORTS SHOW INCORRECT COMMENTS
"BLD",10407,4,0)
^9.64PA^^
"BLD",10407,6.3)
11
"BLD",10407,"ABPKG")
n
"BLD",10407,"KRN",0)
^9.67PA^779.2^20
"BLD",10407,"KRN",.4,0)
.4
"BLD",10407,"KRN",.401,0)
.401
"BLD",10407,"KRN",.402,0)
.402
"BLD",10407,"KRN",.403,0)
.403
"BLD",10407,"KRN",.5,0)
.5
"BLD",10407,"KRN",.84,0)
.84
"BLD",10407,"KRN",3.6,0)
3.6
"BLD",10407,"KRN",3.8,0)
3.8
"BLD",10407,"KRN",9.2,0)
9.2
"BLD",10407,"KRN",9.8,0)
9.8
"BLD",10407,"KRN",9.8,"NM",0)
^9.68A^3^3
"BLD",10407,"KRN",9.8,"NM",1,0)
RAORD61^^0^B8063377
"BLD",10407,"KRN",9.8,"NM",2,0)
RAO7PC1^^0^B47162808
"BLD",10407,"KRN",9.8,"NM",3,0)
RAO7PC2^^0^B48657820
"BLD",10407,"KRN",9.8,"NM","B","RAO7PC1",2)
 
"BLD",10407,"KRN",9.8,"NM","B","RAO7PC2",3)
 
"BLD",10407,"KRN",9.8,"NM","B","RAORD61",1)
 
"BLD",10407,"KRN",19,0)
19
"BLD",10407,"KRN",19.1,0)
19.1
"BLD",10407,"KRN",101,0)
101
"BLD",10407,"KRN",409.61,0)
409.61
"BLD",10407,"KRN",771,0)
771
"BLD",10407,"KRN",779.2,0)
779.2
"BLD",10407,"KRN",870,0)
870
"BLD",10407,"KRN",8989.51,0)
8989.51
"BLD",10407,"KRN",8989.52,0)
8989.52
"BLD",10407,"KRN",8994,0)
8994
"BLD",10407,"KRN","B",.4,.4)
 
"BLD",10407,"KRN","B",.401,.401)
 
"BLD",10407,"KRN","B",.402,.402)
 
"BLD",10407,"KRN","B",.403,.403)
 
"BLD",10407,"KRN","B",.5,.5)
 
"BLD",10407,"KRN","B",.84,.84)
 
"BLD",10407,"KRN","B",3.6,3.6)
 
"BLD",10407,"KRN","B",3.8,3.8)
 
"BLD",10407,"KRN","B",9.2,9.2)
 
"BLD",10407,"KRN","B",9.8,9.8)
 
"BLD",10407,"KRN","B",19,19)
 
"BLD",10407,"KRN","B",19.1,19.1)
 
"BLD",10407,"KRN","B",101,101)
 
"BLD",10407,"KRN","B",409.61,409.61)
 
"BLD",10407,"KRN","B",771,771)
 
"BLD",10407,"KRN","B",779.2,779.2)
 
"BLD",10407,"KRN","B",870,870)
 
"BLD",10407,"KRN","B",8989.51,8989.51)
 
"BLD",10407,"KRN","B",8989.52,8989.52)
 
"BLD",10407,"KRN","B",8994,8994)
 
"BLD",10407,"QDEF")
^^^^NO^^^^NO^^NO
"BLD",10407,"QUES",0)
^9.62^^
"BLD",10407,"REQB",0)
^9.611^3^3
"BLD",10407,"REQB",1,0)
RA*5.0*75^2
"BLD",10407,"REQB",2,0)
RA*5.0*123^2
"BLD",10407,"REQB",3,0)
RA*5.0*97^2
"BLD",10407,"REQB","B","RA*5.0*123",2)
 
"BLD",10407,"REQB","B","RA*5.0*75",1)
 
"BLD",10407,"REQB","B","RA*5.0*97",3)
 
"MBREQ")
0
"PKG",31,-1)
1^1
"PKG",31,0)
RADIOLOGY/NUCLEAR MEDICINE^RA^REGISTERS PATIENTS,RECORDS EXAMS,PROFILES,AMIS REPORTS
"PKG",31,22,0)
^9.49I^1^1
"PKG",31,22,1,0)
5.0^2980317^2980805^1
"PKG",31,22,1,"PAH",1,0)
143^3180412^520824660
"PKG",31,22,1,"PAH",1,1,0)
^^4^4^3180412
"PKG",31,22,1,"PAH",1,1,1,0)
This patch will resolve the following issues in the RADIOLOGY/NUCLEAR 
"PKG",31,22,1,"PAH",1,1,2,0)
MEDICINE (RA) package:
"PKG",31,22,1,"PAH",1,1,3,0)
 
"PKG",31,22,1,"PAH",1,1,4,0)
1) RA REPORTS SHOW INCORRECT COMMENTS
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")
 
"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
3
"RTN","RAO7PC1")
0^2^B47162808^B26248522
"RTN","RAO7PC1",1,0)
RAO7PC1 ;HISC/GJC,SS-Procedure Call utilities. ;12/9/02  08:41
"RTN","RAO7PC1",2,0)
 ;;5.0;Radiology/Nuclear Medicine;**1,16,18,26,36,45,75,143**;Mar 16, 1998;Build 11
"RTN","RAO7PC1",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","RAO7PC1",4,0)
 ;
"RTN","RAO7PC1",5,0)
EN1(RADFN,RABDT,RAEDT,RAEXN,RACINC) ;
"RTN","RAO7PC1",6,0)
 ;
"RTN","RAO7PC1",7,0)
 ; DBIA#2043 - Return list of exams within date range
"RTN","RAO7PC1",8,0)
 ;
"RTN","RAO7PC1",9,0)
 ; ** See routines RAO7PC1A and RAO7PC2 for additional comments **
"RTN","RAO7PC1",10,0)
 ; ** and output node descriptions                              **
"RTN","RAO7PC1",11,0)
 ;
"RTN","RAO7PC1",12,0)
 ; Input: RADFN-> Patient IEN        RABDT-> beginning date
"RTN","RAO7PC1",13,0)
 ;        RAEDT-> ending date        RAEXN-> max # of exams
"RTN","RAO7PC1",14,0)
 ;        RACINC-> include cancelled exams? (1 if yes, default no)
"RTN","RAO7PC1",15,0)
 ;
"RTN","RAO7PC1",16,0)
 ; Output:
"RTN","RAO7PC1",17,0)
 ; ^TMP($J,"RAE1",Patient IEN,Exam ID)=Procedure name^Case number^
"RTN","RAO7PC1",18,0)
 ;       Report status^Abnormal alert flag^Report ien^
"RTN","RAO7PC1",19,0)
 ;       Exam status order #~Exam status name^
"RTN","RAO7PC1",20,0)
 ;       Imaging location name^Imaging type abbr~
"RTN","RAO7PC1",21,0)
 ;       Imaging type name^abnormal results flag^CPT Code
"RTN","RAO7PC1",22,0)
 ;       ^CPRS Order ien^Images exist flag
"RTN","RAO7PC1",23,0)
 ;
"RTN","RAO7PC1",24,0)
 ;if there are one or more CPT modifiers:
"RTN","RAO7PC1",25,0)
 ; ^TMP($J,"RAE1",Patient IEN,Exam ID,"CMOD",n)=CPT Mod^CPT Mod Name
"RTN","RAO7PC1",26,0)
 ;                                         n+1)=CPT Mod^CPT Mod Name
"RTN","RAO7PC1",27,0)
 ;
"RTN","RAO7PC1",28,0)
 ;if CPRS asks to display parent procs, and case is descendent of parent:
"RTN","RAO7PC1",29,0)
 ; ^TMP($J,"RAE1",Patient IEN,Exam ID,"CPRS")=memb of set^parent prc name
"RTN","RAO7PC1",30,0)
 ;
"RTN","RAO7PC1",31,0)
 ; Note: It is possible for the ^TMP global data returned to contain
"RTN","RAO7PC1",32,0)
 ;       'No Report' and a Report file ien for the same exam.  This is
"RTN","RAO7PC1",33,0)
 ;       because Imaging can create a report stub in the Report file,
"RTN","RAO7PC1",34,0)
 ;       but no report interpretation exists and no status is assigned
"RTN","RAO7PC1",35,0)
 ;       to the report record.
"RTN","RAO7PC1",36,0)
 ;
"RTN","RAO7PC1",37,0)
 ; Exam ID: exam date/time (inverse) concatenated with the case IEN
"RTN","RAO7PC1",38,0)
 ; Abnormal alert flag:  Y or blank
"RTN","RAO7PC1",39,0)
 ; Abnormal results flag:  Y or blank, may be turned on even if
"RTN","RAO7PC1",40,0)
 ;     abnormal alert flag is not
"RTN","RAO7PC1",41,0)
 ;
"RTN","RAO7PC1",42,0)
 Q:'RADFN!('RABDT)!('RAEDT)
"RTN","RAO7PC1",43,0)
 N RAEXNP S RAEXNP=RAEXN ;save original value of RAEXN
"RTN","RAO7PC1",44,0)
 ; if last char RAEXNP has "P", then count max no. by parent and 
"RTN","RAO7PC1",45,0)
 ; single, not by individual cases
"RTN","RAO7PC1",46,0)
 S RACINC=+$G(RACINC)
"RTN","RAO7PC1",47,0)
 Q:RABDT>RAEDT  ; quit if ending date before beginning date
"RTN","RAO7PC1",48,0)
 K ^TMP($J,"RAE1") S RAEXN=+$G(RAEXN)
"RTN","RAO7PC1",49,0)
 S:$P(RABDT,".",2) RABDT=RABDT\1 S:$P(RAEDT,".",2) RAEDT=RAEDT\1
"RTN","RAO7PC1",50,0)
 N RABNOR,RACNST,RACNT,RACPT,RACSE,RADIAG,RAIBDT,RAIEDT,RAILOC,RAITY
"RTN","RAO7PC1",51,0)
 N RANO,RAPRC,RAREX,RARPT,RARPTST
"RTN","RAO7PC1",52,0)
 N RAXAM,RAXID,RAXIT,RAXSTAT,RABNORMR,RASHOCAN
"RTN","RAO7PC1",53,0)
 S RACNST=9999999.9999
"RTN","RAO7PC1",54,0)
 S RAIBDT=RACNST-(RAEDT+.9999),RAIEDT=RACNST-(RABDT-.0001)
"RTN","RAO7PC1",55,0)
 S (RACNT,RAXIT)=0
"RTN","RAO7PC1",56,0)
 F  S RAIBDT=$O(^RADPT(RADFN,"DT",RAIBDT)) Q:RAIBDT'>0!(RAIBDT>RAIEDT)  D  Q:RAXIT
"RTN","RAO7PC1",57,0)
 . D SETDATA^RAO7PC1A ; obtain exam data, set ^TMP($J,"RAE1",Patient IEN,Exam ID)
"RTN","RAO7PC1",58,0)
 . Q
"RTN","RAO7PC1",59,0)
 Q
"RTN","RAO7PC1",60,0)
EN2(RADFN) ;
"RTN","RAO7PC1",61,0)
 ;
"RTN","RAO7PC1",62,0)
 ; DBIA#2012 - Return last 7 days of non-cancelled exams
"RTN","RAO7PC1",63,0)
 ;
"RTN","RAO7PC1",64,0)
 ; Input: RADFN-> Patient IEN
"RTN","RAO7PC1",65,0)
 ;
"RTN","RAO7PC1",66,0)
 ; Output:
"RTN","RAO7PC1",67,0)
 ; ^TMP($J,"RAE7",Patient IEN,Exam ID)=procedure name^case number^
"RTN","RAO7PC1",68,0)
 ;       report status^imaging location IEN^imaging location name^
"RTN","RAO7PC1",69,0)
 ;       contrast medium or media used
"RTN","RAO7PC1",70,0)
 ;       Note: Single characters in parenthesis indicate contrast
"RTN","RAO7PC1",71,0)
 ;       involvement: (I)=Iodinated ionic; (N)=Iodinated non-ionic;
"RTN","RAO7PC1",72,0)
 ;        (L)=Gadolinium; (C)=Oral Cholecystographic; (G)=Gastrografin;
"RTN","RAO7PC1",73,0)
 ;        (B)=Barium; (M)=unspecified contrast media
"RTN","RAO7PC1",74,0)
 ;
"RTN","RAO7PC1",75,0)
 ; Exam ID: exam date/time (inverse) concatenated with the case IEN
"RTN","RAO7PC1",76,0)
 ;
"RTN","RAO7PC1",77,0)
 Q:'RADFN  D EN2^RAO7PC1A Q
"RTN","RAO7PC1",78,0)
 ;
"RTN","RAO7PC1",79,0)
EN3(X) ; DBIA#2265 - Return narrative text for exam(s)
"RTN","RAO7PC1",80,0)
 ; Input:
"RTN","RAO7PC1",81,0)
 ; X-> Exam id in one of two forms:
"RTN","RAO7PC1",82,0)
 ;   1) Pat. DFN^inv. exam date^Case IEN
"RTN","RAO7PC1",83,0)
 ;      Retrieves a single report for a single exam
"RTN","RAO7PC1",84,0)
 ;   2) Pat. DFN^inv. exam date^
"RTN","RAO7PC1",85,0)
 ;      Retrieves all reports for a set of exams ordered on one order
"RTN","RAO7PC1",86,0)
 ;
"RTN","RAO7PC1",87,0)
 ; Note:  Input delimiter can be any of the following: ^~\&;-
"RTN","RAO7PC1",88,0)
 ;        a delimiter may be a single space i.e, " "
"RTN","RAO7PC1",89,0)
 ;
"RTN","RAO7PC1",90,0)
 ; Output:
"RTN","RAO7PC1",91,0)
 ; ^TMP($J,"RAE2",Patient IEN,case IEN,procedure name)=report status^
"RTN","RAO7PC1",92,0)
 ; abnormal alert flag^CPRS Order ien^amended report?
"RTN","RAO7PC1",93,0)
 ; ^TMP($J,"RAE2",Patient IEN,case IEN,procedure name,"CM",n)=contrast
"RTN","RAO7PC1",94,0)
 ; media used during exam (internal)^contrast media used during exam
"RTN","RAO7PC1",95,0)
 ; (external)
"RTN","RAO7PC1",96,0)
 ; ^TMP($J,"RAE2",Patient IEN,case IEN,procedure name,"D",n)=diagnostic
"RTN","RAO7PC1",97,0)
 ; code (n=1, this is the primary code)
"RTN","RAO7PC1",98,0)
 ; ^TMP($J,"RAE2",Patient IEN,case IEN,procedure name,"H",n)=clin history
"RTN","RAO7PC1",99,0)
 ; (a line of text)
"RTN","RAO7PC1",100,0)
 ; ^TMP($J,"RAE2",Patient IEN,case IEN,procedure name,"I",n)=impression
"RTN","RAO7PC1",101,0)
 ; (a line of text)
"RTN","RAO7PC1",102,0)
 ; ^TMP($J,"RAE2",Patient IEN,case IEN,procedure name,"M",n)=modifier
"RTN","RAO7PC1",103,0)
 ; (external format)
"RTN","RAO7PC1",104,0)
 ; ^TMP($J,"RAE2",Patient IEN,case IEN,procedure name,"P")=primary
"RTN","RAO7PC1",105,0)
 ; interpreting staff IEN^primary interpreting resident IEN^date
"RTN","RAO7PC1",106,0)
 ; report entered
"RTN","RAO7PC1",107,0)
 ; ^TMP($J,"RAE2",Patient IEN,case IEN,procedure name,"R",n)=report
"RTN","RAO7PC1",108,0)
 ; (a line of text)
"RTN","RAO7PC1",109,0)
 ; ^TMP($J,"RAE2",Patient IEN,case IEN,procedure name,"RFS")=REASON
"RTN","RAO7PC1",110,0)
 ; FOR STUDY; the reason the study was conducted (a line of text)
"RTN","RAO7PC1",111,0)
 ; ^TMP($J,"RAE2",Patient IEN,case IEN,procedure name,"V",n)=verifier IEN
"RTN","RAO7PC1",112,0)
 ; ^signature block name
"RTN","RAO7PC1",113,0)
 ; ^TMP($J,"RAE2",Patient IEN,case IEN,procedure name,"TCOM",1)=techno-
"RTN","RAO7PC1",114,0)
 ; logist comment (a line of text)
"RTN","RAO7PC1",115,0)
 ; ^TMP($J,"RAE2",Patient IEN,"PRINT_SET")=null (IFF this is a printset)
"RTN","RAO7PC1",116,0)
 ; ^TMP($J,"RAE2",Patient IEN,"ORD")=name of ordered procedure for
"RTN","RAO7PC1",117,0)
 ;  examsets and printsets
"RTN","RAO7PC1",118,0)
 ; ^TMP($J,"RAE2",Patient IEN,"ORD",case IEN)=name of ordered procedure
"RTN","RAO7PC1",119,0)
 ;  for that case; not part of an examset or printset
"RTN","RAO7PC1",120,0)
 ;
"RTN","RAO7PC1",121,0)
 ; RA*5.0*143 don't kill TMP here
"RTN","RAO7PC1",122,0)
 ;K RAU,^TMP($J,"RAE2") S RAU=$$DEL(X)
"RTN","RAO7PC1",123,0)
 K RAU S RAU=$$DEL(X)
"RTN","RAO7PC1",124,0)
 I RAU="" K RAU Q
"RTN","RAO7PC1",125,0)
 Q:'$P(X,RAU)!('$P(X,RAU,2))  ; Quit if no Pat. DFN -or- no inv. exam DT
"RTN","RAO7PC1",126,0)
 N RACIEN,RADFN,RAINVXDT,RAPSET,Y S RAPSET=0
"RTN","RAO7PC1",127,0)
 S RADFN=$P(X,RAU),RAINVXDT=$P(X,RAU,2),RACIEN=+$P(X,RAU,3)
"RTN","RAO7PC1",128,0)
 K RAU Q:'($D(^RADPT(RADFN,"DT",RAINVXDT,0))#2)
"RTN","RAO7PC1",129,0)
SS I RACIEN D CASE^RAO7PC2(RACIEN) D SVTCOM^RAUTL11(RADFN,RAINVXDT,RACIEN) Q  ;P18 mod by SS
"RTN","RAO7PC1",130,0)
 S Y=0
"RTN","RAO7PC1",131,0)
 F  S Y=$O(^RADPT(RADFN,"DT",RAINVXDT,"P",Y)) Q:Y'>0  D
"RTN","RAO7PC1",132,0)
 . S RACNX=$P($G(^RADPT(RADFN,"DT",RADTI,"P",Y,0)),U,3)
"RTN","RAO7PC1",133,0)
 . S RACNX=$P($G(^RA(72,RACNX,0)),U)
"RTN","RAO7PC1",134,0)
 . Q:(RACNX["CANCEL")
"RTN","RAO7PC1",135,0)
 . D CASE^RAO7PC2(Y)
"RTN","RAO7PC1",136,0)
 . D SVTCOM^RAUTL11(RADFN,RAINVXDT,Y) ;P18 save TCOM in ^TMP
"RTN","RAO7PC1",137,0)
 . S RAPSET=0 ;P18 modified 
"RTN","RAO7PC1",138,0)
 . Q
"RTN","RAO7PC1",139,0)
 Q
"RTN","RAO7PC1",140,0)
 ;
"RTN","RAO7PC1",141,0)
EN30(RAOIFN) ; DBIA#2266 - Return narrative text for exam(s). To be used
"RTN","RAO7PC1",142,0)
 ; with the EN3 entry point above.
"RTN","RAO7PC1",143,0)
 ; Input: RAOIFN -> the ien of Rad/Nuc Med Order
"RTN","RAO7PC1",144,0)
 ; RA*5.0*143 Kill TMP here
"RTN","RAO7PC1",145,0)
 K ^TMP($J,"RAE2")
"RTN","RAO7PC1",146,0)
 Q:'RAOIFN  ; order passed in as 0 or null
"RTN","RAO7PC1",147,0)
 Q:'$D(^RAO(75.1,RAOIFN,0))  ; no such order
"RTN","RAO7PC1",148,0)
 Q:'$D(^RADPT("AO",RAOIFN))  ; no exam associated with this order
"RTN","RAO7PC1",149,0)
 N RADFN,RADTI,RACNI,RAXSET,RACNX,RADTIE,RAOK
"RTN","RAO7PC1",150,0)
 ; Get most recent DFN,DTI
"RTN","RAO7PC1",151,0)
 S RADFN=+$O(^RADPT("AO",RAOIFN,0)) Q:'RADFN
"RTN","RAO7PC1",152,0)
 S RADTI=+$O(^RADPT("AO",RAOIFN,RADFN,0)) Q:'RADTI
"RTN","RAO7PC1",153,0)
 ; RA 143 start
"RTN","RAO7PC1",154,0)
 S RADTIE=+$O(^RADPT("AO",RAOIFN,RADFN,"A"),-1)
"RTN","RAO7PC1",155,0)
 ;
"RTN","RAO7PC1",156,0)
 ;Multiple DTI for this exam?
"RTN","RAO7PC1",157,0)
 I RADTIE'=RADTI D  Q
"RTN","RAO7PC1",158,0)
 . ;Save most recent DTI and CNI
"RTN","RAO7PC1",159,0)
 . S RADTISV=RADTI,RACNISV=+$O(^RADPT("AO",RAOIFN,RADFN,RADTI,0))
"RTN","RAO7PC1",160,0)
 . ;
"RTN","RAO7PC1",161,0)
 . S (RACNX,RAXSET,RAOK)=0
"RTN","RAO7PC1",162,0)
 . S RADTI=0
"RTN","RAO7PC1",163,0)
 . F  S RADTI=$O(^RADPT("AO",RAOIFN,RADFN,RADTI)) Q:'RADTI  D  Q:'RACNX&'RAXSET
"RTN","RAO7PC1",164,0)
 . . S RACNI=0
"RTN","RAO7PC1",165,0)
 . . F  S RACNI=$O(^RADPT("AO",RAOIFN,RADFN,RADTI,RACNI)) Q:'RACNI  D
"RTN","RAO7PC1",166,0)
 . . . S RAXSET=+$P($G(^RADPT(RADFN,"DT",RADTI,0)),"^",5) ; set if RAXSET=1
"RTN","RAO7PC1",167,0)
 . . . ; use most recent exam for this order not cancelled
"RTN","RAO7PC1",168,0)
 . . . S RACNX=$P($G(^RADPT(RADFN,"DT",RADTI,"P",RACNI,0)),U,3)
"RTN","RAO7PC1",169,0)
 . . . S RACNX=$P($G(^RA(72,RACNX,0)),U)
"RTN","RAO7PC1",170,0)
 . . . S RACNX=(RACNX["CANCEL")
"RTN","RAO7PC1",171,0)
 . . . Q:RACNX
"RTN","RAO7PC1",172,0)
 . . . S RAOK=1
"RTN","RAO7PC1",173,0)
 . . . I RAXSET D EN3(RADFN_"^"_RADTI_"^") Q  ; exam set, hit EN3 code
"RTN","RAO7PC1",174,0)
 . . . I 'RAXSET D EN3(RADFN_"^"_RADTI_"^"_RACNI)
"RTN","RAO7PC1",175,0)
 . ;
"RTN","RAO7PC1",176,0)
 . ;NO ACTIVE EXAMS EXIST
"RTN","RAO7PC1",177,0)
 . I 'RAOK D
"RTN","RAO7PC1",178,0)
 . . ;Use exam most recently entered if none are NOT cancelled
"RTN","RAO7PC1",179,0)
 . . S RADTI=RADTISV,RACNI=RACNISV
"RTN","RAO7PC1",180,0)
 . . ; exam set examinations
"RTN","RAO7PC1",181,0)
 . . S RAXSET=+$P($G(^RADPT(RADFN,"DT",RADTI,0)),"^",5) ; set if RAXSET=1
"RTN","RAO7PC1",182,0)
 . . I RAXSET D EN3(RADFN_"^"_RADTI_"^") Q  ; exam set, hit EN3 code
"RTN","RAO7PC1",183,0)
 . . ;
"RTN","RAO7PC1",184,0)
 . . ; non-exam set examinations
"RTN","RAO7PC1",185,0)
 . . S RACNI=+$O(^RADPT("AO",RAOIFN,RADFN,RADTI,0)) Q:'RACNI
"RTN","RAO7PC1",186,0)
 . . D EN3(RADFN_"^"_RADTI_"^"_RACNI)
"RTN","RAO7PC1",187,0)
 ;
"RTN","RAO7PC1",188,0)
 ;Only 1 DTI for this exam?
"RTN","RAO7PC1",189,0)
 I RADTIE=RADTI D  Q
"RTN","RAO7PC1",190,0)
 . S RAXSET=+$P($G(^RADPT(RADFN,"DT",RADTI,0)),"^",5) ; set if RAXSET=1
"RTN","RAO7PC1",191,0)
 . I RAXSET D EN3(RADFN_"^"_RADTI_"^") Q
"RTN","RAO7PC1",192,0)
 . S RACNI=+$O(^RADPT("AO",RAOIFN,RADFN,RADTI,0)) Q:'RACNI
"RTN","RAO7PC1",193,0)
 . D EN3(RADFN_"^"_RADTI_"^"_RACNI)
"RTN","RAO7PC1",194,0)
 Q
"RTN","RAO7PC1",195,0)
EN4(RABBRV,RAARY) ; Return Imaging Locations
"RTN","RAO7PC1",196,0)
 ; Input: RABBRV-> Abbreviation for I-Type    RAARY-> data storage array
"RTN","RAO7PC1",197,0)
 ;
"RTN","RAO7PC1",198,0)
 ; Output:
"RTN","RAO7PC1",199,0)
 ; array name(location IEN)=File 79.1 IEN^File 44 name^division IEN
"RTN","RAO7PC1",200,0)
 ; ^division name
"RTN","RAO7PC1",201,0)
 ;
"RTN","RAO7PC1",202,0)
 Q:RABBRV']""  ; quit no I-Type abbreviation
"RTN","RAO7PC1",203,0)
 Q:RAARY']""  ;  quit no data storage array
"RTN","RAO7PC1",204,0)
 N RADIV,RAITY,RALOC,RAX
"RTN","RAO7PC1",205,0)
 S RAITY=+$O(^RA(79.2,"C",RABBRV,0)) Q:'RAITY
"RTN","RAO7PC1",206,0)
 S RAX=0 F  S RAX=$O(^RA(79.1,"BIMG",RAITY,RAX)) Q:RAX'>0  D
"RTN","RAO7PC1",207,0)
 . S RADIV(79)=$G(^RA(79.1,RAX,"DIV"))
"RTN","RAO7PC1",208,0)
 . S RALOC(0)=$G(^RA(79.1,RAX,0))
"RTN","RAO7PC1",209,0)
 . Q:$P(RALOC(0),"^",19)]""  ;inactive DT present, can't be a future DT
"RTN","RAO7PC1",210,0)
 . S RALOC=$P($G(^SC(+RALOC(0),0)),U)
"RTN","RAO7PC1",211,0)
 . S RALOC=$S(RALOC]"":RALOC,1:"Unknown")
"RTN","RAO7PC1",212,0)
 . S RADIV=+$P($G(^RA(79,+RADIV(79),0)),U),RADIV(4)=$G(^DIC(4,RADIV,0))
"RTN","RAO7PC1",213,0)
 . S RADIV=$S($P(RADIV(4),U)]"":$P(RADIV(4),U),1:"Unknown")
"RTN","RAO7PC1",214,0)
 . S @(RAARY_"("_RAX_")")=RAX_U_RALOC_U_+RADIV(79)_U_RADIV
"RTN","RAO7PC1",215,0)
 . Q
"RTN","RAO7PC1",216,0)
 Q
"RTN","RAO7PC1",217,0)
CASE(RAOIFN,RARRAY) ; Return the case numbers and the total number of
"RTN","RAO7PC1",218,0)
 ; case numbers associated with a particular order.
"RTN","RAO7PC1",219,0)
 ; Input: RAOIFN-order ien (75.1)
"RTN","RAO7PC1",220,0)
 ;        RARRAY-data storage (local array)
"RTN","RAO7PC1",221,0)
 ; Return: RATTL-n^x where n is the number of cases in the array
"RTN","RAO7PC1",222,0)
 ;               x=PRINTSET if a single report covers many cases.
"RTN","RAO7PC1",223,0)
 ;               -1 if error (invalid order ien)
"RTN","RAO7PC1",224,0)
 ;               -2 no registered case to date -OR- case(s) cancelled
"RTN","RAO7PC1",225,0)
 ;               If -1 or -2, second piece of RATTL gives the reason
"RTN","RAO7PC1",226,0)
 ;         RARRAY-local data array, array_name(case #)
"RTN","RAO7PC1",227,0)
 N RATTL S RATTL="" D CASE^RAO7PC1A
"RTN","RAO7PC1",228,0)
 Q RATTL
"RTN","RAO7PC1",229,0)
DEL(X) ; Determine the delimiter used to seperate the data
"RTN","RAO7PC1",230,0)
 ; Input: 'X'-> data seperated by a delimiter (first & second pieces
"RTN","RAO7PC1",231,0)
 ; will follow null)
"RTN","RAO7PC1",232,0)
 N Y,Z
"RTN","RAO7PC1",233,0)
 F Y="^","~","\","&",";","-"," " S Z=$F(X,Y) I +Z Q
"RTN","RAO7PC1",234,0)
 Q $S(+Z>0:Y,1:"") ; pass back the delimiter used, or null if not found
"RTN","RAO7PC2")
0^3^B48657820^B47517488
"RTN","RAO7PC2",1,0)
RAO7PC2 ;HISC/GJC-Part two for Return Narrative (EN3^RAO7PC1) ;8/18/08  09:47
"RTN","RAO7PC2",2,0)
 ;;5.0;Radiology/Nuclear Medicine;**1,11,14,16,22,27,45,75,56,95,97,143**;Mar 16, 1998;Build 11
"RTN","RAO7PC2",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","RAO7PC2",4,0)
 ;Supported IA #1571 ^LEX(757.01
"RTN","RAO7PC2",5,0)
 ;Supported IA #10104 UP^XLFSTR
"RTN","RAO7PC2",6,0)
 ;Supported IA #2055 EXTERNAL^DILFD
"RTN","RAO7PC2",7,0)
 ;Supported IA #10060 ^VA(200
"RTN","RAO7PC2",8,0)
CASE(Y) ; Retrieve exam data for specified inverse exam date range.
"RTN","RAO7PC2",9,0)
 ; 'Y'-> Exam node IEN
"RTN","RAO7PC2",10,0)
 N RABNOR,RACNT,RAEXAM,RAI,RAIMPRES,RAINCLUD,RAOPRC,RAORD,RAPDIAG
"RTN","RAO7PC2",11,0)
 N RAPIST,RAPIRE,RAPROC,RARDE,RADTI,RACNI,RADUPHX,RAREASDY
"RTN","RAO7PC2",12,0)
 N RARPT,RARPTST,RARPTXT,RASBN,RASDIAG,RAVER,RAERRFLG,Z,Z1,Z2,RATMP
"RTN","RAO7PC2",13,0)
 S RACNT=1
"RTN","RAO7PC2",14,0)
 S RAEXAM(0)=$G(^RADPT(RADFN,"DT",RAINVXDT,"P",Y,0)) Q:RAEXAM(0)']""
"RTN","RAO7PC2",15,0)
 S:$P(RAEXAM(0),"^",25)=2 RAPSET=1
"RTN","RAO7PC2",16,0)
 S:RAPSET=1 ^TMP($J,"RAE2",RADFN,"PRINT_SET")="" ; xam set with same rpt
"RTN","RAO7PC2",17,0)
 S RAPROC(0)=$G(^RAMIS(71,+$P(RAEXAM(0),"^",2),0))
"RTN","RAO7PC2",18,0)
 S RAPROC=$S($P(RAPROC(0),"^")]"":$P(RAPROC(0),"^"),1:"Unknown")
"RTN","RAO7PC2",19,0)
 S RAORD(0)=$G(^RAO(75.1,+$P(RAEXAM(0),"^",11),0))
"RTN","RAO7PC2",20,0)
 S RAORD(7)=$P(RAORD(0),"^",7) ; CPRS order ien
"RTN","RAO7PC2",21,0)
 S RAREASDY=$P($G(^RAO(75.1,+$P(RAEXAM(0),"^",11),.1)),"^") ;REASON FOR STUDY
"RTN","RAO7PC2",22,0)
 S RAOPRC(0)=$G(^RAMIS(71,+$P(RAORD(0),"^",2),0))
"RTN","RAO7PC2",23,0)
 S RAOPRC=$S($P(RAOPRC(0),"^")]"":$P(RAOPRC(0),"^"),1:"Unknown")
"RTN","RAO7PC2",24,0)
 S RAPDIAG(0)=$G(^RA(78.3,+$P(RAEXAM(0),"^",13),0))
"RTN","RAO7PC2",25,0)
 S RATMP=$$GET1^DIQ(757.01,$P($G(^RA(78.3,+$P(RAEXAM(0),U,13),0)),U,6),.01)
"RTN","RAO7PC2",26,0)
 S RAPDIAG=$P(RAPDIAG(0),"^")_$S(RATMP="":"",1:" ("_RATMP_")")
"RTN","RAO7PC2",27,0)
 S RARPT=+$P(RAEXAM(0),"^",17)
"RTN","RAO7PC2",28,0)
 ; RARPTST="NO REPORT" if no ^RARPT(ien) OR no data for Report Status
"RTN","RAO7PC2",29,0)
 S RARPT(0)=$G(^RARPT(RARPT,0)),RARPTST=$$UL^RAO7PC1A($$RSTAT^RAO7PC1A())
"RTN","RAO7PC2",30,0)
 ; set the following flag variable: RAINCLUD
"RTN","RAO7PC2",31,0)
 ; RAINCLUD=1 includes V, R, EF <-- patch 95
"RTN","RAO7PC2",32,0)
 S RAINCLUD=$S("RVE"[$E(RARPTST):1,1:0)
"RTN","RAO7PC2",33,0)
 I $E(RARPTST)="V",(RAPSET'<0) D
"RTN","RAO7PC2",34,0)
 . S RAVER=$P(RARPT(0),"^",9),RASBN=$P($G(^VA(200,+RAVER,20)),"^",2)
"RTN","RAO7PC2",35,0)
 . S ^TMP($J,"RAE2",RADFN,Y,RAPROC,"V")=RAVER_"^"_RASBN
"RTN","RAO7PC2",36,0)
 . Q
"RTN","RAO7PC2",37,0)
 S RABNOR=$$UP^XLFSTR($P(RAPDIAG(0),"^",4)) S:RABNOR'="Y" RABNOR=""
"RTN","RAO7PC2",38,0)
 I RAPDIAG]"",(RAINCLUD),(RAPSET'<0) D  ; if diag & verif'd or released/unverif'd & first pass if part of xam set (many xams - one rpt)
"RTN","RAO7PC2",39,0)
 . S ^TMP($J,"RAE2",RADFN,Y,RAPROC,"D",RACNT)=RAPDIAG
"RTN","RAO7PC2",40,0)
 . Q
"RTN","RAO7PC2",41,0)
 S ^TMP($J,"RAE2",RADFN,Y,RAPROC,"RFS")=RAREASDY ;REASON FOR STUDY
"RTN","RAO7PC2",42,0)
 ; 1st, get clnhist from file70. 2nd, get addl clnhist form file74
"RTN","RAO7PC2",43,0)
 ; 1st:
"RTN","RAO7PC2",44,0)
 I +$O(^RADPT(RADFN,"DT",RAINVXDT,"P",Y,"H",0)) D
"RTN","RAO7PC2",45,0)
 . N RAI S (RAI,Z)=0
"RTN","RAO7PC2",46,0)
 . F  S Z=$O(^RADPT(RADFN,"DT",RAINVXDT,"P",Y,"H",Z)) Q:Z'>0  D
"RTN","RAO7PC2",47,0)
 .. S RAI=RAI+1
"RTN","RAO7PC2",48,0)
 .. S ^TMP($J,"RAE2",RADFN,Y,RAPROC,"H",RAI)=$G(^RADPT(RADFN,"DT",RAINVXDT,"P",Y,"H",Z,0))
"RTN","RAO7PC2",49,0)
 .. Q
"RTN","RAO7PC2",50,0)
 . Q
"RTN","RAO7PC2",51,0)
 ;2nd:
"RTN","RAO7PC2",52,0)
 S RADTI=RAINVXDT,RACNI=Y D CHKDUPHX^RART1 ;chk if file74 clnhist is dupl
"RTN","RAO7PC2",53,0)
 I 'RADUPHX,$O(^RARPT(RARPT,"H",0)) S Z="H" D RPTXT(RARPT,Z)
"RTN","RAO7PC2",54,0)
 ;
"RTN","RAO7PC2",55,0)
 I +$O(^RADPT(RADFN,"DT",RAINVXDT,"P",Y,"M",0)) D  ; save modifiers
"RTN","RAO7PC2",56,0)
 . N RAI S (RAI,Z)=0
"RTN","RAO7PC2",57,0)
 . F  S Z=$O(^RADPT(RADFN,"DT",RAINVXDT,"P",Y,"M",Z)) Q:Z'>0  D
"RTN","RAO7PC2",58,0)
 .. S RAI=RAI+1
"RTN","RAO7PC2",59,0)
 .. S ^TMP($J,"RAE2",RADFN,Y,RAPROC,"M",RAI)=$P($G(^RAMIS(71.2,+$G(^RADPT(RADFN,"DT",RAINVXDT,"P",Y,"M",Z,0)),0)),"^")
"RTN","RAO7PC2",60,0)
 .. Q
"RTN","RAO7PC2",61,0)
 . Q
"RTN","RAO7PC2",62,0)
 I +$O(^RADPT(RADFN,"DT",RAINVXDT,"P",Y,"DX",0)),(RAPSET'<0) D
"RTN","RAO7PC2",63,0)
 . S Z=0 F  S Z=$O(^RADPT(RADFN,"DT",RAINVXDT,"P",Y,"DX",Z)) Q:Z'>0  D
"RTN","RAO7PC2",64,0)
 .. S RASDIAG=+$G(^RADPT(RADFN,"DT",RAINVXDT,"P",Y,"DX",Z,0))
"RTN","RAO7PC2",65,0)
 .. S RASDIAG(0)=$G(^RA(78.3,RASDIAG,0))
"RTN","RAO7PC2",66,0)
 .. S RATMP=$$GET1^DIQ(757.01,$P($G(^RA(78.3,+RASDIAG,0)),U,6),.01)
"RTN","RAO7PC2",67,0)
 .. S RASDIAG(1)=$P(RASDIAG(0),"^")_$S(RATMP="":"",1:" ("_RATMP_")")
"RTN","RAO7PC2",68,0)
 .. I RASDIAG(1)]"",(RAINCLUD) D
"RTN","RAO7PC2",69,0)
 ... S RACNT=RACNT+1,^TMP($J,"RAE2",RADFN,Y,RAPROC,"D",RACNT)=RASDIAG(1)
"RTN","RAO7PC2",70,0)
 ... I RABNOR'="Y" D
"RTN","RAO7PC2",71,0)
 .... S RABNOR=$$UP^XLFSTR($P(RASDIAG(0),"^",4)) S:RABNOR'="Y" RABNOR=""
"RTN","RAO7PC2",72,0)
 .... Q
"RTN","RAO7PC2",73,0)
 ... Q
"RTN","RAO7PC2",74,0)
 .. Q
"RTN","RAO7PC2",75,0)
 . Q
"RTN","RAO7PC2",76,0)
 I RAINCLUD,(RAPSET'<0) D
"RTN","RAO7PC2",77,0)
 . I +$O(^RARPT(RARPT,"I",0)) S Z="I" D RPTXT(RARPT,Z)
"RTN","RAO7PC2",78,0)
 . I +$O(^RARPT(RARPT,"R",0)) S Z="R" D RPTXT(RARPT,Z)
"RTN","RAO7PC2",79,0)
 . Q
"RTN","RAO7PC2",80,0)
 I $P(RAEXAM(0),"^",25) S ^TMP($J,"RAE2",RADFN,"ORD")=RAOPRC
"RTN","RAO7PC2",81,0)
 I '$P(RAEXAM(0),"^",25) S ^TMP($J,"RAE2",RADFN,"ORD",Y)=RAOPRC
"RTN","RAO7PC2",82,0)
 ;
"RTN","RAO7PC2",83,0)
 ; Check to see if amended report
"RTN","RAO7PC2",84,0)
 I RAPSET'<0,+$O(^RARPT(RARPT,"ERR",0)) S RAERRFLG="A"
"RTN","RAO7PC2",85,0)
 ;
"RTN","RAO7PC2",86,0)
 S:RAPSET'<0 ^TMP($J,"RAE2",RADFN,Y,RAPROC)=RARPTST_"^"_$G(RABNOR)_"^"_$G(RAORD(7))_"^"_$G(RAERRFLG)
"RTN","RAO7PC2",87,0)
 S:RAPSET<0 ^TMP($J,"RAE2",RADFN,Y,RAPROC)=""
"RTN","RAO7PC2",88,0)
 S:RAPSET=1 RAPSET=-1
"RTN","RAO7PC2",89,0)
 ; Patch RA*5.0*143 Add datetime subscript for use in RAORD61
"RTN","RAO7PC2",90,0)
 S ^TMP($J,"RAE2",RADFN,Y,RAPROC,"DTI",RAINVXDT)=""
"RTN","RAO7PC2",91,0)
 ;
"RTN","RAO7PC2",92,0)
 I RARPTST'="No Report" D
"RTN","RAO7PC2",93,0)
 .; Add Prim Int Staff, Prim Int Resident & Reported Date
"RTN","RAO7PC2",94,0)
 .S RAPIST=$P(RAEXAM(0),"^",15)
"RTN","RAO7PC2",95,0)
 .S RAPIRE=$P(RAEXAM(0),"^",12)
"RTN","RAO7PC2",96,0)
 .S RARDE=$P(RARPT(0),"^",8)
"RTN","RAO7PC2",97,0)
 .S ^TMP($J,"RAE2",RADFN,Y,RAPROC,"P")=RAPIST_"^"_RAPIRE_"^"_RARDE
"RTN","RAO7PC2",98,0)
 ;If contrast media was involved in the exam pass that information.
"RTN","RAO7PC2",99,0)
 I +$O(^RADPT(RADFN,"DT",RAINVXDT,"P",Y,"CM",0)) S (RACNT,RAI)=0 D
"RTN","RAO7PC2",100,0)
 .F  S RAI=$O(^RADPT(RADFN,"DT",RAINVXDT,"P",Y,"CM",RAI)) Q:'RAI  D
"RTN","RAO7PC2",101,0)
 ..S RACNT=RACNT+1
"RTN","RAO7PC2",102,0)
 ..S RAI(0)=$G(^RADPT(RADFN,"DT",RAINVXDT,"P",Y,"CM",RAI,0))
"RTN","RAO7PC2",103,0)
 ..S ^TMP($J,"RAE2",RADFN,Y,RAPROC,"CM",RACNT)=$P(RAI(0),U)_"^"_$$EXTERNAL^DILFD(70.3225,.01,"",$P(RAI(0),U))
"RTN","RAO7PC2",104,0)
 ..Q
"RTN","RAO7PC2",105,0)
 Q
"RTN","RAO7PC2",106,0)
 ;
"RTN","RAO7PC2",107,0)
RPTXT(RARPT,Z) ; Retrieve report text & store in ^TMP
"RTN","RAO7PC2",108,0)
 ; 'RARPT' -> Report IEN
"RTN","RAO7PC2",109,0)
 ; 'Z'     -> "I":Impression Text <> "R":Report Text
"RTN","RAO7PC2",110,0)
 S (Z1,Z2)=0
"RTN","RAO7PC2",111,0)
 ;file 74's "H" nodes are now additional clinical history
"RTN","RAO7PC2",112,0)
 I Z="H" S Z2=$O(^TMP($J,"RAE2",RADFN,Y,RAPROC,Z,""),-1) I $O(^RARPT(RARPT,Z,Z1)) S Z2=Z2+1,^TMP($J,"RAE2",RADFN,Y,RAPROC,Z,Z2)="Additional Clinical History:"
"RTN","RAO7PC2",113,0)
 F  S Z1=$O(^RARPT(RARPT,Z,Z1)) Q:Z1'>0  D
"RTN","RAO7PC2",114,0)
 . S Z1(0)=$G(^RARPT(RARPT,Z,Z1,0)),Z2=Z2+1
"RTN","RAO7PC2",115,0)
 . S ^TMP($J,"RAE2",RADFN,Y,RAPROC,Z,Z2)=Z1(0)
"RTN","RAO7PC2",116,0)
 . Q
"RTN","RAO7PC2",117,0)
 Q
"RTN","RAO7PC2",118,0)
 ;
"RTN","RAO7PC2",119,0)
CLIN(DFN,PROCLIST) ;Radiology and Clinical Reminders API
"RTN","RAO7PC2",120,0)
 ;
"RTN","RAO7PC2",121,0)
 ; Created by Cameron Taylor March 1999
"RTN","RAO7PC2",122,0)
 ; 
"RTN","RAO7PC2",123,0)
 ; This API recieves a patient and a list of procedures. For each 
"RTN","RAO7PC2",124,0)
 ; Procedure, the details of the last 'complete' procedure and/or the
"RTN","RAO7PC2",125,0)
 ; last 'cancelled' & 'in progress' procedure details and returns them 
"RTN","RAO7PC2",126,0)
 ; in ^TMP($J,"RADPROC"
"RTN","RAO7PC2",127,0)
 N XX,PROC,DATE,STATUS,PROVIDER,EXAM,X,Y,EXAMIEN,RADPTIEN,ORDER,SUCCESS
"RTN","RAO7PC2",128,0)
 ; 
"RTN","RAO7PC2",129,0)
 S DFN=$G(DFN)  ; Patient Name
"RTN","RAO7PC2",130,0)
 S PROCLIST=$G(PROCLIST)  ; List of Procedures (separated by '^')
"RTN","RAO7PC2",131,0)
 K ^TMP($J,"RADPROC")
"RTN","RAO7PC2",132,0)
 ;
"RTN","RAO7PC2",133,0)
 S RADPTIEN=$O(^RADPT("B",DFN,""))
"RTN","RAO7PC2",134,0)
 I (RADPTIEN="")!(RADPTIEN=0) D  Q
"RTN","RAO7PC2",135,0)
 .S ^TMP($J,"RADPROC")="Invalid/Unknown Radiology Patient"
"RTN","RAO7PC2",136,0)
 ;
"RTN","RAO7PC2",137,0)
 F XX=1:1 S PROC=$P(PROCLIST,U,XX) Q:PROC=""  D
"RTN","RAO7PC2",138,0)
 .S SUCCESS=0  ; Quit searching if SUCCESS=3 (comp, canc & in prog)
"RTN","RAO7PC2",139,0)
 .S DATE=0 F  S DATE=$O(^RADPT(RADPTIEN,"DT",DATE)) Q:DATE'?7N1".".N!(SUCCESS=3)  D
"RTN","RAO7PC2",140,0)
 ..S EXAMIEN=0 F  S EXAMIEN=$O(^RADPT(RADPTIEN,"DT",DATE,"P",EXAMIEN)) Q:'EXAMIEN!(SUCCESS=3)  D
"RTN","RAO7PC2",141,0)
 ...S EXAM=$G(^RADPT(RADPTIEN,"DT",DATE,"P",EXAMIEN,0))
"RTN","RAO7PC2",142,0)
 ...Q:$P(EXAM,U,2)'=PROC
"RTN","RAO7PC2",143,0)
 ...;
"RTN","RAO7PC2",144,0)
 ...; Continue, get STATUS and ORDER 
"RTN","RAO7PC2",145,0)
 ...; (0 is cancelled, 1-8 in progress & 9 is COMPLETE)
"RTN","RAO7PC2",146,0)
 ...; (ignore if null)
"RTN","RAO7PC2",147,0)
 ...;
"RTN","RAO7PC2",148,0)
 ...S STATUS=$P(EXAM,U,3)
"RTN","RAO7PC2",149,0)
 ...I STATUS'="" D
"RTN","RAO7PC2",150,0)
 ....S ORDER=$P(^RA(72,STATUS,0),U,3)
"RTN","RAO7PC2",151,0)
 ....S STATUS=$P(^RA(72,STATUS,0),U) ; description
"RTN","RAO7PC2",152,0)
 ...; 
"RTN","RAO7PC2",153,0)
 ...; Only one of each type (ORDER)
"RTN","RAO7PC2",154,0)
 ...;
"RTN","RAO7PC2",155,0)
 ...Q:ORDER=""
"RTN","RAO7PC2",156,0)
 ...I ORDER=0 Q:$D(^TMP($J,"RADPROC",RADPTIEN,PROC,"CANCELLED"))  S ORDER="CANCELLED"
"RTN","RAO7PC2",157,0)
 ...I ORDER=9 Q:$D(^TMP($J,"RADPROC",RADPTIEN,PROC,"COMPLETE"))  S ORDER="COMPLETE"
"RTN","RAO7PC2",158,0)
 ...I ORDER<9,ORDER>0 Q:$D(^TMP($J,"RADPROC",RADPTIEN,PROC,"IN PROGRESS"))  S ORDER="IN PROGRESS"
"RTN","RAO7PC2",159,0)
 ...;
"RTN","RAO7PC2",160,0)
 ...; Now for the PROVIDER. Check PRIMARY INTERPRETING STAFF 
"RTN","RAO7PC2",161,0)
 ...; if none, then default to PRIMARY INTERPRETING RESIDENT.
"RTN","RAO7PC2",162,0)
 ...;
"RTN","RAO7PC2",163,0)
 ...S PROVIDER=$P(EXAM,U,15)
"RTN","RAO7PC2",164,0)
 ...S:PROVIDER="" PROVIDER=$P(EXAM,U,12)
"RTN","RAO7PC2",165,0)
 ...S:PROVIDER'="" PROVIDER=$P($G(^VA(200,PROVIDER,0)),U,1) ; description
"RTN","RAO7PC2",166,0)
 ...;
"RTN","RAO7PC2",167,0)
 ...; Create return info. on ^TMP (1st manipulate DATE)
"RTN","RAO7PC2",168,0)
 ...;
"RTN","RAO7PC2",169,0)
 ...S Y=9999999.9999-DATE
"RTN","RAO7PC2",170,0)
 ...S ^TMP($J,"RADPROC",RADPTIEN,PROC,ORDER)=Y_U_STATUS_U_PROVIDER
"RTN","RAO7PC2",171,0)
 ...S SUCCESS=SUCCESS+1
"RTN","RAO7PC2",172,0)
 .;
"RTN","RAO7PC2",173,0)
 .; Finished searching Patient file. Any Procedures with no activity?
"RTN","RAO7PC2",174,0)
 .;
"RTN","RAO7PC2",175,0)
 .I '$D(^TMP($J,"RADPROC",RADPTIEN,PROC)) S ^TMP($J,"RADPROC",RADPTIEN,PROC,"NONE")=""
"RTN","RAO7PC2",176,0)
 Q
"RTN","RAO7PC2",177,0)
 ;
"RTN","RAORD61")
0^1^B8063377^B7261744
"RTN","RAORD61",1,0)
RAORD61 ;HISC/GJC-Print A Request Cont. ;2/2/98  15:28
"RTN","RAORD61",2,0)
 ;;5.0;Radiology/Nuclear Medicine;**45,68,47,123,143**;Mar 16, 1998;Build 11
"RTN","RAORD61",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","RAORD61",4,0)
 ;11/18/05 KAM Remedy Call 100930 Remove extra dash lines
"RTN","RAORD61",5,0)
 ; 5-P123 6/23/2015 MJT RA*5*123 NSR 20140507 print weight & date taken in Radiology requests
"RTN","RAORD61",6,0)
 ;
"RTN","RAORD61",7,0)
TC ;technologist information & comment (called from RAORD6)
"RTN","RAORD61",8,0)
 ;*143 add RAEXST & RADTP
"RTN","RAORD61",9,0)
 N RA18FL,RA18ARR,RA18EX,RA18CNI,RA18DTI,RA18PRC,RA18ND,RA18TC,RAEXST,RADTP S RA18EX=0,RA18CNI=0
"RTN","RAORD61",10,0)
 ;11/18/05 KAM Modified next line - was G:RA18DTI="" DASHLN^RAORD6
"RTN","RAORD61",11,0)
 ; RA*5*143 - FIX FOR EXAMS AND EXAM SETS ORDERED IN ARREARS
"RTN","RAORD61",12,0)
 ;S RA18DTI=$O(^RADPT("AO",RAOIFN,RADFN,0)) Q:RA18DTI=""
"RTN","RAORD61",13,0)
 F  S RA18CNI=$O(^TMP($J,"RAE2",RADFN,RA18CNI)) Q:+RA18CNI=0  D  Q:RAX["^"
"RTN","RAORD61",14,0)
 . S RA18PRC=""
"RTN","RAORD61",15,0)
 . F  S RA18PRC=$O(^TMP($J,"RAE2",RADFN,RA18CNI,RA18PRC)) Q:RA18PRC=""  D  Q:RAX["^"
"RTN","RAORD61",16,0)
 .. S RA18DTI=0 F  S RA18DTI=$O(^TMP($J,"RAE2",RADFN,RA18CNI,RA18PRC,"DTI",RA18DTI)) Q:'RA18DTI  D
"RTN","RAORD61",17,0)
 ... ;case info
"RTN","RAORD61",18,0)
 ... I $$USESSAN^RAHLRU1() W !,"Case No: "_$P($G(^RADPT(RADFN,"DT",RA18DTI,"P",RA18CNI,0)),"^",31),!
"RTN","RAORD61",19,0)
 ... I '$$USESSAN^RAHLRU1() W !,"Case No: "_$P($G(^RADPT(RADFN,"DT",RA18DTI,"P",RA18CNI,0)),"^")
"RTN","RAORD61",20,0)
 ... S RA18FL=0,RA18ARR("FT")=""
"RTN","RAORD61",21,0)
 ... S RA18TC=0 F  S RA18TC=$O(^RADPT(RADFN,"DT",RA18DTI,"P",RA18CNI,"F",RA18TC)) Q:RA18TC=""  S RA18ARR("F")=$G(^RADPT(RADFN,"DT",RA18DTI,"P",RA18CNI,"F",RA18TC,0),0) D  Q:$L(RA18ARR("FT"))>32
"RTN","RAORD61",22,0)
 .... I RA18ARR("F")'=0 S RA18ARR("FT")=RA18ARR("FT")_$P($G(RA18ARR("F")),"^",2)_"-"_$P($G(^RA(78.4,$P($G(RA18ARR("F")),"^",1),0)),"^",1)_";"
"RTN","RAORD61",23,0)
 ... S RA18TC=0 F  S RA18TC=$O(^RADPT(RADFN,"DT",RA18DTI,"P",RA18CNI,"TC",RA18TC)) Q:RA18TC=""  S RA18ARR("T",RA18TC,0)=$G(^RADPT(RADFN,"DT",RA18DTI,"P",RA18CNI,"TC",RA18TC,0),0) D
"RTN","RAORD61",24,0)
 .... I RA18ARR("T",RA18TC,0)'=0 W:RA18FL>0 ! W ?14,"Tech: " I RA18ARR("T",RA18TC,0)'="" S RA18ARR("N")=$$GET1^DIQ(200,RA18ARR("T",RA18TC,0),.01) W $E($P(RA18ARR("N"),"^",1),1,18)
"RTN","RAORD61",25,0)
 .... W:(RA18FL'>0) ?38," Film: "_$E(RA18ARR("FT"),1,32)
"RTN","RAORD61",26,0)
 .... S RA18FL=RA18FL+1
"RTN","RAORD61",27,0)
 ... I '$D(RA18ARR("T")) W ?14,"Tech: ",?38," Film: "_$E(RA18ARR("FT"),1,32)
"RTN","RAORD61",28,0)
 ... K RA18ARR("T"),RA18ARR("F"),RA18ARR("N")
"RTN","RAORD61",29,0)
 ... I $O(^TMP($J,"RAE2",RADFN,RA18CNI,RA18PRC,"TCOM",0))>0 D  Q
"RTN","RAORD61",30,0)
 .... ;tech comm
"RTN","RAORD61",31,0)
 .... W !
"RTN","RAORD61",32,0)
 .... S RA18EX=$$TXTOUT^RAUTL11(^TMP($J,"RAE2",RADFN,RA18CNI,RA18PRC,"TCOM",1),1,70,-1,"",4,1,1,1)
"RTN","RAORD61",33,0)
 .... D HD^RAORD6:($Y+10)>IOSL   ; 5-P123
"RTN","RAORD61",34,0)
 Q
"VER")
8.0^22.2
"BLD",10407,6)
^128
**END**
**END**

