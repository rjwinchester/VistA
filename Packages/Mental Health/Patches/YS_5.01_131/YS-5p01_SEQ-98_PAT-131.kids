Released YS*5.01*131 SEQ #98
Extracted from mail message
**KIDS**:YS*5.01*131^

**INSTALL NAME**
YS*5.01*131
"BLD",10597,0)
YS*5.01*131^MENTAL HEALTH^0^3170608^y
"BLD",10597,1,0)
^^2^2^3170608^
"BLD",10597,1,1,0)
PATCH YS*5.01*131 ADDRESSES THE FOLLOWING:
"BLD",10597,1,2,0)
1. R14616270FY17 - CIWA question number 11 for headache not totaling.
"BLD",10597,4,0)
^9.64PA^^
"BLD",10597,6)
1^
"BLD",10597,6.3)
2
"BLD",10597,"ABPKG")
n
"BLD",10597,"INIT")
EN^YSZ131
"BLD",10597,"KRN",0)
^9.67PA^779.2^20
"BLD",10597,"KRN",.4,0)
.4
"BLD",10597,"KRN",.401,0)
.401
"BLD",10597,"KRN",.402,0)
.402
"BLD",10597,"KRN",.403,0)
.403
"BLD",10597,"KRN",.5,0)
.5
"BLD",10597,"KRN",.84,0)
.84
"BLD",10597,"KRN",3.6,0)
3.6
"BLD",10597,"KRN",3.8,0)
3.8
"BLD",10597,"KRN",9.2,0)
9.2
"BLD",10597,"KRN",9.8,0)
9.8
"BLD",10597,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",10597,"KRN",9.8,"NM",1,0)
YSZ131^^0^B12913728
"BLD",10597,"KRN",9.8,"NM","B","YSZ131",1)

"BLD",10597,"KRN",19,0)
19
"BLD",10597,"KRN",19.1,0)
19.1
"BLD",10597,"KRN",101,0)
101
"BLD",10597,"KRN",409.61,0)
409.61
"BLD",10597,"KRN",771,0)
771
"BLD",10597,"KRN",779.2,0)
779.2
"BLD",10597,"KRN",870,0)
870
"BLD",10597,"KRN",8989.51,0)
8989.51
"BLD",10597,"KRN",8989.52,0)
8989.52
"BLD",10597,"KRN",8994,0)
8994
"BLD",10597,"KRN","B",.4,.4)

"BLD",10597,"KRN","B",.401,.401)

"BLD",10597,"KRN","B",.402,.402)

"BLD",10597,"KRN","B",.403,.403)

"BLD",10597,"KRN","B",.5,.5)

"BLD",10597,"KRN","B",.84,.84)

"BLD",10597,"KRN","B",3.6,3.6)

"BLD",10597,"KRN","B",3.8,3.8)

"BLD",10597,"KRN","B",9.2,9.2)

"BLD",10597,"KRN","B",9.8,9.8)

"BLD",10597,"KRN","B",19,19)

"BLD",10597,"KRN","B",19.1,19.1)

"BLD",10597,"KRN","B",101,101)

"BLD",10597,"KRN","B",409.61,409.61)

"BLD",10597,"KRN","B",771,771)

"BLD",10597,"KRN","B",779.2,779.2)

"BLD",10597,"KRN","B",870,870)

"BLD",10597,"KRN","B",8989.51,8989.51)

"BLD",10597,"KRN","B",8989.52,8989.52)

"BLD",10597,"KRN","B",8994,8994)

"BLD",10597,"QUES",0)
^9.62^^
"BLD",10597,"REQB",0)
^9.611^^
"INIT")
EN^YSZ131
"MBREQ")
0
"PKG",159,-1)
1^1
"PKG",159,0)
MENTAL HEALTH^YS^Version 5.01 of Mental Health
"PKG",159,20,0)
^9.402P^^
"PKG",159,22,0)
^9.49I^1^1
"PKG",159,22,1,0)
5.01^2941230^2950325
"PKG",159,22,1,"PAH",1,0)
131^3170608^33308
"PKG",159,22,1,"PAH",1,1,0)
^^2^2^3170608
"PKG",159,22,1,"PAH",1,1,1,0)
PATCH YS*5.01*131 ADDRESSES THE FOLLOWING:
"PKG",159,22,1,"PAH",1,1,2,0)
1. R14616270FY17 - CIWA question number 11 for headache not totaling.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","YSZ131")
0^1^B12913728^n/a
"RTN","YSZ131",1,0)
YSZ131 ;SLC/GDU - PATCH YS*5.01*113 CODE; 3/24/14 15:32
"RTN","YSZ131",2,0)
 ;;5.01;MENTAL HEALTH;**131**;Dec 30, 1994;Build 2
"RTN","YSZ131",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified
"RTN","YSZ131",4,0)
 ;Data Base Integration Agreement LIST
"RTN","YSZ131",5,0)
 ; EN^DDIOL            DBIA # 10142
"RTN","YSZ131",6,0)
 ; $$FIND1^DIC         DBIA # 2051
"RTN","YSZ131",7,0)
 ; FILE^DIE            DBIA # 2053
"RTN","YSZ131",8,0)
 ; GETS^DIQ            DBIA # 2056
"RTN","YSZ131",9,0)
 ; $$REPEAT^XLFSTR     DBIA # 10104
"RTN","YSZ131",10,0)
 ; ^XMD                DBIA # 10070
"RTN","YSZ131",11,0)
 ;Routine is to be called by entry point
"RTN","YSZ131",12,0)
 Q
"RTN","YSZ131",13,0)
 Q
"RTN","YSZ131",14,0)
EN ;Entry point
"RTN","YSZ131",15,0)
 D EN1,SMM,KYSV
"RTN","YSZ131",16,0)
 K YSCNT,YSFILE,YSMAIL,YSWAIT
"RTN","YSZ131",17,0)
 Q
"RTN","YSZ131",18,0)
EN1 ;R14616270FY17 - CIWA question number 11 for headache not totaling.
"RTN","YSZ131",19,0)
 S YSCNT=0,YSWAIT=1,YSFILE=601.91
"RTN","YSZ131",20,0)
 S YSMSG(1)="Patch YS*5.01*131 Installation Messages",YSMSG(1,"F")="!"
"RTN","YSZ131",21,0)
 S YSMSG(2)="R14616270FY17 - CIWA question number 11 for headache not totaling.",YSMSG(2,"F")="!"
"RTN","YSZ131",22,0)
 S YSMSG(3)="MH SCORING KEY records #6189 and #9587 have Target fields with an incorrect",YSMSG(3,"F")="!"
"RTN","YSZ131",23,0)
 S YSMSG(4)="value of 'Very Severe'. These records will be corrected with 'Very severe'.",YSMSG(4,"F")="!"
"RTN","YSZ131",24,0)
 D UM
"RTN","YSZ131",25,0)
 F YSIEN=6189,9587 D
"RTN","YSZ131",26,0)
 . S YSIENS=YSIEN_","
"RTN","YSZ131",27,0)
 . D GR I $D(YSFLD)=0 Q
"RTN","YSZ131",28,0)
 . ;If the value is already corrected, alert user and quit loop
"RTN","YSZ131",29,0)
 . I YSFLD(.01)=6189,YSFLD(3)="Very severe" D VAC,UM Q
"RTN","YSZ131",30,0)
 . I YSFLD(.01)=9587,YSFLD(3)="Very severe" D VAC,UM Q
"RTN","YSZ131",31,0)
 . ;Correct the value
"RTN","YSZ131",32,0)
 . I YSFLD(.01)=6189 S YSFDA(YSFILE,YSIENS,3)="Very severe" D VIC,FILE^DIE("","YSFDA","YSERR")
"RTN","YSZ131",33,0)
 . I YSFLD(.01)=9587 S YSFDA(YSFILE,YSIENS,3)="Very severe" D VIC,FILE^DIE("","YSFDA","YSERR")
"RTN","YSZ131",34,0)
 . I $D(YSERR) S YSERL=6 D PEM
"RTN","YSZ131",35,0)
 . D UM
"RTN","YSZ131",36,0)
 . K YSIENS,YSERR,YSFDA
"RTN","YSZ131",37,0)
 D KYSV
"RTN","YSZ131",38,0)
 Q
"RTN","YSZ131",39,0)
 ;
"RTN","YSZ131",40,0)
VAC ;Value Already Correct
"RTN","YSZ131",41,0)
 S YSMSG(5.1)="Value is already correct."
"RTN","YSZ131",42,0)
 S YSMSG(5.1,"F")="!?8"
"RTN","YSZ131",43,0)
 Q
"RTN","YSZ131",44,0)
 ;
"RTN","YSZ131",45,0)
VIC ;Value Is Corrected
"RTN","YSZ131",46,0)
 S YSMSG(5.1)="Value will be set to the correct value of "_YSFDA(YSFILE,YSIENS,3)
"RTN","YSZ131",47,0)
 S YSMSG(5.1,"F")="!?8"
"RTN","YSZ131",48,0)
 Q
"RTN","YSZ131",49,0)
 ;
"RTN","YSZ131",50,0)
GR ;Get Record
"RTN","YSZ131",51,0)
 I YSIEN="" Q
"RTN","YSZ131",52,0)
 K YSFLD
"RTN","YSZ131",53,0)
 D GETS^DIQ(YSFILE,YSIENS,"*","","YSREC","YSERR")
"RTN","YSZ131",54,0)
 I $D(YSERR) D PEM G GRQ
"RTN","YSZ131",55,0)
 M YSFLD=YSREC(YSFILE,YSIENS)
"RTN","YSZ131",56,0)
 S YSMSG(1)="MH SCORING KEY # "_YSFLD(.01)
"RTN","YSZ131",57,0)
 S YSMSG(1,"F")="!"
"RTN","YSZ131",58,0)
 S YSMSG(2)="Target: "_YSFLD(3)
"RTN","YSZ131",59,0)
 S YSMSG(2,"F")="!?4"
"RTN","YSZ131",60,0)
GRQ K YSERR,YSREC
"RTN","YSZ131",61,0)
 Q
"RTN","YSZ131",62,0)
 ;
"RTN","YSZ131",63,0)
PEM ;Process Error Message
"RTN","YSZ131",64,0)
 ;Add Error Text to User Message
"RTN","YSZ131",65,0)
 I '$D(YSERR) Q
"RTN","YSZ131",66,0)
 I '$D(YSERL) S YSERL=1
"RTN","YSZ131",67,0)
 S YSX=$P(YSERR("DIERR"),U)
"RTN","YSZ131",68,0)
 F YSX1=1:1:YSX D
"RTN","YSZ131",69,0)
 . S YSMSG(YSERL)="Error Code: "_YSERR("DIERR",YSX1)
"RTN","YSZ131",70,0)
 . S YSMSG(YSERL,"F")="!"
"RTN","YSZ131",71,0)
 . S YSX2=0
"RTN","YSZ131",72,0)
 . F  S YSX2=$O(YSERR("DIERR",YSX1,"TEXT",YSX2)) Q:YSX2=""  D
"RTN","YSZ131",73,0)
 . . S YSERL=YSERL+YSX2
"RTN","YSZ131",74,0)
 . . S YSMSG(YSERL)=YSERR("DIERR",YSX1,"TEXT",YSX2)
"RTN","YSZ131",75,0)
 . . S YSMSG(YSERL,"F")="!"
"RTN","YSZ131",76,0)
 K YSERL,YSERR,YSX,YSX1,YSX2
"RTN","YSZ131",77,0)
 Q
"RTN","YSZ131",78,0)
 ;
"RTN","YSZ131",79,0)
UM ;User Messages
"RTN","YSZ131",80,0)
 ;Display messages to the user
"RTN","YSZ131",81,0)
 D EN^DDIOL(.YSMSG)
"RTN","YSZ131",82,0)
 ;Build MailMan Message from user messages
"RTN","YSZ131",83,0)
 S YSX=0
"RTN","YSZ131",84,0)
 F   S YSX=$O(YSMSG(YSX)) Q:YSX=""  D
"RTN","YSZ131",85,0)
 . S YSX1=YSMSG(YSX)
"RTN","YSZ131",86,0)
 . I YSMSG(YSX,"F")="!!" S YSCNT=YSCNT+1,YSMAIL(YSCNT)=""
"RTN","YSZ131",87,0)
 . I YSMSG(YSX,"F")["?" D
"RTN","YSZ131",88,0)
 . . S YSX2=$$REPEAT^XLFSTR(" ",$P(YSMSG(YSX,"F"),"?",2))
"RTN","YSZ131",89,0)
 . . S YSX1=YSX2_YSX1
"RTN","YSZ131",90,0)
 . S YSCNT=YSCNT+1
"RTN","YSZ131",91,0)
 . S YSMAIL(YSCNT)=YSX1
"RTN","YSZ131",92,0)
 K YSMSG,YSX,YSX1,YSX2
"RTN","YSZ131",93,0)
 Q
"RTN","YSZ131",94,0)
 ;
"RTN","YSZ131",95,0)
SMM ;Send MailMan message to user
"RTN","YSZ131",96,0)
 N DIFROM,XMDUZ,XMMG,XMSUB,XMTEXT,XMY,XMZ
"RTN","YSZ131",97,0)
 S XMDUZ=.5
"RTN","YSZ131",98,0)
 S XMSUB=YSMAIL(1)
"RTN","YSZ131",99,0)
 S XMY(DUZ)=""
"RTN","YSZ131",100,0)
 S XMTEXT="YSMAIL("
"RTN","YSZ131",101,0)
 D ^XMD
"RTN","YSZ131",102,0)
 I '$D(XMMG) D EN^DDIOL("Report successfully sent.","","!!")
"RTN","YSZ131",103,0)
 Q
"RTN","YSZ131",104,0)
 ;
"RTN","YSZ131",105,0)
KYSV ;Kill YS Variables
"RTN","YSZ131",106,0)
 K YSACI,YSDEX,YSERR,YSFDA,YSFLD,YSFLG,YSIEN
"RTN","YSZ131",107,0)
 K YSIENS,YSML,YSMSG,YSREC,YSSCR,YSVAL
"RTN","YSZ131",108,0)
 Q
"VER")
8.0^22.2
"BLD",10597,6)
^98
**END**
**END**

