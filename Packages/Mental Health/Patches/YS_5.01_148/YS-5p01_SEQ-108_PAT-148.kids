EMERGENCY Released YS*5.01*148 SEQ #108
Extracted from mail message
**KIDS**:YS*5.01*148^

**INSTALL NAME**
YS*5.01*148
"BLD",9481,0)
YS*5.01*148^MENTAL HEALTH^0^3190401^y
"BLD",9481,1,0)
^^2^2^3190329^^^
"BLD",9481,1,1,0)
This patch will rebuild the "AC" indexes in the MH RESULTS (601.92) file
"BLD",9481,1,2,0)
and in the MH ANSWERS (601.85) file.
"BLD",9481,4,0)
^9.64PA^^
"BLD",9481,6.3)
8
"BLD",9481,"INID")
^n
"BLD",9481,"INIT")
POST^YS148PST
"BLD",9481,"KRN",0)
^9.67PA^779.2^20
"BLD",9481,"KRN",.4,0)
.4
"BLD",9481,"KRN",.401,0)
.401
"BLD",9481,"KRN",.402,0)
.402
"BLD",9481,"KRN",.403,0)
.403
"BLD",9481,"KRN",.5,0)
.5
"BLD",9481,"KRN",.84,0)
.84
"BLD",9481,"KRN",3.6,0)
3.6
"BLD",9481,"KRN",3.8,0)
3.8
"BLD",9481,"KRN",9.2,0)
9.2
"BLD",9481,"KRN",9.8,0)
9.8
"BLD",9481,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",9481,"KRN",9.8,"NM",1,0)
YS148IDX^^0^B33200330
"BLD",9481,"KRN",9.8,"NM","B","YS148IDX",1)

"BLD",9481,"KRN",19,0)
19
"BLD",9481,"KRN",19,"NM",0)
^9.68A^1^1
"BLD",9481,"KRN",19,"NM",1,0)
YS123 RE-INDEX MONITOR^^0
"BLD",9481,"KRN",19,"NM","B","YS123 RE-INDEX MONITOR",1)

"BLD",9481,"KRN",19.1,0)
19.1
"BLD",9481,"KRN",101,0)
101
"BLD",9481,"KRN",409.61,0)
409.61
"BLD",9481,"KRN",771,0)
771
"BLD",9481,"KRN",779.2,0)
779.2
"BLD",9481,"KRN",870,0)
870
"BLD",9481,"KRN",870,"NM",0)
^9.68A^^
"BLD",9481,"KRN",8989.51,0)
8989.51
"BLD",9481,"KRN",8989.51,"NM",0)
^9.68A^1^1
"BLD",9481,"KRN",8989.51,"NM",1,0)
YS123 RE-INDEX STATUS^^0
"BLD",9481,"KRN",8989.51,"NM","B","YS123 RE-INDEX STATUS",1)

"BLD",9481,"KRN",8989.52,0)
8989.52
"BLD",9481,"KRN",8989.52,"NM",0)
^9.68A^^
"BLD",9481,"KRN",8994,0)
8994
"BLD",9481,"KRN","B",.4,.4)

"BLD",9481,"KRN","B",.401,.401)

"BLD",9481,"KRN","B",.402,.402)

"BLD",9481,"KRN","B",.403,.403)

"BLD",9481,"KRN","B",.5,.5)

"BLD",9481,"KRN","B",.84,.84)

"BLD",9481,"KRN","B",3.6,3.6)

"BLD",9481,"KRN","B",3.8,3.8)

"BLD",9481,"KRN","B",9.2,9.2)

"BLD",9481,"KRN","B",9.8,9.8)

"BLD",9481,"KRN","B",19,19)

"BLD",9481,"KRN","B",19.1,19.1)

"BLD",9481,"KRN","B",101,101)

"BLD",9481,"KRN","B",409.61,409.61)

"BLD",9481,"KRN","B",771,771)

"BLD",9481,"KRN","B",779.2,779.2)

"BLD",9481,"KRN","B",870,870)

"BLD",9481,"KRN","B",8989.51,8989.51)

"BLD",9481,"KRN","B",8989.52,8989.52)

"BLD",9481,"KRN","B",8994,8994)

"BLD",9481,"QDEF")
^^^^NO^^^^NO^^NO
"BLD",9481,"QUES",0)
^9.62^2^2
"BLD",9481,"QUES",1,0)
POST-Q1
"BLD",9481,"QUES",1,1)
YA^^
"BLD",9481,"QUES",1,"A")
Do you want to SKIP re-indexing MH RESULTS and MH ANSWERS? 
"BLD",9481,"QUES",1,"B")
NO
"BLD",9481,"QUES",1,"Q")
Answer YES to SKIP re-indexing (usually not recommended).
"BLD",9481,"QUES",1,"Q1",0)
^^5^5^3190329^
"BLD",9481,"QUES",1,"Q1",1,0)
Re-indexing runs in the background and can be done with users on the
"BLD",9481,"QUES",1,"Q1",2,0)
system.  If you used Fileman to manually re-index the "AC" indexes of
"BLD",9481,"QUES",1,"Q1",3,0)
the MH RESULTS and MH ANSWERS files after installing YS*5.01*123, you
"BLD",9481,"QUES",1,"Q1",4,0)
may skip re-indexing.  (It does no harm to re-index again, if you are
"BLD",9481,"QUES",1,"Q1",5,0)
uncertain.)
"BLD",9481,"QUES",2,0)
POST-Q2
"BLD",9481,"QUES",2,1)
DA^::FR
"BLD",9481,"QUES",2,"A")
Queue Re-Indexing to Run: 
"BLD",9481,"QUES",2,"B")
NOW
"BLD",9481,"QUES",2,"M")
I XPDQUES("POST-Q1")=1 K DIR
"BLD",9481,"QUES",2,"Q")
Enter the date/time when the re-indexing task should begin.
"BLD",9481,"QUES","B","POST-Q1",1)

"BLD",9481,"QUES","B","POST-Q2",2)

"BLD",9481,"REQB",0)
^9.611^^
"INIT")
POST^YS148PST
"KRN",19,14412,-1)
0^1
"KRN",19,14412,0)
YS123 RE-INDEX MONITOR^YS*5.01*123 Result Indexing Monitor^^R^^^^^^^^MENTAL HEALTH
"KRN",19,14412,1,0)
^19.06^3^3^3190330^^
"KRN",19,14412,1,1,0)
This option displays the status of re-indexing the Mental Health result files.
"KRN",19,14412,1,2,0)
This option is part of YS*5.01*148 -- released to address erroneous nodes in
"KRN",19,14412,1,3,0)
the indexes exposed when YS*5.01*123 was released.
"KRN",19,14412,10.1)
Re-Index YS*5.01*123
"KRN",19,14412,25)
MONITOR^YS148IDX
"KRN",19,14412,"U")
YS*5.01*123 RESULT INDEXING MO
"KRN",8989.51,822,-1)
0^1
"KRN",8989.51,822,0)
YS123 RE-INDEX STATUS^MH Results Re-Indexing^0^^Re-Index Status^0
"KRN",8989.51,822,1)
F^^Enter re-index status text
"KRN",8989.51,822,20,0)
^^2^2^3190330^
"KRN",8989.51,822,20,1,0)
This contains the current status of re-indexing the "AC" index of the
"KRN",8989.51,822,20,2,0)
MH RESULTS and MH ANSWERS files.
"KRN",8989.51,822,30,0)
^8989.513I^1^1
"KRN",8989.51,822,30,1,0)
5^4.2
"MBREQ")
0
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"ORD",20,8989.51)
8989.51;20;;;PAR1E1^XPDTA2;PAR1F1^XPDIA3;PAR1E1^XPDIA3;PAR1F2^XPDIA3;;PAR1DEL^XPDIA3(%)
"ORD",20,8989.51,0)
PARAMETER DEFINITION
"PKG",166,-1)
1^1
"PKG",166,0)
MENTAL HEALTH^YS^Version 5.01 of Mental Health
"PKG",166,20,0)
^9.402P^^
"PKG",166,22,0)
^9.49I^1^1
"PKG",166,22,1,0)
5.01^2941230^2950310
"PKG",166,22,1,"PAH",1,0)
148^3190401
"PKG",166,22,1,"PAH",1,1,0)
^^2^2^3190401
"PKG",166,22,1,"PAH",1,1,1,0)
This patch will rebuild the "AC" indexes in the MH RESULTS (601.92) file
"PKG",166,22,1,"PAH",1,1,2,0)
and in the MH ANSWERS (601.85) file.
"QUES","POST-Q1",0)
YA^^
"QUES","POST-Q1","?")
Answer YES to SKIP re-indexing (usually not recommended).
"QUES","POST-Q1","?",1)
Re-indexing runs in the background and can be done with users on the
"QUES","POST-Q1","?",2)
system.  If you used Fileman to manually re-index the "AC" indexes of
"QUES","POST-Q1","?",3)
the MH RESULTS and MH ANSWERS files after installing YS*5.01*123, you
"QUES","POST-Q1","?",4)
may skip re-indexing.  (It does no harm to re-index again, if you are
"QUES","POST-Q1","?",5)
uncertain.)
"QUES","POST-Q1","A")
Do you want to SKIP re-indexing MH RESULTS and MH ANSWERS? 
"QUES","POST-Q1","B")
NO
"QUES","POST-Q2",0)
DA^::FR
"QUES","POST-Q2","?")
Enter the date/time when the re-indexing task should begin.
"QUES","POST-Q2","A")
Queue Re-Indexing to Run: 
"QUES","POST-Q2","B")
NOW
"QUES","POST-Q2","M")
I XPDQUES("POST-Q1")=1 K DIR
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
2
"RTN","YS148IDX")
0^1^B33200330^n/a
"RTN","YS148IDX",1,0)
YS148IDX ;SLC/KCM - Re-index "AC" in MH RESULTS and MH ANSWERS ; 03/28/2019
"RTN","YS148IDX",2,0)
 ;;5.01;MENTAL HEALTH;**148**;Dec 30, 1994;Build 8
"RTN","YS148IDX",3,0)
 ;
"RTN","YS148IDX",4,0)
REIDX ; Re-indexing Task
"RTN","YS148IDX",5,0)
 N YS148CNT,YS148MSG
"RTN","YS148IDX",6,0)
 S YS148CNT=0
"RTN","YS148IDX",7,0)
 K ^XTMP("YTS-RE-INDEX")
"RTN","YS148IDX",8,0)
 S ^XTMP("YTS-RE-INDEX",0)=$$FMADD^XLFDT(DT,7)_U_DT_U_"MH Re-Index Results"
"RTN","YS148IDX",9,0)
 D UPD("Removing bad nodes from MH RESULTS AC index"),FIX92
"RTN","YS148IDX",10,0)
 D UPD("Removing bad nodes from MH ANSWERS AC index"),FIX85AC
"RTN","YS148IDX",11,0)
 D UPD("Removing bad nodes from MH ANSWERS AD index"),FIX85AD
"RTN","YS148IDX",12,0)
 D UPD("Adding missing nodes to MH RESULTS AC index"),RESET92
"RTN","YS148IDX",13,0)
 D UPD("Adding missing nodes to MH ANSWERS AC index"),RESET85C
"RTN","YS148IDX",14,0)
 D UPD("Adding missing nodes to MH ANSWERS AD index"),RESET85D
"RTN","YS148IDX",15,0)
 S YS148MSG=$$FMTE^XLFDT($$NOW^XLFDT)
"RTN","YS148IDX",16,0)
 S YS148MSG=YS148CNT_" index errors found & resolved on: "_YS148MSG
"RTN","YS148IDX",17,0)
 D UPD(YS148MSG)
"RTN","YS148IDX",18,0)
 D NOTIFY(YS148MSG)
"RTN","YS148IDX",19,0)
 I $D(ZTQUEUED) S ZTREQ="@"
"RTN","YS148IDX",20,0)
 Q
"RTN","YS148IDX",21,0)
 ;
"RTN","YS148IDX",22,0)
 ; -- these tags remove any index nodes that are incorrect
"RTN","YS148IDX",23,0)
 ;
"RTN","YS148IDX",24,0)
FIX85AC ; Remove bad "AC" indexes from MH ANSWERS
"RTN","YS148IDX",25,0)
 N ADMIN,QSTN,IEN,X0
"RTN","YS148IDX",26,0)
 S ADMIN=0 F  S ADMIN=$O(^YTT(601.85,"AC",ADMIN)) Q:'ADMIN  D
"RTN","YS148IDX",27,0)
 . S QSTN=0 F  S QSTN=$O(^YTT(601.85,"AC",ADMIN,QSTN)) Q:'QSTN  D
"RTN","YS148IDX",28,0)
 . . S IEN=0 F  S IEN=$O(^YTT(601.85,"AC",ADMIN,QSTN,IEN)) Q:'IEN  D
"RTN","YS148IDX",29,0)
 . . . ; if IEN doesn't exist, remove index
"RTN","YS148IDX",30,0)
 . . . I '$D(^YTT(601.85,IEN,0)) D RM85AC(ADMIN,QSTN,IEN) QUIT
"RTN","YS148IDX",31,0)
 . . . S X0=$G(^YTT(601.85,IEN,0))
"RTN","YS148IDX",32,0)
 . . . ; if ADMIN doesn't match, remove index
"RTN","YS148IDX",33,0)
 . . . I $P(X0,U,2)'=ADMIN D RM85AC(ADMIN,QSTN,IEN) QUIT
"RTN","YS148IDX",34,0)
 . . . ; if QSTN doesn't match, remove index
"RTN","YS148IDX",35,0)
 . . . I $P(X0,U,3)'=QSTN D RM85AC(ADMIN,QSTN,IEN) QUIT
"RTN","YS148IDX",36,0)
 Q
"RTN","YS148IDX",37,0)
RM85AC(ADMIN,QSTN,IEN) ; remove bad index
"RTN","YS148IDX",38,0)
 K ^YTT(601.85,"AC",ADMIN,QSTN,IEN)
"RTN","YS148IDX",39,0)
 D LOG("85AC",ADMIN,QSTN,IEN)
"RTN","YS148IDX",40,0)
 Q
"RTN","YS148IDX",41,0)
FIX85AD ; Remove bad "AD" indexes from MH ANSWERS
"RTN","YS148IDX",42,0)
 N ADMIN,IEN,X0
"RTN","YS148IDX",43,0)
 S ADMIN=0 F  S ADMIN=$O(^YTT(601.85,"AD",ADMIN)) Q:'ADMIN  D
"RTN","YS148IDX",44,0)
 . S IEN=0 F  S IEN=$O(^YTT(601.85,"AD",ADMIN,IEN)) Q:'IEN  D
"RTN","YS148IDX",45,0)
 . . ; if IEN doesn't exist, remove index
"RTN","YS148IDX",46,0)
 . . I '$D(^YTT(601.85,IEN,0)) D RM85AD(ADMIN,IEN) QUIT
"RTN","YS148IDX",47,0)
 . . S X0=$G(^YTT(601.85,IEN,0))
"RTN","YS148IDX",48,0)
 . . ; if ADMIN doesn't match, remove index
"RTN","YS148IDX",49,0)
 . . I $P(X0,U,2)'=ADMIN D RM85AD(ADMIN,IEN) QUIT
"RTN","YS148IDX",50,0)
 Q
"RTN","YS148IDX",51,0)
RM85AD(ADMIN,IEN) ; remove bad index
"RTN","YS148IDX",52,0)
 K ^YTT(601.85,"AD",ADMIN,IEN)
"RTN","YS148IDX",53,0)
 D LOG("85AD",ADMIN,"",IEN)
"RTN","YS148IDX",54,0)
 Q
"RTN","YS148IDX",55,0)
FIX92 ; Remove bad indexes from MH RESULTS
"RTN","YS148IDX",56,0)
 N ADMIN,IEN
"RTN","YS148IDX",57,0)
 S ADMIN=0 F  S ADMIN=$O(^YTT(601.92,"AC",ADMIN)) Q:'ADMIN  D
"RTN","YS148IDX",58,0)
 . S IEN=0 F  S IEN=$O(^YTT(601.92,"AC",ADMIN,IEN)) Q:'IEN  D
"RTN","YS148IDX",59,0)
 . . ; if IEN doesn't exist, remove index
"RTN","YS148IDX",60,0)
 . . I '$D(^YTT(601.92,IEN,0)) D RM92AC(ADMIN,IEN) QUIT
"RTN","YS148IDX",61,0)
 . . ; if ADMIN doesn't match, remove index
"RTN","YS148IDX",62,0)
 . . I $P($G(^YTT(601.92,IEN,0)),U,2)'=ADMIN D RM92AC(ADMIN,IEN)
"RTN","YS148IDX",63,0)
 Q
"RTN","YS148IDX",64,0)
RM92AC(ADMIN,IEN) ; remove bad index
"RTN","YS148IDX",65,0)
 K ^YTT(601.92,"AC",ADMIN,IEN)
"RTN","YS148IDX",66,0)
 D LOG("92AC",ADMIN,"",IEN)
"RTN","YS148IDX",67,0)
 Q
"RTN","YS148IDX",68,0)
 ;
"RTN","YS148IDX",69,0)
 ; -- these tags set any index nodes that are missing
"RTN","YS148IDX",70,0)
 ;
"RTN","YS148IDX",71,0)
RESET85C ; Rebuild the "AC" index for MH ANSWERS (601.85)
"RTN","YS148IDX",72,0)
 N ADMIN,QSTN,IEN,X0
"RTN","YS148IDX",73,0)
 S IEN=0 F  S IEN=$O(^YTT(601.85,IEN)) Q:'IEN  D
"RTN","YS148IDX",74,0)
 . S X0=$G(^YTT(601.85,IEN,0)),ADMIN=$P(X0,U,2),QSTN=$P(X0,U,3)
"RTN","YS148IDX",75,0)
 . I 'ADMIN!('QSTN) QUIT                        ; no index if missing data
"RTN","YS148IDX",76,0)
 . I $D(^YTT(601.85,"AC",ADMIN,QSTN,IEN)) QUIT  ; index is correct
"RTN","YS148IDX",77,0)
 . N DIK,DA                                     ; set new "AC" index
"RTN","YS148IDX",78,0)
 . S DIK="^YTT(601.85,",DIK(1)="1^AC",DA=IEN
"RTN","YS148IDX",79,0)
 . D EN^DIK
"RTN","YS148IDX",80,0)
 . D LOG("85ACI",ADMIN,QSTN,IEN)
"RTN","YS148IDX",81,0)
 Q
"RTN","YS148IDX",82,0)
RESET85D ; Rebuild the "AD" index for MH ANSWERS (601.85)
"RTN","YS148IDX",83,0)
 N ADMIN,IEN,X0
"RTN","YS148IDX",84,0)
 S IEN=0 F  S IEN=$O(^YTT(601.85,IEN)) Q:'IEN  D
"RTN","YS148IDX",85,0)
 . S X0=$G(^YTT(601.85,IEN,0)),ADMIN=$P(X0,U,2)
"RTN","YS148IDX",86,0)
 . I 'ADMIN QUIT                                ; no index if missing data
"RTN","YS148IDX",87,0)
 . I $D(^YTT(601.85,"AD",ADMIN,IEN)) QUIT       ; index is correct
"RTN","YS148IDX",88,0)
 . N DIK,DA                                     ; set new "AD" index
"RTN","YS148IDX",89,0)
 . S DIK="^YTT(601.85,",DIK(1)="1^AD",DA=IEN
"RTN","YS148IDX",90,0)
 . D EN^DIK
"RTN","YS148IDX",91,0)
 . D LOG("85ADI",ADMIN,"",IEN)
"RTN","YS148IDX",92,0)
 Q
"RTN","YS148IDX",93,0)
RESET92 ; Rebuild the "AC" index for MH RESULTS (601.92)
"RTN","YS148IDX",94,0)
 N ADMIN,IEN
"RTN","YS148IDX",95,0)
 S IEN=0 F  S IEN=$O(^YTT(601.92,IEN)) Q:'IEN  D
"RTN","YS148IDX",96,0)
 . S ADMIN=+$P($G(^YTT(601.92,IEN,0)),U,2)
"RTN","YS148IDX",97,0)
 . I 'ADMIN QUIT                                ; no index if admin missing
"RTN","YS148IDX",98,0)
 . I $D(^YTT(601.92,"AC",ADMIN,IEN)) QUIT       ; index is correct
"RTN","YS148IDX",99,0)
 . N DIK,DA                                     ; set new "AC" index
"RTN","YS148IDX",100,0)
 . S DIK="^YTT(601.92,",DIK(1)="1^AC",DA=IEN
"RTN","YS148IDX",101,0)
 . D EN^DIK
"RTN","YS148IDX",102,0)
 . D LOG("92ACI",ADMIN,"",IEN)
"RTN","YS148IDX",103,0)
 Q
"RTN","YS148IDX",104,0)
 ;
"RTN","YS148IDX",105,0)
 ; -- status notifications
"RTN","YS148IDX",106,0)
 ;
"RTN","YS148IDX",107,0)
LOG(FIX,ADMIN,QSTN,IEN) ; Log fixes
"RTN","YS148IDX",108,0)
 S YS148CNT=YS148CNT+1
"RTN","YS148IDX",109,0)
 I '$D(ZTQUEUED) S ^XTMP("YTS-RE-INDEX",YS148CNT)=FIX_U_ADMIN_U_$G(QSTN)_U_IEN
"RTN","YS148IDX",110,0)
 S ^XTMP("YTS-RE-INDEX","ERRS")=YS148CNT
"RTN","YS148IDX",111,0)
 Q
"RTN","YS148IDX",112,0)
UPD(MSG) ; set parameter to current status
"RTN","YS148IDX",113,0)
 D EN^XPAR("SYS","YS123 RE-INDEX STATUS",1,MSG)
"RTN","YS148IDX",114,0)
 I '$D(ZTQUEUED) W !,MSG
"RTN","YS148IDX",115,0)
 Q
"RTN","YS148IDX",116,0)
NOTIFY(MSG) ; send message to installer
"RTN","YS148IDX",117,0)
 N XMDUZ,XMSUB,XMTEXT,XMY,XMZ,XMMG,DIFROM,YSTEXT
"RTN","YS148IDX",118,0)
 S YSTEXT(1)="Re-indexing of the MH RESULTS and MH ANSWERS files has completed"
"RTN","YS148IDX",119,0)
 S YSTEXT(2)="with the following status:"
"RTN","YS148IDX",120,0)
 S YSTEXT(3)=" "
"RTN","YS148IDX",121,0)
 S YSTEXT(4)=MSG
"RTN","YS148IDX",122,0)
 S XMDUZ="YS*5.01*148 POST INSTALL"
"RTN","YS148IDX",123,0)
 S XMSUB="Re-Index of Mental Health Results Completed"
"RTN","YS148IDX",124,0)
 S:$G(DUZ) XMY(DUZ)="" S:$G(YS148IN) XMY(YS148IN)=""
"RTN","YS148IDX",125,0)
 S XMTEXT="YSTEXT("
"RTN","YS148IDX",126,0)
 D ^XMD
"RTN","YS148IDX",127,0)
 Q
"RTN","YS148IDX",128,0)
 ;
"RTN","YS148IDX",129,0)
 ; YS123 RE-INDEX MONITOR option
"RTN","YS148IDX",130,0)
 ;
"RTN","YS148IDX",131,0)
MONITOR ; Check status of re-index, allows re-queuing
"RTN","YS148IDX",132,0)
 W !,"MH RESULTS and MH ANSWERS Re-Index Monitor"
"RTN","YS148IDX",133,0)
 D STATUS
"RTN","YS148IDX",134,0)
 N X,Y,DIR,DTOUT,DUOUT,DIRUT,DIROUT
"RTN","YS148IDX",135,0)
 S DIR(0)="YA^^"
"RTN","YS148IDX",136,0)
 S DIR("A")="Do you want to queue re-indexing of MH RESULTS and MH ANSWERS? "
"RTN","YS148IDX",137,0)
 S DIR("B")="NO"
"RTN","YS148IDX",138,0)
 S DIR("?")="Answer YES to re-index (only needed if errors are occurring)."
"RTN","YS148IDX",139,0)
 D ^DIR
"RTN","YS148IDX",140,0)
 Q:$D(DIRUT)  Q:$D(DIROUT)  Q:'Y
"RTN","YS148IDX",141,0)
 S DIR(0)="DA^::FR"
"RTN","YS148IDX",142,0)
 S DIR("A")="Queue Re-Indexing to Run: "
"RTN","YS148IDX",143,0)
 S DIR("B")="NOW"
"RTN","YS148IDX",144,0)
 S DIR("?")="Enter the date/time when the re-indexing task should begin"
"RTN","YS148IDX",145,0)
 D ^DIR
"RTN","YS148IDX",146,0)
 Q:$D(DIRUT)  Q:$D(DIROUT)  Q:'Y
"RTN","YS148IDX",147,0)
 D QTASK^YS148PST(Y)
"RTN","YS148IDX",148,0)
 Q
"RTN","YS148IDX",149,0)
STATUS ; Loop showing status until done
"RTN","YS148IDX",150,0)
 N X,Y,DIR,DTOUT,DUOUT,DIRUT,DIROUT
"RTN","YS148IDX",151,0)
 F  D  Q:'Y
"RTN","YS148IDX",152,0)
 . W !!,"  Status: ",$$GET^XPAR("SYS","YS123 RE-INDEX STATUS",1,"Q")
"RTN","YS148IDX",153,0)
 . W !,"  Errors Repaired: ",+$G(^XTMP("YTS-RE-INDEX","ERRS")),!
"RTN","YS148IDX",154,0)
 . S DIR(0)="YA^^"
"RTN","YS148IDX",155,0)
 . S DIR("A")="Refresh? "
"RTN","YS148IDX",156,0)
 . S DIR("B")="Yes"
"RTN","YS148IDX",157,0)
 . D ^DIR
"RTN","YS148IDX",158,0)
 . I $D(DIRUT)!$D(DIROUT) S Y=0
"RTN","YS148IDX",159,0)
 Q
"RTN","YS148PST")
0^^B1333784^n/a
"RTN","YS148PST",1,0)
YS148PST ;SLC/KCM - Patch 148 post-init ; 03/28/2019
"RTN","YS148PST",2,0)
 ;;5.01;MENTAL HEALTH;**148**;Dec 30, 1994;Build 8
"RTN","YS148PST",3,0)
 ;
"RTN","YS148PST",4,0)
POST ; post-init
"RTN","YS148PST",5,0)
 D EN^XPAR("SYS","YS123 RE-INDEX STATUS",1,"Re-index Skipped")
"RTN","YS148PST",6,0)
 I XPDQUES("POST-Q1")=1 QUIT  ; do nothing -- skip selected
"RTN","YS148PST",7,0)
 D QTASK(XPDQUES("POST-Q2"))
"RTN","YS148PST",8,0)
 Q
"RTN","YS148PST",9,0)
QTASK(QTIME) ; Create background task for re-indexing result files
"RTN","YS148PST",10,0)
 N ZTRTN,ZTDESC,ZTDTH,ZTIO,ZTSAVE,ZTSK,YS148IN,MSG
"RTN","YS148PST",11,0)
 S YS148IN=DUZ
"RTN","YS148PST",12,0)
 S ZTIO=""
"RTN","YS148PST",13,0)
 S ZTRTN="REIDX^YS148IDX"
"RTN","YS148PST",14,0)
 S ZTDESC="Re-index MH Results"
"RTN","YS148PST",15,0)
 S ZTDTH=QTIME
"RTN","YS148PST",16,0)
 S ZTSAVE("YS148IN")=""
"RTN","YS148PST",17,0)
 D ^%ZTLOAD
"RTN","YS148PST",18,0)
 I '$G(ZTSK) S MSG="Unsuccessful queue of re-indexing job." I 1
"RTN","YS148PST",19,0)
 E  S MSG="Re-indexing queued as TASK #"_ZTSK
"RTN","YS148PST",20,0)
 D MES^XPDUTL(MSG)
"RTN","YS148PST",21,0)
 D EN^XPAR("SYS","YS123 RE-INDEX STATUS",1,MSG)
"RTN","YS148PST",22,0)
 Q
"VER")
8.0^22.2
"BLD",9481,6)
^108
**END**
**END**

