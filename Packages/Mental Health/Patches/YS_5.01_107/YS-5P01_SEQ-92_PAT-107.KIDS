Released YS*5.01*107 SEQ #92
Extracted from mail message
**KIDS**:YS*5.01*107^

**INSTALL NAME**
YS*5.01*107
"BLD",8902,0)
YS*5.01*107^MENTAL HEALTH^0^3140227^y
"BLD",8902,4,0)
^9.64PA^627.8^1
"BLD",8902,4,627.8,0)
627.8
"BLD",8902,4,627.8,2,0)
^9.641^627.8^1
"BLD",8902,4,627.8,2,627.8,0)
DIAGNOSTIC RESULTS - MENTAL HEALTH  (File-top level)
"BLD",8902,4,627.8,2,627.8,1,0)
^9.6411^10^2
"BLD",8902,4,627.8,2,627.8,1,1,0)
DIAGNOSIS
"BLD",8902,4,627.8,2,627.8,1,10,0)
DXLS
"BLD",8902,4,627.8,222)
y^y^p^^^^n^^n
"BLD",8902,4,627.8,224)

"BLD",8902,4,"APDD",627.8,627.8)

"BLD",8902,4,"APDD",627.8,627.8,1)

"BLD",8902,4,"APDD",627.8,627.8,10)

"BLD",8902,4,"B",627.8,627.8)

"BLD",8902,6.3)
23
"BLD",8902,"ABPKG")
n
"BLD",8902,"INID")
^n
"BLD",8902,"INIT")
YS107P
"BLD",8902,"KRN",0)
^9.67PA^779.2^20
"BLD",8902,"KRN",.4,0)
.4
"BLD",8902,"KRN",.401,0)
.401
"BLD",8902,"KRN",.402,0)
.402
"BLD",8902,"KRN",.403,0)
.403
"BLD",8902,"KRN",.5,0)
.5
"BLD",8902,"KRN",.84,0)
.84
"BLD",8902,"KRN",3.6,0)
3.6
"BLD",8902,"KRN",3.8,0)
3.8
"BLD",8902,"KRN",9.2,0)
9.2
"BLD",8902,"KRN",9.8,0)
9.8
"BLD",8902,"KRN",9.8,"NM",0)
^9.68A^13^13
"BLD",8902,"KRN",9.8,"NM",1,0)
YSDX3^^0^B14443851
"BLD",8902,"KRN",9.8,"NM",2,0)
YSDX3A^^0^B10489909
"BLD",8902,"KRN",9.8,"NM",3,0)
YSDX3R^^0^B8147998
"BLD",8902,"KRN",9.8,"NM",4,0)
YSDX3R1^^0^B14732518
"BLD",8902,"KRN",9.8,"NM",5,0)
YSDX3RU^^0^B18652946
"BLD",8902,"KRN",9.8,"NM",6,0)
YSDX3RUA^^0^B11544706
"BLD",8902,"KRN",9.8,"NM",7,0)
YSDX3U^^0^B21590008
"BLD",8902,"KRN",9.8,"NM",8,0)
YSDX3UA^^0^B20591995
"BLD",8902,"KRN",9.8,"NM",9,0)
YSDX3UA0^^0^B4575743
"BLD",8902,"KRN",9.8,"NM",10,0)
YSSR^^0^B34732043
"BLD",8902,"KRN",9.8,"NM",11,0)
YSLXDG^^0^B145277069
"BLD",8902,"KRN",9.8,"NM",12,0)
YSLXDG2^^0^B39703907
"BLD",8902,"KRN",9.8,"NM",13,0)
YSDXUTL^^0^B9274857
"BLD",8902,"KRN",9.8,"NM","B","YSDX3",1)

"BLD",8902,"KRN",9.8,"NM","B","YSDX3A",2)

"BLD",8902,"KRN",9.8,"NM","B","YSDX3R",3)

"BLD",8902,"KRN",9.8,"NM","B","YSDX3R1",4)

"BLD",8902,"KRN",9.8,"NM","B","YSDX3RU",5)

"BLD",8902,"KRN",9.8,"NM","B","YSDX3RUA",6)

"BLD",8902,"KRN",9.8,"NM","B","YSDX3U",7)

"BLD",8902,"KRN",9.8,"NM","B","YSDX3UA",8)

"BLD",8902,"KRN",9.8,"NM","B","YSDX3UA0",9)

"BLD",8902,"KRN",9.8,"NM","B","YSDXUTL",13)

"BLD",8902,"KRN",9.8,"NM","B","YSLXDG",11)

"BLD",8902,"KRN",9.8,"NM","B","YSLXDG2",12)

"BLD",8902,"KRN",9.8,"NM","B","YSSR",10)

"BLD",8902,"KRN",19,0)
19
"BLD",8902,"KRN",19,"NM",0)
^9.68A^^
"BLD",8902,"KRN",19.1,0)
19.1
"BLD",8902,"KRN",19.1,"NM",0)
^9.68A^1^1
"BLD",8902,"KRN",19.1,"NM",1,0)
YSD^^0
"BLD",8902,"KRN",19.1,"NM","B","YSD",1)

"BLD",8902,"KRN",101,0)
101
"BLD",8902,"KRN",409.61,0)
409.61
"BLD",8902,"KRN",771,0)
771
"BLD",8902,"KRN",779.2,0)
779.2
"BLD",8902,"KRN",870,0)
870
"BLD",8902,"KRN",8989.51,0)
8989.51
"BLD",8902,"KRN",8989.52,0)
8989.52
"BLD",8902,"KRN",8994,0)
8994
"BLD",8902,"KRN","B",.4,.4)

"BLD",8902,"KRN","B",.401,.401)

"BLD",8902,"KRN","B",.402,.402)

"BLD",8902,"KRN","B",.403,.403)

"BLD",8902,"KRN","B",.5,.5)

"BLD",8902,"KRN","B",.84,.84)

"BLD",8902,"KRN","B",3.6,3.6)

"BLD",8902,"KRN","B",3.8,3.8)

"BLD",8902,"KRN","B",9.2,9.2)

"BLD",8902,"KRN","B",9.8,9.8)

"BLD",8902,"KRN","B",19,19)

"BLD",8902,"KRN","B",19.1,19.1)

"BLD",8902,"KRN","B",101,101)

"BLD",8902,"KRN","B",409.61,409.61)

"BLD",8902,"KRN","B",771,771)

"BLD",8902,"KRN","B",779.2,779.2)

"BLD",8902,"KRN","B",870,870)

"BLD",8902,"KRN","B",8989.51,8989.51)

"BLD",8902,"KRN","B",8989.52,8989.52)

"BLD",8902,"KRN","B",8994,8994)

"BLD",8902,"QUES",0)
^9.62^^
"BLD",8902,"REQB",0)
^9.611^5^3
"BLD",8902,"REQB",3,0)
YS*5.01*60^2
"BLD",8902,"REQB",4,0)
ICD*18.0*57^2
"BLD",8902,"REQB",5,0)
LEX*2.0*80^2
"BLD",8902,"REQB","B","ICD*18.0*57",4)

"BLD",8902,"REQB","B","LEX*2.0*80",5)

"BLD",8902,"REQB","B","YS*5.01*60",3)

"FIA",627.8)
DIAGNOSTIC RESULTS - MENTAL HEALTH
"FIA",627.8,0)
^YSD(627.8,
"FIA",627.8,0,0)
627.8D
"FIA",627.8,0,1)
y^y^p^^^^n^^n
"FIA",627.8,0,10)

"FIA",627.8,0,11)

"FIA",627.8,0,"RLRO")

"FIA",627.8,0,"VR")
5.01^YS
"FIA",627.8,627.8)
1
"FIA",627.8,627.8,1)

"FIA",627.8,627.8,10)

"INIT")
YS107P
"KRN",19.1,175,-1)
0^1
"KRN",19.1,175,0)
YSD
"KRN",19.1,175,1,0)
2^19.11^2^2^3120430^^^^
"KRN",19.1,175,1,1,0)
Allows verification of ICD diagnoses.  This is a clinical privilege.
"KRN",19.1,175,1,2,0)
The chief of psychiatry will determine who may have this key.
"MBREQ")
0
"ORD",3,19.1)
19.1;3;;;KEY^XPDTA1;KEYF1^XPDIA1;KEYE1^XPDIA1;KEYF2^XPDIA1;;KEYDEL^XPDIA1
"ORD",3,19.1,0)
SECURITY KEY
"PKG",100,-1)
1^1
"PKG",100,0)
MENTAL HEALTH^YS^Version 5.01 of Mental Health
"PKG",100,20,0)
^9.402P^^
"PKG",100,22,0)
^9.49I^1^1
"PKG",100,22,1,0)
5.01^2941230^2960821
"PKG",100,22,1,"PAH",1,0)
107^3140227
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
14
"RTN","YS107P")
0^^B1703549^n/a
"RTN","YS107P",1,0)
YS107P ;ALB/RBD - YS*5.01*107 PATCH POST INIT ROUTINE ;16 May 2013  3:59 PM
"RTN","YS107P",2,0)
 ;;5.01;MENTAL HEALTH;**107**;Dec 30, 1994;Build 23
"RTN","YS107P",3,0)
 ;
"RTN","YS107P",4,0)
 ; IA 5924 Created for this post-init routine to update DESCRIPTION
"RTN","YS107P",5,0)
 ;  of File (#627.8)
"RTN","YS107P",6,0)
 ;
"RTN","YS107P",7,0)
EN ;
"RTN","YS107P",8,0)
 D BMES^XPDUTL("**** ICD 10 Remediation ****")
"RTN","YS107P",9,0)
 N YSUPDMSG S YSUPDMSG="**** Updating Mental Health - Diagnostic "
"RTN","YS107P",10,0)
 S YSUPDMSG=YSUPDMSG_"Condition File (#627.8) DESCRIPTION ****"
"RTN","YS107P",11,0)
 D BMES^XPDUTL(YSUPDMSG)
"RTN","YS107P",12,0)
 S YSUPDMSG="**** Occurrences of 'ICD9' changed to 'ICD DIAGNOSIS' ****"
"RTN","YS107P",13,0)
 D BMES^XPDUTL(YSUPDMSG)
"RTN","YS107P",14,0)
CHANGE ;
"RTN","YS107P",15,0)
 N YSREC
"RTN","YS107P",16,0)
 S YSREC=$C(34)_"AE"_$C(34)_" Xref  -  Type (DSM or ICD DIAGNOSIS), "
"RTN","YS107P",17,0)
 S YSREC=YSREC_"DFN, System Dte, Dx, DFN."
"RTN","YS107P",18,0)
 S ^DIC(627.8,"%D",7,0)=YSREC
"RTN","YS107P",19,0)
 S YSREC=$C(34)_"AG"_$C(34)_" Xref  -  Type (DSM or ICD DIAGNOSIS), "
"RTN","YS107P",20,0)
 S YSREC=YSREC_"DFN, Dx, IFN."
"RTN","YS107P",21,0)
 S ^DIC(627.8,"%D",13,0)=YSREC
"RTN","YS107P",22,0)
 D BMES^XPDUTL("**** Done ****")
"RTN","YS107P",23,0)
EXIT ;
"RTN","YS107P",24,0)
 Q
"RTN","YSDX3")
0^1^B14443851^B10581455
"RTN","YSDX3",1,0)
YSDX3 ;SLC/DJP,HIOFO/FT - Entry of Axis 1 & 2 Diagnoses for the Mental Health Medical Record ;9/20/11 16:58
"RTN","YSDX3",2,0)
 ;;5.01;MENTAL HEALTH;**33,60,107**;Dec 30, 1994;Build 23
"RTN","YSDX3",3,0)
 ;
"RTN","YSDX3",4,0)
 ; Called from the top by MENU option YSDIAGE
"RTN","YSDX3",5,0)
 ;
"RTN","YSDX3",6,0)
DRIVER ;Controls flow of routine
"RTN","YSDX3",7,0)
 ;D RECORD^YSDX0001("DRIVER^YSDX3") ;Used for testing.  Inactivated in YSDX0001...
"RTN","YSDX3",8,0)
 D ENTRY I $D(YSQT) D END^YSDX3U Q
"RTN","YSDX3",9,0)
 D ^YSDX3A I $D(YSQT) D END^YSDX3U Q
"RTN","YSDX3",10,0)
 D AXIS4^YSDX3B I $D(YSQT) D END^YSDX3U Q
"RTN","YSDX3",11,0)
 D AXIS5^YSDX3B D END^YSDX3U Q
"RTN","YSDX3",12,0)
ENTRY ;Initial entry of DSM diagnosis
"RTN","YSDX3",13,0)
 ;D RECORD^YSDX0001("ENTRY^YSDX3") ;Used for testing.  Inactivated in YSDX0001...
"RTN","YSDX3",14,0)
 S:'$D(YSDUZ) YSDUZ=$P(^VA(200,DUZ,0),U) W @IOF,!!?IOM-$L("ENTRY OF DIAGNOSIS")\2,"ENTRY OF DIAGNOSIS",!! K YSQT D ^YSLRP Q:$D(YSPLIC)  I YSTOUT!YSUOUT!(YSDFN'>0) Q
"RTN","YSDX3",15,0)
 ;
"RTN","YSDX3",16,0)
DXDATE S %DT="AER",%DT("A")="DATE/TIME OF DIAGNOSIS: ",%DT("B")="NOW" D ^%DT I Y=-1 S YSQT=1 Q
"RTN","YSDX3",17,0)
 S YSDXDAT=Y K %DT
"RTN","YSDX3",18,0)
 ;OLD ;  Called by routine YSCEN1
"RTN","YSDX3",19,0)
 ;Check for diagnosis formulated under DSM-III (File ^MR)
"RTN","YSDX3",20,0)
 ;D RECORD^YSDX0001("OLD^YSDX3") ;Used for testing.  Inactivated in YSDX0001
"RTN","YSDX3",21,0)
 ;I $D(^MR(YSDFN,"DX")) D OLDP
"RTN","YSDX3",22,0)
AGAIN ;  called from routine YSDX3UA
"RTN","YSDX3",23,0)
 ;D RECORD^YSDX0001("AGAIN^YSDX3") ;Used for testing.  Inactivated in YSDX0001...
"RTN","YSDX3",24,0)
 S P1=0,YSAX=1,YSDTY="A" W !!,"ACTIVE DSM (Axes 1 and 2): ",! D LIST^YSDX3U G:$D(YSNO) QUES1 I '$D(YSDXN) W !!?5,"No active DSM diagnoses on file for ",YSNM,".",!
"RTN","YSDX3",25,0)
 K % D INQ^YSDX3U Q:$D(YSQT)
"RTN","YSDX3",26,0)
 ;
"RTN","YSDX3",27,0)
QUES1 ;Subroutine presents questions for Axes 1&2
"RTN","YSDX3",28,0)
 ;D RECORD^YSDX0001("QUES1^YSDX3") ;Used for testing.  Inactivated in YSDX0001...
"RTN","YSDX3",29,0)
 I '$D(^XUSEC("YSQ",DUZ)) W !!,"You must hold the YSQ security key to enter a DSM diagnosis." H 3 Q
"RTN","YSDX3",30,0)
 K YSQT W !!,"Enter DSM DIAGNOSIS:  " R X1:DTIME S YSTOUT='$T,YSUOUT=X1["^" I YSTOUT!YSUOUT S YSQT=1 Q
"RTN","YSDX3",31,0)
 Q:X1=""  I X1?.N I X1<(P1+1) G:X1<1 QUES1 W ! D DSMP^YSDX3UA G:'$D(YSY) QUES1 S:$D(S2) YSDXDA=+S2
"RTN","YSDX3",32,0)
 I '$D(YSY) S X=$$UP^XLFSTR(X1) D DSMLK^YSDX3UA G:Y<0 QUES1
"RTN","YSDX3",33,0)
 ;
"RTN","YSDX3",34,0)
DUPLCK ;Checks for and displays possible duplicate entries
"RTN","YSDX3",35,0)
 ;D RECORD^YSDX0001("DUPLCK^YSDX3") ;Used for testing.  Inactivated in YSDX0001...
"RTN","YSDX3",36,0)
 S:'$D(YSDXDA) YSDXDA=+Y S:'$D(S2) S2=+Y
"RTN","YSDX3",37,0)
 N YSACSREC,YSICDVSN S YSACSREC=$$ACTDT^YSDXUTL(YSDXDAT),YSICDVSN=$P(^YSD(627.7,S2,0),U,8)
"RTN","YSDX3",38,0)
 S:YSICDVSN="" YSICDVSN="9"
"RTN","YSDX3",39,0)
 I YSICDVSN="9",$P(YSACSREC,U,1)'="ICD" D  G QUES1
"RTN","YSDX3",40,0)
 . W !!,"DSM DIAGNOSIS is associated with ICD-9 ICD VERSION but should be associated"
"RTN","YSDX3",41,0)
 . W !,"with the ICD-10 ICD VERSION for the entered DATE/TIME OF DIAGNOSIS."
"RTN","YSDX3",42,0)
 I YSICDVSN="10",$P(YSACSREC,U,1)="ICD" D  G QUES1
"RTN","YSDX3",43,0)
 . W !!,"DSM DIAGNOSIS is associated with ICD-10 ICD VERSION but should be associated"
"RTN","YSDX3",44,0)
 . W !,"with the ICD-9 ICD VERSION for the entered DATE/TIME OF DIAGNOSIS."
"RTN","YSDX3",45,0)
 S W2="",W1=S2_";"_"YSD(627.7," F  S W2=$O(^YSD(627.8,"AG","D",YSDFN,W1,W2)) Q:W2=""  S YSDUPDA=W2 D DUPL^YSDX3UA
"RTN","YSDX3",46,0)
CORR ;
"RTN","YSDX3",47,0)
 ;D RECORD^YSDX0001("CORR^YSDX3") ;Used for testing.  Inactivated in YSDX0001...
"RTN","YSDX3",48,0)
 S YSWN=$P(^YSD(627.7,+YSDXDA,0),U),YSW=$G(^YSD(627.7,+YSDXDA,"D"))
"RTN","YSDX3",49,0)
 S %=0 F  Q:$G(%)  W !!?10,YSWN_" "_YSW,!!,"Is this the DSM Dx you wish to select" S %=2 D
"RTN","YSDX3",50,0)
 .D YN^DICN S YSTOUT=$D(DTOUT),YSUOUT=$D(DUOUT) I YSTOUT!YSUOUT Q
"RTN","YSDX3",51,0)
 .I '% W !!,"""YES"" indicates the diagnosis entered applies to ",YSNM,"."
"RTN","YSDX3",52,0)
 I %=2 K YSDXDA,X1,YSDXST,YSLC,YSLCN,YSW,YSWN,YSY,S1,S2,S3,YSDXD,YSDXDA1,YSDXDT,YSDXND,YSDTY,W1,W2,W3,W4,W5 G QUES1
"RTN","YSDX3",53,0)
 I %=-1 Q
"RTN","YSDX3",54,0)
FILE ;
"RTN","YSDX3",55,0)
 ;D RECORD^YSDX0001("FILE^YSDX3") ;Used for testing.  Inactivated in YSDX0001...
"RTN","YSDX3",56,0)
 ;S DIC="^YSD(627.8,",DIC(0)="L",X="""N""",DLAYGO=627 D ^DIC D:Y<0 END^YSDX3U S YSDA=+Y,YSDXDA=YSDXDA_";YSD(627.7,"
"RTN","YSDX3",57,0)
 K DD,DO,DA,DINUM
"RTN","YSDX3",58,0)
 S X="NOW",%DT="TR" D ^%DT S X=Y
"RTN","YSDX3",59,0)
 S DIC="^YSD(627.8,",DIC(0)="L",DLAYGO=627.8 D FILE^DICN D:Y<0 END^YSDX3U S YSDA=+Y,YSDXDA=YSDXDA_";YSD(627.7,"
"RTN","YSDX3",60,0)
 S YSDXDA1=$P(YSDXDA,";") D MODIF^YSDX3UB G:$D(YSQT) QUES1
"RTN","YSDX3",61,0)
 D FILE^YSDX3UA
"RTN","YSDX3",62,0)
 K YSDXDA,YSDA,YSDTY,YSDXDA1,YSDXDT,YSDXN,YSDXNN,YSDXST,YSMOD,YSW,YSWN,YSY,F1,F2,F3,K1,K2,K3,K4,K5,K6,L2,L3,L4,L5,L7,P2,P3,P4,P5,S2,W1,W2,W3,W4,W5,W6,X,X1 G QUES1
"RTN","YSDX3",63,0)
 ;OLDP ;
"RTN","YSDX3",64,0)
 ;D RECORD^YSDX0001("OLDP^YSDX3") ;Used for testing.  Inactivated in YSDX0001...
"RTN","YSDX3",65,0)
 ;S %=0 F  Q:$G(%)  W !!,"This patient has diagnoses formulated under DSM-III criteria.",!,"Do you wish to review" S %=2 D
"RTN","YSDX3",66,0)
 ;.D YN^DICN S YSTOUT=$D(DTOUT),YSUOUT=$D(DUOUT)
"RTN","YSDX3",67,0)
 ;.I '% W !!,"""YES"" provides a list of diagnoses which you may want to reformulate under",!," DSM criteria.  ""NO"" will permit the option to continue.",!
"RTN","YSDX3",68,0)
 ;Q:YSTOUT!YSUOUT  I %'=1 Q
"RTN","YSDX3",69,0)
 ;W !!,"The following may require reformulation under DSM criteria.",! D ^YSDXR
"RTN","YSDX3",70,0)
 ;Q
"RTN","YSDX3",71,0)
 ;
"RTN","YSDX3",72,0)
 ;EN ;The following are entry points used for accessing the DSM routines from options other than YSDIAG.
"RTN","YSDX3",73,0)
 ;
"RTN","YSDX3",74,0)
 ;ENPLDX ; Called by MENU option YSPLDX
"RTN","YSDX3",75,0)
 ; Called by routines YSPROB, YSPROB1, YSPROB3
"RTN","YSDX3",76,0)
 ;D RECORD^YSDX0001("ENPLDX^YSDX3") ;Used for testing.  Inactivated in YSDX0001...
"RTN","YSDX3",77,0)
 ;S YSPLDX=1,N1=0 D @$S($D(YSDFN):"OLD",1:"ENTRY") I $G(YSQT)!YSTOUT!YSUOUT!(YSDFN'>0) D END^YSDX3U Q
"RTN","YSDX3",78,0)
 ;D AXIS4^YSDX3B I $D(YSQT) D END^YSDX3U Q
"RTN","YSDX3",79,0)
 ;D AXIS5^YSDX3B I $D(YSQT) D END^YSDX3U
"RTN","YSDX3",80,0)
 ;Q
"RTN","YSDX3",81,0)
 ;
"RTN","YSDX3",82,0)
 ;ENPLIC ; Called by MENU option YSPLPDX
"RTN","YSDX3",83,0)
 ;  Called by routines YSPROB1, YSPROB3
"RTN","YSDX3",84,0)
 ;
"RTN","YSDX3",85,0)
 ;D RECORD^YSDX0001("ENPLIC^YSDX3") ;Used for testing.  Inactivated in YSDX0001...
"RTN","YSDX3",86,0)
 ;S YSPLIC=1,N1=0 S:'$D(YSDUZ) YSDUZ=$P(^VA(200,DUZ,0),U) D:$G(YSDFN)'>0 ^YSLRP I YSTOUT!YSUOUT!(YSDFN'>0) D END^YSDX3U Q
"RTN","YSDX3",87,0)
 ;D ^YSDX3A D END^YSDX3U Q
"RTN","YSDX3A")
0^2^B10489909^B7663653
"RTN","YSDX3A",1,0)
YSDX3A ;SLC/DJP - Entry of Axis 3 Diagnosis for the Mental Health Med Rec ;11 Sep 2013  11:32 AM
"RTN","YSDX3A",2,0)
 ;;5.01;MENTAL HEALTH;**33,107**;Dec 30, 1994;Build 23
"RTN","YSDX3A",3,0)
 ;D RECORD^YSDX0001("YSDX3A^YSDX3A") ;Used for testing.  Inactivated in YSDX0001...
"RTN","YSDX3A",4,0)
 ;
"RTN","YSDX3A",5,0)
 ;  Called from routines YSCEN1, YSDX3
"RTN","YSDX3A",6,0)
AXIS3 ;
"RTN","YSDX3A",7,0)
 ;D RECORD^YSDX0001("AXIS3^YSDX3A") ;Used for testing.  Inactivated in YSDX0001...
"RTN","YSDX3A",8,0)
 K YSDXDA,YSDA,YSDTY,YSNO,P1 W @IOF,!!?10,"ENTRY OF DIAGNOSIS - Continued - ",$E(YSNM,1,25) S YSAX=3,YSDTY="A",P1=0 K P2 W !!,"ACTIVE ICD DIAGNOSES (Axis 3): ",! D LIST^YSDX3U G:$D(YSNO) QUES2
"RTN","YSDX3A",9,0)
 I '$D(YSDXN) W !!?3,"No active ICD diagnosis on file for ",YSNM,".",!
"RTN","YSDX3A",10,0)
 D INQ^YSDX3U Q:$D(YSQT)
"RTN","YSDX3A",11,0)
QUES2 ;Subroutine presents questions for Axis 3
"RTN","YSDX3A",12,0)
 ;D RECORD^YSDX0001("QUES2^YSDX3A") ;Used for testing.  Inactivated in YSDX0001...
"RTN","YSDX3A",13,0)
 I $G(YSDXDAT)="" S YSDXDAT=DT
"RTN","YSDX3A",14,0)
 N YSACSREC,YSACS S YSACSREC=$$ACTDT^YSDXUTL(YSDXDAT),YSACS=$P(YSACSREC,U,3)
"RTN","YSDX3A",15,0)
 I YSACS["-" S YSACS=$P(YSACS,"-",1,2)
"RTN","YSDX3A",16,0)
 I '$D(^XUSEC("YSD",DUZ)) W !!,"You must hold correct security key to enter ",YSACS," diagnosis." Q
"RTN","YSDX3A",17,0)
 I $P(YSACSREC,U,1)'="ICD" D  G:$G(X2)?1N.N QUES2B G:YSRETV'<0 DUPLCK
"RTN","YSDX3A",18,0)
 . K X2 S YSDT=YSDXDAT D EN^YSLXDG Q:YSRETV<0  I $P(YSRETV,U,1)?.N S X2=$P(YSRETV,U,1)
"RTN","YSDX3A",19,0)
 . S (YSDXDA,Y)=$P($$ICDDATA^ICDXCODE("DIAG",$P($P(YSRETV,U,1),";",2),YSDXDAT,"E"),U,1)
"RTN","YSDX3A",20,0)
 I $G(YSRETV)<0 K YSRETV Q
"RTN","YSDX3A",21,0)
 W !!,"Enter ",YSACS," DIAGNOSIS:  " R X2:DTIME S YSTOUT='$T,YSUOUT=X2["^" I YSTOUT!YSUOUT S YSQT=1 Q
"RTN","YSDX3A",22,0)
QUES2B Q:X2="" 
"RTN","YSDX3A",23,0)
 I X2="???" S X2="??"
"RTN","YSDX3A",24,0)
 I X2?.N I X2<(P1+1) D ICDP^YSDX3UA G:'$D(YSY) QUES2 S:$D(S1) YSDXDA=$P(S1,";")
"RTN","YSDX3A",25,0)
 I '$D(YSY) S X2=$$UP^XLFSTR(X2) D ICDLK^YSDX3UA G:Y<0 QUES2
"RTN","YSDX3A",26,0)
DUPLCK ;Checks for and displays possible duplicate entries
"RTN","YSDX3A",27,0)
 ;D RECORD^YSDX0001("DUPLCK^YSDX3A") ;Used for testing.  Inactivated in YSDX0001...
"RTN","YSDX3A",28,0)
 S:'$D(YSDXDA) YSDXDA=+Y S:'$D(S2) S2=+Y S W2="",W1=S2_";"_"ICD9(" F I=1:1 S W2=$O(^YSD(627.8,"AG","I",YSDFN,W1,W2)) Q:W2=""  S YSDUPDA=W2 D DUPL^YSDX3UA
"RTN","YSDX3A",29,0)
CORR ;
"RTN","YSDX3A",30,0)
 ;D RECORD^YSDX0001("CORR^YSDX3A") ;Used for testing.  Inactivated in YSDX0001...
"RTN","YSDX3A",31,0)
 N YSDXDATA S YSDXDATA=$$ICDDATA^ICDXCODE("DIAG",YSDXDA,YSDXDAT,"I")
"RTN","YSDX3A",32,0)
 I $P(YSDXDATA,U,1)=-1 W !!,"Invalid Diagnosis for DATE/TIME OF DIAGNOSIS that was entered." G QUES2
"RTN","YSDX3A",33,0)
 ;S YSW=$P(^ICD9(YSDXDA,0),U),YSWN=$P(^(0),U,3)
"RTN","YSDX3A",34,0)
 S YSW=$P(YSDXDATA,U,2),YSWN=$P(YSDXDATA,U,4)
"RTN","YSDX3A",35,0)
 S %=0 F  Q:$G(%)  W !!?10,YSW_" "_YSWN,!!,"Is this the ICD diagnosis you wish to select" S %=2 D
"RTN","YSDX3A",36,0)
 .D YN^DICN S YSTOUT=$D(DTOUT),YSUOUT=$D(DUOUT) I YSTOUT!YSUOUT Q
"RTN","YSDX3A",37,0)
 .I '% W !!,"""YES"" indicates the diagnosis entered applies to ",YSNM,"."
"RTN","YSDX3A",38,0)
 I %=2 K YSDXDA,YSY,X2,S2 G QUES2
"RTN","YSDX3A",39,0)
 Q:%=-1
"RTN","YSDX3A",40,0)
FILE ;
"RTN","YSDX3A",41,0)
 ;D RECORD^YSDX0001("FILE^YSDX3A") ;Used for testing.  Inactivated in YSDX0001...
"RTN","YSDX3A",42,0)
 ;S DIC="^YSD(627.8,",DIC(0)="L",X="""N""",DLAYGO=627 D ^DIC Q:Y'>0  S YSDA=+Y,YSDXDA=YSDXDA_";ICD9("
"RTN","YSDX3A",43,0)
 K DD,DO,DA,DINUM
"RTN","YSDX3A",44,0)
 S X="NOW",%DT="TR" D ^%DT S X=Y
"RTN","YSDX3A",45,0)
 S DIC="^YSD(627.8,",DIC(0)="L",DLAYGO=627.8 D FILE^DICN Q:Y'>0  S YSDA=+Y,YSDXDA=YSDXDA_";ICD9("
"RTN","YSDX3A",46,0)
 D FILE^YSDX3UA
"RTN","YSDX3A",47,0)
 K YSDXDA,YSDA,YSDTY,YSDXDA1,YSDXDT,YSDXN,YSDXNN,YSDXST,YSMOD,YSW,YSWN,YSALZ,YSY,F1,F2,F3,K1,K2,K3,K4,K5,K6,L2,L3,L4,L5,L7,P2,P3,P4,P5,S2,W1,W2,W3,W4,W5,W6,X,X2 G:'$D(YSPLIC) QUES2
"RTN","YSDX3R")
0^3^B8147998^B8161908
"RTN","YSDX3R",1,0)
YSDX3R ;SLC/DJP - Print of Diagnosis for the Mental Health Medical Record ;12/13/93 16:02
"RTN","YSDX3R",2,0)
 ;;5.01;MENTAL HEALTH;**107**;Dec 30, 1994;Build 23
"RTN","YSDX3R",3,0)
 ;
"RTN","YSDX3R",4,0)
 ; Called from the top by MENU option YSDIAGP-DX
"RTN","YSDX3R",5,0)
 ;D RECORD^YSDX0001("YSDX3R^YSDX3R") ;Used for testing.  Inactivated in YSDX0001...
"RTN","YSDX3R",6,0)
 ;
"RTN","YSDX3R",7,0)
ENTRY ;
"RTN","YSDX3R",8,0)
 ;D RECORD^YSDX0001("ENTRY^YSDX3R") ;Used for testing.  Inactivated in YSDX0001...
"RTN","YSDX3R",9,0)
 W @IOF W !!?IOM-$L("PRINT OF DIAGNOSIS")\2,"PRINT OF DIAGNOSIS",!!
"RTN","YSDX3R",10,0)
 D ^YSLRP I YSTOUT!YSUOUT!(YSDFN'>0) G END
"RTN","YSDX3R",11,0)
 I '$D(^YSD(627.8,"AC",YSDFN)) W !!?10,"No diagnosis on file for ",YSNM G END
"RTN","YSDX3R",12,0)
QUES1 ;
"RTN","YSDX3R",13,0)
 W !!,"SORT BY (D)IAGNOSIS or (C)HRONOLOGICALLY?  D// " R A:DTIME S YSTOUT='$T,YSUOUT=A["^" I YSTOUT!YSUOUT G END
"RTN","YSDX3R",14,0)
 S A=$E(A) S:A="" A="D" I A["?" W !!,"You may list diagnoses sequentially or by date.",!! G QUES1
"RTN","YSDX3R",15,0)
 I "DdCc"'[A W " ?",! G QUES1
"RTN","YSDX3R",16,0)
QUES2 ;
"RTN","YSDX3R",17,0)
 ;D RECORD^YSDX0001("QUES2^YSDX3R") ;Used for testing.  Inactivated in YSDX0001...
"RTN","YSDX3R",18,0)
 S %=0 F  Q:$G(%)  W !,"LIST ONLY ACTIVE DIAGNOSIS" S %=1 D
"RTN","YSDX3R",19,0)
 .D YN^DICN I '% W !!,"You may list only active diagnoses or both active and inactive diagnoses.",!
"RTN","YSDX3R",20,0)
 S:%=2 YSTY="ALL" I %=-1 G END
"RTN","YSDX3R",21,0)
 S:'$D(YSTY) YSTY="ACT"
"RTN","YSDX3R",22,0)
DEVICE ;
"RTN","YSDX3R",23,0)
 ;D RECORD^YSDX0001("DEVICE^YSDX3R") ;Used for testing.  Inactivated in YSDX0001...
"RTN","YSDX3R",24,0)
 K IOP S %ZIS="Q" D ^%ZIS I POP G END
"RTN","YSDX3R",25,0)
 I $D(IO("Q")) S ZTRTN="ENPR^YSDX3R",(ZTSAVE("A"),ZTSAVE("YS*"))="",ZTDESC="YS DX PT" D ^%ZTLOAD G END
"RTN","YSDX3R",26,0)
ENPR ;Entry to core of print program.
"RTN","YSDX3R",27,0)
 ;D RECORD^YSDX0001("ENPR^YSDX3R") ;Used for testing.  Inactivated in YSDX0001...
"RTN","YSDX3R",28,0)
 S YSFHDR="DIAGNOSIS LIST",YSFHDR(1)="W !!,""DSM/ICD TITLE"" X YSFHDR(2),YSFHDR(3)",YSFHDR(2)="I YSTY=""ACT"" W ?25,""**** Only Active Diagnosis ****""",YSFHDR(3)="W !,""STATUS"",?10,""DATE""" S YSPP=0
"RTN","YSDX3R",29,0)
PR ;  Called from YSDX3RU
"RTN","YSDX3R",30,0)
 ;D RECORD^YSDX0001("PR^YSDX3R") ;Used for testing.  Inactivated in YSDX0001...
"RTN","YSDX3R",31,0)
 U IO D:'$D(YSNOFORM) ENHD^YSFORM S Y1=0,YST=$S(IOST?1"P".E:1,1:0),YSSL=$S(YST:8,1:3),YSLFT=0
"RTN","YSDX3R",32,0)
 D DXLS^YSDX3RUA G:YSTOUT!YSUOUT END D DX^YSDX3RU:"Dd"[A,CHR^YSDX3RU:"Cc"[A I YSTOUT!YSUOUT G END
"RTN","YSDX3R",33,0)
 D AX4^YSDX3RUA G:YSTOUT!YSUOUT END D AX5^YSDX3RUA
"RTN","YSDX3R",34,0)
 S YSCON=0 D:'$D(YSFFS) FINISH^YSDX3RU
"RTN","YSDX3R",35,0)
END ;
"RTN","YSDX3R",36,0)
 ;D RECORD^YSDX0001("END^YSDX3R") ;Used for testing.  Inactivated in YSDX0001...
"RTN","YSDX3R",37,0)
 I $G(ZTSK) S ZTREQ="@"
"RTN","YSDX3R",38,0)
 D KVAR^VADPT,^%ZISC
"RTN","YSDX3R",39,0)
 K A,A1,A2,A3,A4,A5,A6,A7,A8,A9,G,G1,G2,G3,G4,G5,G6,G7,G8,G9
"RTN","YSDX3R",40,0)
 K G10,G11,J,K,L,L1,L2,L3,L4,L5,L6,L7,L8,L9,L10,L11,M,W,X,Y,Y1
"RTN","YSDX3R",41,0)
 K YSAX4,YSD3FLG,YSDIFLG,YSDXNN,YSDXN,YSML,YSMOD,YSDXDT
"RTN","YSDX3R",42,0)
 K TOTSET,SUBSET,YSDFN,YSAUTH,YSCD,YSCOND,YSDOB,YSDTM,YSDXS
"RTN","YSDX3R",43,0)
 K YSFHDR,YSFTR,YSGAF,YSLC,YSLFT,YSNM,YSPP,YSPS,YSSL,YSSSN
"RTN","YSDX3R",44,0)
 K YSSTOP,YST,YSTM,YSTOP1,YSTOP2,YSTY,YSAGE,YSDUZ,YSSEX,YSQT
"RTN","YSDX3R",45,0)
 K Z,Z1,YSLCN,YSCON,DIWR,DIWL,DIWF,YSFFS
"RTN","YSDX3R",46,0)
 QUIT
"RTN","YSDX3R",47,0)
 ;
"RTN","YSDX3R",48,0)
EOR ;YSDX3R - Print Diagnosis for Medical Record ;12/6/90 11:19
"RTN","YSDX3R1")
0^4^B14732518^B12384514
"RTN","YSDX3R1",1,0)
YSDX3R1 ;SLC/DJP/LJA - Print of DXLS History for Mental Health Med Rec ;10 May 2013  4:05 PM
"RTN","YSDX3R1",2,0)
 ;;5.01;MENTAL HEALTH;**107**;Dec 30, 1994;Build 23
"RTN","YSDX3R1",3,0)
 ;
"RTN","YSDX3R1",4,0)
 ; Called from the top by MENU option YSDIAGP-DXLS
"RTN","YSDX3R1",5,0)
 ;D RECORD^YSDX0001("YSDX3R1^YSDX3R1") ;Used for testing.  Inactivated in YSDX0001...
"RTN","YSDX3R1",6,0)
 ;
"RTN","YSDX3R1",7,0)
ENTRY ;
"RTN","YSDX3R1",8,0)
 ;D RECORD^YSDX0001("ENTRY^YSDX3R1") ;Used for testing.  Inactivated in YSDX0001...
"RTN","YSDX3R1",9,0)
 W @IOF W !!?IOM-$L("DXLS HISTORY")\2," DXLS HISTORY ",!!
"RTN","YSDX3R1",10,0)
 D ^YSLRP I YSTOUT!YSUOUT!(YSDFN'>0) D END Q
"RTN","YSDX3R1",11,0)
 I '$D(^YSD(627.8,"AD",YSDFN)) W !!?10,"No history on file for ",YSNM D END Q
"RTN","YSDX3R1",12,0)
DEVICE ;
"RTN","YSDX3R1",13,0)
 ;D RECORD^YSDX0001("DEVICE^YSDX3R1") ;Used for testing.  Inactivated in YSDX0001...
"RTN","YSDX3R1",14,0)
 K IOP S %ZIS="Q" D ^%ZIS Q:POP
"RTN","YSDX3R1",15,0)
 I $D(IO("Q")) S ZTRTN="ENPR^YSDX3R1",(ZTSAVE("A"),ZTSAVE("YS*"))="",ZTDESC="YS DXLS PRINT" D ^%ZTLOAD Q
"RTN","YSDX3R1",16,0)
 ;
"RTN","YSDX3R1",17,0)
ENPR ;Entry to core of print program.
"RTN","YSDX3R1",18,0)
 ;D RECORD^YSDX0001("ENPR^YSDX3R1") ;Used for testing.  Inactivated in YSDX0001...
"RTN","YSDX3R1",19,0)
 S YSFHDR="DXLS HISTORY LIST" S YSPP=0
"RTN","YSDX3R1",20,0)
PR ;
"RTN","YSDX3R1",21,0)
 ;D RECORD^YSDX0001("PR^YSDX3R1") ;Used for testing.  Inactivated in YSDX0001...
"RTN","YSDX3R1",22,0)
 U IO D:'$D(YSNOFORM) ENHD^YSFORM S Y1=0,YST=$S(IOST?1"P".E:1,1:0),YSSL=$S(YST:8,1:3),YSLFT=0
"RTN","YSDX3R1",23,0)
 W !!,"Prinicipal Diagnosis (DXLS):  "
"RTN","YSDX3R1",24,0)
 S YSLFT=0
"RTN","YSDX3R1",25,0)
 S J=0 F  S J=$O(^YSD(627.8,"AH",+YSDFN,J)) QUIT:'J!(YSLFT)  D
"RTN","YSDX3R1",26,0)
 .  S J1=0
"RTN","YSDX3R1",27,0)
 .  F  S J1=$O(^YSD(627.8,"AH",+YSDFN,+J,J1)) QUIT:J1'>0!(YSLFT)  D DXLS
"RTN","YSDX3R1",28,0)
 D FINISH
"RTN","YSDX3R1",29,0)
 I YST=1 D ENFT^YSFORM Q:YSPP
"RTN","YSDX3R1",30,0)
END ;
"RTN","YSDX3R1",31,0)
 ;D RECORD^YSDX0001("END^YSDX3R1") ;Used for testing.  Inactivated in YSDX0001...
"RTN","YSDX3R1",32,0)
 K A,A1,A2,A3,A4,A5,A6,A7,A8,G,G1,G2,G3,G4,G5,G6,G11,J,J5,J50,K,L,L1
"RTN","YSDX3R1",33,0)
 K L2,L3,L4,L5,L6,L7,L8,L9,L10,L11,W,YSMOD,YSDXNN,YSDXN,YSML
"RTN","YSDX3R1",34,0)
 K YSDXDT,YSDFN,YSAUTH,YSCD,YSCOND,YSDOB,YSDTM,YSDXS,YSFHDR
"RTN","YSDX3R1",35,0)
 K YSFTR,YSLC,YSLFT,YSCON,YSNM,YSPP,YSPS,YSSL,YSSSN,YSSTOP
"RTN","YSDX3R1",36,0)
 K YST,YSTM,YSAGE,YSDUZ,YSSEX,YSQT,DIWF,DIWR,DIWL
"RTN","YSDX3R1",37,0)
 D ^%ZISC,KILL^%ZTLOAD
"RTN","YSDX3R1",38,0)
 QUIT
"RTN","YSDX3R1",39,0)
DXLS ;
"RTN","YSDX3R1",40,0)
 ;D RECORD^YSDX0001("DXLS^YSDX3R1") ;Used for testing.  Inactivated in YSDX0001...
"RTN","YSDX3R1",41,0)
 N YSDXI
"RTN","YSDX3R1",42,0)
 I $Y+YSSL+4>IOSL D CK^YSDX3RU Q:YSTOUT!YSUOUT!YSTOUT  ;->
"RTN","YSDX3R1",43,0)
 ;
"RTN","YSDX3R1",44,0)
 ;  J2=Diagnosis variable pointer  Y=Date/time of Diagnosis
"RTN","YSDX3R1",45,0)
 N YSDXLSD2,YSDXDATA
"RTN","YSDX3R1",46,0)
 S J2=$P(^YSD(627.8,J1,1),U),(Y,YSDXLSD2)=$P(^(0),U,3) D DD^%DT S YSDXLSD=Y
"RTN","YSDX3R1",47,0)
 ;
"RTN","YSDX3R1",48,0)
 ;  J5=Full global reference to pointed to Diagnosis
"RTN","YSDX3R1",49,0)
 S J3=$P(J2,";",2),J4=$P(J2,";"),J5="^"_J3_J4_","_0_")"
"RTN","YSDX3R1",50,0)
 ;
"RTN","YSDX3R1",51,0)
 ;  J50=0 node of pointed to Diagnosis
"RTN","YSDX3R1",52,0)
 S J50=@J5
"RTN","YSDX3R1",53,0)
 ;
"RTN","YSDX3R1",54,0)
 S YSDXCSTX=""
"RTN","YSDX3R1",55,0)
 ;  If DSM table...
"RTN","YSDX3R1",56,0)
 I J3["YSD" D
"RTN","YSDX3R1",57,0)
 .  S YSDXLSN=$G(^YSD(627.7,+J4,"D")) ;        Diagnosis name
"RTN","YSDX3R1",58,0)
 .  S YSDXLS=$P(J50,U)                ;        ICD Code#
"RTN","YSDX3R1",59,0)
 .  S YSDXCSTX="(ICD-"_$S($P(J50,U,8)'="":$P(J50,U,8),1:"9")_")"
"RTN","YSDX3R1",60,0)
 ;
"RTN","YSDX3R1",61,0)
 ;  If ICD9 table...
"RTN","YSDX3R1",62,0)
 I J3["ICD9(" D
"RTN","YSDX3R1",63,0)
 .  S YSDXDATA=$$ICDDATA^ICDXCODE("DIAG",J4,YSDXLSD2,"I")
"RTN","YSDX3R1",64,0)
 .  S YSDXLSN=$P(YSDXDATA,U,4)     ;        Diagnosis (free text)
"RTN","YSDX3R1",65,0)
 .  S YSDXLS=$P(YSDXDATA,U,2)      ;        ICD Code#
"RTN","YSDX3R1",66,0)
 .  S YSDXCSTX=$P($P($$SINFO^ICDEX($P(YSDXDATA,U,20)),U,2),"-",2)
"RTN","YSDX3R1",67,0)
 .  S YSDXCSTX="(ICD-"_YSDXCSTX_")"
"RTN","YSDX3R1",68,0)
 ;
"RTN","YSDX3R1",69,0)
 ;  Do MODIFIERs exist?
"RTN","YSDX3R1",70,0)
 I $D(^YSD(627.8,J1,5)) D
"RTN","YSDX3R1",71,0)
 .  S YSML=$P(^YSD(627.8,J1,5,0),U,3) ; Last IEN for MODIFIERs multiple
"RTN","YSDX3R1",72,0)
 .  F YSDXI=1:1:YSML D  ; Loop thru each multiple entry
"RTN","YSDX3R1",73,0)
 .  .  S M1=$G(^YSD(627.8,J1,5,+YSDXI,0)) ;  MODIFIER's 0 node
"RTN","YSDX3R1",74,0)
 .  .  QUIT:M1']""  ;->
"RTN","YSDX3R1",75,0)
 .  .  S YSMOD(+YSDXI)=$P(M1,U,3) ;          'Stands For'
"RTN","YSDX3R1",76,0)
 .  .  K M1
"RTN","YSDX3R1",77,0)
AUTH ;
"RTN","YSDX3R1",78,0)
 ;D RECORD^YSDX0001("AUTH^YSDX3R1") ;Used for testing.  Inactivated in YSDX0001...
"RTN","YSDX3R1",79,0)
 S J6=+$P(^YSD(627.8,J1,0),U,4) ;    Diagnosis by
"RTN","YSDX3R1",80,0)
 S J7=$P(^VA(200,+J6,0),U) ;         Name of diagnoser
"RTN","YSDX3R1",81,0)
 S J8=$P($G(^VA(200,J6,0)),U,9) ;    Title pointer
"RTN","YSDX3R1",82,0)
 S:J8]"" J8=$P(^DIC(3.1,J8,0),U) ;   Title file
"RTN","YSDX3R1",83,0)
 S YSAUTH=J7_"  "_J8
"RTN","YSDX3R1",84,0)
 QUIT:'$D(YSDXLS)  ;->
"RTN","YSDX3R1",85,0)
 W !!?3,YSDXCSTX,?12,YSDXLS_" "_$E(YSDXLSN,1,56)
"RTN","YSDX3R1",86,0)
 I $D(YSMOD) F YSDXI=1:1:YSML I $D(YSMOD(YSDXI)) W:$TR(YSMOD(YSDXI)," ","")]"" !?8,"---"_YSMOD(YSDXI)
"RTN","YSDX3R1",87,0)
COMMENT ;
"RTN","YSDX3R1",88,0)
 ;D RECORD^YSDX0001("COMMENT^YSDX3R1") ;Used for testing.  Inactivated in YSDX0001...
"RTN","YSDX3R1",89,0)
 I $D(^YSD(627.8,J1,80,0)) D
"RTN","YSDX3R1",90,0)
 .  W !?9,"Comments:  ",!
"RTN","YSDX3R1",91,0)
 .  S DIWL=18,DIWR=75,DIWF="W" K ^UTILITY($J,"W")
"RTN","YSDX3R1",92,0)
 .  S K=0 F  S K=$O(^YSD(627.8,J1,80,K)) Q:'K  S X=^(K,0) D ^DIWP
"RTN","YSDX3R1",93,0)
 I $D(K),K<1 D ^DIWW K ^UTILITY($J,"W")
"RTN","YSDX3R1",94,0)
 W !?9,"Entered by:  ",YSAUTH,!?9,"Dated ",YSDXLSD,!
"RTN","YSDX3R1",95,0)
 QUIT
"RTN","YSDX3R1",96,0)
 ;
"RTN","YSDX3R1",97,0)
FINISH ;
"RTN","YSDX3R1",98,0)
 ;D RECORD^YSDX0001("FINISH^YSDX3R1") ;Used for testing.  Inactivated in YSDX0001...
"RTN","YSDX3R1",99,0)
 K J1,J2,J3,J4,J5,J6,YSDXCSTX,YSDXLSN,YSDXLS,YSDXLSD,YSMOD
"RTN","YSDX3R1",100,0)
 QUIT
"RTN","YSDX3R1",101,0)
 ;
"RTN","YSDX3RU")
0^5^B18652946^B16343231
"RTN","YSDX3RU",1,0)
YSDX3RU ;SLC/DJP/LJA - Print Utilities for Diagnoses Reporting in H Med Rec ;13 May 2013  9:54 AM
"RTN","YSDX3RU",2,0)
 ;;5.01;MENTAL HEALTH;**107**;Dec 30, 1994;Build 23
"RTN","YSDX3RU",3,0)
 ;D RECORD^YSDX0001("YSDX3RU^YSDX3RU") ;Used for testing.  Inactivated in YSDX0001...
"RTN","YSDX3RU",4,0)
 ;
"RTN","YSDX3RU",5,0)
DX ; Called from routines YSDX3R, YSPP6
"RTN","YSDX3RU",6,0)
 ; Lists out diagnoses sequentially
"RTN","YSDX3RU",7,0)
 ;D RECORD^YSDX0001("DX^YSDX3RU") ;Used for testing.  Inactivated in YSDX0001...
"RTN","YSDX3RU",8,0)
 S L="" ; DFN
"RTN","YSDX3RU",9,0)
 F  S L=$O(^YSD(627.8,"AG",L)) QUIT:L=""  D
"RTN","YSDX3RU",10,0)
 .  S L1="" ; Global Reference to DSM or ICD DIAGNOSIS tables
"RTN","YSDX3RU",11,0)
 .  F  S L1=$O(^YSD(627.8,"AG",L,YSDFN,L1)) QUIT:L1=""  D
"RTN","YSDX3RU",12,0)
 .  .  S L2=0 ; IEN
"RTN","YSDX3RU",13,0)
 .  .  F  S L2=$O(^YSD(627.8,"AG",L,YSDFN,L1,L2)) QUIT:'L2  D COND Q:YSLFT  D DXVAR
"RTN","YSDX3RU",14,0)
 QUIT
"RTN","YSDX3RU",15,0)
 ;
"RTN","YSDX3RU",16,0)
CHR ; called from routine YSDX3R, YSPP6
"RTN","YSDX3RU",17,0)
 ;D RECORD^YSDX0001("CHR^YSDX3RU") ;Used for testing.  Inactivated in YSDX0001...
"RTN","YSDX3RU",18,0)
 S L=0
"RTN","YSDX3RU",19,0)
 F  S L=$O(^YSD(627.8,"AF",YSDFN,L)) QUIT:'L  D  ;Inverse date
"RTN","YSDX3RU",20,0)
 .  S L1=""
"RTN","YSDX3RU",21,0)
 .  F  S L1=$O(^YSD(627.8,"AF",YSDFN,+L,L1)) QUIT:L1=""  D  ;Global ref
"RTN","YSDX3RU",22,0)
 .  .  S L2=0
"RTN","YSDX3RU",23,0)
 .  .  F  S L2=$O(^YSD(627.8,"AF",YSDFN,L,L1,L2)) QUIT:'L2  D COND Q:YSLFT  S (YSTOP1,YSTOP2)=1 D DXVAR
"RTN","YSDX3RU",24,0)
 QUIT
"RTN","YSDX3RU",25,0)
 ;
"RTN","YSDX3RU",26,0)
COND ;
"RTN","YSDX3RU",27,0)
 ;D RECORD^YSDX0001("COND^YSDX3RU") ;Used for testing.  Inactivated in YSDX0001...
"RTN","YSDX3RU",28,0)
 S:$D(YSPPF) YSPPF=2 K YSSTOP S YSCD=$P(^YSD(627.8,L2,1),U,4)
"RTN","YSDX3RU",29,0)
 S YSCOND=$S(YSCD["A":"A C T I V E",YSCD["I":"I N A C T I V E",1:"")
"RTN","YSDX3RU",30,0)
 I YSTY="ACT" S:YSCD="I" YSSTOP=1
"RTN","YSDX3RU",31,0)
 QUIT
"RTN","YSDX3RU",32,0)
 ;
"RTN","YSDX3RU",33,0)
DXVAR ;
"RTN","YSDX3RU",34,0)
 ;D RECORD^YSDX0001("DXVAR^YSDX3RU") ;Used for testing.  Inactivated in YSDX0001...
"RTN","YSDX3RU",35,0)
 N YSDXI
"RTN","YSDX3RU",36,0)
 QUIT:$D(YSSTOP)  ;->
"RTN","YSDX3RU",37,0)
 ;
"RTN","YSDX3RU",38,0)
 S YSDXCSTX=""
"RTN","YSDX3RU",39,0)
 ;  Points to ^YSD(627.7 ?
"RTN","YSDX3RU",40,0)
 I L1["YSD" D
"RTN","YSDX3RU",41,0)
 .  S YSD3FLG="DSM DIAGNOSES: "
"RTN","YSDX3RU",42,0)
 .  S L4=$P(L1,";",2) ;             Global reference
"RTN","YSDX3RU",43,0)
 .  S L5=+$P(L1,";") ;              IEN
"RTN","YSDX3RU",44,0)
 .  S L6="^"_L4_L5_","_0_")" ;      Global reference of 0 node
"RTN","YSDX3RU",45,0)
 .  S L60=@L6 ;                     0 node's data
"RTN","YSDX3RU",46,0)
 .  S YSDXN=^YSD(627.7,+L5,"D") ;   Diagnosis name
"RTN","YSDX3RU",47,0)
 .  S YSDXNN=$P(L60,U) ;            ICD Code
"RTN","YSDX3RU",48,0)
 .  S YSDXCSTX="(ICD-"_$S($P(L60,U,8)'="":$P(L60,U,8),1:"9")_")"
"RTN","YSDX3RU",49,0)
 ;
"RTN","YSDX3RU",50,0)
 ;  Points to ^ICD9( ?
"RTN","YSDX3RU",51,0)
 I L1["ICD" D
"RTN","YSDX3RU",52,0)
 .  S YSDIFLG="ICD DIAGNOSES: "
"RTN","YSDX3RU",53,0)
 .  S L4=$P(L1,";",2) ;             Global reference
"RTN","YSDX3RU",54,0)
 .  S L5=+$P(L1,";") ;              IEN
"RTN","YSDX3RU",55,0)
 .  S L6="^"_L4_L5_","_0_")" ;      Global reference of 0 node
"RTN","YSDX3RU",56,0)
 .  S L60=@L6 ;                     0 node's data
"RTN","YSDX3RU",57,0)
 .  N YSDXDATA S YSDXDATA=$$ICDDATA^ICDXCODE("DIAG",L5,$P(^YSD(627.8,+L2,0),U,3),"I")
"RTN","YSDX3RU",58,0)
 .  S YSDXN=$P(YSDXDATA,U,4) ;      Diagnosis (free text)
"RTN","YSDX3RU",59,0)
 .  S YSDXNN=$P(YSDXDATA,U,2) ;     ICD Code
"RTN","YSDX3RU",60,0)
 .  S YSDXCSTX=$P($P($$SINFO^ICDEX($P(YSDXDATA,U,20)),U,2),"-",2)
"RTN","YSDX3RU",61,0)
 .  S YSDXCSTX="(ICD-"_YSDXCSTX_")"
"RTN","YSDX3RU",62,0)
 ;
"RTN","YSDX3RU",63,0)
 ;  Modifiers?
"RTN","YSDX3RU",64,0)
 I $D(^YSD(627.8,+L2,5)) D
"RTN","YSDX3RU",65,0)
 .  S YSML=$P(^YSD(627.8,+L2,5,0),U,3)
"RTN","YSDX3RU",66,0)
 .  F YSDXI=1:1:YSML D
"RTN","YSDX3RU",67,0)
 .  .  S M1=$G(^YSD(627.8,+L2,5,+YSDXI,0))
"RTN","YSDX3RU",68,0)
 .  .  QUIT:M1']""  ;->
"RTN","YSDX3RU",69,0)
 .  .  S YSMOD(+YSDXI)=$P(M1,U,3)
"RTN","YSDX3RU",70,0)
 .  .  K M1
"RTN","YSDX3RU",71,0)
 ;
"RTN","YSDX3RU",72,0)
 ;  Status
"RTN","YSDX3RU",73,0)
 S L8=$P(^YSD(627.8,+L2,1),U,2)
"RTN","YSDX3RU",74,0)
 S YSDXS=$S(L8="v":"VERIFIED",L8="p":"PROVISIONAL",L8="i":"INACTIVE",L8="r":"REFORMULATED",L8="n":"NOT FOUND",L8="ru":"RULE OUT",1:"")
"RTN","YSDX3RU",75,0)
 S Y=$P(^YSD(627.8,+L2,0),U,3) D DD^%DT S YSDXDT=Y
"RTN","YSDX3RU",76,0)
 ;
"RTN","YSDX3RU",77,0)
AUTH ;
"RTN","YSDX3RU",78,0)
 ;D RECORD^YSDX0001("AUTH^YSDX3RU") ;Used for testing.  Inactivated in YSDX0001...
"RTN","YSDX3RU",79,0)
 ;  Diagnosed by
"RTN","YSDX3RU",80,0)
 S L9=+$P(^YSD(627.8,L2,0),U,4)
"RTN","YSDX3RU",81,0)
 I L9>0 D
"RTN","YSDX3RU",82,0)
 .  S L10=$P($G(^VA(200,L9,0)),U) ;      New Person's name
"RTN","YSDX3RU",83,0)
 .  S L11=$P($G(^VA(200,L9,0)),U,9) ;    Title
"RTN","YSDX3RU",84,0)
 .  S:L11>0 L11=$P(^DIC(3.1,+L11,0),U) ; Title file
"RTN","YSDX3RU",85,0)
 .  S YSAUTH=L10_"  "_L11
"RTN","YSDX3RU",86,0)
PRINTL ;
"RTN","YSDX3RU",87,0)
 ;D RECORD^YSDX0001("PRINTL^YSDX3RU") ;Used for testing.  Inactivated in YSDX0001...
"RTN","YSDX3RU",88,0)
 I $Y+YSSL+4>IOSL D CK Q:YSTOUT!(YSUOUT)!(YSLFT)
"RTN","YSDX3RU",89,0)
 I $D(YSD3FLG)&'$D(YSTOP1) W !!,YSD3FLG S YSTOP1=1
"RTN","YSDX3RU",90,0)
 I $D(YSDIFLG)&'$D(YSTOP2) W !!,YSDIFLG S YSTOP2=1
"RTN","YSDX3RU",91,0)
 W !!,YSDXCSTX," ",YSDXNN,!?3,$E(YSDXN,1,76),!?3,YSCOND
"RTN","YSDX3RU",92,0)
 I $D(YSMOD) F I=1:1:YSML I $D(YSMOD(I)) W:$TR(YSMOD(I)," ","")]"" !?8,"--- "_YSMOD(I)
"RTN","YSDX3RU",93,0)
 W:YSDXS'=" " !?8,"--- "_YSDXS
"RTN","YSDX3RU",94,0)
 I $D(^YSD(627.8,L2,80,0)) W !?8,"Comments:  " S DIWL=20,DIWR=75,DIWF="W" K ^UTILITY($J,"W") S M=0 F  S M=$O(^YSD(627.8,L2,80,M)) Q:'M  S X=^(M,0) D ^DIWP
"RTN","YSDX3RU",95,0)
 I $D(M),M<1 D ^DIWW K ^UTILITY($J,"W")
"RTN","YSDX3RU",96,0)
 W !?8,"Entered by:  " W:$D(YSAUTH) YSAUTH W !?8,"Dated: ",?21,YSDXDT
"RTN","YSDX3RU",97,0)
 QUIT
"RTN","YSDX3RU",98,0)
 ;
"RTN","YSDX3RU",99,0)
CK ; Called by routines YSDX3R1, YSDX3RUA
"RTN","YSDX3RU",100,0)
 ;D RECORD^YSDX0001("CK^YSDX3RU") ;Used for testing.  Inactivated in YSDX0001...
"RTN","YSDX3RU",101,0)
 I 'YST D WAIT^YSUTL W:YSTOUT!YSUOUT @IOF Q
"RTN","YSDX3RU",102,0)
 S:YSSL YSCON=1 D ENFT^YSFORM D:($Y+YSSL+4>IOSL) ENHD^YSFORM Q
"RTN","YSDX3RU",103,0)
ENPP ;
"RTN","YSDX3RU",104,0)
 ;D RECORD^YSDX0001("ENPP^YSDX3RU") ;Used for testing.  Inactivated in YSDX0001...
"RTN","YSDX3RU",105,0)
 S YSFHDR="DIAGNOSIS LIST",YSPP=1 G PR^YSDX3R
"RTN","YSDX3RU",106,0)
 ;
"RTN","YSDX3RU",107,0)
FINISH ; Called by routines YSDX3R, YSDX3RUA
"RTN","YSDX3RU",108,0)
 ;D RECORD^YSDX0001("FINISH^YSDX3RU") ;Used for testing.  Inactivated in YSDX0001...
"RTN","YSDX3RU",109,0)
 K YSDXCSTX,YSFFS I $D(YSNOFORM) D ^%ZISC,KILL^%ZTLOAD Q
"RTN","YSDX3RU",110,0)
 W !!?10,"*** LIST COMPLETE ***",! S YSFFS=1
"RTN","YSDX3RU",111,0)
 I YST=1 D ENFT^YSFORM,^%ZISC,KILL^%ZTLOAD Q
"RTN","YSDX3RU",112,0)
 D WAIT^YSUTL
"RTN","YSDX3RU",113,0)
 QUIT
"RTN","YSDX3RU",114,0)
 ;
"RTN","YSDX3RU",115,0)
EOR ;YSDX3RU-Print Utilities for Diagnoses in Med Record ;10/19/89  17:10
"RTN","YSDX3RUA")
0^6^B11544706^B9895863
"RTN","YSDX3RUA",1,0)
YSDX3RUA ;SLC/DJP - Print Utilities for Diagnoses Reporting in MH - Cont ;13 May 2013  9:21 AM
"RTN","YSDX3RUA",2,0)
 ;;5.01;MENTAL HEALTH;**16,107**;Dec 30, 1994;Build 23
"RTN","YSDX3RUA",3,0)
 ;D RECORD^YSDX0001("^YSDX3RUA") ;Used for testing.  Inactivated in YSDX0001...
"RTN","YSDX3RUA",4,0)
 ;
"RTN","YSDX3RUA",5,0)
AX4 ;  Called by routine YSDX3R
"RTN","YSDX3RUA",6,0)
 ; Print latest Axis 4 information
"RTN","YSDX3RUA",7,0)
 ;D RECORD^YSDX0001("AX4^YSDX3RUA") ;Used for testing.  Inactivated in YSDX0001...
"RTN","YSDX3RUA",8,0)
 Q:'$D(^YSD(627.8,"AX4",YSDFN))  S A1=0 F I=1:1:1 S A1=$O(^YSD(627.8,"AX4",YSDFN,A1)) Q:'A1  S A2=0 F  S A2=$O(^YSD(627.8,"AX4",YSDFN,A1,A2)) Q:'A2  D AX4P
"RTN","YSDX3RUA",9,0)
 Q
"RTN","YSDX3RUA",10,0)
AX4P ;
"RTN","YSDX3RUA",11,0)
 ;D RECORD^YSDX0001("AX4P^YSDX3RUA") ;Used for testing.  Inactivated in YSDX0001...
"RTN","YSDX3RUA",12,0)
 S YSPS=$P($G(^YSD(627.8,A2,60)),U) S:YSPS']"" YSPS="None given" S A3=$P(^(60),U,2),Y=$P(^(0),U,3) D DD^%DT S A9=$P(Y,"@")
"RTN","YSDX3RUA",13,0)
 S TOTSET=";"_$P(^DD(627.8,61,0),U,3),SUBSET=$F(TOTSET,";"_A3_":") I SUBSET S YSAX4=$E($P($E(TOTSET,SUBSET,999),";"),1,50) I $Y+YSSL+4>IOSL D CK^YSDX3RU Q:YSTOUT!YSUOUT!YSLFT
"RTN","YSDX3RUA",14,0)
 W !!,"AXIS IV:  Psychosocial stressors: ",YSPS,!?10,"Severity: ",A3_"--"_YSAX4,!?10,"Dated:    ",A9
"RTN","YSDX3RUA",15,0)
 Q
"RTN","YSDX3RUA",16,0)
AX5 ; Called by routine YSSP6
"RTN","YSDX3RUA",17,0)
 ;
"RTN","YSDX3RUA",18,0)
 ;D RECORD^YSDX0001("AX5^YSDX3RUA") ;Used for testing.  Inactivated in YSDX0001...
"RTN","YSDX3RUA",19,0)
 Q:'$D(^YSD(627.8,"AX5",YSDFN))  S A5=$O(^YSD(627.8,"AX5",YSDFN,0)) Q:'A5  S A6=$O(^YSD(627.8,"AX5",YSDFN,A5,0)) Q:'A6  S A7=$P(^YSD(627.8,A6,60),U,3) D GAF^YSDX3UB
"RTN","YSDX3RUA",20,0)
 S Y=$P(^YSD(627.8,A6,0),U,3) D DD^%DT S A8=$P(Y,"@")
"RTN","YSDX3RUA",21,0)
 I $Y+YSSL+4>IOSL D CK^YSDX3RU Q:YSTOUT!YSUOUT!YSLFT
"RTN","YSDX3RUA",22,0)
 W !!,"AXIS V:   Current GAF: ",A7_" (as of "_A8_")",!?10,"Highest GAF past year: ",$S($D(G5):G5,1:"No other GAF for past year") I $D(G5) W "  (dtd "_$S($D(G11):G11,1:"Date Missing")_")",!
"RTN","YSDX3RUA",23,0)
 D FINISH^YSDX3RU
"RTN","YSDX3RUA",24,0)
 QUIT
"RTN","YSDX3RUA",25,0)
 ;
"RTN","YSDX3RUA",26,0)
DXLS ; Called by routines YSDX3R, YSPP6
"RTN","YSDX3RUA",27,0)
 ; This subroutine looks up and displays the diagnosis for Length of Stay (DXLS)
"RTN","YSDX3RUA",28,0)
 ;D RECORD^YSDX0001("DXLS^YSDX3RUA") ;Used for testing.  Inactivated in YSDX0001...
"RTN","YSDX3RUA",29,0)
 Q:'$D(^YSD(627.8,"AD",YSDFN))
"RTN","YSDX3RUA",30,0)
 S J=$O(^YSD(627.8,"AD",YSDFN,0)) ; Inverse date
"RTN","YSDX3RUA",31,0)
DXLS1 ;
"RTN","YSDX3RUA",32,0)
 ;D RECORD^YSDX0001("DXLS1^YSDX3RUA") ;Used for testing.  Inactivated in YSDX0001...
"RTN","YSDX3RUA",33,0)
 S J1=$O(^YSD(627.8,"AD",YSDFN,J,0)) ;       IEN
"RTN","YSDX3RUA",34,0)
 S J2=$P(^YSD(627.8,+J1,1),U) ;               Diag variable pointer
"RTN","YSDX3RUA",35,0)
 S (Y,YSDXLSD2)=$P(^YSD(627.8,+J1,0),U,3) D DD^%DT S YSDXLSD=Y ; Diag Date/time
"RTN","YSDX3RUA",36,0)
 S J3=$P(J2,";",2) ;                  Global ref
"RTN","YSDX3RUA",37,0)
 S J4=+$P(J2,";") ;                   IEN
"RTN","YSDX3RUA",38,0)
 S J5="^"_J3_J4_","_0_")" ;           Global ref of 0 node
"RTN","YSDX3RUA",39,0)
 S J50=@J5 ;                          Data for 0 node
"RTN","YSDX3RUA",40,0)
 ;
"RTN","YSDX3RUA",41,0)
 S YSDXCSTX=""
"RTN","YSDX3RUA",42,0)
 ;  DSM?
"RTN","YSDX3RUA",43,0)
 I J3["YSD" D
"RTN","YSDX3RUA",44,0)
 .  S YSDXLSN=^YSD(627.7,+J4,"D") ;   Diagnosis name
"RTN","YSDX3RUA",45,0)
 .  S YSDXLS=$P(J50,U,1) ;            ICD Code
"RTN","YSDX3RUA",46,0)
 .  S YSDXCSTX="(ICD-"_$S($P(J50,U,8)'="":$P(J50,U,8),1:"9")_")"
"RTN","YSDX3RUA",47,0)
 ;
"RTN","YSDX3RUA",48,0)
 ;  ICD9?
"RTN","YSDX3RUA",49,0)
 I J3["ICD9(" D
"RTN","YSDX3RUA",50,0)
 .  N YSDXDATA S YSDXDATA=$$ICDDATA^ICDXCODE("DIAG",J4,YSDXLSD2,"I")
"RTN","YSDX3RUA",51,0)
 .  S YSDXLSN=$P(YSDXDATA,U,4) ;      Diagnosis name
"RTN","YSDX3RUA",52,0)
 .  S YSDXLS=$P(YSDXDATA,U,2) ;       ICD Code
"RTN","YSDX3RUA",53,0)
 .  S YSDXCSTX=$P($P($$SINFO^ICDEX($P(YSDXDATA,U,20)),U,2),"-",2)
"RTN","YSDX3RUA",54,0)
 .  S YSDXCSTX="(ICD-"_YSDXCSTX_")"
"RTN","YSDX3RUA",55,0)
 ;
"RTN","YSDX3RUA",56,0)
 I $D(YSDXLS) D
"RTN","YSDX3RUA",57,0)
 .  W !!,"Principal Diagnosis (DXLS):  ",!!?3
"RTN","YSDX3RUA",58,0)
 .  W YSDXCSTX_" "_YSDXLS_" "_$E(YSDXLSN,1,59),!?8," dated ",YSDXLSD
"RTN","YSDX3RUA",59,0)
 ;
"RTN","YSDX3RUA",60,0)
 ;  Modifiers?
"RTN","YSDX3RUA",61,0)
 I $D(^YSD(627.8,+J1,5)) D
"RTN","YSDX3RUA",62,0)
 .  S J6=$P(^YSD(627.8,+J1,5,0),U,3) ; Stands for
"RTN","YSDX3RUA",63,0)
 .  F I=1:1:J6 W !?3,"--- ",$P(^YSD(627.8,+J1,5,I,0),U,3)
"RTN","YSDX3RUA",64,0)
 ;
"RTN","YSDX3RUA",65,0)
 K J1,J2,J3,J4,J5,J50,J6,YSDXCSTX,YSDXLSN,YSDXLS,YSDXLSD,YSCON
"RTN","YSDX3RUA",66,0)
 QUIT
"RTN","YSDX3RUA",67,0)
 ;
"RTN","YSDX3RUA",68,0)
EOR ;YSDX3RUA - Print Utilities for Diagnoses reporting - continued ;9/18/92 15:37
"RTN","YSDX3U")
0^7^B21590008^B19122037
"RTN","YSDX3U",1,0)
YSDX3U ;SLC/DJP/LJA - Utilities for Diagnoses Entered in MH Med Record ;13 May 2013  12:43 PM
"RTN","YSDX3U",2,0)
 ;;5.01;MENTAL HEALTH;**107**;Dec 30, 1994;Build 23
"RTN","YSDX3U",3,0)
 ;D RECORD^YSDX0001("^YSDX3U") ;Used for testing.  Inactivated in YSDX0001...
"RTN","YSDX3U",4,0)
 ;
"RTN","YSDX3U",5,0)
END K YSDXDAT D END^YSDX3U00 ;->
"RTN","YSDX3U",6,0)
 QUIT
"RTN","YSDX3U",7,0)
 ;
"RTN","YSDX3U",8,0)
LIST ; Called by routines YSDX3, YSDX3A, YSDX3U
"RTN","YSDX3U",9,0)
 ; List diagnoses on file for a specific patient
"RTN","YSDX3U",10,0)
 ;D RECORD^YSDX0001("LIST^YSDX3U") ;Used for testing.  Inactivated in YSDX0001...
"RTN","YSDX3U",11,0)
 K YSDXN,YSDXNN,YSDXST,YSMOD,YSDXDT,YSNO S N1=0
"RTN","YSDX3U",12,0)
 I '$O(^YSD(627.8,"AC",YSDFN,0)) D  QUIT  ;->
"RTN","YSDX3U",13,0)
 .  W !?10,"No diagnoses on file for ",YSNM S YSNO=1
"RTN","YSDX3U",14,0)
 ;
"RTN","YSDX3U",15,0)
AXIS1 ;  DSM display
"RTN","YSDX3U",16,0)
 ;D RECORD^YSDX0001("AXIS1^YSDX3U") ;Used for testing.  Inactivated in YSDX0001...
"RTN","YSDX3U",17,0)
 I YSAX=1 D
"RTN","YSDX3U",18,0)
 .  S L2=0
"RTN","YSDX3U",19,0)
 .  F  S L2=$O(^YSD(627.8,"AC",YSDFN,L2)) Q:'L2  D
"RTN","YSDX3U",20,0)
 .  .  S L3=""
"RTN","YSDX3U",21,0)
 .  .  F  S L3=$O(^YSD(627.8,"AC",YSDFN,L2,L3)) Q:L3=""  I $P(L3,";",2)["YSD"  D SELECTL
"RTN","YSDX3U",22,0)
AXIS3 ;  ICD9/ICD10 Display
"RTN","YSDX3U",23,0)
 ;D RECORD^YSDX0001("AXIS3^YSDX3U") ;Used for testing.  Inactivated in YSDX0001...
"RTN","YSDX3U",24,0)
 I YSAX=3 D
"RTN","YSDX3U",25,0)
 .  S L2=0
"RTN","YSDX3U",26,0)
 .  F  S L2=$O(^YSD(627.8,"AC",YSDFN,L2)) Q:'L2  D
"RTN","YSDX3U",27,0)
 .  .  S L3=""
"RTN","YSDX3U",28,0)
 .  .  F  S L3=$O(^YSD(627.8,"AC",YSDFN,L2,L3)) Q:L3=""  I $P(L3,";",2)["ICD"  D SELECTL
"RTN","YSDX3U",29,0)
 QUIT
"RTN","YSDX3U",30,0)
 ;
"RTN","YSDX3U",31,0)
SELECTL ;
"RTN","YSDX3U",32,0)
 ;D RECORD^YSDX0001("SELECTL^YSDX3U") ;Used for testing.  Inactivated in YSDX0001...
"RTN","YSDX3U",33,0)
 S L4=""
"RTN","YSDX3U",34,0)
 F  S L4=$O(^YSD(627.8,"AC",YSDFN,L2,L3,L4)) Q:L4=""  D
"RTN","YSDX3U",35,0)
 .  S L5=0
"RTN","YSDX3U",36,0)
 .  F  S L5=$O(^YSD(627.8,"AC",YSDFN,L2,L3,L4,L5)) Q:'L5  D STATUS,ALST:YSDTY="A",ILST:YSDTY="I",IRNLST:YSDTY="IRN"
"RTN","YSDX3U",37,0)
 QUIT
"RTN","YSDX3U",38,0)
STATUS ;
"RTN","YSDX3U",39,0)
 ;D RECORD^YSDX0001("STATUS^YSDX3U") ;Used for testing.  Inactivated in YSDX0001...
"RTN","YSDX3U",40,0)
 S L9=$P(^YSD(627.8,L5,1),U,2)
"RTN","YSDX3U",41,0)
 S:L9="i" F1=1
"RTN","YSDX3U",42,0)
 S:"rn"[L9!($P(^YSD(627.8,L5,1),U,4)="I") F2=1
"RTN","YSDX3U",43,0)
 QUIT
"RTN","YSDX3U",44,0)
 ;
"RTN","YSDX3U",45,0)
ALST ;
"RTN","YSDX3U",46,0)
 ;D RECORD^YSDX0001("ALST^YSDX3U") ;Used for testing.  Inactivated in YSDX0001...
"RTN","YSDX3U",47,0)
 D:L4="A" PLIST
"RTN","YSDX3U",48,0)
 QUIT
"RTN","YSDX3U",49,0)
 ;
"RTN","YSDX3U",50,0)
ILST ;
"RTN","YSDX3U",51,0)
 ;D RECORD^YSDX0001("ILST^YSDX3U") ;Used for testing.  Inactivated in YSDX0001...
"RTN","YSDX3U",52,0)
 D:L9="i" PLIST
"RTN","YSDX3U",53,0)
 QUIT
"RTN","YSDX3U",54,0)
 ;
"RTN","YSDX3U",55,0)
IRNLST ;
"RTN","YSDX3U",56,0)
 ;D RECORD^YSDX0001("IRNLST^YSDX3U") ;Used for testing.  Inactivated in YSDX0001...
"RTN","YSDX3U",57,0)
 D:L4="I" PLIST
"RTN","YSDX3U",58,0)
 QUIT
"RTN","YSDX3U",59,0)
 ;
"RTN","YSDX3U",60,0)
PLIST ;Sets variables for print of list line
"RTN","YSDX3U",61,0)
 ;
"RTN","YSDX3U",62,0)
 ;  Axis 1
"RTN","YSDX3U",63,0)
 ;D RECORD^YSDX0001("PLIST^YSDX3U") ;Used for testing.  Inactivated in YSDX0001...
"RTN","YSDX3U",64,0)
 S YSDXCSTX=""
"RTN","YSDX3U",65,0)
 I YSAX=1 D
"RTN","YSDX3U",66,0)
 .  S P3=$P(L3,";",2)
"RTN","YSDX3U",67,0)
 .  S P4=$P(L3,";")
"RTN","YSDX3U",68,0)
 .  S P5="^"_P3_P4_","_0_")"
"RTN","YSDX3U",69,0)
 .  S P50=@P5
"RTN","YSDX3U",70,0)
 .  S YSDXN=^YSD(627.7,+P4,"D") ;  Diagnosis name
"RTN","YSDX3U",71,0)
 .  S YSDXNN=$P(P50,U) ;           ICD#
"RTN","YSDX3U",72,0)
 .  S YSDXCSTX="(ICD-"_$S($P(P50,U,8)'="":$P(P50,U,8),1:"9")_")"
"RTN","YSDX3U",73,0)
 ;
"RTN","YSDX3U",74,0)
 ;  Axis 3
"RTN","YSDX3U",75,0)
 I YSAX=3 D
"RTN","YSDX3U",76,0)
 .  S P3=$P(L3,";",2)
"RTN","YSDX3U",77,0)
 .  S P4=$P(L3,";")
"RTN","YSDX3U",78,0)
 .  S P5="^"_P3_P4_","_0_")"
"RTN","YSDX3U",79,0)
 .  S P50=@P5
"RTN","YSDX3U",80,0)
 .  N YSDXDATA S YSDXDATA=$$ICDDATA^ICDXCODE("DIAG",P4,$P(^YSD(627.8,L5,0),U,3),"I")
"RTN","YSDX3U",81,0)
 .  S YSDXNN=$P(YSDXDATA,U,2)   ;  Diagnosis name
"RTN","YSDX3U",82,0)
 .  S YSDXCSTX=$P($P($$SINFO^ICDEX($P(YSDXDATA,U,20)),U,2),"-",2)
"RTN","YSDX3U",83,0)
 .  S YSDXCSTX="(ICD-"_YSDXCSTX_")"
"RTN","YSDX3U",84,0)
 .  S YSDXN=$P(YSDXDATA,U,4)    ;  ICD#
"RTN","YSDX3U",85,0)
 ;
"RTN","YSDX3U",86,0)
 S YSDXST=$S(L9="v":"VERIFIED",L9="p":"PROVISIONAL",L9="i":"INACTIVE",L9="r":"REFORMULATED",L9="n":"NOT FOUND",L9="ru":"RULE OUT",1:"")
"RTN","YSDX3U",87,0)
 S Y=$P(^YSD(627.8,L5,0),U,3) D DD^%DT S YSDXDT=Y
"RTN","YSDX3U",88,0)
 ;
"RTN","YSDX3U",89,0)
 ;  Modifiers
"RTN","YSDX3U",90,0)
 I $D(^YSD(627.8,L5,5)) D
"RTN","YSDX3U",91,0)
 .  S L7=$P(^YSD(627.8,L5,5,0),U,3)
"RTN","YSDX3U",92,0)
 .  F I=1:1:L7 S YSMOD(I)=$P(^YSD(627.8,L5,5,I,0),U,3)
"RTN","YSDX3U",93,0)
 ;
"RTN","YSDX3U",94,0)
 ;  DXLS?
"RTN","YSDX3U",95,0)
 S L10=$P($G(^YSD(627.8,L5,1)),U,6) I L10]"" D
"RTN","YSDX3U",96,0)
 .  S YSDXSTAT="INACTIVATED",Y=$P(^YSD(627.8,L5,1),U,5) D DD^%DT S YSTATDT=Y
"RTN","YSDX3U",97,0)
 ;
"RTN","YSDX3U",98,0)
 S N1=N1+1,N2(N1)=$P(L3,";"),N4=0 K YSSTOP
"RTN","YSDX3U",99,0)
 F N3=1:1 S:P4=N2(N3) N4=N4+1 S:N4>1 YSSTOP=1 Q:N3=N1
"RTN","YSDX3U",100,0)
 QUIT:$D(YSSTOP)  ;->
"RTN","YSDX3U",101,0)
 S P1=P1+1 S P2(P1)=L5
"RTN","YSDX3U",102,0)
PRINT ;
"RTN","YSDX3U",103,0)
 ;D RECORD^YSDX0001("PRINT^YSDX3U") ;Used for testing.  Inactivated in YSDX0001...
"RTN","YSDX3U",104,0)
 Q:YSDTY="IRN"&(L9="i")  ;->
"RTN","YSDX3U",105,0)
 W !,P1,?3,YSDXCSTX," ",YSDXNN,!?3,$E(YSDXN,1,75)
"RTN","YSDX3U",106,0)
 I $D(YSMOD) F I=1:1:L7 I $D(YSMOD(I)) W:$TR(YSMOD(I)," ","")]"" !?8," --- "_YSMOD(I)
"RTN","YSDX3U",107,0)
 W !?8," --- "_YSDXST,?35,YSDXDT I $D(YSDXSTAT) W !?8," --- "_YSDXSTAT,?35,YSTATDT
"RTN","YSDX3U",108,0)
 QUIT
"RTN","YSDX3U",109,0)
 ;
"RTN","YSDX3U",110,0)
INQ ; Called by routines YSDX3, YSDX3A
"RTN","YSDX3U",111,0)
 ;D RECORD^YSDX0001("INQ^YSDX3U") ;Used for testing.  Inactivated in YSDX0001...
"RTN","YSDX3U",112,0)
 Q:$D(YSNO)  ;->
"RTN","YSDX3U",113,0)
 K %
"RTN","YSDX3U",114,0)
 S F3=$S(YSAX=1:" Axes 1 & 2 ",YSAX=3:" Axis 3 ",1:"")
"RTN","YSDX3U",115,0)
 I $D(F1) W !!,"List INACTIVE diagnoses" S %=2 D YN^DICN K:%=2 F1 S:%=1 YSDTY="I" I %=0 W !!,"YES will list all INACTIVE,",F3,"diagnoses for ",$E(YSNM,1,20),".",! G INQ
"RTN","YSDX3U",116,0)
 S YSTOUT=$D(DTOUT),YSUOUT=$D(DUOUT) Q:YSTOUT!YSUOUT
"RTN","YSDX3U",117,0)
 I $D(%) I %=-1 Q
"RTN","YSDX3U",118,0)
 I $D(F2) D RNQ I YSTOUT!YSUOUT Q
"RTN","YSDX3U",119,0)
 I $D(F1)!$D(F2) D LIST^YSDX3U I '$D(YSDXN) W !,"No additional",F3,"dx found."
"RTN","YSDX3U",120,0)
 QUIT
"RTN","YSDX3U",121,0)
 ;
"RTN","YSDX3U",122,0)
RNQ ;
"RTN","YSDX3U",123,0)
 ;D RECORD^YSDX0001("RNQ^YSDX3U") ;Used for testing.  Inactivated in YSDX0001...
"RTN","YSDX3U",124,0)
 S %=0
"RTN","YSDX3U",125,0)
 F  Q:$G(%)  W !!,"List REFORMULATED/NOT FOUND diagnoses" S %=2 D
"RTN","YSDX3U",126,0)
 .  D YN^DICN S YSTOUT=$D(DTOUT),YSUOUT=$D(DUOUT) W !
"RTN","YSDX3U",127,0)
 .  I '% D
"RTN","YSDX3U",128,0)
 .  .  W !!,"YES will list, in addition to all INACTIVE"
"RTN","YSDX3U",129,0)
 .  .  W F3,"diagnoses,",!?3," all REFORMULATED/NOT FOUND"
"RTN","YSDX3U",130,0)
 .  .  W F3,"diagnoses on file",!?3,"for ",$E(YSNM,1,20),".",!
"RTN","YSDX3U",131,0)
 I %=2 K F2 QUIT  ;->
"RTN","YSDX3U",132,0)
 S:%=1 YSDTY="IRN"
"RTN","YSDX3U",133,0)
 I %=-1 S YSQT=1
"RTN","YSDX3U",134,0)
 QUIT
"RTN","YSDX3U",135,0)
 ;
"RTN","YSDX3U",136,0)
EOR ;YSDX3U - Utilities for Diagnoses in MH Med Record ;6/30/89 09:49
"RTN","YSDX3UA")
0^8^B20591995^B17115146
"RTN","YSDX3UA",1,0)
YSDX3UA ;SLC/DJP/LJA,HIOFO/FT - Utilities for Dx Entry in MH Med Rec (cont.) ;10 May 2013  2:25 PM
"RTN","YSDX3UA",2,0)
 ;;5.01;MENTAL HEALTH;**96,60,107**;Dec 30, 1994;Build 23
"RTN","YSDX3UA",3,0)
 ;
"RTN","YSDX3UA",4,0)
 ;Reference to ^VA(200, supported by DBIA #10060
"RTN","YSDX3UA",5,0)
 ;Reference to ^ICD9( supported by DBIA #5388
"RTN","YSDX3UA",6,0)
 ;Reference to ^ICDCODE APIs supported by DBIA #3990
"RTN","YSDX3UA",7,0)
 ;
"RTN","YSDX3UA",8,0)
 ;D RECORD^YSDX0001("^YSDX3UA") ;Used for testing.  Inactivated in YSDX0001...
"RTN","YSDX3UA",9,0)
 ;
"RTN","YSDX3UA",10,0)
DSMLK ; Called by routine YSDX3
"RTN","YSDX3UA",11,0)
 ; Keywork lookup for DSM
"RTN","YSDX3UA",12,0)
 ;D RECORD^YSDX0001("DSMLK^YSDX3UA") ;Used for testing.  Inactivated in YSDX0001...
"RTN","YSDX3UA",13,0)
 S X=$P(X1," ") G:$P(X1," ",2)="" LK1
"RTN","YSDX3UA",14,0)
 S Q=$C(34),D="S A=^(1) I "
"RTN","YSDX3UA",15,0)
 F I=2:1 S B=$P(X1," ",I) Q:B=""  S:B'[Q D=D_"(A["" "_B_""")&"
"RTN","YSDX3UA",16,0)
 S DIC("S")=$E(D,1,$L(D)-1)
"RTN","YSDX3UA",17,0)
LK1 ;
"RTN","YSDX3UA",18,0)
 ;D RECORD^YSDX0001("LK1^YSDX3UA") ;Used for testing.  Inactivated in YSDX0001...
"RTN","YSDX3UA",19,0)
 S DIC("S")="I $P(^(0),U,2)=4" ;Allow DSM-IV selection only...
"RTN","YSDX3UA",20,0)
 S DIC(0)="QMZE",DIC="^YSD(627.7,"
"RTN","YSDX3UA",21,0)
 D ^DIC
"RTN","YSDX3UA",22,0)
 K DIC("S")
"RTN","YSDX3UA",23,0)
 QUIT
"RTN","YSDX3UA",24,0)
 ;
"RTN","YSDX3UA",25,0)
DSMP ; Called by routine YSDX3
"RTN","YSDX3UA",26,0)
 ;D RECORD^YSDX0001("DSMP^YSDX3UA") ;Used for testing.  Inactivated in YSDX0001...
"RTN","YSDX3UA",27,0)
 I '$D(P2) W " ?? " W @IOF G AGAIN^YSDX3
"RTN","YSDX3UA",28,0)
 S S1=$P(^YSD(627.8,P2(X1),1),U),S2=$P(S1,";"),YSY=1
"RTN","YSDX3UA",29,0)
 QUIT
"RTN","YSDX3UA",30,0)
 ;
"RTN","YSDX3UA",31,0)
 ;
"RTN","YSDX3UA",32,0)
ICDLK ; Called from YSDX3A
"RTN","YSDX3UA",33,0)
 ; Lookup on the ICD9 File
"RTN","YSDX3UA",34,0)
 ;D RECORD^YSDX0001("ICDLK^YSDX3UA") ;Used for testing.  Inactivated in YSDX0001...
"RTN","YSDX3UA",35,0)
 S X=$P(X2," ") G:$P(X2," ",2)="" ICD1
"RTN","YSDX3UA",36,0)
 S Q=$C(34),D="S A=$C(32)_^(1) I "
"RTN","YSDX3UA",37,0)
 F I=2:1 S B=$P(X2," ",I) Q:B=""  S:B'[Q D=D_"(A["" "_B_""")&"
"RTN","YSDX3UA",38,0)
 S DIC("S")=$E(D,1,$L(D)-1)
"RTN","YSDX3UA",39,0)
ICD1 ;
"RTN","YSDX3UA",40,0)
 ;D RECORD^YSDX0001("ICD1^YSDX3UA") ;Used for testing.  Inactivated in YSDX0001...
"RTN","YSDX3UA",41,0)
 S (X,Y)=X2
"RTN","YSDX3UA",42,0)
 S DIC("S")="I $P($$ICDDATA^ICDXCODE(""DIAG"",Y,YSDXDAT),U,10)=1"
"RTN","YSDX3UA",43,0)
 S DIC(0)="QMZE",DIC="^ICD9("
"RTN","YSDX3UA",44,0)
 S ICDVDT=$P(YSDXDAT,".",1) D ^DIC
"RTN","YSDX3UA",45,0)
 K DIC("S"),ICDVDT
"RTN","YSDX3UA",46,0)
 QUIT
"RTN","YSDX3UA",47,0)
 ;
"RTN","YSDX3UA",48,0)
ICDP ; Called by routine YSDX3A
"RTN","YSDX3UA",49,0)
 ;D RECORD^YSDX0001("ICDP^YSDX3UA") ;Used for testing.  Inactivated in YSDX0001...
"RTN","YSDX3UA",50,0)
 S S1=$P(^YSD(627.8,P2(X2),1),U),S2=$$ICDDATA^ICDXCODE("DIAG",$P(S1,";"),YSDXDAT,"I"),S2=$P(S2,U,2),YSY=1 ;ASF 04/10/09
"RTN","YSDX3UA",51,0)
 QUIT
"RTN","YSDX3UA",52,0)
 ;
"RTN","YSDX3UA",53,0)
DXLS D DXLS^YSDX3UA0
"RTN","YSDX3UA",54,0)
 QUIT
"RTN","YSDX3UA",55,0)
 ;
"RTN","YSDX3UA",56,0)
DXLSQ D DXLSQ^YSDX3UA0
"RTN","YSDX3UA",57,0)
 QUIT
"RTN","YSDX3UA",58,0)
 ;
"RTN","YSDX3UA",59,0)
DUPL ; Called by routine YSDX3, YSDX3A
"RTN","YSDX3UA",60,0)
 ; Print out information concerning duplicate entry
"RTN","YSDX3UA",61,0)
 ;D RECORD^YSDX0001("DUPL^YSDX3UA") ;Used for testing.  Inactivated in YSDX0001...
"RTN","YSDX3UA",62,0)
 S W3=$P(^VA(200,$P(^YSD(627.8,W2,0),U,4),0),U)
"RTN","YSDX3UA",63,0)
 N YSDZX
"RTN","YSDX3UA",64,0)
 S Y=$P(^YSD(627.8,W2,0),U,3) D DD^%DT S W4=Y
"RTN","YSDX3UA",65,0)
 I YSAX=1 S YSDXND=$P(^YSD(627.7,S2,0),U),YSDXD=$P(^(0),U)
"RTN","YSDX3UA",66,0)
 I YSAX=3 D
"RTN","YSDX3UA",67,0)
 . S YSDXDATA=$$ICDDATA^ICDXCODE("DIAG",S2,YSDXDAT,"I")
"RTN","YSDX3UA",68,0)
 . S YSDXD=$P(YSDXDATA,U,2)
"RTN","YSDX3UA",69,0)
 . N YSDXZ S YSDZX=$$ICDDESC^ICDXCODE($P(YSACSREC,U,1),YSDXD,YSDXDAT,.YSDZX),YSDXND=YSDZX(1)
"RTN","YSDX3UA",70,0)
 S W5=$P(^YSD(627.8,W2,1),U,2)
"RTN","YSDX3UA",71,0)
 I W5="i" K YSDXND,YSDXD,W3,W4,W5 QUIT  ;->
"RTN","YSDX3UA",72,0)
 S W6=$S(W5="v":"VERIFIED",W5="p":"PROVISIONAL",W5="i":"INACTIVE",W5="r":"REFORMULATED",W5="n":"NOT FOUND",W5="ru":"RULE OUT",1:"")
"RTN","YSDX3UA",73,0)
DUPLP ;
"RTN","YSDX3UA",74,0)
 ;D RECORD^YSDX0001("DUPLP^YSDX3UA") ;Used for testing.  Inactivated in YSDX0001...
"RTN","YSDX3UA",75,0)
 I '$D(YSF1) D
"RTN","YSDX3UA",76,0)
 .  W !!,"This diagnosis has been entered as follows:  "
"RTN","YSDX3UA",77,0)
 .  W !!?5,"DIAGNOSIS: ",?15,YSDXND_" "_YSDXD,!?5,"STATUS:"
"RTN","YSDX3UA",78,0)
 .  W ?13,W6,!?5,"BY:",?13,$E(W3,1,25)_" on "_W4,!
"RTN","YSDX3UA",79,0)
 S YSF1=1
"RTN","YSDX3UA",80,0)
 QUIT
"RTN","YSDX3UA",81,0)
 ;
"RTN","YSDX3UA",82,0)
FILE ; Called from routines YSDX3, YSDX3A
"RTN","YSDX3UA",83,0)
 ;D RECORD^YSDX0001("FILE^YSDX3UA") ;Used for testing.  Inactivated in YSDX0001...
"RTN","YSDX3UA",84,0)
 S YSDUZ=$P(^VA(200,DUZ,0),U)
"RTN","YSDX3UA",85,0)
 W !
"RTN","YSDX3UA",86,0)
 S DIE=DIC,DA=YSDA,DR=".02////"_YSDFN_";.03////"_YSDXDAT_";.04//"_YSDUZ_";.05///^S X=""`""_DUZ;1////^S X=YSDXDA;5"
"RTN","YSDX3UA",87,0)
 L +@(DIE_"DA)"):DILOCKTM
"RTN","YSDX3UA",88,0)
 I '$T D ERRMSG^YSSITE,DELETE Q
"RTN","YSDX3UA",89,0)
 D ^DIE
"RTN","YSDX3UA",90,0)
 L -@(DIE_"DA)")
"RTN","YSDX3UA",91,0)
 S YSTOUT=$D(DTOUT) I YSTOUT D DELETE QUIT  ;->
"RTN","YSDX3UA",92,0)
 D CHECK QUIT:YSUOUT  ;->
"RTN","YSDX3UA",93,0)
 S C1=$P(^YSD(627.8,YSDA,1),U,2)
"RTN","YSDX3UA",94,0)
 I C1="" W !!?18,"Incomplete information." D DELETE QUIT  ;->
"RTN","YSDX3UA",95,0)
 S C2=$S(C1="v":"A",C1="p":"A",C1="i":"I",C1="r":"I",C1="n":"I",C1="ru":"A",1:"I")
"RTN","YSDX3UA",96,0)
 S DIE="^YSD(627.8,",DA=YSDA,DR="7///^S X=C2;8///NOW"
"RTN","YSDX3UA",97,0)
 L +^YSD(627.8,DA):DILOCKTM
"RTN","YSDX3UA",98,0)
 I '$T D ERRMSG^YSSITE Q
"RTN","YSDX3UA",99,0)
 D ^DIE
"RTN","YSDX3UA",100,0)
 L -^YSD(627.8,DA)
"RTN","YSDX3UA",101,0)
 K DIE
"RTN","YSDX3UA",102,0)
 S YSTOUT=$D(DTOUT) I YSTOUT QUIT  ;->
"RTN","YSDX3UA",103,0)
 D CHECK QUIT:YSUOUT  ;->
"RTN","YSDX3UA",104,0)
 N YSTO S YSTO=0
"RTN","YSDX3UA",105,0)
 I $D(W3) D  Q:YSTO
"RTN","YSDX3UA",106,0)
 .  S DIE="^YSD(627.8,",DA=YSDUPDA
"RTN","YSDX3UA",107,0)
 .  S DR="7///^S X=""I"";8///NOW;9///^S X=""Y"""
"RTN","YSDX3UA",108,0)
 .  L +^YSD(627.8,DA):DILOCKTM
"RTN","YSDX3UA",109,0)
 .  I '$T D ERRMSG^YSSITE S YSTO=1 Q
"RTN","YSDX3UA",110,0)
 .  D ^DIE
"RTN","YSDX3UA",111,0)
 .  L -^YSD(627.8,DA)
"RTN","YSDX3UA",112,0)
 D DXLS,DXLSQ
"RTN","YSDX3UA",113,0)
 S DIE="^YSD(627.8,",DA=YSDA
"RTN","YSDX3UA",114,0)
 S DR="10///^S X=YSDXLX;80"
"RTN","YSDX3UA",115,0)
 L +^YSD(627.8,DA):DILOCKTM
"RTN","YSDX3UA",116,0)
 I '$T D ERRMSG^YSSITE Q
"RTN","YSDX3UA",117,0)
 D ^DIE
"RTN","YSDX3UA",118,0)
 L -^YSD(627.8,DA)
"RTN","YSDX3UA",119,0)
 S YSTOUT=$D(DTOUT) QUIT:YSTOUT  ;->
"RTN","YSDX3UA",120,0)
 D CHECK QUIT:YSUOUT  ;->
"RTN","YSDX3UA",121,0)
FILEQ ;
"RTN","YSDX3UA",122,0)
 ;D RECORD^YSDX0001("FILEQ^YSDX3UA") ;Used for testing.  Inactivated in YSDX0001...
"RTN","YSDX3UA",123,0)
 S %=0
"RTN","YSDX3UA",124,0)
 F  Q:$G(%)  W !!," Do you want to record this diagnosis" S %=1 D
"RTN","YSDX3UA",125,0)
 .  D YN^DICN
"RTN","YSDX3UA",126,0)
 .  I '% W !!,"NO will delete this entry.  YES will file it under the patient's name."
"RTN","YSDX3UA",127,0)
 I %=2!(%=-1) D DELETE
"RTN","YSDX3UA",128,0)
 QUIT
"RTN","YSDX3UA",129,0)
 ;
"RTN","YSDX3UA",130,0)
CHECK ;
"RTN","YSDX3UA",131,0)
 ;D RECORD^YSDX0001("CHECK^YSDX3UA") ;Used for testing.  Inactivated in YSDX0001...
"RTN","YSDX3UA",132,0)
 S YSUOUT=$O(Y(""))]"" I 'YSUOUT QUIT  ;->
"RTN","YSDX3UA",133,0)
 W !!?18,"Incomplete information."
"RTN","YSDX3UA",134,0)
 ;
"RTN","YSDX3UA",135,0)
DELETE ; Called by routine YSDX3UB
"RTN","YSDX3UA",136,0)
 ;D RECORD^YSDX0001("DELETE^YSDX3UA") ;Used for testing.  Inactivated in YSDX0001...
"RTN","YSDX3UA",137,0)
 S DIK="^YSD(627.8,",DA=YSDA
"RTN","YSDX3UA",138,0)
 D ^DIK
"RTN","YSDX3UA",139,0)
 W !!?15,"< This diagnosis deleted. >"
"RTN","YSDX3UA",140,0)
 QUIT
"RTN","YSDX3UA",141,0)
 ;
"RTN","YSDX3UA",142,0)
EOR ;YSDX3UA - Utilities for Diagnosis Entry in the MH Medical Record (cont.) ;4/16/92 11:17
"RTN","YSDX3UA0")
0^9^B4575743^B4109653
"RTN","YSDX3UA0",1,0)
YSDX3UA0 ;DALISC/LJA - Continuation of YSDX3UA0 code... ;8/17/94 08:22
"RTN","YSDX3UA0",2,0)
 ;;5.01;MENTAL HEALTH;**107**;Dec 30, 1994;Build 23
"RTN","YSDX3UA0",3,0)
 ;;
"RTN","YSDX3UA0",4,0)
 ;
"RTN","YSDX3UA0",5,0)
DXLS ;This subroutine looks up and displays the diagnosis for Length of Stay (DXLS)
"RTN","YSDX3UA0",6,0)
 ;D RECORD^YSDX0001("DXLS^YSDX3UA0") ;Used for testing.  Inactivated in YSDX0001...
"RTN","YSDX3UA0",7,0)
 Q:'$D(^YSD(627.8,"AD",YSDFN))  ;->
"RTN","YSDX3UA0",8,0)
 S J=$O(^YSD(627.8,"AD",YSDFN,0)) ;     Inverse date
"RTN","YSDX3UA0",9,0)
 S J1=$O(^YSD(627.8,"AD",YSDFN,J,0)) ;  IEN
"RTN","YSDX3UA0",10,0)
 QUIT:$P(^YSD(627.8,J1,1),U,4)["I"  ;-> Condition
"RTN","YSDX3UA0",11,0)
 S J2=$P(^YSD(627.8,J1,1),U) ;          Diag variable pointer
"RTN","YSDX3UA0",12,0)
 N YSDXLSD2
"RTN","YSDX3UA0",13,0)
 S (Y,YSDXLSD2)=$P(^YSD(627.8,+J1,0),U,3) D DD^%DT S YSDXLSD=Y
"RTN","YSDX3UA0",14,0)
 ;
"RTN","YSDX3UA0",15,0)
 S J3=$P(J2,";",2)
"RTN","YSDX3UA0",16,0)
 S J4=$P(J2,";")
"RTN","YSDX3UA0",17,0)
 S J5="^"_J3_J4_","_0_")"
"RTN","YSDX3UA0",18,0)
 S J50=@J5
"RTN","YSDX3UA0",19,0)
 ;
"RTN","YSDX3UA0",20,0)
 ;  DSM?
"RTN","YSDX3UA0",21,0)
 I J3["YSD" D
"RTN","YSDX3UA0",22,0)
 .  S YSDXLS=^YSD(627.7,+J4,"D") ;        Code name
"RTN","YSDX3UA0",23,0)
 .  S YSDXLSN=$P(J50,U,2) ;               Code#
"RTN","YSDX3UA0",24,0)
 ;
"RTN","YSDX3UA0",25,0)
 ;  ICD9?
"RTN","YSDX3UA0",26,0)
 I J3["ICD9(" D
"RTN","YSDX3UA0",27,0)
 .  N YSDXDATA S YSDXDATA=$$ICDDATA^ICDXCODE("DIAG",J4,YSDXLSD2,"I")
"RTN","YSDX3UA0",28,0)
 .  S YSDXLS=$P(YSDXDATA,U,2) ;           Code #
"RTN","YSDX3UA0",29,0)
 .  S YSDXLSN=$P(YSDXDATA,U,4) ;          Code name
"RTN","YSDX3UA0",30,0)
 ;
"RTN","YSDX3UA0",31,0)
 I $D(YSDXLS) D
"RTN","YSDX3UA0",32,0)
 .  W !!,"The following diagnosis has been noted as the DXLS:  "
"RTN","YSDX3UA0",33,0)
 .  W !!?3,YSDXLS_" "_$E(YSDXLSN,1,48)," dated ",YSDXLSD
"RTN","YSDX3UA0",34,0)
 QUIT
"RTN","YSDX3UA0",35,0)
 ;
"RTN","YSDX3UA0",36,0)
DXLSQ ;
"RTN","YSDX3UA0",37,0)
 ;D RECORD^YSDX0001("DXLSQ^YSDX3UA0") ;Used for testing.  Inactivated in YSDX0001...
"RTN","YSDX3UA0",38,0)
 I C2["I" S YSDXLX="n" QUIT  ;->
"RTN","YSDX3UA0",39,0)
 W !!,"Is "_YSW_" "_$E(YSWN,1,45),!?5," the DXLS"
"RTN","YSDX3UA0",40,0)
 S %=2
"RTN","YSDX3UA0",41,0)
 D YN^DICN
"RTN","YSDX3UA0",42,0)
 I %=-1!(%=2) S YSDXLX="n" QUIT  ;->
"RTN","YSDX3UA0",43,0)
 I %=0 D  G DXLSQ ;->
"RTN","YSDX3UA0",44,0)
 .  W !!,"This is the diagnosis accounting the largest % of length of stay for this "
"RTN","YSDX3UA0",45,0)
 .  W !,"admission.  There may only be ONE DXLS (DSM or ICD) per admission."
"RTN","YSDX3UA0",46,0)
 S YSDXLX="y"
"RTN","YSDX3UA0",47,0)
 I $D(J1) D   QUIT  ;->
"RTN","YSDX3UA0",48,0)
 .  S DIE="^YSD(627.8,",DA=J1,DR="10///^S X=""c"""
"RTN","YSDX3UA0",49,0)
 .  L +^YSD(627.8,DA):0
"RTN","YSDX3UA0",50,0)
 .  D ^DIE
"RTN","YSDX3UA0",51,0)
 .  L -^YSD(627.8,DA)
"RTN","YSDX3UA0",52,0)
 QUIT
"RTN","YSDX3UA0",53,0)
 ;
"RTN","YSDX3UA0",54,0)
EOR ;YSDX3UA0 - Continuation of YSDX3UA0 code... ;8/17/94
"RTN","YSDXUTL")
0^13^B9274857^n/a
"RTN","YSDXUTL",1,0)
YSDXUTL ;ALB/RBD - DX CODE SET UTILITIES FOR MENTAL HEALTH ;04/02/2012
"RTN","YSDXUTL",2,0)
 ;;5.01;MENTAL HEALTH;**107**;Dec 30, 1994;Build 23
"RTN","YSDXUTL",3,0)
 ;
"RTN","YSDXUTL",4,0)
 Q  ; Library utilities, do not enter from top.
"RTN","YSDXUTL",5,0)
 ;
"RTN","YSDXUTL",6,0)
ACTIVE(YSCS) ; Return start date for requested coding system
"RTN","YSDXUTL",7,0)
 ;  Input:  Coding system abbreviation from #80.4 or #757.3
"RTN","YSDXUTL",8,0)
 ;          ICD, ICP, 10D, 10P
"RTN","YSDXUTL",9,0)
 ;
"RTN","YSDXUTL",10,0)
 ;  Output:  n^FM date  where
"RTN","YSDXUTL",11,0)
 ;           n = 0 ; requested coding system is not active
"RTN","YSDXUTL",12,0)
 ;           n = 1 ; requested coding system is active
"RTN","YSDXUTL",13,0)
 ;           FM date = starting date of requested code type
"RTN","YSDXUTL",14,0)
 ;      or
"RTN","YSDXUTL",15,0)
 ;           -1^error message ; coding system not valid
"RTN","YSDXUTL",16,0)
 ;
"RTN","YSDXUTL",17,0)
 N YSICDD,YSOUT,X,Y
"RTN","YSDXUTL",18,0)
 S X=YSCS,DIC=80.4,DIC(0)="",D="C" D IX^DIC
"RTN","YSDXUTL",19,0)
 I Y<0 Q "-1^Invalid Coding System"
"RTN","YSDXUTL",20,0)
 S YSICDD=$$IMPDATE^LEXU(YSCS)
"RTN","YSDXUTL",21,0)
 S YSOUT=$S(YSICDD'<DT:0,1:1)_U_YSICDD
"RTN","YSDXUTL",22,0)
 K D,DIC
"RTN","YSDXUTL",23,0)
 Q YSOUT
"RTN","YSDXUTL",24,0)
 ;
"RTN","YSDXUTL",25,0)
AVDX ; Build array of available Diagnosis Sets (Dx only, not Procedure Sets) in YSDXA("DX SET",fm-date)
"RTN","YSDXUTL",26,0)
 ; [1] = IEN in #80.4
"RTN","YSDXUTL",27,0)
 ; [2] = Code Set name
"RTN","YSDXUTL",28,0)
 ; [3] = Code Set abbreviation
"RTN","YSDXUTL",29,0)
 ; [4] = File number holding code set values (always 80 in this function)
"RTN","YSDXUTL",30,0)
 ; [5] = Date that code set becomes active (FM format)
"RTN","YSDXUTL",31,0)
 N YSMSG,YSI,YSD,YSR
"RTN","YSDXUTL",32,0)
 K YSDXA
"RTN","YSDXUTL",33,0)
 D LIST^DIC(80.4,"",".02;.03I;.04I","P","","","","","I $P(^(0),U,3)=80","","YSDXA","YSMSG")
"RTN","YSDXUTL",34,0)
 Q:'$D(YSDXA("DILIST",0))
"RTN","YSDXUTL",35,0)
 F YSI=1:1:$P(YSDXA("DILIST",0),U,1) D
"RTN","YSDXUTL",36,0)
 . S YSR=YSDXA("DILIST",YSI,0),YSD=$P(YSR,U,5)
"RTN","YSDXUTL",37,0)
 . S YSDXA("DX SET",YSD)=YSR
"RTN","YSDXUTL",38,0)
 K YSDXA("DILIST")
"RTN","YSDXUTL",39,0)
 Q
"RTN","YSDXUTL",40,0)
 ;
"RTN","YSDXUTL",41,0)
ACTDT(YSTRXD) ; Active Dx Code Set for date supplied
"RTN","YSDXUTL",42,0)
 ; Input - a FileMan date
"RTN","YSDXUTL",43,0)
 ; Returns 4 piece value:
"RTN","YSDXUTL",44,0)
 ; [1] = Code Set abbreviation
"RTN","YSDXUTL",45,0)
 ; [2] = IEN into file #80.4
"RTN","YSDXUTL",46,0)
 ; [3] = Long name
"RTN","YSDXUTL",47,0)
 ; [4] = Activation Date (FM)
"RTN","YSDXUTL",48,0)
 ; or
"RTN","YSDXUTL",49,0)
 ; 0 if no active Dx code set is found for the date supplied
"RTN","YSDXUTL",50,0)
 ;
"RTN","YSDXUTL",51,0)
 N YSDT,YSOUT,YSREC
"RTN","YSDXUTL",52,0)
 D AVDX
"RTN","YSDXUTL",53,0)
 I '$D(YSDXA("DX SET")) Q 0
"RTN","YSDXUTL",54,0)
 S YSDT=0,YSOUT=0
"RTN","YSDXUTL",55,0)
 F  S YSDT=$O(YSDXA("DX SET",YSDT)) Q:YSDT=""  D
"RTN","YSDXUTL",56,0)
 . S YSREC=YSDXA("DX SET",YSDT)
"RTN","YSDXUTL",57,0)
 . I YSTRXD'<YSDT S YSOUT=$P(YSREC,U,3)_U_$P(YSREC,U,1)_U_$P(YSREC,U,2)_U_$P(YSREC,U,5)
"RTN","YSDXUTL",58,0)
 K YSDXA
"RTN","YSDXUTL",59,0)
 Q YSOUT
"RTN","YSDXUTL",60,0)
 ;
"RTN","YSDXUTL",61,0)
DXVALID ;
"RTN","YSDXUTL",62,0)
 N A,YSCODSET,YSDATA,YSDXDA,YSDXDATE,YSFILE,YSTYPE S YSDXDATE=$P(^YSD(627.8,DA,0),U,3)
"RTN","YSDXUTL",63,0)
 I YSDXDATE="" S YSDXDATE=$G(DG("0;3"))
"RTN","YSDXUTL",64,0)
 S A(1,"F")="!!",A(2)=" ",A(2,"F")="!!"
"RTN","YSDXUTL",65,0)
 I YSDXDATE="" S A(1)="MISSING DIAGNOSIS DATE/TIME" D EN^DDIOL(.A) K X Q
"RTN","YSDXUTL",66,0)
 S YSCODSET=$$ACTDT(YSDXDATE)
"RTN","YSDXUTL",67,0)
 I YSCODSET=0 S A(1)="NO ICD CODE SET FOUND FOR DIAGNOSIS DATE/TIME SUPPLIED" D EN^DDIOL(.A) K X Q
"RTN","YSDXUTL",68,0)
 S YSFILE=$P(X,";",2),YSDXDA=$P(X,";",1)
"RTN","YSDXUTL",69,0)
 I YSFILE["YSD" D  Q
"RTN","YSDXUTL",70,0)
 . S YSTYPE=$P(^YSD(627.7,YSDXDA,0),U,8) S:YSTYPE="" YSTYPE="9"
"RTN","YSDXUTL",71,0)
 . I YSTYPE="9",$P(YSCODSET,U,1)'="ICD" D  Q
"RTN","YSDXUTL",72,0)
 .. S A(1)="DIAGNOSIS DATE/TIME DOES NOT CORRELATE WITH DSM DIAGNOSIS CODE" D EN^DDIOL(.A) K X
"RTN","YSDXUTL",73,0)
 . I YSTYPE="10",$P(YSCODSET,U,1)'="10D" D
"RTN","YSDXUTL",74,0)
 .. S A(1)="DIAGNOSIS DATE/TIME DOES NOT CORRELATE WITH DSM DIAGNOSIS CODE" D EN^DDIOL(.A) K X
"RTN","YSDXUTL",75,0)
 I YSFILE["ICD9" D
"RTN","YSDXUTL",76,0)
 . S YSDATA=$$ICDDATA^ICDXCODE("DIAG",YSDXDA,YSDXDATE,"I")
"RTN","YSDXUTL",77,0)
 . I $P(YSDATA,U,1)=-1 D
"RTN","YSDXUTL",78,0)
 .. S A(1)="DIAGNOSIS DATE/TIME DOES NOT CORRELATE WITH ICD DIAGNOSIS CODE" D EN^DDIOL(.A) K X
"RTN","YSDXUTL",79,0)
 Q
"RTN","YSDXUTL",80,0)
 ;
"RTN","YSLXDG")
0^11^B145277069^n/a
"RTN","YSLXDG",1,0)
YSLXDG ; ALB/RBD - ICD-10 DIAGNOSIS CODE LOOK UP FOR MENTAL HEALTH ;10 May 2013  11:17 AM
"RTN","YSLXDG",2,0)
 ;;5.01;MENTAL HEALTH;**107**;Dec 30, 1994;Build 23
"RTN","YSLXDG",3,0)
 ;
"RTN","YSLXDG",4,0)
 ;based on ^ZZLXDG which is the standard Diagnosis Search Protocol
"RTN","YSLXDG",5,0)
 ;beginning routine.
"RTN","YSLXDG",6,0)
 ;
"RTN","YSLXDG",7,0)
 Q
"RTN","YSLXDG",8,0)
 ;
"RTN","YSLXDG",9,0)
EN ;
"RTN","YSLXDG",10,0)
 D INITVARS ;set standards variables, you might not need this if it
"RTN","YSLXDG",11,0)
 ; was already done in your application
"RTN","YSLXDG",12,0)
 N YSQUIT ; to manage loop
"RTN","YSLXDG",13,0)
 K YSRETV ;to store the selected code information
"RTN","YSLXDG",14,0)
 N YSPARAM ;  to set your application specific prompts and messages
"RTN","YSLXDG",15,0)
 N YSCSYS ;coding system "ICD9" or ICD10"
"RTN","YSLXDG",16,0)
 N YSOUT ;to return all available information about the selected code
"RTN","YSLXDG",17,0)
 ;settings:
"RTN","YSLXDG",18,0)
 D SETPARAM(.YSPARAM) ;edit the SETPARAM subroutine below to set your
"RTN","YSLXDG",19,0)
 ; application specific prompts
"RTN","YSLXDG",20,0)
 I YSDT'>0 S YSRETV=-1 Q
"RTN","YSLXDG",21,0)
 ;starting main loop
"RTN","YSLXDG",22,0)
 S YSQUIT=0 F  Q:YSQUIT=1  D
"RTN","YSLXDG",23,0)
 . S YSRETV=0,YSOUT=""
"RTN","YSLXDG",24,0)
 . W !!   ;reprompt a few lines down
"RTN","YSLXDG",25,0)
 . ;prompt for the date of interest (date should be available for MH)
"RTN","YSLXDG",26,0)
 . I YSDT'>0 S YSRETV=-1,YSQUIT=1 Q
"RTN","YSLXDG",27,0)
 . ;S YSDT=$$ASKDATE(YSPARAM("ASKDATE"))
"RTN","YSLXDG",28,0)
 . ;prompt for "try again" with "No" as default if ^ or null entered
"RTN","YSLXDG",29,0)
 . ;for the date or if timed out
"RTN","YSLXDG",30,0)
 . I YSDT'>0 S:$$QUESTION(2,YSPARAM("TRY ANOTHER"))'=1 YSQUIT=1 Q
"RTN","YSLXDG",31,0)
 . ;determine coding system based on the date of interest
"RTN","YSLXDG",32,0)
 . ;If coding system not ICD-10 or greater, then Quit (let MH code
"RTN","YSLXDG",33,0)
 . ; handle it as before for now)
"RTN","YSLXDG",34,0)
 . S YSCSYS=$$ICDSYSDG(YSDT) I YSCSYS=1 S YSRETV=-1,YSQUIT=1 Q
"RTN","YSLXDG",35,0)
 . ;set default response for your prompt
"RTN","YSLXDG",36,0)
 . S YSDFLT=""
"RTN","YSLXDG",37,0)
 . ;run either ICD9 or ICD10 prompt/search/select logic
"RTN","YSLXDG",38,0)
 . ;ICD9 (1 is a pointer to the ICD-9 diagnosis system entry in the
"RTN","YSLXDG",39,0)
 . ;new file #80.4)
"RTN","YSLXDG",40,0)
 . I YSCSYS=1 S YSRETV=$$DIAG9(YSDT,YSDFLT,.YSOUT,.YSPARAM) I YSRETV=-2 S:$$QUESTION(1,YSPARAM("TRY ANOTHER"))'=1 YSQUIT=1 Q
"RTN","YSLXDG",41,0)
 . ;ICD10 (30 is a pointer to the ICD-10 diagnosis system entry in the new file #80.4)
"RTN","YSLXDG",42,0)
 . I YSCSYS=30 S YSRETV=$$DIAG10(YSDT,YSDFLT,.YSPARAM)
"RTN","YSLXDG",43,0)
 . I $P(YSRETV,U,2)="LIST CHOICE" S YSRETV=$P(YSRETV,U,1),YSQUIT=1 Q
"RTN","YSLXDG",44,0)
 . ;display information about the code selected
"RTN","YSLXDG",45,0)
 . I YSRETV>0 W !,"SELECTED: " D CODEINFO(YSRETV) S YSQUIT=1 Q
"RTN","YSLXDG",46,0)
 . ;if no data found
"RTN","YSLXDG",47,0)
 . I YSRETV="" W !!,YSPARAM("NO DATA FOUND") S:$$QUESTION(1,YSPARAM("TRY ANOTHER"))'=1 YSQUIT=1,YSRETV=-1 Q
"RTN","YSLXDG",48,0)
 . ;in ICD10 if the user answered NO for the question "Do you wish to continue(Y/N)?"
"RTN","YSLXDG",49,0)
 . I YSRETV=-4 S:$$QUESTION(1,YSPARAM("TRY ANOTHER"))'=1 YSQUIT=1 Q
"RTN","YSLXDG",50,0)
 . ;no data or was aborted
"RTN","YSLXDG",51,0)
 . I YSRETV=-2 S:$$QUESTION(1,YSPARAM("TRY ANOTHER"))'=1 YSQUIT=1 Q
"RTN","YSLXDG",52,0)
 . ;if exit due to ^ in the ICD Diagnosis code prompt
"RTN","YSLXDG",53,0)
 . I YSRETV=-3 S:$$QUESTION(2,YSPARAM("TRY ANOTHER"))'=1 YSQUIT=1 Q
"RTN","YSLXDG",54,0)
 . ;if no data found
"RTN","YSLXDG",55,0)
 . I YSRETV=-1 S:$$QUESTION(2,YSPARAM("TRY ANOTHER"))'=1 YSQUIT=1 Q
"RTN","YSLXDG",56,0)
 . ; if continue search
"RTN","YSLXDG",57,0)
 Q
"RTN","YSLXDG",58,0)
 ;
"RTN","YSLXDG",59,0)
 ;//---------
"RTN","YSLXDG",60,0)
 ;The entry point for ICD-10 diagnosis search functionality
"RTN","YSLXDG",61,0)
 ;can be called from applications directly
"RTN","YSLXDG",62,0)
 ;input parameters :
"RTN","YSLXDG",63,0)
 ; YSDT - date of interest
"RTN","YSLXDG",64,0)
 ; YSDFLT - default values for the search string (can be a code by default)
"RTN","YSLXDG",65,0)
 ; YSOUT - local array to return results (passed as a reference)
"RTN","YSLXDG",66,0)
 ; YSPARAM - parameters/string constants (see SETPARAM for details)
"RTN","YSLXDG",67,0)
 ;returns ICD-10 code selected by the user:
"RTN","YSLXDG",68,0)
 ;  IEN file #80;ICD code value^description
"RTN","YSLXDG",69,0)
 ; results
"RTN","YSLXDG",70,0)
 ; or -1 if invalid data(press enter)
"RTN","YSLXDG",71,0)
 ; "" if not found
"RTN","YSLXDG",72,0)
 ; or -2 if time out
"RTN","YSLXDG",73,0)
 ; or -3 if ^ or ^^
"RTN","YSLXDG",74,0)
 ; or -4 in ICD10 if the user answered NO for the question "Do you wish to continue(Y/N)?"
"RTN","YSLXDG",75,0)
 ; 
"RTN","YSLXDG",76,0)
DIAG10(YSDT,YSDFLT,YSPARAM) ;
"RTN","YSLXDG",77,0)
 N YSINP
"RTN","YSLXDG",78,0)
 S YSINP=$$SRCHSTR(YSPARAM("SEARCH_PROMPT"),YSPARAM("HELP ?"),YSPARAM("HELP ??"),YSDFLT)
"RTN","YSLXDG",79,0)
 I YSINP<0 Q +YSINP
"RTN","YSLXDG",80,0)
 I $P(YSINP,U,2)?.N Q $P(YSINP,U,2)_U_"LIST CHOICE"
"RTN","YSLXDG",81,0)
 Q $$LEXICD10($P(YSINP,U,2),YSDT,.YSPARAM)
"RTN","YSLXDG",82,0)
 ;
"RTN","YSLXDG",83,0)
 ;//---------
"RTN","YSLXDG",84,0)
 ;The entry point for ICD-9 FileMan type (^DIC) diagnosis search functionality
"RTN","YSLXDG",85,0)
 ;can be called from applications directly
"RTN","YSLXDG",86,0)
 ;input parameters :
"RTN","YSLXDG",87,0)
 ; YSDT - date of interest
"RTN","YSLXDG",88,0)
 ; YSDFLT - default values for the search string (can be a code by default)
"RTN","YSLXDG",89,0)
 ; YSOUT - local array to return results(passed as a reference)
"RTN","YSLXDG",90,0)
 ; YSPARAM - parameters/string constants (see SETPARAM for details)
"RTN","YSLXDG",91,0)
 ;returns ICD-9 code selected by the user:
"RTN","YSLXDG",92,0)
 ;  IEN file #80;ICD code value^description
"RTN","YSLXDG",93,0)
 ;  -2 no data or was aborted
"RTN","YSLXDG",94,0)
 ;  -1 if timeout
"RTN","YSLXDG",95,0)
DIAG9(YSDT,YSDFLT,YSOUT,YSPARAM) ;
"RTN","YSLXDG",96,0)
 N YSINP,YSRETV
"RTN","YSLXDG",97,0)
 S YSINP=$$SRCHSTR(YSPARAM("SEARCH_PROMPT"),YSPARAM("HELP ?"),YSPARAM("HELP ??"),YSDFLT)
"RTN","YSLXDG",98,0)
 I YSINP=-1 Q -1  ;enter
"RTN","YSLXDG",99,0)
 I YSINP=-3 Q -1  ;^ or ^^
"RTN","YSLXDG",100,0)
 I YSINP=-2 Q -2  ;timeout or not found
"RTN","YSLXDG",101,0)
 I YSINP=-1!(YSINP=-3) Q -2
"RTN","YSLXDG",102,0)
 I YSINP<0 Q +YSINP
"RTN","YSLXDG",103,0)
 S YSRETV=$$ICD9($P(YSINP,U,2),YSDT,.YSOUT)
"RTN","YSLXDG",104,0)
 I YSRETV=-1 Q -2
"RTN","YSLXDG",105,0)
 Q YSRETV
"RTN","YSLXDG",106,0)
 ;
"RTN","YSLXDG",107,0)
 ;--------------
"RTN","YSLXDG",108,0)
 ;The entry point for ICD-10 diagnosis search functionality
"RTN","YSLXDG",109,0)
 ;can be called from applications directly
"RTN","YSLXDG",110,0)
 ; Supported ICR 5681 ($$DIAGSRCH^LEX10CS)
"RTN","YSLXDG",111,0)
 ;input parameters :
"RTN","YSLXDG",112,0)
 ; YSTXT - search string
"RTN","YSLXDG",113,0)
 ; YSDATE - date of interest
"RTN","YSLXDG",114,0)
 ; YSPAR - array with text messages and other string constants
"RTN","YSLXDG",115,0)
 ;returns ICD-10 code selected by the user:
"RTN","YSLXDG",116,0)
 ;  IEN file #80;ICD code value^description
"RTN","YSLXDG",117,0)
 ; or
"RTN","YSLXDG",118,0)
 ; "" if not found
"RTN","YSLXDG",119,0)
 ; -1 if exit : ^ or ^^
"RTN","YSLXDG",120,0)
 ; -2 if continue searching
"RTN","YSLXDG",121,0)
 ;
"RTN","YSLXDG",122,0)
LEXICD10(YSTXT,YSDATE,YSPAR) ; ICD-10 Search
"RTN","YSLXDG",123,0)
 N YSLVTXT
"RTN","YSLXDG",124,0)
 ;parameters check
"RTN","YSLXDG",125,0)
 S YSDATE=+$G(YSDATE)
"RTN","YSLXDG",126,0)
 S YSDATE=$P(YSDATE,".",1)
"RTN","YSLXDG",127,0)
 I YSDATE'?7N Q -1
"RTN","YSLXDG",128,0)
 S YSTXT=$G(YSTXT)
"RTN","YSLXDG",129,0)
 Q:'$L(YSTXT) -1
"RTN","YSLXDG",130,0)
 N YSNUMB
"RTN","YSLXDG",131,0)
 S YSNUMB=$$FREQ^LEXU(YSTXT)
"RTN","YSLXDG",132,0)
 I YSNUMB>$$MAX^LEXU(30) D  I $$QUESTION("N",YSPARAM("WISH CONTINUE"))'=1 Q -4
"RTN","YSLXDG",133,0)
 . W ! D FORMWRIT(YSPAR("EXCEEDS MESSAGE1")_YSTXT_YSPAR("EXCEEDS MESSAGE2")_YSNUMB_YSPAR("EXCEEDS MESSAGE3")_YSTXT_""".",0)
"RTN","YSLXDG",134,0)
 . D FORMWRIT("",2) W !
"RTN","YSLXDG",135,0)
 ;new and set variables
"RTN","YSLXDG",136,0)
 N DIROUT,DUOUT,DTOUT,YSEXIT,YSICDNT
"RTN","YSLXDG",137,0)
 N YSRETV,YSXX,YSLEVEL
"RTN","YSLXDG",138,0)
 S YSRETV=""
"RTN","YSLXDG",139,0)
 S YSEXIT=0
"RTN","YSLXDG",140,0)
 S YSLEVEL=1,YSLVTXT(YSLEVEL)=YSTXT ;level 1 stores the original search string
"RTN","YSLXDG",141,0)
 ; main loop
"RTN","YSLXDG",142,0)
 F  Q:YSEXIT>0  D
"RTN","YSLXDG",143,0)
 .K YSICDY
"RTN","YSLXDG",144,0)
 .;W !,"Level #: ",YSLEVEL,", search string: ",YSLVTXT(YSLEVEL)
"RTN","YSLXDG",145,0)
 .;get the search string from the current level and call LEX API
"RTN","YSLXDG",146,0)
 .S YSICDY=$$DIAGSRCH^LEX10CS(YSLVTXT(YSLEVEL),.YSICDY,YSDATE,30)
"RTN","YSLXDG",147,0)
 .S:$O(YSICDY(" "),-1)>0 YSICDY=+YSICDY
"RTN","YSLXDG",148,0)
 .; Nothing found
"RTN","YSLXDG",149,0)
 .I +YSICDY'>0 S YSEXIT=1 S YSXX=-1 Q
"RTN","YSLXDG",150,0)
 .; display the list of items and ask the user to select the item from the list
"RTN","YSLXDG",151,0)
 .S YSXX=$$SEL^YSLXDG2(.YSICDY,8)
"RTN","YSLXDG",152,0)
 .; if ^ was entered
"RTN","YSLXDG",153,0)
 .;   if this is on the top level then quit
"RTN","YSLXDG",154,0)
 .I YSXX=-2,YSLEVEL'>1 S YSRETV=-1 S YSEXIT=1 Q
"RTN","YSLXDG",155,0)
 .;   if lower level then go one level up
"RTN","YSLXDG",156,0)
 .I YSXX=-2,YSLEVEL>1 S:YSLEVEL>1 YSLEVEL=YSLEVEL-1 Q
"RTN","YSLXDG",157,0)
 .; If timeout, or not selected, or ^^ then quit
"RTN","YSLXDG",158,0)
 .I YSXX=-1 S YSRETV=-1 S YSEXIT=1 Q
"RTN","YSLXDG",159,0)
 .; if Code Found and Selected by the user save selection in YSRETV and quit
"RTN","YSLXDG",160,0)
 .I $P(YSXX,";")'="99:CAT" S YSRETV=YSXX S YSEXIT=1 Q
"RTN","YSLXDG",161,0)
 .; If Category Found and Selected by the user:
"RTN","YSLXDG",162,0)
 .;  go to the next inner level
"RTN","YSLXDG",163,0)
 .;  change level number
"RTN","YSLXDG",164,0)
 .S YSLEVEL=YSLEVEL+1
"RTN","YSLXDG",165,0)
 .;  set the new level with the new search string
"RTN","YSLXDG",166,0)
 .;  and repeat
"RTN","YSLXDG",167,0)
 .S YSLVTXT(YSLEVEL)=$P($P($G(YSXX),"^"),";",2)
"RTN","YSLXDG",168,0)
 Q YSRETV
"RTN","YSLXDG",169,0)
 ;----------
"RTN","YSLXDG",170,0)
 ;ICD-9 lookup (FileMan lookup)
"RTN","YSLXDG",171,0)
 ;Supported ICR 5773 (FileMan lookup for files #80 nad #80.1)
"RTN","YSLXDG",172,0)
 ;Supported ICR 5699 ($$ICDDATA^ICDXCODE)
"RTN","YSLXDG",173,0)
 ;input parameters :
"RTN","YSLXDG",174,0)
 ; YSSRCH - search string
"RTN","YSLXDG",175,0)
 ; YSICDT - date of interest
"RTN","YSLXDG",176,0)
 ; YSOUT - local array to return detailed info (passed as a reference)
"RTN","YSLXDG",177,0)
 ;returns ICD-9 code selected by the user:
"RTN","YSLXDG",178,0)
 ;  IEN file #80;ICD code value^description
"RTN","YSLXDG",179,0)
 ; or
"RTN","YSLXDG",180,0)
 ; "" if not found
"RTN","YSLXDG",181,0)
 ; -1 if exit : ^ or ^^
"RTN","YSLXDG",182,0)
 ; -2 if continue search
"RTN","YSLXDG",183,0)
 ;the array YSOUT returns details if the return value >0, here is an example:
"RTN","YSLXDG",184,0)
 ; YSOUT="6065^814.14"
"RTN","YSLXDG",185,0)
 ; YSOUT(0)=814.14
"RTN","YSLXDG",186,0)
 ; YSOUT(0,0)=814.14
"RTN","YSLXDG",187,0)
 ; YSOUT(0,1)="6065^814.14^^FX PISIFORM-OPEN^^8^^1^^1^^^0^^^^2781001^^1^1"
"RTN","YSLXDG",188,0)
 ; YSOUT(0,2)="OPEN FRACTURE OF PISIFORM BONE OF WRIST"
"RTN","YSLXDG",189,0)
 ;Note: this API is not silent because the ICD lookup is not silent
"RTN","YSLXDG",190,0)
ICD9(YSSRCH,YSICDT,YSOUT) ;
"RTN","YSLXDG",191,0)
 N KEY,X,Y,DIC,YSCDS
"RTN","YSLXDG",192,0)
 ;KEY must be newed as ICD lookup code doesn't kill it
"RTN","YSLXDG",193,0)
 S DIC="^ICD9(",DIC(0)="EQXZ"
"RTN","YSLXDG",194,0)
 S YSCDS="ICD9"
"RTN","YSLXDG",195,0)
 ;note: you must use Y for the 2nd parameter of $$ICDDATA^ICDXCODE
"RTN","YSLXDG",196,0)
 S DIC("S")="I $P($$ICDDATA^ICDXCODE(YSCDS,Y,YSICDT),U,10)=1"
"RTN","YSLXDG",197,0)
 ; both X and Y should be set to the search string
"RTN","YSLXDG",198,0)
 S (X,Y)=YSSRCH
"RTN","YSLXDG",199,0)
 D ^DIC
"RTN","YSLXDG",200,0)
 M YSOUT=Y
"RTN","YSLXDG",201,0)
 I $G(Y) Q $S(Y=-1:-1,1:+Y_";"_$P(Y,U,2)_U_$G(Y(0,2)))
"RTN","YSLXDG",202,0)
 Q X
"RTN","YSLXDG",203,0)
 ;
"RTN","YSLXDG",204,0)
 ;---------
"RTN","YSLXDG",205,0)
 ; Clean up environment and quit
"RTN","YSLXDG",206,0)
EXIT ;
"RTN","YSLXDG",207,0)
 K %,DIC,DIR,DIROUT,DIRUT,DTOUT,DUOUT,X,Y
"RTN","YSLXDG",208,0)
 Q
"RTN","YSLXDG",209,0)
 ;
"RTN","YSLXDG",210,0)
 ;-----------
"RTN","YSLXDG",211,0)
 ; Look-up help for ICD10s.
"RTN","YSLXDG",212,0)
INPHLP ; Help text controller for ICD-10
"RTN","YSLXDG",213,0)
 I X["???" D QM3 Q
"RTN","YSLXDG",214,0)
 I X["??" D QM2 Q
"RTN","YSLXDG",215,0)
 I X["?" D QM1 Q
"RTN","YSLXDG",216,0)
 Q
"RTN","YSLXDG",217,0)
QM ; Diagnosis help text
"RTN","YSLXDG",218,0)
QM1 ; simple help text for 1 question mark
"RTN","YSLXDG",219,0)
 W !,"Enter code or ""text"" for more information.",!
"RTN","YSLXDG",220,0)
 Q
"RTN","YSLXDG",221,0)
QM2 ; enhanced help text for 2 question marks
"RTN","YSLXDG",222,0)
 W !,"Enter a ""free text"" term or part of a term such as ""femur fracture"".",!
"RTN","YSLXDG",223,0)
 W !,"  or",!
"RTN","YSLXDG",224,0)
 W !,"Enter a ""classification code"" (ICD/CPT etc) to find the single term associated"
"RTN","YSLXDG",225,0)
 W !,"with the code.",!
"RTN","YSLXDG",226,0)
 W !," or",!
"RTN","YSLXDG",227,0)
 W !,"Enter a ""partial code"". Include the decimal when a search criterion includes"
"RTN","YSLXDG",228,0)
 W !,"3 characters or more for code searches.",!
"RTN","YSLXDG",229,0)
 Q
"RTN","YSLXDG",230,0)
QM3 ; further explanation of format when there are multiple returns, displayed for 3 question marks.
"RTN","YSLXDG",231,0)
 W !,"Number of Code Matches"
"RTN","YSLXDG",232,0)
 W !,"----------------------",!
"RTN","YSLXDG",233,0)
 W !,"The ICD-10 Diagnosis Code search will show the user the number of matches"
"RTN","YSLXDG",234,0)
 W !,"found, indicate if additional characters in ICD code exist, and the number"
"RTN","YSLXDG",235,0)
 W !,"of codes within the category or subcategory that are available for selection."
"RTN","YSLXDG",236,0)
 W !,"For example:",!
"RTN","YSLXDG",237,0)
 W !,"14 matches found",!
"RTN","YSLXDG",238,0)
 W !,"M91. -    Juvenile osteochondrosis of hip and pelvis (19)",!
"RTN","YSLXDG",239,0)
 W !,"This indicates that 14 unique matches or matching groups have been found and"
"RTN","YSLXDG",240,0)
 W !,"will be displayed.",!
"RTN","YSLXDG",241,0)
 W !,"M91. -   the ""-"" indicates that there are additional characters that specify"
"RTN","YSLXDG",242,0)
 W !,"         unique ICD-10 codes available.",!
"RTN","YSLXDG",243,0)
 W !,"(19)     Indicates that there are 19 additional ICD-10 codes in the M91"
"RTN","YSLXDG",244,0)
 W !,"         ""family"" that are possible selections.",!
"RTN","YSLXDG",245,0)
 Q
"RTN","YSLXDG",246,0)
 ;
"RTN","YSLXDG",247,0)
MIN2 ; Minimum length of 2 characters message
"RTN","YSLXDG",248,0)
 W $C(7),"  ??",!
"RTN","YSLXDG",249,0)
 W !,"Please enter at least the first two characters of the ICD-10 code or "
"RTN","YSLXDG",250,0)
 W !,"code description to start the search.",!
"RTN","YSLXDG",251,0)
 Q
"RTN","YSLXDG",252,0)
 ;
"RTN","YSLXDG",253,0)
INPHLP2 ; Look-up help for ICD9s
"RTN","YSLXDG",254,0)
 W !," Enter a ""free text"" term. Best results occur using one to "
"RTN","YSLXDG",255,0)
 W !," three full or partial words without a suffix"
"RTN","YSLXDG",256,0)
 W:$G(X)'["??" "."
"RTN","YSLXDG",257,0)
 W:$G(X)["??" " (i.e., ""DIABETES"","
"RTN","YSLXDG",258,0)
 W:$G(X)["??" !," ""DIAB MELL"",""DIAB MELL INSUL"")"
"RTN","YSLXDG",259,0)
 W !," or "
"RTN","YSLXDG",260,0)
 W !," Enter a classification code (ICD/CPT etc) to find the single "
"RTN","YSLXDG",261,0)
 W !," term associated with the code."
"RTN","YSLXDG",262,0)
 W:$G(X)["??" " Example, a lookup of code 239.0 "
"RTN","YSLXDG",263,0)
 W:$G(X)["??" !," returns one and only one term, that is the preferred "
"RTN","YSLXDG",264,0)
 W:$G(X)["??" !," term for the code 239.0, ""Neoplasm of unspecified nature "
"RTN","YSLXDG",265,0)
 W:$G(X)["??" !," of digestive system"""
"RTN","YSLXDG",266,0)
 W !," or "
"RTN","YSLXDG",267,0)
 W !," Enter a classification code (ICD/CPT etc) followed by a plus"
"RTN","YSLXDG",268,0)
 W !," sign (+) to retrieve all terms associated with the code."
"RTN","YSLXDG",269,0)
 W:$G(X)["??" " Example,"
"RTN","YSLXDG",270,0)
 W:$G(X)["??" !," a lookup of 239.0+ returns all terms that are linked to the "
"RTN","YSLXDG",271,0)
 W:$G(X)["??" !," code 239.0."
"RTN","YSLXDG",272,0)
 Q
"RTN","YSLXDG",273,0)
 ;--------
"RTN","YSLXDG",274,0)
 ;prompt the user for a date of interest
"RTN","YSLXDG",275,0)
 ;input parameters :
"RTN","YSLXDG",276,0)
 ; YSPRMT - prompt
"RTN","YSLXDG",277,0)
 ;returns YYYMMDD
"RTN","YSLXDG",278,0)
 ; or -1 if invalid date
"RTN","YSLXDG",279,0)
 ; or -2 if time out
"RTN","YSLXDG",280,0)
 ; or -3 if ^
"RTN","YSLXDG",281,0)
ASKDATE(YSPRMT) ;
"RTN","YSLXDG",282,0)
 N %DT,DIROUT,DUOUT,DTOUT
"RTN","YSLXDG",283,0)
 S %DT="AEX",%DT("A")=$G(YSPRMT,"Enter a date: ")
"RTN","YSLXDG",284,0)
 D ^%DT
"RTN","YSLXDG",285,0)
 Q:Y<0 -1
"RTN","YSLXDG",286,0)
 Q:$D(DTOUT) -2
"RTN","YSLXDG",287,0)
 Q:X="^" -3
"RTN","YSLXDG",288,0)
 Q (+Y)
"RTN","YSLXDG",289,0)
 ;--------
"RTN","YSLXDG",290,0)
 ;ask YES/NO questions
"RTN","YSLXDG",291,0)
 ;input parameters :
"RTN","YSLXDG",292,0)
 ; YSDFLT- 0/null- not default, 1- yes, 2 -no
"RTN","YSLXDG",293,0)
 ; YSPROM - prompt string
"RTN","YSLXDG",294,0)
 ;returns
"RTN","YSLXDG",295,0)
 ; 2 - no,
"RTN","YSLXDG",296,0)
 ; 1 -yes,
"RTN","YSLXDG",297,0)
 ; 0 - no answer
"RTN","YSLXDG",298,0)
QUESTION(YSDFLT,YSPROM) ;
"RTN","YSLXDG",299,0)
 W:$L($G(YSPROM)) !,YSPROM
"RTN","YSLXDG",300,0)
 S %=$G(YSDFLT,2)
"RTN","YSLXDG",301,0)
 D YN^DICN
"RTN","YSLXDG",302,0)
 Q:%Y["^" -3
"RTN","YSLXDG",303,0)
 I %=2!(%=1) Q %
"RTN","YSLXDG",304,0)
 Q -2
"RTN","YSLXDG",305,0)
 ;
"RTN","YSLXDG",306,0)
 ;------------
"RTN","YSLXDG",307,0)
 ;get search string
"RTN","YSLXDG",308,0)
 ;input parameters :
"RTN","YSLXDG",309,0)
 ; YSPRMT prompt text
"RTN","YSLXDG",310,0)
 ; YSHLP1 "?" help text
"RTN","YSLXDG",311,0)
 ; YSHLP2 "??" help text
"RTN","YSLXDG",312,0)
 ; YSDFLT- default response
"RTN","YSLXDG",313,0)
 ;returns piece1 ^ piece 2
"RTN","YSLXDG",314,0)
 ; piece1:
"RTN","YSLXDG",315,0)
 ; 0 if normal input
"RTN","YSLXDG",316,0)
 ; or -1 if invalid data
"RTN","YSLXDG",317,0)
 ; or -2 if time out
"RTN","YSLXDG",318,0)
 ; or -3 if ^
"RTN","YSLXDG",319,0)
 ; piece2: string entered by the user
"RTN","YSLXDG",320,0)
SRCHSTR(YSPRMT,YSHLP1,YSHLP2,YSDFLT) ;
"RTN","YSLXDG",321,0)
SRCHST2 N DIR
"RTN","YSLXDG",322,0)
 S DIR("A")=YSPRMT
"RTN","YSLXDG",323,0)
 S DIR("?")=YSHLP1
"RTN","YSLXDG",324,0)
 S DIR("??")=YSHLP2
"RTN","YSLXDG",325,0)
 I $L($G(YSDFLT)) S DIR("B")=YSDFLT
"RTN","YSLXDG",326,0)
 S DIR(0)="FAO^0:245"
"RTN","YSLXDG",327,0)
 D ^DIR
"RTN","YSLXDG",328,0)
 Q:$D(DTOUT) -2
"RTN","YSLXDG",329,0)
 Q:$D(DUOUT) -3
"RTN","YSLXDG",330,0)
 Q:Y["^" -3
"RTN","YSLXDG",331,0)
 I $L(Y)=1 D MIN2 G SRCHST2
"RTN","YSLXDG",332,0)
 Q:Y="" -1
"RTN","YSLXDG",333,0)
 Q 0_U_Y
"RTN","YSLXDG",334,0)
 ;
"RTN","YSLXDG",335,0)
 ;----------
"RTN","YSLXDG",336,0)
 ;Determines and returns ACTIVE coding system for DIAGNOSES based on date of interest
"RTN","YSLXDG",337,0)
 ;input parameters :
"RTN","YSLXDG",338,0)
 ; YSICDD - date of interest
"RTN","YSLXDG",339,0)
 ; if date of interest is null, today's date will be assumed
"RTN","YSLXDG",340,0)
 ;returns coding system
"RTN","YSLXDG",341,0)
 ; as a pointer to the ICD CODING SYSTEM file #80.4 (suppported ICR 5780)
"RTN","YSLXDG",342,0)
 ; 30  if ICD-10-CM is active system
"RTN","YSLXDG",343,0)
 ; 1   if ICD-9-CM is active system
"RTN","YSLXDG",344,0)
ICDSYSDG(YSICDD) ;
"RTN","YSLXDG",345,0)
 N YSIMPDT
"RTN","YSLXDG",346,0)
 S YSICDD=$S(YSICDD<0!($L($P(YSICDD,".",1))'=7):DT,1:+$G(YSICDD))
"RTN","YSLXDG",347,0)
 S YSIMPDT=$$IMPDATE^LEXU("10D")
"RTN","YSLXDG",348,0)
 Q $S(YSICDD'<YSIMPDT:30,1:1)
"RTN","YSLXDG",349,0)
 ;
"RTN","YSLXDG",350,0)
 ;set parameters
"RTN","YSLXDG",351,0)
 ;edit these hardcoded strings that areused for prompts, messages and so on to adjust
"RTN","YSLXDG",352,0)
 ;them to your applicaion's needs
"RTN","YSLXDG",353,0)
 ;input parameters
"RTN","YSLXDG",354,0)
 ; YSPAR - local array to sets and store string constants for your messages and prompts 
"RTN","YSLXDG",355,0)
SETPARAM(YSPAR) ;
"RTN","YSLXDG",356,0)
 S YSPAR("ASKDATE")="Date of interest? "
"RTN","YSLXDG",357,0)
 S YSPAR("SEARCH_PROMPT")="Enter ICD-10 DIAGNOSIS: "   ; assume ICD-10
"RTN","YSLXDG",358,0)
 S YSPAR("HELP ?")="^D INPHLP^YSLXDG"
"RTN","YSLXDG",359,0)
 S YSPAR("HELP ??")="^D INPHLP^YSLXDG"
"RTN","YSLXDG",360,0)
 S YSPAR("NO DATA FOUND")="  No data found"
"RTN","YSLXDG",361,0)
 S YSPAR("EXITING")="  Exiting"
"RTN","YSLXDG",362,0)
 S YSPAR("TRY LATER")="  Try again later"
"RTN","YSLXDG",363,0)
 S YSPAR("NO DATA SELECTED")="  No data selected"
"RTN","YSLXDG",364,0)
 S YSPAR("TRY ANOTHER")="Try another"
"RTN","YSLXDG",365,0)
 S YSPAR("WISH CONTINUE")="Do you wish to continue (Y/N)"
"RTN","YSLXDG",366,0)
 S YSPAR("EXCEEDS MESSAGE1")="Searching for """
"RTN","YSLXDG",367,0)
 S YSPAR("EXCEEDS MESSAGE2")=""" requires inspecting "
"RTN","YSLXDG",368,0)
 S YSPAR("EXCEEDS MESSAGE3")=" records to determine if they match the search criteria.  This could take quite some time.  Suggest refining the search by further specifying """
"RTN","YSLXDG",369,0)
 Q
"RTN","YSLXDG",370,0)
 ;
"RTN","YSLXDG",371,0)
 ;
"RTN","YSLXDG",372,0)
 ;a wrapper for ^DIWP
"RTN","YSLXDG",373,0)
 ;accumulates a text and then writes it to the device
"RTN","YSLXDG",374,0)
 ;input parameters :
"RTN","YSLXDG",375,0)
 ; X - text
"RTN","YSLXDG",376,0)
 ; YSMODE:
"RTN","YSLXDG",377,0)
 ;  0 - start
"RTN","YSLXDG",378,0)
 ;  1 - accumulate
"RTN","YSLXDG",379,0)
 ;  2 - write
"RTN","YSLXDG",380,0)
 ;example:
"RTN","YSLXDG",381,0)
 ;D FORMWRIT^ZZLXDG("this API is a wrapper for ^DIWP, it accumulates a text and then writes it to the device, you can use it in your application code",0)
"RTN","YSLXDG",382,0)
 ;D FORMWRIT^ZZLXDG("some more text ",1)
"RTN","YSLXDG",383,0)
 ;D FORMWRIT^ZZLXDG("",2)
"RTN","YSLXDG",384,0)
FORMWRIT(X,YSMODE) ;
"RTN","YSLXDG",385,0)
 N YSLI1
"RTN","YSLXDG",386,0)
 ;if "start" mode
"RTN","YSLXDG",387,0)
 I YSMODE=0 K ^UTILITY($J,"W")
"RTN","YSLXDG",388,0)
 S DIWL=1,DIWR=79
"RTN","YSLXDG",389,0)
 I $L(X)>0 D ^DIWP
"RTN","YSLXDG",390,0)
 ;if "write" mode
"RTN","YSLXDG",391,0)
 I YSMODE=2 D
"RTN","YSLXDG",392,0)
 . S YSLI1=0 F  S YSLI1=$O(^UTILITY($J,"W",1,YSLI1)) Q:+YSLI1=0  W !,$G(^UTILITY($J,"W",1,YSLI1,0))
"RTN","YSLXDG",393,0)
 . K ^UTILITY($J,"W")
"RTN","YSLXDG",394,0)
 Q
"RTN","YSLXDG",395,0)
 ;
"RTN","YSLXDG",396,0)
 ;---------------
"RTN","YSLXDG",397,0)
 ;Initialize variables if you need , your application most likely already has this
"RTN","YSLXDG",398,0)
INITVARS ;
"RTN","YSLXDG",399,0)
 D HOME^%ZIS
"RTN","YSLXDG",400,0)
 S:$G(DT)=0 DT=$$DT^XLFDT
"RTN","YSLXDG",401,0)
 Q
"RTN","YSLXDG",402,0)
 ;press any key
"RTN","YSLXDG",403,0)
PRESSKEY ;
"RTN","YSLXDG",404,0)
 R !!,"Press any key to continue.",YSKEY:DTIME
"RTN","YSLXDG",405,0)
 Q
"RTN","YSLXDG",406,0)
 ;display code info
"RTN","YSLXDG",407,0)
CODEINFO(YSXX2) ; Write Output
"RTN","YSLXDG",408,0)
 N YSKEY,YSICDSTR
"RTN","YSLXDG",409,0)
 S YSICDSTR="ICD"_$S(YSCSYS="30":"10",1:"9")
"RTN","YSLXDG",410,0)
 N YSTXT,YSI S YSTXT(1)=$P($P(YSXX2,";",2),U,2)
"RTN","YSLXDG",411,0)
 D PR^YSLXDG2(.YSTXT,48)
"RTN","YSLXDG",412,0)
 W !," ",YSICDSTR," Diagnosis code:",?31,$P($P(YSXX2,";",2),U,1)
"RTN","YSLXDG",413,0)
 W !," ",YSICDSTR," Diagnosis description:",?31,YSTXT(1)
"RTN","YSLXDG",414,0)
 S YSI=1 F  S YSI=$O(YSTXT(YSI)) Q:+YSI'>0  W !,?31,$G(YSTXT(YSI))
"RTN","YSLXDG",415,0)
 Q
"RTN","YSLXDG",416,0)
 ;
"RTN","YSLXDG2")
0^12^B39703907^n/a
"RTN","YSLXDG2",1,0)
YSLXDG2 ;ALB/RBD - Select ICD DIAGNOSIS FROM LEXICON UTILITY LIST;10 May 2013  9:46 AM
"RTN","YSLXDG2",2,0)
 ;;5.01;MENTAL HEALTH;**107**;Dec 30, 1994;Build 23
"RTN","YSLXDG2",3,0)
 ;
"RTN","YSLXDG2",4,0)
 ; Based on ZZLXDG2
"RTN","YSLXDG2",5,0)
 ;
"RTN","YSLXDG2",6,0)
 ; Input
"RTN","YSLXDG2",7,0)
 ;
"RTN","YSLXDG2",8,0)
 ;     X     Length of list to display (default 5)
"RTN","YSLXDG2",9,0)
 ;    .YSSRL   Local array passed by reference
"RTN","YSLXDG2",10,0)
 ;
"RTN","YSLXDG2",11,0)
 ;             YSSRL()   Input Array from ICDSRCH^LEX10CS
"RTN","YSLXDG2",12,0)
 ;
"RTN","YSLXDG2",13,0)
 ;             YSSRL(0)=# found ^ Pruning Indicator
"RTN","YSLXDG2",14,0)
 ;             YSSRL(1,0)=Code ^ Code IEN ^ date
"RTN","YSLXDG2",15,0)
 ;             YSSRL(1,"IDL")=ICD-9/10 Description, Long
"RTN","YSLXDG2",16,0)
 ;             YSSRL(1,"IDL",1)=ICD-9/10 IEN ^ date
"RTN","YSLXDG2",17,0)
 ;             YSSRL(1,"IDS")=ICD-9/10 Description, Short
"RTN","YSLXDG2",18,0)
 ;             YSSRL(1,"IDS",1)=ICD-9/10 IEN ^ date
"RTN","YSLXDG2",19,0)
 ;             YSSRL(1,"LEX")=Lexicon Description
"RTN","YSLXDG2",20,0)
 ;             YSSRL(1,"LEX",1)=Expression IEN ^ date
"RTN","YSLXDG2",21,0)
 ;             YSSRL(1,"SYN",1)=Synonym #1
"RTN","YSLXDG2",22,0)
 ;             YSSRL(1,"SYN",m)=Synonym #m
"RTN","YSLXDG2",23,0)
 ;             ...
"RTN","YSLXDG2",24,0)
 ;
"RTN","YSLXDG2",25,0)
 ; Output
"RTN","YSLXDG2",26,0)
 ;
"RTN","YSLXDG2",27,0)
 ;    $$SEL  Two Piece "^" delimited string same as
"RTN","YSLXDG2",28,0)
 ;           Fileman's Y output variable
"RTN","YSLXDG2",29,0)
 ;
"RTN","YSLXDG2",30,0)
 ;             1  Lexicon IEN
"RTN","YSLXDG2",31,0)
 ;             2  Lexicon Term
"RTN","YSLXDG2",32,0)
 ;
"RTN","YSLXDG2",33,0)
 ;    YSSRL    Local array passed by reference
"RTN","YSLXDG2",34,0)
 ;
"RTN","YSLXDG2",35,0)
 ;             YSSRL(0)=Code ^ Code IEN ^ date
"RTN","YSLXDG2",36,0)
 ;             YSSRL("IDL")=ICD-9/10 Description, Long
"RTN","YSLXDG2",37,0)
 ;             YSSRL("IDL",1)=ICD-9/10 IEN ^ date
"RTN","YSLXDG2",38,0)
 ;             YSSRL("IDS")=ICD-9/10 Description, Short
"RTN","YSLXDG2",39,0)
 ;             YSSRL("IDS",1)=ICD-9/10 IEN ^ date
"RTN","YSLXDG2",40,0)
 ;             YSSRL("LEX")=Lexicon Description
"RTN","YSLXDG2",41,0)
 ;             YSSRL("LEX",1)=Expression IEN ^ date
"RTN","YSLXDG2",42,0)
 ;
"RTN","YSLXDG2",43,0)
 ;    or ^ on error
"RTN","YSLXDG2",44,0)
 ;    or -1 for non-selection
"RTN","YSLXDG2",45,0)
 ;    or -2 if "^" was entered
"RTN","YSLXDG2",46,0)
 ;               
"RTN","YSLXDG2",47,0)
SEL(YSSRL,X) ; Select from List
"RTN","YSLXDG2",48,0)
 N YSGOUP S YSGOUP=0
"RTN","YSLXDG2",49,0)
 S X=+($G(X))
"RTN","YSLXDG2",50,0)
 S:X'>0 X=5
"RTN","YSLXDG2",51,0)
 S X=$$ASK(.YSSRL,X)
"RTN","YSLXDG2",52,0)
 I YSGOUP=1 Q -2
"RTN","YSLXDG2",53,0)
 Q X
"RTN","YSLXDG2",54,0)
 ;
"RTN","YSLXDG2",55,0)
ASK(YSSRL,X) ; Ask for Selection
"RTN","YSLXDG2",56,0)
 N DTOUT,DUOUT,DIROUT
"RTN","YSLXDG2",57,0)
 N YSLIT,YSLL,YSLTOT
"RTN","YSLXDG2",58,0)
 S YSLL=+($G(X))
"RTN","YSLXDG2",59,0)
 S:YSLL'>0 YSLL=5
"RTN","YSLXDG2",60,0)
 S YSLIT=0,YSLTOT=$O(YSSRL(" "),-1)
"RTN","YSLXDG2",61,0)
 Q:+YSLTOT'>0 "^"
"RTN","YSLXDG2",62,0)
 K X
"RTN","YSLXDG2",63,0)
 S:+YSLTOT=1 X=$$ONE(YSLL,.YSSRL)
"RTN","YSLXDG2",64,0)
 S:+YSLTOT>1 X=$$MUL(.YSSRL,YSLL)
"RTN","YSLXDG2",65,0)
 S:'$D(DTOUT)&('$D(DUOUT))&('$D(DIROUT))&(+($G(X))'>0) X=-1
"RTN","YSLXDG2",66,0)
 Q X
"RTN","YSLXDG2",67,0)
ONE(X,YSSRL) ; One Entry Found
"RTN","YSLXDG2",68,0)
 Q:+($G(YSLIT))>0 "^^"
"RTN","YSLXDG2",69,0)
 N DIR,YSLC,YSLEX,YSLFI,YSLIT,YSLSO,YSLNC
"RTN","YSLXDG2",70,0)
 N YSLSP,YSLTX,YSLC,YSNXTLIN,Y
"RTN","YSLXDG2",71,0)
 S YSLFI=$O(YSSRL(0)) Q:+YSLFI'>0 "^"  S YSLSP=$J(" ",11)
"RTN","YSLXDG2",72,0)
 S YSLSO=$P(YSSRL(1,0),"^",1),YSLNC=$P(YSSRL(1,0),"^",3)
"RTN","YSLXDG2",73,0)
 S:+YSLNC>0 YSLNC=" ("_YSLNC_")" S YSLEX=$G(YSSRL(1,"MENU"))
"RTN","YSLXDG2",74,0)
 S YSLC=$S($D(YSSRL(1,"CAT")):"-",1:"")
"RTN","YSLXDG2",75,0)
 S YSLTX(1)=YSLSO_YSLC_$J(" ",(9-$L(YSLSO)))_" "_YSLEX_YSLNC
"RTN","YSLXDG2",76,0)
 D PR(.YSLTX,64) S DIR("A",1)=" One match found",DIR("A",2)=" "
"RTN","YSLXDG2",77,0)
 S DIR("A",3)=" "_$G(YSLTX(1)),YSLC=3 I $L($G(YSLTX(2))) D
"RTN","YSLXDG2",78,0)
 . F YSNXTLIN=2:1 Q:$G(YSLTX(YSNXTLIN))=""  D
"RTN","YSLXDG2",79,0)
 .. S YSLC=YSLC+1,DIR("A",YSLC)=YSLSP_$G(YSLTX(YSNXTLIN))
"RTN","YSLXDG2",80,0)
 S YSLC=YSLC+1,DIR("A",YSLC)=" ",YSLC=YSLC+1
"RTN","YSLXDG2",81,0)
 S DIR("A")=" OK? (Yes/No) ",DIR("B")="Yes",DIR(0)="YAO" W !
"RTN","YSLXDG2",82,0)
 D ^DIR Q:'$D(DTOUT)&('$D(DUOUT))&('$D(DIROUT))&(+($G(Y))'>0) -1
"RTN","YSLXDG2",83,0)
 S:X["^^"!($D(DTOUT)) YSLIT=1
"RTN","YSLXDG2",84,0)
 I X["^^"!(+($G(YSLIT))>0) K YSSRL Q "^^"
"RTN","YSLXDG2",85,0)
 S X=$S(+Y>0:$$X(1,.YSSRL),1:-1)
"RTN","YSLXDG2",86,0)
 Q X
"RTN","YSLXDG2",87,0)
MUL(YSSRL,Y) ; Multiple Entries Found
"RTN","YSLXDG2",88,0)
 Q:+($G(YSLIT))>0 "^^"
"RTN","YSLXDG2",89,0)
 N YSSRLE,YSLL,YSLMAX,YSLSS,YSLX,X
"RTN","YSLXDG2",90,0)
 S (YSLMAX,YSLSS,YSLIT)=0,YSLL=+($G(Y)),U="^" S:+($G(YSLL))'>0 YSLL=5
"RTN","YSLXDG2",91,0)
 S YSLX=$O(YSSRL(" "),-1),YSLSS=0
"RTN","YSLXDG2",92,0)
 G:+YSLX=0 MULQ W ! W:+YSLX>1 !," ",YSLX," matches found"
"RTN","YSLXDG2",93,0)
 F YSSRLE=1:1:YSLX Q:((YSLSS>0)&(YSLSS<(YSSRLE+1)))  Q:YSLIT  D  Q:YSLIT
"RTN","YSLXDG2",94,0)
 . W:YSSRLE#YSLL=1 ! D MULW
"RTN","YSLXDG2",95,0)
 . S YSLMAX=YSSRLE W:YSSRLE#YSLL=0 !
"RTN","YSLXDG2",96,0)
 . S:YSSRLE#YSLL=0 YSLSS=$$MULS(YSLMAX,YSSRLE,.YSSRL) S:YSLSS["^" YSLIT=1
"RTN","YSLXDG2",97,0)
 I YSSRLE#YSLL'=0,+YSLSS<=0 D
"RTN","YSLXDG2",98,0)
 . W ! S YSLSS=$$MULS(YSLMAX,YSSRLE,.YSSRL) S:YSLSS["^" YSLIT=1
"RTN","YSLXDG2",99,0)
 G MULQ
"RTN","YSLXDG2",100,0)
 Q X
"RTN","YSLXDG2",101,0)
MULW ; Write Multiple
"RTN","YSLXDG2",102,0)
 N YSLEX,YSLI1,YSLSO,YSLNC,YSLT2,YSLTX S YSLSO=$P(YSSRL(+YSSRLE,0),"^",1)
"RTN","YSLXDG2",103,0)
 S YSLNC=$P(YSSRL(+YSSRLE,0),"^",3) S:+YSLNC>0 YSLNC=" ("_YSLNC_")"
"RTN","YSLXDG2",104,0)
 S YSLEX=$G(YSSRL(+YSSRLE,"MENU")),YSLTX(1)=YSLSO
"RTN","YSLXDG2",105,0)
 S YSLTX(1)=YSLTX(1)_$S($D(YSSRL(+YSSRLE,"CAT")):"-",1:" ")_$J(" ",(9-$L(YSLSO)))_" "_YSLEX_YSLNC
"RTN","YSLXDG2",106,0)
 D PR(.YSLTX,60) W !,$J(YSSRLE,5),".  ",$G(YSLTX(1))
"RTN","YSLXDG2",107,0)
 F YSLI1=2:1:5 S YSLT2=$G(YSLTX(YSLI1)) W:$L(YSLT2) !,$J(" ",19),YSLT2
"RTN","YSLXDG2",108,0)
 Q
"RTN","YSLXDG2",109,0)
MULS(X,Y,YSSRL) ; Select from Multiple Entries
"RTN","YSLXDG2",110,0)
 N DIR,DIRB,YSLFI,YSLHLP,YSLLST,YSLMAX,YSLS1 ;@#$ not sure YSLS1 is needed here
"RTN","YSLXDG2",111,0)
 Q:+($G(YSLIT))>0 "^^"  S YSLMAX=+($G(X)),YSLLST=+($G(Y))
"RTN","YSLXDG2",112,0)
 Q:YSLMAX=0 -1 S YSLFI=$O(YSSRL(0)) Q:+YSLFI'>0 -1
"RTN","YSLXDG2",113,0)
 I +($O(YSSRL(+YSLLST)))>0 D
"RTN","YSLXDG2",114,0)
 . S DIR("A")=" Press <RETURN> for more, ""^"" to exit, or Select 1-"
"RTN","YSLXDG2",115,0)
 . S DIR("A")=DIR("A")_YSLMAX_": "
"RTN","YSLXDG2",116,0)
 I +($O(YSSRL(+YSLLST)))'>0 D
"RTN","YSLXDG2",117,0)
 . S DIR("A")=" Select 1-"_YSLMAX_": "
"RTN","YSLXDG2",118,0)
 S YSLHLP=" Answer must be from 1 to "
"RTN","YSLXDG2",119,0)
 S YSLHLP=YSLHLP_YSLMAX_", or <Return> to continue"
"RTN","YSLXDG2",120,0)
 S DIR("PRE")="S:X[""?"" X=""??"""
"RTN","YSLXDG2",121,0)
 S (DIR("?"),DIR("??"))="^D MULSH^YSLXDG2"
"RTN","YSLXDG2",122,0)
 S DIR(0)="NAO^1:"_YSLMAX_":0" D ^DIR
"RTN","YSLXDG2",123,0)
 S:X="^" YSGOUP=1
"RTN","YSLXDG2",124,0)
 Q:'$D(DTOUT)&('$D(DUOUT))&('$D(DIROUT))&(+($G(Y))'>0) -1
"RTN","YSLXDG2",125,0)
 S:X["^^"!($D(DTOUT)) YSLIT=1,X="^^" I X["^^"!(+($G(YSLIT))>0) Q "^^"
"RTN","YSLXDG2",126,0)
 K DIR Q:$D(DTOUT)!(X[U) "^^"
"RTN","YSLXDG2",127,0)
 Q $S(+Y>0:+Y,1:"-1")
"RTN","YSLXDG2",128,0)
MULSH ; Select from Multiple Entries Help
"RTN","YSLXDG2",129,0)
 I $L($G(YSLHLP)) W !,$G(YSLHLP) Q
"RTN","YSLXDG2",130,0)
 Q
"RTN","YSLXDG2",131,0)
MULQ ; Quit Multiple
"RTN","YSLXDG2",132,0)
 I +YSLSS'>0,$G(YSLSS)="^" Q "^"
"RTN","YSLXDG2",133,0)
 S X=-1 S:+($G(YSLIT))'>0 X=$$X(+YSLSS,.YSSRL)
"RTN","YSLXDG2",134,0)
 Q X
"RTN","YSLXDG2",135,0)
X(X,YSSRL) ; Set X and Output Array
"RTN","YSLXDG2",136,0)
 N YSLEX,YSSRFI,YSLIEN,YSLN1,YSLNC,YSLNN,YSLRN,YSLS1,YSLSO
"RTN","YSLXDG2",137,0)
 S YSLS1=+($G(X))
"RTN","YSLXDG2",138,0)
 S YSSRFI=$O(YSSRL(0)) ;@#$ not used?
"RTN","YSLXDG2",139,0)
 S YSLSO=$P($G(YSSRL(YSLS1,0)),"^",1),YSLEX=$G(YSSRL(YSLS1,"MENU"))
"RTN","YSLXDG2",140,0)
 S YSLIEN=$S($D(YSSRL(YSLS1,"CAT")):"99:CAT;"_$P($G(YSSRL(YSLS1,0)),"^"),1:$P($G(YSSRL(YSLS1,"LEX",1)),"^")_";"_$P($G(YSSRL(YSLS1,0)),"^")) Q:'$L(YSLSO) "^"
"RTN","YSLXDG2",141,0)
 Q:'$L(YSLEX) "^"  Q:+YSLIEN'>0 "^" S X=YSLIEN_"^"_YSLEX
"RTN","YSLXDG2",142,0)
 S YSLNN="YSSRL("_+YSLS1_")",YSLNC="YSSRL("_+YSLS1_","
"RTN","YSLXDG2",143,0)
 F  S YSLNN=$Q(@YSLNN) Q:'$L(YSLNN)!(YSLNN'[YSLNC)  D
"RTN","YSLXDG2",144,0)
 . S YSLRN="YSLN1("_$P(YSLNN,"(",2,299) S @YSLRN=@YSLNN
"RTN","YSLXDG2",145,0)
 K YSSRL S YSLNN="YSLN1("_+YSLS1_")",YSLNC="YSLN1("_+YSLS1_","
"RTN","YSLXDG2",146,0)
 F  S YSLNN=$Q(@YSLNN) Q:'$L(YSLNN)!(YSLNN'[YSLNC)  D
"RTN","YSLXDG2",147,0)
 . S YSLRN="YSSRL("_$P(YSLNN,"(",2,299),@YSLRN=@YSLNN
"RTN","YSLXDG2",148,0)
 Q X
"RTN","YSLXDG2",149,0)
 ;
"RTN","YSLXDG2",150,0)
 ; Miscellaneous
"RTN","YSLXDG2",151,0)
CL ; Clear
"RTN","YSLXDG2",152,0)
 K YSLIT
"RTN","YSLXDG2",153,0)
 Q
"RTN","YSLXDG2",154,0)
PR(YSSRL,X) ; Parse Array
"RTN","YSLXDG2",155,0)
 N DIW,DIWF,DIWI,DIWL,DIWR,DIWT,DIWTC,DIWX,DN,I,Z,%,%D,YSLC,YSLI1,YSLL
"RTN","YSLXDG2",156,0)
 K ^UTILITY($J,"W")
"RTN","YSLXDG2",157,0)
 Q:'$D(YSSRL)
"RTN","YSLXDG2",158,0)
 S YSLL=+($G(X))
"RTN","YSLXDG2",159,0)
 S:+YSLL'>0 YSLL=79
"RTN","YSLXDG2",160,0)
 S YSLC=+($G(YSSRL))
"RTN","YSLXDG2",161,0)
 S:+($G(YSLC))'>0 YSLC=$O(YSSRL(" "),-1)
"RTN","YSLXDG2",162,0)
 Q:+YSLC'>0
"RTN","YSLXDG2",163,0)
 S DIWL=1,DIWF="C"_+YSLL
"RTN","YSLXDG2",164,0)
 S YSLI1=0
"RTN","YSLXDG2",165,0)
 F  S YSLI1=$O(YSSRL(YSLI1)) Q:+YSLI1=0  S X=$G(YSSRL(YSLI1)) D ^DIWP
"RTN","YSLXDG2",166,0)
 K YSSRL
"RTN","YSLXDG2",167,0)
 S (YSLC,YSLI1)=0
"RTN","YSLXDG2",168,0)
 F  S YSLI1=$O(^UTILITY($J,"W",1,YSLI1)) Q:+YSLI1=0  D
"RTN","YSLXDG2",169,0)
 . S YSSRL(YSLI1)=$$TM($G(^UTILITY($J,"W",1,YSLI1,0))," "),YSLC=YSLC+1
"RTN","YSLXDG2",170,0)
 S:$L(YSLC) YSSRL=YSLC
"RTN","YSLXDG2",171,0)
 K ^UTILITY($J,"W")
"RTN","YSLXDG2",172,0)
 Q
"RTN","YSLXDG2",173,0)
TM(X,Y) ; Trim Character Y - Default " "
"RTN","YSLXDG2",174,0)
 S X=$G(X) Q:X="" X S Y=$G(Y) S:'$L(Y) Y=" "
"RTN","YSLXDG2",175,0)
 F  Q:$E(X,1)'=Y  S X=$E(X,2,$L(X))
"RTN","YSLXDG2",176,0)
 F  Q:$E(X,$L(X))'=Y  S X=$E(X,1,($L(X)-1))
"RTN","YSLXDG2",177,0)
 Q X
"RTN","YSSR")
0^10^B34732043^B31889856
"RTN","YSSR",1,0)
YSSR ;SLC/AFE,HIOFO/FT - SECLUSION/RESTRAINT - Lookup & Entry ;10/21/11 9:51am
"RTN","YSSR",2,0)
 ;;5.01;MENTAL HEALTH;**82,60,107**;Dec 30, 1994;Build 23
"RTN","YSSR",3,0)
 ;
"RTN","YSSR",4,0)
 ;Reference to VADPT APIs supported by DBIA #10061
"RTN","YSSR",5,0)
 ;Reference to XUSCLEAN APIs supported by DBIA #10052
"RTN","YSSR",6,0)
 ;Reference to ^DPT( supported by DBIA #10035
"RTN","YSSR",7,0)
 ;
"RTN","YSSR",8,0)
ENLST ; Called from MENU option YSSR ENTRY
"RTN","YSSR",9,0)
 ; Entry of basic S/R information
"RTN","YSSR",10,0)
 W @IOF,!?IOM-$L("SECLUSION/RESTRAINT INFORMATION")\2,"SECLUSION/RESTRAINT INFORMATION",! S MSG1="No patients listed in Seclusion/Restraint." D LKUP
"RTN","YSSR",11,0)
ENTER ;
"RTN","YSSR",12,0)
 D ^YSLRP I YSDFN'>0 G END
"RTN","YSSR",13,0)
 I $D(^YS(615.2,"AC",YSDFN)) W !!,"Patient shown in Seclusion/Restraint at this time.",! D WAIT^YSUTL G END
"RTN","YSSR",14,0)
 W ! S DIC="^YS(615.2,",DIC(0)="L",X="""N""",DLAYGO=615.2 D ^DIC G:Y<1 END S FN=+Y
"RTN","YSSR",15,0)
SQ ;
"RTN","YSSR",16,0)
 S %=0 F  Q:$G(%)  W !,"Was patient searched" S %=1 D
"RTN","YSSR",17,0)
 .D YN^DICN S YSTOUT=$D(DTOUT),YSUOUT=$D(DUOUT) I '% W !!,"If patient was not searched, a reason should be given for the omission.",!
"RTN","YSSR",18,0)
 I YSTOUT!YSUOUT!(%=-1) D DELETE G END
"RTN","YSSR",19,0)
 N YSTO S YSTO=0 ;TimeOut check: 1=timed out
"RTN","YSSR",20,0)
 I %=1 D  I YSTO D DELETE G END
"RTN","YSSR",21,0)
 . S DA=FN,DIE=DIC,DR=".08////Y"
"RTN","YSSR",22,0)
 . L +^YS(615.2,DA):DILOCKTM I '$T D ERRMSG^YSSITE S YSTO=1 Q
"RTN","YSSR",23,0)
 . D ^DIE L -^YS(615.2,DA)
"RTN","YSSR",24,0)
 I %=2 D  I YSTO D DELETE G END
"RTN","YSSR",25,0)
 . S DA=FN,DIE=DIC,DR=".08////N;.09"
"RTN","YSSR",26,0)
 . L +^YS(615.2,DA):DILOCKTM I '$T D ERRMSG^YSSITE S YSTO=1 Q
"RTN","YSSR",27,0)
 . D ^DIE L -^YS(615.2,DA)
"RTN","YSSR",28,0)
 . S YSTOUT=$D(DTOUT)
"RTN","YSSR",29,0)
 . S:YSTOUT YSTO=1
"RTN","YSSR",30,0)
 D DXLKUP
"RTN","YSSR",31,0)
 W ! S DIE="^YS(615.2,",DA=FN,DR=".02////"_YSDFN_";.03//NOW;.04:.07;25:27;4///^S X=""`""_DUZ;5:6;7//^S X=YSDX;10;15:20;30"
"RTN","YSSR",32,0)
 L +^YS(615.2,DA):DILOCKTM
"RTN","YSSR",33,0)
 I '$T D ERRMSG^YSSITE D DELETE G END
"RTN","YSSR",34,0)
 K Y D ^DIE L -^YS(615.2,DA)
"RTN","YSSR",35,0)
 S YSTOUT=$D(DTOUT),YSUOUT=$O(Y(""))]""
"RTN","YSSR",36,0)
 I YSTOUT!YSUOUT!('$O(^YS(615.2,DA,5,0)))!('$O(^YS(615.2,DA,6,0)))!($G(^YS(615.2,DA,7))']"")!('$O(^(10,0)))!('+$G(^YS(615.2,DA,25))) W !!?13,"INSUFFICIENT INFORMATION" D DELETE G END
"RTN","YSSR",37,0)
REVIEW ;
"RTN","YSSR",38,0)
 S %=0 F  Q:$G(%)  W !!,"Do you need to edit the above information" S %=1 D
"RTN","YSSR",39,0)
 .D YN^DICN S YSTOUT=$D(DTOUT),YSUOUT=$D(DUOUT) I '% W !!,"After the information is filed, you may no longer edit it.",!,"You may alter the information now.",!
"RTN","YSSR",40,0)
 I YSTOUT!YSUOUT D DELETE G END
"RTN","YSSR",41,0)
 I %=1 D EDIT
"RTN","YSSR",42,0)
FILE ;
"RTN","YSSR",43,0)
 S %=0 F  Q:$G(%)  W !!,"Save this information" S %=1 D
"RTN","YSSR",44,0)
 .D YN^DICN S YSTOUT=$D(DTOUT),YSUOUT=$D(DUOUT) I '% W !!,"NO, will delete this information from the record.",!,"YES, will file it under the patient's name."
"RTN","YSSR",45,0)
 I %=1 W !!?5,"INFORMATION NOTED.",! Q
"RTN","YSSR",46,0)
 D DELETE
"RTN","YSSR",47,0)
END ; Called by routines YSSR1, YSSR2
"RTN","YSSR",48,0)
 N YSDT,YSPDZ,YSTOUT,YSUOUT,XQT,YSDTM,YSLC,YSLCN,YSTM D KILL^XUSCLEAN
"RTN","YSSR",49,0)
 Q
"RTN","YSSR",50,0)
EDIT ;
"RTN","YSSR",51,0)
 N DA,DIE,DR
"RTN","YSSR",52,0)
 S DIE="^YS(615.2,",DA=FN,DR=".03:3;5:25:27;30"
"RTN","YSSR",53,0)
 L +^YS(615.2,DA):DILOCKTM
"RTN","YSSR",54,0)
 I '$T D ERRMSG^YSSITE Q
"RTN","YSSR",55,0)
 D ^DIE L -^YS(615.2,DA)
"RTN","YSSR",56,0)
 Q
"RTN","YSSR",57,0)
DELETE ; Called by routine YSSR2
"RTN","YSSR",58,0)
 N DA,DIK
"RTN","YSSR",59,0)
 S DIK="^YS(615.2,",DA=FN D ^DIK W !!?10,"< ENTRY FOR "_$P(YSNM,",",2)_" "_$P(YSNM,",")_" DELETED >",!
"RTN","YSSR",60,0)
 Q
"RTN","YSSR",61,0)
PTNAME ; Called by routine YSSR1
"RTN","YSSR",62,0)
 ; Patient look-up.
"RTN","YSSR",63,0)
 W ! D ^YSLRP I $G(X)["^" S YSQT=1 Q
"RTN","YSSR",64,0)
 I YSDFN<1 W !!,"Patient Name Required.",! S YSQT=1 Q
"RTN","YSSR",65,0)
 S YSN=$P(YSNM,",",2)_" "_$P(YSNM,",")
"RTN","YSSR",66,0)
 Q
"RTN","YSSR",67,0)
LKUP ; Called as ENTRY action from MENU option YSSR SEC/RES
"RTN","YSSR",68,0)
 ; Called by routine YSSR1
"RTN","YSSR",69,0)
 ; Lists patients in currently in S/R.  May pass YSQT.
"RTN","YSSR",70,0)
 S:'$D(MSG1) MSG1="No patients currently listed in seclusion/restraint." I '$O(^YS(615.2,"AC",0)) W !?IOM-$L(" ** "_MSG1_" ** ")\2," ** "_MSG1_" ** ",!! Q
"RTN","YSSR",71,0)
 W !!,"The following patient(s) are currently listed as being in Seclusion/Restraint:  ",!
"RTN","YSSR",72,0)
 D HEADER S A=0 F  S A=$O(^YS(615.2,"AC",A)) Q:'A  S A1=0 F  S A1=$O(^YS(615.2,"AC",A,A1)) Q:'A1  D PNAMES
"RTN","YSSR",73,0)
 I $D(YS02) W !!," * Written order required.",!
"RTN","YSSR",74,0)
 I $D(YS04) W:'$D(YS02) !! W " # Record incomplete, please contact IRM.",!
"RTN","YSSR",75,0)
 I '$D(C1) W !?5," ** ",MSG1," ** " K C1 I $D(OPT) S YSQT=1
"RTN","YSSR",76,0)
 S %DT="T",X="N" D ^%DT
"RTN","YSSR",77,0)
 K YS02,YS04
"RTN","YSSR",78,0)
 Q
"RTN","YSSR",79,0)
PNAMES ; Called by routine YSSR1
"RTN","YSSR",80,0)
 K YS01,YS03 S DFN=A D DEM^VADPT,PID^VADPT S B=VADM(1),SSN=VA("BID") S C1=+1
"RTN","YSSR",81,0)
 S Y=$P($G(^YS(615.2,A1,0)),"^",3) D DD^%DT
"RTN","YSSR",82,0)
 D TTIME
"RTN","YSSR",83,0)
 S JRBY=$P($G(^YS(615.2,A1,25)),"^")
"RTN","YSSR",84,0)
 S JRBYN="" I JRBY S JRBYN=$P(^VA(200,JRBY,0),"^",1)
"RTN","YSSR",85,0)
 S Y=$P($G(^YS(615.2,A1,0)),"^",3) D DD^%DT
"RTN","YSSR",86,0)
 I $D(^YS(615.2,"AF",A)) S (YS01,YS02)="*"
"RTN","YSSR",87,0)
 I '$O(^YS(615.2,A1,5,0))!('$O(^YS(615.2,A1,6,0)))!($G(^YS(615.2,A1,7))']"")!('$O(^(10,0)))!('+$G(^YS(615.2,A1,25))) S (YS03,YS04)="#"
"RTN","YSSR",88,0)
 W !?0,$E(B,1,20),?22,SSN W:$D(YS01) ?28,YS01 I $D(YS03) W ?29,YS03
"RTN","YSSR",89,0)
 W ?31,Y,?52,$E(JRBYN,1,18) I $D(JRTT) W ?71,JRTT
"RTN","YSSR",90,0)
 K JRTT
"RTN","YSSR",91,0)
 K VADM,VA,DFN
"RTN","YSSR",92,0)
 Q
"RTN","YSSR",93,0)
DXLKUP ; Checks ^YSD(627.8 DIAGNOSTIC RESULTS for most recent diagnosis.
"RTN","YSSR",94,0)
 N YSDXDAT
"RTN","YSSR",95,0)
 S YSDX="UNKNOWN" I '$D(^YSD(627.8,"AF",YSDFN)) Q
"RTN","YSSR",96,0)
 S K=0,K=$O(^YSD(627.8,"AF",YSDFN,K)),L="",L=$O(^YSD(627.8,"AF",YSDFN,K,L))
"RTN","YSSR",97,0)
 S M="",M=$O(^YSD(627.8,"AF",YSDFN,K,L,M)),YSDXDAT=""
"RTN","YSSR",98,0)
 I M]"" S YSDXDAT=$P($G(^YSD(627.8,M,0)),"^",3)
"RTN","YSSR",99,0)
 S M1=$P(L,";"),M2=$P(L,";",2) K K,L,M
"RTN","YSSR",100,0)
 I M2["YSD" D
"RTN","YSSR",101,0)
 . S N1="^"_M2_M1_","_0_")"
"RTN","YSSR",102,0)
 . S N2=$P(@N1,"^",1),YSDX=N2_" "_$E($G(^YSD(627.7,M1,"D")),1,60)
"RTN","YSSR",103,0)
 I M2["ICD" D  Q
"RTN","YSSR",104,0)
 . S N1="^"_M2_M1_","_0_")"
"RTN","YSSR",105,0)
 . ;S YSDX=$P(@N1,"^",1)_" "_$E($P(@N1,"^",3),1,60)
"RTN","YSSR",106,0)
 . S YSDX=$$ICDDATA^ICDXCODE("DIAG",M1,YSDXDAT,"I")
"RTN","YSSR",107,0)
 . S YSDX=$P(YSDX,"^",2)_" "_$E($P(YSDX,"^",4),1,60)
"RTN","YSSR",108,0)
 I M2["DIC" S N1="^"_M2_M1_","_0_")",N2=$P(@N1,"^",2),N3="^"_M2_M1_","_3_")",N4=$P(@N3,"^",1),YSDX=N2_" "_$E(N4,1,60)
"RTN","YSSR",109,0)
 K M1,M2,N1,N2,N3,N4
"RTN","YSSR",110,0)
 Q
"RTN","YSSR",111,0)
HEADER ; Write header
"RTN","YSSR",112,0)
 W !?31,"DATE & TIME",?72,"TOTAL",!
"RTN","YSSR",113,0)
 W ?0,"PATIENT",?23,"SSN",?31,"INITIATED",?52,"ORDERED BY",?72,"TIME",!
"RTN","YSSR",114,0)
 F I=1:1:IOM W "="
"RTN","YSSR",115,0)
 W !
"RTN","YSSR",116,0)
 Q
"RTN","YSSR",117,0)
TTIME ;calculate total time
"RTN","YSSR",118,0)
 I $D(^YS(615.2,A1,0)),$P(^(0),"^",3)'="" S R1=$P(^YS(615.2,A1,0),"^",3)
"RTN","YSSR",119,0)
 I $D(^YS(615.2,A1,40)),$P(^(40),"^",3)'="" S R2=$P(^YS(615.2,A1,40),"^",3)
"RTN","YSSR",120,0)
 I '$D(^YS(615.2,A1,40)) D NOW^%DTC W ! S R2=%
"RTN","YSSR",121,0)
 I $D(R1),$D(R2) S Y=R2 D DD^%DT S JROSR=$P(Y,"@",2),Y=R1 D DD^%DT S JRISR=$P(Y,"@",2)
"RTN","YSSR",122,0)
 I $D(R1),$D(R2) D
"RTN","YSSR",123,0)
 . S X=R1,X1=R2
"RTN","YSSR",124,0)
 . ;next 2 lines are FileMan MINUTES function code
"RTN","YSSR",125,0)
 . S Y=$E(X1_"000",9,10)-$E(X_"000",9,10)*60+$E(X1_"00000",11,12)-$E(X_"00000",11,12),X2=X,X=$P(X,".",1)'=$P(X1,".",1)
"RTN","YSSR",126,0)
 . D ^%DTC:X S X=X*1440+Y
"RTN","YSSR",127,0)
 . S R3=X,JRH=X\60,R4=JRH*60,JRMIN=R3-R4 S JRH=$S($L(JRH)=1:"  "_JRH,$L(JRH)=2:" "_JRH,1:JRH)
"RTN","YSSR",128,0)
 . S JRH=" "_JRH,JRTT=JRH_":"_JRMIN
"RTN","YSSR",129,0)
 K R1,R2,R3,R4,JROSR,JRISR,JRH,JRMIN,Y,X,%
"RTN","YSSR",130,0)
 Q
"VER")
8.0^22.0
"^DD",627.8,627.8,1,0)
DIAGNOSIS^V^^1;1^D DXVALID^YSDXUTL
"^DD",627.8,627.8,1,1,0)
^.1
"^DD",627.8,627.8,1,1,1,0)
627.8^AE^MUMPS
"^DD",627.8,627.8,1,1,1,1)
S X1=$S(X["ICD":"I",X["DIC":"D",1:"Z"),^YSD(627.8,"AE",X1,$P(^YSD(627.8,DA,0),"^",2),$P(^YSD(627.8,DA,0),"^",3),$E(X,1,30),DA)=""
"^DD",627.8,627.8,1,1,1,2)
S X1=$S(X["ICD":"I",X["DIC":"D",1:"Z") K ^YSD(627.8,"AE",X1,$P(^YSD(627.8,DA,0),"^",2),$P(^YSD(627.8,DA,0),"^",3),$E(X,1,30),DA)
"^DD",627.8,627.8,1,1,2,0)
627.8^AF^MUMPS
"^DD",627.8,627.8,1,1,2,1)
S ^YSD(627.8,"AF",$P(^YSD(627.8,DA,0),"^",2),9999999.0000-$P(^YSD(627.8,DA,0),"^",3),$E(X,1,30),DA)=""
"^DD",627.8,627.8,1,1,2,2)
K ^YSD(627.8,"AF",$P(^YSD(627.8,DA,0),"^",2),9999999.0000-$P(^YSD(627.8,DA,0),"^",3),$E(X,1,30),DA)
"^DD",627.8,627.8,1,1,3,0)
627.8^AG^MUMPS
"^DD",627.8,627.8,1,1,3,1)
S X1=$S(X["ICD":"I",X["DIC":"D",1:"Z"),^YSD(627.8,"AG",X1,$P(^YSD(627.8,DA,0),"^",2),$E(X,1,30),DA)=""
"^DD",627.8,627.8,1,1,3,2)
S X1=$S(X["ICD":"I",X["DIC":"D",1:"Z") K ^YSD(627.8,"AG",X1,$P(^YSD(627.8,DA,0),"^",2),$E(X,1,30),DA)
"^DD",627.8,627.8,1,3)
Enter a DSM code for Axes 1 or 2; an ICD DIAGNOSIS Code for Axis 3.
"^DD",627.8,627.8,1,21,0)
^.001^3^3^3120411^^^^
"^DD",627.8,627.8,1,21,1,0)
The diagnosis is a condition which may be responsible for the 
"^DD",627.8,627.8,1,21,2,0)
evaluation or admission to clinical care.
"^DD",627.8,627.8,1,21,3,0)
     
"^DD",627.8,627.8,1,"DT")
3120411
"^DD",627.8,627.8,1,"V",0)
^.12P^3^2
"^DD",627.8,627.8,1,"V",2,0)
80^ICD DIAGNOSIS^2^I^n^n
"^DD",627.8,627.8,1,"V",3,0)
627.5^DSM-III-R^1^D^^n
"^DD",627.8,627.8,1,"V",4,0)
627.7^DSM^3^4^n^n
"^DD",627.8,627.8,10,0)
DXLS^RS^y:YES;n:NO;c:CHANGED;^1;3^Q
"^DD",627.8,627.8,10,1,0)
^.1
"^DD",627.8,627.8,10,1,1,0)
627.8^AD^MUMPS
"^DD",627.8,627.8,10,1,1,1)
S:X="y" ^YSD(627.8,"AD",$P(^YSD(627.8,DA,0),"^",2),9999999.0000-$P(^YSD(627.8,DA,0),"^",3),DA)=""
"^DD",627.8,627.8,10,1,1,2)
K:X="y" ^YSD(627.8,"AD",$P(^YSD(627.8,DA,0),"^",2),9999999.0000-$P(^YSD(627.8,DA,0),"^",3),DA)
"^DD",627.8,627.8,10,1,2,0)
627.8^AH^MUMPS
"^DD",627.8,627.8,10,1,2,1)
I "yc"[X S ^YSD(627.8,"AH",$P(^YSD(627.8,DA,0),"^",2),9999999-$P(^YSD(627.8,DA,0),"^",3),DA)=""
"^DD",627.8,627.8,10,1,2,2)
I "yc"[X K ^YSD(627.8,"AH",$P(^YSD(627.8,DA,0),"^",2),9999999-$P(^YSD(627.8,DA,0),"^",3),DA)
"^DD",627.8,627.8,10,21,0)
^.001^6^6^3120411^^^^
"^DD",627.8,627.8,10,21,1,0)
This is the diagnosis accounting for the largest % of length
"^DD",627.8,627.8,10,21,2,0)
of stay for an admission.  There may only be ONE DXLS (DSM
"^DD",627.8,627.8,10,21,3,0)
or ICD DIAGNOSIS) per admission.
"^DD",627.8,627.8,10,21,4,0)
   
"^DD",627.8,627.8,10,21,5,0)
This information may not be the same as that stored in the
"^DD",627.8,627.8,10,21,6,0)
Patient Treatment Folder (PTF).  
"BLD",8902,6)
^92
**END**
**END**

