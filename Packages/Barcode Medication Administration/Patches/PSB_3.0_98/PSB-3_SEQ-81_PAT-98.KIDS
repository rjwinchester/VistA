Released PSB*3*98 SEQ #81
Extracted from mail message
**KIDS**:PSB*3.0*98^

**INSTALL NAME**
PSB*3.0*98
"BLD",10425,0)
PSB*3.0*98^BAR CODE MED ADMIN^0^3170216^y
"BLD",10425,1,0)
^^15^15^3170216^
"BLD",10425,1,1,0)
This patch will resolve the following issues:
"BLD",10425,1,2,0)
 
"BLD",10425,1,3,0)
1. The Bar Code Medication Administration (BCMA) IVP/IVPB tab continues
"BLD",10425,1,4,0)
   to display orders with a Schedule Type of On Call after the order is 
"BLD",10425,1,5,0)
   administered.
"BLD",10425,1,6,0)
 
"BLD",10425,1,7,0)
2. The BCMA Display Order report displays both BCMA EXPIRED and BCMA
"BLD",10425,1,8,0)
   EXPIRE DENIED in the data field of the Pharmacy Activity section when a
"BLD",10425,1,9,0)
   one time dose medication is administered.
"BLD",10425,1,10,0)
 
"BLD",10425,1,11,0)
3. The BCMA Display Order report displays dates in the data field in 
"BLD",10425,1,12,0)
   internal Fileman format.
"BLD",10425,1,13,0)
 
"BLD",10425,1,14,0)
4. An Undefined error occurs when the Medication Therapy report is run 
"BLD",10425,1,15,0)
   with no schedule types selected.
"BLD",10425,4,0)
^9.64PA^^
"BLD",10425,6.3)
2
"BLD",10425,"KRN",0)
^9.67PA^779.2^20
"BLD",10425,"KRN",.4,0)
.4
"BLD",10425,"KRN",.401,0)
.401
"BLD",10425,"KRN",.402,0)
.402
"BLD",10425,"KRN",.403,0)
.403
"BLD",10425,"KRN",.5,0)
.5
"BLD",10425,"KRN",.84,0)
.84
"BLD",10425,"KRN",3.6,0)
3.6
"BLD",10425,"KRN",3.8,0)
3.8
"BLD",10425,"KRN",9.2,0)
9.2
"BLD",10425,"KRN",9.8,0)
9.8
"BLD",10425,"KRN",9.8,"NM",0)
^9.68A^5^4
"BLD",10425,"KRN",9.8,"NM",2,0)
PSBVDLPB^^0^B108871729
"BLD",10425,"KRN",9.8,"NM",3,0)
PSBODO^^0^B44147738
"BLD",10425,"KRN",9.8,"NM",4,0)
PSBOMT^^0^B106758634
"BLD",10425,"KRN",9.8,"NM",5,0)
PSBML^^0^B156317565
"BLD",10425,"KRN",9.8,"NM","B","PSBML",5)

"BLD",10425,"KRN",9.8,"NM","B","PSBODO",3)

"BLD",10425,"KRN",9.8,"NM","B","PSBOMT",4)

"BLD",10425,"KRN",9.8,"NM","B","PSBVDLPB",2)

"BLD",10425,"KRN",19,0)
19
"BLD",10425,"KRN",19.1,0)
19.1
"BLD",10425,"KRN",101,0)
101
"BLD",10425,"KRN",409.61,0)
409.61
"BLD",10425,"KRN",771,0)
771
"BLD",10425,"KRN",779.2,0)
779.2
"BLD",10425,"KRN",870,0)
870
"BLD",10425,"KRN",8989.51,0)
8989.51
"BLD",10425,"KRN",8989.52,0)
8989.52
"BLD",10425,"KRN",8994,0)
8994
"BLD",10425,"KRN","B",.4,.4)

"BLD",10425,"KRN","B",.401,.401)

"BLD",10425,"KRN","B",.402,.402)

"BLD",10425,"KRN","B",.403,.403)

"BLD",10425,"KRN","B",.5,.5)

"BLD",10425,"KRN","B",.84,.84)

"BLD",10425,"KRN","B",3.6,3.6)

"BLD",10425,"KRN","B",3.8,3.8)

"BLD",10425,"KRN","B",9.2,9.2)

"BLD",10425,"KRN","B",9.8,9.8)

"BLD",10425,"KRN","B",19,19)

"BLD",10425,"KRN","B",19.1,19.1)

"BLD",10425,"KRN","B",101,101)

"BLD",10425,"KRN","B",409.61,409.61)

"BLD",10425,"KRN","B",771,771)

"BLD",10425,"KRN","B",779.2,779.2)

"BLD",10425,"KRN","B",870,870)

"BLD",10425,"KRN","B",8989.51,8989.51)

"BLD",10425,"KRN","B",8989.52,8989.52)

"BLD",10425,"KRN","B",8994,8994)

"BLD",10425,"QUES",0)
^9.62^^
"BLD",10425,"REQB",0)
^9.611^1^1
"BLD",10425,"REQB",1,0)
PSB*3.0*97^2
"BLD",10425,"REQB","B","PSB*3.0*97",1)

"MBREQ")
0
"PKG",550,-1)
1^1
"PKG",550,0)
BAR CODE MED ADMIN^PSB^BAR CODE MEDICATION ADMINISTRATION
"PKG",550,20,0)
^9.402P^^
"PKG",550,22,0)
^9.49I^1^1
"PKG",550,22,1,0)
3.0^3040224^3040311^66481
"PKG",550,22,1,"PAH",1,0)
98^3170216
"PKG",550,22,1,"PAH",1,1,0)
^^15^15^3170216
"PKG",550,22,1,"PAH",1,1,1,0)
This patch will resolve the following issues:
"PKG",550,22,1,"PAH",1,1,2,0)
 
"PKG",550,22,1,"PAH",1,1,3,0)
1. The Bar Code Medication Administration (BCMA) IVP/IVPB tab continues
"PKG",550,22,1,"PAH",1,1,4,0)
   to display orders with a Schedule Type of On Call after the order is 
"PKG",550,22,1,"PAH",1,1,5,0)
   administered.
"PKG",550,22,1,"PAH",1,1,6,0)
 
"PKG",550,22,1,"PAH",1,1,7,0)
2. The BCMA Display Order report displays both BCMA EXPIRED and BCMA
"PKG",550,22,1,"PAH",1,1,8,0)
   EXPIRE DENIED in the data field of the Pharmacy Activity section when a
"PKG",550,22,1,"PAH",1,1,9,0)
   one time dose medication is administered.
"PKG",550,22,1,"PAH",1,1,10,0)
 
"PKG",550,22,1,"PAH",1,1,11,0)
3. The BCMA Display Order report displays dates in the data field in 
"PKG",550,22,1,"PAH",1,1,12,0)
   internal Fileman format.
"PKG",550,22,1,"PAH",1,1,13,0)
 
"PKG",550,22,1,"PAH",1,1,14,0)
4. An Undefined error occurs when the Medication Therapy report is run 
"PKG",550,22,1,"PAH",1,1,15,0)
   with no schedule types selected.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
4
"RTN","PSBML")
0^5^B156317565^B154439138
"RTN","PSBML",1,0)
PSBML ;BIRMINGHAM/EFC-BCMA MED LOG FUNCTIONS ;03/06/16 3:06pm
"RTN","PSBML",2,0)
 ;;3.0;BAR CODE MED ADMIN;**6,3,4,9,11,13,25,45,33,52,70,72,79,94,83,98**;Mar 2004;Build 2
"RTN","PSBML",3,0)
 ;Per VA Directive 6402, this routine should not be modified.
"RTN","PSBML",4,0)
 ; Reference/IA
"RTN","PSBML",5,0)
 ; ^DPT/10035
"RTN","PSBML",6,0)
 ; DIC(42/10039
"RTN","PSBML",7,0)
 ; DIC(42/2440
"RTN","PSBML",8,0)
 ; File 200/10060
"RTN","PSBML",9,0)
 ; EN^PSJBCMA3/3320
"RTN","PSBML",10,0)
 ; $$SITE^VASITE/10112
"RTN","PSBML",11,0)
 ; ^XUSEC(/10076
"RTN","PSBML",12,0)
 ;
"RTN","PSBML",13,0)
 ;*70 - store clinic name to admin location if exists.
"RTN","PSBML",14,0)
 ;    - add witness duz, dt/tm for high risk/alert drug, Order level
"RTN","PSBML",15,0)
 ;      HR code, and a witnessed y/n flag to MEDLOG file.
"RTN","PSBML",16,0)
 ;*83 - store MRR code to DD multiple .06 field, to update AMRR xref
"RTN","PSBML",17,0)
 ;    - store Scheduled Removal time in a new field in 53.79
"RTN","PSBML",18,0)
 ;    - change offset of incoming array from 10th to 11th piece.
"RTN","PSBML",19,0)
 ;
"RTN","PSBML",20,0)
RPC(RESULTS,PSBHDR,PSBREC) ;BCMA MedLog Filing
"RTN","PSBML",21,0)
 K PSBEDTFL
"RTN","PSBML",22,0)
 S PSBEDTFL=0
"RTN","PSBML",23,0)
 N PSBORD,PSBTRAN,PSBFDA,PSBMES ;Add PSBMES variable for PSB*3*52
"RTN","PSBML",24,0)
 N PSBCLIN,PSBWITN,PSBWITCM,PSBWITHR,PSBWITFL,LOC                 ;*70
"RTN","PSBML",25,0)
 N PSBACTN                             ;used for trigger xref code *83
"RTN","PSBML",26,0)
 K PSBIEN,PSBHL7,%,PSBAUDIT,PSBINST
"RTN","PSBML",27,0)
 S PSBIEN=$P(PSBHDR,U,1)
"RTN","PSBML",28,0)
 S PSBTRAN=$P(PSBHDR,U,2),PSBHL7=PSBTRAN
"RTN","PSBML",29,0)
 S PSBINST=$P($G(PSBHDR),U,3)
"RTN","PSBML",30,0)
 ;*70 witness fields
"RTN","PSBML",31,0)
 S PSBWITN=+$P(PSBHDR,U,4)                ;init witness duz var
"RTN","PSBML",32,0)
 S PSBWITCM=$P(PSBHDR,U,5)                ;init witness comment
"RTN","PSBML",33,0)
 S PSBWITHR=+$P(PSBHDR,U,6)               ;init witness HR order level
"RTN","PSBML",34,0)
 S PSBWITFL=$S(PSBWITN:1,1:0)             ;init witnessed?
"RTN","PSBML",35,0)
 I PSBWITN="",PSBWITHR=3 D  Q
"RTN","PSBML",36,0)
 .S RESULTS(0)=1
"RTN","PSBML",37,0)
 .S RESULTS(1)="-1^A Witness is required, however Witness information was null."
"RTN","PSBML",38,0)
 ;PSB*3*45 We should be recording the first entry in the audit log.
"RTN","PSBML",39,0)
 ;S PSBAUDIT=$S(PSBIEN="+1":0,1:1)
"RTN","PSBML",40,0)
 S PSBAUDIT=1
"RTN","PSBML",41,0)
 D NOW^%DTC S PSBNOW=%
"RTN","PSBML",42,0)
 I $D(^XUSEC("PSB STUDENT",DUZ)),PSBINST="" S RESULTS(0)=1,RESULTS(1)="-1^Instructor not present" Q
"RTN","PSBML",43,0)
 I $D(^XUSEC("PSB STUDENT",DUZ)),'$D(^XUSEC("PSB INSTRUCTOR",PSBINST)) S RESULTS(0)=1,RESULTS(1)="-1^Instructor doesn't have authority" Q
"RTN","PSBML",44,0)
 S PSBINST(0)=$$GET1^DIQ(200,PSBINST_",",.01)
"RTN","PSBML",45,0)
 I PSBTRAN="ADD COMMENT" D COMMENT^PSBML1 Q
"RTN","PSBML",46,0)
 I PSBTRAN="PRN EFFECTIVENESS" D PRN^PSBML1 Q
"RTN","PSBML",47,0)
 ;
"RTN","PSBML",48,0)
 ;update medlog rec
"RTN","PSBML",49,0)
UPD I PSBTRAN="UPDATE STATUS" D  Q
"RTN","PSBML",50,0)
 .K PSBTAB,PSBUID
"RTN","PSBML",51,0)
 .S PSBACTN=PSBREC(0)     ;var for trigger code for Variance calcs *83
"RTN","PSBML",52,0)
 .I '$D(^PSB(53.79,PSBIEN)) D  Q
"RTN","PSBML",53,0)
 ..S RESULTS(0)=1
"RTN","PSBML",54,0)
 ..S RESULTS(1)="-1^Administration is at an UNKNOWN STATUS"
"RTN","PSBML",55,0)
 .D UPDATED^PSBML2
"RTN","PSBML",56,0)
 ;
"RTN","PSBML",57,0)
 ;edit Medlog rec
"RTN","PSBML",58,0)
EDITML I PSBTRAN="EDIT" D EDIT^PSBML2 Q
"RTN","PSBML",59,0)
 ;
"RTN","PSBML",60,0)
 ;SAGG
"RTN","PSBML",61,0)
 N PSBWARD S PSBWARD=$G(^DPT(+$G(PSBREC(0)),.1),"UNKNOWN"),^PSB("SAGG",PSBWARD,DT)=$G(^PSB("SAGG",PSBWARD,DT))+1
"RTN","PSBML",62,0)
 ;*70 save clinic name if exists before manipulating PSBREC(1) param
"RTN","PSBML",63,0)
 S PSBCLIN=$P(PSBREC(1),U,2) I PSBCLIN="" S PSBCLIN=$S($G(PSBCLIEN):$P($G(^SC(+PSBCLIEN,0)),"^"),($G(PSBCLORD)]""):PSBCLORD,1:"")
"RTN","PSBML",64,0)
 S PSBREC(1)=$P(PSBREC(1),U)
"RTN","PSBML",65,0)
 ;
"RTN","PSBML",66,0)
 ;pre-existing psbrec(1) manipulation logic to *70
"RTN","PSBML",67,0)
 I PSBREC(1)?1U1";"1.6N S PSBREC(1)=$P(PSBREC(1),";",1)_$E(PSBREC(1))
"RTN","PSBML",68,0)
 D PSJ1^PSBVT(PSBREC(0),$P(PSBREC(1),";",2)_$P(PSBREC(1),";",1))
"RTN","PSBML",69,0)
 S PSBTAB=$P(PSBREC(9),U,1),PSBUID=$P(PSBREC(9),U,2)
"RTN","PSBML",70,0)
MEDP D:PSBTRAN="MEDPASS"
"RTN","PSBML",71,0)
 .K PSBDIV,PSBON,PSBXDT,PSBYZ
"RTN","PSBML",72,0)
 .S PSBACTN=PSBREC(3)     ;var for trigger code for Variance calcs *83
"RTN","PSBML",73,0)
 .I ((PSBDOSEF["PATCH")!(PSBMRRFL)),(PSBREC(3)="G") D  Q:+$G(RESULTS(1))<0   ;add MRR flag to test *83
"RTN","PSBML",74,0)
 ..S PSBXDT="" F  S PSBXDT=$O(^PSB(53.79,"AORDX",PSBDFN,PSBONX,PSBXDT)) Q:PSBXDT=""  D  Q:+$G(RESULTS(1))<0
"RTN","PSBML",75,0)
 ...S PSBYZ="" F  S PSBYZ=$O(^PSB(53.79,"AORDX",PSBDFN,PSBONX,PSBXDT,PSBYZ)) Q:'PSBYZ  I ("G"[$$GET1^DIQ(53.79,PSBYZ,.09,"I")) D  Q
"RTN","PSBML",76,0)
 ....S:($$GET1^DIQ(53.79,PSBYZ,.09,"I")="G") RESULTS(0)=1,RESULTS(1)="-1^Previous administration has not been removed. Administration canceled.^"     ;make generic verbiage *83
"RTN","PSBML",77,0)
 ....S:($$GET1^DIQ(53.79,PSBYZ,.09,"I")="")&(($$GET1^DIQ(53.79,PSBYZ,.07,"I")'=DUZ)&('$D(^XUSEC("PSB MANAGER",DUZ)))) RESULTS(0)=1,RESULTS(1)="-1^Patch status ""*UNKNOWN*"". Administration canceled."
"RTN","PSBML",78,0)
 .I PSBREC(7)="BCMA/CPRS Interface Entry." S PSBNOW=PSBREC(5)  ;MOB
"RTN","PSBML",79,0)
 .F X=0:1:9 S PSBREC(X)=$G(PSBREC(X))
"RTN","PSBML",80,0)
 .I PSBREC(1)?1U1";".N S PSBREC(1)=$P(PSBREC(1),";",2)_$P(PSBREC(1),";",1)
"RTN","PSBML",81,0)
 .I PSBREC(1)["V",+PSBREC(5)>0,+$P(PSBREC(5),".",2)=0,PSBIVT'["P" D NOW^%DTC S PSBREC(5)=$P(PSBREC(5),".",1)_"."_$P(%,".",2)
"RTN","PSBML",82,0)
 .I $P(PSBREC(9),U,1)="IVTAB",$P(PSBREC(9),U,2)="" S PSBUID=$$GETWSID^PSBVDLU2(PSBREC(0),PSBREC(1))
"RTN","PSBML",83,0)
 .I $P(PSBREC(9),U,1)="PBTAB",$P(PSBREC(9),U,2)="",PSBREC(1)'["U",PSBREC(3)'="M",PSBREC(3)'="R",PSBREC(3)'="H" S PSBUID=$$GETWSID^PSBVDLU2(PSBREC(0),PSBREC(1))
"RTN","PSBML",84,0)
 .;OnCal
"RTN","PSBML",85,0)
 .D:PSBREC(2)="OC"
"RTN","PSBML",86,0)
 ..S X=$O(^PSB(53.79,"AORD",PSBREC(0),PSBREC(1),"")) Q:X=""
"RTN","PSBML",87,0)
 ..S Y=$O(^PSB(53.79,"AORD",PSBREC(0),PSBREC(1),X,0))
"RTN","PSBML",88,0)
 ..I $P(^PSB(53.79,Y,0),U,9)="G"&('$$GET^XPAR("DIV","PSB ADMIN MULTIPLE ONCALL")) D ERR(1,"On-Call already given")
"RTN","PSBML",89,0)
 .;1x
"RTN","PSBML",90,0)
 .D:PSBREC(2)="O"
"RTN","PSBML",91,0)
 ..S X=$O(^PSB(53.79,"AORD",PSBREC(0),PSBREC(1),"")) Q:X=""
"RTN","PSBML",92,0)
 ..S Y=$O(^PSB(53.79,"AORD",PSBREC(0),PSBREC(1),X,0))
"RTN","PSBML",93,0)
 ..I $P(^PSB(53.79,Y,0),U,9)="G" D ERR(1,"One Time already Given")
"RTN","PSBML",94,0)
 .;PRN
"RTN","PSBML",95,0)
 .I PSBREC(2)="P",PSBREC(3)'="M",$P(PSBREC(9),U,1)'="IVTAB" D
"RTN","PSBML",96,0)
 ..I PSBREC(6)="" D ERR(1,"PRN Medications MUST Have a PRN Reason")
"RTN","PSBML",97,0)
 ..I PSBREC(5)]"" D ERR(1,"PRN Orders don't have scheduled times")
"RTN","PSBML",98,0)
 ..I PSBREC(3)'="G" D ERR(1,"PRN Orders cannot be marked NOT Given")
"RTN","PSBML",99,0)
 .;Cnt
"RTN","PSBML",100,0)
 .I PSBREC(2)="C",PSBTAB'="IVTAB" D
"RTN","PSBML",101,0)
 ..D:PSBREC(5)="" ERR(1,"Continuous Order needs admin time")
"RTN","PSBML",102,0)
 ..D:PSBREC(6)]"" ERR(1,"No PRN Reason allowed on Continuous Orders")
"RTN","PSBML",103,0)
 .I PSBREC(2)="C",$D(^PSB(53.79,"AORD",PSBREC(0),PSBREC(1),+PSBREC(5))),PSBIEN="+1" D  K PSBADMBY,PSBADMAT Q:PSBSIEN=""  Q:$P(^PSB(53.79,PSBSIEN,0),U,9)'="N"
"RTN","PSBML",104,0)
 ..S PSBSIEN=$O(^PSB(53.79,"AORD",PSBREC(0),PSBREC(1),PSBREC(5),""))
"RTN","PSBML",105,0)
 ..I PSBSIEN]"" I '(($P(^PSB(53.79,PSBSIEN,0),U,7)=DUZ)!($D(^XUSEC("PSB MANAGER",DUZ)))) S PSBSIEN=""
"RTN","PSBML",106,0)
 ..I PSBSIEN']"" S RESULTS(0)=2,RESULTS(1)="-2^Error Filing Transaction MEDPASS",RESULTS(2)="The PSB MANAGER key is required to modify this scheduled admin" Q
"RTN","PSBML",107,0)
 ..D:$P(^PSB(53.79,PSBSIEN,0),U,9)'="N"
"RTN","PSBML",108,0)
 ...K PSBINCX I $P(^PSB(53.79,PSBSIEN,0),U,9)="" S PSBINCX=PSBSIEN L +^PSB(53.79,PSBINCX):1 Q:'$T  L -^PSB(53.79,PSBINCX)
"RTN","PSBML",109,0)
 ...S Y=$P(^PSB(53.79,PSBSIEN,0),U,6) D DD^%DT S PSBADMAT=Y
"RTN","PSBML",110,0)
 ...S PSBADMBY=$$GET1^DIQ(200,$P(^PSB(53.79,PSBSIEN,0),U,7),.01,)
"RTN","PSBML",111,0)
 ...S RESULTS(0)=3,RESULTS(1)="-2^Error Filing Transaction MEDPASS"
"RTN","PSBML",112,0)
 ...S RESULTS(2)="Continuous Administration Date/Time already on file."
"RTN","PSBML",113,0)
 ...S RESULTS(3)="Administered by "_PSBADMBY_" at "_PSBADMAT_"."
"RTN","PSBML",114,0)
 ...I $D(XWB) S RESULTS(0)=RESULTS(0)+2,RESULTS(4)="                                         ",RESULTS(5)="            VDL will now be updated."
"RTN","PSBML",115,0)
 .;Non Given
"RTN","PSBML",116,0)
 .I PSBREC(3)'="G",PSBREC(3)'="M",PSBUID'["V",PSBUID'["W" D
"RTN","PSBML",117,0)
 ..I PSBREC(7)="",PSBTAB'="IVTAB" D ERR(1,"Comment needed if Not Marked Given")
"RTN","PSBML",118,0)
 ..I PSBREC(7)="",PSBTAB="IVTAB" D ERR(1,"Comment needed if Not Marked Completed")
"RTN","PSBML",119,0)
 .S:PSBREC(3)="H" PSBREC(7)="Held: "_PSBREC(7)    ;.3
"RTN","PSBML",120,0)
 .S:PSBREC(3)="R" PSBREC(7)="Refused: "_PSBREC(7) ;.3
"RTN","PSBML",121,0)
 .S:PSBREC(3)="S" PSBREC(7)="Stopped: "_PSBREC(7) ;.3
"RTN","PSBML",122,0)
 .;Valid?
"RTN","PSBML",123,0)
 .I $G(PSBSIEN)'="" I $D(^PSB(53.79,PSBSIEN,0)) I $P(^PSB(53.79,PSBSIEN,0),U,9)="N" S PSBIEN=+PSBSIEN_",",$P(PSBHDR,U)=PSBIEN,PSBTRAN="UPDATE STATUS",PSBAUDIT=1                   ;do UPDATE
"RTN","PSBML",124,0)
 .D:PSBIEN="+1"                          ;New fields only?
"RTN","PSBML",125,0)
 ..D VAL(53.79,PSBIEN,.01,"`"_PSBREC(0))           ;Patn
"RTN","PSBML",126,0)
 ..S LOC=$G(^DPT(PSBREC(0),.1))_" "_$G(^(.101))    ;Ward Room/Bed LOC
"RTN","PSBML",127,0)
 ..S:PSBCLIN]"" LOC=PSBCLIN         ;If clinic order use clin name *70
"RTN","PSBML",128,0)
 ..D VAL(53.79,PSBIEN,.02,LOC)                     ;Patn Location LOC
"RTN","PSBML",129,0)
 ..D:$G(^DPT(PSBREC(0),.1))'=""
"RTN","PSBML",130,0)
 ...S Y=$O(^DIC(42,"B",$G(^DPT(PSBREC(0),.1)),"")),Y=$$GET1^DIQ(42,Y,.015,"I"),PSBDIV=$$SITE^VASITE(DT,Y)
"RTN","PSBML",131,0)
 ...D VAL(53.79,PSBIEN,.03,"`"_$P(PSBDIV,U,1))     ;Div
"RTN","PSBML",132,0)
 ..D VAL(53.79,PSBIEN,.04,PSBNOW)                  ;Entered dt/tm
"RTN","PSBML",133,0)
 ..D VAL(53.79,PSBIEN,.05,"`"_DUZ)                 ;Entered by duz
"RTN","PSBML",134,0)
 ..D VAL(53.79,PSBIEN,.06,PSBNOW)                  ;Admin dt/tm
"RTN","PSBML",135,0)
 ..D VAL(53.79,PSBIEN,.07,"`"_DUZ)                 ;Admin By duz
"RTN","PSBML",136,0)
 ..D VAL(53.79,PSBIEN,.08,"`"_PSBREC(4))           ;Orderable Item
"RTN","PSBML",137,0)
 ..D VAL(53.79,PSBIEN,.11,PSBREC(1))               ;Ord file 55 IEN
"RTN","PSBML",138,0)
 ..D VAL(53.79,PSBIEN,.12,PSBREC(2))               ;Ord Schd Type
"RTN","PSBML",139,0)
 ..D VAL(53.79,PSBIEN,.13,PSBREC(5))               ;Schd Admin dt/tm
"RTN","PSBML",140,0)
 ..I $P($G(PSBREC(10)),".",2)]"" D
"RTN","PSBML",141,0)
 ...D VAL(53.79,PSBIEN,.17,PSBREC(10))             ;Schd Remove dt/tm
"RTN","PSBML",142,0)
 ..D:PSBTAB'="UDTAB" VAL(53.79,PSBIEN,.26,PSBUID)  ;IV Bag ID
"RTN","PSBML",143,0)
 ..D:PSBTAB="IVTAB" VAL(53.79,PSBIEN,.13,"")       ;Schd Admdt/tm null
"RTN","PSBML",144,0)
 ..D:PSBREC(1)?.N1"U" VAL(53.79,PSBIEN,.15,PSBDOSE)  ;UD Dosage
"RTN","PSBML",145,0)
 ..D:PSBREC(1)?.N1"V" VAL(53.79,PSBIEN,.35,PSBIFR)   ;IV Infuse Rate
"RTN","PSBML",146,0)
 ..I PSBWITHR>1,(PSBREC(3)="G")!(PSBREC(3)="I") D          ;Witness logic and Give?  *70
"RTN","PSBML",147,0)
 ...D:PSBWITN VAL(53.79,PSBIEN,.28,PSBNOW)        ;Witness dt/time
"RTN","PSBML",148,0)
 ...D:PSBWITN VAL(53.79,PSBIEN,.29,"`"_PSBWITN)   ;Witness duz
"RTN","PSBML",149,0)
 ...D:PSBWITCM]"" VAL(53.79,PSBIEN,.31,PSBWITCM)  ;Witness comment
"RTN","PSBML",150,0)
 ...D VAL(53.79,PSBIEN,.32,PSBWITHR)              ;Witness HR ord code
"RTN","PSBML",151,0)
 ...D VAL(53.79,PSBIEN,.33,PSBWITFL)              ;Witnessed? flag
"RTN","PSBML",152,0)
 .;
"RTN","PSBML",153,0)
 .;Overwrite fields below, rec already exists
"RTN","PSBML",154,0)
 .I PSBREC(3)="G"!(PSBREC(3))="C" D                ;Gvn/Completed?
"RTN","PSBML",155,0)
 ..D VAL(53.79,PSBIEN,.06,PSBNOW)                    ;Admin dt/tm
"RTN","PSBML",156,0)
 ..D VAL(53.79,PSBIEN,.07,"`"_DUZ)                   ;Admin By duz
"RTN","PSBML",157,0)
 .;     set Derm/Inj site fields  *83
"RTN","PSBML",158,0)
 .I PSBREC(8)]"" D
"RTN","PSBML",159,0)
 ..N SITETXT,SITECD
"RTN","PSBML",160,0)
 ..S SITETXT=$P(PSBREC(8),"|",1),SITECD=$P(PSBREC(8),"|",2)
"RTN","PSBML",161,0)
 ..I SITECD="D" D                     ;If dermal, else assume inj site
"RTN","PSBML",162,0)
 ...D VAL(53.79,PSBIEN,.18,SITETXT)      ;Dermal site
"RTN","PSBML",163,0)
 ..E  D
"RTN","PSBML",164,0)
 ...D VAL(53.79,PSBIEN,.16,SITETXT)      ;Inject site
"RTN","PSBML",165,0)
 .;
"RTN","PSBML",166,0)
 .D:'$G(PSBMMEN) VAL(53.79,PSBIEN,.09,PSBREC(3))   ;AStats
"RTN","PSBML",167,0)
 .I PSBREC(6)]"" D                                 ;PRN reason?
"RTN","PSBML",168,0)
 ..D VAL(53.79,PSBIEN,.21,$P(PSBREC(6),U))           ;reason dt/tm
"RTN","PSBML",169,0)
 ..D VAL(53.79,PSBIEN,.27,$P(PSBREC(6),U,2))         ;PRN reason
"RTN","PSBML",170,0)
 .D:PSBREC(7)]""
"RTN","PSBML",171,0)
 ..D VAL(53.793,"+2,"_PSBIEN,.01,PSBREC(7))        ;Comment
"RTN","PSBML",172,0)
 ..D VAL(53.793,"+2,"_PSBIEN,.02,"`"_DUZ)          ;comnt person duz
"RTN","PSBML",173,0)
 ..D VAL(53.793,"+2,"_PSBIEN,.03,PSBNOW)           ;comnt dt/time
"RTN","PSBML",174,0)
 .;
"RTN","PSBML",175,0)
 .;DD/SOL/ADD
"RTN","PSBML",176,0)
 .I PSBREC(3)="G"!(PSBREC(3)="I")!(PSBREC(3)="H")!(PSBREC(3)="R")!(PSBREC(3)="M") D     ;given/action stat codes?
"RTN","PSBML",177,0)
 ..I PSBTRAN="UPDATE STATUS" K ^PSB(53.79,+PSBIEN,.5),^PSB(53.79,+PSBIEN,.6),^PSB(53.79,+PSBIEN,.7)
"RTN","PSBML",178,0)
 ..;move DD segments to element 11..n    No longer 10th            *83
"RTN","PSBML",179,0)
 ..K PSBCNT,PSBIENS
"RTN","PSBML",180,0)
 ..F PSBCNT=11:1 Q:'$D(PSBREC(PSBCNT))  D
"RTN","PSBML",181,0)
 ...S Y=$P(PSBREC(PSBCNT),U)
"RTN","PSBML",182,0)
 ...S PSBDD=$S(Y="DD":53.795,Y="ADD":53.796,Y="SOL":53.797,1:0)
"RTN","PSBML",183,0)
 ...Q:'PSBDD
"RTN","PSBML",184,0)
 ...S PSBIENS="+"_PSBCNT_","_PSBIEN
"RTN","PSBML",185,0)
 ...D VAL(PSBDD,PSBIENS,.01,"`"_$P(PSBREC(PSBCNT),U,2))
"RTN","PSBML",186,0)
 ...D VAL(PSBDD,PSBIENS,.02,$P(PSBREC(PSBCNT),U,3))
"RTN","PSBML",187,0)
 ...D:PSBDD=53.795 VAL(PSBDD,PSBIENS,.02,$P(PSBREC(PSBCNT),U,3))
"RTN","PSBML",188,0)
 ...D:PSBDD=53.796!(PSBDD=53.797) VAL(PSBDD,PSBIENS,.02,$P(PSBREC(PSBCNT),U,4)) ;Store units in Units ordered field, PSB*3*72
"RTN","PSBML",189,0)
 ...D:PSBREC(3)="G"!(PSBREC(3)="I") VAL(PSBDD,PSBIENS,.03,$P(PSBREC(PSBCNT),U,4)) ;only store units given when infusing or given, PSB*3*72
"RTN","PSBML",190,0)
 ...D:(PSBTAB="UDTAB")!(PSBTAB="PBTAB") VAL(PSBDD,PSBIENS,.04,$E($P(PSBREC(PSBCNT),U,5),1,40))
"RTN","PSBML",191,0)
 ...D VAL(PSBDD,PSBIENS,.05,$P(PSBREC(PSBCNT),U,7))        ;HR ind *70
"RTN","PSBML",192,0)
 ...;.06 field only valid for Unit dose DD type, not for IV's     *83
"RTN","PSBML",193,0)
 ...D:PSBDD=53.795 VAL(PSBDD,PSBIENS,.06,$P(PSBREC(PSBCNT),U,8))  ;MRR
"RTN","PSBML",194,0)
 .;Modify Filing Transaction Medpass error message too inclde details - PSB*3*52
"RTN","PSBML",195,0)
 .I $O(RESULTS("")) D  Q
"RTN","PSBML",196,0)
 ..N PSBERR
"RTN","PSBML",197,0)
 ..I $D(PSBMES) D
"RTN","PSBML",198,0)
 ...S RESULTS(1)="-2^***Your documentation is NOT being recorded in the patient record.***",RESULTS(2)=""
"RTN","PSBML",199,0)
 ...S RESULTS(3)="Please write down the information (below) AND contact your BCMA Coordinator or IT Support for assistance:",RESULTS(4)=""
"RTN","PSBML",200,0)
 ...S RESULTS(5)="Error(s) Filing Transaction MEDPASS"
"RTN","PSBML",201,0)
 ..S PSBERR=0 F  S PSBERR=$O(PSBMES(PSBERR)) Q:PSBERR=""  D
"RTN","PSBML",202,0)
 ...S RESULTS($O(RESULTS(""),-1)+1)=PSBMES(PSBERR),RESULTS(0)=$O(RESULTS(""),-1)
"RTN","PSBML",203,0)
 .;
"RTN","PSBML",204,0)
 .D FILEIT
"RTN","PSBML",205,0)
 .;
"RTN","PSBML",206,0)
 .;PSB*3*33
"RTN","PSBML",207,0)
 .D:((PSBREC(2)="O")!($$ONE^PSJBCMA(PSBREC(0),PSBREC(1))="O"))&(PSBREC(3)="G") EXPIRE^PSBML1  ;1x exp?
"RTN","PSBML",208,0)
 .;D:(PSBREC(2)="O")&(PSBREC(3)="G") EXPIRE^PSBML1  ;1x exp? ;Remove second call, which will always be made if above call is true, PSB*3*98
"RTN","PSBML",209,0)
 .I $P(RESULTS(0),U,1)=1,PSBTAB'="UDTAB",PSBUID]"",PSBUID'["WS" S PSBON=+PSBREC(1) D EN^PSJBCMA3(PSBREC(0),PSBON,PSBUID,PSBREC(3),PSBNOW)
"RTN","PSBML",210,0)
 Q
"RTN","PSBML",211,0)
BCBU ;HL7,NatContng
"RTN","PSBML",212,0)
 Q:+$G(RESULTS(0))'>0
"RTN","PSBML",213,0)
 N PSBIEN1 S PSBIEN1=$S($P(PSBIEN,",",2)'="":+$P(PSBIEN,",",2),$G(PSBIEN)="+1":PSBIEN(1),1:+$G(PSBIEN))
"RTN","PSBML",214,0)
 I $G(PSBIEN1)="" S RESULTS(0)=1,RESULTS(1)="-1^Contingency NOT processed" Q
"RTN","PSBML",215,0)
 I $G(PSBIEN)="+1" S PSBHL7="MEDPASS"
"RTN","PSBML",216,0)
 E  S:$G(PSBHL7)="" PSBHL7="UPDATE STATUS"
"RTN","PSBML",217,0)
 D:('$D(Y(0))!($G(Y(0))="SAVE")!($G(Y(0))="YES")) EN^PSBSVHL7(+PSBIEN1,PSBHL7),MEDL^ALPBCBU(+PSBIEN1) K PSBHL7
"RTN","PSBML",218,0)
 ;<<HDR-VDEF(frm *3)
"RTN","PSBML",219,0)
 Q
"RTN","PSBML",220,0)
VAL(PSBDD,PSBIEN,PSBFLD,PSBVAL) ;
"RTN","PSBML",221,0)
 K ^TMP("DIERR",$J),PSBRET
"RTN","PSBML",222,0)
 D VAL^DIE(PSBDD,PSBIEN,PSBFLD,"F",PSBVAL,.PSBRET,"PSBFDA")
"RTN","PSBML",223,0)
 I PSBRET="^" F X=0:0 S X=$O(^TMP("DIERR",$J,X)) Q:'X  D ERR(2,^TMP("DIERR",$J,X)_": "_$G(^(X,"TEXT",1),"**"))
"RTN","PSBML",224,0)
 K ^TMP("DIERR",$J),PSBRET
"RTN","PSBML",225,0)
 Q
"RTN","PSBML",226,0)
FILEIT ;Updt
"RTN","PSBML",227,0)
 K Z,X,PSB1,PSB2
"RTN","PSBML",228,0)
 N PSBMSG,PSBAUD
"RTN","PSBML",229,0)
 S (PSB1,PSB2)=""
"RTN","PSBML",230,0)
 D APATCH^PSBML3
"RTN","PSBML",231,0)
 D AMRR^PSBML3                                                    ;*83
"RTN","PSBML",232,0)
 D CLEAN^DILF
"RTN","PSBML",233,0)
 D RESETADM^PSBUTL
"RTN","PSBML",234,0)
 D UPDATE^DIE("","PSBFDA","PSBIEN","PSBMSG")
"RTN","PSBML",235,0)
 I '$G(PSBMMEN) S X=+PSBIEN I $F("HR",$P(^PSB(53.79,X,0),U,9))>1 F Y=.5,.6,.7 S Z=0 F  S Z=$O(^PSB(53.79,+X,Y,Z)) Q:+Z=0  S $P(^PSB(53.79,+X,Y,Z,0),U,3)=0
"RTN","PSBML",236,0)
 I $D(PSBMSG("DIERR")) S RESULTS(0)=1,RESULTS(1)="-1^"_PSBMSG("DIERR",1)_": "_PSBMSG("DIERR",1,"TEXT",1)  Q
"RTN","PSBML",237,0)
 I $G(PSB1)]"" X PSB1 I $G(PSB2)]"" X PSB2
"RTN","PSBML",238,0)
 I $G(PSB1A)]"" X PSB1A I $G(PSB2A)]"" X PSB2A                    ;*83
"RTN","PSBML",239,0)
 I $D(PSBHDR) D:"NHMR"[$P(^PSB(53.79,$S($P(PSBHDR,"^",1)="+1":PSBIEN(1),1:+PSBIEN),0),U,9)
"RTN","PSBML",240,0)
 .N PSBINDX S PSBINDX=$S($P(PSBHDR,"^",1)="+1":PSBIEN(1),1:+PSBIEN)
"RTN","PSBML",241,0)
 .K ^PSB(53.79,"APATCH",$P(^PSB(53.79,PSBINDX,0),U),$P(^PSB(53.79,PSBINDX,0),U,6),PSBINDX)
"RTN","PSBML",242,0)
 S RESULTS(0)=1,RESULTS(1)="1^Data Successfully Filed^"_$S($G(PSBIEN(1))'="":$G(PSBIEN(1)),1:+$G(PSBIEN))
"RTN","PSBML",243,0)
 D BCBU  ;NatContng
"RTN","PSBML",244,0)
 D  ;
"RTN","PSBML",245,0)
 . N X,DIC
"RTN","PSBML",246,0)
 . S X="PSB EVSEND VPR",DIC=101 D EN^XQOR ;should handle all BCMA Med Log events for VPR
"RTN","PSBML",247,0)
 I $G(PSBINST,0) S PSBAUD=$S($P(PSBHDR,"^",1)="+1":PSBIEN(1),1:$P(PSBHDR,"^",1)) D AUDIT^PSBMLU(PSBAUD,"Instructor "_PSBINST(0)_" present.",PSBTRAN)
"RTN","PSBML",248,0)
 K PSB1,PSB2,PSB1A,PSB2A   ;*83
"RTN","PSBML",249,0)
 Q
"RTN","PSBML",250,0)
ERR(X,Y) ;
"RTN","PSBML",251,0)
 S X=$P("Business Logic Error^Data Validation Error",U,X)
"RTN","PSBML",252,0)
 S RESULTS($O(RESULTS(""),-1)+1)=X_": "_Y
"RTN","PSBML",253,0)
 S PSBMES($O(PSBMES(""),-1)+1)=X_": "_Y
"RTN","PSBML",254,0)
 Q
"RTN","PSBML",255,0)
COMMENT(DA,PSBCMT) ;
"RTN","PSBML",256,0)
 N PSBFDA,PSBIEN,PSBNOW
"RTN","PSBML",257,0)
 S PSBIEN="+1,"_DA_","
"RTN","PSBML",258,0)
 D NOW^%DTC S PSBNOW=%
"RTN","PSBML",259,0)
 D VAL(53.793,PSBIEN,.01,PSBCMT)
"RTN","PSBML",260,0)
 S PSBFDA(53.793,PSBIEN,.02)=DUZ
"RTN","PSBML",261,0)
 S PSBFDA(53.793,PSBIEN,.03)=PSBNOW
"RTN","PSBML",262,0)
 D FILEIT
"RTN","PSBML",263,0)
 Q
"RTN","PSBODO")
0^3^B44147738^B42287720
"RTN","PSBODO",1,0)
PSBODO ;BIRMINGHAM/EFC-BCMA UNIT DOSE VIRTUAL DUE LIST FUNCTIONS ;03/06/16 3:06pm
"RTN","PSBODO",2,0)
 ;;3.0;BAR CODE MED ADMIN;**5,21,24,38,58,68,70,83,98**;Mar 2004;Build 2
"RTN","PSBODO",3,0)
 ;Per VA Directive 6402, this routine should not be modified.
"RTN","PSBODO",4,0)
 ;
"RTN","PSBODO",5,0)
 ; Reference/IA
"RTN","PSBODO",6,0)
 ; EN^PSJBCMA2/2830
"RTN","PSBODO",7,0)
 ; GETPROVL^PSGSICH1/5653
"RTN","PSBODO",8,0)
 ; INTRDIC^PSGSICH1/5654
"RTN","PSBODO",9,0)
 ; GETSIOPI^PSJBCMA5/5763
"RTN","PSBODO",10,0)
 ;
"RTN","PSBODO",11,0)
 ;*68 - add ability to print new WP Special Instructions/OPI fields
"RTN","PSBODO",12,0)
 ;*58 - add sections to display Prv Override comments and Rph
"RTN","PSBODO",13,0)
 ;      Interventions to this report for (critical drug/drug and all
"RTN","PSBODO",14,0)
 ;      adverse reactions/allergies)
"RTN","PSBODO",15,0)
 ;*70 - print clinic name at top of detail section if exists.
"RTN","PSBODO",16,0)
 ;*83 - add Removal times
"RTN","PSBODO",17,0)
 ;
"RTN","PSBODO",18,0)
EN ;
"RTN","PSBODO",19,0)
 ;
"RTN","PSBODO",20,0)
 ; Description:
"RTN","PSBODO",21,0)
 ; Returns a display for a selected order when double clicked on the VDL
"RTN","PSBODO",22,0)
 ;
"RTN","PSBODO",23,0)
 N PSBGBL,DFN
"RTN","PSBODO",24,0)
 S PSBGBL=$NAME(^TMP("PSBO",$J,"B"))
"RTN","PSBODO",25,0)
 F  S PSBGBL=$Q(@PSBGBL) Q:PSBGBL=""  Q:$QS(PSBGBL,2)'=$J  Q:$QS(PSBGBL,1)'["PSBO"  D
"RTN","PSBODO",26,0)
 .S DFN=$QS(PSBGBL,5)
"RTN","PSBODO",27,0)
 .D DISPORD
"RTN","PSBODO",28,0)
 .D CLEAN^PSBVT   ;*83 cleanup all PSB* variables
"RTN","PSBODO",29,0)
 Q
"RTN","PSBODO",30,0)
 ;
"RTN","PSBODO",31,0)
DISPORD ;
"RTN","PSBODO",32,0)
 N PSBGBL,PSBOI,PSBHDR,PSJGLO,LINE,PSBPRV,PSBPV,PSBRPH,PSBRH,PSBOVR,I,X,Y
"RTN","PSBODO",33,0)
 S PSBOI=$$GET1^DIQ(53.69,PSBRPT_",",.09)
"RTN","PSBODO",34,0)
 D EN^PSJBCMA2(DFN,PSBOI)
"RTN","PSBODO",35,0)
 S PSJGLO="^TMP(""PSJ"""_","_$J
"RTN","PSBODO",36,0)
 D CLEAN^PSBVT
"RTN","PSBODO",37,0)
 D PSJ1^PSBVT(DFN,PSBOI)
"RTN","PSBODO",38,0)
 S PSBHDR(1)="BCMA - Display Order" D PT^PSBOHDR(DFN,.PSBHDR) W !
"RTN","PSBODO",39,0)
 I '$G(PSBONX) W !,"Invalid Order"
"RTN","PSBODO",40,0)
 D:$G(PSBONX)
"RTN","PSBODO",41,0)
 .W:$G(PSBCLORD)]"" "Clinic: "_PSBCLORD,!                         ;*70
"RTN","PSBODO",42,0)
 .W !,"Orderable Item: ",PSBOITX
"RTN","PSBODO",43,0)
 .I PSBONX["V" W !,"Infusion Rate:  ",PSBIFR
"RTN","PSBODO",44,0)
 .I PSBONX'["V" W !,"Dosage Ordered: ",PSBDOSE
"RTN","PSBODO",45,0)
 .W ?40,"Start:    ",PSBOSTX W:$G(^XTMP("PSB DEBUG",0)) "   ("_PSBONX_")"
"RTN","PSBODO",46,0)
 .W !?40,"Stop:     ",PSBOSPX,?70,PSBOSTSX                        ;*70
"RTN","PSBODO",47,0)
 .W !,"Med Route:      ",PSBMR
"RTN","PSBODO",48,0)
 .W !,"Schedule Type:  ",PSBSCHTX
"RTN","PSBODO",49,0)
 .I PSBONX'["V" W ?40,"Self Med: ",PSBSMX
"RTN","PSBODO",50,0)
 .W:PSBSM !?40,"Hosp Sup: ",PSBSMX
"RTN","PSBODO",51,0)
 .W:PSBSCH'="" !,"Schedule: ",PSBSCH
"RTN","PSBODO",52,0)
 .I PSBONX'["V" W !,"Admin Times:    ",PSBADST
"RTN","PSBODO",53,0)
 .I PSBONX'["V",PSBMRRFL W !,"Removal Times:  ",$$REMSTR^PSBUTL(PSBADST,PSBDOA,PSBSCHT,PSBOSP,PSBOPRSP)
"RTN","PSBODO",54,0)
 .I PSBONX["V",((PSBIVT="P")!(PSBISYR=1)) W !,"Admin Times:    ",PSBADST
"RTN","PSBODO",55,0)
 .W !,"Provider: ",PSBMDX
"RTN","PSBODO",56,0)
 .;*68 change
"RTN","PSBODO",57,0)
 .W !,"Special Instructions/Other Print Info:"
"RTN","PSBODO",58,0)
 .K ^TMP("PSJBCMA5",$J)
"RTN","PSBODO",59,0)
 .D GETSIOPI^PSJBCMA5(DFN,PSBONX,1)
"RTN","PSBODO",60,0)
 .F QQ=0:0 S QQ=$O(^TMP("PSJBCMA5",$J,DFN,PSBONX,QQ)) Q:'QQ  D
"RTN","PSBODO",61,0)
 ..W !,^TMP("PSJBCMA5",$J,DFN,PSBONX,QQ)
"RTN","PSBODO",62,0)
 .K ^TMP("PSJBCMA5",$J)
"RTN","PSBODO",63,0)
 .;*68 end
"RTN","PSBODO",64,0)
 .;*58 override/intervention section * * *
"RTN","PSBODO",65,0)
 .S PSBOVR=0
"RTN","PSBODO",66,0)
 .D GETPROVL^PSGSICH1(DFN,PSBONX,.PSBPRV)
"RTN","PSBODO",67,0)
 .D INTRDIC^PSGSICH1(DFN,PSBONX,.PSBRPH,2)
"RTN","PSBODO",68,0)
 .S PSBPV=$S($D(PSBPRV)>1:1,1:0)
"RTN","PSBODO",69,0)
 .S PSBRH=$S($D(PSBRPH)>1:1,1:0)
"RTN","PSBODO",70,0)
 .I 'PSBPV,PSBRH D DSPPRV(.PSBPRV,132,2,26,1) S PSBOVR=1
"RTN","PSBODO",71,0)
 .I PSBPV D DSPPRV(.PSBPRV,132,2,26) S PSBOVR=1
"RTN","PSBODO",72,0)
 .I PSBPV,'PSBRH D DSPRPH(.PSBRPH,132,2,26,1) S PSBOVR=1
"RTN","PSBODO",73,0)
 .I PSBRH D DSPRPH(.PSBRPH,132,2,26) S PSBOVR=1
"RTN","PSBODO",74,0)
 .I PSBOVR W !,$TR($J("",75)," ","-")
"RTN","PSBODO",75,0)
 .;*58 end override/intervention section * * *
"RTN","PSBODO",76,0)
 .;
"RTN","PSBODO",77,0)
 .W !
"RTN","PSBODO",78,0)
 .I $D(PSBDDA(1)) D
"RTN","PSBODO",79,0)
 ..W !,"Dispense Drugs",!,"Drug Name",?40,"Units",?50,"Inactive Date"
"RTN","PSBODO",80,0)
 ..W !,$TR($J("",75)," ","-")
"RTN","PSBODO",81,0)
 ..F Y=0:0 S Y=$O(PSBDDA(Y)) Q:'Y  D
"RTN","PSBODO",82,0)
 ...S X=$P(PSBDDA(Y),U,4)
"RTN","PSBODO",83,0)
 ...W !,$P(PSBDDA(Y),U,3),?40,$S(X]"":X,1:1)
"RTN","PSBODO",84,0)
 ...S X=$P(PSBDDA(Y),U,5) Q:'X
"RTN","PSBODO",85,0)
 ...W ?50,$E(X,4,5),"/",$E(X,6,7),"/",(1700+$E(X,1,3))
"RTN","PSBODO",86,0)
 .I $D(PSBADA(1)) D
"RTN","PSBODO",87,0)
 ..W !!,"Additives",!,"Name",?40,"Strength"
"RTN","PSBODO",88,0)
 ..W !,$TR($J("",75)," ","-")
"RTN","PSBODO",89,0)
 ..F Y=0:0 S Y=$O(PSBADA(Y)) Q:'Y  D
"RTN","PSBODO",90,0)
 ...W !,$P(PSBADA(Y),U,3),?40,$P(PSBADA(Y),U,4)
"RTN","PSBODO",91,0)
 .I $D(PSBSOLA(1)) D
"RTN","PSBODO",92,0)
 ..W !!,"Solution",!,"Name",?40,"Volume"
"RTN","PSBODO",93,0)
 ..W !,$TR($J("",75)," ","-")
"RTN","PSBODO",94,0)
 ..F Y=0:0 S Y=$O(PSBSOLA(Y)) Q:'Y  D
"RTN","PSBODO",95,0)
 ...W !,$P(PSBSOLA(Y),U,3),?40,$P(PSBSOLA(Y),U,4)
"RTN","PSBODO",96,0)
 .I $P(@(PSJGLO_","_0_")"),U,1)'=-1 D
"RTN","PSBODO",97,0)
 ..W !,$TR($J("",75)," ","-")
"RTN","PSBODO",98,0)
 ..W !,"Pharmacy Activity Log: "
"RTN","PSBODO",99,0)
 ..F I=1:1:$P(@(PSJGLO_","_0_")"),U,4) D
"RTN","PSBODO",100,0)
 ...W !?9,"Date:  ",$$FMTE^XLFDT($P(@(PSJGLO_","_I_","_1_")"),U,1)),?35,"User:  ",$P(@(PSJGLO_","_I_","_1_")"),U,2)
"RTN","PSBODO",101,0)
 ...W !?5,"Activity:  ",$P(@(PSJGLO_","_I_","_1_")"),U,4)
"RTN","PSBODO",102,0)
 ...I $D(@(PSJGLO_","_I_","_2_")")) D                             ;*83
"RTN","PSBODO",103,0)
 ....I $P(@(PSJGLO_","_I_","_1_")"),U,3)["DURATION" S @(PSJGLO_","_I_","_2_")")=@(PSJGLO_","_I_","_2_")")/60     ;DOA convert min to hr *83
"RTN","PSBODO",104,0)
 ....W !?8,"Field:  ",$P(@(PSJGLO_","_I_","_1_")"),U,3),!?5,"Old Data:  ",$S($P(@(PSJGLO_","_I_","_1_")"),U,3)["DATE":$$FMTE^XLFDT(@(PSJGLO_","_I_","_2_")")),1:@(PSJGLO_","_I_","_2_")")) ;correct date, PSB*3*98
"RTN","PSBODO",105,0)
 ...I $D(@(PSJGLO_","_I_","_3_")")) W !?7,"Reason:  ",@(PSJGLO_","_I_","_3_")")
"RTN","PSBODO",106,0)
 ...W !
"RTN","PSBODO",107,0)
 W !!
"RTN","PSBODO",108,0)
 D CLEAN^PSBVT K @(PSJGLO_")")
"RTN","PSBODO",109,0)
 Q
"RTN","PSBODO",110,0)
 ;
"RTN","PSBODO",111,0)
DSPPRV(ARR,LN,IND,ALGN,NONE) ; Display Provider (CPRS) override reasons
"RTN","PSBODO",112,0)
 ; ARR  = array with provider override text.
"RTN","PSBODO",113,0)
 ; LN   = total width of report writable area.      (opt, 132 default)
"RTN","PSBODO",114,0)
 ; IND  = indent for both left and right margins.      (opt,0 default)
"RTN","PSBODO",115,0)
 ; ALGN = align colon on this column.                (opt, 25 default)
"RTN","PSBODO",116,0)
 ; NONE = display empty Provider override msg.        (opt, 0 default)
"RTN","PSBODO",117,0)
 ;
"RTN","PSBODO",118,0)
 N CAT,QQ,OC,HDG,CTRTAB,TMPONX,LINE,L1,L2,XX
"RTN","PSBODO",119,0)
 S LN=+$G(LN,132),IND=+$G(IND),ALGN=$G(ALGN,25),NONE=$G(NONE,0)
"RTN","PSBODO",120,0)
 S LN=LN-(IND*2)    ;adj writeable area by both L & R margins
"RTN","PSBODO",121,0)
 ;provider heading
"RTN","PSBODO",122,0)
 W !!?IND,$TR($J("",LN)," ","=")
"RTN","PSBODO",123,0)
 S HDG="** Current Provider Overrides for this order **"
"RTN","PSBODO",124,0)
 S CTRTAB=(LN-$L(HDG))/2
"RTN","PSBODO",125,0)
 W !?CTRTAB,HDG
"RTN","PSBODO",126,0)
 W !?IND,$TR($J("",LN)," ","="),!
"RTN","PSBODO",127,0)
 ;
"RTN","PSBODO",128,0)
 ;special scenario when NO Prv overrides, but Rph Interventions do
"RTN","PSBODO",129,0)
 I NONE W !?IND,"No Provider Overrides to display.",! Q
"RTN","PSBODO",130,0)
 ;
"RTN","PSBODO",131,0)
 ;provider body text
"RTN","PSBODO",132,0)
 S TMPONX=$O(ARR("PROV",DFN,"")) I TMPONX D
"RTN","PSBODO",133,0)
 .S QQ="" F  S QQ=$O(ARR("PROV",DFN,+TMPONX,QQ)) Q:QQ=""  D
"RTN","PSBODO",134,0)
 ..S LINE=ARR("PROV",DFN,+TMPONX,QQ),XX=$F(LINE,":")
"RTN","PSBODO",135,0)
 ..S L1=$J($E(LINE,1,XX),ALGN),L2=$E(LINE,XX+1,$L(LINE))
"RTN","PSBODO",136,0)
 ..W !?IND,L1,L2
"RTN","PSBODO",137,0)
 .W !
"RTN","PSBODO",138,0)
 S CAT=0 F  S CAT=$O(ARR("PROVR",DFN,+TMPONX,CAT)) Q:'CAT  D
"RTN","PSBODO",139,0)
 .S OC=0 F  S OC=$O(ARR("PROVR",DFN,+TMPONX,CAT,OC)) Q:'OC  D
"RTN","PSBODO",140,0)
 ..S LINE=ARR("PROVR",DFN,+TMPONX,CAT,OC,0),XX=$F(LINE,":")
"RTN","PSBODO",141,0)
 ..S L1=$J($E(LINE,1,XX),ALGN),L2=$E(LINE,XX+1,$L(LINE))
"RTN","PSBODO",142,0)
 ..W !,?IND,$$WRAP^PSBO(IND,LN,LINE),!
"RTN","PSBODO",143,0)
 Q
"RTN","PSBODO",144,0)
 ;
"RTN","PSBODO",145,0)
DSPRPH(ARR,LN,IND,ALGN,NONE) ; Display Pharmacist Interventions
"RTN","PSBODO",146,0)
 ; ARR  = array with Pharmacist intervention text.               (opt)
"RTN","PSBODO",147,0)
 ; LN   = total width of report writable area.       (opt,132 default)
"RTN","PSBODO",148,0)
 ; IND  = indent for both left and right margins.     (opt, 0 default)
"RTN","PSBODO",149,0)
 ; ALGN = align colon on this column.                (opt. 25 default)
"RTN","PSBODO",150,0)
 ; NONE = display empty Pharmacist intervention msg.  (opt, 0 default)
"RTN","PSBODO",151,0)
 ;
"RTN","PSBODO",152,0)
 N FLD,WP,WPTAG,WPLIN,HDG,INT,CTRTAB,LINE,L1,L2,XX
"RTN","PSBODO",153,0)
 S LN=+$G(LN,132),IND=+$G(IND),ALGN=$G(ALGN,25),NONE=$G(NONE,0)
"RTN","PSBODO",154,0)
 S LN=LN-(IND*2)         ;adj writeable area by both L & R margins
"RTN","PSBODO",155,0)
 ;
"RTN","PSBODO",156,0)
 ;pharmacist heading
"RTN","PSBODO",157,0)
 W !?IND,$TR($J("",LN)," ","=")
"RTN","PSBODO",158,0)
 S HDG="** Current Pharmacist Interventions for this order **"
"RTN","PSBODO",159,0)
 S CTRTAB=(LN-$L(HDG))/2
"RTN","PSBODO",160,0)
 W !?CTRTAB,HDG
"RTN","PSBODO",161,0)
 W !?IND,$TR($J("",LN)," ","="),!
"RTN","PSBODO",162,0)
 ;
"RTN","PSBODO",163,0)
 ;special scenario when NO Rph interventions, but Prv overrides do
"RTN","PSBODO",164,0)
 I NONE W !?IND,"No Pharmacist Interventions to display.",! Q
"RTN","PSBODO",165,0)
 ;
"RTN","PSBODO",166,0)
 ;pharmacist body text
"RTN","PSBODO",167,0)
 F INT=0:0 S INT=$O(ARR(DFN,PSBONX,INT)) Q:'INT  D
"RTN","PSBODO",168,0)
 .F FLD=0:0 S FLD=$O(ARR(DFN,PSBONX,INT,FLD)) Q:'FLD  D
"RTN","PSBODO",169,0)
 ..I FLD<1000 D
"RTN","PSBODO",170,0)
 ...S LINE=ARR(DFN,PSBONX,INT,FLD),XX=$F(LINE,":")
"RTN","PSBODO",171,0)
 ...S L1=$J($E(LINE,1,XX),ALGN),L2=$E(LINE,XX+1,$L(LINE))
"RTN","PSBODO",172,0)
 ...W !?IND,L1,L2
"RTN","PSBODO",173,0)
 ..I FLD>1000 D
"RTN","PSBODO",174,0)
 ...S (WP,WPLIN,WPTAG)="",LIN1=1
"RTN","PSBODO",175,0)
 ...F  S WP=$O(ARR(DFN,PSBONX,INT,FLD,WP)) Q:WP=""  D
"RTN","PSBODO",176,0)
 ....S LINE=ARR(DFN,PSBONX,INT,FLD,WP)
"RTN","PSBODO",177,0)
 ....I WP<1 D                          ;field Hdg line
"RTN","PSBODO",178,0)
 .....S LINE=$J(LINE,ALGN) W !?IND,LINE
"RTN","PSBODO",179,0)
 ....E  D                              ;detail WP lines
"RTN","PSBODO",180,0)
 .....I 'LIN1 W !
"RTN","PSBODO",181,0)
 .....W ?IND+ALGN,LINE
"RTN","PSBODO",182,0)
 .....S LIN1=0
"RTN","PSBODO",183,0)
 .W !
"RTN","PSBODO",184,0)
 W !
"RTN","PSBODO",185,0)
 Q
"RTN","PSBOMT")
0^4^B106758634^B105395791
"RTN","PSBOMT",1,0)
PSBOMT ;BIRMINGHAM/TEJ-BCMA MEDICATION THERAPY REPORT ;03/06/16 3:06pm
"RTN","PSBOMT",2,0)
 ;;3.0;BAR CODE MED ADMIN;**32,50,70,72,83,97,98**;Mar 2004;Build 2
"RTN","PSBOMT",3,0)
 ;Per VA Directive 6402, this routine should not be modified.
"RTN","PSBOMT",4,0)
 ;
"RTN","PSBOMT",5,0)
 ; Reference/IA
"RTN","PSBOMT",6,0)
 ; File 50.7/2880
"RTN","PSBOMT",7,0)
 ; File 52.6/436
"RTN","PSBOMT",8,0)
 ; File 52.7/437
"RTN","PSBOMT",9,0)
 ; File 200/10060
"RTN","PSBOMT",10,0)
 ; EN^PSJBCMA1/2829
"RTN","PSBOMT",11,0)
 ; IEN^PSN50P65/4543
"RTN","PSBOMT",12,0)
 ; DRGIEN^PSS50P7/4662
"RTN","PSBOMT",13,0)
 ; VAC^PSS50/4533
"RTN","PSBOMT",14,0)
 ; ^PSDRUG(/221 
"RTN","PSBOMT",15,0)
 ;
"RTN","PSBOMT",16,0)
 ;*70 - reset PSBCLINORD = 2 to signify combined orders report
"RTN","PSBOMT",17,0)
 ;*83 - Add MRR meds remove times to report.
"RTN","PSBOMT",18,0)
 ;
"RTN","PSBOMT",19,0)
EN ;
"RTN","PSBOMT",20,0)
 N PSBHDR,PSBORDS,PSBORD,PSBOIP
"RTN","PSBOMT",21,0)
 N TMP
"RTN","PSBOMT",22,0)
 K TMP("PSBOIS",$J),TMP("VA CLASS",$J),TMP("PSBADDS",$J),TMP("PSBSOLS",$J),PSBLGD,PSBOIL,PSBDDL,PSBSOLL,PSBADDL
"RTN","PSBOMT",23,0)
 S PSBCLSS=0,PSBCFLG=0
"RTN","PSBOMT",24,0)
 S PSBXDFN=$P(PSBRPT(.1),U,2)
"RTN","PSBOMT",25,0)
 S PSBSTRT=$P(PSBRPT(.1),U,6)+$P(PSBRPT(.1),U,7),PSBSTOP=$P(PSBRPT(.1),U,8)+$P(PSBRPT(.1),U,9)
"RTN","PSBOMT",26,0)
 K PSBOCRIT F Y=1:1:4 I $P(PSBRPT(.2),U,Y) S PSBOCRIT=$G(PSBOCRIT,"")_$P("C^P^OC^O",U,Y)_"^"
"RTN","PSBOMT",27,0)
 D NOW^%DTC S (Y,PSBNOWX)=% D DD^%DT S PSBDTTM=$E(Y,1,18)
"RTN","PSBOMT",28,0)
 S:+PSBSTRT'>0 PSBSTRT=$$FMADD^XLFDT(X,-1)
"RTN","PSBOMT",29,0)
 S:+PSBSTOP'>0 PSBSTOP=$P(%,".")
"RTN","PSBOMT",30,0)
 I $D(PSBRPT(.2)) I $P(PSBRPT(.2),U,8) S PSBCFLG=1
"RTN","PSBOMT",31,0)
 I $D(PSBRPT(2)) F XD=$O(PSBRPT(2,0)):1:$O(PSBRPT(2,"B"),-1) S PSBRPT(2,XD,0)=$TR(PSBRPT(2,XD,0),"~",U) D:$P(PSBRPT(2,XD,0),U)="MT"
"RTN","PSBOMT",32,0)
 .I $P(PSBRPT(2,XD,0),U,2)="OIT" D  Q
"RTN","PSBOMT",33,0)
 ..S PSBSRCHL="ORDERABLE ITEM SEARCH LIST:",PSBOIL(+$P(PSBRPT(2,XD,0),U,3))=""
"RTN","PSBOMT",34,0)
 ..S PSB=$P(PSBRPT(2,XD,0),U,3) F X=1:1:$L(PSB,",") Q:$P(PSB,",",X)=""  S (TMP("PSBOIS",$J,$P(PSB,",",X)),PSBOIP("OIP",$P(PSB,",",X)))=""
"RTN","PSBOMT",35,0)
 .I $P(PSBRPT(2,XD,0),U,2)="ADD" D  Q
"RTN","PSBOMT",36,0)
 ..S PSBSRCHL="IV MEDICATION SEARCH LIST:"
"RTN","PSBOMT",37,0)
 ..I $D(^PSDRUG("A526",$P(PSBRPT(2,XD,0),U,3))) S X2=$O(^PSDRUG("A526",$P(PSBRPT(2,XD,0),U,3),"")) S PSBADDL(X2)="",TMP("PSBOIS",$J,$$OFROMA(X2))=""
"RTN","PSBOMT",38,0)
 .I $P(PSBRPT(2,XD,0),U,2)="SOL" D  Q
"RTN","PSBOMT",39,0)
 ..S PSBSRCHL="IV MEDICATION SEARCH LIST:"
"RTN","PSBOMT",40,0)
 ..I $D(^PSDRUG("A527",$P(PSBRPT(2,XD,0),U,3))) S X2=$O(^PSDRUG("A527",$P(PSBRPT(2,XD,0),U,3),"")) S PSBSOLL(X2)="",TMP("PSBOIS",$J,$$OFROMS(X2))=""
"RTN","PSBOMT",41,0)
 .I $P(PSBRPT(2,XD,0),U,2)="DD" D  K PSBDRGS Q
"RTN","PSBOMT",42,0)
 ..S PSBSRCHL="DISPENSED DRUG SEARCH LIST:",PSBDDL($P(PSBRPT(2,XD,0),U,3))=""
"RTN","PSBOMT",43,0)
 ..K PSBDRGS S PSBDRGS="" D OILST^PSBRPCMO(.PSBDRGS,$P(PSBRPT(2,XD,0),U,3),"UD")
"RTN","PSBOMT",44,0)
 ..F X2=PSBDRGS(0):1:$O(PSBDRGS(""),-1) I +PSBDRGS(1)'<0 S TMP("PSBOIS",$J,$P(PSBDRGS(X2),U,4))=""
"RTN","PSBOMT",45,0)
 .I $P(PSBRPT(2,XD,0),U,2)="VAC" D
"RTN","PSBOMT",46,0)
 ..S PSBSRCHL="VA DRUG CLASS SEARCH LIST:"
"RTN","PSBOMT",47,0)
 ..S PSBCLS=$P(PSBRPT(2,XD,0),U,3) D GETCLSS(PSBCLS) K PSBDDRG("VAC") M TMP("VA CLASS",$J,PSBCLS,"DDRG")=PSBDDRG K PSBDDRG
"RTN","PSBOMT",48,0)
 ..S PSBCLSS=1
"RTN","PSBOMT",49,0)
 M PSBOIP("OIP")=TMP("PSBOIS",$J)
"RTN","PSBOMT",50,0)
 D OUT(PSBXDFN,PSBSTRT,PSBSTOP)
"RTN","PSBOMT",51,0)
 Q
"RTN","PSBOMT",52,0)
OUT(PSBXDFN,PSBSTRT,PSBSTOP) ;
"RTN","PSBOMT",53,0)
 D:PSBCLSS GETOIS  ; POSSBLE CLASS ITEMS VIA AVAIL ORDERS
"RTN","PSBOMT",54,0)
 D GETADSO^PSBOMT1 ; ALL ADDS AND SOLS
"RTN","PSBOMT",55,0)
 D FINDIENS^PSBOMT1 ; FIND ALL MED LOG ENTRS
"RTN","PSBOMT",56,0)
 D PREOUT ;   WRIT TO GLOBL
"RTN","PSBOMT",57,0)
 D WRITEOT
"RTN","PSBOMT",58,0)
 D CLEANSUM^PSBOMT1
"RTN","PSBOMT",59,0)
 D CLEANALL^PSBOMT1
"RTN","PSBOMT",60,0)
 Q
"RTN","PSBOMT",61,0)
GETOIS ;
"RTN","PSBOMT",62,0)
 K ^TMP("PSJ",$J),PSBTMP
"RTN","PSBOMT",63,0)
 D EN^PSJBCMA(PSBXDFN,PSBSTRT)
"RTN","PSBOMT",64,0)
 Q:^TMP("PSJ",$J,1,0)<0
"RTN","PSBOMT",65,0)
 M PSBTMP=^TMP("PSJ",$J) K ^TMP("PSJ",$J)
"RTN","PSBOMT",66,0)
 S X=0 F  S X=$O(PSBTMP(X)) Q:+X=0  D
"RTN","PSBOMT",67,0)
 .Q:$G(PSBOCRIT,"")'[$P(PSBTMP(X,1),U,2)_"^"
"RTN","PSBOMT",68,0)
 .S PSBORDN=$P(PSBTMP(X,0),U,3) S PSBORDS(PSBORDN)=""
"RTN","PSBOMT",69,0)
 .I $D(PSBTMP(X,700)) D  Q
"RTN","PSBOMT",70,0)
 ..F XX=1:1:PSBTMP(X,700,0) D
"RTN","PSBOMT",71,0)
 ...S PSBCLS="" F  S PSBCLS=$O(TMP("VA CLASS",$J,PSBCLS)) Q:+PSBCLS=0  D
"RTN","PSBOMT",72,0)
 ....I '$D(TMP("VA CLASS",$J,PSBCLS,"DDRG",$P(PSBTMP(X,700,XX,0),U))) Q
"RTN","PSBOMT",73,0)
 ....S PSBORDS(PSBORDN,"DD",$P(PSBTMP(X,700,XX,0),U))=""
"RTN","PSBOMT",74,0)
 ....S PSBORDS(PSBORDN,"OIP",$P(PSBTMP(X,3),U))=""
"RTN","PSBOMT",75,0)
 ..M PSBOIP("OIP")=PSBORDS(PSBORDN,"OIP")
"RTN","PSBOMT",76,0)
 .I $D(PSBTMP(X,850)) M PSBORDS(PSBORDN,"ADD")=PSBTMP(X,850) D
"RTN","PSBOMT",77,0)
 ..F XX=1:1:PSBORDS(PSBORDN,"ADD",0) S PSBORDS(PSBORDN,"OIP",$$OFROMA($P(PSBORDS(PSBORDN,"ADD",XX,0),U)))=""
"RTN","PSBOMT",78,0)
 ..M PSBOIP("OIP")=PSBORDS(PSBORDN,"OIP")
"RTN","PSBOMT",79,0)
 .I $D(PSBTMP(X,950)) M PSBORDS(PSBORDN,"SOL")=PSBTMP(X,950) D
"RTN","PSBOMT",80,0)
 ..F XX=1:1:PSBORDS(PSBORDN,"SOL",0) S PSBORDS(PSBORDN,"OIP",$$OFROMS($P(PSBORDS(PSBORDN,"SOL",XX,0),U)))=""
"RTN","PSBOMT",81,0)
 ..M PSBOIP("OIP")=PSBORDS(PSBORDN,"OIP")
"RTN","PSBOMT",82,0)
 K PSBTMP
"RTN","PSBOMT",83,0)
 M TMP("PSBOIS",$J)=PSBOIP("OIP")
"RTN","PSBOMT",84,0)
 Q
"RTN","PSBOMT",85,0)
OFROMA(PSBADD) ;OITEM FROM AN ADDITIVE
"RTN","PSBOMT",86,0)
 S X1=$$GET1^DIQ(52.6,PSBADD_",",15,"I")
"RTN","PSBOMT",87,0)
 I PSBCLSS D
"RTN","PSBOMT",88,0)
 .S X2=$$GETDRN(X1)
"RTN","PSBOMT",89,0)
 .S PSBCLS="" K X3 F  Q:$D(X3)  S PSBCLS=$O(TMP("VA CLASS",$J,PSBCLS)) Q:+PSBCLS=0  D
"RTN","PSBOMT",90,0)
 ..I $D(TMP("VA CLASS",$J,PSBCLS,"DDRG",X2)) S X3=X1
"RTN","PSBOMT",91,0)
 .I '$D(X3) S X3=0
"RTN","PSBOMT",92,0)
 Q $G(X3,X1)
"RTN","PSBOMT",93,0)
OFROMS(PSBSOL) ;OITEM FROM A SOLUTION
"RTN","PSBOMT",94,0)
 S X1=$$GET1^DIQ(52.7,PSBSOL_",",9,"I")
"RTN","PSBOMT",95,0)
 I PSBCLSS D
"RTN","PSBOMT",96,0)
 .S X2=$$GETDRN(X1)
"RTN","PSBOMT",97,0)
 .S PSBCLS="" K X3 F  Q:$D(X3)  S PSBCLS=$O(TMP("VA CLASS",$J,PSBCLS)) Q:+PSBCLS=0  D
"RTN","PSBOMT",98,0)
 ..I $D(TMP("VA CLASS",$J,PSBCLS,"DDRG",X2)) S X3=X1
"RTN","PSBOMT",99,0)
 .I '$D(X3) S X3=0
"RTN","PSBOMT",100,0)
 Q $G(X3,X1)
"RTN","PSBOMT",101,0)
PREOUT ;
"RTN","PSBOMT",102,0)
 K PSBUNK S XDT="" F  S XDT=$O(TMP("PSBIENS",$J,XDT),-1) Q:XDT=""  S XIEN="",XIEN=$O(TMP("PSBIENS",$J,XDT,XIEN)) D
"RTN","PSBOMT",103,0)
 .Q:$$NONSTS(PSBXDFN,XIEN)
"RTN","PSBOMT",104,0)
 .S PSBIEN=XIEN
"RTN","PSBOMT",105,0)
 .S PSBIENS=PSBIEN_","
"RTN","PSBOMT",106,0)
 .D OUTPUT
"RTN","PSBOMT",107,0)
 Q
"RTN","PSBOMT",108,0)
OUTPUT ;
"RTN","PSBOMT",109,0)
 S PSBSPC=$J("",80)
"RTN","PSBOMT",110,0)
 S W=$E($$GET1^DIQ(53.79,PSBIENS,.02)_PSBSPC,1,20)_" "
"RTN","PSBOMT",111,0)
 S W=W_$S($P(^PSB(53.79,PSBIEN,0),U,9)="":"?? ",1:$E($P(^PSB(53.79,PSBIEN,0),U,9)_"  ",1,2)_" ")
"RTN","PSBOMT",112,0)
 S:$P(^PSB(53.79,PSBIEN,0),U,9)="" PSBUNK=1
"RTN","PSBOMT",113,0)
 S W=W_$E($P($G(^PSB(53.79,PSBIEN,.1)),U,2)_PSBSPC,1,2)_"  "
"RTN","PSBOMT",114,0)
 S W=W_$E($E($$GET1^DIQ(53.79,PSBIENS,.06),1,18)_PSBSPC,1,21)_" "
"RTN","PSBOMT",115,0)
 S W=W_$E($$GETINIT^PSBCSUTX(PSBIEN,"I")_PSBSPC,1,10)_" ",PSBLGD("INITIALS",$$GETINIT^PSBCSUTX(PSBIEN,"II"))="" ;Get IEN and initials of who took action, PSB*3*72
"RTN","PSBOMT",116,0)
 ;Inj or Derm site info *83
"RTN","PSBOMT",117,0)
 S W=W_$S($P($G(^PSB(53.79,PSBIEN,.1)),U,8)]"":$P(^(.1),U,8),1:$P(^(.1),U,6))
"RTN","PSBOMT",118,0)
 ;
"RTN","PSBOMT",119,0)
 D ADD(W)
"RTN","PSBOMT",120,0)
 S W=$J("",56)
"RTN","PSBOMT",121,0)
 ;
"RTN","PSBOMT",122,0)
 ;find Give associated with remove event *83
"RTN","PSBOMT",123,0)
 D:$P(^PSB(53.79,PSBIEN,0),U,9)="RM"
"RTN","PSBOMT",124,0)
 .N RMEV,INI
"RTN","PSBOMT",125,0)
 .S RMEV=$$FINDGIVE^PSBUTL(PSBIEN)
"RTN","PSBOMT",126,0)
 .S Y=$P(RMEV,U)+.0000001     ;give dt/tm
"RTN","PSBOMT",127,0)
 .S INI=$P(RMEV,U,2)          ;give by user ini
"RTN","PSBOMT",128,0)
 .S X=$P(RMEV,U,3)            ;give sts code
"RTN","PSBOMT",129,0)
 .S W=$E(PSBSPC,1,21)_$E(X_" ",1,2)_" "
"RTN","PSBOMT",130,0)
 .S W=W_$E($P($G(^PSB(53.79,PSBIEN,.1)),U,2)_PSBSPC,1,2)_"  "
"RTN","PSBOMT",131,0)
 .S W=W_$$UP^XLFSTR($E($$FMTE^XLFDT(Y),1,18))_"    "_$E(INI_PSBSPC,1,6)
"RTN","PSBOMT",132,0)
 .S PSBLGD("INITIALS",$P(RMEV,U,5))=""  ;give by user in  (Legend use)
"RTN","PSBOMT",133,0)
 ;
"RTN","PSBOMT",134,0)
 K PSBV
"RTN","PSBOMT",135,0)
 F PSBNODE=.5,.6,.7 D
"RTN","PSBOMT",136,0)
 .S PSBDD=$S(PSBNODE=.5:53.795,PSBNODE=.6:53.796,1:53.797)
"RTN","PSBOMT",137,0)
 .F PSBY=0:0 S PSBY=$O(^PSB(53.79,PSBIEN,PSBNODE,PSBY)) Q:'PSBY  D
"RTN","PSBOMT",138,0)
 ..I $$GET1^DIQ(53.79,PSBIENS,.11)["V" S PSBV=1
"RTN","PSBOMT",139,0)
 ..;add W possible remove string to wrapmeds  *83
"RTN","PSBOMT",140,0)
 ..D WRAPMEDS(W,$$GET1^DIQ(PSBDD,PSBY_","_PSBIENS,.01),$$GET1^DIQ(PSBDD,PSBY_","_PSBIENS,.03),$$GET1^DIQ(PSBDD,PSBY_","_PSBIENS,.02),$$GET1^DIQ(PSBDD,PSBY_","_PSBIENS,.04))
"RTN","PSBOMT",141,0)
 D PRNEFF
"RTN","PSBOMT",142,0)
 I PSBCFLG=1 D COMNTS
"RTN","PSBOMT",143,0)
 D ADD("")
"RTN","PSBOMT",144,0)
 Q
"RTN","PSBOMT",145,0)
PRNEFF ;Add PRN Effectiveness to Medication theropy Report  - PSB*3*50
"RTN","PSBOMT",146,0)
 N PSBPRN,PSBEIECMT,PSBLINE1,PSBLINE2
"RTN","PSBOMT",147,0)
 S PSBEIECMT=""
"RTN","PSBOMT",148,0)
 I $P($G(PSBRPT(.2)),U,8)=0,$D(^PSB(53.79,PSBIEN,.2)) S PSBEIECMT=$$PRNEFF^PSBO(PSBEIECMT,PSBIEN)
"RTN","PSBOMT",149,0)
 I $D(^PSB(53.79,PSBIEN,.2)) D
"RTN","PSBOMT",150,0)
 .D ADD("")
"RTN","PSBOMT",151,0)
 .D ADD($J("",35)_"PRN Effectiveness: "_$$MAKELINE^PSBOMT1("-",78))
"RTN","PSBOMT",152,0)
 .I $P(^PSB(53.79,PSBIEN,.2),U,2)'="" D
"RTN","PSBOMT",153,0)
 ..S PSBPRN=$P(^PSB(53.79,PSBIEN,.2),U,2)
"RTN","PSBOMT",154,0)
 .I $P(^PSB(53.79,PSBIEN,.2),U,2)="" S PSBPRN="<No PRN Effectiveness Entered>"
"RTN","PSBOMT",155,0)
 .S PSBLINE1=$E(PSBPRN_PSBEIECMT,1,75),PSBLINE2=$E(PSBPRN_PSBEIECMT,76,245) D WRAP(PSBLINE2,PSBLINE1,PSBIEN)
"RTN","PSBOMT",156,0)
 Q 
"RTN","PSBOMT",157,0)
COMNTS ;
"RTN","PSBOMT",158,0)
 N Z,CNT
"RTN","PSBOMT",159,0)
 S Z="",CNT=0
"RTN","PSBOMT",160,0)
 I $D(^PSB(53.79,PSBIEN,.3,0)) D
"RTN","PSBOMT",161,0)
 .D ADD("")
"RTN","PSBOMT",162,0)
 .D ADD($J("",45)_"Comments: "_$$MAKELINE^PSBOMT1("-",78))
"RTN","PSBOMT",163,0)
 .S XT="" F  S XT=$O(^PSB(53.79,PSBIEN,.3,XT)) Q:XT=""  I XT'=0  D
"RTN","PSBOMT",164,0)
 ..D:CNT=1 ADD("")
"RTN","PSBOMT",165,0)
 ..S Y=$P(^PSB(53.79,PSBIEN,.3,XT,0),"^",3) D DD^%DT S XBR=Y
"RTN","PSBOMT",166,0)
 ..S Z=XBR_"   "_$P(^VA(200,$P(^PSB(53.79,PSBIEN,.3,XT,0),"^",2),0),"^",2)
"RTN","PSBOMT",167,0)
 ..D WRAP($P(^PSB(53.79,PSBIEN,.3,XT,0),"^",1),Z,PSBIEN)
"RTN","PSBOMT",168,0)
 ..S CNT=1
"RTN","PSBOMT",169,0)
 ..S PSBLGD("INITIALS",$$GET1^DIQ(53.793,XT_","_PSBIEN_",",.02,"I"))="" ;Get name for legend for those who entered comments
"RTN","PSBOMT",170,0)
 .D ADD($J("",55)_$$MAKELINE^PSBOMT1("-",78))
"RTN","PSBOMT",171,0)
 Q
"RTN","PSBOMT",172,0)
WRAPMEDS(W,MED,UG,UO,UOA) ;insert parm W (possible RM string) to print on line 1 *83
"RTN","PSBOMT",173,0)
 ;THIS WILL CREATE UPTO 3 LINES
"RTN","PSBOMT",174,0)
 S MED=$E(MED_$J("",40),1,40)
"RTN","PSBOMT",175,0)
 N UGWRAP,ORWRAP
"RTN","PSBOMT",176,0)
 S (CNTX,UOA1,UOA16,UOA31)=""
"RTN","PSBOMT",177,0)
 I +$G(UG)?1"."1.N S UG=0_+UG
"RTN","PSBOMT",178,0)
 I +$G(UO)?1"."1.N S UO=0_+UO
"RTN","PSBOMT",179,0)
 I $G(PSBV,0) S UO="NA"
"RTN","PSBOMT",180,0)
 F CNT=1:15:45  D
"RTN","PSBOMT",181,0)
 .D PARSE^PSBOMT1(UOA,CNT)
"RTN","PSBOMT",182,0)
 .S UGWRAP=$E(UG,CNT,(CNT+7)),UOWRAP=$E(UO,CNT,(CNT+7))
"RTN","PSBOMT",183,0)
 .I CNT=1 D ADD(W_MED_" "_$$PAD^PSBOMT1(UOWRAP,8)_" "_$$PAD^PSBOMT1(UGWRAP,8)_"  "_$$PAD^PSBOMT1(UOA1,15))  ;*83
"RTN","PSBOMT",184,0)
 .I (CNT>1),($L(UGWRAP)>0!$L(@("UOA"_CNT))>0) D ADD($J("",94)_$$PAD^PSBOMT1(UOWRAP,8)_" "_$$PAD^PSBOMT1(UGWRAP,8)_"  "_$$PAD^PSBOMT1(@("UOA"_CNT),15))
"RTN","PSBOMT",185,0)
 Q
"RTN","PSBOMT",186,0)
HEADA ;
"RTN","PSBOMT",187,0)
 W !
"RTN","PSBOMT",188,0)
 W "Location",?21,"St Sch Administration Date",?50,"By",?61,"Body Site",?96,"Units",?104,"Units",?113,"Units of"  ;*83
"RTN","PSBOMT",189,0)
 W !,?56,"Medication & Dosage",?96,"Ordered",?104,"Given",?113,"Administration"
"RTN","PSBOMT",190,0)
 W !
"RTN","PSBOMT",191,0)
 W $$MAKELINE^PSBOMT1("-",132)
"RTN","PSBOMT",192,0)
 Q
"RTN","PSBOMT",193,0)
NONSTS(PSBX,PSBY) ;
"RTN","PSBOMT",194,0)
 D CLEAN^PSBVT,PSJ1^PSBVT(PSBX,$$GET1^DIQ(53.79,PSBY_",","ORDER REFERENCE NUMBER","I"))
"RTN","PSBOMT",195,0)
 Q $G(PSBOCRIT)'[PSBSCHT_"^" ;Protect variable if no schedule types are passed, PSB*3*98
"RTN","PSBOMT",196,0)
WRITEOT ;
"RTN","PSBOMT",197,0)
 D HDR^PSBOMT1
"RTN","PSBOMT",198,0)
 D MEDS
"RTN","PSBOMT",199,0)
 N PSBCLINORD S PSBCLINORD=2             ;2 = both order types   *70
"RTN","PSBOMT",200,0)
 D PT^PSBOHDR(PSBXDFN,.PSBHDR),HEADA
"RTN","PSBOMT",201,0)
 I '$D(TMP("PSBIENS",$J)) D ADD("<<<< NO HISTORY FOUND FOR THIS TIME FRAME >>>>")
"RTN","PSBOMT",202,0)
 S EX="" F  S EX=$O(^TMP("PSB",$J,EX)) Q:EX=""  D
"RTN","PSBOMT",203,0)
 .I $Y>(IOSL-5) D
"RTN","PSBOMT",204,0)
 ..W $$PTFTR^PSBOHDR()
"RTN","PSBOMT",205,0)
 ..D PT^PSBOHDR(PSBXDFN,.PSBHDR),HEADA
"RTN","PSBOMT",206,0)
 .W !,$G(^TMP("PSB",$J,EX))
"RTN","PSBOMT",207,0)
 D:$D(TMP("PSBIENS",$J)) LEGEND^PSBOMT1
"RTN","PSBOMT",208,0)
 D FTR^PSBOMT1
"RTN","PSBOMT",209,0)
 Q
"RTN","PSBOMT",210,0)
MEDS ;
"RTN","PSBOMT",211,0)
 N MED,XA,XB
"RTN","PSBOMT",212,0)
 S MED="",XB=$O(PSBHDR(""),-1)+1
"RTN","PSBOMT",213,0)
 S PSBHDR(XB)=PSBSRCHL
"RTN","PSBOMT",214,0)
 I PSBCLSS S XA=0 K PSBGOT F  S XA=$O(TMP("VA CLASS",$J,XA)) Q:+XA=0  D
"RTN","PSBOMT",215,0)
 .K ^TMP($J,"PSBLIST") D IEN^PSN50P65(XA,"??","PSBLIST")
"RTN","PSBOMT",216,0)
 .I ^TMP($J,"PSBLIST",0)>0 S MED=^TMP($J,"PSBLIST",XA,1) Q:$D(PSBGOT(MED))  K ^TMP($J,"PSBLIST")
"RTN","PSBOMT",217,0)
 .I $L(PSBHDR(XB)_" "_$G(MED," * NO DATA FOUND * "))+3>IOM D  Q
"RTN","PSBOMT",218,0)
 ..S XB=XB+1,PSBHDR(XB)="                         / "_MED S PSBGOT(MED)=""
"RTN","PSBOMT",219,0)
 .S PSBHDR(XB)=PSBHDR(XB)_$S(($L(PSBHDR(XB),":")=2)&($P(PSBHDR(XB),":",2)=""):" ",1:" / ")_MED,PSBGOT(MED)=""
"RTN","PSBOMT",220,0)
 I $D(PSBOIL) S XA="" K PSBGOT F  S XA=$O(PSBOIL(XA)) Q:XA=""  D
"RTN","PSBOMT",221,0)
 .S MED=$$GET1^DIQ(50.7,XA,.01) Q:$D(PSBGOT(MED))  S PSBGOT(MED)=""
"RTN","PSBOMT",222,0)
 .I $L(PSBHDR(XB)_" / "_MED)+3>IOM D  Q
"RTN","PSBOMT",223,0)
 ..S XB=XB+1,PSBHDR(XB)="                         / "_MED
"RTN","PSBOMT",224,0)
 .S PSBHDR(XB)=PSBHDR(XB)_$S(($L(PSBHDR(XB),":")=2)&($P(PSBHDR(XB),":",2)=""):" ",1:" / ")_MED
"RTN","PSBOMT",225,0)
 I $D(PSBADDL) S XA="" K PSBGOT F  S XA=$O(PSBADDL(XA)) Q:XA=""  D
"RTN","PSBOMT",226,0)
 .S MED=$$GET1^DIQ(52.6,XA,.01) Q:$D(PSBGOT(MED))  S PSBGOT(MED)=""
"RTN","PSBOMT",227,0)
 .I $L(PSBHDR(XB)_" / "_MED)+3>IOM D  Q
"RTN","PSBOMT",228,0)
 ..S XB=XB+1,PSBHDR(XB)="                         / "_MED
"RTN","PSBOMT",229,0)
 .S PSBHDR(XB)=PSBHDR(XB)_$S(($L(PSBHDR(XB),":")=2)&($P(PSBHDR(XB),":",2)=""):" ",1:" / ")_MED
"RTN","PSBOMT",230,0)
 I $D(PSBSOLL) S XA="" K PSBGOT F  S XA=$O(PSBSOLL(XA)) Q:XA=""  D
"RTN","PSBOMT",231,0)
 .S MED=$$GET1^DIQ(52.7,XA,.01) Q:$D(PSBGOT(MED))  S PSBGOT(MED)=""
"RTN","PSBOMT",232,0)
 .I $L(PSBHDR(XB)_" / "_MED)+3>IOM D  Q
"RTN","PSBOMT",233,0)
 ..S XB=XB+1,PSBHDR(XB)="                         / "_MED
"RTN","PSBOMT",234,0)
 .S PSBHDR(XB)=PSBHDR(XB)_$S(($L(PSBHDR(XB),":")=2)&($P(PSBHDR(XB),":",2)=""):" ",1:" / ")_MED
"RTN","PSBOMT",235,0)
 I $D(PSBDDL) S XA="" F  S XA=$O(PSBDDL(XA)) Q:XA=""  D
"RTN","PSBOMT",236,0)
 .S MED=$$GET1^DIQ(50,XA,.01)
"RTN","PSBOMT",237,0)
 .I $L(PSBHDR(XB)_" / "_MED)+3>IOM D  Q
"RTN","PSBOMT",238,0)
 ..S XB=XB+1,PSBHDR(XB)="                         / "_MED
"RTN","PSBOMT",239,0)
 .S PSBHDR(XB)=PSBHDR(XB)_$S(($L(PSBHDR(XB),":")=2)&($P(PSBHDR(XB),":",2)=""):" ",1:" / ")_MED
"RTN","PSBOMT",240,0)
 Q
"RTN","PSBOMT",241,0)
WRAP(SIZE,ZP,BRIEN) ;
"RTN","PSBOMT",242,0)
 D ADD($J("",56)_ZP)
"RTN","PSBOMT",243,0)
 D ADD($J("",56)_$E(SIZE,1,75))
"RTN","PSBOMT",244,0)
 I $L(SIZE)>75 D ADD($J("",56)_$E(SIZE,76,150))
"RTN","PSBOMT",245,0)
 Q
"RTN","PSBOMT",246,0)
ADD(XE) ;
"RTN","PSBOMT",247,0)
 S ^TMP("PSB",$J,$O(^TMP("PSB",$J,""),-1)+1)=XE
"RTN","PSBOMT",248,0)
 Q
"RTN","PSBOMT",249,0)
GETDRN(IEN1) ;
"RTN","PSBOMT",250,0)
 ; Get the Drug IEN (p50) via OI IEN (p50.7)
"RTN","PSBOMT",251,0)
 K ^TMP($J,"PSBLIST")
"RTN","PSBOMT",252,0)
 D DRGIEN^PSS50P7(IEN1,,"PSBLIST")
"RTN","PSBOMT",253,0)
 S DN=$O(^TMP($J,"PSBLIST",0))
"RTN","PSBOMT",254,0)
 K ^TMP($J,"PSBLIST")
"RTN","PSBOMT",255,0)
 Q DN
"RTN","PSBOMT",256,0)
GETCLSS(IEN1) ;
"RTN","PSBOMT",257,0)
 ; Get the Items w/i VA Class
"RTN","PSBOMT",258,0)
 K ^TMP($J,"PSBLIST")
"RTN","PSBOMT",259,0)
 D VAC^PSS50(IEN1,,,"PSBLIST")
"RTN","PSBOMT",260,0)
 M PSBDDRG=^TMP($J,"PSBLIST")
"RTN","PSBOMT",261,0)
 K ^TMP($J,"PSBLIST")
"RTN","PSBOMT",262,0)
 Q
"RTN","PSBVDLPB")
0^2^B108871729^B108251396
"RTN","PSBVDLPB",1,0)
PSBVDLPB ;BIRMINGHAM/EFC-BCMA IV VIRTUAL DUE ;03/06/16 3:06pm
"RTN","PSBVDLPB",2,0)
 ;;3.0;BAR CODE MED ADMIN;**11,13,38,32,58,68,70,83,98**;Mar 2004;Build 2
"RTN","PSBVDLPB",3,0)
 ;Per VA Directive 6402, this routine should not be modified.
"RTN","PSBVDLPB",4,0)
 ;
"RTN","PSBVDLPB",5,0)
 ; Reference/IA
"RTN","PSBVDLPB",6,0)
 ; $$GET^XPAR/2263
"RTN","PSBVDLPB",7,0)
 ; File 200/10060
"RTN","PSBVDLPB",8,0)
 ; GETPROVL^PSGSICH1/5653
"RTN","PSBVDLPB",9,0)
 ; INTRDIC^PSGSICH1/5654
"RTN","PSBVDLPB",10,0)
 ;
"RTN","PSBVDLPB",11,0)
 ;*58 - add 29th piece to Results for Override/Intervention flag 1/0
"RTN","PSBVDLPB",12,0)
 ;*68 - add 30th piece to Results for Last Injection Site and
"RTN","PSBVDLPB",13,0)
 ;    - add 31st piece to Results for Piggyback tab to know the IV
"RTN","PSBVDLPB",14,0)
 ;      order is rotation type injectable.
"RTN","PSBVDLPB",15,0)
 ;*70 - add 32nd piece to Results for Clinic Order name
"RTN","PSBVDLPB",16,0)
 ;    - add 33rd piece to Results for Clinic ien ptr to file #44
"RTN","PSBVDLPB",17,0)
 ;*83 - Clinic Orders should show up on VDL's when start order date
"RTN","PSBVDLPB",18,0)
 ;      is Today now ignores the time portion of that field.
"RTN","PSBVDLPB",19,0)
 ;
"RTN","PSBVDLPB",20,0)
EN(DFN,PSBDT) ; Default Order List Return for Today
"RTN","PSBVDLPB",21,0)
 ;
"RTN","PSBVDLPB",22,0)
 ; RPC: PSB GETORDERLIST
"RTN","PSBVDLPB",23,0)
 ;
"RTN","PSBVDLPB",24,0)
 ; Description:
"RTN","PSBVDLPB",25,0)
 ; Returns the current IV order set for today to display on the
"RTN","PSBVDLPB",26,0)
 ; client VDL
"RTN","PSBVDLPB",27,0)
 ;
"RTN","PSBVDLPB",28,0)
 ;
"RTN","PSBVDLPB",29,0)
 N PSBDATA,PSBTBOUT
"RTN","PSBVDLPB",30,0)
 S PSBTBOUT=0,PSBDOADD=0
"RTN","PSBVDLPB",31,0)
 S:PSBTAB="PBTAB" PSBDOADD=1
"RTN","PSBVDLPB",32,0)
 ;
"RTN","PSBVDLPB",33,0)
 ;This routine now re-uses the ^TMP("PSJ",$J global built in PSBVDLTB
"RTN","PSBVDLPB",34,0)
 ;
"RTN","PSBVDLPB",35,0)
 I $G(^TMP("PSJ",$J,1,0))=-1 Q  ; No orders
"RTN","PSBVDLPB",36,0)
 ;
"RTN","PSBVDLPB",37,0)
 N RTBL D BLDTBL^PSBINJEC(.RTBL)  ;build valid IV rotable inj *68
"RTN","PSBVDLPB",38,0)
 ;
"RTN","PSBVDLPB",39,0)
 F PSBX=0:0 S PSBX=$O(^TMP("PSJ",$J,PSBX)) Q:('PSBX)!(PSBTBOUT)  D
"RTN","PSBVDLPB",40,0)
 .N PSBRTNOW S PSBRTNOW=$$NOW^XLFDT()
"RTN","PSBVDLPB",41,0)
 .D CLEAN^PSBVT,PSJ^PSBVT(PSBX)
"RTN","PSBVDLPB",42,0)
 .;
"RTN","PSBVDLPB",43,0)
 .; << Standard checks for ALL orders >>
"RTN","PSBVDLPB",44,0)
 .;
"RTN","PSBVDLPB",45,0)
 .Q:PSBONX["P"              ;No Pending Orders
"RTN","PSBVDLPB",46,0)
 .Q:'$$IVPTAB^PSBVDLU3(PSBOTYP,PSBIVT,PSBISYR,PSBCHEMT,PSBIVPSH)  ;Is Piggyback
"RTN","PSBVDLPB",47,0)
 .Q:PSBOST>PSBWADM          ;Order Start Date/Time > admin window
"RTN","PSBVDLPB",48,0)
 .;CO Order future start check now based on the date only Not time *83
"RTN","PSBVDLPB",49,0)
 .Q:($G(PSBCLORD)]"")&($P(PSBOST,".")>$P(PSBRTNOW,"."))
"RTN","PSBVDLPB",50,0)
 .Q:PSBOSP<PSBWBEG          ;For all Order Stop Date/Time < vdl window
"RTN","PSBVDLPB",51,0)
 .Q:PSBOSTS["D"             ;Is it DC'd
"RTN","PSBVDLPB",52,0)
 .Q:PSBNGF                  ;Is it marked DO NOT GIVE!
"RTN","PSBVDLPB",53,0)
 .; Non One-Times with stop date/time < now
"RTN","PSBVDLPB",54,0)
 .;
"RTN","PSBVDLPB",55,0)
 .D NOW^%DTC
"RTN","PSBVDLPB",56,0)
 .Q:PSBOSP<%
"RTN","PSBVDLPB",57,0)
 .;
"RTN","PSBVDLPB",58,0)
 .; include Active, Renewed, ReInstated and On Call
"RTN","PSBVDLPB",59,0)
 .; (Is it not one time)&(Is it not active or renewed or On Call)
"RTN","PSBVDLPB",60,0)
 .Q:PSBSCHT'="O"&((PSBOSTS'="A")&(PSBOSTS'="R")&(PSBOSTS'="RE")&(PSBOSTS'="O")&(PSBOSTS'="H"))
"RTN","PSBVDLPB",61,0)
 .;
"RTN","PSBVDLPB",62,0)
 .; Is One Time Given
"RTN","PSBVDLPB",63,0)
 .;
"RTN","PSBVDLPB",64,0)
 .I PSBSCHT="O" D  Q:PSBGVN
"RTN","PSBVDLPB",65,0)
 ..S (PSBGVN,X,Y)=""
"RTN","PSBVDLPB",66,0)
 ..F  S X=$O(^PSB(53.79,"AOIP",DFN,PSBOIT,X),-1) Q:'X  D
"RTN","PSBVDLPB",67,0)
 ...F  S Y=$O(^PSB(53.79,"AOIP",DFN,PSBOIT,X,Y),-1) Q:'Y  S:($P(^PSB(53.79,Y,.1),U)=PSBONX)&($P(^PSB(53.79,Y,0),U,9)="G") PSBGVN=1,(X,Y)=0
"RTN","PSBVDLPB",68,0)
 .;
"RTN","PSBVDLPB",69,0)
 .; How long does One Time remain on VDL ?
"RTN","PSBVDLPB",70,0)
 .S PSBRMN=1
"RTN","PSBVDLPB",71,0)
 .I PSBSCHT="O",PSBOSP'=PSBOST,%>PSBOSP S PSBRMN=0
"RTN","PSBVDLPB",72,0)
 .Q:'PSBRMN
"RTN","PSBVDLPB",73,0)
 .;
"RTN","PSBVDLPB",74,0)
 .; Is On-Call Given, Can it be given more than once
"RTN","PSBVDLPB",75,0)
 .;
"RTN","PSBVDLPB",76,0)
 .I PSBSCHT="OC" D  Q:PSBGVN&('$$GET^XPAR("DIV","PSB ADMIN MULTIPLE ONCALL"))
"RTN","PSBVDLPB",77,0)
 ..S (PSBGVN,X,Y)=""
"RTN","PSBVDLPB",78,0)
 ..F  S X=$O(^PSB(53.79,"AOIP",DFN,PSBOIT,X),-1) Q:'X  D
"RTN","PSBVDLPB",79,0)
 ...F  S Y=$O(^PSB(53.79,"AOIP",DFN,PSBOIT,X,Y),-1) Q:'Y  S:($P(^PSB(53.79,Y,.1),U)=PSBONX)&($P(^PSB(53.79,Y,0),U,9)="G") PSBGVN=1,(X,Y)=0 ;correct PSBON to PSBONX, PSB*3*98
"RTN","PSBVDLPB",80,0)
 .;
"RTN","PSBVDLPB",81,0)
 .S PSBSTRT=PSBOST ; Order Start Date/Time
"RTN","PSBVDLPB",82,0)
 .S PSBSTOP=PSBOSP ; Order Stop Date/Time
"RTN","PSBVDLPB",83,0)
 .;
"RTN","PSBVDLPB",84,0)
 .S PSBREC=""
"RTN","PSBVDLPB",85,0)
 .S $P(PSBREC,U,1)=DFN ; dfn
"RTN","PSBVDLPB",86,0)
 .S $P(PSBREC,U,2)=PSBONX ; Order
"RTN","PSBVDLPB",87,0)
 .S $P(PSBREC,U,3)=+PSBON ; order ien
"RTN","PSBVDLPB",88,0)
 .S $P(PSBREC,U,4)=PSBOTYP ; iv/ud/pending
"RTN","PSBVDLPB",89,0)
 .S $P(PSBREC,U,5)=PSBSCHT ; schedule type
"RTN","PSBVDLPB",90,0)
 .S $P(PSBREC,U,6)=PSBSCH ; schedule
"RTN","PSBVDLPB",91,0)
 .S Y=""
"RTN","PSBVDLPB",92,0)
 .S:PSBSM Y="SM"
"RTN","PSBVDLPB",93,0)
 .S:PSBHSM Y="HSM"
"RTN","PSBVDLPB",94,0)
 .S $P(PSBREC,U,7)=Y ; self med
"RTN","PSBVDLPB",95,0)
 .S $P(PSBREC,U,8)=PSBOITX ; drugname
"RTN","PSBVDLPB",96,0)
 .S $P(PSBREC,U,9)=PSBDOSE_" "_PSBIFR ; dosage
"RTN","PSBVDLPB",97,0)
 .S $P(PSBREC,U,10)=PSBMR ;med route
"RTN","PSBVDLPB",98,0)
 .; Last Given from the AOIP X-Ref - not given status not excepted
"RTN","PSBVDLPB",99,0)
 .S (YZ,PSBSTUS,PSBADMER)="" K PSBHSTA,PSBHSTAX
"RTN","PSBVDLPB",100,0)
 .F XZ=1:1:20 S YZ=$O(^PSB(53.79,"AOIP",DFN,PSBOIT,YZ),-1),(PSBCNT,PSBFLAG)=0 Q:YZ=""  D
"RTN","PSBVDLPB",101,0)
 ..S:YZ>0 $P(PSBREC,U,11)=YZ
"RTN","PSBVDLPB",102,0)
 ..S X="" F  S X=$O(^PSB(53.79,"AOIP",DFN,PSBOIT,YZ,X),-1) Q:X=""  D
"RTN","PSBVDLPB",103,0)
 ...K PSBLCK L +^PSB(53.79,X):1  I  L -^PSB(53.79,X) S PSBLCK=1
"RTN","PSBVDLPB",104,0)
 ...S PSBSTUS=$P(^PSB(53.79,X,0),U,9)
"RTN","PSBVDLPB",105,0)
 ...I $G(PSBSTUS)="" S:'$G(PSBLCK) PSBSTUS="X" I $G(PSBLCK) S PSBADMER=1 D
"RTN","PSBVDLPB",106,0)
 ....K PSBPARM3,PSBPARM5,PSBPARM6,PSBPARM7
"RTN","PSBVDLPB",107,0)
 ....S PSBPARM6=X,Y=$P(^PSB(53.79,X,.1),U,3) D DD^%DT S PSBPARM3=Y,Y=$P(^PSB(53.79,X,0),U,6) D DD^%DT S PSBPARM5=Y
"RTN","PSBVDLPB",108,0)
 ....S PSBPARM7=$P(^PSB(53.79,X,0),U,7) S PSBPARM7="( # "_PSBPARM7_" ) "_$$GET1^DIQ(200,PSBPARM7_",",.01)
"RTN","PSBVDLPB",109,0)
 ....K PSBXTMP S PSBXTMP=PSBONX
"RTN","PSBVDLPB",110,0)
 ....D CLEAN^PSBVT,PSJ1^PSBVT(DFN,$$GET1^DIQ(53.79,PSBPARM6_",",.11))
"RTN","PSBVDLPB",111,0)
 ....D ERROR^PSBMLU(PSBONX,PSBOITX,DFN,PSBPARM3_" admin's ACTION STATUS is ""UNKNOWN"".",PSBSCH,PSBPARM5,PSBPARM6,PSBPARM7) ;  SEND AN E-MAIL
"RTN","PSBVDLPB",112,0)
 ....D CLEAN^PSBVT,PSJ1^PSBVT(DFN,PSBXTMP)  ;Reset Variables
"RTN","PSBVDLPB",113,0)
 ....S X=PSBPARM6 K PSBPARM3,PSBPARM5,PSBPARM6,PSBPARM7
"RTN","PSBVDLPB",114,0)
 ...K PSBLCK S:(PSBSTUS']"") PSBSTUS="U"  I PSBSTUS'="N",($G(PSBSTUS)'="X") S PSBFLAG=1,PSBHSTA(YZ,$G(PSBSTUS))="ORIG"_U_X
"RTN","PSBVDLPB",115,0)
 ...D:PSBSTUS="N"
"RTN","PSBVDLPB",116,0)
 ....S $P(PSBREC,U,11)=""
"RTN","PSBVDLPB",117,0)
 ....S Z="" F  S Z=$O(^PSB(53.79,X,.9,Z),-1) Q:'Z  Q:PSBFLAG=1  S PSBDATA=$G(^(Z,0)) D
"RTN","PSBVDLPB",118,0)
 .....I (PSBDATA["Set to 'NOT GIVEN'")!(PSBDATA["Set to 'GIVEN'")!(PSBDATA["Set to 'REFUSED'")!(PSBDATA["Set to 'HELD'")!(PSBDATA["Set to 'MISSING DOSE'")!(PSBDATA["Set to 'REMOVED'") S PSBCNT=PSBCNT+1
"RTN","PSBVDLPB",119,0)
 .....I (PSBDATA["STATUS 'HELD'")!(PSBDATA["STATUS 'GIVEN'")!(PSBDATA["STATUS 'REFUSED'")!(PSBDATA["STATUS 'MISSING DOSE'")!(PSBDATA["STATUS 'REMOVED'") S PSBCNT=PSBCNT+1
"RTN","PSBVDLPB",120,0)
 .....I PSBCNT#2=0,PSBDATA["'REFUSED'" S PSBSTUS="R" D LAST^PSBVDLU1
"RTN","PSBVDLPB",121,0)
 .....I PSBCNT#2=0,PSBDATA["'HELD'" S PSBSTUS="H" D LAST^PSBVDLU1
"RTN","PSBVDLPB",122,0)
 .....I PSBCNT#2=0,PSBDATA["'MISSING DOSE'" S PSBSTUS="M" D LAST^PSBVDLU1
"RTN","PSBVDLPB",123,0)
 .....I PSBCNT#2=0,PSBDATA["'REMOVED'" S PSBSTUS="RM" D LAST^PSBVDLU1
"RTN","PSBVDLPB",124,0)
 .....I PSBFLAG=1,'$D(PSBHSTA($P(PSBREC,U,11),$G(PSBSTUS))) S PSBHSTA($P(PSBREC,U,11),$G(PSBSTUS))=Z_U_X
"RTN","PSBVDLPB",125,0)
 .I $D(PSBHSTA) S $P(PSBREC,U,11)=$O(PSBHSTA(""),-1),PSBSTUS=$O(PSBHSTA($P(PSBREC,U,11),""),-1) M PSBHSTAX(PSBOIT)=PSBHSTA K PSBHSTA  ;last action date/time
"RTN","PSBVDLPB",126,0)
 .S $P(PSBREC,U,12)=""  ;med log ien inserted below for actual date
"RTN","PSBVDLPB",127,0)
 .S $P(PSBREC,U,13)=""  ;med log status inserted below for actual date
"RTN","PSBVDLPB",128,0)
 .S $P(PSBREC,U,14)="" ;admin date inserted below
"RTN","PSBVDLPB",129,0)
 .S $P(PSBREC,U,15)=PSBOIT ; OI Pointer
"RTN","PSBVDLPB",130,0)
 .S $P(PSBREC,U,16)=PSBNJECT  ;Set injectable med route flag
"RTN","PSBVDLPB",131,0)
 .; Variable dosage entered as ####-####?
"RTN","PSBVDLPB",132,0)
 .I $P(PSBREC,U,9)?1.4N1"-"1.4N.E S $P(PSBREC,U,17)=1
"RTN","PSBVDLPB",133,0)
 .E  S $P(PSBREC,U,17)=0
"RTN","PSBVDLPB",134,0)
 .S $P(PSBREC,U,18)=PSBIVT  ;IV TYPE - dosage form
"RTN","PSBVDLPB",135,0)
 .S $P(PSBREC,U,20)=$S((PSBSTUS="X")!(PSBSTUS="N"):"",1:PSBSTUS) ;last action status
"RTN","PSBVDLPB",136,0)
 .S $P(PSBREC,U,21)=PSBOST
"RTN","PSBVDLPB",137,0)
 .S $P(PSBREC,U,22)=PSBOSTS
"RTN","PSBVDLPB",138,0)
 .S $P(PSBREC,U,26)=PSBSTOP
"RTN","PSBVDLPB",139,0)
 .S $P(PSBREC,U,27)=$$LASTG^PSBCSUTL(DFN,PSBOIT)
"RTN","PSBVDLPB",140,0)
 .;*58 determine if override exists, send 1/0 (true/false)
"RTN","PSBVDLPB",141,0)
 .N PSBARR D GETPROVL^PSGSICH1(DFN,PSBONX,.PSBARR)
"RTN","PSBVDLPB",142,0)
 .I $O(PSBARR(""))="" D INTRDIC^PSGSICH1(DFN,PSBONX,.PSBARR,2)
"RTN","PSBVDLPB",143,0)
 .S $P(PSBREC,U,29)=$S($O(PSBARR(""))]"":1,1:0)
"RTN","PSBVDLPB",144,0)
 .;*68 inject rotation flag, send 1/0 (true/false)
"RTN","PSBVDLPB",145,0)
 .I PSBONX["V" D
"RTN","PSBVDLPB",146,0)
 ..N STDRTE S STDRTE=$$GET1^DIQ(51.2,PSBMRIEN,10)
"RTN","PSBVDLPB",147,0)
 ..S $P(PSBREC,U,31)=$$IVROTATN^PSBINJEC(.RTBL,STDRTE,PSBIVT,PSBISYR)
"RTN","PSBVDLPB",148,0)
 ..;*68 if param 31 is 1 then go get last injection site for param 30
"RTN","PSBVDLPB",149,0)
 ..I $P(PSBREC,U,31)=1 D
"RTN","PSBVDLPB",150,0)
 ...N LI D RPC^PSBINJEC(.LI,DFN,PSBOIT,9999999,1)
"RTN","PSBVDLPB",151,0)
 ...S $P(PSBREC,U,30)=$P(LI(1),U,6)   ;if no inj's, 6th will be null
"RTN","PSBVDLPB",152,0)
 .S $P(PSBREC,U,32)=$G(PSBCLORD)  ;clinic name          *70
"RTN","PSBVDLPB",153,0)
 .S $P(PSBREC,U,33)=$G(PSBCLIEN)  ;clinic ien ptr       *70
"RTN","PSBVDLPB",154,0)
 .;
"RTN","PSBVDLPB",155,0)
 .; Gather Dispense Drugs
"RTN","PSBVDLPB",156,0)
 .D NOW^%DTC
"RTN","PSBVDLPB",157,0)
 .S (PSBDDS,PSBSOLS,PSBADDS)="0"
"RTN","PSBVDLPB",158,0)
 .F Y=0:0 S Y=$O(PSBDDA(Y)) Q:'Y  D
"RTN","PSBVDLPB",159,0)
 ..Q:$P(PSBDDA(Y),U,4)&($P(PSBDDA(Y),U,4)<%)  ; Inactive
"RTN","PSBVDLPB",160,0)
 ..S:$P(PSBDDA(Y),U,3)="" $P(PSBDDA(Y),U,3)=1
"RTN","PSBVDLPB",161,0)
 ..S PSBDDS=PSBDDS_U_$P(PSBDDA(Y),U,1,3)
"RTN","PSBVDLPB",162,0)
 ..S $P(PSBDDS,U,1)=PSBDDS+1
"RTN","PSBVDLPB",163,0)
 .; On-Call One Time PRN orders
"RTN","PSBVDLPB",164,0)
 .S PSBQRR=0
"RTN","PSBVDLPB",165,0)
 .;*70 if Order start dates > than the day being viewed, don't show
"RTN","PSBVDLPB",166,0)
 .I "^O^OC^P^"[(U_PSBSCHT_U) D  Q
"RTN","PSBVDLPB",167,0)
 ..Q:PSBCLINORD&($P(PSBOST,".")>PSBDT)           ;*70
"RTN","PSBVDLPB",168,0)
 ..I 'PSBDOADD S PSBTBOUT=1,^TMP("PSB",$J,"PBTAB",0)=2,^TMP("PSB",$J,"PBTAB",1)=1,^TMP("PSB",$J,"PBTAB",2)=1 Q
"RTN","PSBVDLPB",169,0)
 ..D ADD^PSBVDLU1(PSBREC,PSBOTXT,PSBNOW\1,PSBDDS,PSBSOLS,PSBADDS,"PBTAB")
"RTN","PSBVDLPB",170,0)
 .;
"RTN","PSBVDLPB",171,0)
 .; IV's - don't worry about admin times if blank
"RTN","PSBVDLPB",172,0)
 .I PSBONX["V","PSC"'[PSBIVT,PSBADST="" D  Q
"RTN","PSBVDLPB",173,0)
 ..I 'PSBDOADD S PSBTBOUT=1,^TMP("PSB",$J,"PBTAB",0)=2,^TMP("PSB",$J,"PBTAB",1)=1,^TMP("PSB",$J,"PBTAB",2)=1 Q
"RTN","PSBVDLPB",174,0)
 ..D ADD^PSBVDLU1(PSBREC,PSBOTXT,PSBNOW\1_".",PSBDDS,PSBSOLS,PSBADDS,"PBTAB")
"RTN","PSBVDLPB",175,0)
 .;
"RTN","PSBVDLPB",176,0)
 .; Now we deal with only continuous
"RTN","PSBVDLPB",177,0)
 .; process admintimes
"RTN","PSBVDLPB",178,0)
 .S (PSBYES,PSBODD,PSBYTF)=0
"RTN","PSBVDLPB",179,0)
 .S:$$PSBDCHK1^PSBVT1(PSBSCH) PSBYES=1
"RTN","PSBVDLPB",180,0)
 .I PSBYES,PSBADST="" D ERROR^PSBMLU(PSBONX,PSBOITX,DFN,"Admin times required",PSBSCH) Q
"RTN","PSBVDLPB",181,0)
 .F I=1:1 Q:$P(PSBSCH,"-",I)=""  I $P(PSBSCH,"-",I)?2N!($P(PSBSCH,"-",I)?4N) S PSBYES=1,PSBYTF=1
"RTN","PSBVDLPB",182,0)
 .I PSBSCHT="C",PSBYTF="1",PSBADST="" D ERROR^PSBMLU(PSBONX,PSBOITX,DFN,"Admin times required",PSBSCH) Q
"RTN","PSBVDLPB",183,0)
 .S PSBFREQ=$$GETFREQ^PSBVDLU1(DFN,PSBONX)
"RTN","PSBVDLPB",184,0)
 .I PSBFREQ="O" S PSBFREQ=1440
"RTN","PSBVDLPB",185,0)
 .I PSBFREQ="D" S PSBFREQ=""
"RTN","PSBVDLPB",186,0)
 .I 'PSBYES,PSBFREQ<1 D ERROR^PSBMLU(PSBONX,PSBOITX,DFN,"Invalid frequency received from order",PSBSCH) Q
"RTN","PSBVDLPB",187,0)
 .S PSBADMIN=PSBADST
"RTN","PSBVDLPB",188,0)
 .I (PSBADMIN="")&(+PSBFREQ>0) D ODDSCH^PSBVDLU1("PBTAB") Q  ;calculate admin times based on frequency
"RTN","PSBVDLPB",189,0)
 .; No admin times, MAYDAY MAYDAY!!
"RTN","PSBVDLPB",190,0)
 .I +PSBFREQ>0 I (PSBFREQ#1440'=0),(1440#PSBFREQ'=0) S PSBODD=1
"RTN","PSBVDLPB",191,0)
 .I PSBODD,PSBADST'="" D ERROR^PSBMLU(PSBONX,PSBOITX,DFN,"Administration Times on ODD SCHEDULE",PSBSCH) Q
"RTN","PSBVDLPB",192,0)
 .; process admin times against beginning and ending date
"RTN","PSBVDLPB",193,0)
 .; build all orders for both days.
"RTN","PSBVDLPB",194,0)
 .F PSBY=1:1 Q:$P(PSBADMIN,"-",PSBY)=""  D
"RTN","PSBVDLPB",195,0)
 ..;For invalid admin times
"RTN","PSBVDLPB",196,0)
 ..I ($P(PSBADST,"-",PSBY)'?2N)&($P(PSBADST,"-",PSBY)'?4N) D ERROR^PSBMLU(PSBONX,PSBOITX,DFN,"Invalid Admin times",PSBSCH)
"RTN","PSBVDLPB",197,0)
 ..; apply this time to the beginning window date
"RTN","PSBVDLPB",198,0)
 ..S PSB=+(PSBWBEG\1_"."_$P(PSBADMIN,"-",PSBY))
"RTN","PSBVDLPB",199,0)
 ..D:(PSB'<PSBWBEG)&(PSB'>PSBWEND)  ; Make sure it is in the window
"RTN","PSBVDLPB",200,0)
 ...D:(PSB'<PSBSTRT)&(PSB<PSBSTOP)  ; Make sure this time is active
"RTN","PSBVDLPB",201,0)
 ....D:$$OKAY^PSBVDLU1(PSBSTRT,PSB,PSBSCH,PSBON,PSBOITX,PSBFREQ,PSBOSTS)  ; Okay on this date?
"RTN","PSBVDLPB",202,0)
 .....I 'PSBDOADD S PSBTBOUT=1,^TMP("PSB",$J,"PBTAB",0)=2,^TMP("PSB",$J,"PBTAB",1)=1,^TMP("PSB",$J,"PBTAB",2)=1 Q
"RTN","PSBVDLPB",203,0)
 .....D ADD^PSBVDLU1(PSBREC,PSBOTXT,PSB,PSBDDS,PSBSOLS,PSBADDS,"PBTAB")
"RTN","PSBVDLPB",204,0)
 ..;
"RTN","PSBVDLPB",205,0)
 ..Q:(PSBWBEG\1)=(PSBWEND\1)  ; Window only has one day rare but possible
"RTN","PSBVDLPB",206,0)
 ..;
"RTN","PSBVDLPB",207,0)
 ..; apply this time to the ending window date
"RTN","PSBVDLPB",208,0)
 ..S PSB=+(PSBWEND\1_"."_$P(PSBADMIN,"-",PSBY))
"RTN","PSBVDLPB",209,0)
 ..D:(PSB'<PSBWBEG)&(PSB'>PSBWEND)  ; Make sure it is in the window
"RTN","PSBVDLPB",210,0)
 ...D:(PSB'<PSBSTRT)&(PSB<PSBSTOP)  ; Make sure this time is active
"RTN","PSBVDLPB",211,0)
 ....D:$$OKAY^PSBVDLU1(PSBSTRT,PSB,PSBSCH,PSBON,PSBOITX,PSBFREQ,PSBOSTS)  ; Okay on this date?
"RTN","PSBVDLPB",212,0)
 .....I 'PSBDOADD S PSBTBOUT=1,^TMP("PSB",$J,"PBTAB",0)=2,^TMP("PSB",$J,"PBTAB",1)=1,^TMP("PSB",$J,"PBTAB",2)=1 Q
"RTN","PSBVDLPB",213,0)
 .....D ADD^PSBVDLU1(PSBREC,PSBOTXT,PSB,PSBDDS,PSBSOLS,PSBADDS,"PBTAB")
"RTN","PSBVDLPB",214,0)
 ;
"RTN","PSBVDLPB",215,0)
 ;add initials of verifying pharmacist/verifying nurse
"RTN","PSBVDLPB",216,0)
 D:PSBDOADD VNURSE^PSBVDLU1("PBTAB")
"RTN","PSBVDLPB",217,0)
 Q
"RTN","PSBVDLPB",218,0)
 ;
"VER")
8.0^22.0
"BLD",10425,6)
^81
**END**
**END**

