Released PSB*3*103 SEQ #93
Extracted from mail message
**KIDS**:PSB*3.0*103^

**INSTALL NAME**
PSB*3.0*103
"BLD",10519,0)
PSB*3.0*103^BAR CODE MED ADMIN^0^3190103^y
"BLD",10519,1,0)
^^6^6^3181129^
"BLD",10519,1,1,0)
This patch addresses the request from NSR #20170515 - Adds Respiratory 
"BLD",10519,1,2,0)
Therapy Report.
"BLD",10519,1,3,0)
After this patch is installed, Respiratory Therapists will have access to 
"BLD",10519,1,4,0)
the new option Report for Respiratory Therapy Medications [PSB 
"BLD",10519,1,5,0)
RPT RESP THERAPY MEDS]    VistA to produce a report of patients on
"BLD",10519,1,6,0)
Respiratory Therapy medications.
"BLD",10519,4,0)
^9.64PA^^0
"BLD",10519,6.3)
21
"BLD",10519,"ABPKG")
n
"BLD",10519,"INID")
^y
"BLD",10519,"INIT")
POST^PSB3P103
"BLD",10519,"KRN",0)
^9.67PA^779.2^20
"BLD",10519,"KRN",.4,0)
.4
"BLD",10519,"KRN",.401,0)
.401
"BLD",10519,"KRN",.402,0)
.402
"BLD",10519,"KRN",.402,"NM",0)
^9.68A^^0
"BLD",10519,"KRN",.403,0)
.403
"BLD",10519,"KRN",.5,0)
.5
"BLD",10519,"KRN",.84,0)
.84
"BLD",10519,"KRN",3.6,0)
3.6
"BLD",10519,"KRN",3.8,0)
3.8
"BLD",10519,"KRN",9.2,0)
9.2
"BLD",10519,"KRN",9.8,0)
9.8
"BLD",10519,"KRN",9.8,"NM",0)
^9.68A^5^5
"BLD",10519,"KRN",9.8,"NM",1,0)
PSBMMRB^^0^B31182721
"BLD",10519,"KRN",9.8,"NM",2,0)
PSBORT^^0^B73550568
"BLD",10519,"KRN",9.8,"NM",3,0)
PSBO1^^0^B35943966
"BLD",10519,"KRN",9.8,"NM",4,0)
PSBOHDR1^^0^B3661233
"BLD",10519,"KRN",9.8,"NM",5,0)
PSB3P103^^0^B2124804
"BLD",10519,"KRN",9.8,"NM","B","PSB3P103",5)

"BLD",10519,"KRN",9.8,"NM","B","PSBMMRB",1)

"BLD",10519,"KRN",9.8,"NM","B","PSBO1",3)

"BLD",10519,"KRN",9.8,"NM","B","PSBOHDR1",4)

"BLD",10519,"KRN",9.8,"NM","B","PSBORT",2)

"BLD",10519,"KRN",19,0)
19
"BLD",10519,"KRN",19,"NM",0)
^9.68A^2^1
"BLD",10519,"KRN",19,"NM",2,0)
PSB RPT RESP THERAPY MEDS^^0
"BLD",10519,"KRN",19,"NM","B","PSB RPT RESP THERAPY MEDS",2)

"BLD",10519,"KRN",19.1,0)
19.1
"BLD",10519,"KRN",101,0)
101
"BLD",10519,"KRN",409.61,0)
409.61
"BLD",10519,"KRN",771,0)
771
"BLD",10519,"KRN",779.2,0)
779.2
"BLD",10519,"KRN",870,0)
870
"BLD",10519,"KRN",8989.51,0)
8989.51
"BLD",10519,"KRN",8989.52,0)
8989.52
"BLD",10519,"KRN",8994,0)
8994
"BLD",10519,"KRN","B",.4,.4)

"BLD",10519,"KRN","B",.401,.401)

"BLD",10519,"KRN","B",.402,.402)

"BLD",10519,"KRN","B",.403,.403)

"BLD",10519,"KRN","B",.5,.5)

"BLD",10519,"KRN","B",.84,.84)

"BLD",10519,"KRN","B",3.6,3.6)

"BLD",10519,"KRN","B",3.8,3.8)

"BLD",10519,"KRN","B",9.2,9.2)

"BLD",10519,"KRN","B",9.8,9.8)

"BLD",10519,"KRN","B",19,19)

"BLD",10519,"KRN","B",19.1,19.1)

"BLD",10519,"KRN","B",101,101)

"BLD",10519,"KRN","B",409.61,409.61)

"BLD",10519,"KRN","B",771,771)

"BLD",10519,"KRN","B",779.2,779.2)

"BLD",10519,"KRN","B",870,870)

"BLD",10519,"KRN","B",8989.51,8989.51)

"BLD",10519,"KRN","B",8989.52,8989.52)

"BLD",10519,"KRN","B",8994,8994)

"BLD",10519,"QUES",0)
^9.62^^
"BLD",10519,"REQB",0)
^9.611^2^2
"BLD",10519,"REQB",1,0)
PSS*1.0*225^1
"BLD",10519,"REQB",2,0)
PSB*3.0*83^1
"BLD",10519,"REQB","B","PSB*3.0*83",2)

"BLD",10519,"REQB","B","PSS*1.0*225",1)

"INIT")
POST^PSB3P103
"KRN",19,2922085,-1)
0^2
"KRN",19,2922085,0)
PSB RPT RESP THERAPY MEDS^Report for Respiratory Therapy Medications^^R^^^^^^^^BAR CODE MED ADMIN^^
"KRN",19,2922085,1,0)
^^3^3^3180222^
"KRN",19,2922085,1,1,0)
This report is used by Respiratory Therapists to track 
"KRN",19,2922085,1,2,0)
admininstration dates and times of medications for patients who need
"KRN",19,2922085,1,3,0)
respiratory therapy treatments.
"KRN",19,2922085,20)

"KRN",19,2922085,25)
EN1^PSBMMRB
"KRN",19,2922085,99)
64701,57138
"KRN",19,2922085,"U")
REPORT FOR RESPIRATORY THERAPY
"MBREQ")
0
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"PKG",607,-1)
1^1
"PKG",607,0)
BAR CODE MED ADMIN^PSB^BAR CODE MEDICATION ADMINISTRATION
"PKG",607,22,0)
^9.49I^1^1
"PKG",607,22,1,0)
3.0^3040224^3040503^568
"PKG",607,22,1,"PAH",1,0)
103^3190103
"PKG",607,22,1,"PAH",1,1,0)
^^6^6^3190103
"PKG",607,22,1,"PAH",1,1,1,0)
This patch addresses the request from NSR #20170515 - Adds Respiratory 
"PKG",607,22,1,"PAH",1,1,2,0)
Therapy Report.
"PKG",607,22,1,"PAH",1,1,3,0)
After this patch is installed, Respiratory Therapists will have access to 
"PKG",607,22,1,"PAH",1,1,4,0)
the new option Report for Respiratory Therapy Medications [PSB 
"PKG",607,22,1,"PAH",1,1,5,0)
RPT RESP THERAPY MEDS]    VistA to produce a report of patients on
"PKG",607,22,1,"PAH",1,1,6,0)
Respiratory Therapy medications.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
5
"RTN","PSB3P103")
0^5^B2124804^n/a
"RTN","PSB3P103",1,0)
PSB3P103 ;AITC/CR - POST INIT FOR PATCH PSB*3*103 ;2/27/18 9:18am
"RTN","PSB3P103",2,0)
 ;;3.0;BAR CODE MED ADMIN;**103**;Mar 2004;Build 21
"RTN","PSB3P103",3,0)
 ;Per VA Directive 6402, this routine should not be modified
"RTN","PSB3P103",4,0)
 ;
"RTN","PSB3P103",5,0)
 ; call to: $$ADD^XPDMENU - supported by ICR #1157
"RTN","PSB3P103",6,0)
 ;          BMES^XPDUTL   - supported by ICR #10141
"RTN","PSB3P103",7,0)
 ;
"RTN","PSB3P103",8,0)
POST ; set up the new option for the report 'Report for Respiratory Therapists',
"RTN","PSB3P103",9,0)
 ; the option name is [PSB RPT RESP THERAPY MEDS] and the menu receiving it is
"RTN","PSB3P103",10,0)
 ; [PSB PHARMACY]
"RTN","PSB3P103",11,0)
 ;
"RTN","PSB3P103",12,0)
 D BMES^XPDUTL("Starting Post-installation operations for patch PSB*3.0*103...")
"RTN","PSB3P103",13,0)
 D ADD1
"RTN","PSB3P103",14,0)
 D EXIT
"RTN","PSB3P103",15,0)
 Q
"RTN","PSB3P103",16,0)
 ;
"RTN","PSB3P103",17,0)
ADD1 ; update menu [PSB PHARMACY]
"RTN","PSB3P103",18,0)
 N PSBOK,PSBSYN
"RTN","PSB3P103",19,0)
 S PSBSYN=12
"RTN","PSB3P103",20,0)
 S PSBOK=$$ADD^XPDMENU("PSB PHARMACY","PSB RPT RESP THERAPY MEDS",PSBSYN)
"RTN","PSB3P103",21,0)
 I PSBOK=1 D
"RTN","PSB3P103",22,0)
 . D BMES^XPDUTL("[PSB RPT RESP THERAPY MEDS] Option is part of [PSB PHARMACY]")
"RTN","PSB3P103",23,0)
 E  D  G ERR
"RTN","PSB3P103",24,0)
 . D BMES^XPDUTL("Couldn't add option [PSB RPT RESP THERAPY MEDS] to [PSB PHARMACY]")
"RTN","PSB3P103",25,0)
 Q
"RTN","PSB3P103",26,0)
 ;
"RTN","PSB3P103",27,0)
ERR ; alert the user if there is an error
"RTN","PSB3P103",28,0)
 D BMES^XPDUTL("Unable to attach the menu option")
"RTN","PSB3P103",29,0)
 Q
"RTN","PSB3P103",30,0)
 ;
"RTN","PSB3P103",31,0)
EXIT ;
"RTN","PSB3P103",32,0)
 D BMES^XPDUTL("Finished Post-installation of patch PSB*3.0*103.")
"RTN","PSB3P103",33,0)
 Q
"RTN","PSBMMRB")
0^1^B31182721^n/a
"RTN","PSBMMRB",1,0)
PSBMMRB ;AITC/CR - REPORT FOR RESPIRATORY THERAPY MEDS ;11/29/18 5:37am
"RTN","PSBMMRB",2,0)
 ;;3.0;BAR CODE MED ADMIN;**103**;Mar 2004;Build 21
"RTN","PSBMMRB",3,0)
 ;Per VA Directive 6402, this routine should not be modified.
"RTN","PSBMMRB",4,0)
 ;
"RTN","PSBMMRB",5,0)
 ; Reference/ICR #
"RTN","PSBMMRB",6,0)
 ; ^DPT("CN"/6984    (private)
"RTN","PSBMMRB",7,0)
 ; $$GET1^DIQ/2056   (supported)
"RTN","PSBMMRB",8,0)
 ; ^DG(40.8/2817     (controlled)
"RTN","PSBMMRB",9,0)
 ; ^DG(43/6812       (private)
"RTN","PSBMMRB",10,0)
 ; File #44/10040    (supported)
"RTN","PSBMMRB",11,0)
 ; ^VA(200/10060     (supported)
"RTN","PSBMMRB",12,0)
 ; %ZTLOAD/10063     (supported)
"RTN","PSBMMRB",13,0)
 ; %ZIS/10086        (supported)
"RTN","PSBMMRB",14,0)
 ; %ZISC/10089       (supported)
"RTN","PSBMMRB",15,0)
 ;
"RTN","PSBMMRB",16,0)
 ;=================================================================
"RTN","PSBMMRB",17,0)
EN1 ;
"RTN","PSBMMRB",18,0)
 W !!,"Report for Respiratory Therapy Medications",!
"RTN","PSBMMRB",19,0)
 N D0,DIC,PSBDATA,PSBDPTR,PSBDIV,PSBDVNM,PSBNAME,PSBMUDV,PSBSTIEN,X,Y
"RTN","PSBMMRB",20,0)
 K ^TMP($J),^TMP("PSBMMRB")
"RTN","PSBMMRB",21,0)
 S D0=1,PSBMUDV=$S($$GET1^DIQ(43,D0,11,"I")=1:1,1:0)
"RTN","PSBMMRB",22,0)
 I PSBMUDV=1 D CHK1,EN2 Q
"RTN","PSBMMRB",23,0)
 I PSBMUDV=0 D ALL,EN2 Q
"RTN","PSBMMRB",24,0)
 Q
"RTN","PSBMMRB",25,0)
 ;
"RTN","PSBMMRB",26,0)
EN2 I $P($G(^VA(200,DUZ,2,0)),U,4)=0 W !!,$C(7),"You have no valid divisions in the NEW PERSON file." S Y="^" Q
"RTN","PSBMMRB",27,0)
 I '$O(^DG(40.8,"AD",DUZ(2),"")) W !!,$C(7),"Your NEW PERSON file division was not found in the MEDICAL CENTER DIVISION file." S Y="^" Q
"RTN","PSBMMRB",28,0)
 I Y=""!(Y<0)!(Y="^") Q
"RTN","PSBMMRB",29,0)
 S PSBDIV=$P($G(^TMP("PSBMMRB",$J)),U,2)
"RTN","PSBMMRB",30,0)
 S PSBNAME=$P($G(^TMP("PSBMMRB",$J)),U,3)
"RTN","PSBMMRB",31,0)
 W !
"RTN","PSBMMRB",32,0)
 S %DT="AE"
"RTN","PSBMMRB",33,0)
 S %DT("A")="Select date of Respiratory Therapy Meds Report (e.g., T or T-1, etc.): "
"RTN","PSBMMRB",34,0)
 D ^%DT
"RTN","PSBMMRB",35,0)
 I Y'=-1 D
"RTN","PSBMMRB",36,0)
 . S RDATE=Y
"RTN","PSBMMRB",37,0)
 . W !!,"Please choose a 132 character printer",!
"RTN","PSBMMRB",38,0)
 . W "Queuing of this report is recommended",!
"RTN","PSBMMRB",39,0)
 . S %ZIS="MQ"
"RTN","PSBMMRB",40,0)
 . D ^%ZIS
"RTN","PSBMMRB",41,0)
 . I POP K %ZIS W !,"Device not ready" Q
"RTN","PSBMMRB",42,0)
 . I $D(IO("Q")) D
"RTN","PSBMMRB",43,0)
 .. S ZTRTN="EN3^PSBMMRB"
"RTN","PSBMMRB",44,0)
 .. S ZTSAVE("RDATE")=""
"RTN","PSBMMRB",45,0)
 .. S ZTSAVE("PSBMUDV")=""
"RTN","PSBMMRB",46,0)
 .. S ZTSAVE("PSBDIV")=""
"RTN","PSBMMRB",47,0)
 .. S ZTSAVE("PSBNAME")=""
"RTN","PSBMMRB",48,0)
 .. S ZTDESC("Respiratory Therapy Meds Report")=""
"RTN","PSBMMRB",49,0)
 .. D ^%ZTLOAD
"RTN","PSBMMRB",50,0)
 . ; allow user to send report immediately to the screen
"RTN","PSBMMRB",51,0)
 . I '$D(IO("Q")) D
"RTN","PSBMMRB",52,0)
 .. D WAIT^DICD U IO D EN3^PSBMMRB
"RTN","PSBMMRB",53,0)
 .. I IO'=IO(0) D ^%ZISC
"RTN","PSBMMRB",54,0)
 D ^%ZISC
"RTN","PSBMMRB",55,0)
 D EXIT
"RTN","PSBMMRB",56,0)
 Q
"RTN","PSBMMRB",57,0)
 ;
"RTN","PSBMMRB",58,0)
EN3 ; create new entry; note: national routine PSBO1 is modified for a new report,
"RTN","PSBMMRB",59,0)
 ; at NEW+3^PSBO1 add RT code for Respiratory Therapy Meds report
"RTN","PSBMMRB",60,0)
 ;
"RTN","PSBMMRB",61,0)
 D NEW^PSBO1(.PSBRPT,"RT")     ;for Respiratory Therapy Meds report
"RTN","PSBMMRB",62,0)
 G:$P($G(PSBRPT(0)),U)<1 EXIT
"RTN","PSBMMRB",63,0)
 ; edit new entry.
"RTN","PSBMMRB",64,0)
 S DA=$P($G(PSBRPT(0)),U),DIE="^PSB(53.69,"
"RTN","PSBMMRB",65,0)
 S DR=".06///^S X=ION;.11///W;.15=///B;.16=///"_RDATE_";.17=///0001;.19=///2400"
"RTN","PSBMMRB",66,0)
 L +(^PSB(53.69,DA)):$S($G(DILOCKTM)>30:DILOCKTM,1:30) I '$T G EXIT
"RTN","PSBMMRB",67,0)
 D ^DIE
"RTN","PSBMMRB",68,0)
 L -(^PSB(53.69,DA))
"RTN","PSBMMRB",69,0)
 ; loop thru ^DPT("CN" and get all wards with patients
"RTN","PSBMMRB",70,0)
 ; ZZA is the ward name, ZZB is the IEN for the patient
"RTN","PSBMMRB",71,0)
 N ZZA,ZZB,WARD
"RTN","PSBMMRB",72,0)
 S ZZA="" F  S ZZA=$O(^DPT("CN",ZZA)) Q:ZZA=""  D
"RTN","PSBMMRB",73,0)
 . N DIVPTR,PSBSTA42,ZZAIEN
"RTN","PSBMMRB",74,0)
 . S ZZB="" F  S ZZB=$O(^DPT("CN",ZZA,ZZB)) Q:ZZB=""  D
"RTN","PSBMMRB",75,0)
 .. S ZZAIEN=$O(^SC("B",ZZA,""))
"RTN","PSBMMRB",76,0)
 .. Q:+$G(ZZAIEN)=""
"RTN","PSBMMRB",77,0)
 .. S DIVPTR=$$GET1^DIQ(44,ZZAIEN,3.5,"I") ; station # for ward
"RTN","PSBMMRB",78,0)
 .. S PSBSTA42=$$GET1^DIQ(40.8,DIVPTR,.07,"I")
"RTN","PSBMMRB",79,0)
 .. ; capture the ward name
"RTN","PSBMMRB",80,0)
 .. S WARD=$$GET1^DIQ(44,ZZAIEN,.01,"E") ; ward name
"RTN","PSBMMRB",81,0)
 .. I (PSBMUDV=1)&(PSBDIV'=PSBSTA42) Q  ; single division only
"RTN","PSBMMRB",82,0)
 .. S ^TMP($J,WARD)=""
"RTN","PSBMMRB",83,0)
 ;
"RTN","PSBMMRB",84,0)
 ; if there are no wards in the division queried, issue a blank report
"RTN","PSBMMRB",85,0)
 I '$D(^TMP($J)) D  Q
"RTN","PSBMMRB",86,0)
 . S PSBHDR(1)="RESPIRATORY THERAPY MEDICATIONS from "_$$FMTE^XLFDT(DT)_"@00:01"_" thru "_$$FMTE^XLFDT(DT)_"@24:00"
"RTN","PSBMMRB",87,0)
 . S PSBWRD=""
"RTN","PSBMMRB",88,0)
 . D WRDHDR^PSBORT
"RTN","PSBMMRB",89,0)
 . W !,"No Medications Found"
"RTN","PSBMMRB",90,0)
 . Q
"RTN","PSBMMRB",91,0)
 ;
"RTN","PSBMMRB",92,0)
 N NUM,NURIEN,WARD1,WARD2
"RTN","PSBMMRB",93,0)
 D NWLIST^PSBRPC(.WARD1,) ; get only active wards from #211.4
"RTN","PSBMMRB",94,0)
 S NUM=0 F  S NUM=$O(WARD1(NUM)) Q:NUM'>0  I $P($G(WARD1(NUM)),U,2)["[MAS WARD]" S WARD2($P($P($G(WARD1(NUM)),U,2),"[",1))=$P($G(WARD1(NUM)),U,1)
"RTN","PSBMMRB",95,0)
 N FLAGPRT ; used in PSBORT to track wards printed
"RTN","PSBMMRB",96,0)
 S FLAGPRT=""
"RTN","PSBMMRB",97,0)
 S WARD="" F  S WARD=$O(^TMP($J,WARD)) Q:WARD=""  D
"RTN","PSBMMRB",98,0)
 . N SUB
"RTN","PSBMMRB",99,0)
 . S SUB=$O(WARD2(WARD))
"RTN","PSBMMRB",100,0)
 . S NURIEN=$P($G(WARD2(SUB)),U)
"RTN","PSBMMRB",101,0)
 . S DA=$P($G(PSBRPT(0)),U),DIE="^PSB(53.69,"
"RTN","PSBMMRB",102,0)
 . S DR=".13////^S X=NURIEN"  ; don't prompt when finding similar ward names
"RTN","PSBMMRB",103,0)
 . L +(^PSB(53.69,DA)):$S($G(DILOCKTM)>30:DILOCKTM,1:30) I '$T G EXIT
"RTN","PSBMMRB",104,0)
 . D ^DIE
"RTN","PSBMMRB",105,0)
 . L -(^PSB(53.69,DA))
"RTN","PSBMMRB",106,0)
 . D DQ^PSBO(DA)
"RTN","PSBMMRB",107,0)
 Q
"RTN","PSBMMRB",108,0)
 ;
"RTN","PSBMMRB",109,0)
EXIT ; clean up.
"RTN","PSBMMRB",110,0)
 K DA,DIE,DR,PSBRPT,RDATE
"RTN","PSBMMRB",111,0)
 K D0,^TMP($J),^TMP("PSBMMRB",$J)
"RTN","PSBMMRB",112,0)
 Q
"RTN","PSBMMRB",113,0)
 ;
"RTN","PSBMMRB",114,0)
CHK1 ; The user must have at least one division from file #40.8 in his file #200 record.
"RTN","PSBMMRB",115,0)
 N DIR
"RTN","PSBMMRB",116,0)
 W !
"RTN","PSBMMRB",117,0)
 S DIR(0)="SB^A:All Divisions;O:One Division"
"RTN","PSBMMRB",118,0)
 S DIR("?")="Select either All Divisions or One Division."
"RTN","PSBMMRB",119,0)
 S DIR("A")="Do you want (A)ll Divisions or just (O)ne Division"
"RTN","PSBMMRB",120,0)
 S DIR("B")="O"
"RTN","PSBMMRB",121,0)
 D ^DIR K DIR I $D(DUOUT)!$D(DTOUT)!$D(DIROUT)!$D(DIRUT) Q
"RTN","PSBMMRB",122,0)
 I Y="" Q
"RTN","PSBMMRB",123,0)
 I Y(0)="One Division" D ONE Q   ; regardless user divisions in file #200
"RTN","PSBMMRB",124,0)
 I Y(0)="All Divisions" S PSBMUDV=2 ; for all divisions in a multisite setup
"RTN","PSBMMRB",125,0)
 Q
"RTN","PSBMMRB",126,0)
 ;
"RTN","PSBMMRB",127,0)
ALL ; user gets all divisions
"RTN","PSBMMRB",128,0)
 S Y(0)="All Divisions"  ; all divisions selected
"RTN","PSBMMRB",129,0)
 S PSBDIV=DUZ(2)
"RTN","PSBMMRB",130,0)
 S PSBSTIEN=+$O(^DG(40.8,"AD",DUZ(2),"")) ; current IEN for station
"RTN","PSBMMRB",131,0)
 S Y=$$GET1^DIQ(40.8,PSBSTIEN,.01,"E")
"RTN","PSBMMRB",132,0)
 I '$D(Y) S Y=DUZ(2)
"RTN","PSBMMRB",133,0)
 S PSBNAME=$$NAME^XUAF4(DUZ(2))
"RTN","PSBMMRB",134,0)
 S PSBMUDV=0
"RTN","PSBMMRB",135,0)
 S ^TMP("PSBMMRB",$J)=PSBMUDV_U_PSBDIV_U_PSBNAME
"RTN","PSBMMRB",136,0)
 Q
"RTN","PSBMMRB",137,0)
 ;
"RTN","PSBMMRB",138,0)
ONE ; when user selects one division from many in file #200, look at file #40.8 for a match if available
"RTN","PSBMMRB",139,0)
 W !
"RTN","PSBMMRB",140,0)
 S PSBSTIEN=+$O(^DG(40.8,"AD",DUZ(2),"")) ; current IEN for station
"RTN","PSBMMRB",141,0)
 S PSBDVNM=$$GET1^DIQ(40.8,PSBSTIEN,.01,"I") ;division name
"RTN","PSBMMRB",142,0)
 S DIC("B")=PSBDVNM
"RTN","PSBMMRB",143,0)
 S DIC("A")="Select Division: ",DIC="^DG(40.8,",DIC(0)="AEMQ",DIC("S")="I $$SITE^VASITE(,+Y)>0"
"RTN","PSBMMRB",144,0)
 D ^DIC
"RTN","PSBMMRB",145,0)
 ; capture the division name and number after user selection
"RTN","PSBMMRB",146,0)
 S PSBNAME=$$GET1^DIQ(40.8,+Y,.01,"E")
"RTN","PSBMMRB",147,0)
 S PSBDPTR=$$GET1^DIQ(40.8,+Y,.07,"I") ; pointer to file #4
"RTN","PSBMMRB",148,0)
 S PSBDIV=PSBDPTR
"RTN","PSBMMRB",149,0)
 S ^TMP("PSBMMRB",$J)=PSBMUDV_U_PSBDIV_U_PSBNAME
"RTN","PSBMMRB",150,0)
 Q
"RTN","PSBO1")
0^3^B35943966^B35906614
"RTN","PSBO1",1,0)
PSBO1 ;BIRMINGHAM/EFC/CR - BCMA OUTPUTS ;3/7/18 2:02pm
"RTN","PSBO1",2,0)
 ;;3.0;BAR CODE MED ADMIN;**4,13,32,2,43,28,70,83,103**;Mar 2004;Build 21
"RTN","PSBO1",3,0)
 ;Per VHA Directive 2004-038 (or future revisions regarding same), this routine should not be modified.
"RTN","PSBO1",4,0)
 ;
"RTN","PSBO1",5,0)
 ; Reference/IA
"RTN","PSBO1",6,0)
 ; EN^PSJBCMA/2828
"RTN","PSBO1",7,0)
 ;
"RTN","PSBO1",8,0)
 ;*70 - add ablility to update List multiple for Clinic names
"RTN","PSBO1",9,0)
 ;*83 - add Function GETREMOV to find removes for associated MRR Gives
"RTN","PSBO1",10,0)
 ;
"RTN","PSBO1",11,0)
NEW(RESULTS,PSBRTYP) ; Create a new report request
"RTN","PSBO1",12,0)
 ; Called interactively and via RPCBroker
"RTN","PSBO1",13,0)
 K RESULTS
"RTN","PSBO1",14,0)
 ; PSB*3*103 - added 'RT' code for Respiratory Therapy report, called from EN1+3^PSBMMRB
"RTN","PSBO1",15,0)
 I '$F("DL^MD^MH^ML^MM^MV^MT^PE^PM^WA^BL^PI^AL^DO^VT^PF^XA^ST^SF^IV^CM^CP^CE^CI^BZ^RT^",PSBRTYP) S RESULTS(0)="-1^Invalid Report Type" Q
"RTN","PSBO1",16,0)
 I '+$G(DUZ) S RESULTS(0)="-1^Undefined User" Q
"RTN","PSBO1",17,0)
 I '$G(DUZ(2)) S RESULTS(0)="-1^Undefined Division" Q
"RTN","PSBO1",18,0)
 ; Lock Log
"RTN","PSBO1",19,0)
 L +(^PSB(53.69,0)):$S($G(DILOCKTM)>30:DILOCKTM,1:30)
"RTN","PSBO1",20,0)
 E  S RESULTS(0)="-1^Request Log Locked" Q
"RTN","PSBO1",21,0)
 ; Generate Unique Entry and Create
"RTN","PSBO1",22,0)
 F  D NOW^%DTC S X=$E(%_"000000",1,14) S X=(1700+$E(X,1,3))_$E(X,4,14),X=PSBRTYP_"-"_$TR(X,".","-") Q:'$D(^PSB(53.69,"B",X))
"RTN","PSBO1",23,0)
 S DIC="^PSB(53.69,",DIC(0)="L"
"RTN","PSBO1",24,0)
 S DIC("DR")=".02///N;.03////^S X=DUZ;.04////^S X=DUZ(2);.05///^S X=PSBRTYP"
"RTN","PSBO1",25,0)
 K DD,DO D FILE^DICN
"RTN","PSBO1",26,0)
 L -(^PSB(53.69,0))
"RTN","PSBO1",27,0)
 ; Okay, setup return and Boogie
"RTN","PSBO1",28,0)
 I +Y<1 S RESULTS(0)="-1^Error Creating Request"
"RTN","PSBO1",29,0)
 E  S RESULTS(0)=Y
"RTN","PSBO1",30,0)
 K DO
"RTN","PSBO1",31,0)
 Q
"RTN","PSBO1",32,0)
 ;
"RTN","PSBO1",33,0)
PRINT ;
"RTN","PSBO1",34,0)
 N ZTDTH,ZTRTN,ZTSK,ZTDESC,ZTSAVE,DA
"RTN","PSBO1",35,0)
 S DA=+PSBRPT(0)
"RTN","PSBO1",36,0)
 S IOP=$$GET1^DIQ(53.69,DA_",",.06,"I"),PSBSIO=0 I IOP]"" D
"RTN","PSBO1",37,0)
 .S IOP="`"_IOP,%ZIS="N"
"RTN","PSBO1",38,0)
 .D ^%ZIS
"RTN","PSBO1",39,0)
 .I IO=IO(0) S PSBSIO=1
"RTN","PSBO1",40,0)
 .D HOME^%ZIS K IOP
"RTN","PSBO1",41,0)
 I $$GET1^DIQ(53.69,DA_",",.06)["BROWSER"!(PSBSIO=1) S IOP=$$GET1^DIQ(53.69,DA_",",.06)_";132" D ^%ZIS U IO D DQ^PSBO(DA) D ^%ZISC K IOP Q
"RTN","PSBO1",42,0)
 W @IOF,"Submitting Your Report Request to TaskMan..."
"RTN","PSBO1",43,0)
 S ZTIO=$$GET1^DIQ(53.69,DA_",",.06)_";132"
"RTN","PSBO1",44,0)
 S ZTDTH=$S($$GET1^DIQ(53.69,DA_",",.07,"I")]"":$$GET1^DIQ(53.69,DA_",",.07,"I"),1:$H)
"RTN","PSBO1",45,0)
 S ZTDESC="BCMA - "_$$GET1^DIQ(53.69,DA_",",.05)
"RTN","PSBO1",46,0)
 S ZTRTN="DQ^PSBO("_DA_")"
"RTN","PSBO1",47,0)
 F I="PSBDFN","PSBTYPE" S ZTSAVE(I)=""
"RTN","PSBO1",48,0)
 I $G(PSBORDNM)]"" S ZTSAVE("PSBORDNM")=""
"RTN","PSBO1",49,0)
 D ^%ZTLOAD
"RTN","PSBO1",50,0)
 I $D(ZTSK) S ^TMP("PSBO",$J,1)="0^Report queued. (Task #"_ZTSK_")"
"RTN","PSBO1",51,0)
 E  S ^TMP("PSBO",$J,1)="-1^Task Rejected."
"RTN","PSBO1",52,0)
 Q
"RTN","PSBO1",53,0)
 ;
"RTN","PSBO1",54,0)
LIST(XLIST) ;  Place List Criteria into subfile #53.692 (multiple)
"RTN","PSBO1",55,0)
 F XL1=$O(XLIST("")):1:$O(XLIST("B"),-1)  Q:+XL1=""  D
"RTN","PSBO1",56,0)
 .;*70 add"MM", "WA" rpts to accept array list of selected clinics
"RTN","PSBO1",57,0)
 .;    build reports that use Clinic search list array
"RTN","PSBO1",58,0)
 .N PSBCLN
"RTN","PSBO1",59,0)
 .F CLN="WA","DL","MM","CM","CP","CI","CE" S PSBCLN(CLN)=""
"RTN","PSBO1",60,0)
 .I ($P(XLIST(XL1),U)=PSBTYPE)!($D(PSBCLN(PSBTYPE))) D
"RTN","PSBO1",61,0)
 ..K PSBFDA,PSBRET,PSBIENX D CLEAN^DILF
"RTN","PSBO1",62,0)
 ..S PSBIENX="+"_(XL1+1)_","_PSBIENS
"RTN","PSBO1",63,0)
 ..D VAL^DIE(53.692,"+"_(XL1+1)_","_PSBIENS,.01,"F",$TR(XLIST(XL1),"^","~"),"PSBRET","PSBFDA")
"RTN","PSBO1",64,0)
 ..D UPDATE^DIE("","PSBFDA","PSBIENX","PSBRET")
"RTN","PSBO1",65,0)
 Q
"RTN","PSBO1",66,0)
 ;
"RTN","PSBO1",67,0)
CHECK ;Beginning of PSB*1*10
"RTN","PSBO1",68,0)
 K ^TMP("PSJ",$J),PSBCL                                   ;[*70-1459]
"RTN","PSBO1",69,0)
 N PSBDFN,PSBBAR,PSBDRUG,PSBFLAG,PSBPNM,PSBNDX,PSBX
"RTN","PSBO1",70,0)
 S PSBFLAG="",PSBBAR=$P($P($G(^PSB(53.69,DA,.3)),U,1),"~",2)
"RTN","PSBO1",71,0)
 S PSBDRUG=$$GET1^DIQ(53.69,DA_",",.31)
"RTN","PSBO1",72,0)
 S PSBDFN=$$GET1^DIQ(53.69,DA_",",.12,"I") S:$G(PSBDFN) PSBFLAG=1
"RTN","PSBO1",73,0)
 D EN^PSJBCMA(PSBDFN)
"RTN","PSBO1",74,0)
 ;
"RTN","PSBO1",75,0)
 F PSBX=0:0 S PSBX=$O(^TMP("PSJ",$J,PSBX)) Q:'PSBX  D
"RTN","PSBO1",76,0)
 .K Y,PSBORD,PSBPNM,PSBNDX
"RTN","PSBO1",77,0)
 .S PSBCL=$P(^TMP("PSJ",$J,PSBX,0),U,11)                         ;[*70-1459]
"RTN","PSBO1",78,0)
 .M PSBORD=^TMP("PSJ",$J,PSBX)
"RTN","PSBO1",79,0)
 .F PSBNDX=700,850,950  D
"RTN","PSBO1",80,0)
 ..F Y=0:0 S Y=$O(PSBORD(PSBNDX,Y)) Q:'Y  D
"RTN","PSBO1",81,0)
 ...I $P($G(PSBORD(1)),U,7)'="A" Q
"RTN","PSBO1",82,0)
 ...S PSBPNM=$P(PSBORD(PSBNDX,Y,0),U,1)
"RTN","PSBO1",83,0)
 ...I PSBNDX=700,PSBPNM=PSBBAR D  Q                              ;[*70-1459]
"RTN","PSBO1",84,0)
 ....S PSBFLAG=0                                                 ;[*70-1459]
"RTN","PSBO1",85,0)
 ....I PSBCL]"" S PSBCL(PSBCL)=""                                ;[*70-1459]
"RTN","PSBO1",86,0)
 ....E  S PSBCL($$GET1^DIQ(2,$P(PSBORD(0),U),.1)_" (Ward)")=""   ;[*70-1459]
"RTN","PSBO1",87,0)
 ...I PSBNDX=850,$D(^PSDRUG("A526",PSBBAR,PSBPNM)) D  Q          ;[*70-1459]
"RTN","PSBO1",88,0)
 ....S PSBFLAG=0                                                 ;[*70-1459]
"RTN","PSBO1",89,0)
 ....I PSBCL]"" S PSBCL(PSBCL)=""                                ;[*70-1459]
"RTN","PSBO1",90,0)
 ....E  S PSBCL($$GET1^DIQ(2,$P(PSBORD(0),U),.1)_" (Ward)")=""   ;[*70-1459]
"RTN","PSBO1",91,0)
 ...I PSBNDX=950,$D(^PSDRUG("A527",PSBBAR,PSBPNM)) D  Q          ;[*70-1459]
"RTN","PSBO1",92,0)
 ....S PSBFLAG=0                                                 ;[*70-1459]
"RTN","PSBO1",93,0)
 ....I PSBCL]"" S PSBCL(PSBCL)=""                                ;[*70-1459]
"RTN","PSBO1",94,0)
 ....E  S PSBCL($$GET1^DIQ(2,$P(PSBORD(0),U),.1)_" (Ward)")=""   ;[*70-1459]
"RTN","PSBO1",95,0)
 I PSBFLAG=1 D
"RTN","PSBO1",96,0)
 .W !,"Patient is not currently on medication: ",PSBDRUG
"RTN","PSBO1",97,0)
 .K DIRUT,DIR
"RTN","PSBO1",98,0)
 .S DIR("A")="Do you want to continue"
"RTN","PSBO1",99,0)
 .S DIR(0)="Y"
"RTN","PSBO1",100,0)
 .D ^DIR
"RTN","PSBO1",101,0)
 .S PSBANS=+Y W !
"RTN","PSBO1",102,0)
 Q
"RTN","PSBO1",103,0)
 ;
"RTN","PSBO1",104,0)
GETREMOV(DFN) ;Process removal type XREFS and return any RM's found with key info
"RTN","PSBO1",105,0)
 N PSBGNODE,PSBIEN
"RTN","PSBO1",106,0)
 K ^TMP("PSB",$J,"RM")
"RTN","PSBO1",107,0)
 ;
"RTN","PSBO1",108,0)
 ;Xref APATCH search
"RTN","PSBO1",109,0)
 S PSBGNODE="^PSB(53.79,"_"""APATCH"""_","_DFN_")"
"RTN","PSBO1",110,0)
 F  S PSBGNODE=$Q(@PSBGNODE) Q:PSBGNODE']""  Q:($QS(PSBGNODE,2)'="APATCH")!($QS(PSBGNODE,3)'=DFN)  D
"RTN","PSBO1",111,0)
 .S PSBIEN=$QS(PSBGNODE,5)
"RTN","PSBO1",112,0)
 .Q:'$D(^PSB(53.79,PSBIEN,.5,1))
"RTN","PSBO1",113,0)
 .Q:$P(^PSB(53.79,PSBIEN,.5,1,0),U,4)'="PATCH"
"RTN","PSBO1",114,0)
 .Q:$P(^PSB(53.79,PSBIEN,0),U,9)'="G"
"RTN","PSBO1",115,0)
 .D SETTMP     ;get remove info and save to Tmp
"RTN","PSBO1",116,0)
 ;
"RTN","PSBO1",117,0)
 ;Xref AMRR search
"RTN","PSBO1",118,0)
 S PSBGNODE="^PSB(53.79,"_"""AMRR"""_","_DFN_")"
"RTN","PSBO1",119,0)
 F  S PSBGNODE=$Q(@PSBGNODE) Q:PSBGNODE']""  Q:($QS(PSBGNODE,2)'="AMRR")!($QS(PSBGNODE,3)'=DFN)  D
"RTN","PSBO1",120,0)
 .S PSBIEN=$QS(PSBGNODE,5)
"RTN","PSBO1",121,0)
 .Q:'$D(^PSB(53.79,PSBIEN,.5,1))
"RTN","PSBO1",122,0)
 .Q:'$P(^PSB(53.79,PSBIEN,.5,1,0),U,6)
"RTN","PSBO1",123,0)
 .Q:$P(^PSB(53.79,PSBIEN,0),U,9)'="G"
"RTN","PSBO1",124,0)
 .D SETTMP     ;get remove info and save to Tmp
"RTN","PSBO1",125,0)
 Q
"RTN","PSBO1",126,0)
 ;
"RTN","PSBO1",127,0)
SETTMP(IEN) ;get and set MRR info for printing
"RTN","PSBO1",128,0)
 N RMDT,ONX
"RTN","PSBO1",129,0)
 S RMDT=$$GET1^DIQ(53.79,PSBIEN,"SCHEDULED REMOVAL TIME","I")
"RTN","PSBO1",130,0)
 S ONX=$$GET1^DIQ(53.79,PSBIEN,"ORDER REFERENCE NUMBER")
"RTN","PSBO1",131,0)
 K ^TMP("PSJ1",$J) D EN^PSJBCMA1(DFN,ONX,1)
"RTN","PSBO1",132,0)
 Q:$G(^TMP("PSJ1",$J,0))=-1
"RTN","PSBO1",133,0)
 S $P(^TMP("PSB",$J,"RM",PSBIEN),U,1)=RMDT                       ;RMDT
"RTN","PSBO1",134,0)
 S $P(^TMP("PSB",$J,"RM",PSBIEN),U,2)=ONX                        ;ONX
"RTN","PSBO1",135,0)
 S $P(^TMP("PSB",$J,"RM",PSBIEN),U,3)=$P(^TMP("PSJ1",$J,2),U,2)  ;OITX
"RTN","PSBO1",136,0)
 S $P(^TMP("PSB",$J,"RM",PSBIEN),U,4)=$P(^TMP("PSJ1",$J,1),U,10) ;OSTS
"RTN","PSBO1",137,0)
 S $P(^TMP("PSB",$J,"RM",PSBIEN),U,5)=$P(^TMP("PSJ1",$J,4),U,7)  ;OSPO
"RTN","PSBO1",138,0)
 S $P(^TMP("PSB",$J,"RM",PSBIEN),U,6)=$P(^TMP("PSJ1",$J,0),U,11) ;CLOR
"RTN","PSBO1",139,0)
 S $P(^TMP("PSB",$J,"RM",PSBIEN),U,7)=$P(^TMP("PSJ1",$J,2),U,3)  ;DOSE
"RTN","PSBO1",140,0)
 S $P(^TMP("PSB",$J,"RM",PSBIEN),U,8)=$P(^TMP("PSJ1",$J,1),U,13) ;MRNM
"RTN","PSBO1",141,0)
 S $P(^TMP("PSB",$J,"RM",PSBIEN),U,9)=$P(^TMP("PSJ1",$J,1),U,5)  ;SM
"RTN","PSBO1",142,0)
 S ^TMP("PSB",$J,"RM","B",ONX,PSBIEN)=""               ;ORDER NUM XREF
"RTN","PSBO1",143,0)
 Q
"RTN","PSBOHDR1")
0^4^B3661233^n/a
"RTN","PSBOHDR1",1,0)
PSBOHDR1 ;AITC/CR - REPORT FOR RESPIRATORY THERAPY MEDS ;7/30/18 12:32pm
"RTN","PSBOHDR1",2,0)
 ;;3.0;BAR CODE MED ADMIN;**103**;Mar 2004;Build 21
"RTN","PSBOHDR1",3,0)
 ;Per VA Directive 6402, this routine should not be modified.
"RTN","PSBOHDR1",4,0)
 ;
"RTN","PSBOHDR1",5,0)
WARD(PSBWP,PSBHDR,PSBCONT,PSBDT,SRCHTXT) ; called from PSBORT 
"RTN","PSBOHDR1",6,0)
 ; PSBWP:   Nurse Location File IEN (optional)
"RTN","PSBOHDR1",7,0)
 ; PSBHDR:  array for header
"RTN","PSBOHDR1",8,0)
 ; PSBCONT: True if this is a continuation page
"RTN","PSBOHDR1",9,0)
 ; PSBDT:   Date of Pt Information (Default to DT)
"RTN","PSBOHDR1",10,0)
 ; SRCHTXT: search text - optional
"RTN","PSBOHDR1",11,0)
 ;
"RTN","PSBOHDR1",12,0)
 N PSBMODE,PSBWRDA,Y
"RTN","PSBOHDR1",13,0)
 S:'$G(PSBDT) PSBDT=DT
"RTN","PSBOHDR1",14,0)
 I '$D(PSBHDR("DATE")) D NOW^%DTC S Y=+$E(%,1,12) D D^DIQ S PSBHDR("DATE")="Run Date: "_Y
"RTN","PSBOHDR1",15,0)
 S:'$D(PSBHDR("PAGE")) PSBHDR("PAGE")=0
"RTN","PSBOHDR1",16,0)
 ;W:$Y>1 @IOF
"RTN","PSBOHDR1",17,0)
 I $E(IOST,1,2)="C-" W !!
"RTN","PSBOHDR1",18,0)
 E  W:$Y>1 @IOF ; printout goes to a printer
"RTN","PSBOHDR1",19,0)
 W:$X>0 !
"RTN","PSBOHDR1",20,0)
 W $TR($J("",IOM)," ","=")
"RTN","PSBOHDR1",21,0)
 W !,$G(PSBHDR(0))
"RTN","PSBOHDR1",22,0)
 S PSBMODE="Include Inpatient Orders Only"
"RTN","PSBOHDR1",23,0)
 I $G(PSBHDR(0))]"" W !,PSBMODE
"RTN","PSBOHDR1",24,0)
 W $G(PSBHDR(1)),?102,PSBHDR("DATE")
"RTN","PSBOHDR1",25,0)
 I $G(PSBHDR(0))="" W !,PSBMODE
"RTN","PSBOHDR1",26,0)
 S PSBHDR("PAGE")=PSBHDR("PAGE")+1
"RTN","PSBOHDR1",27,0)
 W $G(PSBHDR(2)),?103,$J("Page: "_PSBHDR("PAGE"),10)
"RTN","PSBOHDR1",28,0)
 F X=3:1 Q:'$D(PSBHDR(X))  D
"RTN","PSBOHDR1",29,0)
 . W !,PSBHDR(X)
"RTN","PSBOHDR1",30,0)
 . I PSBHDR(X)["Clinic Search" W $$WRAP^PSBO(21,111,SRCHTXT)
"RTN","PSBOHDR1",31,0)
 . I PSBHDR(X)["Ward Location" W SRCHTXT
"RTN","PSBOHDR1",32,0)
 I $G(PSBCONT) W !?(IOM-35\2),"*** CONTINUED FROM PREVIOUS PAGE ***"
"RTN","PSBOHDR1",33,0)
 I $G(PSBMUDV)=1 S X="Division: "_PSBNAME D HDR1 Q  ; Div prompt
"RTN","PSBOHDR1",34,0)
 I $G(PSBMUDV)=2 S X="Division: "_"ALL" D HDR1 Q    ; Div prompt
"RTN","PSBOHDR1",35,0)
 I $G(PSBMUDV)=0 S X="Division: "_$$NAME^XUAF4(DUZ(2)) D HDR1 Q  ; no Div prompt, single site support
"RTN","PSBOHDR1",36,0)
 Q
"RTN","PSBOHDR1",37,0)
HDR1 ;
"RTN","PSBOHDR1",38,0)
 W !,X,!,$TR($J("",IOM)," ","=")
"RTN","PSBOHDR1",39,0)
 Q
"RTN","PSBORT")
0^2^B73550568^n/a
"RTN","PSBORT",1,0)
PSBORT ;AITC/CR - REPORT FOR RESPIRATORY THERAPY MEDS ;11/29/18 5:54am
"RTN","PSBORT",2,0)
 ;;3.0;BAR CODE MED ADMIN;**103**;Mar 2004;Build 21
"RTN","PSBORT",3,0)
 ;Per VA Directive 6402, this routine should not be modified.
"RTN","PSBORT",4,0)
 ;
"RTN","PSBORT",5,0)
 ;SLC/KB  Modified PSBOMM for Resp Therapy Meds report
"RTN","PSBORT",6,0)
 ;
"RTN","PSBORT",7,0)
 ; Reference/IA
"RTN","PSBORT",8,0)
 ; EN^PSJBCMA/2828   (private)
"RTN","PSBORT",9,0)
 ; EN^PSJBCMA2/2830  (private)
"RTN","PSBORT",10,0)
 ; ^DPT/10035        (supported)
"RTN","PSBORT",11,0)
 ;
"RTN","PSBORT",12,0)
 ;=========================================================
"RTN","PSBORT",13,0)
EN ; called from DQ^PSBO
"RTN","PSBORT",14,0)
 N PSBSTRT,PSBSTOP,DFN,PSBODATE,PSBFLAG,PSBCNT
"RTN","PSBORT",15,0)
 K ^TMP("PSJ",$J),^TMP("PSB",$J),^TMP("PSB1",$J)
"RTN","PSBORT",16,0)
 S PSBSTRT=$P(PSBRPT(.1),U,6)+$P(PSBRPT(.1),U,7)-.0000001
"RTN","PSBORT",17,0)
 S PSBSTOP=$P(PSBRPT(.1),U,6)+$P(PSBRPT(.1),U,9)
"RTN","PSBORT",18,0)
 S PSBODATE=$P(PSBRPT(.1),U,6)
"RTN","PSBORT",19,0)
 F DFN=0:0 S DFN=$O(^TMP("PSBO",$J,DFN)) Q:'DFN  D EN1
"RTN","PSBORT",20,0)
 D PRINT
"RTN","PSBORT",21,0)
 K ^TMP("PSJ",$J),^TMP("PSB",$J),^TMP("PSBO",$J)
"RTN","PSBORT",22,0)
 Q
"RTN","PSBORT",23,0)
 ;
"RTN","PSBORT",24,0)
EN1 ; expects DFN,PSBSTRT,PSBSTOP from EN
"RTN","PSBORT",25,0)
 N PSBGBL,PSBHDR,PSBX,PSBDFN,PSBDT,PSBEVDT,PSBHOUR
"RTN","PSBORT",26,0)
 K ^TMP("PSJ",$J) S PSBEVDT=PSBSTRT
"RTN","PSBORT",27,0)
 D EN^PSJBCMA(DFN,PSBSTRT)
"RTN","PSBORT",28,0)
 Q:^TMP("PSJ",$J,1,0)=-1
"RTN","PSBORT",29,0)
 S PSBX=""
"RTN","PSBORT",30,0)
 F  S PSBX=$O(^TMP("PSJ",$J,PSBX)) Q:PSBX=""  D
"RTN","PSBORT",31,0)
 .Q:^TMP("PSJ",$J,PSBX,0)=-1  ; no Orders
"RTN","PSBORT",32,0)
 .D CLEAN^PSBVT
"RTN","PSBORT",33,0)
 .D PSJ^PSBVT(PSBX)
"RTN","PSBORT",34,0)
 .; check for a respiratory therapy drug
"RTN","PSBORT",35,0)
 .Q:$$GET1^DIQ(50.7,PSBOIT,15,"I")'="Y"  ; PSBOIT set in ^PSBVT above
"RTN","PSBORT",36,0)
 .Q:PSBIVT="A"  ; No Admix or Hyp.
"RTN","PSBORT",37,0)
 .Q:PSBIVT="H"
"RTN","PSBORT",38,0)
 .I PSBIVT["S",PSBISYR'=1 Q  ;    allow intermittent syringe only
"RTN","PSBORT",39,0)
 .I PSBIVT["C",PSBCHEMT'="P",PSBISYR'=1 Q
"RTN","PSBORT",40,0)
 .I PSBIVT["C",PSBCHEMT="A" Q  ;     allow Chemo with intermittent syringe or Piggyback type only
"RTN","PSBORT",41,0)
 .Q:PSBONX["P"  ;no pending orders
"RTN","PSBORT",42,0)
 .I PSBSCHT="C" D  Q  ; Only Continuous
"RTN","PSBORT",43,0)
 ..S (PSBYES,PSBODD)=0
"RTN","PSBORT",44,0)
 ..S PSBDOW="SU^MO^TU^WE^TH^FR^SA" F I=1:1:7 I $P(PSBDOW,"^",I)=$E(PSBSCH,1,2) S PSBYES=1
"RTN","PSBORT",45,0)
 ..I PSBYES,PSBADST="" Q
"RTN","PSBORT",46,0)
 ..F I=1:1 Q:$P(PSBSCH,"-",I)=""  I $P(PSBSCH,"-",I)?2N!($P(PSBSCH,"-",I)?4N) S PSBYES=1
"RTN","PSBORT",47,0)
 ..S PSBFREQ=$$GETFREQ^PSBVDLU1(DFN,PSBONX)
"RTN","PSBORT",48,0)
 ..I PSBFREQ="O" S PSBYES=1
"RTN","PSBORT",49,0)
 ..I 'PSBYES,PSBADST="",PSBFREQ<1 Q
"RTN","PSBORT",50,0)
 ..I (PSBFREQ#1440'=0),(1440#PSBFREQ'=0) S PSBODD=1
"RTN","PSBORT",51,0)
 ..I PSBODD,PSBADST'="" Q
"RTN","PSBORT",52,0)
 ..Q:PSBOSTS["D"  ;discontinued
"RTN","PSBORT",53,0)
 ..Q:PSBNGF  ; marked DO NOT GIVE
"RTN","PSBORT",54,0)
 ..Q:PSBOSTS="N"
"RTN","PSBORT",55,0)
 ..Q:PSBSM  ;Self med
"RTN","PSBORT",56,0)
 ..S PSBCADM=0
"RTN","PSBORT",57,0)
 ..I PSBADST="" S PSBADST=$$GETADMIN^PSBVDLU1(DFN,PSBONX,PSBOST,PSBFREQ,PSBEVDT) Q:PSBADST=""  S PSBCADM=1
"RTN","PSBORT",58,0)
 ..E  K ^TMP("PSB",$J,"GETADMIN") S ^TMP("PSB",$J,"GETADMIN",0)=PSBADST
"RTN","PSBORT",59,0)
 ..; invalid admin times
"RTN","PSBORT",60,0)
 ..F Y=1:1:$L(PSBADST,"-") D
"RTN","PSBORT",61,0)
 ...Q:($P(PSBADST,"-",Y)'?2N)&($P(PSBADST,"-",Y)'?4N)
"RTN","PSBORT",62,0)
 ..; below is (Order Start Date, Report Date, Schedule)
"RTN","PSBORT",63,0)
 ..Q:'$$OKAY^PSBVDLU1(PSBOST,PSBODATE,PSBSCH,PSBONX,$P(^TMP("PSJ",$J,PSBX,3),U,2),PSBFREQ,PSBOSTS)  ; Screens QOD type stuff
"RTN","PSBORT",64,0)
 ..K PSBOACTL,TMP("PSB1",$J) D EN^PSJBCMA2(DFN,PSBONX,1) I ^TMP("PSJ2",$J,0)'=1 M PSBOACTL=^TMP("PSJ2",$J) K ^TMP("PSJ2",$J)
"RTN","PSBORT",65,0)
 ..F PSBXX=0:1 Q:'$D(^TMP("PSB",$J,"GETADMIN",PSBXX))  S PSBADST=$G(^TMP("PSB",$J,"GETADMIN",PSBXX)) D
"RTN","PSBORT",66,0)
 ...F Y=1:1:$L(PSBADST,"-") D
"RTN","PSBORT",67,0)
 ....S PSBDT=+("."_$P(PSBADST,"-",Y))+(PSBSTRT\1)
"RTN","PSBORT",68,0)
 ....Q:PSBDT<PSBOST   ; order Start Date
"RTN","PSBORT",69,0)
 ....Q:PSBDT'<PSBOSP  ; order Stop Date
"RTN","PSBORT",70,0)
 ....Q:PSBDT<PSBSTRT  ; report Window
"RTN","PSBORT",71,0)
 ....Q:PSBDT>PSBSTOP  ; report Window
"RTN","PSBORT",72,0)
 ....I $D(^PSB(53.79,"AORD",DFN,PSBONX,PSBDT)) D  I PSBSTUS'="N",PSBSTUS'="M" Q  ; if it is on the log quit, continue if status is "NOT GIVEN" or "MISSING"
"RTN","PSBORT",73,0)
 .....S PSBINDX=$O(^PSB(53.79,"AORD",DFN,PSBONX,PSBDT,"")),PSBSTUS=$P(^PSB(53.79,PSBINDX,0),U,9)
"RTN","PSBORT",74,0)
 ....S ^TMP("PSB",$J,DFN,PSBDT,PSBOITX,PSBONX)=""
"RTN","PSBORT",75,0)
 ....D UDCONT
"RTN","PSBORT",76,0)
 ....I PSBFLAG=1 S ^TMP("PSB",$J,DFN,PSBDT,PSBOITX,PSBONX)="(On Hold) "_$$FMTE^XLFDT(PSBHDDT)
"RTN","PSBORT",77,0)
 ....I PSBFLAG=2 S ^TMP("PSB",$J,DFN,PSBDT,PSBOITX,PSBONX)="(On Hold) "_$$FMTE^XLFDT(PSBHDDT)_"  "_"(Off Hold) "_$$FMTE^XLFDT(PSBUNHD) Q
"RTN","PSBORT",78,0)
 .K PSBHDDT,PSBUNHD,^TMP("PSB1",$J)
"RTN","PSBORT",79,0)
 .I PSBSCHT="O" D  Q
"RTN","PSBORT",80,0)
 ..Q:PSBOSTS["D"!(PSBOSTS="N")  ; discontinued
"RTN","PSBORT",81,0)
 ..Q:PSBNGF  ; Marked DO NOT GIVE
"RTN","PSBORT",82,0)
 ..Q:PSBSM  ;self med
"RTN","PSBORT",83,0)
 ..; is the One Time Given?
"RTN","PSBORT",84,0)
 ..Q:PSBOSP=PSBOST   ;expired one-time
"RTN","PSBORT",85,0)
 ..Q:PSBOST'<PSBSTOP
"RTN","PSBORT",86,0)
 ..Q:PSBOSP<PSBSTRT
"RTN","PSBORT",87,0)
 ..S (PSBGVN,X,Y)=""
"RTN","PSBORT",88,0)
 ..F  S X=$O(^PSB(53.79,"AOIP",DFN,PSBOIT,X),-1) Q:'X  D
"RTN","PSBORT",89,0)
 ...F  S Y=$O(^PSB(53.79,"AOIP",DFN,PSBOIT,X,Y),-1) Q:'Y  D
"RTN","PSBORT",90,0)
 ....I $P(^PSB(53.79,Y,.1),U)=PSBONX,$P(^PSB(53.79,Y,0),U,9)'="N",$P(^PSB(53.79,Y,0),U,9)'="M" S PSBGVN=1,(X,Y)=0
"RTN","PSBORT",91,0)
 ..; how long does One Time remain on the this report ??
"RTN","PSBORT",92,0)
 ..D NOW^%DTC
"RTN","PSBORT",93,0)
 ..S PSBRMN=1
"RTN","PSBORT",94,0)
 ..I PSBSCHT="O",PSBOSP'=PSBOST&(%>PSBOSP) S PSBRMN=0
"RTN","PSBORT",95,0)
 ..D:('PSBGVN)&(PSBRMN)
"RTN","PSBORT",96,0)
 ...S VAR=""
"RTN","PSBORT",97,0)
 ...K ^TMP("PSJ2",$J),^TMP("PSB1",$J),PSBOACTL D EN^PSJBCMA2(DFN,PSBONX,1) I ^TMP("PSJ2",$J,0)'=1 D
"RTN","PSBORT",98,0)
 ....M PSBOACTL=^TMP("PSJ2",$J)
"RTN","PSBORT",99,0)
 ....D UDONE
"RTN","PSBORT",100,0)
 ....I PSBFLAG=1 S VAR="(On Hold) "_$$FMTE^XLFDT(PSBHDDT)
"RTN","PSBORT",101,0)
 ....I PSBFLAG=2 S VAR="(On Hold) "_$$FMTE^XLFDT(PSBHDDT)_"  (Off Hold) "_$$FMTE^XLFDT(PSBUNHD)
"RTN","PSBORT",102,0)
 ...S VAR=VAR_U_$TR($$FMTE^XLFDT(PSBOST,2),"@"," ")
"RTN","PSBORT",103,0)
 ...S VAR=VAR_U_$TR($$FMTE^XLFDT(PSBOSP,2),"@"," ")
"RTN","PSBORT",104,0)
 ...S $P(^TMP("PSB",$J,DFN,"*** ONE-TIME ***",PSBOITX,PSBONX),U,1,4)=VAR
"RTN","PSBORT",105,0)
 ...K PSBHDDT,PSBUNHD,^TMP("PSB1",$J),PSBCNT
"RTN","PSBORT",106,0)
 K PSBOACTL
"RTN","PSBORT",107,0)
 Q
"RTN","PSBORT",108,0)
 ;
"RTN","PSBORT",109,0)
PRINT ; print meds stored in ^TMP("PSB",$J,DFN,....
"RTN","PSBORT",110,0)
 N DFN,PSBHDR,PSBDT,PSBOITX,PSBONX,WARDIEN
"RTN","PSBORT",111,0)
 ; print by Ward
"RTN","PSBORT",112,0)
 D:$P(PSBRPT(.1),U,1)="W"
"RTN","PSBORT",113,0)
 .S PSBHDR(1)="RESPIRATORY THERAPY MEDICATIONS  from "_$$FMTE^XLFDT($P(PSBRPT(.1),U,6)+$P(PSBRPT(.1),U,7))_" thru "_$$FMTE^XLFDT($P(PSBRPT(.1),U,6)+$P(PSBRPT(.1),U,9))
"RTN","PSBORT",114,0)
 .S WARDIEN=$P(PSBRPT(.1),U,3) ; WARD ien from #211.4
"RTN","PSBORT",115,0)
 .I $G(FLAGPRT(WARDIEN))=1 Q  ; don't print duplicate wards
"RTN","PSBORT",116,0)
 .W $$WRDHDR()
"RTN","PSBORT",117,0)
 .I '$O(^TMP("PSB",$J,0)) W !,"No Medications Found" Q
"RTN","PSBORT",118,0)
 .S PSBSORT=$P(PSBRPT(.1),U,5)
"RTN","PSBORT",119,0)
 .F DFN=0:0 S DFN=$O(^TMP("PSB",$J,DFN)) Q:'DFN  D
"RTN","PSBORT",120,0)
 ..S PSBINDX=$S(PSBSORT="P":$P(^DPT(DFN,0),U),1:$G(^DPT(DFN,.1))_" "_$G(^(.101)))
"RTN","PSBORT",121,0)
 ..S:PSBINDX="" PSBINDX=$P(^DPT(DFN,0),U)
"RTN","PSBORT",122,0)
 ..S ^TMP("PSB",$J,"B",PSBINDX,DFN)=""
"RTN","PSBORT",123,0)
 .S PSBINDX=""
"RTN","PSBORT",124,0)
 .F  S PSBINDX=$O(^TMP("PSB",$J,"B",PSBINDX)) Q:PSBINDX=""  D
"RTN","PSBORT",125,0)
 ..F DFN=0:0 S DFN=$O(^TMP("PSB",$J,"B",PSBINDX,DFN)) Q:'DFN  D
"RTN","PSBORT",126,0)
 ...W ! ; line break between patients
"RTN","PSBORT",127,0)
 ...S PSBDT=""
"RTN","PSBORT",128,0)
 ...F  S PSBDT=$O(^TMP("PSB",$J,DFN,PSBDT)) Q:PSBDT=""  D
"RTN","PSBORT",129,0)
 ....;W !  ; line break between admin times, double-spacing of output
"RTN","PSBORT",130,0)
 ....S PSBOITX=""
"RTN","PSBORT",131,0)
 ....F  S PSBOITX=$O(^TMP("PSB",$J,DFN,PSBDT,PSBOITX)) Q:PSBOITX=""  D
"RTN","PSBORT",132,0)
 .....S PSBONX=""
"RTN","PSBORT",133,0)
 .....F  S PSBONX=$O(^TMP("PSB",$J,DFN,PSBDT,PSBOITX,PSBONX)) Q:PSBONX=""  D
"RTN","PSBORT",134,0)
 ......;I $Y>(IOSL-5) W $$WRDHDR()
"RTN","PSBORT",135,0)
 ......W !,+PSBONX,$S(PSBONX["U":"UD",PSBONX["V":"IV",1:"")
"RTN","PSBORT",136,0)
 ......W ?10,$G(^DPT(DFN,.101),"**")
"RTN","PSBORT",137,0)
 ......W ?30,$P(^DPT(DFN,0),U)," (",$E($P(^(0),U,9),6,9),")"
"RTN","PSBORT",138,0)
 ......I PSBDT["ONE-TIME" D  Q
"RTN","PSBORT",139,0)
 .......W !,PSBDT,?30,PSBOITX," ",$P(^TMP("PSB",$J,DFN,PSBDT,PSBOITX,PSBONX),U,1)
"RTN","PSBORT",140,0)
 .......W !,"Start Date/Time:  ",?30,$P(^TMP("PSB",$J,DFN,PSBDT,PSBOITX,PSBONX),U,2)
"RTN","PSBORT",141,0)
 .......W !,"Stop Date/Time:  ",?30,$P(^TMP("PSB",$J,DFN,PSBDT,PSBOITX,PSBONX),U,3)
"RTN","PSBORT",142,0)
 .......;W !  ; stop double space
"RTN","PSBORT",143,0)
 ......W ?74,$S(PSBDT:$$FMTE^XLFDT(PSBDT,2),1:PSBDT),?90,PSBOITX
"RTN","PSBORT",144,0)
 ......S FLAGPRT(WARDIEN)=1 ; track wards that have been printed
"RTN","PSBORT",145,0)
 ......I $E(IOST,1,2)="C-" S $Y=2  ;keep screen display for wards evenly spaced, no effect on a printer
"RTN","PSBORT",146,0)
 Q
"RTN","PSBORT",147,0)
 ;
"RTN","PSBORT",148,0)
WRDHDR() ; ward header
"RTN","PSBORT",149,0)
 D WARD^PSBOHDR1(PSBWRD,.PSBHDR)
"RTN","PSBORT",150,0)
 W !,"Ord Num",?10,"Room-Bed",?30,"Patient",?74,"Admin Date/Time",?90,"Medication"
"RTN","PSBORT",151,0)
 W !,$TR($J("",IOM)," ","-")
"RTN","PSBORT",152,0)
 Q ""
"RTN","PSBORT",153,0)
 ;
"RTN","PSBORT",154,0)
UDCONT ;
"RTN","PSBORT",155,0)
 S PSBFLAG=0,J=1
"RTN","PSBORT",156,0)
 K ^TMP("PSB1",$J)
"RTN","PSBORT",157,0)
 F I=1:1:$P(PSBOACTL(0),U,4) D
"RTN","PSBORT",158,0)
 . I $P($G(PSBOACTL(I,1)),U,4)["ON HOLD"!($P($G(PSBOACTL(I,1)),U,4)="HOLD") S ^TMP("PSB1",$J,DFN,J)="HOLD"_U_$E($P($G(PSBOACTL(I,1)),U,1),1,12)
"RTN","PSBORT",159,0)
 . I $P($G(PSBOACTL(I,1)),U,4)["TAKEN OFF HOLD"!($P($G(PSBOACTL(I,1)),U,4)["UNHOLD") S $P(^TMP("PSB1",$J,DFN,J),U,3)="OFF HOLD"_U_$E($P($G(PSBOACTL(I,1)),U,1),1,12),J=J+1
"RTN","PSBORT",160,0)
 D:$D(^TMP("PSB1",$J,DFN))&($P(PSBOACTL(0),U,4)'=1)
"RTN","PSBORT",161,0)
 .S J=0 F  S J=$O(^TMP("PSB1",$J,DFN,J)) Q:'J  Q:PSBFLAG  D
"RTN","PSBORT",162,0)
 ..S PSBHDDT=$P(^TMP("PSB1",$J,DFN,J),U,2)
"RTN","PSBORT",163,0)
 ..S PSBHDST=$P(^TMP("PSB1",$J,DFN,J),U)
"RTN","PSBORT",164,0)
 ..S PSBOFDT=$P(^TMP("PSB1",$J,DFN,J),U,4)
"RTN","PSBORT",165,0)
 ..S PSBOFST=$P(^TMP("PSB1",$J,DFN,J),U,3)
"RTN","PSBORT",166,0)
 ..I PSBDT>PSBHDDT,PSBHDST="HOLD",PSBOFST'="" I PSBDT<PSBOFDT,PSBOFST="OFF HOLD" S PSBFLAG=2,PSBUNHD=PSBOFDT
"RTN","PSBORT",167,0)
 ..I PSBDT>PSBHDDT,PSBHDST="HOLD",PSBOFST="" S PSBFLAG=1
"RTN","PSBORT",168,0)
 K PSBCNT,TMP("PSB1",$J)
"RTN","PSBORT",169,0)
 Q
"RTN","PSBORT",170,0)
 ;
"RTN","PSBORT",171,0)
UDONE ;
"RTN","PSBORT",172,0)
 S PSBFLAG=0,J=1
"RTN","PSBORT",173,0)
 F I=1:1:$P(PSBOACTL(0),U,4) D
"RTN","PSBORT",174,0)
 .I $P($G(PSBOACTL(I,1)),U,4)["ON HOLD"!($P($G(PSBOACTL(I,1)),U,4)="HOLD") S ^TMP("PSB1",$J,DFN,J)="HOLD"_U_$E($P($G(PSBOACTL(I,1)),U,1),1,12)
"RTN","PSBORT",175,0)
 .I $P($G(PSBOACTL(I,1)),U,4)["TAKEN OFF HOLD"!($P($G(PSBOACTL(I,1)),U,4)["UNHOLD") S $P(^TMP("PSB1",$J,DFN,J),U,3)="OFF HOLD"_U_$E($P($G(PSBOACTL(I,1)),U,1),1,12),J=J+1
"RTN","PSBORT",176,0)
 D:$D(^TMP("PSB1",$J,DFN))&($P(PSBOACTL(0),U,4)'=1)
"RTN","PSBORT",177,0)
 .S J="" F  S J=$O(^TMP("PSB1",$J,DFN,J)) Q:'J  Q:PSBFLAG  D
"RTN","PSBORT",178,0)
 ..S PSBHDDT=$P(^TMP("PSB1",$J,DFN,J),U,2)
"RTN","PSBORT",179,0)
 ..S PSBHDST=$P(^TMP("PSB1",$J,DFN,J),U)
"RTN","PSBORT",180,0)
 ..S PSBOFDT=$P(^TMP("PSB1",$J,DFN,J),U,4)
"RTN","PSBORT",181,0)
 ..S PSBOFST=$P(^TMP("PSB1",$J,DFN,J),U,3)
"RTN","PSBORT",182,0)
 ..I PSBOSTS="A",PSBHDST="HOLD",PSBOFST'="",'$D(^TMP("PSB1",$J,DFN,J+1)) I PSBSTOP>PSBOFDT,PSBOFST="OFF HOLD" S PSBFLAG=2,PSBUNHD=PSBOFDT
"RTN","PSBORT",183,0)
 ..I PSBOSTS="A",PSBHDST="HOLD",PSBOFST'="",PSBOFDT'<PSBSTOP S PSBFLAG=1
"RTN","PSBORT",184,0)
 ..I PSBOSTS="H",PSBHDST="HOLD",'$D(^TMP("PSB1",$J,DFN,J+1)) S PSBFLAG=1
"RTN","PSBORT",185,0)
 K PSBCNT,^TMP("PSB1",$J)
"RTN","PSBORT",186,0)
 Q
"VER")
8.0^22.2
"BLD",10519,6)
^93
**END**
**END**

