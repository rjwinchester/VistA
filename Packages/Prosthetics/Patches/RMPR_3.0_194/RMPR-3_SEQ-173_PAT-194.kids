Released RMPR*3*194 SEQ #173
Extracted from mail message
**KIDS**:RMPR*3.0*194^

**INSTALL NAME**
RMPR*3.0*194
"BLD",11011,0)
RMPR*3.0*194^PROSTHETICS^0^3180419^y
"BLD",11011,1,0)
^^6^6^3180418^
"BLD",11011,1,1,0)
This patch addresses 2 issues:
"BLD",11011,1,2,0)
1. The Lot Number entry is being put in the Description (#24) field in 
"BLD",11011,1,3,0)
the file RECORD OF PROS APP (#660).
"BLD",11011,1,4,0)
2. When a record in the file RECORD OF PROS APP (#660) does not have a 
"BLD",11011,1,5,0)
suspense date it receives a subscript error in the option View 
"BLD",11011,1,6,0)
Prosthetics Item Transactions [RMPR VIEW 2319 READ ONLY].
"BLD",11011,4,0)
^9.64PA^^
"BLD",11011,6.3)
5
"BLD",11011,"ABPKG")
n
"BLD",11011,"KRN",0)
^9.67PA^779.2^20
"BLD",11011,"KRN",.4,0)
.4
"BLD",11011,"KRN",.401,0)
.401
"BLD",11011,"KRN",.402,0)
.402
"BLD",11011,"KRN",.403,0)
.403
"BLD",11011,"KRN",.5,0)
.5
"BLD",11011,"KRN",.84,0)
.84
"BLD",11011,"KRN",3.6,0)
3.6
"BLD",11011,"KRN",3.8,0)
3.8
"BLD",11011,"KRN",9.2,0)
9.2
"BLD",11011,"KRN",9.8,0)
9.8
"BLD",11011,"KRN",9.8,"NM",0)
^9.68A^2^2
"BLD",11011,"KRN",9.8,"NM",1,0)
RMPR4M^^0^B35332645
"BLD",11011,"KRN",9.8,"NM",2,0)
RMPOPAT3^^0^B39792529
"BLD",11011,"KRN",9.8,"NM","B","RMPOPAT3",2)

"BLD",11011,"KRN",9.8,"NM","B","RMPR4M",1)

"BLD",11011,"KRN",19,0)
19
"BLD",11011,"KRN",19.1,0)
19.1
"BLD",11011,"KRN",101,0)
101
"BLD",11011,"KRN",409.61,0)
409.61
"BLD",11011,"KRN",771,0)
771
"BLD",11011,"KRN",779.2,0)
779.2
"BLD",11011,"KRN",870,0)
870
"BLD",11011,"KRN",8989.51,0)
8989.51
"BLD",11011,"KRN",8989.52,0)
8989.52
"BLD",11011,"KRN",8994,0)
8994
"BLD",11011,"KRN","B",.4,.4)

"BLD",11011,"KRN","B",.401,.401)

"BLD",11011,"KRN","B",.402,.402)

"BLD",11011,"KRN","B",.403,.403)

"BLD",11011,"KRN","B",.5,.5)

"BLD",11011,"KRN","B",.84,.84)

"BLD",11011,"KRN","B",3.6,3.6)

"BLD",11011,"KRN","B",3.8,3.8)

"BLD",11011,"KRN","B",9.2,9.2)

"BLD",11011,"KRN","B",9.8,9.8)

"BLD",11011,"KRN","B",19,19)

"BLD",11011,"KRN","B",19.1,19.1)

"BLD",11011,"KRN","B",101,101)

"BLD",11011,"KRN","B",409.61,409.61)

"BLD",11011,"KRN","B",771,771)

"BLD",11011,"KRN","B",779.2,779.2)

"BLD",11011,"KRN","B",870,870)

"BLD",11011,"KRN","B",8989.51,8989.51)

"BLD",11011,"KRN","B",8989.52,8989.52)

"BLD",11011,"KRN","B",8994,8994)

"BLD",11011,"QDEF")
^^^^^^^^^^YES
"BLD",11011,"QUES",0)
^9.62^^
"BLD",11011,"REQB",0)
^9.611^2^2
"BLD",11011,"REQB",1,0)
RMPR*3.0*189^1
"BLD",11011,"REQB",2,0)
RMPR*3.0*182^1
"BLD",11011,"REQB","B","RMPR*3.0*182",2)

"BLD",11011,"REQB","B","RMPR*3.0*189",1)

"MBREQ")
0
"PKG",280,-1)
1^1
"PKG",280,0)
PROSTHETICS^RMPR^PROSTHETICS VERSION 3.0 ALPHA
"PKG",280,20,0)
^9.402P^^0
"PKG",280,22,0)
^9.49I^1^1
"PKG",280,22,1,0)
3.0^2960209^2970624
"PKG",280,22,1,"PAH",1,0)
194^3180419
"PKG",280,22,1,"PAH",1,1,0)
^^6^6^3180419
"PKG",280,22,1,"PAH",1,1,1,0)
This patch addresses 2 issues:
"PKG",280,22,1,"PAH",1,1,2,0)
1. The Lot Number entry is being put in the Description (#24) field in 
"PKG",280,22,1,"PAH",1,1,3,0)
the file RECORD OF PROS APP (#660).
"PKG",280,22,1,"PAH",1,1,4,0)
2. When a record in the file RECORD OF PROS APP (#660) does not have a 
"PKG",280,22,1,"PAH",1,1,5,0)
suspense date it receives a subscript error in the option View 
"PKG",280,22,1,"PAH",1,1,6,0)
Prosthetics Item Transactions [RMPR VIEW 2319 READ ONLY].
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
2
"RTN","RMPOPAT3")
0^2^B39792529^B39179406
"RTN","RMPOPAT3",1,0)
RMPOPAT3 ;HINES-CIOFO/RVD-Detail Display Patient 10-2319 Transaction;11/04/04
"RTN","RMPOPAT3",2,0)
 ;;3.0;PROSTHETICS;**70,92,99,182,194**;Feb 09, 1996;Build 5
"RTN","RMPOPAT3",3,0)
 ;
"RTN","RMPOPAT3",4,0)
 ; RVD 7/8/02 patch #70 - this routine is a copy of RMPRPAT3.
"RTN","RMPOPAT3",5,0)
 ;                        For Read Only 2319.
"RTN","RMPOPAT3",6,0)
 ; AAC 08/03/04 Patch 92 - Code Set Versioning (CSV) 
"RTN","RMPOPAT3",7,0)
 ;Used API=ICDDX^ICDCODE to replace direct calls to global ICD9(80).
"RTN","RMPOPAT3",8,0)
 ;
"RTN","RMPOPAT3",9,0)
 ;DBIA # 10082 - file #80, global read.
"RTN","RMPOPAT3",10,0)
 ;
"RTN","RMPOPAT3",11,0)
 ;RMPR*3.0*182 Modified system to be able to pull the 
"RTN","RMPOPAT3",12,0)
 ;             ext code and description for ICD10.
"RTN","RMPOPAT3",13,0)
 ;
"RTN","RMPOPAT3",14,0)
 ;expect ANS,IT(ANS)
"RTN","RMPOPAT3",15,0)
 ;          +IT(ANS)=ien of file 660
"RTN","RMPOPAT3",16,0)
 ;expect variables from GETPAT^RMPRUTIL
"RTN","RMPOPAT3",17,0)
 ;    RMPRSSNE (external form of SSN)
"RTN","RMPOPAT3",18,0)
 ;    RMPRNAM (name of patient)
"RTN","RMPOPAT3",19,0)
 ;    RMPRDOB
"RTN","RMPOPAT3",20,0)
 ;display detailed record
"RTN","RMPOPAT3",21,0)
PRINT ;called from RMPOPAT2
"RTN","RMPOPAT3",22,0)
 ;get 2319 transaction
"RTN","RMPOPAT3",23,0)
 ;
"RTN","RMPOPAT3",24,0)
 N DIC,DIQ,DR,DA,RMPRV,RMPRDA,RV
"RTN","RMPOPAT3",25,0)
 S DIC=660,DIQ="R19",DR=".01:96",DIQ(0)="EN"
"RTN","RMPOPAT3",26,0)
 S (RMPRDA,DA)=+IT(ANS)
"RTN","RMPOPAT3",27,0)
 D EN^DIQ1
"RTN","RMPOPAT3",28,0)
 S DIQ="R19",DR=72,DIQ(0)="I" D EN^DIQ1
"RTN","RMPOPAT3",29,0)
 ;get vendor info
"RTN","RMPOPAT3",30,0)
 S DA=$P(^RMPR(660,RMPRDA,0),U,9)
"RTN","RMPOPAT3",31,0)
 I DA D
"RTN","RMPOPAT3",32,0)
 .S DIC=440,DIQ="RV",DR=".01:6",DIQ(0)="EN"
"RTN","RMPOPAT3",33,0)
 .S (RMPRV,DA)=$P(^RMPR(660,RMPRDA,0),U,9)
"RTN","RMPOPAT3",34,0)
 .D EN^DIQ1
"RTN","RMPOPAT3",35,0)
 ;
"RTN","RMPOPAT3",36,0)
 ;array defined for record in following format:
"RTN","RMPOPAT3",37,0)
 ;R19(filenumber,ien,field,E)=external form of data
"RTN","RMPOPAT3",38,0)
 ;RV(filenumber,ien,field,E)=external form of data
"RTN","RMPOPAT3",39,0)
 ;example
"RTN","RMPOPAT3",40,0)
 ;R19(660,100,.01,"E")=APR 27, 1995
"RTN","RMPOPAT3",41,0)
 ;R19(660,100,.02,"E")=FUDGE,CHOCOLATE
"RTN","RMPOPAT3",42,0)
 ;RV(440,131,.01,"E")=ORTHOTIC LAB
"RTN","RMPOPAT3",43,0)
 ;
"RTN","RMPOPAT3",44,0)
 D HDR
"RTN","RMPOPAT3",45,0)
 W !,"TYPE OF FORM: ",$G(R19(660,RMPRDA,11,"E"))
"RTN","RMPOPAT3",46,0)
 W ?25,"INITIATOR: ",$G(R19(660,RMPRDA,27,"E"))
"RTN","RMPOPAT3",47,0)
 ;historical item
"RTN","RMPOPAT3",48,0)
 W !,"ITEM DESCRIPTION: ",$G(R19(660,RMPRDA,89,"E"))
"RTN","RMPOPAT3",49,0)
 W ?55,"DATE: ",$G(R19(660,RMPRDA,1,"E"))
"RTN","RMPOPAT3",50,0)
 W !,"DELIVER TO: ",$G(R19(660,RMPRDA,25,"E"))
"RTN","RMPOPAT3",51,0)
 W !,"TYPE TRANS: ",$G(R19(660,RMPRDA,2,"E"))
"RTN","RMPOPAT3",52,0)
 W ?30,"QTY: ",$G(R19(660,RMPRDA,5,"E"))
"RTN","RMPOPAT3",53,0)
 W:$G(R19(660,RMPRDA,29,"E")) ?40,"INVENTORY POINT: ",R19(660,RMPRDA,29,"E"),!
"RTN","RMPOPAT3",54,0)
 W ?40,"SOURCE: ",$G(R19(660,RMPRDA,12,"E"))
"RTN","RMPOPAT3",55,0)
 ;vendor tracking number
"RTN","RMPOPAT3",56,0)
 I $G(R19(660,RMPRDA,11,"E"))="VISA" D
"RTN","RMPOPAT3",57,0)
 .W !,"VENDOR TRACKING: ",$G(R19(660,RMPRDA,4.2,"E"))
"RTN","RMPOPAT3",58,0)
 .W ?38,"BANK AUTHORIZATION: ",$G(R19(660,RMPRDA,4.3,"E"))
"RTN","RMPOPAT3",59,0)
 W !,"VENDOR: ",?15,$G(R19(660,RMPRDA,7,"E"))
"RTN","RMPOPAT3",60,0)
 I $D(RV) D
"RTN","RMPOPAT3",61,0)
 .W !?15,$G(RV(440,RMPRV,1,"E"))
"RTN","RMPOPAT3",62,0)
 .W !?15,$G(RV(440,RMPRV,4.2,"E")),","
"RTN","RMPOPAT3",63,0)
 .W ?$X+3,$G(RV(440,RMPRV,4.4,"E")),?$X+5,$G(RV(440,RMPRV,4.6,"E"))
"RTN","RMPOPAT3",64,0)
 W !,"DELIVERY DATE: "
"RTN","RMPOPAT3",65,0)
 I $D(R19(660,RMPRDA,10,"E")) W R19(660,RMPRDA,10,"E")
"RTN","RMPOPAT3",66,0)
 W !
"RTN","RMPOPAT3",67,0)
 I '$P(IT(AN),U,3) D
"RTN","RMPOPAT3",68,0)
 .W "TOTAL COST: "
"RTN","RMPOPAT3",69,0)
 .I $G(R19(660,RMPRDA,14,"E"))'="" W "$"_$J(R19(660,RMPRDA,14,"E"),2)
"RTN","RMPOPAT3",70,0)
 .I $G(R19(660,RMPRDA,14,"E"))="" W $S($G(R19(660,RMPRDA,6,"E"))'="":"$"_$J(R19(660,RMPRDA,6,"E"),2),$G(R19(660,RMPRDA,48,"E"))'="":"$"_$J(R19(660,RMPRDA,48,"E"),2),1:"")
"RTN","RMPOPAT3",71,0)
 ;
"RTN","RMPOPAT3",72,0)
 ;lab data
"RTN","RMPOPAT3",73,0)
 I $D(^RMPR(660,RMPRDA,"LB")) D
"RTN","RMPOPAT3",74,0)
 .N DIC,DIQ,DR,L19,DA
"RTN","RMPOPAT3",75,0)
 .S (DA,RMPRLA)=$P(^RMPR(660,RMPRDA,"LB"),U,10)
"RTN","RMPOPAT3",76,0)
 .Q:DA=""
"RTN","RMPOPAT3",77,0)
 .S DIC=664.1,DIQ="L19",DR="15",DIQ(0)="E"
"RTN","RMPOPAT3",78,0)
 .D EN^DIQ1
"RTN","RMPOPAT3",79,0)
 .W !,"WORK ORDER: ",$G(R19(660,RMPRDA,71,"E"))
"RTN","RMPOPAT3",80,0)
 .W ?40,"RECEIVING STATION: ",$G(R19(660,RMPRDA,70,"E"))
"RTN","RMPOPAT3",81,0)
 .W !,"TECHNICIAN: ",$G(L19(664.1,RMPRLA,15,"E"))
"RTN","RMPOPAT3",82,0)
 .W !,"TOTAL LABOR HOURS: ",$G(R19(660,RMPRDA,45,"E"))
"RTN","RMPOPAT3",83,0)
 .W ?40,"TOTAL LABOR COST: ",$G(R19(660,RMPRDA,46,"E"))
"RTN","RMPOPAT3",84,0)
 .W !,"TOTAL MATERIAL COST: ",$G(R19(660,RMPRDA,47,"E"))
"RTN","RMPOPAT3",85,0)
 .W ?40,"TOTAL LAB COST: ",$G(R19(660,RMPRDA,48,"E"))
"RTN","RMPOPAT3",86,0)
 .W !,"COMPLETION DATE: ",$G(R19(660,RMPRDA,50,"E"))
"RTN","RMPOPAT3",87,0)
 .W ?40,"LAB REMARKS: ",$G(R19(660,RMPRDA,51,"E"))
"RTN","RMPOPAT3",88,0)
 W !,"REMARKS: ",?15,$G(R19(660,RMPRDA,16,"E"))
"RTN","RMPOPAT3",89,0)
 I $G(R19(660,RMPRDA,17.5,"E")) W ?40,"RETURN STATUS: ",R19(660,RMPRDA,17.5,"E")
"RTN","RMPOPAT3",90,0)
 ;
"RTN","RMPOPAT3",91,0)
 ;historical data
"RTN","RMPOPAT3",92,0)
 I $G(R19(660,RMPRDA,15,"E"))["*" D
"RTN","RMPOPAT3",93,0)
 .;include records that have been merged
"RTN","RMPOPAT3",94,0)
 .W !!,"HISTORICAL DATA",!
"RTN","RMPOPAT3",95,0)
 .Q:'$D(R19(660,RMPRDA,89))
"RTN","RMPOPAT3",96,0)
 .W !,?15,"ITEM: ",$G(R19(660,RMPRDA,89,"E"))
"RTN","RMPOPAT3",97,0)
 .W !,?15,"STATION: ",$G(R19(660,RMPRDA,90,"E"))
"RTN","RMPOPAT3",98,0)
 .W !,?15,"VENDOR: ",$G(R19(660,RMPRDA,91,"E"))
"RTN","RMPOPAT3",99,0)
 .W !,?23,$G(R19(660,RMPRDA,93,"E")),!,?23,$G(R19(660,RMPRDA,94,"E"))
"RTN","RMPOPAT3",100,0)
 .W "   ",$G(R19(660,RMPRDA,95,"E")),"  ",$G(R19(660,RMPRDA,96,"E"))
"RTN","RMPOPAT3",101,0)
 ;put in lab display here fields 45,46,47,48 and 51
"RTN","RMPOPAT3",102,0)
 ;lab amis
"RTN","RMPOPAT3",103,0)
 I $G(R19(660,RMPRDA,73,"E")) D
"RTN","RMPOPAT3",104,0)
 .W ?40,"ORTHOTICS LAB CODE: "
"RTN","RMPOPAT3",105,0)
 .W $S($D(R19(660,RMPRDA,74,"E")):R19(660,RMPRDA,74,"E"),$D(R19(660,RMPRDA,75,"E")):R19(660,RMPRDA,75,"E"),1:"")
"RTN","RMPOPAT3",106,0)
 .W !?40,"RESTORATIONS LAB CODE: "
"RTN","RMPOPAT3",107,0)
 .W $S($D(R19(660,RMPRDA,76,"E")):R19(660,RMPRDA,76,"E"),$D(R19(660,RMPRDA,77,"E")):R19(660,RMPRDA,77,"E"),1:"")
"RTN","RMPOPAT3",108,0)
 ;purchasing and issue from stock amis
"RTN","RMPOPAT3",109,0)
 W !,"DISABILITY SERVED: ",$G(R19(660,RMPRDA,62,"E"))
"RTN","RMPOPAT3",110,0)
 ;appliance/item information
"RTN","RMPOPAT3",111,0)
 ;historical/original item
"RTN","RMPOPAT3",112,0)
 W !,"ITEM DESCRIPTION: ",$G(R19(660,RMPRDA,89,"E"))
"RTN","RMPOPAT3",113,0)
 ;check for changes to item description
"RTN","RMPOPAT3",114,0)
 I $G(R19(660,RMPRDA,89,"E"))'=$G(R19(660,RMPRDA,4,"E")) W !,"*** See Above For Original Item Description ***"
"RTN","RMPOPAT3",115,0)
 W !,"APPLIANCE: ",$G(R19(660,RMPRDA,4,"E"))
"RTN","RMPOPAT3",116,0)
 W !,"PSAS HCPCS: ",$G(R19(660,RMPRDA,4.5,"E"))
"RTN","RMPOPAT3",117,0)
 I $P($G(^RMPR(660,RMPRDA,1)),U,4) W ?22,$P($G(^RMPR(661.1,$P(^RMPR(660,RMPRDA,1),U,4),0)),U,2)
"RTN","RMPOPAT3",118,0)
 ;added by #69
"RTN","RMPOPAT3",119,0)
 ;
"RTN","RMPOPAT3",120,0)
 ; PATCH 92 - Code Set Versioning (CSV) changes below
"RTN","RMPOPAT3",121,0)
 ; AAC      - 08/03/04
"RTN","RMPOPAT3",122,0)
 ; RMPR*3*182 Changes to handle BOTH ICD9 and ICD10 internal pointers
"RTN","RMPOPAT3",123,0)
 ; RMPR*3.0*194 New variables and updates to use ICD API
"RTN","RMPOPAT3",124,0)
 N RMPRDRG,RMPRICDD,RMPRICDC,RMPRICD,RMPRIC9,RMPRCOD,RMPRDAT
"RTN","RMPOPAT3",125,0)
 S (RMPRICD,RMPRIC9,RMPRCOD,RMPRDAT)="" S RMPRERR=0
"RTN","RMPOPAT3",126,0)
 S RMPRDAT=$P($G(^RMPR(660,RMPRDA,0)),U)
"RTN","RMPOPAT3",127,0)
 I $D(^RMPR(660,RMPRDA,10)) S RMPRICD=$P($G(^RMPR(660,RMPRDA,10)),U,8)
"RTN","RMPOPAT3",128,0)
 I RMPRICD D
"RTN","RMPOPAT3",129,0)
 . S RMPRDRG=$$ICDDX^ICDEX(RMPRICD,RMPRDAT,,"I") ;RMPR*3.0*194 Check if null before setting RMPRICDC
"RTN","RMPOPAT3",130,0)
 . S RMPRICDC=$P(RMPRDRG,U,2),RMPRICDD=$P(RMPRDRG,U,4)
"RTN","RMPOPAT3",131,0)
 S RMPRICDT=$S(RMPRICD<50000:9,1:10)
"RTN","RMPOPAT3",132,0)
 I RMPRICD="" W !,"ICD Message:  ** NO CODE AVAILABLE **"
"RTN","RMPOPAT3",133,0)
 I RMPRICD'="" W !,"ICD",RMPRICDT,": ",RMPRICDC,"   ",RMPRICDD
"RTN","RMPOPAT3",134,0)
 ;
"RTN","RMPOPAT3",135,0)
 ; End Patch 92
"RTN","RMPOPAT3",136,0)
 ;
"RTN","RMPOPAT3",137,0)
 W !,"CPT MODIFIER: ",$G(R19(660,RMPRDA,4.7,"E"))
"RTN","RMPOPAT3",138,0)
 W !,"DESCRIPTION: ",$G(R19(660,RMPRDA,24,"E"))
"RTN","RMPOPAT3",139,0)
 W !,"EXTENDED DESCRIPTION: ",!
"RTN","RMPOPAT3",140,0)
 I $D(R19(660,RMPRDA,28)) D  G:$D(DUOUT)!$D(DTOUT) EX1
"RTN","RMPOPAT3",141,0)
 .N R28
"RTN","RMPOPAT3",142,0)
 .;command part of new standards
"RTN","RMPOPAT3",143,0)
 .MERGE R28=R19(660,RMPRDA,28)
"RTN","RMPOPAT3",144,0)
 .I $P($G(^RMPR(660,RMPRDA,"DES",0)),U,3)>1 N DIR S DIR(0)="E" D ^DIR Q:$D(DUOUT)!$D(DTOUT)  D HDR W !,"EXTENDED DESCRIPTION: ",!
"RTN","RMPOPAT3",145,0)
 .D EN^DDIOL(.R28)
"RTN","RMPOPAT3",146,0)
 ;NPPD key items consolidated, example L5300 limb order
"RTN","RMPOPAT3",147,0)
 I $P(IT(AN),U,3) W !!,"*** Return For DETAIL REPORT ***" N DIR S DIR(0)="E" D ^DIR G:$D(DUOUT)!$D(DTOUT) EX1  W @IOF D HDR,^RMPRPAT7
"RTN","RMPOPAT3",148,0)
 ;display work order if it is a 2529-3 form
"RTN","RMPOPAT3",149,0)
 ;must pass ien to file 664.1 NOT 664.2
"RTN","RMPOPAT3",150,0)
 I $G(R19(660,RMPRDA,72,"I"))'="" D  G EX1
"RTN","RMPOPAT3",151,0)
 .S DIR(0)="E" D ^DIR Q:$D(DTOUT)!$D(DUOUT)
"RTN","RMPOPAT3",152,0)
 .S RMPRBCK=RMPRDA
"RTN","RMPOPAT3",153,0)
 .N DIC
"RTN","RMPOPAT3",154,0)
 .S RMPRDA=R19(660,RMPRBCK,72,"I")
"RTN","RMPOPAT3",155,0)
 .D DISP^RMPR293(RMPRDA)
"RTN","RMPOPAT3",156,0)
 .S RMPRDA=RMPRBCK K RMPRBCK
"RTN","RMPOPAT3",157,0)
 ;return from work order
"RTN","RMPOPAT3",158,0)
 G EXIT
"RTN","RMPOPAT3",159,0)
 ;
"RTN","RMPOPAT3",160,0)
HDR ;display heading
"RTN","RMPOPAT3",161,0)
 W @IOF,RMPRNAM,?30," SSN: "
"RTN","RMPOPAT3",162,0)
 W $E(RMPRSSN,1,3)_"-"_$E(RMPRSSN,4,5)_"-"_$E(RMPRSSN,6,10),?50
"RTN","RMPOPAT3",163,0)
 W $G(R19(660,RMPRDA,8,"E")),?70,"DOB: "
"RTN","RMPOPAT3",164,0)
 W $S(RMPRDOB:$E(RMPRDOB,4,5)_"-"_$E(RMPRDOB,6,7)_"-"_(1700+$E(RMPRDOB,1,3)),1:"Unknown")
"RTN","RMPOPAT3",165,0)
 W !?20,"APPLIANCE/REPAIR LINE ITEM DETAIL ",?70,"<4-",ANS,">",!
"RTN","RMPOPAT3",166,0)
 Q
"RTN","RMPOPAT3",167,0)
EXIT ;common exit point
"RTN","RMPOPAT3",168,0)
 I $Y>(IOSL-4) F  W ! Q:$Y>(IOSL-3)
"RTN","RMPOPAT3",169,0)
 N DIR S DIR(0)="E" D ^DIR
"RTN","RMPOPAT3",170,0)
 S RMOXY=Y
"RTN","RMPOPAT3",171,0)
 ;duout,dtout is evaluated in dis+1^rmpopat2
"RTN","RMPOPAT3",172,0)
EX1 ;back out through that point to clean up
"RTN","RMPOPAT3",173,0)
 K R19,RV,RMPRICC,RMPRICD,RMPRIC9,RMPRCOD,RMPRDAT,RMPRERR,Y W @IOF
"RTN","RMPOPAT3",174,0)
 Q
"RTN","RMPOPAT3",175,0)
 ;end
"RTN","RMPR4M")
0^1^B35332645^B35332873
"RTN","RMPR4M",1,0)
RMPR4M ;PHX/HNB,RVD - PURCHASE CARD MODULE FUNCTIONS ;3/1/1996
"RTN","RMPR4M",2,0)
 ;;3.0;PROSTHETICS;**3,26,28,30,41,62,90,133,189,194**;Feb 09, 1996;Build 5
"RTN","RMPR4M",3,0)
 ;Per VA Directive 6402, this routine should not be modified.
"RTN","RMPR4M",4,0)
 ;
"RTN","RMPR4M",5,0)
 ; RVD patch #62 - pce and suspense link to 2319
"RTN","RMPR4M",6,0)
POST2 ;*** Posting Data to 2319 *******************************************
"RTN","RMPR4M",7,0)
 ;set global to local table/variables
"RTN","RMPR4M",8,0)
 S R190=$G(^RMPR(664,RMPRA,0))
"RTN","RMPR4M",9,0)
 S R192=$G(^RMPR(664,RMPRA,2))
"RTN","RMPR4M",10,0)
 S R193=$G(^RMPR(664,RMPRA,3))
"RTN","RMPR4M",11,0)
 S R194=$G(^RMPR(664,RMPRA,4))
"RTN","RMPR4M",12,0)
 W !,"...now posting to file 660..."
"RTN","RMPR4M",13,0)
ADD ;for adding new entry in 2319
"RTN","RMPR4M",14,0)
 S RMPHC="" I $D(^TMP("RM",$J,"N")) D
"RTN","RMPR4M",15,0)
 .F I=0:0 S I=$O(^TMP("RM",$J,"N",I)) Q:I'>0  S RMI=$G(^RMPR(664,RMPRA,1,I,0)) I RMI D
"RTN","RMPR4M",16,0)
 ..S RMCPT=$P($G(^RMPR(664,RMPRA,1,I,4)),U,2)
"RTN","RMPR4M",17,0)
 ..S DIC="^RMPR(660,",DIC(0)="L",X=DT
"RTN","RMPR4M",18,0)
 ..K DD,DO D FILE^DICN
"RTN","RMPR4M",19,0)
 ..S $P(^RMPR(664,RMPRA,1,I,0),U,13)=+Y
"RTN","RMPR4M",20,0)
 ..D TOT
"RTN","RMPR4M",21,0)
 ..S:$P(RMI,U,16) RMPHC=$P(^RMPR(661.1,$P(RMI,U,16),0),U,4)
"RTN","RMPR4M",22,0)
 ..S R19A=+Y
"RTN","RMPR4M",23,0)
 ..S R19I=$G(^RMPR(664,RMPRA,1,I,0))
"RTN","RMPR4M",24,0)
 ..S R19(660,R19A_",",8)=RMPR("STA")
"RTN","RMPR4M",25,0)
 ..S R19(660,R19A_",",.02)=$P(R190,U,2)
"RTN","RMPR4M",26,0)
 ..S R19(660,R19A_",",7)=$P(R190,U,4)
"RTN","RMPR4M",27,0)
 ..S R19(660,R19A_",",4.3)=$P(R194,U,2)
"RTN","RMPR4M",28,0)
 ..S R19(660,R19A_",",23)=$P(R194,U,5)
"RTN","RMPR4M",29,0)
 ..S R19(660,R19A_",",1)=$P(R190,U,1)
"RTN","RMPR4M",30,0)
 ..S R19(660,R19A_",",25)=$P(R193,U,1)
"RTN","RMPR4M",31,0)
 ..S R19(660,R19A_",",27)=DUZ
"RTN","RMPR4M",32,0)
 ..S R19(660,R19A_",",2)=$P(R19I,U,9)
"RTN","RMPR4M",33,0)
 ..S R19(660,R19A_",",4)=$P(R19I,U,1)
"RTN","RMPR4M",34,0)
 ..S R19(660,R19A_",",5)=$P(R19I,U,4)
"RTN","RMPR4M",35,0)
 ..S R19(660,R19A_",",4.5)=$P(R19I,U,16)
"RTN","RMPR4M",36,0)
 ..S R19(660,R19A_",",4.7)=RMCPT
"RTN","RMPR4M",37,0)
 ..S R19(660,R19A_",",4.1)=RMPHC
"RTN","RMPR4M",38,0)
 ..S R19(660,R19A_",",12)=$P(R19I,U,12)
"RTN","RMPR4M",39,0)
 ..S R19(660,R19A_",",78)=$P(R19I,U,5)
"RTN","RMPR4M",40,0)
 ..S R19(660,R19A_",",16)=$P(R19I,U,8)
"RTN","RMPR4M",41,0)
 ..S R19(660,R19A_",",24)=$P(R19I,U,2)
"RTN","RMPR4M",42,0)
 ..S R19(660,R19A_",",62)=$P(R19I,U,10)
"RTN","RMPR4M",43,0)
 ..S R19(660,R19A_",",63)=$P(R19I,U,11)
"RTN","RMPR4M",44,0)
 ..S R19(660,R19A_",",24)=$P(R19I,U,2)
"RTN","RMPR4M",45,0)
 ..S R19(660,R19A_",",14)=RMTOT
"RTN","RMPR4M",46,0)
 ..S R19(660,R19A_",",9)=$P(R19I,U,15)
"RTN","RMPR4M",47,0)
 ..S R19(660,R19A_",",11)=14
"RTN","RMPR4M",48,0)
 ..S R19(660,R19A_",",68)=RGRP1
"RTN","RMPR4M",49,0)
 ..S R19(660,R19A_",",8.14)=0
"RTN","RMPR4M",50,0)
 ..; update CONTRACT #, LOT #, and MODEL in 660
"RTN","RMPR4M",51,0)
 ..S R19(660,R19A_",",9.2)=$$GET1^DIQ(664.02,$$I66402(R19A,RMPRA)_","_RMPRA_",",15.4)
"RTN","RMPR4M",52,0)
 ..S R19(660,R19A_",",21)=$$GET1^DIQ(664.02,$$I66402(R19A,RMPRA)_","_RMPRA_",",15.6)
"RTN","RMPR4M",53,0)
 ..S R19(660,R19A_",",38.7)=$P(RMI,U,14)
"RTN","RMPR4M",54,0)
 ..D FILE^DIE("K","R19","ERROR")
"RTN","RMPR4M",55,0)
 ..I $D(^RMPR(664,RMPRA,1,I,4)) S $P(^RMPR(660,R19A,4),U,1)=$P(^RMPR(664,RMPRA,1,I,4),U,1)
"RTN","RMPR4M",56,0)
 ..MERGE ^RMPR(660,R19A,"DES")=^RMPR(664,RMPRA,1,I,1)
"RTN","RMPR4M",57,0)
 ..S RMPRDFN=$P(R190,U,2)
"RTN","RMPR4M",58,0)
 ..S RM60LINK(R19A)=""
"RTN","RMPR4M",59,0)
 ..D CHK
"RTN","RMPR4M",60,0)
 ;
"RTN","RMPR4M",61,0)
EDIT ;for editing entry in 2319
"RTN","RMPR4M",62,0)
 S RMPHC="" I $D(^TMP("RM",$J,"E")) D
"RTN","RMPR4M",63,0)
 .F I=0:0 S I=$O(^TMP("RM",$J,"E",I)) Q:I'>0  S RMI=$G(^RMPR(664,RMPRA,1,I,0)),DA=$P(RMI,U,13) I DA D
"RTN","RMPR4M",64,0)
 ..S RMCPT=$P($G(^RMPR(664,RMPRA,1,I,4)),U,2)
"RTN","RMPR4M",65,0)
 ..D TOT
"RTN","RMPR4M",66,0)
 ..S:$P(RMI,U,16) RMPHC=$P(^RMPR(661.1,$P(RMI,U,16),0),U,4)
"RTN","RMPR4M",67,0)
 ..S $P(^RMPR(660,DA,0),U,11)=$P(RMI,U,15)
"RTN","RMPR4M",68,0)
 ..S $P(^RMPR(660,DA,0),U,4)=$P(RMI,U,9)
"RTN","RMPR4M",69,0)
 ..S $P(^RMPR(660,DA,0),U,7)=$P(RMI,U,4)
"RTN","RMPR4M",70,0)
 ..S $P(^RMPR(660,DA,0),U,8)=$P(RMI,U,5)
"RTN","RMPR4M",71,0)
 ..S $P(^RMPR(660,DA,0),U,13)=14
"RTN","RMPR4M",72,0)
 ..S $P(^RMPR(660,DA,0),U,16)=RMTOT
"RTN","RMPR4M",73,0)
 ..S $P(^RMPR(660,DA,"AM"),U,3)=$P(RMI,U,10)
"RTN","RMPR4M",74,0)
 ..S $P(^RMPR(660,DA,"AM"),U,4)=$P(RMI,U,11)
"RTN","RMPR4M",75,0)
 ..S $P(^RMPR(660,DA,0),U,22)=RMPHC
"RTN","RMPR4M",76,0)
 ..S $P(^RMPR(660,DA,1),U,4)=$P(RMI,U,16)
"RTN","RMPR4M",77,0)
 ..S $P(^RMPR(660,DA,1),U,6)=RMCPT
"RTN","RMPR4M",78,0)
 ..S $P(^RMPR(660,DA,0),U,18)=$P(RMI,U,8)
"RTN","RMPR4M",79,0)
 ..; update CONTRACT #, LOT #, and MODEL in 660
"RTN","RMPR4M",80,0)
 ..S $P(^RMPR(660,DA,2),U,9)=$P(RMI,U,14)
"RTN","RMPR4M",81,0)
 ..S $P(^RMPR(660,DA,0),U,24)=$$GET1^DIQ(664.02,$$I66402(DA,RMPRA)_","_RMPRA_",",15.6)
"RTN","RMPR4M",82,0)
 ..S $P(^RMPR(660,DA,9),U,2)=$$GET1^DIQ(664.02,$$I66402(DA,RMPRA)_","_RMPRA_",",15.4)
"RTN","RMPR4M",83,0)
 ..;update brief description field 24 in 660
"RTN","RMPR4M",84,0)
 ..S $P(^RMPR(660,DA,1),U,2)=$P(RMI,U,2)
"RTN","RMPR4M",85,0)
 ..I $D(^RMPR(664,RMPRA,1,I,4)) S $P(^RMPR(660,DA,4),U,1)=$P(^RMPR(664,RMPRA,1,I,4),U,1)
"RTN","RMPR4M",86,0)
 ..;added by patch #62
"RTN","RMPR4M",87,0)
 ..I $D(^RMPR(660,DA,10)) S RM10STAT=$P(^RMPR(660,DA,10),U,14)
"RTN","RMPR4M",88,0)
 ..I '$D(^RMPR(660,DA,10))!'$G(RM10STAT) D
"RTN","RMPR4M",89,0)
 ...K RM10STAT
"RTN","RMPR4M",90,0)
 ...S RM60LINK(DA)=""
"RTN","RMPR4M",91,0)
 ..MERGE ^RMPR(660,DA,"DES")=^RMPR(664,RMPRA,1,I,1)
"RTN","RMPR4M",92,0)
 ..S DIK="^RMPR(660," D IX1^DIK
"RTN","RMPR4M",93,0)
SHIP ;for shipping entry in 2319
"RTN","RMPR4M",94,0)
 I $G(RMSHIF) S DA=$P(R190,U,12) S:$G(DA) $P(^RMPR(660,DA,0),U,17)=$P(R190,U,11),$P(^RMPR(660,DA,0),U,16)=$P(R190,U,11) I '$G(DA) D
"RTN","RMPR4M",95,0)
 .S DIC="^RMPR(660,",DIC(0)="L",X=DT
"RTN","RMPR4M",96,0)
 .K DD,DO D FILE^DICN
"RTN","RMPR4M",97,0)
 .S $P(^RMPR(664,RMPRA,0),U,12)=+Y
"RTN","RMPR4M",98,0)
 .S R19IEN=$O(^RMPR(664,RMPRA,1,0)) Q:R19IEN=""
"RTN","RMPR4M",99,0)
 .S R19I=$G(^RMPR(664,RMPRA,1,R19IEN,0))
"RTN","RMPR4M",100,0)
 .S R19A=+Y
"RTN","RMPR4M",101,0)
 .S R19(660,R19A_",",8)=RMPR("STA")
"RTN","RMPR4M",102,0)
 .S R19(660,R19A_",",.02)=$P(R190,U,2)
"RTN","RMPR4M",103,0)
 .S R19(660,R19A_",",7)=$P(R190,U,4)
"RTN","RMPR4M",104,0)
 .S R19(660,R19A_",",4.3)=$P(R194,U,2)
"RTN","RMPR4M",105,0)
 .S R19(660,R19A_",",23)=$P(R194,U,5)
"RTN","RMPR4M",106,0)
 .S R19(660,R19A_",",1)=$P(R190,U,1)
"RTN","RMPR4M",107,0)
 .S R19(660,R19A_",",2)="X"
"RTN","RMPR4M",108,0)
 .S R19(660,R19A_",",25)=$P(R193,U,1)
"RTN","RMPR4M",109,0)
 .S R19(660,R19A_",",27)=DUZ
"RTN","RMPR4M",110,0)
 .S R19(660,R19A_",",6)=$P(R190,U,11)
"RTN","RMPR4M",111,0)
 .S R19(660,R19A_",",14)=$P(R190,U,11)
"RTN","RMPR4M",112,0)
 .S R19(660,R19A_",",11)=14
"RTN","RMPR4M",113,0)
 .S R19(660,R19A_",",12)="C"
"RTN","RMPR4M",114,0)
 .S R19(660,R19A_",",62)=$P(R19I,U,10)
"RTN","RMPR4M",115,0)
 .S R19(660,R19A_",",63)=$P(R19I,U,11)
"RTN","RMPR4M",116,0)
 .S R19(660,R19A_",",68)=RGRP1
"RTN","RMPR4M",117,0)
 .D FILE^DIE("K","R19","ERROR")
"RTN","RMPR4M",118,0)
 .I $D(^RMPR(660,R19A,10)) S RM10STAT=$P(^RMPR(660,R19A,10),U,14)
"RTN","RMPR4M",119,0)
 .I '$D(^RMPR(660,R19A,10))!'$G(RM10STAT) D
"RTN","RMPR4M",120,0)
 ..K RM10STAT
"RTN","RMPR4M",121,0)
 ..S RM60LINK(R19A)=""
"RTN","RMPR4M",122,0)
 ;
"RTN","RMPR4M",123,0)
CAN ;for CANCELING entry in 2319
"RTN","RMPR4M",124,0)
 ;call pce delete if patient encounter was recorded.
"RTN","RMPR4M",125,0)
 N RMI
"RTN","RMPR4M",126,0)
 I $D(^TMP("RM",$J,"C")) S DIK="^RMPR(660," F RMI=0:0 S RMI=$O(^TMP("RM",$J,"C",RMI)) Q:RMI'>0  D
"RTN","RMPR4M",127,0)
 .I $D(^RMPR(660,RMI,10)),$P(^RMPR(660,RMI,10),U,12) D
"RTN","RMPR4M",128,0)
 ..S RMCHK=0
"RTN","RMPR4M",129,0)
 ..S RMCHK=$$DEL^RMPRPCED(RMI)
"RTN","RMPR4M",130,0)
 .S DA=RMI D ^DIK
"RTN","RMPR4M",131,0)
 ;
"RTN","RMPR4M",132,0)
UPD ; Update Percent discount, Bank Authorization and remove shipping entry.
"RTN","RMPR4M",133,0)
 I $G(RMPERF)!$G(RMBANF) D
"RTN","RMPR4M",134,0)
 .F I=0:0 S I=$O(^RMPR(664,RMPRA,1,I)) Q:I'>0  S RMI=$G(^(I,0)),DA=$P(RMI,U,13) I DA D
"RTN","RMPR4M",135,0)
 ..I $G(RMPERF) D TOT S $P(^RMPR(660,DA,0),U,16)=RMTOT
"RTN","RMPR4M",136,0)
 ..S:$G(RMBANF) $P(^RMPR(660,DA,4),U,2)=$P(R194,U,2)
"RTN","RMPR4M",137,0)
 I $G(RMSHIF),($P(^RMPR(664,RMPRA,0),U,11)=0) S DA=$P(^(0),U,12),DIK="^RMPR(660," D ^DIK S $P(^RMPR(664,RMPRA,0),U,12)=""
"RTN","RMPR4M",138,0)
 ;
"RTN","RMPR4M",139,0)
KILL K RMTOT,RMI,R19I,R19A,DR,DA,RMPERF,RMBANF,RMSHIF,RMPHC,RMCPT
"RTN","RMPR4M",140,0)
 Q
"RTN","RMPR4M",141,0)
TOT S RMACT=$P(RMI,U,7),RMUNC=$P(RMI,U,3),RMQTY=$P(RMI,U,4)
"RTN","RMPR4M",142,0)
 I DCT S RMTOT=$S(RMACT=0!(RMACT>0):RMACT-$J(RMACT*DCT,0,2)*RMQTY,1:RMUNC-$J(RMUNC*DCT,0,2)*RMQTY)
"RTN","RMPR4M",143,0)
 I 'DCT S RMTOT=$S(RMACT=0!(RMACT>0):RMACT*RMQTY,1:RMUNC*RMQTY)
"RTN","RMPR4M",144,0)
 Q
"RTN","RMPR4M",145,0)
CHK I '$D(^RMPR(660,R19A,0)) W !!,$C(7),"**** POSTING TO 2319 FOR ITEM.."_I_" FAILED",!,"PLEASE RUN CLOSE-OUT OPTION AGAIN..." G KTMP^RMPR4E21
"RTN","RMPR4M",146,0)
 Q
"RTN","RMPR4M",147,0)
I66402(RMI660,RMI664) ; obtain IEN of line in 664.02 that contains match for pointer to 660
"RTN","RMPR4M",148,0)
 ; RMI660 - IEN in 660 which is the one that we are checking 664.02 for
"RTN","RMPR4M",149,0)
 ; RMI664 - IEN in 664 that we are searching on
"RTN","RMPR4M",150,0)
 N RMNS
"RTN","RMPR4M",151,0)
 S RMNS=0
"RTN","RMPR4M",152,0)
 F  S RMNS=$O(^RMPR(664,RMI664,1,RMNS)) Q:+RMNS=0  Q:$P(^RMPR(664,RMI664,1,RMNS,0),U,13)=RMI660
"RTN","RMPR4M",153,0)
 Q RMNS
"VER")
8.0^22.2
"BLD",11011,6)
^173
**END**
**END**

