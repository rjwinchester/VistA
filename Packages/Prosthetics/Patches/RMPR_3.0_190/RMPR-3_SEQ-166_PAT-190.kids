EMERGENCY Released RMPR*3*190 SEQ #166
Extracted from mail message
**KIDS**:RMPR*3.0*190^

**INSTALL NAME**
RMPR*3.0*190
"BLD",10163,0)
RMPR*3.0*190^PROSTHETICS^0^3171011^y
"BLD",10163,1,0)
^^2^2^3170926^
"BLD",10163,1,1,0)
Home Oxygen billing process date failure has prevented users from viewing 
"BLD",10163,1,2,0)
Home Oxygen items posted.
"BLD",10163,4,0)
^9.64PA^^
"BLD",10163,6.3)
5
"BLD",10163,"ABPKG")
n
"BLD",10163,"INI")
START^RMPO190P
"BLD",10163,"INID")
^^y
"BLD",10163,"KRN",0)
^9.67PA^779.2^20
"BLD",10163,"KRN",.4,0)
.4
"BLD",10163,"KRN",.401,0)
.401
"BLD",10163,"KRN",.402,0)
.402
"BLD",10163,"KRN",.403,0)
.403
"BLD",10163,"KRN",.5,0)
.5
"BLD",10163,"KRN",.84,0)
.84
"BLD",10163,"KRN",3.6,0)
3.6
"BLD",10163,"KRN",3.8,0)
3.8
"BLD",10163,"KRN",9.2,0)
9.2
"BLD",10163,"KRN",9.8,0)
9.8
"BLD",10163,"KRN",9.8,"NM",0)
^9.68A^3^2
"BLD",10163,"KRN",9.8,"NM",2,0)
RMPO190P^^0^B7941870
"BLD",10163,"KRN",9.8,"NM",3,0)
RMPOBIL0^^0^B46413512
"BLD",10163,"KRN",9.8,"NM","B","RMPO190P",2)

"BLD",10163,"KRN",9.8,"NM","B","RMPOBIL0",3)

"BLD",10163,"KRN",19,0)
19
"BLD",10163,"KRN",19.1,0)
19.1
"BLD",10163,"KRN",101,0)
101
"BLD",10163,"KRN",409.61,0)
409.61
"BLD",10163,"KRN",771,0)
771
"BLD",10163,"KRN",779.2,0)
779.2
"BLD",10163,"KRN",870,0)
870
"BLD",10163,"KRN",8989.51,0)
8989.51
"BLD",10163,"KRN",8989.52,0)
8989.52
"BLD",10163,"KRN",8994,0)
8994
"BLD",10163,"KRN","B",.4,.4)

"BLD",10163,"KRN","B",.401,.401)

"BLD",10163,"KRN","B",.402,.402)

"BLD",10163,"KRN","B",.403,.403)

"BLD",10163,"KRN","B",.5,.5)

"BLD",10163,"KRN","B",.84,.84)

"BLD",10163,"KRN","B",3.6,3.6)

"BLD",10163,"KRN","B",3.8,3.8)

"BLD",10163,"KRN","B",9.2,9.2)

"BLD",10163,"KRN","B",9.8,9.8)

"BLD",10163,"KRN","B",19,19)

"BLD",10163,"KRN","B",19.1,19.1)

"BLD",10163,"KRN","B",101,101)

"BLD",10163,"KRN","B",409.61,409.61)

"BLD",10163,"KRN","B",771,771)

"BLD",10163,"KRN","B",779.2,779.2)

"BLD",10163,"KRN","B",870,870)

"BLD",10163,"KRN","B",8989.51,8989.51)

"BLD",10163,"KRN","B",8989.52,8989.52)

"BLD",10163,"KRN","B",8994,8994)

"BLD",10163,"QDEF")
^^^^^^^^^^YES
"BLD",10163,"QUES",0)
^9.62^^
"BLD",10163,"REQB",0)
^9.611^1^1
"BLD",10163,"REQB",1,0)
RMPR*3.0*179^2
"BLD",10163,"REQB","B","RMPR*3.0*179",1)

"INI")
START^RMPO190P
"MBREQ")
0
"PKG",101,-1)
1^1
"PKG",101,0)
PROSTHETICS^RMPR^PROSTHETICS VERSION 3.0 ALPHA
"PKG",101,20,0)
^9.402P^^0
"PKG",101,22,0)
^9.49I^1^1
"PKG",101,22,1,0)
3.0^2960209^2960214
"PKG",101,22,1,"PAH",1,0)
190^3171011
"PKG",101,22,1,"PAH",1,1,0)
^^2^2^3171011
"PKG",101,22,1,"PAH",1,1,1,0)
Home Oxygen billing process date failure has prevented users from viewing 
"PKG",101,22,1,"PAH",1,1,2,0)
Home Oxygen items posted.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
2
"RTN","RMPO190P")
0^2^B7941870^n/a
"RTN","RMPO190P",1,0)
RMPO190P ;RGB/DEV - HO BILLING VIEW FIX PRE-INSTALL ;9/27/17  07:34
"RTN","RMPO190P",2,0)
 ;;3.0;PROSTHETICS;**190**;Feb 09, 1996;Build 5
"RTN","RMPO190P",3,0)
 Q
"RTN","RMPO190P",4,0)
 ;RMPR*3.0*190  This pre-install routine will drive down through
"RTN","RMPO190P",5,0)
 ;              the HO billing file (665.72) for each month in 
"RTN","RMPO190P",6,0)
 ;              2017, beginning with April 2017.  The code will 
"RTN","RMPO190P",7,0)
 ;              insure that every 660 pointer in the items billed 
"RTN","RMPO190P",8,0)
 ;              has a valid date in the 660 entry for field #1, 
"RTN","RMPO190P",9,0)
 ;              Request Date.  If null, the date will be populated
"RTN","RMPO190P",10,0)
 ;              with the 15th of the month following the compiled 
"RTN","RMPO190P",11,0)
 ;              month.
"RTN","RMPO190P",12,0)
 ;
"RTN","RMPO190P",13,0)
START K ^XTMP("RMPO190P")
"RTN","RMPO190P",14,0)
 D NOW^%DTC S RMPOSTRT=%
"RTN","RMPO190P",15,0)
 S ^XTMP("RMPO190P","START COMPILE")=RMPOSTRT
"RTN","RMPO190P",16,0)
 S ^XTMP("RMPO190P","END COMPILE")="RUNNING"
"RTN","RMPO190P",17,0)
 S ^XTMP("RMPO190P",0)=$$FMADD^XLFDT(RMPOSTRT,180)_"^"_RMPOSTRT
"RTN","RMPO190P",18,0)
 S U="^",RMPOSIT=0,XXX=0
"RTN","RMPO190P",19,0)
A S RMPOSIT=$O(^RMPO(665.72,RMPOSIT)),RMPODT=3170300 G AQ:'RMPOSIT
"RTN","RMPO190P",20,0)
A1 S RMPODT=$O(^RMPO(665.72,RMPOSIT,1,RMPODT)),RMPOVND=0 G A:'RMPODT
"RTN","RMPO190P",21,0)
 S RMPORQDT=($E(RMPODT,1,5)+1)_15 I $E(RMPORQDT,4,5)=13 S RMPORQDT=($E(RMPORQDT,1,3)+1)_"0115"
"RTN","RMPO190P",22,0)
A2 S RMPOVND=$O(^RMPO(665.72,RMPOSIT,1,RMPODT,1,RMPOVND)),RMPOPAT=0 G A1:'RMPOVND
"RTN","RMPO190P",23,0)
 I '$P(^RMPO(665.72,RMPOSIT,1,RMPODT,1,RMPOVND,0),U,2) S $P(^RMPO(665.72,RMPOSIT,1,RMPODT,1,RMPOVND,0),U,2)=RMPORQDT
"RTN","RMPO190P",24,0)
A3 S RMPOPAT=$O(^RMPO(665.72,RMPOSIT,1,RMPODT,1,RMPOVND,"V",RMPOPAT)),RMPOITM=0 G A2:'RMPOPAT
"RTN","RMPO190P",25,0)
A4 S RMPOITM=$O(^RMPO(665.72,RMPOSIT,1,RMPODT,1,RMPOVND,"V",RMPOPAT,1,RMPOITM)) G A3:'RMPOITM
"RTN","RMPO190P",26,0)
 S RMPOBITM=^RMPO(665.72,RMPOSIT,1,RMPODT,1,RMPOVND,"V",RMPOPAT,1,RMPOITM,0)
"RTN","RMPO190P",27,0)
 S RMPR660P=$P(RMPOBITM,U,16) I 'RMPR660P S ^XTMP("RMPO190P",2,RMPOSIT,1,RMPODT,1,RMPOVND,"V",RMPOPAT,1,RMPOITM,0)=RMPOSIT_U_RMPODT_U_RMPOVND_U_RMPOPAT_U_RMPOITM G A4
"RTN","RMPO190P",28,0)
 S RMPR660R=$G(^RMPR(660,RMPR660P,0)) I 'RMPR660R S ^XTMP("RMPO190P",3,RMPR660P,0)=RMPOSIT_U_RMPODT_U_RMPOVND_U_RMPOPAT_U_RMPOITM_U_RMPR660P G A4
"RTN","RMPO190P",29,0)
 I $P(RMPR660R,U,3)="" D
"RTN","RMPO190P",30,0)
 . S DA=RMPR660P,DIE="^RMPR(660,",DR="1////^S X=RMPORQDT" D ^DIE   ;SET 660 REC REQUEST DATE WITH NEXT MONTH RUN DATE
"RTN","RMPO190P",31,0)
 . S ^XTMP("RMPO190P",1,RMPR660P,0)=^RMPR(660,RMPR660P,0)
"RTN","RMPO190P",32,0)
 G A4
"RTN","RMPO190P",33,0)
AQ K RMPOSIT,RMPODT,RMPOVND,RMPOPAT,RMPR660P,RMPR660R,RMPOSTRT,DA,DIE,DR,RMPOBITM,RMPOITM,RMPORQDT,%
"RTN","RMPO190P",34,0)
 W !!,"<< PRE-INSTALL RUN COMPLETED, CORRECTING HO ITEMS WITH NULL 'REQUEST DATE' >>"
"RTN","RMPO190P",35,0)
 QUIT
"RTN","RMPOBIL0")
0^3^B46413512^B45113783
"RTN","RMPOBIL0",1,0)
RMPOBIL0 ;EDS/MDB/HINES CIOFO/HNC - HOME OXYGEN BILLING TRANSACTIONS ;7/24/98  07:34
"RTN","RMPOBIL0",2,0)
 ;;3.0;PROSTHETICS;**29,46,50,147,179,190**;Feb 09, 1996;Build 5
"RTN","RMPOBIL0",3,0)
 ;
"RTN","RMPOBIL0",4,0)
 ; ODJ - patch 50 - 7/25/00 fix DIR date call in PREBILL sub. so as to
"RTN","RMPOBIL0",5,0)
 ;                          interpret 2 digit entry as month
"RTN","RMPOBIL0",6,0)
 ;                          (FM interpets this as year)
"RTN","RMPOBIL0",7,0)
 ;
"RTN","RMPOBIL0",8,0)
 ;RMPR*3.0*179 Added check for Deceased Date less than billing month
"RTN","RMPOBIL0",9,0)
 ;             begin date, error -1 and skips patient billing due to
"RTN","RMPOBIL0",10,0)
 ;             change in release DI*22.2*5.
"RTN","RMPOBIL0",11,0)
 ;
"RTN","RMPOBIL0",12,0)
 ;RMPR*3.0*190 Insure %DT(0) is not set prior to date handling
"RTN","RMPOBIL0",13,0)
 ;
"RTN","RMPOBIL0",14,0)
OLD ; Enter from top (OLD code)
"RTN","RMPOBIL0",15,0)
 ;
"RTN","RMPOBIL0",16,0)
 D MAIN  ; D ^RMPOBIL1
"RTN","RMPOBIL0",17,0)
 ;Q:'$D(RMPODATE)!'$D(RMPOVDR)!'$D(RMPOXITE)!QUIT
"RTN","RMPOBIL0",18,0)
 I '$D(RMPODATE)!'$D(RMPOVDR)!'$D(RMPOXITE)!QUIT D EXIT Q
"RTN","RMPOBIL0",19,0)
 K DIC,DIR,DIR,DD,DA,DR,DO  ;CLEANUP FOR L/M
"RTN","RMPOBIL0",20,0)
 D EN^RMPOLM  ; -- List manager code
"RTN","RMPOBIL0",21,0)
 D ACCEPT^RMPOPST3,EXIT
"RTN","RMPOBIL0",22,0)
 Q
"RTN","RMPOBIL0",23,0)
MAIN ; Proper entry point
"RTN","RMPOBIL0",24,0)
 D HOME^%ZIS
"RTN","RMPOBIL0",25,0)
 S QUIT=0
"RTN","RMPOBIL0",26,0)
 D HOSITE^RMPOUTL0 Q:('$D(RMPOXITE))!QUIT
"RTN","RMPOBIL0",27,0)
 D CKSITE
"RTN","RMPOBIL0",28,0)
 D MONTH("AEQLMZ") Q:$D(RMPODATE)=0!QUIT
"RTN","RMPOBIL0",29,0)
 D VENDOR("AEQLMZ") Q:$D(RMPOVDR)=0!QUIT
"RTN","RMPOBIL0",30,0)
 ;Generate Vendor/Month of transactions
"RTN","RMPOBIL0",31,0)
 I $O(^RMPO(665.72,RMPOXITE,1,RMPORVDT,1,RMPOVDR,0))="V" Q
"RTN","RMPOBIL0",32,0)
 D GEN1
"RTN","RMPOBIL0",33,0)
 Q
"RTN","RMPOBIL0",34,0)
VENDOR(LAYGO) ;Select Vendor
"RTN","RMPOBIL0",35,0)
 ;
"RTN","RMPOBIL0",36,0)
 K DIC,DA,RMPOVDR
"RTN","RMPOBIL0",37,0)
 S DA(2)=RMPOXITE,DA(1)=RMPORVDT
"RTN","RMPOBIL0",38,0)
 S DIC="^RMPO(665.72,"_DA(2)_",1,"_DA(1)_",1,"
"RTN","RMPOBIL0",39,0)
 S DIC("P")=$P(^DD(665.723,1,0),U,2)
"RTN","RMPOBIL0",40,0)
 S DIC(0)=$G(LAYGO,"AEQMZ") D ^DIC Q:(Y<0)!$$QUIT
"RTN","RMPOBIL0",41,0)
 S RMPOVDR=+Y
"RTN","RMPOBIL0",42,0)
 ;S RMPOVDR=$P(Y,U,2)  ; PER ANALYST
"RTN","RMPOBIL0",43,0)
 I $P(Y,U,3)>0 D
"RTN","RMPOBIL0",44,0)
 . K %DT(0)    ;RMPR*3.0*190
"RTN","RMPOBIL0",45,0)
 . S DIE=DIC,DA=+Y,DR="1///NOW" D ^DIE
"RTN","RMPOBIL0",46,0)
 Q
"RTN","RMPOBIL0",47,0)
CKSITE ;Set up Site in Billing if it is not there
"RTN","RMPOBIL0",48,0)
 I '$D(^RMPO(665.72,RMPOXITE,0)) D
"RTN","RMPOBIL0",49,0)
 . K DIC,DD,DO,DA
"RTN","RMPOBIL0",50,0)
 . S (DINUM,X)=RMPOXITE,DIC="^RMPO(665.72,",DIC(0)="L" D FILE^DICN
"RTN","RMPOBIL0",51,0)
 Q
"RTN","RMPOBIL0",52,0)
MONTH(LAYGO) ;Determine Billing Month
"RTN","RMPOBIL0",53,0)
 ;
"RTN","RMPOBIL0",54,0)
 K DIC,DA,RMPODATE
"RTN","RMPOBIL0",55,0)
 S DA(1)=RMPOXITE,DIC="^RMPO(665.72,"_DA(1)_",1,"
"RTN","RMPOBIL0",56,0)
 S DIC("P")=$P(^DD(665.72,1,0),U,2)
"RTN","RMPOBIL0",57,0)
 S DIC(0)=$G(LAYGO,"AEMQZ") D ^DIC Q:(Y<0)!$$QUIT
"RTN","RMPOBIL0",58,0)
 S RMPODATE=+Y,RMPOMTH=Y(0,0)
"RTN","RMPOBIL0",59,0)
 S RMPORVDT=RMPODATE
"RTN","RMPOBIL0",60,0)
 Q
"RTN","RMPOBIL0",61,0)
QUIT() S QUIT=$D(DTOUT)!$D(DUOUT)!$D(DIROUT) Q QUIT
"RTN","RMPOBIL0",62,0)
 ;
"RTN","RMPOBIL0",63,0)
BUILDM ; BUILD MONTH
"RTN","RMPOBIL0",64,0)
 ; Set up Month
"RTN","RMPOBIL0",65,0)
 Q:$D(^RMPO(665.72,RMPOXITE,1,RMPORVDT))  ; ALREADY DONE..
"RTN","RMPOBIL0",66,0)
 K DIC,DA
"RTN","RMPOBIL0",67,0)
 S X=RMPODATE,DINUM=RMPORVDT
"RTN","RMPOBIL0",68,0)
 S DA(1)=RMPOXITE,DIC(0)="L"
"RTN","RMPOBIL0",69,0)
 S DIC="^RMPO(665.72,"_DA(1)_",1,",DIC("P")=$P(^DD(665.72,1,0),U,2)
"RTN","RMPOBIL0",70,0)
 D FILE^DICN
"RTN","RMPOBIL0",71,0)
 Q
"RTN","RMPOBIL0",72,0)
GEN1 ; ALL PATIENTS FOR A GIVEN VENDOR
"RTN","RMPOBIL0",73,0)
 W !,"Generating "_RMPOMTH_" billing transactions for "
"RTN","RMPOBIL0",74,0)
 W $$VDRNM^RMPOPED(RMPOVDR),!!,"This may take a while..."
"RTN","RMPOBIL0",75,0)
 ;
"RTN","RMPOBIL0",76,0)
 ; D BUILDM
"RTN","RMPOBIL0",77,0)
 ;Copy Patient Boiler-plates
"RTN","RMPOBIL0",78,0)
 ;fix to get ALL patients from same activation date
"RTN","RMPOBIL0",79,0)
 S (ACTIVDT,RMPODFN)=0
"RTN","RMPOBIL0",80,0)
 F  S ACTIVDT=$O(^RMPR(665,"AHO",ACTIVDT)) Q:ACTIVDT'>0  D
"RTN","RMPOBIL0",81,0)
 . S RMPODFN=0
"RTN","RMPOBIL0",82,0)
 . F  S RMPODFN=$O(^RMPR(665,"AHO",ACTIVDT,RMPODFN)) Q:RMPODFN'>0  D:$$OK2BLD>0 GEN2
"RTN","RMPOBIL0",83,0)
 K DIR S DIR(0)="E" D ^DIR Q:$$QUIT
"RTN","RMPOBIL0",84,0)
 Q
"RTN","RMPOBIL0",85,0)
GEN2 ;INNER LOOP
"RTN","RMPOBIL0",86,0)
 ;W !,RMPODFN
"RTN","RMPOBIL0",87,0)
 S ZXITM=0
"RTN","RMPOBIL0",88,0)
 F  S ZXITM=$O(^RMPR(665,RMPODFN,"RMPOC",ZXITM)) Q:ZXITM'>0  D
"RTN","RMPOBIL0",89,0)
 . S ZX1=$G(^RMPR(665,RMPODFN,"RMPOC",ZXITM,0))
"RTN","RMPOBIL0",90,0)
 . Q:$P(ZX1,U,2)'=RMPOVDR
"RTN","RMPOBIL0",91,0)
 . D BUILDP,BUILDI
"RTN","RMPOBIL0",92,0)
 Q
"RTN","RMPOBIL0",93,0)
OK2BLD(VENDOR) ; Determine whether to include trx for RMPODFN
"RTN","RMPOBIL0",94,0)
 ;
"RTN","RMPOBIL0",95,0)
 ; Do NOT process if not at correct site.
"RTN","RMPOBIL0",96,0)
 Q:$P($G(^RMPR(665,RMPODFN,"RMPOA")),U,7)'=RMPOXITE -1
"RTN","RMPOBIL0",97,0)
 ;
"RTN","RMPOBIL0",98,0)
 ; Do NOT process if no Boiler-plate
"RTN","RMPOBIL0",99,0)
 Q:'$D(^RMPR(665,RMPODFN,"RMPOA")) -2
"RTN","RMPOBIL0",100,0)
 ;
"RTN","RMPOBIL0",101,0)
 ; Do NOT process if Inactivation date less the billing date.
"RTN","RMPOBIL0",102,0)
 S RMPOINDT=$P($G(^RMPR(665,RMPODFN,"RMPOA")),U,3)
"RTN","RMPOBIL0",103,0)
 I $G(RMPOINDT) Q:RMPOINDT<RMPODATE -3
"RTN","RMPOBIL0",104,0)
 ;Q:$P($G(^RMPR(665,RMPODFN,"RMPOA")),U,3) -3
"RTN","RMPOBIL0",105,0)
 ;
"RTN","RMPOBIL0",106,0)
 ; Do NOT process if Deceased date less the billing date.   ;RMPR*3.0*179 Skip a deceased patient. ^DPT(D0,.35) direct read supported by ICR #10035
"RTN","RMPOBIL0",107,0)
 S RMPOINDT=+$G(^DPT(RMPODFN,.35))
"RTN","RMPOBIL0",108,0)
 I $G(RMPOINDT) Q:RMPOINDT<RMPODATE -9
"RTN","RMPOBIL0",109,0)
 ;
"RTN","RMPOBIL0",110,0)
 ; Do NOT process if no Rx
"RTN","RMPOBIL0",111,0)
 Q:'$D(^RMPR(665,RMPODFN,"RMPOB",0)) -4
"RTN","RMPOBIL0",112,0)
 ;
"RTN","RMPOBIL0",113,0)
 ; 1st find correct Rx
"RTN","RMPOBIL0",114,0)
 S RMPORX=$O(^RMPR(665,RMPODFN,"RMPOB","B"),-1)
"RTN","RMPOBIL0",115,0)
 Q:'RMPORX -5
"RTN","RMPOBIL0",116,0)
 ;
"RTN","RMPOBIL0",117,0)
 ; Quit if the Rx Expiration Date is before the billing period
"RTN","RMPOBIL0",118,0)
 ; Expiration date check removed with patch *147  6/24/2008
"RTN","RMPOBIL0",119,0)
 ;Q:$P(^RMPR(665,RMPODFN,"RMPOB",RMPORX,0),U,3)<(RMPODATE) -6
"RTN","RMPOBIL0",120,0)
 ;
"RTN","RMPOBIL0",121,0)
 ; Quit if there are no items.
"RTN","RMPOBIL0",122,0)
 Q:$O(^RMPR(665,RMPODFN,"RMPOC",0))'>0 -7
"RTN","RMPOBIL0",123,0)
 ;
"RTN","RMPOBIL0",124,0)
 I $G(VENDOR)>0 Q $$VDRSTAT(VENDOR)
"RTN","RMPOBIL0",125,0)
 Q 1
"RTN","RMPOBIL0",126,0)
VDRSTAT(VDR) ;
"RTN","RMPOBIL0",127,0)
 ;
"RTN","RMPOBIL0",128,0)
 S ZXITM=0,FOUND=0
"RTN","RMPOBIL0",129,0)
 F  S ZXITM=$O(^RMPR(665,RMPODFN,"RMPOC",ZXITM)) Q:ZXITM'>0  D
"RTN","RMPOBIL0",130,0)
 . I $P($G(^RMPR(665,RMPODFN,"RMPOC",ZXITM,0)),U,2)=VDR S FOUND=1
"RTN","RMPOBIL0",131,0)
 Q $S(FOUND=1:1,1:-8)
"RTN","RMPOBIL0",132,0)
 Q
"RTN","RMPOBIL0",133,0)
BUILDV ; Set up the VENDOR multiple
"RTN","RMPOBIL0",134,0)
 Q:$D(^RMPO(665.72,RMPOXITE,1,RMPORVDT,1,RMPOVDR))  ; ALREADY DONE...
"RTN","RMPOBIL0",135,0)
 K DA,DIC,DD,DO
"RTN","RMPOBIL0",136,0)
 S DA(2)=RMPOXITE,DA(1)=RMPORVDT,(DINUM,X)=RMPOVDR
"RTN","RMPOBIL0",137,0)
 S DIC="^RMPO(665.72,"_DA(2)_",1,"_DA(1)_",1,"
"RTN","RMPOBIL0",138,0)
 S DIC("P")=$P(^DD(665.723,1,0),U,2),DIC(0)="L"
"RTN","RMPOBIL0",139,0)
 D FILE^DICN
"RTN","RMPOBIL0",140,0)
 Q
"RTN","RMPOBIL0",141,0)
BUILDP ;Now the Patient level
"RTN","RMPOBIL0",142,0)
 Q:$D(^RMPO(665.72,RMPOXITE,1,RMPORVDT,1,RMPOVDR,"V",RMPODFN))  ; DONE
"RTN","RMPOBIL0",143,0)
 K DA,DIC,DD,DO
"RTN","RMPOBIL0",144,0)
 S DA(3)=RMPOXITE,DA(2)=RMPORVDT,DA(1)=RMPOVDR,(DINUM,X)=RMPODFN
"RTN","RMPOBIL0",145,0)
 S DIC("P")=$P(^DD(665.7231,9,0),U,2),DIC(0)="L",ZV=",""V"","
"RTN","RMPOBIL0",146,0)
 S DIC="^RMPO(665.72,"_DA(3)_",1,"_DA(2)_",1,"_DA(1)_ZV
"RTN","RMPOBIL0",147,0)
 D FILE^DICN
"RTN","RMPOBIL0",148,0)
 Q
"RTN","RMPOBIL0",149,0)
 ;
"RTN","RMPOBIL0",150,0)
BUILDI ; BUILD ITEM (REQUIRES ZX1 = ENTIRE ITEM NODE FROM FILE #665)
"RTN","RMPOBIL0",151,0)
 ;Finally, set up the item multiple
"RTN","RMPOBIL0",152,0)
 K DA,DIC,DD,DO,DINUM,DIE,DR
"RTN","RMPOBIL0",153,0)
 S DA(4)=RMPOXITE,DA(3)=RMPORVDT,DA(2)=RMPOVDR,DA(1)=RMPODFN
"RTN","RMPOBIL0",154,0)
 S X=$P(ZX1,U),ZV=",""V"","
"RTN","RMPOBIL0",155,0)
 S DIC="^RMPO(665.72,"_DA(4)_",1,"_DA(3)_",1,"_DA(2)_ZV_DA(1)_",1,"
"RTN","RMPOBIL0",156,0)
 S DIC("P")=$P(^DD(665.72319,1,0),U,2),DIC(0)="L"
"RTN","RMPOBIL0",157,0)
 D FILE^DICN
"RTN","RMPOBIL0",158,0)
 S DIE=DIC,DA=+Y
"RTN","RMPOBIL0",159,0)
 ;Do some calculations
"RTN","RMPOBIL0",160,0)
 ;Multiply the unit cost by the number of units
"RTN","RMPOBIL0",161,0)
 S RMPOTOT=$P(ZX1,U,3)*$P(ZX1,U,4)
"RTN","RMPOBIL0",162,0)
 S RMREMARK=$P(ZX1,U,9)
"RTN","RMPOBIL0",163,0)
 S DR="1////"_$P(ZX1,U,11)             ; PRIMARY ITEM
"RTN","RMPOBIL0",164,0)
 S DR=DR_";2////"_$P(ZX1,U,7)          ; HCPCS CODE
"RTN","RMPOBIL0",165,0)
 S DR=DR_";3////"_$P(ZX1,U,6)          ; FUND CONTROL POINT
"RTN","RMPOBIL0",166,0)
 S DR=DR_";4///^S X=RMREMARK"          ; REMARKS
"RTN","RMPOBIL0",167,0)
 S DR=DR_";5///"_$P(ZX1,U,4)           ; UNIT COST
"RTN","RMPOBIL0",168,0)
 S DR=DR_";6///"_$J($G(RMPOTOT),1,2)   ; TOTAL (QTY X UNIT COST)
"RTN","RMPOBIL0",169,0)
 S DR=DR_";7///"_$P(ZX1,U,3)           ; QUANTITY
"RTN","RMPOBIL0",170,0)
 S DR=DR_";9////"_$P(ZX1,U,8)          ; ICD-9 CODE
"RTN","RMPOBIL0",171,0)
 S DR=DR_";12////"_ZXITM               ; IEN OF ITEM
"RTN","RMPOBIL0",172,0)
 S DR=DR_";13////"_$P(ZX1,U,10)        ; ITEM TYPE
"RTN","RMPOBIL0",173,0)
 S DR=DR_";14////"_$P(ZX1,U,5)         ; UNIT OF ISSUE
"RTN","RMPOBIL0",174,0)
 D ^DIE
"RTN","RMPOBIL0",175,0)
 Q
"RTN","RMPOBIL0",176,0)
PREBILL ; Proper entry point
"RTN","RMPOBIL0",177,0)
 D HOME^%ZIS
"RTN","RMPOBIL0",178,0)
 S (RMEND,RMPOPRT,QUIT)=0
"RTN","RMPOBIL0",179,0)
 D HOSITE^RMPOUTL0 Q:('$D(RMPOXITE))!QUIT
"RTN","RMPOBIL0",180,0)
 D  Q:$D(RMPODATE)=0!QUIT
"RTN","RMPOBIL0",181,0)
 . K DIR,RMPODATE
"RTN","RMPOBIL0",182,0)
 . S DIR(0)="D^^I +X>0,+X'>12 S X=$E(100+X,2,3)_$E(DT,2,3) K Y,%DT D ^%DT"
"RTN","RMPOBIL0",183,0)
 . ;S DIR(0)="D"
"RTN","RMPOBIL0",184,0)
 . S DIR("A")="ENTER BILLING MONTH"
"RTN","RMPOBIL0",185,0)
 . D ^DIR Q:$$QUIT!(Y<1)
"RTN","RMPOBIL0",186,0)
 . S RMPODATE=$E(Y,1,5)_"00"
"RTN","RMPOBIL0",187,0)
 . I Y X ^DD("DD") W ?25,Y
"RTN","RMPOBIL0",188,0)
 . Q
"RTN","RMPOBIL0",189,0)
 S DIC="^RMPR(665,",L=0
"RTN","RMPOBIL0",190,0)
 S BY="[RMPO-BILLING-PRESORT]"
"RTN","RMPOBIL0",191,0)
 S FLDS="[RMPO-BILLING-PRESORT]"
"RTN","RMPOBIL0",192,0)
 S DIS(0)="S RMPODFN=D0,Z=$$OK2BLD^RMPOBIL0 I $D(^RMPR(665,RMPODFN,""RMPOA"")) I (Z'=1)&(Z'=-3)&($P(^RMPR(665,RMPODFN,""RMPOA""),U,7)=RMPOXITE)"
"RTN","RMPOBIL0",193,0)
 S DIOEND="I $G(Y)'[U S RMEND=1 S:IOST[""P-"" RMPOPRT=1"
"RTN","RMPOBIL0",194,0)
 D EN1^DIP
"RTN","RMPOBIL0",195,0)
 I RMPOPRT=0,$G(RMEND) K DIR S DIR(0)="E" D ^DIR
"RTN","RMPOBIL0",196,0)
 D EXIT
"RTN","RMPOBIL0",197,0)
 Q
"RTN","RMPOBIL0",198,0)
BLDSTAT(RMPODFN) ;STATUS OF PT FOR GIVEN BUILD
"RTN","RMPOBIL0",199,0)
 ;
"RTN","RMPOBIL0",200,0)
 S OK=$$OK2BLD($G(RMPOVDR))
"RTN","RMPOBIL0",201,0)
 Q:OK=1 "OK"
"RTN","RMPOBIL0",202,0)
 Q:OK=-1 "Different Home Oxygen Contract Location"
"RTN","RMPOBIL0",203,0)
 Q:OK=-2 "No Home Oxygen Information"
"RTN","RMPOBIL0",204,0)
 Q:OK=-3 "Deactivated"
"RTN","RMPOBIL0",205,0)
 Q:OK=-4 "No RX on file"
"RTN","RMPOBIL0",206,0)
 Q:OK=-5 "No RX on file"
"RTN","RMPOBIL0",207,0)
 Q:OK=-6 "RX expires prior to billing period"
"RTN","RMPOBIL0",208,0)
 Q:OK=-7 "No items on file"
"RTN","RMPOBIL0",209,0)
 Q:OK=-8 "No items for vendor"
"RTN","RMPOBIL0",210,0)
 Q:OK=-9 "Patient deceased, not inactivated"    ;RMPR*3.0*179
"RTN","RMPOBIL0",211,0)
 Q "Other Unknown Error"
"RTN","RMPOBIL0",212,0)
 Q
"RTN","RMPOBIL0",213,0)
EXIT ;Kill variables before quitting
"RTN","RMPOBIL0",214,0)
 N RMPR,RMPRSITE D KILL^XUSCLEAN
"RTN","RMPOBIL0",215,0)
 Q
"VER")
8.0^22.2
"BLD",10163,6)
^166
**END**
**END**

