Released RMPR*3*168 SEQ #152
Extracted from mail message
**KIDS**:RMPR*3.0*168^

**INSTALL NAME**
RMPR*3.0*168
"BLD",8822,0)
RMPR*3.0*168^PROSTHETICS^0^3140813^y
"BLD",8822,1,0)
^9.61A^2^2^3130502^^
"BLD",8822,1,1,0)
Please see the National Patch Module for details of the enhancements
"BLD",8822,1,2,0)
included in this patch.
"BLD",8822,4,0)
^9.64PA^668^3
"BLD",8822,4,660,0)
660
"BLD",8822,4,660,2,0)
^9.641^660^1
"BLD",8822,4,660,2,660,0)
RECORD OF PROS APPLIANCE/REPAIR  (File-top level)
"BLD",8822,4,660,2,660,1,0)
^9.6411^33^5
"BLD",8822,4,660,2,660,1,8.8,0)
SUSPENSE ICD
"BLD",8822,4,660,2,660,1,30,0)
PRIMARY ICD DIAGNOSIS CODE
"BLD",8822,4,660,2,660,1,31,0)
SECONDARY ICD DIAGNOSIS CODE 1
"BLD",8822,4,660,2,660,1,32,0)
SECONDARY ICD DIAGNOSIS 2
"BLD",8822,4,660,2,660,1,33,0)
SECONDARY ICD DIAGNOSIS 3
"BLD",8822,4,660,222)
y^y^p^^^^n^^n
"BLD",8822,4,660,224)

"BLD",8822,4,665,0)
665
"BLD",8822,4,665,2,0)
^9.641^665.194^2
"BLD",8822,4,665,2,665.193,0)
HOME OXYGEN PRESCRIPTION  (sub-file)
"BLD",8822,4,665,2,665.193,1,0)
^9.6411^33^4
"BLD",8822,4,665,2,665.193,1,30,0)
PRIMARY ICD DIAGNOSIS CODE
"BLD",8822,4,665,2,665.193,1,31,0)
SECONDARY ICD DIAGNOSIS CODE 1
"BLD",8822,4,665,2,665.193,1,32,0)
SECONDARY ICD DIAGNOSIS CODE 2
"BLD",8822,4,665,2,665.193,1,33,0)
SECONDARY ICD DIAGNOSIS CODE 3
"BLD",8822,4,665,2,665.194,0)
HOME OXYGEN ITEM  (sub-file)
"BLD",8822,4,665,2,665.194,1,0)
^9.6411^7^1
"BLD",8822,4,665,2,665.194,1,7,0)
ICD CODE
"BLD",8822,4,665,222)
y^y^p^^^^n^^n
"BLD",8822,4,665,224)

"BLD",8822,4,668,0)
668
"BLD",8822,4,668,2,0)
^9.641^668^1
"BLD",8822,4,668,2,668,0)
PROSTHETIC SUSPENSE  (File-top level)
"BLD",8822,4,668,2,668,1,0)
^9.6411^1.6^5
"BLD",8822,4,668,2,668,1,1.6,0)
ICD
"BLD",8822,4,668,2,668,1,30,0)
PRIMARY ICD DIAGNOSIS CODE
"BLD",8822,4,668,2,668,1,31,0)
SECONDARY ICD DIAGNOSIS 1
"BLD",8822,4,668,2,668,1,32,0)
SECONDARY ICD DIAGNOSIS 2
"BLD",8822,4,668,2,668,1,33,0)
SECONDARY ICD DIAGNOSIS 3
"BLD",8822,4,668,222)
y^y^p^^^^n^^n
"BLD",8822,4,668,224)

"BLD",8822,4,"APDD",660,660)

"BLD",8822,4,"APDD",660,660,8.8)

"BLD",8822,4,"APDD",660,660,30)

"BLD",8822,4,"APDD",660,660,31)

"BLD",8822,4,"APDD",660,660,32)

"BLD",8822,4,"APDD",660,660,33)

"BLD",8822,4,"APDD",665,665.193)

"BLD",8822,4,"APDD",665,665.193,30)

"BLD",8822,4,"APDD",665,665.193,31)

"BLD",8822,4,"APDD",665,665.193,32)

"BLD",8822,4,"APDD",665,665.193,33)

"BLD",8822,4,"APDD",665,665.194)

"BLD",8822,4,"APDD",665,665.194,7)

"BLD",8822,4,"APDD",668,668)

"BLD",8822,4,"APDD",668,668,1.6)

"BLD",8822,4,"APDD",668,668,30)

"BLD",8822,4,"APDD",668,668,31)

"BLD",8822,4,"APDD",668,668,32)

"BLD",8822,4,"APDD",668,668,33)

"BLD",8822,4,"B",660,660)

"BLD",8822,4,"B",665,665)

"BLD",8822,4,"B",668,668)

"BLD",8822,6)
1^
"BLD",8822,6.3)
43
"BLD",8822,"KRN",0)
^9.67PA^779.2^20
"BLD",8822,"KRN",.4,0)
.4
"BLD",8822,"KRN",.401,0)
.401
"BLD",8822,"KRN",.402,0)
.402
"BLD",8822,"KRN",.403,0)
.403
"BLD",8822,"KRN",.5,0)
.5
"BLD",8822,"KRN",.84,0)
.84
"BLD",8822,"KRN",3.6,0)
3.6
"BLD",8822,"KRN",3.8,0)
3.8
"BLD",8822,"KRN",9.2,0)
9.2
"BLD",8822,"KRN",9.8,0)
9.8
"BLD",8822,"KRN",9.8,"NM",0)
^9.68A^15^10
"BLD",8822,"KRN",9.8,"NM",1,0)
RMPOPED^^0^B301665198
"BLD",8822,"KRN",9.8,"NM",2,0)
RMPRPAT3^^0^B58098580
"BLD",8822,"KRN",9.8,"NM",3,0)
RMPRSE21^^0^B42297840
"BLD",8822,"KRN",9.8,"NM",6,0)
RMPRPFFS^^0^B39570031
"BLD",8822,"KRN",9.8,"NM",7,0)
RMPR9LN1^^0^B10033385
"BLD",8822,"KRN",9.8,"NM",8,0)
RMPR9LNP^^0^B42337320
"BLD",8822,"KRN",9.8,"NM",9,0)
RMPR9S4E^^0^B55214876
"BLD",8822,"KRN",9.8,"NM",13,0)
RMPOPED1^^0^B3131356
"BLD",8822,"KRN",9.8,"NM",14,0)
RMPOICD1^^0^B142909870
"BLD",8822,"KRN",9.8,"NM",15,0)
RMPOICD2^^0^B43615664
"BLD",8822,"KRN",9.8,"NM","B","RMPOICD1",14)

"BLD",8822,"KRN",9.8,"NM","B","RMPOICD2",15)

"BLD",8822,"KRN",9.8,"NM","B","RMPOPED",1)

"BLD",8822,"KRN",9.8,"NM","B","RMPOPED1",13)

"BLD",8822,"KRN",9.8,"NM","B","RMPR9LN1",7)

"BLD",8822,"KRN",9.8,"NM","B","RMPR9LNP",8)

"BLD",8822,"KRN",9.8,"NM","B","RMPR9S4E",9)

"BLD",8822,"KRN",9.8,"NM","B","RMPRPAT3",2)

"BLD",8822,"KRN",9.8,"NM","B","RMPRPFFS",6)

"BLD",8822,"KRN",9.8,"NM","B","RMPRSE21",3)

"BLD",8822,"KRN",19,0)
19
"BLD",8822,"KRN",19.1,0)
19.1
"BLD",8822,"KRN",101,0)
101
"BLD",8822,"KRN",409.61,0)
409.61
"BLD",8822,"KRN",771,0)
771
"BLD",8822,"KRN",779.2,0)
779.2
"BLD",8822,"KRN",870,0)
870
"BLD",8822,"KRN",8989.51,0)
8989.51
"BLD",8822,"KRN",8989.52,0)
8989.52
"BLD",8822,"KRN",8994,0)
8994
"BLD",8822,"KRN","B",.4,.4)

"BLD",8822,"KRN","B",.401,.401)

"BLD",8822,"KRN","B",.402,.402)

"BLD",8822,"KRN","B",.403,.403)

"BLD",8822,"KRN","B",.5,.5)

"BLD",8822,"KRN","B",.84,.84)

"BLD",8822,"KRN","B",3.6,3.6)

"BLD",8822,"KRN","B",3.8,3.8)

"BLD",8822,"KRN","B",9.2,9.2)

"BLD",8822,"KRN","B",9.8,9.8)

"BLD",8822,"KRN","B",19,19)

"BLD",8822,"KRN","B",19.1,19.1)

"BLD",8822,"KRN","B",101,101)

"BLD",8822,"KRN","B",409.61,409.61)

"BLD",8822,"KRN","B",771,771)

"BLD",8822,"KRN","B",779.2,779.2)

"BLD",8822,"KRN","B",870,870)

"BLD",8822,"KRN","B",8989.51,8989.51)

"BLD",8822,"KRN","B",8989.52,8989.52)

"BLD",8822,"KRN","B",8994,8994)

"BLD",8822,"QDEF")
^^^^NO^^^^NO^^NO
"BLD",8822,"QUES",0)
^9.62^^
"BLD",8822,"REQB",0)
^9.611^12^10
"BLD",8822,"REQB",1,0)
LEX*2.0*80^1
"BLD",8822,"REQB",2,0)
ICD*18.0*57^1
"BLD",8822,"REQB",3,0)
RMPR*3.0*125^1
"BLD",8822,"REQB",4,0)
RMPR*3.0*128^1
"BLD",8822,"REQB",5,0)
RMPR*3.0*148^1
"BLD",8822,"REQB",6,0)
RMPR*3.0*150^1
"BLD",8822,"REQB",8,0)
PX*1.0*199^1
"BLD",8822,"REQB",10,0)
RMPR*3.0*163^1
"BLD",8822,"REQB",11,0)
OR*3.0*361^1
"BLD",8822,"REQB",12,0)
GMRC*3.0*73^1
"BLD",8822,"REQB","B","GMRC*3.0*73",12)

"BLD",8822,"REQB","B","ICD*18.0*57",2)

"BLD",8822,"REQB","B","LEX*2.0*80",1)

"BLD",8822,"REQB","B","OR*3.0*361",11)

"BLD",8822,"REQB","B","PX*1.0*199",8)

"BLD",8822,"REQB","B","RMPR*3.0*125",3)

"BLD",8822,"REQB","B","RMPR*3.0*128",4)

"BLD",8822,"REQB","B","RMPR*3.0*148",5)

"BLD",8822,"REQB","B","RMPR*3.0*150",6)

"BLD",8822,"REQB","B","RMPR*3.0*163",10)

"FIA",660)
RECORD OF PROS APPLIANCE/REPAIR
"FIA",660,0)
^RMPR(660,
"FIA",660,0,0)
660OID
"FIA",660,0,1)
y^y^p^^^^n^^n
"FIA",660,0,10)

"FIA",660,0,11)

"FIA",660,0,"RLRO")

"FIA",660,0,"VR")
3.0^RMPR
"FIA",660,660)
1
"FIA",660,660,8.8)

"FIA",660,660,30)

"FIA",660,660,31)

"FIA",660,660,32)

"FIA",660,660,33)

"FIA",665)
PROSTHETICS PATIENT
"FIA",665,0)
^RMPR(665,
"FIA",665,0,0)
665IP
"FIA",665,0,1)
y^y^p^^^^n^^n
"FIA",665,0,10)

"FIA",665,0,11)

"FIA",665,0,"RLRO")

"FIA",665,0,"VR")
3.0^RMPR
"FIA",665,665)
1
"FIA",665,665.193)
1
"FIA",665,665.193,30)

"FIA",665,665.193,31)

"FIA",665,665.193,32)

"FIA",665,665.193,33)

"FIA",665,665.194)
1
"FIA",665,665.194,7)

"FIA",668)
PROSTHETIC SUSPENSE
"FIA",668,0)
^RMPR(668,
"FIA",668,0,0)
668ID
"FIA",668,0,1)
y^y^p^^^^n^^n
"FIA",668,0,10)

"FIA",668,0,11)

"FIA",668,0,"RLRO")

"FIA",668,0,"VR")
3.0^RMPR
"FIA",668,668)
1
"FIA",668,668,1.6)

"FIA",668,668,30)

"FIA",668,668,31)

"FIA",668,668,32)

"FIA",668,668,33)

"MBREQ")
0
"PKG",140,-1)
1^1
"PKG",140,0)
PROSTHETICS^RMPR^PROSTHETICS VERSION 3.0 ALPHA
"PKG",140,20,0)
^9.402P^^0
"PKG",140,22,0)
^9.49I^1^1
"PKG",140,22,1,0)
3.0^2960209^2960924
"PKG",140,22,1,"PAH",1,0)
168^3140813^100831
"PKG",140,22,1,"PAH",1,1,0)
^^2^2^3140813
"PKG",140,22,1,"PAH",1,1,1,0)
Please see the National Patch Module for details of the enhancements
"PKG",140,22,1,"PAH",1,1,2,0)
included in this patch.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
10
"RTN","RMPOICD1")
0^14^B142909870^n/a
"RTN","RMPOICD1",1,0)
RMPOICD1 ;ALB/MGD - ICD-10 DIAGNOSIS CODE LOOK UP; 12-06-11
"RTN","RMPOICD1",2,0)
 ;;3.0;PROSTHETICS;**168**;Feb 09, 1996;Build 43
"RTN","RMPOICD1",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","RMPOICD1",4,0)
 ;
"RTN","RMPOICD1",5,0)
 ; Reference to $$DIAGSRCH^LEX10CS supported by ICR #5681
"RTN","RMPOICD1",6,0)
 ; Reference to $$IMPDATE^LEXU     supported by ICR #5679
"RTN","RMPOICD1",7,0)
 ; Reference to $$FREQ^LEXU        supported by ICR #5679 
"RTN","RMPOICD1",8,0)
 ; Reference to $$MAX^LEXU         supported by ICR #5679
"RTN","RMPOICD1",9,0)
 ; Reference to LS^ICDEX           supported by ICR #5747
"RTN","RMPOICD1",10,0)
 ; Reference to CSI^ICDEX          supported by ICR #5747
"RTN","RMPOICD1",11,0)
 ;
"RTN","RMPOICD1",12,0)
 ; This routine is based on ^ICDLOOK
"RTN","RMPOICD1",13,0)
 ;
"RTN","RMPOICD1",14,0)
EN ;
"RTN","RMPOICD1",15,0)
 D DEMO
"RTN","RMPOICD1",16,0)
 Q
"RTN","RMPOICD1",17,0)
 ;
"RTN","RMPOICD1",18,0)
 ;this is a demo code,
"RTN","RMPOICD1",19,0)
 ;in your applications you might need to use some or all of the code below,
"RTN","RMPOICD1",20,0)
 ;see comments
"RTN","RMPOICD1",21,0)
DEMO ;
"RTN","RMPOICD1",22,0)
 D INITVARS ;set standards variables, you might not need this if it was already done in your application 
"RTN","RMPOICD1",23,0)
 N RMPQUIT ; to manage demo loop
"RTN","RMPOICD1",24,0)
 N RMPRETV ;to store the selected code information
"RTN","RMPOICD1",25,0)
 N RMPPARAM ; to set your application specific prompts and messages
"RTN","RMPOICD1",26,0)
 N RMPCSYS ;coding system "ICD9" or ICD10"
"RTN","RMPOICD1",27,0)
 N RMPOUT ;to return all available information about the selected code
"RTN","RMPOICD1",28,0)
 N RMPDFLT9 ;default ICD-9 value for demo
"RTN","RMPOICD1",29,0)
 N RMPDFL10 ;default ICD-10 value for demo
"RTN","RMPOICD1",30,0)
 ;settings:
"RTN","RMPOICD1",31,0)
 D SETPARAM(.RMPPARAM) ;edit the SETPARAM subroutine below to set your application specific prompts
"RTN","RMPOICD1",32,0)
 ;starting demo loop
"RTN","RMPOICD1",33,0)
 S RMPQUIT=0 F  Q:RMPQUIT=1  D
"RTN","RMPOICD1",34,0)
 . S RMPRETV=0,RMPOUT=""
"RTN","RMPOICD1",35,0)
 . W @IOF ;reset the screen
"RTN","RMPOICD1",36,0)
 . ;prompt for the date of interest
"RTN","RMPOICD1",37,0)
 . S RMPDT=$$ASKDATE(RMPPARAM("ASKDATE"))
"RTN","RMPOICD1",38,0)
 . I RMPDT=-1 S RMPQUIT=1 Q
"RTN","RMPOICD1",39,0)
 . ;prompt for "try again" with "No" as default if ^ or null entered for the date or if timed out
"RTN","RMPOICD1",40,0)
 . I RMPDT'>0 S:$$QUESTION(2,RMPPARAM("TRY ANOTHER"))'=1 RMPQUIT=1 Q
"RTN","RMPOICD1",41,0)
 . ;determine coding system based on the date of interest 
"RTN","RMPOICD1",42,0)
 . S RMPCSYS=$$ICDSYSDG(RMPDT)
"RTN","RMPOICD1",43,0)
 . ;set default response for your prompt
"RTN","RMPOICD1",44,0)
 . S RMPDFLT9=""
"RTN","RMPOICD1",45,0)
 . S RMPDFL10=""
"RTN","RMPOICD1",46,0)
 . ;run either ICD9 or ICD10 prompt/search/select logic
"RTN","RMPOICD1",47,0)
 . ;ICD9 (1 is a pointer to the ICD-9 diagnosis system entry in the new file #80.4 )
"RTN","RMPOICD1",48,0)
 . I RMPCSYS=1 S RMPRETV=$$DIAG9(RMPDT,RMPDFLT9,.RMPOUT,.RMPPARAM) I RMPRETV=-2 S:$$QUESTION(1,RMPPARAM("TRY ANOTHER"))'=1 RMPQUIT=1 Q
"RTN","RMPOICD1",49,0)
 . ;ICD10 (30 is a pointer to the ICD-10 diagnosis system entry in the new file #80.4 )
"RTN","RMPOICD1",50,0)
 . I RMPCSYS=30 S RMPRETV=$$DIAG10(RMPDT,RMPDFL10,.RMPPARAM)
"RTN","RMPOICD1",51,0)
 . ;display information about the code selected (for demo purposes)
"RTN","RMPOICD1",52,0)
 . I +RMPRETV>0 W !,"SELECTED: " D CODEINFO(RMPRETV) S RMPQUIT=1 Q
"RTN","RMPOICD1",53,0)
 . ;if no data found
"RTN","RMPOICD1",54,0)
 . I +RMPRETV="" W !!,RMPPARAM("NO DATA FOUND") Q
"RTN","RMPOICD1",55,0)
 . ;in ICD10 if the user answered NO for the question "Do you wish to continue(Y/N)?"
"RTN","RMPOICD1",56,0)
 . I +RMPRETV=-4 S RMPQUIT=1 Q
"RTN","RMPOICD1",57,0)
 . ;no changes to the default value 
"RTN","RMPOICD1",58,0)
 . I +RMPRETV=-5 S RMPQUIT=1 Q
"RTN","RMPOICD1",59,0)
 . ;no data or was aborted 
"RTN","RMPOICD1",60,0)
 . I +RMPRETV=-2 S RMPQUIT=1 Q
"RTN","RMPOICD1",61,0)
 . ;if exit due to ^ in the ICD Diagnosis code prompt 
"RTN","RMPOICD1",62,0)
 . I +RMPRETV=-3 S RMPQUIT=1 Q
"RTN","RMPOICD1",63,0)
 . ;if no data found
"RTN","RMPOICD1",64,0)
 . I +RMPRETV=-1,$P(RMPRETV,U,2)=-1 S RMPQUIT=1 Q
"RTN","RMPOICD1",65,0)
 . ;user entered "@" to delete the currently selected ICD code 
"RTN","RMPOICD1",66,0)
 . I +RMPRETV=-6 W !,RMPPARAM("DELETE IT"),! S:$$QUESTION(1,RMPPARAM("TRY ANOTHER"))'=1 RMPQUIT=1 Q
"RTN","RMPOICD1",67,0)
 . ; if continue search
"RTN","RMPOICD1",68,0)
 Q
"RTN","RMPOICD1",69,0)
 ;
"RTN","RMPOICD1",70,0)
 ;//---------
"RTN","RMPOICD1",71,0)
 ;The entry point for ICD-10 diagnosis search functionality
"RTN","RMPOICD1",72,0)
 ;can be called from applications directly
"RTN","RMPOICD1",73,0)
 ;input parameters :
"RTN","RMPOICD1",74,0)
 ; RMPDT - date of interest (Fileman format)
"RTN","RMPOICD1",75,0)
 ; RMPDFLT - default values for the search string (can be a code by default)
"RTN","RMPOICD1",76,0)
 ; RMPPARAM - parameters/string constants (see SETPARAM for details)
"RTN","RMPOICD1",77,0)
 ;returns ICD-10 code selected by the user:
"RTN","RMPOICD1",78,0)
 ; IEN file #80;ICD code value;IEN file # 757.01^description
"RTN","RMPOICD1",79,0)
 ; results
"RTN","RMPOICD1",80,0)
 ; or -1 if invalid data(press enter)
"RTN","RMPOICD1",81,0)
 ; "" if not found 
"RTN","RMPOICD1",82,0)
 ; or -2 if time out
"RTN","RMPOICD1",83,0)
 ; or -3 if ^ or ^^
"RTN","RMPOICD1",84,0)
 ; or -4 in ICD10 if the user answered NO for the question "Do you wish to continue(Y/N)?"
"RTN","RMPOICD1",85,0)
 ; or -5 if no changes to the default value
"RTN","RMPOICD1",86,0)
DIAG10(RMPDT,RMPDFLT,RMPPARAM) ;
"RTN","RMPOICD1",87,0)
 N RMPINP
"RTN","RMPOICD1",88,0)
 F  D  Q:RMPINP<0!($L($P(RMPINP,U,2))>1)
"RTN","RMPOICD1",89,0)
 .S RMPINP=$$SRCHSTR(RMPPARAM("SEARCH_PROMPT"),RMPPARAM("HELP ?"),RMPPARAM("HELP ??"),RMPDFLT)
"RTN","RMPOICD1",90,0)
 .I RMPINP'<0 I $L($P(RMPINP,U,2))'>1 W !!,RMPPARAM("ENTER MORE") W:$L(RMPPARAM("ENTER MORE2"))>0 !,RMPPARAM("ENTER MORE2") W ! ;user should enter at least 2 characters
"RTN","RMPOICD1",91,0)
 I RMPINP<0 Q RMPINP_"^-1"
"RTN","RMPOICD1",92,0)
 Q $$LEXICD10($P(RMPINP,U,2),RMPDT,.RMPPARAM)
"RTN","RMPOICD1",93,0)
 ;
"RTN","RMPOICD1",94,0)
 ;//---------
"RTN","RMPOICD1",95,0)
 ;The entry point for ICD-9 FileMan type (^DIC) diagnosis search functionality
"RTN","RMPOICD1",96,0)
 ;can be called from applications directly
"RTN","RMPOICD1",97,0)
 ;input parameters :
"RTN","RMPOICD1",98,0)
 ; RMPDT - date of interest
"RTN","RMPOICD1",99,0)
 ; RMPDFLT - default values for the search string (can be a code by default)
"RTN","RMPOICD1",100,0)
 ; RMPOUT - local array to return results(passed as a reference)
"RTN","RMPOICD1",101,0)
 ; RMPPARAM - parameters/string constants (see SETPARAM for details)
"RTN","RMPOICD1",102,0)
 ;returns ICD-9 code selected by the user:
"RTN","RMPOICD1",103,0)
 ; IEN file #80;ICD code value^description
"RTN","RMPOICD1",104,0)
 ; -1 no data or was aborted
"RTN","RMPOICD1",105,0)
 ; -2 if timeout 
"RTN","RMPOICD1",106,0)
 ; -3 was aborted
"RTN","RMPOICD1",107,0)
 ; -5 if no changes to the default value
"RTN","RMPOICD1",108,0)
DIAG9(RMPDT,RMPDFLT,RMPOUT,RMPPARAM) ;
"RTN","RMPOICD1",109,0)
 N RMPINP,RMPRETV
"RTN","RMPOICD1",110,0)
 S RMPRETV=$$ICD9(RMPDFLT,RMPDT,.RMPOUT,RMPPARAM("SEARCH_PROMPT"))
"RTN","RMPOICD1",111,0)
 Q RMPRETV
"RTN","RMPOICD1",112,0)
 ;
"RTN","RMPOICD1",113,0)
 ;--------------
"RTN","RMPOICD1",114,0)
 ;The entry point for ICD-10 diagnosis search functionality
"RTN","RMPOICD1",115,0)
 ;can be called from applications directly
"RTN","RMPOICD1",116,0)
 ; Supported ICR 5681 ($$DIAGSRCH^LEX10CS)
"RTN","RMPOICD1",117,0)
 ;input parameters :
"RTN","RMPOICD1",118,0)
 ; RMPTXT - search string
"RTN","RMPOICD1",119,0)
 ; RMPDATE - date of interest
"RTN","RMPOICD1",120,0)
 ; RMPPAR - array with text messages and other string constants
"RTN","RMPOICD1",121,0)
 ;returns ICD-10 code selected by the user:
"RTN","RMPOICD1",122,0)
 ; IEN file #80;ICD code value^description
"RTN","RMPOICD1",123,0)
 ; or 
"RTN","RMPOICD1",124,0)
 ; "" if not found 
"RTN","RMPOICD1",125,0)
 ; -1 if exit : ^ or ^^
"RTN","RMPOICD1",126,0)
 ; -2 if continue searching
"RTN","RMPOICD1",127,0)
 ;
"RTN","RMPOICD1",128,0)
LEXICD10(RMPTXT,RMPDATE,RMPPAR) ; ICD-10 Search
"RTN","RMPOICD1",129,0)
 N RMPLVTXT
"RTN","RMPOICD1",130,0)
 ;parameters check
"RTN","RMPOICD1",131,0)
 S RMPDATE=+$G(RMPDATE)
"RTN","RMPOICD1",132,0)
 I RMPDATE'?7N Q -1
"RTN","RMPOICD1",133,0)
 S RMPTXT=$G(RMPTXT)
"RTN","RMPOICD1",134,0)
 Q:'$L(RMPTXT) -1
"RTN","RMPOICD1",135,0)
 N RMPNUMB
"RTN","RMPOICD1",136,0)
 S RMPNUMB=$$FREQ^LEXU(RMPTXT) ; Supported ICR #5679
"RTN","RMPOICD1",137,0)
 I RMPNUMB>$$MAX^LEXU(30) D  I $$QUESTION(2,RMPPAR("WISH CONTINUE"))'=1 Q -4  ; Supported ICR #5679
"RTN","RMPOICD1",138,0)
 . W !
"RTN","RMPOICD1",139,0)
 . D FORMWRIT(RMPPAR("EXCEEDS MESSAGE1")_RMPTXT_RMPPAR("EXCEEDS MESSAGE2")_RMPNUMB_RMPPAR("EXCEEDS MESSAGE3")_RMPTXT_""".",0)
"RTN","RMPOICD1",140,0)
 . D FORMWRIT("",2)
"RTN","RMPOICD1",141,0)
 . W !
"RTN","RMPOICD1",142,0)
 ;new and set variables
"RTN","RMPOICD1",143,0)
 N DIROUT,DUOUT,DTOUT,RMPEXIT,RMPICDNT
"RTN","RMPOICD1",144,0)
 N RMPRETV,RMPXX,RMPLEVEL
"RTN","RMPOICD1",145,0)
 S RMPRETV=""
"RTN","RMPOICD1",146,0)
 S RMPEXIT=0
"RTN","RMPOICD1",147,0)
 S RMPLEVEL=1,RMPLVTXT(RMPLEVEL)=RMPTXT ;level 1 stores the original search string
"RTN","RMPOICD1",148,0)
 ; main loop
"RTN","RMPOICD1",149,0)
 F  Q:RMPEXIT>0  D
"RTN","RMPOICD1",150,0)
 .K RMPICDY
"RTN","RMPOICD1",151,0)
 .;W !,"Level #: ",RMPLEVEL,", search string: ",RMPLVTXT(RMPLEVEL)
"RTN","RMPOICD1",152,0)
 .;get the search string from the current level and call LEX API
"RTN","RMPOICD1",153,0)
 .S RMPICDY=$$DIAGSRCH^LEX10CS(RMPLVTXT(RMPLEVEL),.RMPICDY,RMPDATE,30) ; Supported ICR #5681
"RTN","RMPOICD1",154,0)
 .;W !,"Search for: ",RMPLVTXT(RMPLEVEL),"Date: ",RMPDATE,!! ZW RMPICDY W @IOF
"RTN","RMPOICD1",155,0)
 .S:$O(RMPICDY(" "),-1)>0 RMPICDY=+RMPICDY
"RTN","RMPOICD1",156,0)
 .; Nothing found
"RTN","RMPOICD1",157,0)
 .I +RMPICDY'>0 S RMPEXIT=1 S RMPXX=-1 Q
"RTN","RMPOICD1",158,0)
 .; display the list of items and ask the user to select the item from the list
"RTN","RMPOICD1",159,0)
 .S RMPXX=$$SEL^RMPOICD2(.RMPICDY,8)
"RTN","RMPOICD1",160,0)
 .; if ^ was entered 
"RTN","RMPOICD1",161,0)
 .; if this is on the top level then quit 
"RTN","RMPOICD1",162,0)
 .I RMPXX=-2,RMPLEVEL'>1 S RMPRETV=-1 S RMPEXIT=1 Q
"RTN","RMPOICD1",163,0)
 .; if lower level then go one level up
"RTN","RMPOICD1",164,0)
 .I RMPXX=-2,RMPLEVEL>1 S:RMPLEVEL>1 RMPLEVEL=RMPLEVEL-1 Q
"RTN","RMPOICD1",165,0)
 .; If timeout, or not selected, or ^^ then quit
"RTN","RMPOICD1",166,0)
 .I RMPXX=-1 S RMPRETV=-1 S RMPEXIT=1 Q
"RTN","RMPOICD1",167,0)
 .; if Code Found and Selected by the user save selection in RMPRETV and quit
"RTN","RMPOICD1",168,0)
 .I $P(RMPXX,";")'="99:CAT" S RMPRETV=RMPXX S RMPEXIT=1 Q
"RTN","RMPOICD1",169,0)
 .; If Category Found and Selected by the user: 
"RTN","RMPOICD1",170,0)
 .; go to the next inner level
"RTN","RMPOICD1",171,0)
 .; change level number 
"RTN","RMPOICD1",172,0)
 .S RMPLEVEL=RMPLEVEL+1
"RTN","RMPOICD1",173,0)
 .; set the new level with the new search string
"RTN","RMPOICD1",174,0)
 .; and repeat 
"RTN","RMPOICD1",175,0)
 .S RMPLVTXT(RMPLEVEL)=$P($P($G(RMPXX),"^"),";",2)
"RTN","RMPOICD1",176,0)
 Q RMPRETV
"RTN","RMPOICD1",177,0)
 ;----------
"RTN","RMPOICD1",178,0)
 ;ICD-9 lookup (FileMan lookup)
"RTN","RMPOICD1",179,0)
 ;Supported ICR 5773 (FileMan lookup for files #80 and #80.1)
"RTN","RMPOICD1",180,0)
 ;input parameters :
"RTN","RMPOICD1",181,0)
 ; RMPSRCH - search string/ default values
"RTN","RMPOICD1",182,0)
 ; RMPICDT - date of interest 
"RTN","RMPOICD1",183,0)
 ; RMPOUT - local array to return detailed info (passed as a reference)
"RTN","RMPOICD1",184,0)
 ; RMPPRMT - prompt
"RTN","RMPOICD1",185,0)
 ;returns ICD-9 code selected by the user:
"RTN","RMPOICD1",186,0)
 ; IEN file #80;ICD code value^description
"RTN","RMPOICD1",187,0)
 ; or 
"RTN","RMPOICD1",188,0)
 ; -1 if exit : ^ or ^^
"RTN","RMPOICD1",189,0)
 ; -2 if no results (timeout)
"RTN","RMPOICD1",190,0)
 ;the array RMPOUT returns details if the return value >0, here is an example: 
"RTN","RMPOICD1",191,0)
 ; RMPOUT="6065^814.14"
"RTN","RMPOICD1",192,0)
 ; RMPOUT(0)=814.14
"RTN","RMPOICD1",193,0)
 ; RMPOUT(0,0)=814.14
"RTN","RMPOICD1",194,0)
 ; RMPOUT(0,1)="6065^814.14^^FX PISIFORM-OPEN^^8^^1^^1^^^0^^^^2781001^^1^1"
"RTN","RMPOICD1",195,0)
 ; RMPOUT(0,2)="OPEN FRACTURE OF PISIFORM BONE OF WRIST"
"RTN","RMPOICD1",196,0)
 ;Note: this API is not silent because the ICD lookup is not silent
"RTN","RMPOICD1",197,0)
ICD9(RMPSRCH,RMPICDT,RMPOUT) ;
"RTN","RMPOICD1",198,0)
 N KEY,X,Y,DIC,RMPCDS
"RTN","RMPOICD1",199,0)
 ;KEY must be newed as ICD lookup code doesn't kill it
"RTN","RMPOICD1",200,0)
 S DIC="^ICD9(",DIC(0)="EQMNZIA"
"RTN","RMPOICD1",201,0)
 S:$G(RMPPRMT)]"" DIC("A")=RMPPRMT
"RTN","RMPOICD1",202,0)
 S:$G(RMPSRCH)]"" DIC("B")=RMPSRCH
"RTN","RMPOICD1",203,0)
 S RMPCDS="ICD9"
"RTN","RMPOICD1",204,0)
 ;note: you must use Y for the 2nd parameter of $$LS^ICDEX & $$CSI^ICDEX
"RTN","RMPOICD1",205,0)
 S DIC("S")="I $$LS^ICDEX(80,+Y,RMPICDT)>0,$$CSI^ICDEX(80,+Y)=1"
"RTN","RMPOICD1",206,0)
 D ^DIC
"RTN","RMPOICD1",207,0)
 M RMPOUT=Y
"RTN","RMPOICD1",208,0)
 I $G(Y) Q $S($D(DTOUT):-2,$D(DUOUT):-1,$D(DUOUT):-1,Y=-1:-1,Y=-5:"",1:+Y_";"_$P(Y,U,2)_U_$G(Y(0,2)))
"RTN","RMPOICD1",209,0)
 Q X
"RTN","RMPOICD1",210,0)
 ;
"RTN","RMPOICD1",211,0)
 ;---------
"RTN","RMPOICD1",212,0)
 ; Clean up environment and quit
"RTN","RMPOICD1",213,0)
EXIT ;
"RTN","RMPOICD1",214,0)
 K %,DIC,DIR,DIROUT,DIRUT,DTOUT,DUOUT,X,Y
"RTN","RMPOICD1",215,0)
 Q
"RTN","RMPOICD1",216,0)
 ;
"RTN","RMPOICD1",217,0)
 ;-----------
"RTN","RMPOICD1",218,0)
 ; Look-up help for ?
"RTN","RMPOICD1",219,0)
INPHLP ;
"RTN","RMPOICD1",220,0)
 I $G(X)["???" D INPHLP3 Q
"RTN","RMPOICD1",221,0)
 I $G(X)["??" D INPHLP2 Q
"RTN","RMPOICD1",222,0)
 W !," Enter code or ""text"" for more information." Q
"RTN","RMPOICD1",223,0)
 Q
"RTN","RMPOICD1",224,0)
 ;-----------
"RTN","RMPOICD1",225,0)
 ; Look-up help for ??
"RTN","RMPOICD1",226,0)
INPHLP2 ;
"RTN","RMPOICD1",227,0)
 W !," Enter a ""free text"" term or part of a term such as ""femur fracture""."
"RTN","RMPOICD1",228,0)
 W !!," or "
"RTN","RMPOICD1",229,0)
 W !!," Enter a ""classification code"" (ICD/CPT etc) to find the single term"
"RTN","RMPOICD1",230,0)
 W !," associated with the code."
"RTN","RMPOICD1",231,0)
 W !!," or "
"RTN","RMPOICD1",232,0)
 W !!," Enter a ""partial code"". Include the decimal when a search criterion"
"RTN","RMPOICD1",233,0)
 W !," includes 3 characters or more for code searches."
"RTN","RMPOICD1",234,0)
 Q
"RTN","RMPOICD1",235,0)
 ;--------
"RTN","RMPOICD1",236,0)
 ; Look-up help for ???
"RTN","RMPOICD1",237,0)
INPHLP3 ;
"RTN","RMPOICD1",238,0)
 W !," Number of Code Matches"
"RTN","RMPOICD1",239,0)
 W !," ----------------------"
"RTN","RMPOICD1",240,0)
 W !!," The ICD-10 Diagnosis Code search will show the user the number of matches"
"RTN","RMPOICD1",241,0)
 W !," found, indicate if additional characters in ICD code exist, and the number"
"RTN","RMPOICD1",242,0)
 W !," of codes within the category or subcategory that are available for selection."
"RTN","RMPOICD1",243,0)
 W !," For example:"
"RTN","RMPOICD1",244,0)
 W !!," 14 matches found"
"RTN","RMPOICD1",245,0)
 W !!," M91. - Juvenile osteochondrosis of hip and pelvis (19)"
"RTN","RMPOICD1",246,0)
 W !!," This indicates that 14 unique matches or matching groups have been found"
"RTN","RMPOICD1",247,0)
 W !," and will be displayed."
"RTN","RMPOICD1",248,0)
 W !!," M91. - the ""-"" indicates that there are additional characters that specify"
"RTN","RMPOICD1",249,0)
 W !," unique ICD-10 codes available."
"RTN","RMPOICD1",250,0)
 W !!," (19) Indicates that there are 19 additional ICD-10 codes in the M91 ""family"""
"RTN","RMPOICD1",251,0)
 W !," that are possible selections."
"RTN","RMPOICD1",252,0)
 Q
"RTN","RMPOICD1",253,0)
 ;--------
"RTN","RMPOICD1",254,0)
 ;prompt the user for a date of interest 
"RTN","RMPOICD1",255,0)
 ;input parameters :
"RTN","RMPOICD1",256,0)
 ; RMPPRMT - prompt
"RTN","RMPOICD1",257,0)
 ;returns YYYMMDD
"RTN","RMPOICD1",258,0)
 ; or -1 if invalid date
"RTN","RMPOICD1",259,0)
 ; or -2 if time out
"RTN","RMPOICD1",260,0)
 ; or -3 if ^
"RTN","RMPOICD1",261,0)
ASKDATE(RMPPRMT) ;
"RTN","RMPOICD1",262,0)
 N %DT,DIROUT,DUOUT,DTOUT
"RTN","RMPOICD1",263,0)
 S %DT="AEX",%DT("A")=$G(RMPPRMT,"Enter a date: ")
"RTN","RMPOICD1",264,0)
 D ^%DT
"RTN","RMPOICD1",265,0)
 Q:Y<0 -1
"RTN","RMPOICD1",266,0)
 Q:$D(DTOUT) -2
"RTN","RMPOICD1",267,0)
 Q:X="^" -3
"RTN","RMPOICD1",268,0)
 Q (+Y)
"RTN","RMPOICD1",269,0)
 ;--------
"RTN","RMPOICD1",270,0)
 ;ask YES/NO questions
"RTN","RMPOICD1",271,0)
 ;input parameters :
"RTN","RMPOICD1",272,0)
 ; RMPDFLT- 0/null- not default, 1- yes, 2 -no
"RTN","RMPOICD1",273,0)
 ; RMPPROM - prompt string
"RTN","RMPOICD1",274,0)
 ;returns 
"RTN","RMPOICD1",275,0)
 ; 2 - no,
"RTN","RMPOICD1",276,0)
 ; 1 - yes,
"RTN","RMPOICD1",277,0)
 ; 0 - no answer (time out)
"RTN","RMPOICD1",278,0)
 ; -3 - ^ or ^^
"RTN","RMPOICD1",279,0)
QUESTION(RMPDFLT,RMPPROM,RMPHELP) ;
"RTN","RMPOICD1",280,0)
 N DIR
"RTN","RMPOICD1",281,0)
 S %=$G(RMPDFLT,2)
"RTN","RMPOICD1",282,0)
 S DIR(0)="Y",DIR("A")=RMPPROM,DIR("B")=$S(%=1:"Yes",%=2:"No",1:"")
"RTN","RMPOICD1",283,0)
 S:$L($G(RMPHELP)) DIR("?")=RMPHELP
"RTN","RMPOICD1",284,0)
 D ^DIR
"RTN","RMPOICD1",285,0)
 Q:Y["^" -3
"RTN","RMPOICD1",286,0)
 Q:Y=1 1
"RTN","RMPOICD1",287,0)
 Q:Y=0 2
"RTN","RMPOICD1",288,0)
 Q 0
"RTN","RMPOICD1",289,0)
 ;
"RTN","RMPOICD1",290,0)
 ;------------
"RTN","RMPOICD1",291,0)
 ;get search string
"RTN","RMPOICD1",292,0)
 ;input parameters :
"RTN","RMPOICD1",293,0)
 ; RMPPRMT prompt text
"RTN","RMPOICD1",294,0)
 ; RMPHLP1 "?" help text
"RTN","RMPOICD1",295,0)
 ; RMPHLP2 "??" help text
"RTN","RMPOICD1",296,0)
 ; RMPDFLT- default response
"RTN","RMPOICD1",297,0)
 ;returns piece1 ^ piece 2
"RTN","RMPOICD1",298,0)
 ; piece1:
"RTN","RMPOICD1",299,0)
 ; 0 if normal input
"RTN","RMPOICD1",300,0)
 ; or -1 if invalid data
"RTN","RMPOICD1",301,0)
 ; or -2 if time out
"RTN","RMPOICD1",302,0)
 ; or -3 if ^
"RTN","RMPOICD1",303,0)
 ; or -5 if user accepts default value then no need to validate it
"RTN","RMPOICD1",304,0)
 ; or -6 if user enters "@"
"RTN","RMPOICD1",305,0)
 ; piece2: string entered by the user
"RTN","RMPOICD1",306,0)
SRCHSTR(RMPPRMT,RMPHLP1,RMPHLP2,RMPDFLT) ;
"RTN","RMPOICD1",307,0)
 N DIR
"RTN","RMPOICD1",308,0)
 S DIR("A")=RMPPRMT
"RTN","RMPOICD1",309,0)
 S:($G(RMPHLP1)]"") DIR("?")=RMPHLP1
"RTN","RMPOICD1",310,0)
 S:($G(RMPHLP2)]"") DIR("??")=RMPHLP2
"RTN","RMPOICD1",311,0)
 I $L($G(RMPDFLT)) S DIR("B")=RMPDFLT
"RTN","RMPOICD1",312,0)
 S DIR(0)="FAOr^0:245"
"RTN","RMPOICD1",313,0)
 D ^DIR
"RTN","RMPOICD1",314,0)
 Q:$D(DTOUT) -2
"RTN","RMPOICD1",315,0)
 Q:$D(DUOUT) -3
"RTN","RMPOICD1",316,0)
 Q:X="@" -6 ;quit if user entered "@" and handle deletion case in your application
"RTN","RMPOICD1",317,0)
 Q:Y["^" -3
"RTN","RMPOICD1",318,0)
 Q:Y="" -1
"RTN","RMPOICD1",319,0)
 Q:(($L($G(RMPDFLT)))&(Y=RMPDFLT)) -5 ;if user accepts default value then no need to validate it
"RTN","RMPOICD1",320,0)
 Q 0_U_Y
"RTN","RMPOICD1",321,0)
 ;
"RTN","RMPOICD1",322,0)
 ;----------
"RTN","RMPOICD1",323,0)
 ;Determines and returns ACTIVE coding system for DIAGNOSES based on date of interest 
"RTN","RMPOICD1",324,0)
 ;input parameters :
"RTN","RMPOICD1",325,0)
 ; RMPICDD - date of interest
"RTN","RMPOICD1",326,0)
 ; if date of interest is null, today's date will be assumed
"RTN","RMPOICD1",327,0)
 ;returns coding system 
"RTN","RMPOICD1",328,0)
 ; as a pointer to the ICD CODING SYSTEM file #80.4 (supported ICR 5780) 
"RTN","RMPOICD1",329,0)
 ; 30 if ICD-10-CM is active system
"RTN","RMPOICD1",330,0)
 ; 1 if ICD-9-CM is active system
"RTN","RMPOICD1",331,0)
ICDSYSDG(RMPICDD) ; 
"RTN","RMPOICD1",332,0)
 N RMPIMPDT
"RTN","RMPOICD1",333,0)
 S RMPICDD=$S(RMPICDD<0!($L(+RMPICDD)'=7):DT,1:+$G(RMPICDD))
"RTN","RMPOICD1",334,0)
 S RMPIMPDT=$$IMPDATE^LEXU("10D")
"RTN","RMPOICD1",335,0)
 Q $S(RMPICDD'<RMPIMPDT:30,1:1)
"RTN","RMPOICD1",336,0)
 ;
"RTN","RMPOICD1",337,0)
 ;set parameters
"RTN","RMPOICD1",338,0)
 ;edit these hardcoded strings that are used for prompts, messages and so on to adjust them to your application's needs
"RTN","RMPOICD1",339,0)
 ;input parameters 
"RTN","RMPOICD1",340,0)
 ; RMPPAR - local array to set and store string constants for your messages and prompts 
"RTN","RMPOICD1",341,0)
SETPARAM(RMPPAR) ;
"RTN","RMPOICD1",342,0)
 S RMPPAR("SEARCH_PROMPT")="ICD-10 DIAGNOSIS CODE: "
"RTN","RMPOICD1",343,0)
 S RMPPAR("HELP ?")="^D INPHLP^RMPOICD1"
"RTN","RMPOICD1",344,0)
 S RMPPAR("HELP ??")="^D INPHLP2^RMPOICD1"
"RTN","RMPOICD1",345,0)
 S RMPPAR("NO DATA FOUND")=" No data found"
"RTN","RMPOICD1",346,0)
 S RMPPAR("EXITING")=" Exiting"
"RTN","RMPOICD1",347,0)
 S RMPPAR("TRY LATER")=" Try again later"
"RTN","RMPOICD1",348,0)
 S RMPPAR("NO DATA SELECTED")=" No data selected"
"RTN","RMPOICD1",349,0)
 S RMPPAR("TRY ANOTHER")="Try another"
"RTN","RMPOICD1",350,0)
 S RMPPAR("WISH CONTINUE")="Do you wish to continue(Y/N)"
"RTN","RMPOICD1",351,0)
 S RMPPAR("EXCEEDS MESSAGE1")="Searching for """
"RTN","RMPOICD1",352,0)
 S RMPPAR("EXCEEDS MESSAGE2")=""" requires inspecting "
"RTN","RMPOICD1",353,0)
 S RMPPAR("EXCEEDS MESSAGE3")=" records to determine if they match the search criteria. This could take quite some time. Suggest refining the search by further specifying """
"RTN","RMPOICD1",354,0)
 S RMPPAR("NO CHANGES")=" No changes made"
"RTN","RMPOICD1",355,0)
 S RMPPAR("DELETE IT")="   SURE YOU WANT TO DELETE"
"RTN","RMPOICD1",356,0)
 S RMPPAR("ENTER MORE")=" Please enter at least the first two characters of the ICD-10 code or code"
"RTN","RMPOICD1",357,0)
 S RMPPAR("ENTER MORE2")=" description to start the search."
"RTN","RMPOICD1",358,0)
 S RMPPAR("YES OR NO")="Answer 'Y' for 'Yes' or 'N' for 'No'"
"RTN","RMPOICD1",359,0)
 Q
"RTN","RMPOICD1",360,0)
 ;
"RTN","RMPOICD1",361,0)
 ;
"RTN","RMPOICD1",362,0)
 ;a wrapper for ^DIWP
"RTN","RMPOICD1",363,0)
 ;accumulates a text and then writes it to the device
"RTN","RMPOICD1",364,0)
 ;input parameters :
"RTN","RMPOICD1",365,0)
 ; X - text
"RTN","RMPOICD1",366,0)
 ; RMPMODE:
"RTN","RMPOICD1",367,0)
 ; 0 - start
"RTN","RMPOICD1",368,0)
 ; 1 - accumulate 
"RTN","RMPOICD1",369,0)
 ; 2 - write
"RTN","RMPOICD1",370,0)
 ;example:
"RTN","RMPOICD1",371,0)
 ;D FORMWRIT^ZZLXDG("this API is a wrapper for ^DIWP, it accumulates a text and then writes it to the device, you can use it in your application code",0)
"RTN","RMPOICD1",372,0)
 ;D FORMWRIT^ZZLXDG("some more text ",1)
"RTN","RMPOICD1",373,0)
 ;D FORMWRIT^ZZLXDG("",2)
"RTN","RMPOICD1",374,0)
FORMWRIT(X,RMPMODE) ;
"RTN","RMPOICD1",375,0)
 N RMPLI1
"RTN","RMPOICD1",376,0)
 ;if "start" mode
"RTN","RMPOICD1",377,0)
 I RMPMODE=0 K ^UTILITY($J,"W")
"RTN","RMPOICD1",378,0)
 S DIWL=1,DIWR=79
"RTN","RMPOICD1",379,0)
 I $L(X)>0 D ^DIWP
"RTN","RMPOICD1",380,0)
 ;if "write" mode
"RTN","RMPOICD1",381,0)
 I RMPMODE=2 D
"RTN","RMPOICD1",382,0)
 . S RMPLI1=0 F  S RMPLI1=$O(^UTILITY($J,"W",1,RMPLI1)) Q:+RMPLI1=0  W !,$G(^UTILITY($J,"W",1,RMPLI1,0))
"RTN","RMPOICD1",383,0)
 . K ^UTILITY($J,"W")
"RTN","RMPOICD1",384,0)
 Q
"RTN","RMPOICD1",385,0)
 ;
"RTN","RMPOICD1",386,0)
 ;---------------
"RTN","RMPOICD1",387,0)
 ;Initialize variables if you need , your application most likely already has this
"RTN","RMPOICD1",388,0)
INITVARS ;
"RTN","RMPOICD1",389,0)
 D HOME^%ZIS
"RTN","RMPOICD1",390,0)
 S:$G(DT)=0 DT=$$DT^XLFDT
"RTN","RMPOICD1",391,0)
 Q
"RTN","RMPOICD1",392,0)
 ;press any key (used for demo)
"RTN","RMPOICD1",393,0)
PRESSKEY ;
"RTN","RMPOICD1",394,0)
 R !!,"Press any key to continue.",RMPKEY:DTIME
"RTN","RMPOICD1",395,0)
 Q
"RTN","RMPOICD1",396,0)
 ;display code info (used for demo)
"RTN","RMPOICD1",397,0)
CODEINFO(RMPXX2) ; Write Output
"RTN","RMPOICD1",398,0)
 N RMPKEY
"RTN","RMPOICD1",399,0)
 W !," ICD Diagnosis code:",?30,$P(RMPXX2,";",2)
"RTN","RMPOICD1",400,0)
 W !," ICD Diagnosis code IEN:",?30,$P(RMPXX2,";",1)
"RTN","RMPOICD1",401,0)
 W !," Lexicon Expression IEN:",?30,+$P(RMPXX2,";",3)
"RTN","RMPOICD1",402,0)
 W !," ICD Diagnosis description:",?30,$P(RMPXX2,"^",2)
"RTN","RMPOICD1",403,0)
 Q
"RTN","RMPOICD1",404,0)
 ;
"RTN","RMPOICD2")
0^15^B43615664^n/a
"RTN","RMPOICD2",1,0)
RMPOICD2 ;ALB/MGD - Select ICD DIAGNOSIS FROM LEXICON UTILITY LIST ;12/07/2011
"RTN","RMPOICD2",2,0)
 ;;3.0;PROSTHETICS;**168**;Feb 09, 1996;Build 43
"RTN","RMPOICD2",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","RMPOICD2",4,0)
 ;
"RTN","RMPOICD2",5,0)
 ;
"RTN","RMPOICD2",6,0)
 ;
"RTN","RMPOICD2",7,0)
 ; Input   
"RTN","RMPOICD2",8,0)
 ; 
"RTN","RMPOICD2",9,0)
 ;     X     Length of list to display (default 5)
"RTN","RMPOICD2",10,0)
 ;    .RMPSRL   Local array passed by reference
"RTN","RMPOICD2",11,0)
 ;               
"RTN","RMPOICD2",12,0)
 ;             RMPSRL()   Input Array from ICDSRCH^LEX10CS
"RTN","RMPOICD2",13,0)
 ;               
"RTN","RMPOICD2",14,0)
 ;             RMPSRL(0)=# found ^ Pruning Indicator
"RTN","RMPOICD2",15,0)
 ;             RMPSRL(1,0)=Code ^ Code IEN ^ date
"RTN","RMPOICD2",16,0)
 ;             RMPSRL(1,"IDL")=ICD-9/10 Description, Long
"RTN","RMPOICD2",17,0)
 ;             RMPSRL(1,"IDL",1)=ICD-9/10 IEN ^ date
"RTN","RMPOICD2",18,0)
 ;             RMPSRL(1,"IDS")=ICD-9/10 Description, Short
"RTN","RMPOICD2",19,0)
 ;             RMPSRL(1,"IDS",1)=ICD-9/10 IEN ^ date
"RTN","RMPOICD2",20,0)
 ;             RMPSRL(1,"LEX")=Lexicon Description
"RTN","RMPOICD2",21,0)
 ;             RMPSRL(1,"LEX",1)=Expression IEN ^ date
"RTN","RMPOICD2",22,0)
 ;             RMPSRL(1,"SYN",1)=Synonym #1
"RTN","RMPOICD2",23,0)
 ;             RMPSRL(1,"SYN",m)=Synonym #m
"RTN","RMPOICD2",24,0)
 ;             ...
"RTN","RMPOICD2",25,0)
 ;               
"RTN","RMPOICD2",26,0)
 ; Output
"RTN","RMPOICD2",27,0)
 ;               
"RTN","RMPOICD2",28,0)
 ;    $$SEL  Two Piece "^" delimited string same as
"RTN","RMPOICD2",29,0)
 ;           Fileman's Y output variable
"RTN","RMPOICD2",30,0)
 ;               
"RTN","RMPOICD2",31,0)
 ;             1  Lexicon IEN
"RTN","RMPOICD2",32,0)
 ;             2  Lexicon Term
"RTN","RMPOICD2",33,0)
 ;               
"RTN","RMPOICD2",34,0)
 ;    RMPSRL    Local array passed by reference
"RTN","RMPOICD2",35,0)
 ;               
"RTN","RMPOICD2",36,0)
 ;             RMPSRL(0)=Code ^ Code IEN ^ date
"RTN","RMPOICD2",37,0)
 ;             RMPSRL("IDL")=ICD-9/10 Description, Long
"RTN","RMPOICD2",38,0)
 ;             RMPSRL("IDL",1)=ICD-9/10 IEN ^ date
"RTN","RMPOICD2",39,0)
 ;             RMPSRL("IDS")=ICD-9/10 Description, Short
"RTN","RMPOICD2",40,0)
 ;             RMPSRL("IDS",1)=ICD-9/10 IEN ^ date
"RTN","RMPOICD2",41,0)
 ;             RMPSRL("LEX")=Lexicon Description
"RTN","RMPOICD2",42,0)
 ;             RMPSRL("LEX",1)=Expression IEN ^ date
"RTN","RMPOICD2",43,0)
 ;               
"RTN","RMPOICD2",44,0)
 ;    or ^ on error 
"RTN","RMPOICD2",45,0)
 ;    or -1 for non-selection
"RTN","RMPOICD2",46,0)
 ;    or -2 if "^" was entered
"RTN","RMPOICD2",47,0)
 ;               
"RTN","RMPOICD2",48,0)
SEL(RMPSRL,X) ; Select from List
"RTN","RMPOICD2",49,0)
 N RMPGOUP S RMPGOUP=0
"RTN","RMPOICD2",50,0)
 S X=+($G(X))
"RTN","RMPOICD2",51,0)
 S:X'>0 X=5
"RTN","RMPOICD2",52,0)
 S X=$$ASK(.RMPSRL,X)
"RTN","RMPOICD2",53,0)
 I RMPGOUP=1 Q -2
"RTN","RMPOICD2",54,0)
 Q X
"RTN","RMPOICD2",55,0)
 ;
"RTN","RMPOICD2",56,0)
ASK(RMPSRL,X) ; Ask for Selection
"RTN","RMPOICD2",57,0)
 N DTOUT,DUOUT,DIROUT
"RTN","RMPOICD2",58,0)
 N RMPLIT,RMPLL,RMPLTOT
"RTN","RMPOICD2",59,0)
 S RMPLL=+($G(X))
"RTN","RMPOICD2",60,0)
 S:RMPLL'>0 RMPLL=5
"RTN","RMPOICD2",61,0)
 S RMPLIT=0,RMPLTOT=$O(RMPSRL(" "),-1)
"RTN","RMPOICD2",62,0)
 Q:+RMPLTOT'>0 "^"
"RTN","RMPOICD2",63,0)
 K X
"RTN","RMPOICD2",64,0)
 S:+RMPLTOT=1 X=$$ONE(RMPLL,.RMPSRL)
"RTN","RMPOICD2",65,0)
 S:+RMPLTOT>1 X=$$MUL(.RMPSRL,RMPLL)
"RTN","RMPOICD2",66,0)
 S:'$D(DTOUT)&('$D(DUOUT))&('$D(DIROUT))&(+($G(X))'>0) X=-1
"RTN","RMPOICD2",67,0)
 Q X
"RTN","RMPOICD2",68,0)
ONE(X,RMPSRL) ; One Entry Found
"RTN","RMPOICD2",69,0)
 Q:+($G(RMPLIT))>0 "^^"
"RTN","RMPOICD2",70,0)
 N DIR,RMPLC,RMPLEX,RMPLFI,RMPLIT,RMPLSO,RMPLNC
"RTN","RMPOICD2",71,0)
 N RMPLSP,RMPLTX,RMPLC,Y
"RTN","RMPOICD2",72,0)
 S RMPLFI=$O(RMPSRL(0)) Q:+RMPLFI'>0 "^"  S RMPLSP=$J(" ",25)
"RTN","RMPOICD2",73,0)
 S RMPLSO=$P(RMPSRL(1,0),"^",1),RMPLNC=$P(RMPSRL(1,0),"^",3)
"RTN","RMPOICD2",74,0)
 S:+RMPLNC>0 RMPLNC=" ("_RMPLNC_")" S RMPLEX=$G(RMPSRL(1,"MENU"))
"RTN","RMPOICD2",75,0)
 S RMPLC=$S($D(RMPSRL(1,"CAT")):"-",1:"")
"RTN","RMPOICD2",76,0)
 S RMPLTX(1)=RMPLSO_RMPLC_$J(" ",(9-$L(RMPLSO)))_" "_RMPLEX_RMPLNC
"RTN","RMPOICD2",77,0)
 D PR(.RMPLTX,64) S DIR("A",1)=" One match found",DIR("A",2)=" "
"RTN","RMPOICD2",78,0)
 S DIR("A",3)=" "_$G(RMPLTX(1)),RMPLC=3 I $L($G(RMPLTX(2))) D
"RTN","RMPOICD2",79,0)
 . S RMPLC=RMPLC+1,DIR("A",RMPLC)=RMPLSP_$G(RMPLTX(2))
"RTN","RMPOICD2",80,0)
 S RMPLC=RMPLC+1,DIR("A",RMPLC)=" ",RMPLC=RMPLC+1
"RTN","RMPOICD2",81,0)
 S DIR("A")=" OK? (Yes/No) ",DIR("B")="Yes",DIR(0)="YAO" W !
"RTN","RMPOICD2",82,0)
 D ^DIR Q:'$D(DTOUT)&('$D(DUOUT))&('$D(DIROUT))&(+($G(Y))'>0) -1
"RTN","RMPOICD2",83,0)
 S:X["^^"!($D(DTOUT)) RMPLIT=1
"RTN","RMPOICD2",84,0)
 I X["^^"!(+($G(RMPLIT))>0) K RMPSRL Q "^^"
"RTN","RMPOICD2",85,0)
 S X=$S(+Y>0:$$X(1,.RMPSRL),1:-1)
"RTN","RMPOICD2",86,0)
 Q X
"RTN","RMPOICD2",87,0)
MUL(RMPSRL,Y) ; Multiple Entries Found
"RTN","RMPOICD2",88,0)
 Q:+($G(RMPLIT))>0 "^^"
"RTN","RMPOICD2",89,0)
 N RMPSRLE,RMPLL,RMPLMAX,RMPLSS,RMPLX,X
"RTN","RMPOICD2",90,0)
 S (RMPLMAX,RMPLSS,RMPLIT)=0,RMPLL=+($G(Y)),U="^" S:+($G(RMPLL))'>0 RMPLL=5
"RTN","RMPOICD2",91,0)
 S RMPLX=$O(RMPSRL(" "),-1),RMPLSS=0
"RTN","RMPOICD2",92,0)
 G:+RMPLX=0 MULQ W ! W:+RMPLX>1 !," ",RMPLX," matches found"
"RTN","RMPOICD2",93,0)
 F RMPSRLE=1:1:RMPLX Q:((RMPLSS>0)&(RMPLSS<(RMPSRLE+1)))  Q:RMPLIT  D  Q:RMPLIT
"RTN","RMPOICD2",94,0)
 . W:RMPSRLE#RMPLL=1 ! D MULW
"RTN","RMPOICD2",95,0)
 . S RMPLMAX=RMPSRLE W:RMPSRLE#RMPLL=0 !
"RTN","RMPOICD2",96,0)
 . S:RMPSRLE#RMPLL=0 RMPLSS=$$MULS(RMPLMAX,RMPSRLE,.RMPSRL) S:RMPLSS["^" RMPLIT=1
"RTN","RMPOICD2",97,0)
 I RMPSRLE#RMPLL'=0,+RMPLSS<=0 D
"RTN","RMPOICD2",98,0)
 . W ! S RMPLSS=$$MULS(RMPLMAX,RMPSRLE,.RMPSRL) S:RMPLSS["^" RMPLIT=1
"RTN","RMPOICD2",99,0)
 G MULQ
"RTN","RMPOICD2",100,0)
 Q X
"RTN","RMPOICD2",101,0)
MULW ; Write Multiple
"RTN","RMPOICD2",102,0)
 N RMPLEX,RMPLI1,RMPLSO,RMPLNC,RMPLT2,RMPLTX S RMPLSO=$P(RMPSRL(+RMPSRLE,0),"^",1)
"RTN","RMPOICD2",103,0)
 S RMPLNC=$P(RMPSRL(+RMPSRLE,0),"^",3) S:+RMPLNC>0 RMPLNC=" ("_RMPLNC_")"
"RTN","RMPOICD2",104,0)
 S RMPLEX=$G(RMPSRL(+RMPSRLE,"MENU")),RMPLTX(1)=RMPLSO
"RTN","RMPOICD2",105,0)
 S RMPLTX(1)=RMPLTX(1)_$S($D(RMPSRL(+RMPSRLE,"CAT")):"-",1:" ")_$J(" ",(9-$L(RMPLSO)))_" "_RMPLEX_RMPLNC
"RTN","RMPOICD2",106,0)
 D PR(.RMPLTX,60) W !,$J(RMPSRLE,5),".  ",$G(RMPLTX(1))
"RTN","RMPOICD2",107,0)
 F RMPLI1=2:1:5 S RMPLT2=$G(RMPLTX(RMPLI1)) W:$L(RMPLT2) !,$J(" ",19),RMPLT2
"RTN","RMPOICD2",108,0)
 Q
"RTN","RMPOICD2",109,0)
MULS(X,Y,RMPSRL) ; Select from Multiple Entries
"RTN","RMPOICD2",110,0)
 N DIR,DIRB,RMPLFI,RMPLHLP,RMPLLST,RMPLMAX,RMPLS1 ;@#$ not sure RMPLS1 is  neede here
"RTN","RMPOICD2",111,0)
 Q:+($G(RMPLIT))>0 "^^"  S RMPLMAX=+($G(X)),RMPLLST=+($G(Y))
"RTN","RMPOICD2",112,0)
 Q:RMPLMAX=0 -1 S RMPLFI=$O(RMPSRL(0)) Q:+RMPLFI'>0 -1
"RTN","RMPOICD2",113,0)
 I +($O(RMPSRL(+RMPLLST)))>0 D
"RTN","RMPOICD2",114,0)
 . S DIR("A")=" Press <RETURN> for more, ""^"" to exit, or Select 1-"
"RTN","RMPOICD2",115,0)
 . S DIR("A")=DIR("A")_RMPLMAX_": "
"RTN","RMPOICD2",116,0)
 I +($O(RMPSRL(+RMPLLST)))'>0 D
"RTN","RMPOICD2",117,0)
 . S DIR("A")=" Select 1-"_RMPLMAX_": "
"RTN","RMPOICD2",118,0)
 S RMPLHLP=" Answer must be from 1 to "
"RTN","RMPOICD2",119,0)
 S RMPLHLP=RMPLHLP_RMPLMAX_", or <Return> to continue"
"RTN","RMPOICD2",120,0)
 S DIR("PRE")="S:X[""?"" X=""??"""
"RTN","RMPOICD2",121,0)
 S (DIR("?"),DIR("??"))="^D MULSH^RMPOICD2"
"RTN","RMPOICD2",122,0)
 S DIR(0)="NAO^1:"_RMPLMAX_":0" D ^DIR
"RTN","RMPOICD2",123,0)
 S:X="^" RMPGOUP=1
"RTN","RMPOICD2",124,0)
 Q:'$D(DTOUT)&('$D(DUOUT))&('$D(DIROUT))&(+($G(Y))'>0) -1
"RTN","RMPOICD2",125,0)
 S:X["^^"!($D(DTOUT)) RMPLIT=1,X="^^" I X["^^"!(+($G(RMPLIT))>0) Q "^^"
"RTN","RMPOICD2",126,0)
 K DIR Q:$D(DTOUT)!(X[U) "^^"
"RTN","RMPOICD2",127,0)
 Q $S(+Y>0:+Y,1:"-1")
"RTN","RMPOICD2",128,0)
MULSH ; Select from Multiple Entries Help
"RTN","RMPOICD2",129,0)
 I $L($G(RMPLHLP)) W !,$G(RMPLHLP) Q
"RTN","RMPOICD2",130,0)
 Q
"RTN","RMPOICD2",131,0)
MULQ ; Quit Multiple
"RTN","RMPOICD2",132,0)
 I +RMPLSS'>0,$G(RMPLSS)="^" Q "^"
"RTN","RMPOICD2",133,0)
 S X=-1 S:+($G(RMPLIT))'>0 X=$$X(+RMPLSS,.RMPSRL)
"RTN","RMPOICD2",134,0)
 Q X
"RTN","RMPOICD2",135,0)
X(X,RMPSRL) ; Set X and Output Array
"RTN","RMPOICD2",136,0)
 N RMPLEX,RMPSRFI,RMPLIEN,RMPLN1,RMPLNC,RMPLNN,RMPLRN,RMPLS1,RMPLSO
"RTN","RMPOICD2",137,0)
 S RMPLS1=+($G(X))
"RTN","RMPOICD2",138,0)
 S RMPSRFI=$O(RMPSRL(0)) ;@#$ not used?
"RTN","RMPOICD2",139,0)
 S RMPLSO=$P($G(RMPSRL(RMPLS1,0)),"^",1),RMPLEX=$G(RMPSRL(RMPLS1,"MENU"))
"RTN","RMPOICD2",140,0)
 S RMPLIEN=$S($D(RMPSRL(RMPLS1,"CAT")):"99:CAT;"_$P($G(RMPSRL(RMPLS1,0)),"^"),1:$P($G(RMPSRL(RMPLS1,"IDS",1)),"^")_";"_$P($G(RMPSRL(RMPLS1,0)),"^")_";"_$P($G(RMPSRL(RMPLS1,"LEX",1)),"^")) Q:'$L(RMPLSO) "^"
"RTN","RMPOICD2",141,0)
 Q:'$L(RMPLEX) "^"  Q:+RMPLIEN'>0 "^" S X=RMPLIEN_"^"_RMPLEX
"RTN","RMPOICD2",142,0)
 S RMPLNN="RMPSRL("_+RMPLS1_")",RMPLNC="RMPSRL("_+RMPLS1_","
"RTN","RMPOICD2",143,0)
 F  S RMPLNN=$Q(@RMPLNN) Q:'$L(RMPLNN)!(RMPLNN'[RMPLNC)  D
"RTN","RMPOICD2",144,0)
 . S RMPLRN="RMPLN1("_$P(RMPLNN,"(",2,299) S @RMPLRN=@RMPLNN
"RTN","RMPOICD2",145,0)
 K RMPSRL S RMPLNN="RMPLN1("_+RMPLS1_")",RMPLNC="RMPLN1("_+RMPLS1_","
"RTN","RMPOICD2",146,0)
 F  S RMPLNN=$Q(@RMPLNN) Q:'$L(RMPLNN)!(RMPLNN'[RMPLNC)  D
"RTN","RMPOICD2",147,0)
 . S RMPLRN="RMPSRL("_$P(RMPLNN,"(",2,299),@RMPLRN=@RMPLNN
"RTN","RMPOICD2",148,0)
 Q X
"RTN","RMPOICD2",149,0)
 ; 
"RTN","RMPOICD2",150,0)
 ; Miscellaneous
"RTN","RMPOICD2",151,0)
CL ; Clear
"RTN","RMPOICD2",152,0)
 K RMPLIT
"RTN","RMPOICD2",153,0)
 Q
"RTN","RMPOICD2",154,0)
PR(RMPSRL,X) ; Parse Array
"RTN","RMPOICD2",155,0)
 N DIW,DIWF,DIWI,DIWL,DIWR,DIWT,DIWTC,DIWX,DN,I,Z,%,%D,RMPLC,RMPLI1,RMPLL
"RTN","RMPOICD2",156,0)
 K ^UTILITY($J,"W")
"RTN","RMPOICD2",157,0)
 Q:'$D(RMPSRL)
"RTN","RMPOICD2",158,0)
 S RMPLL=+($G(X))
"RTN","RMPOICD2",159,0)
 S:+RMPLL'>0 RMPLL=79
"RTN","RMPOICD2",160,0)
 S RMPLC=+($G(RMPSRL))
"RTN","RMPOICD2",161,0)
 S:+($G(RMPLC))'>0 RMPLC=$O(RMPSRL(" "),-1)
"RTN","RMPOICD2",162,0)
 Q:+RMPLC'>0
"RTN","RMPOICD2",163,0)
 S DIWL=1,DIWF="C"_+RMPLL
"RTN","RMPOICD2",164,0)
 S RMPLI1=0
"RTN","RMPOICD2",165,0)
 F  S RMPLI1=$O(RMPSRL(RMPLI1)) Q:+RMPLI1=0  S X=$G(RMPSRL(RMPLI1)) D ^DIWP
"RTN","RMPOICD2",166,0)
 K RMPSRL
"RTN","RMPOICD2",167,0)
 S (RMPLC,RMPLI1)=0
"RTN","RMPOICD2",168,0)
 F  S RMPLI1=$O(^UTILITY($J,"W",1,RMPLI1)) Q:+RMPLI1=0  D
"RTN","RMPOICD2",169,0)
 . S RMPSRL(RMPLI1)=$$TM($G(^UTILITY($J,"W",1,RMPLI1,0))," "),RMPLC=RMPLC+1
"RTN","RMPOICD2",170,0)
 S:$L(RMPLC) RMPSRL=RMPLC
"RTN","RMPOICD2",171,0)
 K ^UTILITY($J,"W")
"RTN","RMPOICD2",172,0)
 Q
"RTN","RMPOICD2",173,0)
TM(X,Y) ; Trim Character Y - Default " "
"RTN","RMPOICD2",174,0)
 S X=$G(X) Q:X="" X S Y=$G(Y) S:'$L(Y) Y=" "
"RTN","RMPOICD2",175,0)
 F  Q:$E(X,1)'=Y  S X=$E(X,2,$L(X))
"RTN","RMPOICD2",176,0)
 F  Q:$E(X,$L(X))'=Y  S X=$E(X,1,($L(X)-1))
"RTN","RMPOICD2",177,0)
 Q X
"RTN","RMPOPED")
0^1^B301665198^B86271815
"RTN","RMPOPED",1,0)
RMPOPED ;EDS/MDB,DDW,RVD - HOME OXYGEN MISC FILE EDITS ;7/24/98
"RTN","RMPOPED",2,0)
 ;;3.0;PROSTHETICS;**29,44,41,52,77,110,140,148,168**;Feb 09, 1996;Build 43
"RTN","RMPOPED",3,0)
 ;
"RTN","RMPOPED",4,0)
 ; Reference to $$SINFO^ICDEX supported by ICR #5747
"RTN","RMPOPED",5,0)
 ; Reference to $$CSI^ICDEX   supported by ICR #5747 
"RTN","RMPOPED",6,0)
 ; Reference to $$ICDDX^ICDEX supported by ICR #5747
"RTN","RMPOPED",7,0)
 ; Reference to $$VLT^ICDEX   supported by ICR #5747
"RTN","RMPOPED",8,0)
 ; Reference to $$CODEC^ICDEX supported by ICR #5747
"RTN","RMPOPED",9,0)
 ; Reference to $$LS^ICDEX    supported by ICR #5747
"RTN","RMPOPED",10,0)
 ;
"RTN","RMPOPED",11,0)
 ; HNC - patch 52
"RTN","RMPOPED",12,0)
 ;                 modified SITECHK sub
"RTN","RMPOPED",13,0)
 ;                 X will be undefined from GETS^DIQ if field is null
"RTN","RMPOPED",14,0)
 ;                 added $G.
"RTN","RMPOPED",15,0)
 ; RVD - patch #77 use FileMan to set items that are not Primary item
"RTN","RMPOPED",16,0)
 ;                 to 'N' in order to set correctly the 'AC' cross-ref.
"RTN","RMPOPED",17,0)
 Q
"RTN","RMPOPED",18,0)
UNLOCK I $D(RMPODFN) L -^RMPR(665,RMPODFN)
"RTN","RMPOPED",19,0)
 Q
"RTN","RMPOPED",20,0)
EXIT K DIC,DIE,DIR,DIK,X,Y,Z,DR,DA,DD,DO,D0,DTOUT,DIROUT,DUOUT,DIRUT,QUIT,DFN,ITEM,ITEMS,IEN,IENS,ITMACT,ITM,C,S,W,PI,VDR,ZST
"RTN","RMPOPED",21,0)
 D UNLOCK
"RTN","RMPOPED",22,0)
 Q
"RTN","RMPOPED",23,0)
 ;
"RTN","RMPOPED",24,0)
KEY ;user must have the RMPRSUPERVISOR key in order to add a new patient.
"RTN","RMPOPED",25,0)
 ;option name is EDIT HOME OXYGEN PATIENT
"RTN","RMPOPED",26,0)
 N KEY
"RTN","RMPOPED",27,0)
 S KEY=$O(^DIC(19.1,"B","RMPRSUPERVISOR",0))
"RTN","RMPOPED",28,0)
 I '$D(^VA(200,DUZ,51,KEY)) D  Q
"RTN","RMPOPED",29,0)
 . W !!,"You do not hold the RMPRSUPERVISOR key!!"
"RTN","RMPOPED",30,0)
 G PAT
"RTN","RMPOPED",31,0)
 ;
"RTN","RMPOPED",32,0)
SITE ; Editing of Home Oxygen site parameter file.
"RTN","RMPOPED",33,0)
 K DIC,DIE,DA,DR,DD,RMPOXITE
"RTN","RMPOPED",34,0)
 S DIC="^RMPR(669.9,",DIC(0)="QEAMLZ",DIC("A")="Select SITE: "
"RTN","RMPOPED",35,0)
 D ^DIC Q:Y<0!$$QUIT
"RTN","RMPOPED",36,0)
 K DIC("A")
"RTN","RMPOPED",37,0)
 S (DA,RMPOXITE)=+Y
"RTN","RMPOPED",38,0)
 ; Lock it...
"RTN","RMPOPED",39,0)
 L +^RMPR(669.9,RMPOXITE):2
"RTN","RMPOPED",40,0)
 I '$T D  G SITE
"RTN","RMPOPED",41,0)
 . W ?10,$C(7)_Y(0,0)_" -- record in use. Try again later."
"RTN","RMPOPED",42,0)
 ; Edit it
"RTN","RMPOPED",43,0)
 S DIE=DIC,DR="60;61;62;65" D ^DIE Q:$$EQUIT
"RTN","RMPOPED",44,0)
 ; Edit FCP
"RTN","RMPOPED",45,0)
 K DIC,DA,DD,DR,DIE
"RTN","RMPOPED",46,0)
 ;
"RTN","RMPOPED",47,0)
 ; Done.  Unlock
"RTN","RMPOPED",48,0)
 L -^RMPR(669.9,RMPOXITE)
"RTN","RMPOPED",49,0)
 G SITE
"RTN","RMPOPED",50,0)
 ;
"RTN","RMPOPED",51,0)
FCPHLP ; Executable help for FCP multiple in 669.9
"RTN","RMPOPED",52,0)
 ;
"RTN","RMPOPED",53,0)
 Q
"RTN","RMPOPED",54,0)
FCPIX ; Input transform for FCP multiple in 669.9
"RTN","RMPOPED",55,0)
 ;
"RTN","RMPOPED",56,0)
 Q:'$D(X)
"RTN","RMPOPED",57,0)
 I $L(X)>30!($L(X)<3) K X Q
"RTN","RMPOPED",58,0)
 S ZST=$P(^RMPR(669.9,D0,4),U,1),RMPOX=X
"RTN","RMPOPED",59,0)
 D FIND^DIC(420.01,","_ZST_",",".01;","M",X,1,,,,"X")
"RTN","RMPOPED",60,0)
 S X=$S($D(X("DILIST","ID",1,.01)):X("DILIST","ID",1,.01),1:RMPOX)
"RTN","RMPOPED",61,0)
 K X("DILIST"),RMPOX
"RTN","RMPOPED",62,0)
 I $G(ZST),('$D(^PRC(420,+ZST,1,"B",X))) W !,"Control Point is not a valid IFCAP FCP.." K X
"RTN","RMPOPED",63,0)
 Q
"RTN","RMPOPED",64,0)
ACT ;activate/inactivate a home oxygen patient
"RTN","RMPOPED",65,0)
 ;Set up site variables.
"RTN","RMPOPED",66,0)
 D HOSITE^RMPOUTL0 I QUIT D EXIT Q
"RTN","RMPOPED",67,0)
 W @IOF
"RTN","RMPOPED",68,0)
 ;
"RTN","RMPOPED",69,0)
ACT1 ;Toggle ACTIVATE/INACTIVATE functions.
"RTN","RMPOPED",70,0)
 N NAME K DIC,DA
"RTN","RMPOPED",71,0)
 S DIC="^RMPR(665,",DIC(0)="QEAMZ" D ^DIC I Y<0!$$QUIT D EXIT Q
"RTN","RMPOPED",72,0)
 S DIE=DIC,DA=+Y,NAME=Y(0,0)
"RTN","RMPOPED",73,0)
 L +^RMPR(665,DA):2
"RTN","RMPOPED",74,0)
 I '$T D  G ACT1
"RTN","RMPOPED",75,0)
 . W ?10,$C(7)_Y(0,0)_" -- record in use. Try later."
"RTN","RMPOPED",76,0)
 ;If the patient has never been activated, quit.
"RTN","RMPOPED",77,0)
 I $P($G(^RMPR(665,DA,"RMPOA")),U,2)="" D  G ACT1
"RTN","RMPOPED",78,0)
 . W !!,$C(7)_NAME_" has not been added as a Home Oxygen patient."
"RTN","RMPOPED",79,0)
 . W !,"Please add using the ""Add/Edit Home Oxygen Patient"" option."
"RTN","RMPOPED",80,0)
 ;If the patient is active, perform inactivation actions.
"RTN","RMPOPED",81,0)
 I $P($G(^RMPR(665,DA,"RMPOA")),U,3)="" D INACTVT^RMPOPED G ACT1
"RTN","RMPOPED",82,0)
 ;If the patient is inactive, perform activation actions.
"RTN","RMPOPED",83,0)
 I $P($G(^RMPR(665,DA,"RMPOA")),U,3)'="" D ACTVT^RMPOPED G ACT1
"RTN","RMPOPED",84,0)
 Q
"RTN","RMPOPED",85,0)
INACTVT ; Inactivate the patient if user wants to.
"RTN","RMPOPED",86,0)
 ; Confirm if the user wants to proceed.
"RTN","RMPOPED",87,0)
 K DIR S DIR(0)="YO",DIR("B")="NO"
"RTN","RMPOPED",88,0)
 S DIR("A")="Are you sure you want to inactivate "_NAME_" ?" D ^DIR
"RTN","RMPOPED",89,0)
 Q:(Y<1)!$$QUIT
"RTN","RMPOPED",90,0)
 S DR="19.5//TODAY;19.6;19.7////"_DUZ,DIE("NO^")="BACK"
"RTN","RMPOPED",91,0)
 D ^DIE
"RTN","RMPOPED",92,0)
 Q
"RTN","RMPOPED",93,0)
 ;
"RTN","RMPOPED",94,0)
ACTVT ;Activate the patient if the user wants to.
"RTN","RMPOPED",95,0)
 K DIR S DIR(0)="YO",DIR("B")="NO"
"RTN","RMPOPED",96,0)
 S DIR("A")="Are you sure you want to reactivate "_NAME_" ?" D ^DIR
"RTN","RMPOPED",97,0)
 Q:(Y<1)!$$QUIT
"RTN","RMPOPED",98,0)
 S DR="19.2//TODAY;19.5///@;19.6///@;19.7///@"
"RTN","RMPOPED",99,0)
 S DIE("NO^")="BACK"
"RTN","RMPOPED",100,0)
 D ^DIE
"RTN","RMPOPED",101,0)
 Q
"RTN","RMPOPED",102,0)
PAT ;Add/Edit Home Oxygen Patient
"RTN","RMPOPED",103,0)
 S QUIT=0
"RTN","RMPOPED",104,0)
 D HOSITE^RMPOUTL0
"RTN","RMPOPED",105,0)
 I '$D(RMPOXITE)!QUIT D EXIT Q
"RTN","RMPOPED",106,0)
LOOP ;
"RTN","RMPOPED",107,0)
 S QUIT=0
"RTN","RMPOPED",108,0)
 D LOOKUP I QUIT!'$D(RMPODFN) D EXIT Q
"RTN","RMPOPED",109,0)
 D EDBLK I QUIT D EXIT Q
"RTN","RMPOPED",110,0)
 D UNLOCK G LOOP
"RTN","RMPOPED",111,0)
EDBLK ;
"RTN","RMPOPED",112,0)
 D SITECHK Q:QUIT
"RTN","RMPOPED",113,0)
 N RMPRDOI ; ICD - Date of Interest
"RTN","RMPOPED",114,0)
 N RMPRWARN ; Flag if Prescription/Item mismatch was issued
"RTN","RMPOPED",115,0)
 N RMPRCONT ; Flag if user wanted to continue after warning was issued
"RTN","RMPOPED",116,0)
 S (RMPRWARN,RMPRCONT,RMPRDOI)=""
"RTN","RMPOPED",117,0)
 D DEMOG Q:QUIT
"RTN","RMPOPED",118,0)
 D RX Q:QUIT
"RTN","RMPOPED",119,0)
 Q:+RMPRDOI'>0
"RTN","RMPOPED",120,0)
 D ITEM
"RTN","RMPOPED",121,0)
 Q
"RTN","RMPOPED",122,0)
 ;called by ^RMPOBIL1, providing RMPOPATN as the X variable
"RTN","RMPOPED",123,0)
EDIT ;From Billing...
"RTN","RMPOPED",124,0)
 I '$D(RMPODFN) S RMPODFN=$TR($G(RMPOPATN),"`")
"RTN","RMPOPED",125,0)
 Q:'$D(^RMPR(665,+RMPODFN,0))
"RTN","RMPOPED",126,0)
 W !,"EDITING "_$P(^DPT(RMPODFN,0),U)_"...",!
"RTN","RMPOPED",127,0)
 S QUIT=0,DA=RMPODFN
"RTN","RMPOPED",128,0)
 L +^RMPR(665,DA):2
"RTN","RMPOPED",129,0)
 I '$T W !!?10,*7," << Record in use. Try later. >>" Q
"RTN","RMPOPED",130,0)
 D EDBLK,EXIT
"RTN","RMPOPED",131,0)
 Q
"RTN","RMPOPED",132,0)
LOOKUP ;First look-up the patient
"RTN","RMPOPED",133,0)
 K DIC,DIE,DA,DR,RMPODFN
"RTN","RMPOPED",134,0)
 W !!! S DIC="^RMPR(665,",DIC(0)="LQEAMZ"
"RTN","RMPOPED",135,0)
 D ^DIC Q:(Y<0)!$$QUIT
"RTN","RMPOPED",136,0)
CONT S (RMPODFN,DA)=+Y
"RTN","RMPOPED",137,0)
 L +^RMPR(665,DA):2
"RTN","RMPOPED",138,0)
 I '$T W !!?10,*7," << Record in use. Try later. >>" G LOOKUP
"RTN","RMPOPED",139,0)
 Q
"RTN","RMPOPED",140,0)
 ;
"RTN","RMPOPED",141,0)
QUIT() S QUIT=$G(QUIT)!$D(DTOUT)!$D(DUOUT)!$D(DIROUT) Q QUIT
"RTN","RMPOPED",142,0)
EQUIT() S QUIT=$D(DTOUT)!$D(Y) Q QUIT
"RTN","RMPOPED",143,0)
LJ(S,W,C) ; LEFT JUSTIFY S IN A FIELD W WIDE PADDING WITH CHAR F
"RTN","RMPOPED",144,0)
 ;
"RTN","RMPOPED",145,0)
 S C=$G(C," ")   ;DEFAULT PAD CHAR IS SPACE
"RTN","RMPOPED",146,0)
 S $P(S,C,W-$L(S)+$L(S,C))=""
"RTN","RMPOPED",147,0)
 Q S
"RTN","RMPOPED",148,0)
 ;
"RTN","RMPOPED",149,0)
SITECHK ;If user chooses patient from site different from billing site
"RTN","RMPOPED",150,0)
 ;
"RTN","RMPOPED",151,0)
 S Y=$P($G(^RMPR(665,RMPODFN,"RMPOA")),U,7)
"RTN","RMPOPED",152,0)
 Q:Y=RMPOXITE    ;Site is the same.. 
"RTN","RMPOPED",153,0)
 I Y="" D SET Q   ;Site not defined, stuff RMPOXITE...
"RTN","RMPOPED",154,0)
 ; Site is different...
"RTN","RMPOPED",155,0)
 S IENS=RMPODFN_","
"RTN","RMPOPED",156,0)
 D GETS^DIQ(665,IENS,19.12,"E","X")
"RTN","RMPOPED",157,0)
 W !!,"Patient's Home Oxygen Contract Location (HOCL) is "
"RTN","RMPOPED",158,0)
 W $G(X(665,IENS,19.12,"E"))
"RTN","RMPOPED",159,0)
 W !,"You are working on billing for HOCL "_RMPO("NAME"),!
"RTN","RMPOPED",160,0)
 K DIR S DIR(0)="Y",DIR("B")="NO"
"RTN","RMPOPED",161,0)
 S DIR("A")="Should I change this patient's HOCL to "_RMPO("NAME")
"RTN","RMPOPED",162,0)
 D ^DIR Q:$$QUIT!(Y=0)
"RTN","RMPOPED",163,0)
 D SET
"RTN","RMPOPED",164,0)
 Q
"RTN","RMPOPED",165,0)
SET ;
"RTN","RMPOPED",166,0)
 K DIE,DR,DA
"RTN","RMPOPED",167,0)
 S DA=RMPODFN
"RTN","RMPOPED",168,0)
 S DIE="^RMPR(665,",DR="19.12////"_RMPOXITE D ^DIE
"RTN","RMPOPED",169,0)
 Q
"RTN","RMPOPED",170,0)
 ;
"RTN","RMPOPED",171,0)
DEMOG ;First edit the patient's basic fields
"RTN","RMPOPED",172,0)
 ;
"RTN","RMPOPED",173,0)
 K DIE,DR,DA
"RTN","RMPOPED",174,0)
 S DA=RMPODFN
"RTN","RMPOPED",175,0)
 S DIE="^RMPR(665,",DR="19.1" D ^DIE Q:$$EQUIT
"RTN","RMPOPED",176,0)
 S RMPOELIG=$P($G(^RMPR(665,RMPODFN,"RMPOA")),U)
"RTN","RMPOPED",177,0)
 K DR S DR="19.11"_$S(RMPOELIG="D":"",1:"///@")_";19.12"
"RTN","RMPOPED",178,0)
 D ^DIE Q:$$EQUIT
"RTN","RMPOPED",179,0)
 K DR S Y=DT X ^DD("DD") S DR="19.2//"_Y D ^DIE Q:$$QUIT
"RTN","RMPOPED",180,0)
 Q
"RTN","RMPOPED",181,0)
 ;
"RTN","RMPOPED",182,0)
RX ;Edit the Rx Data
"RTN","RMPOPED",183,0)
 ;
"RTN","RMPOPED",184,0)
 N RXD,RXDI,RMPRIENS
"RTN","RMPOPED",185,0)
 K DIC,DIE,DA,DR
"RTN","RMPOPED",186,0)
 S DIC="^RMPR(665,"_RMPODFN_",""RMPOB"",",DIC(0)="AEQLZ"
"RTN","RMPOPED",187,0)
 S DA(1)=RMPODFN,DIC("P")="665.193D"
"RTN","RMPOPED",188,0)
 S RXD=$O(^RMPR(665,DA(1),"RMPOB","B",""),-1) D:RXD
"RTN","RMPOPED",189,0)
 . S DIC("B")=$$FMTE^XLFDT(RXD)
"RTN","RMPOPED",190,0)
 D ^DIC Q:Y<0!$$QUIT
"RTN","RMPOPED",191,0)
 ; Set RMPRIENS for loading Date of Interest after final edits
"RTN","RMPOPED",192,0)
 S RMPRIENS=+Y_","_DA(1)_","
"RTN","RMPOPED",193,0)
 ; Edit START DATE (#.01), EXPIRATION DATE (#2) and DESCRIPTION (#3)
"RTN","RMPOPED",194,0)
 S DIE=DIC,DA=+Y,DR=".01;2//^D EXPIRE^RMPOBIL4;3" D ^DIE Q:$$EQUIT
"RTN","RMPOPED",195,0)
 ; Load ICD Date of Interest
"RTN","RMPOPED",196,0)
 S RMPRDOI=$$GET1^DIQ(665.193,RMPRIENS,.01,"I",,)
"RTN","RMPOPED",197,0)
 Q
"RTN","RMPOPED",198,0)
 ;
"RTN","RMPOPED",199,0)
ITEM ;Add/Edit Items
"RTN","RMPOPED",200,0)
 ;
"RTN","RMPOPED",201,0)
 ; Display items
"RTN","RMPOPED",202,0)
 D ITEMD
"RTN","RMPOPED",203,0)
 ; If no items on file, then only allow ADD PRIMARY ITEM
"RTN","RMPOPED",204,0)
 I '$D(IEN) D ITEMP Q:QUIT!(ITEM="")  G ITEM
"RTN","RMPOPED",205,0)
 ; ask for ACTION, quit if <return>, timeout, etc
"RTN","RMPOPED",206,0)
 S ITMACT=$$ITEMO Q:$$QUIT!(ITMACT="")
"RTN","RMPOPED",207,0)
 ; if they entered 'A', do ADD ITEM, then edit it
"RTN","RMPOPED",208,0)
 I ITMACT="A" D ITEMA Q:QUIT!(ITEM="")  D ITEME Q:QUIT  G ITEM
"RTN","RMPOPED",209,0)
 ; if they entered 'D', select an item, then delete it
"RTN","RMPOPED",210,0)
 I ITMACT="D" D ITEMS Q:QUIT!(ITEM="")  D ITEMK G ITEM
"RTN","RMPOPED",211,0)
 ; if they entered 'E', select an item, then edit it
"RTN","RMPOPED",212,0)
 I ITMACT="E" D ITEMS
"RTN","RMPOPED",213,0)
 ; If warning issued and Continue = No
"RTN","RMPOPED",214,0)
 I RMPRWARN=1,RMPRCONT'=1 S (RMPRWARN,RMPRCONT)="" G ITEM
"RTN","RMPOPED",215,0)
 Q:QUIT!(ITEM="")
"RTN","RMPOPED",216,0)
 D ITEME Q:QUIT
"RTN","RMPOPED",217,0)
 G ITEM
"RTN","RMPOPED",218,0)
 Q
"RTN","RMPOPED",219,0)
 ;
"RTN","RMPOPED",220,0)
ITEMP ; Add Primary Item
"RTN","RMPOPED",221,0)
 W !!,$C(7)_"No items found, please enter PRIMARY ITEM",!
"RTN","RMPOPED",222,0)
 D ITEMA Q:QUIT!(ITEM="")
"RTN","RMPOPED",223,0)
 S PI="///Y" D ITEME K PI
"RTN","RMPOPED",224,0)
 Q
"RTN","RMPOPED",225,0)
ITEMA ; Add Items
"RTN","RMPOPED",226,0)
 S ITEM=""
"RTN","RMPOPED",227,0)
 K DIC S DIC="^RMPR(661,",DIC(0)="AEQMZ" D ^DIC Q:Y<0!$$QUIT
"RTN","RMPOPED",228,0)
 K DD,DO,DA,DIC
"RTN","RMPOPED",229,0)
 S DIC="^RMPR(665,"_RMPODFN_",""RMPOC"",",DIC(0)="L"
"RTN","RMPOPED",230,0)
 S DIC("P")=$P(^DD(665,19.4,0),U,2),DA(1)=RMPODFN,X=+Y
"RTN","RMPOPED",231,0)
 D FILE^DICN I Y>0 S IEN=$G(IEN)+1,IEN(IEN)=+Y,ITEM=IEN
"RTN","RMPOPED",232,0)
 Q
"RTN","RMPOPED",233,0)
 ;
"RTN","RMPOPED",234,0)
ITEMS ; Select Item
"RTN","RMPOPED",235,0)
 ; Return ITEM = index into both ITEMS and IEN arrays
"RTN","RMPOPED",236,0)
 N RMPRQUIT,RMPRACS,RMPRCS,RMPRICD,RMPRICS,RMPRANS,RMPRACT
"RTN","RMPOPED",237,0)
 ; Determine Active Coding System based on Date of Interest
"RTN","RMPOPED",238,0)
 S RMPRACS=$$SINFO^ICDEX("DIAG",RMPRDOI) ; Supported by ICR 5747
"RTN","RMPOPED",239,0)
 S RMPRACS=$P(RMPRACS,U,2),RMPRACS=$P(RMPRACS,"-",2)
"RTN","RMPOPED",240,0)
 ; If only one Item on file
"RTN","RMPOPED",241,0)
 I IEN=1 S ITEM=1 W "  ",$E(ITEMS(1),1,33) Q:ITMACT'="E"  D  Q
"RTN","RMPOPED",242,0)
 .; Load Item info
"RTN","RMPOPED",243,0)
 .D RMPRLOAD
"RTN","RMPOPED",244,0)
 .; If item has an ICD code, verify that it was active based on 
"RTN","RMPOPED",245,0)
 .; start date of currently selected prescription.
"RTN","RMPOPED",246,0)
 .I RMPRICD'="",RMPRACT'="+" D
"RTN","RMPOPED",247,0)
 ..; Display warning
"RTN","RMPOPED",248,0)
 ..D RMPRWARN^RMPOPED1(RMPRICD,RMPRACS,RMPODFN,.ITEM,.RMPRCONT)
"RTN","RMPOPED",249,0)
 ..S RMPRWARN=1 ; Set warning issued flag
"RTN","RMPOPED",250,0)
 ; If multiple items on file
"RTN","RMPOPED",251,0)
 K DIR
"RTN","RMPOPED",252,0)
 S ITEM=""
"RTN","RMPOPED",253,0)
 S DIR(0)="NO^1:"_IEN,DIR("A")="Select an ITEM"
"RTN","RMPOPED",254,0)
 S DIR("?")="Select an item from the list"
"RTN","RMPOPED",255,0)
 M DIR("?")=ITEMS
"RTN","RMPOPED",256,0)
 F  D  Q:RMPRQUIT=1
"RTN","RMPOPED",257,0)
 .S RMPRQUIT=""
"RTN","RMPOPED",258,0)
 .D ^DIR
"RTN","RMPOPED",259,0)
 .I Y'>0 S RMPRQUIT=1,ITEM="" Q
"RTN","RMPOPED",260,0)
 .Q:$$QUIT
"RTN","RMPOPED",261,0)
 .S ITEM=+Y W "  ",$E(ITEMS(ITEM),1,33)
"RTN","RMPOPED",262,0)
 .; Quit if doing a Delete and item was selected
"RTN","RMPOPED",263,0)
 .I ITMACT="D" S RMPRQUIT=1 Q
"RTN","RMPOPED",264,0)
 .; Load ICD Code and Code Set and Active Status for selected Item
"RTN","RMPOPED",265,0)
 .D RMPRLOAD
"RTN","RMPOPED",266,0)
 .; If Item doesn't have an ICD code - OK
"RTN","RMPOPED",267,0)
 .I RMPRICD="" W ! S RMPRQUIT=1 Q
"RTN","RMPOPED",268,0)
 .; If Item has an ICD code validate that it was active based on the start
"RTN","RMPOPED",269,0)
 .; date of the prescription.  If ICD was active, QUIT
"RTN","RMPOPED",270,0)
 .I RMPRACT="+" S RMPRQUIT=1 Q
"RTN","RMPOPED",271,0)
 .; Otherwise, issue warning
"RTN","RMPOPED",272,0)
 .I ITMACT="E" D
"RTN","RMPOPED",273,0)
 ..; Display warning
"RTN","RMPOPED",274,0)
 ..D RMPRWARN^RMPOPED1(RMPRICD,RMPRACS,RMPODFN,IEN(ITEM),.RMPRCONT)
"RTN","RMPOPED",275,0)
 ..S (RMPRWARN,RMPRQUIT)=1
"RTN","RMPOPED",276,0)
 .W !
"RTN","RMPOPED",277,0)
 K RMPRITEM
"RTN","RMPOPED",278,0)
 Q
"RTN","RMPOPED",279,0)
 ;
"RTN","RMPOPED",280,0)
RMPRLOAD ; Load ICD, Code Set and Status
"RTN","RMPOPED",281,0)
 S RMPRICD=$P(RMPRITEM(ITEM),U,2) ; ICD Code
"RTN","RMPOPED",282,0)
 S RMPRCS=$P(RMPRITEM(ITEM),U,3)  ; Code Set
"RTN","RMPOPED",283,0)
 S RMPRACT=$P(RMPRITEM(ITEM),U,4) ; Active Status
"RTN","RMPOPED",284,0)
 Q
"RTN","RMPOPED",285,0)
 ;
"RTN","RMPOPED",286,0)
ITEME ; Edit an Item - ICD-10 Changes
"RTN","RMPOPED",287,0)
 N DFCP,FCP,ICDID,RMCPRENT,RMPRACS,RMPRACSI,RMPRCSI,RMPRDATA,RMPRDATE,RMPRFILE,RMPRICD
"RTN","RMPOPED",288,0)
 N RMPRICDE,RMPRICDI,RMPRIEN,RMPRIENS,RMPRINDX,RMPRQUIT,RMCPTHCP,RMPRTXT
"RTN","RMPOPED",289,0)
 S (DFCP,FCP,ICDID,RMCPRENT,RMPRACS,RMPRACSI,RMPRCSI,RMPRDATA,RMPRDATE,RMPRICD,RMPRICDE)=""
"RTN","RMPOPED",290,0)
 S (RMPRICDI,RMPRIEN,RMPRIENS,RMPRQUIT,RMCPTHCP,RMPRTXT)=""
"RTN","RMPOPED",291,0)
 S ITMACT=$G(ITMACT)
"RTN","RMPOPED",292,0)
 K DIE,DA,DR,RMCPT
"RTN","RMPOPED",293,0)
 S DA(1)=RMPODFN,DA=IEN(ITEM),DIE="^RMPR(665,"_DA(1)_",""RMPOC"","
"RTN","RMPOPED",294,0)
 D ITEMEP Q:QUIT
"RTN","RMPOPED",295,0)
 S DR=".01R;6R" D ^DIE Q:$$EQUIT!('$D(DA))
"RTN","RMPOPED",296,0)
 S RMCPTHCP=$P($G(^RMPR(665,RMPODFN,"RMPOC",DA,0)),U,7) ; (#6)   HCPCS CODE 
"RTN","RMPOPED",297,0)
 S RMCPT=$P($G(^RMPR(661.1,RMCPTHCP,4)),U,1) S DR=""    ; (#.03) CPT MODIFIER 
"RTN","RMPOPED",298,0)
 S RMCPRENT=$P($G(^RMPR(661.1,RMCPTHCP,5)),U,1)         ; (#30)  RENTAL FLAG 
"RTN","RMPOPED",299,0)
 I RMCPT["RR",(RMCPRENT=1) S DR="11;"                   ; (#11)  HOME OXYGEN RENTAL FLAG 
"RTN","RMPOPED",300,0)
 I RMCPT["QH" S DR=DR_"12;"                             ; (#12)  HOME OXYGEN CONSERVING FLAG
"RTN","RMPOPED",301,0)
 ;
"RTN","RMPOPED",302,0)
 ; Determine Active Coding System based on Date of Interest
"RTN","RMPOPED",303,0)
 S RMPRACS=$$SINFO^ICDEX("DIAG",RMPRDOI) ; Supported by ICR 5747
"RTN","RMPOPED",304,0)
 S RMPRACSI=$P(RMPRACS,U,1)
"RTN","RMPOPED",305,0)
 ; Retrieve current ICD code info
"RTN","RMPOPED",306,0)
 S RMPRFILE=665.194,RMPRIENS=IEN(ITEM)_","_RMPODFN_","
"RTN","RMPOPED",307,0)
 S RMPRICDE=$$GET1^DIQ(RMPRFILE,RMPRIENS,7,"E",,) ; External ICD value for use with default value
"RTN","RMPOPED",308,0)
 S RMPRICDI=$$GET1^DIQ(RMPRFILE,RMPRIENS,7,"I",,) ; Internal ICD value
"RTN","RMPOPED",309,0)
 S RMPRIEN=RMPRICDI ; Save IEN in case user accepted default ICD value
"RTN","RMPOPED",310,0)
 I RMPRICDI>0 D
"RTN","RMPOPED",311,0)
 .S RMPRCSI=$$CSI^ICDEX(80,RMPRICDI) ; Code System Internal
"RTN","RMPOPED",312,0)
 .S RMPRDATE=$$SINFO^ICDEX(RMPRCSI)
"RTN","RMPOPED",313,0)
 .S RMPRDATE=$P(RMPRDATE,U,5) ; Implementation date of Code
"RTN","RMPOPED",314,0)
 .; Retrieve ICD info - 20 piece string
"RTN","RMPOPED",315,0)
 .S RMPRDATA=$$ICDDX^ICDEX(RMPRICDE,RMPRDATE,RMPRACSI,"E") ; Supported by ICR 5747
"RTN","RMPOPED",316,0)
 ; Prompt for (#1) VENDOR  (#2) QUANTITY  (#3) UNIT COST  (4) UNIT OF ISSUE
"RTN","RMPOPED",317,0)
 S DR=DR_"1R;2R;3R;4"
"RTN","RMPOPED",318,0)
 K RMCPRENT,RMCPTHCP
"RTN","RMPOPED",319,0)
 D ^DIE
"RTN","RMPOPED",320,0)
 Q:$$EQUIT
"RTN","RMPOPED",321,0)
 ;
"RTN","RMPOPED",322,0)
 ; ICD-9 Code Set
"RTN","RMPOPED",323,0)
 I $P(RMPRACS,U,2)="ICD-9-CM" D
"RTN","RMPOPED",324,0)
 .; Prompt for ICD code
"RTN","RMPOPED",325,0)
 .K DIC
"RTN","RMPOPED",326,0)
 .S DR="7ICD-9 DIAGNOSIS CODE: "
"RTN","RMPOPED",327,0)
 .I RMPRICDE'="" S DIC("B")=RMPRICDE
"RTN","RMPOPED",328,0)
 .D ^DIE
"RTN","RMPOPED",329,0)
 .Q:$$EQUIT
"RTN","RMPOPED",330,0)
 Q:$$QUIT
"RTN","RMPOPED",331,0)
 ;
"RTN","RMPOPED",332,0)
 ; ICD10 Code Set
"RTN","RMPOPED",333,0)
 I $P(RMPRACS,U,2)="ICD-10-CM" D
"RTN","RMPOPED",334,0)
 .N RMPPARAM
"RTN","RMPOPED",335,0)
 .; Initialize default prompt and help variables
"RTN","RMPOPED",336,0)
 .D SETPARAM^RMPOICD1(.RMPPARAM)
"RTN","RMPOPED",337,0)
 .; If existing ICD-10 code add to default prompt then Prompt and set needed variables
"RTN","RMPOPED",338,0)
 .I +RMPRICDI>0 D
"RTN","RMPOPED",339,0)
 ..; If existing ICD-10, add code & description
"RTN","RMPOPED",340,0)
 ..S RMPRTXT=$$VLT^ICDEX(80,RMPRICDI,RMPRDOI) ; Supported by ICR 5747
"RTN","RMPOPED",341,0)
 ..S RMPPARAM("SEARCH_PROMPT")=RMPPARAM("SEARCH_PROMPT")_RMPRICDE
"RTN","RMPOPED",342,0)
 ..S RMPRLLEN=244-$L(RMPPARAM("SEARCH_PROMPT"))
"RTN","RMPOPED",343,0)
 ..S RMPPARAM("SEARCH_PROMPT")=RMPPARAM("SEARCH_PROMPT")_" "_$E(RMPRTXT,1,RMPRLLEN)_" "
"RTN","RMPOPED",344,0)
 .; Loop to prompt for ICD-10 code
"RTN","RMPOPED",345,0)
 .F  D  Q:RMPRQUIT!(+RMPRICD>0)  ;  user quits OR ICD10 code was selected
"RTN","RMPOPED",346,0)
 ..; Output from $$DIAG10^RMPOICD1 = IEN file #80;ICD code value;IEN file # 757.01^description
"RTN","RMPOPED",347,0)
 ..S RMPRICD=$$DIAG10^RMPOICD1(RMPRDOI,RMPRICDE,.RMPPARAM)
"RTN","RMPOPED",348,0)
 ..; User selected valid code
"RTN","RMPOPED",349,0)
 ..I +RMPRICD>0 S RMPRQUIT=1 Q
"RTN","RMPOPED",350,0)
 .. ;if no data found
"RTN","RMPOPED",351,0)
 ..I RMPRICD="" W !!,RMPPARAM("NO DATA FOUND") Q
"RTN","RMPOPED",352,0)
 ..; User entered ^ OR ^^ to Quit
"RTN","RMPOPED",353,0)
 ..I +RMPRICD=-3 S (RMPRQUIT,QUIT)=1 Q
"RTN","RMPOPED",354,0)
 ..; User entered <enter> with no existing entry
"RTN","RMPOPED",355,0)
 ..I +RMPRICD=-1 S:$P(RMPRICD,U,2)=-1 RMPRQUIT=1 Q
"RTN","RMPOPED",356,0)
 ..; Existing ICD and user just pressed <enter>
"RTN","RMPOPED",357,0)
 ..I +RMPRICD=-5 S RMPRQUIT=1 Q
"RTN","RMPOPED",358,0)
 ..; Check for Deleting the ICD from the item - User entered @
"RTN","RMPOPED",359,0)
 ..I +RMPRICD=-6 D  Q
"RTN","RMPOPED",360,0)
 ...I RMPRICDE="" W "  <NOTHING TO DELETE>" Q
"RTN","RMPOPED",361,0)
 ...I $$QUESTION^RMPOICD1(1,RMPPARAM("DELETE IT"))=1 D DLTITEM^RMPOPED1(RMPODFN,IEN(ITEM)) S RMPRQUIT=1 Q
"RTN","RMPOPED",362,0)
 ...W "  <NOTHING DELETED>",!
"RTN","RMPOPED",363,0)
 ..; User timed out = QUIT
"RTN","RMPOPED",364,0)
 ..I +RMPRICD=-2 S (RMPRQUIT,QUIT)=1 Q
"RTN","RMPOPED",365,0)
 ..; User answered No to the "Do you wish to continue" prompt
"RTN","RMPOPED",366,0)
 ..I +RMPRICD=-4 Q
"RTN","RMPOPED",367,0)
 .;
"RTN","RMPOPED",368,0)
 .Q:$$QUIT
"RTN","RMPOPED",369,0)
 .; Set ICD Code (#7)
"RTN","RMPOPED",370,0)
 .I +RMPRICD>0 D
"RTN","RMPOPED",371,0)
 ..S DR="7////"_+RMPRICD
"RTN","RMPOPED",372,0)
 ..D ^DIE
"RTN","RMPOPED",373,0)
 ;
"RTN","RMPOPED",374,0)
 Q:$$QUIT
"RTN","RMPOPED",375,0)
 ; The final two fields are ask regardless of whether it was an ICD-9 or ICD-10 code
"RTN","RMPOPED",376,0)
 S DR="8;9R" ; (#8) REMARKS   (#9) ITEM TYPE
"RTN","RMPOPED",377,0)
 D ^DIE
"RTN","RMPOPED",378,0)
 I $D(DA),$D(RMCPT),(RMCPT'["RR") S $P(^RMPR(665,DA(1),"RMPOC",DA,0),U,12)="" ; (#11) HOME OXYGEN RENTAL FLAG
"RTN","RMPOPED",379,0)
 I $D(DA),$D(RMCPT),(RMCPT'["QH") S $P(^RMPR(665,DA(1),"RMPOC",DA,0),U,13)="" ; (#12) HOME OXYGEN CONSERVING FLAG
"RTN","RMPOPED",380,0)
 Q:$$EQUIT
"RTN","RMPOPED",381,0)
 ; Kludge to "point" to file 420
"RTN","RMPOPED",382,0)
 S DFCP=$P(^RMPR(665,RMPODFN,"RMPOC",IEN(ITEM),0),U,6) ;(#5) FUND CONTROL POINT
"RTN","RMPOPED",383,0)
 F  D  Q:(FCP>0)!QUIT
"RTN","RMPOPED",384,0)
 . S FCP=$$GETFCP^RMPOBILU(DFCP) Q:QUIT
"RTN","RMPOPED",385,0)
 . I FCP<0 W $C(7)_"REQUIRED FIELD!"
"RTN","RMPOPED",386,0)
 I FCP>0 S DR="5///"_$P(FCP,U,2) D ^DIE Q:$$EQUIT
"RTN","RMPOPED",387,0)
 ; End Kludge
"RTN","RMPOPED",388,0)
 ;S DR="7:9" D ^DIE Q:$$EQUIT
"RTN","RMPOPED",389,0)
 Q 
"RTN","RMPOPED",390,0)
 ;
"RTN","RMPOPED",391,0)
ITEMEP ; Primary Item edit...
"RTN","RMPOPED",392,0)
 N PIEN,PFLG,RMDA,RMNO
"RTN","RMPOPED",393,0)
 S RMDA=DA,DR="10" D ^DIE Q:$$QUIT
"RTN","RMPOPED",394,0)
 I $P(^RMPR(665,RMPODFN,"RMPOC",RMDA,0),U,11)'="Y" Q
"RTN","RMPOPED",395,0)
 ; Logic to control toggling of Primary Item flag...
"RTN","RMPOPED",396,0)
 S RMNO="N"
"RTN","RMPOPED",397,0)
 F RMX=0:0 S RMX=$O(^RMPR(665,RMPODFN,"RMPOC",RMX)) Q:RMX'>0  D
"RTN","RMPOPED",398,0)
 . Q:RMDA=RMX
"RTN","RMPOPED",399,0)
 . S DA=RMX,DR="10///^S X=RMNO" D ^DIE
"RTN","RMPOPED",400,0)
 S DA=RMDA
"RTN","RMPOPED",401,0)
 Q
"RTN","RMPOPED",402,0)
PIEN(DFN) ; FIND PRIMARY ITEM
"RTN","RMPOPED",403,0)
 ; RETURN IEN OF P.I. IN MULTIPLE ^ IEN IN FILE 661
"RTN","RMPOPED",404,0)
 N X,PIEN
"RTN","RMPOPED",405,0)
 S X=0,PIEN=0
"RTN","RMPOPED",406,0)
 F  S X=$O(^RMPR(665,DFN,"RMPOC",X)) Q:X'>0  D  Q:PIEN
"RTN","RMPOPED",407,0)
 . S:$P(^RMPR(665,DFN,"RMPOC",X,0),U,11)="Y" PIEN=X
"RTN","RMPOPED",408,0)
 S:PIEN PIEN=PIEN_U_$P(^RMPR(665,DFN,"RMPOC",PIEN,0),U,1)
"RTN","RMPOPED",409,0)
 Q PIEN
"RTN","RMPOPED",410,0)
 ;
"RTN","RMPOPED",411,0)
ITEMD ; Display Items
"RTN","RMPOPED",412,0)
 N I,Z,PIF,ITMNM,VDRNM,RMPRACS,RMPRACT,RMPRICD,RMPRPCS,RMPRTXT
"RTN","RMPOPED",413,0)
 S (RMPRACS,RMPRICD,RMPRPCS)=""
"RTN","RMPOPED",414,0)
 ; Determine Active Coding System based on Prescription DOI
"RTN","RMPOPED",415,0)
 S RMPRPCS=$$SINFO^ICDEX("DIAG",RMPRDOI)
"RTN","RMPOPED",416,0)
 K IEN,ITEMS,RMPRITEM S I=0
"RTN","RMPOPED",417,0)
 Q:$O(^RMPR(665,RMPODFN,"RMPOC",0))'>0
"RTN","RMPOPED",418,0)
 W !!,"The following items are already in this patient's template:",!
"RTN","RMPOPED",419,0)
 W !,"     Item Description                      Vendor                   ICD      CS+"
"RTN","RMPOPED",420,0)
 F IEN=1:1 S I=$O(^RMPR(665,RMPODFN,"RMPOC",I)) Q:I'>0  D
"RTN","RMPOPED",421,0)
 . S Z=^RMPR(665,RMPODFN,"RMPOC",I,0)
"RTN","RMPOPED",422,0)
 . S PIF=$S($P(Z,U,11)="Y":"*",1:" ")
"RTN","RMPOPED",423,0)
 . ; Load ICD and determine corresponding code set
"RTN","RMPOPED",424,0)
 . S RMPRICD=$P(Z,U,8),RMPRACT=""
"RTN","RMPOPED",425,0)
 . I RMPRICD'="" D
"RTN","RMPOPED",426,0)
 . . ; Check whether ICD code for this item was active on DOI
"RTN","RMPOPED",427,0)
 . . S RMPRACT=$$LS^ICDEX(80,+RMPRICD,RMPRDOI,1)
"RTN","RMPOPED",428,0)
 . . ; Get Active Coding System Info
"RTN","RMPOPED",429,0)
 . . S RMPRACS=$$CSI^ICDEX(80,+RMPRICD) ; Get interal coding system for this ICD code
"RTN","RMPOPED",430,0)
 . . S RMPRACS=$$SINFO^ICDEX(RMPRACS) ; get external format for coding system
"RTN","RMPOPED",431,0)
 . . S RMPRACS=$P(RMPRACS,U,2),RMPRACS=$P(RMPRACS,"-",2)
"RTN","RMPOPED",432,0)
 . . S RMPRICD=$$CODEC^ICDEX(80,RMPRICD)
"RTN","RMPOPED",433,0)
 . S ITMNM=$$ITEMNM($P(Z,U)),VDRNM=$$VDRNM($P(Z,U,2))
"RTN","RMPOPED",434,0)
 . S IEN(IEN)=I
"RTN","RMPOPED",435,0)
 . S VDRNM=$E(VDRNM,1,23)
"RTN","RMPOPED",436,0)
 . S RMPRTXT=PIF_$J(IEN,3)_" "_$$LJ(ITMNM,38)_$$LJ(VDRNM,24)
"RTN","RMPOPED",437,0)
 . S RMPRITEM(IEN)=RMPRTXT
"RTN","RMPOPED",438,0)
 . I RMPRICD'="" D
"RTN","RMPOPED",439,0)
 . . S $E(RMPRTXT,69)="",RMPRTXT=RMPRTXT_RMPRICD
"RTN","RMPOPED",440,0)
 . . S $E(RMPRTXT,78)=""
"RTN","RMPOPED",441,0)
 . . I RMPRACS=9 S RMPRTXT=RMPRTXT_" "
"RTN","RMPOPED",442,0)
 . . S RMPRTXT=RMPRTXT_RMPRACS
"RTN","RMPOPED",443,0)
 . . I +RMPRACT=1 S RMPRTXT=RMPRTXT_"+"
"RTN","RMPOPED",444,0)
 . W !,RMPRTXT
"RTN","RMPOPED",445,0)
 . S ITEMS(IEN)=RMPRTXT
"RTN","RMPOPED",446,0)
 . S $P(RMPRITEM(IEN),U,2)=RMPRICD,$P(RMPRITEM(IEN),U,3)=RMPRACS,$P(RMPRITEM(IEN),U,4)=$S(+RMPRACT=1:"+",1:"")
"RTN","RMPOPED",447,0)
 W !!," * = Primary Item  "
"RTN","RMPOPED",448,0)
 W !,"CS = Code Set for ICD Diagnosis code"
"RTN","RMPOPED",449,0)
 W !," + = Item with active ICD code on start date of prescription",!
"RTN","RMPOPED",450,0)
 S IEN=IEN-1
"RTN","RMPOPED",451,0)
 Q
"RTN","RMPOPED",452,0)
 ;
"RTN","RMPOPED",453,0)
ITEMNM(ITM) ; RETURN ITEM NAME
"RTN","RMPOPED",454,0)
 S IENS=ITM_","
"RTN","RMPOPED",455,0)
 D GETS^DIQ(661,IENS,.01,"","X")
"RTN","RMPOPED",456,0)
 Q $E(X(661,IENS,.01),1,33)
"RTN","RMPOPED",457,0)
VDRNM(VDR) ; RETURN VENDOR NAME
"RTN","RMPOPED",458,0)
 I VDR="" Q "<< VENDOR NOT DEFINED >>"
"RTN","RMPOPED",459,0)
 S IENS=VDR_"," D GETS^DIQ(440,IENS,.01,"","X")
"RTN","RMPOPED",460,0)
 Q X(440,IENS,.01)
"RTN","RMPOPED",461,0)
ITEMK ; Delete an Item
"RTN","RMPOPED",462,0)
 ;
"RTN","RMPOPED",463,0)
 K DIR S DIR(0)="Y",DIR("A")="Are you SURE you want to delete this item"
"RTN","RMPOPED",464,0)
 S DIR("B")="NO" D ^DIR Q:Y'>0
"RTN","RMPOPED",465,0)
 K DIK,DA
"RTN","RMPOPED",466,0)
 S DA(1)=RMPODFN,DA=IEN(ITEM),DIK="^RMPR(665,"_DA(1)_",""RMPOC"","
"RTN","RMPOPED",467,0)
 D ^DIK W "  ...deleted!"
"RTN","RMPOPED",468,0)
 Q
"RTN","RMPOPED",469,0)
ITEMO() ; Choose Option
"RTN","RMPOPED",470,0)
 K DIR
"RTN","RMPOPED",471,0)
 S DIR(0)="SBO^A:Add;D:Delete;E:Edit",DIR("A")="Select ACTION" D ^DIR
"RTN","RMPOPED",472,0)
 Q Y
"RTN","RMPOPED",473,0)
 ;
"RTN","RMPOPED",474,0)
PARSE(RMPRTXT) ; Utility to break line of text over 80 characters into 2 lines
"RTN","RMPOPED",475,0)
 ; Input:
"RTN","RMPOPED",476,0)
 ; RMPRTXT = Two line array to parse
"RTN","RMPOPED",477,0)
 ;          RMPRTXT(1) = ICD-## Diagnosis code: ###.#### -          Required
"RTN","RMPOPED",478,0)
 ;          RMPRTXT(2) = Full Description up to 245 characters      Required
"RTN","RMPOPED",479,0)
 ;          RMPRTXT(3) = Suspense Info                              Optional
"RTN","RMPOPED",480,0)
 ; 
"RTN","RMPOPED",481,0)
 ; Output:
"RTN","RMPOPED",482,0)
 ; RMPRTXT array with each line of text < 80 characters and ending in a whole word.
"RTN","RMPOPED",483,0)
 ;
"RTN","RMPOPED",484,0)
 ;
"RTN","RMPOPED",485,0)
 N RMPRFND,RMPRCNT1,RMPRCNT2,RMPRLLEN,RMPRSUSP
"RTN","RMPOPED",486,0)
 S RMPRFND=""
"RTN","RMPOPED",487,0)
 I $G(RMPRTXT(1))="" S RMPRTXT(1)="No ICD Code" Q
"RTN","RMPOPED",488,0)
 I $G(RMPRTXT(2))="" S RMPRTXT(2)="No ICD Code Description" Q
"RTN","RMPOPED",489,0)
 ; Save Suspense Data if it exists
"RTN","RMPOPED",490,0)
 S RMPRSUSP=$G(RMPRTXT(3)) K RMPRTXT(3)
"RTN","RMPOPED",491,0)
 ; Check to see if Code & Description will fit on one 80 character line
"RTN","RMPOPED",492,0)
 I $L(RMPRTXT(1))+$L(RMPRTXT(2))'>80 D  Q
"RTN","RMPOPED",493,0)
 .S RMPRTXT(1)=RMPRTXT(1)_RMPRTXT(2)
"RTN","RMPOPED",494,0)
 .K RMPRTXT(2)
"RTN","RMPOPED",495,0)
 .; If Suspense info, add it to end of description
"RTN","RMPOPED",496,0)
 .I $L(RMPRSUSP)>0 D  Q
"RTN","RMPOPED",497,0)
 ..I $L(RMPRTXT(1))<47 S RMPRTXT(1)=RMPRTXT(1)_RMPRSUSP Q
"RTN","RMPOPED",498,0)
 ..S RMPRTXT(2)=RMPRSUSP
"RTN","RMPOPED",499,0)
 ..Q
"RTN","RMPOPED",500,0)
 ; Adjust parser for 1st line with ICD Code plus 1 space after ICD code
"RTN","RMPOPED",501,0)
 S RMPRLLEN=80-$L(RMPRTXT(1))+1
"RTN","RMPOPED",502,0)
 F RMPRCNT1=RMPRLLEN:-1:1 D  Q:RMPRFND
"RTN","RMPOPED",503,0)
 .I $E(RMPRTXT(2),RMPRCNT1)=" " D  Q:RMPRFND
"RTN","RMPOPED",504,0)
 ..S RMPRTXT(1)=RMPRTXT(1)_$E(RMPRTXT(2),1,RMPRCNT1-1)
"RTN","RMPOPED",505,0)
 ..S RMPRTXT(2)=" "_$E(RMPRTXT(2),RMPRCNT1+1,999)
"RTN","RMPOPED",506,0)
 ..S RMPRFND=1
"RTN","RMPOPED",507,0)
 ; Loop through remainder of Description text and parse into 80 character lines with no word breaks
"RTN","RMPOPED",508,0)
 F RMPRCNT1=2:1 Q:'$D(RMPRTXT(RMPRCNT1))!($L(RMPRTXT(RMPRCNT1))'>80)  D  ; Line counter
"RTN","RMPOPED",509,0)
 .S RMPRFND=0
"RTN","RMPOPED",510,0)
 .F RMPRCNT2=80:-1:1 D  Q:RMPRFND  ; line break counter
"RTN","RMPOPED",511,0)
 ..I $E(RMPRTXT(RMPRCNT1),RMPRCNT2)=" " D  Q:RMPRFND
"RTN","RMPOPED",512,0)
 ...S RMPRTXT(RMPRCNT1+1)=" "_$E(RMPRTXT(RMPRCNT1),RMPRCNT2+1,999)
"RTN","RMPOPED",513,0)
 ...S RMPRTXT(RMPRCNT1)=$E(RMPRTXT(RMPRCNT1),1,RMPRCNT2-1)
"RTN","RMPOPED",514,0)
 ...S RMPRFND=1 ; Stop for line breaks
"RTN","RMPOPED",515,0)
 ; If Suspense info, add it to end of description
"RTN","RMPOPED",516,0)
 I $L(RMPRSUSP)>0 D
"RTN","RMPOPED",517,0)
 .; Check to Add to last line
"RTN","RMPOPED",518,0)
 .I $L(RMPRTXT(RMPRCNT1))<47 S RMPRTXT(RMPRCNT1)=RMPRTXT(RMPRCNT1)_" "_RMPRSUSP Q
"RTN","RMPOPED",519,0)
 .; Add to new line
"RTN","RMPOPED",520,0)
 .I $L(RMPRTXT(RMPRCNT1))'<47 S RMPRTXT(RMPRCNT1+1)=" "_RMPRSUSP
"RTN","RMPOPED",521,0)
 Q
"RTN","RMPOPED",522,0)
 ; End of RMPOPED
"RTN","RMPOPED1")
0^13^B3131356^n/a
"RTN","RMPOPED1",1,0)
RMPOPED1 ;EDS/MDB,DDW,RVD - HOME OXYGEN MISC FILE EDITS CONT. ;7/24/98
"RTN","RMPOPED1",2,0)
 ;;3.0;PROSTHETICS;**168**;Feb 09, 1996;Build 43
"RTN","RMPOPED1",3,0)
 ;
"RTN","RMPOPED1",4,0)
RMPRWARN(RMPRICD,RMPRACS,RMPODFN,ITEM,RMPRCONT) ;
"RTN","RMPOPED1",5,0)
 ; Display Inactive ICD code warning.
"RTN","RMPOPED1",6,0)
 W !!,"This item contains the ICD Diagnosis Code: ",RMPRICD," which was inactive based"
"RTN","RMPOPED1",7,0)
 W !,"on the start date of the currently selected prescription."
"RTN","RMPOPED1",8,0)
 W !!,"You may 1) select a different item with no ICD code or with an active ICD code,"
"RTN","RMPOPED1",9,0)
 W !,"        2) enter a new item or "
"RTN","RMPOPED1",10,0)
 W !,"        3) proceed with this item.  If you proceed with this item, the existing"
"RTN","RMPOPED1",11,0)
 W !,"           ICD Diagnosis code ",RMPRICD," will be DELETED."
"RTN","RMPOPED1",12,0)
 W !!,"You may then enter an active ICD-",RMPRACS," Diagnosis code or you may leave"
"RTN","RMPOPED1",13,0)
 W !,"the ICD Diagnosis field blank."
"RTN","RMPOPED1",14,0)
 ; Prompt user to continue or not
"RTN","RMPOPED1",15,0)
 S RMPRCONT=$$CONTINUE()
"RTN","RMPOPED1",16,0)
 ; User does want to continue so delete ICD code from currently selected Item
"RTN","RMPOPED1",17,0)
 I RMPRCONT=1 D DLTITEM(RMPODFN,ITEM) Q
"RTN","RMPOPED1",18,0)
 ; User doesn't want to continue
"RTN","RMPOPED1",19,0)
 S ITEM=""
"RTN","RMPOPED1",20,0)
 Q
"RTN","RMPOPED1",21,0)
 ;
"RTN","RMPOPED1",22,0)
CONTINUE() ;
"RTN","RMPOPED1",23,0)
 ; prompt user to continue w/ current Item after warning was issued
"RTN","RMPOPED1",24,0)
 N DIR
"RTN","RMPOPED1",25,0)
 S DIR("A")="Do you wish to continue? ",DIR(0)="YA"
"RTN","RMPOPED1",26,0)
 W !
"RTN","RMPOPED1",27,0)
 D ^DIR
"RTN","RMPOPED1",28,0)
 W !
"RTN","RMPOPED1",29,0)
 I $D(DTOUT)!($D(DUOUT))!($D(DIROUT)) Q -1
"RTN","RMPOPED1",30,0)
 ; User quits - back to Item Prompt
"RTN","RMPOPED1",31,0)
 I Y<1 Q -1
"RTN","RMPOPED1",32,0)
 Q 1
"RTN","RMPOPED1",33,0)
 ;
"RTN","RMPOPED1",34,0)
DLTITEM(RMPODFN,ITEM) ;
"RTN","RMPOPED1",35,0)
 ; Delete Inactive ICD code from Item 
"RTN","RMPOPED1",36,0)
 S DA(1)=RMPODFN,DA=ITEM
"RTN","RMPOPED1",37,0)
 S DIE="^RMPR(665,"_DA(1)_",""RMPOC"","
"RTN","RMPOPED1",38,0)
 S DR="7///@"
"RTN","RMPOPED1",39,0)
 D ^DIE
"RTN","RMPOPED1",40,0)
 Q
"RTN","RMPOPED1",41,0)
 Q
"RTN","RMPOPED1",42,0)
 ; End of RMPOPED1
"RTN","RMPR9LN1")
0^7^B10033385^B10038287
"RTN","RMPR9LN1",1,0)
RMPR9LN1 ;HOIFO/HNC -  FLEX FIELD SORT;9/18/02 11:38
"RTN","RMPR9LN1",2,0)
 ;;3.0;PROSTHETICS;**90,75,60,125,168**;Feb 09, 1996;Build 43
"RTN","RMPR9LN1",3,0)
 ;SPS - Patch 75 added DALC section at the end.
"RTN","RMPR9LN1",4,0)
EN(RESULT) ;
"RTN","RMPR9LN1",5,0)
 ;RESULT passed to broker in ^TMP($J,
"RTN","RMPR9LN1",6,0)
 ;delimited by "^"
"RTN","RMPR9LN1",7,0)
 K ^TMP($J)
"RTN","RMPR9LN1",8,0)
 N RMPRII,RMPRLN
"RTN","RMPR9LN1",9,0)
 S CNT=0
"RTN","RMPR9LN1",10,0)
 F RMPRII=1:1 S RMPRLN=$P($T(HLST+RMPRII),";",4) Q:RMPRLN=""  D
"RTN","RMPR9LN1",11,0)
 .S RMPRFLD=$P($T(HLST+RMPRII),";",3)
"RTN","RMPR9LN1",12,0)
 .S CNT=CNT+1
"RTN","RMPR9LN1",13,0)
 .S ^TMP($J,"RMPR",CNT)=RMPRLN_U_RMPRFLD
"RTN","RMPR9LN1",14,0)
 S RESULT=$NA(^TMP($J))
"RTN","RMPR9LN1",15,0)
 Q
"RTN","RMPR9LN1",16,0)
HLST ;pick list
"RTN","RMPR9LN1",17,0)
 ;;0;*** COMMON/PURCHASING ***
"RTN","RMPR9LN1",18,0)
 ;;1;Date Item Added To PO
"RTN","RMPR9LN1",19,0)
 ;;2;Type Of Transaction
"RTN","RMPR9LN1",20,0)
 ;;4;Billing Item
"RTN","RMPR9LN1",21,0)
 ;;10;Delivery Date
"RTN","RMPR9LN1",22,0)
 ;;11;Form
"RTN","RMPR9LN1",23,0)
 ;;12;Souce
"RTN","RMPR9LN1",24,0)
 ;;14;Total Cost
"RTN","RMPR9LN1",25,0)
 ;;16;Remarks
"RTN","RMPR9LN1",26,0)
 ;;20;DELIVERY VERIFICATION DATE
"RTN","RMPR9LN1",27,0)
 ;;20.1;DELIVERY VERIFICATION STATUS
"RTN","RMPR9LN1",28,0)
 ;;23;Transaction Number or PO Number
"RTN","RMPR9LN1",29,0)
 ;;24;Brief Description
"RTN","RMPR9LN1",30,0)
 ;;25;Deliver To
"RTN","RMPR9LN1",31,0)
 ;;26;Date Required
"RTN","RMPR9LN1",32,0)
 ;;27;Initiator
"RTN","RMPR9LN1",33,0)
 ;;38.1;Exclude/Waiver
"RTN","RMPR9LN1",34,0)
 ;;38.7;Contract #
"RTN","RMPR9LN1",35,0)
 ;;62;Patient Category
"RTN","RMPR9LN1",36,0)
 ;;63;Special Category
"RTN","RMPR9LN1",37,0)
 ;;34;OIF/OEF
"RTN","RMPR9LN1",38,0)
 ;;78;Unit Of Issue
"RTN","RMPR9LN1",39,0)
 ;;89;Saved Item Description
"RTN","RMPR9LN1",40,0)
 ;;0;*** INVENTORY ***
"RTN","RMPR9LN1",41,0)
 ;;4.6;Stock Issue Date
"RTN","RMPR9LN1",42,0)
 ;;37;PIP Item Description
"RTN","RMPR9LN1",43,0)
 ;;38;HCPCS PIP Description
"RTN","RMPR9LN1",44,0)
 ;;0;*** PRODUCT INFORMATION ***
"RTN","RMPR9LN1",45,0)
 ;;4.9;Coding Error Flag
"RTN","RMPR9LN1",46,0)
 ;;4.91;Coding Flag Date
"RTN","RMPR9LN1",47,0)
 ;;8.12;PCE
"RTN","RMPR9LN1",48,0)
 ;;8.13;PCE Date
"RTN","RMPR9LN1",49,0)
 ;;9;Serial Number
"RTN","RMPR9LN1",50,0)
 ;;9.1;Product Description
"RTN","RMPR9LN1",51,0)
 ;;9.2;Product Model
"RTN","RMPR9LN1",52,0)
 ;;21;Lot Number
"RTN","RMPR9LN1",53,0)
 ;;35;Who Edit 2319
"RTN","RMPR9LN1",54,0)
 ;;36;Date of Edit 2319
"RTN","RMPR9LN1",55,0)
 ;;0;*** SUSPENSE ***
"RTN","RMPR9LN1",56,0)
 ;;8.1;Suspense Date
"RTN","RMPR9LN1",57,0)
 ;;8.11;Suspense Station
"RTN","RMPR9LN1",58,0)
 ;;8.14;Suspense Status
"RTN","RMPR9LN1",59,0)
 ;;8.2;Date RX Written
"RTN","RMPR9LN1",60,0)
 ;;8.3;Initial Action Date
"RTN","RMPR9LN1",61,0)
 ;;8.4;Completion Date
"RTN","RMPR9LN1",62,0)
 ;;8.5;Type of Request
"RTN","RMPR9LN1",63,0)
 ;;8.6;Suspense Requestor
"RTN","RMPR9LN1",64,0)
 ;;8.61;Consult Request Service
"RTN","RMPR9LN1",65,0)
 ;;8.7;Provisional Diagnosis
"RTN","RMPR9LN1",66,0)
 ;;8.8;Suspense ICD
"RTN","RMPR9LN1",67,0)
 ;;8.9;Consult Date
"RTN","RMPR9LN1",68,0)
 ;;0;*** RETURNED ITEMS ***
"RTN","RMPR9LN1",69,0)
 ;;13;Action
"RTN","RMPR9LN1",70,0)
 ;;17;Returned Status
"RTN","RMPR9LN1",71,0)
 ;;17.5;Retruned Status Date
"RTN","RMPR9LN1",72,0)
 ;;0;*** ORTHO LAB ***
"RTN","RMPR9LN1",73,0)
 ;;40;Lab Requesting Station
"RTN","RMPR9LN1",74,0)
 ;;45;Total Lab Labor Hours
"RTN","RMPR9LN1",75,0)
 ;;46;Total Lab Labor Cost
"RTN","RMPR9LN1",76,0)
 ;;47;Total Lab Material Cost
"RTN","RMPR9LN1",77,0)
 ;;48;Total Lab Cost
"RTN","RMPR9LN1",78,0)
 ;;50;Lab Completion Date
"RTN","RMPR9LN1",79,0)
 ;;51;Lab Remarks
"RTN","RMPR9LN1",80,0)
 ;;69;Source of Procurement
"RTN","RMPR9LN1",81,0)
 ;;70;Receiving Station
"RTN","RMPR9LN1",82,0)
 ;;71;Work Order Number
"RTN","RMPR9LN1",83,0)
 ;;72;2529-3 Date
"RTN","RMPR9LN1",84,0)
 ;;4.92;HIGH TECH ITEM
"RTN","RMPR9LN1",85,0)
 ;;72.5;FREE TEXT WO #
"RTN","RMPR9LN1",86,0)
 ;;80;Lab Work for Other Station
"RTN","RMPR9LN1",87,0)
 ;;81;NO ADMIN COUNT
"RTN","RMPR9LN1",88,0)
 ;;0;*** DALC ***
"RTN","RMPR9LN1",89,0)
 ;;89.1;DALC REFERENCE NUMBER
"RTN","RMPR9LN1",90,0)
 ;;89.2;DALC BILLING DATE
"RTN","RMPR9LN1",91,0)
 ;;89;DALC ITEM
"RTN","RMPR9LN1",92,0)
 ;;4.2;WHO PLACED ORDER
"RTN","RMPR9LN1",93,0)
 ;;89.3;DALC ORDERING STATION
"RTN","RMPR9LN1",94,0)
 ;;90;DALC BILLING STATION
"RTN","RMPR9LN1",95,0)
 ;;91;DALC VENDOR
"RTN","RMPR9LN1",96,0)
 ;;92;DALC DUNS
"RTN","RMPR9LN1",97,0)
 ;;93;DALC TAXID
"RTN","RMPR9LN1",98,0)
 ;END
"RTN","RMPR9LNP")
0^8^B42337320^B11512783
"RTN","RMPR9LNP",1,0)
RMPR9LNP ;Hines OIFO/HNC - REMOTE PROCEDURE, LIST NPPD DATA ;9/8/03  07:23
"RTN","RMPR9LNP",2,0)
 ;;3.0;PROSTHETICS;**71,77,90,75,60,143,150,168**;Feb 09, 1996;Build 43
"RTN","RMPR9LNP",3,0)
 ;
"RTN","RMPR9LNP",4,0)
 ; Reference to $$SINFO^ICDEX supported by ICR #5747
"RTN","RMPR9LNP",5,0)
 ; Reference to $$ICDDX^ICDEX supported by ICR #5747
"RTN","RMPR9LNP",6,0)
 ; Reference to $$CSI^ICDEX   supported by ICR #5747
"RTN","RMPR9LNP",7,0)
 ;
"RTN","RMPR9LNP",8,0)
 ;    HNC - Sept 2, 2003 - patch 77 remove the " for Excel CSV
"RTN","RMPR9LNP",9,0)
 ;    HNC - Feb 14, 2005 - patch 90 add flex field to GUI display
"RTN","RMPR9LNP",10,0)
 ;    HNC - Nov 15, 2005 - patch 75 add 2 additional flex field to gui
"RTN","RMPR9LNP",11,0)
 ;    RRA - March 20, 2008 - patch 143 added " back for excel CSV
"RTN","RMPR9LNP",12,0)
 ;
"RTN","RMPR9LNP",13,0)
 ;RESULTS passed to broker in ^TMP($J,
"RTN","RMPR9LNP",14,0)
 ;delimited by "^"
"RTN","RMPR9LNP",15,0)
 ;piece 1 = ENTRY DATE
"RTN","RMPR9LNP",16,0)
 ;piece 2 = PATIENT NAME  IF OEF/OIF <!> PRECEDES THE NAME
"RTN","RMPR9LNP",17,0)
 ;piece 3 = PSAS HCPCS with * if hcpcs has Calculation Flag
"RTN","RMPR9LNP",18,0)
 ;piece 4 = QTY
"RTN","RMPR9LNP",19,0)
 ;piece 5 = VENDOR
"RTN","RMPR9LNP",20,0)
 ;piece 6 = INITIAL ACTION DATE
"RTN","RMPR9LNP",21,0)
 ;piece 7 = TOTAL COST
"RTN","RMPR9LNP",22,0)
 ;piece 8 = DESCRIPTION
"RTN","RMPR9LNP",23,0)
 ;piece 9 = INITIATOR
"RTN","RMPR9LNP",24,0)
 ;piece 10 = NPPD LINE BEFORE GROUPER
"RTN","RMPR9LNP",25,0)
 ;piece 11 = STATION
"RTN","RMPR9LNP",26,0)
 ;piece 12 = GROUPER NUMBER
"RTN","RMPR9LNP",27,0)
 ;piece 13 = FORM REQUESTED ON
"RTN","RMPR9LNP",28,0)
 ;piece 14 = TYPE OF TRANSACTION
"RTN","RMPR9LNP",29,0)
 ;piece 15 = SSN
"RTN","RMPR9LNP",30,0)
 ;piece 16 = IEN TO FILE 660
"RTN","RMPR9LNP",31,0)
 ;piece 17 = HCPCS SHORT DESCRIPTION
"RTN","RMPR9LNP",32,0)
 ;piece 18 = SOURCE
"RTN","RMPR9LNP",33,0)
 ;piece 19 = Optional Flex Field
"RTN","RMPR9LNP",34,0)
 ;piece 20 = Optional Flex Field
"RTN","RMPR9LNP",35,0)
 ;piece 21 = Optional Flex Field
"RTN","RMPR9LNP",36,0)
 Q
"RTN","RMPR9LNP",37,0)
 ;
"RTN","RMPR9LNP",38,0)
EN(RESULT,DATE1,DATE2,FLEXF,FLEX2,FLEX3) ;broker entry point
"RTN","RMPR9LNP",39,0)
 ;
"RTN","RMPR9LNP",40,0)
 K ^TMP($J)
"RTN","RMPR9LNP",41,0)
 I '$D(DATE1)!('$D(DATE2)) G EXIT
"RTN","RMPR9LNP",42,0)
 S DATE=DATE1-1
"RTN","RMPR9LNP",43,0)
 F  S DATE=$O(^RMPR(660,"B",DATE)) Q:(DATE="")!($P(DATE,".",1)>DATE2)  D
"RTN","RMPR9LNP",44,0)
 .S RMPRB=0
"RTN","RMPR9LNP",45,0)
 .F  S RMPRB=$O(^RMPR(660,"B",DATE,RMPRB)) Q:RMPRB=""  D
"RTN","RMPR9LNP",46,0)
 ..I $P(^RMPR(660,RMPRB,0),U,15)["*" Q:$P($G(^RMPR(660,RMPRB,"HSTV1")),U,3)=""
"RTN","RMPR9LNP",47,0)
 ..S PHCPCS=$P($G(^RMPR(660,RMPRB,1)),U,4)
"RTN","RMPR9LNP",48,0)
 ..Q:PHCPCS=""
"RTN","RMPR9LNP",49,0)
 ..Q:PHCPCS'>0
"RTN","RMPR9LNP",50,0)
 ..S HDES=$P(^RMPR(661.1,PHCPCS,0),U,2)
"RTN","RMPR9LNP",51,0)
 ..S TYPE=$P($G(^RMPR(660,RMPRB,0)),U,4)
"RTN","RMPR9LNP",52,0)
 ..I "X5"'[TYPE S LINE=$P(^RMPR(661.1,PHCPCS,0),U,7)
"RTN","RMPR9LNP",53,0)
 ..I "X5"[TYPE S LINE=$P(^RMPR(661.1,PHCPCS,0),U,6)
"RTN","RMPR9LNP",54,0)
 ..S CAL=$P(^RMPR(661.1,PHCPCS,0),U,8)
"RTN","RMPR9LNP",55,0)
 ..I CAL'="" S CAL="*"
"RTN","RMPR9LNP",56,0)
 ..S DFN=$P(^RMPR(660,RMPRB,0),U,2)
"RTN","RMPR9LNP",57,0)
 ..D DEM^VADPT,SVC^VADPT
"RTN","RMPR9LNP",58,0)
 ..S RMPROEOI=$S(VASV(11)>0:"<!>",VASV(12)>0:"<!>",VASV(13)>0:"<!>",1:0)
"RTN","RMPR9LNP",59,0)
 ..D DATA
"RTN","RMPR9LNP",60,0)
 S RESULT=$NA(^TMP($J))
"RTN","RMPR9LNP",61,0)
 K DATE,DFN,HDES,LINE,PHCPCS,RMPRB,RMPRFLD,TYPE,B
"RTN","RMPR9LNP",62,0)
 Q
"RTN","RMPR9LNP",63,0)
 ;
"RTN","RMPR9LNP",64,0)
DATA ;
"RTN","RMPR9LNP",65,0)
 ;
"RTN","RMPR9LNP",66,0)
 ; ICD10 Changes - Determine Active Coding System
"RTN","RMPR9LNP",67,0)
 N RMPRCSI
"RTN","RMPR9LNP",68,0)
 S RMPRCSI=$$SINFO^ICDEX("DIAG",DATE) ; Coding System Info
"RTN","RMPR9LNP",69,0)
 ;
"RTN","RMPR9LNP",70,0)
 S B=RMPRB
"RTN","RMPR9LNP",71,0)
 S RMPRFLD=".01;.02;4.5;5;7;8;8.3;11;12;14;24;27;68"
"RTN","RMPR9LNP",72,0)
 ;
"RTN","RMPR9LNP",73,0)
 ; Process user selected fields
"RTN","RMPR9LNP",74,0)
 I FLEXF'="" S RMPRFLD=RMPRFLD_";"_FLEXF
"RTN","RMPR9LNP",75,0)
 I FLEX2'="" S RMPRFLD=RMPRFLD_";"_FLEX2
"RTN","RMPR9LNP",76,0)
 I FLEX3'="" S RMPRFLD=RMPRFLD_";"_FLEX3
"RTN","RMPR9LNP",77,0)
 ;
"RTN","RMPR9LNP",78,0)
 I FLEXF=8.7!(FLEX2=8.7)!(FLEX3=8.7) D
"RTN","RMPR9LNP",79,0)
 .I (";"_RMPRFLD_";")'[(";"_8.8_";") S RMPRFLD=RMPRFLD_";"_8.8
"RTN","RMPR9LNP",80,0)
 ;
"RTN","RMPR9LNP",81,0)
 D GETS^DIQ(660,B,RMPRFLD,"","RMXM")
"RTN","RMPR9LNP",82,0)
 S RMPRPTNM=$G(RMXM(660,B_",",.02))
"RTN","RMPR9LNP",83,0)
 I RMPROEOI["<" S RMPRPTNM=RMPROEOI_RMPRPTNM
"RTN","RMPR9LNP",84,0)
 S $P(^TMP($J,B),U,1)=$G(RMXM(660,B_",",.01))
"RTN","RMPR9LNP",85,0)
 S $P(^TMP($J,B),U,2)=RMPRPTNM
"RTN","RMPR9LNP",86,0)
 S $P(^TMP($J,B),U,3)=$G(RMXM(660,B_",",4.5))_CAL
"RTN","RMPR9LNP",87,0)
 S $P(^TMP($J,B),U,4)=$G(RMXM(660,B_",",5))
"RTN","RMPR9LNP",88,0)
 S $P(^TMP($J,B),U,5)=$G(RMXM(660,B_",",7))
"RTN","RMPR9LNP",89,0)
 S $P(^TMP($J,B),U,6)=$G(RMXM(660,B_",",8.3))
"RTN","RMPR9LNP",90,0)
 S $P(^TMP($J,B),U,7)=$G(RMXM(660,B_",",14))
"RTN","RMPR9LNP",91,0)
 S $P(^TMP($J,B),U,8)=$G(RMXM(660,B_",",24))
"RTN","RMPR9LNP",92,0)
 S $P(^TMP($J,B),U,9)=$G(RMXM(660,B_",",27))
"RTN","RMPR9LNP",93,0)
 S $P(^TMP($J,B),U,10)=LINE
"RTN","RMPR9LNP",94,0)
 S $P(^TMP($J,B),U,11)=$G(RMXM(660,B_",",8))
"RTN","RMPR9LNP",95,0)
 S $P(^TMP($J,B),U,12)=$G(RMXM(660,B_",",68))
"RTN","RMPR9LNP",96,0)
 S $P(^TMP($J,B),U,13)=$G(RMXM(660,B_",",11))
"RTN","RMPR9LNP",97,0)
 S $P(^TMP($J,B),U,14)=TYPE
"RTN","RMPR9LNP",98,0)
 S $P(^TMP($J,B),U,15)=$P(VADM(2),U,2)
"RTN","RMPR9LNP",99,0)
 S $P(^TMP($J,B),U,16)=B
"RTN","RMPR9LNP",100,0)
 S $P(^TMP($J,B),U,17)=HDES
"RTN","RMPR9LNP",101,0)
 S $P(^TMP($J,B),U,18)=$E($G(RMXM(660,B_",",12)),0,1)
"RTN","RMPR9LNP",102,0)
 ;
"RTN","RMPR9LNP",103,0)
 ; Process user selected fields
"RTN","RMPR9LNP",104,0)
 I FLEXF'="" D
"RTN","RMPR9LNP",105,0)
 .; Check if PROVISIONAL DIAGNOSIS (#8.7) was selected 
"RTN","RMPR9LNP",106,0)
 .I FLEXF=8.7 D  Q
"RTN","RMPR9LNP",107,0)
 ..; If ICD-9 era get #8.7 from #660
"RTN","RMPR9LNP",108,0)
 ..I +RMPRCSI=1,($G(RMXM(660,B_",",FLEXF))'="") S $P(^TMP($J,B),U,19)=$G(RMXM(660,B_",",FLEXF)) Q
"RTN","RMPR9LNP",109,0)
 ..; If ICD-10 era get "short description" (i.e. DIAGNOSIS) from #80
"RTN","RMPR9LNP",110,0)
 ..I +RMPRCSI=30,($G(RMXM(660,B_",",FLEXF))'="")  D  Q
"RTN","RMPR9LNP",111,0)
 ...S $P(^TMP($J,B),U,19)=$$ICDSD(RMXM(660,B_",",8.8),DATE,+RMPRCSI)
"RTN","RMPR9LNP",112,0)
 ..; If Provisional Diagnosis was blank
"RTN","RMPR9LNP",113,0)
 ..S $P(^TMP($J,B),U,19)=""
"RTN","RMPR9LNP",114,0)
 .; Check if SUSPENSE ICD (#8.8) was selected
"RTN","RMPR9LNP",115,0)
 .I FLEXF=8.8 D  Q
"RTN","RMPR9LNP",116,0)
 ..I $G(RMXM(660,B_",",FLEXF))'="" D ICDCS(FLEXF,19,RMPRB_",") Q
"RTN","RMPR9LNP",117,0)
 ..S $P(^TMP($J,B),U,19)=""
"RTN","RMPR9LNP",118,0)
 .; User specified a field other than 8.7 or 8.8
"RTN","RMPR9LNP",119,0)
 .I FLEXF'="" S $P(^TMP($J,B),U,19)=$G(RMXM(660,B_",",FLEXF))
"RTN","RMPR9LNP",120,0)
 ; User didn't specify a field for 1st choice
"RTN","RMPR9LNP",121,0)
 I FLEXF="" S $P(^TMP($J,B),U,19)=""
"RTN","RMPR9LNP",122,0)
 ;
"RTN","RMPR9LNP",123,0)
 ; Process 2nd user selected field
"RTN","RMPR9LNP",124,0)
 I FLEX2'="" D
"RTN","RMPR9LNP",125,0)
 .; Check if PROVISIONAL DIAGNOSIS (#8.7) was selected 
"RTN","RMPR9LNP",126,0)
 .I FLEX2=8.7 D  Q
"RTN","RMPR9LNP",127,0)
 ..; If ICD-9 era get #8.7 from #660
"RTN","RMPR9LNP",128,0)
 ..I +RMPRCSI=1,($G(RMXM(660,B_",",FLEX2))'="") S $P(^TMP($J,B),U,20)=$G(RMXM(660,B_",",FLEX2)) Q
"RTN","RMPR9LNP",129,0)
 ..; If ICD-10 era get "short description" (i.e. DIAGNOSIS) from #80
"RTN","RMPR9LNP",130,0)
 ..I +RMPRCSI=30,($G(RMXM(660,B_",",FLEX2))'="")  D  Q
"RTN","RMPR9LNP",131,0)
 ...S $P(^TMP($J,B),U,20)=$$ICDSD(RMXM(660,B_",",8.8),DATE,+RMPRCSI)
"RTN","RMPR9LNP",132,0)
 ..; If Provisional Diagnosis was blank
"RTN","RMPR9LNP",133,0)
 ..S $P(^TMP($J,B),U,20)=""
"RTN","RMPR9LNP",134,0)
 .; Check if SUSPENSE ICD (#8.8) was selected
"RTN","RMPR9LNP",135,0)
 .I FLEX2=8.8 D  Q
"RTN","RMPR9LNP",136,0)
 ..I $G(RMXM(660,B_",",FLEX2))'="" D ICDCS(FLEX2,20,RMPRB_",") Q
"RTN","RMPR9LNP",137,0)
 ..S $P(^TMP($J,B),U,20)=""
"RTN","RMPR9LNP",138,0)
 .; User specified a field other than 8.7 or 8.8
"RTN","RMPR9LNP",139,0)
 .I FLEX2'="" S $P(^TMP($J,B),U,20)=$G(RMXM(660,B_",",FLEX2))
"RTN","RMPR9LNP",140,0)
 ; User didn't specify a field for 2nd choice
"RTN","RMPR9LNP",141,0)
 I FLEX2="" S $P(^TMP($J,B),U,20)=""
"RTN","RMPR9LNP",142,0)
 ;
"RTN","RMPR9LNP",143,0)
 ; Process 3rd user selected field
"RTN","RMPR9LNP",144,0)
 I FLEX3'="" D
"RTN","RMPR9LNP",145,0)
 .; Check if PROVISIONAL DIAGNOSIS (#8.7) was selected 
"RTN","RMPR9LNP",146,0)
 .I FLEX3=8.7 D  Q
"RTN","RMPR9LNP",147,0)
 ..; If ICD-9 era get #8.7 from #660
"RTN","RMPR9LNP",148,0)
 ..I +RMPRCSI=1,($G(RMXM(660,B_",",FLEX3))'="") S $P(^TMP($J,B),U,21)=$G(RMXM(660,B_",",FLEX3)) Q
"RTN","RMPR9LNP",149,0)
 ..; If ICD-10 era get "short description" (i.e. DIAGNOSIS) from #80
"RTN","RMPR9LNP",150,0)
 ..I +RMPRCSI=30,($G(RMXM(660,B_",",FLEX3))'="")  D  Q
"RTN","RMPR9LNP",151,0)
 ...S $P(^TMP($J,B),U,21)=$$ICDSD(RMXM(660,B_",",8.8),DATE,+RMPRCSI)
"RTN","RMPR9LNP",152,0)
 ..; If Provisional Diagnosis was blank
"RTN","RMPR9LNP",153,0)
 ..S $P(^TMP($J,B),U,21)=""
"RTN","RMPR9LNP",154,0)
 .; Check if SUSPENSE ICD (#8.8) was selected
"RTN","RMPR9LNP",155,0)
 .I FLEX3=8.8 D  Q
"RTN","RMPR9LNP",156,0)
 ..I $G(RMXM(660,B_",",FLEX3))'="" D ICDCS(FLEX3,21,RMPRB_",") Q
"RTN","RMPR9LNP",157,0)
 ..S $P(^TMP($J,B),U,21)=""
"RTN","RMPR9LNP",158,0)
 .; User specified a field other than 8.7 or 8.8
"RTN","RMPR9LNP",159,0)
 .I FLEX3'="" S $P(^TMP($J,B),U,21)=$G(RMXM(660,B_",",FLEX3))
"RTN","RMPR9LNP",160,0)
 ; User didn't specify a field for 2nd choice
"RTN","RMPR9LNP",161,0)
 I FLEX3="" S $P(^TMP($J,B),U,21)=""
"RTN","RMPR9LNP",162,0)
 ;
"RTN","RMPR9LNP",163,0)
 K RMXM,VADM,CAL
"RTN","RMPR9LNP",164,0)
 Q
"RTN","RMPR9LNP",165,0)
 ;
"RTN","RMPR9LNP",166,0)
 ; Return Short Description (i.e. DIAGNOSIS) from #80
"RTN","RMPR9LNP",167,0)
ICDSD(RMPRICD,DATE,RMPRCSI) ; Retrieve ICD Short Description from DIAGNOSIS field in #80
"RTN","RMPR9LNP",168,0)
 Q:RMPRICD="" ""
"RTN","RMPR9LNP",169,0)
 Q:DATE="" ""
"RTN","RMPR9LNP",170,0)
 Q:RMPRCSI="" ""
"RTN","RMPR9LNP",171,0)
 S RMPRICD=$$ICDDX^ICDEX(RMPRICD,DATE,RMPRCSI,"E") ; Supported by ICR 5747
"RTN","RMPR9LNP",172,0)
 ; If API failed, return error message
"RTN","RMPR9LNP",173,0)
 I +RMPRICD<0 D  Q RMPRICD
"RTN","RMPR9LNP",174,0)
 .S RMPRICD=$P(RMPRICD,U,2)
"RTN","RMPR9LNP",175,0)
 ; Return Short Description
"RTN","RMPR9LNP",176,0)
 S RMPRICD=$P(RMPRICD,U,4)
"RTN","RMPR9LNP",177,0)
 Q RMPRICD
"RTN","RMPR9LNP",178,0)
 ;
"RTN","RMPR9LNP",179,0)
 ; Determine code set for ICD code and update appropriate return array piece
"RTN","RMPR9LNP",180,0)
ICDCS(RMPRFNUM,RMPRANUM,RMPRIENS) ;
"RTN","RMPR9LNP",181,0)
 ; RMPRFNUM = User Specified Field Number
"RTN","RMPR9LNP",182,0)
 ; RMPRANUM = Array number to update
"RTN","RMPR9LNP",183,0)
 ; RMPRIENS = #660 IEN
"RTN","RMPR9LNP",184,0)
 N RMPRACS
"RTN","RMPR9LNP",185,0)
 S RMPRACS=""
"RTN","RMPR9LNP",186,0)
 ; Get ICD IEN from #660
"RTN","RMPR9LNP",187,0)
 S RMPRACS=$$GET1^DIQ(660,RMPRIENS,8.8,"I",,)
"RTN","RMPR9LNP",188,0)
 ; Determine Code Set for ICD code
"RTN","RMPR9LNP",189,0)
 S RMPRACS=$$CSI^ICDEX(80,RMPRACS)
"RTN","RMPR9LNP",190,0)
 ; Retrieve Info for Code Set
"RTN","RMPR9LNP",191,0)
 S RMPRACS=$$SINFO^ICDEX(RMPRACS)
"RTN","RMPR9LNP",192,0)
 ; Convert Code Set to external numerical value.  ICD-9 = 9, ICD-10 = 10 etc.
"RTN","RMPR9LNP",193,0)
 S RMPRACS=$P($P(RMPRACS,U,2),"-",2)
"RTN","RMPR9LNP",194,0)
 ; Update appropriate piece of return array
"RTN","RMPR9LNP",195,0)
 S $P(^TMP($J,B),U,RMPRANUM)=$G(RMXM(660,B_",",RMPRFNUM))_"~"_RMPRACS
"RTN","RMPR9LNP",196,0)
 Q
"RTN","RMPR9LNP",197,0)
 ;
"RTN","RMPR9LNP",198,0)
EXIT ;common exit point
"RTN","RMPR9LNP",199,0)
 Q
"RTN","RMPR9LNP",200,0)
 ;END
"RTN","RMPR9S4E")
0^9^B55214876^B42900080
"RTN","RMPR9S4E",1,0)
RMPR9S4E ;HOIFO/SPS - GUI 2319 Extended Display Transaction screen 4 ;12/17/02  09:35
"RTN","RMPR9S4E",2,0)
 ;;3.0;PROSTHETICS;**59,92,99,90,75,168**;Feb 09, 1996;Build 43
"RTN","RMPR9S4E",3,0)
 ;
"RTN","RMPR9S4E",4,0)
 ; Reference to $$SINFO^ICDEX supported by ICR #5747
"RTN","RMPR9S4E",5,0)
 ; Reference to $$ICDDX^ICDEX supported by ICR #5747
"RTN","RMPR9S4E",6,0)
 ;
"RTN","RMPR9S4E",7,0)
 ;         (IEN)=ien of file 660
"RTN","RMPR9S4E",8,0)
 ;
"RTN","RMPR9S4E",9,0)
 ;AAC Patch 92 08/04/04 - Code Set Versioning (CSV)
"RTN","RMPR9S4E",10,0)
 ;
"RTN","RMPR9S4E",11,0)
 ;display detailed record
"RTN","RMPR9S4E",12,0)
A1(IEN) G A2
"RTN","RMPR9S4E",13,0)
EN(RESULTS,IEN) ;Broker
"RTN","RMPR9S4E",14,0)
A2 ;
"RTN","RMPR9S4E",15,0)
 I +IEN'>0 S RESULTS(0)="NOTHING TO REPORT" G EXIT
"RTN","RMPR9S4E",16,0)
 I '$D(^RMPR(660,IEN)) S RESULTS(0)="NOTHING TO REPORT" G EXIT
"RTN","RMPR9S4E",17,0)
 N DIC,DIQ,DR,DA,I,RMPRDFN,RMPRDOB,RMPRLA,RMPRNAM,RMPRSSN,RMPRV,RMPRDA,RV
"RTN","RMPR9S4E",18,0)
 S DIC=660,DIQ="R19",DR=".01:96",DIQ(0)="EN"
"RTN","RMPR9S4E",19,0)
 S (RMPRDA,DA)=(IEN)
"RTN","RMPR9S4E",20,0)
 D EN^DIQ1
"RTN","RMPR9S4E",21,0)
 S DIQ="R19",DR=72,DIQ(0)="I" D EN^DIQ1
"RTN","RMPR9S4E",22,0)
 ;get vendor info
"RTN","RMPR9S4E",23,0)
 S DA=$P(^RMPR(660,RMPRDA,0),U,9)
"RTN","RMPR9S4E",24,0)
 I DA D
"RTN","RMPR9S4E",25,0)
 .S DIC=440,DIQ="RV",DR=".01:6",DIQ(0)="EN"
"RTN","RMPR9S4E",26,0)
 .S (RMPRV,DA)=$P(^RMPR(660,RMPRDA,0),U,9)
"RTN","RMPR9S4E",27,0)
 .D EN^DIQ1
"RTN","RMPR9S4E",28,0)
 ;
"RTN","RMPR9S4E",29,0)
 ;array defined for record in following format:
"RTN","RMPR9S4E",30,0)
 ;R19(filenumber,ien,field,E)=external form of data
"RTN","RMPR9S4E",31,0)
 ;RV(filenumber,ien,field,E)=external form of data
"RTN","RMPR9S4E",32,0)
 ;example:
"RTN","RMPR9S4E",33,0)
 ;R19(660,100,.01,"E")=APR 27, 1995
"RTN","RMPR9S4E",34,0)
 ;R19(660,100,.02,"E")=NAME,PATIENT
"RTN","RMPR9S4E",35,0)
 ;RV(440,131,.01,"E")=ORTHOTIC LAB
"RTN","RMPR9S4E",36,0)
 S RMPRDFN=$P(^RMPR(660,RMPRDA,0),U,2)
"RTN","RMPR9S4E",37,0)
 S RMPRNAM=$P(^DPT(RMPRDFN,0),U),RMPRSSN=$P(^(0),U,9),RMPRDOB=$P(^(0),U,3)
"RTN","RMPR9S4E",38,0)
 ;
"RTN","RMPR9S4E",39,0)
 D HDR
"RTN","RMPR9S4E",40,0)
 ; "TYPE OF FORM: ",
"RTN","RMPR9S4E",41,0)
 S RESULTS(5)=$G(R19(660,RMPRDA,11,"E"))
"RTN","RMPR9S4E",42,0)
 ; "INITIATOR: ",
"RTN","RMPR9S4E",43,0)
 S RESULTS(6)=$G(R19(660,RMPRDA,27,"E"))
"RTN","RMPR9S4E",44,0)
 ; "DATE: ",
"RTN","RMPR9S4E",45,0)
 S RESULTS(7)=$G(R19(660,RMPRDA,1,"E"))
"RTN","RMPR9S4E",46,0)
 ; "DELIVER TO: ",
"RTN","RMPR9S4E",47,0)
 S RESULTS(8)=$G(R19(660,RMPRDA,25,"E"))
"RTN","RMPR9S4E",48,0)
 ; "TYPE TRANS: ",
"RTN","RMPR9S4E",49,0)
 S RESULTS(9)=$G(R19(660,RMPRDA,2,"E"))
"RTN","RMPR9S4E",50,0)
 ; "QTY: ",
"RTN","RMPR9S4E",51,0)
 S RESULTS(10)=$G(R19(660,RMPRDA,5,"E"))
"RTN","RMPR9S4E",52,0)
 ; "INVENTORY POINT: "
"RTN","RMPR9S4E",53,0)
 S RESULTS(11)=$G(R19(660,RMPRDA,29,"E"))
"RTN","RMPR9S4E",54,0)
 ; "SOURCE: ",
"RTN","RMPR9S4E",55,0)
 S RESULTS(12)=$G(R19(660,RMPRDA,12,"E"))
"RTN","RMPR9S4E",56,0)
 ;vendor tracking number
"RTN","RMPR9S4E",57,0)
 S (RESULTS(13),RESULTS(14))=""
"RTN","RMPR9S4E",58,0)
 I $G(R19(660,RMPRDA,11,"E"))="VISA" D
"RTN","RMPR9S4E",59,0)
 .; "VENDOR TRACKING: ",
"RTN","RMPR9S4E",60,0)
 .S RESULTS(13)=$G(R19(660,RMPRDA,4.2,"E"))
"RTN","RMPR9S4E",61,0)
 .; "BANK AUTHORIZATION: ",
"RTN","RMPR9S4E",62,0)
 .S RESULTS(14)=$G(R19(660,RMPRDA,38.7,"E"))
"RTN","RMPR9S4E",63,0)
 ; "VENDOR: ",
"RTN","RMPR9S4E",64,0)
 S RESULTS(15)=$G(R19(660,RMPRDA,7,"E"))
"RTN","RMPR9S4E",65,0)
 ; VENDOR PHONE AND ADDRESS INFO
"RTN","RMPR9S4E",66,0)
 F I=16:1:20 S RESULTS(I)=""
"RTN","RMPR9S4E",67,0)
 I $D(RV) D
"RTN","RMPR9S4E",68,0)
 .; "VENDOR PHONE: and Address ",
"RTN","RMPR9S4E",69,0)
 .S RESULTS(16)=$G(RV(440,RMPRV,5,"E"))
"RTN","RMPR9S4E",70,0)
 .S RESULTS(17)=$G(RV(440,RMPRV,1,"E"))
"RTN","RMPR9S4E",71,0)
 .S RESULTS(18)=$G(RV(440,RMPRV,4.2,"E"))
"RTN","RMPR9S4E",72,0)
 .S RESULTS(19)=$G(RV(440,RMPRV,4.4,"E"))
"RTN","RMPR9S4E",73,0)
 .S RESULTS(20)=$G(RV(440,RMPRV,4.6,"E"))
"RTN","RMPR9S4E",74,0)
 ; "DELIVERY DATE: "
"RTN","RMPR9S4E",75,0)
 S RESULTS(21)=$G(R19(660,RMPRDA,10,"E"))
"RTN","RMPR9S4E",76,0)
 ; "TOTAL COST: "
"RTN","RMPR9S4E",77,0)
 S RESULTS(22)=0.00
"RTN","RMPR9S4E",78,0)
 I $G(R19(660,RMPRDA,14,"E"))'="" S RESULTS(22)="$"_$FN(R19(660,RMPRDA,14,"E"),"T",2)
"RTN","RMPR9S4E",79,0)
 I $G(R19(660,RMPRDA,14,"E"))="" S RESULTS(22)=$S($G(R19(660,RMPRDA,6,"E"))'="":"$"_$FN(R19(660,RMPRDA,6,"E"),"T",2),$G(R19(660,RMPRDA,48,"E"))'="":"$"_$FN(R19(660,RMPRDA,48,"E"),"T",2),1:"")
"RTN","RMPR9S4E",80,0)
 ; "OBL: ",
"RTN","RMPR9S4E",81,0)
 S RESULTS(23)=$G(R19(660,RMPRDA,23,"E"))
"RTN","RMPR9S4E",82,0)
 ;
"RTN","RMPR9S4E",83,0)
 ;lab data
"RTN","RMPR9S4E",84,0)
 F I=24:1:32 S RESULTS(I)=""
"RTN","RMPR9S4E",85,0)
 I $D(^RMPR(660,RMPRDA,"LB")) D
"RTN","RMPR9S4E",86,0)
 .N DIC,DIQ,DR,L19,DA
"RTN","RMPR9S4E",87,0)
 .S (DA,RMPRLA)=$P(^RMPR(660,RMPRDA,"LB"),U,10)
"RTN","RMPR9S4E",88,0)
 .Q:DA=""
"RTN","RMPR9S4E",89,0)
 .S DIC=664.1,DIQ="L19",DR="15",DIQ(0)="E"
"RTN","RMPR9S4E",90,0)
 .D EN^DIQ1
"RTN","RMPR9S4E",91,0)
 .; "WORK ORDER: ",
"RTN","RMPR9S4E",92,0)
 .S RESULTS(24)=$G(R19(660,RMPRDA,71,"E"))
"RTN","RMPR9S4E",93,0)
 .I $P(^RMPR(660,RMPRDA,"AM"),U,2)=1 S RESULTS(24)=$G(R19(660,RMPRDA,72.5,"E"))
"RTN","RMPR9S4E",94,0)
 .I $P(^RMPR(660,RMPRDA,"LB"),U,14)=1 S RESULTS(24)=$G(R19(660,RMPRDA,72.5,"E"))
"RTN","RMPR9S4E",95,0)
 .; "RECEIVING STATION: ",
"RTN","RMPR9S4E",96,0)
 .S RESULTS(25)=$G(R19(660,RMPRDA,70,"E"))
"RTN","RMPR9S4E",97,0)
 .; "TECHNICIAN: ",
"RTN","RMPR9S4E",98,0)
 .S RESULTS(26)=$G(L19(664.1,RMPRLA,15,"E"))
"RTN","RMPR9S4E",99,0)
 .; "TOTAL LABOR HOURS: ",
"RTN","RMPR9S4E",100,0)
 .S RESULTS(27)=$G(R19(660,RMPRDA,45,"E"))
"RTN","RMPR9S4E",101,0)
 .; "TOTAL LABOR COST: ",
"RTN","RMPR9S4E",102,0)
 .S RESULTS(28)=$G(R19(660,RMPRDA,46,"E"))
"RTN","RMPR9S4E",103,0)
 .; "TOTAL MATERIAL COST: ",
"RTN","RMPR9S4E",104,0)
 .S RESULTS(29)=$G(R19(660,RMPRDA,47,"E"))
"RTN","RMPR9S4E",105,0)
 .; "TOTAL LAB COST: ",
"RTN","RMPR9S4E",106,0)
 .S RESULTS(30)=$G(R19(660,RMPRDA,48,"E"))
"RTN","RMPR9S4E",107,0)
 .; "COMPLETION DATE: ",
"RTN","RMPR9S4E",108,0)
 .S RESULTS(31)=$G(R19(660,RMPRDA,50,"E"))
"RTN","RMPR9S4E",109,0)
 .; "LAB REMARKS: ",
"RTN","RMPR9S4E",110,0)
 .S RESULTS(32)=$G(R19(660,RMPRDA,51,"E"))
"RTN","RMPR9S4E",111,0)
 ; "REMARKS: ",
"RTN","RMPR9S4E",112,0)
 S RESULTS(33)=$G(R19(660,RMPRDA,16,"E"))
"RTN","RMPR9S4E",113,0)
 ; "RETURN STATUS: ",
"RTN","RMPR9S4E",114,0)
 S RESULTS(34)=$G(R19(660,RMPRDA,17.5,"E"))
"RTN","RMPR9S4E",115,0)
 ;
"RTN","RMPR9S4E",116,0)
 ; CoreFLS Data used to be/and same as historical data
"RTN","RMPR9S4E",117,0)
 F I=35:1:42 S RESULTS(I)=""
"RTN","RMPR9S4E",118,0)
 I $G(R19(660,RMPRDA,15,"E"))["*" D
"RTN","RMPR9S4E",119,0)
 .;include records that have been merged
"RTN","RMPR9S4E",120,0)
 .; "COREFLS/HISTORICAL DATA",!
"RTN","RMPR9S4E",121,0)
 .Q:'$D(R19(660,RMPRDA,89))
"RTN","RMPR9S4E",122,0)
 .; "ITEM: ",
"RTN","RMPR9S4E",123,0)
 .S RESULTS(35)=$G(R19(660,RMPRDA,89,"E"))
"RTN","RMPR9S4E",124,0)
 .; "STATION: ",
"RTN","RMPR9S4E",125,0)
 .S RESULTS(36)=$G(R19(660,RMPRDA,90,"E"))
"RTN","RMPR9S4E",126,0)
 .; "VENDOR: ",
"RTN","RMPR9S4E",127,0)
 .S RESULTS(37)=$G(R19(660,RMPRDA,91,"E"))
"RTN","RMPR9S4E",128,0)
 .; "   PHONE: ",
"RTN","RMPR9S4E",129,0)
 .S RESULTS(38)=$G(R19(660,RMPRDA,92,"E"))
"RTN","RMPR9S4E",130,0)
 .; " STREET
"RTN","RMPR9S4E",131,0)
 .S RESULTS(39)=$G(R19(660,RMPRDA,93,"E"))
"RTN","RMPR9S4E",132,0)
 .; CITY
"RTN","RMPR9S4E",133,0)
 .S RESULTS(40)=$G(R19(660,RMPRDA,94,"E"))
"RTN","RMPR9S4E",134,0)
 .; STATE
"RTN","RMPR9S4E",135,0)
 .S RESULTS(41)=$G(R19(660,RMPRDA,95,"E"))
"RTN","RMPR9S4E",136,0)
 .; ZIP
"RTN","RMPR9S4E",137,0)
 .S RESULTS(42)=$G(R19(660,RMPRDA,96,"E"))
"RTN","RMPR9S4E",138,0)
 ;put in lab display here fields 45,46,47,48 and 51
"RTN","RMPR9S4E",139,0)
 ;lab amis
"RTN","RMPR9S4E",140,0)
 F I=43:1:44 S RESULTS(I)=""
"RTN","RMPR9S4E",141,0)
 I $G(R19(660,RMPRDA,73,"E")) D
"RTN","RMPR9S4E",142,0)
 .; "ORTHOTICS LAB CODE: "
"RTN","RMPR9S4E",143,0)
 .S RESULTS(43)=$S($D(R19(660,RMPRDA,74,"E")):R19(660,RMPRDA,74,"E"),$D(R19(660,RMPRDA,75,"E")):R19(660,RMPRDA,75,"E"),1:"")
"RTN","RMPR9S4E",144,0)
 .; "RESTORATIONS LAB CODE: "
"RTN","RMPR9S4E",145,0)
 .S RESULTS(44)=$S($D(R19(660,RMPRDA,76,"E")):R19(660,RMPRDA,76,"E"),$D(R19(660,RMPRDA,77,"E")):R19(660,RMPRDA,77,"E"),1:"")
"RTN","RMPR9S4E",146,0)
 ;purchasing and issue from stock amis
"RTN","RMPR9S4E",147,0)
 ; "DISABILITY SERVED: ",
"RTN","RMPR9S4E",148,0)
 S RESULTS(45)=$G(R19(660,RMPRDA,62,"E"))
"RTN","RMPR9S4E",149,0)
 ;appliance/item information
"RTN","RMPR9S4E",150,0)
 ; "APPLIANCE: ",
"RTN","RMPR9S4E",151,0)
 ;S RESULTS(46)=$G(R19(660,RMPRDA,4,"E"))
"RTN","RMPR9S4E",152,0)
 S RESULTS(46)=$G(R19(660,RMPRDA,89,"E"))
"RTN","RMPR9S4E",153,0)
 ; "PSAS HCPCS: ",
"RTN","RMPR9S4E",154,0)
 S RESULTS(47)=$G(R19(660,RMPRDA,4.5,"E"))
"RTN","RMPR9S4E",155,0)
 ; "PSAS HCPCS DESC.
"RTN","RMPR9S4E",156,0)
 S RESULTS(48)=""
"RTN","RMPR9S4E",157,0)
 I $P($G(^RMPR(660,RMPRDA,1)),U,4) S RESULTS(48)=$P($G(^RMPR(661.1,$P(^RMPR(660,RMPRDA,1),U,4),0)),U,2)
"RTN","RMPR9S4E",158,0)
 ;
"RTN","RMPR9S4E",159,0)
 ; Updates for ICD10 project
"RTN","RMPR9S4E",160,0)
 N RMPRACS,RMPRCSI,RMPRDATE,RMPRICD,RMPRLLEN,RMPRSICD,RMPRTXT
"RTN","RMPR9S4E",161,0)
 S (RMPRACS,RMPRCSI,RMPRDATE,RMPRICD,RMPRLLEN,RMPRSICD,RMPRTXT,RESULTS(49))="",RMPRERR=0
"RTN","RMPR9S4E",162,0)
 S RMPRDATE=$P(^RMPR(660,RMPRDA,0),U,1)
"RTN","RMPR9S4E",163,0)
 I $D(^RMPR(660,RMPRDA,10)) S RMPRSICD=$P(^RMPR(660,RMPRDA,10),U,8) ; SUSPENSE ICD (#8.8)
"RTN","RMPR9S4E",164,0)
 ; Retrieve and process the Suspense ICD
"RTN","RMPR9S4E",165,0)
 I RMPRSICD'=""  D
"RTN","RMPR9S4E",166,0)
 .S RMPRCSI=$$SINFO^ICDEX("DIAG",RMPRDATE) ; Supported by ICR 5747
"RTN","RMPR9S4E",167,0)
 .S RMPRACS=$P(RMPRCSI,U,1) ; Internal format Active Coding System based on Date of Interest
"RTN","RMPR9S4E",168,0)
 .; Retrieve ICD Code Data
"RTN","RMPR9S4E",169,0)
 .S RMPRICD=$$ICDDX^ICDEX(RMPRSICD,RMPRDATE,RMPRACS,"I") ; Supported by ICR 5747
"RTN","RMPR9S4E",170,0)
 .S RMPRERR=$P(RMPRICD,U,1)
"RTN","RMPR9S4E",171,0)
 .I RMPRERR<0 S RESULTS(49)=$P(RMPRICD,U,2)
"RTN","RMPR9S4E",172,0)
 .S RMPRACS=$P(RMPRCSI,U,2) ; External format Active Coding System based on Date of Interest
"RTN","RMPR9S4E",173,0)
 .S RMPRACS=$S(RMPRACS="ICD-9-CM":9,RMPRACS="ICD-10-CM":10,1:"") ; adjust for 2nd return piece
"RTN","RMPR9S4E",174,0)
ZZ ;
"RTN","RMPR9S4E",175,0)
 I RMPRERR>0 D
"RTN","RMPR9S4E",176,0)
 .S RESULTS(49)=$P(RMPRICD,U,2)_" "
"RTN","RMPR9S4E",177,0)
 .; Return brief description 
"RTN","RMPR9S4E",178,0)
 .S RESULTS(49)=RESULTS(49)_$S(RMPRACS=9:$E($P(RMPRICD,U,4),1,55),1:$P(RMPRICD,U,4))
"RTN","RMPR9S4E",179,0)
 .; Check for Inactive Status
"RTN","RMPR9S4E",180,0)
 .I $P(RMPRICD,U,10)'>0 D
"RTN","RMPR9S4E",181,0)
 ..S RMPRTXT=" ** Inactive ** Date: "
"RTN","RMPR9S4E",182,0)
 ..S Y=$P(RMPRICD,U,12) ; Inactive Date
"RTN","RMPR9S4E",183,0)
 ..D DD^%DT
"RTN","RMPR9S4E",184,0)
 ..S RMPRTXT=RMPRTXT_Y ; External format date
"RTN","RMPR9S4E",185,0)
 ..S RESULTS(49)=RESULTS(49)_RMPRTXT Q
"RTN","RMPR9S4E",186,0)
 .; Add Coding System for ICD as 2nd ^ delimited piece
"RTN","RMPR9S4E",187,0)
 .S RESULTS(49)=RESULTS(49)_"^"_RMPRACS
"RTN","RMPR9S4E",188,0)
 ;
"RTN","RMPR9S4E",189,0)
 ; End Patch 92
"RTN","RMPR9S4E",190,0)
 ; End of ICD10 Updates
"RTN","RMPR9S4E",191,0)
 ;
"RTN","RMPR9S4E",192,0)
 ; "CPT MODIFIER: ",
"RTN","RMPR9S4E",193,0)
 S RESULTS(50)=$G(R19(660,RMPRDA,38.1,"E"))
"RTN","RMPR9S4E",194,0)
 ; "DESCRIPTION: ",
"RTN","RMPR9S4E",195,0)
 S RESULTS(51)=$G(R19(660,RMPRDA,24,"E"))
"RTN","RMPR9S4E",196,0)
 ; ,"EXTENDED DESCRIPTION: ",!
"RTN","RMPR9S4E",197,0)
 N R28
"RTN","RMPR9S4E",198,0)
 I $D(R19(660,RMPRDA,28)) D
"RTN","RMPR9S4E",199,0)
 .;command part of new standards
"RTN","RMPR9S4E",200,0)
 .MERGE R28=R19(660,RMPRDA,28)
"RTN","RMPR9S4E",201,0)
 N CNT,LN
"RTN","RMPR9S4E",202,0)
 S LN=0,CNT=52
"RTN","RMPR9S4E",203,0)
 F  S LN=$O(R28(LN)) Q:LN'>0  D
"RTN","RMPR9S4E",204,0)
 .S RESULTS(CNT)=R28(LN)
"RTN","RMPR9S4E",205,0)
 .S CNT=CNT+1
"RTN","RMPR9S4E",206,0)
 G EXIT
"RTN","RMPR9S4E",207,0)
 ;
"RTN","RMPR9S4E",208,0)
HDR ;display heading
"RTN","RMPR9S4E",209,0)
 S RESULTS(1)=RMPRNAM
"RTN","RMPR9S4E",210,0)
 ; " SSN: "
"RTN","RMPR9S4E",211,0)
 S RESULTS(2)=$E(RMPRSSN,1,3)_"-"_$E(RMPRSSN,4,5)_"-"_$E(RMPRSSN,6,10)
"RTN","RMPR9S4E",212,0)
 S RESULTS(3)=$G(R19(660,RMPRDA,8,"E"))
"RTN","RMPR9S4E",213,0)
 ; "DOB: "
"RTN","RMPR9S4E",214,0)
 S RESULTS(4)=$S(RMPRDOB:$E(RMPRDOB,4,5)_"-"_$E(RMPRDOB,6,7)_"-"_(1700+$E(RMPRDOB,1,3)),1:"Unknown")
"RTN","RMPR9S4E",215,0)
 Q
"RTN","RMPR9S4E",216,0)
EXIT ;common exit point
"RTN","RMPR9S4E",217,0)
 I '$D(RESULTS) S RESULTS(0)="NOTHING TO REPORT"
"RTN","RMPR9S4E",218,0)
 K R19,RV,RMPRICC,RMPRERR,Y
"RTN","RMPR9S4E",219,0)
 Q
"RTN","RMPR9S4E",220,0)
 ;end
"RTN","RMPRPAT3")
0^2^B58098580^B41816871
"RTN","RMPRPAT3",1,0)
RMPRPAT3 ;HINES-CIOFO/HNC,RVD - Detail Display Patient 10-2319 Transaction ;11/03/04
"RTN","RMPRPAT3",2,0)
 ;;3.0;PROSTHETICS;**3,12,25,28,32,41,69,92,99,90,162,163,168**;Feb 09, 1996;Build 43
"RTN","RMPRPAT3",3,0)
 ;
"RTN","RMPRPAT3",4,0)
 ; Reference to $$SINFO^ICDEX supported by ICR #5747
"RTN","RMPRPAT3",5,0)
 ; Reference to $$ICDDX^ICDEX supported by ICR #5747
"RTN","RMPRPAT3",6,0)
 ; Reference to $$VLT^ICDEX   supported by ICR #5747
"RTN","RMPRPAT3",7,0)
 ; 
"RTN","RMPRPAT3",8,0)
 ; RVD 4/30/02 patch #69 - add ICD-9 CODE and description in the display.
"RTN","RMPRPAT3",9,0)
 ;                         add HCPCS and Short Description.
"RTN","RMPRPAT3",10,0)
 ; AAC 08/03/04 Patch 92 - Code Set Versioning (CSV)
"RTN","RMPRPAT3",11,0)
 ; RGB 09/14/10 Patch 163 - Add Suspense Date to appliance line item detail
"RTN","RMPRPAT3",12,0)
 ;
"RTN","RMPRPAT3",13,0)
 ;expect ANS,IT(ANS)
"RTN","RMPRPAT3",14,0)
 ;          +IT(ANS)=ien of file 660
"RTN","RMPRPAT3",15,0)
 ;expect variables from GETPAT^RMPRUTIL
"RTN","RMPRPAT3",16,0)
 ;    RMPRSSNE (external form of SSN)
"RTN","RMPRPAT3",17,0)
 ;    RMPRNAM (name of patient)
"RTN","RMPRPAT3",18,0)
 ;    RMPRDOB
"RTN","RMPRPAT3",19,0)
 ;display detailed record
"RTN","RMPRPAT3",20,0)
PRINT ;called from RMPRPAT2
"RTN","RMPRPAT3",21,0)
 ;get 2319 transaction
"RTN","RMPRPAT3",22,0)
 ;
"RTN","RMPRPAT3",23,0)
 N DIC,DIQ,DR,DA,RMPRV,RMPRDA,RV,DESCRPT
"RTN","RMPRPAT3",24,0)
 S DIC=660,DIQ="R19",DR=".01:96",DIQ(0)="EN"
"RTN","RMPRPAT3",25,0)
 S (RMPRDA,DA)=+IT(ANS)
"RTN","RMPRPAT3",26,0)
 D EN^DIQ1
"RTN","RMPRPAT3",27,0)
 S DIQ="R19",DR=72,DIQ(0)="I" D EN^DIQ1
"RTN","RMPRPAT3",28,0)
 ;get vendor info
"RTN","RMPRPAT3",29,0)
 S DA=$P(^RMPR(660,RMPRDA,0),U,9)
"RTN","RMPRPAT3",30,0)
 I DA D
"RTN","RMPRPAT3",31,0)
 .S DIC=440,DIQ="RV",DR=".01:6",DIQ(0)="EN"
"RTN","RMPRPAT3",32,0)
 .S (RMPRV,DA)=$P(^RMPR(660,RMPRDA,0),U,9)
"RTN","RMPRPAT3",33,0)
 .D EN^DIQ1
"RTN","RMPRPAT3",34,0)
 ;
"RTN","RMPRPAT3",35,0)
 ;array defined for record in following format:
"RTN","RMPRPAT3",36,0)
 ;R19(filenumber,ien,field,E)=external form of data
"RTN","RMPRPAT3",37,0)
 ;RV(filenumber,ien,field,E)=external form of data
"RTN","RMPRPAT3",38,0)
 ;example:
"RTN","RMPRPAT3",39,0)
 ;R19(660,100,.01,"E")=APR 27, 1995
"RTN","RMPRPAT3",40,0)
 ;R19(660,100,.02,"E")=FUDGE,CHOCOLATE
"RTN","RMPRPAT3",41,0)
 ;RV(440,131,.01,"E")=ORTHOTIC LAB
"RTN","RMPRPAT3",42,0)
 ;
"RTN","RMPRPAT3",43,0)
 D HDR
"RTN","RMPRPAT3",44,0)
 W !,"TYPE OF FORM: ",$G(R19(660,RMPRDA,11,"E"))
"RTN","RMPRPAT3",45,0)
 W ?25,"INITIATOR: ",$G(R19(660,RMPRDA,27,"E"))
"RTN","RMPRPAT3",46,0)
 W ?55,"DATE: ",$G(R19(660,RMPRDA,1,"E"))
"RTN","RMPRPAT3",47,0)
 ;historical/original item
"RTN","RMPRPAT3",48,0)
 ;W !,"ITEM DESCRIPTION: ",$G(R19(660,RMPRDA,89,"E"))
"RTN","RMPRPAT3",49,0)
 W !,"DELIVER TO: ",$G(R19(660,RMPRDA,25,"E"))
"RTN","RMPRPAT3",50,0)
 W !,"TYPE TRANS: ",$G(R19(660,RMPRDA,2,"E"))
"RTN","RMPRPAT3",51,0)
 W ?30,"QTY: ",$G(R19(660,RMPRDA,5,"E"))
"RTN","RMPRPAT3",52,0)
 W:$G(R19(660,RMPRDA,29,"E")) ?40,"INVENTORY POINT: ",R19(660,RMPRDA,29,"E"),!
"RTN","RMPRPAT3",53,0)
 W ?40,"SOURCE: ",$G(R19(660,RMPRDA,12,"E"))
"RTN","RMPRPAT3",54,0)
 ;vendor tracking number
"RTN","RMPRPAT3",55,0)
 I $G(R19(660,RMPRDA,11,"E"))="VISA" D
"RTN","RMPRPAT3",56,0)
 .W !,"VENDOR TRACKING: ",$G(R19(660,RMPRDA,4.2,"E"))
"RTN","RMPRPAT3",57,0)
 .W ?38,"BANK AUTHORIZATION: ",$G(R19(660,RMPRDA,4.3,"E"))
"RTN","RMPRPAT3",58,0)
 W !,"VENDOR: ",?15,$G(R19(660,RMPRDA,7,"E"))
"RTN","RMPRPAT3",59,0)
 I $D(RV) D
"RTN","RMPRPAT3",60,0)
 .W !,"VENDOR PHONE: ",?15,$G(RV(440,RMPRV,5,"E"))
"RTN","RMPRPAT3",61,0)
 .W !?15,$G(RV(440,RMPRV,1,"E"))
"RTN","RMPRPAT3",62,0)
 .W !?15,$G(RV(440,RMPRV,4.2,"E")),","
"RTN","RMPRPAT3",63,0)
 .W ?$X+3,$G(RV(440,RMPRV,4.4,"E")),?$X+5,$G(RV(440,RMPRV,4.6,"E"))
"RTN","RMPRPAT3",64,0)
 W !,"DELIVERY DATE: "
"RTN","RMPRPAT3",65,0)
 I $D(R19(660,RMPRDA,10,"E")) W R19(660,RMPRDA,10,"E")
"RTN","RMPRPAT3",66,0)
 W ?40,"SUSPENSE DATE: " I $D(R19(660,RMPRDA,8.1,"E")) W R19(660,RMPRDA,8.1,"E")   ;Patch RMPR*3*163
"RTN","RMPRPAT3",67,0)
 W !
"RTN","RMPRPAT3",68,0)
 I '$P(IT(AN),U,3) D
"RTN","RMPRPAT3",69,0)
 .W "TOTAL COST: "
"RTN","RMPRPAT3",70,0)
 .I $G(R19(660,RMPRDA,14,"E"))'="" W "$"_$J(R19(660,RMPRDA,14,"E"),2)
"RTN","RMPRPAT3",71,0)
 .I $G(R19(660,RMPRDA,14,"E"))="" W $S($G(R19(660,RMPRDA,6,"E"))'="":"$"_$J(R19(660,RMPRDA,6,"E"),2),$G(R19(660,RMPRDA,48,"E"))'="":"$"_$J(R19(660,RMPRDA,48,"E"),2),1:"")
"RTN","RMPRPAT3",72,0)
 W ?30,"OBL: ",$G(R19(660,RMPRDA,23,"E"))
"RTN","RMPRPAT3",73,0)
 ;
"RTN","RMPRPAT3",74,0)
 ;lab data
"RTN","RMPRPAT3",75,0)
 I $D(^RMPR(660,RMPRDA,"LB")) D
"RTN","RMPRPAT3",76,0)
 .N DIC,DIQ,DR,L19,DA
"RTN","RMPRPAT3",77,0)
 .S (DA,RMPRLA)=$P(^RMPR(660,RMPRDA,"LB"),U,10)
"RTN","RMPRPAT3",78,0)
 .Q:DA=""
"RTN","RMPRPAT3",79,0)
 .S DIC=664.1,DIQ="L19",DR="15",DIQ(0)="E"
"RTN","RMPRPAT3",80,0)
 .D EN^DIQ1
"RTN","RMPRPAT3",81,0)
 .W !,"WORK ORDER: ",$G(R19(660,RMPRDA,71,"E"))
"RTN","RMPRPAT3",82,0)
 .W ?40,"RECEIVING STATION: ",$G(R19(660,RMPRDA,70,"E"))
"RTN","RMPRPAT3",83,0)
 .W !,"TECHNICIAN: ",$G(L19(664.1,RMPRLA,15,"E"))
"RTN","RMPRPAT3",84,0)
 .W !,"TOTAL LABOR HOURS: ",$G(R19(660,RMPRDA,45,"E"))
"RTN","RMPRPAT3",85,0)
 .W ?40,"TOTAL LABOR COST: ",$G(R19(660,RMPRDA,46,"E"))
"RTN","RMPRPAT3",86,0)
 .W !,"TOTAL MATERIAL COST: ",$G(R19(660,RMPRDA,47,"E"))
"RTN","RMPRPAT3",87,0)
 .W ?40,"TOTAL LAB COST: ",$G(R19(660,RMPRDA,48,"E"))
"RTN","RMPRPAT3",88,0)
 .W !,"COMPLETION DATE: ",$G(R19(660,RMPRDA,50,"E"))
"RTN","RMPRPAT3",89,0)
 .W ?40,"LAB REMARKS: ",$G(R19(660,RMPRDA,51,"E"))
"RTN","RMPRPAT3",90,0)
 W !,"REMARKS: ",?15,$G(R19(660,RMPRDA,16,"E"))
"RTN","RMPRPAT3",91,0)
 I $G(R19(660,RMPRDA,17.5,"E")) W ?40,"RETURN STATUS: ",R19(660,RMPRDA,17.5,"E")
"RTN","RMPRPAT3",92,0)
 ;
"RTN","RMPRPAT3",93,0)
 ;historical data
"RTN","RMPRPAT3",94,0)
 I $G(R19(660,RMPRDA,15,"E"))["*" D
"RTN","RMPRPAT3",95,0)
 .;include records that have been merged
"RTN","RMPRPAT3",96,0)
 .W !!,"HISTORICAL DATA",!
"RTN","RMPRPAT3",97,0)
 .Q:'$D(R19(660,RMPRDA,89))
"RTN","RMPRPAT3",98,0)
 .W !,?15,"ITEM: ",$G(R19(660,RMPRDA,89,"E"))
"RTN","RMPRPAT3",99,0)
 .W !,?15,"STATION: ",$G(R19(660,RMPRDA,90,"E"))
"RTN","RMPRPAT3",100,0)
 .W !,?15,"VENDOR: ",$G(R19(660,RMPRDA,91,"E")),"   PHONE: ",$G(R19(660,RMPRDA,92,"E"))
"RTN","RMPRPAT3",101,0)
 .W !,?23,$G(R19(660,RMPRDA,93,"E")),!,?23,$G(R19(660,RMPRDA,94,"E"))
"RTN","RMPRPAT3",102,0)
 .W "   ",$G(R19(660,RMPRDA,95,"E")),"  ",$G(R19(660,RMPRDA,96,"E"))
"RTN","RMPRPAT3",103,0)
 ;put in lab display here fields 45,46,47,48 and 51
"RTN","RMPRPAT3",104,0)
 ;lab amis
"RTN","RMPRPAT3",105,0)
 I $G(R19(660,RMPRDA,73,"E")) D
"RTN","RMPRPAT3",106,0)
 .W ?40,"ORTHOTICS LAB CODE: "
"RTN","RMPRPAT3",107,0)
 .W $S($D(R19(660,RMPRDA,74,"E")):R19(660,RMPRDA,74,"E"),$D(R19(660,RMPRDA,75,"E")):R19(660,RMPRDA,75,"E"),1:"")
"RTN","RMPRPAT3",108,0)
 .W !?40,"RESTORATIONS LAB CODE: "
"RTN","RMPRPAT3",109,0)
 .W $S($D(R19(660,RMPRDA,76,"E")):R19(660,RMPRDA,76,"E"),$D(R19(660,RMPRDA,77,"E")):R19(660,RMPRDA,77,"E"),1:"")
"RTN","RMPRPAT3",110,0)
 ;purchasing and issue from stock amis
"RTN","RMPRPAT3",111,0)
 W !,"DISABILITY SERVED: ",$G(R19(660,RMPRDA,62,"E"))
"RTN","RMPRPAT3",112,0)
 ;appliance/item information
"RTN","RMPRPAT3",113,0)
 ;historical/original item
"RTN","RMPRPAT3",114,0)
 W !,"ITEM DESCRIPTION: ",$G(R19(660,RMPRDA,89,"E"))
"RTN","RMPRPAT3",115,0)
 ;check for item description changes
"RTN","RMPRPAT3",116,0)
 I $G(R19(660,RMPRDA,89,"E"))'=$G(R19(660,RMPRDA,4,"E")) W !,"*** See Above For Original Item Description ***"
"RTN","RMPRPAT3",117,0)
 W !,"APPLIANCE: ",$G(R19(660,RMPRDA,4,"E"))
"RTN","RMPRPAT3",118,0)
 W !,"CONTRACT #: ",$G(R19(660,RMPRDA,38.7,"E"))
"RTN","RMPRPAT3",119,0)
 W !,"EXCLUDED/WAIVER: ",$G(R19(660,RMPRDA,38.1,"E"))
"RTN","RMPRPAT3",120,0)
 W !,"PSAS HCPCS: ",$G(R19(660,RMPRDA,4.5,"E"))
"RTN","RMPRPAT3",121,0)
 I $P($G(^RMPR(660,RMPRDA,1)),U,4) W ?22,$P($G(^RMPR(661.1,$P(^RMPR(660,RMPRDA,1),U,4),0)),U,2)
"RTN","RMPRPAT3",122,0)
 ; added by #69
"RTN","RMPRPAT3",123,0)
 ;
"RTN","RMPRPAT3",124,0)
 ; PATCH 92 - Code Set Versioning (CSV) changes below
"RTN","RMPRPAT3",125,0)
 ; AAC      - 08/03/04
"RTN","RMPRPAT3",126,0)
 ; Changes for ICD-10 Class I Remediation Project
"RTN","RMPRPAT3",127,0)
 ;
"RTN","RMPRPAT3",128,0)
 N RMPRACS,RMPRACSI,RMPRCNT,RMPRDAT,RMPRDATA,RMPRERR,RMPRICD,RMPRSICD
"RTN","RMPRPAT3",129,0)
 N RMPRPROD,RMPRTOR,RMPRTXT1
"RTN","RMPRPAT3",130,0)
 S (RMPRACS,RMPRACSI,RMPRDAT,RMPRDATA,RMPRICD,RMPRSICD)=""
"RTN","RMPRPAT3",131,0)
 S (RMPRPROD,RMPRTOR,RMPRTXT1)=""
"RTN","RMPRPAT3",132,0)
 S RMPRERR=0
"RTN","RMPRPAT3",133,0)
 S RMPRDAT=$P($G(^RMPR(660,RMPRDA,0)),U,1)
"RTN","RMPRPAT3",134,0)
 ; Determine Active Coding System based on Date of Interest
"RTN","RMPRPAT3",135,0)
 S RMPRACS=$$SINFO^ICDEX("DIAG",RMPRDAT) ; Supported by ICR 5747
"RTN","RMPRPAT3",136,0)
 S RMPRACSI=$P(RMPRACS,U,1)
"RTN","RMPRPAT3",137,0)
 S RMPRACS=$P(RMPRACS,U,2)
"RTN","RMPRPAT3",138,0)
 S RMPRACS=$S(RMPRACS="ICD-9-CM":"ICD-9 ",RMPRACS="ICD-10-CM":"ICD-10 ",1:"ICD: ")
"RTN","RMPRPAT3",139,0)
 ;
"RTN","RMPRPAT3",140,0)
 ; Load Suspense data
"RTN","RMPRPAT3",141,0)
 S RMPRDATA=$G(^RMPR(660,RMPRDA,10))
"RTN","RMPRPAT3",142,0)
 I RMPRDATA'="" D
"RTN","RMPRPAT3",143,0)
 .S RMPRTOR=$P(RMPRDATA,U,5) ; TYPE OF REQUEST #8.5
"RTN","RMPRPAT3",144,0)
 .S RMPRPROD=$P(RMPRDATA,U,7) ; PROVISIONAL DIAGNOSIS #8.7
"RTN","RMPRPAT3",145,0)
 .S RMPRSICD=$P(RMPRDATA,U,8) ; SUSPENSE ICD #8.8
"RTN","RMPRPAT3",146,0)
 ;
"RTN","RMPRPAT3",147,0)
 ; If SUSPENSE ICD existed, retrieve data
"RTN","RMPRPAT3",148,0)
 I RMPRSICD'="" D
"RTN","RMPRPAT3",149,0)
 .; Use new API to return ICD Data
"RTN","RMPRPAT3",150,0)
 .S RMPRICD=$$ICDDX^ICDEX(RMPRSICD,RMPRDAT,RMPRACSI,"I") ; Supported by ICR 5747
"RTN","RMPRPAT3",151,0)
 .S RMPRERR=$P(RMPRICD,U,1)
"RTN","RMPRPAT3",152,0)
 .; Update error message to display either ICD-9 or ICD-10 based on Date Of Interest
"RTN","RMPRPAT3",153,0)
 .I RMPRERR<0 W !,RMPRACS_"Message: "_$P(RMPRICD,U,2) Q
"RTN","RMPRPAT3",154,0)
 .; Retrieve full ICD Description
"RTN","RMPRPAT3",155,0)
 .S RMPRTXT(2)=$$VLT^ICDEX(80,+RMPRICD,RMPRDAT) ; Supported by ICR 5747
"RTN","RMPRPAT3",156,0)
 ;
"RTN","RMPRPAT3",157,0)
 ; Check for Manual Suspense and adjust line label if needed
"RTN","RMPRPAT3",158,0)
 S RMPRTXT(1)=$S(RMPRTOR="MANUAL"&(RMPRSICD=""):"MANUAL SUSPENSE: ",1:RMPRACS_"CODE: ")
"RTN","RMPRPAT3",159,0)
 ;
"RTN","RMPRPAT3",160,0)
 I +$G(RMPRSICD) D
"RTN","RMPRPAT3",161,0)
 .S RMPRTXT(1)=RMPRTXT(1)_$P(RMPRICD,U,2)_"  "
"RTN","RMPRPAT3",162,0)
 .;
"RTN","RMPRPAT3",163,0)
 .; Process SUSPENSE ICD
"RTN","RMPRPAT3",164,0)
 .I $P(RMPRICD,U,10)'>0 D
"RTN","RMPRPAT3",165,0)
 ..S Y=$P(RMPRICD,U,12) ; Inactive Date
"RTN","RMPRPAT3",166,0)
 ..D DD^%DT
"RTN","RMPRPAT3",167,0)
 ..S RMPRTXT(3)="  ** Inactive ** Date: "_Y
"RTN","RMPRPAT3",168,0)
 .;
"RTN","RMPRPAT3",169,0)
 .; Parse ICD data into 80 char array
"RTN","RMPRPAT3",170,0)
 .D PARSE^RMPOPED(.RMPRTXT)
"RTN","RMPRPAT3",171,0)
 ;
"RTN","RMPRPAT3",172,0)
 ; Loop to display ICD and Suspense info
"RTN","RMPRPAT3",173,0)
 F RMPRCNT=1:1 Q:'$D(RMPRTXT(RMPRCNT))  W !,RMPRTXT(RMPRCNT)
"RTN","RMPRPAT3",174,0)
 K RMPRTXT
"RTN","RMPRPAT3",175,0)
 ;
"RTN","RMPRPAT3",176,0)
 ; End of Patch 92 & ICD-10 mods
"RTN","RMPRPAT3",177,0)
 ; 
"RTN","RMPRPAT3",178,0)
 W !,"CPT MODIFIER: ",$G(R19(660,RMPRDA,4.7,"E"))
"RTN","RMPRPAT3",179,0)
 ;set description and modify for SHIPPING CHARGE; patch RMPR*3.0*162
"RTN","RMPRPAT3",180,0)
 S DESCRPT=$G(R19(660,RMPRDA,24,"E")) S:$P(^RMPR(660,RMPRDA,0),U,17) DESCRPT="SHIPPING CHARGE"
"RTN","RMPRPAT3",181,0)
 W !,"DESCRIPTION: ",DESCRPT
"RTN","RMPRPAT3",182,0)
 W !,"EXTENDED DESCRIPTION: ",!
"RTN","RMPRPAT3",183,0)
 I $D(R19(660,RMPRDA,28)) D  G:$D(DUOUT)!$D(DTOUT) EX1
"RTN","RMPRPAT3",184,0)
 .N R28
"RTN","RMPRPAT3",185,0)
 .;command part of new standards
"RTN","RMPRPAT3",186,0)
 .MERGE R28=R19(660,RMPRDA,28)
"RTN","RMPRPAT3",187,0)
 .I $P($G(^RMPR(660,RMPRDA,"DES",0)),U,3)>1 N DIR S DIR(0)="E" D ^DIR Q:$D(DUOUT)!$D(DTOUT)  D HDR W !,"EXTENDED DESCRIPTION: ",!
"RTN","RMPRPAT3",188,0)
 .D EN^DDIOL(.R28)
"RTN","RMPRPAT3",189,0)
 ;NPPD key items consolidated, example L5300 limb order
"RTN","RMPRPAT3",190,0)
 I $P(IT(AN),U,3) W !!,"*** Return For DETAIL REPORT ***" N DIR S DIR(0)="E" D ^DIR G:$D(DUOUT)!$D(DTOUT) EX1  W @IOF D HDR,^RMPRPAT7
"RTN","RMPRPAT3",191,0)
 ;display work order if it is a 2529-3 form
"RTN","RMPRPAT3",192,0)
 ;must pass ien to file 664.1 NOT 664.2
"RTN","RMPRPAT3",193,0)
 I $G(R19(660,RMPRDA,72,"I"))'="" D  G EX1
"RTN","RMPRPAT3",194,0)
 .S DIR(0)="E" D ^DIR Q:$D(DTOUT)!$D(DUOUT)
"RTN","RMPRPAT3",195,0)
 .S RMPRBCK=RMPRDA
"RTN","RMPRPAT3",196,0)
 .N DIC
"RTN","RMPRPAT3",197,0)
 .S RMPRDA=R19(660,RMPRBCK,72,"I")
"RTN","RMPRPAT3",198,0)
 .D DISP^RMPR293(RMPRDA)
"RTN","RMPRPAT3",199,0)
 .S RMPRDA=RMPRBCK K RMPRBCK
"RTN","RMPRPAT3",200,0)
 ;return from work order
"RTN","RMPRPAT3",201,0)
 G EXIT
"RTN","RMPRPAT3",202,0)
 ;
"RTN","RMPRPAT3",203,0)
HDR ;display heading
"RTN","RMPRPAT3",204,0)
 W @IOF,RMPRNAM,?30," SSN: "
"RTN","RMPRPAT3",205,0)
 W $E(RMPRSSN,1,3)_"-"_$E(RMPRSSN,4,5)_"-"_$E(RMPRSSN,6,10),?50
"RTN","RMPRPAT3",206,0)
 W $G(R19(660,RMPRDA,8,"E")),?70,"DOB: "
"RTN","RMPRPAT3",207,0)
 W $S(RMPRDOB:$E(RMPRDOB,4,5)_"-"_$E(RMPRDOB,6,7)_"-"_(1700+$E(RMPRDOB,1,3)),1:"Unknown")
"RTN","RMPRPAT3",208,0)
 W !?20,"APPLIANCE/REPAIR LINE ITEM DETAIL ",?70,"<4-",ANS,">",!
"RTN","RMPRPAT3",209,0)
 Q
"RTN","RMPRPAT3",210,0)
EXIT ;common exit point
"RTN","RMPRPAT3",211,0)
 I $Y>(IOSL-4) F  W ! Q:$Y>(IOSL-3)
"RTN","RMPRPAT3",212,0)
 N DIR S DIR(0)="E" D ^DIR
"RTN","RMPRPAT3",213,0)
 ;duout,dtout is evaluated in dis+1^rmprpat2
"RTN","RMPRPAT3",214,0)
EX1 ;back out through that point to clean up
"RTN","RMPRPAT3",215,0)
 K R19,RV,RMPRICD,RMPRICD,MSGICD,RMPRERR,Y W @IOF
"RTN","RMPRPAT3",216,0)
 Q
"RTN","RMPRPAT3",217,0)
 ;end
"RTN","RMPRPFFS")
0^6^B39570031^B29300840
"RTN","RMPRPFFS",1,0)
RMPRPFFS ;Hines OIFO/HNC - REMOTE PROCEDURE, LIST NPPD DATA ;9/8/03  07:23
"RTN","RMPRPFFS",2,0)
 ;;3.0;PROSTHETICS;**96,60,168**;Feb 09, 1996;Build 43
"RTN","RMPRPFFS",3,0)
 ;
"RTN","RMPRPFFS",4,0)
 ; Reference to $$SINFO^ICDEX supported by ICR #5747
"RTN","RMPRPFFS",5,0)
 ; Reference to $$ICDDX^ICDEX supported by ICR #5747
"RTN","RMPRPFFS",6,0)
 ;
"RTN","RMPRPFFS",7,0)
 ;  patch 96 - HNC
"RTN","RMPRPFFS",8,0)
 ;        ICR #4419 for INSUR^IBBAPI
"RTN","RMPRPFFS",9,0)
 ;        ICR #1997 for STATCHK^ICPTAPIU
"RTN","RMPRPFFS",10,0)
 ;        ICR #3823 for read file 355.3, field .04
"RTN","RMPRPFFS",11,0)
 ;
"RTN","RMPRPFFS",12,0)
 ;RESULTS passed to broker in ^TMP($J,
"RTN","RMPRPFFS",13,0)
 ;delimited by "^"
"RTN","RMPRPFFS",14,0)
 ;piece 1 = ENTRY DATE
"RTN","RMPRPFFS",15,0)
 ;piece 2 = PATIENT NAME
"RTN","RMPRPFFS",16,0)
 ;piece 3 = PSAS HCPCS with * if hcpcs has Calculation Flag
"RTN","RMPRPFFS",17,0)
 ;piece 4 = QTY
"RTN","RMPRPFFS",18,0)
 ;piece 5 = Insurance with * if more insurance info available
"RTN","RMPRPFFS",19,0)
 ;piece 6 = Insurance Effective Date
"RTN","RMPRPFFS",20,0)
 ;piece 7 = TOTAL COST
"RTN","RMPRPFFS",21,0)
 ;piece 8 = DESCRIPTION (ITEM, BRIEF DESCRIPTION WITH ~R~ FOR REPAIR)
"RTN","RMPRPFFS",22,0)
 ;piece 9 = Coding Errors
"RTN","RMPRPFFS",23,0)
 ;piece 10 = Insurance Holder
"RTN","RMPRPFFS",24,0)
 ;piece 11 = STATION
"RTN","RMPRPFFS",25,0)
 ;piece 12 = ICD Description
"RTN","RMPRPFFS",26,0)
 ;piece 13 = Billing Group Number
"RTN","RMPRPFFS",27,0)
 ;piece 14 = Subscriber ID
"RTN","RMPRPFFS",28,0)
 ;piece 15 = SSN
"RTN","RMPRPFFS",29,0)
 ;piece 16 = IEN TO FILE 660
"RTN","RMPRPFFS",30,0)
 ;piece 17 = HCPCS SHORT DESCRIPTION
"RTN","RMPRPFFS",31,0)
 ;piece 18 = ICD Code ~ Coding System
"RTN","RMPRPFFS",32,0)
 ;piece 19 = Delivery Date
"RTN","RMPRPFFS",33,0)
 ;piece 20 = Expiration Insurance Date
"RTN","RMPRPFFS",34,0)
 ;piece 21 = Hcpcs-Ic Flag, this routine will set field 4.9 in file 660
"RTN","RMPRPFFS",35,0)
 ;all records will have a 1
"RTN","RMPRPFFS",36,0)
 ;ICD, 2
"RTN","RMPRPFFS",37,0)
 ;HCPCS, 3
"RTN","RMPRPFFS",38,0)
 ;Not Billable 4
"RTN","RMPRPFFS",39,0)
 ;
"RTN","RMPRPFFS",40,0)
 ;No errors, number 1.
"RTN","RMPRPFFS",41,0)
 ;PSAS HCPCS, Not Billable Item, number 14.
"RTN","RMPRPFFS",42,0)
 ;ICD error, number 12.
"RTN","RMPRPFFS",43,0)
 ;HCPCS error, number 13.
"RTN","RMPRPFFS",44,0)
 ;Both ICD and HCPCS error, number 132.
"RTN","RMPRPFFS",45,0)
 ;Both ICD error and Not Billable Item, number 142.
"RTN","RMPRPFFS",46,0)
 Q
"RTN","RMPRPFFS",47,0)
 ;
"RTN","RMPRPFFS",48,0)
EN(RESULT,DATE1,DATE2) ;broker entry point
"RTN","RMPRPFFS",49,0)
 ;
"RTN","RMPRPFFS",50,0)
 K ^TMP($J)
"RTN","RMPRPFFS",51,0)
 I '$D(DATE1)!('$D(DATE2)) G EXIT
"RTN","RMPRPFFS",52,0)
 S DATE=DATE1-1
"RTN","RMPRPFFS",53,0)
 F  S DATE=$O(^RMPR(660,"B",DATE)) Q:(DATE="")!($P(DATE,".",1)>DATE2)  D
"RTN","RMPRPFFS",54,0)
 .S RMPRB=0
"RTN","RMPRPFFS",55,0)
 .F  S RMPRB=$O(^RMPR(660,"B",DATE,RMPRB)) Q:RMPRB=""  D
"RTN","RMPRPFFS",56,0)
 ..Q:$P(^RMPR(660,RMPRB,0),U,15)["*"
"RTN","RMPRPFFS",57,0)
 ..Q:$P(^RMPR(660,RMPRB,0),U,14)'["C"
"RTN","RMPRPFFS",58,0)
 ..;Q:$P(^RMPR(660,RMPRB,0),U,12)=""
"RTN","RMPRPFFS",59,0)
 ..Q:$P($G(^RMPR(660,RMPRB,"AM")),U,3)<2
"RTN","RMPRPFFS",60,0)
 ..;end of filter
"RTN","RMPRPFFS",61,0)
 ..S PHCPCS=$P($G(^RMPR(660,RMPRB,1)),U,4)
"RTN","RMPRPFFS",62,0)
 ..Q:PHCPCS=""
"RTN","RMPRPFFS",63,0)
 ..Q:PHCPCS'>0
"RTN","RMPRPFFS",64,0)
 ..S HDES=$P(^RMPR(661.1,PHCPCS,0),U,2)
"RTN","RMPRPFFS",65,0)
 ..;code set versioning check
"RTN","RMPRPFFS",66,0)
 ..S RICP=""
"RTN","RMPRPFFS",67,0)
 ..S RICP=$P(^RMPR(661.1,PHCPCS,0),U,1)
"RTN","RMPRPFFS",68,0)
 ..S RICPP="",CODERR="Alert",CODEFLG=1
"RTN","RMPRPFFS",69,0)
 ..I RICP'="" D
"RTN","RMPRPFFS",70,0)
 ...I $A($E(RICP,2,2))>64 S CODERR=" Non Billable Item",CODEFLG=CODEFLG_4 Q
"RTN","RMPRPFFS",71,0)
 ...I $A($E(RICP,2,2))<65 S RICPP=$$STATCHK^ICPTAPIU(RICP,$P(^RMPR(660,RMPRB,0),U,1))
"RTN","RMPRPFFS",72,0)
 ..I RICPP'="" D
"RTN","RMPRPFFS",73,0)
 ...I $P(RICPP,U,1)=0 S CODERR=CODERR_" HCPCS Inactive",CODEFLG=CODEFLG_3
"RTN","RMPRPFFS",74,0)
 ..S TYPE=$P($G(^RMPR(660,RMPRB,0)),U,4)
"RTN","RMPRPFFS",75,0)
 ..I TYPE'="X" S LINE=$P(^RMPR(661.1,PHCPCS,0),U,7)
"RTN","RMPRPFFS",76,0)
 ..I TYPE="X" S LINE=$P(^RMPR(661.1,PHCPCS,0),U,6)
"RTN","RMPRPFFS",77,0)
 ..S CAL=$P(^RMPR(661.1,PHCPCS,0),U,8)
"RTN","RMPRPFFS",78,0)
 ..I CAL'="" S CAL="*"
"RTN","RMPRPFFS",79,0)
 ..S DFN=$P(^RMPR(660,RMPRB,0),U,2)
"RTN","RMPRPFFS",80,0)
 ..D DEM^VADPT
"RTN","RMPRPFFS",81,0)
 ..D SVC^VADPT
"RTN","RMPRPFFS",82,0)
 ..S RMPROEOI=$S(VASV(11)>0:"<!>",VASV(12)>0:"<!>",VASV(13)>0:"<!>",1:0)
"RTN","RMPRPFFS",83,0)
 ..S (RMI,HOLDER,SUBID,INSUR,INSURE,INSURG,INSURGG,RMPRDELD,RMPRIND,RMPRDEL)=""
"RTN","RMPRPFFS",84,0)
 ..S RMPRDELD=$P(^RMPR(660,RMPRB,0),U,12)
"RTN","RMPRPFFS",85,0)
 ..I RMPRDELD'="" S RMPRDEL=$E(RMPRDELD,4,5)_"/"_$E(RMPRDELD,6,7)_"/"_(($E(RMPRDELD,1,3))+1700)
"RTN","RMPRPFFS",86,0)
 ..S X=$$INSUR^IBBAPI(DFN,,"RBA",.RMI,"*") I $D(RMI) D
"RTN","RMPRPFFS",87,0)
 ...;format the RMI array
"RTN","RMPRPFFS",88,0)
 ...;look for primary insurance
"RTN","RMPRPFFS",89,0)
 ...;RMI("IBBAPI","INSUR",n,7)=1^PRIMARY
"RTN","RMPRPFFS",90,0)
 ...S X="" F  S X=$O(RMI("IBBAPI","INSUR",X)) Q:'X  D
"RTN","RMPRPFFS",91,0)
 ....;I $P(RMI("IBBAPI","INSUR",X,7),U,2)'="PRIMARY" Q
"RTN","RMPRPFFS",92,0)
 ....S INSUR=$P(RMI("IBBAPI","INSUR",X,1),U,2)
"RTN","RMPRPFFS",93,0)
 ....I X>1 S INSUR="*"_INSUR
"RTN","RMPRPFFS",94,0)
 ....S SUBID=$P(RMI("IBBAPI","INSUR",X,14),U,1)
"RTN","RMPRPFFS",95,0)
 ....S HOLDER=$P(RMI("IBBAPI","INSUR",X,12),U,2)
"RTN","RMPRPFFS",96,0)
 ....S RMPRIND=$P(RMI("IBBAPI","INSUR",X,11),U,1)
"RTN","RMPRPFFS",97,0)
 ....I RMPRIND'="" S RMPRIND=$E(RMPRIND,4,5)_"/"_$E(RMPRIND,6,7)_"/"_(($E(RMPRIND,1,3))+1700)
"RTN","RMPRPFFS",98,0)
 ....S INSURE=$P(RMI("IBBAPI","INSUR",X,10),U,1)
"RTN","RMPRPFFS",99,0)
 ....I INSURE'="" S INSURE=$E(INSURE,4,5)_"/"_$E(INSURE,6,7)_"/"_(($E(INSURE,1,3))+1700)
"RTN","RMPRPFFS",100,0)
 ....S INSURG=$P(RMI("IBBAPI","INSUR",X,8),U,1)
"RTN","RMPRPFFS",101,0)
 ....S INSURGG=$$GET1^DIQ(355.3,INSURG_",",.04)
"RTN","RMPRPFFS",102,0)
 ..I '$D(RMI) D
"RTN","RMPRPFFS",103,0)
 ...S INSUR="No Insurance Information"
"RTN","RMPRPFFS",104,0)
 ...S SUBID=""
"RTN","RMPRPFFS",105,0)
 ...S HOLDER=""
"RTN","RMPRPFFS",106,0)
 ...S INSURE=""
"RTN","RMPRPFFS",107,0)
 ...S INSURGG=""
"RTN","RMPRPFFS",108,0)
 ...S RMPRIND=""
"RTN","RMPRPFFS",109,0)
 ..;
"RTN","RMPRPFFS",110,0)
 ..; ICD10 Changes - Add the Coding System as the 2nd ~ delimited piece
"RTN","RMPRPFFS",111,0)
 ..N RMPRACS,RMPRACSI,RMPRCSI,RMPRICDD,RMPRICDE,RMPRSICD
"RTN","RMPRPFFS",112,0)
 ..S (RMPRACS,RMPRACSI,RMPRCSI,RMPRICDD,RMPRICDE,RMPRSICD)=""
"RTN","RMPRPFFS",113,0)
 ..; Get ICD data
"RTN","RMPRPFFS",114,0)
 ..S RMPRSICD=$P($G(^RMPR(660,RMPRB,10)),U,8) ; SUSPENSE ICD (#8.8)
"RTN","RMPRPFFS",115,0)
 ..I RMPRSICD'="" D
"RTN","RMPRPFFS",116,0)
 ...; Determine Active Coding System Information
"RTN","RMPRPFFS",117,0)
 ...S RMPRCSI=$$SINFO^ICDEX("DIAG",DATE) ; Supported by ICR 5747
"RTN","RMPRPFFS",118,0)
 ...S RMPRACSI=$P(RMPRCSI,U,1) ; Internal format Active Coding System based on Date of Interest
"RTN","RMPRPFFS",119,0)
 ...S RMPRACS=$P(RMPRCSI,U,2) ; External format Active Coding System based on Date of Interest
"RTN","RMPRPFFS",120,0)
 ...; Retrieve ICD Data
"RTN","RMPRPFFS",121,0)
 ...S RMPRSICD=$$ICDDX^ICDEX(RMPRSICD,DATE,RMPRACSI,"I") ; Supported by ICR 5747
"RTN","RMPRPFFS",122,0)
 ...I RMPRSICD'="" S RMPRICDE=$P(RMPRSICD,U,2),RMPRICDD=$P(RMPRSICD,U,4)
"RTN","RMPRPFFS",123,0)
 ...S RMPRACS=$S(RMPRACS="ICD-9-CM":9,RMPRACS="ICD-10-CM":10,1:"")
"RTN","RMPRPFFS",124,0)
 ...I RMPRSICD'="" S RMPRICDE=$P(RMPRSICD,U,2)_"~"_+RMPRACS
"RTN","RMPRPFFS",125,0)
 ...; Check STATUS (#66) from File #80.
"RTN","RMPRPFFS",126,0)
 ...I $P(RMPRSICD,U,10)=0 S CODERR=CODERR_" ICD"_RMPRACS_" Inactive",CODEFLG=CODEFLG_2
"RTN","RMPRPFFS",127,0)
 ..D DATA
"RTN","RMPRPFFS",128,0)
 S RESULT=$NA(^TMP($J))
"RTN","RMPRPFFS",129,0)
 Q
"RTN","RMPRPFFS",130,0)
 ;
"RTN","RMPRPFFS",131,0)
DATA ;
"RTN","RMPRPFFS",132,0)
 S B=RMPRB
"RTN","RMPRPFFS",133,0)
 D GETS^DIQ(660,B,".01;.02;2;4.5;5;7;8;8.3;11;12;14;24;27;68","","RMXM")
"RTN","RMPRPFFS",134,0)
 S $P(^TMP($J,B),U,1)=$G(RMXM(660,B_",",.01))
"RTN","RMPRPFFS",135,0)
 ;Check for OEF/OIF
"RTN","RMPRPFFS",136,0)
 I RMPROEOI="<!>" S RMXM(660,B_",",.02)="<!>"_RMXM(660,B_",",.02)
"RTN","RMPRPFFS",137,0)
 S $P(^TMP($J,B),U,2)=$G(RMXM(660,B_",",.02))
"RTN","RMPRPFFS",138,0)
 S $P(^TMP($J,B),U,3)=$G(RMXM(660,B_",",4.5))_CAL
"RTN","RMPRPFFS",139,0)
 S $P(^TMP($J,B),U,4)=$G(RMXM(660,B_",",5))
"RTN","RMPRPFFS",140,0)
 ;change to insurance
"RTN","RMPRPFFS",141,0)
 I INSUR="" S INSUR="Incomplete Insurance Information"
"RTN","RMPRPFFS",142,0)
 S $P(^TMP($J,B),U,5)=INSUR
"RTN","RMPRPFFS",143,0)
 ;change to effective insurance date
"RTN","RMPRPFFS",144,0)
 S $P(^TMP($J,B),U,6)=INSURE
"RTN","RMPRPFFS",145,0)
 S $P(^TMP($J,B),U,7)=$G(RMXM(660,B_",",14))
"RTN","RMPRPFFS",146,0)
 ;patch 77 remove the " for Excel CSV
"RTN","RMPRPFFS",147,0)
 ;append ~R~ for repair items
"RTN","RMPRPFFS",148,0)
 I $G(RMXM(660,B_",",2))="REPAIR" S RMXM(660,B_",",24)="~R~"_RMXM(660,B_",",24)
"RTN","RMPRPFFS",149,0)
 S $P(^TMP($J,B),U,8)=$TR($G(RMXM(660,B_",",24)),"""","'")
"RTN","RMPRPFFS",150,0)
 ;change to coding errors
"RTN","RMPRPFFS",151,0)
 I CODERR="Alert" S CODERR=""
"RTN","RMPRPFFS",152,0)
 S $P(^TMP($J,B),U,9)=CODERR
"RTN","RMPRPFFS",153,0)
 ;change to holder
"RTN","RMPRPFFS",154,0)
 S $P(^TMP($J,B),U,10)=HOLDER
"RTN","RMPRPFFS",155,0)
 S $P(^TMP($J,B),U,11)=$G(RMXM(660,B_",",8))
"RTN","RMPRPFFS",156,0)
 ;change to ICD description
"RTN","RMPRPFFS",157,0)
 S $P(^TMP($J,B),U,12)=RMPRICDD
"RTN","RMPRPFFS",158,0)
 ;change to Billing Group
"RTN","RMPRPFFS",159,0)
 S $P(^TMP($J,B),U,13)=INSURGG
"RTN","RMPRPFFS",160,0)
 ;change to subscriber ID
"RTN","RMPRPFFS",161,0)
 S $P(^TMP($J,B),U,14)=SUBID
"RTN","RMPRPFFS",162,0)
 S $P(^TMP($J,B),U,15)=$P(VADM(2),U,2)
"RTN","RMPRPFFS",163,0)
 S $P(^TMP($J,B),U,16)=B
"RTN","RMPRPFFS",164,0)
 S $P(^TMP($J,B),U,17)=HDES
"RTN","RMPRPFFS",165,0)
 ;change to ICD code
"RTN","RMPRPFFS",166,0)
 S $P(^TMP($J,B),U,18)=RMPRICDE
"RTN","RMPRPFFS",167,0)
 ;add Delivery Date
"RTN","RMPRPFFS",168,0)
 S $P(^TMP($J,B),U,20)=RMPRDEL
"RTN","RMPRPFFS",169,0)
 ;add Insurance Expiration Date
"RTN","RMPRPFFS",170,0)
 S $P(^TMP($J,B),U,19)=RMPRIND
"RTN","RMPRPFFS",171,0)
 ;hcpcs-icd code flag
"RTN","RMPRPFFS",172,0)
 S $P(^TMP($J,B),U,21)=CODEFLG
"RTN","RMPRPFFS",173,0)
 S $P(^RMPR(660,RMPRB,1),U,11)=CODEFLG
"RTN","RMPRPFFS",174,0)
 S $P(^RMPR(660,RMPRB,1),U,12)=DT
"RTN","RMPRPFFS",175,0)
 K RMXM,VADM,CAL
"RTN","RMPRPFFS",176,0)
 D KVAR^VADPT
"RTN","RMPRPFFS",177,0)
 Q
"RTN","RMPRPFFS",178,0)
EXIT ;common exit point
"RTN","RMPRPFFS",179,0)
 N RESULTS D KILL^XUSCLEAN
"RTN","RMPRPFFS",180,0)
 Q
"RTN","RMPRPFFS",181,0)
 ;END
"RTN","RMPRSE21")
0^3^B42297840^B29249805
"RTN","RMPRSE21",1,0)
RMPRSE21 ;HINES CIOFO/HNB - SEARCH FILE 660 ENTRIES PSAS HCPCS HISTORY;1/23/1998
"RTN","RMPRSE21",2,0)
 ;;3.0;PROSTHETICS;**36,62,77,92,90,128,168**;Feb 09, 1996;Build 43
"RTN","RMPRSE21",3,0)
 ;
"RTN","RMPRSE21",4,0)
 ; Reference to $$SINFO^ICDEX supported by ICR #5747
"RTN","RMPRSE21",5,0)
 ; Reference to $$ICDDX^ICDEX supported by ICR #5747
"RTN","RMPRSE21",6,0)
 ; Reference to $$VLT^ICDEX   supported by ICR #5747
"RTN","RMPRSE21",7,0)
 ;
"RTN","RMPRSE21",8,0)
 ; RVD patch #62 - add ICD9 code and Description in the output
"RTN","RMPRSE21",9,0)
 ; RVD patch #77 3/17/03 - use RMPR("STA") instead of $$STA^RMPRUTIL
"RTN","RMPRSE21",10,0)
 ;
"RTN","RMPRSE21",11,0)
 ; AAC Patch 92 08/03/04 - Code Set Versioning (CSV)
"RTN","RMPRSE21",12,0)
 ;
"RTN","RMPRSE21",13,0)
EN S (ITEM,RMPRARR,RMPRI,RMPRDA)=""
"RTN","RMPRSE21",14,0)
 K KILL
"RTN","RMPRSE21",15,0)
 D HOME^%ZIS,DIV4^RMPRSIT G:$D(X) EXIT1
"RTN","RMPRSE21",16,0)
 W !!!
"RTN","RMPRSE21",17,0)
 S DIC="^RMPR(661.1,",DIC(0)="AEQM"
"RTN","RMPRSE21",18,0)
 F ITEM=1:1 S DIC("A")="Select PSAS HCPCS ("_ITEM_"): " D ^DIC G:$D(DTOUT)!(X["^")!(X=""&(ITEM=1)) EXIT1 Q:X=""  D
"RTN","RMPRSE21",19,0)
 .I $D(RMPRI(+Y)) W !,$C(7)," ??",?40,"..Duplicate PSAS HCPCS" S ITEM=ITEM-1 Q
"RTN","RMPRSE21",20,0)
 .S RMPRARR(ITEM)=+Y,RMPRI(+Y)=""
"RTN","RMPRSE21",21,0)
 S RMPRCOUN=0 W !! S %DT("A")="Beginning Date: ",%DT="AEPX",%DT("B")="T-30" D ^%DT S RMPRBDT=Y G:Y<0 EXIT1
"RTN","RMPRSE21",22,0)
ENDATE S %DT("A")="Ending Date: ",%DT="AEX",%DT("B")="TODAY"
"RTN","RMPRSE21",23,0)
 D ^%DT G:Y<0 EXIT1
"RTN","RMPRSE21",24,0)
 I RMPRBDT>Y W !,$C(7),"Invalid Date Range Selection!!" G ENDATE
"RTN","RMPRSE21",25,0)
 G:Y<0 EXIT
"RTN","RMPRSE21",26,0)
 S RMPREDT=Y,Y=RMPRBDT D DD^%DT S RMPRX=Y,Y=RMPREDT  D DD^%DT S RMPRY=Y
"RTN","RMPRSE21",27,0)
 S %ZIS="MQ" K IOP D ^%ZIS G:POP EXIT
"RTN","RMPRSE21",28,0)
 I '$D(IO("Q")) U IO G PRINT
"RTN","RMPRSE21",29,0)
 K IO("Q") S ZTDESC="SEARCH FOR PSAS HCPCS",ZTRTN="PRINT^RMPRSE21",ZTIO=ION,ZTSAVE("RMPRBDT")="",ZTSAVE("RMPREDT")="",ZTSAVE("RMPRI(")="",ZTSAVE("RMPRX")="",ZTSAVE("RMPRY")="",ZTSAVE("RMPR(""STA"")")="",ZTSAVE("RMPRARR(")=""
"RTN","RMPRSE21",30,0)
 S ZTSAVE("RMPR(")="",ZTSAVE("RMPRSITE")=""
"RTN","RMPRSE21",31,0)
 D ^%ZTLOAD W:$D(ZTSK) !,"REQUEST QUEUED!" H 1 G EXIT1
"RTN","RMPRSE21",32,0)
PRINT ;ENTRY POINT FOR PRINTING REPORT
"RTN","RMPRSE21",33,0)
 S PAGE=1,(RMPRCOUN,RP,QTYT,COSTT)=0
"RTN","RMPRSE21",34,0)
 S RQ=0
"RTN","RMPRSE21",35,0)
 F  S RQ=$O(RMPRARR(RQ)) Q:RQ'>0!($D(KILL))  D  D REST
"RTN","RMPRSE21",36,0)
 .S RO=$P(RMPRARR(RQ),U,1),RO=RO-1
"RTN","RMPRSE21",37,0)
 .F  S RO=$O(^RMPR(660,"H",RO)) Q:RO'>0  D
"RTN","RMPRSE21",38,0)
 . .Q:RO=""!(RO'=$P(RMPRARR(RQ),U))!($D(KILL))
"RTN","RMPRSE21",39,0)
 . .K ENDD
"RTN","RMPRSE21",40,0)
 . .F  S RP=$O(^RMPR(660,"H",RO,RP)) Q:RP=""!($D(KILL))  D CK
"RTN","RMPRSE21",41,0)
 G EXIT
"RTN","RMPRSE21",42,0)
 Q
"RTN","RMPRSE21",43,0)
EXIT ;EXIT FROM REPORT HERE
"RTN","RMPRSE21",44,0)
 I RMPRCOUN>0,$D(RMPREDT),'$D(KILL) W !!?32,"END OF REPORT"
"RTN","RMPRSE21",45,0)
 I $E(IOST)["C"&($Y<22),'$D(ENDD) F  W ! Q:$Y>20
"RTN","RMPRSE21",46,0)
 I $D(RMPREDT),$E(IOST)["C",'$D(RMPRFLL),'$D(KILL),'$D(DUOUT),'$D(DTOUT),'$D(ENDD) K DIR S DIR(0)="E" D ^DIR
"RTN","RMPRSE21",47,0)
EXIT1 K RMPRARR,%DT,GOTO,QTYT,ITEM,KILL,ENDD,RQ,RP,RO,ITEM,RMPRI,COSTT,DIC,DIR,PAGE,RO,RMPRCOUN,RMPRSE,RMPRBDT,RMPREDT,RMPRX,RMPRY D ^%ZISC
"RTN","RMPRSE21",48,0)
 Q
"RTN","RMPRSE21",49,0)
CK Q:'$D(^RMPR(660,RP,0))
"RTN","RMPRSE21",50,0)
 ;hcpcs
"RTN","RMPRSE21",51,0)
 I ('$P(^RMPR(660,RP,1),U,4))!($P(^(0),U,3)<RMPRBDT)!($P(^(0),U,3)>RMPREDT)  Q
"RTN","RMPRSE21",52,0)
 I $P(^RMPR(660,RP,0),U,10)'=RMPR("STA") Q
"RTN","RMPRSE21",53,0)
 ;
"RTN","RMPRSE21",54,0)
 I $P(RMPRARR(RQ),U,1)=$P(^RMPR(660,RP,1),U,4) D CON
"RTN","RMPRSE21",55,0)
 Q
"RTN","RMPRSE21",56,0)
 ;
"RTN","RMPRSE21",57,0)
CON I $Y>(IOSL-6),PAGE=1,'RMPRCOUN W @IOF
"RTN","RMPRSE21",58,0)
 D HEAD S RMPRCOUN=RMPRCOUN+1
"RTN","RMPRSE21",59,0)
 S (RMPRDA,Y)=$P(^RMPR(660,RP,0),U,3) D DD^%DT
"RTN","RMPRSE21",60,0)
 W !,Y,?15,$E($P(^DPT($P(^RMPR(660,RP,0),U,2),0),U,1),1,13),?30,$E($P(^DPT($P(^RMPR(660,RP,0),U,2),0),U,9),6,9)
"RTN","RMPRSE21",61,0)
 W:$P(^RMPR(660,RP,0),U,9)'="" ?36,$E($P(^PRC(440,$P(^RMPR(660,RP,0),U,9),0),U,1),1,35)
"RTN","RMPRSE21",62,0)
 W !,"ITEM: " S ITMP=$P(^RMPR(660,RP,0),U,6)
"RTN","RMPRSE21",63,0)
 W:ITMP'="" $E($P(^PRC(441,$P(^RMPR(661,ITMP,0),U,1),0),U,2),1,20)
"RTN","RMPRSE21",64,0)
 K ITMP
"RTN","RMPRSE21",65,0)
 I $P(^RMPR(660,RP,0),U,13)=4 D
"RTN","RMPRSE21",66,0)
 .W ?27,"QTY: ",$J($P(^RMPR(660,RP,0),U,7),4),?38,"TOTAL COST: ",$J($FN($P(^("LB"),U,9),"P",2),8) S QTYT=QTYT+$P(^(0),U,7),COSTT=COSTT+$P(^("LB"),U,9)
"RTN","RMPRSE21",67,0)
 I $P(^RMPR(660,RP,0),U,13)'=4 W ?27,"QTY: ",$J($P(^RMPR(660,RP,0),U,7),4),?38,"TOTAL COST: ",$J($FN($P(^(0),U,16),"P",2),8) S QTYT=QTYT+$P(^(0),U,7),COSTT=COSTT+$P(^(0),U,16)
"RTN","RMPRSE21",68,0)
 W ?60,$S($P(^RMPR(660,RP,0),U,4)="I":"INITIAL ISSUE",$P(^(0),U,4)="R":"REPLACEMENT",$P(^(0),U,4)="S":"SPARE",$P(^(0),U,4)="X":"REPAIR",$P(^(0),U,4)="5":"RENTAL",1:"UNK"),!,"INITIATOR: "
"RTN","RMPRSE21",69,0)
 I $P(^RMPR(660,RP,0),U,27),$D(^VA(200,$P(^(0),U,27),0)) W ?15,$P(^(0),U)
"RTN","RMPRSE21",70,0)
 ;
"RTN","RMPRSE21",71,0)
 ; Patch 92 - Code Set Versioning (CSV) changes below
"RTN","RMPRSE21",72,0)
 ; AAC - 08/03/04
"RTN","RMPRSE21",73,0)
 ; Changes for ICD-10 Class I Remediation Project
"RTN","RMPRSE21",74,0)
 ;
"RTN","RMPRSE21",75,0)
 N RMPRACS,RMPRACSI,RMPRCNT,RMPRDAT,RMPRDATA,RMPRERR,RMPRICD,RMPRSICD
"RTN","RMPRSE21",76,0)
 N RMPRPROD,RMPRTOR,RMPRTXT1
"RTN","RMPRSE21",77,0)
 S (RMPRACS,RMPRACSI,RMPRDAT,RMPRDATA,RMPRICD,RMPRSICD)=""
"RTN","RMPRSE21",78,0)
 S (RMPRPROD,RMPRTOR,RMPRTXT1)=""
"RTN","RMPRSE21",79,0)
 S RMPRERR=0
"RTN","RMPRSE21",80,0)
 S RMPRDAT=$P($G(^RMPR(660,RP,0)),U,1)
"RTN","RMPRSE21",81,0)
 ; Determine Active Coding System based on Date of Interest
"RTN","RMPRSE21",82,0)
 S RMPRACS=$$SINFO^ICDEX("DIAG",RMPRDAT) ; Supported by ICR 5747
"RTN","RMPRSE21",83,0)
 S RMPRACSI=$P(RMPRACS,U,1)
"RTN","RMPRSE21",84,0)
 S RMPRACS=$P(RMPRACS,U,2)
"RTN","RMPRSE21",85,0)
 S RMPRACS=$S(RMPRACS="ICD-9-CM":"ICD-9 ",RMPRACS="ICD-10-CM":"ICD-10 ",1:"ICD: ")
"RTN","RMPRSE21",86,0)
 ;
"RTN","RMPRSE21",87,0)
 ; Load Suspense data
"RTN","RMPRSE21",88,0)
 S RMPRDATA=$G(^RMPR(660,RP,10))
"RTN","RMPRSE21",89,0)
 I RMPRDATA'="" D
"RTN","RMPRSE21",90,0)
 .S RMPRTOR=$P(RMPRDATA,U,5) ; TYPE OF REQUEST #8.5
"RTN","RMPRSE21",91,0)
 .S RMPRPROD=$P(RMPRDATA,U,7) ; PROVISIONAL DIAGNOSIS #8.7
"RTN","RMPRSE21",92,0)
 .S RMPRSICD=$P(RMPRDATA,U,8) ; SUSPENSE ICD #8.8
"RTN","RMPRSE21",93,0)
 ;
"RTN","RMPRSE21",94,0)
 ; If SUSPENSE ICD existed, retrieve data
"RTN","RMPRSE21",95,0)
 I RMPRSICD'="" D
"RTN","RMPRSE21",96,0)
 .; Use new API to return ICD Data
"RTN","RMPRSE21",97,0)
 .S RMPRICD=$$ICDDX^ICDEX(RMPRSICD,RMPRDAT,RMPRACSI,"I") ; Supported by ICR 5747
"RTN","RMPRSE21",98,0)
 .S RMPRERR=$P(RMPRICD,U,1)
"RTN","RMPRSE21",99,0)
 .; Update error message to display either ICD-9 or ICD-10 based on Date Of Interest
"RTN","RMPRSE21",100,0)
 .I RMPRERR<0 W !,RMPRACS_"Message: "_$P(RMPRICD,U,2) Q
"RTN","RMPRSE21",101,0)
 .; Retrieve full ICD Description
"RTN","RMPRSE21",102,0)
 .S RMPRTXT(2)=$$VLT^ICDEX(80,+RMPRICD,RMPRDAT) ; Supported by ICR 5747
"RTN","RMPRSE21",103,0)
 ;
"RTN","RMPRSE21",104,0)
 ; Check for Manual Suspense and adjust line label if needed
"RTN","RMPRSE21",105,0)
 S RMPRTXT(1)=$S(RMPRTOR="MANUAL"&(RMPRSICD=""):"MANUAL SUSPENSE: ",1:RMPRACS_"CODE: ")
"RTN","RMPRSE21",106,0)
 ;
"RTN","RMPRSE21",107,0)
 I +$G(RMPRSICD) D
"RTN","RMPRSE21",108,0)
 .S RMPRTXT(1)=RMPRTXT(1)_$P(RMPRICD,U,2)_"  "
"RTN","RMPRSE21",109,0)
 .;
"RTN","RMPRSE21",110,0)
 .; Process SUSPENSE ICD
"RTN","RMPRSE21",111,0)
 .I $P(RMPRICD,U,10)'>0 D
"RTN","RMPRSE21",112,0)
 ..S Y=$P(RMPRICD,U,12) ; Inactive Date
"RTN","RMPRSE21",113,0)
 ..D DD^%DT
"RTN","RMPRSE21",114,0)
 ..S RMPRTXT(3)="  ** Inactive ** Date: "_Y
"RTN","RMPRSE21",115,0)
 .;
"RTN","RMPRSE21",116,0)
 .; Parse ICD data into 80 char array
"RTN","RMPRSE21",117,0)
 .D PARSE^RMPOPED(.RMPRTXT)
"RTN","RMPRSE21",118,0)
 ;
"RTN","RMPRSE21",119,0)
 ; Loop to display ICD and Suspense info
"RTN","RMPRSE21",120,0)
 F RMPRCNT=1:1 Q:'$D(RMPRTXT(RMPRCNT))  W !,RMPRTXT(RMPRCNT)
"RTN","RMPRSE21",121,0)
 K RMPRTXT
"RTN","RMPRSE21",122,0)
 ;
"RTN","RMPRSE21",123,0)
 ; End of Patch 92 & ICD-10 mods
"RTN","RMPRSE21",124,0)
 ;
"RTN","RMPRSE21",125,0)
 I $E(IOST)["C"&($Y>(IOSL-6)) S DIR(0)="E" D ^DIR S:Y<1 KILL=1 Q:Y<1  K DIR W @IOF D HEAD Q
"RTN","RMPRSE21",126,0)
 I $Y>(IOSL-6) W @IOF D HEAD
"RTN","RMPRSE21",127,0)
 Q
"RTN","RMPRSE21",128,0)
 ;
"RTN","RMPRSE21",129,0)
HEAD I $Y<2!(PAGE=1) D
"RTN","RMPRSE21",130,0)
 .N RMPRSTAW
"RTN","RMPRSE21",131,0)
 .S RMPRSTAW=RMPR("STA")
"RTN","RMPRSE21",132,0)
 .I RMPRSTAW'="",$D(^DIC(4,RMPRSTAW,99)) S RMPRSTAW=$P(^DIC(4,RMPRSTAW,99),U)
"RTN","RMPRSE21",133,0)
 .W !,"PSAS HCPCS HISTORY:",?15
"RTN","RMPRSE21",134,0)
 .W $E($P(^RMPR(661.1,$P(^RMPR(660,RP,1),U,4),0),U,1),1,39)
"RTN","RMPRSE21",135,0)
 .W ?63,"STA ",RMPRSTAW,?72,"PAGE ",PAGE S PAGE=PAGE+1
"RTN","RMPRSE21",136,0)
 .W !!,"REQUEST DATE",?15,"PATIENT NAME",?30,"SSN",?36,"VENDOR"
"RTN","RMPRSE21",137,0)
 .S Y=RMPRBDT D DD^%DT W ?55,Y,"-" S Y=RMPREDT D DD^%DT W Y
"RTN","RMPRSE21",138,0)
 .W ! F BH=1:1:IOM W "="
"RTN","RMPRSE21",139,0)
 Q
"RTN","RMPRSE21",140,0)
 ;
"RTN","RMPRSE21",141,0)
REST D:'RMPRCOUN NONE Q:$D(KILL)!('RMPRCOUN)  W !,"TOTAL DOLLARS SPENT ON THIS HCPCS: ","$"_$J($FN(COSTT,"P",2),9),?45,"TOTAL QUANTITY ISSUED: ",$J(QTYT,4)
"RTN","RMPRSE21",142,0)
 I $O(RMPRARR(RQ)),$E(IOST)["C" W ! K DIR S DIR(0)="E" D ^DIR S:Y<1 KILL=1 W:'$D(KILL) @IOF
"RTN","RMPRSE21",143,0)
 I $E(IOST)'["C",$O(RMPRARR(RQ)) W @IOF
"RTN","RMPRSE21",144,0)
 S (COSTT,QTYT,RMPRCOUN)=""
"RTN","RMPRSE21",145,0)
 Q
"RTN","RMPRSE21",146,0)
 ;
"RTN","RMPRSE21",147,0)
NONE W @IOF,!!,"No '",$P(^RMPR(661.1,RMPRARR(RQ),0),U,1),"' PSAS HCPCS History for this date range.",!
"RTN","RMPRSE21",148,0)
 ;,$P(^PRC(441,$P(^RMPR(661,$P(RMPRARR(RQ),U),0),U),0),U,2)
"RTN","RMPRSE21",149,0)
 I $E(IOST)["C" K DIR S DIR(0)="E" W !!!! D ^DIR W @IOF S:Y<1 KILL=1 S ENDD=1
"RTN","RMPRSE21",150,0)
 Q
"RTN","RMPRSE21",151,0)
XREF ;set new x-ref for the field HCPCS in 660
"RTN","RMPRSE21",152,0)
 ;fix HCPCS VA117, REMOVE BLANK SPACE IN R90
"RTN","RMPRSE21",153,0)
 S $P(^RMPR(661.1,2801,0),U,6)="R90"
"RTN","RMPRSE21",154,0)
 W !!,"New Cross Reference for HCPCS..."
"RTN","RMPRSE21",155,0)
 S DIK="^RMPR(660,",DIK(1)="4.5^H" D ENALL^DIK
"RTN","RMPRSE21",156,0)
 W !!,"Done"
"RTN","RMPRSE21",157,0)
 Q
"RTN","RMPRSE21",158,0)
 ;END
"UP",665,665.193,-1)
665^RMPOB
"UP",665,665.193,0)
665.193
"UP",665,665.194,-1)
665^RMPOC
"UP",665,665.194,0)
665.194
"VER")
8.0^22.0
"^DD",660,660,8.8,0)
SUSPENSE ICD^P80'^ICD9(^10;8^Q
"^DD",660,660,8.8,3)
Select the diagnosis code at the time suspense was created.
"^DD",660,660,8.8,21,0)
^^1^1^3111019^
"^DD",660,660,8.8,21,1,0)
This is the code at the time suspense was created.
"^DD",660,660,8.8,23,0)
^^2^2^3111019^
"^DD",660,660,8.8,23,1,0)
Migrated from the ICD (#1.6) field in the PROSTHETIC SUSPENSE (#668) file 
"^DD",660,660,8.8,23,2,0)
when action is taken on behalf of a patient.
"^DD",660,660,8.8,"DT")
3111019
"^DD",660,660,30,0)
PRIMARY ICD DIAGNOSIS CODE^P80'^ICD9(^BA1;1^Q
"^DD",660,660,30,3)
Select the primary diagnosis code for the order.
"^DD",660,660,30,21,0)
^^1^1^3111020^
"^DD",660,660,30,21,1,0)
This is the primary diagnosis code for the order.
"^DD",660,660,30,"DT")
3111020
"^DD",660,660,31,0)
SECONDARY ICD DIAGNOSIS CODE 1^P80'^ICD9(^BA2;1^Q
"^DD",660,660,31,3)
Select the secondary diagnosis code 1.
"^DD",660,660,31,21,0)
^^1^1^3111020^
"^DD",660,660,31,21,1,0)
This is the secondary diagnosis code 1.
"^DD",660,660,31,"DT")
3111020
"^DD",660,660,32,0)
SECONDARY ICD DIAGNOSIS 2^P80'^ICD9(^BA3;1^Q
"^DD",660,660,32,3)
Select the secondary diagnosis code 2.
"^DD",660,660,32,21,0)
^^1^1^3111020^
"^DD",660,660,32,21,1,0)
This is the secondary diagnosis code 2.
"^DD",660,660,32,"DT")
3111020
"^DD",660,660,33,0)
SECONDARY ICD DIAGNOSIS 3^P80'^ICD9(^BA4;1^Q
"^DD",660,660,33,3)
Select the secondary diagnosis code 3.
"^DD",660,660,33,21,0)
^^1^1^3111020^
"^DD",660,660,33,21,1,0)
This is the secondary diagnosis code 3.
"^DD",660,660,33,"DT")
3111020
"^DD",665,665.193,30,0)
PRIMARY ICD DIAGNOSIS CODE^P80'^ICD9(^BA1;1^Q
"^DD",665,665.193,30,3)
Select the primary diagnosis code from the consult.
"^DD",665,665.193,30,21,0)
^^1^1^3111020^
"^DD",665,665.193,30,21,1,0)
Primary ICD from the consult.  Associated with the prescription.
"^DD",665,665.193,30,"DT")
3111020
"^DD",665,665.193,31,0)
SECONDARY ICD DIAGNOSIS CODE 1^P80'^ICD9(^BA2;1^Q
"^DD",665,665.193,31,3)
Select the secondary diagnosis code 1 from the consult.
"^DD",665,665.193,31,21,0)
^^1^1^3111020^
"^DD",665,665.193,31,21,1,0)
A Secondary ICD from the consult.  Associated with the prescription.
"^DD",665,665.193,31,"DT")
3111020
"^DD",665,665.193,32,0)
SECONDARY ICD DIAGNOSIS CODE 2^P80'^ICD9(^BA3;1^Q
"^DD",665,665.193,32,3)
Select the secondary diagnosis code 2 from the consult.
"^DD",665,665.193,32,21,0)
^^1^1^3111020^
"^DD",665,665.193,32,21,1,0)
A Secondary ICD from the consult.  Associated with the prescription.
"^DD",665,665.193,32,"DT")
3111020
"^DD",665,665.193,33,0)
SECONDARY ICD DIAGNOSIS CODE 3^P80'^ICD9(^BA4;1^Q
"^DD",665,665.193,33,3)
Select the secondary diagnosis code 3 from the consult.
"^DD",665,665.193,33,21,0)
^^1^1^3111020^
"^DD",665,665.193,33,21,1,0)
A Secondary ICD from the consult.  Associated with the prescription.
"^DD",665,665.193,33,"DT")
3111020
"^DD",665,665.194,7,0)
ICD CODE^P80'^ICD9(^0;8^Q
"^DD",665,665.194,7,3)
Enter ICD diagnosis code.
"^DD",665,665.194,7,21,0)
^^1^1^3111019^
"^DD",665,665.194,7,21,1,0)
This is the ICD diagnosis code.
"^DD",665,665.194,7,"DT")
3111019
"^DD",668,668,1.6,0)
ICD^P80'^ICD9(^8;3^Q
"^DD",668,668,1.6,3)
Select the primary CPRS diagnosis code at the time of consult.
"^DD",668,668,1.6,21,0)
^^2^2^3111229^
"^DD",668,668,1.6,21,1,0)
This is the primary CPRS diagnosis code at the time of consult. (Stuffed
"^DD",668,668,1.6,21,2,0)
from HL7 message.)
"^DD",668,668,1.6,"DT")
3111229
"^DD",668,668,30,0)
PRIMARY ICD DIAGNOSIS CODE^P80'^ICD9(^BA1;1^Q
"^DD",668,668,30,3)
Select the primary CPRS diagnosis code at the time of consult.
"^DD",668,668,30,21,0)
^^1^1^3111020^
"^DD",668,668,30,21,1,0)
This is the primary diagnosis code.
"^DD",668,668,30,"DT")
3111020
"^DD",668,668,31,0)
SECONDARY ICD DIAGNOSIS 1^P80'^ICD9(^BA2;1^Q
"^DD",668,668,31,3)
Select the secondary CPRS diagnosis code 1 at the time of consult.
"^DD",668,668,31,21,0)
^^1^1^3111020^
"^DD",668,668,31,21,1,0)
This is the secondary CPRS diagnosis code 1 at the time of consult.
"^DD",668,668,31,"DT")
3111020
"^DD",668,668,32,0)
SECONDARY ICD DIAGNOSIS 2^P80'^ICD9(^BA3;1^Q
"^DD",668,668,32,3)
Select the secondary CPRS diagnosis code 2 at the time of consult.
"^DD",668,668,32,21,0)
^^1^1^3111020^
"^DD",668,668,32,21,1,0)
This is the secondary CPRS diagnosis code 2 at the time of consult.
"^DD",668,668,32,"DT")
3111020
"^DD",668,668,33,0)
SECONDARY ICD DIAGNOSIS 3^P80'^ICD9(^BA4;1^Q
"^DD",668,668,33,3)
Select the secondary CPRS diagnosis code 3 at the time of consult.
"^DD",668,668,33,21,0)
^^1^1^3111020^
"^DD",668,668,33,21,1,0)
This is the secondary CPRS diagnosis code 3 at the time of consult.
"^DD",668,668,33,"DT")
3111020
"BLD",8822,6)
^152
**END**
**END**

