Released RMPR*3*179 SEQ #156
Extracted from mail message
**KIDS**:RMPR*3.0*179^

**INSTALL NAME**
RMPR*3.0*179
"BLD",9056,0)
RMPR*3.0*179^PROSTHETICS^0^3150713^y
"BLD",9056,1,0)
^^8^8^3150707^
"BLD",9056,1,1,0)
1. Home Oxygen Generate Letters option has site and prescription
"BLD",9056,1,2,0)
   expiration date issues. 
"BLD",9056,1,3,0)
                                                                
"BLD",9056,1,4,0)
2. Home Oxygen Billing and Home Oxygen Reporting has no check/flag for
"BLD",9056,1,5,0)
   deceased patients. 
"BLD",9056,1,6,0)
 
"BLD",9056,1,7,0)
3. Insure work file is killed when running option 'LIST OPEN STOCK 
"BLD",9056,1,8,0)
   ISSUES'.
"BLD",9056,4,0)
^9.64PA^^
"BLD",9056,6.3)
7
"BLD",9056,"ABPKG")
n
"BLD",9056,"KRN",0)
^9.67PA^779.2^20
"BLD",9056,"KRN",.4,0)
.4
"BLD",9056,"KRN",.4,"NM",0)
^9.68A^1^1
"BLD",9056,"KRN",.4,"NM",1,0)
RMPO-RPT-HOACTZIPLIST    FILE #665^665^0
"BLD",9056,"KRN",.4,"NM","B","RMPO-RPT-HOACTZIPLIST    FILE #665",1)

"BLD",9056,"KRN",.401,0)
.401
"BLD",9056,"KRN",.402,0)
.402
"BLD",9056,"KRN",.403,0)
.403
"BLD",9056,"KRN",.5,0)
.5
"BLD",9056,"KRN",.84,0)
.84
"BLD",9056,"KRN",3.6,0)
3.6
"BLD",9056,"KRN",3.8,0)
3.8
"BLD",9056,"KRN",9.2,0)
9.2
"BLD",9056,"KRN",9.8,0)
9.8
"BLD",9056,"KRN",9.8,"NM",0)
^9.68A^9^9
"BLD",9056,"KRN",9.8,"NM",1,0)
RMPOLZ^^0^B62508122
"BLD",9056,"KRN",9.8,"NM",2,0)
RMPOBIL0^^0^B45113783
"BLD",9056,"KRN",9.8,"NM",3,0)
RMPORLP^^0^B13970436
"BLD",9056,"KRN",9.8,"NM",4,0)
RMPORAP^^0^B6490888
"BLD",9056,"KRN",9.8,"NM",5,0)
RMPORIP^^0^B14014372
"BLD",9056,"KRN",9.8,"NM",6,0)
RMPORMB^^0^B39988003
"BLD",9056,"KRN",9.8,"NM",7,0)
RMPORPR^^0^B24121642
"BLD",9056,"KRN",9.8,"NM",8,0)
RMPORPD^^0^B12309579
"BLD",9056,"KRN",9.8,"NM",9,0)
RMPROPN1^^0^B10807707
"BLD",9056,"KRN",9.8,"NM","B","RMPOBIL0",2)

"BLD",9056,"KRN",9.8,"NM","B","RMPOLZ",1)

"BLD",9056,"KRN",9.8,"NM","B","RMPORAP",4)

"BLD",9056,"KRN",9.8,"NM","B","RMPORIP",5)

"BLD",9056,"KRN",9.8,"NM","B","RMPORLP",3)

"BLD",9056,"KRN",9.8,"NM","B","RMPORMB",6)

"BLD",9056,"KRN",9.8,"NM","B","RMPORPD",8)

"BLD",9056,"KRN",9.8,"NM","B","RMPORPR",7)

"BLD",9056,"KRN",9.8,"NM","B","RMPROPN1",9)

"BLD",9056,"KRN",19,0)
19
"BLD",9056,"KRN",19.1,0)
19.1
"BLD",9056,"KRN",101,0)
101
"BLD",9056,"KRN",409.61,0)
409.61
"BLD",9056,"KRN",771,0)
771
"BLD",9056,"KRN",779.2,0)
779.2
"BLD",9056,"KRN",870,0)
870
"BLD",9056,"KRN",8989.51,0)
8989.51
"BLD",9056,"KRN",8989.52,0)
8989.52
"BLD",9056,"KRN",8994,0)
8994
"BLD",9056,"KRN","B",.4,.4)

"BLD",9056,"KRN","B",.401,.401)

"BLD",9056,"KRN","B",.402,.402)

"BLD",9056,"KRN","B",.403,.403)

"BLD",9056,"KRN","B",.5,.5)

"BLD",9056,"KRN","B",.84,.84)

"BLD",9056,"KRN","B",3.6,3.6)

"BLD",9056,"KRN","B",3.8,3.8)

"BLD",9056,"KRN","B",9.2,9.2)

"BLD",9056,"KRN","B",9.8,9.8)

"BLD",9056,"KRN","B",19,19)

"BLD",9056,"KRN","B",19.1,19.1)

"BLD",9056,"KRN","B",101,101)

"BLD",9056,"KRN","B",409.61,409.61)

"BLD",9056,"KRN","B",771,771)

"BLD",9056,"KRN","B",779.2,779.2)

"BLD",9056,"KRN","B",870,870)

"BLD",9056,"KRN","B",8989.51,8989.51)

"BLD",9056,"KRN","B",8989.52,8989.52)

"BLD",9056,"KRN","B",8994,8994)

"BLD",9056,"QDEF")
^^^^NO^^^^NO^^YES
"BLD",9056,"QUES",0)
^9.62^^
"BLD",9056,"REQB",0)
^9.611^3^3
"BLD",9056,"REQB",1,0)
RMPR*3.0*147^2
"BLD",9056,"REQB",2,0)
RMPR*3.0*159^2
"BLD",9056,"REQB",3,0)
RMPR*3.0*77^2
"BLD",9056,"REQB","B","RMPR*3.0*147",1)

"BLD",9056,"REQB","B","RMPR*3.0*159",2)

"BLD",9056,"REQB","B","RMPR*3.0*77",3)

"KRN",.4,2695,-1)
0^1
"KRN",.4,2695,0)
RMPO-RPT-HOACTZIPLIST^3150519.0705^@^665^^@^3150713
"KRN",.4,2695,"DXS",1,9.2)
S DIP(101)=$S($D(^DPT(D0,.11)):^(.11),1:"") S X=$$EXTERNAL^DIDU(2,.1112,"",$P(DIP(101),U,12))="",DIP(102)=$G(X) S X="No zip code",DIP(103)=$G(X) S X=1
"KRN",.4,2695,"DXS",2,9.2)
S DIP(101)=$S($D(^DPT(D0,.35)):^(.35),1:"") S X=$P(DIP(101),U,1),DIP(102)=$G(X) S X="Z1"
"KRN",.4,2695,"DXS",3,9.2)
S DIP(201)=$S($D(^DIC(5,D0,0)):^(0),1:"") S X=$P(DIP(201),U,2)="",DIP(202)=$G(X) S X="",DIP(203)=$G(X) S X=1,DIP(204)=$G(X) S X=" ,"_$P(DIP(201),U,2)
"KRN",.4,2695,"F",1)
-2,^DPT(^^S I(0,0)=D0 S DIP(1)=$S($D(^RMPR(665,D0,0)):^(0),1:"") S X=$P(DIP(1),U,1),X=X  S D(0)=+X;Z;"`.01:"~
"KRN",.4,2695,"F",2)
-2,N DIERR X DXS(1,9.2) S DIP(104)=$G(X) S X=$$EXTERNAL^DIDU(2,.1112,"",$P(DIP(101),U,12)),X=$S(DIP(102):DIP(103),DIP(104):X) W X K DIP;S1;L10;"Zip Code";Z;"$S(ZIP+4="":"No zip code",1:ZIP+4)"~
"KRN",.4,2695,"F",3)
-2,.01;C13;L22;"Name/Phone Number"~
"KRN",.4,2695,"F",4)
-2,X DXS(2,9.2) S X1=DIP(102) S:X]""&(X?.ANP)&(X1'[U)&(X1'["$C(94)") DIPA($E(X,1,30))=X1 S X="" W X K DIP;X;Z;"SETPARAM((#.351),"Z1")"~
"KRN",.4,2695,"F",5)
-2,S X=$S($L($G(DIPA("Z1")))>0:"*",1:" ") W X;X;C36;Z;"S X=$S($L($G(DIPA("Z1")))>0:"*",1:" ") W X"~
"KRN",.4,2695,"F",6)
-2,S DIP(101)=$S($D(^DPT(D0,0)):^(0),1:"") S X=$P(DIP(101),U,9),DIP(102)=$G(X) S X=6,DIP(103)=$G(X) S X=9,X=$E(DIP(102),DIP(103),X) W X K DIP;"SSN";C37;L4;Z;"$E(SOCIAL SECURITY NUMBER,6,9)"~
"KRN",.4,2695,"F",7)
-2,.111;C45;L30;"Address"~-2,.131;C13;X~-2,.112;C45;L30;X~-2,.114;C45;X~
"KRN",.4,2695,"F",8)
-2,-5,^DIC(5,^^S I(100,0)=D0 S DIP(101)=$S($D(^DPT(D0,.11)):^(.11),1:"") S X=$P(DIP(101),U,5),X=X  S D(0)=+X;Z;".115:"~
"KRN",.4,2695,"F",9)
-2,-5,X DXS(3,9.2) S X=$S(DIP(202):DIP(203),DIP(204):X) W X K DIP;X;Z;"$S(ABBREVIATION="":"",1:" ,"_ABBREVIATION)"~
"KRN",.4,2695,"H")
ACTIVE HOME OXYGEN PATIENT BY ZIP CODE
"MBREQ")
0
"ORD",5,.4)
.4;5;;;EDEOUT^DIFROMSO(.4,DA,"",XPDA);FPRE^DIFROMSI(.4,"",XPDA);EPRE^DIFROMSI(.4,DA,$E("N",$G(XPDNEW)),XPDA,"",OLDA);;EPOST^DIFROMSI(.4,DA,"",XPDA);DEL^DIFROMSK(.4,"",%)
"ORD",5,.4,0)
PRINT TEMPLATE
"PKG",101,-1)
1^1
"PKG",101,0)
PROSTHETICS^RMPR^PROSTHETICS VERSION 3.0 ALPHA
"PKG",101,20,0)
^9.402P^^0
"PKG",101,22,0)
^9.49I^1^1
"PKG",101,22,1,0)
3.0^2960209^2960214
"PKG",101,22,1,"PAH",1,0)
179^3150713
"PKG",101,22,1,"PAH",1,1,0)
^^8^8^3150713
"PKG",101,22,1,"PAH",1,1,1,0)
1. Home Oxygen Generate Letters option has site and prescription
"PKG",101,22,1,"PAH",1,1,2,0)
   expiration date issues. 
"PKG",101,22,1,"PAH",1,1,3,0)
                                                                
"PKG",101,22,1,"PAH",1,1,4,0)
2. Home Oxygen Billing and Home Oxygen Reporting has no check/flag for
"PKG",101,22,1,"PAH",1,1,5,0)
   deceased patients. 
"PKG",101,22,1,"PAH",1,1,6,0)
 
"PKG",101,22,1,"PAH",1,1,7,0)
3. Insure work file is killed when running option 'LIST OPEN STOCK 
"PKG",101,22,1,"PAH",1,1,8,0)
   ISSUES'.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
9
"RTN","RMPOBIL0")
0^2^B45113783^B41799915
"RTN","RMPOBIL0",1,0)
RMPOBIL0 ;EDS/MDB/HINES CIOFO/HNC - HOME OXYGEN BILLING TRANSACTIONS ;7/24/98  07:34
"RTN","RMPOBIL0",2,0)
 ;;3.0;PROSTHETICS;**29,46,50,147,179**;Feb 09, 1996;Build 7
"RTN","RMPOBIL0",3,0)
 ;
"RTN","RMPOBIL0",4,0)
 ; ODJ - patch 50 - 7/25/00 fix DIR date call in PREBILL sub. so as to
"RTN","RMPOBIL0",5,0)
 ;                          interpret 2 digit entry as month
"RTN","RMPOBIL0",6,0)
 ;                          (FM interpets this as year)
"RTN","RMPOBIL0",7,0)
 ;
"RTN","RMPOBIL0",8,0)
 ;RMPR*3.0*179 Added check for Deceased Date less than billing month
"RTN","RMPOBIL0",9,0)
 ;             begin date, error -9 and skips patient billing
"RTN","RMPOBIL0",10,0)
 ;
"RTN","RMPOBIL0",11,0)
OLD ; Enter from top (OLD code)
"RTN","RMPOBIL0",12,0)
 ;
"RTN","RMPOBIL0",13,0)
 D MAIN  ; D ^RMPOBIL1
"RTN","RMPOBIL0",14,0)
 ;Q:'$D(RMPODATE)!'$D(RMPOVDR)!'$D(RMPOXITE)!QUIT
"RTN","RMPOBIL0",15,0)
 I '$D(RMPODATE)!'$D(RMPOVDR)!'$D(RMPOXITE)!QUIT D EXIT Q
"RTN","RMPOBIL0",16,0)
 K DIC,DIR,DIR,DD,DA,DR,DO  ;CLEANUP FOR L/M
"RTN","RMPOBIL0",17,0)
 D EN^RMPOLM  ; -- List manager code
"RTN","RMPOBIL0",18,0)
 D ACCEPT^RMPOPST3,EXIT
"RTN","RMPOBIL0",19,0)
 Q
"RTN","RMPOBIL0",20,0)
MAIN ; Proper entry point
"RTN","RMPOBIL0",21,0)
 D HOME^%ZIS
"RTN","RMPOBIL0",22,0)
 S QUIT=0
"RTN","RMPOBIL0",23,0)
 D HOSITE^RMPOUTL0 Q:('$D(RMPOXITE))!QUIT
"RTN","RMPOBIL0",24,0)
 D CKSITE
"RTN","RMPOBIL0",25,0)
 D MONTH("AEQLMZ") Q:$D(RMPODATE)=0!QUIT
"RTN","RMPOBIL0",26,0)
 D VENDOR("AEQLMZ") Q:$D(RMPOVDR)=0!QUIT
"RTN","RMPOBIL0",27,0)
 ;Generate Vendor/Month of transactions
"RTN","RMPOBIL0",28,0)
 I $O(^RMPO(665.72,RMPOXITE,1,RMPORVDT,1,RMPOVDR,0))="V" Q
"RTN","RMPOBIL0",29,0)
 D GEN1
"RTN","RMPOBIL0",30,0)
 Q
"RTN","RMPOBIL0",31,0)
VENDOR(LAYGO) ;Select Vendor
"RTN","RMPOBIL0",32,0)
 ;
"RTN","RMPOBIL0",33,0)
 K DIC,DA,RMPOVDR
"RTN","RMPOBIL0",34,0)
 S DA(2)=RMPOXITE,DA(1)=RMPORVDT
"RTN","RMPOBIL0",35,0)
 S DIC="^RMPO(665.72,"_DA(2)_",1,"_DA(1)_",1,"
"RTN","RMPOBIL0",36,0)
 S DIC("P")=$P(^DD(665.723,1,0),U,2)
"RTN","RMPOBIL0",37,0)
 S DIC(0)=$G(LAYGO,"AEQMZ") D ^DIC Q:(Y<0)!$$QUIT
"RTN","RMPOBIL0",38,0)
 S RMPOVDR=+Y
"RTN","RMPOBIL0",39,0)
 ;S RMPOVDR=$P(Y,U,2)  ; PER ANALYST
"RTN","RMPOBIL0",40,0)
 I $P(Y,U,3)>0 D
"RTN","RMPOBIL0",41,0)
 . S DIE=DIC,DA=+Y,DR="1///NOW" D ^DIE
"RTN","RMPOBIL0",42,0)
 Q
"RTN","RMPOBIL0",43,0)
CKSITE ;Set up Site in Billing if it is not there
"RTN","RMPOBIL0",44,0)
 I '$D(^RMPO(665.72,RMPOXITE,0)) D
"RTN","RMPOBIL0",45,0)
 . K DIC,DD,DO,DA
"RTN","RMPOBIL0",46,0)
 . S (DINUM,X)=RMPOXITE,DIC="^RMPO(665.72,",DIC(0)="L" D FILE^DICN
"RTN","RMPOBIL0",47,0)
 Q
"RTN","RMPOBIL0",48,0)
MONTH(LAYGO) ;Determine Billing Month
"RTN","RMPOBIL0",49,0)
 ;
"RTN","RMPOBIL0",50,0)
 K DIC,DA,RMPODATE
"RTN","RMPOBIL0",51,0)
 S DA(1)=RMPOXITE,DIC="^RMPO(665.72,"_DA(1)_",1,"
"RTN","RMPOBIL0",52,0)
 S DIC("P")=$P(^DD(665.72,1,0),U,2)
"RTN","RMPOBIL0",53,0)
 S DIC(0)=$G(LAYGO,"AEMQZ") D ^DIC Q:(Y<0)!$$QUIT
"RTN","RMPOBIL0",54,0)
 S RMPODATE=+Y,RMPOMTH=Y(0,0)
"RTN","RMPOBIL0",55,0)
 S RMPORVDT=RMPODATE
"RTN","RMPOBIL0",56,0)
 Q
"RTN","RMPOBIL0",57,0)
QUIT() S QUIT=$D(DTOUT)!$D(DUOUT)!$D(DIROUT) Q QUIT
"RTN","RMPOBIL0",58,0)
 ;
"RTN","RMPOBIL0",59,0)
BUILDM ; BUILD MONTH
"RTN","RMPOBIL0",60,0)
 ; Set up Month
"RTN","RMPOBIL0",61,0)
 Q:$D(^RMPO(665.72,RMPOXITE,1,RMPORVDT))  ; ALREADY DONE..
"RTN","RMPOBIL0",62,0)
 K DIC,DA
"RTN","RMPOBIL0",63,0)
 S X=RMPODATE,DINUM=RMPORVDT
"RTN","RMPOBIL0",64,0)
 S DA(1)=RMPOXITE,DIC(0)="L"
"RTN","RMPOBIL0",65,0)
 S DIC="^RMPO(665.72,"_DA(1)_",1,",DIC("P")=$P(^DD(665.72,1,0),U,2)
"RTN","RMPOBIL0",66,0)
 D FILE^DICN
"RTN","RMPOBIL0",67,0)
 Q
"RTN","RMPOBIL0",68,0)
GEN1 ; ALL PATIENTS FOR A GIVEN VENDOR
"RTN","RMPOBIL0",69,0)
 W !,"Generating "_RMPOMTH_" billing transactions for "
"RTN","RMPOBIL0",70,0)
 W $$VDRNM^RMPOPED(RMPOVDR),!!,"This may take a while..."
"RTN","RMPOBIL0",71,0)
 ;
"RTN","RMPOBIL0",72,0)
 ; D BUILDM
"RTN","RMPOBIL0",73,0)
 ;Copy Patient Boiler-plates
"RTN","RMPOBIL0",74,0)
 ;fix to get ALL patients from same activation date
"RTN","RMPOBIL0",75,0)
 S (ACTIVDT,RMPODFN)=0
"RTN","RMPOBIL0",76,0)
 F  S ACTIVDT=$O(^RMPR(665,"AHO",ACTIVDT)) Q:ACTIVDT'>0  D
"RTN","RMPOBIL0",77,0)
 . S RMPODFN=0
"RTN","RMPOBIL0",78,0)
 . F  S RMPODFN=$O(^RMPR(665,"AHO",ACTIVDT,RMPODFN)) Q:RMPODFN'>0  D:$$OK2BLD>0 GEN2
"RTN","RMPOBIL0",79,0)
 K DIR S DIR(0)="E" D ^DIR Q:$$QUIT
"RTN","RMPOBIL0",80,0)
 Q
"RTN","RMPOBIL0",81,0)
GEN2 ;INNER LOOP
"RTN","RMPOBIL0",82,0)
 ;W !,RMPODFN
"RTN","RMPOBIL0",83,0)
 S ZXITM=0
"RTN","RMPOBIL0",84,0)
 F  S ZXITM=$O(^RMPR(665,RMPODFN,"RMPOC",ZXITM)) Q:ZXITM'>0  D
"RTN","RMPOBIL0",85,0)
 . S ZX1=$G(^RMPR(665,RMPODFN,"RMPOC",ZXITM,0))
"RTN","RMPOBIL0",86,0)
 . Q:$P(ZX1,U,2)'=RMPOVDR
"RTN","RMPOBIL0",87,0)
 . D BUILDP,BUILDI
"RTN","RMPOBIL0",88,0)
 Q
"RTN","RMPOBIL0",89,0)
OK2BLD(VENDOR) ; Determine whether to include trx for RMPODFN
"RTN","RMPOBIL0",90,0)
 ;
"RTN","RMPOBIL0",91,0)
 ; Do NOT process if not at correct site.
"RTN","RMPOBIL0",92,0)
 Q:$P($G(^RMPR(665,RMPODFN,"RMPOA")),U,7)'=RMPOXITE -1
"RTN","RMPOBIL0",93,0)
 ;
"RTN","RMPOBIL0",94,0)
 ; Do NOT process if no Boiler-plate
"RTN","RMPOBIL0",95,0)
 Q:'$D(^RMPR(665,RMPODFN,"RMPOA")) -2
"RTN","RMPOBIL0",96,0)
 ;
"RTN","RMPOBIL0",97,0)
 ; Do NOT process if Inactivation date less the billing date.
"RTN","RMPOBIL0",98,0)
 S RMPOINDT=$P($G(^RMPR(665,RMPODFN,"RMPOA")),U,3)
"RTN","RMPOBIL0",99,0)
 I $G(RMPOINDT) Q:RMPOINDT<RMPODATE -3
"RTN","RMPOBIL0",100,0)
 ;Q:$P($G(^RMPR(665,RMPODFN,"RMPOA")),U,3) -3
"RTN","RMPOBIL0",101,0)
 ;
"RTN","RMPOBIL0",102,0)
 ; Do NOT process if Deceased date less the billing date.   ;RMPR*3.0*179 Skip a deceased patient. ^DPT(D0,.35) direct read supported by ICR #10035
"RTN","RMPOBIL0",103,0)
 S RMPOINDT=+$G(^DPT(RMPODFN,.35))
"RTN","RMPOBIL0",104,0)
 I $G(RMPOINDT) Q:RMPOINDT<RMPODATE -9
"RTN","RMPOBIL0",105,0)
 ;
"RTN","RMPOBIL0",106,0)
 ; Do NOT process if no Rx
"RTN","RMPOBIL0",107,0)
 Q:'$D(^RMPR(665,RMPODFN,"RMPOB",0)) -4
"RTN","RMPOBIL0",108,0)
 ;
"RTN","RMPOBIL0",109,0)
 ; 1st find correct Rx
"RTN","RMPOBIL0",110,0)
 S RMPORX=$O(^RMPR(665,RMPODFN,"RMPOB","B"),-1)
"RTN","RMPOBIL0",111,0)
 Q:'RMPORX -5
"RTN","RMPOBIL0",112,0)
 ;
"RTN","RMPOBIL0",113,0)
 ; Quit if the Rx Expiration Date is before the billing period
"RTN","RMPOBIL0",114,0)
 ; Expiration date check removed with patch *147  6/24/2008
"RTN","RMPOBIL0",115,0)
 ;Q:$P(^RMPR(665,RMPODFN,"RMPOB",RMPORX,0),U,3)<(RMPODATE) -6
"RTN","RMPOBIL0",116,0)
 ;
"RTN","RMPOBIL0",117,0)
 ; Quit if there are no items.
"RTN","RMPOBIL0",118,0)
 Q:$O(^RMPR(665,RMPODFN,"RMPOC",0))'>0 -7
"RTN","RMPOBIL0",119,0)
 ;
"RTN","RMPOBIL0",120,0)
 I $G(VENDOR)>0 Q $$VDRSTAT(VENDOR)
"RTN","RMPOBIL0",121,0)
 Q 1
"RTN","RMPOBIL0",122,0)
VDRSTAT(VDR) ;
"RTN","RMPOBIL0",123,0)
 ;
"RTN","RMPOBIL0",124,0)
 S ZXITM=0,FOUND=0
"RTN","RMPOBIL0",125,0)
 F  S ZXITM=$O(^RMPR(665,RMPODFN,"RMPOC",ZXITM)) Q:ZXITM'>0  D
"RTN","RMPOBIL0",126,0)
 . I $P($G(^RMPR(665,RMPODFN,"RMPOC",ZXITM,0)),U,2)=VDR S FOUND=1
"RTN","RMPOBIL0",127,0)
 Q $S(FOUND=1:1,1:-8)
"RTN","RMPOBIL0",128,0)
 Q
"RTN","RMPOBIL0",129,0)
BUILDV ; Set up the VENDOR multiple
"RTN","RMPOBIL0",130,0)
 Q:$D(^RMPO(665.72,RMPOXITE,1,RMPORVDT,1,RMPOVDR))  ; ALREADY DONE...
"RTN","RMPOBIL0",131,0)
 K DA,DIC,DD,DO
"RTN","RMPOBIL0",132,0)
 S DA(2)=RMPOXITE,DA(1)=RMPORVDT,(DINUM,X)=RMPOVDR
"RTN","RMPOBIL0",133,0)
 S DIC="^RMPO(665.72,"_DA(2)_",1,"_DA(1)_",1,"
"RTN","RMPOBIL0",134,0)
 S DIC("P")=$P(^DD(665.723,1,0),U,2),DIC(0)="L"
"RTN","RMPOBIL0",135,0)
 D FILE^DICN
"RTN","RMPOBIL0",136,0)
 Q
"RTN","RMPOBIL0",137,0)
BUILDP ;Now the Patient level
"RTN","RMPOBIL0",138,0)
 Q:$D(^RMPO(665.72,RMPOXITE,1,RMPORVDT,1,RMPOVDR,"V",RMPODFN))  ; DONE
"RTN","RMPOBIL0",139,0)
 K DA,DIC,DD,DO
"RTN","RMPOBIL0",140,0)
 S DA(3)=RMPOXITE,DA(2)=RMPORVDT,DA(1)=RMPOVDR,(DINUM,X)=RMPODFN
"RTN","RMPOBIL0",141,0)
 S DIC("P")=$P(^DD(665.7231,9,0),U,2),DIC(0)="L",ZV=",""V"","
"RTN","RMPOBIL0",142,0)
 S DIC="^RMPO(665.72,"_DA(3)_",1,"_DA(2)_",1,"_DA(1)_ZV
"RTN","RMPOBIL0",143,0)
 D FILE^DICN
"RTN","RMPOBIL0",144,0)
 Q
"RTN","RMPOBIL0",145,0)
 ;
"RTN","RMPOBIL0",146,0)
BUILDI ; BUILD ITEM (REQUIRES ZX1 = ENTIRE ITEM NODE FROM FILE #665)
"RTN","RMPOBIL0",147,0)
 ;Finally, set up the item multiple
"RTN","RMPOBIL0",148,0)
 K DA,DIC,DD,DO,DINUM,DIE,DR
"RTN","RMPOBIL0",149,0)
 S DA(4)=RMPOXITE,DA(3)=RMPORVDT,DA(2)=RMPOVDR,DA(1)=RMPODFN
"RTN","RMPOBIL0",150,0)
 S X=$P(ZX1,U),ZV=",""V"","
"RTN","RMPOBIL0",151,0)
 S DIC="^RMPO(665.72,"_DA(4)_",1,"_DA(3)_",1,"_DA(2)_ZV_DA(1)_",1,"
"RTN","RMPOBIL0",152,0)
 S DIC("P")=$P(^DD(665.72319,1,0),U,2),DIC(0)="L"
"RTN","RMPOBIL0",153,0)
 D FILE^DICN
"RTN","RMPOBIL0",154,0)
 S DIE=DIC,DA=+Y
"RTN","RMPOBIL0",155,0)
 ;Do some calculations
"RTN","RMPOBIL0",156,0)
 ;Multiply the unit cost by the number of units
"RTN","RMPOBIL0",157,0)
 S RMPOTOT=$P(ZX1,U,3)*$P(ZX1,U,4)
"RTN","RMPOBIL0",158,0)
 S RMREMARK=$P(ZX1,U,9)
"RTN","RMPOBIL0",159,0)
 S DR="1////"_$P(ZX1,U,11)             ; PRIMARY ITEM
"RTN","RMPOBIL0",160,0)
 S DR=DR_";2////"_$P(ZX1,U,7)          ; HCPCS CODE
"RTN","RMPOBIL0",161,0)
 S DR=DR_";3////"_$P(ZX1,U,6)          ; FUND CONTROL POINT
"RTN","RMPOBIL0",162,0)
 S DR=DR_";4///^S X=RMREMARK"          ; REMARKS
"RTN","RMPOBIL0",163,0)
 S DR=DR_";5///"_$P(ZX1,U,4)           ; UNIT COST
"RTN","RMPOBIL0",164,0)
 S DR=DR_";6///"_$J($G(RMPOTOT),1,2)   ; TOTAL (QTY X UNIT COST)
"RTN","RMPOBIL0",165,0)
 S DR=DR_";7///"_$P(ZX1,U,3)           ; QUANTITY
"RTN","RMPOBIL0",166,0)
 S DR=DR_";9////"_$P(ZX1,U,8)          ; ICD-9 CODE
"RTN","RMPOBIL0",167,0)
 S DR=DR_";12////"_ZXITM               ; IEN OF ITEM
"RTN","RMPOBIL0",168,0)
 S DR=DR_";13////"_$P(ZX1,U,10)        ; ITEM TYPE
"RTN","RMPOBIL0",169,0)
 S DR=DR_";14////"_$P(ZX1,U,5)         ; UNIT OF ISSUE
"RTN","RMPOBIL0",170,0)
 D ^DIE
"RTN","RMPOBIL0",171,0)
 Q
"RTN","RMPOBIL0",172,0)
PREBILL ; Proper entry point
"RTN","RMPOBIL0",173,0)
 D HOME^%ZIS
"RTN","RMPOBIL0",174,0)
 S (RMEND,RMPOPRT,QUIT)=0
"RTN","RMPOBIL0",175,0)
 D HOSITE^RMPOUTL0 Q:('$D(RMPOXITE))!QUIT
"RTN","RMPOBIL0",176,0)
 D  Q:$D(RMPODATE)=0!QUIT
"RTN","RMPOBIL0",177,0)
 . K DIR,RMPODATE
"RTN","RMPOBIL0",178,0)
 . S DIR(0)="D^^I +X>0,+X'>12 S X=$E(100+X,2,3)_$E(DT,2,3) K Y,%DT D ^%DT"
"RTN","RMPOBIL0",179,0)
 . ;S DIR(0)="D"
"RTN","RMPOBIL0",180,0)
 . S DIR("A")="ENTER BILLING MONTH"
"RTN","RMPOBIL0",181,0)
 . D ^DIR Q:$$QUIT!(Y<1)
"RTN","RMPOBIL0",182,0)
 . S RMPODATE=$E(Y,1,5)_"00"
"RTN","RMPOBIL0",183,0)
 . I Y X ^DD("DD") W ?25,Y
"RTN","RMPOBIL0",184,0)
 . Q
"RTN","RMPOBIL0",185,0)
 S DIC="^RMPR(665,",L=0
"RTN","RMPOBIL0",186,0)
 S BY="[RMPO-BILLING-PRESORT]"
"RTN","RMPOBIL0",187,0)
 S FLDS="[RMPO-BILLING-PRESORT]"
"RTN","RMPOBIL0",188,0)
 S DIS(0)="S RMPODFN=D0,Z=$$OK2BLD^RMPOBIL0 I $D(^RMPR(665,RMPODFN,""RMPOA"")) I (Z'=1)&(Z'=-3)&($P(^RMPR(665,RMPODFN,""RMPOA""),U,7)=RMPOXITE)"
"RTN","RMPOBIL0",189,0)
 S DIOEND="I $G(Y)'[U S RMEND=1 S:IOST[""P-"" RMPOPRT=1"
"RTN","RMPOBIL0",190,0)
 D EN1^DIP
"RTN","RMPOBIL0",191,0)
 I RMPOPRT=0,$G(RMEND) K DIR S DIR(0)="E" D ^DIR
"RTN","RMPOBIL0",192,0)
 D EXIT
"RTN","RMPOBIL0",193,0)
 Q
"RTN","RMPOBIL0",194,0)
BLDSTAT(RMPODFN) ;STATUS OF PT FOR GIVEN BUILD
"RTN","RMPOBIL0",195,0)
 ;
"RTN","RMPOBIL0",196,0)
 S OK=$$OK2BLD($G(RMPOVDR))
"RTN","RMPOBIL0",197,0)
 Q:OK=1 "OK"
"RTN","RMPOBIL0",198,0)
 Q:OK=-1 "Different Home Oxygen Contract Location"
"RTN","RMPOBIL0",199,0)
 Q:OK=-2 "No Home Oxygen Information"
"RTN","RMPOBIL0",200,0)
 Q:OK=-3 "Deactivated"
"RTN","RMPOBIL0",201,0)
 Q:OK=-4 "No RX on file"
"RTN","RMPOBIL0",202,0)
 Q:OK=-5 "No RX on file"
"RTN","RMPOBIL0",203,0)
 Q:OK=-6 "RX expires prior to billing period"
"RTN","RMPOBIL0",204,0)
 Q:OK=-7 "No items on file"
"RTN","RMPOBIL0",205,0)
 Q:OK=-8 "No items for vendor"
"RTN","RMPOBIL0",206,0)
 Q:OK=-9 "Patient deceased, not inactivated"    ;RMPR*3.0*179
"RTN","RMPOBIL0",207,0)
 Q "Other Unknown Error"
"RTN","RMPOBIL0",208,0)
 Q
"RTN","RMPOBIL0",209,0)
EXIT ;Kill variables before quitting
"RTN","RMPOBIL0",210,0)
 N RMPR,RMPRSITE D KILL^XUSCLEAN
"RTN","RMPOBIL0",211,0)
 Q
"RTN","RMPOLZ")
0^1^B62508122^B59718997
"RTN","RMPOLZ",1,0)
RMPOLZ ;EDS/PAK - HOME OXYGEN LETTERS ;7/24/98
"RTN","RMPOLZ",2,0)
 ;;3.0;PROSTHETICS;**29,44,46,55,179**;Feb 09, 1996;Build 7
"RTN","RMPOLZ",3,0)
 ;
"RTN","RMPOLZ",4,0)
 ; ODJ - patch 55 - Ensure we only include prescriptions which are
"RTN","RMPOLZ",5,0)
 ;                  due to expire after the number of days set up
"RTN","RMPOLZ",6,0)
 ;                  in site params. cf nois UNY-1000-11685
"RTN","RMPOLZ",7,0)
 ;
"RTN","RMPOLZ",8,0)
 ; RMPR*3.0*179 - Modify station check to use internal station ien found in node
"RTN","RMPOLZ",9,0)
 ;                ^RMPR(665,RMPODFN,"RMPOA"), PIECE 7.  Also, mimic include check
"RTN","RMPOLZ",10,0)
 ;                for original list to be same as new list, by reverse ordering 
"RTN","RMPOLZ",11,0)
 ;                script lookup so check goes from newest back to oldest scripts.
"RTN","RMPOLZ",12,0)
 ;
"RTN","RMPOLZ",13,0)
FORGD ; Foreground processing of list
"RTN","RMPOLZ",14,0)
 N JOB,TRXS,LTRX,SITE,LST
"RTN","RMPOLZ",15,0)
 K ^TMP($J)
"RTN","RMPOLZ",16,0)
 S JOB=0  ; foreground flag set
"RTN","RMPOLZ",17,0)
 ; get site
"RTN","RMPOLZ",18,0)
 Q:'$$SITE^RMPOLZA("")
"RTN","RMPOLZ",19,0)
 ; get lock on ^TMP("RMPO",$J,RMPOXITE,"LETTERPRINT")
"RTN","RMPOLZ",20,0)
 Q:'$$LOCK^RMPOLZA
"RTN","RMPOLZ",21,0)
 ; get list parameters
"RTN","RMPOLZ",22,0)
 D LST^RMPOLZC I 'LST K ^TMP("VALM VIDEO",$J) Q
"RTN","RMPOLZ",23,0)
 I (LST=1),(RL=2) D PURGE^RMPOLZC
"RTN","RMPOLZ",24,0)
 D GNLST
"RTN","RMPOLZ",25,0)
 ; Listman control module
"RTN","RMPOLZ",26,0)
 N QT,LSTN
"RTN","RMPOLZ",27,0)
 S QT=0 F  D  Q:QT
"RTN","RMPOLZ",28,0)
 . S RMPOLCD=""  ; clear letter type code
"RTN","RMPOLZ",29,0)
 . ; call "RMPO Letter Type" list to select letter type
"RTN","RMPOLZ",30,0)
 . D EN^RMPOLY
"RTN","RMPOLZ",31,0)
 . I RMPOLCD="" S QT=1 Q  ; quit if no letter type is selected
"RTN","RMPOLZ",32,0)
 . Q:$G(QT)=1
"RTN","RMPOLZ",33,0)
 . S ^TMP($J,RMPOXITE,"EXIT")=0  ; clear exit to menu flag
"RTN","RMPOLZ",34,0)
 . ; call "RMPO Letter" list to manage list and print letters
"RTN","RMPOLZ",35,0)
 . ;D EN^RMPOLT
"RTN","RMPOLZ",36,0)
 . S QT=^TMP($J,RMPOXITE,"EXIT")  ; quit to menu if user requests exit
"RTN","RMPOLZ",37,0)
 L -^TMP("RMPO",$J,RMPOXITE,"LETTERPRINT") D EXIT
"RTN","RMPOLZ",38,0)
 Q
"RTN","RMPOLZ",39,0)
 ;
"RTN","RMPOLZ",40,0)
BCKGD ; Background processing of list
"RTN","RMPOLZ",41,0)
 N JOB,TRXS,LTRX,SITE
"RTN","RMPOLZ",42,0)
 S JOB=1  ; background flag set
"RTN","RMPOLZ",43,0)
 S RMPOXITE=0 F  S RMPOXITE=$O(^RMPR(669.9,RMPOXITE)) Q:RMPOXITE<1  D
"RTN","RMPOLZ",44,0)
 . Q:'$$SITE^RMPOLZA(RMPOXITE) 
"RTN","RMPOLZ",45,0)
 . Q:'$$LOCK^RMPOLZA
"RTN","RMPOLZ",46,0)
 . ; generate list & print letters then clear work file
"RTN","RMPOLZ",47,0)
 . D LST^RMPOLZC D GNLST S RMPOLCD=""
"RTN","RMPOLZ",48,0)
 . F  S RMPOLCD=$O(^TMP($J,RMPOXITE,"RMPOLST",RMPOLCD)) Q:RMPOLCD=""  D ^RMPOLZB
"RTN","RMPOLZ",49,0)
 . K ^TMP($J,RMPOXITE)
"RTN","RMPOLZ",50,0)
 D EXIT
"RTN","RMPOLZ",51,0)
 Q
"RTN","RMPOLZ",52,0)
 ;
"RTN","RMPOLZ",53,0)
EXIT ;
"RTN","RMPOLZ",54,0)
 K ^TMP($J),DTOUT,DUOUT,DIRUT,DIROUT,LTRX,TRXS
"RTN","RMPOLZ",55,0)
 K ANS,DIC,X1,X2,Y,ZTSAVE,POP,X,DFN,VADM,VAPA,%,ANSW,%ZIS
"RTN","RMPOLZ",56,0)
 Q
"RTN","RMPOLZ",57,0)
 ;
"RTN","RMPOLZ",58,0)
GNLST ; generate new or recreate original list
"RTN","RMPOLZ",59,0)
 ; Input: None
"RTN","RMPOLZ",60,0)
 ; Output:
"RTN","RMPOLZ",61,0)
 ;   ^TMP($J,RMPOXITE,"RMPOLST",RMPOLCD,RMPONAM)=RMPOLTR^RMPODFN^RMPO
"RTN","RMPOLZ",62,0)
 D LTRCR^RMPOLZC()  ; generate letter code to prosthetics letter IEN xref
"RTN","RMPOLZ",63,0)
 ; build patient list work file from current list (GENOLST) or
"RTN","RMPOLZ",64,0)
 ; generate new patient letter list work file (GENLST)
"RTN","RMPOLZ",65,0)
 I (LST=1),(RL=2) D NEWLST
"RTN","RMPOLZ",66,0)
 I (LST=2),(RL=2) D ORGLST
"RTN","RMPOLZ",67,0)
 I (LST=1),(RL=0) D ORGLST
"RTN","RMPOLZ",68,0)
 Q
"RTN","RMPOLZ",69,0)
 ;
"RTN","RMPOLZ",70,0)
NEWLST ; generate NEW patient letter list
"RTN","RMPOLZ",71,0)
 N RECA,RECB,ADT,IADT W !,"Generating a new list..."
"RTN","RMPOLZ",72,0)
 I $G(LST) D
"RTN","RMPOLZ",73,0)
 .K ^RMPR(669.9,RMPOXITE,"RMPOXBAT1"),^RMPR(669.9,RMPOXITE,"RMPOXBAT2")
"RTN","RMPOLZ",74,0)
 .K ^RMPR(669.9,RMPOXITE,"RMPOXBAT3")
"RTN","RMPOLZ",75,0)
 .S ^RMPR(669.9,RMPOXITE,"RMPOXBAT1",0)="^669.9002P^^^"
"RTN","RMPOLZ",76,0)
 .S ^RMPR(669.9,RMPOXITE,"RMPOXBAT2",0)="^669.972P^^^"
"RTN","RMPOLZ",77,0)
 .S ^RMPR(669.9,RMPOXITE,"RMPOXBAT3",0)="^669.974P^^^"
"RTN","RMPOLZ",78,0)
 S ADT="" F  S ADT=$O(^RMPR(665,"AHO",ADT)) Q:ADT=""  D
"RTN","RMPOLZ",79,0)
 . S RMPODFN=0 F  S RMPODFN=$O(^RMPR(665,"AHO",ADT,RMPODFN)) Q:RMPODFN<1  D
"RTN","RMPOLZ",80,0)
 . . Q:$P(^RMPR(665,RMPODFN,"RMPOA"),U,7)'=RMPOXITE  ; ignore patient from another station  RMPR*3.0*179
"RTN","RMPOLZ",81,0)
 . . ;Get patient demographic data
"RTN","RMPOLZ",82,0)
 . . S DFN=RMPODFN K VADM D DEM^VADPT Q:$G(VADM(6))
"RTN","RMPOLZ",83,0)
 . . ;Do not collect patient if inactive
"RTN","RMPOLZ",84,0)
 . . S RECA=$G(^RMPR(665,RMPODFN,"RMPOA")),IADT=$P(RECA,U,3) Q:$G(IADT)
"RTN","RMPOLZ",85,0)
 . . D FNDTRX  ; build Xref of transactions (TRX) to letter type
"RTN","RMPOLZ",86,0)
 . . ; get active patient prescription and evaluate letter requirement
"RTN","RMPOLZ",87,0)
 . . S RMPORX=$$RXAC^RMPOLZC(RMPODFN)
"RTN","RMPOLZ",88,0)
 . . Q:'RMPORX
"RTN","RMPOLZ",89,0)
 . . S RECB=$G(^RMPR(665,RMPODFN,"RMPOB",RMPORX,0))
"RTN","RMPOLZ",90,0)
 . . S RMDEXP=$P(RECB,U,3),RMDACT=$P(RECB,U,1)
"RTN","RMPOLZ",91,0)
 . . I $G(LST) D CHECKA
"RTN","RMPOLZ",92,0)
 . . I '$G(LST) D CHECK1
"RTN","RMPOLZ",93,0)
 Q
"RTN","RMPOLZ",94,0)
 ;
"RTN","RMPOLZ",95,0)
ORGLST ; Generate work file using ORIGINAL patient letter list
"RTN","RMPOLZ",96,0)
 N LTRIEN,STA W !,"Generating an original list..."
"RTN","RMPOLZ",97,0)
 F RI="RMPOXBAT1","RMPOXBAT2","RMPOXBAT3" S RMPO=0 F  S RMPO=$O(^RMPR(669.9,RMPOXITE,RI,RMPO)) Q:RMPO'>0  D
"RTN","RMPOLZ",98,0)
 . ;I JOB,'$D(LTRX("B",RMPOLTR)) Q
"RTN","RMPOLZ",99,0)
 . S RMPODFN=$G(^RMPR(669.9,RMPOXITE,RI,RMPO,0))
"RTN","RMPOLZ",100,0)
 . S RECA=$G(^RMPR(665,RMPODFN,"RMPOA")),ADT=$P(RECA,U,2),IADT=$P(RECA,U,3)
"RTN","RMPOLZ",101,0)
 . Q:$G(IADT)
"RTN","RMPOLZ",102,0)
 . S RMPOLCD=$S(RI="RMPOXBAT1":"A",RI="RMPOXBAT2":"B",RI="RMPOXBAT3":"C",1:"") Q:RMPOLCD=""
"RTN","RMPOLZ",103,0)
 . S RMPOLTR=$G(LTRX("C",RMPOLCD)) Q:'$G(RMPOLTR)
"RTN","RMPOLZ",104,0)
 . S STA=$P(^RMPR(665,RMPODFN,"RMPOA"),U,7) Q:STA'=RMPOXITE  ; ignore patients from another station  RMPR*3.0*179
"RTN","RMPOLZ",105,0)
 . D PRTCHK
"RTN","RMPOLZ",106,0)
 . I '$$INCLUDE(RMPODFN,RMPOLCD,.LTRX,RMDPRT,RMFPRT,.RMPORX,.RMDACT) Q  ;(patch 55)
"RTN","RMPOLZ",107,0)
 . S LTRIEN=$O(^RMPR(669.9,RMPOXITE,"RMPOLET","B",RMPOLTR,0))
"RTN","RMPOLZ",108,0)
 . Q:'$D(^DPT(RMPODFN,0))
"RTN","RMPOLZ",109,0)
 . S:$D(^DPT(RMPODFN,0)) RMPONAM=$E($P(^DPT(RMPODFN,0),U,1),1,15)
"RTN","RMPOLZ",110,0)
 . D EXTRCT^RMPOLZA S ^TMP($J,RMPOXITE,"RMPOLST",RMPOLCD,RMPONAM)=RMPOLTR_"^"_RMPODFN_"^"_RMPO
"RTN","RMPOLZ",111,0)
 Q
"RTN","RMPOLZ",112,0)
 ;
"RTN","RMPOLZ",113,0)
FNDTRX ; find letter TRX & hold in local array
"RTN","RMPOLZ",114,0)
 ; output:  ^TMP($J,DFN,H.O. Letter Code,Prosthetics Letter,Transaction Printed Date)
"RTN","RMPOLZ",115,0)
 N TRX S TRX=0 F  S TRX=$O(^RMPR(665.4,"B",RMPODFN,TRX)) Q:TRX=""  D
"RTN","RMPOLZ",116,0)
 . Q:$P(^RMPR(665.4,TRX,0),U,6)'=RMPO("STA")  ; ignore letters from a different station
"RTN","RMPOLZ",117,0)
 . S RMPOLTR=$P(^RMPR(665.4,TRX,0),U,2) Q:'$D(LTRX("B",RMPOLTR))  ; ignore if not a valid H.O. letter transaction
"RTN","RMPOLZ",118,0)
 . S RMPOLCD=LTRX("B",RMPOLTR)  ; get H.O. Letter Code given H.O. Letter #
"RTN","RMPOLZ",119,0)
 . S ^TMP($J,RMPODFN,RMPOLCD,RMPOLTR,$P(^RMPR(665.4,TRX,0),U,3))=""  ; create local array
"RTN","RMPOLZ",120,0)
 Q
"RTN","RMPOLZ",121,0)
 ;
"RTN","RMPOLZ",122,0)
 ; calc. if any patient prescription should get letter (patch 55)
"RTN","RMPOLZ",123,0)
INCLUDE(RMPODFN,RMPOLCD,LTRX,RMDPRT,RMFPRT,RMPORX,RMDACT) ;
"RTN","RMPOLZ",124,0)
 N RMPRINCL,RECB,RMDEXP,RMPOX
"RTN","RMPOLZ",125,0)
 S RMPRINCL=0,RMPOX=0
"RTN","RMPOLZ",126,0)
 S RMPORX=9999
"RTN","RMPOLZ",127,0)
 F  S RMPORX=$O(^RMPR(665,RMPODFN,"RMPOB",RMPORX),-1) Q:'+RMPORX  D  Q:RMPRINCL!RMPOX   ;RMPR*3.0*179
"RTN","RMPOLZ",128,0)
 . S RECB=$G(^RMPR(665,RMPODFN,"RMPOB",RMPORX,0))
"RTN","RMPOLZ",129,0)
 . S RMDEXP=+$P(RECB,U,3) ;prescription expiry date
"RTN","RMPOLZ",130,0)
 . Q:'RMDEXP
"RTN","RMPOLZ",131,0)
 . S RMDACT=$P(RECB,U,1)
"RTN","RMPOLZ",132,0)
 . I RMDEXP>LTRX("D",RMPOLCD) S RMPOX=1 Q  ;expiry after include period
"RTN","RMPOLZ",133,0)
 . Q:RMDEXP<DT  ;expiry before todays date
"RTN","RMPOLZ",134,0)
 . I $G(RMFPRT)'="",(RMDPRT>RMDACT) Q
"RTN","RMPOLZ",135,0)
 . S RMPRINCL=1
"RTN","RMPOLZ",136,0)
 . Q
"RTN","RMPOLZ",137,0)
 Q RMPRINCL
"RTN","RMPOLZ",138,0)
 ;
"RTN","RMPOLZ",139,0)
CHECKA ; check if patient needs all types of letter.
"RTN","RMPOLZ",140,0)
 F RMPOLCD="A","B","C" D
"RTN","RMPOLZ",141,0)
 . S (RMDTE,RMPOLTR)=0,RMPOLTR=$O(LTRX("A",RMPOLCD,RMPOLTR)) Q:'$G(RMPOLTR)
"RTN","RMPOLZ",142,0)
 . S RMDTE=$O(^TMP($J,RMPODFN,RMPOLCD,RMPOLTR,0))
"RTN","RMPOLZ",143,0)
 . I RMPOLCD="B",$D(^RMPR(669.9,RMPOXITE,"RMPOXBAT1","B",RMPODFN)) Q
"RTN","RMPOLZ",144,0)
 . I RMPOLCD="C"&($D(^RMPR(669.9,RMPOXITE,"RMPOXBAT2","B",RMPODFN))!$D(^RMPR(669.9,RMPOXITE,"RMPOXBAT1","B",RMPODFN))) Q
"RTN","RMPOLZ",145,0)
 . D PRTCHK
"RTN","RMPOLZ",146,0)
 . I '$$INCLUDE(RMPODFN,RMPOLCD,.LTRX,RMDPRT,RMFPRT,.RMPORX,.RMDACT) Q  ;(patch 55)
"RTN","RMPOLZ",147,0)
 . I RMDPIEC="",RMFPIEC="" Q
"RTN","RMPOLZ",148,0)
 . Q:RMDTE>RMDACT  Q:'$D(^DPT(RMPODFN,0))
"RTN","RMPOLZ",149,0)
 . S:$D(^DPT(RMPODFN,0)) RMPONAM=$E($P(^DPT(RMPODFN,0),U,1),1,15)
"RTN","RMPOLZ",150,0)
 . S RMCOD=$S(RMPOLCD="A":"RMPOXBAT1",RMPOLCD="B":"RMPOXBAT2",RMPOLCD="C":"RMPOXBAT3",1:"")
"RTN","RMPOLZ",151,0)
 . Q:$D(^RMPR(669.9,RMPOXITE,RMCOD,"B",RMPODFN))
"RTN","RMPOLZ",152,0)
 . K DD,DO S DA(1)=RMPOXITE,DIC="^RMPR(669.9,"_RMPOXITE_","_""""_RMCOD_""""_","
"RTN","RMPOLZ",153,0)
 . S DIC(0)="L",X=RMPODFN,DLAYGO=669.9 D FILE^DICN Q:'$D(DA)  S RMPO=DA K DIC,DA,X
"RTN","RMPOLZ",154,0)
 . D EXTRCT^RMPOLZA S ^TMP($J,RMPOXITE,"RMPOLST",RMPOLCD,RMPONAM)=RMPOLTR_"^"_RMPODFN_"^"_RMPO
"RTN","RMPOLZ",155,0)
 Q
"RTN","RMPOLZ",156,0)
 ;       
"RTN","RMPOLZ",157,0)
CHECK1 ; check if patient needs a letter (only one type of letter).
"RTN","RMPOLZ",158,0)
 S (RMDTE,LST)=0,RMPOLTR=""
"RTN","RMPOLZ",159,0)
 S RMPOLTR=$O(LTRX("A",RMPOLCD,RMPOLTR)) Q:RMPOLTR=""
"RTN","RMPOLZ",160,0)
 S RMDTE=$O(^TMP($J,RMPODFN,RMPOLCD,RMPOLTR,0))
"RTN","RMPOLZ",161,0)
 I ((RMPOLCD="B")&$D(^RMPR(669.9,RMPOXITE,"RMPOXBAT2","B",RMPODFN)))!($P(^RMPR(665,RMPODFN,"RMPOA"),U,9)>RMDACT) Q
"RTN","RMPOLZ",162,0)
 I ((RMPOLCD="C")&$D(^RMPR(669.9,RMPOXITE,"RMPOXBAT3","B",RMPODFN)))!($P(^RMPR(665,RMPODFN,"RMPOA"),U,11)>RMDACT) Q
"RTN","RMPOLZ",163,0)
 D PRTCHK
"RTN","RMPOLZ",164,0)
 I '$$INCLUDE(RMPODFN,RMPOLCD,.LTRX,RMDPRT,RMFPRT,.RMPORX,.RMDACT) Q  ;(patch 55)
"RTN","RMPOLZ",165,0)
 I RMDPIEC="",RMFPIEC="" Q
"RTN","RMPOLZ",166,0)
 Q:RMDTE>RMDACT
"RTN","RMPOLZ",167,0)
 Q:'$D(^DPT(RMPODFN,0))  S:$D(^DPT(RMPODFN,0)) RMPONAM=$E($P(^DPT(RMPODFN,0),U,1),1,15)
"RTN","RMPOLZ",168,0)
 S RMCOD=$S(RMPOLCD="A":"RMPOXBAT1",RMPOLCD="B":"RMPOXBAT2",RMPOLCD="C":"RMPOXBAT3",1:"")
"RTN","RMPOLZ",169,0)
 Q:$D(^RMPR(669.9,RMPOXITE,RMCOD,"B",RMPODFN))
"RTN","RMPOLZ",170,0)
 K DD,DO S DA(1)=RMPOXITE,DIC="^RMPR(669.9,"_RMPOXITE_","_""""_RMCOD_""""_","
"RTN","RMPOLZ",171,0)
 S DIC(0)="L",X=RMPODFN,DLAYGO=669.9 D FILE^DICN Q:'$D(DA)  S RMPO=DA K DIC,DA,X
"RTN","RMPOLZ",172,0)
 D EXTRCT^RMPOLZA S ^TMP($J,RMPOXITE,"RMPOLST",RMPOLCD,RMPONAM)=RMPOLTR_"^"_RMPODFN_"^"_RMPO
"RTN","RMPOLZ",173,0)
 Q
"RTN","RMPOLZ",174,0)
PRTCHK S (RMFPRT,RMDPRT,RMFPIEC,RMDPIEC)=""
"RTN","RMPOLZ",175,0)
 I RMPOLCD="B",$P(RECA,U,10)="" Q
"RTN","RMPOLZ",176,0)
 I RMPOLCD="C",$P(RECA,U,12)="" Q
"RTN","RMPOLZ",177,0)
 S RMDPIEC=$S(RMPOLCD="A":9,RMPOLCD="B":11,RMPOLCD="C":13,1:"")
"RTN","RMPOLZ",178,0)
 S RMFPIEC=$S(RMPOLCD="A":10,RMPOLCD="B":12,RMPOLCD="C":14,1:"")
"RTN","RMPOLZ",179,0)
 S RMFPRT=$P(RECA,U,RMFPIEC),RMDPRT=$P(RECA,U,RMDPIEC)
"RTN","RMPOLZ",180,0)
 Q
"RTN","RMPORAP")
0^4^B6490888^B3404308
"RTN","RMPORAP",1,0)
RMPORAP ;(NG)/DG/CAP - ACTIVE HOME OXY PTS IN ZIP CODE ORDER ;7/24/98
"RTN","RMPORAP",2,0)
 ;;3.0;PROSTHETICS;**29,179**;Feb 09, 1996;Build 7
"RTN","RMPORAP",3,0)
 ;
"RTN","RMPORAP",4,0)
 ;RMPR*3.0*179 Flag a deceased patient by adding an '*'
"RTN","RMPORAP",5,0)
 ;             in front of SSN. 
"RTN","RMPORAP",6,0)
 ;
"RTN","RMPORAP",7,0)
SITE ;Initialize site variables.
"RTN","RMPORAP",8,0)
 D HOSITE^RMPOUTL0 I '$D(RMPOXITE) Q
"RTN","RMPORAP",9,0)
 ;
"RTN","RMPORAP",10,0)
LI ;List sought patients.
"RTN","RMPORAP",11,0)
 N WHO S (WHO,COUNT,RMEND,RMPOPRT,RMPODCNT)=0     ;RMPR*3.0*179
"RTN","RMPORAP",12,0)
 S DIC="^RMPR(665,"
"RTN","RMPORAP",13,0)
 S DIS(0)="I $P($G(^RMPR(665,D0,""RMPOA"")),U,7)=RMPOXITE,$P($G(^RMPR(665,D0,""RMPOA"")),U,3)="""""
"RTN","RMPORAP",14,0)
 S BY="[RMPO-RPT-HOACTZIPLIST]"
"RTN","RMPORAP",15,0)
 S FR="",PAGE=0
"RTN","RMPORAP",16,0)
 S FLDS="[RMPO-RPT-HOACTZIPLIST]"
"RTN","RMPORAP",17,0)
 S DHD="W ?0 D RPTHDR^RMPORAP"
"RTN","RMPORAP",18,0)
 S DHIT="D CNT^RMPORAP"
"RTN","RMPORAP",19,0)
 S DIOEND="I $G(Y)'[U D DIOEND^RMPORAP S RMEND=1 S:IOST[""P-"" RMPOPRT=1"    ;RMPR*3.0*179
"RTN","RMPORAP",20,0)
 D EN1^DIP
"RTN","RMPORAP",21,0)
 I RMPOPRT=0,$G(RMEND) K DIR S DIR(0)="E" D ^DIR
"RTN","RMPORAP",22,0)
 D EXIT
"RTN","RMPORAP",23,0)
 Q
"RTN","RMPORAP",24,0)
 ;
"RTN","RMPORAP",25,0)
EXIT ;
"RTN","RMPORAP",26,0)
 N RMPRSITE,RMPR D KILL^XUSCLEAN
"RTN","RMPORAP",27,0)
 Q
"RTN","RMPORAP",28,0)
 ;
"RTN","RMPORAP",29,0)
RPTHDR ; Report header
"RTN","RMPORAP",30,0)
 N Y S Y=""
"RTN","RMPORAP",31,0)
 D NOW^%DTC S Y=% X ^DD("DD")
"RTN","RMPORAP",32,0)
 S RPTDT=$P(Y,"@",1)_"  "_$P($P(Y,"@",2),":",1,2)
"RTN","RMPORAP",33,0)
 N RA S RA=RMPO("NAME"),PAGE=PAGE+1
"RTN","RMPORAP",34,0)
 W RPTDT,?(40-($L(RA)/2)),RA,?68,"Page: "_PAGE
"RTN","RMPORAP",35,0)
 W !,"Active Home Oxygen Patients by Zip Code",?50,"'*' denotes deceased patient",!
"RTN","RMPORAP",36,0)
 W !,"Zip Code",?12,"Name/Phone Number",?36,"SSN",?43,"Address"
"RTN","RMPORAP",37,0)
 W !,"==========",?12,"=====================",?36,"====",?43,"===================================",!
"RTN","RMPORAP",38,0)
 Q
"RTN","RMPORAP",39,0)
CNT ;Count the total of patients printed.
"RTN","RMPORAP",40,0)
 I WHO'=D0 S COUNT=COUNT+1,WHO=D0 S:+$G(^DPT(D0,.35)) RMPODCNT=RMPODCNT+1
"RTN","RMPORAP",41,0)
 Q
"RTN","RMPORAP",42,0)
 ;
"RTN","RMPORAP",43,0)
DIOEND ;TOTAL PRINT     RMPR*3.0*179
"RTN","RMPORAP",44,0)
 S COUNT=$E("      ",1,(6-$L(COUNT)))_COUNT
"RTN","RMPORAP",45,0)
 W !!,?47,"Total Patients: ",COUNT
"RTN","RMPORAP",46,0)
 S RMPOCNT=$E("      ",1,(6-$L(RMPODCNT)))_RMPODCNT
"RTN","RMPORAP",47,0)
 W !,?38,"Total Deceased Patients: ",RMPODCNT
"RTN","RMPORAP",48,0)
 Q
"RTN","RMPORAP",49,0)
SSN ;GET SSN    ;RMPR*3.0*179
"RTN","RMPORAP",50,0)
 N RMPOEXP
"RTN","RMPORAP",51,0)
 S X="",RMPOEXP=" "    ;RMPR*3.0*179 Flag a deceased patient by attaching an '*' to SSN. ^DPT(D0,.35) direct read supported by ICR #10035
"RTN","RMPORAP",52,0)
 I +$G(^DPT(D0,.35)) S RMPOEXP="*",RMPODCNT=RMPODCNT+1
"RTN","RMPORAP",53,0)
 S RMPOSSN=$E($P($G(^DPT(D0,0)),"^",9),6,9)
"RTN","RMPORAP",54,0)
 S RMPOSSN=RMPOEXP_RMPOSSN
"RTN","RMPORAP",55,0)
 D CNT
"RTN","RMPORAP",56,0)
 Q
"RTN","RMPORIP")
0^5^B14014372^B8628219
"RTN","RMPORIP",1,0)
RMPORIP ;(NG)/DG/CAP/HINES CIOFO/HNC -INACTIVE HOME OXYGEN PATIENTS ; 5/18/00 9:35am
"RTN","RMPORIP",2,0)
 ;;3.0;PROSTHETICS;**29,49,179**;Feb 09, 1996;Build 7
"RTN","RMPORIP",3,0)
 ;
"RTN","RMPORIP",4,0)
 ;RMPR*3.0*178 Check for deceased patients. Add to report by
"RTN","RMPORIP",5,0)
 ;             displaying asterisk (*) if patient deceased.
"RTN","RMPORIP",6,0)
 ;
"RTN","RMPORIP",7,0)
SITE ;   Initialize site variables
"RTN","RMPORIP",8,0)
 D HOSITE^RMPOUTL0  Q:'$D(RMPOXITE)
"RTN","RMPORIP",9,0)
 S RMPODCNT=0
"RTN","RMPORIP",10,0)
 ;
"RTN","RMPORIP",11,0)
FROM ;   Ask starting date/oldest inactive date
"RTN","RMPORIP",12,0)
 K DIR  S DIR(0)="D^^^P"
"RTN","RMPORIP",13,0)
 S DIR("A")="Start at INACTIVATION DATE"
"RTN","RMPORIP",14,0)
 S DIR("B")="T-180"
"RTN","RMPORIP",15,0)
 S DIR("?")="Enter the earliest INACTIVATION DATE to report on."
"RTN","RMPORIP",16,0)
 D ^DIR  G:$D(DTOUT)!$D(DUOUT) EXIT
"RTN","RMPORIP",17,0)
 W "  ("_Y(0)_")"
"RTN","RMPORIP",18,0)
 S FRMDT=Y,FDT=Y(0)
"RTN","RMPORIP",19,0)
 ;
"RTN","RMPORIP",20,0)
TO ;   Ask ending/newest inactivation date
"RTN","RMPORIP",21,0)
 K DIR  S DIR(0)="D^^^P"
"RTN","RMPORIP",22,0)
 S DIR("A")="Ending INACTIVATION DATE"
"RTN","RMPORIP",23,0)
 S DIR("B")="T"
"RTN","RMPORIP",24,0)
 S DIR("?")="Enter the latest INACTIVATION DATE to report on."
"RTN","RMPORIP",25,0)
 D ^DIR  G EXIT:$D(DTOUT),FROM:$D(DUOUT)
"RTN","RMPORIP",26,0)
 W "  ("_Y(0)_")",!
"RTN","RMPORIP",27,0)
 ;
"RTN","RMPORIP",28,0)
 I Y<FRMDT  D  G TO
"RTN","RMPORIP",29,0)
 . W !,"Ending date must NOT be earlier than "_FDT_".",!
"RTN","RMPORIP",30,0)
 S TODT=Y,TDT=Y(0)
"RTN","RMPORIP",31,0)
 ;
"RTN","RMPORIP",32,0)
LI ;   List the sought patients
"RTN","RMPORIP",33,0)
 K DA,DASH  S (COUNT,PAGE,RMEND,RMPORPT,L)=0
"RTN","RMPORIP",34,0)
 S $P(DASH,"-",79)=""
"RTN","RMPORIP",35,0)
 D NOW^%DTC  S Y=%  X ^DD("DD")
"RTN","RMPORIP",36,0)
 S RPTDT=$P(Y,"@",1)_"  "_$P($P(Y,"@",2),":",1,2)
"RTN","RMPORIP",37,0)
 ;
"RTN","RMPORIP",38,0)
 S DIC="^RMPR(665,",BY="[RMPO-RPT-HOINACTIVE]"
"RTN","RMPORIP",39,0)
 S FR=","_$$DATE(FRMDT),TO=","_$$DATE(TODT)
"RTN","RMPORIP",40,0)
 S DIS(0)="I $P($G(^RMPR(665,D0,""RMPOA"")),U,7)=RMPOXITE"
"RTN","RMPORIP",41,0)
 S DHD="W ?0 D RPTHDR^RMPORIP"
"RTN","RMPORIP",42,0)
 S DIOEND="I $G(Y)'[U D DIOEND^RMPORIP S RMEND=1 S:IOST[""P-"" RMPORPT=1"
"RTN","RMPORIP",43,0)
 S FLDS=".01;C1;L19;""PATIENT"",D SSN^RMPORIP W X;C21;R5;""SSN"",D SDT^RMPORIP W X;C28;L10;""START"""
"RTN","RMPORIP",44,0)
 S FLDS(2)="D EDT^RMPORIP W X;C40;L10;""INACTIVE"",D IREA^RMPORIP W X;C52;L29;""REASON"""
"RTN","RMPORIP",45,0)
 D EN1^DIP
"RTN","RMPORIP",46,0)
 I RMPORPT=0,$G(RMEND)  K DIR  S DIR(0)="E"  D ^DIR
"RTN","RMPORIP",47,0)
 ;
"RTN","RMPORIP",48,0)
EXIT K ^TMP($J)  N RMPR,RMPRSITE  D KILL^XUSCLEAN
"RTN","RMPORIP",49,0)
 Q
"RTN","RMPORIP",50,0)
 ;
"RTN","RMPORIP",51,0)
 ;*** CONVERT DATE FROM FILEMAN FORMAT TO MM/DD/YYYY
"RTN","RMPORIP",52,0)
DATE(FMD) ;
"RTN","RMPORIP",53,0)
 Q $E(FMD,4,5)_"/"_$E(FMD,6,7)_"/"_($E(FMD,1,3)+1700)
"RTN","RMPORIP",54,0)
 ;
"RTN","RMPORIP",55,0)
EDT ;*** INACTIVATION DATE
"RTN","RMPORIP",56,0)
 S X=$P($G(^RMPR(665,D0,"RMPOA")),U,3)  S:X X=$$DATE(X)
"RTN","RMPORIP",57,0)
 Q
"RTN","RMPORIP",58,0)
 ;
"RTN","RMPORIP",59,0)
IREA ;*** INACTIVE REASON
"RTN","RMPORIP",60,0)
 I $D(^RMPR(665,D0,"RMPOA"))  D
"RTN","RMPORIP",61,0)
 . N RMMSG  S X=$P(^RMPR(665,D0,"RMPOA"),U,4)
"RTN","RMPORIP",62,0)
 . S X=$$EXTERNAL^DILFD(665,19.6,"",X,"RMMSG")
"RTN","RMPORIP",63,0)
 E  S X=""
"RTN","RMPORIP",64,0)
 Q
"RTN","RMPORIP",65,0)
 ;
"RTN","RMPORIP",66,0)
RPTHDR ;*** REPORT HEADER
"RTN","RMPORIP",67,0)
 N RA S RA=RMPO("NAME"),PAGE=PAGE+1
"RTN","RMPORIP",68,0)
 W RPTDT,?(40-($L(RA)/2)),RA,?68,"Page: "_PAGE
"RTN","RMPORIP",69,0)
 W !?5,"Inactive Home Oxygen Patients",?50,"'*' denotes deceased patient",!   ;RMPR*3.0*179
"RTN","RMPORIP",70,0)
 W !?13,"Date Range: ",FDT," to ",TDT,!
"RTN","RMPORIP",71,0)
 W !,"Patient",?21,"SSN",?28,"Active",?40,"Inactive",?51,"Inactive Reason"
"RTN","RMPORIP",72,0)
 W !,"===================",?21,"====",?27,"==========",?39,"==========  ========================",!
"RTN","RMPORIP",73,0)
 Q
"RTN","RMPORIP",74,0)
 ;
"RTN","RMPORIP",75,0)
SDT ;*** GET START DATE (USE INITIAL OXYGEN RX DATE)
"RTN","RMPORIP",76,0)
 S X=$P($G(^RMPR(665,D0,"RMPOA")),U,2)  S:X X=$$DATE(X)
"RTN","RMPORIP",77,0)
 Q
"RTN","RMPORIP",78,0)
 ;
"RTN","RMPORIP",79,0)
SSN ;*** GET SSN
"RTN","RMPORIP",80,0)
 K VA,VADM S RMPOEXP=" ",RMPODCNT=0 I +$G(^DPT(D0,.35)) S RMPOEXP="*"   ;RMPR*3.0*179 Flag a deceased patient by attaching an '*' to SSN. ^DPT(D0,.35) direct read supported by ICR #10035
"RTN","RMPORIP",81,0)
 S DFN=D0  D ^VADPT
"RTN","RMPORIP",82,0)
 S X=$P(VA("PID"),"-",3)
"RTN","RMPORIP",83,0)
 I X'="" S COUNT=COUNT+1,X=RMPOEXP_X S:RMPOEXP'=" " RMPODCNT=RMPODCNT+1   ;RMPR*3.0*179
"RTN","RMPORIP",84,0)
 Q
"RTN","RMPORIP",85,0)
DIOEND ;TOTAL PRINT
"RTN","RMPORIP",86,0)
 S COUNT=$E("      ",1,(6-$L(COUNT)))_COUNT
"RTN","RMPORIP",87,0)
 W !!,?47,"Total Patients: ",COUNT
"RTN","RMPORIP",88,0)
 S RMPODCNT=$E("      ",1,(6-$L(RMPODCNT)))_RMPODCNT         ;RMPR*3.0*179
"RTN","RMPORIP",89,0)
 W !,?38,"Total Deceased Patients: ",RMPODCNT               ;RMPR*3.0*179
"RTN","RMPORIP",90,0)
 Q
"RTN","RMPORLP")
0^3^B13970436^B10577728
"RTN","RMPORLP",1,0)
RMPORLP ;(NG)/DG/CAP /HINES-CIOFO/HNC- HOME OXY PTS ;7/24/98
"RTN","RMPORLP",2,0)
 ;;3.0;PROSTHETICS;**29,179**;Feb 09, 1996;Build 7
"RTN","RMPORLP",3,0)
 ;
"RTN","RMPORLP",4,0)
 ;RMPR*3.0*179 Flag a deceased patient by adding an '*'
"RTN","RMPORLP",5,0)
 ;             in front of SSN. 
"RTN","RMPORLP",6,0)
 ;
"RTN","RMPORLP",7,0)
SITE ;Set up site variables.
"RTN","RMPORLP",8,0)
 D HOSITE^RMPOUTL0 I '$D(RMPOXITE) Q
"RTN","RMPORLP",9,0)
 ;
"RTN","RMPORLP",10,0)
LI ;List the sought patient. ;DW
"RTN","RMPORLP",11,0)
 S DIC="^RMPR(665,",BY="[RMPO-RPT-HOPATIENTLIST]",L=0,FR=""
"RTN","RMPORLP",12,0)
 S PAGE=0,RMPRDCNT=0
"RTN","RMPORLP",13,0)
 S DIS(0)="S Z=$G(^RMPR(665,D0,""RMPOA"")) I ($P(Z,U,7)=RMPOXITE),$P(Z,U,3)="""""
"RTN","RMPORLP",14,0)
 ;S DIS(0)="I $P($G(^RMPR(665,D0,""RMPOA"")),U,7)=RMPOXITE",PAGE=0
"RTN","RMPORLP",15,0)
 S $P(SPACE," ",80)="",$P(DASH,"-",79)="",(COUNT,RMEND,RMPORPT)=0
"RTN","RMPORLP",16,0)
 D NOW^%DTC S Y=% X ^DD("DD")
"RTN","RMPORLP",17,0)
 S RPTDT=$P(Y,"@",1)_"  "_$P($P(Y,"@",2),":",1,2)
"RTN","RMPORLP",18,0)
 S DHD="W ?0 D RPTHDR^RMPORLP"
"RTN","RMPORLP",19,0)
 ;S DIOEND="I $G(Y)'[U S COUNT=$E(""      "",1,(6-$L(COUNT)))_COUNT W !!,?50,""TOTAL PATIENTS: "",COUNT  S RMEND=1 S:IOST[""P-"" RMPORPT=1"
"RTN","RMPORLP",20,0)
 S DIOEND="I $G(Y)'[U D DIOEND^RMPORLP S RMEND=1 S:IOST[""P-"" RMPORPT=1"   ;RMPR*3.0*179
"RTN","RMPORLP",21,0)
 S FLDS=".01;C1;L22;""PATIENT"",D SSN^RMPORLP W X;C24;L5;""SSN"",D GET^RMPORLP W X;C30;L30;""PRIMARY ITEM"""
"RTN","RMPORLP",22,0)
 S FLDS(2)="D SDT^RMPORLP W X;C61;L8;""START"",D EDT^RMPORLP W X;C70;""EXPIRE"""
"RTN","RMPORLP",23,0)
 D EN1^DIP
"RTN","RMPORLP",24,0)
 I RMPORPT=0,$G(RMEND) K DIR S DIR(0)="E" D ^DIR
"RTN","RMPORLP",25,0)
EXIT ;
"RTN","RMPORLP",26,0)
 K ^TMP($J)
"RTN","RMPORLP",27,0)
 N RMPRSITE,RMPR D KILL^XUSCLEAN
"RTN","RMPORLP",28,0)
 Q
"RTN","RMPORLP",29,0)
DIOEND ;
"RTN","RMPORLP",30,0)
 S COUNT=$E("      ",1,(6-$L(COUNT)))_COUNT
"RTN","RMPORLP",31,0)
 W !!,?47,"Total Patients: ",COUNT
"RTN","RMPORLP",32,0)
 S RMPRDCNT=$E("      ",1,(6-$L(RMPRDCNT)))_RMPRDCNT   ;RMPR*3.0*179
"RTN","RMPORLP",33,0)
 W !,?38,"Total Deceased Patients: ",RMPRDCNT   ;RMPR*3.0*179
"RTN","RMPORLP",34,0)
 Q
"RTN","RMPORLP",35,0)
CNT ;COUNT NAMES
"RTN","RMPORLP",36,0)
 I X'="" S COUNT=COUNT+1
"RTN","RMPORLP",37,0)
 Q
"RTN","RMPORLP",38,0)
GET ;Get the primary item.  ;DW
"RTN","RMPORLP",39,0)
 S X="" N RR,RA S (RR,RA)=0
"RTN","RMPORLP",40,0)
 F  S RA=$O(^RMPR(665,D0,"RMPOC",RA)) Q:RA=""  I $P($G(^RMPR(665,D0,"RMPOC",RA,0)),U,11)="Y" D  Q
"RTN","RMPORLP",41,0)
  . ; PROSTHETICS PATIENT FILE
"RTN","RMPORLP",42,0)
  . S RR=$P(^RMPR(665,D0,"RMPOC",RA,0),U)
"RTN","RMPORLP",43,0)
  . ;PROS ITEM FILE
"RTN","RMPORLP",44,0)
  . S RR=$P(^RMPR(661,RR,0),U)
"RTN","RMPORLP",45,0)
  . ; ITEM MASTER FILE
"RTN","RMPORLP",46,0)
  . S RR=$P(^PRC(441,RR,0),"^",2)
"RTN","RMPORLP",47,0)
  . S X=$E(RR,1,30)
"RTN","RMPORLP",48,0)
 Q
"RTN","RMPORLP",49,0)
 ;
"RTN","RMPORLP",50,0)
SSN ;GET SSN
"RTN","RMPORLP",51,0)
 N RMPOEXP
"RTN","RMPORLP",52,0)
 S X="",RMPOEXP=" "    ;RMPR*3.0*179
"RTN","RMPORLP",53,0)
 I +$G(^DPT(D0,.35)) S RMPOEXP="*",RMPRDCNT=RMPRDCNT+1   ;RMPR*3.0*179 Flag a deceased patient by attaching an '*' to SSN. ^DPT(D0,.35) direct read supported by ICR #10035
"RTN","RMPORLP",54,0)
 K VA,VADM S DFN=D0 D ^VADPT
"RTN","RMPORLP",55,0)
 S X=RMPOEXP_$P(VA("PID"),"-",3)     ;RMPR*3.0*179
"RTN","RMPORLP",56,0)
 D CNT
"RTN","RMPORLP",57,0)
 Q
"RTN","RMPORLP",58,0)
SDT ;GET START DATE  (USE INITIAL OXYGEN RX DATE)
"RTN","RMPORLP",59,0)
 S X="" N RA
"RTN","RMPORLP",60,0)
 S RA=$P($G(^RMPR(665,D0,"RMPOA")),U,2)
"RTN","RMPORLP",61,0)
 I RA S X=$E(RA,4,5)_"/"_$E(RA,6,7)_"/"_$E(RA,2,3)
"RTN","RMPORLP",62,0)
 Q
"RTN","RMPORLP",63,0)
EDT ;Expiration Date of current Rx.
"RTN","RMPORLP",64,0)
 N J,D,Y,RA S (J,Y,X,D,RA)=""
"RTN","RMPORLP",65,0)
 F  S D=$O(^RMPR(665,D0,"RMPOB","B",D)) Q:D=""  D
"RTN","RMPORLP",66,0)
 . S J="",J=$O(^RMPR(665,D0,"RMPOB","B",D,J)) Q:J=""  S:(J>RA) RA=J
"RTN","RMPORLP",67,0)
 ;I J="" Q
"RTN","RMPORLP",68,0)
 I RA="" Q
"RTN","RMPORLP",69,0)
 S Y=$P($G(^RMPR(665,D0,"RMPOB",RA,0)),U,3)
"RTN","RMPORLP",70,0)
 I Y S X=X_$E(Y,4,5)_"/"_$E(Y,6,7)_"/"_($E(Y,1,3)+1700)
"RTN","RMPORLP",71,0)
 Q
"RTN","RMPORLP",72,0)
EDTX ;Rx Expiration Date.
"RTN","RMPORLP",73,0)
 ;Get the expiration dates for all active Rx.
"RTN","RMPORLP",74,0)
 N J,D,EDT,C,TD S (J,D,EDT,C,X)=""
"RTN","RMPORLP",75,0)
 ; Get today's date.
"RTN","RMPORLP",76,0)
 D NOW^%DTC S TD=X,X=""
"RTN","RMPORLP",77,0)
 ; Get the active Rx.
"RTN","RMPORLP",78,0)
 F  S D=$O(^RMPR(665,D0,"RMPOB","B",D)) Q:D=""  S C=C+1 D
"RTN","RMPORLP",79,0)
 .F  S J=$O(^RMPR(665,D0,"RMPOB","B",D,J)) Q:J=""  D
"RTN","RMPORLP",80,0)
 .. S EDT=$P($G(^RMPR(665,D0,"RMPOB",J,0)),U,3)
"RTN","RMPORLP",81,0)
 .. I EDT S X=X_$E(EDT,4,5)_"/"_$E(EDT,6,7)_"/"_($E(EDT,1,3)+1700)_" "
"RTN","RMPORLP",82,0)
 ; Define the other dates.
"RTN","RMPORLP",83,0)
 I C="" S X="N/A" Q
"RTN","RMPORLP",84,0)
 Q
"RTN","RMPORLP",85,0)
RPTHDR ;Report header
"RTN","RMPORLP",86,0)
 N RA S RA=RMPO("NAME"),PAGE=PAGE+1
"RTN","RMPORLP",87,0)
 W RPTDT,?(40-($L(RA)/2)),RA,?68,"Page: "_PAGE
"RTN","RMPORLP",88,0)
 W !,"   '*' denotes deceased patient by SSN"
"RTN","RMPORLP",89,0)
 W !?22,"Alphabetical List Home Oxygen Patients",!?68,"Date Current",!?68,"Prescription"
"RTN","RMPORLP",90,0)
 W !,"Patient",?25,"SSN",?29,"Primary Item",?61,"Active",?70,"Expires"
"RTN","RMPORLP",91,0)
 W !,"=======================",?24,"====",?29,"==============================",?60,"======== ==========",!
"RTN","RMPORLP",92,0)
 Q
"RTN","RMPORMB")
0^6^B39988003^B34348495
"RTN","RMPORMB",1,0)
RMPORMB ;HIN/RVD - Home Oxygen Monthly Billing Report ;12/13/99
"RTN","RMPORMB",2,0)
 ;;3.0;PROSTHETICS;**29,43,44,49,55,159,179**;Feb 09, 1996;Build 7
"RTN","RMPORMB",3,0)
 ;ODJ - 5/17/00 - fix FCP problem (patch 49)
"RTN","RMPORMB",4,0)
 ;      5/25/00 - fix crash if FCP in ^RMPO(665.72) and not ^RMPR(669.9)
"RTN","RMPORMB",5,0)
 ;      5/31/00 - fix crash if FCP is null
"RTN","RMPORMB",6,0)
 ;
"RTN","RMPORMB",7,0)
 ;ODJ - 10/31/00 - patch 55 - fix problem where totals not being
"RTN","RMPORMB",8,0)
 ;                            displayed when page contains 16 pats.
"RTN","RMPORMB",9,0)
 ;
"RTN","RMPORMB",10,0)
 ;RMPR*3.0*179 Flag a deceased patient by adding an '*'
"RTN","RMPORMB",11,0)
 ;             in front of SSN. 
"RTN","RMPORMB",12,0)
 ;
"RTN","RMPORMB",13,0)
START ;
"RTN","RMPORMB",14,0)
 K RQUIT,RSP,RCNT,RPAGE,RDASH,RPTDT,RSHODT,VA,VADM,DFN,RNAM,RMNADFN
"RTN","RMPORMB",15,0)
 K Y,RAMT,RLINE,ROVNDR,^TMP($J),RMEND,QUIT
"RTN","RMPORMB",16,0)
 ;
"RTN","RMPORMB",17,0)
SITE ;Intialize site variables.
"RTN","RMPORMB",18,0)
 D HOSITE^RMPOUTL0 I '$D(RMPOXITE) Q
"RTN","RMPORMB",19,0)
 ;
"RTN","RMPORMB",20,0)
FROM ; Get billing month
"RTN","RMPORMB",21,0)
 ; specify start/end site & bill month
"RTN","RMPORMB",22,0)
 D MONTH^RMPOBIL0() Q:'$D(RMPODATE)!QUIT
"RTN","RMPORMB",23,0)
DEV S %ZIS="MQ" K IOP D ^%ZIS G:POP EXIT I '$D(IO("Q")) U IO G PROC
"RTN","RMPORMB",24,0)
 K IO("Q") S ZTDESC="HOME OXYGEN MONTHLY BILLING",ZTRTN="PROC^RMPORMB",ZTIO=ION,ZTSAVE("RMPODATE")="",ZTSAVE("RMPO(""STA"")")="",ZTSAVE("RMPOXITE")=""
"RTN","RMPORMB",25,0)
 S ZTSAVE("RMPO(""NAME"")")=""
"RTN","RMPORMB",26,0)
 D ^%ZTLOAD W:$D(ZTSK) !,"REQUEST QUEUED!" H 1 G EXIT
"RTN","RMPORMB",27,0)
PROC ;
"RTN","RMPORMB",28,0)
 S (RPAGE,RMEND,RMPORPT,RVCNT,RPCNT,RVPRCNT,RMPODCNT)=0    ;RMPR*3.0*179
"RTN","RMPORMB",29,0)
 S Y=RMPODATE D DD^%DT S RSHODT=Y
"RTN","RMPORMB",30,0)
 S $P(RSP," ",79)=" ",RCNT=0,$P(RDASH,"-",80)=""
"RTN","RMPORMB",31,0)
 D NOW^%DTC S Y=% X ^DD("DD")
"RTN","RMPORMB",32,0)
 S RPTDT=$P(Y,"@",1)_"  "_$P($P(Y,"@",2),":",1,2)
"RTN","RMPORMB",33,0)
 F I="T9","TS","TO","SP",1,2,3 S RAMT(I)=0
"RTN","RMPORMB",34,0)
 K RFCPT S RFCPI=""
"RTN","RMPORMB",35,0)
 F  S RFCPI=$O(^RMPR(669.9,RMPOXITE,"RMPOFCP","B",RFCPI)) Q:RFCPI=""  D
"RTN","RMPORMB",36,0)
 . S RFCPIEN=$O(^RMPR(669.9,RMPOXITE,"RMPOFCP","B",RFCPI,0))
"RTN","RMPORMB",37,0)
 . S RPSASFLG=$P(^RMPR(669.9,RMPOXITE,"RMPOFCP",RFCPIEN,0),U,2)
"RTN","RMPORMB",38,0)
 . ;S RFCPT(RFCPI)=$S(+RFCPI=910:1,RPSASFLG="Y":2,1:3)
"RTN","RMPORMB",39,0)
 . ;p49 replaces above logic - if PSAS then col 1 else col 2
"RTN","RMPORMB",40,0)
 . S RFCPT(RFCPI)=$S(RPSASFLG="Y":1,1:2)
"RTN","RMPORMB",41,0)
 . Q
"RTN","RMPORMB",42,0)
 D LINE
"RTN","RMPORMB",43,0)
 D PRINT G:$G(RMEND) EXIT
"RTN","RMPORMB",44,0)
 I $E(IOST)["C",(RVCNT=1),(RVPRCNT=1) D  ; if terminal
"RTN","RMPORMB",45,0)
 .K DIR S DIR("A")="Enter RETURN to continue or '^' to QUIT",DIR(0)="E"
"RTN","RMPORMB",46,0)
 .D ^DIR S:$G(X)[U RMEND=1
"RTN","RMPORMB",47,0)
EXIT ;clean-up local variables and close device
"RTN","RMPORMB",48,0)
 D ^%ZISC K ^TMP($J)
"RTN","RMPORMB",49,0)
 N RMPR,RMPRSITE D KILL^XUSCLEAN
"RTN","RMPORMB",50,0)
 Q
"RTN","RMPORMB",51,0)
 ;
"RTN","RMPORMB",52,0)
NAME ;Write out the name
"RTN","RMPORMB",53,0)
 S RLINE=RLINE_$E($P(RNAM,U,1)_RSP,1,14)
"RTN","RMPORMB",54,0)
 S RLINE=RLINE_$E($P(RNAM,U,2)_RSP,1,6)
"RTN","RMPORMB",55,0)
 Q
"RTN","RMPORMB",56,0)
 ;
"RTN","RMPORMB",57,0)
LINE ;Process entire line (one for each patient)
"RTN","RMPORMB",58,0)
 W:$E(IOST)["C" "processing..."
"RTN","RMPORMB",59,0)
 F RV=0:0 S RV=$O(^RMPO(665.72,RMPOXITE,1,RMPODATE,1,RV)) Q:RV'>0  D SETRV F RN=0:0 S RN=$O(^RMPO(665.72,RMPOXITE,1,RMPODATE,1,RV,"V",RN)) Q:RN'>0  D
"RTN","RMPORMB",60,0)
 . S RMPOEXP=" " I +$G(^DPT(RN,.35)) S RMPOEXP="*",RMPODCNT=RMPODCNT+1    ;RMPR*3.0*179 Flag a deceased patient by attaching an '*' to SSN. ^DPT(D0,.35) direct read supported by ICR #10035
"RTN","RMPORMB",61,0)
 .K VA,VADM S DFN=RN D ^VADPT
"RTN","RMPORMB",62,0)
 .S RNAM=$E(VADM(1),1,12)_"^"_$P(VA("PID"),"-",3)_RMPOEXP    ;RMPR*3.0*179
"RTN","RMPORMB",63,0)
 .S RACPT=$P(^RMPO(665.72,RMPOXITE,1,RMPODATE,1,RV,"V",RN,0),U,2)
"RTN","RMPORMB",64,0)
 .S RPSTD=$P(^RMPO(665.72,RMPOXITE,1,RMPODATE,1,RV,"V",RN,0),U,3)
"RTN","RMPORMB",65,0)
 .S RAMT(RV,1)=0,RAMT(RV,2)=0,RAMT(RV,3)=0,RAMT(RV,"SUSP")=0
"RTN","RMPORMB",66,0)
 .F RI=0:0 S RI=$O(^RMPO(665.72,RMPOXITE,1,RMPODATE,1,RV,"V",RN,1,RI)) Q:RI'>0  D
"RTN","RMPORMB",67,0)
 ..S RD=^RMPO(665.72,RMPOXITE,1,RMPODATE,1,RV,"V",RN,1,RI,0)
"RTN","RMPORMB",68,0)
 ..S RCOST=$P(RD,U,5),RTOTAL=$P(RD,U,6),RFCP=$P(RD,U,3),RSUSP=$P(RD,U,11)
"RTN","RMPORMB",69,0)
 ..S:RFCP="" RFCP="???"
"RTN","RMPORMB",70,0)
 ..I '$D(RFCPT(RFCP)) S RFCPT(RFCP)=2 ;p49 fix problem where FCP not in site file ^RMPR(669.9) (use the OTHER col. in this case)
"RTN","RMPORMB",71,0)
 ..S RX=RFCPT(RFCP),RAMT(RV,RX)=$G(RAMT(RV,RX))+RTOTAL,RAMT(RV,"SUSP")=$G(RAMT(RV,"SUSP"))+RSUSP
"RTN","RMPORMB",72,0)
 .S RLINE=$S(RACPT="Y":"a",1:" ")_$S(RPSTD="Y":"#",RPSTD="P":"p",1:" ")
"RTN","RMPORMB",73,0)
 .S RLINE=$E(RLINE_RSP,1,4) D NAME
"RTN","RMPORMB",74,0)
 .S RLINE=RLINE_$E($P(^PRC(440,RV,0),U)_RSP,1,8)_" "
"RTN","RMPORMB",75,0)
 .S RMT1=$G(RAMT(RV,1))
"RTN","RMPORMB",76,0)
 .S RMT2=$G(RAMT(RV,2))
"RTN","RMPORMB",77,0)
 .S RMT3=$G(RAMT(RV,3))
"RTN","RMPORMB",78,0)
 .S RMTP=$G(RAMT(RV,"SUSP"))
"RTN","RMPORMB",79,0)
 .D AMTS(RMT1,RMT2,RMT3,RMTP)
"RTN","RMPORMB",80,0)
 .S RTMT(RV,"T9")=RTMT(RV,"T9")+RMT1,RTMT(RV,"TS")=RTMT(RV,"TS")+RMT2
"RTN","RMPORMB",81,0)
 .S RTMT(RV,"TO")=RTMT(RV,"TO")+RMT3,RTMT(RV,"SP")=RTMT(RV,"SP")+RMTP
"RTN","RMPORMB",82,0)
 .S RMNADFN=RNAM_"^"_RN,^TMP($J,RV,RMNADFN)=RLINE
"RTN","RMPORMB",83,0)
 Q
"RTN","RMPORMB",84,0)
 ;
"RTN","RMPORMB",85,0)
PRINT ;print report
"RTN","RMPORMB",86,0)
 I '$D(^TMP($J)) W !,"***** No RECORDS to Print *****" Q 
"RTN","RMPORMB",87,0)
 S (RVPRCNT,RPCNT,RCNT)=0
"RTN","RMPORMB",88,0)
 F RV=0:0 S RV=$O(^TMP($J,RV)) Q:RV'>0!($G(RMEND))  D RPTHDR S RN="" F  S RN=$O(^TMP($J,RV,RN)) Q:$G(RMEND)  D:RN="" DND Q:RN=""  D
"RTN","RMPORMB",89,0)
 .W !,$G(^TMP($J,RV,RN)) S RPCNT=RPCNT+1,RCNT=RCNT+1 D:IOSL<(RCNT+9) PAGE Q:$G(RMEND)
"RTN","RMPORMB",90,0)
 D GTOTAL
"RTN","RMPORMB",91,0)
 Q
"RTN","RMPORMB",92,0)
 ;
"RTN","RMPORMB",93,0)
SETRV ;
"RTN","RMPORMB",94,0)
 F I=1,2,3 S RAMT(RV,I)=0
"RTN","RMPORMB",95,0)
 F I="T9","TS","TO","SP" S RTMT(RV,I)=0
"RTN","RMPORMB",96,0)
 S RVCNT=RVCNT+1
"RTN","RMPORMB",97,0)
 Q
"RTN","RMPORMB",98,0)
 ;
"RTN","RMPORMB",99,0)
AMTS(C,Y,Z,S) ; Amounts
"RTN","RMPORMB",100,0)
 S RLINE=RLINE_$E($$AMT(C)_RSP,1,9)
"RTN","RMPORMB",101,0)
 S RLINE=RLINE_$E($$AMT(Y)_RSP,1,9)
"RTN","RMPORMB",102,0)
 S RLINE=RLINE_$E($$AMT(Z)_RSP,1,9)
"RTN","RMPORMB",103,0)
 S RLINE=RLINE_$E($$AMT(S)_RSP,1,9)
"RTN","RMPORMB",104,0)
 S RLINE=RLINE_" "_$$AMT(C+Y+Z)
"RTN","RMPORMB",105,0)
 Q
"RTN","RMPORMB",106,0)
AMT(C) ; Format Amounts
"RTN","RMPORMB",107,0)
 I C,C'["." S C=+C_".00"
"RTN","RMPORMB",108,0)
 I C?.N1"."1N  S C=C_0
"RTN","RMPORMB",109,0)
 S:C=0 C="-" S C=$E("     ",1,8-$L(C))_C
"RTN","RMPORMB",110,0)
 Q C
"RTN","RMPORMB",111,0)
 ;
"RTN","RMPORMB",112,0)
PAGE ;Print page
"RTN","RMPORMB",113,0)
 I $E(IOST)["C",IOSL<(RCNT+9) D  ; if terminal
"RTN","RMPORMB",114,0)
 . K DIR S DIR("A")="Enter RETURN to continue or '^' to QUIT",DIR(0)="E"
"RTN","RMPORMB",115,0)
 . D ^DIR S:$G(X)[U RMEND=1
"RTN","RMPORMB",116,0)
 D:'$G(RMEND) RPTHDR
"RTN","RMPORMB",117,0)
 Q
"RTN","RMPORMB",118,0)
RPTHDR ; Print out the report header
"RTN","RMPORMB",119,0)
 Q:$G(RMEND)  K RA
"RTN","RMPORMB",120,0)
 S RA=RMPO("NAME"),RPAGE=RPAGE+1,RCNT=0
"RTN","RMPORMB",121,0)
 I $E(IOST)["C"!(RPAGE>1) W @IOF
"RTN","RMPORMB",122,0)
 W RPTDT,?(40-($L(RA)/2)),RA,?68,"Page: "_RPAGE
"RTN","RMPORMB",123,0)
 W !?10,RSHODT_" Monthly Home Oxygen Billing",?50,"'*' denotes deceased patient",!
"RTN","RMPORMB",124,0)
 W ?45,"Station",!?45,"Fund Control"
"RTN","RMPORMB",125,0)
 W !,"ACC",?4,"Name",?18,"SSN",?24,"Vendor"
"RTN","RMPORMB",126,0)
 W ?37,"910     Point     Other    Susp     Total"
"RTN","RMPORMB",127,0)
 W !,RDASH
"RTN","RMPORMB",128,0)
 Q
"RTN","RMPORMB",129,0)
 ;
"RTN","RMPORMB",130,0)
DND ; Print REPORT totals
"RTN","RMPORMB",131,0)
 Q:$G(RMEND)  K RA
"RTN","RMPORMB",132,0)
 S RLINE="     ",RA=RTMT(RV,"T9")+RTMT(RV,"TS")+RTMT(RV,"TO")-RTMT(RV,"SP")
"RTN","RMPORMB",133,0)
 I RA D
"RTN","RMPORMB",134,0)
 . S RMTT9=RTMT(RV,"T9"),RMTTS=RTMT(RV,"TS"),RMTTO=RTMT(RV,"TO")
"RTN","RMPORMB",135,0)
 . S RMTSP=RTMT(RV,"SP")
"RTN","RMPORMB",136,0)
 . D AMTS(RMTT9,RMTTS,RMTTO,RMTSP)
"RTN","RMPORMB",137,0)
 . W !,?20,"Totals: ",RLINE
"RTN","RMPORMB",138,0)
 S RPCNT=$E("  ",1,(6-$L(RPCNT)))_RPCNT
"RTN","RMPORMB",139,0)
 W !!,?29,"Total Patients: ",RPCNT
"RTN","RMPORMB",140,0)
 S RMPODCNT=$E("  ",1,(6-$L(RMPODCNT)))_RMPODCNT
"RTN","RMPORMB",141,0)
 W !!,?20,"Total Deceased Patients: ",RMPODCNT
"RTN","RMPORMB",142,0)
 S RVPRCNT=RVPRCNT+1,RPCNT=0
"RTN","RMPORMB",143,0)
 I $E(IOST)["C",(RVCNT'=RVPRCNT) D  ; if terminal
"RTN","RMPORMB",144,0)
 .K DIR S DIR("A")="Enter RETURN to continue or '^' to QUIT",DIR(0)="E"
"RTN","RMPORMB",145,0)
 .D ^DIR S:$G(X)[U RMEND=1
"RTN","RMPORMB",146,0)
 Q
"RTN","RMPORMB",147,0)
 ;
"RTN","RMPORMB",148,0)
GTOTAL ; Print REPORT totals for all VENDORS.
"RTN","RMPORMB",149,0)
 Q:$G(RMEND)  K RA
"RTN","RMPORMB",150,0)
 ;S RLINE="     ",RA=RTMT(RV,"T9")+RTMT(RV,"TS")+RTMT(RV,"TO")-RTMT(RV,"SP")
"RTN","RMPORMB",151,0)
 S RLINE="     "
"RTN","RMPORMB",152,0)
 S (RMTT9,RMTTS,RMTTO,RMTSP)=0
"RTN","RMPORMB",153,0)
 I RVCNT>1 D
"RTN","RMPORMB",154,0)
 .F RI=0:0 S RI=$O(RTMT(RI)) Q:RI'>0  D
"RTN","RMPORMB",155,0)
 .. S RMTT9=RMTT9+RTMT(RI,"T9"),RMTTS=RMTTS+RTMT(RI,"TS"),RMTTO=RMTTO+RTMT(RI,"TO")
"RTN","RMPORMB",156,0)
 .. S RMTSP=RMTSP+RTMT(RI,"SP")
"RTN","RMPORMB",157,0)
 .D AMTS(RMTT9,RMTTS,RMTTO,RMTSP)
"RTN","RMPORMB",158,0)
 .W !!,?14,"Grand Totals: ",RLINE,!
"RTN","RMPORMB",159,0)
 .I $E(IOST)["C" D  ; if terminal
"RTN","RMPORMB",160,0)
 ..K DIR S DIR("A")="Enter RETURN to continue or '^' to QUIT",DIR(0)="E"
"RTN","RMPORMB",161,0)
 ..D ^DIR S:$G(X)[U RMEND=1
"RTN","RMPORMB",162,0)
 Q
"RTN","RMPORPD")
0^8^B12309579^B9266734
"RTN","RMPORPD",1,0)
RMPORPD ;(NG)/DG/CAP/HINES CIOFO/HNC -PRESCRIPTION EXPIRE DATE ACTIVE PATIENTS ; 5/19/00 9:12am
"RTN","RMPORPD",2,0)
 ;;3.0;PROSTHETICS;**29,46,49,179**;Feb 09, 1996;Build 7
"RTN","RMPORPD",3,0)
 ;
"RTN","RMPORPD",4,0)
 ;RMPR*3.0*179 Check for deceased patients. Add to report by
"RTN","RMPORPD",5,0)
 ;             displaying asterisk (*) if patient deceased.
"RTN","RMPORPD",6,0)
 ;
"RTN","RMPORPD",7,0)
SITE ;   Set up the site variables.
"RTN","RMPORPD",8,0)
 D HOSITE^RMPOUTL0  Q:'$D(RMPOXITE)
"RTN","RMPORPD",9,0)
 ;
"RTN","RMPORPD",10,0)
LI ;   List the sought patient.
"RTN","RMPORPD",11,0)
 N WHO S WHO=0,RMPODCNT=0
"RTN","RMPORPD",12,0)
 S (RMEND,RMPORPT,PAGE,COUNT)=0
"RTN","RMPORPD",13,0)
 D NOW^%DTC  S Y=%  X ^DD("DD")
"RTN","RMPORPD",14,0)
 S RPTDT=$P(Y,"@",1)_"  "_$P($P(Y,"@",2),":",1,2)
"RTN","RMPORPD",15,0)
 ;
"RTN","RMPORPD",16,0)
 S DIC="^RMPR(665,"
"RTN","RMPORPD",17,0)
 S BY(0)="^TMP(""RMPO"",$J,",L(0)=3,L=0,FR=""
"RTN","RMPORPD",18,0)
 S DIS(0)="I $P($G(^RMPR(665,D0,""RMPOA"")),U,7)=RMPOXITE,$P($G(^RMPR(665,D0,""RMPOA"")),U,2)'="""",$P($G(^RMPR(665,D0,""RMPOA"")),U,3)="""""
"RTN","RMPORPD",19,0)
 S DHIT="D CNT^RMPORPD"
"RTN","RMPORPD",20,0)
 S DHD="W ?0 D RPTHDR^RMPORPD"
"RTN","RMPORPD",21,0)
 S DIOEND="I $G(Y)'[U D DIOEND^RMPORPD S RMEND=1 S:IOST[""P-"" RMPORPT=1"
"RTN","RMPORPD",22,0)
 S FLDS="W $$RXDT^RMPORPD();C1;L11"
"RTN","RMPORPD",23,0)
 S FLDS(1)=".01;C12;L22"
"RTN","RMPORPD",24,0)
 S FLDS(2)="W $$SSN^RMPORPD();C36;L4"
"RTN","RMPORPD",25,0)
 S FLDS(3)="W $$PITEM^RMPORPD();C41;L30"
"RTN","RMPORPD",26,0)
 S FLDS(4)="W $$ACTDT^RMPORPD();C73;L8"
"RTN","RMPORPD",27,0)
 D PRESORT,EN1^DIP
"RTN","RMPORPD",28,0)
 I RMPORPT=0,$G(RMEND)  K DIR  S DIR(0)="E"  D ^DIR
"RTN","RMPORPD",29,0)
 ;
"RTN","RMPORPD",30,0)
EXIT ;
"RTN","RMPORPD",31,0)
 K ^TMP("RMPO",$J)  N RMPRSITE,RMPR  D KILL^XUSCLEAN
"RTN","RMPORPD",32,0)
 Q
"RTN","RMPORPD",33,0)
 ;
"RTN","RMPORPD",34,0)
ACTDT() ;*** ACTIVATION DATE
"RTN","RMPORPD",35,0)
 S X=$P($G(^RMPR(665,D0,"RMPOA")),U,2)
"RTN","RMPORPD",36,0)
 S:X X=$E(X,4,5)_"/"_$E(X,6,7)_"/"_$E(X,2,3)
"RTN","RMPORPD",37,0)
 Q X
"RTN","RMPORPD",38,0)
 ;
"RTN","RMPORPD",39,0)
CNT ;*** COUNT NAMES
"RTN","RMPORPD",40,0)
 I WHO'=D0 S COUNT=COUNT+1
"RTN","RMPORPD",41,0)
 S WHO=D0
"RTN","RMPORPD",42,0)
 Q
"RTN","RMPORPD",43,0)
 ;
"RTN","RMPORPD",44,0)
 ;*** CONVERT DATE FROM FILEMAN FORMAT TO MM/DD/YYYY
"RTN","RMPORPD",45,0)
DATE(FMD) ;  RMPR*3.0*179 Flag a deceased patient by attaching an '*' to SSN. ^DPT(D0,.35) direct read supported by ICR #10035
"RTN","RMPORPD",46,0)
 N RMPOEXP S RMPOEXP=" " I +$G(^DPT(D0,.35)) S RMPOEXP="*",RMPODCNT=RMPODCNT+1
"RTN","RMPORPD",47,0)
 Q $E(FMD,4,5)_"/"_$E(FMD,6,7)_"/"_($E(FMD,1,3)+1700)_RMPOEXP
"RTN","RMPORPD",48,0)
 ;
"RTN","RMPORPD",49,0)
PITEM() ;*** GET PRIMARY ITEM AND ACTIVATION DATE
"RTN","RMPORPD",50,0)
 N PITM,E
"RTN","RMPORPD",51,0)
 S (E,PITM)=0,X=""
"RTN","RMPORPD",52,0)
 F  S PITM=$O(^RMPR(665,D0,"RMPOC",PITM)) Q:'PITM  D  Q:E
"RTN","RMPORPD",53,0)
 . S PDT=^RMPR(665,D0,"RMPOC",PITM,0)
"RTN","RMPORPD",54,0)
 . Q:$P(PDT,U,11)'="Y"
"RTN","RMPORPD",55,0)
 . S X=$P(PDT,U),X=$P(^RMPR(661,X,0),U)
"RTN","RMPORPD",56,0)
 . S X=$P($G(^PRC(441,X,0)),U,2)
"RTN","RMPORPD",57,0)
 . S X=$E(X,1,30),E=1
"RTN","RMPORPD",58,0)
 Q X
"RTN","RMPORPD",59,0)
 ;
"RTN","RMPORPD",60,0)
PRESORT ;*** SORT BY EXPIRATION DATE
"RTN","RMPORPD",61,0)
 N D0,D2,DFN
"RTN","RMPORPD",62,0)
 K ^TMP("RMPO",$J)
"RTN","RMPORPD",63,0)
 S D2=0
"RTN","RMPORPD",64,0)
 F  S D2=$O(^RMPR(665,"AHO",D2))  Q:'D2  S D0=""  D
"RTN","RMPORPD",65,0)
 . F  S D0=$O(^RMPR(665,"AHO",D2,D0))  Q:D0=""  D
"RTN","RMPORPD",66,0)
 . . K VAPA,VADM  S DFN=D0  D ^VADPT
"RTN","RMPORPD",67,0)
 . . S ^TMP("RMPO",$J,$$RXDT(1),VADM(1),D0)=""
"RTN","RMPORPD",68,0)
 Q
"RTN","RMPORPD",69,0)
 ;
"RTN","RMPORPD",70,0)
RPTHDR ;*** REPORT HEADER
"RTN","RMPORPD",71,0)
 N RA S RA=RMPO("NAME"),PAGE=PAGE+1
"RTN","RMPORPD",72,0)
 W RPTDT,?(40-($L(RA)/2)),RA,?68,"Page: "_PAGE
"RTN","RMPORPD",73,0)
 W !?20,"Prescription Expiration Date",!,"Date Current",?55,"'*' patient is deceased",!,"Prescription"   ;RMPR*3.0*179
"RTN","RMPORPD",74,0)
 W !?1,"Expires",?11,"Name",?35,"SSN",?41,"Primary Item",?73,"Active"
"RTN","RMPORPD",75,0)
 W !,"==========",?11,"=======================",?35,"====",?41,"==============================",?72,"========",!
"RTN","RMPORPD",76,0)
 Q
"RTN","RMPORPD",77,0)
 ;
"RTN","RMPORPD",78,0)
 ;*** EXPIRATION DATE OF CURRENT RX
"RTN","RMPORPD",79,0)
 ; MODE      Date format: 0 - MM/DD/YYYY or "N/A" (default)
"RTN","RMPORPD",80,0)
 ;                        1 - YYYMMDD or "N/A"
"RTN","RMPORPD",81,0)
RXDT(MODE) ;
"RTN","RMPORPD",82,0)
 N J,D,Y,RA S (D,RA,Y)=""
"RTN","RMPORPD",83,0)
 F  S D=$O(^RMPR(665,D0,"RMPOB","B",D))  Q:D=""  D
"RTN","RMPORPD",84,0)
 . S J=$O(^RMPR(665,D0,"RMPOB","B",D,""),-1)  Q:J=""  S:J>RA RA=J
"RTN","RMPORPD",85,0)
 S:RA'="" Y=$P($G(^RMPR(665,D0,"RMPOB",RA,0)),U,3)
"RTN","RMPORPD",86,0)
 S X=$S('Y:"N/A",'$G(MODE):$$DATE(Y),1:Y)
"RTN","RMPORPD",87,0)
 Q X
"RTN","RMPORPD",88,0)
 ;
"RTN","RMPORPD",89,0)
SSN() ;*** SOCIAL SECURITY NUMBER
"RTN","RMPORPD",90,0)
 K VA,VADM
"RTN","RMPORPD",91,0)
 S DFN=D0  D ^VADPT
"RTN","RMPORPD",92,0)
 S X=$P(VA("PID"),"-",3)
"RTN","RMPORPD",93,0)
 Q X
"RTN","RMPORPD",94,0)
DIOEND ;TOTAL PRINT
"RTN","RMPORPD",95,0)
 S COUNT=$E("      ",1,(6-$L(COUNT)))_COUNT
"RTN","RMPORPD",96,0)
 W !!,?47,"Total Patients: ",COUNT
"RTN","RMPORPD",97,0)
 S RMPODCNT=$E("      ",1,(6-$L(RMPODCNT)))_RMPODCNT   ;RMPR*3.0*179
"RTN","RMPORPD",98,0)
 W !,?38,"Total Deceased Patients: ",RMPODCNT   ;RMPR*3.0*179
"RTN","RMPORPD",99,0)
 Q
"RTN","RMPORPR")
0^7^B24121642^B20584580
"RTN","RMPORPR",1,0)
RMPORPR ;VA-EDS/PAK LIST HOME OXY PTS PRESCRIPTIONS/ITEMS ;7/24/98
"RTN","RMPORPR",2,0)
 ;;3.0;PROSTHETICS;**29,55,179**;Feb 09, 1996;Build 7
"RTN","RMPORPR",3,0)
 ;
"RTN","RMPORPR",4,0)
 ; ODJ - patch 55 - re nois FGH-0800-33046 - make sure that if all
"RTN","RMPORPR",5,0)
 ;       12/5/00    patients option chosen dont print inactives
"RTN","RMPORPR",6,0)
 ;
"RTN","RMPORPR",7,0)
 ;RMPR*3.0*179 Flag a deceased patient by adding an '*'
"RTN","RMPORPR",8,0)
 ;             in front of SSN. 
"RTN","RMPORPR",9,0)
 ;
"RTN","RMPORPR",10,0)
START ; Compile and print report 
"RTN","RMPORPR",11,0)
 ;Set up the site.
"RTN","RMPORPR",12,0)
 D HOSITE^RMPOUTL0 I '$D(RMPOXITE) Q
"RTN","RMPORPR",13,0)
 ;
"RTN","RMPORPR",14,0)
 ;Intialize variables.
"RTN","RMPORPR",15,0)
 K DIR,DIC,DIS,DIRUT,DUOUT,DTOUT,ALL S RMPODCNT=0
"RTN","RMPORPR",16,0)
 ;
"RTN","RMPORPR",17,0)
 ; Choose one or all patients
"RTN","RMPORPR",18,0)
 S DIR(0)="Y",DIR("A")="Select All Patients",DIR("B")="NO" D ^DIR
"RTN","RMPORPR",19,0)
 Q:Y="^"!$D(DTOUT)  S ALL=Y
"RTN","RMPORPR",20,0)
 ; select patient
"RTN","RMPORPR",21,0)
 I 'ALL D SELP Q:Y<1  S (FR(1),TO(1))=Y(0,0),FR(2)=""
"RTN","RMPORPR",22,0)
 ; if all patients selected then print only those which are active
"RTN","RMPORPR",23,0)
 ; and are associated with current site.
"RTN","RMPORPR",24,0)
 I ALL S DIS(0)="I $P($G(^RMPR(665,D0,""RMPOA"")),U,7)=RMPOXITE,$P($G(^RMPR(665,D0,""RMPOA"")),U,2)'="""",$P($G(^RMPR(665,D0,""RMPOA"")),U,3)=""""",(FR,TO)=""
"RTN","RMPORPR",25,0)
 ; compile report        
"RTN","RMPORPR",26,0)
 D PRINT
"RTN","RMPORPR",27,0)
 D EXIT
"RTN","RMPORPR",28,0)
 Q
"RTN","RMPORPR",29,0)
 ;
"RTN","RMPORPR",30,0)
SELP ; Select patient
"RTN","RMPORPR",31,0)
 N DIR
"RTN","RMPORPR",32,0)
 S DIR(0)="P^665:EMZ"
"RTN","RMPORPR",33,0)
 S DIR("S")="I $P($G(^RMPR(665,Y,""RMPOA"")),U,7)=RMPOXITE,$P($G(^RMPR(665,Y,""RMPOA"")),U,2)'="""""
"RTN","RMPORPR",34,0)
 D ^DIR
"RTN","RMPORPR",35,0)
 Q
"RTN","RMPORPR",36,0)
 ;
"RTN","RMPORPR",37,0)
PRINT ; Print report
"RTN","RMPORPR",38,0)
 S $P(SP," ",80)="",(^TMP("RMPO",$J,"EXTC"),COUNT,PAGE,RMEND,RMPORPT)=0
"RTN","RMPORPR",39,0)
 S $P(BRK,"*",80)="*"
"RTN","RMPORPR",40,0)
 ; get current date to print in header
"RTN","RMPORPR",41,0)
 D NOW^%DTC S Y=% X ^DD("DD")
"RTN","RMPORPR",42,0)
 S RPTDT=$P(Y,"@",1)_" "_$P($P(Y,"@",2),":",1,2)
"RTN","RMPORPR",43,0)
 ; define core print driver parameters
"RTN","RMPORPR",44,0)
 S DIC="^RMPR(665,",BY=".01,19.4,1",L=0  ; sort by patient,Rx then vendor
"RTN","RMPORPR",45,0)
 S DHD="W ?0 D RPTHDR^RMPORPR"
"RTN","RMPORPR",46,0)
 S DIOEND="I $G(Y)'[U D END^RMPORPR S RMEND=1 S:IOST[""P-"" RMPORPT=1"
"RTN","RMPORPR",47,0)
 ; print sub heading
"RTN","RMPORPR",48,0)
 S FLDS="""Date Current"";C50"
"RTN","RMPORPR",49,0)
 S FLDS(1)="""Name"";C1,""SSN"";C25,""Activation Date"";C33,""Prescription Expires"";50"
"RTN","RMPORPR",50,0)
 S FLDS(2)="""================="";C1,""===="";C25,""==============="";C33,""====================="";C50"
"RTN","RMPORPR",51,0)
 ; print patient name
"RTN","RMPORPR",52,0)
 S FLDS(3)=".01;C1;L22;""PATIENT"""
"RTN","RMPORPR",53,0)
 ; print SSN
"RTN","RMPORPR",54,0)
 S FLDS(4)="W $$SSN^RMPORPR;C24;R5;""SSN"""
"RTN","RMPORPR",55,0)
 ; print Rx activation date, expiry date & prescription detail
"RTN","RMPORPR",56,0)
 S FLDS(5)="19.3,.01;C33,2;C50,3;S;C1"
"RTN","RMPORPR",57,0)
 S FLDS(6)=""""";C1;S"     ; spacer line
"RTN","RMPORPR",58,0)
 S FLDS(7)="19.4,1;C1;N"  ; vendor - no duplicates
"RTN","RMPORPR",59,0)
 ; print item detail for current prescription
"RTN","RMPORPR",60,0)
 S FLDS(8)="""Fund"";C68;S"
"RTN","RMPORPR",61,0)
 S FLDS(9)=""""";C1"
"RTN","RMPORPR",62,0)
 S FLDS(10)="""Extended"";C57,""Control"";C68"
"RTN","RMPORPR",63,0)
 S FLDS(11)="""HCPCS"";C1,""Item"";C9,""Qty"";C32,""Unit Cost"";C42,""Cost"";C57,""Point"";C68"
"RTN","RMPORPR",64,0)
 S FLDS(12)="""-----"";C1,""----"";C9,""---"";C32,""---------"";C42,""----"";C57,""-----"";C68"
"RTN","RMPORPR",65,0)
 S FLDS(13)="19.4,W $$ADTL^RMPORPR;C1,6;C1;L8,.01;C9;L21,2;C32;L4,3;C42;L8,W $$COST^RMPORPR;C57,W $$FCP^RMPORPR;C68"
"RTN","RMPORPR",66,0)
 S FLDS(14)="W $$EXTC^RMPORPR;C1"
"RTN","RMPORPR",67,0)
 S FLDS(15)="""Inactivation Date: "";C1,19.5"
"RTN","RMPORPR",68,0)
 S FLDS(16)="""Inactivation Reason: "";C1,19.6"
"RTN","RMPORPR",69,0)
 S FLDS(17)="W BRK;C1"
"RTN","RMPORPR",70,0)
 S (RMPODFN,RMPOITEM)=0
"RTN","RMPORPR",71,0)
 D EN1^DIP
"RTN","RMPORPR",72,0)
 I RMPORPT=0,$G(RMEND) K DIR S DIR(0)="E" D ^DIR
"RTN","RMPORPR",73,0)
 Q
"RTN","RMPORPR",74,0)
 ;
"RTN","RMPORPR",75,0)
ADTL() ;  Get Additional detail: cost, FCP and calculate total cost of all items
"RTN","RMPORPR",76,0)
 N REC,QTY,UCOST,COST,FCP
"RTN","RMPORPR",77,0)
 ;
"RTN","RMPORPR",78,0)
 I RMPODFN'=D0 S RMPODFN=D0,RMPOITEM=0
"RTN","RMPORPR",79,0)
 S RMPOITEM=$O(^RMPR(665,RMPODFN,"RMPOC",RMPOITEM)) Q:'+RMPOITEM ""
"RTN","RMPORPR",80,0)
 ;
"RTN","RMPORPR",81,0)
 ; quit if no items
"RTN","RMPORPR",82,0)
 I RMPOITEM="" S ^TMP("RMPO",$J,"ADTL")="" Q ""
"RTN","RMPORPR",83,0)
 ;
"RTN","RMPORPR",84,0)
 S REC=^RMPR(665,RMPODFN,"RMPOC",RMPOITEM,0)
"RTN","RMPORPR",85,0)
 S QTY=$P(REC,U,3),UCOST=$P(REC,U,4),FCP=$P($P(REC,U,6)," ")
"RTN","RMPORPR",86,0)
 S UCOST=UCOST*100,COST=QTY*UCOST,COST=$J(COST/100,0,2)
"RTN","RMPORPR",87,0)
 S ^TMP("RMPO",$J,"ADTL")=COST_U_FCP
"RTN","RMPORPR",88,0)
 S ^TMP("RMPO",$J,"EXTC")=$G(^TMP("RMPO",$J,"EXTC"))+COST
"RTN","RMPORPR",89,0)
 Q ""
"RTN","RMPORPR",90,0)
 ;
"RTN","RMPORPR",91,0)
COST() Q $P(^TMP("RMPO",$J,"ADTL"),U)
"RTN","RMPORPR",92,0)
 ;
"RTN","RMPORPR",93,0)
FCP() Q $P(^TMP("RMPO",$J,"ADTL"),U,2)
"RTN","RMPORPR",94,0)
 ;
"RTN","RMPORPR",95,0)
EXTC() ; Return extended cost
"RTN","RMPORPR",96,0)
 N EXTC
"RTN","RMPORPR",97,0)
 S EXTC=^TMP("RMPO",$J,"EXTC"),^TMP("RMPO",$J,"EXTC")=0
"RTN","RMPORPR",98,0)
 Q $E(SP,1,41)_"Total Cost"_$E(SP,1,5)_$J(EXTC,0,2)
"RTN","RMPORPR",99,0)
 ;
"RTN","RMPORPR",100,0)
EXIT ;
"RTN","RMPORPR",101,0)
 K COUNT,DTSTRG,SP,RD,RI,RNAM,BRK,X1,PAGE,RPTDT
"RTN","RMPORPR",102,0)
 K ROK,RY,DFN,VA,VADM,EXPDT,EXTC,RMPOITEM,RMPORX
"RTN","RMPORPR",103,0)
 K ^TMP("RMPO",$J) N RMPR,RMPRSITE D KILL^XUSCLEAN
"RTN","RMPORPR",104,0)
 Q
"RTN","RMPORPR",105,0)
 ;
"RTN","RMPORPR",106,0)
END ; End the report line
"RTN","RMPORPR",107,0)
 S COUNT=$E("      ",1,6-$L(COUNT))_COUNT
"RTN","RMPORPR",108,0)
 W !!,?47,"Total Patients: ",COUNT
"RTN","RMPORPR",109,0)
 S RMPODCNT=$E("      ",1,(6-$L(RMPODCNT)))_RMPODCNT   ;RMPR*3.0*179
"RTN","RMPORPR",110,0)
 W !,?38,"Total Deceased Patients: ",RMPODCNT   ;RMPR*3.0*179
"RTN","RMPORPR",111,0)
 Q
"RTN","RMPORPR",112,0)
 ;
"RTN","RMPORPR",113,0)
SSN() ; Get SSN    ;RNPR*3.0*179 Flag a deceased patient by attaching an '*' to SSN. ^DPT(D0,.35) direct read supported by ICR #10035
"RTN","RMPORPR",114,0)
 N X,RMPOEXP
"RTN","RMPORPR",115,0)
 S X="",RMPOEXP=" "
"RTN","RMPORPR",116,0)
 I +$G(^DPT(D0,.35)) S RMPOEXP="*"
"RTN","RMPORPR",117,0)
 K VA,VADM S DFN=D0 D ^VADPT
"RTN","RMPORPR",118,0)
 S X=$P(VA("PID"),"-",3)
"RTN","RMPORPR",119,0)
 I X'="" S X=RMPOEXP_X,COUNT=COUNT+1 S:RMPOEXP="*" RMPODCNT=RMPODCNT+1
"RTN","RMPORPR",120,0)
 Q X
"RTN","RMPORPR",121,0)
 ;
"RTN","RMPORPR",122,0)
SDT() ; Get Rx activation Date.
"RTN","RMPORPR",123,0)
 N X
"RTN","RMPORPR",124,0)
 ;
"RTN","RMPORPR",125,0)
 S X=$P($G(^RMPR(665,D0,"RMPOA")),U,2)
"RTN","RMPORPR",126,0)
 I X S X=$E(X,4,5)_"/"_$E(X,6,7)_"/"_($E(X,1,3)+1700)
"RTN","RMPORPR",127,0)
 Q X
"RTN","RMPORPR",128,0)
 ;
"RTN","RMPORPR",129,0)
EDT() ; Get the most recently entered Rx.
"RTN","RMPORPR",130,0)
 N RC,X
"RTN","RMPORPR",131,0)
 ;
"RTN","RMPORPR",132,0)
 S RMPORXDT=$O(^RMPR(665,D0,"RMPOB","B",""),-1)
"RTN","RMPORPR",133,0)
 ; if no prescription clear RMPORX and quit
"RTN","RMPORPR",134,0)
 I RMPORXDT="" S RMPORX="" Q 0
"RTN","RMPORPR",135,0)
 ; get Rx
"RTN","RMPORPR",136,0)
 S RMPORX=$O(^RMPR(665,D0,"RMPOB","B",RMPORXDT,""))
"RTN","RMPORPR",137,0)
 ; get Rx expire date
"RTN","RMPORPR",138,0)
 S RC=$P($G(^RMPR(665,D0,"RMPOB",RMPORX,0)),U,3)
"RTN","RMPORPR",139,0)
 Q $E(RC,4,5)_"/"_$E(RC,6,7)_"/"_($E(RC,1,3)+1700)
"RTN","RMPORPR",140,0)
 ;
"RTN","RMPORPR",141,0)
RPTHDR ; Report header      
"RTN","RMPORPR",142,0)
 S PAGE=PAGE+1
"RTN","RMPORPR",143,0)
 W RPTDT,?(40-($L(RMPO("NAME"))/2)),RMPO("NAME"),?65,"Page: "_PAGE
"RTN","RMPORPR",144,0)
 W !,?23,"Prescription Report",?52,"* denotes deceased patient",!
"RTN","RMPORPR",145,0)
 Q
"RTN","RMPROPN1")
0^9^B10807707^B10218467
"RTN","RMPROPN1",1,0)
RMPROPN1 ;PHX/RFM-LISTS OPEN STOCK ISSUES ;8/29/1994
"RTN","RMPROPN1",2,0)
 ;;3.0;PROSTHETICS;**13,77,179**;Feb 09, 1996;Build 7
"RTN","RMPROPN1",3,0)
 ;RVD 3/17/03 patch #77 - allow queing to p-message.  IO to ION
"RTN","RMPROPN1",4,0)
 ;
"RTN","RMPROPN1",5,0)
 ;RMPR*3.0*179 Insure work file is killed before processing report
"RTN","RMPROPN1",6,0)
 ;
"RTN","RMPROPN1",7,0)
 D DIV4^RMPRSIT G:$D(X) EXIT
"RTN","RMPROPN1",8,0)
START K ^TMP($J)     ;RMPR*3.0*179
"RTN","RMPROPN1",9,0)
 S RMPRCOUN=0 D HOME^%ZIS W !! S %DT("A")="Starting Date: ",%DT="AEPX" D ^%DT S RMPRBDT=Y G:Y<0 EXIT
"RTN","RMPROPN1",10,0)
 S %DT("A")="Ending Date: ",%DT="AEX" D ^%DT G:Y<0 EXIT I RMPRBDT>Y W !,$C(7),"Invalid Date Range Selection!!" G START
"RTN","RMPROPN1",11,0)
 S RMPREDT=Y,RMPREDT=RMPREDT+1 G:Y<0 EXIT S Y=RMPRBDT D DD^%DT S RMPRX=Y,Y=RMPREDT-1 D DD^%DT S RMPRY=Y
"RTN","RMPROPN1",12,0)
 S %ZIS="MQ" K IOP D ^%ZIS G:POP EXIT
"RTN","RMPROPN1",13,0)
 I '$D(IO("Q")) U IO G PRINT
"RTN","RMPROPN1",14,0)
 S ZTDESC="OPEN STOCK ISSUES",ZTRTN="PRINT^RMPROPN1",ZTIO=ION,ZTSAVE("RMPRBDT")="",ZTSAVE("RMPREDT")="",ZTSAVE("RMPRX")="",ZTSAVE("RMPRY")="",ZTSAVE("RMPR(""STA"")")=""
"RTN","RMPROPN1",15,0)
 D ^%ZTLOAD W:$D(ZTSK) !,"REQUEST QUEUED!" H 1 G EXIT
"RTN","RMPROPN1",16,0)
PRINT S X1=RMPRBDT,X2=-1 D C^%DTC S RO=X,RP=0,PAGE=1,RMPRCOUN=0,RMPREND="" I IOST["C-" D WAIT^DICD
"RTN","RMPROPN1",17,0)
 F  S RO=$O(^RMPR(660,"B",RO)) Q:RO'>0  Q:RO>RMPREDT  F  S RP=$O(^RMPR(660,"B",RO,RP)) Q:RP'>0  D CK
"RTN","RMPROPN1",18,0)
 S RP=0 F  S RP=$O(^TMP($J,RP)) Q:RP=""!(RMPREND=1)  D WRI
"RTN","RMPROPN1",19,0)
 I $D(RMPREDT)&(RMPRCOUN=0) W @IOF D HDR W $C(7),!!,"NO SELECTIONS MADE DURING THIS DATE RANGE!!"
"RTN","RMPROPN1",20,0)
 I $D(RMPREDT),RMPRCOUN>0,RMPREND'=1 W !!?32,"END OF REPORT" H 1
"RTN","RMPROPN1",21,0)
EXIT I $E(IOST)["C"&($Y<20) F  W ! Q:$Y>20
"RTN","RMPROPN1",22,0)
 I $D(RMPREDT),'$D(DTOUT),'$D(DUOUT),$E(IOST)["C",'$D(RMPRFLL),RMPREND'=1 S DIR(0)="E" D ^DIR
"RTN","RMPROPN1",23,0)
EX K RMPREND,RMPROBL,RMPRFLL,RMPRFLG,DUOUT,DIR,RO,RP,RMPRY,RMPRCOUN,RMPRX,RMPRBDT,RMPREDT,RMPRCK,%DT,X,Y,PAGE,IT,ZTSK,^TMP($J) D ^%ZISC Q
"RTN","RMPROPN1",24,0)
 Q
"RTN","RMPROPN1",25,0)
CK N RMPRX
"RTN","RMPROPN1",26,0)
 S RMPRX=$G(^RMPR(660,RP,0))
"RTN","RMPROPN1",27,0)
 Q:'RMPRX
"RTN","RMPROPN1",28,0)
 Q:+$P(RMPRX,U,12)!($P(RMPRX,U,10)'=RMPR("STA"))!($P(RMPRX,U,13)=13)
"RTN","RMPROPN1",29,0)
 Q:$P(RMPRX,U,13)'>10
"RTN","RMPROPN1",30,0)
 ;screen VISA
"RTN","RMPROPN1",31,0)
 Q:$P(RMPRX,U,13)=14
"RTN","RMPROPN1",32,0)
 S ^TMP($J,RP)="",RMPRCOUN=RMPRCOUN+1
"RTN","RMPROPN1",33,0)
 Q
"RTN","RMPROPN1",34,0)
WRI I '$D(RMPRFLG) D HDR W !,"PATIENT NAME",?14,"SSN",?20,"REQUEST DATE",?34,"VENDOR",?49,"ITEM",?70,"ITEM COST"
"RTN","RMPROPN1",35,0)
 W !,$E($P(^DPT($P(^RMPR(660,RP,0),U,2),0),U,1),1,12),?14,$E($P(^(0),U,9),6,9)
"RTN","RMPROPN1",36,0)
 S Y=$P(^RMPR(660,RP,0),U,1) D DD^%DT S Y=$E(Y,1,12) W ?20,Y,?34 I +$P(^RMPR(660,RP,0),U,9),$D(^PRC(440,$P(^(0),U,9),0)) W $E($P(^PRC(440,$P(^RMPR(660,RP,0),U,9),0),U,1),1,13)
"RTN","RMPROPN1",37,0)
 W ?49 I $D(^PRC(441,$P(^RMPR(661,+$P(^RMPR(660,RP,0),U,6),0),U),0)) W $E($P(^(0),U,2),1,18)
"RTN","RMPROPN1",38,0)
 W ?70,$J($FN(+$P(^RMPR(660,RP,0),U,16),"P",2),10)
"RTN","RMPROPN1",39,0)
 S RMPRFLG=1
"RTN","RMPROPN1",40,0)
 I $E(IOST)["C-"&($Y>(IOSL-6)) W ! S DIR(0)="E" D ^DIR S:Y<1 RMPREND=1 Q:Y=""  S:Y<1 RMPRFLL=1 Q:Y<1  S:$D(DTOUT) RMPREND=1 Q:$D(DTOUT)  D HDR Q
"RTN","RMPROPN1",41,0)
 I $Y>(IOSL-6) K RMPRFLG
"RTN","RMPROPN1",42,0)
 Q
"RTN","RMPROPN1",43,0)
HDR I PAGE'=1!($E(IOST)["C") W @IOF
"RTN","RMPROPN1",44,0)
 W !,"FROM: ",RMPRX_"-",RMPRY,?34,"OPEN STOCK ISSUES",?72,"PAGE ",PAGE,! S PAGE=PAGE+1 Q
"VER")
8.0^22.0
"BLD",9056,6)
^156
**END**
**END**

