Released RMPR*3*180 SEQ #158
Extracted from mail message
**KIDS**:RMPR*3.0*180^

**INSTALL NAME**
RMPR*3.0*180
"BLD",9390,0)
RMPR*3.0*180^PROSTHETICS^0^3160815^y
"BLD",9390,1,0)
^^8^8^3160420^
"BLD",9390,1,1,0)
1) Adding a new prescription to a Home Oxygen patient, will allow the
"BLD",9390,1,2,0)
   user to associate an inactive HCPCS code.
"BLD",9390,1,3,0)
                                                                 
"BLD",9390,1,4,0)
2) Remove all routines & option for Patient Notification Letter processing
"BLD",9390,1,5,0)
 
"BLD",9390,1,6,0)
3) Home Oxygen 'New Patient' report gets <undefined> error
"BLD",9390,1,7,0)
 
"BLD",9390,1,8,0)
4) Site is unable to edit MODEL#/CONTRACT# in option Edit 2319
"BLD",9390,4,0)
^9.64PA^^
"BLD",9390,6.3)
12
"BLD",9390,"ABPKG")
n
"BLD",9390,"INI")
EN^RMPRTDEL
"BLD",9390,"INID")
^^y
"BLD",9390,"KRN",0)
^9.67PA^779.2^20
"BLD",9390,"KRN",.4,0)
.4
"BLD",9390,"KRN",.401,0)
.401
"BLD",9390,"KRN",.402,0)
.402
"BLD",9390,"KRN",.403,0)
.403
"BLD",9390,"KRN",.5,0)
.5
"BLD",9390,"KRN",.84,0)
.84
"BLD",9390,"KRN",3.6,0)
3.6
"BLD",9390,"KRN",3.8,0)
3.8
"BLD",9390,"KRN",9.2,0)
9.2
"BLD",9390,"KRN",9.8,0)
9.8
"BLD",9390,"KRN",9.8,"NM",0)
^9.68A^8^8
"BLD",9390,"KRN",9.8,"NM",1,0)
RMPOPED^^0^B312319222
"BLD",9390,"KRN",9.8,"NM",2,0)
RMPRDVN^^1^
"BLD",9390,"KRN",9.8,"NM",3,0)
RMPRDVN1^^1^
"BLD",9390,"KRN",9.8,"NM",4,0)
RMPRDVN2^^1^
"BLD",9390,"KRN",9.8,"NM",5,0)
RMPRDVN3^^1^
"BLD",9390,"KRN",9.8,"NM",6,0)
RMPORNQ^^0^B6321620
"BLD",9390,"KRN",9.8,"NM",7,0)
RMPRE29^^0^B41267108
"BLD",9390,"KRN",9.8,"NM",8,0)
RMPRTDEL^^0^B1345520
"BLD",9390,"KRN",9.8,"NM","B","RMPOPED",1)

"BLD",9390,"KRN",9.8,"NM","B","RMPORNQ",6)

"BLD",9390,"KRN",9.8,"NM","B","RMPRDVN",2)

"BLD",9390,"KRN",9.8,"NM","B","RMPRDVN1",3)

"BLD",9390,"KRN",9.8,"NM","B","RMPRDVN2",4)

"BLD",9390,"KRN",9.8,"NM","B","RMPRDVN3",5)

"BLD",9390,"KRN",9.8,"NM","B","RMPRE29",7)

"BLD",9390,"KRN",9.8,"NM","B","RMPRTDEL",8)

"BLD",9390,"KRN",19,0)
19
"BLD",9390,"KRN",19,"NM",0)
^9.68A^1^1
"BLD",9390,"KRN",19,"NM",1,0)
RMPR DVN NIGHTLY JOB^^1^
"BLD",9390,"KRN",19,"NM","B","RMPR DVN NIGHTLY JOB",1)

"BLD",9390,"KRN",19.1,0)
19.1
"BLD",9390,"KRN",101,0)
101
"BLD",9390,"KRN",409.61,0)
409.61
"BLD",9390,"KRN",771,0)
771
"BLD",9390,"KRN",779.2,0)
779.2
"BLD",9390,"KRN",870,0)
870
"BLD",9390,"KRN",8989.51,0)
8989.51
"BLD",9390,"KRN",8989.52,0)
8989.52
"BLD",9390,"KRN",8994,0)
8994
"BLD",9390,"KRN","B",.4,.4)

"BLD",9390,"KRN","B",.401,.401)

"BLD",9390,"KRN","B",.402,.402)

"BLD",9390,"KRN","B",.403,.403)

"BLD",9390,"KRN","B",.5,.5)

"BLD",9390,"KRN","B",.84,.84)

"BLD",9390,"KRN","B",3.6,3.6)

"BLD",9390,"KRN","B",3.8,3.8)

"BLD",9390,"KRN","B",9.2,9.2)

"BLD",9390,"KRN","B",9.8,9.8)

"BLD",9390,"KRN","B",19,19)

"BLD",9390,"KRN","B",19.1,19.1)

"BLD",9390,"KRN","B",101,101)

"BLD",9390,"KRN","B",409.61,409.61)

"BLD",9390,"KRN","B",771,771)

"BLD",9390,"KRN","B",779.2,779.2)

"BLD",9390,"KRN","B",870,870)

"BLD",9390,"KRN","B",8989.51,8989.51)

"BLD",9390,"KRN","B",8989.52,8989.52)

"BLD",9390,"KRN","B",8994,8994)

"BLD",9390,"QDEF")
^^^^^^^^^^YES
"BLD",9390,"QUES",0)
^9.62^^
"BLD",9390,"REQB",0)
^9.611^2^1
"BLD",9390,"REQB",2,0)
RMPR*3.0*150^2
"BLD",9390,"REQB",3,0)
RMPR*3.0*168^2
"BLD",9390,"REQB","B","RMPR*3.0*150",2)

"BLD",9390,"REQB","B","RMPR*3.0*168",3)

"INI")
EN^RMPRTDEL
"KRN",19,13874,-1)
1^1
"KRN",19,13874,0)
RMPR DVN NIGHTLY JOB
"MBREQ")
0
"ORD",0,9.8)
9.8;;1;RTNF^XPDTA;RTNE^XPDTA
"ORD",0,9.8,0)
ROUTINE
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"PKG",101,-1)
1^1
"PKG",101,0)
PROSTHETICS^RMPR^PROSTHETICS VERSION 3.0 ALPHA
"PKG",101,20,0)
^9.402P^^0
"PKG",101,22,0)
^9.49I^1^1
"PKG",101,22,1,0)
3.0^2960209^2960214
"PKG",101,22,1,"PAH",1,0)
180^3160815
"PKG",101,22,1,"PAH",1,1,0)
^^8^8^3160815
"PKG",101,22,1,"PAH",1,1,1,0)
1) Adding a new prescription to a Home Oxygen patient, will allow the
"PKG",101,22,1,"PAH",1,1,2,0)
   user to associate an inactive HCPCS code.
"PKG",101,22,1,"PAH",1,1,3,0)
                                                                 
"PKG",101,22,1,"PAH",1,1,4,0)
2) Remove all routines & option for Patient Notification Letter processing
"PKG",101,22,1,"PAH",1,1,5,0)
 
"PKG",101,22,1,"PAH",1,1,6,0)
3) Home Oxygen 'New Patient' report gets <undefined> error
"PKG",101,22,1,"PAH",1,1,7,0)
 
"PKG",101,22,1,"PAH",1,1,8,0)
4) Site is unable to edit MODEL#/CONTRACT# in option Edit 2319
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
8
"RTN","RMPOPED")
0^1^B312319222^B301665198
"RTN","RMPOPED",1,0)
RMPOPED ;EDS/MDB,DDW,RVD - HOME OXYGEN MISC FILE EDITS ;7/24/98
"RTN","RMPOPED",2,0)
 ;;3.0;PROSTHETICS;**29,44,41,52,77,110,140,148,168,180**;Feb 09, 1996;Build 12
"RTN","RMPOPED",3,0)
 ;
"RTN","RMPOPED",4,0)
 ; Reference to $$SINFO^ICDEX supported by ICR #5747
"RTN","RMPOPED",5,0)
 ; Reference to $$CSI^ICDEX   supported by ICR #5747 
"RTN","RMPOPED",6,0)
 ; Reference to $$ICDDX^ICDEX supported by ICR #5747
"RTN","RMPOPED",7,0)
 ; Reference to $$VLT^ICDEX   supported by ICR #5747
"RTN","RMPOPED",8,0)
 ; Reference to $$CODEC^ICDEX supported by ICR #5747
"RTN","RMPOPED",9,0)
 ; Reference to $$LS^ICDEX    supported by ICR #5747
"RTN","RMPOPED",10,0)
 ;
"RTN","RMPOPED",11,0)
 ; HNC - patch 52
"RTN","RMPOPED",12,0)
 ;                 modified SITECHK sub
"RTN","RMPOPED",13,0)
 ;                 X will be undefined from GETS^DIQ if field is null
"RTN","RMPOPED",14,0)
 ;                 added $G.
"RTN","RMPOPED",15,0)
 ; RVD - patch #77 use FileMan to set items that are not Primary item
"RTN","RMPOPED",16,0)
 ;                 to 'N' in order to set correctly the 'AC' cross-ref.
"RTN","RMPOPED",17,0)
 ;
"RTN","RMPOPED",18,0)
 ; RGB - PATCH 180 When HCPCS code displays inactive message the user 
"RTN","RMPOPED",19,0)
 ;                 will now be required to use an active code
"RTN","RMPOPED",20,0)
 Q
"RTN","RMPOPED",21,0)
UNLOCK I $D(RMPODFN) L -^RMPR(665,RMPODFN)
"RTN","RMPOPED",22,0)
 Q
"RTN","RMPOPED",23,0)
EXIT K DIC,DIE,DIR,DIK,X,Y,Z,DR,DA,DD,DO,D0,DTOUT,DIROUT,DUOUT,DIRUT,QUIT,DFN,ITEM,ITEMS,IEN,IENS,ITMACT,ITM,C,S,W,PI,VDR,ZST
"RTN","RMPOPED",24,0)
 D UNLOCK
"RTN","RMPOPED",25,0)
 Q
"RTN","RMPOPED",26,0)
 ;
"RTN","RMPOPED",27,0)
KEY ;user must have the RMPRSUPERVISOR key in order to add a new patient.
"RTN","RMPOPED",28,0)
 ;option name is EDIT HOME OXYGEN PATIENT
"RTN","RMPOPED",29,0)
 N KEY
"RTN","RMPOPED",30,0)
 S KEY=$O(^DIC(19.1,"B","RMPRSUPERVISOR",0))
"RTN","RMPOPED",31,0)
 I '$D(^VA(200,DUZ,51,KEY)) D  Q
"RTN","RMPOPED",32,0)
 . W !!,"You do not hold the RMPRSUPERVISOR key!!"
"RTN","RMPOPED",33,0)
 G PAT
"RTN","RMPOPED",34,0)
 ;
"RTN","RMPOPED",35,0)
SITE ; Editing of Home Oxygen site parameter file.
"RTN","RMPOPED",36,0)
 K DIC,DIE,DA,DR,DD,RMPOXITE
"RTN","RMPOPED",37,0)
 S DIC="^RMPR(669.9,",DIC(0)="QEAMLZ",DIC("A")="Select SITE: "
"RTN","RMPOPED",38,0)
 D ^DIC Q:Y<0!$$QUIT
"RTN","RMPOPED",39,0)
 K DIC("A")
"RTN","RMPOPED",40,0)
 S (DA,RMPOXITE)=+Y
"RTN","RMPOPED",41,0)
 ; Lock it...
"RTN","RMPOPED",42,0)
 L +^RMPR(669.9,RMPOXITE):2
"RTN","RMPOPED",43,0)
 I '$T D  G SITE
"RTN","RMPOPED",44,0)
 . W ?10,$C(7)_Y(0,0)_" -- record in use. Try again later."
"RTN","RMPOPED",45,0)
 ; Edit it
"RTN","RMPOPED",46,0)
 S DIE=DIC,DR="60;61;62;65" D ^DIE Q:$$EQUIT
"RTN","RMPOPED",47,0)
 ; Edit FCP
"RTN","RMPOPED",48,0)
 K DIC,DA,DD,DR,DIE
"RTN","RMPOPED",49,0)
 ;
"RTN","RMPOPED",50,0)
 ; Done.  Unlock
"RTN","RMPOPED",51,0)
 L -^RMPR(669.9,RMPOXITE)
"RTN","RMPOPED",52,0)
 G SITE
"RTN","RMPOPED",53,0)
 ;
"RTN","RMPOPED",54,0)
FCPHLP ; Executable help for FCP multiple in 669.9
"RTN","RMPOPED",55,0)
 ;
"RTN","RMPOPED",56,0)
 Q
"RTN","RMPOPED",57,0)
FCPIX ; Input transform for FCP multiple in 669.9
"RTN","RMPOPED",58,0)
 ;
"RTN","RMPOPED",59,0)
 Q:'$D(X)
"RTN","RMPOPED",60,0)
 I $L(X)>30!($L(X)<3) K X Q
"RTN","RMPOPED",61,0)
 S ZST=$P(^RMPR(669.9,D0,4),U,1),RMPOX=X
"RTN","RMPOPED",62,0)
 D FIND^DIC(420.01,","_ZST_",",".01;","M",X,1,,,,"X")
"RTN","RMPOPED",63,0)
 S X=$S($D(X("DILIST","ID",1,.01)):X("DILIST","ID",1,.01),1:RMPOX)
"RTN","RMPOPED",64,0)
 K X("DILIST"),RMPOX
"RTN","RMPOPED",65,0)
 I $G(ZST),('$D(^PRC(420,+ZST,1,"B",X))) W !,"Control Point is not a valid IFCAP FCP.." K X
"RTN","RMPOPED",66,0)
 Q
"RTN","RMPOPED",67,0)
ACT ;activate/inactivate a home oxygen patient
"RTN","RMPOPED",68,0)
 ;Set up site variables.
"RTN","RMPOPED",69,0)
 D HOSITE^RMPOUTL0 I QUIT D EXIT Q
"RTN","RMPOPED",70,0)
 W @IOF
"RTN","RMPOPED",71,0)
 ;
"RTN","RMPOPED",72,0)
ACT1 ;Toggle ACTIVATE/INACTIVATE functions.
"RTN","RMPOPED",73,0)
 N NAME K DIC,DA
"RTN","RMPOPED",74,0)
 S DIC="^RMPR(665,",DIC(0)="QEAMZ" D ^DIC I Y<0!$$QUIT D EXIT Q
"RTN","RMPOPED",75,0)
 S DIE=DIC,DA=+Y,NAME=Y(0,0)
"RTN","RMPOPED",76,0)
 L +^RMPR(665,DA):2
"RTN","RMPOPED",77,0)
 I '$T D  G ACT1
"RTN","RMPOPED",78,0)
 . W ?10,$C(7)_Y(0,0)_" -- record in use. Try later."
"RTN","RMPOPED",79,0)
 ;If the patient has never been activated, quit.
"RTN","RMPOPED",80,0)
 I $P($G(^RMPR(665,DA,"RMPOA")),U,2)="" D  G ACT1
"RTN","RMPOPED",81,0)
 . W !!,$C(7)_NAME_" has not been added as a Home Oxygen patient."
"RTN","RMPOPED",82,0)
 . W !,"Please add using the ""Add/Edit Home Oxygen Patient"" option."
"RTN","RMPOPED",83,0)
 ;If the patient is active, perform inactivation actions.
"RTN","RMPOPED",84,0)
 I $P($G(^RMPR(665,DA,"RMPOA")),U,3)="" D INACTVT^RMPOPED G ACT1
"RTN","RMPOPED",85,0)
 ;If the patient is inactive, perform activation actions.
"RTN","RMPOPED",86,0)
 I $P($G(^RMPR(665,DA,"RMPOA")),U,3)'="" D ACTVT^RMPOPED G ACT1
"RTN","RMPOPED",87,0)
 Q
"RTN","RMPOPED",88,0)
INACTVT ; Inactivate the patient if user wants to.
"RTN","RMPOPED",89,0)
 ; Confirm if the user wants to proceed.
"RTN","RMPOPED",90,0)
 K DIR S DIR(0)="YO",DIR("B")="NO"
"RTN","RMPOPED",91,0)
 S DIR("A")="Are you sure you want to inactivate "_NAME_" ?" D ^DIR
"RTN","RMPOPED",92,0)
 Q:(Y<1)!$$QUIT
"RTN","RMPOPED",93,0)
 S DR="19.5//TODAY;19.6;19.7////"_DUZ,DIE("NO^")="BACK"
"RTN","RMPOPED",94,0)
 D ^DIE
"RTN","RMPOPED",95,0)
 Q
"RTN","RMPOPED",96,0)
 ;
"RTN","RMPOPED",97,0)
ACTVT ;Activate the patient if the user wants to.
"RTN","RMPOPED",98,0)
 K DIR S DIR(0)="YO",DIR("B")="NO"
"RTN","RMPOPED",99,0)
 S DIR("A")="Are you sure you want to reactivate "_NAME_" ?" D ^DIR
"RTN","RMPOPED",100,0)
 Q:(Y<1)!$$QUIT
"RTN","RMPOPED",101,0)
 S DR="19.2//TODAY;19.5///@;19.6///@;19.7///@"
"RTN","RMPOPED",102,0)
 S DIE("NO^")="BACK"
"RTN","RMPOPED",103,0)
 D ^DIE
"RTN","RMPOPED",104,0)
 Q
"RTN","RMPOPED",105,0)
PAT ;Add/Edit Home Oxygen Patient
"RTN","RMPOPED",106,0)
 S QUIT=0
"RTN","RMPOPED",107,0)
 D HOSITE^RMPOUTL0
"RTN","RMPOPED",108,0)
 I '$D(RMPOXITE)!QUIT D EXIT Q
"RTN","RMPOPED",109,0)
LOOP ;
"RTN","RMPOPED",110,0)
 S QUIT=0
"RTN","RMPOPED",111,0)
 D LOOKUP I QUIT!'$D(RMPODFN) D EXIT Q
"RTN","RMPOPED",112,0)
 D EDBLK I QUIT D EXIT Q
"RTN","RMPOPED",113,0)
 D UNLOCK G LOOP
"RTN","RMPOPED",114,0)
EDBLK ;
"RTN","RMPOPED",115,0)
 D SITECHK Q:QUIT
"RTN","RMPOPED",116,0)
 N RMPRDOI ; ICD - Date of Interest
"RTN","RMPOPED",117,0)
 N RMPRWARN ; Flag if Prescription/Item mismatch was issued
"RTN","RMPOPED",118,0)
 N RMPRCONT ; Flag if user wanted to continue after warning was issued
"RTN","RMPOPED",119,0)
 S (RMPRWARN,RMPRCONT,RMPRDOI)=""
"RTN","RMPOPED",120,0)
 D DEMOG Q:QUIT
"RTN","RMPOPED",121,0)
 D RX Q:QUIT
"RTN","RMPOPED",122,0)
 Q:+RMPRDOI'>0
"RTN","RMPOPED",123,0)
 D ITEM
"RTN","RMPOPED",124,0)
 Q
"RTN","RMPOPED",125,0)
 ;called by ^RMPOBIL1, providing RMPOPATN as the X variable
"RTN","RMPOPED",126,0)
EDIT ;From Billing...
"RTN","RMPOPED",127,0)
 I '$D(RMPODFN) S RMPODFN=$TR($G(RMPOPATN),"`")
"RTN","RMPOPED",128,0)
 Q:'$D(^RMPR(665,+RMPODFN,0))
"RTN","RMPOPED",129,0)
 W !,"EDITING "_$P(^DPT(RMPODFN,0),U)_"...",!
"RTN","RMPOPED",130,0)
 S QUIT=0,DA=RMPODFN
"RTN","RMPOPED",131,0)
 L +^RMPR(665,DA):2
"RTN","RMPOPED",132,0)
 I '$T W !!?10,*7," << Record in use. Try later. >>" Q
"RTN","RMPOPED",133,0)
 D EDBLK,EXIT
"RTN","RMPOPED",134,0)
 Q
"RTN","RMPOPED",135,0)
LOOKUP ;First look-up the patient
"RTN","RMPOPED",136,0)
 K DIC,DIE,DA,DR,RMPODFN
"RTN","RMPOPED",137,0)
 W !!! S DIC="^RMPR(665,",DIC(0)="LQEAMZ"
"RTN","RMPOPED",138,0)
 D ^DIC Q:(Y<0)!$$QUIT
"RTN","RMPOPED",139,0)
CONT S (RMPODFN,DA)=+Y
"RTN","RMPOPED",140,0)
 L +^RMPR(665,DA):2
"RTN","RMPOPED",141,0)
 I '$T W !!?10,*7," << Record in use. Try later. >>" G LOOKUP
"RTN","RMPOPED",142,0)
 Q
"RTN","RMPOPED",143,0)
 ;
"RTN","RMPOPED",144,0)
QUIT() S QUIT=$G(QUIT)!$D(DTOUT)!$D(DUOUT)!$D(DIROUT) Q QUIT
"RTN","RMPOPED",145,0)
EQUIT() S QUIT=$D(DTOUT)!$D(Y) Q QUIT
"RTN","RMPOPED",146,0)
LJ(S,W,C) ; LEFT JUSTIFY S IN A FIELD W WIDE PADDING WITH CHAR F
"RTN","RMPOPED",147,0)
 ;
"RTN","RMPOPED",148,0)
 S C=$G(C," ")   ;DEFAULT PAD CHAR IS SPACE
"RTN","RMPOPED",149,0)
 S $P(S,C,W-$L(S)+$L(S,C))=""
"RTN","RMPOPED",150,0)
 Q S
"RTN","RMPOPED",151,0)
 ;
"RTN","RMPOPED",152,0)
SITECHK ;If user chooses patient from site different from billing site
"RTN","RMPOPED",153,0)
 ;
"RTN","RMPOPED",154,0)
 S Y=$P($G(^RMPR(665,RMPODFN,"RMPOA")),U,7)
"RTN","RMPOPED",155,0)
 Q:Y=RMPOXITE    ;Site is the same.. 
"RTN","RMPOPED",156,0)
 I Y="" D SET Q   ;Site not defined, stuff RMPOXITE...
"RTN","RMPOPED",157,0)
 ; Site is different...
"RTN","RMPOPED",158,0)
 S IENS=RMPODFN_","
"RTN","RMPOPED",159,0)
 D GETS^DIQ(665,IENS,19.12,"E","X")
"RTN","RMPOPED",160,0)
 W !!,"Patient's Home Oxygen Contract Location (HOCL) is "
"RTN","RMPOPED",161,0)
 W $G(X(665,IENS,19.12,"E"))
"RTN","RMPOPED",162,0)
 W !,"You are working on billing for HOCL "_RMPO("NAME"),!
"RTN","RMPOPED",163,0)
 K DIR S DIR(0)="Y",DIR("B")="NO"
"RTN","RMPOPED",164,0)
 S DIR("A")="Should I change this patient's HOCL to "_RMPO("NAME")
"RTN","RMPOPED",165,0)
 D ^DIR Q:$$QUIT!(Y=0)
"RTN","RMPOPED",166,0)
 D SET
"RTN","RMPOPED",167,0)
 Q
"RTN","RMPOPED",168,0)
SET ;
"RTN","RMPOPED",169,0)
 K DIE,DR,DA
"RTN","RMPOPED",170,0)
 S DA=RMPODFN
"RTN","RMPOPED",171,0)
 S DIE="^RMPR(665,",DR="19.12////"_RMPOXITE D ^DIE
"RTN","RMPOPED",172,0)
 Q
"RTN","RMPOPED",173,0)
 ;
"RTN","RMPOPED",174,0)
DEMOG ;First edit the patient's basic fields
"RTN","RMPOPED",175,0)
 ;
"RTN","RMPOPED",176,0)
 K DIE,DR,DA
"RTN","RMPOPED",177,0)
 S DA=RMPODFN
"RTN","RMPOPED",178,0)
 S DIE="^RMPR(665,",DR="19.1" D ^DIE Q:$$EQUIT
"RTN","RMPOPED",179,0)
 S RMPOELIG=$P($G(^RMPR(665,RMPODFN,"RMPOA")),U)
"RTN","RMPOPED",180,0)
 K DR S DR="19.11"_$S(RMPOELIG="D":"",1:"///@")_";19.12"
"RTN","RMPOPED",181,0)
 D ^DIE Q:$$EQUIT
"RTN","RMPOPED",182,0)
 K DR S Y=DT X ^DD("DD") S DR="19.2//"_Y D ^DIE Q:$$QUIT
"RTN","RMPOPED",183,0)
 Q
"RTN","RMPOPED",184,0)
 ;
"RTN","RMPOPED",185,0)
RX ;Edit the Rx Data
"RTN","RMPOPED",186,0)
 ;
"RTN","RMPOPED",187,0)
 N RXD,RXDI,RMPRIENS
"RTN","RMPOPED",188,0)
 K DIC,DIE,DA,DR
"RTN","RMPOPED",189,0)
 S DIC="^RMPR(665,"_RMPODFN_",""RMPOB"",",DIC(0)="AEQLZ"
"RTN","RMPOPED",190,0)
 S DA(1)=RMPODFN,DIC("P")="665.193D"
"RTN","RMPOPED",191,0)
 S RXD=$O(^RMPR(665,DA(1),"RMPOB","B",""),-1) D:RXD
"RTN","RMPOPED",192,0)
 . S DIC("B")=$$FMTE^XLFDT(RXD)
"RTN","RMPOPED",193,0)
 D ^DIC Q:Y<0!$$QUIT
"RTN","RMPOPED",194,0)
 ; Set RMPRIENS for loading Date of Interest after final edits
"RTN","RMPOPED",195,0)
 S RMPRIENS=+Y_","_DA(1)_","
"RTN","RMPOPED",196,0)
 ; Edit START DATE (#.01), EXPIRATION DATE (#2) and DESCRIPTION (#3)
"RTN","RMPOPED",197,0)
 S DIE=DIC,DA=+Y,DR=".01;2//^D EXPIRE^RMPOBIL4;3" D ^DIE Q:$$EQUIT
"RTN","RMPOPED",198,0)
 ; Load ICD Date of Interest
"RTN","RMPOPED",199,0)
 S RMPRDOI=$$GET1^DIQ(665.193,RMPRIENS,.01,"I",,)
"RTN","RMPOPED",200,0)
 Q
"RTN","RMPOPED",201,0)
 ;
"RTN","RMPOPED",202,0)
ITEM ;Add/Edit Items
"RTN","RMPOPED",203,0)
 ;
"RTN","RMPOPED",204,0)
 ; Display items
"RTN","RMPOPED",205,0)
 D ITEMD
"RTN","RMPOPED",206,0)
 ; If no items on file, then only allow ADD PRIMARY ITEM
"RTN","RMPOPED",207,0)
 I '$D(IEN) D ITEMP Q:QUIT!(ITEM="")  G ITEM
"RTN","RMPOPED",208,0)
 ; ask for ACTION, quit if <return>, timeout, etc
"RTN","RMPOPED",209,0)
 S ITMACT=$$ITEMO Q:$$QUIT!(ITMACT="")
"RTN","RMPOPED",210,0)
 ; if they entered 'A', do ADD ITEM, then edit it
"RTN","RMPOPED",211,0)
 I ITMACT="A" D ITEMA Q:QUIT!(ITEM="")  D ITEME Q:QUIT  G ITEM
"RTN","RMPOPED",212,0)
 ; if they entered 'D', select an item, then delete it
"RTN","RMPOPED",213,0)
 I ITMACT="D" D ITEMS Q:QUIT!(ITEM="")  D ITEMK G ITEM
"RTN","RMPOPED",214,0)
 ; if they entered 'E', select an item, then edit it
"RTN","RMPOPED",215,0)
 I ITMACT="E" D ITEMS
"RTN","RMPOPED",216,0)
 ; If warning issued and Continue = No
"RTN","RMPOPED",217,0)
 I RMPRWARN=1,RMPRCONT'=1 S (RMPRWARN,RMPRCONT)="" G ITEM
"RTN","RMPOPED",218,0)
 Q:QUIT!(ITEM="")
"RTN","RMPOPED",219,0)
 D ITEME Q:QUIT
"RTN","RMPOPED",220,0)
 G ITEM
"RTN","RMPOPED",221,0)
 Q
"RTN","RMPOPED",222,0)
 ;
"RTN","RMPOPED",223,0)
ITEMP ; Add Primary Item
"RTN","RMPOPED",224,0)
 W !!,$C(7)_"No items found, please enter PRIMARY ITEM",!
"RTN","RMPOPED",225,0)
 D ITEMA Q:QUIT!(ITEM="")
"RTN","RMPOPED",226,0)
 S PI="///Y" D ITEME K PI
"RTN","RMPOPED",227,0)
 Q
"RTN","RMPOPED",228,0)
ITEMA ; Add Items
"RTN","RMPOPED",229,0)
 S ITEM=""
"RTN","RMPOPED",230,0)
 K DIC S DIC="^RMPR(661,",DIC(0)="AEQMZ" D ^DIC Q:Y<0!$$QUIT
"RTN","RMPOPED",231,0)
 K DD,DO,DA,DIC
"RTN","RMPOPED",232,0)
 S DIC="^RMPR(665,"_RMPODFN_",""RMPOC"",",DIC(0)="L"
"RTN","RMPOPED",233,0)
 S DIC("P")=$P(^DD(665,19.4,0),U,2),DA(1)=RMPODFN,X=+Y
"RTN","RMPOPED",234,0)
 D FILE^DICN I Y>0 S IEN=$G(IEN)+1,IEN(IEN)=+Y,ITEM=IEN
"RTN","RMPOPED",235,0)
 Q
"RTN","RMPOPED",236,0)
 ;
"RTN","RMPOPED",237,0)
ITEMS ; Select Item
"RTN","RMPOPED",238,0)
 ; Return ITEM = index into both ITEMS and IEN arrays
"RTN","RMPOPED",239,0)
 N RMPRQUIT,RMPRACS,RMPRCS,RMPRICD,RMPRICS,RMPRANS,RMPRACT
"RTN","RMPOPED",240,0)
 ; Determine Active Coding System based on Date of Interest
"RTN","RMPOPED",241,0)
 S RMPRACS=$$SINFO^ICDEX("DIAG",RMPRDOI) ; Supported by ICR 5747
"RTN","RMPOPED",242,0)
 S RMPRACS=$P(RMPRACS,U,2),RMPRACS=$P(RMPRACS,"-",2)
"RTN","RMPOPED",243,0)
 ; If only one Item on file
"RTN","RMPOPED",244,0)
 I IEN=1 S ITEM=1 W "  ",$E(ITEMS(1),1,33) Q:ITMACT'="E"  D  Q
"RTN","RMPOPED",245,0)
 .; Load Item info
"RTN","RMPOPED",246,0)
 .D RMPRLOAD
"RTN","RMPOPED",247,0)
 .; If item has an ICD code, verify that it was active based on 
"RTN","RMPOPED",248,0)
 .; start date of currently selected prescription.
"RTN","RMPOPED",249,0)
 .I RMPRICD'="",RMPRACT'="+" D
"RTN","RMPOPED",250,0)
 ..; Display warning
"RTN","RMPOPED",251,0)
 ..D RMPRWARN^RMPOPED1(RMPRICD,RMPRACS,RMPODFN,.ITEM,.RMPRCONT)
"RTN","RMPOPED",252,0)
 ..S RMPRWARN=1 ; Set warning issued flag
"RTN","RMPOPED",253,0)
 ; If multiple items on file
"RTN","RMPOPED",254,0)
 K DIR
"RTN","RMPOPED",255,0)
 S ITEM=""
"RTN","RMPOPED",256,0)
 S DIR(0)="NO^1:"_IEN,DIR("A")="Select an ITEM"
"RTN","RMPOPED",257,0)
 S DIR("?")="Select an item from the list"
"RTN","RMPOPED",258,0)
 M DIR("?")=ITEMS
"RTN","RMPOPED",259,0)
 F  D  Q:RMPRQUIT=1
"RTN","RMPOPED",260,0)
 .S RMPRQUIT=""
"RTN","RMPOPED",261,0)
 .D ^DIR
"RTN","RMPOPED",262,0)
 .I Y'>0 S RMPRQUIT=1,ITEM="" Q
"RTN","RMPOPED",263,0)
 .Q:$$QUIT
"RTN","RMPOPED",264,0)
 .S ITEM=+Y W "  ",$E(ITEMS(ITEM),1,33)
"RTN","RMPOPED",265,0)
 .; Quit if doing a Delete and item was selected
"RTN","RMPOPED",266,0)
 .I ITMACT="D" S RMPRQUIT=1 Q
"RTN","RMPOPED",267,0)
 .; Load ICD Code and Code Set and Active Status for selected Item
"RTN","RMPOPED",268,0)
 .D RMPRLOAD
"RTN","RMPOPED",269,0)
 .; If Item doesn't have an ICD code - OK
"RTN","RMPOPED",270,0)
 .I RMPRICD="" W ! S RMPRQUIT=1 Q
"RTN","RMPOPED",271,0)
 .; If Item has an ICD code validate that it was active based on the start
"RTN","RMPOPED",272,0)
 .; date of the prescription.  If ICD was active, QUIT
"RTN","RMPOPED",273,0)
 .I RMPRACT="+" S RMPRQUIT=1 Q
"RTN","RMPOPED",274,0)
 .; Otherwise, issue warning
"RTN","RMPOPED",275,0)
 .I ITMACT="E" D
"RTN","RMPOPED",276,0)
 ..; Display warning
"RTN","RMPOPED",277,0)
 ..D RMPRWARN^RMPOPED1(RMPRICD,RMPRACS,RMPODFN,IEN(ITEM),.RMPRCONT)
"RTN","RMPOPED",278,0)
 ..S (RMPRWARN,RMPRQUIT)=1
"RTN","RMPOPED",279,0)
 .W !
"RTN","RMPOPED",280,0)
 K RMPRITEM
"RTN","RMPOPED",281,0)
 Q
"RTN","RMPOPED",282,0)
 ;
"RTN","RMPOPED",283,0)
RMPRLOAD ; Load ICD, Code Set and Status
"RTN","RMPOPED",284,0)
 S RMPRICD=$P(RMPRITEM(ITEM),U,2) ; ICD Code
"RTN","RMPOPED",285,0)
 S RMPRCS=$P(RMPRITEM(ITEM),U,3)  ; Code Set
"RTN","RMPOPED",286,0)
 S RMPRACT=$P(RMPRITEM(ITEM),U,4) ; Active Status
"RTN","RMPOPED",287,0)
 Q
"RTN","RMPOPED",288,0)
 ;
"RTN","RMPOPED",289,0)
ITEME ; Edit an Item - ICD-10 Changes
"RTN","RMPOPED",290,0)
 N DFCP,FCP,ICDID,RMCPRENT,RMPRACS,RMPRACSI,RMPRCSI,RMPRDATA,RMPRDATE,RMPRFILE,RMPRICD
"RTN","RMPOPED",291,0)
 N RMPRICDE,RMPRICDI,RMPRIEN,RMPRIENS,RMPRINDX,RMPRQUIT,RMCPTHCP,RMPRTXT,RMPOHCP
"RTN","RMPOPED",292,0)
 S (DFCP,FCP,ICDID,RMCPRENT,RMPRACS,RMPRACSI,RMPRCSI,RMPRDATA,RMPRDATE,RMPRICD,RMPRICDE)=""
"RTN","RMPOPED",293,0)
 S (RMPRICDI,RMPRIEN,RMPRIENS,RMPRQUIT,RMCPTHCP,RMPRTXT)=""
"RTN","RMPOPED",294,0)
 S ITMACT=$G(ITMACT)
"RTN","RMPOPED",295,0)
 K DIE,DA,DR,RMCPT,RMPOHCP
"RTN","RMPOPED",296,0)
 S DA(1)=RMPODFN,DA=IEN(ITEM),DIE="^RMPR(665,"_DA(1)_",""RMPOC"","
"RTN","RMPOPED",297,0)
 D ITEMEP Q:QUIT
"RTN","RMPOPED",298,0)
 S DR=".01R;6R" D ^DIE Q:$$EQUIT!('$D(DA))
"RTN","RMPOPED",299,0)
ITEMEH ;CHECK HCPCS code for inactive    ;RMPR*3.0*180
"RTN","RMPOPED",300,0)
 S RMPOHCP=$P(^RMPR(665,DA(1),"RMPOC",DA,0),U,7)
"RTN","RMPOPED",301,0)
 I RMPOHCP,$P(^RMPR(661.1,RMPOHCP,0),U,5)=0 D  G ITEMEH
"RTN","RMPOPED",302,0)
 . W !!,"Inactivated HCPCS not allowed, please enter active code",!!
"RTN","RMPOPED",303,0)
 . S DR="6R" D ^DIE
"RTN","RMPOPED",304,0)
 ;
"RTN","RMPOPED",305,0)
 S RMCPTHCP=$P($G(^RMPR(665,RMPODFN,"RMPOC",DA,0)),U,7) ; (#6)   HCPCS CODE 
"RTN","RMPOPED",306,0)
 S RMCPT=$P($G(^RMPR(661.1,RMCPTHCP,4)),U,1) S DR=""    ; (#.03) CPT MODIFIER 
"RTN","RMPOPED",307,0)
 S RMCPRENT=$P($G(^RMPR(661.1,RMCPTHCP,5)),U,1)         ; (#30)  RENTAL FLAG 
"RTN","RMPOPED",308,0)
 I RMCPT["RR",(RMCPRENT=1) S DR="11;"                   ; (#11)  HOME OXYGEN RENTAL FLAG 
"RTN","RMPOPED",309,0)
 I RMCPT["QH" S DR=DR_"12;"                             ; (#12)  HOME OXYGEN CONSERVING FLAG
"RTN","RMPOPED",310,0)
 ;
"RTN","RMPOPED",311,0)
 ; Determine Active Coding System based on Date of Interest
"RTN","RMPOPED",312,0)
 S RMPRACS=$$SINFO^ICDEX("DIAG",RMPRDOI) ; Supported by ICR 5747
"RTN","RMPOPED",313,0)
 S RMPRACSI=$P(RMPRACS,U,1)
"RTN","RMPOPED",314,0)
 ; Retrieve current ICD code info
"RTN","RMPOPED",315,0)
 S RMPRFILE=665.194,RMPRIENS=IEN(ITEM)_","_RMPODFN_","
"RTN","RMPOPED",316,0)
 S RMPRICDE=$$GET1^DIQ(RMPRFILE,RMPRIENS,7,"E",,) ; External ICD value for use with default value
"RTN","RMPOPED",317,0)
 S RMPRICDI=$$GET1^DIQ(RMPRFILE,RMPRIENS,7,"I",,) ; Internal ICD value
"RTN","RMPOPED",318,0)
 S RMPRIEN=RMPRICDI ; Save IEN in case user accepted default ICD value
"RTN","RMPOPED",319,0)
 I RMPRICDI>0 D
"RTN","RMPOPED",320,0)
 .S RMPRCSI=$$CSI^ICDEX(80,RMPRICDI) ; Code System Internal
"RTN","RMPOPED",321,0)
 .S RMPRDATE=$$SINFO^ICDEX(RMPRCSI)
"RTN","RMPOPED",322,0)
 .S RMPRDATE=$P(RMPRDATE,U,5) ; Implementation date of Code
"RTN","RMPOPED",323,0)
 .; Retrieve ICD info - 20 piece string
"RTN","RMPOPED",324,0)
 .S RMPRDATA=$$ICDDX^ICDEX(RMPRICDE,RMPRDATE,RMPRACSI,"E") ; Supported by ICR 5747
"RTN","RMPOPED",325,0)
 ; Prompt for (#1) VENDOR  (#2) QUANTITY  (#3) UNIT COST  (4) UNIT OF ISSUE
"RTN","RMPOPED",326,0)
 S DR=DR_"1R;2R;3R;4"
"RTN","RMPOPED",327,0)
 K RMCPRENT,RMCPTHCP
"RTN","RMPOPED",328,0)
 D ^DIE
"RTN","RMPOPED",329,0)
 Q:$$EQUIT
"RTN","RMPOPED",330,0)
 ;
"RTN","RMPOPED",331,0)
 ; ICD-9 Code Set
"RTN","RMPOPED",332,0)
 I $P(RMPRACS,U,2)="ICD-9-CM" D
"RTN","RMPOPED",333,0)
 .; Prompt for ICD code
"RTN","RMPOPED",334,0)
 .K DIC
"RTN","RMPOPED",335,0)
 .S DR="7ICD-9 DIAGNOSIS CODE: "
"RTN","RMPOPED",336,0)
 .I RMPRICDE'="" S DIC("B")=RMPRICDE
"RTN","RMPOPED",337,0)
 .D ^DIE
"RTN","RMPOPED",338,0)
 .Q:$$EQUIT
"RTN","RMPOPED",339,0)
 Q:$$QUIT
"RTN","RMPOPED",340,0)
 ;
"RTN","RMPOPED",341,0)
 ; ICD10 Code Set
"RTN","RMPOPED",342,0)
 I $P(RMPRACS,U,2)="ICD-10-CM" D
"RTN","RMPOPED",343,0)
 .N RMPPARAM
"RTN","RMPOPED",344,0)
 .; Initialize default prompt and help variables
"RTN","RMPOPED",345,0)
 .D SETPARAM^RMPOICD1(.RMPPARAM)
"RTN","RMPOPED",346,0)
 .; If existing ICD-10 code add to default prompt then Prompt and set needed variables
"RTN","RMPOPED",347,0)
 .I +RMPRICDI>0 D
"RTN","RMPOPED",348,0)
 ..; If existing ICD-10, add code & description
"RTN","RMPOPED",349,0)
 ..S RMPRTXT=$$VLT^ICDEX(80,RMPRICDI,RMPRDOI) ; Supported by ICR 5747
"RTN","RMPOPED",350,0)
 ..S RMPPARAM("SEARCH_PROMPT")=RMPPARAM("SEARCH_PROMPT")_RMPRICDE
"RTN","RMPOPED",351,0)
 ..S RMPRLLEN=244-$L(RMPPARAM("SEARCH_PROMPT"))
"RTN","RMPOPED",352,0)
 ..S RMPPARAM("SEARCH_PROMPT")=RMPPARAM("SEARCH_PROMPT")_" "_$E(RMPRTXT,1,RMPRLLEN)_" "
"RTN","RMPOPED",353,0)
 .; Loop to prompt for ICD-10 code
"RTN","RMPOPED",354,0)
 .F  D  Q:RMPRQUIT!(+RMPRICD>0)  ;  user quits OR ICD10 code was selected
"RTN","RMPOPED",355,0)
 ..; Output from $$DIAG10^RMPOICD1 = IEN file #80;ICD code value;IEN file # 757.01^description
"RTN","RMPOPED",356,0)
 ..S RMPRICD=$$DIAG10^RMPOICD1(RMPRDOI,RMPRICDE,.RMPPARAM)
"RTN","RMPOPED",357,0)
 ..; User selected valid code
"RTN","RMPOPED",358,0)
 ..I +RMPRICD>0 S RMPRQUIT=1 Q
"RTN","RMPOPED",359,0)
 .. ;if no data found
"RTN","RMPOPED",360,0)
 ..I RMPRICD="" W !!,RMPPARAM("NO DATA FOUND") Q
"RTN","RMPOPED",361,0)
 ..; User entered ^ OR ^^ to Quit
"RTN","RMPOPED",362,0)
 ..I +RMPRICD=-3 S (RMPRQUIT,QUIT)=1 Q
"RTN","RMPOPED",363,0)
 ..; User entered <enter> with no existing entry
"RTN","RMPOPED",364,0)
 ..I +RMPRICD=-1 S:$P(RMPRICD,U,2)=-1 RMPRQUIT=1 Q
"RTN","RMPOPED",365,0)
 ..; Existing ICD and user just pressed <enter>
"RTN","RMPOPED",366,0)
 ..I +RMPRICD=-5 S RMPRQUIT=1 Q
"RTN","RMPOPED",367,0)
 ..; Check for Deleting the ICD from the item - User entered @
"RTN","RMPOPED",368,0)
 ..I +RMPRICD=-6 D  Q
"RTN","RMPOPED",369,0)
 ...I RMPRICDE="" W "  <NOTHING TO DELETE>" Q
"RTN","RMPOPED",370,0)
 ...I $$QUESTION^RMPOICD1(1,RMPPARAM("DELETE IT"))=1 D DLTITEM^RMPOPED1(RMPODFN,IEN(ITEM)) S RMPRQUIT=1 Q
"RTN","RMPOPED",371,0)
 ...W "  <NOTHING DELETED>",!
"RTN","RMPOPED",372,0)
 ..; User timed out = QUIT
"RTN","RMPOPED",373,0)
 ..I +RMPRICD=-2 S (RMPRQUIT,QUIT)=1 Q
"RTN","RMPOPED",374,0)
 ..; User answered No to the "Do you wish to continue" prompt
"RTN","RMPOPED",375,0)
 ..I +RMPRICD=-4 Q
"RTN","RMPOPED",376,0)
 .;
"RTN","RMPOPED",377,0)
 .Q:$$QUIT
"RTN","RMPOPED",378,0)
 .; Set ICD Code (#7)
"RTN","RMPOPED",379,0)
 .I +RMPRICD>0 D
"RTN","RMPOPED",380,0)
 ..S DR="7////"_+RMPRICD
"RTN","RMPOPED",381,0)
 ..D ^DIE
"RTN","RMPOPED",382,0)
 ;
"RTN","RMPOPED",383,0)
 Q:$$QUIT
"RTN","RMPOPED",384,0)
 ; The final two fields are ask regardless of whether it was an ICD-9 or ICD-10 code
"RTN","RMPOPED",385,0)
 S DR="8;9R" ; (#8) REMARKS   (#9) ITEM TYPE
"RTN","RMPOPED",386,0)
 D ^DIE
"RTN","RMPOPED",387,0)
 I $D(DA),$D(RMCPT),(RMCPT'["RR") S $P(^RMPR(665,DA(1),"RMPOC",DA,0),U,12)="" ; (#11) HOME OXYGEN RENTAL FLAG
"RTN","RMPOPED",388,0)
 I $D(DA),$D(RMCPT),(RMCPT'["QH") S $P(^RMPR(665,DA(1),"RMPOC",DA,0),U,13)="" ; (#12) HOME OXYGEN CONSERVING FLAG
"RTN","RMPOPED",389,0)
 Q:$$EQUIT
"RTN","RMPOPED",390,0)
 ; Kludge to "point" to file 420
"RTN","RMPOPED",391,0)
 S DFCP=$P(^RMPR(665,RMPODFN,"RMPOC",IEN(ITEM),0),U,6) ;(#5) FUND CONTROL POINT
"RTN","RMPOPED",392,0)
 F  D  Q:(FCP>0)!QUIT
"RTN","RMPOPED",393,0)
 . S FCP=$$GETFCP^RMPOBILU(DFCP) Q:QUIT
"RTN","RMPOPED",394,0)
 . I FCP<0 W $C(7)_"REQUIRED FIELD!"
"RTN","RMPOPED",395,0)
 I FCP>0 S DR="5///"_$P(FCP,U,2) D ^DIE Q:$$EQUIT
"RTN","RMPOPED",396,0)
 ; End Kludge
"RTN","RMPOPED",397,0)
 ;S DR="7:9" D ^DIE Q:$$EQUIT
"RTN","RMPOPED",398,0)
 Q 
"RTN","RMPOPED",399,0)
 ;
"RTN","RMPOPED",400,0)
ITEMEP ; Primary Item edit...
"RTN","RMPOPED",401,0)
 N PIEN,PFLG,RMDA,RMNO
"RTN","RMPOPED",402,0)
 S RMDA=DA,DR="10" D ^DIE Q:$$QUIT
"RTN","RMPOPED",403,0)
 I $P(^RMPR(665,RMPODFN,"RMPOC",RMDA,0),U,11)'="Y" Q
"RTN","RMPOPED",404,0)
 ; Logic to control toggling of Primary Item flag...
"RTN","RMPOPED",405,0)
 S RMNO="N"
"RTN","RMPOPED",406,0)
 F RMX=0:0 S RMX=$O(^RMPR(665,RMPODFN,"RMPOC",RMX)) Q:RMX'>0  D
"RTN","RMPOPED",407,0)
 . Q:RMDA=RMX
"RTN","RMPOPED",408,0)
 . S DA=RMX,DR="10///^S X=RMNO" D ^DIE
"RTN","RMPOPED",409,0)
 S DA=RMDA
"RTN","RMPOPED",410,0)
 Q
"RTN","RMPOPED",411,0)
PIEN(DFN) ; FIND PRIMARY ITEM
"RTN","RMPOPED",412,0)
 ; RETURN IEN OF P.I. IN MULTIPLE ^ IEN IN FILE 661
"RTN","RMPOPED",413,0)
 N X,PIEN
"RTN","RMPOPED",414,0)
 S X=0,PIEN=0
"RTN","RMPOPED",415,0)
 F  S X=$O(^RMPR(665,DFN,"RMPOC",X)) Q:X'>0  D  Q:PIEN
"RTN","RMPOPED",416,0)
 . S:$P(^RMPR(665,DFN,"RMPOC",X,0),U,11)="Y" PIEN=X
"RTN","RMPOPED",417,0)
 S:PIEN PIEN=PIEN_U_$P(^RMPR(665,DFN,"RMPOC",PIEN,0),U,1)
"RTN","RMPOPED",418,0)
 Q PIEN
"RTN","RMPOPED",419,0)
 ;
"RTN","RMPOPED",420,0)
ITEMD ; Display Items
"RTN","RMPOPED",421,0)
 N I,Z,PIF,ITMNM,VDRNM,RMPRACS,RMPRACT,RMPRICD,RMPRPCS,RMPRTXT
"RTN","RMPOPED",422,0)
 S (RMPRACS,RMPRICD,RMPRPCS)=""
"RTN","RMPOPED",423,0)
 ; Determine Active Coding System based on Prescription DOI
"RTN","RMPOPED",424,0)
 S RMPRPCS=$$SINFO^ICDEX("DIAG",RMPRDOI)
"RTN","RMPOPED",425,0)
 K IEN,ITEMS,RMPRITEM S I=0
"RTN","RMPOPED",426,0)
 Q:$O(^RMPR(665,RMPODFN,"RMPOC",0))'>0
"RTN","RMPOPED",427,0)
 W !!,"The following items are already in this patient's template:",!
"RTN","RMPOPED",428,0)
 W !,"     Item Description                      Vendor                   ICD      CS+"
"RTN","RMPOPED",429,0)
 F IEN=1:1 S I=$O(^RMPR(665,RMPODFN,"RMPOC",I)) Q:I'>0  D
"RTN","RMPOPED",430,0)
 . S Z=^RMPR(665,RMPODFN,"RMPOC",I,0)
"RTN","RMPOPED",431,0)
 . S PIF=$S($P(Z,U,11)="Y":"*",1:" ")
"RTN","RMPOPED",432,0)
 . ; Load ICD and determine corresponding code set
"RTN","RMPOPED",433,0)
 . S RMPRICD=$P(Z,U,8),RMPRACT=""
"RTN","RMPOPED",434,0)
 . I RMPRICD'="" D
"RTN","RMPOPED",435,0)
 . . ; Check whether ICD code for this item was active on DOI
"RTN","RMPOPED",436,0)
 . . S RMPRACT=$$LS^ICDEX(80,+RMPRICD,RMPRDOI,1)
"RTN","RMPOPED",437,0)
 . . ; Get Active Coding System Info
"RTN","RMPOPED",438,0)
 . . S RMPRACS=$$CSI^ICDEX(80,+RMPRICD) ; Get interal coding system for this ICD code
"RTN","RMPOPED",439,0)
 . . S RMPRACS=$$SINFO^ICDEX(RMPRACS) ; get external format for coding system
"RTN","RMPOPED",440,0)
 . . S RMPRACS=$P(RMPRACS,U,2),RMPRACS=$P(RMPRACS,"-",2)
"RTN","RMPOPED",441,0)
 . . S RMPRICD=$$CODEC^ICDEX(80,RMPRICD)
"RTN","RMPOPED",442,0)
 . S ITMNM=$$ITEMNM($P(Z,U)),VDRNM=$$VDRNM($P(Z,U,2))
"RTN","RMPOPED",443,0)
 . S IEN(IEN)=I
"RTN","RMPOPED",444,0)
 . S VDRNM=$E(VDRNM,1,23)
"RTN","RMPOPED",445,0)
 . S RMPRTXT=PIF_$J(IEN,3)_" "_$$LJ(ITMNM,38)_$$LJ(VDRNM,24)
"RTN","RMPOPED",446,0)
 . S RMPRITEM(IEN)=RMPRTXT
"RTN","RMPOPED",447,0)
 . I RMPRICD'="" D
"RTN","RMPOPED",448,0)
 . . S $E(RMPRTXT,69)="",RMPRTXT=RMPRTXT_RMPRICD
"RTN","RMPOPED",449,0)
 . . S $E(RMPRTXT,78)=""
"RTN","RMPOPED",450,0)
 . . I RMPRACS=9 S RMPRTXT=RMPRTXT_" "
"RTN","RMPOPED",451,0)
 . . S RMPRTXT=RMPRTXT_RMPRACS
"RTN","RMPOPED",452,0)
 . . I +RMPRACT=1 S RMPRTXT=RMPRTXT_"+"
"RTN","RMPOPED",453,0)
 . W !,RMPRTXT
"RTN","RMPOPED",454,0)
 . S ITEMS(IEN)=RMPRTXT
"RTN","RMPOPED",455,0)
 . S $P(RMPRITEM(IEN),U,2)=RMPRICD,$P(RMPRITEM(IEN),U,3)=RMPRACS,$P(RMPRITEM(IEN),U,4)=$S(+RMPRACT=1:"+",1:"")
"RTN","RMPOPED",456,0)
 W !!," * = Primary Item  "
"RTN","RMPOPED",457,0)
 W !,"CS = Code Set for ICD Diagnosis code"
"RTN","RMPOPED",458,0)
 W !," + = Item with active ICD code on start date of prescription",!
"RTN","RMPOPED",459,0)
 S IEN=IEN-1
"RTN","RMPOPED",460,0)
 Q
"RTN","RMPOPED",461,0)
 ;
"RTN","RMPOPED",462,0)
ITEMNM(ITM) ; RETURN ITEM NAME
"RTN","RMPOPED",463,0)
 S IENS=ITM_","
"RTN","RMPOPED",464,0)
 D GETS^DIQ(661,IENS,.01,"","X")
"RTN","RMPOPED",465,0)
 Q $E(X(661,IENS,.01),1,33)
"RTN","RMPOPED",466,0)
VDRNM(VDR) ; RETURN VENDOR NAME
"RTN","RMPOPED",467,0)
 I VDR="" Q "<< VENDOR NOT DEFINED >>"
"RTN","RMPOPED",468,0)
 S IENS=VDR_"," D GETS^DIQ(440,IENS,.01,"","X")
"RTN","RMPOPED",469,0)
 Q X(440,IENS,.01)
"RTN","RMPOPED",470,0)
ITEMK ; Delete an Item
"RTN","RMPOPED",471,0)
 ;
"RTN","RMPOPED",472,0)
 K DIR S DIR(0)="Y",DIR("A")="Are you SURE you want to delete this item"
"RTN","RMPOPED",473,0)
 S DIR("B")="NO" D ^DIR Q:Y'>0
"RTN","RMPOPED",474,0)
 K DIK,DA
"RTN","RMPOPED",475,0)
 S DA(1)=RMPODFN,DA=IEN(ITEM),DIK="^RMPR(665,"_DA(1)_",""RMPOC"","
"RTN","RMPOPED",476,0)
 D ^DIK W "  ...deleted!"
"RTN","RMPOPED",477,0)
 Q
"RTN","RMPOPED",478,0)
ITEMO() ; Choose Option
"RTN","RMPOPED",479,0)
 K DIR
"RTN","RMPOPED",480,0)
 S DIR(0)="SBO^A:Add;D:Delete;E:Edit",DIR("A")="Select ACTION" D ^DIR
"RTN","RMPOPED",481,0)
 Q Y
"RTN","RMPOPED",482,0)
 ;
"RTN","RMPOPED",483,0)
PARSE(RMPRTXT) ; Utility to break line of text over 80 characters into 2 lines
"RTN","RMPOPED",484,0)
 ; Input:
"RTN","RMPOPED",485,0)
 ; RMPRTXT = Two line array to parse
"RTN","RMPOPED",486,0)
 ;          RMPRTXT(1) = ICD-## Diagnosis code: ###.#### -          Required
"RTN","RMPOPED",487,0)
 ;          RMPRTXT(2) = Full Description up to 245 characters      Required
"RTN","RMPOPED",488,0)
 ;          RMPRTXT(3) = Suspense Info                              Optional
"RTN","RMPOPED",489,0)
 ; 
"RTN","RMPOPED",490,0)
 ; Output:
"RTN","RMPOPED",491,0)
 ; RMPRTXT array with each line of text < 80 characters and ending in a whole word.
"RTN","RMPOPED",492,0)
 ;
"RTN","RMPOPED",493,0)
 ;
"RTN","RMPOPED",494,0)
 N RMPRFND,RMPRCNT1,RMPRCNT2,RMPRLLEN,RMPRSUSP
"RTN","RMPOPED",495,0)
 S RMPRFND=""
"RTN","RMPOPED",496,0)
 I $G(RMPRTXT(1))="" S RMPRTXT(1)="No ICD Code" Q
"RTN","RMPOPED",497,0)
 I $G(RMPRTXT(2))="" S RMPRTXT(2)="No ICD Code Description" Q
"RTN","RMPOPED",498,0)
 ; Save Suspense Data if it exists
"RTN","RMPOPED",499,0)
 S RMPRSUSP=$G(RMPRTXT(3)) K RMPRTXT(3)
"RTN","RMPOPED",500,0)
 ; Check to see if Code & Description will fit on one 80 character line
"RTN","RMPOPED",501,0)
 I $L(RMPRTXT(1))+$L(RMPRTXT(2))'>80 D  Q
"RTN","RMPOPED",502,0)
 .S RMPRTXT(1)=RMPRTXT(1)_RMPRTXT(2)
"RTN","RMPOPED",503,0)
 .K RMPRTXT(2)
"RTN","RMPOPED",504,0)
 .; If Suspense info, add it to end of description
"RTN","RMPOPED",505,0)
 .I $L(RMPRSUSP)>0 D  Q
"RTN","RMPOPED",506,0)
 ..I $L(RMPRTXT(1))<47 S RMPRTXT(1)=RMPRTXT(1)_RMPRSUSP Q
"RTN","RMPOPED",507,0)
 ..S RMPRTXT(2)=RMPRSUSP
"RTN","RMPOPED",508,0)
 ..Q
"RTN","RMPOPED",509,0)
 ; Adjust parser for 1st line with ICD Code plus 1 space after ICD code
"RTN","RMPOPED",510,0)
 S RMPRLLEN=80-$L(RMPRTXT(1))+1
"RTN","RMPOPED",511,0)
 F RMPRCNT1=RMPRLLEN:-1:1 D  Q:RMPRFND
"RTN","RMPOPED",512,0)
 .I $E(RMPRTXT(2),RMPRCNT1)=" " D  Q:RMPRFND
"RTN","RMPOPED",513,0)
 ..S RMPRTXT(1)=RMPRTXT(1)_$E(RMPRTXT(2),1,RMPRCNT1-1)
"RTN","RMPOPED",514,0)
 ..S RMPRTXT(2)=" "_$E(RMPRTXT(2),RMPRCNT1+1,999)
"RTN","RMPOPED",515,0)
 ..S RMPRFND=1
"RTN","RMPOPED",516,0)
 ; Loop through remainder of Description text and parse into 80 character lines with no word breaks
"RTN","RMPOPED",517,0)
 F RMPRCNT1=2:1 Q:'$D(RMPRTXT(RMPRCNT1))!($L(RMPRTXT(RMPRCNT1))'>80)  D  ; Line counter
"RTN","RMPOPED",518,0)
 .S RMPRFND=0
"RTN","RMPOPED",519,0)
 .F RMPRCNT2=80:-1:1 D  Q:RMPRFND  ; line break counter
"RTN","RMPOPED",520,0)
 ..I $E(RMPRTXT(RMPRCNT1),RMPRCNT2)=" " D  Q:RMPRFND
"RTN","RMPOPED",521,0)
 ...S RMPRTXT(RMPRCNT1+1)=" "_$E(RMPRTXT(RMPRCNT1),RMPRCNT2+1,999)
"RTN","RMPOPED",522,0)
 ...S RMPRTXT(RMPRCNT1)=$E(RMPRTXT(RMPRCNT1),1,RMPRCNT2-1)
"RTN","RMPOPED",523,0)
 ...S RMPRFND=1 ; Stop for line breaks
"RTN","RMPOPED",524,0)
 ; If Suspense info, add it to end of description
"RTN","RMPOPED",525,0)
 I $L(RMPRSUSP)>0 D
"RTN","RMPOPED",526,0)
 .; Check to Add to last line
"RTN","RMPOPED",527,0)
 .I $L(RMPRTXT(RMPRCNT1))<47 S RMPRTXT(RMPRCNT1)=RMPRTXT(RMPRCNT1)_" "_RMPRSUSP Q
"RTN","RMPOPED",528,0)
 .; Add to new line
"RTN","RMPOPED",529,0)
 .I $L(RMPRTXT(RMPRCNT1))'<47 S RMPRTXT(RMPRCNT1+1)=" "_RMPRSUSP
"RTN","RMPOPED",530,0)
 Q
"RTN","RMPOPED",531,0)
 ; End of RMPOPED
"RTN","RMPORNQ")
0^6^B6321620^B5946232
"RTN","RMPORNQ",1,0)
RMPORNQ ;(VA-EDS)PAK/HINES CIOFO/HNC - NEW PATIENT REPORT ;7/24/98
"RTN","RMPORNQ",2,0)
 ;;3.0;PROSTHETICS;**29,77,180**;Feb 09, 1996;Build 12
"RTN","RMPORNQ",3,0)
 ;
"RTN","RMPORNQ",4,0)
 ;RVD patch #77 - insure that a dangling 'AC' x-ref will not cause
"RTN","RMPORNQ",5,0)
 ;                an undefined error.
"RTN","RMPORNQ",6,0)
 ;
"RTN","RMPORNQ",7,0)
 ;RMPR*3.0*180 Insure variable RMPODCNT is initialized for call to
"RTN","RMPORNQ",8,0)
 ;             SSN^RMPORPR for deceased patient check/totals.
"RTN","RMPORNQ",9,0)
 ;
"RTN","RMPORNQ",10,0)
START ;
"RTN","RMPORNQ",11,0)
 ;Set up site variables.
"RTN","RMPORNQ",12,0)
 D HOSITE^RMPOUTL0 I '$D(RMPOXITE) Q
"RTN","RMPORNQ",13,0)
 ;
"RTN","RMPORNQ",14,0)
 ;Ask starting date
"RTN","RMPORNQ",15,0)
 S %DT="AEX",%DT("A")="Enter the start date: "
"RTN","RMPORNQ",16,0)
 S %DT(0)=-DT
"RTN","RMPORNQ",17,0)
 S %DT("B")=$E(DT,4,5)_"/01"_"/"_$E(DT,2,3)
"RTN","RMPORNQ",18,0)
 D ^%DT Q:'Y!$D(DTOUT)
"RTN","RMPORNQ",19,0)
 S FRMDT=$P(Y,".")  ; extract ONLY date
"RTN","RMPORNQ",20,0)
 ;
"RTN","RMPORNQ",21,0)
 ;List the sought patient.
"RTN","RMPORNQ",22,0)
 S DIC="^RMPR(665,",L=0
"RTN","RMPORNQ",23,0)
 S DIS(0)="I $P($G(^RMPR(665,D0,""RMPOA"")),U,7)=RMPOXITE"
"RTN","RMPORNQ",24,0)
 S BY=".01,19.2",FR(1)="",FR(2)=FRMDT,TO(1)="",TO(2)=""
"RTN","RMPORNQ",25,0)
 S (RMEND,RMPORPT,PAGE,RMPODCNT)=0    ;RMPR*3.0*180
"RTN","RMPORNQ",26,0)
 S SPACE="",$P(SPACE," ",80)="",COUNT=0,DASH="",$P(DASH,"-",79)=""
"RTN","RMPORNQ",27,0)
 D NOW^%DTC S Y=% X ^DD("DD") S RPTDT=$P(Y,"@",1)_"  "_$P($P(Y,"@",2),":",1,2)
"RTN","RMPORNQ",28,0)
 S DHD="W ?0 D RPTHDR^RMPORNQ"
"RTN","RMPORNQ",29,0)
 S FLDS=".01;C1;L22;""PATIENT"",W $$SSN^RMPORPR;C25;R4;""SSN"",W $$PRI^RMPORNQ;31;L32;""PRIMARY ITEM"",19.2;C65;L10;""START"""
"RTN","RMPORNQ",30,0)
 S DIOEND="I $G(Y)'[U S COUNT=$E(""      "",1,(6-$L(COUNT)))_COUNT W !!,?50,""TOTAL PATIENTS: "",COUNT S RMEND=1 S:IOST[""P-"" RMPORPT=1"
"RTN","RMPORNQ",31,0)
 D EN1^DIP
"RTN","RMPORNQ",32,0)
 I RMPORPT=0,$G(RMEND) K DIR S DIR(0)="E" D ^DIR
"RTN","RMPORNQ",33,0)
EXIT ;
"RTN","RMPORNQ",34,0)
 ;
"RTN","RMPORNQ",35,0)
 N RMPR,RMPRSITE D KILL^XUSCLEAN
"RTN","RMPORNQ",36,0)
 Q
"RTN","RMPORNQ",37,0)
SDT ;Activation date.
"RTN","RMPORNQ",38,0)
 S X=$P($G(^RMPR(665,D0,"RMPOA")),U,2)
"RTN","RMPORNQ",39,0)
 I X S X=$E(X,4,5)_"/"_$E(X,6,7)_"/"_($E(X,1,3)+1700)
"RTN","RMPORNQ",40,0)
 Q
"RTN","RMPORNQ",41,0)
 ;
"RTN","RMPORNQ",42,0)
PRI() ;Get primary item.
"RTN","RMPORNQ",43,0)
 N ITMN
"RTN","RMPORNQ",44,0)
 ;
"RTN","RMPORNQ",45,0)
 S RMPOITM=$O(^RMPR(665,"AC","Y",D0,"")) Q:RMPOITM="" ""
"RTN","RMPORNQ",46,0)
 ; get item name from ITEM MASTER file as pointer field is DINUMed
"RTN","RMPORNQ",47,0)
 I '$D(^RMPR(665,D0,"RMPOC",RMPOITM,0)) Q ""
"RTN","RMPORNQ",48,0)
 S ITMN=$P(^RMPR(665,D0,"RMPOC",RMPOITM,0),U)
"RTN","RMPORNQ",49,0)
 S ITMN=$P(^RMPR(661,ITMN,0),U)
"RTN","RMPORNQ",50,0)
 S ITMN=$P(^PRC(441,ITMN,0),U,2)
"RTN","RMPORNQ",51,0)
 Q $E(ITMN,1,32)
"RTN","RMPORNQ",52,0)
 ;
"RTN","RMPORNQ",53,0)
RPTHDR ;Report header
"RTN","RMPORNQ",54,0)
 N RA S RA=RMPO("NAME"),PAGE=PAGE+1
"RTN","RMPORNQ",55,0)
 W RPTDT,?(40-($L(RA)/2)),RA,?65,"Page: "_PAGE
"RTN","RMPORNQ",56,0)
 W !?24,"New Patient Report",!
"RTN","RMPORNQ",57,0)
 W !,?4,"Patient",?24,"SSN",?39,"Primary Item",?64,"Activation Date"
"RTN","RMPORNQ",58,0)
 W !,"=====================",?24,"====",?30,"================================"
"RTN","RMPORNQ",59,0)
 W ?64,"===============",!
"RTN","RMPORNQ",60,0)
 Q
"RTN","RMPRDVN")
1^2^^B58045899
"RTN","RMPRDVN1")
1^3^^B7487666
"RTN","RMPRDVN2")
1^4^^B7371208
"RTN","RMPRDVN3")
1^5^^B14695880
"RTN","RMPRE29")
0^7^B41267108^B40052214
"RTN","RMPRE29",1,0)
RMPRE29 ;PHX/JLT,RVD-EDIT 2319 ;10/2/03  13:04
"RTN","RMPRE29",2,0)
 ;;3.0;PROSTHETICS;**36,41,51,57,62,74,81,61,145,150,180**;Feb 09, 1996;Build 12
"RTN","RMPRE29",3,0)
 ;
"RTN","RMPRE29",4,0)
 ;RVD patch #62 - call PCE API to update patient care encounter.
"RTN","RMPRE29",5,0)
 ;              - add a screen display if no changes to the HCPCS.
"RTN","RMPRE29",6,0)
 ;RVD patch #74 - call $$STATCHK^ICPTAPIU to check if CPT Code is 
"RTN","RMPRE29",7,0)
 ;                active for a given date.
"RTN","RMPRE29",8,0)
 ;RVD patch #81 - roll back patch RMPR*3.0*74 and returns the screen
"RTN","RMPRE29",9,0)
 ;                to the STATUS field of file #661.1.
"RTN","RMPRE29",10,0)
 ;RVD patch #61 - added screen not to process stock issue entries.
"RTN","RMPRE29",11,0)
 ;uses DBIA # 1995 & 1997.
"RTN","RMPRE29",12,0)
 ;
"RTN","RMPRE29",13,0)
 ;RB  patch 180 - Add model # and Contract # to editing capability
"RTN","RMPRE29",14,0)
 ;
"RTN","RMPRE29",15,0)
 W ! S DIC="^RMPR(660,",DIC(0)="AEMQZ",DIC("A")="Select PATIENT: "
"RTN","RMPRE29",16,0)
 S DIC("W")="D EN^RMPRD1",RMEND=0
"RTN","RMPRE29",17,0)
 S DIC("S")="I ($P(^(0),U,6)!($P(^(0),U,26)'="""")),($P(^(0),U,13)'=11)" W !
"RTN","RMPRE29",18,0)
 D ^DIC G:+Y'>0 EXIT L +^RMPR(660,+Y,0):1 I $T=0 W !,?5,$C(7),"Someone else is Editing this entry!" G EXIT
"RTN","RMPRE29",19,0)
 ;S (RMPRDA,DA)=+Y,DIE=DIC,DR="[RMPRE2319]" D ^DIE L -^RMPR(660,DA,0)
"RTN","RMPRE29",20,0)
 S DIE=DIC,(RMPRDA,DA)=+Y
"RTN","RMPRE29",21,0)
TYP1 ;edit type of transaction....
"RTN","RMPRE29",22,0)
 S R1(0)=$G(^RMPR(660,RMPRDA,0)),R1(1)=$G(^(1)),R1("AM")=$G(^("AM"))
"RTN","RMPRE29",23,0)
 S RMTOTCOS=$P(R1(0),U,16)
"RTN","RMPRE29",24,0)
 S (RMHCPC,RMHCOLD)=$P(R1(1),U,4),(RMTYPE,RMTYPS)=$P(R1(0),U,4),(RMCAT,RMCATS)=$P(R1("AM"),U,3),(RMSPE,RMSPES)=$P(R1("AM"),U,4),RMSOUR=$P(R1(1),U,14)
"RTN","RMPRE29",25,0)
TRAN K DIR S DIR(0)="660,2"
"RTN","RMPRE29",26,0)
 ;S DIR("A")="Enter Type of Transaction: "
"RTN","RMPRE29",27,0)
 S:$D(RMTYPS) DIR("B")=$S(RMTYPS="I":"INITIAL",RMTYPS="X":"REPAIR",RMTYPS="R":"REPLACE",RMTYPS="S":"SPARE",1:"")
"RTN","RMPRE29",28,0)
 D ^DIR
"RTN","RMPRE29",29,0)
 I $D(DUOUT)!$D(DTOUT) S RMEND=1 D SETED2 G QED2
"RTN","RMPRE29",30,0)
 I Y="" W !,"Please enter type of Transaction!!" G TRAN
"RTN","RMPRE29",31,0)
 S $P(R1(0),U,4)=Y,RMTYPE=Y
"RTN","RMPRE29",32,0)
 S RMTYPS=$S(Y="I":"INITIAL",Y="X":"REPAIR",Y="R":"REPLACE",Y="S":"SPARE",1:"")
"RTN","RMPRE29",33,0)
PCAT K DIR S DIR(0)="660,62"
"RTN","RMPRE29",34,0)
 S:$D(RMCATS) DIR("B")=$S(RMCATS=1:"SC/OP",RMCATS=2:"SC/IP",RMCATS=3:"NSC/IP",RMCATS=4:"NSC/OP",1:"")
"RTN","RMPRE29",35,0)
 D ^DIR
"RTN","RMPRE29",36,0)
 I $D(DUOUT)!$D(DTOUT) S RMEND=1 D SETED2 G QED2
"RTN","RMPRE29",37,0)
 I Y="" W !,"Please enter Patient Category!!" G PCAT
"RTN","RMPRE29",38,0)
 S RMCAT=Y
"RTN","RMPRE29",39,0)
 S $P(R1("AM"),U,3)=Y,RMCATS=$S(Y=1:"SC/OP",Y=2:"SC/IP",Y=3:"NSC/IP",Y=4:"NSC/OP",1:"")
"RTN","RMPRE29",40,0)
 K DIR I RMCAT<4 S $P(R1("AM"),U,4)="" G HCPC
"RTN","RMPRE29",41,0)
 S DIR(0)="660,63"
"RTN","RMPRE29",42,0)
 S:$D(RMSPES) DIR("B")=$S(RMSPES=1:"SPECIAL LEGISLATION",RMSPES=2:"A&A",RMSPES=3:"PHC",RMSPES=4:"ELIGIBILITY REFORM",1:"")
"RTN","RMPRE29",43,0)
 I RMCAT=4 D ^DIR I $D(DUOUT)!$D(DTOUT) S RMEND=1 D SETED2 G QED2
"RTN","RMPRE29",44,0)
 I RMCAT=4 S $P(R1("AM"),U,4)=Y,RMSPE=Y,RMSPES=$S(Y=1:"SPECIAL LEGISLATION",Y=2:"A&A",Y=3:"PHC",Y=4:"ELIGIBILITY REFORM",1:"")
"RTN","RMPRE29",45,0)
 K DIR
"RTN","RMPRE29",46,0)
 ;
"RTN","RMPRE29",47,0)
HCPC ;set type and ask item and HCPCS
"RTN","RMPRE29",48,0)
 D SETED2
"RTN","RMPRE29",49,0)
 ;ask source
"RTN","RMPRE29",50,0)
 N SRC
"RTN","RMPRE29",51,0)
 S SRC=$P(R1(0),U,14)
"RTN","RMPRE29",52,0)
 S DIE("NO^")="BACK"
"RTN","RMPRE29",53,0)
 S DR="12;4;4.5" D ^DIE
"RTN","RMPRE29",54,0)
 K DIE("NO^")
"RTN","RMPRE29",55,0)
 I $D(DUOUT)!$D(DTOUT)!$D(Y) S RMEND=1 G QED2
"RTN","RMPRE29",56,0)
 S R1(0)=$G(^RMPR(660,RMPRDA,0)),R1(1)=$G(^(1))
"RTN","RMPRE29",57,0)
 I $P(R1(0),U,14)'=SRC S RMHCOLD=""
"RTN","RMPRE29",58,0)
 S RMHCPC=$P(R1(1),U,4)
"RTN","RMPRE29",59,0)
 W !,"OLD CPT MODIFER: ",$P(R1(1),U,6)
"RTN","RMPRE29",60,0)
 ;if HCPCS was changed, Modifier must be changed
"RTN","RMPRE29",61,0)
 I RMHCOLD'=RMHCPC D
"RTN","RMPRE29",62,0)
 .S RDA=RMHCPC_"^"_$P(R1(0),U,4)_"^"_$P(R1(0),U,14)_"^"_660
"RTN","RMPRE29",63,0)
 .D CPT^RMPRCPTU(RDA) S $P(^RMPR(660,RMPRDA,1),U,6)=RMCPT
"RTN","RMPRE29",64,0)
 .W !,"NEW CPT MODIFIER: ",RMCPT
"RTN","RMPRE29",65,0)
 ;if HCPCS the same, ask user if want to edit modifier.
"RTN","RMPRE29",66,0)
 E  D
"RTN","RMPRE29",67,0)
 .S DIR(0)="Y",DIR("B")="N",DIR("A")="Would you like to edit the CPT Modifier "
"RTN","RMPRE29",68,0)
 .D ^DIR Q:$D(DUOUT)!$D(DTOUT)
"RTN","RMPRE29",69,0)
 .I (Y>0) D
"RTN","RMPRE29",70,0)
 ..S RDA=RMHCPC_"^"_$P(R1(0),U,4)_"^"_$P(R1(0),U,14)_"^"_660
"RTN","RMPRE29",71,0)
 ..D CPT^RMPRCPTU(RDA) S $P(^RMPR(660,RMPRDA,1),U,6)=RMCPT
"RTN","RMPRE29",72,0)
 ..K DIR
"RTN","RMPRE29",73,0)
 ..W:RMCPT=$P(R1(1),U,6) !!,"***Based on the information given above, CPT modifier string has not changed!!!",!
"RTN","RMPRE29",74,0)
 ..W:RMCPT'=$P(R1(1),U,6) !,"NEW CPT MODIFIER: ",RMCPT
"RTN","RMPRE29",75,0)
 S DR="9.2;9;21;38.7;16;28" D ^DIE       ;RMPR*3.0*180
"RTN","RMPRE29",76,0)
 I RMTOTCOS'=$P(^RMPR(660,DA,0),U,16) S DR="35////^S X=DUZ;36////^S X=DT" D ^DIE
"RTN","RMPRE29",77,0)
 I $D(DTOUT)!('$G(Y))!($D(DUOUT)) D CHK
"RTN","RMPRE29",78,0)
QED2 ;
"RTN","RMPRE29",79,0)
 Q:$D(RMPREDT)
"RTN","RMPRE29",80,0)
 L -^RMPR(660,RMPRDA,0)
"RTN","RMPRE29",81,0)
 K DIR W ! S DIR(0)="Y",DIR("A")="Would You like to Edit another Entry (Y/N) " D ^DIR
"RTN","RMPRE29",82,0)
 G:'$D(DTOUT)&(Y>0) RMPRE29
"RTN","RMPRE29",83,0)
EXIT ;
"RTN","RMPRE29",84,0)
 N RMPR,RMPRSITE D KILL^XUSCLEAN
"RTN","RMPRE29",85,0)
 K DIC,DIE,DIR,%,X,Y
"RTN","RMPRE29",86,0)
 Q
"RTN","RMPRE29",87,0)
SETED2 ;set 660
"RTN","RMPRE29",88,0)
 S ^RMPR(660,DA,0)=R1(0),^RMPR(660,DA,1)=R1(1),^RMPR(660,DA,"AM")=R1("AM")
"RTN","RMPRE29",89,0)
 S DIK="^RMPR(660,",DA=RMPRDA D IX1^DIK K DIC
"RTN","RMPRE29",90,0)
 D CHK
"RTN","RMPRE29",91,0)
 Q
"RTN","RMPRE29",92,0)
 ;
"RTN","RMPRE29",93,0)
QUICK ;quick edit for HCPCS and type
"RTN","RMPRE29",94,0)
 K RMCPT
"RTN","RMPRE29",95,0)
 W ! S DIC="^RMPR(660,",DIC(0)="AEMNQZ",DIC("A")="Select NUMBER, or Patient: "
"RTN","RMPRE29",96,0)
 S DIC("W")="D EN^RMPRD1"
"RTN","RMPRE29",97,0)
 S DIC("S")="I $P(^(0),U,6)!($P(^(0),U,26)'="""")" W !
"RTN","RMPRE29",98,0)
 D ^DIC G:+Y'>0 EXIT L +^RMPR(660,+Y,0):1 I $T=0 W !,?5,$C(7),"Someone else is Editing this entry!" G EXIT
"RTN","RMPRE29",99,0)
 ;add source
"RTN","RMPRE29",100,0)
 S (RMPRDA,DA)=+Y,DIE=DIC,DR="2;4.5"
"RTN","RMPRE29",101,0)
 S R1(0)=$G(^RMPR(660,DA,0)),R1(1)=$G(^RMPR(660,DA,1))
"RTN","RMPRE29",102,0)
 S RMTYPE=$P(R1(0),U,4),RMSOUR=$P(R1(0),U,14)
"RTN","RMPRE29",103,0)
 S RMHCOLD=$P(R1(1),U,4)
"RTN","RMPRE29",104,0)
 D ^DIE G:$D(DUOUT)!$D(DTOUT)!$D(DIROUT)!$D(Y) SET
"RTN","RMPRE29",105,0)
 S RMHCNEW=$P($G(^RMPR(660,DA,1)),U,4)
"RTN","RMPRE29",106,0)
 S RMTYPE=$P($G(^RMPR(660,DA,0)),U,4)
"RTN","RMPRE29",107,0)
 S RDA=RMHCNEW_"^"_RMTYPE_"^"_RMSOUR_"^"_660
"RTN","RMPRE29",108,0)
 W !,"OLD CPT MODIFER: ",$P(R1(1),U,6)
"RTN","RMPRE29",109,0)
 I RMHCOLD'=RMHCNEW D
"RTN","RMPRE29",110,0)
 .D CPT^RMPRCPTU(RDA)
"RTN","RMPRE29",111,0)
 .W !,"NEW CPT MODIFIER: ",RMCPT
"RTN","RMPRE29",112,0)
 .S $P(^RMPR(660,DA,1),U,6)=RMCPT
"RTN","RMPRE29",113,0)
 I RMHCOLD=RMHCNEW D
"RTN","RMPRE29",114,0)
 .W ! S DIR("B")="N",DIR(0)="Y",DIR("A")="Would You like to Edit CPT MODIFIER " D ^DIR
"RTN","RMPRE29",115,0)
 .I $D(DTOUT)!('$G(Y)) K DIR Q
"RTN","RMPRE29",116,0)
 .D CPT^RMPRCPTU(RDA)
"RTN","RMPRE29",117,0)
 .W:RMCPT=$P(R1(1),U,6) !!,"***Based on the information given above, CPT modifier string has not changed!!!",!
"RTN","RMPRE29",118,0)
 .W:RMCPT'=$P(R1(1),U,6) !,"NEW CPT MODIFIER: ",RMCPT
"RTN","RMPRE29",119,0)
 .S $P(^RMPR(660,DA,1),U,6)=RMCPT
"RTN","RMPRE29",120,0)
SET K DIR D CHK
"RTN","RMPRE29",121,0)
 W ! S DIR(0)="Y",DIR("A")="Would You like to Edit another Entry (Y/N)" D ^DIR
"RTN","RMPRE29",122,0)
 G:'$D(DTOUT)&(Y>0) QUICK^RMPRE29
"RTN","RMPRE29",123,0)
 L -^RMPR(660,RMPRDA,0)
"RTN","RMPRE29",124,0)
 D KILL^XUSCLEAN Q
"RTN","RMPRE29",125,0)
 ;
"RTN","RMPRE29",126,0)
CHK ;check for transaction changes
"RTN","RMPRE29",127,0)
 S RMTYPE=$P($G(^RMPR(660,RMPRDA,0)),U,4)
"RTN","RMPRE29",128,0)
 S RMHCPC=$P($G(^RMPR(660,RMPRDA,1)),U,4) Q:'$G(RMHCPC)
"RTN","RMPRE29",129,0)
 S RMCPT1=$P($G(^RMPR(661.1,RMHCPC,4)),U,1)
"RTN","RMPRE29",130,0)
 S RMCPT=$P($G(^RMPR(660,RMPRDA,1)),U,6)
"RTN","RMPRE29",131,0)
 I ((RMTYPE="R")!(RMTYPE="X")),(RMCPT'["RP"),($G(^RMPR(661.1,RMHCPC,4))["RP") D ADDRP
"RTN","RMPRE29",132,0)
 I ((RMTYPE="I")!(RMTYPE="S")),(RMCPT["RP") D DELRP
"RTN","RMPRE29",133,0)
 I (RMSOUR="C"),(RMCPT["RR") D DELNU
"RTN","RMPRE29",134,0)
 I (RMSOUR="C"),(RMCPT'["RR"),(RMCPT1["NU"),(RMCPT'["N") D ADDNU
"RTN","RMPRE29",135,0)
 K RMHCPC,RMCI,RMC,RMCLEN,RMLPIECE,RMF,RMFPIECE,RMTYPE,RMPRA,R4DA Q
"RTN","RMPRE29",136,0)
 ;return to EDIT option
"RTN","RMPRE29",137,0)
DELRP ;logic for deleting 'RP' modifier with transaction change.
"RTN","RMPRE29",138,0)
 F RMCI=1:1:8 S RMC=$P(RMCPT,",",RMCI) I RMC="RP" S $P(RMCPT,",",RMCI)="" D
"RTN","RMPRE29",139,0)
 .S RMF=$F(RMCPT,",,"),RMFPIECE=$E(RMCPT,1,RMF-2)
"RTN","RMPRE29",140,0)
 .S RMLPIECE=$E(RMCPT,RMF,32),RMCPT=RMFPIECE_RMLPIECE,RMCLEN=$L(RMCPT)
"RTN","RMPRE29",141,0)
 .I $E(RMCPT,1)="," S RMCPT=$E(RMCPT,2,RMCLEN)
"RTN","RMPRE29",142,0)
 .I $E(RMCPT,RMCLEN)="," S RMCPT=$E(RMCPT,1,RMCLEN-1)
"RTN","RMPRE29",143,0)
 .S $P(^RMPR(660,RMPRDA,1),U,6)=RMCPT
"RTN","RMPRE29",144,0)
 Q
"RTN","RMPRE29",145,0)
DELNU ;logic for deleting 'NU' modifier.
"RTN","RMPRE29",146,0)
 F RMCI=1:1:8 S RMC=$P(RMCPT,",",RMCI) I RMC="NU" S $P(RMCPT,",",RMCI)="" D
"RTN","RMPRE29",147,0)
 .S RMF=$F(RMCPT,",,"),RMFPIECE=$E(RMCPT,1,RMF-2)
"RTN","RMPRE29",148,0)
 .S RMLPIECE=$E(RMCPT,RMF,32),RMCPT=RMFPIECE_RMLPIECE,RMCLEN=$L(RMCPT)
"RTN","RMPRE29",149,0)
 .I $E(RMCPT,1)="," S RMCPT=$E(RMCPT,2,RMCLEN)
"RTN","RMPRE29",150,0)
 .I $E(RMCPT,RMCLEN)="," S RMCPT=$E(RMCPT,1,RMCLEN-1)
"RTN","RMPRE29",151,0)
 .S $P(^RMPR(660,RMPRDA,1),U,6)=RMCPT
"RTN","RMPRE29",152,0)
 Q
"RTN","RMPRE29",153,0)
 ;
"RTN","RMPRE29",154,0)
ADDRP ;logic for adding 'RP' modifier with transaction change.
"RTN","RMPRE29",155,0)
 S RMCPT=RMCPT_",RP" S $P(^RMPR(660,RMPRDA,1),U,6)=RMCPT
"RTN","RMPRE29",156,0)
 Q
"RTN","RMPRE29",157,0)
ADDNU ;logic for adding 'NU' modifier.
"RTN","RMPRE29",158,0)
 S RMCPT=RMCPT_",NU" S $P(^RMPR(660,RMPRDA,1),U,6)=RMCPT
"RTN","RMPRE29",159,0)
 Q
"RTN","RMPRE29",160,0)
 ;END
"RTN","RMPRTDEL")
0^8^B1345520^n/a
"RTN","RMPRTDEL",1,0)
RMPRTDEL ;DEV/RGB - STOP PATIENT NOTIFICATION NIGHTLY JOB;02/18/16
"RTN","RMPRTDEL",2,0)
 ;;3.0;PROSTHETICS;**180**;Feb 09, 1996;Build 12
"RTN","RMPRTDEL",3,0)
 ;
"RTN","RMPRTDEL",4,0)
 Q
"RTN","RMPRTDEL",5,0)
EN ; Entry Point
"RTN","RMPRTDEL",6,0)
 ;
"RTN","RMPRTDEL",7,0)
 D DELETE
"RTN","RMPRTDEL",8,0)
 D BMES^XPDUTL("Task removal completed")
"RTN","RMPRTDEL",9,0)
 Q
"RTN","RMPRTDEL",10,0)
 ;
"RTN","RMPRTDEL",11,0)
 ;
"RTN","RMPRTDEL",12,0)
DELETE ;Delete Task
"RTN","RMPRTDEL",13,0)
 N RMPRTSK,RMPROPT,DA,DIK
"RTN","RMPRTDEL",14,0)
 S RMPRTSK="RMPR DVN NIGHTLY JOB"
"RTN","RMPRTDEL",15,0)
 S RMPROPT=$O(^DIC(19,"B",RMPRTSK,"")) Q:'RMPROPT
"RTN","RMPRTDEL",16,0)
 S DA="" S:'$G(DT) DT=$$DT^XLFDT
"RTN","RMPRTDEL",17,0)
 F  S DA=$O(^DIC(19.2,"B",RMPROPT,DA)) Q:'+DA  D
"RTN","RMPRTDEL",18,0)
 . S ^XTMP("RMPRTSK",$J,0)=$$FMADD^XLFDT(DT,90)_"^"_DT_"^copy of RMPR DVN NIGHTLY Task^"_DA
"RTN","RMPRTDEL",19,0)
 . M ^XTMP("RMPRTSK",$J,"DIC",19.2,DA)=^DIC(19.2,DA)
"RTN","RMPRTDEL",20,0)
 . S DIK="^DIC(19.2," D ^DIK
"RTN","RMPRTDEL",21,0)
 . D BMES^XPDUTL("Legacy task "_RMPRTSK_" Deleted.")
"RTN","RMPRTDEL",22,0)
 Q
"RTN","RMPRTDEL",23,0)
 ;
"VER")
8.0^22.0
"BLD",9390,6)
^158
**END**
**END**

