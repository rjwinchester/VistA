Released RMPR*3*189 SEQ #165
Extracted from mail message
**KIDS**:RMPR*3.0*189^

**INSTALL NAME**
RMPR*3.0*189
"BLD",10362,0)
RMPR*3.0*189^PROSTHETICS^0^3170807^y
"BLD",10362,1,0)
^^3^3^3170703^
"BLD",10362,1,1,0)
This patch ensures that, when the user modifies the contract number in the
"BLD",10362,1,2,0)
RMPR OFFICIAL MENU|Purchasing|Edit 2319 option, the change is reflected 
"BLD",10362,1,3,0)
in the RMPR4 RPC report.
"BLD",10362,4,0)
^9.64PA^^
"BLD",10362,6)
1^
"BLD",10362,6.3)
14
"BLD",10362,"ABPKG")
n
"BLD",10362,"KRN",0)
^9.67PA^779.2^20
"BLD",10362,"KRN",.4,0)
.4
"BLD",10362,"KRN",.401,0)
.401
"BLD",10362,"KRN",.402,0)
.402
"BLD",10362,"KRN",.403,0)
.403
"BLD",10362,"KRN",.5,0)
.5
"BLD",10362,"KRN",.84,0)
.84
"BLD",10362,"KRN",3.6,0)
3.6
"BLD",10362,"KRN",3.8,0)
3.8
"BLD",10362,"KRN",9.2,0)
9.2
"BLD",10362,"KRN",9.8,0)
9.8
"BLD",10362,"KRN",9.8,"NM",0)
^9.68A^2^2
"BLD",10362,"KRN",9.8,"NM",1,0)
RMPR4M^^0^B35332873
"BLD",10362,"KRN",9.8,"NM",2,0)
RMPRE29^^0^B46941510
"BLD",10362,"KRN",9.8,"NM","B","RMPR4M",1)

"BLD",10362,"KRN",9.8,"NM","B","RMPRE29",2)

"BLD",10362,"KRN",19,0)
19
"BLD",10362,"KRN",19.1,0)
19.1
"BLD",10362,"KRN",101,0)
101
"BLD",10362,"KRN",409.61,0)
409.61
"BLD",10362,"KRN",771,0)
771
"BLD",10362,"KRN",779.2,0)
779.2
"BLD",10362,"KRN",870,0)
870
"BLD",10362,"KRN",8989.51,0)
8989.51
"BLD",10362,"KRN",8989.52,0)
8989.52
"BLD",10362,"KRN",8994,0)
8994
"BLD",10362,"KRN","B",.4,.4)

"BLD",10362,"KRN","B",.401,.401)

"BLD",10362,"KRN","B",.402,.402)

"BLD",10362,"KRN","B",.403,.403)

"BLD",10362,"KRN","B",.5,.5)

"BLD",10362,"KRN","B",.84,.84)

"BLD",10362,"KRN","B",3.6,3.6)

"BLD",10362,"KRN","B",3.8,3.8)

"BLD",10362,"KRN","B",9.2,9.2)

"BLD",10362,"KRN","B",9.8,9.8)

"BLD",10362,"KRN","B",19,19)

"BLD",10362,"KRN","B",19.1,19.1)

"BLD",10362,"KRN","B",101,101)

"BLD",10362,"KRN","B",409.61,409.61)

"BLD",10362,"KRN","B",771,771)

"BLD",10362,"KRN","B",779.2,779.2)

"BLD",10362,"KRN","B",870,870)

"BLD",10362,"KRN","B",8989.51,8989.51)

"BLD",10362,"KRN","B",8989.52,8989.52)

"BLD",10362,"KRN","B",8994,8994)

"BLD",10362,"QDEF")
^^^^NO^^^^NO^^YES
"BLD",10362,"QUES",0)
^9.62^^
"BLD",10362,"REQB",0)
^9.611^2^2
"BLD",10362,"REQB",1,0)
RMPR*3.0*133^2
"BLD",10362,"REQB",2,0)
RMPR*3.0*180^2
"BLD",10362,"REQB","B","RMPR*3.0*133",1)

"BLD",10362,"REQB","B","RMPR*3.0*180",2)

"MBREQ")
0
"PKG",286,-1)
1^1
"PKG",286,0)
PROSTHETICS^RMPR^PROSTHETICS VERSION 3.0 ALPHA
"PKG",286,20,0)
^9.402P^^0
"PKG",286,22,0)
^9.49I^1^1
"PKG",286,22,1,0)
3.0^2960209^2960314
"PKG",286,22,1,"PAH",1,0)
189^3170807
"PKG",286,22,1,"PAH",1,1,0)
^^3^3^3170807
"PKG",286,22,1,"PAH",1,1,1,0)
This patch ensures that, when the user modifies the contract number in the
"PKG",286,22,1,"PAH",1,1,2,0)
RMPR OFFICIAL MENU|Purchasing|Edit 2319 option, the change is reflected 
"PKG",286,22,1,"PAH",1,1,3,0)
in the RMPR4 RPC report.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
2
"RTN","RMPR4M")
0^1^B35332873^B29241453
"RTN","RMPR4M",1,0)
RMPR4M ;PHX/HNB,RVD - PURCHASE CARD MODULE FUNCTIONS ;3/1/1996
"RTN","RMPR4M",2,0)
 ;;3.0;PROSTHETICS;**3,26,28,30,41,62,90,133,189**;Feb 09, 1996;Build 14
"RTN","RMPR4M",3,0)
 ;Per VA Directive 6402, this routine should not be modified.
"RTN","RMPR4M",4,0)
 ;
"RTN","RMPR4M",5,0)
 ; RVD patch #62 - pce and suspense link to 2319
"RTN","RMPR4M",6,0)
POST2 ;*** Posting Data to 2319 *******************************************
"RTN","RMPR4M",7,0)
 ;set global to local table/variables
"RTN","RMPR4M",8,0)
 S R190=$G(^RMPR(664,RMPRA,0))
"RTN","RMPR4M",9,0)
 S R192=$G(^RMPR(664,RMPRA,2))
"RTN","RMPR4M",10,0)
 S R193=$G(^RMPR(664,RMPRA,3))
"RTN","RMPR4M",11,0)
 S R194=$G(^RMPR(664,RMPRA,4))
"RTN","RMPR4M",12,0)
 W !,"...now posting to file 660..."
"RTN","RMPR4M",13,0)
ADD ;for adding new entry in 2319
"RTN","RMPR4M",14,0)
 S RMPHC="" I $D(^TMP("RM",$J,"N")) D
"RTN","RMPR4M",15,0)
 .F I=0:0 S I=$O(^TMP("RM",$J,"N",I)) Q:I'>0  S RMI=$G(^RMPR(664,RMPRA,1,I,0)) I RMI D
"RTN","RMPR4M",16,0)
 ..S RMCPT=$P($G(^RMPR(664,RMPRA,1,I,4)),U,2)
"RTN","RMPR4M",17,0)
 ..S DIC="^RMPR(660,",DIC(0)="L",X=DT
"RTN","RMPR4M",18,0)
 ..K DD,DO D FILE^DICN
"RTN","RMPR4M",19,0)
 ..S $P(^RMPR(664,RMPRA,1,I,0),U,13)=+Y
"RTN","RMPR4M",20,0)
 ..D TOT
"RTN","RMPR4M",21,0)
 ..S:$P(RMI,U,16) RMPHC=$P(^RMPR(661.1,$P(RMI,U,16),0),U,4)
"RTN","RMPR4M",22,0)
 ..S R19A=+Y
"RTN","RMPR4M",23,0)
 ..S R19I=$G(^RMPR(664,RMPRA,1,I,0))
"RTN","RMPR4M",24,0)
 ..S R19(660,R19A_",",8)=RMPR("STA")
"RTN","RMPR4M",25,0)
 ..S R19(660,R19A_",",.02)=$P(R190,U,2)
"RTN","RMPR4M",26,0)
 ..S R19(660,R19A_",",7)=$P(R190,U,4)
"RTN","RMPR4M",27,0)
 ..S R19(660,R19A_",",4.3)=$P(R194,U,2)
"RTN","RMPR4M",28,0)
 ..S R19(660,R19A_",",23)=$P(R194,U,5)
"RTN","RMPR4M",29,0)
 ..S R19(660,R19A_",",1)=$P(R190,U,1)
"RTN","RMPR4M",30,0)
 ..S R19(660,R19A_",",25)=$P(R193,U,1)
"RTN","RMPR4M",31,0)
 ..S R19(660,R19A_",",27)=DUZ
"RTN","RMPR4M",32,0)
 ..S R19(660,R19A_",",2)=$P(R19I,U,9)
"RTN","RMPR4M",33,0)
 ..S R19(660,R19A_",",4)=$P(R19I,U,1)
"RTN","RMPR4M",34,0)
 ..S R19(660,R19A_",",5)=$P(R19I,U,4)
"RTN","RMPR4M",35,0)
 ..S R19(660,R19A_",",4.5)=$P(R19I,U,16)
"RTN","RMPR4M",36,0)
 ..S R19(660,R19A_",",4.7)=RMCPT
"RTN","RMPR4M",37,0)
 ..S R19(660,R19A_",",4.1)=RMPHC
"RTN","RMPR4M",38,0)
 ..S R19(660,R19A_",",12)=$P(R19I,U,12)
"RTN","RMPR4M",39,0)
 ..S R19(660,R19A_",",78)=$P(R19I,U,5)
"RTN","RMPR4M",40,0)
 ..S R19(660,R19A_",",16)=$P(R19I,U,8)
"RTN","RMPR4M",41,0)
 ..S R19(660,R19A_",",24)=$P(R19I,U,2)
"RTN","RMPR4M",42,0)
 ..S R19(660,R19A_",",62)=$P(R19I,U,10)
"RTN","RMPR4M",43,0)
 ..S R19(660,R19A_",",63)=$P(R19I,U,11)
"RTN","RMPR4M",44,0)
 ..S R19(660,R19A_",",24)=$P(R19I,U,2)
"RTN","RMPR4M",45,0)
 ..S R19(660,R19A_",",14)=RMTOT
"RTN","RMPR4M",46,0)
 ..S R19(660,R19A_",",9)=$P(R19I,U,15)
"RTN","RMPR4M",47,0)
 ..S R19(660,R19A_",",11)=14
"RTN","RMPR4M",48,0)
 ..S R19(660,R19A_",",68)=RGRP1
"RTN","RMPR4M",49,0)
 ..S R19(660,R19A_",",8.14)=0
"RTN","RMPR4M",50,0)
 ..; update CONTRACT #, LOT #, and MODEL in 660
"RTN","RMPR4M",51,0)
 ..S R19(660,R19A_",",9.2)=$$GET1^DIQ(664.02,$$I66402(R19A,RMPRA)_","_RMPRA_",",15.4)
"RTN","RMPR4M",52,0)
 ..S R19(660,R19A_",",24)=$$GET1^DIQ(664.02,$$I66402(R19A,RMPRA)_","_RMPRA_",",15.6)
"RTN","RMPR4M",53,0)
 ..S R19(660,R19A_",",38.7)=$P(RMI,U,14)
"RTN","RMPR4M",54,0)
 ..D FILE^DIE("K","R19","ERROR")
"RTN","RMPR4M",55,0)
 ..I $D(^RMPR(664,RMPRA,1,I,4)) S $P(^RMPR(660,R19A,4),U,1)=$P(^RMPR(664,RMPRA,1,I,4),U,1)
"RTN","RMPR4M",56,0)
 ..MERGE ^RMPR(660,R19A,"DES")=^RMPR(664,RMPRA,1,I,1)
"RTN","RMPR4M",57,0)
 ..S RMPRDFN=$P(R190,U,2)
"RTN","RMPR4M",58,0)
 ..S RM60LINK(R19A)=""
"RTN","RMPR4M",59,0)
 ..D CHK
"RTN","RMPR4M",60,0)
 ;
"RTN","RMPR4M",61,0)
EDIT ;for editing entry in 2319
"RTN","RMPR4M",62,0)
 S RMPHC="" I $D(^TMP("RM",$J,"E")) D
"RTN","RMPR4M",63,0)
 .F I=0:0 S I=$O(^TMP("RM",$J,"E",I)) Q:I'>0  S RMI=$G(^RMPR(664,RMPRA,1,I,0)),DA=$P(RMI,U,13) I DA D
"RTN","RMPR4M",64,0)
 ..S RMCPT=$P($G(^RMPR(664,RMPRA,1,I,4)),U,2)
"RTN","RMPR4M",65,0)
 ..D TOT
"RTN","RMPR4M",66,0)
 ..S:$P(RMI,U,16) RMPHC=$P(^RMPR(661.1,$P(RMI,U,16),0),U,4)
"RTN","RMPR4M",67,0)
 ..S $P(^RMPR(660,DA,0),U,11)=$P(RMI,U,15)
"RTN","RMPR4M",68,0)
 ..S $P(^RMPR(660,DA,0),U,4)=$P(RMI,U,9)
"RTN","RMPR4M",69,0)
 ..S $P(^RMPR(660,DA,0),U,7)=$P(RMI,U,4)
"RTN","RMPR4M",70,0)
 ..S $P(^RMPR(660,DA,0),U,8)=$P(RMI,U,5)
"RTN","RMPR4M",71,0)
 ..S $P(^RMPR(660,DA,0),U,13)=14
"RTN","RMPR4M",72,0)
 ..S $P(^RMPR(660,DA,0),U,16)=RMTOT
"RTN","RMPR4M",73,0)
 ..S $P(^RMPR(660,DA,"AM"),U,3)=$P(RMI,U,10)
"RTN","RMPR4M",74,0)
 ..S $P(^RMPR(660,DA,"AM"),U,4)=$P(RMI,U,11)
"RTN","RMPR4M",75,0)
 ..S $P(^RMPR(660,DA,0),U,22)=RMPHC
"RTN","RMPR4M",76,0)
 ..S $P(^RMPR(660,DA,1),U,4)=$P(RMI,U,16)
"RTN","RMPR4M",77,0)
 ..S $P(^RMPR(660,DA,1),U,6)=RMCPT
"RTN","RMPR4M",78,0)
 ..S $P(^RMPR(660,DA,0),U,18)=$P(RMI,U,8)
"RTN","RMPR4M",79,0)
 ..; update CONTRACT #, LOT #, and MODEL in 660
"RTN","RMPR4M",80,0)
 ..S $P(^RMPR(660,DA,2),U,9)=$P(RMI,U,14)
"RTN","RMPR4M",81,0)
 ..S $P(^RMPR(660,DA,0),U,24)=$$GET1^DIQ(664.02,$$I66402(DA,RMPRA)_","_RMPRA_",",15.6)
"RTN","RMPR4M",82,0)
 ..S $P(^RMPR(660,DA,9),U,2)=$$GET1^DIQ(664.02,$$I66402(DA,RMPRA)_","_RMPRA_",",15.4)
"RTN","RMPR4M",83,0)
 ..;update brief description field 24 in 660
"RTN","RMPR4M",84,0)
 ..S $P(^RMPR(660,DA,1),U,2)=$P(RMI,U,2)
"RTN","RMPR4M",85,0)
 ..I $D(^RMPR(664,RMPRA,1,I,4)) S $P(^RMPR(660,DA,4),U,1)=$P(^RMPR(664,RMPRA,1,I,4),U,1)
"RTN","RMPR4M",86,0)
 ..;added by patch #62
"RTN","RMPR4M",87,0)
 ..I $D(^RMPR(660,DA,10)) S RM10STAT=$P(^RMPR(660,DA,10),U,14)
"RTN","RMPR4M",88,0)
 ..I '$D(^RMPR(660,DA,10))!'$G(RM10STAT) D
"RTN","RMPR4M",89,0)
 ...K RM10STAT
"RTN","RMPR4M",90,0)
 ...S RM60LINK(DA)=""
"RTN","RMPR4M",91,0)
 ..MERGE ^RMPR(660,DA,"DES")=^RMPR(664,RMPRA,1,I,1)
"RTN","RMPR4M",92,0)
 ..S DIK="^RMPR(660," D IX1^DIK
"RTN","RMPR4M",93,0)
SHIP ;for shipping entry in 2319
"RTN","RMPR4M",94,0)
 I $G(RMSHIF) S DA=$P(R190,U,12) S:$G(DA) $P(^RMPR(660,DA,0),U,17)=$P(R190,U,11),$P(^RMPR(660,DA,0),U,16)=$P(R190,U,11) I '$G(DA) D
"RTN","RMPR4M",95,0)
 .S DIC="^RMPR(660,",DIC(0)="L",X=DT
"RTN","RMPR4M",96,0)
 .K DD,DO D FILE^DICN
"RTN","RMPR4M",97,0)
 .S $P(^RMPR(664,RMPRA,0),U,12)=+Y
"RTN","RMPR4M",98,0)
 .S R19IEN=$O(^RMPR(664,RMPRA,1,0)) Q:R19IEN=""
"RTN","RMPR4M",99,0)
 .S R19I=$G(^RMPR(664,RMPRA,1,R19IEN,0))
"RTN","RMPR4M",100,0)
 .S R19A=+Y
"RTN","RMPR4M",101,0)
 .S R19(660,R19A_",",8)=RMPR("STA")
"RTN","RMPR4M",102,0)
 .S R19(660,R19A_",",.02)=$P(R190,U,2)
"RTN","RMPR4M",103,0)
 .S R19(660,R19A_",",7)=$P(R190,U,4)
"RTN","RMPR4M",104,0)
 .S R19(660,R19A_",",4.3)=$P(R194,U,2)
"RTN","RMPR4M",105,0)
 .S R19(660,R19A_",",23)=$P(R194,U,5)
"RTN","RMPR4M",106,0)
 .S R19(660,R19A_",",1)=$P(R190,U,1)
"RTN","RMPR4M",107,0)
 .S R19(660,R19A_",",2)="X"
"RTN","RMPR4M",108,0)
 .S R19(660,R19A_",",25)=$P(R193,U,1)
"RTN","RMPR4M",109,0)
 .S R19(660,R19A_",",27)=DUZ
"RTN","RMPR4M",110,0)
 .S R19(660,R19A_",",6)=$P(R190,U,11)
"RTN","RMPR4M",111,0)
 .S R19(660,R19A_",",14)=$P(R190,U,11)
"RTN","RMPR4M",112,0)
 .S R19(660,R19A_",",11)=14
"RTN","RMPR4M",113,0)
 .S R19(660,R19A_",",12)="C"
"RTN","RMPR4M",114,0)
 .S R19(660,R19A_",",62)=$P(R19I,U,10)
"RTN","RMPR4M",115,0)
 .S R19(660,R19A_",",63)=$P(R19I,U,11)
"RTN","RMPR4M",116,0)
 .S R19(660,R19A_",",68)=RGRP1
"RTN","RMPR4M",117,0)
 .D FILE^DIE("K","R19","ERROR")
"RTN","RMPR4M",118,0)
 .I $D(^RMPR(660,R19A,10)) S RM10STAT=$P(^RMPR(660,R19A,10),U,14)
"RTN","RMPR4M",119,0)
 .I '$D(^RMPR(660,R19A,10))!'$G(RM10STAT) D
"RTN","RMPR4M",120,0)
 ..K RM10STAT
"RTN","RMPR4M",121,0)
 ..S RM60LINK(R19A)=""
"RTN","RMPR4M",122,0)
 ;
"RTN","RMPR4M",123,0)
CAN ;for CANCELING entry in 2319
"RTN","RMPR4M",124,0)
 ;call pce delete if patient encounter was recorded.
"RTN","RMPR4M",125,0)
 N RMI
"RTN","RMPR4M",126,0)
 I $D(^TMP("RM",$J,"C")) S DIK="^RMPR(660," F RMI=0:0 S RMI=$O(^TMP("RM",$J,"C",RMI)) Q:RMI'>0  D
"RTN","RMPR4M",127,0)
 .I $D(^RMPR(660,RMI,10)),$P(^RMPR(660,RMI,10),U,12) D
"RTN","RMPR4M",128,0)
 ..S RMCHK=0
"RTN","RMPR4M",129,0)
 ..S RMCHK=$$DEL^RMPRPCED(RMI)
"RTN","RMPR4M",130,0)
 .S DA=RMI D ^DIK
"RTN","RMPR4M",131,0)
 ;
"RTN","RMPR4M",132,0)
UPD ; Update Percent discount, Bank Authorization and remove shipping entry.
"RTN","RMPR4M",133,0)
 I $G(RMPERF)!$G(RMBANF) D
"RTN","RMPR4M",134,0)
 .F I=0:0 S I=$O(^RMPR(664,RMPRA,1,I)) Q:I'>0  S RMI=$G(^(I,0)),DA=$P(RMI,U,13) I DA D
"RTN","RMPR4M",135,0)
 ..I $G(RMPERF) D TOT S $P(^RMPR(660,DA,0),U,16)=RMTOT
"RTN","RMPR4M",136,0)
 ..S:$G(RMBANF) $P(^RMPR(660,DA,4),U,2)=$P(R194,U,2)
"RTN","RMPR4M",137,0)
 I $G(RMSHIF),($P(^RMPR(664,RMPRA,0),U,11)=0) S DA=$P(^(0),U,12),DIK="^RMPR(660," D ^DIK S $P(^RMPR(664,RMPRA,0),U,12)=""
"RTN","RMPR4M",138,0)
 ;
"RTN","RMPR4M",139,0)
KILL K RMTOT,RMI,R19I,R19A,DR,DA,RMPERF,RMBANF,RMSHIF,RMPHC,RMCPT
"RTN","RMPR4M",140,0)
 Q
"RTN","RMPR4M",141,0)
TOT S RMACT=$P(RMI,U,7),RMUNC=$P(RMI,U,3),RMQTY=$P(RMI,U,4)
"RTN","RMPR4M",142,0)
 I DCT S RMTOT=$S(RMACT=0!(RMACT>0):RMACT-$J(RMACT*DCT,0,2)*RMQTY,1:RMUNC-$J(RMUNC*DCT,0,2)*RMQTY)
"RTN","RMPR4M",143,0)
 I 'DCT S RMTOT=$S(RMACT=0!(RMACT>0):RMACT*RMQTY,1:RMUNC*RMQTY)
"RTN","RMPR4M",144,0)
 Q
"RTN","RMPR4M",145,0)
CHK I '$D(^RMPR(660,R19A,0)) W !!,$C(7),"**** POSTING TO 2319 FOR ITEM.."_I_" FAILED",!,"PLEASE RUN CLOSE-OUT OPTION AGAIN..." G KTMP^RMPR4E21
"RTN","RMPR4M",146,0)
 Q
"RTN","RMPR4M",147,0)
I66402(RMI660,RMI664) ; obtain IEN of line in 664.02 that contains match for pointer to 660
"RTN","RMPR4M",148,0)
 ; RMI660 - IEN in 660 which is the one that we are checking 664.02 for
"RTN","RMPR4M",149,0)
 ; RMI664 - IEN in 664 that we are searching on
"RTN","RMPR4M",150,0)
 N RMNS
"RTN","RMPR4M",151,0)
 S RMNS=0
"RTN","RMPR4M",152,0)
 F  S RMNS=$O(^RMPR(664,RMI664,1,RMNS)) Q:+RMNS=0  Q:$P(^RMPR(664,RMI664,1,RMNS,0),U,13)=RMI660
"RTN","RMPR4M",153,0)
 Q RMNS
"RTN","RMPRE29")
0^2^B46941510^B41267108
"RTN","RMPRE29",1,0)
RMPRE29 ;PHX/JLT,RVD-EDIT 2319 ;10/2/03  13:04
"RTN","RMPRE29",2,0)
 ;;3.0;PROSTHETICS;**36,41,51,57,62,74,81,61,145,150,180,189**;Feb 09, 1996;Build 14
"RTN","RMPRE29",3,0)
 ; Per VA Directive 6402, this routine should not be modified.
"RTN","RMPRE29",4,0)
 ;RVD patch #62 - call PCE API to update patient care encounter.
"RTN","RMPRE29",5,0)
 ;              - add a screen display if no changes to the HCPCS.
"RTN","RMPRE29",6,0)
 ;RVD patch #74 - call $$STATCHK^ICPTAPIU to check if CPT Code is 
"RTN","RMPRE29",7,0)
 ;                active for a given date.
"RTN","RMPRE29",8,0)
 ;RVD patch #81 - roll back patch RMPR*3.0*74 and returns the screen
"RTN","RMPRE29",9,0)
 ;                to the STATUS field of file #661.1.
"RTN","RMPRE29",10,0)
 ;RVD patch #61 - added screen not to process stock issue entries.
"RTN","RMPRE29",11,0)
 ;uses DBIA # 1995 & 1997.
"RTN","RMPRE29",12,0)
 ;
"RTN","RMPRE29",13,0)
 ;RB  patch 180 - Add model # and Contract # to editing capability
"RTN","RMPRE29",14,0)
 ;
"RTN","RMPRE29",15,0)
 W ! S DIC="^RMPR(660,",DIC(0)="AEMQZ",DIC("A")="Select PATIENT: "
"RTN","RMPRE29",16,0)
 S DIC("W")="D EN^RMPRD1",RMEND=0
"RTN","RMPRE29",17,0)
 S DIC("S")="I ($P(^(0),U,6)!($P(^(0),U,26)'="""")),($P(^(0),U,13)'=11)" W !
"RTN","RMPRE29",18,0)
 D ^DIC G:+Y'>0 EXIT L +^RMPR(660,+Y,0):1 I $T=0 W !,?5,$C(7),"Someone else is Editing this entry!" G EXIT
"RTN","RMPRE29",19,0)
 ;S (RMPRDA,DA)=+Y,DIE=DIC,DR="[RMPRE2319]" D ^DIE L -^RMPR(660,DA,0)
"RTN","RMPRE29",20,0)
 S DIE=DIC,(RMPRDA,DA)=+Y
"RTN","RMPRE29",21,0)
TYP1 ;edit type of transaction....
"RTN","RMPRE29",22,0)
 S R1(0)=$G(^RMPR(660,RMPRDA,0)),R1(1)=$G(^(1)),R1("AM")=$G(^("AM"))
"RTN","RMPRE29",23,0)
 S RMTOTCOS=$P(R1(0),U,16)
"RTN","RMPRE29",24,0)
 S (RMHCPC,RMHCOLD)=$P(R1(1),U,4),(RMTYPE,RMTYPS)=$P(R1(0),U,4),(RMCAT,RMCATS)=$P(R1("AM"),U,3),(RMSPE,RMSPES)=$P(R1("AM"),U,4),RMSOUR=$P(R1(1),U,14)
"RTN","RMPRE29",25,0)
TRAN K DIR S DIR(0)="660,2"
"RTN","RMPRE29",26,0)
 ;S DIR("A")="Enter Type of Transaction: "
"RTN","RMPRE29",27,0)
 S:$D(RMTYPS) DIR("B")=$S(RMTYPS="I":"INITIAL",RMTYPS="X":"REPAIR",RMTYPS="R":"REPLACE",RMTYPS="S":"SPARE",1:"")
"RTN","RMPRE29",28,0)
 D ^DIR
"RTN","RMPRE29",29,0)
 I $D(DUOUT)!$D(DTOUT) S RMEND=1 D SETED2 G QED2
"RTN","RMPRE29",30,0)
 I Y="" W !,"Please enter type of Transaction!!" G TRAN
"RTN","RMPRE29",31,0)
 S $P(R1(0),U,4)=Y,RMTYPE=Y
"RTN","RMPRE29",32,0)
 S RMTYPS=$S(Y="I":"INITIAL",Y="X":"REPAIR",Y="R":"REPLACE",Y="S":"SPARE",1:"")
"RTN","RMPRE29",33,0)
PCAT K DIR S DIR(0)="660,62"
"RTN","RMPRE29",34,0)
 S:$D(RMCATS) DIR("B")=$S(RMCATS=1:"SC/OP",RMCATS=2:"SC/IP",RMCATS=3:"NSC/IP",RMCATS=4:"NSC/OP",1:"")
"RTN","RMPRE29",35,0)
 D ^DIR
"RTN","RMPRE29",36,0)
 I $D(DUOUT)!$D(DTOUT) S RMEND=1 D SETED2 G QED2
"RTN","RMPRE29",37,0)
 I Y="" W !,"Please enter Patient Category!!" G PCAT
"RTN","RMPRE29",38,0)
 S RMCAT=Y
"RTN","RMPRE29",39,0)
 S $P(R1("AM"),U,3)=Y,RMCATS=$S(Y=1:"SC/OP",Y=2:"SC/IP",Y=3:"NSC/IP",Y=4:"NSC/OP",1:"")
"RTN","RMPRE29",40,0)
 K DIR I RMCAT<4 S $P(R1("AM"),U,4)="" G HCPC
"RTN","RMPRE29",41,0)
 S DIR(0)="660,63"
"RTN","RMPRE29",42,0)
 S:$D(RMSPES) DIR("B")=$S(RMSPES=1:"SPECIAL LEGISLATION",RMSPES=2:"A&A",RMSPES=3:"PHC",RMSPES=4:"ELIGIBILITY REFORM",1:"")
"RTN","RMPRE29",43,0)
 I RMCAT=4 D ^DIR I $D(DUOUT)!$D(DTOUT) S RMEND=1 D SETED2 G QED2
"RTN","RMPRE29",44,0)
 I RMCAT=4 S $P(R1("AM"),U,4)=Y,RMSPE=Y,RMSPES=$S(Y=1:"SPECIAL LEGISLATION",Y=2:"A&A",Y=3:"PHC",Y=4:"ELIGIBILITY REFORM",1:"")
"RTN","RMPRE29",45,0)
 K DIR
"RTN","RMPRE29",46,0)
 ;
"RTN","RMPRE29",47,0)
HCPC ;set type and ask item and HCPCS
"RTN","RMPRE29",48,0)
 D SETED2
"RTN","RMPRE29",49,0)
 ;ask source
"RTN","RMPRE29",50,0)
 N SRC
"RTN","RMPRE29",51,0)
 S SRC=$P(R1(0),U,14)
"RTN","RMPRE29",52,0)
 S DIE("NO^")="BACK"
"RTN","RMPRE29",53,0)
 S DR="12;4;4.5" D ^DIE
"RTN","RMPRE29",54,0)
 K DIE("NO^")
"RTN","RMPRE29",55,0)
 I $D(DUOUT)!$D(DTOUT)!$D(Y) S RMEND=1 G QED2
"RTN","RMPRE29",56,0)
 S R1(0)=$G(^RMPR(660,RMPRDA,0)),R1(1)=$G(^(1))
"RTN","RMPRE29",57,0)
 I $P(R1(0),U,14)'=SRC S RMHCOLD=""
"RTN","RMPRE29",58,0)
 S RMHCPC=$P(R1(1),U,4)
"RTN","RMPRE29",59,0)
 W !,"OLD CPT MODIFER: ",$P(R1(1),U,6)
"RTN","RMPRE29",60,0)
 ;if HCPCS was changed, Modifier must be changed
"RTN","RMPRE29",61,0)
 I RMHCOLD'=RMHCPC D
"RTN","RMPRE29",62,0)
 .S RDA=RMHCPC_"^"_$P(R1(0),U,4)_"^"_$P(R1(0),U,14)_"^"_660
"RTN","RMPRE29",63,0)
 .D CPT^RMPRCPTU(RDA) S $P(^RMPR(660,RMPRDA,1),U,6)=RMCPT
"RTN","RMPRE29",64,0)
 .W !,"NEW CPT MODIFIER: ",RMCPT
"RTN","RMPRE29",65,0)
 ;if HCPCS the same, ask user if want to edit modifier.
"RTN","RMPRE29",66,0)
 E  D
"RTN","RMPRE29",67,0)
 .S DIR(0)="Y",DIR("B")="N",DIR("A")="Would you like to edit the CPT Modifier "
"RTN","RMPRE29",68,0)
 .D ^DIR Q:$D(DUOUT)!$D(DTOUT)
"RTN","RMPRE29",69,0)
 .I (Y>0) D
"RTN","RMPRE29",70,0)
 ..S RDA=RMHCPC_"^"_$P(R1(0),U,4)_"^"_$P(R1(0),U,14)_"^"_660
"RTN","RMPRE29",71,0)
 ..D CPT^RMPRCPTU(RDA) S $P(^RMPR(660,RMPRDA,1),U,6)=RMCPT
"RTN","RMPRE29",72,0)
 ..K DIR
"RTN","RMPRE29",73,0)
 ..W:RMCPT=$P(R1(1),U,6) !!,"***Based on the information given above, CPT modifier string has not changed!!!",!
"RTN","RMPRE29",74,0)
 ..W:RMCPT'=$P(R1(1),U,6) !,"NEW CPT MODIFIER: ",RMCPT
"RTN","RMPRE29",75,0)
 S DR="9.2;9;21;38.7;16;28" D ^DIE       ;RMPR*3.0*180
"RTN","RMPRE29",76,0)
 I RMTOTCOS'=$P(^RMPR(660,DA,0),U,16) S DR="35////^S X=DUZ;36////^S X=DT" D ^DIE
"RTN","RMPRE29",77,0)
 I $D(DTOUT)!('$G(Y))!($D(DUOUT)) D CHK
"RTN","RMPRE29",78,0)
 ; update 664 for Lot Number , Model, Serial Number and Contract # Changes
"RTN","RMPRE29",79,0)
 D UPD664
"RTN","RMPRE29",80,0)
QED2 ;
"RTN","RMPRE29",81,0)
 Q:$D(RMPREDT)
"RTN","RMPRE29",82,0)
 L -^RMPR(660,RMPRDA,0)
"RTN","RMPRE29",83,0)
 K DIR W ! S DIR(0)="Y",DIR("A")="Would You like to Edit another Entry (Y/N) " D ^DIR
"RTN","RMPRE29",84,0)
 G:'$D(DTOUT)&(Y>0) RMPRE29
"RTN","RMPRE29",85,0)
EXIT ;
"RTN","RMPRE29",86,0)
 N RMPR,RMPRSITE D KILL^XUSCLEAN
"RTN","RMPRE29",87,0)
 K DIC,DIE,DIR,%,X,Y
"RTN","RMPRE29",88,0)
 Q
"RTN","RMPRE29",89,0)
SETED2 ;set 660
"RTN","RMPRE29",90,0)
 S ^RMPR(660,DA,0)=R1(0),^RMPR(660,DA,1)=R1(1),^RMPR(660,DA,"AM")=R1("AM")
"RTN","RMPRE29",91,0)
 S DIK="^RMPR(660,",DA=RMPRDA D IX1^DIK K DIC
"RTN","RMPRE29",92,0)
 D CHK
"RTN","RMPRE29",93,0)
 Q
"RTN","RMPRE29",94,0)
 ;
"RTN","RMPRE29",95,0)
QUICK ;quick edit for HCPCS and type
"RTN","RMPRE29",96,0)
 K RMCPT
"RTN","RMPRE29",97,0)
 W ! S DIC="^RMPR(660,",DIC(0)="AEMNQZ",DIC("A")="Select NUMBER, or Patient: "
"RTN","RMPRE29",98,0)
 S DIC("W")="D EN^RMPRD1"
"RTN","RMPRE29",99,0)
 S DIC("S")="I $P(^(0),U,6)!($P(^(0),U,26)'="""")" W !
"RTN","RMPRE29",100,0)
 D ^DIC G:+Y'>0 EXIT L +^RMPR(660,+Y,0):1 I $T=0 W !,?5,$C(7),"Someone else is Editing this entry!" G EXIT
"RTN","RMPRE29",101,0)
 ;add source
"RTN","RMPRE29",102,0)
 S (RMPRDA,DA)=+Y,DIE=DIC,DR="2;4.5"
"RTN","RMPRE29",103,0)
 S R1(0)=$G(^RMPR(660,DA,0)),R1(1)=$G(^RMPR(660,DA,1))
"RTN","RMPRE29",104,0)
 S RMTYPE=$P(R1(0),U,4),RMSOUR=$P(R1(0),U,14)
"RTN","RMPRE29",105,0)
 S RMHCOLD=$P(R1(1),U,4)
"RTN","RMPRE29",106,0)
 D ^DIE G:$D(DUOUT)!$D(DTOUT)!$D(DIROUT)!$D(Y) SET
"RTN","RMPRE29",107,0)
 S RMHCNEW=$P($G(^RMPR(660,DA,1)),U,4)
"RTN","RMPRE29",108,0)
 S RMTYPE=$P($G(^RMPR(660,DA,0)),U,4)
"RTN","RMPRE29",109,0)
 S RDA=RMHCNEW_"^"_RMTYPE_"^"_RMSOUR_"^"_660
"RTN","RMPRE29",110,0)
 W !,"OLD CPT MODIFER: ",$P(R1(1),U,6)
"RTN","RMPRE29",111,0)
 I RMHCOLD'=RMHCNEW D
"RTN","RMPRE29",112,0)
 .D CPT^RMPRCPTU(RDA)
"RTN","RMPRE29",113,0)
 .W !,"NEW CPT MODIFIER: ",RMCPT
"RTN","RMPRE29",114,0)
 .S $P(^RMPR(660,DA,1),U,6)=RMCPT
"RTN","RMPRE29",115,0)
 I RMHCOLD=RMHCNEW D
"RTN","RMPRE29",116,0)
 .W ! S DIR("B")="N",DIR(0)="Y",DIR("A")="Would You like to Edit CPT MODIFIER " D ^DIR
"RTN","RMPRE29",117,0)
 .I $D(DTOUT)!('$G(Y)) K DIR Q
"RTN","RMPRE29",118,0)
 .D CPT^RMPRCPTU(RDA)
"RTN","RMPRE29",119,0)
 .W:RMCPT=$P(R1(1),U,6) !!,"***Based on the information given above, CPT modifier string has not changed!!!",!
"RTN","RMPRE29",120,0)
 .W:RMCPT'=$P(R1(1),U,6) !,"NEW CPT MODIFIER: ",RMCPT
"RTN","RMPRE29",121,0)
 .S $P(^RMPR(660,DA,1),U,6)=RMCPT
"RTN","RMPRE29",122,0)
SET K DIR D CHK
"RTN","RMPRE29",123,0)
 W ! S DIR(0)="Y",DIR("A")="Would You like to Edit another Entry (Y/N)" D ^DIR
"RTN","RMPRE29",124,0)
 G:'$D(DTOUT)&(Y>0) QUICK^RMPRE29
"RTN","RMPRE29",125,0)
 L -^RMPR(660,RMPRDA,0)
"RTN","RMPRE29",126,0)
 D KILL^XUSCLEAN Q
"RTN","RMPRE29",127,0)
 ;
"RTN","RMPRE29",128,0)
CHK ;check for transaction changes
"RTN","RMPRE29",129,0)
 S RMTYPE=$P($G(^RMPR(660,RMPRDA,0)),U,4)
"RTN","RMPRE29",130,0)
 S RMHCPC=$P($G(^RMPR(660,RMPRDA,1)),U,4) Q:'$G(RMHCPC)
"RTN","RMPRE29",131,0)
 S RMCPT1=$P($G(^RMPR(661.1,RMHCPC,4)),U,1)
"RTN","RMPRE29",132,0)
 S RMCPT=$P($G(^RMPR(660,RMPRDA,1)),U,6)
"RTN","RMPRE29",133,0)
 I ((RMTYPE="R")!(RMTYPE="X")),(RMCPT'["RP"),($G(^RMPR(661.1,RMHCPC,4))["RP") D ADDRP
"RTN","RMPRE29",134,0)
 I ((RMTYPE="I")!(RMTYPE="S")),(RMCPT["RP") D DELRP
"RTN","RMPRE29",135,0)
 I (RMSOUR="C"),(RMCPT["RR") D DELNU
"RTN","RMPRE29",136,0)
 I (RMSOUR="C"),(RMCPT'["RR"),(RMCPT1["NU"),(RMCPT'["N") D ADDNU
"RTN","RMPRE29",137,0)
 K RMHCPC,RMCI,RMC,RMCLEN,RMLPIECE,RMF,RMFPIECE,RMTYPE,RMPRA,R4DA Q
"RTN","RMPRE29",138,0)
 ;return to EDIT option
"RTN","RMPRE29",139,0)
DELRP ;logic for deleting 'RP' modifier with transaction change.
"RTN","RMPRE29",140,0)
 F RMCI=1:1:8 S RMC=$P(RMCPT,",",RMCI) I RMC="RP" S $P(RMCPT,",",RMCI)="" D
"RTN","RMPRE29",141,0)
 .S RMF=$F(RMCPT,",,"),RMFPIECE=$E(RMCPT,1,RMF-2)
"RTN","RMPRE29",142,0)
 .S RMLPIECE=$E(RMCPT,RMF,32),RMCPT=RMFPIECE_RMLPIECE,RMCLEN=$L(RMCPT)
"RTN","RMPRE29",143,0)
 .I $E(RMCPT,1)="," S RMCPT=$E(RMCPT,2,RMCLEN)
"RTN","RMPRE29",144,0)
 .I $E(RMCPT,RMCLEN)="," S RMCPT=$E(RMCPT,1,RMCLEN-1)
"RTN","RMPRE29",145,0)
 .S $P(^RMPR(660,RMPRDA,1),U,6)=RMCPT
"RTN","RMPRE29",146,0)
 Q
"RTN","RMPRE29",147,0)
DELNU ;logic for deleting 'NU' modifier.
"RTN","RMPRE29",148,0)
 F RMCI=1:1:8 S RMC=$P(RMCPT,",",RMCI) I RMC="NU" S $P(RMCPT,",",RMCI)="" D
"RTN","RMPRE29",149,0)
 .S RMF=$F(RMCPT,",,"),RMFPIECE=$E(RMCPT,1,RMF-2)
"RTN","RMPRE29",150,0)
 .S RMLPIECE=$E(RMCPT,RMF,32),RMCPT=RMFPIECE_RMLPIECE,RMCLEN=$L(RMCPT)
"RTN","RMPRE29",151,0)
 .I $E(RMCPT,1)="," S RMCPT=$E(RMCPT,2,RMCLEN)
"RTN","RMPRE29",152,0)
 .I $E(RMCPT,RMCLEN)="," S RMCPT=$E(RMCPT,1,RMCLEN-1)
"RTN","RMPRE29",153,0)
 .S $P(^RMPR(660,RMPRDA,1),U,6)=RMCPT
"RTN","RMPRE29",154,0)
 Q
"RTN","RMPRE29",155,0)
 ;
"RTN","RMPRE29",156,0)
ADDRP ;logic for adding 'RP' modifier with transaction change.
"RTN","RMPRE29",157,0)
 S RMCPT=RMCPT_",RP" S $P(^RMPR(660,RMPRDA,1),U,6)=RMCPT
"RTN","RMPRE29",158,0)
 Q
"RTN","RMPRE29",159,0)
ADDNU ;logic for adding 'NU' modifier.
"RTN","RMPRE29",160,0)
 S RMCPT=RMCPT_",NU" S $P(^RMPR(660,RMPRDA,1),U,6)=RMCPT
"RTN","RMPRE29",161,0)
 Q
"RTN","RMPRE29",162,0)
UPD664 ; update file 664 for Lot Number, Model, Serial Number, and Contract # Changes
"RTN","RMPRE29",163,0)
 ; -- get the changes from 660
"RTN","RMPRE29",164,0)
 N RMFDA,RMFDA1,RMORD,RMSSFI,RMN,RMI,RMNS,RMFERR
"RTN","RMPRE29",165,0)
 F RMI=9,9.2,21,38.7 S RMFDA(RMI)=$$GET1^DIQ(660,DA,RMI)
"RTN","RMPRE29",166,0)
 ; -- find the 664 IEN from the order number
"RTN","RMPRE29",167,0)
 S RMORD=$$GET1^DIQ(660,DA,23)
"RTN","RMPRE29",168,0)
 S RMSSFI=$O(^RMPR(664,"G",RMORD,""))
"RTN","RMPRE29",169,0)
 ; -- scan 664.02 for DA in piece 13 - RMNS will be the subscript of interest
"RTN","RMPRE29",170,0)
 S RMNS=0
"RTN","RMPRE29",171,0)
 F  S RMNS=$O(^RMPR(664,RMSSFI,1,RMNS)) Q:+RMNS=0  Q:$P(^RMPR(664,RMSSFI,1,RMNS,0),U,13)=DA
"RTN","RMPRE29",172,0)
 ; --save the fields into 664
"RTN","RMPRE29",173,0)
 S RMN=""
"RTN","RMPRE29",174,0)
 F RMI=15,15.4,15.6,13 S RMN=$O(RMFDA(RMN)) Q:RMN=""  D
"RTN","RMPRE29",175,0)
 .S RMFDA1(664.02,RMNS_","_RMSSFI_",",RMI)=RMFDA(RMN)
"RTN","RMPRE29",176,0)
 D UPDATE^DIE(,"RMFDA1",,"RMFERR")
"RTN","RMPRE29",177,0)
 Q
"RTN","RMPRE29",178,0)
 ; 
"RTN","RMPRE29",179,0)
 ;END
"VER")
8.0^22.2
"BLD",10362,6)
^165
**END**
**END**

