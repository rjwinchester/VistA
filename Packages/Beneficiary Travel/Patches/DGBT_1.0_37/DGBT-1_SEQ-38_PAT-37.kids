Released DGBT*1*37 SEQ #38
Extracted from mail message
**KIDS**:DGBT*1.0*37^

**INSTALL NAME**
DGBT*1.0*37
"BLD",11451,0)
DGBT*1.0*37^BENEFICIARY TRAVEL^0^3190401^y
"BLD",11451,1,0)
^^1^1^3190401^
"BLD",11451,1,1,0)
Please refer to patch description on FORUM for installation purposes.
"BLD",11451,4,0)
^9.64PA^^
"BLD",11451,6.3)
1
"BLD",11451,"ABPKG")
n
"BLD",11451,"KRN",0)
^9.67PA^1.5^24
"BLD",11451,"KRN",.4,0)
.4
"BLD",11451,"KRN",.401,0)
.401
"BLD",11451,"KRN",.402,0)
.402
"BLD",11451,"KRN",.403,0)
.403
"BLD",11451,"KRN",.5,0)
.5
"BLD",11451,"KRN",.84,0)
.84
"BLD",11451,"KRN",1.5,0)
1.5
"BLD",11451,"KRN",1.6,0)
1.6
"BLD",11451,"KRN",1.61,0)
1.61
"BLD",11451,"KRN",1.62,0)
1.62
"BLD",11451,"KRN",3.6,0)
3.6
"BLD",11451,"KRN",3.8,0)
3.8
"BLD",11451,"KRN",9.2,0)
9.2
"BLD",11451,"KRN",9.8,0)
9.8
"BLD",11451,"KRN",9.8,"NM",0)
^9.68A^3^3
"BLD",11451,"KRN",9.8,"NM",1,0)
DGBTCE^^0^B37987983
"BLD",11451,"KRN",9.8,"NM",2,0)
DGBTE1^^0^B35642185
"BLD",11451,"KRN",9.8,"NM",3,0)
DGBTEF^^0^B21619951
"BLD",11451,"KRN",9.8,"NM","B","DGBTCE",1)

"BLD",11451,"KRN",9.8,"NM","B","DGBTE1",2)

"BLD",11451,"KRN",9.8,"NM","B","DGBTEF",3)

"BLD",11451,"KRN",19,0)
19
"BLD",11451,"KRN",19.1,0)
19.1
"BLD",11451,"KRN",101,0)
101
"BLD",11451,"KRN",409.61,0)
409.61
"BLD",11451,"KRN",771,0)
771
"BLD",11451,"KRN",779.2,0)
779.2
"BLD",11451,"KRN",870,0)
870
"BLD",11451,"KRN",8989.51,0)
8989.51
"BLD",11451,"KRN",8989.52,0)
8989.52
"BLD",11451,"KRN",8994,0)
8994
"BLD",11451,"KRN","B",.4,.4)

"BLD",11451,"KRN","B",.401,.401)

"BLD",11451,"KRN","B",.402,.402)

"BLD",11451,"KRN","B",.403,.403)

"BLD",11451,"KRN","B",.5,.5)

"BLD",11451,"KRN","B",.84,.84)

"BLD",11451,"KRN","B",1.5,1.5)

"BLD",11451,"KRN","B",1.6,1.6)

"BLD",11451,"KRN","B",1.61,1.61)

"BLD",11451,"KRN","B",1.62,1.62)

"BLD",11451,"KRN","B",3.6,3.6)

"BLD",11451,"KRN","B",3.8,3.8)

"BLD",11451,"KRN","B",9.2,9.2)

"BLD",11451,"KRN","B",9.8,9.8)

"BLD",11451,"KRN","B",19,19)

"BLD",11451,"KRN","B",19.1,19.1)

"BLD",11451,"KRN","B",101,101)

"BLD",11451,"KRN","B",409.61,409.61)

"BLD",11451,"KRN","B",771,771)

"BLD",11451,"KRN","B",779.2,779.2)

"BLD",11451,"KRN","B",870,870)

"BLD",11451,"KRN","B",8989.51,8989.51)

"BLD",11451,"KRN","B",8989.52,8989.52)

"BLD",11451,"KRN","B",8994,8994)

"BLD",11451,"QDEF")
^^^^NO^^^^NO^^NO
"BLD",11451,"QUES",0)
^9.62^^
"BLD",11451,"REQB",0)
^9.611^2^2
"BLD",11451,"REQB",1,0)
DGBT*1.0*30^1
"BLD",11451,"REQB",2,0)
DGBT*1.0*34^1
"BLD",11451,"REQB","B","DGBT*1.0*30",1)

"BLD",11451,"REQB","B","DGBT*1.0*34",2)

"MBREQ")
0
"PKG",154,-1)
1^1
"PKG",154,0)
BENEFICIARY TRAVEL^DGBT^Beneficiary Travel
"PKG",154,22,0)
^9.49I^1^1
"PKG",154,22,1,0)
1.0^3030731^3020423^66481
"PKG",154,22,1,"PAH",1,0)
37^3190401
"PKG",154,22,1,"PAH",1,1,0)
^^1^1^3190401
"PKG",154,22,1,"PAH",1,1,1,0)
Please refer to patch description on FORUM for installation purposes.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
3
"RTN","DGBTCE")
0^1^B37987983^B37698850
"RTN","DGBTCE",1,0)
DGBTCE ;ALB/SCK/BLD,LAB - BENEFICIARY TRAVEL CLAIM RE-ENTER/EDIT ;03/20/2019
"RTN","DGBTCE",2,0)
 ;;1.0;Beneficiary Travel;**2,14,17,20,30,37**;September 25, 2001;Build 1
"RTN","DGBTCE",3,0)
 Q
"RTN","DGBTCE",4,0)
SCREEN ;
"RTN","DGBTCE",5,0)
 D QUIT^DGBTCE1
"RTN","DGBTCE",6,0)
 S DGBTTOUT=""
"RTN","DGBTCE",7,0)
 D SCREEN^DGBTEE1 Q:'$D(^DGBT(392,DGBTDT,0))  I DGBTTOUT=-1 S DGBTTOUT=1 Q
"RTN","DGBTCE",8,0)
 I $D(DGBTOACT) I DGBTOACT'=DGBTACCT S DGBTVAR(0)=^DGBT(392,DGBTDT,0) D FILE
"RTN","DGBTCE",9,0)
 S (DGBTMAL,DGBTFAB,DGBTME,DGBTCP,DGBTFLAG,DGBTDE,DGBTDCV,DGBTDCM,DGBTDPV,DGBTDPM)=0
"RTN","DGBTCE",10,0)
 S:$G(DGBTACCT)'>0 DGBTACCT=$P($G(DGBTVAR(0)),U,6)
"RTN","DGBTCE",11,0)
 I DGBTACCT=4!(DGBTACCT=5) I $$ABP^DGBTUTL(DFN) W !!,"*ALERT: Patient has an active bus pass, which expires on ",$$FMTE^XLFDT($$ABP^DGBTUTL(DFN)),".",! S DIR("A")="Press RETURN to continue",DIR(0)="E" D ^DIR K DIR ;20
"RTN","DGBTCE",12,0)
 S DGBTAP=VADM(1),DIE="^DGBT(392,",DA=DGBTDT,DR=$S(DGBTACCT=4:"42//"_DGBTAP,DGBTACCT=5:"43;S DGBTCP=X;42//"_DGBTAP,1:"44")
"RTN","DGBTCE",13,0)
 D ^DIE K DIE,DQ,DR I $D(DTOUT)!($D(Y)) S DGBTTOUT=1 Q
"RTN","DGBTCE",14,0)
 I DGBTACCT=4!(DGBTACCT=5) S:$D(DGBTVAR("M")) DGBTWAY=$P(DGBTVAR("M"),"^"),DGBTMILE=$P(DGBTVAR("M"),"^",2) S:$D(DGBTVAR("D")) DGBTCITY=$P(DGBTVAR("D"),"^",4),DGBTSTAT=$P(DGBTVAR("D"),"^",5)
"RTN","DGBTCE",15,0)
 S DGBTDIV=$P($G(^DGBT(392,DA,0)),U,11),DGBTRMK=$S($D(DGBTREC):$$DICLKUP^DGBTUTL(DGBTREC,DGBTDIV,4),1:"")
"RTN","DGBTCE",16,0)
 S DIE="^DGBT(392,",DA=DGBTDT
"RTN","DGBTCE",17,0)
 ;DGBT*1.0*37 replace 4 slashes 3///' the ' allows for the internal value of a pointer to be validated and pushed
"RTN","DGBTCE",18,0)
 S DR="3///`"_DGBTELIG_";6///`"_DGBTACTN_";21;I X="""" S Y=24;22;I X="""" S Y=24;23;24;24.1;24.2;25;I X="""" S Y=28;26;I X="""" S Y=28;27;28;28.1;28.2"
"RTN","DGBTCE",19,0)
 D ^DIE K DIE I $D(DTOUT)!($D(Y)) S DGBTTOUT=1 Q
"RTN","DGBTCE",20,0)
 W:DGBTRMK]"" !!,*7,"MILEAGE REMARKS: ",DGBTRMK,!
"RTN","DGBTCE",21,0)
 I DGBTACCT=4!(DGBTACCT=5) D  Q:$G(DGBTTOUT)
"RTN","DGBTCE",22,0)
 .I $G(MONTOT)'="" N OTRIPTYP S OTRIPTYP=$$GET1^DIQ(392,DGBTDT,31,"I")
"RTN","DGBTCE",23,0)
 . S DR="31//;S DGBTOWRT=X;32//;S DGBTML=X"
"RTN","DGBTCE",24,0)
 . I DGBTACCT=5&(DGBTCP=1) S DGBTMR=DGBTMR1
"RTN","DGBTCE",25,0)
 . S DIE="^DGBT(392,",DA=DGBTDT
"RTN","DGBTCE",26,0)
 . D ^DIE K DIE,DQ,DR I $D(DTOUT)!($D(Y)) S DGBTTOUT=1
"RTN","DGBTCE",27,0)
 .I ($G(MONTOT)'="")&($G(OTRIPTYP)'=$$GET1^DIQ(392,DGBTDT,31,"I")) D
"RTN","DGBTCE",28,0)
 ..N NTRIPTYP S NTRIPTYP=$$GET1^DIQ(392,DGBTDT,31,"I")
"RTN","DGBTCE",29,0)
 ..I (OTRIPTYP=1)&(NTRIPTYP=2) D  Q
"RTN","DGBTCE",30,0)
 ...S $P(MONTOT,U)=$P(MONTOT,U)+1
"RTN","DGBTCE",31,0)
 ...S $P(MONTOT,U,2)=$P(MONTOT,U,2)-1
"RTN","DGBTCE",32,0)
 ...S $P(MONTOT,U,3)=$P(MONTOT,U,3)+1
"RTN","DGBTCE",33,0)
 ..I (OTRIPTYP=2)&(NTRIPTYP=1) D  Q
"RTN","DGBTCE",34,0)
 ...S $P(MONTOT,U)=$P(MONTOT,U)-1
"RTN","DGBTCE",35,0)
 ...S $P(MONTOT,U,2)=$P(MONTOT,U,2)+1
"RTN","DGBTCE",36,0)
 ...S $P(MONTOT,U,3)=$P(MONTOT,U,3)-1
"RTN","DGBTCE",37,0)
 . N MODE S DIR(0)="Y",DIR("B")=$S($D(^DGBT(392,DGBTDT,"C")):"YES",1:"NO"),DIR("A")="COMMON CARRIER USED" D ^DIR K DIR S MODE=Y I $D(DIRUT),$G(DUOUT) S DGBTTOUT=-1 Q  ;20
"RTN","DGBTCE",38,0)
 . I 'MODE,$D(^DGBT(392,DGBTDT,"C")) S $P(^DGBT(392,DGBTDT,"A"),"^",4)="" F I="B","C"  K ^DGBT(392,DGBTDT,I)
"RTN","DGBTCE",39,0)
 . I $$GET1^DIQ(392,DGBTDT,44)'=""!($G(MODE)) S DIE="^DGBT(392,",DA=DGBTDT,DR="44COMMON CARRIER MODE" D ^DIE  I $D(Y) S DGBTTOUT=1 Q  ;20
"RTN","DGBTCE",40,0)
 . S DIE="^DGBT(392,",DA=DGBTDT I $$UP^XLFSTR($$GET1^DIQ(392,DGBTDT,44))["BUS" S DR="52R;I X'=""P"" S Y="""";53R" D ^DIE I $D(Y) S DGBTTOUT=1 Q  ;20
"RTN","DGBTCE",41,0)
 . I $$GET1^DIQ(392,DGBTDT,44)'="" S DIE="^DGBT(392,",DA=DGBTDT,DR="54;55;55.1" D ^DIE I $D(Y) S DGBTTOUT=1 Q  ;20
"RTN","DGBTCE",42,0)
DIE1 ;
"RTN","DGBTCE",43,0)
 S DGBTMLT=$S($D(DGBTVAR("M"))&((DGBTACCT=4)!(DGBTACCT=5)):$J((DGBTOWRT*DGBTML*DGBTMR),0,2),1:""),$P(^DGBT(392,DGBTDT,"M"),"^",3)=DGBTMLT,$P(DGBTVAR("M"),"^",3)=DGBTMLT
"RTN","DGBTCE",44,0)
 ;
"RTN","DGBTCE",45,0)
 S DIE="^DGBT(392,",DA=DGBTDT
"RTN","DGBTCE",46,0)
 I 'DGBTCORE D
"RTN","DGBTCE",47,0)
 . S DR="I DGBTACCT=4!(DGBTACCT=5) S Y=""@1"";41;7;@1;I DGBTMLFB=0 S Y=""@2"";34//;S DGBTMAL=X;35//;S DGBTFAB=X;@2;8//;S DGBTME=X"
"RTN","DGBTCE",48,0)
 I DGBTCORE S DR="" D
"RTN","DGBTCE",49,0)
 . S DR(1,392,1)="I DGBTACCT=4!(DGBTACCT=5) S Y=""@1"";41;@3;14;S DGBTCSL=$$AFTER^DGBTCSL(392,D0,X,$G(DGBTPRV)) S:DGBTCSL<1 Y=""@3"" W:DGBTCSL<1 ""   Required"" K DGBTPRV,DGBTCSL;"
"RTN","DGBTCE",50,0)
 . S DR(1,392,2)="@1;I DGBTMLFB=0 S Y=""@2"";34//;S DGBTMAL=X;35//;S DGBTFAB=X;@2;8//;S DGBTME=X"
"RTN","DGBTCE",51,0)
DIE3 ;
"RTN","DGBTCE",52,0)
 D ^DIE K DIE,DQ,DR I $D(DTOUT)!($D(Y)) S DGBTTOUT=1 Q
"RTN","DGBTCE",53,0)
 ;
"RTN","DGBTCE",54,0)
TCOST ;CALCULATE TOTAL COST AND MONTHLY CUM. DEDUCTIBLE
"RTN","DGBTCE",55,0)
MLFB ;
"RTN","DGBTCE",56,0)
 S DGBTMAF=$S(DGBTMLFB:DGBTMAL+DGBTFAB,1:0),DGBTMETC=DGBTME+$S($D(DGBTMAL):DGBTMAL,1:0)
"RTN","DGBTCE",57,0)
 I DGBTACCT'=4&(DGBTACCT'=5) S DGBTPA=DGBTMAF+DGBTME G CONT
"RTN","DGBTCE",58,0)
 I $D(DGBTMLT) S DGBTTC=$S(DGBTMLT+DGBTMAF'>DGBTMETC:DGBTMLT+DGBTMAF,DGBTMLT+DGBTMAF>DGBTMETC&(DGBTME>0):DGBTMETC,DGBTME'>0:DGBTMLT+DGBTMAF,1:DGBTMETC)
"RTN","DGBTCE",59,0)
 I DGBTACCT=5 S DGBTDE=0 S DGBTPA=$S((DGBTMLT+DGBTMAF)'=0:DGBTTC,1:DGBTMETC) G CONT
"RTN","DGBTCE",60,0)
DED ;
"RTN","DGBTCE",61,0)
 I $G(MONTOT)'="" N ODED S ODED=$$GET1^DIQ(392,DGBTDT,9)
"RTN","DGBTCE",62,0)
 F I=$E(DGBTDT,1,5)_"00.2399":0 S I=$O(^DGBT(392,"C",DFN,I)) Q:'I!($E(I,1,5)>$E(DGBTDT,1,5))  I I'=DGBTDT S DGBTDCM=DGBTDCM+($P(^DGBT(392,I,0),"^",9))
"RTN","DGBTCE",63,0)
 I $D(^DG(43.1,$O(^DG(43.1,(9999999.99999-DGBTDT))),"BT")) S DGBTRATE=^("BT"),DGBTDPV=$P(DGBTRATE,"^"),DGBTDPM=$P(DGBTRATE,"^",2),DGBTMR=$P(DGBTRATE,"^",3)
"RTN","DGBTCE",64,0)
 I $D(^DGBT(392,DGBTDT,"M")) S:$P(^("M"),"^")=1 DGBTDPV=DGBTDPV/2 I DGBTWAY'=$P(^("M"),"^")!(DGBTMILE'=$P(^("M"),"^",2)) I $D(^DGBT(392,DGBTDT,0)) S $P(^(0),"^",9)="" K ^DGBT(392,"AD",$P(^(0),"^",2),$E(DGBTDT,2,5),DGBTDT)
"RTN","DGBTCE",65,0)
 S DGBTDRM=DGBTDPM-DGBTDCM
"RTN","DGBTCE",66,0)
 I DGBTDRM<0 S DGBTDRM=0
"RTN","DGBTCE",67,0)
 I DGBTDE<0 S DGBTDE=0
"RTN","DGBTCE",68,0)
 S DGBTDCV=$S(DGBTDCM'<DGBTDPM:0,DGBTDRM'<DGBTDPV&(DGBTTC'<DGBTDPV):DGBTDPV,DGBTDRM'<DGBTDPV&(DGBTTC'>DGBTDPV):DGBTTC,DGBTDRM'>DGBTDPV&(DGBTTC'>DGBTDRM):DGBTTC,DGBTDRM'>DGBTDPV&(DGBTTC'<DGBTDRM):DGBTDRM,1:0)
"RTN","DGBTCE",69,0)
 I $P(MONTOT,"^",5)="YES"&('$G(CHZFLG)) S DGBTDCV=0 ;*30 modified to preserve waiver status of existing claims
"RTN","DGBTCE",70,0)
DED1 ;
"RTN","DGBTCE",71,0)
 S DR="I $P(^DGBT(392,DGBTDT,0),""^"",9)]"""" S Y=""@9"";9///"_DGBTDCV_";@9;9;S DGBTDE=X S:DGBTDE>DGBTTC DGBTDE=DGBTTC,DGBTFLAG=2 S:DGBTDE>DGBTDRM DGBTDE=DGBTDRM,DGBTFLAG=1"
"RTN","DGBTCE",72,0)
DIE4 ;
"RTN","DGBTCE",73,0)
 I $G(^DGBT(392,DGBTDT,0))'="" D
"RTN","DGBTCE",74,0)
 .I $P(^DGBT(392,DGBTDT,0),U,9)="" S $P(^DGBT(392,DGBTDT,0),U,9)=+$G(DGBTDCV)
"RTN","DGBTCE",75,0)
 S DIE="^DGBT(392,",DA=DGBTDT D ^DIE K DIE,DQ,DR I $D(DTOUT)!($D(Y)) S DGBTTOUT=1 Q
"RTN","DGBTCE",76,0)
 I ($G(MONTOT)'="")&($G(ODED)'=DGBTDE) D
"RTN","DGBTCE",77,0)
 .S $P(MONTOT,U,4)=$P(MONTOT,U,4)+DGBTDE
"RTN","DGBTCE",78,0)
 .S $P(MONTOT,U,4)=$P(MONTOT,U,4)-ODED
"RTN","DGBTCE",79,0)
CONT ;
"RTN","DGBTCE",80,0)
 D CONT^DGBTCE1
"RTN","DGBTCE",81,0)
 Q
"RTN","DGBTCE",82,0)
FILE ;      Reset values if account changes
"RTN","DGBTCE",83,0)
 S DGBTVAR(0)=$P(DGBTVAR(0),"^",1,6)_"^^0^^"_$S($L(DGBTVAR(0),"^")>10:$P(DGBTVAR(0),"^",10,$L(DGBTVAR(0),"^")),1:""),DGBTVAR("A")="^"_$P(DGBTVAR("A"),"^",2)_"^^^"_$S($L(DGBTVAR("A"),"^")>4:$P(DGBTVAR("A"),"^",5,$L(DGBTVAR("A"),"^")),1:"")
"RTN","DGBTCE",84,0)
 I DGBTACCT<4 S DGBTVAR("M")="^^^"_$S($L(DGBTVAR("M"),"^")>3:$P(DGBTVAR("M"),"^",4,$L(DGBTVAR("M"),"^")),1:"")
"RTN","DGBTCE",85,0)
 S ^DGBT(392,DGBTDT,0)=DGBTVAR(0),^("A")=DGBTVAR("A") S:DGBTACCT<4 ^("M")=DGBTVAR("M") S DA=DGBTDT,DIK="^DGBT(392," D IX^DIK
"RTN","DGBTCE",86,0)
 Q
"RTN","DGBTE1")
0^2^B35642185^B35422593
"RTN","DGBTE1",1,0)
DGBTE1 ;ALB/SCK/GAH,LAB - BENEFICIARY TRAVEL FIND OLD CLAIM DATES ;03/20/2019
"RTN","DGBTE1",2,0)
 ;;1.0;Beneficiary Travel;**8,12,13,20,21,22,25,28,33,34,37**;September 25, 2001;Build 1
"RTN","DGBTE1",3,0)
DATE ;  get date for claim, either new or past date
"RTN","DGBTE1",4,0)
 N DGBTDCLM
"RTN","DGBTE1",5,0)
 K ^TMP("DGBT",$J),^TMP("DGBTARA",$J),DIR
"RTN","DGBTE1",6,0)
 I 'DGBTNEW S DIR("A",2)="Enter a 'P' to display Past CLAIM dates for editing."
"RTN","DGBTE1",7,0)
 S DIR("A",3)="Time is required when adding a new CLAIM.",DIR("A",4)="",DIR("A",1)="",DIR("A")="Select TRAVEL CLAIM DATE/TIME",DIR("?")="^D HELP^DGBTE1A"
"RTN","DGBTE1",8,0)
 S DIR(0)="F",DIR("B")="NOW" D ^DIR K DIR G ERR1:$D(DIRUT)
"RTN","DGBTE1",9,0)
 S CHZFLG=0,%DT="EXR",DTSUB=$S(Y="N":"NOW",Y="P":"OLD",Y="p":"OLD",1:"OTHR")_"^DGBTE1A" D @DTSUB   ;PAVEL - DGBT*1*20
"RTN","DGBTE1",10,0)
 S:$P(DTSUB,U,1)="OLD"&(Y1>0) DGBTOLD=1 K DTSUB        ;PAVEL DGBT*1*20
"RTN","DGBTE1",11,0)
 G ERR1:$D(DTOUT),DATE:Y1<0 S DGBTA=Y1 G SET:CHZFLG    ;PAVEL DGBT*1*20
"RTN","DGBTE1",12,0)
DATE1 ;  for past claims, set DGBTDT to inverse date of claim date
"RTN","DGBTE1",13,0)
 I $D(^DGBT(392,"C",DFN)) D
"RTN","DGBTE1",14,0)
 . S DGBTC=0,DGBTDT=9999999-$E(DGBTA,1,7) ; set past claims counter=0
"RTN","DGBTE1",15,0)
 . ; for latest date (topmost) search for past claims
"RTN","DGBTE1",16,0)
 . F I=DGBTDT:0 S I=$O(^DGBT(392,"AI",DFN,I)) Q:'I!(I>(DGBTDT_.99999))  S DGBTC=DGBTC+1,DGBT(DGBTC)=9999999.99999-I
"RTN","DGBTE1",17,0)
 I '$D(DGBT) G LOCK
"RTN","DGBTE1",18,0)
 W !!,"There are other claims on this date.",!,"Select by number to edit or <RETURN> to add a new CLAIM.",!
"RTN","DGBTE1",19,0)
 ; convert inverse claim date to external format through VADATE conversion routine
"RTN","DGBTE1",20,0)
 F I=0:0 S I=$O(DGBT(I)) Q:'I  D
"RTN","DGBTE1",21,0)
 .S DGBTDCLM=$$GET1^DIQ(392,DGBT(I),45,"I")
"RTN","DGBTE1",22,0)
 .S VADAT("W")=DGBT(I) D ^VADATE W !?5,I,".",?10,VADATE("E")_$S($G(DGBTDCLM)'="":" (D)",1:"")
"RTN","DGBTE1",23,0)
 K DIR S DIR("A")="Select 1"_$S(DGBTC=1:"",1:"-"_DGBTC)_", or <RETURN> to add a new claim: ",DIR(0)="NOA^1:"_DGBTC,DIR("?")="Select, by number, one of the displayed claim dates: "
"RTN","DGBTE1",24,0)
 D ^DIR K DIR S:$G(Y) CHZFLG=1 G QUIT^DGBTEND:$D(DTOUT)!($D(DUOUT))
"RTN","DGBTE1",25,0)
 G LOCK:Y="" G DATE:'$D(DGBT(Y))
"RTN","DGBTE1",26,0)
 S DGBTA=DGBT(Y),DGBTOLD=1 G SET
"RTN","DGBTE1",27,0)
LOCK ;
"RTN","DGBTE1",28,0)
 ;L +^DGBT(392,DGBTA):$G(DILOCKTM,3)
"RTN","DGBTE1",29,0)
 ;I '$T!$D(^DGBT(392,DGBTA)) L -^DGBT(392,DGBTA) S DGBTA=$$FMADD^XLFDT(DGBTA,,,,1) G LOCK ;dbe patch DGBT*1*21
"RTN","DGBTE1",30,0)
 ;dgbt*1.0*33 - more efficient lookup
"RTN","DGBTE1",31,0)
 F  Q:'$D(^DGBT(392,DGBTA))  S DGBTA=$$FMADD^XLFDT(DGBTA,,,,1)
"RTN","DGBTE1",32,0)
 L +^DGBT(392,DGBTA):$G(DILOCKTM,3) E  S DGBTA=$$FMADD^XLFDT(DGBTA,,,,1) G LOCK ;dgbt*1.0*34 - added to increment if lock exists for record # that has not been created yet
"RTN","DGBTE1",33,0)
 S (DGBTDT,VADAT("W"))=DGBTA D ^VADATE W VADATE("E")      ;for CCR235 by RE
"RTN","DGBTE1",34,0)
ASKADD ;
"RTN","DGBTE1",35,0)
 W !!,"Are you sure you want to add a new claim"
"RTN","DGBTE1",36,0)
 S %=1 D YN^DICN I (%<0)!(%=2) L -^DGBT(392,DGBTA) G EXIT2^DGBTE ;dgbt*1.0*34 - unlock record immediately if user chooses no or exits
"RTN","DGBTE1",37,0)
 I '% W !!,"Enter 'YES' to add a new claim, or 'NO' not to add the claim." G ASKADD
"RTN","DGBTE1",38,0)
 K DD,DO
"RTN","DGBTE1",39,0)
 ; create new file entry, stuff patient DFN into name field(pointer)
"RTN","DGBTE1",40,0)
 ;DGBT*1.0*37 replace 4 slashes with ///, 2///' - ' allows for internal value to be validated and pushed in.
"RTN","DGBTE1",41,0)
 S (X,DINUM)=DGBTA,DIC="^DGBT(392,",DIC(0)="L",DIC("DR")="2///`"_DFN
"RTN","DGBTE1",42,0)
 D FILE^DICN K DIC L -^DGBT(392,DGBTA)
"RTN","DGBTE1",43,0)
 ; go back to patient if no file entry
"RTN","DGBTE1",44,0)
 G:Y'>0 PATIENT^DGBTE
"RTN","DGBTE1",45,0)
SET ; call inhouse generic date routine
"RTN","DGBTE1",46,0)
 S (DA,DGBTDT,VADAT("W"))=DGBTA D ^VADATE
"RTN","DGBTE1",47,0)
 ; get internal and external formats of converted inverse dates
"RTN","DGBTE1",48,0)
 S DGBTDTI=$S($G(VADAT("W"))'="":VADAT("W"),1:VADATE("I")),DGBTDTE=VADATE("E") K VADAT,VADATE,DIC,Y
"RTN","DGBTE1",49,0)
 I $G(DGBTDIVI)'="" S DGBTDIVN=$P(^DG(40.8,DGBTDIVI,0),"^",7)
"RTN","DGBTE1",50,0)
 D GA^DGBTUTL(DFN,"DGBTINCA",DGBTDTI) ;Get Alternate Income PAVEL
"RTN","DGBTE1",51,0)
STUFF ;  stuff departure with address data from patient file, dest from institution file
"RTN","DGBTE1",52,0)
 S DGBTCMTY=$$GET1^DIQ(392,DGBTDT,56)
"RTN","DGBTE1",53,0)
 S:'$L(DGBTCMTY) DGBTCMTY="M"
"RTN","DGBTE1",54,0)
 ;dbe patch DGBT*1*25 - removed restrictions below to allow departure and destination fields to get filed for existing claims
"RTN","DGBTE1",55,0)
 S:'$D(^DGBT(392,DGBTDT,"D")) ^DGBT(392,DGBTDT,"D")=VAPA(1)_"^"_VAPA(2)_"^"_VAPA(3)_"^"_VAPA(4)_"^"_$S(VAPA(5)]"":+VAPA(5),1:"")_"^"_$P(VAPA(11),U,1)
"RTN","DGBTE1",56,0)
 I '$D(^DGBT(392,DGBTDT,"T")) D
"RTN","DGBTE1",57,0)
 . S X=$S($D(^DIC(4,DGBTDIVN,1)):^(1),1:"")
"RTN","DGBTE1",58,0)
 . S ^DGBT(392,DGBTDT,"T")=($P(^DG(40.8,DGBTDIVI,0),U)_"^"_$P(X,U)_"^"_$P(X,U,2)_"^"_$P(X,U,3)_"^"_$P(^DIC(4,DGBTDIVN,0),U,2)_"^"_$TR($P(X,U,4),"-","")) ;*28 remove hyphen from zip code
"RTN","DGBTE1",59,0)
 Q:$G(DGBTSP2M)  ;dbe patch DGBT*1*25 - added quit when called from routine dgbtee
"RTN","DGBTE1",60,0)
CHKFILES ; section removed, dependents picked up below in MEANS ; abr 10/94
"RTN","DGBTE1",61,0)
MEANS ;  find corres. means test entry, gets MT income, status, no. of dependents
"RTN","DGBTE1",62,0)
 ;DGBTMTS= MT Status;  DGBTCSC= claim Service Connected indicator & %;  DGBTELG=Eligibility status
"RTN","DGBTE1",63,0)
 N X,X2,X3,Y,DGBTIFL
"RTN","DGBTE1",64,0)
 S X=$$LST^DGMTCOU1(DFN,DT,3),DGBTMTS=$P(X,U,4)_U_$P(X,U,3) ; returns corres. MT info,X=IEN of last MT. passing a 3 will check both MT and RX Co-Pays
"RTN","DGBTE1",65,0)
 ; get income, # dependents
"RTN","DGBTE1",66,0)
 S Y=$$INCOME^VAFMON(DFN,DGBTA,1)
"RTN","DGBTE1",67,0)
 S:"I^V"[$P(Y,U,2) Y=U ;If income type is I or V ignore it PAVEL
"RTN","DGBTE1",68,0)
 S:DGBTINCA Y=$P(DGBTINCA,U,2)_U_$E($P(DGBTINCA,U,4)) ;Set Alternate Income
"RTN","DGBTE1",69,0)
 S X=$P(Y,U),DGBTIFL=$P(Y,U,2) ; returns income & source.
"RTN","DGBTE1",70,0)
 I X?1N.E!(X<0) D
"RTN","DGBTE1",71,0)
 .I X<0 S X=0
"RTN","DGBTE1",72,0)
 .S X2="0$",X3=8 D COMMA^%DTC
"RTN","DGBTE1",73,0)
 S DGBTINC=X_U_$G(DGBTIFL) K X,X2
"RTN","DGBTE1",74,0)
 S DGBTDEP=$$DEP^VAFMON(DFN,DGBTA) ; finds dependents Vet, Spouse, Children
"RTN","DGBTE1",75,0)
 S DGBTDTY=" (Year: "_$$FMTE^XLFDT($E(DGBTDTI,1,3)_"0000")_")" ;Year to be displayed with Income
"RTN","DGBTE1",76,0)
 S DGBTMTTH=$$MTTH^DGBTMTTH(DGBTDEP,DGBTDTI) ; Means test threshold
"RTN","DGBTE1",77,0)
 S DGBTRXTH=+$$THRES^IBARXEU1(DGBTDTI,1,DGBTDEP) ; RX co-pay threshold
"RTN","DGBTE1",78,0)
 S DGBTDYFL=$$DAYFLAG^DGBTUTL ; valid income test y/n
"RTN","DGBTE1",79,0)
 ;
"RTN","DGBTE1",80,0)
PREV ; if past claim get SC%, elig.
"RTN","DGBTE1",81,0)
 I CHZFLG S X=^DGBT(392,DGBTA,0),DGBTELG=$P(X,U,3),DGBTCSC=$P(X,U,4) D
"RTN","DGBTE1",82,0)
 . S:$P(X,U,11) DGBTDIVI=+$P(X,U,11),DGBTDIVN=$P($G(^DG(40.8,DGBTDIVI,0)),U,7) ;dbe patch DGBT*1*22 - save division of existing claims
"RTN","DGBTE1",83,0)
 . S:DGBTCSC DGBTCSC=1_U_DGBTCSC S:'DGBTCSC DGBTCSC=0
"RTN","DGBTE1",84,0)
 . S:DGBTELG DGBTELG=DGBTELG_U_$P(^DIC(8,DGBTELG,0),U)
"RTN","DGBTE1",85,0)
CERT ;  get last BT certification,  get date, then get eligibility
"RTN","DGBTE1",86,0)
 I $D(^DGBT(392.2,"C",DFN)) D
"RTN","DGBTE1",87,0)
 .;cd=cert date in inverse then external format, ce= eligibility, ca* = amt certified
"RTN","DGBTE1",88,0)
 . S DGBTCD=$O(^DGBT(392.2,"C",DFN,0)),DGBTCE=$P(^DGBT(392.2,DGBTCD,0),"^",3)
"RTN","DGBTE1",89,0)
 . S DGBTCA=$P(^DGBT(392.2,DGBTCD,0),"^",4),Y=9999999-$P(DGBTCD,".")
"RTN","DGBTE1",90,0)
 . X ^DD("DD") ; date conversion, y=cert date (internal)
"RTN","DGBTE1",91,0)
 . S DGBTCD=Y,X=DGBTCA,X2="0$",X3=8 K Y D COMMA^%DTC S DGBTCA=X K X,X2,X3
"RTN","DGBTE1",92,0)
APPTS ;  search patient file for appointments through claim date (DTI+1),  add dates to array DGBTCL 
"RTN","DGBTE1",93,0)
 N ERRCODE,DGARRAY,CLIEN,APTDT S DGARRAY("FLDS")="2;3;10;18"
"RTN","DGBTE1",94,0)
 S DGARRAY(4)=DFN,I=$$SDAPI^SDAMA301(.DGARRAY)
"RTN","DGBTE1",95,0)
 ; I<0 = Error, I<0 = # of Records retrieved
"RTN","DGBTE1",96,0)
 I I<0 S ERRCODE=$O(^TMP($J,"SDAMA301","")),I1=1,DGBTCL("ERROR")=^TMP($J,"SDAMA301",ERRCODE)
"RTN","DGBTE1",97,0)
 I I>0 D
"RTN","DGBTE1",98,0)
 .S CLIEN=""
"RTN","DGBTE1",99,0)
 .F  S CLIEN=$O(^TMP($J,"SDAMA301",DFN,CLIEN)) Q:'CLIEN  D
"RTN","DGBTE1",100,0)
 ..S APTDT=DGBTDTI\1
"RTN","DGBTE1",101,0)
 ..F  S APTDT=$O(^TMP($J,"SDAMA301",DFN,CLIEN,APTDT)) Q:'APTDT!(APTDT>(DGBTDTI+1))  D
"RTN","DGBTE1",102,0)
 ...S SDATA=^TMP($J,"SDAMA301",DFN,CLIEN,APTDT)
"RTN","DGBTE1",103,0)
 ...S DGBTCL(APTDT)=$P($P(^TMP($J,"SDAMA301",DFN,CLIEN,APTDT),U,2),";",2)_U_$P($P(SDATA,U,3),";")
"RTN","DGBTE1",104,0)
 ...S DGBTCL(APTDT)=DGBTCL(APTDT)_U_$P($P(SDATA,U,18),";")_U_$P($P(SDATA,U,10),";")
"RTN","DGBTE1",105,0)
 K ^TMP($J,"SDAMA301"),DGARRAY,CLIEN,APTDT
"RTN","DGBTE1",106,0)
EXIT ; exit routine
"RTN","DGBTE1",107,0)
 Q
"RTN","DGBTE1",108,0)
ERR1 ;  error condition
"RTN","DGBTE1",109,0)
 G QUIT^DGBTEND Q
"RTN","DGBTEF")
0^3^B21619951^B21478010
"RTN","DGBTEF",1,0)
DGBTEF ;ALB/SCK,LAB - BENEFICIARY TRAVEL ENTER/EDIT CERTIFICATION FILE ;03/20/2019
"RTN","DGBTEF",2,0)
 ;;1.0;Beneficiary Travel;**7,21,37**;September 25, 2001;Build 1
"RTN","DGBTEF",3,0)
CERT ;
"RTN","DGBTEF",4,0)
 D QUIT S DIC="^DPT(",DIC(0)="AEQMZ" W !! D ^DIC K DIC G QUIT:Y'>0 S DFN=+Y
"RTN","DGBTEF",5,0)
 G:'$O(^DGBT(392.2,"C",DFN,0)) ADD S DGBT=$O(^(0))
"RTN","DGBTEF",6,0)
 S DGBT=^DGBT(392.2,DGBT,0) W !!,"Last Certification: " S VADAT("W")=+DGBT D ^VADATE W VADATE("E"),?39,"Eligible: ",$S($P(DGBT,U,3):"YES",1:"NO"),?55,"Amount Certified: ",$P(DGBT,U,4)
"RTN","DGBTEF",7,0)
AE ;
"RTN","DGBTEF",8,0)
 S DIR("A")="'A'DD A NEW DATE, 'E'DIT EXISTING OR 'Q'UIT: ",DIR("A",1)="",DIR("B")="ADD",DIR("?")="Q - to 'Q'uit",DIR("?",1)=""
"RTN","DGBTEF",9,0)
 S DIR("?",2)="ENTER    A - to 'A'dd a new certification date",DIR("?",3)="E - to 'E'dit an existing entry for this patient"
"RTN","DGBTEF",10,0)
 S DIR(0)="SAO^A:ADD;E:EDIT;Q:QUIT"
"RTN","DGBTEF",11,0)
 D ^DIR K DIR Q:$D(DUOUT)!($D(DTOUT))!(Y="Q")  G EDIT:Y="E",ADD:Y="A"
"RTN","DGBTEF",12,0)
 Q
"RTN","DGBTEF",13,0)
ADD ;
"RTN","DGBTEF",14,0)
 S DIR(0)="D^:NOW:PXR",DIR("A")="Select CERTIFICATION DATE: ",DIR("A",1)="",DIR("B")="NOW",DIR("?")="^D DHELP^DGBTEF"
"RTN","DGBTEF",15,0)
 D ^DIR K DIR G QUIT:$D(DUOUT) G QUIT1:$D(DTOUT) S DGBTA=9999999.99999-(+Y),DGBTDT=+Y
"RTN","DGBTEF",16,0)
 I $D(^DGBT(392.2,"C",DFN)) F I=0:0 S I=$O(^DGBT(392.2,"C",DFN,I)) Q:'I  I I[$P(DGBTA,".") W !!,"There is already a certification for " S VADAT("W")=DGBTDT D ^VADATE W VADATE("E"),".",!,"Only one certification per date is necessary." G AE
"RTN","DGBTEF",17,0)
LOCK ;
"RTN","DGBTEF",18,0)
 I DGBTA'["." D DHELP G:DGBTA'["." ADD
"RTN","DGBTEF",19,0)
 L +^DGBT(392.2,DGBTA):$G(DILOCKTM,3) I '$T!$D(^DGBT(392.2,DGBTA)) L -^DGBT(392.2,DGBTA) S DGBTA=$$FMADD^XLFDT(DGBTA,,,,1) G LOCK ;dbe patch DGBT*1*21
"RTN","DGBTEF",20,0)
 S VADAT("W")=9999999.99999-DGBTA D ^VADATE W " ",VADATE("E")
"RTN","DGBTEF",21,0)
 ;DGBT*1.0*37 changed logic for 4 slashes to 3 slashes with ', ' allows internal value to be validated and pushed.
"RTN","DGBTEF",22,0)
 K DD,DO S X=DGBTDT,DINUM=DGBTA,DIC="^DGBT(392.2,",DIC(0)="L",DIC("DR")="2///`"_DFN D FILE^DICN K DIC("DR") L -^DGBT(392.2,DGBTA) G:Y'>0 CERT
"RTN","DGBTEF",23,0)
DIE ;
"RTN","DGBTEF",24,0)
 N X3 ;Clean copy used by COMMA^%DTC
"RTN","DGBTEF",25,0)
 S X=$$LST^DGMTU(DFN,"",1) I $G(X),$D(^DGMT(408.31,+X,0)) S X=$P(^(0),"^",4),X2="0$" D COMMA^%DTC S DGBTMTI=X K X,X2 W !!,"REPORTED MEANS TEST INCOME: ",DGBTMTI
"RTN","DGBTEF",26,0)
 ;I $D(^DG(41.3,DFN,0)),$D(^(1,0)),$D(^(2,0)) S DGBTMTD=$P(^DG(41.3,DFN,1,$P(^(1,0),"^",3),0),"^",3),X=$P(^DG(41.3,DFN,2,$P(^(2,0),"^",3),0),"^",4),X2="0$" D COMMA^%DTC S DGBTMTI=X K X,X2 W !!,"REPORTED MEANS TEST INCOME: ",DGBTMTI
"RTN","DGBTEF",27,0)
 D 6^VADPT S DGBTCC=$S($D(^DIC(5,+VAPA(5),1,+VAPA(7),0)):$P(^(0),"^",3),1:""),DGBTEL=$P(VAEL(1),"^",2)
"RTN","DGBTEF",28,0)
 S DA=DGBTA,DIE="^DGBT(392.2,",DIE("NO^")="12345"
"RTN","DGBTEF",29,0)
 S DR=".01;4;3;5////"_DUZ_";6///"_DT_";11///^S X=VAPA(1);12///^S X=VAPA(2);13///^S X=VAPA(3);14///^S X=VAPA(4);15///"_$S(VAPA(5)]"":+VAPA(5),1:"")_";16///^S X=$P(VAPA(11),U,1);17///"_DGBTCC_";18///"_$P(VAEL(9),"^")_";19///"_DGBTEL
"RTN","DGBTEF",30,0)
 D ^DIE G QUIT:$D(DTOUT) G:'$D(DA) CERT
"RTN","DGBTEF",31,0)
 I $D(^DGBT(392.2,DA,0)) S X=$P(^DGBT(392.2,DA,0),U,4),X2="0$" D COMMA^%DTC S DGBTCA=X K X,X2
"RTN","DGBTEF",32,0)
 I $D(^DGBT(392.2,DA,0)),$D(DGBTMTI),DGBTMTI'=DGBTCA W !!?5," * * * * Discrepancy exists in incomes reported, please verify * * * *",! S DGBTINFL=1
"RTN","DGBTEF",33,0)
 G CERT
"RTN","DGBTEF",34,0)
EDIT ;
"RTN","DGBTEF",35,0)
 S X="",(DGBTC,DGBTCH,DGFL)=0 F I=0:0 S I=$O(^DGBT(392.2,"C",DFN,I)) Q:'I  S DGBTC=DGBTC+1,^UTILITY($J,"DGBT",DGBTC,I)=""
"RTN","DGBTEF",36,0)
 I '$D(^UTILITY($J,"DGBT"))!'$D(^DGBT(392.2,"C",DFN)) W !,"There are no computer entries on file for this patient." G CERT
"RTN","DGBTEF",37,0)
 F I=0:0 S I=$O(^UTILITY($J,"DGBT",I)) Q:'I!(DGBTCH)!(X["^")!(DGFL)  D
"RTN","DGBTEF",38,0)
 . F J=0:0 S J=$O(^UTILITY($J,"DGBT",I,J)) Q:'J  S K=I,Y=9999999.99999-J X ^DD("DD") W !?5,I,". ",?10,$P(Y,"@") I K#5=0 D CHOZ Q:DGBTCH!(DGFL)
"RTN","DGBTEF",39,0)
 G:DGFL=1 QUIT D:K#5'=0 CHOZ I DGBTCH S DGBTA=$O(^UTILITY($J,"DGBT",X,0)) G DIE
"RTN","DGBTEF",40,0)
 G:'$T QUIT G AE
"RTN","DGBTEF",41,0)
CHOZ ;
"RTN","DGBTEF",42,0)
 S DIR("A")="Choose",DIR(0)="NO^1:"_K D ^DIR K DIR Q:$D(DIRUT)
"RTN","DGBTEF",43,0)
 I Y,$D(^UTILITY($J,"DGBT",Y)) S DGBTCH=1,VADAT("W")=9999999.99999-$O(^(Y,0)) D ^VADATE W " ",VADATE("E") Q
"RTN","DGBTEF",44,0)
 Q
"RTN","DGBTEF",45,0)
DHELP ;
"RTN","DGBTEF",46,0)
 W !!,"Enter the date of annual certification.",!,"Time is required when adding a new certification date.",!,"Future dates are not allowed.",! S X="?",%DT="ER" D ^%DT Q
"RTN","DGBTEF",47,0)
QUIT1 ;
"RTN","DGBTEF",48,0)
 I $D(DA) S DIK="^DGBT(392.2," D ^DIK K DIK
"RTN","DGBTEF",49,0)
QUIT ;
"RTN","DGBTEF",50,0)
 K ^UTILITY($J,"DGBT"),%DT,D,DA,DD,DFN,DGBT,DGBTA,DGBTC,DGBTCA,DGBTCC,DGBTCH,DGBTDT,DGBTEL,DGBTINFL,DGBTMTD,DGBTMTI,DGFL,DIC,DIE,DINUM,DO,DR,I,J,K,VA,VADAT,VADATE,VADM,VAEL,VAERR,VAPA,VAROOT,X,Y,Z Q
"VER")
8.0^22.2
"BLD",11451,6)
^38
**END**
**END**

