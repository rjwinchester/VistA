Released DGBT*1*38 SEQ #36
Extracted from mail message
**KIDS**:DGBT*1.0*38^

**INSTALL NAME**
DGBT*1.0*38
"BLD",11456,0)
DGBT*1.0*38^BENEFICIARY TRAVEL^0^3190411^y
"BLD",11456,1,0)
^^2^2^3190408^
"BLD",11456,1,1,0)
  1. Beneficiary Travel (BT) Error <UNDEFINED>MANRQ+11^DGBTRDVW *DGBTA is 
"BLD",11456,1,2,0)
     occurring at many R4 sites.
"BLD",11456,4,0)
^9.64PA^^
"BLD",11456,6.3)
2
"BLD",11456,"KRN",0)
^9.67PA^1.5^24
"BLD",11456,"KRN",.4,0)
.4
"BLD",11456,"KRN",.401,0)
.401
"BLD",11456,"KRN",.402,0)
.402
"BLD",11456,"KRN",.403,0)
.403
"BLD",11456,"KRN",.5,0)
.5
"BLD",11456,"KRN",.84,0)
.84
"BLD",11456,"KRN",1.5,0)
1.5
"BLD",11456,"KRN",1.6,0)
1.6
"BLD",11456,"KRN",1.61,0)
1.61
"BLD",11456,"KRN",1.62,0)
1.62
"BLD",11456,"KRN",3.6,0)
3.6
"BLD",11456,"KRN",3.8,0)
3.8
"BLD",11456,"KRN",9.2,0)
9.2
"BLD",11456,"KRN",9.8,0)
9.8
"BLD",11456,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",11456,"KRN",9.8,"NM",1,0)
DGBTRDVW^^0^B10917686
"BLD",11456,"KRN",9.8,"NM","B","DGBTRDVW",1)

"BLD",11456,"KRN",19,0)
19
"BLD",11456,"KRN",19.1,0)
19.1
"BLD",11456,"KRN",101,0)
101
"BLD",11456,"KRN",409.61,0)
409.61
"BLD",11456,"KRN",771,0)
771
"BLD",11456,"KRN",779.2,0)
779.2
"BLD",11456,"KRN",870,0)
870
"BLD",11456,"KRN",8989.51,0)
8989.51
"BLD",11456,"KRN",8989.52,0)
8989.52
"BLD",11456,"KRN",8994,0)
8994
"BLD",11456,"KRN","B",.4,.4)

"BLD",11456,"KRN","B",.401,.401)

"BLD",11456,"KRN","B",.402,.402)

"BLD",11456,"KRN","B",.403,.403)

"BLD",11456,"KRN","B",.5,.5)

"BLD",11456,"KRN","B",.84,.84)

"BLD",11456,"KRN","B",1.5,1.5)

"BLD",11456,"KRN","B",1.6,1.6)

"BLD",11456,"KRN","B",1.61,1.61)

"BLD",11456,"KRN","B",1.62,1.62)

"BLD",11456,"KRN","B",3.6,3.6)

"BLD",11456,"KRN","B",3.8,3.8)

"BLD",11456,"KRN","B",9.2,9.2)

"BLD",11456,"KRN","B",9.8,9.8)

"BLD",11456,"KRN","B",19,19)

"BLD",11456,"KRN","B",19.1,19.1)

"BLD",11456,"KRN","B",101,101)

"BLD",11456,"KRN","B",409.61,409.61)

"BLD",11456,"KRN","B",771,771)

"BLD",11456,"KRN","B",779.2,779.2)

"BLD",11456,"KRN","B",870,870)

"BLD",11456,"KRN","B",8989.51,8989.51)

"BLD",11456,"KRN","B",8989.52,8989.52)

"BLD",11456,"KRN","B",8994,8994)

"BLD",11456,"QDEF")
^^^^^^^^^^YES
"BLD",11456,"QUES",0)
^9.62^^
"BLD",11456,"REQB",0)
^9.611^1^1
"BLD",11456,"REQB",1,0)
DGBT*1.0*30^2
"BLD",11456,"REQB","B","DGBT*1.0*30",1)

"MBREQ")
0
"PKG",154,-1)
1^1
"PKG",154,0)
BENEFICIARY TRAVEL^DGBT^Beneficiary Travel
"PKG",154,22,0)
^9.49I^1^1
"PKG",154,22,1,0)
1.0^3030731^3020423^66481
"PKG",154,22,1,"PAH",1,0)
38^3190411
"PKG",154,22,1,"PAH",1,1,0)
^^2^2^3190411
"PKG",154,22,1,"PAH",1,1,1,0)
  1. Beneficiary Travel (BT) Error <UNDEFINED>MANRQ+11^DGBTRDVW *DGBTA is 
"PKG",154,22,1,"PAH",1,1,2,0)
     occurring at many R4 sites.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","DGBTRDVW")
0^1^B10917686^B9874213
"RTN","DGBTRDVW",1,0)
DGBTRDVW ;ALB/RFE - BENEFICIARY/TRAVEL UTILITY ROUTINES ;07/03/12
"RTN","DGBTRDVW",2,0)
 ;;1.0;Beneficiary Travel;**20,25,30,38**;September 25, 2001;Build 2
"RTN","DGBTRDVW",3,0)
 Q
"RTN","DGBTRDVW",4,0)
WAIV(DFN,DGBTDTI) ;
"RTN","DGBTRDVW",5,0)
 N %H,DED,I,TRIP,TRIPCT,RETURN,DGBTDW,EXPDT,FUTURE,FDED,WAIVER
"RTN","DGBTRDVW",6,0)
 ;Return values: total number of trips ^ number of one way trips ^ number of round trips ^ deductible (all this for the month)^ waiver y/n (y will be 1, n will be no) ^ type of waiver i.e. MAN for manual, PENSION etc. ^
"RTN","DGBTRDVW",7,0)
 ;total number of trips as of this claim date ^ deductible as of this claim date
"RTN","DGBTRDVW",8,0)
 S TRIP=$$TRIP
"RTN","DGBTRDVW",9,0)
 S WAIVER=$$WAIVYN
"RTN","DGBTRDVW",10,0)
 S RETURN=TRIP_WAIVER_U_(TRIPCT-FUTURE)_U_(DED-FDED)
"RTN","DGBTRDVW",11,0)
 Q RETURN
"RTN","DGBTRDVW",12,0)
 ;
"RTN","DGBTRDVW",13,0)
TRIP() ;
"RTN","DGBTRDVW",14,0)
 N DTRAY,I,TRIPS,TRIPTYP,MONTH,DGBTDT,ACCTYPE,DGBTEND
"RTN","DGBTRDVW",15,0)
 S (DED,TRIPCT,FUTURE,FDED)=0
"RTN","DGBTRDVW",16,0)
 F I=0:1:2 S TRIPS(I)=0
"RTN","DGBTRDVW",17,0)
 S DGBTEND=$E(DGBTDTI,1,5)+1_"00"
"RTN","DGBTRDVW",18,0)
 S (MONTH,DGBTDT)=$E(DGBTDTI,1,5)_"00"
"RTN","DGBTRDVW",19,0)
 ;F  S DGBTDT=$O(^DGBT(392,"C",DFN,DGBTDT)) Q:DGBTDT=""!(DGBTDT>DGBTDTI)  D
"RTN","DGBTRDVW",20,0)
 F  S DGBTDT=$O(^DGBT(392,"C",DFN,DGBTDT)) Q:DGBTDT=""!(DGBTDT'<DGBTEND)  D
"RTN","DGBTRDVW",21,0)
 .I (DGBTDT=DGBTDTI)&($G(CHZFLG)=0) Q
"RTN","DGBTRDVW",22,0)
 .Q:$$GET1^DIQ(392,DGBTDT,56,"I")="S"
"RTN","DGBTRDVW",23,0)
 .I $$GET1^DIQ(392,DGBTDT,45.2,"I")=1 Q
"RTN","DGBTRDVW",24,0)
 .I $D(DTRAY(DGBTDT)) Q  ;dbe patch DGBT*1*25
"RTN","DGBTRDVW",25,0)
 .S ACCTYPE=$$GET1^DIQ(392.3,$$GET1^DIQ(392,DGBTDT,6,"I"),5,"I")
"RTN","DGBTRDVW",26,0)
 .I ACCTYPE="" Q
"RTN","DGBTRDVW",27,0)
 .I 45'[ACCTYPE Q
"RTN","DGBTRDVW",28,0)
 .S DTRAY(DGBTDT)="" ;dbe patch DGBT*1*25
"RTN","DGBTRDVW",29,0)
 .S DED=DED+$$GET1^DIQ(392,DGBTDT,9)
"RTN","DGBTRDVW",30,0)
 .S TRIPTYP=+$$GET1^DIQ(392,DGBTDT,31,"I")
"RTN","DGBTRDVW",31,0)
 .S TRIPS(TRIPTYP)=TRIPS(TRIPTYP)+1
"RTN","DGBTRDVW",32,0)
 .S TRIPCT=TRIPCT+TRIPTYP
"RTN","DGBTRDVW",33,0)
 .I ($G(CHZFLG))&(DGBTDT=DGBTDTI) S FUTURE=FUTURE+TRIPTYP,FDED=FDED+$$GET1^DIQ(392,DGBTDT,9,"I") ;*30 modified check to use date/time
"RTN","DGBTRDVW",34,0)
 Q TRIPCT_U_TRIPS(1)_U_TRIPS(2)_U_DED_U
"RTN","DGBTRDVW",35,0)
WAIVYN() ;
"RTN","DGBTRDVW",36,0)
 I DED'<18 Q "1^DED^"
"RTN","DGBTRDVW",37,0)
 I TRIPCT>6 Q "1^TRIPS^"
"RTN","DGBTRDVW",38,0)
 I '$D(DGBTINCA) N DGBTINCA,DGBTERR D GA^DGBTUTL(DFN,"DGBTINCA",DGBTDTI)
"RTN","DGBTRDVW",39,0)
 I DGBTINCA Q "1^ALTINC^"
"RTN","DGBTRDVW",40,0)
 I $$MANRQ Q "1^MAN^"_EXPDT
"RTN","DGBTRDVW",41,0)
 I '$D(VAEL) N VAEL,VAERR D ELIG^VADPT
"RTN","DGBTRDVW",42,0)
 I $$PENSION Q "1^PENSION^"
"RTN","DGBTRDVW",43,0)
 ;I '$D(DGBTDEP) N DGBTDEP S DGBTDEP=$$DEP^VAFMON(DFN,DGBTDTI)
"RTN","DGBTRDVW",44,0)
 ;I '$D(DGBTNSC) N DGBTNSC S DGBTNSC=$$NSC^DGBTUTL
"RTN","DGBTRDVW",45,0)
 ;I '$D(DGBTINC) N DGBTINC S DGBTINC=$$INCOME^VAFMON(DFN,DGBTDTI,1)
"RTN","DGBTRDVW",46,0)
 ;I '$D(DGBTMTTH) N DGBTMTTH S DGBTMTTH=$$MTTH^DGBTMTTH(DGBTDEP,DGBTDTI)
"RTN","DGBTRDVW",47,0)
 ;I (DGBTNSC)&(+$TR($P(DGBTINC,U),"$,","")<DGBTRXTH) Q "1^NSC^"
"RTN","DGBTRDVW",48,0)
 ;I '(DGBTNSC)&(+$G(VAEL(3)))&(+$TR($P(DGBTINC,U),"$,","")<DGBTMTTH) Q "1^LI^"
"RTN","DGBTRDVW",49,0)
 ;I '(DGBTNSC),+$$LI^DGBTUTL(DFN,DGBTDTI,DGBTDEP,,DGBTINCA)'=0 Q "1^LI^"
"RTN","DGBTRDVW",50,0)
 Q 0_"^^"
"RTN","DGBTRDVW",51,0)
MANRQ() ; Manual waiver request
"RTN","DGBTRDVW",52,0)
 I '$D(^DGBT(392.7,"C",DFN)) Q 0_"^"
"RTN","DGBTRDVW",53,0)
 N STDT
"RTN","DGBTRDVW",54,0)
 S (DGBTDW,I)=""
"RTN","DGBTRDVW",55,0)
 F  S I=$O(^DGBT(392.7,"C",DFN,I),-1) Q:I=""  D  Q:DGBTDW'=""
"RTN","DGBTRDVW",56,0)
 .I $$GET1^DIQ(392.7,I,97,"I") Q
"RTN","DGBTRDVW",57,0)
 .S STDT=$$GET1^DIQ(392.7,I,.01,"I")
"RTN","DGBTRDVW",58,0)
 .I STDT>DGBTDTI S DGBTDW=0 Q
"RTN","DGBTRDVW",59,0)
 .S EXPDT=$$GET1^DIQ(392.7,I,8,"I")
"RTN","DGBTRDVW",60,0)
 .I EXPDT="PENSION" S DGBTDW=1 Q
"RTN","DGBTRDVW",61,0)
 .I $E(I,1,3)=$E(DGBTDTI,1,3) S DGBTDW=^DGBT(392.7,I,0) Q
"RTN","DGBTRDVW",62,0)
 .I $E(I,1,3)'=($E(DGBTDTI,1,3)-1) Q  ;*38 - changed variable to DGBTDTI to prevent undefined error when called via rpc
"RTN","DGBTRDVW",63,0)
 .I $$GET1^DIQ(392.7,I,8,"I")<$P(DGBTDTI,".") Q
"RTN","DGBTRDVW",64,0)
 .S DGBTDW=^DGBT(392.7,I,0)
"RTN","DGBTRDVW",65,0)
 I DGBTDW="" Q 0
"RTN","DGBTRDVW",66,0)
 I $$GET1^DIQ(392.7,I,3)="NO" Q 0
"RTN","DGBTRDVW",67,0)
 I $G(EXPDT)="PENSION" Q 1
"RTN","DGBTRDVW",68,0)
 I $P(DGBTDTI,".")<$P($P(DGBTDW,U),".") Q 0
"RTN","DGBTRDVW",69,0)
 I $G(EXPDT)?7N S EXPDT=$$DTFORM^DGBT1(EXPDT)
"RTN","DGBTRDVW",70,0)
 Q DGBTDW
"RTN","DGBTRDVW",71,0)
PENSION() ;
"RTN","DGBTRDVW",72,0)
 I '$D(VAEL) N VAEL,VAERR D ELIG^VADPT
"RTN","DGBTRDVW",73,0)
 I VAEL(1)["PENSION" Q 1
"RTN","DGBTRDVW",74,0)
 I $P(VAEL(1),"^",2)="AID & ATTENDANCE" Q 1
"RTN","DGBTRDVW",75,0)
 I $P(VAEL(1),"^",2)="HOUSEBOUND" Q 1
"RTN","DGBTRDVW",76,0)
 N HIT
"RTN","DGBTRDVW",77,0)
 S (HIT,I)=""
"RTN","DGBTRDVW",78,0)
 F  S I=$O(VAEL(1,I)) Q:I=""  D  Q:HIT
"RTN","DGBTRDVW",79,0)
 .I VAEL(1,I)["PENSION" S HIT=1 Q
"RTN","DGBTRDVW",80,0)
 .I $P(VAEL(3),U,2)'=100 D  ;*30 added to prevent waiver for 100% SC
"RTN","DGBTRDVW",81,0)
 ..I $P(VAEL(1,I),"^",2)="AID & ATTENDANCE" S HIT=1 Q
"RTN","DGBTRDVW",82,0)
 ..I $P(VAEL(1,I),"^",2)="HOUSEBOUND" S HIT=1 Q
"RTN","DGBTRDVW",83,0)
 Q HIT
"VER")
8.0^22.2
"BLD",11456,6)
^36
**END**
**END**

