Released DGBT*1*30 SEQ #31
Extracted from mail message
**KIDS**:DGBT*1.0*30^

**INSTALL NAME**
DGBT*1.0*30
"BLD",10099,0)
DGBT*1.0*30^BENEFICIARY TRAVEL^0^3160311^y
"BLD",10099,1,0)
^^5^5^3160304^^
"BLD",10099,1,1,0)
This patch addresses 2 issues:
"BLD",10099,1,2,0)
  
"BLD",10099,1,3,0)
    1. Bene Travel is incorrectly granting deductible waivers.
"BLD",10099,1,4,0)
  
"BLD",10099,1,5,0)
    2. Claim deductibles are being modified after payment.
"BLD",10099,4,0)
^9.64PA^^
"BLD",10099,6.3)
4
"BLD",10099,"KRN",0)
^9.67PA^779.2^20
"BLD",10099,"KRN",.4,0)
.4
"BLD",10099,"KRN",.401,0)
.401
"BLD",10099,"KRN",.402,0)
.402
"BLD",10099,"KRN",.403,0)
.403
"BLD",10099,"KRN",.5,0)
.5
"BLD",10099,"KRN",.84,0)
.84
"BLD",10099,"KRN",3.6,0)
3.6
"BLD",10099,"KRN",3.8,0)
3.8
"BLD",10099,"KRN",9.2,0)
9.2
"BLD",10099,"KRN",9.8,0)
9.8
"BLD",10099,"KRN",9.8,"NM",0)
^9.68A^4^4
"BLD",10099,"KRN",9.8,"NM",1,0)
DGBT1^^0^B129718207
"BLD",10099,"KRN",9.8,"NM",2,0)
DGBTEE^^0^B63979701
"BLD",10099,"KRN",9.8,"NM",3,0)
DGBTRDVW^^0^B9874213
"BLD",10099,"KRN",9.8,"NM",4,0)
DGBTCE^^0^B37698850
"BLD",10099,"KRN",9.8,"NM","B","DGBT1",1)

"BLD",10099,"KRN",9.8,"NM","B","DGBTCE",4)

"BLD",10099,"KRN",9.8,"NM","B","DGBTEE",2)

"BLD",10099,"KRN",9.8,"NM","B","DGBTRDVW",3)

"BLD",10099,"KRN",19,0)
19
"BLD",10099,"KRN",19.1,0)
19.1
"BLD",10099,"KRN",101,0)
101
"BLD",10099,"KRN",409.61,0)
409.61
"BLD",10099,"KRN",771,0)
771
"BLD",10099,"KRN",779.2,0)
779.2
"BLD",10099,"KRN",870,0)
870
"BLD",10099,"KRN",8989.51,0)
8989.51
"BLD",10099,"KRN",8989.52,0)
8989.52
"BLD",10099,"KRN",8994,0)
8994
"BLD",10099,"KRN","B",.4,.4)

"BLD",10099,"KRN","B",.401,.401)

"BLD",10099,"KRN","B",.402,.402)

"BLD",10099,"KRN","B",.403,.403)

"BLD",10099,"KRN","B",.5,.5)

"BLD",10099,"KRN","B",.84,.84)

"BLD",10099,"KRN","B",3.6,3.6)

"BLD",10099,"KRN","B",3.8,3.8)

"BLD",10099,"KRN","B",9.2,9.2)

"BLD",10099,"KRN","B",9.8,9.8)

"BLD",10099,"KRN","B",19,19)

"BLD",10099,"KRN","B",19.1,19.1)

"BLD",10099,"KRN","B",101,101)

"BLD",10099,"KRN","B",409.61,409.61)

"BLD",10099,"KRN","B",771,771)

"BLD",10099,"KRN","B",779.2,779.2)

"BLD",10099,"KRN","B",870,870)

"BLD",10099,"KRN","B",8989.51,8989.51)

"BLD",10099,"KRN","B",8989.52,8989.52)

"BLD",10099,"KRN","B",8994,8994)

"BLD",10099,"QDEF")
^^^^^^^^^^YES
"BLD",10099,"QUES",0)
^9.62^^
"BLD",10099,"REQB",0)
^9.611^2^2
"BLD",10099,"REQB",1,0)
DGBT*1.0*24^2
"BLD",10099,"REQB",2,0)
DGBT*1.0*25^2
"BLD",10099,"REQB","B","DGBT*1.0*24",1)

"BLD",10099,"REQB","B","DGBT*1.0*25",2)

"MBREQ")
0
"PKG",154,-1)
1^1
"PKG",154,0)
BENEFICIARY TRAVEL^DGBT^Beneficiary Travel
"PKG",154,20,0)
^9.402P^^
"PKG",154,22,0)
^9.49I^1^1
"PKG",154,22,1,0)
1.0^3030731^3020423^66481
"PKG",154,22,1,"PAH",1,0)
30^3160311
"PKG",154,22,1,"PAH",1,1,0)
^^5^5^3160311
"PKG",154,22,1,"PAH",1,1,1,0)
This patch addresses 2 issues:
"PKG",154,22,1,"PAH",1,1,2,0)
  
"PKG",154,22,1,"PAH",1,1,3,0)
    1. Bene Travel is incorrectly granting deductible waivers.
"PKG",154,22,1,"PAH",1,1,4,0)
  
"PKG",154,22,1,"PAH",1,1,5,0)
    2. Claim deductibles are being modified after payment.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
4
"RTN","DGBT1")
0^1^B129718207^B127576754
"RTN","DGBT1",1,0)
DGBT1 ;ALB/SCK/BLD - BENEFICIARY TRAVEL DISPLAY SCREEN 1;10/31/05
"RTN","DGBT1",2,0)
 ;;1.0;Beneficiary Travel;**11,20,24,30**;September 25, 2001;Build 4
"RTN","DGBT1",3,0)
 Q
"RTN","DGBT1",4,0)
SCREEN ;  clear screen and write headers
"RTN","DGBT1",5,0)
 N TOTRIPS,ONEWAY,RT,MONTHDED,WAIVER,WTYPE,TTRIPS,TDED,TFIEN,DGBTOTHER
"RTN","DGBT1",6,0)
 D MONTOT(.TOTRIPS,.ONEWAY,.RT,.MONTHDED,.WAIVER,.WTYPE,.TTRIPS,.TDED) Q:$G(DGBTQUIT)
"RTN","DGBT1",7,0)
 S DGBTOTHER=0
"RTN","DGBT1",8,0)
 W @IOF
"RTN","DGBT1",9,0)
 W !?18,"Beneficiary Travel Claim Information <Screen 1>"
"RTN","DGBT1",10,0)
 W !!?2,"Claim Date: ",DGBTDTE
"RTN","DGBT1",11,0)
 D PID^VADPT6 W !!?8,"Name: ",VADM(1),?40,"PT ID: ",VA("PID"),?64,"DOB: ",$P(VADM(3),"^",2)
"RTN","DGBT1",12,0)
 I '$G(CHZFLG)!('$D(^DGBT(392,DGBTDT,"D"))) W !!?5,"Address: ",VAPA(1) W:VAPA(2)]"" !?14,VAPA(2) W:VAPA(3)]"" !?14,VAPA(3) W !?14,VAPA(4),$S(VAPA(4)]"":", "_$P(VAPA(5),"^",2)_"  "_$P(VAPA(11),U,2),1:"UNSPECIFIED")
"RTN","DGBT1",13,0)
 I $G(CHZFLG),$D(^DGBT(392,DGBTDT,"D")) D
"RTN","DGBT1",14,0)
 .N CLMADD,CLMST
"RTN","DGBT1",15,0)
 .S CLMADD=^DGBT(392,DGBTDT,"D")
"RTN","DGBT1",16,0)
 .S CLMST=$P(CLMADD,"^",5) S:$G(CLMST)'="" CLMST=$P(^DIC(5,CLMST,0),"^",2)
"RTN","DGBT1",17,0)
 .W !!?5,"Address: ",$P(CLMADD,"^",1) W:$P(CLMADD,"^",2)]"" !?14,$P(CLMADD,"^",2) W:$P(CLMADD,"^",3)]"" !?14,$P(CLMADD,"^",3) W !?14,$P(CLMADD,"^",4),$S($P(CLMADD,"^",4)]"":", "_CLMST_"  "_$P(CLMADD,"^",6),1:"UNSPECIFIED")
"RTN","DGBT1",18,0)
 W !!?5,$$ADDCHG(DFN)
"RTN","DGBT1",19,0)
 ;
"RTN","DGBT1",20,0)
SETVAR  ;  if new claim, move in current info for elig, sc%
"RTN","DGBT1",21,0)
 I 'CHZFLG S DGBTELG=VAEL(1),DGBTCSC=VAEL(3)
"RTN","DGBT1",22,0)
 I +DGBTELG=3,'$E(DGBTCSC)=1 S DGBTCSC=1
"RTN","DGBT1",23,0)
 I ($P(DGBTELG,U,2)["NSC")&(DGBTDYFL)&'($G(DGBTREF)) D
"RTN","DGBT1",24,0)
 .I +$TR($P(DGBTINC,U),"$,","")<DGBTRXTH S $P(DGBTELG,U,2)=$P(DGBTELG,U,2)_" LOW INCOME"
"RTN","DGBT1",25,0)
 W !!," Eligibility: ",$P(DGBTELG,"^",2) W:DGBTCSC ?45,"SC%: ",$P(DGBTCSC,"^",2) ;W !
"RTN","DGBT1",26,0)
 I $O(VAEL(1,0))'="" W !," Other Elig.: " F I=0:0 S I=$O(VAEL(1,I)) Q:'I  D
"RTN","DGBT1",27,0)
 .W ?14,$P(VAEL(1,I),"^",2),!
"RTN","DGBT1",28,0)
 .I VAEL(1,I)["HOUSEBOUND" S DGBTOTHER=1
"RTN","DGBT1",29,0)
 .I VAEL(1,I)["AID & ATTENDANCE" S DGBTOTHER=1
"RTN","DGBT1",30,0)
 .I VAEL(1,I)["PENSION" S DGBTOTHER=1
"RTN","DGBT1",31,0)
 ;
"RTN","DGBT1",32,0)
SC ;  service connected status/information
"RTN","DGBT1",33,0)
 I DGBTCSC&($P(DGBTCSC,"^",2)'>29) W !!,"Disabilities:" S I3=""
"RTN","DGBT1",34,0)
 N DGQUIT
"RTN","DGBT1",35,0)
 F I=0:0 S I=$O(^DPT(DFN,.372,I)) Q:'I!($G(DGQUIT)=1)  D
"RTN","DGBT1",36,0)
 . S I1=^(I,0),I2=$S($D(^DIC(31,+I1,0)):$P(^(0),"^",1)_" ("_+$P(I1,"^",2)_"%-"_$S($P(I1,"^",3):"SC",1:"NSC")_")",1:""),I3=I1
"RTN","DGBT1",37,0)
 . I $Y>(IOSL-3) D PAUSE I DGQUIT=0 W @IOF
"RTN","DGBT1",38,0)
 . I $G(DGQUIT)=1 Q
"RTN","DGBT1",39,0)
 .D
"RTN","DGBT1",40,0)
 ..I DGBTCSC&($P(DGBTCSC,"^",2)'>29) Q
"RTN","DGBT1",41,0)
 ..I I=$O(^DPT(DFN,.372,0)) W !
"RTN","DGBT1",42,0)
 . W ?16 W I2,!
"RTN","DGBT1",43,0)
 ;
"RTN","DGBT1",44,0)
INCOME ;  income and eligibility information
"RTN","DGBT1",45,0)
 ;DAYFLG = NUMBER OF DAYS SINCE LAST MEANS TEST
"RTN","DGBT1",46,0)
 N DGBTIFL,DGBTDATA,TESTDATE,DGBTDAYS,DGNOTEST,RXCP,RXCPST,DGRXDATA,RXDAYS,RXCPDATA,RXCPTS,DGBTST,BUSEXP,LOWINC,NOTEST
"RTN","DGBT1",47,0)
 ;
"RTN","DGBT1",48,0)
 ;
"RTN","DGBT1",49,0)
 S DGBTIFL=$P(DGBTINC,U,2)
"RTN","DGBT1",50,0)
 S (DAYFLG,RXDAYS,RXCPTS)=""
"RTN","DGBT1",51,0)
 ;CHECK HOW DAYS SINCE LAST MEANS TEST
"RTN","DGBT1",52,0)
 I $$DAYSTEST(DFN,.DAYFLG,.RXDAYS,.RXCPST,.LOWINC,.DGNOTEST)
"RTN","DGBT1",53,0)
 ;
"RTN","DGBT1",54,0)
 ; added for patch *24 to check for VFA MT currency and reset DAYFLG as needed
"RTN","DGBT1",55,0)
 I $$MTCHK^DGBTUTL1(DFN,$P(DGBTDT,".",1))>0 D
"RTN","DGBT1",56,0)
 . S (DAYFLG,DGBTDYFL)=1
"RTN","DGBT1",57,0)
 ;
"RTN","DGBT1",58,0)
 S BUSEXP=$$ABP^DGBTUTL(DFN)
"RTN","DGBT1",59,0)
 ;
"RTN","DGBT1",60,0)
 ;CHANGED FOR DGBT*1*20
"RTN","DGBT1",61,0)
 S ELIGTYP=$$GET1^DIQ(8.1,3_",",.01)
"RTN","DGBT1",62,0)
 I '$G(DGBTOTHER),'$G(LOWINC),($G(VAEL(3))),$P($G(VAEL(3)),"^",2)<30,($P(VAEL(1),"^",2))=ELIGTYP W !?2,"BT Alert: ELIGIBLE FOR SC APPOINTMENTS ONLY"
"RTN","DGBT1",63,0)
 I $G(BUSEXP) D
"RTN","DGBT1",64,0)
 .S Y=BUSEXP X ^DD("DD")
"RTN","DGBT1",65,0)
 .W !!?2,"BT Alert: BUS PASS ISSUED - EXPIRES ",Y
"RTN","DGBT1",66,0)
 ; 
"RTN","DGBT1",67,0)
 I (DAYFLG!DGBTINCA),'$G(RXCPST) D  D QUIT Q    ;valid mt in last 365 days + PAVEL
"RTN","DGBT1",68,0)
 .W !!?2,"Income: ",$P(DGBTINC,U),DGBTDTY,?35,"Source of Income:  ",$S(DGBTIFL="M":"MEANS TEST",DGBTIFL="C":"COPAY TEST",DGBTIFL="P":"Alt.Income POW",DGBTIFL="H":"Alt. Income Hardship",1:"")
"RTN","DGBT1",69,0)
 .W !?2,"No. of Dependents: ",DGBTDEP
"RTN","DGBT1",70,0)
 .;
"RTN","DGBT1",71,0)
 .I DGBTMTS]"" W:$P(DGBTMTS,"^")'="N" ?40,"MT Status: ",$S($P(DGBTMTS,"^")="R":"REQUIRED",$P(DGBTMTS,"^")="P":$P($P(DGBTMTS,"^",2)," "),DGBTMTS=U!($G(RXCPST)):" NOT APPLICABLE",1:$P(DGBTMTS,"^",2))
"RTN","DGBT1",72,0)
 .W:$P(DGBTMTS,"^")="P" !?68,$P($P(DGBTMTS,"^",2)," ",2)
"RTN","DGBT1",73,0)
 .I $P(DGBTMTS,"^")="N" W !!?20,"MEANS TEST ",$P(DGBTMTS,"^",2)
"RTN","DGBT1",74,0)
 .;
"RTN","DGBT1",75,0)
 .W !!?2,"BT Income: ",$S($D(DGBTCA):DGBTCA,1:"NOT RECORDED") W:$D(DGBTCE) ?25,"Certified Eligible: ",$S(DGBTCE:"YES",1:"NO"),?53,"Date Certified: ",$S($D(DGBTCD):DGBTCD,1:"NOT RECORDED")
"RTN","DGBT1",76,0)
 .I $D(DGBTCE) I DGBTCE'=1 W *7,*7,!!?8,"* * * NOTE * * PATIENT HAS BEEN CERTIFIED INELIGIBLE BASED ON INCOME"
"RTN","DGBT1",77,0)
 .S DGBTINFL="" I $D(DGBTINC),$D(DGBTCA),$P(DGBTINC,U)'=DGBTCA,$P(DGBTMTS,"^")'="N" S DGBTINFL=" * * * * Discrepancy exists in incomes reported, please verify * * * *" W !!?5,DGBTINFL
"RTN","DGBT1",78,0)
 .I '$D(DGBTRET(0)) W !,?50,$$WVEXP     ;*DGBT*1.0*20 BLD * E2
"RTN","DGBT1",79,0)
 .I $D(DGBTRET(0)),$P(DGBTRET(0),"^",6)'="MAN" W !,?50,$$WVEXP ; /*DGBT*1.0*20 RFE */
"RTN","DGBT1",80,0)
 .I $D(DGBTRET(0)),$P(DGBTRET(0),"^",6)="MAN" W !,?52,"WAIVER EXPIRES: ",$P(DGBTRET(0),"^",7)
"RTN","DGBT1",81,0)
 .F I=$Y:1:20 W !
"RTN","DGBT1",82,0)
 ;
"RTN","DGBT1",83,0)
 ;no valid mt test in last 365 days or no test has been done
"RTN","DGBT1",84,0)
 I 'DAYFLG D  D QUIT Q
"RTN","DGBT1",85,0)
  .W !!?2,"Income: ","",?40,"Source of Income:  ",""
"RTN","DGBT1",86,0)
 .W !?2,"No. of Dependents: ",DGBTDEP
"RTN","DGBT1",87,0)
 .I DGBTMTS]"" W ?40,"MT Status: ","EXPIRED"
"RTN","DGBT1",88,0)
 .W !!?2,"BT Income: ",$S($D(DGBTCA):DGBTCA,1:"NOT RECORDED") W:$D(DGBTCE) ?25,"Certified Eligible: ",$S(DGBTCE:"YES",1:"NO"),?53,"Date Certified: ",$S($D(DGBTCD):DGBTCD,1:"NOT RECORDED")
"RTN","DGBT1",89,0)
 .I '$D(DGBTRET(0)) W !,?50,$$WVEXP     ;*DGBT*1.0*20 BLD * E2
"RTN","DGBT1",90,0)
 .I $D(DGBTRET(0)),$P(DGBTRET(0),"^",6)'="MAN" W !,?50,$$WVEXP ; /*DGBT*1.0*20 RFE */
"RTN","DGBT1",91,0)
 .I $D(DGBTRET(0)),$P(DGBTRET(0),"^",6)="MAN" W !,?52,"WAIVER EXPIRES: ",$P(DGBTRET(0),"^",7)
"RTN","DGBT1",92,0)
 .F I=$Y:1:20 W !
"RTN","DGBT1",93,0)
 ;
"RTN","DGBT1",94,0)
 I DAYFLG,$G(RXCPST) D
"RTN","DGBT1",95,0)
 .I $G(RXCP)'=1,$P($G(DGBTINCA),"^",2)'="" W !!?2,"Income: ",$S($P($G(DGBTINCA),"^",2)'="":$P(DGBTINCA,"^",2),1:""),DGBTDTY,?40,"Source of Income:  ","Alternate Income/"_$S($P(DGBTINCA,"^",4)="H":"Hardship",1:"POW")
"RTN","DGBT1",96,0)
 .I $G(RXCP)'=1,$P($G(DGBTINCA),"^",2)="" W !!?2,"Income: ",DGBTDTY,?40,"Source of Income:  ","COPAY TEST"               ;RXCP'=1 Copy NON-EXEMPT
"RTN","DGBT1",97,0)
 .I $G(RXCP)=1,$P($G(DGBTINCA),"^",2)'="" W !!?2,"Income: ",$S($P($G(DGBTINCA),"^",2)'="":$P(DGBTINCA,"^",2),1:""),DGBTDTY,?40,"Source of Income:  ","Alternate Income/"_$S($P(DGBTINCA,"^",4)="H":"Hardship",1:"POW")
"RTN","DGBT1",98,0)
 .I $G(RXCP)=1,$P($G(DGBTINCA),"^",2)="" W !!?2,"Income: ",$P(DGBTINC,U),DGBTDTY,?40,"Source of Income:  ","COPAY TEST"  ;RXCP=1  Copay EXEMPT
"RTN","DGBT1",99,0)
 .W !?2,"No. of Dependents: ",DGBTDEP
"RTN","DGBT1",100,0)
 .I DGBTMTS]"" W ?40,"MT Status: ","NOT APPLICABLE"
"RTN","DGBT1",101,0)
 .W !!?2,"BT Income: ","INELIGIBLE"
"RTN","DGBT1",102,0)
 .I '$D(DGBTRET(0)) W ?50,$$WVEXP     ;*DGBT*1.0*20 BLD * E2
"RTN","DGBT1",103,0)
 .I $D(DGBTRET(0)),$P(DGBTRET(0),"^",6)'="MAN" W ?50,$$WVEXP ; /*DGBT*1.0*20 RFE */
"RTN","DGBT1",104,0)
 .I $D(DGBTRET(0)),$P(DGBTRET(0),"^",6)="MAN" W ?52,"WAIVER EXPIRES: ",$P(DGBTRET(0),"^",7)
"RTN","DGBT1",105,0)
 .F I=$Y:1:20 W !
"RTN","DGBT1",106,0)
 ;
"RTN","DGBT1",107,0)
QUIT ;
"RTN","DGBT1",108,0)
 K I1,I2,I3
"RTN","DGBT1",109,0)
 D MONTDISP(TOTRIPS,ONEWAY,RT,MONTHDED,WAIVER,WTYPE)
"RTN","DGBT1",110,0)
 Q
"RTN","DGBT1",111,0)
 ;
"RTN","DGBT1",112,0)
MONTOT(TOTRIPS,ONEWAY,RT,MONTHDED,WAIVER,WTYPE,TTRIPS,TDED) ;
"RTN","DGBT1",113,0)
 ;
"RTN","DGBT1",114,0)
 N RETURN
"RTN","DGBT1",115,0)
 S RETURN=""
"RTN","DGBT1",116,0)
 ;Return values: total number of trips ^ number of one way trips ^ number of round trips ^ deductible (all this for the month) ^ waiver y/n (y will be 1, n will be no) ^
"RTN","DGBT1",117,0)
 ;total number of trips as of this claim date ^ deductible as of this claim date
"RTN","DGBT1",118,0)
 ;from the local data base
"RTN","DGBT1",119,0)
 S RETURN=$$WAIV^DGBTRDVW(DFN,DGBTDTI)
"RTN","DGBT1",120,0)
 S ONEWAY=$S($P($G(RETURN),"^",2):$P($G(RETURN),"^",2),1:0)
"RTN","DGBT1",121,0)
 S RT=$S($P($G(RETURN),"^",3):$P($G(RETURN),"^",3),1:0)
"RTN","DGBT1",122,0)
 S WAIVER=$S($P($G(RETURN),"^",5)=1:"YES",1:"NO")
"RTN","DGBT1",123,0)
 S MONTHDED=$S($P($G(RETURN),"^",4):$P($G(RETURN),"^",4),1:0)
"RTN","DGBT1",124,0)
 S WTYPE=$P(RETURN,"^",5)
"RTN","DGBT1",125,0)
 S TOTRIPS=(RT*2)+ONEWAY
"RTN","DGBT1",126,0)
 S TTRIPS=$S($P($G(RETURN),U,8):$P($G(RETURN),U,8),1:0)
"RTN","DGBT1",127,0)
 S TDED=$S($P($G(RETURN),U,9):$P($G(RETURN),U,9),1:0)
"RTN","DGBT1",128,0)
 S DGBTREF=0
"RTN","DGBT1",129,0)
 S DGBTREF=$$LSTMTRIN(DFN,DGBTDTI)
"RTN","DGBT1",130,0)
 I (WAIVER="NO")&($G(DGBTDYFL)) D
"RTN","DGBT1",131,0)
 .I DGBTNSC D  Q
"RTN","DGBT1",132,0)
 ..N INCOME
"RTN","DGBT1",133,0)
 ..S INCOME=+$TR($P($G(DGBTINC),U),"$,","")
"RTN","DGBT1",134,0)
 ..I INCOME'="",INCOME<DGBTRXTH,'$G(DGBTREF) S WAIVER="YES",$P(RETURN,U,5)=1,$P(RETURN,U,6)="NSC"
"RTN","DGBT1",135,0)
 ..;I ($P($G(DGBTINC),"^",1)'="")&+$TR($P(DGBTINC,U),"$,","")<DGBTRXTH,'$G(DGBTREF) S WAIVER="YES",$P(RETURN,U,5)=1,$P(RETURN,U,6)="NSC"
"RTN","DGBT1",136,0)
 .I '$G(DGBTREF)&(+$G(VAEL(3)))&($P($G(DGBTINC),"^",1)'="")&(+$TR($P(DGBTINC,U),"$,","")<DGBTMTTH) S WAIVER="YES",$P(RETURN,U,5)=1,$P(RETURN,U,6)="LI" Q
"RTN","DGBT1",137,0)
 .I ($P($G(DGBTINC),"^",1)'="")&+$$LI^DGBTUTL(DFN,DGBTDTI,DGBTDEP,,DGBTINCA)'=0 S WAIVER="YES",$P(RETURN,U,5)=1,$P(RETURN,U,6)="LI"
"RTN","DGBT1",138,0)
 .I $P($G(DGBTINC),"^",1)="" S $P(RETURN,"^",6)=""
"RTN","DGBT1",139,0)
 I TOTRIPS<6,MONTHDED<18,$P(RETURN,"^",5)=0 D  Q:$G(DGBTQUIT)      ;if less than 6 trips and no waiver check for remote facility visits
"RTN","DGBT1",140,0)
 .S RETURN=""
"RTN","DGBT1",141,0)
 .D OPT^DGBTRDV(DFN,DGBTDTI) I $G(RDVMSG) W $$PAUSE^DGBTUTL(0) S:$G(Y)="^" DGBTQUIT=1 Q:$G(DGBTQUIT)!($G(DGBTRET(0))="")
"RTN","DGBT1",142,0)
 .I $G(RDVMSG) W $$PAUSE^DGBTUTL(0)
"RTN","DGBT1",143,0)
 .S ONEWAY=$G(ONEWAY)+$P(RETURN,"^",2)
"RTN","DGBT1",144,0)
 .S RT=$G(RT)+$P(RETURN,"^",3)
"RTN","DGBT1",145,0)
 .S MONTHDED=$G(MONTHDED)+$P(RETURN,"^",4)
"RTN","DGBT1",146,0)
 .S TOTRIPS=TOTRIPS+$P(RETURN,"^",1)
"RTN","DGBT1",147,0)
 .S TTRIPS=TTRIPS+$P(RETURN,U,8)
"RTN","DGBT1",148,0)
 .S TDED=TDED+$P(RETURN,U,9)
"RTN","DGBT1",149,0)
 .S $P(RETURN,"^",1)=TOTRIPS
"RTN","DGBT1",150,0)
 .S $P(RETURN,"^",8)=TTRIPS
"RTN","DGBT1",151,0)
 .S $P(RETURN,"^",9)=TDED
"RTN","DGBT1",152,0)
 .I $P(RETURN,"^",5)'=1 S $P(RETURN,"^",5)=$S(TTRIPS>6:1,TDED>18:0,1:$P(RETURN,"^",5))
"RTN","DGBT1",153,0)
 .S WAIVER=$S($P(RETURN,"^",5)=1:"YES",1:"NO")
"RTN","DGBT1",154,0)
 I WAIVER'="YES" S WAIVER=$S($P(RETURN,"^",1)>=6:"YES",1:"NO") ;*30 added greater than or equal to
"RTN","DGBT1",155,0)
 S MONTOT=$G(TOTRIPS)_"^"_$G(ONEWAY)_"^"_$G(RT)_"^"_$G(MONTHDED)_"^"_$G(WAIVER)_U_$G(TTRIPS)_U_$G(TDED)
"RTN","DGBT1",156,0)
 Q
"RTN","DGBT1",157,0)
 ;
"RTN","DGBT1",158,0)
MONTDISP(TOTRIPS,ONEWAY,RT,MONTHDED,WAIVER,WTYPE) ;
"RTN","DGBT1",159,0)
 ;
"RTN","DGBT1",160,0)
 W !?2,"TOTAL TRIPS THIS MONTH: ",$G(ONEWAY)_" ONE WAY, ",$G(RT)_" RD TRIP"
"RTN","DGBT1",161,0)
 W ?52,"WAIVER GRANTED: ",$G(WAIVER)
"RTN","DGBT1",162,0)
 W !?2,"TOTAL DEDUCTIBLE THIS MONTH: ",MONTHDED
"RTN","DGBT1",163,0)
 ;
"RTN","DGBT1",164,0)
 Q
"RTN","DGBT1",165,0)
 ;
"RTN","DGBT1",166,0)
PAUSE   ;added with DGBT*1*11
"RTN","DGBT1",167,0)
 I $E(IOST,1,2)["C-" N DIR S DIR(0)="E" D ^DIR S DGQUIT='Y
"RTN","DGBT1",168,0)
 Q
"RTN","DGBT1",169,0)
 ;
"RTN","DGBT1",170,0)
DAYSTEST(DFN,DAYFLG,RXDAYS,RXCPST,LOWINC,NOTEST) ;determines whether or not a valid MT in last 365 days.
"RTN","DGBT1",171,0)
 N DGBTDATA,TESTDATA,DGBTDAYS,DGMTSTAT,DGBTST,DGRXDATA,DGTSTTYP,DGMTST,X,DGMTYPT1,THRESHLD,INCOM
"RTN","DGBT1",172,0)
 S DGMTYPT1=3,DAYFLG=0,(DGMTST,RXCPST,THRESHLD,INCOM)=""
"RTN","DGBT1",173,0)
 S DGBTDATA=$$LST^DGMTCOU1(DFN,$P(DGBTDT,".",1),.DGMTYPT1)
"RTN","DGBT1",174,0)
 I DGBTDATA'="" D
"RTN","DGBT1",175,0)
 .S TESTDATE=$$LSTMTDT(DFN)
"RTN","DGBT1",176,0)
 .S DGBTDAYS=$$FMDIFF^XLFDT($P(DGBTDTI,".",1),TESTDATE)            ;get number of days from claim date to last MT
"RTN","DGBT1",177,0)
 .S DAYFLG=$S(DGBTDAYS>365:0,1:1)                   ;if greater than 365 days then no valid MT test
"RTN","DGBT1",178,0)
 .I DGMTYPT1=1 S DGMTST=$P(DGBTDATA,"^",3)="NO LONGER REQUIRED"
"RTN","DGBT1",179,0)
 .I DGMTYPT1=2 S RXCPST=$P(DGBTDATA,"^",3)="NON-EXEMPT"
"RTN","DGBT1",180,0)
 .S:RXCPST'=1 RXCP=1                             ;************************
"RTN","DGBT1",181,0)
 .S DGBTRET=$S(+$$LI^DGBTUTL(DFN,DGBTDTI,DGBTDEP,,DGBTINCA):"1^",1:"0^") ;Get Low Income + count Alternate Income   PAVEL
"RTN","DGBT1",182,0)
 .S LOWINC=$P(DGBTRET,"^",1)
"RTN","DGBT1",183,0)
 I $G(DAYFLG)=0 S DGNOTEST=1
"RTN","DGBT1",184,0)
 Q ""
"RTN","DGBT1",185,0)
 ;
"RTN","DGBT1",186,0)
ADDCHG(DFN) ;this will print the permanent Address last changed date or the Temporary Address last change date
"RTN","DGBT1",187,0)
 ;
"RTN","DGBT1",188,0)
 N DATE,TMPADD
"RTN","DGBT1",189,0)
 S TMPADD=$S($$GET1^DIQ(2,DFN,.12105)="YES":0,1:1)
"RTN","DGBT1",190,0)
 I TMPADD D
"RTN","DGBT1",191,0)
 .S DATE="Date Address Last Changed: "_$P($$GET1^DIQ(2,DFN,.118),"@",1)
"RTN","DGBT1",192,0)
 E  S DATE="Date Address Last Changed: "_$P($$GET1^DIQ(2,DFN,.12113),"@",1)
"RTN","DGBT1",193,0)
 ;
"RTN","DGBT1",194,0)
 Q DATE
"RTN","DGBT1",195,0)
 ; 
"RTN","DGBT1",196,0)
WVEXP() ; Waiver expiration date  ; /* Tagline added DGBT*1.0*20 RFE */
"RTN","DGBT1",197,0)
 N RETURN,VFADT,VFAMTDT,VFAMTDTP
"RTN","DGBT1",198,0)
 I $$WVELG Q "WAIVER EXPIRES: PENSION"
"RTN","DGBT1",199,0)
 N WVREQEXP
"RTN","DGBT1",200,0)
 I $D(^DGBT(392.7,"C",DFN)) S WVREQEXP=$$WVREQ("IN")
"RTN","DGBT1",201,0)
 I $G(WVREQEXP)="PENSION" Q "WAIVER EXPIRES: PENSION"
"RTN","DGBT1",202,0)
 N DGMTYPT1,TESTDATEI
"RTN","DGBT1",203,0)
 S TESTDATE=$$TESTDATE
"RTN","DGBT1",204,0)
 S TESTDATEI=$$DTFORMI(TESTDATE)
"RTN","DGBT1",205,0)
 I TESTDATEI<$P(DGBTDTI,".") Q ""
"RTN","DGBT1",206,0)
 I +$G(DGBTINCA) Q "WAIVER EXPIRES: "_TESTDATE
"RTN","DGBT1",207,0)
 I '+$G(LOWINC) Q $$WVREQ("EX")
"RTN","DGBT1",208,0)
 N LABL
"RTN","DGBT1",209,0)
 S LABL=$S($G(DGMTYPT1)=1:"MEANS TEST ",$G(DGMTYPT1)=2:"COPAY TEST ",1:"WAIVER ")_"EXPIRES: "
"RTN","DGBT1",210,0)
 ; ADDED FOR PATCH 24 VFA MT DO NOT EXPIRE
"RTN","DGBT1",211,0)
 S VFADT=+$$GET1^DIQ(43,"1,",1205,"I",,"ERR")
"RTN","DGBT1",212,0)
 S VFAMTDT=$P($$LST^DGMTCOU1(DFN,$P(DGBTDTI,"."),3),U,2),VFAMTDTP=$$FMADD^XLFDT(VFAMTDT,365,0,0,0)
"RTN","DGBT1",213,0)
 I VFAMTDTP'<VFADT&(LABL["MEANS TEST") Q "MEANS TEST DO NOT EXPIRE"
"RTN","DGBT1",214,0)
 ;
"RTN","DGBT1",215,0)
 Q LABL_TESTDATE
"RTN","DGBT1",216,0)
 ;
"RTN","DGBT1",217,0)
TESTDATE() ;
"RTN","DGBT1",218,0)
 I (+$G(DGBTINCA)),($G(WVREQEXP)>$P(DGBTINCA,U,5)) Q $$DTFORM(WVREQEXP)
"RTN","DGBT1",219,0)
 I +$G(DGBTINCA) Q $$DTFORM($P(DGBTINCA,U,5))
"RTN","DGBT1",220,0)
 S DGMTYPT1=3
"RTN","DGBT1",221,0)
 S TESTDATE=$P($$LST^DGMTCOU1(DFN,DGBTDTI,.DGMTYPT1),U,2)
"RTN","DGBT1",222,0)
 I 'DAYFLG S (TESTDATE,DGMTYPT1)=0
"RTN","DGBT1",223,0)
 I (+TESTDATE=0),($E($G(WVREQEXP),1,3)>$E(DGBTDTI,1,3)) Q $$DTFORM(WVREQEXP)
"RTN","DGBT1",224,0)
 I +TESTDATE=0 Q "12/31/"_$E(DGBTDTI,2,3)
"RTN","DGBT1",225,0)
 Q $$DTFORM(($E(TESTDATE,1,3)+1)_$E(TESTDATE,4,7))
"RTN","DGBT1",226,0)
 ;
"RTN","DGBT1",227,0)
DTFORM(INTDT) ;
"RTN","DGBT1",228,0)
 Q $E(INTDT,4,5)_"/"_$E(INTDT,6,7)_"/"_$E(INTDT,2,3)
"RTN","DGBT1",229,0)
 ;
"RTN","DGBT1",230,0)
DTFORMI(TESTDATE) ; 
"RTN","DGBT1",231,0)
 Q 3_$P(TESTDATE,"/",3)_$P(TESTDATE,"/",2)_$P(TESTDATE,"/")
"RTN","DGBT1",232,0)
 ;
"RTN","DGBT1",233,0)
WVELG() ; Eligibility for waiver being PENSION DGBT*1.0*20 RFE
"RTN","DGBT1",234,0)
 I VAEL(1)["PENSION" Q 1
"RTN","DGBT1",235,0)
 I $P(VAEL(1),"^",2)="AID & ATTENDANCE" Q 1
"RTN","DGBT1",236,0)
 I $P(VAEL(1),"^",2)="HOUSEBOUND" Q 1
"RTN","DGBT1",237,0)
 N HIT
"RTN","DGBT1",238,0)
 S (HIT,I)=""
"RTN","DGBT1",239,0)
 F  S I=$O(VAEL(1,I)) Q:I=""  D  Q:HIT
"RTN","DGBT1",240,0)
 .I VAEL(1,I)["PENSION" S HIT=1 Q
"RTN","DGBT1",241,0)
 .I $P(VAEL(3),U,2)'=100 D  ;*30 added to prevent waiver for 100% SC
"RTN","DGBT1",242,0)
 ..I $P(VAEL(1,I),"^",2)="AID & ATTENDANCE" S HIT=1 Q
"RTN","DGBT1",243,0)
 ..I $P(VAEL(1,I),"^",2)="HOUSEBOUND" S HIT=1 Q
"RTN","DGBT1",244,0)
 Q HIT
"RTN","DGBT1",245,0)
 ;
"RTN","DGBT1",246,0)
YEAR(DT1) ; DT2 will be a year after DT1  ; /*Tagline added DGBT*1.0*20 RFE */
"RTN","DGBT1",247,0)
 N DT2,MO,YR
"RTN","DGBT1",248,0)
 S DT2=$$FMTH^XLFDT(DT1,1)+365
"RTN","DGBT1",249,0)
 S YR=+$E(DT1,2,3),MO=+$E(DT1,4,5)
"RTN","DGBT1",250,0)
 I (YR#4=3),(MO>2) S DT2=DT2+1 ; Leap year
"RTN","DGBT1",251,0)
 I (YR#4=0),(MO<3) S DT2=DT2+1 ; Leap year
"RTN","DGBT1",252,0)
 Q DT2
"RTN","DGBT1",253,0)
 ;
"RTN","DGBT1",254,0)
WVREQ(INEX) ; Manual deductible waiver request DGBT*1.0*20 RFE
"RTN","DGBT1",255,0)
 I '$D(^DGBT(392.7,"C",DFN)) Q ""
"RTN","DGBT1",256,0)
 N DGBTDW,EXPDT
"RTN","DGBT1",257,0)
 S (DGBTDW,I)=""
"RTN","DGBT1",258,0)
 F  S I=$O(^DGBT(392.7,"C",DFN,I),-1) Q:I=""  D  Q:DGBTDW'=""
"RTN","DGBT1",259,0)
 .I $$GET1^DIQ(392.7,I,97,"I") Q
"RTN","DGBT1",260,0)
 . S EXPDT=$$GET1^DIQ(392.7,I,8,"I")
"RTN","DGBT1",261,0)
 . I EXPDT="PENSION" S DGBTDW=1 Q
"RTN","DGBT1",262,0)
 . I $E(I,1,3)=$E(DGBTA,1,3) S DGBTDW=^DGBT(392.7,I,0) Q
"RTN","DGBT1",263,0)
 . I $E(I,1,3)'=($E(DGBTA,1,3)-1) Q
"RTN","DGBT1",264,0)
 . I $$GET1^DIQ(392.7,I,8,"I")<$P(DGBTA,".") Q
"RTN","DGBT1",265,0)
 . S DGBTDW=^DGBT(392.7,I,0)
"RTN","DGBT1",266,0)
 I DGBTDW="" Q ""
"RTN","DGBT1",267,0)
 I $P(DGBTDW,"^",3)=0 Q ""
"RTN","DGBT1",268,0)
 I $P(DGBTA,".")<$P($P(DGBTDW,U),".") Q ""
"RTN","DGBT1",269,0)
 I INEX="IN" Q EXPDT
"RTN","DGBT1",270,0)
 I $G(EXPDT)="PENSION" Q "WAIVER EXPIRES: PENSION"
"RTN","DGBT1",271,0)
 I EXPDT<$P(DGBTDTI,".") Q ""
"RTN","DGBT1",272,0)
 Q "WAIVER EXPIRES: "_$$DTFORM(EXPDT)
"RTN","DGBT1",273,0)
 ;
"RTN","DGBT1",274,0)
LSTMTDT(DFN) ;this will return the last means test date
"RTN","DGBT1",275,0)
 N MTIEN
"RTN","DGBT1",276,0)
 S MTIEN=""
"RTN","DGBT1",277,0)
 S MTIEN=$O(^DGMT(408.31,"C",DFN,MTIEN),-1)
"RTN","DGBT1",278,0)
 S LSTMTDT=$P(^DGMT(408.31,MTIEN,0),"^",1)
"RTN","DGBT1",279,0)
 Q LSTMTDT
"RTN","DGBT1",280,0)
 ;
"RTN","DGBT1",281,0)
LSTMTRIN(DFN,DGBTDTI) ;this will return whether the patient refused to give income
"RTN","DGBT1",282,0)
 N MTIEN,REFUSED
"RTN","DGBT1",283,0)
 S REFUSED=1
"RTN","DGBT1",284,0)
 S MTIEN=+$$LST^DGMTCOU1(DFN,DGBTDTI,3)
"RTN","DGBT1",285,0)
 I MTIEN'="" S REFUSED=$$GET1^DIQ(408.31,MTIEN,.14,"I")
"RTN","DGBT1",286,0)
 Q REFUSED
"RTN","DGBTCE")
0^4^B37698850^B36783566
"RTN","DGBTCE",1,0)
DGBTCE ;ALB/SCK/BLD - BENEFICIARY TRAVEL CLAIM RE-ENTER/EDIT; 12/15/92  06/04/93 ;12/13/11  12:19
"RTN","DGBTCE",2,0)
 ;;1.0;Beneficiary Travel;**2,14,17,20,30**;September 25, 2001;Build 4
"RTN","DGBTCE",3,0)
 Q
"RTN","DGBTCE",4,0)
SCREEN ;
"RTN","DGBTCE",5,0)
 D QUIT^DGBTCE1
"RTN","DGBTCE",6,0)
 S DGBTTOUT=""
"RTN","DGBTCE",7,0)
 D SCREEN^DGBTEE1 Q:'$D(^DGBT(392,DGBTDT,0))  I DGBTTOUT=-1 S DGBTTOUT=1 Q
"RTN","DGBTCE",8,0)
 I $D(DGBTOACT) I DGBTOACT'=DGBTACCT S DGBTVAR(0)=^DGBT(392,DGBTDT,0) D FILE
"RTN","DGBTCE",9,0)
 S (DGBTMAL,DGBTFAB,DGBTME,DGBTCP,DGBTFLAG,DGBTDE,DGBTDCV,DGBTDCM,DGBTDPV,DGBTDPM)=0
"RTN","DGBTCE",10,0)
 S:$G(DGBTACCT)'>0 DGBTACCT=$P($G(DGBTVAR(0)),U,6)
"RTN","DGBTCE",11,0)
 I DGBTACCT=4!(DGBTACCT=5) I $$ABP^DGBTUTL(DFN) W !!,"*ALERT: Patient has an active bus pass, which expires on ",$$FMTE^XLFDT($$ABP^DGBTUTL(DFN)),".",! S DIR("A")="Press RETURN to continue",DIR(0)="E" D ^DIR K DIR ;20
"RTN","DGBTCE",12,0)
 S DGBTAP=VADM(1),DIE="^DGBT(392,",DA=DGBTDT,DR=$S(DGBTACCT=4:"42//"_DGBTAP,DGBTACCT=5:"43;S DGBTCP=X;42//"_DGBTAP,1:"44")
"RTN","DGBTCE",13,0)
 D ^DIE K DIE,DQ,DR I $D(DTOUT)!($D(Y)) S DGBTTOUT=1 Q
"RTN","DGBTCE",14,0)
 I DGBTACCT=4!(DGBTACCT=5) S:$D(DGBTVAR("M")) DGBTWAY=$P(DGBTVAR("M"),"^"),DGBTMILE=$P(DGBTVAR("M"),"^",2) S:$D(DGBTVAR("D")) DGBTCITY=$P(DGBTVAR("D"),"^",4),DGBTSTAT=$P(DGBTVAR("D"),"^",5)
"RTN","DGBTCE",15,0)
 S DGBTDIV=$P($G(^DGBT(392,DA,0)),U,11),DGBTRMK=$S($D(DGBTREC):$$DICLKUP^DGBTUTL(DGBTREC,DGBTDIV,4),1:"")
"RTN","DGBTCE",16,0)
 S DIE="^DGBT(392,",DA=DGBTDT
"RTN","DGBTCE",17,0)
 S DR="3////"_DGBTELIG_";6////"_DGBTACTN_";21;I X="""" S Y=24;22;I X="""" S Y=24;23;24;24.1;24.2;25;I X="""" S Y=28;26;I X="""" S Y=28;27;28;28.1;28.2"
"RTN","DGBTCE",18,0)
 D ^DIE K DIE I $D(DTOUT)!($D(Y)) S DGBTTOUT=1 Q
"RTN","DGBTCE",19,0)
 W:DGBTRMK]"" !!,*7,"MILEAGE REMARKS: ",DGBTRMK,!
"RTN","DGBTCE",20,0)
 I DGBTACCT=4!(DGBTACCT=5) D  Q:$G(DGBTTOUT)
"RTN","DGBTCE",21,0)
 .I $G(MONTOT)'="" N OTRIPTYP S OTRIPTYP=$$GET1^DIQ(392,DGBTDT,31,"I")
"RTN","DGBTCE",22,0)
 . S DR="31//;S DGBTOWRT=X;32//;S DGBTML=X"
"RTN","DGBTCE",23,0)
 . I DGBTACCT=5&(DGBTCP=1) S DGBTMR=DGBTMR1
"RTN","DGBTCE",24,0)
 . S DIE="^DGBT(392,",DA=DGBTDT
"RTN","DGBTCE",25,0)
 . D ^DIE K DIE,DQ,DR I $D(DTOUT)!($D(Y)) S DGBTTOUT=1
"RTN","DGBTCE",26,0)
 .I ($G(MONTOT)'="")&($G(OTRIPTYP)'=$$GET1^DIQ(392,DGBTDT,31,"I")) D
"RTN","DGBTCE",27,0)
 ..N NTRIPTYP S NTRIPTYP=$$GET1^DIQ(392,DGBTDT,31,"I")
"RTN","DGBTCE",28,0)
 ..I (OTRIPTYP=1)&(NTRIPTYP=2) D  Q
"RTN","DGBTCE",29,0)
 ...S $P(MONTOT,U)=$P(MONTOT,U)+1
"RTN","DGBTCE",30,0)
 ...S $P(MONTOT,U,2)=$P(MONTOT,U,2)-1
"RTN","DGBTCE",31,0)
 ...S $P(MONTOT,U,3)=$P(MONTOT,U,3)+1
"RTN","DGBTCE",32,0)
 ..I (OTRIPTYP=2)&(NTRIPTYP=1) D  Q
"RTN","DGBTCE",33,0)
 ...S $P(MONTOT,U)=$P(MONTOT,U)-1
"RTN","DGBTCE",34,0)
 ...S $P(MONTOT,U,2)=$P(MONTOT,U,2)+1
"RTN","DGBTCE",35,0)
 ...S $P(MONTOT,U,3)=$P(MONTOT,U,3)-1
"RTN","DGBTCE",36,0)
 . N MODE S DIR(0)="Y",DIR("B")=$S($D(^DGBT(392,DGBTDT,"C")):"YES",1:"NO"),DIR("A")="COMMON CARRIER USED" D ^DIR K DIR S MODE=Y I $D(DIRUT),$G(DUOUT) S DGBTTOUT=-1 Q  ;20
"RTN","DGBTCE",37,0)
 . I 'MODE,$D(^DGBT(392,DGBTDT,"C")) S $P(^DGBT(392,DGBTDT,"A"),"^",4)="" F I="B","C"  K ^DGBT(392,DGBTDT,I)
"RTN","DGBTCE",38,0)
 . I $$GET1^DIQ(392,DGBTDT,44)'=""!($G(MODE)) S DIE="^DGBT(392,",DA=DGBTDT,DR="44COMMON CARRIER MODE" D ^DIE  I $D(Y) S DGBTTOUT=1 Q  ;20
"RTN","DGBTCE",39,0)
 . S DIE="^DGBT(392,",DA=DGBTDT I $$UP^XLFSTR($$GET1^DIQ(392,DGBTDT,44))["BUS" S DR="52R;I X'=""P"" S Y="""";53R" D ^DIE I $D(Y) S DGBTTOUT=1 Q  ;20
"RTN","DGBTCE",40,0)
 . I $$GET1^DIQ(392,DGBTDT,44)'="" S DIE="^DGBT(392,",DA=DGBTDT,DR="54;55;55.1" D ^DIE I $D(Y) S DGBTTOUT=1 Q  ;20
"RTN","DGBTCE",41,0)
DIE1 ;
"RTN","DGBTCE",42,0)
 S DGBTMLT=$S($D(DGBTVAR("M"))&((DGBTACCT=4)!(DGBTACCT=5)):$J((DGBTOWRT*DGBTML*DGBTMR),0,2),1:""),$P(^DGBT(392,DGBTDT,"M"),"^",3)=DGBTMLT,$P(DGBTVAR("M"),"^",3)=DGBTMLT
"RTN","DGBTCE",43,0)
 ;
"RTN","DGBTCE",44,0)
 S DIE="^DGBT(392,",DA=DGBTDT
"RTN","DGBTCE",45,0)
 I 'DGBTCORE D
"RTN","DGBTCE",46,0)
 . S DR="I DGBTACCT=4!(DGBTACCT=5) S Y=""@1"";41;7;@1;I DGBTMLFB=0 S Y=""@2"";34//;S DGBTMAL=X;35//;S DGBTFAB=X;@2;8//;S DGBTME=X"
"RTN","DGBTCE",47,0)
 I DGBTCORE S DR="" D
"RTN","DGBTCE",48,0)
 . S DR(1,392,1)="I DGBTACCT=4!(DGBTACCT=5) S Y=""@1"";41;@3;14;S DGBTCSL=$$AFTER^DGBTCSL(392,D0,X,$G(DGBTPRV)) S:DGBTCSL<1 Y=""@3"" W:DGBTCSL<1 ""   Required"" K DGBTPRV,DGBTCSL;"
"RTN","DGBTCE",49,0)
 . S DR(1,392,2)="@1;I DGBTMLFB=0 S Y=""@2"";34//;S DGBTMAL=X;35//;S DGBTFAB=X;@2;8//;S DGBTME=X"
"RTN","DGBTCE",50,0)
DIE3 ;
"RTN","DGBTCE",51,0)
 D ^DIE K DIE,DQ,DR I $D(DTOUT)!($D(Y)) S DGBTTOUT=1 Q
"RTN","DGBTCE",52,0)
 ;
"RTN","DGBTCE",53,0)
TCOST ;CALCULATE TOTAL COST AND MONTHLY CUM. DEDUCTIBLE
"RTN","DGBTCE",54,0)
MLFB ;
"RTN","DGBTCE",55,0)
 S DGBTMAF=$S(DGBTMLFB:DGBTMAL+DGBTFAB,1:0),DGBTMETC=DGBTME+$S($D(DGBTMAL):DGBTMAL,1:0)
"RTN","DGBTCE",56,0)
 I DGBTACCT'=4&(DGBTACCT'=5) S DGBTPA=DGBTMAF+DGBTME G CONT
"RTN","DGBTCE",57,0)
 I $D(DGBTMLT) S DGBTTC=$S(DGBTMLT+DGBTMAF'>DGBTMETC:DGBTMLT+DGBTMAF,DGBTMLT+DGBTMAF>DGBTMETC&(DGBTME>0):DGBTMETC,DGBTME'>0:DGBTMLT+DGBTMAF,1:DGBTMETC)
"RTN","DGBTCE",58,0)
 I DGBTACCT=5 S DGBTDE=0 S DGBTPA=$S((DGBTMLT+DGBTMAF)'=0:DGBTTC,1:DGBTMETC) G CONT
"RTN","DGBTCE",59,0)
DED ;
"RTN","DGBTCE",60,0)
 I $G(MONTOT)'="" N ODED S ODED=$$GET1^DIQ(392,DGBTDT,9)
"RTN","DGBTCE",61,0)
 F I=$E(DGBTDT,1,5)_"00.2399":0 S I=$O(^DGBT(392,"C",DFN,I)) Q:'I!($E(I,1,5)>$E(DGBTDT,1,5))  I I'=DGBTDT S DGBTDCM=DGBTDCM+($P(^DGBT(392,I,0),"^",9))
"RTN","DGBTCE",62,0)
 I $D(^DG(43.1,$O(^DG(43.1,(9999999.99999-DGBTDT))),"BT")) S DGBTRATE=^("BT"),DGBTDPV=$P(DGBTRATE,"^"),DGBTDPM=$P(DGBTRATE,"^",2),DGBTMR=$P(DGBTRATE,"^",3)
"RTN","DGBTCE",63,0)
 I $D(^DGBT(392,DGBTDT,"M")) S:$P(^("M"),"^")=1 DGBTDPV=DGBTDPV/2 I DGBTWAY'=$P(^("M"),"^")!(DGBTMILE'=$P(^("M"),"^",2)) I $D(^DGBT(392,DGBTDT,0)) S $P(^(0),"^",9)="" K ^DGBT(392,"AD",$P(^(0),"^",2),$E(DGBTDT,2,5),DGBTDT)
"RTN","DGBTCE",64,0)
 S DGBTDRM=DGBTDPM-DGBTDCM
"RTN","DGBTCE",65,0)
 I DGBTDRM<0 S DGBTDRM=0
"RTN","DGBTCE",66,0)
 I DGBTDE<0 S DGBTDE=0
"RTN","DGBTCE",67,0)
 S DGBTDCV=$S(DGBTDCM'<DGBTDPM:0,DGBTDRM'<DGBTDPV&(DGBTTC'<DGBTDPV):DGBTDPV,DGBTDRM'<DGBTDPV&(DGBTTC'>DGBTDPV):DGBTTC,DGBTDRM'>DGBTDPV&(DGBTTC'>DGBTDRM):DGBTTC,DGBTDRM'>DGBTDPV&(DGBTTC'<DGBTDRM):DGBTDRM,1:0)
"RTN","DGBTCE",68,0)
 I $P(MONTOT,"^",5)="YES"&('$G(CHZFLG)) S DGBTDCV=0 ;*30 modified to preserve waiver status of existing claims
"RTN","DGBTCE",69,0)
DED1 ;
"RTN","DGBTCE",70,0)
 S DR="I $P(^DGBT(392,DGBTDT,0),""^"",9)]"""" S Y=""@9"";9///"_DGBTDCV_";@9;9;S DGBTDE=X S:DGBTDE>DGBTTC DGBTDE=DGBTTC,DGBTFLAG=2 S:DGBTDE>DGBTDRM DGBTDE=DGBTDRM,DGBTFLAG=1"
"RTN","DGBTCE",71,0)
DIE4 ;
"RTN","DGBTCE",72,0)
 I $G(^DGBT(392,DGBTDT,0))'="" D
"RTN","DGBTCE",73,0)
 .I $P(^DGBT(392,DGBTDT,0),U,9)="" S $P(^DGBT(392,DGBTDT,0),U,9)=+$G(DGBTDCV)
"RTN","DGBTCE",74,0)
 S DIE="^DGBT(392,",DA=DGBTDT D ^DIE K DIE,DQ,DR I $D(DTOUT)!($D(Y)) S DGBTTOUT=1 Q
"RTN","DGBTCE",75,0)
 I ($G(MONTOT)'="")&($G(ODED)'=DGBTDE) D
"RTN","DGBTCE",76,0)
 .S $P(MONTOT,U,4)=$P(MONTOT,U,4)+DGBTDE
"RTN","DGBTCE",77,0)
 .S $P(MONTOT,U,4)=$P(MONTOT,U,4)-ODED
"RTN","DGBTCE",78,0)
CONT ;
"RTN","DGBTCE",79,0)
 D CONT^DGBTCE1
"RTN","DGBTCE",80,0)
 Q
"RTN","DGBTCE",81,0)
FILE ;      Reset values if account changes
"RTN","DGBTCE",82,0)
 S DGBTVAR(0)=$P(DGBTVAR(0),"^",1,6)_"^^0^^"_$S($L(DGBTVAR(0),"^")>10:$P(DGBTVAR(0),"^",10,$L(DGBTVAR(0),"^")),1:""),DGBTVAR("A")="^"_$P(DGBTVAR("A"),"^",2)_"^^^"_$S($L(DGBTVAR("A"),"^")>4:$P(DGBTVAR("A"),"^",5,$L(DGBTVAR("A"),"^")),1:"")
"RTN","DGBTCE",83,0)
 I DGBTACCT<4 S DGBTVAR("M")="^^^"_$S($L(DGBTVAR("M"),"^")>3:$P(DGBTVAR("M"),"^",4,$L(DGBTVAR("M"),"^")),1:"")
"RTN","DGBTCE",84,0)
 S ^DGBT(392,DGBTDT,0)=DGBTVAR(0),^("A")=DGBTVAR("A") S:DGBTACCT<4 ^("M")=DGBTVAR("M") S DA=DGBTDT,DIK="^DGBT(392," D IX^DIK
"RTN","DGBTCE",85,0)
 Q
"RTN","DGBTEE")
0^2^B63979701^B64077046
"RTN","DGBTEE",1,0)
DGBTEE ;ALB/SCK - BENEFICIARY TRAVEL ENTER/EDIT; 12/3/92@1600 ; 7/2/14 1:17pm
"RTN","DGBTEE",2,0)
 ;;1.0;Beneficiary Travel;**2,14,20,21,25,30**;September 25, 2001;Build 4
"RTN","DGBTEE",3,0)
 Q
"RTN","DGBTEE",4,0)
SCREEN ;
"RTN","DGBTEE",5,0)
 ;
"RTN","DGBTEE",6,0)
 I '$D(^DGBT(392,DGBTDT,"D"))&('$D(^DGBT(392,DGBTDT,"T"))) S DGBTSP2M=1 D STUFF^DGBTE1 K DGBTSP2M ;dbe patch DGBT*1.0*25 - added for conversion from SP to M during claim edit
"RTN","DGBTEE",7,0)
 D SCREEN^DGBTEE1 Q:$G(DGBTTOUT)=-1!($G(DGBTTOUT)=1)  Q:'$D(^DGBT(392,DGBTDT,0))
"RTN","DGBTEE",8,0)
 ;  The following section of code moved to DGBTEE2 for space problems
"RTN","DGBTEE",9,0)
 D STUFF^DGBTEE2
"RTN","DGBTEE",10,0)
MILES ;  get miles between dep. and dest. using function call to DGBTUTL
"RTN","DGBTEE",11,0)
 ;
"RTN","DGBTEE",12,0)
 K X,DGBTREC S (DGBTOWRT,DGBTML,DGBTMLT)=""
"RTN","DGBTEE",13,0)
 I DGBTFR4]""&((DGBTACCT=4)!(DGBTACCT=5)) I $D(^DGBT(392.1,"ACS",DGBTFR4,+VAPA(5))) D
"RTN","DGBTEE",14,0)
 . S X=$O(^(+VAPA(5),0)) ; naked ref. refers to file #392.1, "ACS", city.  Full reference on line MILES+2^DGBTEE, ^DGBTE(392.1,"ACS",DGBTFR4,+VAPA(5)
"RTN","DGBTEE",15,0)
 . ;  function $$miles passes city's record# and div name to function, mileage value is returned
"RTN","DGBTEE",16,0)
 . I X'="" S DGBTREC=X,DGBTML=$$MILES^DGBTUTL(DGBTREC,DGBTDV1),DGBTOWRT="ROUND TRIP" K X
"RTN","DGBTEE",17,0)
 S (DGBTMAL,DGBTFAB,DGBTME,DGBTCP,DGBTFLAG,DGBTDCV,DGBTDE,DGBTDCM,DGBTDPV,DGBTDPM)=0
"RTN","DGBTEE",18,0)
DIE1 ;  stuff from,to address, meals, ferry's/bridges
"RTN","DGBTEE",19,0)
 ;
"RTN","DGBTEE",20,0)
 Q:'$D(^DGBT(392,DGBTDT,0))
"RTN","DGBTEE",21,0)
 ;
"RTN","DGBTEE",22,0)
 S DIE="^DGBT(392,",DA=DGBTDT,DR=$S($G(DGBTACCT)=4:"42//"_$G(DGBTAP),$G(DGBTACCT)=5:"43;S DGBTCP=X;42//"_$G(DGBTAP),1:"44")
"RTN","DGBTEE",23,0)
 D ^DIE I X=""!(X="^") S DGBTTOUT=-1 Q
"RTN","DGBTEE",24,0)
 ;
"RTN","DGBTEE",25,0)
 S DR="21////^S X=DGBTFR1;22////^S X=DGBTFR2;23////^S X=DGBTFR3;24////^S X=DGBTFR4;25////^S X=DGBTTO1;26////^S X=DGBTTO2;27////^S X=DGBTTO3;28////^S X=DGBTTO4" ;;34////^S X=DGBTMAL;35////^S X=DGBTFAB"
"RTN","DGBTEE",26,0)
 D ^DIE I X=""!(X="^") S DGBTTOUT=-1 Q
"RTN","DGBTEE",27,0)
 ;
"RTN","DGBTEE",28,0)
 I DGBTACCT=4!(DGBTACCT=5) D
"RTN","DGBTEE",29,0)
 . W !!,"Please enter mileage obtained from BT Dashboard ..."
"RTN","DGBTEE",30,0)
 .S DGBTRMK=$S($D(DGBTREC):$$DICLKUP^DGBTUTL(DGBTREC,DGBTDV1,4),1:"") I $D(DGBTDEF),DGBTDEF S DGBTRMK="DEFAULT MILEAGE USED"
"RTN","DGBTEE",31,0)
 .I DGBTRMK]"" W !,*7,"MILEAGE REMARKS: ",DGBTRMK,!
"RTN","DGBTEE",32,0)
 ;
"RTN","DGBTEE",33,0)
EDIT ;  display trip type, mileage
"RTN","DGBTEE",34,0)
 I ($G(DGBTACCT)=4)!($G(DGBTACCT)=5) D  Q:$G(DGBTTOUT)=-1  ;20
"RTN","DGBTEE",35,0)
 .I $G(CHZFLG) N OTRIPTYP S OTRIPTYP=$$GET1^DIQ(392,DGBTDT,31,"I")
"RTN","DGBTEE",36,0)
 .S DR="32//"_DGBTML_";S DGBTML=X;31//"_DGBTOWRT_";S DGBTOWRT=X;" D ^DIE I X=""!(X="^") S DGBTTOUT=-1 Q  ;20
"RTN","DGBTEE",37,0)
 .I ($G(CHZFLG))&($G(OTRIPTYP)'=$$GET1^DIQ(392,DGBTDT,31,"I"))&($G(MONTOT)'="") D
"RTN","DGBTEE",38,0)
 ..N NTRIPTYP S NTRIPTYP=$$GET1^DIQ(392,DGBTDT,31,"I")
"RTN","DGBTEE",39,0)
 ..I (OTRIPTYP=1)&(NTRIPTYP=2) D  Q
"RTN","DGBTEE",40,0)
 ...S $P(MONTOT,U)=$P(MONTOT,U)+1
"RTN","DGBTEE",41,0)
 ...S $P(MONTOT,U,2)=$P(MONTOT,U,2)-1
"RTN","DGBTEE",42,0)
 ...S $P(MONTOT,U,3)=$P(MONTOT,U,3)+1
"RTN","DGBTEE",43,0)
 ..I (OTRIPTYP=2)&(NTRIPTYP=1) D  Q
"RTN","DGBTEE",44,0)
 ...S $P(MONTOT,U)=$P(MONTOT,U)-1
"RTN","DGBTEE",45,0)
 ...S $P(MONTOT,U,2)=$P(MONTOT,U,2)+1
"RTN","DGBTEE",46,0)
 ...S $P(MONTOT,U,3)=$P(MONTOT,U,3)-1
"RTN","DGBTEE",47,0)
 .S DGBTCCT=$$GET1^DIQ(392,DGBTDT,54,"I")
"RTN","DGBTEE",48,0)
 .S DIR(0)="Y",DIR("B")=$S($G(DGBTCCT)'="":"YES",1:"NO"),DIR("A")="COMMON CARRIER USED" D ^DIR K DIR I $D(DIRUT) S DGBTTOUT=-1 Q  ;20
"RTN","DGBTEE",49,0)
 .I 'Y,$D(^DGBT(392,DGBTDT,"C")) S $P(^DGBT(392,DGBTDT,"A"),"^",4)="" F I="B","C"  K ^DGBT(392,DGBTDT,I)
"RTN","DGBTEE",50,0)
 .I Y D  ;20
"RTN","DGBTEE",51,0)
 ..K DA,DR,DIE,Y S DIE="^DGBT(392,",DA=DGBTDT,DR="44COMMON CARRIER MODE~R" D ^DIE  I $D(Y) S DGBTTOUT=-1 Q  ;20
"RTN","DGBTEE",52,0)
 ..K DA,DR,DIE,Y S DIE="^DGBT(392,",DA=DGBTDT I $$UP^XLFSTR($$GET1^DIQ(392,DGBTDT,44))["BUS" S DR="52R" D ^DIE I $D(Y) S DGBTTOUT=-1 Q  ;20
"RTN","DGBTEE",53,0)
 ..K DA,DR,DIE,Y I $$GET1^DIQ(392,DGBTDT,52)="PASS" S DIE="^DGBT(392,",DA=DGBTDT,DR="53R" D ^DIE I $D(Y) S DGBTTOUT=-1 Q  ;20
"RTN","DGBTEE",54,0)
 ..N %DT S %DT(0)="-NOW" ;prevents future dates Coder CR 53 for DG*1.0*20
"RTN","DGBTEE",55,0)
 ..K DA,DR,DIE,Y S DIE="^DGBT(392,",DA=DGBTDT,DR="54//"_$P(DGBTDTE,"@",1)_";55;55.1" D ^DIE I $D(Y) S DGBTTOUT=-1 Q  ;20 PAVEL - DGBT*1*20
"RTN","DGBTEE",56,0)
 S:DGBTACCT=5&(DGBTCP=1) DGBTMR=DGBTMR1 S DGBTMLT=DGBTOWRT*DGBTML*DGBTMR,DGBTMLT=$J(DGBTMLT,0,2),DR="33///"_DGBTMLT
"RTN","DGBTEE",57,0)
 D ^DIE I X=""!(X="^") S DGBTTOUT=-1 Q
"RTN","DGBTEE",58,0)
 I $G(^DGBT(392,DGBTDTI,"C"))="" K ^DGBT(392,DGBTDTI,"C"),DGBTVAR("C")
"RTN","DGBTEE",59,0)
 ;
"RTN","DGBTEE",60,0)
DIE2 ;  stuff eligibility data, SC%, acct. type
"RTN","DGBTEE",61,0)
 ;
"RTN","DGBTEE",62,0)
 S DIE("NO^")="12345" S:'$D(DGBTCD) DGBTCD=""
"RTN","DGBTEE",63,0)
 I 'DGBTCORE D
"RTN","DGBTEE",64,0)
 . S DR="3////"_DGBTELIG_";4////"_DGBTSCP_";5///"_DGBTCD_";6////"_DGBTACTN_";I DGBTACCT=4!(DGBTACCT=5) S Y=""@1"";41;7;@1;I DGBTMLFB=0 S Y=""@2"";34//0;W:'X X S DGBTMAL=X;35//0;W:'X X S DGBTFAB=X;@2"
"RTN","DGBTEE",65,0)
 I DGBTCORE D
"RTN","DGBTEE",66,0)
 . S DR(1,392,1)="3////"_DGBTELIG_";4////"_DGBTSCP_";5///"_DGBTCD_";6////"_DGBTACTN_";I DGBTACCT=4!(DGBTACCT=5) S Y=""@1"";41;"
"RTN","DGBTEE",67,0)
 . S DR(1,392,2)="@3;14;S DGBTCSL=$$AFTER^DGBTCSL(392,D0,X,$G(DGBTPRV)) S:DGBTCSL<1 Y=""@3"" W:DGBTCSL<1 ""   Required"" K DGBTPRV,DGBTCSL;@1;I DGBTMLFB=0 S Y=""@2"";34//0;S DGBTMAL=X;35//0;S DGBTFAB=X;@2"
"RTN","DGBTEE",68,0)
 ;
"RTN","DGBTEE",69,0)
 ;DIE3 ;  get most econ. cost
"RTN","DGBTEE",70,0)
 ;
"RTN","DGBTEE",71,0)
 D ^DIE K DR I $G(DTOUT)!(X="^") S DGBTTOUT=-1 Q
"RTN","DGBTEE",72,0)
 ;
"RTN","DGBTEE",73,0)
 ;check for common carrier
"RTN","DGBTEE",74,0)
 S DGBTMAF=$G(DGBTFAB)+$G(DGBTMAL)
"RTN","DGBTEE",75,0)
 S (DGBTCC,DGBTCCAMT,DGBTCCREQ,DGBTCCMODE,DGBTMETC)=0
"RTN","DGBTEE",76,0)
 S DGBTDCM=$P(MONTOT,"^",4)
"RTN","DGBTEE",77,0)
 S DGBTDCM=$S(DGBTMLT-DGBTDCM'>0:DGBTMLT,1:DGBTDCM)
"RTN","DGBTEE",78,0)
 I $D(^DGBT(392,DGBTDTI,"C")) D
"RTN","DGBTEE",79,0)
 .S DGBTCC=$D(^DGBT(392,DGBTDTI,"C"))          ;was common carrier used
"RTN","DGBTEE",80,0)
 .S DGBTCCAMT=$$GET1^DIQ(392,DGBTDTI,55)    ; amount of common carrier
"RTN","DGBTEE",81,0)
 .S DGBTCCREQ=$$GET1^DIQ(392,DGBTDTI,55.1),DGBTCCREQ=$S(DGBTCCREQ="YES":1,1:0)        ;common carrier required - 1=yes,0=no
"RTN","DGBTEE",82,0)
 .S DGBTCCMODE=$$GET1^DIQ(392,DGBTDTI,44,"I")                      ;common carrier mode of transportation
"RTN","DGBTEE",83,0)
 .S DGBTMETC=$G(DGBTME)+$G(DGBTMAL)    ;$S($D(DGBTMAL):DGBTMAL,1:0)   ;most enco + meals and lodging S DGBTDCM=$P(MONTOT,"^",4) S DGBTDCM=$P(MONTOT,"^",4) S DGBTMAF=$S(DGBTMLFB:DGBTMAL+DGBTFAB,1:0),DGBTMETC=DGBTME+$S($D(DGBTMAL):DGBTMAL,1:0)
"RTN","DGBTEE",84,0)
 ;
"RTN","DGBTEE",85,0)
 ;if CC not required reset most econ to 0
"RTN","DGBTEE",86,0)
 I $G(DGBTCCREQ) D
"RTN","DGBTEE",87,0)
 .S FDA(392,DGBTDTI_",",8)=0
"RTN","DGBTEE",88,0)
 .D FILE^DIE(,"FDA")
"RTN","DGBTEE",89,0)
 S:$D(DGBTREC) DGBTME=$$DICLKUP^DGBTUTL(DGBTREC,DGBTDV1,3) S:DGBTME="" DGBTME=0 S DR="8//"_DGBTME_";W:'X X S DGBTME=X" D ^DIE I X=""!(X="^") S DGBTTOUT=-1 G EXIT
"RTN","DGBTEE",90,0)
TCOST ; calculate total cost and monthly cum. deductible
"RTN","DGBTEE",91,0)
MLFB ;
"RTN","DGBTEE",92,0)
 ;
"RTN","DGBTEE",93,0)
 N OWAIV
"RTN","DGBTEE",94,0)
 S OWAIV=$P(MONTOT,U,5)
"RTN","DGBTEE",95,0)
 S MONTOT=$$ADDTO(.MONTOT)
"RTN","DGBTEE",96,0)
 I DGBTACCT'=4&(DGBTACCT'=5) S DGBTPA=DGBTMAF+DGBTME G CONT
"RTN","DGBTEE",97,0)
 I $D(DGBTMLT) D
"RTN","DGBTEE",98,0)
 .I DGBTMLT+DGBTMAF'>DGBTMETC S DGBTTC=DGBTMLT+DGBTMAF Q
"RTN","DGBTEE",99,0)
 .I DGBTMLT+DGBTMAF>DGBTMETC&(DGBTME>0) S DGBTTC=DGBTMETC Q
"RTN","DGBTEE",100,0)
 .I DGBTME'>0 S DGBTTC=DGBTMLT+DGBTMAF Q
"RTN","DGBTEE",101,0)
 .E  S DGBTTC=DGBTMETC
"RTN","DGBTEE",102,0)
 I $G(DGBTCCREQ) S DGBTTC=$G(DGBTTC)+DGBTCCAMT
"RTN","DGBTEE",103,0)
 I DGBTACCT=5 S DGBTDE=0 S DGBTPA=$S((DGBTMLT+DGBTMAF)'=0:DGBTTC,1:DGBTMETC) ;G CONT
"RTN","DGBTEE",104,0)
 ;  the following section of code moved to DGBTEE2 for space reasons
"RTN","DGBTEE",105,0)
 I DGBTACCT'=5 D
"RTN","DGBTEE",106,0)
 .N DGBTDCVX,XY
"RTN","DGBTEE",107,0)
 .I $G(CHZFLG) N ODED S ODED=$$GET1^DIQ(392,DGBTDT,9)
"RTN","DGBTEE",108,0)
 .D DED^DGBTEE2
"RTN","DGBTEE",109,0)
 .I $P($G(MONTOT),"^",5)'["Y" S DGBTDCV=DGBTDCV1
"RTN","DGBTEE",110,0)
 .;add by Pavel for patch 20
"RTN","DGBTEE",111,0)
 .I $G(DGBTCC),$G(DGBTCCREQ),'$G(DGBTMLT) S DGBTDCV=0
"RTN","DGBTEE",112,0)
 .I $G(DGBTCC),'$G(DGBTCCREQ),$G(DGBTMLT)'>0 S DGBTDCV=0
"RTN","DGBTEE",113,0)
 .I $G(DGBTCC),'$G(DGBTCCREQ),$G(DGBTME)'>0
"RTN","DGBTEE",114,0)
 .I $G(DGBTCC),'$G(DGBTCCREQ),$G(DGBTME)>0,$G(DGBTME)'>$G(DGBTMLT) S DGBTDCV=0
"RTN","DGBTEE",115,0)
 .I $G(DGBTCC),$G(DGBTCCREQ),$G(DGBTDE)'<$G(DGBTMLT) S DGBTDE=DGBTMLT
"RTN","DGBTEE",116,0)
 .I '$G(DGBTCC),'$G(DGBTCCREQ),$G(DGBTMLT)'>0 S DGBTDCV=0
"RTN","DGBTEE",117,0)
 .I '$G(DGBTCC),DGBTMLT>DGBTDPV S (DGBTDCV,DGBTDE)=DGBTDPV
"RTN","DGBTEE",118,0)
 .I ($G(CHZFLG))&($$GET1^DIQ(392,DGBTDT,9)=0)&($P($G(MONTOT),U,5)["Y") S (DGBTDCV,DGBTE)=0
"RTN","DGBTEE",119,0)
 .;dbe patch DGBT*1.0*25 - modified the next line to use the total deductible for the month, MONTOT piece 4
"RTN","DGBTEE",120,0)
 .I (+$P($G(MONTOT),U,4)<18)&((+$P($G(MONTOT),U,4)+DGBTDCV)>18)&(OWAIV'["Y")&('$G(CHZFLG)) S DGBTDCV=18-$P(MONTOT,U,4),$P(MONTOT,U,5)="NO" ; RFE 12/5/12
"RTN","DGBTEE",121,0)
 .I (+$G(CHZFLG)&(($P($G(MONTOT),U,7)+DGBTDCV)>18)) S DGBTDCV=18-$P(MONTOT,U,7),$P(MONTOT,U,5)="NO" ; RFE 12/5/12 ;*30
"RTN","DGBTEE",122,0)
 .I (+$P($G(MONTOT),U,1)>6)!(+$P($G(MONTOT),U,4)>18)!($P($G(MONTOT),U,5)["Y")&('$G(CHZFLG)) S DGBTDCV=0 ; Added ELSE RFE 12/5/12
"RTN","DGBTEE",123,0)
 .I $$DENIED(DGBTDT) S DGBTDCV=0
"RTN","DGBTEE",124,0)
 .I $G(CHZFLG)=0 S ($P(MONTOT,U,4),$P(MONTOT,U,7))=$P(MONTOT,U,4)+DGBTDCV
"RTN","DGBTEE",125,0)
 .S DGBTOTHER=$$GET1^DIQ(392,DGBTDT,43.1,"I")
"RTN","DGBTEE",126,0)
 .I $G(DGBTNSC) S DGBTDCV=0
"RTN","DGBTEE",127,0)
 .I $G(DGBTOTHER)=11 S DGBTDCV=0
"RTN","DGBTEE",128,0)
 .I $G(DGBTOTHER)=12 S DGBTDCV=0
"RTN","DGBTEE",129,0)
 .I $G(DGBTOTHER)=13 S DGBTDCV=0
"RTN","DGBTEE",130,0)
 .S XY=$S(DGBTDCV>99:"99.00",1:DGBTDCV)
"RTN","DGBTEE",131,0)
 .N FDA
"RTN","DGBTEE",132,0)
 .S FDA(392,DGBTDT_",",9)=XY ;Input transform for field 9 is set to max 99
"RTN","DGBTEE",133,0)
 .S FDA(392,DGBTDT_",",56)="M"
"RTN","DGBTEE",134,0)
 .D FILE^DIE(,"FDA")
"RTN","DGBTEE",135,0)
 .W !,"DEDUCTIBLE AMOUNT: "_DGBTDCV_"// "_XY    ;,"   ",$S($G(DGBTREF):"",1:$G(DGBTDCVX))
"RTN","DGBTEE",136,0)
 .S DGBTDCV=XY
"RTN","DGBTEE",137,0)
 .S DGBTDE=DGBTDCV
"RTN","DGBTEE",138,0)
 .I ($G(CHZFLG))&($G(ODED)'=DGBTDE)&($G(MONTOT)'="") D
"RTN","DGBTEE",139,0)
 ..S $P(MONTOT,U,4)=$P(MONTOT,U,4)+DGBTDE
"RTN","DGBTEE",140,0)
 ..S $P(MONTOT,U,4)=$P(MONTOT,U,4)-ODED
"RTN","DGBTEE",141,0)
CONT ;
"RTN","DGBTEE",142,0)
 D CONT^DGBTCE1 Q
"RTN","DGBTEE",143,0)
EXIT ;
"RTN","DGBTEE",144,0)
 K DGBTDV1,DGBTRMK Q
"RTN","DGBTEE",145,0)
  ;
"RTN","DGBTEE",146,0)
DENIED(DGBTDT) ;check for a denied claim
"RTN","DGBTEE",147,0)
 ;
"RTN","DGBTEE",148,0)
 N DENIED
"RTN","DGBTEE",149,0)
 S DENIED=$$GET1^DIQ(392,DGBTDT,45.2,"I")
"RTN","DGBTEE",150,0)
 ;
"RTN","DGBTEE",151,0)
 Q DENIED
"RTN","DGBTEE",152,0)
ADDTO(MONTOT) ;this will add the current trip to the total trips for the month.
"RTN","DGBTEE",153,0)
 ;
"RTN","DGBTEE",154,0)
 N TRIPTYP
"RTN","DGBTEE",155,0)
 I CHZFLG=1 Q MONTOT
"RTN","DGBTEE",156,0)
 I $D(^DGBT(392,DGBTDT,"M")),$P(^("M"),"^")=1 S TRIPTYP=1
"RTN","DGBTEE",157,0)
 E  S TRIPTYP=2
"RTN","DGBTEE",158,0)
 I TRIPTYP=1 S $P(MONTOT,"^",1)=$P(MONTOT,"^",1)+1
"RTN","DGBTEE",159,0)
 I TRIPTYP=2 S $P(MONTOT,"^",1)=$S($P(MONTOT,"^",1)<6:$P(MONTOT,"^",1)+1,1:$P(MONTOT,"^",1)+2)
"RTN","DGBTEE",160,0)
 ;S $P(MONTOT,"^",1)=$S(TRIPTYP=1:$P(MONTOT,"^",1)+1,1:$P(MONTOT,"^",1)+2)     ;add current trip to total for month
"RTN","DGBTEE",161,0)
 I TRIPTYP=1 S $P(MONTOT,U,2)=$P(MONTOT,U,2)+1
"RTN","DGBTEE",162,0)
 I TRIPTYP=2 S $P(MONTOT,U,3)=$P(MONTOT,U,3)+1
"RTN","DGBTEE",163,0)
 S $P(MONTOT,"^",6)=$S(TRIPTYP=1:$P(MONTOT,"^",6)+1,1:$P(MONTOT,"^",6)+2)
"RTN","DGBTEE",164,0)
 I ($P(MONTOT,U,5)'["Y")&($P(MONTOT,U)>6) S $P(MONTOT,U,5)="YES"
"RTN","DGBTEE",165,0)
 I ($P(MONTOT,U,5)'["Y")&($P(MONTOT,U,2)>18) S $P(MONTOT,U,5)="YES"
"RTN","DGBTEE",166,0)
 Q MONTOT
"RTN","DGBTEE",167,0)
 ;
"RTN","DGBTRDVW")
0^3^B9874213^B8950555
"RTN","DGBTRDVW",1,0)
DGBTRDVW ;ALB/RFE - BENEFICIARY/TRAVEL UTILITY ROUTINES;07/03/12
"RTN","DGBTRDVW",2,0)
 ;;1.0;Beneficiary Travel;**20,25,30**;September 25, 2001;Build 4
"RTN","DGBTRDVW",3,0)
 Q
"RTN","DGBTRDVW",4,0)
WAIV(DFN,DGBTDTI) ;
"RTN","DGBTRDVW",5,0)
 N %H,DED,I,TRIP,TRIPCT,RETURN,DGBTDW,EXPDT,FUTURE,FDED,WAIVER
"RTN","DGBTRDVW",6,0)
 ;Return values: total number of trips ^ number of one way trips ^ number of round trips ^ deductible (all this for the month)^ waiver y/n (y will be 1, n will be no) ^ type of waiver i.e. MAN for manual, PENSION etc. ^
"RTN","DGBTRDVW",7,0)
 ;total number of trips as of this claim date ^ deductible as of this claim date
"RTN","DGBTRDVW",8,0)
 S TRIP=$$TRIP
"RTN","DGBTRDVW",9,0)
 S WAIVER=$$WAIVYN
"RTN","DGBTRDVW",10,0)
 S RETURN=TRIP_WAIVER_U_(TRIPCT-FUTURE)_U_(DED-FDED)
"RTN","DGBTRDVW",11,0)
 Q RETURN
"RTN","DGBTRDVW",12,0)
 ;
"RTN","DGBTRDVW",13,0)
TRIP() ;
"RTN","DGBTRDVW",14,0)
 N DTRAY,I,TRIPS,TRIPTYP,MONTH,DGBTDT,ACCTYPE,DGBTEND
"RTN","DGBTRDVW",15,0)
 S (DED,TRIPCT,FUTURE,FDED)=0
"RTN","DGBTRDVW",16,0)
 F I=0:1:2 S TRIPS(I)=0
"RTN","DGBTRDVW",17,0)
 S DGBTEND=$E(DGBTDTI,1,5)+1_"00"
"RTN","DGBTRDVW",18,0)
 S (MONTH,DGBTDT)=$E(DGBTDTI,1,5)_"00"
"RTN","DGBTRDVW",19,0)
 ;F  S DGBTDT=$O(^DGBT(392,"C",DFN,DGBTDT)) Q:DGBTDT=""!(DGBTDT>DGBTDTI)  D
"RTN","DGBTRDVW",20,0)
 F  S DGBTDT=$O(^DGBT(392,"C",DFN,DGBTDT)) Q:DGBTDT=""!(DGBTDT'<DGBTEND)  D
"RTN","DGBTRDVW",21,0)
 .I (DGBTDT=DGBTDTI)&($G(CHZFLG)=0) Q
"RTN","DGBTRDVW",22,0)
 .Q:$$GET1^DIQ(392,DGBTDT,56,"I")="S"
"RTN","DGBTRDVW",23,0)
 .I $$GET1^DIQ(392,DGBTDT,45.2,"I")=1 Q
"RTN","DGBTRDVW",24,0)
 .I $D(DTRAY(DGBTDT)) Q  ;dbe patch DGBT*1*25
"RTN","DGBTRDVW",25,0)
 .S ACCTYPE=$$GET1^DIQ(392.3,$$GET1^DIQ(392,DGBTDT,6,"I"),5,"I")
"RTN","DGBTRDVW",26,0)
 .I ACCTYPE="" Q
"RTN","DGBTRDVW",27,0)
 .I 45'[ACCTYPE Q
"RTN","DGBTRDVW",28,0)
 .S DTRAY(DGBTDT)="" ;dbe patch DGBT*1*25
"RTN","DGBTRDVW",29,0)
 .S DED=DED+$$GET1^DIQ(392,DGBTDT,9)
"RTN","DGBTRDVW",30,0)
 .S TRIPTYP=+$$GET1^DIQ(392,DGBTDT,31,"I")
"RTN","DGBTRDVW",31,0)
 .S TRIPS(TRIPTYP)=TRIPS(TRIPTYP)+1
"RTN","DGBTRDVW",32,0)
 .S TRIPCT=TRIPCT+TRIPTYP
"RTN","DGBTRDVW",33,0)
 .I ($G(CHZFLG))&(DGBTDT=DGBTDTI) S FUTURE=FUTURE+TRIPTYP,FDED=FDED+$$GET1^DIQ(392,DGBTDT,9,"I") ;*30 modified check to use date/time
"RTN","DGBTRDVW",34,0)
 Q TRIPCT_U_TRIPS(1)_U_TRIPS(2)_U_DED_U
"RTN","DGBTRDVW",35,0)
WAIVYN() ;
"RTN","DGBTRDVW",36,0)
 I DED'<18 Q "1^DED^"
"RTN","DGBTRDVW",37,0)
 I TRIPCT>6 Q "1^TRIPS^"
"RTN","DGBTRDVW",38,0)
 I '$D(DGBTINCA) N DGBTINCA,DGBTERR D GA^DGBTUTL(DFN,"DGBTINCA",DGBTDTI)
"RTN","DGBTRDVW",39,0)
 I DGBTINCA Q "1^ALTINC^"
"RTN","DGBTRDVW",40,0)
 I $$MANRQ Q "1^MAN^"_EXPDT
"RTN","DGBTRDVW",41,0)
 I '$D(VAEL) N VAEL,VAERR D ELIG^VADPT
"RTN","DGBTRDVW",42,0)
 I $$PENSION Q "1^PENSION^"
"RTN","DGBTRDVW",43,0)
 ;I '$D(DGBTDEP) N DGBTDEP S DGBTDEP=$$DEP^VAFMON(DFN,DGBTDTI)
"RTN","DGBTRDVW",44,0)
 ;I '$D(DGBTNSC) N DGBTNSC S DGBTNSC=$$NSC^DGBTUTL
"RTN","DGBTRDVW",45,0)
 ;I '$D(DGBTINC) N DGBTINC S DGBTINC=$$INCOME^VAFMON(DFN,DGBTDTI,1)
"RTN","DGBTRDVW",46,0)
 ;I '$D(DGBTMTTH) N DGBTMTTH S DGBTMTTH=$$MTTH^DGBTMTTH(DGBTDEP,DGBTDTI)
"RTN","DGBTRDVW",47,0)
 ;I (DGBTNSC)&(+$TR($P(DGBTINC,U),"$,","")<DGBTRXTH) Q "1^NSC^"
"RTN","DGBTRDVW",48,0)
 ;I '(DGBTNSC)&(+$G(VAEL(3)))&(+$TR($P(DGBTINC,U),"$,","")<DGBTMTTH) Q "1^LI^"
"RTN","DGBTRDVW",49,0)
 ;I '(DGBTNSC),+$$LI^DGBTUTL(DFN,DGBTDTI,DGBTDEP,,DGBTINCA)'=0 Q "1^LI^"
"RTN","DGBTRDVW",50,0)
 Q 0_"^^"
"RTN","DGBTRDVW",51,0)
MANRQ() ; Manual waiver request
"RTN","DGBTRDVW",52,0)
 I '$D(^DGBT(392.7,"C",DFN)) Q 0_"^"
"RTN","DGBTRDVW",53,0)
 N STDT
"RTN","DGBTRDVW",54,0)
 S (DGBTDW,I)=""
"RTN","DGBTRDVW",55,0)
 F  S I=$O(^DGBT(392.7,"C",DFN,I),-1) Q:I=""  D  Q:DGBTDW'=""
"RTN","DGBTRDVW",56,0)
 .I $$GET1^DIQ(392.7,I,97,"I") Q
"RTN","DGBTRDVW",57,0)
 .S STDT=$$GET1^DIQ(392.7,I,.01,"I")
"RTN","DGBTRDVW",58,0)
 .I STDT>DGBTDTI S DGBTDW=0 Q
"RTN","DGBTRDVW",59,0)
 .S EXPDT=$$GET1^DIQ(392.7,I,8,"I")
"RTN","DGBTRDVW",60,0)
 .I EXPDT="PENSION" S DGBTDW=1 Q
"RTN","DGBTRDVW",61,0)
 .I $E(I,1,3)=$E(DGBTDTI,1,3) S DGBTDW=^DGBT(392.7,I,0) Q
"RTN","DGBTRDVW",62,0)
 .I $E(I,1,3)'=($E(DGBTA,1,3)-1) Q
"RTN","DGBTRDVW",63,0)
 .I $$GET1^DIQ(392.7,I,8,"I")<$P(DGBTDTI,".") Q
"RTN","DGBTRDVW",64,0)
 .S DGBTDW=^DGBT(392.7,I,0)
"RTN","DGBTRDVW",65,0)
 I DGBTDW="" Q 0
"RTN","DGBTRDVW",66,0)
 I $$GET1^DIQ(392.7,I,3)="NO" Q 0
"RTN","DGBTRDVW",67,0)
 I $G(EXPDT)="PENSION" Q 1
"RTN","DGBTRDVW",68,0)
 I $P(DGBTDTI,".")<$P($P(DGBTDW,U),".") Q 0
"RTN","DGBTRDVW",69,0)
 I $G(EXPDT)?7N S EXPDT=$$DTFORM^DGBT1(EXPDT)
"RTN","DGBTRDVW",70,0)
 Q DGBTDW
"RTN","DGBTRDVW",71,0)
PENSION() ;
"RTN","DGBTRDVW",72,0)
 I '$D(VAEL) N VAEL,VAERR D ELIG^VADPT
"RTN","DGBTRDVW",73,0)
 I VAEL(1)["PENSION" Q 1
"RTN","DGBTRDVW",74,0)
 I $P(VAEL(1),"^",2)="AID & ATTENDANCE" Q 1
"RTN","DGBTRDVW",75,0)
 I $P(VAEL(1),"^",2)="HOUSEBOUND" Q 1
"RTN","DGBTRDVW",76,0)
 N HIT
"RTN","DGBTRDVW",77,0)
 S (HIT,I)=""
"RTN","DGBTRDVW",78,0)
 F  S I=$O(VAEL(1,I)) Q:I=""  D  Q:HIT
"RTN","DGBTRDVW",79,0)
 .I VAEL(1,I)["PENSION" S HIT=1 Q
"RTN","DGBTRDVW",80,0)
 .I $P(VAEL(3),U,2)'=100 D  ;*30 added to prevent waiver for 100% SC
"RTN","DGBTRDVW",81,0)
 ..I $P(VAEL(1,I),"^",2)="AID & ATTENDANCE" S HIT=1 Q
"RTN","DGBTRDVW",82,0)
 ..I $P(VAEL(1,I),"^",2)="HOUSEBOUND" S HIT=1 Q
"RTN","DGBTRDVW",83,0)
 Q HIT
"VER")
8.0^22.0
"BLD",10099,6)
^31
**END**
**END**

