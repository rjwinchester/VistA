Released HL*1.6*169 SEQ #134
Extracted from mail message
**KIDS**:HL*1.6*169^

**INSTALL NAME**
HL*1.6*169
"BLD",10752,0)
HL*1.6*169^HEALTH LEVEL SEVEN^0^3171101^y
"BLD",10752,1,0)
^^2^2^3171023^
"BLD",10752,1,1,0)
This patch updates the MPI (Master Patient Index) listener to work on
"BLD",10752,1,2,0)
Linux and Unix systems.
"BLD",10752,4,0)
^9.64PA^^
"BLD",10752,6.3)
2
"BLD",10752,"KRN",0)
^9.67PA^779.2^20
"BLD",10752,"KRN",.4,0)
.4
"BLD",10752,"KRN",.401,0)
.401
"BLD",10752,"KRN",.402,0)
.402
"BLD",10752,"KRN",.403,0)
.403
"BLD",10752,"KRN",.5,0)
.5
"BLD",10752,"KRN",.84,0)
.84
"BLD",10752,"KRN",3.6,0)
3.6
"BLD",10752,"KRN",3.8,0)
3.8
"BLD",10752,"KRN",9.2,0)
9.2
"BLD",10752,"KRN",9.8,0)
9.8
"BLD",10752,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",10752,"KRN",9.8,"NM",1,0)
HLCSAS^^0^B14424102
"BLD",10752,"KRN",9.8,"NM","B","HLCSAS",1)

"BLD",10752,"KRN",19,0)
19
"BLD",10752,"KRN",19.1,0)
19.1
"BLD",10752,"KRN",101,0)
101
"BLD",10752,"KRN",409.61,0)
409.61
"BLD",10752,"KRN",771,0)
771
"BLD",10752,"KRN",779.2,0)
779.2
"BLD",10752,"KRN",870,0)
870
"BLD",10752,"KRN",8989.51,0)
8989.51
"BLD",10752,"KRN",8989.52,0)
8989.52
"BLD",10752,"KRN",8994,0)
8994
"BLD",10752,"KRN","B",.4,.4)

"BLD",10752,"KRN","B",.401,.401)

"BLD",10752,"KRN","B",.402,.402)

"BLD",10752,"KRN","B",.403,.403)

"BLD",10752,"KRN","B",.5,.5)

"BLD",10752,"KRN","B",.84,.84)

"BLD",10752,"KRN","B",3.6,3.6)

"BLD",10752,"KRN","B",3.8,3.8)

"BLD",10752,"KRN","B",9.2,9.2)

"BLD",10752,"KRN","B",9.8,9.8)

"BLD",10752,"KRN","B",19,19)

"BLD",10752,"KRN","B",19.1,19.1)

"BLD",10752,"KRN","B",101,101)

"BLD",10752,"KRN","B",409.61,409.61)

"BLD",10752,"KRN","B",771,771)

"BLD",10752,"KRN","B",779.2,779.2)

"BLD",10752,"KRN","B",870,870)

"BLD",10752,"KRN","B",8989.51,8989.51)

"BLD",10752,"KRN","B",8989.52,8989.52)

"BLD",10752,"KRN","B",8994,8994)

"BLD",10752,"QUES",0)
^9.62^^
"BLD",10752,"REQB",0)
^9.611^1^1
"BLD",10752,"REQB",1,0)
HL*1.6*120^1
"BLD",10752,"REQB","B","HL*1.6*120",1)

"MBREQ")
0
"PKG",243,-1)
1^1
"PKG",243,0)
HEALTH LEVEL SEVEN^HL^DHCP IMPLEMENTATION OF HEALTH LEVEL SEVEN
"PKG",243,20,0)
^9.402P^^
"PKG",243,22,0)
^9.49I^1^1
"PKG",243,22,1,0)
1.6^2951013^2981102^66481
"PKG",243,22,1,"PAH",1,0)
169^3171101
"PKG",243,22,1,"PAH",1,1,0)
^^2^2^3171101
"PKG",243,22,1,"PAH",1,1,1,0)
This patch updates the MPI (Master Patient Index) listener to work on
"PKG",243,22,1,"PAH",1,1,2,0)
Linux and Unix systems.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","HLCSAS")
0^1^B14424102^B12656721
"RTN","HLCSAS",1,0)
HLCSAS ;ISCSF/RWF - MPI direct connect server ;09/23/2005  14:36
"RTN","HLCSAS",2,0)
 ;;1.6;HEALTH LEVEL SEVEN;**43,89,120,169**;Oct 13,1995;Build 2
"RTN","HLCSAS",3,0)
 ;Per VA Directive 6402, this routine should not be modified.
"RTN","HLCSAS",4,0)
 Q
"RTN","HLCSAS",5,0)
 ;HLCS is used to pass data around.
"RTN","HLCSAS",6,0)
 ; 5500 is the standard VA port for the MPI_direct connect
"RTN","HLCSAS",7,0)
LISTEN ;only for OpenM
"RTN","HLCSAS",8,0)
 S $ETRAP="D ^%ZTER H"
"RTN","HLCSAS",9,0)
 D LISTEN^%ZISTCPS(5500,"ONT^HLCSAS")
"RTN","HLCSAS",10,0)
 Q
"RTN","HLCSAS",11,0)
DSM ;%=device^HLDP
"RTN","HLCSAS",12,0)
 S IO=$P(%,"^"),HLDP=$P(%,"^",2)
"RTN","HLCSAS",13,0)
 O IO:(SHARE) U IO ;Setup TCP port
"RTN","HLCSAS",14,0)
 S IO(0)="_NLA0:" O IO(0) ;Setup null device
"RTN","HLCSAS",15,0)
 D SVR
"RTN","HLCSAS",16,0)
 Q
"RTN","HLCSAS",17,0)
CACHE ;%=device^HLDP
"RTN","HLCSAS",18,0)
 S (IO,IO(0))="SYS$NET"
"RTN","HLCSAS",19,0)
 S HLDP=$ZF("GETSYM","HLDP")
"RTN","HLCSAS",20,0)
 O IO U IO:(::"-M")  ;Setup TCP port
"RTN","HLCSAS",21,0)
 S IO(0)="_NLA0:" O IO(0) ;Setup null device
"RTN","HLCSAS",22,0)
 D SVR
"RTN","HLCSAS",23,0)
 Q
"RTN","HLCSAS",24,0)
MSM ;Entry point from MSERVER
"RTN","HLCSAS",25,0)
 ;S HLDP=ien
"RTN","HLCSAS",26,0)
 S IO=56,IO(0)=46
"RTN","HLCSAS",27,0)
 O 46 ;Null device
"RTN","HLCSAS",28,0)
 D SVR C IO
"RTN","HLCSAS",29,0)
 Q
"RTN","HLCSAS",30,0)
ONT ;Cache/OpenM
"RTN","HLCSAS",31,0)
 ;S HLDP=ien
"RTN","HLCSAS",32,0)
 S IO=$I,IO(0)="//./nul"
"RTN","HLCSAS",33,0)
 O IO(0)
"RTN","HLCSAS",34,0)
 D SVR
"RTN","HLCSAS",35,0)
 Q
"RTN","HLCSAS",36,0)
 ;
"RTN","HLCSAS",37,0)
LINUX ;RRA HL*169 add entry point for LINUX
"RTN","HLCSAS",38,0)
 S HLDP=$O(^HLCS(870,"B","MPIVA DIR",0))
"RTN","HLCSAS",39,0)
 S IO=$P
"RTN","HLCSAS",40,0)
 O IO U IO:(::"-M")
"RTN","HLCSAS",41,0)
 S IO(0)="/dev/null" O IO(0) ;Setup null device
"RTN","HLCSAS",42,0)
 D SVR
"RTN","HLCSAS",43,0)
 Q
"RTN","HLCSAS",44,0)
 ; 
"RTN","HLCSAS",45,0)
SVR ;Entry point when we have a connect
"RTN","HLCSAS",46,0)
 ;See that IO=TCP device, and IO(0) is Null device and Open.
"RTN","HLCSAS",47,0)
 ;HLDP=ien of Logical Link
"RTN","HLCSAS",48,0)
 N HCSA1,HCSER,HCSEXIT,HCSCMD,HCSDAT
"RTN","HLCSAS",49,0)
 D SETUP Q:HCSER
"RTN","HLCSAS",50,0)
 N $ESTACK,$ETRAP S $ETRAP="D ^%ZTER H"
"RTN","HLCSAS",51,0)
 D UPDT^HLCSTCP(1)
"RTN","HLCSAS",52,0)
 F  D CREAD Q:HCSEXIT  D  Q:HCSEXIT
"RTN","HLCSAS",53,0)
 . I HCSCMD="" S HCSA1("TCNT")=$G(HCSA1("TCNT"))+1 S:$$STOP^HLCSTCP!(HCSA1("TCNT")>10) HCSEXIT=1 Q
"RTN","HLCSAS",54,0)
 . I HCSCMD'?4A D SEND("500 Bad CMD: "_$E(HCSCMD,1,20)) Q
"RTN","HLCSAS",55,0)
 . I $T(@HCSCMD)="" D SEND("500 ") Q
"RTN","HLCSAS",56,0)
 . S HCSA1("TCNT")=0
"RTN","HLCSAS",57,0)
 . D @HCSCMD I $G(HCSER) D TRACE("ERROR: "_HCSER)
"RTN","HLCSAS",58,0)
 . Q
"RTN","HLCSAS",59,0)
 S:HCSEXIT IO("C")=1
"RTN","HLCSAS",60,0)
 D TRACE("Exit"),UPDT^HLCSTCP(0)
"RTN","HLCSAS",61,0)
 Q
"RTN","HLCSAS",62,0)
HELO ;Process HELO
"RTN","HLCSAS",63,0)
 S HCSA1("SITE")=$P(HCSDAT," ")
"RTN","HLCSAS",64,0)
 ;Do any check on who is sending
"RTN","HLCSAS",65,0)
 D SEND("220 "_$$KSP^XUPARAM("WHERE")_" Ready for "_HCSDAT)
"RTN","HLCSAS",66,0)
 Q
"RTN","HLCSAS",67,0)
 ;
"RTN","HLCSAS",68,0)
NOOP ;
"RTN","HLCSAS",69,0)
 D SEND("250 OK")
"RTN","HLCSAS",70,0)
 Q
"RTN","HLCSAS",71,0)
 ;
"RTN","HLCSAS",72,0)
DATA ;Process DATA
"RTN","HLCSAS",73,0)
 ; The DATA cmd can pass some parameters as well, this could be passed
"RTN","HLCSAS",74,0)
 ; to the processing routine also.
"RTN","HLCSAS",75,0)
 N P,I,DUZ,HLMID,HLTIEN,HLDT
"RTN","HLCSAS",76,0)
 ;S DUZ=0,DUZ(0)="@"
"RTN","HLCSAS",77,0)
 D TRACE("Get Data")
"RTN","HLCSAS",78,0)
 S HCSA1("DATA")=HCSDAT,HCSIN=$NA(TMP("HCSI",$J)),HCSOUT=$NA(^TMP("HCSO",$J))
"RTN","HLCSAS",79,0)
 K @HCSOUT
"RTN","HLCSAS",80,0)
 D DATA^HLCSAS1(HCSIN,.HCSA1) QUIT:$G(HCSER)
"RTN","HLCSAS",81,0)
 S P="" F I=1:1 Q:'$D(HCSA1("P"_I))  S P=P_"P"_I_"="_HCSA1("P"_I)_", "
"RTN","HLCSAS",82,0)
 D TRACE("PARAM "_P)
"RTN","HLCSAS",83,0)
 ;Use the Null Device
"RTN","HLCSAS",84,0)
 U IO(0)
"RTN","HLCSAS",85,0)
 ;Now call soneone to process the data
"RTN","HLCSAS",86,0)
 I HCSA1("P1")="MPI" D ^MPIDIRQ(HCSIN,HCSOUT)
"RTN","HLCSAS",87,0)
 I HCSA1("P1")="PING" M @HCSOUT=@HCSIN
"RTN","HLCSAS",88,0)
 U IO ;Back to the TCP device
"RTN","HLCSAS",89,0)
 D LLCNT^HLCSTCP(HLDP,2)
"RTN","HLCSAS",90,0)
 Q
"RTN","HLCSAS",91,0)
TURN ;Turn and send responce
"RTN","HLCSAS",92,0)
 D SEND("220 OK")
"RTN","HLCSAS",93,0)
 D SDATA^HLCSAS1(HCSOUT,HCSA1("P1"))
"RTN","HLCSAS",94,0)
 D CREAD,TRACE("Data Sent ") ;Look for 220 ok
"RTN","HLCSAS",95,0)
 Q
"RTN","HLCSAS",96,0)
QUIT ;Process QUIT
"RTN","HLCSAS",97,0)
 D TRACE("QUIT")
"RTN","HLCSAS",98,0)
 S HCSMSG="",HCSEXIT=1
"RTN","HLCSAS",99,0)
 Q
"RTN","HLCSAS",100,0)
 ;
"RTN","HLCSAS",101,0)
CREAD ;Read a string
"RTN","HLCSAS",102,0)
 N $ETRAP S $ETRAP="S $EC="""" G CREX"
"RTN","HLCSAS",103,0)
 N I S (Y,HCSDAT,HCSCMD)="",HCSER=0
"RTN","HLCSAS",104,0)
 F I=0:1:255 R X#1:HLDREAD S:'$T HCSER=1 Q:X=$C(10)!HCSER  S Y=Y_X
"RTN","HLCSAS",105,0)
 S Y=$TR(Y,$C(13,10)),HCSCMD=$P(Y," "),HCSDAT=$P(Y," ",2,99)
"RTN","HLCSAS",106,0)
 D TRACE("Cmd Read "_Y)
"RTN","HLCSAS",107,0)
 Q
"RTN","HLCSAS",108,0)
CREX S HCSEXIT=1,HCSER="1 Error"
"RTN","HLCSAS",109,0)
 Q
"RTN","HLCSAS",110,0)
 ;
"RTN","HLCSAS",111,0)
SEND(MSG) ;Send a cmd MSG
"RTN","HLCSAS",112,0)
 N $ETRAP S $ETRAP="S $EC="""" D CREX"
"RTN","HLCSAS",113,0)
 D TRACE("Cmd Send "_MSG)
"RTN","HLCSAS",114,0)
 W MSG,$C(13,10),!
"RTN","HLCSAS",115,0)
 Q
"RTN","HLCSAS",116,0)
 ;
"RTN","HLCSAS",117,0)
SETUP ;Setup needed variables
"RTN","HLCSAS",118,0)
 K IO("C")
"RTN","HLCSAS",119,0)
 S X=$$INIT^HLCSTCP
"RTN","HLCSAS",120,0)
 I 'X D ^%ZTER S HCSER=1 Q
"RTN","HLCSAS",121,0)
 S (HCSER,HCSEXIT)=0,HCSTRACE="S: ",HCSA1("P1")="TEXT"
"RTN","HLCSAS",122,0)
 D TRACE(-1),TRACE("Server Setup")
"RTN","HLCSAS",123,0)
 Q
"RTN","HLCSAS",124,0)
 ;
"RTN","HLCSAS",125,0)
TRACE(S1) ;
"RTN","HLCSAS",126,0)
 Q
"RTN","HLCSAS",127,0)
 N H,%
"RTN","HLCSAS",128,0)
 I S1=-1 K ^TMP("HCSA",$J) Q
"RTN","HLCSAS",129,0)
 S H=$P($H,",",2),H=(H\3600)_":"_(H#3600\60)_":"_(H#60)_" "
"RTN","HLCSAS",130,0)
 L +^TMP("HCSA",$J):$G(DILOCKTM,3) S %=$G(^TMP("HCSA",$J,0))+1,^(0)=%,^(%)=H_$G(HCSTRACE)_S1 L -^TMP("HCSA",$J)
"RTN","HLCSAS",131,0)
 Q
"RTN","HLCSAS",132,0)
 ;
"VER")
8.0^22.2
"BLD",10752,6)
^134
**END**
**END**

