Released GMRA*4*60 SEQ #54
Extracted from mail message
**KIDS**:GMRA*4.0*60^

**INSTALL NAME**
GMRA*4.0*60
"BLD",11141,0)
GMRA*4.0*60^ADVERSE REACTION TRACKING^0^3190906^y
"BLD",11141,1,0)
^^1^1^3190717^
"BLD",11141,1,1,0)
IEN MISMATCH ISSUE
"BLD",11141,4,0)
^9.64PA^^
"BLD",11141,6)
4^
"BLD",11141,6.3)
13
"BLD",11141,"ABPKG")
n
"BLD",11141,"INID")
^y
"BLD",11141,"INIT")
EN^GMRA60P
"BLD",11141,"KRN",0)
^9.67PA^1.5^24
"BLD",11141,"KRN",.4,0)
.4
"BLD",11141,"KRN",.401,0)
.401
"BLD",11141,"KRN",.402,0)
.402
"BLD",11141,"KRN",.403,0)
.403
"BLD",11141,"KRN",.5,0)
.5
"BLD",11141,"KRN",.84,0)
.84
"BLD",11141,"KRN",1.5,0)
1.5
"BLD",11141,"KRN",1.6,0)
1.6
"BLD",11141,"KRN",1.61,0)
1.61
"BLD",11141,"KRN",1.62,0)
1.62
"BLD",11141,"KRN",3.6,0)
3.6
"BLD",11141,"KRN",3.8,0)
3.8
"BLD",11141,"KRN",9.2,0)
9.2
"BLD",11141,"KRN",9.8,0)
9.8
"BLD",11141,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",11141,"KRN",9.8,"NM",1,0)
GMRANKA^^0^B15740763
"BLD",11141,"KRN",9.8,"NM","B","GMRANKA",1)
 
"BLD",11141,"KRN",19,0)
19
"BLD",11141,"KRN",19.1,0)
19.1
"BLD",11141,"KRN",101,0)
101
"BLD",11141,"KRN",409.61,0)
409.61
"BLD",11141,"KRN",771,0)
771
"BLD",11141,"KRN",779.2,0)
779.2
"BLD",11141,"KRN",870,0)
870
"BLD",11141,"KRN",8989.51,0)
8989.51
"BLD",11141,"KRN",8989.52,0)
8989.52
"BLD",11141,"KRN",8994,0)
8994
"BLD",11141,"KRN","B",.4,.4)
 
"BLD",11141,"KRN","B",.401,.401)
 
"BLD",11141,"KRN","B",.402,.402)
 
"BLD",11141,"KRN","B",.403,.403)
 
"BLD",11141,"KRN","B",.5,.5)
 
"BLD",11141,"KRN","B",.84,.84)
 
"BLD",11141,"KRN","B",1.5,1.5)
 
"BLD",11141,"KRN","B",1.6,1.6)
 
"BLD",11141,"KRN","B",1.61,1.61)
 
"BLD",11141,"KRN","B",1.62,1.62)
 
"BLD",11141,"KRN","B",3.6,3.6)
 
"BLD",11141,"KRN","B",3.8,3.8)
 
"BLD",11141,"KRN","B",9.2,9.2)
 
"BLD",11141,"KRN","B",9.8,9.8)
 
"BLD",11141,"KRN","B",19,19)
 
"BLD",11141,"KRN","B",19.1,19.1)
 
"BLD",11141,"KRN","B",101,101)
 
"BLD",11141,"KRN","B",409.61,409.61)
 
"BLD",11141,"KRN","B",771,771)
 
"BLD",11141,"KRN","B",779.2,779.2)
 
"BLD",11141,"KRN","B",870,870)
 
"BLD",11141,"KRN","B",8989.51,8989.51)
 
"BLD",11141,"KRN","B",8989.52,8989.52)
 
"BLD",11141,"KRN","B",8994,8994)
 
"BLD",11141,"QDEF")
^^^^NO^^^^NO^^NO
"BLD",11141,"QUES",0)
^9.62^^
"BLD",11141,"REQB",0)
^9.611^1^1
"BLD",11141,"REQB",1,0)
GMRA*4.0*54^1
"BLD",11141,"REQB","B","GMRA*4.0*54",1)
 
"INIT")
EN^GMRA60P
"MBREQ")
0
"PKG",392,-1)
1^1
"PKG",392,0)
ADVERSE REACTION TRACKING^GMRA^Adverse Reaction Tracking package
"PKG",392,22,0)
^9.49I^1^1
"PKG",392,22,1,0)
4.0^2960328^2960801^1
"PKG",392,22,1,"PAH",1,0)
60^3190906^520824656
"PKG",392,22,1,"PAH",1,1,0)
^^1^1^3190906
"PKG",392,22,1,"PAH",1,1,1,0)
IEN MISMATCH ISSUE
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")
 
"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
2
"RTN","GMRA60P")
0^^B9945950^n/a
"RTN","GMRA60P",1,0)
GMRA60P ;BP/KAM - ALLERGY/ADVERSE REACTION PATCH GMRA*4.0*60 POST-INSTALL ; 7/12/19 2:26pm
"RTN","GMRA60P",2,0)
 ;;4.0;Adverse Reaction Tracking;**60**;Mar 29, 1996;Build 13
"RTN","GMRA60P",3,0)
 ; Post Install routine to review the 120.86 file for mismatches
"RTN","GMRA60P",4,0)
 ; between the Record IEN and the .01 Field and email the results
"RTN","GMRA60P",5,0)
 ; to the installer and holders of the GMRA-ALLERGY VERIFY and
"RTN","GMRA60P",6,0)
 ; GMRA-SUPERVISOR keys
"RTN","GMRA60P",7,0)
 Q 
"RTN","GMRA60P",8,0)
EN ; Compare file IEN and .01 Field for mismatches
"RTN","GMRA60P",9,0)
 N GMRAIEN,GMRAFLD1,CNT,FOUND,XMY,XMDUZ,XMSUB,XMTEXT,DIFROM,MSG
"RTN","GMRA60P",10,0)
 S GMRAFLD1=0,CNT=15,FOUND=0
"RTN","GMRA60P",11,0)
 D EMAILHDR
"RTN","GMRA60P",12,0)
 F  S GMRAFLD1=$O(^GMR(120.86,"B",GMRAFLD1)) Q:GMRAFLD1=""  D
"RTN","GMRA60P",13,0)
 . S GMRAIEN=0
"RTN","GMRA60P",14,0)
 . F  S GMRAIEN=$O(^GMR(120.86,"B",GMRAFLD1,GMRAIEN)) Q:GMRAIEN=""  D
"RTN","GMRA60P",15,0)
 .. I GMRAFLD1'=GMRAIEN S FOUND=1 D EMAILDET
"RTN","GMRA60P",16,0)
 I 'FOUND D EMAILNF
"RTN","GMRA60P",17,0)
 D EMAILSND
"RTN","GMRA60P",18,0)
 K GMRAIEN,GMRAFLD1,CNT,FOUND
"RTN","GMRA60P",19,0)
 Q
"RTN","GMRA60P",20,0)
EMAILHDR ; Send email to Installer denoting any mismatches between Field 1 and the record subscript.
"RTN","GMRA60P",21,0)
 S XMSUB="GMRA*4.0*60 - ADVERSE REACTION ASSESSMENT file Mismatch Check"
"RTN","GMRA60P",22,0)
 S XMDUZ="Patch GMRA*4.0*60"
"RTN","GMRA60P",23,0)
 S XMY(DUZ)="" ; Installer as recipient
"RTN","GMRA60P",24,0)
 D CHKKEYS
"RTN","GMRA60P",25,0)
 S MSG($J,"GMRA60P",1)="This email has been generated by a post-"
"RTN","GMRA60P",26,0)
 S MSG($J,"GMRA60P",2)="install routine from patch GMRA*4.0*60"
"RTN","GMRA60P",27,0)
 S MSG($J,"GMRA60P",3)="for the purpose of alerting the installer to"
"RTN","GMRA60P",28,0)
 S MSG($J,"GMRA60P",4)="mismatches between the IEN and the NAME (#.01) field"
"RTN","GMRA60P",29,0)
 S MSG($J,"GMRA60P",5)="in the ADVERSE REACTION ASSESSMENT (#120.86) file."
"RTN","GMRA60P",30,0)
 S MSG($J,"GMRA60P",6)="     "
"RTN","GMRA60P",31,0)
 S MSG($J,"GMRA60P",7)="This email is also being delivered to holders of"
"RTN","GMRA60P",32,0)
 S MSG($J,"GMRA60P",8)="the GMRA-ALLERGY VERIFY and GMRA-SUPERVISOR keys"
"RTN","GMRA60P",33,0)
 S MSG($J,"GMRA60P",9)="for informational purposes only."
"RTN","GMRA60P",34,0)
 S MSG($J,"GMRA60P",10)="     "
"RTN","GMRA60P",35,0)
 S MSG($J,"GMRA60P",11)="These records need to be reviewed for deletion via FileMan."
"RTN","GMRA60P",36,0)
 S MSG($J,"GMRA60P",12)="Please review the Patch Description for GMRA*4.0*60 for additional details."
"RTN","GMRA60P",37,0)
 S MSG($J,"GMRA60P",13)="     "
"RTN","GMRA60P",38,0)
 S MSG($J,"GMRA60P",14)="Record Number (IEN)"_"        "_"NAME(#.01) field"
"RTN","GMRA60P",39,0)
 S MSG($J,"GMRA60P",15)="     "
"RTN","GMRA60P",40,0)
 Q
"RTN","GMRA60P",41,0)
EMAILDET ;
"RTN","GMRA60P",42,0)
 S CNT=CNT+1
"RTN","GMRA60P",43,0)
 S MSG($J,"GMRA60P",CNT)="     "_$G(GMRAIEN)_"                "_$G(GMRAFLD1)
"RTN","GMRA60P",44,0)
 Q
"RTN","GMRA60P",45,0)
EMAILNF ;
"RTN","GMRA60P",46,0)
 S MSG($J,"GMRA60P",16)="No mismatches found."
"RTN","GMRA60P",47,0)
 Q
"RTN","GMRA60P",48,0)
EMAILSND ;
"RTN","GMRA60P",49,0)
 S XMTEXT="MSG($J,""GMRA60P"","
"RTN","GMRA60P",50,0)
 D ^XMD
"RTN","GMRA60P",51,0)
 K MSG($J,"GMRA60P"),XMY,XMDUZ,XMSUB,XMTEXT
"RTN","GMRA60P",52,0)
 Q
"RTN","GMRA60P",53,0)
CHKKEYS ; Check to see who holds the GMRA-ALLERGY VERIFY and/or the
"RTN","GMRA60P",54,0)
 ; GMRA-SUPERVISOR keys and add to the XMY array as an email recipient
"RTN","GMRA60P",55,0)
 N VAIEN,ZEROREC,KEY1,KEY2
"RTN","GMRA60P",56,0)
 S KEY1="",KEY1=$O(^DIC(19.1,"B","GMRA-ALLERGY VERIFY",KEY1))
"RTN","GMRA60P",57,0)
 S KEY2="",KEY2=$O(^DIC(19.1,"B","GMRA-SUPERVISOR",KEY2))
"RTN","GMRA60P",58,0)
 S VAIEN=0
"RTN","GMRA60P",59,0)
 F  S VAIEN=$O(^VA(200,VAIEN)) Q:VAIEN=""  D
"RTN","GMRA60P",60,0)
 . S ZEROREC=$G(^VA(200,VAIEN,0))
"RTN","GMRA60P",61,0)
 . I $P(ZEROREC,"^",7)=1 Q  ; Disusered (no email)
"RTN","GMRA60P",62,0)
 . I $P(ZEROREC,"^",11)'="" Q  ;Termination Date Found (no email)
"RTN","GMRA60P",63,0)
 . ; Check for keys (GMRA-ALLERGY VERIFY/GMRA-SUPERVISOR)
"RTN","GMRA60P",64,0)
 . I ($D(^VA(200,VAIEN,51,KEY1)))!($D(^VA(200,VAIEN,51,KEY2))) D
"RTN","GMRA60P",65,0)
 .. S XMY(VAIEN)=""
"RTN","GMRA60P",66,0)
 Q
"RTN","GMRANKA")
0^1^B15740763^B15183005
"RTN","GMRANKA",1,0)
GMRANKA ;HIRMFO/WAA - ALLERGY/ADVERSE REACTION PATIENT NKA DRIVE ;04/13/2017  13:21
"RTN","GMRANKA",2,0)
 ;;4.0;Adverse Reaction Tracking;**2,21,36,48,54,60**;Mar 29, 1996;Build 13
"RTN","GMRANKA",3,0)
NKA(DFN) ;See if patient has reaction on file
"RTN","GMRANKA",4,0)
 ;  Input Variables:
"RTN","GMRANKA",5,0)
 ;       DFN = Patient Internal Entry Number
"RTN","GMRANKA",6,0)
 ;
"RTN","GMRANKA",7,0)
 ;  Output Variables:
"RTN","GMRANKA",8,0)
 ;       GMA = 1 Patient has known reaction
"RTN","GMRANKA",9,0)
 ;             0 Patient has No known reaction
"RTN","GMRANKA",10,0)
 ;             Null Patient has never been asked about reaction
"RTN","GMRANKA",11,0)
 N GMRAIEN
"RTN","GMRANKA",12,0)
 S GMA="",GMRAIEN=+$O(^GMR(120.86,"B",DFN,0))
"RTN","GMRANKA",13,0)
 S:GMRAIEN>0 GMA=$P($G(^GMR(120.86,GMRAIEN,0)),U,2)
"RTN","GMRANKA",14,0)
 Q GMA
"RTN","GMRANKA",15,0)
 ;
"RTN","GMRANKA",16,0)
NKAASK(DFN,GMRAOUT) ; Ask a Patient if patient has any known allergens
"RTN","GMRANKA",17,0)
 ;  Input Variables
"RTN","GMRANKA",18,0)
 ;     DFN = Patient Internal entry number
"RTN","GMRANKA",19,0)
 ;  GMRAOUT = Up Caret or time out flag
"RTN","GMRANKA",20,0)
 ;
"RTN","GMRANKA",21,0)
 ;Ask if patient has allergies
"RTN","GMRANKA",22,0)
 N DIR,Y,DIROUT,DTOUT,DIRUT,DUOUT,GMAOLD,GMRAIEN
"RTN","GMRANKA",23,0)
 S GMRAIEN=+$O(^GMR(120.86,"B",DFN,0))
"RTN","GMRANKA",24,0)
 S GMAOLD=$S(GMRAIEN>0:$P($G(^GMR(120.86,GMRAIEN,0)),U,2),1:"")
"RTN","GMRANKA",25,0)
 S DIR(0)="120.86,1^AO^I Y=0&'$$NKASCR^GMRANKA(DFN) D INFO^GMRANKA K X"
"RTN","GMRANKA",26,0)
 S DIR("A")="Does this patient have any known allergies or adverse reactions? "
"RTN","GMRANKA",27,0)
 S DIR("B")=$S(GMAOLD=1:"Yes",GMAOLD=0:"No",1:"") K:DIR("B")="" DIR("B")
"RTN","GMRANKA",28,0)
 S DIR("?")=$S(GMAOLD=0:"You may also enter @ to delete a previous NKA assessment and return the patient to a 'not assessed' state.  Use this if the NKA assessment was previously incorrectly entered.",1:"") ;21
"RTN","GMRANKA",29,0)
 D ^DIR
"RTN","GMRANKA",30,0)
 I $G(X)="@" D:GMAOLD=0 CLN W:GMAOLD=0 !,"Assessment deleted." Q  ;21 Allow removal of NKA
"RTN","GMRANKA",31,0)
 I $D(DTOUT)!$D(DIROUT) S GMRAOUT=1 Q  ;36
"RTN","GMRANKA",32,0)
 I $D(DUOUT) S GMRAOUT=2 Q  ;36
"RTN","GMRANKA",33,0)
 ; P60 update GMRAIEN,GMAOLD as record may have been added durring read
"RTN","GMRANKA",34,0)
 S GMRAIEN=+$O(^GMR(120.86,"B",DFN,0))
"RTN","GMRANKA",35,0)
 S GMAOLD=$S(GMRAIEN>0:$P($G(^GMR(120.86,GMRAIEN,0)),U,2),1:"")
"RTN","GMRANKA",36,0)
 ; User Hits return and doesn't answer question
"RTN","GMRANKA",37,0)
 I Y="",GMAOLD="" Q  ;36
"RTN","GMRANKA",38,0)
 I Y'="",GMAOLD'=Y D
"RTN","GMRANKA",39,0)
 . N DIE,DA,DR,DO,DIC,X,DINUM
"RTN","GMRANKA",40,0)
 . I 'GMRAIEN D
"RTN","GMRANKA",41,0)
 . . S DIC="^GMR(120.86,",DIC(0)="",X=DFN,DIC("DR")="1////"_Y_";2////"_DUZ_";3///NOW"
"RTN","GMRANKA",42,0)
 . . S DA=DFN,DINUM=DFN
"RTN","GMRANKA",43,0)
 . . D FILE^DICN
"RTN","GMRANKA",44,0)
 . I GMRAIEN>0 D
"RTN","GMRANKA",45,0)
 . . S DIE="^GMR(120.86,",DA=GMRAIEN,DR=$S(GMAOLD=""&($P($G(^GMR(120.86,GMRAIEN,0)),"^")'=GMRAIEN):(".01////"_DFN_";"),1:"")_"1////"_Y_";2////"_DUZ_";3///NOW" ;36,54
"RTN","GMRANKA",46,0)
 . . D ^DIE
"RTN","GMRANKA",47,0)
 . Q
"RTN","GMRANKA",48,0)
 Q
"RTN","GMRANKA",49,0)
CLN ; Clean out entries that have not been answered.
"RTN","GMRANKA",50,0)
 S DIK="^GMR(120.86,",DA=$S($G(GMRAIEN)>0:GMRAIEN,1:DFN) D ^DIK K DIK,DA
"RTN","GMRANKA",51,0)
 Q
"RTN","GMRANKA",52,0)
INFO ; Info string
"RTN","GMRANKA",53,0)
 N GMASTR
"RTN","GMRANKA",54,0)
 S GMASTR(1)="Currently this patient has Causative Agents on file."
"RTN","GMRANKA",55,0)
 S GMASTR(2)="You will have to answer YES to this question and then"
"RTN","GMRANKA",56,0)
 S GMASTR(3)="indicate that each of the Causative Agents are incorrect."
"RTN","GMRANKA",57,0)
 S GMASTR(4)="Then you will be reasked this question and will be able"
"RTN","GMRANKA",58,0)
 S GMASTR(5)="to enter NO."
"RTN","GMRANKA",59,0)
 D WRITE^GMRADSP8(1,0,$C(7))
"RTN","GMRANKA",60,0)
 D WRITE^GMRADSP8(1,10,.GMASTR)
"RTN","GMRANKA",61,0)
 Q
"RTN","GMRANKA",62,0)
NKASCR(DFN) ; Is Patient NKA (No Known Allergy)
"RTN","GMRANKA",63,0)
 ;   Input Variable:
"RTN","GMRANKA",64,0)
 ;        DFN = Patient DFN in Patient file
"RTN","GMRANKA",65,0)
 ;
"RTN","GMRANKA",66,0)
 ;  Output Variable:
"RTN","GMRANKA",67,0)
 ;        GMA = 1 Patient is True NKA
"RTN","GMRANKA",68,0)
 ;            = 0 Patient has a reaction in file 120.8
"RTN","GMRANKA",69,0)
 ;
"RTN","GMRANKA",70,0)
 ; This code will screen out Entered in Error entries
"RTN","GMRANKA",71,0)
 S GMA=1
"RTN","GMRANKA",72,0)
 N GMAX
"RTN","GMRANKA",73,0)
 S GMAX=0
"RTN","GMRANKA",74,0)
 F  S GMAX=$O(^GMR(120.8,"B",DFN,GMAX)) Q:GMAX<1  D  Q:'GMA
"RTN","GMRANKA",75,0)
 .I +$G(^GMR(120.8,GMAX,"ER")) Q
"RTN","GMRANKA",76,0)
 .S GMA=0
"RTN","GMRANKA",77,0)
 .Q
"RTN","GMRANKA",78,0)
 Q GMA
"RTN","GMRANKA",79,0)
 ;
"RTN","GMRANKA",80,0)
DELNKA ;Remove assessment of NKA for a selected patient
"RTN","GMRANKA",81,0)
 N Y,DFN,DIR,DIC
"RTN","GMRANKA",82,0)
 S DIC=120.86,DIC(0)="AEMQZ",DIC("A")="Select PATIENT NAME: " D ^DIC Q:Y=-1
"RTN","GMRANKA",83,0)
 S DFN=+Y
"RTN","GMRANKA",84,0)
 W !
"RTN","GMRANKA",85,0)
 I $$NKA^GMRANKA(DFN)'=0 W !,"This patient doesn't currently have an assessment of NKA." Q
"RTN","GMRANKA",86,0)
 S DIR(0)="Y",DIR("A")="Delete NKA assessment for patient "_$G(Y(0,0)),DIR("B")="NO"
"RTN","GMRANKA",87,0)
 S DIR("?")="Enter Y to delete the NKA assessment and return the patient to a 'not assessed' status.  Enter N to cancel this action."
"RTN","GMRANKA",88,0)
 D ^DIR
"RTN","GMRANKA",89,0)
 I Y=1 D CLN^GMRANKA W "...Done"
"RTN","GMRANKA",90,0)
 Q
"VER")
8.0^22.2
"BLD",11141,6)
^54
**END**
**END**

