Released GMRA*4*49 SEQ #48
Extracted from mail message
**KIDS**:GMRA*4.0*49^

**INSTALL NAME**
GMRA*4.0*49
"BLD",10171,0)
GMRA*4.0*49^ADVERSE REACTION TRACKING^0^3160509^y
"BLD",10171,1,0)
^^7^7^3160424^
"BLD",10171,1,1,0)
Patch GMRA*4.0*49 addresses the following two issues:
"BLD",10171,1,2,0)
 
"BLD",10171,1,3,0)
1. Excessive number of entries in the PATIENT ALLERGIES file (#120.8)
"BLD",10171,1,4,0)
   causes issues with the allergy HL7 messages.
"BLD",10171,1,5,0)
 
"BLD",10171,1,6,0)
2. Embedded carriage returns in some old allergy HL7 messages prevented 
"BLD",10171,1,7,0)
   the messages from being sent.
"BLD",10171,4,0)
^9.64PA^^
"BLD",10171,6.3)
2
"BLD",10171,"INID")
^n
"BLD",10171,"INIT")
EN^GMRAPS49
"BLD",10171,"KRN",0)
^9.67PA^779.2^20
"BLD",10171,"KRN",.4,0)
.4
"BLD",10171,"KRN",.401,0)
.401
"BLD",10171,"KRN",.402,0)
.402
"BLD",10171,"KRN",.403,0)
.403
"BLD",10171,"KRN",.5,0)
.5
"BLD",10171,"KRN",.84,0)
.84
"BLD",10171,"KRN",3.6,0)
3.6
"BLD",10171,"KRN",3.8,0)
3.8
"BLD",10171,"KRN",9.2,0)
9.2
"BLD",10171,"KRN",9.8,0)
9.8
"BLD",10171,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",10171,"KRN",9.8,"NM",1,0)
GMRAMCU0^^0^B2241480
"BLD",10171,"KRN",9.8,"NM","B","GMRAMCU0",1)

"BLD",10171,"KRN",19,0)
19
"BLD",10171,"KRN",19,"NM",0)
^9.68A^^
"BLD",10171,"KRN",19.1,0)
19.1
"BLD",10171,"KRN",101,0)
101
"BLD",10171,"KRN",409.61,0)
409.61
"BLD",10171,"KRN",771,0)
771
"BLD",10171,"KRN",779.2,0)
779.2
"BLD",10171,"KRN",870,0)
870
"BLD",10171,"KRN",8989.51,0)
8989.51
"BLD",10171,"KRN",8989.52,0)
8989.52
"BLD",10171,"KRN",8994,0)
8994
"BLD",10171,"KRN","B",.4,.4)

"BLD",10171,"KRN","B",.401,.401)

"BLD",10171,"KRN","B",.402,.402)

"BLD",10171,"KRN","B",.403,.403)

"BLD",10171,"KRN","B",.5,.5)

"BLD",10171,"KRN","B",.84,.84)

"BLD",10171,"KRN","B",3.6,3.6)

"BLD",10171,"KRN","B",3.8,3.8)

"BLD",10171,"KRN","B",9.2,9.2)

"BLD",10171,"KRN","B",9.8,9.8)

"BLD",10171,"KRN","B",19,19)

"BLD",10171,"KRN","B",19.1,19.1)

"BLD",10171,"KRN","B",101,101)

"BLD",10171,"KRN","B",409.61,409.61)

"BLD",10171,"KRN","B",771,771)

"BLD",10171,"KRN","B",779.2,779.2)

"BLD",10171,"KRN","B",870,870)

"BLD",10171,"KRN","B",8989.51,8989.51)

"BLD",10171,"KRN","B",8989.52,8989.52)

"BLD",10171,"KRN","B",8994,8994)

"BLD",10171,"QDEF")
^^^^NO^^^^NO^^YES
"BLD",10171,"QUES",0)
^9.62^^
"BLD",10171,"REQB",0)
^9.611^1^1
"BLD",10171,"REQB",1,0)
GMRA*4.0*34^2
"BLD",10171,"REQB","B","GMRA*4.0*34",1)

"INIT")
EN^GMRAPS49
"MBREQ")
0
"PKG",478,-1)
1^1
"PKG",478,0)
ADVERSE REACTION TRACKING^GMRA^Adverse Reaction Tracking package
"PKG",478,20,0)
^9.402P^2^1
"PKG",478,20,2,0)
2^^GMRAMRG
"PKG",478,20,2,1)

"PKG",478,20,"B",2,2)

"PKG",478,22,0)
^9.49I^1^1
"PKG",478,22,1,0)
4.0^2960328
"PKG",478,22,1,"PAH",1,0)
49^3160509
"PKG",478,22,1,"PAH",1,1,0)
^^7^7^3160509
"PKG",478,22,1,"PAH",1,1,1,0)
Patch GMRA*4.0*49 addresses the following two issues:
"PKG",478,22,1,"PAH",1,1,2,0)
 
"PKG",478,22,1,"PAH",1,1,3,0)
1. Excessive number of entries in the PATIENT ALLERGIES file (#120.8)
"PKG",478,22,1,"PAH",1,1,4,0)
   causes issues with the allergy HL7 messages.
"PKG",478,22,1,"PAH",1,1,5,0)
 
"PKG",478,22,1,"PAH",1,1,6,0)
2. Embedded carriage returns in some old allergy HL7 messages prevented 
"PKG",478,22,1,"PAH",1,1,7,0)
   the messages from being sent.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
2
"RTN","GMRAMCU0")
0^1^B2241480^B1907266
"RTN","GMRAMCU0",1,0)
GMRAMCU0 ;HIRMFO/WAA-ID BAND/CHART MARKING UTILITIES ; 7/30/15
"RTN","GMRAMCU0",2,0)
 ;;4.0;Adverse Reaction Tracking;**49**;Mar 29, 1996;Build 2
"RTN","GMRAMCU0",3,0)
 ;
"RTN","GMRAMCU0",4,0)
IDBAND(DFN,DATE,USR) ; This program will mark all the ID Band fields for
"RTN","GMRAMCU0",5,0)
 ; all reactions for a patient
"RTN","GMRAMCU0",6,0)
 ;
"RTN","GMRAMCU0",7,0)
 ; INPUT
"RTN","GMRAMCU0",8,0)
 ;         DFN = IEN for a patient in file 2 (Required)
"RTN","GMRAMCU0",9,0)
 ;        DATE = Date of marking in File Manager format (optional-
"RTN","GMRAMCU0",10,0)
 ;               if undefined or null current date/time will be used).
"RTN","GMRAMCU0",11,0)
 ;         USR = User Marking the ID band (optional- if undefined null
"RTN","GMRAMCU0",12,0)
 ;               will be used indicating data automatically entered).
"RTN","GMRAMCU0",13,0)
 ;
"RTN","GMRAMCU0",14,0)
 N GMRADT,GMRAPA,GMRAUSR,GMRASITE
"RTN","GMRAMCU0",15,0)
 S GMRADT=$G(DATE),GMRAUSR=$G(USR)
"RTN","GMRAMCU0",16,0)
 I GMRADT="" S GMRADT=$$HTFM^XLFDT($H)
"RTN","GMRAMCU0",17,0)
 S X=GMRADT,%DT="TS" D ^%DT S GMRADT=Y
"RTN","GMRAMCU0",18,0)
 D SITE^GMRAUTL S GMRASITE(0)=$G(^GMRD(120.84,+GMRASITE,0)) ;49
"RTN","GMRAMCU0",19,0)
 I $P(GMRASITE(0),U,5)=0 Q  ;49
"RTN","GMRAMCU0",20,0)
 Q:$G(DFN)<1!(GMRADT<0)!(GMRAUSR'=""&(GMRAUSR'>0))
"RTN","GMRAMCU0",21,0)
 S GMRAPA=0 F  S GMRAPA=$O(^GMR(120.8,"B",DFN,GMRAPA)) Q:GMRAPA<1  D
"RTN","GMRAMCU0",22,0)
 .Q:$P($G(^GMR(120.8,GMRAPA,0)),U,2)=""!+$G(^GMR(120.8,GMRAPA,"ER"))
"RTN","GMRAMCU0",23,0)
 .N DA,DD,DO,DIC,DIE,DINUM,DR
"RTN","GMRAMCU0",24,0)
 .S DIC="^GMR(120.8,"_GMRAPA_",14,",DIC(0)="L",DIC("P")="120.814DA",DLAYGO=120.8,DA(1)=GMRAPA,X=GMRADT D FILE^DICN K DA,DIC
"RTN","GMRAMCU0",25,0)
 .I Y>0,GMRAUSR'="" D
"RTN","GMRAMCU0",26,0)
 ..S DA(1)=GMRAPA,DA=+Y,DIE="^GMR(120.8,"_DA(1)_",14,",DR="1////"_GMRAUSR
"RTN","GMRAMCU0",27,0)
 ..D ^DIE
"RTN","GMRAMCU0",28,0)
 ..Q
"RTN","GMRAMCU0",29,0)
 .Q
"RTN","GMRAMCU0",30,0)
 Q
"RTN","GMRAPS49")
0^^B33101236^n/a
"RTN","GMRAPS49",1,0)
GMRAPS49 ;BPOIFO/HW - Patient Allergies with comments containing carriage returns; 5/05/16 3:42pm
"RTN","GMRAPS49",2,0)
 ;;4.0;Adverse Reaction Tracking;**49**;Mar 29, 1996;Build 2
"RTN","GMRAPS49",3,0)
 ;
"RTN","GMRAPS49",4,0)
 ;      This routine uses the following IAs:
"RTN","GMRAPS49",5,0)
 ;      #10061 - DEM^VADPT         (supported)
"RTN","GMRAPS49",6,0)
 ;      #10070 - ^XMD              (supported)
"RTN","GMRAPS49",7,0)
 ;      #4440  - PROD^XUPROD       (supported)
"RTN","GMRAPS49",8,0)
 ;      #10112 - SITE^VASITE       (supported)
"RTN","GMRAPS49",9,0)
 Q  ;Must be called at entry point
"RTN","GMRAPS49",10,0)
EN N GMRAIEN,DFN,GMRTOTAL,DIFROM
"RTN","GMRAPS49",11,0)
 K ^TMP("GMRA",$J)
"RTN","GMRAPS49",12,0)
 S GMRAIEN=0,GMRTOTAL=0
"RTN","GMRAPS49",13,0)
 D BMES^XPDUTL("   PATIENT ALLERGY RECORDS WITH CARRIAGE RETURNS IN COMMENTS")
"RTN","GMRAPS49",14,0)
 D MES^XPDUTL("          (CARRIAGE RETURNS REMOVED BY THIS PATCH)")
"RTN","GMRAPS49",15,0)
 D BMES^XPDUTL("                                                                       ")
"RTN","GMRAPS49",16,0)
 D BMES^XPDUTL("DFN         Patient Allergy IEN   Reactant                               ")
"RTN","GMRAPS49",17,0)
 D MES^XPDUTL("                                                                       ")
"RTN","GMRAPS49",18,0)
 S ^TMP("GMRA",$J,1)="        ****ATTENTION Pharmacy Manager or ADPAC****"
"RTN","GMRAPS49",19,0)
 S ^TMP("GMRA",$J,2)="                                                   "
"RTN","GMRAPS49",20,0)
 S ^TMP("GMRA",$J,3)="Please review the records in this report/mail message and edit these patient "
"RTN","GMRAPS49",21,0)
 S ^TMP("GMRA",$J,4)="allergy records to trigger a new HL7 message to HDR. Use the GMRA PATIENT "
"RTN","GMRAPS49",22,0)
 S ^TMP("GMRA",$J,5)="A/AR EDIT [Enter/Edit Patient Reaction Data] option to select the affected "
"RTN","GMRAPS49",23,0)
 S ^TMP("GMRA",$J,6)="records. You will need the GMRA-ALLERGY VERIFY key to complete this action:"
"RTN","GMRAPS49",24,0)
 S ^TMP("GMRA",$J,7)="  "
"RTN","GMRAPS49",25,0)
 S ^TMP("GMRA",$J,8)="    Select PATIENT NAME:`(enter the grave accent followed by a DFN from report"
"RTN","GMRAPS49",26,0)
 S ^TMP("GMRA",$J,9)="    below)"
"RTN","GMRAPS49",27,0)
 S ^TMP("GMRA",$J,10)="        (List of reactants displays here)"
"RTN","GMRAPS49",28,0)
 S ^TMP("GMRA",$J,11)="    Enter Causative Agent: (enter corresponding Reactant from report below)"
"RTN","GMRAPS49",29,0)
 S ^TMP("GMRA",$J,12)="        (Allergy Information displays here)"
"RTN","GMRAPS49",30,0)
 S ^TMP("GMRA",$J,13)="    Is the reaction information correct? Yes//   (Yes)"
"RTN","GMRAPS49",31,0)
 S ^TMP("GMRA",$J,14)="    DO YOU WISH TO EDIT VERIFIED DATA? NO// YES"
"RTN","GMRAPS49",32,0)
 S ^TMP("GMRA",$J,15)="        (Allergy Data displays here)"
"RTN","GMRAPS49",33,0)
 S ^TMP("GMRA",$J,16)="    Would you like to edit any of this data? YES"
"RTN","GMRAPS49",34,0)
 S ^TMP("GMRA",$J,17)="  "
"RTN","GMRAPS49",35,0)
 S ^TMP("GMRA",$J,18)="Then accept all existing values. When asked again ""Would you like to edit any"
"RTN","GMRAPS49",36,0)
 S ^TMP("GMRA",$J,19)="of this data?"" respond ""NO"" to end the correction process. This will update"
"RTN","GMRAPS49",37,0)
 S ^TMP("GMRA",$J,20)="the data in HDR. When completed please notify Pharmacy Benefits Management"
"RTN","GMRAPS49",38,0)
 S ^TMP("GMRA",$J,21)="Services by replying to this message (send to Silverman.Robert@FORUM.DOMAIN.EXT)."
"RTN","GMRAPS49",39,0)
 S ^TMP("GMRA",$J,22)="Please include your site information in the message. "
"RTN","GMRAPS49",40,0)
 S ^TMP("GMRA",$J,23)="                                                   "
"RTN","GMRAPS49",41,0)
 S ^TMP("GMRA",$J,24)="  PATIENT ALLERGY RECORDS WITH CARRIAGE RETURNS IN COMMENTS"
"RTN","GMRAPS49",42,0)
 S ^TMP("GMRA",$J,25)="       (CARRIAGE RETURNS REMOVED BY PATCH GMRA*4.0*49)      "
"RTN","GMRAPS49",43,0)
 S ^TMP("GMRA",$J,26)="                                                   "
"RTN","GMRAPS49",44,0)
 S ^TMP("GMRA",$J,27)="DFN"_"         Patient Allergy IEN"_"   Reactant   "
"RTN","GMRAPS49",45,0)
 D FIND(.GMRTOTAL)
"RTN","GMRAPS49",46,0)
 S GMRASITE=$$SITE^VASITE
"RTN","GMRAPS49",47,0)
 S GMRASTNM=$P($G(GMRASITE),"^",2)
"RTN","GMRAPS49",48,0)
 S GMRASTN=$P($G(GMRASITE),"^",3)
"RTN","GMRAPS49",49,0)
 I GMRTOTAL'<1 D
"RTN","GMRAPS49",50,0)
 .S GMRAGLNR=GMRTOTAL+31
"RTN","GMRAPS49",51,0)
 .S ^TMP("GMRA",$J,GMRAGLNR)="  "
"RTN","GMRAPS49",52,0)
 .S ^TMP("GMRA",$J,GMRAGLNR+1)="  "
"RTN","GMRAPS49",53,0)
 .S ^TMP("GMRA",$J,GMRAGLNR+2)="  "
"RTN","GMRAPS49",54,0)
 .S ^TMP("GMRA",$J,GMRAGLNR+3)="Site Name: "_GMRASTNM
"RTN","GMRAPS49",55,0)
 .S ^TMP("GMRA",$J,GMRAGLNR+4)="Station: "_GMRASTN
"RTN","GMRAPS49",56,0)
 I GMRTOTAL<1 D
"RTN","GMRAPS49",57,0)
 .D BMES^XPDUTL("  No records with carriage returns found. NO FURTHER ACTION IS NEEDED.")
"RTN","GMRAPS49",58,0)
 .D BMES^XPDUTL("                                                                       ")
"RTN","GMRAPS49",59,0)
 .S ^TMP("GMRA",$J,28)="  "
"RTN","GMRAPS49",60,0)
 .S ^TMP("GMRA",$J,29)="  No records with carriage returns found. NO FURTHER ACTION IS NEEDED."
"RTN","GMRAPS49",61,0)
 .S ^TMP("GMRA",$J,30)="  "
"RTN","GMRAPS49",62,0)
 .S ^TMP("GMRA",$J,31)="  "
"RTN","GMRAPS49",63,0)
 .S ^TMP("GMRA",$J,32)="Site Name: "_GMRASTNM
"RTN","GMRAPS49",64,0)
 .S ^TMP("GMRA",$J,33)="Station: "_GMRASTN
"RTN","GMRAPS49",65,0)
 S XMSUB="ACTION REQUIRED GMRA*4*49 Post-Install Results"
"RTN","GMRAPS49",66,0)
 I GMRTOTAL<1 S XMSUB="GMRA*4*49 Post-Install Results"
"RTN","GMRAPS49",67,0)
 S XMTEXT="^TMP(""GMRA"",$J,",XMY(DUZ)=""
"RTN","GMRAPS49",68,0)
 I $$PROD^XUPROD S XMY("Silverman.Robert@FORUM.DOMAIN.EXT")="" ;only send to PBM from prod
"RTN","GMRAPS49",69,0)
 S XMY("Wolf.Honorata@FORUM.DOMAIN.EXT")=""
"RTN","GMRAPS49",70,0)
 S USR=0 F  S USR=$O(^XUSEC("GMRA-ALLERGY VERIFY",USR)) Q:'USR  S XMY(USR)=""
"RTN","GMRAPS49",71,0)
 S XMDUZ="GMRA*4.0*49 POST INSTALL"
"RTN","GMRAPS49",72,0)
 D BMES^XPDUTL("                                                                       ")
"RTN","GMRAPS49",73,0)
 D BMES^XPDUTL("                                                                       ")
"RTN","GMRAPS49",74,0)
 D BMES^XPDUTL("                                                                       ")
"RTN","GMRAPS49",75,0)
 D MES^XPDUTL("A copy of this report (with instructions) has been sent to the appropriate recipients")
"RTN","GMRAPS49",76,0)
 D ^XMD K XMSUB,XMTEXT,XMY,USR,XMDUZ,GMRAGLNR,GMRASITE,GMRASTN,GMRASTNM
"RTN","GMRAPS49",77,0)
 Q
"RTN","GMRAPS49",78,0)
FIND(GMRTOTAL) ;Check 120.8 for carriage returns in comments
"RTN","GMRAPS49",79,0)
 N GMRAX,DFN,VADM,VA,GMRASP1,GMRASPN1,GMRASP2,GMRASPN2,GMRAREAC
"RTN","GMRAPS49",80,0)
 N GMRAIEN,GMRSEC,GMRTHIRD,DFN
"RTN","GMRAPS49",81,0)
 S GMRAIEN=0,GMRTOTAL=0
"RTN","GMRAPS49",82,0)
 F  S GMRAIEN=$O(^GMR(120.8,GMRAIEN)) Q:GMRAIEN'>0  D
"RTN","GMRAPS49",83,0)
 .;Exclude if patient has Date of Death
"RTN","GMRAPS49",84,0)
 .S DFN=$P($G(^GMR(120.8,GMRAIEN,0)),"^",1)
"RTN","GMRAPS49",85,0)
 .I DFN>0 D
"RTN","GMRAPS49",86,0)
 ..D DEM^VADPT
"RTN","GMRAPS49",87,0)
 ..I $G(VADM(6))>0 Q
"RTN","GMRAPS49",88,0)
 .;Check Comments field
"RTN","GMRAPS49",89,0)
 .S GMRSEC=0
"RTN","GMRAPS49",90,0)
 .F  S GMRSEC=$O(^GMR(120.8,GMRAIEN,26,GMRSEC)) Q:GMRSEC'>0  D
"RTN","GMRAPS49",91,0)
 ..S GMRTHIRD=0
"RTN","GMRAPS49",92,0)
 ..F  S GMRTHIRD=$O(^GMR(120.8,GMRAIEN,26,GMRSEC,2,GMRTHIRD)) Q:GMRTHIRD'>0  D
"RTN","GMRAPS49",93,0)
 ...I ^GMR(120.8,GMRAIEN,26,GMRSEC,2,GMRTHIRD,0)'[$C(13) Q
"RTN","GMRAPS49",94,0)
 ...S ^GMR(120.8,GMRAIEN,26,GMRSEC,2,GMRTHIRD,0)=$TR(^GMR(120.8,GMRAIEN,26,GMRSEC,2,GMRTHIRD,0),$C(13)," ") ;Replace <CR> with space
"RTN","GMRAPS49",95,0)
 ...S ^GMR(120.8,GMRAIEN,26,GMRSEC,2,GMRTHIRD,0)=$TR(^GMR(120.8,GMRAIEN,26,GMRSEC,2,GMRTHIRD,0),$C(10)," ") ;Replace <LF> with space
"RTN","GMRAPS49",96,0)
 ...S GMRTOTAL=GMRTOTAL+1
"RTN","GMRAPS49",97,0)
 ...S GMRAREAC=$P($G(^GMR(120.8,GMRAIEN,0)),"^",2)
"RTN","GMRAPS49",98,0)
 ...S GMRASP1="",GMRASP2=""
"RTN","GMRAPS49",99,0)
 ...S GMRASPN1=12-$L(DFN) F GMRAX=1:1:GMRASPN1 S GMRASP1=GMRASP1_" "
"RTN","GMRAPS49",100,0)
 ...S GMRASPN2=34-$L(GMRAIEN)-$L(DFN)-$L(GMRASP1) F GMRAX=1:1:GMRASPN2 S GMRASP2=GMRASP2_" "
"RTN","GMRAPS49",101,0)
 ...S ^TMP("GMRA",$J,GMRTOTAL+28)=DFN_GMRASP1_GMRAIEN_GMRASP2_GMRAREAC
"RTN","GMRAPS49",102,0)
 ...D MES^XPDUTL(DFN_GMRASP1_GMRAIEN_GMRASP2_GMRAREAC)
"RTN","GMRAPS49",103,0)
 Q
"VER")
8.0^22.0
"BLD",10171,6)
^48
**END**
**END**

