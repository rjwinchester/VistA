Released GMRA*4*58 SEQ #52
Extracted from mail message
**KIDS**:GMRA*4.0*58^

**INSTALL NAME**
GMRA*4.0*58
"BLD",10507,0)
GMRA*4.0*58^ADVERSE REACTION TRACKING^0^3180125^y
"BLD",10507,1,0)
^^11^11^3180125^
"BLD",10507,1,1,0)
This patch has the following enhancements for Clinical Ancillary Services
"BLD",10507,1,2,0)
(CAS) Enhancements (RXSU2).
"BLD",10507,1,3,0)
 
"BLD",10507,1,4,0)
1. Suppress Non-Drug Ingredient-Level Alert
"BLD",10507,1,5,0)
 
"BLD",10507,1,6,0)
   Previously released patch GMRA*4*50 added a new alert when the DRUG 
"BLD",10507,1,7,0)
   CLASSES field (#3) in the PATIENT ALLERGIES file (#120.8) is empty.  
"BLD",10507,1,8,0)
   This patch will add a filter, to ignore those alerts, where ALLERGY
"BLD",10507,1,9,0)
   TYPE field (#3.1) in PATIENT ALLERGIES file (#120.8), does not contain
"BLD",10507,1,10,0)
   the Drug code of "D", as no action was needed to be taken for this
"BLD",10507,1,11,0)
   scenario.
"BLD",10507,4,0)
^9.64PA^^
"BLD",10507,6.3)
5
"BLD",10507,"ABPKG")
n
"BLD",10507,"KRN",0)
^9.67PA^779.2^20
"BLD",10507,"KRN",.4,0)
.4
"BLD",10507,"KRN",.401,0)
.401
"BLD",10507,"KRN",.402,0)
.402
"BLD",10507,"KRN",.403,0)
.403
"BLD",10507,"KRN",.5,0)
.5
"BLD",10507,"KRN",.84,0)
.84
"BLD",10507,"KRN",3.6,0)
3.6
"BLD",10507,"KRN",3.8,0)
3.8
"BLD",10507,"KRN",9.2,0)
9.2
"BLD",10507,"KRN",9.8,0)
9.8
"BLD",10507,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",10507,"KRN",9.8,"NM",1,0)
GMRAPEM0^^0^B68246596
"BLD",10507,"KRN",9.8,"NM","B","GMRAPEM0",1)

"BLD",10507,"KRN",19,0)
19
"BLD",10507,"KRN",19.1,0)
19.1
"BLD",10507,"KRN",101,0)
101
"BLD",10507,"KRN",409.61,0)
409.61
"BLD",10507,"KRN",771,0)
771
"BLD",10507,"KRN",779.2,0)
779.2
"BLD",10507,"KRN",870,0)
870
"BLD",10507,"KRN",8989.51,0)
8989.51
"BLD",10507,"KRN",8989.52,0)
8989.52
"BLD",10507,"KRN",8994,0)
8994
"BLD",10507,"KRN","B",.4,.4)

"BLD",10507,"KRN","B",.401,.401)

"BLD",10507,"KRN","B",.402,.402)

"BLD",10507,"KRN","B",.403,.403)

"BLD",10507,"KRN","B",.5,.5)

"BLD",10507,"KRN","B",.84,.84)

"BLD",10507,"KRN","B",3.6,3.6)

"BLD",10507,"KRN","B",3.8,3.8)

"BLD",10507,"KRN","B",9.2,9.2)

"BLD",10507,"KRN","B",9.8,9.8)

"BLD",10507,"KRN","B",19,19)

"BLD",10507,"KRN","B",19.1,19.1)

"BLD",10507,"KRN","B",101,101)

"BLD",10507,"KRN","B",409.61,409.61)

"BLD",10507,"KRN","B",771,771)

"BLD",10507,"KRN","B",779.2,779.2)

"BLD",10507,"KRN","B",870,870)

"BLD",10507,"KRN","B",8989.51,8989.51)

"BLD",10507,"KRN","B",8989.52,8989.52)

"BLD",10507,"KRN","B",8994,8994)

"BLD",10507,"QUES",0)
^9.62^^
"BLD",10507,"REQB",0)
^9.611^1^1
"BLD",10507,"REQB",1,0)
GMRA*4.0*50^2
"BLD",10507,"REQB","B","GMRA*4.0*50",1)

"MBREQ")
0
"PKG",392,-1)
1^1
"PKG",392,0)
ADVERSE REACTION TRACKING^GMRA^Adverse Reaction Tracking package
"PKG",392,20,0)
^9.402P^1^1
"PKG",392,20,1,0)
2^^GMRAMRG
"PKG",392,20,1,1)

"PKG",392,20,"B",2,1)

"PKG",392,22,0)
^9.49I^1^1
"PKG",392,22,1,0)
4.0^2960328^2960801^1
"PKG",392,22,1,"PAH",1,0)
58^3180125
"PKG",392,22,1,"PAH",1,1,0)
^^11^11^3180125
"PKG",392,22,1,"PAH",1,1,1,0)
This patch has the following enhancements for Clinical Ancillary Services
"PKG",392,22,1,"PAH",1,1,2,0)
(CAS) Enhancements (RXSU2).
"PKG",392,22,1,"PAH",1,1,3,0)
 
"PKG",392,22,1,"PAH",1,1,4,0)
1. Suppress Non-Drug Ingredient-Level Alert
"PKG",392,22,1,"PAH",1,1,5,0)
 
"PKG",392,22,1,"PAH",1,1,6,0)
   Previously released patch GMRA*4*50 added a new alert when the DRUG 
"PKG",392,22,1,"PAH",1,1,7,0)
   CLASSES field (#3) in the PATIENT ALLERGIES file (#120.8) is empty.  
"PKG",392,22,1,"PAH",1,1,8,0)
   This patch will add a filter, to ignore those alerts, where ALLERGY
"PKG",392,22,1,"PAH",1,1,9,0)
   TYPE field (#3.1) in PATIENT ALLERGIES file (#120.8), does not contain
"PKG",392,22,1,"PAH",1,1,10,0)
   the Drug code of "D", as no action was needed to be taken for this
"PKG",392,22,1,"PAH",1,1,11,0)
   scenario.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","GMRAPEM0")
0^1^B68246596^B67572191
"RTN","GMRAPEM0",1,0)
GMRAPEM0 ;HIRMFO/WAA,FT-ALLERGY/ADVERSE REACTION PATIENT EDIT DRIVER ; 12 Jul 2016  1:54 PM
"RTN","GMRAPEM0",2,0)
 ;;4.0;Adverse Reaction Tracking;**2,5,17,21,36,50,58**;Mar 29, 1996;Build 5
"RTN","GMRAPEM0",3,0)
EN11 ; Entry point for GMRA USER E/E PAT REC DATA option
"RTN","GMRAPEM0",4,0)
 ; GMRAUSER is a flag that indicates that this is a User
"RTN","GMRAPEM0",5,0)
 ; If user has Verifier Key then user will act normal
"RTN","GMRAPEM0",6,0)
 I '$D(^XUSEC("GMRA-ALLERGY VERIFY",DUZ)) S GMRAUSER=1
"RTN","GMRAPEM0",7,0)
EN1 ; Entry for ENTER/EDIT PATIENT REACTION DATA option
"RTN","GMRAPEM0",8,0)
 ; EDIT PATIENT A/AR (DFN UNK.)
"RTN","GMRAPEM0",9,0)
 S GMRAOUT=0
"RTN","GMRAPEM0",10,0)
 W @IOF D PAT^GMRAPAT ; Select A Patient
"RTN","GMRAPEM0",11,0)
 D:'GMRAOUT EN21 G:'GMRAOUT EN1
"RTN","GMRAPEM0",12,0)
 K DFN,DIC,GMRAOUT,GMRARET,GMA,GMRAUSER
"RTN","GMRAPEM0",13,0)
 D EXIT,EN1^GMRAKILL
"RTN","GMRAPEM0",14,0)
 Q
"RTN","GMRAPEM0",15,0)
EN21 ; Process patient data and determine if patient is NKA
"RTN","GMRAPEM0",16,0)
 S GMRAOUT=$G(GMRAOUT,0)
"RTN","GMRAPEM0",17,0)
 ; check patient assessment before enter/edit reaction
"RTN","GMRAPEM0",18,0)
 I $$NKA^GMRANKA(DFN),$$NKASCR^GMRANKA(DFN) D  ;delete 120.86 entry if assessment=yes, but no active reactions in 120.8
"RTN","GMRAPEM0",19,0)
 .N DA,DIK
"RTN","GMRAPEM0",20,0)
 .S DIK="^GMR(120.86,",DA=DFN D ^DIK
"RTN","GMRAPEM0",21,0)
 .Q
"RTN","GMRAPEM0",22,0)
 I '$$NKA^GMRANKA(DFN) D NKAASK^GMRANKA(DFN,.GMRAOUT) Q:GMRAOUT  I '$$NKA^GMRANKA(DFN) Q
"RTN","GMRAPEM0",23,0)
 L +^XTMP("GMRAED",DFN):1 I '$T D MESS^GMRAGUI1 Q  ;21
"RTN","GMRAPEM0",24,0)
 S GMRAOUT=0
"RTN","GMRAPEM0",25,0)
 D:'GMRAOUT SELECT
"RTN","GMRAPEM0",26,0)
 I $G(GMRAPA)'>0 S GMRAOUT=0
"RTN","GMRAPEM0",27,0)
 S GMRARP=1 I 'GMRAOUT D
"RTN","GMRAPEM0",28,0)
 .D ASK^GMRAUTL("Enter another Causative Agent? ",.GMRAOUT,.GMRARP)
"RTN","GMRAPEM0",29,0)
 .I 'GMRARP S GMRACNT=$O(^TMP($J,"GMRASF","B"),-1) D
"RTN","GMRAPEM0",30,0)
 ..I GMRACNT D SIGNOFF^GMRASIGN
"RTN","GMRAPEM0",31,0)
 ..I 'GMRAOUT D IDBAND^GMRASIGN
"RTN","GMRAPEM0",32,0)
 ..I GMRAOUT S GMRAOUT=2-GMRAOUT D:GMRAOUT&($D(^TMP($J,"GMRASF"))) ALERT^GMRASIGN K ^TMP($J,"GMRASF"),GMRACNT
"RTN","GMRAPEM0",33,0)
 ..Q
"RTN","GMRAPEM0",34,0)
 .Q
"RTN","GMRAPEM0",35,0)
 I GMRARP,'GMRAOUT K GMRARP L -^XTMP("GMRAED",DFN) G EN21 ;21
"RTN","GMRAPEM0",36,0)
 K GMRARP
"RTN","GMRAPEM0",37,0)
 ; check patient assessment when exiting enter/edit reaction
"RTN","GMRAPEM0",38,0)
 I $$NKA^GMRANKA(DFN),$$NKASCR^GMRANKA(DFN) D  ;delete 120.86 entry if assessment=yes, but no active reactions in 120.8
"RTN","GMRAPEM0",39,0)
 .N DA,DIK
"RTN","GMRAPEM0",40,0)
 .S DIK="^GMR(120.86,",DA=DFN D ^DIK
"RTN","GMRAPEM0",41,0)
 .Q
"RTN","GMRAPEM0",42,0)
 L -^XTMP("GMRAED",DFN) ;21
"RTN","GMRAPEM0",43,0)
 Q
"RTN","GMRAPEM0",44,0)
EN2 ; EDIT PATIENT A/AR (DFN KNOWN)
"RTN","GMRAPEM0",45,0)
 ; Called from the GMRAOR ALLERGY ENTER/EDIT protocol
"RTN","GMRAPEM0",46,0)
 I '$D(^XUSEC("GMRA-ALLERGY VERIFY",DUZ)) S GMRAUSER=1
"RTN","GMRAPEM0",47,0)
 N GMRAOUT
"RTN","GMRAPEM0",48,0)
 D EN21 D
"RTN","GMRAPEM0",49,0)
 .;N GMRAOUT
"RTN","GMRAPEM0",50,0)
 .D EXIT,EN1^GMRAKILL
"RTN","GMRAPEM0",51,0)
 .Q
"RTN","GMRAPEM0",52,0)
 K GMA,GMRARET,GMRAUSER
"RTN","GMRAPEM0",53,0)
 Q
"RTN","GMRAPEM0",54,0)
ALERT ; PROCESS ALERTS FOR ART
"RTN","GMRAPEM0",55,0)
 N DFN,GMRAPA,GMRACNT,GMRAOUT,GMRANEW,GMRAUSER
"RTN","GMRAPEM0",56,0)
 S (GMRACNT,GMRAOUT,GMRANEW)=0 D
"RTN","GMRAPEM0",57,0)
 .  I $G(XQADATA)="" S XQAKILL=0 Q
"RTN","GMRAPEM0",58,0)
 .  S DFN=$P(XQADATA,U),GMRAPA=$P(XQADATA,U,2),GMRAUSER=$P(XQADATA,U,3) Q:'DFN!'GMRAPA
"RTN","GMRAPEM0",59,0)
 .  I $D(^XUSEC("GMRA-ALLERGY VERIFY",DUZ)) K GMRAUSER
"RTN","GMRAPEM0",60,0)
 .  S GMRAPA(0)=$G(^GMR(120.8,GMRAPA,0)) Q:GMRAPA(0)=""
"RTN","GMRAPEM0",61,0)
 .  I $P(GMRAPA(0),U,12) D  Q
"RTN","GMRAPEM0",62,0)
 .  .  W !,"This reaction has been signed off.",$C(7)
"RTN","GMRAPEM0",63,0)
 .  .  D HANGT^GMRAPEH0
"RTN","GMRAPEM0",64,0)
 .  .  S XQAKILL=0
"RTN","GMRAPEM0",65,0)
 .  .  Q
"RTN","GMRAPEM0",66,0)
 .  D EDIT^GMRAPEM4
"RTN","GMRAPEM0",67,0)
 .  D UPDATE^GMRAPEM3
"RTN","GMRAPEM0",68,0)
 .  I '$P(GMRAPA(0),U,12) D SIGNOFF^GMRASIGN
"RTN","GMRAPEM0",69,0)
 .  I GMRAOUT S GMRAOUT=2-GMRAOUT K XQAKILL
"RTN","GMRAPEM0",70,0)
 .  E  D
"RTN","GMRAPEM0",71,0)
 .  .I $P(GMRAPA(0),U,12) S XQAKILL=0
"RTN","GMRAPEM0",72,0)
 .  .I '$P(GMRAPA(0),U,12) K XQAKILL
"RTN","GMRAPEM0",73,0)
 .  D EXIT,EN1^GMRAKILL
"RTN","GMRAPEM0",74,0)
 .  Q
"RTN","GMRAPEM0",75,0)
 Q
"RTN","GMRAPEM0",76,0)
SELECT ;Select a patient reaction
"RTN","GMRAPEM0",77,0)
 S GMRACNT=0 D 1^VADPT
"RTN","GMRAPEM0",78,0)
 S GMRALOC=$P(VAIN(4),U,2),GMRANAM=VADM(1),GMRASEX=VADM(5),GMRAOUT=0,GMRAOTH=$O(^GMRD(120.83,"B","OTHER REACTION",0)) D KVAR^VADPT K VA,VAROOT
"RTN","GMRAPEM0",79,0)
 K GMRADUP S GMRALAGO=1
"RTN","GMRAPEM0",80,0)
 D REACT^GMRAPAT(DFN) ; Load all reaction for this patient.
"RTN","GMRAPEM0",81,0)
 D EN1^GMRAPES0
"RTN","GMRAPEM0",82,0)
 I GMRAPA>0 D TYPE D
"RTN","GMRAPEM0",83,0)
 .I GMRAOUT D:$G(GMRANEW) DELETE S:'$$MISSREQ&('$P($G(GMRAPA(0)),U,12)) GMRAOUT=0,^TMP($J,"GMRASF","B",GMRAPA,GMRACNT)="",^TMP($J,"GMRASF",GMRACNT,GMRAPA)="" D:GMRAOUT UPOUT^GMRAPEM3 Q  ; 21,36
"RTN","GMRAPEM0",84,0)
 .I GMRAERR D ERR^GMRAPEM3 Q  ;The reaction was entered in error
"RTN","GMRAPEM0",85,0)
 .I $P(GMRAPA(0),U,12) D SIGNED^GMRAPEM3 Q  ;The reaction has been signed
"RTN","GMRAPEM0",86,0)
 .; Reaction is a new reaction or Update data
"RTN","GMRAPEM0",87,0)
 .I GMRANEW D GMRACHK^GMRAPEM0(GMRAPA)
"RTN","GMRAPEM0",88,0)
 .D UPDATE^GMRAPEM3
"RTN","GMRAPEM0",89,0)
 .Q
"RTN","GMRAPEM0",90,0)
 Q
"RTN","GMRAPEM0",91,0)
TYPE ; Select the type of the process to use this reaction
"RTN","GMRAPEM0",92,0)
 S GMRAERR=0
"RTN","GMRAPEM0",93,0)
 ; If reaction is not new check to see if user want to enter in error
"RTN","GMRAPEM0",94,0)
 I 'GMRANEW W @IOF N GMRADFN D EN1^GMRAPEE0 I GMRAERR!GMRAOUT Q
"RTN","GMRAPEM0",95,0)
 ;If reaction is observed and signed off
"RTN","GMRAPEM0",96,0)
 I $P(GMRAPA(0),U,6)="o",$P(GMRAPA(0),U,12) D  Q:GMRAOUT
"RTN","GMRAPEM0",97,0)
 .Q:$G(GMRAUSER,0)
"RTN","GMRAPEM0",98,0)
 .N GMRARP
"RTN","GMRAPEM0",99,0)
 .S GMRARP=0 D ASK^GMRAUTL("DO YOU WISH TO EDIT OBSERVED DATA? ",.GMRAOUT,.GMRARP) Q:GMRAOUT
"RTN","GMRAPEM0",100,0)
 .Q:'GMRARP  ;Observed data
"RTN","GMRAPEM0",101,0)
 .N GMRAOD S GMRAOD=$D(^GMR(120.85,"C",GMRAPA)) ;Existing observation data?
"RTN","GMRAPEM0",102,0)
OBSDATE .;
"RTN","GMRAPEM0",103,0)
 .S GMRALAGO=1 F  D EN2^GMRAU85 Q:GMRAPA1>0  Q:GMRAOUT  W !,"You must enter a valid date or an Up-arrow to exit",!,$C(7)
"RTN","GMRAPEM0",104,0)
 .I 'GMRAOUT,GMRAPA1>0  D EN2^GMRAROBS
"RTN","GMRAPEM0",105,0)
 .I '$D(^GMR(120.85,"C",GMRAPA)),$G(GMRANEW)!('$G(GMRANEW)&($G(GMRAOD))) D OBSPROB S GMRAOUT=0 G OBSDATE
"RTN","GMRAPEM0",106,0)
 .Q
"RTN","GMRAPEM0",107,0)
 ;Verify data
"RTN","GMRAPEM0",108,0)
 I 'GMRAERR,$P($G(^GMR(120.8,GMRAPA,0)),U,16)=0,$P(GMRAPA(0),U,12)=1,$D(^XUSEC("GMRA-ALLERGY VERIFY",DUZ)) D  Q:GMRAOUT
"RTN","GMRAPEM0",109,0)
 .K GMRAVER S GMRAVER=0
"RTN","GMRAPEM0",110,0)
 .N GMRAPRNT D EN1^GMRAVFY K GMRALLER,GMRAMEC,GMRAY
"RTN","GMRAPEM0",111,0)
 .I $P($G(^GMR(120.8,GMRAPA,0)),U,16)=1 S GMRASLL(GMRAPA)=1
"RTN","GMRAPEM0",112,0)
 .Q
"RTN","GMRAPEM0",113,0)
 ;EDIT Verified data
"RTN","GMRAPEM0",114,0)
 I 'GMRAERR,$P($G(^GMR(120.8,GMRAPA,0)),U,16)=1,$D(^XUSEC("GMRA-ALLERGY VERIFY",DUZ)) D  Q:GMRAOUT
"RTN","GMRAPEM0",115,0)
 .Q:$G(GMRAVER)=1
"RTN","GMRAPEM0",116,0)
 .N GMRARP
"RTN","GMRAPEM0",117,0)
 .S GMRARP=0
"RTN","GMRAPEM0",118,0)
 .D ASK^GMRAUTL("DO YOU WISH TO EDIT VERIFIED DATA? ",.GMRAOUT,.GMRARP) Q:GMRAOUT
"RTN","GMRAPEM0",119,0)
 .D:GMRARP SITE^GMRAUTL,EN1^GMRAPED0
"RTN","GMRAPEM0",120,0)
 .Q
"RTN","GMRAPEM0",121,0)
 ;if the reaction is new or not signed off
"RTN","GMRAPEM0",122,0)
 I '$P(GMRAPA(0),U,12) D
"RTN","GMRAPEM0",123,0)
 .D EDIT^GMRAPEM4
"RTN","GMRAPEM0",124,0)
 .I $P($G(^GMR(120.8,GMRAPA,0)),U,16) S GMRASLL(GMRAPA)=1
"RTN","GMRAPEM0",125,0)
 .Q
"RTN","GMRAPEM0",126,0)
 Q
"RTN","GMRAPEM0",127,0)
EXIT S GMRAPA=0 F  S GMRAPA=$O(^TMP($J,"GMRASF","B",GMRAPA)) Q:GMRAPA<1  D UNLOCK^GMRAUTL(120.8,GMRAPA)
"RTN","GMRAPEM0",128,0)
 K ^TMP($J,"GMRASF")
"RTN","GMRAPEM0",129,0)
 K ^TMP($J,"GMRALST")
"RTN","GMRAPEM0",130,0)
 Q
"RTN","GMRAPEM0",131,0)
 ;
"RTN","GMRAPEM0",132,0)
DELETE ;Delete entry if required information is not entered - section added in 17
"RTN","GMRAPEM0",133,0)
 N DA,DIK,GMRAPA1
"RTN","GMRAPEM0",134,0)
 W !!,"Entry process not completed, deleting entry...",!
"RTN","GMRAPEM0",135,0)
 S GMRAPA1=$O(^GMR(120.85,"C",GMRAPA,0))
"RTN","GMRAPEM0",136,0)
 I GMRAPA1,$G(^GMR(120.85,GMRAPA1,0))="" K ^GMR(120.85,"C",GMRAPA,GMRAPA1)
"RTN","GMRAPEM0",137,0)
 I GMRAPA1 S DIK="^GMR(120.85,",DA=GMRAPA1 D ^DIK D UNLOCK^GMRAUTL(120.85,GMRAPA1)
"RTN","GMRAPEM0",138,0)
 I GMRAPA S DIK="^GMR(120.8,",DA=GMRAPA D ^DIK D UNLOCK^GMRAUTL(120.8,GMRAPA)
"RTN","GMRAPEM0",139,0)
 Q
"RTN","GMRAPEM0",140,0)
 ;
"RTN","GMRAPEM0",141,0)
OBSPROB ;Display help information for missing observed date/time entry
"RTN","GMRAPEM0",142,0)
 W !!,"Observed reactions must have at least one observation entry.",!,"If this reaction is incorrect then enter a date and then proceed",!,"to mark it as entered in error.",!
"RTN","GMRAPEM0",143,0)
 Q
"RTN","GMRAPEM0",144,0)
 ;
"RTN","GMRAPEM0",145,0)
MISSREQ() ;Function determines if required data is missing
"RTN","GMRAPEM0",146,0)
 N GMRA0,TYPE
"RTN","GMRAPEM0",147,0)
 S GMRA0=$G(^GMR(120.8,+$G(GMRAPA),0)) I GMRA0="" Q 1  ;Entry not found
"RTN","GMRAPEM0",148,0)
 S TYPE=$P(GMRA0,U,6) ;Get observed/historical
"RTN","GMRAPEM0",149,0)
 I TYPE="" Q 1  ;Type not entered
"RTN","GMRAPEM0",150,0)
 I TYPE="h" Q 0  ;Historical has no requirements
"RTN","GMRAPEM0",151,0)
 I TYPE="o" I '$D(^GMR(120.85,"C",GMRAPA))!('$O(^GMR(120.85,+$O(^GMR(120.85,"C",GMRAPA,0)),2,0)))!('$$REQCOM) Q 1  ;Missing obs date/time or sign/symptom or required comment
"RTN","GMRAPEM0",152,0)
 Q 0
"RTN","GMRAPEM0",153,0)
 ;
"RTN","GMRAPEM0",154,0)
REQCOM() ;Function determines if comments required
"RTN","GMRAPEM0",155,0)
 I '$D(GMRASITE) D SITE^GMRAUTL
"RTN","GMRAPEM0",156,0)
 I +$P(^GMRD(120.84,+GMRASITE,0),U,4)=0 Q 1  ;Comments required?
"RTN","GMRAPEM0",157,0)
 I $O(^GMR(120.8,GMRAPA,26,0)) Q 1
"RTN","GMRAPEM0",158,0)
 Q 0
"RTN","GMRAPEM0",159,0)
 ;
"RTN","GMRAPEM0",160,0)
GMRACHK(GMRAPA) ;
"RTN","GMRAPEM0",161,0)
 ;Send a warning MailMan message if the VA DRUG CLASS field is empty.
"RTN","GMRAPEM0",162,0)
 ;Get the first, if any,VA DRUG CLASS entries for this agent.
"RTN","GMRAPEM0",163,0)
 N PATALLER,VADRCL1,PATNAME,REAC,REACTS,LINE
"RTN","GMRAPEM0",164,0)
 N PATIEN,SSN,LAST4
"RTN","GMRAPEM0",165,0)
 D GETS^DIQ(120.8,GMRAPA_",","**","E","PATALLER")
"RTN","GMRAPEM0",166,0)
 ;mod by CAS - to skip all but "D" Drug type reactions
"RTN","GMRAPEM0",167,0)
 I $P($G(^GMR(120.8,GMRAPA,0)),"^",20)'["D" Q
"RTN","GMRAPEM0",168,0)
 S VADRCL1=$G(PATALLER(120.803,"1,"_GMRAPA_",",.01,"E"))
"RTN","GMRAPEM0",169,0)
 S PATNAME=$G(PATALLER(120.8,GMRAPA_",",.01,"E"))
"RTN","GMRAPEM0",170,0)
 S PATIEN=$$GET1^DIQ(120.8,GMRAPA,.01,"I")
"RTN","GMRAPEM0",171,0)
 S SSN=$$GET1^DIQ(2,PATIEN,.09,"E")
"RTN","GMRAPEM0",172,0)
 S LAST4=$E(PATNAME,1,1)_$E(SSN,6,9)
"RTN","GMRAPEM0",173,0)
 I '$G(GMRAERR),(VADRCL1=""),(PATNAME'="") D
"RTN","GMRAPEM0",174,0)
 . K ^XTMP("GMRACHK",$J)
"RTN","GMRAPEM0",175,0)
 . S LINE=1
"RTN","GMRAPEM0",176,0)
 . S ^XTMP("GMRACHK",$J,LINE)="The following allergy/adverse reaction may need a VA DRUG CLASS added"
"RTN","GMRAPEM0",177,0)
 . S LINE=LINE+1
"RTN","GMRAPEM0",178,0)
 . S ^XTMP("GMRACHK",$J,LINE)="for the following Patient:"
"RTN","GMRAPEM0",179,0)
 . S LINE=LINE+1
"RTN","GMRAPEM0",180,0)
 . S ^XTMP("GMRACHK",$J,LINE)=""
"RTN","GMRAPEM0",181,0)
 . S LINE=LINE+1
"RTN","GMRAPEM0",182,0)
 . S ^XTMP("GMRACHK",$J,LINE)="Patient: "_PATNAME
"RTN","GMRAPEM0",183,0)
 . S LINE=LINE+1
"RTN","GMRAPEM0",184,0)
 . S ^XTMP("GMRACHK",$J,LINE)="LAST4: "_LAST4
"RTN","GMRAPEM0",185,0)
 . S LINE=LINE+1
"RTN","GMRAPEM0",186,0)
 . S ^XTMP("GMRACHK",$J,LINE)="Reactant: "_$G(PATALLER(120.8,GMRAPA_",",.02,"E"))
"RTN","GMRAPEM0",187,0)
 . S LINE=LINE+1
"RTN","GMRAPEM0",188,0)
 . ;Build a pretty string of reactions
"RTN","GMRAPEM0",189,0)
 . S REAC=1
"RTN","GMRAPEM0",190,0)
 . S REACTS=$G(PATALLER(120.81,REAC_","_GMRAPA_",",.01,"E"))
"RTN","GMRAPEM0",191,0)
 . S REAC=REAC+1
"RTN","GMRAPEM0",192,0)
 . F  Q:'$D(PATALLER(120.81,REAC_","_GMRAPA_",",.01,"E"))  D
"RTN","GMRAPEM0",193,0)
 . . S REACTS=REACTS_", "_$G(PATALLER(120.81,REAC_","_GMRAPA_",",.01,"E"))
"RTN","GMRAPEM0",194,0)
 . . S REAC=REAC+1
"RTN","GMRAPEM0",195,0)
 . S ^XTMP("GMRACHK",$J,LINE)="Reactions: "_REACTS
"RTN","GMRAPEM0",196,0)
 . S LINE=LINE+1
"RTN","GMRAPEM0",197,0)
 . S ^XTMP("GMRACHK",$J,LINE)="OBS/HIS: "_$G(PATALLER(120.8,GMRAPA_",",6,"E"))
"RTN","GMRAPEM0",198,0)
 . S LINE=LINE+1
"RTN","GMRAPEM0",199,0)
 . S ^XTMP("GMRACHK",$J,LINE)="Location: "_$$GET1^DIQ(405,$$GET1^DIQ(2,DFN,.102,"I"),.06,"E")
"RTN","GMRAPEM0",200,0)
 . S LINE=LINE+1
"RTN","GMRAPEM0",201,0)
 . S XMDUZ=DUZ
"RTN","GMRAPEM0",202,0)
 . S XMTEXT="^XTMP(""GMRACHK"","_$J_","
"RTN","GMRAPEM0",203,0)
 . I $G(DUZ(2))="" S DUZ(2)=+$$STA^XUAF4($$KSP^XUPARAM("INST"))
"RTN","GMRAPEM0",204,0)
 . S XMSUB="ALLERGY/ADVERSE REACTION WITHOUT VA DRUG CLASS ("
"RTN","GMRAPEM0",205,0)
 . S XMSUB=XMSUB_$P($$NS^XUAF4(DUZ(2)),U)_")"
"RTN","GMRAPEM0",206,0)
 . S XMY("G.ADVERSE_ALLERGY_WARNING")=""
"RTN","GMRAPEM0",207,0)
 . D ^XMD
"RTN","GMRAPEM0",208,0)
 . K ^XTMP("GMRACHK",$J)
"RTN","GMRAPEM0",209,0)
 Q
"VER")
8.0^22.2
"BLD",10507,6)
^52
**END**
**END**

