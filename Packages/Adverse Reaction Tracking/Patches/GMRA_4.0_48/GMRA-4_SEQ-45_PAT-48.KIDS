EMERGENCY Released GMRA*4*48 SEQ #45
Extracted from mail message
**KIDS**:GMRA*4.0*48^

**INSTALL NAME**
GMRA*4.0*48
"BLD",8672,0)
GMRA*4.0*48^ADVERSE REACTION TRACKING^0^3160422^y
"BLD",8672,1,0)
^^4^4^3160224^
"BLD",8672,1,1,0)
This patch installs a tool that will assist sites in ensuring that the 
"BLD",8672,1,2,0)
ADVERSE REACTION ASSESSMENT file (#120.86) is synced with the PATIENT 
"BLD",8672,1,3,0)
ALLERGIES file (#120.8).  See the associated patch description for 
"BLD",8672,1,4,0)
additional details and installation instructions.
"BLD",8672,4,0)
^9.64PA^^
"BLD",8672,6.3)
13
"BLD",8672,"INID")
^y
"BLD",8672,"INIT")
POST^GMRAY48
"BLD",8672,"KRN",0)
^9.67PA^779.2^20
"BLD",8672,"KRN",.4,0)
.4
"BLD",8672,"KRN",.401,0)
.401
"BLD",8672,"KRN",.402,0)
.402
"BLD",8672,"KRN",.403,0)
.403
"BLD",8672,"KRN",.5,0)
.5
"BLD",8672,"KRN",.84,0)
.84
"BLD",8672,"KRN",3.6,0)
3.6
"BLD",8672,"KRN",3.8,0)
3.8
"BLD",8672,"KRN",9.2,0)
9.2
"BLD",8672,"KRN",9.8,0)
9.8
"BLD",8672,"KRN",9.8,"NM",0)
^9.68A^3^3
"BLD",8672,"KRN",9.8,"NM",1,0)
GMRAFA^^0^B82868608
"BLD",8672,"KRN",9.8,"NM",2,0)
GMRAFA1^^0^B22448935
"BLD",8672,"KRN",9.8,"NM",3,0)
GMRANKA^^0^B14671193
"BLD",8672,"KRN",9.8,"NM","B","GMRAFA",1)

"BLD",8672,"KRN",9.8,"NM","B","GMRAFA1",2)

"BLD",8672,"KRN",9.8,"NM","B","GMRANKA",3)

"BLD",8672,"KRN",19,0)
19
"BLD",8672,"KRN",19,"NM",0)
^9.68A^2^2
"BLD",8672,"KRN",19,"NM",1,0)
GMRA ASSESSMENT UTILITY^^0
"BLD",8672,"KRN",19,"NM",2,0)
GMRA SITE FILE MENU^^2
"BLD",8672,"KRN",19,"NM","B","GMRA ASSESSMENT UTILITY",1)

"BLD",8672,"KRN",19,"NM","B","GMRA SITE FILE MENU",2)

"BLD",8672,"KRN",19.1,0)
19.1
"BLD",8672,"KRN",101,0)
101
"BLD",8672,"KRN",101,"NM",0)
^9.68A^8^6
"BLD",8672,"KRN",101,"NM",2,0)
GMRA ASSESS DET ASSESSMENT^^0
"BLD",8672,"KRN",101,"NM",4,0)
GMRA ASSESS DET MENU^^0
"BLD",8672,"KRN",101,"NM",5,0)
GMRA ASSESS MENU^^0
"BLD",8672,"KRN",101,"NM",6,0)
GMRA ASSESS SELECT PATIENT^^0
"BLD",8672,"KRN",101,"NM",7,0)
GMRA ASSESS DET ALL EIE^^0
"BLD",8672,"KRN",101,"NM",8,0)
GMRA ASSESS DET REVIEW^^0
"BLD",8672,"KRN",101,"NM","B","GMRA ASSESS DET ALL EIE",7)

"BLD",8672,"KRN",101,"NM","B","GMRA ASSESS DET ASSESSMENT",2)

"BLD",8672,"KRN",101,"NM","B","GMRA ASSESS DET MENU",4)

"BLD",8672,"KRN",101,"NM","B","GMRA ASSESS DET REVIEW",8)

"BLD",8672,"KRN",101,"NM","B","GMRA ASSESS MENU",5)

"BLD",8672,"KRN",101,"NM","B","GMRA ASSESS SELECT PATIENT",6)

"BLD",8672,"KRN",409.61,0)
409.61
"BLD",8672,"KRN",409.61,"NM",0)
^9.68A^2^2
"BLD",8672,"KRN",409.61,"NM",1,0)
GMRA ASSESS FIX^^0
"BLD",8672,"KRN",409.61,"NM",2,0)
GMRA ASSESS FIX DETAIL^^0
"BLD",8672,"KRN",409.61,"NM","B","GMRA ASSESS FIX",1)

"BLD",8672,"KRN",409.61,"NM","B","GMRA ASSESS FIX DETAIL",2)

"BLD",8672,"KRN",771,0)
771
"BLD",8672,"KRN",779.2,0)
779.2
"BLD",8672,"KRN",870,0)
870
"BLD",8672,"KRN",8989.51,0)
8989.51
"BLD",8672,"KRN",8989.52,0)
8989.52
"BLD",8672,"KRN",8994,0)
8994
"BLD",8672,"KRN","B",.4,.4)

"BLD",8672,"KRN","B",.401,.401)

"BLD",8672,"KRN","B",.402,.402)

"BLD",8672,"KRN","B",.403,.403)

"BLD",8672,"KRN","B",.5,.5)

"BLD",8672,"KRN","B",.84,.84)

"BLD",8672,"KRN","B",3.6,3.6)

"BLD",8672,"KRN","B",3.8,3.8)

"BLD",8672,"KRN","B",9.2,9.2)

"BLD",8672,"KRN","B",9.8,9.8)

"BLD",8672,"KRN","B",19,19)

"BLD",8672,"KRN","B",19.1,19.1)

"BLD",8672,"KRN","B",101,101)

"BLD",8672,"KRN","B",409.61,409.61)

"BLD",8672,"KRN","B",771,771)

"BLD",8672,"KRN","B",779.2,779.2)

"BLD",8672,"KRN","B",870,870)

"BLD",8672,"KRN","B",8989.51,8989.51)

"BLD",8672,"KRN","B",8989.52,8989.52)

"BLD",8672,"KRN","B",8994,8994)

"BLD",8672,"QUES",0)
^9.62^^
"INIT")
POST^GMRAY48
"KRN",19,6017,-1)
2^2
"KRN",19,6017,0)
GMRA SITE FILE MENU^Enter/Edit Site Configurable Files^^M^11595^^^^^^^247
"KRN",19,6017,10,0)
^19.01IP^7^7
"KRN",19,6017,10,7,0)
14157^7
"KRN",19,6017,10,7,"^")
GMRA ASSESSMENT UTILITY
"KRN",19,6017,"U")
ENTER/EDIT SITE CONFIGURABLE F
"KRN",19,14157,-1)
0^1
"KRN",19,14157,0)
GMRA ASSESSMENT UTILITY^Assessment clean up utility^^R^^^^^^^^ADVERSE REACTION TRACKING
"KRN",19,14157,1,0)
^^5^5^3130409^
"KRN",19,14157,1,1,0)
Identifies patients whose ADVERSE REACTION ASSESSMENT file (#120.86) 
"KRN",19,14157,1,2,0)
entry is not synced with the PATIENT ALLERGIES file (#120.8).  After 
"KRN",19,14157,1,3,0)
reviewing the patient's assessment and allergy entries, the user can 
"KRN",19,14157,1,4,0)
either modify the assessment or can mark all allergies as entered in 
"KRN",19,14157,1,5,0)
error.
"KRN",19,14157,25)
EN^GMRAFA
"KRN",19,14157,"U")
ASSESSMENT CLEAN UP UTILITY
"KRN",101,5905,-1)
0^6
"KRN",101,5905,0)
GMRA ASSESS SELECT PATIENT^Select Patient^^A^^^^^^^^ADVERSE REACTION TRACKING
"KRN",101,5905,15)
S VALMBCK="R"
"KRN",101,5905,20)
D PATIENT^GMRAFA
"KRN",101,5905,99)
62910,40788
"KRN",101,5906,-1)
0^5
"KRN",101,5906,0)
GMRA ASSESS MENU^^^M^^^^^^^^ADVERSE REACTION TRACKING
"KRN",101,5906,4)
25^4
"KRN",101,5906,10,0)
^101.01PA^1^1
"KRN",101,5906,10,1,0)
5905^SP^1^
"KRN",101,5906,10,1,"^")
GMRA ASSESS SELECT PATIENT
"KRN",101,5906,26)
D SHOW^VALM
"KRN",101,5906,28)
Select Action: 
"KRN",101,5906,99)
62910,40893
"KRN",101,5907,-1)
0^8
"KRN",101,5907,0)
GMRA ASSESS DET REVIEW^Review Reaction^^A^^^^^^^^ADVERSE REACTION TRACKING
"KRN",101,5907,15)
S:$G(VALMBCK)="" VALMBCK="R"
"KRN",101,5907,20)
D RR^GMRAFA1
"KRN",101,5907,99)
62922,27801
"KRN",101,5908,-1)
0^4
"KRN",101,5908,0)
GMRA ASSESS DET MENU^^^M^^^^^^^^ADVERSE REACTION TRACKING
"KRN",101,5908,4)
40^4
"KRN",101,5908,10,0)
^101.01PA^3^3
"KRN",101,5908,10,1,0)
5907^RR^2^
"KRN",101,5908,10,1,"^")
GMRA ASSESS DET REVIEW
"KRN",101,5908,10,2,0)
5909^MA^1^
"KRN",101,5908,10,2,"^")
GMRA ASSESS DET ASSESSMENT
"KRN",101,5908,10,3,0)
5910^EE^3^
"KRN",101,5908,10,3,"^")
GMRA ASSESS DET ALL EIE
"KRN",101,5908,26)
D SHOW^VALM
"KRN",101,5908,28)
Select Action: 
"KRN",101,5908,99)
62922,36125
"KRN",101,5909,-1)
0^2
"KRN",101,5909,0)
GMRA ASSESS DET ASSESSMENT^Modify Assessment^^A^^^^^^^^ADVERSE REACTION TRACKING
"KRN",101,5909,15)
S:$G(VALMBCK)="" VALMBCK="R"
"KRN",101,5909,20)
D UASSESS^GMRAFA1
"KRN",101,5909,99)
62910,43401
"KRN",101,5910,-1)
0^7
"KRN",101,5910,0)
GMRA ASSESS DET ALL EIE^Change all to 'Entered in Error'^^A^^^^^^^^ADVERSE REACTION TRACKING
"KRN",101,5910,15)
S:$G(VALMBCK)="" VALMBCK="R"
"KRN",101,5910,20)
D ALLEE^GMRAFA1
"KRN",101,5910,99)
62922,36111
"KRN",409.61,784,-1)
0^1
"KRN",409.61,784,0)
GMRA ASSESS FIX^1^^80^4^20^0^1^^GMRA ASSESS MENU^Assessment Corrector^1^^1
"KRN",409.61,784,1)
^VALM HIDDEN ACTIONS
"KRN",409.61,784,"COL",0)
^409.621^5^5
"KRN",409.61,784,"COL",1,0)
LINENO^1^5^ Line
"KRN",409.61,784,"COL",2,0)
PATIENT^7^30^Patient Name
"KRN",409.61,784,"COL",3,0)
ASSESSMENT^39^10^Assessment
"KRN",409.61,784,"COL",4,0)
ALLERGIES^51^14^# of Allergies
"KRN",409.61,784,"COL",5,0)
STATUS^67^9^Status
"KRN",409.61,784,"COL","B","ALLERGIES",4)

"KRN",409.61,784,"COL","B","ASSESSMENT",3)

"KRN",409.61,784,"COL","B","LINENO",1)

"KRN",409.61,784,"COL","B","PATIENT",2)

"KRN",409.61,784,"COL","B","STATUS",5)

"KRN",409.61,784,"FNL")
D EXIT^GMRAFA
"KRN",409.61,784,"HDR")
D HDR^GMRAFA
"KRN",409.61,784,"HLP")
D HELP^GMRAFA
"KRN",409.61,784,"INIT")
D INIT^GMRAFA
"KRN",409.61,785,-1)
0^2
"KRN",409.61,785,0)
GMRA ASSESS FIX DETAIL^1^^80^5^14^0^1^^GMRA ASSESS DET MENU^Patient Detailed Display^1^^1
"KRN",409.61,785,1)
^VALM HIDDEN ACTIONS
"KRN",409.61,785,"COL",0)
^409.621^3^3
"KRN",409.61,785,"COL",1,0)
REACTANT^7^30^Reactant
"KRN",409.61,785,"COL",2,0)
LINENO^1^5^ Line
"KRN",409.61,785,"COL",3,0)
ERROR^39^16^Entered in Error
"KRN",409.61,785,"COL","B","ERROR",3)

"KRN",409.61,785,"COL","B","LINENO",2)

"KRN",409.61,785,"COL","B","REACTANT",1)

"KRN",409.61,785,"FNL")
D EXIT^GMRAFA1
"KRN",409.61,785,"HDR")
D HDR^GMRAFA1
"KRN",409.61,785,"HLP")
D HELP^GMRAFA1
"KRN",409.61,785,"INIT")
D INIT^GMRAFA1
"MBREQ")
0
"ORD",15,101)
101;15;;;PRO^XPDTA;PROF1^XPDIA;PROE1^XPDIA;PROF2^XPDIA;;PRODEL^XPDIA
"ORD",15,101,0)
PROTOCOL
"ORD",17,409.61)
409.61;17;1;;;;LME1^XPDIA1;;;LMDEL^XPDIA1
"ORD",17,409.61,0)
LIST TEMPLATE
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"PKG",247,-1)
1^1
"PKG",247,0)
ADVERSE REACTION TRACKING^GMRA^Adverse Reaction Tracking package
"PKG",247,20,0)
^9.402P^1^1
"PKG",247,20,1,0)
2^^GMRAMRG
"PKG",247,20,1,1)

"PKG",247,20,"B",2,1)

"PKG",247,22,0)
^9.49I^1^1
"PKG",247,22,1,0)
4.0^2960328^2960718^11595
"PKG",247,22,1,"PAH",1,0)
48^3160422
"PKG",247,22,1,"PAH",1,1,0)
^^4^4^3160422
"PKG",247,22,1,"PAH",1,1,1,0)
This patch installs a tool that will assist sites in ensuring that the 
"PKG",247,22,1,"PAH",1,1,2,0)
ADVERSE REACTION ASSESSMENT file (#120.86) is synced with the PATIENT 
"PKG",247,22,1,"PAH",1,1,3,0)
ALLERGIES file (#120.8).  See the associated patch description for 
"PKG",247,22,1,"PAH",1,1,4,0)
additional details and installation instructions.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
4
"RTN","GMRAFA")
0^1^B82868608^n/a
"RTN","GMRAFA",1,0)
GMRAFA ;ISP/RFR - CORRECT ASSESSMENTS ;04/22/2016  11:37
"RTN","GMRAFA",2,0)
 ;;4.0;Adverse Reaction Tracking;**48**;Mar 29, 1996;Build 13
"RTN","GMRAFA",3,0)
EN ; -- main entry point for GMRA ASSESS FIX
"RTN","GMRAFA",4,0)
 N DIR,X,Y,DTOUT,DUOUT,DIRUT,DIROUT
"RTN","GMRAFA",5,0)
 I '$D(^XTMP("GMRAFAL")) D  Q
"RTN","GMRAFA",6,0)
 .W !!,"I will create a task to build the list of assessments that need review"
"RTN","GMRAFA",7,0)
 .W !,"and send you an email when the list is built.",!
"RTN","GMRAFA",8,0)
 .N XMDUZ,XMDF,XMY,X,XMOUT
"RTN","GMRAFA",9,0)
 .S XMDUZ=.5,^XTMP("GMRAFAL","B","RECIPS",DUZ)=""
"RTN","GMRAFA",10,0)
 .S DIR(0)="Y"_U_"A",DIR("A")="Shall I notify anyone else when the list is built"
"RTN","GMRAFA",11,0)
 .S DIR("B")="NO",DIR("?")="Enter YES to add other recipients or NO to not add other recipients."
"RTN","GMRAFA",12,0)
 .D ^DIR
"RTN","GMRAFA",13,0)
 .Q:$D(DIRUT)
"RTN","GMRAFA",14,0)
 .I +Y S XMDF=1 D DES^XMA21 I X="",'$D(XMOUT),$D(XMY) M ^XTMP("GMRAFAL","B","RECIPS")=XMY
"RTN","GMRAFA",15,0)
 .K X,Y,DTOUT,DUOUT,DIRUT,DIROUT
"RTN","GMRAFA",16,0)
 .S DIR(0)="Y"_U_"A",DIR("A")="Do you want to include deceased patients in the list"
"RTN","GMRAFA",17,0)
 .S DIR("B")="NO",DIR("?",1)="Enter YES to include deceased patients in the list or NO to exclude deceased"
"RTN","GMRAFA",18,0)
 .S DIR("?")="patients from the list."
"RTN","GMRAFA",19,0)
 .D ^DIR
"RTN","GMRAFA",20,0)
 .Q:$D(DIRUT)
"RTN","GMRAFA",21,0)
 .S ^XTMP("GMRAFAL","Q","INC_DEAD")=+Y
"RTN","GMRAFA",22,0)
 .N ZTRTN,ZTDESC,ZTIO,ZTSK
"RTN","GMRAFA",23,0)
 .S ZTRTN="LISTBLD^GMRAFA",ZTDESC="GMRA ASSESSMENT LIST BUILDER",ZTIO=""
"RTN","GMRAFA",24,0)
 .W !!,"Enter the date and time below when the assessment list builder should start.",!
"RTN","GMRAFA",25,0)
 .D ^%ZTLOAD
"RTN","GMRAFA",26,0)
 .I $D(ZTSK) S ^XTMP("GMRAFAL","B")=ZTSK W !!,"Successfully queued the assessment list builder; task #"_ZTSK_".",!!
"RTN","GMRAFA",27,0)
 .E  W !!,"The assessment list builder was not scheduled.",!!
"RTN","GMRAFA",28,0)
 .S:$D(^XTMP("GMRAFAL")) ^XTMP("GMRAFAL",0)=$$FMADD^XLFDT(DT,30,0,0,0)_U_DT_U_"GMRA ASSESSMENT LIST"
"RTN","GMRAFA",29,0)
 I $G(^XTMP("GMRAFAL","B"))>0 D  Q
"RTN","GMRAFA",30,0)
 .N ZTSK S ZTSK=+$G(^XTMP("GMRAFAL","B"))
"RTN","GMRAFA",31,0)
 .W !!,"Task #"_ZTSK
"RTN","GMRAFA",32,0)
 .D ISQED^%ZTLOAD
"RTN","GMRAFA",33,0)
 .I ZTSK(0)=1 W " is scheduled to build the list" I $G(ZTSK("D"))>0 W " on "_$$HTE^XLFDT(ZTSK("D"))  K ZTSK
"RTN","GMRAFA",34,0)
 .I $D(ZTSK(0)),ZTSK(0)="" D
"RTN","GMRAFA",35,0)
 ..W " could not be found.",!
"RTN","GMRAFA",36,0)
 ..I DUZ(0)'["@" W "Please contact IRM for assistance" I $G(ZTSK("E"))'="" W " with error code "_$G(ZTSK("E"))
"RTN","GMRAFA",37,0)
 ..E  D RESET
"RTN","GMRAFA",38,0)
 .I $D(ZTSK(0)),ZTSK(0)=0 D
"RTN","GMRAFA",39,0)
 ..K ZTSK S ZTSK=+$G(^XTMP("GMRAFAL","B"))
"RTN","GMRAFA",40,0)
 ..D STAT^%ZTLOAD
"RTN","GMRAFA",41,0)
 ..I ZTSK(1)=2 K ZTSK W " is currently building the list" I $G(^XTMP("GMRAFAL","B","STATUS"))'="" W " and is "_^("STATUS")
"RTN","GMRAFA",42,0)
 ..I $D(ZTSK(1)),ZTSK(1)=5 D
"RTN","GMRAFA",43,0)
 ...W " stopped abnormally.",!
"RTN","GMRAFA",44,0)
 ...I DUZ(0)'["@" W "Please contact IRM for assistance"
"RTN","GMRAFA",45,0)
 ...E  D RESET
"RTN","GMRAFA",46,0)
 ..I $D(ZTSK(1)),ZTSK(1)'=2,ZTSK(1)'=5 D
"RTN","GMRAFA",47,0)
 ...W " has a problem.",!
"RTN","GMRAFA",48,0)
 ...I DUZ(0)'["@" W "Please contact IRM for assistance"
"RTN","GMRAFA",49,0)
 ...E  D RESET
"RTN","GMRAFA",50,0)
 .W "."
"RTN","GMRAFA",51,0)
 .Q:$D(ZTSK)
"RTN","GMRAFA",52,0)
 .I $D(^XTMP("GMRAFAL","B","RECIPS",DUZ)) W !,"I will notify you when the list is complete.",!! Q
"RTN","GMRAFA",53,0)
 .S DIR(0)="Y"_U_"A",DIR("A")="Shall I send you an email when the list is built"
"RTN","GMRAFA",54,0)
 .S DIR("?")="Enter YES to add yourself to the recipient list or NO to not add yourself."
"RTN","GMRAFA",55,0)
 .D ^DIR
"RTN","GMRAFA",56,0)
 .I +Y D
"RTN","GMRAFA",57,0)
 ..S ^XTMP("GMRAFAL","B","RECIPS",DUZ)="" W !,"I will notify you when the list is complete.",!
"RTN","GMRAFA",58,0)
 ..S ^XTMP("GMRAFAL",0)=$$FMADD^XLFDT(DT,30,0,0,0)_U_DT_U_"GMRA ASSESSMENT LIST"
"RTN","GMRAFA",59,0)
 D EN^VALM("GMRA ASSESS FIX")
"RTN","GMRAFA",60,0)
 I $O(^XTMP("GMRAFAL",0))="B" K ^XTMP("GMRAFAL") Q
"RTN","GMRAFA",61,0)
 K ^TMP($J,"GMRAFAL")
"RTN","GMRAFA",62,0)
 Q
"RTN","GMRAFA",63,0)
 ;
"RTN","GMRAFA",64,0)
RESET ; -- reset the option
"RTN","GMRAFA",65,0)
 N DIR,X,Y,DTOUT,DUOUT,DIRUT,DIROUT
"RTN","GMRAFA",66,0)
 S DIR(0)="Y"_U_"A",DIR("A")="Shall I reset this option"
"RTN","GMRAFA",67,0)
 S DIR("?")="Enter YES to delete the task number or NO to do nothing."
"RTN","GMRAFA",68,0)
 D ^DIR
"RTN","GMRAFA",69,0)
 I +Y K ^XTMP("GMRAFAL")
"RTN","GMRAFA",70,0)
 Q
"RTN","GMRAFA",71,0)
 ;
"RTN","GMRAFA",72,0)
HDR ; -- header code
"RTN","GMRAFA",73,0)
 S VALMHDR(1)="Adverse Reaction Tracking Assessment Corrector"
"RTN","GMRAFA",74,0)
 Q
"RTN","GMRAFA",75,0)
 ;
"RTN","GMRAFA",76,0)
LISTBLD ; -- search for problem patients
"RTN","GMRAFA",77,0)
 N DFN,TEXT,TOTAL,CUR,X,VALMCNT,INCDEAD,EXIT
"RTN","GMRAFA",78,0)
 S ^XTMP("GMRAFAL",0)=$$FMADD^XLFDT(DT,30,0,0,0)_U_DT_U_"GMRA ASSESSMENT LIST"
"RTN","GMRAFA",79,0)
 S VALMCNT=0,TOTAL=$O(^DPT("?"),-1),INCDEAD=+$G(^XTMP("GMRAFAL","Q","INC_DEAD"))
"RTN","GMRAFA",80,0)
 S DFN=0 F  S DFN=$O(^DPT(DFN)) Q:'DFN  D
"RTN","GMRAFA",81,0)
 .I 'INCDEAD D  I $G(EXIT) S EXIT=0 Q
"RTN","GMRAFA",82,0)
 ..N VADM
"RTN","GMRAFA",83,0)
 ..D DEM^VADPT
"RTN","GMRAFA",84,0)
 ..I $G(VADM(6))'="" S EXIT=1
"RTN","GMRAFA",85,0)
 .N COUNT,ASSESS
"RTN","GMRAFA",86,0)
 .I '(DFN#1000) D
"RTN","GMRAFA",87,0)
 ..S CUR=(DFN/TOTAL)*100,CUR=+$P(CUR,".")_"."_$E(+$P(CUR,".",2),1,2)
"RTN","GMRAFA",88,0)
 ..S ^XTMP("GMRAFAL","B","STATUS")=CUR_"% complete"
"RTN","GMRAFA",89,0)
 .I $D(^DPT(DFN,-9)) Q
"RTN","GMRAFA",90,0)
 .Q:$$VERIFY(DFN,.COUNT,.ASSESS)
"RTN","GMRAFA",91,0)
 .S VALMCNT=VALMCNT+1
"RTN","GMRAFA",92,0)
 .S ^XTMP("GMRAFAL",VALMCNT,DFN,"PATIENT")=$$GET1^DIQ(2,DFN_",",.01)
"RTN","GMRAFA",93,0)
 .S ^XTMP("GMRAFAL",VALMCNT,DFN,"ASSESSMENT")=$$EASSESS($G(ASSESS("EXTERNAL")))
"RTN","GMRAFA",94,0)
 .S ^XTMP("GMRAFAL",VALMCNT,DFN,"ALLERGIES")=+$G(COUNT("GOOD"))
"RTN","GMRAFA",95,0)
 N XMDUZ,XMSUB,XMZ,XMY
"RTN","GMRAFA",96,0)
 S XMDUZ=.5,XMSUB="GMRA ASSESSMENT FIX LIST BUILD STATUS"
"RTN","GMRAFA",97,0)
 M XMY=^XTMP("GMRAFAL","B","RECIPS")
"RTN","GMRAFA",98,0)
 D XMZ^XMA2
"RTN","GMRAFA",99,0)
 I XMZ>0 D
"RTN","GMRAFA",100,0)
 .;ICR #10113 MAILMAN: Message Text - Direct Entry
"RTN","GMRAFA",101,0)
 .I VALMCNT=0 D
"RTN","GMRAFA",102,0)
 ..K ^XTMP("GMRAFAL")
"RTN","GMRAFA",103,0)
 ..S ^XMB(3.9,XMZ,2,0)=U_3.92_U_2_U_2_U_DT
"RTN","GMRAFA",104,0)
 ..S ^XMB(3.9,XMZ,2,1,0)="The assessment list builder has determined there are no patients with"
"RTN","GMRAFA",105,0)
 ..S ^XMB(3.9,XMZ,2,2,0)="assessment problems. No further action is needed."
"RTN","GMRAFA",106,0)
 .I VALMCNT>0 D
"RTN","GMRAFA",107,0)
 ..K ^XTMP("GMRAFAL","B")
"RTN","GMRAFA",108,0)
 ..S ^XTMP("GMRAFAL","B")=0
"RTN","GMRAFA",109,0)
 ..S ^XMB(3.9,XMZ,2,0)=U_3.92_U_6_U_6_U_DT
"RTN","GMRAFA",110,0)
 ..S ^XMB(3.9,XMZ,2,1,0)="The assessment list builder has successfully created the list of patients to"
"RTN","GMRAFA",111,0)
 ..S ^XMB(3.9,XMZ,2,2,0)="review."
"RTN","GMRAFA",112,0)
 ..S ^XMB(3.9,XMZ,2,3,0)=" "
"RTN","GMRAFA",113,0)
 ..S ^XMB(3.9,XMZ,2,4,0)="Please use option Assessment clean up utility [GMRA ASSESSMENT UTILITY],"
"RTN","GMRAFA",114,0)
 ..S ^XMB(3.9,XMZ,2,5,0)="located on the Enter/Edit Site Configurable Files [GMRA SITE FILE MENU] menu,"
"RTN","GMRAFA",115,0)
 ..S ^XMB(3.9,XMZ,2,6,0)="to process this list."
"RTN","GMRAFA",116,0)
 .D ENT2^XMD
"RTN","GMRAFA",117,0)
 S ZTREQ="@"
"RTN","GMRAFA",118,0)
 Q
"RTN","GMRAFA",119,0)
 ;
"RTN","GMRAFA",120,0)
INIT ; -- init variables and list array 
"RTN","GMRAFA",121,0)
 W @IOF,"Please wait while I prepare the list."
"RTN","GMRAFA",122,0)
 N DFN,TEXT,TOTAL,CUR,TEXT,LAST
"RTN","GMRAFA",123,0)
 K ^TMP($J,"GMRAFAL")
"RTN","GMRAFA",124,0)
 S CUR=0 F  S CUR=$O(^XTMP("GMRAFAL",CUR)) Q:'+CUR  D
"RTN","GMRAFA",125,0)
 .S LAST=1+$G(LAST),^TMP($J,"GMRAFAL","C",LAST,CUR)=""
"RTN","GMRAFA",126,0)
 S CUR=0 F  S CUR=$O(^TMP($J,"GMRAFAL","C",CUR)) Q:'+CUR  S LAST=$O(^TMP($J,"GMRAFAL","C",CUR,0)),DFN=$O(^XTMP("GMRAFAL",LAST,0)) D
"RTN","GMRAFA",127,0)
 .S TEXT="",TEXT=$$SETFLD^VALM1(CUR_".",TEXT,"LINENO")
"RTN","GMRAFA",128,0)
 .S TEXT=$$SETFLD^VALM1($G(^XTMP("GMRAFAL",LAST,DFN,"PATIENT")),TEXT,"PATIENT")
"RTN","GMRAFA",129,0)
 .S TEXT=$$SETFLD^VALM1($$CJ^XLFSTR($G(^XTMP("GMRAFAL",LAST,DFN,"ASSESSMENT")),$P(VALMDDF("ASSESSMENT"),U,3)),TEXT,"ASSESSMENT")
"RTN","GMRAFA",130,0)
 .S TEXT=$$SETFLD^VALM1($$CJ^XLFSTR($G(^XTMP("GMRAFAL",LAST,DFN,"ALLERGIES")),$P(VALMDDF("ALLERGIES"),U,3)),TEXT,"ALLERGIES")
"RTN","GMRAFA",131,0)
 .D SET^VALM10(CUR,TEXT,DFN)
"RTN","GMRAFA",132,0)
 .S VALMCNT=CUR
"RTN","GMRAFA",133,0)
 S:$G(VALMCNT)="" VALMCNT=0,VALMSG="No problems found"
"RTN","GMRAFA",134,0)
 Q
"RTN","GMRAFA",135,0)
 ;
"RTN","GMRAFA",136,0)
VERIFY(DFN,COUNT,ASSESS) ; -- verify the assessment matches the allergies
"RTN","GMRAFA",137,0)
 N IEN,RETURN
"RTN","GMRAFA",138,0)
 K COUNT,ASSESS
"RTN","GMRAFA",139,0)
 S (IEN,COUNT,RETURN)=0
"RTN","GMRAFA",140,0)
 F  S IEN=$O(^GMR(120.8,"B",DFN,IEN)) Q:'IEN  D
"RTN","GMRAFA",141,0)
 .I +$P($G(^GMR(120.8,IEN,"ER")),U) S COUNT("ERROR")=1+$G(COUNT("ERROR"))
"RTN","GMRAFA",142,0)
 .I '+$P($G(^GMR(120.8,IEN,"ER")),U) S COUNT("GOOD")=1+$G(COUNT("GOOD"))
"RTN","GMRAFA",143,0)
 S ASSESS=+$O(^GMR(120.86,"B",DFN,0))
"RTN","GMRAFA",144,0)
 S:ASSESS>0 ASSESS("EXTERNAL")=$$GET1^DIQ(120.86,ASSESS_",",1),ASSESS=$P($G(^GMR(120.86,ASSESS,0)),U,2)
"RTN","GMRAFA",145,0)
 I +ASSESS,(+$G(COUNT("GOOD"))>0) S RETURN=1
"RTN","GMRAFA",146,0)
 I '+ASSESS,('+$G(COUNT("GOOD"))) S RETURN=1
"RTN","GMRAFA",147,0)
 Q RETURN
"RTN","GMRAFA",148,0)
 ;
"RTN","GMRAFA",149,0)
EASSESS(ASSESS) ; -- return the external value of the assessment
"RTN","GMRAFA",150,0)
 Q $S($G(ASSESS)="":"No Assess.",1:$G(ASSESS))
"RTN","GMRAFA",151,0)
 ;
"RTN","GMRAFA",152,0)
HELP ; -- help code
"RTN","GMRAFA",153,0)
 D FULL^VALM1
"RTN","GMRAFA",154,0)
 W !!,"Use SP to select the patient you want to work with.  You can only work with one",!
"RTN","GMRAFA",155,0)
 W "patient at a time.",!
"RTN","GMRAFA",156,0)
 D WAIT^GMRAFX3
"RTN","GMRAFA",157,0)
 S VALMBCK="R"
"RTN","GMRAFA",158,0)
 Q
"RTN","GMRAFA",159,0)
 ;
"RTN","GMRAFA",160,0)
EXIT ; -- exit code
"RTN","GMRAFA",161,0)
 D FULL^VALM1
"RTN","GMRAFA",162,0)
 Q
"RTN","GMRAFA",163,0)
 ;
"RTN","GMRAFA",164,0)
EXPND ; -- expand code
"RTN","GMRAFA",165,0)
 Q
"RTN","GMRAFA",166,0)
 ;
"RTN","GMRAFA",167,0)
PATIENT ; -- select patient
"RTN","GMRAFA",168,0)
 N GMRAITM,DFN,ASSESS,COUNT,EXIT,ISFIXED,GMRAACT
"RTN","GMRAFA",169,0)
 D SELECT^GMRAFA1(.GMRAITM,"patients")
"RTN","GMRAFA",170,0)
 I 'GMRAITM S VALMSG="No problems found" Q
"RTN","GMRAFA",171,0)
 Q:GMRAITM<0
"RTN","GMRAFA",172,0)
 S DFN=+$O(@VALMAR@("IDX",GMRAITM,"")),EXIT=0
"RTN","GMRAFA",173,0)
 I $D(^XTMP("GMRAFA",DFN)),('$D(^XTMP("GMRAFA",DFN,DUZ))) D  Q
"RTN","GMRAFA",174,0)
 .N IEN
"RTN","GMRAFA",175,0)
 .S IEN=+$O(^XTMP("GMRAFA",DFN,0))
"RTN","GMRAFA",176,0)
 .W !,$S(IEN>0:$$GET1^DIQ(200,IEN_",",.01),1:"Someone")_" has locked that patient's records"
"RTN","GMRAFA",177,0)
 .I $G(^XTMP("GMRAFA",DFN,IEN))'="" W !,"in process ID number "_$G(^XTMP("GMRAFA",DFN,IEN))
"RTN","GMRAFA",178,0)
 .W "."
"RTN","GMRAFA",179,0)
 .D WAIT^GMRAFX3
"RTN","GMRAFA",180,0)
 I $D(^XTMP("GMRAFA",DFN,DUZ)),($G(^XTMP("GMRAFA",DFN,DUZ))'=$J) D  Q:$G(EXIT)
"RTN","GMRAFA",181,0)
 .N IEN
"RTN","GMRAFA",182,0)
 .S IEN=+$O(^XTMP("GMRAFA",DFN,0))
"RTN","GMRAFA",183,0)
 .W !,"You are already editing this patient in a different session",!
"RTN","GMRAFA",184,0)
 .W "(that session has process ID number "_$G(^XTMP("GMRAFA",DFN,IEN))_").",!
"RTN","GMRAFA",185,0)
 .N DIR,X,Y,DTOUT,DUOUT,DIRUT,DIROUT
"RTN","GMRAFA",186,0)
 .S DIR(0)="YA"_U,DIR("A",1)="Are you sure you want to continue editing"
"RTN","GMRAFA",187,0)
 .S DIR("A")="this patient in this session? ",DIR("B")="NO"
"RTN","GMRAFA",188,0)
 .D ^DIR
"RTN","GMRAFA",189,0)
 .I $D(DIRUT)!('Y) S EXIT=1
"RTN","GMRAFA",190,0)
 S ^XTMP("GMRAFA",0)=$$FMADD^XLFDT(DT,7,0,0,0)_U_DT_U_"GMRA ASSESSMENT FIX LOCKS",^XTMP("GMRAFA",DFN,DUZ)=$J
"RTN","GMRAFA",191,0)
 I $$VERIFY(DFN,.COUNT,.ASSESS) D  Q
"RTN","GMRAFA",192,0)
 .W !,"Number "_GMRAITM_" has already been corrected."
"RTN","GMRAFA",193,0)
 .D FLDTEXT^VALM10(GMRAITM,"ASSESSMENT",$$CJ^XLFSTR($$EASSESS($G(ASSESS("EXTERNAL"))),$P(VALMDDF("ASSESSMENT"),U,3)))
"RTN","GMRAFA",194,0)
 .D FLDTEXT^VALM10(GMRAITM,"ALLERGIES",$$CJ^XLFSTR(+$G(COUNT("GOOD")),$P(VALMDDF("ALLERGIES"),U,3)))
"RTN","GMRAFA",195,0)
 .D FLDTEXT^VALM10(GMRAITM,"STATUS","**FIXED**")
"RTN","GMRAFA",196,0)
 .D WAIT^GMRAFX3
"RTN","GMRAFA",197,0)
 D EN^VALM("GMRA ASSESS FIX DETAIL")
"RTN","GMRAFA",198,0)
 S ISFIXED=$$VERIFY(DFN,.COUNT,.ASSESS)
"RTN","GMRAFA",199,0)
 D FLDTEXT^VALM10(GMRAITM,"ASSESSMENT",$$CJ^XLFSTR($$EASSESS($G(ASSESS("EXTERNAL"))),$P(VALMDDF("ASSESSMENT"),U,3)))
"RTN","GMRAFA",200,0)
 D FLDTEXT^VALM10(GMRAITM,"ALLERGIES",$$CJ^XLFSTR(+$G(COUNT("GOOD")),$P(VALMDDF("ALLERGIES"),U,3)))
"RTN","GMRAFA",201,0)
 S GMRAACT=+$O(^TMP($J,"GMRAFAL","C",GMRAITM,0))
"RTN","GMRAFA",202,0)
 I GMRAACT>0,'ISFIXED D
"RTN","GMRAFA",203,0)
 .S ^XTMP("GMRAFAL",GMRAACT,DFN,"ASSESSMENT")=$$EASSESS($G(ASSESS("EXTERNAL")))
"RTN","GMRAFA",204,0)
 .S ^XTMP("GMRAFAL",GMRAACT,DFN,"ALLERGIES")=+$G(COUNT("GOOD"))
"RTN","GMRAFA",205,0)
 I ISFIXED D
"RTN","GMRAFA",206,0)
 .D FLDTEXT^VALM10(GMRAITM,"STATUS","**FIXED**")
"RTN","GMRAFA",207,0)
 .K:GMRAACT>0 ^XTMP("GMRAFAL",GMRAACT)
"RTN","GMRAFA",208,0)
 D WRITE^VALM10(GMRAITM)
"RTN","GMRAFA",209,0)
 D RE^VALM4
"RTN","GMRAFA",210,0)
 I $D(^XTMP("GMRAFA",DFN,DUZ)),($G(^XTMP("GMRAFA",DFN,DUZ))=$J) K ^XTMP("GMRAFA",DFN)
"RTN","GMRAFA",211,0)
 Q
"RTN","GMRAFA",212,0)
 ;
"RTN","GMRAFA1")
0^2^B22448935^n/a
"RTN","GMRAFA1",1,0)
GMRAFA1 ;ISP/RFR - CORRECT ASSESSMENTS DETAIL;04/11/2013  07:13
"RTN","GMRAFA1",2,0)
 ;;4.0;Adverse Reaction Tracking;**48**;Mar 29, 1996;Build 13
"RTN","GMRAFA1",3,0)
EN ; -- main entry point for GMRA ASSESS FIX DETAIL
"RTN","GMRAFA1",4,0)
 Q
"RTN","GMRAFA1",5,0)
 ;
"RTN","GMRAFA1",6,0)
HDR ; -- header code
"RTN","GMRAFA1",7,0)
 Q:'+$G(DFN)
"RTN","GMRAFA1",8,0)
 N VADM,VAIN,ASSESS,IEN
"RTN","GMRAFA1",9,0)
 D DEM^VADPT,INP^VADPT
"RTN","GMRAFA1",10,0)
 S VALMHDR(1)=$$LJ^XLFSTR("Patient: "_VADM(1)_" ("_$P(VADM(2),"-",3)_")",$S(+$G(IOM)>0:IOM,1:80)-10," ")_$S($D(VAIN):" Inpatient",1:"Outpatient")
"RTN","GMRAFA1",11,0)
 S IEN=+$O(^GMR(120.86,"B",DFN,0))
"RTN","GMRAFA1",12,0)
 S:IEN>0 ASSESS=$P($G(^GMR(120.86,IEN,0)),U,2)
"RTN","GMRAFA1",13,0)
 S VALMHDR(2)="Assessment: "_$S(IEN=0:"None on file",ASSESS=0:"No known reactions",ASSESS=1:"Has known reactions",1:"<ENTRY NOT FOUND>")
"RTN","GMRAFA1",14,0)
 S VALMHDR(3)="Allergy Listing"
"RTN","GMRAFA1",15,0)
 Q
"RTN","GMRAFA1",16,0)
 ;
"RTN","GMRAFA1",17,0)
INIT ; -- init variables and list array
"RTN","GMRAFA1",18,0)
 Q:'+$G(DFN)
"RTN","GMRAFA1",19,0)
 D CLEAN^VALM10
"RTN","GMRAFA1",20,0)
 N IEN,TEXT
"RTN","GMRAFA1",21,0)
 S VALMCNT=0
"RTN","GMRAFA1",22,0)
 S IEN=0 F  S IEN=$O(^GMR(120.8,"B",DFN,IEN)) Q:'IEN  D
"RTN","GMRAFA1",23,0)
 .S VALMCNT=VALMCNT+1
"RTN","GMRAFA1",24,0)
 .S TEXT="",TEXT=$$SETFLD^VALM1(VALMCNT_".",TEXT,"LINENO")
"RTN","GMRAFA1",25,0)
 .S TEXT=$$SETFLD^VALM1($P($G(^GMR(120.8,IEN,0)),U,2),TEXT,"REACTANT")
"RTN","GMRAFA1",26,0)
 .S TEXT=$$SETFLD^VALM1($$EIE(IEN),TEXT,"ERROR")
"RTN","GMRAFA1",27,0)
 .D SET^VALM10(VALMCNT,TEXT,IEN)
"RTN","GMRAFA1",28,0)
 S:VALMCNT=0 VALMSG="No reactions found"
"RTN","GMRAFA1",29,0)
 Q
"RTN","GMRAFA1",30,0)
 ;
"RTN","GMRAFA1",31,0)
EIE(IEN) ; -- return 'Entered in Error' text
"RTN","GMRAFA1",32,0)
 N RETURN
"RTN","GMRAFA1",33,0)
 S RETURN=$$GET1^DIQ(120.8,IEN_",",22)
"RTN","GMRAFA1",34,0)
 S RETURN=$S(RETURN'="":RETURN,1:"NO")
"RTN","GMRAFA1",35,0)
 Q RETURN
"RTN","GMRAFA1",36,0)
 ;
"RTN","GMRAFA1",37,0)
HELP ; -- help code
"RTN","GMRAFA1",38,0)
 D FULL^VALM1
"RTN","GMRAFA1",39,0)
 W !!,"Use MA to reassess the patient for adverse reactions.  The patient's current",!
"RTN","GMRAFA1",40,0)
 W "assessment appears in the upper-left corner of the screen.",!
"RTN","GMRAFA1",41,0)
 W !!,"Use RR to view a single reaction.  After the reaction is displayed, the system",!
"RTN","GMRAFA1",42,0)
 W "will ask if you want to mark the reaction as 'Entered in Error'.",!
"RTN","GMRAFA1",43,0)
 W !!,"Use EE to mark all displayed reactions as 'Entered in Error'.  Use extreme",!
"RTN","GMRAFA1",44,0)
 W "caution when performing a mass update.  It is better to first view the reaction",!
"RTN","GMRAFA1",45,0)
 W "and then mark it as 'Entered in Error'.",!
"RTN","GMRAFA1",46,0)
 D WAIT^GMRAFX3
"RTN","GMRAFA1",47,0)
 S VALMBCK="R"
"RTN","GMRAFA1",48,0)
 Q
"RTN","GMRAFA1",49,0)
 ;
"RTN","GMRAFA1",50,0)
EXIT ; -- exit code
"RTN","GMRAFA1",51,0)
 D FULL^VALM1
"RTN","GMRAFA1",52,0)
 Q
"RTN","GMRAFA1",53,0)
 ;
"RTN","GMRAFA1",54,0)
EXPND ; -- expand code
"RTN","GMRAFA1",55,0)
 Q
"RTN","GMRAFA1",56,0)
 ;
"RTN","GMRAFA1",57,0)
RR ; -- review reaction
"RTN","GMRAFA1",58,0)
 Q:$$NOLOCK
"RTN","GMRAFA1",59,0)
 N DIC,DA,DIQ,DIR,X,Y,DTOUT,DUOUT,DIRUT,DIROUT,GMRAPA,STATUS,GMRAITM
"RTN","GMRAFA1",60,0)
 D SELECT(.GMRAITM,"reactions")
"RTN","GMRAFA1",61,0)
 I 'GMRAITM S VALMSG="No reactions found" Q
"RTN","GMRAFA1",62,0)
 Q:GMRAITM<0
"RTN","GMRAFA1",63,0)
 S DA=+$O(@VALMAR@("IDX",GMRAITM,"")),DIC="^GMR(120.8,",DIQ(0)="CR"
"RTN","GMRAFA1",64,0)
 W ! D EN^DIQ
"RTN","GMRAFA1",65,0)
 S STATUS=$$EIE(DA)
"RTN","GMRAFA1",66,0)
 I STATUS="NO" D
"RTN","GMRAFA1",67,0)
 .S DIR(0)="YA"_U,DIR("A")="Would you like to mark this allergy as 'Entered in Error'? "
"RTN","GMRAFA1",68,0)
 .S DIR("B")="NO"
"RTN","GMRAFA1",69,0)
 .D ^DIR
"RTN","GMRAFA1",70,0)
 .I +$G(Y)>0 D 
"RTN","GMRAFA1",71,0)
 ..S GMRAPA=DA
"RTN","GMRAFA1",72,0)
 ..D MEIE
"RTN","GMRAFA1",73,0)
 I STATUS'="NO" D WAIT^GMRAFX3
"RTN","GMRAFA1",74,0)
 K VALMSG
"RTN","GMRAFA1",75,0)
 Q
"RTN","GMRAFA1",76,0)
 ;
"RTN","GMRAFA1",77,0)
UASSESS ; -- update assessment
"RTN","GMRAFA1",78,0)
 Q:$$NOLOCK
"RTN","GMRAFA1",79,0)
 D FULL^VALM1
"RTN","GMRAFA1",80,0)
 D NKAASK^GMRANKA(DFN)
"RTN","GMRAFA1",81,0)
 K VALMHDR,VALMSG
"RTN","GMRAFA1",82,0)
 D RE^VALM4
"RTN","GMRAFA1",83,0)
 Q
"RTN","GMRAFA1",84,0)
 ;
"RTN","GMRAFA1",85,0)
ALLEE ; -- mark all allergies as entered in error
"RTN","GMRAFA1",86,0)
 Q:$$NOLOCK
"RTN","GMRAFA1",87,0)
 I VALMCNT=0 D  Q
"RTN","GMRAFA1",88,0)
 .W !,"There are no reactions to mark."
"RTN","GMRAFA1",89,0)
 .S VALMSG="No reactions found"
"RTN","GMRAFA1",90,0)
 .D WAIT^GMRAFX3
"RTN","GMRAFA1",91,0)
 N DIR,X,Y,DTOUT,DUOUT,DIRUT,DIROUT
"RTN","GMRAFA1",92,0)
 S DIR(0)="YA"_U,DIR("A",1)="You are about to mark all of this patient's allergies as 'Entered in Error'."
"RTN","GMRAFA1",93,0)
 S DIR("A")="Do you want to continue? ",DIR("B")="NO"
"RTN","GMRAFA1",94,0)
 D ^DIR
"RTN","GMRAFA1",95,0)
 Q:$D(DIRUT)!($G(Y)<1)
"RTN","GMRAFA1",96,0)
 N GMRAPA,GMRAITM
"RTN","GMRAFA1",97,0)
 S GMRAITM=0 F  S GMRAITM=$O(@VALMAR@("IDX",GMRAITM)) Q:'$G(GMRAITM)  D
"RTN","GMRAFA1",98,0)
 .S GMRAPA=+$O(@VALMAR@("IDX",GMRAITM,""))
"RTN","GMRAFA1",99,0)
 .I '$P($G(^GMR(120.8,GMRAPA,"ER")),U) D
"RTN","GMRAFA1",100,0)
 ..S GMRAPA=+$O(@VALMAR@("IDX",GMRAITM,""))
"RTN","GMRAFA1",101,0)
 ..W !,"Marking "_$P($G(^GMR(120.8,GMRAPA,0)),U,2)_" as 'Entered in Error'...",!
"RTN","GMRAFA1",102,0)
 ..D MEIE
"RTN","GMRAFA1",103,0)
 Q
"RTN","GMRAFA1",104,0)
MEIE ; -- mark allergy as entered in error
"RTN","GMRAFA1",105,0)
 D EIE^GMRAFX3
"RTN","GMRAFA1",106,0)
 D FLDTEXT^VALM10(GMRAITM,"ERROR",$$EIE(GMRAPA))
"RTN","GMRAFA1",107,0)
 K VALMHDR,VALMSG
"RTN","GMRAFA1",108,0)
 D WRITE^VALM10(GMRAITM)
"RTN","GMRAFA1",109,0)
 Q
"RTN","GMRAFA1",110,0)
 ;
"RTN","GMRAFA1",111,0)
NOLOCK() ; -- determines if the user has a lock on the current patient
"RTN","GMRAFA1",112,0)
 N RETURN
"RTN","GMRAFA1",113,0)
 S RETURN=0
"RTN","GMRAFA1",114,0)
 I '$D(^XTMP("GMRAFA",DFN,DUZ)) S RETURN=1
"RTN","GMRAFA1",115,0)
 I $G(^XTMP("GMRAFA",DFN,DUZ))'=$J S RETURN=1
"RTN","GMRAFA1",116,0)
 I RETURN D
"RTN","GMRAFA1",117,0)
 .W !,"You no longer have a lock on this patient's records in this session.",!
"RTN","GMRAFA1",118,0)
 .W !,"Please reselect the patient."
"RTN","GMRAFA1",119,0)
 .S VALMBCK="Q"
"RTN","GMRAFA1",120,0)
 .D WAIT^GMRAFX3
"RTN","GMRAFA1",121,0)
 Q RETURN
"RTN","GMRAFA1",122,0)
SELECT(RETURN,ENTITIES) ; -- select an item from the list
"RTN","GMRAFA1",123,0)
 S RETURN=-1
"RTN","GMRAFA1",124,0)
 I VALMCNT=0 D  Q
"RTN","GMRAFA1",125,0)
 .W !,"There are no "_ENTITIES_" to select."
"RTN","GMRAFA1",126,0)
 .D WAIT^GMRAFX3
"RTN","GMRAFA1",127,0)
 .S RETURN=0
"RTN","GMRAFA1",128,0)
 N DIR,X,DTOUT,DUOUT,DIRUT,DIROUT
"RTN","GMRAFA1",129,0)
 S DIR(0)="N^1:"_VALMCNT_":0"
"RTN","GMRAFA1",130,0)
 D ^DIR
"RTN","GMRAFA1",131,0)
 Q:$D(DIRUT)!($D(DIROUT))
"RTN","GMRAFA1",132,0)
 D FULL^VALM1
"RTN","GMRAFA1",133,0)
 S RETURN=Y
"RTN","GMRAFA1",134,0)
 Q
"RTN","GMRAFA1",135,0)
 ;
"RTN","GMRANKA")
0^3^B14671193^B12980471
"RTN","GMRANKA",1,0)
GMRANKA ;HIRMFO/WAA - ALLERGY/ADVERSE REACTION PATIENT NKA DRIVE ;04/07/2016  13:21
"RTN","GMRANKA",2,0)
 ;;4.0;Adverse Reaction Tracking;**2,21,36,48**;Mar 29, 1996;Build 13
"RTN","GMRANKA",3,0)
NKA(DFN) ;See if patient has reaction on file
"RTN","GMRANKA",4,0)
 ;  Input Variables:
"RTN","GMRANKA",5,0)
 ;       DFN = Patient Internal Entry Number
"RTN","GMRANKA",6,0)
 ;
"RTN","GMRANKA",7,0)
 ;  Output Variables:
"RTN","GMRANKA",8,0)
 ;       GMA = 1 Patient has known reaction
"RTN","GMRANKA",9,0)
 ;             0 Patient has No known reaction
"RTN","GMRANKA",10,0)
 ;             Null Patient has never been asked about reaction
"RTN","GMRANKA",11,0)
 N GMRAIEN
"RTN","GMRANKA",12,0)
 S GMA="",GMRAIEN=+$O(^GMR(120.86,"B",DFN,0))
"RTN","GMRANKA",13,0)
 S:GMRAIEN>0 GMA=$P($G(^GMR(120.86,GMRAIEN,0)),U,2)
"RTN","GMRANKA",14,0)
 Q GMA
"RTN","GMRANKA",15,0)
 ;
"RTN","GMRANKA",16,0)
NKAASK(DFN,GMRAOUT) ; Ask a Patient if patient has any known allergens
"RTN","GMRANKA",17,0)
 ;  Input Variables
"RTN","GMRANKA",18,0)
 ;     DFN = Patient Internal entry number
"RTN","GMRANKA",19,0)
 ;  GMRAOUT = Up Caret or time out flag
"RTN","GMRANKA",20,0)
 ;
"RTN","GMRANKA",21,0)
 ;Ask if patient has allergies
"RTN","GMRANKA",22,0)
 N DIR,Y,DIROUT,DTOUT,DIRUT,DUOUT,GMAOLD,GMRAIEN
"RTN","GMRANKA",23,0)
 S GMRAIEN=+$O(^GMR(120.86,"B",DFN,0))
"RTN","GMRANKA",24,0)
 S GMAOLD=$S(GMRAIEN>0:$P($G(^GMR(120.86,GMRAIEN,0)),U,2),1:"")
"RTN","GMRANKA",25,0)
 S DIR(0)="120.86,1^AO^I Y=0&'$$NKASCR^GMRANKA(DFN) D INFO^GMRANKA K X"
"RTN","GMRANKA",26,0)
 S DIR("A")="Does this patient have any known allergies or adverse reactions? "
"RTN","GMRANKA",27,0)
 S DIR("B")=$S(GMAOLD=1:"Yes",GMAOLD=0:"No",1:"") K:DIR("B")="" DIR("B")
"RTN","GMRANKA",28,0)
 S DIR("?")=$S(GMAOLD=0:"You may also enter @ to delete a previous NKA assessment and return the patient to a 'not assessed' state.  Use this if the NKA assessment was previously incorrectly entered.",1:"") ;21
"RTN","GMRANKA",29,0)
 D ^DIR
"RTN","GMRANKA",30,0)
 I $G(X)="@" D:GMAOLD=0 CLN W:GMAOLD=0 !,"Assessment deleted." Q  ;21 Allow removal of NKA
"RTN","GMRANKA",31,0)
 I $D(DTOUT)!$D(DIROUT) S GMRAOUT=1 Q  ;36
"RTN","GMRANKA",32,0)
 I $D(DUOUT) S GMRAOUT=2 Q  ;36
"RTN","GMRANKA",33,0)
 ; User Hits return and doesn't answer question
"RTN","GMRANKA",34,0)
 I Y="",GMAOLD="" Q  ;36
"RTN","GMRANKA",35,0)
 I Y'="",GMAOLD'=Y D
"RTN","GMRANKA",36,0)
 . N DIE,DA,DR,DO,DIC,X,DINUM
"RTN","GMRANKA",37,0)
 . I 'GMRAIEN D
"RTN","GMRANKA",38,0)
 . . S DIC="^GMR(120.86,",DIC(0)="",X=DFN,DIC("DR")="1////"_Y_";2////"_DUZ_";3///NOW"
"RTN","GMRANKA",39,0)
 . . I '$D(^GMR(120.86,DFN)) S DA=DFN,DINUM=DFN
"RTN","GMRANKA",40,0)
 . . D FILE^DICN
"RTN","GMRANKA",41,0)
 . I GMRAIEN>0 D
"RTN","GMRANKA",42,0)
 . . S DIE="^GMR(120.86,",DA=GMRAIEN,DR=$S(GMAOLD="":(".01////"_DFN_";"),1:"")_"1////"_Y_";2////"_DUZ_";3///NOW" ;36
"RTN","GMRANKA",43,0)
 . . D ^DIE
"RTN","GMRANKA",44,0)
 . Q
"RTN","GMRANKA",45,0)
 Q
"RTN","GMRANKA",46,0)
CLN ; Clean out entries that have not been answered.
"RTN","GMRANKA",47,0)
 S DIK="^GMR(120.86,",DA=$S($G(GMRAIEN)>0:GMRAIEN,1:DFN) D ^DIK K DIK,DA
"RTN","GMRANKA",48,0)
 Q
"RTN","GMRANKA",49,0)
INFO ; Info string
"RTN","GMRANKA",50,0)
 N GMASTR
"RTN","GMRANKA",51,0)
 S GMASTR(1)="Currently this patient has Causative Agents on file."
"RTN","GMRANKA",52,0)
 S GMASTR(2)="You will have to answer YES to this question and then"
"RTN","GMRANKA",53,0)
 S GMASTR(3)="indicate that each of the Causative Agents are incorrect."
"RTN","GMRANKA",54,0)
 S GMASTR(4)="Then you will be reasked this question and will be able"
"RTN","GMRANKA",55,0)
 S GMASTR(5)="to enter NO."
"RTN","GMRANKA",56,0)
 D WRITE^GMRADSP8(1,0,$C(7))
"RTN","GMRANKA",57,0)
 D WRITE^GMRADSP8(1,10,.GMASTR)
"RTN","GMRANKA",58,0)
 Q
"RTN","GMRANKA",59,0)
NKASCR(DFN) ; Is Patient NKA (No Known Allergy)
"RTN","GMRANKA",60,0)
 ;   Input Variable:
"RTN","GMRANKA",61,0)
 ;        DFN = Patient DFN in Patient file
"RTN","GMRANKA",62,0)
 ;
"RTN","GMRANKA",63,0)
 ;  Output Variable:
"RTN","GMRANKA",64,0)
 ;        GMA = 1 Patient is True NKA
"RTN","GMRANKA",65,0)
 ;            = 0 Patient has a reaction in file 120.8
"RTN","GMRANKA",66,0)
 ;
"RTN","GMRANKA",67,0)
 ; This code will screen out Entered in Error entries
"RTN","GMRANKA",68,0)
 S GMA=1
"RTN","GMRANKA",69,0)
 N GMAX
"RTN","GMRANKA",70,0)
 S GMAX=0
"RTN","GMRANKA",71,0)
 F  S GMAX=$O(^GMR(120.8,"B",DFN,GMAX)) Q:GMAX<1  D  Q:'GMA
"RTN","GMRANKA",72,0)
 .I +$G(^GMR(120.8,GMAX,"ER")) Q
"RTN","GMRANKA",73,0)
 .S GMA=0
"RTN","GMRANKA",74,0)
 .Q
"RTN","GMRANKA",75,0)
 Q GMA
"RTN","GMRANKA",76,0)
 ;
"RTN","GMRANKA",77,0)
DELNKA ;Remove assessment of NKA for a selected patient
"RTN","GMRANKA",78,0)
 N Y,DFN,DIR,DIC
"RTN","GMRANKA",79,0)
 S DIC=120.86,DIC(0)="AEMQZ",DIC("A")="Select PATIENT NAME: " D ^DIC Q:Y=-1
"RTN","GMRANKA",80,0)
 S DFN=+Y
"RTN","GMRANKA",81,0)
 W !
"RTN","GMRANKA",82,0)
 I $$NKA^GMRANKA(DFN)'=0 W !,"This patient doesn't currently have an assessment of NKA." Q
"RTN","GMRANKA",83,0)
 S DIR(0)="Y",DIR("A")="Delete NKA assessment for patient "_$G(Y(0,0)),DIR("B")="NO"
"RTN","GMRANKA",84,0)
 S DIR("?")="Enter Y to delete the NKA assessment and return the patient to a 'not assessed' status.  Enter N to cancel this action."
"RTN","GMRANKA",85,0)
 D ^DIR
"RTN","GMRANKA",86,0)
 I Y=1 D CLN^GMRANKA W "...Done"
"RTN","GMRANKA",87,0)
 Q
"RTN","GMRAY48")
0^^B544104^n/a
"RTN","GMRAY48",1,0)
GMRAY48 ;ISP/RFR - PATCH 48 PRE/POST INSTALL ACTIONS ;04/08/2016  06:32
"RTN","GMRAY48",2,0)
 ;;4.0;Adverse Reaction Tracking;**48**;Mar 29, 1996;Build 13
"RTN","GMRAY48",3,0)
 Q
"RTN","GMRAY48",4,0)
POST ;Post-Install Actions
"RTN","GMRAY48",5,0)
 N GMRAMSG
"RTN","GMRAY48",6,0)
 S GMRAMSG(1)="  Re-indexing the B cross-reference in the ADVERSE REACTION ASSESSMENT"
"RTN","GMRAY48",7,0)
 S GMRAMSG(2)="  file"
"RTN","GMRAY48",8,0)
 D BMES^XPDUTL(.GMRAMSG)
"RTN","GMRAY48",9,0)
 N DIK,DA
"RTN","GMRAY48",10,0)
 S DIK="^GMR(120.86,",DIK(1)=".01^B"
"RTN","GMRAY48",11,0)
 D ENALL2^DIK,ENALL^DIK
"RTN","GMRAY48",12,0)
 D MES^XPDUTL("  DONE")
"RTN","GMRAY48",13,0)
 Q
"VER")
8.0^22.0
"BLD",8672,6)
^45
**END**
**END**

