Released GMRA*4*54 SEQ #51
Extracted from mail message
**KIDS**:GMRA*4.0*54^

**INSTALL NAME**
GMRA*4.0*54
"BLD",10324,0)
GMRA*4.0*54^ADVERSE REACTION TRACKING^0^3170421^y
"BLD",10324,1,0)
^^8^8^3170413^
"BLD",10324,1,1,0)
Patch GMRA*4.0*54 addresses the following three issues:
"BLD",10324,1,2,0)
 
"BLD",10324,1,3,0)
1. FDA report SUBSCRIPT error with non-VA drugs 
"BLD",10324,1,4,0)
 
"BLD",10324,1,5,0)
2. Adverse Reaction Assessment update when no previous Reaction 
"BLD",10324,1,6,0)
   Assessment value
"BLD",10324,1,7,0)
 
"BLD",10324,1,8,0)
3. Allergy file allows MECHANISM to be null
"BLD",10324,4,0)
^9.64PA^120.8^1
"BLD",10324,4,120.8,0)
120.8
"BLD",10324,4,120.8,2,0)
^9.641^120.8^1
"BLD",10324,4,120.8,2,120.8,0)
PATIENT ALLERGIES  (File-top level)
"BLD",10324,4,120.8,2,120.8,1,0)
^9.6411^17^1
"BLD",10324,4,120.8,2,120.8,1,17,0)
MECHANISM
"BLD",10324,4,120.8,222)
y^n^p^^^^n^^n
"BLD",10324,4,120.8,224)

"BLD",10324,4,"APDD",120.8,120.8)

"BLD",10324,4,"APDD",120.8,120.8,17)

"BLD",10324,4,"B",120.8,120.8)

"BLD",10324,6.3)
5
"BLD",10324,"INID")
^
"BLD",10324,"INIT")

"BLD",10324,"KRN",0)
^9.67PA^779.2^20
"BLD",10324,"KRN",.4,0)
.4
"BLD",10324,"KRN",.401,0)
.401
"BLD",10324,"KRN",.402,0)
.402
"BLD",10324,"KRN",.403,0)
.403
"BLD",10324,"KRN",.5,0)
.5
"BLD",10324,"KRN",.84,0)
.84
"BLD",10324,"KRN",3.6,0)
3.6
"BLD",10324,"KRN",3.8,0)
3.8
"BLD",10324,"KRN",9.2,0)
9.2
"BLD",10324,"KRN",9.8,0)
9.8
"BLD",10324,"KRN",9.8,"NM",0)
^9.68A^2^2
"BLD",10324,"KRN",9.8,"NM",1,0)
GMRANKA^^0^B15183005
"BLD",10324,"KRN",9.8,"NM",2,0)
GMRAPHR0^^0^B20012768
"BLD",10324,"KRN",9.8,"NM","B","GMRANKA",1)

"BLD",10324,"KRN",9.8,"NM","B","GMRAPHR0",2)

"BLD",10324,"KRN",19,0)
19
"BLD",10324,"KRN",19,"NM",0)
^9.68A^^
"BLD",10324,"KRN",19.1,0)
19.1
"BLD",10324,"KRN",101,0)
101
"BLD",10324,"KRN",409.61,0)
409.61
"BLD",10324,"KRN",771,0)
771
"BLD",10324,"KRN",779.2,0)
779.2
"BLD",10324,"KRN",870,0)
870
"BLD",10324,"KRN",8989.51,0)
8989.51
"BLD",10324,"KRN",8989.52,0)
8989.52
"BLD",10324,"KRN",8994,0)
8994
"BLD",10324,"KRN","B",.4,.4)

"BLD",10324,"KRN","B",.401,.401)

"BLD",10324,"KRN","B",.402,.402)

"BLD",10324,"KRN","B",.403,.403)

"BLD",10324,"KRN","B",.5,.5)

"BLD",10324,"KRN","B",.84,.84)

"BLD",10324,"KRN","B",3.6,3.6)

"BLD",10324,"KRN","B",3.8,3.8)

"BLD",10324,"KRN","B",9.2,9.2)

"BLD",10324,"KRN","B",9.8,9.8)

"BLD",10324,"KRN","B",19,19)

"BLD",10324,"KRN","B",19.1,19.1)

"BLD",10324,"KRN","B",101,101)

"BLD",10324,"KRN","B",409.61,409.61)

"BLD",10324,"KRN","B",771,771)

"BLD",10324,"KRN","B",779.2,779.2)

"BLD",10324,"KRN","B",870,870)

"BLD",10324,"KRN","B",8989.51,8989.51)

"BLD",10324,"KRN","B",8989.52,8989.52)

"BLD",10324,"KRN","B",8994,8994)

"BLD",10324,"QDEF")
^^^^NO^^^^NO^^NO
"BLD",10324,"QUES",0)
^9.62^^
"BLD",10324,"REQB",0)
^9.611^1^1
"BLD",10324,"REQB",1,0)
GMRA*4.0*48^2
"BLD",10324,"REQB","B","GMRA*4.0*48",1)

"FIA",120.8)
PATIENT ALLERGIES
"FIA",120.8,0)
^GMR(120.8,
"FIA",120.8,0,0)
120.8IPs
"FIA",120.8,0,1)
y^n^p^^^^n^^n
"FIA",120.8,0,10)

"FIA",120.8,0,11)

"FIA",120.8,0,"RLRO")

"FIA",120.8,0,"VR")
4.0^GMRA
"FIA",120.8,120.8)
1
"FIA",120.8,120.8,17)

"IX",120.8,120.8,"AHDR",0)
120.8^AHDR^Sends data to HDR upon entry^MU^^R^R^I^120.8^^^^^A
"IX",120.8,120.8,"AHDR",.1,0)
^^2^2^3041220
"IX",120.8,120.8,"AHDR",.1,1,0)
This cross reference will send the HDR allergy data upon entry or editing 
"IX",120.8,120.8,"AHDR",.1,2,0)
of allergy related data.
"IX",120.8,120.8,"AHDR",1)
Q:$D(DIU(0))  D SETADR^GMRAHDR
"IX",120.8,120.8,"AHDR",2)
Q:$D(DIU(0))  D KILLADR^GMRAHDR
"IX",120.8,120.8,"AHDR",2.5)
Q
"IX",120.8,120.8,"AHDR",11.1,0)
^.114IA^15^15
"IX",120.8,120.8,"AHDR",11.1,1,0)
1^F^120.8^.01^^^F
"IX",120.8,120.8,"AHDR",11.1,2,0)
2^F^120.8^.02^^^F
"IX",120.8,120.8,"AHDR",11.1,3,0)
3^F^120.8^1^^^F
"IX",120.8,120.8,"AHDR",11.1,4,0)
4^F^120.8^3.1^^^F
"IX",120.8,120.8,"AHDR",11.1,5,0)
5^F^120.8^4^^^F
"IX",120.8,120.8,"AHDR",11.1,6,0)
6^F^120.8^5^^^F
"IX",120.8,120.8,"AHDR",11.1,7,0)
7^F^120.8^6^^^F
"IX",120.8,120.8,"AHDR",11.1,8,0)
8^F^120.8^15^^^F
"IX",120.8,120.8,"AHDR",11.1,9,0)
9^F^120.8^17^^^F
"IX",120.8,120.8,"AHDR",11.1,10,0)
10^F^120.8^19^^^F
"IX",120.8,120.8,"AHDR",11.1,11,0)
11^F^120.8^20^^^F
"IX",120.8,120.8,"AHDR",11.1,12,0)
12^F^120.8^21^^^F
"IX",120.8,120.8,"AHDR",11.1,13,0)
13^F^120.8^22^^^F
"IX",120.8,120.8,"AHDR",11.1,14,0)
14^F^120.8^23^^^F
"IX",120.8,120.8,"AHDR",11.1,15,0)
15^F^120.8^24^^^F
"MBREQ")
0
"PKG",478,-1)
1^1
"PKG",478,0)
ADVERSE REACTION TRACKING^GMRA^Adverse Reaction Tracking package
"PKG",478,20,0)
^9.402P^2^1
"PKG",478,20,2,0)
2^^GMRAMRG
"PKG",478,20,2,1)

"PKG",478,20,"B",2,2)

"PKG",478,22,0)
^9.49I^1^1
"PKG",478,22,1,0)
4.0^2960328
"PKG",478,22,1,"PAH",1,0)
54^3170421
"PKG",478,22,1,"PAH",1,1,0)
^^8^8^3170421
"PKG",478,22,1,"PAH",1,1,1,0)
Patch GMRA*4.0*54 addresses the following three issues:
"PKG",478,22,1,"PAH",1,1,2,0)
 
"PKG",478,22,1,"PAH",1,1,3,0)
1. FDA report SUBSCRIPT error with non-VA drugs 
"PKG",478,22,1,"PAH",1,1,4,0)
 
"PKG",478,22,1,"PAH",1,1,5,0)
2. Adverse Reaction Assessment update when no previous Reaction 
"PKG",478,22,1,"PAH",1,1,6,0)
   Assessment value
"PKG",478,22,1,"PAH",1,1,7,0)
 
"PKG",478,22,1,"PAH",1,1,8,0)
3. Allergy file allows MECHANISM to be null
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
2
"RTN","GMRANKA")
0^1^B15183005^B14671193
"RTN","GMRANKA",1,0)
GMRANKA ;HIRMFO/WAA - ALLERGY/ADVERSE REACTION PATIENT NKA DRIVE ;04/13/2017  13:21
"RTN","GMRANKA",2,0)
 ;;4.0;Adverse Reaction Tracking;**2,21,36,48,54**;Mar 29, 1996;Build 5
"RTN","GMRANKA",3,0)
NKA(DFN) ;See if patient has reaction on file
"RTN","GMRANKA",4,0)
 ;  Input Variables:
"RTN","GMRANKA",5,0)
 ;       DFN = Patient Internal Entry Number
"RTN","GMRANKA",6,0)
 ;
"RTN","GMRANKA",7,0)
 ;  Output Variables:
"RTN","GMRANKA",8,0)
 ;       GMA = 1 Patient has known reaction
"RTN","GMRANKA",9,0)
 ;             0 Patient has No known reaction
"RTN","GMRANKA",10,0)
 ;             Null Patient has never been asked about reaction
"RTN","GMRANKA",11,0)
 N GMRAIEN
"RTN","GMRANKA",12,0)
 S GMA="",GMRAIEN=+$O(^GMR(120.86,"B",DFN,0))
"RTN","GMRANKA",13,0)
 S:GMRAIEN>0 GMA=$P($G(^GMR(120.86,GMRAIEN,0)),U,2)
"RTN","GMRANKA",14,0)
 Q GMA
"RTN","GMRANKA",15,0)
 ;
"RTN","GMRANKA",16,0)
NKAASK(DFN,GMRAOUT) ; Ask a Patient if patient has any known allergens
"RTN","GMRANKA",17,0)
 ;  Input Variables
"RTN","GMRANKA",18,0)
 ;     DFN = Patient Internal entry number
"RTN","GMRANKA",19,0)
 ;  GMRAOUT = Up Caret or time out flag
"RTN","GMRANKA",20,0)
 ;
"RTN","GMRANKA",21,0)
 ;Ask if patient has allergies
"RTN","GMRANKA",22,0)
 N DIR,Y,DIROUT,DTOUT,DIRUT,DUOUT,GMAOLD,GMRAIEN
"RTN","GMRANKA",23,0)
 S GMRAIEN=+$O(^GMR(120.86,"B",DFN,0))
"RTN","GMRANKA",24,0)
 S GMAOLD=$S(GMRAIEN>0:$P($G(^GMR(120.86,GMRAIEN,0)),U,2),1:"")
"RTN","GMRANKA",25,0)
 S DIR(0)="120.86,1^AO^I Y=0&'$$NKASCR^GMRANKA(DFN) D INFO^GMRANKA K X"
"RTN","GMRANKA",26,0)
 S DIR("A")="Does this patient have any known allergies or adverse reactions? "
"RTN","GMRANKA",27,0)
 S DIR("B")=$S(GMAOLD=1:"Yes",GMAOLD=0:"No",1:"") K:DIR("B")="" DIR("B")
"RTN","GMRANKA",28,0)
 S DIR("?")=$S(GMAOLD=0:"You may also enter @ to delete a previous NKA assessment and return the patient to a 'not assessed' state.  Use this if the NKA assessment was previously incorrectly entered.",1:"") ;21
"RTN","GMRANKA",29,0)
 D ^DIR
"RTN","GMRANKA",30,0)
 I $G(X)="@" D:GMAOLD=0 CLN W:GMAOLD=0 !,"Assessment deleted." Q  ;21 Allow removal of NKA
"RTN","GMRANKA",31,0)
 I $D(DTOUT)!$D(DIROUT) S GMRAOUT=1 Q  ;36
"RTN","GMRANKA",32,0)
 I $D(DUOUT) S GMRAOUT=2 Q  ;36
"RTN","GMRANKA",33,0)
 ; User Hits return and doesn't answer question
"RTN","GMRANKA",34,0)
 I Y="",GMAOLD="" Q  ;36
"RTN","GMRANKA",35,0)
 I Y'="",GMAOLD'=Y D
"RTN","GMRANKA",36,0)
 . N DIE,DA,DR,DO,DIC,X,DINUM
"RTN","GMRANKA",37,0)
 . I 'GMRAIEN D
"RTN","GMRANKA",38,0)
 . . S DIC="^GMR(120.86,",DIC(0)="",X=DFN,DIC("DR")="1////"_Y_";2////"_DUZ_";3///NOW"
"RTN","GMRANKA",39,0)
 . . I '$D(^GMR(120.86,DFN)) S DA=DFN,DINUM=DFN
"RTN","GMRANKA",40,0)
 . . D FILE^DICN
"RTN","GMRANKA",41,0)
 . I GMRAIEN>0 D
"RTN","GMRANKA",42,0)
 . . S DIE="^GMR(120.86,",DA=GMRAIEN,DR=$S(GMAOLD=""&($P($G(^GMR(120.86,GMRAIEN,0)),"^")'=GMRAIEN):(".01////"_DFN_";"),1:"")_"1////"_Y_";2////"_DUZ_";3///NOW" ;36,54
"RTN","GMRANKA",43,0)
 . . D ^DIE
"RTN","GMRANKA",44,0)
 . Q
"RTN","GMRANKA",45,0)
 Q
"RTN","GMRANKA",46,0)
CLN ; Clean out entries that have not been answered.
"RTN","GMRANKA",47,0)
 S DIK="^GMR(120.86,",DA=$S($G(GMRAIEN)>0:GMRAIEN,1:DFN) D ^DIK K DIK,DA
"RTN","GMRANKA",48,0)
 Q
"RTN","GMRANKA",49,0)
INFO ; Info string
"RTN","GMRANKA",50,0)
 N GMASTR
"RTN","GMRANKA",51,0)
 S GMASTR(1)="Currently this patient has Causative Agents on file."
"RTN","GMRANKA",52,0)
 S GMASTR(2)="You will have to answer YES to this question and then"
"RTN","GMRANKA",53,0)
 S GMASTR(3)="indicate that each of the Causative Agents are incorrect."
"RTN","GMRANKA",54,0)
 S GMASTR(4)="Then you will be reasked this question and will be able"
"RTN","GMRANKA",55,0)
 S GMASTR(5)="to enter NO."
"RTN","GMRANKA",56,0)
 D WRITE^GMRADSP8(1,0,$C(7))
"RTN","GMRANKA",57,0)
 D WRITE^GMRADSP8(1,10,.GMASTR)
"RTN","GMRANKA",58,0)
 Q
"RTN","GMRANKA",59,0)
NKASCR(DFN) ; Is Patient NKA (No Known Allergy)
"RTN","GMRANKA",60,0)
 ;   Input Variable:
"RTN","GMRANKA",61,0)
 ;        DFN = Patient DFN in Patient file
"RTN","GMRANKA",62,0)
 ;
"RTN","GMRANKA",63,0)
 ;  Output Variable:
"RTN","GMRANKA",64,0)
 ;        GMA = 1 Patient is True NKA
"RTN","GMRANKA",65,0)
 ;            = 0 Patient has a reaction in file 120.8
"RTN","GMRANKA",66,0)
 ;
"RTN","GMRANKA",67,0)
 ; This code will screen out Entered in Error entries
"RTN","GMRANKA",68,0)
 S GMA=1
"RTN","GMRANKA",69,0)
 N GMAX
"RTN","GMRANKA",70,0)
 S GMAX=0
"RTN","GMRANKA",71,0)
 F  S GMAX=$O(^GMR(120.8,"B",DFN,GMAX)) Q:GMAX<1  D  Q:'GMA
"RTN","GMRANKA",72,0)
 .I +$G(^GMR(120.8,GMAX,"ER")) Q
"RTN","GMRANKA",73,0)
 .S GMA=0
"RTN","GMRANKA",74,0)
 .Q
"RTN","GMRANKA",75,0)
 Q GMA
"RTN","GMRANKA",76,0)
 ;
"RTN","GMRANKA",77,0)
DELNKA ;Remove assessment of NKA for a selected patient
"RTN","GMRANKA",78,0)
 N Y,DFN,DIR,DIC
"RTN","GMRANKA",79,0)
 S DIC=120.86,DIC(0)="AEMQZ",DIC("A")="Select PATIENT NAME: " D ^DIC Q:Y=-1
"RTN","GMRANKA",80,0)
 S DFN=+Y
"RTN","GMRANKA",81,0)
 W !
"RTN","GMRANKA",82,0)
 I $$NKA^GMRANKA(DFN)'=0 W !,"This patient doesn't currently have an assessment of NKA." Q
"RTN","GMRANKA",83,0)
 S DIR(0)="Y",DIR("A")="Delete NKA assessment for patient "_$G(Y(0,0)),DIR("B")="NO"
"RTN","GMRANKA",84,0)
 S DIR("?")="Enter Y to delete the NKA assessment and return the patient to a 'not assessed' status.  Enter N to cancel this action."
"RTN","GMRANKA",85,0)
 D ^DIR
"RTN","GMRANKA",86,0)
 I Y=1 D CLN^GMRANKA W "...Done"
"RTN","GMRANKA",87,0)
 Q
"RTN","GMRAPHR0")
0^2^B20012768^B17991408
"RTN","GMRAPHR0",1,0)
GMRAPHR0 ;HIRMFO/WAA-THIS PROGRAM WILL DISPLAY ALL PHARM FOR A PATIENT ;4/12/17  14:44
"RTN","GMRAPHR0",2,0)
 ;;4.0;Adverse Reaction Tracking;**7,54**;Mar 29, 1996;Build 5
"RTN","GMRAPHR0",3,0)
DISP ;DISPLAY ALL THE DRUGS FOR THIS PATIENT
"RTN","GMRAPHR0",4,0)
 K ^UTILITY("PSG",$J),^UTILITY("PSIV",$J)
"RTN","GMRAPHR0",5,0)
 S GMRAPHRV=+$$VERSION^XPDUTL("PSO"),GMRAPHRG=$S(GMRAPHRV<6:"^UTILITY(",1:"^TMP(")
"RTN","GMRAPHR0",6,0)
 K @(GMRAPHRG_"""PSOO"",$J)"),GMRARRAY
"RTN","GMRAPHR0",7,0)
 S GMRACT=1,GMRACH=1
"RTN","GMRAPHR0",8,0)
 S DFN=+GMRAPA(0)
"RTN","GMRAPHR0",9,0)
 N GMRAFNVA S GMRAFNVA=0 ;54
"RTN","GMRAPHR0",10,0)
 D DT Q:GMRAOUT
"RTN","GMRAPHR0",11,0)
 S GMRALOOK=1,GMRADATA=0
"RTN","GMRAPHR0",12,0)
 S X="PSOHCSUM" X ^%ZOSF("TEST") S:'$T GMRADATA=GMRADATA+1 I $T S PSOBEGIN=+$P($P(GMRABGDT,U),".") D ^PSOHCSUM
"RTN","GMRAPHR0",13,0)
 S X="PSJEEU0" X ^%ZOSF("TEST") S:'$T GMRADATA=GMRADATA+100 I $T S PSJEDT=GMRABGDT D ENHS^PSJEEU0
"RTN","GMRAPHR0",14,0)
 S GMRACT=1
"RTN","GMRAPHR0",15,0)
 S GMRAY="" F GMRAX=0:0 S GMRAY=$O(@(GMRAPHRG_"""PSOO"",$J,GMRAY)")) Q:GMRAY=""  D
"RTN","GMRAPHR0",16,0)
 .I GMRAY="NVA" S GMRAFNVA=1 Q  ;54
"RTN","GMRAPHR0",17,0)
 .S GMRAZ=$G(@(GMRAPHRG_"""PSOO"",$J,GMRAY,0)"))
"RTN","GMRAPHR0",18,0)
 .I $P(GMRAZ,U)'>$P(GMRAENDT,U) D
"RTN","GMRAPHR0",19,0)
 ..S GMRADRG="OP"_U_$P($P(GMRAZ,U,3),";",2)_U_$G(@(GMRAPHRG_"""PSOO"",$J,GMRAY,1)"))_U_$P(GMRAZ,U,2)
"RTN","GMRAPHR0",20,0)
 ..S GMRARRAY("PH",GMRACT)=GMRADRG,GMRACT=GMRACT+1
"RTN","GMRAPHR0",21,0)
 ..Q
"RTN","GMRAPHR0",22,0)
 .Q
"RTN","GMRAPHR0",23,0)
 S GMRAY="" F GMRAX=0:0 S GMRAY=$O(^UTILITY("PSG",$J,GMRAY)) Q:GMRAY=""  D
"RTN","GMRAPHR0",24,0)
 .S GMRAZ=$G(^UTILITY("PSG",$J,GMRAY))
"RTN","GMRAPHR0",25,0)
 .I $P(GMRAZ,U,2)'<GMRABGDT,$P(GMRAZ,U)'>GMRAENDT D
"RTN","GMRAPHR0",26,0)
 ..S GMRADRG="D"_U_$P($P(GMRAZ,U,3),";",2)_U_$P(GMRAZ,U,6)_U_$P($P(GMRAZ,U,7),";",2)_U_$P($P(GMRAZ,U,8),";",2)_U_$P(GMRAZ,U,1,2)
"RTN","GMRAPHR0",27,0)
 ..S GMRARRAY("PH",GMRACT)=GMRADRG,GMRACT=GMRACT+1
"RTN","GMRAPHR0",28,0)
 ..Q
"RTN","GMRAPHR0",29,0)
 .Q
"RTN","GMRAPHR0",30,0)
 S GMRAY="" F GMRAX=0:0 S GMRAY=$O(^UTILITY("PSIV",$J,GMRAY)) Q:GMRAY=""  D
"RTN","GMRAPHR0",31,0)
 .S GMRAZ=$G(^UTILITY("PSIV",$J,GMRAY,0))
"RTN","GMRAPHR0",32,0)
 .I $P(GMRAZ,U,2)'<GMRABGDT,$P(GMRAZ,U)'>GMRAENDT D
"RTN","GMRAPHR0",33,0)
 ..S GMRADRG(1)=GMRAZ,GMRAZ=0 F  S GMRAZ=$O(^UTILITY("PSIV",$J,GMRAY,"A",GMRAZ)) Q:GMRAZ<1  D
"RTN","GMRAPHR0",34,0)
 ...S GMRADRG="IV"_U_$P($P(^UTILITY("PSIV",$J,GMRAY,"A",GMRAZ),U),";",2)_U_$P(^(GMRAZ),U,2)
"RTN","GMRAPHR0",35,0)
 ...S GMRADRG=GMRADRG_U_$P(GMRADRG(1),U,5,6)_U_$P(GMRADRG(1),U,1,2)
"RTN","GMRAPHR0",36,0)
 ...S GMRARRAY("PH",GMRACT)=GMRADRG,GMRACT=GMRACT+1
"RTN","GMRAPHR0",37,0)
 ...Q
"RTN","GMRAPHR0",38,0)
 ..Q
"RTN","GMRAPHR0",39,0)
 .Q
"RTN","GMRAPHR0",40,0)
DISP2 W @IOF,!,"PHARMACY:",?60,"Start/Last",!
"RTN","GMRAPHR0",41,0)
 W ?3,"Drug",?61,"Fill DT",?71,"Stop Date"
"RTN","GMRAPHR0",42,0)
 I '$D(GMRARRAY("PH")) W !,?5,"THERE AREN'T ANY RXS ON FILE FOR THIS PATIENT" Q
"RTN","GMRAPHR0",43,0)
 F GMRACH=GMRACH:1 Q:'$D(GMRARRAY("PH",GMRACH))  D  Q:GMRAOUT
"RTN","GMRAPHR0",44,0)
 .I $Y+3>IOSL D  Q:GMRAOUT
"RTN","GMRAPHR0",45,0)
 ..F  W !,"Press RETURN to continue, ""^"" to exit: " R X:DTIME S:'$T X="^^" S:"^^"[X GMRAOUT=$L(X) Q:("^^"[X)  W !,?4,$C(7),"PRESS RETURN TO CONTINUE OR ""^"" TO EXIT THIS LISTING"
"RTN","GMRAPHR0",46,0)
 ..Q:GMRAOUT
"RTN","GMRAPHR0",47,0)
 ..W @IOF,!,"PHARMACY:",?60,"Start/Last",!,?3,"Drug",?61,"Fill DT",?71,"Stop Date"
"RTN","GMRAPHR0",48,0)
 ..Q
"RTN","GMRAPHR0",49,0)
 .S GMRADRG=GMRARRAY("PH",GMRACH)
"RTN","GMRAPHR0",50,0)
 .I $P(GMRADRG,U)="OP" D
"RTN","GMRAPHR0",51,0)
 ..W !,GMRACH,?3,"(O) ",$E($P(GMRADRG,U,2),1,50)
"RTN","GMRAPHR0",52,0)
 ..W ?61,$$FMTE^XLFDT($P(GMRADRG,U,4),2)
"RTN","GMRAPHR0",53,0)
 ..W !,?3,$P(GMRADRG,U,3)
"RTN","GMRAPHR0",54,0)
 ..Q
"RTN","GMRAPHR0",55,0)
 .I $P(GMRADRG,U)="D" D
"RTN","GMRAPHR0",56,0)
 ..W !,GMRACH,?3,$E($P(GMRADRG,U,2),1,54)
"RTN","GMRAPHR0",57,0)
 ..W ?61,$$FMTE^XLFDT($P(GMRADRG,U,6),2)
"RTN","GMRAPHR0",58,0)
 ..W ?71,$$FMTE^XLFDT($P(GMRADRG,U,7),2)
"RTN","GMRAPHR0",59,0)
 ..W !,?3,$P(GMRADRG,U,3)," ",$P(GMRADRG,U,4)," ",$P(GMRADRG,U,5)
"RTN","GMRAPHR0",60,0)
 ..Q
"RTN","GMRAPHR0",61,0)
 .I $P(GMRADRG,U)="IV" D
"RTN","GMRAPHR0",62,0)
 ..W !,GMRACH,?3,$E($P(GMRADRG,U,2),1,54)
"RTN","GMRAPHR0",63,0)
 ..W ?61,$$FMTE^XLFDT($P(GMRADRG,U,6),2)
"RTN","GMRAPHR0",64,0)
 ..W ?71,$$FMTE^XLFDT($P(GMRADRG,U,7),2)
"RTN","GMRAPHR0",65,0)
 ..W !,?3,$P(GMRADRG,U,3)," IV ",$P(GMRADRG,U,4)," ",$P(GMRADRG,U,5)
"RTN","GMRAPHR0",66,0)
 ..Q
"RTN","GMRAPHR0",67,0)
 .Q
"RTN","GMRAPHR0",68,0)
 I GMRAFNVA D  ;54
"RTN","GMRAPHR0",69,0)
 .W !,"There are Non-VA Meds on this patient's profile. Please review for possible" ;54 
"RTN","GMRAPHR0",70,0)
 .W !,"manual inclusion in this report.",! ;54
"RTN","GMRAPHR0",71,0)
 .Q  ;54
"RTN","GMRAPHR0",72,0)
 K ^UTILITY("PSG",$J),^UTILITY("PSIV",$J),@(GMRAPHRG_"""PSOO"",$J)")
"RTN","GMRAPHR0",73,0)
 Q
"RTN","GMRAPHR0",74,0)
DT ;SELECT LOOKUP DATE RANGE
"RTN","GMRAPHR0",75,0)
 I GMRALOOK Q
"RTN","GMRAPHR0",76,0)
 I '$D(GMRABGDT) S (GMRABGDT,GMRAENDT)=""
"RTN","GMRAPHR0",77,0)
 W !
"RTN","GMRAPHR0",78,0)
 S X1=$S(GMRABGDT'="":+GMRABGDT,1:GMRADT),X2=0 D C^%DTC S Y=(X*10000\1/10000) D D^DIQ
"RTN","GMRAPHR0",79,0)
 S %DT("A")="View DRUG from: ",%DT("B")=Y,%DT="AETP" D ^%DT K %DT S:X="^" GMRAOUT=2 Q:+Y<1  S GMRABGDT=+Y D D^DIQ S $P(GMRABGDT,U,2)=Y
"RTN","GMRAPHR0",80,0)
 S X1=$S(GMRAENDT'="":+GMRAENDT,1:GMRADT),X2=0 D C^%DTC S Y=(X*10000\1/10000) D D^DIQ S %DT("A")="To: ",%DT("B")=Y,%DT="AETP",%DT(0)=+GMRABGDT D ^%DT K %DT S:X="^" GMRAOUT=2 Q:Y<1
"RTN","GMRAPHR0",81,0)
 S GMRAENDT=+Y S:'$P(GMRAENDT,".",2) GMRAENDT=GMRAENDT+.24 D D^DIQ S $P(GMRAENDT,U,2)=Y
"RTN","GMRAPHR0",82,0)
 Q
"RTN","GMRAPHR0",83,0)
DTFOR ;SET THE FORMAT OF DATE TIME TO MM/DD/YY@TIME
"RTN","GMRAPHR0",84,0)
 Q:Y<1
"RTN","GMRAPHR0",85,0)
 S GMRATEMP=$$DATE^GMRAUTL1(Y)
"RTN","GMRAPHR0",86,0)
 S GMRATEMP=$E(GMRATEMP,4,5)_"/"_$E(GMRATEMP,6,7)_"/"_$E(GMRATEMP,2,3)
"RTN","GMRAPHR0",87,0)
 I $P(Y,"@",2)'="" S GMRATEMP=GMRATEMP_"@"_$P(Y,"@",2)
"RTN","GMRAPHR0",88,0)
 S Y=GMRATEMP K GMRATEMP
"RTN","GMRAPHR0",89,0)
 Q
"VER")
8.0^22.0
"^DD",120.8,120.8,17,0)
MECHANISM^RS^A:ALLERGY;P:PHARMACOLOGIC;U:UNKNOWN;^0;14^Q
"^DD",120.8,120.8,17,3)
Choose the mechanism of the reaction
"^DD",120.8,120.8,17,21,0)
2^^2^2^2941220^
"^DD",120.8,120.8,17,21,1,0)
This field indicates the mechanism of the reaction.
"^DD",120.8,120.8,17,21,2,0)
  
"^DD",120.8,120.8,17,"DT")
3170420
"BLD",10324,6)
^51
**END**
**END**

