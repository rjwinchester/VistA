Released HDI*1*21 SEQ #16
Extracted from mail message
**KIDS**:HDI*1.0*21^

**INSTALL NAME**
HDI*1.0*21
"BLD",10292,0)
HDI*1.0*21^HEALTH DATA & INFORMATICS^0^3180103^y
"BLD",10292,1,0)
^^4^4^3170914^^
"BLD",10292,1,1,0)
This patch supports Native Domain Standardization of the Medications 
"BLD",10292,1,2,0)
Dosage Form Domain.
"BLD",10292,1,3,0)
 
"BLD",10292,1,4,0)
Please see FORUM for full patch description and installation instructions.
"BLD",10292,4,0)
^9.64PA^^
"BLD",10292,6.3)
9
"BLD",10292,"ABPKG")
n
"BLD",10292,"INIT")
POST^HDI1021A
"BLD",10292,"KRN",0)
^9.67PA^779.2^20
"BLD",10292,"KRN",.4,0)
.4
"BLD",10292,"KRN",.401,0)
.401
"BLD",10292,"KRN",.402,0)
.402
"BLD",10292,"KRN",.403,0)
.403
"BLD",10292,"KRN",.5,0)
.5
"BLD",10292,"KRN",.84,0)
.84
"BLD",10292,"KRN",3.6,0)
3.6
"BLD",10292,"KRN",3.8,0)
3.8
"BLD",10292,"KRN",9.2,0)
9.2
"BLD",10292,"KRN",9.8,0)
9.8
"BLD",10292,"KRN",9.8,"NM",0)
^9.68A^3^3
"BLD",10292,"KRN",9.8,"NM",1,0)
HDI1021A^^0^B5646301
"BLD",10292,"KRN",9.8,"NM",2,0)
HDIPSZRT^^0^B30301671
"BLD",10292,"KRN",9.8,"NM",3,0)
HDIZRT^^0^B2560389
"BLD",10292,"KRN",9.8,"NM","B","HDI1021A",1)

"BLD",10292,"KRN",9.8,"NM","B","HDIPSZRT",2)

"BLD",10292,"KRN",9.8,"NM","B","HDIZRT",3)

"BLD",10292,"KRN",19,0)
19
"BLD",10292,"KRN",19,"NM",0)
^9.68A^^
"BLD",10292,"KRN",19.1,0)
19.1
"BLD",10292,"KRN",19.1,"NM",0)
^9.68A^^
"BLD",10292,"KRN",101,0)
101
"BLD",10292,"KRN",409.61,0)
409.61
"BLD",10292,"KRN",771,0)
771
"BLD",10292,"KRN",779.2,0)
779.2
"BLD",10292,"KRN",870,0)
870
"BLD",10292,"KRN",8989.51,0)
8989.51
"BLD",10292,"KRN",8989.52,0)
8989.52
"BLD",10292,"KRN",8994,0)
8994
"BLD",10292,"KRN","B",.4,.4)

"BLD",10292,"KRN","B",.401,.401)

"BLD",10292,"KRN","B",.402,.402)

"BLD",10292,"KRN","B",.403,.403)

"BLD",10292,"KRN","B",.5,.5)

"BLD",10292,"KRN","B",.84,.84)

"BLD",10292,"KRN","B",3.6,3.6)

"BLD",10292,"KRN","B",3.8,3.8)

"BLD",10292,"KRN","B",9.2,9.2)

"BLD",10292,"KRN","B",9.8,9.8)

"BLD",10292,"KRN","B",19,19)

"BLD",10292,"KRN","B",19.1,19.1)

"BLD",10292,"KRN","B",101,101)

"BLD",10292,"KRN","B",409.61,409.61)

"BLD",10292,"KRN","B",771,771)

"BLD",10292,"KRN","B",779.2,779.2)

"BLD",10292,"KRN","B",870,870)

"BLD",10292,"KRN","B",8989.51,8989.51)

"BLD",10292,"KRN","B",8989.52,8989.52)

"BLD",10292,"KRN","B",8994,8994)

"BLD",10292,"QDEF")
^^^^NO^^^^NO^^NO
"BLD",10292,"QUES",0)
^9.62^^
"BLD",10292,"REQB",0)
^9.611^2^2
"BLD",10292,"REQB",1,0)
HDI*1.0*6^2
"BLD",10292,"REQB",2,0)
XU*8.0*686^2
"BLD",10292,"REQB","B","HDI*1.0*6",1)

"BLD",10292,"REQB","B","XU*8.0*686",2)

"INIT")
POST^HDI1021A
"MBREQ")
0
"PKG",633,-1)
1^1
"PKG",633,0)
HEALTH DATA & INFORMATICS^HDI^Data Standardization
"PKG",633,20,0)
^9.402P^^
"PKG",633,22,0)
^9.49I^1^1
"PKG",633,22,1,0)
1.0^3050426^3050602^568
"PKG",633,22,1,"PAH",1,0)
21^3180103
"PKG",633,22,1,"PAH",1,1,0)
^^4^4^3180103
"PKG",633,22,1,"PAH",1,1,1,0)
This patch supports Native Domain Standardization of the Medications 
"PKG",633,22,1,"PAH",1,1,2,0)
Dosage Form Domain.
"PKG",633,22,1,"PAH",1,1,3,0)
 
"PKG",633,22,1,"PAH",1,1,4,0)
Please see FORUM for full patch description and installation instructions.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
3
"RTN","HDI1021A")
0^1^B5646301^n/a
"RTN","HDI1021A",1,0)
HDI1021A ;DAL/JCH - PATCH 21 POST INSTALL;09/13/2017
"RTN","HDI1021A",2,0)
 ;;1.0;HEALTH DATA & INFORMATICS;**21**;Feb 22, 2005;Build 9
"RTN","HDI1021A",3,0)
 ;
"RTN","HDI1021A",4,0)
POST ;
"RTN","HDI1021A",5,0)
 N DOMAIN,HDIDOM,HDIERROR,HDIMSG
"RTN","HDI1021A",6,0)
 ;
"RTN","HDI1021A",7,0)
 S HDIMSG(1)="Post-Installation (POST^HDI1021A) will now be run."
"RTN","HDI1021A",8,0)
 S HDIMSG(2)=" "
"RTN","HDI1021A",9,0)
 D MES^XPDUTL(.HDIMSG) K HDIMSG
"RTN","HDI1021A",10,0)
 ;
"RTN","HDI1021A",11,0)
 S DOMAIN="PHARMACY DATA MANAGEMENT" ; domain to be added to HDIS DOMAIN File #7115.1
"RTN","HDI1021A",12,0)
 ;
"RTN","HDI1021A",13,0)
 ; Domain should already have been added; if not, add domain
"RTN","HDI1021A",14,0)
 I '+$$GETIEN^HDISVF09(DOMAIN,.HDIDOM) I '+$$UPDTDOM^HDISVCUT(DOMAIN) D  Q
"RTN","HDI1021A",15,0)
 . D MES^XPDUTL("***** Error adding the "_DOMAIN_" domain to the HDIS DOMAIN FILE #7115.1."),PSTHALT("")
"RTN","HDI1021A",16,0)
 ;
"RTN","HDI1021A",17,0)
 ; get domain IEN
"RTN","HDI1021A",18,0)
 I '+$$GETIEN^HDISVF09(DOMAIN,.HDIDOM) D  Q
"RTN","HDI1021A",19,0)
 . D MES^XPDUTL("***** Error retrieving the IEN for the "_DOMAIN_" domain."),PSTHALT("")
"RTN","HDI1021A",20,0)
 ;
"RTN","HDI1021A",21,0)
 ; verify domain IEN
"RTN","HDI1021A",22,0)
 I '+HDIDOM D  Q
"RTN","HDI1021A",23,0)
 . D MES^XPDUTL("***** Error verifying the IEN for the "_DOMAIN_" domain."),PSTHALT("")
"RTN","HDI1021A",24,0)
 ;
"RTN","HDI1021A",25,0)
 ; get files & fields to be added to File #7115.6
"RTN","HDI1021A",26,0)
 N DATA,LINE F LINE=1:1 S DATA=$P($T(DATA+LINE),";;",2) Q:DATA=""  D
"RTN","HDI1021A",27,0)
 . N FILE,FIELD,HDIDATA,HDIERMSG
"RTN","HDI1021A",28,0)
 . S FILE=$P(DATA,U),FIELD=$P(DATA,U,2)
"RTN","HDI1021A",29,0)
 . I +$$GETIEN^HDISVF05(FILE,FIELD) Q  ; quit if entry already exists
"RTN","HDI1021A",30,0)
 . S HDIDATA(FILE)=FIELD
"RTN","HDI1021A",31,0)
 . ; add entry to HDIS FILE/FIELD File #7115.6
"RTN","HDI1021A",32,0)
 . I '+$$ADDDFFS^HDISVF09(HDIDOM,.HDIDATA,.HDIERMSG) D
"RTN","HDI1021A",33,0)
 . . I '$D(HDIERROR) D MES^XPDUTL("***** "_"Error updating File #7115.6")
"RTN","HDI1021A",34,0)
 . . S HDIERROR=1
"RTN","HDI1021A",35,0)
 . . D MES^XPDUTL("***** "_HDIERMSG)
"RTN","HDI1021A",36,0)
 ;
"RTN","HDI1021A",37,0)
 I +$D(HDIERROR) D PSTHALT("") Q
"RTN","HDI1021A",38,0)
 ;
"RTN","HDI1021A",39,0)
 S HDIMSG(1)="Post-Installation complete."
"RTN","HDI1021A",40,0)
 S HDIMSG(2)=""
"RTN","HDI1021A",41,0)
 D MES^XPDUTL(.HDIMSG)
"RTN","HDI1021A",42,0)
 Q
"RTN","HDI1021A",43,0)
PSTHALT(MSG) ; display error message
"RTN","HDI1021A",44,0)
 S HDIMSG(1)=""
"RTN","HDI1021A",45,0)
 S HDIMSG(2)=MSG
"RTN","HDI1021A",46,0)
 S HDIMSG(3)="***** Post-installation has been halted."
"RTN","HDI1021A",47,0)
 S HDIMSG(4)="***** Please contact Enterprise VistA Support."
"RTN","HDI1021A",48,0)
 S HDIMSG(5)=""
"RTN","HDI1021A",49,0)
 D MES^XPDUTL(.HDIMSG)
"RTN","HDI1021A",50,0)
 Q
"RTN","HDI1021A",51,0)
DATA ;
"RTN","HDI1021A",52,0)
 ;;50.60699^.01
"RTN","HDI1021A",53,0)
 ;;
"RTN","HDI1021A",54,0)
 Q
"RTN","HDIPSZRT")
0^2^B30301671^n/a
"RTN","HDIPSZRT",1,0)
HDIPSZRT ;DAL/PBB - DOSAGE FORM ENTRY POINTS FOR ZRT SEGMENT MFS UPDATE ;10/13/2017
"RTN","HDIPSZRT",2,0)
 ;;1.0;HEALTH DATA & INFORMATICS;**21**;Feb 22, 2005;Build 9
"RTN","HDIPSZRT",3,0)
 ;
"RTN","HDIPSZRT",4,0)
 Q
"RTN","HDIPSZRT",5,0)
ZRT ;Manipulate update of MFN ZRT segment for MED DOSAGE files
"RTN","HDIPSZRT",6,0)
 I IEN,((NAME="Term")!(NAME="Status")) K XXIEN ;This is the indication that it's first update for any subfile
"RTN","HDIPSZRT",7,0)
 S:$D(HLNODE(1)) HLNODE=HLNODE_HLNODE(1)
"RTN","HDIPSZRT",8,0)
 G XX99:IFN=50.60699
"RTN","HDIPSZRT",9,0)
 Q
"RTN","HDIPSZRT",10,0)
 ;
"RTN","HDIPSZRT",11,0)
XX99 ;1399 ;Manipulate update of MFN ZRT segment for MASTER DOSAGE FORM (#50.60699) File
"RTN","HDIPSZRT",12,0)
 N X,XX,ERR,IENS,IEN1,IENX,X1,X2,X4,DA,DIK,I,FDAA,VALUE,IFN9
"RTN","HDIPSZRT",13,0)
 S IFN9=50.60699901
"RTN","HDIPSZRT",14,0)
 I IEN,NAME="VistA_Related_Record" D  Q  ;ZRT^VistA_CodingSystem_Mapping^LOINC:90701,90743
"RTN","HDIPSZRT",15,0)
 .S (X,VALUE)=$$UNESC^XUMF0($P(HLNODE,HLFS,3),.HL)
"RTN","HDIPSZRT",16,0)
 .I '$L(X)!(X="""""") D DS(IFN9,IEN) S OUT=1 Q  ;Q:$G(OUT)  ;If there is nothing coming from Push, wipe anything was there before
"RTN","HDIPSZRT",17,0)
 .I '$G(XXIEN(IFN9)) D DS(IFN9,IEN)  S XXIEN(IFN9)=1 ;CLEAN SUBFILE ENTRY
"RTN","HDIPSZRT",18,0)
 .S IENS=IEN_","
"RTN","HDIPSZRT",19,0)
 .S IEN1="+1,",FDAA(IFN9,"+1,"_IENS,.01)=X  ;NOT RIGHT
"RTN","HDIPSZRT",20,0)
 .S VALUE=$$VAL^XUMF0(IFN9,.01,"",VALUE,"?+1,"_IENS)
"RTN","HDIPSZRT",21,0)
 .Q:ERROR  Q:VALUE="^"
"RTN","HDIPSZRT",22,0)
 .D:$D(FDAA) UPDATE^DIE("","FDAA",,"ERR")
"RTN","HDIPSZRT",23,0)
 .I $D(ERR) D  Q
"RTN","HDIPSZRT",24,0)
 ..S ERROR="1^subfile update error SUBFILE#: "_IFN9_"  HLNODE:"_HLNODE
"RTN","HDIPSZRT",25,0)
 ..D EM^XUMF1H(ERROR,.ERR)
"RTN","HDIPSZRT",26,0)
 .Q:$G(ERROR)
"RTN","HDIPSZRT",27,0)
 .S OUT=1
"RTN","HDIPSZRT",28,0)
 Q
"RTN","HDIPSZRT",29,0)
POST ;Post processing logic
"RTN","HDIPSZRT",30,0)
 ; IFN = File #  aka 50.60699
"RTN","HDIPSZRT",31,0)
 ; IFNM File associated with IFN aka 50.606
"RTN","HDIPSZRT",32,0)
 ;Scan all enries from file 50.606 field 90 and see if some dangling pointers are there, or if entries can be repointed.
"RTN","HDIPSZRT",33,0)
 Q:$G(ERROR)
"RTN","HDIPSZRT",34,0)
 ;^PS(50.606,"ACMF",2,63)=""
"RTN","HDIPSZRT",35,0)
 ;^PS(50.606,63,0)="TAB"
"RTN","HDIPSZRT",36,0)
 ;^PS(50.606,63,"MASTER")=2
"RTN","HDIPSZRT",37,0)
 ;^PSMDF(50.60699,"AC","Aerosol",2,1)=""
"RTN","HDIPSZRT",38,0)
 ;^PSMDF(50.60699,2,"ASSOC",1,0)="Aerosol"
"RTN","HDIPSZRT",39,0)
 ;X0=2   N13="Aerosol"   X1=63
"RTN","HDIPSZRT",40,0)
 ;IFNA1 = ^PSMDF(IFN,"AC",N13,X0)
"RTN","HDIPSZRT",41,0)
 ;IFNA2 = ^PSMDF(IFN,"AC",N13,0)
"RTN","HDIPSZRT",42,0)
 ;IFNA3 = ^PSMDF(IFN,Q2,0)
"RTN","HDIPSZRT",43,0)
 ;IFNA4 = ^PSMDF(IFN,Q3,0)
"RTN","HDIPSZRT",44,0)
 ;IFNA  = ^PSMDF(IFN,"AC",N13)
"RTN","HDIPSZRT",45,0)
 ;IFNB1 = ^PS(IFNM,X1)
"RTN","HDIPSZRT",46,0)
 ;IFNB2 = ^PS(IFNM,X1,0)
"RTN","HDIPSZRT",47,0)
 ;IFNB3 = ^PS(IFNM,"ACMF"
"RTN","HDIPSZRT",48,0)
 ;IFNB =  ^PS(IFNM,X1,"MASTER")
"RTN","HDIPSZRT",49,0)
 ;Get the pointers from 50.606 to be repointed to 50.60699
"RTN","HDIPSZRT",50,0)
 ;first see if we have some NUUL pointer
"RTN","HDIPSZRT",51,0)
 N X0,X1,X2,C,TEXT,N13,IFNM,IFNA,IFNA1,IFNA2,IFNA3,IFNA4,IFNB,IFNB1,IFNB2,IFNB3,IFNC,MDF,DUPL,Q1,Q2,Q3
"RTN","HDIPSZRT",52,0)
 S C=10,IFNM=50.606,IFNA=^DIC(IFN,0,"GL"),IFNB=^DIC(IFNM,0,"GL")
"RTN","HDIPSZRT",53,0)
 S IFNC=IFNB_"X0,0)" ;^PS(50.606,X0,0)
"RTN","HDIPSZRT",54,0)
 S IFNA1=IFNA_"""AC"",N13,X0)",IFNA2=IFNA_"""AC"",N13,0)",IFNA3=IFNA_"Q2,0)",IFNA4=IFNA_"Q3,0)",IFNA=IFNA_"""AC"",N13)"
"RTN","HDIPSZRT",55,0)
 S IFNB1=IFNB_"X1)",IFNB2=IFNB_"X1,0)",IFNB3=IFNB_"""ACMF"",IENS)",IFNB=IFNB_"X1,""MASTER"")"
"RTN","HDIPSZRT",56,0)
 S MDF=90
"RTN","HDIPSZRT",57,0)
 ;Check for duplicates in 50.60699,99      ASSOCIATED DOSAGE FORM STATUSES ASSOC;0 Multiple #50.60699901
"RTN","HDIPSZRT",58,0)
 S N13="" F  S N13=$O(@IFNA) Q:'$L(N13)  D  ;IFNA  = ^PSMDF(IFN,"AC",N13)
"RTN","HDIPSZRT",59,0)
 .K DUPL M DUPL=@IFNA S Q1="DUPL",Q1=$Q(@Q1),Q2=Q1,Q2=+$P(Q2,"(",2),Q1=$Q(@Q1) Q:'$L(Q1)  ;Quit if only one multiple,.. no duplicates.
"RTN","HDIPSZRT",60,0)
 .F  D  S Q1=$Q(@Q1) Q:'$L(Q1)
"RTN","HDIPSZRT",61,0)
 ..S Q3=+$P(Q1,"(",2),Q3=$P(@(IFNA4),U)
"RTN","HDIPSZRT",62,0)
 ..S TEXT="  File: "_IFN_" Local IEN: "_+$P(Q1,"(",2)_" "_Q3_" Associated "_N13_"  Is Duplicate to Ass. in IEN: "_Q2_"  "_$P(@(IFNA3),U)
"RTN","HDIPSZRT",63,0)
 ..S C=C+1,ERR("DIERR",1,"TEXT",C)=TEXT
"RTN","HDIPSZRT",64,0)
 .Q
"RTN","HDIPSZRT",65,0)
 I $D(ERR) D  Q
"RTN","HDIPSZRT",66,0)
 .S ERR("DIERR",1,"TEXT",10)="List of Association duplicates in "_IFN_"  Site:"_$$SITE^VASITE()
"RTN","HDIPSZRT",67,0)
 .S ERROR="1^Records in file "_IFN_" have Association duplictes.  Listing of duplicates see in MFS ERROR/WARNING/INFO"
"RTN","HDIPSZRT",68,0)
 .D EM^XUMF0
"RTN","HDIPSZRT",69,0)
 .K ERR
"RTN","HDIPSZRT",70,0)
 ;
"RTN","HDIPSZRT",71,0)
 S X1=0 F  S X1=$O(@IFNB1) Q:'X1  Q:$G(ERROR)  S N13=$P($G(@IFNB2),U) I $L(N13) S X0=+$G(@IFNB) D:'$D(@IFNA1)  ;X0=Master pointer to 50.60699
"RTN","HDIPSZRT",72,0)
 .I $D(@IFNA) D  Q  ;No MASTER pointer into file 50.606 or MASTER needs to be repointed
"RTN","HDIPSZRT",73,0)
 ..N FDA,ERR,ZZZ
"RTN","HDIPSZRT",74,0)
 ..S X0=$O(@IFNA2)
"RTN","HDIPSZRT",75,0)
 ..D GETS^DIQ(IFN,X0_",","99.991*","I","ZZZ","ERR")
"RTN","HDIPSZRT",76,0)
 ..I $D(ERR) D  Q
"RTN","HDIPSZRT",77,0)
 ...S ERROR="1^Error in Retrievig status of IEN: "_X0_" in file"_IFN
"RTN","HDIPSZRT",78,0)
 ...S ERRCNT=+$G(ERRCNT) D EM^XUMF1H(ERROR,.ERR)
"RTN","HDIPSZRT",79,0)
 ..;ZZZ(50.6069901,"1,17,",.01,"I")=3170915.170227
"RTN","HDIPSZRT",80,0)
 ..;ZZZ(50.6069901,"1,17,",.02,"I")=1
"RTN","HDIPSZRT",81,0)
 ..;ZZZ(50.6069901,"2,17,",.01,"I")=3170915.200528
"RTN","HDIPSZRT",82,0)
 ..;ZZZ(50.6069901,"2,17,",.02,"I")=0
"RTN","HDIPSZRT",83,0)
 ..Q:'@($Q(ZZZ(99999999999),-1))   ; Ignore "Invalid or wrong number of arguments to a function" XINDEX warning.
"RTN","HDIPSZRT",84,0)
 ..S FDA(IFNM,X1_",",MDF)=X0
"RTN","HDIPSZRT",85,0)
 ..D FILE^DIE(,"FDA","ERR")
"RTN","HDIPSZRT",86,0)
 ..I $D(ERR) D
"RTN","HDIPSZRT",87,0)
 ...S ERROR="1^Repointing entry: "_X1_" in file"_IFNM_" error."
"RTN","HDIPSZRT",88,0)
 ...S ERRCNT=+$G(ERRCNT) D EM^XUMF1H(ERROR,.ERR)
"RTN","HDIPSZRT",89,0)
 ...K ERR
"RTN","HDIPSZRT",90,0)
 ..Q
"RTN","HDIPSZRT",91,0)
 .Q:$G(ERROR)
"RTN","HDIPSZRT",92,0)
 .; Local entry in master file doesn't exist send e-mail ito XUMF ERROR
"RTN","HDIPSZRT",93,0)
 .S:X0 Q2=X0,Q2=$P($G(@IFNA3),U)
"RTN","HDIPSZRT",94,0)
 .S TEXT="  File: "_IFNM_" Local IEN: "_X1_"  "_N13_"  Is missing in file"_IFN_" and can NOT be "_$S('X0:"SET",1:"RESET From: "_Q2) ;
"RTN","HDIPSZRT",95,0)
 .S C=C+1,ERR("DIERR",1,"TEXT",C)=TEXT
"RTN","HDIPSZRT",96,0)
 .S:X0 C=C+1,ERR("DIERR",1,"TEXT",C)="   Master IEN before: "_X0_"  "_$P($G(@IFNC),U)
"RTN","HDIPSZRT",97,0)
 Q:$G(ERROR)
"RTN","HDIPSZRT",98,0)
 I $D(ERR) D  Q
"RTN","HDIPSZRT",99,0)
 .S ERR("DIERR",1,"TEXT",10)="List of records from file "_IFNM_" not synchronised with file "_IFN_"  Site:"_$$SITE^VASITE()
"RTN","HDIPSZRT",100,0)
 .S ERROR="0^Records of file "_IFN_" are not synchronised with File "_IFNM_"  Listing of records see in MFS ERROR/WARNING/INFO"
"RTN","HDIPSZRT",101,0)
 .D EM^XUMF0
"RTN","HDIPSZRT",102,0)
 .K ERR
"RTN","HDIPSZRT",103,0)
 Q
"RTN","HDIPSZRT",104,0)
 ;
"RTN","HDIPSZRT",105,0)
DS(SUBFILE,IENS) ;Delete subfile
"RTN","HDIPSZRT",106,0)
 D DS1(IENS)
"RTN","HDIPSZRT",107,0)
 Q:$G(ERROR)
"RTN","HDIPSZRT",108,0)
 N ROOT,IDX,X
"RTN","HDIPSZRT",109,0)
 ;K @(IFNB3) ;Delete field 90 pointers from 50.606 to 50.60699   K ^PS(50.606,"ACMF",IENS)
"RTN","HDIPSZRT",110,0)
 S ROOT=$$ROOT^DILFD(SUBFILE,","_IENS,1)
"RTN","HDIPSZRT",111,0)
 S IDX=0 F  S IDX=$O(@ROOT@(IDX)) Q:'IDX  D
"RTN","HDIPSZRT",112,0)
 .N DA,DIK,DIC S DA(1)=+IENS,DA=IDX,DIK=$P(ROOT,")")_"," D ^DIK
"RTN","HDIPSZRT",113,0)
 Q
"RTN","HDIPSZRT",114,0)
DS1(IEN) ; Delete coresponding fields 90 in file 50.606
"RTN","HDIPSZRT",115,0)
 N IFNM,FDA,IDX,IFNB,IFNB3
"RTN","HDIPSZRT",116,0)
 S IFNM=IFN\1
"RTN","HDIPSZRT",117,0)
 S IFNB=^DIC(IFNM,0,"GL"),IFNB3=IFNB_"""ACMF"",IEN,IDX)"
"RTN","HDIPSZRT",118,0)
 S IDX=0 F  S IDX=$O(@IFNB3) Q:'IDX  S FDA(IFNM,IDX_",",90)="@"
"RTN","HDIPSZRT",119,0)
 Q:'$D(FDA)
"RTN","HDIPSZRT",120,0)
 D FILE^DIE(,"FDA","ERR")
"RTN","HDIPSZRT",121,0)
 Q:'$D(ERR)
"RTN","HDIPSZRT",122,0)
 S ERROR="1^Error in update of field 90 in file: "_IFNM
"RTN","HDIPSZRT",123,0)
 S ERRCNT=+$G(ERRCNT) D EM^XUMF1H(ERROR,.ERR)
"RTN","HDIPSZRT",124,0)
 ;K ERR
"RTN","HDIPSZRT",125,0)
 Q
"RTN","HDIZRT")
0^3^B2560389^B2560389
"RTN","HDIZRT",1,0)
HDIZRT ;PBB/ - GENERIC UTILITY FOR MFN  MD5 and Discovery processing
"RTN","HDIZRT",2,0)
 ;;1.0;HEALTH DATA & INFORMATICS;**19,21**;Feb 22, 2005;Build 9
"RTN","HDIZRT",3,0)
 ;
"RTN","HDIZRT",4,0)
 Q
"RTN","HDIZRT",5,0)
DESC ; Discovery coding to get conversion to escape characters..
"RTN","HDIZRT",6,0)
 N II,CNT,CNT1,VAL,VAL1
"RTN","HDIZRT",7,0)
 S CNT=0,(VAL,VAL1)=""
"RTN","HDIZRT",8,0)
 F  S CNT=$O(^TMP("HLA",$J,CNT)) Q:'CNT  S II=$G(^TMP("HLA",$J,CNT)) Q:'$L(II)  Q:$G(ERROR)  D:$P(II,HLFS)="ZRT"
"RTN","HDIZRT",9,0)
 .S VAL=$P(II,HLFS,3)
"RTN","HDIZRT",10,0)
 .Q:'$L(VAL) 
"RTN","HDIZRT",11,0)
 .S VAL=$$ESC(VAL,.HL)
"RTN","HDIZRT",12,0)
 .S $P(II,HLFS,3)=VAL
"RTN","HDIZRT",13,0)
 .S ^TMP("HLA",$J,CNT)=II
"RTN","HDIZRT",14,0)
 .D:$O(^TMP("HLA",$J,CNT,0))
"RTN","HDIZRT",15,0)
 ..S CNT1=0 F  S CNT1=$O(^TMP("HLA",$J,CNT,CNT1)) Q:'CNT1  D
"RTN","HDIZRT",16,0)
 ...S VAL=$G(^TMP("HLA",$J,CNT,CNT1))
"RTN","HDIZRT",17,0)
 ...S ^TMP("HLA",$J,CNT,CNT1)=$$ESC(VAL,.HL)
"RTN","HDIZRT",18,0)
 Q
"RTN","HDIZRT",19,0)
ESC(VALUE,HL) ;Escape value
"RTN","HDIZRT",20,0)
 N ESC,ESCFS,ESCCMP,ESCSUB,ESCREP,ESCESC,ESCSEQ,CVRT
"RTN","HDIZRT",21,0)
 S ESC=$E(HL("ECH"),3)
"RTN","HDIZRT",22,0)
 S ESCFS=ESC_"F"_ESC S CVRT("ESCFS")=HL("FS")
"RTN","HDIZRT",23,0)
 S ESCCMP=ESC_"S"_ESC S CVRT("ESCCMP")=$E(HL("ECH"),1)
"RTN","HDIZRT",24,0)
 S ESCREP=ESC_"R"_ESC S CVRT("ESCREP")=$E(HL("ECH"),2)
"RTN","HDIZRT",25,0)
 S ESCESC=ESC_"E"_ESC S CVRT("ESCESC")=ESC
"RTN","HDIZRT",26,0)
 S ESCSUB=ESC_"T"_ESC S CVRT("ESCSUB")=$E(HL("ECH"),4)
"RTN","HDIZRT",27,0)
 ;F ESCSEQ="ESCFS","ESCCMP","ESCSUB","ESCREP","ESCESC" D
"RTN","HDIZRT",28,0)
 F ESCSEQ="ESCFS","ESCCMP","ESCSUB","ESCREP" D
"RTN","HDIZRT",29,0)
 .F  Q:VALUE'[CVRT(ESCSEQ)  D
"RTN","HDIZRT",30,0)
 ..S VALUE=$P(VALUE,CVRT(ESCSEQ))_@ESCSEQ_$P(VALUE,CVRT(ESCSEQ),2,9999)
"RTN","HDIZRT",31,0)
 Q VALUE
"VER")
8.0^22.2
"BLD",10292,6)
^16
**END**
**END**

