Released HDI*1*22 SEQ #17
Extracted from mail message
**KIDS**:HDI*1.0*22^

**INSTALL NAME**
HDI*1.0*22
"BLD",10469,0)
HDI*1.0*22^HEALTH DATA & INFORMATICS^0^3180820^y
"BLD",10469,1,0)
^^1^1^3180208^
"BLD",10469,1,1,0)
Please see patch description on FORUM.
"BLD",10469,4,0)
^9.64PA^^
"BLD",10469,6.3)
26
"BLD",10469,"ABPKG")
n
"BLD",10469,"KRN",0)
^9.67PA^779.2^20
"BLD",10469,"KRN",.4,0)
.4
"BLD",10469,"KRN",.401,0)
.401
"BLD",10469,"KRN",.402,0)
.402
"BLD",10469,"KRN",.403,0)
.403
"BLD",10469,"KRN",.5,0)
.5
"BLD",10469,"KRN",.84,0)
.84
"BLD",10469,"KRN",3.6,0)
3.6
"BLD",10469,"KRN",3.8,0)
3.8
"BLD",10469,"KRN",9.2,0)
9.2
"BLD",10469,"KRN",9.8,0)
9.8
"BLD",10469,"KRN",9.8,"NM",0)
^9.68A^13^8
"BLD",10469,"KRN",9.8,"NM",3,0)
HDISDOL^^0^B81231137
"BLD",10469,"KRN",9.8,"NM",4,0)
HDISDOLL^^0^B185025754
"BLD",10469,"KRN",9.8,"NM",6,0)
HDISDSR^^0^B8012840
"BLD",10469,"KRN",9.8,"NM",7,0)
HDISDSR1^^0^B13794495
"BLD",10469,"KRN",9.8,"NM",9,0)
HDISDSRL^^0^B173574871
"BLD",10469,"KRN",9.8,"NM",10,0)
HDISDOC^^0^B83861623
"BLD",10469,"KRN",9.8,"NM",11,0)
HDISDOCL^^0^B114683234
"BLD",10469,"KRN",9.8,"NM",13,0)
HDIPSZRT^^0^B30347676
"BLD",10469,"KRN",9.8,"NM","B","HDIPSZRT",13)

"BLD",10469,"KRN",9.8,"NM","B","HDISDOC",10)

"BLD",10469,"KRN",9.8,"NM","B","HDISDOCL",11)

"BLD",10469,"KRN",9.8,"NM","B","HDISDOL",3)

"BLD",10469,"KRN",9.8,"NM","B","HDISDOLL",4)

"BLD",10469,"KRN",9.8,"NM","B","HDISDSR",6)

"BLD",10469,"KRN",9.8,"NM","B","HDISDSR1",7)

"BLD",10469,"KRN",9.8,"NM","B","HDISDSRL",9)

"BLD",10469,"KRN",19,0)
19
"BLD",10469,"KRN",19,"NM",0)
^9.68A^3^3
"BLD",10469,"KRN",19,"NM",1,0)
HDISDOSERVER^^0
"BLD",10469,"KRN",19,"NM",2,0)
HDISDO API^^0
"BLD",10469,"KRN",19,"NM",3,0)
HDISDO REQUEST SDO^^0
"BLD",10469,"KRN",19,"NM","B","HDISDO API",2)

"BLD",10469,"KRN",19,"NM","B","HDISDO REQUEST SDO",3)

"BLD",10469,"KRN",19,"NM","B","HDISDOSERVER",1)

"BLD",10469,"KRN",19.1,0)
19.1
"BLD",10469,"KRN",101,0)
101
"BLD",10469,"KRN",409.61,0)
409.61
"BLD",10469,"KRN",771,0)
771
"BLD",10469,"KRN",779.2,0)
779.2
"BLD",10469,"KRN",870,0)
870
"BLD",10469,"KRN",8989.51,0)
8989.51
"BLD",10469,"KRN",8989.52,0)
8989.52
"BLD",10469,"KRN",8994,0)
8994
"BLD",10469,"KRN","B",.4,.4)

"BLD",10469,"KRN","B",.401,.401)

"BLD",10469,"KRN","B",.402,.402)

"BLD",10469,"KRN","B",.403,.403)

"BLD",10469,"KRN","B",.5,.5)

"BLD",10469,"KRN","B",.84,.84)

"BLD",10469,"KRN","B",3.6,3.6)

"BLD",10469,"KRN","B",3.8,3.8)

"BLD",10469,"KRN","B",9.2,9.2)

"BLD",10469,"KRN","B",9.8,9.8)

"BLD",10469,"KRN","B",19,19)

"BLD",10469,"KRN","B",19.1,19.1)

"BLD",10469,"KRN","B",101,101)

"BLD",10469,"KRN","B",409.61,409.61)

"BLD",10469,"KRN","B",771,771)

"BLD",10469,"KRN","B",779.2,779.2)

"BLD",10469,"KRN","B",870,870)

"BLD",10469,"KRN","B",8989.51,8989.51)

"BLD",10469,"KRN","B",8989.52,8989.52)

"BLD",10469,"KRN","B",8994,8994)

"BLD",10469,"QDEF")
^^^^NO^^^^NO^^NO
"BLD",10469,"QUES",0)
^9.62^^
"BLD",10469,"REQB",0)
^9.611^^0
"KRN",19,2921495,-1)
0^1
"KRN",19,2921495,0)
HDISDOSERVER^HDI SDO ORDER SERVER^^S^^^^^^^^HEALTH DATA & INFORMATICS
"KRN",19,2921495,1,0)
^19.06^2^2^3171227^^^^
"KRN",19,2921495,1,1,0)
This HDI server is for users to collect SDO's associated to items
"KRN",19,2921495,1,2,0)
in the orderable items file (#101.43) by way of a mailman message.
"KRN",19,2921495,25)
HDISDSR
"KRN",19,2921495,99.1)
64671,40423
"KRN",19,2921495,220)
^R^^^Y
"KRN",19,2921495,"U")
HDI SDO ORDER SERVER
"KRN",19,2921539,-1)
0^3
"KRN",19,2921539,0)
HDISDO REQUEST SDO^HDI REQUEST SDO^^R^^^^^^^^HEALTH DATA & INFORMATICS
"KRN",19,2921539,1,0)
^19.06^4^4^3180626^^^
"KRN",19,2921539,1,1,0)
This option allows users to request Standard Development Organization (SDO)
"KRN",19,2921539,1,2,0)
values from the ORDERABLE ITEMS File (#101.43) for Laboratory.
"KRN",19,2921539,1,3,0)
The option will call the HDISDO API with the request and display the
"KRN",19,2921539,1,4,0)
results.
"KRN",19,2921539,25)
EN^HDISDOL
"KRN",19,2921539,99.1)
64671,40414
"KRN",19,2921539,"U")
HDI REQUEST SDO
"KRN",19,2921540,-1)
0^2
"KRN",19,2921540,0)
HDISDO API^HDI SDO API^^R^^^^^^^^HEALTH DATA & INFORMATICS
"KRN",19,2921540,1,0)
^19.06^15^15^3180626^^^
"KRN",19,2921540,1,1,0)
This option collects the SDO values associated to items in the ODERABLE
"KRN",19,2921540,1,2,0)
ITEMS File (#101.43) for the Laboratory and returns the results in an 
"KRN",19,2921540,1,3,0)
XML style format.
"KRN",19,2921540,1,4,0)
Calling Parameters:
"KRN",19,2921540,1,5,0)
Area: L for Laboratory
"KRN",19,2921540,1,6,0)
Lookup value: this can be ALL for all items for the area, a partial match
"KRN",19,2921540,1,7,0)
name for a value for the area, or the IEN of a specific item for that
"KRN",19,2921540,1,8,0)
area.
"KRN",19,2921540,1,9,0)
Return variable: this is the variable that the results will be returned in.
"KRN",19,2921540,1,10,0)
it is suggested that the return variable be associated to a global.
"KRN",19,2921540,1,11,0)
example - RET="^TMP(""SDORET"",$J)" use RET when calling the option.
"KRN",19,2921540,1,12,0)
Error: (optional) if an error variable is passed in and if an error is
"KRN",19,2921540,1,13,0)
encountered then the error variable will be populated.
"KRN",19,2921540,1,14,0)
Count: (optional) if a variable is passed in counts for select items will
"KRN",19,2921540,1,15,0)
be returned. The items counted will vary depending on the Area.
"KRN",19,2921540,25)
HDISDOC
"KRN",19,2921540,99.1)
64671,40130
"KRN",19,2921540,"U")
HDI SDO API
"MBREQ")
0
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"PKG",633,-1)
1^1
"PKG",633,0)
HEALTH DATA & INFORMATICS^HDI^Data Standardization
"PKG",633,20,0)
^9.402P^^
"PKG",633,22,0)
^9.49I^1^1
"PKG",633,22,1,0)
1.0^3050426^3050602^568
"PKG",633,22,1,"PAH",1,0)
22^3180820^520651128
"PKG",633,22,1,"PAH",1,1,0)
^^1^1^3180820
"PKG",633,22,1,"PAH",1,1,1,0)
Please see patch description on FORUM.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
8
"RTN","HDIPSZRT")
0^13^B30347676^B30301671
"RTN","HDIPSZRT",1,0)
HDIPSZRT ;DAL/PBB - DOSAGE FORM ENTRY POINTS FOR ZRT SEGMENT MFS UPDATE ; Apr 07, 2018@12:42
"RTN","HDIPSZRT",2,0)
 ;;1.0;HEALTH DATA & INFORMATICS;**21,22**;Feb 22, 2005;Build 26
"RTN","HDIPSZRT",3,0)
 ;
"RTN","HDIPSZRT",4,0)
 Q
"RTN","HDIPSZRT",5,0)
ZRT ;Manipulate update of MFN ZRT segment for MED DOSAGE files
"RTN","HDIPSZRT",6,0)
 I IEN,((NAME="Term")!(NAME="Status")) K XXIEN ;This is the indication that it's first update for any subfile
"RTN","HDIPSZRT",7,0)
 S:$D(HLNODE(1)) HLNODE=HLNODE_HLNODE(1)
"RTN","HDIPSZRT",8,0)
 G XX99:IFN=50.60699
"RTN","HDIPSZRT",9,0)
 Q
"RTN","HDIPSZRT",10,0)
 ;
"RTN","HDIPSZRT",11,0)
XX99 ;1399 ;Manipulate update of MFN ZRT segment for MASTER DOSAGE FORM (#50.60699) File
"RTN","HDIPSZRT",12,0)
 N X,XX,ERR,IENS,IEN1,IENX,X1,X2,X4,DA,DIK,I,FDAA,VALUE,IFN9
"RTN","HDIPSZRT",13,0)
 S IFN9=50.60699901
"RTN","HDIPSZRT",14,0)
 I IEN,NAME="VistA_Related_Record" D  Q  ;ZRT^VistA_CodingSystem_Mapping^LOINC:90701,90743
"RTN","HDIPSZRT",15,0)
 .S (X,VALUE)=$$UNESC^XUMF0($P(HLNODE,HLFS,3),.HL)
"RTN","HDIPSZRT",16,0)
 .I '$L(X)!(X="""""") D DS(IFN9,IEN) S OUT=1 Q  ;Q:$G(OUT)  ;If there is nothing coming from Push, wipe anything was there before
"RTN","HDIPSZRT",17,0)
 .I '$G(XXIEN(IFN9)) D DS(IFN9,IEN)  S XXIEN(IFN9)=1 ;CLEAN SUBFILE ENTRY
"RTN","HDIPSZRT",18,0)
 .S IENS=IEN_","
"RTN","HDIPSZRT",19,0)
 .S IEN1="+1,",FDAA(IFN9,"+1,"_IENS,.01)=X  ;NOT RIGHT
"RTN","HDIPSZRT",20,0)
 .S VALUE=$$VAL^XUMF0(IFN9,.01,"",VALUE,"?+1,"_IENS)
"RTN","HDIPSZRT",21,0)
 .Q:ERROR  Q:VALUE="^"
"RTN","HDIPSZRT",22,0)
 .D:$D(FDAA) UPDATE^DIE("","FDAA",,"ERR")
"RTN","HDIPSZRT",23,0)
 .I $D(ERR) D  Q
"RTN","HDIPSZRT",24,0)
 ..S ERROR="1^subfile update error SUBFILE#: "_IFN9_"  HLNODE:"_HLNODE
"RTN","HDIPSZRT",25,0)
 ..D EM^XUMF1H(ERROR,.ERR)
"RTN","HDIPSZRT",26,0)
 .Q:$G(ERROR)
"RTN","HDIPSZRT",27,0)
 .S OUT=1
"RTN","HDIPSZRT",28,0)
 Q
"RTN","HDIPSZRT",29,0)
POST ;Post processing logic
"RTN","HDIPSZRT",30,0)
 ; IFN = File #  aka 50.60699
"RTN","HDIPSZRT",31,0)
 ; IFNM File associated with IFN aka 50.606
"RTN","HDIPSZRT",32,0)
 ;Scan all enries from file 50.606 field 90 and see if some dangling pointers are there, or if entries can be repointed.
"RTN","HDIPSZRT",33,0)
 Q:$G(ERROR)
"RTN","HDIPSZRT",34,0)
 ;^PS(50.606,"ACMF",2,63)=""
"RTN","HDIPSZRT",35,0)
 ;^PS(50.606,63,0)="TAB"
"RTN","HDIPSZRT",36,0)
 ;^PS(50.606,63,"MASTER")=2
"RTN","HDIPSZRT",37,0)
 ;^PSMDF(50.60699,"AC","Aerosol",2,1)=""
"RTN","HDIPSZRT",38,0)
 ;^PSMDF(50.60699,2,"ASSOC",1,0)="Aerosol"
"RTN","HDIPSZRT",39,0)
 ;X0=2   N13="Aerosol"   X1=63
"RTN","HDIPSZRT",40,0)
 ;IFNA1 = ^PSMDF(IFN,"AC",N13,X0)
"RTN","HDIPSZRT",41,0)
 ;IFNA2 = ^PSMDF(IFN,"AC",N13,0)
"RTN","HDIPSZRT",42,0)
 ;IFNA3 = ^PSMDF(IFN,Q2,0)
"RTN","HDIPSZRT",43,0)
 ;IFNA4 = ^PSMDF(IFN,Q3,0)
"RTN","HDIPSZRT",44,0)
 ;IFNA  = ^PSMDF(IFN,"AC",N13)
"RTN","HDIPSZRT",45,0)
 ;IFNB1 = ^PS(IFNM,X1)
"RTN","HDIPSZRT",46,0)
 ;IFNB2 = ^PS(IFNM,X1,0)
"RTN","HDIPSZRT",47,0)
 ;IFNB3 = ^PS(IFNM,"ACMF"
"RTN","HDIPSZRT",48,0)
 ;IFNB =  ^PS(IFNM,X1,"MASTER")
"RTN","HDIPSZRT",49,0)
 ;Get the pointers from 50.606 to be repointed to 50.60699
"RTN","HDIPSZRT",50,0)
 ;first see if we have some NUUL pointer
"RTN","HDIPSZRT",51,0)
 N X0,X1,X2,C,TEXT,N13,IFNM,IFNA,IFNA1,IFNA2,IFNA3,IFNA4,IFNB,IFNB1,IFNB2,IFNB3,IFNC,MDF,DUPL,Q1,Q2,Q3
"RTN","HDIPSZRT",52,0)
 S C=10,IFNM=50.606,IFNA=^DIC(IFN,0,"GL"),IFNB=^DIC(IFNM,0,"GL")
"RTN","HDIPSZRT",53,0)
 S IFNC=IFNB_"X0,0)" ;^PS(50.606,X0,0)
"RTN","HDIPSZRT",54,0)
 S IFNA1=IFNA_"""AC"",N13,X0)",IFNA2=IFNA_"""AC"",N13,0)",IFNA3=IFNA_"Q2,0)",IFNA4=IFNA_"Q3,0)",IFNA=IFNA_"""AC"",N13)"
"RTN","HDIPSZRT",55,0)
 S IFNB1=IFNB_"X1)",IFNB2=IFNB_"X1,0)",IFNB3=IFNB_"""ACMF"",IENS)",IFNB=IFNB_"X1,""MASTER"")"
"RTN","HDIPSZRT",56,0)
 S MDF=90
"RTN","HDIPSZRT",57,0)
 ;Check for duplicates in 50.60699,99      ASSOCIATED DOSAGE FORM STATUSES ASSOC;0 Multiple #50.60699901
"RTN","HDIPSZRT",58,0)
 S N13="" F  S N13=$O(@IFNA) Q:'$L(N13)  D  ;IFNA  = ^PSMDF(IFN,"AC",N13)
"RTN","HDIPSZRT",59,0)
 .K DUPL M DUPL=@IFNA S Q1="DUPL",Q1=$Q(@Q1),Q2=Q1,Q2=+$P(Q2,"(",2),Q1=$Q(@Q1) Q:'$L(Q1)  ;Quit if only one multiple,.. no duplicates.
"RTN","HDIPSZRT",60,0)
 .F  D  S Q1=$Q(@Q1) Q:'$L(Q1)
"RTN","HDIPSZRT",61,0)
 ..S Q3=+$P(Q1,"(",2),Q3=$P(@(IFNA4),U)
"RTN","HDIPSZRT",62,0)
 ..S TEXT="  File: "_IFN_" Local IEN: "_+$P(Q1,"(",2)_" "_Q3_" Associated "_N13_"  Is Duplicate to Ass. in IEN: "_Q2_"  "_$P(@(IFNA3),U)
"RTN","HDIPSZRT",63,0)
 ..S C=C+1,ERR("DIERR",1,"TEXT",C)=TEXT
"RTN","HDIPSZRT",64,0)
 .Q
"RTN","HDIPSZRT",65,0)
 I $D(ERR) D  Q
"RTN","HDIPSZRT",66,0)
 .S ERR("DIERR",1,"TEXT",10)="List of Association duplicates in "_IFN_"  Site:"_$$SITE^VASITE()
"RTN","HDIPSZRT",67,0)
 .S ERROR="1^Records in file "_IFN_" have Association duplictes.  Listing of duplicates see in MFS ERROR/WARNING/INFO"
"RTN","HDIPSZRT",68,0)
 .D EM^XUMF0
"RTN","HDIPSZRT",69,0)
 .K ERR
"RTN","HDIPSZRT",70,0)
 ;
"RTN","HDIPSZRT",71,0)
 S X1=0 F  S X1=$O(@IFNB1) Q:'X1  Q:$G(ERROR)  S N13=$P($G(@IFNB2),U) I $L(N13) S X0=+$G(@IFNB) D:'$D(@IFNA1)  ;X0=Master pointer to 50.60699
"RTN","HDIPSZRT",72,0)
 .I $D(@IFNA) D  Q  ;No MASTER pointer into file 50.606 or MASTER needs to be repointed
"RTN","HDIPSZRT",73,0)
 ..N FDA,ERR,ZZZ
"RTN","HDIPSZRT",74,0)
 ..S X0=$O(@IFNA2)
"RTN","HDIPSZRT",75,0)
 ..D GETS^DIQ(IFN,X0_",","99.991*","I","ZZZ","ERR")
"RTN","HDIPSZRT",76,0)
 ..I $D(ERR) D  Q
"RTN","HDIPSZRT",77,0)
 ...S ERROR="1^Error in Retrievig status of IEN: "_X0_" in file"_IFN
"RTN","HDIPSZRT",78,0)
 ...S ERRCNT=+$G(ERRCNT) D EM^XUMF1H(ERROR,.ERR)
"RTN","HDIPSZRT",79,0)
 ..;ZZZ(50.6069901,"1,17,",.01,"I")=3170915.170227
"RTN","HDIPSZRT",80,0)
 ..;ZZZ(50.6069901,"1,17,",.02,"I")=1
"RTN","HDIPSZRT",81,0)
 ..;ZZZ(50.6069901,"2,17,",.01,"I")=3170915.200528
"RTN","HDIPSZRT",82,0)
 ..;ZZZ(50.6069901,"2,17,",.02,"I")=0
"RTN","HDIPSZRT",83,0)
 ..Q:'@($Q(ZZZ(99999999999),-1))   ; Ignore "Invalid or wrong number of arguments to a function" XINDEX warning.
"RTN","HDIPSZRT",84,0)
 ..S FDA(IFNM,X1_",",MDF)=X0
"RTN","HDIPSZRT",85,0)
 ..D FILE^DIE(,"FDA","ERR")
"RTN","HDIPSZRT",86,0)
 ..I $D(ERR) D
"RTN","HDIPSZRT",87,0)
 ...S ERROR="1^Repointing entry: "_X1_" in file"_IFNM_" error."
"RTN","HDIPSZRT",88,0)
 ...S ERRCNT=+$G(ERRCNT) D EM^XUMF1H(ERROR,.ERR)
"RTN","HDIPSZRT",89,0)
 ...K ERR
"RTN","HDIPSZRT",90,0)
 ..Q
"RTN","HDIPSZRT",91,0)
 .Q:$G(ERROR)
"RTN","HDIPSZRT",92,0)
 .; Local entry in master file doesn't exist send e-mail ito XUMF ERROR
"RTN","HDIPSZRT",93,0)
 .S:X0 Q2=X0,Q2=$P($G(@IFNA3),U)
"RTN","HDIPSZRT",94,0)
 .S TEXT="  File: "_IFNM_" Local IEN: "_X1_"  "_N13_"  Is missing in file"_IFN_" and can NOT be "_$S('X0:"SET",1:"RESET From: "_Q2) ;
"RTN","HDIPSZRT",95,0)
 .S C=C+1,ERR("DIERR",1,"TEXT",C)=TEXT
"RTN","HDIPSZRT",96,0)
 .S:X0 C=C+1,ERR("DIERR",1,"TEXT",C)="   Master IEN before: "_X0_"  "_$P($G(@IFNC),U)
"RTN","HDIPSZRT",97,0)
 Q:$G(ERROR)
"RTN","HDIPSZRT",98,0)
 I $D(ERR) D  Q
"RTN","HDIPSZRT",99,0)
 .S ERR("DIERR",1,"TEXT",10)="List of records from file "_IFNM_" not synchronised with file "_IFN_"  Site:"_$$SITE^VASITE()
"RTN","HDIPSZRT",100,0)
 .S ERROR="0^Records of file "_IFN_" are not synchronised with File "_IFNM_"  Listing of records see in MFS ERROR/WARNING/INFO"
"RTN","HDIPSZRT",101,0)
 .D EM^XUMF0
"RTN","HDIPSZRT",102,0)
 .K ERR
"RTN","HDIPSZRT",103,0)
 Q
"RTN","HDIPSZRT",104,0)
 ;
"RTN","HDIPSZRT",105,0)
DS(SUBFILE,IENS) ;Delete subfile
"RTN","HDIPSZRT",106,0)
 D DS1(IENS)
"RTN","HDIPSZRT",107,0)
 Q:$G(ERROR)
"RTN","HDIPSZRT",108,0)
 N ROOT,IDX,X
"RTN","HDIPSZRT",109,0)
 ;K @(IFNB3) ;Delete field 90 pointers from 50.606 to 50.60699   K ^PS(50.606,"ACMF",IENS)
"RTN","HDIPSZRT",110,0)
 S ROOT=$$ROOT^DILFD(SUBFILE,","_IENS,1)
"RTN","HDIPSZRT",111,0)
 S IDX=0 F  S IDX=$O(@ROOT@(IDX)) Q:'IDX  D
"RTN","HDIPSZRT",112,0)
 .N DA,DIK,DIC S DA(1)=+IENS,DA=IDX,DIK=$P(ROOT,")")_"," D ^DIK
"RTN","HDIPSZRT",113,0)
 Q
"RTN","HDIPSZRT",114,0)
DS1(IEN) ; Delete coresponding fields 90 in file 50.606
"RTN","HDIPSZRT",115,0)
 N IFNM,FDA,IDX,IFNB,IFNB3
"RTN","HDIPSZRT",116,0)
 ; START OF HDI*1*22
"RTN","HDIPSZRT",117,0)
 ;S IFNM=IFN\1
"RTN","HDIPSZRT",118,0)
 S IFNM=50.606
"RTN","HDIPSZRT",119,0)
 ; END OF HDI*1*22
"RTN","HDIPSZRT",120,0)
 S IFNB=^DIC(IFNM,0,"GL"),IFNB3=IFNB_"""ACMF"",IEN,IDX)"
"RTN","HDIPSZRT",121,0)
 S IDX=0 F  S IDX=$O(@IFNB3) Q:'IDX  S FDA(IFNM,IDX_",",90)="@"
"RTN","HDIPSZRT",122,0)
 Q:'$D(FDA)
"RTN","HDIPSZRT",123,0)
 D FILE^DIE(,"FDA","ERR")
"RTN","HDIPSZRT",124,0)
 Q:'$D(ERR)
"RTN","HDIPSZRT",125,0)
 S ERROR="1^Error in update of field 90 in file: "_IFNM
"RTN","HDIPSZRT",126,0)
 S ERRCNT=+$G(ERRCNT) D EM^XUMF1H(ERROR,.ERR)
"RTN","HDIPSZRT",127,0)
 ;K ERR
"RTN","HDIPSZRT",128,0)
 Q
"RTN","HDISDOC")
0^10^B83861623^n/a
"RTN","HDISDOC",1,0)
HDISDOC ;BPFO/DTG - COMPILE SDO LIST FROM 101.43; Apr 07, 2018@12:42
"RTN","HDISDOC",2,0)
 ;;1.0;HEALTH DATA & INFORMATICS;**22**;Feb 22, 2005;Build 26
"RTN","HDISDOC",3,0)
 ;
"RTN","HDISDOC",4,0)
 ; ICR's:
"RTN","HDISDOC",5,0)
 ; 6895 - HDI READ ORDERABLE ITEMS File (#101.43)
"RTN","HDISDOC",6,0)
 ; 6901 - HDI READ LABORATORY SERVICE LABORATORY TEST FILE (#60)
"RTN","HDISDOC",7,0)
 ; 6902 - HDI READ MASTER LABORATORY TEST FILE (#66.3)
"RTN","HDISDOC",8,0)
 ;
"RTN","HDISDOC",9,0)
 ; 1131 - XMB('NETNAME')
"RTN","HDISDOC",10,0)
 ;
"RTN","HDISDOC",11,0)
 ; This routine collects and returns the SDO's associated to items in the orderable item file 101.43
"RTN","HDISDOC",12,0)
 ;
"RTN","HDISDOC",13,0)
 ; HDIAREA - Search area 'L' for LAB
"RTN","HDISDOC",14,0)
 ; HDITYPE - Type of lookup 'S' for Single, 'P' for Partial Match, 'ALL' for ALL items
"RTN","HDISDOC",15,0)
 ; HDIOIEN - may be one of 3 values. A) the IEN for a select item from the 101.43
"RTN","HDISDOC",16,0)
 ;                                B) the word 'ALL' for all items for the HDIAREA selected
"RTN","HDISDOC",17,0)
 ;                                C) a partial match to a 101.43 terms name. this is to collect
"RTN","HDISDOC",18,0)
 ;                                   101.43 items that partial match the name passed in and are
"RTN","HDISDOC",19,0)
 ;                                   associated to the HDIAREA.
"RTN","HDISDOC",20,0)
 ; HDIRET - this is the return array in XML form. 
"RTN","HDISDOC",21,0)
 ; HDIERR - (optional) If defined, If there is an error then it is set to a number
"RTN","HDISDOC",22,0)
 ;           1 - area not sent. 2 - lookup value not sent. 3 - return value not sent.
"RTN","HDISDOC",23,0)
 ;           4 - Improper Search Area
"RTN","HDISDOC",24,0)
 ;           5 - single item not found in 101.43.
"RTN","HDISDOC",25,0)
 ;           6 - single item not in area.
"RTN","HDISDOC",26,0)
 ;           7 - Partial Lookup Error.
"RTN","HDISDOC",27,0)
 ;           8 - Orderable Items File Does Not Have Lab Pointer for Item.
"RTN","HDISDOC",28,0)
 ;           9 - Orderable Item Lab Pointer Not Found in Lab File.
"RTN","HDISDOC",29,0)
 ;          10 -
"RTN","HDISDOC",30,0)
 ;          11 -
"RTN","HDISDOC",31,0)
 ;          12 - Lookup type not sent
"RTN","HDISDOC",32,0)
 ;
"RTN","HDISDOC",33,0)
 ; HDICNT - This will contain counts of the various orders
"RTN","HDISDOC",34,0)
 ;          Area - L.   The return will be different based on the area.
"RTN","HDISDOC",35,0)
 ;
"RTN","HDISDOC",36,0)
 ;          Laboratory L ^ Orderable Item Count (#101.43) ^ Number of Orderable Items Inactive 
"RTN","HDISDOC",37,0)
 ;          ^ Number of Mnemonics ^ Number of Primary Lab Tests (#60) 
"RTN","HDISDOC",38,0)
 ;          ^ Number of Primary Tests are Panels ^ Total Number of Tests (#60) ^ Number of Inactive tests 
"RTN","HDISDOC",39,0)
 ;          ^ Total Number of Specimens (#60, #100) ^ number of inactive specimens 
"RTN","HDISDOC",40,0)
 ;          ^ Number of Master Laboratory Tests (#66.3) ^ number of inactive MLTF's ^ number of unique tests referenced
"RTN","HDISDOC",41,0)
 ;          ^ number of unique MLTF items referenced
"RTN","HDISDOC",42,0)
 ;
"RTN","HDISDOC",43,0)
 ; HDIMN   This is for further delineation of a 'SINGLE' look-up. If the Single item is identified as
"RTN","HDISDOC",44,0)
 ;         an mnemonic by the calling routine the value would be 'Y' for yes.
"RTN","HDISDOC",45,0)
 ;
"RTN","HDISDOC",46,0)
 N MSG
"RTN","HDISDOC",47,0)
 S MSG(1)="   This option may not be called directly from the menu options"
"RTN","HDISDOC",48,0)
 S MSG(2)="   Please use option HDI REQUEST SDO."
"RTN","HDISDOC",49,0)
 S MSG(3)=""
"RTN","HDISDOC",50,0)
 D CLEAR^VALM1
"RTN","HDISDOC",51,0)
 D BMES^XPDUTL(.MSG)
"RTN","HDISDOC",52,0)
 K MSG
"RTN","HDISDOC",53,0)
 Q 
"RTN","HDISDOC",54,0)
 ;
"RTN","HDISDOC",55,0)
 ;
"RTN","HDISDOC",56,0)
EN(HDIAREA,HDITYPE,HDIOIEN,HDIRET,HDIERR,HDICNT,HDIMN) ; entry for lookup
"RTN","HDISDOC",57,0)
 I $G(DT)="" S DT=$$DT^XLFDT
"RTN","HDISDOC",58,0)
 I $G(U)="" S U="^"
"RTN","HDISDOC",59,0)
 N A,B,C,D,E,F,G,I,DA,DR,ROOT,TMP,LAB,PHM,NAR,OK,XHEAD,WB,ORMN,PART,LKUP,O,LAM,RAM,PAM,OIC,OICI
"RTN","HDISDOC",60,0)
 N ORDNM,ORIDT,ORIEN,ORST,DIC,DIQ,K,L,TMPCT,HDIERAR
"RTN","HDISDOC",61,0)
 N HDIA1,HDIA2
"RTN","HDISDOC",62,0)
 S A=$$SITE^VASITE,WB=$P(A,U,2)_"-"_$P(A,U,1),OIC=0,OICI=0,HDIERAR=""
"RTN","HDISDOC",63,0)
 S HDIA1="^TMP(""HDIA1"",$J)",HDIA2="^TMP(""HDIA2"",$J)"
"RTN","HDISDOC",64,0)
 I $G(HDIAREA)="" S HDIERAR=1 ; quit if no area selected
"RTN","HDISDOC",65,0)
 I $G(HDITYPE)="" S HDIERAR=HDIERAR_$S(HDIERAR'="":",",1:"")_12 ; quit if no lookup value is sent
"RTN","HDISDOC",66,0)
 I $G(HDIOIEN)="" S HDIERAR=HDIERAR_$S(HDIERAR'="":",",1:"")_2 ; quit if no lookup value is sent
"RTN","HDISDOC",67,0)
 I $G(HDIRET)="" S HDIERAR=HDIERAR_$S(HDIERAR'="":",",1:"")_3 ; quit if return array is not defined
"RTN","HDISDOC",68,0)
 I HDIERAR'="" Q HDIERAR
"RTN","HDISDOC",69,0)
 ;
"RTN","HDISDOC",70,0)
 K ^TMP("HDISDOLIST",$J),^TMP("HDITMCT",$J)
"RTN","HDISDOC",71,0)
 S TMPCT="^TMP(""HDITMCT"",$J)"
"RTN","HDISDOC",72,0)
 S TMP="^TMP(""HDISDOLIST"",$J)",@TMP@(0)=0
"RTN","HDISDOC",73,0)
 S A=$$UP^XLFSTR(HDIAREA),ORMN="",HDIAREA=A
"RTN","HDISDOC",74,0)
 S NAR=$S($E(A)="L":"LAB",1:"")
"RTN","HDISDOC",75,0)
 I NAR="" S HDIERAR=HDIERAR_$S(HDIERAR'="":",",1:"")_4 Q HDIERAR ; proper area not selected
"RTN","HDISDOC",76,0)
 I $G(HDICNT)'="" S @HDICNT=A
"RTN","HDISDOC",77,0)
 ;xml header
"RTN","HDISDOC",78,0)
 S XHEAD=$S(NAR="LAB":"Laboratory",1:"no area")_"_Orderable_Items",B="xmlns:xs="
"RTN","HDISDOC",79,0)
 S @TMP@(0)=0
"RTN","HDISDOC",80,0)
 S D=$$BTMP,@TMP@(D)=$$XMLHDR^MXMLUTL()
"RTN","HDISDOC",81,0)
 S D=$$BTMP,@TMP@(D)="<"_XHEAD_" "_B_"""http://www.w3.org/2001/XMLSchema"">"
"RTN","HDISDOC",82,0)
 S D=$$BTMP,@TMP@(D)="<Facility>"
"RTN","HDISDOC",83,0)
 S D=$$BTMP,@TMP@(D)="<Facility_Name-Number>"_WB_"</Facility_Name-Number>"
"RTN","HDISDOC",84,0)
 S A=$$PROD^XUPROD(),B=$S(A="1":"YES",1:"NO"),D=$$BTMP,@TMP@(D)="<Facility_Production_Account>"_B_"</Facility_Production_Account>"
"RTN","HDISDOC",85,0)
 S A=$G(^XMB("NETNAME"))
"RTN","HDISDOC",86,0)
 S LKUP=$S($E(HDITYPE,1)="S":"SINGLE",$E(HDITYPE,1)="P":"PARTIAL",HDITYPE="ALL":"ALL",1:"")
"RTN","HDISDOC",87,0)
 S D=$$BTMP,@TMP@(D)="<Facility_Net_Name>"_A_"</Facility_Net_Name>"
"RTN","HDISDOC",88,0)
 S D=$$BTMP,@TMP@(D)="<Look_up_Type>"_LKUP_"</Look_up_Type>"
"RTN","HDISDOC",89,0)
 I LKUP="PARTIAL" S D=$$BTMP,@TMP@(D)="<Look_up_Partial_Name>"_HDIOIEN_"</Look_up_Partial_Name>"
"RTN","HDISDOC",90,0)
 S D=$$BTMP,@TMP@(D)="</Facility>"
"RTN","HDISDOC",91,0)
 I LKUP="" S D=$$BTMP,@TMP@(D)="<Look_up_Type_Error>Look up Type: "_HDIOIEN_", not Identified</Look_up_Type_Error>" G OUT
"RTN","HDISDOC",92,0)
 ;
"RTN","HDISDOC",93,0)
 ; set up allowable sets by area
"RTN","HDISDOC",94,0)
 F I="RX","O RX","UD RX","NV RX","IVA RX","IVB RX","IVM RX","I RX" S PHM(I)=1
"RTN","HDISDOC",95,0)
 F I="LAB","CH","MI","EM","SP","CY","AU" S LAB(I)=1
"RTN","HDISDOC",96,0)
 ;set up if XML
"RTN","HDISDOC",97,0)
 ;
"RTN","HDISDOC",98,0)
 I HDIOIEN="ALL" G ALL
"RTN","HDISDOC",99,0)
 I HDIOIEN?1N.N S A=$$GET1^DIQ(101.43,HDIOIEN_",",.01) I A'="" G IEN
"RTN","HDISDOC",100,0)
 ;   test names may start with alpha, numeric, punctuation.
"RTN","HDISDOC",101,0)
 G PARTIAL
"RTN","HDISDOC",102,0)
 Q
"RTN","HDISDOC",103,0)
 ;
"RTN","HDISDOC",104,0)
ALL ; get all items for an area
"RTN","HDISDOC",105,0)
 K @HDIA1,@HDIA2
"RTN","HDISDOC",106,0)
 D LIST^DIC(101.43,,"@;.001I","MUQ",,,,,,,HDIA1)
"RTN","HDISDOC",107,0)
 S A=0 F  S A=$O(@HDIA1@("DILIST",2,A)) Q:'A  S B=$G(@HDIA1@("DILIST",2,A)),@HDIA2@(B)=""
"RTN","HDISDOC",108,0)
 K @HDIA1
"RTN","HDISDOC",109,0)
 S HDIOIEN=0
"RTN","HDISDOC",110,0)
A1 S HDIOIEN=$O(@HDIA2@(HDIOIEN)) I 'HDIOIEN K @HDIA2 G OUT
"RTN","HDISDOC",111,0)
 ;check that orderable item is for the area
"RTN","HDISDOC",112,0)
 S OK=$$CHKO(HDIOIEN)
"RTN","HDISDOC",113,0)
 I 'OK G A1
"RTN","HDISDOC",114,0)
 I NAR="LAB" D LAB(HDIOIEN)
"RTN","HDISDOC",115,0)
 G A1
"RTN","HDISDOC",116,0)
 ;
"RTN","HDISDOC",117,0)
PARTIAL ; get items that partial match the name sent
"RTN","HDISDOC",118,0)
 S PART=HDIOIEN K ^TMP("HDICHK",$J)
"RTN","HDISDOC",119,0)
 K @HDIA1,@HDIA2
"RTN","HDISDOC",120,0)
 ; this will pick up those items with mnemonics that are related to the partial name sent in.
"RTN","HDISDOC",121,0)
 ; since a orderable name and its mnemonic can start the same place into a temp area to reduce duplication.
"RTN","HDISDOC",122,0)
 D LIST^DIC(101.43,,";.01I","",,,PART,"B",,,HDIA1)
"RTN","HDISDOC",123,0)
 S A=0 F  S A=$O(@HDIA1@("DILIST",2,A)) Q:'A  D  ;<
"RTN","HDISDOC",124,0)
 . S D=$G(@HDIA1@("DILIST",2,A)),E=$G(@HDIA1@("DILIST",1,A)),F=$G(@HDIA1@("DILIST","ID",A,.01))
"RTN","HDISDOC",125,0)
 . S B=$S(((E'=F)&($E(F,1,$L(PART))'=PART)):1,1:"")
"RTN","HDISDOC",126,0)
 . S:'$D(@HDIA2@(D)) @HDIA2@(D)=B
"RTN","HDISDOC",127,0)
 K @HDIA1
"RTN","HDISDOC",128,0)
 S A=0
"RTN","HDISDOC",129,0)
P1A S A=$O(@HDIA2@(A)) I 'A G P2
"RTN","HDISDOC",130,0)
 ; make sure the item is for the correct area.
"RTN","HDISDOC",131,0)
 S OK=$$CHKO(A)
"RTN","HDISDOC",132,0)
 I 'OK D  ;<
"RTN","HDISDOC",133,0)
 . K @HDIA2@(A)
"RTN","HDISDOC",134,0)
 G P1A
"RTN","HDISDOC",135,0)
 ;
"RTN","HDISDOC",136,0)
P2 I $O(@HDIA2@(0))="" D  G OUT
"RTN","HDISDOC",137,0)
 . S HDIERAR=HDIERAR_$S(HDIERAR'="":",",1:"")_7
"RTN","HDISDOC",138,0)
 . I $G(HDIERR)'="" S D=$G(@HDIERR@(0)),D=D+1,@HDIERR@(0)=D,@HDIERR@(D)="Partial_lookup_Error. Partial Name: "_PART_", not found for Area: "_NAR
"RTN","HDISDOC",139,0)
 S HDIOIEN=0
"RTN","HDISDOC",140,0)
P2A S HDIOIEN=$O(@HDIA2@(HDIOIEN)) I 'HDIOIEN K @HDIA2 G OUT
"RTN","HDISDOC",141,0)
 S ORMN=$S($G(@HDIA2@(HDIOIEN))=1:"YES",1:"")
"RTN","HDISDOC",142,0)
 I NAR="LAB" D LAB(HDIOIEN)
"RTN","HDISDOC",143,0)
 G P2A
"RTN","HDISDOC",144,0)
 ;
"RTN","HDISDOC",145,0)
IEN ; find entry for a single IEN in 101.43
"RTN","HDISDOC",146,0)
 S D=$$GET1^DIQ(101.43,HDIOIEN_",",.01) I D="" S HDIERAR=HDIERAR_$S(HDIERAR'="":",",1:"")_5 D  G OUT
"RTN","HDISDOC",147,0)
 . I $G(HDIERR)'="" S D=$G(@HDIERR@(0)),D=D+1,@HDIERR@(0)=D,@HDIERR@(D)="Single_Lookup_Error ("_$G(HDIOIEN)_") Entry Not Found in Orderable Items File"
"RTN","HDISDOC",148,0)
 ; quit on first good
"RTN","HDISDOC",149,0)
 S OK=$$CHKO(HDIOIEN)
"RTN","HDISDOC",150,0)
 I 'OK S HDIERAR=HDIERAR_$S(HDIERAR'="":",",1:"")_6 D  G OUT
"RTN","HDISDOC",151,0)
 . I $G(HDIERR)'="" S D=$G(@HDIERR@(0)),D=D+1,@HDIERR@(0)=D,@HDIERR@(D)="Single_Lookup_Error ("_$G(HDIOIEN)_") Entry Not Found in Orderable Items File"
"RTN","HDISDOC",152,0)
 I $G(HDIMN)="Y" S ORMN="YES"
"RTN","HDISDOC",153,0)
 I NAR="LAB" D LAB(HDIOIEN)
"RTN","HDISDOC",154,0)
 G OUT
"RTN","HDISDOC",155,0)
 ;
"RTN","HDISDOC",156,0)
OUT ; return to calling routine
"RTN","HDISDOC",157,0)
 S D=$$BTMP,@TMP@(D)="</"_XHEAD_">"
"RTN","HDISDOC",158,0)
 I $G(HDICNT)'="" D  ;<
"RTN","HDISDOC",159,0)
 . I NAR="LAB" D  ;<
"RTN","HDISDOC",160,0)
 . . N A,B,C S (A,B)=0 F  S A=$O(@TMPCT@("T",A)) Q:'A  S B=B+1
"RTN","HDISDOC",161,0)
 . . S L=@HDICNT,$P(L,U,13)=B
"RTN","HDISDOC",162,0)
 . . S (A,B)=0 F  S A=$O(@TMPCT@("M",A)) Q:'A  S B=B+1
"RTN","HDISDOC",163,0)
 . . I B S $P(L,U,14)=B
"RTN","HDISDOC",164,0)
 . . S @HDICNT=L
"RTN","HDISDOC",165,0)
 K @HDIRET
"RTN","HDISDOC",166,0)
 M @HDIRET=@TMP
"RTN","HDISDOC",167,0)
 K @TMP
"RTN","HDISDOC",168,0)
 K A,B,C,D,E,F,G,I,DA,DR,ROOT,TMP,LAB,PHM,NAR,OK,XHEAD,WB,ORMN,PART,LKUP,O,LAM,RAM,PAM
"RTN","HDISDOC",169,0)
 K ORDNM,ORIDT,ORIEN,ORST,DIC,DIQ
"RTN","HDISDOC",170,0)
 K HDIA1,HDIA2
"RTN","HDISDOC",171,0)
 I HDIERAR'="" Q HDIERAR
"RTN","HDISDOC",172,0)
 Q "0"
"RTN","HDISDOC",173,0)
 Q
"RTN","HDISDOC",174,0)
 ;
"RTN","HDISDOC",175,0)
LAB(LAM) ;get laboratory SDO's
"RTN","HDISDOC",176,0)
 ;
"RTN","HDISDOC",177,0)
 G LEN^HDISDOCL
"RTN","HDISDOC",178,0)
 ;
"RTN","HDISDOC",179,0)
ORDI(A) ; get info from 101.43
"RTN","HDISDOC",180,0)
 S DA=A
"RTN","HDISDOC",181,0)
 N OA,OB,B,C,D,E,F,O,R,K,M,AAA,AAB,AAC,AAD
"RTN","HDISDOC",182,0)
 S C="",DIQ="OB",DIQ(0)="IE",DIC=101.43,DR=".01;2;.1" K ^UTILITY("DIQ1",$J) D EN^DIQ1 K ^UTILITY("DIQ1",$J)
"RTN","HDISDOC",183,0)
 K OA M OA=OB(101.43,DA) K OB
"RTN","HDISDOC",184,0)
 S ORDNM=$$CHKCHAR($G(OA(.01,"E"))),B=$G(OA(.1,"I")),ORIEN=DA,C=$P($G(OA(2,"I")),";",1)
"RTN","HDISDOC",185,0)
 S ORIDT="",ORST=0 S:(B&(B<DT+1)) ORST=1 S:B ORIDT=$$FMTE^XLFDT($P(B,".",1),5)
"RTN","HDISDOC",186,0)
 I $G(HDICNT)'="" D  ;<
"RTN","HDISDOC",187,0)
 . S L=@HDICNT,K=$P(L,U,2),K=K+1,$P(L,U,2)=K
"RTN","HDISDOC",188,0)
 . I ORIDT'="" S K=$P(L,U,3),K=K+1,$P(L,U,3)=K
"RTN","HDISDOC",189,0)
 . I ORMN'="" S K=$P(L,U,4),K=K+1,$P(L,U,4)=K
"RTN","HDISDOC",190,0)
 . S @HDICNT=L
"RTN","HDISDOC",191,0)
 ; set up order info if XML
"RTN","HDISDOC",192,0)
 S OIC=OIC+1
"RTN","HDISDOC",193,0)
 S D=$$BTMP,@TMP@(D)="<Orderable_Item>"
"RTN","HDISDOC",194,0)
 S D=$$BTMP,@TMP@(D)="<Orderable_Item_Number>"_ORIEN_"</Orderable_Item_Number>"
"RTN","HDISDOC",195,0)
 S D=$$BTMP,@TMP@(D)="<Orderable_Item_Name>"_ORDNM_"</Orderable_Item_Name>"
"RTN","HDISDOC",196,0)
 S D=$$BTMP,@TMP@(D)="<Orderable_Item_Mnemonic>"_ORMN_"</Orderable_Item_Mnemonic>"
"RTN","HDISDOC",197,0)
 S D=$$BTMP,@TMP@(D)="<Orderable_Item_Inactive_Date>"_ORIDT_"</Orderable_Item_Inactive_Date>"
"RTN","HDISDOC",198,0)
 S D=$$BTMP,@TMP@(D)="<Orderable_Item_Status>"_ORST_"</Orderable_Item_Status>"
"RTN","HDISDOC",199,0)
 ; add in the synonym's
"RTN","HDISDOC",200,0)
 S D=$$BTMP,@TMP@(D)="<Orderable_Item_Synonym>"
"RTN","HDISDOC",201,0)
 K AAA D LIST^DIC(101.432,","_DA_",","@;.01I","",,,,,,,"AAA")
"RTN","HDISDOC",202,0)
 K AAB,AAC,AAD M AAB=AAA("DILIST","ID"),AAD=AAA("DILIST",2)
"RTN","HDISDOC",203,0)
 S M=0 F  S M=$O(AAD(M)) Q:'M  S F=$G(AAD(M)),AAC(F)=$G(AAB(M,.01))
"RTN","HDISDOC",204,0)
 S O=0 F  S O=$O(AAC(O)) Q:'O  S R=$$CHKCHAR($G(AAC(O))) D  ;<
"RTN","HDISDOC",205,0)
 . S D=$$BTMP,@TMP@(D)="<Orderable_Item_Synonym_Name>"_R_"</Orderable_Item_Synonym_Name>"
"RTN","HDISDOC",206,0)
 S D=$$BTMP,@TMP@(D)="</Orderable_Item_Synonym>"
"RTN","HDISDOC",207,0)
 K AAA,AAB,AAC,AAD
"RTN","HDISDOC",208,0)
 Q C
"RTN","HDISDOC",209,0)
 ;
"RTN","HDISDOC",210,0)
 ;bump tmp counter
"RTN","HDISDOC",211,0)
BTMP() ;
"RTN","HDISDOC",212,0)
 N F
"RTN","HDISDOC",213,0)
 S F=$G(@TMP@(0)),F=F+1,@TMP@(0)=F
"RTN","HDISDOC",214,0)
 Q F
"RTN","HDISDOC",215,0)
 ;
"RTN","HDISDOC",216,0)
CHKCHAR(A) ; check for ctrl chars, <, >, &
"RTN","HDISDOC",217,0)
 N B,C,I,L,M,N
"RTN","HDISDOC",218,0)
 I A="" Q A
"RTN","HDISDOC",219,0)
 S B="" F I=1:1:$L(A) S C=$E(A,I) D  S L=C
"RTN","HDISDOC",220,0)
 . S M=$E(A,(I+1))
"RTN","HDISDOC",221,0)
 . I $A(C)<32!($A(C)>126) Q  ; skip set
"RTN","HDISDOC",222,0)
 . I C="&" S N="'AND'",B=B_N Q
"RTN","HDISDOC",223,0)
 . I C="<" S N="'LESS THAN'",B=B_N Q
"RTN","HDISDOC",224,0)
 . I C=">" S N="'GREATER THAN'",B=B_N Q
"RTN","HDISDOC",225,0)
 . S B=B_C
"RTN","HDISDOC",226,0)
 Q B
"RTN","HDISDOC",227,0)
 ;
"RTN","HDISDOC",228,0)
OH10143 ;header 101.43
"RTN","HDISDOC",229,0)
 S D=$$BTMP,@TMP@(D)="<Orderable_Item>"
"RTN","HDISDOC",230,0)
 Q
"RTN","HDISDOC",231,0)
 ;
"RTN","HDISDOC",232,0)
OT10143 ; trailer for 101.43
"RTN","HDISDOC",233,0)
 S D=$$BTMP,@TMP@(D)="</Orderable_Item>"
"RTN","HDISDOC",234,0)
 Q
"RTN","HDISDOC",235,0)
 ;
"RTN","HDISDOC",236,0)
OB10143 ; body for 101.43
"RTN","HDISDOC",237,0)
 S D=$$BTMP,@TMP@(D)="<Orderable_Item_Number>"_ORIEN_"</Orderable_Item_Number>"
"RTN","HDISDOC",238,0)
 S D=$$BTMP,@TMP@(D)="<Orderable_Item_Name>"_ORDNM_"</Orderable_Item_Name>"
"RTN","HDISDOC",239,0)
 S D=$$BTMP,@TMP@(D)="<Orderable_Item_Inactive_Date>"_ORIDT_"</Orderable_Item_Inactive_Date>"
"RTN","HDISDOC",240,0)
 S D=$$BTMP,@TMP@(D)="<Orderable_Item_Status>"_ORST_"</Orderable_Item_Status>"
"RTN","HDISDOC",241,0)
 Q
"RTN","HDISDOC",242,0)
 ;
"RTN","HDISDOC",243,0)
CHKO(HOI) ;check if order belongs to the correct area
"RTN","HDISDOC",244,0)
 N A,B,AA,AR,E
"RTN","HDISDOC",245,0)
 S OK="" K AA D LIST^DIC(101.439,","_HOI_",","@;.01I","",,,,,,,"AA")
"RTN","HDISDOC",246,0)
 K AR M AR=AA("DILIST","ID") K AA
"RTN","HDISDOC",247,0)
 S E="" F  S E=$O(AR(E)) Q:'E  S B=$G(AR(E,.01)) S:$G(@NAR@(B))=1 OK=1 I (HDIAREA="L"&((B="BB")!(B="HEMA")!(B="AP")!(B="VBC")!(B="VBEC")!(B="Hemo"))) S OK="" Q
"RTN","HDISDOC",248,0)
 K AR,A,B,AA,E
"RTN","HDISDOC",249,0)
 Q OK
"RTN","HDISDOC",250,0)
 ;
"RTN","HDISDOCL")
0^11^B114683234^n/a
"RTN","HDISDOCL",1,0)
HDISDOCL ;BPFO/DTG - COLLECT LABORTORY ITEMS FOR SDO LIST; Apr 07, 2018@12:42
"RTN","HDISDOCL",2,0)
 ;;1.0;HEALTH DATA & INFORMATICS;**22**;Feb 22, 2005;Build 26
"RTN","HDISDOCL",3,0)
 ;
"RTN","HDISDOCL",4,0)
 ; ICR's:
"RTN","HDISDOCL",5,0)
 ; 6901 - HDI READ LABORATORY SERVICE LABORATORY TEST FILE (#60)
"RTN","HDISDOCL",6,0)
 ; 6902 - HDI READ MASTER LABORATORY TEST FILE (#66.3)
"RTN","HDISDOCL",7,0)
 ;
"RTN","HDISDOCL",8,0)
 Q
"RTN","HDISDOCL",9,0)
 ;
"RTN","HDISDOCL",10,0)
 ;bump tmp counter
"RTN","HDISDOCL",11,0)
BTMP() ;
"RTN","HDISDOCL",12,0)
 N F
"RTN","HDISDOCL",13,0)
 S F=$G(@TMP@(0)),F=F+1,@TMP@(0)=F
"RTN","HDISDOCL",14,0)
 Q F
"RTN","HDISDOCL",15,0)
 ;
"RTN","HDISDOCL",16,0)
LEN ; lab entry point
"RTN","HDISDOCL",17,0)
 ;
"RTN","HDISDOCL",18,0)
 ; LAB TEST IEN, TEST NAME .01, TEST INACTIVE DATE 133, TEST INACTIVE STATUS 132, TEST TYPE 3,
"RTN","HDISDOCL",19,0)
 ; PANEL 200 SUB MULTIPLE, LOCATION DATA NAME #5,13, SITE/SPECIMEN 100, SITE/SPECIMEN IEN, R/S NAME .01,
"RTN","HDISDOCL",20,0)
 ; RESULT/SPECIMEN 33, R/S STATUS 32, MLTF PTR 30
"RTN","HDISDOCL",21,0)
 ; 66.3
"RTN","HDISDOCL",22,0)
 ; IEN, NAME .01, STATUS, LOINC CODE .04, ALT TEST NAME .02
"RTN","HDISDOCL",23,0)
 ;
"RTN","HDISDOCL",24,0)
 N DA,DR,DIR,I,D,B,DIQ,DIC,ORDNM,ORIEN,ORIDT,ORST,PLIEN,PLNAME,PLPN,LT,LG,LB,LC,LRUN,LRIEN,LRNAME,LRMLIDT
"RTN","HDISDOCL",25,0)
 N LRTYPE,LRDAT,LRDAP,LRSTAT,LRIDT,LRSPEC,LRSPN,LRSUN,LRSST,LRSIDT,LRMLTF,LRMLNM,LRMLAN,LRMLLON,LTMP,LRMLSTAT
"RTN","HDISDOCL",26,0)
 N LRMLCOM,LRMLPROP,LRMLTIM,LRMLSPEC,LRMLSCAL,LRMLMET,L60,LPRI,LE,LF,PNLNN
"RTN","HDISDOCL",27,0)
 N LTCNT,BA,LRAA,AA,AR,AB,ABC
"RTN","HDISDOCL",28,0)
 ; initialize vars to avoid undef
"RTN","HDISDOCL",29,0)
 S (DA,DR,DIR,I,D,B,DIQ,DIC,ORDNM,ORIEN,ORIDT,ORST,PLIEN,PLNAME,PLPN,LT,LG,LB,LC,LRUN,LRIEN,LRNAME,LRMLIDT)=""
"RTN","HDISDOCL",30,0)
 S (LRTYPE,LRDAT,LRDAP,LRSTAT,LRIDT,LRSPEC,LRSPN,LRSUN,LRSST,LRSIDT,LRMLTF,LRMLNM,LRMLAN,LRMLLON,LRMLSTAT)=""
"RTN","HDISDOCL",31,0)
 S (LRMLCOM,LRMLPROP,LRMLTIM,LRMLSPEC,LRMLSCAL,LRMLMET,L60,LPRI,LE,LF)=""
"RTN","HDISDOCL",32,0)
 ; get info from 101.43
"RTN","HDISDOCL",33,0)
 ;
"RTN","HDISDOCL",34,0)
 S L60=$$ORDI^HDISDOC(LAM),LPRI=L60
"RTN","HDISDOCL",35,0)
 ;
"RTN","HDISDOCL",36,0)
 S (PLIEN,DA)=L60,PLPN="NO",LT="",LTMP="^TMP(""HDILAB1"",$J)" K @LTMP K DD
"RTN","HDISDOCL",37,0)
 ; check if 60 IEN
"RTN","HDISDOCL",38,0)
 I 'L60 D  G LQUIT
"RTN","HDISDOCL",39,0)
 . S (PLIEN,PLNAME,PLPN)=""
"RTN","HDISDOCL",40,0)
 . S (LRIEN,LRNAME,LRTYPE,LRDAT,LRDAP,LRIDT,LRSTAT)=""
"RTN","HDISDOCL",41,0)
 . S (LRSPEC,LRSPN,LRSUN,LRSIDT,LRSST)=""
"RTN","HDISDOCL",42,0)
 . S (LRMLTF,LRMLNM,LRMLAN,LRMLIDT,LRMLSTAT,LRMLLON,LRMLCOM,LRMLPROP,LRMLTIM,LRMLSPEC,LRMLSCAL,LRMLMET)=""
"RTN","HDISDOCL",43,0)
 . D LH60P,LB60P,LH60T,LB60T,LH6001,LB6001,LH663,LB663,LT663,LT6001,LT60T
"RTN","HDISDOCL",44,0)
 . S HDIERAR=HDIERAR_$S(HDIERAR'="":",",1:"")_8
"RTN","HDISDOCL",45,0)
 . I $G(HDIERR)'="" S D=$G(@HDIERR@(0)),D=D+1,@HDIERR@(0)=D,@HDIERR@(D)="Orderable Item File Does Not Have a Lab File Number Associated. "_LAM_":"_ORDNM
"RTN","HDISDOCL",46,0)
 ;
"RTN","HDISDOCL",47,0)
 S A=$$GET1^DIQ(60,L60_",",.01) I A="" D  G LQUIT
"RTN","HDISDOCL",48,0)
 . S (PLIEN,PLNAME,PLPN)=""
"RTN","HDISDOCL",49,0)
 . S (LRIEN,LRNAME,LRTYPE,LRDAT,LRDAP,LRIDT,LRSTAT)=""
"RTN","HDISDOCL",50,0)
 . S (LRSPEC,LRSPN,LRSUN,LRSIDT,LRSST)=""
"RTN","HDISDOCL",51,0)
 . S (LRMLTF,LRMLNM,LRMLAN,LRMLIDT,LRMLSTAT,LRMLLON,LRMLCOM,LRMLPROP,LRMLTIM,LRMLSPEC,LRMLSCAL,LRMLMET)=""
"RTN","HDISDOCL",52,0)
 . D LH60P,LB60P,LH60T,LB60T,LH6001,LB6001,LH663,LB663,LT663,LT6001,LT60T
"RTN","HDISDOCL",53,0)
 . S HDIERAR=HDIERAR_$S(HDIERAR'="":",",1:"")_9
"RTN","HDISDOCL",54,0)
 . I $G(HDIERR)'="" S D=$G(@HDIERR@(0)),D=D+1,@HDIERR@(0)=D,@HDIERR@(D)="Orderable Item Lab Pointer Not Found in Lab File. "_LAM_":"_ORDNM_":"_L60
"RTN","HDISDOCL",55,0)
 ;
"RTN","HDISDOCL",56,0)
 ;build array
"RTN","HDISDOCL",57,0)
 ; first determine if panel
"RTN","HDISDOCL",58,0)
 K BA D LIST^DIC(60.02,","_L60_",","@;.01I","",,,,,,,"BA")
"RTN","HDISDOCL",59,0)
 S A=$O(BA("DILIST","ID",0)) I A S PLPN="YES"
"RTN","HDISDOCL",60,0)
 K PNLNN,BA
"RTN","HDISDOCL",61,0)
 D PNLCK(PLIEN),GETLAB(PLIEN)
"RTN","HDISDOCL",62,0)
 S PLNAME=$$CHKCHAR($G(LC(.01,"E")))
"RTN","HDISDOCL",63,0)
 I $G(HDICNT)'="" D  ;<
"RTN","HDISDOCL",64,0)
 . S L=@HDICNT,K=$P(L,U,5),K=K+1,$P(L,U,5)=K
"RTN","HDISDOCL",65,0)
 . I PLPN="YES" S K=$P(L,U,6),K=K+1,$P(L,U,6)=K
"RTN","HDISDOCL",66,0)
 . S @HDICNT=L
"RTN","HDISDOCL",67,0)
 D LH60P,LB60P
"RTN","HDISDOCL",68,0)
 ; go through the test array
"RTN","HDISDOCL",69,0)
 S (LRIEN,LRNAME,LRTYPE,LRDAT,LRDAP,LRSTAT,LRIDT,LRSPEC,LRSPN,LRSUN,LRSST,LRSIDT,LRMLTF,LRMLNM,LRMLAN,LRMLSTAT)=""
"RTN","HDISDOCL",70,0)
 S LRMLLON="N/F",(LRMLCOM,LRMLPROP,LRMLTIM,LRMLSPEC,LRMLSCAL,LRMLMET)=""
"RTN","HDISDOCL",71,0)
 S A=$O(@LTMP@(0)) I 'A D  G LQUIT
"RTN","HDISDOCL",72,0)
 . S (LRIEN,LRNAME,LRTYPE,LRDAT,LRDAP,LRIDT,LRSTAT)=""
"RTN","HDISDOCL",73,0)
 . S (LRSPEC,LRSPN,LRSUN,LRSIDT,LRSST)=""
"RTN","HDISDOCL",74,0)
 . S (LRMLTF,LRMLNM,LRMLAN,LRMLIDT,LRMLSTAT,LRMLLON,LRMLCOM,LRMLPROP,LRMLTIM,LRMLSPEC,LRMLSCAL,LRMLMET)=""
"RTN","HDISDOCL",75,0)
 . D LH60T,LB60T,LH6001,LB6001,LH663,LB663,LT663,LT6001,LT60T
"RTN","HDISDOCL",76,0)
 ;
"RTN","HDISDOCL",77,0)
 S LRUN=0
"RTN","HDISDOCL",78,0)
LRT S LRUN=$O(@LTMP@(LRUN)) I 'LRUN G LQUIT
"RTN","HDISDOCL",79,0)
 D GETLAB(LRUN) S LRIEN=LRUN,LRNAME=$$CHKCHAR($G(LC(.01,"E"))),LRTYPE=$G(LC(3,"E"))
"RTN","HDISDOCL",80,0)
 S LRDAT=$G(LC(5,"I")),LRDAP=$G(LC(13,"I"))
"RTN","HDISDOCL",81,0)
 S A=$G(LC(132,"I")),LRSTAT=$S(A="Y":1,1:0),A=$G(LC(133,"I")),LRIDT="" I A S LRIDT=$$FMTE^XLFDT(A,5)
"RTN","HDISDOCL",82,0)
 I $G(HDICNT)'="" D  ;<
"RTN","HDISDOCL",83,0)
 . S L=@HDICNT,K=$P(L,U,7),K=K+1,$P(L,U,7)=K
"RTN","HDISDOCL",84,0)
 . I LRIDT'="" S K=$P(L,U,8),K=K+1,$P(L,U,8)=K
"RTN","HDISDOCL",85,0)
 . S @HDICNT=L
"RTN","HDISDOCL",86,0)
 . ; collect unique tests for count
"RTN","HDISDOCL",87,0)
 . S @TMPCT@("T",LRUN)=""
"RTN","HDISDOCL",88,0)
 D LH60T,LB60T
"RTN","HDISDOCL",89,0)
 ; check specimens
"RTN","HDISDOCL",90,0)
 S (LRSPEC,LRSPN,LRSUN,LRSST,LRSIDT,LRMLTF,LRMLNM,LRMLAN,LRMLSTAT,LRMLIDT)=""
"RTN","HDISDOCL",91,0)
 S LRMLLON="N/F"
"RTN","HDISDOCL",92,0)
 ; S A=$$GET1^DIQ(60,L60_",",.01) I A="" D  G LRT
"RTN","HDISDOCL",93,0)
 K AA D LIST^DIC(60.01,","_LRUN_",","@;.001I","Q",,,,,,,"AA")
"RTN","HDISDOCL",94,0)
 S A=0,A=$O(AA("DILIST",2,A)) I 'A D  G LRT
"RTN","HDISDOCL",95,0)
 . S (LRSPEC,LRSPN,LRSUN,LRSIDT,LRSST)=""
"RTN","HDISDOCL",96,0)
 . S (LRMLTF,LRMLNM,LRMLAN,LRMLIDT,LRMLSTAT,LRMLLON,LRMLCOM,LRMLPROP,LRMLTIM,LRMLSPEC,LRMLSCAL,LRMLMET)=""
"RTN","HDISDOCL",97,0)
 . D LH6001,LB6001,LH663,LB663,LT663,LT6001,LT60T
"RTN","HDISDOCL",98,0)
 ;
"RTN","HDISDOCL",99,0)
 S LRSPEC=0
"RTN","HDISDOCL",100,0)
 K LRAA S A=0 F  S A=$O(AA("DILIST",2,A)) Q:'A  S LRAA($G(AA("DILIST",2,A)))=""
"RTN","HDISDOCL",101,0)
LRS ;S LRSPEC=$O(^LAB(60,LRUN,1,LRSPEC)) I 'LRSPEC D LT60T G LRT
"RTN","HDISDOCL",102,0)
 S LRSPEC=$O(LRAA(LRSPEC)) I 'LRSPEC D LT60T G LRT
"RTN","HDISDOCL",103,0)
 D GETSPEC(LRUN,LRSPEC)
"RTN","HDISDOCL",104,0)
 S LRSPN=$$CHKCHAR($G(LE(.01,"E"))),LRSUN=$G(LE(6,"E")),B=$G(LE(32,"I")),LRSST=$S(B="Y":1,1:"0")
"RTN","HDISDOCL",105,0)
 S B=$G(LE(33,"I")),LRSIDT="" I B S LRSIDT=$$FMTE^XLFDT(B,5)
"RTN","HDISDOCL",106,0)
 S LRMLTF=$G(LE(30,"I"))
"RTN","HDISDOCL",107,0)
 I $G(HDICNT)'="" D  ;<
"RTN","HDISDOCL",108,0)
 . S L=@HDICNT,K=$P(L,U,9),K=K+1,$P(L,U,9)=K
"RTN","HDISDOCL",109,0)
 . I LRSIDT'="" S K=$P(L,U,10),K=K+1,$P(L,U,10)=K
"RTN","HDISDOCL",110,0)
 . S @HDICNT=L
"RTN","HDISDOCL",111,0)
 D LH6001,LB6001
"RTN","HDISDOCL",112,0)
 I LRMLTF D  ;<
"RTN","HDISDOCL",113,0)
 . D GETMLTF(LRMLTF)
"RTN","HDISDOCL",114,0)
 . S LRMLNM=$$CHKCHAR($G(LF(.01,"E"))),LRMLAN=$$CHKCHAR($G(LF(.02,"E"))),LRMLLON=$G(LF(.04,"I")) S:LRMLLON="" LRMLLON="N/F"
"RTN","HDISDOCL",115,0)
 . S LRMLCOM=$$CHKCHAR($G(LF(.05,"E"))),LRMLPROP=$$CHKCHAR($G(LF(.06,"E"))),LRMLTIM=$$CHKCHAR($G(LF(.07,"E")))
"RTN","HDISDOCL",116,0)
 . S LRMLSPEC=$$CHKCHAR($G(LF(.08,"E"))),LRMLSCAL=$$CHKCHAR($G(LF(.09,"E"))),LRMLMET=$$CHKCHAR($G(LF(1,"E")))
"RTN","HDISDOCL",117,0)
 . ; get status
"RTN","HDISDOCL",118,0)
 . N DA,AA,LXH,A,B,C S DA=LRMLTF D LIST^DIC(66.399,","_DA_",","@;.01IE;.02IE","",,,,,,,"AA")
"RTN","HDISDOCL",119,0)
 . K LXH M LXH=AA("DILIST","ID") K AA
"RTN","HDISDOCL",120,0)
 . S A=$O(LXH(99999999),-1),B=$G(LXH(A,.02,"E")),C=$G(LXH(A,.01,"I"))
"RTN","HDISDOCL",121,0)
 . S LRMLSTAT=0,LRMLIDT="" S LRMLSTAT=$S(B="INACTIVE":1,1:0) I LRMLSTAT S LRMLIDT=$$FMTE^XLFDT($P(C,".",1),5)
"RTN","HDISDOCL",122,0)
 . I $G(HDICNT)'="" D  ;<
"RTN","HDISDOCL",123,0)
 . . S L=@HDICNT,K=$P(L,U,11),K=K+1,$P(L,U,11)=K
"RTN","HDISDOCL",124,0)
 . . I LRMLIDT'="" S K=$P(L,U,12),K=K+1,$P(L,U,12)=K
"RTN","HDISDOCL",125,0)
 . . S @HDICNT=L
"RTN","HDISDOCL",126,0)
 . . ; get unique mltf items
"RTN","HDISDOCL",127,0)
 . . S @TMPCT@("M",LRMLTF)=""
"RTN","HDISDOCL",128,0)
 I 'LRMLTF S (LRMLTF,LRMLNM,LRMLAN,LRMLCOM,LRMLPROP,LRMLTIM,LRMLSPEC,LRMLSCAL,LRMLMET,LRMLIDT,LRMLSTAT,LRMLLON)=""
"RTN","HDISDOCL",129,0)
 D LH663,LB663,LT663,LT6001
"RTN","HDISDOCL",130,0)
 G LRS
"RTN","HDISDOCL",131,0)
 ;
"RTN","HDISDOCL",132,0)
LQUIT ; quit back
"RTN","HDISDOCL",133,0)
 D LT60P,OT10143^HDISDOC
"RTN","HDISDOCL",134,0)
 K @LTMP
"RTN","HDISDOCL",135,0)
 K DA,DR,DIR,I,D,B,DIQ,DIC,ORDNM,ORIEN,ORIDT,ORST,PLIEN,PLNAME,PLPN,LT,LG,LB,LC,LRUN,LRIEN,LRNAME
"RTN","HDISDOCL",136,0)
 K LRTYPE,LRDAT,LRDAP,LRSTAT,LRIDT,LRSPEC,LRSPN,LRSUN,LRSST,LRSIDT,LRMLTF,LRMLNM,LRMLAN,LRMLLON,LTMP
"RTN","HDISDOCL",137,0)
 K LRMLCOM,LRMLPROP,LRMLTIM,LRMLSPEC,LRMLSCAL,LRMLMET,L60,LPRI,LE,LF,PNLNN
"RTN","HDISDOCL",138,0)
 K LTCNT,BA,LRAA,AA,AR,AB,ABC
"RTN","HDISDOCL",139,0)
 Q
"RTN","HDISDOCL",140,0)
 ;
"RTN","HDISDOCL",141,0)
PNLCK(LT) ; check for panel
"RTN","HDISDOCL",142,0)
 N A,B,C,D,AA,AR,BA,BR S A=0
"RTN","HDISDOCL",143,0)
 Q:'LT
"RTN","HDISDOCL",144,0)
 S PNLNN(LT)=1
"RTN","HDISDOCL",145,0)
 K AA D LIST^DIC(60.02,","_LT_",","@;.01I","",,,,,,,"AA")
"RTN","HDISDOCL",146,0)
 K AR M AR=AA("DILIST","ID") K AA
"RTN","HDISDOCL",147,0)
 S A=$O(AR(A)) I 'A S @LTMP@(LT)="" Q
"RTN","HDISDOCL",148,0)
 S A=0 F  S A=$O(AR(A)) Q:'A  D  ;<
"RTN","HDISDOCL",149,0)
 . S C=$G(AR(A,.01)) Q:'C
"RTN","HDISDOCL",150,0)
 . ; only have the test once for cycle of primary item
"RTN","HDISDOCL",151,0)
 . I $G(PNLNN(C))=1 Q
"RTN","HDISDOCL",152,0)
 . S PNLNN(C)=1
"RTN","HDISDOCL",153,0)
 . K BA D LIST^DIC(60.02,","_C_",","@;.01I","",,,,,,,"BA")
"RTN","HDISDOCL",154,0)
 . S B=$O(BA("DILIST","ID",0)) I B D PNLCK(C)
"RTN","HDISDOCL",155,0)
 . S @LTMP@(C)=""
"RTN","HDISDOCL",156,0)
 Q
"RTN","HDISDOCL",157,0)
 ;
"RTN","HDISDOCL",158,0)
CHKCHAR(A) ; check for ctrl chars, <, >, &, /
"RTN","HDISDOCL",159,0)
 N B,C,I,L,M,N
"RTN","HDISDOCL",160,0)
 I A="" Q A
"RTN","HDISDOCL",161,0)
 S B="" F I=1:1:$L(A) S C=$E(A,I) D  S L=C
"RTN","HDISDOCL",162,0)
 . S M=$E(A,(I+1))
"RTN","HDISDOCL",163,0)
 . I $A(C)<32!($A(C)>126) Q  ; skip set
"RTN","HDISDOCL",164,0)
 . I C="&" S N="'AND'",B=B_N Q
"RTN","HDISDOCL",165,0)
 . I C="<" S N="'LESS THAN'",B=B_N Q
"RTN","HDISDOCL",166,0)
 . I C=">" S N="'GREATER THAN'",B=B_N Q
"RTN","HDISDOCL",167,0)
 . ;I C="/" S N="'FORWARD SLASH'",B=B_N Q
"RTN","HDISDOCL",168,0)
 . S B=B_C
"RTN","HDISDOCL",169,0)
 Q B
"RTN","HDISDOCL",170,0)
 ;
"RTN","HDISDOCL",171,0)
GETLAB(LG) ; get lab test info
"RTN","HDISDOCL",172,0)
 N A,B,C,D,DA,DR,DIQ
"RTN","HDISDOCL",173,0)
 Q:'LG
"RTN","HDISDOCL",174,0)
 S DA=LG,DIQ="LB",DIQ(0)="IE",DIC=60,DR=".01;3;5;13;133;132" K ^UTILITY("DIQ1",$J) D EN^DIQ1 K ^UTILITY("DIQ1",$J)
"RTN","HDISDOCL",175,0)
 K LC M LC=LB(60,DA) K LB
"RTN","HDISDOCL",176,0)
 ;
"RTN","HDISDOCL",177,0)
GETSPEC(LG,LS) ; get lab test specimen info
"RTN","HDISDOCL",178,0)
 N A,B,C,D,DA,DR,DIQ
"RTN","HDISDOCL",179,0)
 S DIQ="LB",DIQ(0)="IE",DIC=60,DR=100,DA=+LG K LB,^UTILITY("DIQ1",$J)
"RTN","HDISDOCL",180,0)
 S DR(60.01)=".01;6;30;32;33",DA(60.01)=LS
"RTN","HDISDOCL",181,0)
 D EN^DIQ1 K ^UTILITY("DIQ1",$J)
"RTN","HDISDOCL",182,0)
 K LE M LE=LB("60.01",LS) K LB
"RTN","HDISDOCL",183,0)
 Q
"RTN","HDISDOCL",184,0)
 ;
"RTN","HDISDOCL",185,0)
GETMLTF(LM) ; get mltf info from file 66.3
"RTN","HDISDOCL",186,0)
 N A,B,C,D,DA,DR,DIQ
"RTN","HDISDOCL",187,0)
 Q:'LM
"RTN","HDISDOCL",188,0)
 S DA=LM,DIQ="LB",DIQ(0)="IE",DIC=66.3,DR=".01;.02;.04;.05;.06;.07;.08;.09;1" K ^UTILITY("DIQ1",$J) D EN^DIQ1 K ^UTILITY("DIQ1",$J)
"RTN","HDISDOCL",189,0)
 K LF M LF=LB(66.3,DA) K LB
"RTN","HDISDOCL",190,0)
 Q
"RTN","HDISDOCL",191,0)
 ;
"RTN","HDISDOCL",192,0)
LH60P ; header for primary item
"RTN","HDISDOCL",193,0)
 S D=$$BTMP,@TMP@(D)="<Lab_Primary_Order_Item>"
"RTN","HDISDOCL",194,0)
 Q
"RTN","HDISDOCL",195,0)
 ;
"RTN","HDISDOCL",196,0)
LT60P ; trailer for primary item
"RTN","HDISDOCL",197,0)
 S D=$$BTMP,@TMP@(D)="</Lab_Primary_Order_Item>"
"RTN","HDISDOCL",198,0)
 Q
"RTN","HDISDOCL",199,0)
 ;
"RTN","HDISDOCL",200,0)
LB60P ; body for primary item
"RTN","HDISDOCL",201,0)
 S D=$$BTMP,@TMP@(D)="<Lab_Primary_Test_IEN>"_PLIEN_"</Lab_Primary_Test_IEN>"
"RTN","HDISDOCL",202,0)
 S D=$$BTMP,@TMP@(D)="<Lab_Primary_Test_Name>"_PLNAME_"</Lab_Primary_Test_Name>"
"RTN","HDISDOCL",203,0)
 S D=$$BTMP,@TMP@(D)="<Lab_Primary_Test_Panel>"_PLPN_"</Lab_Primary_Test_Panel>"
"RTN","HDISDOCL",204,0)
 Q
"RTN","HDISDOCL",205,0)
 ;
"RTN","HDISDOCL",206,0)
LH60T ; test header for file 60
"RTN","HDISDOCL",207,0)
 S D=$$BTMP,@TMP@(D)="<Laboratory_Test_Item>"
"RTN","HDISDOCL",208,0)
 Q
"RTN","HDISDOCL",209,0)
 ;
"RTN","HDISDOCL",210,0)
LT60T ; test trailer for file 60
"RTN","HDISDOCL",211,0)
 S D=$$BTMP,@TMP@(D)="</Laboratory_Test_Item>"
"RTN","HDISDOCL",212,0)
 Q
"RTN","HDISDOCL",213,0)
 ;
"RTN","HDISDOCL",214,0)
LB60T ; test body for file 60
"RTN","HDISDOCL",215,0)
 S D=$$BTMP,@TMP@(D)="<Lab_Test_IEN>"_LRIEN_"</Lab_Test_IEN>"
"RTN","HDISDOCL",216,0)
 S D=$$BTMP,@TMP@(D)="<Lab_Test_Name>"_LRNAME_"</Lab_Test_Name>"
"RTN","HDISDOCL",217,0)
 S D=$$BTMP,@TMP@(D)="<Lab_Test_Type>"_LRTYPE_"</Lab_Test_Type>"
"RTN","HDISDOCL",218,0)
 S D=$$BTMP,@TMP@(D)="<Lab_Test_Data_Location>"_LRDAT_"</Lab_Test_Data_Location>"
"RTN","HDISDOCL",219,0)
 S D=$$BTMP,@TMP@(D)="<Lab_Test_Data_Loc_Physical>"_LRDAP_"</Lab_Test_Data_Loc_Physical>"
"RTN","HDISDOCL",220,0)
 S D=$$BTMP,@TMP@(D)="<Lab_Test_Inactive_Date>"_LRIDT_"</Lab_Test_Inactive_Date>"
"RTN","HDISDOCL",221,0)
 S D=$$BTMP,@TMP@(D)="<Lab_Test_Status>"_LRSTAT_"</Lab_Test_Status>"
"RTN","HDISDOCL",222,0)
 Q
"RTN","HDISDOCL",223,0)
 ;
"RTN","HDISDOCL",224,0)
LH6001 ; test specimen header for file 60.01
"RTN","HDISDOCL",225,0)
 S D=$$BTMP,@TMP@(D)="<Lab_Test_Specimen>"
"RTN","HDISDOCL",226,0)
 Q
"RTN","HDISDOCL",227,0)
 ;
"RTN","HDISDOCL",228,0)
LT6001 ; test specimen trailer for file 60.01
"RTN","HDISDOCL",229,0)
 S D=$$BTMP,@TMP@(D)="</Lab_Test_Specimen>"
"RTN","HDISDOCL",230,0)
 Q
"RTN","HDISDOCL",231,0)
 ;
"RTN","HDISDOCL",232,0)
LB6001 ; test spceimen body for file 60.01
"RTN","HDISDOCL",233,0)
 S D=$$BTMP,@TMP@(D)="<Lab_Test_Specimen_IEN>"_LRSPEC_"</Lab_Test_Specimen_IEN>"
"RTN","HDISDOCL",234,0)
 S D=$$BTMP,@TMP@(D)="<Lab_Test_Specimen_Name>"_LRSPN_"</Lab_Test_Specimen_Name>"
"RTN","HDISDOCL",235,0)
 S D=$$BTMP,@TMP@(D)="<Lab_Test_Specimen_Units>"_LRSUN_"</Lab_Test_Specimen_Units>"
"RTN","HDISDOCL",236,0)
 S D=$$BTMP,@TMP@(D)="<Lab_Test_Specimen_Inactive_Date>"_LRSIDT_"</Lab_Test_Specimen_Inactive_Date>"
"RTN","HDISDOCL",237,0)
 S D=$$BTMP,@TMP@(D)="<Lab_Test_Specimen_Status>"_LRSST_"</Lab_Test_Specimen_Status>"
"RTN","HDISDOCL",238,0)
 Q
"RTN","HDISDOCL",239,0)
 ;
"RTN","HDISDOCL",240,0)
LH663 ; header for mltf 66.3
"RTN","HDISDOCL",241,0)
 S D=$$BTMP,@TMP@(D)="<Master_Lab_Test_Item>"
"RTN","HDISDOCL",242,0)
 Q
"RTN","HDISDOCL",243,0)
 ;
"RTN","HDISDOCL",244,0)
LT663 ;trailer for mltf 66.3
"RTN","HDISDOCL",245,0)
 S D=$$BTMP,@TMP@(D)="</Master_Lab_Test_Item>"
"RTN","HDISDOCL",246,0)
 Q
"RTN","HDISDOCL",247,0)
 ;
"RTN","HDISDOCL",248,0)
LB663 ; body for mltf 66.3
"RTN","HDISDOCL",249,0)
 S D=$$BTMP,@TMP@(D)="<Master_Lab_Test_IEN>"_LRMLTF_"</Master_Lab_Test_IEN>"
"RTN","HDISDOCL",250,0)
 S D=$$BTMP,@TMP@(D)="<Master_Lab_Test_Name>"_LRMLNM_"</Master_Lab_Test_Name>"
"RTN","HDISDOCL",251,0)
 S D=$$BTMP,@TMP@(D)="<Master_Lab_Test_Alternate_Name>"_LRMLAN_"</Master_Lab_Test_Alternate_Name>"
"RTN","HDISDOCL",252,0)
 S D=$$BTMP,@TMP@(D)="<Master_Lab_Test_Inactive_Date>"_LRMLIDT_"</Master_Lab_Test_Inactive_Date>"
"RTN","HDISDOCL",253,0)
 S D=$$BTMP,@TMP@(D)="<Master_Lab_Test_Status>"_LRMLSTAT_"</Master_Lab_Test_Status>"
"RTN","HDISDOCL",254,0)
 S D=$$BTMP,@TMP@(D)="<Master_Lab_Test_LOINC_Code>"_LRMLLON_"</Master_Lab_Test_LOINC_Code>"
"RTN","HDISDOCL",255,0)
 S D=$$BTMP,@TMP@(D)="<Master_Lab_Test_Component>"_LRMLCOM_"</Master_Lab_Test_Component>"
"RTN","HDISDOCL",256,0)
 S D=$$BTMP,@TMP@(D)="<Master_Lab_Test_Property>"_LRMLPROP_"</Master_Lab_Test_Property>"
"RTN","HDISDOCL",257,0)
 S D=$$BTMP,@TMP@(D)="<Master_Lab_Test_Time_Aspect>"_LRMLTIM_"</Master_Lab_Test_Time_Aspect>"
"RTN","HDISDOCL",258,0)
 S D=$$BTMP,@TMP@(D)="<Master_Lab_Test_Specimen>"_LRMLSPEC_"</Master_Lab_Test_Specimen>"
"RTN","HDISDOCL",259,0)
 S D=$$BTMP,@TMP@(D)="<Master_Lab_Test_Scale>"_LRMLSCAL_"</Master_Lab_Test_Scale>"
"RTN","HDISDOCL",260,0)
 S D=$$BTMP,@TMP@(D)="<Master_Lab_Test_Method>"_LRMLMET_"</Master_Lab_Test_Method>"
"RTN","HDISDOCL",261,0)
 Q
"RTN","HDISDOL")
0^3^B81231137^n/a
"RTN","HDISDOL",1,0)
HDISDOL ;BPFO/DTG - LOOK UP SDO CODES FOR ORDERABLE ITEMS; Apr 07, 2018@12:42
"RTN","HDISDOL",2,0)
 ;;1.0;HEALTH DATA & INFORMATICS;**22**;Feb 22, 2005;Build 26
"RTN","HDISDOL",3,0)
 ;
"RTN","HDISDOL",4,0)
 ; ICR's:
"RTN","HDISDOL",5,0)
 ; 6895 - HDI READ ORDERABLE ITEMS File (#101.43)
"RTN","HDISDOL",6,0)
 ; 6894 - HDI COLLECT SDOS
"RTN","HDISDOL",7,0)
 ;
"RTN","HDISDOL",8,0)
EN ; lookup orderable items for lab
"RTN","HDISDOL",9,0)
 ; pick area
"RTN","HDISDOL",10,0)
 N HDIAR,HDAR,PHM,LAB,DIR,RET,DA,DIE,MSG,I,Y,A,B,C,ERR,DIRUT,COUNT,HOK,HDICRT,HDIGO,HDITSK,HDITYPE,HTYP
"RTN","HDISDOL",11,0)
 N HDIPART,HDISING,HDISP,OIENAM,AA,BB,CC,DD
"RTN","HDISDOL",12,0)
 S RET="^TMP(""HDISDORET"",$J)",(HDIPART,HDISING,HDISP,OIENAM)="",$P(HDISP," ",75)=""
"RTN","HDISDOL",13,0)
 D INFO
"RTN","HDISDOL",14,0)
AREA ; only for Lab
"RTN","HDISDOL",15,0)
    S HDIAR="L"
"RTN","HDISDOL",16,0)
    S HDAR="LAB"
"RTN","HDISDOL",17,0)
    ; set up allowable sets by area
"RTN","HDISDOL",18,0)
 F I="LAB","CH","MI","EM","SP","CY","AU" S LAB(I)=1
"RTN","HDISDOL",19,0)
ASK ; partial, all, or item
"RTN","HDISDOL",20,0)
 S HTYP="" K DIR,Y,DIRUT
"RTN","HDISDOL",21,0)
 S DIR("A")="Enter the Type of Search"
"RTN","HDISDOL",22,0)
 S DIR(0)="SO^P:PARTIAL;S:SINGLE;A:ALL"
"RTN","HDISDOL",23,0)
    S DIR("L",1)=" PARTIAL   (P)"
"RTN","HDISDOL",24,0)
    S DIR("L",2)=" SINGLE    (S)"
"RTN","HDISDOL",25,0)
    S DIR("L",3)=" ALL       (A)"
"RTN","HDISDOL",26,0)
    S DIR("?")="Enter the Type of Search for the lookup. P for Partial, S Single, or A for All. Enter '^' to go back"
"RTN","HDISDOL",27,0)
    D ^DIR
"RTN","HDISDOL",28,0)
    I $D(DIRUT)!($E(Y)="^")!(Y="") W !,*7,"Type Not Selected." G QUIT
"RTN","HDISDOL",29,0)
 I "PSA"'[$E($G(Y)) W !,*7,"Invalid Type Entered." G ASK
"RTN","HDISDOL",30,0)
    S HTYP=$E($G(Y))
"RTN","HDISDOL",31,0)
    I HTYP="A" G ALL
"RTN","HDISDOL",32,0)
    I HTYP="P" G PART
"RTN","HDISDOL",33,0)
    I HTYP="S" G SING
"RTN","HDISDOL",34,0)
 W !,*7,"Type Not Selected. Quiting" G QUIT
"RTN","HDISDOL",35,0)
    ;
"RTN","HDISDOL",36,0)
ALL ;get all of the orderable items for an area
"RTN","HDISDOL",37,0)
 K ERR,ZERR,ERRARY
"RTN","HDISDOL",38,0)
 S ERR="",COUNT="" K @RET
"RTN","HDISDOL",39,0)
 ;
"RTN","HDISDOL",40,0)
 W !,*7," Collecting SDO's",!
"RTN","HDISDOL",41,0)
 S ERR=$$EN^HDISDOC(HDIAR,"ALL","ALL",.RET,"ERRARY","COUNT")
"RTN","HDISDOL",42,0)
 S OK="" I ERR D  I OK G ASK
"RTN","HDISDOL",43,0)
 . D DISER F I=1:1 S A=$P(ERR,",",I) Q:A=""  I A<8!(A=12) S OK=1 Q
"RTN","HDISDOL",44,0)
    D GOTO
"RTN","HDISDOL",45,0)
    G AREA
"RTN","HDISDOL",46,0)
    ;
"RTN","HDISDOL",47,0)
SING ; single lookup select
"RTN","HDISDOL",48,0)
 K DIR,DA,DIRUT
"RTN","HDISDOL",49,0)
 S ERR="",COUNT="" K @RET,ERRARY
"RTN","HDISDOL",50,0)
 S DIR(0)="PO^101.43:EMQZ"
"RTN","HDISDOL",51,0)
 S DIR("A")="Enter the Orderable Item for SDO value"
"RTN","HDISDOL",52,0)
 S DIR("S")="I $$CHKO^HDISDOL(+Y)"
"RTN","HDISDOL",53,0)
 D ^DIR
"RTN","HDISDOL",54,0)
 I $D(DIRUT)!($E(X)="^") G ASK
"RTN","HDISDOL",55,0)
 I +Y'>0 W *7,!,"Invalid Item" G SING
"RTN","HDISDOL",56,0)
 S OIEN=+Y
"RTN","HDISDOL",57,0)
 S SINGM="",A=$P(Y,U,2) I A'=""&($E(A,1,$L(X))'=X) S SINGM="Y"
"RTN","HDISDOL",58,0)
 ; check if proper group
"RTN","HDISDOL",59,0)
 S HOK=$$CHKO(OIEN)
"RTN","HDISDOL",60,0)
 I 'HOK W *7,!,"Orderable Item NOT Associated to Selected Area: LABORATORY" G SING
"RTN","HDISDOL",61,0)
 S OIENAM=$$GETNAM(OIEN)
"RTN","HDISDOL",62,0)
 S ERR=$$EN^HDISDOC(HDAR,"S",OIEN,.RET,"ERRARY","COUNT",SINGM)
"RTN","HDISDOL",63,0)
 S OK="" I ERR D  I OK G SING
"RTN","HDISDOL",64,0)
 . D DISER F I=1:1 S A=$P(ERR,",",I) Q:A=""  I A<8!(A=12) S OK=1 Q
"RTN","HDISDOL",65,0)
 D GOTO
"RTN","HDISDOL",66,0)
 G SING
"RTN","HDISDOL",67,0)
 ;
"RTN","HDISDOL",68,0)
PART ; enter partial name for lookup
"RTN","HDISDOL",69,0)
 K DIR,DA,DIRUT
"RTN","HDISDOL",70,0)
 S ERR="",COUNT="" K @RET,ERRARY
"RTN","HDISDOL",71,0)
 S DIR("A")="Enter a Case Sensitive Partial Match for an Orderable Item Name"
"RTN","HDISDOL",72,0)
 S DIR(0)="FO^1:40^"
"RTN","HDISDOL",73,0)
    S DIR("?")="Enter a case sensitive Partial Match Orderable Item Name to lookup SDO Codes for. Enter '^' to go Back"
"RTN","HDISDOL",74,0)
    D ^DIR
"RTN","HDISDOL",75,0)
    I $D(DIRUT)!(Y="^") G ASK
"RTN","HDISDOL",76,0)
    ; check if any names partial patch and are in the selected area
"RTN","HDISDOL",77,0)
    S PART=Y
"RTN","HDISDOL",78,0)
    D LIST^DIC(101.43,,";.01I","",,,PART,"B",,,"AA")
"RTN","HDISDOL",79,0)
    K AB S A=0 F  S A=$O(AA("DILIST",2,A)) Q:'A  D  ;<
"RTN","HDISDOL",80,0)
    . S D=$G(AA("DILIST",2,A)),E=$G(AA("DILIST",1,A)),F=$G(AA("DILIST","ID",A,.01))
"RTN","HDISDOL",81,0)
    . I $E(E,1,$L(PART))=PART S AB(D)=""
"RTN","HDISDOL",82,0)
    K AA
"RTN","HDISDOL",83,0)
    S OK="",A=0,A=$O(AB(A)) I 'A G P2
"RTN","HDISDOL",84,0)
    S A=0 F  S A=$O(AB(A)) Q:'A  S OK=$$CHKO(A) Q:OK=1  ;<
"RTN","HDISDOL",85,0)
    K AB
"RTN","HDISDOL",86,0)
    ;
"RTN","HDISDOL",87,0)
P2 I 'OK W *7,!!," None of The Partial Matches Are Associated to The Selected Area: LABORATORY" G PART
"RTN","HDISDOL",88,0)
    ;
"RTN","HDISDOL",89,0)
    W !,*7," Collecting SDO's",!
"RTN","HDISDOL",90,0)
    S HDIPART=Y
"RTN","HDISDOL",91,0)
    S ERR=$$EN^HDISDOC(HDAR,"P",Y,.RET,"ERRARY","COUNT")
"RTN","HDISDOL",92,0)
    S OK="" I ERR D  I OK G PART
"RTN","HDISDOL",93,0)
    . D DISER F I=1:1 S A=$P(ERR,",",I) Q:A=""  I A<8!(A=12) S OK=1 Q
"RTN","HDISDOL",94,0)
    D GOTO
"RTN","HDISDOL",95,0)
    G PART
"RTN","HDISDOL",96,0)
    ;
"RTN","HDISDOL",97,0)
INFO ; Display message, clear screen
"RTN","HDISDOL",98,0)
 N MSG
"RTN","HDISDOL",99,0)
 S MSG(1)="   This option allows the user to look up SDO codes for items in the ORDERABLE ITEMS File"
"RTN","HDISDOL",100,0)
 S MSG(2)="   (#101.43). The lookup is limited to orderable items related to Laboratory"
"RTN","HDISDOL",101,0)
 s MSG(4)=""
"RTN","HDISDOL",102,0)
 D CLEAR^VALM1
"RTN","HDISDOL",103,0)
 D BMES^XPDUTL(.MSG)
"RTN","HDISDOL",104,0)
 Q
"RTN","HDISDOL",105,0)
 ;
"RTN","HDISDOL",106,0)
INFOQS ; display quick stats for data return
"RTN","HDISDOL",107,0)
 N MSG,A,B K MSG
"RTN","HDISDOL",108,0)
 S A="Quick Stat for "_$S(HTYP="P":"Partial Match With",HTYP="A":"All",1:"Single")_" "_$S(HDIAR="L":"Laboratory",1:"Pharmacy")_" Orderable Item"_$S(HTYP="A":"s",HTYP="P":" Name:",1:" Name:")
"RTN","HDISDOL",109,0)
 S B=$E(HDISP,1,(40-($L(A)\2)))_A
"RTN","HDISDOL",110,0)
 S MSG(1)=B
"RTN","HDISDOL",111,0)
 S A="" I HTYP="A" S A="ALL Laboratory Orderable Items"
"RTN","HDISDOL",112,0)
 I HTYP="P" S A="Partial Name: "_$E(HDIPART,1,63)
"RTN","HDISDOL",113,0)
 I HTYP="S" S A="IEN: "_OIEN_" Name: "_$E(OIENAM,1,63)
"RTN","HDISDOL",114,0)
 S B=$E(HDISP,1,(40-($L(A)\2)))_A
"RTN","HDISDOL",115,0)
 S MSG(2)=B
"RTN","HDISDOL",116,0)
 G INFOL
"RTN","HDISDOL",117,0)
 ;
"RTN","HDISDOL",118,0)
INFOL ; Display Lab message, clear screen
"RTN","HDISDOL",119,0)
 S MSG(3)="   Orderable Items File Count: "_$J($P(COUNT,U,2),6)
"RTN","HDISDOL",120,0)
 S MSG(4)="   Number of Orderable Items File That Are Inactive: "_$J($P(COUNT,U,3),6)
"RTN","HDISDOL",121,0)
 S MSG(5)="   Number of Orderable Items Partial Match to Mnemonic: "_$J($P(COUNT,U,4),6)
"RTN","HDISDOL",122,0)
 S MSG(6)="   Number of Primary Lab Tests Count: "_$J($P(COUNT,U,5),6)
"RTN","HDISDOL",123,0)
 S MSG(7)="   Number of Primary Tests that are Panels: "_$J($P(COUNT,U,6),6)
"RTN","HDISDOL",124,0)
 S MSG(8)="   Number of Laboratory Tests: "_$J($P(COUNT,U,7),6)
"RTN","HDISDOL",125,0)
 S MSG(9)="   Number of Unique Laboratory Tests: "_$J($P(COUNT,U,13),6)
"RTN","HDISDOL",126,0)
 S MSG(10)="   Number of Inactive Laboratory Tests: "_$J($P(COUNT,U,8),6)
"RTN","HDISDOL",127,0)
 S MSG(11)="   Number of Specimens: "_$J($P(COUNT,U,9),6)
"RTN","HDISDOL",128,0)
 S MSG(12)="   Number of Inactive Specimens: "_$J($P(COUNT,U,10),6)
"RTN","HDISDOL",129,0)
 S MSG(13)="   Number of Master Laboratory Tests: "_$J($P(COUNT,U,11),6)
"RTN","HDISDOL",130,0)
 S MSG(14)="   Number of Unique Master Laboratory Tests: "_$J($P(COUNT,U,14),6)
"RTN","HDISDOL",131,0)
 S MSG(15)="   Number of Inactive Master Laboratory Tests: "_$J($P(COUNT,U,12),6)
"RTN","HDISDOL",132,0)
 S MSG(16)=""
"RTN","HDISDOL",133,0)
 G INFOO
"RTN","HDISDOL",134,0)
 ;
"RTN","HDISDOL",135,0)
INFOO ; output quick stats
"RTN","HDISDOL",136,0)
 D CLEAR^VALM1
"RTN","HDISDOL",137,0)
 N A S A=0 F  S A=$O(MSG(A)) Q:'A  W !,MSG(A)
"RTN","HDISDOL",138,0)
 N DIR,DIRUT,LREND,LRCNT,LRSUB,LRVAL,LRST,LRSTN,LRTXT,X,Y
"RTN","HDISDOL",139,0)
 S DIR(0)="FO^0:3",DIR("A")="Press ENTER to Continue",DIR("B")=" "
"RTN","HDISDOL",140,0)
 D ^DIR
"RTN","HDISDOL",141,0)
 Q
"RTN","HDISDOL",142,0)
 ;
"RTN","HDISDOL",143,0)
QUIT ; exit here
"RTN","HDISDOL",144,0)
 K @RET
"RTN","HDISDOL",145,0)
 K HDIAR,HDAR,PHM,LAB,DIR,RET,DA,DIE,MSG,I,Y,A,B,C,ERR,DIRUT,COUNT
"RTN","HDISDOL",146,0)
 K HOK,HDICRT,HDIGO,HDITSK,HDITYPE,HTYP
"RTN","HDISDOL",147,0)
 K HDIPART,HDISING,HDISP,OIENAM
"RTN","HDISDOL",148,0)
 Q
"RTN","HDISDOL",149,0)
 ;
"RTN","HDISDOL",150,0)
CHKO(HOI) ;check if order belongs to the correct area
"RTN","HDISDOL",151,0)
 N A,B,AA,AR,E
"RTN","HDISDOL",152,0)
 S OK="" K AA D LIST^DIC(101.439,","_HOI_",","@;.01I","",,,,,,,"AA")
"RTN","HDISDOL",153,0)
 K AR M AR=AA("DILIST","ID") K AA
"RTN","HDISDOL",154,0)
 S E="" F  S E=$O(AR(E)) Q:'E  S B=$G(AR(E,.01)) S:$G(@HDAR@(B))=1 OK=1 I (HDIAR="L"&((B="BB")!(B="HEMA")!(B="AP")!(B="VBC")!(B="VBEC")!(B="Hemo"))) S OK="" Q
"RTN","HDISDOL",155,0)
 K AR,A,B,AA,E
"RTN","HDISDOL",156,0)
 Q OK
"RTN","HDISDOL",157,0)
 ;
"RTN","HDISDOL",158,0)
GETNAM(A) ; get orderable item name if single order
"RTN","HDISDOL",159,0)
 N C,DIQ,DIC,DR,DA,OB
"RTN","HDISDOL",160,0)
 S DA=A
"RTN","HDISDOL",161,0)
 S C="",DIQ="OB",DIQ(0)="IE",DIC=101.43,DR=".01" K ^UTILITY("DIQ1",$J) D EN^DIQ1 K ^UTILITY("DIQ1",$J)
"RTN","HDISDOL",162,0)
 Q $G(OB(101.43,DA,.01,"E"))
"RTN","HDISDOL",163,0)
 ;
"RTN","HDISDOL",164,0)
GOTO ;
"RTN","HDISDOL",165,0)
 ; display quick summary
"RTN","HDISDOL",166,0)
 D INFOQS
"RTN","HDISDOL",167,0)
 G TYPE
"RTN","HDISDOL",168,0)
 ; get type
"RTN","HDISDOL",169,0)
TYPE ; determine output format
"RTN","HDISDOL",170,0)
 K DIR,DA,DIRUT
"RTN","HDISDOL",171,0)
 S DIR("A")="Enter the Output Format"
"RTN","HDISDOL",172,0)
 S DIR(0)="SO^X:XML;E:EXPORT;R:REPORT"
"RTN","HDISDOL",173,0)
    S DIR("L",1)=" XML       (X)"
"RTN","HDISDOL",174,0)
    S DIR("L",2)=" EXPORT    (E)"
"RTN","HDISDOL",175,0)
    S DIR("L",3)=" REPORT    (R)"
"RTN","HDISDOL",176,0)
    S DIR("?")="Enter the Output Type for the Search Results. X for XML, E Export Tab Delimited, or R Report. Enter '^' to go back"
"RTN","HDISDOL",177,0)
    D ^DIR
"RTN","HDISDOL",178,0)
    I $D(DIRUT)!($E(Y)="^") W !,*7,"Output Type Not Selected" Q
"RTN","HDISDOL",179,0)
    I ("XER"'[$E($G(Y))) W !,*7,"Valid Type Not Selected. Default to Report" S Y="R"
"RTN","HDISDOL",180,0)
    S HDITYPE=$E(Y)
"RTN","HDISDOL",181,0)
    ;
"RTN","HDISDOL",182,0)
    S HDIGO="^HDISDOL"_HDIAR
"RTN","HDISDOL",183,0)
    ; move REC to REC1 since most printing will go through taskman
"RTN","HDISDOL",184,0)
    S A="",HDITSK="" F I=1:1:100 H 1 S A=$R(1000) I $G(^TMP("HDIOUT",A))'=DT S HDITSK=A Q
"RTN","HDISDOL",185,0)
    S RET1="^TMP(""HDIOUT"",HDITSK)" K @RET1 M @RET1=@RET S @RET1=DT
"RTN","HDISDOL",186,0)
    ;
"RTN","HDISDOL",187,0)
    ;device
"RTN","HDISDOL",188,0)
DEVICE S %ZIS="Q",%ZIS("A")="Output device: " D ^%ZIS
"RTN","HDISDOL",189,0)
 I POP D HOME^ZIS W !,*7,"No Device Selected" Q
"RTN","HDISDOL",190,0)
 S HDICRT=$S($E(IOST,1,2)="C-":1,1:0)
"RTN","HDISDOL",191,0)
 I (HDICRT&(HTYP="A")&(HDITYPE'="R")) S OK="" D DASK I 'OK G DEVICE
"RTN","HDISDOL",192,0)
 I $D(IO("Q")) N ZTDTH,ZTRTN,ZTIO,ZTDESC,ZTIO,ZTSAVE D  W:$D(ZTSK) !!,"Request queued",!! Q
"RTN","HDISDOL",193,0)
 . S A=$P($H,",",2)+30,ZTDTH=$P($H,",",1)_","_A,ZTRTN="EN"_HDIGO
"RTN","HDISDOL",194,0)
 . S ZTDESC="HDI SDO Items For "_HDAR_" Report"
"RTN","HDISDOL",195,0)
 . K ZTIO
"RTN","HDISDOL",196,0)
 . F I="HDICRT","HDITSK","HDITYPE","RET1","HDIAR","HDAR","HTYP","COUNT" S ZTSAVE(I)=""
"RTN","HDISDOL",197,0)
 . D ^%ZTLOAD
"RTN","HDISDOL",198,0)
 . D ^%ZISC
"RTN","HDISDOL",199,0)
 I 'HDICRT W !,*7,"....Outputting...",!!
"RTN","HDISDOL",200,0)
 D @HDIGO
"RTN","HDISDOL",201,0)
 Q
"RTN","HDISDOL",202,0)
 ;
"RTN","HDISDOL",203,0)
DASK ; double dare for local device if type is ALL
"RTN","HDISDOL",204,0)
 N DIR,DIRUT,A,B,Y,C
"RTN","HDISDOL",205,0)
 K DIR,DIRUT
"RTN","HDISDOL",206,0)
 S DIR(0)="Y",DIR("A")="Are you sure you want ALL of the collected items go to your screen?"
"RTN","HDISDOL",207,0)
 S DIR("?")="If you enter yes, the ALL output will go to your screen. With XML and EXPORT there is no interupt logic."
"RTN","HDISDOL",208,0)
 S DIR("B")="No"
"RTN","HDISDOL",209,0)
 D ^DIR
"RTN","HDISDOL",210,0)
 I $D(DIRUT) S OK="" Q
"RTN","HDISDOL",211,0)
 I Y<1 S OK="" Q
"RTN","HDISDOL",212,0)
 S OK=1
"RTN","HDISDOL",213,0)
 Q
"RTN","HDISDOL",214,0)
 ;
"RTN","HDISDOL",215,0)
DISER ; display return error type
"RTN","HDISDOL",216,0)
 I ERR=0 Q
"RTN","HDISDOL",217,0)
 N MSG,A,I,B S MSG(1)="ERROR ITEMS FROM HDI SDO LOOKUP"
"RTN","HDISDOL",218,0)
 F I=1:1 S A=$P(ERR,",",I) Q:A=""  S B(A)=""
"RTN","HDISDOL",219,0)
 ; remove multi's of repeating error #'s
"RTN","HDISDOL",220,0)
 S A=0 F I=1:1 S A=$O(B(A)) Q:'A  S MSG(I+1)=A_") "_$P($T(DISTXT+A),";",3)
"RTN","HDISDOL",221,0)
 I $O(ERRARY(0))>0 D  ;<
"RTN","HDISDOL",222,0)
 . S A=0 F  S A=$O(ERRARY(A)) Q:'A  S MSG(I+1)=ERRARY(A),I=I+1
"RTN","HDISDOL",223,0)
 S MSG(I+1)=""
"RTN","HDISDOL",224,0)
 K A,I
"RTN","HDISDOL",225,0)
 G INFOO
"RTN","HDISDOL",226,0)
 ;
"RTN","HDISDOL",227,0)
DISTXT ; error text
"RTN","HDISDOL",228,0)
 ;;Area Not Sent.
"RTN","HDISDOL",229,0)
 ;;Lookup Value Not Sent.
"RTN","HDISDOL",230,0)
 ;;Return Value Not Sent.
"RTN","HDISDOL",231,0)
 ;;Improper Search Area
"RTN","HDISDOL",232,0)
 ;;Single Item Not Found in ORDERABLE ITEMS File 101.43.
"RTN","HDISDOL",233,0)
 ;;Single Item Not in Area.
"RTN","HDISDOL",234,0)
 ;;Partial Lookup Error.
"RTN","HDISDOL",235,0)
 ;;Orderable Items File Does Not Have Lab Pointer for Item.
"RTN","HDISDOL",236,0)
 ;;Orderable Item Lab Pointer Not Found in Lab File.
"RTN","HDISDOL",237,0)
 ;;
"RTN","HDISDOL",238,0)
 ;;
"RTN","HDISDOL",239,0)
 ;;Type of Lookup not Sent
"RTN","HDISDOLL")
0^4^B185025754^n/a
"RTN","HDISDOLL",1,0)
HDISDOLL ;BPFO/DTG - DISPLAY LOOKUP ITEMS FOR LABORATORY; Apr 07, 2018@12:42
"RTN","HDISDOLL",2,0)
 ;;1.0;HEALTH DATA & INFORMATICS;**22**;Feb 22, 2005;Build 26
"RTN","HDISDOLL",3,0)
 ;
"RTN","HDISDOLL",4,0)
 ;
"RTN","HDISDOLL",5,0)
EN ; Display found orderable items for Lab
"RTN","HDISDOLL",6,0)
 ;
"RTN","HDISDOLL",7,0)
 ;
"RTN","HDISDOLL",8,0)
 ;
"RTN","HDISDOLL",9,0)
 ; put XML into tmp file
"RTN","HDISDOLL",10,0)
 ;^TMP("HDISDOLL",$J,"T")= Orderable Item Type (P, L, or R)
"RTN","HDISDOLL",11,0)
 ;^TMP("HDISDOLL",$J,"F",1)=FACILITY NAME-NUMBER^Production Y/N^NET NAME^type of lookup (single, Partial Match, ALL)^Partial Name
"RTN","HDISDOLL",12,0)
 ;^TMP("HDISDOLL",$J,0)= O# of orderable items
"RTN","HDISDOLL",13,0)
 ;^TMP("HDISDOLL",$J,O#,1)=orderable item IEN^orderable item name^mnemonic^status^inactive date
"RTN","HDISDOLL",14,0)
 ;^TMP("HDISDOLL",$J,O#,"S",0)= S# of synonyms
"RTN","HDISDOLL",15,0)
 ;^TMP("HDISDOLL",$J,O#,"S",S#)= synonym
"RTN","HDISDOLL",16,0)
 ;^TMP("HDISDOLL",$J,O#,"LPI",0)= LPI# of primary test items (#60) tests associated to 101.43 item
"RTN","HDISDOLL",17,0)
 ;^TMP("HDISDOLL",$J,O#,"LPI",LPI#,1)=IEN^name^Panel^ if error
"RTN","HDISDOLL",18,0)
 ;^TMP("HDISDOLL",$J,O#,"LPI",LPI#,"LTI",0)= LTI# of lab test items (#60)
"RTN","HDISDOLL",19,0)
 ;^TMP("HDISDOLL",$J,O#,"LPI",LPI#,"LTI",LTI,1)=IEN^name^type^data location^data physical location^status^inactive dt
"RTN","HDISDOLL",20,0)
 ;^TMP("HDISDOLL",$J,O#,"LPI",LPI#,"LTI",LTI,"LTS",0)= LTS# of specimens for LTI (60.01)
"RTN","HDISDOLL",21,0)
 ;^TMP("HDISDOLL",$J,O#,"LPI",LPI#,"LTI",LTI,"LTS",LTS,1)=IEN^name^units^inactive dt^status
"RTN","HDISDOLL",22,0)
 ;^TMP("HDISDOLL",$J,O#,"LPI",LPI#,"LTI",LTI,"LTS",LTS,2)=MLTF IEN^mltf name^mltf alt name^mltf inactive dt
"RTN","HDISDOLL",23,0)
 ;^TMP("HDISDOLL",$J,O#,"LPI",LPI#,"LTI",LTI,"LTS",LTS,3)=mltf status^mltf LOINC Code^mltf componet^mltf property
"RTN","HDISDOLL",24,0)
 ;^TMP("HDISDOLL",$J,O#,"LPI",LPI#,"LTI",LTI,"LTS",LTS,4)=mltf time aspect^mltf specimen^mltf scale^mltf method
"RTN","HDISDOLL",25,0)
 ;
"RTN","HDISDOLL",26,0)
 ;
"RTN","HDISDOLL",27,0)
EN1 ;
"RTN","HDISDOLL",28,0)
 N LPI,LPIEN,LPNM,LPO1,LPPN,LTI1,LTIDA,LTIDAP,LTIDT,LTIEN,LTINM,TAB,LTI,LTS,HDIORD
"RTN","HDISDOLL",29,0)
 N LTIST,LTITYP,LTMANM,LTMCOM,LTMDT,LTMIEN,LTMLON,LTMMET,LTMNM,LTMPRO,LTMSCA,LTMSPC
"RTN","HDISDOLL",30,0)
 N LTMST,LTMTIM,LTS1,LTS2,LTS3,LTS4,LTSDT,LTSIEN,LTSNM,LTSST,LTSUN,M,HDIV,HD,HD1,HD2
"RTN","HDISDOLL",31,0)
 N O10143,OIDT,OIEN,OIMEN,OINM,OIST,OISYN,OK,OK1,QUIT,R,D,HDIA,HDIFAC,HDIOI,HDIORD,LPPER
"RTN","HDISDOLL",32,0)
 S HDIV="^TMP(""HDISDOLP"",$J)" K @HDIV
"RTN","HDISDOLL",33,0)
 S A=1,TAB=$C(9),QUIT=""
"RTN","HDISDOLL",34,0)
 I HDITYPE="X" G XML
"RTN","HDISDOLL",35,0)
L1 S A=$O(@RET1@(A)) I 'A G L1E
"RTN","HDISDOLL",36,0)
 S B=$G(@RET1@(A)) I B["</Laboratory_Orderable_Items>" G L1E
"RTN","HDISDOLL",37,0)
 I A=2&(B["<Laboratory_Orderable_Items") S @HDIV@("T")="LABORATORY" G L1
"RTN","HDISDOLL",38,0)
 I B="<Facility>" S M="" G L1
"RTN","HDISDOLL",39,0)
 I B["<Facility_Name-Number>" S $P(M,U,1)=$$N(B) G L1
"RTN","HDISDOLL",40,0)
 I B["<Facility_Production_Account>" S $P(M,U,2)=$$N(B) G L1
"RTN","HDISDOLL",41,0)
 I B["<Facility_Net_Name>" S $P(M,U,3)=$$N(B) G L1
"RTN","HDISDOLL",42,0)
 I B["<Look_up_Type>" S $P(M,U,4)=$$N(B) G L1
"RTN","HDISDOLL",43,0)
 I B["<Look_up_Partial_Name>" S $P(M,U,5)=$$N(B) G L1
"RTN","HDISDOLL",44,0)
 I B["</Facility>" S @HDIV@("F",1)=M G L1
"RTN","HDISDOLL",45,0)
 I B="<Orderable_Item>" D  G L1
"RTN","HDISDOLL",46,0)
 . S C=$G(@HDIV@(0)),C=C+1,@HDIV@(0)=C,HDIORD=C,HDIOI="",OK=0,OK1=0
"RTN","HDISDOLL",47,0)
 . F  S A=$O(@RET1@(A)),B=$G(@RET1@(A)) Q:B["</Orderable_Item>"  D  ;<
"RTN","HDISDOLL",48,0)
 . . I B["<Orderable_Item_Number>" S $P(HDIOI,U,1)=$$N(B) Q
"RTN","HDISDOLL",49,0)
 . . I B["<Orderable_Item_Name>" S C=$$N(B),$P(HDIOI,U,2)=$$CHAR(C) Q
"RTN","HDISDOLL",50,0)
 . . I B["<Orderable_Item_Mnemonic>" S C=$$N(B),$P(HDIOI,U,3)=$$CHAR(C) Q
"RTN","HDISDOLL",51,0)
 . . I B["<Orderable_Item_Inactive_Date>" S $P(HDIOI,U,4)=$$N(B) Q
"RTN","HDISDOLL",52,0)
 . . I B["<Orderable_Item_Status>" S $P(HDIOI,U,5)=$$N(B),@HDIV@(HDIORD,1)=HDIOI Q
"RTN","HDISDOLL",53,0)
 . . I B["<Orderable_Item_Synonym>" F  S A=$O(@RET1@(A)),B=$G(@RET1@(A)) D  I OK1=1 Q
"RTN","HDISDOLL",54,0)
 . . . I B["<Orderable_Item_Synonym_Name>" D  Q
"RTN","HDISDOLL",55,0)
 . . . . S D=$G(@HDIV@(HDIORD,"S",0)),D=D+1,@HDIV@(HDIORD,"S",0)=D,C=$$N(B),@HDIV@(HDIORD,"S",D)=$$CHAR(C) Q
"RTN","HDISDOLL",56,0)
 . . . I B["</Orderable_Item_Synonym>" Q
"RTN","HDISDOLL",57,0)
 . . . I B["<Lab_Primary_Order_Item>" S A=A-1,OK1=1 Q
"RTN","HDISDOLL",58,0)
 . . I B="<Lab_Primary_Order_Item>" D  Q
"RTN","HDISDOLL",59,0)
 . . . S C=$G(@HDIV@(HDIORD,"LPI",0)),C=C+1,@HDIV@(HDIORD,"LPI",0)=C,LPI=C,(LPO1,OK,OK1)=""
"RTN","HDISDOLL",60,0)
 . . . F  S A=$O(@RET1@(A)),B=$G(@RET1@(A)) Q:B["</Lab_Primary_Order_Item>"  D  ;<
"RTN","HDISDOLL",61,0)
 . . . . I B["<Lab_Primary_Test_IEN>" S LPO1=$$N(B) Q
"RTN","HDISDOLL",62,0)
 . . . . I B["<Lab_Primary_Test_Name>" S R=$$N(B),$P(LPO1,U,2)=$$CHAR(R) Q
"RTN","HDISDOLL",63,0)
 . . . . I B["Lab_Primary_Test_Panel>" S $P(LPO1,U,3)=$$N(B),@HDIV@(HDIORD,"LPI",LPI,1)=LPO1 Q
"RTN","HDISDOLL",64,0)
 . . . . I B="<Laboratory_Test_Item>" S C=$G(@HDIV@(HDIORD,"LPI",LPI,"LTI",0)),C=C+1,@HDIV@(HDIORD,"LPI",LPI,"LTI",0)=C,LTI=C,LTI1="" F  S A=$O(@RET1@(A)),B=$G(@RET1@(A)) Q:B["</Laboratory_Test_Item>"  D  ;<
"RTN","HDISDOLL",65,0)
 . . . . . I B["<Lab_Test_IEN>" S LTI1=$$N(B) Q
"RTN","HDISDOLL",66,0)
 . . . . . I B["<Lab_Test_Name>" S C=$$N(B),$P(LTI1,U,2)=$$CHAR(C) Q
"RTN","HDISDOLL",67,0)
 . . . . . I B["<Lab_Test_Type>" S $P(LTI1,U,3)=$$N(B) Q
"RTN","HDISDOLL",68,0)
 . . . . . I B["<Lab_Test_Data_Location>" S $P(LTI1,U,4)=$$N(B) Q
"RTN","HDISDOLL",69,0)
 . . . . . I B["<Lab_Test_Data_Loc_Physical>" S $P(LTI1,U,5)=$$N(B) Q
"RTN","HDISDOLL",70,0)
 . . . . . I B["<Lab_Test_Inactive_Date>" S $P(LTI1,U,6)=$$N(B) Q
"RTN","HDISDOLL",71,0)
 . . . . . I B["<Lab_Test_Status>" S $P(LTI1,U,7)=$$N(B),@HDIV@(HDIORD,"LPI",LPI,"LTI",LTI,1)=LTI1 Q
"RTN","HDISDOLL",72,0)
 . . . . . I B="<Lab_Test_Specimen>" S C=$G(@HDIV@(HDIORD,"LPI",LPI,"LTI",LTI,"LTS",0)),C=C+1,@HDIV@(HDIORD,"LPI",LPI,"LTI",LTI,"LTS",0)=C,LTS=C,(LTS1,LTS2,LTS3,LTS4)="" F  S A=$O(@RET1@(A)),B=$G(@RET1@(A)) Q:B["</Lab_Test_Specimen>"  D  ;<
"RTN","HDISDOLL",73,0)
 . . . . . . I B["<Lab_Test_Specimen_IEN>" S LTS1=$$N(B) Q
"RTN","HDISDOLL",74,0)
 . . . . . . I B["<Lab_Test_Specimen_Name>" S C=$$N(B),$P(LTS1,U,2)=$$CHAR(C) Q
"RTN","HDISDOLL",75,0)
 . . . . . . I B["<Lab_Test_Specimen_Units>" S C=$$N(B),$P(LTS1,U,3)=$$CHAR(C) Q
"RTN","HDISDOLL",76,0)
 . . . . . . I B["<Lab_Test_Specimen_Inactive_Date>" S $P(LTS1,U,4)=$$N(B)
"RTN","HDISDOLL",77,0)
 . . . . . . I B["<Lab_Test_Specimen_Status>" S $P(LTS1,U,5)=$$N(B),@HDIV@(HDIORD,"LPI",LPI,"LTI",LTI,"LTS",LTS,1)=LTS1 Q
"RTN","HDISDOLL",78,0)
 . . . . . . I B="<Master_Lab_Test_Item>" Q
"RTN","HDISDOLL",79,0)
 . . . . . . I B="</Master_Lab_Test_Item>" Q
"RTN","HDISDOLL",80,0)
 . . . . . . I B["<Master_Lab_Test_IEN>" S LTS2=$$N(B) Q
"RTN","HDISDOLL",81,0)
 . . . . . . I B["<Master_Lab_Test_Name>" S C=$$N(B),$P(LTS2,U,2)=$$CHAR(C) Q
"RTN","HDISDOLL",82,0)
 . . . . . . I B["<Master_Lab_Test_Alternate_Name>" S C=$$N(B),$P(LTS2,U,3)=$$CHAR(C) Q
"RTN","HDISDOLL",83,0)
 . . . . . . I B["<Master_Lab_Test_Inactive_Date>" S $P(LTS2,U,4)=$$N(B),@HDIV@(HDIORD,"LPI",LPI,"LTI",LTI,"LTS",LTS,2)=LTS2 Q
"RTN","HDISDOLL",84,0)
 . . . . . . I B["<Master_Lab_Test_Status>" S LTS3=$$N(B) Q
"RTN","HDISDOLL",85,0)
 . . . . . . I B["<Master_Lab_Test_LOINC_Code>" S $P(LTS3,U,2)=$$N(B) Q
"RTN","HDISDOLL",86,0)
 . . . . . . I B["<Master_Lab_Test_Component>" S C=$$N(B),$P(LTS3,U,3)=$$CHAR(C) Q
"RTN","HDISDOLL",87,0)
 . . . . . . I B["<Master_Lab_Test_Property>" S C=$$N(B),$P(LTS3,U,4)=$$CHAR(C),@HDIV@(HDIORD,"LPI",LPI,"LTI",LTI,"LTS",LTS,3)=LTS3 Q
"RTN","HDISDOLL",88,0)
 . . . . . . I B["<Master_Lab_Test_Time_Aspect>" S LTS4=$$N(B) Q
"RTN","HDISDOLL",89,0)
 . . . . . . I B["<Master_Lab_Test_Specimen>" S C=$$N(B),$P(LTS4,U,2)=$$CHAR(C) Q
"RTN","HDISDOLL",90,0)
 . . . . . . I B["<Master_Lab_Test_Scale>" S C=$$N(B),$P(LTS4,U,3)=$$CHAR(C) Q
"RTN","HDISDOLL",91,0)
 . . . . . . I B["<Master_Lab_Test_Method>" S C=$$N(B),$P(LTS4,U,4)=$$CHAR(C),@HDIV@(HDIORD,"LPI",LPI,"LTI",LTI,"LTS",LTS,4)=LTS4 Q
"RTN","HDISDOLL",92,0)
 ;
"RTN","HDISDOLL",93,0)
L1E ; end of flip from XML
"RTN","HDISDOLL",94,0)
 ;
"RTN","HDISDOLL",95,0)
 ;
"RTN","HDISDOLL",96,0)
 I HDITYPE="R" G REPORT
"RTN","HDISDOLL",97,0)
 G EXPORT
"RTN","HDISDOLL",98,0)
 Q
"RTN","HDISDOLL",99,0)
 ;
"RTN","HDISDOLL",100,0)
REPORT ;
"RTN","HDISDOLL",101,0)
 ; basic repeats
"RTN","HDISDOLL",102,0)
 S HDIFAC=$G(@HDIV@("F",1)),HDIA=$G(@HDIV@("T")),QUIT="",PAGE=1
"RTN","HDISDOLL",103,0)
 S HD="HDI Orderable Items SDO List For: "_HDIA
"RTN","HDISDOLL",104,0)
 s HD1=$P(HDIFAC,U,1)_"  "_($S($P(HDIFAC,U,2)="NO":"NOT-",1:""))_"PRODUCTION"
"RTN","HDISDOLL",105,0)
 S HD2="Type of Lookup: "_$P(HDIFAC,U,4)
"RTN","HDISDOLL",106,0)
 I $P(HDIFAC,U,4)="PARTIAL" S HD2=HD2_"   Partial Name: "_$P(HDIFAC,U,5)
"RTN","HDISDOLL",107,0)
 S XDD=^DD("DD"),ULINE="",$P(ULINE,"_",79)="_"
"RTN","HDISDOLL",108,0)
 U IO
"RTN","HDISDOLL",109,0)
 S O10143=0,QUIT=""
"RTN","HDISDOLL",110,0)
R1 D GETORD I 'O10143 G PDONE
"RTN","HDISDOLL",111,0)
 D RHEAD,RORD S LPI=0
"RTN","HDISDOLL",112,0)
R2 D GETLPI I 'LPI D PAUSE G PDONE:QUIT,R1
"RTN","HDISDOLL",113,0)
 D RLPI I QUIT G PDONE
"RTN","HDISDOLL",114,0)
 I LPPER G R1
"RTN","HDISDOLL",115,0)
 S LTI=0
"RTN","HDISDOLL",116,0)
R3 D GETLTI I 'LTI G R2
"RTN","HDISDOLL",117,0)
 D RLTI I QUIT G PDONE
"RTN","HDISDOLL",118,0)
 S LTS=0
"RTN","HDISDOLL",119,0)
R4 D GETLTS I 'LTS G R3
"RTN","HDISDOLL",120,0)
 D RLTS1 I QUIT G PDONE
"RTN","HDISDOLL",121,0)
 D RLTS2 I QUIT G PDONE
"RTN","HDISDOLL",122,0)
 G R4
"RTN","HDISDOLL",123,0)
 ;
"RTN","HDISDOLL",124,0)
RCHKC I HDICRT,($Y>(IOSL-4)) D  I QUIT Q
"RTN","HDISDOLL",125,0)
 .D PAUSE
"RTN","HDISDOLL",126,0)
 .Q:QUIT
"RTN","HDISDOLL",127,0)
 .;W @IOF
"RTN","HDISDOLL",128,0)
 .W !
"RTN","HDISDOLL",129,0)
 .I HDITYPE'="X" D RHEAD
"RTN","HDISDOLL",130,0)
 E  I ('HDICRT),($Y>(IOSL-2)) D
"RTN","HDISDOLL",131,0)
 .W @IOF
"RTN","HDISDOLL",132,0)
 .I HDITYPE'="X" D RHEAD
"RTN","HDISDOLL",133,0)
 ;
"RTN","HDISDOLL",134,0)
 Q
"RTN","HDISDOLL",135,0)
 ;
"RTN","HDISDOLL",136,0)
PAUSE N DIR,DIRUT,X,Y
"RTN","HDISDOLL",137,0)
 ;F  Q:$Y>(IOSL-3)  W !
"RTN","HDISDOLL",138,0)
 I 'HDICRT Q
"RTN","HDISDOLL",139,0)
 ; W !
"RTN","HDISDOLL",140,0)
 S DIR(0)="E" D ^DIR
"RTN","HDISDOLL",141,0)
 I ('(+Y))!$D(DIRUT) S QUIT=1
"RTN","HDISDOLL",142,0)
 I 'QUIT S $Y=0
"RTN","HDISDOLL",143,0)
 Q
"RTN","HDISDOLL",144,0)
 ;
"RTN","HDISDOLL",145,0)
DONE ; final quit point
"RTN","HDISDOLL",146,0)
 K @HDIV,@RET1,RET1
"RTN","HDISDOLL",147,0)
 K LPI,LPIEN,LPNM,LPO1,LPPN,LTI1,LTIDA,LTIDAP,LTIDT,LTIEN,LTINM,TAB,LTI,LTS,HDIORD
"RTN","HDISDOLL",148,0)
 K LTIST,LTITYP,LTMANM,LTMCOM,LTMDT,LTMIEN,LTMLON,LTMMET,LTMNM,LTMPRO,LTMSCA,LTMSPC
"RTN","HDISDOLL",149,0)
 K LTMST,LTMTIM,LTS1,LTS2,LTS3,LTS4,LTSDT,LTSIEN,LTSNM,LTSST,LTSUN,M,HDIV,HD,HD1,HD2
"RTN","HDISDOLL",150,0)
 K O10143,OIDT,OIEN,OIMEN,OINM,OIST,OISYN,OK,OK1,QUIT,R,D,HDIA,HDIFAC,HDIOI,HDIORD,LPPER
"RTN","HDISDOLL",151,0)
 Q
"RTN","HDISDOLL",152,0)
 ;
"RTN","HDISDOLL",153,0)
PLE ;
"RTN","HDISDOLL",154,0)
PDONE ; print done
"RTN","HDISDOLL",155,0)
 I 'HDICRT D ^%ZISC
"RTN","HDISDOLL",156,0)
 U IO W !!,?29,$S(QUIT'=1:"--- Report Finished ---",1:"--- Report Aborted ---")
"RTN","HDISDOLL",157,0)
 G DONE
"RTN","HDISDOLL",158,0)
 Q
"RTN","HDISDOLL",159,0)
 ;
"RTN","HDISDOLL",160,0)
 ;
"RTN","HDISDOLL",161,0)
RHEAD ;Description: Prints the report header.
"RTN","HDISDOLL",162,0)
 Q:QUIT
"RTN","HDISDOLL",163,0)
 N LINE
"RTN","HDISDOLL",164,0)
 I $Y>1 W @IOF
"RTN","HDISDOLL",165,0)
 W !,?(40-($L(HD)\2)),HD
"RTN","HDISDOLL",166,0)
 W !,?(40-($L(HD1)\2)),HD1
"RTN","HDISDOLL",167,0)
 W !,?(40-($L(HD2)\2)),HD2
"RTN","HDISDOLL",168,0)
 W !,?27,"Date Printed: "_$$FMTE^XLFDT(DT),?70,"Page ",PAGE
"RTN","HDISDOLL",169,0)
 S PAGE=PAGE+1
"RTN","HDISDOLL",170,0)
 ;
"RTN","HDISDOLL",171,0)
 W !,ULINE
"RTN","HDISDOLL",172,0)
 Q
"RTN","HDISDOLL",173,0)
 ;
"RTN","HDISDOLL",174,0)
RORD ; print order info
"RTN","HDISDOLL",175,0)
 D RCHKC Q:QUIT
"RTN","HDISDOLL",176,0)
 W !,"Orderable Item Name: ",OINM
"RTN","HDISDOLL",177,0)
 D RCHKC Q:QUIT
"RTN","HDISDOLL",178,0)
 W !,"  IEN: ",OIEN,?15,"Mnemonic: ",$S(($E(OIMEN)="Y"):"Yes",1:"No"),?29,"Inactive Date: ",OIDT
"RTN","HDISDOLL",179,0)
 D RCHKC Q:QUIT
"RTN","HDISDOLL",180,0)
 W ?63,"Status: ",$S(OIST=1:"Inactive",1:"  Active")
"RTN","HDISDOLL",181,0)
 D RCHKC Q:QUIT
"RTN","HDISDOLL",182,0)
 W !,"  Synonyms: "
"RTN","HDISDOLL",183,0)
 S A=12,B=0,C="" F  S B=$O(OISYN(B)) Q:'B  S C=$G(OISYN(B)) D:(A+($L(C)+1)>78) RCHKC Q:QUIT  W:(A+($L(C)+1)>78) !,"  " W C W:(B'=OISYN(0)) ", " S A=$S((A+($L(C)+2)>78):2,1:A)+($L(C)+2)
"RTN","HDISDOLL",184,0)
 D RCHKC Q:QUIT
"RTN","HDISDOLL",185,0)
 W !,ULINE
"RTN","HDISDOLL",186,0)
 Q
"RTN","HDISDOLL",187,0)
 ;
"RTN","HDISDOLL",188,0)
RLPI ; print lab primary info
"RTN","HDISDOLL",189,0)
 D RCHKC Q:QUIT
"RTN","HDISDOLL",190,0)
 I LPPER D  Q
"RTN","HDISDOLL",191,0)
 . W !,"Laboratory Primary Item for Orderable Item: ",$E(LPNM,1,33),"..."
"RTN","HDISDOLL",192,0)
 . D RCHKC Q:QUIT
"RTN","HDISDOLL",193,0)
 . W !,"With IEN of: ",LTIEN,"  Not Found in Laboratory Test File"
"RTN","HDISDOLL",194,0)
 W !,"Laboratory Primary Item: ",LPNM,?70,"IEN: ",$E("     ",1,(5-$L(LPIEN))),LPIEN
"RTN","HDISDOLL",195,0)
 D RCHKC Q:QUIT
"RTN","HDISDOLL",196,0)
 W !,"  Panel: ",LPPN
"RTN","HDISDOLL",197,0)
 Q
"RTN","HDISDOLL",198,0)
 ;
"RTN","HDISDOLL",199,0)
RLTI ; print lab test
"RTN","HDISDOLL",200,0)
 D RCHKC Q:QUIT
"RTN","HDISDOLL",201,0)
 W !,"Laboratory Test: ",LTINM,?70,"IEN: ",$E("     ",1,(5-$L(LTIEN))),LTIEN
"RTN","HDISDOLL",202,0)
 D RCHKC Q:QUIT
"RTN","HDISDOLL",203,0)
 W !,"  Type: ",$P(LTITYP," ",1),?17,"Data Location: ",LTIDA,?46,"Data Loc Physical: ",LTIDAP
"RTN","HDISDOLL",204,0)
 D RCHKC Q:QUIT
"RTN","HDISDOLL",205,0)
 W !,"  Inactive Date: ",LTIDT,?61,"Status: " I LTIEN&(LTINM'="") W $S(($E(LTIST)=1):"Inactive",1:"  Active")
"RTN","HDISDOLL",206,0)
 Q
"RTN","HDISDOLL",207,0)
 ;
"RTN","HDISDOLL",208,0)
RLTS1 ; print specimen info
"RTN","HDISDOLL",209,0)
 D RCHKC Q:QUIT
"RTN","HDISDOLL",210,0)
 W !,"Specimen: ",LTSNM,?70,"IEN: ",$E("     ",1,(5-$L(LTSIEN))),LTSIEN
"RTN","HDISDOLL",211,0)
 D RCHKC I QUIT Q
"RTN","HDISDOLL",212,0)
 W !,"  Units: ",LTSUN,?22,"Inactive Date: ",LTSDT,?61,"Status: " I LTSIEN&(LTSNM'="") W $S(($E(LTSST)=1):"Inactive",1:"  Active")
"RTN","HDISDOLL",213,0)
 Q
"RTN","HDISDOLL",214,0)
 ;
"RTN","HDISDOLL",215,0)
RLTS2 ; print initial mltf info
"RTN","HDISDOLL",216,0)
 D RCHKC Q:QUIT
"RTN","HDISDOLL",217,0)
 I LTMNM="" D  Q
"RTN","HDISDOLL",218,0)
 . W !,"Master Lab Test Name: SPECIMEN NOT ASSOCIATED TO MASTER LABORATORY TEST File"
"RTN","HDISDOLL",219,0)
 W !,"Master Lab Test Name: "
"RTN","HDISDOLL",220,0)
 D DISPL(LTMNM,53,71) I QUIT Q
"RTN","HDISDOLL",221,0)
 ;
"RTN","HDISDOLL",222,0)
 D RCHKC Q:QUIT
"RTN","HDISDOLL",223,0)
 W !,"  IEN: ",LTMIEN,?18,"Inactive DT: ",LTMDT,?61,"Status: " I LTMIEN&(LTMNM'="") W $S(($E(LTMST)=1):"Inactive",1:"  Active")
"RTN","HDISDOLL",224,0)
 ;
"RTN","HDISDOLL",225,0)
 D RCHKC Q:QUIT
"RTN","HDISDOLL",226,0)
 W !,"  Alternate Name: "
"RTN","HDISDOLL",227,0)
 D DISPL(LTMANM,56,71) I QUIT Q
"RTN","HDISDOLL",228,0)
 ;
"RTN","HDISDOLL",229,0)
 D RCHKC Q:QUIT
"RTN","HDISDOLL",230,0)
 W !,"  LOINC Code: ",LTMLON
"RTN","HDISDOLL",231,0)
 ;
"RTN","HDISDOLL",232,0)
 D RCHKC Q:QUIT
"RTN","HDISDOLL",233,0)
 W !,"  Component: "
"RTN","HDISDOLL",234,0)
 D DISPL(LTMCOM,63,71) I QUIT Q
"RTN","HDISDOLL",235,0)
 ;
"RTN","HDISDOLL",236,0)
 D RCHKC Q:QUIT
"RTN","HDISDOLL",237,0)
 W !,"  Property: "
"RTN","HDISDOLL",238,0)
 D DISPL(LTMPRO,63,71) I QUIT Q
"RTN","HDISDOLL",239,0)
 ;
"RTN","HDISDOLL",240,0)
 D RCHKC Q:QUIT
"RTN","HDISDOLL",241,0)
 W !,"  Time Aspect: "
"RTN","HDISDOLL",242,0)
 D DISPL(LTMTIM,61,71) I QUIT Q
"RTN","HDISDOLL",243,0)
 ;
"RTN","HDISDOLL",244,0)
 W !,"  Specimen: "
"RTN","HDISDOLL",245,0)
 D DISPL(LTMSPC,63,71) I QUIT Q
"RTN","HDISDOLL",246,0)
 ;
"RTN","HDISDOLL",247,0)
 D RCHKC Q:QUIT
"RTN","HDISDOLL",248,0)
 W !,"  Scale: "
"RTN","HDISDOLL",249,0)
 D DISPL(LTMSCA,66,71) I QUIT Q
"RTN","HDISDOLL",250,0)
 ;
"RTN","HDISDOLL",251,0)
 D RCHKC Q:QUIT
"RTN","HDISDOLL",252,0)
 W !,"  Method: "
"RTN","HDISDOLL",253,0)
 D DISPL(LTMTIM,65,71) I QUIT Q
"RTN","HDISDOLL",254,0)
 Q
"RTN","HDISDOLL",255,0)
 ;
"RTN","HDISDOLL",256,0)
EXPORT ; output as export file
"RTN","HDISDOLL",257,0)
 ; basic repeats
"RTN","HDISDOLL",258,0)
 S HDIFAC=$G(@HDIV@("F",1)),HDIA=$G(@HDIV@("T"))
"RTN","HDISDOLL",259,0)
 ; walk collection
"RTN","HDISDOLL",260,0)
 S O10143=0 D EHEAD
"RTN","HDISDOLL",261,0)
E1 D GETORD I 'O10143 G EOUT
"RTN","HDISDOLL",262,0)
 S LPI=0
"RTN","HDISDOLL",263,0)
E2 D GETLPI I 'LPI G E1
"RTN","HDISDOLL",264,0)
 S LTI=0
"RTN","HDISDOLL",265,0)
E3 D GETLTI I 'LTI G E2
"RTN","HDISDOLL",266,0)
 S LTS=0
"RTN","HDISDOLL",267,0)
E4 D GETLTS I 'LTS G E3
"RTN","HDISDOLL",268,0)
 ; output data
"RTN","HDISDOLL",269,0)
 U IO W $P(HDIFAC,U,1),TAB,$P(HDIFAC,U,2),TAB,$P(HDIFAC,U,3),TAB,HDIA,TAB,$P(HDIFAC,U,4),TAB,$P(HDIFAC,U,5),TAB
"RTN","HDISDOLL",270,0)
 W OIEN,TAB,OINM,TAB,($S(($E(OIMEN)="Y"):"Yes",1:"No")),TAB,OIDT,TAB,($S(OIST=1:"Inactive",1:"Active")),TAB
"RTN","HDISDOLL",271,0)
 ; get synonyms
"RTN","HDISDOLL",272,0)
 S A=0 F I=1:1 S A=$O(OISYN(A)) Q:'A  S B=$G(OISYN(A)) W B W:(I'=$G(OISYN(0))) ", "
"RTN","HDISDOLL",273,0)
 S A="" I LTIEN&(LTINM'="") S A=$S(LTIST=1:"Inactive",1:"Active")
"RTN","HDISDOLL",274,0)
 W TAB,LPIEN,TAB,LPNM,TAB,LPPN,TAB,LTIEN,TAB,LTINM,TAB,LTITYP,TAB,LTIDA,TAB,LTIDAP,TAB,LTIDT,TAB,A,TAB
"RTN","HDISDOLL",275,0)
 S A="" I LTSIEN&(LTSNM'="") S A=$S(LTSST=1:"Inactive",1:"Active")
"RTN","HDISDOLL",276,0)
 W LTSIEN,TAB,LTSNM,TAB,LTSUN,TAB,LTSDT,TAB,A,TAB,LTMIEN,TAB,LTMNM,TAB,LTMANM,TAB,LTMDT,TAB
"RTN","HDISDOLL",277,0)
 S A="" I LTMIEN&(LTMNM'="") S A=$S(LTMST=1:"Inactive",1:"Active")
"RTN","HDISDOLL",278,0)
 W A,TAB,LTMLON,TAB,LTMCOM,TAB,LTMPRO,TAB,LTMTIM,TAB,LTMSPC,TAB,LTMSCA,TAB,LTMMET
"RTN","HDISDOLL",279,0)
 W !
"RTN","HDISDOLL",280,0)
 G E4
"RTN","HDISDOLL",281,0)
 ;
"RTN","HDISDOLL",282,0)
EOUT ;
"RTN","HDISDOLL",283,0)
 I 'HDICRT D ^%ZISC
"RTN","HDISDOLL",284,0)
 G DONE
"RTN","HDISDOLL",285,0)
 Q
"RTN","HDISDOLL",286,0)
 ;
"RTN","HDISDOLL",287,0)
EHEAD ; export header
"RTN","HDISDOLL",288,0)
 U IO W "Facility_Name-Number",TAB,"Production_Account",TAB,"Net_Name",TAB,"Area",TAB,"Type_of_Lookup",TAB
"RTN","HDISDOLL",289,0)
 W "Partial_Name",TAB,"Orderable_Item_IEN",TAB
"RTN","HDISDOLL",290,0)
 W "Orderable_Item_Name",TAB,"Orderable_Item_Mnemonic",TAB,"Orderable_Item_Inactive_Date",TAB,"Orderable_Item_Status",TAB
"RTN","HDISDOLL",291,0)
 W "Orderable_Item_Synonyms",TAB,"Lab_Primary_Test_IEN",TAB,"Lab_Primary_Test_Name",TAB,"Lab_Primary_Test_Panel",TAB
"RTN","HDISDOLL",292,0)
 W "Lab_Test_IEN",TAB,"Lab_Test_Name",TAB,"Lab_Test_Type",TAB,"Lab_Test_Data_Location",TAB,"Lab_Test_Data_Loc_Physical",TAB
"RTN","HDISDOLL",293,0)
 W "Lab_Test_Inactive_Date",TAB,"Lab_Test_Status",TAB,"Lab_Test_Specimen_IEN",TAB,"Lab_Test_Specimen_Name",TAB
"RTN","HDISDOLL",294,0)
 W "Lab_Test_Specimen_Units",TAB,"Lab_Test_Specimen_Inactive_Date",TAB,"Lab_Test_Specimen_Status",TAB
"RTN","HDISDOLL",295,0)
 W "Master_Lab_Test_IEN",TAB,"Master_Lab_Test_Name",TAB,"Master_Lab_Test_Alternate_Name",TAB,"Master_Lab_Test_Inactive_Date",TAB
"RTN","HDISDOLL",296,0)
 W "Master_Lab_Test_Status",TAB,"Master_Lab_Test_LOINC_Code",TAB,"Master_Lab_Test_Component",TAB
"RTN","HDISDOLL",297,0)
 W "Master_Lab_Test_Property",TAB,"Master_Lab_Test_Time_Aspect",TAB,"Master_Lab_Test_Specimen",TAB
"RTN","HDISDOLL",298,0)
 W "Master_Lab_Test_Scale",TAB,"Master_Lab_Test_Method"
"RTN","HDISDOLL",299,0)
 W !
"RTN","HDISDOLL",300,0)
 Q
"RTN","HDISDOLL",301,0)
 ;
"RTN","HDISDOLL",302,0)
GETORD S (OIEN,OINM,OIMEN,OIDT,OIST)=""
"RTN","HDISDOLL",303,0)
 S O10143=$O(@HDIV@(O10143)) I 'O10143 Q
"RTN","HDISDOLL",304,0)
 S B=$G(@HDIV@(O10143,1)),OIEN=$P(B,U,1),OINM=$P(B,U,2),OIMEN=$P(B,U,3),OIDT=$P(B,U,4),OIST=$P(B,U,5)
"RTN","HDISDOLL",305,0)
 K OISYN M OISYN=@HDIV@(O10143,"S")
"RTN","HDISDOLL",306,0)
 Q
"RTN","HDISDOLL",307,0)
 ;
"RTN","HDISDOLL",308,0)
GETLPI ; get primary lab item
"RTN","HDISDOLL",309,0)
 S (LPIEN,LPNM,LPPN,LPPER)=""
"RTN","HDISDOLL",310,0)
 N C
"RTN","HDISDOLL",311,0)
 S LPI=$O(@HDIV@(O10143,"LPI",LPI)) I 'LPI Q
"RTN","HDISDOLL",312,0)
 S B=$G(@HDIV@(O10143,"LPI",LPI,1)),LPIEN=$P(B,U,1),LPNM=$P(B,U,2),LPPN=$P(B,U,3)
"RTN","HDISDOLL",313,0)
 I $P(B,U,4)'="" S C=$P(B,U,4),LPIEN=$P(C,":",1),LPNM=$P(C,":",2),LPPER=1
"RTN","HDISDOLL",314,0)
 Q
"RTN","HDISDOLL",315,0)
 ;
"RTN","HDISDOLL",316,0)
GETLTI ; get lab test item
"RTN","HDISDOLL",317,0)
 S (LTIEN,LTINM,LTITYP,LTIDA,LTIDAP,LTIDT,LTIST)=""
"RTN","HDISDOLL",318,0)
 S LTI=$O(@HDIV@(O10143,"LPI",LPI,"LTI",LTI)) I 'LTI Q
"RTN","HDISDOLL",319,0)
 S B=$G(@HDIV@(O10143,"LPI",LPI,"LTI",LTI,1)),LTIEN=$P(B,U,1),LTINM=$P(B,U,2),LTITYP=$P(B,U,3)
"RTN","HDISDOLL",320,0)
 S LTIDA=$P(B,U,4),LTIDAP=$P(B,U,5),LTIDT=$P(B,U,6),LTIST=$P(B,U,7)
"RTN","HDISDOLL",321,0)
 Q
"RTN","HDISDOLL",322,0)
 ;
"RTN","HDISDOLL",323,0)
GETLTS ; get lab specimen and mltf item
"RTN","HDISDOLL",324,0)
 S (LTSIEN,LTSNM,LTSUN,LTSDT,LTSST,LTMIEN,LTMNM,LTMANM,LTMST,LTMLON,LTMCOM,LTMPRO,LTMTIM,LTMSPC,LTMSCA,LTMMET)=""
"RTN","HDISDOLL",325,0)
 S LTS=$O(@HDIV@(O10143,"LPI",LPI,"LTI",LTI,"LTS",LTS)) I 'LTS Q
"RTN","HDISDOLL",326,0)
 S B=$G(@HDIV@(O10143,"LPI",LPI,"LTI",LTI,"LTS",LTS,1)),LTSIEN=$P(B,U,1),LTSNM=$P(B,U,2),LTSUN=$P(B,U,3)
"RTN","HDISDOLL",327,0)
 S LTSDT=$P(B,U,4),LTSST=$P(B,U,5)
"RTN","HDISDOLL",328,0)
 S B=$G(@HDIV@(O10143,"LPI",LPI,"LTI",LTI,"LTS",LTS,2)),LTMIEN=$P(B,U,1),LTMNM=$P(B,U,2),LTMANM=$P(B,U,3)
"RTN","HDISDOLL",329,0)
 S LTMDT=$P(B,U,4)
"RTN","HDISDOLL",330,0)
 S B=$G(@HDIV@(O10143,"LPI",LPI,"LTI",LTI,"LTS",LTS,3)),LTMST=$P(B,U,1),LTMLON=$P(B,U,2),LTMCOM=$P(B,U,3),LTMPRO=$P(B,U,4)
"RTN","HDISDOLL",331,0)
 S B=$G(@HDIV@(O10143,"LPI",LPI,"LTI",LTI,"LTS",LTS,4)),LTMTIM=$P(B,U,1),LTMSPC=$P(B,U,2),LTMSCA=$P(B,U,3),LTMMET=$P(B,U,4)
"RTN","HDISDOLL",332,0)
 Q
"RTN","HDISDOLL",333,0)
 ;
"RTN","HDISDOLL",334,0)
CHAR(A) ; check for ctrl chars, <, >, &
"RTN","HDISDOLL",335,0)
 N B,C,D,I,L,M,N
"RTN","HDISDOLL",336,0)
 I A="" Q A
"RTN","HDISDOLL",337,0)
 S D=A
"RTN","HDISDOLL",338,0)
 I A["'AND'" D  ;<
"RTN","HDISDOLL",339,0)
 . S B=$F(A,"'AND'")
"RTN","HDISDOLL",340,0)
 . S A=$E(A,1,(B-6))_"&"_$E(A,B,$L(A))
"RTN","HDISDOLL",341,0)
 I A["'LESS THAN'" D  ;<
"RTN","HDISDOLL",342,0)
 . S B=$F(A,"'LESS THAN'")
"RTN","HDISDOLL",343,0)
 . S A=$E(A,1,(B-12))_"<"_$E(A,B,$L(A))
"RTN","HDISDOLL",344,0)
 I A["'GREATER THAN'" D  ;<
"RTN","HDISDOLL",345,0)
 . S B=$F(A,"'GREATER THAN'")
"RTN","HDISDOLL",346,0)
 . S A=$E(A,1,(B-15))_">"_$E(A,B,$L(A))
"RTN","HDISDOLL",347,0)
 I A["'FORWARD SLASH'" D  ;<
"RTN","HDISDOLL",348,0)
 . S B=$F(A,"'FORWARD SLASH'")
"RTN","HDISDOLL",349,0)
 . S A=$E(A,1,(B-16))_"/"_$E(A,B,$L(A))
"RTN","HDISDOLL",350,0)
 Q A
"RTN","HDISDOLL",351,0)
 ;
"RTN","HDISDOLL",352,0)
N(K) ;get value
"RTN","HDISDOLL",353,0)
 N F
"RTN","HDISDOLL",354,0)
 S F=$P($P(K,"<",2),">",2)
"RTN","HDISDOLL",355,0)
 Q F
"RTN","HDISDOLL",356,0)
 ;
"RTN","HDISDOLL",357,0)
XML ; entry if output is XML
"RTN","HDISDOLL",358,0)
 U IO
"RTN","HDISDOLL",359,0)
 N A,B,C S A=0
"RTN","HDISDOLL",360,0)
 F  S A=$O(@RET1@(A)) Q:'A  W $G(@RET1@(A)),! ; D RCHKC I QUIT Q
"RTN","HDISDOLL",361,0)
 K A,B,C
"RTN","HDISDOLL",362,0)
 ;G PDONE
"RTN","HDISDOLL",363,0)
 I 'HDICRT D ^%ZISC
"RTN","HDISDOLL",364,0)
 Q
"RTN","HDISDOLL",365,0)
 ;
"RTN","HDISDOLL",366,0)
DISPL(S,F,E) ; display lines
"RTN","HDISDOLL",367,0)
 N A,D
"RTN","HDISDOLL",368,0)
 I S="" Q
"RTN","HDISDOLL",369,0)
 I $L(S)<F W S G DISPL1
"RTN","HDISDOLL",370,0)
 S D=F F  Q:S=""  S A="" D  I QUIT Q  ;<
"RTN","HDISDOLL",371,0)
 . S A=$E(S,1,D),S=$E(S,(D+1),$L(S)),D=E
"RTN","HDISDOLL",372,0)
 . W A I S'="" W " <"
"RTN","HDISDOLL",373,0)
 . D RCHKC
"RTN","HDISDOLL",374,0)
 . Q:QUIT
"RTN","HDISDOLL",375,0)
 . I S'="" W !,"  > "
"RTN","HDISDOLL",376,0)
DISPL1 ;
"RTN","HDISDOLL",377,0)
 I QUIT Q
"RTN","HDISDOLL",378,0)
 D RCHKC Q:QUIT
"RTN","HDISDOLL",379,0)
 ;
"RTN","HDISDSR")
0^6^B8012840^n/a
"RTN","HDISDSR",1,0)
HDISDSR ;BPFO/DTG - HDI MAILMAN SERVER FOR COLLECTING SDO; Apr 07, 2018@12:42
"RTN","HDISDSR",2,0)
 ;;1.0;HEALTH DATA & INFORMATICS;**22**;Feb 22, 2005;Build 26
"RTN","HDISDSR",3,0)
 ;
"RTN","HDISDSR",4,0)
START ;
"RTN","HDISDSR",5,0)
 N A,HDISITE,HDIST,HDISUB,HDIXMZ,HDISV,HDER,HDICRLF,HDIJB,HDILEN,HDIMSUBJ,HDIQUIT,HDITXT,HDINODE
"RTN","HDISDSR",6,0)
 N HDIMAX
"RTN","HDISDSR",7,0)
 ;
"RTN","HDISDSR",8,0)
 ; Save incoming server message id for cleanup
"RTN","HDISDSR",9,0)
 S HDIXMZ=XMZ
"RTN","HDISDSR",10,0)
 ;
"RTN","HDISDSR",11,0)
 S HDISV="^TMP($J,""HDIDATA"")",HDER="^TMP($J,""HDIDTERR"")"
"RTN","HDISDSR",12,0)
 K @HDISV,@HDER
"RTN","HDISDSR",13,0)
 ; Determine station name and number
"RTN","HDISDSR",14,0)
 S HDISITE=$$SITE^VASITE,HDISTN=$P(HDISITE,"^",2),HDIST=$P(HDISITE,"^",3)
"RTN","HDISDSR",15,0)
 I HDIST="" S HDIST="???"
"RTN","HDISDSR",16,0)
 ;
"RTN","HDISDSR",17,0)
 S HDISUB=$$UP^XLFSTR(XQSUB)
"RTN","HDISDSR",18,0)
 ;
"RTN","HDISDSR",19,0)
 ; The first line of the message tells who requested the action and when
"RTN","HDISDSR",20,0)
 ; The second line tells when the server is activated and no data can be
"RTN","HDISDSR",21,0)
 ; gathered from the MailMan message.  This line gets replaced if the
"RTN","HDISDSR",22,0)
 ; server finds something to do.
"RTN","HDISDSR",23,0)
 S A="SDO lookup option: "_HDISUB_$J("      ",6)
"RTN","HDISDSR",24,0)
 S ^TMP($J,"HDIDATA",1)=A
"RTN","HDISDSR",25,0)
 S A="Was triggered at "_HDISTN_" by "_XMFROM_" on "_XQDATE_$J("      ",6)
"RTN","HDISDSR",26,0)
 S ^TMP($J,"HDIDATA",2)=A
"RTN","HDISDSR",27,0)
 S ^TMP($J,"HDIDATA",3)=" "_$J("      ",6)
"RTN","HDISDSR",28,0)
 S HDIACTON=HDISUB
"RTN","HDISDSR",29,0)
 S A="This SDO lookup option: "_HDIACTON_$J("      ",6)
"RTN","HDISDSR",30,0)
 S ^TMP($J,"HDIDATA",4)=A
"RTN","HDISDSR",31,0)
 S A="Is NOT available at "_HDISTN_$J("      ",6)
"RTN","HDISDSR",32,0)
 S ^TMP($J,"HDIDATA",5)=A
"RTN","HDISDSR",33,0)
 S A=""
"RTN","HDISDSR",34,0)
 ;
"RTN","HDISDSR",35,0)
 ;
"RTN","HDISDSR",36,0)
 I HDISUB="LAB" D EN1^HDISDSRL Q
"RTN","HDISDSR",37,0)
 ;
"RTN","HDISDSR",38,0)
 ; If subject not understood by server, send a message to the sender
"RTN","HDISDSR",39,0)
 ;  that the server can't understand their instructions.
"RTN","HDISDSR",40,0)
 K XMY
"RTN","HDISDSR",41,0)
 S XMY(XQSND)=""
"RTN","HDISDSR",42,0)
 ;
"RTN","HDISDSR",43,0)
EXIT ; If all went well, report that too.
"RTN","HDISDSR",44,0)
 ; Mail the errors and successes back to the Roll-Up group at Forum.
"RTN","HDISDSR",45,0)
 N HDINOW
"RTN","HDISDSR",46,0)
 S HDINOW=$$NOW^XLFDT,A=$$FMTE^XLFDT(HDINOW,5)
"RTN","HDISDSR",47,0)
 S XMDUN="HDI SDO Server",XMDUZ=".5",XMSUB=HDISTN_" HDI SDO SERVER ("_A_" ["_HDINOW_"])"
"RTN","HDISDSR",48,0)
 K XMTEXT S XMTEXT="^TMP($J,""HDIDATA"","
"RTN","HDISDSR",49,0)
 I '$D(XMY) S XMY($G(XQSND))=""
"RTN","HDISDSR",50,0)
 N DIFROM D ^XMD K DIFROM
"RTN","HDISDSR",51,0)
 ;
"RTN","HDISDSR",52,0)
CLEAN ; Cleanup and exit
"RTN","HDISDSR",53,0)
 I $D(^TMP($J,"HDIDTERR")) D
"RTN","HDISDSR",54,0)
 . S XMDUN="HDI SDO Order Server",XMDUZ=".5"
"RTN","HDISDSR",55,0)
 . S XMSUB=HDISTN_" HDI SDO ORDER SERVER ERROR ("_HDINOW_")"
"RTN","HDISDSR",56,0)
 . S XMTEXT="^TMP($J,""HDIDTERR"","
"RTN","HDISDSR",57,0)
 . S XMY(XQSND)=""
"RTN","HDISDSR",58,0)
 . D ^XMD
"RTN","HDISDSR",59,0)
 ;
"RTN","HDISDSR",60,0)
 ; Clean up server message in MailMan
"RTN","HDISDSR",61,0)
 I $G(HDIXMZ)>0 D ZAPSERV^XMXAPI("S.HDISDOSERVER",HDIXMZ)
"RTN","HDISDSR",62,0)
 ;
"RTN","HDISDSR",63,0)
 K %,%DT,%H,D,DD,DIC,DIERR,ERROR,FILL,LINE,LOINCDTA,LOINCDTB,LOINCTAS
"RTN","HDISDSR",64,0)
 K HDIA,HDIAA,HDIACTON,HDIB,HDICLST,HDIDA,HDIERR,HDIFOUND,HDIFOUND1,HDII,HDILINE
"RTN","HDISDSR",65,0)
 K HDINDE,HDIOUT,HDIPNT,HDIPNTA,HDIPNTB,HDIRDT,HDIRN,HDIROOT,HDIST,HDISTN,HDISUB
"RTN","HDISDSR",66,0)
 K X,XMDUN,XMDUZ,XMER,XMFROM,XMREC,XMRG,XMSUB,XMTEXT,XMY,XMZ,XQDATE,HDINODE
"RTN","HDISDSR",67,0)
 K XQSND,XQSUB,Y,ZTQUEUED,ZTSK,HDICRLF,HDIJB,HDILEN,HDIMSUBJ,HDIQUIT,HDITXT
"RTN","HDISDSR",68,0)
 K HDIMAX
"RTN","HDISDSR",69,0)
 ;
"RTN","HDISDSR",70,0)
 K ^TMP($J,"HDIDATA"),^TMP($J,"HDIDTERR")
"RTN","HDISDSR",71,0)
 S:$D(ZTQUEUED) ZTREQ="@"
"RTN","HDISDSR",72,0)
 Q
"RTN","HDISDSR1")
0^7^B13794495^n/a
"RTN","HDISDSR1",1,0)
HDISDSR1 ;BPFO/DTG - HDI MAILMAN SERVER COLLECT SDO DATA; Apr 07, 2018@12:42
"RTN","HDISDSR1",2,0)
 ;;1.0;HEALTH DATA & INFORMATICS;**22**;Feb 22, 2005;Build 26
"RTN","HDISDSR1",3,0)
 ;
"RTN","HDISDSR1",4,0)
 ;
"RTN","HDISDSR1",5,0)
INIT ; initialize vars and file
"RTN","HDISDSR1",6,0)
 ;
"RTN","HDISDSR1",7,0)
 ; Uses ICR 5812 to read file 4.3 field 8.3
"RTN","HDISDSR1",8,0)
 ;
"RTN","HDISDSR1",9,0)
 K @HDISV
"RTN","HDISDSR1",10,0)
 S HDITXT=0,HDICRLF=$C(13,10),HDITAB=$C(9),HDIJB=$J,U="^"
"RTN","HDISDSR1",11,0)
 S HDISTR=""
"RTN","HDISDSR1",12,0)
 S HDISITE=$$SITE^VASITE,HDISTN=$P(HDISITE,"^",2),HDIST=$P(HDISITE,"^",3)
"RTN","HDISDSR1",13,0)
 I HDIST="" S HDIST="???"
"RTN","HDISDSR1",14,0)
 ;
"RTN","HDISDSR1",15,0)
 S HDISUB=$$UP^XLFSTR(XQSUB)
"RTN","HDISDSR1",16,0)
 ;get max lines and make character count
"RTN","HDISDSR1",17,0)
 N A,B S A=$$GET1^DIQ(4.3,"1,",8.3,"I") S B=$S((+A=0):5469,(A>15000):15000,1:A)
"RTN","HDISDSR1",18,0)
 S HDIMAX=((B*250)-((B*250)*.3))\1
"RTN","HDISDSR1",19,0)
 ;
"RTN","HDISDSR1",20,0)
 Q
"RTN","HDISDSR1",21,0)
 ;
"RTN","HDISDSR1",22,0)
MAILSEND(HDISUBJ) ; Send extract back to requestor.
"RTN","HDISDSR1",23,0)
 ;
"RTN","HDISDSR1",24,0)
 N HDINSTR,HDITASK,HDITO,XMERR,XMZ,A
"RTN","HDISDSR1",25,0)
 ;
"RTN","HDISDSR1",26,0)
 ;ZEXCEPT: XQSND
"RTN","HDISDSR1",27,0)
 ;
"RTN","HDISDSR1",28,0)
 ;S 1=1
"RTN","HDISDSR1",29,0)
 S HDITO(XQSND)=""
"RTN","HDISDSR1",30,0)
 S HDINSTR("ADDR FLAGS")="R"
"RTN","HDISDSR1",31,0)
 S HDINSTR("FROM")="HDI_SDO_CODES"
"RTN","HDISDSR1",32,0)
 S HDISUBJ=$E(HDISUBJ,1,65)
"RTN","HDISDSR1",33,0)
 D SENDMSG^XMXAPI(.5,HDISUBJ,"^TMP($J,""HDIDATA"")",.HDITO,.HDINSTR,.HDITASK)
"RTN","HDISDSR1",34,0)
 S A=$G(^DTGHD("A",0)),A=A+1,^DTGHD("A",0)=A,^DTGHD("A",A)=HDITASK
"RTN","HDISDSR1",35,0)
 Q
"RTN","HDISDSR1",36,0)
 ;
"RTN","HDISDSR1",37,0)
ENCODE(HDISTR) ; Encode a string, keep remainder for next line
"RTN","HDISDSR1",38,0)
 ; Call with ORSTR by reference, Remainder returned in LRSTR
"RTN","HDISDSR1",39,0)
 ;
"RTN","HDISDSR1",40,0)
 S HDIQUIT=0,HDILEN=$L(HDISTR)
"RTN","HDISDSR1",41,0)
 F  D  Q:HDIQUIT
"RTN","HDISDSR1",42,0)
 . I $L(HDISTR)<45 S HDIQUIT=1 Q
"RTN","HDISDSR1",43,0)
 . S HDIX=$E(HDISTR,1,45),LT=LT+$L(HDIX)
"RTN","HDISDSR1",44,0)
 . S HDINODE=HDINODE+1,@HDISV@(HDINODE)=$$UUEN(HDIX)
"RTN","HDISDSR1",45,0)
 . S HDISTR=$E(HDISTR,46,HDILEN)
"RTN","HDISDSR1",46,0)
 Q
"RTN","HDISDSR1",47,0)
 ;
"RTN","HDISDSR1",48,0)
UUEN(STR) ; Uuencode string passed in.
"RTN","HDISDSR1",49,0)
 N J,K,LEN,HDII,HDIX,S,TMP,X,Y
"RTN","HDISDSR1",50,0)
 S TMP="",LEN=$L(STR)
"RTN","HDISDSR1",51,0)
 F HDII=1:3:LEN D
"RTN","HDISDSR1",52,0)
 . S HDIX=$E(STR,HDII,HDII+2)
"RTN","HDISDSR1",53,0)
 . I $L(HDIX)<3 S HDIX=HDIX_$E("   ",1,3-$L(HDIX))
"RTN","HDISDSR1",54,0)
 . S S=$A(HDIX,1)*256+$A(HDIX,2)*256+$A(HDIX,3),Y=""
"RTN","HDISDSR1",55,0)
 . F K=0:1:23 S Y=(S\(2**K)#2)_Y
"RTN","HDISDSR1",56,0)
 . F K=1:6:24 D
"RTN","HDISDSR1",57,0)
 . . S J=$$DEC^XLFUTL($E(Y,K,K+5),2)
"RTN","HDISDSR1",58,0)
 . . S TMP=TMP_$C(J+32)
"RTN","HDISDSR1",59,0)
 S TMP=$C(LEN+32)_TMP
"RTN","HDISDSR1",60,0)
 Q TMP
"RTN","HDISDSR1",61,0)
 ;
"RTN","HDISDSR1",62,0)
UUBEGFN(HDFILENM) ; Construct uuencode "begin" coding
"RTN","HDISDSR1",63,0)
 ; Call with HDFILENM = name of uuencoded file attachment
"RTN","HDISDSR1",64,0)
 ; 
"RTN","HDISDSR1",65,0)
 ; Returns HDIX = string with "begin..."_file name
"RTN","HDISDSR1",66,0)
 ;
"RTN","HDISDSR1",67,0)
 N HDIX
"RTN","HDISDSR1",68,0)
 S HDIX="begin 644 "_HDFILENM
"RTN","HDISDSR1",69,0)
 Q HDIX
"RTN","HDISDSR1",70,0)
 ;
"RTN","HDISDSR1",71,0)
 ;
"RTN","HDISDSR1",72,0)
SETDATA ; Set data into report structure
"RTN","HDISDSR1",73,0)
 S HDINODE=$O(^TMP($J,"HDIDATA",""),-1)
"RTN","HDISDSR1",74,0)
 I HDITXT S HDINODE=HDINODE+1,@HDISV@(HDINODE)=HDISTR,HDISTR="" Q
"RTN","HDISDSR1",75,0)
 I 'HDITXT D ENCODE(.HDISTR)
"RTN","HDISDSR1",76,0)
 Q
"RTN","HDISDSR1",77,0)
 ;
"RTN","HDISDSR1",78,0)
CLEAN ; clean up
"RTN","HDISDSR1",79,0)
 D CLEAN^HDISDSR
"RTN","HDISDSR1",80,0)
 D ^%ZISC
"RTN","HDISDSR1",81,0)
 Q
"RTN","HDISDSR1",82,0)
 ;
"RTN","HDISDSR1",83,0)
DISER ; display return error type
"RTN","HDISDSR1",84,0)
 I RERROR=0 Q
"RTN","HDISDSR1",85,0)
 N MSG,A,I,B,J,RR
"RTN","HDISDSR1",86,0)
 ; remove multi's of repeating error #'s
"RTN","HDISDSR1",87,0)
 F I=1:1 S A=$P(RERROR,",",I) Q:A=""  S B(A)=""
"RTN","HDISDSR1",88,0)
 ;
"RTN","HDISDSR1",89,0)
 S J=$O(@HDISV@(""),-1),J=J+1
"RTN","HDISDSR1",90,0)
 S @HDISV@(J)=$$UUBEGFN(HDIFER)
"RTN","HDISDSR1",91,0)
 S HDISTR="ERROR ITEMS FROM HDI SDO LOOKUP"_HDICRLF
"RTN","HDISDSR1",92,0)
 D SETDATA
"RTN","HDISDSR1",93,0)
 S A=0 F  S A=$O(B(A)) Q:'A  S HDISTR=HDISTR_A_") "_$P($T(DISTXT+A),";",3)_HDICRLF D SETDATA
"RTN","HDISDSR1",94,0)
 I $O(RERRARY(0))>0 D  ;<
"RTN","HDISDSR1",95,0)
 . S HDISTR=HDISTR_HDICRLF_"Error Array Display"_HDICRLF D SETDATA
"RTN","HDISDSR1",96,0)
 . S A=0 F  S A=$O(RERRARY(A)) Q:'A  S HDISTR=HDISTR_RERRARY(A)_HDICRLF D SETDATA
"RTN","HDISDSR1",97,0)
 I HDISTR'="" S HDINODE=HDINODE+1,@HDISV@(HDINODE)=$$UUEN(HDISTR)
"RTN","HDISDSR1",98,0)
 S @HDISV@(HDINODE+1)=" "
"RTN","HDISDSR1",99,0)
 S @HDISV@(HDINODE+2)="end"
"RTN","HDISDSR1",100,0)
 Q
"RTN","HDISDSR1",101,0)
 ;
"RTN","HDISDSR1",102,0)
DISTXT ; error text
"RTN","HDISDSR1",103,0)
 ;;Area Not Sent.
"RTN","HDISDSR1",104,0)
 ;;Lookup Value Not Sent.
"RTN","HDISDSR1",105,0)
 ;;Return Value Not Sent.
"RTN","HDISDSR1",106,0)
 ;;Improper Search Area
"RTN","HDISDSR1",107,0)
 ;;Single Item Not Found in ORDERABLE ITEMS File 101.43.
"RTN","HDISDSR1",108,0)
 ;;Single Item Not in Area.
"RTN","HDISDSR1",109,0)
 ;;Partial Lookup Error.
"RTN","HDISDSR1",110,0)
 ;;Orderable Items File Does Not Have Lab Pointer for Item.
"RTN","HDISDSR1",111,0)
 ;;Orderable Item Lab Pointer Not Found in Lab File.
"RTN","HDISDSR1",112,0)
 ;;
"RTN","HDISDSR1",113,0)
 ;;
"RTN","HDISDSR1",114,0)
 ;;Type of Lookup not Sent
"RTN","HDISDSRL")
0^9^B173574871^n/a
"RTN","HDISDSRL",1,0)
HDISDSRL ;BPFO/DTG - HDI MAILMAN SERVER COLLECT ITEMS FOR LABORATORY; Apr 07, 2018@12:42
"RTN","HDISDSRL",2,0)
 ;;1.0;HEALTH DATA & INFORMATICS;**22**;Feb 22, 2005;Build 26
"RTN","HDISDSRL",3,0)
 ;
"RTN","HDISDSRL",4,0)
 ;
"RTN","HDISDSRL",5,0)
 ; ICR's:
"RTN","HDISDSRL",6,0)
 ; 6894 - HDI COLLECT SDOS
"RTN","HDISDSRL",7,0)
 ;
"RTN","HDISDSRL",8,0)
EN ; Display found orderable items for Lab
"RTN","HDISDSRL",9,0)
 ;
"RTN","HDISDSRL",10,0)
 ;
"RTN","HDISDSRL",11,0)
 ;
"RTN","HDISDSRL",12,0)
 ; put XML into tmp file
"RTN","HDISDSRL",13,0)
 ;^TMP("HDISDOLL",$J,"T")= Orderable Item Type (P, L, or R)
"RTN","HDISDSRL",14,0)
 ;^TMP("HDISDOLL",$J,"F",1)=FACILITY NAME-NUMBER^Production Y/N^NET NAME^type of lookup (single, Partial Match, ALL)^Partial Name
"RTN","HDISDSRL",15,0)
 ;^TMP("HDISDOLL",$J,0)= O# of orderable items
"RTN","HDISDSRL",16,0)
 ;^TMP("HDISDOLL",$J,O#,1)=orderable item IEN^orderable item name^mnemonic^status^inactive date
"RTN","HDISDSRL",17,0)
 ;^TMP("HDISDOLL",$J,O#,"S",0)= S# of synonyms
"RTN","HDISDSRL",18,0)
 ;^TMP("HDISDOLL",$J,O#,"S",S#)= synonym
"RTN","HDISDSRL",19,0)
 ;^TMP("HDISDOLL",$J,O#,"LPI",0)= LPI# of primary test items (#60) tests associated to 101.43 item
"RTN","HDISDSRL",20,0)
 ;^TMP("HDISDOLL",$J,O#,"LPI",LPI#,1)=IEN^name^Panel
"RTN","HDISDSRL",21,0)
 ;^TMP("HDISDOLL",$J,O#,"LPI",LPI#,"LTI",0)= LTI# of lab test items (#60)
"RTN","HDISDSRL",22,0)
 ;^TMP("HDISDOLL",$J,O#,"LPI",LPI#,"LTI",LTI,1)=IEN^name^type^data location^data physical location^status^inactive dt
"RTN","HDISDSRL",23,0)
 ;^TMP("HDISDOLL",$J,O#,"LPI",LPI#,"LTI",LTI,"LTS",0)= LTS# of specimens for LTI (60.01)
"RTN","HDISDSRL",24,0)
 ;^TMP("HDISDOLL",$J,O#,"LPI",LPI#,"LTI",LTI,"LTS",LTS,1)=IEN^name^units^inactive dt^status
"RTN","HDISDSRL",25,0)
 ;^TMP("HDISDOLL",$J,O#,"LPI",LPI#,"LTI",LTI,"LTS",LTS,2)=MLTF IEN^mltf name^mltf alt name^mltf inactive dt
"RTN","HDISDSRL",26,0)
 ;^TMP("HDISDOLL",$J,O#,"LPI",LPI#,"LTI",LTI,"LTS",LTS,3)=mltf status^mltf LOINC Code^mltf componet^mltf property
"RTN","HDISDSRL",27,0)
 ;^TMP("HDISDOLL",$J,O#,"LPI",LPI#,"LTI",LTI,"LTS",LTS,4)=mltf time aspect^mltf specimen^mltf scale^mltf method
"RTN","HDISDSRL",28,0)
 ;
"RTN","HDISDSRL",29,0)
 ;
"RTN","HDISDSRL",30,0)
EN1 ;
"RTN","HDISDSRL",31,0)
 N LPI,LPIEN,LPNM,LPO1,LPPN,LTI1,LTIDA,LTIDAP,LTIDT,LTIEN,LTINM,TAB,LTI,LTS,HDIORD
"RTN","HDISDSRL",32,0)
 N LTIST,LTITYP,LTMANM,LTMCOM,LTMDT,LTMIEN,LTMLON,LTMMET,LTMNM,LTMPRO,LTMSCA,LTMSPC
"RTN","HDISDSRL",33,0)
 N LTMST,LTMTIM,LTS1,LTS2,LTS3,LTS4,LTSDT,LTSIEN,LTSNM,LTSST,LTSUN,M,HDIV,HD,HD1,HD2
"RTN","HDISDSRL",34,0)
 N O10143,OIDT,OIEN,OIMEN,OINM,OIST,OISYN,OK,OK1,QUIT,R,D,HDIA,HDIFAC,HDIOI,HDIORD
"RTN","HDISDSRL",35,0)
 N RET1,RERROR,RERRARY
"RTN","HDISDSRL",36,0)
 N HDFILEN1,HDFILENM,HDIFER,HDIFILN,LT,HDISUBJ,RCOUNT
"RTN","HDISDSRL",37,0)
 S HDIV="^TMP(""HDISDOLP"",$J)",RET1="^TMP(""HDISDSRP"",$J)",RCOUNT="",RERROR="",RERRARY="" K @HDIV,@RET1
"RTN","HDISDSRL",38,0)
 S RERROR=$$EN^HDISDOC("L","ALL","ALL",.RET1,"RERRARY","RCOUNT")
"RTN","HDISDSRL",39,0)
 S A=1,TAB=$C(9),QUIT="",LT=0
"RTN","HDISDSRL",40,0)
 ;
"RTN","HDISDSRL",41,0)
L1 S A=$O(@RET1@(A)) I 'A G L1E
"RTN","HDISDSRL",42,0)
 S B=$G(@RET1@(A)) I B["</Laboratory_Orderable_Items>" G L1E
"RTN","HDISDSRL",43,0)
 I A=2&(B["<Laboratory_Orderable_Items") S @HDIV@("T")="LABORATORY" G L1
"RTN","HDISDSRL",44,0)
 I B="<Facility>" S M="" G L1
"RTN","HDISDSRL",45,0)
 I B["<Facility_Name-Number>" S $P(M,U,1)=$$N(B) G L1
"RTN","HDISDSRL",46,0)
 I B["<Facility_Production_Account>" S $P(M,U,2)=$$N(B) G L1
"RTN","HDISDSRL",47,0)
 I B["<Facility_Net_Name>" S $P(M,U,3)=$$N(B) G L1
"RTN","HDISDSRL",48,0)
 I B["<Look_up_Type>" S $P(M,U,4)=$$N(B) G L1
"RTN","HDISDSRL",49,0)
 I B["</Facility>" S @HDIV@("F",1)=M G L1
"RTN","HDISDSRL",50,0)
 I B="<Orderable_Item>" D  G L1
"RTN","HDISDSRL",51,0)
 . S C=$G(@HDIV@(0)),C=C+1,@HDIV@(0)=C,HDIORD=C,HDIOI="",OK=0,OK1=0
"RTN","HDISDSRL",52,0)
 . F  S A=$O(@RET1@(A)),B=$G(@RET1@(A)) Q:B["</Orderable_Item>"  D  ;<
"RTN","HDISDSRL",53,0)
 . . I B["<Orderable_Item_Number>" S $P(HDIOI,U,1)=$$N(B) Q
"RTN","HDISDSRL",54,0)
 . . I B["<Orderable_Item_Name>" S C=$$N(B),$P(HDIOI,U,2)=$$CHAR(C) Q
"RTN","HDISDSRL",55,0)
 . . I B["<Orderable_Item_Mnemonic>" S C=$$N(B),$P(HDIOI,U,3)=$$CHAR(C) Q
"RTN","HDISDSRL",56,0)
 . . I B["<Orderable_Item_Inactive_Date>" S $P(HDIOI,U,4)=$$N(B) Q
"RTN","HDISDSRL",57,0)
 . . I B["<Orderable_Item_Status>" S $P(HDIOI,U,5)=$$N(B),@HDIV@(HDIORD,1)=HDIOI Q
"RTN","HDISDSRL",58,0)
 . . I B["<Orderable_Item_Synonym>" F  S A=$O(@RET1@(A)),B=$G(@RET1@(A)) D  I OK1=1 Q
"RTN","HDISDSRL",59,0)
 . . . I B["<Orderable_Item_Synonym_Name>" D  Q
"RTN","HDISDSRL",60,0)
 . . . . S D=$G(@HDIV@(HDIORD,"S",0)),D=D+1,@HDIV@(HDIORD,"S",0)=D,C=$$N(B),@HDIV@(HDIORD,"S",D)=$$CHAR(C) Q
"RTN","HDISDSRL",61,0)
 . . . I B["</Orderable_Item_Synonym>" Q
"RTN","HDISDSRL",62,0)
 . . . I B["<Lab_Primary_Order_Item>" S A=A-1,OK1=1 Q
"RTN","HDISDSRL",63,0)
 . . I B="<Lab_Primary_Order_Item>" D  Q
"RTN","HDISDSRL",64,0)
 . . . S C=$G(@HDIV@(HDIORD,"LPI",0)),C=C+1,@HDIV@(HDIORD,"LPI",0)=C,LPI=C,(LPO1,OK,OK1)=""
"RTN","HDISDSRL",65,0)
 . . . F  S A=$O(@RET1@(A)),B=$G(@RET1@(A)) Q:B["</Lab_Primary_Order_Item>"  D  ;<
"RTN","HDISDSRL",66,0)
 . . . . I B["<Lab_Primary_Test_IEN>" S LPO1=$$N(B) Q
"RTN","HDISDSRL",67,0)
 . . . . I B["<Lab_Primary_Test_Name>" S R=$$N(B),$P(LPO1,U,2)=$$CHAR(R) Q
"RTN","HDISDSRL",68,0)
 . . . . I B["Lab_Primary_Test_Panel>" S $P(LPO1,U,3)=$$N(B),@HDIV@(HDIORD,"LPI",LPI,1)=LPO1 Q
"RTN","HDISDSRL",69,0)
 . . . . I B="<Laboratory_Test_Item>" S C=$G(@HDIV@(HDIORD,"LPI",LPI,"LTI",0)),C=C+1,@HDIV@(HDIORD,"LPI",LPI,"LTI",0)=C,LTI=C,LTI1="" F  S A=$O(@RET1@(A)),B=$G(@RET1@(A)) Q:B["</Laboratory_Test_Item>"  D  ;<
"RTN","HDISDSRL",70,0)
 . . . . . ;S C=$G(@HDIV@(HDIORD,"LPI",LPI,"LTI",0)),C=C+1,@HDIV@(HDIORD,"LPI",LPI,"LTI",0)=C,LTI=C,LTI1=""
"RTN","HDISDSRL",71,0)
 . . . . . I B["<Lab_Test_IEN>" S LTI1=$$N(B) Q
"RTN","HDISDSRL",72,0)
 . . . . . I B["<Lab_Test_Name>" S C=$$N(B),$P(LTI1,U,2)=$$CHAR(C) Q
"RTN","HDISDSRL",73,0)
 . . . . . I B["<Lab_Test_Type>" S $P(LTI1,U,3)=$$N(B) Q
"RTN","HDISDSRL",74,0)
 . . . . . I B["<Lab_Test_Data_Location>" S $P(LTI1,U,4)=$$N(B) Q
"RTN","HDISDSRL",75,0)
 . . . . . I B["<Lab_Test_Data_Loc_Physical>" S $P(LTI1,U,5)=$$N(B) Q
"RTN","HDISDSRL",76,0)
 . . . . . I B["<Lab_Test_Inactive_Date>" S $P(LTI1,U,6)=$$N(B) Q
"RTN","HDISDSRL",77,0)
 . . . . . I B["<Lab_Test_Status>" S $P(LTI1,U,7)=$$N(B),@HDIV@(HDIORD,"LPI",LPI,"LTI",LTI,1)=LTI1 Q
"RTN","HDISDSRL",78,0)
 . . . . . I B="<Lab_Test_Specimen>" S C=$G(@HDIV@(HDIORD,"LPI",LPI,"LTI",LTI,"LTS",0)),C=C+1,@HDIV@(HDIORD,"LPI",LPI,"LTI",LTI,"LTS",0)=C,LTS=C,(LTS1,LTS2,LTS3,LTS4)="" F  S A=$O(@RET1@(A)),B=$G(@RET1@(A)) Q:B["</Lab_Test_Specimen>"  D  ;<
"RTN","HDISDSRL",79,0)
 . . . . . . I B["<Lab_Test_Specimen_IEN>" S LTS1=$$N(B) Q
"RTN","HDISDSRL",80,0)
 . . . . . . I B["<Lab_Test_Specimen_Name>" S C=$$N(B),$P(LTS1,U,2)=$$CHAR(C) Q
"RTN","HDISDSRL",81,0)
 . . . . . . I B["<Lab_Test_Specimen_Units>" S C=$$N(B),$P(LTS1,U,3)=$$CHAR(C) Q
"RTN","HDISDSRL",82,0)
 . . . . . . I B["<Lab_Test_Specimen_Inactive_Date>" S $P(LTS1,U,4)=$$N(B)
"RTN","HDISDSRL",83,0)
 . . . . . . I B["<Lab_Test_Specimen_Status>" S $P(LTS1,U,5)=$$N(B),@HDIV@(HDIORD,"LPI",LPI,"LTI",LTI,"LTS",LTS,1)=LTS1 Q
"RTN","HDISDSRL",84,0)
 . . . . . . I B="<Master_Lab_Test_Item>" Q
"RTN","HDISDSRL",85,0)
 . . . . . . I B="</Master_Lab_Test_Item>" Q
"RTN","HDISDSRL",86,0)
 . . . . . . I B["<Master_Lab_Test_IEN>" S LTS2=$$N(B) Q
"RTN","HDISDSRL",87,0)
 . . . . . . I B["<Master_Lab_Test_Name>" S C=$$N(B),$P(LTS2,U,2)=$$CHAR(C) Q
"RTN","HDISDSRL",88,0)
 . . . . . . I B["<Master_Lab_Test_Alternate_Name>" S C=$$N(B),$P(LTS2,U,3)=$$CHAR(C) Q
"RTN","HDISDSRL",89,0)
 . . . . . . I B["<Master_Lab_Test_Inactive_Date>" S $P(LTS2,U,4)=$$N(B),@HDIV@(HDIORD,"LPI",LPI,"LTI",LTI,"LTS",LTS,2)=LTS2 Q
"RTN","HDISDSRL",90,0)
 . . . . . . I B["<Master_Lab_Test_Status>" S LTS3=$$N(B) Q
"RTN","HDISDSRL",91,0)
 . . . . . . I B["<Master_Lab_Test_LOINC_Code>" S $P(LTS3,U,2)=$$N(B) Q
"RTN","HDISDSRL",92,0)
 . . . . . . I B["<Master_Lab_Test_Component>" S C=$$N(B),$P(LTS3,U,3)=$$CHAR(C) Q
"RTN","HDISDSRL",93,0)
 . . . . . . I B["<Master_Lab_Test_Property>" S C=$$N(B),$P(LTS3,U,4)=$$CHAR(C),@HDIV@(HDIORD,"LPI",LPI,"LTI",LTI,"LTS",LTS,3)=LTS3 Q
"RTN","HDISDSRL",94,0)
 . . . . . . I B["<Master_Lab_Test_Time_Aspect>" S LTS4=$$N(B) Q
"RTN","HDISDSRL",95,0)
 . . . . . . I B["<Master_Lab_Test_Specimen>" S C=$$N(B),$P(LTS4,U,2)=$$CHAR(C) Q
"RTN","HDISDSRL",96,0)
 . . . . . . I B["<Master_Lab_Test_Scale>" S C=$$N(B),$P(LTS4,U,3)=$$CHAR(C) Q
"RTN","HDISDSRL",97,0)
 . . . . . . I B["<Master_Lab_Test_Method>" S C=$$N(B),$P(LTS4,U,4)=$$CHAR(C),@HDIV@(HDIORD,"LPI",LPI,"LTI",LTI,"LTS",LTS,4)=LTS4 Q
"RTN","HDISDSRL",98,0)
 ;
"RTN","HDISDSRL",99,0)
L1E ; end of flip from XML
"RTN","HDISDSRL",100,0)
 ;
"RTN","HDISDSRL",101,0)
 D INIT^HDISDSR1
"RTN","HDISDSRL",102,0)
 ;HDISV                HPM
"RTN","HDISDSRL",103,0)
 ;^TMP($J,"HDIDATA"),^TMP($J,"LR60")
"RTN","HDISDSRL",104,0)
 S A="Report Generated.......: "_$$FMTE^XLFDT($$NOW^XLFDT)_" at "_HDISTN
"RTN","HDISDSRL",105,0)
 S LT=LT+$L(A),@HDISV@(1)=A
"RTN","HDISDSRL",106,0)
 S A="Report requested.......: "_HDISUB
"RTN","HDISDSRL",107,0)
 S LT=LT+$L(A),@HDISV@(2)=A
"RTN","HDISDSRL",108,0)
 S A="Extract version........: 1.0"
"RTN","HDISDSRL",109,0)
 S LT=LT+$L(A),@HDISV@(3)=A
"RTN","HDISDSRL",110,0)
 S A="Orderable Items File Count: "_$J($P(RCOUNT,U,2),6)
"RTN","HDISDSRL",111,0)
 S LT=LT+$L(A),@HDISV@(4)=A
"RTN","HDISDSRL",112,0)
 S A="Number of Orderable Items File That Are Inactive: "_$J($P(RCOUNT,U,3),6)
"RTN","HDISDSRL",113,0)
 S LT=LT+$L(A),@HDISV@(5)=A
"RTN","HDISDSRL",114,0)
 ;S A="Number of Orderable Items Mnemonics: "_$J($P(RCOUNT,U,4),6)
"RTN","HDISDSRL",115,0)
 ;S LT=LT+$L(A),@HDISV@(6)=A
"RTN","HDISDSRL",116,0)
 S A="Number of Primary Lab Tests Count: "_$J($P(RCOUNT,U,5),6)
"RTN","HDISDSRL",117,0)
 S LT=LT+$L(A),@HDISV@(6)=A
"RTN","HDISDSRL",118,0)
 S A="Number of Primary Tests that are Panels: "_$J($P(RCOUNT,U,6),6)
"RTN","HDISDSRL",119,0)
 S LT=LT+$L(A),@HDISV@(7)=A
"RTN","HDISDSRL",120,0)
 S A="Number of  Laboratory Tests: "_$J($P(RCOUNT,U,7),6)
"RTN","HDISDSRL",121,0)
 S LT=LT+$L(A),@HDISV@(8)=A
"RTN","HDISDSRL",122,0)
 S A="Number of Unique Laboratory Tests: "_$J($P(RCOUNT,U,13),6)
"RTN","HDISDSRL",123,0)
 S LT=LT+$L(A),@HDISV@(9)=A
"RTN","HDISDSRL",124,0)
 S A="Number of Inactive Laboratory Tests: "_$J($P(RCOUNT,U,8),6)
"RTN","HDISDSRL",125,0)
 S LT=LT+$L(A),@HDISV@(10)=A
"RTN","HDISDSRL",126,0)
 S A="Number of Specimens: "_$J($P(RCOUNT,U,9),6)
"RTN","HDISDSRL",127,0)
 S LT=LT+$L(A),@HDISV@(11)=A
"RTN","HDISDSRL",128,0)
 S A="Number of  Inactive Specimens: "_$J($P(RCOUNT,U,10),6)
"RTN","HDISDSRL",129,0)
 S LT=LT+$L(A),@HDISV@(12)=A
"RTN","HDISDSRL",130,0)
 S A="Number of Master Laboratory Tests: "_$J($P(RCOUNT,U,11),6)
"RTN","HDISDSRL",131,0)
 S LT=LT+$L(A),@HDISV@(13)=A
"RTN","HDISDSRL",132,0)
 S A="Number of Unique Master Laboratory Tests: "_$J($P(RCOUNT,U,14),6)
"RTN","HDISDSRL",133,0)
 S LT=LT+$L(A),@HDISV@(14)=A
"RTN","HDISDSRL",134,0)
 S A="Number of  Inactive Master Laboratory Tests: "_$J($P(RCOUNT,U,12),6)
"RTN","HDISDSRL",135,0)
 S LT=LT+$L(A),@HDISV@(15)=A
"RTN","HDISDSRL",136,0)
 S HDFILEN1=$TR(HDISTN," ","_")_"-"_HDISUB_"-"_$P($$FMTHL7^XLFDT($$NOW^XLFDT),"-")
"RTN","HDISDSRL",137,0)
 S HDIFER=$TR(HDISTN," ","_")_"-"_HDISUB_"-ERRORS-"_$P($$FMTHL7^XLFDT($$NOW^XLFDT),"-")_".TXT"
"RTN","HDISDSRL",138,0)
 S HDIFILN=1
"RTN","HDISDSRL",139,0)
 S HDFILENM=HDFILEN1_"_"_HDIFILN_".TXT"
"RTN","HDISDSRL",140,0)
 S A="Attached HDI SDO file.....: "_HDFILENM
"RTN","HDISDSRL",141,0)
 S LT=LT+$L(A)
"RTN","HDISDSRL",142,0)
 S @HDISV@(16)=$$REPEAT^XLFSTR("-",75),LT=LT+75
"RTN","HDISDSRL",143,0)
 S HDINODE=$O(@HDISV@(""),-1),HDINODE=HDINODE+1
"RTN","HDISDSRL",144,0)
 S @HDISV@(HDINODE)=" ",HDINODE=HDINODE+1
"RTN","HDISDSRL",145,0)
 S @HDISV@(HDINODE)=A_$J("       ",6),HDINODE=HDINODE+1
"RTN","HDISDSRL",146,0)
 I RERROR D
"RTN","HDISDSRL",147,0)
 . S @HDISV@(HDINODE)="Attached HDI SDO "_HDISUB_" Errors...: "_HDIFER
"RTN","HDISDSRL",148,0)
 . S HDINODE=HDINODE+1
"RTN","HDISDSRL",149,0)
 S @HDISV@(HDINODE)=" ",HDINODE=HDINODE+1
"RTN","HDISDSRL",150,0)
 I RERROR D DISER^HDISDSR1
"RTN","HDISDSRL",151,0)
 S HDINODE=$O(@HDISV@(""),-1),HDINODE=HDINODE+1
"RTN","HDISDSRL",152,0)
 S @HDISV@(HDINODE)=" ",HDINODE=HDINODE+1
"RTN","HDISDSRL",153,0)
 S @HDISV@(HDINODE)=$$UUBEGFN^HDISDSR1(HDFILENM)
"RTN","HDISDSRL",154,0)
 ;
"RTN","HDISDSRL",155,0)
 D EHEAD
"RTN","HDISDSRL",156,0)
 ;
"RTN","HDISDSRL",157,0)
 G EXPORT
"RTN","HDISDSRL",158,0)
 Q
"RTN","HDISDSRL",159,0)
 ;
"RTN","HDISDSRL",160,0)
DONE ; final quit point
"RTN","HDISDSRL",161,0)
 S HDISUBJ=HDIST_" "_HDISTN_" COMPLETED LAB ORDERABLE ITEMS SDO CODES "_$$HTE^XLFDT($H,"1M")
"RTN","HDISDSRL",162,0)
 D MAILSEND^HDISDSR1(HDISUBJ)
"RTN","HDISDSRL",163,0)
 D CLEAN^HDISDSR1
"RTN","HDISDSRL",164,0)
 K @HDIV,@RET1,RET1
"RTN","HDISDSRL",165,0)
 K LPI,LPIEN,LPNM,LPO1,LPPN,LTI1,LTIDA,LTIDAP,LTIDT,LTIEN,LTINM,TAB,LTI,LTS,HDIORD
"RTN","HDISDSRL",166,0)
 K LTIST,LTITYP,LTMANM,LTMCOM,LTMDT,LTMIEN,LTMLON,LTMMET,LTMNM,LTMPRO,LTMSCA,LTMSPC
"RTN","HDISDSRL",167,0)
 K LTMST,LTMTIM,LTS1,LTS2,LTS3,LTS4,LTSDT,LTSIEN,LTSNM,LTSST,LTSUN,M,HDIV,HD,HD1,HD2
"RTN","HDISDSRL",168,0)
 K O10143,OIDT,OIEN,OIMEN,OINM,OIST,OISYN,OK,OK1,QUIT,R,D,HDIA,HDIFAC,HDIOI,HDIORD
"RTN","HDISDSRL",169,0)
 K HDFILEN1,HDFILENM,HDIFER,HDIFILN,LT,HDISUBJ,RCOUNT
"RTN","HDISDSRL",170,0)
 Q
"RTN","HDISDSRL",171,0)
 ;
"RTN","HDISDSRL",172,0)
EXPORT ; output as export file
"RTN","HDISDSRL",173,0)
 ; basic repeats
"RTN","HDISDSRL",174,0)
 S HDIFAC=$G(@HDIV@("F",1)),HDIA=$G(@HDIV@("T"))
"RTN","HDISDSRL",175,0)
 ; walk collection
"RTN","HDISDSRL",176,0)
 S O10143=0,(OIEN,OINM,OIMEN,OIDT,OIST)=""
"RTN","HDISDSRL",177,0)
E1 D GETORD I 'O10143 G EOUT
"RTN","HDISDSRL",178,0)
 S LPI=0,(LPIEN,LPNM,LPPN)=""
"RTN","HDISDSRL",179,0)
E2 D GETLPI I 'LPI G E1
"RTN","HDISDSRL",180,0)
 S LTI=0,(LTIEN,LTINM,LTITYP,LTIDA,LTIDAP,LTIDT,LTIST)=""
"RTN","HDISDSRL",181,0)
E3 D GETLTI I 'LTI G E2
"RTN","HDISDSRL",182,0)
 S LTS=0,(LTSIEN,LTSNM,LTSUN,LTSDT,LTSST,LTMIEN,LTMNM,LTMANM,LTMST,LTMLON,LTMCOM,LTMPRO,LTMTIM,LTMSPC,LTMSCA,LTMMET)=""
"RTN","HDISDSRL",183,0)
E4 D GETLTS I 'LTS G E3
"RTN","HDISDSRL",184,0)
 ; output data
"RTN","HDISDSRL",185,0)
 S HDISTR=HDISTR_$P(HDIFAC,U,1)_TAB_$P(HDIFAC,U,2)_TAB_$P(HDIFAC,U,3)_TAB_HDIA_TAB_$P(HDIFAC,U,4)_TAB
"RTN","HDISDSRL",186,0)
 D SETDATA
"RTN","HDISDSRL",187,0)
 S HDISTR=HDISTR_OIEN_TAB_OINM_TAB_($S(($E(OIMEN)="Y"):"Yes",1:""))_TAB_OIDT_TAB_($S(OIST=1:"Inactive",1:"Active"))_TAB
"RTN","HDISDSRL",188,0)
 D SETDATA
"RTN","HDISDSRL",189,0)
 ; get synonyms
"RTN","HDISDSRL",190,0)
 S A=0 F I=1:1 S A=$O(OISYN(A)) Q:'A  S B=$G(OISYN(A)) S HDISTR=HDISTR_B S:(A'=OISYN(0)) HDISTR=HDISTR_", " I $L(HDISTR)>100 D SETDATA
"RTN","HDISDSRL",191,0)
 I $L(HDISTR)>55 D SETDATA
"RTN","HDISDSRL",192,0)
 S A="" I LTIEN&(LTINM'="") S A=$S(LTIST=1:"Inactive",1:"Active")
"RTN","HDISDSRL",193,0)
 S HDISTR=HDISTR_TAB_LPIEN_TAB_LPNM_TAB_LPPN_TAB_LTIEN_TAB_LTINM_TAB_LTITYP_TAB_LTIDA_TAB_LTIDAP_TAB_LTIDT_TAB_A_TAB
"RTN","HDISDSRL",194,0)
 D SETDATA
"RTN","HDISDSRL",195,0)
 S A="" I LTSIEN&(LTSNM'="") S A=$S(LTSST=1:"Inactive",1:"Active")
"RTN","HDISDSRL",196,0)
 S HDISTR=HDISTR_LTSIEN_TAB_LTSNM_TAB_LTSUN_TAB_LTSDT_TAB_A_TAB_LTMIEN_TAB_LTMNM_TAB_LTMANM_TAB_LTMDT_TAB
"RTN","HDISDSRL",197,0)
 D SETDATA
"RTN","HDISDSRL",198,0)
 S A="" I LTMIEN&(LTMNM'="") S A=$S(LTMST=1:"Inactive",1:"Active")
"RTN","HDISDSRL",199,0)
 S HDISTR=HDISTR_A_TAB_LTMLON_TAB_LTMCOM_TAB_LTMPRO_TAB_LTMTIM_TAB_LTMSPC_TAB_LTMSCA_TAB_LTMMET
"RTN","HDISDSRL",200,0)
 S HDISTR=HDISTR_HDICRLF
"RTN","HDISDSRL",201,0)
 D SETDATA
"RTN","HDISDSRL",202,0)
 I LT>HDIMAX D PSEND
"RTN","HDISDSRL",203,0)
 G E4
"RTN","HDISDSRL",204,0)
 ;
"RTN","HDISDSRL",205,0)
EOUT ;
"RTN","HDISDSRL",206,0)
 S HDINODE=$O(@HDISV@(""),-1)
"RTN","HDISDSRL",207,0)
 I HDISTR'="" S HDINODE=HDINODE+1,@HDISV@(HDINODE)=$$UUEN^HDISDSR1(HDISTR)
"RTN","HDISDSRL",208,0)
 S @HDISV@(HDINODE+1)=" "
"RTN","HDISDSRL",209,0)
 S @HDISV@(HDINODE+2)="end"
"RTN","HDISDSRL",210,0)
 G DONE
"RTN","HDISDSRL",211,0)
 ;
"RTN","HDISDSRL",212,0)
 ;
"RTN","HDISDSRL",213,0)
EHEAD ; export header
"RTN","HDISDSRL",214,0)
 S HDISTR="Facility_Name-Number"_TAB_"Production_Account"_TAB_"Net_Name"_TAB_"Area"_TAB_"Type_of_Lookup"_TAB_"Orderable_Item_IEN"_TAB
"RTN","HDISDSRL",215,0)
 D SETDATA
"RTN","HDISDSRL",216,0)
 S HDISTR=HDISTR_"Orderable_Item_Name"_TAB_"Orderable_Item_Mnemonic"_TAB_"Orderable_Item_Inactive_Date"_TAB_"Orderable_Item_Status"_TAB
"RTN","HDISDSRL",217,0)
 D SETDATA
"RTN","HDISDSRL",218,0)
 S HDISTR=HDISTR_"Orderable_Item_Synonyms"_TAB_"Lab_Primary_Test_IEN"_TAB_"Lab_Primary_Test_Name"_TAB_"Lab_Primary_Test_Panel"_TAB
"RTN","HDISDSRL",219,0)
 D SETDATA
"RTN","HDISDSRL",220,0)
 S HDISTR=HDISTR_"Lab_Test_IEN"_TAB_"Lab_Test_Name"_TAB_"Lab_Test_Type"_TAB_"Lab_Test_Data_Location"_TAB_"Lab_Test_Data_Loc_Physical"_TAB
"RTN","HDISDSRL",221,0)
 D SETDATA
"RTN","HDISDSRL",222,0)
 S HDISTR=HDISTR_"Lab_Test_Inactive_Date"_TAB_"Lab_Test_Status"_TAB_"Lab_Test_Specimen_IEN"_TAB_"Lab_Test_Specimen_Name"_TAB
"RTN","HDISDSRL",223,0)
 D SETDATA
"RTN","HDISDSRL",224,0)
 S HDISTR=HDISTR_"Lab_Test_Specimen_Units"_TAB_"Lab_Test_Specimen_Inactive_Date"_TAB_"Lab_Test_Specimen_Status"_TAB
"RTN","HDISDSRL",225,0)
 D SETDATA
"RTN","HDISDSRL",226,0)
 S HDISTR=HDISTR_"Master_Lab_Test_IEN"_TAB_"Master_Lab_Test_Name"_TAB_"Master_Lab_Test_Alternate_Name"_TAB_"Master_Lab_Test_Inactive_Date"_TAB
"RTN","HDISDSRL",227,0)
 D SETDATA
"RTN","HDISDSRL",228,0)
 S HDISTR=HDISTR_"Master_Lab_Test_Status"_TAB_"Master_Lab_Test_LOINC_Code"_TAB_"Master_Lab_Test_Component"_TAB
"RTN","HDISDSRL",229,0)
 D SETDATA
"RTN","HDISDSRL",230,0)
 S HDISTR=HDISTR_"Master_Lab_Test_Property"_TAB_"Master_Lab_Test_Time_Aspect"_TAB_"Master_Lab_Test_Specimen"_TAB
"RTN","HDISDSRL",231,0)
 D SETDATA
"RTN","HDISDSRL",232,0)
 S HDISTR=HDISTR_"Master_Lab_Test_Scale"_TAB_"Master_Lab_Test_Method"_HDICRLF
"RTN","HDISDSRL",233,0)
 D SETDATA
"RTN","HDISDSRL",234,0)
 Q
"RTN","HDISDSRL",235,0)
 ;
"RTN","HDISDSRL",236,0)
GETORD S O10143=$O(@HDIV@(O10143)) I 'O10143 Q
"RTN","HDISDSRL",237,0)
 S B=$G(@HDIV@(O10143,1)),OIEN=$P(B,U,1),OINM=$P(B,U,2),OIMEN=$P(B,U,3),OIDT=$P(B,U,4),OIST=$P(B,U,5)
"RTN","HDISDSRL",238,0)
 K OISYN M OISYN=@HDIV@(O10143,"S")
"RTN","HDISDSRL",239,0)
 Q
"RTN","HDISDSRL",240,0)
 ;
"RTN","HDISDSRL",241,0)
GETLPI ; get primary lab item
"RTN","HDISDSRL",242,0)
 S LPI=$O(@HDIV@(O10143,"LPI",LPI)) I 'LPI Q
"RTN","HDISDSRL",243,0)
 S B=$G(@HDIV@(O10143,"LPI",LPI,1)),LPIEN=$P(B,U,1),LPNM=$P(B,U,2),LPPN=$P(B,U,3)
"RTN","HDISDSRL",244,0)
 Q
"RTN","HDISDSRL",245,0)
 ;
"RTN","HDISDSRL",246,0)
GETLTI ; get lab test item
"RTN","HDISDSRL",247,0)
 S LTI=$O(@HDIV@(O10143,"LPI",LPI,"LTI",LTI)) I 'LTI Q
"RTN","HDISDSRL",248,0)
 S B=$G(@HDIV@(O10143,"LPI",LPI,"LTI",LTI,1)),LTIEN=$P(B,U,1),LTINM=$P(B,U,2),LTITYP=$P(B,U,3)
"RTN","HDISDSRL",249,0)
 S LTIDA=$P(B,U,4),LTIDAP=$P(B,U,5),LTIDT=$P(B,U,6),LTIST=$P(B,U,7)
"RTN","HDISDSRL",250,0)
 Q
"RTN","HDISDSRL",251,0)
 ;
"RTN","HDISDSRL",252,0)
GETLTS ; get lab specimen and mltf item
"RTN","HDISDSRL",253,0)
 S LTS=$O(@HDIV@(O10143,"LPI",LPI,"LTI",LTI,"LTS",LTS)) I 'LTS Q
"RTN","HDISDSRL",254,0)
 S B=$G(@HDIV@(O10143,"LPI",LPI,"LTI",LTI,"LTS",LTS,1)),LTSIEN=$P(B,U,1),LTSNM=$P(B,U,2),LTSUN=$P(B,U,3)
"RTN","HDISDSRL",255,0)
 S LTSDT=$P(B,U,4),LTSST=$P(B,U,5)
"RTN","HDISDSRL",256,0)
 S B=$G(@HDIV@(O10143,"LPI",LPI,"LTI",LTI,"LTS",LTS,2)),LTMIEN=$P(B,U,1),LTMNM=$P(B,U,2),LTMANM=$P(B,U,3)
"RTN","HDISDSRL",257,0)
 S LTMDT=$P(B,U,4)
"RTN","HDISDSRL",258,0)
 S B=$G(@HDIV@(O10143,"LPI",LPI,"LTI",LTI,"LTS",LTS,3)),LTMST=$P(B,U,1),LTMLON=$P(B,U,2),LTMCOM=$P(B,U,3),LTMPRO=$P(B,U,4)
"RTN","HDISDSRL",259,0)
 S B=$G(@HDIV@(O10143,"LPI",LPI,"LTI",LTI,"LTS",LTS,4)),LTMTIM=$P(B,U,1),LTMSPC=$P(B,U,2),LTMSCA=$P(B,U,3),LTMMET=$P(B,U,4)
"RTN","HDISDSRL",260,0)
 Q
"RTN","HDISDSRL",261,0)
 ;
"RTN","HDISDSRL",262,0)
CHAR(A) ; check for ctrl chars, <, >, &
"RTN","HDISDSRL",263,0)
 N B,C,D,I,L,M,N
"RTN","HDISDSRL",264,0)
 I A="" Q A
"RTN","HDISDSRL",265,0)
 S D=A
"RTN","HDISDSRL",266,0)
 I A["'AND'" D  ;<
"RTN","HDISDSRL",267,0)
 . S B=$F(A,"'AND'")
"RTN","HDISDSRL",268,0)
 . S A=$E(A,1,(B-6))_"&"_$E(A,B,$L(A))
"RTN","HDISDSRL",269,0)
 I A["'LESS THAN'" D  ;<
"RTN","HDISDSRL",270,0)
 . S B=$F(A,"'LESS THAN'")
"RTN","HDISDSRL",271,0)
 . S A=$E(A,1,(B-12))_"<"_$E(A,B,$L(A))
"RTN","HDISDSRL",272,0)
 I A["'GREATER THAN'" D  ;<
"RTN","HDISDSRL",273,0)
 . S B=$F(A,"'GREATER THAN'")
"RTN","HDISDSRL",274,0)
 . S A=$E(A,1,(B-15))_">"_$E(A,B,$L(A))
"RTN","HDISDSRL",275,0)
 I A["'FORWARD SLASH'" D  ;<
"RTN","HDISDSRL",276,0)
 . S B=$F(A,"'FORWARD SLASH'")
"RTN","HDISDSRL",277,0)
 . S A=$E(A,1,(B-16))_"/"_$E(A,B,$L(A))
"RTN","HDISDSRL",278,0)
 Q A
"RTN","HDISDSRL",279,0)
 ;
"RTN","HDISDSRL",280,0)
N(K) ;get value
"RTN","HDISDSRL",281,0)
 N F
"RTN","HDISDSRL",282,0)
 S F=$P($P(K,"<",2),">",2)
"RTN","HDISDSRL",283,0)
 Q F
"RTN","HDISDSRL",284,0)
 ;
"RTN","HDISDSRL",285,0)
SETDATA ; Set data into report structure
"RTN","HDISDSRL",286,0)
 S HDINODE=$O(@HDISV@(""),-1)
"RTN","HDISDSRL",287,0)
 D ENCODE^HDISDSR1(.HDISTR)
"RTN","HDISDSRL",288,0)
 Q
"RTN","HDISDSRL",289,0)
 ;
"RTN","HDISDSRL",290,0)
PSEND ; SEND IF FILE TO BIG
"RTN","HDISDSRL",291,0)
 S HDINODE=$O(@HDISV@(""),-1)
"RTN","HDISDSRL",292,0)
 I HDISTR'="" S HDINODE=HDINODE+1,@HDISV@(HDINODE)=$$UUEN^HDISDSR1(HDISTR)
"RTN","HDISDSRL",293,0)
 S @HDISV@(HDINODE+1)=" "
"RTN","HDISDSRL",294,0)
 S @HDISV@(HDINODE+2)="end"
"RTN","HDISDSRL",295,0)
 S HDISTR=""
"RTN","HDISDSRL",296,0)
 ;
"RTN","HDISDSRL",297,0)
 S HDISUBJ=HDIST_" "_HDISTN_$S(HDIFILN>1:" CONTINUATION OF",1:"")_" LAB ORDERABLE ITEMS SDO CODES "_$$HTE^XLFDT($H,"1M")
"RTN","HDISDSRL",298,0)
 D MAILSEND^HDISDSR1(HDISUBJ)
"RTN","HDISDSRL",299,0)
 ;
"RTN","HDISDSRL",300,0)
 S HDIFILN=HDIFILN+1,LT=0
"RTN","HDISDSRL",301,0)
 K @HDISV
"RTN","HDISDSRL",302,0)
 S A="This is a continuation of: "_HDFILENM_$J("       ",6),LT=$L(A)
"RTN","HDISDSRL",303,0)
 S @HDISV@(1)=A
"RTN","HDISDSRL",304,0)
 S A=" ",LT=LT+1,@HDISV@(2)=A
"RTN","HDISDSRL",305,0)
 S A=" This file does not contain a header, only data"_$J("       ",6),LT=LT+$L(A)
"RTN","HDISDSRL",306,0)
 S @HDISV@(3)=A
"RTN","HDISDSRL",307,0)
 S A=" This file should be combined with the previous file(s)"_$J("       ",6),LT=LT+$L(A)
"RTN","HDISDSRL",308,0)
 S @HDISV@(4)=A
"RTN","HDISDSRL",309,0)
 S @HDISV@(5)=" "
"RTN","HDISDSRL",310,0)
 S HDFILENM=HDFILEN1_"_"_HDIFILN_".TXT"
"RTN","HDISDSRL",311,0)
 S @HDISV@(6)="Attached HDI SDO file.....: "_HDFILENM
"RTN","HDISDSRL",312,0)
 S @HDISV@(7)=$$REPEAT^XLFSTR("-",75),LT=LT+75
"RTN","HDISDSRL",313,0)
 S HDINODE=$O(@HDISV@(""),-1),HDINODE=HDINODE+1
"RTN","HDISDSRL",314,0)
 S @HDISV@(HDINODE)=" ",HDINODE=HDINODE+1
"RTN","HDISDSRL",315,0)
 S @HDISV@(HDINODE)=$$UUBEGFN^HDISDSR1(HDFILENM)
"RTN","HDISDSRL",316,0)
 Q
"RTN","HDISDSRL",317,0)
 ;
"VER")
8.0^22.2
"BLD",10469,6)
^17
**END**
**END**

