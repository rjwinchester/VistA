Released XU*8*711 SEQ #551
Extracted from mail message
**KIDS**:XU*8.0*711^

**INSTALL NAME**
XU*8.0*711
"BLD",3410,0)
XU*8.0*711^KERNEL^0^3190619^y
"BLD",3410,1,0)
^9.61A^3^3^3190614^^^^
"BLD",3410,1,1,0)
KERNEL VISTA ENHANCEMENTS - PPMS PIE SUPPORT
"BLD",3410,1,2,0)
Refer to patch XU*8.0*711 in the FORUM Patch Module for a complete
"BLD",3410,1,3,0)
description.
"BLD",3410,4,0)
^9.64PA^^
"BLD",3410,6.3)
9
"BLD",3410,"KRN",0)
^9.67PA^1.5^24
"BLD",3410,"KRN",.4,0)
.4
"BLD",3410,"KRN",.401,0)
.401
"BLD",3410,"KRN",.402,0)
.402
"BLD",3410,"KRN",.403,0)
.403
"BLD",3410,"KRN",.5,0)
.5
"BLD",3410,"KRN",.84,0)
.84
"BLD",3410,"KRN",1.5,0)
1.5
"BLD",3410,"KRN",1.6,0)
1.6
"BLD",3410,"KRN",1.61,0)
1.61
"BLD",3410,"KRN",1.62,0)
1.62
"BLD",3410,"KRN",3.6,0)
3.6
"BLD",3410,"KRN",3.8,0)
3.8
"BLD",3410,"KRN",9.2,0)
9.2
"BLD",3410,"KRN",9.8,0)
9.8
"BLD",3410,"KRN",9.8,"NM",0)
^9.68A^4^4
"BLD",3410,"KRN",9.8,"NM",1,0)
XUMVINPU^^0^B124825166
"BLD",3410,"KRN",9.8,"NM",2,0)
XUMVIENU^^0^B277994868
"BLD",3410,"KRN",9.8,"NM",3,0)
XUMVINPA^^0^B8194513
"BLD",3410,"KRN",9.8,"NM",4,0)
XUMVIDTA^^0^B9059477
"BLD",3410,"KRN",9.8,"NM","B","XUMVIDTA",4)
 
"BLD",3410,"KRN",9.8,"NM","B","XUMVIENU",2)
 
"BLD",3410,"KRN",9.8,"NM","B","XUMVINPA",3)
 
"BLD",3410,"KRN",9.8,"NM","B","XUMVINPU",1)
 
"BLD",3410,"KRN",19,0)
19
"BLD",3410,"KRN",19.1,0)
19.1
"BLD",3410,"KRN",101,0)
101
"BLD",3410,"KRN",409.61,0)
409.61
"BLD",3410,"KRN",771,0)
771
"BLD",3410,"KRN",779.2,0)
779.2
"BLD",3410,"KRN",870,0)
870
"BLD",3410,"KRN",8989.51,0)
8989.51
"BLD",3410,"KRN",8989.52,0)
8989.52
"BLD",3410,"KRN",8994,0)
8994
"BLD",3410,"KRN",8994,"NM",0)
^9.68A^3^3
"BLD",3410,"KRN",8994,"NM",1,0)
XUS MVI NEW PERSON GET^^0
"BLD",3410,"KRN",8994,"NM",2,0)
XUS MVI NEW PERSON UPDATE^^0
"BLD",3410,"KRN",8994,"NM",3,0)
XUS MVI ENRICH NEW PERSON^^0
"BLD",3410,"KRN",8994,"NM","B","XUS MVI ENRICH NEW PERSON",3)
 
"BLD",3410,"KRN",8994,"NM","B","XUS MVI NEW PERSON GET",1)
 
"BLD",3410,"KRN",8994,"NM","B","XUS MVI NEW PERSON UPDATE",2)
 
"BLD",3410,"KRN","B",.4,.4)
 
"BLD",3410,"KRN","B",.401,.401)
 
"BLD",3410,"KRN","B",.402,.402)
 
"BLD",3410,"KRN","B",.403,.403)
 
"BLD",3410,"KRN","B",.5,.5)
 
"BLD",3410,"KRN","B",.84,.84)
 
"BLD",3410,"KRN","B",1.5,1.5)
 
"BLD",3410,"KRN","B",1.6,1.6)
 
"BLD",3410,"KRN","B",1.61,1.61)
 
"BLD",3410,"KRN","B",1.62,1.62)
 
"BLD",3410,"KRN","B",3.6,3.6)
 
"BLD",3410,"KRN","B",3.8,3.8)
 
"BLD",3410,"KRN","B",9.2,9.2)
 
"BLD",3410,"KRN","B",9.8,9.8)
 
"BLD",3410,"KRN","B",19,19)
 
"BLD",3410,"KRN","B",19.1,19.1)
 
"BLD",3410,"KRN","B",101,101)
 
"BLD",3410,"KRN","B",409.61,409.61)
 
"BLD",3410,"KRN","B",771,771)
 
"BLD",3410,"KRN","B",779.2,779.2)
 
"BLD",3410,"KRN","B",870,870)
 
"BLD",3410,"KRN","B",8989.51,8989.51)
 
"BLD",3410,"KRN","B",8989.52,8989.52)
 
"BLD",3410,"KRN","B",8994,8994)
 
"BLD",3410,"QDEF")
^^^^NO^^^^NO^^NO
"BLD",3410,"QUES",0)
^9.62^^
"BLD",3410,"REQB",0)
^9.611^2^2
"BLD",3410,"REQB",1,0)
XU*8.0*691^2
"BLD",3410,"REQB",2,0)
XU*8.0*705^2
"BLD",3410,"REQB","B","XU*8.0*691",1)
 
"BLD",3410,"REQB","B","XU*8.0*705",2)
 
"KRN",8994,718,-1)
0^1
"KRN",8994,718,0)
XUS MVI NEW PERSON GET^GET^XUMVINPU^4^A^^^1^1^^0
"KRN",8994,718,1,0)
^8994.01^3^3^3190515^^^^
"KRN",8994,718,1,1,0)
This restricted RPC is used exclusively by the Master Veteran Index (MVI) 
"KRN",8994,718,1,2,0)
to retrieve data (by DUZ, SECID, NPI or SSN) from the VistA NEW PERSON 
"KRN",8994,718,1,3,0)
file (#200).
"KRN",8994,718,2,0)
^8994.02A^4^4
"KRN",8994,718,2,1,0)
DUZ^1^40^0^1
"KRN",8994,718,2,1,1,0)
^8994.021^1^1^3180309^^
"KRN",8994,718,2,1,1,1,0)
File IEN in the NEW PERSON file (#200)
"KRN",8994,718,2,2,0)
SECID^1^40^0^2
"KRN",8994,718,2,2,1,0)
^8994.021^1^1^3180321^^^^
"KRN",8994,718,2,2,1,1,0)
SECID field (#205.1) in the NEW PERSON file (#200)
"KRN",8994,718,2,3,0)
NPI^1^10^0^3
"KRN",8994,718,2,3,1,0)
^^2^2^3190417^
"KRN",8994,718,2,3,1,1,0)
NPI (National Provider Identifier) field (#41.99) in the NEW PERSON file 
"KRN",8994,718,2,3,1,2,0)
(#200).
"KRN",8994,718,2,4,0)
SSN^1^9^0^4
"KRN",8994,718,2,4,1,0)
^8994.021^1^1^3190515^^^^
"KRN",8994,718,2,4,1,1,0)
SSN (Social Security Number) field (#9) in the NEW PERSON file (#200).
"KRN",8994,718,2,"B","DUZ",1)
 
"KRN",8994,718,2,"B","NPI",3)
 
"KRN",8994,718,2,"B","SECID",2)
 
"KRN",8994,718,2,"B","SSN",4)
 
"KRN",8994,718,2,"PARAMSEQ",1,1)
 
"KRN",8994,718,2,"PARAMSEQ",2,2)
 
"KRN",8994,718,2,"PARAMSEQ",3,3)
 
"KRN",8994,718,2,"PARAMSEQ",4,4)
 
"KRN",8994,718,3,0)
^^108^108^3190515^
"KRN",8994,718,3,1,0)
 Success:
"KRN",8994,718,3,2,0)
  XURET = ^TMP("XUMVINPU",$J)
"KRN",8994,718,3,3,0)
   @XURET@(#) = FILE #;FIELD #<;SUBFIELD #><;FILE POINTER>^FIELD 
"KRN",8994,718,3,4,0)
NAME^<COUNTER #>^INTERNAL VALUE^EXTERNAL VALUE
"KRN",8994,718,3,5,0)
     <> Denotes optional values. If Counter populated, denotes multiple 
"KRN",8994,718,3,6,0)
        value <1-n>
"KRN",8994,718,3,7,0)
   
"KRN",8994,718,3,8,0)
   @XURET@(#)="200;IEN^DUZ^^^"
"KRN",8994,718,3,9,0)
   @XURET@(#)="200;.01^NAME^^^"
"KRN",8994,718,3,10,0)
   @XURET@(#)="200;4^SEX^^^"
"KRN",8994,718,3,11,0)
   @XURET@(#)="200;8^TITLE^^^"
"KRN",8994,718,3,12,0)
   @XURET@(#)="200;7^DISUSER^^^"
"KRN",8994,718,3,13,0)
   @XURET@(#)="200;9.2^TERMINATION DATE^^^"
"KRN",8994,718,3,14,0)
   @XURET@(#)="200;9.4^Termination Reason^^^"
"KRN",8994,718,3,15,0)
   @XURET@(#)="200;15^PROHIBITED TIMES FOR SIGN-ON^^^"
"KRN",8994,718,3,16,0)
   @XURET@(#)="200;11.2^DATE VERIFY CODE LAST CHANGED^^^"
"KRN",8994,718,3,17,0)
   @XURET@(#)="200;.111^STREET ADDRESS 1^^^"
"KRN",8994,718,3,18,0)
   @XURET@(#)="200;.112^STREET ADDRESS 2^^^"
"KRN",8994,718,3,19,0)
   @XURET@(#)="200;.113^STREET ADDRESS 3^^^"
"KRN",8994,718,3,20,0)
   @XURET@(#)="200;.114^CITY^^^"
"KRN",8994,718,3,21,0)
   @XURET@(#)="200;.115^STATE^^^"
"KRN",8994,718,3,22,0)
   @XURET@(#)="200;.116^ZIP CODE^^^"
"KRN",8994,718,3,23,0)
   @XURET@(#)="200;.132^OFFICE PHONE^^^"  
"KRN",8994,718,3,24,0)
   @XURET@(#)="200;.136^FAX NUMBER^^^"
"KRN",8994,718,3,25,0)
   @XURET@(#)="200;.151^EMAIL ADDRESS^^^"
"KRN",8994,718,3,26,0)
   @XURET@(#)="200;30^DATE ENTERED^^^"
"KRN",8994,718,3,27,0)
   @XURET@(#)="200;31^CREATOR^^^"
"KRN",8994,718,3,28,0)
   @XURET@(#)="200;41.99^NPI^^^"
"KRN",8994,718,3,29,0)
   @XURET@(#)="200;9^SSN^^^"
"KRN",8994,718,3,30,0)
   @XURET@(#)="200;202^LAST SIGN-ON DATE/TIME^^^"
"KRN",8994,718,3,31,0)
   @XURET@(#)="200;202.02^XUS Logon Attempt Count^^^"
"KRN",8994,718,3,32,0)
   @XURET@(#)="200;202.03^XUS Active User^^^"
"KRN",8994,718,3,33,0)
   @XURET@(#)="200;202.04^Entry Last Edit Date^^^"
"KRN",8994,718,3,34,0)
   @XURET@(#)="200;202.05^LOCKOUT USER UNTIL^^^"
"KRN",8994,718,3,35,0)
   @XURET@(#)="200;16;.01^DIVISION^<1-n>^^"
"KRN",8994,718,3,36,0)
   @XURET@(#)="200;10.1^NAME COMPONENTS^^^"
"KRN",8994,718,3,37,0)
   @XURET@(#)="20;1^FAMILY (LAST) NAME^^^"
"KRN",8994,718,3,38,0)
   @XURET@(#)="20;2^GIVEN (FIRST) NAME^^^"
"KRN",8994,718,3,39,0)
   @XURET@(#)="20;3^MIDDLE NAME^^^"
"KRN",8994,718,3,40,0)
   @XURET@(#)="20;4^PREFIX^^^"
"KRN",8994,718,3,41,0)
   @XURET@(#)="20;5^SUFFIX^^^"
"KRN",8994,718,3,42,0)
   @XURET@(#)="20;6^DEGREE^^^"
"KRN",8994,718,3,43,0)
   @XURET@(#)="200;29^SERVICE/SECTION^^^"
"KRN",8994,718,3,44,0)
   @XURET@(#)="200;201^PRIMARY MENU OPTION^^^"
"KRN",8994,718,3,45,0)
   @XURET@(#)="200;203;.01^SECONDARY MENU OPTIONS^<1-n>^^"
"KRN",8994,718,3,46,0)
   @XURET@(#)="200;51;.01^KEYS^<1-n>^^"
"KRN",8994,718,3,47,0)
   @XURET@(#)="200;205.1^SECID^^^"
"KRN",8994,718,3,48,0)
   @XURET@(#)="200;205.2^SUBJECT ORGANIZATION^^^"
"KRN",8994,718,3,49,0)
   @XURET@(#)="200;205.3^SUBJECT ORGANIZATION ID^^^"
"KRN",8994,718,3,50,0)
   @XURET@(#)="200;205.4^UNIQUE USER ID^^^"
"KRN",8994,718,3,51,0)
   @XURET@(#)="200;205.5^ADUPN^^^"
"KRN",8994,718,3,52,0)
   @XURET@(#)="200;501.1^NETWORK USERNAME^^^"
"KRN",8994,718,3,53,0)
   @XURET@(#)="200;8932.1;.01^PERSON CLASS^<1-n>^^"
"KRN",8994,718,3,54,0)
   @XURET@(#)="200;8932.1;2^EFFECTIVE DATE^<#>^^"
"KRN",8994,718,3,55,0)
   @XURET@(#)="200;8932.1;3^EXPIRATION DATE^<#>^^"
"KRN",8994,718,3,56,0)
   @XURET@(#)="200;53.1^AUTHORIZED TO WRITE MED ORDERS^^^"
"KRN",8994,718,3,57,0)
   @XURET@(#)="200;53.11^DETOX/MAINTENANCE ID NUMBER^^^"
"KRN",8994,718,3,58,0)
   @XURET@(#)="200;53.2^DEA#^^^"
"KRN",8994,718,3,59,0)
   @XURET@(#)="200;747.44^DEA EXPIRATION DATE^^^"
"KRN",8994,718,3,60,0)
   @XURET@(#)="200;53.4^INACTIVE DATE^^^"
"KRN",8994,718,3,61,0)
   @XURET@(#)="200;53.5^PROVIDER CLASS^^^"
"KRN",8994,718,3,62,0)
   @XURET@(#)="200;53.6^PROVIDER TYPE^^^"
"KRN",8994,718,3,63,0)
   @XURET@(#)="200;53.9^REMARKS^^^"
"KRN",8994,718,3,64,0)
   @XURET@(#)="200;53.91^NON-VA PRESCRIBER^^^"
"KRN",8994,718,3,65,0)
   @XURET@(#)="200;53.92^TAX ID^^^"
"KRN",8994,718,3,66,0)
   @XURET@(#)="200;55.1^SCHEDULE II NARCOTIC^^^"
"KRN",8994,718,3,67,0)
   @XURET@(#)="200;55.2^SCHEDULE II NON-NARCOTIC^^^"
"KRN",8994,718,3,68,0)
   @XURET@(#)="200;55.3^SCHEDULE III NARCOTIC^^^"
"KRN",8994,718,3,69,0)
   @XURET@(#)="200;55.4^SCHEDULE III NON-NARCOTIC^^^"
"KRN",8994,718,3,70,0)
   @XURET@(#)="200;55.5^SCHEDULE IV^^^"
"KRN",8994,718,3,71,0)
   @XURET@(#)="200;55.6^SCHEDULE V^^^"
"KRN",8994,718,3,72,0)
 
"KRN",8994,718,3,73,0)
   **The following are ONLY returned if patch
"KRN",8994,718,3,74,0)
   **XU*8.0*688 has been installed.
"KRN",8994,718,3,75,0)
   **Subscript Counter (#) will denote the DEA Data that belongs to the 
"KRN",8994,718,3,76,0)
     DEA NUMBER subscript
"KRN",8994,718,3,77,0)
   ** New DEA Data will always follow the DEA NUMBER entry!
"KRN",8994,718,3,78,0)
   @XURET@(#)="200;9001^DETOX CALCULATED^^^"
"KRN",8994,718,3,79,0)
   @XURET@(#)="200;53.21;.01;8991.9^DEA NUMBER^<1-n>^^"
"KRN",8994,718,3,80,0)
   @XURET@(#)="200;53.21;.02^INDIVIDUAL DEA SUFFIX^<#>^^"
"KRN",8994,718,3,81,0)
   **Only returned if there is a DEA NUMBER (200.5321) value!!**
"KRN",8994,718,3,82,0)
   @XURET@(#)="8991.9;.02^BUSINESS ACTIVITY CODE^<#>^^"
"KRN",8994,718,3,83,0)
   @XURET@(#)="8991.9;.03^DETOX NUMBER^<#>^^"
"KRN",8994,718,3,84,0)
   @XURET@(#)="8991.9;.04^EXPIRATION DATE^<#>^^"
"KRN",8994,718,3,85,0)
   @XURET@(#)="8991.9;.06^USE FOR INPATIENT ORDERS?^<#>^^"
"KRN",8994,718,3,86,0)
   @XURET@(#)="8991.9;.07^TYPE^<#>^^"
"KRN",8994,718,3,87,0)
   @XURET@(#)="8991.9;1.1^NAME (PROVIDER OR INSTITUTION)^<#>^^"
"KRN",8994,718,3,88,0)
   @XURET@(#)="8991.9;1.2^STREET ADDRESS 1^<#>^^"
"KRN",8994,718,3,89,0)
   @XURET@(#)="8991.9;1.3^STREET ADDRESS 2^<#>^^"
"KRN",8994,718,3,90,0)
   @XURET@(#)="8991.9;1.4^STREET ADDRESS 3^<#>^^"
"KRN",8994,718,3,91,0)
   @XURET@(#)="8991.9;1.5^CITY^<#>^^"
"KRN",8994,718,3,92,0)
   @XURET@(#)="8991.9;1.6^STATE^<#>^^"
"KRN",8994,718,3,93,0)
   @XURET@(#)="8991.9;1.7^ZIP CODE^<#>^^"
"KRN",8994,718,3,94,0)
   @XURET@(#)="8991.9;2.1^SCHEDULE II NARCOTIC?^<#>^^"
"KRN",8994,718,3,95,0)
   @XURET@(#)="8991.9;2.2^SCHEDULE II NON-NARCOTIC?^<#>^^"
"KRN",8994,718,3,96,0)
   @XURET@(#)="8991.9;2.3^SCHEDULE III NARCOTIC?^<#>^^"
"KRN",8994,718,3,97,0)
   @XURET@(#)="8991.9;2.4^SCHEDULE III NON-NARCOTIC?^<#>^^"
"KRN",8994,718,3,98,0)
   @XURET@(#)="8991.9;2.5^SCHEDULE IV?^<#>^^"
"KRN",8994,718,3,99,0)
   @XURET@(#)="8991.9;2.6^SCHEDULE V?^<#>^^"
"KRN",8994,718,3,100,0)
   @XURET@(#)="8991.9;10.1^LAST UPDATED BY^<#>^^"
"KRN",8994,718,3,101,0)
   @XURET@(#)="8991.9;10.2^LAST UPDATED DATE/TIME^<#>^^"
"KRN",8994,718,3,102,0)
   @XURET@(#)="8991.9;10.3^LAST DOJ UPDATE DATE/TIME^<#>^^"
"KRN",8994,718,3,103,0)
 
"KRN",8994,718,3,104,0)
 Fail:
"KRN",8994,718,3,105,0)
  XURET = ^TMP("XUMVINPU",$J)
"KRN",8994,718,3,106,0)
  @XURET@(1)="-1^Invalid User"
"KRN",8994,718,3,107,0)
           or
"KRN",8994,718,3,108,0)
  @XURET@(1)="-1^No Data for User: ######"
"KRN",8994,721,-1)
0^2
"KRN",8994,721,0)
XUS MVI NEW PERSON UPDATE^UPDATE^XUMVINPU^1^A^^^^1^^0
"KRN",8994,721,1,0)
^8994.01^2^2^3190417^^^
"KRN",8994,721,1,1,0)
This restricted RPC is used exclusively by the Master Veteran Index (MVI) 
"KRN",8994,721,1,2,0)
to update an entry (by DUZ) in the VistA NEW PERSON file (#200).
"KRN",8994,721,2,0)
^8994.02A^2^1
"KRN",8994,721,2,2,0)
XUARR^2^255^1^1
"KRN",8994,721,2,2,1,0)
^^13^13^3190417^
"KRN",8994,721,2,2,1,1,0)
The IEN (DUZ) for the NEW PERSON (#200) file is required to file the other
"KRN",8994,721,2,2,1,2,0)
fields.
"KRN",8994,721,2,2,1,3,0)
 
"KRN",8994,721,2,2,1,4,0)
  XUARR(#) = FILE #;FIELD #^FIELD NAME^INTERNAL VALUE^EXTERNAL VALUE
"KRN",8994,721,2,2,1,5,0)
  XUARR(0)="200;IEN^DUZ^^"
"KRN",8994,721,2,2,1,6,0)
  XUARR(#)="200;.01^NAME^^"
"KRN",8994,721,2,2,1,7,0)
  XUARR(#)="200;.151^EMAIL ADDRESS^^"
"KRN",8994,721,2,2,1,8,0)
  XUARR(#)="200;205.1^SECID^^"
"KRN",8994,721,2,2,1,9,0)
  XUARR(#)="200;205.2^SUBJECT ORGANIZATION^^"
"KRN",8994,721,2,2,1,10,0)
  XUARR(#)="200;205.3^SUBJECT ORGANIZATION ID^^"
"KRN",8994,721,2,2,1,11,0)
  XUARR(#)="200;205.4^UNIQUE USER ID^^"
"KRN",8994,721,2,2,1,12,0)
  XUARR(#)="200;205.5^ADUPN^^"
"KRN",8994,721,2,2,1,13,0)
  XUARR(#)="200;501.1^NETWORK USERNAME^^"
"KRN",8994,721,2,"B","XUARR",2)
 
"KRN",8994,721,2,"PARAMSEQ",1,2)
 
"KRN",8994,721,3,0)
^8994.03^12^12^3190417^^
"KRN",8994,721,3,1,0)
  Success:
"KRN",8994,721,3,2,0)
   XURET(0) = 1
"KRN",8994,721,3,3,0)
 
"KRN",8994,721,3,4,0)
  Fail:
"KRN",8994,721,3,5,0)
   XURET(0) = "-1^No data passed"
"KRN",8994,721,3,6,0)
   XURET(0) = "-1^Invalid User DUZ (null)"
"KRN",8994,721,3,7,0)
   XURET(0) = "-1^User '"_XUDUZ_"' does not exist"
"KRN",8994,721,3,8,0)
   XURET(0) = "-1^Invalid Name Component IEN"
"KRN",8994,721,3,9,0)
   XURET(0) = "-1^No Data for Name Component IEN: "_NCIEN
"KRN",8994,721,3,10,0)
   XURET(0) = "-1^No data to file for record '"_XUDUZ_"' in file 200 
"KRN",8994,721,3,11,0)
   XURET(0) = "-1^Unable to lock record '"_XUDUZ_"' in file 200" 
"KRN",8994,721,3,12,0)
   XURET(0) = "-1^"_$G(XUERR("DIERR",1,"TEXT",1))
"KRN",8994,1059,-1)
0^3
"KRN",8994,1059,0)
XUS MVI ENRICH NEW PERSON^UPDATE^XUMVIENU^1^A^^^^1^^0
"KRN",8994,1059,1,0)
^8994.01^2^2^3190605^^^^
"KRN",8994,1059,1,1,0)
This restricted RPC is used exclusively by the Master Veteran Index (MVI) 
"KRN",8994,1059,1,2,0)
to update enriched data in the VistA New Person File (#200).
"KRN",8994,1059,2,0)
^8994.02A^2^2
"KRN",8994,1059,2,1,0)
PARAM^2^^1^1
"KRN",8994,1059,2,1,1,0)
^^59^59^3190605^
"KRN",8994,1059,2,1,1,1,0)
Required elements:
"KRN",8994,1059,2,1,1,2,0)
    PARAM("WHO")=Station Number of requesting station
"KRN",8994,1059,2,1,1,3,0)
    PARAM("NPI")=National Provider Identifier
"KRN",8994,1059,2,1,1,4,0)
 
"KRN",8994,1059,2,1,1,5,0)
Required elements only when FLAG is "A"
"KRN",8994,1059,2,1,1,6,0)
    PARAM("NAME")=surname|first name|middle name|suffix|full .01 name
"KRN",8994,1059,2,1,1,7,0)
 
"KRN",8994,1059,2,1,1,8,0)
Optional elements (only pass those elements you want to update)
"KRN",8994,1059,2,1,1,9,0)
    PARAM("ADDRESS DATA")=street address 1|street address 2|
"KRN",8994,1059,2,1,1,10,0)
        street address 3|city|state|zip code|office phone|fax number
"KRN",8994,1059,2,1,1,11,0)
    PARAM("SubjectOrgan")=subject organization
"KRN",8994,1059,2,1,1,12,0)
        Default: "Department Of Veterans Affairs"
"KRN",8994,1059,2,1,1,13,0)
    PARAM("SubjectOrganID")=subject organization id
"KRN",8994,1059,2,1,1,14,0)
        Default: "urn:oid:2.16.840.1.113883.4.349"
"KRN",8994,1059,2,1,1,15,0)
 
"KRN",8994,1059,2,1,1,16,0)
    PARAM("ADUPN")=adupn
"KRN",8994,1059,2,1,1,17,0)
 
"KRN",8994,1059,2,1,1,18,0)
    PARAM("AuthWriteMedOrders")=1 or 0 for YES/NO
"KRN",8994,1059,2,1,1,19,0)
        Default if WHO is 200PIEV and a DEA# is sent: 1 (for YES)
"KRN",8994,1059,2,1,1,20,0)
 
"KRN",8994,1059,2,1,1,21,0)
    PARAM("DEA",<seq#>,"DEA")=Drug Enforcement Agency (DEA) #
"KRN",8994,1059,2,1,1,22,0)
    PARAM("DEA",<seq#>,"Detox")= detox number
"KRN",8994,1059,2,1,1,23,0)
    PARAM("DEA",<seq#>,"DEAExpire")=expiration date (can be future)
"KRN",8994,1059,2,1,1,24,0)
    PARAM("DEA",<seq#>,"SchedIINarc")=1 or 0 for YES/NO
"KRN",8994,1059,2,1,1,25,0)
    PARAM("DEA",<seq#>,"SchedIINonNarc")=1 or 0 for YES/NO
"KRN",8994,1059,2,1,1,26,0)
    PARAM("DEA",<seq#>,"SchedIIINarc")=1 or 0 for YES/NO
"KRN",8994,1059,2,1,1,27,0)
    PARAM("DEA",<seq#>,"SchedIIINonNarc")=1 or 0 for YES/NO
"KRN",8994,1059,2,1,1,28,0)
    PARAM("DEA",<seq#>,"SchedIV")=1 or 0 for YES/NO
"KRN",8994,1059,2,1,1,29,0)
    PARAM("DEA",<seq#>,"SchedV")=1 or 0 for YES/NO
"KRN",8994,1059,2,1,1,30,0)
 
"KRN",8994,1059,2,1,1,31,0)
    PARAM("DEGREE")=degrees (codes delimited by a space)
"KRN",8994,1059,2,1,1,32,0)
    PARAM("EMAIL")=email address
"KRN",8994,1059,2,1,1,33,0)
    PARAM("GENDER")=M or F
"KRN",8994,1059,2,1,1,34,0)
    PARAM("Inactivate")=inactive date (can be future)
"KRN",8994,1059,2,1,1,35,0)
 
"KRN",8994,1059,2,1,1,36,0)
    PARAM("NonVAPrescriber")=1 or 0 for YES/NO
"KRN",8994,1059,2,1,1,37,0)
        Default if WHO is 200PIEV: 1 (for YES)
"KRN",8994,1059,2,1,1,38,0)
 
"KRN",8994,1059,2,1,1,39,0)
    PARAM("NTUSERNAME")=network user name
"KRN",8994,1059,2,1,1,40,0)
 
"KRN",8994,1059,2,1,1,41,0)
    PARAM("PersonClass",<seq#>,"PersonClass")=X12 code value
"KRN",8994,1059,2,1,1,42,0)
    PARAM("PersonClass",<seq#>,"PersonClassActive")=date
"KRN",8994,1059,2,1,1,43,0)
        Default if not currently active: TODAY
"KRN",8994,1059,2,1,1,44,0)
    PARAM("PersonClass",<seq#>,"PersonClassExpire")=date
"KRN",8994,1059,2,1,1,45,0)
 
"KRN",8994,1059,2,1,1,46,0)
    PARAM("ProviderClass")=a value from the PROVIDER CLASS file (#7)
"KRN",8994,1059,2,1,1,47,0)
    PARAM("ProviderType")=provider type code|provider type value
"KRN",8994,1059,2,1,1,48,0)
 
"KRN",8994,1059,2,1,1,49,0)
    PARAM("Remarks")=remarks
"KRN",8994,1059,2,1,1,50,0)
        Default if WHO is 200PIEV: "NON-VA PROVIDER"
"KRN",8994,1059,2,1,1,51,0)
 
"KRN",8994,1059,2,1,1,52,0)
    PARAM("SECID")=secid
"KRN",8994,1059,2,1,1,53,0)
    PARAM("TaxID")=tax id
"KRN",8994,1059,2,1,1,54,0)
    PARAM("Termination")=termination date (cannot be future)
"KRN",8994,1059,2,1,1,55,0)
 
"KRN",8994,1059,2,1,1,56,0)
    PARAM("Title")=value from TITLE file (#3.1)
"KRN",8994,1059,2,1,1,57,0)
        Default if WHO is 200PIEV: "NON-VA PROVIDER"
"KRN",8994,1059,2,1,1,58,0)
 
"KRN",8994,1059,2,1,1,59,0)
    PARAM("UniqueUserID")=unique user id
"KRN",8994,1059,2,2,0)
FLAG^1^^1^2
"KRN",8994,1059,2,2,1,0)
^8994.021^5^5^3190605^^^^
"KRN",8994,1059,2,2,1,1,0)
This flag controls whether the RPC is adding an NEW PERSON file entry or 
"KRN",8994,1059,2,2,1,2,0)
updating an existing one.
"KRN",8994,1059,2,2,1,3,0)
 
"KRN",8994,1059,2,2,1,4,0)
  "U" : Update an existing entry
"KRN",8994,1059,2,2,1,5,0)
  "A" : Add a new entry
"KRN",8994,1059,2,"B","FLAG",2)
 
"KRN",8994,1059,2,"B","PARAM",1)
 
"KRN",8994,1059,2,"PARAMSEQ",1,1)
 
"KRN",8994,1059,2,"PARAMSEQ",2,2)
 
"KRN",8994,1059,3,0)
^8994.03^13^13^3190605^^^^
"KRN",8994,1059,3,1,0)
On success:
"KRN",8994,1059,3,2,0)
   DUZ of New Person File entry edited or added
"KRN",8994,1059,3,3,0)
       Returned if there were no issues adding or editing the entry.
"KRN",8994,1059,3,4,0)
   
"KRN",8994,1059,3,5,0)
   DUZ^-1^ErrorMessage
"KRN",8994,1059,3,6,0)
       Returned if entry was edited, but some data was not valid and could
"KRN",8994,1059,3,7,0)
       not be filed.
"KRN",8994,1059,3,8,0)
 
"KRN",8994,1059,3,9,0)
On failure:
"KRN",8994,1059,3,10,0)
   -1^ErrorMessage
"KRN",8994,1059,3,11,0)
       Returned for example if required data was not passed, entry could 
"KRN",8994,1059,3,12,0)
       not be added when FLAG="A", or entry could not be found based on
"KRN",8994,1059,3,13,0)
       the NPI when FLAG="U".
"MBREQ")
0
"ORD",16,8994)
8994;16;1;;;;RPCE1^XPDIA1;;;RPCDEL^XPDIA1
"ORD",16,8994,0)
REMOTE PROCEDURE
"PKG",138,-1)
1^1
"PKG",138,0)
KERNEL^XU^SIGN-ON, SECURITY, MENU DRIVER, DEVICES, TASKMAN^
"PKG",138,22,0)
^9.49I^1^1
"PKG",138,22,1,0)
8.0^2950703^2951127^12541
"PKG",138,22,1,"PAH",1,0)
711^3190619
"PKG",138,22,1,"PAH",1,1,0)
^^3^3^3190619
"PKG",138,22,1,"PAH",1,1,1,0)
KERNEL VISTA ENHANCEMENTS - PPMS PIE SUPPORT
"PKG",138,22,1,"PAH",1,1,2,0)
Refer to patch XU*8.0*711 in the FORUM Patch Module for a complete
"PKG",138,22,1,"PAH",1,1,3,0)
description.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")
 
"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
4
"RTN","XUMVIDTA")
0^4^B9059477^B8690518
"RTN","XUMVIDTA",1,0)
XUMVIDTA ;MVI/CKN - MVI New Person Data Analysis ; 6/18/19 2:52pm
"RTN","XUMVIDTA",2,0)
 ;;8.0;KERNEL;**705,711**;Jul 10, 1995;Build 9
"RTN","XUMVIDTA",3,0)
 Q
"RTN","XUMVIDTA",4,0)
EP(RETURN,SEL,ACTSEL) ;
"RTN","XUMVIDTA",5,0)
 ;RPC - XUS MVI NEW PERSON DATA
"RTN","XUMVIDTA",6,0)
 ;This RPC is called by MPI to get data analysis report from
"RTN","XUMVIDTA",7,0)
 ;NEW PERSON file (#200) for active VistA sites
"RTN","XUMVIDTA",8,0)
 ;Input:
"RTN","XUMVIDTA",9,0)
 ;    SEL (Required) - 1 : All - Active New Person and  Non Active New Person
"RTN","XUMVIDTA",10,0)
 ;                     2 : Active New Person
"RTN","XUMVIDTA",11,0)
 ;                     3 : Non Active New Person
"RTN","XUMVIDTA",12,0)
 ; ACTSEL (Optional for Non Active) - 1 : All
"RTN","XUMVIDTA",13,0)
 ;                     1 : All
"RTN","XUMVIDTA",14,0)
 ;                     2 : Active records having a SecID value
"RTN","XUMVIDTA",15,0)
 ;                     3 : Active records having an Email value
"RTN","XUMVIDTA",16,0)
 ;                     4 : Active records having a NT USERNAME value
"RTN","XUMVIDTA",17,0)
 ;Output:
"RTN","XUMVIDTA",18,0)
 ; RETURN - Total Count^Total Non Active^Total Active^Total SECID^Total Email
"RTN","XUMVIDTA",19,0)
 ;          ^Total NT User^Total Visitors
"RTN","XUMVIDTA",20,0)
 ;
"RTN","XUMVIDTA",21,0)
 N XUDUZ,U,TOTVIS,TOTCNT,NONACT,ACT,TOTNACT,TOTACT,TOTSECID,TOTEMAIL,TOTNTUSR,ARR
"RTN","XUMVIDTA",22,0)
 S (TOTCNT,TOTNACT,TOTACT,TOTSECID,TOTEMAIL,TOTNTUSR,TOTVIS)=0
"RTN","XUMVIDTA",23,0)
 S U="^"
"RTN","XUMVIDTA",24,0)
 S XUDUZ=.9 F  S XUDUZ=$O(^VA(200,XUDUZ)) Q:+XUDUZ=0  D
"RTN","XUMVIDTA",25,0)
 .K ARR
"RTN","XUMVIDTA",26,0)
 .S TOTCNT=TOTCNT+1
"RTN","XUMVIDTA",27,0)
 .D GET(XUDUZ,.ARR)
"RTN","XUMVIDTA",28,0)
 .I $G(ARR("VISITOR"))=1 S TOTVIS=TOTVIS+1 Q  ;Filter Visitor records
"RTN","XUMVIDTA",29,0)
 .;Inactive New Person
"RTN","XUMVIDTA",30,0)
 .I SEL=3 D  Q
"RTN","XUMVIDTA",31,0)
 ..S NONACT=$$NONACT(.ARR)
"RTN","XUMVIDTA",32,0)
 ..I NONACT S TOTNACT=TOTNACT+1
"RTN","XUMVIDTA",33,0)
 .;Active New Person
"RTN","XUMVIDTA",34,0)
 .I SEL=2 D  Q
"RTN","XUMVIDTA",35,0)
 ..S ACT=$$ACT(.ARR) I 'ACT Q
"RTN","XUMVIDTA",36,0)
 ..S TOTACT=TOTACT+1
"RTN","XUMVIDTA",37,0)
 ..D GETACT(ACTSEL,.ARR)
"RTN","XUMVIDTA",38,0)
 .;All Active and Inactive New Person
"RTN","XUMVIDTA",39,0)
 .I SEL=1 D
"RTN","XUMVIDTA",40,0)
 ..S NONACT=$$NONACT(.ARR) I NONACT S TOTNACT=TOTNACT+1 Q
"RTN","XUMVIDTA",41,0)
 ..I '$$ACT(.ARR) Q
"RTN","XUMVIDTA",42,0)
 ..S TOTACT=TOTACT+1
"RTN","XUMVIDTA",43,0)
 ..D GETACT(ACTSEL,.ARR)
"RTN","XUMVIDTA",44,0)
 ;
"RTN","XUMVIDTA",45,0)
 ;RETURN - Total Count^Total Non Active^Total Active^Total SECID^Total Email
"RTN","XUMVIDTA",46,0)
 ;         ^Total NT User^Total Visitors
"RTN","XUMVIDTA",47,0)
 S RETURN=TOTCNT_U_TOTNACT_U_TOTACT_U_TOTSECID_U_TOTEMAIL_U_TOTNTUSR_U_TOTVIS
"RTN","XUMVIDTA",48,0)
 Q
"RTN","XUMVIDTA",49,0)
GET(XUDUZ,ARR) ;
"RTN","XUMVIDTA",50,0)
 ;Get all necessary fields from New Person file (#200)
"RTN","XUMVIDTA",51,0)
 N NPDATA
"RTN","XUMVIDTA",52,0)
 S DR="201;205.1;205.5;501.1;7;9.2",DIC=200,DA=XUDUZ,DIQ="NPDATA",DIQ(0)="I" D EN^DIQ1
"RTN","XUMVIDTA",53,0)
 S ARR("PRIMOPT")=$G(NPDATA(200,XUDUZ,201,"I"))
"RTN","XUMVIDTA",54,0)
 S ARR("SECID")=$G(NPDATA(200,XUDUZ,205.1,"I"))
"RTN","XUMVIDTA",55,0)
 S ARR("EMAIL")=$G(NPDATA(200,XUDUZ,205.5,"I"))
"RTN","XUMVIDTA",56,0)
 S ARR("NTUSR")=$G(NPDATA(200,XUDUZ,501.1,"I"))
"RTN","XUMVIDTA",57,0)
 S ARR("DISUSR")=$G(NPDATA(200,XUDUZ,7,"I"))
"RTN","XUMVIDTA",58,0)
 S ARR("TERMDT")=$G(NPDATA(200,XUDUZ,9.2,"I"))
"RTN","XUMVIDTA",59,0)
 I $O(^VA(200,XUDUZ,8910,0)) S ARR("VSTDATA")=1
"RTN","XUMVIDTA",60,0)
 I $G(ARR("VSTDATA")),$G(ARR("PRIMOPT"))'="" S ARR("VISITOR")=1
"RTN","XUMVIDTA",61,0)
 K DIC,DA,DR,DIQ
"RTN","XUMVIDTA",62,0)
 Q
"RTN","XUMVIDTA",63,0)
NONACT(ARR) ;
"RTN","XUMVIDTA",64,0)
 ;Inactive Person - Disuser=Y and/or Termination date is not a future date
"RTN","XUMVIDTA",65,0)
 I $G(ARR("DISUSR"))=1!(($G(ARR("TERMDT"))'="")&($G(ARR("TERMDT"))'>DT)) Q 1
"RTN","XUMVIDTA",66,0)
 Q 0
"RTN","XUMVIDTA",67,0)
ACT(ARR) ;
"RTN","XUMVIDTA",68,0)
 ;Active Person - not Disuser=Y and/or no Termination date.
"RTN","XUMVIDTA",69,0)
 ;**711 Story 977780 (ckn) - Add check for primary option assigned.
"RTN","XUMVIDTA",70,0)
 I $G(ARR("DISUSR"))'=1,($G(ARR("TERMDT"))=""!($G(ARR("TERMDT"))>DT)),($G(ARR("PRIMOPT"))'="") Q 1
"RTN","XUMVIDTA",71,0)
 Q 0
"RTN","XUMVIDTA",72,0)
GETACT(ACTSEL,ARR) ;
"RTN","XUMVIDTA",73,0)
 ;Aggregate total Active records has a SECID value
"RTN","XUMVIDTA",74,0)
 I ACTSEL=2,$G(ARR("SECID"))'="" S TOTSECID=TOTSECID+1 Q
"RTN","XUMVIDTA",75,0)
 ;Agreegate total Active records has an Email value
"RTN","XUMVIDTA",76,0)
 I ACTSEL=3,$G(ARR("EMAIL"))'="" S TOTEMAIL=TOTEMAIL+1 Q
"RTN","XUMVIDTA",77,0)
 ;Aggregate total Active records has a NT UserName value
"RTN","XUMVIDTA",78,0)
 I ACTSEL=4,$G(ARR("NTUSR"))'="" S TOTNTUSR=TOTNTUSR+1 Q
"RTN","XUMVIDTA",79,0)
 ;Aggregate all - SECID, AUPDN and NT UserName
"RTN","XUMVIDTA",80,0)
 I ACTSEL=1 D
"RTN","XUMVIDTA",81,0)
 .I $G(ARR("SECID"))'="" S TOTSECID=TOTSECID+1
"RTN","XUMVIDTA",82,0)
 .I $G(ARR("EMAIL"))'="" S TOTEMAIL=TOTEMAIL+1
"RTN","XUMVIDTA",83,0)
 .I $G(ARR("NTUSR"))'="" S TOTNTUSR=TOTNTUSR+1
"RTN","XUMVIDTA",84,0)
 Q
"RTN","XUMVIENU")
0^2^B277994868^n/a
"RTN","XUMVIENU",1,0)
XUMVIENU ;MVI/CKN,MKO - Master Veteran Index Enrich New Person ;5 Jun 2019  8:06 PM
"RTN","XUMVIENU",2,0)
 ;;8.0;KERNEL;**711**;Jul 10, 1995;Build 9
"RTN","XUMVIENU",3,0)
 ;Per VA Directive 6402, this routine should not be modified.
"RTN","XUMVIENU",4,0)
 ;**711,Story 977838 (mko/ckn): New routine
"RTN","XUMVIENU",5,0)
 ;Entry point: UPDATE^XUMVIENU(XURET,.XUARR,XUFLAG)
"RTN","XUMVIENU",6,0)
 ; called from rpc: XUS MVI ENRICH NEW PERSON
"RTN","XUMVIENU",7,0)
 ;
"RTN","XUMVIENU",8,0)
 ; Input:
"RTN","XUMVIENU",9,0)
 ;   XUARR(subscript)=value to update
"RTN","XUMVIENU",10,0)
 ;   XUFLAG = "A" : if RPC is being called to add a record to the New Person file
"RTN","XUMVIENU",11,0)
 ;            "U" : if RPC is being called to edit an existing New Person file record.
"RTN","XUMVIENU",12,0)
 ;
"RTN","XUMVIENU",13,0)
 ; Return Parameter:
"RTN","XUMVIENU",14,0)
 ;   On success:
"RTN","XUMVIENU",15,0)
 ;     DUZ of New Person File entry edited or added
"RTN","XUMVIENU",16,0)
 ;       Returned if there were no issues adding or editing the entry.
"RTN","XUMVIENU",17,0)
 ;
"RTN","XUMVIENU",18,0)
 ;     DUZ^-1^errorMessage
"RTN","XUMVIENU",19,0)
 ;       Returned if entry was edited, but some data was not valid and could
"RTN","XUMVIENU",20,0)
 ;       not be filed.
"RTN","XUMVIENU",21,0)
 ;
"RTN","XUMVIENU",22,0)
 ;   On failure:
"RTN","XUMVIENU",23,0)
 ;     -1^errorMessage
"RTN","XUMVIENU",24,0)
 ;       Returned for example if required data was not passed, entry could
"RTN","XUMVIENU",25,0)
 ;       not be added when FLAG="A", or entry could not be found based on
"RTN","XUMVIENU",26,0)
 ;       the NPI when FLAG="U".
"RTN","XUMVIENU",27,0)
 ;
"RTN","XUMVIENU",28,0)
UPDATE(XURET,XUARR,XUFLAG) ;RPC to enrich New Pperson file entry
"RTN","XUMVIENU",29,0)
 N XUDBSEQ
"RTN","XUMVIENU",30,0)
 S XUDBSEQ=$$RECORD(.XUARR,$G(XUFLAG))
"RTN","XUMVIENU",31,0)
 D PROC(.XURET,.XUARR,.XUFLAG)
"RTN","XUMVIENU",32,0)
 D RETURN(XUDBSEQ,XURET)
"RTN","XUMVIENU",33,0)
 Q
"RTN","XUMVIENU",34,0)
 ;
"RTN","XUMVIENU",35,0)
PROC(XURET,XUARR,XUFLAG) ;Main code for RPC
"RTN","XUMVIENU",36,0)
 N FDA,OLDTDATE,XUDUZ
"RTN","XUMVIENU",37,0)
 K XURET
"RTN","XUMVIENU",38,0)
 ;
"RTN","XUMVIENU",39,0)
 ;Check inputs
"RTN","XUMVIENU",40,0)
 S XURET=$$CHKINPUT(.XUARR,.XUFLAG)
"RTN","XUMVIENU",41,0)
 Q:XURET<0
"RTN","XUMVIENU",42,0)
 ;
"RTN","XUMVIENU",43,0)
 ;Add or get New Person IEN in XUDUZ
"RTN","XUMVIENU",44,0)
 S XURET=""
"RTN","XUMVIENU",45,0)
 I $G(XUFLAG)="A" D
"RTN","XUMVIENU",46,0)
 . ;Call entry point to add the record
"RTN","XUMVIENU",47,0)
 . D:$G(XUARR("SubjectOrgan"))=""!($G(XUARR("SubjectOrganID"))="") SUBJDEF(.XUARR)
"RTN","XUMVIENU",48,0)
 . S XUDUZ=$$ADDUSER^XUMVINPA(.XUARR)
"RTN","XUMVIENU",49,0)
 . I XUDUZ<0 S XURET=XUDUZ ;If error, we'll return -1^errorMessage
"RTN","XUMVIENU",50,0)
 . E  I $P(XUDUZ,U,3)=1 S XUDUZ=+XUDUZ ;If record was added, set XUDUZ to new IEN
"RTN","XUMVIENU",51,0)
 . E  S XURET=+XUDUZ ;If record was found, not added, we'll just return DUZ -- no edit will take place
"RTN","XUMVIENU",52,0)
 E  D
"RTN","XUMVIENU",53,0)
 . ;Lookup user based on NPI
"RTN","XUMVIENU",54,0)
 . ;S XATTRIB(8)=XUARR("NPI") ; NPI
"RTN","XUMVIENU",55,0)
 . ;S XUDUZ=$$FINDUSER^XUESSO2(.XATTRIB) ; find user based on NPI ; returns -1^Not authorized if DUZ("LOA")<2
"RTN","XUMVIENU",56,0)
 . S XUDUZ=$O(^VA(200,"ANPI",XUARR("NPI"),0))
"RTN","XUMVIENU",57,0)
 . S:XUDUZ'>0 XURET="-1^User with NPI "_XUARR("NPI")_" not found."
"RTN","XUMVIENU",58,0)
 ;
"RTN","XUMVIENU",59,0)
 ;If add or lookup above set XURET, we're done
"RTN","XUMVIENU",60,0)
 Q:XURET]""
"RTN","XUMVIENU",61,0)
 ;
"RTN","XUMVIENU",62,0)
 ;Update the NAME first. (Within a FILE^DIE call, triggers on the .01 that in turn call FILE^DIE
"RTN","XUMVIENU",63,0)
 ;may cause the Filer flag to change from "E", to "".)
"RTN","XUMVIENU",64,0)
 I $G(XUFLAG)'="A",$D(XUARR("NAME"))#2 D
"RTN","XUMVIENU",65,0)
 . N NAME
"RTN","XUMVIENU",66,0)
 . S NAME=$P($G(XUARR("NAME")),"|",5)
"RTN","XUMVIENU",67,0)
 . S:NAME="" NAME=$$FMNAME^HLFNC($G(XUARR("NAME")),"|")
"RTN","XUMVIENU",68,0)
 . I NAME]"" S FDA(200,+XUDUZ_",",.01)=NAME D FILER(.FDA,"E",.XURET)
"RTN","XUMVIENU",69,0)
 ;
"RTN","XUMVIENU",70,0)
 ;Set up FDA
"RTN","XUMVIENU",71,0)
 D SETFDA(XUDUZ,.XUARR,.FDA)
"RTN","XUMVIENU",72,0)
 ;
"RTN","XUMVIENU",73,0)
 ;Remove Termination Date from FDA if it's in the future
"RTN","XUMVIENU",74,0)
 D TERMDATE(.FDA,.XURES)
"RTN","XUMVIENU",75,0)
 ;
"RTN","XUMVIENU",76,0)
 ;Save the original Termination Date
"RTN","XUMVIENU",77,0)
 S OLDTDATE=$P($G(^VA(200,XUDUZ,0)),U,11)
"RTN","XUMVIENU",78,0)
 ;
"RTN","XUMVIENU",79,0)
 ;Call the Filer
"RTN","XUMVIENU",80,0)
 D FILER(.FDA,"E",.XURET)
"RTN","XUMVIENU",81,0)
 ;
"RTN","XUMVIENU",82,0)
 ;If Termination Date was added or deleted, remove or add Security keys PROVIDER and XUORES
"RTN","XUMVIENU",83,0)
 D SECKEYS(XUDUZ,OLDTDATE,.XURET)
"RTN","XUMVIENU",84,0)
 ;
"RTN","XUMVIENU",85,0)
 ;File the Person Class data
"RTN","XUMVIENU",86,0)
 D PERSCLAS(XUDUZ,.XUARR,.XURET)
"RTN","XUMVIENU",87,0)
 ;
"RTN","XUMVIENU",88,0)
 ;File the DEA data
"RTN","XUMVIENU",89,0)
 I $$PATCH^XPDUTL("XU*8.0*688"),$$VFIELD^DILFD(200,53.21),$$VFILE^DILFD(8991.9) D
"RTN","XUMVIENU",90,0)
 . ;File NEW DEA #'S in multiple and add/edit entries in File #8991.9
"RTN","XUMVIENU",91,0)
 . D NEWDEA(XUDUZ,.XUARR,.XURET)
"RTN","XUMVIENU",92,0)
 . ;File first NEW DEA data into single-valued fields of NP file
"RTN","XUMVIENU",93,0)
 . D NPDEA(XUDUZ,.XUARR,.XURET)
"RTN","XUMVIENU",94,0)
 E  D
"RTN","XUMVIENU",95,0)
 . ;File first valid DEA # into file (NEW DEA#'s multiple doesn't exist)
"RTN","XUMVIENU",96,0)
 . D FIRSTDEA(XUDUZ,.XUARR,.XURET)
"RTN","XUMVIENU",97,0)
 ;
"RTN","XUMVIENU",98,0)
 ;Return DUZ in first piece. If errors, also return -1^errMsg in 2nd and 3rd pieces.
"RTN","XUMVIENU",99,0)
 S XURET=XUDUZ_$S(XURET<0:U_XURET,1:"")
"RTN","XUMVIENU",100,0)
 Q
"RTN","XUMVIENU",101,0)
 ;
"RTN","XUMVIENU",102,0)
CHKINPUT(XUARR,XUFLAG) ;Check inputs
"RTN","XUMVIENU",103,0)
 ;Returns: "-1^errorMsg" if problem; otherwise return 0
"RTN","XUMVIENU",104,0)
 Q:'$D(XUARR) "-1^No data passed"
"RTN","XUMVIENU",105,0)
 Q:$G(XUARR("NPI"))="" "-1^Missing NPI"
"RTN","XUMVIENU",106,0)
 Q:'$$CHKDGT^XUSNPI($G(XUARR("NPI"))) "-1^NPI is not valid"
"RTN","XUMVIENU",107,0)
 Q:$G(XUARR("WHO"))="" "-1^Missing requesting Station number"
"RTN","XUMVIENU",108,0)
 ;
"RTN","XUMVIENU",109,0)
 S:$G(XUFLAG)="" XUFLAG="U"
"RTN","XUMVIENU",110,0)
 Q:"^A^U^"'[(U_$G(XUFLAG)_U) "-1^Invalid flag "_XUFLAG_" was passed."
"RTN","XUMVIENU",111,0)
 Q 0
"RTN","XUMVIENU",112,0)
 ;
"RTN","XUMVIENU",113,0)
SETFDA(IEN,XUARR,FDA) ;Set FDA from XUARR for filing into File #200
"RTN","XUMVIENU",114,0)
 N IENS,WHO
"RTN","XUMVIENU",115,0)
 S WHO=$G(XUARR("WHO"))
"RTN","XUMVIENU",116,0)
 S IENS=+IEN_","
"RTN","XUMVIENU",117,0)
 ;
"RTN","XUMVIENU",118,0)
 ;DEGREE
"RTN","XUMVIENU",119,0)
 S:$D(XUARR("DEGREE"))#2 FDA(200,IENS,10.6)=$$TRIM^XLFSTR(XUARR("DEGREE"))
"RTN","XUMVIENU",120,0)
 ;
"RTN","XUMVIENU",121,0)
 ;Subject Organization and ID
"RTN","XUMVIENU",122,0)
 D:$G(XUARR("SubjectOrgan"),"<undef>")=""!($G(XUARR("SubjectOrganID"),"<undef>")="") SUBJDEF(.XUARR)
"RTN","XUMVIENU",123,0)
 S:$D(XUARR("SubjectOrgan"))#2 FDA(200,IENS,205.2)=XUARR("SubjectOrgan")
"RTN","XUMVIENU",124,0)
 S:$D(XUARR("SubjectOrganID"))#2 FDA(200,IENS,205.3)=XUARR("SubjectOrganID")
"RTN","XUMVIENU",125,0)
 ;
"RTN","XUMVIENU",126,0)
 ;GENDER
"RTN","XUMVIENU",127,0)
 S:$D(XUARR("GENDER"))#2 FDA(200,IENS,4)=XUARR("GENDER")
"RTN","XUMVIENU",128,0)
 ;
"RTN","XUMVIENU",129,0)
 ;ADDRESS DATA
"RTN","XUMVIENU",130,0)
 D:$D(XUARR("ADDRESS DATA"))#2
"RTN","XUMVIENU",131,0)
 . N ADDR,STR1,STR2,STR3,CITY,STATE,ZIP,OPHN,FAX
"RTN","XUMVIENU",132,0)
 . S ADDR=XUARR("ADDRESS DATA")
"RTN","XUMVIENU",133,0)
 . S STR1=$P(ADDR,"|"),STR2=$P(ADDR,"|",2),STR3=$P(ADDR,"|",3)
"RTN","XUMVIENU",134,0)
 . S CITY=$P(ADDR,"|",4),STATE=$P(ADDR,"|",5),ZIP=$P(ADDR,"|",6)
"RTN","XUMVIENU",135,0)
 . S OPHN=$P(ADDR,"|",7),FAX=$P(ADDR,"|",8)
"RTN","XUMVIENU",136,0)
 . I $L(ZIP)=9,ZIP'["-" S ZIP=$E(ZIP,1,5)_"-"_$E(ZIP,6,9)
"RTN","XUMVIENU",137,0)
 . S FDA(200,IENS,.111)=$E(STR1,1,$$MAXLEN(200,.111))
"RTN","XUMVIENU",138,0)
 . S FDA(200,IENS,.112)=$E(STR2,1,$$MAXLEN(200,.112))
"RTN","XUMVIENU",139,0)
 . S FDA(200,IENS,.113)=$E(STR3,1,$$MAXLEN(200,.113))
"RTN","XUMVIENU",140,0)
 . S FDA(200,IENS,.114)=$E(CITY,1,$$MAXLEN(200,.114))
"RTN","XUMVIENU",141,0)
 . S FDA(200,IENS,.115)=$$STATEIEN(STATE)
"RTN","XUMVIENU",142,0)
 . S FDA(200,IENS,.116)=ZIP
"RTN","XUMVIENU",143,0)
 . S FDA(200,IENS,.132)=OPHN
"RTN","XUMVIENU",144,0)
 . S FDA(200,IENS,.136)=FAX
"RTN","XUMVIENU",145,0)
 ;
"RTN","XUMVIENU",146,0)
 ;Tax ID
"RTN","XUMVIENU",147,0)
 S:$D(XUARR("TaxID"))#2 FDA(200,IENS,53.92)=XUARR("TaxID")
"RTN","XUMVIENU",148,0)
 ;
"RTN","XUMVIENU",149,0)
 ;Termination
"RTN","XUMVIENU",150,0)
 S:$D(XUARR("Termination"))#2 FDA(200,IENS,9.2)=XUARR("Termination")
"RTN","XUMVIENU",151,0)
 ;Inactivate
"RTN","XUMVIENU",152,0)
 S:$D(XUARR("Inactivate"))#2 FDA(200,IENS,53.4)=XUARR("Inactivate")
"RTN","XUMVIENU",153,0)
 ;
"RTN","XUMVIENU",154,0)
 ;Remarks
"RTN","XUMVIENU",155,0)
 I $G(XUARR("Remarks"))="",WHO="200PIEV",$P($G(^VA(200,+IEN,"PS")),U,9)="" S XUARR("Remarks")="NON-VA PROVIDER"
"RTN","XUMVIENU",156,0)
 S:$D(XUARR("Remarks"))#2 FDA(200,IENS,53.9)=$E(XUARR("Remarks"),1,$$MAXLEN(200,53.9))
"RTN","XUMVIENU",157,0)
 ;
"RTN","XUMVIENU",158,0)
 ;Title
"RTN","XUMVIENU",159,0)
 I $G(XUARR("Title"))="",WHO="200PIEV",$P($G(^VA(200,+IEN,0)),U,9)="" S XUARR("Title")="NON-VA PROVIDER"
"RTN","XUMVIENU",160,0)
 D:$D(XUARR("Title"))#2
"RTN","XUMVIENU",161,0)
 . ;Add Title to TITLE file (#3.1) if not already there
"RTN","XUMVIENU",162,0)
 . N DIERR,DIHELP,DIMSG,XUMSG
"RTN","XUMVIENU",163,0)
 . S XUARR("Title")=$E($$UP^XLFSTR(XUARR("Title")),1,$$MAXLEN(200,8))
"RTN","XUMVIENU",164,0)
 . D:$$FIND1^DIC(3.1,"","X",XUARR("Title"),"","","XUMSG")'>0
"RTN","XUMVIENU",165,0)
 .. N TITLEFDA
"RTN","XUMVIENU",166,0)
 .. S TITLEFDA(3.1,"+1,",.01)=XUARR("Title")
"RTN","XUMVIENU",167,0)
 .. D UPDATER(.TITLEFDA,"E",.XURET)
"RTN","XUMVIENU",168,0)
 . S FDA(200,IENS,8)=XUARR("Title")
"RTN","XUMVIENU",169,0)
 ;
"RTN","XUMVIENU",170,0)
 ;Authorized to Write Med Orders
"RTN","XUMVIENU",171,0)
 D:$D(XUARR("AuthWriteMedOrders"))#2
"RTN","XUMVIENU",172,0)
 . S VAL=$$UP^XLFSTR(XUARR("AuthWriteMedOrders")) S:VAL=0!(VAL="N")!(VAL="NO") VAL=""
"RTN","XUMVIENU",173,0)
 . S FDA(200,IENS,53.1)=VAL
"RTN","XUMVIENU",174,0)
 ;
"RTN","XUMVIENU",175,0)
 ;Provider Class
"RTN","XUMVIENU",176,0)
 S:$D(XUARR("ProviderClass"))#2 FDA(200,IENS,53.5)=XUARR("ProviderClass")
"RTN","XUMVIENU",177,0)
 ;
"RTN","XUMVIENU",178,0)
 ;Non VA Prescriber
"RTN","XUMVIENU",179,0)
 I WHO="200PIEV",$G(XUARR("NonVAPrescriber"))="" S FDA(200,IENS,53.91)=1
"RTN","XUMVIENU",180,0)
 E  S:$D(XUARR("NonVAPrescriber"))#2 FDA(200,IENS,53.91)=XUARR("NonVAPrescriber")
"RTN","XUMVIENU",181,0)
 ;
"RTN","XUMVIENU",182,0)
 ;Provider Type
"RTN","XUMVIENU",183,0)
 D:$D(XUARR("ProviderType"))#2
"RTN","XUMVIENU",184,0)
 . N PROVTYPE
"RTN","XUMVIENU",185,0)
 . S PROVTYPE=$P(XUARR("ProviderType"),"|")
"RTN","XUMVIENU",186,0)
 . S:PROVTYPE="" PROVTYPE=$P(XUARR("ProviderType"),"|",2)
"RTN","XUMVIENU",187,0)
 . S FDA(200,IENS,53.6)=PROVTYPE
"RTN","XUMVIENU",188,0)
 ;
"RTN","XUMVIENU",189,0)
 ;SECID
"RTN","XUMVIENU",190,0)
 S:$D(XUARR("SECID"))#2 FDA(200,IENS,205.1)=XUARR("SECID")
"RTN","XUMVIENU",191,0)
 ;Unique User ID
"RTN","XUMVIENU",192,0)
 S:$D(XUARR("UniqueUserID"))#2 FDA(200,IENS,205.4)=XUARR("UniqueUserID")
"RTN","XUMVIENU",193,0)
 ;ADUPN (Email)
"RTN","XUMVIENU",194,0)
 S:$D(XUARR("ADUPN"))#2 FDA(200,IENS,205.5)=XUARR("ADUPN")
"RTN","XUMVIENU",195,0)
 ;EMAIL ADDRESS
"RTN","XUMVIENU",196,0)
 S:$D(XUARR("EMAIL"))#2 FDA(200,IENS,.151)=XUARR("EMAIL")
"RTN","XUMVIENU",197,0)
 ;Network Username
"RTN","XUMVIENU",198,0)
 S:$D(XUARR("NTUSERNAME"))#2 FDA(200,IENS,501.1)=XUARR("NTUSERNAME")
"RTN","XUMVIENU",199,0)
 Q
"RTN","XUMVIENU",200,0)
 ;
"RTN","XUMVIENU",201,0)
SUBJDEF(XUARR) ;Set default Subject Organization and ID
"RTN","XUMVIENU",202,0)
 S XUARR("SubjectOrgan")="Department Of Veterans Affairs"
"RTN","XUMVIENU",203,0)
 S XUARR("SubjectOrganID")="urn:oid:2.16.840.1.113883.4.349"
"RTN","XUMVIENU",204,0)
 Q
"RTN","XUMVIENU",205,0)
 ;
"RTN","XUMVIENU",206,0)
TERMDATE(FDA,XURES) ;Remove Termination Date from FDA if it's in the future,
"RTN","XUMVIENU",207,0)
 ;or if Termination Date is passed but user has a Primary Menu, and return an error message
"RTN","XUMVIENU",208,0)
 N IENS,TDATE
"RTN","XUMVIENU",209,0)
 S IENS=$O(FDA(200,"")) Q:IENS=""
"RTN","XUMVIENU",210,0)
 Q:"@"[$G(FDA(200,IENS,9.2))
"RTN","XUMVIENU",211,0)
 ;
"RTN","XUMVIENU",212,0)
 ;Get internal form
"RTN","XUMVIENU",213,0)
 S TDATE=$$GETINT(200,9.2,FDA(200,IENS,9.2)) Q:TDATE=U
"RTN","XUMVIENU",214,0)
 ;
"RTN","XUMVIENU",215,0)
 I $P($G(^VA(200,+IENS,201)),U)]"" D  Q
"RTN","XUMVIENU",216,0)
 . D ADDERR(.XURET,"User has a PRIMARY MENU and cannot be terminated.")
"RTN","XUMVIENU",217,0)
 . K FDA(200,IENS,9.2)
"RTN","XUMVIENU",218,0)
 ;
"RTN","XUMVIENU",219,0)
 ;Remove from FDA if it's a future date, and add an error message
"RTN","XUMVIENU",220,0)
 D:TDATE>DT
"RTN","XUMVIENU",221,0)
 . D ADDERR(.XURET,"TERMINATION DATE '"_FDA(200,IENS,9.2)_"' is in the future.")
"RTN","XUMVIENU",222,0)
 . K FDA(200,IENS,9.2)
"RTN","XUMVIENU",223,0)
 Q
"RTN","XUMVIENU",224,0)
 ;
"RTN","XUMVIENU",225,0)
SECKEYS(XUDUZ,OLDTDATE,XURET) ;Add or remove Security Keys PROVIDER and XUORES
"RTN","XUMVIENU",226,0)
 ;based on whether Termination Date is deleted or created
"RTN","XUMVIENU",227,0)
 N KEY,KEYIEN,NEWTDATE
"RTN","XUMVIENU",228,0)
 S XUDUZ=+$G(XUDUZ),OLDTDATE=$G(OLDTDATE)
"RTN","XUMVIENU",229,0)
 S NEWTDATE=$P($G(^VA(200,XUDUZ,0)),U,11)
"RTN","XUMVIENU",230,0)
 Q:$G(OLDTDATE)=NEWTDATE
"RTN","XUMVIENU",231,0)
 ;
"RTN","XUMVIENU",232,0)
 F KEY="PROVIDER","XUORES" D
"RTN","XUMVIENU",233,0)
 . S KEYIEN=$O(^DIC(19.1,"B",KEY,0)) Q:KEYIEN'>0
"RTN","XUMVIENU",234,0)
 . I OLDTDATE="",NEWTDATE]"" D
"RTN","XUMVIENU",235,0)
 .. ;Delete the key
"RTN","XUMVIENU",236,0)
 .. N DA,DIK
"RTN","XUMVIENU",237,0)
 .. S DA=$O(^VA(200,XUDUZ,51,"B",KEYIEN,0)) Q:DA'>0
"RTN","XUMVIENU",238,0)
 .. S DA(1)=XUDUZ,DIK="^VA(200,"_XUDUZ_",51,"
"RTN","XUMVIENU",239,0)
 .. D ^DIK
"RTN","XUMVIENU",240,0)
 . E  I OLDTDATE]"",NEWTDATE="" D
"RTN","XUMVIENU",241,0)
 .. ;Add the key
"RTN","XUMVIENU",242,0)
 .. N IENS,FDA
"RTN","XUMVIENU",243,0)
 .. Q:$D(^VA(200,XUDUZ,51,"B",KEYIEN,0))
"RTN","XUMVIENU",244,0)
 .. S IENS="+1,"_XUDUZ_","
"RTN","XUMVIENU",245,0)
 .. S FDA(200.051,IENS,.01)=KEYIEN ;key
"RTN","XUMVIENU",246,0)
 .. S FDA(200.051,IENS,1)=$G(DUZ) ;given by
"RTN","XUMVIENU",247,0)
 .. S FDA(200.051,IENS,2)=DT ;date given
"RTN","XUMVIENU",248,0)
 .. D UPDATER(.FDA,"",.XURET)
"RTN","XUMVIENU",249,0)
 Q
"RTN","XUMVIENU",250,0)
 ;
"RTN","XUMVIENU",251,0)
PERSCLAS(XUDUZ,XUARR,XURET) ;Update PERSON CLASS multiple
"RTN","XUMVIENU",252,0)
 N CNT,CURVAL,D0,FDA,IEN,IENS,NEWVAL,PCIEN,VACODE,X12CODE
"RTN","XUMVIENU",253,0)
 S CNT=0 F  S CNT=$O(XUARR("PersonClass",CNT)) Q:'CNT  D
"RTN","XUMVIENU",254,0)
 . S X12CODE=$G(XUARR("PersonClass",CNT,"PersonClass")) Q:X12CODE=""
"RTN","XUMVIENU",255,0)
 . ;
"RTN","XUMVIENU",256,0)
 . ;Lookup the Person Class entry in the multiple
"RTN","XUMVIENU",257,0)
 . S PCIEN=0
"RTN","XUMVIENU",258,0)
 . S VACODE=$S(X12CODE="207LP3000X":"V110403",X12CODE="2084B0040X":"V182914",X12CODE="390200000X":"V115500",1:"") I VACODE'="" S PCIEN=$O(^USC(8932.1,"F",VACODE,0)) ;to resolve duplicate x12 codes
"RTN","XUMVIENU",259,0)
 . I 'PCIEN S PCIEN=$O(^USC(8932.1,"G",X12CODE,0))
"RTN","XUMVIENU",260,0)
 . S IEN=$O(^VA(200,+XUDUZ,"USC1","B",+PCIEN,0))
"RTN","XUMVIENU",261,0)
 . ;
"RTN","XUMVIENU",262,0)
 . ;If not found, add it
"RTN","XUMVIENU",263,0)
 . I IEN'>0 D  Q:IEN'>0
"RTN","XUMVIENU",264,0)
 .. S FDA(200.05,"+1,"_+XUDUZ_",",.01)=PCIEN ;now passing internal value of X12CODE
"RTN","XUMVIENU",265,0)
 .. S IEN=$$UPDATER(.FDA,"",.XURET)
"RTN","XUMVIENU",266,0)
 . ;
"RTN","XUMVIENU",267,0)
 . ;Update the other values in the Person Class multiple
"RTN","XUMVIENU",268,0)
 . S IENS=+IEN_","_+XUDUZ_","
"RTN","XUMVIENU",269,0)
 . S CURVAL=$P($G(^VA(200,+XUDUZ,"USC1",+IEN,0)),U,2)
"RTN","XUMVIENU",270,0)
 . S NEWVAL=$G(XUARR("PersonClass",CNT,"PersonClassActive"))
"RTN","XUMVIENU",271,0)
 . I NEWVAL="",'$$ISPCACTV(XUDUZ,IEN) S FDA(200.05,IENS,2)="TODAY",FDA(200.05,IENS,3)="@"
"RTN","XUMVIENU",272,0)
 . E  I NEWVAL]"" S FDA(200.05,IENS,2)=NEWVAL
"RTN","XUMVIENU",273,0)
 . S:$D(XUARR("PersonClass",CNT,"PersonClassExpire"))#2 FDA(200.05,IENS,3)=XUARR("PersonClass",CNT,"PersonClassExpire")
"RTN","XUMVIENU",274,0)
 . S D0=+XUDUZ ;Needed by input transform of Effective Date (200.05,2)
"RTN","XUMVIENU",275,0)
 . D FILER(.FDA,"E",.XURET)
"RTN","XUMVIENU",276,0)
 Q
"RTN","XUMVIENU",277,0)
 ;
"RTN","XUMVIENU",278,0)
ISPCACTV(XUDUZ,SUBIEN) ;Is the Person Class active?
"RTN","XUMVIENU",279,0)
 N EFFDT,EXPDT,ND
"RTN","XUMVIENU",280,0)
 S ND=$G(^VA(200,+$G(XUDUZ),"USC1",+$G(SUBIEN),0)) Q:ND="" 0
"RTN","XUMVIENU",281,0)
 S EFFDT=$P(ND,U,2),EXPDT=$P(ND,U,3)
"RTN","XUMVIENU",282,0)
 I EFFDT,DT'<EFFDT,DT'>EXPDT Q 1
"RTN","XUMVIENU",283,0)
 Q 0
"RTN","XUMVIENU",284,0)
 ;
"RTN","XUMVIENU",285,0)
NEWDEA(XUDUZ,XUARR,XURET) ;Update DEA NUMBERS File #8991.9
"RTN","XUMVIENU",286,0)
 ;and the NEW PERSON File NEW DEA #'s multiple
"RTN","XUMVIENU",287,0)
 N CNT,DEA,DIERR,DIHELP,DIMSG,FDA,IEN,IENS,NDEAIEN,XUERR
"RTN","XUMVIENU",288,0)
 N STR1,STR2,STR3,CITY,STATE,ZIP
"RTN","XUMVIENU",289,0)
 ;
"RTN","XUMVIENU",290,0)
 ;Get address parts
"RTN","XUMVIENU",291,0)
 D:$D(XUARR("ADDRESS DATA"))#2
"RTN","XUMVIENU",292,0)
 . S ADDR=XUARR("ADDRESS DATA")
"RTN","XUMVIENU",293,0)
 . S STR1=$E($P(ADDR,"|"),1,$$MAXLEN(8991.9,1.2))
"RTN","XUMVIENU",294,0)
 . S STR2=$E($P(ADDR,"|",2),1,$$MAXLEN(8991.9,1.3))
"RTN","XUMVIENU",295,0)
 . S STR3=$E($P(ADDR,"|",3),1,$$MAXLEN(8991.9,1.4))
"RTN","XUMVIENU",296,0)
 . S CITY=$E($P(ADDR,"|",4),1,$$MAXLEN(8991.9,1.5))
"RTN","XUMVIENU",297,0)
 . S STATE=$P(ADDR,"|",5)
"RTN","XUMVIENU",298,0)
 . S ZIP=$TR($P(ADDR,"|",6),"-")
"RTN","XUMVIENU",299,0)
 ;
"RTN","XUMVIENU",300,0)
 S CNT=0 F  S CNT=$O(XUARR("DEA",CNT)) Q:'CNT  D
"RTN","XUMVIENU",301,0)
 . S DEA=$G(XUARR("DEA",CNT,"DEA"))
"RTN","XUMVIENU",302,0)
 . Q:DEA=""
"RTN","XUMVIENU",303,0)
 . ;
"RTN","XUMVIENU",304,0)
 . ;Lookup or add a record to File #8991.9 with the passed DEA #
"RTN","XUMVIENU",305,0)
 . S NDEAIEN=$O(^XTV(8991.9,"B",DEA,0))
"RTN","XUMVIENU",306,0)
 . I NDEAIEN'>0 D  Q:NDEAIEN'>0
"RTN","XUMVIENU",307,0)
 .. K FDA
"RTN","XUMVIENU",308,0)
 .. S IENS="+1,"
"RTN","XUMVIENU",309,0)
 .. S FDA(8991.9,IENS,.01)=DEA
"RTN","XUMVIENU",310,0)
 .. S FDA(8991.9,IENS,10.2)="NOW"
"RTN","XUMVIENU",311,0)
 .. S NDEAIEN=$$UPDATER(.FDA,"E",.XURET)
"RTN","XUMVIENU",312,0)
 . ;
"RTN","XUMVIENU",313,0)
 . ;Update Expiration Date, Address, and Schedule fields for this File #8991.9 entry
"RTN","XUMVIENU",314,0)
 . K FDA
"RTN","XUMVIENU",315,0)
 . S IENS=NDEAIEN_","
"RTN","XUMVIENU",316,0)
 . D:$D(XUARR("ADDRESS DATA"))#2
"RTN","XUMVIENU",317,0)
 .. S FDA(8991.9,IENS,1.2)=STR1
"RTN","XUMVIENU",318,0)
 .. S FDA(8991.9,IENS,1.3)=STR2
"RTN","XUMVIENU",319,0)
 .. S FDA(8991.9,IENS,1.4)=STR3
"RTN","XUMVIENU",320,0)
 .. S FDA(8991.9,IENS,1.5)=CITY
"RTN","XUMVIENU",321,0)
 .. S FDA(8991.9,IENS,1.6)=$$STATEIEN(STATE)
"RTN","XUMVIENU",322,0)
 .. S FDA(8991.9,IENS,1.7)=ZIP
"RTN","XUMVIENU",323,0)
 . S:$D(XUARR("DEA",CNT,"Detox"))#2 FDA(8991.9,IENS,.03)=XUARR("DEA",CNT,"Detox")
"RTN","XUMVIENU",324,0)
 . S:$D(XUARR("DEA",CNT,"DEAExpire"))#2 FDA(8991.9,IENS,.04)=XUARR("DEA",CNT,"DEAExpire")
"RTN","XUMVIENU",325,0)
 . S:$D(XUARR("DEA",CNT,"SchedIINarc"))#2 FDA(8991.9,IENS,2.1)=XUARR("DEA",CNT,"SchedIINarc")
"RTN","XUMVIENU",326,0)
 . S:$D(XUARR("DEA",CNT,"SchedIINonNarc"))#2 FDA(8991.9,IENS,2.2)=XUARR("DEA",CNT,"SchedIINonNarc")
"RTN","XUMVIENU",327,0)
 . S:$D(XUARR("DEA",CNT,"SchedIIINarc"))#2 FDA(8991.9,IENS,2.3)=XUARR("DEA",CNT,"SchedIIINarc")
"RTN","XUMVIENU",328,0)
 . S:$D(XUARR("DEA",CNT,"SchedIIINonNarc"))#2 FDA(8991.9,IENS,2.4)=XUARR("DEA",CNT,"SchedIIINonNarc")
"RTN","XUMVIENU",329,0)
 . S:$D(XUARR("DEA",CNT,"SchedIV"))#2 FDA(8991.9,IENS,2.5)=XUARR("DEA",CNT,"SchedIV")
"RTN","XUMVIENU",330,0)
 . S:$D(XUARR("DEA",CNT,"SchedV"))#2 FDA(8991.9,IENS,2.6)=XUARR("DEA",CNT,"SchedV")
"RTN","XUMVIENU",331,0)
 . S:$D(FDA) FDA(8991.9,IENS,10.1)=$S($G(DUZ):"`"_DUZ,1:""),FDA(8991.9,IENS,10.2)="NOW"
"RTN","XUMVIENU",332,0)
 . D FILER(.FDA,"E",.XURET)
"RTN","XUMVIENU",333,0)
 . ;
"RTN","XUMVIENU",334,0)
 . ;Lookup or add corresponding entry in New Person NEW DEA #'S multiple
"RTN","XUMVIENU",335,0)
 . S IEN=$O(^VA(200,+XUDUZ,"PS4","B",DEA,0))
"RTN","XUMVIENU",336,0)
 . I IEN'>0 D  Q:IEN'>0
"RTN","XUMVIENU",337,0)
 .. K FDA
"RTN","XUMVIENU",338,0)
 .. S FDA(200.5321,"+1,"_+XUDUZ_",",.01)=DEA
"RTN","XUMVIENU",339,0)
 .. S IEN=$$UPDATER(.FDA,"E",.XURET)
"RTN","XUMVIENU",340,0)
 . ;
"RTN","XUMVIENU",341,0)
 . ;Update the DEA POINTER value in the NEW DEA #'s multiple
"RTN","XUMVIENU",342,0)
 . K FDA
"RTN","XUMVIENU",343,0)
 . S FDA(200.5321,+IEN_","_+XUDUZ_",",.03)=NDEAIEN
"RTN","XUMVIENU",344,0)
 . D FILER(.FDA,"",.XURET)
"RTN","XUMVIENU",345,0)
 Q
"RTN","XUMVIENU",346,0)
 ;
"RTN","XUMVIENU",347,0)
NPDEA(XUDUZ,XUARR,XURET) ;Set the single-valued fields in the New Person file for
"RTN","XUMVIENU",348,0)
 ; DEA#, Detox #, DEA Expiration Date, and the Schedule fields from the first entry in
"RTN","XUMVIENU",349,0)
 ; the NEW DEA#'s multiple; Also default Auth to Write Med Orders to 1 if not already set,
"RTN","XUMVIENU",350,0)
 ; WHO is 200PIEV, and there's a DEA#
"RTN","XUMVIENU",351,0)
 N DEAIEN,FDA,IENS,ND0,ND2,NDEAIEN
"RTN","XUMVIENU",352,0)
 S DEAIEN=$O(^VA(200,XUDUZ,"PS4",0)) Q:'DEAIEN
"RTN","XUMVIENU",353,0)
 S NDEAIEN=$P(^VA(200,XUDUZ,"PS4",DEAIEN,0),U,3) Q:NDEAIEN'>0
"RTN","XUMVIENU",354,0)
 ;
"RTN","XUMVIENU",355,0)
 ;Set up FDA with data from DEA NUMBERS entry
"RTN","XUMVIENU",356,0)
 S IENS=+XUDUZ_","
"RTN","XUMVIENU",357,0)
 S ND0=$G(^XTV(8991.9,+NDEAIEN,0)),ND2=$G(^(2)) Q:$P(ND0,U)=""
"RTN","XUMVIENU",358,0)
 S FDA(200,IENS,53.2)=$P(ND0,U) ;DEA#
"RTN","XUMVIENU",359,0)
 S FDA(200,IENS,53.11)=$P(ND0,U,3)  ;DETOX NUMBER
"RTN","XUMVIENU",360,0)
 S FDA(200,IENS,747.44)=$P(ND0,U,4) ;DEA EXPIRATION DATE
"RTN","XUMVIENU",361,0)
 S FDA(200,IENS,55.1)=$P(ND2,U) ;SCHEDULE II NARCOTIC
"RTN","XUMVIENU",362,0)
 S FDA(200,IENS,55.2)=$P(ND2,U,2) ;SCHEDULE II NON-NARCOTIC
"RTN","XUMVIENU",363,0)
 S FDA(200,IENS,55.3)=$P(ND2,U,3) ;SCHEDULE III NARCOTIC
"RTN","XUMVIENU",364,0)
 S FDA(200,IENS,55.4)=$P(ND2,U,4) ;SCHEDULE III NON-NARCOTIC
"RTN","XUMVIENU",365,0)
 S FDA(200,IENS,55.5)=$P(ND2,U,5) ;SCHEDULE IV
"RTN","XUMVIENU",366,0)
 S FDA(200,IENS,55.6)=$P(ND2,U,6) ;SCHEDULE V
"RTN","XUMVIENU",367,0)
 I $G(XUARR("WHO"))="200PIEV",$G(XUARR("AuthWriteMedOrders"))="" S FDA(200,IENS,53.1)=1
"RTN","XUMVIENU",368,0)
 D FILER(.FDA,"",.XURET)
"RTN","XUMVIENU",369,0)
 Q
"RTN","XUMVIENU",370,0)
 ;
"RTN","XUMVIENU",371,0)
FIRSTDEA(XUDUZ,XUARR,XURET) ;File the first valid DEA in the XUARR input array
"RTN","XUMVIENU",372,0)
 ;into the single-value DEA fields of the NP file
"RTN","XUMVIENU",373,0)
 N CNT,DEA,FDA,FIRST,IENS
"RTN","XUMVIENU",374,0)
 ;
"RTN","XUMVIENU",375,0)
 ;Find the first valid DEA number in the input array
"RTN","XUMVIENU",376,0)
 S FIRST="",CNT=0 F  S CNT=$O(XUARR("DEA",CNT)) Q:'CNT  D  Q:FIRST
"RTN","XUMVIENU",377,0)
 . S DEA=$G(XUARR("DEA",CNT,"DEA")) Q:DEA=""
"RTN","XUMVIENU",378,0)
 . S DEA=$$GETINT(200,53.2,DEA)
"RTN","XUMVIENU",379,0)
 . S:DEA'=U FIRST=CNT
"RTN","XUMVIENU",380,0)
 Q:'FIRST
"RTN","XUMVIENU",381,0)
 ;
"RTN","XUMVIENU",382,0)
 ;Set up FDA with data from DEA NUMBERS entry
"RTN","XUMVIENU",383,0)
 S IENS=XUDUZ_","
"RTN","XUMVIENU",384,0)
 S FDA(200,IENS,53.2)=DEA
"RTN","XUMVIENU",385,0)
 S:$D(XUARR("DEA",FIRST,"Detox"))#2 FDA(200,IENS,53.11)=XUARR("DEA",FIRST,"Detox")
"RTN","XUMVIENU",386,0)
 S:$D(XUARR("DEA",FIRST,"DEAExpire"))#2 FDA(200,IENS,747.44)=XUARR("DEA",FIRST,"DEAExpire")
"RTN","XUMVIENU",387,0)
 S:$D(XUARR("DEA",FIRST,"SchedIINarc"))#2 FDA(200,IENS,55.1)=XUARR("DEA",FIRST,"SchedIINarc")
"RTN","XUMVIENU",388,0)
 S:$D(XUARR("DEA",FIRST,"SchedIINonNarc"))#2 FDA(200,IENS,55.2)=XUARR("DEA",FIRST,"SchedIINonNarc")
"RTN","XUMVIENU",389,0)
 S:$D(XUARR("DEA",FIRST,"SchedIIINarc"))#2 FDA(200,IENS,55.3)=XUARR("DEA",FIRST,"SchedIIINarc")
"RTN","XUMVIENU",390,0)
 S:$D(XUARR("DEA",FIRST,"SchedIIINonNarc"))#2 FDA(200,IENS,55.4)=XUARR("DEA",FIRST,"SchedIIINonNarc")
"RTN","XUMVIENU",391,0)
 S:$D(XUARR("DEA",FIRST,"SchedIV"))#2 FDA(200,IENS,55.5)=XUARR("DEA",FIRST,"SchedIV")
"RTN","XUMVIENU",392,0)
 S:$D(XUARR("DEA",FIRST,"SchedV"))#2 FDA(200,IENS,55.6)=XUARR("DEA",FIRST,"SchedV")
"RTN","XUMVIENU",393,0)
 I $G(XUARR("WHO"))="200PIEV",$G(XUARR("AuthWriteMedOrders"))="" S FDA(200,IENS,53.1)=1
"RTN","XUMVIENU",394,0)
 D FILER(.FDA,"E",.XURET)
"RTN","XUMVIENU",395,0)
 Q
"RTN","XUMVIENU",396,0)
 ;
"RTN","XUMVIENU",397,0)
FILER(XUMVIFDA,FLAG,XURET) ;Call the Filer
"RTN","XUMVIENU",398,0)
 N DIERR,DIHELP,DIMSG,IENS,FILE,ROOT,XUMVIERR
"RTN","XUMVIENU",399,0)
 Q:'$D(XUMVIFDA)
"RTN","XUMVIENU",400,0)
 S FILE=$O(XUMVIFDA(0)),IENS=$O(XUMVIFDA(+FILE,"")),ROOT=$$ROOT^DILFD(FILE,IENS)_+IENS_")"
"RTN","XUMVIENU",401,0)
 I $G(ROOT)="" D ADDERR(.XURET,"Unable to determine global root of File #"_FILE_", IENS '"_IENS_".") Q
"RTN","XUMVIENU",402,0)
 L +@ROOT:10 E  D ADDERR(.XURET,"Unable to lock global "_ROOT_".") Q
"RTN","XUMVIENU",403,0)
 D FILE^DIE($G(FLAG),"XUMVIFDA","XUMVIERR")
"RTN","XUMVIENU",404,0)
 L -@ROOT
"RTN","XUMVIENU",405,0)
 D:$G(DIERR) ADDERR(.XURET,$$BLDERR("XUMVIERR"))
"RTN","XUMVIENU",406,0)
 Q
"RTN","XUMVIENU",407,0)
 ;
"RTN","XUMVIENU",408,0)
UPDATER(XUMVIFDA,FLAG,XURET) ;Call the Updater
"RTN","XUMVIENU",409,0)
 N DIERR,DIHELP,DIMSG,XUMVIERR,XUMVIIEN
"RTN","XUMVIENU",410,0)
 D UPDATE^DIE(FLAG,"XUMVIFDA","XUMVIIEN","XUMVIERR")
"RTN","XUMVIENU",411,0)
 I $G(DIERR) D ADDERR(.XURET,$$BLDERR("XUMVIERR")) Q 0
"RTN","XUMVIENU",412,0)
 Q +$G(XUMVIIEN(1))
"RTN","XUMVIENU",413,0)
 ;
"RTN","XUMVIENU",414,0)
ADDERR(XURET,MSG) ;Add error MSG to XURET
"RTN","XUMVIENU",415,0)
 Q:$G(MSG)=""
"RTN","XUMVIENU",416,0)
 S XURET=$S(XURET]"":XURET_" ",1:"-1^")_MSG
"RTN","XUMVIENU",417,0)
 Q
"RTN","XUMVIENU",418,0)
 ;
"RTN","XUMVIENU",419,0)
STATEIEN(STATE) ;Return "`"_IEN if valid abbreviation, VA code, or name
"RTN","XUMVIENU",420,0)
 N IEN
"RTN","XUMVIENU",421,0)
 Q:$G(STATE)="" ""
"RTN","XUMVIENU",422,0)
 S IEN=$S(STATE="FG":$O(^DIC(5,"B","FOREIGN COUNTRY",0)),STATE="OT":$O(^DIC(5,"B","OTHER",0)),STATE="EU":$O(^DIC(5,"B","EUROPE",0)),1:$O(^DIC(5,"C",STATE,0)))
"RTN","XUMVIENU",423,0)
 S:'IEN IEN=$O(^DIC(5,"B",STATE,""))
"RTN","XUMVIENU",424,0)
 Q $S(IEN>0:"`"_IEN,1:STATE)
"RTN","XUMVIENU",425,0)
 ;
"RTN","XUMVIENU",426,0)
GETINT(FILE,FLD,VAL) ;Get the internal form of the data; returns "^" if not valid
"RTN","XUMVIENU",427,0)
 N DIERR,DIHELP,DIMSG,XUMSG,XURES
"RTN","XUMVIENU",428,0)
 Q:VAL="" ""
"RTN","XUMVIENU",429,0)
 D CHK^DIE(FILE,FLD,"",VAL,.XURES,"XUMSG")
"RTN","XUMVIENU",430,0)
 Q XURES
"RTN","XUMVIENU",431,0)
 ;
"RTN","XUMVIENU",432,0)
BLDERR(INROOT) ;Build a string containing error messages returned by FileMan
"RTN","XUMVIENU",433,0)
 N ERRSTR,I,XUERMSGS
"RTN","XUMVIENU",434,0)
 D MSG^DIALOG("AE",.XUERMSGS,"","",$G(INROOT))
"RTN","XUMVIENU",435,0)
 S ERRSTR=""
"RTN","XUMVIENU",436,0)
 S I=0 F  S I=$O(XUERMSGS(I)) Q:'I  S:XUERMSGS(I)]"" ERRSTR=ERRSTR_$E(" ",ERRSTR]"")_XUERMSGS(I)
"RTN","XUMVIENU",437,0)
 Q ERRSTR
"RTN","XUMVIENU",438,0)
 ;
"RTN","XUMVIENU",439,0)
MAXLEN(FILE,FLD) ;Return the maximum length of field FLD in file FILE
"RTN","XUMVIENU",440,0)
 N MAX
"RTN","XUMVIENU",441,0)
 S MAX=$$GET1^DID(+FILE,+FLD,"","FIELD LENGTH") S:MAX'>0 MAX=999
"RTN","XUMVIENU",442,0)
 Q MAX
"RTN","XUMVIENU",443,0)
 ;
"RTN","XUMVIENU",444,0)
 ;=================================================
"RTN","XUMVIENU",445,0)
 ; Code for storing debugging information in ^XTMP
"RTN","XUMVIENU",446,0)
 ;=================================================
"RTN","XUMVIENU",447,0)
RECORD(PARAM,FLAG,RPCNAME) ;Record RPC inputs for debugging
"RTN","XUMVIENU",448,0)
 ;Return seq# in ^XTMP
"RTN","XUMVIENU",449,0)
 N NODE,NOW,SEQ,TODAY
"RTN","XUMVIENU",450,0)
 Q:'$$ISDEBUG 0
"RTN","XUMVIENU",451,0)
 S:$G(RPCNAME)="" RPCNAME="XUS MVI ENRICH NEW PERSON"
"RTN","XUMVIENU",452,0)
 S NOW=$$NOW^XLFDT,TODAY=$P(NOW,".")
"RTN","XUMVIENU",453,0)
 S NODE=$$NODE
"RTN","XUMVIENU",454,0)
 ;
"RTN","XUMVIENU",455,0)
 L +^XTMP(NODE):2
"RTN","XUMVIENU",456,0)
 D SETXTMP0(NODE)
"RTN","XUMVIENU",457,0)
 S SEQ=$O(^XTMP(NODE," "),-1)+1
"RTN","XUMVIENU",458,0)
 M ^XTMP(NODE,SEQ,"PARAM")=PARAM
"RTN","XUMVIENU",459,0)
 S ^XTMP(NODE,SEQ,"FLAG")=$G(FLAG)
"RTN","XUMVIENU",460,0)
 S ^XTMP(NODE,SEQ,"DT")=NOW
"RTN","XUMVIENU",461,0)
 S ^XTMP(NODE,SEQ,"DUZ")=$G(DUZ)
"RTN","XUMVIENU",462,0)
 S ^XTMP(NODE,SEQ,"RPC")=RPCNAME
"RTN","XUMVIENU",463,0)
 L -^XTMP(NODE)
"RTN","XUMVIENU",464,0)
 Q SEQ
"RTN","XUMVIENU",465,0)
 ;
"RTN","XUMVIENU",466,0)
RETURN(SEQ,RETURN) ;Record the return value
"RTN","XUMVIENU",467,0)
 Q:'SEQ  Q:'$$ISDEBUG
"RTN","XUMVIENU",468,0)
 M ^XTMP($$NODE,SEQ,"RETURN")=RETURN
"RTN","XUMVIENU",469,0)
 Q
"RTN","XUMVIENU",470,0)
 ;
"RTN","XUMVIENU",471,0)
DBON ;Set DEBUG on
"RTN","XUMVIENU",472,0)
 N NODE
"RTN","XUMVIENU",473,0)
 S NODE=$$NODE
"RTN","XUMVIENU",474,0)
 D SETXTMP0
"RTN","XUMVIENU",475,0)
 S ^XTMP(NODE,"DEBUG")=1
"RTN","XUMVIENU",476,0)
 W !,$NA(^XTMP(NODE,"DEBUG"))_" set to 1.",!
"RTN","XUMVIENU",477,0)
 Q
"RTN","XUMVIENU",478,0)
 ;
"RTN","XUMVIENU",479,0)
DBOFF ;Set DEBUG off
"RTN","XUMVIENU",480,0)
 N NODE
"RTN","XUMVIENU",481,0)
 S NODE=$$NODE
"RTN","XUMVIENU",482,0)
 K ^XTMP(NODE,"DEBUG")
"RTN","XUMVIENU",483,0)
 K:'$O(^XTMP(NODE,0)) ^XTMP(NODE)
"RTN","XUMVIENU",484,0)
 W !,$NA(^XTMP(NODE,"DEBUG"))_" killed.",!
"RTN","XUMVIENU",485,0)
 Q
"RTN","XUMVIENU",486,0)
 ;
"RTN","XUMVIENU",487,0)
ISDEBUG() ;Return 1 if DEBUG mode flag is set
"RTN","XUMVIENU",488,0)
 Q $G(^XTMP($$NODE,"DEBUG"))
"RTN","XUMVIENU",489,0)
 ;
"RTN","XUMVIENU",490,0)
PURGE ;Purge the debugging data stored in ^XTMP
"RTN","XUMVIENU",491,0)
 N ISDEBUG
"RTN","XUMVIENU",492,0)
 S ISDEBUG=$$ISDEBUG
"RTN","XUMVIENU",493,0)
 K ^XTMP($$NODE)
"RTN","XUMVIENU",494,0)
 W !,$NA(^XTMP($$NODE))_" killed.",!
"RTN","XUMVIENU",495,0)
 D:ISDEBUG DBON
"RTN","XUMVIENU",496,0)
 Q
"RTN","XUMVIENU",497,0)
 ;
"RTN","XUMVIENU",498,0)
SETXTMP0(NODE,DESC,LIFE) ;Set 0 node of ^XTMP(node)
"RTN","XUMVIENU",499,0)
 N CREATEDT
"RTN","XUMVIENU",500,0)
 S:$G(NODE)="" NODE=$$NODE
"RTN","XUMVIENU",501,0)
 S CREATEDT=$S($D(^XTMP(NODE,0))#2:$P(^(0),U,2),1:DT)
"RTN","XUMVIENU",502,0)
 S:'$G(LIFE) LIFE=30
"RTN","XUMVIENU",503,0)
 S:$G(DESC)="" DESC="New Person RPC Inputs and Outputs"
"RTN","XUMVIENU",504,0)
 S ^XTMP(NODE,0)=$$FMADD^XLFDT(DT,LIFE)_U_CREATEDT_U_DESC
"RTN","XUMVIENU",505,0)
 Q
"RTN","XUMVIENU",506,0)
 ;
"RTN","XUMVIENU",507,0)
NODE() ;Return ^XTMP Debug subscript
"RTN","XUMVIENU",508,0)
 Q "XU_RPC_DEBUG_NP"
"RTN","XUMVINPA")
0^3^B8194513^n/a
"RTN","XUMVINPA",1,0)
XUMVINPA ;MVI/DRI Master Veteran Index New Person Add API ;6/4/19  16:01
"RTN","XUMVINPA",2,0)
 ;;8.0;KERNEL;**711**;Jul 10, 1995;Build 9
"RTN","XUMVINPA",3,0)
 ;Per VA Directive 6402, this routine should not be modified.
"RTN","XUMVINPA",4,0)
 ;
"RTN","XUMVINPA",5,0)
 ;**711 - STORY 978382 (dri) new routine - new person add api
"RTN","XUMVINPA",6,0)
 ;
"RTN","XUMVINPA",7,0)
 Q
"RTN","XUMVINPA",8,0)
 ;
"RTN","XUMVINPA",9,0)
ADDUSER(XUARR) ;Add a new user using minimum attributes for user identification of
"RTN","XUMVINPA",10,0)
 ; PPMS (Provider Profile Management System) PIE (Provider Integration Engine)
"RTN","XUMVINPA",11,0)
 ;
"RTN","XUMVINPA",12,0)
 ; This interface is available under a private Integration Agreement (#7062) in
"RTN","XUMVINPA",13,0)
 ; support of PPMS PIE only, and should not be used under any other circumstances.
"RTN","XUMVINPA",14,0)
 ;
"RTN","XUMVINPA",15,0)
 ; Input:
"RTN","XUMVINPA",16,0)
 ;    XUARR("NAME") = NAME  surname|first name|middle name|suffix|full .01 name
"RTN","XUMVINPA",17,0)
 ;    XUARR("NPI")  = NPI (National Provider Identifier)
"RTN","XUMVINPA",18,0)
 ;
"RTN","XUMVINPA",19,0)
 ; Return:
"RTN","XUMVINPA",20,0)
 ;    Fail    = "-1^Error Message"
"RTN","XUMVINPA",21,0)
 ;    Success = IEN^#.01 NAME field^1  add of NEW PERSON (#200) file entry
"RTN","XUMVINPA",22,0)
 ;            = IEN                    person already exists
"RTN","XUMVINPA",23,0)
 ;              (Note: this routine will NOT set DUZ to the identified IEN)
"RTN","XUMVINPA",24,0)
 ;
"RTN","XUMVINPA",25,0)
 ; Example:
"RTN","XUMVINPA",26,0)
 ;     S NEWDUZ=$$ADDUSER^XUMVINPA(.XUARR)
"RTN","XUMVINPA",27,0)
 ;
"RTN","XUMVINPA",28,0)
 ;
"RTN","XUMVINPA",29,0)
 N XUDUZ,ERRMSG
"RTN","XUMVINPA",30,0)
 ;
"RTN","XUMVINPA",31,0)
 I '$$CHKDGT^XUSNPI($G(XUARR("NPI"))) Q "-1^Invalid NPI" ;#41.99 - NPI
"RTN","XUMVINPA",32,0)
 S XUDUZ=+$O(^VA(200,"ANPI",XUARR("NPI"),0)) ;does user already exist
"RTN","XUMVINPA",33,0)
 I XUDUZ Q XUDUZ ;per chris, if person already exists, return duz regardless if active and don't udpate
"RTN","XUMVINPA",34,0)
 ;
"RTN","XUMVINPA",35,0)
 I $P($G(XUARR("NAME")),"|",5)="" Q "-1^Subject NAME is required to add a new user" ;#.01 - NAME
"RTN","XUMVINPA",36,0)
 ;
"RTN","XUMVINPA",37,0)
 S XUDUZ=$$ADDU($P(XUARR("NAME"),"|",5)) ;Put the name in the .01 field first, pass back all three pieces to identify an add
"RTN","XUMVINPA",38,0)
 I +XUDUZ<1 Q "-1^Create of new user record failed"
"RTN","XUMVINPA",39,0)
 ;
"RTN","XUMVINPA",40,0)
 S ERRMSG=$$UPDU(.XUARR,XUDUZ) ;then update the remaining fields, no checks if validation issues
"RTN","XUMVINPA",41,0)
 ;
"RTN","XUMVINPA",42,0)
 Q XUDUZ ;duz of new person
"RTN","XUMVINPA",43,0)
 ;
"RTN","XUMVINPA",44,0)
ADDU(XUNAME) ;Add new name to the New Person File
"RTN","XUMVINPA",45,0)
 N DD,DO,DIC,DA,X,Y
"RTN","XUMVINPA",46,0)
 K ^TMP("DIERR",$J)
"RTN","XUMVINPA",47,0)
 S DIC="^VA(200,",DIC(0)="F",X=XUNAME
"RTN","XUMVINPA",48,0)
 ; Get a LOCK. Block if can't get.
"RTN","XUMVINPA",49,0)
 L +^VA(200,0):10 Q:'$T "-1^Addition of new users is blocked"
"RTN","XUMVINPA",50,0)
 D FILE^DICN
"RTN","XUMVINPA",51,0)
 L -^VA(200,0)
"RTN","XUMVINPA",52,0)
 Q Y
"RTN","XUMVINPA",53,0)
 ;
"RTN","XUMVINPA",54,0)
UPDU(XUARR,XUDUZ) ;Update user in the New Person File with Enterprise View
"RTN","XUMVINPA",55,0)
 N DIC,FDA,IEN,X,XUKEY,Y
"RTN","XUMVINPA",56,0)
 K ^TMP("DIERR",$J)
"RTN","XUMVINPA",57,0)
 S IEN=+XUDUZ_","
"RTN","XUMVINPA",58,0)
 S FDA(200,IEN,41.99)=XUARR("NPI") ;NPI
"RTN","XUMVINPA",59,0)
 ;
"RTN","XUMVINPA",60,0)
 F XUKEY="XUORES","PROVIDER" K DIC S DIC="^DIC(19.1,",DIC(0)="MZ",X=XUKEY D ^DIC Q:Y<0  D  ;give user XUORES & PROVIDER keys
"RTN","XUMVINPA",61,0)
 .I $D(^VA(200,XUDUZ,51,"B",+Y)) Q  ;user already has key
"RTN","XUMVINPA",62,0)
 .S FDA(200.051,"+"_+Y_","_IEN,.01)=+Y ;key
"RTN","XUMVINPA",63,0)
 .S FDA(200.051,"+"_+Y_","_IEN,1)=DUZ ;given by
"RTN","XUMVINPA",64,0)
 .S FDA(200.051,"+"_+Y_","_IEN,2)=DT ;date given
"RTN","XUMVINPA",65,0)
 ;
"RTN","XUMVINPA",66,0)
 ; Apply all the changes
"RTN","XUMVINPA",67,0)
 I $D(FDA) K IEN D UPDATE^DIE(,"FDA","IEN") ;File all the data
"RTN","XUMVINPA",68,0)
 ;I $D(^TMP("DIERR",$J)) Q "-1^FileMan error"  ;FileMan Error
"RTN","XUMVINPA",69,0)
 Q ""
"RTN","XUMVINPA",70,0)
 ;
"RTN","XUMVINPU")
0^1^B124825166^B42823064
"RTN","XUMVINPU",1,0)
XUMVINPU ;MVI/DRI - Master Veteran Index New Person Utilities ;3/21/18  10:15
"RTN","XUMVINPU",2,0)
 ;;8.0;KERNEL;**691,711**;Jul 10, 1995;Build 9
"RTN","XUMVINPU",3,0)
 ;Per VA Directive 6402, this routine should not be modified.
"RTN","XUMVINPU",4,0)
 ;
"RTN","XUMVINPU",5,0)
 ;**711, Story 977780 (jfw)
"RTN","XUMVINPU",6,0)
 ;   - Added NPI/SSN as additional lookup values/parameters
"RTN","XUMVINPU",7,0)
 ;   - Added the following additional traits to return:
"RTN","XUMVINPU",8,0)
 ;       STREET ADDRESS 2 (.112)
"RTN","XUMVINPU",9,0)
 ;       STREET ADDRESS 3 (.113)
"RTN","XUMVINPU",10,0)
 ;       CITY (.114)
"RTN","XUMVINPU",11,0)
 ;       STATE (.115)
"RTN","XUMVINPU",12,0)
 ;       ZIP CODE (.116)
"RTN","XUMVINPU",13,0)
 ;       FAX NUMBER (.136)
"RTN","XUMVINPU",14,0)
 ;       SEX (4)
"RTN","XUMVINPU",15,0)
 ;       TITLE (8)
"RTN","XUMVINPU",16,0)
 ;       NPI (41.99)
"RTN","XUMVINPU",17,0)
 ;       KEYS (51)
"RTN","XUMVINPU",18,0)
 ;       PERSON CLASS (8932.1)
"RTN","XUMVINPU",19,0)
 ;         Effective Date (2)
"RTN","XUMVINPU",20,0)
 ;         Expiration Date (3)
"RTN","XUMVINPU",21,0)
 ;       AUTHORIZED TO WRITE MED ORDERS (53.1)
"RTN","XUMVINPU",22,0)
 ;       DETOX/MAINTENANCE ID NUMBER (53.11)
"RTN","XUMVINPU",23,0)
 ;       DEA# (53.2)
"RTN","XUMVINPU",24,0)
 ;       INACTIVE DATE (53.4)
"RTN","XUMVINPU",25,0)
 ;       PROVIDER CLASS (53.5)
"RTN","XUMVINPU",26,0)
 ;       PROVIDER TYPE (53.6)
"RTN","XUMVINPU",27,0)
 ;       REMARKS (53.9)
"RTN","XUMVINPU",28,0)
 ;       NON-VA PRESCRIBER (53.91)
"RTN","XUMVINPU",29,0)
 ;       TAX ID (53.92)
"RTN","XUMVINPU",30,0)
 ;       SCHEDULE II NARCOTIC (55.1)
"RTN","XUMVINPU",31,0)
 ;       SCHEDULE II NON-NARCOTIC (55.2)
"RTN","XUMVINPU",32,0)
 ;       SCHEDULE III NARCOTIC (55.3)
"RTN","XUMVINPU",33,0)
 ;       SCHEDULE III NON-NARCOTIC (55.4)
"RTN","XUMVINPU",34,0)
 ;       SCHEDULE IV (55.5)
"RTN","XUMVINPU",35,0)
 ;       SCHEDULE V (55.6)
"RTN","XUMVINPU",36,0)
 ;       DEA EXPIRATION DATE (747.44)
"RTN","XUMVINPU",37,0)
 ;
"RTN","XUMVINPU",38,0)
 ;       The following will be returned if patch XU*8.0*688 installed
"RTN","XUMVINPU",39,0)
 ;         DETOX CALCULATED (9001)
"RTN","XUMVINPU",40,0)
 ;         DEA NUMBER (53.2...01)
"RTN","XUMVINPU",41,0)
 ;         INDIVIDUAL DEA SUFFIX (53.2...02)
"RTN","XUMVINPU",42,0)
 ;         All fields in DEA NUMBERS (#8991.9) file if DEA NUMBER exists 
"RTN","XUMVINPU",43,0)
 ;          (Except .01 which is being returned from File #200 above)
"RTN","XUMVINPU",44,0)
 ;          
"RTN","XUMVINPU",45,0)
 ;
"RTN","XUMVINPU",46,0)
GET(XURET,XUDUZ,SECID,NPI,SSN) ;rpc to retrieve new person file data
"RTN","XUMVINPU",47,0)
 ; 
"RTN","XUMVINPU",48,0)
 ; called from rpc: XUS MVI NEW PERSON GET
"RTN","XUMVINPU",49,0)
 ;
"RTN","XUMVINPU",50,0)
 ; Input (ONE of the following):
"RTN","XUMVINPU",51,0)
 ;  XUDUZ = NEW PERSON IEN
"RTN","XUMVINPU",52,0)
 ;  SECID = SECURITY ID
"RTN","XUMVINPU",53,0)
 ;  NPI   = NATIONAL PROVIDER IDENTIFIER
"RTN","XUMVINPU",54,0)
 ;  SSN   = SOCIAL SECURITY NUMBER
"RTN","XUMVINPU",55,0)
 ;
"RTN","XUMVINPU",56,0)
 ; Output:
"RTN","XUMVINPU",57,0)
 ;  Success:
"RTN","XUMVINPU",58,0)
 ;   XURET = ^TMP("XUMVINPU",$J)
"RTN","XUMVINPU",59,0)
 ;    @XURET@(#) = FILE #;FIELD #<;SUBFIELD #><;FILE POINTER>^FIELD NAME^<COUNTER #>^INTERNAL VALUE^EXTERNAL VALUE
"RTN","XUMVINPU",60,0)
 ;      <> Denotes optional values. If Counter populated, denotes multiple value <1-n>.
"RTN","XUMVINPU",61,0)
 ;    @XURET@(#)="200;IEN^DUZ^^^"
"RTN","XUMVINPU",62,0)
 ;    @XURET@(#)="200;.01^NAME^^^"
"RTN","XUMVINPU",63,0)
 ;    @XURET@(#)="200;4^SEX^^^"
"RTN","XUMVINPU",64,0)
 ;    @XURET@(#)="200;8^TITLE^^^"
"RTN","XUMVINPU",65,0)
 ;    @XURET@(#)="200;7^DISUSER^^^"
"RTN","XUMVINPU",66,0)
 ;    @XURET@(#)="200;9.2^TERMINATION DATE^^^"
"RTN","XUMVINPU",67,0)
 ;    @XURET@(#)="200;9.4^Termination Reason^^^"
"RTN","XUMVINPU",68,0)
 ;    @XURET@(#)="200;15^PROHIBITED TIMES FOR SIGN-ON^^^"
"RTN","XUMVINPU",69,0)
 ;    @XURET@(#)="200;11.2^DATE VERIFY CODE LAST CHANGED^^^"
"RTN","XUMVINPU",70,0)
 ;    @XURET@(#)="200;.111^STREET ADDRESS 1^^^"
"RTN","XUMVINPU",71,0)
 ;    @XURET@(#)="200;.112^STREET ADDRESS 2^^^"
"RTN","XUMVINPU",72,0)
 ;    @XURET@(#)="200;.113^STREET ADDRESS 3^^^"
"RTN","XUMVINPU",73,0)
 ;    @XURET@(#)="200;.114^CITY^^^"
"RTN","XUMVINPU",74,0)
 ;    @XURET@(#)="200;.115^STATE^^^"
"RTN","XUMVINPU",75,0)
 ;    @XURET@(#)="200;.116^ZIP CODE^^^"
"RTN","XUMVINPU",76,0)
 ;    @XURET@(#)="200;.132^OFFICE PHONE^^^"
"RTN","XUMVINPU",77,0)
 ;    @XURET@(#)="200;.136^FAX NUMBER^^^"
"RTN","XUMVINPU",78,0)
 ;    @XURET@(#)="200;.151^EMAIL ADDRESS^^^"
"RTN","XUMVINPU",79,0)
 ;    @XURET@(#)="200;30^DATE ENTERED^^^"
"RTN","XUMVINPU",80,0)
 ;    @XURET@(#)="200;31^CREATOR^^^"
"RTN","XUMVINPU",81,0)
 ;    @XURET@(#)="200;41.99^NPI^^^"
"RTN","XUMVINPU",82,0)
 ;    @XURET@(#)="200;9^SSN^^^"
"RTN","XUMVINPU",83,0)
 ;    @XURET@(#)="200;202^LAST SIGN-ON DATE/TIME^^^"
"RTN","XUMVINPU",84,0)
 ;    @XURET@(#)="200;202.02^XUS Logon Attempt Count^^^"
"RTN","XUMVINPU",85,0)
 ;    @XURET@(#)="200;202.03^XUS Active User^^^"
"RTN","XUMVINPU",86,0)
 ;    @XURET@(#)="200;202.04^Entry Last Edit Date^^^"
"RTN","XUMVINPU",87,0)
 ;    @XURET@(#)="200;202.05^LOCKOUT USER UNTIL^^^"
"RTN","XUMVINPU",88,0)
 ;    @XURET@(#)="200;16;.01^DIVISION^<1-n>^^"
"RTN","XUMVINPU",89,0)
 ;    @XURET@(#)="200;10.1^NAME COMPONENTS^^^"
"RTN","XUMVINPU",90,0)
 ;    @XURET@(#)="20;1^FAMILY (LAST) NAME^^^"
"RTN","XUMVINPU",91,0)
 ;    @XURET@(#)="20;2^GIVEN (FIRST) NAME^^^"
"RTN","XUMVINPU",92,0)
 ;    @XURET@(#)="20;3^MIDDLE NAME^^^"
"RTN","XUMVINPU",93,0)
 ;    @XURET@(#)="20;4^PREFIX^^^"
"RTN","XUMVINPU",94,0)
 ;    @XURET@(#)="20;5^SUFFIX^^^"
"RTN","XUMVINPU",95,0)
 ;    @XURET@(#)="20;6^DEGREE^^^"
"RTN","XUMVINPU",96,0)
 ;    @XURET@(#)="200;29^SERVICE/SECTION^^^"
"RTN","XUMVINPU",97,0)
 ;    @XURET@(#)="200;201^PRIMARY MENU OPTION^^^"
"RTN","XUMVINPU",98,0)
 ;    @XURET@(#)="200;203;.01^SECONDARY MENU OPTIONS^<1-n>^^"
"RTN","XUMVINPU",99,0)
 ;    @XURET@(#)="200;51;.01^KEYS^<1-n>^^"
"RTN","XUMVINPU",100,0)
 ;    @XURET@(#)="200;205.1^SECID^^^"
"RTN","XUMVINPU",101,0)
 ;    @XURET@(#)="200;205.2^SUBJECT ORGANIZATION^^^"
"RTN","XUMVINPU",102,0)
 ;    @XURET@(#)="200;205.3^SUBJECT ORGANIZATION ID^^^"
"RTN","XUMVINPU",103,0)
 ;    @XURET@(#)="200;205.4^UNIQUE USER ID^^^"
"RTN","XUMVINPU",104,0)
 ;    @XURET@(#)="200;205.5^ADUPN^^^"
"RTN","XUMVINPU",105,0)
 ;    @XURET@(#)="200;501.1^NETWORK USERNAME^^^"
"RTN","XUMVINPU",106,0)
 ;    @XURET@(#)="200;8932.1;.01^PERSON CLASS^<1-n>^^"
"RTN","XUMVINPU",107,0)
 ;    @XURET@(#)="200;8932.1;2^EFFECTIVE DATE^<#>^^"
"RTN","XUMVINPU",108,0)
 ;    @XURET@(#)="200;8932.1;3^EXPIRATION DATE^<#>^^"
"RTN","XUMVINPU",109,0)
 ;    @XURET@(#)="200;53.1^AUTHORIZED TO WRITE MED ORDERS^^^"
"RTN","XUMVINPU",110,0)
 ;    @XURET@(#)="200;53.11^DETOX/MAINTENANCE ID NUMBER^^^" 
"RTN","XUMVINPU",111,0)
 ;    @XURET@(#)="200;53.2^DEA#^^^"
"RTN","XUMVINPU",112,0)
 ;    @XURET@(#)="200;747.44^DEA EXPIRATION DATE^^^"
"RTN","XUMVINPU",113,0)
 ;    @XURET@(#)="200;53.4^INACTIVE DATE^^^"
"RTN","XUMVINPU",114,0)
 ;    @XURET@(#)="200;53.5^PROVIDER CLASS^^^"
"RTN","XUMVINPU",115,0)
 ;    @XURET@(#)="200;53.6^PROVIDER TYPE^^^"
"RTN","XUMVINPU",116,0)
 ;    @XURET@(#)="200;53.9^REMARKS^^^"
"RTN","XUMVINPU",117,0)
 ;    @XURET@(#)="200;53.91^NON-VA PRESCRIBER^^^"
"RTN","XUMVINPU",118,0)
 ;    @XURET@(#)="200;53.92^TAX ID^^^"
"RTN","XUMVINPU",119,0)
 ;    @XURET@(#)="200;55.1^SCHEDULE II NARCOTIC^^^"
"RTN","XUMVINPU",120,0)
 ;    @XURET@(#)="200;55.2^SCHEDULE II NON-NARCOTIC^^^"
"RTN","XUMVINPU",121,0)
 ;    @XURET@(#)="200;55.3^SCHEDULE III NARCOTIC^^^"
"RTN","XUMVINPU",122,0)
 ;    @XURET@(#)="200;55.4^SCHEDULE III NON-NARCOTIC^^^"
"RTN","XUMVINPU",123,0)
 ;    @XURET@(#)="200;55.5^SCHEDULE IV^^^"
"RTN","XUMVINPU",124,0)
 ;    @XURET@(#)="200;55.6^SCHEDULE V^^^"
"RTN","XUMVINPU",125,0)
 ;
"RTN","XUMVINPU",126,0)
 ;    **The following are ONLY returned if patch
"RTN","XUMVINPU",127,0)
 ;    **XU*8.0*688 has been installed.
"RTN","XUMVINPU",128,0)
 ;    **Subscript Counter (#) will denote the DEA Data that belongs to the DEA NUMBER subscript
"RTN","XUMVINPU",129,0)
 ;    ** New DEA Data will always follow the DEA NUMBER entry!
"RTN","XUMVINPU",130,0)
 ;    @XURET@(#)="200;9001^DETOX CALCULATED^^^"
"RTN","XUMVINPU",131,0)
 ;    @XURET@(#)="200;53.21;.01;8991.9^DEA NUMBER^<1-n>^^"
"RTN","XUMVINPU",132,0)
 ;    @XURET@(#)="200;53.21;.02^INDIVIDUAL DEA SUFFIX^<#>^^"
"RTN","XUMVINPU",133,0)
 ;    **Only returned if there is a DEA NUMBER (200.5321) value!!**
"RTN","XUMVINPU",134,0)
 ;    @XURET@(#)="8991.9;.02^BUSINESS ACTIVITY CODE^<#>^^"
"RTN","XUMVINPU",135,0)
 ;    @XURET@(#)="8991.9;.03^DETOX NUMBER^<#>^^"
"RTN","XUMVINPU",136,0)
 ;    @XURET@(#)="8991.9;.04^EXPIRATION DATE^<#>^^"
"RTN","XUMVINPU",137,0)
 ;    @XURET@(#)="8991.9;.06^USE FOR INPATIENT ORDERS?^<#>^^"
"RTN","XUMVINPU",138,0)
 ;    @XURET@(#)="8991.9;.07^TYPE^<#>^^"
"RTN","XUMVINPU",139,0)
 ;    @XURET@(#)="8991.9;1.1^NAME (PROVIDER OR INSTITUTION)^<#>^^"
"RTN","XUMVINPU",140,0)
 ;    @XURET@(#)="8991.9;1.2^STREET ADDRESS 1^<#>^^"
"RTN","XUMVINPU",141,0)
 ;    @XURET@(#)="8991.9;1.3^STREET ADDRESS 2^<#>^^"
"RTN","XUMVINPU",142,0)
 ;    @XURET@(#)="8991.9;1.4^STREET ADDRESS 3^<#>^^"
"RTN","XUMVINPU",143,0)
 ;    @XURET@(#)="8991.9;1.5^CITY^<#>^^"
"RTN","XUMVINPU",144,0)
 ;    @XURET@(#)="8991.9;1.6^STATE^<#>^^"
"RTN","XUMVINPU",145,0)
 ;    @XURET@(#)="8991.9;1.7^ZIP CODE^<#>^^"
"RTN","XUMVINPU",146,0)
 ;    @XURET@(#)="8991.9;2.1^SCHEDULE II NARCOTIC?^<#>^^"
"RTN","XUMVINPU",147,0)
 ;    @XURET@(#)="8991.9;2.2^SCHEDULE II NON-NARCOTIC?^<#>^^"
"RTN","XUMVINPU",148,0)
 ;    @XURET@(#)="8991.9;2.3^SCHEDULE III NARCOTIC?^<#>^^"
"RTN","XUMVINPU",149,0)
 ;    @XURET@(#)="8991.9;2.4^SCHEDULE III NON-NARCOTIC?^<#>^^"
"RTN","XUMVINPU",150,0)
 ;    @XURET@(#)="8991.9;2.5^SCHEDULE IV?^<#>^^"
"RTN","XUMVINPU",151,0)
 ;    @XURET@(#)="8991.9;2.6^SCHEDULE V?^<#>^^"
"RTN","XUMVINPU",152,0)
 ;    @XURET@(#)="8991.9;10.1^LAST UPDATED BY^<#>^^"
"RTN","XUMVINPU",153,0)
 ;    @XURET@(#)="8991.9;10.2^LAST UPDATED DATE/TIME^<#>^^"
"RTN","XUMVINPU",154,0)
 ;    @XURET@(#)="8991.9;10.3^LAST DOJ UPDATE DATE/TIME^<#>^^"
"RTN","XUMVINPU",155,0)
 ;
"RTN","XUMVINPU",156,0)
 ;  Fail:
"RTN","XUMVINPU",157,0)
 ;   XURET = ^TMP("XUMVINPU",$J)
"RTN","XUMVINPU",158,0)
 ;   @XURET@(1)="-1^Invalid User"
"RTN","XUMVINPU",159,0)
 ;            or
"RTN","XUMVINPU",160,0)
 ;   @XURET@(1)="-1^No Data for User: ######"
"RTN","XUMVINPU",161,0)
 ;
"RTN","XUMVINPU",162,0)
 ; Example calling rpc from VistA:
"RTN","XUMVINPU",163,0)
 ;  >D GET^XUMVINPU(.XURET,12596)
"RTN","XUMVINPU",164,0)
 ;  >ZW XURET
"RTN","XUMVINPU",165,0)
 ;  >XURET="^TMP(""XUMVINPU"",17226)"
"RTN","XUMVINPU",166,0)
 ;
"RTN","XUMVINPU",167,0)
 ;  D ^%G would return:
"RTN","XUMVINPU",168,0)
 ;    ^TMP("XUMVINPU",17226,1)="200;IEN^DUZ^12596^12596"
"RTN","XUMVINPU",169,0)
 ;                          2)="200;.01^NAME^LAST,FIRST^LAST,FIRST"
"RTN","XUMVINPU",170,0)
 ;                          3)="200;7^DISUSER^^"
"RTN","XUMVINPU",171,0)
 ;                          #)=continuation of returned data
"RTN","XUMVINPU",172,0)
 ;
"RTN","XUMVINPU",173,0)
 ; Example calling rpc from MVI:
"RTN","XUMVINPU",174,0)
 ;  D DIRECT^XWB2HL7(.XURET,SITE,"XUS MVI NEW PERSON GET","",$G(XUDUZ),$G(SECID),$G(NPI),$G(SSN))
"RTN","XUMVINPU",175,0)
 ;
"RTN","XUMVINPU",176,0)
 ;
"RTN","XUMVINPU",177,0)
 K XURET
"RTN","XUMVINPU",178,0)
 N I,CNT,FILE,FLD,FLDS,FLDCNT,FLDNM,XUARR,XUGBL
"RTN","XUMVINPU",179,0)
 S XUGBL="^TMP("_"""XUMVINPU"""_","_$J_")"
"RTN","XUMVINPU",180,0)
 K @XUGBL
"RTN","XUMVINPU",181,0)
 ;
"RTN","XUMVINPU",182,0)
 S CNT=1,FILE=200
"RTN","XUMVINPU",183,0)
 I $G(SECID)'="" S XUDUZ=$O(^VA(FILE,"ASECID",SECID,0))
"RTN","XUMVINPU",184,0)
 I $G(NPI)'="" S XUDUZ=$O(^VA(FILE,"ANPI",NPI,0))
"RTN","XUMVINPU",185,0)
 I $G(SSN)'="" S XUDUZ=$O(^VA(FILE,"SSN",SSN,0))
"RTN","XUMVINPU",186,0)
 I $G(XUDUZ)="" S @XUGBL@(CNT)="-1^Invalid User" S XURET=$NA(@XUGBL) Q
"RTN","XUMVINPU",187,0)
 I '$D(^VA(FILE,XUDUZ)) S @XUGBL@(CNT)="-1^No Data for User: "_XUDUZ S XURET=$NA(@XUGBL) Q
"RTN","XUMVINPU",188,0)
 ;
"RTN","XUMVINPU",189,0)
 S @XUGBL@(CNT)=FILE_";IEN^DUZ^^"_XUDUZ_"^"_XUDUZ S CNT=CNT+1
"RTN","XUMVINPU",190,0)
 ;
"RTN","XUMVINPU",191,0)
 S FLDS=".01;4;8;7;9.2;9.4;15;11.2;.111;.112;.113;.114;.115;.116;.132;.136;.151;30;31;41.99;9;202;202.02;202.03;"
"RTN","XUMVINPU",192,0)
 S FLDS=FLDS_"202.04;202.05;16*;10.1;29;201;203*;51*;205.1;205.2;205.3;205.4;205.5;501.1;8932.1*;53.1;53.11;53.2;"
"RTN","XUMVINPU",193,0)
 S FLDS=FLDS_"747.44;53.4;53.5;53.6;53.9;53.91;53.92;55.1;55.2;55.3;55.4;55.5;55.6"
"RTN","XUMVINPU",194,0)
 S:($$PATCH^XPDUTL("XU*8.0*688")) FLDS=FLDS_";9001;53.21*"  ;NEW DETOX CALCULATED and DEA #'S multiple | DBIA #10141 (Supported)
"RTN","XUMVINPU",195,0)
 S FLDCNT=$L(FLDS,";")
"RTN","XUMVINPU",196,0)
 ;
"RTN","XUMVINPU",197,0)
 D GETS^DIQ(FILE,+XUDUZ_",",FLDS,"EI","XUARR") ;retrieve data
"RTN","XUMVINPU",198,0)
 ;
"RTN","XUMVINPU",199,0)
 F I=1:1:FLDCNT D
"RTN","XUMVINPU",200,0)
 .S FLD=$P($P(FLDS,";",I),"*")
"RTN","XUMVINPU",201,0)
 .D FIELD^DID(FILE,FLD,"","LABEL","FLDNM")
"RTN","XUMVINPU",202,0)
 .;
"RTN","XUMVINPU",203,0)
 .I FLD=16 D  Q  ;division multiple
"RTN","XUMVINPU",204,0)
 ..N IENS,MCNT,SUBFILE,SUBFLD
"RTN","XUMVINPU",205,0)
 ..S MCNT=1,SUBFILE=200.02,SUBFLD=.01
"RTN","XUMVINPU",206,0)
 ..D FIELD^DID(SUBFILE,SUBFLD,"","LABEL","FLDNM")
"RTN","XUMVINPU",207,0)
 ..I '$D(XUARR(SUBFILE)) S @XUGBL@(CNT)=FILE_";"_FLD_";"_SUBFLD_"^"_(FLDNM("LABEL"))_"^"_MCNT_"^^" S CNT=CNT+1 Q
"RTN","XUMVINPU",208,0)
 ..S IENS="" F  S IENS=$O(XUARR(SUBFILE,IENS)) Q:IENS=""  S @XUGBL@(CNT)=FILE_";"_FLD_";"_SUBFLD_"^"_(FLDNM("LABEL"))_"^"_MCNT_"^"_$G(XUARR(SUBFILE,IENS,SUBFLD,"I"))_"^"_$G(XUARR(SUBFILE,IENS,SUBFLD,"E")) S MCNT=MCNT+1,CNT=CNT+1
"RTN","XUMVINPU",209,0)
 .;
"RTN","XUMVINPU",210,0)
 .I FLD=10.1 D  Q  ;name components
"RTN","XUMVINPU",211,0)
 ..S @XUGBL@(CNT)=FILE_";"_FLD_"^"_(FLDNM("LABEL"))_"^^"_$G(XUARR(FILE,XUDUZ_",",FLD,"I"))_"^"_$G(XUARR(FILE,XUDUZ_",",FLD,"E")) S CNT=CNT+1
"RTN","XUMVINPU",212,0)
 ..N NCFILE,NCFLD
"RTN","XUMVINPU",213,0)
 ..S NCFILE=20
"RTN","XUMVINPU",214,0)
 ..D GETS^DIQ(NCFILE,+$G(XUARR(FILE,XUDUZ_",",FLD,"I"))_",","1;2;3;4;5;6","EI","XUARR") ;retrieve name component data
"RTN","XUMVINPU",215,0)
 ..F NCFLD=1,2,3,4,5,6 D
"RTN","XUMVINPU",216,0)
 ...D FIELD^DID(NCFILE,NCFLD,"","LABEL","FLDNM")
"RTN","XUMVINPU",217,0)
 ...S @XUGBL@(CNT)=NCFILE_";"_NCFLD_"^"_(FLDNM("LABEL"))_"^^"_XUARR(NCFILE,+$G(XUARR(FILE,XUDUZ_",",FLD,"I"))_",",NCFLD,"I")_"^"_XUARR(NCFILE,+$G(XUARR(FILE,XUDUZ_",",FLD,"I"))_",",NCFLD,"E") S CNT=CNT+1
"RTN","XUMVINPU",218,0)
 .;
"RTN","XUMVINPU",219,0)
 .I FLD=51 D  Q  ;KEYS multiple
"RTN","XUMVINPU",220,0)
 ..N IENS,MCNT,SUBFILE,SUBFLD
"RTN","XUMVINPU",221,0)
 ..S MCNT=1,SUBFILE=200.051,SUBFLD=.01
"RTN","XUMVINPU",222,0)
 ..D FIELD^DID(SUBFILE,SUBFLD,"","LABEL","FLDNM")
"RTN","XUMVINPU",223,0)
 ..I '$D(XUARR(SUBFILE)) S @XUGBL@(CNT)=FILE_";"_FLD_";"_SUBFLD_"^"_(FLDNM("LABEL"))_"^"_MCNT_"^^",CNT=CNT+1 Q
"RTN","XUMVINPU",224,0)
 ..S IENS="" F  S IENS=$O(XUARR(SUBFILE,IENS)) Q:IENS=""  S @XUGBL@(CNT)=FILE_";"_FLD_";"_SUBFLD_"^"_(FLDNM("LABEL"))_"^"_MCNT_"^"_$G(XUARR(SUBFILE,IENS,SUBFLD,"I"))_"^"_$G(XUARR(SUBFILE,IENS,SUBFLD,"E")),MCNT=MCNT+1,CNT=CNT+1
"RTN","XUMVINPU",225,0)
 .;
"RTN","XUMVINPU",226,0)
 .I FLD=53.21 D  Q  ;NEW DEA #'s multiple
"RTN","XUMVINPU",227,0)
 ..N I,IEN,IENS,MCNT,SUBFILE,SUBFLD,DEAARR,DEAFILE,DEAFLD,DEAFLDS,DEAFLDCNT
"RTN","XUMVINPU",228,0)
 ..S MCNT=1,SUBFILE=200.5321,SUBFLD=.01,DEAFILE=8991.9
"RTN","XUMVINPU",229,0)
 ..D FIELD^DID(SUBFILE,SUBFLD,"","LABEL","FLDNM")
"RTN","XUMVINPU",230,0)
 ..I '$D(XUARR(SUBFILE)) D  Q
"RTN","XUMVINPU",231,0)
 ...S @XUGBL@(CNT)=FILE_";"_FLD_";"_SUBFLD_";8991.9^"_(FLDNM("LABEL"))_"^"_MCNT_"^^",CNT=CNT+1
"RTN","XUMVINPU",232,0)
 ...D FIELD^DID(SUBFILE,.02,"","LABEL","FLDNM")
"RTN","XUMVINPU",233,0)
 ...S @XUGBL@(CNT)=FILE_";"_FLD_";"_.02_"^"_(FLDNM("LABEL"))_"^"_MCNT_"^^",CNT=CNT+1
"RTN","XUMVINPU",234,0)
 ..S DEAFLDS=".02;.03;.04;.06;.07;1.1;1.2;1.3;1.4;1.5;1.6;1.7;2.1;2.2;2.3;2.4;2.5;2.6;10.1;10.2;10.3"
"RTN","XUMVINPU",235,0)
 ..S DEAFLDCNT=$L(DEAFLDS,";")
"RTN","XUMVINPU",236,0)
 ..S IENS="" F  S IENS=$O(XUARR(SUBFILE,IENS)) Q:IENS=""  D
"RTN","XUMVINPU",237,0)
 ...S IEN=$G(XUARR(SUBFILE,IENS,.03,"I"))
"RTN","XUMVINPU",238,0)
 ...D FIELD^DID(SUBFILE,SUBFLD,"","LABEL","FLDNM")
"RTN","XUMVINPU",239,0)
 ...S @XUGBL@(CNT)=FILE_";"_FLD_";"_SUBFLD_";8991.9^"_(FLDNM("LABEL"))_"^"_MCNT_"^"_IEN_"^"_$G(XUARR(SUBFILE,IENS,.03,"E")),CNT=CNT+1
"RTN","XUMVINPU",240,0)
 ...D FIELD^DID(SUBFILE,.02,"","LABEL","FLDNM")
"RTN","XUMVINPU",241,0)
 ...S @XUGBL@(CNT)=FILE_";"_FLD_";.02^"_(FLDNM("LABEL"))_"^"_MCNT_"^"_$G(XUARR(SUBFILE,IENS,.02,"I"))_"^"_$G(XUARR(SUBFILE,IENS,.02,"E")),CNT=CNT+1
"RTN","XUMVINPU",242,0)
 ...D GETS^DIQ(DEAFILE,IEN_",",DEAFLDS,"EI","DEAARR")  ;retrieve DEA data
"RTN","XUMVINPU",243,0)
 ...F I=1:1:DEAFLDCNT D
"RTN","XUMVINPU",244,0)
 ....S DEAFLD=$P(DEAFLDS,";",I)
"RTN","XUMVINPU",245,0)
 ....D FIELD^DID(DEAFILE,DEAFLD,"","LABEL","FLDNM")
"RTN","XUMVINPU",246,0)
 ....S @XUGBL@(CNT)=DEAFILE_";"_DEAFLD_"^"_(FLDNM("LABEL"))_"^"_MCNT_"^"_$G(DEAARR(DEAFILE,IEN_",",DEAFLD,"I"))_"^"_$G(DEAARR(DEAFILE,IEN_",",DEAFLD,"E")),CNT=CNT+1
"RTN","XUMVINPU",247,0)
 ...S MCNT=MCNT+1
"RTN","XUMVINPU",248,0)
 .;
"RTN","XUMVINPU",249,0)
 .I FLD=203 D  Q  ;secondary menu options multiple
"RTN","XUMVINPU",250,0)
 ..N IENS,MCNT,SUBFILE,SUBFLD
"RTN","XUMVINPU",251,0)
 ..S MCNT=1,SUBFILE=200.03,SUBFLD=.01
"RTN","XUMVINPU",252,0)
 ..D FIELD^DID(SUBFILE,SUBFLD,"","LABEL","FLDNM")
"RTN","XUMVINPU",253,0)
 ..I '$D(XUARR(SUBFILE)) S @XUGBL@(CNT)=FILE_";"_FLD_";"_SUBFLD_"^"_(FLDNM("LABEL"))_"^"_MCNT_"^^" S CNT=CNT+1 Q
"RTN","XUMVINPU",254,0)
 ..S IENS="" F  S IENS=$O(XUARR(SUBFILE,IENS)) Q:IENS=""  S @XUGBL@(CNT)=FILE_";"_FLD_";"_SUBFLD_"^"_(FLDNM("LABEL"))_"^"_MCNT_"^"_$G(XUARR(SUBFILE,IENS,SUBFLD,"I"))_"^"_$G(XUARR(SUBFILE,IENS,SUBFLD,"E")) S MCNT=MCNT+1,CNT=CNT+1
"RTN","XUMVINPU",255,0)
 .;
"RTN","XUMVINPU",256,0)
 .I FLD=8932.1 D  Q  ;PERSON CLASS multiple
"RTN","XUMVINPU",257,0)
 ..N IENS,MCNT,SUBFILE,SUBFLD
"RTN","XUMVINPU",258,0)
 ..S MCNT=1,SUBFILE=200.05
"RTN","XUMVINPU",259,0)
 ..I '$D(XUARR(SUBFILE)) D  Q  ;No Person Class(es)
"RTN","XUMVINPU",260,0)
 ...F SUBFLD=.01,2,3  D
"RTN","XUMVINPU",261,0)
 ....D FIELD^DID(SUBFILE,SUBFLD,"","LABEL","FLDNM")
"RTN","XUMVINPU",262,0)
 ....S @XUGBL@(CNT)=FILE_";"_FLD_";"_SUBFLD_"^"_(FLDNM("LABEL"))_"^"_MCNT_"^^",CNT=CNT+1
"RTN","XUMVINPU",263,0)
 ..S IENS="" F  S IENS=$O(XUARR(SUBFILE,IENS)) Q:IENS=""  D
"RTN","XUMVINPU",264,0)
 ...F SUBFLD=.01,2,3  D
"RTN","XUMVINPU",265,0)
 ....D FIELD^DID(SUBFILE,SUBFLD,"","LABEL","FLDNM")
"RTN","XUMVINPU",266,0)
 ....S @XUGBL@(CNT)=FILE_";"_FLD_";"_SUBFLD_"^"_(FLDNM("LABEL"))_"^"_MCNT_"^"_$G(XUARR(SUBFILE,IENS,SUBFLD,"I"))_"^"_$G(XUARR(SUBFILE,IENS,SUBFLD,"E")),CNT=CNT+1
"RTN","XUMVINPU",267,0)
 ...S MCNT=MCNT+1
"RTN","XUMVINPU",268,0)
 .;
"RTN","XUMVINPU",269,0)
 .S @XUGBL@(CNT)=FILE_";"_FLD_"^"_(FLDNM("LABEL"))_"^^"_XUARR(FILE,XUDUZ_",",FLD,"I")_"^"_XUARR(FILE,XUDUZ_",",FLD,"E") S CNT=CNT+1 ;all other fields
"RTN","XUMVINPU",270,0)
 ;
"RTN","XUMVINPU",271,0)
 S XURET=$NA(@XUGBL)
"RTN","XUMVINPU",272,0)
 Q
"RTN","XUMVINPU",273,0)
 ;
"RTN","XUMVINPU",274,0)
 ;
"RTN","XUMVINPU",275,0)
UPDATE(XURET,XUARR) ;rpc to update new person file data
"RTN","XUMVINPU",276,0)
 ;
"RTN","XUMVINPU",277,0)
 ; called from rpc: XUS MVI NEW PERSON UPDATE
"RTN","XUMVINPU",278,0)
 ;
"RTN","XUMVINPU",279,0)
 ; Input:
"RTN","XUMVINPU",280,0)
 ;   XUARR(#) = FILE #;FIELD #<;SUBFIELD #><;FILE POINTER>^FIELD NAME^<COUNTER #>^INTERNAL VALUE^EXTERNAL VALUE
"RTN","XUMVINPU",281,0)
 ;      <> Denotes optional values. If Counter populated, denotes multiple value <1-n>.
"RTN","XUMVINPU",282,0)
 ;   XUARR(0)="200;IEN^DUZ^^^"
"RTN","XUMVINPU",283,0)
 ;   XUARR(#)="200;.01^NAME^^^"
"RTN","XUMVINPU",284,0)
 ;   XUARR(#)="200;205.1^SECID^^"
"RTN","XUMVINPU",285,0)
 ;   XUARR(#)="200;205.2^SUBJECT ORGANIZATION^^^"
"RTN","XUMVINPU",286,0)
 ;   XUARR(#)="200;205.3^SUBJECT ORGANIZATION ID^^^"
"RTN","XUMVINPU",287,0)
 ;   XUARR(#)="200;205.4^UNIQUE USER ID^^^"
"RTN","XUMVINPU",288,0)
 ;   XUARR(#)="200;205.5^ADUPN^^^"
"RTN","XUMVINPU",289,0)
 ;   **711, Story 977821 (jfw) - Allow additional fields to be updated.
"RTN","XUMVINPU",290,0)
 ;   XUARR(#)="200;.151^EMAIL ADDRESS^^^"
"RTN","XUMVINPU",291,0)
 ;   XUARR(#)="200;501.1^NETWORK USERNAME^^^"
"RTN","XUMVINPU",292,0)
 ;
"RTN","XUMVINPU",293,0)
 ;  Success:
"RTN","XUMVINPU",294,0)
 ;   XURET(0) = 1
"RTN","XUMVINPU",295,0)
 ;
"RTN","XUMVINPU",296,0)
 ;  Fail:
"RTN","XUMVINPU",297,0)
 ;   XURET(0) = "-1^No data passed"
"RTN","XUMVINPU",298,0)
 ;   XURET(0) = "-1^Invalid User DUZ (null)"
"RTN","XUMVINPU",299,0)
 ;   XURET(0) = "-1^User '"_XUDUZ_"' does not exist"
"RTN","XUMVINPU",300,0)
 ;   XURET(0) = "-1^Invalid Name Component IEN"
"RTN","XUMVINPU",301,0)
 ;   XURET(0) = "-1^No Data for Name Component IEN: "_NCIEN
"RTN","XUMVINPU",302,0)
 ;   XURET(0) = "-1^No data to file for record '"_XUDUZ_"' in file 200"
"RTN","XUMVINPU",303,0)
 ;   XURET(0) = "-1^Unable to lock record '"_XUDUZ_"' in file 200" 
"RTN","XUMVINPU",304,0)
 ;   XURET(0) = "-1^"_$G(XUERR("DIERR",1,"TEXT",1))
"RTN","XUMVINPU",305,0)
 ;
"RTN","XUMVINPU",306,0)
 ; Example calling rpc from VistA:
"RTN","XUMVINPU",307,0)
 ;  >D UPDATE^XUMVINPU(.XURET,.XUARR)
"RTN","XUMVINPU",308,0)
 ;  >ZW XURET
"RTN","XUMVINPU",309,0)
 ;  >XURET(0)=1
"RTN","XUMVINPU",310,0)
 ;
"RTN","XUMVINPU",311,0)
 ;
"RTN","XUMVINPU",312,0)
 ; Example calling rpc from MVI:
"RTN","XUMVINPU",313,0)
 ;  D DIRECT^XWB2HL7(.XURET,SITE,"XUS MVI NEW PERSON UPDATE","",.XUARR)
"RTN","XUMVINPU",314,0)
 ;
"RTN","XUMVINPU",315,0)
 ;
"RTN","XUMVINPU",316,0)
 K XURET
"RTN","XUMVINPU",317,0)
 N ARR,FDA,FILENUM,FLDNAM,FLDNUM,IDATA,NCIEN,XUDUZ,XUERR
"RTN","XUMVINPU",318,0)
 ;
"RTN","XUMVINPU",319,0)
 I '$D(XUARR) S XURET(0)="-1^No data passed" Q
"RTN","XUMVINPU",320,0)
 ;
"RTN","XUMVINPU",321,0)
 S ARR="XUARR"
"RTN","XUMVINPU",322,0)
 F  S ARR=$Q(@ARR) Q:ARR=""  S FILENUM=+$P($P(@ARR,"^",1),";",1),FLDNUM=+$P($P(@ARR,"^",1),";",2),FLDNAM=$P(@ARR,"^",2),IDATA=$P(@ARR,"^",4) D  I $G(XURET) Q
"RTN","XUMVINPU",323,0)
 . I FLDNAM="DUZ" D  Q  ;first parameter passed
"RTN","XUMVINPU",324,0)
 . . S XUDUZ=IDATA ;duz ien
"RTN","XUMVINPU",325,0)
 . . I $G(XUDUZ)="" S XURET(0)="-1^Invalid User DUZ (null)" Q
"RTN","XUMVINPU",326,0)
 . . I '$D(^VA(FILENUM,XUDUZ,0)) S XURET(0)="-1^User '"_XUDUZ_"' does not exist"  Q
"RTN","XUMVINPU",327,0)
 . I FLDNAM="NAME COMPONENTS" D  Q
"RTN","XUMVINPU",328,0)
 . . S NCIEN=IDATA ;name component ien
"RTN","XUMVINPU",329,0)
 . . I $G(NCIEN)="" S XURET(0)="-1^Invalid Name Component IEN"
"RTN","XUMVINPU",330,0)
 . . I '$D(^VA(20,NCIEN,0)) S XURET(0)="-1^No Data for Name Componet IEN: "_NCIEN
"RTN","XUMVINPU",331,0)
 . S FDA(FILENUM,$S(FILENUM=200:+$G(XUDUZ),1:+$G(NCIEN))_",",FLDNUM)=IDATA
"RTN","XUMVINPU",332,0)
 ;
"RTN","XUMVINPU",333,0)
 I '$D(FDA) S XURET(0)="-1^No data to file for record '"_XUDUZ_"' in file 200" Q
"RTN","XUMVINPU",334,0)
 ;
"RTN","XUMVINPU",335,0)
 L +^VA(200,XUDUZ):10 I '$T S XURET(0)="-1^Unable to lock record '"_XUDUZ_"' in file 200" Q
"RTN","XUMVINPU",336,0)
 D FILE^DIE(,"FDA","XUERR") I $D(XUERR("DIERR")) S XURET(0)="-1^"_$G(XUERR("DIERR",1,"TEXT",1)) Q
"RTN","XUMVINPU",337,0)
 L -^VA(200,XUDUZ)
"RTN","XUMVINPU",338,0)
 ;
"RTN","XUMVINPU",339,0)
 S XURET(0)=1 ;successfully filed
"RTN","XUMVINPU",340,0)
 Q
"RTN","XUMVINPU",341,0)
 ;
"VER")
8.0^22.2
"BLD",3410,6)
^551
**END**
**END**

