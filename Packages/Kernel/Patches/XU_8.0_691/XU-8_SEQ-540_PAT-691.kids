Released XU*8*691 SEQ #540
Extracted from mail message
**KIDS**:XU*8.0*691^

**INSTALL NAME**
XU*8.0*691
"BLD",3301,0)
XU*8.0*691^KERNEL^0^3180321^y
"BLD",3301,1,0)
^9.61A^3^3^3180321^^^
"BLD",3301,1,1,0)
KERNEL VISTA PATCH ENHANCEMENTS - RPCS FOR NEW PERSON FILE
"BLD",3301,1,2,0)
Refer to patch XU*8.0*691 in the FORUM Patch Module for a complete
"BLD",3301,1,3,0)
description.
"BLD",3301,4,0)
^9.64PA^^
"BLD",3301,6.3)
2
"BLD",3301,"ABPKG")
n
"BLD",3301,"KRN",0)
^9.67PA^779.2^20
"BLD",3301,"KRN",.4,0)
.4
"BLD",3301,"KRN",.401,0)
.401
"BLD",3301,"KRN",.402,0)
.402
"BLD",3301,"KRN",.403,0)
.403
"BLD",3301,"KRN",.5,0)
.5
"BLD",3301,"KRN",.84,0)
.84
"BLD",3301,"KRN",3.6,0)
3.6
"BLD",3301,"KRN",3.8,0)
3.8
"BLD",3301,"KRN",9.2,0)
9.2
"BLD",3301,"KRN",9.8,0)
9.8
"BLD",3301,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",3301,"KRN",9.8,"NM",1,0)
XUMVINPU^^0^B42823064
"BLD",3301,"KRN",9.8,"NM","B","XUMVINPU",1)

"BLD",3301,"KRN",19,0)
19
"BLD",3301,"KRN",19.1,0)
19.1
"BLD",3301,"KRN",101,0)
101
"BLD",3301,"KRN",409.61,0)
409.61
"BLD",3301,"KRN",771,0)
771
"BLD",3301,"KRN",779.2,0)
779.2
"BLD",3301,"KRN",870,0)
870
"BLD",3301,"KRN",8989.51,0)
8989.51
"BLD",3301,"KRN",8989.52,0)
8989.52
"BLD",3301,"KRN",8994,0)
8994
"BLD",3301,"KRN",8994,"NM",0)
^9.68A^2^2
"BLD",3301,"KRN",8994,"NM",1,0)
XUS MVI NEW PERSON GET^^0
"BLD",3301,"KRN",8994,"NM",2,0)
XUS MVI NEW PERSON UPDATE^^0
"BLD",3301,"KRN",8994,"NM","B","XUS MVI NEW PERSON GET",1)

"BLD",3301,"KRN",8994,"NM","B","XUS MVI NEW PERSON UPDATE",2)

"BLD",3301,"KRN","B",.4,.4)

"BLD",3301,"KRN","B",.401,.401)

"BLD",3301,"KRN","B",.402,.402)

"BLD",3301,"KRN","B",.403,.403)

"BLD",3301,"KRN","B",.5,.5)

"BLD",3301,"KRN","B",.84,.84)

"BLD",3301,"KRN","B",3.6,3.6)

"BLD",3301,"KRN","B",3.8,3.8)

"BLD",3301,"KRN","B",9.2,9.2)

"BLD",3301,"KRN","B",9.8,9.8)

"BLD",3301,"KRN","B",19,19)

"BLD",3301,"KRN","B",19.1,19.1)

"BLD",3301,"KRN","B",101,101)

"BLD",3301,"KRN","B",409.61,409.61)

"BLD",3301,"KRN","B",771,771)

"BLD",3301,"KRN","B",779.2,779.2)

"BLD",3301,"KRN","B",870,870)

"BLD",3301,"KRN","B",8989.51,8989.51)

"BLD",3301,"KRN","B",8989.52,8989.52)

"BLD",3301,"KRN","B",8994,8994)

"BLD",3301,"QUES",0)
^9.62^^
"BLD",3301,"REQB",0)
^9.611^^
"KRN",8994,718,-1)
0^1
"KRN",8994,718,0)
XUS MVI NEW PERSON GET^GET^XUMVINPU^4^A^^^1^1^^0
"KRN",8994,718,1,0)
^8994.01^2^2^3180321^^^^
"KRN",8994,718,1,1,0)
This restricted RPC is used exclusively by the Master Veteran Index (MVI) 
"KRN",8994,718,1,2,0)
to retrieve data (by DUZ or SECID) from the VistA NEW PERSON file (#200).
"KRN",8994,718,2,0)
^8994.02A^2^2
"KRN",8994,718,2,1,0)
DUZ^1^40^0^1
"KRN",8994,718,2,1,1,0)
^8994.021^1^1^3180309^^
"KRN",8994,718,2,1,1,1,0)
File IEN in the NEW PERSON file (#200)
"KRN",8994,718,2,2,0)
SECID^1^40^0^2
"KRN",8994,718,2,2,1,0)
^8994.021^1^1^3180321^^^^
"KRN",8994,718,2,2,1,1,0)
SECID field (#205.1) in the NEW PERSON file (#200)
"KRN",8994,718,2,"B","DUZ",1)

"KRN",8994,718,2,"B","SECID",2)

"KRN",8994,718,2,"PARAMSEQ",1,1)

"KRN",8994,718,2,"PARAMSEQ",2,2)

"KRN",8994,718,3,0)
^^47^47^3180321^
"KRN",8994,718,3,1,0)
 Success:
"KRN",8994,718,3,2,0)
  XURET = ^TMP("XUMVINPU",$J)
"KRN",8994,718,3,3,0)
   @XURET@(#) = FILE #;FIELD #^FIELD NAME^INTERNAL VALUE^EXTERNAL VALUE
"KRN",8994,718,3,4,0)
   @XURET@(1)="200;IEN^DUZ^^"
"KRN",8994,718,3,5,0)
   @XURET@(2)="200;.01^NAME^^"
"KRN",8994,718,3,6,0)
   @XURET@(3)="200;7^DISUSER^^"
"KRN",8994,718,3,7,0)
   @XURET@(4)="200;9.2^TERMINATION DATE^^"
"KRN",8994,718,3,8,0)
   @XURET@(5)="200;9.4^Termination Reason^^"
"KRN",8994,718,3,9,0)
   @XURET@(6)="200;15^PROHIBITED TIMES FOR SIGN-ON^^"
"KRN",8994,718,3,10,0)
   @XURET@(7)="200;11.2^DATE VERIFY CODE LAST CHANGED^^"
"KRN",8994,718,3,11,0)
   @XURET@(8)="200;.111^STREET ADDRESS 1^^"
"KRN",8994,718,3,12,0)
   @XURET@(9)="200;.132^OFFICE PHONE^^"
"KRN",8994,718,3,13,0)
   @XURET@(10)="200;.151^EMAIL ADDRESS^^"
"KRN",8994,718,3,14,0)
   @XURET@(11)="200;30^DATE ENTERED^^"
"KRN",8994,718,3,15,0)
   @XURET@(12)="200;31^CREATOR^^"
"KRN",8994,718,3,16,0)
   @XURET@(13)="200;9^SSN^^"
"KRN",8994,718,3,17,0)
   @XURET@(14)="200;202^LAST SIGN-ON DATE/TIME^"
"KRN",8994,718,3,18,0)
   @XURET@(15)="200;202.02^XUS Logon Attempt Count^^"
"KRN",8994,718,3,19,0)
   @XURET@(16)="200;202.03^XUS Active User^^"
"KRN",8994,718,3,20,0)
   @XURET@(17)="200;202.04^Entry Last Edit Date^^"
"KRN",8994,718,3,21,0)
   @XURET@(18)="200;202.05^LOCKOUT USER UNTIL^^"
"KRN",8994,718,3,22,0)
   @XURET@(19)="200.02;.01^DIVISION^1^^"
"KRN",8994,718,3,23,0)
   @XURET@(20)="200.02;.01^DIVISION^2
"KRN",8994,718,3,24,0)
   @XURET@(21)="200;10.1^NAME COMPONENTS^^"
"KRN",8994,718,3,25,0)
   @XURET@(22)="20;1^FAMILY (LAST) NAME^^"
"KRN",8994,718,3,26,0)
   @XURET@(23)="20;2^GIVEN (FIRST) NAME^^"
"KRN",8994,718,3,27,0)
   @XURET@(24)="20;3^MIDDLE NAME^^"
"KRN",8994,718,3,28,0)
   @XURET@(25)="20;4^PREFIX^^"
"KRN",8994,718,3,29,0)
   @XURET@(26)="20;5^SUFFIX^^"
"KRN",8994,718,3,30,0)
   @XURET@(27)="20;6^DEGREE^^"
"KRN",8994,718,3,31,0)
   @XURET@(28)="200;29^SERVICE/SECTION^^"
"KRN",8994,718,3,32,0)
   @XURET@(29)="200;201^PRIMARY MENU OPTION^^"
"KRN",8994,718,3,33,0)
   @XURET@(30)="200.03;.01^SECONDARY MENU OPTIONS^1^^"
"KRN",8994,718,3,34,0)
   @XURET@(31)="200.03;.01^SECONDARY MENU OPTIONS^2^^"
"KRN",8994,718,3,35,0)
   @XURET@(32)="200.03;.01^SECONDARY MENU OPTIONS^3^^"
"KRN",8994,718,3,36,0)
   @XURET@(33)="200;205.1^SECID^^"
"KRN",8994,718,3,37,0)
   @XURET@(34)="200;205.2^SUBJECT ORGANIZATION^^"
"KRN",8994,718,3,38,0)
   @XURET@(35)="200;205.3^SUBJECT ORGANIZATION ID^^"
"KRN",8994,718,3,39,0)
   @XURET@(36)="200;205.4^UNIQUE USER ID^^"
"KRN",8994,718,3,40,0)
   @XURET@(37)="200;205.5^ADUPN^^"
"KRN",8994,718,3,41,0)
   @XURET@(38)="200;501.1^NETWORK USERNAME^^"
"KRN",8994,718,3,42,0)
 
"KRN",8994,718,3,43,0)
 Fail:
"KRN",8994,718,3,44,0)
  XURET = ^TMP("XUMVINPU",$J)
"KRN",8994,718,3,45,0)
  @XURET@(1)="-1^Invalid User"
"KRN",8994,718,3,46,0)
           or
"KRN",8994,718,3,47,0)
  @XURET@(1)="-1^No Data for User: ######"
"KRN",8994,721,-1)
0^2
"KRN",8994,721,0)
XUS MVI NEW PERSON UPDATE^UPDATE^XUMVINPU^1^A^^^^1^^0
"KRN",8994,721,1,0)
^8994.01^2^2^3180309^^
"KRN",8994,721,1,1,0)
This restricted RPC is used exclusively by the Master Veteran Index (MVI) 
"KRN",8994,721,1,2,0)
to update an entry (by DUZ) in the VistA NEW PERSON file (#200).
"KRN",8994,721,2,0)
^8994.02A^2^1
"KRN",8994,721,2,2,0)
XUARR^2^255^1^1
"KRN",8994,721,2,2,1,0)
^8994.021^11^11^3180309^^^^
"KRN",8994,721,2,2,1,1,0)
The IEN (DUZ) for the NEW PERSON (#200) file is required to file the other
"KRN",8994,721,2,2,1,2,0)
fields.
"KRN",8994,721,2,2,1,3,0)
 
"KRN",8994,721,2,2,1,4,0)
  XUARR(#) = FILE #;FIELD #^FIELD NAME^INTERNAL VALUE^EXTERNAL VALUE
"KRN",8994,721,2,2,1,5,0)
  XUARR(0)="200;IEN^DUZ^^"
"KRN",8994,721,2,2,1,6,0)
  XUARR(#)="200;.01^NAME^^"
"KRN",8994,721,2,2,1,7,0)
  XUARR(#)="200;205.1^SECID^^"
"KRN",8994,721,2,2,1,8,0)
  XUARR(#)="200;205.2^SUBJECT ORGANIZATION^^"
"KRN",8994,721,2,2,1,9,0)
  XUARR(#)="200;205.3^SUBJECT ORGANIZATION ID^^"
"KRN",8994,721,2,2,1,10,0)
  XUARR(#)="200;205.4^UNIQUE USER ID^^"
"KRN",8994,721,2,2,1,11,0)
  XUARR(#)="200;205.5^ADUPN^^"
"KRN",8994,721,2,"B","XUARR",2)

"KRN",8994,721,2,"PARAMSEQ",1,2)

"KRN",8994,721,3,0)
^^12^12^3180312^
"KRN",8994,721,3,1,0)
  Success:
"KRN",8994,721,3,2,0)
   XURET(0) = 1
"KRN",8994,721,3,3,0)
 
"KRN",8994,721,3,4,0)
  Fail:
"KRN",8994,721,3,5,0)
   XURET(0) = "-1^No data passed"
"KRN",8994,721,3,6,0)
   XURET(0) = "-1^Invalid User DUZ (null)"
"KRN",8994,721,3,7,0)
   XURET(0) = "-1^User '"_XUDUZ_"' does not exist"
"KRN",8994,721,3,8,0)
   XURET(0) = "-1^Invalid Name Component IEN"
"KRN",8994,721,3,9,0)
   XURET(0) = "-1^No Data for Name Component IEN: "_NCIEN
"KRN",8994,721,3,10,0)
   XURET(0) = "-1^No data to file for record '"_XUDUZ_"' in file 200 
"KRN",8994,721,3,11,0)
   XURET(0) = "-1^Unable to lock record '"_XUDUZ_"' in file 200" 
"KRN",8994,721,3,12,0)
   XURET(0) = "-1^"_$G(XUERR("DIERR",1,"TEXT",1))
"MBREQ")
0
"ORD",16,8994)
8994;16;1;;;;;;;RPCDEL^XPDIA1
"ORD",16,8994,0)
REMOTE PROCEDURE
"PKG",138,-1)
1^1
"PKG",138,0)
KERNEL^XU^SIGN-ON, SECURITY, MENU DRIVER, DEVICES, TASKMAN^
"PKG",138,22,0)
^9.49I^1^1
"PKG",138,22,1,0)
8.0^2950703^2951127^12541
"PKG",138,22,1,"PAH",1,0)
691^3180321
"PKG",138,22,1,"PAH",1,1,0)
^^3^3^3180321
"PKG",138,22,1,"PAH",1,1,1,0)
KERNEL VISTA PATCH ENHANCEMENTS - RPCS FOR NEW PERSON FILE
"PKG",138,22,1,"PAH",1,1,2,0)
Refer to patch XU*8.0*691 in the FORUM Patch Module for a complete
"PKG",138,22,1,"PAH",1,1,3,0)
description.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","XUMVINPU")
0^1^B42823064^n/a
"RTN","XUMVINPU",1,0)
XUMVINPU ;MVI/DRI - Master Veteran Index New Person Utilities ;3/21/18  10:15
"RTN","XUMVINPU",2,0)
 ;;8.0;KERNEL;**691**;Jul 10, 1995;Build 2
"RTN","XUMVINPU",3,0)
 ;
"RTN","XUMVINPU",4,0)
GET(XURET,XUDUZ,SECID) ;rpc to retrieve new person file data
"RTN","XUMVINPU",5,0)
 ; 
"RTN","XUMVINPU",6,0)
 ; called from rpc: XUS MVI NEW PERSON GET
"RTN","XUMVINPU",7,0)
 ;
"RTN","XUMVINPU",8,0)
 ; Input:
"RTN","XUMVINPU",9,0)
 ;  XUDUZ = NEW PERSON IEN
"RTN","XUMVINPU",10,0)
 ;            or
"RTN","XUMVINPU",11,0)
 ;  SECID = SECURITY ID
"RTN","XUMVINPU",12,0)
 ;
"RTN","XUMVINPU",13,0)
 ; Output:
"RTN","XUMVINPU",14,0)
 ;  Success:
"RTN","XUMVINPU",15,0)
 ;   XURET = ^TMP("XUMVINPU",$J)
"RTN","XUMVINPU",16,0)
 ;    @XURET@(#) = FILE #;FIELD #^FIELD NAME^INTERNAL VALUE^EXTERNAL VALUE
"RTN","XUMVINPU",17,0)
 ;    @XURET@(1)="200;IEN^DUZ^^"
"RTN","XUMVINPU",18,0)
 ;    @XURET@(2)="200;.01^NAME^^"
"RTN","XUMVINPU",19,0)
 ;    @XURET@(3)="200;7^DISUSER^^"
"RTN","XUMVINPU",20,0)
 ;    @XURET@(4)="200;9.2^TERMINATION DATE^^"
"RTN","XUMVINPU",21,0)
 ;    @XURET@(5)="200;9.4^Termination Reason^^"
"RTN","XUMVINPU",22,0)
 ;    @XURET@(6)="200;15^PROHIBITED TIMES FOR SIGN-ON^^"
"RTN","XUMVINPU",23,0)
 ;    @XURET@(7)="200;11.2^DATE VERIFY CODE LAST CHANGED^^"
"RTN","XUMVINPU",24,0)
 ;    @XURET@(8)="200;.111^STREET ADDRESS 1^^"
"RTN","XUMVINPU",25,0)
 ;    @XURET@(9)="200;.132^OFFICE PHONE^^"
"RTN","XUMVINPU",26,0)
 ;    @XURET@(10)="200;.151^EMAIL ADDRESS^^"
"RTN","XUMVINPU",27,0)
 ;    @XURET@(11)="200;30^DATE ENTERED^^"
"RTN","XUMVINPU",28,0)
 ;    @XURET@(12)="200;31^CREATOR^^"
"RTN","XUMVINPU",29,0)
 ;    @XURET@(13)="200;9^SSN^^"
"RTN","XUMVINPU",30,0)
 ;    @XURET@(14)="200;202^LAST SIGN-ON DATE/TIME^^"
"RTN","XUMVINPU",31,0)
 ;    @XURET@(15)="200;202.02^XUS Logon Attempt Count^^"
"RTN","XUMVINPU",32,0)
 ;    @XURET@(16)="200;202.03^XUS Active User^^"
"RTN","XUMVINPU",33,0)
 ;    @XURET@(17)="200;202.04^Entry Last Edit Date^^"
"RTN","XUMVINPU",34,0)
 ;    @XURET@(18)="200;202.05^LOCKOUT USER UNTIL^^"
"RTN","XUMVINPU",35,0)
 ;    @XURET@(19)="200.02;.01^DIVISION^1^^"
"RTN","XUMVINPU",36,0)
 ;    @XURET@(20)="200.02;.01^DIVISION^2
"RTN","XUMVINPU",37,0)
 ;    @XURET@(21)="200;10.1^NAME COMPONENTS^^"
"RTN","XUMVINPU",38,0)
 ;    @XURET@(22)="20;1^FAMILY (LAST) NAME^^"
"RTN","XUMVINPU",39,0)
 ;    @XURET@(23)="20;2^GIVEN (FIRST) NAME^^"
"RTN","XUMVINPU",40,0)
 ;    @XURET@(24)="20;3^MIDDLE NAME^^"
"RTN","XUMVINPU",41,0)
 ;    @XURET@(25)="20;4^PREFIX^^"
"RTN","XUMVINPU",42,0)
 ;    @XURET@(26)="20;5^SUFFIX^^"
"RTN","XUMVINPU",43,0)
 ;    @XURET@(27)="20;6^DEGREE^^"
"RTN","XUMVINPU",44,0)
 ;    @XURET@(28)="200;29^SERVICE/SECTION^^"
"RTN","XUMVINPU",45,0)
 ;    @XURET@(29)="200;201^PRIMARY MENU OPTION^^"
"RTN","XUMVINPU",46,0)
 ;    @XURET@(30)="200.03;.01^SECONDARY MENU OPTIONS^1^^"
"RTN","XUMVINPU",47,0)
 ;    @XURET@(31)="200.03;.01^SECONDARY MENU OPTIONS^2^^"
"RTN","XUMVINPU",48,0)
 ;    @XURET@(32)="200.03;.01^SECONDARY MENU OPTIONS^3^^"
"RTN","XUMVINPU",49,0)
 ;    @XURET@(33)="200;205.1^SECID^^"
"RTN","XUMVINPU",50,0)
 ;    @XURET@(34)="200;205.2^SUBJECT ORGANIZATION^^"
"RTN","XUMVINPU",51,0)
 ;    @XURET@(35)="200;205.3^SUBJECT ORGANIZATION ID^^"
"RTN","XUMVINPU",52,0)
 ;    @XURET@(36)="200;205.4^UNIQUE USER ID^^"
"RTN","XUMVINPU",53,0)
 ;    @XURET@(37)="200;205.5^ADUPN^^"
"RTN","XUMVINPU",54,0)
 ;    @XURET@(38)="200;501.1^NETWORK USERNAME^^"
"RTN","XUMVINPU",55,0)
 ;
"RTN","XUMVINPU",56,0)
 ;  Fail:
"RTN","XUMVINPU",57,0)
 ;   XURET = ^TMP("XUMVINPU",$J)
"RTN","XUMVINPU",58,0)
 ;   @XURET@(1)="-1^Invalid User"
"RTN","XUMVINPU",59,0)
 ;            or
"RTN","XUMVINPU",60,0)
 ;   @XURET@(1)="-1^No Data for User: ######"
"RTN","XUMVINPU",61,0)
 ;
"RTN","XUMVINPU",62,0)
 ; Example calling rpc from VistA:
"RTN","XUMVINPU",63,0)
 ;  >D GET^XUMVINPU(.XURET,12596)
"RTN","XUMVINPU",64,0)
 ;  >ZW XURET
"RTN","XUMVINPU",65,0)
 ;  >XURET="^TMP(""XUMVINPU"",17226)"
"RTN","XUMVINPU",66,0)
 ;
"RTN","XUMVINPU",67,0)
 ;  D ^%G would return:
"RTN","XUMVINPU",68,0)
 ;    ^TMP("XUMVINPU",17226,1)="200;IEN^DUZ^12596^12596"
"RTN","XUMVINPU",69,0)
 ;                          2)="200;.01^NAME^LAST,FIRST^LAST,FIRST"
"RTN","XUMVINPU",70,0)
 ;                          3)="200;7^DISUSER^^"
"RTN","XUMVINPU",71,0)
 ;                          #)=continuation of returned data
"RTN","XUMVINPU",72,0)
 ;
"RTN","XUMVINPU",73,0)
 ; Example calling rpc from MVI:
"RTN","XUMVINPU",74,0)
 ;  D DIRECT^XWB2HL7(.XURET,SITE,"XUS MVI NEW PERSON GET","",$G(XUDUZ),$G(SECID))
"RTN","XUMVINPU",75,0)
 ;
"RTN","XUMVINPU",76,0)
 ;
"RTN","XUMVINPU",77,0)
 K XURET
"RTN","XUMVINPU",78,0)
 N CNT,FILE,FLD,FLDNM,XUARR,XUGBL
"RTN","XUMVINPU",79,0)
 S XUGBL="^TMP("_"""XUMVINPU"""_","_$J_")"
"RTN","XUMVINPU",80,0)
 K @XUGBL
"RTN","XUMVINPU",81,0)
 ;
"RTN","XUMVINPU",82,0)
 S CNT=1,FILE=200
"RTN","XUMVINPU",83,0)
 I $G(SECID)'="" S XUDUZ=$O(^VA(FILE,"ASECID",SECID,0))
"RTN","XUMVINPU",84,0)
 I $G(XUDUZ)="" S @XUGBL@(CNT)="-1^Invalid User" S XURET=$NA(@XUGBL) Q
"RTN","XUMVINPU",85,0)
 I '$D(^VA(FILE,XUDUZ)) S @XUGBL@(CNT)="-1^No Data for User: "_XUDUZ S XURET=$NA(@XUGBL) Q
"RTN","XUMVINPU",86,0)
 ;
"RTN","XUMVINPU",87,0)
 S @XUGBL@(CNT)=FILE_";IEN^DUZ^"_XUDUZ_"^"_XUDUZ S CNT=CNT+1
"RTN","XUMVINPU",88,0)
 ;
"RTN","XUMVINPU",89,0)
 D GETS^DIQ(FILE,+XUDUZ_",",".01;7;9.2;9.4;15;11.2;.111;.132;.151;30;31;9;202;202.02;202.03;202.04;202.05;16*;10.1;29;201;203*;205.1;205.2;205.3;205.4;205.5;501.1","EI","XUARR") ;retrieve data
"RTN","XUMVINPU",90,0)
 ;
"RTN","XUMVINPU",91,0)
 F FLD=.01,7,9.2,9.4,15,11.2,.111,.132,.151,30,31,9,202,202.02,202.03,202.04,202.05,16,10.1,29,201,203,205.1,205.2,205.3,205.4,205.5,501.1 D
"RTN","XUMVINPU",92,0)
 . D FIELD^DID(FILE,FLD,"","LABEL","FLDNM")
"RTN","XUMVINPU",93,0)
 . ;
"RTN","XUMVINPU",94,0)
 . I FLD=16 D  Q  ;division multiple
"RTN","XUMVINPU",95,0)
 . . N IENS,MCNT,SUBFILE,SUBFLD
"RTN","XUMVINPU",96,0)
 . . S MCNT=1,SUBFILE=200.02,SUBFLD=.01
"RTN","XUMVINPU",97,0)
 . . D FIELD^DID(SUBFILE,SUBFLD,"","LABEL","FLDNM")
"RTN","XUMVINPU",98,0)
 . . I '$D(XUARR(SUBFILE)) S @XUGBL@(CNT)=SUBFILE_";"_SUBFLD_"^"_(FLDNM("LABEL"))_"^"_MCNT_"^^" S CNT=CNT+1 Q
"RTN","XUMVINPU",99,0)
 . . S IENS="" F  S IENS=$O(XUARR(SUBFILE,IENS)) Q:IENS=""  S @XUGBL@(CNT)=SUBFILE_";"_SUBFLD_"^"_(FLDNM("LABEL"))_"^"_MCNT_"^"_$G(XUARR(SUBFILE,IENS,SUBFLD,"I"))_"^"_$G(XUARR(SUBFILE,IENS,SUBFLD,"E")) S MCNT=MCNT+1,CNT=CNT+1
"RTN","XUMVINPU",100,0)
 . ;
"RTN","XUMVINPU",101,0)
 . I FLD=10.1 D  Q  ;name components
"RTN","XUMVINPU",102,0)
 . . S @XUGBL@(CNT)=FILE_";"_FLD_"^"_(FLDNM("LABEL"))_"^"_$G(XUARR(FILE,XUDUZ_",",FLD,"I"))_"^"_$G(XUARR(FILE,XUDUZ_",",FLD,"E")) S CNT=CNT+1
"RTN","XUMVINPU",103,0)
 . . N NCFILE,NCFLD
"RTN","XUMVINPU",104,0)
 . . S NCFILE=20
"RTN","XUMVINPU",105,0)
 . . D GETS^DIQ(NCFILE,+$G(XUARR(FILE,XUDUZ_",",FLD,"I"))_",","1;2;3;4;5;6","EI","XUARR") ;retrieve name component data
"RTN","XUMVINPU",106,0)
 . . F NCFLD=1,2,3,4,5,6 D
"RTN","XUMVINPU",107,0)
 . . . D FIELD^DID(NCFILE,NCFLD,"","LABEL","FLDNM")
"RTN","XUMVINPU",108,0)
 . . . S @XUGBL@(CNT)=NCFILE_";"_NCFLD_"^"_(FLDNM("LABEL"))_"^"_XUARR(NCFILE,+$G(XUARR(FILE,XUDUZ_",",FLD,"I"))_",",NCFLD,"I")_"^"_XUARR(NCFILE,+$G(XUARR(FILE,XUDUZ_",",FLD,"I"))_",",NCFLD,"E") S CNT=CNT+1
"RTN","XUMVINPU",109,0)
 . ;
"RTN","XUMVINPU",110,0)
 . I FLD=203 D  Q  ;secondary menu options multiple
"RTN","XUMVINPU",111,0)
 . . N IENS,MCNT,SUBFILE,SUBFLD
"RTN","XUMVINPU",112,0)
 . . S MCNT=1,SUBFILE=200.03,SUBFLD=.01
"RTN","XUMVINPU",113,0)
 . . D FIELD^DID(SUBFILE,SUBFLD,"","LABEL","FLDNM")
"RTN","XUMVINPU",114,0)
 . . I '$D(XUARR(SUBFILE)) S @XUGBL@(CNT)=SUBFILE_";"_SUBFLD_"^"_(FLDNM("LABEL"))_"^"_MCNT_"^^" S CNT=CNT+1 Q
"RTN","XUMVINPU",115,0)
 . . S IENS="" F  S IENS=$O(XUARR(SUBFILE,IENS)) Q:IENS=""  S @XUGBL@(CNT)=SUBFILE_";"_SUBFLD_"^"_(FLDNM("LABEL"))_"^"_MCNT_"^"_$G(XUARR(SUBFILE,IENS,SUBFLD,"I"))_"^"_$G(XUARR(SUBFILE,IENS,SUBFLD,"E")) S MCNT=MCNT+1,CNT=CNT+1
"RTN","XUMVINPU",116,0)
 . ;
"RTN","XUMVINPU",117,0)
 . S @XUGBL@(CNT)=FILE_";"_FLD_"^"_(FLDNM("LABEL"))_"^"_XUARR(FILE,XUDUZ_",",FLD,"I")_"^"_XUARR(FILE,XUDUZ_",",FLD,"E") S CNT=CNT+1 ;all other fields
"RTN","XUMVINPU",118,0)
 ;
"RTN","XUMVINPU",119,0)
 S XURET=$NA(@XUGBL)
"RTN","XUMVINPU",120,0)
 Q
"RTN","XUMVINPU",121,0)
 ;
"RTN","XUMVINPU",122,0)
 ;
"RTN","XUMVINPU",123,0)
UPDATE(XURET,XUARR) ;rpc to update new person file data
"RTN","XUMVINPU",124,0)
 ;
"RTN","XUMVINPU",125,0)
 ; called from rpc: XUS MVI NEW PERSON UPDATE
"RTN","XUMVINPU",126,0)
 ;
"RTN","XUMVINPU",127,0)
 ; Input:
"RTN","XUMVINPU",128,0)
 ;   XUARR(#) = FILE #;FIELD #^FIELD NAME^INTERNAL VALUE^EXTERNAL VALUE
"RTN","XUMVINPU",129,0)
 ;   XUARR(0)="200;IEN^DUZ^^"
"RTN","XUMVINPU",130,0)
 ;   XUARR(#)="200;.01^NAME^^"
"RTN","XUMVINPU",131,0)
 ;   XUARR(#)="200;205.1^SECID^^"
"RTN","XUMVINPU",132,0)
 ;   XUARR(#)="200;205.2^SUBJECT ORGANIZATION^^"
"RTN","XUMVINPU",133,0)
 ;   XUARR(#)="200;205.3^SUBJECT ORGANIZATION ID^^"
"RTN","XUMVINPU",134,0)
 ;   XUARR(#)="200;205.4^UNIQUE USER ID^^"
"RTN","XUMVINPU",135,0)
 ;   XUARR(#)="200;205.5^ADUPN^^"
"RTN","XUMVINPU",136,0)
 ;
"RTN","XUMVINPU",137,0)
 ;  Success:
"RTN","XUMVINPU",138,0)
 ;   XURET(0) = 1
"RTN","XUMVINPU",139,0)
 ;
"RTN","XUMVINPU",140,0)
 ;  Fail:
"RTN","XUMVINPU",141,0)
 ;   XURET(0) = "-1^No data passed"
"RTN","XUMVINPU",142,0)
 ;   XURET(0) = "-1^Invalid User DUZ (null)"
"RTN","XUMVINPU",143,0)
 ;   XURET(0) = "-1^User '"_XUDUZ_"' does not exist"
"RTN","XUMVINPU",144,0)
 ;   XURET(0) = "-1^Invalid Name Component IEN"
"RTN","XUMVINPU",145,0)
 ;   XURET(0) = "-1^No Data for Name Componet IEN: "_NCIEN
"RTN","XUMVINPU",146,0)
 ;   XURET(0) = "-1^No data to file for record '"_XUDUZ_"' in file 200"
"RTN","XUMVINPU",147,0)
 ;   XURET(0) = "-1^Unable to lock record '"_XUDUZ_"' in file 200" 
"RTN","XUMVINPU",148,0)
 ;   XURET(0) = "-1^"_$G(XUERR("DIERR",1,"TEXT",1))
"RTN","XUMVINPU",149,0)
 ;
"RTN","XUMVINPU",150,0)
 ; Example calling rpc from VistA:
"RTN","XUMVINPU",151,0)
 ;  >D UPDATE^XUMVINPU(.XURET,.XUARR)
"RTN","XUMVINPU",152,0)
 ;  >ZW XURET
"RTN","XUMVINPU",153,0)
 ;  >XURET(0)=1
"RTN","XUMVINPU",154,0)
 ;
"RTN","XUMVINPU",155,0)
 ;
"RTN","XUMVINPU",156,0)
 ; Example calling rpc from MVI:
"RTN","XUMVINPU",157,0)
 ;  D DIRECT^XWB2HL7(.XURET,SITE,"XUS MVI NEW PERSON UPDATE","",.XUARR)
"RTN","XUMVINPU",158,0)
 ;
"RTN","XUMVINPU",159,0)
 ;
"RTN","XUMVINPU",160,0)
 K XURET
"RTN","XUMVINPU",161,0)
 N ARR,FDA,FILENUM,FLDNAM,FLDNUM,IDATA,NCIEN,XUDUZ,XUERR
"RTN","XUMVINPU",162,0)
 ;
"RTN","XUMVINPU",163,0)
 I '$D(XUARR) S XURET(0)="-1^No data passed" Q
"RTN","XUMVINPU",164,0)
 ;
"RTN","XUMVINPU",165,0)
 S ARR="XUARR"
"RTN","XUMVINPU",166,0)
 F  S ARR=$Q(@ARR) Q:ARR=""  S FILENUM=+$P($P(@ARR,"^",1),";",1),FLDNUM=+$P($P(@ARR,"^",1),";",2),FLDNAM=$P(@ARR,"^",2),IDATA=$P(@ARR,"^",3) D  I $G(XURET) Q
"RTN","XUMVINPU",167,0)
 . I FLDNAM="DUZ" D  Q  ;first parameter passed
"RTN","XUMVINPU",168,0)
 . . S XUDUZ=IDATA ;duz ien
"RTN","XUMVINPU",169,0)
 . . I $G(XUDUZ)="" S XURET(0)="-1^Invalid User DUZ (null)" Q
"RTN","XUMVINPU",170,0)
 . . I '$D(^VA(FILENUM,XUDUZ,0)) S XURET(0)="-1^User '"_XUDUZ_"' does not exist"  Q
"RTN","XUMVINPU",171,0)
 . I FLDNAM="NAME COMPONENTS" D  Q
"RTN","XUMVINPU",172,0)
 . . S NCIEN=IDATA ;name component ien
"RTN","XUMVINPU",173,0)
 . . I $G(NCIEN)="" S XURET(0)="-1^Invalid Name Component IEN"
"RTN","XUMVINPU",174,0)
 . . I '$D(^VA(20,NCIEN,0)) S XURET(0)="-1^No Data for Name Componet IEN: "_NCIEN
"RTN","XUMVINPU",175,0)
 . S FDA(FILENUM,$S(FILENUM=200:+$G(XUDUZ),1:+$G(NCIEN))_",",FLDNUM)=IDATA
"RTN","XUMVINPU",176,0)
 ;
"RTN","XUMVINPU",177,0)
 I '$D(FDA) S XURET(0)="-1^No data to file for record '"_XUDUZ_"' in file 200" Q
"RTN","XUMVINPU",178,0)
 ;
"RTN","XUMVINPU",179,0)
 L +^VA(200,XUDUZ):10 I '$T S XURET(0)="-1^Unable to lock record '"_XUDUZ_"' in file 200" Q
"RTN","XUMVINPU",180,0)
 D FILE^DIE(,"FDA","XUERR") I $D(XUERR("DIERR")) S XURET(0)="-1^"_$G(XUERR("DIERR",1,"TEXT",1)) Q
"RTN","XUMVINPU",181,0)
 L -^VA(200,XUDUZ)
"RTN","XUMVINPU",182,0)
 ;
"RTN","XUMVINPU",183,0)
 S XURET(0)=1 ;successfully filed
"RTN","XUMVINPU",184,0)
 Q
"RTN","XUMVINPU",185,0)
 ;
"VER")
8.0^22.2
"BLD",3301,6)
^540
**END**
**END**

