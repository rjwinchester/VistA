EMERGENCY Released XU*8*698 SEQ #544
Extracted from mail message
**KIDS**:XU*8.0*698^

**INSTALL NAME**
XU*8.0*698
"BLD",1628,0)
XU*8.0*698^KERNEL^0^3180726^y
"BLD",1628,1,0)
^^3^3^3180712^
"BLD",1628,1,1,0)
Kernel patch XU*8*698. This patch cleans up duplicated PARENT FACILITY 
"BLD",1628,1,2,0)
entries on the ASSOCIATION (#14) field in the INSTUTITION file.
"BLD",1628,1,3,0)
Please refer to the description in Forum Patch Module for details.
"BLD",1628,4,0)
^9.64PA^^
"BLD",1628,6.3)
7
"BLD",1628,"INID")
^y
"BLD",1628,"INIT")
POST^XU8P698
"BLD",1628,"KRN",0)
^9.67PA^1.5^26
"BLD",1628,"KRN",.4,0)
.4
"BLD",1628,"KRN",.401,0)
.401
"BLD",1628,"KRN",.402,0)
.402
"BLD",1628,"KRN",.403,0)
.403
"BLD",1628,"KRN",.5,0)
.5
"BLD",1628,"KRN",.84,0)
.84
"BLD",1628,"KRN",1.5,0)
1.5
"BLD",1628,"KRN",1.6,0)
1.6
"BLD",1628,"KRN",1.61,0)
1.61
"BLD",1628,"KRN",1.62,0)
1.62
"BLD",1628,"KRN",3.6,0)
3.6
"BLD",1628,"KRN",3.8,0)
3.8
"BLD",1628,"KRN",9.2,0)
9.2
"BLD",1628,"KRN",9.8,0)
9.8
"BLD",1628,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",1628,"KRN",9.8,"NM",1,0)
XUMF04H^^0^B48910610
"BLD",1628,"KRN",9.8,"NM","B","XUMF04H",1)

"BLD",1628,"KRN",19,0)
19
"BLD",1628,"KRN",19.1,0)
19.1
"BLD",1628,"KRN",101,0)
101
"BLD",1628,"KRN",409.61,0)
409.61
"BLD",1628,"KRN",771,0)
771
"BLD",1628,"KRN",779.2,0)
779.2
"BLD",1628,"KRN",870,0)
870
"BLD",1628,"KRN",8989.51,0)
8989.51
"BLD",1628,"KRN",8989.52,0)
8989.52
"BLD",1628,"KRN",8993,0)
8993
"BLD",1628,"KRN",8994,0)
8994
"BLD",1628,"KRN",9002226,0)
9002226
"BLD",1628,"KRN","B",.4,.4)

"BLD",1628,"KRN","B",.401,.401)

"BLD",1628,"KRN","B",.402,.402)

"BLD",1628,"KRN","B",.403,.403)

"BLD",1628,"KRN","B",.5,.5)

"BLD",1628,"KRN","B",.84,.84)

"BLD",1628,"KRN","B",1.5,1.5)

"BLD",1628,"KRN","B",1.6,1.6)

"BLD",1628,"KRN","B",1.61,1.61)

"BLD",1628,"KRN","B",1.62,1.62)

"BLD",1628,"KRN","B",3.6,3.6)

"BLD",1628,"KRN","B",3.8,3.8)

"BLD",1628,"KRN","B",9.2,9.2)

"BLD",1628,"KRN","B",9.8,9.8)

"BLD",1628,"KRN","B",19,19)

"BLD",1628,"KRN","B",19.1,19.1)

"BLD",1628,"KRN","B",101,101)

"BLD",1628,"KRN","B",409.61,409.61)

"BLD",1628,"KRN","B",771,771)

"BLD",1628,"KRN","B",779.2,779.2)

"BLD",1628,"KRN","B",870,870)

"BLD",1628,"KRN","B",8989.51,8989.51)

"BLD",1628,"KRN","B",8989.52,8989.52)

"BLD",1628,"KRN","B",8993,8993)

"BLD",1628,"KRN","B",8994,8994)

"BLD",1628,"KRN","B",9002226,9002226)

"BLD",1628,"QDEF")
^^^^NO^^^^NO^^NO
"BLD",1628,"QUES",0)
^9.62^^
"BLD",1628,"REQB",0)
^9.611^1^1
"BLD",1628,"REQB",1,0)
XU*8.0*678^1
"BLD",1628,"REQB","B","XU*8.0*678",1)

"INIT")
POST^XU8P698
"MBREQ")
0
"PKG",3,-1)
1^1
"PKG",3,0)
KERNEL^XU^SIGN-ON, SECURITY, MENU DRIVER, DEVICES, TASKMAN^
"PKG",3,22,0)
^9.49I^1^1
"PKG",3,22,1,0)
8.0^3090706^3090706^6
"PKG",3,22,1,"PAH",1,0)
698^3180726
"PKG",3,22,1,"PAH",1,1,0)
^^3^3^3180726
"PKG",3,22,1,"PAH",1,1,1,0)
Kernel patch XU*8*698. This patch cleans up duplicated PARENT FACILITY 
"PKG",3,22,1,"PAH",1,1,2,0)
entries on the ASSOCIATION (#14) field in the INSTUTITION file.
"PKG",3,22,1,"PAH",1,1,3,0)
Please refer to the description in Forum Patch Module for details.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
2
"RTN","XU8P698")
0^^B4176443^n/a
"RTN","XU8P698",1,0)
XU8P698 ;BP/BDT - POST ROUTINE 698 CLEAN UP; 07/26/18
"RTN","XU8P698",2,0)
 ;;8.0;KERNEL;**698**;Jul 10, 1995;Build 7
"RTN","XU8P698",3,0)
 ;;Per VHA Directive 6402, this routine should not be modified.
"RTN","XU8P698",4,0)
 Q
"RTN","XU8P698",5,0)
 ;
"RTN","XU8P698",6,0)
POST ;
"RTN","XU8P698",7,0)
 Q:$$KSP^XUPARAM("INST")=12000  ;Quit if Forum account
"RTN","XU8P698",8,0)
 ;I $$PATCH^XPDUTL("XU*8.0*684")=0 Q
"RTN","XU8P698",9,0)
 D CLEAN
"RTN","XU8P698",10,0)
 D LOOP
"RTN","XU8P698",11,0)
 Q
"RTN","XU8P698",12,0)
 ;
"RTN","XU8P698",13,0)
LIST ; List all duplicate PARENT FACILITY
"RTN","XU8P698",14,0)
 N XUI,XUY
"RTN","XU8P698",15,0)
 S XUI=0 F  S XUI=$O(^DIC(4,XUI)) Q:XUI'>0  D 
"RTN","XU8P698",16,0)
 . IF $D(^DIC(4,XUI,7,"B","PARENT FACILITY"))>0 S XUY=$O(^DIC(4,XUI,7,"B","PARENT FACILITY",0)) W !,"ENTRY#: "_XUI,"  SUB-ENTRY#: "_XUY
"RTN","XU8P698",17,0)
 Q
"RTN","XU8P698",18,0)
 ;
"RTN","XU8P698",19,0)
CLEAN ; Clean the dubplicate PARENT FACILITY
"RTN","XU8P698",20,0)
 N XUI,XUY,X,Y
"RTN","XU8P698",21,0)
 K ^XTMP("XU8P698")
"RTN","XU8P698",22,0)
 S X=$$DT^XLFDT,Y=$$FMADD^XLFDT(X,30)
"RTN","XU8P698",23,0)
 S ^XTMP("XU8P698",0)=Y_"^"_X_"^XU*8*698"
"RTN","XU8P698",24,0)
 M ^XTMP("XU8P698",$J,4)=^DIC(4)
"RTN","XU8P698",25,0)
 S XUI=0 F  S XUI=$O(^DIC(4,XUI)) Q:XUI'>0  D 
"RTN","XU8P698",26,0)
 . IF $D(^DIC(4,XUI,7,"B","PARENT FACILITY"))>0 S XUY=$O(^DIC(4,XUI,7,"B","PARENT FACILITY",0)) D CLEAN1(XUI,XUY),REINDEX(XUI)
"RTN","XU8P698",27,0)
 Q
"RTN","XU8P698",28,0)
 ;
"RTN","XU8P698",29,0)
CLEAN1(XUIEN,XUIEN1) ; delete one given entry in the subfile
"RTN","XU8P698",30,0)
 N DIK,DA
"RTN","XU8P698",31,0)
 S DA(1)=XUIEN,DA=XUIEN1,DIK="^DIC(4,"_DA(1)_",""7""," D ^DIK
"RTN","XU8P698",32,0)
 Q
"RTN","XU8P698",33,0)
 ;
"RTN","XU8P698",34,0)
REINDEX(XUIEN) ; delete x-refs in the subfile for an top entry
"RTN","XU8P698",35,0)
 N DIK,DA
"RTN","XU8P698",36,0)
 S DA(1)=XUIEN,DIK(1)=".01^1",DIK="^DIC(4,"_DA(1)_",""7""," D ENALL2^DIK
"RTN","XU8P698",37,0)
 S DA(1)=XUIEN,DIK(1)=".01^1",DIK="^DIC(4,"_DA(1)_",""7""," D ENALL^DIK
"RTN","XU8P698",38,0)
 Q
"RTN","XU8P698",39,0)
LOOP ; fix nodes of ASSOCIATION
"RTN","XU8P698",40,0)
 N XUI
"RTN","XU8P698",41,0)
 S XUI=0 F  S XUI=$O(^DIC(4,XUI)) Q:XUI'>0  D
"RTN","XU8P698",42,0)
 . I $D(^DIC(4,XUI,7,1,0)),+$G(^DIC(4,XUI,7,1,0))'=1 D CLEAN1(XUI,1)
"RTN","XU8P698",43,0)
 . I $D(^DIC(4,XUI,7,2,0)),+$G(^DIC(4,XUI,7,2,0))'=2 D CLEAN1(XUI,2)
"RTN","XU8P698",44,0)
 . Q 
"RTN","XU8P698",45,0)
 Q
"RTN","XUMF04H")
0^1^B48910610^B32714425
"RTN","XUMF04H",1,0)
XUMF04H ;BP/RAM - INSTITUTION Handler ;07/26/18
"RTN","XUMF04H",2,0)
 ;;8.0;KERNEL;**549,678,698**;Jul 10, 1995;Build 7
"RTN","XUMF04H",3,0)
 ;;Per VA Directive 6402, this routine should not be modified
"RTN","XUMF04H",4,0)
 ; This routine handles Institution Master File HL7 messages.
"RTN","XUMF04H",5,0)
 ;
"RTN","XUMF04H",6,0)
MAIN ; -- entry point
"RTN","XUMF04H",7,0)
 ;
"RTN","XUMF04H",8,0)
 Q:$$KSP^XUPARAM("INST")=12000
"RTN","XUMF04H",9,0)
 ;
"RTN","XUMF04H",10,0)
 N X,HLFS,HLCS,ERROR,HLRESLTA,IFN,IEN,KEY,VALUE,ROOT,HLSCS,CDSYS,TEXT,ID
"RTN","XUMF04H",11,0)
 ;
"RTN","XUMF04H",12,0)
 D INIT,PROCESS,REPLY,EXIT
"RTN","XUMF04H",13,0)
 ;
"RTN","XUMF04H",14,0)
 Q
"RTN","XUMF04H",15,0)
 ;
"RTN","XUMF04H",16,0)
INIT ; -- initialize
"RTN","XUMF04H",17,0)
 ;
"RTN","XUMF04H",18,0)
 S ERROR=0,IEN=""
"RTN","XUMF04H",19,0)
 S HLFS=HL("FS"),HLCS=$E(HL("ECH")),HLSCS=$E(HL("ECH"),4)
"RTN","XUMF04H",20,0)
 ;
"RTN","XUMF04H",21,0)
 Q
"RTN","XUMF04H",22,0)
 ;
"RTN","XUMF04H",23,0)
PROCESS ; -- pull message text
"RTN","XUMF04H",24,0)
 ;
"RTN","XUMF04H",25,0)
 F  X HLNEXT Q:HLQUIT'>0  D
"RTN","XUMF04H",26,0)
 .Q:$P(HLNODE,HLFS)=""
"RTN","XUMF04H",27,0)
 .D @($P(HLNODE,HLFS))
"RTN","XUMF04H",28,0)
 ;
"RTN","XUMF04H",29,0)
 Q
"RTN","XUMF04H",30,0)
 ;
"RTN","XUMF04H",31,0)
MSH ; -- MSH segment
"RTN","XUMF04H",32,0)
 ;
"RTN","XUMF04H",33,0)
 Q
"RTN","XUMF04H",34,0)
 ;
"RTN","XUMF04H",35,0)
MSA ; -- MSA segment
"RTN","XUMF04H",36,0)
 ;
"RTN","XUMF04H",37,0)
 Q
"RTN","XUMF04H",38,0)
 ;
"RTN","XUMF04H",39,0)
QRD ; -- QRD segment
"RTN","XUMF04H",40,0)
 ;
"RTN","XUMF04H",41,0)
 Q
"RTN","XUMF04H",42,0)
 ;
"RTN","XUMF04H",43,0)
MFI ; -- MFI segment
"RTN","XUMF04H",44,0)
 ;
"RTN","XUMF04H",45,0)
 Q
"RTN","XUMF04H",46,0)
 ;
"RTN","XUMF04H",47,0)
MFE ; -- MFE segment
"RTN","XUMF04H",48,0)
 ;
"RTN","XUMF04H",49,0)
 S KEY=$P(HLNODE,HLFS,5)
"RTN","XUMF04H",50,0)
 ;
"RTN","XUMF04H",51,0)
 S ID=$P(KEY,HLCS)
"RTN","XUMF04H",52,0)
 S TEXT=$P(KEY,HLCS,2)
"RTN","XUMF04H",53,0)
 S CDSYS=$P(KEY,HLCS,3)
"RTN","XUMF04H",54,0)
 ;
"RTN","XUMF04H",55,0)
 I CDSYS="VASTANUM" D  Q
"RTN","XUMF04H",56,0)
 .S IEN=$O(^DIC(4,"D",ID,0)) Q:IEN
"RTN","XUMF04H",57,0)
 .S IEN=$O(^DIC(4,"B",TEXT,0))
"RTN","XUMF04H",58,0)
 ;
"RTN","XUMF04H",59,0)
 I CDSYS="NPI" D  Q
"RTN","XUMF04H",60,0)
 .S IEN=$O(^DIC(4,"ANPI",ID,0)) Q:IEN
"RTN","XUMF04H",61,0)
 .S IEN=$O(^DIC(4,"B",TEXT,0))
"RTN","XUMF04H",62,0)
 I CDSYS="DMIS" D  Q
"RTN","XUMF04H",63,0)
 .S IEN=$O(^DIC(4,"XUMFIDX","DMIS",ID,0)) Q:IEN
"RTN","XUMF04H",64,0)
 .S IEN=$O(^DIC(4,"B",TEXT,0))
"RTN","XUMF04H",65,0)
 ;
"RTN","XUMF04H",66,0)
 Q
"RTN","XUMF04H",67,0)
 ;
"RTN","XUMF04H",68,0)
ZIN ; -- VHA Institution segment
"RTN","XUMF04H",69,0)
 ;
"RTN","XUMF04H",70,0)
 W "."
"RTN","XUMF04H",71,0)
 ;
"RTN","XUMF04H",72,0)
 N NAME,FACTYP,OFNME,INACTIVE,STATE,VISN,PARENT,STREET,STREET2,CITY,ZIP
"RTN","XUMF04H",73,0)
 N STRT1,STRT2,CITY1,STATE1,STANUM,BILLNAME,IEN1,IENS,ERR,ERROR1
"RTN","XUMF04H",74,0)
 N ZIP1,AGENCY,NPIDT,NPISTAT,NPI,TAX,TAXPC,TAXSTAT,MAMMO,CLIA,DMIS,XXXX
"RTN","XUMF04H",75,0)
 N LOCTZONE,COUNTRY,TZONEX
"RTN","XUMF04H",76,0)
 ;
"RTN","XUMF04H",77,0)
 D PARSE^XUMFXHL7("HLNODE","XXXX")
"RTN","XUMF04H",78,0)
 ;
"RTN","XUMF04H",79,0)
 S STANUM=XXXX(2)
"RTN","XUMF04H",80,0)
 ;
"RTN","XUMF04H",81,0)
 I $G(STANUM),CDSYS'="VASTANUM" Q
"RTN","XUMF04H",82,0)
 ;
"RTN","XUMF04H",83,0)
 S XUMF=1,ERROR1=""
"RTN","XUMF04H",84,0)
 ;
"RTN","XUMF04H",85,0)
 S NAME=XXXX(1)
"RTN","XUMF04H",86,0)
 S FACTYP=$P(XXXX(4),"~",1)
"RTN","XUMF04H",87,0)
 S OFNME=XXXX(5)
"RTN","XUMF04H",88,0)
 S INACTIVE=XXXX(6)
"RTN","XUMF04H",89,0)
 S STATE=XXXX(7)
"RTN","XUMF04H",90,0)
 S VISN=XXXX(8)
"RTN","XUMF04H",91,0)
 S:VISN'="" VISN=$O(^DIC(4,"B",VISN,0)) ;p698
"RTN","XUMF04H",92,0)
 S PARENT=XXXX(9)
"RTN","XUMF04H",93,0)
 S:PARENT'="" PARENT=$O(^DIC(4,"D",PARENT,0)) ;p698
"RTN","XUMF04H",94,0)
 S STREET=$P(XXXX(14),"~",1)
"RTN","XUMF04H",95,0)
 S STREET2=$P(XXXX(14),"~",2)
"RTN","XUMF04H",96,0)
 S CITY=$P(XXXX(14),"~",3)
"RTN","XUMF04H",97,0)
 S ZIP=$P(XXXX(14),"~",5)
"RTN","XUMF04H",98,0)
 S COUNTRY=$P(XXXX(14),"~",6)
"RTN","XUMF04H",99,0)
 S STRT1=$P(XXXX(15),"~",1)
"RTN","XUMF04H",100,0)
 S STRT2=$P(XXXX(15),"~",2)
"RTN","XUMF04H",101,0)
 S CITY1=$P(XXXX(15),"~",3)
"RTN","XUMF04H",102,0)
 S STATE1=$P(XXXX(15),"~",4)
"RTN","XUMF04H",103,0)
 S ZIP1=$P(XXXX(15),"~",5)
"RTN","XUMF04H",104,0)
 S AGENCY=$P(XXXX(16),"~")
"RTN","XUMF04H",105,0)
 S NPI=XXXX(17)
"RTN","XUMF04H",106,0)
 S NPISTAT=XXXX(18)
"RTN","XUMF04H",107,0)
 I NPISTAT="ACTIVE" S NPISTAT=1 ;p698
"RTN","XUMF04H",108,0)
 I NPISTAT="INACTIVE" S NPISTAT=0 ;698
"RTN","XUMF04H",109,0)
 S NPIDT=$$FMDATE^HLFNC(XXXX(19))
"RTN","XUMF04H",110,0)
 S TAX=XXXX(20)
"RTN","XUMF04H",111,0)
 S TAXSTAT=XXXX(21)
"RTN","XUMF04H",112,0)
 S TAXPC=XXXX(22)
"RTN","XUMF04H",113,0)
 S CLIA=XXXX(23)
"RTN","XUMF04H",114,0)
 S MAMMO=XXXX(24)
"RTN","XUMF04H",115,0)
 S DMIS=XXXX(25)
"RTN","XUMF04H",116,0)
 S BILLNAME=XXXX(26)
"RTN","XUMF04H",117,0)
 S LOCTZONE=XXXX(27)
"RTN","XUMF04H",118,0)
 S TZONEX=XXXX(28)
"RTN","XUMF04H",119,0)
 ;
"RTN","XUMF04H",120,0)
 ; -- new entry
"RTN","XUMF04H",121,0)
 I 'IEN D  Q:'IEN
"RTN","XUMF04H",122,0)
 .N X,Y S X=NAME
"RTN","XUMF04H",123,0)
 .K DIC S DIC=4,DIC(0)="F"
"RTN","XUMF04H",124,0)
 .D FILE^DICN K DIC
"RTN","XUMF04H",125,0)
 .S IEN=$S(Y="-1":0,1:+Y)
"RTN","XUMF04H",126,0)
 ;
"RTN","XUMF04H",127,0)
 S IENS=IEN_","
"RTN","XUMF04H",128,0)
 ;
"RTN","XUMF04H",129,0)
 K FDA
"RTN","XUMF04H",130,0)
 S FDA(4,IENS,.01)=NAME
"RTN","XUMF04H",131,0)
 S FDA(4,IENS,13)=FACTYP
"RTN","XUMF04H",132,0)
 S FDA(4,IENS,1.01)=STREET
"RTN","XUMF04H",133,0)
 S FDA(4,IENS,1.02)=STREET2
"RTN","XUMF04H",134,0)
 S FDA(4,IENS,1.03)=CITY
"RTN","XUMF04H",135,0)
 S FDA(4,IENS,1.04)=ZIP
"RTN","XUMF04H",136,0)
 S FDA(4,IENS,.02)=STATE
"RTN","XUMF04H",137,0)
 S FDA(4,IENS,4.01)=STRT1
"RTN","XUMF04H",138,0)
 S FDA(4,IENS,4.02)=STRT2
"RTN","XUMF04H",139,0)
 S FDA(4,IENS,4.03)=CITY1
"RTN","XUMF04H",140,0)
 S FDA(4,IENS,4.04)=STATE1
"RTN","XUMF04H",141,0)
 S FDA(4,IENS,4.05)=ZIP1
"RTN","XUMF04H",142,0)
 S FDA(4,IENS,11)="National"
"RTN","XUMF04H",143,0)
 S FDA(4,IENS,100)=OFNME
"RTN","XUMF04H",144,0)
 S FDA(4,IENS,101)=INACTIVE
"RTN","XUMF04H",145,0)
 S FDA(4,IENS,95)=AGENCY
"RTN","XUMF04H",146,0)
 S FDA(4,IENS,99)=STANUM
"RTN","XUMF04H",147,0)
 S FDA(4,IENS,200)=BILLNAME
"RTN","XUMF04H",148,0)
 S FDA(4,IENS,800)=LOCTZONE
"RTN","XUMF04H",149,0)
 S FDA(4,IENS,801)=COUNTRY
"RTN","XUMF04H",150,0)
 S FDA(4,IENS,802)=TZONEX
"RTN","XUMF04H",151,0)
 D FILE^DIE("E","FDA","ERR")
"RTN","XUMF04H",152,0)
 I $D(ERR) D
"RTN","XUMF04H",153,0)
 .D EM("error updating ZIN",.ERR)
"RTN","XUMF04H",154,0)
 .K ERR
"RTN","XUMF04H",155,0)
 ;
"RTN","XUMF04H",156,0)
 I $G(VISN)'="" D
"RTN","XUMF04H",157,0)
 .K FDA
"RTN","XUMF04H",158,0)
 .S IENS="?+1,"_IEN_","
"RTN","XUMF04H",159,0)
 .S FDAIEN(1)=1
"RTN","XUMF04H",160,0)
 .S FDA(4.014,IENS,.01)=1
"RTN","XUMF04H",161,0)
 .S FDA(4.014,IENS,1)=VISN
"RTN","XUMF04H",162,0)
 .D UPDATE^DIE("","FDA","FDAIEN","ERR")
"RTN","XUMF04H",163,0)
 I $D(ERR) D
"RTN","XUMF04H",164,0)
 .D EM("error updating VISN",.ERR)
"RTN","XUMF04H",165,0)
 .K ERR
"RTN","XUMF04H",166,0)
 ;
"RTN","XUMF04H",167,0)
 I $G(PARENT) D
"RTN","XUMF04H",168,0)
 .S IENS="?+1,"_IEN_","
"RTN","XUMF04H",169,0)
 .S FDAIEN(1)=2
"RTN","XUMF04H",170,0)
 .S FDA(4.014,IENS,.01)=2
"RTN","XUMF04H",171,0)
 .S FDA(4.014,IENS,1)=PARENT
"RTN","XUMF04H",172,0)
 .D UPDATE^DIE("","FDA","FDAIEN","ERR")
"RTN","XUMF04H",173,0)
 I $D(ERR) D
"RTN","XUMF04H",174,0)
 .D EM("error updating PARENT",.ERR)
"RTN","XUMF04H",175,0)
 .K ERR
"RTN","XUMF04H",176,0)
 ;
"RTN","XUMF04H",177,0)
 I $G(NPIDT)'="" D
"RTN","XUMF04H",178,0)
 .K FDA
"RTN","XUMF04H",179,0)
 .S IENS="?+2,"_IEN_","
"RTN","XUMF04H",180,0)
 .S FDA(4.042,IENS,.01)=NPIDT
"RTN","XUMF04H",181,0)
 .S FDA(4.042,IENS,.02)=NPISTAT
"RTN","XUMF04H",182,0)
 .S FDA(4.042,IENS,.03)=NPI
"RTN","XUMF04H",183,0)
 .D UPDATE^DIE("","FDA",,"ERR")
"RTN","XUMF04H",184,0)
 I $D(ERR) D
"RTN","XUMF04H",185,0)
 .D EM("error updating NPI",.ERR)
"RTN","XUMF04H",186,0)
 .K ERR
"RTN","XUMF04H",187,0)
 ;
"RTN","XUMF04H",188,0)
 I $G(TAX)'="",$P($$TAXORG^XUSTAX(IEN),U)'=TAX D
"RTN","XUMF04H",189,0)
 .K FDA,ROOT,IDX
"RTN","XUMF04H",190,0)
 .S IENS="?+2,"_IEN_","
"RTN","XUMF04H",191,0)
 .S FDA(4.043,IENS,.01)=TAX
"RTN","XUMF04H",192,0)
 .S FDA(4.043,IENS,.02)=TAXPC
"RTN","XUMF04H",193,0)
 .S FDA(4.043,IENS,.03)=TAXSTAT
"RTN","XUMF04H",194,0)
 .D UPDATE^DIE("E","FDA",,"ERR")
"RTN","XUMF04H",195,0)
 I $D(ERR) D
"RTN","XUMF04H",196,0)
 .D EM("error updating TAXANOMY",.ERR)
"RTN","XUMF04H",197,0)
 .K ERR
"RTN","XUMF04H",198,0)
 ;
"RTN","XUMF04H",199,0)
 I $G(CLIA)'="" D
"RTN","XUMF04H",200,0)
 .S IENS="?+2,"_IEN_","
"RTN","XUMF04H",201,0)
 .K FDA
"RTN","XUMF04H",202,0)
 .S FDA(4.9999,IENS,.01)="CLIA"
"RTN","XUMF04H",203,0)
 .S FDA(4.9999,IENS,.02)=CLIA
"RTN","XUMF04H",204,0)
 .D UPDATE^DIE("E","FDA",,"ERR")
"RTN","XUMF04H",205,0)
 I $D(ERR) D
"RTN","XUMF04H",206,0)
 .D EM("error updating CLIA",.ERR)
"RTN","XUMF04H",207,0)
 .K ERR
"RTN","XUMF04H",208,0)
 ;
"RTN","XUMF04H",209,0)
 I $G(MAMMO)'="" D
"RTN","XUMF04H",210,0)
 .S IENS="?+2,"_IEN_","
"RTN","XUMF04H",211,0)
 .K FDA
"RTN","XUMF04H",212,0)
 .S FDA(4.9999,IENS,.01)="MAMMO"
"RTN","XUMF04H",213,0)
 .S FDA(4.9999,IENS,.02)=MAMMO
"RTN","XUMF04H",214,0)
 .D UPDATE^DIE("E","FDA",,"ERR")
"RTN","XUMF04H",215,0)
 I $D(ERR) D
"RTN","XUMF04H",216,0)
 .D EM("error updating MAMMO",.ERR)
"RTN","XUMF04H",217,0)
 .K ERR
"RTN","XUMF04H",218,0)
 ;
"RTN","XUMF04H",219,0)
 I $G(DMIS)'="" D
"RTN","XUMF04H",220,0)
 .S IENS="?+2,"_IEN_","
"RTN","XUMF04H",221,0)
 .K FDA
"RTN","XUMF04H",222,0)
 .S FDA(4.9999,IENS,.01)="DMIS"
"RTN","XUMF04H",223,0)
 .S FDA(4.9999,IENS,.02)=DMIS
"RTN","XUMF04H",224,0)
 .D UPDATE^DIE("E","FDA",,"ERR")
"RTN","XUMF04H",225,0)
 I $D(ERR) D
"RTN","XUMF04H",226,0)
 .D EM("error updating DMIS",.ERR)
"RTN","XUMF04H",227,0)
 .K ERR
"RTN","XUMF04H",228,0)
 ;
"RTN","XUMF04H",229,0)
 Q
"RTN","XUMF04H",230,0)
 ;
"RTN","XUMF04H",231,0)
REPLY ; -- master file response
"RTN","XUMF04H",232,0)
 ;
"RTN","XUMF04H",233,0)
 Q:HL("MTN")="MFR"
"RTN","XUMF04H",234,0)
 Q:HL("MTN")="MFK"
"RTN","XUMF04H",235,0)
 Q:HL("MTN")="ACK"
"RTN","XUMF04H",236,0)
 ;
"RTN","XUMF04H",237,0)
 N X
"RTN","XUMF04H",238,0)
 S X="MSA"_HLFS_$S(ERROR:"AE",1:"AA")_HLFS_HL("MID")_HLFS_$P(ERROR,U,2)
"RTN","XUMF04H",239,0)
 S ^TMP("HLA",$J,1)=X
"RTN","XUMF04H",240,0)
 ;
"RTN","XUMF04H",241,0)
 S HLP("PRIORITY")="I"
"RTN","XUMF04H",242,0)
 D GENACK^HLMA1(HL("EID"),HLMTIENS,HL("EIDS"),"GM",1,.HLRESLT)
"RTN","XUMF04H",243,0)
 ;
"RTN","XUMF04H",244,0)
 ; check for error
"RTN","XUMF04H",245,0)
 I ($P($G(HLRESLT),U,3)'="") D  Q
"RTN","XUMF04H",246,0)
 .S ERROR=1_U_$P(HLRESLT,HLFS,3)_U_$P(HLRESLT,HLFS,2)_U_$P(HLRESLT,U)
"RTN","XUMF04H",247,0)
 ;
"RTN","XUMF04H",248,0)
 ; successful call, message ID returned
"RTN","XUMF04H",249,0)
 S ERROR="0^"_$P($G(HLRESLT),U,1)
"RTN","XUMF04H",250,0)
 ;
"RTN","XUMF04H",251,0)
 Q
"RTN","XUMF04H",252,0)
 ;
"RTN","XUMF04H",253,0)
EXIT ; -- cleanup, and quit
"RTN","XUMF04H",254,0)
 ;
"RTN","XUMF04H",255,0)
 Q
"RTN","XUMF04H",256,0)
 ;
"RTN","XUMF04H",257,0)
EM(ERROR,ERR) ; -- error message p698
"RTN","XUMF04H",258,0)
 ;
"RTN","XUMF04H",259,0)
 N X,XMSUB,XMY,XMTEXT,FLG
"RTN","XUMF04H",260,0)
 S FLG=0
"RTN","XUMF04H",261,0)
 D MSG^DIALOG("AM",.X,80,,"ERR")
"RTN","XUMF04H",262,0)
 ;
"RTN","XUMF04H",263,0)
 S X(.1)="HL7 message ID: "_$G(HL("MID"))
"RTN","XUMF04H",264,0)
 S X(.2)="",X(.3)=$G(ERROR),X(.4)=""
"RTN","XUMF04H",265,0)
 S XMSUB="IMF HANDLER ERROR MESSAGE"
"RTN","XUMF04H",266,0)
 S XMY="G.XUMF INSTITUTION"
"RTN","XUMF04H",267,0)
 S XMTEXT="X("
"RTN","XUMF04H",268,0)
 S X=.9 F  S X=$O(X(X)) Q:'X  D
"RTN","XUMF04H",269,0)
 .I X(X)="" K X(X) Q
"RTN","XUMF04H",270,0)
 .I X(X)["DINUMed field cannot" S FLG=1 K X(X) Q
"RTN","XUMF04H",271,0)
 I FLG Q:'$O(X(.9))
"RTN","XUMF04H",272,0)
 D ^XMD
"RTN","XUMF04H",273,0)
 Q
"VER")
8.0^22.2
"BLD",1628,6)
^544
**END**
**END**

