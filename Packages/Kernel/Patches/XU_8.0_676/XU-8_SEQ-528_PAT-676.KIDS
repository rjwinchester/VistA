Released XU*8*676 SEQ #528
Extracted from mail message
**KIDS**:XU*8.0*676^

**INSTALL NAME**
XU*8.0*676
"BLD",1584,0)
XU*8.0*676^KERNEL^0^3170213^y
"BLD",1584,4,0)
^9.64PA^4.001^1
"BLD",1584,4,4.001,0)
4.001
"BLD",1584,4,4.001,2,0)
^9.641^4.001^1
"BLD",1584,4,4.001,2,4.001,0)
MASTER FILE PARAMETERS  (File-top level)
"BLD",1584,4,4.001,2,4.001,1,0)
^9.6411^6^1
"BLD",1584,4,4.001,2,4.001,1,6,0)
ZRT-DISCOVERY LOGIC
"BLD",1584,4,4.001,222)
y^y^p^^^^n^^n
"BLD",1584,4,4.001,224)

"BLD",1584,4,"APDD",4.001,4.001)

"BLD",1584,4,"APDD",4.001,4.001,6)

"BLD",1584,4,"B",4.001,4.001)

"BLD",1584,6.3)
8
"BLD",1584,"INID")
^y
"BLD",1584,"INIT")
POST^XUMF676P
"BLD",1584,"KRN",0)
^9.67PA^9002226^22
"BLD",1584,"KRN",.4,0)
.4
"BLD",1584,"KRN",.401,0)
.401
"BLD",1584,"KRN",.402,0)
.402
"BLD",1584,"KRN",.403,0)
.403
"BLD",1584,"KRN",.5,0)
.5
"BLD",1584,"KRN",.84,0)
.84
"BLD",1584,"KRN",3.6,0)
3.6
"BLD",1584,"KRN",3.8,0)
3.8
"BLD",1584,"KRN",9.2,0)
9.2
"BLD",1584,"KRN",9.8,0)
9.8
"BLD",1584,"KRN",9.8,"NM",0)
^9.68A^3^3
"BLD",1584,"KRN",9.8,"NM",1,0)
XUMF676^^0^B21292860
"BLD",1584,"KRN",9.8,"NM",2,0)
XUMF676P^^0^B16760370
"BLD",1584,"KRN",9.8,"NM",3,0)
XUMFQR^^0^B56159331
"BLD",1584,"KRN",9.8,"NM","B","XUMF676",1)

"BLD",1584,"KRN",9.8,"NM","B","XUMF676P",2)

"BLD",1584,"KRN",9.8,"NM","B","XUMFQR",3)

"BLD",1584,"KRN",19,0)
19
"BLD",1584,"KRN",19.1,0)
19.1
"BLD",1584,"KRN",101,0)
101
"BLD",1584,"KRN",409.61,0)
409.61
"BLD",1584,"KRN",771,0)
771
"BLD",1584,"KRN",779.2,0)
779.2
"BLD",1584,"KRN",870,0)
870
"BLD",1584,"KRN",8989.51,0)
8989.51
"BLD",1584,"KRN",8989.52,0)
8989.52
"BLD",1584,"KRN",8993,0)
8993
"BLD",1584,"KRN",8994,0)
8994
"BLD",1584,"KRN",9002226,0)
9002226
"BLD",1584,"KRN","B",.4,.4)

"BLD",1584,"KRN","B",.401,.401)

"BLD",1584,"KRN","B",.402,.402)

"BLD",1584,"KRN","B",.403,.403)

"BLD",1584,"KRN","B",.5,.5)

"BLD",1584,"KRN","B",.84,.84)

"BLD",1584,"KRN","B",3.6,3.6)

"BLD",1584,"KRN","B",3.8,3.8)

"BLD",1584,"KRN","B",9.2,9.2)

"BLD",1584,"KRN","B",9.8,9.8)

"BLD",1584,"KRN","B",19,19)

"BLD",1584,"KRN","B",19.1,19.1)

"BLD",1584,"KRN","B",101,101)

"BLD",1584,"KRN","B",409.61,409.61)

"BLD",1584,"KRN","B",771,771)

"BLD",1584,"KRN","B",779.2,779.2)

"BLD",1584,"KRN","B",870,870)

"BLD",1584,"KRN","B",8989.51,8989.51)

"BLD",1584,"KRN","B",8989.52,8989.52)

"BLD",1584,"KRN","B",8993,8993)

"BLD",1584,"KRN","B",8994,8994)

"BLD",1584,"KRN","B",9002226,9002226)

"BLD",1584,"QDEF")
^^^^NO^^^^NO^^NO
"BLD",1584,"QUES",0)
^9.62^^
"BLD",1584,"REQB",0)
^9.611^^
"FIA",4.001)
MASTER FILE PARAMETERS
"FIA",4.001,0)
^DIC(4.001,
"FIA",4.001,0,0)
4.001P
"FIA",4.001,0,1)
y^y^p^^^^n^^n
"FIA",4.001,0,10)

"FIA",4.001,0,11)

"FIA",4.001,0,"RLRO")

"FIA",4.001,0,"VR")
8.0^XU
"FIA",4.001,4.001)
1
"FIA",4.001,4.001,6)

"INIT")
POST^XUMF676P
"MBREQ")
0
"PKG",3,-1)
1^1
"PKG",3,0)
KERNEL^XU^SIGN-ON, SECURITY, MENU DRIVER, DEVICES, TASKMAN^
"PKG",3,22,0)
^9.49I^1^1
"PKG",3,22,1,0)
8.0^3090706^3090706^6
"PKG",3,22,1,"PAH",1,0)
676^3170213
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
3
"RTN","XUMF676")
0^1^B21292860^n/a
"RTN","XUMF676",1,0)
XUMF676 ;OIFO-BP/BATRAN - MFS parameters file ;02/10/2017
"RTN","XUMF676",2,0)
 ;;8.0;KERNEL;**676**;Jul 10, 1995;Build 8
"RTN","XUMF676",3,0)
 ;Per VHA Directive 10-92-142, this routine should not be modified
"RTN","XUMF676",4,0)
 Q
"RTN","XUMF676",5,0)
 ;-------------------------------------------------
"RTN","XUMF676",6,0)
ADD(IEN,DATA) ; ADD ZERO NODE
"RTN","XUMF676",7,0)
 N FDA,FDAIEN,XFIELD,XVALUE,XCOUNT,XDATA,XI,XDATA1
"RTN","XUMF676",8,0)
 S XDATA=$$STRIP^XLFSTR(DATA,"]")
"RTN","XUMF676",9,0)
 S XCOUNT=$L(DATA)-$L(XDATA)+1
"RTN","XUMF676",10,0)
 S FDAIEN(1)=IEN
"RTN","XUMF676",11,0)
 S FDA(4.001,"?+1,",.01)=IEN
"RTN","XUMF676",12,0)
 F XI=1:1:XCOUNT D
"RTN","XUMF676",13,0)
 . S XDATA1=$P(DATA,"]",XI),XFIELD=+$P(XDATA1,";",1),XVALUE=$P(XDATA1,";",2)
"RTN","XUMF676",14,0)
 . I XFIELD'>0 Q
"RTN","XUMF676",15,0)
 . S FDA(4.001,"?+1,",XFIELD)=XVALUE
"RTN","XUMF676",16,0)
 .Q
"RTN","XUMF676",17,0)
 D UPDATE^DIE("","FDA","FDAIEN","ERR")
"RTN","XUMF676",18,0)
 I $D(ERR) D
"RTN","XUMF676",19,0)
 .D EM("UPDATE PARAMETR error on file #"_IEN,.ERR)
"RTN","XUMF676",20,0)
 .K ERR
"RTN","XUMF676",21,0)
 Q
"RTN","XUMF676",22,0)
 ;----------------------------------------------
"RTN","XUMF676",23,0)
ADDMD5(XUNAME,IEN) ; ADD ZERO NODE
"RTN","XUMF676",24,0)
 N IENS1
"RTN","XUMF676",25,0)
 K FDA
"RTN","XUMF676",26,0)
 S FDAIEN(1)=IEN
"RTN","XUMF676",27,0)
 S FDA(4.005,"+1,",.01)=XUNAME
"RTN","XUMF676",28,0)
 ;S FDA(4.005,"+1,",6)=0
"RTN","XUMF676",29,0)
 D UPDATE^DIE("E","FDA","FDAIEN","ERR")
"RTN","XUMF676",30,0)
 I $D(ERR) D
"RTN","XUMF676",31,0)
 .D EM("UPDATE MD5 error on file "_XUNAME,.ERR)
"RTN","XUMF676",32,0)
 .K ERR
"RTN","XUMF676",33,0)
 Q
"RTN","XUMF676",34,0)
 ;---------------------------------------------------
"RTN","XUMF676",35,0)
SCMD5(XUNAME,FILEN) ; ADD SECOND LEVEL
"RTN","XUMF676",36,0)
 N XUIEN,IENS,XC
"RTN","XUMF676",37,0)
 K FDA
"RTN","XUMF676",38,0)
 S XUIEN=$O(^DIC(4.005,"B",XUNAME,0))
"RTN","XUMF676",39,0)
 I XUIEN'>0 Q
"RTN","XUMF676",40,0)
 K FDA
"RTN","XUMF676",41,0)
 S IENS="?+1,"_XUIEN_","
"RTN","XUMF676",42,0)
 S FDA(4.0051,IENS,.01)=FILEN
"RTN","XUMF676",43,0)
 D UPDATE^DIE("E","FDA",,"ERR")
"RTN","XUMF676",44,0)
 I $D(ERR) D
"RTN","XUMF676",45,0)
 .D EM("UPDATE MD5 error on file "_XUNAME,.ERR)
"RTN","XUMF676",46,0)
 .K ERR
"RTN","XUMF676",47,0)
 Q
"RTN","XUMF676",48,0)
 ;--------------------------------------------------
"RTN","XUMF676",49,0)
SUBMD5(XUNAME,XDATA,FILEN,XIEN) ; ADD THIRD LEVEL
"RTN","XUMF676",50,0)
 N XUIEN,IENS,XC
"RTN","XUMF676",51,0)
 K FDA
"RTN","XUMF676",52,0)
 S XUIEN=$O(^DIC(4.005,"B",XUNAME,0))
"RTN","XUMF676",53,0)
 I XUIEN'>0 Q
"RTN","XUMF676",54,0)
 ;
"RTN","XUMF676",55,0)
 S XC=","
"RTN","XUMF676",56,0)
 S IENS="+1"_XC_FILEN_XC_XUIEN_XC
"RTN","XUMF676",57,0)
 S FDAIEN(1)=XIEN
"RTN","XUMF676",58,0)
 S FDA(4.00511,IENS,.01)=$P(XDATA,"^",1)
"RTN","XUMF676",59,0)
 S FDA(4.00511,IENS,1)=$P(XDATA,"^",2)
"RTN","XUMF676",60,0)
 S FDA(4.00511,IENS,2)=$P(XDATA,"^",3)
"RTN","XUMF676",61,0)
 S FDA(4.00511,IENS,3)=$P(XDATA,"^",4)
"RTN","XUMF676",62,0)
 S FDA(4.00511,IENS,4)=$P(XDATA,"^",5)
"RTN","XUMF676",63,0)
 S FDA(4.00511,IENS,5)=$P(XDATA,"^",6,7)
"RTN","XUMF676",64,0)
 D UPDATE^DIE("","FDA","FDAIEN","ERR")
"RTN","XUMF676",65,0)
 I $D(ERR) D
"RTN","XUMF676",66,0)
 .D EM("UPDATE MD5 error on file "_XUNAME,.ERR)
"RTN","XUMF676",67,0)
 .K ERR
"RTN","XUMF676",68,0)
 Q
"RTN","XUMF676",69,0)
 ;---------------------------------------------
"RTN","XUMF676",70,0)
DEL(IEN) ; Delete entries
"RTN","XUMF676",71,0)
 N DIK,DA
"RTN","XUMF676",72,0)
 S DIK="^DIC(4.001,",DA=+IEN D ^DIK
"RTN","XUMF676",73,0)
 Q
"RTN","XUMF676",74,0)
 ;
"RTN","XUMF676",75,0)
DELMD5(XUNAME) ; Delete entries
"RTN","XUMF676",76,0)
 N DIK,DA
"RTN","XUMF676",77,0)
 I $G(XUNAME)="" Q
"RTN","XUMF676",78,0)
 S DA=$O(^DIC(4.005,"B",XUNAME,0))
"RTN","XUMF676",79,0)
 I DA'>0 Q
"RTN","XUMF676",80,0)
 S DIK="^DIC(4.005," D ^DIK
"RTN","XUMF676",81,0)
 Q
"RTN","XUMF676",82,0)
 ;
"RTN","XUMF676",83,0)
 ;-----------------------------------------------
"RTN","XUMF676",84,0)
NODES(IEN,XDATA,XCOUNT) ; -- ADD SEQUENCES
"RTN","XUMF676",85,0)
 ;
"RTN","XUMF676",86,0)
 N DATA,I
"RTN","XUMF676",87,0)
 F I=1:1:XCOUNT D
"RTN","XUMF676",88,0)
 . S DATA=$T(@XDATA+I)
"RTN","XUMF676",89,0)
 . D ADD1(DATA,IEN)
"RTN","XUMF676",90,0)
 . Q
"RTN","XUMF676",91,0)
 Q
"RTN","XUMF676",92,0)
 ;----------------------------------------------
"RTN","XUMF676",93,0)
ADD1(DATA,IEN) ;add sub level - ADD SINGLE SEQUENCE
"RTN","XUMF676",94,0)
 N NODE,IENS
"RTN","XUMF676",95,0)
 K FDA
"RTN","XUMF676",96,0)
 S DATA=$P(DATA,";",2)
"RTN","XUMF676",97,0)
 S NODE=$P(DATA,"^",1)
"RTN","XUMF676",98,0)
 S DATA=$P(DATA,"^",2,99)
"RTN","XUMF676",99,0)
 S IENS="+"_NODE_","_IEN_","
"RTN","XUMF676",100,0)
 S FDA(4.011,IENS,.01)=$P(DATA,"^",1)
"RTN","XUMF676",101,0)
 S FDA(4.011,IENS,.02)=$P(DATA,"^",2)
"RTN","XUMF676",102,0)
 S FDA(4.011,IENS,.03)=$P(DATA,"^",3)
"RTN","XUMF676",103,0)
 S FDA(4.011,IENS,.04)=$P(DATA,"^",4)
"RTN","XUMF676",104,0)
 S FDA(4.011,IENS,.05)=$P(DATA,"^",5)
"RTN","XUMF676",105,0)
 S FDA(4.011,IENS,.06)=$P(DATA,"^",6)
"RTN","XUMF676",106,0)
 S FDA(4.011,IENS,.07)=$P(DATA,"^",7)
"RTN","XUMF676",107,0)
 S FDA(4.011,IENS,.08)=$P(DATA,"^",8)
"RTN","XUMF676",108,0)
 S FDA(4.011,IENS,.09)=$P(DATA,"^",9)
"RTN","XUMF676",109,0)
 S FDA(4.011,IENS,.11)=$P(DATA,"^",11)
"RTN","XUMF676",110,0)
 S FDA(4.011,IENS,.12)=$P(DATA,"^",12)
"RTN","XUMF676",111,0)
 S FDA(4.011,IENS,.13)=$P(DATA,"^",13)
"RTN","XUMF676",112,0)
 S FDA(4.011,IENS,.14)=$P(DATA,"^",14)
"RTN","XUMF676",113,0)
 S FDA(4.011,IENS,.15)=$P(DATA,"^",15)
"RTN","XUMF676",114,0)
 S FDA(4.011,IENS,.16)=$P(DATA,"^",16)
"RTN","XUMF676",115,0)
 D UPDATE^DIE("E","FDA",,"ERR")
"RTN","XUMF676",116,0)
 I $D(ERR) D
"RTN","XUMF676",117,0)
 .D EM("UPDATE PARAMETER error on file #"_IEN,.ERR)
"RTN","XUMF676",118,0)
 .K ERR
"RTN","XUMF676",119,0)
 Q
"RTN","XUMF676",120,0)
 ;------------------------------------------------
"RTN","XUMF676",121,0)
ADD2(XIEN1,XNAME,XCOUNT,XDATA) ; add sub-sub level
"RTN","XUMF676",122,0)
 N XC,IENS,ERR,XIEN2
"RTN","XUMF676",123,0)
 K FDA
"RTN","XUMF676",124,0)
 S XIEN2=+$O(^DIC(4.001,XIEN1,1,"B",XNAME,0))
"RTN","XUMF676",125,0)
 I XIEN2'>0 Q
"RTN","XUMF676",126,0)
 S XC=","
"RTN","XUMF676",127,0)
 S IENS="+"_XCOUNT_XC_XIEN2_XC_XIEN1_XC
"RTN","XUMF676",128,0)
 S FDA(4.111,IENS,.01)=$P(XDATA,"^",1) ; SUBFILE SEQUENCE
"RTN","XUMF676",129,0)
 S FDA(4.111,IENS,.02)=$P(XDATA,"^",2) ; SUBFILE COLUMN NAME
"RTN","XUMF676",130,0)
 S FDA(4.111,IENS,.03)=$P(XDATA,"^",3) ; SUBFILE FIELD NUMBER
"RTN","XUMF676",131,0)
 S FDA(4.111,IENS,.04)=$P(XDATA,"^",4) ; SUBFILE FIELD VUID
"RTN","XUMF676",132,0)
 S FDA(4.111,IENS,.05)=$P(XDATA,"^",5) ; SUBFILE FIELD TYPE
"RTN","XUMF676",133,0)
 D UPDATE^DIE("","FDA","FDAIEN","ERR")
"RTN","XUMF676",134,0)
 I $D(ERR) D
"RTN","XUMF676",135,0)
 .D EM("UPDATE PARAMETER error on file "_XNAME,.ERR)
"RTN","XUMF676",136,0)
 .K ERR
"RTN","XUMF676",137,0)
 Q
"RTN","XUMF676",138,0)
 ;------------------------------------------------
"RTN","XUMF676",139,0)
EM(ERROR,ERR,XMSUB) ; -- error message
"RTN","XUMF676",140,0)
 N X,XMTEXT,XMDUZ
"RTN","XUMF676",141,0)
 D MSG^DIALOG("AM",.X,80,,"ERR")
"RTN","XUMF676",142,0)
 S X(.1)="HL7 message ID: "_$G(HL("MID"))
"RTN","XUMF676",143,0)
 S X(.2)="",X(.3)=$G(ERROR),X(.4)=""
"RTN","XUMF676",144,0)
 S:$G(XMSUB)="" XMSUB="MFS ERROR"
"RTN","XUMF676",145,0)
 S:'$D(XMY("G.XUPATH@FORUM.DOMAIN.EXT")) XMY("G.XUMF ERROR@FORUM.DOMAIN.EXT")=""
"RTN","XUMF676",146,0)
 S XMDUZ=.5
"RTN","XUMF676",147,0)
 S XMTEXT="X("
"RTN","XUMF676",148,0)
 D ^XMD
"RTN","XUMF676",149,0)
 K XMY
"RTN","XUMF676",150,0)
 Q
"RTN","XUMF676",151,0)
 ;-----------------------------------------------
"RTN","XUMF676",152,0)
CLEAN ;
"RTN","XUMF676",153,0)
 K HL("MID"),XMY("G.XUPATH@FORUM.DOMAIN.EXT"),XMY("G.XUMF ERROR@FORUM.DOMAIN.EXT")
"RTN","XUMF676",154,0)
 Q
"RTN","XUMF676",155,0)
 ;-----------------------------------------------
"RTN","XUMF676",156,0)
DATA82 ;120.82 GMR ALLERGIES
"RTN","XUMF676",157,0)
 ;1^Term^.01^ST^^^^^^30^^^^^^1^
"RTN","XUMF676",158,0)
 ;2^Allergy_Type^1^^^^^^^^^^^^^2^
"RTN","XUMF676",159,0)
 ;3^Search_Term^.01^ST^120.823^^Search_Term^^1^30^^^0^^^3^
"RTN","XUMF676",160,0)
 ;4^VistA_Mapping_Target^.01^ST^120.822^^VistA_Mapping_Target^^^99^^^^^^4^
"RTN","XUMF676",161,0)
 ;5^has_drug_class^.01^ST^120.8205^^has_drug_class^^1^80^^^0^VUID^^5^
"RTN","XUMF676",162,0)
 ;6^has_drug_ingredient^.01^ST^120.824^^has_drug_ingredient^^1^80^^^0^VUID^^6^
"RTN","XUMF676",163,0)
 ;7^Status^.02^NM^120.8299^^effectiveDate^^^1^^^^^^7^
"RTN","XUMF676",164,0)
 ;8^name^.01^ST^^^^^^30^^^^^^^
"RTN","XUMF676",165,0)
 ;9^allergyType^1^ST^^^^^^20^^^^^^^
"RTN","XUMF676",166,0)
 ;10^synonym^.01^ST^120.823^^synonym^^^30^^^1^^^^
"RTN","XUMF676",167,0)
 ;11^nationalAllergy^2^ST^^^^^^1^^^^^^^
"RTN","XUMF676",168,0)
 ;12^vaDrugClasses^.01^ST^120.8205^^vaDrugClasses^^^5^^^1^VUID^^^
"RTN","XUMF676",169,0)
 ;13^drugIngredients^.01^ST^120.824^^drugIngredients^^^64^^^1^VUID^^^
"RTN","XUMF676",170,0)
 ;14^status^.02^NM^120.8299^^effectiveDate^^^1^^^^^^^
"RTN","XUMF676",171,0)
 ;15^effectiveDate^.01^DT^120.8299^^effectiveDate^^^8^^^^^L^^
"RTN","XUMF676",172,0)
 ;---------------------------------------------
"RTN","XUMF676",173,0)
DATA83 ;120.82 SIGN/SYMPTOMS
"RTN","XUMF676",174,0)
 ;1^Term^.01^ST^^^^^^30^^^^^^1^
"RTN","XUMF676",175,0)
 ;2^Search_Term^.01^ST^120.832^^Search_Term^^1^30^^^0^^^2^
"RTN","XUMF676",176,0)
 ;3^VistA_Mapping_Target^.01^ST^120.833^^VistA_Mapping_Target^^^99^^^^^^3^
"RTN","XUMF676",177,0)
 ;4^Status^.02^NM^120.8399^^effectiveDate^^^1^^^^^^4^
"RTN","XUMF676",178,0)
 ;5^name^.01^ST^^^^^^30^^^^^^^
"RTN","XUMF676",179,0)
 ;6^nationalSignSymptom^1^ST^^^^^^1^^^^^^^
"RTN","XUMF676",180,0)
 ;7^synonym^.01^ST^120.832^^synonym^^^30^^^1^^^^
"RTN","XUMF676",181,0)
 ;8^VistA_Mapping_Target^.01^ST^120.833^^VistA_Mapping_Target^^^99^^^^^^3^
"RTN","XUMF676",182,0)
 ;9^status^.02^NM^120.8399^^effectiveDate^^^1^^^^^^^
"RTN","XUMF676",183,0)
 ;10^effectiveDate^.01^DT^120.8399^^effectiveDate^^^8^^^^^L^^
"RTN","XUMF676P")
0^2^B16760370^n/a
"RTN","XUMF676P",1,0)
XUMF676P ;OIFO-BP/BATRAN - MFS parameters file ;02/13/2017
"RTN","XUMF676P",2,0)
 ;;8.0;KERNEL;**676**;Jul 10, 1995;Build 8
"RTN","XUMF676P",3,0)
 ;Per VHA Directive 10-92-142, this routine should not be modified
"RTN","XUMF676P",4,0)
 Q
"RTN","XUMF676P",5,0)
 ;----------------------------------------------
"RTN","XUMF676P",6,0)
POST ; -- Entry point
"RTN","XUMF676P",7,0)
 N XUMF S XUMF=1
"RTN","XUMF676P",8,0)
 D 82,83
"RTN","XUMF676P",9,0)
 N X S X="XUMF676" X ^%ZOSF("DEL")
"RTN","XUMF676P",10,0)
 K XMY
"RTN","XUMF676P",11,0)
 Q
"RTN","XUMF676P",12,0)
 ;----------------------------------------------
"RTN","XUMF676P",13,0)
TEST ; -- Entry point
"RTN","XUMF676P",14,0)
 N XUMF S XUMF=1
"RTN","XUMF676P",15,0)
 S XMY("G.XUPATH@FORUM.DOMAIN.EXT")=""
"RTN","XUMF676P",16,0)
 D 82,83
"RTN","XUMF676P",17,0)
 K XMY
"RTN","XUMF676P",18,0)
 Q
"RTN","XUMF676P",19,0)
 ;---------------------------------------------
"RTN","XUMF676P",20,0)
82 ; FILE 120.82 GMR ALLERGIES
"RTN","XUMF676P",21,0)
 N XFIEN,XFILE,XUIENOLD,XUMAIL,XUIEN
"RTN","XUMF676P",22,0)
 S XFIEN=120.82
"RTN","XUMF676P",23,0)
 S XFILE="Reactants"
"RTN","XUMF676P",24,0)
 S XUIEN=$O(^DIC(4.001,"B",XFIEN,0)) ;Get existed IEN
"RTN","XUMF676P",25,0)
 I XUIEN>0 D
"RTN","XUMF676P",26,0)
  . S XUMAIL=$P($G(^DIC(4.001,XUIEN,0)),"^",6) ;get Mail Group pointer
"RTN","XUMF676P",27,0)
  . D DEL^XUMF676(XUIEN) ; delete entry
"RTN","XUMF676P",28,0)
 D DEL^XUMF676(XFIEN) ; delete entry 120.82 before update 
"RTN","XUMF676P",29,0)
 D ADD^XUMF676(XFIEN,".03;GMR Allergies].02;RDT].04;NULL].05;NULL].07;Reactants]5;D ZRT^GMRAVZRT") ; add entry
"RTN","XUMF676P",30,0)
 D ADD^XUMF676(XFIEN,"2;D MFSUP^HDISVF09(120.82,$G(ERROR))]4.1;99.99]4.2;vuid]4.3;ERT]4.4;.01]4.5;.01") ; add entry
"RTN","XUMF676P",31,0)
 D ADD^XUMF676(XFIEN,"4.6;VA]4.7;CE]4.8;B]4.9;VA]4.11;NM]4.12;ST]4.14;ST]4.15;ST]4.16;NULL]4.17;NULL]6;D DFORALL^GMRAVZRT(120.82,120.822,120.8221)") ; add entry
"RTN","XUMF676P",32,0)
 S $P(^DIC(4.001,XFIEN,0),"^",6)=$G(XUMAIL)
"RTN","XUMF676P",33,0)
 D NODES^XUMF676(XFIEN,"DATA82",15) ; call ADD1 to add sub_entry
"RTN","XUMF676P",34,0)
 D ADD2^XUMF676(XFIEN,"VistA_Mapping_Target",1,"1^VistA_Mapping_Target^.01^^")
"RTN","XUMF676P",35,0)
 D DELMD5^XUMF676(XFILE)
"RTN","XUMF676P",36,0)
 D ADDMD5^XUMF676(XFILE,XFIEN)
"RTN","XUMF676P",37,0)
 D SCMD5^XUMF676(XFILE,XFIEN)
"RTN","XUMF676P",38,0)
 D SUBMD5^XUMF676(XFILE,".01^20^^^",XFIEN,.01)
"RTN","XUMF676P",39,0)
 D SUBMD5^XUMF676(XFILE,"1^30^E^^",XFIEN,1)
"RTN","XUMF676P",40,0)
 D SUBMD5^XUMF676(XFILE,"99.99^10^^^",XFIEN,99.99)
"RTN","XUMF676P",41,0)
 S XFIEN=120.823
"RTN","XUMF676P",42,0)
 D SCMD5^XUMF676(XFILE,XFIEN)
"RTN","XUMF676P",43,0)
 D SUBMD5^XUMF676(XFILE,".01^40^^^^",XFIEN,.01)
"RTN","XUMF676P",44,0)
 S XFIEN=120.822
"RTN","XUMF676P",45,0)
 D SCMD5^XUMF676(XFILE,XFIEN)
"RTN","XUMF676P",46,0)
 D SUBMD5^XUMF676(XFILE,".01^45^^^^D M12082^GMRAVZRT",XFIEN,.01)
"RTN","XUMF676P",47,0)
 S XFIEN=120.824
"RTN","XUMF676P",48,0)
 D SCMD5^XUMF676(XFILE,XFIEN)
"RTN","XUMF676P",49,0)
 D SUBMD5^XUMF676(XFILE,".01^50^E^50.416^^",XFIEN,.01)
"RTN","XUMF676P",50,0)
 S XFIEN=120.8205
"RTN","XUMF676P",51,0)
 D SCMD5^XUMF676(XFILE,XFIEN)
"RTN","XUMF676P",52,0)
 D SUBMD5^XUMF676(XFILE,".01^60^E^50.605^^",XFIEN,.01)
"RTN","XUMF676P",53,0)
 ;----------------------------------------------------
"RTN","XUMF676P",54,0)
83 ; FILE 120.83 SIGN/SYMPTOMS
"RTN","XUMF676P",55,0)
 N XFIEN,XFILE,XUMAIL,XUIEN
"RTN","XUMF676P",56,0)
 S XFIEN=120.83
"RTN","XUMF676P",57,0)
 S XFILE="Reactions"
"RTN","XUMF676P",58,0)
 S XUIEN=$O(^DIC(4.001,"B",XFIEN,0)) ;Get existed IEN
"RTN","XUMF676P",59,0)
 I XUIEN>0 D
"RTN","XUMF676P",60,0)
  . S XUMAIL=$P($G(^DIC(4.001,XUIEN,0)),"^",6) ;get Mail Gorup pointer
"RTN","XUMF676P",61,0)
  . D DEL^XUMF676(XUIEN) ; delete entry
"RTN","XUMF676P",62,0)
 D DEL^XUMF676(XFIEN) ; delete entry 120.82 before update 
"RTN","XUMF676P",63,0)
 D ADD^XUMF676(XFIEN,".03;Sign/Symptoms].02;RDT].04;PRE].05;POST].07;Reactions]5;D ZRT^GMRAVZRT") ; add entry
"RTN","XUMF676P",64,0)
 D ADD^XUMF676(XFIEN,"2;D MFSUP^HDISVF09(120.83,$G(ERROR)),TOP10^GMRAUTL2]4.1;99.99]4.2;vuid]4.3;ERT]4.4;.01]4.5;.01") ; add entry
"RTN","XUMF676P",65,0)
 D ADD^XUMF676(XFIEN,"4.6;VA]4.7;CE]4.8;B]4.9;VA]4.11;NM]4.12;ST]4.14;ST]4.15;ST]4.16;NULL]4.17;NULL]6;D DFORALL^GMRAVZRT(120.83,120.833,120.8331)") ; add entry 
"RTN","XUMF676P",66,0)
 S $P(^DIC(4.001,XFIEN,0),"^",6)=$G(XUMAIL)
"RTN","XUMF676P",67,0)
 D NODES^XUMF676(XFIEN,"DATA83",10) ; call ADD1 to add sub_entry
"RTN","XUMF676P",68,0)
 D ADD2^XUMF676(XFIEN,"VistA_Mapping_Target",1,"1^VistA_Mapping_Target^.01^^")
"RTN","XUMF676P",69,0)
 D DELMD5^XUMF676(XFILE)
"RTN","XUMF676P",70,0)
 D ADDMD5^XUMF676(XFILE,XFIEN)
"RTN","XUMF676P",71,0)
 D SCMD5^XUMF676(XFILE,XFIEN)
"RTN","XUMF676P",72,0)
 D SUBMD5^XUMF676(XFILE,".01^20^^^",XFIEN,.01)
"RTN","XUMF676P",73,0)
 ;D SUBMD5^XUMF676(XFILE,"1^30^^^",XFIEN,1)
"RTN","XUMF676P",74,0)
 D SUBMD5^XUMF676(XFILE,"99.99^10^^^",XFIEN,99.99)
"RTN","XUMF676P",75,0)
 S XFIEN=120.832
"RTN","XUMF676P",76,0)
 D SCMD5^XUMF676(XFILE,XFIEN)
"RTN","XUMF676P",77,0)
 D SUBMD5^XUMF676(XFILE,".01^30^^^^",XFIEN,.01)
"RTN","XUMF676P",78,0)
 S XFIEN=120.833
"RTN","XUMF676P",79,0)
 D SCMD5^XUMF676(XFILE,XFIEN)
"RTN","XUMF676P",80,0)
 D SUBMD5^XUMF676(XFILE,".01^40^^^^D M12083^GMRAVZRT",XFIEN,.01)
"RTN","XUMF676P",81,0)
  ;---------------------------------------------------
"RTN","XUMFQR")
0^3^B56159331^B53643395
"RTN","XUMFQR",1,0)
XUMFQR ;ISS/RAM - Master File Query Response ;02/10/2017
"RTN","XUMFQR",2,0)
 ;;8.0;KERNEL;**407,502,676**;Jul 10, 1995;Build 8
"RTN","XUMFQR",3,0)
 ;Per VHA Directive 10-92-142, this routine should not be modified
"RTN","XUMFQR",4,0)
 ;
"RTN","XUMFQR",5,0)
 Q
"RTN","XUMFQR",6,0)
 ;
"RTN","XUMFQR",7,0)
MAIN ; -- main
"RTN","XUMFQR",8,0)
 ;
"RTN","XUMFQR",9,0)
 N FIELD1,IDX,IDX1,NAME1,SUBFILE1,DATA1,IEN1,TYP1,MKEY,MKEY1,TYP,VUID,VUID1
"RTN","XUMFQR",10,0)
 N MFI,SEQ,NAME,QRD,SEQ,SUBFILE,IEN,CNT,DATA,ERROR,SORTBY,FILTERBY,FILTER,ERRCNT
"RTN","XUMFQR",11,0)
 ;
"RTN","XUMFQR",12,0)
 D INIT,PROCESS,MFR,SEND,EXIT
"RTN","XUMFQR",13,0)
 ;
"RTN","XUMFQR",14,0)
 Q
"RTN","XUMFQR",15,0)
 ;
"RTN","XUMFQR",16,0)
INIT ; -- initialize
"RTN","XUMFQR",17,0)
 ;
"RTN","XUMFQR",18,0)
 K ^TMP("HLA",$J)
"RTN","XUMFQR",19,0)
 ;
"RTN","XUMFQR",20,0)
 S ERROR=0,CNT=1,ERRCNT=0
"RTN","XUMFQR",21,0)
 ;
"RTN","XUMFQR",22,0)
 S HLFS=HL("FS"),HLCS=$E(HL("ECH")),HLSCS=$E(HL("ECH"),4)
"RTN","XUMFQR",23,0)
 ;
"RTN","XUMFQR",24,0)
 Q
"RTN","XUMFQR",25,0)
 ;
"RTN","XUMFQR",26,0)
PROCESS ; -- pull message text
"RTN","XUMFQR",27,0)
 ;
"RTN","XUMFQR",28,0)
 F  X HLNEXT Q:HLQUIT'>0  D
"RTN","XUMFQR",29,0)
 .Q:$P(HLNODE,HLFS)=""
"RTN","XUMFQR",30,0)
 .Q:"^MSH^MSA^QRD^"'[(U_$P(HLNODE,HLFS)_U)
"RTN","XUMFQR",31,0)
 .D @($P(HLNODE,HLFS))
"RTN","XUMFQR",32,0)
 ;
"RTN","XUMFQR",33,0)
 Q
"RTN","XUMFQR",34,0)
 ;
"RTN","XUMFQR",35,0)
MSH ; -- MSH segment
"RTN","XUMFQR",36,0)
 ;
"RTN","XUMFQR",37,0)
 Q
"RTN","XUMFQR",38,0)
 ;
"RTN","XUMFQR",39,0)
QRD ; -- QRD segment
"RTN","XUMFQR",40,0)
 ;
"RTN","XUMFQR",41,0)
 Q:ERROR
"RTN","XUMFQR",42,0)
 ;
"RTN","XUMFQR",43,0)
 S MFI=$P(HLNODE,HLFS,10),FILTER=$P(MFI,HLCS,2),MFI=$P(MFI,HLCS)
"RTN","XUMFQR",44,0)
 I MFI="" S ERROR="1^MFI not resolved HLNODE: "_$TR(HLNODE,HLFS,"#") Q
"RTN","XUMFQR",45,0)
 S IFN=$O(^DIC(4.001,"MFID",MFI,0))
"RTN","XUMFQR",46,0)
 I 'IFN S ERROR="1^IFN not resolved HLNODE: "_$TR(HLNODE,HLFS,"#") Q
"RTN","XUMFQR",47,0)
 I '$$VFILE^DILFD(IFN) S ERROR="1^invalid file number" Q
"RTN","XUMFQR",48,0)
 S DATA=$G(^DIC(4.001,+IFN,0)),SORTBY=$P(DATA,U,8),FILTERBY=$P(DATA,U,9)
"RTN","XUMFQR",49,0)
 ;
"RTN","XUMFQR",50,0)
 ; -- get root of file
"RTN","XUMFQR",51,0)
 S ROOT=$$ROOT^DILFD(IFN,,1)
"RTN","XUMFQR",52,0)
 ;
"RTN","XUMFQR",53,0)
 S QRD=HLNODE
"RTN","XUMFQR",54,0)
 ;
"RTN","XUMFQR",55,0)
 Q
"RTN","XUMFQR",56,0)
 ;
"RTN","XUMFQR",57,0)
MFR ; -- response
"RTN","XUMFQR",58,0)
 ;
"RTN","XUMFQR",59,0)
 D MSA,QRD1,MFI,MFE
"RTN","XUMFQR",60,0)
 ;
"RTN","XUMFQR",61,0)
 Q
"RTN","XUMFQR",62,0)
 ;
"RTN","XUMFQR",63,0)
MSA ; -- Acknowledgement
"RTN","XUMFQR",64,0)
 ;
"RTN","XUMFQR",65,0)
 N X
"RTN","XUMFQR",66,0)
 S X="MSA"_HLFS_$S(ERROR:"AE",1:"AA")_HLFS_HL("MID")_HLFS_$P(ERROR,U,2)
"RTN","XUMFQR",67,0)
 S ^TMP("HLA",$J,CNT)=X
"RTN","XUMFQR",68,0)
 S CNT=CNT+1
"RTN","XUMFQR",69,0)
 ;
"RTN","XUMFQR",70,0)
 Q
"RTN","XUMFQR",71,0)
 ;
"RTN","XUMFQR",72,0)
QRD1 ; -- query definition segment
"RTN","XUMFQR",73,0)
 ;
"RTN","XUMFQR",74,0)
 Q:ERROR
"RTN","XUMFQR",75,0)
 ;
"RTN","XUMFQR",76,0)
 S ^TMP("HLA",$J,CNT)=$G(QRD)
"RTN","XUMFQR",77,0)
 S CNT=CNT+1
"RTN","XUMFQR",78,0)
 ;
"RTN","XUMFQR",79,0)
 Q
"RTN","XUMFQR",80,0)
 ;
"RTN","XUMFQR",81,0)
MFI ; master file identifier segment
"RTN","XUMFQR",82,0)
 ;
"RTN","XUMFQR",83,0)
 Q:ERROR
"RTN","XUMFQR",84,0)
 ;
"RTN","XUMFQR",85,0)
 S ^TMP("HLA",$J,CNT)=$$MFI^XUMFMFI(MFI,"Standard Terminology","MUP",$$NOW^XLFDT,$$NOW^XLFDT,"NE")
"RTN","XUMFQR",86,0)
 S CNT=CNT+1
"RTN","XUMFQR",87,0)
 ;
"RTN","XUMFQR",88,0)
 Q
"RTN","XUMFQR",89,0)
 ;
"RTN","XUMFQR",90,0)
MFE ; master file entry segment
"RTN","XUMFQR",91,0)
 ;
"RTN","XUMFQR",92,0)
 Q:ERROR
"RTN","XUMFQR",93,0)
 ;
"RTN","XUMFQR",94,0)
 S VUID=0 F  S VUID=$O(@ROOT@($S(SORTBY'="":SORTBY,1:"AMASTERVUID"),VUID)) Q:'VUID  D  Q:ERROR
"RTN","XUMFQR",95,0)
 .I SORTBY="" S IEN=$O(@ROOT@("AMASTERVUID",VUID,1,0)) Q:'IEN
"RTN","XUMFQR",96,0)
 .I SORTBY'="" S IEN=$O(@ROOT@(SORTBY,VUID,0)) Q:'IEN
"RTN","XUMFQR",97,0)
 .;
"RTN","XUMFQR",98,0)
 .I FILTER'="" D  Q:VALUE'=FILTER
"RTN","XUMFQR",99,0)
 ..S DATA=$G(^DIC(4.001,+IFN,0)),FILTERBY=$P(DATA,U,9)
"RTN","XUMFQR",100,0)
 ..I FILTERBY="" S VALUE="ERROR" Q  ;add error processing
"RTN","XUMFQR",101,0)
 ..S IDX=$O(^DIC(4.001,+IFN,1,"B",FILTERBY,0))
"RTN","XUMFQR",102,0)
 ..S DATA=$G(^DIC(4.001,+IFN,1,+IDX,0)),FIELD=$P(DATA,U,2)
"RTN","XUMFQR",103,0)
 ..S TYP=$P(DATA,U,3),TYP=$$GET1^DIQ(771.4,(+TYP_","),.01)
"RTN","XUMFQR",104,0)
 ..S VUID1=$P(DATA,U,13)
"RTN","XUMFQR",105,0)
 ..S VALUE=$$VVAL(IFN,IEN_",",FIELD,$G(VUID1),TYP)
"RTN","XUMFQR",106,0)
 .;
"RTN","XUMFQR",107,0)
 .S ^TMP("HLA",$J,CNT)=$$MFE^XUMFMFE("MUP","",$$NOW^XLFDT,MFI_"@"_VUID)
"RTN","XUMFQR",108,0)
 .S CNT=CNT+1
"RTN","XUMFQR",109,0)
 .D ZRT
"RTN","XUMFQR",110,0)
 ;
"RTN","XUMFQR",111,0)
 Q
"RTN","XUMFQR",112,0)
 ;
"RTN","XUMFQR",113,0)
ZRT ; data segments
"RTN","XUMFQR",114,0)
 ;
"RTN","XUMFQR",115,0)
 Q:ERROR
"RTN","XUMFQR",116,0)
 ;
"RTN","XUMFQR",117,0)
 S SEQ=0
"RTN","XUMFQR",118,0)
 F  S SEQ=$O(^DIC(4.001,IFN,1,"ASEQ",SEQ)) Q:'SEQ  D
"RTN","XUMFQR",119,0)
 .S IDX=$O(^DIC(4.001,IFN,1,"ASEQ",SEQ,0)) Q:'IDX
"RTN","XUMFQR",120,0)
 .S DATA=$G(^DIC(4.001,+IFN,1,+IDX,0)),NAME=$P(DATA,U)
"RTN","XUMFQR",121,0)
 .S TYP=$P(DATA,U,3),TYP=$$GET1^DIQ(771.4,(+TYP_","),.01)
"RTN","XUMFQR",122,0)
 .S FIELD=$P(DATA,U,2),SUBFILE=$P(DATA,U,4),MKEY=$P(DATA,U,6)
"RTN","XUMFQR",123,0)
 .S VUID1=$P(DATA,U,13),WP=$P(DATA,U,16)
"RTN","XUMFQR",124,0)
 .;
"RTN","XUMFQR",125,0)
 .I NAME="Status" D  Q
"RTN","XUMFQR",126,0)
 ..S:IFN'=757.33 ^TMP("HLA",$J,CNT)="ZRT"_HLFS_NAME_HLFS_(+$P($$GETSTAT^XTID(IFN,,IEN_","),U))
"RTN","XUMFQR",127,0)
 ..S:IFN=757.33 ^TMP("HLA",$J,CNT)="ZRT"_HLFS_NAME_HLFS_$$STAT^XUMF502
"RTN","XUMFQR",128,0)
 ..S CNT=CNT+1
"RTN","XUMFQR",129,0)
 .;
"RTN","XUMFQR",130,0)
 .I WP D WP Q
"RTN","XUMFQR",131,0)
 .;
"RTN","XUMFQR",132,0)
 .I SUBFILE D SUBFILE Q
"RTN","XUMFQR",133,0)
 .;
"RTN","XUMFQR",134,0)
 .S VALUE=$$VALUE(IFN,IEN_",",FIELD,VUID1,TYP) ;Q:VALUE=""
"RTN","XUMFQR",135,0)
 .;
"RTN","XUMFQR",136,0)
 .S ^TMP("HLA",$J,CNT)="ZRT"_HLFS_NAME_HLFS_VALUE
"RTN","XUMFQR",137,0)
 .S CNT=CNT+1
"RTN","XUMFQR",138,0)
 ;
"RTN","XUMFQR",139,0)
 Q
"RTN","XUMFQR",140,0)
 ;
"RTN","XUMFQR",141,0)
SUBFILE ;
"RTN","XUMFQR",142,0)
 ;
"RTN","XUMFQR",143,0)
 Q:ERROR
"RTN","XUMFQR",144,0)
 ;
"RTN","XUMFQR",145,0)
 I NAME="Status" D  Q
"RTN","XUMFQR",146,0)
 .S:IFN'=757.33 ^TMP("HLA",$J,CNT)="ZRT"_HLFS_NAME_HLFS_+$$GETSTAT^XTID(IFN,,IEN_",")
"RTN","XUMFQR",147,0)
 .S:IFN=757.33 ^TMP("HLA",$J,CNT)="ZRT"_HLFS_NAME_HLFS_$$STAT^XUMF502
"RTN","XUMFQR",148,0)
 .S CNT=CNT+1
"RTN","XUMFQR",149,0)
 ;
"RTN","XUMFQR",150,0)
 N ROOT
"RTN","XUMFQR",151,0)
 ;
"RTN","XUMFQR",152,0)
 S ROOT=$$ROOT^DILFD(SUBFILE,(","_IEN_","),1)
"RTN","XUMFQR",153,0)
 ;
"RTN","XUMFQR",154,0)
 I MKEY="" S ERROR="1^null lookup column parameter for subfile: "_SUBFILE Q
"RTN","XUMFQR",155,0)
 ;
"RTN","XUMFQR",156,0)
 S IEN1=0
"RTN","XUMFQR",157,0)
 F  S IEN1=$O(@ROOT@(IEN1)) Q:'IEN1  D  Q:ERROR
"RTN","XUMFQR",158,0)
 .;
"RTN","XUMFQR",159,0)
 .I $D(^DIC(4.001,IFN,1,IDX,1,"ASEQ1")) D SUBREC Q
"RTN","XUMFQR",160,0)
 .;
"RTN","XUMFQR",161,0)
 .S VALUE=$$VALUE(SUBFILE,IEN1_","_IEN_",",FIELD,VUID1,TYP) ;Q:VALUE=""
"RTN","XUMFQR",162,0)
 .;
"RTN","XUMFQR",163,0)
 .S ^TMP("HLA",$J,CNT)="ZRT"_HLFS_NAME_HLFS_VALUE
"RTN","XUMFQR",164,0)
 .S CNT=CNT+1
"RTN","XUMFQR",165,0)
 ;
"RTN","XUMFQR",166,0)
 Q
"RTN","XUMFQR",167,0)
 ;
"RTN","XUMFQR",168,0)
SUBREC ; -- sub-records
"RTN","XUMFQR",169,0)
 ;
"RTN","XUMFQR",170,0)
 Q:ERROR
"RTN","XUMFQR",171,0)
 ;
"RTN","XUMFQR",172,0)
 N SEQ1,FIELD1,NAME1,VUID2,TYP2
"RTN","XUMFQR",173,0)
 ;
"RTN","XUMFQR",174,0)
 S SEQ1=0
"RTN","XUMFQR",175,0)
 F  S SEQ1=$O(^DIC(4.001,IFN,1,IDX,1,"ASEQ1",SEQ1)) Q:'SEQ1  D  Q:ERROR
"RTN","XUMFQR",176,0)
 .S IDX1=$O(^DIC(4.001,IFN,1,IDX,1,"ASEQ1",SEQ1,0))
"RTN","XUMFQR",177,0)
 .;
"RTN","XUMFQR",178,0)
 .S NAME1=$P(^DIC(4.001,IFN,1,IDX,1,IDX1,0),U,2)
"RTN","XUMFQR",179,0)
 .I NAME1="" S ERROR="1^subrecord sequence name missing SUBFILE : "_SUBFILE Q
"RTN","XUMFQR",180,0)
 .S FIELD1=$P(^DIC(4.001,IFN,1,IDX,1,IDX1,0),U,3)
"RTN","XUMFQR",181,0)
 .I FIELD1="" S ERROR="1^subrecord sequence number missing SUBFILE : "_SUBFILE Q
"RTN","XUMFQR",182,0)
 .S VUID2=$P(^DIC(4.001,IFN,1,IDX,1,IDX1,0),U,4)
"RTN","XUMFQR",183,0)
 .S TYP2=$P(^DIC(4.001,IFN,1,IDX,1,IDX1,0),U,5)
"RTN","XUMFQR",184,0)
 .;
"RTN","XUMFQR",185,0)
 .S VALUE=$$VALUE(SUBFILE,IEN1_","_IEN_",",FIELD1,VUID2,TYP2) ;Q:VALUE=""
"RTN","XUMFQR",186,0)
 .;
"RTN","XUMFQR",187,0)
 .S ^TMP("HLA",$J,CNT)="ZRT"_HLFS_NAME1_HLFS_VALUE
"RTN","XUMFQR",188,0)
 .S CNT=CNT+1
"RTN","XUMFQR",189,0)
 ;
"RTN","XUMFQR",190,0)
 Q
"RTN","XUMFQR",191,0)
 ;
"RTN","XUMFQR",192,0)
SEND ; -- send HL7 message
"RTN","XUMFQR",193,0)
 ;
"RTN","XUMFQR",194,0)
 X:$D(^DIC(4.001,IFN,6))#2 ^DIC(4.001,IFN,6) ;p676 requested from the STS team - Randall Stewart and Jeff Udell
"RTN","XUMFQR",195,0)
 S HLP("PRIORITY")="I"
"RTN","XUMFQR",196,0)
 D GENACK^HLMA1(HL("EID"),HLMTIENS,HL("EIDS"),"GM",1,.HLRESLT)
"RTN","XUMFQR",197,0)
 ;
"RTN","XUMFQR",198,0)
 ; check for error
"RTN","XUMFQR",199,0)
 I ($P($G(HLRESLT),U,3)'="") D  Q
"RTN","XUMFQR",200,0)
 .S ERROR=1_U_$P(HLRESLT,HLFS,3)_U_$P(HLRESLT,HLFS,2)_U_$P(HLRESLT,U)
"RTN","XUMFQR",201,0)
 ;
"RTN","XUMFQR",202,0)
 ; successful call, message ID returned
"RTN","XUMFQR",203,0)
 S ERROR="0^"_$P($G(HLRESLT),U,1)
"RTN","XUMFQR",204,0)
 ;
"RTN","XUMFQR",205,0)
 Q
"RTN","XUMFQR",206,0)
 ;
"RTN","XUMFQR",207,0)
EXIT ; -- exit
"RTN","XUMFQR",208,0)
 ;
"RTN","XUMFQR",209,0)
 D CLEAN^DILF
"RTN","XUMFQR",210,0)
 ;
"RTN","XUMFQR",211,0)
 K ^TMP("HLA",$J)
"RTN","XUMFQR",212,0)
 ;
"RTN","XUMFQR",213,0)
 Q
"RTN","XUMFQR",214,0)
 ;
"RTN","XUMFQR",215,0)
WP ;
"RTN","XUMFQR",216,0)
 ;
"RTN","XUMFQR",217,0)
 N WP,I,J
"RTN","XUMFQR",218,0)
 ;
"RTN","XUMFQR",219,0)
 S I=$$GET1^DIQ(IFN,IEN_",",FIELD,,"WP")
"RTN","XUMFQR",220,0)
 ;
"RTN","XUMFQR",221,0)
 Q:'$D(WP)
"RTN","XUMFQR",222,0)
 ;
"RTN","XUMFQR",223,0)
 S ^TMP("HLA",$J,CNT)="ZRT"_HLFS_NAME_HLFS_$G(WP(1))
"RTN","XUMFQR",224,0)
 ;
"RTN","XUMFQR",225,0)
 S I=1,J=1
"RTN","XUMFQR",226,0)
 F  S I=$O(WP(I)) Q:'I  D
"RTN","XUMFQR",227,0)
 .S ^TMP("HLA",$J,CNT,J)=WP(I)
"RTN","XUMFQR",228,0)
 .S J=J+1
"RTN","XUMFQR",229,0)
 ;
"RTN","XUMFQR",230,0)
 S CNT=CNT+1
"RTN","XUMFQR",231,0)
 ;
"RTN","XUMFQR",232,0)
 Q
"RTN","XUMFQR",233,0)
 ;
"RTN","XUMFQR",234,0)
ESC(VALUE) ;
"RTN","XUMFQR",235,0)
 ;
"RTN","XUMFQR",236,0)
 I VALUE["^" F  Q:VALUE'["^"  D
"RTN","XUMFQR",237,0)
 .S VALUE=$P(VALUE,"^")_"\F\"_$P(VALUE,"^",2,9999)
"RTN","XUMFQR",238,0)
 I VALUE["&" F  Q:VALUE'["&"  D
"RTN","XUMFQR",239,0)
 .S VALUE=$P(VALUE,"&")_"\T\"_$P(VALUE,"&",2,9999)
"RTN","XUMFQR",240,0)
 ;
"RTN","XUMFQR",241,0)
 Q VALUE
"RTN","XUMFQR",242,0)
 ;
"RTN","XUMFQR",243,0)
VVAL(IFN,IENS,FIELD,VUID,TYP) ;
"RTN","XUMFQR",244,0)
 ;
"RTN","XUMFQR",245,0)
 Q:IFN="" "" Q:FIELD="" "" Q:IENS="" ""
"RTN","XUMFQR",246,0)
 ;
"RTN","XUMFQR",247,0)
 S:$G(TYP)="" TYP="ST"
"RTN","XUMFQR",248,0)
 S VUID=$S($G(VUID)'="":":99.99",1:"")
"RTN","XUMFQR",249,0)
 I IFN=757.33,$G(VUID)'="" S VUID=":5"
"RTN","XUMFQR",250,0)
 ;
"RTN","XUMFQR",251,0)
 S VALUE=$$GET1^DIQ(IFN,IENS,FIELD_VUID) Q:VALUE="" ""
"RTN","XUMFQR",252,0)
 ;S VALUE=$$GET1^DIQ(IFN,IENS,FIELD) Q:VALUE="" ""
"RTN","XUMFQR",253,0)
 S VALUE=$$DTYP^XUMFP(VALUE,TYP,HLCS,1)
"RTN","XUMFQR",254,0)
 S VALUE=$$ESC(VALUE)
"RTN","XUMFQR",255,0)
 ;
"RTN","XUMFQR",256,0)
 ;I IFN=757.32,FIELD=.02 Q $$MAPDEF
"RTN","XUMFQR",257,0)
 ;
"RTN","XUMFQR",258,0)
 ;Q $$VAL^XUMF0(IFN,FIELD,VUID,VALUE,IENS)
"RTN","XUMFQR",259,0)
 ;
"RTN","XUMFQR",260,0)
 Q VALUE
"RTN","XUMFQR",261,0)
 ;
"RTN","XUMFQR",262,0)
VALUE(IFN,IENS,FIELD,VUID,TYP) ;
"RTN","XUMFQR",263,0)
 ;
"RTN","XUMFQR",264,0)
 Q:IFN="" "" Q:FIELD="" "" Q:IENS="" ""
"RTN","XUMFQR",265,0)
 ;
"RTN","XUMFQR",266,0)
 S:$G(TYP)="" TYP="ST"
"RTN","XUMFQR",267,0)
 ;
"RTN","XUMFQR",268,0)
 S VALUE=$$GET1^DIQ(IFN,IENS,FIELD) Q:VALUE="" ""
"RTN","XUMFQR",269,0)
 S VALUE=$$DTYP^XUMFP(VALUE,TYP,HLCS,1)
"RTN","XUMFQR",270,0)
 S VALUE=$$ESC(VALUE)
"RTN","XUMFQR",271,0)
 ;
"RTN","XUMFQR",272,0)
 I IFN=757.33,FIELD=.02 Q $$MAPDEF
"RTN","XUMFQR",273,0)
 ;
"RTN","XUMFQR",274,0)
 Q VALUE
"RTN","XUMFQR",275,0)
 ;
"RTN","XUMFQR",276,0)
MAPDEF() ;
"RTN","XUMFQR",277,0)
 ;
"RTN","XUMFQR",278,0)
 N X,Y
"RTN","XUMFQR",279,0)
 S X=$O(^LEX(757.32,"B",VALUE,0)) Q:'X 0
"RTN","XUMFQR",280,0)
 S Y=$G(^LEX(757.32,X,2))
"RTN","XUMFQR",281,0)
 Q $P(Y,U,3)
"RTN","XUMFQR",282,0)
 ;
"VER")
8.0^22.0
"^DD",4.001,4.001,6,0)
ZRT-DISCOVERY LOGIC^K^^6;E1,245^K:$L(X)>245 X D:$D(X) ^DIM
"^DD",4.001,4.001,6,3)
Enter Standard MUMPS code.
"^DD",4.001,4.001,6,9)
@
"^DD",4.001,4.001,6,21,0)
^^2^2^3170119^
"^DD",4.001,4.001,6,21,1,0)
This is standard MUMPS code that gets execute in DISCOVERY for each ZRT
"^DD",4.001,4.001,6,21,2,0)
segment.  
"^DD",4.001,4.001,6,"DT")
3170119
"BLD",1584,6)
^528
**END**
**END**

