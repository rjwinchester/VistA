Released XU*8*631 SEQ #511
Extracted from mail message
**KIDS**:XU*8.0*631^

**INSTALL NAME**
XU*8.0*631
"BLD",1504,0)
XU*8.0*631^KERNEL^0^3140708^y
"BLD",1504,1,0)
^^3^3^3130604^^
"BLD",1504,1,1,0)
 
"BLD",1504,1,2,0)
This patch fixes code in XQARPRT1 to point to the new Alert Critical Text
"BLD",1504,1,3,0)
File 8992.3 to search for  critical text to flag an alert as critical.
"BLD",1504,4,0)
^9.64PA^^
"BLD",1504,6.3)
5
"BLD",1504,"ABPKG")
n
"BLD",1504,"KRN",0)
^9.67PA^9002226^22
"BLD",1504,"KRN",.4,0)
.4
"BLD",1504,"KRN",.401,0)
.401
"BLD",1504,"KRN",.402,0)
.402
"BLD",1504,"KRN",.403,0)
.403
"BLD",1504,"KRN",.5,0)
.5
"BLD",1504,"KRN",.84,0)
.84
"BLD",1504,"KRN",3.6,0)
3.6
"BLD",1504,"KRN",3.8,0)
3.8
"BLD",1504,"KRN",9.2,0)
9.2
"BLD",1504,"KRN",9.8,0)
9.8
"BLD",1504,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",1504,"KRN",9.8,"NM",1,0)
XQARPRT1^^0^B87729690
"BLD",1504,"KRN",9.8,"NM","B","XQARPRT1",1)

"BLD",1504,"KRN",19,0)
19
"BLD",1504,"KRN",19.1,0)
19.1
"BLD",1504,"KRN",101,0)
101
"BLD",1504,"KRN",409.61,0)
409.61
"BLD",1504,"KRN",771,0)
771
"BLD",1504,"KRN",779.2,0)
779.2
"BLD",1504,"KRN",870,0)
870
"BLD",1504,"KRN",8989.51,0)
8989.51
"BLD",1504,"KRN",8989.52,0)
8989.52
"BLD",1504,"KRN",8993,0)
8993
"BLD",1504,"KRN",8994,0)
8994
"BLD",1504,"KRN",9002226,0)
9002226
"BLD",1504,"KRN","B",.4,.4)

"BLD",1504,"KRN","B",.401,.401)

"BLD",1504,"KRN","B",.402,.402)

"BLD",1504,"KRN","B",.403,.403)

"BLD",1504,"KRN","B",.5,.5)

"BLD",1504,"KRN","B",.84,.84)

"BLD",1504,"KRN","B",3.6,3.6)

"BLD",1504,"KRN","B",3.8,3.8)

"BLD",1504,"KRN","B",9.2,9.2)

"BLD",1504,"KRN","B",9.8,9.8)

"BLD",1504,"KRN","B",19,19)

"BLD",1504,"KRN","B",19.1,19.1)

"BLD",1504,"KRN","B",101,101)

"BLD",1504,"KRN","B",409.61,409.61)

"BLD",1504,"KRN","B",771,771)

"BLD",1504,"KRN","B",779.2,779.2)

"BLD",1504,"KRN","B",870,870)

"BLD",1504,"KRN","B",8989.51,8989.51)

"BLD",1504,"KRN","B",8989.52,8989.52)

"BLD",1504,"KRN","B",8993,8993)

"BLD",1504,"KRN","B",8994,8994)

"BLD",1504,"KRN","B",9002226,9002226)

"BLD",1504,"QDEF")
^^^^^^^^^^YES
"BLD",1504,"QUES",0)
^9.62^^
"BLD",1504,"REQB",0)
^9.611^^
"MBREQ")
0
"PKG",3,-1)
1^1
"PKG",3,0)
KERNEL^XU^SIGN-ON, SECURITY, MENU DRIVER, DEVICES, TASKMAN^
"PKG",3,22,0)
^9.49I^1^1
"PKG",3,22,1,0)
8.0^3090706^3090706^6
"PKG",3,22,1,"PAH",1,0)
631^3140708
"PKG",3,22,1,"PAH",1,1,0)
^^3^3^3140708
"PKG",3,22,1,"PAH",1,1,1,0)
 
"PKG",3,22,1,"PAH",1,1,2,0)
This patch fixes code in XQARPRT1 to point to the new Alert Critical Text
"PKG",3,22,1,"PAH",1,1,3,0)
File 8992.3 to search for  critical text to flag an alert as critical.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","XQARPRT1")
0^1^B87729690^B84796836
"RTN","XQARPRT1",1,0)
XQARPRT1 ;sgh/mtz,JLI/OAK_OIFO-ROUTINE TO PROVIDE COUNTS OF ALERTS ;9/3/03  11:17
"RTN","XQARPRT1",2,0)
 ;;8.0;KERNEL;**316,338,631**;Jul 10, 1995;Build 5
"RTN","XQARPRT1",3,0)
 ;Per VA Directive 6402, this routine should not be modified.
"RTN","XQARPRT1",4,0)
 ; based on an original routine AMNUALT
"RTN","XQARPRT1",5,0)
EN1 ; OPT - generates a listing of the number of alerts a user has as well as last sign-on date, number of critical and/or abnomal imaging alerts, and the date of the oldest alert
"RTN","XQARPRT1",6,0)
 N XQACRIT S XQACRIT=0
"RTN","XQARPRT1",7,0)
EN2 ;
"RTN","XQARPRT1",8,0)
 N XQASDT,XQAEDT,XQAC1,XQAORDER,Y,DIR,%ZIS,POP,ZTSAVE,ZTDESC,ZTRTN
"RTN","XQARPRT1",9,0)
 N SHOWDIV,DIVISION,I,DATE,DIRUT,SERVICE,SERVSRT,ALLSERV,XQAWORDS
"RTN","XQARPRT1",10,0)
 I 'XQACRIT D WORDS^XQARPRT2("A") K Y
"RTN","XQARPRT1",11,0)
 S DIR(0)="NO",DIR("A")="Display users whose "_$S(XQACRIT:"CRITICAL ",1:"")_"ALERT count is at least"
"RTN","XQARPRT1",12,0)
 S DIR("B")=$S(XQACRIT:10,1:100) D ^DIR K DIR Q:Y'>0  S XQAC1=Y
"RTN","XQARPRT1",13,0)
 D DATES Q:Y'>0
"RTN","XQARPRT1",14,0)
 D QUERYDIV Q:$D(DIRUT)  D ORDER Q:XQAORDER'>0
"RTN","XQARPRT1",15,0)
 S %ZIS="MQ" D ^%ZIS Q:POP  I $D(IO("Q")) K IO("Q") S ZTRTN="DQ1^XQARPRT1",ZTDESC="How Many "_$S(XQACRIT:"Critical ",1:"")_"Alerts",ZTSAVE("*")="" D ^%ZTLOAD W:$G(ZTSK)>0 !,"Task number is ",ZTSK K ZTSK Q
"RTN","XQARPRT1",16,0)
 G DQ1
"RTN","XQARPRT1",17,0)
 ;
"RTN","XQARPRT1",18,0)
CRITICAL ; OPT - generates a listing of users with more than a specified number of alerts containing CRITICAL or ABNORMAL IMAGING
"RTN","XQARPRT1",19,0)
 N XQACRIT S XQACRIT=1
"RTN","XQARPRT1",20,0)
 G EN2
"RTN","XQARPRT1",21,0)
 ;
"RTN","XQARPRT1",22,0)
DATES ;
"RTN","XQARPRT1",23,0)
 S DIR(0)="DO",DIR("A")="START DATE"
"RTN","XQARPRT1",24,0)
 D ^DIR K DIR Q:Y'>0
"RTN","XQARPRT1",25,0)
 S XQASDT=Y
"RTN","XQARPRT1",26,0)
 S DIR(0)="DO^"_XQASDT_":DT",DIR("A")="END DATE"
"RTN","XQARPRT1",27,0)
 D ^DIR K DIR Q:Y'>0
"RTN","XQARPRT1",28,0)
 S XQAEDT=Y_".24"
"RTN","XQARPRT1",29,0)
 Q
"RTN","XQARPRT1",30,0)
 ;
"RTN","XQARPRT1",31,0)
QUERYDIV ;
"RTN","XQARPRT1",32,0)
 S DIR(0)="Y",DIR("A")="Breakout by One or More Divisions",DIR("?")="Entering YES will result in the entries being grouped by DIVISION." D ^DIR K DIR S DIVISION=+Y Q:$D(DIRUT)
"RTN","XQARPRT1",33,0)
 I DIVISION D  Q:SHOWDIV'>0
"RTN","XQARPRT1",34,0)
 . S DIR(0)="Y",DIR("A")="Show ALL Divisions",DIR("?",1)="Entering YES will result in the analysis being performed for ALL Divisons,",DIR("?")="A NO will result in prompts to select which division(S) you want listed."
"RTN","XQARPRT1",35,0)
 . D ^DIR K DIR I +Y D  I 1
"RTN","XQARPRT1",36,0)
 . . S DIR(0)="S^1:Show only as 'Multiple Division';2:Show in EACH Division",DIR("A")="If a user has more than one division"
"RTN","XQARPRT1",37,0)
 . . S DIR("?",1)="If New Person entries have multiple divisions, entering 1 will result in",DIR("?",2)="those entries being shown only under a heading of 'These users are assigned"
"RTN","XQARPRT1",38,0)
 . . S DIR("?",3)="to multiple divisions', while entering 2 will result in the data for a",DIR("?",4)="specific New Person entry  being shown under each division heading which",DIR("?")="that entry may select."
"RTN","XQARPRT1",39,0)
 . . D ^DIR K DIR S SHOWDIV=+Y
"RTN","XQARPRT1",40,0)
 . . Q
"RTN","XQARPRT1",41,0)
 . E  S SHOWDIV=2 D  K DIRUT
"RTN","XQARPRT1",42,0)
 . . F I=1:1 S DIR(0)="PO^4:EMZ",DIR("A")="Select "_$S(I>1:"Another ",1:"")_"Division: " D ^DIR K DIR Q:Y'>0  S DIVISION($P(Y,U,2))=""
"RTN","XQARPRT1",43,0)
 . Q
"RTN","XQARPRT1",44,0)
 Q
"RTN","XQARPRT1",45,0)
 ;
"RTN","XQARPRT1",46,0)
ORDER ;
"RTN","XQARPRT1",47,0)
 S DIR(0)="SO^;1:By Name;2:By Number;3:By Service/Section;",DIR("A")="Select the ordering of results desired",DIR("?",1)="Select a number to indicate how you would like the selected entries to be"
"RTN","XQARPRT1",48,0)
 S DIR("?",2)="listed by"_$S(DIVISION:" (Within Division)",1:"")_": the New Person entrie's Name; the Number of "_$S(DIVISION:"",1:$S(XQACRIT:"Critical ",1:"")_"Alerts,")
"RTN","XQARPRT1",49,0)
 S DIR("?")=$S(DIVISION:$S(XQACRIT:"Critical ",1:"")_"Alerts, ",1:"")_"or by Service/Section"
"RTN","XQARPRT1",50,0)
 D ^DIR K DIR S XQAORDER=+Y
"RTN","XQARPRT1",51,0)
 I XQAORDER=3 D  Q:$D(DIRUT)
"RTN","XQARPRT1",52,0)
 . S DIR(0)="Y",DIR("A")="Show ALL Service/Sections",DIR("?",1)="Entering YES will result in the analysis being performed for ALL Services,",DIR("?")="A NO will result in prompts to select which Service(s) you want listed."
"RTN","XQARPRT1",53,0)
 . D ^DIR K DIR Q:$D(DIRUT)  S ALLSERV=+Y
"RTN","XQARPRT1",54,0)
 . I 'ALLSERV D
"RTN","XQARPRT1",55,0)
 . . S DIR(0)="PO^49:EMZ" F I=1:1 S DIR("A")="Select "_$S(I>1:"Another ",1:"")_"Service/Section" D ^DIR Q:Y'>0  S SERVICE($E($P(Y,U,2),1,17))=""
"RTN","XQARPRT1",56,0)
 . . K DIR
"RTN","XQARPRT1",57,0)
 . . Q
"RTN","XQARPRT1",58,0)
 . S DIR(0)="SO^;1:By Name;2:By Number;",DIR("A")="Within Service/Section order results by" D ^DIR K DIR Q:$D(DIRUT)  S SERVSRT=+Y
"RTN","XQARPRT1",59,0)
 . Q
"RTN","XQARPRT1",60,0)
 Q
"RTN","XQARPRT1",61,0)
 ;
"RTN","XQARPRT1",62,0)
DQ1 ;
"RTN","XQARPRT1",63,0)
 N XQAGLOB,XQAN1
"RTN","XQARPRT1",64,0)
 S XQAGLOB=$NA(^TMP("XQARPRT1",$J)) K @XQAGLOB
"RTN","XQARPRT1",65,0)
 U IO
"RTN","XQARPRT1",66,0)
 D G1,PRT
"RTN","XQARPRT1",67,0)
 D ^%ZISC
"RTN","XQARPRT1",68,0)
 K @XQAGLOB
"RTN","XQARPRT1",69,0)
 Q
"RTN","XQARPRT1",70,0)
 ;
"RTN","XQARPRT1",71,0)
G1 ;gather
"RTN","XQARPRT1",72,0)
 N COUNT,MSG,DATE,CRITMSG
"RTN","XQARPRT1",73,0)
 F XQAN1=0:0 S XQAN1=$O(^XTV(8992,XQAN1)) Q:XQAN1'>0  D
"RTN","XQARPRT1",74,0)
 . S COUNT=0,OLDEST=0,NCRIT=0 F I=0:0 S I=$O(^XTV(8992,XQAN1,"XQA",I)) Q:I'>0  D
"RTN","XQARPRT1",75,0)
 . . S DATE=$P($P(^XTV(8992,XQAN1,"XQA",I,0),U,2),";",3)  S:OLDEST=0 OLDEST=DATE\1 I (DATE<XQASDT)!(DATE>XQAEDT) Q
"RTN","XQARPRT1",76,0)
 . . S MSG=$$UP^XLFSTR($P(^XTV(8992,XQAN1,"XQA",I,0),U,3))
"RTN","XQARPRT1",77,0)
 . . S CRITMSG=$G(^XTV(8992,XQAN1,"XQA",I,0)) I CRITMSG'="" D  ; begin P631
"RTN","XQARPRT1",78,0)
 . . I $D(XQAWORDS)'>0 S COUNT=COUNT+1 I $$CHKCRIT^XQALSUR2(CRITMSG) S NCRIT=NCRIT+1
"RTN","XQARPRT1",79,0)
 . . I $D(XQAWORDS)>1 D  I MSG'="" S COUNT=COUNT+1
"RTN","XQARPRT1",80,0)
 . . . N MSG1,I,J S MSG1=MSG F J=0:0 S J=$O(XQAWORDS(J)) Q:J'>0  S MSG=MSG1 D  Q:MSG'=""
"RTN","XQARPRT1",81,0)
 . . . . F I=0:0 S I=$O(XQAWORDS(J,I)) Q:I'>0  D  I MSG'[XQAWORDS(J,I) S MSG="" Q
"RTN","XQARPRT1",82,0)
 . . . . . I $D(XQAWORDS)>1,MSG[XQAWORDS(J,I),$$CHKCRIT^XQALSUR2(CRITMSG) S NCRIT=NCRIT+1
"RTN","XQARPRT1",83,0)
 . . . . . Q
"RTN","XQARPRT1",84,0)
 . . . . Q
"RTN","XQARPRT1",85,0)
 . . . Q
"RTN","XQARPRT1",86,0)
 . . Q  ; end P631
"RTN","XQARPRT1",87,0)
 . I $S(XQACRIT:NCRIT,1:COUNT)<XQAC1 Q
"RTN","XQARPRT1",88,0)
 . S VALUE=COUNT_U_XQAN1_U_$$FMTE^XLFDT(OLDEST,"5DZ")_U_NCRIT_U_$$GET1^DIQ(200,XQAN1_",",.01)
"RTN","XQARPRT1",89,0)
 . I DIVISION D  I 1
"RTN","XQARPRT1",90,0)
 . . K XQARRAY,XQADIV S XQADIV=0 D GETS^DIQ(200,XQAN1_",","16*","","XQARRAY") S:'$D(XQARRAY) XQADIV(0)="",XQADIV=1 I $D(XQARRAY) D
"RTN","XQARPRT1",91,0)
 . . . N K,L S K="" F  S K=$O(XQARRAY(200.02,K)) Q:K=""  D
"RTN","XQARPRT1",92,0)
 . . . . I $D(DIVISION)'>1 S XQADIV(XQARRAY(200.02,K,.01))="",XQADIV=XQADIV+1
"RTN","XQARPRT1",93,0)
 . . . . E  S L=XQARRAY(200.02,K,.01) I $D(DIVISION(L))>0 S XQADIV(L)="",XQADIV=XQADIV+1
"RTN","XQARPRT1",94,0)
 . . . I XQADIV>1,SHOWDIV=1 K XQADIV S XQADIV(99999)="",XQADIV=1
"RTN","XQARPRT1",95,0)
 . . . Q
"RTN","XQARPRT1",96,0)
 . . S K=$S($D(DIVISION)'>1:"",1:0) F  S K=$O(XQADIV(K)) Q:K=""  S @XQAGLOB@("DIV",K,"NAME",$$GET1^DIQ(200,XQAN1_",",.01)_XQAN1)=VALUE
"RTN","XQARPRT1",97,0)
 . . Q
"RTN","XQARPRT1",98,0)
 . E  S @XQAGLOB@("NAME",$$GET1^DIQ(200,XQAN1_",",.01)_XQAN1)=VALUE
"RTN","XQARPRT1",99,0)
 . Q
"RTN","XQARPRT1",100,0)
 Q
"RTN","XQARPRT1",101,0)
 ;
"RTN","XQARPRT1",102,0)
PRT ;print
"RTN","XQARPRT1",103,0)
 N NAME,NUMBER,LSIGNON,VALUE,XQAGLOB1,DIVNAME
"RTN","XQARPRT1",104,0)
 S XQAGLOB1=XQAGLOB
"RTN","XQARPRT1",105,0)
 I DIVISION D  I 1
"RTN","XQARPRT1",106,0)
 . S DIVNAME="" F  S DIVNAME=$O(@XQAGLOB@("DIV",DIVNAME)) Q:DIVNAME=""  S XQAGLOB1=$NA(@XQAGLOB@("DIV",DIVNAME)) D HEADER,PRTLOC
"RTN","XQARPRT1",107,0)
 E  D HEADER,PRTLOC
"RTN","XQARPRT1",108,0)
 Q
"RTN","XQARPRT1",109,0)
 ;
"RTN","XQARPRT1",110,0)
PRTLOC ;
"RTN","XQARPRT1",111,0)
 N PRTLOC
"RTN","XQARPRT1",112,0)
 S PRTLOC=$S(XQAORDER=1:"PRTNAME",XQAORDER=2:"PRTNUMBR",1:"PRTSERVC") D @PRTLOC
"RTN","XQARPRT1",113,0)
 Q
"RTN","XQARPRT1",114,0)
 ;
"RTN","XQARPRT1",115,0)
HEADER ;
"RTN","XQARPRT1",116,0)
 N XQACTR S XQACTR=0
"RTN","XQARPRT1",117,0)
 W @IOF W " COUNT of ",$S($D(XQAWORDS)>1:"SELECTED ",1:""),"ALERTS - users with more than ",XQAC1," on ",$$FMTE^XLFDT($$NOW^XLFDT())
"RTN","XQARPRT1",118,0)
 W !,"   for date range ",$$FMTE^XLFDT(XQASDT,"5DZ")," to ",$$FMTE^XLFDT(XQAEDT,"5DZ")
"RTN","XQARPRT1",119,0)
 ;W !,"CRIT column indicates number of CRITICAL alerts and ABNORMAL IMAGING alerts"
"RTN","XQARPRT1",120,0)
  W !,"CRIT column indicates number of alerts containing critical text"
"RTN","XQARPRT1",121,0)
 D WORDHDR^XQARPRT2
"RTN","XQARPRT1",122,0)
 W !!,?42,$S($D(XQAWORDS)>1:"Selected",1:"  Total"),?70,"Oldest"
"RTN","XQARPRT1",123,0)
 W !,"Name",?25,"Service/section",?43,"Alerts",?50,"Last Sign-on",?64,"CRIT   Alert"
"RTN","XQARPRT1",124,0)
 W !,"-----------------",?25,"-----------------",?43,"------",?50,"------------",?64,"---- ----------"
"RTN","XQARPRT1",125,0)
 I $D(DIVNAME) D DIVPRINT
"RTN","XQARPRT1",126,0)
 Q
"RTN","XQARPRT1",127,0)
 ;
"RTN","XQARPRT1",128,0)
PRTNAME ;
"RTN","XQARPRT1",129,0)
 N NAME,NUMBER,VALUE,XQAN1,NCRIT,OLDEST,LSIGNON
"RTN","XQARPRT1",130,0)
 S NAME="" F  S NAME=$O(@XQAGLOB1@("NAME",NAME)) Q:NAME=""  S VALUE=@XQAGLOB1@("NAME",NAME) D PRINTVAL
"RTN","XQARPRT1",131,0)
 Q
"RTN","XQARPRT1",132,0)
 ;
"RTN","XQARPRT1",133,0)
PRTNUMBR ;
"RTN","XQARPRT1",134,0)
 N NAME,NUMBER,NUMB,VALUE,XQAN1,NCRIT,OLDEST,LSIGNON
"RTN","XQARPRT1",135,0)
 S NAME="" F  S NAME=$O(@XQAGLOB1@("NAME",NAME)) Q:NAME=""  D
"RTN","XQARPRT1",136,0)
 . S NUMBER=$S(XQACRIT:$P(@XQAGLOB1@("NAME",NAME),U,4),1:+@XQAGLOB1@("NAME",NAME))
"RTN","XQARPRT1",137,0)
 . S @XQAGLOB1@("NUMB",100000-NUMBER,NAME)=@XQAGLOB1@("NAME",NAME)
"RTN","XQARPRT1",138,0)
 . Q
"RTN","XQARPRT1",139,0)
 N NUMB S NUMB="" F  S NUMB=$O(@XQAGLOB1@("NUMB",NUMB)) Q:NUMB=""  S NAME="" F  S NAME=$O(@XQAGLOB1@("NUMB",NUMB,NAME)) Q:NAME=""  S VALUE=@XQAGLOB1@("NUMB",NUMB,NAME) D PRINTVAL
"RTN","XQARPRT1",140,0)
 Q
"RTN","XQARPRT1",141,0)
 ;
"RTN","XQARPRT1",142,0)
PRTSERVC ;
"RTN","XQARPRT1",143,0)
 N NAME,NUMBER,NUMB,VALUE,XQAN1,NCRIT,OLDEST,LSIGNON
"RTN","XQARPRT1",144,0)
 S NAME="" F  S NAME=$O(@XQAGLOB1@("NAME",NAME)) Q:NAME=""  D
"RTN","XQARPRT1",145,0)
 . S XQAN1=$P(@XQAGLOB1@("NAME",NAME),U,2)
"RTN","XQARPRT1",146,0)
 . S SERVICE=$E($$GET1^DIQ(200,XQAN1_",",29),1,17) I SERVICE="" S SERVICE="<No Service>"
"RTN","XQARPRT1",147,0)
 . I ALLSERV!$D(SERVICE(SERVICE)) D
"RTN","XQARPRT1",148,0)
 . . I SERVSRT=1 S @XQAGLOB1@("SERV",SERVICE,NAME)=@XQAGLOB1@("NAME",NAME) Q
"RTN","XQARPRT1",149,0)
 . . I SERVSRT=2 S @XQAGLOB1@("SERV",SERVICE,"NUMB",100000-@XQAGLOB1@("NAME",NAME),NAME)=@XQAGLOB1@("NAME",NAME)
"RTN","XQARPRT1",150,0)
 . . Q
"RTN","XQARPRT1",151,0)
 . Q
"RTN","XQARPRT1",152,0)
 S SERVICE="" F  S SERVICE=$O(@XQAGLOB1@("SERV",SERVICE)) Q:SERVICE=""  D HEADER D
"RTN","XQARPRT1",153,0)
 . I SERVSRT=1 S NAME="" F  S NAME=$O(@XQAGLOB1@("SERV",SERVICE,NAME)) Q:NAME=""  S VALUE=@XQAGLOB1@("SERV",SERVICE,NAME) D PRINTVAL
"RTN","XQARPRT1",154,0)
 . I SERVSRT=2 F NUMB=0:0 S NUMB=$O(@XQAGLOB1@("SERV",SERVICE,"NUMB",NUMB)) Q:NUMB'>0  D
"RTN","XQARPRT1",155,0)
 . . S NAME="" F  S NAME=$O(@XQAGLOB1@("SERV",SERVICE,"NUMB",NUMB,NAME)) Q:NAME=""  S VALUE=@XQAGLOB1@("SERV",SERVICE,"NUMB",NUMB,NAME) D PRINTVAL
"RTN","XQARPRT1",156,0)
 . . Q
"RTN","XQARPRT1",157,0)
 . Q
"RTN","XQARPRT1",158,0)
 Q
"RTN","XQARPRT1",159,0)
 ;
"RTN","XQARPRT1",160,0)
PRINTVAL ;
"RTN","XQARPRT1",161,0)
 N NAME
"RTN","XQARPRT1",162,0)
 S NUMBER=+VALUE,XQAN1=$P(VALUE,U,2),NCRIT=$P(VALUE,U,4),OLDEST=$P(VALUE,U,3),NAME=$P(VALUE,U,5)
"RTN","XQARPRT1",163,0)
 S SERVICE=$E($$GET1^DIQ(200,XQAN1_",",29),1,17)
"RTN","XQARPRT1",164,0)
 S LSIGNON=$$GET1^DIQ(200,XQAN1_",",202)
"RTN","XQARPRT1",165,0)
 I LSIGNON["@" S LSIGNON=$P(LSIGNON,"@")
"RTN","XQARPRT1",166,0)
 I $Y>(IOSL-4) W @IOF D HEADER
"RTN","XQARPRT1",167,0)
 W !,NAME,?25,SERVICE,?43,NUMBER,?50,LSIGNON,?64,NCRIT,?69,OLDEST
"RTN","XQARPRT1",168,0)
 Q
"RTN","XQARPRT1",169,0)
 ;
"RTN","XQARPRT1",170,0)
DIVPRINT ;
"RTN","XQARPRT1",171,0)
 I $Y>(IOSL-6) D HEADER
"RTN","XQARPRT1",172,0)
 W !,?5,"Division: ",$S(DIVNAME=0:"These users are not assigned to a division",DIVNAME=99999:"These users are assigned to multiple divisions",1:DIVNAME)
"RTN","XQARPRT1",173,0)
 Q
"RTN","XQARPRT1",174,0)
 ;
"RTN","XQARPRT1",175,0)
OLDEST() ; Returns date of oldest entry in alert tracking file
"RTN","XQARPRT1",176,0)
 N OLDEST,I,J,FND
"RTN","XQARPRT1",177,0)
 ; Use cross-ref, since if user data used to create entries in tracking file oldest may not be first in file
"RTN","XQARPRT1",178,0)
 ; Make sure cross-ref is valid
"RTN","XQARPRT1",179,0)
 S FND=0 F I=0:0 Q:FND  S I=$O(^XTV(8992.1,"D",I)) Q:I'>0  F J=0:0 S J=$O(^XTV(8992.1,"D",I,J)) Q:J'>0  I $D(^XTV(8992.1,J,0)) S FND=1 Q
"RTN","XQARPRT1",180,0)
 S OLDEST=I S:OLDEST'>0 OLDEST=DT+1
"RTN","XQARPRT1",181,0)
 Q OLDEST\1
"RTN","XQARPRT1",182,0)
 ;
"RTN","XQARPRT1",183,0)
VIEWTRAK ; OPT.  View an entry in the Alert Tracking file in Captioned mode
"RTN","XQARPRT1",184,0)
 N DIR,X0,X1,DAARRAY
"RTN","XQARPRT1",185,0)
 S X0=$O(^XTV(8992.1,0)),X1=$P(^XTV(8992.1,0),U,3)
"RTN","XQARPRT1",186,0)
 S DIR(0)="NO^"_X0_":"_X1
"RTN","XQARPRT1",187,0)
 F I=1:1 S DIR("A")=$S(I>1:"Another ",1:"")_"Internal Entry number in Alert Tracking File" D ^DIR K DIRUT Q:Y'>0  S DAARRAY(I)=+Y
"RTN","XQARPRT1",188,0)
 K DIR Q:$D(DAARRAY)'>1
"RTN","XQARPRT1",189,0)
 S %ZIS="MQ" D ^%ZIS Q:POP  I $D(IO("Q")) K IO("Q") S ZTRTN="VIEWDQ^XQARPRT1",ZTDESC="List data from Alert Tracking file",ZTSAVE("*")="" D ^%ZTLOAD W:$G(ZTSK)>0 !,"Task number is ",ZTSK K ZTSK Q
"RTN","XQARPRT1",190,0)
 ;
"RTN","XQARPRT1",191,0)
VIEWDQ ;
"RTN","XQARPRT1",192,0)
 N DIC,DA,DIC,XQAI,DR,DIQ
"RTN","XQARPRT1",193,0)
 W @IOF
"RTN","XQARPRT1",194,0)
 S DIQ(0)="CR"
"RTN","XQARPRT1",195,0)
 F XQAI=0:0 S XQAI=$O(DAARRAY(XQAI)) Q:XQAI'>0  D
"RTN","XQARPRT1",196,0)
 . S DA=DAARRAY(XQAI),DIC="^XTV(8992.1," D EN^DIQ
"RTN","XQARPRT1",197,0)
 Q
"VER")
8.0^22.0
"BLD",1504,6)
^511
**END**
**END**

