Released XU*8*625 SEQ #514
Extracted from mail message
**KIDS**:XU*8.0*625^

**INSTALL NAME**
XU*8.0*625
"BLD",1494,0)
XU*8.0*625^KERNEL^0^3140114^y
"BLD",1494,1,0)
^^2^2^3130308^
"BLD",1494,1,1,0)
See patch XU*8*625 in the National Patch Module for complete 
"BLD",1494,1,2,0)
information on this patch.
"BLD",1494,4,0)
^9.64PA^^
"BLD",1494,6.3)
4
"BLD",1494,"ABPKG")
n
"BLD",1494,"INID")
^n
"BLD",1494,"INIT")
POST^XIPSRVR
"BLD",1494,"KRN",0)
^9.67PA^9002226^22
"BLD",1494,"KRN",.4,0)
.4
"BLD",1494,"KRN",.401,0)
.401
"BLD",1494,"KRN",.402,0)
.402
"BLD",1494,"KRN",.403,0)
.403
"BLD",1494,"KRN",.5,0)
.5
"BLD",1494,"KRN",.84,0)
.84
"BLD",1494,"KRN",3.6,0)
3.6
"BLD",1494,"KRN",3.8,0)
3.8
"BLD",1494,"KRN",9.2,0)
9.2
"BLD",1494,"KRN",9.8,0)
9.8
"BLD",1494,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",1494,"KRN",9.8,"NM",1,0)
XIPSRVR^^0^B29981467
"BLD",1494,"KRN",9.8,"NM","B","XIPSRVR",1)

"BLD",1494,"KRN",19,0)
19
"BLD",1494,"KRN",19.1,0)
19.1
"BLD",1494,"KRN",101,0)
101
"BLD",1494,"KRN",409.61,0)
409.61
"BLD",1494,"KRN",771,0)
771
"BLD",1494,"KRN",779.2,0)
779.2
"BLD",1494,"KRN",870,0)
870
"BLD",1494,"KRN",8989.51,0)
8989.51
"BLD",1494,"KRN",8989.52,0)
8989.52
"BLD",1494,"KRN",8993,0)
8993
"BLD",1494,"KRN",8994,0)
8994
"BLD",1494,"KRN",9002226,0)
9002226
"BLD",1494,"KRN","B",.4,.4)

"BLD",1494,"KRN","B",.401,.401)

"BLD",1494,"KRN","B",.402,.402)

"BLD",1494,"KRN","B",.403,.403)

"BLD",1494,"KRN","B",.5,.5)

"BLD",1494,"KRN","B",.84,.84)

"BLD",1494,"KRN","B",3.6,3.6)

"BLD",1494,"KRN","B",3.8,3.8)

"BLD",1494,"KRN","B",9.2,9.2)

"BLD",1494,"KRN","B",9.8,9.8)

"BLD",1494,"KRN","B",19,19)

"BLD",1494,"KRN","B",19.1,19.1)

"BLD",1494,"KRN","B",101,101)

"BLD",1494,"KRN","B",409.61,409.61)

"BLD",1494,"KRN","B",771,771)

"BLD",1494,"KRN","B",779.2,779.2)

"BLD",1494,"KRN","B",870,870)

"BLD",1494,"KRN","B",8989.51,8989.51)

"BLD",1494,"KRN","B",8989.52,8989.52)

"BLD",1494,"KRN","B",8993,8993)

"BLD",1494,"KRN","B",8994,8994)

"BLD",1494,"KRN","B",9002226,9002226)

"BLD",1494,"QDEF")
^^^^NO^^^^NO^^NO
"BLD",1494,"QUES",0)
^9.62^^
"BLD",1494,"REQB",0)
^9.611^1^1
"BLD",1494,"REQB",1,0)
XU*8.0*449^0
"BLD",1494,"REQB","B","XU*8.0*449",1)

"INIT")
POST^XIPSRVR
"MBREQ")
0
"PKG",3,-1)
1^1
"PKG",3,0)
KERNEL^XU^SIGN-ON, SECURITY, MENU DRIVER, DEVICES, TASKMAN^
"PKG",3,20,0)
^9.402P^2^2
"PKG",3,20,1,0)
200^^XDRM200N
"PKG",3,20,1,1)

"PKG",3,20,2,0)
2^^RGDRM03
"PKG",3,20,2,1)

"PKG",3,20,"B",2,2)

"PKG",3,20,"B",200,1)

"PKG",3,22,0)
^9.49I^1^1
"PKG",3,22,1,0)
8.0^3090706^3090706^6
"PKG",3,22,1,"PAH",1,0)
625^3140114^82
"PKG",3,22,1,"PAH",1,1,0)
^^2^2^3140114
"PKG",3,22,1,"PAH",1,1,1,0)
See patch XU*8*625 in the National Patch Module for complete 
"PKG",3,22,1,"PAH",1,1,2,0)
information on this patch.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","XIPSRVR")
0^1^B29981467^B23779750
"RTN","XIPSRVR",1,0)
XIPSRVR ;SFISC/SO- SERVER TO UPDATE THE POSTAL CODE(#5.12) FILE ;3/12/13
"RTN","XIPSRVR",2,0)
 ;;8.0;KERNEL;**449,625**;Jul 10, 1995;Build 4
"RTN","XIPSRVR",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","XIPSRVR",4,0)
 Q
"RTN","XIPSRVR",5,0)
 ;
"RTN","XIPSRVR",6,0)
E1 ;
"RTN","XIPSRVR",7,0)
 N LN,ESC,XIPSEED,ACNT,ECNT,ICNT,LCNT,TREC,NECNT
"RTN","XIPSRVR",8,0)
 S (LN,ESC,ACNT,ECNT,ICNT,TREC,NECNT)=0,LCNT=9
"RTN","XIPSRVR",9,0)
 K ^TMP("XIP DATA",$J)
"RTN","XIPSRVR",10,0)
 S ^TMP("XIP DATA",$J)=""
"RTN","XIPSRVR",11,0)
 S ^TMP("XIP DATA",$J,LCNT)=" ",LCNT=LCNT+1
"RTN","XIPSRVR",12,0)
 S ^TMP("XIP DATA",$J,LCNT)="     **Detail Changes**",LCNT=LCNT+1
"RTN","XIPSRVR",13,0)
 S ^TMP("XIP DATA",$J,LCNT)="IEN^MAIL CODE^CITY^COUNTY^STATE^INACTIVE DATE^CITY KEY^PREFERRED CITY KEY^CITY ABBREVIATION^UNIQUE KEY (VA)^FLAG",LCNT=LCNT+1
"RTN","XIPSRVR",14,0)
 S XIPSEED=1 ; XIPSEED set to prevent "AD" from being set
"RTN","XIPSRVR",15,0)
 ;
"RTN","XIPSRVR",16,0)
 ; XQMSG is passed via the Server option
"RTN","XIPSRVR",17,0)
 ; See Kernel Programmer, Page: 19-1
"RTN","XIPSRVR",18,0)
 ; "Key Variables When a Server Option is Running"
"RTN","XIPSRVR",19,0)
 ;
"RTN","XIPSRVR",20,0)
 F  S LN=$O(^XMB(3.9,XQMSG,2,LN)) Q:'LN  D  Q:ESC
"RTN","XIPSRVR",21,0)
 . I LN<1 Q
"RTN","XIPSRVR",22,0)
 . N DATA,IEN,LKUP
"RTN","XIPSRVR",23,0)
 . S DATA=^XMB(3.9,XQMSG,2,LN,0)
"RTN","XIPSRVR",24,0)
 . I LN=1,DATA'="$$DATA$$" S ESC=1 Q
"RTN","XIPSRVR",25,0)
 . I DATA="$$EOD$$" S TREC=$O(^XMB(3.9,XQMSG,2," "),-1),TREC=TREC-2,ESC=1 Q
"RTN","XIPSRVR",26,0)
 . I DATA="$$DATA$$" Q
"RTN","XIPSRVR",27,0)
 . I DATA="$$EOD$$" Q
"RTN","XIPSRVR",28,0)
 . ;
"RTN","XIPSRVR",29,0)
 . S LKUP=$P(DATA,U,9) ; UNIQUE KEY
"RTN","XIPSRVR",30,0)
 . S IEN=+$O(^XIP(5.12,"E",LKUP,0))
"RTN","XIPSRVR",31,0)
ADD . ;
"RTN","XIPSRVR",32,0)
 . I 'IEN D  Q  ; New ZIP Code
"RTN","XIPSRVR",33,0)
 .. N FIPSPTR,STPTR,Y
"RTN","XIPSRVR",34,0)
 .. S FIPSPTR=0,STPTR=0
"RTN","XIPSRVR",35,0)
 .. S FIPSPTR=+$O(^XIP(5.13,"B",$P(DATA,U,3),0))
"RTN","XIPSRVR",36,0)
 .. I 'FIPSPTR Q  ;Broken FIPS
"RTN","XIPSRVR",37,0)
 .. S STPTR=+$O(^DIC(5,"B",$P(DATA,U,4),0))
"RTN","XIPSRVR",38,0)
 .. I 'STPTR Q  ;Broken STATE
"RTN","XIPSRVR",39,0)
 .. N DO,DIC,X
"RTN","XIPSRVR",40,0)
 .. S DIC="^XIP(5.12,",DIC(0)="Z",X=$P(DATA,U,1) D FILE^DICN
"RTN","XIPSRVR",41,0)
 .. I Y<1 Q
"RTN","XIPSRVR",42,0)
 .. N DA,DIE,DR
"RTN","XIPSRVR",43,0)
 .. S DA=+Y,DIE=DIC
"RTN","XIPSRVR",44,0)
 .. S DR="1///^S X=$P(DATA,U,2);2///^S X=""`""_FIPSPTR;3///^S X=""`""_STPTR;"
"RTN","XIPSRVR",45,0)
 .. S DR=DR_"5///^S X=$P(DATA,U,6);6///^S X=$P(DATA,U,7);7///^S X=$P(DATA,U,8)"
"RTN","XIPSRVR",46,0)
 .. F  L +^XIP(5.12,DA,0):$S($D(DILOCKTM):DILOCKTM,1:3) Q:$T  H $S($D(DILOCKTM):DILOCKTM,1:3)
"RTN","XIPSRVR",47,0)
 .. D ^DIE
"RTN","XIPSRVR",48,0)
 .. L -^XIP(5.12,DA,0)
"RTN","XIPSRVR",49,0)
 .. S ACNT=ACNT+1
"RTN","XIPSRVR",50,0)
 .. S ^TMP("XIP DATA",$J,LCNT)=DA_U_DATA_U_"New",LCNT=LCNT+1
"RTN","XIPSRVR",51,0)
 .. Q
"RTN","XIPSRVR",52,0)
INACT . ;
"RTN","XIPSRVR",53,0)
 . I $P(DATA,U,5)'="" D  Q  ; INACTIVE DATE
"RTN","XIPSRVR",54,0)
 .. I $P(^XIP(5.12,IEN,0),U,5)'="" S NECNT=NECNT+1 Q  ;Already has Inactive Date
"RTN","XIPSRVR",55,0)
 .. N DIE,DA,DR
"RTN","XIPSRVR",56,0)
 .. S DIE="^XIP(5.12,",DA=IEN,DR="4///^S X=$P(DATA,U,5)"
"RTN","XIPSRVR",57,0)
 .. F  L +^XIP(5.12,DA,0):$S($D(DILOCKTM):DILOCKTM,1:3) Q:$T  H $S($D(DILOCKTM):DILOCKTM,1:3)
"RTN","XIPSRVR",58,0)
 .. D ^DIE
"RTN","XIPSRVR",59,0)
 .. L -^XIP(5.12,DA,0)
"RTN","XIPSRVR",60,0)
 .. S ICNT=ICNT+1
"RTN","XIPSRVR",61,0)
 .. S ^TMP("XIP DATA",$J,LCNT)=DA_U_DATA_U_"Inactivated",LCNT=LCNT+1
"RTN","XIPSRVR",62,0)
 .. Q
"RTN","XIPSRVR",63,0)
EDIT . ;
"RTN","XIPSRVR",64,0)
 . D  Q  ; Edited Entry
"RTN","XIPSRVR",65,0)
 .. N FIPSPTR,STPTR,FDATA
"RTN","XIPSRVR",66,0)
 .. S FIPSPTR=0,STPTR=0
"RTN","XIPSRVR",67,0)
 .. S FIPSPTR=+$O(^XIP(5.13,"B",$P(DATA,U,3),0))
"RTN","XIPSRVR",68,0)
 .. I 'FIPSPTR Q  ;Broken FIPS
"RTN","XIPSRVR",69,0)
 .. S STPTR=+$O(^DIC(5,"B",$P(DATA,U,4),0))
"RTN","XIPSRVR",70,0)
 .. I 'STPTR Q  ;Broken STATE
"RTN","XIPSRVR",71,0)
 .. S FDATA=^XIP(5.12,IEN,0)
"RTN","XIPSRVR",72,0)
 .. S $P(FDATA,U,3)=$P(^XIP(5.13,$P(FDATA,U,3),0),U) ;Resolve COUNTY CODE
"RTN","XIPSRVR",73,0)
 .. S $P(FDATA,U,4)=$P(^DIC(5,$P(FDATA,U,4),0),U) ;Resolve STATE
"RTN","XIPSRVR",74,0)
 .. I DATA=FDATA S NECNT=NECNT+1 Q  ;Already been edited
"RTN","XIPSRVR",75,0)
 .. N DA,DIE,DR
"RTN","XIPSRVR",76,0)
 .. S DA=IEN,DIE="^XIP(5.12,"
"RTN","XIPSRVR",77,0)
 .. S DR="1///^S X=$P(DATA,U,2);2///^S X=""`""_FIPSPTR;3///^S X=""`""_STPTR;"
"RTN","XIPSRVR",78,0)
 .. I $P(DATA,U,5)="" S DR=DR_"4///^S X=""@"";" ;Ba added to reactivate a Postal code. P625
"RTN","XIPSRVR",79,0)
 .. S DR=DR_"5///^S X=$P(DATA,U,6);6///^S X=$P(DATA,U,7);7///^S X=$P(DATA,U,8)"
"RTN","XIPSRVR",80,0)
 .. F  L +^XIP(5.12,DA,0):$S($D(DILOCKTM):DILOCKTM,1:3) Q:$T  H $S($D(DILOCKTM):DILOCKTM,1:3)
"RTN","XIPSRVR",81,0)
 .. D ^DIE
"RTN","XIPSRVR",82,0)
 .. L -^XIP(5.12,DA,0)
"RTN","XIPSRVR",83,0)
 .. S ECNT=ECNT+1
"RTN","XIPSRVR",84,0)
 .. S ^TMP("XIP DATA",$J,LCNT)=DA_U_DATA_U_"Edited",LCNT=LCNT+1
"RTN","XIPSRVR",85,0)
 .. Q
"RTN","XIPSRVR",86,0)
 . Q
"RTN","XIPSRVR",87,0)
 ;
"RTN","XIPSRVR",88,0)
END ;
"RTN","XIPSRVR",89,0)
 N TOT S TOT=ACNT+ICNT+ECNT
"RTN","XIPSRVR",90,0)
 I 'TOT K ^TMP("XIP DATA",$J)
"RTN","XIPSRVR",91,0)
 S LCNT=1
"RTN","XIPSRVR",92,0)
 S ^TMP("XIP DATA",$J,LCNT)=" ",LCNT=LCNT+1
"RTN","XIPSRVR",93,0)
 S ^TMP("XIP DATA",$J,LCNT)="*Summary for this Update*",LCNT=LCNT+1
"RTN","XIPSRVR",94,0)
 S ^TMP("XIP DATA",$J,LCNT)="Total Data Records: "_TREC,LCNT=LCNT+1
"RTN","XIPSRVR",95,0)
 S ^TMP("XIP DATA",$J,LCNT)="Unedited Records: "_NECNT,LCNT=LCNT+1
"RTN","XIPSRVR",96,0)
 S ^TMP("XIP DATA",$J,LCNT)="New ZIP Codes: "_ACNT,LCNT=LCNT+1
"RTN","XIPSRVR",97,0)
 S ^TMP("XIP DATA",$J,LCNT)="Inactivated ZIP Codes: "_ICNT,LCNT=LCNT+1
"RTN","XIPSRVR",98,0)
 S ^TMP("XIP DATA",$J,LCNT)="Edited ZIP Codes: "_ECNT,LCNT=LCNT+1
"RTN","XIPSRVR",99,0)
 S ^TMP("XIP DATA",$J,LCNT)="Total Changes: "_TOT,LCNT=LCNT+1
"RTN","XIPSRVR",100,0)
 I 'TOT D
"RTN","XIPSRVR",101,0)
 . S ^TMP("XIP DATA",$J,LCNT)="**Your POSTAL CODE(#5.12) file is current with the Master",LCNT=LCNT+1
"RTN","XIPSRVR",102,0)
 . S ^TMP("XIP DATA",$J,LCNT)="  POSTAL CODE(#5.12) file.",LCNT=LCNT+1
"RTN","XIPSRVR",103,0)
 . Q
"RTN","XIPSRVR",104,0)
 ;
"RTN","XIPSRVR",105,0)
SEND ; Send 'Results' message If & Only If there are MEMBERS
"RTN","XIPSRVR",106,0)
 I $$GOTLOCAL^XMXAPIG("XIP POSTAL CODE UPDATE") D
"RTN","XIPSRVR",107,0)
 . N MSGSBJ,ODUZ,MSG,WHO
"RTN","XIPSRVR",108,0)
 . S MSG=$NA(^TMP("XIP DATA",$J))
"RTN","XIPSRVR",109,0)
 . I DUZ<.5 S ODUZ=DUZ,DUZ=.5 ;** Change user to POSTMASTER **
"RTN","XIPSRVR",110,0)
 . S MSGSBJ="POSTAL CODE(#5.12) File Update Results"
"RTN","XIPSRVR",111,0)
 . S WHO("G.XIP POSTAL CODE UPDATE")=""
"RTN","XIPSRVR",112,0)
 . D SENDMSG^XMXAPI(DUZ,MSGSBJ,.MSG,.WHO)
"RTN","XIPSRVR",113,0)
 . I $G(ODUZ)'="" S DUZ=ODUZ ;** Change POSTMASTER back to current user **
"RTN","XIPSRVR",114,0)
 . Q
"RTN","XIPSRVR",115,0)
 K ^TMP("XIP DATA",$J) ; p461
"RTN","XIPSRVR",116,0)
 Q
"RTN","XIPSRVR",117,0)
 ;
"RTN","XIPSRVR",118,0)
POST ;
"RTN","XIPSRVR",119,0)
 N XU625
"RTN","XIPSRVR",120,0)
 S XU625=$G(^XIP(5.12,52000,0))
"RTN","XIPSRVR",121,0)
 I $P(XU625,"^",1,2)="34607^SPRING HILL" D REACT(52000,"@","34607 SPRING HILL")
"RTN","XIPSRVR",122,0)
 S XU625=$G(^XIP(5.12,52003,0))
"RTN","XIPSRVR",123,0)
 I $P(XU625,"^",1,2)="34610^SPRING HILL" D REACT(52003,"@","34610 SPRING HILL")
"RTN","XIPSRVR",124,0)
 D DEL
"RTN","XIPSRVR",125,0)
 Q
"RTN","XIPSRVR",126,0)
 ;
"RTN","XIPSRVR",127,0)
REACT(IEN,DATA,POSTAL) ;
"RTN","XIPSRVR",128,0)
 N DIE,DA,DR
"RTN","XIPSRVR",129,0)
 S DIE="^XIP(5.12,",DA=IEN,DR="4///^S X=DATA"
"RTN","XIPSRVR",130,0)
 F  L +^XIP(5.12,DA,0):$S($D(DILOCKTM):DILOCKTM,1:3) Q:$T  H $S($D(DILOCKTM):DILOCKTM,1:3)
"RTN","XIPSRVR",131,0)
 D MES^XPDUTL("Reactivate Postal Code "_POSTAL)
"RTN","XIPSRVR",132,0)
 D ^DIE
"RTN","XIPSRVR",133,0)
 L -^XIP(5.12,DA,0)
"RTN","XIPSRVR",134,0)
 Q
"RTN","XIPSRVR",135,0)
 ;
"RTN","XIPSRVR",136,0)
DEL ;
"RTN","XIPSRVR",137,0)
 ;D MES^XPDUTL("Deleting ""AD"" Cross Reference")
"RTN","XIPSRVR",138,0)
 K ^XIP(5.12,"AD")
"RTN","XIPSRVR",139,0)
 ;D MES^XPDUTL("Finished Deleting the ""AD"" Cross Reference")
"RTN","XIPSRVR",140,0)
 Q
"VER")
8.0^22.0
"BLD",1494,6)
^514
**END**
**END**

