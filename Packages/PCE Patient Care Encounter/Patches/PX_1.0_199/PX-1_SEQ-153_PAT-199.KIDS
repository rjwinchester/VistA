Released PX*1*199 SEQ #153
Extracted from mail message
**KIDS**:PX*1.0*199^

**INSTALL NAME**
PX*1.0*199
"BLD",8599,0)
PX*1.0*199^PCE PATIENT CARE ENCOUNTER^0^3140625^y
"BLD",8599,1,0)
^^3^3^3120604^^^^
"BLD",8599,1,1,0)
ICD-10 REMEDIATION 
"BLD",8599,1,2,0)
This patch distributes the necessary components of PCE to allow
"BLD",8599,1,3,0)
for the transition to the ICD-10-CM diagnosis coding system.
"BLD",8599,4,0)
^9.64PA^9000010.18^2
"BLD",8599,4,9000010.07,0)
9000010.07
"BLD",8599,4,9000010.07,2,0)
^9.641^9000010.07^1
"BLD",8599,4,9000010.07,2,9000010.07,0)
V POV  (File-top level)
"BLD",8599,4,9000010.07,2,9000010.07,1,0)
^9.6411^80006^4
"BLD",8599,4,9000010.07,2,9000010.07,1,.01,0)
POV
"BLD",8599,4,9000010.07,2,9000010.07,1,.019,0)
ICD NARRATIVE
"BLD",8599,4,9000010.07,2,9000010.07,1,.15,0)
CLINICAL TERM
"BLD",8599,4,9000010.07,2,9000010.07,1,80006,0)
HEAD AND/OR NECK CANCER
"BLD",8599,4,9000010.07,222)
y^n^p^^^^n^^n
"BLD",8599,4,9000010.07,224)

"BLD",8599,4,9000010.18,0)
9000010.18
"BLD",8599,4,9000010.18,2,0)
^9.641^9000010.18^1
"BLD",8599,4,9000010.18,2,9000010.18,0)
V CPT  (File-top level)
"BLD",8599,4,9000010.18,2,9000010.18,1,0)
^9.6411^.15^8
"BLD",8599,4,9000010.18,2,9000010.18,1,.05,0)
DIAGNOSIS
"BLD",8599,4,9000010.18,2,9000010.18,1,.09,0)
DIAGNOSIS 2
"BLD",8599,4,9000010.18,2,9000010.18,1,.1,0)
DIAGNOSIS 3
"BLD",8599,4,9000010.18,2,9000010.18,1,.11,0)
DIAGNOSIS 4
"BLD",8599,4,9000010.18,2,9000010.18,1,.12,0)
DIAGNOSIS 5
"BLD",8599,4,9000010.18,2,9000010.18,1,.13,0)
DIAGNOSIS 6
"BLD",8599,4,9000010.18,2,9000010.18,1,.14,0)
DIAGNOSIS 7
"BLD",8599,4,9000010.18,2,9000010.18,1,.15,0)
DIAGNOSIS 8
"BLD",8599,4,9000010.18,222)
y^n^p^^^^n^^n
"BLD",8599,4,9000010.18,224)

"BLD",8599,4,"APDD",9000010.07,9000010.07)

"BLD",8599,4,"APDD",9000010.07,9000010.07,.01)

"BLD",8599,4,"APDD",9000010.07,9000010.07,.019)

"BLD",8599,4,"APDD",9000010.07,9000010.07,.15)

"BLD",8599,4,"APDD",9000010.07,9000010.07,80006)

"BLD",8599,4,"APDD",9000010.18,9000010.18)

"BLD",8599,4,"APDD",9000010.18,9000010.18,.05)

"BLD",8599,4,"APDD",9000010.18,9000010.18,.09)

"BLD",8599,4,"APDD",9000010.18,9000010.18,.1)

"BLD",8599,4,"APDD",9000010.18,9000010.18,.11)

"BLD",8599,4,"APDD",9000010.18,9000010.18,.12)

"BLD",8599,4,"APDD",9000010.18,9000010.18,.13)

"BLD",8599,4,"APDD",9000010.18,9000010.18,.14)

"BLD",8599,4,"APDD",9000010.18,9000010.18,.15)

"BLD",8599,4,"B",9000010.07,9000010.07)

"BLD",8599,4,"B",9000010.18,9000010.18)

"BLD",8599,6.3)
51
"BLD",8599,"ABPKG")
n
"BLD",8599,"INI")
PX10P199
"BLD",8599,"INID")
^^n
"BLD",8599,"KRN",0)
^9.67PA^779.2^20
"BLD",8599,"KRN",.4,0)
.4
"BLD",8599,"KRN",.401,0)
.401
"BLD",8599,"KRN",.402,0)
.402
"BLD",8599,"KRN",.403,0)
.403
"BLD",8599,"KRN",.5,0)
.5
"BLD",8599,"KRN",.84,0)
.84
"BLD",8599,"KRN",3.6,0)
3.6
"BLD",8599,"KRN",3.8,0)
3.8
"BLD",8599,"KRN",9.2,0)
9.2
"BLD",8599,"KRN",9.8,0)
9.8
"BLD",8599,"KRN",9.8,"NM",0)
^9.68A^57^57
"BLD",8599,"KRN",9.8,"NM",1,0)
PXUTL1^^0^B11838187
"BLD",8599,"KRN",9.8,"NM",2,0)
PXDXUTL^^0^B9983043
"BLD",8599,"KRN",9.8,"NM",3,0)
PXQUTL3A^^0^B55077296
"BLD",8599,"KRN",9.8,"NM",4,0)
AUPNSICD^^0^B1233832
"BLD",8599,"KRN",9.8,"NM",5,0)
PXAICPTV^^0^B23770661
"BLD",8599,"KRN",9.8,"NM",6,0)
PXAIIMMV^^0^B4109825
"BLD",8599,"KRN",9.8,"NM",7,0)
PXAIPOV^^0^B24084108
"BLD",8599,"KRN",9.8,"NM",8,0)
PXAIPOVV^^0^B2657796
"BLD",8599,"KRN",9.8,"NM",9,0)
PXAISKV^^0^B3940836
"BLD",8599,"KRN",9.8,"NM",10,0)
PXBAICS^^0^B492354
"BLD",8599,"KRN",9.8,"NM",11,0)
PXBDCPT^^0^B52464094
"BLD",8599,"KRN",9.8,"NM",12,0)
PXBDREQ^^0^B9107608
"BLD",8599,"KRN",9.8,"NM",13,0)
PXBGPL2^^0^B14633423
"BLD",8599,"KRN",9.8,"NM",14,0)
PXBGPOV^^0^B11410055
"BLD",8599,"KRN",9.8,"NM",15,0)
PXBGPOV2^^0^B43166443
"BLD",8599,"KRN",9.8,"NM",16,0)
PXBGPOV3^^0^B13265811
"BLD",8599,"KRN",9.8,"NM",17,0)
PXBGPOV4^^0^B18370344
"BLD",8599,"KRN",9.8,"NM",18,0)
PXBHLP3^^0^B18181575
"BLD",8599,"KRN",9.8,"NM",19,0)
PXBPCPT^^0^B52397890
"BLD",8599,"KRN",9.8,"NM",20,0)
PXBPCPT2^^0^B10905536
"BLD",8599,"KRN",9.8,"NM",21,0)
PXBPL^^0^B25222448
"BLD",8599,"KRN",9.8,"NM",22,0)
PXBPPOV^^0^B34159394
"BLD",8599,"KRN",9.8,"NM",23,0)
PXBPPOV1^^0^B24879639
"BLD",8599,"KRN",9.8,"NM",24,0)
PXBSTOR^^0^B42386628
"BLD",8599,"KRN",9.8,"NM",25,0)
PXBUTL2^^0^B4486692
"BLD",8599,"KRN",9.8,"NM",26,0)
PXCACPT^^0^B43989781
"BLD",8599,"KRN",9.8,"NM",27,0)
PXCADXP1^^0^B21605401
"BLD",8599,"KRN",9.8,"NM",28,0)
PXCAPL^^0^B30996914
"BLD",8599,"KRN",9.8,"NM",29,0)
PXCAPOV^^0^B35019386
"BLD",8599,"KRN",9.8,"NM",30,0)
PXCASK^^0^B15678860
"BLD",8599,"KRN",9.8,"NM",31,0)
PXCAVIMM^^0^B20851145
"BLD",8599,"KRN",9.8,"NM",32,0)
PXCECPT1^^0^B3081673
"BLD",8599,"KRN",9.8,"NM",33,0)
PXCEPOV^^0^B13988253
"BLD",8599,"KRN",9.8,"NM",34,0)
PXCEPOV1^^0^B39167369
"BLD",8599,"KRN",9.8,"NM",35,0)
PXCEVFI4^^0^B26873797
"BLD",8599,"KRN",9.8,"NM",36,0)
PXCEVFI5^^0^B5687740
"BLD",8599,"KRN",9.8,"NM",37,0)
PXCEVIMM^^0^B31390321
"BLD",8599,"KRN",9.8,"NM",38,0)
PXPXRMI2^^0^B86987846
"BLD",8599,"KRN",9.8,"NM",39,0)
PXRHS01^^0^B10447211
"BLD",8599,"KRN",9.8,"NM",40,0)
PXRHS12^^0^B8270720
"BLD",8599,"KRN",9.8,"NM",41,0)
PXRRFDP^^0^B74055950
"BLD",8599,"KRN",9.8,"NM",42,0)
PXRRFDSD^^0^B37724715
"BLD",8599,"KRN",9.8,"NM",43,0)
PXRRMDR^^0^B38033243
"BLD",8599,"KRN",9.8,"NM",44,0)
PXRRMDR1^^0^B20723539
"BLD",8599,"KRN",9.8,"NM",45,0)
PXRRPAPI^^0^B64147348
"BLD",8599,"KRN",9.8,"NM",46,0)
PXRRPCE3^^0^B39482453
"BLD",8599,"KRN",9.8,"NM",47,0)
PXRRPCE4^^0^B24619827
"BLD",8599,"KRN",9.8,"NM",48,0)
PXSCH4^^0^B7784412
"BLD",8599,"KRN",9.8,"NM",49,0)
PXBDPOV^^0^B32766424
"BLD",8599,"KRN",9.8,"NM",50,0)
PXDSLK^^0^B44674639
"BLD",8599,"KRN",9.8,"NM",51,0)
PXSELDS^^0^B47899921
"BLD",8599,"KRN",9.8,"NM",52,0)
PXCEAE1^^0^B16220510
"BLD",8599,"KRN",9.8,"NM",53,0)
PXCECPT^^0^B73855102
"BLD",8599,"KRN",9.8,"NM",54,0)
PXPXRM^^0^B24754616
"BLD",8599,"KRN",9.8,"NM",55,0)
PXAIPL^^0^B5170500
"BLD",8599,"KRN",9.8,"NM",56,0)
PXCAPL1^^0^B6900352
"BLD",8599,"KRN",9.8,"NM",57,0)
PXCAPL2^^0^B9344999
"BLD",8599,"KRN",9.8,"NM","B","AUPNSICD",4)

"BLD",8599,"KRN",9.8,"NM","B","PXAICPTV",5)

"BLD",8599,"KRN",9.8,"NM","B","PXAIIMMV",6)

"BLD",8599,"KRN",9.8,"NM","B","PXAIPL",55)

"BLD",8599,"KRN",9.8,"NM","B","PXAIPOV",7)

"BLD",8599,"KRN",9.8,"NM","B","PXAIPOVV",8)

"BLD",8599,"KRN",9.8,"NM","B","PXAISKV",9)

"BLD",8599,"KRN",9.8,"NM","B","PXBAICS",10)

"BLD",8599,"KRN",9.8,"NM","B","PXBDCPT",11)

"BLD",8599,"KRN",9.8,"NM","B","PXBDPOV",49)

"BLD",8599,"KRN",9.8,"NM","B","PXBDREQ",12)

"BLD",8599,"KRN",9.8,"NM","B","PXBGPL2",13)

"BLD",8599,"KRN",9.8,"NM","B","PXBGPOV",14)

"BLD",8599,"KRN",9.8,"NM","B","PXBGPOV2",15)

"BLD",8599,"KRN",9.8,"NM","B","PXBGPOV3",16)

"BLD",8599,"KRN",9.8,"NM","B","PXBGPOV4",17)

"BLD",8599,"KRN",9.8,"NM","B","PXBHLP3",18)

"BLD",8599,"KRN",9.8,"NM","B","PXBPCPT",19)

"BLD",8599,"KRN",9.8,"NM","B","PXBPCPT2",20)

"BLD",8599,"KRN",9.8,"NM","B","PXBPL",21)

"BLD",8599,"KRN",9.8,"NM","B","PXBPPOV",22)

"BLD",8599,"KRN",9.8,"NM","B","PXBPPOV1",23)

"BLD",8599,"KRN",9.8,"NM","B","PXBSTOR",24)

"BLD",8599,"KRN",9.8,"NM","B","PXBUTL2",25)

"BLD",8599,"KRN",9.8,"NM","B","PXCACPT",26)

"BLD",8599,"KRN",9.8,"NM","B","PXCADXP1",27)

"BLD",8599,"KRN",9.8,"NM","B","PXCAPL",28)

"BLD",8599,"KRN",9.8,"NM","B","PXCAPL1",56)

"BLD",8599,"KRN",9.8,"NM","B","PXCAPL2",57)

"BLD",8599,"KRN",9.8,"NM","B","PXCAPOV",29)

"BLD",8599,"KRN",9.8,"NM","B","PXCASK",30)

"BLD",8599,"KRN",9.8,"NM","B","PXCAVIMM",31)

"BLD",8599,"KRN",9.8,"NM","B","PXCEAE1",52)

"BLD",8599,"KRN",9.8,"NM","B","PXCECPT",53)

"BLD",8599,"KRN",9.8,"NM","B","PXCECPT1",32)

"BLD",8599,"KRN",9.8,"NM","B","PXCEPOV",33)

"BLD",8599,"KRN",9.8,"NM","B","PXCEPOV1",34)

"BLD",8599,"KRN",9.8,"NM","B","PXCEVFI4",35)

"BLD",8599,"KRN",9.8,"NM","B","PXCEVFI5",36)

"BLD",8599,"KRN",9.8,"NM","B","PXCEVIMM",37)

"BLD",8599,"KRN",9.8,"NM","B","PXDSLK",50)

"BLD",8599,"KRN",9.8,"NM","B","PXDXUTL",2)

"BLD",8599,"KRN",9.8,"NM","B","PXPXRM",54)

"BLD",8599,"KRN",9.8,"NM","B","PXPXRMI2",38)

"BLD",8599,"KRN",9.8,"NM","B","PXQUTL3A",3)

"BLD",8599,"KRN",9.8,"NM","B","PXRHS01",39)

"BLD",8599,"KRN",9.8,"NM","B","PXRHS12",40)

"BLD",8599,"KRN",9.8,"NM","B","PXRRFDP",41)

"BLD",8599,"KRN",9.8,"NM","B","PXRRFDSD",42)

"BLD",8599,"KRN",9.8,"NM","B","PXRRMDR",43)

"BLD",8599,"KRN",9.8,"NM","B","PXRRMDR1",44)

"BLD",8599,"KRN",9.8,"NM","B","PXRRPAPI",45)

"BLD",8599,"KRN",9.8,"NM","B","PXRRPCE3",46)

"BLD",8599,"KRN",9.8,"NM","B","PXRRPCE4",47)

"BLD",8599,"KRN",9.8,"NM","B","PXSCH4",48)

"BLD",8599,"KRN",9.8,"NM","B","PXSELDS",51)

"BLD",8599,"KRN",9.8,"NM","B","PXUTL1",1)

"BLD",8599,"KRN",19,0)
19
"BLD",8599,"KRN",19,"NM",0)
^9.68A^^
"BLD",8599,"KRN",19.1,0)
19.1
"BLD",8599,"KRN",101,0)
101
"BLD",8599,"KRN",409.61,0)
409.61
"BLD",8599,"KRN",771,0)
771
"BLD",8599,"KRN",779.2,0)
779.2
"BLD",8599,"KRN",870,0)
870
"BLD",8599,"KRN",8989.51,0)
8989.51
"BLD",8599,"KRN",8989.52,0)
8989.52
"BLD",8599,"KRN",8994,0)
8994
"BLD",8599,"KRN","B",.4,.4)

"BLD",8599,"KRN","B",.401,.401)

"BLD",8599,"KRN","B",.402,.402)

"BLD",8599,"KRN","B",.403,.403)

"BLD",8599,"KRN","B",.5,.5)

"BLD",8599,"KRN","B",.84,.84)

"BLD",8599,"KRN","B",3.6,3.6)

"BLD",8599,"KRN","B",3.8,3.8)

"BLD",8599,"KRN","B",9.2,9.2)

"BLD",8599,"KRN","B",9.8,9.8)

"BLD",8599,"KRN","B",19,19)

"BLD",8599,"KRN","B",19.1,19.1)

"BLD",8599,"KRN","B",101,101)

"BLD",8599,"KRN","B",409.61,409.61)

"BLD",8599,"KRN","B",771,771)

"BLD",8599,"KRN","B",779.2,779.2)

"BLD",8599,"KRN","B",870,870)

"BLD",8599,"KRN","B",8989.51,8989.51)

"BLD",8599,"KRN","B",8989.52,8989.52)

"BLD",8599,"KRN","B",8994,8994)

"BLD",8599,"QDEF")
^^^^NO^^^^YES^^NO
"BLD",8599,"QUES",0)
^9.62^^
"BLD",8599,"REQB",0)
^9.611^19^8
"BLD",8599,"REQB",3,0)
PX*1.0*62^2
"BLD",8599,"REQB",7,0)
PX*1.0*146^2
"BLD",8599,"REQB",10,0)
PX*1.0*165^2
"BLD",8599,"REQB",15,0)
PX*1.0*194^2
"BLD",8599,"REQB",16,0)
LEX*2.0*80^2
"BLD",8599,"REQB",17,0)
ICD*18.0*57^2
"BLD",8599,"REQB",18,0)
SD*5.3*593^2
"BLD",8599,"REQB",19,0)
PX*1.0*203^2
"BLD",8599,"REQB","B","ICD*18.0*57",17)

"BLD",8599,"REQB","B","LEX*2.0*80",16)

"BLD",8599,"REQB","B","PX*1.0*146",7)

"BLD",8599,"REQB","B","PX*1.0*165",10)

"BLD",8599,"REQB","B","PX*1.0*194",15)

"BLD",8599,"REQB","B","PX*1.0*203",19)

"BLD",8599,"REQB","B","PX*1.0*62",3)

"BLD",8599,"REQB","B","SD*5.3*593",18)

"FIA",9000010.07)
V POV
"FIA",9000010.07,0)
^AUPNVPOV(
"FIA",9000010.07,0,0)
9000010.07IP
"FIA",9000010.07,0,1)
y^n^p^^^^n^^n
"FIA",9000010.07,0,10)

"FIA",9000010.07,0,11)

"FIA",9000010.07,0,"RLRO")

"FIA",9000010.07,0,"VR")
1.0^PX
"FIA",9000010.07,9000010.07)
1
"FIA",9000010.07,9000010.07,.01)

"FIA",9000010.07,9000010.07,.019)

"FIA",9000010.07,9000010.07,.15)

"FIA",9000010.07,9000010.07,80006)

"FIA",9000010.18)
V CPT
"FIA",9000010.18,0)
^AUPNVCPT(
"FIA",9000010.18,0,0)
9000010.18IP
"FIA",9000010.18,0,1)
y^n^p^^^^n^^n
"FIA",9000010.18,0,10)

"FIA",9000010.18,0,11)

"FIA",9000010.18,0,"RLRO")

"FIA",9000010.18,0,"VR")
1.0^PX
"FIA",9000010.18,9000010.18)
1
"FIA",9000010.18,9000010.18,.05)

"FIA",9000010.18,9000010.18,.09)

"FIA",9000010.18,9000010.18,.1)

"FIA",9000010.18,9000010.18,.11)

"FIA",9000010.18,9000010.18,.12)

"FIA",9000010.18,9000010.18,.13)

"FIA",9000010.18,9000010.18,.14)

"FIA",9000010.18,9000010.18,.15)

"INI")
PX10P199
"IX",9000010.07,9000010.07,"ACR",0)
9000010.07^ACR^Clinical Reminders index.^MU^^R^IR^I^9000010.07^^^^^A
"IX",9000010.07,9000010.07,"ACR",.1,0)
^^8^8^3131009^^^^
"IX",9000010.07,9000010.07,"ACR",.1,1,0)
This cross-reference builds two indexes, one for finding
"IX",9000010.07,9000010.07,"ACR",.1,2,0)
all patients with a particular diagnosis code and one for finding all
"IX",9000010.07,9000010.07,"ACR",.1,3,0)
the diagnosis codes a patient has.
"IX",9000010.07,9000010.07,"ACR",.1,4,0)
The indexes are stored in the Clinical Reminders index global as:
"IX",9000010.07,9000010.07,"ACR",.1,5,0)
 ^PXRMINDX(9000010.07,"IPP",ICD IEN,PS,DFN,VISIT DATE,DAS) and
"IX",9000010.07,9000010.07,"ACR",.1,6,0)
 ^PXRMINDX(9000010.07,"PPI",DFN,PS,ICD IEN,VISIT DATE,DAS)
"IX",9000010.07,9000010.07,"ACR",.1,7,0)
respectively. PS is the primary/secondary code. Possible values are P (primary), S (secondary) or U (undefined).
"IX",9000010.07,9000010.07,"ACR",.1,8,0)
For all the details, see the Clinical Reminders Index Technical Guide/Programmer's Manual.
"IX",9000010.07,9000010.07,"ACR",1)
D SVFILEC^PXPXRM(9000010.07,.X,.DA)
"IX",9000010.07,9000010.07,"ACR",2)
D KVFILEC^PXPXRM(9000010.07,.X,.DA)
"IX",9000010.07,9000010.07,"ACR",2.5)
K ^PXRMINDX(9000010.07)
"IX",9000010.07,9000010.07,"ACR",11.1,0)
^.114IA^4^4
"IX",9000010.07,9000010.07,"ACR",11.1,1,0)
1^F^9000010.07^.01^^1^F
"IX",9000010.07,9000010.07,"ACR",11.1,2,0)
2^F^9000010.07^.02^^2^F
"IX",9000010.07,9000010.07,"ACR",11.1,3,0)
3^F^9000010.07^.03^^3^F
"IX",9000010.07,9000010.07,"ACR",11.1,4,0)
4^F^9000010.07^.12
"MBREQ")
0
"PKG",111,-1)
1^1
"PKG",111,0)
PCE PATIENT CARE ENCOUNTER^PX^Patient Care Encounter
"PKG",111,20,0)
^9.402P^^
"PKG",111,22,0)
^9.49I^1^1
"PKG",111,22,1,0)
1.0^2960812^2960822^1
"PKG",111,22,1,"PAH",1,0)
199^3140625
"PKG",111,22,1,"PAH",1,1,0)
^^3^3^3140625
"PKG",111,22,1,"PAH",1,1,1,0)
ICD-10 REMEDIATION 
"PKG",111,22,1,"PAH",1,1,2,0)
This patch distributes the necessary components of PCE to allow
"PKG",111,22,1,"PAH",1,1,3,0)
for the transition to the ICD-10-CM diagnosis coding system.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
58
"RTN","AUPNSICD")
0^4^B1233832^B1050074
"RTN","AUPNSICD",1,0)
AUPNSICD ;OHPRD/LAB,SCK - Screen Purpose of Visit/ICD9 codes ; 15 May 2012  10:05 PM
"RTN","AUPNSICD",2,0)
 ;;1.0;PCE PATIENT CARE ENCOUNTER;**121,149,190,194,199**;Aug 12, 1996;Build 51
"RTN","AUPNSICD",3,0)
 ;;93.2;IHS PATIENT DICTIONARIES.;;JUL 01, 1993
"RTN","AUPNSICD",4,0)
 ;; Modified Feb. 2012 for ICD-10 project. T.J.Holloway
"RTN","AUPNSICD",5,0)
 ;
"RTN","AUPNSICD",6,0)
 N ICDSTR,ICDVDT,X
"RTN","AUPNSICD",7,0)
 ; Define variable PXCEVIEN - PX*1*190
"RTN","AUPNSICD",8,0)
 I '$D(PXCEVIEN) S PXCEVIEN="" I DA,$G(^AUPNVPOV(DA,0)) S PXCEVIEN=$P(^AUPNVPOV(DA,0),U,3)
"RTN","AUPNSICD",9,0)
 S ICDVDT=$$CSDATE^PXDXUTL(PXCEVIEN)
"RTN","AUPNSICD",10,0)
 S ICDSTR=$$ICDDATA^ICDXCODE("DIAG",Y,ICDVDT,"I")
"RTN","AUPNSICD",11,0)
 ;
"RTN","AUPNSICD",12,0)
 ;**************************************************************************
"RTN","AUPNSICD",13,0)
 ;** if the user is a VA employee jump down to line tag VAIN              **
"RTN","AUPNSICD",14,0)
 ;************************************************************************** 
"RTN","AUPNSICD",15,0)
 G:$G(DUZ("AG"))="V" VAIN
"RTN","AUPNSICD",16,0)
 ;
"RTN","AUPNSICD",17,0)
 ;I 1 Q:$G(DUZ("AG"))'="I"
"RTN","AUPNSICD",18,0)
EIN ; SCREEN OUT E CODES AND INACTIVE CODES
"RTN","AUPNSICD",19,0)
 ;I $E(^ICD9(Y,0),U,1)'="E",$P(^(0),U,9)=""
"RTN","AUPNSICD",20,0)
 ;I $P(^ICD9(Y,0),U,1)'="E",$P(^(0),U,9)=""
"RTN","AUPNSICD",21,0)
 I $P(ICDSTR,U,2)'="E",$P(ICDSTR,U,10)=1
"RTN","AUPNSICD",22,0)
 G:'$T XIT
"RTN","AUPNSICD",23,0)
SEX ; IF 'USE WITH SEX' FIELD HAS A VALUE CHECK THAT VALUE AGAINST AUPNSEX
"RTN","AUPNSICD",24,0)
 G:'$D(AUPNSEX) AGE
"RTN","AUPNSICD",25,0)
 ;I $P(^ICD9(Y,0),U,10)=""!($P(^ICD9(Y,0),U,10)=AUPNSEX)
"RTN","AUPNSICD",26,0)
 I $P(ICDSTR,U,11)=""!($P(ICDSTR,U,11)=AUPNSEX)
"RTN","AUPNSICD",27,0)
 G:'$T XIT
"RTN","AUPNSICD",28,0)
AGE ; IF THERE IS AGE CRITERIA DATA AVAILABLE CHECK TO SEE THAT IT FITS THE CRITERIA
"RTN","AUPNSICD",29,0)
 ;G:'$D(AUPNDAYS) XIT
"RTN","AUPNSICD",30,0)
 ;G:'$D(^ICD9(Y,9999999)) XIT
"RTN","AUPNSICD",31,0)
 ;I $P(^(9999999),U,1)=""!($P(^(9999999),U,1)<AUPNDAYS)
"RTN","AUPNSICD",32,0)
 ;G:'$T XIT
"RTN","AUPNSICD",33,0)
 ;I $P(^(9999999),U,2)=""!($P(^(9999999),U,2)>AUPNDAYS)
"RTN","AUPNSICD",34,0)
XIT ;
"RTN","AUPNSICD",35,0)
 K DA,PXCEVIEN
"RTN","AUPNSICD",36,0)
 Q
"RTN","AUPNSICD",37,0)
 ;
"RTN","AUPNSICD",38,0)
VAIN ;SCREEN OUT INACTIVE CODES
"RTN","AUPNSICD",39,0)
 ; E codes are ok in the VA
"RTN","AUPNSICD",40,0)
 I $P(ICDSTR,U,10)=1
"RTN","AUPNSICD",41,0)
 Q
"RTN","AUPNSICD",42,0)
 ;
"RTN","PX10P199")
0^^B8361541^n/a
"RTN","PX10P199",1,0)
PX10P199 ;HP/RBD - ENVIRONMENT CHECK WITH PRE-INIT CODE ;17 Oct 2013  2:53 PM
"RTN","PX10P199",2,0)
 ;;1.0;PCE PATIENT CARE ENCOUNTER;**199**;Aug 12, 1996;Build 51
"RTN","PX10P199",3,0)
 ; 
"RTN","PX10P199",4,0)
ENV ; environment check
"RTN","PX10P199",5,0)
 ; No special environment check at this time.
"RTN","PX10P199",6,0)
PRE ; set up check points for pre-init
"RTN","PX10P199",7,0)
 N %
"RTN","PX10P199",8,0)
 S %=$$NEWCP^XPDUTL("VPOVDSC","VPOVDSC^PX10P199")
"RTN","PX10P199",9,0)
 S %=$$NEWCP^XPDUTL("TREATDS","TREATDS^PX10P199")
"RTN","PX10P199",10,0)
 S %=$$NEWCP^XPDUTL("DXMNUTX","DXMNUTX^PX10P199")
"RTN","PX10P199",11,0)
 S %=$$NEWCP^XPDUTL("ICDNARX","ICDNARX^PX10P199")
"RTN","PX10P199",12,0)
 Q
"RTN","PX10P199",13,0)
 ;
"RTN","PX10P199",14,0)
VPOVDSC ; change Description of V POV to make ICD9 reference generic
"RTN","PX10P199",15,0)
 D BMES^XPDUTL("Modifying V POV Description to make ICD9 reference more generic.")
"RTN","PX10P199",16,0)
 S ^DIC(9000010.07,"%D",24,0)="appropriate ICD diagnosis code. Physician entered narrative which modifies"
"RTN","PX10P199",17,0)
 D DONE
"RTN","PX10P199",18,0)
 Q
"RTN","PX10P199",19,0)
 ;
"RTN","PX10P199",20,0)
TREATDS ; change 'ICD-9-CM' to 'ICD-CM' in TREATMENT file Description
"RTN","PX10P199",21,0)
 D BMES^XPDUTL("Updating 'ICD-9-CM' to 'ICD-CM' in TREATMENT file Description.")
"RTN","PX10P199",22,0)
 S ^DIC(9999999.17,"%D",2,0)="of treatments that are not covered in the ICD-CM Procedures or the CPT"
"RTN","PX10P199",23,0)
 S ^DIC(9999999.17,"%D",8,0)="the lack of a coded CPT or ICD-CM."
"RTN","PX10P199",24,0)
 D OVER
"RTN","PX10P199",25,0)
 Q
"RTN","PX10P199",26,0)
 ;
"RTN","PX10P199",27,0)
DXMNUTX ; change text of DX submenu from Diagnosis (ICD 9) to Diagnosis (ICD)
"RTN","PX10P199",28,0)
 D BMES^XPDUTL("Modifying DX submenu text to 'Diagnosis (ICD)' under PXCE ADD/EDIT MENU")
"RTN","PX10P199",29,0)
 N DXMNIEN,MENUTXT,ORDA,PXA
"RTN","PX10P199",30,0)
 S DXMNIEN=+$$FIND1^DIC(101,"","X","PXCE POV ADD","B")
"RTN","PX10P199",31,0)
 I 'DXMNIEN D BMES^XPDUTL("Sub Menu PXCE POV ADD not found.  Aborting modification...") Q
"RTN","PX10P199",32,0)
 S MENUTXT=$$GET1^DIQ(101,DXMNIEN,1)
"RTN","PX10P199",33,0)
 I MENUTXT="Diagnosis (ICD)" D  Q
"RTN","PX10P199",34,0)
 . D BMES^XPDUTL("Sub Menu PXCE POV ADD already has correct wording.  Aborting modification...")
"RTN","PX10P199",35,0)
 S ORDA(101,DXMNIEN_",",1)="Diagnosis (ICD)"
"RTN","PX10P199",36,0)
 D FILE^DIE("","ORDA","ORDERRM")
"RTN","PX10P199",37,0)
 S PXA(1,0)="This action allows you to add/edit an ICD coded diagnosis"
"RTN","PX10P199",38,0)
 S PXA(2,0)="for a patient encounter."
"RTN","PX10P199",39,0)
 D WP^DIE(101,DXMNIEN_",",3.5,"","PXA")
"RTN","PX10P199",40,0)
 D COMPLETE
"RTN","PX10P199",41,0)
 Q
"RTN","PX10P199",42,0)
 ;
"RTN","PX10P199",43,0)
ICDNARX ; Delete ICD NARRATIVE field in prep for new version
"RTN","PX10P199",44,0)
 D BMES^XPDUTL("Deleting old ICD NARRATIVE field.")
"RTN","PX10P199",45,0)
 N DA,DIK
"RTN","PX10P199",46,0)
 S DIK="^DD(9000010.07,",DA=.019,DA(1)=9000010.07
"RTN","PX10P199",47,0)
 D ^DIK
"RTN","PX10P199",48,0)
 D END
"RTN","PX10P199",49,0)
 Q
"RTN","PX10P199",50,0)
 ;
"RTN","PX10P199",51,0)
DONE ; display message that V POV description update is done
"RTN","PX10P199",52,0)
 D BMES^XPDUTL("V POV Description updated.")
"RTN","PX10P199",53,0)
 Q
"RTN","PX10P199",54,0)
 ;
"RTN","PX10P199",55,0)
OVER ; display message that TREATMENT description update is done
"RTN","PX10P199",56,0)
 D BMES^XPDUTL("TREATMENT Description updated.")
"RTN","PX10P199",57,0)
 Q
"RTN","PX10P199",58,0)
 ;
"RTN","PX10P199",59,0)
COMPLETE ; display message that step has completed
"RTN","PX10P199",60,0)
 D BMES^XPDUTL("Step to change DX submenu option verbiage to 'Diagnosis (ICD)' complete.")
"RTN","PX10P199",61,0)
 Q
"RTN","PX10P199",62,0)
 ;
"RTN","PX10P199",63,0)
END ; display message that pre-init has completed successfully
"RTN","PX10P199",64,0)
 D BMES^XPDUTL("Pre-init complete")
"RTN","PX10P199",65,0)
 Q
"RTN","PX10P199",66,0)
 ;
"RTN","PXAICPTV")
0^5^B23770661^B16278915
"RTN","PXAICPTV",1,0)
PXAICPTV ;ISL/JVS,ISA/KWP,SCK - VALIDATE PROCEDURES(CPT) ;11/14/96  12:46
"RTN","PXAICPTV",2,0)
 ;;1.0;PCE PATIENT CARE ENCOUNTER;**15,73,74,111,121,130,168,194,199**;Aug 12, 1996;Build 51
"RTN","PXAICPTV",3,0)
 ;
"RTN","PXAICPTV",4,0)
 ; edited to allow Historical Encounters to use ICD-10 codes even though Visit Date is pre-ICD-10.
"RTN","PXAICPTV",5,0)
VAL ;--VALIDATE ENOUGH DATA
"RTN","PXAICPTV",6,0)
 ;----Missing a pointer to PROCEDURE(CPT) name
"RTN","PXAICPTV",7,0)
 I $G(PXAA("PROCEDURE"))']"" D  Q:$G(STOP)
"RTN","PXAICPTV",8,0)
 .S STOP=1 ;--USED TO STOP DO LOOP
"RTN","PXAICPTV",9,0)
 .S PXAERRF=1 ;--FLAG INDICATES THERE IS AN ERROR
"RTN","PXAICPTV",10,0)
 .S PXADI("DIALOG")=8390001.001
"RTN","PXAICPTV",11,0)
 .S PXAERR(9)="PROCEDURE"
"RTN","PXAICPTV",12,0)
 .S PXAERR(11)=$G(PXAA("PROCEDURE"))
"RTN","PXAICPTV",13,0)
 .S PXAERR(12)="You are missing a pointer to the PROCEDURE CPT FILE #81 that represents the procedure's name"
"RTN","PXAICPTV",14,0)
 ;
"RTN","PXAICPTV",15,0)
 ;----NOT a pointer to PROCEDURE CPT FILE#81
"RTN","PXAICPTV",16,0)
 I +$$CPT^ICPTCOD($G(PXAA("PROCEDURE")))'>0 D  Q:$G(STOP)
"RTN","PXAICPTV",17,0)
 .S STOP=1
"RTN","PXAICPTV",18,0)
 .S PXAERRF=1
"RTN","PXAICPTV",19,0)
 .S PXADI("DIALOG")=8390001.001
"RTN","PXAICPTV",20,0)
 .S PXAERR(9)="PROCEDURE"
"RTN","PXAICPTV",21,0)
 .S PXAERR(11)=$G(PXAA("PROCEDURE"))
"RTN","PXAICPTV",22,0)
 .S PXAERR(12)=PXAERR(11)_" is NOT a pointer value to the CPT FILE #81"
"RTN","PXAICPTV",23,0)
 ;
"RTN","PXAICPTV",24,0)
 ;----Not a valid CPT
"RTN","PXAICPTV",25,0)
 I '$P($$CPT^ICPTCOD(PXAA("PROCEDURE"),+^AUPNVSIT(PXAVISIT,0)),"^",7) D  Q:$G(STOP)
"RTN","PXAICPTV",26,0)
 .S STOP=1
"RTN","PXAICPTV",27,0)
 .S PXAERRF=1
"RTN","PXAICPTV",28,0)
 .S PXADI("DIALOG")=8390001.001
"RTN","PXAICPTV",29,0)
 .S PXAERR(9)="PROCEDURE"
"RTN","PXAICPTV",30,0)
 .S PXAERR(11)=$G(PXAA("PROCEDURE"))
"RTN","PXAICPTV",31,0)
 .S PXAERR(12)=PXAERR(11)_" is NOT a valid CPT code"
"RTN","PXAICPTV",32,0)
 ;
"RTN","PXAICPTV",33,0)
 ;----Not a valid modifier
"RTN","PXAICPTV",34,0)
 N SUB,MODIEN
"RTN","PXAICPTV",35,0)
 S SUB=""
"RTN","PXAICPTV",36,0)
 F  S SUB=$O(PXAA("MODIFIERS",SUB)) Q:SUB=""!($G(STOP))  D
"RTN","PXAICPTV",37,0)
 .;S MODIEN=$$MODP^ICPTMOD(PXAA("PROCEDURE"),SUB,"E","",0)
"RTN","PXAICPTV",38,0)
 .S MODIEN=$$MODP^ICPTMOD(PXAA("PROCEDURE"),SUB,"E",+^AUPNVSIT(PXAVISIT,0),0)
"RTN","PXAICPTV",39,0)
 .I $P(MODIEN,"^")>0 Q
"RTN","PXAICPTV",40,0)
 .S STOP=1
"RTN","PXAICPTV",41,0)
 .S PXAERRF=1
"RTN","PXAICPTV",42,0)
 .S PXADI("DIALOG")=8390001.001
"RTN","PXAICPTV",43,0)
 .S PXAERR(9)="MODIFIERS"_","_SUB
"RTN","PXAICPTV",44,0)
 .S PXAERR(11)=""
"RTN","PXAICPTV",45,0)
 .S PXAERR(12)=SUB_" is NOT a valid modifier for procedure "_$G(PXAA("PROCEDURE"))
"RTN","PXAICPTV",46,0)
 ;----"Missing the number of times the procedure was performed.
"RTN","PXAICPTV",47,0)
 I $G(PXAA("QTY"))<1 D
"RTN","PXAICPTV",48,0)
 .S STOP=0
"RTN","PXAICPTV",49,0)
 .S PXAERRF=1
"RTN","PXAICPTV",50,0)
 .S PXADI("DIALOG")=8390001.002
"RTN","PXAICPTV",51,0)
 .S PXAERR(9)="QTY"
"RTN","PXAICPTV",52,0)
 .S PXAERR(11)=$G(PXAA("QTY"))
"RTN","PXAICPTV",53,0)
 .S PXAERR(12)="If this node is empty we will assume it should be '1'. If it is a less than '1' we will delete any reference to it in the data base."
"RTN","PXAICPTV",54,0)
 ;
"RTN","PXAICPTV",55,0)
 Q:$G(STOP)=1
"RTN","PXAICPTV",56,0)
 N DIAGNUM,DIAGSTR,ICDDATA,PXDXDATE
"RTN","PXAICPTV",57,0)
 S PXDXDATE=$$CSDATE^PXDXUTL(PXAVISIT)
"RTN","PXAICPTV",58,0)
 ;
"RTN","PXAICPTV",59,0)
 F DIAGNUM=1:1:8 D  Q:$G(STOP)=1
"RTN","PXAICPTV",60,0)
 . S DIAGSTR="DIAGNOSIS"_$S(DIAGNUM>1:" "_DIAGNUM,1:"")
"RTN","PXAICPTV",61,0)
 . I $G(PXAA(DIAGSTR))]"" D
"RTN","PXAICPTV",62,0)
 .. S ICDDATA=$$ICDDATA^ICDXCODE("DIAG",$G(PXAA(DIAGSTR)),PXDXDATE,"I")
"RTN","PXAICPTV",63,0)
 .. I $P(ICDDATA,"^",1)'>0 D  Q:$G(STOP)=1
"RTN","PXAICPTV",64,0)
 ... S STOP=1
"RTN","PXAICPTV",65,0)
 ... S PXAERRF=1
"RTN","PXAICPTV",66,0)
 ... S PXADI("DIALOG")=8390001.001
"RTN","PXAICPTV",67,0)
 ... S PXAERR(9)="PROCEDURE"
"RTN","PXAICPTV",68,0)
 ... S PXAERR(11)=$G(PXAA(DIAGSTR))
"RTN","PXAICPTV",69,0)
 ... S PXAERR(12)="PROCEDURE DIAGNOSIS #"_DIAGNUM_" ("_PXAERR(11)_") is NOT a valid pointer value to the ICD DIAGNOSIS FILE #80"
"RTN","PXAICPTV",70,0)
 .. I $P(ICDDATA,"^",10)'=1 D  Q:$G(STOP)=1
"RTN","PXAICPTV",71,0)
 ... S STOP=1
"RTN","PXAICPTV",72,0)
 ... S PXAERRF=1
"RTN","PXAICPTV",73,0)
 ... S PXADI("DIALOG")=8390001.001
"RTN","PXAICPTV",74,0)
 ... S PXAERR(9)="PROCEDURE"
"RTN","PXAICPTV",75,0)
 ... S PXAERR(11)=$G(PXAA(DIAGSTR))
"RTN","PXAICPTV",76,0)
 ... S PXAERR(12)="PROCEDURE DIAGNOSIS #"_DIAGNUM_" ("_PXAERR(11)_") is NOT an Active ICD code"
"RTN","PXAICPTV",77,0)
 ;
"RTN","PXAICPTV",78,0)
 ;
"RTN","PXAICPTV",79,0)
 Q
"RTN","PXAICPTV",80,0)
VAL04 ;---PROVIDER NARRATIVE
"RTN","PXAICPTV",81,0)
 S STOP=1
"RTN","PXAICPTV",82,0)
 S PXAERRF=1
"RTN","PXAICPTV",83,0)
 S PXADI("DIALOG")=8390001.001
"RTN","PXAICPTV",84,0)
 S PXAERR(9)="NARRATIVE"
"RTN","PXAICPTV",85,0)
 S PXAERR(11)=$G(PXAA("NARRATIVE"))
"RTN","PXAICPTV",86,0)
 S PXAERR(12)="We are unable to retrieve a narrative from the PROVIDER NARRATIVE file #9999999.27"
"RTN","PXAICPTV",87,0)
 Q
"RTN","PXAICPTV",88,0)
VAL45 ;---PROVIDER NARRATIVE CATEGORY
"RTN","PXAICPTV",89,0)
 S STOP=0
"RTN","PXAICPTV",90,0)
 S PXAERRF=1
"RTN","PXAICPTV",91,0)
 S PXADI("DIALOG")=8390001.002
"RTN","PXAICPTV",92,0)
 S PXAERR(9)="CATEGORY"
"RTN","PXAICPTV",93,0)
 S PXAERR(11)=$G(PXAA("CATEGORY"))
"RTN","PXAICPTV",94,0)
 S PXAERR(12)="We are unable to retrieve a narrative from the PROVIDER NARRATIVE file #9999999.27"
"RTN","PXAICPTV",95,0)
 Q
"RTN","PXAICPTV",96,0)
 ;---------------------SUBROUTINE------------------------------
"RTN","PXAICPTV",97,0)
ARRAY ;--SET ERRORS AND WARNINGS INTO AN ARRAY TO RETURN TO CALLER
"RTN","PXAICPTV",98,0)
 I PXADI("DIALOG")=8390001.001 D
"RTN","PXAICPTV",99,0)
 .S PXASUB=PXASUB+1
"RTN","PXAICPTV",100,0)
 .S PXAPROB($J,PXASUB,"ERROR1",PXAERR(7),PXAERR(9),PXAK)=$G(PXAERR(12))
"RTN","PXAICPTV",101,0)
 I PXADI("DIALOG")=8390001.002 D
"RTN","PXAICPTV",102,0)
 .S PXASUB=PXASUB+1
"RTN","PXAICPTV",103,0)
 .S PXAPROB($J,PXASUB,"WARNING2",PXAERR(7),PXAERR(9),PXAK)=$G(PXAERR(12))
"RTN","PXAICPTV",104,0)
 I PXADI("DIALOG")=8390001.003 D
"RTN","PXAICPTV",105,0)
 .S PXASUB=PXASUB+1
"RTN","PXAICPTV",106,0)
 .S PXAPROB($J,PXASUB,"WARNING3","ENCOUNTER",1,"SC")=$G(PXAERR("6W"))
"RTN","PXAICPTV",107,0)
 .S PXAPROB($J,PXASUB,"WARNING3","ENCOUNTER",1,"AO")=$G(PXAERR("7W"))
"RTN","PXAICPTV",108,0)
 .S PXAPROB($J,PXASUB,"WARNING3","ENCOUNTER",1,"IR")=$G(PXAERR("8W"))
"RTN","PXAICPTV",109,0)
 .S PXAPROB($J,PXASUB,"WARNING3","ENCOUNTER",1,"EC")=$G(PXAERR("9W"))
"RTN","PXAICPTV",110,0)
 .S PXAPROB($J,PXASUB,"WARNING3","ENCOUNTER",1,"MST")=$G(PXAERR("10W"))
"RTN","PXAICPTV",111,0)
 .;PX*1*111 - Add HNC
"RTN","PXAICPTV",112,0)
 .S PXAPROB($J,PXASUB,"WARNING3","ENCOUNTER",1,"HNC")=$G(PXAERR("17W"))
"RTN","PXAICPTV",113,0)
 .S PXAPROB($J,PXASUB,"WARNING3","ENCOUNTER",1,"CV")=$G(PXAERR("18W"))
"RTN","PXAICPTV",114,0)
 .S PXAPROB($J,PXASUB,"WARNING3","ENCOUNTER",1,"SHAD")=$G(PXAERR("19W"))
"RTN","PXAICPTV",115,0)
 I PXADI("DIALOG")=8390001.004 D
"RTN","PXAICPTV",116,0)
 .S PXASUB=PXASUB+1
"RTN","PXAICPTV",117,0)
 .S PXAPROB($J,PXASUB,"ERROR4","PX/DL",PXAK)=$G(PXAERR("PL1"))
"RTN","PXAICPTV",118,0)
 Q
"RTN","PXAIIMMV")
0^6^B4109825^B492495
"RTN","PXAIIMMV",1,0)
PXAIIMMV ;ISL/PKR - VALIDATE IMMUNIZATION DATA ;24 May 2013  7:50 AM
"RTN","PXAIIMMV",2,0)
 ;;1.0;PCE PATIENT CARE ENCOUNTER;**199**;Aug 12, 1996;Build 51
"RTN","PXAIIMMV",3,0)
 ;
"RTN","PXAIIMMV",4,0)
VAL ;Make sure the required field is present.
"RTN","PXAIIMMV",5,0)
 I '$D(PXAA("IMMUN")) D  Q:$G(STOP)=1
"RTN","PXAIIMMV",6,0)
 . S STOP=1
"RTN","PXAIIMMV",7,0)
 . S PXAERRF=1
"RTN","PXAIIMMV",8,0)
 . S PXADI("DIALOG")=8390001.001
"RTN","PXAIIMMV",9,0)
 . S PXAERR(9)="IMMUNIZATION"
"RTN","PXAIIMMV",10,0)
 . S PXAERR(10)="AFTER"
"RTN","PXAIIMMV",11,0)
 . S PXAERR(11)=$G(PXAA("IMMUNIZATION"))
"RTN","PXAIIMMV",12,0)
 . S PXAERR(12)="You are missing the name of the immunization"
"RTN","PXAIIMMV",13,0)
 Q:$G(PXAA("DELETE"))=1  ; don't bother checking diagnoses if this is a deletion
"RTN","PXAIIMMV",14,0)
 ; confirm valid diagnosis pointers
"RTN","PXAIIMMV",15,0)
 N DIAGNUM,DIAGSTR,ICDDATA,PXDXDATE
"RTN","PXAIIMMV",16,0)
 S PXDXDATE=$$CSDATE^PXDXUTL(PXAVISIT)
"RTN","PXAIIMMV",17,0)
 F DIAGNUM=1:1:8 D  Q:$G(STOP)=1
"RTN","PXAIIMMV",18,0)
 . S DIAGSTR="DIAGNOSIS"_$S(DIAGNUM>1:" "_DIAGNUM,1:"")
"RTN","PXAIIMMV",19,0)
 . I $G(PXAA(DIAGSTR))]"" D
"RTN","PXAIIMMV",20,0)
 .. S ICDDATA=$$ICDDATA^ICDXCODE("DIAG",$G(PXAA(DIAGSTR)),PXDXDATE,"I")
"RTN","PXAIIMMV",21,0)
 .. I $P(ICDDATA,"^",1)'>0 D  Q:$G(STOP)=1
"RTN","PXAIIMMV",22,0)
 ... S STOP=1
"RTN","PXAIIMMV",23,0)
 ... S PXAERRF=1
"RTN","PXAIIMMV",24,0)
 ... S PXADI("DIALOG")=8390001.001
"RTN","PXAIIMMV",25,0)
 ... S PXAERR(9)="IMMUNIZATION"
"RTN","PXAIIMMV",26,0)
 ... S PXAERR(10)="AFTER"
"RTN","PXAIIMMV",27,0)
 ... S PXAERR(11)=$G(PXAA(DIAGSTR))
"RTN","PXAIIMMV",28,0)
 ... S PXAERR(12)="IMMUNIZATION DIAGNOSIS #"_DIAGNUM_" ("_PXAERR(11)_") is NOT a valid pointer value to the ICD DIAGNOSIS FILE #80"
"RTN","PXAIIMMV",29,0)
 .. I $P(ICDDATA,"^",10)'=1 D  Q:$G(STOP)=1
"RTN","PXAIIMMV",30,0)
 ... S STOP=1
"RTN","PXAIIMMV",31,0)
 ... S PXAERRF=1
"RTN","PXAIIMMV",32,0)
 ... S PXADI("DIALOG")=8390001.001
"RTN","PXAIIMMV",33,0)
 ... S PXAERR(9)="IMMUNIZATION"
"RTN","PXAIIMMV",34,0)
 ... S PXAERR(10)="AFTER"
"RTN","PXAIIMMV",35,0)
 ... S PXAERR(11)=$G(PXAA(DIAGSTR))
"RTN","PXAIIMMV",36,0)
 ... S PXAERR(12)="IMMUNIZATION DIAGNOSIS #"_DIAGNUM_" ("_PXAERR(11)_") is NOT an Active ICD code"
"RTN","PXAIIMMV",37,0)
 ;
"RTN","PXAIIMMV",38,0)
 Q
"RTN","PXAIPL")
0^55^B5170500^B4827876
"RTN","PXAIPL",1,0)
PXAIPL ;ISL/JVS - PROBLEM LIST ;24 Jan 2013  12:59 PM
"RTN","PXAIPL",2,0)
 ;;1.0;PCE PATIENT CARE ENCOUNTER;**69,124,168,199**;Aug 12, 1996;Build 51
"RTN","PXAIPL",3,0)
 ;
"RTN","PXAIPL",4,0)
 ;
"RTN","PXAIPL",5,0)
 Q
"RTN","PXAIPL",6,0)
PL ;--ENTRY POINT TO EDIT PROBLEMS
"RTN","PXAIPL",7,0)
 ;
"RTN","PXAIPL",8,0)
 ;
"RTN","PXAIPL",9,0)
 Q:'$L($T(^GMPLUTL))
"RTN","PXAIPL",10,0)
 ;
"RTN","PXAIPL",11,0)
 N PXARRAY,RESULT
"RTN","PXAIPL",12,0)
DECIDE ;--DECIDE IF A PROBLEM
"RTN","PXAIPL",13,0)
 I $G(PXAA("PL ADD"))=1 G SET
"RTN","PXAIPL",14,0)
 I $G(PXAA("PL IEN"))>0 G SET
"RTN","PXAIPL",15,0)
 I $G(PXAA("PL ACTIVE"))]"" G SET
"RTN","PXAIPL",16,0)
 I $G(PXAA("PL ONSET DATE"))>0 G SET
"RTN","PXAIPL",17,0)
 I $G(PXAA("PL RESOLVED DATE"))>0 G SET
"RTN","PXAIPL",18,0)
 ;PX*1.0*124
"RTN","PXAIPL",19,0)
 ;I $G(PXAA("PL SC"))]"" G SET
"RTN","PXAIPL",20,0)
 ;I $G(PXAA("PL AO"))]"" G SET
"RTN","PXAIPL",21,0)
 ;I $G(PXAA("PL IR"))]"" G SET
"RTN","PXAIPL",22,0)
 ;I $G(PXAA("PL EC"))]"" G SET
"RTN","PXAIPL",23,0)
 ;I $G(PXAA("PL MST"))]"" G SET
"RTN","PXAIPL",24,0)
 ;I $G(PXAA("PL HNC"))]"" G SET
"RTN","PXAIPL",25,0)
 ;I $G(PXAA("PL CV"))]"" G SET
"RTN","PXAIPL",26,0)
 ;I $G(PXAA("PL SHAD"))]"" G SET
"RTN","PXAIPL",27,0)
 Q
"RTN","PXAIPL",28,0)
 ;
"RTN","PXAIPL",29,0)
 ;
"RTN","PXAIPL",30,0)
SET ;--REQUIRED
"RTN","PXAIPL",31,0)
 S PXARRAY("PATIENT")=$G(PATIENT)
"RTN","PXAIPL",32,0)
 S PXARRAY("NARRATIVE")=$G(PXAA("NARRATIVE"))
"RTN","PXAIPL",33,0)
 S PXARRAY("PROVIDER")=$G(PXAA("ENC PROVIDER"))
"RTN","PXAIPL",34,0)
 ;--OPTIONAL
"RTN","PXAIPL",35,0)
 S PXARRAY("DIAGNOSIS")=$G(PXAA("DIAGNOSIS"))
"RTN","PXAIPL",36,0)
 S PXARRAY("DX_DATE_OF_INTEREST")=$$CSDATE^PXDXUTL(PXAVISIT)
"RTN","PXAIPL",37,0)
 S PXARRAY("LEXICON")=$G(PXAA("LEXICON TERM"))
"RTN","PXAIPL",38,0)
 S PXARRAY("STATUS")=$G(PXAA("PL ACTIVE"))
"RTN","PXAIPL",39,0)
 S PXARRAY("ONSET")=$G(PXAA("PL ONSET DATE"))
"RTN","PXAIPL",40,0)
 I '$G(PXAA("PL IEN")) S PXARRAY("RECORDED")=$G(PXAA("EVENT D/T"))
"RTN","PXAIPL",41,0)
 S PXARRAY("RESOLVED")=$G(PXAA("PL RESOLVED DATE"))
"RTN","PXAIPL",42,0)
 S PXARRAY("COMMENT")=$G(PXAA("COMMENT"))
"RTN","PXAIPL",43,0)
 I $G(PXARRAY("COMMENT"))="@" S PXARRAY("COMMENT")=""
"RTN","PXAIPL",44,0)
 ;--LOCATION
"RTN","PXAIPL",45,0)
 S PXARRAY("LOCATION")=$P($G(^AUPNVSIT(PXAVISIT,0)),"^",22)
"RTN","PXAIPL",46,0)
 ;--SERVICE CONNECTEDNESS
"RTN","PXAIPL",47,0)
 S PXARRAY("SC")=$P(AFTER800,"^",1)
"RTN","PXAIPL",48,0)
 S PXARRAY("AO")=$P(AFTER800,"^",2)
"RTN","PXAIPL",49,0)
 S PXARRAY("IR")=$P(AFTER800,"^",3)
"RTN","PXAIPL",50,0)
 S PXARRAY("EC")=$P(AFTER800,"^",4)
"RTN","PXAIPL",51,0)
 S PXARRAY("MST")=$P(AFTER800,"^",5)
"RTN","PXAIPL",52,0)
 S PXARRAY("HNC")=$P(AFTER800,"^",6)
"RTN","PXAIPL",53,0)
 S PXARRAY("CV")=$P(AFTER800,"^",7)
"RTN","PXAIPL",54,0)
 S PXARRAY("SHAD")=$P(AFTER800,"^",8)
"RTN","PXAIPL",55,0)
 ;---MISC
"RTN","PXAIPL",56,0)
 S PXARRAY("PROBLEM")=$G(PXAA("PL IEN"))
"RTN","PXAIPL",57,0)
 ;
"RTN","PXAIPL",58,0)
 ;
"RTN","PXAIPL",59,0)
 ;
"RTN","PXAIPL",60,0)
RUN ;
"RTN","PXAIPL",61,0)
 D UPDATE^GMPLUTL(.PXARRAY,.RESULT)
"RTN","PXAIPL",62,0)
 I RESULT(0)="" S $P(AFTER0,"^",16)=RESULT
"RTN","PXAIPL",63,0)
 ;--**SET ERROR INTO DIALOG
"RTN","PXAIPL",64,0)
 I RESULT(0)]"" D
"RTN","PXAIPL",65,0)
 .S PXAERR("PL1")=$G(RESULT(0))
"RTN","PXAIPL",66,0)
 .S PXAERRF=1
"RTN","PXAIPL",67,0)
 .S PXADI("DIALOG")=8390001.004
"RTN","PXAIPL",68,0)
 Q
"RTN","PXAIPOV")
0^7^B24084108^B24363290
"RTN","PXAIPOV",1,0)
PXAIPOV ;ISL/JVS,ESW - SET THE DIAGNOSIS/PROBLEM LIST NODES ;6/25/03 2:05pm
"RTN","PXAIPOV",2,0)
 ;;1.0;PCE PATIENT CARE ENCOUNTER;**28,73,69,108,112,130,124,174,168,203,199**;Aug 12, 1996;Build 51
"RTN","PXAIPOV",3,0)
 ;
"RTN","PXAIPOV",4,0)
 Q
"RTN","PXAIPOV",5,0)
POV ;--CREATE DIAGNOSIS
"RTN","PXAIPOV",6,0)
 ;
"RTN","PXAIPOV",7,0)
SET ;--SET AND NEW VARIABLES
"RTN","PXAIPOV",8,0)
 N AFTER0,AFTER12,AFTER800,AFTER801,AFTER802,AFTER811,AFTER812,AFTER8A
"RTN","PXAIPOV",9,0)
 N BEFOR0,BEFOR12,BEFOR800,BEFOR801,BEFOR802,BEFOR811,BEFOR812,FPRI
"RTN","PXAIPOV",10,0)
 N GMPSAVED,IENB,J,LNARR,NOPLLIST,PIECE,POVI,PRI,PRVDR,PXAA,PXAAX,PXAB
"RTN","PXAIPOV",11,0)
 N PXAIVDT,PXBCNT,PXBCNTPL,PXBKY,PXBPMT,PXBSAM,PXBSKY,PXDIGNS,PXKDONE
"RTN","PXAIPOV",12,0)
 N STOP,SUB,VAR
"RTN","PXAIPOV",13,0)
 ;
"RTN","PXAIPOV",14,0)
 K PXAERR
"RTN","PXAIPOV",15,0)
 S PXAERR(8)=PXAK
"RTN","PXAIPOV",16,0)
 S PXAERR(7)="DX/PL"
"RTN","PXAIPOV",17,0)
 ;
"RTN","PXAIPOV",18,0)
 S SUB="" F  S SUB=$O(@PXADATA@("DX/PL",PXAK,SUB)) Q:SUB=""  D
"RTN","PXAIPOV",19,0)
 .S PXAA(SUB)=@PXADATA@("DX/PL",PXAK,SUB)
"RTN","PXAIPOV",20,0)
 ;
"RTN","PXAIPOV",21,0)
 ;--VALIDATE ENOUGH DATA
"RTN","PXAIPOV",22,0)
 D VAL^PXAIPOVV Q:$G(STOP)
"RTN","PXAIPOV",23,0)
 ;
"RTN","PXAIPOV",24,0)
SETVARA ;--SET VISIT VARIABLES
"RTN","PXAIPOV",25,0)
 S $P(AFTER0,"^",1)=$G(PXAA("DIAGNOSIS"))
"RTN","PXAIPOV",26,0)
 I $G(PXAA("DELETE")) S $P(AFTER0,"^",1)="@"
"RTN","PXAIPOV",27,0)
 S $P(AFTER0,"^",2)=$G(PATIENT),PXAA("PATIENT")=$G(PATIENT)
"RTN","PXAIPOV",28,0)
 S $P(AFTER0,"^",3)=$G(PXAVISIT)
"RTN","PXAIPOV",29,0)
 S $P(AFTER0,"^",4)=$G(PXAA("NARRATIVE")) D
"RTN","PXAIPOV",30,0)
 .I $G(PXAA("NARRATIVE"))']""!($L($G(PXAA("NARRATIVE")))>245) D
"RTN","PXAIPOV",31,0)
 .. S PXAIVDT=$S($L($G(PXAVISIT)):$$CSDATE^PXDXUTL(PXAVISIT),1:DT) ; get visit date
"RTN","PXAIPOV",32,0)
 .. S PXAA("NARRATIVE")=$$DXNARR^PXUTL1($G(PXAA("DIAGNOSIS")),PXAIVDT) ; use diagnosis description if no narrative or narrative too long
"RTN","PXAIPOV",33,0)
 .S $P(AFTER0,"^",4)=+$$PROVNARR^PXAPI($G(PXAA("NARRATIVE")),9000010.07)
"RTN","PXAIPOV",34,0)
 ;PX*1*124
"RTN","PXAIPOV",35,0)
 S $P(AFTER0,"^",12)=$S($G(PXAA("PRIMARY"))=1:"P",$G(PXAA("PRIMARY"))="P":"P",1:"S")
"RTN","PXAIPOV",36,0)
 ;--ADDED FOR PATCH 28
"RTN","PXAIPOV",37,0)
 S $P(AFTER0,"^",15)=$G(PXAA("LEXICON TERM"))
"RTN","PXAIPOV",38,0)
 S $P(AFTER0,"^",16)=$G(PXAA("PL IEN"))
"RTN","PXAIPOV",39,0)
 S $P(AFTER0,"^",17)=$G(PXAA("ORD/RES"))
"RTN","PXAIPOV",40,0)
 ;--END OF NEW PATCH 28
"RTN","PXAIPOV",41,0)
 S $P(AFTER12,"^",1)=$G(PXAA("EVENT D/T"))
"RTN","PXAIPOV",42,0)
 S $P(AFTER12,"^",4)=$G(PXAA("ENC PROVIDER"))
"RTN","PXAIPOV",43,0)
 ;PX*1*108
"RTN","PXAIPOV",44,0)
 I $G(PXAA("ENC PROVIDER"))]"",'$G(PXAA("DELETE")) D
"RTN","PXAIPOV",45,0)
 .S ^TMP("PXAIADDPRV",$J,$G(PXAA("ENC PROVIDER")))=""
"RTN","PXAIPOV",46,0)
 ;
"RTN","PXAIPOV",47,0)
 I $G(PXAA("CATEGORY"))]"" S $P(AFTER802,"^",1)=+$$PROVNARR^PXAPI($G(PXAA("CATEGORY")),9000010.07)
"RTN","PXAIPOV",48,0)
 S $P(AFTER811,"^",1)=$G(PXAA("COMMENT"))
"RTN","PXAIPOV",49,0)
 ;
"RTN","PXAIPOV",50,0)
 S $P(AFTER800,"^",1)=$G(PXAA("PL SC"))
"RTN","PXAIPOV",51,0)
 S $P(AFTER800,"^",2)=$G(PXAA("PL AO"))
"RTN","PXAIPOV",52,0)
 S $P(AFTER800,"^",3)=$G(PXAA("PL IR"))
"RTN","PXAIPOV",53,0)
 S $P(AFTER800,"^",4)=$G(PXAA("PL EC"))
"RTN","PXAIPOV",54,0)
 S $P(AFTER800,"^",5)=$G(PXAA("PL MST"))
"RTN","PXAIPOV",55,0)
 S $P(AFTER800,"^",6)=$G(PXAA("PL HNC"))
"RTN","PXAIPOV",56,0)
 S $P(AFTER800,"^",7)=$G(PXAA("PL CV"))
"RTN","PXAIPOV",57,0)
 S $P(AFTER800,"^",8)=$G(PXAA("PL SHAD"))
"RTN","PXAIPOV",58,0)
 ;
"RTN","PXAIPOV",59,0)
 D SCC^PXUTLSCC(PATIENT,$P($G(^AUPNVSIT(PXAVISIT,0)),"^",1),$P($G(^AUPNVSIT(PXAVISIT,0)),"^",22),$G(PXAVISIT),AFTER800,.AFTER800)
"RTN","PXAIPOV",60,0)
 ;
"RTN","PXAIPOV",61,0)
 I $G(PXAA("PL SC"))="" S $P(AFTER800,"^",1)=""
"RTN","PXAIPOV",62,0)
 I $G(PXAA("PL AO"))="" S $P(AFTER800,"^",2)=""
"RTN","PXAIPOV",63,0)
 I $G(PXAA("PL IR"))="" S $P(AFTER800,"^",3)=""
"RTN","PXAIPOV",64,0)
 I $G(PXAA("PL EC"))="" S $P(AFTER800,"^",4)=""
"RTN","PXAIPOV",65,0)
 I $G(PXAA("PL MST"))="" S $P(AFTER800,"^",5)=""
"RTN","PXAIPOV",66,0)
 I $G(PXAA("PL HNC"))="" S $P(AFTER800,"^",6)=""
"RTN","PXAIPOV",67,0)
 I $G(PXAA("PL CV"))="" S $P(AFTER800,"^",7)=""
"RTN","PXAIPOV",68,0)
 I $G(PXAA("PL SHAD"))="" S $P(AFTER800,"^",8)=""
"RTN","PXAIPOV",69,0)
 ;
"RTN","PXAIPOV",70,0)
 S $P(AFTER812,"^",3)=$G(PXASOURC)
"RTN","PXAIPOV",71,0)
 S $P(AFTER812,"^",2)=$G(PXAPKG)
"RTN","PXAIPOV",72,0)
 ;
"RTN","PXAIPOV",73,0)
 D PL^PXAIPL
"RTN","PXAIPOV",74,0)
 ;
"RTN","PXAIPOV",75,0)
 ;
"RTN","PXAIPOV",76,0)
SETPXKA ;--SET PXK ARRAY AFTER
"RTN","PXAIPOV",77,0)
 S ^TMP("PXK",$J,"POV",PXAK,0,"AFTER")=$G(AFTER0)
"RTN","PXAIPOV",78,0)
 S ^TMP("PXK",$J,"POV",PXAK,12,"AFTER")=$G(AFTER12)
"RTN","PXAIPOV",79,0)
 S ^TMP("PXK",$J,"POV",PXAK,800,"AFTER")=$G(AFTER800)
"RTN","PXAIPOV",80,0)
 S ^TMP("PXK",$J,"POV",PXAK,802,"AFTER")=$G(AFTER802)
"RTN","PXAIPOV",81,0)
 S ^TMP("PXK",$J,"POV",PXAK,811,"AFTER")=$G(AFTER811)
"RTN","PXAIPOV",82,0)
 S ^TMP("PXK",$J,"POV",PXAK,812,"AFTER")=$G(AFTER812)
"RTN","PXAIPOV",83,0)
 ;
"RTN","PXAIPOV",84,0)
SETVARB ;--SET VARIABLES BEFORE
"RTN","PXAIPOV",85,0)
 ;
"RTN","PXAIPOV",86,0)
 ;--GET IEN FOR 'PXK NODE'
"RTN","PXAIPOV",87,0)
 D POV^PXBGPOV(PXAVISIT)
"RTN","PXAIPOV",88,0)
 I $D(^TMP("PXBGPOVMATCH",$J,$G(PXAA("DIAGNOSIS")))) D
"RTN","PXAIPOV",89,0)
 .S (^TMP("PXK",$J,"POV",PXAK,"IEN"),IENB)=$O(^TMP("PXBGPOVMATCH",$J,$G(PXAA("DIAGNOSIS")),0))
"RTN","PXAIPOV",90,0)
 K ^TMP("PXBGPOVMATCH",$J)
"RTN","PXAIPOV",91,0)
 ;
"RTN","PXAIPOV",92,0)
BEFOR ;
"RTN","PXAIPOV",93,0)
 I $G(IENB) D
"RTN","PXAIPOV",94,0)
 .F PIECE=0,12,800,802,811 S ^TMP("PXK",$J,"POV",PXAK,PIECE,"BEFORE")=$G(^AUPNVPOV(IENB,PIECE))
"RTN","PXAIPOV",95,0)
 .K ^TMP("PXK",$J,"POV",PXAK,812)
"RTN","PXAIPOV",96,0)
 E  D
"RTN","PXAIPOV",97,0)
 .S (BEFOR0,BEFOR12,BEFOR800,BEFOR802,BEFOR811,BEFOR812)=""
"RTN","PXAIPOV",98,0)
 .;
"RTN","PXAIPOV",99,0)
SETPXKB .;--SET PXK ARRAY BEFORE
"RTN","PXAIPOV",100,0)
 .S ^TMP("PXK",$J,"POV",PXAK,0,"BEFORE")=$G(BEFOR0)
"RTN","PXAIPOV",101,0)
 .S ^TMP("PXK",$J,"POV",PXAK,12,"BEFORE")=$G(BEFOR12)
"RTN","PXAIPOV",102,0)
 .S ^TMP("PXK",$J,"POV",PXAK,800,"BEFORE")=$G(BEFOR800)
"RTN","PXAIPOV",103,0)
 .S ^TMP("PXK",$J,"POV",PXAK,802,"BEFORE")=$G(BEFOR802)
"RTN","PXAIPOV",104,0)
 .S ^TMP("PXK",$J,"POV",PXAK,811,"BEFORE")=$G(BEFOR811)
"RTN","PXAIPOV",105,0)
 .S ^TMP("PXK",$J,"POV",PXAK,812,"BEFORE")=$G(BEFOR812)
"RTN","PXAIPOV",106,0)
 .S ^TMP("PXK",$J,"POV",PXAK,"IEN")=""
"RTN","PXAIPOV",107,0)
 ;
"RTN","PXAIPOV",108,0)
MISC ;--MISCELLANEOUS NODE
"RTN","PXAIPOV",109,0)
 ;
"RTN","PXAIPOV",110,0)
 Q
"RTN","PXAIPOV",111,0)
PRIM ;--SET A PROVIDER AS PRIMARY
"RTN","PXAIPOV",112,0)
 N PXBCNT,PXBKY,PXBSAM,PXBSKY,PRVDR,FPRI ;108
"RTN","PXAIPOV",113,0)
 D PRV^PXBGPRV(PXAVISIT,.PXBSKY,.PXBKY,.PXBSAM,.PXBCNT,.PRVDR,.FPRI) ;108
"RTN","PXAIPOV",114,0)
 I $D(PRVDR) Q
"RTN","PXAIPOV",115,0)
 I '$D(PXBSKY) Q
"RTN","PXAIPOV",116,0)
 ;
"RTN","PXAIPOV",117,0)
 S $P(AFTER0,"^",1)=$P(^AUPNVPRV($O(PXBSKY(1,0)),0),"^",1)
"RTN","PXAIPOV",118,0)
 S $P(AFTER0,"^",2)=$P(^AUPNVSIT(PXAVISIT,0),"^",5)
"RTN","PXAIPOV",119,0)
 S $P(AFTER0,"^",3)=PXAVISIT
"RTN","PXAIPOV",120,0)
 S $P(AFTER0,"^",4)="P"
"RTN","PXAIPOV",121,0)
 S ^TMP("PXK",$J,"PRV",22222,0,"AFTER")=AFTER0
"RTN","PXAIPOV",122,0)
 S ^TMP("PXK",$J,"PRV",22222,0,"BEFORE")=$G(^AUPNVPRV($O(PXBSKY(1,0)),0))
"RTN","PXAIPOV",123,0)
 S ^TMP("PXK",$J,"PRV",22222,"IEN")=$O(PXBSKY(1,0))
"RTN","PXAIPOV",124,0)
 D EN1^PXKMAIN
"RTN","PXAIPOV",125,0)
 K PXRDR
"RTN","PXAIPOV",126,0)
 K ^TMP("PXBGPOVMATCH",$J)
"RTN","PXAIPOV",127,0)
 Q
"RTN","PXAIPOVV")
0^8^B2657796^B2638479
"RTN","PXAIPOVV",1,0)
PXAIPOVV ;ISL/JVS,SCK - VALIDATE DIAGNOSIS ;6/6/96  07:40
"RTN","PXAIPOVV",2,0)
 ;;1.0;PCE PATIENT CARE ENCOUNTER;**121,194,199**;Aug 12, 1996;Build 51
"RTN","PXAIPOVV",3,0)
 ;
"RTN","PXAIPOVV",4,0)
VAL ;--VALIDATE ENOUGH DATA
"RTN","PXAIPOVV",5,0)
 N ICDDATA,PXDXDATE
"RTN","PXAIPOVV",6,0)
 ;----Missing a pointer to DIAGNOSIS (ICD) name
"RTN","PXAIPOVV",7,0)
 I ($G(PXAA("DIAGNOSIS"))']"")!(+$G(PXAA("DIAGNOSIS"))=0) D  Q:$G(STOP)
"RTN","PXAIPOVV",8,0)
 .S STOP=1 ;--USED TO STOP DO LOOP
"RTN","PXAIPOVV",9,0)
 .S PXAERRF=1 ;--FLAG INDICATES THERE IS AN ERROR
"RTN","PXAIPOVV",10,0)
 .S PXADI("DIALOG")=8390001.001
"RTN","PXAIPOVV",11,0)
 .S PXAERR(9)="DIAGNOSIS"
"RTN","PXAIPOVV",12,0)
 .S PXAERR(11)=$G(PXAA("DIAGNOSIS"))
"RTN","PXAIPOVV",13,0)
 .S PXAERR(12)="You are missing a pointer that represents a diagnosis in the DIAGNOSIS file."
"RTN","PXAIPOVV",14,0)
 ;
"RTN","PXAIPOVV",15,0)
 ;----Only necessary to get the ICD data once from the API in the case of this routine
"RTN","PXAIPOVV",16,0)
 S PXDXDATE=$$CSDATE^PXDXUTL(PXAVISIT)
"RTN","PXAIPOVV",17,0)
 S ICDDATA=$$ICDDATA^ICDXCODE("DIAG",$G(PXAA("DIAGNOSIS")),PXDXDATE,"I")
"RTN","PXAIPOVV",18,0)
 ;----NOT a pointer to DIAGNOSIS ICD FILE #80
"RTN","PXAIPOVV",19,0)
 I $P(ICDDATA,U,1)'>0,$G(PXAA("DELETE"))'=1 D  Q:$G(STOP)
"RTN","PXAIPOVV",20,0)
 .S STOP=1
"RTN","PXAIPOVV",21,0)
 .S PXAERRF=1
"RTN","PXAIPOVV",22,0)
 .S PXADI("DIALOG")=8390001.001
"RTN","PXAIPOVV",23,0)
 .S PXAERR(9)="DIAGNOSIS"
"RTN","PXAIPOVV",24,0)
 .S PXAERR(11)=$G(PXAA("DIAGNOSIS"))
"RTN","PXAIPOVV",25,0)
 .S PXAERR(12)=PXAERR(11)_" points to an "_$P(ICDDATA,U,2)_"."
"RTN","PXAIPOVV",26,0)
 ;
"RTN","PXAIPOVV",27,0)
 ;----not an Active ICD code
"RTN","PXAIPOVV",28,0)
 I $P(ICDDATA,U,10)'=1 D  Q:$G(STOP)
"RTN","PXAIPOVV",29,0)
 .S STOP=1
"RTN","PXAIPOVV",30,0)
 .S PXAERRF=1
"RTN","PXAIPOVV",31,0)
 .S PXADI("DIALOG")=8390001.001
"RTN","PXAIPOVV",32,0)
 .S PXAERR(9)="DIAGNOSIS"
"RTN","PXAIPOVV",33,0)
 .S PXAERR(11)=$G(PXAA("DIAGNOSIS"))
"RTN","PXAIPOVV",34,0)
 .S PXAERR(12)=PXAERR(11)_" is NOT an Active ICD code."
"RTN","PXAIPOVV",35,0)
 ;
"RTN","PXAIPOVV",36,0)
 ;
"RTN","PXAIPOVV",37,0)
 Q
"RTN","PXAISKV")
0^9^B3940836^B439136
"RTN","PXAISKV",1,0)
PXAISKV ;ISL/PKR - VALIDATE SKIN TEST DATA ;24 May 2013  7:39 AM
"RTN","PXAISKV",2,0)
 ;;1.0;PCE PATIENT CARE ENCOUNTER;**199**;Aug 12, 1996;Build 51
"RTN","PXAISKV",3,0)
 ;
"RTN","PXAISKV",4,0)
VAL ;Make sure the required field is present.
"RTN","PXAISKV",5,0)
 I '$D(PXAA("TEST")) D  Q:$G(STOP)=1
"RTN","PXAISKV",6,0)
 . S STOP=1
"RTN","PXAISKV",7,0)
 . S PXAERRF=1
"RTN","PXAISKV",8,0)
 . S PXADI("DIALOG")=8390001.001
"RTN","PXAISKV",9,0)
 . S PXAERR(9)="SKIN TEST"
"RTN","PXAISKV",10,0)
 . S PXAERR(10)="AFTER"
"RTN","PXAISKV",11,0)
 . S PXAERR(11)=$G(PXAA("SKIN TEST"))
"RTN","PXAISKV",12,0)
 . S PXAERR(12)="You are missing the name of the skin test"
"RTN","PXAISKV",13,0)
 Q:$G(PXAA("DELETE"))=1  ; don't bother checking diagnoses if this is a deletion
"RTN","PXAISKV",14,0)
 ; confirm valid diagnosis pointers
"RTN","PXAISKV",15,0)
 N DIAGSTR,DIAGNUM,ICDDATA,PXDXDATE
"RTN","PXAISKV",16,0)
 S PXDXDATE=$$CSDATE^PXDXUTL(PXAVISIT)
"RTN","PXAISKV",17,0)
 F DIAGNUM=1:1:8 D  Q:$G(STOP)=1
"RTN","PXAISKV",18,0)
 . S DIAGSTR="DIAGNOSIS"_$S(DIAGNUM>1:" "_DIAGNUM,1:"")
"RTN","PXAISKV",19,0)
 . I $G(PXAA(DIAGSTR))]"" D
"RTN","PXAISKV",20,0)
 .. S ICDDATA=$$ICDDATA^ICDXCODE("DIAG",$G(PXAA(DIAGSTR)),PXDXDATE,"I")
"RTN","PXAISKV",21,0)
 .. I $P(ICDDATA,"^",1)'>0 D  Q:$G(STOP)
"RTN","PXAISKV",22,0)
 ... S STOP=1
"RTN","PXAISKV",23,0)
 ... S PXAERRF=1
"RTN","PXAISKV",24,0)
 ... S PXADI("DIALOG")=8390001.001
"RTN","PXAISKV",25,0)
 ... S PXAERR(9)="SKIN TEST"
"RTN","PXAISKV",26,0)
 ... S PXAERR(10)="AFTER"
"RTN","PXAISKV",27,0)
 ... S PXAERR(11)=$G(PXAA(DIAGSTR))
"RTN","PXAISKV",28,0)
 ... S PXAERR(12)="SKIN TEST DIAGNOSIS #"_DIAGNUM_" ("_PXAERR(11)_") is NOT a valid pointer value to the ICD DIAGNOSIS FILE #80"
"RTN","PXAISKV",29,0)
 .. I $P(ICDDATA,"^",10)'=1 D  Q:$G(STOP)
"RTN","PXAISKV",30,0)
 ... S STOP=1
"RTN","PXAISKV",31,0)
 ... S PXAERRF=1
"RTN","PXAISKV",32,0)
 ... S PXADI("DIALOG")=8390001.001
"RTN","PXAISKV",33,0)
 ... S PXAERR(9)="SKIN TEST"
"RTN","PXAISKV",34,0)
 ... S PXAERR(10)="AFTER"
"RTN","PXAISKV",35,0)
 ... S PXAERR(11)=$G(PXAA(DIAGSTR))
"RTN","PXAISKV",36,0)
 ... S PXAERR(12)="SKIN TEST DIAGNOSIS #"_DIAGNUM_" ("_PXAERR(11)_") is NOT an Active ICD code"
"RTN","PXAISKV",37,0)
 ;
"RTN","PXAISKV",38,0)
 Q
"RTN","PXBAICS")
0^10^B492354^B415459
"RTN","PXBAICS",1,0)
PXBAICS ;ISL/JVS - ISC STATIC LIST OF POSSIBLE AICS LISTS ;5/21/96  11:19
"RTN","PXBAICS",2,0)
 ;;1.0;PCE PATIENT CARE ENCOUNTER;**199**;Aug 12, 1996;Build 51
"RTN","PXBAICS",3,0)
 Q
"RTN","PXBAICS",4,0)
CPT ;;DG SELECT CPT PROCEDURE CODES
"RTN","PXBAICS",5,0)
HF ;;PX SELECT HEALTH FACTORS
"RTN","PXBAICS",6,0)
PED ;;PX SELECT EDUCATION TOPICS
"RTN","PXBAICS",7,0)
ICD ;;DG SELECT ICD-9 DIAGNOSIS CODES
"RTN","PXBAICS",8,0)
D10 ;;DG SELECT ICD-10 DIAGNOSIS CODES
"RTN","PXBAICS",9,0)
PRV ;;SD SELECT PROVIDER
"RTN","PXBAICS",10,0)
SK ;;PX SELECT SKIN TEST
"RTN","PXBAICS",11,0)
TRT ;;PX SELECT TREATMENTS
"RTN","PXBAICS",12,0)
IMM ;;PX SELECT IMMUNIZATIONS
"RTN","PXBAICS",13,0)
XAM ;;PX SELECT EXAMS
"RTN","PXBDCPT")
0^11^B52464094^B45424112
"RTN","PXBDCPT",1,0)
PXBDCPT ;ISL/JVS,ESW - DISPLAY CPT ;24 May 2013  10:44 AM
"RTN","PXBDCPT",2,0)
 ;;1.0;PCE PATIENT CARE ENCOUNTER;**11,73,89,108,121,124,199**;Aug 12, 1996;Build 51
"RTN","PXBDCPT",3,0)
 ;
"RTN","PXBDCPT",4,0)
 ; Reference to LD^ICDEX supported by ICR #5747
"RTN","PXBDCPT",5,0)
 ;
"RTN","PXBDCPT",6,0)
EN0 ;---Main entry point
"RTN","PXBDCPT",7,0)
 ;
"RTN","PXBDCPT",8,0)
 ;
"RTN","PXBDCPT",9,0)
HEAD ;--HEADER ON LIST
"RTN","PXBDCPT",10,0)
 S HEAD="- - E N C O U N T E R  P R O C E D U R E S (CPT CODES) - -"
"RTN","PXBDCPT",11,0)
 W IOINHI,!,IOCUU,?(IOM-$L(HEAD))\2,HEAD,IOINLOW
"RTN","PXBDCPT",12,0)
 W IOELEOL K HEAD
"RTN","PXBDCPT",13,0)
 ;
"RTN","PXBDCPT",14,0)
 I $D(CLINIC) D PRV^PXBUTL2(CLINIC)
"RTN","PXBDCPT",15,0)
 ;
"RTN","PXBDCPT",16,0)
 ;I PXBCNT<11 D DISCPT1^PXBDCPT
"RTN","PXBDCPT",17,0)
 ;I PXBCNT<21&(PXBCNT>10) D DISCPT2^PXBDCPT
"RTN","PXBDCPT",18,0)
 ;I PXBCNT>20&(PXBCNT<31) D DISCPT3^PXBDCPT
"RTN","PXBDCPT",19,0)
 ;I PXBCNT>30&('$D(PXBNCPT))
"RTN","PXBDCPT",20,0)
 D DISCPT4^PXBDCPT("BEGIN")
"RTN","PXBDCPT",21,0)
 ;I PXBCNT>30&($D(PXBNCPT)) D DISCPT4^PXBDCPT("SAME")
"RTN","PXBDCPT",22,0)
 Q
"RTN","PXBDCPT",23,0)
 ;
"RTN","PXBDCPT",24,0)
 ;
"RTN","PXBDCPT",25,0)
 ;
"RTN","PXBDCPT",26,0)
ARRAY ;Set all CPT codes and modifiers into ^TMP("PXBDCPT",$J,"DSP"
"RTN","PXBDCPT",27,0)
 ;for display
"RTN","PXBDCPT",28,0)
 ;
"RTN","PXBDCPT",29,0)
 N PXSQ,ENTRY,PXMD,PXDESC,PX124,PXC,PXD,PXDXDATE
"RTN","PXBDCPT",30,0)
 S PXTMP="^TMP(""PXBDCPT"""_","_$J_","_"""DSP"")"
"RTN","PXBDCPT",31,0)
 K @PXTMP
"RTN","PXBDCPT",32,0)
 S (PXTLNS,PXSQ)=0
"RTN","PXBDCPT",33,0)
 F  S PXSQ=$O(PXBSAM(PXSQ)) Q:'PXSQ  D
"RTN","PXBDCPT",34,0)
 .S PXTLNS=PXTLNS+1
"RTN","PXBDCPT",35,0)
 .S ENTRY=PXBSAM(PXSQ)
"RTN","PXBDCPT",36,0)
 .S PXBSAM(PXSQ,"LINE")=PXTLNS
"RTN","PXBDCPT",37,0)
 .I $D(PXBNCPT($P(ENTRY,U))) D
"RTN","PXBDCPT",38,0)
 ..;I PXBNCPT($P(ENTRY,U))]"",'$D(PXBSKY(PXSQ,PXBNCPT($P(ENTRY,U)))) Q
"RTN","PXBDCPT",39,0)
 ..Q:'$D(PXBNCPT($P(ENTRY,U),$O(PXBSKY(PXSQ,0))))
"RTN","PXBDCPT",40,0)
 ..S $P(ENTRY,U)=$P(ENTRY,U)_"*"
"RTN","PXBDCPT",41,0)
 .S @PXTMP@(PXTLNS,0)=PXSQ_U_$P(ENTRY,U)_U_$P(ENTRY,U,2)_U_$P(ENTRY,U,4)_U_$E($P(ENTRY,U,3),1,24)
"RTN","PXBDCPT",42,0)
 .S PXMD=""
"RTN","PXBDCPT",43,0)
 .F  S PXMD=$O(PXBSAM(PXSQ,"MOD",PXMD)) Q:'PXMD  D
"RTN","PXBDCPT",44,0)
 ..S PXTLNS=PXTLNS+1
"RTN","PXBDCPT",45,0)
 ..S PXMOD=PXBSAM(PXSQ,"MOD",PXMD)
"RTN","PXBDCPT",46,0)
 ..S PXDESC=$P($$MODP^ICPTMOD($E(ENTRY,1,5),PXMOD,"E",IDATE),U,2) ;PX*108
"RTN","PXBDCPT",47,0)
 ..S @PXTMP@(PXTLNS,0)=0_U_PXMOD_U_$E(PXDESC,1,54)
"RTN","PXBDCPT",48,0)
 .S PXTLNS=PXTLNS+1
"RTN","PXBDCPT",49,0)
 .S @PXTMP@(PXTLNS,0)="-22^"_$P(ENTRY,U,22)
"RTN","PXBDCPT",50,0)
 .S PXDXDATE=$$CSDATE^PXDXUTL(PXBVST)
"RTN","PXBDCPT",51,0)
 .F PX124=5:1:12 D
"RTN","PXBDCPT",52,0)
 ..S PXC=$P(ENTRY,U,PX124) Q:PXC=""
"RTN","PXBDCPT",53,0)
 ..S PXD=$$ICDDATA^ICDXCODE("DIAG",PXC,PXDXDATE,"E") Q:PXD<1
"RTN","PXBDCPT",54,0)
 ..I $P(PXD,U,20)'=30 D
"RTN","PXBDCPT",55,0)
 ...S PXC=PXC_"    "_$P(PXD,U,4)
"RTN","PXBDCPT",56,0)
 ...S PXTLNS=PXTLNS+1,@PXTMP@(PXTLNS,0)=-PX124_U_PXC
"RTN","PXBDCPT",57,0)
 ..I $P(PXD,U,20)=30 D
"RTN","PXBDCPT",58,0)
 ...N PXENTRY S PXENTRY(1)=$$SENTENCE^XLFSTR($$LD^ICDEX(80,$P(PXD,U,1),PXDXDATE))
"RTN","PXBDCPT",59,0)
 ...D PR^PXSELDS(.PXENTRY,50)
"RTN","PXBDCPT",60,0)
 ...N PXLENGTH,PXLONG,PXSPACES S PXSPACES="     ",PXLENGTH=$L(PXC)-5
"RTN","PXBDCPT",61,0)
 ...I PXLENGTH>0 S PXSPACES=$E(PXSPACES,1,5-PXLENGTH)
"RTN","PXBDCPT",62,0)
 ...S PXLONG=PXC_PXSPACES_PXENTRY(1)
"RTN","PXBDCPT",63,0)
 ...S PXTLNS=PXTLNS+1,@PXTMP@(PXTLNS,0)=-PX124_U_PXLONG
"RTN","PXBDCPT",64,0)
 ...N PXNUMBR F PXNUMBR=2:1:PXENTRY D
"RTN","PXBDCPT",65,0)
 ....S PXTLNS=PXTLNS+1,@PXTMP@(PXTLNS,0)=-PX124_U_PXENTRY(PXNUMBR)_U_"NEXTLONG"
"RTN","PXBDCPT",66,0)
 ..I $G(PXBREQ(+PXD,"I"))="" S PXBREQ(+PXD,"I")=$P($$XLATE^PXBGPOV(PXBVST,+PXD),U,4,20)
"RTN","PXBDCPT",67,0)
 ..S PXTLNS=PXTLNS+1,@PXTMP@(PXTLNS,0)="I^"_PXBREQ(+PXD,"I")
"RTN","PXBDCPT",68,0)
 Q
"RTN","PXBDCPT",69,0)
DISCPT1 ;--Display the CPT Data
"RTN","PXBDCPT",70,0)
 ;
"RTN","PXBDCPT",71,0)
 N ENTRY,J
"RTN","PXBDCPT",72,0)
 D UNDON^PXBCC
"RTN","PXBDCPT",73,0)
 W !,"No.",?4,"CPT CODE",?14,"QUANTITY",?25,"DESCRIPTION",?55,"PROVIDER",?75,$C(32)
"RTN","PXBDCPT",74,0)
 W IOEDEOP
"RTN","PXBDCPT",75,0)
 D UNDOFF^PXBCC
"RTN","PXBDCPT",76,0)
 ;
"RTN","PXBDCPT",77,0)
 ;
"RTN","PXBDCPT",78,0)
 S J=0
"RTN","PXBDCPT",79,0)
 F  S J=$O(PXBSAM(J)) Q:J=""  D
"RTN","PXBDCPT",80,0)
 .S ENTRY=$G(PXBSAM(J))
"RTN","PXBDCPT",81,0)
 .I $D(PXBNCPT($P(ENTRY,U,1))) S $P(ENTRY,U,1)=$P(ENTRY,U,1)_"*"
"RTN","PXBDCPT",82,0)
 .W !,J,?4,$P(ENTRY,U,1),?15,$P(ENTRY,U,2)
"RTN","PXBDCPT",83,0)
 .W ?25,$P(ENTRY,U,4),?55,$E($P(ENTRY,U,3),1,24)
"RTN","PXBDCPT",84,0)
 .;---Display associated modifiers
"RTN","PXBDCPT",85,0)
 .S PXSIEN=""
"RTN","PXBDCPT",86,0)
 .F  S PXSIEN=$O(PXBSAM(J,"MOD",PXSIEN)) Q:PXSIEN=""  D
"RTN","PXBDCPT",87,0)
 ..N PXWRAP,PXMOD,PXDESC,PXLN
"RTN","PXBDCPT",88,0)
 ..S PXMOD=PXBSAM(J,"MOD",PXSIEN)
"RTN","PXBDCPT",89,0)
 ..S PXDESC=$P($$MOD^ICPTMOD(PXMOD,"E",IDATE),U,3)
"RTN","PXBDCPT",90,0)
 ..D WRAP^PXCEVFI4(PXDESC,58,.PXWRAP)
"RTN","PXBDCPT",91,0)
 ..F PXLN=1:1 Q:$G(PXWRAP(PXLN))=""  D
"RTN","PXBDCPT",92,0)
 ...W:PXLN=1 !,?4,"CPT Modifier: "_PXMOD
"RTN","PXBDCPT",93,0)
 ...W:PXLN>1 !
"RTN","PXBDCPT",94,0)
 ...W ?22,PXWRAP(PXLN)
"RTN","PXBDCPT",95,0)
 ;---Write no entries if none exist
"RTN","PXBDCPT",96,0)
 I '$D(PXBSAM) D NONE^PXBUTL(2)
"RTN","PXBDCPT",97,0)
 Q
"RTN","PXBDCPT",98,0)
 ;
"RTN","PXBDCPT",99,0)
DISCPT2 ;--display of cpt data two columns if more than 10 entries.
"RTN","PXBDCPT",100,0)
 ;
"RTN","PXBDCPT",101,0)
 N ENTRY,J,PXA
"RTN","PXBDCPT",102,0)
 D GSET^%ZISS
"RTN","PXBDCPT",103,0)
 D UNDON^PXBCC W IOG1
"RTN","PXBDCPT",104,0)
 W !,"NO",?4,"CPT",?10,"QUA",?14,"DESCRIPTION",?39,IOVL
"RTN","PXBDCPT",105,0)
 W ?40,"NO",?44,"CPT",?50,"QUA",?54,"NARRATIVE"
"RTN","PXBDCPT",106,0)
 W IOEDEOP
"RTN","PXBDCPT",107,0)
 D UNDOFF^PXBCC
"RTN","PXBDCPT",108,0)
 ;
"RTN","PXBDCPT",109,0)
 ;
"RTN","PXBDCPT",110,0)
 ;
"RTN","PXBDCPT",111,0)
 S J=0 F  S J=$O(PXBSAM(J)) Q:J=""  D
"RTN","PXBDCPT",112,0)
 .S ENTRY(J)=$G(PXBSAM(J)) I $D(PXBNCPT($P(ENTRY(J),U,1))) S $P(ENTRY(J),U,1)=$P(ENTRY(J),U,1)_"*"
"RTN","PXBDCPT",113,0)
 F J=1:1:10 D
"RTN","PXBDCPT",114,0)
 .W !,J,?4,$P(ENTRY(J),U,1),?11,$P(ENTRY(J),U,2),?14,$E($P(ENTRY(J),U,4),1,24)
"RTN","PXBDCPT",115,0)
 .D BAWRITE(ENTRY(J))
"RTN","PXBDCPT",116,0)
 .I $D(ENTRY(J+10)) D
"RTN","PXBDCPT",117,0)
 ..W ?39,IOVL,(J+10),?44,$P(ENTRY(J+10),U,1),?51,$P(ENTRY(J+10),U,2),?54,$E($P(ENTRY(J+10),U,4),1,24)
"RTN","PXBDCPT",118,0)
 ..D BAWRITE(ENTRY(J))
"RTN","PXBDCPT",119,0)
 W IOG0
"RTN","PXBDCPT",120,0)
 Q
"RTN","PXBDCPT",121,0)
 ;
"RTN","PXBDCPT",122,0)
DISCPT3 ;--display of cpt data three columns if more than 20 entries.
"RTN","PXBDCPT",123,0)
 N ENTRY,J,PXA
"RTN","PXBDCPT",124,0)
 D GSET^%ZISS
"RTN","PXBDCPT",125,0)
 D UNDON^PXBCC W IOG1
"RTN","PXBDCPT",126,0)
 W !,"NO",?4,"CPT",?10,"QUA",?14,"NARRATIVE",?25,IOVL
"RTN","PXBDCPT",127,0)
 W ?26,"NO",?30,"CPT",?36,"QUA",?40,"NARRATIVE",?51,IOVL
"RTN","PXBDCPT",128,0)
 W ?52,"NO",?56,"CPT",?62,"QUA",?66,"NARRATIVE"
"RTN","PXBDCPT",129,0)
 W IOEDEOP
"RTN","PXBDCPT",130,0)
 D UNDOFF^PXBCC
"RTN","PXBDCPT",131,0)
 ;
"RTN","PXBDCPT",132,0)
 S J=0 F  S J=$O(PXBSAM(J)) Q:J=""  D
"RTN","PXBDCPT",133,0)
 .S ENTRY(J)=$G(PXBSAM(J)) I $D(PXBNCPT($P(ENTRY(J),U,1))) S $P(ENTRY(J),U,1)=$P(ENTRY(J),U,1)_"*"
"RTN","PXBDCPT",134,0)
 F J=1:1:10 D
"RTN","PXBDCPT",135,0)
 .W !,J,?4,$P(ENTRY(J),U,1),?11,$P(ENTRY(J),U,2),?14,$E($P(ENTRY(J),U,4),1,10)
"RTN","PXBDCPT",136,0)
 .D BAWRITE(ENTRY(J))
"RTN","PXBDCPT",137,0)
 .I $D(ENTRY(J+10)) D
"RTN","PXBDCPT",138,0)
 ..W ?25,IOVL,(J+10),?30,$P(ENTRY(J+10),U,1),?37,$P(ENTRY(J+10),U,2),?40,$E($P(ENTRY(J+10),U,4),1,10)
"RTN","PXBDCPT",139,0)
 ..D BAWRITE(ENTRY(J+10))
"RTN","PXBDCPT",140,0)
 .I $D(ENTRY(J+20)) D
"RTN","PXBDCPT",141,0)
 ..W ?51,IOVL,(J+20),?56,$P(ENTRY(J+20),U,1),?63,$P(ENTRY(J+20),U,2),?66,$E($P(ENTRY(J+20),U,4),1,10)
"RTN","PXBDCPT",142,0)
 ..D BAWRITE(ENTRY(J+20))
"RTN","PXBDCPT",143,0)
 W IOG0
"RTN","PXBDCPT",144,0)
 Q
"RTN","PXBDCPT",145,0)
 ;
"RTN","PXBDCPT",146,0)
DISCPT4(SIGN) ;--Display the CPT Data
"RTN","PXBDCPT",147,0)
 ;
"RTN","PXBDCPT",148,0)
 ;SIGN=
"RTN","PXBDCPT",149,0)
 ; '+' add 10 to the starting point in ^TMP("PXBDCPT",$J)
"RTN","PXBDCPT",150,0)
 ; '-' subtract 10 from the starting point but not less than 0
"RTN","PXBDCPT",151,0)
 ; 'BEGIN' start at the beginning
"RTN","PXBDCPT",152,0)
 ; 'SAME' start stays where it's at
"RTN","PXBDCPT",153,0)
 ; '3'--any number set start to that number
"RTN","PXBDCPT",154,0)
 ;
"RTN","PXBDCPT",155,0)
 N PXBSTART,PXTMP
"RTN","PXBDCPT",156,0)
 D ARRAY
"RTN","PXBDCPT",157,0)
 I SIGN="BEGIN" S ^TMP("PXBDCPT",$J,"START")=0,PXBSTART=0
"RTN","PXBDCPT",158,0)
 I SIGN="SAME" S PXBSTART=^TMP("PXBDCPT",$J,"START")
"RTN","PXBDCPT",159,0)
 I SIGN="+" D
"RTN","PXBDCPT",160,0)
 .S PXBSTART=($G(^TMP("PXBDCPT",$J,"START"))+10)
"RTN","PXBDCPT",161,0)
 .I PXBSTART'<PXTLNS S PXBSTART=PXBSTART-10
"RTN","PXBDCPT",162,0)
 .S ^TMP("PXBDCPT",$J,"START")=PXBSTART
"RTN","PXBDCPT",163,0)
 I SIGN="-" D
"RTN","PXBDCPT",164,0)
 .S PXBSTART=$G(^TMP("PXBDCPT",$J,"START"))-10
"RTN","PXBDCPT",165,0)
 .S ^TMP("PXBDCPT",$J,"START")=PXBSTART
"RTN","PXBDCPT",166,0)
 .I PXBSTART<0 S PXBSTART=0 S ^TMP("PXBDCPT",$J,"START")=0
"RTN","PXBDCPT",167,0)
 I +SIGN>0&(SIGN#10) D  Q:^TMP("PXBDCPT",$J,"START")=PXBSTART  S ^TMP("PXBDCPT",$J,"START")=PXBSTART
"RTN","PXBDCPT",168,0)
 .S PXBSTART=$P((SIGN/10),".")*10
"RTN","PXBDCPT",169,0)
 .S:PXBSTART<10 PXBSTART=0
"RTN","PXBDCPT",170,0)
 I +SIGN>0&'(SIGN#10) D  Q:^TMP("PXBDCPT",$J,"START")=PXBSTART  S ^TMP("PXBDCPT",$J,"START")=PXBSTART
"RTN","PXBDCPT",171,0)
 .S PXBSTART=(($P((SIGN/10),".")*10)-10)
"RTN","PXBDCPT",172,0)
 .S:PXBSTART<10 PXBSTART=0
"RTN","PXBDCPT",173,0)
 ;
"RTN","PXBDCPT",174,0)
 ;
"RTN","PXBDCPT",175,0)
 I SIGN'="BEGIN" D LOC^PXBCC(3,0) W IOEDEOP
"RTN","PXBDCPT",176,0)
 ;
"RTN","PXBDCPT",177,0)
HEAD4 ;--HEADER ON LIST
"RTN","PXBDCPT",178,0)
 S HEAD="- - E N C O U N T E R  P R O C E D U R E S (CPT CODES) - -"
"RTN","PXBDCPT",179,0)
 W IOINHI,!,IOCUU,?(IOM-$L(HEAD))\2,HEAD,IOINLOW
"RTN","PXBDCPT",180,0)
 W IOELEOL K HEAD
"RTN","PXBDCPT",181,0)
 ;
"RTN","PXBDCPT",182,0)
 ;
"RTN","PXBDCPT",183,0)
 N ENTRY,J
"RTN","PXBDCPT",184,0)
 D UNDON^PXBCC
"RTN","PXBDCPT",185,0)
 W !,"No.",?4,"CPT CODE",?14,"QUANTITY",?25,"DESCRIPTION",?55,"PROVIDER",?75,$C(32)
"RTN","PXBDCPT",186,0)
 W IOEDEOP
"RTN","PXBDCPT",187,0)
 D UNDOFF^PXBCC
"RTN","PXBDCPT",188,0)
 ;
"RTN","PXBDCPT",189,0)
 ;
"RTN","PXBDCPT",190,0)
 N PXSIEN,PXDESC,PXMOD,PXQ,PXLNS,PX,PL
"RTN","PXBDCPT",191,0)
 S J=PXBSTART,PXQ=""
"RTN","PXBDCPT",192,0)
 S PXLNS=0
"RTN","PXBDCPT",193,0)
 F  S J=$O(@PXTMP@(J)) Q:J=""  D  Q:PXQ
"RTN","PXBDCPT",194,0)
 .S PXLNS=PXLNS+1
"RTN","PXBDCPT",195,0)
 .I '(PXLNS#11) D  Q
"RTN","PXBDCPT",196,0)
 ..S ^TMP("PXBDCPT",$J,"START")=PXBSTART
"RTN","PXBDCPT",197,0)
 ..S PXQ=1
"RTN","PXBDCPT",198,0)
 .I +@PXTMP@(J,0)>0 D  Q
"RTN","PXBDCPT",199,0)
 ..W !,$P(^(0),U),?4,$P(^(0),U,2),?15,$P(^(0),U,3)
"RTN","PXBDCPT",200,0)
 ..W ?25,$P(^(0),U,4),?55,$P(^(0),U,5)
"RTN","PXBDCPT",201,0)
 .I +@PXTMP@(J,0)<0 D  Q
"RTN","PXBDCPT",202,0)
 ..S PX=-$P(^(0),U,1)
"RTN","PXBDCPT",203,0)
 ..I PX=22 W !?4,"Ordering Provider:  ",$P(^(0),U,2) Q
"RTN","PXBDCPT",204,0)
 ..I PX<20,$P(^(0),U,3)'="NEXTLONG" W !?4,"Diagnosis "_(PX-4)_":  ",$P(^(0),U,2) Q
"RTN","PXBDCPT",205,0)
 ..I PX<20,$P(^(0),U,3)="NEXTLONG" W !?28,$P(^(0),U,2)
"RTN","PXBDCPT",206,0)
 .I $P(@PXTMP@(J,0),U)="I" D CIA^PXBDPOV($P(^(0),U,2,16)) Q
"RTN","PXBDCPT",207,0)
 .I $P(@PXTMP@(J,0),U)=0 D
"RTN","PXBDCPT",208,0)
 ..W !?4,"CPT Modifier: "_$P(^(0),U,2)_"  "_$P(^(0),U,3)
"RTN","PXBDCPT",209,0)
 I SIGN'="BEGIN" W !!
"RTN","PXBDCPT",210,0)
 Q
"RTN","PXBDCPT",211,0)
 ;
"RTN","PXBDCPT",212,0)
BAWRITE(PXD) ;WRITE BA INFO
"RTN","PXBDCPT",213,0)
 N PX,PD,PP
"RTN","PXBDCPT",214,0)
 W !?4,"Ordering Provider:  ",$P(PXD,U,22)
"RTN","PXBDCPT",215,0)
 F PX=1:1:8 D
"RTN","PXBDCPT",216,0)
 .S PD=$P(PXD,U,PX+5),PP=$$XLATE^PXBGPOV(PXBVST,PD)
"RTN","PXBDCPT",217,0)
 .Q:'PD!'PP
"RTN","PXBDCPT",218,0)
 .W:PD !?4,"Diagnosis:  ",PD
"RTN","PXBDCPT",219,0)
 .D CIA^PXBDPOV($P(PP,U,4,16))
"RTN","PXBDCPT",220,0)
 Q
"RTN","PXBDCPT",221,0)
 ;
"RTN","PXBDPOV")
0^49^B32766424^B26935577
"RTN","PXBDPOV",1,0)
PXBDPOV ;ISL/JVS - DISPLAY POV (DIAGNOSIS) ;24 May 2013  7:02 AM
"RTN","PXBDPOV",2,0)
 ;;1.0;PCE PATIENT CARE ENCOUNTER;**124,168,199**;Aug 12, 1996;Build 51
"RTN","PXBDPOV",3,0)
 ;
"RTN","PXBDPOV",4,0)
 ;
"RTN","PXBDPOV",5,0)
EN0 ;---Main entry point
"RTN","PXBDPOV",6,0)
 I '$D(IOCUU) D TERM^PXBCC
"RTN","PXBDPOV",7,0)
 ;
"RTN","PXBDPOV",8,0)
HEAD ;--HEADER ON LIST
"RTN","PXBDPOV",9,0)
 S HEAD="- - E N C O U N T E R  D I A G N O S I S  (ICD CODES) - -"
"RTN","PXBDPOV",10,0)
 W !,IOCUU,?(IOM-$L(HEAD))\2,IOINHI,HEAD
"RTN","PXBDPOV",11,0)
 W IOINLOW,IOELEOL K HEAD
"RTN","PXBDPOV",12,0)
 ;
"RTN","PXBDPOV",13,0)
 I $D(CLINIC) D POV^PXBUTL2(CLINIC)
"RTN","PXBDPOV",14,0)
 ;I PXBCNT<11 D DPOV1
"RTN","PXBDPOV",15,0)
 ;I PXBCNT>10&($D(PXBNPOV)) D DPOV4("SAME")
"RTN","PXBDPOV",16,0)
 ;I PXBCNT>10&('$D(PXBNPOV)) D DPOV4("BEGIN")
"RTN","PXBDPOV",17,0)
 D DPOV4($S($D(PXBNPOV):"SAME",1:"BEGIN"))
"RTN","PXBDPOV",18,0)
 Q
"RTN","PXBDPOV",19,0)
 ;
"RTN","PXBDPOV",20,0)
 ;
"RTN","PXBDPOV",21,0)
DPOV1 ;--Display the POV Data
"RTN","PXBDPOV",22,0)
 N ENTRY,K
"RTN","PXBDPOV",23,0)
 D UNDON^PXBCC
"RTN","PXBDPOV",24,0)
 W !,"No.",?5,"ICD",?14,"DESCRIPTION",?65,"PROBLEM LIST"
"RTN","PXBDPOV",25,0)
 W IOEDEOP
"RTN","PXBDPOV",26,0)
 D UNDOFF^PXBCC
"RTN","PXBDPOV",27,0)
 ;
"RTN","PXBDPOV",28,0)
 ;
"RTN","PXBDPOV",29,0)
 S (K,J)=0 F  S J=$O(PXBSAM(J)) Q:J=""  D
"RTN","PXBDPOV",30,0)
 .S ENTRY=$G(PXBSAM(J)) I $D(PXBNPOV($P(ENTRY,"^",1))) S $P(ENTRY,"^",1)=$P(ENTRY,"^",1)_"*"
"RTN","PXBDPOV",31,0)
 .I $P(ENTRY,U)=0 D CIA($P(ENTRY,U,2,16)) Q
"RTN","PXBDPOV",32,0)
 .S K=K+1
"RTN","PXBDPOV",33,0)
 .W !,K,?4,$J($P($P(ENTRY,"^",1),".",1),4),".",$P($P(ENTRY,"^",1),".",2),?14,$E($P(ENTRY,"^",3),1,30),?45
"RTN","PXBDPOV",34,0)
 .W:$P(ENTRY,"^",4)["PRI" $P(ENTRY,"^",4)
"RTN","PXBDPOV",35,0)
 .I $P(ENTRY,"^",4)["PRI" W ?71,$P(ENTRY,"^",5)
"RTN","PXBDPOV",36,0)
 .E  W ?75,$P(ENTRY,"^",5)
"RTN","PXBDPOV",37,0)
 .D DIS
"RTN","PXBDPOV",38,0)
 ;---Write no entries if none exist
"RTN","PXBDPOV",39,0)
 I '$D(PXBSAM) D NONE^PXBUTL(3)
"RTN","PXBDPOV",40,0)
 ;-------------UNCOMMENT TO LIST CLINIC POV TO SCREEN-----
"RTN","PXBDPOV",41,0)
 ;D DEF^PXBDPOV("A")
"RTN","PXBDPOV",42,0)
 ;----------------------------------------------------
"RTN","PXBDPOV",43,0)
 D DEF^PXBDPOV("D") I '$D(FIRST) K PXBDPOV
"RTN","PXBDPOV",44,0)
 Q
"RTN","PXBDPOV",45,0)
 ;
"RTN","PXBDPOV",46,0)
 ;
"RTN","PXBDPOV",47,0)
 ;
"RTN","PXBDPOV",48,0)
DPOV4(SIGN) ;--Display the PROVIDER Data
"RTN","PXBDPOV",49,0)
 ;
"RTN","PXBDPOV",50,0)
 ;SIGN=
"RTN","PXBDPOV",51,0)
 ; '+' add 10 to the starting point in ^TMP("PXBDPOV",$J)
"RTN","PXBDPOV",52,0)
 ; '-' subtract 10 from the starting point but not less than 0
"RTN","PXBDPOV",53,0)
 ; 'BEGIN' start at the beginning
"RTN","PXBDPOV",54,0)
 ; 'SAME' start stays where it's at
"RTN","PXBDPOV",55,0)
 ; '3'--any number set start to that number
"RTN","PXBDPOV",56,0)
 ;
"RTN","PXBDPOV",57,0)
 N PXBSTART,PXTMP
"RTN","PXBDPOV",58,0)
 I SIGN="BEGIN" S ^TMP("PXBDPOV",$J,"START")=0,PXBSTART=0
"RTN","PXBDPOV",59,0)
 I SIGN="SAME" S PXBSTART=^TMP("PXBDPOV",$J,"START")
"RTN","PXBDPOV",60,0)
 I SIGN="+" S PXBSTART=($G(^TMP("PXBDPOV",$J,"START"))+(10)) S:PXBSTART'<PXBCNT PXBSTART=(PXBCNT-(10)) S ^TMP("PXBDPOV",$J,"START")=PXBSTART
"RTN","PXBDPOV",61,0)
 I SIGN="-" S PXBSTART=$G(^TMP("PXBDPOV",$J,"START"))-10,^TMP("PXBDPOV",$J,"START")=PXBSTART I PXBSTART<0 S PXBSTART=0 S ^TMP("PXBDPOV",$J,"START")=0
"RTN","PXBDPOV",62,0)
 I +SIGN>0&(SIGN#10) S PXBSTART=$P((SIGN/10),".")*10 S:PXBSTART<10 PXBSTART=0  Q:^TMP("PXBDPOV",$J,"START")=PXBSTART  S ^TMP("PXBDPOV",$J,"START")=PXBSTART
"RTN","PXBDPOV",63,0)
 I +SIGN>0&'(SIGN#10) S PXBSTART=(($P((SIGN/10),".")*10)-10) S:PXBSTART<10 PXBSTART=0 Q:^TMP("PXBDPOV",$J,"START")=PXBSTART  S ^TMP("PXBDPOV",$J,"START")=PXBSTART
"RTN","PXBDPOV",64,0)
 ;
"RTN","PXBDPOV",65,0)
 ;
"RTN","PXBDPOV",66,0)
 I SIGN'="BEGIN" D LOC^PXBCC(3,0) W IOEDEOP
"RTN","PXBDPOV",67,0)
 ;
"RTN","PXBDPOV",68,0)
HEAD4 ;--HEADER ON LIST
"RTN","PXBDPOV",69,0)
 S HEAD="- - E N C O U N T E R  D I A G N O S I S  (ICD CODES) - -"
"RTN","PXBDPOV",70,0)
 W !,IOCUU,?(IOM-$L(HEAD))\2,IOINHI,HEAD ;----F  W $C(32) Q:$X=(IOM-(1))
"RTN","PXBDPOV",71,0)
 W IOINLOW,IOELEOL K HEAD
"RTN","PXBDPOV",72,0)
 ;
"RTN","PXBDPOV",73,0)
 N ENTRY,J,K
"RTN","PXBDPOV",74,0)
 D UNDON^PXBCC
"RTN","PXBDPOV",75,0)
 W !,"No.",?5,"ICD",?14,"DESCRIPTION",?64,"PROBLEM LIST"
"RTN","PXBDPOV",76,0)
 W IOEDEOP
"RTN","PXBDPOV",77,0)
 D UNDOFF^PXBCC
"RTN","PXBDPOV",78,0)
 D ARRAY
"RTN","PXBDPOV",79,0)
 ;
"RTN","PXBDPOV",80,0)
 S J=PXBSTART,K=J
"RTN","PXBDPOV",81,0)
 F  S J=$O(@PXTMP@(J)) Q:J=""  Q:K=(PXBSTART+11)  D
"RTN","PXBDPOV",82,0)
 .S ENTRY=$G(@PXTMP@(J,0)),K=K+1
"RTN","PXBDPOV",83,0)
 .I $P(ENTRY,U)=0 D CIA($P(ENTRY,U,2,16)) Q
"RTN","PXBDPOV",84,0)
 .N PXNUMBR S PXNUMBR=$P(ENTRY,U)
"RTN","PXBDPOV",85,0)
 .S ENTRY=$P(ENTRY,U,2,15)
"RTN","PXBDPOV",86,0)
 .I $P(ENTRY,"^",1)'="",$D(PXBNCPT($P(ENTRY,"^",1))) S $P(ENTRY,"^",1)=$P(ENTRY,"^",1)_"*"
"RTN","PXBDPOV",87,0)
 .W !,PXNUMBR,?4,$J($P($P(ENTRY,"^",1),".",1),4),$S($P(ENTRY,"^",1)'="":".",1:""),$P($P(ENTRY,"^",1),".",2),?14,$E($P(ENTRY,"^",3),1,30),?45
"RTN","PXBDPOV",88,0)
 .W:$P(ENTRY,"^",4)["PRI" IOINHI,$P(ENTRY,"^",4),IOINLOW
"RTN","PXBDPOV",89,0)
 .W ?$P(ENTRY,"^",4)["PRI"*7+53,$P(ENTRY,"^",7)
"RTN","PXBDPOV",90,0)
 .I $P(ENTRY,"^",4)["PRI" W ?71,$P(ENTRY,"^",5)
"RTN","PXBDPOV",91,0)
 .D DIS
"RTN","PXBDPOV",92,0)
 I SIGN'="BEGIN" W !!
"RTN","PXBDPOV",93,0)
 ;------------UNCOMMENT TO LIST PROVIDERS TO SCREEN--------
"RTN","PXBDPOV",94,0)
 ;D DEF^PXBDPOV("A")
"RTN","PXBDPOV",95,0)
 ;---------------------------------------------------------
"RTN","PXBDPOV",96,0)
 D DEF^PXBDPOV("D") I '$D(FIRST) K PXBDPOV
"RTN","PXBDPOV",97,0)
 Q
"RTN","PXBDPOV",98,0)
 ;
"RTN","PXBDPOV",99,0)
 ;
"RTN","PXBDPOV",100,0)
DEF(CODE) ;---PROCESS DEFAULT LIST OF DIAGNOSES
"RTN","PXBDPOV",101,0)
 ; I CODE="D" JUST SEND DEFAULT
"RTN","PXBDPOV",102,0)
 ; I CODE="A" JUST SEND THE ARRAY OF PROVIDERS
"RTN","PXBDPOV",103,0)
 D POV^PXBUTL2(CLINIC,3)
"RTN","PXBDPOV",104,0)
 N POV,X,CLNAME,STOP,LIST,NAME,NUMBER
"RTN","PXBDPOV",105,0)
 I '$D(IORC) D TERM^PXBCC
"RTN","PXBDPOV",106,0)
 I '$D(CODE) W !,"SEND PARAMETER = TO 'D'efault OR 'A'rray" Q
"RTN","PXBDPOV",107,0)
 I $G(CODE)="D",$D(PXBPMT("DEF")) S NAME=$O(PXBPMT("DEF",0)) S PXBDPOV=NAME
"RTN","PXBDPOV",108,0)
 I $G(CODE)="A" K PXBPMT("DEF") D
"RTN","PXBDPOV",109,0)
 .S (POV,STOP)="" F  S POV=$O(PXBPMT("POV",POV)) Q:POV=""  Q:STOP=0  D
"RTN","PXBDPOV",110,0)
 ..I '$D(PXBKY(POV)) S STOP=0
"RTN","PXBDPOV",111,0)
 .I STOP="" Q
"RTN","PXBDPOV",112,0)
 .S CLNAME=$P(^SC(CLINIC,0),"^",1)
"RTN","PXBDPOV",113,0)
 .S X="Other ICD CODES associated with "_CLNAME_" clinic."
"RTN","PXBDPOV",114,0)
 .W:PXBCNT<7 ! W !,?(IOM-$L(X))/2,IOINHI,X,IOINLOW K X
"RTN","PXBDPOV",115,0)
 .S (POV,LIST)="" F  S POV=$O(PXBPMT("POV",POV)) Q:POV=""  D
"RTN","PXBDPOV",116,0)
 ..I $D(PXBKY(+POV)) Q
"RTN","PXBDPOV",117,0)
 ..S LIST=LIST_POV_"  " I $L(LIST,"  ")>2 W !,?(IOM-$L(LIST))/2,LIST S LIST=""
"RTN","PXBDPOV",118,0)
 I $G(LIST)]"" W !,?(IOM-$L(LIST))/2,LIST
"RTN","PXBDPOV",119,0)
 Q
"RTN","PXBDPOV",120,0)
 ;
"RTN","PXBDPOV",121,0)
DIS ;----DISPLAY
"RTN","PXBDPOV",122,0)
 Q
"RTN","PXBDPOV",123,0)
 I $D(PXBPMT("POV",$P($P(ENTRY,"^",1),"*"))) W:PXBCNT>11 IORVON W ?37," --Clinic Associated--",IORVOFF
"RTN","PXBDPOV",124,0)
 Q
"RTN","PXBDPOV",125,0)
 ;
"RTN","PXBDPOV",126,0)
CIA(X) ;Clinical Indicator Abbreviations
"RTN","PXBDPOV",127,0)
 N V,I,CI,CI2 S CI="SC^AO^IR^SWAC^MST^HNC^CV^SHAD",CI2=1 W !
"RTN","PXBDPOV",128,0)
 F I=1,7,2:1:4,8,5,6 S V=$P(X,U,I) I V]"" W ?(CI2*8),$P(CI,U,I),":",$S(V:"Y",1:"N") S CI2=CI2+1
"RTN","PXBDPOV",129,0)
 Q
"RTN","PXBDPOV",130,0)
 ;
"RTN","PXBDPOV",131,0)
ARRAY ;Set POV entries into ^TMP("PXBDPOV",$J,"DSP" for display
"RTN","PXBDPOV",132,0)
 N ENTRY,PX124,PXTLNS
"RTN","PXBDPOV",133,0)
 S PXTMP="^TMP(""PXBDPOV"""_","_$J_","_"""DSP"")",(PXTLNS,PX124)=0
"RTN","PXBDPOV",134,0)
 K @PXTMP
"RTN","PXBDPOV",135,0)
 F  S PX124=$O(PXBSAM(PX124)) Q:'PX124  D
"RTN","PXBDPOV",136,0)
 .S PXTLNS=PXTLNS+1,ENTRY=PXBSAM(PX124)
"RTN","PXBDPOV",137,0)
 .S PXBSAM(PX124,"LINE")=PXTLNS
"RTN","PXBDPOV",138,0)
 .N PXCODSET S PXCODSET=$P($$ICDDATA^ICDXCODE("DIAG",$P(ENTRY,U),$$CSDATE^PXDXUTL(PXBVST),"E"),U,20) I PXCODSET=30 D
"RTN","PXBDPOV",139,0)
 ..N PXENTRY S PXENTRY(1)=$P(ENTRY,U,6) D PR^PXSELDS(.PXENTRY,30)
"RTN","PXBDPOV",140,0)
 ..S $P(ENTRY,U,3)=$$SENTENCE^XLFSTR(PXENTRY(1))
"RTN","PXBDPOV",141,0)
 ..S @PXTMP@(PXTLNS,0)=PX124_U_ENTRY
"RTN","PXBDPOV",142,0)
 ..N PXENTNUM F PXENTNUM=2:1:PXENTRY D
"RTN","PXBDPOV",143,0)
 ...S ENTRY=U_U_$$SENTENCE^XLFSTR(PXENTRY(PXENTNUM)),PXTLNS=PXTLNS+1
"RTN","PXBDPOV",144,0)
 ...S @PXTMP@(PXTLNS,0)=U_ENTRY
"RTN","PXBDPOV",145,0)
 .I PXCODSET'=30 S @PXTMP@(PXTLNS,0)=PX124_U_ENTRY
"RTN","PXBDPOV",146,0)
 .S PXTLNS=PXTLNS+1
"RTN","PXBDPOV",147,0)
 .S @PXTMP@(PXTLNS,0)=0_U_PXBSAM(PX124,"I")
"RTN","PXBDPOV",148,0)
 S PXBCNT=PXTLNS
"RTN","PXBDPOV",149,0)
 Q
"RTN","PXBDPOV",150,0)
 ;
"RTN","PXBDREQ")
0^12^B9107608^B9032260
"RTN","PXBDREQ",1,0)
PXBDREQ ;ISL/JVS - DISPLAY REQUESTS ;6/17/03  10:29
"RTN","PXBDREQ",2,0)
 ;;1.0;PCE PATIENT CARE ENCOUNTER;**73,124,199**;Aug 12, 1996;Build 51
"RTN","PXBDREQ",3,0)
 ;
"RTN","PXBDREQ",4,0)
 ; Variable list
"RTN","PXBDREQ",5,0)
 ; These two variables represent the data that has been selected
"RTN","PXBDREQ",6,0)
 ;  to be saved in the v files by the user
"RTN","PXBDREQ",7,0)
 ;
"RTN","PXBDREQ",8,0)
 ;  REQ*=PROVIDER^PRIMARY^CPT^QUANTITY^POV^PRIMARY
"RTN","PXBDREQ",9,0)
 ;  REQI=Internal Values
"RTN","PXBDREQ",10,0)
 ;  REQE=External Values
"RTN","PXBDREQ",11,0)
 ;
"RTN","PXBDREQ",12,0)
REQ(NO) ;--Display the REQUESTED Data
"RTN","PXBDREQ",13,0)
 N ENTRY,VAR
"RTN","PXBDREQ",14,0)
 S VAR="N"_NO D @VAR
"RTN","PXBDREQ",15,0)
 Q
"RTN","PXBDREQ",16,0)
N4 ;---Fourth Method--for the CPT prompts
"RTN","PXBDREQ",17,0)
 W !,"PROVIDER: ...Enter the provider associated with the CPT'S....."
"RTN","PXBDREQ",18,0)
 D UNDON^PXBCC
"RTN","PXBDREQ",19,0)
 W !,?5,"CPT: "
"RTN","PXBDREQ",20,0)
 F  W $C(32) Q:$X=(IOM-(4))
"RTN","PXBDREQ",21,0)
 W !
"RTN","PXBDREQ",22,0)
 D UNDOFF^PXBCC
"RTN","PXBDREQ",23,0)
 Q
"RTN","PXBDREQ",24,0)
N5 ;---Fifth Method--for the PROVIDER prompts
"RTN","PXBDREQ",25,0)
 W !,"PROVIDER: ...Select a Provider....."
"RTN","PXBDREQ",26,0)
 D UNDON^PXBCC
"RTN","PXBDREQ",27,0)
 W !
"RTN","PXBDREQ",28,0)
 F  W $C(32) Q:$X=(IOM-(4))
"RTN","PXBDREQ",29,0)
 W !
"RTN","PXBDREQ",30,0)
 D UNDOFF^PXBCC
"RTN","PXBDREQ",31,0)
 Q
"RTN","PXBDREQ",32,0)
 ;
"RTN","PXBDREQ",33,0)
N6 ;---Sixth Method--for the POV(DIAGNOSIS) prompts
"RTN","PXBDREQ",34,0)
 W !,"ICD CODE: ...Select a DIAGNOSIS Code....."
"RTN","PXBDREQ",35,0)
 D UNDON^PXBCC
"RTN","PXBDREQ",36,0)
 W !
"RTN","PXBDREQ",37,0)
 F  W $C(32) Q:$X=(IOM-(4))
"RTN","PXBDREQ",38,0)
 W !
"RTN","PXBDREQ",39,0)
 D UNDOFF^PXBCC
"RTN","PXBDREQ",40,0)
 Q
"RTN","PXBDREQ",41,0)
N7 ;---SEVENTH Method--for the STOP CODES prompts
"RTN","PXBDREQ",42,0)
 W !,"STOP CODE: ...Select an AMIS STOP Code....."
"RTN","PXBDREQ",43,0)
 D UNDON^PXBCC
"RTN","PXBDREQ",44,0)
 W !
"RTN","PXBDREQ",45,0)
 F  W $C(32) Q:$X=(IOM-(4))
"RTN","PXBDREQ",46,0)
 W !
"RTN","PXBDREQ",47,0)
 D UNDOFF^PXBCC
"RTN","PXBDREQ",48,0)
 Q
"RTN","PXBDREQ",49,0)
N8 ;---EIGHTH Method--for the ENCOUNTERS prompts
"RTN","PXBDREQ",50,0)
 W !,"ENCOUNTERS: ...Select an ENCOUNTER ....."
"RTN","PXBDREQ",51,0)
 D UNDON^PXBCC
"RTN","PXBDREQ",52,0)
 W !
"RTN","PXBDREQ",53,0)
 F  W $C(32) Q:$X=(IOM-(4))
"RTN","PXBDREQ",54,0)
 W !
"RTN","PXBDREQ",55,0)
 D UNDOFF^PXBCC
"RTN","PXBDREQ",56,0)
 Q
"RTN","PXBDREQ",57,0)
 ;
"RTN","PXBDREQ",58,0)
PRINT(NO) ;--Display the requested information
"RTN","PXBDREQ",59,0)
 N ENTRY,VAR
"RTN","PXBDREQ",60,0)
 S VAR="ZP"_NO D @VAR
"RTN","PXBDREQ",61,0)
 Q
"RTN","PXBDREQ",62,0)
ZP1 ;--PROVIDER AND PRIMARY
"RTN","PXBDREQ",63,0)
 I '$D(REQE) Q
"RTN","PXBDREQ",64,0)
 D LOC^PXBCC(1,10) W $P(REQE,"^",1)_"      "_$P(REQE,"^",2),IOELEOL
"RTN","PXBDREQ",65,0)
 Q
"RTN","PXBDREQ",66,0)
ZP2 ;--CPT PROCEDURE AND DESCRIPTION
"RTN","PXBDREQ",67,0)
 I '$D(REQE) Q
"RTN","PXBDREQ",68,0)
 S ENTRY=$P(REQE,"^",3) I ENTRY]"" D RREVH^PXBCC(1,10,ENTRY)
"RTN","PXBDREQ",69,0)
 Q
"RTN","PXBDREQ",70,0)
ZP3 ;--QUANTITY OF PROCEDURES
"RTN","PXBDREQ",71,0)
 I '$D(REQE) Q
"RTN","PXBDREQ",72,0)
 S ENTRY=$P(REQE,"^",4) I ENTRY]"" D RREV^PXBCC(1,45,ENTRY)
"RTN","PXBDREQ",73,0)
 Q
"RTN","PXBDREQ",74,0)
ZP4 ;--DIAGNOSIS
"RTN","PXBDREQ",75,0)
 I '$D(REQE) Q
"RTN","PXBDREQ",76,0)
 D LOC^PXBCC(1,10) W $P(REQE,"^",5)_"      "_$P(REQE,"^",6),IOELEOL
"RTN","PXBDREQ",77,0)
 Q
"RTN","PXBDREQ",78,0)
 ;
"RTN","PXBDREQ",79,0)
ZP5 ;--STOP CODE
"RTN","PXBDREQ",80,0)
 I '$D(REQE) Q
"RTN","PXBDREQ",81,0)
 S ENTRY=$P(REQE,"^",10) I ENTRY]"" D RREV^PXBCC(0,10,ENTRY)
"RTN","PXBDREQ",82,0)
 Q
"RTN","PXBDREQ",83,0)
 ;
"RTN","PXBDREQ",84,0)
ZP6 ;PX124
"RTN","PXBDREQ",85,0)
ZP7 ;
"RTN","PXBDREQ",86,0)
ZP8 ;
"RTN","PXBDREQ",87,0)
ZP9 ;
"RTN","PXBDREQ",88,0)
ZP10 ;
"RTN","PXBDREQ",89,0)
ZP11 ;
"RTN","PXBDREQ",90,0)
ZP12 ;
"RTN","PXBDREQ",91,0)
ZP13 ;
"RTN","PXBDREQ",92,0)
ZP14 ;
"RTN","PXBDREQ",93,0)
ZP15 ;
"RTN","PXBDREQ",94,0)
 I $D(REQE) D LOC^PXBCC(1,0) W "DIAGNOSIS: ",$E($P(REQE,"^",NO+6),1,68),IOELEOL
"RTN","PXBDREQ",95,0)
 Q
"RTN","PXBDREQ",96,0)
 ;               
"RTN","PXBDREQ",97,0)
RSET(CATEGORY) ; Reset the data in the REQ, REQI and REQE variables
"RTN","PXBDREQ",98,0)
 ; CATEGORY IS EQUAL TO FILE MNEMONIC (e.g. CPT, POV, PRV)
"RTN","PXBDREQ",99,0)
 D @CATEGORY
"RTN","PXBDREQ",100,0)
 Q
"RTN","PXBDREQ",101,0)
CPT ;CPT CODES
"RTN","PXBDREQ",102,0)
 N PX124
"RTN","PXBDREQ",103,0)
 S $P(REQI,"^",3)="",$P(REQE,"^",3)="",$P(REQI,"^",8)=""
"RTN","PXBDREQ",104,0)
 S $P(REQI,"^",4)="",$P(REQE,"^",4)=""
"RTN","PXBDREQ",105,0)
 F PX124=12:1:22 S $P(REQI,"^",PX124)="",$P(REQE,"^",PX124)=""
"RTN","PXBDREQ",106,0)
 K REQ
"RTN","PXBDREQ",107,0)
 Q
"RTN","PXBDREQ",108,0)
PRV ;PROVIDER
"RTN","PXBDREQ",109,0)
 S $P(REQI,"^",1)="",$P(REQE,"^",1)="",$P(REQI,"^",7)=""
"RTN","PXBDREQ",110,0)
 S $P(REQI,"^",2)="",$P(REQE,"^",2)=""
"RTN","PXBDREQ",111,0)
 Q
"RTN","PXBDREQ",112,0)
POV ;PURPOSE OF VISIT
"RTN","PXBDREQ",113,0)
 S $P(REQI,"^",5)="",$P(REQE,"^",5)="",$P(REQI,"^",9)=""
"RTN","PXBDREQ",114,0)
 S $P(REQI,"^",6)="",$P(REQE,"^",6)=""
"RTN","PXBDREQ",115,0)
 Q
"RTN","PXBDREQ",116,0)
STP ;STOPCODES
"RTN","PXBDREQ",117,0)
 S $P(REQI,"^",10)="",$P(REQE,"^",10)=""
"RTN","PXBDREQ",118,0)
 S $P(REQI,"^",11)="",$P(REQE,"^",11)=""
"RTN","PXBDREQ",119,0)
 Q
"RTN","PXBDREQ",120,0)
 ;
"RTN","PXBGPL2")
0^13^B14633423^B14646395
"RTN","PXBGPL2",1,0)
PXBGPL2 ;ISL/JVS - DOUBLE ?? GATHERING OF PATIENT PROBLEM LIST;3/8/96  11:33 ;11/5/96  14:18
"RTN","PXBGPL2",2,0)
 ;;1.0;PCE PATIENT CARE ENCOUNTER;**11,199**;Aug 12, 1996;Build 51
"RTN","PXBGPL2",3,0)
 ;
"RTN","PXBGPL2",4,0)
 W !,"THIS IS NOT AN ENTRY POINT" Q
"RTN","PXBGPL2",5,0)
 ;
"RTN","PXBGPL2",6,0)
 ;
"RTN","PXBGPL2",7,0)
DOUBLE1(FROM) ;--Entry point
"RTN","PXBGPL2",8,0)
 ;
"RTN","PXBGPL2",9,0)
NEW ;
"RTN","PXBGPL2",10,0)
 ;
"RTN","PXBGPL2",11,0)
 S PNAME=NAME
"RTN","PXBGPL2",12,0)
 N FILE,FIELD,TITLE,HEADING,SUB,CODE,NAME,START,SCREEN,CNT,OK,INDEX,CYCLE
"RTN","PXBGPL2",13,0)
 N TOTAL,POV,CNT,PXBPMT,SUB2
"RTN","PXBGPL2",14,0)
 ;---SETUP VARIABLES
"RTN","PXBGPL2",15,0)
 S BACK="",INDEX=""
"RTN","PXBGPL2",16,0)
 S START=DATA,SUB=0,SUB2=0
"RTN","PXBGPL2",17,0)
 ;
"RTN","PXBGPL2",18,0)
START1 ;--RECYCLE POINT
"RTN","PXBGPL2",19,0)
 S TITLE="PATIENT PROBLEM LIST"
"RTN","PXBGPL2",20,0)
 ;
"RTN","PXBGPL2",21,0)
 D PL^PXBGPL(PATIENT)
"RTN","PXBGPL2",22,0)
 ;
"RTN","PXBGPL2",23,0)
 I '$D(PXBPMT) S TOTAL=0
"RTN","PXBGPL2",24,0)
 I $D(PXBPMT) D
"RTN","PXBGPL2",25,0)
 .S (POV,CNT)="" F  S POV=$O(PXBPMT("PL",POV)) Q:POV=""  S CNT=CNT+1 D
"RTN","PXBGPL2",26,0)
 ..S ^TMP("PXBTOTAL",$J,"DILIST","ID",CNT,.01)=POV
"RTN","PXBGPL2",27,0)
 I $D(CNT) S TOTAL=CNT
"RTN","PXBGPL2",28,0)
 ;
"RTN","PXBGPL2",29,0)
 ;--DISPLAY IF NO MATCH FOUND
"RTN","PXBGPL2",30,0)
 I TOTAL=0 W IOCUU,IOCUU,!,IOELEOL D
"RTN","PXBGPL2",31,0)
 .D LOC W !
"RTN","PXBGPL2",32,0)
 .W !!! D HELP^PXBUTL0("PLM")
"RTN","PXBGPL2",33,0)
 .D HELP1^PXBUTL1("CON") R OK:DTIME
"RTN","PXBGPL2",34,0)
 I TOTAL=0 Q TOTAL
"RTN","PXBGPL2",35,0)
 ;
"RTN","PXBGPL2",36,0)
 ;
"RTN","PXBGPL2",37,0)
 ;----DISPLAY LIST TO THE SCREEN
"RTN","PXBGPL2",38,0)
 S HEADING="W !,""ITEM"",?6,""NAME"",?16,""DESCRIPTION "",IOINHI,TOTAL,"" MATCHES"",IOINLOW"
"RTN","PXBGPL2",39,0)
LIST ;-DISPLAY LIST TO THE SCREEN
"RTN","PXBGPL2",40,0)
 D LOC,HEAD
"RTN","PXBGPL2",41,0)
 X HEADING
"RTN","PXBGPL2",42,0)
 S SUB=SUB-1
"RTN","PXBGPL2",43,0)
 S NUM=0 F  S SUB=$O(^TMP("PXBTOTAL",$J,"DILIST","ID",SUB)) S NUM=NUM+1 Q:NUM=11  Q:SUB'>0  S SUB2=SUB2+1 D
"RTN","PXBGPL2",44,0)
 .S NAME=$G(^TMP("PXBTOTAL",$J,"DILIST","ID",SUB,.01))
"RTN","PXBGPL2",45,0)
 .W !,SUB,?6,$P(NAME," ",1),?16,$E($P(NAME," ",2,$L(NAME," ")),1,63)
"RTN","PXBGPL2",46,0)
 ;
"RTN","PXBGPL2",47,0)
 ;----If There is only one selection go to proper prompting
"RTN","PXBGPL2",48,0)
 I TOTAL=1 G PRMPT2
"RTN","PXBGPL2",49,0)
 I $G(VALL)=1 G PRMPT3
"RTN","PXBGPL2",50,0)
 ;
"RTN","PXBGPL2",51,0)
PRMPT ;---WRITE PROMPT HERE
"RTN","PXBGPL2",52,0)
 D LOC^PXBCC(15,1)
"RTN","PXBGPL2",53,0)
 D WIN17^PXBCC(PXBCNT)
"RTN","PXBGPL2",54,0)
 W !
"RTN","PXBGPL2",55,0)
 I SUB>0 W !,"Enter '^' to quit"
"RTN","PXBGPL2",56,0)
 E  I TOTAL>10 W !,"               END OF LIST"
"RTN","PXBGPL2",57,0)
 I SUB>0 S DIR("A")="Select a single 'ITEM NUMBER' or 'RETURN' to continue: "
"RTN","PXBGPL2",58,0)
 E  S DIR("A")="Select a single 'ITEM NUMBER' or 'RETURN' to exit: "
"RTN","PXBGPL2",59,0)
 S DIR("?")="^D HELP^PXBUTL0(""PL11"")"
"RTN","PXBGPL2",60,0)
 S DIR(0)="N,A,O^0:"_SUB2_":0^I X'?.1""^"".N K X"
"RTN","PXBGPL2",61,0)
 D ^DIR
"RTN","PXBGPL2",62,0)
 I X="",SUB>0 G LIST
"RTN","PXBGPL2",63,0)
 I X="",SUB'>0 S X="^"
"RTN","PXBGPL2",64,0)
VAL ;-----Set the VAL equal to the value
"RTN","PXBGPL2",65,0)
 S VAL=$G(^TMP("PXBTOTAL",$J,"DILIST",2,X))_"^"_$G(^TMP("PXBTOTAL",$J,"DILIST","ID",X,.01))
"RTN","PXBGPL2",66,0)
EXITNEW ;--EXIT
"RTN","PXBGPL2",67,0)
 K DIR,^TMP("PXBTANA",$J),^TMP("PXBTOTAL",$J)
"RTN","PXBGPL2",68,0)
 K TANA,TOTAL
"RTN","PXBGPL2",69,0)
 Q VAL
"RTN","PXBGPL2",70,0)
PRMPT3 ;---WRITE PROMPT HERE
"RTN","PXBGPL2",71,0)
 D LOC^PXBCC(15,1)
"RTN","PXBGPL2",72,0)
 D WIN17^PXBCC(PXBCNT)
"RTN","PXBGPL2",73,0)
 W !!
"RTN","PXBGPL2",74,0)
 D HELP1^PXBUTL1("CON") R OK:DTIME
"RTN","PXBGPL2",75,0)
 I SUB>0 G LIST
"RTN","PXBGPL2",76,0)
 I SUB'>0 S X="^"
"RTN","PXBGPL2",77,0)
VALL ;-----Set the VAL equal to the value
"RTN","PXBGPL2",78,0)
 S VAL=$G(^TMP("PXBTOTAL",$J,"DILIST",2,X))_"^"_$G(^TMP("PXBTOTAL",$J,"DILIST","ID",X,.01))
"RTN","PXBGPL2",79,0)
EXITNEWW ;--EXIT
"RTN","PXBGPL2",80,0)
 K ^TMP("PXBTANA",$J),^TMP("PXBTOTAL",$J)
"RTN","PXBGPL2",81,0)
 K TANA,TOTAL
"RTN","PXBGPL2",82,0)
 Q VAL
"RTN","PXBGPL2",83,0)
 Q
"RTN","PXBGPL2",84,0)
 ;
"RTN","PXBGPL2",85,0)
 ;-----------------SUBROUTINES--------------
"RTN","PXBGPL2",86,0)
BACK ;
"RTN","PXBGPL2",87,0)
 S START=$G(^TMP("PXBTANA",$J,"DILIST",1,1))
"RTN","PXBGPL2",88,0)
 S START("IEN")=$G(^TMP("PXBTANA",$J,"DILIST",2,1))
"RTN","PXBGPL2",89,0)
 Q
"RTN","PXBGPL2",90,0)
FORWARD ;
"RTN","PXBGPL2",91,0)
 S START=$G(^TMP("PXBTANA",$J,"DILIST",1,10))
"RTN","PXBGPL2",92,0)
 S START("IEN")=$G(^TMP("PXBTANA",$J,"DILIST",2,10))
"RTN","PXBGPL2",93,0)
 Q
"RTN","PXBGPL2",94,0)
LOC ;--LOCATE CURSOR
"RTN","PXBGPL2",95,0)
 D LOC^PXBCC(3,1) ;--LOCATE THE CURSOR
"RTN","PXBGPL2",96,0)
 W IOEDEOP ;--CLEAR THE PAGE
"RTN","PXBGPL2",97,0)
 Q
"RTN","PXBGPL2",98,0)
HEAD ;--HEAD
"RTN","PXBGPL2",99,0)
 W IOINHI,!,IOCUU,?(IOM-$L(TITLE))\2,TITLE,IOINLOW,IOELEOL
"RTN","PXBGPL2",100,0)
 Q
"RTN","PXBGPL2",101,0)
SUB ;--DISPLAY LIST TO THE SCREEN
"RTN","PXBGPL2",102,0)
 I $P(^TMP("PXBTANA",$J,"DILIST",0),"^",1)=0 W !!,"     E N D  O F  L I S T" Q
"RTN","PXBGPL2",103,0)
 X HEADING
"RTN","PXBGPL2",104,0)
 S SUB=0,CNT=0 F  S SUB=$O(^TMP("PXBTANA",$J,"DILIST","ID",SUB)) Q:SUB'>0  S CNT=CNT+1 D
"RTN","PXBGPL2",105,0)
 .S NAME=$G(^TMP("PXBTANA",$J,"DILIST","ID",SUB,.01))
"RTN","PXBGPL2",106,0)
 .W !,SUB,?6,NAME
"RTN","PXBGPL2",107,0)
 Q
"RTN","PXBGPL2",108,0)
SETUP ;-SETP VARIABLES
"RTN","PXBGPL2",109,0)
 S FILE=200,FIELD=.01
"RTN","PXBGPL2",110,0)
 S HEADING="W !,""ITEM"",?6,""NAME"""
"RTN","PXBGPL2",111,0)
 Q
"RTN","PXBGPL2",112,0)
PRMPT2 ;-----Yes and No prompt if only choice
"RTN","PXBGPL2",113,0)
 D WIN17^PXBCC(PXBCNT)
"RTN","PXBGPL2",114,0)
 D LOC^PXBCC(15,1)
"RTN","PXBGPL2",115,0)
 S DIR("A")="Is this the correct entry "
"RTN","PXBGPL2",116,0)
 S DIR("B")="YES"
"RTN","PXBGPL2",117,0)
 S DIR(0)="Y"
"RTN","PXBGPL2",118,0)
 D ^DIR
"RTN","PXBGPL2",119,0)
 I Y=0 S X="^"
"RTN","PXBGPL2",120,0)
 I Y=1 S X=1
"RTN","PXBGPL2",121,0)
 G VAL
"RTN","PXBGPOV")
0^14^B11410055^B11193623
"RTN","PXBGPOV",1,0)
PXBGPOV ;ISL/JVS,ESW - GATHER POV (DIAGNOSIS) ;8/10/04 1:30pm
"RTN","PXBGPOV",2,0)
 ;;1.0;PCE PATIENT CARE ENCOUNTER;**11,112,149,124,168,199**;Aug 12, 1996;Build 51
"RTN","PXBGPOV",3,0)
 ;
"RTN","PXBGPOV",4,0)
POV(VISIT) ;--Gather the entries in the V POV file
"RTN","PXBGPOV",5,0)
 ;
"RTN","PXBGPOV",6,0)
 N DA,DIC,DIQ,DR,GROUP,I,IEN,PKG,POV,POVI,PRIM,PROBLEM,PROVIDER,PXBC
"RTN","PXBGPOV",7,0)
 N PXBPL,PXBPLA,PXCI,PXDXDATE,QUANTITY,SNARR,SOURC
"RTN","PXBGPOV",8,0)
 ;
"RTN","PXBGPOV",9,0)
 K ^TMP("PXBU",$J),POV,PXBKY,PXBSAM,PXBSKY,PXDIGNS,NOPLLIST
"RTN","PXBGPOV",10,0)
 K ^UTILITY("DIQ1",$J)
"RTN","PXBGPOV",11,0)
 S FPRI="",PROBLEM=""
"RTN","PXBGPOV",12,0)
 I $D(^AUPNVPOV("AD",VISIT)) D
"RTN","PXBGPOV",13,0)
 .S IEN=0 F  S IEN=$O(^AUPNVPOV("AD",VISIT,IEN)) Q:IEN'>0  D
"RTN","PXBGPOV",14,0)
 ..S ^TMP("PXBU",$J,"POV",IEN)=""
"RTN","PXBGPOV",15,0)
 ;
"RTN","PXBGPOV",16,0)
A ;--Set array with DIAGNOSIS codes
"RTN","PXBGPOV",17,0)
 ;
"RTN","PXBGPOV",18,0)
 D PL^PXBGPL(PATIENT)
"RTN","PXBGPOV",19,0)
 I $D(^TMP("PXBU",$J,"POV")) D
"RTN","PXBGPOV",20,0)
 .S IEN=0 F  S IEN=$O(^TMP("PXBU",$J,"POV",IEN)) Q:IEN'>0  D
"RTN","PXBGPOV",21,0)
 ..S DIC=9000010.07,DR=".01;1204;.04;.12;.17;81202;81203;80001:80008",DA=IEN,DIQ(0)="IE" D EN^DIQ1
"RTN","PXBGPOV",22,0)
 ..S PROVIDER=$G(^UTILITY("DIQ1",$J,9000010.07,DA,"1204","E"))
"RTN","PXBGPOV",23,0)
 ..S LNARR=$G(^UTILITY("DIQ1",$J,9000010.07,DA,".04","E"))
"RTN","PXBGPOV",24,0)
 ..S POV=$G(^UTILITY("DIQ1",$J,9000010.07,DA,".01","E"))
"RTN","PXBGPOV",25,0)
 ..S PROBLEM="" S:$D(^TMP("PXBKYPL",$J,POV)) PROBLEM="YES"
"RTN","PXBGPOV",26,0)
 ..S POVI=$G(^UTILITY("DIQ1",$J,9000010.07,DA,".01","I"))
"RTN","PXBGPOV",27,0)
 ..S PRIM=$G(^UTILITY("DIQ1",$J,9000010.07,DA,".12","E"))
"RTN","PXBGPOV",28,0)
 ..S ORDER=$G(^UTILITY("DIQ1",$J,9000010.07,DA,".17","E"))
"RTN","PXBGPOV",29,0)
 ..S PKG=$G(^UTILITY("DIQ1",$J,9000010.07,DA,"81202","I"))
"RTN","PXBGPOV",30,0)
 ..I PKG']"" S PKG="NONE"
"RTN","PXBGPOV",31,0)
 ..S SOURC=$G(^UTILITY("DIQ1",$J,9000010.07,DA,"81203","I"))
"RTN","PXBGPOV",32,0)
 ..I SOURC']"" S SOURC="NONE"
"RTN","PXBGPOV",33,0)
 ..S PXDXDATE=$$CSDATE^PXDXUTL(VISIT)
"RTN","PXBGPOV",34,0)
 ..S SNARR=$P($$ICDDATA^ICDXCODE("DIAG",POVI,PXDXDATE,"I"),U,4)
"RTN","PXBGPOV",35,0)
 ..I $L(LNARR)'>30 S LNARR=$$DXNARR^PXUTL1(POVI,PXDXDATE)
"RTN","PXBGPOV",36,0)
 ..S FPRI=FPRI_$E(PRIM,1,3) ;--Creating flag for Primary prompt
"RTN","PXBGPOV",37,0)
 ..S GROUP=POV_"^"_PROVIDER_"^"_SNARR_"^"_PRIM_"^"_PROBLEM_"^"_LNARR_"^"_ORDER
"RTN","PXBGPOV",38,0)
 ..;        1        2            3        4          5          6         7
"RTN","PXBGPOV",39,0)
 ..I PRIM["PRI" S PXDIGNS("PRIMARY")=POV
"RTN","PXBGPOV",40,0)
 ..S ^TMP("PXBPOV",$J,POV,IEN)=GROUP
"RTN","PXBGPOV",41,0)
 ..S ^TMP("PXBGPOVMATCH",$J,POVI,IEN)=""
"RTN","PXBGPOV",42,0)
 ..I $P(GROUP,"^",5)'["YES" S NOPLLIST=1
"RTN","PXBGPOV",43,0)
 ..S GROUP=$G(^UTILITY("DIQ1",$J,9000010.07,IEN,80001,"I"))
"RTN","PXBGPOV",44,0)
 ..F I=2:1:8 S GROUP=GROUP_U_$G(^UTILITY("DIQ1",$J,9000010.07,IEN,80000+I,"I"))
"RTN","PXBGPOV",45,0)
 ..S PXCI(IEN)=GROUP,PXBREQ(POVI,"I")=GROUP
"RTN","PXBGPOV",46,0)
 ;
"RTN","PXBGPOV",47,0)
B ;--Add line numbers
"RTN","PXBGPOV",48,0)
 ;
"RTN","PXBGPOV",49,0)
 I $D(^TMP("PXBPOV",$J)) D
"RTN","PXBGPOV",50,0)
 .S PXBC=0,POV="" F  S POV=$O(^TMP("PXBPOV",$J,POV)) Q:POV=""  Q:PXBC>40  D
"RTN","PXBGPOV",51,0)
 ..S IEN=0 F  S IEN=$O(^TMP("PXBPOV",$J,POV,IEN)) Q:IEN=""  S PXBC=PXBC+1 D
"RTN","PXBGPOV",52,0)
 ...S PXBKY(POV,PXBC)=$G(^TMP("PXBPOV",$J,POV,IEN)),PXBSAM(PXBC)=$G(^TMP("PXBPOV",$J,POV,IEN))
"RTN","PXBGPOV",53,0)
 ...S PXBSKY(PXBC,IEN)=""
"RTN","PXBGPOV",54,0)
 ...S PXBSAM(PXBC,"LNARR")=$P(PXBSAM(PXBC),U,6)
"RTN","PXBGPOV",55,0)
 ...S PXBSAM(PXBC,"I")=PXCI(IEN)
"RTN","PXBGPOV",56,0)
FINISG ;--finish up some variables
"RTN","PXBGPOV",57,0)
 ;--FPRI=0 NO PRIMARY
"RTN","PXBGPOV",58,0)
 S:FPRI'["PRI" FPRI=0 S:FPRI["PRI" FPRI=1
"RTN","PXBGPOV",59,0)
EXIT ;--KILL
"RTN","PXBGPOV",60,0)
 K ^TMP("PXBU",$J),^TMP("PXBKYPL",$J),^TMP("PXBSAMPL",$J),PXBSKYPL
"RTN","PXBGPOV",61,0)
 K ^TMP("PXBPOV",$J),^UTILITY("DIQ1",$J)
"RTN","PXBGPOV",62,0)
 S PXBCNT=+$G(PXBC)
"RTN","PXBGPOV",63,0)
 Q
"RTN","PXBGPOV",64,0)
 ;
"RTN","PXBGPOV",65,0)
XLATE(VST,DX) ;Translate DX into POV from VST
"RTN","PXBGPOV",66,0)
 Q:'$G(VST)!'$G(DX) ""  Q:'$D(^AUPNVPOV("AD",VST)) ""
"RTN","PXBGPOV",67,0)
 S DX=+$$ICDDATA^ICDXCODE("DIAG",DX,$$CSDATE^PXDXUTL(VST),"I") Q:DX<0 ""
"RTN","PXBGPOV",68,0)
 N IEN,ANS,VAL S (IEN,ANS,VAL)=""
"RTN","PXBGPOV",69,0)
 F  Q:ANS  D
"RTN","PXBGPOV",70,0)
 .S IEN=$O(^AUPNVPOV("AD",VST,IEN)) I 'IEN S ANS=1 Q
"RTN","PXBGPOV",71,0)
 .S VAL=$G(^AUPNVPOV(IEN,0)),ANS=($P(VAL,U)=DX)
"RTN","PXBGPOV",72,0)
 S ANS=IEN_U_DX_U_$P(VAL,U,12) S:IEN ANS=ANS_U_$G(^AUPNVPOV(IEN,800))
"RTN","PXBGPOV",73,0)
 Q ANS
"RTN","PXBGPOV",74,0)
 ;
"RTN","PXBGPOV2")
0^15^B43166443^B37370726
"RTN","PXBGPOV2",1,0)
PXBGPOV2 ;ISL/JVS - DOUBLE ?? GATHERING OF DIAGNOSES ;27 Mar 2013  6:12 PM
"RTN","PXBGPOV2",2,0)
 ;;1.0;PCE PATIENT CARE ENCOUNTER;**1,5,11,136,149,124,203,199**;Aug 12, 1996;Build 51
"RTN","PXBGPOV2",3,0)
 ;
"RTN","PXBGPOV2",4,0)
 W !,"THIS IS NOT AN ENTRY POINT" Q
"RTN","PXBGPOV2",5,0)
DOUBLE(FROM) ;--Entry point
"RTN","PXBGPOV2",6,0)
 ;  WHAT   = The same WHAT as sent in from the API
"RTN","PXBGPOV2",7,0)
 ;  FROM   = Exactly which prompt is asking for the list
"RTN","PXBGPOV2",8,0)
 ;  SCREEN = Same as the DIC("S") screen used by FileMan
"RTN","PXBGPOV2",9,0)
 ;  START  = The starting point as to what to look up
"RTN","PXBGPOV2",10,0)
 ;
"RTN","PXBGPOV2",11,0)
 N BACK,CODE,FIELD,FILE,FIRST,HEADING,NAME,NUM,PXACS,PXACSREC,PXDXDATE
"RTN","PXBGPOV2",12,0)
 N SCREEN,START,SUB,SUB2,TEMP,TITLE,VSTIEN
"RTN","PXBGPOV2",13,0)
 S VSTIEN=$S($D(PXBVST)=1:PXBVST,$D(VISIT)=1:VISIT,1:"")
"RTN","PXBGPOV2",14,0)
 S PXDXDATE=$$CSDATE^PXDXUTL(VSTIEN)
"RTN","PXBGPOV2",15,0)
 S PXACSREC=$$ACTDT^PXDXUTL(PXDXDATE),PXACS=$P(PXACSREC,U,3)
"RTN","PXBGPOV2",16,0)
 I PXACS["-" S PXACS=$P(PXACS,"-",1,2)
"RTN","PXBGPOV2",17,0)
 S BACK="",NUM=0,SCREEN=""
"RTN","PXBGPOV2",18,0)
 D LOC
"RTN","PXBGPOV2",19,0)
 ; ICD9/ICD10 must be filtered out depending on PXDXDATE, so SCREEN must be defined
"RTN","PXBGPOV2",20,0)
 S SCREEN="I $P($$ICDDATA^ICDXCODE(""DIAG"",Y,PXDXDATE,$$IE^ICDEX(Y)),""^"",10)"
"RTN","PXBGPOV2",21,0)
 ;
"RTN","PXBGPOV2",22,0)
 S START=$S($P(PXACSREC,"^",1)="ICD":"001.0 ",1:"A")  ; start with A codes if ICD10
"RTN","PXBGPOV2",23,0)
START ;--RECYCLE POINT
"RTN","PXBGPOV2",24,0)
 S TITLE="ALL DIAGNOSES ("_PXACS_" CODES)"
"RTN","PXBGPOV2",25,0)
 D SETUP
"RTN","PXBGPOV2",26,0)
 D LIST^DIC(FILE,"",FIELD,BACK,10,.START,"","BA",SCREEN,"","^TMP(""PXBTANA"",$J)","^TMP(""PXBTANA"",$J)")
"RTN","PXBGPOV2",27,0)
 D LOC,HEAD
"RTN","PXBGPOV2",28,0)
 D SETSECND   ; SET UP DESCRIPTIONS TO GET AROUND FACT THAT THIS IS NOW A MULTIPLE FIELD IN FILE 80
"RTN","PXBGPOV2",29,0)
 D SUB
"RTN","PXBGPOV2",30,0)
 ;
"RTN","PXBGPOV2",31,0)
PROMPT ;---WRITE PROMPT HERE
"RTN","PXBGPOV2",32,0)
 D WIN17^PXBCC(PXBCNT),LOC^PXBCC(15,1)
"RTN","PXBGPOV2",33,0)
 W !!,"Enter '^' to quit,  '-' for previous page."
"RTN","PXBGPOV2",34,0)
 S DIR("A")="Select a single 'ITEM NUMBER' or 'RETURN' to continue: "
"RTN","PXBGPOV2",35,0)
 S DIR("?")="Enter ITEM 'No' to select , '^' to quit,  '-' for previous page."
"RTN","PXBGPOV2",36,0)
 S DIR(0)="N,A,O^0:10:0^I X'?.1""-"".1""^"".2N!(+X>10) K X"
"RTN","PXBGPOV2",37,0)
 D ^DIR
"RTN","PXBGPOV2",38,0)
 I X="-" S BACK="B" D BACK G START
"RTN","PXBGPOV2",39,0)
 I X="" S BACK="" D FORWARD G START
"RTN","PXBGPOV2",40,0)
 I $G(DIRUT) K DIRUT S VAL="^P" G EXIT
"RTN","PXBGPOV2",41,0)
 ;
"RTN","PXBGPOV2",42,0)
FINISH ;--FINISH SETTING A VARIABLE TO SELECTED ITEM
"RTN","PXBGPOV2",43,0)
 S VAL=$G(^TMP("PXBTANA",$J,"DILIST",2,X))_"^"_$G(^TMP("PXBTANA",$J,"DILIST","ID",X,FIRST))_"--"_$G(^TMP("PXBTANA",$J,"DILIST","ID",X,SECOND))
"RTN","PXBGPOV2",44,0)
EXIT ;--EXIT
"RTN","PXBGPOV2",45,0)
 K DIR,^TMP("PXBTANA",$J),^TMP("PXBTOTAL",$J)
"RTN","PXBGPOV2",46,0)
 Q VAL
"RTN","PXBGPOV2",47,0)
 ;
"RTN","PXBGPOV2",48,0)
DOUBLE1(FROM) ;--Entry point
"RTN","PXBGPOV2",49,0)
NEW ;
"RTN","PXBGPOV2",50,0)
 N CNT,CODE,CYCLE,FIELD,FILE,FIRST,HEADING,HLP,INDEX,NAME,OK,PXACS
"RTN","PXBGPOV2",51,0)
 N PXACSREC,PXDXDATE,SCREEN,START,SUB,SUB2,TITLE,TOTAL,VSTIEN
"RTN","PXBGPOV2",52,0)
 S VSTIEN=$S($D(PXBVST)=1:PXBVST,$D(VISIT)=1:VISIT,1:"")
"RTN","PXBGPOV2",53,0)
 S PXDXDATE=$$CSDATE^PXDXUTL(VSTIEN)
"RTN","PXBGPOV2",54,0)
 S PXACSREC=$$ACTDT^PXDXUTL(PXDXDATE),PXACS=$P(PXACSREC,U,3)
"RTN","PXBGPOV2",55,0)
 I PXACS["-" S PXACS=$P(PXACS,"-",1,2)
"RTN","PXBGPOV2",56,0)
 S BACK="",INDEX="BA"
"RTN","PXBGPOV2",57,0)
 S START=DATA,SUB=0,SUB2=0
"RTN","PXBGPOV2",58,0)
 S DIC("S")="I $P($$ICDDATA^ICDXCODE(""DIAG"",Y,PXDXDATE,$$IE^ICDEX(Y)),""^"",10)"
"RTN","PXBGPOV2",59,0)
 ;
"RTN","PXBGPOV2",60,0)
START1 ;--RECYCLE POINT
"RTN","PXBGPOV2",61,0)
 W !
"RTN","PXBGPOV2",62,0)
 S TITLE="- - S E L E C T E D  D I A G N O S E S ("_PXACS_" CODES) - -"
"RTN","PXBGPOV2",63,0)
 S FILE=80,(FIELD,FIRST)=.01,SECOND="DxDesc",EDATA=DATA
"RTN","PXBGPOV2",64,0)
 I DATA?1N S START=DATA*100 S START=$O(^ICD9("BA",START_" ",-1)) S INDEX="BA"
"RTN","PXBGPOV2",65,0)
 I DATA?2N S START=DATA*10 S START=$O(^ICD9("BA",START_" ",-1)) S INDEX="BA"
"RTN","PXBGPOV2",66,0)
 I DATA?3.NP S (START)=DATA-(.99) S START=$O(^ICD9("BA",START_" ",-1)) S INDEX="BA"
"RTN","PXBGPOV2",67,0)
 I DATA?1A.ANP S START=$O(^ICD9("BA",START_" ",-1)) S INDEX="BA"
"RTN","PXBGPOV2",68,0)
 I DATA?2AP S HLP=1
"RTN","PXBGPOV2",69,0)
 I DATA?3.AP S START=$O(^ICD9("D",DATA),-1),INDEX="D"
"RTN","PXBGPOV2",70,0)
 I DATA?1A!(DATA?1.2N) D WAIT^DICD
"RTN","PXBGPOV2",71,0)
 ;
"RTN","PXBGPOV2",72,0)
 D LIST^DIC(FILE,"",FIELD,BACK,"",.START,DATA,INDEX,DIC("S"),"","^TMP(""PXBTOTAL"",$J)","^TMP(""PXBTOTAL"",$J)")
"RTN","PXBGPOV2",73,0)
 D SETSECND
"RTN","PXBGPOV2",74,0)
 ;
"RTN","PXBGPOV2",75,0)
FILTER ;--FILTER OUT DUPLICATES
"RTN","PXBGPOV2",76,0)
 N I,DXINF,DXINFARR S I=0 F  S I=$O(^TMP("PXBTOTAL",$J,"DILIST","ID",I)) Q:I=""  D
"RTN","PXBGPOV2",77,0)
 .S DXINFARR=$$ICDDESC^ICDXCODE("DIAG",^TMP("PXBTOTAL",$J,"DILIST","ID",I,.01),PXDXDATE,.DXINFARR)
"RTN","PXBGPOV2",78,0)
 .S DXINF=$G(DXINFARR(1))
"RTN","PXBGPOV2",79,0)
 .I DXINF'="" S ^TMP("PXBOTAL",$J,$G(^TMP("PXBTOTAL",$J,"DILIST","ID",I,.01)),$E(DXINF,1,59)_" ",$G(^TMP("PXBTOTAL",$J,"DILIST",2,I))_" ")=""
"RTN","PXBGPOV2",80,0)
 K ^TMP("PXBTOTAL",$J)
"RTN","PXBGPOV2",81,0)
 N I,J,K,C S (I,J,K,C)="" F  S I=$O(^TMP("PXBOTAL",$J,I)) Q:I=""  D
"RTN","PXBGPOV2",82,0)
 .S C=C+1
"RTN","PXBGPOV2",83,0)
 .S J=$O(^TMP("PXBOTAL",$J,I,0))
"RTN","PXBGPOV2",84,0)
 .S K=$O(^TMP("PXBOTAL",$J,I,J,0))
"RTN","PXBGPOV2",85,0)
 .S ^TMP("PXBTOTAL",$J,"DILIST","ID",C,.01)=I
"RTN","PXBGPOV2",86,0)
 .S ^TMP("PXBTOTAL",$J,"DILIST","ID",C,"DxDesc")=J
"RTN","PXBGPOV2",87,0)
 .S ^TMP("PXBTOTAL",$J,"DILIST",2,C)=K
"RTN","PXBGPOV2",88,0)
 S ^TMP("PXBTOTAL",$J,"DILIST",0)=C
"RTN","PXBGPOV2",89,0)
 K ^TMP("PXBOTAL",$J)
"RTN","PXBGPOV2",90,0)
 ;
"RTN","PXBGPOV2",91,0)
 S TOTAL=$P($G(^TMP("PXBTOTAL",$J,"DILIST",0)),"^",1)
"RTN","PXBGPOV2",92,0)
 ;
"RTN","PXBGPOV2",93,0)
 ;--DISPLAY IF NO MATCH FOUND
"RTN","PXBGPOV2",94,0)
 I TOTAL<1 D
"RTN","PXBGPOV2",95,0)
 .W IOEDEOP
"RTN","PXBGPOV2",96,0)
 .I '$G(HLP) W ! D HELP^PXBUTL0("CPTM")
"RTN","PXBGPOV2",97,0)
 .I $G(HLP) S RESULTS="USE AT LEAST THE 3 CHARACTERS" W !,IOCUU,?(IOM-$L(RESULTS))\2,RESULTS
"RTN","PXBGPOV2",98,0)
 .S ERROR=1,CYCL=1
"RTN","PXBGPOV2",99,0)
 I TOTAL<1 Q TOTAL
"RTN","PXBGPOV2",100,0)
 ;
"RTN","PXBGPOV2",101,0)
 ;----DISPLAY LIST TO THE SCREEN
"RTN","PXBGPOV2",102,0)
 S HEADING="W !,""ITEM"",?6,""CODE"",?16,""DESCRIPTION    "",IOINHI,TOTAL,"" MATCHES"",IOINLOW"
"RTN","PXBGPOV2",103,0)
LIST ;-DISPLAY LIST TO THE SCREEN
"RTN","PXBGPOV2",104,0)
 I TOTAL=1 S X=1 G VAL
"RTN","PXBGPOV2",105,0)
 D LOC,HEAD  ; W !
"RTN","PXBGPOV2",106,0)
 ;X HEADING
"RTN","PXBGPOV2",107,0)
 S SUB=SUB-1
"RTN","PXBGPOV2",108,0)
 S NUM=0 F  S SUB=$O(^TMP("PXBTOTAL",$J,"DILIST","ID",SUB)) S NUM=NUM+1 Q:NUM=11  Q:SUB'>0  S SUB2=SUB2+1 D
"RTN","PXBGPOV2",109,0)
 .S CODE=$G(^TMP("PXBTOTAL",$J,"DILIST","ID",SUB,.01))
"RTN","PXBGPOV2",110,0)
 .S NAME=$E($G(^TMP("PXBTOTAL",$J,"DILIST","ID",SUB,"DxDesc")),1,62)
"RTN","PXBGPOV2",111,0)
 .W !,SUB,?6,CODE,?16,NAME
"RTN","PXBGPOV2",112,0)
 ;
"RTN","PXBGPOV2",113,0)
 ;----If There is only one selection go to proper prompting
"RTN","PXBGPOV2",114,0)
 I TOTAL=1 G PRMPT2
"RTN","PXBGPOV2",115,0)
 ;
"RTN","PXBGPOV2",116,0)
PRMPT ;---WRITE PROMPT HERE
"RTN","PXBGPOV2",117,0)
 D WIN17^PXBCC(PXBCNT)
"RTN","PXBGPOV2",118,0)
 D LOC^PXBCC(15,1)
"RTN","PXBGPOV2",119,0)
 W !
"RTN","PXBGPOV2",120,0)
 I SUB>0 W !,"Enter '^' to quit"
"RTN","PXBGPOV2",121,0)
 E  I TOTAL>10 W !,"               END OF LIST"
"RTN","PXBGPOV2",122,0)
 I SUB>0 S DIR("A")="Select a single 'ITEM NUMBER' or 'RETURN' to continue: "
"RTN","PXBGPOV2",123,0)
 E  S DIR("A")="Select a single 'ITEM NUMBER' or 'RETURN' to exit: "
"RTN","PXBGPOV2",124,0)
 S DIR("?")="Enter ITEM 'No' to select , '^' to quit"
"RTN","PXBGPOV2",125,0)
 S DIR(0)="N,A,O^0:"_SUB2_":0^I X'?.1""^"".N K X"
"RTN","PXBGPOV2",126,0)
 D ^DIR
"RTN","PXBGPOV2",127,0)
 I X="",SUB>0 G LIST
"RTN","PXBGPOV2",128,0)
 I X="",SUB'>0 S X="^"
"RTN","PXBGPOV2",129,0)
VAL ;-----Set the VAL equal to the value
"RTN","PXBGPOV2",130,0)
 S VAL=$G(^TMP("PXBTOTAL",$J,"DILIST",2,X))_"^"_$G(^TMP("PXBTOTAL",$J,"DILIST","ID",X,.01))
"RTN","PXBGPOV2",131,0)
EXITNEW ;--EXIT
"RTN","PXBGPOV2",132,0)
 K DIR,^TMP("PXBTANA",$J),^TMP("PXBTOTAL",$J)
"RTN","PXBGPOV2",133,0)
 K TANA,TOTAL
"RTN","PXBGPOV2",134,0)
 Q VAL
"RTN","PXBGPOV2",135,0)
 Q
"RTN","PXBGPOV2",136,0)
 ;
"RTN","PXBGPOV2",137,0)
 ;---SUBROUTINES
"RTN","PXBGPOV2",138,0)
BACK ;
"RTN","PXBGPOV2",139,0)
 S START=$G(^TMP("PXBTANA",$J,"DILIST",1,1))
"RTN","PXBGPOV2",140,0)
 S START("IEN")=$G(^TMP("PXBTANA",$J,"DILIST",2,1))
"RTN","PXBGPOV2",141,0)
 Q
"RTN","PXBGPOV2",142,0)
FORWARD ;
"RTN","PXBGPOV2",143,0)
 S START=$G(^TMP("PXBTANA",$J,"DILIST",1,10))
"RTN","PXBGPOV2",144,0)
 S START("IEN")=$G(^TMP("PXBTANA",$J,"DILIST",2,10))
"RTN","PXBGPOV2",145,0)
 Q
"RTN","PXBGPOV2",146,0)
LOC ;--LOCATE CURSOR
"RTN","PXBGPOV2",147,0)
 D LOC^PXBCC(3,1) ;--LOCATE THE CURSOR
"RTN","PXBGPOV2",148,0)
 W IOEDEOP ;--CLEAR THE PAGE
"RTN","PXBGPOV2",149,0)
 Q
"RTN","PXBGPOV2",150,0)
HEAD ;--HEAD
"RTN","PXBGPOV2",151,0)
 W !,IOCUU,IOBON,"HELP SCREEN",IOSGR0,?(IOM-$L(TITLE))\2,IOINHI,TITLE,IOINLOW,IOELEOL
"RTN","PXBGPOV2",152,0)
 Q
"RTN","PXBGPOV2",153,0)
SUB ;--DISPLAY LIST TO THE SCREEN
"RTN","PXBGPOV2",154,0)
 I $P(^TMP("PXBTANA",$J,"DILIST",0),"^",1)=0 W !!,"     E N D  O F  L I S T" Q
"RTN","PXBGPOV2",155,0)
 X HEADING
"RTN","PXBGPOV2",156,0)
 S SUB=0,CNT=0 F  S SUB=$O(^TMP("PXBTANA",$J,"DILIST","ID",SUB)) Q:SUB'>0  S CNT=CNT+1 D
"RTN","PXBGPOV2",157,0)
 .S CODE=$G(^TMP("PXBTANA",$J,"DILIST","ID",SUB,FIRST))
"RTN","PXBGPOV2",158,0)
 .S NAME=$E($G(^TMP("PXBTANA",$J,"DILIST","ID",SUB,SECOND)),1,62)
"RTN","PXBGPOV2",159,0)
 .W !,SUB,?6,CODE,?16,NAME
"RTN","PXBGPOV2",160,0)
 Q
"RTN","PXBGPOV2",161,0)
SETUP ;-SETUP VARIABLES
"RTN","PXBGPOV2",162,0)
 S FILE=80,FIRST=.01,SECOND="DxDesc"
"RTN","PXBGPOV2",163,0)
 S FIELD=FIRST
"RTN","PXBGPOV2",164,0)
 S HEADING="W !,""ITEM"",?6,""CODE"",?16,""DESCRIPTION"""
"RTN","PXBGPOV2",165,0)
 Q
"RTN","PXBGPOV2",166,0)
SETSECND ;
"RTN","PXBGPOV2",167,0)
 N NAMEARR
"RTN","PXBGPOV2",168,0)
 S SUB=0 F  S SUB=$O(^TMP("PXBTANA",$J,"DILIST","ID",SUB)) Q:SUB'>0  D
"RTN","PXBGPOV2",169,0)
 . S CODE=$G(^TMP("PXBTANA",$J,"DILIST","ID",SUB,FIRST))
"RTN","PXBGPOV2",170,0)
 . S NAMEARR=$$ICDDESC^ICDXCODE("DIAG",CODE,PXDXDATE,.NAMEARR)
"RTN","PXBGPOV2",171,0)
 . S ^TMP("PXBTANA",$J,"DILIST","ID",SUB,SECOND)=$G(NAMEARR(1))
"RTN","PXBGPOV2",172,0)
 Q
"RTN","PXBGPOV2",173,0)
 ;
"RTN","PXBGPOV2",174,0)
PRMPT2 ;-----Yes and No prompt if only choice
"RTN","PXBGPOV2",175,0)
 D WIN17^PXBCC(PXBCNT)
"RTN","PXBGPOV2",176,0)
 D LOC^PXBCC(15,1)
"RTN","PXBGPOV2",177,0)
 S DIR("A")="Is this the correct entry "
"RTN","PXBGPOV2",178,0)
 S DIR("B")="YES"
"RTN","PXBGPOV2",179,0)
 S DIR(0)="Y"
"RTN","PXBGPOV2",180,0)
 D ^DIR
"RTN","PXBGPOV2",181,0)
 I Y=0 S X="^"
"RTN","PXBGPOV2",182,0)
 I Y=1 S X=1
"RTN","PXBGPOV2",183,0)
 G VAL
"RTN","PXBGPOV3")
0^16^B13265811^B13078399
"RTN","PXBGPOV3",1,0)
PXBGPOV3 ;ISL/JVS - DOUBLE ?? GATHERING OF CLINIC DIAGNOSES ;11/5/96  14:20
"RTN","PXBGPOV3",2,0)
 ;;1.0;PCE PATIENT CARE ENCOUNTER;**11,199**;Aug 12, 1996;Build 51
"RTN","PXBGPOV3",3,0)
 ;
"RTN","PXBGPOV3",4,0)
 ;
"RTN","PXBGPOV3",5,0)
 ;
"RTN","PXBGPOV3",6,0)
 W !,"THIS IS NOT AN ENTRY POINT" Q
"RTN","PXBGPOV3",7,0)
 ;
"RTN","PXBGPOV3",8,0)
 ;
"RTN","PXBGPOV3",9,0)
 ;
"RTN","PXBGPOV3",10,0)
DOUBLE1(FROM) ;--Entry point
"RTN","PXBGPOV3",11,0)
 ;
"RTN","PXBGPOV3",12,0)
NEW ;
"RTN","PXBGPOV3",13,0)
 ;
"RTN","PXBGPOV3",14,0)
 N FILE,FIELD,TITLE,HEADING,SUB,CODE,NAME,START,SCREEN,CNT,OK,INDEX,CYCLE
"RTN","PXBGPOV3",15,0)
 N TOTAL,POV,CNT,PXBPMT,SUB2
"RTN","PXBGPOV3",16,0)
 ;---SETUP VARIABLES
"RTN","PXBGPOV3",17,0)
 S BACK="",INDEX=""
"RTN","PXBGPOV3",18,0)
 S START=DATA,SUB=0,SUB2=0
"RTN","PXBGPOV3",19,0)
 ;
"RTN","PXBGPOV3",20,0)
START1 ;--RECYCLE POINT
"RTN","PXBGPOV3",21,0)
 S TITLE="- - C L I N I C    D I A G N O S E S - -"
"RTN","PXBGPOV3",22,0)
 ;
"RTN","PXBGPOV3",23,0)
 D POV^PXBUTL2(CLINIC,3)
"RTN","PXBGPOV3",24,0)
 ;
"RTN","PXBGPOV3",25,0)
 I '$D(PXBPMT) S TOTAL=0
"RTN","PXBGPOV3",26,0)
 I $D(PXBPMT) D
"RTN","PXBGPOV3",27,0)
 .S (POV,CNT)="" F  S POV=$O(PXBPMT("POV",POV)) Q:POV=""  S CNT=CNT+1 D
"RTN","PXBGPOV3",28,0)
 ..S ^TMP("PXBTOTAL",$J,"DILIST","ID",CNT,.01)=POV
"RTN","PXBGPOV3",29,0)
 I $D(CNT) S TOTAL=CNT
"RTN","PXBGPOV3",30,0)
 ;
"RTN","PXBGPOV3",31,0)
 ;--DISPLAY IF NO MATCH FOUND
"RTN","PXBGPOV3",32,0)
 I TOTAL=0 W IOCUU,IOCUU,!,IOELEOL D
"RTN","PXBGPOV3",33,0)
 .D LOC W !
"RTN","PXBGPOV3",34,0)
 .S RESULTS="NO DIAGNOSES ARE SET UP FOR THIS CLINIC" W !!!,?(IOM-$L(RESULTS))\2,RESULTS D HELP1^PXBUTL1("CON") R OK:DTIME
"RTN","PXBGPOV3",35,0)
 I TOTAL=0 Q TOTAL
"RTN","PXBGPOV3",36,0)
 ;
"RTN","PXBGPOV3",37,0)
 ;
"RTN","PXBGPOV3",38,0)
 ;----DISPLAY LIST TO THE SCREEN
"RTN","PXBGPOV3",39,0)
 S HEADING="W !,""ITEM"",?6,""NAME"",?16,""DESCRIPTION"",IOINHI,TOTAL,"" MATCHES"",IOINLOW"
"RTN","PXBGPOV3",40,0)
LIST ;-DISPLAY LIST TO THE SCREEN
"RTN","PXBGPOV3",41,0)
 D LOC W !
"RTN","PXBGPOV3",42,0)
 X HEADING
"RTN","PXBGPOV3",43,0)
 S SUB=SUB-1
"RTN","PXBGPOV3",44,0)
 S NUM=0 F  S SUB=$O(^TMP("PXBTOTAL",$J,"DILIST","ID",SUB)) S NUM=NUM+1 Q:NUM=11  Q:SUB'>0  S SUB2=SUB2+1 D
"RTN","PXBGPOV3",45,0)
 .S NAME=$G(^TMP("PXBTOTAL",$J,"DILIST","ID",SUB,.01))
"RTN","PXBGPOV3",46,0)
 .W !,SUB,?6,$P(NAME,"--",1),?16,$E($P(NAME,"--",2,$L(NAME," ")),1,60)
"RTN","PXBGPOV3",47,0)
 ;
"RTN","PXBGPOV3",48,0)
 ;----If There is only one selection go to proper prompting
"RTN","PXBGPOV3",49,0)
 I TOTAL=1 G PRMPT2
"RTN","PXBGPOV3",50,0)
 ;
"RTN","PXBGPOV3",51,0)
PRMPT ;---WRITE PROMPT HERE
"RTN","PXBGPOV3",52,0)
 D WIN17^PXBCC(PXBCNT)
"RTN","PXBGPOV3",53,0)
 D LOC^PXBCC(15,1)
"RTN","PXBGPOV3",54,0)
 W !
"RTN","PXBGPOV3",55,0)
 I SUB>0 W !,"Enter '^' to quit"
"RTN","PXBGPOV3",56,0)
 E  I TOTAL>10 W !,"               END OF LIST"
"RTN","PXBGPOV3",57,0)
 I SUB>0 S DIR("A")="Select a single 'ITEM NUMBER' or 'RETURN' to continue: "
"RTN","PXBGPOV3",58,0)
 E  S DIR("A")="Select a single 'ITEM NUMBER' or 'RETURN' to exit: "
"RTN","PXBGPOV3",59,0)
 S DIR("?")="Enter ITEM 'No' to select , '^' to quit"
"RTN","PXBGPOV3",60,0)
 S DIR(0)="N,A,O^0:"_SUB2_":0^I X'?.1""^"".N K X"
"RTN","PXBGPOV3",61,0)
 D ^DIR
"RTN","PXBGPOV3",62,0)
 I X="",SUB>0 G LIST
"RTN","PXBGPOV3",63,0)
 I X="",SUB'>0 S X="^"
"RTN","PXBGPOV3",64,0)
VAL ;-----Set the VAL equal to the value
"RTN","PXBGPOV3",65,0)
 S VAL=$G(^TMP("PXBTOTAL",$J,"DILIST",2,X))_"^"_$G(^TMP("PXBTOTAL",$J,"DILIST","ID",X,.01))
"RTN","PXBGPOV3",66,0)
EXITNEW ;--EXIT
"RTN","PXBGPOV3",67,0)
 K DIR,^TMP("PXBTANA",$J),^TMP("PXBTOTAL",$J)
"RTN","PXBGPOV3",68,0)
 K TANA,TOTAL
"RTN","PXBGPOV3",69,0)
 Q VAL
"RTN","PXBGPOV3",70,0)
 Q
"RTN","PXBGPOV3",71,0)
 ;
"RTN","PXBGPOV3",72,0)
 ;-----------------SUBROUTINES--------------
"RTN","PXBGPOV3",73,0)
BACK ;
"RTN","PXBGPOV3",74,0)
 S START=$G(^TMP("PXBTANA",$J,"DILIST",1,1))
"RTN","PXBGPOV3",75,0)
 S START("IEN")=$G(^TMP("PXBTANA",$J,"DILIST",2,1))
"RTN","PXBGPOV3",76,0)
 Q
"RTN","PXBGPOV3",77,0)
FORWARD ;
"RTN","PXBGPOV3",78,0)
 S START=$G(^TMP("PXBTANA",$J,"DILIST",1,10))
"RTN","PXBGPOV3",79,0)
 S START("IEN")=$G(^TMP("PXBTANA",$J,"DILIST",2,10))
"RTN","PXBGPOV3",80,0)
 Q
"RTN","PXBGPOV3",81,0)
LOC ;--LOCATE CURSOR
"RTN","PXBGPOV3",82,0)
 D LOC^PXBCC(3,1) ;--LOCATE THE CURSOR
"RTN","PXBGPOV3",83,0)
 W IOEDEOP ;--CLEAR THE PAGE
"RTN","PXBGPOV3",84,0)
 Q
"RTN","PXBGPOV3",85,0)
HEAD ;--HEAD
"RTN","PXBGPOV3",86,0)
 W !,IOCUU,IOBON,"HELP SCREEN",IOSGR0,?(IOM-$L(TITLE))\2,IOINHI,TITLE,IOINLOW,IOELEOL
"RTN","PXBGPOV3",87,0)
 Q
"RTN","PXBGPOV3",88,0)
SUB ;--DISPLAY LIST TO THE SCREEN
"RTN","PXBGPOV3",89,0)
 I $P(^TMP("PXBTANA",$J,"DILIST",0),"^",1)=0 W !!,"     E N D  O F  L I S T" Q
"RTN","PXBGPOV3",90,0)
 X HEADING
"RTN","PXBGPOV3",91,0)
 S SUB=0,CNT=0 F  S SUB=$O(^TMP("PXBTANA",$J,"DILIST","ID",SUB)) Q:SUB'>0  S CNT=CNT+1 D
"RTN","PXBGPOV3",92,0)
 .S NAME=$G(^TMP("PXBTANA",$J,"DILIST","ID",SUB,.01))
"RTN","PXBGPOV3",93,0)
 .W !,SUB,?6,NAME
"RTN","PXBGPOV3",94,0)
 Q
"RTN","PXBGPOV3",95,0)
SETUP ;-SETP VARIABLES
"RTN","PXBGPOV3",96,0)
 S FILE=200,FIELD=.01
"RTN","PXBGPOV3",97,0)
 S HEADING="W !,""ITEM"",?6,""NAME"""
"RTN","PXBGPOV3",98,0)
 Q
"RTN","PXBGPOV3",99,0)
PRMPT2 ;-----Yes and No prompt if only choice
"RTN","PXBGPOV3",100,0)
 D WIN17^PXBCC(PXBCNT)
"RTN","PXBGPOV3",101,0)
 D LOC^PXBCC(15,1)
"RTN","PXBGPOV3",102,0)
 S DIR("A")="Is this the correct entry "
"RTN","PXBGPOV3",103,0)
 S DIR("B")="YES"
"RTN","PXBGPOV3",104,0)
 S DIR(0)="Y"
"RTN","PXBGPOV3",105,0)
 D ^DIR
"RTN","PXBGPOV3",106,0)
 I Y=0 S X="^"
"RTN","PXBGPOV3",107,0)
 I Y=1 S X=1
"RTN","PXBGPOV3",108,0)
 G VAL
"RTN","PXBGPOV4")
0^17^B18370344^B17114546
"RTN","PXBGPOV4",1,0)
PXBGPOV4 ;ISL/JVS - DOUBLE ?? GATHERING OF FORM DIAGNOSES ;5/7/03 3:31pm
"RTN","PXBGPOV4",2,0)
 ;;1.0;PCE PATIENT CARE ENCOUNTER;**11,28,121,199**;Aug 12, 1996;Build 51
"RTN","PXBGPOV4",3,0)
 ;
"RTN","PXBGPOV4",4,0)
 ;
"RTN","PXBGPOV4",5,0)
 ;
"RTN","PXBGPOV4",6,0)
 W !,"THIS IS NOT AN ENTRY POINT" Q
"RTN","PXBGPOV4",7,0)
 ;  
"RTN","PXBGPOV4",8,0)
 ;
"RTN","PXBGPOV4",9,0)
DOUBLE1(FROM) ;--Entry point
"RTN","PXBGPOV4",10,0)
 ;
"RTN","PXBGPOV4",11,0)
NEW ;
"RTN","PXBGPOV4",12,0)
 ;
"RTN","PXBGPOV4",13,0)
 N CNT,CODE,CYCLE,FIELD,FILE,HEADING,INDEX,NAME,OK,POVSTR,PRV,PXBPMT
"RTN","PXBGPOV4",14,0)
 N PXDXDATE,SCREEN,START,SUB,SUB2,TITLE,TOTAL,VSTIEN
"RTN","PXBGPOV4",15,0)
 S VSTIEN=$S($D(PXBVST)=1:PXBVST,$D(VISIT)=1:VISIT,1:"")
"RTN","PXBGPOV4",16,0)
 S PXDXDATE=$$CSDATE^PXDXUTL(VSTIEN)
"RTN","PXBGPOV4",17,0)
 ;---SETUP VARIABLES
"RTN","PXBGPOV4",18,0)
 S BACK="",INDEX=""
"RTN","PXBGPOV4",19,0)
 S START=DATA,SUB=0,SUB2=0
"RTN","PXBGPOV4",20,0)
 ;
"RTN","PXBGPOV4",21,0)
START1 ;--RECYCLE POINT
"RTN","PXBGPOV4",22,0)
 S TITLE="- - F O R M    D I A G N O S I S - -"
"RTN","PXBGPOV4",23,0)
 ;
"RTN","PXBGPOV4",24,0)
 S POVSTR=$P($$ACTDT^PXDXUTL(PXDXDATE),U,1)
"RTN","PXBGPOV4",25,0)
 I POVSTR?2N.A S POVSTR=$E(POVSTR,3,99)_$E(POVSTR,1,2) ; turn 10D into D10, etc. to make it a valid line tag
"RTN","PXBGPOV4",26,0)
 S POVSTR=POVSTR_"^PXBAICS"
"RTN","PXBGPOV4",27,0)
 D GETLST^IBDF18A(CLINIC,$P($T(@POVSTR),";;",2),"PXBPMT",,,,PXDXDATE)
"RTN","PXBGPOV4",28,0)
ME ;
"RTN","PXBGPOV4",29,0)
 ;--------TEST PURPOSES-------
"RTN","PXBGPOV4",30,0)
 ;S PXBPMT(0)=4
"RTN","PXBGPOV4",31,0)
 ;S PXBPMT(1)="^TEST"
"RTN","PXBGPOV4",32,0)
 ;S PXBPMT(2)="309.0^TEST 1"
"RTN","PXBGPOV4",33,0)
 ;S PXBPMT(3)="295.12^TEST 2"
"RTN","PXBGPOV4",34,0)
 ;S PXBPMT(4)="V62.2^TEST 3"
"RTN","PXBGPOV4",35,0)
 ;---------------------
"RTN","PXBGPOV4",36,0)
 S TOTAL=PXBPMT(0)
"RTN","PXBGPOV4",37,0)
 I PXBPMT(0)>0 D
"RTN","PXBGPOV4",38,0)
 .S (SUB,CNT)=0 F  S SUB=$O(PXBPMT(SUB)) Q:SUB=""  D
"RTN","PXBGPOV4",39,0)
 ..Q:$P(PXBPMT(SUB),"^",1)=""
"RTN","PXBGPOV4",40,0)
 ..S CODE=$P(PXBPMT(SUB),"^",1)
"RTN","PXBGPOV4",41,0)
 ..Q:'$P($$ICDDATA^ICDXCODE("DIAG",CODE,PXDXDATE,"E"),"^",10)
"RTN","PXBGPOV4",42,0)
 ..S NAME=$P(PXBPMT(SUB),"^",2)
"RTN","PXBGPOV4",43,0)
 ..S CNT=CNT+1
"RTN","PXBGPOV4",44,0)
 ..S ^TMP("PXBTOTAL",$J,"DILIST","ID",CNT,.01)=CODE
"RTN","PXBGPOV4",45,0)
 ..S ^TMP("PXBTOTAL",$J,"DILIST","ID",CNT,2)=NAME
"RTN","PXBGPOV4",46,0)
 I $D(CNT) S TOTAL=CNT
"RTN","PXBGPOV4",47,0)
 ;
"RTN","PXBGPOV4",48,0)
 ;
"RTN","PXBGPOV4",49,0)
 ;--DISPLAY IF NO MATCH FOUND
"RTN","PXBGPOV4",50,0)
 I TOTAL=0 W IOCUU,IOCUU,!,IOELEOL D
"RTN","PXBGPOV4",51,0)
 .D LOC W !
"RTN","PXBGPOV4",52,0)
 .S RESULTS="NO DIAGNOSIS BLOCKS EXIST FOR AN ENCOUNTER FORM" W !!!,?(IOM-$L(RESULTS))\2,RESULTS D HELP1^PXBUTL1("CON") R OK:DTIME
"RTN","PXBGPOV4",53,0)
 I TOTAL=0 Q TOTAL
"RTN","PXBGPOV4",54,0)
 ;
"RTN","PXBGPOV4",55,0)
 ;
"RTN","PXBGPOV4",56,0)
 ;----DISPLAY LIST TO THE SCREEN
"RTN","PXBGPOV4",57,0)
 S HEADING="W !,""ITEM"",?6,""CODE"",?16,""DESCRIPTION   "",IOINHI,TOTAL,"" ENTRIES"",IOINLOW"
"RTN","PXBGPOV4",58,0)
LIST ;-DISPLAY LIST TO THE SCREEN
"RTN","PXBGPOV4",59,0)
 D LOC W !
"RTN","PXBGPOV4",60,0)
 X HEADING
"RTN","PXBGPOV4",61,0)
 S SUB=SUB-1
"RTN","PXBGPOV4",62,0)
 S NUM=0 F  S SUB=$O(^TMP("PXBTOTAL",$J,"DILIST","ID",SUB)) S NUM=NUM+1 Q:NUM=11  Q:SUB'>0  S SUB2=SUB2+1 D
"RTN","PXBGPOV4",63,0)
 .S CODE=$G(^TMP("PXBTOTAL",$J,"DILIST","ID",SUB,.01))
"RTN","PXBGPOV4",64,0)
 .S NAME=$G(^TMP("PXBTOTAL",$J,"DILIST","ID",SUB,2))
"RTN","PXBGPOV4",65,0)
 .W !,SUB,?6,CODE,?16,$E(NAME,1,63)
"RTN","PXBGPOV4",66,0)
 ;
"RTN","PXBGPOV4",67,0)
 ;----If There is only one selection go to proper prompting
"RTN","PXBGPOV4",68,0)
 I TOTAL=1 G PRMPT2
"RTN","PXBGPOV4",69,0)
 ;
"RTN","PXBGPOV4",70,0)
PRMPT ;---WRITE PROMPT HERE
"RTN","PXBGPOV4",71,0)
 D WIN17^PXBCC(PXBCNT)
"RTN","PXBGPOV4",72,0)
 D LOC^PXBCC(15,1)
"RTN","PXBGPOV4",73,0)
 W !
"RTN","PXBGPOV4",74,0)
 I SUB>0 W !,"Enter '^' to quit"
"RTN","PXBGPOV4",75,0)
 E  I TOTAL>10 W !,"               END OF LIST"
"RTN","PXBGPOV4",76,0)
 I SUB>0 S DIR("A")="Select a single 'ITEM NUMBER' or 'RETURN' to continue: "
"RTN","PXBGPOV4",77,0)
 E  S DIR("A")="Select a single 'ITEM NUMBER' or 'RETURN' to exit: "
"RTN","PXBGPOV4",78,0)
 S DIR("?")="Enter ITEM 'No' to select , '^' to quit"
"RTN","PXBGPOV4",79,0)
 S DIR(0)="N,A,O^0:"_SUB2_":0^I X'?.1""^"".N K X"
"RTN","PXBGPOV4",80,0)
 D ^DIR
"RTN","PXBGPOV4",81,0)
 I X="",SUB>0 G LIST
"RTN","PXBGPOV4",82,0)
 I X="",SUB'>0 S X="^"
"RTN","PXBGPOV4",83,0)
 I $G(DIRUT) K DIRUT S VAL="^P" G EXITNEW
"RTN","PXBGPOV4",84,0)
VAL ;-----Set the VAL equal to the value
"RTN","PXBGPOV4",85,0)
 S VAL=$G(^TMP("PXBTOTAL",$J,"DILIST",2,X))_"^"_$G(^TMP("PXBTOTAL",$J,"DILIST","ID",X,.01))
"RTN","PXBGPOV4",86,0)
EXITNEW ;--EXIT
"RTN","PXBGPOV4",87,0)
 K DIR,^TMP("PXBTANA",$J),^TMP("PXBTOTAL",$J)
"RTN","PXBGPOV4",88,0)
 K TANA,TOTAL
"RTN","PXBGPOV4",89,0)
 Q VAL
"RTN","PXBGPOV4",90,0)
 Q
"RTN","PXBGPOV4",91,0)
 ;
"RTN","PXBGPOV4",92,0)
 ;-----------------SUBROUTINES--------------
"RTN","PXBGPOV4",93,0)
BACK ;
"RTN","PXBGPOV4",94,0)
 S START=$G(^TMP("PXBTANA",$J,"DILIST",1,1))
"RTN","PXBGPOV4",95,0)
 S START("IEN")=$G(^TMP("PXBTANA",$J,"DILIST",2,1))
"RTN","PXBGPOV4",96,0)
 Q
"RTN","PXBGPOV4",97,0)
FORWARD ;
"RTN","PXBGPOV4",98,0)
 S START=$G(^TMP("PXBTANA",$J,"DILIST",1,10))
"RTN","PXBGPOV4",99,0)
 S START("IEN")=$G(^TMP("PXBTANA",$J,"DILIST",2,10))
"RTN","PXBGPOV4",100,0)
 Q
"RTN","PXBGPOV4",101,0)
LOC ;--LOCATE CURSOR
"RTN","PXBGPOV4",102,0)
 D LOC^PXBCC(3,1) ;--LOCATE THE CURSOR
"RTN","PXBGPOV4",103,0)
 W IOEDEOP ;--CLEAR THE PAGE
"RTN","PXBGPOV4",104,0)
 Q
"RTN","PXBGPOV4",105,0)
HEAD ;--HEAD
"RTN","PXBGPOV4",106,0)
 W !,IOCUU,IOBON,"HELP SCREEN",IOSGR0,?(IOM-$L(TITLE))\2,IOINHI,TITLE,IOINLOW,IOELEOL
"RTN","PXBGPOV4",107,0)
 Q
"RTN","PXBGPOV4",108,0)
SUB ;--DISPLAY LIST TO THE SCREEN
"RTN","PXBGPOV4",109,0)
 I $P(^TMP("PXBTANA",$J,"DILIST",0),"^",1)=0 W !!,"     E N D  O F  L I S T" Q
"RTN","PXBGPOV4",110,0)
 X HEADING
"RTN","PXBGPOV4",111,0)
 S SUB=0,CNT=0 F  S SUB=$O(^TMP("PXBTANA",$J,"DILIST","ID",SUB)) Q:SUB'>0  S CNT=CNT+1 D
"RTN","PXBGPOV4",112,0)
 .S NAME=$G(^TMP("PXBTANA",$J,"DILIST","ID",SUB,.01))
"RTN","PXBGPOV4",113,0)
 .W !,SUB,?6,NAME
"RTN","PXBGPOV4",114,0)
 Q
"RTN","PXBGPOV4",115,0)
SETUP ;-SETP VARIABLES
"RTN","PXBGPOV4",116,0)
 S FILE=200,FIELD=.01
"RTN","PXBGPOV4",117,0)
 S HEADING="W !,""ITEM"",?6,""NAME"""
"RTN","PXBGPOV4",118,0)
 Q
"RTN","PXBGPOV4",119,0)
PRMPT2 ;-----Yes and No prompt if only choice
"RTN","PXBGPOV4",120,0)
 D WIN17^PXBCC(PXBCNT)
"RTN","PXBGPOV4",121,0)
 D LOC^PXBCC(15,1)
"RTN","PXBGPOV4",122,0)
 S DIR("A")="Is this the correct entry "
"RTN","PXBGPOV4",123,0)
 S DIR("B")="YES"
"RTN","PXBGPOV4",124,0)
 S DIR(0)="Y"
"RTN","PXBGPOV4",125,0)
 D ^DIR
"RTN","PXBGPOV4",126,0)
 I Y=0 S X="^"
"RTN","PXBGPOV4",127,0)
 I Y=1 S X=1
"RTN","PXBGPOV4",128,0)
 G VAL
"RTN","PXBHLP3")
0^18^B18181575^B15121600
"RTN","PXBHLP3",1,0)
PXBHLP3 ;ISL/JVS,ALB/Zoltan - HELP FOR DIAGNOSIS ;10/30/98
"RTN","PXBHLP3",2,0)
 ;;1.0;PCE PATIENT CARE ENCOUNTER;**11,19,62,199**;Aug 12, 1996;Build 51
"RTN","PXBHLP3",3,0)
 ;
"RTN","PXBHLP3",4,0)
 ;
"RTN","PXBHLP3",5,0)
 ; If you edit the text be sure to change the length next to the TAG
"RTN","PXBHLP3",6,0)
 ;   e.g.===  ;;4
"RTN","PXBHLP3",7,0)
 ;  you can put a line feed '!' at the end of the last line if necessary.
"RTN","PXBHLP3",8,0)
 ;
"RTN","PXBHLP3",9,0)
 ;
"RTN","PXBHLP3",10,0)
 W !,"THIS IS NOT AN ENTRY POINT " Q
"RTN","PXBHLP3",11,0)
INTRO ;;6
"RTN","PXBHLP3",12,0)
 W !,"Enter a DIAGNOSIS associated with this patient ENCOUNTER."
"RTN","PXBHLP3",13,0)
 W !,"You can enter partial names to receive a short list."
"RTN","PXBHLP3",14,0)
 W !,"Above is a list of DIAGNOSES already entered. If there are any"
"RTN","PXBHLP3",15,0)
 W !,"additional ones, they should be entered at this time."
"RTN","PXBHLP3",16,0)
 W !," * indicates that this entry has been visited during this session."
"RTN","PXBHLP3",17,0)
 I $G(WHAT)="INTV" W !,"a '^^' (double up arrow) will take you out of the interview"
"RTN","PXBHLP3",18,0)
 W !,"For more detailed ",IOINHI,"HELP",IOINLOW," and selection lists enter ",IOINHI,"??",IOINLOW,!
"RTN","PXBHLP3",19,0)
 Q
"RTN","PXBHLP3",20,0)
BODY ;;12
"RTN","PXBHLP3",21,0)
 W !,"To receive detailed help for ",IOINHI,"ADD",IOINLOW," or ",IOINHI,"DELETE",IOINLOW," enter the following:"
"RTN","PXBHLP3",22,0)
 W !
"RTN","PXBHLP3",23,0)
 W !,"  ",IOINHI,"A",IOINLOW,"   to get help on how to ADD diagnoses."
"RTN","PXBHLP3",24,0)
 W !,"  ",IOINHI,"D",IOINLOW,"   to get help on how to DELETE diagnoses."
"RTN","PXBHLP3",25,0)
 W !,"  ",IOINHI,"E",IOINLOW,"   to get help on how to EDIT diagnoses."
"RTN","PXBHLP3",26,0)
 W !
"RTN","PXBHLP3",27,0)
 W !,"To receive more ",IOINHI,"SELECTION LISTS",IOINLOW," enter the following:"
"RTN","PXBHLP3",28,0)
 W !
"RTN","PXBHLP3",29,0)
 W !,"  ",IOINHI,"1",IOINLOW,"   to get a list of ALL active diagnoses."
"RTN","PXBHLP3",30,0)
 W !,"  ",IOINHI,"2",IOINLOW,"   to get a list of PATIENT PROBLEMS."
"RTN","PXBHLP3",31,0)
 W !,"  ",IOINHI,"3",IOINLOW,"   to get a list of CLINIC diagnoses."
"RTN","PXBHLP3",32,0)
 W !,"  ",IOINHI,"4",IOINLOW,"   to get a list of ENCOUNTER FORM diagnoses."
"RTN","PXBHLP3",33,0)
 Q
"RTN","PXBHLP3",34,0)
A ;;5
"RTN","PXBHLP3",35,0)
 N PXACSREC S PXACSREC=$$ACTDT^PXDXUTL($S($G(IDATE)'="":IDATE,1:DT))
"RTN","PXBHLP3",36,0)
 W !,"To ",IOINHI,"ADD",IOINLOW," a DIAGNOSIS enter one of the following:"
"RTN","PXBHLP3",37,0)
 W !,"  DIAGNOSIS NAME (e.g. ",$S($P(PXACSREC,"^",1)="ICD":"GASTROPARESIS",1:"SALMONELLA MENINGITIS"),")"
"RTN","PXBHLP3",38,0)
 W !,"  PARTIAL NAME of the DIAGNOSIS at least 3 letters in length(e.g. ",$S($P(PXACSREC,"^",1)="ICD":"GAS or GASTRO",1:"SAL or SALMON"),")"
"RTN","PXBHLP3",39,0)
 W !,"  ICD CODE number (e.g. ",$S($P(PXACSREC,"^",1)="ICD":"536.3",1:"A02.21"),")"
"RTN","PXBHLP3",40,0)
 W !,"  Several ICD CODE numbers at once (e.g. ",$S($P(PXACSREC,"^",1)="ICD":"536.3,250.61",1:"A02.21,C92.01"),")"
"RTN","PXBHLP3",41,0)
 Q
"RTN","PXBHLP3",42,0)
E ;;10
"RTN","PXBHLP3",43,0)
 N PXACSREC S PXACSREC=$$ACTDT^PXDXUTL($S($G(IDATE)'="":IDATE,1:DT))
"RTN","PXBHLP3",44,0)
 W !,"To ",IOINHI,"EDIT",IOINLOW," a DIAGNOSIS enter one of the following:"
"RTN","PXBHLP3",45,0)
 W !,"  DIAGNOSIS NAME (e.g. ",$S($P(PXACSREC,"^",1)="ICD":"GASTROPARESIS",1:"SALMONELLA MENINGITIS"),")"
"RTN","PXBHLP3",46,0)
 W !,"  ICD CODE (e.g. ",$S($P(PXACSREC,"^",1)="ICD":"536.3",1:"A02.21"),")"
"RTN","PXBHLP3",47,0)
 W !,"  ITEM NUMBER on the left side of the list of the DIAGNOSES (e.g. 7)"
"RTN","PXBHLP3",48,0)
 W !
"RTN","PXBHLP3",49,0)
 W !,"To move the PRIMARY designation from one diagnosis to another do the following:"
"RTN","PXBHLP3",50,0)
 W !,"  select the current primary diagnosis"
"RTN","PXBHLP3",51,0)
 W !,"  answer NO to the primary diagnosis prompt"
"RTN","PXBHLP3",52,0)
 W !,"  select the new primary diagnosis"
"RTN","PXBHLP3",53,0)
 W !,"  answer YES to the primary diagnosis prompt"
"RTN","PXBHLP3",54,0)
 Q
"RTN","PXBHLP3",55,0)
D ;;3
"RTN","PXBHLP3",56,0)
 W !,"To ",IOINHI,"DELETE",IOINLOW," a DIAGNOSIS enter one of the following:"
"RTN","PXBHLP3",57,0)
 W !,"  an '@' followed by the ITEM NUMBER (e.g. @1 or @3)"
"RTN","PXBHLP3",58,0)
 W !,"  Multiple ITEM NUMBERS can be selected (e.g. @1,3,5 or @1-3,6,9)"
"RTN","PXBHLP3",59,0)
 Q
"RTN","PXBHLP3",60,0)
PROMPT ;---Prompt for the help prompt
"RTN","PXBHLP3",61,0)
 N DIR,OK,POSS
"RTN","PXBHLP3",62,0)
 D WIN17^PXBCC(PXBCNT)
"RTN","PXBHLP3",63,0)
 W !!,"Enter '^' to leave HELP CENTER"
"RTN","PXBHLP3",64,0)
 W !,"Enter a letter or number for additional help: "
"RTN","PXBHLP3",65,0)
 R Y:DTIME
"RTN","PXBHLP3",66,0)
 S POSS="aAdDeE1234^" I POSS[Y,$L(Y)=1!(Y="") S TAG=Y
"RTN","PXBHLP3",67,0)
 S TAG=$TR(TAG,"aed","AED")
"RTN","PXBHLP3",68,0)
 I POSS'[Y!($L(Y)>1) S TAG="BODY"
"RTN","PXBHLP3",69,0)
 ;
"RTN","PXBHLP3",70,0)
 ;
"RTN","PXBHLP3",71,0)
 Q
"RTN","PXBHLP3",72,0)
ROUTINE ;---routine executed when selection lists are selected
"RTN","PXBHLP3",73,0)
 ;W !,"ROUTINES FOR SELECTION LISTS"
"RTN","PXBHLP3",74,0)
1 ;;10
"RTN","PXBHLP3",75,0)
 S (Y,DATA,EDATA,UDATA)=$$DOUBLE^PXBGPOV2(WHAT)
"RTN","PXBHLP3",76,0)
 Q
"RTN","PXBHLP3",77,0)
2 ;;10
"RTN","PXBHLP3",78,0)
 S (FPL,PXBSPL)="" S (Y,DATA,EDATA,UDATA)=$P($P($$DOUBLE1^PXBGPL2(WHAT),"^",2)," ",1)
"RTN","PXBHLP3",79,0)
 Q
"RTN","PXBHLP3",80,0)
3 ;;10
"RTN","PXBHLP3",81,0)
 S (Y,DATA,EDATA,UDATA)=$$DOUBLE1^PXBGPOV3(WHAT)
"RTN","PXBHLP3",82,0)
 Q
"RTN","PXBHLP3",83,0)
4 ;;10
"RTN","PXBHLP3",84,0)
 S (Y,DATA,EDATA,UDATA)=$$DOUBLE1^PXBGPOV4(WHAT)
"RTN","PXBHLP3",85,0)
 Q
"RTN","PXBPCPT")
0^19^B52397890^B50760397
"RTN","PXBPCPT",1,0)
PXBPCPT ;ISL/JVS,ESW - PROMPT CPT ;3/18/05 12:55pm
"RTN","PXBPCPT",2,0)
 ;;1.0;PCE PATIENT CARE ENCOUNTER;**11,73,89,112,121,132,149,124,190,199**;Aug 12, 1996;Build 51
"RTN","PXBPCPT",3,0)
 ;
"RTN","PXBPCPT",4,0)
 ;
"RTN","PXBPCPT",5,0)
 ;
"RTN","PXBPCPT",6,0)
CPT ;--CPT CODE
"RTN","PXBPCPT",7,0)
 ;SELINE=LINE NUMBER OF SELECTED ITEM
"RTN","PXBPCPT",8,0)
 N BAD,CPT,DIC,DOUBLEQQ,EDATA,I,LINE,NF,OK,PXBUT,PXDXDATE,PXEDIT,Q
"RTN","PXBPCPT",9,0)
 N SELINE,TIMED,X,XFLAG,Y
"RTN","PXBPCPT",10,0)
 I $G(IDATE)="" S IDATE=+^AUPNVSIT(PXBVST,0) ; PXBVST defined in PXBMCPT2
"RTN","PXBPCPT",11,0)
 S PXDXDATE=$$CSDATE^PXDXUTL(PXBVST) ; PXDXDATE for use with diagnosis only
"RTN","PXBPCPT",12,0)
 I '$D(^DISV(DUZ,"PXBCPT-1")) S ^DISV(DUZ,"PXBCPT-1")=" "
"RTN","PXBPCPT",13,0)
 I '$D(IOSC) D TERM^PXBCC
"RTN","PXBPCPT",14,0)
 S DOUBLEQQ=0,PXEDIT=""
"RTN","PXBPCPT",15,0)
 S TIMED="I '$T!(DATA[""^"")!(DATA="""")"
"RTN","PXBPCPT",16,0)
 S DIC("S")="I $$CPTSCREN^PXBUTL(Y,IDATE)"
"RTN","PXBPCPT",17,0)
C ;--SECOND ENTRY POINT
"RTN","PXBPCPT",18,0)
 W IOSC
"RTN","PXBPCPT",19,0)
 ;---DYNAMIC  HEADER-----------------
"RTN","PXBPCPT",20,0)
 I '$D(CYCL) D
"RTN","PXBPCPT",21,0)
 .I PXBCNT=0,DOUBLEQQ=0 D LOC^PXBCC(2,10) W IOUON,"...There are "_$G(PXBCNT)_" PROCEDURES associated with this encounter.",IOUOFF,IOELEOL
"RTN","PXBPCPT",22,0)
 .I PXBCNT=1,DOUBLEQQ=0 D LOC^PXBCC(2,10) W IOUON,"...There is "_$G(PXBCNT)_" PROCEDURE associated with this encounter.",IOUOFF,IOELEOL
"RTN","PXBPCPT",23,0)
 .I PXBCNT>1,DOUBLEQQ=0 D LOC^PXBCC(2,10) W IOUON,"...There are "_$G(PXBCNT)_" PROCEDURES associated with this encounter.",IOUOFF,IOELEOL
"RTN","PXBPCPT",24,0)
 ;
"RTN","PXBPCPT",25,0)
 D LOC^PXBCC(15,0)
"RTN","PXBPCPT",26,0)
 ;I PXBCNT>30 
"RTN","PXBPCPT",27,0)
 ;W IOCUU,IOELEOL,
"RTN","PXBPCPT",28,0)
 W:PXTLNS>10 !,"Enter '+' for next page, '-' for last page." ;,IORC
"RTN","PXBPCPT",29,0)
 D WIN17^PXBCC(PXBCNT)
"RTN","PXBPCPT",30,0)
 I '$D(^TMP("PXK",$J,"CPT")) W !,"Enter PROCEDURE (CPT CODE): "
"RTN","PXBPCPT",31,0)
 I $D(^TMP("PXK",$J,"CPT")) W !,"Enter ",IOINHI,"NEXT",IOINLOW," PROCEDURE (CPT CODE): "
"RTN","PXBPCPT",32,0)
 W IOELEOL R DATA:DTIME S EDATA=DATA
"RTN","PXBPCPT",33,0)
C1 ;----Third entry point
"RTN","PXBPCPT",34,0)
 X TIMED I  S PXBUT=1 S:DATA="^^" PXBEXIT=0 S:DATA="^^^" PXBRRR="" G CPTX
"RTN","PXBPCPT",35,0)
 I DATA?1.N1"E".NAP S DATA=" "_DATA
"RTN","PXBPCPT",36,0)
 I $L(DATA)>200 S (DATA,EDATA)=$E(DATA,1,199)
"RTN","PXBPCPT",37,0)
 I DATA?24.N S (DATA,EDATA)=$E(DATA,1,24)
"RTN","PXBPCPT",38,0)
 ; ----- Check & remove control character PX*190 -----
"RTN","PXBPCPT",39,0)
 S ZZDATA=""
"RTN","PXBPCPT",40,0)
 S ZDATA="" F J=1:1:$L(DATA) S ZDATA=$E(DATA,J)  D
"RTN","PXBPCPT",41,0)
 .I $A(ZDATA)>31,($A(ZDATA)'=127) S ZZDATA=ZZDATA_ZDATA
"RTN","PXBPCPT",42,0)
 I $L(ZZDATA)=0 W $C(7),"??" D HELP^PXBUTL0("CPTM") G C
"RTN","PXBPCPT",43,0)
 S (DATA,EDATA)=ZZDATA
"RTN","PXBPCPT",44,0)
 K ZZDATA,ZDATA,J
"RTN","PXBPCPT",45,0)
 ; 
"RTN","PXBPCPT",46,0)
 D CASE^PXBUTL
"RTN","PXBPCPT",47,0)
 ;----SPACE BAR---
"RTN","PXBPCPT",48,0)
 I DATA=" ",$D(^DISV(DUZ,"PXBCPT-1")) S DATA=^DISV(DUZ,"PXBCPT-1") W DATA
"RTN","PXBPCPT",49,0)
 ;---------------
"RTN","PXBPCPT",50,0)
 I DATA["^P" G CPTX
"RTN","PXBPCPT",51,0)
 I DATA["^C" G CPTX
"RTN","PXBPCPT",52,0)
 ;
"RTN","PXBPCPT",53,0)
 I ((DATA="+")!(DATA="-")) D DISCPT4^PXBDCPT(DATA) G C
"RTN","PXBPCPT",54,0)
 ;
"RTN","PXBPCPT",55,0)
M ;--------If Multiple entries have been entered
"RTN","PXBPCPT",56,0)
 D ADDM^PXBPCPT1
"RTN","PXBPCPT",57,0)
 I $G(NF) G C1
"RTN","PXBPCPT",58,0)
 ;
"RTN","PXBPCPT",59,0)
DEL ;--------If Multiple deleting
"RTN","PXBPCPT",60,0)
 D DELM^PXBPCPT1
"RTN","PXBPCPT",61,0)
 I DATA["^C" G CPTX
"RTN","PXBPCPT",62,0)
 I $G(NF) G C1
"RTN","PXBPCPT",63,0)
 ;
"RTN","PXBPCPT",64,0)
 D MOD
"RTN","PXBPCPT",65,0)
 ;
"RTN","PXBPCPT",66,0)
LI ;--------If picked a line number display 
"RTN","PXBPCPT",67,0)
 ;
"RTN","PXBPCPT",68,0)
 I (DATA>0)&(DATA<(PXBCNT+1))&($L(DATA)'>$L(PXBCNT)) D
"RTN","PXBPCPT",69,0)
 .S XFLAG=1
"RTN","PXBPCPT",70,0)
 .D DISCPT4^PXBDCPT(PXBSAM(DATA,"LINE"))
"RTN","PXBPCPT",71,0)
 .D REVCPT^PXBCC(DATA,1)
"RTN","PXBPCPT",72,0)
 .S SELINE=DATA
"RTN","PXBPCPT",73,0)
 .F I=1:1:$L(DATA) W IOCUB,IOECH
"RTN","PXBPCPT",74,0)
 .S CPTQUA=$P($G(PXBSAM(DATA)),"^",2)
"RTN","PXBPCPT",75,0)
 .S DATA=$P($G(PXBSAM(DATA)),"^",1)
"RTN","PXBPCPT",76,0)
 .;I $G(Q)'>1 W DATA
"RTN","PXBPCPT",77,0)
 I $D(XFLAG),XFLAG=1 S Y=DATA G FIN
"RTN","PXBPCPT",78,0)
 ;
"RTN","PXBPCPT",79,0)
 ;
"RTN","PXBPCPT",80,0)
 ;--------If CPT is already in the file
"RTN","PXBPCPT",81,0)
 I $D(PXBKY(DATA)) D  I +PXEDIT<0 S DATA="^C" G C1
"RTN","PXBPCPT",82,0)
 .D DISCPT4^PXBDCPT(PXBSAM($O(PXBKY(DATA,0)),"LINE"))
"RTN","PXBPCPT",83,0)
 .K Q
"RTN","PXBPCPT",84,0)
 .D TIMES^PXBUTL(DATA)
"RTN","PXBPCPT",85,0)
 .S PXEDIT=$$MULTI(DATA) Q:+PXEDIT<0
"RTN","PXBPCPT",86,0)
 .I Q=1 D
"RTN","PXBPCPT",87,0)
 ..S LINE=$O(PXBKY(DATA,0))
"RTN","PXBPCPT",88,0)
 ..S XFLAG=1
"RTN","PXBPCPT",89,0)
 ..Q:PXEDIT="A"
"RTN","PXBPCPT",90,0)
 ..D REVCPT^PXBCC(LINE,1)
"RTN","PXBPCPT",91,0)
 ..S CPTQUA=$P($G(PXBSAM(LINE)),"^",2)
"RTN","PXBPCPT",92,0)
 ..S SELINE=$O(Q(0))
"RTN","PXBPCPT",93,0)
 .I Q>1,PXEDIT="E" D
"RTN","PXBPCPT",94,0)
 ..N PXPG
"RTN","PXBPCPT",95,0)
 ..S NLINE=0
"RTN","PXBPCPT",96,0)
 ..S PXPG=+$G(^TMP("PXBDCPT",$J,"START"))+10
"RTN","PXBPCPT",97,0)
 ..F  S NLINE=$O(Q(NLINE)) Q:NLINE=""  Q:PXBSAM(NLINE,"LINE")>PXPG  D
"RTN","PXBPCPT",98,0)
 ...D REVCPT^PXBCC(NLINE,1)
"RTN","PXBPCPT",99,0)
 I '$G(Q) K SELINE
"RTN","PXBPCPT",100,0)
 I PXEDIT="E",$D(Q),Q>1 D  G:DATA="^C" C1 G LI
"RTN","PXBPCPT",101,0)
 .D WHICH^PXBPWCH S:DATA["^" DATA="^C"
"RTN","PXBPCPT",102,0)
 I $D(XFLAG),XFLAG=1 S Y=DATA G FIN
"RTN","PXBPCPT",103,0)
 ;
"RTN","PXBPCPT",104,0)
 ;--------Need to do a DIC lookup on data
"RTN","PXBPCPT",105,0)
 I DATA'="??" D  G:DATA="^C" C I DATA="?" G C
"RTN","PXBPCPT",106,0)
 .D:DATA="?" EN1^PXBHLP0("PXB","CPT",1,"",1)
"RTN","PXBPCPT",107,0)
 I DATA="??" D  G:UDATA="^C" C1 G FIN
"RTN","PXBPCPT",108,0)
 .S DOUBLEQQ=1
"RTN","PXBPCPT",109,0)
 .D EN1^PXBHLP0("PXB","CPT","",1,2)
"RTN","PXBPCPT",110,0)
 .I $L(DATA,"^")>1 D
"RTN","PXBPCPT",111,0)
 ..S DATA=+$P(DATA,"^",2)_$S($P(DATA,U,3)]"":"-"_$P(DATA,U,3),1:"")
"RTN","PXBPCPT",112,0)
 ..D MOD
"RTN","PXBPCPT",113,0)
 ..S Y=DATA
"RTN","PXBPCPT",114,0)
 .S:$G(UDATA)="" UDATA="^C"
"RTN","PXBPCPT",115,0)
 .S:UDATA="^C" (DATA,EDATA,Y)=UDATA
"RTN","PXBPCPT",116,0)
 ;
"RTN","PXBPCPT",117,0)
 ;--If a "?" is NOT entered during lookup
"RTN","PXBPCPT",118,0)
 S FROM="CPT",(VAL,Y)=$P($P($$DOUBLE1^PXBGCPT2(FROM),"^",2),"--",1)
"RTN","PXBPCPT",119,0)
 S (X,DATA,EDATA)=VAL,DIC=81,DIC(0)="MZ",DIC("S")="I $P($$CPT^ICPTCOD(Y,IDATE),U,7)" D ^DIC
"RTN","PXBPCPT",120,0)
 I Y<1 S DATA="^C" G C1
"RTN","PXBPCPT",121,0)
 ;
"RTN","PXBPCPT",122,0)
 ;--If Y is good and already in file...
"RTN","PXBPCPT",123,0)
 I $D(Y),$D(PXBKY(Y)) W IORC,IOCUU,IOEDEOP,! D
"RTN","PXBPCPT",124,0)
 .D DISCPT4^PXBDCPT($O(PXBKY($P(Y,"^",2),0)))
"RTN","PXBPCPT",125,0)
 .S LINE=$O(PXBKY($P(Y,"^",2),0)) D REVCPT^PXBCC(LINE,1)
"RTN","PXBPCPT",126,0)
 .S CPTQUA=$P($G(PXBSAM(LINE)),"^",2)
"RTN","PXBPCPT",127,0)
 ;
"RTN","PXBPCPT",128,0)
 ;
"RTN","PXBPCPT",129,0)
FIN ;--FINISH CPT
"RTN","PXBPCPT",130,0)
 I $G(SELINE) S $P(REQE,"^",1)=$P($G(PXBSAM(SELINE)),"^",3)
"RTN","PXBPCPT",131,0)
 I $P(REQE,"^",1)="" S $P(REQE,"^",1)="...No Provider Selected..."
"RTN","PXBPCPT",132,0)
 I $L(Y,"^")'>1 S X=Y,DIC=81,DIC(0)="ZM",DIC("S")="I $P($$CPT^ICPTCOD(Y,IDATE),U,7)" D ^DIC
"RTN","PXBPCPT",133,0)
 I Y<0 D HELP^PXBUTL0("CPTM") G C
"RTN","PXBPCPT",134,0)
 S OK=$$CPTOK^PXBUTL(+Y,IDATE) D  G:+OK=0 C
"RTN","PXBPCPT",135,0)
 .I +OK=0 W IOCUF,IOCUF,IORVON,"INACTIVE!--",IORVOFF D HELP1^PXBUTL1("CPTI") ;--HELP
"RTN","PXBPCPT",136,0)
 S CPT=Y(0)
"RTN","PXBPCPT",137,0)
 N PXINF S PXINF=$$CPT^ICPTCOD(+Y,IDATE),$P(CPT,U,2)=$P(PXINF,U,3)
"RTN","PXBPCPT",138,0)
 S ^DISV(DUZ,"PXBCPT-1")=$P(CPT,"^",1)
"RTN","PXBPCPT",139,0)
 I $D(PXBNCPT) S PXBNCPTF=1
"RTN","PXBPCPT",140,0)
 I $D(PXBKY(Y(0,0))),$G(SELINE) D
"RTN","PXBPCPT",141,0)
 .S $P(REQI,"^",8)=$O(PXBSKY(SELINE,0))
"RTN","PXBPCPT",142,0)
 .S PREDOC=$P(PXBSAM(SELINE),"^",3)
"RTN","PXBPCPT",143,0)
 .I $D(PXBPRV($P(REQE,"^",1),$P(CPT,"^",1))) D
"RTN","PXBPCPT",144,0)
 ..Q:$P(REQI,"^",8)]""
"RTN","PXBPCPT",145,0)
 ..S $P(REQI,"^",8)=$O(PXBPRV($P(REQE,"^",1),$P(CPT,"^",1),0))
"RTN","PXBPCPT",146,0)
 .I $D(PXBPRV($P(REQE,"^",1))) D
"RTN","PXBPCPT",147,0)
 ..S CPTQUA=$P(PXBSAM($O(PXBPRV($P(REQE,"^",1),$P(CPT,"^",1),$O(PXBPRV($P(REQE,"^",1),$P(CPT,"^",1),0)),0))),"^",2)
"RTN","PXBPCPT",148,0)
 I $D(PXBKY(Y(0,0))),'$G(SELINE) D
"RTN","PXBPCPT",149,0)
 .;S $P(REQI,"^",8)=$O(PXBSKY($O(PXBKY(Y(0,0),0)),0))
"RTN","PXBPCPT",150,0)
 .S PREDOC=$P(PXBSAM($O(PXBKY(Y(0,0),0))),"^",3)
"RTN","PXBPCPT",151,0)
 .I $D(PXBPRV($P(REQE,"^",1),$P(CPT,"^",1))) D
"RTN","PXBPCPT",152,0)
 ..S $P(REQI,"^",8)=$O(PXBPRV($P(REQE,"^",1),$P(CPT,"^",1),0))
"RTN","PXBPCPT",153,0)
 .I $D(PXBPRV($P(REQE,"^",1),$P(CPT,"^",1))) D
"RTN","PXBPCPT",154,0)
 ..S CPTQUA=$P(PXBSAM($O(PXBPRV($P(REQE,"^",1),$P(CPT,"^",1),$O(PXBPRV($P(REQE,"^",1),$P(CPT,"^",1),0)),0))),"^",2)
"RTN","PXBPCPT",155,0)
 S $P(REQI,"^",3)=+Y
"RTN","PXBPCPT",156,0)
 S $P(REQE,"^",3)=$P(CPT,"^",1)_"-- "_$P(CPT,"^",2)
"RTN","PXBPCPT",157,0)
 S PXBNCPT($P(CPT,"^",1))=$P(REQI,"^",8)
"RTN","PXBPCPT",158,0)
 S:$P(REQI,"^",8)]"" PXBNCPT($P(CPT,"^",1),$P(REQI,"^",8))=""
"RTN","PXBPCPT",159,0)
 ;PX124 adds to REQ*
"RTN","PXBPCPT",160,0)
REST I $P(REQI,U,8) D
"RTN","PXBPCPT",161,0)
 .N CTR,VAL,IEN
"RTN","PXBPCPT",162,0)
 .S IEN=$P(REQI,U,8)
"RTN","PXBPCPT",163,0)
 .S $P(REQI,U,13,19)=$P($G(^AUPNVCPT(IEN,0)),U,9,15)
"RTN","PXBPCPT",164,0)
 .S $P(REQI,U,12)=$P($G(^AUPNVCPT(IEN,0)),U,5)
"RTN","PXBPCPT",165,0)
 .F CTR=12:1:19 D
"RTN","PXBPCPT",166,0)
 ..S VAL=$P(REQI,U,CTR)
"RTN","PXBPCPT",167,0)
 ..S:VAL VAL=$$ICDDATA^ICDXCODE("DIAG",VAL,PXDXDATE,"I"),$P(REQE,U,CTR)=$P($G(VAL),U,2)_" --"_$P($G(VAL),U,4)
"RTN","PXBPCPT",168,0)
 .S VAL=$P($G(^AUPNVCPT(IEN,12)),U,2),$P(REQI,U,22)=VAL
"RTN","PXBPCPT",169,0)
 .S:VAL $P(REQE,U,22)=$P($G(^VA(200,VAL,0)),U,1)
"RTN","PXBPCPT",170,0)
 ;
"RTN","PXBPCPT",171,0)
CPTX ;--CPT Exit and cleanup
"RTN","PXBPCPT",172,0)
 I $P(REQE,"^",1)="" S $P(REQE,"^",1)="...No Provider Selected..."
"RTN","PXBPCPT",173,0)
 I $G(WHAT)="INTV",DATA="^" S PXBEXIT="^^"
"RTN","PXBPCPT",174,0)
 I $D(PXBRRR) S DATA="^"
"RTN","PXBPCPT",175,0)
 I $D(PREDOC) D
"RTN","PXBPCPT",176,0)
 .I PREDOC]""&($P(REQE,"^",1)'[PREDOC) W !,IOINHI,"--WARNING!",IOINLOW," Currently stored Provider of service:-",IOINHI,PREDOC,IOINLOW D
"RTN","PXBPCPT",177,0)
 ..I '$D(PXBPRV($P(REQE,"^",1),$P(CPT,"^",1))) S $P(REQI,"^",8)=""
"RTN","PXBPCPT",178,0)
 K PXBDPRV,PREDOC
"RTN","PXBPCPT",179,0)
 W IOEDEOP
"RTN","PXBPCPT",180,0)
 Q
"RTN","PXBPCPT",181,0)
MOD ;---Separate CPT modifiers from CPT codes in entry string, if entered
"RTN","PXBPCPT",182,0)
 I DATA?1.N1"-".NE D
"RTN","PXBPCPT",183,0)
 .S PXMODSTR=$P(DATA,"-",2)
"RTN","PXBPCPT",184,0)
 .S (DATA,EDATA)=$P(DATA,"-",1)
"RTN","PXBPCPT",185,0)
 Q
"RTN","PXBPCPT",186,0)
 ;
"RTN","PXBPCPT",187,0)
MULTI(CPTCD) ;--Prompt user to Edit existing CPT code or Add as new entry
"RTN","PXBPCPT",188,0)
 ;
"RTN","PXBPCPT",189,0)
 N DIR,DA,X,Y
"RTN","PXBPCPT",190,0)
 S DIR(0)="SB^E:EDIT;A:ADD"
"RTN","PXBPCPT",191,0)
 S DIR("A")="Do you wish to (E)dit or (A)dd"
"RTN","PXBPCPT",192,0)
 ;PX*2.0*132
"RTN","PXBPCPT",193,0)
 I (($E(CPTCD)?1N)&($D(^IBE(357.69,+CPTCD))))!(($E(CPTCD)?1A)&($D(^IBE(357.69,CPTCD)))) D
"RTN","PXBPCPT",194,0)
 .S DIR(0)="SB^E:EDIT",DIR("A")="You may only (E)dit this code, no duplicate E&M codes allowed."
"RTN","PXBPCPT",195,0)
 S DIR("A",1)="CPT "_CPTCD_" already on file for this Encounter"
"RTN","PXBPCPT",196,0)
 D ^DIR
"RTN","PXBPCPT",197,0)
 I Y']""!(Y="^") Q -1
"RTN","PXBPCPT",198,0)
 Q Y
"RTN","PXBPCPT2")
0^20^B10905536^B7116983
"RTN","PXBPCPT2",1,0)
PXBPCPT2 ;WASH/BDB - PROMPT PROCEDURE DIAGNOSES ;10 Jun 2013  1:58 PM
"RTN","PXBPCPT2",2,0)
 ;;1.0;PCE PATIENT CARE ENCOUNTER;**124,170,199**;Aug 12, 1996;Build 51
"RTN","PXBPCPT2",3,0)
 ;
"RTN","PXBPCPT2",4,0)
 Q  ;not an entry
"RTN","PXBPCPT2",5,0)
 ;
"RTN","PXBPCPT2",6,0)
CDX(PXN) ;--Diagnosis for Procedure
"RTN","PXBPCPT2",7,0)
 N CDX,CPTDX,DIC,POS,PXACS,PXC,PXCEAFTR,PXCEVIEN,PXD,PXDISV,PXDXDATE,PXICDDATA,TIMED,VAL,X
"RTN","PXBPCPT2",8,0)
CPT1 K PXBUT,EDATA,LEXVDT
"RTN","PXBPCPT2",9,0)
 S PXDXDATE=$$CSDATE^PXDXUTL(PXBVST)
"RTN","PXBPCPT2",10,0)
 S PXACSREC=$$ACTDT^PXDXUTL(PXDXDATE),PXACS=$P(PXACSREC,U,3)
"RTN","PXBPCPT2",11,0)
 I PXACS["-" S PXACS=$P(PXACS,"-",1,2)
"RTN","PXBPCPT2",12,0)
 S POS=PXN+11,CPTDX=$P($P(REQE,U,POS)," "),PXDISV="PXBCPTDX-"_POS
"RTN","PXBPCPT2",13,0)
 S TIMED="I '$T!(DATA[""^"")",PXD=$P(REQI,U,POS),PXC=$P(REQI,U,3)
"RTN","PXBPCPT2",14,0)
 S DIC("S")="I $P($$ICDDATA^ICDXCODE(""DIAG"",Y,PXDXDATE,""E""),U,10)"
"RTN","PXBPCPT2",15,0)
PCPT1 ;SECOND ENTRY POINT
"RTN","PXBPCPT2",16,0)
 W !," What is ",PXACS," DIAGNOSIS "_PXN_" for this procedure: "_$S($L(CPTDX):CPTDX_"//",1:""),IOELEOL
"RTN","PXBPCPT2",17,0)
 R DATA:DTIME S:DATA="" DATA=CPTDX S EDATA=DATA G:DATA="" CDXX1
"RTN","PXBPCPT2",18,0)
P1CPT1 ;--
"RTN","PXBPCPT2",19,0)
 X TIMED I  S PXBUT=1,LEAVE=1 G CDXX1
"RTN","PXBPCPT2",20,0)
 I DATA="^D" G CDXX1
"RTN","PXBPCPT2",21,0)
 I DATA="^"!(DATA="^^") S PXBEXIT=0 G CDXX1
"RTN","PXBPCPT2",22,0)
 I DATA="@",'$G(PXD) S DATA="?"
"RTN","PXBPCPT2",23,0)
 I DATA="@" K PXBREQ(PXD) S $P(REQI,U,POS)="@" G CDXX1
"RTN","PXBPCPT2",24,0)
 ;I DATA="",PXN=1 W !,"PRIMARY DIAGNOSIS IS REQUIRED!" G CPT1
"RTN","PXBPCPT2",25,0)
 I DATA="?" D EN1^PXBHLP0("PXB","POV",1,"",1) G CPT1
"RTN","PXBPCPT2",26,0)
 ;I DATA="??" S DOUBLEQQ=1 D EN1^PXBHLP0("PXB","POV",1,"",2) S:$L(DATA,"^")>1 (Y,DATA,EDATA)=$P($P(DATA,"^",2),"--",1) G:Y>1 PFINCPT1 G:Y?1A1.NP PFINCPT1
"RTN","PXBPCPT2",27,0)
 I DATA="??" D EN1^PXBHLP0("PXB","POV",1,"",2) G CPT1
"RTN","PXBPCPT2",28,0)
 I $L(DATA)>200 S (DATA,EDATA)=$E(DATA,1,199)
"RTN","PXBPCPT2",29,0)
 ;---SPACE BAR---
"RTN","PXBPCPT2",30,0)
 I DATA=" ",$D(^DISV(DUZ,PXDISV)) S (DATA,EDATA)=^DISV(DUZ,PXDISV) W DATA
"RTN","PXBPCPT2",31,0)
 I DATA=" " S (DATA,EDATA)="" G CDXX1
"RTN","PXBPCPT2",32,0)
 ;-----
"RTN","PXBPCPT2",33,0)
 ;--Do a DIC lookup on data if a "?" is NOT entered
"RTN","PXBPCPT2",34,0)
 D CLEAR^VALM1,FULL^VALM1  ; added in *199 to allow full scrolling of long lists
"RTN","PXBPCPT2",35,0)
 W "Searching for diagnosis codes...",! ; added in *199
"RTN","PXBPCPT2",36,0)
 K X,DIC
"RTN","PXBPCPT2",37,0)
 S X=EDATA
"RTN","PXBPCPT2",38,0)
 I $P(PXACSREC,U,1)'="ICD" D
"RTN","PXBPCPT2",39,0)
 . S PXDATE=PXDXDATE,PXDEF=$G(X),PXAGAIN=0 D ^PXDSLK I PXXX=-1 S Y=-1 Q
"RTN","PXBPCPT2",40,0)
 . S Y($P(PXACSREC,U,2))=$P($P(PXXX,U,1),";",2)
"RTN","PXBPCPT2",41,0)
 . S Y=$P(PXXX,";",1)_U_$P(PXXX,U,2)
"RTN","PXBPCPT2",42,0)
 I $P(PXACSREC,U,1)="ICD" D
"RTN","PXBPCPT2",43,0)
 . D CONFIG^LEXSET($P(PXACSREC,U,1),,PXDXDATE)
"RTN","PXBPCPT2",44,0)
 . S DIC("A")="Select "_PXACS_" Diagnosis: "
"RTN","PXBPCPT2",45,0)
 . S DIC="^LEX(757.01,",DIC(0)=$S('$L(X):"A",1:"")_"EQM"
"RTN","PXBPCPT2",46,0)
 . D ^DIC
"RTN","PXBPCPT2",47,0)
 I $G(X)="@" Q
"RTN","PXBPCPT2",48,0)
 I Y=-1 S DATA="^P" G P1CPT1
"RTN","PXBPCPT2",49,0)
 S WHAT=$G(Y($P(PXACSREC,U,2)))
"RTN","PXBPCPT2",50,0)
 S (DATA,EDATA)=WHAT K Y
"RTN","PXBPCPT2",51,0)
 S PXICDDATA=$$ICDDATA^ICDXCODE("DIAG",WHAT,PXDXDATE,"E")
"RTN","PXBPCPT2",52,0)
 S Y=$S($P(PXICDDATA,U,10)=0:-1,1:$P(PXICDDATA,U,1,2))
"RTN","PXBPCPT2",53,0)
 S Y(0)=$P(PXICDDATA,U,2,99)
"RTN","PXBPCPT2",54,0)
 ;
"RTN","PXBPCPT2",55,0)
PFINCPT1 ;--Finish DIAGNOSIS
"RTN","PXBPCPT2",56,0)
 I $L(Y,U)'>1 S X=Y,DIC=80,DIC(0)="IZM" D ^DIC
"RTN","PXBPCPT2",57,0)
 I +Y<0 D HELP1^PXBUTL1("POV") G CPT1
"RTN","PXBPCPT2",58,0)
 I $$DUP(+Y) W !,$P(Y,U,2)," IS ALREADY A DIAGNOSIS!" G PCPT1
"RTN","PXBPCPT2",59,0)
 S CDX=Y(0),^DISV(DUZ,PXDISV)=DATA,$P(REQI,U,POS)=+Y
"RTN","PXBPCPT2",60,0)
 S $P(REQE,U,POS)=$P(CDX,U,1)_" --"_$P(CDX,U,3)
"RTN","PXBPCPT2",61,0)
 I $D(PXBREQ(+Y,"I")) G CDXX1
"RTN","PXBPCPT2",62,0)
 I 'PXBDXPRI D
"RTN","PXBPCPT2",63,0)
 .D PRI^PXBPPOV1 ;PRI/SEC
"RTN","PXBPCPT2",64,0)
 .I '$D(DIRUT),$P(REQI,U,6)="P" S PXBDXPRI=+Y
"RTN","PXBPCPT2",65,0)
 S PXCEVIEN=PXBVST,PXDX=Y
"RTN","PXBPCPT2",66,0)
 D WIN17^PXBCC(PXBCNT),GET800^PXCEC800 ;CI's
"RTN","PXBPCPT2",67,0)
 I $G(PXCEQUIT) S $P(REQE,U,POS)=""
"RTN","PXBPCPT2",68,0)
 I '$G(PXCEQUIT) S PXBREQ(+PXDX,"I")=PXCEAFTR(800)
"RTN","PXBPCPT2",69,0)
 I '$G(PXCEQUIT) D EN0^PXBSTOR(PXBVST,PATIENT,REQI,.PXMREQ),EN1^PXKMAIN
"RTN","PXBPCPT2",70,0)
CDXX1 ;--EXIT AND CLEAN UP
"RTN","PXBPCPT2",71,0)
 I '$D(REQE) S REQE=""
"RTN","PXBPCPT2",72,0)
 I $P(REQE,U,POS)="" S $P(REQI,U,POS)=""
"RTN","PXBPCPT2",73,0)
 D CLEAR^VALM1 S VALMBCK="R"
"RTN","PXBPCPT2",74,0)
 Q
"RTN","PXBPCPT2",75,0)
 ;
"RTN","PXBPCPT2",76,0)
DUP(CD) ;DUPLICATE?
"RTN","PXBPCPT2",77,0)
 N ANS,CTR
"RTN","PXBPCPT2",78,0)
 S ANS=0
"RTN","PXBPCPT2",79,0)
 F CTR=12:1:19 I CTR'=POS,$P(REQI,U,CTR)=CD S ANS=1 Q
"RTN","PXBPCPT2",80,0)
 Q ANS
"RTN","PXBPCPT2",81,0)
 ;
"RTN","PXBPL")
0^21^B25222448^B19131975
"RTN","PXBPL",1,0)
PXBPL ;ISL/JVS - ADD DIAGNOSIS TO PROBLEM LIST ;17 Jul 2013  11:21 AM
"RTN","PXBPL",2,0)
 ;;1.0;PCE PATIENT CARE ENCOUNTER;**11,94,115,130,168,199**;Aug 12, 1996;Build 51
"RTN","PXBPL",3,0)
 ;
"RTN","PXBPL",4,0)
 ;
"RTN","PXBPL",5,0)
 ;
"RTN","PXBPL",6,0)
 W !,"THIS IS NOT AN ENTRY POINT" Q
"RTN","PXBPL",7,0)
SET ;--SETUP AND NEW VARIABLES
"RTN","PXBPL",8,0)
 N OK,PXBPL,PXPRVLIN,FLAG,DATA,ICDCODE
"RTN","PXBPL",9,0)
 S PXPRVLIN=18 D WIN17^PXBCC(PXBCNT)
"RTN","PXBPL",10,0)
 I '$G(NOPLLIST) Q
"RTN","PXBPL",11,0)
PRMPT ;--Ask if you want to put entries in PL
"RTN","PXBPL",12,0)
 D LOC^PXBCC(17,0) S DIR(0)="Y,A,O"
"RTN","PXBPL",13,0)
 S DIR("B")="NO"
"RTN","PXBPL",14,0)
 I PXBCNT'>1 S DIR("A")="Would you like to add this Diagnosis to the Problem List? "
"RTN","PXBPL",15,0)
 I PXBCNT>1 S DIR("A")="Would you like to add any Diagnoses to the Problem List? "
"RTN","PXBPL",16,0)
 D ^DIR K DIR
"RTN","PXBPL",17,0)
 I Y=0!(Y="^")!(Y="") Q
"RTN","PXBPL",18,0)
SELECT ;--Select entries for PL
"RTN","PXBPL",19,0)
 W !
"RTN","PXBPL",20,0)
 I PXBCNT'>1 S OK=1
"RTN","PXBPL",21,0)
 I PXBCNT>1 S PXPRVLIN=PXPRVLIN+2 W !,"Select 1 or several Diagnoses (e.g. 1,3,4,7,3-6,2-5): " R OK:DTIME
"RTN","PXBPL",22,0)
 I OK?1.N1"E".NAP S OK=" "_OK
"RTN","PXBPL",23,0)
 I OK?24.N S OK=$E(OK,1,24)
"RTN","PXBPL",24,0)
 ;
"RTN","PXBPL",25,0)
 ;
"RTN","PXBPL",26,0)
 I OK["-" D
"RTN","PXBPL",27,0)
 .N PIECE,PXBI,PXBJ,PXBK
"RTN","PXBPL",28,0)
 .S PIECE="" F PXBI=1:1:$L(OK,",") S PIECE=$P(OK,",",PXBI) I PIECE["-" D
"RTN","PXBPL",29,0)
 ..S PXBJ=0 F PXBJ=$P(PIECE,"-",1):1:$P(PIECE,"-",2) S PXBK=","_PXBJ,OK=OK_PXBK
"RTN","PXBPL",30,0)
 ;
"RTN","PXBPL",31,0)
 ;
"RTN","PXBPL",32,0)
 ;
"RTN","PXBPL",33,0)
 S PXBLEN=0
"RTN","PXBPL",34,0)
 I OK["?" W !,"Enter the ITEM numbers of the entries you wish to add to the PROBLEM LIST." S PXPRVLIN=PXPRVLIN+1 G SELECT
"RTN","PXBPL",35,0)
 ;----SPACE BAR---------
"RTN","PXBPL",36,0)
 I OK'=" ",OK'["^",OK'="" S ^DISV(DUZ,"PXBPL-2")=OK
"RTN","PXBPL",37,0)
 I OK=" ",$D(^DISV(DUZ,"PXBPL-2")) S OK=^DISV(DUZ,"PXBPL-2") W OK
"RTN","PXBPL",38,0)
 ;-----------------------
"RTN","PXBPL",39,0)
 S PXBLEN=$L(OK,",") F PXI=1:1:PXBLEN S PXBPIECE=$P(OK,",",PXI) D
"RTN","PXBPL",40,0)
 .Q:PXBPIECE=""
"RTN","PXBPL",41,0)
 .I $D(PXBSAM(PXBPIECE)) D
"RTN","PXBPL",42,0)
 ..I PXBCNT>10 D DPOV4^PXBDPOV(PXBSAM(PXBPIECE,"LINE"))
"RTN","PXBPL",43,0)
 ..S FLAG=1
"RTN","PXBPL",44,0)
 ..D REVPOV^PXBPPOV(PXBPIECE)
"RTN","PXBPL",45,0)
 I '$G(FLAG) S DIR(0)="Y^AO",DIR("B")="NO",DIR("A")="INVALID entry. Would you like to try again" D ^DIR K DIR I Y=1 K Y S PXPRVLIN=PXPRVLIN+1 G SELECT
"RTN","PXBPL",46,0)
PRV ;--Ask for provider
"RTN","PXBPL",47,0)
 I '$G(FLAG) Q
"RTN","PXBPL",48,0)
 S FROM="PL" K PXBCNT D PRV^PXBGPRV(PXBVST,,,,.PXBCNT)
"RTN","PXBPL",49,0)
 N PXBLANKS S $P(PXBLANKS," ",65)=""
"RTN","PXBPL",50,0)
 D LOC^PXBCC(1,10) W PXBLANKS D LOC^PXBCC(PXPRVLIN,0)
"RTN","PXBPL",51,0)
R K ERROR S FROM="PL" D PRV^PXBPPRV G:$G(ERROR) R W IOEDEOP
"RTN","PXBPL",52,0)
 I DATA["^P" D LOC^PXBCC(3,0),EN0^PXBDPRV,LOC^PXBCC(15,0) G PRV
"RTN","PXBPL",53,0)
 D POV^PXBGPOV(PXBVST)
"RTN","PXBPL",54,0)
LOOP ;--Loop through diagnoses
"RTN","PXBPL",55,0)
 S PXBLEN=$L(OK,",") F PXI=1:1:PXBLEN S PXBPIECE=$P(OK,",",PXI) D
"RTN","PXBPL",56,0)
 .I PXBPIECE="" Q
"RTN","PXBPL",57,0)
 .I $D(PXBSAM(PXBPIECE)) D
"RTN","PXBPL",58,0)
 ..S PXBPL("PATIENT")=PATIENT
"RTN","PXBPL",59,0)
 ..S PXBPL("NARRATIVE")=$P($G(PXBSAM(PXBPIECE)),"^",3)
"RTN","PXBPL",60,0)
 ..S PXBPL("PROVIDER")=$P(REQI,"^",1)
"RTN","PXBPL",61,0)
 ..S PXBPL("DIAGNOSIS")=+^AUPNVPOV($O(PXBSKY(PXBPIECE,0)),0)
"RTN","PXBPL",62,0)
 ..S PXBPL("LOCATION")=$P(^AUPNVSIT(PXBVST,0),"^",22)
"RTN","PXBPL",63,0)
 ..;PRH - PX*1*115 - Set up Service Conditions
"RTN","PXBPL",64,0)
 ..N PXSCSTR,PXII,PXTYP
"RTN","PXBPL",65,0)
 ..S PXSCSTR="SC^AO^IR^EC^MST^HNC^CV^SHAD"
"RTN","PXBPL",66,0)
 ..F PXII=1:1:8 D
"RTN","PXBPL",67,0)
 ...S PXTYP=$P(PXSCSTR,"^",PXII)
"RTN","PXBPL",68,0)
 ...S PXBPL(PXTYP)=$P($G(^AUPNVSIT(PXBVST,800)),"^",PXII)
"RTN","PXBPL",69,0)
 ..S ICDCODE="",ICDCODE=$P($G(PXBSAM(PXBPIECE)),"^",1)
"RTN","PXBPL",70,0)
 ..I ICDCODE'="" D  ; Get Lexicon entry for ICD Code
"RTN","PXBPL",71,0)
 ...S PXVDATE=$$CSDATE^PXDXUTL(PXBVST)  ; $P(+^AUPNVSIT(PXBVST,0),".",1)
"RTN","PXBPL",72,0)
 ...KILL LEXS D EN^LEXCODE(ICDCODE,PXVDATE)
"RTN","PXBPL",73,0)
 ...S PXACSREC=$$ACTDT^PXDXUTL(PXVDATE),PXACSID=$P(PXACSREC,U,1)
"RTN","PXBPL",74,0)
 ...I $G(LEXS(PXACSID,0))>0 S PXBPL("LEXICON")=$P($G(LEXS(PXACSID,1)),"^",1)
"RTN","PXBPL",75,0)
 ..S PXBPL("DX_DATE_OF_INTEREST")=$$CSDATE^PXDXUTL(PXBVST)
"RTN","PXBPL",76,0)
 ..D CREATE^GMPLUTL(.PXBPL,.PXBRES)
"RTN","PXBPL",77,0)
 ..D PR
"RTN","PXBPL",78,0)
 K NOPLLIST,PXVDATE,PXACSREC,PXACSID
"RTN","PXBPL",79,0)
 Q
"RTN","PXBPL",80,0)
SEND ;--Entry point to send data to problem list
"RTN","PXBPL",81,0)
 N PXBPL,OK,ICDCODE,PXVDATE,PXACSREC,PXACSID
"RTN","PXBPL",82,0)
 I '$D(IORVON) D TERM^PXBCC
"RTN","PXBPL",83,0)
 S PXBPL("PATIENT")=PATIENT
"RTN","PXBPL",84,0)
 S PXBPL("NARRATIVE")=PXBSAM($O(PXBKY($P($P(REQE,"^",5)," ",1),0)),"LNARR")
"RTN","PXBPL",85,0)
 S PXBPL("PROVIDER")=$P(REQI,"^",1)
"RTN","PXBPL",86,0)
 S PXBPL("DIAGNOSIS")=$P(REQI,"^",5)
"RTN","PXBPL",87,0)
 S PXBPL("LOCATION")=$P(^AUPNVSIT(PXBVST,0),"^",22)
"RTN","PXBPL",88,0)
 ;PRH - PX*1*115 - Set up Service Conditions
"RTN","PXBPL",89,0)
 N PXSCSTR,PXII,PXTYP
"RTN","PXBPL",90,0)
 S PXSCSTR="SC^AO^IR^EC^MST^HNC^CV^SHAD"
"RTN","PXBPL",91,0)
 F PXII=1:1:6 D
"RTN","PXBPL",92,0)
 . S PXTYP=$P(PXSCSTR,"^",PXII)
"RTN","PXBPL",93,0)
 . S PXBPL(PXTYP)=$P($G(^AUPNVSIT(PXBVST,800)),"^",PXII)
"RTN","PXBPL",94,0)
 S ICDCODE="",ICDCODE=$P($G(PXBSAM($O(PXBKY($P($P(REQE,"^",5)," ",1),0)))),"^",1)
"RTN","PXBPL",95,0)
 I ICDCODE'="" D  ; Get Lexicon entry for ICD Code
"RTN","PXBPL",96,0)
 .S PXVDATE=$$CSDATE^PXDXUTL(PXBVST)  ; $P(+^AUPNVSIT(PXBVST,0),".",1)
"RTN","PXBPL",97,0)
 .KILL LEXS D EN^LEXCODE(ICDCODE,PXVDATE)
"RTN","PXBPL",98,0)
 .S PXACSREC=$$ACTDT^PXDXUTL(PXVDATE),PXACSID=$P(PXACSREC,U,1)
"RTN","PXBPL",99,0)
 .I $G(LEXS(PXACSID,0))>0 S PXBPL("LEXICON")=$P($G(LEXS(PXACSID,1)),"^",1)
"RTN","PXBPL",100,0)
 S PXBPL("DX_DATE_OF_INTEREST")=$$CSDATE^PXDXUTL(PXBVST)
"RTN","PXBPL",101,0)
 D CREATE^GMPLUTL(.PXBPL,.PXBRES)
"RTN","PXBPL",102,0)
PR ;
"RTN","PXBPL",103,0)
 I PXBRES<0 D  Q  ;'Q'uit added for PX*1*115
"RTN","PXBPL",104,0)
 .W !,IORVON,"--WARNING-Problem NOT Created because: ",PXBRES(0),IORVOFF
"RTN","PXBPL",105,0)
 .D HELP1^PXBUTL1("CON") R OK:DTIME
"RTN","PXBPL",106,0)
 ;
"RTN","PXBPL",107,0)
 ;PX*1*115 - Add Problem File Pointer to V POV file
"RTN","PXBPL",108,0)
 I PXBRES>0 D
"RTN","PXBPL",109,0)
 . N DA,DIE,DR,PXBPLARR,PXBPLERR,PXBPLPOV
"RTN","PXBPL",110,0)
 . S DA=$O(PXBSKY(PXBPIECE,0))
"RTN","PXBPL",111,0)
 . S PXBPLPOV=9000010.07
"RTN","PXBPL",112,0)
 . K PXBPLARR,PXBPLERR
"RTN","PXBPL",113,0)
 . D GETS^DIQ(PXBPLPOV,(DA_","),.16,"I","PXBPLARR","PXBPLERR")
"RTN","PXBPL",114,0)
 . Q:$D(PXBPLERR)
"RTN","PXBPL",115,0)
 . I $L($G(PXBPLARR(PXBPLPOV,(DA_","),.16,"I"))) Q
"RTN","PXBPL",116,0)
 . ;
"RTN","PXBPL",117,0)
 . S DIE="^AUPNVPOV(",DR=".16////"_PXBRES
"RTN","PXBPL",118,0)
 . D ^DIE
"RTN","PXBPL",119,0)
 ;
"RTN","PXBPL",120,0)
 Q
"RTN","PXBPPOV")
0^22^B34159394^B22074119
"RTN","PXBPPOV",1,0)
PXBPPOV ;ISL/JVS - PROMPT POV ;24 Sep 2013  11:19 AM
"RTN","PXBPPOV",2,0)
 ;;1.0;PCE PATIENT CARE ENCOUNTER;**11,28,92,121,149,124,170,182,199**;Aug 12, 1996;Build 51
"RTN","PXBPPOV",3,0)
 ;
"RTN","PXBPPOV",4,0)
 ; VARIABLE LIST
"RTN","PXBPPOV",5,0)
 ; SELINE= Line number of selected item
"RTN","PXBPPOV",6,0)
 ;
"RTN","PXBPPOV",7,0)
POV ;--DIAGNOSIS
"RTN","PXBPPOV",8,0)
 N PXACS,PXACSREC,PXDXDATE,PXICDDATA,PXICDROW
"RTN","PXBPPOV",9,0)
 S PXICDROW=15
"RTN","PXBPPOV",10,0)
 S PXDXDATE=$$CSDATE^PXDXUTL(PXBVST)
"RTN","PXBPPOV",11,0)
 S PXACSREC=$$ACTDT^PXDXUTL(PXDXDATE),PXACS=$P(PXACSREC,U,3)
"RTN","PXBPPOV",12,0)
 I PXACS["-" S PXACS=$P(PXACS,"-",1,2)
"RTN","PXBPPOV",13,0)
 I $D(PXBNPOVL) D LOC^PXBCC(2,0) W IOUON,"Previous Entry:   ",$G(PXBNPOVL(1)) F I=1:1:10 W " "
"RTN","PXBPPOV",14,0)
 W IOUOFF
"RTN","PXBPPOV",15,0)
 N CNT,DIC,EDATA,FPL,LINE,PXBEDIS,SELINE,TIMED,XFLAG
"RTN","PXBPPOV",16,0)
 I '$D(^DISV(DUZ,"PXBPOV-3")) S ^DISV(DUZ,"PXBPOV-3")="   "
"RTN","PXBPPOV",17,0)
 I '$D(IOSC) D TERM^PXBCC
"RTN","PXBPPOV",18,0)
 S DOUBLEQQ=0
"RTN","PXBPPOV",19,0)
 S TIMED="I '$T!(DATA=""^"")"
"RTN","PXBPPOV",20,0)
 S DIC("S")="I $P($$ICDDATA^ICDXCODE(""DIAG"",Y,PXDXDATE,""E""),U,10)"
"RTN","PXBPPOV",21,0)
P ;--Second Entry point
"RTN","PXBPPOV",22,0)
 W IOSC K FPL,EDATA,DATA
"RTN","PXBPPOV",23,0)
 ;---DYNAMIC HEADER---
"RTN","PXBPPOV",24,0)
 I '$D(CYCL) D
"RTN","PXBPPOV",25,0)
 .S CNT=+$O(PXBSAM(""),-1)
"RTN","PXBPPOV",26,0)
 .I CNT=0,DOUBLEQQ=0 D LOC^PXBCC(1,10) W "...There are 0 ",PXACS," CODES associated with this encounter."
"RTN","PXBPPOV",27,0)
 .I CNT=1,DOUBLEQQ=0 D LOC^PXBCC(1,10) W "...There is 1 ",PXACS," CODE associated with this encounter."
"RTN","PXBPPOV",28,0)
 .I CNT>1,DOUBLEQQ=0 D LOC^PXBCC(1,10) W "...There are ",CNT," ",PXACS," CODES associated with this encounter."
"RTN","PXBPPOV",29,0)
 D LOC^PXBCC(PXICDROW,0)
"RTN","PXBPPOV",30,0)
 I PXBCNT>10&('$G(DOUBLEQQ)) W !,"Enter '+' for next page, '-' for previous page."
"RTN","PXBPPOV",31,0)
 I '$D(^TMP("PXK",$J,"POV")) W !,"Enter ",PXACS," Diagnosis : ",$G(PXBDPOV) W:$D(PXBDPOV) " //" W IOELEOL
"RTN","PXBPPOV",32,0)
 I $D(^TMP("PXK",$J,"POV")) W !,"Enter ",IOINHI,"NEXT",IOINLOW," ",PXACS," Diagnosis : "_$G(PXBDPOV) W:$D(PXBDPOV) " //" W IOELEOL
"RTN","PXBPPOV",33,0)
 R DATA:DTIME S EDATA=DATA
"RTN","PXBPPOV",34,0)
P1 ;--Third entry point
"RTN","PXBPPOV",35,0)
 X TIMED I  S PXBUT=1,LEAVE=1,DATA="^" G POVX
"RTN","PXBPPOV",36,0)
 I DATA?1.N1"E".NAP S DATA=" "_DATA
"RTN","PXBPPOV",37,0)
 I DATA?24.N S (DATA,EDATA)=$E(DATA,1,24)
"RTN","PXBPPOV",38,0)
 I $L(DATA)>200 S (DATA,EDATA)=$E(DATA,1,199)
"RTN","PXBPPOV",39,0)
 D CASE^PXBUTL
"RTN","PXBPPOV",40,0)
 ;----SPACE BAR---
"RTN","PXBPPOV",41,0)
 I DATA=" ",$D(^DISV(DUZ,"PXBPOV-3")) S DATA=^DISV(DUZ,"PXBPOV-3") W DATA
"RTN","PXBPPOV",42,0)
 ;-----------------
"RTN","PXBPPOV",43,0)
 I DATA="^^" S PXBEXIT=0 G POVX
"RTN","PXBPPOV",44,0)
 ;---I Prompt can jump to others put symbols in here
"RTN","PXBPPOV",45,0)
 I DATA["^P" G POVX
"RTN","PXBPPOV",46,0)
 ;------PXBDPOV=DEFAULT POV---PX*1.0*182 - added variable EDATA
"RTN","PXBPPOV",47,0)
 I DATA="",$D(PXBDPOV) S DATA=$P($G(PXBDPOV),"--",1),EDATA=DATA
"RTN","PXBPPOV",48,0)
 I DATA="",'$D(PXBDPOV) S PXBUT=1,PXBSPL="",LEAVE=1 G POVX
"RTN","PXBPPOV",49,0)
 I PXBCNT>10&((DATA="+")!(DATA="-")) D DPOV4^PXBDPOV(DATA) G P
"RTN","PXBPPOV",50,0)
 ;
"RTN","PXBPPOV",51,0)
M ;--------IF Multiple entries have been entered
"RTN","PXBPPOV",52,0)
 D ADDM^PXBPPOV1
"RTN","PXBPPOV",53,0)
 I $G(NF) G P1
"RTN","PXBPPOV",54,0)
 ;
"RTN","PXBPPOV",55,0)
 ;--------IF Multiple deleting of entries
"RTN","PXBPPOV",56,0)
 D DELM^PXBPPOV1
"RTN","PXBPPOV",57,0)
 I $G(NF) G P1
"RTN","PXBPPOV",58,0)
 ;
"RTN","PXBPPOV",59,0)
LI ;--------If picked a line number
"RTN","PXBPPOV",60,0)
 I (DATA>0)&(DATA<(PXBCNT+1))&($L(DATA)'>$L(PXBCNT))&($D(PXBSAM(DATA))) D:PXBCNT>10 DPOV4^PXBDPOV(PXBSAM(DATA,"LINE")) S XFLAG=1 D REVPOV(DATA) S SELINE=DATA D
"RTN","PXBPPOV",61,0)
 .F I=1:1:$L(DATA) W IOCUB,IOECH
"RTN","PXBPPOV",62,0)
 .S PRISEC=$P($G(PXBSAM(DATA)),"^",4) S:PRISEC["PRI" FPRI=0
"RTN","PXBPPOV",63,0)
 .S DATA=$P($G(PXBSAM(DATA)),"^",1)
"RTN","PXBPPOV",64,0)
 I $D(XFLAG),XFLAG=1 S (Y,EDATA)=DATA G PFIN
"RTN","PXBPPOV",65,0)
LI1 ;
"RTN","PXBPPOV",66,0)
 ;--------If POV is already in the file
"RTN","PXBPPOV",67,0)
 I '$G(DOUBLEQQ),$D(PXBKY(DATA)) D
"RTN","PXBPPOV",68,0)
 .I PXBCNT>10 D DPOV4^PXBDPOV(PXBSAM($O(PXBKY(DATA,0)),"LINE"))
"RTN","PXBPPOV",69,0)
 .K Q D TIMES^PXBUTL(DATA)
"RTN","PXBPPOV",70,0)
 .I Q=1 S LINE=$O(PXBKY(DATA,0)) S XFLAG=1 D REVPOV(LINE) S PRISEC=$P($G(PXBSAM(LINE)),"^",2) S:PRISEC["PRI" FPRI=0
"RTN","PXBPPOV",71,0)
 .I Q>1 S NLINE=0 F  S NLINE=$O(Q(NLINE)) Q:NLINE=""  D REVPOV(NLINE)
"RTN","PXBPPOV",72,0)
 I $D(Q),Q>1 D WHICH^PXBPWCH G LI
"RTN","PXBPPOV",73,0)
 I $D(XFLAG),XFLAG=1 S Y=DATA G PFIN
"RTN","PXBPPOV",74,0)
 ;
"RTN","PXBPPOV",75,0)
 ;--------Need to do a DIC lookup on data
"RTN","PXBPPOV",76,0)
 I DATA'="??" D:DATA="?" EN1^PXBHLP0("PXB","POV",1,"",1) G:DATA="^P" P1 I DATA="?" G P
"RTN","PXBPPOV",77,0)
 I DATA="??" S DOUBLEQQ=1 D EN1^PXBHLP0("PXB","POV","",1,2) S:$L(DATA,"^")>1 (Y,DATA,EDATA)=$P($P(DATA,"^",2),"--",1) G:Y>1 PFIN G:Y?1A1.ANP PFIN I DATA<1 S DATA="^P" G P1
"RTN","PXBPPOV",78,0)
 ;
"RTN","PXBPPOV",79,0)
 ;--If a "?" is NOT entered during lookup
"RTN","PXBPPOV",80,0)
 D CLEAR^VALM1,FULL^VALM1   ; call to clear screen --  added in *199
"RTN","PXBPPOV",81,0)
 W "Searching for diagnosis codes...",! ; added in *199
"RTN","PXBPPOV",82,0)
 K X,DIC
"RTN","PXBPPOV",83,0)
 S X=EDATA
"RTN","PXBPPOV",84,0)
 S PXACSREC=$$ACTDT^PXDXUTL(PXDXDATE),PXACS=$P(PXACSREC,U,3)
"RTN","PXBPPOV",85,0)
 I DATA="???",$P(PXACSREC,U,1)'="ICD" D  G P1
"RTN","PXBPPOV",86,0)
 . D CLEAR^VALM1 S PXPAUSE=1 D QM3^PXDSLK S DATA="^P"
"RTN","PXBPPOV",87,0)
 I $P(PXACSREC,U,1)'="ICD" D
"RTN","PXBPPOV",88,0)
 . S PXDATE=PXDXDATE,PXDEF=$G(X),PXAGAIN=0 D ^PXDSLK I PXXX=-1 S Y=-1 Q
"RTN","PXBPPOV",89,0)
 . S Y($P(PXACSREC,U,2))=$P($P(PXXX,U,1),";",2)
"RTN","PXBPPOV",90,0)
 . S Y=$P(PXXX,";",1)_U_$P(PXXX,U,2)
"RTN","PXBPPOV",91,0)
 I $P(PXACSREC,U,1)="ICD" D
"RTN","PXBPPOV",92,0)
 . K DIC D CONFIG^LEXSET($P(PXACSREC,U,1),,PXDXDATE)
"RTN","PXBPPOV",93,0)
 . S DIC("A")="Select "_PXACS_" Diagnosis: "
"RTN","PXBPPOV",94,0)
 . S DIC="^LEX(757.01,",DIC(0)=$S('$L(X):"A",1:"")_"EQM"
"RTN","PXBPPOV",95,0)
 . D ^DIC
"RTN","PXBPPOV",96,0)
 I $G(X)="@" Q
"RTN","PXBPPOV",97,0)
 I Y=-1 S DATA="^P" G P1
"RTN","PXBPPOV",98,0)
 S WHAT=$G(Y($P(PXACSREC,U,2)))
"RTN","PXBPPOV",99,0)
 S (DATA,EDATA)=WHAT K Y
"RTN","PXBPPOV",100,0)
 S PXICDDATA=$$ICDDATA^ICDXCODE("DIAG",WHAT,PXDXDATE,"E")
"RTN","PXBPPOV",101,0)
 S Y=$S($P(PXICDDATA,U,10)=0:-1,1:$P(PXICDDATA,U,1,2))
"RTN","PXBPPOV",102,0)
 S Y(0)=$P(PXICDDATA,U,2,99)
"RTN","PXBPPOV",103,0)
 ;
"RTN","PXBPPOV",104,0)
 ;--If Y is good and already in file...
"RTN","PXBPPOV",105,0)
 I '$G(DOUBLEQQ),$D(Y),$D(PXBKY($P(Y,"^",2))) D
"RTN","PXBPPOV",106,0)
 .S LINE=$O(PXBKY($P(Y,"^",2),0)) ;---D REVPOV^PXBCC(LINE)
"RTN","PXBPPOV",107,0)
 .S PRISEC=$P($G(PXBSAM(LINE)),"^",4) S:PRISEC["PRI" FPRI=0
"RTN","PXBPPOV",108,0)
 S POV=Y(0)
"RTN","PXBPPOV",109,0)
 ;
"RTN","PXBPPOV",110,0)
PFIN ;--Finish the DIAGNOSIS
"RTN","PXBPPOV",111,0)
 I $L(Y,"^")'>1 S X=Y,DIC=80,DIC(0)="IZM",DIC("S")="I $P($$ICDDATA^ICDXCODE(""DIAG"",Y,PXDXDATE,$$IE^ICDEX(Y)),U,10)" D ^DIC
"RTN","PXBPPOV",112,0)
 I +Y<0 D HELP1^PXBUTL1("POV") S PXICDROW=19 G P
"RTN","PXBPPOV",113,0)
 S POV=Y(0)
"RTN","PXBPPOV",114,0)
 ;get the correct diagnosis descriptor
"RTN","PXBPPOV",115,0)
 N DXINF S DXINF=$$ICDDATA^ICDXCODE("DIAG",+Y,PXDXDATE,"I"),$P(POV,U,3)=$P(DXINF,U,4)
"RTN","PXBPPOV",116,0)
 S PXBNPOV($P(POV,"^",1))=""
"RTN","PXBPPOV",117,0)
 S PXBNPOVL(1)=$P(POV,"^",1) S ^DISV(DUZ,"PXBPOV-3")=DATA
"RTN","PXBPPOV",118,0)
 I $D(PXBKY($P(Y(0),"^"))),$G(SELINE) S $P(REQI,"^",9)=$O(PXBSKY(SELINE,0))
"RTN","PXBPPOV",119,0)
 I $D(PXBKY($P(Y(0),"^"))),'$G(SELINE) S $P(REQI,"^",9)=$O(PXBSKY($O(PXBKY($P(Y(0),"^"),0)),0))
"RTN","PXBPPOV",120,0)
 I +Y>0 S PXBEDIS=$P(DXINF,U,4)
"RTN","PXBPPOV",121,0)
 S $P(REQI,"^",5)=+Y,$P(REQI,"^",6)="S"
"RTN","PXBPPOV",122,0)
 S $P(REQE,"^",5)=$P(POV,"^",1)_" --"_$G(PXBEDIS),$P(REQE,"^",6)="SECONDARY"
"RTN","PXBPPOV",123,0)
POVX ;--EXIT AND CLEAN UP
"RTN","PXBPPOV",124,0)
 I $G(WHAT)="INTV",DATA="^" S PXBEXIT="^^"
"RTN","PXBPPOV",125,0)
 I '$D(REQE) S REQE=""
"RTN","PXBPPOV",126,0)
 I $P(REQE,"^",5)="" S $P(REQE,"^",5)="...No Diagnosis Selected..."
"RTN","PXBPPOV",127,0)
 W !! S VALMBCK="R"  ; added in *199 to improve display
"RTN","PXBPPOV",128,0)
 Q
"RTN","PXBPPOV",129,0)
REVPOV(LINE) ;--NEW Reverse video API for POV since Long Descriptions are
"RTN","PXBPPOV",130,0)
 ; multiple lines
"RTN","PXBPPOV",131,0)
 Q:$G(NOREV)=1
"RTN","PXBPPOV",132,0)
 N ENTRY,XLINE,COL
"RTN","PXBPPOV",133,0)
 S ENTRY=$G(PXBSAM(LINE)),XLINE=PXBSAM(LINE,"LINE")#11
"RTN","PXBPPOV",134,0)
 S XLINE=XLINE+(PXBSAM(LINE,"LINE")\11)
"RTN","PXBPPOV",135,0)
 S:XLINE=11 XLINE=1 S XLINE=XLINE+4
"RTN","PXBPPOV",136,0)
 S COL=4
"RTN","PXBPPOV",137,0)
 D LOC^PXBCC(XLINE,COL)
"RTN","PXBPPOV",138,0)
 W IORVON,$J($P($P(ENTRY,"^",1),".",1),4),".",$P($P(ENTRY,"^",1),".",2),IORVOFF
"RTN","PXBPPOV",139,0)
 D LOC^PXBCC(18,1)
"RTN","PXBPPOV",140,0)
 Q
"RTN","PXBPPOV",141,0)
 ;
"RTN","PXBPPOV1")
0^23^B24879639^B23470728
"RTN","PXBPPOV1",1,0)
PXBPPOV1 ;ISL/JVS,ESW - PROMPT POV ;4/6/05 2:41pm
"RTN","PXBPPOV1",2,0)
 ;;1.0;PCE PATIENT CARE ENCOUNTER;**11,112,121,124,199**;Aug 12, 1996;Build 51
"RTN","PXBPPOV1",3,0)
 ;
"RTN","PXBPPOV1",4,0)
 ;
"RTN","PXBPPOV1",5,0)
 ;
"RTN","PXBPPOV1",6,0)
 ;
"RTN","PXBPPOV1",7,0)
 ;
"RTN","PXBPPOV1",8,0)
ADDM ;--------If Multiple POV entries have been entered.
"RTN","PXBPPOV1",9,0)
 ;
"RTN","PXBPPOV1",10,0)
 ;
"RTN","PXBPPOV1",11,0)
 ;
"RTN","PXBPPOV1",12,0)
 N BDATA,OK,PXBLEN,PXDXDATE
"RTN","PXBPPOV1",13,0)
 S PXDXDATE=$$CSDATE^PXDXUTL(PXBVST)
"RTN","PXBPPOV1",14,0)
 D WIN17^PXBCC(PXBCNT)
"RTN","PXBPPOV1",15,0)
 S NF=0,PXBLEN=0
"RTN","PXBPPOV1",16,0)
 I DATA[",",$E(DATA,1)'["@" S NF=1 D
"RTN","PXBPPOV1",17,0)
 .S PXBLEN=$L(DATA,",") F PXI=1:1:PXBLEN S PXBPIECE=$P(DATA,",",PXI) D
"RTN","PXBPPOV1",18,0)
 ..S Y=$$ICDDATA^ICDXCODE("DIAG",PXBPIECE,PXDXDATE,"E")
"RTN","PXBPPOV1",19,0)
 ..I $P(Y,U)=-1!($P(Y,U,10)'=1) S BAD($G(PXBPIECE))="" Q
"RTN","PXBPPOV1",20,0)
 ..S $P(REQI,"^",5)=+Y
"RTN","PXBPPOV1",21,0)
 ..S PXBNPOV(PXBPIECE)=""
"RTN","PXBPPOV1",22,0)
 ..;
"RTN","PXBPPOV1",23,0)
 ..;--Prompt for Primary or Secondary DIAGNOSIS
"RTN","PXBPPOV1",24,0)
 ..; ICD-10 Remediation note:  the next two lines display code--code (ex. 369.65--369.65)
"RTN","PXBPPOV1",25,0)
 ..; we think this is wrong but do not have specs to fix it.
"RTN","PXBPPOV1",26,0)
 ..W !,"For the DIAGNOSIS: ",PXBPIECE,"--"
"RTN","PXBPPOV1",27,0)
 ..W $P(Y,U,2),!
"RTN","PXBPPOV1",28,0)
 ..D WIN17^PXBCC(PXBCNT)
"RTN","PXBPPOV1",29,0)
 ..D PRI^PXBPPOV1
"RTN","PXBPPOV1",30,0)
 ..I $D(DIRUT) D RSET^PXBDREQ("POV") Q
"RTN","PXBPPOV1",31,0)
 ..D ORD^PXBPPOV1
"RTN","PXBPPOV1",32,0)
 ..N PXCEVIEN,PXCEAFTR,PXD
"RTN","PXBPPOV1",33,0)
 ..S PXCEVIEN=PXBVST,PXD=$P(REQI,U,5)
"RTN","PXBPPOV1",34,0)
 ..D WIN17^PXBCC(PXBCNT),GET800^PXCEC800 ;CI's
"RTN","PXBPPOV1",35,0)
 ..S PXBREQ(PXD,"I")=$G(PXCEAFTR(800))
"RTN","PXBPPOV1",36,0)
 ..;
"RTN","PXBPPOV1",37,0)
 ..D EN0^PXBSTOR(PXBVST,PATIENT,REQI)
"RTN","PXBPPOV1",38,0)
 ..D EN1^PXKMAIN
"RTN","PXBPPOV1",39,0)
 ..D RSET^PXBDREQ("POV")
"RTN","PXBPPOV1",40,0)
 I $G(NF)&($D(BAD)) D  Q
"RTN","PXBPPOV1",41,0)
 .S (BDATA,EDATA)="" F  S BDATA=$O(BAD(BDATA)) Q:BDATA=""  S EDATA=EDATA_BDATA_"  "
"RTN","PXBPPOV1",42,0)
 .W ! D HELP^PXBUTL0("CPTM") W !
"RTN","PXBPPOV1",43,0)
 .S DIR(0)="E" D ^DIR K DIR,DIRUT
"RTN","PXBPPOV1",44,0)
 .S:Y=1 DATA="^P" S:Y=0!(Y="") DATA="^" K Y
"RTN","PXBPPOV1",45,0)
 I $G(NF)&('$D(BAD)) S DATA="^P" Q
"RTN","PXBPPOV1",46,0)
 ;
"RTN","PXBPPOV1",47,0)
 Q
"RTN","PXBPPOV1",48,0)
 ;
"RTN","PXBPPOV1",49,0)
DELM ;--------If Multiple deleting
"RTN","PXBPPOV1",50,0)
 N BAD,BDATA,DELM,PXBJ,PXBLEN
"RTN","PXBPPOV1",51,0)
 S NF=0,PXBLEN=0 S $P(DELM,"^",3)=1
"RTN","PXBPPOV1",52,0)
 I $E(DATA,1)="@" S DATA=$P(DATA,"@",2),NF=1 D
"RTN","PXBPPOV1",53,0)
 .S PXBLEN=$L(DATA,",") F PXI=1:1:PXBLEN S PXBPIECE=$P(DATA,",",PXI) D
"RTN","PXBPPOV1",54,0)
 ..I PXBPIECE'["-"&(PXBPIECE'>0!(PXBPIECE'<(PXBCNT+1))) S BAD(+$G(PXBPIECE))="" Q
"RTN","PXBPPOV1",55,0)
 ..I PXBPIECE'["-" D
"RTN","PXBPPOV1",56,0)
 ...I $D(GONE(PXBPIECE)) Q
"RTN","PXBPPOV1",57,0)
 ...Q:PXBPIECE'?.N
"RTN","PXBPPOV1",58,0)
 ...S $P(REQI,"^",9)=$O(PXBSKY(PXBPIECE,0)) ;-IEN
"RTN","PXBPPOV1",59,0)
 ...S X=$P(PXBSAM(PXBPIECE),U,1),Y=$$ICDDATA^ICDXCODE("DIAG",X,PXDXDATE,"E")
"RTN","PXBPPOV1",60,0)
 ...I $P(Y,U)'=-1&($P(Y,U,10)=1) D
"RTN","PXBPPOV1",61,0)
 ....S $P(REQI,"^",5)=+Y K Y
"RTN","PXBPPOV1",62,0)
 ....S GONE(PXBPIECE)=""
"RTN","PXBPPOV1",63,0)
 ....D EN0^PXBSTOR(PXBVST,PATIENT,REQI)
"RTN","PXBPPOV1",64,0)
 ....D EN1^PXKMAIN
"RTN","PXBPPOV1",65,0)
 ..I PXBPIECE["-" D
"RTN","PXBPPOV1",66,0)
 ...F PXBJ=$P(PXBPIECE,"-",1):1:$P(PXBPIECE,"-",2) D
"RTN","PXBPPOV1",67,0)
 ....I $D(GONE(PXBJ)) Q
"RTN","PXBPPOV1",68,0)
 ....I PXBJ'>0!(PXBJ'<(PXBCNT+1)) S BAD(PXBJ)="" Q
"RTN","PXBPPOV1",69,0)
 ....S $P(REQI,"^",9)=$O(PXBSKY(PXBJ,0)) ;-IEN
"RTN","PXBPPOV1",70,0)
 ....S X=$P(PXBSAM(PXBJ),U,1),Y=$$ICDDATA^ICDXCODE("DIAG",X,PXDXDATE,"E")
"RTN","PXBPPOV1",71,0)
 ....I $P(Y,U)'=-1&($P(Y,U,10)=1) D
"RTN","PXBPPOV1",72,0)
 .....S $P(REQI,"^",5)=+Y K Y
"RTN","PXBPPOV1",73,0)
 .....S GONE(PXBJ)=""
"RTN","PXBPPOV1",74,0)
 .....D EN0^PXBSTOR(PXBVST,PATIENT,REQI)
"RTN","PXBPPOV1",75,0)
 .....D EN1^PXKMAIN
"RTN","PXBPPOV1",76,0)
 K GONE
"RTN","PXBPPOV1",77,0)
 I $G(NF)&($D(BAD)) D  Q
"RTN","PXBPPOV1",78,0)
 .S (BDATA,EDATA)="" F  S BDATA=$O(BAD(BDATA)) Q:BDATA=""  S EDATA=EDATA_BDATA_"  "
"RTN","PXBPPOV1",79,0)
 .W ! D HELP^PXBUTL0("CPTMD") W !
"RTN","PXBPPOV1",80,0)
 .S DIR(0)="E" D ^DIR K DIR
"RTN","PXBPPOV1",81,0)
 .S:Y=1 DATA="^P" S:Y=0!(Y="") DATA="^" K Y
"RTN","PXBPPOV1",82,0)
 I $G(NF)&('$D(BAD)) S DATA="^P" Q
"RTN","PXBPPOV1",83,0)
 Q
"RTN","PXBPPOV1",84,0)
PRI ;--Prompt for primary secondary DIAGNOSIS
"RTN","PXBPPOV1",85,0)
 N DIR,Y,X,SEQ
"RTN","PXBPPOV1",86,0)
 S SEQ=0 I $D(PXBKY(DATA)) S SEQ=+$O(PXBKY(DATA,"")) ;PX112
"RTN","PXBPPOV1",87,0)
 I $G(FPRI),$P($G(PXBKY(DATA,SEQ)),U,4)'="PRIMARY" Q  ;PX112
"RTN","PXBPPOV1",88,0)
 W IOCUD,IOELALL,IOCUU
"RTN","PXBPPOV1",89,0)
 S DIR("A",1)="ONE primary diagnosis must be established for each encounter!"
"RTN","PXBPPOV1",90,0)
 S DIR("A")="Is this the PRIMARY DIAGNOSIS for this ENCOUNTER? "
"RTN","PXBPPOV1",91,0)
 S DIR("B")="YES"
"RTN","PXBPPOV1",92,0)
 S DIR("?")="One PRIMARY DIAGNOSIS must be established for each patient encounter. 'Yes' will mean PRIMARY and 'No' will mean SECONDARY."
"RTN","PXBPPOV1",93,0)
 S DIR(0)="Y,A,O"
"RTN","PXBPPOV1",94,0)
 D ^DIR I $G(DIRUT) G PPXIT
"RTN","PXBPPOV1",95,0)
PPFIN ;--Finish off variables
"RTN","PXBPPOV1",96,0)
 I Y=1 S PRI="P^PRIMARY"
"RTN","PXBPPOV1",97,0)
 I Y=0 S PRI="S^SECONDARY"
"RTN","PXBPPOV1",98,0)
 S $P(REQI,"^",6)=$P(PRI,"^",1)
"RTN","PXBPPOV1",99,0)
 S $P(REQE,"^",6)=$P(PRI,"^",2)
"RTN","PXBPPOV1",100,0)
PPXIT ;--EXIT
"RTN","PXBPPOV1",101,0)
 Q
"RTN","PXBPPOV1",102,0)
ORD ;--Prompt for ordering resulting DIAGNOSIS
"RTN","PXBPPOV1",103,0)
 N DIR,Y,X,SEQ
"RTN","PXBPPOV1",104,0)
 S SEQ=0 I $D(PXBKY(DATA)) S SEQ=+$O(PXBKY(DATA,""))
"RTN","PXBPPOV1",105,0)
 W IOCUD,IOELALL,IOCUU
"RTN","PXBPPOV1",106,0)
 S DIR("A")="Is this Diagnosis Ordering or Resulting:"
"RTN","PXBPPOV1",107,0)
 S DIR("B")=$P($G(PXBKY(DATA,SEQ)),U,7)
"RTN","PXBPPOV1",108,0)
 S DIR("?")="Resulting and/or Ordering indicators are only entered if at least one of each diagnosis type exists."
"RTN","PXBPPOV1",109,0)
 S DIR(0)="SO^O:ORDERING;R:RESULTING;OR:BOTH O&R"
"RTN","PXBPPOV1",110,0)
 D ^DIR I $G(DIRUT) G PPXIT
"RTN","PXBPPOV1",111,0)
ORFIN ;--Finish off variables
"RTN","PXBPPOV1",112,0)
 S $P(REQI,"^",7)=Y
"RTN","PXBPPOV1",113,0)
 S $P(REQE,"^",7)=$S(Y="O":"ORDERING",Y="R":"RESULTING",1:"BOTH O&R")
"RTN","PXBPPOV1",114,0)
 Q
"RTN","PXBPPOV1",115,0)
PRBLM ;--Prompt for Problem list
"RTN","PXBPPOV1",116,0)
 N DIR,Y,X,VALL
"RTN","PXBPPOV1",117,0)
 W IOCUD,IOELALL,IOCUU
"RTN","PXBPPOV1",118,0)
 D WIN17^PXBCC(PXBCNT)
"RTN","PXBPPOV1",119,0)
 S DIR("?")="^S VALL=1,VALL=$$DOUBLE1^PXBGPL2(WHAT)"
"RTN","PXBPPOV1",120,0)
 S DIR("A")="Do you want this DIAGNOSIS added to the PROBLEM LIST? "
"RTN","PXBPPOV1",121,0)
 S DIR("B")="NO"
"RTN","PXBPPOV1",122,0)
 S DIR(0)="Y,A,O"
"RTN","PXBPPOV1",123,0)
 D ^DIR
"RTN","PXBPPOV1",124,0)
 I X="+"!(X="-") S DIR("?")="D DPOV4^PXBDPL(X)"
"RTN","PXBPPOV1",125,0)
 I $G(DIRUT) G PPXIT
"RTN","PXBPPOV1",126,0)
PRPFIN ;--Finish off variables
"RTN","PXBPPOV1",127,0)
 K PXBKYPL,PXBSKYPL,PXBSAMPL,PXBCNTPL
"RTN","PXBPPOV1",128,0)
 K ^TMP("PXBKYPL",$J),^TMP("PXBSAMPL",$J)
"RTN","PXBPPOV1",129,0)
 S PXBPRBLM=+Y
"RTN","PXBPPOV1",130,0)
PRPXIT ;--EXIT
"RTN","PXBPPOV1",131,0)
 Q
"RTN","PXBPPOV1",132,0)
 ;
"RTN","PXBSTOR")
0^24^B42386628^B42381168
"RTN","PXBSTOR",1,0)
PXBSTOR ;ISL/JVS - PASSING THE DATA TO THE V FILES ;3/21/05 1:35pm
"RTN","PXBSTOR",2,0)
 ;;1.0;PCE PATIENT CARE ENCOUNTER;**73,88,149,124,164,203,199**;Aug 12, 1996;Build 51
"RTN","PXBSTOR",3,0)
 ;
"RTN","PXBSTOR",4,0)
 ;  VARIABLE LIST
"RTN","PXBSTOR",5,0)
 ;  PIECE   1        2     3     4      5     6       7       8       9
"RTN","PXBSTOR",6,0)
 ;  REQ*=PROVDER^PRIMARY^CPT^QUANTITY^POV^PRIMARY^PRV IEN^CPT IEN^POV IEN
"RTN","PXBSTOR",7,0)
 ;  PIECE   10       11        12  13  14  15  16  17  18  19     20    21  22
"RTN","PXBSTOR",8,0)
 ;  REQ  STOPCODE^STOPCODE IEN^DX1^DX2^DX3^DX4^DX5^DX6^DX7^DX8^DEPT CODE^^OrdPrv
"RTN","PXBSTOR",9,0)
 ;                             (DX5 - DX10 for future use)
"RTN","PXBSTOR",10,0)
 ;  REQ(1,MODIFIER)*=""
"RTN","PXBSTOR",11,0)
 ;  REQ("IEN")=V CPT file IEN
"RTN","PXBSTOR",12,0)
 ;  REQI=Internal Values
"RTN","PXBSTOR",13,0)
 ;  REQE=External Values
"RTN","PXBSTOR",14,0)
 ;  PXBVST=Visit Ien
"RTN","PXBSTOR",15,0)
 ;  PRVIEN=Provider IEN in V Provider file
"RTN","PXBSTOR",16,0)
 ;  CPTIEN=CPT IEN in V CPT file
"RTN","PXBSTOR",17,0)
 ;  POVIEN=POV IEN in V POV file
"RTN","PXBSTOR",18,0)
 ;  patient is defined from the visit
"RTN","PXBSTOR",19,0)
 ;
"RTN","PXBSTOR",20,0)
EN0(PXBVST,PATIENT,REQI,REQ) ;--Main Entry point
"RTN","PXBSTOR",21,0)
EN1 ;
"RTN","PXBSTOR",22,0)
 Q:'$D(REQI)!$G(PXBVST)<1
"RTN","PXBSTOR",23,0)
 K ^TMP("PXK",$J) ;--MUST BE MOVED TO AFTER THE EVENT
"RTN","PXBSTOR",24,0)
 N CPRNARR,CPTAF812,CPTAFT,CPTAFT1,CPTAFT12,CPTBEF,CPTBEF1,CPTBEF12
"RTN","PXBSTOR",25,0)
 N CPTBF812,CPTIEN,CTR,POVAF800,POVAF812,POVAFT,POVAFT12,POVBEF
"RTN","PXBSTOR",26,0)
 N POVBEF12,POVBF800,POVBF812,POVI,POVIEN,PPRNARR,PRVAF812,PRVAFT
"RTN","PXBSTOR",27,0)
 N PRVAFT12,PRVBEF,PRVBEF12,PRVBF812,PRVIEN,SEQ
"RTN","PXBSTOR",28,0)
 ;
"RTN","PXBSTOR",29,0)
SET ;--SET TEMP GLOBALS
"RTN","PXBSTOR",30,0)
 S SEQ=$$SET^PXBSTOR1
"RTN","PXBSTOR",31,0)
 I $G(IDATE)="" S IDATE=+^AUPNVSIT(PXBVST,0)
"RTN","PXBSTOR",32,0)
 D:$P(REQI,"^",1) PRV S SEQ=SEQ+1
"RTN","PXBSTOR",33,0)
 D:$P(REQI,"^",3) CPT S SEQ=SEQ+1
"RTN","PXBSTOR",34,0)
 D:$P(REQI,"^",5) POV S SEQ=SEQ+1
"RTN","PXBSTOR",35,0)
 F CTR=12:1:19 D:$P(REQI,U,CTR) DX S SEQ=SEQ+1
"RTN","PXBSTOR",36,0)
 S ^TMP("PXBSTOR",$J,"SEQ")=SEQ+1
"RTN","PXBSTOR",37,0)
 Q
"RTN","PXBSTOR",38,0)
PRV ;--PROVIDER PIECE 1 AND 2
"RTN","PXBSTOR",39,0)
 S PRVAFT=PRVBEF,PRVAFT12=PRVBEF12,PRVAF812=PRVBF812
"RTN","PXBSTOR",40,0)
 I $D(DELM),$P(DELM,"^",1)=1 S (PRVAFT,PRVAFT12)="" G PRV1
"RTN","PXBSTOR",41,0)
 S $P(PRVAFT,"^",1)=$P(REQI,"^",1) ;--PROVIDER IEN
"RTN","PXBSTOR",42,0)
 S $P(PRVAFT,"^",4)=$P(REQI,"^",2) ;--PRIMARY/SECONDARY
"RTN","PXBSTOR",43,0)
 S $P(PRVAFT,"^",2)=PATIENT ;--PATIENT
"RTN","PXBSTOR",44,0)
 S $P(PRVAFT,"^",3)=PXBVST ;--VISIT POINTER
"RTN","PXBSTOR",45,0)
 I PRVBF812']"" D
"RTN","PXBSTOR",46,0)
 .;-***POPULATE VERIFIED FIELD IN FUTURE
"RTN","PXBSTOR",47,0)
 .S $P(PRVAF812,"^",2)=$G(PXBPKG)
"RTN","PXBSTOR",48,0)
 .S $P(PRVAF812,"^",3)=$G(PXBSOURC)
"RTN","PXBSTOR",49,0)
PRV1 S ^TMP("PXK",$J,"PRV",SEQ,0,"AFTER")=PRVAFT
"RTN","PXBSTOR",50,0)
 S ^TMP("PXK",$J,"PRV",SEQ,0,"BEFORE")=PRVBEF
"RTN","PXBSTOR",51,0)
 S ^TMP("PXK",$J,"PRV",SEQ,12,"AFTER")=PRVAFT12
"RTN","PXBSTOR",52,0)
 S ^TMP("PXK",$J,"PRV",SEQ,12,"BEFORE")=PRVBEF12
"RTN","PXBSTOR",53,0)
 S ^TMP("PXK",$J,"PRV",SEQ,812,"AFTER")=PRVAF812
"RTN","PXBSTOR",54,0)
 S ^TMP("PXK",$J,"PRV",SEQ,812,"BEFORE")=PRVBF812
"RTN","PXBSTOR",55,0)
 S ^TMP("PXK",$J,"PRV",SEQ,"IEN")=PRVIEN
"RTN","PXBSTOR",56,0)
 Q
"RTN","PXBSTOR",57,0)
 ;
"RTN","PXBSTOR",58,0)
CPT ;--CPT PROCDEURE PIECE 3 AND 4
"RTN","PXBSTOR",59,0)
 N PXMODIEN
"RTN","PXBSTOR",60,0)
 S CPTAFT=CPTBEF,CPTAFT12=CPTBEF12,CPTAF812=CPTBF812
"RTN","PXBSTOR",61,0)
 I $D(DELM),$P(DELM,"^",2)=1 S (CPTAFT,CPTAFT12)="" G CPT1
"RTN","PXBSTOR",62,0)
 S $P(CPTAFT,"^",1)=$P(REQI,"^",3) ;--PROCEDURE IEN 
"RTN","PXBSTOR",63,0)
 S $P(CPTAFT,"^",2)=PATIENT ;--PATIENT
"RTN","PXBSTOR",64,0)
 S $P(CPTAFT,"^",3)=PXBVST ;--VISIT POINTER
"RTN","PXBSTOR",65,0)
 S $P(CPTAFT12,"^",4)=$P(REQI,"^",1) ;--PROVIDER POINTER
"RTN","PXBSTOR",66,0)
 S $P(CPTAFT12,"^",2)=$P(REQI,"^",22) ;--ORDERING PROVIDER POINTER
"RTN","PXBSTOR",67,0)
 S CPRNARR=$P($$CPT^ICPTCOD($P(REQI,"^",3),$G(IDATE)),U,3) ;--TEXT PROV NARR
"RTN","PXBSTOR",68,0)
 S $P(CPTAFT,"^",4)=+$$PROVNARR^PXAPI($G(CPRNARR),9000010.18) ;--PROV NAR
"RTN","PXBSTOR",69,0)
 S $P(CPTAFT,"^",16)=$P(REQI,"^",4) ;--QUANTITY
"RTN","PXBSTOR",70,0)
 S $P(CPTAFT,"^",5)=$P(REQI,"^",12) ;DX1 (REQUIRED)
"RTN","PXBSTOR",71,0)
 S $P(REQI,U,19)=$P(REQI,U,19) ;INSURE AT LEAST 19 PIECES IN REQI
"RTN","PXBSTOR",72,0)
 S $P(CPTAFT,"^",9,15)=$P(REQI,"^",13,19) ;DX2 - DX4, DX5 - DX8
"RTN","PXBSTOR",73,0)
 I $$SWSTAT^IBBAPI() D  ;DEPARTMENT CODE
"RTN","PXBSTOR",74,0)
 . I $P(CPTAFT,U,19)="",$G(^AUPNVSIT(PXBVST,0)),$P(^AUPNVSIT(PXBVST,0),"^",8) S $P(CPTAFT,U,19)=$P($G(^DIC(40.7,$P(^AUPNVSIT(PXBVST,0),"^",8),0)),"^",2)
"RTN","PXBSTOR",75,0)
 I $P(REQI,"^",4)=0 S (CPTAFT,CPTAFT12)=""
"RTN","PXBSTOR",76,0)
 I $P(REQI,"^",4)="@" S (CPTAFT,CPTAFT12)=""
"RTN","PXBSTOR",77,0)
 ;--------------------
"RTN","PXBSTOR",78,0)
 ;I $G(CPTIEN),$D(^AUPNVCPT(CPTIEN,12)),$P(REQI,"^",1)'=$P(^AUPNVCPT(CPTIEN,12),"^",4),'$D(DELM) S (CPTIEN,CPTBEF,CPTBEF12)=""
"RTN","PXBSTOR",79,0)
 ;---------------
"RTN","PXBSTOR",80,0)
 I CPTBF812']"" D
"RTN","PXBSTOR",81,0)
 .;-***POPULATE VERIFIED FIELD IN FUTURE
"RTN","PXBSTOR",82,0)
 .S $P(CPTAF812,"^",2)=$G(PXBPKG)
"RTN","PXBSTOR",83,0)
 .S $P(CPTAF812,"^",3)=$G(PXBSOURC)
"RTN","PXBSTOR",84,0)
 S PXMODIEN=""
"RTN","PXBSTOR",85,0)
 F  S PXMODIEN=$O(REQ(1,PXMODIEN)) Q:PXMODIEN=""  D
"RTN","PXBSTOR",86,0)
 .S CPTAFT1(PXMODIEN)=REQ(1,PXMODIEN)
"RTN","PXBSTOR",87,0)
CPT1 ;
"RTN","PXBSTOR",88,0)
 S ^TMP("PXK",$J,"CPT",SEQ,0,"AFTER")=CPTAFT
"RTN","PXBSTOR",89,0)
 S ^TMP("PXK",$J,"CPT",SEQ,0,"BEFORE")=CPTBEF
"RTN","PXBSTOR",90,0)
 S ^TMP("PXK",$J,"CPT",SEQ,12,"AFTER")=CPTAFT12
"RTN","PXBSTOR",91,0)
 S ^TMP("PXK",$J,"CPT",SEQ,12,"BEFORE")=CPTBEF12
"RTN","PXBSTOR",92,0)
 S ^TMP("PXK",$J,"CPT",SEQ,812,"AFTER")=CPTAF812
"RTN","PXBSTOR",93,0)
 S ^TMP("PXK",$J,"CPT",SEQ,812,"BEFORE")=CPTBF812
"RTN","PXBSTOR",94,0)
 S ^TMP("PXK",$J,"CPT",SEQ,"IEN")=CPTIEN
"RTN","PXBSTOR",95,0)
 ;Set modifiers into ^TMP
"RTN","PXBSTOR",96,0)
 S PXMODIEN=""
"RTN","PXBSTOR",97,0)
 F  S PXMODIEN=$O(CPTAFT1(PXMODIEN)) Q:PXMODIEN=""  D
"RTN","PXBSTOR",98,0)
 .S ^TMP("PXK",$J,"CPT",SEQ,1,PXMODIEN,"AFTER")=CPTAFT1(PXMODIEN)
"RTN","PXBSTOR",99,0)
 S PXMODIEN=""
"RTN","PXBSTOR",100,0)
 F  S PXMODIEN=$O(CPTBEF1(PXMODIEN)) Q:PXMODIEN=""  D
"RTN","PXBSTOR",101,0)
 .S ^TMP("PXK",$J,"CPT",SEQ,1,PXMODIEN,"BEFORE")=CPTBEF1(PXMODIEN)
"RTN","PXBSTOR",102,0)
 ;Set ^TMP file with V CPT IEN
"RTN","PXBSTOR",103,0)
 I $G(REQ)]"" D
"RTN","PXBSTOR",104,0)
 . S ^TMP("PXK",$J,"CPT",SEQ,"IEN")=REQ
"RTN","PXBSTOR",105,0)
 Q
"RTN","PXBSTOR",106,0)
 ;
"RTN","PXBSTOR",107,0)
POV ;--POV PIECE 5 AND 6
"RTN","PXBSTOR",108,0)
 S POVAFT=POVBEF,POVAFT12=POVBEF12,POVAF812=POVBF812,POVAF800=POVBF800
"RTN","PXBSTOR",109,0)
 S POVAFT17=POVBEF17
"RTN","PXBSTOR",110,0)
 I $D(DELM),$P(DELM,"^",3)=1 S (POVAFT,POVAFT12,POVAF800)="" G POV1
"RTN","PXBSTOR",111,0)
 S $P(POVAFT,"^",1)=$P(REQI,"^",5) ;--POV IEN 
"RTN","PXBSTOR",112,0)
 S $P(POVAFT,"^",12)=$P(REQI,"^",6) ;--PRI/SECONDARY
"RTN","PXBSTOR",113,0)
 S $P(POVAFT,U,17)=$P(REQI,U,7) ;--ORDERING/RESULTING
"RTN","PXBSTOR",114,0)
 S $P(POVAFT,"^",2)=PATIENT ;--PATIENT
"RTN","PXBSTOR",115,0)
 S $P(POVAFT,"^",3)=PXBVST ;--VISIT POINTER
"RTN","PXBSTOR",116,0)
 S PPRNARR=$$DXNARR^PXUTL1($P(REQI,"^",5),$$CSDATE^PXDXUTL(PXBVST)) ;--TEXT PROV NARR
"RTN","PXBSTOR",117,0)
 S $P(POVAFT,"^",4)=+$$PROVNARR^PXAPI($G(PPRNARR),9000010.07) ;--POI PROV NARR
"RTN","PXBSTOR",118,0)
 I $P($G(REQI),"^",7) S $P(POVAFT12,"^",4)=$P(^AUPNVPRV($P(REQI,"^",7),0),"^",1) ;--PROVIDER
"RTN","PXBSTOR",119,0)
 I $G(PXBRES) S $P(POVAFT,"^",16)=PXBRES ;-PROBLEM LIST ENTRY
"RTN","PXBSTOR",120,0)
 I POVBF812']"" D
"RTN","PXBSTOR",121,0)
 .;-**POPULATE VERIFIED FIELD IN FUTURE
"RTN","PXBSTOR",122,0)
 .S $P(POVAF812,"^",2)=$G(PXBPKG)
"RTN","PXBSTOR",123,0)
 .S $P(POVAF812,"^",3)=$G(PXBSOURC)
"RTN","PXBSTOR",124,0)
 I $D(PXBREQ($P(REQI,U,5))) S POVAF800=$G(PXBREQ($P(REQI,U,5),"I"))
"RTN","PXBSTOR",125,0)
POV1 S ^TMP("PXK",$J,"POV",SEQ,0,"AFTER")=POVAFT
"RTN","PXBSTOR",126,0)
 S ^TMP("PXK",$J,"POV",SEQ,0,"BEFORE")=POVBEF
"RTN","PXBSTOR",127,0)
 S ^TMP("PXK",$J,"POV",SEQ,12,"AFTER")=POVAFT12
"RTN","PXBSTOR",128,0)
 S ^TMP("PXK",$J,"POV",SEQ,12,"BEFORE")=POVBEF12
"RTN","PXBSTOR",129,0)
 S ^TMP("PXK",$J,"POV",SEQ,17,"AFTER")=POVAFT17
"RTN","PXBSTOR",130,0)
 S ^TMP("PXK",$J,"POV",SEQ,17,"BEFORE")=POVBEF17
"RTN","PXBSTOR",131,0)
 S ^TMP("PXK",$J,"POV",SEQ,812,"AFTER")=POVAF812
"RTN","PXBSTOR",132,0)
 S ^TMP("PXK",$J,"POV",SEQ,812,"BEFORE")=POVBF812
"RTN","PXBSTOR",133,0)
 S ^TMP("PXK",$J,"POV",SEQ,800,"AFTER")=POVAF800
"RTN","PXBSTOR",134,0)
 S ^TMP("PXK",$J,"POV",SEQ,800,"BEFORE")=POVBF800
"RTN","PXBSTOR",135,0)
 S ^TMP("PXK",$J,"POV",SEQ,"IEN")=POVIEN
"RTN","PXBSTOR",136,0)
 Q
"RTN","PXBSTOR",137,0)
 ;
"RTN","PXBSTOR",138,0)
DX ;CPT DIAGNOSIS - PX124
"RTN","PXBSTOR",139,0)
 N POVIEN,POVBF800,POVBF812,POVBEF12,POVBEF,POVBEF17,PXBVDT
"RTN","PXBSTOR",140,0)
 N IEN,ANS,POVAF800,POVAF812,POVAFT12,POVAFT,POVAFT17
"RTN","PXBSTOR",141,0)
 S IEN=$P(REQI,U,CTR),ANS=$$XLATE^PXBGPOV(PXBVST,IEN),POVIEN=+ANS
"RTN","PXBSTOR",142,0)
 I POVIEN D
"RTN","PXBSTOR",143,0)
 .S POVBEF=$G(^AUPNVPOV(POVIEN,0)),POVBEF12=$G(^(12)),POVBF812=$G(^(812)),POVBF800=$G(^(800)),POVBEF17=$G(^(17))
"RTN","PXBSTOR",144,0)
 E  S (POVBF800,POVBF812,POVBEF12,POVBEF17,POVBEF)=""
"RTN","PXBSTOR",145,0)
 S POVAFT=POVBEF,POVAFT12=POVBEF12,POVAF812=POVBF812,POVAF800=POVBF800
"RTN","PXBSTOR",146,0)
 S POVAFT17=POVBEF17
"RTN","PXBSTOR",147,0)
 S $P(POVAFT,U,1,3)=IEN_U_PATIENT_U_PXBVST
"RTN","PXBSTOR",148,0)
 S PXBVDT=$$CSDATE^PXDXUTL(PXBVST) ; get visit date
"RTN","PXBSTOR",149,0)
 S PPRNARR=$$DXNARR^PXUTL1(IEN,PXBVDT) ; get diagnosis description
"RTN","PXBSTOR",150,0)
 S $P(POVAFT,U,4)=+$$PROVNARR^PXAPI(PPRNARR,9000010.07)
"RTN","PXBSTOR",151,0)
 S $P(POVAFT,U,12)=$S(IEN=$G(PXBDXPRI):"P",1:"S") ;PRI/SEC
"RTN","PXBSTOR",152,0)
 I $P(REQI,U,7) S $P(POVAFT12,U,4)=$P($G(^AUPNVPRV($P(REQI,U,7),0)),U,1)
"RTN","PXBSTOR",153,0)
 I POVBF812']"" S $P(POVAF812,U,2,3)=$G(PXBPKG)_U_$G(PXBSOURC)
"RTN","PXBSTOR",154,0)
 S POVAF800=$G(PXBREQ(IEN,"I")) S:POVAF800="" POVAF800=$P(ANS,U,4,20)
"RTN","PXBSTOR",155,0)
 D POV1
"RTN","PXBSTOR",156,0)
 Q
"RTN","PXBUTL2")
0^25^B4486692^B3542412
"RTN","PXBUTL2",1,0)
PXBUTL2 ;ISL/DCM - PCE Utilities ;5/21/96  12:15
"RTN","PXBUTL2",2,0)
 ;;1.0;PCE PATIENT CARE ENCOUNTER;**121,199**;Aug 12, 1996;Build 51
"RTN","PXBUTL2",3,0)
 ;
"RTN","PXBUTL2",4,0)
 ;
"RTN","PXBUTL2",5,0)
 ;
"RTN","PXBUTL2",6,0)
 ;
"RTN","PXBUTL2",7,0)
PRV(CLINIC) ;Get default provider and all providers associated with a clinic
"RTN","PXBUTL2",8,0)
 ;CLINIC - ifn of clinic in file 44
"RTN","PXBUTL2",9,0)
 ;External references:  ^SC(DA(1),"PR",DA)
"RTN","PXBUTL2",10,0)
 ;                      ^VA(200,DA,0)
"RTN","PXBUTL2",11,0)
 Q:'$G(CLINIC)  Q:'$O(^SC(CLINIC,"PR",0))
"RTN","PXBUTL2",12,0)
 K PXBPMT N IFN,X,NAME
"RTN","PXBUTL2",13,0)
 S IFN=0 F  S IFN=$O(^SC(CLINIC,"PR",IFN)) Q:IFN<1  S X=^(IFN,0) D
"RTN","PXBUTL2",14,0)
 . S NAME=$P($G(^VA(200,+X,0)),"^") I $L(NAME) S PXBPMT("PRV",NAME,+X)="" S:$P(X,"^",2) PXBPMT("DEF",NAME,+X)=""
"RTN","PXBUTL2",15,0)
 Q
"RTN","PXBUTL2",16,0)
POV(CLINIC,CODE) ;Get default diagnosis and all diagnosis associated with clinic
"RTN","PXBUTL2",17,0)
 ;CLINIC - ifn of clinic in file 44
"RTN","PXBUTL2",18,0)
 ;CODE - 1 (default) code, 2 diagnosis, 3 both
"RTN","PXBUTL2",19,0)
 ;External references:  ^SC(DA(1),"DX",DA)
"RTN","PXBUTL2",20,0)
 ;                      ^ICD9(DA,0)
"RTN","PXBUTL2",21,0)
 Q:'$G(CLINIC)  Q:'$O(^SC(CLINIC,"DX",0))
"RTN","PXBUTL2",22,0)
 K PXBPMT
"RTN","PXBUTL2",23,0)
 N IFN,NAME,PXDXDATE,X
"RTN","PXBUTL2",24,0)
 S PXDXDATE=$$CSDATE^PXDXUTL(PXBVST)
"RTN","PXBUTL2",25,0)
 S:'$D(CODE) CODE=1
"RTN","PXBUTL2",26,0)
 S IFN=0 F  S IFN=$O(^SC(CLINIC,"DX",IFN)) Q:IFN<1  S X=^(IFN,0) D
"RTN","PXBUTL2",27,0)
 . S NAME=$P($$ICDDATA^ICDXCODE("DIAG",+X,PXDXDATE,"I"),"^",2,4)
"RTN","PXBUTL2",28,0)
 . I $P(NAME," ",1,2)="Invalid Code" S NAME="" ; ignore value if Invalid Code message is returned from $$ICDDATA
"RTN","PXBUTL2",29,0)
 . ;jvs 7/22/96 allow selection of v codes
"RTN","PXBUTL2",30,0)
 . I $L(NAME) S NAME=$S(CODE=2:$S($L($P(NAME,"^",3)):$P(NAME,"^",3),1:$P(NAME,"^")),CODE=3:$P(NAME,"^")_"--"_$P(NAME,"^",3),1:$P(NAME,"^")),PXBPMT("POV",NAME,+X)="" S:$P(X,"^",2) PXBPMT("DEF",NAME,+X)=""
"RTN","PXBUTL2",31,0)
 Q
"RTN","PXBUTL2",32,0)
TSTPRV ;Test provider lookup
"RTN","PXBUTL2",33,0)
 S DIC=44,DIC(0)="AEQLM" D ^DIC Q:Y<1  D PRV(+Y)
"RTN","PXBUTL2",34,0)
 K DIC
"RTN","PXBUTL2",35,0)
 Q
"RTN","PXBUTL2",36,0)
TSTPOV ;Test diagnosis lookup
"RTN","PXBUTL2",37,0)
 S DIC=44,DIC(0)="AEQLM" D ^DIC Q:Y<1  D POV(+Y,3)
"RTN","PXBUTL2",38,0)
 K DIC
"RTN","PXBUTL2",39,0)
 Q
"RTN","PXCACPT")
0^26^B43989781^B47966106
"RTN","PXCACPT",1,0)
PXCACPT ;ISL/dee & LEA/Chylton,SCK - Validates & Translates data from the PCE Device Interface into PCE's PXK format for CPTs ;5/24/04 3:51pm
"RTN","PXCACPT",2,0)
 ;;1.0;PCE PATIENT CARE ENCOUNTER;**27,33,73,121,124,194,199**;Aug 12, 1996;Build 51
"RTN","PXCACPT",3,0)
 Q
"RTN","PXCACPT",4,0)
 ; Variables
"RTN","PXCACPT",5,0)
 ;   PXCAPROC  Copy of a Procedure node of the PXCA array
"RTN","PXCACPT",6,0)
 ;   PXCAPRV   Pointer to the provider (200)
"RTN","PXCACPT",7,0)
 ;   PXCANUMB  Count of the number of CPTs and treatments
"RTN","PXCACPT",8,0)
 ;   PXCAINDX  Count of the number of procedures for one provider
"RTN","PXCACPT",9,0)
 ;   PXCAPNAR  Pointer to the provider narrative (9999999.27)
"RTN","PXCACPT",10,0)
 ;   PXCATRT   Pointer to the Treatment file (9999999.17)
"RTN","PXCACPT",11,0)
 ;
"RTN","PXCACPT",12,0)
PROC(PXCA,PXCABULD,PXCAERRS,PXCAEVAL) ;
"RTN","PXCACPT",13,0)
 I '$D(PXCA("PROCEDURE")),'PXCAEVAL,$P($G(^PX(815,1,"DI")),"^",1),'$D(^AUPNVCPT("AD",+PXCAVSIT)) S PXCA("WARNING","PROCEDURE",0,0,0)="PROCEDURE data missing" Q
"RTN","PXCACPT",14,0)
 N PXCAINDX,PXCAITEM,PXCALEN,PXCANARC,PXCANUMB,PXCAPNAR,PXCAPROC,PXCAPRV,PXDXDATE
"RTN","PXCACPT",15,0)
 S PXDXDATE=$$CSDATE^PXDXUTL(PXCAVSIT) ; Date to use in $$ICDDATA^ICDXCODE calls
"RTN","PXCACPT",16,0)
 S PXCAPRV="",PXCANUMB=1
"RTN","PXCACPT",17,0)
 F  S PXCAPRV=$O(PXCA("PROCEDURE",PXCAPRV)) Q:PXCAPRV']""  D
"RTN","PXCACPT",18,0)
 . I PXCAPRV>0 D
"RTN","PXCACPT",19,0)
 .. I '$$ACTIVPRV^PXAPI(PXCAPRV,PXCADT) S PXCA("ERROR","PROCEDURE",PXCAPRV,0,0)="Provider is not active or valid^"_PXCAPRV
"RTN","PXCACPT",20,0)
 . I '$T&PXCABULD!PXCAERRS D ANOTHPRV^PXCAPRV(PXCAPRV)
"RTN","PXCACPT",21,0)
 . S PXCAINDX=0
"RTN","PXCACPT",22,0)
 . F  S PXCAINDX=$O(PXCA("PROCEDURE",PXCAPRV,PXCAINDX)) Q:PXCAINDX']""  D
"RTN","PXCACPT",23,0)
 .. N PXCATRT
"RTN","PXCACPT",24,0)
 .. S PXCANUMB=PXCANUMB+1
"RTN","PXCACPT",25,0)
 .. S PXCAPROC=$G(PXCA("PROCEDURE",PXCAPRV,PXCAINDX))
"RTN","PXCACPT",26,0)
 .. I PXCAPROC="" S PXCA("ERROR","PROCEDURE",PXCAPRV,PXCAINDX,0)="PROCEDURE data missing" Q
"RTN","PXCACPT",27,0)
 .. S PXCAITEM=$P(PXCAPROC,U,1)
"RTN","PXCACPT",28,0)
 .. I PXCAITEM]"" D
"RTN","PXCACPT",29,0)
 ... S D=$$CPT^ICPTCOD(+PXCAITEM)
"RTN","PXCACPT",30,0)
 ... I D<0 S PXCA("ERROR","PROCEDURE",PXCAPRV,PXCAINDX,1)="CPT code not in File 81^"_PXCAITEM
"RTN","PXCACPT",31,0)
 ... E  I '(+$$CPTSCREN^PXBUTL(PXCAITEM,+PXCADT)) S PXCA("ERROR","PROCEDURE",PXCAPRV,PXCAINDX,1)="CPT code is INACTIVE^"_PXCAITEM
"RTN","PXCACPT",32,0)
 .. E  D
"RTN","PXCACPT",33,0)
 ... S PXCATRT=$O(^AUTTTRT("B",+$P(PXCAPROC,"^",6),""))
"RTN","PXCACPT",34,0)
 ... S:PXCATRT="" PXCATRT=$O(^AUTTTRT("B","OTHER",""))
"RTN","PXCACPT",35,0)
 ... I 'PXCATRT S PXCA("ERROR","PROCEDURE",PXCAPRV,PXCAINDX,6)="Could not get pointer to treatment term^"_$P(PXCAPROC,"^",6)
"RTN","PXCACPT",36,0)
 .. S PXCAITEM=$P(PXCAPROC,U,2)
"RTN","PXCACPT",37,0)
 .. I PXCAITEM="" S PXCAITEM=1,$P(PXCAPROC,U,2)=PXCAITEM
"RTN","PXCACPT",38,0)
 .. I PXCAITEM'>0 S PXCA("ERROR","PROCEDURE",PXCAPRV,PXCAINDX,2)="CPT Quantity must be > 0^"_PXCAITEM
"RTN","PXCACPT",39,0)
 .. S PXCAITEM=$P(PXCAPROC,U,3)
"RTN","PXCACPT",40,0)
 .. I '(PXCAITEM=""!(PXCAITEM="P")!(PXCAITEM="S")) S PXCA("ERROR","PROCEDURE",PXCAPRV,PXCAINDX,3)="Specification code must be P|S^"_PXCAITEM
"RTN","PXCACPT",41,0)
 .. S PXCAITEM=+$P(PXCAPROC,U,5)
"RTN","PXCACPT",42,0)
 .. I PXCAITEM D
"RTN","PXCACPT",43,0)
 ... S D=$$ICDDATA^ICDXCODE("DIAG",PXCAITEM,PXDXDATE,"I")
"RTN","PXCACPT",44,0)
 ... I $P(D,U,1)'>0 S PXCA("ERROR","PROCEDURE",PXCAPRV,PXCAINDX,5)="Associated Primary Diagnosis ICD Code not in File 80^"_PXCAITEM
"RTN","PXCACPT",45,0)
 ... E  I $P(D,U,10)'=1 S PXCA("ERROR","PROCEDURE",PXCAPRV,PXCAINDX,1)="Associated Primary Diagnosis ICD code is INACTIVE^"_PXCAITEM
"RTN","PXCACPT",46,0)
 .. S PXCAITEM=+$P(PXCAPROC,U,8)
"RTN","PXCACPT",47,0)
 .. I PXCAITEM D
"RTN","PXCACPT",48,0)
 ... S D=$$ICDDATA^ICDXCODE("DIAG",PXCAITEM,PXDXDATE,"I")
"RTN","PXCACPT",49,0)
 ... I $P(D,U,1)'>0 S PXCA("ERROR","PROCEDURE",PXCAPRV,PXCAINDX,8)="Associated Diagnosis 2 ICD Code not in file 80^"_PXCAITEM
"RTN","PXCACPT",50,0)
 ... E  I $P(D,U,10)'=1 S PXCA("ERROR","PROCEDURE",PXCAPRV,PXCAINDX,8)="Associated Diagnosis 2 ICD Code is INACTIVE^"_PXCAITEM
"RTN","PXCACPT",51,0)
 .. S PXCAITEM=+$P(PXCAPROC,U,9)
"RTN","PXCACPT",52,0)
 .. I PXCAITEM D
"RTN","PXCACPT",53,0)
 ... S D=$$ICDDATA^ICDXCODE("DIAG",PXCAITEM,PXDXDATE,"I")
"RTN","PXCACPT",54,0)
 ... I $P(D,U,1)'>0 S PXCA("ERROR","PROCEDURE",PXCAPRV,PXCAINDX,9)="Associated Diagnosis 3 ICD Code not in file 80^"_PXCAITEM
"RTN","PXCACPT",55,0)
 ... E  I $P(D,U,10)'=1 S PXCA("ERROR","PROCEDURE",PXCAPRV,PXCAINDX,9)="Associated Diagnosis 3 ICD Code is INACTIVE^"_PXCAITEM
"RTN","PXCACPT",56,0)
 .. S PXCAITEM=+$P(PXCAPROC,U,10)
"RTN","PXCACPT",57,0)
 .. I PXCAITEM D
"RTN","PXCACPT",58,0)
 ... S D=$$ICDDATA^ICDXCODE("DIAG",PXCAITEM,PXDXDATE,"I")
"RTN","PXCACPT",59,0)
 ... I $P(D,U,1)'>0 S PXCA("ERROR","PROCEDURE",PXCAPRV,PXCAINDX,10)="Associated Diagnosis 4 ICD Code not in file 80^"_PXCAITEM
"RTN","PXCACPT",60,0)
 ... E  I $P(D,U,10)'=1 S PXCA("ERROR","PROCEDURE",PXCAPRV,PXCAINDX,10)="Associated Diagnosis 4 ICD Code is INACTIVE^"_PXCAITEM
"RTN","PXCACPT",61,0)
 .. S PXCAITEM=+$P(PXCAPROC,U,11)
"RTN","PXCACPT",62,0)
 .. I PXCAITEM D
"RTN","PXCACPT",63,0)
 ... S D=$$ICDDATA^ICDXCODE("DIAG",PXCAITEM,PXDXDATE,"I")
"RTN","PXCACPT",64,0)
 ... I $P(D,U,1)'>0 S PXCA("ERROR","PROCEDURE",PXCAPRV,PXCAINDX,11)="Associated Diagnosis 5 ICD Code not in file 80^"_PXCAITEM
"RTN","PXCACPT",65,0)
 ... E  I $P(D,U,10)'=1 S PXCA("ERROR","PROCEDURE",PXCAPRV,PXCAINDX,11)="Associated Diagnosis 5 ICD Code is INACTIVE^"_PXCAITEM
"RTN","PXCACPT",66,0)
 .. S PXCAITEM=+$P(PXCAPROC,U,12)
"RTN","PXCACPT",67,0)
 .. I PXCAITEM D
"RTN","PXCACPT",68,0)
 ... S D=$$ICDDATA^ICDXCODE("DIAG",PXCAITEM,PXDXDATE,"I")
"RTN","PXCACPT",69,0)
 ... I $P(D,U,1)'>0 S PXCA("ERROR","PROCEDURE",PXCAPRV,PXCAINDX,12)="Associated Diagnosis 6 ICD Code not in file 80^"_PXCAITEM
"RTN","PXCACPT",70,0)
 ... E  I $P(D,U,10)'=1 S PXCA("ERROR","PROCEDURE",PXCAPRV,PXCAINDX,12)="Associated Diagnosis 6 ICD Code is INACTIVE^"_PXCAITEM
"RTN","PXCACPT",71,0)
 .. S PXCAITEM=+$P(PXCAPROC,U,13)
"RTN","PXCACPT",72,0)
 .. I PXCAITEM D
"RTN","PXCACPT",73,0)
 ... S D=$$ICDDATA^ICDXCODE("DIAG",PXCAITEM,PXDXDATE,"I")
"RTN","PXCACPT",74,0)
 ... I $P(D,U,1)'>0 S PXCA("ERROR","PROCEDURE",PXCAPRV,PXCAINDX,13)="Associated Diagnosis 7 ICD Code not in file 80^"_PXCAITEM
"RTN","PXCACPT",75,0)
 ... E  I $P(D,U,10)'=1 S PXCA("ERROR","PROCEDURE",PXCAPRV,PXCAINDX,13)="Associated Diagnosis 7 ICD Code is INACTIVE^"_PXCAITEM
"RTN","PXCACPT",76,0)
 .. S PXCAITEM=+$P(PXCAPROC,U,14)
"RTN","PXCACPT",77,0)
 .. I PXCAITEM D
"RTN","PXCACPT",78,0)
 ... S D=$$ICDDATA^ICDXCODE("DIAG",PXCAITEM,PXDXDATE,"I")
"RTN","PXCACPT",79,0)
 ... I $P(D,U,1)'>0 S PXCA("ERROR","PROCEDURE",PXCAPRV,PXCAINDX,14)="Associated Diagnosis 8 ICD Code not in file 80^"_PXCAITEM
"RTN","PXCACPT",80,0)
 ... E  I $P(D,U,10)'=1 S PXCA("ERROR","PROCEDURE",PXCAPRV,PXCAINDX,14)="Associated Diagnosis 8 ICD Code is INACTIVE^"_PXCAITEM
"RTN","PXCACPT",81,0)
 .. S PXCAITEM=$P(PXCAPROC,U,6),PXCALEN=$L(PXCAITEM)
"RTN","PXCACPT",82,0)
 .. I PXCALEN<2!(PXCALEN>80) S PXCA("ERROR","PROCEDURE",PXCAPRV,PXCAINDX,6)="Provider's PROCEDURE term must be 2-80 Characters^"_PXCAITEM
"RTN","PXCACPT",83,0)
 .. E  D
"RTN","PXCACPT",84,0)
 ... S PXCAPNAR=+$$PROVNARR^PXAPI(PXCAITEM,$S($P(PXCAPROC,"^",1)="":9000010.15,1:9000010.18))
"RTN","PXCACPT",85,0)
 ... I PXCAPNAR'>0 S PXCA("ERROR","PROCEDURE",PXCAPRV,PXCAINDX,6)="Could not get pointer to Provider's PROCEDURE term^"_$P(PXCAPROC,"^",6) Q:'PXCAERRS
"RTN","PXCACPT",86,0)
 ... S $P(PXCAPROC,"^",6)=PXCAPNAR
"RTN","PXCACPT",87,0)
 .. S PXCAITEM=$P(PXCAPROC,U,7),PXCALEN=$L(PXCAITEM)
"RTN","PXCACPT",88,0)
 .. I PXCALEN>0 D
"RTN","PXCACPT",89,0)
 ... I PXCALEN<2!(PXCALEN>80) S PXCA("ERROR","PROCEDURE",PXCAPRV,PXCAINDX,7)="Provider's PROCEDURE grouper must be 2-80 Characters^"_PXCAITEM
"RTN","PXCACPT",90,0)
 ... E  D
"RTN","PXCACPT",91,0)
 .... S PXCANARC=+$$PROVNARR^PXAPI(PXCAITEM,$S($P(PXCAPROC,"^",1)="":9000010.15,1:9000010.18))
"RTN","PXCACPT",92,0)
 .... I PXCANARC'>0 S PXCA("ERROR","PROCEDURE",PXCAPRV,PXCAINDX,7)="Could not get pointer to Provider's PROCEDURE grouper^"_PXCAITEM
"RTN","PXCACPT",93,0)
 .... E  S $P(PXCAPROC,"^",7)=PXCANARC
"RTN","PXCACPT",94,0)
 .. I PXCABULD&'$D(PXCA("ERROR","PROCEDURE",PXCAPRV,PXCAINDX))!PXCAERRS D
"RTN","PXCACPT",95,0)
 ... I $P(PXCAPROC,"^",1)]"" D
"RTN","PXCACPT",96,0)
 .... D CPT^PXCACPT1(.PXCA,PXCAPROC,PXCANUMB,PXCAPRV,PXCAINDX,PXCAERRS)
"RTN","PXCACPT",97,0)
 ... E  D TRT^PXCATRT(PXCAPROC,PXCANUMB,PXCAPRV,PXCAINDX,PXCAERRS,PXCATRT)
"RTN","PXCACPT",98,0)
 Q
"RTN","PXCACPT",99,0)
 ;
"RTN","PXCADXP1")
0^27^B21605401^B24306608
"RTN","PXCADXP1",1,0)
PXCADXP1 ;ISL/dee & LEA/Chylton,SCK - Validates & Translates data from the PCE Device Interface into a call to V POV & update Problem List ;3/20/97
"RTN","PXCADXP1",2,0)
 ;;1.0;PCE PATIENT CARE ENCOUNTER;**24,33,194,199**;Aug 12, 1996;Build 51
"RTN","PXCADXP1",3,0)
 Q
"RTN","PXCADXP1",4,0)
 ;
"RTN","PXCADXP1",5,0)
PART1 ;
"RTN","PXCADXP1",6,0)
 N PXCACLEX,PXDXDATE
"RTN","PXCADXP1",7,0)
 S (PXCADIAG,PXCAPROB)=0
"RTN","PXCADXP1",8,0)
 I "^^^"'[$P(PXCADXPL,"^",5,8) S PXCAPROB=1
"RTN","PXCADXP1",9,0)
 ;Note
"RTN","PXCADXP1",10,0)
 S PXCAITEM=$P($G(PXCA("DIAGNOSIS/PROBLEM",PXCAPRV,PXCAINDX,"NOTE")),"^",1),PXCAITM2=$L(PXCAITEM)
"RTN","PXCADXP1",11,0)
 I PXCAITEM]"" D
"RTN","PXCADXP1",12,0)
 . I PXCAITM2<3!(PXCAITM2>60) S PXCA("ERROR","DIAGNOSIS/PROBLEM",PXCAPRV,PXCAINDX,"NOTE",1)="PROBLEM Note must be 1-60 Characters^"_PXCAITEM
"RTN","PXCADXP1",13,0)
 . S PXCAPROB=1
"RTN","PXCADXP1",14,0)
 ;
"RTN","PXCADXP1",15,0)
 ;Diagnosis Code
"RTN","PXCADXP1",16,0)
 S PXCAITEM=$P(PXCADXPL,"^",1)
"RTN","PXCADXP1",17,0)
 S PXDXDATE=$$CSDATE^PXDXUTL($G(PXCAVSIT))
"RTN","PXCADXP1",18,0)
 I PXCAITEM>0 D
"RTN","PXCADXP1",19,0)
 . S PXCADIQ1=$$ICDDATA^ICDXCODE("DIAG",PXCAITEM,PXDXDATE,"I")
"RTN","PXCADXP1",20,0)
 . I $P(PXCADIQ1,U,1)'>0 S PXCA("ERROR","DIAGNOSIS/PROBLEM",PXCAPRV,PXCAINDX,1)="Diagnosis Code pointer results in a '"_$P(PXCADIQ1,U,2)_"' error.^"_PXCAITEM
"RTN","PXCADXP1",21,0)
 . E  I $P(PXCADIQ1,U,10)'=1 S PXCA("ERROR","DIAGNOSIS/PROBLEM",PXCAPRV,PXCAINDX,1)="Diagnosis Code is INACTIVE^"_PXCAITEM
"RTN","PXCADXP1",22,0)
 ;
"RTN","PXCADXP1",23,0)
 ;Diagnosis Specification Code
"RTN","PXCADXP1",24,0)
 S PXCAITM2=$P(PXCADXPL,"^",2)
"RTN","PXCADXP1",25,0)
 I PXCAITM2'="" D
"RTN","PXCADXP1",26,0)
 . S PXCADIAG=1
"RTN","PXCADXP1",27,0)
 . I '((PXCAITM2="P")!(PXCAITM2="S")!(PXCAITM2="PS")!(PXCAITM2="SP")) S PXCA("ERROR","DIAGNOSIS/PROBLEM",PXCAPRV,PXCAINDX,2)="Diagnosis specification code must be P|S^"_PXCAITM2
"RTN","PXCADXP1",28,0)
 . E  I PXCAITM2["P",PXCAITEM>0 D
"RTN","PXCADXP1",29,0)
 .. I 'PXCAPDX S PXCAPDX=PXCAITEM
"RTN","PXCADXP1",30,0)
 .. E  I $P($G(^PX(815,1,"DI")),"^",2) S PXCA("ERROR","DIAGNOSIS/PROBLEM",PXCAPRV,PXCAINDX,2)="There is already a Primary Diagnosis for this encounter^"_PXCAITM2
"RTN","PXCADXP1",31,0)
 .. E  D
"RTN","PXCADXP1",32,0)
 ... S PXCA("WARNING","DIAGNOSIS/PROBLEM",PXCAPRV,PXCAINDX,2)="There is already a Primary Diagnosis. This one is changed to Secondary^"_PXCAITM2
"RTN","PXCADXP1",33,0)
 ... S $P(PXCADXPL,"^",2)="S"
"RTN","PXCADXP1",34,0)
 . I PXCAITEM'>0 S PXCA("ERROR","DIAGNOSIS/PROBLEM",PXCAPRV,PXCAINDX,1)="Diagnosis Code is required for DIAGNOSIS^"_PXCAITEM
"RTN","PXCADXP1",35,0)
 ;
"RTN","PXCADXP1",36,0)
 ;Clinical Lexicon Term
"RTN","PXCADXP1",37,0)
 S PXCAITEM=$P(PXCADXPL,"^",3)
"RTN","PXCADXP1",38,0)
 I PXCAITEM]"" D
"RTN","PXCADXP1",39,0)
 . I $D(^LEX(757.01)) D
"RTN","PXCADXP1",40,0)
 .. I $D(^LEX(757.01,PXCAITEM,0))#2'=1 S PXCA("ERROR","DIAGNOSIS/PROBLEM",PXCAPRV,PXCAINDX,3)="Lexicon Utility term is not in file 757.01^"_PXCAITEM
"RTN","PXCADXP1",41,0)
 .. E  S PXCACLEX=PXCAITEM
"RTN","PXCADXP1",42,0)
 . E  I $D(^GMP(757.01)) D
"RTN","PXCADXP1",43,0)
 .. I $D(^GMP(757.01,PXCAITEM,0))#2'=1 S PXCA("ERROR","DIAGNOSIS/PROBLEM",PXCAPRV,PXCAINDX,3)="Clinical Lexicon Utility term is not in file 757.01^"_PXCAITEM
"RTN","PXCADXP1",44,0)
 .. E  S PXCACLEX=PXCAITEM
"RTN","PXCADXP1",45,0)
 . E  S PXCA("ERROR","DIAGNOSIS/PROBLEM",PXCAPRV,PXCAINDX,3)="Lexicon Utility is not installed^"_PXCAITEM
"RTN","PXCADXP1",46,0)
 ;
"RTN","PXCADXP1",47,0)
 ;Problem List IEN
"RTN","PXCADXP1",48,0)
 S PXCAITEM=$P(PXCADXPL,"^",4)
"RTN","PXCADXP1",49,0)
 ;Add to Problem List
"RTN","PXCADXP1",50,0)
 S PXCAITM2=$P(PXCADXPL,"^",5)
"RTN","PXCADXP1",51,0)
 I PXCAITEM]"" D
"RTN","PXCADXP1",52,0)
 . I $G(^AUPNPROB(PXCAITEM,0))="" S PXCA("ERROR","DIAGNOSIS/PROBLEM",PXCAPRV,PXCAINDX,4)="Problem not in file 9000011^"_PXCAITEM
"RTN","PXCADXP1",53,0)
 . E  I PXCAPAT'=$P($G(^AUPNPROB(PXCAITEM,0)),"^",2) S PXCA("ERROR","DIAGNOSIS/PROBLEM",PXCAPRV,PXCAINDX,4)="Problem in file 9000011 is for a different Patient^"_PXCAITEM
"RTN","PXCADXP1",54,0)
 . I PXCAITM2=1 S PXCA("ERROR","DIAGNOSIS/PROBLEM",PXCAPRV,PXCAINDX,5)="Cannot ADD existing Problem to file 9000011^"_PXCAITM2
"RTN","PXCADXP1",55,0)
 E  I PXCAPROB,PXCAITM2'=1 S PXCA("ERROR","DIAGNOSIS/PROBLEM",PXCAPRV,PXCAINDX,4)="Cannot update an existing Problem without an IEN to file 9000011^"_PXCAITEM
"RTN","PXCADXP1",56,0)
 I '(PXCAITM2=1!(PXCAITM2=0)!(PXCAITM2="")) S PXCA("ERROR","DIAGNOSIS/PROBLEM",PXCAPRV,PXCAINDX,5)="Add to Problem List flag bad^"_PXCAITM2
"RTN","PXCADXP1",57,0)
 I PXCAITM2=1,PXCAPRV'>0 S PXCA("ERROR","DIAGNOSIS/PROBLEM",PXCAPRV,PXCAINDX,0)="Provider is required to add a new Problem^"_PXCAPRV
"RTN","PXCADXP1",58,0)
 ;
"RTN","PXCADXP1",59,0)
 Q
"RTN","PXCADXP1",60,0)
 ;
"RTN","PXCAPL")
0^28^B30996914^B33553090
"RTN","PXCAPL",1,0)
PXCAPL ;ISL/dee & LEA/Chylton,SCK - Validates data from the PCE Device Interface into a call to update Problem List ;6/6/05
"RTN","PXCAPL",2,0)
 ;;1.0;PCE PATIENT CARE ENCOUNTER;**24,27,115,130,168,194,199**;Aug 12, 1996;Build 51
"RTN","PXCAPL",3,0)
 Q
"RTN","PXCAPL",4,0)
 ;   PXCAPROB  Copy of a Problem node of the PXCA array
"RTN","PXCAPL",5,0)
 ;   PXCAPRV   Pointer to the provider (200)
"RTN","PXCAPL",6,0)
 ;   PXCAINDX  Count of the number of problems for one provider
"RTN","PXCAPL",7,0)
 ;   PXCAPL    The parameter array passed to Problem List
"RTN","PXCAPL",8,0)
 ;   PXCARES   The result back from Problem List
"RTN","PXCAPL",9,0)
 ;   PXCANUMB  Count of the total number of problems
"RTN","PXCAPL",10,0)
 ;
"RTN","PXCAPL",11,0)
 ;
"RTN","PXCAPL",12,0)
PROBLEM(PXCA,PXCABULD,PXCAERRS) ;
"RTN","PXCAPL",13,0)
 Q:'$D(PXCA("PROBLEM"))
"RTN","PXCAPL",14,0)
 I '$D(^AUPNPROB)!($T(UPDATE^GMPLUTL)="") S PXCA("WARNING","PROBLEM",0,0,0)="Problem List Package is not installed" Q
"RTN","PXCAPL",15,0)
 N PXCAINDX,PXCAITEM,PXCAITM2,PXCAPROB,PXCAPRV,PXDXDATE
"RTN","PXCAPL",16,0)
 S PXDXDATE=$S($D(PXCAVSIT)=1:$$CSDATE^PXDXUTL(PXCAVSIT),1:PXCADT)
"RTN","PXCAPL",17,0)
 S PXCAPRV=""
"RTN","PXCAPL",18,0)
 F  S PXCAPRV=$O(PXCA("PROBLEM",PXCAPRV)) Q:PXCAPRV']""  D
"RTN","PXCAPL",19,0)
 . I '$$ACTIVPRV^PXAPI(PXCAPRV,PXCADT) S PXCA("ERROR","PROBLEM",PXCAPRV,0,0)="Provider is not active or valid^"_PXCAPRV
"RTN","PXCAPL",20,0)
 . E  I PXCABULD!PXCAERRS D ANOTHPRV^PXCAPRV(PXCAPRV)
"RTN","PXCAPL",21,0)
 . S PXCAINDX=0
"RTN","PXCAPL",22,0)
 . F  S PXCAINDX=$O(PXCA("PROBLEM",PXCAPRV,PXCAINDX)) Q:PXCAINDX']""  D
"RTN","PXCAPL",23,0)
 .. S PXCAPROB=$G(PXCA("PROBLEM",PXCAPRV,PXCAINDX))
"RTN","PXCAPL",24,0)
 .. I PXCAPROB="" S PXCA("ERROR","PROBLEM",PXCAPRV,PXCAINDX,0)="PROBLEM data missing" Q
"RTN","PXCAPL",25,0)
 .. S PXCAITEM=$P(PXCAPROB,U,1),PXCAITM2=$L(PXCAITEM)
"RTN","PXCAPL",26,0)
 .. I PXCAITEM]"",PXCAITM2<2!(PXCAITM2>80) S PXCA("ERROR","PROBLEM",PXCAPRV,PXCAINDX,1)="Problem Name must be 2-80 Characters^"_PXCAITEM
"RTN","PXCAPL",27,0)
 .. S PXCAITEM=$P(PXCAPROB,U,2)
"RTN","PXCAPL",28,0)
 .. I PXCAITEM]"",PXCAITEM>DT!(PXCAITEM<1800000)!($P(+PXCAITEM,".")'=PXCAITEM)!(PXCAITEM>+$P($P(PXCA("ENCOUNTER"),"^"),".")) S PXCA("ERROR","PROBLEM",PXCAPRV,PXCAINDX,7)="Problem Onset Date is bad^"_PXCAITEM
"RTN","PXCAPL",29,0)
 .. S PXCAITEM=$P(PXCAPROB,U,3)
"RTN","PXCAPL",30,0)
 .. I '(PXCAITEM=1!(PXCAITEM=0)!(PXCAITEM="")) S PXCA("ERROR","PROBLEM",PXCAPRV,PXCAINDX,3)="Problem Active flag bad^"_PXCAITEM
"RTN","PXCAPL",31,0)
 .. E  I PXCAITEM="" S $P(PXCA("PROBLEM",PXCAPRV,PXCAINDX),U,3)=1
"RTN","PXCAPL",32,0)
 .. S PXCAITEM=$P(PXCAPROB,U,4)
"RTN","PXCAPL",33,0)
 .. I PXCAITEM]"",PXCAITEM>DT!(PXCAITEM<1800000)!($P(+PXCAITEM,".")'=PXCAITEM)!(PXCAITEM>+$P($P(PXCA("ENCOUNTER"),"^"),".")) S PXCA("ERROR","PROBLEM",PXCAPRV,PXCAINDX,7)="Problem Resolved Date is bad^"_PXCAITEM
"RTN","PXCAPL",34,0)
 .. S PXCAITEM=$P(PXCAPROB,U,5)
"RTN","PXCAPL",35,0)
 .. I '(PXCAITEM=1!(PXCAITEM=0)!(PXCAITEM="")) S PXCA("ERROR","PROBLEM",PXCAPRV,PXCAINDX,5)="SC flag bad^"_PXCAITEM
"RTN","PXCAPL",36,0)
 .. S PXCAITEM=$P(PXCAPROB,U,6)
"RTN","PXCAPL",37,0)
 .. I '(PXCAITEM=1!(PXCAITEM=0)!(PXCAITEM="")) S PXCA("ERROR","PROBLEM",PXCAPRV,PXCAINDX,6)="AO flag bad^"_PXCAITEM
"RTN","PXCAPL",38,0)
 .. S PXCAITEM=$P(PXCAPROB,U,7)
"RTN","PXCAPL",39,0)
 .. I '(PXCAITEM=1!(PXCAITEM=0)!(PXCAITEM="")) S PXCA("ERROR","PROBLEM",PXCAPRV,PXCAINDX,7)="IR flag bad^"_PXCAITEM
"RTN","PXCAPL",40,0)
 .. S PXCAITEM=$P(PXCAPROB,U,8)
"RTN","PXCAPL",41,0)
 .. I '(PXCAITEM=1!(PXCAITEM=0)!(PXCAITEM="")) S PXCA("ERROR","PROBLEM",PXCAPRV,PXCAINDX,8)="EC flag bad^"_PXCAITEM
"RTN","PXCAPL",42,0)
 .. ;PX*1*115 - ADD MST & HNC
"RTN","PXCAPL",43,0)
 .. S PXCAITEM=$P(PXCAPROB,U,13)
"RTN","PXCAPL",44,0)
 .. I '(PXCAITEM=1!(PXCAITEM=0)!(PXCAITEM="")) S PXCA("ERROR","PROBLEM",PXCAPRV,PXCAINDX,13)="MST flag bad^"_PXCAITEM
"RTN","PXCAPL",45,0)
 .. S PXCAITEM=$P(PXCAPROB,U,14)
"RTN","PXCAPL",46,0)
 .. I '(PXCAITEM=1!(PXCAITEM=0)!(PXCAITEM="")) S PXCA("ERROR","PROBLEM",PXCAPRV,PXCAINDX,14)="HNC flag bad^"_PXCAITEM
"RTN","PXCAPL",47,0)
 .. S PXCAITEM=$P(PXCAPROB,U,15)
"RTN","PXCAPL",48,0)
 .. I '(PXCAITEM=1!(PXCAITEM=0)!(PXCAITEM="")) S PXCA("ERROR","PROBLEM",PXCAPRV,PXCAINDX,14)="CV flag bad^"_PXCAITEM
"RTN","PXCAPL",49,0)
 .. S PXCAITEM=$P(PXCAPROB,U,16)
"RTN","PXCAPL",50,0)
 .. I '(PXCAITEM=1!(PXCAITEM=0)!(PXCAITEM="")) S PXCA("ERROR","PROBLEM",PXCAPRV,PXCAINDX,16)="PROJ 112/SHAD flag bad^"_PXCAITEM
"RTN","PXCAPL",51,0)
 .. S PXCAITEM=$P(PXCAPROB,U,9)
"RTN","PXCAPL",52,0)
 .. I PXCAITEM>0 D
"RTN","PXCAPL",53,0)
 ... S PXCADIQ1=$$ICDDATA^ICDXCODE("DIAG",PXCAITEM,PXDXDATE,"I")
"RTN","PXCAPL",54,0)
 ... I $P(PXCADIQ1,U,1)'>0 S PXCA("ERROR","PROBLEM",PXCAPRV,PXCAINDX,9)="Diagnosis Code pointer results in a '"_$P(PXCADIQ1,U,2)_"' error message.^"_PXCAITEM
"RTN","PXCAPL",55,0)
 ... E  I $P(PXCADIQ1,U,10)'=1 S PXCA("ERROR","PROBLEM",PXCAPRV,PXCAINDX,9)="Diagnosis Code is INACTIVE^"_PXCAITEM
"RTN","PXCAPL",56,0)
 .. S PXCAITEM=$P(PXCAPROB,U,10)
"RTN","PXCAPL",57,0)
 .. I PXCAITEM]"" D
"RTN","PXCAPL",58,0)
 ... I $G(^AUPNPROB(PXCAITEM,0))="" S PXCA("ERROR","PROBLEM",PXCAPRV,PXCAINDX,10)="Problem not in file 9000011^"_PXCAITEM
"RTN","PXCAPL",59,0)
 ... E  I PXCAPAT'=$P($G(^AUPNPROB(PXCAITEM,0)),"^",2) S PXCA("ERROR","PROBLEM",PXCAPRV,PXCAINDX,10)="Problem in file 9000011 is for a different Patient^"_PXCAITEM
"RTN","PXCAPL",60,0)
 .. E  S PXCAITEM=$P(PXCAPROB,U,1) I PXCAITEM']"" S PXCA("ERROR","PROBLEM",PXCAPRV,PXCAINDX,1)="Problem Name required for a new Problem List entry^"_PXCAITEM
"RTN","PXCAPL",61,0)
 .. S PXCAITEM=$P(PXCAPROB,U,11),PXCAITM2=$L(PXCAITEM)
"RTN","PXCAPL",62,0)
 .. I PXCAITM2>60 S PXCA("ERROR","PROBLEM",PXCAPRV,PXCAINDX,11)="PROBLEM comment must be 1-60 Characters^"_PXCAITEM
"RTN","PXCAPL",63,0)
 .. ;
"RTN","PXCAPL",64,0)
 .. ;Clinical Lexicon Term
"RTN","PXCAPL",65,0)
 .. S PXCAITEM=$P(PXCAPROB,"^",12)
"RTN","PXCAPL",66,0)
 .. I PXCAITEM]"" D
"RTN","PXCAPL",67,0)
 ... I $D(^LEX(757.01)) D
"RTN","PXCAPL",68,0)
 .... I $D(^LEX(757.01,PXCAITEM,0))#2'=1 S PXCA("ERROR","PROBLEM",PXCAPRV,PXCAINDX,12)="Lexicon Utility term is not in file 757.01^"_PXCAITEM
"RTN","PXCAPL",69,0)
 .... E  S PXCACLEX=PXCAITEM
"RTN","PXCAPL",70,0)
 ... E  I $D(^GMP(757.01)) D
"RTN","PXCAPL",71,0)
 .... I $D(^GMP(757.01,PXCAITEM,0))#2'=1 S PXCA("ERROR","PROBLEM",PXCAPRV,PXCAINDX,12)="Clinical Lexicon Utility term is not in file 757.01^"_PXCAITEM
"RTN","PXCAPL",72,0)
 .... E  S PXCACLEX=PXCAITEM
"RTN","PXCAPL",73,0)
 ... E  S PXCA("ERROR","PROBLEM",PXCAPRV,PXCAINDX,12)="Lexicon Utility is not installed^"_PXCAITEM
"RTN","PXCAPL",74,0)
 ;
"RTN","PXCAPL",75,0)
 Q
"RTN","PXCAPL",76,0)
 ;
"RTN","PXCAPL1")
0^56^B6900352^B6017229
"RTN","PXCAPL1",1,0)
PXCAPL1 ;ISL/dee & LEA/Chylton - PCE Device Interface data edits Prob List ;06 Oct 2013  5:46 PM
"RTN","PXCAPL1",2,0)
 ;;1.0;PCE PATIENT CARE ENCOUNTER;**33,115,130,168,199**;Aug 12, 1996;Build 51
"RTN","PXCAPL1",3,0)
 ;
"RTN","PXCAPL1",4,0)
 ; Translates data from the PCE Device Interface into a call to
"RTN","PXCAPL1",5,0)
 ; update Problem List
"RTN","PXCAPL1",6,0)
 ;
"RTN","PXCAPL1",7,0)
 Q
"RTN","PXCAPL1",8,0)
 ;   PXCAPROB  Copy of a Problem node of the PXCA array
"RTN","PXCAPL1",9,0)
 ;   PXCAPRV   Pointer to the provider (200)
"RTN","PXCAPL1",10,0)
 ;   PXCAINDX  Count of the number of problems for one provider
"RTN","PXCAPL1",11,0)
 ;   PXCAPL    The parameter array passed to Problem List
"RTN","PXCAPL1",12,0)
 ;   PXCARES   The result back from Problem List
"RTN","PXCAPL1",13,0)
 ;   PXCANUMB  Count of the total number of problems
"RTN","PXCAPL1",14,0)
 ;
"RTN","PXCAPL1",15,0)
PROBLIST ;Problem List
"RTN","PXCAPL1",16,0)
 Q:'$D(^AUPNPROB)!($T(UPDATE^GMPLUTL)="")
"RTN","PXCAPL1",17,0)
 N PXCAPRV,PXCAINDX,PXCANUMB
"RTN","PXCAPL1",18,0)
 S PXCANUMB=0
"RTN","PXCAPL1",19,0)
 S PXCAPRV=""
"RTN","PXCAPL1",20,0)
 F  S PXCAPRV=$O(PXCA("PROBLEM",PXCAPRV)) Q:PXCAPRV'>0  D
"RTN","PXCAPL1",21,0)
 . S PXCAINDX=0
"RTN","PXCAPL1",22,0)
 . F  S PXCAINDX=$O(PXCA("PROBLEM",PXCAPRV,PXCAINDX)) Q:PXCAINDX']""  D
"RTN","PXCAPL1",23,0)
 .. S PXCANUMB=PXCANUMB+1
"RTN","PXCAPL1",24,0)
 .. Q:$D(PXCA("ERROR","PROBLEM",PXCAPRV,PXCAINDX))
"RTN","PXCAPL1",25,0)
 .. N PXCAPROB,PXCAPL,PXCARES
"RTN","PXCAPL1",26,0)
 .. S PXCAPROB=PXCA("PROBLEM",PXCAPRV,PXCAINDX)
"RTN","PXCAPL1",27,0)
 .. S PXCAPL("PROBLEM")=$P(PXCAPROB,"^",10)
"RTN","PXCAPL1",28,0)
 .. S PXCAPL("NARRATIVE")=$P(PXCAPROB,"^",1)
"RTN","PXCAPL1",29,0)
 .. S PXCAPL("PATIENT")=PXCAPAT
"RTN","PXCAPL1",30,0)
 .. S PXCAPL("STATUS")=$S($P(PXCAPROB,"^",3)="1":"A",$P(PXCAPROB,"^",3)="0":"I",1:"A")
"RTN","PXCAPL1",31,0)
 .. S PXCAPL("PROVIDER")=PXCAPRV
"RTN","PXCAPL1",32,0)
 .. S PXCAPL("LOCATION")=PXCAHLOC
"RTN","PXCAPL1",33,0)
 .. S PXCAPL("SC")=$P(PXCAPROB,"^",5)
"RTN","PXCAPL1",34,0)
 .. S PXCAPL("AO")=$P(PXCAPROB,"^",6)
"RTN","PXCAPL1",35,0)
 .. S PXCAPL("IR")=$P(PXCAPROB,"^",7)
"RTN","PXCAPL1",36,0)
 .. S PXCAPL("EC")=$P(PXCAPROB,"^",8)
"RTN","PXCAPL1",37,0)
 .. ;PX*1*115 Add MST & HNC
"RTN","PXCAPL1",38,0)
 .. S PXCAPL("MST")=$P(PXCAPROB,"^",13)
"RTN","PXCAPL1",39,0)
 .. S PXCAPL("HNC")=$P(PXCAPROB,"^",14)
"RTN","PXCAPL1",40,0)
 .. S PXCAPL("CV")=$P(PXCAPROB,"^",15)
"RTN","PXCAPL1",41,0)
 .. S PXCAPL("SHAD")=$P(PXCAPROB,"^",16)
"RTN","PXCAPL1",42,0)
 .. S PXCAPL("DIAGNOSIS")=$P(PXCAPROB,"^",9)
"RTN","PXCAPL1",43,0)
 .. I +$G(PXCAVSIT)>0 S PXCAPL("DX_DATE_OF_INTEREST")=$$CSDATE^PXDXUTL(PXCAVSIT)
"RTN","PXCAPL1",44,0)
 .. S PXCAPL("RESOLVED")=$P(PXCAPROB,"^",4)
"RTN","PXCAPL1",45,0)
 .. S PXCAPL("ONSET")=$P(PXCAPROB,"^",2)
"RTN","PXCAPL1",46,0)
 .. S PXCAPL("COMMENT")=$P(PXCAPROB,"^",11)
"RTN","PXCAPL1",47,0)
 .. S PXCAPL("LEXICON")=$P(PXCAPROB,"^",12)
"RTN","PXCAPL1",48,0)
 .. D UPDATE^GMPLUTL(.PXCAPL,.PXCARES)
"RTN","PXCAPL1",49,0)
 .. I $G(PXCARES)'>0 D
"RTN","PXCAPL1",50,0)
 ... I PXCARES(0)'="Duplicate problem" S PXKERROR("PL",PXCANUMB,0,0)="Problem Not Stored = "_$G(PXCARES(0))_"  For Provider = "_PXCAPRV_"  and index = "_PXCAINDX
"RTN","PXCAPL1",51,0)
 ... S PXCA("WARNING","PROBLEM",PXCAPRV,PXCAINDX,0)="PROBLEM Not Stored^"_$G(PXCARES(0))
"RTN","PXCAPL1",52,0)
 Q
"RTN","PXCAPL1",53,0)
 ;
"RTN","PXCAPL2")
0^57^B9344999^B8360764
"RTN","PXCAPL2",1,0)
PXCAPL2 ;ISL/dee & LEA/Chylton - PCE Device Interface data edits Prob List ;06 Oct 2013  5:54 PM
"RTN","PXCAPL2",2,0)
 ;;1.0;PCE PATIENT CARE ENCOUNTER;**33,115,130,168,199**;Aug 12, 1996;Build 51
"RTN","PXCAPL2",3,0)
 ;
"RTN","PXCAPL2",4,0)
 ; Translates data from the PCE Device Interface for "DIAGNOSIS/PROBLEM"
"RTN","PXCAPL2",5,0)
 ; into a call to update Problem List
"RTN","PXCAPL2",6,0)
 ;
"RTN","PXCAPL2",7,0)
 Q
"RTN","PXCAPL2",8,0)
 ;   PXCADXPL  Copy of a Problem node of the PXCA array
"RTN","PXCAPL2",9,0)
 ;   PXCAPRV   Pointer to the provider (200)
"RTN","PXCAPL2",10,0)
 ;   PXCAINDX  Count of the number of problems for one provider
"RTN","PXCAPL2",11,0)
 ;   PXCAPL    The parameter array passed to Problem List
"RTN","PXCAPL2",12,0)
 ;   PXCARES   The result back from Problem List
"RTN","PXCAPL2",13,0)
 ;   PXCANUMB  Count of the total number of problems
"RTN","PXCAPL2",14,0)
 ;
"RTN","PXCAPL2",15,0)
PROBLIST ;Problem List
"RTN","PXCAPL2",16,0)
 Q:'$D(^AUPNPROB)!($T(UPDATE^GMPLUTL)="")
"RTN","PXCAPL2",17,0)
 N PXCAPRV,PXCAINDX,PXCANUMB
"RTN","PXCAPL2",18,0)
 S PXCANUMB=0
"RTN","PXCAPL2",19,0)
 S PXCAPRV=""
"RTN","PXCAPL2",20,0)
 F  S PXCAPRV=$O(PXCA("DIAGNOSIS/PROBLEM",PXCAPRV)) Q:PXCAPRV'>0  D
"RTN","PXCAPL2",21,0)
 . S PXCAINDX=0
"RTN","PXCAPL2",22,0)
 . F  S PXCAINDX=$O(PXCA("DIAGNOSIS/PROBLEM",PXCAPRV,PXCAINDX)) Q:PXCAINDX']""  D
"RTN","PXCAPL2",23,0)
 .. S PXCANUMB=PXCANUMB+1
"RTN","PXCAPL2",24,0)
 .. ;Quit if there is an error in this node
"RTN","PXCAPL2",25,0)
 .. Q:$D(PXCA("ERROR","DIAGNOSIS/PROBLEM",PXCAPRV,PXCAINDX))
"RTN","PXCAPL2",26,0)
 .. N PXCADXPL,PXCAPL,PXCARES
"RTN","PXCAPL2",27,0)
 .. S PXCADXPL=PXCA("DIAGNOSIS/PROBLEM",PXCAPRV,PXCAINDX)
"RTN","PXCAPL2",28,0)
 .. S PXCAPL("COMMENT")=$P($G(PXCA("DIAGNOSIS/PROBLEM",PXCAPRV,PXCAINDX,"NOTE")),"^",1)
"RTN","PXCAPL2",29,0)
 .. ;Quit if this is not a problem
"RTN","PXCAPL2",30,0)
 .. Q:"^^^"[$P(PXCADXPL,"^",5,8)&(PXCAPL("COMMENT")="")
"RTN","PXCAPL2",31,0)
 .. S PXCAPL("PATIENT")=PXCAPAT
"RTN","PXCAPL2",32,0)
 .. S PXCAPL("PROVIDER")=PXCAPRV
"RTN","PXCAPL2",33,0)
 .. S PXCAPL("LOCATION")=PXCAHLOC
"RTN","PXCAPL2",34,0)
 .. S PXCAPL("DIAGNOSIS")=$P(PXCADXPL,"^",1)
"RTN","PXCAPL2",35,0)
 .. I +$G(PXCAVSIT)>0 S PXCAPL("DX_DATE_OF_INTEREST")=$$CSDATE^PXDXUTL(PXCAVSIT)
"RTN","PXCAPL2",36,0)
 .. S PXCAPL("LEXICON")=$P(PXCADXPL,"^",3)
"RTN","PXCAPL2",37,0)
 .. S PXCAPL("PROBLEM")=$P(PXCADXPL,"^",4)
"RTN","PXCAPL2",38,0)
 .. S PXCAPL("STATUS")=$P(PXCADXPL,"^",6)
"RTN","PXCAPL2",39,0)
 .. S PXCAPL("ONSET")=$P(PXCADXPL,"^",7)
"RTN","PXCAPL2",40,0)
 .. S PXCAPL("RESOLVED")=$P(PXCADXPL,"^",8)
"RTN","PXCAPL2",41,0)
 .. S PXCAPL("SC")=$P(PXCADXPL,"^",9)
"RTN","PXCAPL2",42,0)
 .. S PXCAPL("AO")=$P(PXCADXPL,"^",10)
"RTN","PXCAPL2",43,0)
 .. S PXCAPL("IR")=$P(PXCADXPL,"^",11)
"RTN","PXCAPL2",44,0)
 .. S PXCAPL("EC")=$P(PXCADXPL,"^",12)
"RTN","PXCAPL2",45,0)
 .. ;Add MST & HNC
"RTN","PXCAPL2",46,0)
 .. S PXCAPL("MST")=$P(PXCADXPL,"^",15)
"RTN","PXCAPL2",47,0)
 .. S PXCAPL("HNC")=$P(PXCADXPL,"^",16)
"RTN","PXCAPL2",48,0)
 .. S PXCAPL("CV")=$P(PXCADXPL,"^",17)
"RTN","PXCAPL2",49,0)
 .. S PXCAPL("SHAD")=$P(PXCADXPL,"^",18)
"RTN","PXCAPL2",50,0)
 .. S PXCAPL("NARRATIVE")=$P(PXCADXPL,"^",13)
"RTN","PXCAPL2",51,0)
 .. S:'PXCAPL("PROBLEM") PXCAPL("RECORDED")=$P($P(PXCA("ENCOUNTER"),"^"),".") ;Only if new problem
"RTN","PXCAPL2",52,0)
 .. D UPDATE^GMPLUTL(.PXCAPL,.PXCARES)
"RTN","PXCAPL2",53,0)
 .. I $G(PXCARES)'>0 D
"RTN","PXCAPL2",54,0)
 ... I PXCARES(0)'="Duplicate problem" S PXKERROR("PL",PXCANUMB,0,0)="Problem Not Stored = "_$G(PXCARES(0))_"  For Provider = "_PXCAPRV_"  and index = "_PXCAINDX
"RTN","PXCAPL2",55,0)
 ... S PXCA("WARNING","DIAGNOSIS/PROBLEM",PXCAPRV,PXCAINDX,0)="PROBLEM Not Stored^"_$G(PXCARES(0))
"RTN","PXCAPL2",56,0)
 .. E  I $D(^TMP("PXK",$J,"POV",PXCADNUM(PXCAPRV,PXCAINDX),0,"AFTER"))#2 S $P(^("AFTER"),"^",16)=PXCARES
"RTN","PXCAPL2",57,0)
 Q
"RTN","PXCAPL2",58,0)
 ;
"RTN","PXCAPOV")
0^29^B35019386^B38043079
"RTN","PXCAPOV",1,0)
PXCAPOV ;ISL/dee & LEA/Chylton - Validates data from the PCE Device Interface into PCE's PXK format for POV ;3/20/97
"RTN","PXCAPOV",2,0)
 ;;1.0;PCE PATIENT CARE ENCOUNTER;**24,27,33,121,130,124,168,199**;Aug 12, 1996;Build 51
"RTN","PXCAPOV",3,0)
 Q
"RTN","PXCAPOV",4,0)
 ; Variables
"RTN","PXCAPOV",5,0)
 ;   PXCADIAG  Copy of a Diagnosis node of the PXCA array
"RTN","PXCAPOV",6,0)
 ;   PXCAPRV   Pointer to the provider (200)
"RTN","PXCAPOV",7,0)
 ;   PXCANPOV  Count of the number of POVs
"RTN","PXCAPOV",8,0)
 ;   PXCAINDX  Count of the number of Diagnoses for one provider
"RTN","PXCAPOV",9,0)
 ;
"RTN","PXCAPOV",10,0)
DIAG(PXCA,PXCABULD,PXCAERRS) ;Validation routine for POV
"RTN","PXCAPOV",11,0)
 N PXCADIAG,PXCAINDX,PXCAPRV,PXDXDATE
"RTN","PXCAPOV",12,0)
 S PXDXDATE=$S($D(PXCAVSIT)=1:$$CSDATE^PXDXUTL(PXCAVSIT),$D(PXCADT)=1:PXCADT,1:DT)
"RTN","PXCAPOV",13,0)
 S PXCAPRV=""
"RTN","PXCAPOV",14,0)
 F  S PXCAPRV=$O(PXCA("DIAGNOSIS",PXCAPRV)) Q:PXCAPRV']""  D
"RTN","PXCAPOV",15,0)
 . I PXCAPRV>0 D
"RTN","PXCAPOV",16,0)
 .. I '$$ACTIVPRV^PXAPI(PXCAPRV,PXCADT) S PXCA("ERROR","DIAGNOSIS",PXCAPRV,0,0)="Provider is not active or valid^"_PXCAPRV
"RTN","PXCAPOV",17,0)
 .. E  I PXCABULD!PXCAERRS D ANOTHPRV^PXCAPRV(PXCAPRV)
"RTN","PXCAPOV",18,0)
 . S PXCAINDX=0
"RTN","PXCAPOV",19,0)
 . F  S PXCAINDX=$O(PXCA("DIAGNOSIS",PXCAPRV,PXCAINDX)) Q:PXCAINDX']""  D
"RTN","PXCAPOV",20,0)
 .. S PXCADIAG=$G(PXCA("DIAGNOSIS",PXCAPRV,PXCAINDX))
"RTN","PXCAPOV",21,0)
 .. I PXCADIAG="" S PXCA("ERROR","DIAGNOSIS",PXCAPRV,PXCAINDX,0)="DIAGNOSIS data missing" Q
"RTN","PXCAPOV",22,0)
 .. S PXCANPOV=PXCANPOV+1
"RTN","PXCAPOV",23,0)
 .. N PXCAITEM,PXCAITM2,PXCAPNAR,PXCANARC,PXCACLEX
"RTN","PXCAPOV",24,0)
 .. ;
"RTN","PXCAPOV",25,0)
 .. S PXCAITEM=$P(PXCADIAG,"^",1)
"RTN","PXCAPOV",26,0)
 .. D
"RTN","PXCAPOV",27,0)
 ... N ICDSTR,ICDCN,ICDID
"RTN","PXCAPOV",28,0)
 ... S ICDSTR=$$ICDDATA^ICDXCODE("DIAG",$S(PXCAITEM'="":PXCAITEM,1:-1),PXDXDATE,"I")
"RTN","PXCAPOV",29,0)
 ... S ICDCN=$P(ICDSTR,"^",2)
"RTN","PXCAPOV",30,0)
 ... S ICDID=$P(ICDSTR,"^",12) I $L(ICDID) S ICDID=$$FMTE^XLFDT(ICDID,5)
"RTN","PXCAPOV",31,0)
 ... I +ICDSTR=-1 S PXCA("ERROR","DIAGNOSIS",PXCAPRV,PXCAINDX,1)="Diagnosis Code pointer results in a '"_$P(ICDSTR,U,2)_"' error message.^"_PXCAITEM
"RTN","PXCAPOV",32,0)
 ... E  I '$P(ICDSTR,"^",10) S PXCA("ERROR","DIAGNOSIS",PXCAPRV,PXCAINDX,1)="Diagnosis Code is INACTIVE"_$S($L(ICDID):" as of "_ICDID,1:"")_"^"_PXCAITEM
"RTN","PXCAPOV",33,0)
 ...;
"RTN","PXCAPOV",34,0)
 .. S PXCAITEM=$P(PXCADIAG,"^",2)
"RTN","PXCAPOV",35,0)
 .. I '(PXCAITEM=""!(PXCAITEM="P")!(PXCAITEM="S")) S PXCA("ERROR","DIAGNOSIS",PXCAPRV,PXCAINDX,2)="Diagnosis specification code must be P|S^"_PXCAITEM
"RTN","PXCAPOV",36,0)
 .. E  I PXCAITEM="P" D
"RTN","PXCAPOV",37,0)
 ... I 'PXCAPDX S PXCAPDX=$P(PXCADIAG,"^",1)
"RTN","PXCAPOV",38,0)
 ... E  I $P($G(^PX(815,1,"DI")),"^",2) S PXCA("ERROR","DIAGNOSIS",PXCAPRV,PXCAINDX,2)="There is already a Primary Diagnosis for this encounter^"_PXCAITEM
"RTN","PXCAPOV",39,0)
 ... E  D
"RTN","PXCAPOV",40,0)
 .... S PXCA("WARNING","DIAGNOSIS",PXCAPRV,PXCAINDX,2)="There is already a Primary Diagnosis. This one is changed to Secondary^"_PXCAITEM
"RTN","PXCAPOV",41,0)
 .... S $P(PXCADIAG,"^",2)="S"
"RTN","PXCAPOV",42,0)
 .. S PXCAITEM=$P(PXCADIAG,"^",3)
"RTN","PXCAPOV",43,0)
 .. I '(PXCAITEM=1!(PXCAITEM=0)!(PXCAITEM="")) S PXCA("ERROR","DIAGNOSIS",PXCAPRV,PXCAINDX,3)="SC flag bad^"_PXCAITEM
"RTN","PXCAPOV",44,0)
 .. S PXCAITEM=$P(PXCADIAG,"^",4)
"RTN","PXCAPOV",45,0)
 .. I '(PXCAITEM=1!(PXCAITEM=0)!(PXCAITEM="")) S PXCA("ERROR","DIAGNOSIS",PXCAPRV,PXCAINDX,4)="AO flag bad^"_PXCAITEM
"RTN","PXCAPOV",46,0)
 .. S PXCAITEM=$P(PXCADIAG,"^",5)
"RTN","PXCAPOV",47,0)
 .. I '(PXCAITEM=1!(PXCAITEM=0)!(PXCAITEM="")) S PXCA("ERROR","DIAGNOSIS",PXCAPRV,PXCAINDX,5)="IR flag bad^"_PXCAITEM
"RTN","PXCAPOV",48,0)
 .. S PXCAITEM=$P(PXCADIAG,"^",6)
"RTN","PXCAPOV",49,0)
 .. I '(PXCAITEM=1!(PXCAITEM=0)!(PXCAITEM="")) S PXCA("ERROR","DIAGNOSIS",PXCAPRV,PXCAINDX,6)="EC flag bad^"_PXCAITEM
"RTN","PXCAPOV",50,0)
 .. S PXCAITEM=$P(PXCADIAG,"^",11)
"RTN","PXCAPOV",51,0)
 .. I '(PXCAITEM=1!(PXCAITEM=0)!(PXCAITEM="")) S PXCA("ERROR","DIAGNOSIS",PXCAPRV,PXCAINDX,11)="MST flag bad^"_PXCAITEM
"RTN","PXCAPOV",52,0)
 .. S PXCAITEM=$P(PXCADIAG,"^",12)
"RTN","PXCAPOV",53,0)
 .. I '(PXCAITEM=1!(PXCAITEM=0)!(PXCAITEM="")) S PXCA("ERROR","DIAGNOSIS",PXCAPRV,PXCAINDX,12)="HNC flag bad^"_PXCAITEM
"RTN","PXCAPOV",54,0)
 .. S PXCAITEM=$P(PXCADIAG,"^",13)
"RTN","PXCAPOV",55,0)
 .. I '(PXCAITEM=1!(PXCAITEM=0)!(PXCAITEM="")) S PXCA("ERROR","DIAGNOSIS",PXCAPRV,PXCAINDX,13)="CV flag bad^"_PXCAITEM ;CV
"RTN","PXCAPOV",56,0)
 .. S PXCAITEM=$P(PXCADIAG,"^",14)
"RTN","PXCAPOV",57,0)
 .. I '(PXCAITEM="R"!(PXCAITEM="O")!(PXCAITEM="RO")!(PXCAITEM="")) S PXCA("ERROR","DIAGNOSIS",PXCAPRV,PXCAINDX,14)="Ordering/Resulting field bad^"_PXCAITEM
"RTN","PXCAPOV",58,0)
 .. S PXCAITEM=$P(PXCADIAG,"^",14)
"RTN","PXCAPOV",59,0)
 .. I '(PXCAITEM=1!(PXCAITEM=0)!(PXCAITEM="")) S PXCA("ERROR","DIAGNOSIS",PXCAPRV,PXCAINDX,15)="PROJ 112/SHAD flag bad^"_PXCAITEM
"RTN","PXCAPOV",60,0)
 .. S PXCAITEM=$P(PXCADIAG,"^",7)
"RTN","PXCAPOV",61,0)
 .. I PXCAITEM]"" D
"RTN","PXCAPOV",62,0)
 ... I $G(^AUPNPROB(PXCAITEM,0))="" S PXCA("ERROR","DIAGNOSIS",PXCAPRV,PXCAINDX,7)="Problem not in file 9000011^"_PXCAITEM
"RTN","PXCAPOV",63,0)
 ... E  I PXCAPAT'=$P($G(^AUPNPROB(PXCAITEM,0)),"^",2) S PXCA("ERROR","DIAGNOSIS",PXCAPRV,PXCAINDX,7)="Problem in file 9000011 is for a different Patient^"_PXCAITEM
"RTN","PXCAPOV",64,0)
 .. ;
"RTN","PXCAPOV",65,0)
 .. ;Clinical Lexicon Term
"RTN","PXCAPOV",66,0)
 .. S PXCAITEM=$P(PXCADIAG,"^",10)
"RTN","PXCAPOV",67,0)
 .. I PXCAITEM]"" D
"RTN","PXCAPOV",68,0)
 ... I $D(^LEX(757.01)) D
"RTN","PXCAPOV",69,0)
 .... I $D(^LEX(757.01,PXCAITEM,0))#2'=1 S PXCA("ERROR","DIAGNOSIS",PXCAPRV,PXCAINDX,10)="Lexicon Utility term is not in file 757.01^"_PXCAITEM
"RTN","PXCAPOV",70,0)
 .... E  S PXCACLEX=PXCAITEM
"RTN","PXCAPOV",71,0)
 ... E  I $D(^GMP(757.01)) D
"RTN","PXCAPOV",72,0)
 .... I $D(^GMP(757.01,PXCAITEM,0))#2'=1 S PXCA("ERROR","DIAGNOSIS",PXCAPRV,PXCAINDX,10)="Clinical Lexicon Utility term is not in file 757.01^"_PXCAITEM
"RTN","PXCAPOV",73,0)
 .... E  S PXCACLEX=PXCAITEM
"RTN","PXCAPOV",74,0)
 ... E  S PXCA("ERROR","DIAGNOSIS",PXCAPRV,PXCAINDX,10)="Lexicon Utility is not installed^"_PXCAITEM
"RTN","PXCAPOV",75,0)
 .. ;
"RTN","PXCAPOV",76,0)
 .. D PART1^PXCAPOV1
"RTN","PXCAPOV",77,0)
 .. ;
"RTN","PXCAPOV",78,0)
 .. I PXCABULD&'$D(PXCA("ERROR","DIAGNOSIS",PXCAPRV,PXCAINDX))!PXCAERRS D POV^PXCADX(PXCADIAG,PXCANPOV,PXCAPRV,PXCAERRS)
"RTN","PXCAPOV",79,0)
 Q
"RTN","PXCAPOV",80,0)
 ;
"RTN","PXCAPOV",81,0)
ANOTHPOV(PXCAAPOV) ;
"RTN","PXCAPOV",82,0)
 ;Add the diagnoses to V POV if they are not there.
"RTN","PXCAPOV",83,0)
 ;Quit if the provider subscript is zero
"RTN","PXCAPOV",84,0)
 ; Variables
"RTN","PXCAPOV",85,0)
 ;   PXCAAPOV  Pointer to the ICD DIAGNOSIS file [#80]
"RTN","PXCAPOV",86,0)
 ;   PXCAINDX  Subscript of the diagnosis in the temp array used to
"RTN","PXCAPOV",87,0)
 ;               look to see if the above diagnosis is already known.
"RTN","PXCAPOV",88,0)
 Q:PXCAAPOV'>0
"RTN","PXCAPOV",89,0)
 N PXCAINDX
"RTN","PXCAPOV",90,0)
 ;See if this diagnosis is in the ^TMP(PXCAGLB,$J,
"RTN","PXCAPOV",91,0)
 F PXCAINDX=1:1:PXCANPOV I PXCAAPOV=+$G(^TMP(PXCAGLB,$J,"POV",PXCAINDX,0,"AFTER")) S PXCAINDX=0 Q
"RTN","PXCAPOV",92,0)
 Q:PXCAINDX'>0
"RTN","PXCAPOV",93,0)
 S PXCAINDX=0
"RTN","PXCAPOV",94,0)
 ;See if this diagnosis is already in V POV for this Encounter
"RTN","PXCAPOV",95,0)
 F  S PXCAINDX=$O(^AUPNVPOV("AD",PXCAVSIT,PXCAAPOV)) Q:PXCAINDX'>0  I PXCAAPOV=$P(^AUPNVPOV(PXCAINDX,0),"^",1) Q
"RTN","PXCAPOV",96,0)
 Q:PXCAINDX>0
"RTN","PXCAPOV",97,0)
 S PXCANPOV=PXCANPOV+1
"RTN","PXCAPOV",98,0)
 S ^TMP(PXCAGLB,$J,"POV",PXCANPOV,"IEN")=""
"RTN","PXCAPOV",99,0)
 S ^TMP(PXCAGLB,$J,"POV",PXCANPOV,0,"BEFORE")=""
"RTN","PXCAPOV",100,0)
 S ^TMP(PXCAGLB,$J,"POV",PXCANPOV,0,"AFTER")=PXCAAPOV_"^"_PXCAPAT_"^"_PXCAVSIT_"^^^^^^^^^S"
"RTN","PXCAPOV",101,0)
 S ^TMP(PXCAGLB,$J,"POV",PXCANPOV,812,"BEFORE")=""
"RTN","PXCAPOV",102,0)
 S ^TMP(PXCAGLB,$J,"POV",PXCANPOV,812,"AFTER")="^"_PXCAPKG_"^"_PXCASOR
"RTN","PXCAPOV",103,0)
 Q
"RTN","PXCAPOV",104,0)
 ;
"RTN","PXCASK")
0^30^B15678860^B12106125
"RTN","PXCASK",1,0)
PXCASK ;ISL/dee - Validates & Translates data from the PCE Device Interface into PCE's PXK format for Skin Test ;3/14/97
"RTN","PXCASK",2,0)
 ;;1.0;PCE PATIENT CARE ENCOUNTER;**27,124,199**;Aug 12, 1996;Build 51
"RTN","PXCASK",3,0)
 Q
"RTN","PXCASK",4,0)
 ; Variables
"RTN","PXCASK",5,0)
 ;   PXCASK  Copy of a SKIN TEST node of the PXCA array
"RTN","PXCASK",6,0)
 ;   PXCAPRV   Pointer to the provider (200)
"RTN","PXCASK",7,0)
 ;   PXCANUMB  Count of the number if SKs
"RTN","PXCASK",8,0)
 ;   PXCAINDX  Count of the number of SKIN TEST for one provider
"RTN","PXCASK",9,0)
 ;   PXCAFTER  Temp used to build ^TMP(PXCAGLB,$J,"SK",PXCANUMB,0,"AFTER")
"RTN","PXCASK",10,0)
 ;   PXCAPNAR  Pointer to the provider narrative (9999999.27)
"RTN","PXCASK",11,0)
 ;
"RTN","PXCASK",12,0)
SK(PXCASK,PXCANUMB,PXCAPRV,PXCAERRS) ;
"RTN","PXCASK",13,0)
 N PXCAFTER
"RTN","PXCASK",14,0)
 S PXCAFTER=$P(PXCASK,"^",1)_"^"_PXCAPAT_"^"_PXCAVSIT_"^"
"RTN","PXCASK",15,0)
 S PXCAFTER=PXCAFTER_$P(PXCASK,"^",3)_"^"
"RTN","PXCASK",16,0)
 S PXCAFTER=PXCAFTER_$P(PXCASK,"^",2)_"^"
"RTN","PXCASK",17,0)
 ;PX*1*124
"RTN","PXCASK",18,0)
 S PXCAFTER=PXCAFTER_$P(PXCASK,"^",4)_"^^"_$P(PXCASK,"^",6)_"^"_$P(PXCASK,"^",7)_"^"_$P(PXCASK,"^",8)_"^"_$P(PXCASK,"^",9)_"^"_$P(PXCASK,"^",10)_"^"_$P(PXCASK,"^",11)_"^"_$P(PXCASK,"^",12)_"^"_$P(PXCASK,"^",13)
"RTN","PXCASK",19,0)
 S ^TMP(PXCAGLB,$J,"SK",PXCANUMB,"IEN")=""
"RTN","PXCASK",20,0)
 S ^TMP(PXCAGLB,$J,"SK",PXCANUMB,0,"BEFORE")=""
"RTN","PXCASK",21,0)
 S ^TMP(PXCAGLB,$J,"SK",PXCANUMB,0,"AFTER")=PXCAFTER
"RTN","PXCASK",22,0)
 S ^TMP(PXCAGLB,$J,"SK",PXCANUMB,12,"BEFORE")=""
"RTN","PXCASK",23,0)
 S ^TMP(PXCAGLB,$J,"SK",PXCANUMB,12,"AFTER")=$P(PXCASK,"^",5)_"^^^"_$S(PXCAPRV>0:PXCAPRV,1:"")
"RTN","PXCASK",24,0)
 S ^TMP(PXCAGLB,$J,"SK",PXCANUMB,812,"BEFORE")=""
"RTN","PXCASK",25,0)
 S ^TMP(PXCAGLB,$J,"SK",PXCANUMB,812,"AFTER")="^"_PXCAPKG_"^"_PXCASOR
"RTN","PXCASK",26,0)
 Q
"RTN","PXCASK",27,0)
 ;
"RTN","PXCASK",28,0)
SKINTEST(PXCA,PXCABULD,PXCAERRS) ;Validation routine for SK
"RTN","PXCASK",29,0)
 Q:'$D(PXCA("SKIN TEST"))
"RTN","PXCASK",30,0)
 N ICDDATA,ICDPCE,PXCAINDX,PXCAITEM,PXCANUMB,PXCAPRV,PXCASK,PXDXDATE
"RTN","PXCASK",31,0)
 S PXDXDATE=$S($D(PXCAVSIT)=1:$$CSDATE^PXDXUTL(PXCAVSIT),$D(PXCADT)=1:PXCADT,1:DT)
"RTN","PXCASK",32,0)
 S PXCAPRV="",PXCANUMB=0
"RTN","PXCASK",33,0)
 F  S PXCAPRV=$O(PXCA("SKIN TEST",PXCAPRV)) Q:PXCAPRV']""  D
"RTN","PXCASK",34,0)
 . I PXCAPRV>0 D
"RTN","PXCASK",35,0)
 .. I '$$ACTIVPRV^PXAPI(PXCAPRV,PXCADT) S PXCA("ERROR","SKIN TEST",PXCAPRV,0,0)="Provider is not active or valid^"_PXCAPRV
"RTN","PXCASK",36,0)
 .. E  I PXCABULD!PXCAERRS D ANOTHPRV^PXCAPRV(PXCAPRV)
"RTN","PXCASK",37,0)
 . S PXCAINDX=""
"RTN","PXCASK",38,0)
 . F  S PXCAINDX=$O(PXCA("SKIN TEST",PXCAPRV,PXCAINDX)) Q:PXCAINDX']""  D
"RTN","PXCASK",39,0)
 .. S PXCASK=$G(PXCA("SKIN TEST",PXCAPRV,PXCAINDX))
"RTN","PXCASK",40,0)
 .. S PXCANUMB=PXCANUMB+1
"RTN","PXCASK",41,0)
 .. I PXCASK="" S PXCA("ERROR","SKIN TEST",PXCAPRV,PXCAINDX,0)="SKIN TEST data missing" Q
"RTN","PXCASK",42,0)
 .. S PXCAITEM=+$P(PXCASK,"^",1)
"RTN","PXCASK",43,0)
 .. I $G(^AUTTSK(PXCAITEM,0))="" S PXCA("ERROR","SKIN TEST",PXCAPRV,PXCAINDX,1)="SKIN TEST type not in file 9999999.28^"_PXCAITEM
"RTN","PXCASK",44,0)
 .. S PXCAITEM=$P(PXCASK,"^",2)
"RTN","PXCASK",45,0)
 .. I '((PXCAITEM=(PXCAITEM\1)&(PXCAITEM>-1)&(PXCAITEM<41))!(PXCAITEM="")) S PXCA("ERROR","SKIN TEST",PXCAPRV,PXCAINDX,2)="SKIN TEST reaction must be an integer form 0 to 40^"_PXCAITEM
"RTN","PXCASK",46,0)
 .. S PXCAITEM=$P(PXCASK,"^",3)
"RTN","PXCASK",47,0)
 .. I '(PXCAITEM=""!(PXCAITEM="P")!(PXCAITEM="N")!(PXCAITEM="D")!(PXCAITEM="O")) S PXCA("ERROR","SKIN TEST",PXCAPRV,PXCAINDX,3)="SKIN TEST results must be P|N|D|O^"_PXCAITEM
"RTN","PXCASK",48,0)
 .. F ICDPCE=6:1:13 D
"RTN","PXCASK",49,0)
 ... S PXCAITEM=$P(PXCASK,"^",ICDPCE) I PXCAITEM]"" D
"RTN","PXCASK",50,0)
 .... S ICDDATA=$$ICDDATA^ICDXCODE("DIAG",PXCAITEM,PXDXDATE,"I")
"RTN","PXCASK",51,0)
 .... I $P(ICDDATA,"^",1)'>0 D
"RTN","PXCASK",52,0)
 ..... S PXCA("ERROR","SKIN TEST",PXCAPRV,PXCAINDX,ICDPCE)="SKIN TEST Diagnosis # "_(ICDPCE-5)_" not in file 80^"_PXCAITEM
"RTN","PXCASK",53,0)
 .... E  I $P(ICDDATA,"^",10)'=1 D
"RTN","PXCASK",54,0)
 ..... S PXCA("ERROR","SKIN TEST",PXCAPRV,PXCAINDX,ICDPCE)="SKIN TEST Diagnosis # "_(ICDPCE-5)_" not an ACTIVE ICD Code^"_PXCAITEM
"RTN","PXCASK",55,0)
 .. I PXCABULD&'$D(PXCA("ERROR","SKIN TEST",PXCAPRV,PXCAINDX))!PXCAERRS D SK(PXCASK,.PXCANUMB,PXCAPRV,PXCAERRS)
"RTN","PXCASK",56,0)
 Q
"RTN","PXCASK",57,0)
 ;
"RTN","PXCAVIMM")
0^31^B20851145^B17122556
"RTN","PXCAVIMM",1,0)
PXCAVIMM ;ISL/dee - Validates & Translates data from the PCE Device Interface into PCE's PXK format for Immunizations ;3/14/97
"RTN","PXCAVIMM",2,0)
 ;;1.0;PCE PATIENT CARE ENCOUNTER;**27,124,199**;Aug 12, 1996;Build 51
"RTN","PXCAVIMM",3,0)
 Q
"RTN","PXCAVIMM",4,0)
 ; Variables
"RTN","PXCAVIMM",5,0)
 ;   PXCAIMM  Copy of a IMMUNIZATION node of the PXCA array
"RTN","PXCAVIMM",6,0)
 ;   PXCAPRV   Pointer to the provider (200)
"RTN","PXCAVIMM",7,0)
 ;   PXCANUMB  Count of the number if IMMs
"RTN","PXCAVIMM",8,0)
 ;   PXCAINDX  Count of the number of IMMUNIZATION for one provider
"RTN","PXCAVIMM",9,0)
 ;   PXCAFTER  Temp used to build ^TMP(PXCAGLB,$J,"IMM",PXCANUMB,0,"AFTER")
"RTN","PXCAVIMM",10,0)
 ;   PXCAPNAR  Pointer to the provider narrative (9999999.27)
"RTN","PXCAVIMM",11,0)
 ;
"RTN","PXCAVIMM",12,0)
IMM(PXCAIMM,PXCANUMB,PXCAPRV,PXCAERRS) ;
"RTN","PXCAVIMM",13,0)
 N PXCAFTER
"RTN","PXCAVIMM",14,0)
 S PXCAFTER=$P(PXCAIMM,"^",1)_"^"_PXCAPAT_"^"_PXCAVSIT_"^"
"RTN","PXCAVIMM",15,0)
 S PXCAFTER=PXCAFTER_$P(PXCAIMM,"^",2,4)
"RTN","PXCAVIMM",16,0)
 S ^TMP(PXCAGLB,$J,"IMM",PXCANUMB,"IEN")=""
"RTN","PXCAVIMM",17,0)
 S ^TMP(PXCAGLB,$J,"IMM",PXCANUMB,0,"BEFORE")=""
"RTN","PXCAVIMM",18,0)
 ;PX*1*124
"RTN","PXCAVIMM",19,0)
 S ^TMP(PXCAGLB,$J,"IMM",PXCANUMB,0,"AFTER")=PXCAFTER_"^^"_$P(PXCAIMM,"^",8)_"^"_$P(PXCAIMM,"^",9)_"^"_$P(PXCAIMM,"^",10)_"^"_$P(PXCAIMM,"^",11)_"^"_$P(PXCAIMM,"^",12)_"^"_$P(PXCAIMM,"^",13)_"^"_$P(PXCAIMM,"^",14)_"^"_$P(PXCAIMM,"^",15)
"RTN","PXCAVIMM",20,0)
 S ^TMP(PXCAGLB,$J,"IMM",PXCANUMB,12,"BEFORE")=""
"RTN","PXCAVIMM",21,0)
 S ^TMP(PXCAGLB,$J,"IMM",PXCANUMB,12,"AFTER")=$P(PXCAIMM,"^",6)_"^^^"_$S(PXCAPRV>0:PXCAPRV,1:"")
"RTN","PXCAVIMM",22,0)
 S ^TMP(PXCAGLB,$J,"IMM",PXCANUMB,811,"BEFORE")=""
"RTN","PXCAVIMM",23,0)
 S ^TMP(PXCAGLB,$J,"IMM",PXCANUMB,811,"AFTER")=$P(PXCAIMM,"^",7)
"RTN","PXCAVIMM",24,0)
 S ^TMP(PXCAGLB,$J,"IMM",PXCANUMB,812,"BEFORE")=""
"RTN","PXCAVIMM",25,0)
 S ^TMP(PXCAGLB,$J,"IMM",PXCANUMB,812,"AFTER")="^"_PXCAPKG_"^"_PXCASOR
"RTN","PXCAVIMM",26,0)
 Q
"RTN","PXCAVIMM",27,0)
 ;
"RTN","PXCAVIMM",28,0)
IMMUN(PXCA,PXCABULD,PXCAERRS) ;Validation routine for IMM
"RTN","PXCAVIMM",29,0)
 Q:'$D(PXCA("IMMUNIZATION"))
"RTN","PXCAVIMM",30,0)
 N PXCAIMM,PXCAINDX,PXCAITEM,PXCAITM2,PXCANUMB,PXCAPRV,PXDXDATE
"RTN","PXCAVIMM",31,0)
 S PXDXDATE=$S($D(PXCAVSIT)=1:$$CSDATE^PXDXUTL(PXCAVSIT),$D(PXCADT)=1:PXCADT,1:DT)
"RTN","PXCAVIMM",32,0)
 S PXCAPRV="",PXCANUMB=0
"RTN","PXCAVIMM",33,0)
 F  S PXCAPRV=$O(PXCA("IMMUNIZATION",PXCAPRV)) Q:PXCAPRV']""  D
"RTN","PXCAVIMM",34,0)
 . I PXCAPRV>0 D
"RTN","PXCAVIMM",35,0)
 .. I '$$ACTIVPRV^PXAPI(PXCAPRV,PXCADT) S PXCA("ERROR","IMMUNIZATION",PXCAPRV,0,0)="Provider is not active or valid^"_PXCAPRV
"RTN","PXCAVIMM",36,0)
 .. E  I PXCABULD!PXCAERRS D ANOTHPRV^PXCAPRV(PXCAPRV)
"RTN","PXCAVIMM",37,0)
 . S PXCAINDX=0
"RTN","PXCAVIMM",38,0)
 . F  S PXCAINDX=$O(PXCA("IMMUNIZATION",PXCAPRV,PXCAINDX)) Q:PXCAINDX']""  D
"RTN","PXCAVIMM",39,0)
 .. S PXCAIMM=$G(PXCA("IMMUNIZATION",PXCAPRV,PXCAINDX))
"RTN","PXCAVIMM",40,0)
 .. S PXCANUMB=PXCANUMB+1
"RTN","PXCAVIMM",41,0)
 .. I PXCAIMM="" S PXCA("ERROR","IMMUNIZATION",PXCAPRV,PXCAINDX,0)="IMMUNIZATION data missing" Q
"RTN","PXCAVIMM",42,0)
 .. S PXCAITEM=+$P(PXCAIMM,U,1)
"RTN","PXCAVIMM",43,0)
 .. I $G(^AUTTIMM(PXCAITEM,0))="" S PXCA("ERROR","IMMUNIZATION",PXCAPRV,PXCAINDX,1)="IMMUNIZATION type not in file 9999999.14^"_PXCAITEM
"RTN","PXCAVIMM",44,0)
 .. S PXCAITEM=$P(PXCAIMM,U,2)
"RTN","PXCAVIMM",45,0)
 .. I '(PXCAITEM=""!(PXCAITEM="P")!(PXCAITEM="C")!(PXCAITEM="B")!((PXCAITEM=(PXCAITEM\1))&(PXCAITEM>0)&(PXCAITEM<9))) S PXCA("ERROR","IMMUNIZATION",PXCAPRV,PXCAINDX,2)="IMMUNIZATION series must be P|C|B|1|2|3|4|5|6|7|8^"_PXCAITEM
"RTN","PXCAVIMM",46,0)
 .. S PXCAITEM=$P(PXCAIMM,U,4)
"RTN","PXCAVIMM",47,0)
 .. I '((PXCAITEM=(PXCAITEM\1)&(PXCAITEM>0)&(PXCAITEM<12))!(PXCAITEM="")) S PXCA("ERROR","IMMUNIZATION",PXCAPRV,PXCAINDX,4)="IMMUNIZATION reaction must be an integer form 1 to 11^"_PXCAITEM
"RTN","PXCAVIMM",48,0)
 .. S PXCAITEM=$P(PXCAIMM,U,5)
"RTN","PXCAVIMM",49,0)
 .. I '(PXCAITEM=1!(PXCAITEM=0)!(PXCAITEM="")) S PXCA("ERROR","IMMUNIZATION",PXCAPRV,PXCAINDX,5)="IMMUNIZATION contraindicated flag bad^"_PXCAITEM
"RTN","PXCAVIMM",50,0)
 .. S PXCAITEM=$P(PXCAIMM,U,6)
"RTN","PXCAVIMM",51,0)
 .. S PXCAITEM=$P(PXCAIMM,U,7)
"RTN","PXCAVIMM",52,0)
 .. I $L(PXCAITEM)>80 S PXCA("ERROR","IMMUNIZATION",PXCAPRV,PXCAINDX,6)="IMMUNIZATION remarks must be 1-80 Characters^"_PXCAITEM
"RTN","PXCAVIMM",53,0)
 .. F ICDPCE=8:1:15 D
"RTN","PXCAVIMM",54,0)
 ... S PXCAITEM=$P(PXCAIMM,U,ICDPCE) I PXCAITEM]"" D
"RTN","PXCAVIMM",55,0)
 .... S ICDDATA=$$ICDDATA^ICDXCODE("DIAG",PXCAITEM,PXDXDATE,"I")
"RTN","PXCAVIMM",56,0)
 .... I $P(ICDDATA,U,1)'>0 D
"RTN","PXCAVIMM",57,0)
 ..... S PXCA("ERROR","IMMUNIZATION",PXCAPRV,PXCAINDX,ICDPCE)="IMMUNIZATION Diagnosis # "_(ICDPCE-7)_" not in file 80^"_PXCAITEM
"RTN","PXCAVIMM",58,0)
 .... E  I $P(ICDDATA,U,10)'=1 D
"RTN","PXCAVIMM",59,0)
 ..... S PXCA("ERROR","IMMUNIZATION",PXCAPRV,PXCAINDX,ICDPCE)="IMMUNIZATION Diagnosis # "_(ICDPCE-7)_" not an ACTIVE ICD Code^"_PXCAITEM
"RTN","PXCAVIMM",60,0)
 .. I PXCABULD&'$D(PXCA("ERROR","IMMUNIZATION",PXCAPRV,PXCAINDX))!PXCAERRS D IMM(PXCAIMM,.PXCANUMB,PXCAPRV,PXCAERRS)
"RTN","PXCAVIMM",61,0)
 Q
"RTN","PXCAVIMM",62,0)
 ;
"RTN","PXCEAE1")
0^52^B16220510^B12204747
"RTN","PXCEAE1",1,0)
PXCEAE1 ;ISL/dee,ISA/KWP - Builds the List Manager display of a visit and related v-files ;6/20/96
"RTN","PXCEAE1",2,0)
 ;;1.0;PCE PATIENT CARE ENCOUNTER;**22,73,199**;Aug 12, 1996;Build 51
"RTN","PXCEAE1",3,0)
 ;; ;
"RTN","PXCEAE1",4,0)
 Q
"RTN","PXCEAE1",5,0)
 ;
"RTN","PXCEAE1",6,0)
BUILD(VISITIEN,AEVIEW,ARRAY,ARRAYIX) ;
"RTN","PXCEAE1",7,0)
 ;AEVIEW is "B" for brief display and "D" for expanded display.
"RTN","PXCEAE1",8,0)
 I '$D(^AUPNVSIT(VISITIEN)) S VALMBCK="Q" Q
"RTN","PXCEAE1",9,0)
 N PXCECNT
"RTN","PXCEAE1",10,0)
 D FULL^VALM1
"RTN","PXCEAE1",11,0)
 D CLEAN^VALM10
"RTN","PXCEAE1",12,0)
 K @ARRAYIX
"RTN","PXCEAE1",13,0)
 S (VALMCNT,PXCECNT)=0
"RTN","PXCEAE1",14,0)
 ;
"RTN","PXCEAE1",15,0)
 ;
"RTN","PXCEAE1",16,0)
 N IEN,FILE,VFILE,VROUTINE
"RTN","PXCEAE1",17,0)
 F FILE="SIT","CSTP","PRV","POV","CPT","TRT","IMM","PED","SK","HF","XAM" D
"RTN","PXCEAE1",18,0)
 . S VROUTINE="PXCE"_$S(FILE="IMM":"VIMM",1:FILE)
"RTN","PXCEAE1",19,0)
 . S VFILE=$P($T(FORMAT^@VROUTINE),"~",5)
"RTN","PXCEAE1",20,0)
 . I FILE="SIT" D
"RTN","PXCEAE1",21,0)
 .. S IEN=VISITIEN
"RTN","PXCEAE1",22,0)
 .. D AFILE(IEN,FILE,VFILE,VROUTINE,ARRAY,ARRAYIX,.VALMCNT,.PXCECNT,AEVIEW)
"RTN","PXCEAE1",23,0)
 .. S VALMCNT=VALMCNT+1
"RTN","PXCEAE1",24,0)
 .. S @ARRAY@(VALMCNT,0)=""
"RTN","PXCEAE1",25,0)
 . E  D
"RTN","PXCEAE1",26,0)
 .. S IEN=""
"RTN","PXCEAE1",27,0)
 .. F  S IEN=$O(@VFILE@("AD",VISITIEN,IEN)) Q:'IEN  D AFILE(IEN,FILE,VFILE,VROUTINE,ARRAY,ARRAYIX,.VALMCNT,.PXCECNT,AEVIEW)
"RTN","PXCEAE1",28,0)
 S @ARRAYIX@(0)=PXCECNT
"RTN","PXCEAE1",29,0)
 I VALMCNT=0 S VALMBCK="Q"
"RTN","PXCEAE1",30,0)
 Q
"RTN","PXCEAE1",31,0)
 ;
"RTN","PXCEAE1",32,0)
AFILE(IEN,FILE,VFILE,VROUTINE,ARRAY,ARRAYIX,VALMCNT,PXCECNT,AEVIEW) ;
"RTN","PXCEAE1",33,0)
 N ENTRY,NODE,NODES,NODECNT
"RTN","PXCEAE1",34,0)
 S PXCECNT=PXCECNT+1
"RTN","PXCEAE1",35,0)
 S NODES=$P($T(FORMAT^@VROUTINE),"~",3)
"RTN","PXCEAE1",36,0)
 F NODECNT=1:1 S NODE=$P(NODES,",",NODECNT) Q:NODE']""  S ENTRY(NODE)=$G(@VFILE@(IEN,NODE))
"RTN","PXCEAE1",37,0)
 D DISPLAY(.ENTRY,VROUTINE,ARRAY,ARRAYIX,.VALMCNT,PXCECNT,AEVIEW)
"RTN","PXCEAE1",38,0)
 I FILE="SIT" S @ARRAYIX@(PXCECNT)=VISITIEN_"^VST"
"RTN","PXCEAE1",39,0)
 E  S @ARRAYIX@(PXCECNT)=IEN_"^"_FILE
"RTN","PXCEAE1",40,0)
 Q
"RTN","PXCEAE1",41,0)
 ;
"RTN","PXCEAE1",42,0)
DISPLAY(ENTRY,PXCECODE,ARRAY,ARRAYIX,LINE,COUNT,VIEW) ; -- display the data
"RTN","PXCEAE1",43,0)
 N PXCEFILE,PXCELINE,PXCETEXT,PXCEINT,PXCEEXT
"RTN","PXCEAE1",44,0)
 S PXCEFILE=$P($T(FORMAT^@PXCECODE),"~",2)
"RTN","PXCEAE1",45,0)
 F PXCELINE=1:1 S PXCETEXT=$P($T(FORMAT+PXCELINE^@PXCECODE),";;",2) Q:PXCETEXT']""  D
"RTN","PXCEAE1",46,0)
 . S (PXCEEXT,PXCEINT)=$P(ENTRY($P(PXCETEXT,"~",1)),"^",$P(PXCETEXT,"~",2))
"RTN","PXCEAE1",47,0)
 . I PXCETEXT'["CPT Modifier",PXCEINT="" Q  ;Q:PXCEINT=""
"RTN","PXCEAE1",48,0)
 . Q:$P(PXCETEXT,"~",10)="N"
"RTN","PXCEAE1",49,0)
 . I VIEW'="D",$P(PXCETEXT,"~",10)="D" Q
"RTN","PXCEAE1",50,0)
 . I PXCECODE="PXCECSTP",$P(PXCETEXT,"~",3)=.01 Q
"RTN","PXCEAE1",51,0)
 . I $P(PXCETEXT,"~",6)]"" D  Q:PXCEEXT=""
"RTN","PXCEAE1",52,0)
 .. ;I PXCECODE["CPT",$P(PXCETEXT,"~",6)["DNAR" B  
"RTN","PXCEAE1",53,0)
 .. S @("PXCEEXT="_$P(PXCETEXT,"~",6)_"("""_$S($P(PXCETEXT,"~",3)=.01:ENTRY($P(PXCETEXT,"~",1)),1:PXCEINT)_""")")
"RTN","PXCEAE1",54,0)
 . E  D
"RTN","PXCEAE1",55,0)
 .. N PXCEDILF,DIERR,PXCEI
"RTN","PXCEAE1",56,0)
 .. S PXCEEXT=$$EXTERNAL^DILFD(PXCEFILE,$P(PXCETEXT,"~",3),"",PXCEINT,"PXCEDILF")
"RTN","PXCEAE1",57,0)
 .. S PXCEEXT=$S('$D(DIERR):PXCEEXT,1:PXCEINT)
"RTN","PXCEAE1",58,0)
 . S TEMP=PXCEEXT
"RTN","PXCEAE1",59,0)
 . F PXI=1:1 Q:$P(TEMP,"^",PXI)=""  S PXCEEXT=$P(TEMP,"^",PXI) D ADDLINE
"RTN","PXCEAE1",60,0)
 Q
"RTN","PXCEAE1",61,0)
ADDLINE ;
"RTN","PXCEAE1",62,0)
 S LINE=LINE+1
"RTN","PXCEAE1",63,0)
 I PXCELINE=1!(PXCECODE="PXCECSTP") S @ARRAY@(LINE,0)=$J(COUNT,3)_" "
"RTN","PXCEAE1",64,0)
 E  S @ARRAY@(LINE,0)="    "
"RTN","PXCEAE1",65,0)
 I $P(PXCETEXT,"~",5)["Diagnosis" D
"RTN","PXCEAE1",66,0)
 . N PXDATE,PXACSREC,PXACS
"RTN","PXCEAE1",67,0)
 . S PXDATE=$S($D(PXCEVIEN)=1:$$CSDATE^PXDXUTL(PXCEVIEN),$D(PXCEAPDT)=1:PXCEAPDT,1:DT)
"RTN","PXCEAE1",68,0)
 . S PXACSREC=$$ACTDT^PXDXUTL(PXDATE),PXACS=$P(PXACSREC,"^",3)
"RTN","PXCEAE1",69,0)
 . I PXACS["-" S PXACS=$P(PXACS,"-",1,2)
"RTN","PXCEAE1",70,0)
 . I $P(PXCETEXT,"~",5)'["ICD Code or Diagnosis" D
"RTN","PXCEAE1",71,0)
 .. S $P(PXCETEXT,"~",5)=$P($P(PXCETEXT,"~",5),"Diagnosis",1)_PXACS_" Diagnosis"_$P($P(PXCETEXT,"~",5),"Diagnosis",2)
"RTN","PXCEAE1",72,0)
 . I $P(PXCETEXT,"~",5)["ICD Code or Diagnosis" D
"RTN","PXCEAE1",73,0)
 .. S $P(PXCETEXT,"~",5)=PXACS_$P($P(PXCETEXT,"~",5),"ICD",2)
"RTN","PXCEAE1",74,0)
 S @ARRAY@(LINE,0)=@ARRAY@(LINE,0)_$P(PXCETEXT,"~",5)
"RTN","PXCEAE1",75,0)
 I ($L(@ARRAY@(LINE,0))+$L(PXCEEXT))'>80 D
"RTN","PXCEAE1",76,0)
 . S @ARRAY@(LINE,0)=@ARRAY@(LINE,0)_PXCEEXT
"RTN","PXCEAE1",77,0)
 E  D
"RTN","PXCEAE1",78,0)
 . N PXCEWRAP,PXCECOUN,PXCEHEAD
"RTN","PXCEAE1",79,0)
 . S PXCEHEAD=$L(@ARRAY@(LINE,0))
"RTN","PXCEAE1",80,0)
 . D WRAP^PXCEVFI4(PXCEEXT,80-PXCEHEAD,.PXCEWRAP)
"RTN","PXCEAE1",81,0)
 . S @ARRAY@(LINE,0)=@ARRAY@(LINE,0)_$G(PXCEWRAP(1))
"RTN","PXCEAE1",82,0)
 . S PXCECOUN=1
"RTN","PXCEAE1",83,0)
 . F  S PXCECOUN=$O(PXCEWRAP(PXCECOUN)) Q:PXCECOUN']""  D
"RTN","PXCEAE1",84,0)
 .. S LINE=LINE+1
"RTN","PXCEAE1",85,0)
 .. S @ARRAY@(LINE,0)=$J("",PXCEHEAD)_PXCEWRAP(PXCECOUN)
"RTN","PXCEAE1",86,0)
 Q
"RTN","PXCEAE1",87,0)
 ;
"RTN","PXCECPT")
0^53^B73855102^B65495033
"RTN","PXCECPT",1,0)
PXCECPT ;ISL/dee,ISA/Zoltan,esw - Used to edit and display V CPT ;15 May 2012  10:09 PM
"RTN","PXCECPT",2,0)
 ;;1.0;PCE PATIENT CARE ENCOUNTER;**14,27,73,89,112,121,136,124,170,164,182,199**;Aug 12, 1996;Build 51
"RTN","PXCECPT",3,0)
 ;; ;
"RTN","PXCECPT",4,0)
 Q
"RTN","PXCECPT",5,0)
 ;
"RTN","PXCECPT",6,0)
 ;+Structure of Line with the line label "FORMAT"
"RTN","PXCECPT",7,0)
 ;+;;Long name~File Number~Node Subscripts~Allow Duplicate entries (1=yes, 0=no)~File global name
"RTN","PXCECPT",8,0)
 ;+      1         2             3                   4                                   5
"RTN","PXCECPT",9,0)
 ;+
"RTN","PXCECPT",10,0)
 ;+Structure of Following lines:
"RTN","PXCECPT",11,0)
 ;+;;Node~Piece~,Field Number~Edit Label~Display Label~Display Routine~Edit Routine~Help Text for DIR("?")~Set of PXCEKEYS that can Edit~D if Detail Display Only~
"RTN","PXCECPT",12,0)
 ;+   1  ~  2  ~      3      ~     4    ~        5    ~        6      ~     7      ~       8              ~          9                  ~         10
"RTN","PXCECPT",13,0)
 ;+The Display & Edit routines are for special cases.
"RTN","PXCECPT",14,0)
 ;+  (The .01 fields cannot have a special edit.)
"RTN","PXCECPT",15,0)
 ;
"RTN","PXCECPT",16,0)
FORMAT ;;CPT~9000010.18~0,1,12,802,811,812~1~^AUPNVCPT
"RTN","PXCECPT",17,0)
 ;;0~1~.01~CPT Code:  ~CPT Code:  ~$$DISPLY01^PXCECPT~ECPTCODE^PXCECPT~^D HELP^PXCEHELP~~B
"RTN","PXCECPT",18,0)
 ;;0~19~.19~Department Code:  ~Department Code:  ~~DEPART^PXCECPT1~~~D
"RTN","PXCECPT",19,0)
 ;;0~17~.17~Order Reference:  ~Order Reference:  ~~SKIP^PXCECPT~~~D
"RTN","PXCECPT",20,0)
 ;;1~0~1~CPT Modifier:  ~CPT Modifier:  ~$$DISPMOD^PXCECPT~ECPTMOD^PXCECPT~Select a Modifier that is valid for the CPT code.~~B
"RTN","PXCECPT",21,0)
 ;;0~4~.04~Provider Narrative:  ~Provider Narrative:  ~$$DNARRAT^PXCECPT~ENARRAT^PXCEPOV1(1,1,1,81,2)~~~B
"RTN","PXCECPT",22,0)
 ;;0~16~.16~Quantity:  ~Quantity:  ~~EQUAN^PXCECPT~~~D
"RTN","PXCECPT",23,0)
 ;;0~7~.07~Principal Procedure:  ~Principal Procedure:  ~~~~~D
"RTN","PXCECPT",24,0)
 ;;12~2~1202~Ordering Provider:  ~Ordering Provider:  ~~EPROV12^PXCEPRV~~~D
"RTN","PXCECPT",25,0)
 ;;12~4~1204~Encounter Provider:  ~Encounter Provider:  ~~EPROV12^PXCEPRV~~~D
"RTN","PXCECPT",26,0)
 ;;802~1~80201~Provider Narrative Category:  ~Provider Narrative Category:  ~$$DNARRAT^PXCECPT~ENARRAT^PXCEPOV1(0,2,0,81,3)~~C~D
"RTN","PXCECPT",27,0)
 ;;811~1~81101~Comments:  ~Comments:  ~~~~~D
"RTN","PXCECPT",28,0)
 ;;0~5~.05~Primary Diagnosis:  ~Primary Diagnosis:  ~$$DISPLY01^PXCEPOV~EPOV^PXCECPT~~~
"RTN","PXCECPT",29,0)
 ;;0~9~.09~1st Secondary Diagnosis:  ~1st Secondary Diagnosis:  ~$$DISPLY01^PXCEPOV~EPOV^PXCECPT~~~
"RTN","PXCECPT",30,0)
 ;;0~10~.1~2nd Secondary Diagnosis:  ~2nd Secondary Diagnosis:  ~$$DISPLY01^PXCEPOV~EPOV^PXCECPT~~~
"RTN","PXCECPT",31,0)
 ;;0~11~.11~3rd Secondary Diagnosis:  ~3rd Secondary Diagnosis:  ~$$DISPLY01^PXCEPOV~EPOV^PXCECPT~~~
"RTN","PXCECPT",32,0)
 ;;0~12~.12~4th Secondary Diagnosis:  ~4th Secondary Diagnosis:  ~$$DISPLY01^PXCEPOV~EPOV^PXCECPT~~~
"RTN","PXCECPT",33,0)
 ;;0~13~.13~5th Secondary Diagnosis:  ~5th Secondary Diagnosis:  ~$$DISPLY01^PXCEPOV~EPOV^PXCECPT~~~
"RTN","PXCECPT",34,0)
 ;;0~14~.14~6th Secondary Diagnosis:  ~6th Secondary Diagnosis:  ~$$DISPLY01^PXCEPOV~EPOV^PXCECPT~~~
"RTN","PXCECPT",35,0)
 ;;0~15~.15~7th Secondary Diagnosis:  ~7th Secondary Diagnosis:  ~$$DISPLY01^PXCEPOV~EPOV^PXCECPT~~~
"RTN","PXCECPT",36,0)
 ;;
"RTN","PXCECPT",37,0)
 ;
"RTN","PXCECPT",38,0)
 ;The interface for AICS to get list on form for help.
"RTN","PXCECPT",39,0)
INTRFACE ;;DG SELECT CPT PROCEDURE CODES
"RTN","PXCECPT",40,0)
 ;+
"RTN","PXCECPT",41,0)
 ;+********************************
"RTN","PXCECPT",42,0)
 ;+Special cases for display.
"RTN","PXCECPT",43,0)
 ;
"RTN","PXCECPT",44,0)
DISPMOD(PXCECPT) ;
"RTN","PXCECPT",45,0)
 ;+Display the modifiers associated with this V CPT entry.
"RTN","PXCECPT",46,0)
 ;+PXCECPT = IEN in V CPT file.
"RTN","PXCECPT",47,0)
 N MODS,SIEN,MODIEN,SCRATCH,MODSTR,MODNAME,OUTSTR
"RTN","PXCECPT",48,0)
 I $G(PXCECPT)="" S PXCECPT=IEN
"RTN","PXCECPT",49,0)
 S OUTSTR=""
"RTN","PXCECPT",50,0)
 I PXCECPT="" Q OUTSTR
"RTN","PXCECPT",51,0)
 S SIEN=0
"RTN","PXCECPT",52,0)
 F MODS=1:1 S SIEN=$O(^AUPNVCPT(PXCECPT,1,SIEN)) Q:'SIEN  D
"RTN","PXCECPT",53,0)
 . S MODIEN=$P($G(^AUPNVCPT(PXCECPT,1,SIEN,0)),"^")
"RTN","PXCECPT",54,0)
 . S $P(OUTSTR,U,MODS)=$$MODTEXT(MODIEN)
"RTN","PXCECPT",55,0)
 Q OUTSTR
"RTN","PXCECPT",56,0)
DNARRAT(PNAR) ;+Display Provider Narrative for procedure in V CPT file.
"RTN","PXCECPT",57,0)
 I PNAR="" Q ""
"RTN","PXCECPT",58,0)
 N PXCEPNAR
"RTN","PXCECPT",59,0)
 S PXCEPNAR=$P(^AUTNPOV(PNAR,0),"^")
"RTN","PXCECPT",60,0)
 I $G(VIEW)="B",$D(ENTRY)>0 D
"RTN","PXCECPT",61,0)
 . ;N DIC,DR,DA,DIQ,PXCEDIQ1
"RTN","PXCECPT",62,0)
 . ;S DIC=81
"RTN","PXCECPT",63,0)
 . ;S DR="2"
"RTN","PXCECPT",64,0)
 . ;S DA=$P(ENTRY(0),"^",1)
"RTN","PXCECPT",65,0)
 . ;S DIQ="PXCEDIQ1("
"RTN","PXCECPT",66,0)
 . ;S DIQ(0)="E"
"RTN","PXCECPT",67,0)
 . ;D EN^DIQ1
"RTN","PXCECPT",68,0)
 . ;S:PXCEDIQ1(81,DA,2,"E")=PXCEPNAR PXCEPNAR=""
"RTN","PXCECPT",69,0)
 . N CPTSTR
"RTN","PXCECPT",70,0)
 . S CPTSTR=$$CPT^ICPTCOD($P(ENTRY(0),U),$P(^AUPNVSIT(PXCEVIEN,0),U))
"RTN","PXCECPT",71,0)
 . S:$P(CPTSTR,U,3)=PXCEPNAR PXCEPNAR=""
"RTN","PXCECPT",72,0)
 Q PXCEPNAR
"RTN","PXCECPT",73,0)
 ;+
"RTN","PXCECPT",74,0)
 ;+********************************
"RTN","PXCECPT",75,0)
 ;+Special cases for edit.
"RTN","PXCECPT",76,0)
 ;+
"RTN","PXCECPT",77,0)
ECPTCODE ;+Code to edit CPT Code in V CPT file.
"RTN","PXCECPT",78,0)
 K DIRUT
"RTN","PXCECPT",79,0)
 N DIC,DA,PXCPTDT,PXDFLT
"RTN","PXCECPT",80,0)
 S PXCPTDT=+^TMP("PXK",$J,"VST",1,0,"AFTER")
"RTN","PXCECPT",81,0)
 S (X,PXDFLT)=""
"RTN","PXCECPT",82,0)
 I $P(PXCEAFTR($P(PXCETEXT,"~",1)),"^",$P(PXCETEXT,"~",2))'="" D
"RTN","PXCECPT",83,0)
 . N DIERR,PXCEDILF,PXCEINT,PXCEEXT
"RTN","PXCECPT",84,0)
 . S PXCEINT=$P(PXCEAFTR($P(PXCETEXT,"~",1)),"^",$P(PXCETEXT,"~",2))
"RTN","PXCECPT",85,0)
 . S PXCEEXT=$$EXTERNAL^DILFD(PXCEFILE,$P(PXCETEXT,"~",3),"",PXCEINT,"PXCEDILF")
"RTN","PXCECPT",86,0)
 . S PXDFLT=$S('$D(DIERR):PXCEEXT,1:PXCEINT)
"RTN","PXCECPT",87,0)
 S Y=$$GETCODE^PXCPTAPI(PXDFLT,PXCPTDT)
"RTN","PXCECPT",88,0)
 I Y="@" S X="@" Q
"RTN","PXCECPT",89,0)
 I Y<0 S DIRUT=1 Q
"RTN","PXCECPT",90,0)
 S PXCEMOD=$P(Y,"-",2)
"RTN","PXCECPT",91,0)
 S Y=$P(Y,"-"),X=+Y
"RTN","PXCECPT",92,0)
 I PXCEDIRB="" Q
"RTN","PXCECPT",93,0)
 I $P(PXCEAFTR($P(PXCETEXT,"~",1)),"^",$P(PXCETEXT,"~",2))=X Q
"RTN","PXCECPT",94,0)
 Q:$$CHGCPT()
"RTN","PXCECPT",95,0)
 G ECPTCODE
"RTN","PXCECPT",96,0)
 ;
"RTN","PXCECPT",97,0)
ECPTMOD ;+Prompt for CPT Modifier in V CPT file.
"RTN","PXCECPT",98,0)
 ;
"RTN","PXCECPT",99,0)
 ;--If there are no modifiers for CPT code do not prompt
"RTN","PXCECPT",100,0)
 Q:PXMDCNT'>0
"RTN","PXCECPT",101,0)
 N DTOUT,DUOUT,DIROUT,DIR,PXSUB,PXSEQ,PXSTR,PXARR
"RTN","PXCECPT",102,0)
 N DA,DIC,PXLINE,SUBIEN,PXFILE,PXMOD,PXI
"RTN","PXCECPT",103,0)
 S PXSUB=1,PXSTR=""
"RTN","PXCECPT",104,0)
 S DA=^TMP("PXK",$J,PXCECATS,1,"IEN")
"RTN","PXCECPT",105,0)
 S DR=1
"RTN","PXCECPT",106,0)
 S DIE="^AUPNVCPT("
"RTN","PXCECPT",107,0)
 S DIC(0)="AELMQ"
"RTN","PXCECPT",108,0)
 L +@(DIE_"DA)"):10
"RTN","PXCECPT",109,0)
 I $G(PXCEMOD)]"" D
"RTN","PXCECPT",110,0)
 . I $L(PXCEMOD,",")=1 S DR="1//"_PXCEMOD Q
"RTN","PXCECPT",111,0)
 . S PXMOD=""
"RTN","PXCECPT",112,0)
 . F PXI=1:1 S PXMOD=$P(PXCEMOD,",",PXI) Q:PXMOD=""  D
"RTN","PXCECPT",113,0)
 .. K PXERR
"RTN","PXCECPT",114,0)
 .. D VAL^DIE(9000010.181,DA,.01,"",PXMOD,.PXERR)
"RTN","PXCECPT",115,0)
 .. Q:PXERR="^"
"RTN","PXCECPT",116,0)
 .. S DR="1///^S X=PXMOD"
"RTN","PXCECPT",117,0)
 .. D ^DIE
"RTN","PXCECPT",118,0)
 . S DR=1
"RTN","PXCECPT",119,0)
 D ^DIE
"RTN","PXCECPT",120,0)
 L -@(DIE_"DA)")
"RTN","PXCECPT",121,0)
 ; SET NEWLY FILED CPT MODIFIERS INTO LOCAL ARRAY
"RTN","PXCECPT",122,0)
 K PXCEAFTR(1)
"RTN","PXCECPT",123,0)
 D GETS^DIQ(9000010.18,^TMP("PXK",$J,PXCECATS,1,"IEN"),"1*","I","PXARR")
"RTN","PXCECPT",124,0)
 S PXFILE=9000010.181
"RTN","PXCECPT",125,0)
 S PXSUB=""
"RTN","PXCECPT",126,0)
 F  S PXSUB=$O(PXARR(PXFILE,PXSUB)) Q:PXSUB=""  D
"RTN","PXCECPT",127,0)
 . S PXCEAFTR(1,$P(PXSUB,","))=PXARR(PXFILE,PXSUB,.01,"I")
"RTN","PXCECPT",128,0)
 I $D(DTOUT)!$D(Y) S (PXCEEND,PXCEQUIT)=1 Q
"RTN","PXCECPT",129,0)
 Q
"RTN","PXCECPT",130,0)
 ;
"RTN","PXCECPT",131,0)
EQUAN ;+Code to edit Quantity in V CPT file.
"RTN","PXCECPT",132,0)
 I $P(PXCEAFTR($P(PXCETEXT,"~",1)),"^",$P(PXCETEXT,"~",2))'="" D
"RTN","PXCECPT",133,0)
 . N DIERR,PXCEDILF,PXCEINT,PXCEEXT
"RTN","PXCECPT",134,0)
 . S PXCEINT=$P(PXCEAFTR($P(PXCETEXT,"~",1)),"^",$P(PXCETEXT,"~",2))
"RTN","PXCECPT",135,0)
 . S PXCEEXT=$$EXTERNAL^DILFD(PXCEFILE,$P(PXCETEXT,"~",3),"",PXCEINT,"PXCEDILF")
"RTN","PXCECPT",136,0)
 . S DIR("B")=$S('$D(DIERR):PXCEEXT,1:PXCEINT)
"RTN","PXCECPT",137,0)
 E  S DIR("B")=1
"RTN","PXCECPT",138,0)
 S DIR(0)=PXCEFILE_","_$P(PXCETEXT,"~",3)_"A"
"RTN","PXCECPT",139,0)
 S DIR("A")=$P(PXCETEXT,"~",4)
"RTN","PXCECPT",140,0)
 S:$P(PXCETEXT,"~",8)]"" DIR("?")=$P(PXCETEXT,"~",8)
"RTN","PXCECPT",141,0)
 D ^DIR
"RTN","PXCECPT",142,0)
 K DIR,DA
"RTN","PXCECPT",143,0)
 I $D(DTOUT)!$D(DUOUT) S (PXCEEND,PXCEQUIT)=1 Q
"RTN","PXCECPT",144,0)
 I +Y<1 W !,$C(7),"Quantity is required.",! G EQUAN
"RTN","PXCECPT",145,0)
 N PXTMPCPT S PXTMPCPT=$P(PXCEAFTR($P(PXCETEXT,"~")),"^")
"RTN","PXCECPT",146,0)
 I +Y>1,$$GET1^DIQ(357.69,$G(PXCEIN01),.01)>0,$$GET1^DIQ(357.69,$G(PXCEIN01),.06,"I")'="Y" D
"RTN","PXCECPT",147,0)
 .W !,"E&M code, quantity changed to 1."
"RTN","PXCECPT",148,0)
 .S $P(Y,"^")=1
"RTN","PXCECPT",149,0)
 S:$P(Y,"^")="" Y=1
"RTN","PXCECPT",150,0)
 S $P(PXCEAFTR($P(PXCETEXT,"~",1)),"^",$P(PXCETEXT,"~",2))=$P(Y,"^")
"RTN","PXCECPT",151,0)
 Q
"RTN","PXCECPT",152,0)
EPOV ;Edit the Associated DX
"RTN","PXCECPT",153,0)
 N PXACS,PXACSREC,PXDATE,PXDEF,PXDXASK,PXXX
"RTN","PXCECPT",154,0)
 S PXDATE=$S($D(PXCEVIEN)=1:$$CSDATE^PXDXUTL(PXCEVIEN),$D(PXCEAPDT)=1:PXCEAPDT,1:DT)
"RTN","PXCECPT",155,0)
 S PXACSREC=$$ACTDT^PXDXUTL(PXDATE),PXACS=$P(PXACSREC,"^",3)
"RTN","PXCECPT",156,0)
 I PXACS["-" S PXACS=$P(PXACS,"-",1,2)
"RTN","PXCECPT",157,0)
 I $P(PXCEAFTR($P(PXCETEXT,"~",1)),"^",$P(PXCETEXT,"~",2))'="" D
"RTN","PXCECPT",158,0)
 .N DIERR,PXCEDILF,PXCEINT,PXCEEXT
"RTN","PXCECPT",159,0)
 .S PXCEINT=$P(PXCEAFTR($P(PXCETEXT,"~",1)),"^",$P(PXCETEXT,"~",2))
"RTN","PXCECPT",160,0)
 .S PXCEEXT=$$EXTERNAL^DILFD(PXCEFILE,$P(PXCETEXT,"~",3),"",PXCEINT,"PXCEDILF")
"RTN","PXCECPT",161,0)
 .S DIR("B")=$S('$D(DIERR):PXCEEXT,1:PXCEINT)
"RTN","PXCECPT",162,0)
 I $P(PXACSREC,U,1)'="ICD" D
"RTN","PXCECPT",163,0)
 . S PXDXASK=$P($P(PXCETEXT,"~",4),"Diagnosis:",1)_PXACS_" Diagnosis:  "
"RTN","PXCECPT",164,0)
 . S PXDEF=$G(DIR("B")),PXAGAIN=0 D ^PXDSLK I PXXX=-1 S Y=-1 Q
"RTN","PXCECPT",165,0)
 . I PXXX="@" S Y="@" Q
"RTN","PXCECPT",166,0)
 . S Y=$P($$ICDDATA^ICDXCODE("DIAG",$P($P(PXXX,U,1),";",2),PXDATE,"E"),U,1)
"RTN","PXCECPT",167,0)
 I $P(PXACSREC,U,1)="ICD" D
"RTN","PXCECPT",168,0)
 . S DIR(0)=PXCEFILE_","_$P(PXCETEXT,"~",3)_"A"
"RTN","PXCECPT",169,0)
 . S DIR("A")=$P($P(PXCETEXT,"~",4),"Diagnosis:",1)_PXACS_" Diagnosis:  "
"RTN","PXCECPT",170,0)
 . S:$P(PXCETEXT,"~",8)]"" DIR("?")=$P(PXCETEXT,"~",8)
"RTN","PXCECPT",171,0)
 . D ^DIR
"RTN","PXCECPT",172,0)
 K DIR,DA
"RTN","PXCECPT",173,0)
 I X="@" S Y="@" S $P(PXCEAFTR($P(PXCETEXT,"~",1)),"^",$P(PXCETEXT,"~",2))=$P(Y,"^") Q
"RTN","PXCECPT",174,0)
 I $D(DTOUT)!$D(DUOUT) S PXCEEND=1,PXCEQUIT=1 Q
"RTN","PXCECPT",175,0)
 ;I '+Y S PXCEEND=1 Q  ;S:$P(PXCETEXT,"~",3)=".05" PXCEQUIT=1 Q
"RTN","PXCECPT",176,0)
 I +Y'>0 S PXCEEND=1 Q  ;PX*1.0*182 for "^" or null entry from list
"RTN","PXCECPT",177,0)
 ;See if this diagnosis is in the PXCEAFTR(0)
"RTN","PXCECPT",178,0)
 I $P(PXCETEXT,"~",2)'=5,(+Y=$P($G(PXCEAFTR(0)),"^",5)) S PXCEEND=1
"RTN","PXCECPT",179,0)
 I $P(PXCETEXT,"~",2)'=9,(+Y=$P($G(PXCEAFTR(0)),"^",9)) S PXCEEND=1
"RTN","PXCECPT",180,0)
 I $P(PXCETEXT,"~",2)'=10,(+Y=$P($G(PXCEAFTR(0)),"^",10)) S PXCEEND=1
"RTN","PXCECPT",181,0)
 I $P(PXCETEXT,"~",2)'=11,(+Y=$P($G(PXCEAFTR(0)),"^",11)) S PXCEEND=1
"RTN","PXCECPT",182,0)
 I $P(PXCETEXT,"~",2)'=12,(+Y=$P($G(PXCEAFTR(0)),"^",12)) S PXCEEND=1
"RTN","PXCECPT",183,0)
 I $P(PXCETEXT,"~",2)'=13,(+Y=$P($G(PXCEAFTR(0)),"^",13)) S PXCEEND=1
"RTN","PXCECPT",184,0)
 I $P(PXCETEXT,"~",2)'=14,(+Y=$P($G(PXCEAFTR(0)),"^",14)) S PXCEEND=1
"RTN","PXCECPT",185,0)
 I $P(PXCETEXT,"~",2)'=15,(+Y=$P($G(PXCEAFTR(0)),"^",15)) S PXCEEND=1
"RTN","PXCECPT",186,0)
 I PXCEEND=1 W !,$C(7),"Duplicate Diagnosis on this CPT code is not allowed." D WAIT^PXCEHELP Q
"RTN","PXCECPT",187,0)
 S $P(PXCEAFTR($P(PXCETEXT,"~",1)),"^",$P(PXCETEXT,"~",2))=$P(Y,"^")
"RTN","PXCECPT",188,0)
 D:+Y>0 DIAGNOS^PXCEVFI4(+Y)
"RTN","PXCECPT",189,0)
 Q
"RTN","PXCECPT",190,0)
 ;+
"RTN","PXCECPT",191,0)
 ;+********************************
"RTN","PXCECPT",192,0)
 ;+Special Reusable Functionality
"RTN","PXCECPT",193,0)
DISPLY01(PXCECPT) ;
"RTN","PXCECPT",194,0)
 ;Display text for the .01 field which is a pointer to ^ICPT.
"RTN","PXCECPT",195,0)
 ;Also called with the Evaluation and Management Code from the visit
"RTN","PXCECPT",196,0)
 ;  in the parameter.
"RTN","PXCECPT",197,0)
 ;(Must have is called by ASK^PXCEVFI2 and DEL^PXCEVFI2.)
"RTN","PXCECPT",198,0)
 ;N DIC,DR,DA,DIQ,PXCEFNUM,PXCEDIQ1
"RTN","PXCECPT",199,0)
 ;S (DIC,PXCEFNUM)=81
"RTN","PXCECPT",200,0)
 ;S DR=".01;2"
"RTN","PXCECPT",201,0)
 ;S DA=+$P(PXCECPT,"^",1)
"RTN","PXCECPT",202,0)
 ;S DIQ="PXCEDIQ1("
"RTN","PXCECPT",203,0)
 ;S DIQ(0)="E"
"RTN","PXCECPT",204,0)
 ;D EN^DIQ1
"RTN","PXCECPT",205,0)
 ;Q PXCEDIQ1(PXCEFNUM,DA,.01,"E")_"     "_PXCEDIQ1(PXCEFNUM,DA,2,"E")
"RTN","PXCECPT",206,0)
 N CPTSTR
"RTN","PXCECPT",207,0)
 S CPTSTR=$$CPT^ICPTCOD($P(PXCECPT,U),$P(^AUPNVSIT(PXCEVIEN,0),U))
"RTN","PXCECPT",208,0)
 Q $P(CPTSTR,U,2)_"     "_$P(CPTSTR,U,3)
"RTN","PXCECPT",209,0)
EDMOD(MODS,CPT) ;+Edit the Modifiers for a CPT code entry.
"RTN","PXCECPT",210,0)
 N MNUM S MNUM=0 ; Modifier number.
"RTN","PXCECPT",211,0)
 N MIEN,MTEXT
"RTN","PXCECPT",212,0)
 Q
"RTN","PXCECPT",213,0)
MODNAME(MODIEN) ;+Return #.02 NAME for this CPT MODIFIER (#81.3)
"RTN","PXCECPT",214,0)
 Q
"RTN","PXCECPT",215,0)
MODTEXT(MODIEN) ;+Return string of text describing modifier.
"RTN","PXCECPT",216,0)
 ;+MODIEN = IEN in CPT MODIFIER file (#81.3).
"RTN","PXCECPT",217,0)
 ;+Returns:  MODIFIER (#.01) followed by NAME(#.02).
"RTN","PXCECPT",218,0)
 N MOD,DESC,TEXT,RVAL
"RTN","PXCECPT",219,0)
 S RVAL=$$MOD^ICPTMOD(MODIEN,"I",$P(^AUPNVSIT(PXCEVIEN,0),U))
"RTN","PXCECPT",220,0)
 S MOD=$P(RVAL,"^",2)
"RTN","PXCECPT",221,0)
 S DESC=$P(RVAL,"^",3)
"RTN","PXCECPT",222,0)
 S TEXT=MOD_"  "_DESC
"RTN","PXCECPT",223,0)
 Q TEXT
"RTN","PXCECPT",224,0)
CHGCPT() ;Verify CPT code should be modified
"RTN","PXCECPT",225,0)
 ;If response is yes remove modifiers on file for CPT code
"RTN","PXCECPT",226,0)
 N DIR,DA,X,Y,PXIEN
"RTN","PXCECPT",227,0)
 W !!,$C(7),"WARNING!  THIS WILL ALSO DELETE ANY MODIFIERS ASSOCIATED WITH CPT CODE "_PXCEDIRB
"RTN","PXCECPT",228,0)
 S DIR(0)="Y"
"RTN","PXCECPT",229,0)
 S DIR("A")="SURE YOU WANT TO CHANGE THE CPT CODE?"
"RTN","PXCECPT",230,0)
 S DIR("B")="YES"
"RTN","PXCECPT",231,0)
 D ^DIR
"RTN","PXCECPT",232,0)
 ;Delete CPT Modifiers from V CPT file for current IEN
"RTN","PXCECPT",233,0)
 I 'Y Q +Y
"RTN","PXCECPT",234,0)
 S DA(1)=PXCEFIEN
"RTN","PXCECPT",235,0)
 S DIK="^AUPNVCPT("_DA(1)_","_1_","
"RTN","PXCECPT",236,0)
 S PXIEN=""
"RTN","PXCECPT",237,0)
 F  S PXIEN=$O(PXCEAFTR(1,PXIEN)) Q:PXIEN=""  D
"RTN","PXCECPT",238,0)
 . S DA=PXIEN
"RTN","PXCECPT",239,0)
 . D ^DIK
"RTN","PXCECPT",240,0)
 Q 1
"RTN","PXCECPT",241,0)
 ;
"RTN","PXCECPT",242,0)
NEWCODE ;
"RTN","PXCECPT",243,0)
 K DD,DO
"RTN","PXCECPT",244,0)
 N DIC,X,Y
"RTN","PXCECPT",245,0)
 S DIC="^AUPNVCPT("
"RTN","PXCECPT",246,0)
 S DIC(0)=""
"RTN","PXCECPT",247,0)
 S DIC("DR")=".02////^S X=$P(PXCEAFTR(0),""^"",2);"
"RTN","PXCECPT",248,0)
 S DIC("DR")=DIC("DR")_".03////^S X=$P(PXCEAFTR(0),""^"",3);"
"RTN","PXCECPT",249,0)
 S X=PXCEIN01
"RTN","PXCECPT",250,0)
 D FILE^DICN
"RTN","PXCECPT",251,0)
 S PXCEFIEN=+Y
"RTN","PXCECPT",252,0)
 Q
"RTN","PXCECPT",253,0)
 ;
"RTN","PXCECPT",254,0)
SKIP ;
"RTN","PXCECPT",255,0)
 Q
"RTN","PXCECPT1")
0^32^B3081673^B2104203
"RTN","PXCECPT1",1,0)
PXCECPT1 ;ISA/DHH/BDB - Used to edit and display V CPT ;15 May 2012  10:10 PM
"RTN","PXCECPT1",2,0)
 ;;1.0;PCE PATIENT CARE ENCOUNTER;**170,164,199**;Aug 12, 1996;Build 51
"RTN","PXCECPT1",3,0)
 ;; ;
"RTN","PXCECPT1",4,0)
 Q
"RTN","PXCECPT1",5,0)
ICDEN ;diagnosis lookup using lexicon
"RTN","PXCECPT1",6,0)
 ;
"RTN","PXCECPT1",7,0)
 I $G(X)="?BAD" S Y=-1 Q
"RTN","PXCECPT1",8,0)
 I $G(X)["?" Q
"RTN","PXCECPT1",9,0)
 K Y N DIC,PXACS,PXACSREC,PXDATE,PXDEF,PXXX
"RTN","PXCECPT1",10,0)
 S PXDATE=$S($D(PXCEVIEN)=1:$$CSDATE^PXDXUTL(PXCEVIEN),$D(PXCEAPDT)=1:PXCEAPDT,1:DT)
"RTN","PXCECPT1",11,0)
 S PXACSREC=$$ACTDT^PXDXUTL(PXDATE),PXACS=$P(PXACSREC,"^",3)
"RTN","PXCECPT1",12,0)
 I PXACS["-" S PXACS=$P(PXACS,"-",1,2)
"RTN","PXCECPT1",13,0)
 I $P(PXACSREC,U,1)'="ICD" D
"RTN","PXCECPT1",14,0)
 . S PXDEF=$G(X),PXAGAIN=0 D ^PXDSLK I PXXX=-1 S Y=-1 Q
"RTN","PXCECPT1",15,0)
 . S Y($P(PXACSREC,U,2))=$P($P(PXXX,U,1),";",2)
"RTN","PXCECPT1",16,0)
 . S Y=$P(PXXX,";",1)_U_$P(PXXX,U,2)
"RTN","PXCECPT1",17,0)
 I $P(PXACSREC,U,1)="ICD" D
"RTN","PXCECPT1",18,0)
 . D CONFIG^LEXSET($P(PXACSREC,U,1),,PXDATE)
"RTN","PXCECPT1",19,0)
 . S DIC(0)=""
"RTN","PXCECPT1",20,0)
 . S DIC="^LEX(757.01,",DIC(0)=$S('$L($G(X)):"",1:"")_"EQM"
"RTN","PXCECPT1",21,0)
 . S DIC("A")="Enter "_PXACS_" Diagnosis: "
"RTN","PXCECPT1",22,0)
 . D ^DIC
"RTN","PXCECPT1",23,0)
 Q:Y=-1
"RTN","PXCECPT1",24,0)
 S X=$G(Y($P(PXACSREC,U,2))),(X,Y)=$P($$ICDDATA^ICDXCODE("DIAG",X,PXDATE,"E"),U,1)
"RTN","PXCECPT1",25,0)
 Q
"RTN","PXCECPT1",26,0)
 ;
"RTN","PXCECPT1",27,0)
DEPART ;PX*1.0*164  Set the Department Code to the Clinic AMIS Reporting Stop Code
"RTN","PXCECPT1",28,0)
 Q:'$$SWSTAT^IBBAPI()  D
"RTN","PXCECPT1",29,0)
 . I $P(PXCEAFTR($P(PXCETEXT,"~",1)),"^",$P(PXCETEXT,"~",2))="",$P($G(^AUPNVSIT(PXCEVIEN,0)),"^",8) D
"RTN","PXCECPT1",30,0)
 .. S $P(PXCEAFTR($P(PXCETEXT,"~",1)),"^",$P(PXCETEXT,"~",2))=$P($G(^DIC(40.7,$P(^AUPNVSIT(PXCEVIEN,0),"^",8),0)),"^",2)
"RTN","PXCECPT1",31,0)
 Q
"RTN","PXCEPOV")
0^33^B13988253^B17257132
"RTN","PXCEPOV",1,0)
PXCEPOV ;ISL/dee - Used to edit and display V POV ;24 May 2013  8:53 AM
"RTN","PXCEPOV",2,0)
 ;;1.0;PCE PATIENT CARE ENCOUNTER;**27,121,124,170,168,199**;Aug 12, 1996;Build 51
"RTN","PXCEPOV",3,0)
 ;; ;
"RTN","PXCEPOV",4,0)
 ;
"RTN","PXCEPOV",5,0)
 ; Reference to LD^ICDEX supported by ICR #5747
"RTN","PXCEPOV",6,0)
 ;
"RTN","PXCEPOV",7,0)
 Q
"RTN","PXCEPOV",8,0)
 ;
"RTN","PXCEPOV",9,0)
 ;Line with the line label "FORMAT"
"RTN","PXCEPOV",10,0)
 ;;Long name~File Number~Node Subscripts~Allow Duplicate entries (1=yes, 0=no)~File global name
"RTN","PXCEPOV",11,0)
 ;     1         2             3                   4                                   5
"RTN","PXCEPOV",12,0)
 ;
"RTN","PXCEPOV",13,0)
 ;Following lines:
"RTN","PXCEPOV",14,0)
 ;;Node~Piece~,Field Number~Edit Label~Display Label~Display Routine~Edit Routine~Help Text for DIR(?)~Set of PXCEKEYS that can Edit~D if Detail Display Only~
"RTN","PXCEPOV",15,0)
 ;  1  ~  2  ~      3      ~     4    ~        5    ~        6      ~     7      ~       8            ~          9                  ~       10
"RTN","PXCEPOV",16,0)
 ;The Display & Edit routines are for special cases.
"RTN","PXCEPOV",17,0)
 ;  (The .01 field cannot have a special edit.)
"RTN","PXCEPOV",18,0)
 ;
"RTN","PXCEPOV",19,0)
FORMAT ;;Diagnosis~9000010.07~0,12,800,802,811,812~1~^AUPNVPOV
"RTN","PXCEPOV",20,0)
 ;;0~1~.01~ICD Code or Diagnosis:  ~ICD Code or Diagnosis:  ~$$DISPLY01^PXCEPOV~ICDCODE^PXCEPOV1~^D HELP^PXCEHELP~~B
"RTN","PXCEPOV",21,0)
 ;;0~4~.04~Provider Narrative:  ~Provider Narrative:  ~$$DNARRAT^PXCEPOV1~ENARRAT^PXCEPOV1(1,1,1,80,10,3)~~~B
"RTN","PXCEPOV",22,0)
 ;;0~12~.12~Is this Diagnosis Primary for the Encounter:  ~Primary/Secondary Diagnosis for the Encounter:  ~$$DPRIMSEC^PXCEPOV1~EPRIMSEC^PXCEPRV~~~B
"RTN","PXCEPOV",23,0)
 ;;0~17~.17~Is this Diagnosis Ordering, Resulting, or Both:  ~Ordering/Resulting Diagnosis:  ~~~~~B
"RTN","PXCEPOV",24,0)
 ;;0~6~.06~Modifier:  ~Modifier:  ~~~~~D
"RTN","PXCEPOV",25,0)
 ;;0~13~.13~Injury Date and (optional) Time~Date of Injury:  ~~EINJURY^PXCEPOV1~~~D
"RTN","PXCEPOV",26,0)
 ;;12~4~1204~Encounter Provider:  ~Encounter Provider:  ~~EPROV12^PXCEPRV~~~D
"RTN","PXCEPOV",27,0)
 ;;802~1~80201~Provider Narrative Category:  ~Provider Narrative Category:  ~$$DNARRAT^PXCEPOV1~ENARRAT^PXCEPOV1(0,2,0,80,5)~~C~D
"RTN","PXCEPOV",28,0)
 ;;811~1~81101~Comments:  ~Comments:  ~~~~~D
"RTN","PXCEPOV",29,0)
 ;;800~1~80001~Service Connected:  ~Service Connected:  ~~GET800^PXCEC800~~~D
"RTN","PXCEPOV",30,0)
 ;;800~7~80007~Combat Veteran:  ~Combat Veteran:  ~~SKIP^PXCEPOV~~~D
"RTN","PXCEPOV",31,0)
 ;;800~2~80002~Agent Orange Exposure:  ~Agent Orange Exposure:  ~~SKIP^PXCEPOV~~~D
"RTN","PXCEPOV",32,0)
 ;;800~3~80003~Ionizing Radiation Exposure:  ~Ionizing Radiation Exposure:  ~~SKIP^PXCEPOV~~~D
"RTN","PXCEPOV",33,0)
 ;;800~4~80004~SW Asia Conditions:  ~SW Asia Conditions:  ~~SKIP^PXCEPOV~~~D
"RTN","PXCEPOV",34,0)
 ;;800~8~80008~Project 112/SHAD:  ~Project 112/SHAD:  ~~SKIP^PXCEPOV~~~D
"RTN","PXCEPOV",35,0)
 ;;800~5~80005~Military Sexual Trauma:  ~Military Sexual Trauma:  ~~SKIP^PXCEPOV~~~D
"RTN","PXCEPOV",36,0)
 ;;800~6~80006~Head and/or Neck Cancer:  ~Head and/or Neck Cancer:  ~~SKIP^PXCEPOV~~~D
"RTN","PXCEPOV",37,0)
 ;
"RTN","PXCEPOV",38,0)
 ;
"RTN","PXCEPOV",39,0)
 ;
"RTN","PXCEPOV",40,0)
 ;The interface for AICS to get list on form for help.
"RTN","PXCEPOV",41,0)
INTRFACE ;;DG SELECT ICD DIAGNOSIS CODES
"RTN","PXCEPOV",42,0)
 ;
"RTN","PXCEPOV",43,0)
 ;********************************
"RTN","PXCEPOV",44,0)
 ;Special cases for display.
"RTN","PXCEPOV",45,0)
 ;
"RTN","PXCEPOV",46,0)
 ;********************************
"RTN","PXCEPOV",47,0)
 ;Display text for the .01 field which is a pointer to ^ICD9.
"RTN","PXCEPOV",48,0)
 ;(Must have is called by ASK^PXCEVFI2 and DEL^PXCEVFI2.)
"RTN","PXCEPOV",49,0)
DISPLY01(PXCEPOV) ;
"RTN","PXCEPOV",50,0)
 N ICDSTR,PXDXDATE
"RTN","PXCEPOV",51,0)
 S PXDXDATE=$$CSDATE^PXDXUTL(PXCEVIEN)
"RTN","PXCEPOV",52,0)
 S ICDSTR=$$ICDDATA^ICDXCODE("DIAG",$P(PXCEPOV,"^"),PXDXDATE,"I")
"RTN","PXCEPOV",53,0)
 I $P(ICDSTR,U,20)'=30 Q $P(ICDSTR,"^",2)_"     "_$P(ICDSTR,"^",4) ;code and desc
"RTN","PXCEPOV",54,0)
 I $P(ICDSTR,U,20)=30 Q $P(ICDSTR,"^",2)_"     "_$$SENTENCE^XLFSTR($$LD^ICDEX(80,$P(PXCEPOV,"^"),PXDXDATE))   ; code and long desc
"RTN","PXCEPOV",55,0)
 ;
"RTN","PXCEPOV",56,0)
SKIP ;
"RTN","PXCEPOV",57,0)
 Q
"RTN","PXCEPOV1")
0^34^B39167369^B33219732
"RTN","PXCEPOV1",1,0)
PXCEPOV1 ;ISL/dee - Used to edit and display V POV ;8/31/05
"RTN","PXCEPOV1",2,0)
 ;;1.0;PCE PATIENT CARE ENCOUNTER;**134,149,124,170,203,199**;Aug 12, 1996;Build 51
"RTN","PXCEPOV1",3,0)
 ;; ;
"RTN","PXCEPOV1",4,0)
 Q
"RTN","PXCEPOV1",5,0)
 ;
"RTN","PXCEPOV1",6,0)
 ;********************************
"RTN","PXCEPOV1",7,0)
 ;Special cases for display.
"RTN","PXCEPOV1",8,0)
 ;
"RTN","PXCEPOV1",9,0)
DNARRAT(PNAR) ;Provider Narrative for ICD-9 / ICD-10
"RTN","PXCEPOV1",10,0)
 N PXCEPNAR,PXDXDATE,SNARR
"RTN","PXCEPOV1",11,0)
 I PNAR<0 Q ""
"RTN","PXCEPOV1",12,0)
 S PXCEPNAR=$P(^AUTNPOV(PNAR,0),"^")
"RTN","PXCEPOV1",13,0)
 I $G(VIEW)="B",$D(ENTRY)>0 D
"RTN","PXCEPOV1",14,0)
 . N DIC,DR,DA,DIQ,PXCEDIQ1
"RTN","PXCEPOV1",15,0)
 . S DA=$P(ENTRY(0),"^",1)
"RTN","PXCEPOV1",16,0)
 . S PXDXDATE=$S($D(PXCEVIEN)=1:$$CSDATE^PXDXUTL(PXCEVIEN),$D(PXCEAPDT)=1:PXCEAPDT,1:DT)
"RTN","PXCEPOV1",17,0)
 . S SNARR=$P($$ICDDATA^ICDXCODE("DIAG",DA,PXDXDATE,"I"),"^",4)
"RTN","PXCEPOV1",18,0)
 . ;S:$G(PXCEDIQ1(80,DA,3,"E"))=PXCEPNAR PXCEPNAR=""
"RTN","PXCEPOV1",19,0)
 . S:SNARR=PXCEPNAR PXCEPNAR=""
"RTN","PXCEPOV1",20,0)
 Q PXCEPNAR
"RTN","PXCEPOV1",21,0)
 ;
"RTN","PXCEPOV1",22,0)
DPRIMSEC(PRIMSEC) ;
"RTN","PXCEPOV1",23,0)
 I $G(VIEW)="B" Q $S(PRIMSEC="P":"PRIMARY",1:"")
"RTN","PXCEPOV1",24,0)
 Q $S(PRIMSEC="P":"PRIMARY",PRIMSEC="S":"SECONDARY",1:"")
"RTN","PXCEPOV1",25,0)
 ;
"RTN","PXCEPOV1",26,0)
 ;********************************
"RTN","PXCEPOV1",27,0)
 ;Special cases for edit.
"RTN","PXCEPOV1",28,0)
 ;
"RTN","PXCEPOV1",29,0)
ENARRAT(REQUIRED,ASK,DEFAULT,FILE,FIELD1,FIELD2) ;Provider Narrative  --  Used by ALL V-Files with Prov. Nar.
"RTN","PXCEPOV1",30,0)
 ; REQUIRED  0 for not required
"RTN","PXCEPOV1",31,0)
 ;           1 for required
"RTN","PXCEPOV1",32,0)
 ; ASK       0 for do not ask
"RTN","PXCEPOV1",33,0)
 ;           1 for ask
"RTN","PXCEPOV1",34,0)
 ;           2 for ask only if there is already a value
"RTN","PXCEPOV1",35,0)
 ; DEFAULT   0 for do not default
"RTN","PXCEPOV1",36,0)
 ;           1 for do default
"RTN","PXCEPOV1",37,0)
 ;           changed to 1 if REQUIRED is 1
"RTN","PXCEPOV1",38,0)
 ;
"RTN","PXCEPOV1",39,0)
 N PXKLAYGO,ASKING
"RTN","PXCEPOV1",40,0)
 S PXKLAYGO=""
"RTN","PXCEPOV1",41,0)
 S ASKING=ASK#2
"RTN","PXCEPOV1",42,0)
 S:REQUIRED DEFAULT=1
"RTN","PXCEPOV1",43,0)
 I PXCEKEYS["C" S ASKING=1
"RTN","PXCEPOV1",44,0)
ENARRAT1 ;
"RTN","PXCEPOV1",45,0)
 K DIR,DA,X,Y,C
"RTN","PXCEPOV1",46,0)
 S (X,Y)=""
"RTN","PXCEPOV1",47,0)
 I $P(PXCEAFTR($P(PXCETEXT,"~",1)),"^",$P(PXCETEXT,"~",2))'="" D
"RTN","PXCEPOV1",48,0)
 . N DIERR,PXCEDILF,PXCEEXT,PXCEINT
"RTN","PXCEPOV1",49,0)
 . S PXCEINT=$P(PXCEAFTR($P(PXCETEXT,"~",1)),"^",$P(PXCETEXT,"~",2))
"RTN","PXCEPOV1",50,0)
 . S PXCEEXT=$$EXTERNAL^DILFD(PXCEFILE,$P(PXCETEXT,"~",3),"",PXCEINT,"PXCEDILF")
"RTN","PXCEPOV1",51,0)
 . S (DIR("B"),X,Y)=$S('$D(DIERR):PXCEEXT,1:PXCEINT)
"RTN","PXCEPOV1",52,0)
 S DIR(0)="FAO^1:245"
"RTN","PXCEPOV1",53,0)
 S DIR("A")=$P(PXCETEXT,"~",4)
"RTN","PXCEPOV1",54,0)
 I $P(PXCETEXT,"~",8)]"" S DIR("?")=$P(PXCETEXT,"~",8)
"RTN","PXCEPOV1",55,0)
 E  D
"RTN","PXCEPOV1",56,0)
 . S DIR("?",1)="This response must have at least 2 characters and no more than 245"
"RTN","PXCEPOV1",57,0)
 . S DIR("?",2)="characters and must not contain embedded uparrows."
"RTN","PXCEPOV1",58,0)
 . I REQUIRED S DIR("?")="This field is required."
"RTN","PXCEPOV1",59,0)
 . E  S DIR("?")="This field is optional."
"RTN","PXCEPOV1",60,0)
 I ASK=2,(Y]"") S ASKING=1
"RTN","PXCEPOV1",61,0)
 I ASKING D ^DIR
"RTN","PXCEPOV1",62,0)
 K DIR,DA
"RTN","PXCEPOV1",63,0)
 I X="@" S Y="@"
"RTN","PXCEPOV1",64,0)
 E  I $D(DTOUT)!$D(DUOUT) S PXCEEND=1 S:REQUIRED PXCEQUIT=1 Q
"RTN","PXCEPOV1",65,0)
 N PXCEX,PXCEY
"RTN","PXCEPOV1",66,0)
 I $E(Y,1)="=" S PXCEX=$E(PXCEIN01_" "_$E($P(Y,"^"),2,245),1,245)
"RTN","PXCEPOV1",67,0)
 E  S PXCEX=Y
"RTN","PXCEPOV1",68,0)
 ; ***
"RTN","PXCEPOV1",69,0)
 ; PX*1.0*199 - ICD-10 Remediation note.  
"RTN","PXCEPOV1",70,0)
 ; Fields 5 and 10 in file #80 have been modified by STS for ICD-10.
"RTN","PXCEPOV1",71,0)
 ; In the following lines of code these two field numbers are intercepted
"RTN","PXCEPOV1",72,0)
 ; and an appropriate, alternative data retrieval is implemented.
"RTN","PXCEPOV1",73,0)
 ; Other file and field numbers will behave as they previously did.
"RTN","PXCEPOV1",74,0)
 ; ***
"RTN","PXCEPOV1",75,0)
 N DXCATIEN,PXDXDATE
"RTN","PXCEPOV1",76,0)
 S PXDXDATE=$S($D(PXCEVIEN)=1:$$CSDATE^PXDXUTL(PXCEVIEN),$D(PXCEAPDT)=1:PXCEAPDT,1:DT)
"RTN","PXCEPOV1",77,0)
 I DEFAULT,PXCEX="" D
"RTN","PXCEPOV1",78,0)
 . I $G(FILE)=80,$G(FIELD1)=10 D  Q
"RTN","PXCEPOV1",79,0)
 .. S PXCEX=$$DXNARR^PXUTL1($P(PXCEAFTR(0),"^",1),PXDXDATE)
"RTN","PXCEPOV1",80,0)
 . I $G(FILE)=80,$G(FIELD1)=5 D  Q
"RTN","PXCEPOV1",81,0)
 .. S DXCATIEN=$P($$ICDDATA^ICDXCODE("DIAG",$P(PXCEAFTR(0),"^",1),PXDXDATE,"I"),"^",6)
"RTN","PXCEPOV1",82,0)
 .. I $L(DXCATIEN) S PXCEX=$$GET1^DIQ(80.3,DXCATIEN,.01)
"RTN","PXCEPOV1",83,0)
 . S PXCEX=$$EXTTEXT^PXUTL1($P(PXCEAFTR(0),"^",1),REQUIRED,$G(FILE),$G(FIELD1),$G(FIELD2))
"RTN","PXCEPOV1",84,0)
 I ASKING D
"RTN","PXCEPOV1",85,0)
 . W !,PXCEX
"RTN","PXCEPOV1",86,0)
 I $L(PXCEX)=1,PXCEX'="@" W !,"Must be 2 to 245 characters." G ENARRAT1
"RTN","PXCEPOV1",87,0)
 I PXCEX="@"!(PXCEX=""),REQUIRED W !,"This field is required.",$C(7) G ENARRAT1
"RTN","PXCEPOV1",88,0)
 ;
"RTN","PXCEPOV1",89,0)
 I PXCEX="@"!(PXCEX="") S PXCEY=PXCEX
"RTN","PXCEPOV1",90,0)
 E  S PXCEY=$$PROVNARR^PXAPI(PXCEX,PXCEFILE) I ASKING,+PXCEY'>0 W "??",$C(7) G ENARRAT1
"RTN","PXCEPOV1",91,0)
 E  I +PXCEY'>0 S PXCEY=""
"RTN","PXCEPOV1",92,0)
 S $P(PXCEAFTR($P(PXCETEXT,"~",1)),"^",$P(PXCETEXT,"~",2))=$P(PXCEY,"^")
"RTN","PXCEPOV1",93,0)
 Q
"RTN","PXCEPOV1",94,0)
 ;
"RTN","PXCEPOV1",95,0)
EINJURY ;Date/Time of Injury
"RTN","PXCEPOV1",96,0)
 ;If not an injury code Q
"RTN","PXCEPOV1",97,0)
 N DIC,DR,DA,DASV,DIQ,PXCEDIQ1
"RTN","PXCEPOV1",98,0)
 S DIC=80
"RTN","PXCEPOV1",99,0)
 S DR=".01"
"RTN","PXCEPOV1",100,0)
 S (DA,DASV)=$P(PXCEAFTR(0),"^",1)
"RTN","PXCEPOV1",101,0)
 S DIQ="PXCEDIQ1("
"RTN","PXCEPOV1",102,0)
 S DIQ(0)="E"
"RTN","PXCEPOV1",103,0)
 D EN^DIQ1
"RTN","PXCEPOV1",104,0)
 I PXCEDIQ1(80,DASV,.01,"E")'<800,PXCEDIQ1(80,DASV,.01,"E")'>999.999 D E1201^PXCEPOV1(-1,-1,0)
"RTN","PXCEPOV1",105,0)
 ; ICD-10 Injury Code logic immediately below -- codes beginning with S or T will be considered Injury codes.
"RTN","PXCEPOV1",106,0)
 I "^S^T^"[("^"_$E(PXCEDIQ1(80,DASV,.01,"E"))_"^") D E1201^PXCEPOV1(-1,-1,0)
"RTN","PXCEPOV1",107,0)
 Q
"RTN","PXCEPOV1",108,0)
 ;
"RTN","PXCEPOV1",109,0)
 ;********************************
"RTN","PXCEPOV1",110,0)
 ;Special cases for edit for Event Date and Time field number 1201
"RTN","PXCEPOV1",111,0)
 ; and other date and times.
"RTN","PXCEPOV1",112,0)
 ;
"RTN","PXCEPOV1",113,0)
E1201(REQTIME,BEFORE,AFTER,DEFAULT) ;
"RTN","PXCEPOV1",114,0)
 ;REQTIME is 1 if time is required,
"RTN","PXCEPOV1",115,0)
 ;           0 if time is optional
"RTN","PXCEPOV1",116,0)
 ;          -1 if the date can be imprecise
"RTN","PXCEPOV1",117,0)
 ;BEFORE  is the number of days before the visit that the date can
"RTN","PXCEPOV1",118,0)
 ;        not be before or -1 for any amount before.
"RTN","PXCEPOV1",119,0)
 ;AFTER   is the number of days after the visit that the date can
"RTN","PXCEPOV1",120,0)
 ;        not be after or -1 for any amount.  In any case the date
"RTN","PXCEPOV1",121,0)
 ;        cannot be later than today.
"RTN","PXCEPOV1",122,0)
 ;DEFAULT is the default date/time if there is not one in the file.
"RTN","PXCEPOV1",123,0)
 ;        If it is -1 then NOW will be used as the default.
"RTN","PXCEPOV1",124,0)
 ;        If it is 0 then TODAY will be used as the default.
"RTN","PXCEPOV1",125,0)
 N X1,X2,X,%Y,%H,%I,%
"RTN","PXCEPOV1",126,0)
 N PXCEVST S PXCEVST=$P(+^TMP("PXK",$J,"VST",1,0,"BEFORE"),".")
"RTN","PXCEPOV1",127,0)
 N PXCEBEF,PXCEAFT S (PXCEBEF,PXCEAFT)=""
"RTN","PXCEPOV1",128,0)
 I $D(AFTER)#2,AFTER'<0 D
"RTN","PXCEPOV1",129,0)
 . I AFTER=0 S PXCEAFT=PXCEVST+.9
"RTN","PXCEPOV1",130,0)
 . E  D
"RTN","PXCEPOV1",131,0)
 .. S X1=DT
"RTN","PXCEPOV1",132,0)
 .. S X2=$P(+^TMP("PXK",$J,"VST",1,0,"BEFORE"),".")
"RTN","PXCEPOV1",133,0)
 .. D ^%DTC
"RTN","PXCEPOV1",134,0)
 .. I X'>AFTER S PXCEAFT=DT+.9
"RTN","PXCEPOV1",135,0)
 .. E  D
"RTN","PXCEPOV1",136,0)
 ... S X1=$P(+^TMP("PXK",$J,"VST",1,0,"BEFORE"),".")
"RTN","PXCEPOV1",137,0)
 ... S X2=AFTER
"RTN","PXCEPOV1",138,0)
 ... D C^%DTC
"RTN","PXCEPOV1",139,0)
 ... S PXCEAFT=X+.9
"RTN","PXCEPOV1",140,0)
 I $D(BEFORE)#2,BEFORE'<0 D
"RTN","PXCEPOV1",141,0)
 . I BEFORE=0 S PXCEBEF=PXCEVST
"RTN","PXCEPOV1",142,0)
 . E  D
"RTN","PXCEPOV1",143,0)
 .. S X1=$P(+^TMP("PXK",$J,"VST",1,0,"BEFORE"),".")
"RTN","PXCEPOV1",144,0)
 .. S X2=-BEFORE
"RTN","PXCEPOV1",145,0)
 .. D C^%DTC
"RTN","PXCEPOV1",146,0)
 .. S PXCEBEF=X
"RTN","PXCEPOV1",147,0)
 S DIR(0)="DO^"_PXCEBEF_":"_PXCEAFT_":ESP"
"RTN","PXCEPOV1",148,0)
 I $G(REQTIME)=1 S DIR(0)=DIR(0)_"RX"
"RTN","PXCEPOV1",149,0)
 E  I $G(REQTIME)=-1 S DIR(0)=DIR(0)_"T"
"RTN","PXCEPOV1",150,0)
 E  S DIR(0)=DIR(0)_"TX"
"RTN","PXCEPOV1",151,0)
 I $P(PXCEAFTR($P(PXCETEXT,"~",1)),"^",$P(PXCETEXT,"~",2))'="" S DIR("B")=$P(PXCEAFTR($P(PXCETEXT,"~",1)),"^",$P(PXCETEXT,"~",2))
"RTN","PXCEPOV1",152,0)
 E  I ($D(DEFAULT)#2) D
"RTN","PXCEPOV1",153,0)
 . I DEFAULT>0 S DIR("B")=DEFAULT
"RTN","PXCEPOV1",154,0)
 . E  I DEFAULT=0 S DIR("B")=DT
"RTN","PXCEPOV1",155,0)
 . E  I DEFAULT=-1 D NOW^%DTC S DIR("B")=%
"RTN","PXCEPOV1",156,0)
 I $D(DIR("B"))#2 S Y=DIR("B") D DD^%DT S DIR("B")=Y
"RTN","PXCEPOV1",157,0)
 S DIR("A")=$P(PXCETEXT,"~",4)
"RTN","PXCEPOV1",158,0)
 S:$P(PXCETEXT,"~",8)]"" DIR("?")=$P(PXCETEXT,"~",8)
"RTN","PXCEPOV1",159,0)
 D ^DIR
"RTN","PXCEPOV1",160,0)
 K DIR,DA
"RTN","PXCEPOV1",161,0)
 I X="@" S Y="@"
"RTN","PXCEPOV1",162,0)
 E  I $D(DTOUT)!$D(DUOUT) S PXCEEND=1 Q
"RTN","PXCEPOV1",163,0)
 S $P(PXCEAFTR($P(PXCETEXT,"~",1)),"^",$P(PXCETEXT,"~",2))=$P(Y,"^")
"RTN","PXCEPOV1",164,0)
 Q
"RTN","PXCEPOV1",165,0)
 ;
"RTN","PXCEPOV1",166,0)
ICDCODE ;enter ICD9/ICD10 code using lexicon
"RTN","PXCEPOV1",167,0)
 ; DBIA # 1571 AND 1609
"RTN","PXCEPOV1",168,0)
 N CODE,PXACS,PXACSREC,PXDXDATE,PXDEF
"RTN","PXCEPOV1",169,0)
 S PXDXDATE=$S($D(PXCEVIEN)=1:$$CSDATE^PXDXUTL(PXCEVIEN),$D(PXCEAPDT)=1:PXCEAPDT,1:DT)
"RTN","PXCEPOV1",170,0)
 S PXACSREC=$$ACTDT^PXDXUTL(PXDXDATE),PXACS=$P(PXACSREC,"^",3)
"RTN","PXCEPOV1",171,0)
 I PXACS["-" S PXACS=$P(PXACS,"-",1,2)
"RTN","PXCEPOV1",172,0)
 K X
"RTN","PXCEPOV1",173,0)
 I +$G(PXCEAFTR(0))>0 D
"RTN","PXCEPOV1",174,0)
 . S CODE=$P(PXCEAFTR(0),"^")
"RTN","PXCEPOV1",175,0)
 . S X=$P($$ICDDATA^ICDXCODE("DIAG",CODE,PXDXDATE,"I"),"^",2)
"RTN","PXCEPOV1",176,0)
 I $P(PXACSREC,U,1)'="ICD" D
"RTN","PXCEPOV1",177,0)
 . S PXDEF=$G(X),PXAGAIN=0,PXDATE=PXDXDATE D ^PXDSLK I PXXX=-1 S Y=-1 Q
"RTN","PXCEPOV1",178,0)
 . S Y($P(PXACSREC,U,2))=$P($P(PXXX,U,1),";",2)
"RTN","PXCEPOV1",179,0)
 . S Y=$P(PXXX,";",1)_U_$P(PXXX,U,2)
"RTN","PXCEPOV1",180,0)
 I $P(PXACSREC,U,1)="ICD" D
"RTN","PXCEPOV1",181,0)
 . D CONFIG^LEXSET($P(PXACSREC,"^",1),,PXDXDATE)
"RTN","PXCEPOV1",182,0)
 . S DIC("A")="Select "_PXACS_" Diagnosis: "
"RTN","PXCEPOV1",183,0)
 . S DIC="^LEX(757.01,",DIC(0)=$S('$L($G(X)):"A",1:"")_"EQM"
"RTN","PXCEPOV1",184,0)
 . D ^DIC
"RTN","PXCEPOV1",185,0)
 I $G(X)="@" Q
"RTN","PXCEPOV1",186,0)
 I Y=-1 S DIRUT=-1 Q
"RTN","PXCEPOV1",187,0)
 S CODE=Y($P(PXACSREC,"^",2))
"RTN","PXCEPOV1",188,0)
 S Y=+$$ICDDATA^ICDXCODE("DIAG",CODE,PXDXDATE,"E")
"RTN","PXCEPOV1",189,0)
 Q
"RTN","PXCEVFI4")
0^35^B26873797^B27747505
"RTN","PXCEVFI4",1,0)
PXCEVFI4 ;ISL/dee - Routine to display a visit or v-file entry and input providers in to V PROVIDER from other V Files ;6/20/96
"RTN","PXCEVFI4",2,0)
 ;;1.0;PCE PATIENT CARE ENCOUNTER;**124,203,199**;Aug 12, 1996;Build 51
"RTN","PXCEVFI4",3,0)
 Q
"RTN","PXCEVFI4",4,0)
DISPLAY ; -- display the data
"RTN","PXCEVFI4",5,0)
 Q:PXCECAT="CSTP"
"RTN","PXCEVFI4",6,0)
 N PXCELINE,PXCETEXT,PXCEINT,PXCEEXT
"RTN","PXCEVFI4",7,0)
 I PXCECAT="APPM"!(PXCECAT="HIST") N PXCECODE S PXCECODE="PXCESIT"
"RTN","PXCEVFI4",8,0)
 W !
"RTN","PXCEVFI4",9,0)
 F PXCELINE=1:1 S PXCETEXT=$P($T(FORMAT+PXCELINE^@PXCECODE),";;",2) Q:PXCETEXT']""  D
"RTN","PXCEVFI4",10,0)
 . S (PXCEINT,PXCEEXT)=$P(PXCEAFTR($P(PXCETEXT,"~",1)),"^",$P(PXCETEXT,"~",2))
"RTN","PXCEVFI4",11,0)
 . I PXCEINT="@" S PXCEEXT="<deleted>"
"RTN","PXCEVFI4",12,0)
 . E  I PXCEINT'="" D
"RTN","PXCEVFI4",13,0)
 .. I $P(PXCETEXT,"~",6)]"" S @("PXCEEXT="_$P(PXCETEXT,"~",6)_"("""_PXCEINT_""")")
"RTN","PXCEVFI4",14,0)
 .. E  D
"RTN","PXCEVFI4",15,0)
 ... N DIERR,PXCEDILF
"RTN","PXCEVFI4",16,0)
 ... S PXCEEXT=$$EXTERNAL^DILFD(PXCEFILE,$P(PXCETEXT,"~",3),"",PXCEINT,"PXCEDILF")
"RTN","PXCEVFI4",17,0)
 ... S PXCEEXT=$S('$D(DIERR):PXCEEXT,1:PXCEINT)
"RTN","PXCEVFI4",18,0)
 . I ($L($P(PXCETEXT,"~",5))+$L(PXCEEXT))'>80 D
"RTN","PXCEVFI4",19,0)
 .. W !,$P(PXCETEXT,"~",5),PXCEEXT
"RTN","PXCEVFI4",20,0)
 . E  D
"RTN","PXCEVFI4",21,0)
 .. N PXCEWRAP,PXCECOUN
"RTN","PXCEVFI4",22,0)
 .. D WRAP(PXCEEXT,80-$L($P(PXCETEXT,"~",5)),.PXCEWRAP)
"RTN","PXCEVFI4",23,0)
 .. W !,$P(PXCETEXT,"~",5),$G(PXCEWRAP(1))
"RTN","PXCEVFI4",24,0)
 .. S PXCECOUN=1
"RTN","PXCEVFI4",25,0)
 .. F  S PXCECOUN=$O(PXCEWRAP(PXCECOUN)) Q:PXCECOUN']""  D
"RTN","PXCEVFI4",26,0)
 ... W !,$J("",$L($P(PXCETEXT,"~",5))),PXCEWRAP(PXCECOUN)
"RTN","PXCEVFI4",27,0)
 Q
"RTN","PXCEVFI4",28,0)
 ;
"RTN","PXCEVFI4",29,0)
WRAP(X,DIWR,WRAPPED) ;Copies the text in X into the array WRAPPED
"RTN","PXCEVFI4",30,0)
 N DIWL,DIWF,PXCEINDX
"RTN","PXCEVFI4",31,0)
 K ^UTILITY($J,"W")
"RTN","PXCEVFI4",32,0)
 S DIWL=1
"RTN","PXCEVFI4",33,0)
 S DIRF=""
"RTN","PXCEVFI4",34,0)
 D ^DIWP
"RTN","PXCEVFI4",35,0)
 S PXCEINDX=0
"RTN","PXCEVFI4",36,0)
 F  S PXCEINDX=$O(^UTILITY($J,"W",DIWL,PXCEINDX)) Q:'PXCEINDX  S WRAPPED(PXCEINDX)=^UTILITY($J,"W",DIWL,PXCEINDX,0)
"RTN","PXCEVFI4",37,0)
 K ^UTILITY($J,"W")
"RTN","PXCEVFI4",38,0)
 Q
"RTN","PXCEVFI4",39,0)
 ;
"RTN","PXCEVFI4",40,0)
PROVIDER(PXCEPRV) ;See if it is a new provider and if it is add them.
"RTN","PXCEVFI4",41,0)
 N PXCEVPRV,PXCEKPRV,PXCENPRV,PXCEPRIM
"RTN","PXCEVFI4",42,0)
 N DIR,DA,X,Y
"RTN","PXCEVFI4",43,0)
 S (PXCEVPRV,PXCEKPRV)=""
"RTN","PXCEVFI4",44,0)
 S PXCEPRIM=0
"RTN","PXCEVFI4",45,0)
 ;See if this provider is already in V Provider for this Encounter
"RTN","PXCEVFI4",46,0)
 F  S PXCEVPRV=$O(^AUPNVPRV("AD",PXCEVIEN,PXCEVPRV)) Q:PXCEVPRV'>0  Q:PXCEPRV=$P(^AUPNVPRV(PXCEVPRV,0),"^",1)  S:"P"=$P(^AUPNVPRV(PXCEVPRV,0),"^",4) PXCEPRIM=1
"RTN","PXCEVFI4",47,0)
 Q:PXCEVPRV>0
"RTN","PXCEVFI4",48,0)
 ;See if this provider is in the ^TMP("PXK",$J,
"RTN","PXCEVFI4",49,0)
 F  S PXCEKPRV=$O(^TMP("PXK",$J,"PRV",PXCEKPRV)) Q:PXCEKPRV'>0  Q:PXCEPRV=+^TMP("PXK",$J,"PRV",PXCEKPRV,0,"AFTER")  S:"P"=$P(^TMP("PXK",$J,"PRV",PXCEKPRV,0,"AFTER"),"^",4) PXCEPRIM=1
"RTN","PXCEVFI4",50,0)
 Q:PXCEKPRV>0
"RTN","PXCEVFI4",51,0)
 I 'PXCEPRIM D  I $D(DTOUT)!$D(DUOUT) Q
"RTN","PXCEVFI4",52,0)
 . N DIR,DA
"RTN","PXCEVFI4",53,0)
 . S DIR(0)="9000010.06,.04A"
"RTN","PXCEVFI4",54,0)
 . S DIR("A")="Is this provider Primary or Secondary?  "
"RTN","PXCEVFI4",55,0)
 . S DIR("B")=$S(PXCEPRIM:"S",1:"P")
"RTN","PXCEVFI4",56,0)
 . D ^DIR
"RTN","PXCEVFI4",57,0)
 I PXCEPRIM S Y="S"
"RTN","PXCEVFI4",58,0)
 ;Set PXCENPRV to the next provider in ^TMP("PXK",$J,"PRV",
"RTN","PXCEVFI4",59,0)
 I $Q(^TMP("PXK",$J,"PRV"))["PXK,"_$J_",PRV" S PXCENPRV=+$O(^TMP("PXK",$J,"PRV",""),-1)+1
"RTN","PXCEVFI4",60,0)
 E  S PXCENPRV=1
"RTN","PXCEVFI4",61,0)
 S ^TMP("PXK",$J,"PRV",PXCENPRV,"IEN")=""
"RTN","PXCEVFI4",62,0)
 S ^TMP("PXK",$J,"PRV",PXCENPRV,0,"BEFORE")=""
"RTN","PXCEVFI4",63,0)
 S ^TMP("PXK",$J,"PRV",PXCENPRV,0,"AFTER")=PXCEPRV_"^"_PXCEPAT_"^"_PXCEVIEN_"^"_$P(Y,"^")
"RTN","PXCEVFI4",64,0)
 S ^TMP("PXK",$J,"PRV",PXCENPRV,812,"BEFORE")=""
"RTN","PXCEVFI4",65,0)
 S ^TMP("PXK",$J,"PRV",PXCENPRV,812,"AFTER")="^"_PXCEPKG_"^"_PXCESOR
"RTN","PXCEVFI4",66,0)
 Q
"RTN","PXCEVFI4",67,0)
 ;
"RTN","PXCEVFI4",68,0)
DIAGNOS(PXCEPOV) ;See if it is a new diagnosis and if it is add them.
"RTN","PXCEVFI4",69,0)
 N DA,DIR,PXCEDXSC,PXCEKPOV,PXCEMOD,PXCENARR,PXCENPOV,PXCEPMSC,PXCEVDT
"RTN","PXCEVFI4",70,0)
 N PXCEVPOV,PXCEX,PXCEY,X,Y
"RTN","PXCEVFI4",71,0)
 S (PXCEVPOV,PXCEKPOV)=""
"RTN","PXCEVFI4",72,0)
 S PXCEPRIM=0
"RTN","PXCEVFI4",73,0)
 ;See if this diagnosis is already in V POV for this Encounter
"RTN","PXCEVFI4",74,0)
 F  S PXCEVPOV=$O(^AUPNVPOV("AD",PXCEVIEN,PXCEVPOV)) Q:PXCEVPOV'>0  Q:PXCEPOV=$P(^AUPNVPOV(PXCEVPOV,0),"^",1)  S:"P"=$P(^AUPNVPOV(PXCEVPOV,0),"^",12) PXCEPRIM=1
"RTN","PXCEVFI4",75,0)
 Q:PXCEVPOV>0
"RTN","PXCEVFI4",76,0)
 ;See if this diagnosis is in the ^TMP("PXK",$J,
"RTN","PXCEVFI4",77,0)
 F  S PXCEKPOV=$O(^TMP("PXK",$J,"POV",PXCEKPOV)) Q:PXCEKPOV'>0  Q:PXCEPOV=+^TMP("PXK",$J,"POV",PXCEKPOV,0,"AFTER")  S:"P"=$P(^TMP("PXK",$J,"POV",PXCEKPOV,0,"AFTER"),"^",12) PXCEPRIM=1
"RTN","PXCEVFI4",78,0)
 Q:PXCEKPOV>0
"RTN","PXCEVFI4",79,0)
 ;Is this diagnosis primary P/S
"RTN","PXCEVFI4",80,0)
 I 'PXCEPRIM D  I $D(DTOUT)!$D(DUOUT) S PXCEEND=1,PXCEQUIT=1 Q
"RTN","PXCEVFI4",81,0)
 . N DIR,DA
"RTN","PXCEVFI4",82,0)
 . S DIR(0)="9000010.07,.12A"
"RTN","PXCEVFI4",83,0)
 . S DIR("A")="Diagnosis is Primary?  "
"RTN","PXCEVFI4",84,0)
 . S DIR("B")="P"
"RTN","PXCEVFI4",85,0)
 . D ^DIR
"RTN","PXCEVFI4",86,0)
 . S PXCEPMSC=$P(Y,"^",1)
"RTN","PXCEVFI4",87,0)
 . S:PXCEPMSC="P" PXCEPRIM=1
"RTN","PXCEVFI4",88,0)
 S:'$D(PXCEPMSC) PXCEPMSC="S"
"RTN","PXCEVFI4",89,0)
 ;Diagnosis narrative
"RTN","PXCEVFI4",90,0)
 D  I $D(DTOUT)!$D(DUOUT) S PXCEEND=1,PXCEQUIT=1 Q
"RTN","PXCEVFI4",91,0)
 . N DIR,DA
"RTN","PXCEVFI4",92,0)
 . S DIR(0)="9000010.07,.04AO"
"RTN","PXCEVFI4",93,0)
 . S DIR("A")="Provider Narrative: "
"RTN","PXCEVFI4",94,0)
 . D ^DIR
"RTN","PXCEVFI4",95,0)
 S PXCEX=Y
"RTN","PXCEVFI4",96,0)
 I PXCEX="" D
"RTN","PXCEVFI4",97,0)
 . S PXCEVDT=$$CSDATE^PXDXUTL(PXCEVIEN) ; get visit date
"RTN","PXCEVFI4",98,0)
 . S PXCEX=$$DXNARR^PXUTL1(+PXCEPOV,PXCEVDT) ; get diagnosis description
"RTN","PXCEVFI4",99,0)
 W !,PXCEX
"RTN","PXCEVFI4",100,0)
 S PXCEY=$$PROVNARR^PXAPI(PXCEX,9000010.07) I +PXCEY'>0 W "??",$C(7) S PXCEEND=1,PXCEQUIT=1 Q
"RTN","PXCEVFI4",101,0)
 S PXCENARR=$P(PXCEY,"^",1)
"RTN","PXCEVFI4",102,0)
 ;Diagnosis modifier
"RTN","PXCEVFI4",103,0)
 D  I $D(DTOUT)!$D(DUOUT) S PXCEEND=1,PXCEQUIT=1 Q
"RTN","PXCEVFI4",104,0)
 . N DIR,DA
"RTN","PXCEVFI4",105,0)
 . S DIR(0)="9000010.07,.06A"
"RTN","PXCEVFI4",106,0)
 . S DIR("A")="Diagnosis Modifier: "
"RTN","PXCEVFI4",107,0)
 . D ^DIR
"RTN","PXCEVFI4",108,0)
 S PXCEMOD=$P(Y,U,2)
"RTN","PXCEVFI4",109,0)
 ;Diagnosis Service Connected, Clinical Indicators
"RTN","PXCEVFI4",110,0)
 D GET800^PXCED800
"RTN","PXCEVFI4",111,0)
 ;Set PXCENPOV to the next diagnosis in ^TMP("PXK",$J,"POV",
"RTN","PXCEVFI4",112,0)
 I $Q(^TMP("PXK",$J,"POV"))["PXK,"_$J_",POV" S PXCENPOV=+$O(^TMP("PXK",$J,"POV",""),-1)+1
"RTN","PXCEVFI4",113,0)
 E  S PXCENPOV=1
"RTN","PXCEVFI4",114,0)
 S ^TMP("PXK",$J,"POV",PXCENPOV,"IEN")=""
"RTN","PXCEVFI4",115,0)
 S ^TMP("PXK",$J,"POV",PXCENPOV,0,"BEFORE")=""
"RTN","PXCEVFI4",116,0)
 S ^TMP("PXK",$J,"POV",PXCENPOV,0,"AFTER")=PXCEPOV_"^"_PXCEPAT_"^"_PXCEVIEN_"^"_PXCENARR_"^^"_PXCEMOD_"^^^^^^"_PXCEPMSC
"RTN","PXCEVFI4",117,0)
 S ^TMP("PXK",$J,"POV",PXCENPOV,800,"BEFORE")=""
"RTN","PXCEVFI4",118,0)
 S ^TMP("PXK",$J,"POV",PXCENPOV,800,"AFTER")=PXCEDXSC
"RTN","PXCEVFI4",119,0)
 S ^TMP("PXK",$J,"POV",PXCENPOV,812,"BEFORE")=""
"RTN","PXCEVFI4",120,0)
 S ^TMP("PXK",$J,"POV",PXCENPOV,812,"AFTER")="^"_PXCEPKG_"^"_PXCESOR
"RTN","PXCEVFI4",121,0)
 Q
"RTN","PXCEVFI4",122,0)
 ;
"RTN","PXCEVFI4",123,0)
 ;
"RTN","PXCEVFI5")
0^36^B5687740^B5688048
"RTN","PXCEVFI5",1,0)
PXCEVFI5 ;ISL/dee - Check to see if the encounter is a standalone and if it needs to be deleted ;3/17/04 12:24pm
"RTN","PXCEVFI5",2,0)
 ;;1.0;PCE PATIENT CARE ENCOUNTER;**14,99,124,199**;Aug 12, 1996;Build 51
"RTN","PXCEVFI5",3,0)
 ;
"RTN","PXCEVFI5",4,0)
 Q
"RTN","PXCEVFI5",5,0)
CHECK ;Check to see if this is a standalone and if it is make sure it has
"RTN","PXCEVFI5",6,0)
 ;  a procedure or stop code.  If it does not have either then allow the
"RTN","PXCEVFI5",7,0)
 ;  user to continue editing it or to delete the encounter.
"RTN","PXCEVFI5",8,0)
 ;Also check that if there are diagnoses for the encounter that one of
"RTN","PXCEVFI5",9,0)
 ;  them is primary.
"RTN","PXCEVFI5",10,0)
 ;
"RTN","PXCEVFI5",11,0)
 ;Quit if no visit ien
"RTN","PXCEVFI5",12,0)
 I '$D(^AUPNVSIT(PXCEVIEN)) S PXCEEXIT=1 Q
"RTN","PXCEVFI5",13,0)
 N PXCEVST0,PXCEPDX,PXCEAPPT
"RTN","PXCEVFI5",14,0)
 S PXCEVST0=^AUPNVSIT(PXCEVIEN,0)
"RTN","PXCEVFI5",15,0)
 ;Quit if Historical visit
"RTN","PXCEVFI5",16,0)
 I $P(PXCEVST0,"^",7)="E" S PXCEEXIT=1 Q
"RTN","PXCEVFI5",17,0)
 ;Get primary Dx if one
"RTN","PXCEVFI5",18,0)
 I '$D(^AUPNVPOV("AD",PXCEVIEN)) S PXCEPDX=-1 ;no Dx so do not need a primary one
"RTN","PXCEVFI5",19,0)
 E  S PXCEPDX=$$PRIMVPOV^PXUTL1(PXCEVIEN)
"RTN","PXCEVFI5",20,0)
 ;Get if there is an appointment
"RTN","PXCEVFI5",21,0)
 S PXCEAPPT=$$VSTAPPT^PXUTL1(PXCEPAT,+PXCEVST0,$P(PXCEVST0,"^",22),PXCEVIEN)
"RTN","PXCEVFI5",22,0)
 ;Quit if there is an appointment and primary Dx
"RTN","PXCEVFI5",23,0)
 I PXCEPDX,PXCEAPPT S PXCEEXIT=1 Q
"RTN","PXCEVFI5",24,0)
 ;Quit if there are procedures or stop codes and a primary Dx
"RTN","PXCEVFI5",25,0)
 ;DROP PROCEDURE CHECK
"RTN","PXCEVFI5",26,0)
 S PXCEEXIT=1 Q
"RTN","PXCEVFI5",27,0)
 ;
"RTN","PXCEVFI5",28,0)
 I PXCEPDX,$D(^AUPNVCPT("AD",PXCEVIEN))!($D(^AUPNVSIT("AD",PXCEVIEN))) S PXCEEXIT=1 Q
"RTN","PXCEVFI5",29,0)
 N DIR,X,Y,PXCECNT
"RTN","PXCEVFI5",30,0)
 S DIR("B")="NO"
"RTN","PXCEVFI5",31,0)
 S DIR(0)="Y"
"RTN","PXCEVFI5",32,0)
 S PXCECNT=1
"RTN","PXCEVFI5",33,0)
 I 'PXCEPDX D
"RTN","PXCEVFI5",34,0)
 . S DIR("A",PXCECNT)="None of the diagnoses for this encounter are Primary."
"RTN","PXCEVFI5",35,0)
 . S PXCECNT=PXCECNT+1
"RTN","PXCEVFI5",36,0)
 I 'PXCEAPPT,'$D(^AUPNVCPT("AD",PXCEVIEN)),'$D(^AUPNVSIT("AD",PXCEVIEN)) D
"RTN","PXCEVFI5",37,0)
 . I $G(PXQUIT) D  Q
"RTN","PXCEVFI5",38,0)
 .. N DIR
"RTN","PXCEVFI5",39,0)
 .. S DIR(0)="FOA"
"RTN","PXCEVFI5",40,0)
 .. S DIR("A",1)="This encounter does not have a procedure, it will be DELETED."
"RTN","PXCEVFI5",41,0)
 .. S DIR("A")="Press any key to continue: "
"RTN","PXCEVFI5",42,0)
 .. D ^DIR
"RTN","PXCEVFI5",43,0)
 .. I $$DELVFILE^PXAPI("ALL",PXCEVIEN)
"RTN","PXCEVFI5",44,0)
 . S DIR("A",PXCECNT)="This encounter must have a procedure."
"RTN","PXCEVFI5",45,0)
 . S PXCECNT=PXCECNT+1
"RTN","PXCEVFI5",46,0)
 . S DIR("A",PXCECNT)="It will be deleted if a procedure is not added."
"RTN","PXCEVFI5",47,0)
 . S PXCECNT=PXCECNT+1
"RTN","PXCEVFI5",48,0)
 . S DIR("A")="Delete this encounter"
"RTN","PXCEVFI5",49,0)
 . D ^DIR
"RTN","PXCEVFI5",50,0)
 . I Y=1 D
"RTN","PXCEVFI5",51,0)
 .. I $$DELVFILE^PXAPI("ALL",PXCEVIEN)
"RTN","PXCEVFI5",52,0)
 .. S PXCEEXIT=1
"RTN","PXCEVFI5",53,0)
 . E  S PXCEEXIT=0
"RTN","PXCEVFI5",54,0)
 E  D
"RTN","PXCEVFI5",55,0)
 . S DIR("A")="Quit anyway"
"RTN","PXCEVFI5",56,0)
 . D ^DIR
"RTN","PXCEVFI5",57,0)
 . I Y=0 S PXCEEXIT=0
"RTN","PXCEVFI5",58,0)
 . E  S PXCEEXIT=1
"RTN","PXCEVFI5",59,0)
 Q
"RTN","PXCEVFI5",60,0)
 ;
"RTN","PXCEVIMM")
0^37^B31390321^B27090719
"RTN","PXCEVIMM",1,0)
PXCEVIMM ;ISL/dee - Used to edit and display V IMMUNIZATION ;3/11/04 3:00pm
"RTN","PXCEVIMM",2,0)
 ;;1.0;PCE PATIENT CARE ENCOUNTER;**27,124,199**;Aug 12, 1996;Build 51
"RTN","PXCEVIMM",3,0)
 ;; ;
"RTN","PXCEVIMM",4,0)
 Q
"RTN","PXCEVIMM",5,0)
 ;
"RTN","PXCEVIMM",6,0)
 ;Line with the line label "FORMAT"
"RTN","PXCEVIMM",7,0)
 ;;Long name~File Number~Node Subscripts~Allow Duplicate entries (1=yes, 0=no)~File global name
"RTN","PXCEVIMM",8,0)
 ;     1         2             3                   4                                   5
"RTN","PXCEVIMM",9,0)
 ;
"RTN","PXCEVIMM",10,0)
 ;Following lines:
"RTN","PXCEVIMM",11,0)
 ;;Node~Piece~,Field Number~Edit Label~Display Label~Display Routine~Edit Routine~Help Text for DIR("?")~Set of PXCEKEYS that can Edit~D if Detail Display Only~
"RTN","PXCEVIMM",12,0)
 ;  1  ~  2  ~      3      ~     4    ~        5    ~        6      ~     7      ~       8              ~          9                  ~       10
"RTN","PXCEVIMM",13,0)
 ;The Display & Edit routines are for special cases.
"RTN","PXCEVIMM",14,0)
 ;  (The .01 field cannot have a special edit.)
"RTN","PXCEVIMM",15,0)
 ;
"RTN","PXCEVIMM",16,0)
FORMAT ;;Immunization~9000010.11~0,11,12,811,812~0~^AUPNVIMM
"RTN","PXCEVIMM",17,0)
 ;;0~1~.01~Immunization:  ~Immunization:  ~~~~~B
"RTN","PXCEVIMM",18,0)
 ;;12~4~1204~Encounter Provider:  ~Encounter Provider:  ~~EPROV12^PXCEPRV~~~D
"RTN","PXCEVIMM",19,0)
 ;;0~4~.04~Series:  ~Series:  ~~~~~D
"RTN","PXCEVIMM",20,0)
 ;;0~6~.06~Reaction:  ~Reaction:  ~~~~~D
"RTN","PXCEVIMM",21,0)
 ;;0~7~.07~Repeat Contraindicated:  ~Repeat Contraindicated:  ~~ECONTRAI^PXCEVIMM~~~D
"RTN","PXCEVIMM",22,0)
 ;;12~1~1201~Administered Date and (optional) Time~Administered Date and Time:  ~~E1201^PXCEPOV1(0,30,30)~~~D
"RTN","PXCEVIMM",23,0)
 ;;811~1~81101~Comments:  ~Comments:  ~~~~~D
"RTN","PXCEVIMM",24,0)
 ;;0~8~.08~Diagnosis:  ~Diagnosis:  ~$$DISPLY01^PXCEPOV~EPOV^PXCEVIMM~~~
"RTN","PXCEVIMM",25,0)
 ;;0~9~.09~Diagnosis 2:  ~Diagnosis 2:  ~$$DISPLY01^PXCEPOV~EPOV^PXCEVIMM~~~
"RTN","PXCEVIMM",26,0)
 ;;0~10~.1~Diagnosis 3:  ~Diagnosis 3:  ~$$DISPLY01^PXCEPOV~EPOV^PXCEVIMM~~~
"RTN","PXCEVIMM",27,0)
 ;;0~11~.11~Diagnosis 4:  ~Diagnosis 4:  ~$$DISPLY01^PXCEPOV~EPOV^PXCEVIMM~~~
"RTN","PXCEVIMM",28,0)
 ;;0~12~.12~Diagnosis 5:  ~Diagnosis 5:  ~$$DISPLY01^PXCEPOV~EPOV^PXCEVIMM~~~
"RTN","PXCEVIMM",29,0)
 ;;0~13~.13~Diagnosis 6:  ~Diagnosis 6:  ~$$DISPLY01^PXCEPOV~EPOV^PXCEVIMM~~~
"RTN","PXCEVIMM",30,0)
 ;;0~14~.14~Diagnosis 7:  ~Diagnosis 7:  ~$$DISPLY01^PXCEPOV~EPOV^PXCEVIMM~~~
"RTN","PXCEVIMM",31,0)
 ;;0~15~.15~Diagnosis 8:  ~Diagnosis 8:  ~$$DISPLY01^PXCEPOV~EPOV^PXCEVIMM~~~
"RTN","PXCEVIMM",32,0)
 ;;
"RTN","PXCEVIMM",33,0)
 ;
"RTN","PXCEVIMM",34,0)
 ;Cannot ask work processing
"RTN","PXCEVIMM",35,0)
 ;;12~2~1202~Ordering Provider:  ~Ordering Provider:  ~~EPROV12^PXCEPRV~~~D
"RTN","PXCEVIMM",36,0)
 ;
"RTN","PXCEVIMM",37,0)
 ;The interface for AICS to get list on form for help.
"RTN","PXCEVIMM",38,0)
INTRFACE ;;PX SELECT IMMUNIZATIONS
"RTN","PXCEVIMM",39,0)
 ;
"RTN","PXCEVIMM",40,0)
 ;********************************
"RTN","PXCEVIMM",41,0)
 ;Special cases for display.
"RTN","PXCEVIMM",42,0)
 ;
"RTN","PXCEVIMM",43,0)
 ;********************************
"RTN","PXCEVIMM",44,0)
 ;Special cases for edit.
"RTN","PXCEVIMM",45,0)
 ;
"RTN","PXCEVIMM",46,0)
ECONTRAI ;
"RTN","PXCEVIMM",47,0)
 I $P(PXCEAFTR($P(PXCETEXT,"~",1)),"^",$P(PXCETEXT,"~",2))'="" D
"RTN","PXCEVIMM",48,0)
 . N DIERR,PXCEDILF,PXCEINT,PXCEEXT
"RTN","PXCEVIMM",49,0)
 . S PXCEINT=$P(PXCEAFTR($P(PXCETEXT,"~",1)),"^",$P(PXCETEXT,"~",2))
"RTN","PXCEVIMM",50,0)
 . S PXCEEXT=$$EXTERNAL^DILFD(PXCEFILE,$P(PXCETEXT,"~",3),"",PXCEINT,"PXCEDILF")
"RTN","PXCEVIMM",51,0)
 . S DIR("B")=$S('$D(DIERR):PXCEEXT,1:PXCEINT)
"RTN","PXCEVIMM",52,0)
 E  S DIR("B")="NO"
"RTN","PXCEVIMM",53,0)
 S DIR(0)=PXCEFILE_","_$P(PXCETEXT,"~",3)_"A"
"RTN","PXCEVIMM",54,0)
 S DIR("A")=$P(PXCETEXT,"~",4)
"RTN","PXCEVIMM",55,0)
 S:$P(PXCETEXT,"~",8)]"" DIR("?")=$P(PXCETEXT,"~",8)
"RTN","PXCEVIMM",56,0)
 D ^DIR
"RTN","PXCEVIMM",57,0)
 K DIR,DA
"RTN","PXCEVIMM",58,0)
 I X="@" S Y="@"
"RTN","PXCEVIMM",59,0)
 E  I $D(DTOUT)!$D(DUOUT) S PXCEEND=1 Q
"RTN","PXCEVIMM",60,0)
 S $P(PXCEAFTR($P(PXCETEXT,"~",1)),"^",$P(PXCETEXT,"~",2))=$P(Y,"^")
"RTN","PXCEVIMM",61,0)
 Q
"RTN","PXCEVIMM",62,0)
 ;
"RTN","PXCEVIMM",63,0)
ELOT ;
"RTN","PXCEVIMM",64,0)
 I $P(PXCEAFTR($P(PXCETEXT,"~",1)),"^",$P(PXCETEXT,"~",2))'="" D
"RTN","PXCEVIMM",65,0)
 . N DIERR,PXCEDILF,PXCEINT,PXCEEXT
"RTN","PXCEVIMM",66,0)
 . S PXCEINT=$P(PXCEAFTR($P(PXCETEXT,"~",1)),"^",$P(PXCETEXT,"~",2))
"RTN","PXCEVIMM",67,0)
 . S PXCEEXT=$$EXTERNAL^DILFD(PXCEFILE,$P(PXCETEXT,"~",3),"",PXCEINT,"PXCEDILF")
"RTN","PXCEVIMM",68,0)
 . S DIR("B")=$S('$D(DIERR):PXCEEXT,1:PXCEINT)
"RTN","PXCEVIMM",69,0)
 S DIR(0)="PAO^9999999.41:EM^K:$P(^(0),U,3)'=0!($P(^(0),U,4)'=$P(PXCEAFTR(0),U,1)) X"
"RTN","PXCEVIMM",70,0)
 S DIR("A")=$P(PXCETEXT,"~",4)
"RTN","PXCEVIMM",71,0)
 S:$P(PXCETEXT,"~",8)]"" DIR("?")=$P(PXCETEXT,"~",8)
"RTN","PXCEVIMM",72,0)
 D ^DIR
"RTN","PXCEVIMM",73,0)
 K DIR,DA
"RTN","PXCEVIMM",74,0)
 I X="@" S Y="@"
"RTN","PXCEVIMM",75,0)
 E  I $D(DTOUT)!$D(DUOUT) S PXCEEND=1 Q
"RTN","PXCEVIMM",76,0)
 S:Y'<0 $P(PXCEAFTR($P(PXCETEXT,"~",1)),"^",$P(PXCETEXT,"~",2))=$P(Y,"^")
"RTN","PXCEVIMM",77,0)
 Q
"RTN","PXCEVIMM",78,0)
 ;
"RTN","PXCEVIMM",79,0)
 ;
"RTN","PXCEVIMM",80,0)
EPOV ;Edit the Associated DX
"RTN","PXCEVIMM",81,0)
 N PXACS,PXACSREC,PXDATE,PXDEF,PXDXASK,PXXX
"RTN","PXCEVIMM",82,0)
 S PXDATE=$S($D(PXCEVIEN)=1:$$CSDATE^PXDXUTL(PXCEVIEN),$D(PXCEAPDT)=1:PXCEAPDT,1:DT)
"RTN","PXCEVIMM",83,0)
 S PXACSREC=$$ACTDT^PXDXUTL(PXDATE),PXACS=$P(PXACSREC,"^",3)
"RTN","PXCEVIMM",84,0)
 I PXACS["-" S PXACS=$P(PXACS,"-",1,2)
"RTN","PXCEVIMM",85,0)
 I $P(PXCEAFTR($P(PXCETEXT,"~",1)),"^",$P(PXCETEXT,"~",2))'="" D
"RTN","PXCEVIMM",86,0)
 .N DIERR,PXCEDILF,PXCEINT,PXCEEXT
"RTN","PXCEVIMM",87,0)
 .S PXCEINT=$P(PXCEAFTR($P(PXCETEXT,"~",1)),"^",$P(PXCETEXT,"~",2))
"RTN","PXCEVIMM",88,0)
 .S PXCEEXT=$$EXTERNAL^DILFD(PXCEFILE,$P(PXCETEXT,"~",3),"",PXCEINT,"PXCEDILF")
"RTN","PXCEVIMM",89,0)
 .S DIR("B")=$S('$D(DIERR):PXCEEXT,1:PXCEINT)
"RTN","PXCEVIMM",90,0)
 I $P(PXACSREC,U,1)'="ICD" D
"RTN","PXCEVIMM",91,0)
 . S PXDXASK=PXACS_" "_$P(PXCETEXT,"~",4)
"RTN","PXCEVIMM",92,0)
 . S PXDEF=$G(DIR("B")),PXAGAIN=0 D ^PXDSLK I PXXX=-1 S Y=-1 Q
"RTN","PXCEVIMM",93,0)
 . I PXXX="@" S Y="@" Q
"RTN","PXCEVIMM",94,0)
 . S Y=$P($$ICDDATA^ICDXCODE("DIAG",$P($P(PXXX,U,1),";",2),PXDATE,"E"),U,1)
"RTN","PXCEVIMM",95,0)
 I $P(PXACSREC,U,1)="ICD" D
"RTN","PXCEVIMM",96,0)
 . S DIR(0)=PXCEFILE_","_$P(PXCETEXT,"~",3)_"A"
"RTN","PXCEVIMM",97,0)
 . S DIR("A")=PXACS_" "_$P(PXCETEXT,"~",4)
"RTN","PXCEVIMM",98,0)
 . S:$P(PXCETEXT,"~",8)]"" DIR("?")=$P(PXCETEXT,"~",8)
"RTN","PXCEVIMM",99,0)
 . D ^DIR
"RTN","PXCEVIMM",100,0)
 K DIR,DA
"RTN","PXCEVIMM",101,0)
 I X="@" S Y="@" S $P(PXCEAFTR($P(PXCETEXT,"~",1)),"^",$P(PXCETEXT,"~",2))=$P(Y,"^") Q
"RTN","PXCEVIMM",102,0)
 I $D(DTOUT)!$D(DUOUT) S PXCEEND=1,PXCEQUIT=1 Q
"RTN","PXCEVIMM",103,0)
 I +Y'>0 S PXCEEND=1 Q  ;S:$P(PXCETEXT,"~",3)=".08" PXCEQUIT=1 Q
"RTN","PXCEVIMM",104,0)
 ;See if this diagnosis is in the PXCEAFTR(0)
"RTN","PXCEVIMM",105,0)
 I $P(PXCETEXT,"~",2)'=8,(+Y=$P($G(PXCEAFTR(0)),"^",8)) S PXCEEND=1
"RTN","PXCEVIMM",106,0)
 I $P(PXCETEXT,"~",2)'=9,(+Y=$P($G(PXCEAFTR(0)),"^",9)) S PXCEEND=1
"RTN","PXCEVIMM",107,0)
 I $P(PXCETEXT,"~",2)'=10,(+Y=$P($G(PXCEAFTR(0)),"^",10)) S PXCEEND=1
"RTN","PXCEVIMM",108,0)
 I $P(PXCETEXT,"~",2)'=11,(+Y=$P($G(PXCEAFTR(0)),"^",11)) S PXCEEND=1
"RTN","PXCEVIMM",109,0)
 I $P(PXCETEXT,"~",2)'=12,(+Y=$P($G(PXCEAFTR(0)),"^",12)) S PXCEEND=1
"RTN","PXCEVIMM",110,0)
 I $P(PXCETEXT,"~",2)'=13,(+Y=$P($G(PXCEAFTR(0)),"^",13)) S PXCEEND=1
"RTN","PXCEVIMM",111,0)
 I $P(PXCETEXT,"~",2)'=14,(+Y=$P($G(PXCEAFTR(0)),"^",14)) S PXCEEND=1
"RTN","PXCEVIMM",112,0)
 I $P(PXCETEXT,"~",2)'=15,(+Y=$P($G(PXCEAFTR(0)),"^",15)) S PXCEEND=1
"RTN","PXCEVIMM",113,0)
 I $G(PXCEEND)=1 W !,$C(7),"Duplicate Diagnosis is not allowed." D WAIT^PXCEHELP Q
"RTN","PXCEVIMM",114,0)
 S $P(PXCEAFTR($P(PXCETEXT,"~",1)),"^",$P(PXCETEXT,"~",2))=$P(Y,"^")
"RTN","PXCEVIMM",115,0)
 D:+Y>0 DIAGNOS^PXCEVFI4(+Y)
"RTN","PXCEVIMM",116,0)
 Q
"RTN","PXCEVIMM",117,0)
 ;
"RTN","PXCEVIMM",118,0)
 ;********************************
"RTN","PXCEVIMM",119,0)
 ;Display text for the .01 field which is a pointer to Immunization.
"RTN","PXCEVIMM",120,0)
 ;(Must have is called by ASK^PXCEVFI2 and DEL^PXCEVFI2.)
"RTN","PXCEVIMM",121,0)
DISPLY01(PXCEIMM) ;
"RTN","PXCEVIMM",122,0)
 N DIERR,PXCEDILF,PXCEINT,PXCEEXT
"RTN","PXCEVIMM",123,0)
 S PXCEINT=$P(PXCEIMM,"^",1)
"RTN","PXCEVIMM",124,0)
 S PXCEEXT=$$EXTERNAL^DILFD(9000010.11,.01,"",PXCEINT,"PXCEDILF")
"RTN","PXCEVIMM",125,0)
 Q $S('$D(DIERR):PXCEEXT,1:PXCEINT)
"RTN","PXCEVIMM",126,0)
 ;
"RTN","PXDSLK")
0^50^B44674639^n/a
"RTN","PXDSLK",1,0)
PXDSLK ;ALB/RBD - COPIED FROM ICDLOOK TO LOOK UP ICD-10 DX CODE;01 May 2014  1:39 PM
"RTN","PXDSLK",2,0)
 ;;1.0;PCE PATIENT CARE ENCOUNTER;**199**;Aug 12, 1996;Build 51
"RTN","PXDSLK",3,0)
 ;;
"RTN","PXDSLK",4,0)
 ;
"RTN","PXDSLK",5,0)
 ; Reference to CODEC^ICDEX supported by ICR #5747
"RTN","PXDSLK",6,0)
 ; Reference to CODEN^ICDEX supported by ICR #5747
"RTN","PXDSLK",7,0)
 ; Reference to ^DISV supported by ICR #510 
"RTN","PXDSLK",8,0)
 ;
"RTN","PXDSLK",9,0)
 ; PXDATE is the EFFECTIVE DATE that is passed from the Calling Routine
"RTN","PXDSLK",10,0)
 ; PXAGAIN controls the "Try Another" prompt;  0 = do not prompt
"RTN","PXDSLK",11,0)
 ; PXDEF may be passed in as the default Dx value to be prompted
"RTN","PXDSLK",12,0)
 ; PXDXASK if present will be used as the prompt when asking for the Dx code  
"RTN","PXDSLK",13,0)
 ;
"RTN","PXDSLK",14,0)
EN ; Initialize variables
"RTN","PXDSLK",15,0)
 D HOME^%ZIS S DT=$$DT^XLFDT D LOOK
"RTN","PXDSLK",16,0)
 G EXIT
"RTN","PXDSLK",17,0)
LOOK ; Look-up term
"RTN","PXDSLK",18,0)
 S PXXX=-1 D ASK K DIC
"RTN","PXDSLK",19,0)
AGAIN ; Try again?
"RTN","PXDSLK",20,0)
 Q:$G(PXAGAIN)=0
"RTN","PXDSLK",21,0)
 W !,"Try another" S %=$S(+($$X):1,1:2)
"RTN","PXDSLK",22,0)
 D YN^DICN I %=-1!(%=2) Q
"RTN","PXDSLK",23,0)
 I '% W !!,"You have searched for an ICD-10 diagnosis code, do you want to" G AGAIN
"RTN","PXDSLK",24,0)
 I +($$X)&(%=1) K PXDEF G LOOK
"RTN","PXDSLK",25,0)
 I '+($$X)&(%=1) G LOOK
"RTN","PXDSLK",26,0)
 I (+($$X)&(%=2))!('+($$X)&(%=1)) Q
"RTN","PXDSLK",27,0)
 G LOOK Q 
"RTN","PXDSLK",28,0)
ASK ; Get user input
"RTN","PXDSLK",29,0)
 N ARY,DIR,DIRUT,DIROUT,PXSYS,PXO,PXY,RES,Y
"RTN","PXDSLK",30,0)
 K %DT,II,PXDT,PXMAX,PXNUMB,PXY
"RTN","PXDSLK",31,0)
 I $G(PXDATE)'="" S Y=PXDATE
"RTN","PXDSLK",32,0)
 I $G(PXDATE)="" K %DT S %DT="AEX",%DT("A")="Date of Interest? " D ^%DT K %DT I Y<0 G EXIT
"RTN","PXDSLK",33,0)
 S PXDT=Y,PXSYS=$P($P($$ACTDT^PXDXUTL(PXDT),U,3),"-",1,2)
"RTN","PXDSLK",34,0)
 K DIR
"RTN","PXDSLK",35,0)
 S DIR("A")=$S($D(PXDXASK):PXDXASK,1:PXSYS_" Diagnosis Code: ")
"RTN","PXDSLK",36,0)
 S DIR("?")="^D INPHLP^PXDSLK",DIR("??")="^D INPHLP^PXDSLK"
"RTN","PXDSLK",37,0)
 I $G(PXDEF)'="",'$D(PXDXASK) S X=PXDEF G ASK2 ; K PXDEF G ASK2
"RTN","PXDSLK",38,0)
 I $G(PXDEF)'="" S DIR("B")=PXDEF
"RTN","PXDSLK",39,0)
 S DIR(0)="FAO^0:60" D ^DIR K DIR I $D(DTOUT)!$D(DUOUT) G EXIT
"RTN","PXDSLK",40,0)
 I $L(X)=1,X'=" " D MIN2^PXDSLK G ASK
"RTN","PXDSLK",41,0)
 I X="@" S PXXX="@" Q
"RTN","PXDSLK",42,0)
ASK2 I PXSYS["10" S PXTXT=X D ICD10 I $G(PXXX)=-2 S PXXX=-1,PXDEF="" G ASK
"RTN","PXDSLK",43,0)
 I PXSYS["-9" W !!,"SORRY, ICD-9 SPECIAL LOOK-UP NOT IMPLEMENTED." Q
"RTN","PXDSLK",44,0)
 I +$G(PXNUMB)>+$G(PXMAX) G ASK
"RTN","PXDSLK",45,0)
 I +PXXX>0 D
"RTN","PXDSLK",46,0)
 . N PXICDIEN S PXICDIEN=$$CODEN^ICDEX($P($P(PXXX,U,1),";",2))
"RTN","PXDSLK",47,0)
 . I +PXICDIEN'=-1 D SAVSPACE("^ICD9(",+PXICDIEN)
"RTN","PXDSLK",48,0)
 ;
"RTN","PXDSLK",49,0)
 Q:$G(X)=""  I $G(PXXX)=-1 S PXDEF="" G ASK
"RTN","PXDSLK",50,0)
 Q
"RTN","PXDSLK",51,0)
ICD10 ; ICD-10 Search
"RTN","PXDSLK",52,0)
 N DIROUT,DUOUT,DTOUT,PXEXIT S PXEXIT=0
"RTN","PXDSLK",53,0)
 ; Begin Recursive Loop
"RTN","PXDSLK",54,0)
 S PXTXT=$G(PXTXT) Q:'$L(PXTXT)
"RTN","PXDSLK",55,0)
 I PXTXT=" " S PXTXT=$$SPACEBAR("^ICD9(") I PXTXT=" " S PXXX=-2 Q
"RTN","PXDSLK",56,0)
 S PXNUMB=$$FREQ^LEXU(PXTXT),PXMAX=$$MAX^LEXU(30)
"RTN","PXDSLK",57,0)
 I PXNUMB>PXMAX D  Q:%'=1
"RTN","PXDSLK",58,0)
 . W !!,"Searching for '",PXTXT,"' requires inspecting ",PXNUMB," records to determine"
"RTN","PXDSLK",59,0)
 . W !,"if they match the search criteria.  This could take quite some time."
"RTN","PXDSLK",60,0)
 . W !,"Please refine the search by including more detail than '",PXTXT,"'.",!
"RTN","PXDSLK",61,0)
 . K PXDEF
"RTN","PXDSLK",62,0)
 . W !,"Do you wish to continue (Y/N)" S %=2 D YN^DICN W !
"RTN","PXDSLK",63,0)
 S PXDT=$P($G(PXDT),".",1) S:PXDT'?7N PXDT=$$DT^XLFDT
"RTN","PXDSLK",64,0)
 K PXNUMB,PXMAX D LK1
"RTN","PXDSLK",65,0)
 Q
"RTN","PXDSLK",66,0)
LK1 ; Lookup
"RTN","PXDSLK",67,0)
 Q:+($G(PXEXIT))>0  K PXY
"RTN","PXDSLK",68,0)
 S PXY=$$DIAGSRCH^LEX10CS(PXTXT,.PXY,PXDT,30)
"RTN","PXDSLK",69,0)
 S:$O(PXY(" "),-1)>0 PXY=+PXY
"RTN","PXDSLK",70,0)
 ; Nothing found
"RTN","PXDSLK",71,0)
 I +PXY'>0 W !!,"No records found matching the value entered, revise search or enter ""?"" for",!,"help.",! S PXXX=-2 Q
"RTN","PXDSLK",72,0)
 S PXXX=$$SEL^PXSELDS(.PXY,8),X=PXXX
"RTN","PXDSLK",73,0)
 I PXXX="@" S PXAGAIN=0 Q
"RTN","PXDSLK",74,0)
 I $D(DUOUT)&('$D(DIROUT)) W:'$D(PXNT) !!,"  Exiting list",! Q
"RTN","PXDSLK",75,0)
 I $D(DTOUT)&('$D(DIROUT)) W !!,"  Try again later",! S PXXX=-1,PXEXIT=1 Q
"RTN","PXDSLK",76,0)
 I $D(DIROUT) W !!,"  Exiting list",! S PXXX=-1,PXEXIT=1 Q
"RTN","PXDSLK",77,0)
 ; Abort if timed out or user enters "^^"
"RTN","PXDSLK",78,0)
 I $D(DTOUT)!($D(DIROUT)) S PXEXIT=1 Q
"RTN","PXDSLK",79,0)
 ; Quit if already at top level and user enters "^"
"RTN","PXDSLK",80,0)
 I $D(DUOUT),'$D(DIROUT) Q
"RTN","PXDSLK",81,0)
 ; No Selection
"RTN","PXDSLK",82,0)
 I '$D(DUOUT),PXXX=-1 S PXEXIT=1,PXXX=-2 W !!,"  No data selected",!
"RTN","PXDSLK",83,0)
 ; Code Found and Selected
"RTN","PXDSLK",84,0)
 I $P(PXXX,";")'="99:CAT" D WRT S PXEXIT=1 Q
"RTN","PXDSLK",85,0)
 ; Category Found and Selected
"RTN","PXDSLK",86,0)
 D NXT G:+($G(PXEXIT))'>0 LK1
"RTN","PXDSLK",87,0)
 Q
"RTN","PXDSLK",88,0)
WRT ; Write Output
"RTN","PXDSLK",89,0)
 I +PXXX'=-1,PXXX'=-2 D
"RTN","PXDSLK",90,0)
 . N PXCODE,PXTXT,PXI S PXCODE=$P($P(PXXX,"^"),";",2),PXTXT(1)=$P(PXXX,"^",2)
"RTN","PXDSLK",91,0)
 . D PR^PXSELDS(.PXTXT,48) W !
"RTN","PXDSLK",92,0)
 . W !," ICD-10 Diagnosis code:       ",?31,PXCODE
"RTN","PXDSLK",93,0)
 . W !," ICD-10 Diagnosis description:",?31,PXTXT(1)
"RTN","PXDSLK",94,0)
 . S PXI=1 F  S PXI=$O(PXTXT(PXI)) Q:+PXI'>0  W !,?31,$G(PXTXT(PXI))
"RTN","PXDSLK",95,0)
 . S PXEXIT=1
"RTN","PXDSLK",96,0)
 Q
"RTN","PXDSLK",97,0)
NXT ; Next
"RTN","PXDSLK",98,0)
 Q:+($G(PXEXIT))>0  N PXNT,PXND,PXX
"RTN","PXDSLK",99,0)
 S PXNT=$G(PXTXT),PXND=$G(PXDT),PXX=$G(PXXX)
"RTN","PXDSLK",100,0)
 N PXTXT,PXDT S PXTXT=$P($P(PXX,"^"),";",2),PXDT=PXND
"RTN","PXDSLK",101,0)
 G LK1
"RTN","PXDSLK",102,0)
 Q
"RTN","PXDSLK",103,0)
 ; retrieves the last code selected by the user - space bar recall
"RTN","PXDSLK",104,0)
 ; logic here
"RTN","PXDSLK",105,0)
SPACEBAR(PXROOT) ;
"RTN","PXDSLK",106,0)
 N PXICDIEN,PXRTV
"RTN","PXDSLK",107,0)
 S PXRTV=" " I PXROOT="^ICD9(" D
"RTN","PXDSLK",108,0)
 . S PXICDIEN=$G(^DISV(DUZ,PXROOT))  ; PCE subscribes to ICR #510
"RTN","PXDSLK",109,0)
 . I $L(PXICDIEN) S PXRTV=$$CODEC^ICDEX(80,PXICDIEN)
"RTN","PXDSLK",110,0)
 I PXRTV=" " W " ??"
"RTN","PXDSLK",111,0)
 Q PXRTV
"RTN","PXDSLK",112,0)
 ;
"RTN","PXDSLK",113,0)
 ; store the selected code for the space bar recall feature above
"RTN","PXDSLK",114,0)
SAVSPACE(PXROOT,PXRETV) ;
"RTN","PXDSLK",115,0)
 I +$G(DUZ)=0 Q
"RTN","PXDSLK",116,0)
 I +$G(PXRETV)=0 Q
"RTN","PXDSLK",117,0)
 ; PCE subscribes to ICR #510 for call to RECALL API below
"RTN","PXDSLK",118,0)
 I PXROOT="^ICD9(" D RECALL^DILFD(80,PXRETV_",",+DUZ) Q
"RTN","PXDSLK",119,0)
 Q
"RTN","PXDSLK",120,0)
 ;
"RTN","PXDSLK",121,0)
INPHLP ; Help text controller for ICD-10
"RTN","PXDSLK",122,0)
 N PXPAUSE S PXPAUSE=0
"RTN","PXDSLK",123,0)
 I X["???" D QM3 Q
"RTN","PXDSLK",124,0)
 I X["??" D QM2 Q
"RTN","PXDSLK",125,0)
 I X["?" D QM1 Q
"RTN","PXDSLK",126,0)
 Q
"RTN","PXDSLK",127,0)
 ;
"RTN","PXDSLK",128,0)
QM ; Diagnosis help text
"RTN","PXDSLK",129,0)
 ; if calling from outside, set PXPAUSE=1 to pause the display and force the user to press <Enter> to continue
"RTN","PXDSLK",130,0)
QM1 ; simple help text for 1 question mark
"RTN","PXDSLK",131,0)
 W !,"Enter code or ""text"" for more information.",!
"RTN","PXDSLK",132,0)
 I $G(PXPAUSE) N CR R !,"Press <Enter> to continue: ",CR:DTIME
"RTN","PXDSLK",133,0)
 Q
"RTN","PXDSLK",134,0)
QM2 ; enhanced help text for 2 question marks
"RTN","PXDSLK",135,0)
 W !,"Enter a ""free text"" term or part of a term such as ""femur fracture"".",!
"RTN","PXDSLK",136,0)
 W !,"  or",!
"RTN","PXDSLK",137,0)
 W !,"Enter a ""classification code"" (ICD/CPT etc) to find the single term associated"
"RTN","PXDSLK",138,0)
 W !,"with the code.",!
"RTN","PXDSLK",139,0)
 W !," or",!
"RTN","PXDSLK",140,0)
 W !,"Enter a ""partial code"". Include the decimal when a search criterion includes"
"RTN","PXDSLK",141,0)
 W !,"3 characters or more for code searches.",!
"RTN","PXDSLK",142,0)
 I $G(PXPAUSE) N CR R !,"Press <Enter> to continue: ",CR:DTIME
"RTN","PXDSLK",143,0)
 Q
"RTN","PXDSLK",144,0)
QM3 ; further explanation of format when there are multiple returns, displayed for 3 question marks.
"RTN","PXDSLK",145,0)
 W !,"Number of Code Matches"
"RTN","PXDSLK",146,0)
 W !,"----------------------",!
"RTN","PXDSLK",147,0)
 W !,"The ICD-10 Diagnosis Code search will show the user the number of matches"
"RTN","PXDSLK",148,0)
 W !,"found, indicate if additional characters in ICD code exist, and the number"
"RTN","PXDSLK",149,0)
 W !,"of codes within the category or subcategory that are available for selection."
"RTN","PXDSLK",150,0)
 W !,"For example:",!
"RTN","PXDSLK",151,0)
 W !,"14 matches found",!
"RTN","PXDSLK",152,0)
 W !,"M91. -    Juvenile osteochondrosis of hip and pelvis (19)",!
"RTN","PXDSLK",153,0)
 W !,"This indicates that 14 unique matches or matching groups have been found and"
"RTN","PXDSLK",154,0)
 W !,"will be displayed.",!
"RTN","PXDSLK",155,0)
 W !,"M91. -   the ""-"" indicates that there are additional characters that specify"
"RTN","PXDSLK",156,0)
 W !,"         unique ICD-10 codes available.",!
"RTN","PXDSLK",157,0)
 W !,"(19)     Indicates that there are 19 additional ICD-10 codes in the M91"
"RTN","PXDSLK",158,0)
 W !,"         ""family"" that are possible selections.",!
"RTN","PXDSLK",159,0)
 I $G(PXPAUSE) N CR R !,"Press <Enter> to continue: ",CR:DTIME
"RTN","PXDSLK",160,0)
 Q
"RTN","PXDSLK",161,0)
 ;
"RTN","PXDSLK",162,0)
MIN2 ; Minimum length of 2 characters message
"RTN","PXDSLK",163,0)
 W $C(7),"  ??",!
"RTN","PXDSLK",164,0)
 W !,"Please enter at least the first two characters of the ICD-10 code or "
"RTN","PXDSLK",165,0)
 W !,"code description to start the search.",!
"RTN","PXDSLK",166,0)
 Q
"RTN","PXDSLK",167,0)
 ;
"RTN","PXDSLK",168,0)
EXIT ; Clean up environment and quit
"RTN","PXDSLK",169,0)
 K %,DIC,DIR,DIROUT,DIRUT,DTOUT,DUOUT,LEX,PXAGAIN,PXDEF,PXDXASK
"RTN","PXDSLK",170,0)
 Q
"RTN","PXDSLK",171,0)
X(LEX) ; Evaluate X
"RTN","PXDSLK",172,0)
 Q:$L($G(X)) 1  Q 0
"RTN","PXDSLK",173,0)
Y(LEX) ; Evaluate Y
"RTN","PXDSLK",174,0)
 Q:+($G(Y))>1 1  Q 0
"RTN","PXDXUTL")
0^2^B9983043^n/a
"RTN","PXDXUTL",1,0)
PXDXUTL ;HP/TJH - DX CODE SET UTILITIES FOR PCE ;15 Aug 2012  9:22 AM
"RTN","PXDXUTL",2,0)
 ;;1.0;PCE PATIENT CARE ENCOUNTER;**199**;Aug 12, 1996;Build 51
"RTN","PXDXUTL",3,0)
 ;
"RTN","PXDXUTL",4,0)
 Q  ; Library utilities, do not enter from top.
"RTN","PXDXUTL",5,0)
 ;
"RTN","PXDXUTL",6,0)
ACTIVE(PXCS) ; Return start date for requested coding system
"RTN","PXDXUTL",7,0)
 ;  Input:  Coding system abbreviation from #80.4 or #757.03
"RTN","PXDXUTL",8,0)
 ;          ICD, ICP, 10D, 10P
"RTN","PXDXUTL",9,0)
 ;
"RTN","PXDXUTL",10,0)
 ;  Output:  n^FM date  where
"RTN","PXDXUTL",11,0)
 ;           n = 0 ; requested coding system is not active
"RTN","PXDXUTL",12,0)
 ;           n = 1 ; requested coding system is active
"RTN","PXDXUTL",13,0)
 ;           FM date = starting date of requested code type
"RTN","PXDXUTL",14,0)
 ;      or
"RTN","PXDXUTL",15,0)
 ;           -1^error message ; coding system not valid
"RTN","PXDXUTL",16,0)
 ;
"RTN","PXDXUTL",17,0)
 N PXICDD,PXOUT,X,Y
"RTN","PXDXUTL",18,0)
 S X=PXCS,DIC=80.4,DIC(0)="",D="C" D IX^DIC
"RTN","PXDXUTL",19,0)
 I Y<0 Q "-1^Invalid Coding System"
"RTN","PXDXUTL",20,0)
 S PXICDD=$$IMPDATE^LEXU(PXCS)
"RTN","PXDXUTL",21,0)
 S PXOUT=$S(PXICDD'<DT:0,1:1)_U_PXICDD
"RTN","PXDXUTL",22,0)
 K D,DIC
"RTN","PXDXUTL",23,0)
 Q PXOUT
"RTN","PXDXUTL",24,0)
 ;
"RTN","PXDXUTL",25,0)
AVDX ; Build array of available Diagnosis Sets (Dx only, not Procedure Sets) in PXDXA("DX SET",fm-date)
"RTN","PXDXUTL",26,0)
 ; [1] = IEN in #80.4
"RTN","PXDXUTL",27,0)
 ; [2] = Code Set name
"RTN","PXDXUTL",28,0)
 ; [3] = Code Set abbreviation
"RTN","PXDXUTL",29,0)
 ; [4] = File number holding code set values (always 80 in this function)
"RTN","PXDXUTL",30,0)
 ; [5] = Date that code set becomes active (FM format)
"RTN","PXDXUTL",31,0)
 N PXMSG,PXI,PXD,PXR
"RTN","PXDXUTL",32,0)
 K PXDXA
"RTN","PXDXUTL",33,0)
 D LIST^DIC(80.4,"",".02;.03I;.04I","P","","","","","I $P(^(0),U,3)=80","","PXDXA","PXMSG")
"RTN","PXDXUTL",34,0)
 Q:'$D(PXDXA("DILIST",0))
"RTN","PXDXUTL",35,0)
 F PXI=1:1:$P(PXDXA("DILIST",0),U,1) D
"RTN","PXDXUTL",36,0)
 . S PXR=PXDXA("DILIST",PXI,0),PXD=$P(PXR,U,5)
"RTN","PXDXUTL",37,0)
 . S PXDXA("DX SET",PXD)=PXR
"RTN","PXDXUTL",38,0)
 K PXDXA("DILIST")
"RTN","PXDXUTL",39,0)
 Q
"RTN","PXDXUTL",40,0)
 ;
"RTN","PXDXUTL",41,0)
AVDXT ; AVDX TEST SET
"RTN","PXDXUTL",42,0)
 ;S PXDXA("DX SET",2781001)="1^ICD-9-CM^ICD^80^2781001"
"RTN","PXDXUTL",43,0)
 ;S PXDXA("DX SET",3131001)="30^ICD-10-CM^10D^80^3131001"
"RTN","PXDXUTL",44,0)
 ;S PXDXA("DX SET",3201001)="47^ICD-11-CM^11D^80^3201001"
"RTN","PXDXUTL",45,0)
 ;S PXDXA("DX SET",3501001)="50^ICD-12-CM^12D^80^3501001"
"RTN","PXDXUTL",46,0)
 Q
"RTN","PXDXUTL",47,0)
 ;
"RTN","PXDXUTL",48,0)
ACTDT(PXTRXD) ; Active Dx Code Set for date supplied
"RTN","PXDXUTL",49,0)
 ; Input - a FileMan date
"RTN","PXDXUTL",50,0)
 ; Returns 4 piece value:
"RTN","PXDXUTL",51,0)
 ; [1] = Code Set abbreviation
"RTN","PXDXUTL",52,0)
 ; [2] = IEN into file #80.4
"RTN","PXDXUTL",53,0)
 ; [3] = Long name
"RTN","PXDXUTL",54,0)
 ; [4] = Activation Date (FM)
"RTN","PXDXUTL",55,0)
 ; or
"RTN","PXDXUTL",56,0)
 ; 0 if no active Dx code set is found for the date supplied
"RTN","PXDXUTL",57,0)
 ;
"RTN","PXDXUTL",58,0)
 N PXDT,PXOUT,PXREC
"RTN","PXDXUTL",59,0)
 D AVDX
"RTN","PXDXUTL",60,0)
 I '$D(PXDXA("DX SET")) Q 0
"RTN","PXDXUTL",61,0)
 S PXDT=0,PXOUT=0
"RTN","PXDXUTL",62,0)
 F  S PXDT=$O(PXDXA("DX SET",PXDT)) Q:PXDT=""  D
"RTN","PXDXUTL",63,0)
 . S PXREC=PXDXA("DX SET",PXDT)
"RTN","PXDXUTL",64,0)
 . I PXTRXD'<PXDT S PXOUT=$P(PXREC,U,3)_U_$P(PXREC,U,1)_U_$P(PXREC,U,2)_U_$P(PXREC,U,5)
"RTN","PXDXUTL",65,0)
 K PXDXA
"RTN","PXDXUTL",66,0)
 Q PXOUT
"RTN","PXDXUTL",67,0)
 ;
"RTN","PXDXUTL",68,0)
SDESC(PXPOVIEN) ; Return short description for Computed field .019 - ICD NARRATIVE of file [#9000010.07]
"RTN","PXDXUTL",69,0)
 ; This function is not intended for general use.
"RTN","PXDXUTL",70,0)
 ;   Input:  a pointer to V POV [#9000010.07]
"RTN","PXDXUTL",71,0)
 ;
"RTN","PXDXUTL",72,0)
 ;   Output: the versioned DIAGNOSIS field from ICD DIAGNOSIS file [#80]
"RTN","PXDXUTL",73,0)
 ;           based on the associated Visit Date
"RTN","PXDXUTL",74,0)
 I 'PXPOVIEN Q PXPOVIEN  ; if it's not a numeric IEN just send back the input value
"RTN","PXDXUTL",75,0)
 N PXDX,PXVISD,PXVISIEN,X
"RTN","PXDXUTL",76,0)
 S X="DX not found because Visit Date is not available."
"RTN","PXDXUTL",77,0)
 Q:'$P($G(^AUPNVPOV(PXPOVIEN,0)),U,3) X  ; Quit with error message; must have a visit date ptr.
"RTN","PXDXUTL",78,0)
 S PXDX=$P(^AUPNVPOV(PXPOVIEN,0),U,1) ; get the file #80 IEN for the diagnosis
"RTN","PXDXUTL",79,0)
 S PXVISIEN=$P(^AUPNVPOV(PXPOVIEN,0),U,3) ; get the Visit IEN
"RTN","PXDXUTL",80,0)
 S PXVISD=$$CSDATE(PXVISIEN) ; get Visit Date from VISIT file
"RTN","PXDXUTL",81,0)
 S X=$$ICDDATA^ICDXCODE("DIAG",PXDX,PXVISD,"I") ; feed data to ICDDATA function
"RTN","PXDXUTL",82,0)
 Q $S($P(X,U,1)=-1:$P(X,U,2),1:$P(X,U,4))  ; return error msg or description
"RTN","PXDXUTL",83,0)
 ;
"RTN","PXDXUTL",84,0)
CSDATE(VSITIEN) ; Determine date to be used with diagnosis code look-ups when making ^ICDXCODE calls
"RTN","PXDXUTL",85,0)
 ; Input - Visit IEN for file #9000010
"RTN","PXDXUTL",86,0)
 ; Output - FileMan date (Time element is removed if it exists)
"RTN","PXDXUTL",87,0)
 ; Returns Visit Date unless this is an "E" record, in which case it returns Data Entry Date.
"RTN","PXDXUTL",88,0)
 ; If, for some unknown reason, the Visit record doesn't exist the output will default to Today's date.
"RTN","PXDXUTL",89,0)
 ;
"RTN","PXDXUTL",90,0)
 N PXVREC
"RTN","PXDXUTL",91,0)
 S PXVREC=$S($L(VSITIEN):$G(^AUPNVSIT(VSITIEN,0)),1:"")
"RTN","PXDXUTL",92,0)
 Q $S(PXVREC="":DT,$P(PXVREC,U,7)="E":$P($P(PXVREC,U,2),".",1),1:$P($P(PXVREC,U,1),".",1))
"RTN","PXDXUTL",93,0)
 ;
"RTN","PXPXRM")
0^54^B24754616^B12998169
"RTN","PXPXRM",1,0)
PXPXRM ;SLC/PKR - APIs for Clinical Reminder indexes. ;08/31/2004
"RTN","PXPXRM",2,0)
 ;;1.0;PCE PATIENT CARE ENCOUNTER;**119,199**;Aug 12, 1996;Build 51
"RTN","PXPXRM",3,0)
 ;
"RTN","PXPXRM",4,0)
 ; Reference to CODEC^ICDEX supported by ICR #5747
"RTN","PXPXRM",5,0)
 ; Reference to CSI^ICDEX supported by ICR #5747
"RTN","PXPXRM",6,0)
 ; Reference to SINFO^ICDEX supported by ICR #5747
"RTN","PXPXRM",7,0)
 ;
"RTN","PXPXRM",8,0)
 Q
"RTN","PXPXRM",9,0)
 ;===============================================================
"RTN","PXPXRM",10,0)
KVFILE(FILENUM,X,DA) ;Delete indexes for a regular V File.
"RTN","PXPXRM",11,0)
 N VDATE,VISIT
"RTN","PXPXRM",12,0)
 S VISIT=$G(^AUPNVSIT(X(3),0))
"RTN","PXPXRM",13,0)
 I VISIT="" Q
"RTN","PXPXRM",14,0)
 S VDATE=$P(VISIT,U,1)
"RTN","PXPXRM",15,0)
 K ^PXRMINDX(FILENUM,"IP",X(1),X(2),VDATE,DA)
"RTN","PXPXRM",16,0)
 K ^PXRMINDX(FILENUM,"PI",X(2),X(1),VDATE,DA)
"RTN","PXPXRM",17,0)
 Q
"RTN","PXPXRM",18,0)
 ;
"RTN","PXPXRM",19,0)
 ;===============================================================
"RTN","PXPXRM",20,0)
KVFILEC(FILENUM,X,DA) ;Delete indexes for V Files with coded entries.
"RTN","PXPXRM",21,0)
 ; FILENUM = file number, e.g. 9000010.07
"RTN","PXPXRM",22,0)
 ;       X = Array of fields
"RTN","PXPXRM",23,0)
 ;           X(1) = Item pointer:  Dx for V POV, CPT for V CPT
"RTN","PXPXRM",24,0)
 ;           X(2) = PATIENT NAME (DFN)
"RTN","PXPXRM",25,0)
 ;           X(3) = VISIT (ptr to 9000010)
"RTN","PXPXRM",26,0)
 ;           X(4) = PRIMARY/SECONDARY for V POV
"RTN","PXPXRM",27,0)
 ;               or PRINCIPAL PROCEDURE FOR V CPT
"RTN","PXPXRM",28,0)
 ;      DA = IEN into FILENUM file
"RTN","PXPXRM",29,0)
 N CODE,CTYPE,PXCSYS,VDATE,VISIT
"RTN","PXPXRM",30,0)
 S VISIT=$G(^AUPNVSIT(X(3),0)) ; get Visit zero node
"RTN","PXPXRM",31,0)
 I VISIT="" Q  ; if Visit not found, bail out
"RTN","PXPXRM",32,0)
 S CTYPE=$S(X(4)="":"U",1:X(4)) ; U if blank otherwise use value passed in
"RTN","PXPXRM",33,0)
 S VDATE=$P(VISIT,U,1) ; get Visit Date/Time from 1st piece of zero node
"RTN","PXPXRM",34,0)
 S PXCSYS="ICD"
"RTN","PXPXRM",35,0)
 I FILENUM=9000010.07 D  ; if V POV get Coding System type
"RTN","PXPXRM",36,0)
 . S PXCSYS=$P($$SINFO^ICDEX($$CSI^ICDEX(80,X(1))),U,3) ; coding system abbreviation
"RTN","PXPXRM",37,0)
 I PXCSYS'="ICD" D KVFILEV Q  ; if not ICD-9, use alternate format and Quit
"RTN","PXPXRM",38,0)
 ; the following is the original format used for V CPT and ICD-9 diagnoses
"RTN","PXPXRM",39,0)
 K ^PXRMINDX(FILENUM,"IPP",X(1),CTYPE,X(2),VDATE,DA) ; Kill the "IPP" node
"RTN","PXPXRM",40,0)
 K ^PXRMINDX(FILENUM,"PPI",X(2),CTYPE,X(1),VDATE,DA) ; Kill the "PPI" node
"RTN","PXPXRM",41,0)
 Q
"RTN","PXPXRM",42,0)
 ;
"RTN","PXPXRM",43,0)
 ;===============================================================
"RTN","PXPXRM",44,0)
KVFILEV ; alternate index format for ICD-10 and higher, added with PX*1.0*199
"RTN","PXPXRM",45,0)
 S CODE=$$CODEC^ICDEX(80,X(1)) ; convert IEN to Dx code
"RTN","PXPXRM",46,0)
 K ^PXRMINDX(FILENUM,PXCSYS,"IPP",CODE,CTYPE,X(2),VDATE,DA)
"RTN","PXPXRM",47,0)
 K ^PXRMINDX(FILENUM,PXCSYS,"PPI",X(2),CTYPE,CODE,VDATE,DA)
"RTN","PXPXRM",48,0)
 Q
"RTN","PXPXRM",49,0)
 ;
"RTN","PXPXRM",50,0)
 ;===============================================================
"RTN","PXPXRM",51,0)
SVFILE(FILENUM,X,DA) ;Set indexes for a regular V File.
"RTN","PXPXRM",52,0)
 ;X(1)=ITEM, X(2)=DFN, X(3)=VISIT.
"RTN","PXPXRM",53,0)
 N VDATE,VISIT
"RTN","PXPXRM",54,0)
 S VISIT=$G(^AUPNVSIT(X(3),0))
"RTN","PXPXRM",55,0)
 I VISIT="" Q
"RTN","PXPXRM",56,0)
 S VDATE=$P(VISIT,U,1)
"RTN","PXPXRM",57,0)
 S ^PXRMINDX(FILENUM,"IP",X(1),X(2),VDATE,DA)=""
"RTN","PXPXRM",58,0)
 S ^PXRMINDX(FILENUM,"PI",X(2),X(1),VDATE,DA)=""
"RTN","PXPXRM",59,0)
 Q
"RTN","PXPXRM",60,0)
 ;
"RTN","PXPXRM",61,0)
 ;===============================================================
"RTN","PXPXRM",62,0)
SVFILEC(FILENUM,X,DA) ;Set indexes for V Files with coded entries. These
"RTN","PXPXRM",63,0)
 ;are V CPT and VPOV
"RTN","PXPXRM",64,0)
 ;X(1)=ITEM, X(2)=DFN, X(3)=VISIT,
"RTN","PXPXRM",65,0)
 ; for V CPT X(4)=PRINCIPAL PROCEDURE
"RTN","PXPXRM",66,0)
 ; for V POV X(4)=PRIMARY/SECONDARY
"RTN","PXPXRM",67,0)
 N CODE,CTYPE,PXCSYS,VDATE,VISIT
"RTN","PXPXRM",68,0)
 S VISIT=$G(^AUPNVSIT(X(3),0))
"RTN","PXPXRM",69,0)
 I VISIT="" Q
"RTN","PXPXRM",70,0)
 S CTYPE=$S(X(4)="":"U",1:X(4))
"RTN","PXPXRM",71,0)
 S VDATE=$P(VISIT,U,1)
"RTN","PXPXRM",72,0)
 S PXCSYS="ICD"
"RTN","PXPXRM",73,0)
 I FILENUM=9000010.07 D  ; if V POV get Coding System type
"RTN","PXPXRM",74,0)
 . S PXCSYS=$P($$SINFO^ICDEX($$CSI^ICDEX(80,X(1))),U,3) ; coding system abbreviation
"RTN","PXPXRM",75,0)
 I PXCSYS'="ICD" D SVFILEV Q  ; if not ICD-9 use alternate format and Quit
"RTN","PXPXRM",76,0)
 ; the following is the original format used for V CPT and ICD-9 diagnoses
"RTN","PXPXRM",77,0)
 S ^PXRMINDX(FILENUM,"IPP",X(1),CTYPE,X(2),VDATE,DA)=""
"RTN","PXPXRM",78,0)
 S ^PXRMINDX(FILENUM,"PPI",X(2),CTYPE,X(1),VDATE,DA)=""
"RTN","PXPXRM",79,0)
 Q
"RTN","PXPXRM",80,0)
 ;
"RTN","PXPXRM",81,0)
 ;===============================================================
"RTN","PXPXRM",82,0)
SVFILEV ; alternate index format for ICD-10 and higher, added with PX*1.0*199
"RTN","PXPXRM",83,0)
 S CODE=$$CODEC^ICDEX(80,X(1)) ; convert IEN to Dx code
"RTN","PXPXRM",84,0)
 S ^PXRMINDX(FILENUM,PXCSYS,"IPP",CODE,CTYPE,X(2),VDATE,DA)=""
"RTN","PXPXRM",85,0)
 S ^PXRMINDX(FILENUM,PXCSYS,"PPI",X(2),CTYPE,CODE,VDATE,DA)=""
"RTN","PXPXRM",86,0)
 Q
"RTN","PXPXRM",87,0)
 ;
"RTN","PXPXRM",88,0)
 ;===============================================================
"RTN","PXPXRM",89,0)
VCPT(DA,DATA) ;Return data for a specified V CPT entry.
"RTN","PXPXRM",90,0)
 N TEMP
"RTN","PXPXRM",91,0)
 S TEMP=^AUPNVCPT(DA,0)
"RTN","PXPXRM",92,0)
 S DATA("VISIT")=$P(TEMP,U,3)
"RTN","PXPXRM",93,0)
 S DATA("PROVIDER NARRATIVE")=$P(TEMP,U,4)
"RTN","PXPXRM",94,0)
 S DATA("DIAGNOSIS")=$P(TEMP,U,5)
"RTN","PXPXRM",95,0)
 S DATA("PRINCIPAL PROCEDURE")=$P(TEMP,U,7)
"RTN","PXPXRM",96,0)
 S DATA("QUANTITY")=$P(TEMP,U,16)
"RTN","PXPXRM",97,0)
 S DATA("COMMENTS")=$G(^AUPNVCPT(DA,811))
"RTN","PXPXRM",98,0)
 Q
"RTN","PXPXRM",99,0)
 ;
"RTN","PXPXRM",100,0)
 ;===============================================================
"RTN","PXPXRM",101,0)
VHF(DA,DATA) ;Return data for a specified V Health Factor entry.
"RTN","PXPXRM",102,0)
 N TEMP
"RTN","PXPXRM",103,0)
 S TEMP=^AUPNVHF(DA,0)
"RTN","PXPXRM",104,0)
 S DATA("VISIT")=$P(TEMP,U,3)
"RTN","PXPXRM",105,0)
 S (DATA("LEVEL/SEVERITY"),DATA("VALUE"))=$P(TEMP,U,4)
"RTN","PXPXRM",106,0)
 S DATA("COMMENTS")=$G(^AUPNVHF(DA,811))
"RTN","PXPXRM",107,0)
 Q
"RTN","PXPXRM",108,0)
 ;
"RTN","PXPXRM",109,0)
 ;===============================================================
"RTN","PXPXRM",110,0)
VIMM(DA,DATA) ;Return data, for a specified V Immunization entry.
"RTN","PXPXRM",111,0)
 N TEMP
"RTN","PXPXRM",112,0)
 S TEMP=^AUPNVIMM(DA,0)
"RTN","PXPXRM",113,0)
 S DATA("VISIT")=$P(TEMP,U,3)
"RTN","PXPXRM",114,0)
 S (DATA("SERIES"),DATA("VALUE"))=$P(TEMP,U,4)
"RTN","PXPXRM",115,0)
 S DATA("REACTION")=$P(TEMP,U,6)
"RTN","PXPXRM",116,0)
 S DATA("CONTRAINDICATED")=$P(TEMP,U,7)
"RTN","PXPXRM",117,0)
 S DATA("COMMENTS")=$G(^AUPNVIMM(DA,811))
"RTN","PXPXRM",118,0)
 Q
"RTN","PXPXRM",119,0)
 ;
"RTN","PXPXRM",120,0)
 ;===============================================================
"RTN","PXPXRM",121,0)
VPEDU(DA,DATA) ;Return data, for a specified V Patient ED entry.
"RTN","PXPXRM",122,0)
 N TEMP
"RTN","PXPXRM",123,0)
 S TEMP=^AUPNVPED(DA,0)
"RTN","PXPXRM",124,0)
 S DATA("VISIT")=$P(TEMP,U,3)
"RTN","PXPXRM",125,0)
 S (DATA("LEVEL OF UNDERSTANDING"),DATA("VALUE"))=$P(TEMP,U,6)
"RTN","PXPXRM",126,0)
 S DATA("COMMENTS")=$G(^AUPNVPED(DA,811))
"RTN","PXPXRM",127,0)
 Q
"RTN","PXPXRM",128,0)
 ;
"RTN","PXPXRM",129,0)
 ;===============================================================
"RTN","PXPXRM",130,0)
VPOV(DA,DATA) ;Return data for a specified V POV entry.
"RTN","PXPXRM",131,0)
 N TEMP
"RTN","PXPXRM",132,0)
 S TEMP=^AUPNVPOV(DA,0)
"RTN","PXPXRM",133,0)
 S DATA("VISIT")=$P(TEMP,U,3)
"RTN","PXPXRM",134,0)
 S DATA("PROVIDER NARRATIVE")=$P(TEMP,U,4)
"RTN","PXPXRM",135,0)
 S DATA("MODIFIER")=$P(TEMP,U,6)
"RTN","PXPXRM",136,0)
 S DATA("PRIMARY/SECONDARY")=$P(TEMP,U,12)
"RTN","PXPXRM",137,0)
 S DATA("DATE OF INJURY")=$P(TEMP,U,13)
"RTN","PXPXRM",138,0)
 S DATA("CLINICAL TERM")=$P(TEMP,U,15)
"RTN","PXPXRM",139,0)
 S DATA("PROBLEM LIST ENTRY")=$P(TEMP,U,16)
"RTN","PXPXRM",140,0)
 S DATA("COMMENTS")=$G(^AUPNVPOV(DA,811))
"RTN","PXPXRM",141,0)
 Q
"RTN","PXPXRM",142,0)
 ;
"RTN","PXPXRM",143,0)
 ;===============================================================
"RTN","PXPXRM",144,0)
VSKIN(DA,DATA) ;Return data for a specified V Skin Test entry.
"RTN","PXPXRM",145,0)
 N TEMP
"RTN","PXPXRM",146,0)
 S TEMP=^AUPNVSK(DA,0)
"RTN","PXPXRM",147,0)
 S DATA("VISIT")=$P(TEMP,U,3)
"RTN","PXPXRM",148,0)
 S (DATA("RESULTS"),DATA("VALUE"))=$P(TEMP,U,4)
"RTN","PXPXRM",149,0)
 S DATA("READING")=$P(TEMP,U,5)
"RTN","PXPXRM",150,0)
 S DATA("DATE READ")=$P(TEMP,U,6)
"RTN","PXPXRM",151,0)
 S DATA("COMMENTS")=$G(^AUPNVSK(DA,811))
"RTN","PXPXRM",152,0)
 Q
"RTN","PXPXRM",153,0)
 ;
"RTN","PXPXRM",154,0)
 ;===============================================================
"RTN","PXPXRM",155,0)
VXAM(DA,DATA) ;Return data, for a specified V Exam entry.
"RTN","PXPXRM",156,0)
 N TEMP
"RTN","PXPXRM",157,0)
 S TEMP=^AUPNVXAM(DA,0)
"RTN","PXPXRM",158,0)
 S DATA("VISIT")=$P(TEMP,U,3)
"RTN","PXPXRM",159,0)
 S (DATA("RESULT"),DATA("VALUE"))=$P(TEMP,U,4)
"RTN","PXPXRM",160,0)
 S DATA("COMMENTS")=$G(^AUPNVXAM(DA,811))
"RTN","PXPXRM",161,0)
 Q
"RTN","PXPXRM",162,0)
 ;
"RTN","PXPXRMI2")
0^38^B86987846^B80236604
"RTN","PXPXRMI2",1,0)
PXPXRMI2 ; SLC/PKR,SCK - Build indexes for the V files (continued). ;06/17/2003
"RTN","PXPXRMI2",2,0)
 ;;1.0;PCE PATIENT CARE ENCOUNTER;**119,194,199**;Aug 12, 1996;Build 51
"RTN","PXPXRMI2",3,0)
 ;DBIA 4113 supports PXRMSXRM entry points.
"RTN","PXPXRMI2",4,0)
 ;DBIA 4114 supports setting and killing ^PXRMINDX
"RTN","PXPXRMI2",5,0)
 ; Reference to CODEC^ICDEX supported by ICR #5747
"RTN","PXPXRMI2",6,0)
 ; Reference to CSI^ICDEX supported by ICR #5747
"RTN","PXPXRMI2",7,0)
 ; Reference to SINFO^ICDEX supported by ICR #5747
"RTN","PXPXRMI2",8,0)
 ;===============================================================
"RTN","PXPXRMI2",9,0)
VPED ;Build the indexes for V PATIENT ED.
"RTN","PXPXRMI2",10,0)
 N DAS,DATE,DFN,DIFF,DONE,EDU,END,ENTRIES,ETEXT,GLOBAL,IND,NE,NERROR
"RTN","PXPXRMI2",11,0)
 N START,TEMP,TENP,TEXT,VISIT
"RTN","PXPXRMI2",12,0)
 ;Don't leave any old stuff around.
"RTN","PXPXRMI2",13,0)
 K ^PXRMINDX(9000010.16)
"RTN","PXPXRMI2",14,0)
 S GLOBAL=$$GET1^DID(9000010.16,"","","GLOBAL NAME")
"RTN","PXPXRMI2",15,0)
 S ENTRIES=$P(^AUPNVPED(0),U,4)
"RTN","PXPXRMI2",16,0)
 S TENP=ENTRIES/10
"RTN","PXPXRMI2",17,0)
 S TENP=+$P(TENP,".",1)
"RTN","PXPXRMI2",18,0)
 I TENP<1 S TENP=1
"RTN","PXPXRMI2",19,0)
 D BMES^XPDUTL("Building indexes for V PATIENT ED")
"RTN","PXPXRMI2",20,0)
 S TEXT="There are "_ENTRIES_" entries to process."
"RTN","PXPXRMI2",21,0)
 D MES^XPDUTL(TEXT)
"RTN","PXPXRMI2",22,0)
 S START=$H
"RTN","PXPXRMI2",23,0)
 S (DAS,DONE,IND,NE,NERROR)=0
"RTN","PXPXRMI2",24,0)
 F  S DAS=$O(^AUPNVPED(DAS)) Q:DONE  D
"RTN","PXPXRMI2",25,0)
 . I +DAS=0 S DONE=1 Q
"RTN","PXPXRMI2",26,0)
 . I +DAS'=DAS D  Q
"RTN","PXPXRMI2",27,0)
 .. S DONE=1
"RTN","PXPXRMI2",28,0)
 .. S ETEXT="Bad ien: "_DAS_", cannot continue."
"RTN","PXPXRMI2",29,0)
 .. D ADDERROR^PXRMSXRM(GLOBAL,ETEXT,.NERROR)
"RTN","PXPXRMI2",30,0)
 . S IND=IND+1
"RTN","PXPXRMI2",31,0)
 . I IND#TENP=0 D
"RTN","PXPXRMI2",32,0)
 .. S TEXT="Processing entry "_IND
"RTN","PXPXRMI2",33,0)
 .. D MES^XPDUTL(TEXT)
"RTN","PXPXRMI2",34,0)
 . I IND#10000=0 W "."
"RTN","PXPXRMI2",35,0)
 . S TEMP=^AUPNVPED(DAS,0)
"RTN","PXPXRMI2",36,0)
 . S EDU=$P(TEMP,U,1)
"RTN","PXPXRMI2",37,0)
 . I EDU="" D  Q
"RTN","PXPXRMI2",38,0)
 .. S ETEXT=DAS_" missing education topic"
"RTN","PXPXRMI2",39,0)
 .. D ADDERROR^PXRMSXRM(GLOBAL,ETEXT,.NERROR)
"RTN","PXPXRMI2",40,0)
 . I '$D(^AUTTEDT(EDU)) D  Q
"RTN","PXPXRMI2",41,0)
 .. S ETEXT=DAS_" invalid education topic"
"RTN","PXPXRMI2",42,0)
 .. D ADDERROR^PXRMSXRM(GLOBAL,ETEXT,.NERROR)
"RTN","PXPXRMI2",43,0)
 . S DFN=$P(TEMP,U,2)
"RTN","PXPXRMI2",44,0)
 . I DFN="" D  Q
"RTN","PXPXRMI2",45,0)
 .. S ETEXT=DAS_" missing DFN"
"RTN","PXPXRMI2",46,0)
 .. D ADDERROR^PXRMSXRM(GLOBAL,ETEXT,.NERROR)
"RTN","PXPXRMI2",47,0)
 . S VISIT=$P(TEMP,U,3)
"RTN","PXPXRMI2",48,0)
 . I VISIT="" D  Q
"RTN","PXPXRMI2",49,0)
 .. S ETEXT=DAS_" missing visit"
"RTN","PXPXRMI2",50,0)
 .. D ADDERROR^PXRMSXRM(GLOBAL,ETEXT,.NERROR)
"RTN","PXPXRMI2",51,0)
 . I '$D(^AUPNVSIT(VISIT)) D  Q
"RTN","PXPXRMI2",52,0)
 .. S ETEXT=DAS_" invalid visit"
"RTN","PXPXRMI2",53,0)
 .. D ADDERROR^PXRMSXRM(GLOBAL,ETEXT,.NERROR)
"RTN","PXPXRMI2",54,0)
 . S DATE=$P(^AUPNVSIT(VISIT,0),U,1)
"RTN","PXPXRMI2",55,0)
 . I DATE="" D  Q
"RTN","PXPXRMI2",56,0)
 .. S ETEXT=DAS_" missing visit date"
"RTN","PXPXRMI2",57,0)
 .. D ADDERROR^PXRMSXRM(GLOBAL,ETEXT,.NERROR)
"RTN","PXPXRMI2",58,0)
 . S NE=NE+1
"RTN","PXPXRMI2",59,0)
 . S ^PXRMINDX(9000010.16,"IP",EDU,DFN,DATE,DAS)=""
"RTN","PXPXRMI2",60,0)
 . S ^PXRMINDX(9000010.16,"PI",DFN,EDU,DATE,DAS)=""
"RTN","PXPXRMI2",61,0)
 S END=$H
"RTN","PXPXRMI2",62,0)
 S TEXT=NE_" V PATIENT ED results indexed."
"RTN","PXPXRMI2",63,0)
 D MES^XPDUTL(TEXT)
"RTN","PXPXRMI2",64,0)
 D DETIME^PXRMSXRM(START,END)
"RTN","PXPXRMI2",65,0)
 ;If there were errors send a message.
"RTN","PXPXRMI2",66,0)
 I NERROR>0 D ERRMSG^PXRMSXRM(NERROR,GLOBAL)
"RTN","PXPXRMI2",67,0)
 ;Send a MailMan message with the results.
"RTN","PXPXRMI2",68,0)
 D COMMSG^PXRMSXRM(GLOBAL,START,END,NE,NERROR)
"RTN","PXPXRMI2",69,0)
 S ^PXRMINDX(9000010.16,"GLOBAL NAME")=GLOBAL
"RTN","PXPXRMI2",70,0)
 S ^PXRMINDX(9000010.16,"BUILT BY")=DUZ
"RTN","PXPXRMI2",71,0)
 S ^PXRMINDX(9000010.16,"DATE BUILT")=$$NOW^XLFDT
"RTN","PXPXRMI2",72,0)
 Q
"RTN","PXPXRMI2",73,0)
 ;
"RTN","PXPXRMI2",74,0)
 ;===============================================================
"RTN","PXPXRMI2",75,0)
VPOV ;Build the indexes for V POV.
"RTN","PXPXRMI2",76,0)
 N CODE,DAS,DATE,DFN,DIFF,DONE,END,ENTRIES,ETEXT,GLOBAL,IND,NE
"RTN","PXPXRMI2",77,0)
 N NERROR,POV,PS,PXCSYS,PXDXDATE,START,TEMP,TENP,TEXT,VISIT
"RTN","PXPXRMI2",78,0)
 ;Don't leave any old stuff around.
"RTN","PXPXRMI2",79,0)
 K ^PXRMINDX(9000010.07)
"RTN","PXPXRMI2",80,0)
 S GLOBAL=$$GET1^DID(9000010.07,"","","GLOBAL NAME")
"RTN","PXPXRMI2",81,0)
 S ENTRIES=$P(^AUPNVPOV(0),U,4)
"RTN","PXPXRMI2",82,0)
 S TENP=ENTRIES/10
"RTN","PXPXRMI2",83,0)
 S TENP=+$P(TENP,".",1)
"RTN","PXPXRMI2",84,0)
 I TENP<1 S TENP=1
"RTN","PXPXRMI2",85,0)
 D BMES^XPDUTL("Building indexes for V POV")
"RTN","PXPXRMI2",86,0)
 S TEXT="There are "_ENTRIES_" entries to process."
"RTN","PXPXRMI2",87,0)
 D MES^XPDUTL(TEXT)
"RTN","PXPXRMI2",88,0)
 S START=$H
"RTN","PXPXRMI2",89,0)
 S (DAS,DONE,IND,NE,NERROR)=0
"RTN","PXPXRMI2",90,0)
 F  S DAS=$O(^AUPNVPOV(DAS)) Q:DONE  D
"RTN","PXPXRMI2",91,0)
 . I +DAS=0 S DONE=1 Q
"RTN","PXPXRMI2",92,0)
 . I +DAS'=DAS D  Q
"RTN","PXPXRMI2",93,0)
 .. S DONE=1
"RTN","PXPXRMI2",94,0)
 .. S ETEXT="Bad ien: "_DAS_", cannot continue."
"RTN","PXPXRMI2",95,0)
 .. D ADDERROR^PXRMSXRM(GLOBAL,ETEXT,.NERROR)
"RTN","PXPXRMI2",96,0)
 . S IND=IND+1
"RTN","PXPXRMI2",97,0)
 . I IND#TENP=0 D
"RTN","PXPXRMI2",98,0)
 .. S TEXT="Processing entry "_IND
"RTN","PXPXRMI2",99,0)
 .. D MES^XPDUTL(TEXT)
"RTN","PXPXRMI2",100,0)
 . I IND#10000=0 W "."
"RTN","PXPXRMI2",101,0)
 . S TEMP=^AUPNVPOV(DAS,0)
"RTN","PXPXRMI2",102,0)
 . S POV=$P(TEMP,U,1)
"RTN","PXPXRMI2",103,0)
 . I POV="" D  Q
"RTN","PXPXRMI2",104,0)
 .. S ETEXT=DAS_" missing POV (ICD)"
"RTN","PXPXRMI2",105,0)
 .. D ADDERROR^PXRMSXRM(GLOBAL,ETEXT,.NERROR)
"RTN","PXPXRMI2",106,0)
 . S DFN=$P(TEMP,U,2)
"RTN","PXPXRMI2",107,0)
 . I DFN="" D  Q
"RTN","PXPXRMI2",108,0)
 .. S ETEXT=DAS_" missing DFN"
"RTN","PXPXRMI2",109,0)
 .. D ADDERROR^PXRMSXRM(GLOBAL,ETEXT,.NERROR)
"RTN","PXPXRMI2",110,0)
 . S VISIT=$P(TEMP,U,3)
"RTN","PXPXRMI2",111,0)
 . I VISIT="" D  Q
"RTN","PXPXRMI2",112,0)
 .. S ETEXT=DAS_" missing visit"
"RTN","PXPXRMI2",113,0)
 .. D ADDERROR^PXRMSXRM(GLOBAL,ETEXT,.NERROR)
"RTN","PXPXRMI2",114,0)
 . I '$D(^AUPNVSIT(VISIT)) D  Q
"RTN","PXPXRMI2",115,0)
 .. S ETEXT=DAS_" invalid visit"
"RTN","PXPXRMI2",116,0)
 .. D ADDERROR^PXRMSXRM(GLOBAL,ETEXT,.NERROR)
"RTN","PXPXRMI2",117,0)
 . S PS=$P(TEMP,U,12)
"RTN","PXPXRMI2",118,0)
 . I PS="" S PS="U"
"RTN","PXPXRMI2",119,0)
 . S DATE=$P(^AUPNVSIT(VISIT,0),U,1)
"RTN","PXPXRMI2",120,0)
 . S PXDXDATE=$$CSDATE^PXDXUTL(VISIT)
"RTN","PXPXRMI2",121,0)
 . I DATE="" D  Q
"RTN","PXPXRMI2",122,0)
 .. S ETEXT=DAS_" missing visit date"
"RTN","PXPXRMI2",123,0)
 .. D ADDERROR^PXRMSXRM(GLOBAL,ETEXT,.NERROR)
"RTN","PXPXRMI2",124,0)
 . I $P($$ICDDATA^ICDXCODE("DIAG",POV,PXDXDATE,"I"),U,1)<0 D  Q
"RTN","PXPXRMI2",125,0)
 .. S ETEXT=DAS_" invalid ICD"
"RTN","PXPXRMI2",126,0)
 .. D ADDERROR^PXRMSXRM(GLOBAL,ETEXT,.NERROR)
"RTN","PXPXRMI2",127,0)
 . S NE=NE+1
"RTN","PXPXRMI2",128,0)
 . S PXCSYS=$P($$SINFO^ICDEX($$CSI^ICDEX(80,POV)),U,3)
"RTN","PXPXRMI2",129,0)
 . I PXCSYS="ICD" D  ; ICD-9 version
"RTN","PXPXRMI2",130,0)
 .. S ^PXRMINDX(9000010.07,"IPP",POV,PS,DFN,DATE,DAS)=""
"RTN","PXPXRMI2",131,0)
 .. S ^PXRMINDX(9000010.07,"PPI",DFN,PS,POV,DATE,DAS)=""
"RTN","PXPXRMI2",132,0)
 . E  D  ; ICD-10 and higher version
"RTN","PXPXRMI2",133,0)
 .. S CODE=$$CODEC^ICDEX(80,POV)
"RTN","PXPXRMI2",134,0)
 .. S ^PXRMINDX(9000010.07,PXCSYS,"IPP",CODE,PS,DFN,DATE,DAS)=""
"RTN","PXPXRMI2",135,0)
 .. S ^PXRMINDX(9000010.07,PXCSYS,"PPI",DFN,PS,CODE,DATE,DAS)=""
"RTN","PXPXRMI2",136,0)
 S END=$H
"RTN","PXPXRMI2",137,0)
 S TEXT=NE_" V POV results indexed."
"RTN","PXPXRMI2",138,0)
 D MES^XPDUTL(TEXT)
"RTN","PXPXRMI2",139,0)
 D DETIME^PXRMSXRM(START,END)
"RTN","PXPXRMI2",140,0)
 ;If there were errors send a message.
"RTN","PXPXRMI2",141,0)
 I NERROR>0 D ERRMSG^PXRMSXRM(NERROR,GLOBAL)
"RTN","PXPXRMI2",142,0)
 ;Send a MailMan message with the results.
"RTN","PXPXRMI2",143,0)
 D COMMSG^PXRMSXRM(GLOBAL,START,END,NE,NERROR)
"RTN","PXPXRMI2",144,0)
 S ^PXRMINDX(9000010.07,"GLOBAL NAME")=GLOBAL
"RTN","PXPXRMI2",145,0)
 S ^PXRMINDX(9000010.07,"BUILT BY")=DUZ
"RTN","PXPXRMI2",146,0)
 S ^PXRMINDX(9000010.07,"DATE BUILT")=$$NOW^XLFDT
"RTN","PXPXRMI2",147,0)
 Q
"RTN","PXPXRMI2",148,0)
 ;
"RTN","PXPXRMI2",149,0)
 ;===============================================================
"RTN","PXPXRMI2",150,0)
VSK ;Build the indexes for V SKIN TEST.
"RTN","PXPXRMI2",151,0)
 N DAS,DATE,DFN,DIFF,DONE,END,ENTRIES,GLOBAL,IND,NE,NERROR
"RTN","PXPXRMI2",152,0)
 N SK,START,TEMP,TENP,TEXT,VISIT
"RTN","PXPXRMI2",153,0)
 ;Don't leave any old stuff around.
"RTN","PXPXRMI2",154,0)
 K ^PXRMINDX(9000010.12)
"RTN","PXPXRMI2",155,0)
 S GLOBAL=$$GET1^DID(9000010.12,"","","GLOBAL NAME")
"RTN","PXPXRMI2",156,0)
 S ENTRIES=$P(^AUPNVSK(0),U,4)
"RTN","PXPXRMI2",157,0)
 S TENP=ENTRIES/10
"RTN","PXPXRMI2",158,0)
 S TENP=+$P(TENP,".",1)
"RTN","PXPXRMI2",159,0)
 I TENP<1 S TENP=1
"RTN","PXPXRMI2",160,0)
 D BMES^XPDUTL("Building indexes for V SKIN TEST")
"RTN","PXPXRMI2",161,0)
 S TEXT="There are "_ENTRIES_" entries to process."
"RTN","PXPXRMI2",162,0)
 D MES^XPDUTL(TEXT)
"RTN","PXPXRMI2",163,0)
 S START=$H
"RTN","PXPXRMI2",164,0)
 S (DAS,DONE,IND,NE,NERROR)=0
"RTN","PXPXRMI2",165,0)
 F  S DAS=$O(^AUPNVSK(DAS)) Q:DONE  D
"RTN","PXPXRMI2",166,0)
 . I +DAS=0 S DONE=1 Q
"RTN","PXPXRMI2",167,0)
 . I +DAS'=DAS D  Q
"RTN","PXPXRMI2",168,0)
 .. S DONE=1
"RTN","PXPXRMI2",169,0)
 .. S ETEXT="Bad ien: "_DAS_", cannot continue."
"RTN","PXPXRMI2",170,0)
 .. D ADDERROR^PXRMSXRM(GLOBAL,ETEXT,.NERROR)
"RTN","PXPXRMI2",171,0)
 . S IND=IND+1
"RTN","PXPXRMI2",172,0)
 . I IND#TENP=0 D
"RTN","PXPXRMI2",173,0)
 .. S TEXT="Processing entry "_IND
"RTN","PXPXRMI2",174,0)
 .. D MES^XPDUTL(TEXT)
"RTN","PXPXRMI2",175,0)
 . I IND#10000=0 W "."
"RTN","PXPXRMI2",176,0)
 . S TEMP=^AUPNVSK(DAS,0)
"RTN","PXPXRMI2",177,0)
 . S SK=$P(TEMP,U,1)
"RTN","PXPXRMI2",178,0)
 . I SK="" D  Q
"RTN","PXPXRMI2",179,0)
 .. S ETEXT=DAS_" missing skin test"
"RTN","PXPXRMI2",180,0)
 .. D ADDERROR^PXRMSXRM(GLOBAL,ETEXT,.NERROR)
"RTN","PXPXRMI2",181,0)
 . I '$D(^AUTTSK(SK)) D  Q
"RTN","PXPXRMI2",182,0)
 .. S ETEXT=DAS_" invalid skin test"
"RTN","PXPXRMI2",183,0)
 .. D ADDERROR^PXRMSXRM(GLOBAL,ETEXT,.NERROR)
"RTN","PXPXRMI2",184,0)
 . S DFN=$P(TEMP,U,2)
"RTN","PXPXRMI2",185,0)
 . I DFN="" D  Q
"RTN","PXPXRMI2",186,0)
 .. S ETEXT=DAS_" missing DFN"
"RTN","PXPXRMI2",187,0)
 .. D ADDERROR^PXRMSXRM(GLOBAL,ETEXT,.NERROR)
"RTN","PXPXRMI2",188,0)
 . S VISIT=$P(TEMP,U,3)
"RTN","PXPXRMI2",189,0)
 . I VISIT="" D  Q
"RTN","PXPXRMI2",190,0)
 .. S ETEXT=DAS_" missing visit"
"RTN","PXPXRMI2",191,0)
 .. D ADDERROR^PXRMSXRM(GLOBAL,ETEXT,.NERROR)
"RTN","PXPXRMI2",192,0)
 . I '$D(^AUPNVSIT(VISIT)) D  Q
"RTN","PXPXRMI2",193,0)
 .. S ETEXT=DAS_" invalid visit"
"RTN","PXPXRMI2",194,0)
 .. D ADDERROR^PXRMSXRM(GLOBAL,ETEXT,.NERROR)
"RTN","PXPXRMI2",195,0)
 . S DATE=$P(^AUPNVSIT(VISIT,0),U,1)
"RTN","PXPXRMI2",196,0)
 . I DATE="" D  Q
"RTN","PXPXRMI2",197,0)
 .. S ETEXT=DAS_" missing visit date"
"RTN","PXPXRMI2",198,0)
 .. D ADDERROR^PXRMSXRM(GLOBAL,ETEXT,.NERROR)
"RTN","PXPXRMI2",199,0)
 . S NE=NE+1
"RTN","PXPXRMI2",200,0)
 . S ^PXRMINDX(9000010.12,"IP",SK,DFN,DATE,DAS)=""
"RTN","PXPXRMI2",201,0)
 . S ^PXRMINDX(9000010.12,"PI",DFN,SK,DATE,DAS)=""
"RTN","PXPXRMI2",202,0)
 S END=$H
"RTN","PXPXRMI2",203,0)
 S TEXT=NE_" V SKIN TEST results indexed."
"RTN","PXPXRMI2",204,0)
 D MES^XPDUTL(TEXT)
"RTN","PXPXRMI2",205,0)
 D DETIME^PXRMSXRM(START,END)
"RTN","PXPXRMI2",206,0)
 ;If there were errors send a message.
"RTN","PXPXRMI2",207,0)
 I NERROR>0 D ERRMSG^PXRMSXRM(NERROR,GLOBAL)
"RTN","PXPXRMI2",208,0)
 ;Send a MailMan message with the results.
"RTN","PXPXRMI2",209,0)
 D COMMSG^PXRMSXRM(GLOBAL,START,END,NE,NERROR)
"RTN","PXPXRMI2",210,0)
 S ^PXRMINDX(9000010.12,"GLOBAL NAME")=GLOBAL
"RTN","PXPXRMI2",211,0)
 S ^PXRMINDX(9000010.12,"BUILT BY")=DUZ
"RTN","PXPXRMI2",212,0)
 S ^PXRMINDX(9000010.12,"DATE BUILT")=$$NOW^XLFDT
"RTN","PXPXRMI2",213,0)
 Q
"RTN","PXPXRMI2",214,0)
 ;
"RTN","PXPXRMI2",215,0)
 ;===============================================================
"RTN","PXPXRMI2",216,0)
VXAM ;Build the indexes for V EXAM.
"RTN","PXPXRMI2",217,0)
 N DAS,DATE,DFN,DIFF,DONE,END,ENTRIES,ETEXT,EXAM,GLOBAL,IND,NE,NERROR
"RTN","PXPXRMI2",218,0)
 N START,TEMP,TENP,TEXT,VISIT
"RTN","PXPXRMI2",219,0)
 ;Don't leave any old stuff around.
"RTN","PXPXRMI2",220,0)
 K ^PXRMINDX(9000010.13)
"RTN","PXPXRMI2",221,0)
 S GLOBAL=$$GET1^DID(9000010.13,"","","GLOBAL NAME")
"RTN","PXPXRMI2",222,0)
 S ENTRIES=$P(^AUPNVXAM(0),U,4)
"RTN","PXPXRMI2",223,0)
 S TENP=ENTRIES/10
"RTN","PXPXRMI2",224,0)
 S TENP=+$P(TENP,".",1)
"RTN","PXPXRMI2",225,0)
 I TENP<1 S TENP=1
"RTN","PXPXRMI2",226,0)
 D BMES^XPDUTL("Building indexes for V EXAM")
"RTN","PXPXRMI2",227,0)
 S TEXT="There are "_ENTRIES_" entries to process."
"RTN","PXPXRMI2",228,0)
 D MES^XPDUTL(TEXT)
"RTN","PXPXRMI2",229,0)
 S START=$H
"RTN","PXPXRMI2",230,0)
 S (DAS,DONE,IND,NE,NERROR)=0
"RTN","PXPXRMI2",231,0)
 F  S DAS=$O(^AUPNVXAM(DAS)) Q:DONE  D
"RTN","PXPXRMI2",232,0)
 . I +DAS=0 S DONE=1 Q
"RTN","PXPXRMI2",233,0)
 . I +DAS'=DAS D  Q
"RTN","PXPXRMI2",234,0)
 .. S DONE=1
"RTN","PXPXRMI2",235,0)
 .. S ETEXT="Bad ien: "_DAS_", cannot continue."
"RTN","PXPXRMI2",236,0)
 .. D ADDERROR^PXRMSXRM(GLOBAL,ETEXT,.NERROR)
"RTN","PXPXRMI2",237,0)
 . S IND=IND+1
"RTN","PXPXRMI2",238,0)
 . I IND#TENP=0 D
"RTN","PXPXRMI2",239,0)
 .. S TEXT="Processing entry "_IND
"RTN","PXPXRMI2",240,0)
 .. D MES^XPDUTL(TEXT)
"RTN","PXPXRMI2",241,0)
 . I IND#10000=0 W "."
"RTN","PXPXRMI2",242,0)
 . S TEMP=^AUPNVXAM(DAS,0)
"RTN","PXPXRMI2",243,0)
 . S EXAM=$P(TEMP,U,1)
"RTN","PXPXRMI2",244,0)
 . I EXAM="" D  Q
"RTN","PXPXRMI2",245,0)
 .. S ETEXT=DAS_" missing exam"
"RTN","PXPXRMI2",246,0)
 .. D ADDERROR^PXRMSXRM(GLOBAL,ETEXT,.NERROR)
"RTN","PXPXRMI2",247,0)
 . I '$D(^AUTTEXAM(EXAM)) D  Q
"RTN","PXPXRMI2",248,0)
 .. S ETEXT=DAS_" invalid exam"
"RTN","PXPXRMI2",249,0)
 .. D ADDERROR^PXRMSXRM(GLOBAL,ETEXT,.NERROR)
"RTN","PXPXRMI2",250,0)
 . S DFN=$P(TEMP,U,2)
"RTN","PXPXRMI2",251,0)
 . I DFN="" D  Q
"RTN","PXPXRMI2",252,0)
 .. S ETEXT=DAS_" missing DFN"
"RTN","PXPXRMI2",253,0)
 .. D ADDERROR^PXRMSXRM(GLOBAL,ETEXT,.NERROR)
"RTN","PXPXRMI2",254,0)
 . S VISIT=$P(TEMP,U,3)
"RTN","PXPXRMI2",255,0)
 . I VISIT="" D  Q
"RTN","PXPXRMI2",256,0)
 .. S ETEXT=DAS_" missing visit"
"RTN","PXPXRMI2",257,0)
 .. D ADDERROR^PXRMSXRM(GLOBAL,ETEXT,.NERROR)
"RTN","PXPXRMI2",258,0)
 . I '$D(^AUPNVSIT(VISIT)) D  Q
"RTN","PXPXRMI2",259,0)
 .. S ETEXT=DAS_" invalid visit"
"RTN","PXPXRMI2",260,0)
 .. D ADDERROR^PXRMSXRM(GLOBAL,ETEXT,.NERROR)
"RTN","PXPXRMI2",261,0)
 . S DATE=$P(^AUPNVSIT(VISIT,0),U,1)
"RTN","PXPXRMI2",262,0)
 . I DATE="" D  Q
"RTN","PXPXRMI2",263,0)
 .. S ETEXT=DAS_" missing visit date"
"RTN","PXPXRMI2",264,0)
 .. D ADDERROR^PXRMSXRM(GLOBAL,ETEXT,.NERROR)
"RTN","PXPXRMI2",265,0)
 . S NE=NE+1
"RTN","PXPXRMI2",266,0)
 . S ^PXRMINDX(9000010.13,"IP",EXAM,DFN,DATE,DAS)=""
"RTN","PXPXRMI2",267,0)
 . S ^PXRMINDX(9000010.13,"PI",DFN,EXAM,DATE,DAS)=""
"RTN","PXPXRMI2",268,0)
 S END=$H
"RTN","PXPXRMI2",269,0)
 S TEXT=NE_" V EXAM results indexed."
"RTN","PXPXRMI2",270,0)
 D MES^XPDUTL(TEXT)
"RTN","PXPXRMI2",271,0)
 D DETIME^PXRMSXRM(START,END)
"RTN","PXPXRMI2",272,0)
 ;If there were errors send a message.
"RTN","PXPXRMI2",273,0)
 I NERROR>0 D ERRMSG^PXRMSXRM(NERROR,GLOBAL)
"RTN","PXPXRMI2",274,0)
 ;Send a MailMan message with the results.
"RTN","PXPXRMI2",275,0)
 D COMMSG^PXRMSXRM(GLOBAL,START,END,NE,NERROR)
"RTN","PXPXRMI2",276,0)
 S ^PXRMINDX(9000010.13,"GLOBAL NAME")=GLOBAL
"RTN","PXPXRMI2",277,0)
 S ^PXRMINDX(9000010.13,"BUILT BY")=DUZ
"RTN","PXPXRMI2",278,0)
 S ^PXRMINDX(9000010.13,"DATE BUILT")=$$NOW^XLFDT
"RTN","PXPXRMI2",279,0)
 Q
"RTN","PXPXRMI2",280,0)
 ;
"RTN","PXQUTL3A")
0^3^B55077296^B55110955
"RTN","PXQUTL3A",1,0)
PXQUTL3A ;ISL/JVS CLEAN OUT BAD XREF #2 ;4/16/97  14:30
"RTN","PXQUTL3A",2,0)
 ;;1.0;PCE PATIENT CARE ENCOUNTER;**29,199**;Aug 12, 1996;Build 51
"RTN","PXQUTL3A",3,0)
 ;
"RTN","PXQUTL3A",4,0)
 ;
"RTN","PXQUTL3A",5,0)
 Q
"RTN","PXQUTL3A",6,0)
 ;
"RTN","PXQUTL3A",7,0)
V ;--------------VISIT FILE---------------------------------
"RTN","PXQUTL3A",8,0)
 W !!,"Checking the VISIT FILE #9000010 (VISITS)",!
"RTN","PXQUTL3A",9,0)
 S VSTCNT=0
"RTN","PXQUTL3A",10,0)
 I Y="^" Q
"RTN","PXQUTL3A",11,0)
 D Q
"RTN","PXQUTL3A",12,0)
 Q
"RTN","PXQUTL3A",13,0)
AA ;-----------------AA-LEVEL 3------------------------------
"RTN","PXQUTL3A",14,0)
 S VSTXCNT=0,XREF="^AUPNVSIT('AA',"
"RTN","PXQUTL3A",15,0)
 W !!,"Checking the ^AUPNVSIT(""AA"") X-REF",!
"RTN","PXQUTL3A",16,0)
 S I="" F  S I=$O(^AUPNVSIT("AA",I)) Q:I=""  D  G:Y="^" EXIT
"RTN","PXQUTL3A",17,0)
 . S IEN="" F  S IEN=$O(^AUPNVSIT("AA",I,IEN)) Q:IEN=""  D
"RTN","PXQUTL3A",18,0)
 ..S IENN="" F  S IENN=$O(^AUPNVSIT("AA",I,IEN,IENN)) W:IENN#1000=22 "." Q:IENN=""  D
"RTN","PXQUTL3A",19,0)
 ...S ARRAY="^AUPNVSIT(""AA"",I,IEN,IENN)" S VSTCNT=VSTCNT+1,VSTXCNT=VSTXCNT+1 I VSTCNT#1000=2 D MON^PXQUTL3
"RTN","PXQUTL3A",20,0)
 ...I '$D(^AUPNVSIT(IENN)) W !,"Entry "_IENN," IS NOT THERE! BAD REFERENCE IS ^AUPNVPOV(""AA"","_I_",",IEN_","_IENN_")" D @$S(AUTO="F":"KILL",AUTO'="F":"TT",1:"")
"RTN","PXQUTL3A",21,0)
 ;
"RTN","PXQUTL3A",22,0)
 Q
"RTN","PXQUTL3A",23,0)
AD ;-----------------AD-LEVEL 2------------------------------
"RTN","PXQUTL3A",24,0)
 S VSTXCNT=0,XREF="^AUPNVSIT('AD',"
"RTN","PXQUTL3A",25,0)
 W !!,"Checking the ^AUPNVSIT(""AD"") X-REF",!
"RTN","PXQUTL3A",26,0)
 S I="" F  S I=$O(^AUPNVSIT("AD",I)) Q:I=""  D  G:Y="^" EXIT
"RTN","PXQUTL3A",27,0)
 . S IEN="" F  S IEN=$O(^AUPNVSIT("AD",I,IEN)) W:IEN#1000=22 "." Q:IEN=""  D
"RTN","PXQUTL3A",28,0)
 ..S ARRAY="^AUPNVSIT(""AD"",I,IEN)" S VSTCNT=VSTCNT+1,VSTXCNT=VSTXCNT+1 I VSTCNT#1000=2 D MON^PXQUTL3
"RTN","PXQUTL3A",29,0)
 ..I '$D(^AUPNVSIT(IEN)) W !,"Entry "_IEN," IS NOT THERE! BAD REFERENCE IS ^AUPNVSIT(""AD"","_I_",",IEN_")" D @$S(AUTO="F":"KILL",AUTO'="F":"TT",1:"")
"RTN","PXQUTL3A",30,0)
 ;
"RTN","PXQUTL3A",31,0)
 Q
"RTN","PXQUTL3A",32,0)
ADEL ;-----------------ADEL-LEVEL 2------------------------------
"RTN","PXQUTL3A",33,0)
 S VSTXCNT=0,XREF="^AUPNVSIT('ADEL',"
"RTN","PXQUTL3A",34,0)
 W !!,"Checking the ^AUPNVSIT(""ADEL"") X-REF",!
"RTN","PXQUTL3A",35,0)
 S I="" F  S I=$O(^AUPNVSIT("ADEL",I)) Q:I=""  D  G:Y="^" EXIT
"RTN","PXQUTL3A",36,0)
 . S IEN="" F  S IEN=$O(^AUPNVSIT("ADEL",I,IEN)) W:IEN#1000=22 "." Q:IEN=""  D
"RTN","PXQUTL3A",37,0)
 ..S ARRAY="^AUPNVSIT(""ADEL"",I,IEN)" S VSTCNT=VSTCNT+1,VSTXCNT=VSTXCNT+1 I VSTCNT#1000=2 D MON^PXQUTL3
"RTN","PXQUTL3A",38,0)
 ..I '$D(^AUPNVSIT(IEN)) W !,"Entry "_IEN," IS NOT THERE! BAD REFERENCE IS ^AUPNVSIT(""ADEL"","_I_",",IEN_")" D @$S(AUTO="F":"KILL",AUTO'="F":"TT",1:"")
"RTN","PXQUTL3A",39,0)
 ;
"RTN","PXQUTL3A",40,0)
 Q
"RTN","PXQUTL3A",41,0)
AET ;-----------------AET-LEVEL 5------------------------------
"RTN","PXQUTL3A",42,0)
 S VSTXCNT=0,XREF="^AUPNVSIT('AET',"
"RTN","PXQUTL3A",43,0)
 W !!,"Checking the ^AUPNVSIT(""AET"") X-REF",!
"RTN","PXQUTL3A",44,0)
 S I="" F  S I=$O(^AUPNVSIT("AET",I)) Q:I=""  D  G:Y="^" EXIT
"RTN","PXQUTL3A",45,0)
 . S IEN="" F  S IEN=$O(^AUPNVSIT("AET",I,IEN)) Q:IEN=""  D
"RTN","PXQUTL3A",46,0)
 ..S IENN="" F  S IENN=$O(^AUPNVSIT("AET",I,IEN,IENN)) Q:IENN=""  D
"RTN","PXQUTL3A",47,0)
 ...S IENNN="" F  S IENNN=$O(^AUPNVSIT("AET",I,IEN,IENN,IENNN)) Q:IENNN=""  D
"RTN","PXQUTL3A",48,0)
 ....S IENNNN="" F  S IENNNN=$O(^AUPNVSIT("AET",I,IEN,IENN,IENNN,IENNNN)) W:IENNNN#1000=22 "." Q:IENNNN=""  D
"RTN","PXQUTL3A",49,0)
 .....S ARRAY="^AUPNVSIT(""AET"",I,IEN,IENN,IENNN,IENNNN)" S VSTCNT=VSTCNT+1,VSTXCNT=VSTXCNT+1 I VSTCNT#1000=2 D MON^PXQUTL3
"RTN","PXQUTL3A",50,0)
 .....I '$D(^AUPNVSIT(IENNNN)) W !,"Entry "_IENNNN," IS NOT THERE! BAD REFERENCE IS ^AUPNVSIT(""AET"","_I_",",IEN_","_IENN_","_IENNN_","_IENNNN_")" D @$S(AUTO="F":"KILL",AUTO'="F":"TT",1:"")
"RTN","PXQUTL3A",51,0)
 ;
"RTN","PXQUTL3A",52,0)
 Q
"RTN","PXQUTL3A",53,0)
AHL ;-----------------AHL-LEVEL 3------------------------------
"RTN","PXQUTL3A",54,0)
 S VSTXCNT=0,XREF="^AUPNVSIT('AHL',"
"RTN","PXQUTL3A",55,0)
 W !!,"Checking the ^AUPNVSIT(""AHL"") X-REF",!
"RTN","PXQUTL3A",56,0)
 S I="" F  S I=$O(^AUPNVSIT("AHL",I)) Q:I=""  D  G:Y="^" EXIT
"RTN","PXQUTL3A",57,0)
 . S IEN="" F  S IEN=$O(^AUPNVSIT("AHL",I,IEN)) Q:IEN=""  D
"RTN","PXQUTL3A",58,0)
 ..S IENN="" F  S IENN=$O(^AUPNVSIT("AHL",I,IEN,IENN)) W:IENN#1000=22 "." Q:IENN=""  D
"RTN","PXQUTL3A",59,0)
 ...S ARRAY="^AUPNVSIT(""AHL"",I,IEN,IENN)" S VSTCNT=VSTCNT+1,VSTXCNT=VSTXCNT+1 I VSTCNT#1000=2 D MON^PXQUTL3
"RTN","PXQUTL3A",60,0)
 ...I '$D(^AUPNVSIT(IENN)) W !,"Entry "_IENN," IS NOT THERE! BAD REFERENCE IS ^AUPNVPOV(""AHL"","_I_",",IEN_","_IENN_")" D @$S(AUTO="F":"KILL",AUTO'="F":"TT",1:"")
"RTN","PXQUTL3A",61,0)
 ;
"RTN","PXQUTL3A",62,0)
 Q
"RTN","PXQUTL3A",63,0)
B ;-----------------B-LEVEL 2------------------------------
"RTN","PXQUTL3A",64,0)
 S VSTXCNT=0,XREF="^AUPNVSIT('B',"
"RTN","PXQUTL3A",65,0)
 W !!,"Checking the ^AUPNVSIT(""B"") X-REF",!
"RTN","PXQUTL3A",66,0)
 S I="" F  S I=$O(^AUPNVSIT("B",I)) Q:I=""  D  G:Y="^" EXIT
"RTN","PXQUTL3A",67,0)
 . S IEN="" F  S IEN=$O(^AUPNVSIT("B",I,IEN)) W:IEN#1000=22 "." Q:IEN=""  D
"RTN","PXQUTL3A",68,0)
 ..S ARRAY="^AUPNVSIT(""B"",I,IEN)" S VSTCNT=VSTCNT+1,VSTXCNT=VSTXCNT+1 I VSTCNT#1000=2 D MON^PXQUTL3
"RTN","PXQUTL3A",69,0)
 ..I '$D(^AUPNVSIT(IEN)) W !,"Entry "_IEN," IS NOT THERE! BAD REFERENCE IS ^AUPNVSIT(""B"","_I_",",IEN_")" D @$S(AUTO="F":"KILL",AUTO'="F":"TT",1:"")
"RTN","PXQUTL3A",70,0)
 ;
"RTN","PXQUTL3A",71,0)
 Q
"RTN","PXQUTL3A",72,0)
C ;-----------------C-LEVEL 2------------------------------
"RTN","PXQUTL3A",73,0)
 S VSTXCNT=0,XREF="^AUPNVSIT('C',"
"RTN","PXQUTL3A",74,0)
 W !!,"Checking the ^AUPNVSIT(""C"") X-REF",!
"RTN","PXQUTL3A",75,0)
 S I="" F  S I=$O(^AUPNVSIT("C",I)) Q:I=""  D  G:Y="^" EXIT
"RTN","PXQUTL3A",76,0)
 . S IEN="" F  S IEN=$O(^AUPNVSIT("C",I,IEN)) W:IEN#1000=22 "." Q:IEN=""  D
"RTN","PXQUTL3A",77,0)
 ..S ARRAY="^AUPNVSIT(""C"",I,IEN)" S VSTCNT=VSTCNT+1,VSTXCNT=VSTXCNT+1 I VSTCNT#1000=2 D MON^PXQUTL3
"RTN","PXQUTL3A",78,0)
 ..I '$D(^AUPNVSIT(IEN)) W !,"Entry "_IEN," IS NOT THERE! BAD REFERENCE IS ^AUPNVSIT(""C"","_I_",",IEN_")" D @$S(AUTO="F":"KILL",AUTO'="F":"TT",1:"")
"RTN","PXQUTL3A",79,0)
 ;
"RTN","PXQUTL3A",80,0)
 Q
"RTN","PXQUTL3A",81,0)
VID ;-----------------VID-LEVEL 2------------------------------
"RTN","PXQUTL3A",82,0)
 S VSTXCNT=0,XREF="^AUPNVSIT('VID',"
"RTN","PXQUTL3A",83,0)
 W !!,"Checking the ^AUPNVSIT(""VID"") X-REF",!
"RTN","PXQUTL3A",84,0)
 S I="" F  S I=$O(^AUPNVSIT("VID",I)) Q:I=""  D  G:Y="^" EXIT
"RTN","PXQUTL3A",85,0)
 . S IEN="" F  S IEN=$O(^AUPNVSIT("VID",I,IEN)) W:IEN#1000=22 "." Q:IEN=""  D
"RTN","PXQUTL3A",86,0)
 ..S ARRAY="^AUPNVSIT(""VID"",I,IEN)" S VSTCNT=VSTCNT+1,VSTXCNT=VSTXCNT+1 I VSTCNT#1000=2 D MON^PXQUTL3
"RTN","PXQUTL3A",87,0)
 ..I '$D(^AUPNVSIT(IEN)) W !,"Entry "_IEN," IS NOT THERE! BAD REFERENCE IS ^AUPNVSIT(""VID"","_I_",",IEN_")" D @$S(AUTO="F":"KILL",AUTO'="F":"TT",1:"")
"RTN","PXQUTL3A",88,0)
 ;
"RTN","PXQUTL3A",89,0)
 Q
"RTN","PXQUTL3A",90,0)
AAH ;-----------------AAH-LEVEL 3------------------------------
"RTN","PXQUTL3A",91,0)
 S VSTXCNT=0,XREF="^AUPNVSIT('AAH',"
"RTN","PXQUTL3A",92,0)
 W !!,"Checking the ^AUPNVSIT(""AAH"") X-REF",!
"RTN","PXQUTL3A",93,0)
 S I="" F  S I=$O(^AUPNVSIT("AAH",I)) Q:I=""  D  G:Y="^" EXIT
"RTN","PXQUTL3A",94,0)
 . S IEN="" F  S IEN=$O(^AUPNVSIT("AAH",I,IEN)) Q:IEN=""  D
"RTN","PXQUTL3A",95,0)
 ..S IENN="" F  S IENN=$O(^AUPNVSIT("AAH",I,IEN,IENN)) W:IENN#1000=22 "." Q:IENN=""  D
"RTN","PXQUTL3A",96,0)
 ...S ARRAY="^AUPNVSIT(""AAH"",I,IEN,IENN)" S VSTCNT=VSTCNT+1,VSTXCNT=VSTXCNT+1 I VSTCNT#1000=2 D MON^PXQUTL3
"RTN","PXQUTL3A",97,0)
 ...I '$D(^AUPNVSIT(IENN)) W !,"Entry "_IENN," IS NOT THERE! BAD REFERENCE IS ^AUPNVPOV(""AAH"","_I_",",IEN_","_IENN_")" D @$S(AUTO="F":"KILL",AUTO'="F":"TT",1:"")
"RTN","PXQUTL3A",98,0)
 Q
"RTN","PXQUTL3A",99,0)
 ;
"RTN","PXQUTL3A",100,0)
 ;-------------------------------------------------------
"RTN","PXQUTL3A",101,0)
S ;++--SCREEN FOR POSSIBLE BROKEN X REFERENCES
"RTN","PXQUTL3A",102,0)
 ;--V PROVIDER FILE
"RTN","PXQUTL3A",103,0)
 S (VSTCNT,CPTCNT,PRVCNT,POVCNT)=0
"RTN","PXQUTL3A",104,0)
 W !!,"Screening the V PROVIDER file",!
"RTN","PXQUTL3A",105,0)
 S I="" F  S I=$O(^AUPNVPRV("B",I)) Q:I=""  D  G:Y="^" EXIT
"RTN","PXQUTL3A",106,0)
 . S IEN="" F  S IEN=$O(^AUPNVPRV("B",I,IEN)) W:IEN#10000=22 "." Q:IEN=""  D
"RTN","PXQUTL3A",107,0)
 ..S ARRAY="^AUPNVPRV(""B"",I,IEN)" S PRVCNT=PRVCNT+1 I PRVCNT#1000=2 D MON^PXQUTL3
"RTN","PXQUTL3A",108,0)
 ..I '$D(^AUPNVPRV(IEN)) W !,"Entry "_IEN," IS NOT THERE! BAD REFERENCE IS ^AUPNVPRV(""B"","_I_",",IEN_")"
"RTN","PXQUTL3A",109,0)
 ;
"RTN","PXQUTL3A",110,0)
 ;--V POV FILE (DIAGNOSIS)
"RTN","PXQUTL3A",111,0)
 W !!,"Screening the V POV file (DIAGNOSIS)",!
"RTN","PXQUTL3A",112,0)
 S I="" F  S I=$O(^AUPNVPOV("B",I)) Q:I=""  D  G:Y="^" EXIT
"RTN","PXQUTL3A",113,0)
 . S IEN="" F  S IEN=$O(^AUPNVPOV("B",I,IEN)) W:IEN#10000=22 "." Q:IEN=""  D
"RTN","PXQUTL3A",114,0)
 ..S ARRAY="^AUPNVPOV(""B"",I,IEN)" S POVCNT=POVCNT+1 I POVCNT#1000=2 D MON^PXQUTL3
"RTN","PXQUTL3A",115,0)
 ..I '$D(^AUPNVPOV(IEN)) W !,"Entry "_IEN," IS NOT THERE! BAD REFERENCE IS ^AUPNVPOV(""B"","_I_",",IEN_")"
"RTN","PXQUTL3A",116,0)
 ;--V CPT FILE (PROCEDURES)
"RTN","PXQUTL3A",117,0)
 W !!,"Screening the V CPT file (PROCEDURES)",!
"RTN","PXQUTL3A",118,0)
 S I="" F  S I=$O(^AUPNVCPT("B",I)) Q:I=""  D  G:Y="^" EXIT
"RTN","PXQUTL3A",119,0)
 . S IEN="" F  S IEN=$O(^AUPNVCPT("B",I,IEN)) W:IEN#10000=22 "." Q:IEN=""  D
"RTN","PXQUTL3A",120,0)
 ..S ARRAY="^AUPNVCPT(""B"",I,IEN)" S CPTCNT=CPTCNT+1 I CPTCNT#1000=2 D MON^PXQUTL3
"RTN","PXQUTL3A",121,0)
 ..I '$D(^AUPNVCPT(IEN)) W !,"Entry "_IEN," IS NOT THERE! BAD REFERENCE IS ^AUPNVCPT(""B"","_I_",",IEN_")"
"RTN","PXQUTL3A",122,0)
 ;--VISIT FILE
"RTN","PXQUTL3A",123,0)
 W !!,"Screening the VISIT file",!
"RTN","PXQUTL3A",124,0)
 S I="" F  S I=$O(^AUPNVSIT("B",I)) Q:I=""  D  G:Y="^" EXIT
"RTN","PXQUTL3A",125,0)
 . S IEN="" F  S IEN=$O(^AUPNVSIT("B",I,IEN)) W:IEN#10000=22 "." Q:IEN=""  D
"RTN","PXQUTL3A",126,0)
 ..S ARRAY="^AUPNVSIT(""B"",I,IEN)" S VSTCNT=VSTCNT+1 I VSTCNT#1000=2 D MON^PXQUTL3
"RTN","PXQUTL3A",127,0)
 ..I '$D(^AUPNVSIT(IEN)) W !,"Entry "_IEN," IS NOT THERE! BAD REFERENCE IS ^AUPNVSIT(""B"","_I_",",IEN_")"
"RTN","PXQUTL3A",128,0)
 Q
"RTN","PXQUTL3A",129,0)
 ;
"RTN","PXQUTL3A",130,0)
TT ;--QUERY FOR CORRECT ENTRY
"RTN","PXQUTL3A",131,0)
 S DIR("A")="Should I fix this one by removing the reference ??"
"RTN","PXQUTL3A",132,0)
 S DIR("B")="NO"
"RTN","PXQUTL3A",133,0)
 S DIR(0)="YAO" D ^DIR
"RTN","PXQUTL3A",134,0)
 I Y=1 D
"RTN","PXQUTL3A",135,0)
 .K @ARRAY
"RTN","PXQUTL3A",136,0)
 I Y="^" Q
"RTN","PXQUTL3A",137,0)
 K DIR
"RTN","PXQUTL3A",138,0)
 Q
"RTN","PXQUTL3A",139,0)
KILL ;--AUTOMATIC
"RTN","PXQUTL3A",140,0)
 ;W !,"KILL "_ARRAY
"RTN","PXQUTL3A",141,0)
 K @ARRAY
"RTN","PXQUTL3A",142,0)
 Q
"RTN","PXQUTL3A",143,0)
EXIT K DIR,DA,DIK
"RTN","PXQUTL3A",144,0)
 Q
"RTN","PXQUTL3A",145,0)
Q ;---PROMPT FOR WHICH X-REF
"RTN","PXQUTL3A",146,0)
 I AUTO="F",AUTOO="F" D AA,AAH,AD,ADEL,AET,AHL,B,C,VID Q
"RTN","PXQUTL3A",147,0)
 S DIR(0)="SOM^AA:AA X-REF;AAH:AAH X-REF;AD:AD X-REF;ADEL:ADEL X-REF;AET:AET X-REF;AHL:AHL X-REF;B:B X-REF;C:C X-REF;VID:VID X-REF;ALL:ALL X-REFERENCES"
"RTN","PXQUTL3A",148,0)
 S DIR("A")="Select a VISIT Cross-reference: "
"RTN","PXQUTL3A",149,0)
 S DIR("B")="B"
"RTN","PXQUTL3A",150,0)
 D ^DIR
"RTN","PXQUTL3A",151,0)
 I Y="AA" D AA G Q
"RTN","PXQUTL3A",152,0)
 I Y="AAH" D AAH G Q
"RTN","PXQUTL3A",153,0)
 I Y="AD" D AD G Q
"RTN","PXQUTL3A",154,0)
 I Y="ADEL" D ADEL G Q
"RTN","PXQUTL3A",155,0)
 I Y="AET" D AET G Q
"RTN","PXQUTL3A",156,0)
 I Y="AHL" D AHL G Q
"RTN","PXQUTL3A",157,0)
 I Y="B" D B G Q
"RTN","PXQUTL3A",158,0)
 I Y="C" D C G Q
"RTN","PXQUTL3A",159,0)
 I Y="VID" D VID G Q
"RTN","PXQUTL3A",160,0)
 I Y="ALL" D 
"RTN","PXQUTL3A",161,0)
 .D AA I Y="^" Q
"RTN","PXQUTL3A",162,0)
 .D AAH I Y="^" Q
"RTN","PXQUTL3A",163,0)
 .D AD I Y="^" Q
"RTN","PXQUTL3A",164,0)
 .D ADEL I Y="^" Q
"RTN","PXQUTL3A",165,0)
 .D AET I Y="^" Q
"RTN","PXQUTL3A",166,0)
 .D AHL I Y="^" Q
"RTN","PXQUTL3A",167,0)
 .D B I Y="^" Q
"RTN","PXQUTL3A",168,0)
 .D C I Y="^" Q
"RTN","PXQUTL3A",169,0)
 .D VID Q
"RTN","PXQUTL3A",170,0)
 K DIR
"RTN","PXQUTL3A",171,0)
 Q
"RTN","PXRHS01")
0^39^B10447211^B10447211
"RTN","PXRHS01",1,0)
PXRHS01 ;SLC/SBW - PCE Visit data extract main routine ;6/7/96
"RTN","PXRHS01",2,0)
 ;;1.0;PCE PATIENT CARE ENCOUNTER;**73,199**;Aug 12, 1996;Build 51
"RTN","PXRHS01",3,0)
 ; Extract returns visit data with associated ICD code, CPT, and
"RTN","PXRHS01",4,0)
 ; Provider data.
"RTN","PXRHS01",5,0)
VISIT(DFN,ENDDT,BEGDT,OCCLIM,CATCODE,EXTRCODE,TIMEORD) ; Control branching
"RTN","PXRHS01",6,0)
 ;INPUT  : DFN      - Pointer to PATIENT file (#2)
"RTN","PXRHS01",7,0)
 ;         ENDDT    - Ending date/time in internal FileMan format
"RTN","PXRHS01",8,0)
 ;                  - Defaults to today's date at 11:59 pm
"RTN","PXRHS01",9,0)
 ;         BEGDT    - Beginning date/time in internal FileMan format
"RTN","PXRHS01",10,0)
 ;                  - Defaults to one year prior to today's date
"RTN","PXRHS01",11,0)
 ;         OCCLIM   - Maximum number of visits returned
"RTN","PXRHS01",12,0)
 ;         CATCODE  - Pattern Match which controls visit data that is
"RTN","PXRHS01",13,0)
 ;                    returned (Can include multiple codes)
"RTN","PXRHS01",14,0)
 ;               A = AMBULATORY
"RTN","PXRHS01",15,0)
 ;               H = HOSPITALIZATION
"RTN","PXRHS01",16,0)
 ;               I = IN HOSPITAL
"RTN","PXRHS01",17,0)
 ;               C = CHART REVIEW
"RTN","PXRHS01",18,0)
 ;               T = TELECOMMUNICATIONS
"RTN","PXRHS01",19,0)
 ;               N = NOT FOUND
"RTN","PXRHS01",20,0)
 ;               S = DAY SURGERY
"RTN","PXRHS01",21,0)
 ;               O = OBSERVATION
"RTN","PXRHS01",22,0)
 ;               E = EVENT (HISTORICAL)
"RTN","PXRHS01",23,0)
 ;               R = NURSING HOME
"RTN","PXRHS01",24,0)
 ;               D = DAILY HOSPITALIZATION DATA
"RTN","PXRHS01",25,0)
 ;               X = ANCILLARY PACKAGE DAILY DATA
"RTN","PXRHS01",26,0)
 ;         EXTRCODE - Pattern Match indicating which optional
"RTN","PXRHS01",27,0)
 ;                    data is returned (Can be multiple)
"RTN","PXRHS01",28,0)
 ;               P = return PROVIDER data
"RTN","PXRHS01",29,0)
 ;               C = return CPT (procedure) data
"RTN","PXRHS01",30,0)
 ;               D = return ICD-9 (diagnosis) data
"RTN","PXRHS01",31,0)
 ;         TIMEORD  - Order visits on same day are indexed
"RTN","PXRHS01",32,0)
 ;                    Default is inverse chronological order
"RTN","PXRHS01",33,0)
 ;               1 = Time order in regular chronological order
"RTN","PXRHS01",34,0)
 ;
"RTN","PXRHS01",35,0)
 ;OUTPUT : 
"RTN","PXRHS01",36,0)
 ;  Data from VISIT (9000010) file except for hosp. loc. abbr.
"RTN","PXRHS01",37,0)
 ;  ^TMP("PXHSV",$J,InvExDt,COUNT,0) = VISIT/ADMIT DATE&TIME [I;.01] 
"RTN","PXRHS01",38,0)
 ;        ^ TYPE [E;.03] ^ LOC. OF ENCOUNTER [E;.06]
"RTN","PXRHS01",39,0)
 ;        ^ SERVICE CATEGORY [E;.07] ^ CHECK OUT DATE&TIME [I;.18] 
"RTN","PXRHS01",40,0)
 ;        ^ HOSPITAL LOCATION [E;.22] ^ HOSP. LOC. ABBREVIATION [E;44;1]
"RTN","PXRHS01",41,0)
 ;        ^ OUTSIDE LOCATION [E;2101] ^ CLINIC [E;.08]
"RTN","PXRHS01",42,0)
 ;        ^ WALK IN/APPT [E;.16] ^ LEVEL OF SERVICE [E;.17]
"RTN","PXRHS01",43,0)
 ;        ^ ELIGIBILITY [E;.21]
"RTN","PXRHS01",44,0)
 ;  Data from V CPT (9000010.18) file
"RTN","PXRHS01",45,0)
 ;  ^TMP("PXHSV",$J,InvExDt,COUNT,"C",X) = CPT [I;.01] 
"RTN","PXRHS01",46,0)
 ;        ^ PROVIDER NARRATIVE [E;.04]
"RTN","PXRHS01",47,0)
 ;  ^TMP("PXHSV",$J,InvExDt,COUNT,"C",X,MODIFIER)="" [E;1/.01]
"RTN","PXRHS01",48,0)
 ;  Data from V POV (9000010.07) file
"RTN","PXRHS01",49,0)
 ;  ^TMP("PXHSV",$J,InvExDt,COUNT,"D",X) = POV [I;.01]
"RTN","PXRHS01",50,0)
 ;        ^ MODIFIER [E;.06] ^ CAUSE OF DX [E;.07]
"RTN","PXRHS01",51,0)
 ;        ^ PLACE OF ACCIDENT [E;.11] ^ PRIMARY/SECONDARY [E;.12]
"RTN","PXRHS01",52,0)
 ;  ^TMP("PXHSV",$J,InvExDt,COUNT,"D",X,"N") = PROVIDER NARRATIVE [E;.04]
"RTN","PXRHS01",53,0)
 ;  Data from V PROVIDER (9000010.06) file
"RTN","PXRHS01",54,0)
 ;  ^TMP("PXHSV",$J,InvExDt,COUNT,"P",X) = PROVIDER [E;.01]
"RTN","PXRHS01",55,0)
 ;        ^ PRIMARY/SECONDARY [E;.04]
"RTN","PXRHS01",56,0)
 ;  Data from V HOSPITALIZATION (9000010.02) file (If Service Category
"RTN","PXRHS01",57,0)
 ;  is for hospitalization)
"RTN","PXRHS01",58,0)
 ;  ^TMP("PXHSV",$J,InvExDt,COUNT,"H",X) = DATE OF DISCHARGE [I;.01]
"RTN","PXRHS01",59,0)
 ;        ^ ADMITTING DX [E;.12]
"RTN","PXRHS01",60,0)
 ;
"RTN","PXRHS01",61,0)
 ;   [] = [I(nternal)/E(xternal); Optional file #; Record #]
"RTN","PXRHS01",62,0)
 ;   Subscripts:
"RTN","PXRHS01",63,0)
 ;     InvExDt - Inverse FileMan date of DATE OF visit [.01]
"RTN","PXRHS01",64,0)
 ;     Count   - # of entry
"RTN","PXRHS01",65,0)
 ;
"RTN","PXRHS01",66,0)
 Q:$G(DFN)']""!'$D(^AUPNVSIT("AA",DFN))
"RTN","PXRHS01",67,0)
 N PXCNT,PXIVD,PXVDF,PXBEG,IBEGDT,IENDDT,CHGIVD,PXSTOP,IHSDATE
"RTN","PXRHS01",68,0)
 S:+$G(OCCLIM)'>0 OCCLIM=999
"RTN","PXRHS01",69,0)
 S:+$G(BEGDT)'>0 BEGDT=DT-10000
"RTN","PXRHS01",70,0)
 S:+$G(ENDDT)'>0 ENDDT=DT_".235959"
"RTN","PXRHS01",71,0)
 ; Chg regular dt/time to inverted dt/time
"RTN","PXRHS01",72,0)
 S IBEGDT=9999999-ENDDT,IENDDT=9999999-BEGDT+.235959
"RTN","PXRHS01",73,0)
 K ^TMP("PXHSV",$J)
"RTN","PXRHS01",74,0)
 S PXBEG=9999999-$P(ENDDT,"."),PXSTOP=(9999999-$P(BEGDT,"."))_".235959",PXCNT=0,IHSDATE=9999999-$$HSDATE+.235959
"RTN","PXRHS01",75,0)
 F  S PXBEG=$O(^AUPNVSIT("AA",DFN,PXBEG)) Q:+PXBEG'>0!(PXBEG>PXSTOP)  Q:PXBEG>IHSDATE  D  Q:PXCNT'<OCCLIM
"RTN","PXRHS01",76,0)
 .; Gets all valid visits on one day in last to first order
"RTN","PXRHS01",77,0)
 .; X-ref is in visit inverse date order but not inverse time order
"RTN","PXRHS01",78,0)
 . S (PXIVD,PXBEG)=$P(PXBEG,".")_".999999"
"RTN","PXRHS01",79,0)
 . ;start with last visit on a dt and don't duplicate any visits
"RTN","PXRHS01",80,0)
 . F  S PXIVD=$O(^AUPNVSIT("AA",DFN,PXIVD),-1) Q:+PXIVD'>0!(PXIVD<$P(PXBEG,"."))  D  Q:PXCNT'<OCCLIM
"RTN","PXRHS01",81,0)
 . .;invert PXIVD to same format as IBEGDT and IENDDT. For Visit file
"RTN","PXRHS01",82,0)
 . .;date is inverted date/regular time. We want inverted date/time.
"RTN","PXRHS01",83,0)
 . . S CHGIVD=9999999-((9999999-$P(PXIVD,"."))_"."_$P(PXIVD,".",2))
"RTN","PXRHS01",84,0)
 . . Q:(CHGIVD<IBEGDT)!(CHGIVD>IENDDT)
"RTN","PXRHS01",85,0)
 . . S PXVDF=""
"RTN","PXRHS01",86,0)
 . . F  S PXVDF=$O(^AUPNVSIT("AA",DFN,PXIVD,PXVDF)) Q:+PXVDF'>0  D GETREC^PXRHS02(PXVDF,$G(CATCODE),$G(EXTRCODE),$S(+$G(TIMEORD):PXIVD,1:""),.PXCNT)  Q:PXCNT'<OCCLIM
"RTN","PXRHS01",87,0)
 Q
"RTN","PXRHS01",88,0)
 ;
"RTN","PXRHS01",89,0)
HSDATE() ; $$() -> switch date
"RTN","PXRHS01",90,0)
 Q $P(^PX(815,1,0),U,3)
"RTN","PXRHS12")
0^40^B8270720^B8236713
"RTN","PXRHS12",1,0)
PXRHS12 ;ISL/SBW - PCE Visit Hospitalization data extract routine ;6/7/96
"RTN","PXRHS12",2,0)
 ;;1.0;PCE PATIENT CARE ENCOUNTER;**73,199**;Aug 12, 1996;Build 51
"RTN","PXRHS12",3,0)
 ; Extract returns Hospitalization visit data with associated ICD code,
"RTN","PXRHS12",4,0)
 ; CPT, and Provider data.
"RTN","PXRHS12",5,0)
VISIT(DFN,ENDDT,BEGDT,OCCLIM) ; Control branching
"RTN","PXRHS12",6,0)
 ;INPUT  : DFN      - Pointer to PATIENT file (#2)
"RTN","PXRHS12",7,0)
 ;         ENDDT    - Ending date/time in internal FileMan format
"RTN","PXRHS12",8,0)
 ;                  - Defaults to today's date at 11:59 pm
"RTN","PXRHS12",9,0)
 ;         BEGDT    - Beginning date/time in internal FileMan format
"RTN","PXRHS12",10,0)
 ;                  - Defaults to one year prior to today's date
"RTN","PXRHS12",11,0)
 ;         OCCLIM   - Maximum number of visits returned
"RTN","PXRHS12",12,0)
 ;
"RTN","PXRHS12",13,0)
 ;OUTPUT : 
"RTN","PXRHS12",14,0)
 ;  Data from VISIT (9000010) file except for hosp. loc. abbr.
"RTN","PXRHS12",15,0)
 ;  ^TMP("PXHSV",$J,InvExDt,COUNT,0) = VISIT/ADMIT DATE&TIME [I;.01] 
"RTN","PXRHS12",16,0)
 ;        ^ TYPE [E;.03] ^ LOC. OF ENCOUNTER [E;.06]
"RTN","PXRHS12",17,0)
 ;        ^ SERVICE CATEGORY [E;.07] ^ CHECK OUT DATE&TIME [I;.18] 
"RTN","PXRHS12",18,0)
 ;        ^ HOSPITAL LOCATION [E;.22] ^ HOSP. LOC. ABBREVIATION [E;44;1]
"RTN","PXRHS12",19,0)
 ;        ^ OUTSIDE LOCATION [E;2101] ^ CLINIC [E;.08]
"RTN","PXRHS12",20,0)
 ;        ^ WALK IN/APPT [E;.16] ^ LEVEL OF SERVICE [E;.17]
"RTN","PXRHS12",21,0)
 ;        ^ ELIGIBILITY [E;.21]
"RTN","PXRHS12",22,0)
 ;  Data from V CPT (9000010.18) file
"RTN","PXRHS12",23,0)
 ;  ^TMP("PXHSV",$J,InvExDt,COUNT,"C",X) = CPT [I;.01] 
"RTN","PXRHS12",24,0)
 ;        ^ PROVIDER NARRATIVE [E;.04]
"RTN","PXRHS12",25,0)
 ;  ^TMP("PXHSV",$J,InvExDt,COUNT,"C",MODIFIER)="" [E;1/.01]
"RTN","PXRHS12",26,0)
 ;  Data from V POV (9000010.07) file
"RTN","PXRHS12",27,0)
 ;  ^TMP("PXHSV",$J,InvExDt,COUNT,"D",X) = POV [I;.01]
"RTN","PXRHS12",28,0)
 ;        ^ MODIFIER [E;.06] ^ CAUSE OF DX [E;.07]
"RTN","PXRHS12",29,0)
 ;        ^ PLACE OF ACCIDENT [E;.11] ^ PRIMARY/SECONDARY [E;.12]
"RTN","PXRHS12",30,0)
 ;  ^TMP("PXHSV",$J,InvExDt,COUNT,"D",X,"N") = PROVIDER NARRATIVE [E;.04]
"RTN","PXRHS12",31,0)
 ;  Data from V PROVIDER (9000010.06) file
"RTN","PXRHS12",32,0)
 ;  ^TMP("PXHSV",$J,InvExDt,COUNT,"P",X) = PROVIDER [E;.01]
"RTN","PXRHS12",33,0)
 ;        ^ PRIMARY/SECONDARY [E;.04]
"RTN","PXRHS12",34,0)
 ;  Data from V HOSPITALIZATION (9000010.02) file (If Service Category
"RTN","PXRHS12",35,0)
 ;  is for hospitalization)
"RTN","PXRHS12",36,0)
 ;  ^TMP("PXHSV",$J,InvExDt,COUNT,"H",X) = DATE OF DISCHARGE [I;.01]
"RTN","PXRHS12",37,0)
 ;        ^ ADMITTING DX [E;.12]
"RTN","PXRHS12",38,0)
 ;
"RTN","PXRHS12",39,0)
 ;   [] = [I(nternal)/E(xternal); Optional file #; Record #]
"RTN","PXRHS12",40,0)
 ;   Subscripts:
"RTN","PXRHS12",41,0)
 ;     InvExDt - Inverse FileMan date of DATE OF visit [.01]
"RTN","PXRHS12",42,0)
 ;     Count   - # of entry
"RTN","PXRHS12",43,0)
 ;
"RTN","PXRHS12",44,0)
 Q:$G(DFN)']""!'$D(^AUPNVSIT("AAH",DFN))
"RTN","PXRHS12",45,0)
 N PXCNT,PXIVD,PXVDF,PXBEG,CATCODE,IBEGDT,IENDDT,CHGIVD,PXSTOP
"RTN","PXRHS12",46,0)
 S CATCODE="H" ;Get only Hospitalization visits
"RTN","PXRHS12",47,0)
 S EXTRCODE="PCD" ;Get provider, CPT, and ICD code data
"RTN","PXRHS12",48,0)
 S:+$G(OCCLIM)'>0 OCCLIM=999
"RTN","PXRHS12",49,0)
 S:+$G(BEGDT)'>0 BEGDT=DT-10000
"RTN","PXRHS12",50,0)
 S:+$G(ENDDT)'>0 ENDDT=DT_".235959"
"RTN","PXRHS12",51,0)
 ; Chg regular dt/time to inverted dt/time
"RTN","PXRHS12",52,0)
 S IBEGDT=9999999-ENDDT,IENDDT=9999999-BEGDT
"RTN","PXRHS12",53,0)
 K ^TMP("PXHSV",$J)
"RTN","PXRHS12",54,0)
 S PXBEG=9999999-$P(ENDDT,"."),PXSTOP=(9999999-$P(BEGDT,"."))_".235959",PXCNT=0
"RTN","PXRHS12",55,0)
 F  S PXBEG=$O(^AUPNVSIT("AAH",DFN,PXBEG)) Q:+PXBEG'>0!(PXBEG>PXSTOP)  D  Q:PXCNT'<OCCLIM
"RTN","PXRHS12",56,0)
 .; Gets all valid visits on one day in last to first order
"RTN","PXRHS12",57,0)
 .; X-ref is in visit inverse date order but not inverse time order
"RTN","PXRHS12",58,0)
 . S (PXIVD,PXBEG)=$P(PXBEG,".")_".999999"
"RTN","PXRHS12",59,0)
 . ;start with last visit on a dt and don't duplicate any visits
"RTN","PXRHS12",60,0)
 . F  S PXIVD=$O(^AUPNVSIT("AAH",DFN,PXIVD),-1) Q:+PXIVD'>0!(PXIVD<$P(PXBEG,"."))  D  Q:PXCNT'<OCCLIM
"RTN","PXRHS12",61,0)
 . .;invert PXIVD to same format as IBEGDT and IENDDT. For Visit file
"RTN","PXRHS12",62,0)
 . .;date is inverted date/regular time. We want inverted date/time.
"RTN","PXRHS12",63,0)
 . . S CHGIVD=9999999-((9999999-$P(PXIVD,"."))_"."_$P(PXIVD,".",2))
"RTN","PXRHS12",64,0)
 . . Q:(CHGIVD<IBEGDT)!(CHGIVD>IENDDT)
"RTN","PXRHS12",65,0)
 . . S PXVDF=""
"RTN","PXRHS12",66,0)
 . . F  S PXVDF=$O(^AUPNVSIT("AAH",DFN,PXIVD,PXVDF)) Q:+PXVDF'>0  D GETREC^PXRHS02(PXVDF,$G(CATCODE),$G(EXTRCODE),"",.PXCNT)  Q:PXCNT'<OCCLIM
"RTN","PXRHS12",67,0)
 Q
"RTN","PXRRFDP")
0^41^B74055950^B66324541
"RTN","PXRRFDP",1,0)
PXRRFDP ;ISL/PKR - Final sort and print of frequency of diagnosis report. ;9/5/97
"RTN","PXRRFDP",2,0)
 ;;1.0;PCE PATIENT CARE ENCOUNTER;**3,10,12,18,31,121,199**;Aug 12, 1996;Build 51
"RTN","PXRRFDP",3,0)
 ;
"RTN","PXRRFDP",4,0)
PRINT ;
"RTN","PXRRFDP",5,0)
 N ANS,BD,BMARG,C1E,C1S,C2E,C2S,C3E,C3S,C1HS,C2HS,C3HS,CMAX,INDENT,MID
"RTN","PXRRFDP",6,0)
 N DCSTR,HEAD,LEN,NUM,PAGE
"RTN","PXRRFDP",7,0)
 N BYLOC,BYPC,BYPRV,DCIEN,DOCOUNT,DONE,DTOT,ED,ETOT,FOUND,HLOC,IC,ICD9IEN
"RTN","PXRRFDP",8,0)
 N FACILITY,FACPNAME,IC,ICDDATA,ICDDATE,IMPDATE,INFOTYPE,LOCPNAM,NEWPAGE,PCLASS,PRV
"RTN","PXRRFDP",9,0)
 N RATIO,STOIND,TEMP,TOTAL,TOTSTR,VACODE,ICDSTR
"RTN","PXRRFDP",10,0)
 ;
"RTN","PXRRFDP",11,0)
 ;Allow the task to be cleaned up upon successful completion.
"RTN","PXRRFDP",12,0)
 S ZTREQ="@"
"RTN","PXRRFDP",13,0)
 ;
"RTN","PXRRFDP",14,0)
 U IO
"RTN","PXRRFDP",15,0)
 S IMPDATE=$$IMPDATE^LEXU("10D")
"RTN","PXRRFDP",16,0)
 ; When no Diagnoses found for Criteria for either ICD-9 or ICD-10, rpt Criteria
"RTN","PXRRFDP",17,0)
 ; and End the run.
"RTN","PXRRFDP",18,0)
 I (DIAGTOT=0)&(DGTOT10=0) S DOCOUNT=1 D PROCSS2 G END
"RTN","PXRRFDP",19,0)
 F DOCOUNT=1:1:2 D PROCESS
"RTN","PXRRFDP",20,0)
 G END
"RTN","PXRRFDP",21,0)
 ;
"RTN","PXRRFDP",22,0)
PROCESS ;
"RTN","PXRRFDP",23,0)
 I DOCOUNT=1,DIAGTOT=0 Q
"RTN","PXRRFDP",24,0)
 I DOCOUNT=2,DGTOT10=0 Q
"RTN","PXRRFDP",25,0)
PROCSS2 S ICDDATE=$S(DOCOUNT=2:IMPDATE,1:$$FMADD^XLFDT(IMPDATE,-1))
"RTN","PXRRFDP",26,0)
 S BMARG=2
"RTN","PXRRFDP",27,0)
 S INDENT=3,PAGE=1,C1S=INDENT+29
"RTN","PXRRFDP",28,0)
 ;
"RTN","PXRRFDP",29,0)
 S DONE=0
"RTN","PXRRFDP",30,0)
 D HDR^PXRRGPRT(PAGE)
"RTN","PXRRFDP",31,0)
 W !!,"Criteria for Frequency of Diagnoses Report"
"RTN","PXRRFDP",32,0)
 W !,?INDENT,"Encounter diagnoses:",?C1S,$P(PXRRFDDC,U,2)
"RTN","PXRRFDP",33,0)
 S BD=$$FMTE^XLFDT(PXRRBDT)
"RTN","PXRRFDP",34,0)
 S ED=$$FMTE^XLFDT(PXRREDT)
"RTN","PXRRFDP",35,0)
 W !,?INDENT,"Encounter date range:",?C1S,BD," through ",ED
"RTN","PXRRFDP",36,0)
 I PXRRECAT="" D  G MAXP
"RTN","PXRRFDP",37,0)
 . W !,?INDENT,"Selected encounters:",?C1S,"ALL"
"RTN","PXRRFDP",38,0)
 ;
"RTN","PXRRFDP",39,0)
 I $D(PXRRPRSC) W !,?INDENT,"Selected Providers:",?C1S,$P(PXRRPRSC,U,2)
"RTN","PXRRFDP",40,0)
 I $D(PXRRCS) S ANS="YES"
"RTN","PXRRFDP",41,0)
 E  S ANS="ALL"
"RTN","PXRRFDP",42,0)
 I $D(PXRRLCSC) W !,?INDENT,$P(PXRRLCSC,U,2)
"RTN","PXRRFDP",43,0)
 I $D(PXRRETYP) W !,?INDENT,"Encounter type:",?C1S,PXRRETYP
"RTN","PXRRFDP",44,0)
 ;
"RTN","PXRRFDP",45,0)
 I $D(PXRRDOB) D
"RTN","PXRRFDP",46,0)
 . I (PXRRDOBE'=DT)&(PXRRDOBS'=0) D
"RTN","PXRRFDP",47,0)
 .. W !,?INDENT,"Patient age range:",?C1S,PXRRMINA," to ",PXRRMAXA
"RTN","PXRRFDP",48,0)
 .. S BD=$$FMTE^XLFDT(PXRRDOBS),ED=$$FMTE^XLFDT(PXRRDOBE)
"RTN","PXRRFDP",49,0)
 .. W !,?INDENT,"Patient date of birth:",?C1S,BD," through ",ED
"RTN","PXRRFDP",50,0)
 . I (PXRRDOBS=0) D
"RTN","PXRRFDP",51,0)
 .. W !,?INDENT,"Patient age range:",?C1S,PXRRMINA," or more"
"RTN","PXRRFDP",52,0)
 .. S ED=$$FMTE^XLFDT(PXRRDOBE)
"RTN","PXRRFDP",53,0)
 .. W !,?INDENT,"Patient date of birth:",?C1S,ED," or before"
"RTN","PXRRFDP",54,0)
 . I (PXRRDOBE=DT) D
"RTN","PXRRFDP",55,0)
 .. W !,?INDENT,"Patient age range:",?C1S,"Up to ",PXRRMAXA
"RTN","PXRRFDP",56,0)
 .. S BD=$$FMTE^XLFDT(PXRRDOBS),ED=$$FMTE^XLFDT(DT)
"RTN","PXRRFDP",57,0)
 .. W !,?INDENT,"Patient date of birth:",?C1S,BD," through ",ED
"RTN","PXRRFDP",58,0)
 E  W !,?INDENT,"Patient age range:",?C1S,"ALL"
"RTN","PXRRFDP",59,0)
 ;
"RTN","PXRRFDP",60,0)
 I $D(PXRRRACE) D
"RTN","PXRRFDP",61,0)
 . N RACE
"RTN","PXRRFDP",62,0)
 . S RACE="race"
"RTN","PXRRFDP",63,0)
 . I NRACE>1 S RACE="races"
"RTN","PXRRFDP",64,0)
 . W !?INDENT,"Patient ",RACE,":",?C1S,$P(PXRRRACE(1),U,2)
"RTN","PXRRFDP",65,0)
 . F IC=2:1:NRACE W !,?C1S,$P(PXRRRACE(IC),U,2)
"RTN","PXRRFDP",66,0)
 E  W !?INDENT,"Patient race(s):",?C1S,"ALL"
"RTN","PXRRFDP",67,0)
 ;
"RTN","PXRRFDP",68,0)
 I $D(PXRRSEX) W !?INDENT,"Patient sex:",?C1S,$P(PXRRSEX,U,2)
"RTN","PXRRFDP",69,0)
 E  W !?INDENT,"Patient sex:",?C1S,"BOTH"
"RTN","PXRRFDP",70,0)
 ;
"RTN","PXRRFDP",71,0)
 I $D(PXRRSCAT) D OSCAT^PXRRGPRT(PXRRSCAT,INDENT)
"RTN","PXRRFDP",72,0)
 ;
"RTN","PXRRFDP",73,0)
 I $P($G(PXRRPRSC),U,1)="C" D PECLASS^PXRRGPRT(INDENT)
"RTN","PXRRFDP",74,0)
 ;
"RTN","PXRRFDP",75,0)
MAXP W !!,?INDENT,"Maximum number of diagnoses to be displayed: ",PXRRDMAX
"RTN","PXRRFDP",76,0)
 ;
"RTN","PXRRFDP",77,0)
 S CMAX=70
"RTN","PXRRFDP",78,0)
 ;
"RTN","PXRRFDP",79,0)
 I $D(PXRRLCSC) D
"RTN","PXRRFDP",80,0)
 . I PXRRLCSC["C" S PLOCNAM="Clinic Stop: "
"RTN","PXRRFDP",81,0)
 . I PXRRLCSC["H" S PLOCNAM="Hospital Location: "
"RTN","PXRRFDP",82,0)
 ;
"RTN","PXRRFDP",83,0)
 S FACILITY=""
"RTN","PXRRFDP",84,0)
NFAC S INFOTYPE="FACILITY"
"RTN","PXRRFDP",85,0)
 S FACILITY=$O(^XTMP(PXRRXTMP,"INFO",INFOTYPE,FACILITY))
"RTN","PXRRFDP",86,0)
 I +FACILITY=0 Q
"RTN","PXRRFDP",87,0)
 ;Mark the facility as being found.
"RTN","PXRRFDP",88,0)
 F IC=1:1:NFAC I $P(PXRRFAC(IC),U,1)=FACILITY D  Q
"RTN","PXRRFDP",89,0)
 . S $P(PXRRFAC(IC),U,4)="M"
"RTN","PXRRFDP",90,0)
 S FACPNAME=$P(PXRRFACN(FACILITY),U,1)_"  "_$P(PXRRFACN(FACILITY),U,2)
"RTN","PXRRFDP",91,0)
 ;
"RTN","PXRRFDP",92,0)
 ;Check for a user request to stop the task.
"RTN","PXRRFDP",93,0)
 I $$S^%ZTLOAD S ZTSTOP=1 D EXIT^PXRRFDD
"RTN","PXRRFDP",94,0)
 ;
"RTN","PXRRFDP",95,0)
NINFO S INFOTYPE=$O(^XTMP(PXRRXTMP,"INFO",INFOTYPE))
"RTN","PXRRFDP",96,0)
 I INFOTYPE="" G NFAC
"RTN","PXRRFDP",97,0)
 ;
"RTN","PXRRFDP",98,0)
 I INFOTYPE["LOC" S BYLOC=1
"RTN","PXRRFDP",99,0)
 E  S BYLOC=0
"RTN","PXRRFDP",100,0)
 I INFOTYPE["PC" S BYPC=1
"RTN","PXRRFDP",101,0)
 E  S BYPC=0
"RTN","PXRRFDP",102,0)
 I INFOTYPE["PRV" S BYPRV=1
"RTN","PXRRFDP",103,0)
 E  S BYPRV=0
"RTN","PXRRFDP",104,0)
 ;
"RTN","PXRRFDP",105,0)
 S PRV=""
"RTN","PXRRFDP",106,0)
NPRV ;
"RTN","PXRRFDP",107,0)
 S PRV=$O(^XTMP(PXRRXTMP,"INFO",INFOTYPE,FACILITY,PRV))
"RTN","PXRRFDP",108,0)
 I PRV="" G NINFO
"RTN","PXRRFDP",109,0)
 ;
"RTN","PXRRFDP",110,0)
 S VACODE=""
"RTN","PXRRFDP",111,0)
NVACODE ;
"RTN","PXRRFDP",112,0)
 S VACODE=$O(^XTMP(PXRRXTMP,"INFO",INFOTYPE,FACILITY,PRV,VACODE))
"RTN","PXRRFDP",113,0)
 I VACODE="" G NPRV
"RTN","PXRRFDP",114,0)
 ;
"RTN","PXRRFDP",115,0)
 S HLOC=""
"RTN","PXRRFDP",116,0)
NLOC S HLOC=$O(^XTMP(PXRRXTMP,"INFO",INFOTYPE,FACILITY,PRV,VACODE,HLOC))
"RTN","PXRRFDP",117,0)
 I HLOC="" G NVACODE
"RTN","PXRRFDP",118,0)
 ;
"RTN","PXRRFDP",119,0)
 S STOIND=^XTMP(PXRRXTMP,"INFO",INFOTYPE,FACILITY,PRV,VACODE,HLOC)
"RTN","PXRRFDP",120,0)
 ;
"RTN","PXRRFDP",121,0)
 ;If the report is by provider get a person class for the provider.
"RTN","PXRRFDP",122,0)
 I BYPRV D
"RTN","PXRRFDP",123,0)
 . S TEMP=$P(PRV,U,4)
"RTN","PXRRFDP",124,0)
 . I $L(TEMP)>0 S PCLASS=$$ABBRV^PXRRPECU(TEMP)
"RTN","PXRRFDP",125,0)
 . E  S PCLASS="Unknown"
"RTN","PXRRFDP",126,0)
 ;
"RTN","PXRRFDP",127,0)
 ;If the report is by person class get the person class.
"RTN","PXRRFDP",128,0)
 I BYPC D
"RTN","PXRRFDP",129,0)
 . S PCLASS=$$ABBRV^PXRRPECU(VACODE)
"RTN","PXRRFDP",130,0)
 ;
"RTN","PXRRFDP",131,0)
 S HEAD=1
"RTN","PXRRFDP",132,0)
 D HEAD(0)
"RTN","PXRRFDP",133,0)
 I DONE G EXIT
"RTN","PXRRFDP",134,0)
 S C1S=INDENT+60
"RTN","PXRRFDP",135,0)
 I $Y>(IOSL-BMARG-4) D HEAD(1)
"RTN","PXRRFDP",136,0)
 I DONE G EXIT
"RTN","PXRRFDP",137,0)
 I $P(PXRRFDDC,U,1)="P" S TEMP="Total number of Primary Diagnoses for these Encounters:"
"RTN","PXRRFDP",138,0)
 E  S TEMP="Total number of Diagnoses for these Encounters:"
"RTN","PXRRFDP",139,0)
 I $D(^XTMP(PXRRXTMP,"TOTALS","ENCTOT",STOIND)) S ETOT=^XTMP(PXRRXTMP,"TOTALS","ENCTOT",STOIND)
"RTN","PXRRFDP",140,0)
 E  S ETOT=0
"RTN","PXRRFDP",141,0)
 S TOTSTR=$S(DOCOUNT=1:"DIAGTOT",1:"DGTOT10")
"RTN","PXRRFDP",142,0)
 I $D(^XTMP(PXRRXTMP,"TOTALS",TOTSTR,STOIND)) S DTOT=^XTMP(PXRRXTMP,"TOTALS",TOTSTR,STOIND)
"RTN","PXRRFDP",143,0)
 E  S DTOT=0
"RTN","PXRRFDP",144,0)
 S LEN=$$MAX^XLFMTH($L(DTOT),$L(ETOT))
"RTN","PXRRFDP",145,0)
 W !!,?INDENT,"Total number of Encounters meeting the selection criteria:",?C1S,$J(ETOT,LEN)
"RTN","PXRRFDP",146,0)
 W !,?INDENT,TEMP,?C1S,$J(DTOT,LEN)
"RTN","PXRRFDP",147,0)
 S RATIO=$S(ETOT>0:(DTOT/ETOT),1:0)
"RTN","PXRRFDP",148,0)
 W !,?INDENT,"Diagnoses/Encounter ratio:",?C1S,$J(RATIO,LEN,2)
"RTN","PXRRFDP",149,0)
 ;
"RTN","PXRRFDP",150,0)
 S C1S=INDENT+8,C2E=INDENT+59
"RTN","PXRRFDP",151,0)
 S C1HS=INDENT+9,C2HS=INDENT+33
"RTN","PXRRFDP",152,0)
 S TOTAL=""
"RTN","PXRRFDP",153,0)
 S NUM=0,ICDSTR=$S(DOCOUNT=1:"ICD9",1:"ICD10")
"RTN","PXRRFDP",154,0)
NTOTICD S TOTAL=$O(^XTMP(PXRRXTMP,"PRINT",STOIND,ICDSTR,TOTAL),-1)
"RTN","PXRRFDP",155,0)
 I TOTAL="" G DIAGCAT
"RTN","PXRRFDP",156,0)
 S TEMP=TOTAL
"RTN","PXRRFDP",157,0)
 S ICD9IEN=""
"RTN","PXRRFDP",158,0)
NICD9 S ICD9IEN=$O(^XTMP(PXRRXTMP,"PRINT",STOIND,ICDSTR,TOTAL,ICD9IEN),-1)
"RTN","PXRRFDP",159,0)
 I ICD9IEN="" G NTOTICD
"RTN","PXRRFDP",160,0)
 S NUM=NUM+1
"RTN","PXRRFDP",161,0)
 I NUM=1 S HEAD=1
"RTN","PXRRFDP",162,0)
 I $Y>(IOSL-BMARG-5) S NEWPAGE=1
"RTN","PXRRFDP",163,0)
 E  S NEWPAGE=0
"RTN","PXRRFDP",164,0)
 D DHEAD(NEWPAGE)
"RTN","PXRRFDP",165,0)
 I DONE G EXIT
"RTN","PXRRFDP",166,0)
 S C3S=C3E-$L(TEMP)
"RTN","PXRRFDP",167,0)
 S ICDDATA=$$ICDDATA^ICDXCODE("DIAG",ICD9IEN,ICDDATE,"I")
"RTN","PXRRFDP",168,0)
 W !," ",$P(ICDDATA,U,2),?11,$E($P(ICDDATA,U,4),1,60),?72,$J($FN(TEMP,",",0),7)
"RTN","PXRRFDP",169,0)
 I NUM<PXRRDMAX G NICD9
"RTN","PXRRFDP",170,0)
DIAGCAT ;
"RTN","PXRRFDP",171,0)
 S C1S=INDENT+8,C1E=INDENT+38
"RTN","PXRRFDP",172,0)
 S C1HS=14
"RTN","PXRRFDP",173,0)
 S TOTAL=""
"RTN","PXRRFDP",174,0)
 S NUM=0
"RTN","PXRRFDP",175,0)
 S DCSTR=$S(DOCOUNT=1:"DC",1:"DC10")
"RTN","PXRRFDP",176,0)
NTOTDC S TOTAL=$O(^XTMP(PXRRXTMP,"PRINT",STOIND,DCSTR,TOTAL),-1)
"RTN","PXRRFDP",177,0)
 I TOTAL="" G NLOC
"RTN","PXRRFDP",178,0)
 S TEMP=TOTAL
"RTN","PXRRFDP",179,0)
 S DCIEN=""
"RTN","PXRRFDP",180,0)
NDC S DCIEN=$O(^XTMP(PXRRXTMP,"PRINT",STOIND,DCSTR,TOTAL,DCIEN),-1)
"RTN","PXRRFDP",181,0)
 I DCIEN="" G NTOTDC
"RTN","PXRRFDP",182,0)
 S NUM=NUM+1
"RTN","PXRRFDP",183,0)
 I NUM=1 S HEAD=1
"RTN","PXRRFDP",184,0)
 I $Y>(IOSL-BMARG-5) S NEWPAGE=1
"RTN","PXRRFDP",185,0)
 E  S NEWPAGE=0
"RTN","PXRRFDP",186,0)
 D DCHEAD(NEWPAGE)
"RTN","PXRRFDP",187,0)
 I DONE G EXIT
"RTN","PXRRFDP",188,0)
 S C2S=C2E-$L(TEMP)
"RTN","PXRRFDP",189,0)
 ;We will need a DBIA to read ICM.  Some sites have had a corrupted ICM
"RTN","PXRRFDP",190,0)
 ;file.  Check for this problem, if found print an error message and
"RTN","PXRRFDP",191,0)
 ;quit.
"RTN","PXRRFDP",192,0)
 I (DCIEN>0)&('$D(^ICM(DCIEN,0))) D  G EXIT
"RTN","PXRRFDP",193,0)
 . W !!,"CANNOT CONTINUE, File 80.3 Major Diagnostic Category is corrupted!"
"RTN","PXRRFDP",194,0)
 . W !,"^ICM(",DCIEN,",0) is missing."
"RTN","PXRRFDP",195,0)
 . W !,"Please contact customer service for help."
"RTN","PXRRFDP",196,0)
 I DCIEN>0 W !,?INDENT,$J(NUM,5),".",?C1S,$P(^ICM(DCIEN,0),U,1),?C2S,TEMP
"RTN","PXRRFDP",197,0)
 E  W !,?INDENT,$J(NUM,5),".",?C1S,"Unknown",?C2S,TEMP
"RTN","PXRRFDP",198,0)
 I NUM<PXRRDMAX G NDC
"RTN","PXRRFDP",199,0)
 ;
"RTN","PXRRFDP",200,0)
 ;Get the next location.
"RTN","PXRRFDP",201,0)
 G NLOC
"RTN","PXRRFDP",202,0)
END ;
"RTN","PXRRFDP",203,0)
 ;Check for facilities that were listed but had no encounters.
"RTN","PXRRFDP",204,0)
 D FACNE^PXRRGPRT(INDENT)
"RTN","PXRRFDP",205,0)
EXIT ;
"RTN","PXRRFDP",206,0)
 D EXIT^PXRRGUT
"RTN","PXRRFDP",207,0)
 D EOR^PXRRGUT
"RTN","PXRRFDP",208,0)
 Q
"RTN","PXRRFDP",209,0)
 ;
"RTN","PXRRFDP",210,0)
 ;=======================================================================
"RTN","PXRRFDP",211,0)
DHEAD(NEWPAGE) ;
"RTN","PXRRFDP",212,0)
 N DASH60 S $P(DASH60,"-",61)=""
"RTN","PXRRFDP",213,0)
 I NEWPAGE D PAGE^PXRRGPRT
"RTN","PXRRFDP",214,0)
 E  I $Y>(IOSL-BMARG) D PAGE^PXRRGPRT
"RTN","PXRRFDP",215,0)
 I DONE Q
"RTN","PXRRFDP",216,0)
 I (HEAD)&(RATIO>0) D
"RTN","PXRRFDP",217,0)
 . S LEN=$$MAX^XLFMTH(9,$L(TEMP))
"RTN","PXRRFDP",218,0)
 . S MID=C2E+3+(LEN/2)
"RTN","PXRRFDP",219,0)
 . S C3HS=MID-5
"RTN","PXRRFDP",220,0)
 . S C3E=MID+($L(TEMP)/2)
"RTN","PXRRFDP",221,0)
 . W !!,?INDENT,PXRRDMAX," Most Frequent ICD",$S(DOCOUNT=1:"9",1:"10")," Diagnoses:"
"RTN","PXRRFDP",222,0)
 . W !," Code",?11,"Description",?72,"Freq."
"RTN","PXRRFDP",223,0)
 . W !," --------",?11,DASH60,?72,"-------"
"RTN","PXRRFDP",224,0)
 . S HEAD=0
"RTN","PXRRFDP",225,0)
 Q
"RTN","PXRRFDP",226,0)
 ;
"RTN","PXRRFDP",227,0)
 ;=======================================================================
"RTN","PXRRFDP",228,0)
DCHEAD(NEWPAGE) ;
"RTN","PXRRFDP",229,0)
 I NEWPAGE D PAGE^PXRRGPRT
"RTN","PXRRFDP",230,0)
 E  I $Y>(IOSL-BMARG) D PAGE^PXRRGPRT
"RTN","PXRRFDP",231,0)
 I DONE Q
"RTN","PXRRFDP",232,0)
 I (HEAD)&(RATIO>0) D
"RTN","PXRRFDP",233,0)
 . S LEN=$$MAX^XLFMTH(9,$L(TEMP))
"RTN","PXRRFDP",234,0)
 . S MID=C1E+3+(LEN/2)
"RTN","PXRRFDP",235,0)
 . S C2HS=MID-5
"RTN","PXRRFDP",236,0)
 . S C2E=MID+($L(TEMP)/2)
"RTN","PXRRFDP",237,0)
 . W !!,?INDENT,PXRRDMAX," Most Frequent ICD",$S(DOCOUNT=1:"9",1:"10")," Diagnostic Categories:"
"RTN","PXRRFDP",238,0)
 . W !,?C1HS,"Diagnostic Category",?C2HS,"Frequency"
"RTN","PXRRFDP",239,0)
 . W !,?C1S,"------------------------------",?C2HS,"---------"
"RTN","PXRRFDP",240,0)
 . S HEAD=0
"RTN","PXRRFDP",241,0)
 Q
"RTN","PXRRFDP",242,0)
 ;
"RTN","PXRRFDP",243,0)
 ;=======================================================================
"RTN","PXRRFDP",244,0)
HEAD(NEWPAGE) ;
"RTN","PXRRFDP",245,0)
 N LEN,TEMP
"RTN","PXRRFDP",246,0)
 I NEWPAGE D PAGE^PXRRGPRT
"RTN","PXRRFDP",247,0)
 E  I $Y>(IOSL-BMARG-8) D PAGE^PXRRGPRT
"RTN","PXRRFDP",248,0)
 I DONE Q
"RTN","PXRRFDP",249,0)
 I HEAD D
"RTN","PXRRFDP",250,0)
 . W !!,"___________________________________________________________________"
"RTN","PXRRFDP",251,0)
 . W !,"Facility: ",FACPNAME
"RTN","PXRRFDP",252,0)
 . I BYLOC W !,PLOCNAM,$P(HLOC,U,1)_" (",$P(HLOC,U,3)_")"
"RTN","PXRRFDP",253,0)
 . I BYPRV D
"RTN","PXRRFDP",254,0)
 .. S TEMP="Provider: "_$P(PRV,U,1)_" ("_PCLASS_")"
"RTN","PXRRFDP",255,0)
 .. S LEN=$L(TEMP)
"RTN","PXRRFDP",256,0)
 .. I LEN>CMAX D
"RTN","PXRRFDP",257,0)
 ... W !,$E(TEMP,1,CMAX)
"RTN","PXRRFDP",258,0)
 ... W !," ",$E(TEMP,CMAX+1,LEN)
"RTN","PXRRFDP",259,0)
 .. E  W !,TEMP
"RTN","PXRRFDP",260,0)
 . I BYPC D
"RTN","PXRRFDP",261,0)
 .. W !,"Person Class (Occupation+Specialty+Subspecialty): "
"RTN","PXRRFDP",262,0)
 .. S LEN=INDENT+$L(PCLASS)
"RTN","PXRRFDP",263,0)
 .. I LEN>CMAX D
"RTN","PXRRFDP",264,0)
 ... W !,?INDENT,$E(PCLASS,1,CMAX)
"RTN","PXRRFDP",265,0)
 ... W !,?(INDENT+1),$E(PCLASS,CMAX+1,LEN)
"RTN","PXRRFDP",266,0)
 .. E  W !,?INDENT,PCLASS
"RTN","PXRRFDP",267,0)
 . S HEAD=0
"RTN","PXRRFDP",268,0)
 Q
"RTN","PXRRFDP",269,0)
 ;
"RTN","PXRRFDSD")
0^42^B37724715^B22536054
"RTN","PXRRFDSD",1,0)
PXRRFDSD ;ISL/PKR - Go through the encounters attaching a diagnosis and then sort based on the diagnosis. ;06/08/98
"RTN","PXRRFDSD",2,0)
 ;;1.0;PCE PATIENT CARE ENCOUNTER;**3,10,12,31,54,121,199**;Aug 12, 1996;Build 51
"RTN","PXRRFDSD",3,0)
SORT ;
"RTN","PXRRFDSD",4,0)
 N BUSY,COUNT,DCIEN,DGTOT10,DIAGTOT,ENCTOT,FACILITY,HLOC,ICD9IEN,ICDDATA
"RTN","PXRRFDSD",5,0)
 N ICDTYP,INFOTYPE,PNAME,POV,POVIEN,PRIMARY,PXDXDATE,STOIND,VACODE,VIEN
"RTN","PXRRFDSD",6,0)
 ;
"RTN","PXRRFDSD",7,0)
 ;The ^XTMP array created in PXRRFDSE can have four possible structures.
"RTN","PXRRFDSD",8,0)
 ;If the encounters were sorted by location then the structure will be:
"RTN","PXRRFDSD",9,0)
 ;  ^XTMP(PXRRXTMP,FACILITY,1,1,HLOC,VIEN).
"RTN","PXRRFDSD",10,0)
 ;If the encounters were sorted by person class then the structure will be:
"RTN","PXRRFDSD",11,0)
 ;  ^XTMP(PXRRXTMP,FACILITY,1,VACODE,1,VIEN).
"RTN","PXRRFDSD",12,0)
 ;If the encounters were sorted by provider then the structure will be:
"RTN","PXRRFDSD",13,0)
 ;  ^XTMP(PXRRXTMP,FACILITY,PNAME,1,1,VIEN).
"RTN","PXRRFDSD",14,0)
 ;If none of the above screens were used then the structure will be:
"RTN","PXRRFDSD",15,0)
 ;  ^XTMP(PXRRXTMP,FACILITY,1,1,1,VIEN).
"RTN","PXRRFDSD",16,0)
 ;
"RTN","PXRRFDSD",17,0)
 I '(PXRRQUE!$D(IO("S"))) D INIT^PXRRBUSY(.BUSY)
"RTN","PXRRFDSD",18,0)
 ;
"RTN","PXRRFDSD",19,0)
 ;Allow the task to be cleaned up on successful completion.
"RTN","PXRRFDSD",20,0)
 S ZTREQ="@"
"RTN","PXRRFDSD",21,0)
 ;
"RTN","PXRRFDSD",22,0)
 I $P(PXRRFDDC,U,1)="P" S PRIMARY=1
"RTN","PXRRFDSD",23,0)
 E  S PRIMARY=0
"RTN","PXRRFDSD",24,0)
 ;
"RTN","PXRRFDSD",25,0)
 S DIAGTOT=0,DGTOT10=0
"RTN","PXRRFDSD",26,0)
 ;Initialize the storage index.
"RTN","PXRRFDSD",27,0)
 S STOIND=0
"RTN","PXRRFDSD",28,0)
 ;
"RTN","PXRRFDSD",29,0)
 S FACILITY=""
"RTN","PXRRFDSD",30,0)
FAC S FACILITY=$O(^XTMP(PXRRXTMP,"ENCTR",FACILITY))
"RTN","PXRRFDSD",31,0)
 I FACILITY="" G SETPR
"RTN","PXRRFDSD",32,0)
 S STOIND=STOIND+1
"RTN","PXRRFDSD",33,0)
 S ^XTMP(PXRRXTMP,"INFO","FACILITY",FACILITY,FACILITY)=STOIND
"RTN","PXRRFDSD",34,0)
 ;
"RTN","PXRRFDSD",35,0)
 S PNAME=""
"RTN","PXRRFDSD",36,0)
PRV S PNAME=$O(^XTMP(PXRRXTMP,"ENCTR",FACILITY,PNAME))
"RTN","PXRRFDSD",37,0)
 I PNAME="" G FAC
"RTN","PXRRFDSD",38,0)
 ;Start INFOTYPE with "G" so it always comes after FACILITY.
"RTN","PXRRFDSD",39,0)
 S INFOTYPE="G"
"RTN","PXRRFDSD",40,0)
 I ($L(PNAME)>1)&(+PNAME=0)&(INFOTYPE'["PRV") D
"RTN","PXRRFDSD",41,0)
 . S INFOTYPE=INFOTYPE_"PRV"
"RTN","PXRRFDSD",42,0)
 ;
"RTN","PXRRFDSD",43,0)
 ;Check for a user request to stop the task.
"RTN","PXRRFDSD",44,0)
 I $$S^%ZTLOAD S ZTSTOP=1 D EXIT^PXRRFDD
"RTN","PXRRFDSD",45,0)
 ;
"RTN","PXRRFDSD",46,0)
 S VACODE=""
"RTN","PXRRFDSD",47,0)
PCLASS S VACODE=$O(^XTMP(PXRRXTMP,"ENCTR",FACILITY,PNAME,VACODE))
"RTN","PXRRFDSD",48,0)
 I VACODE="" G PRV
"RTN","PXRRFDSD",49,0)
 I ($L(VACODE)>1)&(+VACODE=0)&(INFOTYPE'["PC") D
"RTN","PXRRFDSD",50,0)
 . S INFOTYPE=INFOTYPE_"PC"
"RTN","PXRRFDSD",51,0)
 ;
"RTN","PXRRFDSD",52,0)
 S HLOC=""
"RTN","PXRRFDSD",53,0)
LOC S HLOC=$O(^XTMP(PXRRXTMP,"ENCTR",FACILITY,PNAME,VACODE,HLOC))
"RTN","PXRRFDSD",54,0)
 I HLOC="" G PCLASS
"RTN","PXRRFDSD",55,0)
 ;The location is stored in the form NAME_U_STOP CODE
"RTN","PXRRFDSD",56,0)
 I ($L(HLOC)>1)&(+$P(HLOC,U,2)>0)&(INFOTYPE'["LOC") D
"RTN","PXRRFDSD",57,0)
 . S INFOTYPE=INFOTYPE_"LOC"
"RTN","PXRRFDSD",58,0)
 ;
"RTN","PXRRFDSD",59,0)
 S STOIND=STOIND+1
"RTN","PXRRFDSD",60,0)
 S ^XTMP(PXRRXTMP,"INFO",INFOTYPE,FACILITY,PNAME,VACODE,HLOC)=STOIND
"RTN","PXRRFDSD",61,0)
 ;
"RTN","PXRRFDSD",62,0)
 S VIEN=""
"RTN","PXRRFDSD",63,0)
ENC S VIEN=$O(^XTMP(PXRRXTMP,"ENCTR",FACILITY,PNAME,VACODE,HLOC,VIEN))
"RTN","PXRRFDSD",64,0)
 I (VIEN="")!(VIEN=0) G LOC
"RTN","PXRRFDSD",65,0)
 ;Count the encounters
"RTN","PXRRFDSD",66,0)
 I '$D(ENCTOT(STOIND)) S ENCTOT(STOIND)=1
"RTN","PXRRFDSD",67,0)
 E  S ENCTOT(STOIND)=ENCTOT(STOIND)+1
"RTN","PXRRFDSD",68,0)
 ;
"RTN","PXRRFDSD",69,0)
 ;If this is an interactive session let the user know that something
"RTN","PXRRFDSD",70,0)
 ;is happening.
"RTN","PXRRFDSD",71,0)
 I '(PXRRQUE!$D(IO("S"))) D SPIN^PXRRBUSY("Sorting diagnoses",.BUSY)
"RTN","PXRRFDSD",72,0)
 ;
"RTN","PXRRFDSD",73,0)
 ;Initialize the diagnosis counters.
"RTN","PXRRFDSD",74,0)
 I '$D(DIAGTOT(STOIND)) S DIAGTOT(STOIND)=0
"RTN","PXRRFDSD",75,0)
 I '$D(DGTOT10(STOIND)) S DGTOT10(STOIND)=0  ; keep track of ICD10s also
"RTN","PXRRFDSD",76,0)
 ;
"RTN","PXRRFDSD",77,0)
 ;Get the diagnoses associated with this VIEN.
"RTN","PXRRFDSD",78,0)
 S POVIEN=""
"RTN","PXRRFDSD",79,0)
DIAG S POVIEN=$O(^AUPNVPOV("AD",VIEN,POVIEN))
"RTN","PXRRFDSD",80,0)
 I POVIEN="" G ENC
"RTN","PXRRFDSD",81,0)
 S POV=^AUPNVPOV(POVIEN,0)
"RTN","PXRRFDSD",82,0)
 ;
"RTN","PXRRFDSD",83,0)
 ;Apply the primary/secondary screen.  If this field does not contain P
"RTN","PXRRFDSD",84,0)
 ;then we take it to be secondary.
"RTN","PXRRFDSD",85,0)
 I PRIMARY I $P(POV,U,12)'="P" G DIAG
"RTN","PXRRFDSD",86,0)
 ;
"RTN","PXRRFDSD",87,0)
 ;Count the ICD9 entries.
"RTN","PXRRFDSD",88,0)
 S ICD9IEN=$P(POV,U,1)
"RTN","PXRRFDSD",89,0)
 S PXDXDATE=$$CSDATE^PXDXUTL(VIEN)
"RTN","PXRRFDSD",90,0)
 S ICDDATA=$$ICDDATA^ICDXCODE("DIAG",ICD9IEN,PXDXDATE,"I"),ICDTYP=$P(ICDDATA,U,20)
"RTN","PXRRFDSD",91,0)
 I ICDTYP="30" G DIAG2
"RTN","PXRRFDSD",92,0)
 I '$D(^TMP(PXRRXTMP,$J,"DIAG",STOIND,"ICD9",ICD9IEN)) S ^TMP(PXRRXTMP,$J,"DIAG",STOIND,"ICD9",ICD9IEN)=1
"RTN","PXRRFDSD",93,0)
 E  S ^TMP(PXRRXTMP,$J,"DIAG",STOIND,"ICD9",ICD9IEN)=^TMP(PXRRXTMP,$J,"DIAG",STOIND,"ICD9",ICD9IEN)+1
"RTN","PXRRFDSD",94,0)
 S DIAGTOT(STOIND)=DIAGTOT(STOIND)+1
"RTN","PXRRFDSD",95,0)
 G DIAG3
"RTN","PXRRFDSD",96,0)
DIAG2 I '$D(^TMP(PXRRXTMP,$J,"DIAG",STOIND,"ICD10",ICD9IEN)) S ^TMP(PXRRXTMP,$J,"DIAG",STOIND,"ICD10",ICD9IEN)=1
"RTN","PXRRFDSD",97,0)
 E  S ^TMP(PXRRXTMP,$J,"DIAG",STOIND,"ICD10",ICD9IEN)=^TMP(PXRRXTMP,$J,"DIAG",STOIND,"ICD10",ICD9IEN)+1
"RTN","PXRRFDSD",98,0)
 S DGTOT10(STOIND)=DGTOT10(STOIND)+1
"RTN","PXRRFDSD",99,0)
DIAG3 ;
"RTN","PXRRFDSD",100,0)
 ;Count the diagnostic categories.
"RTN","PXRRFDSD",101,0)
 ;This will probably require a DBIA.
"RTN","PXRRFDSD",102,0)
 ;S DCIEN=$P(^ICD9(ICD9IEN,0),U,5)
"RTN","PXRRFDSD",103,0)
 S DCIEN=$P(ICDDATA,U,6)
"RTN","PXRRFDSD",104,0)
 I DCIEN'>0 S DCIEN=0
"RTN","PXRRFDSD",105,0)
 G:ICDTYP="30" DIAG4
"RTN","PXRRFDSD",106,0)
 I '$D(^TMP(PXRRXTMP,$J,"DIAG",STOIND,"DC",DCIEN)) S ^TMP(PXRRXTMP,$J,"DIAG",STOIND,"DC",DCIEN)=1
"RTN","PXRRFDSD",107,0)
 E  S ^TMP(PXRRXTMP,$J,"DIAG",STOIND,"DC",DCIEN)=^TMP(PXRRXTMP,$J,"DIAG",STOIND,"DC",DCIEN)+1
"RTN","PXRRFDSD",108,0)
 G DIAG
"RTN","PXRRFDSD",109,0)
DIAG4 I '$D(^TMP(PXRRXTMP,$J,"DIAG",STOIND,"DC10",DCIEN)) S ^TMP(PXRRXTMP,$J,"DIAG",STOIND,"DC10",DCIEN)=1
"RTN","PXRRFDSD",110,0)
 E  S ^TMP(PXRRXTMP,$J,"DIAG",STOIND,"DC10",DCIEN)=^TMP(PXRRXTMP,$J,"DIAG",STOIND,"DC10",DCIEN)+1
"RTN","PXRRFDSD",111,0)
 ;
"RTN","PXRRFDSD",112,0)
 G DIAG
"RTN","PXRRFDSD",113,0)
 ;
"RTN","PXRRFDSD",114,0)
SETPR ;Rearrange the information for printing.
"RTN","PXRRFDSD",115,0)
 S STOIND=""
"RTN","PXRRFDSD",116,0)
NEXTSTO S STOIND=$O(^TMP(PXRRXTMP,$J,"DIAG",STOIND))
"RTN","PXRRFDSD",117,0)
 I STOIND="" G EXIT
"RTN","PXRRFDSD",118,0)
 I '(PXRRQUE!$D(IO("S"))) D SPIN^PXRRBUSY("Sorting diagnoses",.BUSY)
"RTN","PXRRFDSD",119,0)
 ;
"RTN","PXRRFDSD",120,0)
 S ICD9IEN=""
"RTN","PXRRFDSD",121,0)
NEXTIC S ICD9IEN=$O(^TMP(PXRRXTMP,$J,"DIAG",STOIND,"ICD9",ICD9IEN))
"RTN","PXRRFDSD",122,0)
 I ICD9IEN="" G STDC
"RTN","PXRRFDSD",123,0)
 S COUNT=^TMP(PXRRXTMP,$J,"DIAG",STOIND,"ICD9",ICD9IEN)
"RTN","PXRRFDSD",124,0)
 S DIAGTOT=DIAGTOT+COUNT
"RTN","PXRRFDSD",125,0)
 S ^XTMP(PXRRXTMP,"PRINT",STOIND,"ICD9",COUNT,ICD9IEN)="DIAG"_ICD9IEN
"RTN","PXRRFDSD",126,0)
 G NEXTIC
"RTN","PXRRFDSD",127,0)
 ;
"RTN","PXRRFDSD",128,0)
 ;
"RTN","PXRRFDSD",129,0)
STDC S DCIEN=""
"RTN","PXRRFDSD",130,0)
NEXTDC S DCIEN=$O(^TMP(PXRRXTMP,$J,"DIAG",STOIND,"DC",DCIEN))
"RTN","PXRRFDSD",131,0)
 I DCIEN="" G NXTIC10
"RTN","PXRRFDSD",132,0)
 S COUNT=^TMP(PXRRXTMP,$J,"DIAG",STOIND,"DC",DCIEN)
"RTN","PXRRFDSD",133,0)
 S ^XTMP(PXRRXTMP,"PRINT",STOIND,"DC",COUNT,DCIEN)=""
"RTN","PXRRFDSD",134,0)
 G NEXTDC
"RTN","PXRRFDSD",135,0)
 ;
"RTN","PXRRFDSD",136,0)
NXTIC10 S ICD9IEN=""
"RTN","PXRRFDSD",137,0)
NEXTIC10 ;
"RTN","PXRRFDSD",138,0)
 S ICD9IEN=$O(^TMP(PXRRXTMP,$J,"DIAG",STOIND,"ICD10",ICD9IEN))
"RTN","PXRRFDSD",139,0)
 I ICD9IEN="" G STDC10
"RTN","PXRRFDSD",140,0)
 S COUNT=^TMP(PXRRXTMP,$J,"DIAG",STOIND,"ICD10",ICD9IEN)
"RTN","PXRRFDSD",141,0)
 S DGTOT10=DGTOT10+COUNT
"RTN","PXRRFDSD",142,0)
 S ^XTMP(PXRRXTMP,"PRINT",STOIND,"ICD10",COUNT,ICD9IEN)="DIAG"_ICD9IEN
"RTN","PXRRFDSD",143,0)
 G NEXTIC10
"RTN","PXRRFDSD",144,0)
 ;
"RTN","PXRRFDSD",145,0)
 ;
"RTN","PXRRFDSD",146,0)
STDC10 S DCIEN=""
"RTN","PXRRFDSD",147,0)
NEXTDC10 ;
"RTN","PXRRFDSD",148,0)
 S DCIEN=$O(^TMP(PXRRXTMP,$J,"DIAG",STOIND,"DC10",DCIEN))
"RTN","PXRRFDSD",149,0)
 I DCIEN="" G NEXTSTO
"RTN","PXRRFDSD",150,0)
 S COUNT=^TMP(PXRRXTMP,$J,"DIAG",STOIND,"DC10",DCIEN)
"RTN","PXRRFDSD",151,0)
 S ^XTMP(PXRRXTMP,"PRINT",STOIND,"DC10",COUNT,DCIEN)=""
"RTN","PXRRFDSD",152,0)
 G NEXTDC10
"RTN","PXRRFDSD",153,0)
 ;
"RTN","PXRRFDSD",154,0)
EXIT ;
"RTN","PXRRFDSD",155,0)
 ;Kill the arrays we are done with.
"RTN","PXRRFDSD",156,0)
 K ^TMP(PXRRXTMP,$J,"DIAG")
"RTN","PXRRFDSD",157,0)
 K ^XTMP(PXRRXTMP,"ENCTR")
"RTN","PXRRFDSD",158,0)
 ;
"RTN","PXRRFDSD",159,0)
 S STOIND=""
"RTN","PXRRFDSD",160,0)
 F  S STOIND=$O(ENCTOT(STOIND)) Q:STOIND=""  D
"RTN","PXRRFDSD",161,0)
 . S ^XTMP(PXRRXTMP,"TOTALS","DIAGTOT",STOIND)=DIAGTOT(STOIND)
"RTN","PXRRFDSD",162,0)
 . S ^XTMP(PXRRXTMP,"TOTALS","DGTOT10",STOIND)=DGTOT10(STOIND)
"RTN","PXRRFDSD",163,0)
 . S ^XTMP(PXRRXTMP,"TOTALS","ENCTOT",STOIND)=ENCTOT(STOIND)
"RTN","PXRRFDSD",164,0)
 ;
"RTN","PXRRFDSD",165,0)
 I '(PXRRQUE!$D(IO("S"))) D DONE^PXRRBUSY("done")
"RTN","PXRRFDSD",166,0)
 ;
"RTN","PXRRFDSD",167,0)
 ;Print the report.
"RTN","PXRRFDSD",168,0)
 I PXRRQUE D
"RTN","PXRRFDSD",169,0)
 . N DESC,ROUTINE,TASK
"RTN","PXRRFDSD",170,0)
 . S DESC="Frequency of diagnosis report - print"
"RTN","PXRRFDSD",171,0)
 . S ROUTINE="PXRRFDP"
"RTN","PXRRFDSD",172,0)
 . S TASK=^XTMP(PXRRXTMP,"PRZTSK")
"RTN","PXRRFDSD",173,0)
 . S ZTDTH=$$NOW^XLFDT
"RTN","PXRRFDSD",174,0)
 . S ZTSAVE("DIAGTOT")="",ZTSAVE("DGTOT10")=""  ; FIX UNDEF IN PXRRFDP
"RTN","PXRRFDSD",175,0)
 . D REQUE^PXRRQUE(DESC,ROUTINE,TASK)
"RTN","PXRRFDSD",176,0)
 E  D ^PXRRFDP
"RTN","PXRRFDSD",177,0)
 ;
"RTN","PXRRFDSD",178,0)
 Q
"RTN","PXRRMDR")
0^43^B38033243^B37941513
"RTN","PXRRMDR",1,0)
PXRRMDR ;BP/WLC - PCE Missing Data Report ;11 Feb 04  10:10 AM
"RTN","PXRRMDR",2,0)
 ;;1.0;PCE PATIENT CARE ENCOUNTER;**124,174,168,199**;FEB 11, 2004;Build 51
"RTN","PXRRMDR",3,0)
 ; 04/11/05 WLC changed to check for AO, IR and EC, only if SC'=YES
"RTN","PXRRMDR",4,0)
 Q
"RTN","PXRRMDR",5,0)
 ;
"RTN","PXRRMDR",6,0)
EN N DIR,%DT,DT,DTOUT,DUOUT,CBU,CNT,EDT,LOC,PAT,POP,PRIO,PROV,PX,PXDS,PXDT
"RTN","PXRRMDR",7,0)
 N PXLOC,PXPAGE,PXPROV,RPTYP,SDDIV,SORT,SORTHDR,SSN,TY,VDT,X,Y,ZTSAVE
"RTN","PXRRMDR",8,0)
 S (POP,PXPAGE)=0
"RTN","PXRRMDR",9,0)
 K PXDS
"RTN","PXRRMDR",10,0)
 D HOME^%ZIS S:'$D(IOF) IOF=FF W @IOF,!!
"RTN","PXRRMDR",11,0)
 S X=$$CTR("PCE Missing Data Report")
"RTN","PXRRMDR",12,0)
 W !! D DATASRC^PXRRMDR1 G:POP EXIT   ; sets PXDS() PX*1.0*174
"RTN","PXRRMDR",13,0)
 W @IOF,!! S X=$$CTR("**** Date Range Selection ****")
"RTN","PXRRMDR",14,0)
 W !!! S %DT="AEPX",%DT("A")="Beginning date: " D ^%DT G:Y<1 EXIT S PX("BDT")=Y
"RTN","PXRRMDR",15,0)
EDT S %DT("A")="   Ending date: " W ! D ^%DT G:Y<1 EXIT
"RTN","PXRRMDR",16,0)
 I Y<PX("BDT") W !!,$C(7),"End date cannot be before begin date!",! G EDT
"RTN","PXRRMDR",17,0)
 S PX("EDT")=Y_.999999
"RTN","PXRRMDR",18,0)
 W @IOF,!! S X=$$CTR("*** Report Sort Selection ***")
"RTN","PXRRMDR",19,0)
 W !!! K DIR S SORTHDR="DATA SOURCE^CPT^DIAGNOSIS^PATIENT^ELIGIBILITY"
"RTN","PXRRMDR",20,0)
 F LOOP=1:1:$L(SORTHDR,U) S DESC=$P(SORTHDR,U,LOOP) W !,"("_LOOP_")  "_DESC
"RTN","PXRRMDR",21,0)
 W ! S DIR(0)="N^^I X<1!(X>5) K X",DIR("A")="Enter number between 1 and 5" D ^DIR Q:$D(DIRUT)  S PXSRT=+X
"RTN","PXRRMDR",22,0)
 S DIR(0)="S^D:DETAILED REPORT;S:STATISTICS ONLY",DIR("A")="Select report type",DIR("B")="DETAILED REPORT" D ^DIR Q:$D(DIRUT)
"RTN","PXRRMDR",23,0)
 S RPTYP=Y
"RTN","PXRRMDR",24,0)
 W !!,"This report requires 132 column output.",!
"RTN","PXRRMDR",25,0)
 S %ZIS="QM" D ^%ZIS Q:POP
"RTN","PXRRMDR",26,0)
 I $D(IO("Q")) D  G EXIT
"RTN","PXRRMDR",27,0)
 . S ZTRTN="RUN^PXRRMDR",ZTDESC="PCE MISSING DATA REPORT"
"RTN","PXRRMDR",28,0)
 . S ZTSAVE("PX*")=""
"RTN","PXRRMDR",29,0)
 . S ZTSAVE("RPTYP")="",ZTSAVE("SORTHDR")=""
"RTN","PXRRMDR",30,0)
 . D ^%ZTLOAD W !!,$S($D(ZTSK):"This job has been queued.  The task number is "_ZTSK_".",1:"Unable to queue this job.")
"RTN","PXRRMDR",31,0)
 .K ZTSK,IO("Q"),ZTSAVE D HOME^%ZIS
"RTN","PXRRMDR",32,0)
 ;
"RTN","PXRRMDR",33,0)
RUN ;
"RTN","PXRRMDR",34,0)
 U IO
"RTN","PXRRMDR",35,0)
 K ^TMP("PXCRPW",$J),DIR S (PXOUT)=""
"RTN","PXRRMDR",36,0)
 N LOOP,PXDT,I,VSN,VISITS,CLASSIF
"RTN","PXRRMDR",37,0)
 S PXDT=(PX("BDT")-1)_.99999 K ^TMP("PXCRPW",$J)
"RTN","PXRRMDR",38,0)
 F  S PXDT=$O(^AUPNVSIT("ADEL",PXDT)) Q:PXDT>PX("EDT")!('PXDT)  D
"RTN","PXRRMDR",39,0)
 . S VSN=0 F  S VSN=$O(^AUPNVSIT("ADEL",PXDT,VSN)) Q:'VSN  D
"RTN","PXRRMDR",40,0)
 . . S VISITS=$P($G(^AUPNVSIT(VSN,812)),U,3) S:VISITS="" VISITS="Unknown"
"RTN","PXRRMDR",41,0)
 . . Q:'$D(PXDS(VISITS))
"RTN","PXRRMDR",42,0)
 . . D ENCEVENT^PXKENC(VSN,0)
"RTN","PXRRMDR",43,0)
 . . Q:$P($G(^TMP("PXKENC",$J,VSN,"VST",VSN,0)),U,7)="E"  ;Historic encounter PX*1.0*174
"RTN","PXRRMDR",44,0)
 . . Q:$$TESTPAT^VADPT($P($G(^TMP("PXKENC",$J,VSN,"VST",VSN,0)),U,5))  ;Test patient PX*1.0*174
"RTN","PXRRMDR",45,0)
 . . N OE S OE=$O(^SCE("AVSIT",VSN,0)) Q:'OE  Q:$P(^SCE(OE,0),U,6)]""  Q:$P(^SCE(OE,0),U,12)=12  ;Check if a child encounter, non-count  PX*1.0*174
"RTN","PXRRMDR",46,0)
 . . I '$D(^TMP("PXKENC",$J,VSN,"CPT")) D SET("Visit is missing a Procedure Code",1) Q
"RTN","PXRRMDR",47,0)
 . . I $$EXOE^SDCOU2(OE) Q  ;Determine if Encounter is Exempt from Outpatient Classifications and Diagnoses PX*1.0*174
"RTN","PXRRMDR",48,0)
 . . N I,J S (I,CNT)=0 F  S I=$O(^TMP("PXKENC",$J,VSN,"CPT",I)) Q:'I  D
"RTN","PXRRMDR",49,0)
 . . . S CNT=0 F J=5,9,10,11,12,13,14,15 I $P(^TMP("PXKENC",$J,VSN,"CPT",I,0),U,J) S CNT=CNT+1
"RTN","PXRRMDR",50,0)
 . . . I CNT=0 D SET("Procedure: "_$$DISPLYP($P(^TMP("PXKENC",$J,VSN,"CPT",I,0),U))_" missing assoc. DXs",1)
"RTN","PXRRMDR",51,0)
 . . S (I,J)=0 F  S I=$O(^TMP("PXKENC",$J,VSN,"POV",I)) Q:'I  D
"RTN","PXRRMDR",52,0)
 . . . K CLASSIF S DFN=$$GET1^DIQ(9000010,VSN_",",.05,"I")
"RTN","PXRRMDR",53,0)
 . . . I $$AO^SDCO22(DFN) S CLASSIF(1)=""
"RTN","PXRRMDR",54,0)
 . . . I $$IR^SDCO22(DFN) S CLASSIF(2)=""
"RTN","PXRRMDR",55,0)
 . . . I $$SC^SDCO22(DFN) S CLASSIF(3)=""
"RTN","PXRRMDR",56,0)
 . . . I $$EC^SDCO22(DFN) S CLASSIF(4)=""
"RTN","PXRRMDR",57,0)
 . . . I $$MST^SDCO22(DFN) S CLASSIF(5)=""
"RTN","PXRRMDR",58,0)
 . . . I $$HNC^SDCO22(DFN) S CLASSIF(6)=""
"RTN","PXRRMDR",59,0)
 . . . I +$P($$CVEDT^DGCV(DFN,PXDT),"^",3) S CLASSIF(7)=""
"RTN","PXRRMDR",60,0)
 . . . I $$SHAD^SDCO22(DFN) S CLASSIF(8)=""
"RTN","PXRRMDR",61,0)
 . . . I $D(CLASSIF),'$D(^TMP("PXKENC",$J,VSN,"POV",I,800)) D SET($$DISPLYDX($P(^TMP("PXKENC",$J,VSN,"POV",I,0),U))_" missing SC/EI",1) Q
"RTN","PXRRMDR",62,0)
 . . . S J="" F  S J=$O(CLASSIF(J)) Q:'J  D
"RTN","PXRRMDR",63,0)
 . . . . N SCEIREC S SCEIREC=$G(^TMP("PXKENC",$J,VSN,"POV",I,800))
"RTN","PXRRMDR",64,0)
 . . . . I J=3&($P(SCEIREC,U,1)="") D SET($$DISPLYDX($P(^TMP("PXKENC",$J,VSN,"POV",I,0),U))_" missing Service Connect.",1)
"RTN","PXRRMDR",65,0)
 . . . . I J=1&($P(SCEIREC,U,2)="")&($P(SCEIREC,U,1)'=1) D SET($$DISPLYDX($P(^TMP("PXKENC",$J,VSN,"POV",I,0),U))_" missing Agent Orange",3)
"RTN","PXRRMDR",66,0)
 . . . . I J=2&($P(SCEIREC,U,3)="")&($P(SCEIREC,U,1)'=1) D SET($$DISPLYDX($P(^TMP("PXKENC",$J,VSN,"POV",I,0),U))_" missing Ion. Rad.",4)
"RTN","PXRRMDR",67,0)
 . . . . I J=4&($P(SCEIREC,U,4)="")&($P(SCEIREC,U,1)'=1) D SET($$DISPLYDX($P(^TMP("PXKENC",$J,VSN,"POV",I,0),U))_" missing Env. Contam.",5)
"RTN","PXRRMDR",68,0)
 . . . . I J=5&($P(SCEIREC,U,5)="") D SET($$DISPLYDX($P(^TMP("PXKENC",$J,VSN,"POV",I,0),U))_" missing MST",6)
"RTN","PXRRMDR",69,0)
 . . . . I J=6&($P(SCEIREC,U,6)="") D SET($$DISPLYDX($P(^TMP("PXKENC",$J,VSN,"POV",I,0),U))_" missing Head/Neck Cancer",6)
"RTN","PXRRMDR",70,0)
 . . . . I J=7&($P(SCEIREC,U,7)="") D SET($$DISPLYDX($P(^TMP("PXKENC",$J,VSN,"POV",I,0),U))_" missing Combat Vet",2)
"RTN","PXRRMDR",71,0)
 . . . . I J=8&($P(SCEIREC,U,8)="") D SET($$DISPLYDX($P(^TMP("PXKENC",$J,VSN,"POV",I,0),U))_" missing Project 112/SHAD",6)
"RTN","PXRRMDR",72,0)
 U IO D PRINT^PXRRMDR1,^%ZISC
"RTN","PXRRMDR",73,0)
 K ^TMP("PXCRPW",$J)
"RTN","PXRRMDR",74,0)
EXIT Q
"RTN","PXRRMDR",75,0)
 ;
"RTN","PXRRMDR",76,0)
STOP ;Check for stop task request
"RTN","PXRRMDR",77,0)
 S:$G(ZTQUEUED) (PXOUT,ZTSTOP)=$S($$S^%ZTLOAD:1,1:0)
"RTN","PXRRMDR",78,0)
 Q
"RTN","PXRRMDR",79,0)
 ;
"RTN","PXRRMDR",80,0)
EVAL ;
"RTN","PXRRMDR",81,0)
 S PXLOC=$$GET1^DIQ(9000010,VSN_",",.22)
"RTN","PXRRMDR",82,0)
 S:$G(PXLOC)="" PXLOC="Unknown"
"RTN","PXRRMDR",83,0)
 N PXPTR S PXPTR=$O(^AUPNVPRV("AD",VSN,""))
"RTN","PXRRMDR",84,0)
 S PXPRV=$$GET1^DIQ(9000010.06,PXPTR_",",.01)
"RTN","PXRRMDR",85,0)
 S:$G(PRPRV)="" PXPRV="Unknown"
"RTN","PXRRMDR",86,0)
 Q
"RTN","PXRRMDR",87,0)
 ;
"RTN","PXRRMDR",88,0)
DISPLYDX(PXCEPOV) ;
"RTN","PXRRMDR",89,0)
 N ICDSTR
"RTN","PXRRMDR",90,0)
 S ICDSTR=$$ICDDATA^ICDXCODE("DIAG",$P(PXCEPOV,"^"),$$CSDATE^PXDXUTL(VSN),"I")
"RTN","PXRRMDR",91,0)
 Q $S($P(ICDSTR,"^",20)="30":"ICD10",1:"ICD9")_": "_$P(ICDSTR,"^",2) ;code
"RTN","PXRRMDR",92,0)
 ;
"RTN","PXRRMDR",93,0)
DISPLYP(PXCECPT) ;
"RTN","PXRRMDR",94,0)
 N CPTSTR
"RTN","PXRRMDR",95,0)
 S CPTSTR=$$CPT^ICPTCOD($P(PXCECPT,U),$P(^AUPNVSIT(VSN,0),"^"))
"RTN","PXRRMDR",96,0)
 Q $P(CPTSTR,U,2) ;code
"RTN","PXRRMDR",97,0)
 ;
"RTN","PXRRMDR",98,0)
SET(SDX,PRIO) ;
"RTN","PXRRMDR",99,0)
 N A1
"RTN","PXRRMDR",100,0)
 S PRIO=$G(PRIO)
"RTN","PXRRMDR",101,0)
 D EVAL
"RTN","PXRRMDR",102,0)
 I PXSRT="" S A1="Unknown" D SET1(PRIO) Q
"RTN","PXRRMDR",103,0)
 D @PXSRT
"RTN","PXRRMDR",104,0)
 Q
"RTN","PXRRMDR",105,0)
 ;
"RTN","PXRRMDR",106,0)
1 ; Data Source
"RTN","PXRRMDR",107,0)
 S A1=$$GET1^DIQ(9000010,VSN_",",81203)
"RTN","PXRRMDR",108,0)
 S:A1="" A1=" "
"RTN","PXRRMDR",109,0)
 D SET1(PRIO)
"RTN","PXRRMDR",110,0)
 Q
"RTN","PXRRMDR",111,0)
 ;
"RTN","PXRRMDR",112,0)
2 ; CPT
"RTN","PXRRMDR",113,0)
 N CPT,CPT1
"RTN","PXRRMDR",114,0)
 S CPT=$O(^AUPNVCPT("AD",VSN,""))
"RTN","PXRRMDR",115,0)
 S:CPT'="" CPT1=$$GET1^DIQ(9000010.18,CPT_",",.01)
"RTN","PXRRMDR",116,0)
 S A1=$G(CPT1) D SET1(PRIO)
"RTN","PXRRMDR",117,0)
 Q
"RTN","PXRRMDR",118,0)
 ;
"RTN","PXRRMDR",119,0)
3 ; ICD
"RTN","PXRRMDR",120,0)
 N ICD,ICDCD,ICDDATA S ICD="",ICDCD="Unknown"
"RTN","PXRRMDR",121,0)
 F  S ICD=$O(^AUPNVPOV("AD",VSN,ICD)) Q:'ICD  D
"RTN","PXRRMDR",122,0)
 . S ICDCD=$$GET1^DIQ(9000010.07,ICD,.01)
"RTN","PXRRMDR",123,0)
 . S ICDDATA=$$ICDDATA^ICDXCODE("DIAG",ICDCD,$$CSDATE^PXDXUTL(VSN),"E")
"RTN","PXRRMDR",124,0)
 S A1=$S(ICDCD="Unknown":ICDCD,1:$P(ICDDATA,U,2)_"_"_$P(ICDDATA,U,20))
"RTN","PXRRMDR",125,0)
 D SET1(PRIO)
"RTN","PXRRMDR",126,0)
 Q
"RTN","PXRRMDR",127,0)
 ;
"RTN","PXRRMDR",128,0)
4 S A1=$$GET1^DIQ(9000010,VSN_",",.05)
"RTN","PXRRMDR",129,0)
 S:A1="" A1="Unknown"
"RTN","PXRRMDR",130,0)
 D SET1(PRIO)
"RTN","PXRRMDR",131,0)
 Q
"RTN","PXRRMDR",132,0)
 ;
"RTN","PXRRMDR",133,0)
5 ; Eligibility
"RTN","PXRRMDR",134,0)
 S A1=$$GET1^DIQ(9000010,VSN_",",.21)
"RTN","PXRRMDR",135,0)
 S:A1="" A1="Unknown"
"RTN","PXRRMDR",136,0)
 D SET1(PRIO)
"RTN","PXRRMDR",137,0)
 Q
"RTN","PXRRMDR",138,0)
 ;
"RTN","PXRRMDR",139,0)
6 ; Default Sort
"RTN","PXRRMDR",140,0)
 S A1="Default" D SET1(PRIO)
"RTN","PXRRMDR",141,0)
 Q
"RTN","PXRRMDR",142,0)
 ;
"RTN","PXRRMDR",143,0)
SET1(PR) ; set temp global
"RTN","PXRRMDR",144,0)
 I A1="" S A1="Unknown"
"RTN","PXRRMDR",145,0)
 S Y=$$GET1^DIQ(9000010,VSN_",",.01) X ^DD("DD") S VDT=Y
"RTN","PXRRMDR",146,0)
 S:VDT="" VDT="Unknown" S VDT=$P(VDT,"@",1)
"RTN","PXRRMDR",147,0)
 S ^TMP("PXCRPW",$J,PXLOC,PXPRV,A1,VDT,VSN,PR,SDX)=VSN
"RTN","PXRRMDR",148,0)
 Q
"RTN","PXRRMDR",149,0)
CTR(X) ;
"RTN","PXRRMDR",150,0)
 W ?(IOM-$L(X))\2,X
"RTN","PXRRMDR",151,0)
 Q 1
"RTN","PXRRMDR",152,0)
 ;
"RTN","PXRRMDR1")
0^44^B20723539^B19546467
"RTN","PXRRMDR1",1,0)
PXRRMDR1 ;HERN/BDB - PCE Missing Data Report ;11 Feb 04  10:10 AM
"RTN","PXRRMDR1",2,0)
 ;;1.0;PCE PATIENT CARE ENCOUNTER;**174,168,199**;AUG 12, 1996;Build 51
"RTN","PXRRMDR1",3,0)
 ;
"RTN","PXRRMDR1",4,0)
DATASRC ; get Data Sources to print
"RTN","PXRRMDR1",5,0)
 N ID,REC
"RTN","PXRRMDR1",6,0)
 K PXDS
"RTN","PXRRMDR1",7,0)
 K DIR,DIC
"RTN","PXRRMDR1",8,0)
 S DIR(0)="Y",DIR("A")="Would you like to include ALL Data Sources"
"RTN","PXRRMDR1",9,0)
 S DIR("B")="YES" D ^DIR
"RTN","PXRRMDR1",10,0)
 I $D(DIRUT) S POP=1 Q
"RTN","PXRRMDR1",11,0)
 I Y D
"RTN","PXRRMDR1",12,0)
 . S ID="" F  S ID=$O(^PX(839.7,"B",ID)) Q:ID=""  D
"RTN","PXRRMDR1",13,0)
 . . S REC="" F  S REC=$O(^PX(839.7,"B",ID,REC)) Q:REC=""  D
"RTN","PXRRMDR1",14,0)
 . . . S PXDS(REC)=ID
"RTN","PXRRMDR1",15,0)
 . S PXDS("Unknown")=0
"RTN","PXRRMDR1",16,0)
 E  D
"RTN","PXRRMDR1",17,0)
 . S DIC=839.7,DIC(0)="QEAMZ",DIC("A")="Enter Data Source:  "
"RTN","PXRRMDR1",18,0)
 . F  D ^DIC Q:$D(DTOUT)!($D(DUOUT))!(Y=-1)  S:+Y PXDS(+Y)=""
"RTN","PXRRMDR1",19,0)
 I $D(DTOUT)!($D(DUOUT)) S POP=1
"RTN","PXRRMDR1",20,0)
 Q
"RTN","PXRRMDR1",21,0)
 ;
"RTN","PXRRMDR1",22,0)
PRINT ; Print Report
"RTN","PXRRMDR1",23,0)
 N A,I,REC,TOT,TOTE,Y,SHDR
"RTN","PXRRMDR1",24,0)
 N PAT,SSN,SSND,TYP,VIN,DEFD,ENCD
"RTN","PXRRMDR1",25,0)
 K TOT,TOTE
"RTN","PXRRMDR1",26,0)
 S DEFD="TOTAL DEFECTS FOR ",ENCD="TOTAL ENCOUNTERS FOR "
"RTN","PXRRMDR1",27,0)
 S (TOT(1),TOTE(1))=0
"RTN","PXRRMDR1",28,0)
 S LOC="" F  S LOC=$O(^TMP("PXCRPW",$J,LOC)),HDR=0 Q:LOC=""!(POP)  D
"RTN","PXRRMDR1",29,0)
 . S (TOT(2),TOTE(2))=0
"RTN","PXRRMDR1",30,0)
 . S PROV="" F  S PROV=$O(^TMP("PXCRPW",$J,LOC,PROV)) Q:PROV=""!(POP)  D
"RTN","PXRRMDR1",31,0)
 . . S (TOT(3),TOTE(3))=0
"RTN","PXRRMDR1",32,0)
 . . S SORT="" F  S SORT=$O(^TMP("PXCRPW",$J,LOC,PROV,SORT)) Q:SORT=""!(POP)  D
"RTN","PXRRMDR1",33,0)
 . . . S (TOT(4),TOTE(4))=0
"RTN","PXRRMDR1",34,0)
 . . . S VDT="" F  S VDT=$O(^TMP("PXCRPW",$J,LOC,PROV,SORT,VDT)) Q:VDT=""!(POP)  D
"RTN","PXRRMDR1",35,0)
 . . . . S (TOT(5),TOTE(5))=0
"RTN","PXRRMDR1",36,0)
 . . . . S VIN="" F  S VIN=$O(^TMP("PXCRPW",$J,LOC,PROV,SORT,VDT,VIN)),HDR1=0 Q:VIN=""!(POP)  D
"RTN","PXRRMDR1",37,0)
 . . . . . S TOT(6)=0
"RTN","PXRRMDR1",38,0)
 . . . . . S TOTE(5)=TOTE(5)+1
"RTN","PXRRMDR1",39,0)
 . . . . . S PR="" F  S PR=$O(^TMP("PXCRPW",$J,LOC,PROV,SORT,VDT,VIN,PR)) Q:PR=""  D
"RTN","PXRRMDR1",40,0)
 . . . . . . S SHDR=0
"RTN","PXRRMDR1",41,0)
 . . . . . . S SDX="" F  S SDX=$O(^TMP("PXCRPW",$J,LOC,PROV,SORT,VDT,VIN,PR,SDX)) Q:SDX=""!(POP)  D
"RTN","PXRRMDR1",42,0)
 . . . . . . . S REC=^TMP("PXCRPW",$J,LOC,PROV,SORT,VDT,VIN,PR,SDX)
"RTN","PXRRMDR1",43,0)
 . . . . . . . S PAT=$$GET1^DIQ(9000010,REC_",",.05)
"RTN","PXRRMDR1",44,0)
 . . . . . . . S SSN=$$GET1^DIQ(2,$$GET1^DIQ(9000010,REC_",",.05,"I"),.09)
"RTN","PXRRMDR1",45,0)
 . . . . . . . S SSND=$E(SSN,1,3)_"-"_$E(SSN,4,5)_"-"_$E(SSN,6,9)
"RTN","PXRRMDR1",46,0)
 . . . . . . . S EDT=$$GET1^DIQ(9000010,REC_",",.01)
"RTN","PXRRMDR1",47,0)
 . . . . . . . S TYP=$$GET1^DIQ(9000010,REC_",",15001)
"RTN","PXRRMDR1",48,0)
 . . . . . . . S USR=$$GET1^DIQ(9000010,REC_",",.23)
"RTN","PXRRMDR1",49,0)
 . . . . . . . D:HDR=0 HEADER Q:POP
"RTN","PXRRMDR1",50,0)
 . . . . . . . I RPTYP="D" D
"RTN","PXRRMDR1",51,0)
 . . . . . . . . I HDR1=0 D
"RTN","PXRRMDR1",52,0)
 . . . . . . . . . W ! S $P(HLINE,"-",132)="" W HLINE
"RTN","PXRRMDR1",53,0)
 . . . . . . . . . W !,$E(PAT,1,25),?26,SSND,?39,EDT,?59,$E(TYP,1,15),?75,$E(USR,1,15) S HDR1=1
"RTN","PXRRMDR1",54,0)
 . . . . . . . . W ?94,$E(SDX,1,37),!
"RTN","PXRRMDR1",55,0)
 . . . . . . . S TOT(6)=TOT(6)+1
"RTN","PXRRMDR1",56,0)
 . . . . . . . I $Y>(IOSL-4) S HDR=0
"RTN","PXRRMDR1",57,0)
 . . . . . . Q:POP
"RTN","PXRRMDR1",58,0)
 . . . . . Q:POP
"RTN","PXRRMDR1",59,0)
 . . . . . I $Y>(IOSL-4) D HEADER Q:POP
"RTN","PXRRMDR1",60,0)
 . . . . . S SHDR=1
"RTN","PXRRMDR1",61,0)
 . . . . . W:RPTYP="D" !?94,DEFD_TYP_":  ",TOT(6),!
"RTN","PXRRMDR1",62,0)
 . . . . . S TOT(5)=TOT(5)+TOT(6)
"RTN","PXRRMDR1",63,0)
 . . . . Q:POP
"RTN","PXRRMDR1",64,0)
 . . . . W !?6,DEFD_VDT_":  ",TOT(5)
"RTN","PXRRMDR1",65,0)
 . . . . W !?6,ENCD_VDT_":  ",TOTE(5)
"RTN","PXRRMDR1",66,0)
 . . . . S TOT(4)=TOT(4)+TOT(5)
"RTN","PXRRMDR1",67,0)
 . . . . S TOTE(4)=TOTE(4)+TOTE(5)
"RTN","PXRRMDR1",68,0)
 . . . Q:POP
"RTN","PXRRMDR1",69,0)
 . . . W !?4,DEFD_"SORT VALUE - "_$P(SORT,"_",1)_": ",TOT(4)
"RTN","PXRRMDR1",70,0)
 . . . W !?4,ENCD_"SORT VALUE - "_$P(SORT,"_",1)_": ",TOTE(4)
"RTN","PXRRMDR1",71,0)
 . . . S TOT(3)=TOT(3)+TOT(4)
"RTN","PXRRMDR1",72,0)
 . . . S TOTE(3)=TOTE(3)+TOTE(4)
"RTN","PXRRMDR1",73,0)
 . . Q:POP
"RTN","PXRRMDR1",74,0)
 . . W !?2,DEFD_PROV_": ",TOT(3)
"RTN","PXRRMDR1",75,0)
 . . W !?2,ENCD_PROV_": ",TOTE(3)
"RTN","PXRRMDR1",76,0)
 . . S TOT(2)=TOT(2)+TOT(3)
"RTN","PXRRMDR1",77,0)
 . . S TOTE(2)=TOTE(2)+TOTE(3)
"RTN","PXRRMDR1",78,0)
 . Q:POP
"RTN","PXRRMDR1",79,0)
 . W !,DEFD_LOC_":  ",TOT(2)
"RTN","PXRRMDR1",80,0)
 . W !,ENCD_LOC_": ",TOTE(2)
"RTN","PXRRMDR1",81,0)
 . S TOT(1)=TOT(1)+TOT(2)
"RTN","PXRRMDR1",82,0)
 . S TOTE(1)=TOTE(1)+TOTE(2)
"RTN","PXRRMDR1",83,0)
 Q:POP
"RTN","PXRRMDR1",84,0)
 I TOT(1)+TOTE(1)=0 W !!,"No Data to print",! Q
"RTN","PXRRMDR1",85,0)
 W !!,"GRAND TOTAL NUMBER OF DEFECTS:  ",TOT(1)
"RTN","PXRRMDR1",86,0)
 W !,"GRAND TOTAL NUMBER OF ENCOUNTERS = ",TOTE(1)
"RTN","PXRRMDR1",87,0)
 Q
"RTN","PXRRMDR1",88,0)
 ;
"RTN","PXRRMDR1",89,0)
HEADER ;print header
"RTN","PXRRMDR1",90,0)
 N %,X,Y,MSG,HLINE,DLINE
"RTN","PXRRMDR1",91,0)
 I (PXPAGE>0)&(($E(IOST)="C")&(IO=IO(0))) D
"RTN","PXRRMDR1",92,0)
 . S DIR(0)="E"
"RTN","PXRRMDR1",93,0)
 . W !
"RTN","PXRRMDR1",94,0)
 . D ^DIR K DIR
"RTN","PXRRMDR1",95,0)
 I $D(DUOUT)!($D(DTOUT)) D  Q
"RTN","PXRRMDR1",96,0)
 . S POP=1
"RTN","PXRRMDR1",97,0)
 I PXPAGE>0 W:$D(IOF) @IOF
"RTN","PXRRMDR1",98,0)
 S PXPAGE=PXPAGE+1
"RTN","PXRRMDR1",99,0)
 W !
"RTN","PXRRMDR1",100,0)
 S X=$$CTR132("PCE MISSING DATA REPORT") W !
"RTN","PXRRMDR1",101,0)
 D NOW^%DTC S Y=% X ^DD("DD") S X=$$CTR(Y) W !
"RTN","PXRRMDR1",102,0)
 S X=$$CTR132("By Clinic, Provider, and Date") W !
"RTN","PXRRMDR1",103,0)
 S Y=PX("BDT") X ^DD("DD") S STDT=$P(Y,"@",1)
"RTN","PXRRMDR1",104,0)
 S Y=PX("EDT") X ^DD("DD") S ENDT=$P(Y,"@",1)
"RTN","PXRRMDR1",105,0)
 S MSG=STDT_" through "_ENDT
"RTN","PXRRMDR1",106,0)
 S X=$$CTR(MSG) W !
"RTN","PXRRMDR1",107,0)
 S X=$$CTR132("Page "_PXPAGE) W !
"RTN","PXRRMDR1",108,0)
 W !!,"Patient",?26,"SSN",?39,"Date/Time",?59,"Enc. ID",?75,"Created by User",?94,"Defect",!
"RTN","PXRRMDR1",109,0)
 S $P(HLINE,"=",132)="" W HLINE,!
"RTN","PXRRMDR1",110,0)
 Q:SHDR
"RTN","PXRRMDR1",111,0)
 W !,LOC
"RTN","PXRRMDR1",112,0)
 W !?2,PROV
"RTN","PXRRMDR1",113,0)
 N SORTD S SORTD=$P(SORT,"_",1)
"RTN","PXRRMDR1",114,0)
 S:SORTD=" " SORTD="Unknown"
"RTN","PXRRMDR1",115,0)
 N SORTHDR2 S SORTHDR2=$P(SORTHDR,U,PXSRT)
"RTN","PXRRMDR1",116,0)
 I SORTHDR2="DIAGNOSIS" S SORTHDR2=$S($P(SORT,"_",2)="30":"ICD10",1:"ICD9")
"RTN","PXRRMDR1",117,0)
 W !?4,"SORT VALUE:  ",SORTHDR2,"= ",SORTD
"RTN","PXRRMDR1",118,0)
 S:VDT="" VDT="Unknown"
"RTN","PXRRMDR1",119,0)
 W !?6,$P(VDT,"@",1),":"
"RTN","PXRRMDR1",120,0)
 S HDR=1
"RTN","PXRRMDR1",121,0)
 Q
"RTN","PXRRMDR1",122,0)
 ;
"RTN","PXRRMDR1",123,0)
CTR(X) ;
"RTN","PXRRMDR1",124,0)
 W ?(IOM-$L(X))\2,X
"RTN","PXRRMDR1",125,0)
 Q 1
"RTN","PXRRMDR1",126,0)
 ;
"RTN","PXRRMDR1",127,0)
CTR132(X) ;
"RTN","PXRRMDR1",128,0)
 W ?(132-$L(X))\2,X
"RTN","PXRRMDR1",129,0)
 Q 1
"RTN","PXRRMDR1",130,0)
 ;
"RTN","PXRRPAPI")
0^45^B64147348^B63792719
"RTN","PXRRPAPI",1,0)
PXRRPAPI ;ISL/PKR - Build the patient specific info for each patient on the list. ;6/27/97
"RTN","PXRRPAPI",2,0)
 ;;1.0;PCE PATIENT CARE ENCOUNTER;**18,121,165,199**;Aug 12, 1996;Build 51
"RTN","PXRRPAPI",3,0)
 ;
"RTN","PXRRPAPI",4,0)
PAT ;
"RTN","PXRRPAPI",5,0)
 N ACTIVITY,BACDATE,BD,BUSY,DATE,DFN,EACDATE,ED,ERIEN,ERR
"RTN","PXRRPAPI",6,0)
 N IC,IEN,JC,FACIEN,FACNAM
"RTN","PXRRPAPI",7,0)
 N HLOCIEN,HLOCNAM,LABTEST,LOCIEN,LRDFN,NERM
"RTN","PXRRPAPI",8,0)
 N PNAME,SPEC,SSN,SSNF,UNITS
"RTN","PXRRPAPI",9,0)
 N TEMP
"RTN","PXRRPAPI",10,0)
 ;
"RTN","PXRRPAPI",11,0)
 ;Allow the task to be cleaned up upon successful completion.
"RTN","PXRRPAPI",12,0)
 S ZTREQ="@"
"RTN","PXRRPAPI",13,0)
 ;
"RTN","PXRRPAPI",14,0)
 S BACDATE=PXRRBCDT-.0001
"RTN","PXRRPAPI",15,0)
 S EACDATE=PXRRECDT+.2359
"RTN","PXRRPAPI",16,0)
 ;
"RTN","PXRRPAPI",17,0)
 ;Build a list of emergency room iens, get list from PCE parameter file.
"RTN","PXRRPAPI",18,0)
 S NERM=0
"RTN","PXRRPAPI",19,0)
 S IC=0
"RTN","PXRRPAPI",20,0)
 F  S IC=$O(^PX(815,IC)) Q:+IC=0  D
"RTN","PXRRPAPI",21,0)
 . S JC=0
"RTN","PXRRPAPI",22,0)
 . F  S JC=$O(^PX(815,IC,"RR1",JC)) Q:+JC=0  D
"RTN","PXRRPAPI",23,0)
 .. S NERM=NERM+1
"RTN","PXRRPAPI",24,0)
 .. S TEMP=^PX(815,IC,"RR1",JC,0)
"RTN","PXRRPAPI",25,0)
 .. S ERIEN(NERM)=TEMP_U_$P(^SC(TEMP,0),U,1)
"RTN","PXRRPAPI",26,0)
 ;
"RTN","PXRRPAPI",27,0)
 I '(PXRRQUE!$D(IO("S"))) D INIT^PXRRBUSY(.BUSY)
"RTN","PXRRPAPI",28,0)
 ;
"RTN","PXRRPAPI",29,0)
 S FACIEN=""
"RTN","PXRRPAPI",30,0)
NFAC1 S FACIEN=$O(^XTMP(PXRRXTMP,"APPT",FACIEN))
"RTN","PXRRPAPI",31,0)
 I +FACIEN=0 G DONE
"RTN","PXRRPAPI",32,0)
 ;
"RTN","PXRRPAPI",33,0)
 S HLOCIEN=""
"RTN","PXRRPAPI",34,0)
NHLOC1 S HLOCIEN=$O(^XTMP(PXRRXTMP,"APPT",FACIEN,HLOCIEN))
"RTN","PXRRPAPI",35,0)
 I +HLOCIEN=0 G NFAC1
"RTN","PXRRPAPI",36,0)
 ;
"RTN","PXRRPAPI",37,0)
 ;Check for a user request to stop the task.
"RTN","PXRRPAPI",38,0)
 I $$S^%ZTLOAD S ZTSTOP=1 D EXIT^PXRRGUT
"RTN","PXRRPAPI",39,0)
 ;
"RTN","PXRRPAPI",40,0)
 S DFN=0
"RTN","PXRRPAPI",41,0)
NPAT S DFN=$O(^XTMP(PXRRXTMP,"APPT",FACIEN,HLOCIEN,DFN))
"RTN","PXRRPAPI",42,0)
 I +DFN=0 G NHLOC1
"RTN","PXRRPAPI",43,0)
 S ACTIVITY=0
"RTN","PXRRPAPI",44,0)
 ;
"RTN","PXRRPAPI",45,0)
 ;If this is an interactive session let the user know that something
"RTN","PXRRPAPI",46,0)
 ;is happening.
"RTN","PXRRPAPI",47,0)
 I '(PXRRQUE!$D(IO("S"))) D SPIN^PXRRBUSY("Sorting patient information",.BUSY)
"RTN","PXRRPAPI",48,0)
 ;
"RTN","PXRRPAPI",49,0)
 ;Emergency room visits.
"RTN","PXRRPAPI",50,0)
 I NERM>0 D
"RTN","PXRRPAPI",51,0)
 . S BD=BACDATE
"RTN","PXRRPAPI",52,0)
 . S ED=EACDATE
"RTN","PXRRPAPI",53,0)
 . F  S BD=$O(^AUPNVSIT("AET",DFN,BD)) Q:((BD>EACDATE)!(BD=""))  D
"RTN","PXRRPAPI",54,0)
 .. S LOCIEN=""
"RTN","PXRRPAPI",55,0)
 .. F  S LOCIEN=$O(^AUPNVSIT("AET",DFN,BD,LOCIEN)) Q:LOCIEN=""  D
"RTN","PXRRPAPI",56,0)
 ... F IC=1:1:NERM  D
"RTN","PXRRPAPI",57,0)
 .... I $P(ERIEN(IC),U,1)=LOCIEN D
"RTN","PXRRPAPI",58,0)
 ..... S ^TMP(PXRRXTMP,$J,"ER",DFN,BD)=ERIEN(IC)
"RTN","PXRRPAPI",59,0)
 . I $D(^TMP(PXRRXTMP,$J,"ER",DFN)) S ACTIVITY=1
"RTN","PXRRPAPI",60,0)
 ;
"RTN","PXRRPAPI",61,0)
 ;Build a list of future appointments.
"RTN","PXRRPAPI",62,0)
 D KVA^VADPT
"RTN","PXRRPAPI",63,0)
 S VASD("F")=PXRRBFDT
"RTN","PXRRPAPI",64,0)
 S VASD("T")=PXRREFDT
"RTN","PXRRPAPI",65,0)
 D SDA^VADPT
"RTN","PXRRPAPI",66,0)
 S IC=0
"RTN","PXRRPAPI",67,0)
 F  S IC=$O(^UTILITY("VASD",$J,IC)) Q:+IC=0  D
"RTN","PXRRPAPI",68,0)
 . S ^TMP(PXRRXTMP,$J,"FUT",DFN,IC)=^UTILITY("VASD",$J,IC,"E")
"RTN","PXRRPAPI",69,0)
 K ^UTILITY("VASD",$J)
"RTN","PXRRPAPI",70,0)
 D KVA^VADPT
"RTN","PXRRPAPI",71,0)
 I $D(^TMP(PXRRXTMP,$J,"FUT",DFN)) S ACTIVITY=1
"RTN","PXRRPAPI",72,0)
 ;
"RTN","PXRRPAPI",73,0)
 ;Save all admissions and discharges in the date range.
"RTN","PXRRPAPI",74,0)
 ;We will need a DBIA to use the cross-ref.  Numerous similar
"RTN","PXRRPAPI",75,0)
 ;ones are already in place, i.e.,  DBIA244-D, DBIA325-B, DBIA966, DBIA1358.
"RTN","PXRRPAPI",76,0)
 S BD=BACDATE
"RTN","PXRRPAPI",77,0)
 S ED=EACDATE
"RTN","PXRRPAPI",78,0)
NADM S BD=$O(^DGPM("APTT1",DFN,BD))
"RTN","PXRRPAPI",79,0)
 ;If we have passed the ending date we are done.
"RTN","PXRRPAPI",80,0)
 I (BD>ED)!(BD="") G DIS
"RTN","PXRRPAPI",81,0)
 S IEN=$O(^DGPM("APTT1",DFN,BD,""))
"RTN","PXRRPAPI",82,0)
 S ^TMP(PXRRXTMP,$J,"ADM",DFN,BD,IEN)=""
"RTN","PXRRPAPI",83,0)
 G NADM
"RTN","PXRRPAPI",84,0)
 I $D(^TMP(PXRRXTMP,$J,"ADM",DFN)) S ACTIVITY=1
"RTN","PXRRPAPI",85,0)
 ;
"RTN","PXRRPAPI",86,0)
DIS S BD=BACDATE
"RTN","PXRRPAPI",87,0)
 S ED=EACDATE
"RTN","PXRRPAPI",88,0)
NDIS S BD=$O(^DGPM("APTT3",DFN,BD))
"RTN","PXRRPAPI",89,0)
 ;If we have passed the ending date we are done.
"RTN","PXRRPAPI",90,0)
 I (BD>ED)!(BD="") G CLAB
"RTN","PXRRPAPI",91,0)
 S IEN=$O(^DGPM("APTT3",DFN,BD,""))
"RTN","PXRRPAPI",92,0)
 S ^TMP(PXRRXTMP,$J,"DIS",DFN,BD,IEN)=""
"RTN","PXRRPAPI",93,0)
 G NDIS
"RTN","PXRRPAPI",94,0)
 I $D(^TMP(PXRRXTMP,$J,"DIS",DFN)) S ACTIVITY=1
"RTN","PXRRPAPI",95,0)
 ;
"RTN","PXRRPAPI",96,0)
 ;Get critical lab values.
"RTN","PXRRPAPI",97,0)
 ;This will probably require a DBIA to read DPT.
"RTN","PXRRPAPI",98,0)
 ;We will need a DBIA to look at lab stuff.
"RTN","PXRRPAPI",99,0)
CLAB S LRDFN=$G(^DPT(DFN,"LR"))
"RTN","PXRRPAPI",100,0)
 I LRDFN="" G SAVPAT
"RTN","PXRRPAPI",101,0)
 S ED=$$FMDFINVL(BACDATE,0)
"RTN","PXRRPAPI",102,0)
 S BD=$$FMDFINVL(EACDATE,0)
"RTN","PXRRPAPI",103,0)
NLAB S BD=$O(^LR(LRDFN,"CH",BD))
"RTN","PXRRPAPI",104,0)
 ;If we have passed the ending date we are done.
"RTN","PXRRPAPI",105,0)
 I (BD>ED)!(BD="") G SAVPAT
"RTN","PXRRPAPI",106,0)
 S IC=0
"RTN","PXRRPAPI",107,0)
 F  S IC=$O(^LR(LRDFN,"CH",BD,IC)) Q:+IC=0  D
"RTN","PXRRPAPI",108,0)
 . S TEMP=$G(^LR(LRDFN,"CH",BD,IC))
"RTN","PXRRPAPI",109,0)
 . I $P(TEMP,U,2)["*" D
"RTN","PXRRPAPI",110,0)
 .. D FIELD^DID(63.04,IC,"","LABEL","LABTEST","ERR")
"RTN","PXRRPAPI",111,0)
 ..;Try to get the units.
"RTN","PXRRPAPI",112,0)
 .. S SPEC=$P(^LR(LRDFN,"CH",BD,0),U,5)
"RTN","PXRRPAPI",113,0)
 .. S JC=$O(^LAB(60,"C","CH;"_IC_";1",""))
"RTN","PXRRPAPI",114,0)
 .. S UNITS=$P($G(^LAB(60,JC,1,SPEC,0)),U,7)
"RTN","PXRRPAPI",115,0)
 .. S ^TMP(PXRRXTMP,$J,"CLAB",DFN,BD,IC)=LABTEST("LABEL")_U_TEMP_U_UNITS
"RTN","PXRRPAPI",116,0)
 G NLAB
"RTN","PXRRPAPI",117,0)
 I $D(^TMP(PXRRXTMP,$J,"CLAB",DFN)) S ACTIVITY=1
"RTN","PXRRPAPI",118,0)
 ;
"RTN","PXRRPAPI",119,0)
SAVPAT ;Save the patient data in XTMP in a format suitable for printing.
"RTN","PXRRPAPI",120,0)
 ;We only want those patients that had some activity.
"RTN","PXRRPAPI",121,0)
 I 'ACTIVITY G NPAT
"RTN","PXRRPAPI",122,0)
 S TEMP=$G(^DPT(DFN,0))
"RTN","PXRRPAPI",123,0)
 S PNAME=$P(TEMP,U,1)
"RTN","PXRRPAPI",124,0)
 S SSN=$P(TEMP,U,9)
"RTN","PXRRPAPI",125,0)
 S FACNAM=PXRRFACN(FACIEN)_U_FACIEN
"RTN","PXRRPAPI",126,0)
 S HLOCNAM=$P($G(^SC(HLOCIEN,0)),U,1)
"RTN","PXRRPAPI",127,0)
 S ^XTMP(PXRRXTMP,"ALPHA",FACNAM,HLOCNAM_U_HLOCIEN,PNAME,SSN)=DFN
"RTN","PXRRPAPI",128,0)
 D KVA^VADPT
"RTN","PXRRPAPI",129,0)
 D ADD^VADPT
"RTN","PXRRPAPI",130,0)
 S SSNF=$$SSNFORM(SSN)
"RTN","PXRRPAPI",131,0)
 S ^XTMP(PXRRXTMP,"PATIENT",DFN)=SSNF_U_VAPA(1)_U_VAPA(2)_U_VAPA(3)_U_VAPA(4)_U_VAPA(5)_U_VAPA(6)_U_VAPA(8)
"RTN","PXRRPAPI",132,0)
 D KVA^VADPT
"RTN","PXRRPAPI",133,0)
 ;
"RTN","PXRRPAPI",134,0)
 ;Appointment data.
"RTN","PXRRPAPI",135,0)
 S IC=0
"RTN","PXRRPAPI",136,0)
 F  S IC=$O(^XTMP(PXRRXTMP,"APPT",FACIEN,HLOCIEN,DFN,IC)) Q:+IC=0  D
"RTN","PXRRPAPI",137,0)
 . S ^XTMP(PXRRXTMP,FACIEN,HLOCIEN,DFN,"APPT",IC)=^XTMP(PXRRXTMP,"APPT",FACIEN,HLOCIEN,DFN,IC)
"RTN","PXRRPAPI",138,0)
 ;
"RTN","PXRRPAPI",139,0)
 ;Process admission data, build a complete entry including discharge
"RTN","PXRRPAPI",140,0)
 ;date, last treating specialty, last provider, admitting diagnosis.
"RTN","PXRRPAPI",141,0)
 S IC=0
"RTN","PXRRPAPI",142,0)
 F  S IC=$O(^TMP(PXRRXTMP,$J,"ADM",DFN,IC)) Q:+IC=0  D
"RTN","PXRRPAPI",143,0)
 . S IEN=$O(^TMP(PXRRXTMP,$J,"ADM",DFN,IC,""))
"RTN","PXRRPAPI",144,0)
 . D ADMISS(DFN,IC,IEN)
"RTN","PXRRPAPI",145,0)
 ;
"RTN","PXRRPAPI",146,0)
 ;Process discharge admission data, build a complete entry just as for
"RTN","PXRRPAPI",147,0)
 ;admissions above.  Match the discharge to the admission, avoiding
"RTN","PXRRPAPI",148,0)
 ;duplicate entries.
"RTN","PXRRPAPI",149,0)
 S IC=0
"RTN","PXRRPAPI",150,0)
 F  S IC=$O(^TMP(PXRRXTMP,$J,"DIS",DFN,IC)) Q:+IC=0  D
"RTN","PXRRPAPI",151,0)
 . S IEN=$O(^TMP(PXRRXTMP,$J,"DIS",DFN,IC,""))
"RTN","PXRRPAPI",152,0)
 . D DISCHRG(DFN,IC,IEN)
"RTN","PXRRPAPI",153,0)
 ;
"RTN","PXRRPAPI",154,0)
 ;Look for any current inpatient data whose admission we may have
"RTN","PXRRPAPI",155,0)
 ;missed.
"RTN","PXRRPAPI",156,0)
 I '$D(^XTMP(PXRRXTMP,FACIEN,HLOCIEN,DFN,"ADMDIS")) D
"RTN","PXRRPAPI",157,0)
 . D KVA^VADPT
"RTN","PXRRPAPI",158,0)
 . D IN5^VADPT
"RTN","PXRRPAPI",159,0)
 . I $L(VAIP(13))>0 D
"RTN","PXRRPAPI",160,0)
 .. S DATE=$P(VAIP(13,1),U,1)
"RTN","PXRRPAPI",161,0)
 ..;The admission date must be less than the beginning activity date
"RTN","PXRRPAPI",162,0)
 ..;in order for the patient to be an inpatient during the activity
"RTN","PXRRPAPI",163,0)
 ..;date range.
"RTN","PXRRPAPI",164,0)
 .. I DATE<PXRRBCDT D
"RTN","PXRRPAPI",165,0)
 ...;Ward
"RTN","PXRRPAPI",166,0)
 ... S TEMP=$P(VAIP(14,4),U,2)
"RTN","PXRRPAPI",167,0)
 ...;Last treating specialty
"RTN","PXRRPAPI",168,0)
 ... S TEMP=TEMP_U_$P(VAIP(14,6),U,2)
"RTN","PXRRPAPI",169,0)
 ... ;Last provider
"RTN","PXRRPAPI",170,0)
 ... S TEMP=TEMP_U_$P(VAIP(14,5),U,2)
"RTN","PXRRPAPI",171,0)
 ...;Admitting diagnosis
"RTN","PXRRPAPI",172,0)
 ... S TEMP=TEMP_U_VAIP(13,7)
"RTN","PXRRPAPI",173,0)
 ... S DISDATE=DT+1
"RTN","PXRRPAPI",174,0)
 ... S ^XTMP(PXRRXTMP,FACIEN,HLOCIEN,DFN,"ADMDIS",DATE,DISDATE)=TEMP
"RTN","PXRRPAPI",175,0)
 ;
"RTN","PXRRPAPI",176,0)
 ;Critical lab data.
"RTN","PXRRPAPI",177,0)
 S IC=0
"RTN","PXRRPAPI",178,0)
 F  S IC=$O(^TMP(PXRRXTMP,$J,"CLAB",DFN,IC)) Q:+IC=0  D
"RTN","PXRRPAPI",179,0)
 . S TEMP=$$FMDFINVL(IC,1)
"RTN","PXRRPAPI",180,0)
 . S JC=0
"RTN","PXRRPAPI",181,0)
 . F  S JC=$O(^TMP(PXRRXTMP,$J,"CLAB",DFN,IC,JC)) Q:+JC=0  D
"RTN","PXRRPAPI",182,0)
 .. S ^XTMP(PXRRXTMP,FACIEN,HLOCIEN,DFN,"CLAB",TEMP,JC)=^TMP(PXRRXTMP,$J,"CLAB",DFN,IC,JC)
"RTN","PXRRPAPI",183,0)
 ;
"RTN","PXRRPAPI",184,0)
 ;Emergency room visits.
"RTN","PXRRPAPI",185,0)
 S IC=0
"RTN","PXRRPAPI",186,0)
 F  S IC=$O(^TMP(PXRRXTMP,$J,"ER",DFN,IC)) Q:+IC=0  D
"RTN","PXRRPAPI",187,0)
 . S ^XTMP(PXRRXTMP,FACIEN,HLOCIEN,DFN,"ER",IC)=^TMP(PXRRXTMP,$J,"ER",DFN,IC)
"RTN","PXRRPAPI",188,0)
 ;
"RTN","PXRRPAPI",189,0)
 ;Future appointments.
"RTN","PXRRPAPI",190,0)
 S IC=0
"RTN","PXRRPAPI",191,0)
 F  S IC=$O(^TMP(PXRRXTMP,$J,"FUT",DFN,IC)) Q:+IC=0  D
"RTN","PXRRPAPI",192,0)
 . S ^XTMP(PXRRXTMP,FACIEN,HLOCIEN,DFN,"FUT",IC)=^TMP(PXRRXTMP,$J,"FUT",DFN,IC)
"RTN","PXRRPAPI",193,0)
 ;
"RTN","PXRRPAPI",194,0)
 G NPAT
"RTN","PXRRPAPI",195,0)
DONE ;
"RTN","PXRRPAPI",196,0)
 I '(PXRRQUE!$D(IO("S"))) D DONE^PXRRBUSY("done")
"RTN","PXRRPAPI",197,0)
 ;
"RTN","PXRRPAPI",198,0)
EXIT ;
"RTN","PXRRPAPI",199,0)
 K ^TMP(PXRRXTMP)
"RTN","PXRRPAPI",200,0)
 ;
"RTN","PXRRPAPI",201,0)
 ;Print the report.
"RTN","PXRRPAPI",202,0)
 I PXRRQUE D 
"RTN","PXRRPAPI",203,0)
 .;Start the report that was queued but not scheduled.
"RTN","PXRRPAPI",204,0)
 . N DESC,ROUTINE,TASK
"RTN","PXRRPAPI",205,0)
 . S DESC="Patient Activity Report - print"
"RTN","PXRRPAPI",206,0)
 . S ROUTINE="PXRRPAPR"
"RTN","PXRRPAPI",207,0)
 . S ZTDTH=$$NOW^XLFDT
"RTN","PXRRPAPI",208,0)
 . S TASK=^XTMP(PXRRXTMP,"PRZTSK")
"RTN","PXRRPAPI",209,0)
 . D REQUE^PXRRQUE(DESC,ROUTINE,TASK)
"RTN","PXRRPAPI",210,0)
 E  D ^PXRRPAPR
"RTN","PXRRPAPI",211,0)
 Q
"RTN","PXRRPAPI",212,0)
 ;
"RTN","PXRRPAPI",213,0)
 ;======================================================================
"RTN","PXRRPAPI",214,0)
ADMISS(DFN,DATE,IEN) ;Given a patient and an admission date find the
"RTN","PXRRPAPI",215,0)
 ;associated discharge, if any.  Save the other information listed
"RTN","PXRRPAPI",216,0)
 ;below.
"RTN","PXRRPAPI",217,0)
 N DISDATE,TEMP
"RTN","PXRRPAPI",218,0)
 D KVA^VADPT
"RTN","PXRRPAPI",219,0)
 S VAIP("D")=DATE
"RTN","PXRRPAPI",220,0)
 S VAIP("E")=IEN
"RTN","PXRRPAPI",221,0)
 S VAIP("M")=0
"RTN","PXRRPAPI",222,0)
 D IN5^VADPT
"RTN","PXRRPAPI",223,0)
 ;Store the information in TEMP in printing order.
"RTN","PXRRPAPI",224,0)
 ;Ward
"RTN","PXRRPAPI",225,0)
 S TEMP=$P(VAIP(14,4),U,2)
"RTN","PXRRPAPI",226,0)
 ;Last treating specialty
"RTN","PXRRPAPI",227,0)
 S TEMP=TEMP_U_$P(VAIP(14,6),U,2)
"RTN","PXRRPAPI",228,0)
 ;Last provider
"RTN","PXRRPAPI",229,0)
 S TEMP=TEMP_U_$P(VAIP(14,5),U,2)
"RTN","PXRRPAPI",230,0)
 ;Admitting diagnosis
"RTN","PXRRPAPI",231,0)
 S TEMP=TEMP_U_VAIP(13,7)
"RTN","PXRRPAPI",232,0)
 I $L(VAIP(17))>0 D
"RTN","PXRRPAPI",233,0)
 . S DISDATE=$P(VAIP(17,1),U,1)
"RTN","PXRRPAPI",234,0)
 E  D
"RTN","PXRRPAPI",235,0)
 . S DISDATE=DT+1
"RTN","PXRRPAPI",236,0)
 S ^XTMP(PXRRXTMP,FACIEN,HLOCIEN,DFN,"ADMDIS",DATE,DISDATE)=TEMP
"RTN","PXRRPAPI",237,0)
 ;
"RTN","PXRRPAPI",238,0)
ADMDONE ;
"RTN","PXRRPAPI",239,0)
 D KVA^VADPT
"RTN","PXRRPAPI",240,0)
 Q
"RTN","PXRRPAPI",241,0)
 ;
"RTN","PXRRPAPI",242,0)
 ;======================================================================
"RTN","PXRRPAPI",243,0)
DISCHRG(DFN,DATE,IEN) ;Given a patient and a discharge date find the
"RTN","PXRRPAPI",244,0)
 ;associated admission.  Determine if the combined admission-discharge
"RTN","PXRRPAPI",245,0)
 ;data has already been stored.  If it has quit otherwise store it.
"RTN","PXRRPAPI",246,0)
 N ADMDATE,ICD9IEN,TEMP
"RTN","PXRRPAPI",247,0)
 D KVA^VADPT
"RTN","PXRRPAPI",248,0)
 S VAIP("D")=$P(DATE,".",1)
"RTN","PXRRPAPI",249,0)
 S VAIP("E")=IEN
"RTN","PXRRPAPI",250,0)
 S VAIP("M")=0
"RTN","PXRRPAPI",251,0)
 D IN5^VADPT
"RTN","PXRRPAPI",252,0)
 S ADMDATE=$P(VAIP(13,1),U,1)
"RTN","PXRRPAPI",253,0)
 I ADMDATE="" S ADMDATE=DATE_"NA"
"RTN","PXRRPAPI",254,0)
 I $D(^XTMP(PXRRXTMP,FACIEN,HLOCIEN,DFN,"ADMDIS",ADMDATE,DATE)) G DISDONE
"RTN","PXRRPAPI",255,0)
 ;Information is not already there, store the data.
"RTN","PXRRPAPI",256,0)
 ;Ward
"RTN","PXRRPAPI",257,0)
 S TEMP=""
"RTN","PXRRPAPI",258,0)
 ;Last treating specialty
"RTN","PXRRPAPI",259,0)
 S TEMP=TEMP_U_$P(VAIP(17,6),U,2)
"RTN","PXRRPAPI",260,0)
 ;Last provider
"RTN","PXRRPAPI",261,0)
 S TEMP=TEMP_U_$P(VAIP(17,5),U,2)
"RTN","PXRRPAPI",262,0)
 ;Admitting diagnosis
"RTN","PXRRPAPI",263,0)
 S TEMP=TEMP_U_VAIP(13,7)
"RTN","PXRRPAPI",264,0)
 ;Will need a DBIA for these reads.
"RTN","PXRRPAPI",265,0)
 ;Try to get DXLS
"RTN","PXRRPAPI",266,0)
 I +VAIP(12)>0 S ICD9IEN=$P($G(^DGPT(VAIP(12),70)),U,10)
"RTN","PXRRPAPI",267,0)
 I +$G(ICD9IEN)>0 S TEMP=TEMP_U_$P($$ICDDATA^ICDXCODE("DIAG",ICD9IEN,DATE,"I"),U,4)
"RTN","PXRRPAPI",268,0)
 ;
"RTN","PXRRPAPI",269,0)
 S ^XTMP(PXRRXTMP,FACIEN,HLOCIEN,DFN,"ADMDIS",ADMDATE,DATE)=TEMP
"RTN","PXRRPAPI",270,0)
DISDONE ;
"RTN","PXRRPAPI",271,0)
 D KVA^VADPT
"RTN","PXRRPAPI",272,0)
 Q
"RTN","PXRRPAPI",273,0)
 ;
"RTN","PXRRPAPI",274,0)
 ;======================================================================
"RTN","PXRRPAPI",275,0)
SSNFORM(SSN) ;Format the social security number with dashes.
"RTN","PXRRPAPI",276,0)
 N FSSN,TEMP
"RTN","PXRRPAPI",277,0)
 S TEMP=$E(SSN,1,3)
"RTN","PXRRPAPI",278,0)
 S FSSN=TEMP_"-"
"RTN","PXRRPAPI",279,0)
 S TEMP=$E(SSN,4,5)
"RTN","PXRRPAPI",280,0)
 S FSSN=FSSN_TEMP_"-"
"RTN","PXRRPAPI",281,0)
 S TEMP=$E(SSN,6,9)
"RTN","PXRRPAPI",282,0)
 S FSSN=FSSN_TEMP
"RTN","PXRRPAPI",283,0)
 Q FSSN
"RTN","PXRRPAPI",284,0)
 ;
"RTN","PXRRPAPI",285,0)
 ;======================================================================
"RTN","PXRRPAPI",286,0)
FMDFINVL(INVDT,DATE) ;Convert an inverse date (LABORATORY format
"RTN","PXRRPAPI",287,0)
 ;9999999-date) to FileMan format.
"RTN","PXRRPAPI",288,0)
 I $L(INVDT)=0 Q INVDT
"RTN","PXRRPAPI",289,0)
 N TEMP
"RTN","PXRRPAPI",290,0)
 S TEMP=9999999-INVDT
"RTN","PXRRPAPI",291,0)
 ;If DATE is TRUE return only the date portion.
"RTN","PXRRPAPI",292,0)
 I DATE S TEMP=$P(TEMP,".",1)
"RTN","PXRRPAPI",293,0)
 Q TEMP
"RTN","PXRRPAPI",294,0)
 ;
"RTN","PXRRPCE3")
0^46^B39482453^B26611053
"RTN","PXRRPCE3",1,0)
PXRRPCE3 ;HIN/MjK - Clinic Specific Workload Reports ;10 Sep 2013  10:48 AM
"RTN","PXRRPCE3",2,0)
 ;;1.0;PCE PATIENT CARE ENCOUNTER;**121,146,199**;Aug 12, 1996;Build 51
"RTN","PXRRPCE3",3,0)
EN ;_._._._._._._.Visit Totals/ Patient Ages/ Unsched Totals_._._._._._.
"RTN","PXRRPCE3",4,0)
 N ICD10250,ICD10401,ICDCSYS,ICDDATA,PXDXDATE
"RTN","PXRRPCE3",5,0)
 ; Z = Visit Dt/Time
"RTN","PXRRPCE3",6,0)
 D INITVAR^PXRRPCE5 ;Initialize counter variables
"RTN","PXRRPCE3",7,0)
 S (X,Y)=0 F  S X=$O(PXRRCLIN(X)) Q:'X  S Y=Y+1,PXRCLNUM=Y
"RTN","PXRRPCE3",8,0)
 S PXRRY=PXRRYR F  S PXRRY=$O(^AUPNVSIT("B",PXRRY)) Q:'PXRRY!((PXRRY>PXRREDT))  D
"RTN","PXRRPCE3",9,0)
 . S PXRRVIFN=0 F  S PXRRVIFN=$O(^AUPNVSIT("B",PXRRY,PXRRVIFN)) Q:'PXRRVIFN  I $P($G(^AUPNVSIT(PXRRVIFN,0)),U,22)=PXRRCLIN D
"RTN","PXRRPCE3",10,0)
 .. S X=$P($G(^AUPNVSIT(PXRRVIFN,0)),U,7) Q:X'="A"&(X'="I")&(X'="S")
"RTN","PXRRPCE3",11,0)
 .. S Z=$P(^AUPNVSIT(PXRRVIFN,0),U),DFN=$P(^AUPNVSIT(PXRRVIFN,0),U,5)
"RTN","PXRRPCE3",12,0)
 .. S PXDXDATE=$$CSDATE^PXDXUTL(PXRRVIFN) ; set diagnosis date separate from Visit date for "E" records
"RTN","PXRRPCE3",13,0)
 .. ;_._._._._._._._.Demographics - Sessions, Ages_._._._._._._._.
"RTN","PXRRPCE3",14,0)
 .. S PXRRTVS=PXRRTVS+1 I Z>PXRRBDT S PXRRSESS=$S($D(Z($P(Z,"."))):PXRRSESS,1:PXRRSESS+1),Z($P(Z,"."))=""
"RTN","PXRRPCE3",15,0)
 .. D AGE
"RTN","PXRRPCE3",16,0)
 .. ;_._._._._._._._._._All Clinic Patients_._._._._._._._._._
"RTN","PXRRPCE3",17,0)
 .. S PXRRAPT=$P(Z,".")
"RTN","PXRRPCE3",18,0)
 .. F  S PXRRAPT=$O(^DPT(DFN,"S",PXRRAPT)) Q:'PXRRAPT!(PXRRAPT>($$FMADD^XLFDT(PXRRAPT,1)))  I $P(^DPT(DFN,"S",PXRRAPT,0),U)=PXRRCLIN S:$P(^DPT(DFN,"S",PXRRAPT,0),U,7)=4 PXRRSXUN=PXRRSXUN+1
"RTN","PXRRPCE3",19,0)
 .. S ^TMP($J,PXRRCLIN,"PATIENT APPTS",Z,DFN)=""
"RTN","PXRRPCE3",20,0)
 .. S ^TMP($J,PXRRCLIN,"CLINIC PATIENTS",DFN)=""
"RTN","PXRRPCE3",21,0)
 .. ;_._._._._._._._._._._._._Diagnoses_._._._._._._._._._._._._.
"RTN","PXRRPCE3",22,0)
 .. ;B = V POV IEN ; C = ICD Code
"RTN","PXRRPCE3",23,0)
 .. S B="" F  S B=$O(^AUPNVPOV("AD",PXRRVIFN,B)) Q:'B  D
"RTN","PXRRPCE3",24,0)
 ... S ICDDATA=$$ICDDATA^ICDXCODE("DIAG",$P(^AUPNVPOV(B,0),U),PXDXDATE,"I")
"RTN","PXRRPCE3",25,0)
 ... S C=$P(ICDDATA,U,2),ICDCSYS($S($P(ICDDATA,U,20)="30":"10D",1:"ICD"))=""
"RTN","PXRRPCE3",26,0)
 ... S C=$S('+C:C,1:+C)
"RTN","PXRRPCE3",27,0)
 ... S:(C'?1"272.".E)&(C'?1"305.".E)&(C'?1"E78.".E)&(C'?1"F17.2".E)&(C'="Z72.0") C=$P(C,".")
"RTN","PXRRPCE3",28,0)
 ... S ^TMP($J,PXRRCLIN,"ICD",Z,C,DFN)="",^TMP($J,PXRRCLIN,"ICD PAT",C,DFN,Z)=""
"RTN","PXRRPCE3",29,0)
MEDAGE ;_._._._._._._._._._._._._._Median Age_._._._._._._._._._._._._._._.
"RTN","PXRRPCE3",30,0)
 S X=0 F  S X=$O(^TMP($J,PXRRCLIN,"PATIENT AGE",X)) Q:'X  S DFN=0 F  S DFN=$O(^TMP($J,PXRRCLIN,"PATIENT AGE",X,DFN)) Q:'DFN  D
"RTN","PXRRPCE3",31,0)
 . S Y=$G(^TMP($J,PXRRCLIN,"PATIENT AGE",X,DFN))
"RTN","PXRRPCE3",32,0)
 . I (Y>PXRRBDT),(Y<PXRREDT) S PXRRAGE=PXRRAGE+1,Y(PXRRAGE)=X
"RTN","PXRRPCE3",33,0)
 S PXRRAGE=PXRRAGE\2,PXRRAG=$G(Y(PXRRAGE)) K Y
"RTN","PXRRPCE3",34,0)
 ;_._._._._._._._._._._._._._Diagnosis Totals_._._._._._._._._._._._._.
"RTN","PXRRPCE3",35,0)
 ;C = ICD ;E = date
"RTN","PXRRPCE3",36,0)
 Q:'$D(^TMP($J,PXRRCLIN,"CLINIC PATIENTS"))!'(PXRRSESS)
"RTN","PXRRPCE3",37,0)
 F C=272.2,272.4,250,401,414,"I25","E08","E09","E10","E11","E12","E13","I10","I11","I12","I13","I14","I15","E78.0","E78.1","E78.2","E78.3","E78.4","E78.5","F17.2",305.1 S PXRR(C)=0
"RTN","PXRRPCE3",38,0)
 ;S E=0 F  S E=$O(^TMP($J,PXRRCLIN,"ICD",E)) Q:'E  D
"RTN","PXRRPCE3",39,0)
 ;. I $D(^TMP($J,PXRRCLIN,"ICD",E,C)) S DFN=0 F  S DFN=$O(^TMP($J,PXRRCLIN,"ICD",E,C,DFN)) Q:'DFN  D
"RTN","PXRRPCE3",40,0)
 ;.. S PXRR(C)=$S('$D(C(DFN)):PXRR(C)+1,1:PXRR(C)),C(DFN)=""
"RTN","PXRRPCE3",41,0)
 K C S E=PXRRBDT F  S E=$O(^TMP($J,PXRRCLIN,"ICD",E)) Q:'E!(E>PXRREDT)  D
"RTN","PXRRPCE3",42,0)
 . S C=0 F  S C=$O(^TMP($J,PXRRCLIN,"ICD",E,C)) Q:C=""  D
"RTN","PXRRPCE3",43,0)
 .. S DFN=0 F  S DFN=$O(^TMP($J,PXRRCLIN,"ICD",E,C,DFN)) Q:'DFN  D
"RTN","PXRRPCE3",44,0)
 ... I '$D(PXRR(C)) S PXRR(C)=0
"RTN","PXRRPCE3",45,0)
 ... S PXRR(C)=$S('$D(C(C,DFN)):PXRR(C)+1,1:0),C(C,DFN)=""
"RTN","PXRRPCE3",46,0)
 K C S PXRR(272)=PXRR(272.4)+$G(PXRR(272.2))
"RTN","PXRRPCE3",47,0)
 S PXRR(305)=0 F C=305.1:.01:305.13 S PXRR(305)=PXRR(305)+$G(PXRR(C))
"RTN","PXRRPCE3",48,0)
 S PXRR("F17.2")=0 S C="F17.2" F  S C=$O(PXRR(C)) Q:C=""  Q:C'?1"F17.2".E  D
"RTN","PXRRPCE3",49,0)
 .I "^200^203^208^209^210^213^218^219^220^223^228^229^290^293^298^299^"[("^"_$P(C,".",2)_"^") D
"RTN","PXRRPCE3",50,0)
 ..S PXRR("F17.2")=PXRR("F17.2")+$G(PXRR(C))
"RTN","PXRRPCE3",51,0)
 S PXRR("F17.2")=PXRR("F17.2")+$G(PXRR("Z72.0"))
"RTN","PXRRPCE3",52,0)
 S PXRR("E78")=PXRR("E78.0")+PXRR("E78.1")+PXRR("E78.2")+PXRR("E78.3")+PXRR("E78.4")+PXRR("E78.5")
"RTN","PXRRPCE3",53,0)
 S ICD10250=$G(PXRR("E08"))+$G(PXRR("E09"))+$G(PXRR("E10"))+$G(PXRR("E11"))+$G(PXRR("E12"))+$G(PXRR("E13"))
"RTN","PXRRPCE3",54,0)
 S ICD10401=$G(PXRR("I10"))+$G(PXRR("I11"))+$G(PXRR("I12"))+$G(PXRR("I13"))+$G(PXRR("I14"))+$G(PXRR("I15"))
"RTN","PXRRPCE3",55,0)
 S PXRRDM=$S($D(ICDCSYS("ICD")):$G(PXRR(250)),1:0)+$S($D(ICDCSYS("10D")):ICD10250,1:0)
"RTN","PXRRPCE3",56,0)
 S PXRRHTN=$S($D(ICDCSYS("ICD")):$G(PXRR(401)),1:0)+$S($D(ICDCSYS("10D")):ICD10401,1:0)
"RTN","PXRRPCE3",57,0)
 S PXRRCAD=$S($D(ICDCSYS("ICD")):$G(PXRR(414)),1:0)+$S($D(ICDCSYS("10D")):PXRR("I25"),1:0)
"RTN","PXRRPCE3",58,0)
 S PXRRHLIP=$S($D(ICDCSYS("ICD")):PXRR(272),1:0)+$S($D(ICDCSYS("10D")):PXRR("E78"),1:0)
"RTN","PXRRPCE3",59,0)
 S PXRRSMYR=$S($D(ICDCSYS("ICD")):PXRR(305),1:0)+$S($D(ICDCSYS("10D")):PXRR("F17.2"),1:0)
"RTN","PXRRPCE3",60,0)
 ;_._._._._._._._._.Diabetes and Hypertensive Patients_._._._._._._._.
"RTN","PXRRPCE3",61,0)
HTDM S PXRRHTDM=0,E=PXRRBDT G:'$D(ICDCSYS("ICD")) HTDM2 F  S E=$O(^TMP($J,PXRRCLIN,"ICD",E)) Q:'E!(E>PXRREDT)  D
"RTN","PXRRPCE3",62,0)
 . S DFN=0 F  S DFN=$O(^TMP($J,PXRRCLIN,"ICD",E,250,DFN)) Q:'DFN  I $D(^TMP($J,PXRRCLIN,"ICD PAT",401,DFN)) D
"RTN","PXRRPCE3",63,0)
 .. S X=PXRRBDT F  S X=$O(^TMP($J,PXRRCLIN,"ICD PAT",401,DFN,X)) Q:'X  I X<PXRREDT S PXRRHTDM=PXRRHTDM+1
"RTN","PXRRPCE3",64,0)
HTDM2 G:'$D(ICDCSYS("10D")) SMOCAD F  S E=$O(^TMP($J,PXRRCLIN,"ICD",E)) Q:'E!(E>PXRREDT)  D
"RTN","PXRRPCE3",65,0)
 . S C="E07" F  S C=$O(^TMP($J,PXRRCLIN,"ICD",E,C)) Q:"^E08^E09^E10^E11^E12^E13^"'[(U_$E(C,1,3)_U)  D
"RTN","PXRRPCE3",66,0)
 .. S DFN=0 F  S DFN=$O(^TMP($J,PXRRCLIN,"ICD",E,C,DFN)) Q:'DFN  D
"RTN","PXRRPCE3",67,0)
 ... F C2="I10","I11","I12","I13","I14","I15" I $D(^TMP($J,PXRRCLIN,"ICD PAT",C2,DFN)) D
"RTN","PXRRPCE3",68,0)
 .... S X=PXRRBDT F  S X=$O(^TMP($J,PXRRCLIN,"ICD PAT",C2,DFN,X)) Q:'X  I X<PXRREDT S PXRRHTDM=PXRRHTDM+1
"RTN","PXRRPCE3",69,0)
 ; _._._._._._._._._._._Smokers with CAD DX_._._._._._._._._._._._._.
"RTN","PXRRPCE3",70,0)
SMOCAD S PXRRCDSM=0 G:'$D(ICDCSYS("ICD")) SMOCAD2
"RTN","PXRRPCE3",71,0)
 S C=304 F  S C=$O(^TMP($J,PXRRCLIN,"ICD PAT",C)) Q:'C!(C>305.13)  D
"RTN","PXRRPCE3",72,0)
 . S DFN=0 F  S DFN=$O(^TMP($J,PXRRCLIN,"ICD PAT",C,DFN)) Q:'DFN  D
"RTN","PXRRPCE3",73,0)
 .. S E=PXRRSXMO F  S E=$O(^TMP($J,PXRRCLIN,"ICD PAT",C,DFN,E)) Q:'E  D
"RTN","PXRRPCE3",74,0)
 ... I $D(^TMP($J,PXRRCLIN,"ICD PAT",414,DFN)) S PXRRCDSM=PXRRCDSM+1
"RTN","PXRRPCE3",75,0)
SMOCAD2 G:'$D(ICDCSYS("10D")) HBA1
"RTN","PXRRPCE3",76,0)
 S C="F17.2" F  S C=$O(^TMP($J,PXRRCLIN,"ICD PAT",C)) Q:(C'?1"F17.2".E)  D
"RTN","PXRRPCE3",77,0)
 . I "^200^203^208^209^210^213^218^219^220^223^228^229^290^293^298^299^"'[("^"_$P(C,".",2)_"^") Q
"RTN","PXRRPCE3",78,0)
 . S DFN=0 F  S DFN=$O(^TMP($J,PXRRCLIN,"ICD PAT",C,DFN)) Q:'DFN  D
"RTN","PXRRPCE3",79,0)
 .. S E=PXRRSXMO F  S E=$O(^TMP($J,PXRRCLIN,"ICD PAT",C,DFN,E)) Q:'E  D
"RTN","PXRRPCE3",80,0)
 ... I $D(^TMP($J,PXRRCLIN,"ICD PAT","I25",DFN)) S PXRRCDSM=PXRRCDSM+1
"RTN","PXRRPCE3",81,0)
 S DFN=0 F  S DFN=$O(^TMP($J,PXRRCLIN,"ICD PAT","Z72.0",DFN)) Q:'DFN  D
"RTN","PXRRPCE3",82,0)
 . S E=PXRRSXMO F  S E=$O(^TMP($J,PXRRCLIN,"ICD PAT","Z72.0",DFN,E)) Q:'E  D
"RTN","PXRRPCE3",83,0)
 .. I $D(^TMP($J,PXRRCLIN,"ICD PAT","I25",DFN)) S PXRRCDSM=PXRRCDSM+1
"RTN","PXRRPCE3",84,0)
HBA1 ; _._._._._._._._._._.HTN AND/OR HBA1C w/ DM DX_._._._._._._._._._._._.
"RTN","PXRRPCE3",85,0)
 ;             **Site Specific Entries for Selected Labs**
"RTN","PXRRPCE3",86,0)
 S PX=$O(^PX(815,0)),(DFN,PXRRHBA1)=0,PXRRLED=(9999999.9999999-PXRRSXMO)
"RTN","PXRRPCE3",87,0)
 K C,C2 S:$D(ICDCSYS("ICD")) C(250)="" I $D(ICDCSYS("10D")) F C2="E08","E09","E10","E11","E12","E13" S C(C2)=""
"RTN","PXRRPCE3",88,0)
 S C2="" F  S C2=$O(C(C2)) Q:C2=""  D
"RTN","PXRRPCE3",89,0)
 .F  S DFN=$O(^TMP($J,PXRRCLIN,"ICD PAT",C2,DFN)) Q:'DFN  D
"RTN","PXRRPCE3",90,0)
 ..  S PXRLRDFN=$P($G(^DPT(DFN,"LR")),U) Q:'PXRLRDFN  S L=0 F  S L=$O(^PX(815,PX,"RR5",L)) Q:'L  D
"RTN","PXRRPCE3",91,0)
 ... S X=$P(^PX(815,PX,"RR5",L,0),U),X=$P($P(^LAB(60,X,0),U,5),";",2),E=9999999.9999999-DT F  S E=$O(^LR(PXRLRDFN,"CH",E)) Q:'E!(E>PXRRLED)  D
"RTN","PXRRPCE3",92,0)
 .... I +$P($G(^LR(PXRLRDFN,"CH",E,X)),U) D
"RTN","PXRRPCE3",93,0)
 ..... S PXRRHBA1=PXRRHBA1+$P($G(^LR(PXRLRDFN,"CH",E,X)),U),^TMP($J,PXRRCLIN,"HBA1C",DFN,E)=$P($G(^LR(PXRLRDFN,"CH",E,X)),U)
"RTN","PXRRPCE3",94,0)
 S (PXRRHBG7,PXRRHBPT,DFN)=0
"RTN","PXRRPCE3",95,0)
 F  S DFN=$O(^TMP($J,PXRRCLIN,"HBA1C",DFN)) Q:'DFN  S X=0 F  S X=$O(^TMP($J,PXRRCLIN,"HBA1C",DFN,X)) Q:'X  S PXRRHBPT=PXRRHBPT+1 D
"RTN","PXRRPCE3",96,0)
 . I $G(^TMP($J,PXRRCLIN,"HBA1C",DFN,X))>6.99,'$D(X(DFN))  S PXRRHBG7=PXRRHBG7+1
"RTN","PXRRPCE3",97,0)
 . S X(DFN)=""
"RTN","PXRRPCE3",98,0)
 K X I $G(PXRRHBA1)>0 S PXRRHBA1=PXRRHBA1/PXRRHBPT
"RTN","PXRRPCE3",99,0)
 S:'PXRRHBPT PXRRHBA1="N/A",PXRRHBG7=0
"RTN","PXRRPCE3",100,0)
SXUTTOT ;_._._._._._._._._.Quality Care & Util 7 other Totals_._._._._._._._.
"RTN","PXRRPCE3",101,0)
 D ^PXRRPCE4
"RTN","PXRRPCE3",102,0)
 I '$D(^TMP($J,PXRRCLIN,"CLINIC PATIENTS")) S ^TMP($J,PXRRCLIN,"PATIENT","NONE",PXRRCLIN)=""
"RTN","PXRRPCE3",103,0)
 Q
"RTN","PXRRPCE3",104,0)
AGE ;_._._._._._._._._._.Calculate a patient's age_._._._._._._._._._.
"RTN","PXRRPCE3",105,0)
 I $D(^TMP($J,PXRRCLIN,"CLINIC PATIENTS",DFN)) S X=0 Q
"RTN","PXRRPCE3",106,0)
 D DEM^VADPT I VADM(4) S ^TMP($J,PXRRCLIN,"PATIENT AGE",VADM(4),DFN)=Z D KVAR^VADPT
"RTN","PXRRPCE3",107,0)
 Q
"RTN","PXRRPCE4")
0^47^B24619827^B25666281
"RTN","PXRRPCE4",1,0)
PXRRPCE4 ;HIN/MjK - Clinic Specific Caseload Demographics ;6/7/96
"RTN","PXRRPCE4",2,0)
 ;;1.0;PCE PATIENT CARE ENCOUNTER;**199**;Aug 12, 1996;Build 51
"RTN","PXRRPCE4",3,0)
LDL ;_._._._._._._._._._._._._._.LDL w/ CAD DX _._._._._.__._._._._._._._.
"RTN","PXRRPCE4",4,0)
 ;        **Site Specific IENS from Laboratory Test file**
"RTN","PXRRPCE4",5,0)
 ;E=lab dt  ;L=lab test ifn  ;V=ldl value
"RTN","PXRRPCE4",6,0)
 S PX=$O(^PX(815,0)) K C,C2 S:$D(ICDCSYS("ICD")) C(414)="" S:$D(ICDCSYS("10D")) C("I25")=""
"RTN","PXRRPCE4",7,0)
 S (PXRRLDL,PXRRDFN,PXRRCDSX,PXRRLDPT)=0
"RTN","PXRRPCE4",8,0)
 S C2="" F  S C2=$O(C(C2)) Q:C2=""  D
"RTN","PXRRPCE4",9,0)
 .F  S PXRRDFN=$O(^TMP($J,PXRRCLIN,"ICD PAT",C2,PXRRDFN)) Q:'PXRRDFN  D
"RTN","PXRRPCE4",10,0)
 .. S PXRRCDSX=PXRRCDSX+1,PXRLRDFN=+$G(^DPT(PXRRDFN,"LR")) Q:'PXRLRDFN  S E=0 F  S E=$O(^LR(PXRLRDFN,"CH",E)) Q:'E!(E>PXRRLED)  D
"RTN","PXRRPCE4",11,0)
 ...  S X=0 F  S X=$O(^PX(815,PX,"RR4",X)) Q:'X  S L=$P(^PX(815,PX,"RR4",X,0),U),L=$P($P(^LAB(60,L,0),U,5),";",2) I $D(^LR(PXRLRDFN,"CH",E,L)) D
"RTN","PXRRPCE4",12,0)
 .... S V=+$P($G(^LR(PXRLRDFN,"CH",E,L)),U)
"RTN","PXRRPCE4",13,0)
 .... S PXRRLDL=PXRRLDL+V
"RTN","PXRRPCE4",14,0)
 .... S:+V PXRRLDPT=PXRRLDPT+1,^TMP($J,"LDL",PXRRDFN,E)=V
"RTN","PXRRPCE4",15,0)
 .... S:'+V ^TMP($J,"LDL NO VAL",PXRRDFN,E)=V
"RTN","PXRRPCE4",16,0)
 I $G(PXRRLDL)>0 S PXRRLDL=PXRRLDL/PXRRLDPT
"RTN","PXRRPCE4",17,0)
 ;_._.CAD pats with no LDL values_._.
"RTN","PXRRPCE4",18,0)
 S (PXRRNOLD,PXRRDFN)=0 S C2="" F  S C2=$O(C(C2)) Q:C2=""  D
"RTN","PXRRPCE4",19,0)
 . F  S PXRRDFN=$O(^TMP($J,"ICD PAT",C2,PXRRDFN)) Q:'PXRRDFN  I '$D(^TMP($J,"LDL",PXRRDFN)) S PXRRNOLD=PXRRNOLD+1
"RTN","PXRRPCE4",20,0)
 I '+PXRRLDPT S PXRRLDL="N/A"
"RTN","PXRRPCE4",21,0)
TOTPATS ;_._._._._._._._._.Patient Totals - Pats by Gender_._._._._._._._._.
"RTN","PXRRPCE4",22,0)
 S PRX=0 F  S PRX=$O(^TMP($J,PXRRCLIN,"CLINIC PATIENTS",PRX)) Q:'PRX  D
"RTN","PXRRPCE4",23,0)
 . S PXRRTPAT=PXRRTPAT+1 S DFN=PRX D DEM^VADPT K DFN I $P(VADM(5),U)="M" S PXRRMPAT=PXRRMPAT+1
"RTN","PXRRPCE4",24,0)
 S PXRRFPAT=PXRRTPAT-PXRRMPAT,PXRRRTVS=0,X=0,Y=""
"RTN","PXRRPCE4",25,0)
 F  S X=$O(^TMP($J,PXRRCLIN,"PATIENT APPTS",X)) Q:'X  S PXRRDFN=0 F  S PXRRDFN=$O(^TMP($J,PXRRCLIN,"PATIENT APPTS",X,PXRRDFN)) Q:'PXRRDFN  D
"RTN","PXRRPCE4",26,0)
 . S:(X>PXRRBDT)&'($D(X(PXRRDFN))) PXRRVPAT=PXRRVPAT+1,X(PXRRDFN)=""
"RTN","PXRRPCE4",27,0)
 . S:(X'<PXRRSXMO)&('$D(Y(PXRRDFN))) PXRRQPAT=PXRRQPAT+1,Y(PXRRDFN)=""
"RTN","PXRRPCE4",28,0)
 . S:X'>PXRREDT&(X>PXRRBDT) PXRRRTVS=PXRRRTVS+1
"RTN","PXRRPCE4",29,0)
 K X,Y S PXRRPTSS=PXRRRTVS/PXRRSESS
"RTN","PXRRPCE4",30,0)
QLM ;_._._._._._._._._.QLM Unsched, ER, Hospztns_._._._._._._._._.
"RTN","PXRRPCE4",31,0)
 ;             ** Site Specific Clinic IENs from file 44**
"RTN","PXRRPCE4",32,0)
 S PX=$O(^PX(815,0)),(DFN,PXRRSXER,PXRRSXHP)=0 F  S DFN=$O(^TMP($J,PXRRCLIN,"CLINIC PATIENTS",DFN)) Q:'DFN  D
"RTN","PXRRPCE4",33,0)
 . S Y=0 F  S Y=$O(^PX(815,PX,"RR1",Y)) Q:'Y  S PXRRER=$P(^(Y,0),U),VASD("C",PXRRER)=""
"RTN","PXRRPCE4",34,0)
 . S VASD("F")=PXRRBDT,VASD("T")=PXRRSXMO D SDA^VADPT S X=0 F  S X=$O(^UTILITY("VASD",$J,X)) Q:'X  S PXRRSXER=PXRRSXER+1
"RTN","PXRRPCE4",35,0)
 . S PXRRDIFF=$$FMDIFF^XLFDT(PXRRBDT,PXRRSXMO)
"RTN","PXRRPCE4",36,0)
 . F PXR=0:1:PXRRDIFF S VAINDT=$$FMADD^XLFDT(PXRRBDT,PXR) D ADM^VADPT2 I $G(VADMVT)'="" S:'$D(PXR(VADMVT)) PXRRSXHP=PXRRSXHP+1 S PXR(VADMVT)="" K VADMVT
"RTN","PXRRPCE4",37,0)
 K PXR
"RTN","PXRRPCE4",38,0)
PERQPAT I PXRRQPAT>0 F PXRR="PXRRSXUN","PXRRSXER","PXRRSXHP" S Y=@PXRR S PXRR(PXRR)=$S('Y:0,1:(Y/PXRRQPAT))
"RTN","PXRRPCE4",39,0)
MAMGRM ;_._._._._._._._._._Mammograms for Patients >= 50 _._._._._.__._._.
"RTN","PXRRPCE4",40,0)
 ;PXRRA = Age in years ;B= Radiology Date ;C = Inv. Radiology Date
"RTN","PXRRPCE4",41,0)
 ;E = IEN2 RADIOLOGY PATIENT
"RTN","PXRRPCE4",42,0)
 S (PXRRF50,PXRRMMYR)=0,PXRRA=49.9
"RTN","PXRRPCE4",43,0)
 F  S PXRRA=$O(^TMP($J,PXRRCLIN,"PATIENT AGE",PXRRA)) Q:'PXRRA  D
"RTN","PXRRPCE4",44,0)
 . S DFN=0 F  S DFN=$O(^TMP($J,PXRRCLIN,"PATIENT AGE",PXRRA,DFN)) Q:'DFN  D DEM^VADPT I $P(VADM(5),U)="F" S PXRRF50=PXRRF50+1 I $D(^RADPT(DFN)) D
"RTN","PXRRPCE4",45,0)
 .. S B=PXRRBDT F  S B=$O(^RADPT(DFN,"DT",B)) Q:'B!((9999999.9999999-B)<PXRRYR)  S E=0 F  S E=$O(^RADPT(DFN,"DT",B,"P",E)) Q:'E  D:'$D(E(DFN))
"RTN","PXRRPCE4",46,0)
 ... S PXRRMAMG=$P($G(^RADPT(DFN,"DT",B,"P",E,0)),U,2) I PXRRMAMG F X=76090:1:76092 S:$D(^RAMIS(71,"D",X,PXRRMAMG)) PXRRMMYR=PXRRMMYR+1,^TMP($J,PXRRCLIN,">=50 W MM",DFN,B)="",E(DFN)=""
"RTN","PXRRPCE4",47,0)
 K E
"RTN","PXRRPCE4",48,0)
CRITLAB ;_._._._._._._._._._._.Critical Lab Values_._._._._._._._._._._._.
"RTN","PXRRPCE4",49,0)
 ;X = Lab Fields E = Lab Date ;C = Chol Value G = Glucose Value
"RTN","PXRRPCE4",50,0)
 S (PXRRDFN,PXRRGL,PXRRCHOL)=0
"RTN","PXRRPCE4",51,0)
 F  S PXRRDFN=$O(^TMP($J,PXRRCLIN,"CLINIC PATIENTS",PXRRDFN)) Q:'PXRRDFN  S PXRLRDFN=+$G(^DPT(PXRRDFN,"LR")) Q:'PXRLRDFN  S L=0 F  S L=$O(^PX(815,PX,"RR2",L)) Q:'L  S X=$P(^(L,0),U),X=$P($P(^LAB(60,X,0),U,5),";",2) D
"RTN","PXRRPCE4",52,0)
GLU . ;_.Glucose
"RTN","PXRRPCE4",53,0)
 . S E=0 F  S E=$O(^LR(PXRLRDFN,"CH",E)) Q:'E!(E>PXRRLED)   S C=+$P($G(^LR(PXRLRDFN,"CH",E,+X)),U)  S:C>200&('$D(^TMP($J,PXRRCLIN,"GL",PXRRDFN))) PXRRGL=PXRRGL+1,^TMP($J,PXRRCLIN,"GL",PXRRDFN,C,E)=""
"RTN","PXRRPCE4",54,0)
CHOL .  ;_.Cholesterol
"RTN","PXRRPCE4",55,0)
 .  S L=0 F  S L=$O(^PX(815,PX,"RR3",L)) Q:'L  S X=$P(^(L,0),U),X=$P($P(^LAB(60,X,0),U,5),";",2) D
"RTN","PXRRPCE4",56,0)
 .. F  S E=$O(^LR(PXRLRDFN,"CH",E)) Q:'E!(E>PXRRLED)   S G=+$P($G(^LR(PXRLRDFN,"CH",E,+X)),U) S:G>240&('$D(^TMP($J,PXRRCLIN,"CHOL",PXRRDFN))) PXRRCHOL=PXRRCHOL+1,^TMP($J,PXRRCLIN,"CHOL",PXRRDFN,G,E)=""
"RTN","PXRRPCE4",57,0)
UTIL ;._._._._._._._._._._._._.Utilization Data_._._._._._._._._._._._.
"RTN","PXRRPCE4",58,0)
 S DFN=0 F  S DFN=$O(^TMP($J,PXRRCLIN,"CLINIC PATIENTS",DFN)) Q:'DFN  D
"RTN","PXRRPCE4",59,0)
 . S PSOACT=1 D ^PSOHCSUM S PXRRPSO=0 F  S PXRRPSO=$O(^TMP("PSOO",$J,PXRRPSO)) Q:'PXRRPSO  I $P($P(^TMP("PSOO",$J,PXRRPSO,0),U,5),";",2)="ACTIVE" S PXRRPSUT=PXRRPSUT+1,PXRRCOST=PXRRCOST+$P(^TMP("PSOO",$J,PXRRPSO,0),U,10)
"RTN","PXRRPCE4",60,0)
 . K ^TMP("PSOO",$J)
"RTN","PXRRPCE4",61,0)
 S PXRRUTVS=PXRRTVS/PXRRTPAT,PXRRUTVS=$J(PXRRUTVS,2,1)
"RTN","PXRRPCE4",62,0)
PERUPAT I PXRRTPAT>0 F PXRR="PXRRPSUT","PXRRCOST" S Y=@PXRR S PXRR(PXRR)=$S('Y:0,1:(Y/PXRRTPAT))
"RTN","PXRRPCE4",63,0)
PCE5 ;_._._._._._._._._._._._.Call PXRRPCE5_._._._._._._._._._._._.
"RTN","PXRRPCE4",64,0)
 D ^PXRRPCE5
"RTN","PXRRPCE4",65,0)
 Q
"RTN","PXSCH4")
0^48^B7784412^B8097371
"RTN","PXSCH4",1,0)
PXSCH4 ;ISL/JVS,SCK - SCHEDULING REDESIGN PROCEDURES-DIAG #4 ;6/11/96
"RTN","PXSCH4",2,0)
 ;;1.0;PCE PATIENT CARE ENCOUNTER;**194,199**;Aug 12, 1996;Build 51
"RTN","PXSCH4",3,0)
 ;  Variable List
"RTN","PXSCH4",4,0)
 ;
"RTN","PXSCH4",5,0)
 ; DXN800  "PXK" global data for various nodes
"RTN","PXSCH4",6,0)
 ; DXN802       ""
"RTN","PXSCH4",7,0)
 ; DXNOD0       ""
"RTN","PXSCH4",8,0)
 ; DXNOD12      ""
"RTN","PXSCH4",9,0)
 ; PXSDX     The Main Diagnosis
"RTN","PXSCH4",10,0)
 ; PXSINDX   Index for "PXK" global
"RTN","PXSCH4",11,0)
 ; PXSPR   The main provider
"RTN","PXSCH4",12,0)
 ;
"RTN","PXSCH4",13,0)
DIAG ;Create nodes for diagnosis
"RTN","PXSCH4",14,0)
 Q:'$D(PXS("DIAGNOSIS"))
"RTN","PXSCH4",15,0)
 S PXSDX=0 F  S PXSDX=$O(PXS("DIAGNOSIS",PXSDX)) Q:PXSDX=""  D
"RTN","PXSCH4",16,0)
 .S PXSINDX=PXSINDX+1
"RTN","PXSCH4",17,0)
 .D DXNOD
"RTN","PXSCH4",18,0)
 Q
"RTN","PXSCH4",19,0)
DXNOD ;
"RTN","PXSCH4",20,0)
 S DXNOD0="",$P(DXNOD0,"^")=+$G(PXS("DIAGNOSIS",PXSDX))
"RTN","PXSCH4",21,0)
 S $P(DXNOD0,"^",2)=$G(PXS("PATIENT")) ;PROVIDER
"RTN","PXSCH4",22,0)
 S $P(DXNOD0,"^",3)=$G(PXS("VISIT")) ;VISIT
"RTN","PXSCH4",23,0)
 N ICDDATA,PXSDATE
"RTN","PXSCH4",24,0)
 S PXSDATE=$$CSDATE^PXDXUTL($G(PXS("VISIT")))
"RTN","PXSCH4",25,0)
 S PXSFILE=9000010.07
"RTN","PXSCH4",26,0)
 S ICDDATA=$$ICDDATA^ICDXCODE("DIAG",PXSDX,PXSDATE,"E")
"RTN","PXSCH4",27,0)
 S PXSZPN=$P(ICDDATA,U,4)
"RTN","PXSCH4",28,0)
 S $P(DXNOD0,"^",4)=+$$PROVNARR^PXAPI(PXSZPN,PXSFILE)
"RTN","PXSCH4",29,0)
 Q:$P(DXNOD0,"^",4)=-1
"RTN","PXSCH4",30,0)
 S DXNOD12=""
"RTN","PXSCH4",31,0)
 ;S $P(DXNOD12,"^")=$G(PXS("DATE")) ;DATE AND TIME
"RTN","PXSCH4",32,0)
 ;S $P(DXNOD12,"^",3)=$G(PXS("STOP CODE ORIG")) ;CLINIC STOP
"RTN","PXSCH4",33,0)
 ;S $P(DXNOD12,"^",4)=$G(PXSPR) ;PROVIDER
"RTN","PXSCH4",34,0)
 ;S $P(DXNOD12,"^",5)=$G(PXS("CLINIC")) ;HOSPITAL LOCATION
"RTN","PXSCH4",35,0)
 ;S $P(DXNOD12,"^",7)=$P(DXNOD0,"^",3) ;SECONDARY VISIT
"RTN","PXSCH4",36,0)
 S DXN800=""
"RTN","PXSCH4",37,0)
 I $D(PXS("CLASSIFICATION",1)) S $P(DXN800,"^",2)=1
"RTN","PXSCH4",38,0)
 I $D(PXS("CLASSIFICATION",2)) S $P(DXN800,"^",3)=1
"RTN","PXSCH4",39,0)
 I $D(PXS("CLASSIFICATION",3)) S $P(DXN800,"^",1)=1
"RTN","PXSCH4",40,0)
 I $D(PXS("CLASSIFICATION",4)) S $P(DXN800,"^",4)=1
"RTN","PXSCH4",41,0)
 N PXS1
"RTN","PXSCH4",42,0)
 S PXS1=$P(ICDDATA,U,6)
"RTN","PXSCH4",43,0)
 S PXSZPN=$$GET1^DIQ(80.3,PXS1,.01)
"RTN","PXSCH4",44,0)
 ;--DECIDED TO REMOVE CATEGORY
"RTN","PXSCH4",45,0)
 ;K ^UTILITY("DIQ1",$J)
"RTN","PXSCH4",46,0)
 ;S $P(DXN802,"^",1)=+$$PROVNARR^PXAPI(PXSZPN,PXSFILE)
"RTN","PXSCH4",47,0)
 ;I $P(DXN802,"^",1)'>0 S $P(DXN802,"^",1)=""
"RTN","PXSCH4",48,0)
 S ^TMP("PXK",$J,"POV",PXSINDX+1,0,"AFTER")=$G(DXNOD0)
"RTN","PXSCH4",49,0)
 S ^TMP("PXK",$J,"POV",PXSINDX+1,0,"BEFORE")=""
"RTN","PXSCH4",50,0)
 S ^TMP("PXK",$J,"POV",PXSINDX+1,12,"AFTER")=$G(DXNOD12)
"RTN","PXSCH4",51,0)
 S ^TMP("PXK",$J,"POV",PXSINDX+1,12,"BEFORE")=""
"RTN","PXSCH4",52,0)
 S ^TMP("PXK",$J,"POV",PXSINDX+1,800,"AFTER")=$G(DXN800)
"RTN","PXSCH4",53,0)
 S ^TMP("PXK",$J,"POV",PXSINDX+1,800,"BEFORE")=""
"RTN","PXSCH4",54,0)
 S ^TMP("PXK",$J,"POV",PXSINDX+1,802,"AFTER")=""
"RTN","PXSCH4",55,0)
 S ^TMP("PXK",$J,"POV",PXSINDX+1,802,"BEFORE")=""
"RTN","PXSCH4",56,0)
 S ^TMP("PXK",$J,"POV",PXSINDX+1,"IEN")=""
"RTN","PXSCH4",57,0)
 S ^TMP("PXK",$J,"SOR")=8
"RTN","PXSCH4",58,0)
 S ^TMP("PXK",$J,"VST",1,"IEN")=$G(PXS("VISIT"))
"RTN","PXSCH4",59,0)
DXDUP ;Look for duplicates on the same visit
"RTN","PXSCH4",60,0)
 N XPFG,XP
"RTN","PXSCH4",61,0)
 S (XPFG,XP)=0
"RTN","PXSCH4",62,0)
 F  Q:XPFG  S XP=$O(^AUPNVPOV("AD",PXS("VISIT"),XP)) Q:XP=""  D
"RTN","PXSCH4",63,0)
 .I $P(^AUPNVPOV(XP,0),"^",1)=+$G(PXS("DIAGNOSIS",PXSDX)) D
"RTN","PXSCH4",64,0)
 ..S ^TMP("PXK",$J,"POV",PXSINDX+1,0,"BEFORE")=$G(^AUPNVPOV(XP,0))
"RTN","PXSCH4",65,0)
 ..S ^TMP("PXK",$J,"POV",PXSINDX+1,12,"BEFORE")=$G(^AUPNVPOV(XP,12))
"RTN","PXSCH4",66,0)
 ..S ^TMP("PXK",$J,"POV",PXSINDX+1,800,"BEFORE")=$G(^AUPNVPOV(XP,800))
"RTN","PXSCH4",67,0)
 ..S ^TMP("PXK",$J,"POV",PXSINDX+1,802,"BEFORE")=+$G(^AUPNVPOV(XP,802))
"RTN","PXSCH4",68,0)
 ..S ^TMP("PXK",$J,"POV",PXSINDX+1,"IEN")=XP
"RTN","PXSCH4",69,0)
 ..S XPFG=1
"RTN","PXSCH4",70,0)
 Q
"RTN","PXSELDS")
0^51^B47899921^n/a
"RTN","PXSELDS",1,0)
PXSELDS ;ALB/RBD - Select ICD DIAGNOSIS FROM LEXICON UTILITY LIST ; 19 Mar 2013  10:43 AM
"RTN","PXSELDS",2,0)
 ;;1.0;PCE PATIENT CARE ENCOUNTER;**199**;Aug 12, 1996;Build 51
"RTN","PXSELDS",3,0)
 ;
"RTN","PXSELDS",4,0)
 ; Copied from SROICDL and customized for PCE
"RTN","PXSELDS",5,0)
 ;
"RTN","PXSELDS",6,0)
SEL(PXSRL,X) ; Select from List
"RTN","PXSELDS",7,0)
 ;
"RTN","PXSELDS",8,0)
 ;
"RTN","PXSELDS",9,0)
 ; Input
"RTN","PXSELDS",10,0)
 ;
"RTN","PXSELDS",11,0)
 ;     X     Length of list to display (default 5)
"RTN","PXSELDS",12,0)
 ;    .PXSRL   Local array passed by reference
"RTN","PXSELDS",13,0)
 ;
"RTN","PXSELDS",14,0)
 ;             PXSRL()   Input Array from ICDSRCH^LEX10CS
"RTN","PXSELDS",15,0)
 ;
"RTN","PXSELDS",16,0)
 ;             PXSRL(0)=# found ^ Pruning Indicator
"RTN","PXSELDS",17,0)
 ;             PXSRL(1,0)=Code ^ Code IEN ^ date
"RTN","PXSELDS",18,0)
 ;             PXSRL(1,"IDL")=ICD-9/10 Description, Long
"RTN","PXSELDS",19,0)
 ;             PXSRL(1,"IDL",1)=ICD-9/10 IEN ^ date
"RTN","PXSELDS",20,0)
 ;             PXSRL(1,"IDS")=ICD-9/10 Description, Short
"RTN","PXSELDS",21,0)
 ;             PXSRL(1,"IDS",1)=ICD-9/10 IEN ^ date
"RTN","PXSELDS",22,0)
 ;             PXSRL(1,"LEX")=Lexicon Description
"RTN","PXSELDS",23,0)
 ;             PXSRL(1,"LEX",1)=Expression IEN ^ date
"RTN","PXSELDS",24,0)
 ;             PXSRL(1,"SYN",1)=Synonym #1
"RTN","PXSELDS",25,0)
 ;             PXSRL(1,"SYN",m)=Synonym #m
"RTN","PXSELDS",26,0)
 ;             ...
"RTN","PXSELDS",27,0)
 ;
"RTN","PXSELDS",28,0)
 ; Output
"RTN","PXSELDS",29,0)
 ;
"RTN","PXSELDS",30,0)
 ;    $$SEL  Two Piece "^" delimited string same as
"RTN","PXSELDS",31,0)
 ;           Fileman's Y output variable
"RTN","PXSELDS",32,0)
 ;
"RTN","PXSELDS",33,0)
 ;             1  Lexicon IEN
"RTN","PXSELDS",34,0)
 ;             2  Lexicon Term
"RTN","PXSELDS",35,0)
 ;
"RTN","PXSELDS",36,0)
 ;    PXSRL    Local array passed by reference
"RTN","PXSELDS",37,0)
 ;
"RTN","PXSELDS",38,0)
 ;             PXSRL(0)=Code ^ Code IEN ^ date
"RTN","PXSELDS",39,0)
 ;             PXSRL("IDL")=ICD-9/10 Description, Long
"RTN","PXSELDS",40,0)
 ;             PXSRL("IDL",1)=ICD-9/10 IEN ^ date
"RTN","PXSELDS",41,0)
 ;             PXSRL("IDS")=ICD-9/10 Description, Short
"RTN","PXSELDS",42,0)
 ;             PXSRL("IDS",1)=ICD-9/10 IEN ^ date
"RTN","PXSELDS",43,0)
 ;             PXSRL("LEX")=Lexicon Description
"RTN","PXSELDS",44,0)
 ;             PXSRL("LEX",1)=Expression IEN ^ date
"RTN","PXSELDS",45,0)
 ;
"RTN","PXSELDS",46,0)
 ;    or ^ on error
"RTN","PXSELDS",47,0)
 ;    or -1 for non-selection
"RTN","PXSELDS",48,0)
 ;
"RTN","PXSELDS",49,0)
 S X=+($G(X)) S:X'>0 X=5 S X=$$ASK(.PXSRL,X)
"RTN","PXSELDS",50,0)
 Q X
"RTN","PXSELDS",51,0)
ASK(PXSRL,X) ; Ask for Selection
"RTN","PXSELDS",52,0)
 N PXSRLIT,PXSRLL,PXSRLTOT S PXSRLL=+($G(X)) S:PXSRLL'>0 PXSRLL=5
"RTN","PXSELDS",53,0)
 S PXSRLIT=0,PXSRLTOT=$O(PXSRL(" "),-1) Q:+PXSRLTOT'>0 "^"
"RTN","PXSELDS",54,0)
 K X S:+PXSRLTOT=1 X=$$ONE(PXSRLL,.PXSRL) S:+PXSRLTOT>1 X=$$MUL(.PXSRL,PXSRLL)
"RTN","PXSELDS",55,0)
 I "D@"[X Q "@"  ; user wants to delete the existing entry
"RTN","PXSELDS",56,0)
 S:'$D(DTOUT)&('$D(DUOUT))&('$D(DIROUT))&(+($G(X))'>0) X=-1
"RTN","PXSELDS",57,0)
 Q X
"RTN","PXSELDS",58,0)
ONE(X,PXSRL) ; One Entry Found
"RTN","PXSELDS",59,0)
 Q:+($G(PXSRLIT))>0 "^^"
"RTN","PXSELDS",60,0)
 N DIR,PXNXTLIN,PXSRLC,PXSRLEX,PXSRLFI,PXSRLIT,PXSRLNC,PXSRLSO,PXSRLSP,PXSRLTX,Y
"RTN","PXSELDS",61,0)
 S PXSRLFI=$O(PXSRL(0)) Q:+PXSRLFI'>0 "^"  S PXSRLSP=$J(" ",11)
"RTN","PXSELDS",62,0)
 S PXSRLSO=$P(PXSRL(1,0),"^",1),PXSRLNC=$P(PXSRL(1,0),"^",3)
"RTN","PXSELDS",63,0)
 S:+PXSRLNC>0 PXSRLNC=" ("_PXSRLNC_")" S PXSRLEX=$G(PXSRL(1,"MENU"))
"RTN","PXSELDS",64,0)
 S PXSRLC=$S($D(PXSRL(1,"CAT")):"-",1:"")
"RTN","PXSELDS",65,0)
 S PXSRLTX(1)=PXSRLSO_PXSRLC_$J(" ",(9-$L(PXSRLSO)))_" "_PXSRLEX_PXSRLNC
"RTN","PXSELDS",66,0)
 D PR(.PXSRLTX,64) S DIR("A",1)=" One code found",DIR("A",2)=" "
"RTN","PXSELDS",67,0)
 S DIR("A",3)=" "_$G(PXSRLTX(1)),PXSRLC=3 I $L($G(PXSRLTX(2))) D
"RTN","PXSELDS",68,0)
 . F PXNXTLIN=2:1 Q:$G(PXSRLTX(PXNXTLIN))=""  D
"RTN","PXSELDS",69,0)
 .. S PXSRLC=PXSRLC+1,DIR("A",PXSRLC)=PXSRLSP_$G(PXSRLTX(PXNXTLIN))
"RTN","PXSELDS",70,0)
 S PXSRLC=PXSRLC+1,DIR("A",PXSRLC)=" ",PXSRLC=PXSRLC+1
"RTN","PXSELDS",71,0)
 D SET1:$D(PXDEF),SET2:'$D(PXDEF)
"RTN","PXSELDS",72,0)
 D ^DIR S Y=Y="Y"
"RTN","PXSELDS",73,0)
 I X'="","Dd@"[X Q "@"  ; user wants to delete the existing entry
"RTN","PXSELDS",74,0)
 Q:'$D(DTOUT)&('$D(DUOUT))&('$D(DIROUT))&((+$G(Y))'>0) -1
"RTN","PXSELDS",75,0)
 S:X["^^"!($D(DTOUT)) PXSRLIT=1
"RTN","PXSELDS",76,0)
 I X["^^"!(+($G(PXSRLIT))>0) K PXSRL Q "^^"
"RTN","PXSELDS",77,0)
 S X=$S(+Y>0:$$X(1,.PXSRL),1:-1)
"RTN","PXSELDS",78,0)
 Q X
"RTN","PXSELDS",79,0)
MUL(PXSRL,Y) ; Multiple Entries Found
"RTN","PXSELDS",80,0)
 Q:+($G(PXSRLIT))>0 "^^"  N PXSRLE,PXSRLL,PXSRLMAX,PXSRLSS,PXSRLX,X
"RTN","PXSELDS",81,0)
 S (PXSRLMAX,PXSRLSS,PXSRLIT)=0,PXSRLL=+($G(Y)),U="^" S:+($G(PXSRLL))'>0 PXSRLL=5
"RTN","PXSELDS",82,0)
 S PXSRLX=$O(PXSRL(" "),-1),PXSRLSS=0
"RTN","PXSELDS",83,0)
 G:+PXSRLX=0 MULQ W ! W:+PXSRLX>1 !," ",PXSRLX," matches found"
"RTN","PXSELDS",84,0)
 F PXSRLE=1:1:PXSRLX Q:((PXSRLSS>0)&(PXSRLSS<(PXSRLE+1)))  Q:PXSRLIT  D  Q:PXSRLIT
"RTN","PXSELDS",85,0)
 . W:PXSRLE#PXSRLL=1 ! D MULW
"RTN","PXSELDS",86,0)
 . S PXSRLMAX=PXSRLE W:PXSRLE#PXSRLL=0 !
"RTN","PXSELDS",87,0)
 . S:PXSRLE#PXSRLL=0 PXSRLSS=$$MULS(PXSRLMAX,PXSRLE,.PXSRL) S:PXSRLSS["^" PXSRLIT=1
"RTN","PXSELDS",88,0)
 I PXSRLE#PXSRLL'=0,+PXSRLSS<=0 D
"RTN","PXSELDS",89,0)
 . W ! S PXSRLSS=$$MULS(PXSRLMAX,PXSRLE,.PXSRL) S:PXSRLSS["^" PXSRLIT=1
"RTN","PXSELDS",90,0)
 G MULQ
"RTN","PXSELDS",91,0)
 Q X
"RTN","PXSELDS",92,0)
MULW ; Write Multiple
"RTN","PXSELDS",93,0)
 N PXSRLEX,PXSRLI,PXSRLSO,PXSRLNC,PXSRLT,PXSRLTX S PXSRLSO=$P(PXSRL(+PXSRLE,0),"^",1)
"RTN","PXSELDS",94,0)
 S PXSRLNC=$P(PXSRL(+PXSRLE,0),"^",3) S:+PXSRLNC>0 PXSRLNC=" ("_PXSRLNC_")"
"RTN","PXSELDS",95,0)
 S PXSRLEX=$G(PXSRL(+PXSRLE,"MENU")),PXSRLTX(1)=PXSRLSO
"RTN","PXSELDS",96,0)
 S PXSRLTX(1)=PXSRLTX(1)_$S($D(PXSRL(+PXSRLE,"CAT")):"-",1:" ")_$J(" ",(9-$L(PXSRLSO)))_" "_PXSRLEX_PXSRLNC
"RTN","PXSELDS",97,0)
 D PR(.PXSRLTX,60) W !,$J(PXSRLE,5),".  ",$G(PXSRLTX(1))
"RTN","PXSELDS",98,0)
 F PXSRLI=2:1:5 S PXSRLT=$G(PXSRLTX(PXSRLI)) W:$L(PXSRLT) !,$J(" ",19),PXSRLT
"RTN","PXSELDS",99,0)
 Q
"RTN","PXSELDS",100,0)
MULS(X,Y,PXSRL) ; Select from Multiple Entries
"RTN","PXSELDS",101,0)
 N DIR,DIRB,PXSRLFI,PXSRLHLP,PXSLLAST,PXSRLMAX,PXSRLS
"RTN","PXSELDS",102,0)
 Q:+($G(PXSRLIT))>0 "^^"  S PXSRLMAX=+($G(X)),PXSLLAST=+($G(Y))
"RTN","PXSELDS",103,0)
 Q:PXSRLMAX=0 -1 S PXSRLFI=$O(PXSRL(0)) Q:+PXSRLFI'>0 -1
"RTN","PXSELDS",104,0)
 I +($O(PXSRL(+PXSLLAST)))>0 D
"RTN","PXSELDS",105,0)
 . S DIR("A")=" Press <RETURN> for more, ""^"" to exit, or Select 1-"
"RTN","PXSELDS",106,0)
 . S DIR("A")=DIR("A")_PXSRLMAX_": "
"RTN","PXSELDS",107,0)
 I +($O(PXSRL(+PXSLLAST)))'>0 D
"RTN","PXSELDS",108,0)
 . S DIR("A")=" Select 1-"_PXSRLMAX_": "
"RTN","PXSELDS",109,0)
 S PXSRLHLP=" Answer must be from 1 to "
"RTN","PXSELDS",110,0)
 S PXSRLHLP=PXSRLHLP_PXSRLMAX_", or <Return> to continue"
"RTN","PXSELDS",111,0)
 S DIR("PRE")="S:X[""?"" X=""??"""
"RTN","PXSELDS",112,0)
 S (DIR("?"),DIR("??"))="^D MULSH^PXSELDS"
"RTN","PXSELDS",113,0)
 S DIR(0)="NAO^1:"_PXSRLMAX_":0" D ^DIR
"RTN","PXSELDS",114,0)
 Q:'$D(DTOUT)&('$D(DUOUT))&('$D(DIROUT))&(+($G(Y))'>0) -1
"RTN","PXSELDS",115,0)
 S:X["^^"!($D(DTOUT)) PXSRLIT=1,X="^^" I X["^^"!(+($G(PXSRLIT))>0) Q "^^"
"RTN","PXSELDS",116,0)
 K DIR Q:$D(DTOUT)!(X[U) "^^"
"RTN","PXSELDS",117,0)
 Q $S(+Y>0:+Y,1:"-1")
"RTN","PXSELDS",118,0)
MULSH ; Select from Multiple Entries Help
"RTN","PXSELDS",119,0)
 I $L($G(PXSRLHLP)) W !,$G(PXSRLHLP) Q
"RTN","PXSELDS",120,0)
 Q
"RTN","PXSELDS",121,0)
MULQ ; Quit Multiple
"RTN","PXSELDS",122,0)
 I +PXSRLSS'>0,$G(PXSRLSS)="^" Q "^"
"RTN","PXSELDS",123,0)
 S X=-1 S:+($G(PXSRLIT))'>0 X=$$X(+PXSRLSS,.PXSRL)
"RTN","PXSELDS",124,0)
 Q X
"RTN","PXSELDS",125,0)
X(X,PXSRL) ; Set X and Output Array
"RTN","PXSELDS",126,0)
 N PXSRLEX,PXSRFI,PXSRLIEN,PXSRLN,PXSRLNC,PXSRLNN,PXSRLRN,PXSRLS,PXSRLSO
"RTN","PXSELDS",127,0)
 S PXSRLS=+($G(X)) S PXSRFI=$O(PXSRL(0))
"RTN","PXSELDS",128,0)
 S PXSRLSO=$P($G(PXSRL(PXSRLS,0)),"^",1),PXSRLEX=$G(PXSRL(PXSRLS,"MENU"))
"RTN","PXSELDS",129,0)
 S PXSRLIEN=$S($D(PXSRL(PXSRLS,"CAT")):"99:CAT;"_$P($G(PXSRL(PXSRLS,0)),"^"),1:$P($G(PXSRL(PXSRLS,"LEX",1)),"^")_";"_$P($G(PXSRL(PXSRLS,0)),"^")) Q:'$L(PXSRLSO) "^"
"RTN","PXSELDS",130,0)
 Q:'$L(PXSRLEX) "^"  Q:+PXSRLIEN'>0 "^" S X=PXSRLIEN_"^"_PXSRLEX
"RTN","PXSELDS",131,0)
 S PXSRLNN="PXSRL("_+PXSRLS_")",PXSRLNC="PXSRL("_+PXSRLS_","
"RTN","PXSELDS",132,0)
 F  S PXSRLNN=$Q(@PXSRLNN) Q:'$L(PXSRLNN)!(PXSRLNN'[PXSRLNC)  D
"RTN","PXSELDS",133,0)
 . S PXSRLRN="PXSRLN("_$P(PXSRLNN,"(",2,299) S @PXSRLRN=@PXSRLNN
"RTN","PXSELDS",134,0)
 K PXSRL S PXSRLNN="PXSRLN("_+PXSRLS_")",PXSRLNC="PXSRLN("_+PXSRLS_","
"RTN","PXSELDS",135,0)
 F  S PXSRLNN=$Q(@PXSRLNN) Q:'$L(PXSRLNN)!(PXSRLNN'[PXSRLNC)  D
"RTN","PXSELDS",136,0)
 . S PXSRLRN="PXSRL("_$P(PXSRLNN,"(",2,299),@PXSRLRN=@PXSRLNN
"RTN","PXSELDS",137,0)
 Q X
"RTN","PXSELDS",138,0)
 ;
"RTN","PXSELDS",139,0)
 ; Miscellaneous
"RTN","PXSELDS",140,0)
CL ; Clear
"RTN","PXSELDS",141,0)
 K PXSRLIT
"RTN","PXSELDS",142,0)
 Q
"RTN","PXSELDS",143,0)
 ;
"RTN","PXSELDS",144,0)
PR(PXSRL,X) ; Parse Array
"RTN","PXSELDS",145,0)
 N DIW,DIWF,DIWI,DIWL,DIWR,DIWT,DIWTC,DIWX,DN,I,Z,%,%D,PXSRLC,PXSRLI,PXSRLL
"RTN","PXSELDS",146,0)
 K ^UTILITY($J,"W") Q:'$D(PXSRL)  S PXSRLL=+($G(X)) S:+PXSRLL'>0 PXSRLL=79
"RTN","PXSELDS",147,0)
 S PXSRLC=+($G(PXSRL)) S:+($G(PXSRLC))'>0 PXSRLC=$O(PXSRL(" "),-1) Q:+PXSRLC'>0
"RTN","PXSELDS",148,0)
 S DIWL=1,DIWF="C"_+PXSRLL S PXSRLI=0
"RTN","PXSELDS",149,0)
 F  S PXSRLI=$O(PXSRL(PXSRLI)) Q:+PXSRLI=0  S X=$G(PXSRL(PXSRLI)) D ^DIWP
"RTN","PXSELDS",150,0)
 K PXSRL S (PXSRLC,PXSRLI)=0
"RTN","PXSELDS",151,0)
 F  S PXSRLI=$O(^UTILITY($J,"W",1,PXSRLI)) Q:+PXSRLI=0  D
"RTN","PXSELDS",152,0)
 . S PXSRL(PXSRLI)=$$TM($G(^UTILITY($J,"W",1,PXSRLI,0))," "),PXSRLC=PXSRLC+1
"RTN","PXSELDS",153,0)
 S:$L(PXSRLC) PXSRL=PXSRLC K ^UTILITY($J,"W")
"RTN","PXSELDS",154,0)
 Q
"RTN","PXSELDS",155,0)
 ;
"RTN","PXSELDS",156,0)
TM(X,Y) ; Trim Character Y - Default " "
"RTN","PXSELDS",157,0)
 S X=$G(X) Q:X="" X S Y=$G(Y) S:'$L(Y) Y=" "
"RTN","PXSELDS",158,0)
 F  Q:$E(X,1)'=Y  S X=$E(X,2,$L(X))
"RTN","PXSELDS",159,0)
 F  Q:$E(X,$L(X))'=Y  S X=$E(X,1,($L(X)-1))
"RTN","PXSELDS",160,0)
 Q X
"RTN","PXSELDS",161,0)
 ;
"RTN","PXSELDS",162,0)
SET1 ; Use this if a default ICD-10 code was supplied
"RTN","PXSELDS",163,0)
 S DIR("A")="OK? ",DIR("B")="YES",DIR(0)="SAOB^Y:Yes;N:No;D:Delete;@:Delete"
"RTN","PXSELDS",164,0)
 S DIR("L",1)="  Y - Yes      |    @ - Delete"
"RTN","PXSELDS",165,0)
 S DIR("L",2)="  N - No       |    ? - Help"
"RTN","PXSELDS",166,0)
 S DIR("L",3)="  D - Delete   |   ?? - Extra Help"
"RTN","PXSELDS",167,0)
 S DIR("L")="               |    ^ - Exit"
"RTN","PXSELDS",168,0)
 Q
"RTN","PXSELDS",169,0)
 ;
"RTN","PXSELDS",170,0)
SET2 ; Use this if no default ICD-10 code was supplied
"RTN","PXSELDS",171,0)
 S DIR("A")="OK? ",DIR("B")="YES",DIR(0)="SAOB^Y:Yes;N:No"
"RTN","PXSELDS",172,0)
 S DIR("L",1)="  Y - Yes      |    ? - Help"
"RTN","PXSELDS",173,0)
 S DIR("L",2)="  N - No       |   ?? - Extra Help"
"RTN","PXSELDS",174,0)
 S DIR("L")="               |    ^ - Exit"
"RTN","PXSELDS",175,0)
 Q
"RTN","PXUTL1")
0^1^B11838187^B10780309
"RTN","PXUTL1",1,0)
PXUTL1 ;ISL/dee - Utility routines used by PCE ;4/3/97
"RTN","PXUTL1",2,0)
 ;;1.0;PCE PATIENT CARE ENCOUNTER;**25,134,149,199**;Aug 12, 1996;Build 51
"RTN","PXUTL1",3,0)
 ;; ;
"RTN","PXUTL1",4,0)
 Q
"RTN","PXUTL1",5,0)
 ;
"RTN","PXUTL1",6,0)
EXTTEXT(IEN,REQUIRED,FILE,FIELD1,FIELD2) ;Returns the external form.
"RTN","PXUTL1",7,0)
 ;* 1/24/2012 - ICD-10 REMEDIATION note
"RTN","PXUTL1",8,0)
 ;* This function was being used mostly to retrieve the diagnosis description.
"RTN","PXUTL1",9,0)
 ;* The DESCRIPTION field in file #80 is now a multiple and does not work
"RTN","PXUTL1",10,0)
 ;* with this function so most of the routines that were using this have been
"RTN","PXUTL1",11,0)
 ;* recoded.  This function is still viable as a DIC wrapper but must be used
"RTN","PXUTL1",12,0)
 ;* for 'flat' fields and not multiples.
"RTN","PXUTL1",13,0)
 ;
"RTN","PXUTL1",14,0)
 ;Parameters:
"RTN","PXUTL1",15,0)
 ;  IEN       the ien in the file that the text is wanted for.
"RTN","PXUTL1",16,0)
 ;  REQUIRED  if this is not zero and no text is found
"RTN","PXUTL1",17,0)
 ;              then "UNKNOWN" is returned.
"RTN","PXUTL1",18,0)
 ;  FILE      the file number
"RTN","PXUTL1",19,0)
 ;  FIELD1    the field number that the text is in
"RTN","PXUTL1",20,0)
 ;  FIELD2    if the parameter is passed and there is no text
"RTN","PXUTL1",21,0)
 ;              in field1 then the text in this field will be
"RTN","PXUTL1",22,0)
 ;              returned if there is some.
"RTN","PXUTL1",23,0)
 ;
"RTN","PXUTL1",24,0)
 N DIC,DR,DA,DIQ,PXUTDIQ1,PXTEXT,Y,X
"RTN","PXUTL1",25,0)
 I $G(FILE)>0,$G(FIELD1)>0 D
"RTN","PXUTL1",26,0)
 . S DIC=FILE
"RTN","PXUTL1",27,0)
 . S DR=FIELD1
"RTN","PXUTL1",28,0)
 . S:$G(FIELD2)>0 DR=DR_";"_FIELD2
"RTN","PXUTL1",29,0)
 . S DA=IEN
"RTN","PXUTL1",30,0)
 . S DIQ="PXUTDIQ1("
"RTN","PXUTL1",31,0)
 . S DIQ(0)="E"
"RTN","PXUTL1",32,0)
 . D EN^DIQ1
"RTN","PXUTL1",33,0)
 . I $G(PXUTDIQ1(FILE,DA,FIELD1,"E"))]"" S PXTEXT=PXUTDIQ1(FILE,DA,FIELD1,"E")
"RTN","PXUTL1",34,0)
 . E  I $G(FIELD2)>0,$G(PXUTDIQ1(FILE,DA,FIELD2,"E"))]"" S PXTEXT=PXUTDIQ1(FILE,DA,FIELD2,"E")
"RTN","PXUTL1",35,0)
 . E  I REQUIRED S PXTEXT="UNKNOWN"
"RTN","PXUTL1",36,0)
 E  I REQUIRED S PXTEXT="UNKNOWN"
"RTN","PXUTL1",37,0)
 Q PXTEXT
"RTN","PXUTL1",38,0)
 ;
"RTN","PXUTL1",39,0)
PRIMVPRV(PXUTVST) ;Returns the primary provider if there is one
"RTN","PXUTL1",40,0)
 ;                 for the passed visit otherwise returns 0.
"RTN","PXUTL1",41,0)
 N PXCATEMP
"RTN","PXUTL1",42,0)
 S PXCATEMP=$$PRIMSEC(PXUTVST,"^AUPNVPRV",0,4)
"RTN","PXUTL1",43,0)
 Q $S(PXCATEMP>0:$P(^AUPNVPRV(PXCATEMP,0),"^"),1:0)
"RTN","PXUTL1",44,0)
 ;
"RTN","PXUTL1",45,0)
PRIMVPOV(PXUTVST) ;Returns the primary diagnosis if there is one
"RTN","PXUTL1",46,0)
 ;         for the passed visit otherwise returns 0.
"RTN","PXUTL1",47,0)
 N PXCATEMP
"RTN","PXUTL1",48,0)
 S PXCATEMP=$$PRIMSEC(PXUTVST,"^AUPNVPOV",0,12)
"RTN","PXUTL1",49,0)
 Q $S(PXCATEMP>0:$P(^AUPNVPOV(PXCATEMP,0),"^"),1:0)
"RTN","PXUTL1",50,0)
 ;
"RTN","PXUTL1",51,0)
PRIMSEC(PXUTVST,PXUTAUPN,PXUTNODE,PXUPIECE) ;Returns ien of the primary one
"RTN","PXUTL1",52,0)
 ;         if there is one for the passed visit otherwise returns 0.
"RTN","PXUTL1",53,0)
 ; Parameters:
"RTN","PXUTL1",54,0)
 ;   PXUTVST   Pointer to the visit
"RTN","PXUTL1",55,0)
 ;   PXUTAUPN  V-File global e.g. "^AUPNVPRV"
"RTN","PXUTL1",56,0)
 ;   PXUTNODE  The node that the Primary/Secondary field is on
"RTN","PXUTL1",57,0)
 ;   PXUPIECE  The piece of the Primary/Secondary field
"RTN","PXUTL1",58,0)
 ;
"RTN","PXUTL1",59,0)
 N PXUTPRIM
"RTN","PXUTL1",60,0)
 S PXUTPRIM=0
"RTN","PXUTL1",61,0)
 F  S PXUTPRIM=$O(@(PXUTAUPN_"(""AD"",PXUTVST,PXUTPRIM)")) Q:PXUTPRIM'>0  I "P"=$P(@(PXUTAUPN_"(PXUTPRIM,PXUTNODE)"),"^",PXUPIECE) Q
"RTN","PXUTL1",62,0)
 Q +PXUTPRIM
"RTN","PXUTL1",63,0)
 ;
"RTN","PXUTL1",64,0)
DISPOSIT(PXUTLDFN,PXUTLDT,PXUTVIEN) ;Checks to see if a visit is a disposition
"RTN","PXUTL1",65,0)
 I PXUTVIEN=+$P($G(^SCE(+$P($G(^DPT(+PXUTLDFN,"DIS",9999999-PXUTLDT,0)),"^",18),0)),"^",5) Q +$P($G(^DPT(+PXUTLDFN,"DIS",9999999-PXUTLDT,0)),"^",18)
"RTN","PXUTL1",66,0)
 Q 0
"RTN","PXUTL1",67,0)
 ;
"RTN","PXUTL1",68,0)
APPOINT(PXUTLDFN,PXUTLDT,HLOC) ;Returns 1 if the patient has an appointment
"RTN","PXUTL1",69,0)
 ;at PXUTLDT for clinic HLOC.
"RTN","PXUTL1",70,0)
 Q HLOC=+$G(^DPT(+PXUTLDFN,"S",+PXUTLDT,0))
"RTN","PXUTL1",71,0)
 ;
"RTN","PXUTL1",72,0)
VST2APPT(VISIT) ;Is this visit related to an appointment
"RTN","PXUTL1",73,0)
 ;Returns
"RTN","PXUTL1",74,0)
 ; 1 if the visit is being pointed to by an appointment
"RTN","PXUTL1",75,0)
 ; 0 if the visit is NOT being pointed to by an appointment
"RTN","PXUTL1",76,0)
 ;-1 if the visit is invalid
"RTN","PXUTL1",77,0)
 ;
"RTN","PXUTL1",78,0)
 N VISIT0
"RTN","PXUTL1",79,0)
 S VISIT0=$G(^AUPNVSIT($G(VISIT),0))
"RTN","PXUTL1",80,0)
 Q:VISIT0="" -1
"RTN","PXUTL1",81,0)
 Q $$VSTAPPT($P(VISIT0,"^",5),$P(VISIT0,"^",1),$P(VISIT0,"^",22),VISIT)
"RTN","PXUTL1",82,0)
 ;
"RTN","PXUTL1",83,0)
VSTAPPT(PXUTLPAT,PXUTLDT,PXUTLLOC,PXUTLVST) ;Returns 1 if the visit is being pointed to by an
"RTN","PXUTL1",84,0)
 ;                appointment otherwise 0.
"RTN","PXUTL1",85,0)
 I PXUTLLOC]"",PXUTLLOC=+$G(^DPT(+PXUTLPAT,"S",+PXUTLDT,0)),PXUTLVST=+$P($G(^SCE(+$P($G(^DPT(PXUTLPAT,"S",PXUTLDT,0)),"^",20),0)),"^",5) Q 1
"RTN","PXUTL1",86,0)
 Q 0
"RTN","PXUTL1",87,0)
 ;
"RTN","PXUTL1",88,0)
APPT2VST(PXUTLPAT,PXUTLDT,HLOC) ;Returns ien of visit that the related
"RTN","PXUTL1",89,0)
 ;appointment points to at PXUTLDT for clinic HLOC otherwise 0.
"RTN","PXUTL1",90,0)
 I HLOC=+$G(^DPT(+PXUTLPAT,"S",+PXUTLDT,0)) Q +$P($G(^SCE(+$P($G(^DPT(PXUTLPAT,"S",PXUTLDT,0)),"^",20),0)),"^",5)
"RTN","PXUTL1",91,0)
 Q 0
"RTN","PXUTL1",92,0)
 ;
"RTN","PXUTL1",93,0)
DXNARR(PXDXCDE,PXUTLDT) ;Returns the versioned full text from file #80, field #68
"RTN","PXUTL1",94,0)
 N PXLDX,PXNO,PXCOD
"RTN","PXUTL1",95,0)
 I $G(PXDXCDE)="" Q ""
"RTN","PXUTL1",96,0)
 S:$G(PXUTLDT)="" PXUTLDT=DT
"RTN","PXUTL1",97,0)
 S PXCOD=$P($$ICDDATA^ICDXCODE("DIAG",PXDXCDE,PXUTLDT,"I"),U,2)
"RTN","PXUTL1",98,0)
 S PXNO=$$ICDDESC^ICDXCODE("DIAG",PXCOD,PXUTLDT,.PXLDX)
"RTN","PXUTL1",99,0)
 Q $S(PXNO>0:PXLDX(1),1:"")
"RTN","PXUTL1",100,0)
 ;
"VER")
8.0^22.0
"^DD",9000010.07,9000010.07,.01,0)
POV^R*P80'X^ICD9(^0;1^S:$D(APCDEIN) APCDTPCC="" S DIC("S")="D ^AUPNSICD" D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"^DD",9000010.07,9000010.07,.01,1,0)
^.1^^-1
"^DD",9000010.07,9000010.07,.01,1,1,0)
9000010.07^B
"^DD",9000010.07,9000010.07,.01,1,1,1)
S ^AUPNVPOV("B",$E(X,1,30),DA)=""
"^DD",9000010.07,9000010.07,.01,1,1,2)
K ^AUPNVPOV("B",$E(X,1,30),DA)
"^DD",9000010.07,9000010.07,.01,3)
Enter the ICD Diagnosis code or text for the problem treated at the encounter.
"^DD",9000010.07,9000010.07,.01,12)
POV CANNOT BE AN INACTIVE CODE
"^DD",9000010.07,9000010.07,.01,12.1)
S DIC("S")="D ^AUPNSICD"
"^DD",9000010.07,9000010.07,.01,21,0)
^.001^16^16^3120404^^^^
"^DD",9000010.07,9000010.07,.01,21,1,0)
POV is an abbreviation for "Purpose of Visit".  Since Purpose of Visit is
"^DD",9000010.07,9000010.07,.01,21,2,0)
often confused with "Chief complaint", another abbreviation might better
"^DD",9000010.07,9000010.07,.01,21,3,0)
be  "Problem of Visit".  This is the Provider's conclusion about what was
"^DD",9000010.07,9000010.07,.01,21,4,0)
treated at the visit.  The Provider should be able to indicate a preferred
"^DD",9000010.07,9000010.07,.01,21,5,0)
narrative for what was treated and an ICD Diagnosis code.  If the problem
"^DD",9000010.07,9000010.07,.01,21,6,0)
treated is from the Problem List, then the problem list entry information
"^DD",9000010.07,9000010.07,.01,21,7,0)
can be used for the "Problem of Visit" entry.  The provider can
"^DD",9000010.07,9000010.07,.01,21,8,0)
alternatively have this information automatically captured via scanned
"^DD",9000010.07,9000010.07,.01,21,9,0)
Encounter Forms (e.g., AICS - the VA's Encounter Form Data Capture
"^DD",9000010.07,9000010.07,.01,21,10,0)
package).
"^DD",9000010.07,9000010.07,.01,21,11,0)
 
"^DD",9000010.07,9000010.07,.01,21,12,0)
At VA facilities, the ICD Diagnosis is screened by Inactive Code and it
"^DD",9000010.07,9000010.07,.01,21,13,0)
must be appropriate for the Patient's age and sex.
"^DD",9000010.07,9000010.07,.01,21,14,0)
 
"^DD",9000010.07,9000010.07,.01,21,15,0)
At IHS facilities, the ICD Diagnosis is screened by Inactive Code,
"^DD",9000010.07,9000010.07,.01,21,16,0)
appropriate for the Patient's age and sex, and Not "E" codes.
"^DD",9000010.07,9000010.07,.01,23,0)
^.001^1^1^3120404^^^^
"^DD",9000010.07,9000010.07,.01,23,1,0)
This is a pointer to the ICD Diagnosis (#80) file.
"^DD",9000010.07,9000010.07,.01,"AUDIT")
n
"^DD",9000010.07,9000010.07,.01,"DT")
3120202
"^DD",9000010.07,9000010.07,.019,0)
ICD NARRATIVE^CJ60^^ ; ^S X="" I $T(SDESC^PXDXUTL)'="" S X=$$SDESC^PXDXUTL(D0)
"^DD",9000010.07,9000010.07,.019,9)
^
"^DD",9000010.07,9000010.07,.019,9.01)

"^DD",9000010.07,9000010.07,.019,9.1)
S X="" I $T(SDESC^PXDXUTL)'="" S X=$$SDESC^PXDXUTL(D0)
"^DD",9000010.07,9000010.07,.019,21,0)
^^2^2^3120213^
"^DD",9000010.07,9000010.07,.019,21,1,0)
This is the computed diagnosis narrative that is defined in the ICD Diagnosis
"^DD",9000010.07,9000010.07,.019,21,2,0)
file for the ICD Diagnosis code identified in the POV (.01) field.
"^DD",9000010.07,9000010.07,.019,"DT")
3120213
"^DD",9000010.07,9000010.07,.15,0)
CLINICAL TERM^P757.01'^LEX(757.01,^0;15^Q
"^DD",9000010.07,9000010.07,.15,3)
Enter the provider narrative or clinical terminology for the diagnosis treated.
"^DD",9000010.07,9000010.07,.15,21,0)
^.001^7^7^3120210^^^
"^DD",9000010.07,9000010.07,.15,21,1,0)
This field is the clinical lexicon term which most closely represents
"^DD",9000010.07,9000010.07,.15,21,2,0)
the provider narrative of the problem treated.
"^DD",9000010.07,9000010.07,.15,21,3,0)
 
"^DD",9000010.07,9000010.07,.15,21,4,0)
At VA facilities: The clinical lexicon is automatically captured via
"^DD",9000010.07,9000010.07,.15,21,5,0)
encounter form data capture (AICS package) when the of problem being 
"^DD",9000010.07,9000010.07,.15,21,6,0)
treated is from the Active Problem List.  In the manual data entry
"^DD",9000010.07,9000010.07,.15,21,7,0)
process, there is currently no prompt for the clinical term.
"^DD",9000010.07,9000010.07,.15,23,0)
^.001^4^4^3120210^^^
"^DD",9000010.07,9000010.07,.15,23,1,0)
This field was created by the VA to capture the clinical lexicon term,
"^DD",9000010.07,9000010.07,.15,23,2,0)
as an alternative to, or in addition to the ICD Diagnosis code.  This
"^DD",9000010.07,9000010.07,.15,23,3,0)
field will primarily be populated when the diagnosis being treated at a
"^DD",9000010.07,9000010.07,.15,23,4,0)
visit is based on an entry in the Active Problem List.
"^DD",9000010.07,9000010.07,.15,"DT")
2940518
"^DD",9000010.07,9000010.07,80006,0)
HEAD AND/OR NECK CANCER^S^1:YES;0:NO;^800;6^Q
"^DD",9000010.07,9000010.07,80006,3)
If this Diagnosis is treating a problem related to Head/Neck Cancer.
"^DD",9000010.07,9000010.07,80006,21,0)
^.001^2^2^3120210^^^^
"^DD",9000010.07,9000010.07,80006,21,1,0)
This field will be used to indicate if this Diagnosis code was
"^DD",9000010.07,9000010.07,80006,21,2,0)
related to Head and/or Neck Cancer.
"^DD",9000010.07,9000010.07,80006,"DT")
3030613
"^DD",9000010.18,9000010.18,.05,0)
DIAGNOSIS^*P80'X^ICD9(^0;5^D ICDEN^PXCECPT1 K:Y<0 X
"^DD",9000010.18,9000010.18,.05,3)
Enter the ICD Diagnosis related to the procedure done.
"^DD",9000010.18,9000010.18,.05,12)
Dx cannot be an inactive code, and it must be appropriate
"^DD",9000010.18,9000010.18,.05,12.1)
S DIC("S")="D ^AUPNSICD" S DIC(0)=$P(DIC(0),"E")_$P(DIC(0),"E",2)
"^DD",9000010.18,9000010.18,.05,21,0)
^.001^2^2^3120514^^^^
"^DD",9000010.18,9000010.18,.05,21,1,0)
This is the diagnosis, from the ICD Diagnosis file, associated
"^DD",9000010.18,9000010.18,.05,21,2,0)
with the procedure performed.
"^DD",9000010.18,9000010.18,.05,"DT")
3050907
"^DD",9000010.18,9000010.18,.09,0)
DIAGNOSIS 2^*P80'X^ICD9(^0;9^D ICDEN^PXCECPT1 K:Y<0 X
"^DD",9000010.18,9000010.18,.09,3)
Enter the ICD Diagnosis related to the procedure done.
"^DD",9000010.18,9000010.18,.09,12)
Dx cannot be an inactive code, and it must be appropriat
"^DD",9000010.18,9000010.18,.09,12.1)
S DIC("S")="D ^AUPNSICD" S DIC(0)=$P(DIC(0),"E")_$P(DIC(0),"E",2)
"^DD",9000010.18,9000010.18,.09,21,0)
^.001^2^2^3030908^^^^
"^DD",9000010.18,9000010.18,.09,21,1,0)
This is the diagnosis, from the ICD Diagnosis file, associated
"^DD",9000010.18,9000010.18,.09,21,2,0)
with the procedure performed.
"^DD",9000010.18,9000010.18,.09,"AUDIT")

"^DD",9000010.18,9000010.18,.09,"DT")
3050907
"^DD",9000010.18,9000010.18,.1,0)
DIAGNOSIS 3^*P80'X^ICD9(^0;10^D ICDEN^PXCECPT1 K:Y<0 X
"^DD",9000010.18,9000010.18,.1,3)
Enter the ICD Diagnosis related to the procedure done.
"^DD",9000010.18,9000010.18,.1,12)
Dx cannot be an inactive code, and it must be appropria
"^DD",9000010.18,9000010.18,.1,12.1)
S DIC("S")="D ^AUPNSICD" S DIC(0)=$P(DIC(0),"E")_$P(DIC(0),"E",2)
"^DD",9000010.18,9000010.18,.1,21,0)
^^2^2^3021227^
"^DD",9000010.18,9000010.18,.1,21,1,0)
This is the diagnosis, from the ICD Diagnosis file, associated
"^DD",9000010.18,9000010.18,.1,21,2,0)
with the procedure performed.
"^DD",9000010.18,9000010.18,.1,"DT")
3050907
"^DD",9000010.18,9000010.18,.11,0)
DIAGNOSIS 4^*P80'X^ICD9(^0;11^D ICDEN^PXCECPT1 K:Y<0 X
"^DD",9000010.18,9000010.18,.11,3)
Enter the ICD Diagnosis related to the procedure done.
"^DD",9000010.18,9000010.18,.11,12)
Dx cannot be an inactive code, and it must be appropriat
"^DD",9000010.18,9000010.18,.11,12.1)
S DIC("S")="D ^AUPNSICD" S DIC(0)=$P(DIC(0),"E")_$P(DIC(0),"E",2)
"^DD",9000010.18,9000010.18,.11,"DT")
3050907
"^DD",9000010.18,9000010.18,.12,0)
DIAGNOSIS 5^*P80'X^ICD9(^0;12^D ICDEN^PXCECPT1 K:Y<0 X
"^DD",9000010.18,9000010.18,.12,3)
Enter the ICD Diagnosis related to the procedure done.
"^DD",9000010.18,9000010.18,.12,12)
Dx cannot be an inactive code, and it must be appropriate
"^DD",9000010.18,9000010.18,.12,12.1)
S DIC("S")="D ^AUPNSICD" S DIC(0)=$P(DIC(0),"E")_$P(DIC(0),"E",2)
"^DD",9000010.18,9000010.18,.12,"DT")
3050907
"^DD",9000010.18,9000010.18,.13,0)
DIAGNOSIS 6^*P80'X^ICD9(^0;13^D ICDEN^PXCECPT1 K:Y<0 X
"^DD",9000010.18,9000010.18,.13,3)
Enter the ICD Diagnosis related to the procedure done.
"^DD",9000010.18,9000010.18,.13,12)
Dx cannot be an inactive code, and it must be appropriate
"^DD",9000010.18,9000010.18,.13,12.1)
S DIC("S")="D ^AUPNSICD" S DIC(0)=$P(DIC(0),"E")_$P(DIC(0),"E",2)
"^DD",9000010.18,9000010.18,.13,"DT")
3050907
"^DD",9000010.18,9000010.18,.14,0)
DIAGNOSIS 7^*P80'X^ICD9(^0;14^D ICDEN^PXCECPT1 K:Y<0 X
"^DD",9000010.18,9000010.18,.14,3)
Enter the ICD Diagnosis related to the procedure done.
"^DD",9000010.18,9000010.18,.14,12)
Dx cannot be an inactive code, and it must be appropriate
"^DD",9000010.18,9000010.18,.14,12.1)
S DIC("S")="D ^AUPNSICD" S DIC(0)=$P(DIC(0),"E")_$P(DIC(0),"E",2)
"^DD",9000010.18,9000010.18,.14,"DT")
3050907
"^DD",9000010.18,9000010.18,.15,0)
DIAGNOSIS 8^*P80'X^ICD9(^0;15^D ICDEN^PXCECPT1 K:Y<0 X
"^DD",9000010.18,9000010.18,.15,3)
Enter the ICD Diagnosis related to the procedure done.
"^DD",9000010.18,9000010.18,.15,12)
Dx cannot be an inactive code, and it must be appropriate
"^DD",9000010.18,9000010.18,.15,12.1)
S DIC("S")="D ^AUPNSICD" S DIC(0)=$P(DIC(0),"E")_$P(DIC(0),"E",2)
"^DD",9000010.18,9000010.18,.15,"DT")
3050907
"BLD",8599,6)
^153
**END**
**END**

