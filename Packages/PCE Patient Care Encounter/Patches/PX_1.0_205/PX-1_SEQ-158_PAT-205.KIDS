Released PX*1*205 SEQ #158
Extracted from mail message
**KIDS**:PX*1.0*205^

**INSTALL NAME**
PX*1.0*205
"BLD",9835,0)
PX*1.0*205^PCE PATIENT CARE ENCOUNTER^0^3141027^y
"BLD",9835,1,0)
^^5^5^3141027^
"BLD",9835,1,1,0)
Patch PX*1*205 addresses the following Patient Care Encounter issues:
"BLD",9835,1,2,0)
 
"BLD",9835,1,3,0)
 1. AUDIT+9^PXQFV errors
"BLD",9835,1,4,0)
 2. OCC+40^PXBGPRV errors
"BLD",9835,1,5,0)
 3. No CHECK for non-unique names on editing Health Factors
"BLD",9835,4,0)
^9.64PA^^
"BLD",9835,6.3)
6
"BLD",9835,"ABPKG")
n
"BLD",9835,"KRN",0)
^9.67PA^779.2^20
"BLD",9835,"KRN",.4,0)
.4
"BLD",9835,"KRN",.401,0)
.401
"BLD",9835,"KRN",.402,0)
.402
"BLD",9835,"KRN",.403,0)
.403
"BLD",9835,"KRN",.5,0)
.5
"BLD",9835,"KRN",.84,0)
.84
"BLD",9835,"KRN",3.6,0)
3.6
"BLD",9835,"KRN",3.8,0)
3.8
"BLD",9835,"KRN",9.2,0)
9.2
"BLD",9835,"KRN",9.8,0)
9.8
"BLD",9835,"KRN",9.8,"NM",0)
^9.68A^3^3
"BLD",9835,"KRN",9.8,"NM",1,0)
PXBPPRV1^^0^B19041501
"BLD",9835,"KRN",9.8,"NM",2,0)
PXQFV^^0^B23876862
"BLD",9835,"KRN",9.8,"NM",3,0)
PXTTU1^^0^B3016518
"BLD",9835,"KRN",9.8,"NM","B","PXBPPRV1",1)

"BLD",9835,"KRN",9.8,"NM","B","PXQFV",2)

"BLD",9835,"KRN",9.8,"NM","B","PXTTU1",3)

"BLD",9835,"KRN",19,0)
19
"BLD",9835,"KRN",19.1,0)
19.1
"BLD",9835,"KRN",101,0)
101
"BLD",9835,"KRN",409.61,0)
409.61
"BLD",9835,"KRN",771,0)
771
"BLD",9835,"KRN",779.2,0)
779.2
"BLD",9835,"KRN",870,0)
870
"BLD",9835,"KRN",8989.51,0)
8989.51
"BLD",9835,"KRN",8989.52,0)
8989.52
"BLD",9835,"KRN",8994,0)
8994
"BLD",9835,"KRN","B",.4,.4)

"BLD",9835,"KRN","B",.401,.401)

"BLD",9835,"KRN","B",.402,.402)

"BLD",9835,"KRN","B",.403,.403)

"BLD",9835,"KRN","B",.5,.5)

"BLD",9835,"KRN","B",.84,.84)

"BLD",9835,"KRN","B",3.6,3.6)

"BLD",9835,"KRN","B",3.8,3.8)

"BLD",9835,"KRN","B",9.2,9.2)

"BLD",9835,"KRN","B",9.8,9.8)

"BLD",9835,"KRN","B",19,19)

"BLD",9835,"KRN","B",19.1,19.1)

"BLD",9835,"KRN","B",101,101)

"BLD",9835,"KRN","B",409.61,409.61)

"BLD",9835,"KRN","B",771,771)

"BLD",9835,"KRN","B",779.2,779.2)

"BLD",9835,"KRN","B",870,870)

"BLD",9835,"KRN","B",8989.51,8989.51)

"BLD",9835,"KRN","B",8989.52,8989.52)

"BLD",9835,"KRN","B",8994,8994)

"BLD",9835,"QDEF")
^^^^^^^^^^YES
"BLD",9835,"QUES",0)
^9.62^^
"BLD",9835,"REQB",0)
^9.611^3^3
"BLD",9835,"REQB",1,0)
PX*1.0*29^2
"BLD",9835,"REQB",2,0)
PX*1.0*106^2
"BLD",9835,"REQB",3,0)
PX*1.0*186^2
"BLD",9835,"REQB","B","PX*1.0*106",2)

"BLD",9835,"REQB","B","PX*1.0*186",3)

"BLD",9835,"REQB","B","PX*1.0*29",1)

"MBREQ")
0
"PKG",413,-1)
1^1
"PKG",413,0)
PCE PATIENT CARE ENCOUNTER^PX^Patient Care Encounter (VA Parent package)^
"PKG",413,20,0)
^9.402P^^
"PKG",413,22,0)
^9.49I^1^1
"PKG",413,22,1,0)
1.0^2960812^2960913^12537
"PKG",413,22,1,"PAH",1,0)
205^3141027
"PKG",413,22,1,"PAH",1,1,0)
^^5^5^3141027
"PKG",413,22,1,"PAH",1,1,1,0)
Patch PX*1*205 addresses the following Patient Care Encounter issues:
"PKG",413,22,1,"PAH",1,1,2,0)
 
"PKG",413,22,1,"PAH",1,1,3,0)
 1. AUDIT+9^PXQFV errors
"PKG",413,22,1,"PAH",1,1,4,0)
 2. OCC+40^PXBGPRV errors
"PKG",413,22,1,"PAH",1,1,5,0)
 3. No CHECK for non-unique names on editing Health Factors
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
3
"RTN","PXBPPRV1")
0^1^B19041501^B16413731
"RTN","PXBPPRV1",1,0)
PXBPPRV1 ;ISL/JVS - PROMPT FOR PROVIDER ; 5/31/07 5:10pm
"RTN","PXBPPRV1",2,0)
 ;;1.0;PCE PATIENT CARE ENCOUNTER;**11,19,27,88,124,186,205**;Aug 12, 1996;Build 6
"RTN","PXBPPRV1",3,0)
 ;
"RTN","PXBPPRV1",4,0)
 ;
"RTN","PXBPPRV1",5,0)
 ;
"RTN","PXBPPRV1",6,0)
ACTIVE ;---CHECK TO SEE IF ACTIVE PROVIDER
"RTN","PXBPPRV1",7,0)
 ;
"RTN","PXBPPRV1",8,0)
 N PROVIDER,VISIT,DIC,DR,DA,INACTIVE,OK,NOT,PROVEX,BDATA,ACTIVE
"RTN","PXBPPRV1",9,0)
 S PROVIDER=$P(REQI,"^",1) ;-Provider IEN
"RTN","PXBPPRV1",10,0)
 S PROVEX=$P(REQE,"^",1) ;-Provider External form
"RTN","PXBPPRV1",11,0)
 S VISIT=$P(IDATE,".",1) ;-Visit date Internal form
"RTN","PXBPPRV1",12,0)
 ;
"RTN","PXBPPRV1",13,0)
 ; begin patch *186*
"RTN","PXBPPRV1",14,0)
 ;S DIC=200,DR=53.4,DA=PROVIDER,DIQ="INACTIVE",DIQ(0)="IN" D EN^DIQ1
"RTN","PXBPPRV1",15,0)
 ;I $D(INACTIVE),$G(INACTIVE(200,PROVIDER,53.4,"I"))<VISIT S NOT=1
"RTN","PXBPPRV1",16,0)
 ;S DIC=200,DR=9.2,DA=PROVIDER,DIQ="ACTIVE",DIQ(0)="IN" D EN^DIQ1
"RTN","PXBPPRV1",17,0)
 ;I $D(ACTIVE),$G(ACTIVE(200,PROVIDER,9.2,"I"))<VISIT S NOT=1
"RTN","PXBPPRV1",18,0)
 ;---I $G(NOT) W !,IOEDEOP,IORVON,"--WARNING!-",PROVEX," was INACTIVE on the date of this encounter.",IORVOFF D HELP1^PXBUTL1("CON") R OK:DTIME
"RTN","PXBPPRV1",19,0)
 ;I $G(NOT) W !,IOEDEOP,IORVON,"--WARNING!-",PROVEX," was INACTIVE on the date of this encounter.",IORVOFF D PMPT
"RTN","PXBPPRV1",20,0)
 ;
"RTN","PXBPPRV1",21,0)
 S DIC=200,DR=9.2,DA=PROVIDER,DIQ="ACTIVE",DIQ(0)="IN" D EN^DIQ1
"RTN","PXBPPRV1",22,0)
 I $D(ACTIVE),$G(ACTIVE(200,PROVIDER,9.2,"I"))'>VISIT S NOT=1 D
"RTN","PXBPPRV1",23,0)
 . D RSET^PXBDREQ("PRV") S FPRI=1
"RTN","PXBPPRV1",24,0)
 . W !,IOEDEOP,IORVON,"--ERROR!--",PROVEX," was TERMINATED before the date of this encounter.",IORVOFF D HELP1^PXBUTL1("CON") R OK:DTIME
"RTN","PXBPPRV1",25,0)
 ; end patch *186*
"RTN","PXBPPRV1",26,0)
 ;
"RTN","PXBPPRV1",27,0)
 ;---------3/17/97--PART OF FUTURE PATCH 27
"RTN","PXBPPRV1",28,0)
 I '$G(NOT) D
"RTN","PXBPPRV1",29,0)
 .N CLASS
"RTN","PXBPPRV1",30,0)
 .S CLASS=$$GET^XUA4A72(PROVIDER,$P(VISIT,".")) I +CLASS<0 D  ;PX*1.0*205 moved + from in front of $$ to in front of CLASS
"RTN","PXBPPRV1",31,0)
 ..D RSET^PXBDREQ("PRV") S FPRI=1
"RTN","PXBPPRV1",32,0)
 ..W !,IOEDEOP,IORVON,"--ERROR!--",PROVEX," does not have an ACTIVE person class.",IORVOFF D HELP1^PXBUTL1("CON") R OK:DTIME
"RTN","PXBPPRV1",33,0)
 .;---------END 3/17/97
"RTN","PXBPPRV1",34,0)
 .I +CLASS'<0,$P(CLASS,U,7)="" D RSET^PXBDREQ("PRV") S FPRI=1 W !,IOEDEOP,IORVON,"--ERROR!--",PROVEX," does not have a VA CODE on PERSON CLASS.",IORVOFF D HELP1^PXBUTL1("CON") R OK:DTIME ;PX*1.0*205 added
"RTN","PXBPPRV1",35,0)
AXIT ;--EXIT AND KILL
"RTN","PXBPPRV1",36,0)
 K DIQ
"RTN","PXBPPRV1",37,0)
 Q
"RTN","PXBPPRV1",38,0)
PMPT ;--PROMT FOR COMFIRMATION OF USING INACTIVE PORVIDER
"RTN","PXBPPRV1",39,0)
 S DIR("A")="Are you sure you want to select this provider? "
"RTN","PXBPPRV1",40,0)
 S DIR("B")="NO"
"RTN","PXBPPRV1",41,0)
 S DIR(0)="YA"
"RTN","PXBPPRV1",42,0)
 D ^DIR
"RTN","PXBPPRV1",43,0)
 I Y<1 D RSET^PXBDREQ("PRV")
"RTN","PXBPPRV1",44,0)
 Q
"RTN","PXBPPRV1",45,0)
 ;
"RTN","PXBPPRV1",46,0)
ADDM ;--------If Multiple entries have been entered
"RTN","PXBPPRV1",47,0)
 Q
"RTN","PXBPPRV1",48,0)
 ;---NOT POSSIBLE TO ADD MULTIPLE PROVIDERS
"RTN","PXBPPRV1",49,0)
 ;
"RTN","PXBPPRV1",50,0)
DELM ;--------If Multiple deleting
"RTN","PXBPPRV1",51,0)
 ;
"RTN","PXBPPRV1",52,0)
 N DELM,CNT,CPTPRV,PXBJ,BAD,PXBLEN,BDATA
"RTN","PXBPPRV1",53,0)
 S (NF,CNT)=0,PXBLEN=0 S $P(DELM,"^",1)=1
"RTN","PXBPPRV1",54,0)
 I $E(DATA,1)="@" S DATA=$P(DATA,"@",2),NF=1 D
"RTN","PXBPPRV1",55,0)
 .S PXBLEN=$L(DATA,",") F PXI=1:1:PXBLEN S PXBPIECE=$P(DATA,",",PXI) D
"RTN","PXBPPRV1",56,0)
 ..I PXBPIECE'["-"&(PXBPIECE'>0!(PXBPIECE'<(PXBCNT+1))) S BAD(+$G(PXBPIECE))="" Q
"RTN","PXBPPRV1",57,0)
 ..I PXBPIECE'["-" D
"RTN","PXBPPRV1",58,0)
 ...I $D(GONE(PXBPIECE)) Q
"RTN","PXBPPRV1",59,0)
 ...Q:PXBPIECE'?.N
"RTN","PXBPPRV1",60,0)
 ...Q:+PXBPIECE'=PXBPIECE
"RTN","PXBPPRV1",61,0)
 ...S $P(REQI,"^",7)=$O(PXBSKY(PXBPIECE,0)) ;-IEN
"RTN","PXBPPRV1",62,0)
 ...S X=$P(PXBSAM(PXBPIECE),"^",1),DIC="^VA(200,",DIC(0)="ZM" D ^DIC
"RTN","PXBPPRV1",63,0)
 ...S $P(REQI,"^",1)=+Y S CPTPRV=+Y K Y
"RTN","PXBPPRV1",64,0)
 ...S $P(REQI,"^",2)=$P(PXBSAM(PXBPIECE),"^",2) K Y
"RTN","PXBPPRV1",65,0)
 ...S GONE(PXBPIECE)=""
"RTN","PXBPPRV1",66,0)
 ...D EN0^PXBSTOR(PXBVST,PATIENT,REQI,$G(PXMREQ))
"RTN","PXBPPRV1",67,0)
 ...D EN1^PXKMAIN
"RTN","PXBPPRV1",68,0)
 ...I $G(WHAT)["CPT" D DCPT^PXBSTOR1(CPTPRV,PXBVST)
"RTN","PXBPPRV1",69,0)
 ..I PXBPIECE["-" D
"RTN","PXBPPRV1",70,0)
 ...S PXBJ=0 F PXBJ=$P(PXBPIECE,"-",1):1:$P(PXBPIECE,"-",2) D
"RTN","PXBPPRV1",71,0)
 ....I $D(GONE(PXBJ)) Q
"RTN","PXBPPRV1",72,0)
 ....I PXBJ'>0!(PXBJ'<(PXBCNT+1)) S BAD(PXBJ)="" Q
"RTN","PXBPPRV1",73,0)
 ....S $P(REQI,"^",7)=$O(PXBSKY(PXBJ,0)) ;-IEN
"RTN","PXBPPRV1",74,0)
 ....S X=$P(PXBSAM(PXBJ),"^",1),DIC="^VA(200,",DIC(0)="ZM" D ^DIC
"RTN","PXBPPRV1",75,0)
 ....S $P(REQI,"^",1)=+Y S CPTPRV=+Y K Y
"RTN","PXBPPRV1",76,0)
 ....S $P(REQI,"^",2)=$P(PXBSAM(PXBJ),"^",1)
"RTN","PXBPPRV1",77,0)
 ....S GONE(PXBJ)=""
"RTN","PXBPPRV1",78,0)
 ....D EN0^PXBSTOR(PXBVST,PATIENT,REQI,$G(PXMREQ))
"RTN","PXBPPRV1",79,0)
 ....D EN1^PXKMAIN
"RTN","PXBPPRV1",80,0)
 ....I $G(WHAT)["CPT" D DCPT^PXBSTOR1(CPTPRV,PXBVST)
"RTN","PXBPPRV1",81,0)
 K GONE
"RTN","PXBPPRV1",82,0)
 I $G(NF)&($D(BAD)) D  Q
"RTN","PXBPPRV1",83,0)
 .S (BDATA,EDATA)="" F  S BDATA=$O(BAD(BDATA)) Q:BDATA=""  S EDATA=EDATA_BDATA_"  "
"RTN","PXBPPRV1",84,0)
 .D WIN17^PXBCC(PXBCNT)
"RTN","PXBPPRV1",85,0)
 .W ! D HELP^PXBUTL0("PRVMD") W !
"RTN","PXBPPRV1",86,0)
 .S DIR(0)="E" D ^DIR K DIR
"RTN","PXBPPRV1",87,0)
 .S:Y=1 DATA="^P" S:Y=0!(Y="") DATA="^" K Y
"RTN","PXBPPRV1",88,0)
 I $G(NF)&('$D(BAD)) S DATA="^P" Q
"RTN","PXBPPRV1",89,0)
 K PRVDR,PXBDPRV
"RTN","PXBPPRV1",90,0)
 Q
"RTN","PXBPPRV1",91,0)
 ;
"RTN","PXBPPRV1",92,0)
PRI ;--Prompt for primary secondary provider
"RTN","PXBPPRV1",93,0)
 ;
"RTN","PXBPPRV1",94,0)
 N DIR,Y,X
"RTN","PXBPPRV1",95,0)
 I $G(FPRI) Q
"RTN","PXBPPRV1",96,0)
 W IOCUD,IOELALL,IOCUU
"RTN","PXBPPRV1",97,0)
 S DIR("A")="Is this the PRIMARY provider for this ENCOUNTER? "
"RTN","PXBPPRV1",98,0)
 S DIR("B")="YES"
"RTN","PXBPPRV1",99,0)
 S DIR("?")="One PRIMARY Provider must be established for each patient encounter. 'Yes' will mean PRIMARY and 'No' will mean SECONDARY."
"RTN","PXBPPRV1",100,0)
 S DIR(0)="Y,A,O"
"RTN","PXBPPRV1",101,0)
 D ^DIR I $G(DIRUT) G PPXIT
"RTN","PXBPPRV1",102,0)
PPFIN ;--Finish off variables
"RTN","PXBPPRV1",103,0)
 I Y=1 S PRI="P^PRIMARY"
"RTN","PXBPPRV1",104,0)
 I Y=0 S PRI="S^SECONDARY"
"RTN","PXBPPRV1",105,0)
 S $P(REQI,"^",2)=$P(PRI,"^",1)
"RTN","PXBPPRV1",106,0)
 S $P(REQE,"^",2)=$P(PRI,"^",2)
"RTN","PXBPPRV1",107,0)
PPXIT ;--EXIT
"RTN","PXBPPRV1",108,0)
 Q
"RTN","PXQFV")
0^2^B23876862^B23307464
"RTN","PXQFV",1,0)
PXQFV ;ISL/ARS,JVS - DEPENDENT ENTRY COUNT-VISITS(AUPNVSIT) ;5/1/97  08:30
"RTN","PXQFV",2,0)
 ;;1.0;PCE PATIENT CARE ENCOUNTER;**4,29,205**;Aug 12, 1996;Build 6
"RTN","PXQFV",3,0)
 ;
"RTN","PXQFV",4,0)
DEC(VISIT,VISUAL,EXPAND) ;Test looking through DD to find fields pointing to the visit entries.
"RTN","PXQFV",5,0)
 ; VISIT=Visit ien to looked up and counted
"RTN","PXQFV",6,0)
 ; VISUAL= Set to 1 if you want and interactive display of what is found
"RTN","PXQFV",7,0)
 ; EXPAND= SET TO 1 TO EXPAND ENTRIES
"RTN","PXQFV",8,0)
 ;
"RTN","PXQFV",9,0)
 ; Look for file and field
"RTN","PXQFV",10,0)
 ;
"RTN","PXQFV",11,0)
 N DD,BECKY,COUNT,FIELD,FILE,GET,PIECE,PX,REF,SNDPIECE,STOP,SUB,VAUGHN
"RTN","PXQFV",12,0)
 N DEC,DECF,ENTRY,VAR
"RTN","PXQFV",13,0)
 ;
"RTN","PXQFV",14,0)
 S DD="^DD"
"RTN","PXQFV",15,0)
 S FILE=""
"RTN","PXQFV",16,0)
 F  S FILE=$O(@DD@(9000010,0,"PT",FILE)) Q:FILE=""  D
"RTN","PXQFV",17,0)
 .S FIELD=""
"RTN","PXQFV",18,0)
 .F  S FIELD=$O(@DD@(9000010,0,"PT",FILE,FIELD)) Q:FIELD=""  D
"RTN","PXQFV",19,0)
 ..S VDD(FILE,FIELD)=""
"RTN","PXQFV",20,0)
 D REF,QUE
"RTN","PXQFV",21,0)
 K VDDN,VDDR
"RTN","PXQFV",22,0)
 I $G(VISUAL) S VAR="COUNT= "_COUNT W $$RE^PXQUTL(VAR)
"RTN","PXQFV",23,0)
 Q ""
"RTN","PXQFV",24,0)
 ;
"RTN","PXQFV",25,0)
REF ;Look for all of the regular cross references and other
"RTN","PXQFV",26,0)
 ;
"RTN","PXQFV",27,0)
 S FILE="" F  S FILE=$O(VDD(FILE)) Q:FILE=""  D
"RTN","PXQFV",28,0)
 .S FIELD="" F  S FIELD=$O(VDD(FILE,FIELD)) Q:FIELD=""  D
"RTN","PXQFV",29,0)
 ..D REG
"RTN","PXQFV",30,0)
 K VDD
"RTN","PXQFV",31,0)
 Q
"RTN","PXQFV",32,0)
 ;
"RTN","PXQFV",33,0)
REG ;Look for regular cross references
"RTN","PXQFV",34,0)
 ;
"RTN","PXQFV",35,0)
 S STOP=0
"RTN","PXQFV",36,0)
 I '$D(@DD@(FILE,FIELD,1)) S VDDN(FILE,FIELD)="" Q
"RTN","PXQFV",37,0)
 S SUB=0 F  S SUB=$O(@DD@(FILE,FIELD,1,SUB)) Q:SUB=""  D
"RTN","PXQFV",38,0)
 .S GET=$G(@DD@(FILE,FIELD,1,SUB,0)) D
"RTN","PXQFV",39,0)
 .I $P(GET,"^",3)']"" S VDDR(FILE,SUB)=FILE_"^"_FIELD_"^"_SUB S STOP=1
"RTN","PXQFV",40,0)
 .E  S VDDN(FILE,FIELD)=""
"RTN","PXQFV",41,0)
 Q
"RTN","PXQFV",42,0)
QUE ;CHECK OUT CROSS REFERENCE
"RTN","PXQFV",43,0)
 ;
"RTN","PXQFV",44,0)
 N PFILE
"RTN","PXQFV",45,0)
 W:($G(EXPAND)&('$G(BROKEN))) $$EXP("^AUPNVSIT(",VISIT)
"RTN","PXQFV",46,0)
 S FILE="",FIELD="",STOP="",COUNT=0
"RTN","PXQFV",47,0)
 F  S FILE=$O(VDDR(FILE)) Q:FILE=""  D
"RTN","PXQFV",48,0)
 .S SUB=0,STOP="" F  S SUB=$O(VDDR(FILE,SUB)) Q:SUB=""  Q:STOP=1  S GET=$G(VDDR(FILE,SUB)) D
"RTN","PXQFV",49,0)
 ..S REF=$G(@DD@($P(GET,"^",1),$P(GET,"^",2),1,$P(GET,"^",3),1))
"RTN","PXQFV",50,0)
 ..I $P(REF,"""",1)["DA(1)" Q
"RTN","PXQFV",51,0)
 ..S PIECE=$P(REF," ",2)
"RTN","PXQFV",52,0)
 ..S SNDPIECE=$P(PIECE,"""",1,2)_""""
"RTN","PXQFV",53,0)
 ..S VAUGHN=$P(PIECE,"""",1,2)_""")"
"RTN","PXQFV",54,0)
 ..I $D(@VAUGHN) D  S STOP=1
"RTN","PXQFV",55,0)
 ...S PX=SNDPIECE_",VISIT)"
"RTN","PXQFV",56,0)
 ...I $D(@PX) D
"RTN","PXQFV",57,0)
 ....I '$G(EXPAND) S BECKY=0 F  S BECKY=$O(@PX@(BECKY)) Q:BECKY=""  S COUNT=COUNT+1 S DEC=SNDPIECE_","_VISIT_","_BECKY S DECF=$$FILE(SNDPIECE,FILE) W:$G(VISUAL) $$RE^PXQUTL(DEC_" - - - - "_DECF) D
"RTN","PXQFV",58,0)
 .....I $G(BROKEN),SNDPIECE["AUPNVCPT" S (DFN,PATIENT)=$P($G(^AUPNVCPT(BECKY,0)),"^",2)
"RTN","PXQFV",59,0)
 .....I $G(BROKEN),SNDPIECE["SCE" S DATE=$P($G(^SCE(BECKY,0)),"^",1)
"RTN","PXQFV",60,0)
 .....W:$G(EXPAND) $$EXP^PXQUTL(SNDPIECE,BECKY)
"RTN","PXQFV",61,0)
 .....W:$G(PXQSOR) $$SOR(SNDPIECE,BECKY),$$SOR^PXQFE(SNDPIECE,BECKY)
"RTN","PXQFV",62,0)
 .....W:$G(PXQAUDIT) $$AUDIT(SNDPIECE,BECKY)
"RTN","PXQFV",63,0)
 ....I $G(EXPAND) S BECKY=0 F  S BECKY=$O(@PX@(BECKY)) Q:BECKY=""  S COUNT=COUNT+1 S PFILE=$$FILE(SNDPIECE,FILE) W:$G(VISUAL) $$RE^PXQUTL("          "_PFILE_" ") D
"RTN","PXQFV",64,0)
 .....W:$G(EXPAND) $$EXP^PXQUTL(SNDPIECE,BECKY)
"RTN","PXQFV",65,0)
 .....W:$G(PXQSOR) $$SOR(SNDPIECE,BECKY),$$SOR^PXQFE(SNDPIECE,BECKY)
"RTN","PXQFV",66,0)
 .....W:$G(PXQAUDIT) $$AUDIT(SNDPIECE,BECKY)
"RTN","PXQFV",67,0)
 Q
"RTN","PXQFV",68,0)
LINE() ;
"RTN","PXQFV",69,0)
 Q:'$G(PXQAUDIT) ""
"RTN","PXQFV",70,0)
 W "- - - - -"
"RTN","PXQFV",71,0)
 Q ""
"RTN","PXQFV",72,0)
AUDIT(ROOT,IEN) ;---AUDIT TRAIL OF ENTRIES
"RTN","PXQFV",73,0)
 N I,REF,REF2,SOURCE,ACTION,PERSON,NOD,J
"RTN","PXQFV",74,0)
 S REF=$P(ROOT,"""",1)_IEN_")"
"RTN","PXQFV",75,0)
 S REF2=$P(ROOT,"""",1)_IEN
"RTN","PXQFV",76,0)
 F  S REF=$Q(@REF) Q:REF'[REF2  D
"RTN","PXQFV",77,0)
 .I REF[",801" S NOD=$P(@REF,"^",2) Q:NOD']""  D
"RTN","PXQFV",78,0)
 ..;W "ACTION",?26,"SOURCE",?52,"PERSON"
"RTN","PXQFV",79,0)
 ..W $$RE^PXQUTL("ACTION                   SOURCE                    PERSON")
"RTN","PXQFV",80,0)
 ..F I=1:1:$L(NOD,";") S J=$P(NOD,";",I) Q:J']""  D
"RTN","PXQFV",81,0)
 ...Q:$P(J,"-",1)=""  Q:'($D(^PX(839.7,$P(J,"-",1),0))#2)  ;PX*1.0*205 added
"RTN","PXQFV",82,0)
 ...S SOURCE=$P(^PX(839.7,$P(J,"-",1),0),"^",1)
"RTN","PXQFV",83,0)
 ...S ACTION=$P($P(J,"-",2)," ",1) S ACTION=$S(ACTION="E":"EDIT",ACTION="A":"CREATED",1:"")
"RTN","PXQFV",84,0)
 ...S PERSON=$P(^VA(200,$P(J," ",2),0),"^",1)
"RTN","PXQFV",85,0)
 ...W $$RE^PXQUTL(""""_ACTION_""",?16,"""_SOURCE_""",?45,"""_PERSON_"""")
"RTN","PXQFV",86,0)
 W $$RE^PXQUTL("___________________________________________________________")
"RTN","PXQFV",87,0)
 Q ""
"RTN","PXQFV",88,0)
 ;----FUNCTIONS
"RTN","PXQFV",89,0)
SOR(ROOT,IEN) ;---EXPAND ENTRIES
"RTN","PXQFV",90,0)
 N I,REF,REF2,PKG,SOR,ADD,EDT
"RTN","PXQFV",91,0)
 ;I ROOT["SCE",$P($G(^SCE(IEN,0)),"^",6)="",$G(PXQPRM)=1 D
"RTN","PXQFV",92,0)
 ;.W $$RE^PXQUTL("    ~~~~ERROR~~~")
"RTN","PXQFV",93,0)
 ;.W $$RE^PXQUTL("** There is more Than 1 PARENT OUTPATIENT ENCOUNTER pointing to the same VISIT**")
"RTN","PXQFV",94,0)
 ;.W $$RE^PXQUTL(" ")
"RTN","PXQFV",95,0)
 ;I ROOT["SCE",$P($G(^SCE(IEN,0)),"^",6)="" S PXQPRM=1
"RTN","PXQFV",96,0)
 S (PKG,SOR)=""
"RTN","PXQFV",97,0)
 S REF=$P(ROOT,"""",1)_IEN_")"
"RTN","PXQFV",98,0)
 S REF2=$P(ROOT,"""",1)_IEN
"RTN","PXQFV",99,0)
 F  S REF=$Q(@REF) Q:REF'[REF2  D
"RTN","PXQFV",100,0)
 .I REF[",812" S PKG=$P(@REF,"^",2),SOR=$P(@REF,"^",3) D
"RTN","PXQFV",101,0)
 ..I PKG>0,$D(^DIC(9.4,$G(PKG))) S PKG=$P(^DIC(9.4,$G(PKG),0),"^",1)
"RTN","PXQFV",102,0)
 ..I SOR>0 S SOR=$P(^PX(839.7,$G(SOR),0),"^",1)
"RTN","PXQFV",103,0)
 ..S PKG="PACKAGE ="_$G(PKG)
"RTN","PXQFV",104,0)
 ..W $$RE^PXQUTL(PKG)
"RTN","PXQFV",105,0)
 ..S SOR="SOURCE  ="_$G(SOR)
"RTN","PXQFV",106,0)
 ..W $$RE^PXQUTL(SOR)
"RTN","PXQFV",107,0)
 S (PKG,SOR)=""
"RTN","PXQFV",108,0)
 K ADD,EDT
"RTN","PXQFV",109,0)
 Q ""
"RTN","PXQFV",110,0)
EXP(ROOT,IEN) ;---EXPAND ENTRIES
"RTN","PXQFV",111,0)
 N I,REF,REF2
"RTN","PXQFV",112,0)
 S REF=$P(ROOT,"""",1)_IEN_")"
"RTN","PXQFV",113,0)
 S REF2=$P(ROOT,"""",1)_IEN
"RTN","PXQFV",114,0)
 F  S REF=$Q(@REF) Q:REF'[REF2  S ENTRY=REF_" = "_@REF W $$RE^PXQUTL(ENTRY)
"RTN","PXQFV",115,0)
 I '$G(PXQSOR) W $$RE^PXQUTL("___")
"RTN","PXQFV",116,0)
 I REF["AUPNVSIT" W $$RE^PXQUTL(" ")
"RTN","PXQFV",117,0)
 Q ""
"RTN","PXQFV",118,0)
FILE(RT,FILENUM) ;
"RTN","PXQFV",119,0)
 N FILE S FILE=""
"RTN","PXQFV",120,0)
 I '$D(FILENUM) Q "UNKNOWN"
"RTN","PXQFV",121,0)
FF I $D(^DIC(FILENUM)) D
"RTN","PXQFV",122,0)
 .S FILE=$P($G(^DIC(FILENUM,0)),"^",1)
"RTN","PXQFV",123,0)
 E  I $D(^DD(FILENUM)) S FILENUM=+$G(^DD(FILENUM,0,"UP")) G FF
"RTN","PXQFV",124,0)
 Q FILE_" FILE"
"RTN","PXQFV",125,0)
PL ;--CHECK PAGE LENGTH
"RTN","PXQFV",126,0)
 N ANS,DX,DY
"RTN","PXQFV",127,0)
 I IOST["C-",$Y>22 S DX=0,DY=0 X ^%ZOSF("XY") R !,"Press ENTER to continue: ",ANS:DTIME
"RTN","PXQFV",128,0)
 Q
"RTN","PXTTU1")
0^3^B3016518^B2875890
"RTN","PXTTU1",1,0)
PXTTU1 ;ISL/JVS/ESW - Utility Routine-calls from input transforms ;5/20/96  17:14
"RTN","PXTTU1",2,0)
 ;;1.0;PCE PATIENT CARE ENCOUNTER;**106,205**;Aug 12, 1996;Build 6
"RTN","PXTTU1",3,0)
 Q
"RTN","PXTTU1",4,0)
 ; This routines purpose is to hold utilities used by the supporting
"RTN","PXTTU1",5,0)
 ;files for the v files.
"RTN","PXTTU1",6,0)
 ;
"RTN","PXTTU1",7,0)
ZERO(PXB,PXNAT) ;PXTT TOPICS - Reset the zero node for new ifn's to add
"RTN","PXTTU1",8,0)
 ;                      at option
"RTN","PXTTU1",9,0)
 ;PXB - parameter "^AUTT...(" passed from ENTRY ACTION of the related
"RTN","PXTTU1",10,0)
 ;      Option:
"RTN","PXTTU1",11,0)
 ;             PXTT EDIT EDUCATION TOPICS
"RTN","PXTTU1",12,0)
 ;             PXTT EDIT HEALTH FACTORS
"RTN","PXTTU1",13,0)
 ;             PXTT EDIT IMMUNIZATIONS
"RTN","PXTTU1",14,0)
 ;             PXTT EDIT SKIN TESTS
"RTN","PXTTU1",15,0)
 ;             PXTT EDIT TREATMENT
"RTN","PXTTU1",16,0)
 ;             PXTT EDIT EXAM
"RTN","PXTTU1",17,0)
 ;PXNAT (optional) - a variable to be set temporarily to PXNAT=1 in
"RTN","PXTTU1",18,0)
 ;       ENTRY ACTION, see above, by a developer for setting/editing
"RTN","PXTTU1",19,0)
 ;       a national package.
"RTN","PXTTU1",20,0)
 ;
"RTN","PXTTU1",21,0)
 D GETSITE Q:$L(PXTDUZ)'=3
"RTN","PXTTU1",22,0)
 I +$G(PXNAT) S $P(@(PXB_"0)"),U,3)=0
"RTN","PXTTU1",23,0)
 E  S:(+$P($G(@(PXB_"0)")),U,3)<(PXTDUZ_"000"))!(+$P($G(@(PXB_"0)")),U,3)>(PXTDUZ_"999")) $P(@(PXB_"0)"),U,3)=PXTDUZ_"000"
"RTN","PXTTU1",24,0)
 Q
"RTN","PXTTU1",25,0)
 ;
"RTN","PXTTU1",26,0)
GETSITE S PXTDUZ=+$P($$SITE^VASITE,U,3)
"RTN","PXTTU1",27,0)
 I $L(PXTDUZ)'=3 W !,"Primary site is not 3 character station number! See IRM for setup." Q
"RTN","PXTTU1",28,0)
 Q
"RTN","PXTTU1",29,0)
 ;
"RTN","PXTTU1",30,0)
CKNA(PXB) ;Check for duplicat names.
"RTN","PXTTU1",31,0)
 ;PXB - parameter "^AUTT...(" passed by INPUT TRANSFORM of .01 field
"RTN","PXTTU1",32,0)
 ;      of the related file:
"RTN","PXTTU1",33,0)
 ;           HEALTH FACTORS   ; 9999999.64
"RTN","PXTTU1",34,0)
 ;           EDUCATION TOPICS ; 9999999.09
"RTN","PXTTU1",35,0)
 ;           IMMUNIZATION     ; 9999999.14
"RTN","PXTTU1",36,0)
 ;           EXAM             ; 9999999.15
"RTN","PXTTU1",37,0)
 ;           TREATMENT        ; 9999999.17
"RTN","PXTTU1",38,0)
 ;           SKIN TEST        ; 9999999.28
"RTN","PXTTU1",39,0)
 ;PXNAT - optional variable, see above
"RTN","PXTTU1",40,0)
 N PXD
"RTN","PXTTU1",41,0)
 S PXD=PXB_"""B"""_","_""""_X_""")"
"RTN","PXTTU1",42,0)
 ;I $D(@PXD),$O(@PXD@(""))<100000 D  Q
"RTN","PXTTU1",43,0)
 I $D(@PXD) D  Q  ;PX*1.0*205 replaced line above
"RTN","PXTTU1",44,0)
 .;check for existing national
"RTN","PXTTU1",45,0)
 .W !,"Duplicate NAMES not allowed." K X
"RTN","PXTTU1",46,0)
 ;additional check for EDUCATION TOPICS
"RTN","PXTTU1",47,0)
 I $P(PXB,"(")="^AUTTEDT",$F(X,"VA-")=4,'$G(PXNAT) D
"RTN","PXTTU1",48,0)
 .W !,"NAME cannot start with ""VA-"", reserved for national distribution!" K X
"RTN","PXTTU1",49,0)
 Q
"VER")
8.0^22.0
"BLD",9835,6)
^158
**END**
**END**

