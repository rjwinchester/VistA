Released VBEC*2*1 SEQ #2
Extracted from mail message
**KIDS**:VBEC*2.0*1^

**INSTALL NAME**
VBEC*2.0*1
"BLD",7648,0)
VBEC*2.0*1^VBECS^0^3181108^y
"BLD",7648,1,0)
^^169^169^3181108^
"BLD",7648,1,1,0)
This patch (VBEC*2*1) is being released in conjunction with the Vista 
"BLD",7648,1,2,0)
Blood Establishment Computer Software (VBECS) VBECS 2.3.0 server patch.
"BLD",7648,1,3,0)
 
"BLD",7648,1,4,0)
Installation of this patch will have no effect on sites who have not 
"BLD",7648,1,5,0)
installed VBECS.
"BLD",7648,1,6,0)
 
"BLD",7648,1,7,0)
A full description of the VistA patch changes and implementation process 
"BLD",7648,1,8,0)
are included in the VBECS 2.3.0 Release Notes.
"BLD",7648,1,9,0)
 
"BLD",7648,1,10,0)
The VistA patch is released with a seven (7) day compliance date.
"BLD",7648,1,11,0)
 
"BLD",7648,1,12,0)
BLOOD BANK CLEARANCE
"BLD",7648,1,13,0)
====================
"BLD",7648,1,14,0)
EFFECT ON BLOOD BANK FUNCTIONAL REQUIREMENTS: Patch VBEC*2*1 contains 
"BLD",7648,1,15,0)
changes to a package referenced in VHA OI SEPG SOP 192-023 Review of 
"BLD",7648,1,16,0)
VISTA Patches for Effects on VISTA Blood Bank Software. This patch does 
"BLD",7648,1,17,0)
not alter or modify any VistA Blood Bank software design safeguards or 
"BLD",7648,1,18,0)
safety critical elements functions.
"BLD",7648,1,19,0)
 
"BLD",7648,1,20,0)
RISK ANALYSIS: Changes made by patch VBEC*2*1 have no adverse effect on 
"BLD",7648,1,21,0)
VistA Blood Bank software functionality, therefore RISK is none.
"BLD",7648,1,22,0)
 
"BLD",7648,1,23,0)
VALIDATION REQUIREMENTS:
"BLD",7648,1,24,0)
========================
"BLD",7648,1,25,0)
The VBECS 2.3.0 update and VBEC*2*1 require customer validation in the 
"BLD",7648,1,26,0)
local Test account prior to installation in Production to meet Food & 
"BLD",7648,1,27,0)
Drug Administration (FDA) requirements. The user validates the Blood Bank 
"BLD",7648,1,28,0)
software for its intended use prior to its acceptance and use for patient 
"BLD",7648,1,29,0)
care. The VBECS 2.3.0 Release Notes contain descriptions of the changes 
"BLD",7648,1,30,0)
made in this patch and includes validation scenarios.
"BLD",7648,1,31,0)
 
"BLD",7648,1,32,0)
It is imperative that the installation of VBEC*2*1 occur prior to the 
"BLD",7648,1,33,0)
installation of the VBECS 2.3.0 server patch. Coordinate the installation 
"BLD",7648,1,34,0)
with Pathology & Laboratory Medicine Service staff to allow adequate time 
"BLD",7648,1,35,0)
for impact analysis and testing the changes prior to installation in 
"BLD",7648,1,36,0)
Production.
"BLD",7648,1,37,0)
 
"BLD",7648,1,38,0)
Files & Fields Associated:
"BLD",7648,1,39,0)
==========================
"BLD",7648,1,40,0)
N/A
"BLD",7648,1,41,0)
 
"BLD",7648,1,42,0)
FORMS ASSOCIATED:
"BLD",7648,1,43,0)
=================
"BLD",7648,1,44,0)
N/A
"BLD",7648,1,45,0)
 
"BLD",7648,1,46,0)
MAIL GROUPS ASSOCIATED:
"BLD",7648,1,47,0)
=======================
"BLD",7648,1,48,0)
N/A
"BLD",7648,1,49,0)
 
"BLD",7648,1,50,0)
OPTIONS ASSOCIATED:
"BLD",7648,1,51,0)
===================
"BLD",7648,1,52,0)
N/A
"BLD",7648,1,53,0)
 
"BLD",7648,1,54,0)
PROTOCOLS ASSOCIATED:
"BLD",7648,1,55,0)
=====================
"BLD",7648,1,56,0)
N/A
"BLD",7648,1,57,0)
 
"BLD",7648,1,58,0)
SECURITY KEYS ASSOCIATED:
"BLD",7648,1,59,0)
=========================
"BLD",7648,1,60,0)
N/A
"BLD",7648,1,61,0)
 
"BLD",7648,1,62,0)
TEMPLATES ASSOCIATED:
"BLD",7648,1,63,0)
=====================
"BLD",7648,1,64,0)
N/A
"BLD",7648,1,65,0)
 
"BLD",7648,1,66,0)
ADDITIONAL INFORMATION:
"BLD",7648,1,67,0)
=======================
"BLD",7648,1,68,0)
N/A
"BLD",7648,1,69,0)
 
"BLD",7648,1,70,0)
NEW SERVICE REQUESTS (NSRS):
"BLD",7648,1,71,0)
============================
"BLD",7648,1,72,0)
N/A
"BLD",7648,1,73,0)
 
"BLD",7648,1,74,0)
PATIENT SAFETY ISSUES (PSIS):
"BLD",7648,1,75,0)
=============================
"BLD",7648,1,76,0)
N/A
"BLD",7648,1,77,0)
 
"BLD",7648,1,78,0)
DEFECT TRACKING SYSTEM TICKET(S) & OVERVIEW:
"BLD",7648,1,79,0)
============================================
"BLD",7648,1,80,0)
I5868220FY15
"BLD",7648,1,81,0)
I7744342FY16
"BLD",7648,1,82,0)
I6114955FY16
"BLD",7648,1,83,0)
I7083226FY16
"BLD",7648,1,84,0)
I17762673FY18
"BLD",7648,1,85,0)
 
"BLD",7648,1,86,0)
TEST SITES:
"BLD",7648,1,87,0)
===========
"BLD",7648,1,88,0)
MILWAUKEE, WI
"BLD",7648,1,89,0)
PHILADELPHIA, PA
"BLD",7648,1,90,0)
SAN FRANCISCO, CA
"BLD",7648,1,91,0)
HINES, IL
"BLD",7648,1,92,0)
IOWA CITY, IA
"BLD",7648,1,93,0)
 
"BLD",7648,1,94,0)
DOCUMENTATION RETRIEVAL INSTRUCTIONS:
"BLD",7648,1,95,0)
=====================================
"BLD",7648,1,96,0)
Documentation describing the new functionality introduced by this patch 
"BLD",7648,1,97,0)
is available. Documentation can be found on the VA Software Documentation 
"BLD",7648,1,98,0)
Library at: https://www.domain.ext/vdl/application.asp?appid=182
"BLD",7648,1,99,0)
 
"BLD",7648,1,100,0)
=======================================================================
"BLD",7648,1,101,0)
Veterans Health Administration (VHA) Customer Documents:
"BLD",7648,1,102,0)
VistA Blood Establishment Computer Software (VBECS) 2.3.0 Release 
"BLD",7648,1,103,0)
Notes.docx
"BLD",7648,1,104,0)
VistA Blood Establishment Computer Software (VBECS) 2.3.0 Release 
"BLD",7648,1,105,0)
Notes.pdf
"BLD",7648,1,106,0)
VistA Blood Establishment Computer Software (VBECS) 2.3.0 Technical 
"BLD",7648,1,107,0)
Manual-Security Guide.docx
"BLD",7648,1,108,0)
VistA Blood Establishment Computer Software (VBECS) 2.3.0 Technical 
"BLD",7648,1,109,0)
Manual-Security Guide.pdf
"BLD",7648,1,110,0)
VistA Blood Establishment Computer Software (VBECS) 2.3.0 User Guide.docx
"BLD",7648,1,111,0)
VistA Blood Establishment Computer Software (VBECS) 2.3.0 User Guide.pdf
"BLD",7648,1,112,0)
VistA Blood Establishment Computer Software (VBECS) 2.3.0 Admin User 
"BLD",7648,1,113,0)
Guide.docx
"BLD",7648,1,114,0)
VistA Blood Establishment Computer Software (VBECS) 2.3.0 Admin User 
"BLD",7648,1,115,0)
Guide.pdf
"BLD",7648,1,116,0)
VBECS Known Defects and Anomalies.docx
"BLD",7648,1,117,0)
VBECS Known Defects and Anomalies.pdf
"BLD",7648,1,118,0)
 
"BLD",7648,1,119,0)
 
"BLD",7648,1,120,0)
 
"BLD",7648,1,121,0)
PATCH INSTALLATION:
"BLD",7648,1,122,0)
===================
"BLD",7648,1,123,0)
 
"BLD",7648,1,124,0)
Pre/Post installation Overview:
"BLD",7648,1,125,0)
===============================
"BLD",7648,1,126,0)
Refer to the VistA Blood Establishment Computer Software (VBECS) 2.3.0 
"BLD",7648,1,127,0)
Release Notes document for pre and post installation information and 
"BLD",7648,1,128,0)
instructions.
"BLD",7648,1,129,0)
 
"BLD",7648,1,130,0)
Pre-Installation Instructions:
"BLD",7648,1,131,0)
==============================
"BLD",7648,1,132,0)
Create a test with the following information prior to patch installation.
"BLD",7648,1,133,0)
 
"BLD",7648,1,134,0)
NAME: VBEC PATIENT REFLEX TEST      TYPE: NEITHER
"BLD",7648,1,135,0)
  SUBSCRIPT: WORKLOAD               HIGHEST URGENCY ALLOWED: ROUTINE
"BLD",7648,1,136,0)
  PRINT NAME: VBEC PATIENT REFLEX   CREATION DATE: <Use current date>
"BLD",7648,1,137,0)
 
"BLD",7648,1,138,0)
Installation Instructions:
"BLD",7648,1,139,0)
==========================
"BLD",7648,1,140,0)
This patch may be loaded with users on the system.
"BLD",7648,1,141,0)
Installation will take less than 5 minutes.
"BLD",7648,1,142,0)
 
"BLD",7648,1,143,0)
    1) Use the INSTALL/CHECK MESSAGE option on the PackMan menu to unload
"BLD",7648,1,144,0)
       the KIDS distribution included with this message.
"BLD",7648,1,145,0)
    2) From the Kernel Installation and Distribution System Menu,
"BLD",7648,1,146,0)
       select the Installation menu.
"BLD",7648,1,147,0)
    3) From this menu, you may elect to use the following options
"BLD",7648,1,148,0)
       (when prompted for the INSTALL NAME, enter VBEC*2*1).
"BLD",7648,1,149,0)
       a) Backup a Transport Global - this option will create a backup
"BLD",7648,1,150,0)
          message of any routines exported with the patch. It will NOT
"BLD",7648,1,151,0)
          backup any other changes such as DDs or templates.
"BLD",7648,1,152,0)
       b) Compare Transport Global to Current System - this option will
"BLD",7648,1,153,0)
          allow you to view all changes that will be made when the patch
"BLD",7648,1,154,0)
          is installed. It compares all components of the patch
"BLD",7648,1,155,0)
          (routines, DDs, templates, etc.).
"BLD",7648,1,156,0)
       c) Verify Checksums in Transport Global - this option will allow
"BLD",7648,1,157,0)
          you to ensure the integrity of the routines that are in the
"BLD",7648,1,158,0)
          transport global.
"BLD",7648,1,159,0)
       d) Print Transport Global - this option will allow you to view 
"BLD",7648,1,160,0)
          the components of the KIDS build.
"BLD",7648,1,161,0)
    4) Use the Install Package(s) option and select the package 
"BLD",7648,1,162,0)
       VBEC*2*1.
"BLD",7648,1,163,0)
    5) If prompted 'This Patch is for Version 2, you are running
"BLD",7648,1,164,0)
       Version 1 Want to continue installing this build? No//' respond 
"BLD",7648,1,165,0)
YES.
"BLD",7648,1,166,0)
    6) When prompted 'Want KIDS to INHIBIT LOGONs during the install? 
"BLD",7648,1,167,0)
       NO//'  respond NO.
"BLD",7648,1,168,0)
    7) When prompted 'Want to DISABLE Scheduled Options, Menu Options, 
"BLD",7648,1,169,0)
       and Protocols? NO//'  respond NO.
"BLD",7648,4,0)
^9.64PA^^
"BLD",7648,6.3)
13
"BLD",7648,"ABPKG")
n
"BLD",7648,"INI")
PRE^VBEC2P1
"BLD",7648,"INIT")
POST^VBEC2P1
"BLD",7648,"KRN",0)
^9.67PA^779.2^20
"BLD",7648,"KRN",.4,0)
.4
"BLD",7648,"KRN",.401,0)
.401
"BLD",7648,"KRN",.402,0)
.402
"BLD",7648,"KRN",.403,0)
.403
"BLD",7648,"KRN",.5,0)
.5
"BLD",7648,"KRN",.84,0)
.84
"BLD",7648,"KRN",3.6,0)
3.6
"BLD",7648,"KRN",3.8,0)
3.8
"BLD",7648,"KRN",9.2,0)
9.2
"BLD",7648,"KRN",9.8,0)
9.8
"BLD",7648,"KRN",9.8,"NM",0)
^9.68A^6^5
"BLD",7648,"KRN",9.8,"NM",1,0)
VBECRPCM^^0^B41336097
"BLD",7648,"KRN",9.8,"NM",2,0)
VBECHLOR^^0^B17674758
"BLD",7648,"KRN",9.8,"NM",3,0)
VBECLU^^0^B62564378
"BLD",7648,"KRN",9.8,"NM",4,0)
VBECLU0^^0^B25504211
"BLD",7648,"KRN",9.8,"NM",6,0)
VBECA7^^0^B34071335
"BLD",7648,"KRN",9.8,"NM","B","VBECA7",6)

"BLD",7648,"KRN",9.8,"NM","B","VBECHLOR",2)

"BLD",7648,"KRN",9.8,"NM","B","VBECLU",3)

"BLD",7648,"KRN",9.8,"NM","B","VBECLU0",4)

"BLD",7648,"KRN",9.8,"NM","B","VBECRPCM",1)

"BLD",7648,"KRN",19,0)
19
"BLD",7648,"KRN",19,"NM",0)
^9.68A^^
"BLD",7648,"KRN",19.1,0)
19.1
"BLD",7648,"KRN",19.1,"NM",0)
^9.68A^^
"BLD",7648,"KRN",101,0)
101
"BLD",7648,"KRN",409.61,0)
409.61
"BLD",7648,"KRN",771,0)
771
"BLD",7648,"KRN",779.2,0)
779.2
"BLD",7648,"KRN",870,0)
870
"BLD",7648,"KRN",8989.51,0)
8989.51
"BLD",7648,"KRN",8989.52,0)
8989.52
"BLD",7648,"KRN",8994,0)
8994
"BLD",7648,"KRN","B",.4,.4)

"BLD",7648,"KRN","B",.401,.401)

"BLD",7648,"KRN","B",.402,.402)

"BLD",7648,"KRN","B",.403,.403)

"BLD",7648,"KRN","B",.5,.5)

"BLD",7648,"KRN","B",.84,.84)

"BLD",7648,"KRN","B",3.6,3.6)

"BLD",7648,"KRN","B",3.8,3.8)

"BLD",7648,"KRN","B",9.2,9.2)

"BLD",7648,"KRN","B",9.8,9.8)

"BLD",7648,"KRN","B",19,19)

"BLD",7648,"KRN","B",19.1,19.1)

"BLD",7648,"KRN","B",101,101)

"BLD",7648,"KRN","B",409.61,409.61)

"BLD",7648,"KRN","B",771,771)

"BLD",7648,"KRN","B",779.2,779.2)

"BLD",7648,"KRN","B",870,870)

"BLD",7648,"KRN","B",8989.51,8989.51)

"BLD",7648,"KRN","B",8989.52,8989.52)

"BLD",7648,"KRN","B",8994,8994)

"BLD",7648,"PRE")
VBEC2P1
"BLD",7648,"QDEF")
^^^^NO^^^^NO^^NO
"BLD",7648,"QUES",0)
^9.62^^
"BLD",7648,"REQB",0)
^9.611^^
"INI")
PRE^VBEC2P1
"INIT")
POST^VBEC2P1
"MBREQ")
0
"PKG",649,-1)
1^1
"PKG",649,0)
VBECS^VBEC^VistA Blood Establishment Computer System
"PKG",649,20,0)
^9.402P^^
"PKG",649,22,0)
^9.49I^1^1
"PKG",649,22,1,0)
2.0
"PKG",649,22,1,"PAH",1,0)
1^3181108
"PKG",649,22,1,"PAH",1,1,0)
^^169^169^3181108
"PKG",649,22,1,"PAH",1,1,1,0)
This patch (VBEC*2*1) is being released in conjunction with the Vista 
"PKG",649,22,1,"PAH",1,1,2,0)
Blood Establishment Computer Software (VBECS) VBECS 2.3.0 server patch.
"PKG",649,22,1,"PAH",1,1,3,0)
 
"PKG",649,22,1,"PAH",1,1,4,0)
Installation of this patch will have no effect on sites who have not 
"PKG",649,22,1,"PAH",1,1,5,0)
installed VBECS.
"PKG",649,22,1,"PAH",1,1,6,0)
 
"PKG",649,22,1,"PAH",1,1,7,0)
A full description of the VistA patch changes and implementation process 
"PKG",649,22,1,"PAH",1,1,8,0)
are included in the VBECS 2.3.0 Release Notes.
"PKG",649,22,1,"PAH",1,1,9,0)
 
"PKG",649,22,1,"PAH",1,1,10,0)
The VistA patch is released with a seven (7) day compliance date.
"PKG",649,22,1,"PAH",1,1,11,0)
 
"PKG",649,22,1,"PAH",1,1,12,0)
BLOOD BANK CLEARANCE
"PKG",649,22,1,"PAH",1,1,13,0)
====================
"PKG",649,22,1,"PAH",1,1,14,0)
EFFECT ON BLOOD BANK FUNCTIONAL REQUIREMENTS: Patch VBEC*2*1 contains 
"PKG",649,22,1,"PAH",1,1,15,0)
changes to a package referenced in VHA OI SEPG SOP 192-023 Review of 
"PKG",649,22,1,"PAH",1,1,16,0)
VISTA Patches for Effects on VISTA Blood Bank Software. This patch does 
"PKG",649,22,1,"PAH",1,1,17,0)
not alter or modify any VistA Blood Bank software design safeguards or 
"PKG",649,22,1,"PAH",1,1,18,0)
safety critical elements functions.
"PKG",649,22,1,"PAH",1,1,19,0)
 
"PKG",649,22,1,"PAH",1,1,20,0)
RISK ANALYSIS: Changes made by patch VBEC*2*1 have no adverse effect on 
"PKG",649,22,1,"PAH",1,1,21,0)
VistA Blood Bank software functionality, therefore RISK is none.
"PKG",649,22,1,"PAH",1,1,22,0)
 
"PKG",649,22,1,"PAH",1,1,23,0)
VALIDATION REQUIREMENTS:
"PKG",649,22,1,"PAH",1,1,24,0)
========================
"PKG",649,22,1,"PAH",1,1,25,0)
The VBECS 2.3.0 update and VBEC*2*1 require customer validation in the 
"PKG",649,22,1,"PAH",1,1,26,0)
local Test account prior to installation in Production to meet Food & 
"PKG",649,22,1,"PAH",1,1,27,0)
Drug Administration (FDA) requirements. The user validates the Blood Bank 
"PKG",649,22,1,"PAH",1,1,28,0)
software for its intended use prior to its acceptance and use for patient 
"PKG",649,22,1,"PAH",1,1,29,0)
care. The VBECS 2.3.0 Release Notes contain descriptions of the changes 
"PKG",649,22,1,"PAH",1,1,30,0)
made in this patch and includes validation scenarios.
"PKG",649,22,1,"PAH",1,1,31,0)
 
"PKG",649,22,1,"PAH",1,1,32,0)
It is imperative that the installation of VBEC*2*1 occur prior to the 
"PKG",649,22,1,"PAH",1,1,33,0)
installation of the VBECS 2.3.0 server patch. Coordinate the installation 
"PKG",649,22,1,"PAH",1,1,34,0)
with Pathology & Laboratory Medicine Service staff to allow adequate time 
"PKG",649,22,1,"PAH",1,1,35,0)
for impact analysis and testing the changes prior to installation in 
"PKG",649,22,1,"PAH",1,1,36,0)
Production.
"PKG",649,22,1,"PAH",1,1,37,0)
 
"PKG",649,22,1,"PAH",1,1,38,0)
Files & Fields Associated:
"PKG",649,22,1,"PAH",1,1,39,0)
==========================
"PKG",649,22,1,"PAH",1,1,40,0)
N/A
"PKG",649,22,1,"PAH",1,1,41,0)
 
"PKG",649,22,1,"PAH",1,1,42,0)
FORMS ASSOCIATED:
"PKG",649,22,1,"PAH",1,1,43,0)
=================
"PKG",649,22,1,"PAH",1,1,44,0)
N/A
"PKG",649,22,1,"PAH",1,1,45,0)
 
"PKG",649,22,1,"PAH",1,1,46,0)
MAIL GROUPS ASSOCIATED:
"PKG",649,22,1,"PAH",1,1,47,0)
=======================
"PKG",649,22,1,"PAH",1,1,48,0)
N/A
"PKG",649,22,1,"PAH",1,1,49,0)
 
"PKG",649,22,1,"PAH",1,1,50,0)
OPTIONS ASSOCIATED:
"PKG",649,22,1,"PAH",1,1,51,0)
===================
"PKG",649,22,1,"PAH",1,1,52,0)
N/A
"PKG",649,22,1,"PAH",1,1,53,0)
 
"PKG",649,22,1,"PAH",1,1,54,0)
PROTOCOLS ASSOCIATED:
"PKG",649,22,1,"PAH",1,1,55,0)
=====================
"PKG",649,22,1,"PAH",1,1,56,0)
N/A
"PKG",649,22,1,"PAH",1,1,57,0)
 
"PKG",649,22,1,"PAH",1,1,58,0)
SECURITY KEYS ASSOCIATED:
"PKG",649,22,1,"PAH",1,1,59,0)
=========================
"PKG",649,22,1,"PAH",1,1,60,0)
N/A
"PKG",649,22,1,"PAH",1,1,61,0)
 
"PKG",649,22,1,"PAH",1,1,62,0)
TEMPLATES ASSOCIATED:
"PKG",649,22,1,"PAH",1,1,63,0)
=====================
"PKG",649,22,1,"PAH",1,1,64,0)
N/A
"PKG",649,22,1,"PAH",1,1,65,0)
 
"PKG",649,22,1,"PAH",1,1,66,0)
ADDITIONAL INFORMATION:
"PKG",649,22,1,"PAH",1,1,67,0)
=======================
"PKG",649,22,1,"PAH",1,1,68,0)
N/A
"PKG",649,22,1,"PAH",1,1,69,0)
 
"PKG",649,22,1,"PAH",1,1,70,0)
NEW SERVICE REQUESTS (NSRS):
"PKG",649,22,1,"PAH",1,1,71,0)
============================
"PKG",649,22,1,"PAH",1,1,72,0)
N/A
"PKG",649,22,1,"PAH",1,1,73,0)
 
"PKG",649,22,1,"PAH",1,1,74,0)
PATIENT SAFETY ISSUES (PSIS):
"PKG",649,22,1,"PAH",1,1,75,0)
=============================
"PKG",649,22,1,"PAH",1,1,76,0)
N/A
"PKG",649,22,1,"PAH",1,1,77,0)
 
"PKG",649,22,1,"PAH",1,1,78,0)
DEFECT TRACKING SYSTEM TICKET(S) & OVERVIEW:
"PKG",649,22,1,"PAH",1,1,79,0)
============================================
"PKG",649,22,1,"PAH",1,1,80,0)
I5868220FY15
"PKG",649,22,1,"PAH",1,1,81,0)
I7744342FY16
"PKG",649,22,1,"PAH",1,1,82,0)
I6114955FY16
"PKG",649,22,1,"PAH",1,1,83,0)
I7083226FY16
"PKG",649,22,1,"PAH",1,1,84,0)
I17762673FY18
"PKG",649,22,1,"PAH",1,1,85,0)
 
"PKG",649,22,1,"PAH",1,1,86,0)
TEST SITES:
"PKG",649,22,1,"PAH",1,1,87,0)
===========
"PKG",649,22,1,"PAH",1,1,88,0)
MILWAUKEE, WI
"PKG",649,22,1,"PAH",1,1,89,0)
PHILADELPHIA, PA
"PKG",649,22,1,"PAH",1,1,90,0)
SAN FRANCISCO, CA
"PKG",649,22,1,"PAH",1,1,91,0)
HINES, IL
"PKG",649,22,1,"PAH",1,1,92,0)
IOWA CITY, IA
"PKG",649,22,1,"PAH",1,1,93,0)
 
"PKG",649,22,1,"PAH",1,1,94,0)
DOCUMENTATION RETRIEVAL INSTRUCTIONS:
"PKG",649,22,1,"PAH",1,1,95,0)
=====================================
"PKG",649,22,1,"PAH",1,1,96,0)
Documentation describing the new functionality introduced by this patch 
"PKG",649,22,1,"PAH",1,1,97,0)
is available. Documentation can be found on the VA Software Documentation 
"PKG",649,22,1,"PAH",1,1,98,0)
Library at: https://www.domain.ext/vdl/application.asp?appid=182
"PKG",649,22,1,"PAH",1,1,99,0)
 
"PKG",649,22,1,"PAH",1,1,100,0)
=======================================================================
"PKG",649,22,1,"PAH",1,1,101,0)
Veterans Health Administration (VHA) Customer Documents:
"PKG",649,22,1,"PAH",1,1,102,0)
VistA Blood Establishment Computer Software (VBECS) 2.3.0 Release 
"PKG",649,22,1,"PAH",1,1,103,0)
Notes.docx
"PKG",649,22,1,"PAH",1,1,104,0)
VistA Blood Establishment Computer Software (VBECS) 2.3.0 Release 
"PKG",649,22,1,"PAH",1,1,105,0)
Notes.pdf
"PKG",649,22,1,"PAH",1,1,106,0)
VistA Blood Establishment Computer Software (VBECS) 2.3.0 Technical 
"PKG",649,22,1,"PAH",1,1,107,0)
Manual-Security Guide.docx
"PKG",649,22,1,"PAH",1,1,108,0)
VistA Blood Establishment Computer Software (VBECS) 2.3.0 Technical 
"PKG",649,22,1,"PAH",1,1,109,0)
Manual-Security Guide.pdf
"PKG",649,22,1,"PAH",1,1,110,0)
VistA Blood Establishment Computer Software (VBECS) 2.3.0 User Guide.docx
"PKG",649,22,1,"PAH",1,1,111,0)
VistA Blood Establishment Computer Software (VBECS) 2.3.0 User Guide.pdf
"PKG",649,22,1,"PAH",1,1,112,0)
VistA Blood Establishment Computer Software (VBECS) 2.3.0 Admin User 
"PKG",649,22,1,"PAH",1,1,113,0)
Guide.docx
"PKG",649,22,1,"PAH",1,1,114,0)
VistA Blood Establishment Computer Software (VBECS) 2.3.0 Admin User 
"PKG",649,22,1,"PAH",1,1,115,0)
Guide.pdf
"PKG",649,22,1,"PAH",1,1,116,0)
VBECS Known Defects and Anomalies.docx
"PKG",649,22,1,"PAH",1,1,117,0)
VBECS Known Defects and Anomalies.pdf
"PKG",649,22,1,"PAH",1,1,118,0)
 
"PKG",649,22,1,"PAH",1,1,119,0)
 
"PKG",649,22,1,"PAH",1,1,120,0)
 
"PKG",649,22,1,"PAH",1,1,121,0)
PATCH INSTALLATION:
"PKG",649,22,1,"PAH",1,1,122,0)
===================
"PKG",649,22,1,"PAH",1,1,123,0)
 
"PKG",649,22,1,"PAH",1,1,124,0)
Pre/Post installation Overview:
"PKG",649,22,1,"PAH",1,1,125,0)
===============================
"PKG",649,22,1,"PAH",1,1,126,0)
Refer to the VistA Blood Establishment Computer Software (VBECS) 2.3.0 
"PKG",649,22,1,"PAH",1,1,127,0)
Release Notes document for pre and post installation information and 
"PKG",649,22,1,"PAH",1,1,128,0)
instructions.
"PKG",649,22,1,"PAH",1,1,129,0)
 
"PKG",649,22,1,"PAH",1,1,130,0)
Pre-Installation Instructions:
"PKG",649,22,1,"PAH",1,1,131,0)
==============================
"PKG",649,22,1,"PAH",1,1,132,0)
Create a test with the following information prior to patch installation.
"PKG",649,22,1,"PAH",1,1,133,0)
 
"PKG",649,22,1,"PAH",1,1,134,0)
NAME: VBEC PATIENT REFLEX TEST      TYPE: NEITHER
"PKG",649,22,1,"PAH",1,1,135,0)
  SUBSCRIPT: WORKLOAD               HIGHEST URGENCY ALLOWED: ROUTINE
"PKG",649,22,1,"PAH",1,1,136,0)
  PRINT NAME: VBEC PATIENT REFLEX   CREATION DATE: <Use current date>
"PKG",649,22,1,"PAH",1,1,137,0)
 
"PKG",649,22,1,"PAH",1,1,138,0)
Installation Instructions:
"PKG",649,22,1,"PAH",1,1,139,0)
==========================
"PKG",649,22,1,"PAH",1,1,140,0)
This patch may be loaded with users on the system.
"PKG",649,22,1,"PAH",1,1,141,0)
Installation will take less than 5 minutes.
"PKG",649,22,1,"PAH",1,1,142,0)
 
"PKG",649,22,1,"PAH",1,1,143,0)
    1) Use the INSTALL/CHECK MESSAGE option on the PackMan menu to unload
"PKG",649,22,1,"PAH",1,1,144,0)
       the KIDS distribution included with this message.
"PKG",649,22,1,"PAH",1,1,145,0)
    2) From the Kernel Installation and Distribution System Menu,
"PKG",649,22,1,"PAH",1,1,146,0)
       select the Installation menu.
"PKG",649,22,1,"PAH",1,1,147,0)
    3) From this menu, you may elect to use the following options
"PKG",649,22,1,"PAH",1,1,148,0)
       (when prompted for the INSTALL NAME, enter VBEC*2*1).
"PKG",649,22,1,"PAH",1,1,149,0)
       a) Backup a Transport Global - this option will create a backup
"PKG",649,22,1,"PAH",1,1,150,0)
          message of any routines exported with the patch. It will NOT
"PKG",649,22,1,"PAH",1,1,151,0)
          backup any other changes such as DDs or templates.
"PKG",649,22,1,"PAH",1,1,152,0)
       b) Compare Transport Global to Current System - this option will
"PKG",649,22,1,"PAH",1,1,153,0)
          allow you to view all changes that will be made when the patch
"PKG",649,22,1,"PAH",1,1,154,0)
          is installed. It compares all components of the patch
"PKG",649,22,1,"PAH",1,1,155,0)
          (routines, DDs, templates, etc.).
"PKG",649,22,1,"PAH",1,1,156,0)
       c) Verify Checksums in Transport Global - this option will allow
"PKG",649,22,1,"PAH",1,1,157,0)
          you to ensure the integrity of the routines that are in the
"PKG",649,22,1,"PAH",1,1,158,0)
          transport global.
"PKG",649,22,1,"PAH",1,1,159,0)
       d) Print Transport Global - this option will allow you to view 
"PKG",649,22,1,"PAH",1,1,160,0)
          the components of the KIDS build.
"PKG",649,22,1,"PAH",1,1,161,0)
    4) Use the Install Package(s) option and select the package 
"PKG",649,22,1,"PAH",1,1,162,0)
       VBEC*2*1.
"PKG",649,22,1,"PAH",1,1,163,0)
    5) If prompted 'This Patch is for Version 2, you are running
"PKG",649,22,1,"PAH",1,1,164,0)
       Version 1 Want to continue installing this build? No//' respond 
"PKG",649,22,1,"PAH",1,1,165,0)
YES.
"PKG",649,22,1,"PAH",1,1,166,0)
    6) When prompted 'Want KIDS to INHIBIT LOGONs during the install? 
"PKG",649,22,1,"PAH",1,1,167,0)
       NO//'  respond NO.
"PKG",649,22,1,"PAH",1,1,168,0)
    7) When prompted 'Want to DISABLE Scheduled Options, Menu Options, 
"PKG",649,22,1,"PAH",1,1,169,0)
       and Protocols? NO//'  respond NO.
"PRE")
VBEC2P1
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
6
"RTN","VBEC2P1")
0^^B5998326^n/a
"RTN","VBEC2P1",1,0)
VBEC2P1 ;RLM/VBEC - VBECS PATCH PREINSTALL ROUTINE ; Jan 04, 2018@15:33
"RTN","VBEC2P1",2,0)
 ;;2.0;VBEC;**1**;Jun 05, 2015;Build 13
"RTN","VBEC2P1",3,0)
 ; Use of ^XPDUTL is supported by Integration Agreement: 10141
"RTN","VBEC2P1",4,0)
 ; Use of ^XMXAPI is supported by Integration Agreement: 2729
"RTN","VBEC2P1",5,0)
 ; Use of ^XPDIP is supported by Integration Agreement: 2067
"RTN","VBEC2P1",6,0)
ENV ;Environment Check
"RTN","VBEC2P1",7,0)
 K XPDQUIT,MSG
"RTN","VBEC2P1",8,0)
 I '(+$O(^LAB(60,"B","VBEC PATIENT REFLEX TEST",0))) D
"RTN","VBEC2P1",9,0)
  . S MSG(1)="The ""VBEC PATIENT REFLEX TEST"" test has not been created."
"RTN","VBEC2P1",10,0)
  . S MSG(2)="Please create the test with the following information"
"RTN","VBEC2P1",11,0)
  . S MSG(3)="and continue with the patch installation."
"RTN","VBEC2P1",12,0)
  . S MSG(4)=""
"RTN","VBEC2P1",13,0)
  . S MSG(5)=" NAME: VBEC PATIENT REFLEX TEST          TYPE: NEITHER"
"RTN","VBEC2P1",14,0)
  . S MSG(6)="  SUBSCRIPT: WORKLOAD                   HIGHEST URGENCY ALLOWED: ROUTINE"
"RTN","VBEC2P1",15,0)
  . S MSG(7)="  PRINT NAME: VBEC PATIENT REFLEX       CREATION DATE:"
"RTN","VBEC2P1",16,0)
  . S MSG(8)=""
"RTN","VBEC2P1",17,0)
  . S MSG(9)=""
"RTN","VBEC2P1",18,0)
  . S XPDQUIT=2 D MES^XPDUTL(.MSG)
"RTN","VBEC2P1",19,0)
 Q
"RTN","VBEC2P1",20,0)
PRE ;Pre Init
"RTN","VBEC2P1",21,0)
 ;Update version field
"RTN","VBEC2P1",22,0)
 N DIC,X,Y,Z
"RTN","VBEC2P1",23,0)
 S DIC(0)="BX",DIC="^DIC(9.4,",X="VBECS" D ^DIC Q:Y<0
"RTN","VBEC2P1",24,0)
 S Z=$$PKGVER^XPDIP(+Y,"2.0")
"RTN","VBEC2P1",25,0)
 Q
"RTN","VBEC2P1",26,0)
POST ;Post Init
"RTN","VBEC2P1",27,0)
 ;Send a message showing successful installation.
"RTN","VBEC2P1",28,0)
 K ^TMP("VBEC",$J)
"RTN","VBEC2P1",29,0)
 s ^TMP("VBEC",$J,1,0)="Patch VBEC*2*1 has been installed by "_$$GET1^DIQ(200,DUZ_",",".01","E","VBECN","ERR")_" at "_$P($$SITE^VASITE,"^",2)
"RTN","VBEC2P1",30,0)
 s ^TMP("VBEC",$J,2,0)=" "
"RTN","VBEC2P1",31,0)
 S VBECLAB=+$O(^LAB(60,"B","VBEC PATIENT REFLEX TEST",0)) I VBECLAB S VBECLAB1=$P($G(^LAB(60,VBECLAB,0)),"^")
"RTN","VBEC2P1",32,0)
 s ^TMP("VBEC",$J,3,0)=" NOTE! Reflex test has not been created!"
"RTN","VBEC2P1",33,0)
 I $G(VBECLAB1)]"" s ^TMP("VBEC",$J,3,0)=VBECLAB1_" has been created with IEN "_VBECLAB
"RTN","VBEC2P1",34,0)
 s ^TMP("VBEC",$J,4,0)=" "
"RTN","VBEC2P1",35,0)
 s ^TMP("VBEC",$J,5,0)="Current version is: "_$$VERSION^XPDUTL("VBEC")
"RTN","VBEC2P1",36,0)
 s XMSUB="VBEC*2*1 Patch Installation verification",XMTEXT="^TMP(""VBEC"",$J)",XMDUN="VBECS Patch Monitor"
"RTN","VBEC2P1",37,0)
 s XMY("G.VBEC@FORUM.DOMAIN.EXT")=""
"RTN","VBEC2P1",38,0)
 d SENDMSG^XMXAPI(DUZ,XMSUB,XMTEXT,.XMY)
"RTN","VBEC2P1",39,0)
 k ^TMP("VBEC",$J),XMY,XMSUB,VBECLAB,VBECLAB1
"RTN","VBEC2P1",40,0)
 q
"RTN","VBECA7")
0^6^B34071335^B32810678
"RTN","VBECA7",1,0)
VBECA7 ;DALOI/RLM - Workload API ; 8/18/04 10:40am
"RTN","VBECA7",2,0)
 ;;2.0;VBECS;**1**;Jun 05, 2015;Build 13
"RTN","VBECA7",3,0)
 ;
"RTN","VBECA7",4,0)
 ; Note: This routine supports data exchange with an FDA registered
"RTN","VBECA7",5,0)
 ; medical device. As such, it may not be changed in any way without
"RTN","VBECA7",6,0)
 ; prior written approval from the medical device manufacturer.
"RTN","VBECA7",7,0)
 ; 
"RTN","VBECA7",8,0)
 ; Integration Agreements:
"RTN","VBECA7",9,0)
 ;  VBECS workload capture supported by IA 4627
"RTN","VBECA7",10,0)
 ; Reference to EN^MXMLPRSE supported by IA #4149
"RTN","VBECA7",11,0)
 ; Reference to $$FIND1^DIC supported by IA #2051
"RTN","VBECA7",12,0)
 ; Reference to UPDATE^DIE supported by IA #2053
"RTN","VBECA7",13,0)
 ; 
"RTN","VBECA7",14,0)
 QUIT
"RTN","VBECA7",15,0)
 ;
"RTN","VBECA7",16,0)
 ; ----------------------------------------------------------
"RTN","VBECA7",17,0)
 ;      Private Method Supports IA 4767
"RTN","VBECA7",18,0)
 ; ----------------------------------------------------------
"RTN","VBECA7",19,0)
WKLDCAP() ;
"RTN","VBECA7",20,0)
 S NEWWKLD=0
"RTN","VBECA7",21,0)
 D INITV^VBECRPCC("VBECS Workload")
"RTN","VBECA7",22,0)
 I +VBECPRMS("ERROR") S ARR("ERROR")=VBECPRMS("ERROR") Q
"RTN","VBECA7",23,0)
 S VBECPRMS("PARAMS",1,"TYPE")="STRING"
"RTN","VBECA7",24,0)
 S VBECPRMS("PARAMS",1,"VALUE")="P"
"RTN","VBECA7",25,0)
 F I=1:0 D  Q:'NEWWKLD
"RTN","VBECA7",26,0)
 . S NEWWKLD=0
"RTN","VBECA7",27,0)
 . S VBECSTAT=$$EXECUTE^VBECRPCC(.VBECPRMS)
"RTN","VBECA7",28,0)
 . S VBECY=$NA(^TMP("VBECS_XML_RES",$J))
"RTN","VBECA7",29,0)
 . K @VBECY
"RTN","VBECA7",30,0)
 . D PARSE^VBECRPC1(.VBECPRMS,VBECY)
"RTN","VBECA7",31,0)
 . I $D(@VBECY@("ERROR")) S ARR("ERROR")="1^"_@VBECY@("ERROR") S NEWWKLD=0 Q
"RTN","VBECA7",32,0)
 . D PARSE
"RTN","VBECA7",33,0)
 ;
"RTN","VBECA7",34,0)
EXIT I $D(VBERR) S ARR("ERROR")="1^Errors encountered during parse"
"RTN","VBECA7",35,0)
 K @VBECY,ATR,CBK,DIERR,ELE,FDA,OPTION,TEXT,VBECPRMS
"RTN","VBECA7",36,0)
 K VBECRES,VBECSTAT,VBECY,VBERRA,VBERRB
"RTN","VBECA7",37,0)
 Q '(+$D(ARR)) ;This will return a 1 for a successful transfer and load
"RTN","VBECA7",38,0)
PARSE ;The callbacks defined here will allow the MXMLPRSE API to place
"RTN","VBECA7",39,0)
 ;the data directly into file 6002.01
"RTN","VBECA7",40,0)
 S CBK("STARTELEMENT")="STELE^VBECA7"
"RTN","VBECA7",41,0)
 S CBK("ENDELEMENT")="ENELE^VBECA7"
"RTN","VBECA7",42,0)
 S CBK("CHARACTERS")="CHAR^VBECA7"
"RTN","VBECA7",43,0)
 S OPTION=""
"RTN","VBECA7",44,0)
 D EN^MXMLPRSE(VBECY,.CBK,.OPTION)
"RTN","VBECA7",45,0)
 Q
"RTN","VBECA7",46,0)
STELE(ELE,ATR) ;File the data for each attribute in the FDA array
"RTN","VBECA7",47,0)
 ;for use by the UPDATE^DIE Database Server API.
"RTN","VBECA7",48,0)
 I $D(ATR) D
"RTN","VBECA7",49,0)
  . I ELE["Trans",$D(ATR("id")) S FDA(1,6002.01,"+1,",.01)=ATR("id"),NEWWKLD=1
"RTN","VBECA7",50,0)
  . I $D(ATR("type")) S FDA(1,6002.01,"+1,",1)=ATR("type")
"RTN","VBECA7",51,0)
  . I $D(ATR("division")) S ATR("division")=$TR(ATR("division")," ",""),FDA(1,6002.01,"+1,",2)=$$FIND1^DIC(4,,"MX",ATR("division")) ;RLM 9/22/2010
"RTN","VBECA7",52,0)
  . I $D(ATR("accessionArea")) D
"RTN","VBECA7",53,0)
  . . S FDA(1,6002.01,"+1,",14)=ATR("accessionArea")
"RTN","VBECA7",54,0)
  . I $D(ATR("dateTime")) S FDA(1,6002.01,"+1,",3)=ATR("dateTime")
"RTN","VBECA7",55,0)
  . I $D(ATR("status")) S FDA(1,6002.01,"+1,",5)=ATR("status")
"RTN","VBECA7",56,0)
  . I $D(ATR("code")) D
"RTN","VBECA7",57,0)
  . . ;S FDA(1,6002.01,"+1,",6)=$$WKLDPTR(ATR("code"))
"RTN","VBECA7",58,0)
  . . S FDA(1,6002.01,"+1,",6)=$$WKLDPTR1(ATR("code"),ATR("method")) ;RLM 6-3-10
"RTN","VBECA7",59,0)
  . I $D(ATR("method")) D  ;RLM 6-3-10
"RTN","VBECA7",60,0)
  . . S FDA(1,6002.01,"+1,",7)=$$MTHDPTR(ATR("method")) ;RLM 6-3-10
"RTN","VBECA7",61,0)
  . I $D(ATR("multiplyFactor")) S FDA(1,6002.01,"+1,",8)=ATR("multiplyFactor")
"RTN","VBECA7",62,0)
  . I $D(ATR("dfn")) D
"RTN","VBECA7",63,0)
  . . I $D(^DPT(ATR("dfn"),-9)) S ATR("dfn")=+^DPT(ATR("dfn"),-9)
"RTN","VBECA7",64,0)
  . . I $D(^DPT(ATR("dfn"))) S FDA(1,6002.01,"+1,",9)=ATR("dfn")
"RTN","VBECA7",65,0)
  . I $D(ATR("duz")) D
"RTN","VBECA7",66,0)
  . . I $D(^VA(200,ATR("duz"))) S FDA(1,6002.01,"+1,",10)=ATR("duz")
"RTN","VBECA7",67,0)
  . I $D(ATR("accessionNumber")) S FDA(1,6002.01,"+1,",11)=ATR("accessionNumber")
"RTN","VBECA7",68,0)
  . I $D(ATR("testPerformed")) D
"RTN","VBECA7",69,0)
  . . I ATR("testPerformed")["REFLEX TEST" S ATR("testPerformed")=+$O(^LAB(60,"B","VBEC PATIENT REFLEX TEST",0)) ;RLM 1/10/2018
"RTN","VBECA7",70,0)
  . . I $D(^LAB(60,$$STRIP^XLFSTR(ATR("testPerformed")," "))) S FDA(1,6002.01,"+1,",12)=$$STRIP^XLFSTR(ATR("testPerformed")," ")
"RTN","VBECA7",71,0)
  . I ELE["Unit",$D(ATR("id")) S FDA(1,6002.01,"+1,",13)=ATR("id")
"RTN","VBECA7",72,0)
 Q
"RTN","VBECA7",73,0)
ENELE(ELE) ;Ignore the end of each element until the end of
"RTN","VBECA7",74,0)
 ;WorkloadTransactions is found.  File the data at this point.
"RTN","VBECA7",75,0)
 I ELE="WorkloadTransactions" D
"RTN","VBECA7",76,0)
  . Q:'NEWWKLD
"RTN","VBECA7",77,0)
  . D UPDATE^DIE("","FDA(1)",,"VBERR")
"RTN","VBECA7",78,0)
  . ;We'll remove the Writes and handle the errors in a different way
"RTN","VBECA7",79,0)
  . ;prior to release.
"RTN","VBECA7",80,0)
  . I $D(VBERR) D  ;W !,"An error has occurred with ID ",FDA(1,6002.01,"+1,",.01) D
"RTN","VBECA7",81,0)
  . . S (VBERRA,VBERRB,VBERRC)="" F  S VBERRA=$O(VBERR("DIERR",VBERRA)) Q:'VBERRA  F  S VBERRB=$O(VBERR("DIERR",VBERRA,"TEXT",VBERRB)) Q:'VBERRB  S VBERRC=VBERRC+1,XMTEXT(VBERRC)=VBERR("DIERR",VBERRA,"TEXT",VBERRB) K DIERR,VBERR
"RTN","VBECA7",82,0)
  . . S XMDUZ="VBECS Workload Event"
"RTN","VBECA7",83,0)
  . . S XMSUB="VBECS Workload Event"
"RTN","VBECA7",84,0)
  . . S XMTEXT="VBLN("
"RTN","VBECA7",85,0)
  . . S XMY("G.VBECS INTERFACE ADMIN")=""
"RTN","VBECA7",86,0)
  . . D ^XMD
"RTN","VBECA7",87,0)
  . . ;S (VBERRA,VBERRB)="" F  S VBERRA=$O(VBERR("DIERR",VBERRA)) Q:'VBERRA  F  S VBERRB=$O(VBERR("DIERR",VBERRA,"TEXT",VBERRB)) Q:'VBERRB  S ARR("ERROR")="1^Errors encountered during parse" W !,VBERR("DIERR",VBERRA,"TEXT",VBERRB) K DIERR,VBERR
"RTN","VBECA7",88,0)
 Q
"RTN","VBECA7",89,0)
CHAR(TEXT) ;This one isn't necessary, but we'll report an error
"RTN","VBECA7",90,0)
 ;if text is found.
"RTN","VBECA7",91,0)
 S VBERR("DIERR",999999,"TEXT",999999)="TEXT was returned unexpectedly"
"RTN","VBECA7",92,0)
 Q
"RTN","VBECA7",93,0)
WKLDPTR(CODE) ; Gets the pointer to the workload code file 64
"RTN","VBECA7",94,0)
 I $L($P(CODE,".",2))'=5 D
"RTN","VBECA7",95,0)
 . S VBSUFX=$P(CODE,".",2)
"RTN","VBECA7",96,0)
 . F I=1:1 S VBSUFX=VBSUFX_" " Q:$L(VBSUFX)=5
"RTN","VBECA7",97,0)
 . S $P(CODE,".",2)=VBSUFX
"RTN","VBECA7",98,0)
 Q $S($D(^LAM("C",CODE)):$O(^LAM("C",CODE,0)),1:0)
"RTN","VBECA7",99,0)
 Q
"RTN","VBECA7",100,0)
WKLDPTR1(CODE,CODE1) ; Gets the pointer to the workload code file 64 SWITCH TO E X-REF
"RTN","VBECA7",101,0)
 S CODE=$P(CODE,"."),CODE1=$TR(CODE1,".","") S:'CODE1 CODE1="0000"
"RTN","VBECA7",102,0)
 Q $S($D(^LAM("E",CODE_"."_CODE1)):$O(^LAM("E",CODE_"."_CODE1,0)),1:0)
"RTN","VBECA7",103,0)
 Q
"RTN","VBECA7",104,0)
MTHDPTR(CODE) ; Gets the pointer to the workload code file 64
"RTN","VBECA7",105,0)
 S LRSUF=$$FIND1^DIC(64.2,"","O","."_CODE_" ","C","","ERR")
"RTN","VBECA7",106,0)
 Q $S(LRSUF:LRSUF,1:"") ;
"RTN","VBECA7",107,0)
 ; ----------------------------------------------------------
"RTN","VBECA7",108,0)
 ;      Private Method Supports IA 4767
"RTN","VBECA7",109,0)
 ; ----------------------------------------------------------
"RTN","VBECA7",110,0)
UPDTWKLD ; Update VBECS Workload
"RTN","VBECA7",111,0)
 D UPDTWKLD^VBECA7A
"RTN","VBECA7",112,0)
 Q
"RTN","VBECA7",113,0)
TESTSET ;This sets up test data.
"RTN","VBECA7",114,0)
 Q  ;ZL VBECA7 D ZEOR,PARSE ;To test
"RTN","VBECA7",115,0)
 S ^TMP("VBEC_XML_RES",$J,1)="<BloodBank><WorkloadTransactions><Transaction id=""FIRST"" type=""P"" division=""589"" dateTime=""3040614"" status=""S""><Workload code=""Acetone"" method=""ACUTE"" multiplyFactor=""1"" />"
"RTN","VBECA7",116,0)
 S ^TMP("VBEC_XML_RES",$J,2)="<Patient dfn=""262768"" /><VbecsUser duz=""7"" /><Lab accessionNumber=""789"" testPerformed=""ABG"" /><Unit id=""A1"" /></Transaction></WorkloadTransactions>"
"RTN","VBECA7",117,0)
 Q
"RTN","VBECA7",118,0)
 ;
"RTN","VBECA7",119,0)
ZEOR ;VBECA7
"RTN","VBECHLOR")
0^2^B17674758^B17460611
"RTN","VBECHLOR",1,0)
VBECHLOR ;;HOIFO/BNT-VBECS HL7 Order Update Message ; JULY 19, 2017@14:43
"RTN","VBECHLOR",2,0)
 ;;2.0;VBEC;**1**;Jun 05, 2015;Build 13
"RTN","VBECHLOR",3,0)
 ;
"RTN","VBECHLOR",4,0)
 ; Note: This routine supports data exchange with an FDA registered
"RTN","VBECHLOR",5,0)
 ; medical device. As such, it may not be changed in any way without
"RTN","VBECHLOR",6,0)
 ; prior written approval from the medical device manufacturer.
"RTN","VBECHLOR",7,0)
 ; 
"RTN","VBECHLOR",8,0)
 ; Integration Agreements:
"RTN","VBECHLOR",9,0)
 ; Reference to GENACK^HLMA1 supported by IA #2165
"RTN","VBECHLOR",10,0)
 ;
"RTN","VBECHLOR",11,0)
 QUIT
"RTN","VBECHLOR",12,0)
 ;
"RTN","VBECHLOR",13,0)
EN ; -- main entry point for HL7 v1.6 message processing.
"RTN","VBECHLOR",14,0)
 N ORMSG,ORNMSP,ORTYPE,ORACK,ORERR,ORVP,ORTS,ORL,ORCAT,I,J,SNDACK,SG
"RTN","VBECHLOR",15,0)
 N ORDCNTRL,ORDSTS,PKGIFN,ORIFN,ORNP,ORTN,ORLOG,ORDUZ,ORQT,ORSTRT,ORSTOP
"RTN","VBECHLOR",16,0)
 N ORURG,ORNATR,OREASON,ORI,ORSEG,ORSEGID
"RTN","VBECHLOR",17,0)
 ;
"RTN","VBECHLOR",18,0)
 ; Is this an Acknowledgement message?  Additional ACK message types
"RTN","VBECHLOR",19,0)
 ; should be included in this $S statment where appropriate to set
"RTN","VBECHLOR",20,0)
 ; ORACK=1
"RTN","VBECHLOR",21,0)
 S ORACK=$S(HL("MTN")="ORG":1,HL("MTN")="ACK":1,1:0)
"RTN","VBECHLOR",22,0)
 ;
"RTN","VBECHLOR",23,0)
 F I=1:1 X HLNEXT Q:HLQUIT'>0  D
"RTN","VBECHLOR",24,0)
 . S ORMSG(I)=HLNODE,J=0
"RTN","VBECHLOR",25,0)
 . F  S J=$O(HLNODE(J)) Q:'J  S ORMSG(I,J)=HLNODE(J)
"RTN","VBECHLOR",26,0)
 ;
"RTN","VBECHLOR",27,0)
 ;I $G(VBTEST) S X=0 F  S X=$O(^XTMP("VBECS-ORM",$J,X)) Q:X=""  S ORMSG(X)=^(X)
"RTN","VBECHLOR",28,0)
 S ORNMSP=$$NMSP(HL("SAN")),ORTYPE=HL("MTN")
"RTN","VBECHLOR",29,0)
 I '$L(ORNMSP) S ORERR="Missing or invalid sending application" D ERROR Q
"RTN","VBECHLOR",30,0)
 S ORTN="EN^ORM"_ORNMSP
"RTN","VBECHLOR",31,0)
 ;
"RTN","VBECHLOR",32,0)
 S ORI=0 F  S ORI=$O(ORMSG(ORI)) Q:'ORI  D  Q:$D(ORERR)
"RTN","VBECHLOR",33,0)
 . S ORSEG=ORMSG(ORI),ORSEGID=$P(ORMSG(ORI),HL("FS"))
"RTN","VBECHLOR",34,0)
 . I $T(@ORSEGID)]"" D @ORSEGID
"RTN","VBECHLOR",35,0)
 Q:$D(ORERR)
"RTN","VBECHLOR",36,0)
 ;
"RTN","VBECHLOR",37,0)
 I $L($G(ORDCNTRL)) D @ORTN I $D(ORERR) D ERROR Q
"RTN","VBECHLOR",38,0)
 I 'ORACK D GENACK
"RTN","VBECHLOR",39,0)
 ; If this is an Order Complete message, send message to Lab to complete the Lab order too.
"RTN","VBECHLOR",40,0)
 I ORDSTS="CM" D MSG^XQOR("LR7O VBECS RECEIVE",.ORMSG)
"RTN","VBECHLOR",41,0)
 Q
"RTN","VBECHLOR",42,0)
 ;
"RTN","VBECHLOR",43,0)
ORC S ORDCNTRL=$TR($P(ORSEG,HL("FS"),2),"@","P")
"RTN","VBECHLOR",44,0)
 I '$L(ORDCNTRL) S ORERR="Invalid control code" D ERROR Q
"RTN","VBECHLOR",45,0)
 S ORIFN=$P($P(ORSEG,HL("FS"),3),$E(HL("ECH")))
"RTN","VBECHLOR",46,0)
 S PKGIFN=$P($P(ORSEG,HL("FS"),4),$E(HL("ECH")))
"RTN","VBECHLOR",47,0)
 I ORIFN,$G(ORVP),$D(^OR(100,+ORIFN,0)),$P(^(0),U,2)'=ORVP S ORERR="Patient doesn't match" D ERROR Q
"RTN","VBECHLOR",48,0)
 S ORDSTS=$P(ORSEG,HL("FS"),6) ;orc.5
"RTN","VBECHLOR",49,0)
 S ORQT=$P(ORSEG,HL("FS"),8)
"RTN","VBECHLOR",50,0)
 S ORSTRT=$$FMDATE($P(ORQT,U,4))
"RTN","VBECHLOR",51,0)
 S ORSTOP=$$FMDATE($P(ORQT,U,5))
"RTN","VBECHLOR",52,0)
 S ORURG=$$URGENCY($P(ORQT,U,6))
"RTN","VBECHLOR",53,0)
 S ORLOG=$$FMDATE($P(ORSEG,HL("FS"),10))
"RTN","VBECHLOR",54,0)
 S OREASON=$P(ORSEG,HL("FS"),17) ;rlm 9/26/17
"RTN","VBECHLOR",55,0)
 S ORDUZ=+$P($P(ORSEG,HL("FS"),17),"^",5) ;RLM 09/26/17
"RTN","VBECHLOR",56,0)
 S ORNP=+$P(ORSEG,HL("FS"),13)
"RTN","VBECHLOR",57,0)
 S ORNATR=$S($P(OREASON,$E(HL("ECH")),3)="99ORN":$P(OREASON,$E(HL("ECH"))),1:"")
"RTN","VBECHLOR",58,0)
 Q
"RTN","VBECHLOR",59,0)
 ;
"RTN","VBECHLOR",60,0)
NMSP(NAME) ; -- Returns pkg namespace
"RTN","VBECHLOR",61,0)
 I NAME="RADIOLOGY"!(NAME="IMAGING") Q "RA"
"RTN","VBECHLOR",62,0)
 I NAME="LABORATORY" Q "LR"
"RTN","VBECHLOR",63,0)
 I NAME="DIETETICS" Q "FH"
"RTN","VBECHLOR",64,0)
 I NAME="PHARMACY" Q "PS"
"RTN","VBECHLOR",65,0)
 I NAME="CONSULTS" Q "GMRC"
"RTN","VBECHLOR",66,0)
 I NAME="PROCEDURES" Q "GMRC"
"RTN","VBECHLOR",67,0)
 I NAME="ORDER ENTRY" Q "ORG"
"RTN","VBECHLOR",68,0)
 I NAME="VBECS" Q "VBEC"
"RTN","VBECHLOR",69,0)
 Q ""
"RTN","VBECHLOR",70,0)
 ;
"RTN","VBECHLOR",71,0)
MSA ; -- Process MSA segment
"RTN","VBECHLOR",72,0)
 S ORACK=1
"RTN","VBECHLOR",73,0)
 I $P(ORSEG,HL("FS"),2)'="AA" D
"RTN","VBECHLOR",74,0)
 . S ORERR=$P(ORSEG,HL("FS"),4)
"RTN","VBECHLOR",75,0)
 . I '$D(OREASON) S OREASON=U_ORERR
"RTN","VBECHLOR",76,0)
 . D ERROR Q
"RTN","VBECHLOR",77,0)
 Q
"RTN","VBECHLOR",78,0)
 ;
"RTN","VBECHLOR",79,0)
PID ; -- Process PID segment
"RTN","VBECHLOR",80,0)
 ;    Sets PID, ORVP, ORTS if valid patient
"RTN","VBECHLOR",81,0)
 N I,DFN,SEG,PIDLST,X
"RTN","VBECHLOR",82,0)
 ; Adding logic to support v2.4 Patient Id List
"RTN","VBECHLOR",83,0)
 S PIDLST=$P(ORSEG,HL("FS"),4)
"RTN","VBECHLOR",84,0)
 I PIDLST[$E(HL("ECH")) D
"RTN","VBECHLOR",85,0)
 . F I=1:1:$L(PIDLST,$E(HL("ECH"),2)) S X=$P(PIDLST,$E(HL("ECH"),2),I) Q:X=""  I $P(X,$E(HL("ECH")),5)["PI" S DFN=+X Q
"RTN","VBECHLOR",86,0)
 I PIDLST'[$E(HL("ECH")) S DFN=+$P(ORSEG,HL("FS"),4),PID=ORSEG
"RTN","VBECHLOR",87,0)
 I $D(^DPT(DFN,0)) S ORVP=DFN_";DPT(",ORTS=$G(^DPT(DFN,.103)) Q
"RTN","VBECHLOR",88,0)
 S:$L($P(ORSEG,HL("FS"),5)) ORVP=$P(ORSEG,HL("FS"),5) ; alt ID for Lab
"RTN","VBECHLOR",89,0)
 I '$G(ORVP) S ORERR="Missing or invalid patient ID" D ERROR Q
"RTN","VBECHLOR",90,0)
 Q
"RTN","VBECHLOR",91,0)
 ;
"RTN","VBECHLOR",92,0)
PV1 ; -- Process PV1 segment
"RTN","VBECHLOR",93,0)
 ;    Sets ORCAT, & ORL if valid location
"RTN","VBECHLOR",94,0)
 N I,X
"RTN","VBECHLOR",95,0)
 S X=+$P(ORSEG,HL("FS"),4),ORCAT=$P(ORSEG,HL("FS"),3)
"RTN","VBECHLOR",96,0)
 S:$D(^SC(X,0)) ORL=X_";SC("
"RTN","VBECHLOR",97,0)
 Q
"RTN","VBECHLOR",98,0)
 ;
"RTN","VBECHLOR",99,0)
ORDITEM(USID) ; -- Returns pointer to Orderable Item file for USID
"RTN","VBECHLOR",100,0)
 N ID,OI
"RTN","VBECHLOR",101,0)
 S ID=$P(USID,U,4)_";"_$P(USID,U,6)
"RTN","VBECHLOR",102,0)
 S OI=+$O(^ORD(101.43,"ID",ID,0))
"RTN","VBECHLOR",103,0)
 Q OI
"RTN","VBECHLOR",104,0)
 ;
"RTN","VBECHLOR",105,0)
URGENCY(CODE) ; -- Return ptr to Order Urgency file #101.42
"RTN","VBECHLOR",106,0)
 S:'$L(CODE) CODE="R"
"RTN","VBECHLOR",107,0)
 Q $O(^ORD(101.42,"C",CODE,0))
"RTN","VBECHLOR",108,0)
 ;
"RTN","VBECHLOR",109,0)
FMDATE(Y) ; -- Convert HL7 date/time to FM format
"RTN","VBECHLOR",110,0)
 Q $$HL7TFM^XLFDT(Y)  ;**97
"RTN","VBECHLOR",111,0)
 ;
"RTN","VBECHLOR",112,0)
ERROR ; -- Log an error and return ACK if necessary
"RTN","VBECHLOR",113,0)
 N ORV S ORV("XQY0")="",ORQUIT=1
"RTN","VBECHLOR",114,0)
 D EN^ORERR(ORERR,.ORMSG,.ORV)
"RTN","VBECHLOR",115,0)
 ; send an ack to current message ??
"RTN","VBECHLOR",116,0)
 I 'ORACK D GENACK
"RTN","VBECHLOR",117,0)
 Q
"RTN","VBECHLOR",118,0)
 ;
"RTN","VBECHLOR",119,0)
GENACK ; -- Send and acknowldegement to original message
"RTN","VBECHLOR",120,0)
 Q:$G(VBTEST)
"RTN","VBECHLOR",121,0)
 S MSA1="AA"
"RTN","VBECHLOR",122,0)
 I $D(ORERR) S MSA1="AR"
"RTN","VBECHLOR",123,0)
 S HLA("HLA",1)="MSA"_HL("FS")_MSA1_HL("FS")_HL("MID")_$S($D(ORERR):HL("FS")_ORERR,1:"")
"RTN","VBECHLOR",124,0)
 S HLEID=HL("EID"),HLEIDS=HL("EIDS")
"RTN","VBECHLOR",125,0)
 D GENACK^HLMA1(HL("EID"),HLMTIENS,HL("EIDS"),"LM",1,.RESULT)
"RTN","VBECHLOR",126,0)
 K MSA
"RTN","VBECHLOR",127,0)
 Q
"RTN","VBECHLOR",128,0)
TEST ; Testing utility
"RTN","VBECHLOR",129,0)
 ;Q
"RTN","VBECHLOR",130,0)
 S VBTEST=1
"RTN","VBECHLOR",131,0)
 S HL("FS")="|",HL("ECH")="^~\&",HL("SAN")="VBECS",HL("RAN")="OERR"
"RTN","VBECHLOR",132,0)
 S HL("MTN")="OMG"
"RTN","VBECHLOR",133,0)
 D EN
"RTN","VBECHLOR",134,0)
 Q
"RTN","VBECLU")
0^3^B62564378^B62085514
"RTN","VBECLU",1,0)
VBECLU ;HIOFO/bnt-VBECS Patient Lookup Utility ; 9/8/05 12:43pm
"RTN","VBECLU",2,0)
 ;;2.0;VBEC;**1**;Jun 05, 2015;Build 13
"RTN","VBECLU",3,0)
 ;
"RTN","VBECLU",4,0)
 ; Note: This routine supports data exchange with an FDA registered
"RTN","VBECLU",5,0)
 ; medical device. As such, it may not be changed in any way without
"RTN","VBECLU",6,0)
 ; prior written approval from the medical device manufacturer.
"RTN","VBECLU",7,0)
 ; 
"RTN","VBECLU",8,0)
 ; Integration Agreements:
"RTN","VBECLU",9,0)
 ; Call to GETICN^MPIF001 is supported by IA: 2701
"RTN","VBECLU",10,0)
 ; Reference to $$FMTHL7^XLFDT supported by IA #10103
"RTN","VBECLU",11,0)
 ; Reference to $$CHARCHK^XOBVLIB supported by IA #4090
"RTN","VBECLU",12,0)
 ; Reference to DT^DICRW supported by IA #10005
"RTN","VBECLU",13,0)
 ; Call to $$UP^XLFSTR is supported by IA: 10104
"RTN","VBECLU",14,0)
 ; Call to ^DIM is supported by IA: 10016
"RTN","VBECLU",15,0)
 ; Call to ^VA(200 is supported by IA: 10060
"RTN","VBECLU",16,0)
 ; Reference to FIND^DIC supported by IA #2051
"RTN","VBECLU",17,0)
 ; 
"RTN","VBECLU",18,0)
 ;
"RTN","VBECLU",19,0)
 SET X="You Can't Enter VBECLU at top of routine!"
"RTN","VBECLU",20,0)
 QUIT
"RTN","VBECLU",21,0)
 ;
"RTN","VBECLU",22,0)
SEARCH(RESULT,PARAMS) ; -- return patient data in XML format
"RTN","VBECLU",23,0)
 ; -- RPC:  VBEC PATIENT LOOKUP SEARCH
"RTN","VBECLU",24,0)
 ; -- 
"RTN","VBECLU",25,0)
 ; -- input  PARAMS ARRAY
"RTN","VBECLU",26,0)
 ;           PARAMS("SEARCH_TYPE") = "NAME", "SSN", ICN, SSN4
"RTN","VBECLU",27,0)
 ;           PARAMS("SEARCH_VALUE") = value to search for.
"RTN","VBECLU",28,0)
 ; 
"RTN","VBECLU",29,0)
 NEW I,X,Y,VBECPCNT,VBECLINE,VBECRSLT,SEARCH,VALUE,FILTER,FILTERV,BDATE,EDATE
"RTN","VBECLU",30,0)
 NEW MAXSIZE,MAXSIZRE,LINENO,DELIM,MSCREEN,RESTRICT,ERRMSG
"RTN","VBECLU",31,0)
 IF '$D(DT) D DT^DICRW
"RTN","VBECLU",32,0)
 ;KILL RESULT
"RTN","VBECLU",33,0)
 SET VBECPCNT=0
"RTN","VBECLU",34,0)
 SET VBECLINE=0
"RTN","VBECLU",35,0)
 SET VBECRSLT="^TMP(""VBEC-PLU-SEARCH"",$J)"
"RTN","VBECLU",36,0)
 SET RESULT=$NA(@VBECRSLT)
"RTN","VBECLU",37,0)
 K @RESULT
"RTN","VBECLU",38,0)
 ;
"RTN","VBECLU",39,0)
 SET SEARCH=$$UP^XLFSTR($GET(PARAMS("SEARCH_TYPE")))
"RTN","VBECLU",40,0)
 SET VALUE=$$UP^XLFSTR($GET(PARAMS("SEARCH_VALUE")))
"RTN","VBECLU",41,0)
 SET MAXSIZE=+$GET(PARAMS("MAX_PATIENTS"),50),MAXSIZRE=0
"RTN","VBECLU",42,0)
 IF (MAXSIZE<5) SET MAXSIZE=5
"RTN","VBECLU",43,0)
 IF (MAXSIZE>100) SET MAXSIZE=100
"RTN","VBECLU",44,0)
 ;
"RTN","VBECLU",45,0)
 SET FILTER=$$UP^XLFSTR($GET(PARAMS("FILTER_TYPE")))
"RTN","VBECLU",46,0)
 SET FILTERV=$G(PARAMS("FILTER_VALUE"))
"RTN","VBECLU",47,0)
 SET BDATE=$G(PARAMS("CLINIC_STARTDATE"))
"RTN","VBECLU",48,0)
 SET EDATE=$G(PARAMS("CLINIC_ENDDATE"))
"RTN","VBECLU",49,0)
 SET MSCREEN=$$UP^XLFSTR($G(PARAMS("MSCREEN")))
"RTN","VBECLU",50,0)
 IF MSCREEN'="" DO
"RTN","VBECLU",51,0)
 . SET X=MSCREEN D ^DIM IF $D(X)=0 SET MSCREEN="" SET ERRMSG="MSCREEN is invalid M code" Q
"RTN","VBECLU",52,0)
 . IF $E(MSCREEN)'="I" SET MSCREEN="" SET ERRMSG="MSCREEN Deleted, must start with an If statement." Q
"RTN","VBECLU",53,0)
 . IF MSCREEN[" S "!(MSCREEN[" SET ")!(MSCREEN[" S:")!(MSCREEN["SET:") SET MSCREEN="" SET ERRMSG="MSCREEN Deleted, can not set values." Q
"RTN","VBECLU",54,0)
 . IF MSCREEN[" K "!(MSCREEN[" KILL ")!(MSCREEN[" K:")!(MSCREEN["SET:") SET MSCREEN="" SET ERRMSG="MSCREEN Deleted, can not kill values." Q
"RTN","VBECLU",55,0)
 . IF MSCREEN[" W "!(MSCREEN[" WRITE ")!(MSCREEN[" W:")!(MSCREEN["WRITE:") SET MSCREEN="" SET ERRMSG="MSCREEN Deleted, can not WRITE." Q
"RTN","VBECLU",56,0)
 SET DELIM=$G(PARAMS("DELIMITER"),",") ; Defaults to comma to support old way.
"RTN","VBECLU",57,0)
 ; 
"RTN","VBECLU",58,0)
 SET RESTRICT=$G(^VA(200,+$G(DUZ),101))
"RTN","VBECLU",59,0)
 IF +RESTRICT DO
"RTN","VBECLU",60,0)
 . S CODE="I $D(^OR(100.21,"_$P(RESTRICT,"^",2)_",10,""B"",+$G(DFN)_"";DPT(""))"
"RTN","VBECLU",61,0)
 . IF MSCREEN'="" S MSCREEN=" "_CODE Q
"RTN","VBECLU",62,0)
 . IF MSCREEN="" S MSCREEN=CODE
"RTN","VBECLU",63,0)
 ;
"RTN","VBECLU",64,0)
 IF (FILTER'=""),(FILTERV'="") DO BYFILTER^VBECLU0(FILTER,FILTERV,BDATE,EDATE,SEARCH,VALUE,DELIM) GOTO DONE
"RTN","VBECLU",65,0)
 ;
"RTN","VBECLU",66,0)
 IF (SEARCH="NAME")!(SEARCH="SSN")!(SEARCH="ICN")!(SEARCH="SSN4") D BYNAME
"RTN","VBECLU",67,0)
 ELSE  DO  GOTO DONE
"RTN","VBECLU",68,0)
 . DO ADD("<record count='0'>")
"RTN","VBECLU",69,0)
 . DO ADD("<error message='Searching for patients by "_SEARCH_" not yet implemented!'></error>")
"RTN","VBECLU",70,0)
 QUIT
"RTN","VBECLU",71,0)
 ;
"RTN","VBECLU",72,0)
BYNAME ;
"RTN","VBECLU",73,0)
 NEW FULLCNT,VBECPCNT,VBEC,NODE,DFN,XREF
"RTN","VBECLU",74,0)
 ;; copied From scutbk11
"RTN","VBECLU",75,0)
 ;; DO FIND^DIC(2,,".01;.03;.363;.09","PS",VALUE,300,"B^BS^BS5^SSN")
"RTN","VBECLU",76,0)
 ;
"RTN","VBECLU",77,0)
 IF VALUE="" DO  GOTO DONE
"RTN","VBECLU",78,0)
 . DO ADD("<record count='0'>")
"RTN","VBECLU",79,0)
 . DO ADD("<error message='Not Enough Information Provided to Search for Patients for Search Type = """_SEARCH_"""'></error>")
"RTN","VBECLU",80,0)
 ;
"RTN","VBECLU",81,0)
 IF SEARCH="NAME" SET XREF="B",VALUE=$TR(VALUE," ","") ;REMOVE SPACES
"RTN","VBECLU",82,0)
 IF SEARCH="SSN" SET XREF="BS^SSN^CN^RM",VALUE=$TR(VALUE," -","") ; REMOVE DASHES AND SPACES
"RTN","VBECLU",83,0)
 IF SEARCH="SSN4" SET XREF="BS5" DO 
"RTN","VBECLU",84,0)
 . IF $L(VALUE)>5 SET VALUE=$E(VALUE,1,5) ; can't exceed 5 characters, if P for psuedo on end take it off.
"RTN","VBECLU",85,0)
 IF SEARCH="ICN" SET XREF="AICN"
"RTN","VBECLU",86,0)
 DO FIND^DIC(2,,".01;.03;.09","MPS",VALUE,,XREF)
"RTN","VBECLU",87,0)
 IF $G(DIERR) DO  GOTO DONE
"RTN","VBECLU",88,0)
 . DO ADD("<record count='0'>")
"RTN","VBECLU",89,0)
 . DO ADD("<error message='Error occured in VistA during patient lookup'></error>")
"RTN","VBECLU",90,0)
 . DO CLEAN^DILF
"RTN","VBECLU",91,0)
 SET FULLCNT=+$G(^TMP("DILIST",$J,0))
"RTN","VBECLU",92,0)
 DO ADD("<record count='0'>")
"RTN","VBECLU",93,0)
 SET LINENO=VBECLINE
"RTN","VBECLU",94,0)
 ;
"RTN","VBECLU",95,0)
 SET VBECPCNT=0
"RTN","VBECLU",96,0)
 FOR VBEC=1:1:FULLCNT D  ;Q:$$STOP^XOBVLIB()
"RTN","VBECLU",97,0)
 . SET NODE=^TMP("DILIST",$J,VBEC,0)
"RTN","VBECLU",98,0)
 . SET DFN=$P(NODE,"^",1)
"RTN","VBECLU",99,0)
 . D PTDATA(+NODE,.VBECPCNT)
"RTN","VBECLU",100,0)
 I $G(ERRMSG)]"" D
"RTN","VBECLU",101,0)
 . DO ADD("<error message=''>"_$G(ERRMSG)_"</error>")
"RTN","VBECLU",102,0)
 ;IF ($G(MAXSIZRE)<1) DO ADD("<maximum message=''></maximum>")
"RTN","VBECLU",103,0)
 SET @VBECRSLT@(LINENO)="<record count='"_VBECPCNT_"'>"
"RTN","VBECLU",104,0)
 ;
"RTN","VBECLU",105,0)
DONE ;
"RTN","VBECLU",106,0)
 DO ADD("</record>")
"RTN","VBECLU",107,0)
 IF 1
"RTN","VBECLU",108,0)
 QUIT
"RTN","VBECLU",109,0)
 ;
"RTN","VBECLU",110,0)
EXIT ;
"RTN","VBECLU",111,0)
 QUIT
"RTN","VBECLU",112,0)
 ;
"RTN","VBECLU",113,0)
PTDATA(DFN,VBECPCNT) ;
"RTN","VBECLU",114,0)
 NEW I,DONE,LINE,ALIAS,NAME,PTNAME,DOB,DOD,SSN,TYPE,GENDER,ICN,PRIM,SC,SCPER,VET,WARD,ROOMBED,SENSITIV,DOBCODE,FNAME,LNAME,MI,X1,X2
"RTN","VBECLU",115,0)
 ;IF VBECPCNT>(MAXSIZE-1) DO MAXOUT QUIT
"RTN","VBECLU",116,0)
 IF (MSCREEN'="") X MSCREEN I '$T Q
"RTN","VBECLU",117,0)
 SET VBECPCNT=VBECPCNT+1
"RTN","VBECLU",118,0)
 ;SET LINE="<patient number='"_VBECPCNT_"' dfn='"_DFN_"'"
"RTN","VBECLU",119,0)
 DO ADD("<Patient><Number>"_VBECPCNT_"</Number><VistaPatientID>"_DFN_"</VistaPatientID>")
"RTN","VBECLU",120,0)
 ;
"RTN","VBECLU",121,0)
 SET PTNAME=$P(^DPT(DFN,0),"^",1)
"RTN","VBECLU",122,0)
 SET X1=$P(PTNAME,",",2),X2=$L(X1," "),MI=""
"RTN","VBECLU",123,0)
 IF X2 SET MI=$P(X1," ",2),X1=$P(X1," ")
"RTN","VBECLU",124,0)
 SET FNAME=$$CHARCHK^XOBVLIB(X1),MI=$$CHARCHK^XOBVLIB(MI)
"RTN","VBECLU",125,0)
 SET LNAME=$$CHARCHK^XOBVLIB($P(PTNAME,","))
"RTN","VBECLU",126,0)
 ;
"RTN","VBECLU",127,0)
 ; -- REQUIRED COMPONENTS
"RTN","VBECLU",128,0)
 SET SENSITIV=$S($P($G(^DGSL(38.1,DFN,0)),"^",2)=1:"true",1:"false")
"RTN","VBECLU",129,0)
 ; Get DOB and determine if month or day is zero and add DOB Code.
"RTN","VBECLU",130,0)
 SET DOB=$$FMTHL7^XLFDT($P($G(^DPT(DFN,0)),"^",3)),DOBCODE="V"
"RTN","VBECLU",131,0)
 ; Get Date Of Death
"RTN","VBECLU",132,0)
 SET DOD=$$CHARCHK^XOBVLIB($$FMTHL7^XLFDT($P($G(^DPT(DFN,.35)),"^")))
"RTN","VBECLU",133,0)
 IF $E(DOB,5,8)["00" DO
"RTN","VBECLU",134,0)
 . SET:$E(DOB,5,8)="0000" $E(DOB,5,8)="0101",DOBCODE="B" Q  ; Both zero
"RTN","VBECLU",135,0)
 . SET:$E(DOB,5,6)="00" $E(DOB,5,6)="01",DOBCODE="M" Q  ; Month zero
"RTN","VBECLU",136,0)
 . SET:$E(DOB,6,8)="00" $E(DOB,6,8)="01",DOBCODE="D" Q  ; day zero
"RTN","VBECLU",137,0)
 S DOB=$$CHARCHK^XOBVLIB(DOB)
"RTN","VBECLU",138,0)
 SET SSN=$$CHARCHK^XOBVLIB($P($G(^DPT(DFN,0)),"^",9))
"RTN","VBECLU",139,0)
 ;SET LINE=LINE_" sensitive='"_SENSITIV_"' name='"_NAME_"' dob='"_DOB_"' ssn='"_SSN_"' "
"RTN","VBECLU",140,0)
 DO ADD("<PatientLastName>"_LNAME_"</PatientLastName><PatientFirstName>"_FNAME_"</PatientFirstName><PatientMiddleName>"_MI_"</PatientMiddleName>")
"RTN","VBECLU",141,0)
 D NAMECOMP^VBECLU0(DFN) ;RLM 112917
"RTN","VBECLU",142,0)
 DO ADD("<Sensitive>"_SENSITIV_"</Sensitive><PatientDOB>"_DOB_"</PatientDOB><PatientDOBCode>"_DOBCODE_"</PatientDOBCode><PatientSSN>"_SSN_"</PatientSSN>")
"RTN","VBECLU",143,0)
 DO ADD("<PatientDeathDate>"_DOD_"</PatientDeathDate>")
"RTN","VBECLU",144,0)
 ;
"RTN","VBECLU",145,0)
 ; -- OPTIONAL COMPONENTS
"RTN","VBECLU",146,0)
 ;Patient Type (391)
"RTN","VBECLU",147,0)
 SET TYPE=$$CHARCHK^XOBVLIB($P($G(^DG(391,+$G(^DPT(DFN,"TYPE")),0)),"^",1))
"RTN","VBECLU",148,0)
 ;
"RTN","VBECLU",149,0)
 ;gender
"RTN","VBECLU",150,0)
 SET GENDER=$$CHARCHK^XOBVLIB($P($G(^DPT(DFN,0)),"^",2))
"RTN","VBECLU",151,0)
 ;
"RTN","VBECLU",152,0)
 ;icn
"RTN","VBECLU",153,0)
 SET ICN=$P($G(^DPT(DFN,"MPI")),"^",1)
"RTN","VBECLU",154,0)
 ; This API sets the ICN checksum.  
"RTN","VBECLU",155,0)
 SET ICN=$$GETICN^MPIF001(DFN)
"RTN","VBECLU",156,0)
 IF +ICN<0 SET ICN=$$ICNLC^MPIF001(DFN)
"RTN","VBECLU",157,0)
 ;
"RTN","VBECLU",158,0)
 ;Primary Eligibility(.361)
"RTN","VBECLU",159,0)
 SET PRIM=$$PRIM(DFN)
"RTN","VBECLU",160,0)
 ;
"RTN","VBECLU",161,0)
 SET SC=$P($G(^DPT(DFN,.3)),"^",1,2) ;Is Service Connected (.301) %=.302
"RTN","VBECLU",162,0)
 SET SCPER=$P(SC,"^",2)
"RTN","VBECLU",163,0)
 IF $P(SC,"^",1)="Y" SET SC="true"
"RTN","VBECLU",164,0)
 IF $P(SC,"^",1)="N" SET SC="false"
"RTN","VBECLU",165,0)
 ;
"RTN","VBECLU",166,0)
 SET VET=$P($G(^DPT(DFN,"VET")),"^",1) ;Veteran Status (1901)
"RTN","VBECLU",167,0)
 IF VET="Y" SET VET="true"
"RTN","VBECLU",168,0)
 IF VET="N" SET VET="false"
"RTN","VBECLU",169,0)
 ;
"RTN","VBECLU",170,0)
 SET WARD=$$CHARCHK^XOBVLIB($E($G(^DPT(DFN,.1)),1,30))
"RTN","VBECLU",171,0)
 SET ROOMBED=$$CHARCHK^XOBVLIB($P($G(^DPT(DFN,.101)),"^",1))
"RTN","VBECLU",172,0)
 ;
"RTN","VBECLU",173,0)
 ;SET LINE=LINE_" type='"_TYPE_"' primaryeligibility='"_PRIM_"' serviceconnected='"_SC_"' scpercent='"_SCPER_"'"
"RTN","VBECLU",174,0)
 DO ADD("<Type>"_TYPE_"</Type><PrimaryEligibility>"_PRIM_"</PrimaryEligibility><ServiceConnected>"_SC_"</ServiceConnected><ScPercent>"_SCPER_"</ScPercent>")
"RTN","VBECLU",175,0)
 ;SET LINE=LINE_" gender='"_GENDER_"' icn='"_ICN_"' veteran='"_VET_"' ward='"_WARD_"' roombed='"_ROOMBED_"'></patient>"
"RTN","VBECLU",176,0)
 DO ADD("<PatientSexCode>"_GENDER_"</PatientSexCode><PatientICN>"_ICN_"</PatientICN><Veteran>"_VET_"</Veteran><PatientLocation>"_WARD_"</PatientLocation><PatientRoomBed>"_ROOMBED_"</PatientRoomBed></Patient>")
"RTN","VBECLU",177,0)
 ;
"RTN","VBECLU",178,0)
 ;DO ADD(LINE)
"RTN","VBECLU",179,0)
 ;DO NAMECOMP^VBECLU0(DFN,VBECPCNT)
"RTN","VBECLU",180,0)
 ;
"RTN","VBECLU",181,0)
 QUIT
"RTN","VBECLU",182,0)
 ;
"RTN","VBECLU",183,0)
MAXOUT ;
"RTN","VBECLU",184,0)
 IF $G(MAXSIZRE)<1 DO ADD("<maximum message='Too many patients found (more than "_MAXSIZE_").  Please Limit Search.'></maximum>")
"RTN","VBECLU",185,0)
 SET MAXSIZRE=1
"RTN","VBECLU",186,0)
 QUIT
"RTN","VBECLU",187,0)
 ;
"RTN","VBECLU",188,0)
PRIM(DFN) ; -- returns print name from file 8.1
"RTN","VBECLU",189,0)
 NEW PRIM1
"RTN","VBECLU",190,0)
 SET PRIM1=$P($G(^DIC(8,+$G(^DPT(DFN,.36)),0)),"^",9) ; station entry
"RTN","VBECLU",191,0)
 Q $$CHARCHK^XOBVLIB($P($G(^DIC(8.1,+PRIM1,0)),"^",6)) ; mas entry
"RTN","VBECLU",192,0)
 ;
"RTN","VBECLU",193,0)
ADD(STR) ; -- add string to array
"RTN","VBECLU",194,0)
 SET VBECLINE=VBECLINE+1
"RTN","VBECLU",195,0)
 SET @VBECRSLT@(VBECLINE)=STR
"RTN","VBECLU",196,0)
 QUIT
"RTN","VBECLU0")
0^4^B25504211^B22984698
"RTN","VBECLU0",1,0)
VBECLU0 ;HOIFO/BNT - VBECS Patient Lookup Utility ;
"RTN","VBECLU0",2,0)
 ;;2.0;VBEC;**1**;Jun 05, 2015;Build 13
"RTN","VBECLU0",3,0)
 ;
"RTN","VBECLU0",4,0)
 ; Note: This routine supports data exchange with an FDA registered
"RTN","VBECLU0",5,0)
 ; medical device. As such, it may not be changed in any way without
"RTN","VBECLU0",6,0)
 ; prior written approval from the medical device manufacturer.
"RTN","VBECLU0",7,0)
 ; 
"RTN","VBECLU0",8,0)
 ; Integration Agreements:
"RTN","VBECLU0",9,0)
 ;
"RTN","VBECLU0",10,0)
 SET X="You Can't Enter VBECLU0 at top of routine!"
"RTN","VBECLU0",11,0)
 QUIT
"RTN","VBECLU0",12,0)
 ;
"RTN","VBECLU0",13,0)
BYFILTER(FILTER,FILTERV,BDATE,EDATE,SEARCH,VALUE,DELIM) ; -- search type by clinic, provider, or ward.
"RTN","VBECLU0",14,0)
 NEW PCNT,OKAY,VAL
"RTN","VBECLU0",15,0)
 K ^TMP("PTLKUP",$J)
"RTN","VBECLU0",16,0)
 SET (OKAY,PCNT)=0
"RTN","VBECLU0",17,0)
 ;W:$D(ALAN(1)) !,"In ByFilter"
"RTN","VBECLU0",18,0)
 ;
"RTN","VBECLU0",19,0)
 DO ADD^VBECLU("<record count='0'>")
"RTN","VBECLU0",20,0)
 SET LINENO=VBECLINE
"RTN","VBECLU0",21,0)
 FOR I=1:1 S VAL=$P(FILTERV,DELIM,I) QUIT:VAL=""  DO  Q:$$STOP^XOBVLIB()
"RTN","VBECLU0",22,0)
 . IF FILTER="WARD" DO WARDPTS(VAL) S OKAY=1 Q
"RTN","VBECLU0",23,0)
 . IF FILTER="CLINIC" DO CLINPTS(VAL,BDATE,EDATE) S OKAY=2 Q
"RTN","VBECLU0",24,0)
 . IF FILTER="PROVIDER" D PROVPTS(VAL) S OKAY=3 Q
"RTN","VBECLU0",25,0)
 ;
"RTN","VBECLU0",26,0)
 IF OKAY<1 DO ADD^VBECLU("<error message='Filter not correctly specified'></error>")
"RTN","VBECLU0",27,0)
 ;
"RTN","VBECLU0",28,0)
 ; -- update the record count
"RTN","VBECLU0",29,0)
 DO ADDPTS()
"RTN","VBECLU0",30,0)
 SET @VBECRSLT@(LINENO)="<record count='"_PCNT_"'>"
"RTN","VBECLU0",31,0)
 IF ($G(MAXSIZRE)<1) DO ADD^VBECLU("<maximum message=''></maximum>")
"RTN","VBECLU0",32,0)
 DO ADD^VBECLU("<error message=''></error>")
"RTN","VBECLU0",33,0)
 QUIT
"RTN","VBECLU0",34,0)
 ;
"RTN","VBECLU0",35,0)
FILTCHK(DFN,TYPE,VALUE) ; -- Filter search -
"RTN","VBECLU0",36,0)
 ; -- check patients to match search type and search value for filter searchs
"RTN","VBECLU0",37,0)
 ; -- returns 1 if matchs, 0 if no match
"RTN","VBECLU0",38,0)
 ;
"RTN","VBECLU0",39,0)
 ;W:$D(ALAN(1)) !,"In FilterCheck"
"RTN","VBECLU0",40,0)
 SET VALUE=$$UP^XLFSTR(VALUE)
"RTN","VBECLU0",41,0)
 Q:($G(VALUE)="")!($G(VALUE)="*") 1
"RTN","VBECLU0",42,0)
 Q:($G(TYPE)="") 1
"RTN","VBECLU0",43,0)
 Q:($G(DFN)<1) 0
"RTN","VBECLU0",44,0)
 ;
"RTN","VBECLU0",45,0)
 NEW I,J,OKAY
"RTN","VBECLU0",46,0)
 SET OKAY=0
"RTN","VBECLU0",47,0)
 IF TYPE="NAME" DO
"RTN","VBECLU0",48,0)
 . SET CHKVAL=$P($G(^DPT(DFN,0)),"^",1)
"RTN","VBECLU0",49,0)
 . IF $E(CHKVAL,1,$LENGTH(VALUE))=VALUE SET OKAY=1
"RTN","VBECLU0",50,0)
 IF TYPE="SSN" DO
"RTN","VBECLU0",51,0)
 . SET CHKVAL=$P($G(^DPT(DFN,0)),"^",9)
"RTN","VBECLU0",52,0)
 . IF $E(CHKVAL,1,$LENGTH(VALUE))=VALUE SET OKAY=1
"RTN","VBECLU0",53,0)
 IF TYPE="ICN" DO
"RTN","VBECLU0",54,0)
 . SET CHKVAL=$P($G(^DPT(DFN,"MPI")),"^",1)
"RTN","VBECLU0",55,0)
 . IF $E(CHKVAL,1,$LENGTH(VALUE))=VALUE SET OKAY=1
"RTN","VBECLU0",56,0)
 IF TYPE="SSN4" DO
"RTN","VBECLU0",57,0)
 . SET CHKVAL=$E($P($G(^DPT(DFN,0)),"^",1),1)_$E($P($G(^DPT(DFN,0)),"^",9),6,9)
"RTN","VBECLU0",58,0)
 . IF $E(CHKVAL,1,$LENGTH(VALUE))=VALUE SET OKAY=1
"RTN","VBECLU0",59,0)
 QUIT OKAY
"RTN","VBECLU0",60,0)
 ;
"RTN","VBECLU0",61,0)
WARDPTS(WARD) ; RETURN LIST OF PATIENTS IN A WARD
"RTN","VBECLU0",62,0)
 ; Based on ORQPTQ2
"RTN","VBECLU0",63,0)
 Q:+$G(WARD)<1 
"RTN","VBECLU0",64,0)
 N DFN
"RTN","VBECLU0",65,0)
 S DFN=0
"RTN","VBECLU0",66,0)
 S WARD=$P(^DIC(42,WARD,0),"^")   ;GET WARD NAME FOR "CN"  LOOKUP
"RTN","VBECLU0",67,0)
 Q:WARD=""
"RTN","VBECLU0",68,0)
 F  D  Q:DFN'>0  Q:$$STOP^XOBVLIB()
"RTN","VBECLU0",69,0)
 . S DFN=$O(^DPT("CN",WARD,DFN)) Q:DFN'>0
"RTN","VBECLU0",70,0)
 . Q:'$$FILTCHK(DFN,SEARCH,VALUE)
"RTN","VBECLU0",71,0)
 . S ^TMP("PTLKUP",$J,$P($G(^DPT(DFN,0)),"^",1),DFN)=""
"RTN","VBECLU0",72,0)
 Q
"RTN","VBECLU0",73,0)
 ;
"RTN","VBECLU0",74,0)
PROVPTS(PROV) ;  RETURN LIST OF PATIENTS LINKED TO A PRIMARY PROVIDER
"RTN","VBECLU0",75,0)
 ; Based on ORQPTQ2
"RTN","VBECLU0",76,0)
 ; "APR" xref is on field PROVIDER in file 2 (2;.104)
"RTN","VBECLU0",77,0)
 ; "AAP" xref is on field ATTENDING PHYSICIAN in file 2 (2;.1041)
"RTN","VBECLU0",78,0)
 ; 
"RTN","VBECLU0",79,0)
 Q:+$G(PROV)<1
"RTN","VBECLU0",80,0)
 ;
"RTN","VBECLU0",81,0)
 N DFN,XREF
"RTN","VBECLU0",82,0)
 S DFN=0
"RTN","VBECLU0",83,0)
 F XREF="AAP","APR" DO
"RTN","VBECLU0",84,0)
 . F  S DFN=$O(^DPT(XREF,PROV,DFN)) Q:DFN'>0  D  Q:$$STOP^XOBVLIB()
"RTN","VBECLU0",85,0)
 .. Q:'$$FILTCHK(DFN,SEARCH,VALUE)
"RTN","VBECLU0",86,0)
 .. S ^TMP("PTLKUP",$J,$P($G(^DPT(DFN,0)),"^",1),DFN)=""
"RTN","VBECLU0",87,0)
 Q
"RTN","VBECLU0",88,0)
 ;
"RTN","VBECLU0",89,0)
CLINPTS(CLIN,BDATE,EDATE) ; RETURN LIST OF PTS W/CLINIC APPT W/IN BEGINNING AND END DATES
"RTN","VBECLU0",90,0)
 Q:+$G(CLIN)<1
"RTN","VBECLU0",91,0)
 ;
"RTN","VBECLU0",92,0)
 N DFN,NAME,I,J,X,ORJ,ORSRV,ORNOWDT,CHKX,CHKIN,MAXAPPTS,ORC,CLNAM
"RTN","VBECLU0",93,0)
 S MAXAPPTS=200
"RTN","VBECLU0",94,0)
 S NOWDT=$$NOW^XLFDT
"RTN","VBECLU0",95,0)
 ;
"RTN","VBECLU0",96,0)
 S DFN=0,I=1
"RTN","VBECLU0",97,0)
 IF $G(BDATE)="" S BDATE="T"
"RTN","VBECLU0",98,0)
 IF $G(EDATE)="" S EDATE="T+1"
"RTN","VBECLU0",99,0)
 ;CONVERT BDATE AND EDATE INTO FILEMAN DATE/TIME
"RTN","VBECLU0",100,0)
 D DT^DILF("T",BDATE,.BDATE,"","")
"RTN","VBECLU0",101,0)
 D DT^DILF("T",EDATE,.EDATE,"","")
"RTN","VBECLU0",102,0)
 I (BDATE=-1)!(EDATE=-1) S Y(1)="^Error in date range." Q
"RTN","VBECLU0",103,0)
 S EDATE=$P(EDATE,".")_.5  ;ADD 1/2 DAY TO END DATE
"RTN","VBECLU0",104,0)
 ;
"RTN","VBECLU0",105,0)
 D CLINPT2(+CLIN,BDATE,EDATE)
"RTN","VBECLU0",106,0)
 QUIT
"RTN","VBECLU0",107,0)
 ;
"RTN","VBECLU0",108,0)
CLINPT2(CLIN,BEGIN,END) ; -- Use scheduling rehosting API from patches SD*5.3*253 and SD*5.3*275
"RTN","VBECLU0",109,0)
 ; -- GETPLIST^SDAMA202(SDIEN,SDFIELDS,SDAPSTAT,SDSTART,SDEND,.SDRESULT,SDIOSTAT)
"RTN","VBECLU0",110,0)
 ;
"RTN","VBECLU0",111,0)
 K ^TMP($J,"SDAMA202","GETPLIST")
"RTN","VBECLU0",112,0)
 NEW I,X,APPTS SET APPTS=""
"RTN","VBECLU0",113,0)
 ;
"RTN","VBECLU0",114,0)
 ; -- get appointment date/time, patient status, patient ien & name,
"RTN","VBECLU0",115,0)
 ;    only get appointment status = "R" for scheduled or kept appointments.
"RTN","VBECLU0",116,0)
 DO GETPLIST^SDAMA202(+CLIN,"1;3;4","R",BEGIN,END,.APPTS)
"RTN","VBECLU0",117,0)
 ;
"RTN","VBECLU0",118,0)
 ; -- check number of appointments
"RTN","VBECLU0",119,0)
 Q:APPTS<1
"RTN","VBECLU0",120,0)
 ;
"RTN","VBECLU0",121,0)
 ; -- check for an error, may need to pass message up.
"RTN","VBECLU0",122,0)
 I $D(^TMP($J,"SDAMA202","GETPTLIST","ERROR")) QUIT
"RTN","VBECLU0",123,0)
 ;
"RTN","VBECLU0",124,0)
 ; -- move list of appointments to list of patients, ordered by name, dfn
"RTN","VBECLU0",125,0)
 S (I,X)=""
"RTN","VBECLU0",126,0)
 F  SET I=$O(^TMP($J,"SDAMA202","GETPLIST",I)) Q:I<1  S X=^(I,4) DO
"RTN","VBECLU0",127,0)
 .  Q:'$$FILTCHK(+X,SEARCH,VALUE)  ;check if meets search criteria
"RTN","VBECLU0",128,0)
 .  S ^TMP("PTLKUP",$J,$P(X,"^",2),+X)=""
"RTN","VBECLU0",129,0)
 QUIT
"RTN","VBECLU0",130,0)
 ;
"RTN","VBECLU0",131,0)
ADDPTS() ;
"RTN","VBECLU0",132,0)
 N NAME,DFN
"RTN","VBECLU0",133,0)
 S NAME=""
"RTN","VBECLU0",134,0)
 FOR  SET NAME=$O(^TMP("PTLKUP",$J,NAME)) Q:NAME=""  DO
"RTN","VBECLU0",135,0)
 . S DFN=""  FOR  SET DFN=$O(^TMP("PTLKUP",$J,NAME,DFN)) Q:DFN<1  DO
"RTN","VBECLU0",136,0)
 .. DO PTDATA^VBECLU(DFN,.PCNT)
"RTN","VBECLU0",137,0)
 ;IF ($G(MAXSIZRE)<1) DO ADD^VBECLU("<maximum message=''></maximum>")
"RTN","VBECLU0",138,0)
 Q
"RTN","VBECLU0",139,0)
 ;
"RTN","VBECLU0",140,0)
NAMECOMP(DFN) ; ENTRY IS +$P($G(^DPT(DFN,"NAME")),"^",1)  
"RTN","VBECLU0",141,0)
 N A,LN,FN,MI,PR,SU,DE
"RTN","VBECLU0",142,0)
 S A=$G(^VA(20,+$P($G(^DPT(DFN,"NAME")),"^",1),1))
"RTN","VBECLU0",143,0)
 S LN=$$CHARCHK^XOBVLIB($P(A,"^",1))
"RTN","VBECLU0",144,0)
 S FN=$$CHARCHK^XOBVLIB($P(A,"^",2))
"RTN","VBECLU0",145,0)
 S MI=$$CHARCHK^XOBVLIB($P(A,"^",3))
"RTN","VBECLU0",146,0)
 S PR=$$CHARCHK^XOBVLIB($P(A,"^",4))
"RTN","VBECLU0",147,0)
 S SU=$$CHARCHK^XOBVLIB($P(A,"^",5))
"RTN","VBECLU0",148,0)
 S DE=$$CHARCHK^XOBVLIB($P(A,"^",6))
"RTN","VBECLU0",149,0)
 DO ADD^VBECLU("<CmpntLastName>"_LN_"</CmpntLastName><CmpntFirstName>"_FN_"</CmpntFirstName><CmpntMiddleName>"_MI_"</CmpntMiddleName><CmpntPrefx>"_PR_"</CmpntPrefx><PatientNameSuffix>"_SU_"</PatientNameSuffix><CmpntDgr>"_DE_"</CmpntDgr>")
"RTN","VBECLU0",150,0)
 ;
"RTN","VBECRPCM")
0^1^B41336097^B41078175
"RTN","VBECRPCM",1,0)
VBECRPCM ;HOIFO/BNT - MAINTENANCE USE CASE RPCs ; JULY 19, 2017@14:43
"RTN","VBECRPCM",2,0)
 ;;2.0;VBEC;**1**;Jun 05, 2015;Build 13
"RTN","VBECRPCM",3,0)
 ;
"RTN","VBECRPCM",4,0)
 ; Note: This routine supports data exchange with an FDA registered
"RTN","VBECRPCM",5,0)
 ; medical device. As such, it may not be changed in any way without
"RTN","VBECRPCM",6,0)
 ; prior written approval from the medical device manufacturer.
"RTN","VBECRPCM",7,0)
 ; 
"RTN","VBECRPCM",8,0)
 ; Integration Agreements:
"RTN","VBECRPCM",9,0)
 ; Reference DBIA 2343  - $$ACTIVE^XUSER
"RTN","VBECRPCM",10,0)
 ; Reference DBIA 10060 - NEW PERSON FILE
"RTN","VBECRPCM",11,0)
 ; Reference DBIA 4090  - $$CHARCHK^XOBVLIB
"RTN","VBECRPCM",12,0)
 ; Reference DBIA 10076 - XUSEC GLOBAL READ
"RTN","VBECRPCM",13,0)
 ; Reference DBIA 10090 - INSTITUTION FILE FILEMAN READ
"RTN","VBECRPCM",14,0)
 ; Reference DBIA 2817  - MEDICAL CENTER DIVISION FILE "AD" X-REF
"RTN","VBECRPCM",15,0)
 ; Reference DBIA 1963  - ACCESSION FILE GLOBAL READ
"RTN","VBECRPCM",16,0)
 ; Reference to GETS^DIQ() supported by IA #2056
"RTN","VBECRPCM",17,0)
 ; Reference to LIST^DIC supported by DBIA #2051
"RTN","VBECRPCM",18,0)
 ; Call to ^VA(200 is supported by IA: 10060
"RTN","VBECRPCM",19,0)
 ; Call to GETS^DIQ is supported by IA: 2056
"RTN","VBECRPCM",20,0)
 ; Reference to ^DIC(4 supported by IA #10090
"RTN","VBECRPCM",21,0)
 ; Reference to ^DG(40.8 supported by IA #2817
"RTN","VBECRPCM",22,0)
 ; Reference to ^LRO(68 supported by IA #1963
"RTN","VBECRPCM",23,0)
 ; 
"RTN","VBECRPCM",24,0)
 ;
"RTN","VBECRPCM",25,0)
 QUIT
"RTN","VBECRPCM",26,0)
 ;
"RTN","VBECRPCM",27,0)
 ; ---------------------------------------------------------------
"RTN","VBECRPCM",28,0)
 ;      Private Method supports IA 4608
"RTN","VBECRPCM",29,0)
 ; ---------------------------------------------------------------
"RTN","VBECRPCM",30,0)
BBUSER(RESULTS) ; Look up and return all BB users
"RTN","VBECRPCM",31,0)
 ;
"RTN","VBECRPCM",32,0)
 ;
"RTN","VBECRPCM",33,0)
 ; Input: RESULTS = Passed by reference used to return data to VistALink
"RTN","VBECRPCM",34,0)
 ;                  as XML.
"RTN","VBECRPCM",35,0)
 ;
"RTN","VBECRPCM",36,0)
 ; Screen Logic:  Only returns users from file 200 that hold either the
"RTN","VBECRPCM",37,0)
 ;                LRBLOODBANK or LRBLSUPER Security Key and do not have a
"RTN","VBECRPCM",38,0)
 ;                TERMINATION DATE prior to the current date.
"RTN","VBECRPCM",39,0)
 ;
"RTN","VBECRPCM",40,0)
 ;S VBECCNT=0
"RTN","VBECRPCM",41,0)
 ;S RESULTS=$NA(^TMP("VBECS_USER",$J))
"RTN","VBECRPCM",42,0)
 ;K @RESULTS
"RTN","VBECRPCM",43,0)
 ;D BEGROOT^VBECRPC("BloodBankUsers")
"RTN","VBECRPCM",44,0)
 ;
"RTN","VBECRPCM",45,0)
 ;D USRSRCH
"RTN","VBECRPCM",46,0)
 ;
"RTN","VBECRPCM",47,0)
 ;D ENDROOT^VBECRPC("BloodBankUsers")
"RTN","VBECRPCM",48,0)
 N VBIEN,VBXUSEC,CNT,VBXU,VBU
"RTN","VBECRPCM",49,0)
 S RESULTS=$NA(^TMP("BBUSERS",$J)),VBECCNT=0
"RTN","VBECRPCM",50,0)
 K @RESULTS
"RTN","VBECRPCM",51,0)
 D BEGROOT^VBECRPC("BloodBankUsers")
"RTN","VBECRPCM",52,0)
 D ADD^VBECRPC("<Record count='0' >")
"RTN","VBECRPCM",53,0)
 F VBXUSEC="LRBLOODBANK","LRBLSUPER" S VBXU=0 F  S VBXU=$O(^XUSEC(VBXUSEC,VBXU)) Q:VBXU=""  D
"RTN","VBECRPCM",54,0)
 . Q:'+$$ACTIVE^XUSER(VBXU)
"RTN","VBECRPCM",55,0)
 . S VBU(VBXU)=""
"RTN","VBECRPCM",56,0)
 . Q
"RTN","VBECRPCM",57,0)
 S (CNT,VBIEN)=0
"RTN","VBECRPCM",58,0)
 F  S VBIEN=$O(VBU(VBIEN)) Q:VBIEN=""  D
"RTN","VBECRPCM",59,0)
 . S CNT=CNT+1
"RTN","VBECRPCM",60,0)
 . D BEGROOT^VBECRPC("BloodBankUser")
"RTN","VBECRPCM",61,0)
 . D ADD^VBECRPC("<UserName>"_$$CHARCHK^XOBVLIB($P(^VA(200,VBIEN,0),"^",1))_"</UserName>")
"RTN","VBECRPCM",62,0)
 . D ADD^VBECRPC("<UserDUZ>"_$$CHARCHK^XOBVLIB(VBIEN)_"</UserDUZ>")
"RTN","VBECRPCM",63,0)
 . D ADD^VBECRPC("<UserInitials>"_$$CHARCHK^XOBVLIB($P(^VA(200,VBIEN,0),"^",2))_"</UserInitials>")
"RTN","VBECRPCM",64,0)
 . D BBUSRDIV(VBIEN)
"RTN","VBECRPCM",65,0)
 . D ENDROOT^VBECRPC("BloodBankUser")
"RTN","VBECRPCM",66,0)
 S @RESULTS@(2)="<Record count='"_CNT_"' >"
"RTN","VBECRPCM",67,0)
 D ENDROOT^VBECRPC("Record")
"RTN","VBECRPCM",68,0)
 D ENDROOT^VBECRPC("BloodBankUsers")
"RTN","VBECRPCM",69,0)
 K VBECCNT
"RTN","VBECRPCM",70,0)
 Q
"RTN","VBECRPCM",71,0)
 ;
"RTN","VBECRPCM",72,0)
USRSRCH ; Search for valid Blood Bank users
"RTN","VBECRPCM",73,0)
 ;
"RTN","VBECRPCM",74,0)
 N DD,DIVSUB,VBUSRDUZ,VBUSRNME,VBUSRINI,IENS,BBUSRDIV,DIVERR
"RTN","VBECRPCM",75,0)
 S DD=200,DIVSUB="200.02"
"RTN","VBECRPCM",76,0)
 S SCREEN="I $$USRSCR^VBECRPCM(+Y)"
"RTN","VBECRPCM",77,0)
 D LIST^DIC(DD,"","@;.01;1","P","","","","",.SCREEN,"","","ERR")
"RTN","VBECRPCM",78,0)
 ;
"RTN","VBECRPCM",79,0)
 D ADD^VBECRPC("<Record count='"_$$CHARCHK^XOBVLIB(+$P(^TMP("DILIST",$J,0),U))_"' >")
"RTN","VBECRPCM",80,0)
 S X=0
"RTN","VBECRPCM",81,0)
 F  S X=$O(^TMP("DILIST",$J,X)) Q:X=""  D
"RTN","VBECRPCM",82,0)
 . D BEGROOT^VBECRPC("BloodBankUser")
"RTN","VBECRPCM",83,0)
 . ; User Name
"RTN","VBECRPCM",84,0)
 . S VBUSRNME=$P(^TMP("DILIST",$J,X,0),U,2)
"RTN","VBECRPCM",85,0)
 . ; User DUZ
"RTN","VBECRPCM",86,0)
 . S VBUSRDUZ=+$P(^TMP("DILIST",$J,X,0),U)
"RTN","VBECRPCM",87,0)
 . ; User Initials
"RTN","VBECRPCM",88,0)
 . S VBUSRINI=$P(^TMP("DILIST",$J,X,0),U,3)
"RTN","VBECRPCM",89,0)
 . ;
"RTN","VBECRPCM",90,0)
 . D ADD^VBECRPC("<UserName>"_$$CHARCHK^XOBVLIB(VBUSRNME)_"</UserName>")
"RTN","VBECRPCM",91,0)
 . D ADD^VBECRPC("<UserDUZ>"_$$CHARCHK^XOBVLIB(VBUSRDUZ)_"</UserDUZ>")
"RTN","VBECRPCM",92,0)
 . D ADD^VBECRPC("<UserInitials>"_$$CHARCHK^XOBVLIB(VBUSRINI)_"</UserInitials>")
"RTN","VBECRPCM",93,0)
 . ;
"RTN","VBECRPCM",94,0)
 . ; Get all Divisions for this user.
"RTN","VBECRPCM",95,0)
 . D BBUSRDIV(VBUSRDUZ)
"RTN","VBECRPCM",96,0)
 . ;
"RTN","VBECRPCM",97,0)
 . D ENDROOT^VBECRPC("BloodBankUser")
"RTN","VBECRPCM",98,0)
 . Q
"RTN","VBECRPCM",99,0)
 D ENDROOT^VBECRPC("Record")
"RTN","VBECRPCM",100,0)
 Q
"RTN","VBECRPCM",101,0)
 ;
"RTN","VBECRPCM",102,0)
BBUSRDIV(VBDUZ) ; Gets the divisions for the user and creates the XML
"RTN","VBECRPCM",103,0)
 ;
"RTN","VBECRPCM",104,0)
 N X,DIV,DIVIEN,OUT
"RTN","VBECRPCM",105,0)
 ; Must be active user
"RTN","VBECRPCM",106,0)
 S X=$$DIV4^XUSER(.DIV,VBDUZ)
"RTN","VBECRPCM",107,0)
 Q:'X
"RTN","VBECRPCM",108,0)
 D BEGROOT^VBECRPC("Divisions")
"RTN","VBECRPCM",109,0)
 S DIV=0
"RTN","VBECRPCM",110,0)
 F  S DIV=$O(DIV(DIV)) Q:DIV=""  D
"RTN","VBECRPCM",111,0)
 . D GETDIV(.OUT,DIV)
"RTN","VBECRPCM",112,0)
 . I '+$P(OUT,U) S ERR=$P(OUT,U,2) D ERROR(ERR) Q
"RTN","VBECRPCM",113,0)
 . Q:'$D(OUT)
"RTN","VBECRPCM",114,0)
 . S DIVIEN=DIV_","
"RTN","VBECRPCM",115,0)
 . ; Check if division is active
"RTN","VBECRPCM",116,0)
 . I $G(OUT(4,DIVIEN,101))=1 Q
"RTN","VBECRPCM",117,0)
 . ;
"RTN","VBECRPCM",118,0)
 . ;D BEGROOT^VBECRPC("Division")
"RTN","VBECRPCM",119,0)
 . ;D ADD^VBECRPC("<DivisionName>"_$$CHARCHK^XOBVLIB(OUT(4,DIVIEN,.01))_"</DivisionName>")
"RTN","VBECRPCM",120,0)
 . D ADD^VBECRPC("<Division divisionCode="""_$$CHARCHK^XOBVLIB(OUT(4,DIVIEN,99))_""" />")
"RTN","VBECRPCM",121,0)
 . ;D ENDROOT^VBECRPC("Division")
"RTN","VBECRPCM",122,0)
 . Q
"RTN","VBECRPCM",123,0)
 D ENDROOT^VBECRPC("Divisions")
"RTN","VBECRPCM",124,0)
 Q
"RTN","VBECRPCM",125,0)
 ;
"RTN","VBECRPCM",126,0)
USRSCR(IEN) ; Screens for valid Blood Bank Users
"RTN","VBECRPCM",127,0)
 Q:(IEN']"")!(IEN<0) 0
"RTN","VBECRPCM",128,0)
 Q:('$D(^XUSEC("LRBLOODBANK",IEN)))&('$D(^XUSEC("LRBLSUPER",IEN))) 0
"RTN","VBECRPCM",129,0)
 Q +$$ACTIVE^XUSER(IEN)
"RTN","VBECRPCM",130,0)
 ;
"RTN","VBECRPCM",131,0)
 ; ---------------------------------------------------------------
"RTN","VBECRPCM",132,0)
 ;      Private Method supports IA 4609
"RTN","VBECRPCM",133,0)
 ; ---------------------------------------------------------------
"RTN","VBECRPCM",134,0)
DIV(RESULTS) ; Lookup and return all Divisions associated with a medical center
"RTN","VBECRPCM",135,0)
 ;
"RTN","VBECRPCM",136,0)
 N DD,OUT,ERR,DIV,DIVIEN
"RTN","VBECRPCM",137,0)
 S VBECCNT=0
"RTN","VBECRPCM",138,0)
 S RESULTS=$NA(^TMP("VBECS_DIVISIONS",$J))
"RTN","VBECRPCM",139,0)
 K @RESULTS
"RTN","VBECRPCM",140,0)
 D BEGROOT^VBECRPC("Divisions")
"RTN","VBECRPCM",141,0)
 ;
"RTN","VBECRPCM",142,0)
 S DIV=0
"RTN","VBECRPCM",143,0)
 F  S DIV=$O(^DG(40.8,"AD",DIV)) Q:DIV=""  D  Q:$D(ERR)
"RTN","VBECRPCM",144,0)
 . D GETDIV(.OUT,DIV)
"RTN","VBECRPCM",145,0)
 . I '+$P(OUT,U) S ERR=$P(OUT,U,2) D ERROR(ERR) Q
"RTN","VBECRPCM",146,0)
 . Q:'$D(OUT)
"RTN","VBECRPCM",147,0)
 . S DIVIEN=DIV_","
"RTN","VBECRPCM",148,0)
 . ; See DR - 1670 / VistA MR 006
"RTN","VBECRPCM",149,0)
 . ; Removed check if division is a medical center
"RTN","VBECRPCM",150,0)
 . ; Added screen for station numbers greater than 5
"RTN","VBECRPCM",151,0)
 . ;I $L(OUT(4,DIVIEN,99))>5 Q  ;RLM 050817
"RTN","VBECRPCM",152,0)
 . I $G(OUT(4,DIVIEN,99))="" Q
"RTN","VBECRPCM",153,0)
 . ; Check if division is active
"RTN","VBECRPCM",154,0)
 . I $G(OUT(4,DIVIEN,101))="INACTIVE" Q
"RTN","VBECRPCM",155,0)
 . D BEGROOT^VBECRPC("Division")
"RTN","VBECRPCM",156,0)
 . D ADD^VBECRPC("<DivisionCode>"_$$CHARCHK^XOBVLIB(OUT(4,DIVIEN,99))_"</DivisionCode>")
"RTN","VBECRPCM",157,0)
 . D ADD^VBECRPC("<DivisionName>"_$$CHARCHK^XOBVLIB(OUT(4,DIVIEN,.01))_"</DivisionName>")
"RTN","VBECRPCM",158,0)
 . D ENDROOT^VBECRPC("Division")
"RTN","VBECRPCM",159,0)
 D ENDROOT^VBECRPC("Divisions")
"RTN","VBECRPCM",160,0)
 ;
"RTN","VBECRPCM",161,0)
 K VBECCNT
"RTN","VBECRPCM",162,0)
 Q
"RTN","VBECRPCM",163,0)
 ;
"RTN","VBECRPCM",164,0)
GETDIV(OUT,INST) ;
"RTN","VBECRPCM",165,0)
 ; Returns data associated with a Division represented by the
"RTN","VBECRPCM",166,0)
 ; Institution pointer
"RTN","VBECRPCM",167,0)
 ;
"RTN","VBECRPCM",168,0)
 ; Input:    OUT  = Passed by reference used to return array
"RTN","VBECRPCM",169,0)
 ;           INST = Pointer to Institution file
"RTN","VBECRPCM",170,0)
 ;
"RTN","VBECRPCM",171,0)
 ; Returns:  Output from LIST^DIC in the OUT array containing data from
"RTN","VBECRPCM",172,0)
 ;           fields .01, 99 and 101
"RTN","VBECRPCM",173,0)
 ;
"RTN","VBECRPCM",174,0)
 N ERR
"RTN","VBECRPCM",175,0)
 S OUT="1^"
"RTN","VBECRPCM",176,0)
 I INST']"" S OUT="0^Pointer to Institutuion file not found"
"RTN","VBECRPCM",177,0)
 I INST'["," S INST=INST_","
"RTN","VBECRPCM",178,0)
 D GETS^DIQ(4,INST,".01;99;101",,"OUT","ERR")
"RTN","VBECRPCM",179,0)
 I $D(ERR) S OUT="0^"_ERR("DIERR",1,"TEXT",1)
"RTN","VBECRPCM",180,0)
 Q
"RTN","VBECRPCM",181,0)
 ;
"RTN","VBECRPCM",182,0)
 ; ---------------------------------------------------------------
"RTN","VBECRPCM",183,0)
 ;      Private Method Supports IA 4607
"RTN","VBECRPCM",184,0)
 ; ---------------------------------------------------------------
"RTN","VBECRPCM",185,0)
ACNAREA(RESULTS) ; Gets the Blood Bank Accession Areas from the Accession file
"RTN","VBECRPCM",186,0)
 ; Supporst MUC_02 Configure Division
"RTN","VBECRPCM",187,0)
 ;
"RTN","VBECRPCM",188,0)
 N X,VBECARY
"RTN","VBECRPCM",189,0)
 S (VBECCNT,X)=0
"RTN","VBECRPCM",190,0)
 S RESULTS=$NA(^TMP("VBECS_ACCESSION_AREAS",$J))
"RTN","VBECRPCM",191,0)
 K @RESULTS
"RTN","VBECRPCM",192,0)
 D BEGROOT^VBECRPC("AccessionAreas")
"RTN","VBECRPCM",193,0)
 F  S X=$O(^LRO(68,X)) Q:X'?1N.N  D
"RTN","VBECRPCM",194,0)
 . Q:$P(^LRO(68,X,0),"^",2)'="BB" 
"RTN","VBECRPCM",195,0)
 . S VBECARY(X)=$P(^LRO(68,X,0),"^")
"RTN","VBECRPCM",196,0)
 . D BEGROOT^VBECRPC("AccessionArea")
"RTN","VBECRPCM",197,0)
 . D ADD^VBECRPC("<AccessionAreaName>"_$$CHARCHK^XOBVLIB($P(^LRO(68,X,0),"^"))_"</AccessionAreaName>")
"RTN","VBECRPCM",198,0)
 . D ADD^VBECRPC("<AccessionAreaId>"_$$CHARCHK^XOBVLIB(X)_"</AccessionAreaId>")
"RTN","VBECRPCM",199,0)
 . D ENDROOT^VBECRPC("AccessionArea")
"RTN","VBECRPCM",200,0)
 D ENDROOT^VBECRPC("AccessionAreas")
"RTN","VBECRPCM",201,0)
 ;
"RTN","VBECRPCM",202,0)
 K VBECCNT
"RTN","VBECRPCM",203,0)
 Q
"RTN","VBECRPCM",204,0)
 ;       
"RTN","VBECRPCM",205,0)
ERROR(TEXT) ;
"RTN","VBECRPCM",206,0)
 D ERROR^VBECRPC(TEXT)
"RTN","VBECRPCM",207,0)
 Q
"VER")
8.0^22.2
"BLD",7648,6)
^2
**END**
**END**

