EMERGENCY Released PSN*4*471 SEQ #464
Extracted from mail message
**KIDS**:PSN*4.0*471^

**INSTALL NAME**
PSN*4.0*471
"BLD",10104,0)
PSN*4.0*471^NATIONAL DRUG FILE^0^3160222^y
"BLD",10104,1,0)
^^5^5^3160222^
"BLD",10104,1,1,0)
Patch PSN*4.0*471 addresses the following issue:
"BLD",10104,1,2,0)
 
"BLD",10104,1,3,0)
1. I7357301FY16 - Alfuzosin patient allergies with a Trade Name in the
"BLD",10104,1,4,0)
Reactant field need to be updated to remove VA Drug Class
"BLD",10104,1,5,0)
HORMONES/SYNTHETICS/MODIFIERS,OTHER (HS900)
"BLD",10104,4,0)
^9.64PA^^
"BLD",10104,6)
^301
"BLD",10104,6.3)
17
"BLD",10104,"INID")
^n
"BLD",10104,"INIT")
EN^PSN471P
"BLD",10104,"KRN",0)
^9.67PA^779.2^20
"BLD",10104,"KRN",.4,0)
.4
"BLD",10104,"KRN",.401,0)
.401
"BLD",10104,"KRN",.402,0)
.402
"BLD",10104,"KRN",.403,0)
.403
"BLD",10104,"KRN",.5,0)
.5
"BLD",10104,"KRN",.84,0)
.84
"BLD",10104,"KRN",3.6,0)
3.6
"BLD",10104,"KRN",3.8,0)
3.8
"BLD",10104,"KRN",9.2,0)
9.2
"BLD",10104,"KRN",9.8,0)
9.8
"BLD",10104,"KRN",9.8,"NM",0)
^9.68A^2^1
"BLD",10104,"KRN",9.8,"NM",2,0)
PSN471P^^0^B9656141
"BLD",10104,"KRN",9.8,"NM","B","PSN471P",2)

"BLD",10104,"KRN",19,0)
19
"BLD",10104,"KRN",19.1,0)
19.1
"BLD",10104,"KRN",101,0)
101
"BLD",10104,"KRN",409.61,0)
409.61
"BLD",10104,"KRN",771,0)
771
"BLD",10104,"KRN",779.2,0)
779.2
"BLD",10104,"KRN",870,0)
870
"BLD",10104,"KRN",8989.51,0)
8989.51
"BLD",10104,"KRN",8989.52,0)
8989.52
"BLD",10104,"KRN",8994,0)
8994
"BLD",10104,"KRN","B",.4,.4)

"BLD",10104,"KRN","B",.401,.401)

"BLD",10104,"KRN","B",.402,.402)

"BLD",10104,"KRN","B",.403,.403)

"BLD",10104,"KRN","B",.5,.5)

"BLD",10104,"KRN","B",.84,.84)

"BLD",10104,"KRN","B",3.6,3.6)

"BLD",10104,"KRN","B",3.8,3.8)

"BLD",10104,"KRN","B",9.2,9.2)

"BLD",10104,"KRN","B",9.8,9.8)

"BLD",10104,"KRN","B",19,19)

"BLD",10104,"KRN","B",19.1,19.1)

"BLD",10104,"KRN","B",101,101)

"BLD",10104,"KRN","B",409.61,409.61)

"BLD",10104,"KRN","B",771,771)

"BLD",10104,"KRN","B",779.2,779.2)

"BLD",10104,"KRN","B",870,870)

"BLD",10104,"KRN","B",8989.51,8989.51)

"BLD",10104,"KRN","B",8989.52,8989.52)

"BLD",10104,"KRN","B",8994,8994)

"BLD",10104,"PRE")

"BLD",10104,"QDEF")
^^^^NO^^^^NO^^NO
"BLD",10104,"QUES",0)
^9.62^^
"BLD",10104,"REQB",0)
^9.611^1^1
"BLD",10104,"REQB",1,0)
PSN*4.0*469^2
"BLD",10104,"REQB","B","PSN*4.0*469",1)

"INIT")
EN^PSN471P
"MBREQ")
0
"PKG",479,-1)
1^1
"PKG",479,0)
NATIONAL DRUG FILE^PSN^This is the National Drug File Package V 3.16
"PKG",479,20,0)
^9.402P^^
"PKG",479,22,0)
^9.49I^1^1
"PKG",479,22,1,0)
4.0
"PKG",479,22,1,"PAH",1,0)
471^3160222
"PKG",479,22,1,"PAH",1,1,0)
^^5^5^3160222
"PKG",479,22,1,"PAH",1,1,1,0)
Patch PSN*4.0*471 addresses the following issue:
"PKG",479,22,1,"PAH",1,1,2,0)
 
"PKG",479,22,1,"PAH",1,1,3,0)
1. I7357301FY16 - Alfuzosin patient allergies with a Trade Name in the
"PKG",479,22,1,"PAH",1,1,4,0)
Reactant field need to be updated to remove VA Drug Class
"PKG",479,22,1,"PAH",1,1,5,0)
HORMONES/SYNTHETICS/MODIFIERS,OTHER (HS900)
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","PSN471P")
0^2^B9656141^n/a
"RTN","PSN471P",1,0)
PSN471P ;BIR/HW-Post install routine to update Trade Name allergies - Class; 29 January 2016  3:18 PM
"RTN","PSN471P",2,0)
 ;;4.0;NATIONAL DRUG FILE;**471**; 30 Oct 98;Build 17
"RTN","PSN471P",3,0)
 ;Reference to UPDATE^GMRAUTL2 supported by DBIA #4667
"RTN","PSN471P",4,0)
 ;This routine will update patient allergies with a Trade Name in the Reactant field 
"RTN","PSN471P",5,0)
 ;based on the VA Generic and VA Drug Class(es) provided 
"RTN","PSN471P",6,0)
 Q
"RTN","PSN471P",7,0)
EN ;Call at entry point
"RTN","PSN471P",8,0)
 N PSNPRIEN,PSNTNCNT,PSNGIEN,PSNCLASS,PSNX,PSNDONTK,PSNVAPRD,MSG,PSNTRNAM,PSNDCIEN,XPDIDTOT
"RTN","PSN471P",9,0)
 S XPDIDTOT=3
"RTN","PSN471P",10,0)
 K ^TMP("PSNMSG",$J),^TMP("PSN471P",$J)
"RTN","PSN471P",11,0)
 S ^TMP("PSNMSG",$J,1,0)="Number of Patient Allergy entries by VA DRUG CLASS:"
"RTN","PSN471P",12,0)
 S ^TMP("PSNMSG",$J,2,0)=" "
"RTN","PSN471P",13,0)
 S ^TMP("PSNMSG",$J,3,0)="Before update:"
"RTN","PSN471P",14,0)
 S ^TMP("PSNMSG",$J,4,0)="HS900 - HORMONES/SYNTHETICS/MODIFIERS,OTHER:           "_$$CNT("HS900")
"RTN","PSN471P",15,0)
 S ^TMP("PSNMSG",$J,5,0)="CV150 - ALPHA BLOCKERS/RELATED:                        "_$$CNT("CV150")
"RTN","PSN471P",16,0)
 S ^TMP("PSNMSG",$J,6,0)=" "
"RTN","PSN471P",17,0)
 S PSNTNCNT=0
"RTN","PSN471P",18,0)
 S PSNVAGEN=3889,PSNOCL=138,PSNNCL=297 D UPDATE(PSNVAGEN,PSNOCL,PSNNCL,.PSNTNCNT) ;ALFUZOSIN (138 is HS900, 297 is CV150)
"RTN","PSN471P",19,0)
 ;
"RTN","PSN471P",20,0)
 K ^TMP("PSN471P",$J)
"RTN","PSN471P",21,0)
 ;
"RTN","PSN471P",22,0)
 S ^TMP("PSNMSG",$J,9,0)=" "
"RTN","PSN471P",23,0)
 S ^TMP("PSNMSG",$J,10,0)=" "
"RTN","PSN471P",24,0)
 S ^TMP("PSNMSG",$J,11,0)="After update:"
"RTN","PSN471P",25,0)
 S ^TMP("PSNMSG",$J,12,0)="HS900 - HORMONES/SYNTHETICS/MODIFIERS,OTHER:           "_$$CNT("HS900")
"RTN","PSN471P",26,0)
 S ^TMP("PSNMSG",$J,13,0)="CV150 - ALPHA BLOCKERS/RELATED:                        "_$$CNT("CV150")
"RTN","PSN471P",27,0)
 S ^TMP("PSNMSG",$J,14,0)=" "
"RTN","PSN471P",28,0)
 ; 
"RTN","PSN471P",29,0)
 K PSNVAGEN,PSNOCL,PSNNCL
"RTN","PSN471P",30,0)
 Q
"RTN","PSN471P",31,0)
 ;
"RTN","PSN471P",32,0)
CNT(PSNCLASS) ;Count the number of Patient Allergy entries for a specific class
"RTN","PSN471P",33,0)
 N PSNA,PSNB,PSNC,PSNCNT
"RTN","PSN471P",34,0)
 S (PSNA,PSNB,PSNC,PSNCNT)=0
"RTN","PSN471P",35,0)
 F  S PSNA=$O(^GMR(120.8,"APC",PSNA)) Q:'PSNA  D
"RTN","PSN471P",36,0)
 .F  S PSNB=$O(^GMR(120.8,"APC",PSNA,PSNCLASS,PSNB)) Q:'PSNB  D
"RTN","PSN471P",37,0)
 ..F  S PSNC=$O(^GMR(120.8,"APC",PSNA,PSNCLASS,PSNB,PSNC)) Q:'PSNC  D
"RTN","PSN471P",38,0)
 ...S PSNCNT=PSNCNT+1
"RTN","PSN471P",39,0)
 Q PSNCNT
"RTN","PSN471P",40,0)
UPDATE(PSNVAGEN,PSNOCL,PSNNCL,PSNTNCNT) ;Find Trade Names and update Allergies 
"RTN","PSN471P",41,0)
 N PSNCLA
"RTN","PSN471P",42,0)
 S PSNCLA("D",PSNOCL)="" ;IEN of class to be deleted
"RTN","PSN471P",43,0)
 S PSNCLA("A",PSNNCL)="" ;IEN of class to be added
"RTN","PSN471P",44,0)
 S PSNPRIEN=0
"RTN","PSN471P",45,0)
 F  S PSNPRIEN=$O(^PSNDF(50.68,PSNPRIEN)) Q:'PSNPRIEN  D
"RTN","PSN471P",46,0)
 .I +$P($G(^PSNDF(50.68,PSNPRIEN,0)),"^",2)'=PSNVAGEN Q 
"RTN","PSN471P",47,0)
 .I +$G(^PSNDF(50.68,PSNPRIEN,3))'=PSNNCL Q 
"RTN","PSN471P",48,0)
 .S PSNGIEN=$P(^PSNDF(50.68,PSNPRIEN,0),"^",2)
"RTN","PSN471P",49,0)
 .S PSNDCIEN=0
"RTN","PSN471P",50,0)
 .F  S PSNDCIEN=$O(^PSNDF(50.68,"ANDC",PSNPRIEN,PSNDCIEN)) Q:'PSNDCIEN  D 
"RTN","PSN471P",51,0)
 ..S PSNTRNAM=$P($G(^PSNDF(50.67,PSNDCIEN,0)),"^",5)
"RTN","PSN471P",52,0)
 ..I $D(^TMP("PSN471P",$J,PSNGIEN,PSNTRNAM)) Q 
"RTN","PSN471P",53,0)
 ..S PSNX=PSNGIEN_";PSNDF(50.6,^"_PSNTRNAM
"RTN","PSN471P",54,0)
 ..S PSNDONTK=0,PSNVAPRD=0
"RTN","PSN471P",55,0)
 ..F  S PSNVAPRD=$O(^PSNDF(50.6,"APRO",PSNGIEN,PSNVAPRD)) Q:'PSNVAPRD  D 
"RTN","PSN471P",56,0)
 ...I $P(^PSNDF(50.68,PSNVAPRD,3),"^")=PSNOCL S PSNDONTK=1
"RTN","PSN471P",57,0)
 ..I PSNDONTK K PSNCLA("D")
"RTN","PSN471P",58,0)
 ..S PSNTNCNT=PSNTNCNT+1
"RTN","PSN471P",59,0)
 ..D BMES^XPDUTL("Updating Patient Allergies for "_PSNTRNAM)
"RTN","PSN471P",60,0)
 ..I $T(UPDATE^GMRAUTL2)]"" D UPDATE^GMRAUTL2(PSNX,,.PSNCLA)
"RTN","PSN471P",61,0)
 ..S ^TMP("PSN471P",$J,PSNGIEN,PSNTRNAM)=""
"RTN","PSN471P",62,0)
 ..D UPDATE^XPDID(PSNTNCNT)
"RTN","PSN471P",63,0)
 Q
"VER")
8.0^22.0
"BLD",10104,6)
^464
**END**
**END**

