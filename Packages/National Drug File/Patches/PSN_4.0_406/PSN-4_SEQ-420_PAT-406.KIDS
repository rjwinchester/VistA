Released PSN*4*406 SEQ #420
Extracted from mail message
**KIDS**:PSN*4.0*406^

**INSTALL NAME**
PSN*4.0*406
"BLD",9730,0)
PSN*4.0*406^NATIONAL DRUG FILE^0^3140814^y
"BLD",9730,1,0)
^^5^5^3140716^
"BLD",9730,1,1,0)
Patch PSN*4.0*406 addresses the following issue:
"BLD",9730,1,2,0)
 
"BLD",9730,1,3,0)
1.      When entering allergies for patients the software allows for
"BLD",9730,1,4,0)
assigning inactive Drug Ingredients from the Drug Ingredients file 
"BLD",9730,1,5,0)
(#50.416) as Causative Agents.
"BLD",9730,4,0)
^9.64PA^^
"BLD",9730,6.3)
7
"BLD",9730,"INI")
EN^PSN4P406
"BLD",9730,"INID")
^^n
"BLD",9730,"KRN",0)
^9.67PA^779.2^20
"BLD",9730,"KRN",.4,0)
.4
"BLD",9730,"KRN",.401,0)
.401
"BLD",9730,"KRN",.402,0)
.402
"BLD",9730,"KRN",.403,0)
.403
"BLD",9730,"KRN",.5,0)
.5
"BLD",9730,"KRN",.84,0)
.84
"BLD",9730,"KRN",3.6,0)
3.6
"BLD",9730,"KRN",3.8,0)
3.8
"BLD",9730,"KRN",9.2,0)
9.2
"BLD",9730,"KRN",9.8,0)
9.8
"BLD",9730,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",9730,"KRN",9.8,"NM",1,0)
PSNDI^^0^B9558388
"BLD",9730,"KRN",9.8,"NM","B","PSNDI",1)

"BLD",9730,"KRN",19,0)
19
"BLD",9730,"KRN",19.1,0)
19.1
"BLD",9730,"KRN",101,0)
101
"BLD",9730,"KRN",409.61,0)
409.61
"BLD",9730,"KRN",771,0)
771
"BLD",9730,"KRN",779.2,0)
779.2
"BLD",9730,"KRN",870,0)
870
"BLD",9730,"KRN",8989.51,0)
8989.51
"BLD",9730,"KRN",8989.52,0)
8989.52
"BLD",9730,"KRN",8994,0)
8994
"BLD",9730,"KRN","B",.4,.4)

"BLD",9730,"KRN","B",.401,.401)

"BLD",9730,"KRN","B",.402,.402)

"BLD",9730,"KRN","B",.403,.403)

"BLD",9730,"KRN","B",.5,.5)

"BLD",9730,"KRN","B",.84,.84)

"BLD",9730,"KRN","B",3.6,3.6)

"BLD",9730,"KRN","B",3.8,3.8)

"BLD",9730,"KRN","B",9.2,9.2)

"BLD",9730,"KRN","B",9.8,9.8)

"BLD",9730,"KRN","B",19,19)

"BLD",9730,"KRN","B",19.1,19.1)

"BLD",9730,"KRN","B",101,101)

"BLD",9730,"KRN","B",409.61,409.61)

"BLD",9730,"KRN","B",771,771)

"BLD",9730,"KRN","B",779.2,779.2)

"BLD",9730,"KRN","B",870,870)

"BLD",9730,"KRN","B",8989.51,8989.51)

"BLD",9730,"KRN","B",8989.52,8989.52)

"BLD",9730,"KRN","B",8994,8994)

"BLD",9730,"QDEF")
^^^^NO^^^^NO^^NO
"BLD",9730,"QUES",0)
^9.62^^
"BLD",9730,"REQB",0)
^9.611^1^1
"BLD",9730,"REQB",1,0)
PSN*4.0*157^2
"BLD",9730,"REQB","B","PSN*4.0*157",1)

"INI")
EN^PSN4P406
"MBREQ")
0
"PKG",479,-1)
1^1
"PKG",479,0)
NATIONAL DRUG FILE^PSN^This is the National Drug File Package V 3.16
"PKG",479,20,0)
^9.402P^^
"PKG",479,22,0)
^9.49I^1^1
"PKG",479,22,1,0)
4.0
"PKG",479,22,1,"PAH",1,0)
406^3140814
"PKG",479,22,1,"PAH",1,1,0)
^^5^5^3140814
"PKG",479,22,1,"PAH",1,1,1,0)
Patch PSN*4.0*406 addresses the following issue:
"PKG",479,22,1,"PAH",1,1,2,0)
 
"PKG",479,22,1,"PAH",1,1,3,0)
1.      When entering allergies for patients the software allows for
"PKG",479,22,1,"PAH",1,1,4,0)
assigning inactive Drug Ingredients from the Drug Ingredients file 
"PKG",479,22,1,"PAH",1,1,5,0)
(#50.416) as Causative Agents.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
2
"RTN","PSN4P406")
0^^B12038376^n/a
"RTN","PSN4P406",1,0)
PSN4P406 ;ALB/HW-Pre Install Patients with Inactive Ingredients as Causative Agents Report ; 8/14/14 4:03pm
"RTN","PSN4P406",2,0)
 ;;4.0;NATIONAL DRUG FILE;**406**; 30 Oct 98;Build 7
"RTN","PSN4P406",3,0)
 ;      This routine uses the following IAs:
"RTN","PSN4P406",4,0)
 ;      #5843  - Read file 120.8   (controlled)
"RTN","PSN4P406",5,0)
 ;      #10061 - DEM^VADPT         (supported)
"RTN","PSN4P406",6,0)
 ;      #10070 - ^XMD              (supported)
"RTN","PSN4P406",7,0)
 Q  ;Must be called at entry point
"RTN","PSN4P406",8,0)
 ;Only looking for patients that are not deceased and
"RTN","PSN4P406",9,0)
 ;where the inactive ingredient has been entered directly as a causative agent.
"RTN","PSN4P406",10,0)
EN N PSNIEN,PSNINING,DFN,PSNCOUNT,DIFROM
"RTN","PSN4P406",11,0)
 K ^TMP("PSN",$J)
"RTN","PSN4P406",12,0)
 S PSNIEN=0,PSNCOUNT=0
"RTN","PSN4P406",13,0)
 D BMES^XPDUTL("Patients with Inactive Ingredient(s) Entered as Causative Agent(s)")
"RTN","PSN4P406",14,0)
 S ^TMP("PSN",$J,0)="       "_"Patients with Inactive Ingredient(s) Entered as Causative Agent(s)"
"RTN","PSN4P406",15,0)
 D MES^XPDUTL("                                                                       ")
"RTN","PSN4P406",16,0)
 D BMES^XPDUTL("DFN                            Inactive Ingredient to be Corrected   ")
"RTN","PSN4P406",17,0)
 D BMES^XPDUTL("                                                                       ")
"RTN","PSN4P406",18,0)
 S ^TMP("PSN",$J,1)="DFN"_"                            "_"Inactive Ingredient to be Corrected   "
"RTN","PSN4P406",19,0)
 F  S PSNIEN=$O(^PS(50.416,PSNIEN)) Q:PSNIEN'>0  D
"RTN","PSN4P406",20,0)
 .I $G(^PS(50.416,PSNIEN,2))'>0 Q
"RTN","PSN4P406",21,0)
 .S PSNINING=$P(^PS(50.416,PSNIEN,0),"^") D FINDPAL(PSNINING,PSNIEN,.PSNCOUNT) Q
"RTN","PSN4P406",22,0)
 I PSNCOUNT<1 D
"RTN","PSN4P406",23,0)
 .D BMES^XPDUTL("No patient allergies with inactive ingredient as causative agent found")
"RTN","PSN4P406",24,0)
 .D MES^XPDUTL("                                                                       ")
"RTN","PSN4P406",25,0)
 .S ^TMP("PSN",$J,PSNCOUNT+2)="No patient allergies with inactive ingredient as causative agent found"
"RTN","PSN4P406",26,0)
 S XMSUB="Patient Allergies with Inactive Ingredients",XMTEXT="^TMP(""PSN"",$J,",XMY(DUZ)=""
"RTN","PSN4P406",27,0)
 D BMES^XPDUTL("                                                                       ")
"RTN","PSN4P406",28,0)
 D BMES^XPDUTL("                                                                       ")
"RTN","PSN4P406",29,0)
 D ^XMD K XMSUB,XMTEXT,XMY
"RTN","PSN4P406",30,0)
 Q
"RTN","PSN4P406",31,0)
FINDPAL(PSNINING,PSNIEN,PSNCOUNT) ;Search C cross-ref for matching ingr name to get 120.8 data                                           
"RTN","PSN4P406",32,0)
 N PSNPALR,PSNOUT,PSNPIEN,PSNX,PSNDGMAL,DFN,VADM,VAERR,VA,PSNSP1,PSNSPN1
"RTN","PSN4P406",33,0)
 D FIND^DIC(120.8,"","@;.01EI;.02;1I;22I","X",PSNINING,"","C","","","PSNPALR($J)","PSNOUT($J)")
"RTN","PSN4P406",34,0)
 I $D(PSNOUT($J,"DIERR"))>0 D
"RTN","PSN4P406",35,0)
 .S ^XTMP("PSN4P406",0)=$$FMADD^XLFDT(DT,60)_"^"_DT_"^Errors matching ingredients"
"RTN","PSN4P406",36,0)
 .M ^XTMP("PSN4P406")=PSNOUT($J)
"RTN","PSN4P406",37,0)
 .D MES^XPDUTL("Error matching ingredient name")
"RTN","PSN4P406",38,0)
 .S PSNCOUNT=PSNCOUNT+1,^TMP("PSN",$J,PSNCOUNT+2)="Error: Problem matching ingredient name"
"RTN","PSN4P406",39,0)
 ;Check if entered in error and if GMR Allergy value matches 
"RTN","PSN4P406",40,0)
 I $P($G(PSNPALR($J,"DILIST",0)),"^")<1 Q
"RTN","PSN4P406",41,0)
 S PSNPIEN=0
"RTN","PSN4P406",42,0)
 F  S PSNPIEN=$O(PSNPALR($J,"DILIST",2,PSNPIEN)) Q:PSNPIEN'>0  D
"RTN","PSN4P406",43,0)
 .I PSNPALR($J,"DILIST","ID",PSNPIEN,22)>0 Q
"RTN","PSN4P406",44,0)
 .S PSNDGMAL=PSNPALR($J,"DILIST","ID",PSNPIEN,1)
"RTN","PSN4P406",45,0)
 .I PSNDGMAL'["PS(50.416" Q
"RTN","PSN4P406",46,0)
 .I +PSNDGMAL'=PSNIEN Q
"RTN","PSN4P406",47,0)
 .;Check if patient has DATE OF DEATH
"RTN","PSN4P406",48,0)
 .S DFN=PSNPALR($J,"DILIST","ID",PSNPIEN,.01,"I")
"RTN","PSN4P406",49,0)
 .D DEM^VADPT
"RTN","PSN4P406",50,0)
 .I VAERR D  Q
"RTN","PSN4P406",51,0)
 ..D MES^XPDUTL("Error: Problem retrieving demographic data for DFN: "_DFN)
"RTN","PSN4P406",52,0)
 ..S PSNCOUNT=PSNCOUNT+1,^TMP("PSN",$J,PSNCOUNT+2)="Error: Problem retrieving demographic data for DFN: "_DFN
"RTN","PSN4P406",53,0)
 .I VADM(6)<1 D
"RTN","PSN4P406",54,0)
 ..S PSNSP1=" "
"RTN","PSN4P406",55,0)
 ..S PSNSPN1=30-$L(DFN) F PSNX=1:1:PSNSPN1 S PSNSP1=PSNSP1_" "
"RTN","PSN4P406",56,0)
 ..S PSNCOUNT=PSNCOUNT+1,^TMP("PSN",$J,PSNCOUNT+2)=DFN_PSNSP1_PSNINING
"RTN","PSN4P406",57,0)
 ..D MES^XPDUTL(DFN_PSNSP1_PSNINING)
"RTN","PSNDI")
0^1^B9558388^B9494997
"RTN","PSNDI",1,0)
PSNDI ;BIR/LDT - API FOR FILEMAN CALLS; 5 Sep 03
"RTN","PSNDI",2,0)
 ;;4.0;NATIONAL DRUG FILE;**80,109,157,406**; 30 Oct 98;Build 7
"RTN","PSNDI",3,0)
 ;
"RTN","PSNDI",4,0)
DIC(PSNFILE,PSNPACK,DIC,X,DLAYGO,PSNSCRDT) ;
"RTN","PSNDI",5,0)
 S PSNDIY=""
"RTN","PSNDI",6,0)
 I +$G(PSNFILE)'>0 S PSNDIY=-1 Q
"RTN","PSNDI",7,0)
 N PSNRTEST S PSNRTEST=$$TEST(PSNFILE)
"RTN","PSNDI",8,0)
 I 'PSNRTEST S PSNDIY=-1 Q
"RTN","PSNDI",9,0)
 K DIC("S")
"RTN","PSNDI",10,0)
 N STNDRD S STNDRD=$$SCREEN^HDISVF01(PSNFILE)
"RTN","PSNDI",11,0)
 I STNDRD=1 D XSCREEN(PSNFILE)
"RTN","PSNDI",12,0)
 I STNDRD'=1 N PSNSUBSC,PSNPIECE D NONSTD
"RTN","PSNDI",13,0)
 I '$P(PSNRTEST,"^",2) K DLAYGO I $G(DIC(0))'="" S DIC(0)=$TR(DIC(0),"L","") I $G(DIC(0))="" S PSNDIY=-1
"RTN","PSNDI",14,0)
 D ^DIC
"RTN","PSNDI",15,0)
 Q
"RTN","PSNDI",16,0)
 ;
"RTN","PSNDI",17,0)
IX(PSNFILE,PSNPACK,DIC,D,X,DLAYGO,PSNSCRDT) ;
"RTN","PSNDI",18,0)
 S PSNDIY=""
"RTN","PSNDI",19,0)
 I +$G(PSNFILE)'>0 S PSNDIY=-1 Q
"RTN","PSNDI",20,0)
 N PSNRTEST S PSNRTEST=$$TEST(PSNFILE)
"RTN","PSNDI",21,0)
 I 'PSNRTEST S PSNDIY=-1 Q
"RTN","PSNDI",22,0)
 K DIC("S")
"RTN","PSNDI",23,0)
 N STNDRD S STNDRD=$$SCREEN^HDISVF01(PSNFILE)
"RTN","PSNDI",24,0)
 I STNDRD=1 D XSCREEN(PSNFILE)
"RTN","PSNDI",25,0)
 I STNDRD'=1 N PSNSUBSC,PSNPIECE D NONSTD
"RTN","PSNDI",26,0)
 I '$P(PSNRTEST,"^",2) K DLAYGO I $G(DIC(0))'="" S DIC(0)=$TR(DIC(0),"L","") I $G(DIC(0))="" S PSNDIY=-1
"RTN","PSNDI",27,0)
 D IX^DIC
"RTN","PSNDI",28,0)
 Q
"RTN","PSNDI",29,0)
 ;
"RTN","PSNDI",30,0)
DIE(PSNFILE,PSNPACK,DIE,DA,DR,DIDEL) ;
"RTN","PSNDI",31,0)
 S PSNDIY=""
"RTN","PSNDI",32,0)
 I +$G(PSNFILE)'>0 S PSNDIY=-1 Q
"RTN","PSNDI",33,0)
 N PSNRTEST S PSNRTEST=$$TEST(PSNFILE)
"RTN","PSNDI",34,0)
 I 'PSNRTEST S PSNDIY=-1 Q
"RTN","PSNDI",35,0)
 I '$P(PSNRTEST,"^",2) S PSNDIY=-1 Q
"RTN","PSNDI",36,0)
 D ^DIE
"RTN","PSNDI",37,0)
 Q
"RTN","PSNDI",38,0)
 ;
"RTN","PSNDI",39,0)
TEST(PSNTFILE) ; Test to check if file is listed in the API
"RTN","PSNDI",40,0)
 N CNT,PSNAPP2,PSNFFLAG,PSNFLOOP,PSNFTEST,PSNLNODE,PSNRSLT S PSNRSLT="0^0",PSNFFLAG=0
"RTN","PSNDI",41,0)
 F PSNFLOOP=1:1 S PSNFTEST=$P($T(FILE1+PSNFLOOP),";;",2) Q:+$G(PSNFTEST)'>0!PSNFFLAG  I +PSNFTEST=PSNTFILE S $P(PSNRSLT,"^")=1 S PSNLNODE=$T(FILE1+PSNFLOOP) D
"RTN","PSNDI",42,0)
 .F CNT=3:1:$L(PSNLNODE,";;") S PSNAPP2=$P(PSNLNODE,";;",CNT) Q:$P(PSNRSLT,"^",2)=1  I PSNAPP2=$G(PSNPACK) S PSNFFLAG=1,$P(PSNRSLT,"^",2)=1
"RTN","PSNDI",43,0)
 Q PSNRSLT
"RTN","PSNDI",44,0)
 ;
"RTN","PSNDI",45,0)
NONSTD ;
"RTN","PSNDI",46,0)
 I +$G(PSNSCRDT)>0 D SCREEN
"RTN","PSNDI",47,0)
 Q
"RTN","PSNDI",48,0)
 ;
"RTN","PSNDI",49,0)
SCREEN ;Set screen if Inactive Date is passed in
"RTN","PSNDI",50,0)
 N PSNILOOP,PSNILOC,PSNINFLG,PSNINODE S PSNINFLG=0
"RTN","PSNDI",51,0)
 F PSNILOOP=1:1 S PSNILOC=$P($T(FILE2+PSNILOOP),";;",2) Q:+$G(PSNILOC)'>0!PSNINFLG  I +PSNILOC=PSNFILE S PSNINFLG=1 S PSNINODE=$T(FILE2+PSNILOOP) D
"RTN","PSNDI",52,0)
 .S PSNSUBSC=$P(PSNINODE,";;",3),PSNPIECE=$P(PSNINODE,";;",4)
"RTN","PSNDI",53,0)
 .I PSNSUBSC'="",PSNPIECE'="" S DIC("S")="I $P($G(^(PSNSUBSC)),""^"",PSNPIECE)=""""!(+$P($G(^(PSNSUBSC)),""^"",PSNPIECE)>+$G(PSNSCRDT))"
"RTN","PSNDI",54,0)
 Q
"RTN","PSNDI",55,0)
 ;
"RTN","PSNDI",56,0)
XSCREEN(PSNTFILE) ; Set screen for standardized files
"RTN","PSNDI",57,0)
 I +$G(PSNSCRDT)>0 S DIC("S")="I '$$SCREEN^XTID("_PSNTFILE_",.01,+Y_"","",+$G(PSNSCRDT))"
"RTN","PSNDI",58,0)
 Q
"RTN","PSNDI",59,0)
 ;
"RTN","PSNDI",60,0)
FILE1 ;Package listed if Write access (DLAYGO) is allowed
"RTN","PSNDI",61,0)
 ;;50.416;;PSN
"RTN","PSNDI",62,0)
 ;;50.605;;PSN
"RTN","PSNDI",63,0)
 ;;50.6;;PSN
"RTN","PSNDI",64,0)
 ;;50.67;;PSN
"RTN","PSNDI",65,0)
 ;;56;;PSN;;PSS
"RTN","PSNDI",66,0)
 ;;
"RTN","PSNDI",67,0)
 Q
"RTN","PSNDI",68,0)
 ;
"RTN","PSNDI",69,0)
FILE2 ;For Lookup calls, check for Inactive Date Screen
"RTN","PSNDI",70,0)
 ;;50.67;;0;;7
"RTN","PSNDI",71,0)
 ;;56;;0;;7
"RTN","PSNDI",72,0)
 ;;50.416;;2;;1
"RTN","PSNDI",73,0)
 ;;
"RTN","PSNDI",74,0)
 Q
"VER")
8.0^22.0
"BLD",9730,6)
^420
**END**
**END**

