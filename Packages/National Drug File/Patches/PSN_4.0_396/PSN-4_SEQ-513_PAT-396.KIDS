Released PSN*4*396 SEQ #513
Extracted from mail message
**KIDS**:PSN*4.0*396^

**INSTALL NAME**
PSN*4.0*396
"BLD",9663,0)
PSN*4.0*396^NATIONAL DRUG FILE^0^3170612^y
"BLD",9663,1,0)
^^16^16^3130808^
"BLD",9663,1,1,0)
This patch provides updates to data in several of the files associated
"BLD",9663,1,2,0)
with the National Drug File (NDF) application.
"BLD",9663,1,3,0)
This patch generates four mail messages.  All are sent from NDF MANAGER
"BLD",9663,1,4,0)
to members of the NDF DATA mail group, holders of the PSNMGR security 
"BLD",9663,1,5,0)
key, and the person installing the patch.  The first message, with the
"BLD",9663,1,6,0)
subject DATA UPDATE FOR NDF, lists new products, CMOP ID (if one exists),
"BLD",9663,1,7,0)
dispense units, and associated NDCs, products for which the national
"BLD",9663,1,8,0)
formulary indicator has changed, products that have been unmatched from
"BLD",9663,1,9,0)
CMOP, and products for which the national formulary restriction has
"BLD",9663,1,10,0)
changed.  The second, with the subject UPDATED INTERACTIONS, lists
"BLD",9663,1,11,0)
interactions that have been added, edited, or inactivated. The third, with
"BLD",9663,1,12,0)
the subject DRUGS UNMATCHED FROM NATIONAL DRUG FILE, lists entries in the
"BLD",9663,1,13,0)
DRUG file (#50) which have been unmatched from NDF.  The fourth, with the
"BLD",9663,1,14,0)
subject INTERACTIONS and ALLERGIES UPDATED, lists interactions and allergies
"BLD",9663,1,15,0)
which have been changed because they were created with ingredients that
"BLD",9663,1,16,0)
are no longer primary ingredients.
"BLD",9663,4,0)
^9.64PA^50.68^1
"BLD",9663,4,50.68,0)
50.68
"BLD",9663,4,50.68,2,0)
^9.641^50.68108^2
"BLD",9663,4,50.68,2,50.68,0)
VA PRODUCT  (File-top level)
"BLD",9663,4,50.68,2,50.68,1,0)
^9.6411^110^7
"BLD",9663,4,50.68,2,50.68,1,101,0)
HAZARDOUS TO HANDLE
"BLD",9663,4,50.68,2,50.68,1,102,0)
HAZARDOUS TO DISPOSE
"BLD",9663,4,50.68,2,50.68,1,103,0)
PRIMARY EPA CODE
"BLD",9663,4,50.68,2,50.68,1,104,0)
WASTE SORT CODE
"BLD",9663,4,50.68,2,50.68,1,105,0)
DOT SHIPPING CODE
"BLD",9663,4,50.68,2,50.68,1,109,0)
FORMULARY DESIGNATOR
"BLD",9663,4,50.68,2,50.68,1,110,0)
FORMULARY DESIGNATOR TEXT
"BLD",9663,4,50.68,2,50.68108,0)
CLINICAL EFFECTS OF DRUG  (sub-file)
"BLD",9663,4,50.68,2,50.68108,1,0)
^9.6411^^
"BLD",9663,4,50.68,222)
y^y^p^^^^n^^n
"BLD",9663,4,50.68,224)

"BLD",9663,4,"APDD",50.68,50.68)

"BLD",9663,4,"APDD",50.68,50.68,101)

"BLD",9663,4,"APDD",50.68,50.68,102)

"BLD",9663,4,"APDD",50.68,50.68,103)

"BLD",9663,4,"APDD",50.68,50.68,104)

"BLD",9663,4,"APDD",50.68,50.68,105)

"BLD",9663,4,"APDD",50.68,50.68,109)

"BLD",9663,4,"APDD",50.68,50.68,110)

"BLD",9663,4,"APDD",50.68,50.68108)

"BLD",9663,4,"B",50.68,50.68)

"BLD",9663,6)
41^
"BLD",9663,6.3)
190
"BLD",9663,"ABPKG")
n
"BLD",9663,"INID")
^
"BLD",9663,"INIT")

"BLD",9663,"KRN",0)
^9.67PA^8994^22
"BLD",9663,"KRN",.4,0)
.4
"BLD",9663,"KRN",.4,"NM",0)
^9.68A^^
"BLD",9663,"KRN",.401,0)
.401
"BLD",9663,"KRN",.402,0)
.402
"BLD",9663,"KRN",.402,"NM",0)
^9.68A^^0
"BLD",9663,"KRN",.403,0)
.403
"BLD",9663,"KRN",.5,0)
.5
"BLD",9663,"KRN",.84,0)
.84
"BLD",9663,"KRN",3.6,0)
3.6
"BLD",9663,"KRN",3.8,0)
3.8
"BLD",9663,"KRN",9.2,0)
9.2
"BLD",9663,"KRN",9.2,"NM",0)
^9.68A^^
"BLD",9663,"KRN",9.8,0)
9.8
"BLD",9663,"KRN",9.8,"NM",0)
^9.68A^16^7
"BLD",9663,"KRN",9.8,"NM",9,0)
PSNACT^^0^B156137593
"BLD",9663,"KRN",9.8,"NM",11,0)
PSN50P68^^0^B24576514
"BLD",9663,"KRN",9.8,"NM",12,0)
PSNLOOK^^0^B63244023
"BLD",9663,"KRN",9.8,"NM",13,0)
PSNCLEHW^^0^B12524464
"BLD",9663,"KRN",9.8,"NM",14,0)
PSNHIT^^0^B27416707
"BLD",9663,"KRN",9.8,"NM",15,0)
PSNVFY^^0^B18516900
"BLD",9663,"KRN",9.8,"NM",16,0)
PSNDRUG^^0^B15993340
"BLD",9663,"KRN",9.8,"NM","B","PSN50P68",11)

"BLD",9663,"KRN",9.8,"NM","B","PSNACT",9)

"BLD",9663,"KRN",9.8,"NM","B","PSNCLEHW",13)

"BLD",9663,"KRN",9.8,"NM","B","PSNDRUG",16)

"BLD",9663,"KRN",9.8,"NM","B","PSNHIT",14)

"BLD",9663,"KRN",9.8,"NM","B","PSNLOOK",12)

"BLD",9663,"KRN",9.8,"NM","B","PSNVFY",15)

"BLD",9663,"KRN",19,0)
19
"BLD",9663,"KRN",19,"NM",0)
^9.68A^^0
"BLD",9663,"KRN",19.1,0)
19.1
"BLD",9663,"KRN",19.1,"NM",0)
^9.68A^^0
"BLD",9663,"KRN",101,0)
101
"BLD",9663,"KRN",101,"NM",0)
^9.68A^^
"BLD",9663,"KRN",409.61,0)
409.61
"BLD",9663,"KRN",771,0)
771
"BLD",9663,"KRN",779.2,0)
779.2
"BLD",9663,"KRN",869.2,0)
869.2
"BLD",9663,"KRN",870,0)
870
"BLD",9663,"KRN",8989.51,0)
8989.51
"BLD",9663,"KRN",8989.52,0)
8989.52
"BLD",9663,"KRN",8994,0)
8994
"BLD",9663,"KRN","B",.4,.4)

"BLD",9663,"KRN","B",.401,.401)

"BLD",9663,"KRN","B",.402,.402)

"BLD",9663,"KRN","B",.403,.403)

"BLD",9663,"KRN","B",.5,.5)

"BLD",9663,"KRN","B",.84,.84)

"BLD",9663,"KRN","B",3.6,3.6)

"BLD",9663,"KRN","B",3.8,3.8)

"BLD",9663,"KRN","B",9.2,9.2)

"BLD",9663,"KRN","B",9.8,9.8)

"BLD",9663,"KRN","B",19,19)

"BLD",9663,"KRN","B",19.1,19.1)

"BLD",9663,"KRN","B",101,101)

"BLD",9663,"KRN","B",409.61,409.61)

"BLD",9663,"KRN","B",771,771)

"BLD",9663,"KRN","B",779.2,779.2)

"BLD",9663,"KRN","B",869.2,869.2)

"BLD",9663,"KRN","B",870,870)

"BLD",9663,"KRN","B",8989.51,8989.51)

"BLD",9663,"KRN","B",8989.52,8989.52)

"BLD",9663,"KRN","B",8994,8994)

"BLD",9663,"PRE")

"BLD",9663,"PRET")

"BLD",9663,"QDEF")
^^^^NO^^^^NO^^NO
"BLD",9663,"QUES",0)
^9.62^^
"BLD",9663,"REQB",0)
^9.611^3^3
"BLD",9663,"REQB",1,0)
PSN*4.0*109^2
"BLD",9663,"REQB",2,0)
PSN*4.0*33^2
"BLD",9663,"REQB",3,0)
PSN*4.0*492^2
"BLD",9663,"REQB","B","PSN*4.0*109",1)

"BLD",9663,"REQB","B","PSN*4.0*33",2)

"BLD",9663,"REQB","B","PSN*4.0*492",3)

"FIA",50.68)
VA PRODUCT
"FIA",50.68,0)
^PSNDF(50.68,
"FIA",50.68,0,0)
50.68
"FIA",50.68,0,1)
y^y^p^^^^n^^n
"FIA",50.68,0,10)

"FIA",50.68,0,11)

"FIA",50.68,0,"RLRO")

"FIA",50.68,0,"VR")
4.0^PSN
"FIA",50.68,50.68)
1
"FIA",50.68,50.68,101)

"FIA",50.68,50.68,102)

"FIA",50.68,50.68,103)

"FIA",50.68,50.68,104)

"FIA",50.68,50.68,105)

"FIA",50.68,50.68,108)

"FIA",50.68,50.68,109)

"FIA",50.68,50.68,110)

"FIA",50.68,50.681)
0
"FIA",50.68,50.68105)
0
"FIA",50.68,50.68108)
0
"MBREQ")
0
"PKG",136,-1)
1^1
"PKG",136,0)
NATIONAL DRUG FILE^PSN^This is the National Drug File Package V 3.14
"PKG",136,20,0)
^9.402P^^
"PKG",136,22,0)
^9.49I^1^1
"PKG",136,22,1,0)
4.0^2981030^2981223^11595
"PKG",136,22,1,"PAH",1,0)
396^3170612^11961
"PKG",136,22,1,"PAH",1,1,0)
^^16^16^3170612
"PKG",136,22,1,"PAH",1,1,1,0)
This patch provides updates to data in several of the files associated
"PKG",136,22,1,"PAH",1,1,2,0)
with the National Drug File (NDF) application.
"PKG",136,22,1,"PAH",1,1,3,0)
This patch generates four mail messages.  All are sent from NDF MANAGER
"PKG",136,22,1,"PAH",1,1,4,0)
to members of the NDF DATA mail group, holders of the PSNMGR security 
"PKG",136,22,1,"PAH",1,1,5,0)
key, and the person installing the patch.  The first message, with the
"PKG",136,22,1,"PAH",1,1,6,0)
subject DATA UPDATE FOR NDF, lists new products, CMOP ID (if one exists),
"PKG",136,22,1,"PAH",1,1,7,0)
dispense units, and associated NDCs, products for which the national
"PKG",136,22,1,"PAH",1,1,8,0)
formulary indicator has changed, products that have been unmatched from
"PKG",136,22,1,"PAH",1,1,9,0)
CMOP, and products for which the national formulary restriction has
"PKG",136,22,1,"PAH",1,1,10,0)
changed.  The second, with the subject UPDATED INTERACTIONS, lists
"PKG",136,22,1,"PAH",1,1,11,0)
interactions that have been added, edited, or inactivated. The third, with
"PKG",136,22,1,"PAH",1,1,12,0)
the subject DRUGS UNMATCHED FROM NATIONAL DRUG FILE, lists entries in the
"PKG",136,22,1,"PAH",1,1,13,0)
DRUG file (#50) which have been unmatched from NDF.  The fourth, with the
"PKG",136,22,1,"PAH",1,1,14,0)
subject INTERACTIONS and ALLERGIES UPDATED, lists interactions and allergies
"PKG",136,22,1,"PAH",1,1,15,0)
which have been changed because they were created with ingredients that
"PKG",136,22,1,"PAH",1,1,16,0)
are no longer primary ingredients.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
7
"RTN","PSN50P68")
0^11^B24576514^B17364727
"RTN","PSN50P68",1,0)
PSN50P68 ;BIR/LDT-API FOR INFORMATION FROM FILE 50.68 ; 5 Sep 03
"RTN","PSN50P68",2,0)
 ;;4.0;NATIONAL DRUG FILE;**80,94,104,109,396**; 30 Oct 98;Build 190
"RTN","PSN50P68",3,0)
 ;
"RTN","PSN50P68",4,0)
FORM(PSNIEN) ;
"RTN","PSN50P68",5,0)
 ;PSNIEN - IEN of entry in VA PRODUCT file (#50.68).
"RTN","PSN50P68",6,0)
 ;Returns NATIONAL FORMULARY NAME field (#4) of the VA PRODUCT file (#50.68).
"RTN","PSN50P68",7,0)
 I +$G(PSNIEN)'>0 Q ""
"RTN","PSN50P68",8,0)
 Q $P($G(^PSNDF(50.68,+PSNIEN,0)),"^",6)
"RTN","PSN50P68",9,0)
 ;
"RTN","PSN50P68",10,0)
DATA(PSNIEN,PSNFT,LIST) ;
"RTN","PSN50P68",11,0)
 ;PSNIEN - IEN of entry in VA PRODUCT file (#50.68).
"RTN","PSN50P68",12,0)
 ;PSNFT - Free Text name in  VA PRODUCT file (#50.68).
"RTN","PSN50P68",13,0)
 ;LIST - Subscript of ^TMP array in the form ^TMP($J,LIST,Field Number where Field Number is the
"RTN","PSN50P68",14,0)
 ;       Field Number of the data piece beingreturned.
"RTN","PSN50P68",15,0)
 N DIERR,ZZERR,PSN50P68,PSN,PSNSERVP
"RTN","PSN50P68",16,0)
 S PSNSERVP=$$PATCH^XPDUTL("PSN*4.0*103")
"RTN","PSN50P68",17,0)
 I $G(LIST)']"" Q
"RTN","PSN50P68",18,0)
 K ^TMP($J,LIST)
"RTN","PSN50P68",19,0)
 I +$G(PSNIEN)'>0,($G(PSNFT)']"") S ^TMP($J,LIST,0)=-1_"^"_"NO DATA FOUND" Q
"RTN","PSN50P68",20,0)
 I $G(PSNIEN)]"",+$G(PSNIEN)'>0 S ^TMP($J,LIST,0)=-1_"^"_"NO DATA FOUND" Q
"RTN","PSN50P68",21,0)
 I $G(PSNIEN)]"" N PSNIEN2 S PSNIEN2=$$FIND1^DIC(50.68,"","B","`"_PSNIEN,,,"") D
"RTN","PSN50P68",22,0)
 .I +PSNIEN2'>0 S ^TMP($J,LIST,0)=-1_"^"_"NO DATA FOUND" Q
"RTN","PSN50P68",23,0)
 .S ^TMP($J,LIST,0)=1
"RTN","PSN50P68",24,0)
 .D GETS^DIQ(50.68,+PSNIEN2,".01;.05;3;4;5;6;8;11;12;13;19;2000;101;102;103;104;105;108*","IE","PSN50P68") S PSN(1)=0
"RTN","PSN50P68",25,0)
 .F  S PSN(1)=$O(PSN50P68(50.68,PSN(1))) Q:'PSN(1)  D SETZRO
"RTN","PSN50P68",26,0)
 .S PSN(1)=0 F  S PSN(1)=$O(PSN50P68(50.68108,PSN(1))) Q:'PSN(1)  D CLEFF
"RTN","PSN50P68",27,0)
 I $G(PSNIEN)="",$G(PSNFT)]"" D
"RTN","PSN50P68",28,0)
 .I PSNFT["??" D LOOP Q
"RTN","PSN50P68",29,0)
 .D FIND^DIC(50.68,,"@;.01","QP",PSNFT,,"B",,,"")
"RTN","PSN50P68",30,0)
 .I +$G(^TMP("DILIST",$J,0))=0 S ^TMP($J,LIST,0)=-1_"^"_"NO DATA FOUND" Q
"RTN","PSN50P68",31,0)
 .I +^TMP("DILIST",$J,0)>0 S ^TMP($J,LIST,0)=+^TMP("DILIST",$J,0) N PSNXX S PSNXX=0 F  S PSNXX=$O(^TMP("DILIST",$J,PSNXX)) Q:'PSNXX  D
"RTN","PSN50P68",32,0)
 ..S PSNIEN=+^TMP("DILIST",$J,PSNXX,0) K PSN50P68 D GETS^DIQ(50.68,+PSNIEN,".01;.05;3;4;5;6;8;11;12;13;19;2000;101;102;103;104;105;108*","IE","PSN50P68") S PSN(1)=0
"RTN","PSN50P68",33,0)
 ..F  S PSN(1)=$O(PSN50P68(50.68,PSN(1))) Q:'PSN(1)  D SETZRO
"RTN","PSN50P68",34,0)
 K ^TMP("DILIST",$J)
"RTN","PSN50P68",35,0)
 Q
"RTN","PSN50P68",36,0)
SETZRO ;
"RTN","PSN50P68",37,0)
 S ^TMP($J,LIST,+PSN(1),.01)=$G(PSN50P68(50.68,PSN(1),.01,"I"))
"RTN","PSN50P68",38,0)
 S ^TMP($J,LIST,"B",$G(PSN50P68(50.68,PSN(1),.01,"I")),+PSN(1))=""
"RTN","PSN50P68",39,0)
 S ^TMP($J,LIST,+PSN(1),.05)=$S($G(PSN50P68(50.68,PSN(1),.05,"I"))="":"",1:$G(PSN50P68(50.68,PSN(1),.05,"I"))_"^"_$G(PSN50P68(50.68,PSN(1),.05,"E")))
"RTN","PSN50P68",40,0)
 S ^TMP($J,LIST,+PSN(1),3)=$S($G(PSN50P68(50.68,PSN(1),3,"I"))="":"",1:$G(PSN50P68(50.68,PSN(1),3,"I"))_"^"_$G(PSN50P68(50.68,PSN(1),3,"E")))
"RTN","PSN50P68",41,0)
 S ^TMP($J,LIST,+PSN(1),4)=$G(PSN50P68(50.68,PSN(1),4,"I"))
"RTN","PSN50P68",42,0)
 S ^TMP($J,LIST,+PSN(1),5)=$G(PSN50P68(50.68,PSN(1),5,"I"))
"RTN","PSN50P68",43,0)
 S ^TMP($J,LIST,+PSN(1),6)=$G(PSN50P68(50.68,PSN(1),6,"I"))
"RTN","PSN50P68",44,0)
 S ^TMP($J,LIST,+PSN(1),8)=$G(PSN50P68(50.68,PSN(1),8,"I"))
"RTN","PSN50P68",45,0)
 S ^TMP($J,LIST,+PSN(1),11)=$G(PSN50P68(50.68,PSN(1),11,"I"))
"RTN","PSN50P68",46,0)
 S ^TMP($J,LIST,+PSN(1),12)=$G(PSN50P68(50.68,PSN(1),12,"I"))
"RTN","PSN50P68",47,0)
 S ^TMP($J,LIST,+PSN(1),13)=$G(PSN50P68(50.68,PSN(1),13,"I"))
"RTN","PSN50P68",48,0)
 S ^TMP($J,LIST,+PSN(1),19)=$S($G(PSN50P68(50.68,PSN(1),19,"I"))="":"",1:$G(PSN50P68(50.68,PSN(1),19,"I"))_"^"_$G(PSN50P68(50.68,PSN(1),19,"E")))
"RTN","PSN50P68",49,0)
 I $G(PSNSERVP) S ^TMP($J,LIST,+PSN(1),2000)=$S($G(PSN50P68(50.68,PSN(1),2000,"I"))'="":$G(PSN50P68(50.68,PSN(1),2000,"I")),1:600000)
"RTN","PSN50P68",50,0)
 S ^TMP($J,LIST,+PSN(1),101)=$G(PSN50P68(50.68,PSN(1),101,"I"))
"RTN","PSN50P68",51,0)
 S ^TMP($J,LIST,+PSN(1),102)=$G(PSN50P68(50.68,PSN(1),102,"I"))
"RTN","PSN50P68",52,0)
 S ^TMP($J,LIST,+PSN(1),103)=$G(PSN50P68(50.68,PSN(1),103,"I"))
"RTN","PSN50P68",53,0)
 S ^TMP($J,LIST,+PSN(1),104)=$G(PSN50P68(50.68,PSN(1),104,"I"))
"RTN","PSN50P68",54,0)
 ;S ^TMP($J,LIST,+PSN(1),105)=$G(PSN50P68(50.68,PSN(1),105,"I"))
"RTN","PSN50P68",55,0)
 N PSNHAZWC,X S PSNHAZWC=0
"RTN","PSN50P68",56,0)
 F  S PSNHAZWC=$O(PSN50P68(50.68,PSN(1),105,PSNHAZWC)) Q:'PSNHAZWC  D
"RTN","PSN50P68",57,0)
 .S X="",X=PSN50P68(50.68,PSN(1),105,PSNHAZWC) S ^TMP($J,LIST,+PSN(1),105,PSNHAZWC)=X
"RTN","PSN50P68",58,0)
 Q
"RTN","PSN50P68",59,0)
 ;
"RTN","PSN50P68",60,0)
CLEFF ;set clinical effects of drug 
"RTN","PSN50P68",61,0)
 S ^TMP($J,LIST,$P(PSN(1),",",2),108,$P(PSN(1),","),.01)=$G(PSN50P68(50.68108,PSN(1),.01,"I"))
"RTN","PSN50P68",62,0)
 S ^TMP($J,LIST,$P(PSN(1),",",2),108,$P(PSN(1),","),1)=$G(PSN50P68(50.68108,PSN(1),1,"I"))
"RTN","PSN50P68",63,0)
 S ^TMP($J,LIST,$P(PSN(1),",",2),108,$P(PSN(1),","),2)=$G(PSN50P68(50.68108,PSN(1),2,"I"))
"RTN","PSN50P68",64,0)
 Q
"RTN","PSN50P68",65,0)
 ;
"RTN","PSN50P68",66,0)
LOOP ;
"RTN","PSN50P68",67,0)
 N PSNIEN,CNT,PSN50DD1,PSN50DD2,PSN50DD3,PSN1NOD,PSNZNOD,PSN1NOD,PSN7FED
"RTN","PSN50P68",68,0)
 D FIELD^DID(50.68,19,"Z","POINTER","PSN50DD1","PSN50DD2") S PSN50DD3=$G(PSN50DD1("POINTER"))
"RTN","PSN50P68",69,0)
 S CNT=0
"RTN","PSN50P68",70,0)
 S PSNIEN=0 F  S PSNIEN=$O(^PSNDF(50.68,PSNIEN)) Q:'PSNIEN  D
"RTN","PSN50P68",71,0)
 .S PSNZNOD=$G(^PSNDF(50.68,PSNIEN,0)),PSN1NOD=$G(^(1)),PSN7FED=$P($G(^(7)),"^")
"RTN","PSN50P68",72,0)
 .I $P(PSNZNOD,"^")="" Q
"RTN","PSN50P68",73,0)
 .S CNT=CNT+1
"RTN","PSN50P68",74,0)
 .S ^TMP($J,LIST,PSNIEN,.01)=$P(PSNZNOD,"^")
"RTN","PSN50P68",75,0)
 .S ^TMP($J,LIST,"B",$P(PSNZNOD,"^"),PSNIEN)=""
"RTN","PSN50P68",76,0)
 .S ^TMP($J,LIST,PSNIEN,.05)=$S($P(PSNZNOD,"^",2)="":"",1:$P(PSNZNOD,"^",2)_"^"_$P($G(^PSNDF(50.6,+$P(PSNZNOD,"^",2),0)),"^"))
"RTN","PSN50P68",77,0)
 .S ^TMP($J,LIST,PSNIEN,3)=$S($P(PSNZNOD,"^",5)="":"",1:$P(PSNZNOD,"^",5)_"^"_$P($G(^PS(50.607,+$P(PSNZNOD,"^",5),0)),"^"))
"RTN","PSN50P68",78,0)
 .S ^TMP($J,LIST,PSNIEN,4)=$P(PSNZNOD,"^",6)
"RTN","PSN50P68",79,0)
 .S ^TMP($J,LIST,PSNIEN,11)=$P(PSN1NOD,"^",5)
"RTN","PSN50P68",80,0)
 .S ^TMP($J,LIST,PSNIEN,12)=$P(PSN1NOD,"^",6)
"RTN","PSN50P68",81,0)
 .S ^TMP($J,LIST,PSNIEN,13)=$P(PSN1NOD,"^",7)
"RTN","PSN50P68",82,0)
 .I PSN50DD3'="",PSN7FED'="",PSN50DD3[(PSN7FED_":") S ^TMP($J,LIST,PSNIEN,19)=PSN7FED_"^"_$P($E(PSN50DD3,$F(PSN50DD3,(PSN7FED_":")),999),";")
"RTN","PSN50P68",83,0)
 .I '$D(^TMP($J,LIST,PSNIEN,19)) S ^TMP($J,LIST,PSNIEN,19)=""
"RTN","PSN50P68",84,0)
 .I $G(PSNSERVP) S ^TMP($J,LIST,PSNIEN,2000)=$S($P($G(^PSNDF(50.68,PSNIEN,"PFS")),"^")'="":$P($G(^PSNDF(50.68,PSNIEN,"PFS")),"^"),1:600000)
"RTN","PSN50P68",85,0)
 .S ^TMP($J,LIST,PSNIEN,101)=$P(PSN1NOD,"^",5)
"RTN","PSN50P68",86,0)
 S ^TMP($J,LIST,0)=$S(+CNT>0:CNT,1:"-1^NO DATA FOUND")
"RTN","PSN50P68",87,0)
 Q
"RTN","PSNACT")
0^9^B156137593^B121966674
"RTN","PSNACT",1,0)
PSNACT ;BIR/DMA&WRT-inquiries by VAPN, CMOP ID, or NDC ;07/02/03 14:01
"RTN","PSNACT",2,0)
 ;;4.0;NATIONAL DRUG FILE;**22,35,47,62,65,70,160,169,262,296,429,492,396**; 30 Oct 98;Build 190
"RTN","PSNACT",3,0)
 ;
"RTN","PSNACT",4,0)
 ;Reference to ^PS(50.606 supported by DBIA #2174
"RTN","PSNACT",5,0)
 ;Reference to ^PSNAPIS supported by DBIA #2531
"RTN","PSNACT",6,0)
 ;
"RTN","PSNACT",7,0)
 I '$D(IORVON) S X="IORVON;IORVOFF" D ENDR^%ZISS
"RTN","PSNACT",8,0)
 K DIC,DIR F ZXX=0:0 W ! D TEXT,ASKIT Q:$D(DIRUT)
"RTN","PSNACT",9,0)
 K QUIT,DIR,DIC,OLDDA,PROMPT,J,I,IEN,PPP,Y,Y1,Y3,Y5,Y6,Y7,Z0,Z1,Z3,Z5,Z6,Z7,ZA,ZXX,ASK,NDX,SIE,PSN,PSN1,MORE,SIE1
"RTN","PSNACT",10,0)
 N PMIS,QQQ,ENG,MAP,D,ANS,ZCT,DYAYGO,DUOUT,DTOUT,PSNTIER
"RTN","PSNACT",11,0)
 Q
"RTN","PSNACT",12,0)
TEXT W !,"This option allows you to lookup NDF file information three ways (VA Product",!,"Name, NDC, or CMOP ID number).",!
"RTN","PSNACT",13,0)
 Q
"RTN","PSNACT",14,0)
ASKIT S DIR(0)="SA^VA:VA PRODUCT;N:NDC;C:CMOP ID",DIR("A")="LOOKUP BY (VA) PRODUCT, (N)DC, OR (C)MOP ID ? " D ^DIR G END:$D(DIRUT) S ASK=Y(0)
"RTN","PSNACT",15,0)
 I ASK="NDC" D NDC
"RTN","PSNACT",16,0)
 I ASK="VA PRODUCT"  D LISTNDC
"RTN","PSNACT",17,0)
 I ASK="CMOP ID" D CMOP
"RTN","PSNACT",18,0)
 Q
"RTN","PSNACT",19,0)
 ;
"RTN","PSNACT",20,0)
NDC ;OR UPN
"RTN","PSNACT",21,0)
 K PROMPT S DIR(0)="SA^N:NDC;U:UPN",DIR("A")="NDC (N) or UPN (U) ? " D ^DIR G END:$D(DIRUT) S PROMPT=Y(0)
"RTN","PSNACT",22,0)
 I PROMPT="NDC" S DIR(0)="F",DIR("A")="Enter NDC with or without Dashes (-)" D ^DIR G END:$D(DIRUT) D:X["-" PAD S DIC=50.67,DIC(0)="EQZN",D=PROMPT,DIC("W")="S PSNCTNDC=Y D GETTIERN^PSNACT(PSNCTNDC)" D IX^DIC Q:Y<0  S DA=+Y,NDF=Y(0) D LKNDC
"RTN","PSNACT",23,0)
 I PROMPT="UPN" S DIC=50.67,DIC(0)="AEQZN",DIC("A")="Select "_PROMPT_":"_" ",D=PROMPT,DIC("W")="S PSNCTNDC=Y D GETTIERN^PSNACT(PSNCTNDC)" D IX^DIC Q:Y<0  S DA=+Y,NDF=Y(0) D LKNDC
"RTN","PSNACT",24,0)
 Q
"RTN","PSNACT",25,0)
LKNDC W @IOF,!,"NDC: ",$P(NDF,"^",2),$$DT($P(NDF,"^",7)),"  UPN: ",$P(NDF,"^",3),!,"VA Product Name: ",$P(^PSNDF(50.68,$P(NDF,"^",6),0),"^"),!,"Manufacturer: ",$P($G(^PS(55.95,+$P(NDF,"^",4),0)),"^"),"  Trade Name: ",$P(NDF,"^",5),!,"Route: "
"RTN","PSNACT",26,0)
 S K=0 F  S K=$O(^PSNDF(50.67,DA,1,K)) Q:'K  W $P(^(K,0),"^")," "
"RTN","PSNACT",27,0)
 W !,"Package Size: ",$P(^PS(50.609,$P(NDF,"^",8),0),"^"),"  Package Type: ",$P(^PS(50.608,$P(NDF,"^",9),0),"^")
"RTN","PSNACT",28,0)
 S ZA=$P(NDF,"^",6) D PRINT(ZA)
"RTN","PSNACT",29,0)
 Q
"RTN","PSNACT",30,0)
END K DA,DA,DIC,DIE,DIR,DR,IN,ING,J,K,L,NEW,NDF,OLD,OLDDA,PROMPT,X,Y,Y1,Y3,Y7,^TMP($J) Q
"RTN","PSNACT",31,0)
 ;
"RTN","PSNACT",32,0)
PRODI ;INQUIRE INTO 50.68
"RTN","PSNACT",33,0)
 F  S DIC="^PSNDF(50.68,",DIC(0)="AEQM" D ^DIC Q:Y<0  S DA=+Y D EN^DIQ
"RTN","PSNACT",34,0)
 K DA,DIC,X,Y Q
"RTN","PSNACT",35,0)
 ;
"RTN","PSNACT",36,0)
NDCI ;INQUIRE INTO 50.67
"RTN","PSNACT",37,0)
 S DIR(0)="SA^N:NDC;U:UPN;T:TRADE;P:PRODUCT",DIR("A")="NDC (N), UPN (U), Trade name (T), or Product (P) " D ^DIR G END:$D(DIRUT) S PROMPT=Y(0) G LISTNDC:PROMPT["PRO",LISTNDC1:PROMPT="NDC" I PROMPT["T" S PROMPT="T"
"RTN","PSNACT",38,0)
 F  S DIC="^PSNDF(50.67,",DIC(0)="AEQZS",DIC("A")="Select "_PROMPT S:PROMPT="T" DIC("A")=DIC("A")_"rade name" S DIC("A")=DIC("A")_" ",D=PROMPT D IX^DIC Q:Y<0  S DA=+Y D EN^DIQ
"RTN","PSNACT",39,0)
 K DA,DIC,DIR,PROMPT,X,Y Q
"RTN","PSNACT",40,0)
 ;
"RTN","PSNACT",41,0)
LINK ;LINK NDCS OR UPNS
"RTN","PSNACT",42,0)
 S DIR(0)="SA^N:NDC;U:UPN",DIR("A")="NDC (N) or UPN (U) ",DIR("B")="NDC" D ^DIR G END:$D(DIRUT) S PROMPT=Y(0)
"RTN","PSNACT",43,0)
 F  Q:$D(DIRUT)!(Y<0)  S DIC=50.67,DIC(0)="AEQZ",DIC("A")="Enter Current "_PROMPT_" ",D=PROMPT D IX^DIC Q:Y<0  S DA=+Y,OLD=$P(Y(0),"^",$S(PROMPT="NDC":2,1:3)) D
"RTN","PSNACT",44,0)
 .K DIR S DIR(0)="F^"_$S(PROMPT="NDC":"12:12",1:"1:40")_"^W:$D(^PSNDF(50.67,PROMPT,X)) !!,""That "_PROMPT_" already exists"",! K:$D(^PSNDF(50.67,PROMPT,X)) X",DIR("A")="Enter a new "_PROMPT_" " D ^DIR K DIR Q:$D(DIRUT)  S NEW=Y
"RTN","PSNACT",45,0)
 .I PROMPT="NDC" D
"RTN","PSNACT",46,0)
 ..S IN=$O(^PSNDF(50.67,DA,2,"B",NEW,0)) I IN S DIR(0)="Y" W !,"Those NDCs are already linked" S DIR("A")="Do you want to unlink them " D ^DIR Q:$D(DIRUT)  Q:'Y
"RTN","PSNACT",47,0)
 ..I IN S DA(1)=DA,DA=IN,DIE="^PSNDF(50.67,"_DA(1)_",2,",DR=".01///@;" D ^DIE W !,"Unlinked",! Q
"RTN","PSNACT",48,0)
 ..I 'IN S DIE="^PSNDF(50.67,",DR="1////"_NEW D ^DIE K DD,DO S DA(1)=DA,DIC="^PSNDF(50.67,"_DA(1)_",2,",DIC(0)="L",DLAYGO=50.67,DIC("P")=$P(^DD(50.67,11,0),"^",2),X=OLD D ^DIC W !,"Linked",! Q
"RTN","PSNACT",49,0)
 .I PROMPT="UPN" D
"RTN","PSNACT",50,0)
 ..S IN=$O(^PSNDF(50.67,DA,3,"B",NEW,0)) I IN S DIR(0)="Y" W !,"Those UPNs are already linked" S DIR("A")="Do you want to unlink them " D ^DIR Q:$D(DIRUT)  Q:'Y
"RTN","PSNACT",51,0)
  ..S DA(1)=DA,DA=IN,DIE="^PSNDF(50.67,"_DA(1)_",3,",DR=".01///@;" D ^DIE W !,"Unlinked",! Q
"RTN","PSNACT",52,0)
 ..I 'IN S DIE="^PSNDF(50.67,",DR="1////"_NEW D ^DIE K DD,DO S DA(1)=DA,DIC="^PSNDF(50.67,"_DA(1)_",3,",DIC(0)="L",DLAYGO=50.67,DIC("P")=$P(^DD(50.67,12,0),"^",2),X=OLD D ^DIC W !,"Linked",! Q
"RTN","PSNACT",53,0)
 G LINK
"RTN","PSNACT",54,0)
 ;
"RTN","PSNACT",55,0)
LISTNDC ;LOOK UP NDCS BY PRODUCT
"RTN","PSNACT",56,0)
 K L,DA,^TMP($J),DIC
"RTN","PSNACT",57,0)
 S DIC=50.68,DIC(0)="AQEMZ",DIC("W")="S PSNTDRUG=Y D GETTIER^PSNACT(PSNTDRUG)" D ^DIC G END:Y<0
"RTN","PSNACT",58,0)
 S IEN=+Y W @IOF D PRINT(IEN) Q:$G(QUIT)  F SIE=0:0 S SIE=$O(^PSNDF(50.68,"ANDC",IEN,SIE)) Q:'SIE!($G(QUIT))  D PRNT ; S ^TMP($J,"A"_$P(^PSNDF(50.67,SIE,0),"^",2)_"^"_SIE)=""
"RTN","PSNACT",59,0)
 Q
"RTN","PSNACT",60,0)
PRT D:($Y+5)>IOSL&('$G(QUIT)) HANG Q:$G(QUIT)  S DA=SIE,DIC="^PSNDF(50.67," W ! D EN^DIQ
"RTN","PSNACT",61,0)
 Q
"RTN","PSNACT",62,0)
 ;
"RTN","PSNACT",63,0)
LISTNDC1 ;LOOK UP PARTIAL NDC
"RTN","PSNACT",64,0)
 ;
"RTN","PSNACT",65,0)
 F  K ^TMP($J) S QUIT=0,DIR(0)="F^1:12",DIR("A")="Select NDC ",DIC("W")="S PSNTDRUG=Y D GETTIER^PSNACT(PSNTDRUG)" D ^DIR Q:$D(DIRUT)  S PSN1=Y,PSN=Y D
"RTN","PSNACT",66,0)
 .I $D(^PSNDF(50.67,"NDC",PSN1)) S DA=0 F  S DA=$O(^PSNDF(50.67,"NDC",PSN1,DA)) S:'DA QUIT=1 Q:QUIT  S DIC="^PSNDF(50.67," W ! D EN^DIQ
"RTN","PSNACT",67,0)
 .Q:QUIT
"RTN","PSNACT",68,0)
 .I PSN1?."0".E S PSN1=PSN1_"/"
"RTN","PSNACT",69,0)
 .I PSN1?.N,PSN1=+PSN1 S PSN1=$$LJ^XLFSTR(PSN1,12,0)-1
"RTN","PSNACT",70,0)
 .S ZCT=0 F  Q:QUIT  S PSN1=$O(^PSNDF(50.67,"NDC",PSN1)),DA=0 Q:$E(PSN1,1,$L(PSN))'=PSN  F  Q:QUIT  S DA=$O(^PSNDF(50.67,"NDC",PSN1,DA)) Q:'DA  S ZCT=ZCT+1,^TMP($J,ZCT)=DA W !,$J(ZCT,5),"  ",PSN1 D
"RTN","PSNACT",71,0)
 ..S MORE=$E($O(^PSNDF(50.67,"NDC",PSN1)),1,$L(PSN))=PSN!$O(^(PSN1,DA)) I ZCT#5&MORE Q
"RTN","PSNACT",72,0)
 ..S DIR(0)="NOA^1:"_ZCT,DIR("A")="Choose 1 - "_ZCT_" or ^ to quit " S:MORE DIR("A")=DIR("A")_"or return to see more "
"RTN","PSNACT",73,0)
 ..D ^DIR I $D(DUOUT)!$D(DTOUT) S QUIT=1 Q
"RTN","PSNACT",74,0)
 ..I Y="" Q
"RTN","PSNACT",75,0)
 ..S DA=^TMP($J,Y),QUIT=1,DIC="^PSNDF(50.67," W !! D EN^DIQ Q
"RTN","PSNACT",76,0)
 G END
"RTN","PSNACT",77,0)
 ;
"RTN","PSNACT",78,0)
PRINT(VAPRDIEN) ; Prints the Va Product field
"RTN","PSNACT",79,0)
 ;Input: VAPRDIEN - Internal Entry Number (IEN) in the VA PRODUCT (#50.68) file
"RTN","PSNACT",80,0)
 ;
"RTN","PSNACT",81,0)
 N QQQ,PSNELIEN,Z0,Z1,Z3,Z5,Z6,Z7,X,PSNELXY,K,ING
"RTN","PSNACT",82,0)
 S Z0=^PSNDF(50.68,VAPRDIEN,0)
"RTN","PSNACT",83,0)
 S Z1=^PSNDF(50.68,VAPRDIEN,1)
"RTN","PSNACT",84,0)
 S Z3=^PSNDF(50.68,VAPRDIEN,3)
"RTN","PSNACT",85,0)
 S Z5=$G(^PSNDF(50.68,VAPRDIEN,5))
"RTN","PSNACT",86,0)
 S Z6=$G(^PSNDF(50.68,VAPRDIEN,6,1,0))
"RTN","PSNACT",87,0)
 S Z7=$G(^PSNDF(50.68,VAPRDIEN,7))
"RTN","PSNACT",88,0)
 S QQQ=$P(Z1,"^",5) D GCN
"RTN","PSNACT",89,0)
 W !,"VA Product Name: ",$P(Z0,"^"),$$DT($P(Z7,"^",3))
"RTN","PSNACT",90,0)
 W !,"VA Generic Name: ",$P(^PSNDF(50.6,+$P(Z0,"^",2),0),"^")
"RTN","PSNACT",91,0)
 D NDOSE(VAPRDIEN)
"RTN","PSNACT",92,0)
 W !,"National Formulary Name: ",$P(Z0,"^",6)
"RTN","PSNACT",93,0)
 W !,"VA Print Name: ",$P(Z1,"^")
"RTN","PSNACT",94,0)
 W !,"VA Product Identifier: ",$P(Z1,"^",2),"  Transmit to CMOP: ",$S($P(Z1,"^",3):"Yes",1:"No"),"  VA Dispense Unit: ",$P($G(^PSNDF(50.64,+$P(Z1,"^",4),0)),"^")
"RTN","PSNACT",95,0)
 W !,"PMIS: ",PMIS,!,"Active Ingredients: "
"RTN","PSNACT",96,0)
 S (K,QUIT)=0 F  S K=$O(^PSNDF(50.68,VAPRDIEN,2,K)) Q:'K  D  Q:$G(QUIT)
"RTN","PSNACT",97,0)
 . S (PSNELXY,X)=^PSNDF(50.68,VAPRDIEN,2,K,0),ING=^PS(50.416,K,0)
"RTN","PSNACT",98,0)
 . S:$P(ING,"^",2) ING=^PS(50.416,$P(ING,"^",2),0)
"RTN","PSNACT",99,0)
 . W ?23,$P(ING,"^"),"  Strength: ",$P(PSNELXY,"^",2)," Units: ",$P($G(^PS(50.607,+$P(PSNELXY,"^",3),0)),"^")
"RTN","PSNACT",100,0)
 . D:($Y+5)>IOSL&'QUIT HANG Q:$G(QUIT)  W !
"RTN","PSNACT",101,0)
 Q:$G(QUIT)
"RTN","PSNACT",102,0)
 W !,"Primary VA Drug Class: ",$P($G(^PS(50.605,+Z3,0),"Unknown"),"^")
"RTN","PSNACT",103,0)
 W !,"Secondary VA Drug Class: "
"RTN","PSNACT",104,0)
 S (K,QUIT)=0 F  S K=$O(^PSNDF(50.68,VAPRDIEN,4,K)) Q:'K  D  Q:$G(QUIT)
"RTN","PSNACT",105,0)
 . W ?26,$P($G(^PS(50.605,+K,0),"Unknown"),"^")
"RTN","PSNACT",106,0)
 . D:($Y+5)>IOSL&'QUIT HANG Q:$G(QUIT)  W !
"RTN","PSNACT",107,0)
 Q:$G(QUIT)
"RTN","PSNACT",108,0)
 D:($Y+5)>IOSL HANG Q:$G(QUIT)
"RTN","PSNACT",109,0)
 W !,"CS Federal Schedule: "_$S($P($G(^PSNDF(50.68,VAPRDIEN,7)),"^")]"":$P(^PSNDF(50.68,VAPRDIEN,7),"^"),1:"") D EXPAN(VAPRDIEN)
"RTN","PSNACT",110,0)
 D:($Y+5)>IOSL HANG Q:$G(QUIT)
"RTN","PSNACT",111,0)
 W !,"National Formulary Indicator: ",$S($P(Z5,"^"):"Yes",1:"No")
"RTN","PSNACT",112,0)
 D:($Y+5)>IOSL HANG Q:$G(QUIT)
"RTN","PSNACT",113,0)
 D FD(VAPRDIEN)  ;ppsn
"RTN","PSNACT",114,0)
 D:($Y+5)>IOSL HANG Q:$G(QUIT)
"RTN","PSNACT",115,0)
 W !,"National Formulary Restriction: ",! D NFIP(VAPRDIEN) Q:$G(QUIT)
"RTN","PSNACT",116,0)
 D:($Y+5)>IOSL HANG Q:$G(QUIT)
"RTN","PSNACT",117,0)
 D FDT(VAPRDIEN)  Q:$G(QUIT)  ;ppsn - formulary designator text
"RTN","PSNACT",118,0)
 D:($Y+5)>IOSL HANG Q:$G(QUIT) 
"RTN","PSNACT",119,0)
 D CPTIER(VAPRDIEN)  ; Copay Tier
"RTN","PSNACT",120,0)
 D:($Y+5)>IOSL HANG Q:$G(QUIT)
"RTN","PSNACT",121,0)
 I $G(^PSNDF(50.68,VAPRDIEN,8)) W !,"Exclude Drg-Drg Interaction Ck: Yes (No check for Drug-Drug Interactions)"
"RTN","PSNACT",122,0)
 D:($Y+5)>IOSL HANG Q:$G(QUIT)
"RTN","PSNACT",123,0)
 D OVEX(VAPRDIEN)
"RTN","PSNACT",124,0)
 D:($Y+5)>IOSL HANG Q:$G(QUIT)
"RTN","PSNACT",125,0)
 D CLEFF^PSNCLEHW(VAPRDIEN,$G(QUIT))
"RTN","PSNACT",126,0)
 D:($Y+5)>IOSL HANG Q:$G(QUIT)
"RTN","PSNACT",127,0)
 D POSDOS(VAPRDIEN)
"RTN","PSNACT",128,0)
 D:($Y+5)>IOSL HANG Q:$G(QUIT)
"RTN","PSNACT",129,0)
 W !,"Maximum Days Supply: ",$$GET1^DIQ(50.68,VAPRDIEN,32)
"RTN","PSNACT",130,0)
 D:($Y+5)>IOSL HANG Q:$G(QUIT)
"RTN","PSNACT",131,0)
 D HAZWASTE^PSNCLEHW(VAPRDIEN)
"RTN","PSNACT",132,0)
 D:($Y+5)>IOSL HANG Q:$G(QUIT)
"RTN","PSNACT",133,0)
 D CODSYS(VAPRDIEN)
"RTN","PSNACT",134,0)
 W ! D HANG
"RTN","PSNACT",135,0)
 Q
"RTN","PSNACT",136,0)
 ;
"RTN","PSNACT",137,0)
CMOP K DIC S DIC="^PSNDF(50.68,",DIC(0)="QEAZ",D="C",DIC("A")="CMOP ID: ",DIC("W")="S PSNTDRUG=Y D GETTIER^PSNACT(PSNTDRUG)" D MIX^DIC1 Q:Y<0  S IEN=+Y D PRINT(IEN) F SIE=0:0 S SIE=$O(^PSNDF(50.68,"ANDC",IEN,SIE)) Q:'SIE  D PRNT
"RTN","PSNACT",138,0)
 Q
"RTN","PSNACT",139,0)
HANG K DIR S DIR(0)="E",DIR("A")="Press return to continue or '^' to exit" D ^DIR W @IOF S $X=0 S:Y'=1 QUIT=1
"RTN","PSNACT",140,0)
 Q
"RTN","PSNACT",141,0)
PRNT D:($Y+5)>IOSL&('$G(QUIT)) HANG Q:$G(QUIT)
"RTN","PSNACT",142,0)
 S NDX=^PSNDF(50.67,SIE,0)
"RTN","PSNACT",143,0)
 W !!,"NDC: ",$P(NDX,"^",2),"  UPN: ",$P(NDX,"^",3),!,"VA Product Name: ",$P(^PSNDF(50.68,$P(NDX,"^",6),0),"^"),!,"Manufacturer: ",$P($G(^PS(55.95,+$P(NDX,"^",4),0)),"^"),"  Trade Name: ",$P(NDX,"^",5),!,"Route: "
"RTN","PSNACT",144,0)
 S SIE1=0 F  S SIE1=$O(^PSNDF(50.67,SIE,1,SIE1)) Q:'SIE1  W $P(^(SIE1,0),"^")
"RTN","PSNACT",145,0)
 W !,"Package Size: ",$P(^PS(50.609,$P(NDX,"^",8),0),"^"),"  Package Type: ",$P(^PS(50.608,$P(NDX,"^",9),0),"^")
"RTN","PSNACT",146,0)
 Q
"RTN","PSNACT",147,0)
PAD S ANS=Y F VV=1:1:3 S VV1=$S(VV=1:6,VV=2:4,VV=3:2) D PAD1
"RTN","PSNACT",148,0)
 S ANS=$P(ANS,"-",1)_$P(ANS,"-",2)_$P(ANS,"-",3) K VV,VV1
"RTN","PSNACT",149,0)
 S ANS=$TR(ANS,"-"),X=ANS
"RTN","PSNACT",150,0)
 Q
"RTN","PSNACT",151,0)
PAD1 I $L($P(ANS,"-",VV))<VV1 S $P(ANS,"-",VV)=$E("0000000",1,VV1-$L($P(ANS,"-",VV)))_$P(ANS,"-",VV)
"RTN","PSNACT",152,0)
 Q
"RTN","PSNACT",153,0)
DT(Y) ;Inactivation Date display
"RTN","PSNACT",154,0)
 X:Y ^DD("DD") Q $S(Y]"":IORVON_" ***INACTIVE: "_Y_" ***"_IORVOFF,1:"")
"RTN","PSNACT",155,0)
 Q
"RTN","PSNACT",156,0)
GCN I QQQ']"" S PMIS="None"
"RTN","PSNACT",157,0)
 I QQQ]"",'$D(^PS(50.623,"B",QQQ)) S PMIS="None"
"RTN","PSNACT",158,0)
 I QQQ]"",$D(^PS(50.623,"B",QQQ)) S MAP=$O(^PS(50.623,"B",QQQ,0)),ENG=$P(^PS(50.623,MAP,0),"^",2),PMIS=$P(^PS(50.621,+ENG,0),"^")
"RTN","PSNACT",159,0)
 Q
"RTN","PSNACT",160,0)
 I QQQ]"",$D(^PS(50.623,"B",QQQ)) S MAP=$O(^PS(50.623,"B",QQQ,0)),ENG=$P(^PS(50.623,MAP,0),"^",2),PMIS=$P(^PS(50.621,+ENG,0),"^")
"RTN","PSNACT",161,0)
 Q
"RTN","PSNACT",162,0)
 ;
"RTN","PSNACT",163,0)
NDOSE(PSNELXXX) ;New Dose Form/Strength/Unit display added with patch PSN*4*169
"RTN","PSNACT",164,0)
 N PSNELSTL,PSNELUNL,PSNELZER
"RTN","PSNACT",165,0)
 S PSNELZER=$G(^PSNDF(50.68,PSNELXXX,0))
"RTN","PSNACT",166,0)
 I '$P(PSNELZER,"^",3) W !,"Dose Form: "
"RTN","PSNACT",167,0)
 I $P(PSNELZER,"^",3) W !,"Dose Form: ",$P($G(^PS(50.606,+$P(PSNELZER,"^",3),0)),"^")_$S($P($G(^PS(50.606,+$P(PSNELZER,"^",3),1)),"^")=1:"  (Exclude from Dosing Cks)",1:"")
"RTN","PSNACT",168,0)
 S PSNELSTL=$L($P(PSNELZER,"^",4))
"RTN","PSNACT",169,0)
 I $P(PSNELZER,"^",5) S PSNELUNL=$L($P($G(^PS(50.607,+$P(PSNELZER,"^",5),0)),"^"))
"RTN","PSNACT",170,0)
 I '$P(PSNELZER,"^",5) S PSNELUNL=0
"RTN","PSNACT",171,0)
 I (PSNELSTL+PSNELUNL)<62 W !,"Strength: ",$P(PSNELZER,"^",4)," Units: ",$S($P(PSNELZER,"^",5):$P($G(^PS(50.607,+$P(PSNELZER,"^",5),0)),"^"),1:"") Q
"RTN","PSNACT",172,0)
 W !,"Strength: ",$P(PSNELZER,"^",4)
"RTN","PSNACT",173,0)
 W !,"Units: " I PSNELUNL<72 W $S($P(PSNELZER,"^",5):$P($G(^PS(50.607,+$P(PSNELZER,"^",5),0)),"^"),1:"") Q
"RTN","PSNACT",174,0)
 W !,"  "_$P($G(^PS(50.607,+$P(PSNELZER,"^",5),0)),"^")
"RTN","PSNACT",175,0)
 Q
"RTN","PSNACT",176,0)
 ;
"RTN","PSNACT",177,0)
OVEX(PSNELORX) ;New Override Dose Form display added with patch PSN*4*169
"RTN","PSNACT",178,0)
 N PSNELDFF
"RTN","PSNACT",179,0)
 W !,"Override DF Exclude from Dosage Checks: "_$S($P($G(^PSNDF(50.68,PSNELORX,9)),"^")=1:"Yes",$P($G(^PSNDF(50.68,PSNELORX,9)),"^")=0:"No",1:"") I $P($G(^PSNDF(50.68,PSNELORX,9)),"^")=1 D
"RTN","PSNACT",180,0)
 .S PSNELDFF=$P($G(^PSNDF(50.68,PSNELORX,0)),"^",3)
"RTN","PSNACT",181,0)
 .I 'PSNELDFF Q
"RTN","PSNACT",182,0)
 .I '$D(^PS(50.606,PSNELDFF,0)) Q
"RTN","PSNACT",183,0)
 .I $P($G(^PS(50.606,PSNELDFF,1)),"^")=1 W " (Dosage Checks shall be performed)" Q
"RTN","PSNACT",184,0)
 .I $P($G(^PS(50.606,PSNELDFF,1)),"^")=0 W " (No dosage checks performed)"
"RTN","PSNACT",185,0)
 Q
"RTN","PSNACT",186,0)
CPTIER(VAPRD) ;
"RTN","PSNACT",187,0)
 ; Input: VAPRD - VA PRODUCT (#50.68) entry IEN
"RTN","PSNACT",188,0)
 N CPDATE,X D NOW^%DTC S CPDATE=X S PSNTIER=$$CPTIER^PSNAPIS(VAPRD,CPDATE,"",1) K CPDATE,X
"RTN","PSNACT",189,0)
 ; PSNTIER = Copay Tier^Effective Date^End Date
"RTN","PSNACT",190,0)
 W !,"Copay Tier: ",$P(PSNTIER,"^",1)
"RTN","PSNACT",191,0)
 W !,"Copay Effective Date: " S Y=$P(PSNTIER,"^",2) D DD^%DT W Y K Y
"RTN","PSNACT",192,0)
 W !
"RTN","PSNACT",193,0)
 Q
"RTN","PSNACT",194,0)
EXPAN(PSNELFZA) ;
"RTN","PSNACT",195,0)
 N PSNELFZB,PSNELFZC
"RTN","PSNACT",196,0)
 I $P($G(^PSNDF(50.68,PSNELFZA,7)),"^")="" Q
"RTN","PSNACT",197,0)
 S PSNELFZB=PSNELFZA_"," S PSNELFZC=$$GET1^DIQ(50.68,PSNELFZB,19)
"RTN","PSNACT",198,0)
 W "  "_$G(PSNELFZC)
"RTN","PSNACT",199,0)
 Q
"RTN","PSNACT",200,0)
NFIP(PSNELFJ) ;
"RTN","PSNACT",201,0)
 N PSNELFJZ,PSNELFJC
"RTN","PSNACT",202,0)
 S PSNELFJC=0
"RTN","PSNACT",203,0)
 F PSNELFJZ=0:0 S PSNELFJZ=$O(^PSNDF(50.68,PSNELFJ,6,PSNELFJZ)) Q:'PSNELFJZ!($G(QUIT))  D
"RTN","PSNACT",204,0)
 .I PSNELFJC W !
"RTN","PSNACT",205,0)
 .W $G(^PSNDF(50.68,PSNELFJ,6,PSNELFJZ,0))
"RTN","PSNACT",206,0)
 .S PSNELFJC=1
"RTN","PSNACT",207,0)
 .D:($Y+5)>IOSL HANG
"RTN","PSNACT",208,0)
 I '$G(QUIT),$G(PSNELFJC) W !
"RTN","PSNACT",209,0)
 Q
"RTN","PSNACT",210,0)
 ;
"RTN","PSNACT",211,0)
POSDOS(VAPRD) ; Dispaly Possible Dosage Auto-Create Setting fields
"RTN","PSNACT",212,0)
 ; Input: VAPRD - VA PRODUCT (#50.68) entry IEN
"RTN","PSNACT",213,0)
 ;
"RTN","PSNACT",214,0)
 N POSDOS Q:'$G(VAPRD)
"RTN","PSNACT",215,0)
 S POSDOS=$$POSDOS^PSNAPIS(VAPRD)
"RTN","PSNACT",216,0)
 W !!,"Auto-Create Default Possible Dosage? ",$S($P(POSDOS,"^")="Y":"Yes",1:"No")
"RTN","PSNACT",217,0)
 I $P(POSDOS,"^")="N" D
"RTN","PSNACT",218,0)
 . W !,"    Possible Dosages To Auto-Create: ",$S($P(POSDOS,"^",2)="N":"No Possible Dosages",$P(POSDOS,"^",2)="O":"1x Possible Dosage",$P(POSDOS,"^",2)="B":"1x and 2x Possible Dosages",1:"")
"RTN","PSNACT",219,0)
 . I ($P(POSDOS,"^",2)'="N") D
"RTN","PSNACT",220,0)
 . . W !,"                            Package: ",$S($P(POSDOS,"^",3)="O":"Outpatient",$P(POSDOS,"^",3)="I":"Inpatient",$P(POSDOS,"^",3)="IO":"Both Inpatient and Outpatient",1:"")
"RTN","PSNACT",221,0)
 Q
"RTN","PSNACT",222,0)
 ;
"RTN","PSNACT",223,0)
CODSYS(PSNCIEN) ;CODING SYSTEM
"RTN","PSNACT",224,0)
 N I,J,PSNCODX,PSNCODJ,PSNRXCUI S PSNCODX=0
"RTN","PSNACT",225,0)
 F I=1:1 S PSNCODX=$O(^PSNDF(50.68,PSNCIEN,11,PSNCODX)) Q:PSNCODX="B"!(PSNCODX="")  D
"RTN","PSNACT",226,0)
 . S PSNRXCUI=$G(^PSNDF(50.68,PSNCIEN,11,PSNCODX,0)) Q:PSNRXCUI'="RxNorm"
"RTN","PSNACT",227,0)
 . W !!,"Coding System: ",$P(^PSNDF(50.68,PSNCIEN,11,PSNCODX,0),"^",1) S PSNCODJ=0
"RTN","PSNACT",228,0)
 . F J=1:1 S PSNCODJ=$O(^PSNDF(50.68,PSNCIEN,11,PSNCODX,1,PSNCODJ)) Q:PSNCODJ="B"!(PSNCODJ="")  D
"RTN","PSNACT",229,0)
 .. W !,"Code: ",$P(^PSNDF(50.68,PSNCIEN,11,PSNCODX,1,PSNCODJ,0),"^",1)
"RTN","PSNACT",230,0)
 W !
"RTN","PSNACT",231,0)
 Q
"RTN","PSNACT",232,0)
 ;
"RTN","PSNACT",233,0)
GETTIERN(PSNCTNDC) ;Get copay tier by NDC; called by DIC to get copay tier for today's date 
"RTN","PSNACT",234,0)
 N CPDATE,X,PSSCP,VAPID,VAPNAM,PSNINACT,PSNCONVD,PSNFD
"RTN","PSNACT",235,0)
 D NOW^%DTC S CPDATE=$P(%,".")
"RTN","PSNACT",236,0)
 S VAPID=$$GET1^DIQ(50.67,PSNCTNDC,5,"I")
"RTN","PSNACT",237,0)
 I PROMPT="UPN"!(PROMPT="NDC") S VAPNAM=$$GET1^DIQ(50.68,VAPID,.01) W "  ",VAPNAM
"RTN","PSNACT",238,0)
 S PSNFD=$$GET1^DIQ(50.68,VAPID,109)
"RTN","PSNACT",239,0)
 W:PSNFD'="" " "_PSNFD
"RTN","PSNACT",240,0)
 S PSSCP=$$CPTIER^PSNAPIS(VAPID,CPDATE) K CPDATE,X
"RTN","PSNACT",241,0)
 I $P(PSSCP,"^")'="" W "  Tier ",$P(PSSCP,"^")
"RTN","PSNACT",242,0)
 S PSNINACT=$$GET1^DIQ(50.67,PSNCTNDC,7,"I")  ;inactive date
"RTN","PSNACT",243,0)
 S:$G(PSNINACT) PSNCONVD=$$DATE^PSNLOOK(PSNINACT)
"RTN","PSNACT",244,0)
 W:$G(PSNCONVD)'="" "  "_PSNCONVD
"RTN","PSNACT",245,0)
 Q
"RTN","PSNACT",246,0)
 ;
"RTN","PSNACT",247,0)
GETTIER(PSNTDRUG) ;called by DIC; look up copay tier by va product for the current date 
"RTN","PSNACT",248,0)
 N CPDATE,X,PSSCP,PSNINACT,PSNCONVD,PSNFD
"RTN","PSNACT",249,0)
 S PSNFD=$$GET1^DIQ(50.68,PSNTDRUG,109)
"RTN","PSNACT",250,0)
 W:PSNFD'="" " "_PSNFD
"RTN","PSNACT",251,0)
 D NOW^%DTC S CPDATE=$P(%,".")
"RTN","PSNACT",252,0)
 S PSSCP=$$CPTIER^PSNAPIS(PSNTDRUG,CPDATE,"",1) K CPDATE,X
"RTN","PSNACT",253,0)
 I $P(PSSCP,"^")'="" W " Tier ",$P(PSSCP,"^")
"RTN","PSNACT",254,0)
 S PSNINACT=$$GET1^DIQ(50.68,PSNTDRUG,21,"I")  ;inactive date
"RTN","PSNACT",255,0)
 S:$G(PSNINACT) PSNCONVD=$$DATE^PSNLOOK(PSNINACT)
"RTN","PSNACT",256,0)
 W:$G(PSNCONVD)'="" "  "_PSNCONVD
"RTN","PSNACT",257,0)
 Q
"RTN","PSNACT",258,0)
 ;
"RTN","PSNACT",259,0)
FD(PSNELFJ) ;DBIA #6754
"RTN","PSNACT",260,0)
 N PSSFD
"RTN","PSNACT",261,0)
 S PSSFD="",PSSFD=$$GET1^DIQ(50.68,PSNELFJ,109)  ;ppsn
"RTN","PSNACT",262,0)
 W:PSSFD'="" !,"Formulary Designator: "_PSSFD
"RTN","PSNACT",263,0)
 Q
"RTN","PSNACT",264,0)
 ;
"RTN","PSNACT",265,0)
FDR(PSNELFJ) ;DBIA #6754
"RTN","PSNACT",266,0)
 N PSNFD
"RTN","PSNACT",267,0)
 S PSNFD="",PSNFD=$$GET1^DIQ(50.68,PSNELFJ,109)  ;ppsn
"RTN","PSNACT",268,0)
 Q PSNFD
"RTN","PSNACT",269,0)
 ;
"RTN","PSNACT",270,0)
FDT(PSNELFJ) ;DBIA #6754
"RTN","PSNACT",271,0)
 N PSNFDTXT S PSNFDTXT=0 Q:'$O(^PSNDF(50.68,PSNELFJ,5.1,PSNFDTXT))
"RTN","PSNACT",272,0)
 N X,DIWL,DIWR,DIWF,PSNJ,PSNDND,FDTCNT,FDTCNT2,PSNTEXT
"RTN","PSNACT",273,0)
 K ^UTILITY($J,"W")
"RTN","PSNACT",274,0)
 S (PSNDND,PSNJ)=0,PSNTEXT=""
"RTN","PSNACT",275,0)
 F  S PSNJ=$O(^PSNDF(50.68,PSNELFJ,5.1,PSNJ)) Q:PSNJ=""  D
"RTN","PSNACT",276,0)
 .S PSNDND=$G(^PSNDF(50.68,PSNELFJ,5.1,PSNJ,0)) I $TR(PSNDND," ")'="" S PSNTEXT=1
"RTN","PSNACT",277,0)
 Q:'PSNTEXT
"RTN","PSNACT",278,0)
 S DIWL=15,DIWR=79,(PSNDND,PSNJ)=0,FDTCNT2=1
"RTN","PSNACT",279,0)
 F  S PSNJ=$O(^PSNDF(50.68,PSNELFJ,5.1,PSNJ)) Q:PSNJ=""  D
"RTN","PSNACT",280,0)
 .S PSNDND=$G(^PSNDF(50.68,PSNELFJ,5.1,PSNJ,0))
"RTN","PSNACT",281,0)
 .S X=PSNDND D ^DIWP
"RTN","PSNACT",282,0)
 ;
"RTN","PSNACT",283,0)
 S FDTCNT=0 F FDTCNT=0:0 S FDTCNT=$O(^UTILITY($J,"W",DIWL,FDTCNT)) Q:'FDTCNT  D
"RTN","PSNACT",284,0)
 .I FDTCNT2=1 W !,"Product Text: "
"RTN","PSNACT",285,0)
 .I FDTCNT2>1 W !,"              "
"RTN","PSNACT",286,0)
 .W $G(^UTILITY($J,"W",DIWL,FDTCNT,0)) S FDTCNT2=2
"RTN","PSNACT",287,0)
 K ^UTILITY($J,"W")
"RTN","PSNACT",288,0)
 Q
"RTN","PSNACT",289,0)
 ;
"RTN","PSNCLEHW")
0^13^B12524464^n/a
"RTN","PSNCLEHW",1,0)
PSNCLEHW ;BIR/LE-CLINICAL EFFECTS & HAZARDOUS WASTE DISPLAY ; 07/02/03 14:01
"RTN","PSNCLEHW",2,0)
 ;;4.0;NATIONAL DRUG FILE;**396**; 30 Oct 98;Build 190
"RTN","PSNCLEHW",3,0)
 ;
"RTN","PSNCLEHW",4,0)
 Q
"RTN","PSNCLEHW",5,0)
 ;
"RTN","PSNCLEHW",6,0)
 ;This routine is called by PSNLOOK, PSNACT and PSNDRDOS routes for display 
"RTN","PSNCLEHW",7,0)
 ;of hazardous waste and clinical effects fields
"RTN","PSNCLEHW",8,0)
 ;
"RTN","PSNCLEHW",9,0)
CLEFF(VAPRD,QUIT) ;Display Clinical Effects fields
"RTN","PSNCLEHW",10,0)
 ;Input: VAPRD - VA PRODUCT (#50.68) IEN
"RTN","PSNCLEHW",11,0)
 I '$G(QUIT) S QUIT=0
"RTN","PSNCLEHW",12,0)
 Q:QUIT QUIT
"RTN","PSNCLEHW",13,0)
 N X,Y,II,III,PSNPKG,PSNPKG2,PSNOMIT,PSNEXLMT,PSNCLEF,PSNCLEFA,QUIT,PSNHWQT
"RTN","PSNCLEHW",14,0)
 D GETS^DIQ(50.68,VAPRD_",","108*","EI","PSNCLEFA")
"RTN","PSNCLEHW",15,0)
 W !!,"CLINICAL EFFECT DURATION: ",$S($D(PSNCLEFA):"YES",1:"NO")
"RTN","PSNCLEHW",16,0)
 Q:'$D(PSNCLEFA)
"RTN","PSNCLEHW",17,0)
 S (II,III,QUIT)=0
"RTN","PSNCLEHW",18,0)
 F  S II=$O(PSNCLEFA(50.68108,II)) Q:II=""  F  S III=$O(PSNCLEFA(50.68108,II,III)) Q:III=""  D
"RTN","PSNCLEHW",19,0)
 .S PSNPKG=$G(PSNCLEFA(50.68108,II,.01,"I")),PSNOMIT=$G(PSNCLEFA(50.68108,II,1,"E"))
"RTN","PSNCLEHW",20,0)
 .S PSNEXLMT=$G(PSNCLEFA(50.68108,II,2,"E")) S:PSNPKG'="" PSNCLEF(PSNPKG)=PSNOMIT_"^"_PSNEXLMT
"RTN","PSNCLEHW",21,0)
 ;If package IO is defined only show it, otherwise show all packages
"RTN","PSNCLEHW",22,0)
 I $D(PSNCLEF("IO")) S PSNPKG="IO" D CLEFFS,CLEFFW(PSNPKG,PSNOMIT,PSNEXLMT) Q QUIT
"RTN","PSNCLEHW",23,0)
 S PSNPKG="" F  S PSNPKG=$O(PSNCLEF(PSNPKG)) Q:PSNPKG=""  D  Q:QUIT
"RTN","PSNCLEHW",24,0)
 .D CLEFFS,CLEFFW(PSNPKG,PSNOMIT,PSNEXLMT)  S:QUIT PSNHWQT=1
"RTN","PSNCLEHW",25,0)
 Q QUIT
"RTN","PSNCLEHW",26,0)
 ;
"RTN","PSNCLEHW",27,0)
CLEFFS ;
"RTN","PSNCLEHW",28,0)
 S (PSNOMIT,PSNEXLMT)="",PSNOMIT=$P(PSNCLEF(PSNPKG),"^"),PSNEXLMT=$P(PSNCLEF(PSNPKG),"^",2)
"RTN","PSNCLEHW",29,0)
 Q
"RTN","PSNCLEHW",30,0)
 ;
"RTN","PSNCLEHW",31,0)
CLEFFW(PSNPKG,PSNOMIT,PSNEXLMT) ;
"RTN","PSNCLEHW",32,0)
 N PSNPACK2 S PSNPACK2=""
"RTN","PSNCLEHW",33,0)
 S PSNPACK2=$S(PSNPKG="I":"INPATIENT",PSNPKG="O":"OUTPATIENT",PSNPKG="IO":"BOTH INPATIENT AND OUTPATIENT",1:"")
"RTN","PSNCLEHW",34,0)
 W !?3,PSNPACK2," DURATION LIMIT: " W:PSNOMIT="NO" PSNEXLMT W !?6,"OMIT EXP/DC ORDER CHECK: ",PSNOMIT
"RTN","PSNCLEHW",35,0)
 D:($Y+5)>IOSL HANG
"RTN","PSNCLEHW",36,0)
 Q
"RTN","PSNCLEHW",37,0)
 ;
"RTN","PSNCLEHW",38,0)
HAZWASTE(VAPRD,QUIT) ;Display Hazardous Waste fields
"RTN","PSNCLEHW",39,0)
 ;Input: VAPRD - VA PRODUCT (#50.68) IEN
"RTN","PSNCLEHW",40,0)
 ;returns PSNHWAT = 1 for quit or 0 don't quit.
"RTN","PSNCLEHW",41,0)
 I '$G(QUIT) S QUIT=0
"RTN","PSNCLEHW",42,0)
 Q:QUIT QUIT
"RTN","PSNCLEHW",43,0)
 N HAZARY,HAZHTDX,PSNHWQT
"RTN","PSNCLEHW",44,0)
 W !
"RTN","PSNCLEHW",45,0)
 D:($Y+5)>IOSL HANG G END:QUIT
"RTN","PSNCLEHW",46,0)
 D GETS^DIQ(50.68,VAPRD_",","101;102;103;104;105","EI","HAZARY")
"RTN","PSNCLEHW",47,0)
 S HAZHTDX=0
"RTN","PSNCLEHW",48,0)
 I $G(HAZARY(50.68,VAPRD_",",102,"I"))=1 S HAZHTDX=1
"RTN","PSNCLEHW",49,0)
 W:$G(HAZARY(50.68,VAPRD_",",101,"E"))'="" !,"Hazardous to Handle: ",HAZARY(50.68,VAPRD_",",101,"E")
"RTN","PSNCLEHW",50,0)
 D:($Y+5)>IOSL HANG G END:QUIT
"RTN","PSNCLEHW",51,0)
 W:$G(HAZARY(50.68,VAPRD_",",102,"E"))'="" !,"Hazardous to Dispose: ",HAZARY(50.68,VAPRD_",",102,"E")
"RTN","PSNCLEHW",52,0)
 D:($Y+5)>IOSL HANG G END:QUIT
"RTN","PSNCLEHW",53,0)
 W:$G(HAZARY(50.68,VAPRD_",",103,"E"))'=""&(HAZHTDX) !,"        Primary EPA Code: ",HAZARY(50.68,VAPRD_",",103,"E")
"RTN","PSNCLEHW",54,0)
 D:($Y+5)>IOSL HANG G END:QUIT
"RTN","PSNCLEHW",55,0)
 W:$G(HAZARY(50.68,VAPRD_",",104,"E"))'=""&(HAZHTDX) !,"         Waste Sort Code: ",HAZARY(50.68,VAPRD_",",104,"E")
"RTN","PSNCLEHW",56,0)
 I QUIT S PSNHWQT=1 G END:QUIT
"RTN","PSNCLEHW",57,0)
 N HAZWCNT,HAZWCNT2,X,DIWL,DIWR,DIWF
"RTN","PSNCLEHW",58,0)
 K ^UTILITY($J,"W")
"RTN","PSNCLEHW",59,0)
 S HAZWCNT2=1,HAZWCNT=0,DIWL=1,DIWR=50
"RTN","PSNCLEHW",60,0)
 F  S HAZWCNT=$O(HAZARY(50.68,VAPRD_",",105,HAZWCNT)) Q:'HAZWCNT  D
"RTN","PSNCLEHW",61,0)
 . S X="",X=HAZARY(50.68,VAPRD_",",105,HAZWCNT) D ^DIWP
"RTN","PSNCLEHW",62,0)
 S HAZWCNT=0 F HAZWCNT=0:0 S HAZWCNT=$O(^UTILITY($J,"W",DIWL,HAZWCNT)) Q:'HAZWCNT  D
"RTN","PSNCLEHW",63,0)
 .I HAZWCNT2=1 W !,"       DOT Shipping Name: "
"RTN","PSNCLEHW",64,0)
 .I HAZWCNT2>1 W !,"                          "
"RTN","PSNCLEHW",65,0)
 .W $G(^UTILITY($J,"W",DIWL,HAZWCNT,0)) S HAZWCNT2=2
"RTN","PSNCLEHW",66,0)
 K ^UTILITY($J,"W")
"RTN","PSNCLEHW",67,0)
 ;W:$G(HAZARY(50.68,VAPRD_",",105,"E"))'=""&(HAZHTDX) !,"       DOT Shipping Name: ",HAZARY(50.68,VAPRD_",",105,"E")
"RTN","PSNCLEHW",68,0)
 W !
"RTN","PSNCLEHW",69,0)
 K HAZARY,HAZHTDX
"RTN","PSNCLEHW",70,0)
END ;
"RTN","PSNCLEHW",71,0)
 Q QUIT
"RTN","PSNCLEHW",72,0)
 ;
"RTN","PSNCLEHW",73,0)
HANG K DIR S DIR(0)="E",DIR("A")="Press return to continue or '^' to exit" D ^DIR W @IOF S $X=0 S:Y'=1 QUIT=1
"RTN","PSNCLEHW",74,0)
 Q
"RTN","PSNDRUG")
0^16^B15993340^B15442388
"RTN","PSNDRUG",1,0)
PSNDRUG ;BIR/CCH&WRT-Allows user to reset one or several drug matches ; 12/10/98 13:09
"RTN","PSNDRUG",2,0)
 ;;4.0;NATIONAL DRUG FILE;**2,3,33,396**; 30 Oct 98;Build 190
"RTN","PSNDRUG",3,0)
 ;
"RTN","PSNDRUG",4,0)
 ;Reference to EN1^PSSUTIL supported by DBIA #3107
"RTN","PSNDRUG",5,0)
 ;Reference to ^PSDRUG supported by DBIAs #221 and #2352
"RTN","PSNDRUG",6,0)
 ;Reference to ^PS(59.7 supported by DBIA #2613
"RTN","PSNDRUG",7,0)
 S PSNFL=0 D EXPLN F PSNMM=1:1 D START S:'$D(PSNFL) PSNFL=0 Q:PSNFL
"RTN","PSNDRUG",8,0)
DONE W !!,"Remember, these matches must be verified using the options ""Verify Matches"" or",!,"""Verify Single Match"" and then be merged using the option ""Merge National Drug File",!,"Data Into Local File"".",!
"RTN","PSNDRUG",9,0)
 K PSNMM,PSNFL,X,Y,PSNB,PSNDEA,PSNINACT D KILL Q
"RTN","PSNDRUG",10,0)
EXPLN W !!,"Enter name of drug from your local drug file and a match",!,"with the National Drug File will be attempted. ",!,"Press return at the ""Select DRUG GENERIC NAME: "" prompt to exit.",! Q
"RTN","PSNDRUG",11,0)
START D KILL S DIC="^PSDRUG(",DIC(0)="QEAM",DIC("W")="S PSNTDRUG=Y D GETTIER^PSNLOOK(PSNTDRUG)" D ^DIC K DIC I Y<0 S PSNFL=1 Q
"RTN","PSNDRUG",12,0)
 S (PSNB,PSNDRG)=+Y,PSNLOC=$P(Y,"^",2) D CR^PSNHELP
"RTN","PSNDRUG",13,0)
DTE S DATE=$G(^PSDRUG(PSNB,"I")) I DATE,DATE>DT S %=0 W !,"This drug has an Inactivation date in the future. Do you want to continue" D YN^DICN G:%=0 DTE0 Q:%=2  Q:%<0
"RTN","PSNDRUG",14,0)
 I DATE,DATE<DT W !!,"This drug is ""Inactive"". Please try again.",! Q
"RTN","PSNDRUG",15,0)
 I $D(^PSDRUG(PSNB,3)),$P(^PSDRUG(PSNB,3),"^",1)=1,'$D(^XUSEC("PSNMGR",DUZ)) W !,"You cannot rematch this entry. It is marked to transmit to CMOP.",!,"You do not have the ""PSNMGR"" key.",! Q
"RTN","PSNDRUG",16,0)
 S PSNSAVEY=$G(Y) I $P(^PS(59.7,1,10),"^",3)=1,'$D(^PSDRUG(PSNB,"ND")) S X="PSSUTIL" X ^%ZOSF("TEST") I  D EN1^PSSUTIL(PSNB,0)
"RTN","PSNDRUG",17,0)
 S Y=$G(PSNSAVEY) K PSNSAVEY
"RTN","PSNDRUG",18,0)
 I $P(^PS(59.7,1,10),"^",3)=1,$D(^PSDRUG(+Y,"ND")) G REMTCH^PSNHELP
"RTN","PSNDRUG",19,0)
MATCH Q:'$D(^PSDRUG(PSNB,0))  Q:$P(^PSDRUG(PSNB,0),"^",1)']""
"RTN","PSNDRUG",20,0)
 I $D(^PSDRUG(PSNB,"ND")),$P(^PSDRUG(PSNB,"ND"),"^",2)]"" Q
"RTN","PSNDRUG",21,0)
 I $D(PSNFLB),$D(^PSNTRAN(PSNB,0)) Q
"RTN","PSNDRUG",22,0)
 D KILL^PSNHIT,^PSNDEA Q:$D(PSNINACT)  Q:'$D(PSNDEA)  K PSNDEA
"RTN","PSNDRUG",23,0)
 I $P(^PS(59.7,1,10),"^",3)=1 K:$D(^PSNTRAN(PSNB,0)) ^PSNTRAN(PSNB,0) D NAM^PSNCOMP Q
"RTN","PSNDRUG",24,0)
 Q
"RTN","PSNDRUG",25,0)
KILL K ANS,PSNDA,PSNUNDA,PSNDDA,PSNSTDA,DIC,FF,KK,NBR,PSNANS,PSNCLASS,PSNDRG,PSNSZ,PSNFNM,PSNFORM,PSNLOC,PSNNDF,PSNNEW,PSNOLD,PSNPST,PSNSIZE,PSNSIZE,NDP,PS,PT,DOS,STR,UNT,VV,VV1,PSNTYPE,PSNPD
"RTN","PSNDRUG",26,0)
 K PSNNAM,PSNNAME,PSNTRFL,PSNTYP,PSNVAR,VAR,STOP,PSND,PSNDFM,PSNVC,PSNVCL,JJ,MJL,PSNODE,PSNOU,PSNSZE,PSNTPE,PSNENT,PSNF,PSNM,^TMP($J,"PSNND"),ASC,PSNRAN,PSNV,PSNWR,PSNX,PSNZ,WRT,BB,END,LIST,^TMP($J,"PSNPSPT"),^TMP($J,"PSNDFPK")
"RTN","PSNDRUG",27,0)
 K CODE,DA,DATE,DIR,EEE,FFF,FL,GGG,IEN,J,K,NO31,NOM31,NOMSYN,DUNCE,PP,PSNARY,PSNIEN,PSNP,PTPS,QQ,RR,ST,TT,TTT,WR,XX,XXX,Y,ZXZX,PPQ,PPR,^TMP($J,"PSNND"),^TMP($J,"PSNDF1"),^TMP($J,"PSNPSPS"),PSNUP,PSNINQ Q
"RTN","PSNDRUG",28,0)
DTE0 W !,"Answer yes or no" G DTE
"RTN","PSNDRUG",29,0)
GONE K DUNCE,TT,DIRUT,TTT,PPQ,PSNDRG,PSNLOC,PSNNAM,PSNODE,PSNOU,PSNP,NO31,NOM31,NOMSYN Q
"RTN","PSNHIT")
0^14^B27416707^B26995302
"RTN","PSNHIT",1,0)
PSNHIT ;BIR/CCH&WRT-After match is made package size and type selected ; 02/08/00 8:41
"RTN","PSNHIT",2,0)
 ;;4.0;NATIONAL DRUG FILE;**22,47,65,492,396**; 30 Oct 98;Build 190
"RTN","PSNHIT",3,0)
 ;
"RTN","PSNHIT",4,0)
 ;Reference to ^DIC(51.5 supported by DBIA #1931
"RTN","PSNHIT",5,0)
 ;Reference to ^PSDRUG supported by DBIA #2352,#221
"RTN","PSNHIT",6,0)
 ;
"RTN","PSNHIT",7,0)
 S ASC="Enter your choice or press return to continue: "
"RTN","PSNHIT",8,0)
HIT W !!,"Match made with ",PSNLOC W:$P(^PSDRUG(PSNB,0),"^",9)=1 ?62,"N/F" W !,"  Now select VA Product Name ",!
"RTN","PSNHIT",9,0)
 S PSNFL=0
"RTN","PSNHIT",10,0)
FORM K ANS,LIST,DA S DA=PSNDA,X=$$VAP^PSNAPIS(DA,.LIST),STOP=X D STAR0,STAR F PSNWR=0:0 S PSNWR=$O(^TMP($J,"PSNND",PSNWR)) Q:'PSNWR
"RTN","PSNHIT",11,0)
WRTIT F BB=1:1:STOP D EXTD D  I BB#10=0,STOP'=10 W !!,ASC R ANS:DTIME S:'$T ANS="^" S:ANS="^" PSNFL=1 Q:PSNFL  Q:ANS]""
"RTN","PSNHIT",12,0)
 .W !,BB," ",$P(^TMP($J,"PSNND",BB),"^",1)_"    "_$P(^TMP($J,"PSNND",BB),"^",3)_"  "_$P(^TMP($J,"PSNND",BB),"^",4)_"  "_CMID_"  "_$S($P(^TMP($J,"PSNND",BB),"^",6)="I":"**INACTIVE**",1:"")
"RTN","PSNHIT",13,0)
 .W "  "_$$GET1^DIQ(50.68,$P(^TMP($J,"PSNND",BB),"^",2),109)  ;PPSN
"RTN","PSNHIT",14,0)
 .W "  "_$P(^TMP($J,"PSNND",BB),"^",7)   ; PSN*4*492 FMCT
"RTN","PSNHIT",15,0)
 I $D(ANS),ANS?.E1C.E G FORM
"RTN","PSNHIT",16,0)
 I $D(ANS),ANS["?" D HIT1^PSNHELP K ANS G FORM
"RTN","PSNHIT",17,0)
 Q:PSNFL  I $D(ANS),ANS']"" K ANS
"RTN","PSNHIT",18,0)
 I $D(ANS),ANS?.E1C.E G FORM
"RTN","PSNHIT",19,0)
VAPN I '$D(ANS) S:$D(XRT0) XRTN=$T(+0) D:$D(XRT0) T1^%ZOSV R !!,"Enter your choice: ",ANS:DTIME S:'$T ANS="^" S:ANS["^" PSNFL=1 Q:PSNFL
"RTN","PSNHIT",20,0)
 I ANS?.E1C.E K ANS G VAPN
"RTN","PSNHIT",21,0)
 I $D(ANS),ANS["?" D NDC3^PSNHELP W !!,"Match local drug  ",PSNNAM," with " W !,?40,"ORDER UNIT: " I $D(PSNODE),$D(PSNOU),$D(^DIC(51.5)) W ?52,$S('$D(^DIC(51.5,PSNOU)):"",1:$P(^DIC(51.5,PSNOU,0),"^",1))
"RTN","PSNHIT",22,0)
 I $D(ANS),ANS["?" K ANS W !,?24,"DISPENSE UNITS/ORDER UNITS: ",$S('$D(PSNODE):"",1:$P(PSNODE,"^",5)),!,?37,"DISPENSE UNIT: ",$S('$D(PSNODE):"",1:$P(PSNODE,"^",8)),!,?5 G FORM
"RTN","PSNHIT",23,0)
 I $D(ANS),ANS']"" G TRY3^PSNCOMP
"RTN","PSNHIT",24,0)
 I $D(ANS),'$D(^TMP($J,"PSNND",ANS)) W !!,"Invalid answer",! K ANS G FORM
"RTN","PSNHIT",25,0)
 S (PSNFNM,KK)=$P(^TMP($J,"PSNND",ANS),"^",2)
"RTN","PSNHIT",26,0)
RESP R !,?10,"Is this a match  < Reply Y, N or press return to continue > :  ",ANS:DTIME S:'$T ANS="^" W ! I ANS']"" K ANS,PSNFORM G PUNT^PSNCOMP
"RTN","PSNHIT",27,0)
 I ANS?.E1C.E G RESP
"RTN","PSNHIT",28,0)
 I "Nn"[$E(ANS),'X K ANS,PSNFORM G PUNT^PSNCOMP
"RTN","PSNHIT",29,0)
 I "Nn"[$E(ANS) K ANS,PSNFORM G FORM
"RTN","PSNHIT",30,0)
 I ANS["^" S PSNFL=1 Q
"RTN","PSNHIT",31,0)
 I ANS["?" D RES1^PSNHELP K ANS G RESP
"RTN","PSNHIT",32,0)
 I "YyNn"'[$E(ANS) W !," Invalid Response " G RESP
"RTN","PSNHIT",33,0)
 I $P(LIST(KK),"^",7)="I" W !,"Inactive VA Product entry has been selected!!",!! G FORM
"RTN","PSNHIT",34,0)
 S PSNCLASS=$P(^PSNDF(50.68,PSNFNM,3),"^"),PSNNDF=PSNDA S PSNVAR="BLDIT^PSNCOMP" D ^PSNSTCK I $D(PSNFL) Q:PSNFL
"RTN","PSNHIT",35,0)
 Q:'$D(ANS)  I "NOno"[ANS K ANS Q
"RTN","PSNHIT",36,0)
SET S:'$D(^PSNTRAN(PSNB,0)) $P(^PSNTRAN(0),"^",4)=($P(^PSNTRAN(0),"^",4))+1,$P(^PSNTRAN(0),"^",3)=PSNB
"RTN","PSNHIT",37,0)
 S ^PSNTRAN(PSNB,0)=PSNNDF_"^"_PSNFNM_"^"_PSNCLASS_"^^"_PSNSIZE_"^^"_PSNTYPE_"^"_DUZ D PKI W:$D(IOF) @IOF S:'$D(PSNFL) PSNFL=0 Q
"RTN","PSNHIT",38,0)
PRA ; PRINT DOSE FORM AND CLASS AFTER VA PRODUCT NAME IF A DUPLICATE
"RTN","PSNHIT",39,0)
 ; S PSNDFM=$P(^PSNDF(PSNDA,2,$P(^PSNDF(PSNDA,5,KK,0),"^",2),0),"^",1),PSND=$P(^PS(50.606,PSNDFM,0),"^",1)
"RTN","PSNHIT",40,0)
 ; S PSNVCL=$P(^PSNDF(PSNDA,2,$P(^PSNDF(PSNDA,5,KK,0),"^",2),0),"^",3),PSNVC=$P(^PS(50.605,PSNVCL,0),"^",1) W "     ",PSND,"  ",PSNVC S PSNF=0 Q
"RTN","PSNHIT",41,0)
 ; W "     ",PSND,"  ",PSNVC S PSNF=0 Q
"RTN","PSNHIT",42,0)
 Q
"RTN","PSNHIT",43,0)
OOPS W !!,"No match found" S ^PSNTRAN(PSNB,0)="0^^^^^^^"_DUZ Q
"RTN","PSNHIT",44,0)
 Q
"RTN","PSNHIT",45,0)
 Q
"RTN","PSNHIT",46,0)
STAR K ^TMP($J,"PSNND") S PSNRAN=0 S PSNM="" F WRT=0:0 S PSNM=$O(^TMP($J,"PSNDF1",PSNM)) Q:PSNM=""  D SETARY1
"RTN","PSNHIT",47,0)
 Q
"RTN","PSNHIT",48,0)
SETARY1 S CID=" " F KK=0:0 S KK=$O(^TMP($J,"PSNDF1",PSNM,KK)) Q:'KK  S CID=$P($G(^PSNDF(50.68,KK,1)),"^",2) D ARRAY
"RTN","PSNHIT",49,0)
 Q
"RTN","PSNHIT",50,0)
ARRAY S PSNRAN=PSNRAN+1 S ^TMP($J,"PSNND",PSNRAN)=PSNM_"^"_KK_"^"_$P(LIST(KK),"^",4)_"^"_$P(LIST(KK),"^",6)_"^"_CID_"^"_$P(LIST(KK),"^",7)_"^"_$S($P(LIST(KK),"^",8)="Tier ":"",1:$P(LIST(KK),"^",8))
"RTN","PSNHIT",51,0)
 Q
"RTN","PSNHIT",52,0)
KILL K ANS,IFN,PSNDA,PSNDDA,PSNUNDA,PSNSTDA,DIC,II,MJL,JJ,NBR,PSNCLASS,PSNFL,PSNFNM,PSNFORM,PSNNAM,PSNNAME,DOS,NDP,PS,PT,STR,UNT,VV,VV1,PSNNDC,PSNNDF,PSNSP,PSNSIZE,PSNTYPE,PSNVAR,PSNSZ,PSNTRFL,PSNTYP,X,Y,PSNSZE
"RTN","PSNHIT",53,0)
 K PSNTPE,PSNODE,PSNOU,VADC,PSNLOC,^TMP($J,"PSNND"),ASC,PSNRAN,PSNV,PSNWR,PSNX,PSNZ,WRT,BB,END,LIST,IEN,^TMP($J,"PSNDF1") Q
"RTN","PSNHIT",54,0)
STAR0 K ^TMP($J,"PSNDF1") F IEN=0:0 S IEN=$O(LIST(IEN)) Q:'IEN  S ^TMP($J,"PSNDF1",$P(LIST(IEN),"^",2),IEN)=""
"RTN","PSNHIT",55,0)
 Q
"RTN","PSNHIT",56,0)
ASKIT D PKSIZE^PSNOUT,PKTYPE^PSNOUT W !!,"Local drug ",$P(^PSDRUG(PSNB,0),"^"),!,"matches ",?11,PSNFORM,!,"PACKAGE SIZE: ",PSNSZE,!,"PACKAGE TYPE: ",PSNTPE
"RTN","PSNHIT",57,0)
 W !?10,"Is this a match ?" K DIR S DIR("B")="YES",DIR(0)="Y" D ^DIR Q:$D(DIRUT)
"RTN","PSNHIT",58,0)
 I Y(0)="NO" Q
"RTN","PSNHIT",59,0)
 I Y(0)="YES" D SET^PSNHIT
"RTN","PSNHIT",60,0)
 Q
"RTN","PSNHIT",61,0)
ASKIT1 S DUNCE=0 D PKSIZE^PSNOUT,PKTYPE^PSNOUT W !!,"Local drug ",$P(^PSDRUG(PSNB,0),"^"),!,"matches ",?11,PSNFORM,!,"PACKAGE SIZE: ",PSNSZE,!,"PACKAGE TYPE: ",PSNTPE
"RTN","PSNHIT",62,0)
 W !?10,"Is this a match ?" K DIR S DIR("B")="YES",DIR(0)="Y" D ^DIR Q:$D(DIRUT)
"RTN","PSNHIT",63,0)
 I Y(0)="NO" S DUNCE=1,NOMSYN=1
"RTN","PSNHIT",64,0)
 I Y(0)="YES" D SET^PSNHIT
"RTN","PSNHIT",65,0)
 Q
"RTN","PSNHIT",66,0)
EXTD S CMID=$P(^TMP($J,"PSNND",BB),"^",5)
"RTN","PSNHIT",67,0)
 Q
"RTN","PSNHIT",68,0)
PKI N CS
"RTN","PSNHIT",69,0)
 I +$P($G(^PSNDF(50.68,PSNFNM,7)),"^") S CS=$P(^(7),"^") D
"RTN","PSNHIT",70,0)
 .S CS=$S(CS?1(1"2n",1"3n"):+CS_"C",+CS=2!(+CS=3)&(CS'["C"):+CS_"A",1:CS)
"RTN","PSNHIT",71,0)
 .I $L(CS)=1,$P(^PSDRUG(PSNB,0),"^",3)[CS Q
"RTN","PSNHIT",72,0)
 .I $P(^PSDRUG(PSNB,0),"^",3)[$E(CS),$P(^PSDRUG(PSNB,0),"^",3)[$E(CS,2) Q
"RTN","PSNHIT",73,0)
 .W !!,"The CS Federal Schedule associated with this drug in the VA Product file"
"RTN","PSNHIT",74,0)
 .W !,"represents a DEA, Special Handling code of "_CS,!!
"RTN","PSNHIT",75,0)
 .W ?5,"Enter RETURN to continue..." R X:10
"RTN","PSNHIT",76,0)
 Q
"RTN","PSNLOOK")
0^12^B63244023^B55919915
"RTN","PSNLOOK",1,0)
PSNLOOK ;BIR/WRT-Look up into drug file ; 06/19/03 15:00
"RTN","PSNLOOK",2,0)
 ;;4.0;NATIONAL DRUG FILE;**2,3,5,11,22,27,62,70,169,262,296,429,492,396**; 30 Oct 98;Build 190
"RTN","PSNLOOK",3,0)
 ;
"RTN","PSNLOOK",4,0)
 ; Reference to ^PSDRUG supported by DBIA# 2192
"RTN","PSNLOOK",5,0)
 ; Reference to ^PS(50.606 supported by DBIA# 2174
"RTN","PSNLOOK",6,0)
 ; Reference to ^PSNAPIS supported by DBIA #2531
"RTN","PSNLOOK",7,0)
 ;
"RTN","PSNLOOK",8,0)
 ;USE PSNLK*
"RTN","PSNLOOK",9,0)
BEGIN ;
"RTN","PSNLOOK",10,0)
 D ASK
"RTN","PSNLOOK",11,0)
 N PSNLKDA,PSNLKIND,PSNLKCL,PSNLKNOD,PSNLKVPN,PSNLKID,PSNLKVDU,PSNLKTR,PSNLKDAV,PSNLKGK,PSNLKPMI,PSNLKQQ
"RTN","PSNLOOK",12,0)
 N DIC,X,Y,DLAYGO,DTOUT,DUOUT,DIR,DIRUT,DIROUT,%DT,PSNLKMAP,PSNLKENG,PSNLKDF,PSNLKSTR,PSNLKUN,PSNLKFRM
"RTN","PSNLOOK",13,0)
 N PSNLKUNT,PSNLKNFN,PSNLKBB,PSNLKAND,PSNLKGR,PSNLKIST,PSNLKIUT,PSNLKSEV,PSNLKCSF,PSNLKSP,PSNLKNND,PSNLKCC
"RTN","PSNLOOK",14,0)
 N PSNLKSCL,PSNLKZ,PSNLKRE,PSNLKWRT,PSNZZFS,PSNLKL1,PSNLKL2,PSNLKIUN,PSNZZFSA,PSNLKCP,PSNTDRUG
"RTN","PSNLOOK",15,0)
SELD ;Select Drug
"RTN","PSNLOOK",16,0)
 K PSNLKDA,PSNLKIND,PSNLKCL,PSNLKNOD,PSNLKVPN,PSNLKID,PSNLKVDU,PSNLKTR,PSNLKDAV,PSNLKGK,PSNLKPMI,PSNLKQQ
"RTN","PSNLOOK",17,0)
 K DIC,X,Y,DLAYGO,DTOUT,DUOUT,DIR,DIRUT,DIROUT,%DT,PSNLKMAP,PSNLKENG,PSNLKDF,PSNLKSTR,PSNLKUN,PSNLKFRM
"RTN","PSNLOOK",18,0)
 K PSNLKUNT,PSNLKNFN,PSNLKBB,PSNLKAND,PSNLKGR,PSNLKIST,PSNLKIUT,PSNLKSEV,PSNLKCSF,PSNLKSP,PSNLKNND,PSNLKCC
"RTN","PSNLOOK",19,0)
 K PSNLKSCL,PSNLKZ,PSNLKRE,PSNLKWRT,PSNZZFS,PSNLKL1,PSNLKL2,PSNLKIUN,PSNZZFSA,PSNLKCP,PSNFD,PSNFDT
"RTN","PSNLOOK",20,0)
 W ! K DIC S DIC=50,DIC(0)="QEAM",DIC("W")="S PSNTDRUG=Y D GETTIER^PSNLOOK(PSNTDRUG)" D ^DIC I Y<0!($D(DTOUT))!($D(DUOUT)) Q
"RTN","PSNLOOK",21,0)
 S PSNLKDA=+Y K Y
"RTN","PSNLOOK",22,0)
 S PSNLKIND=$P($G(^PSDRUG(PSNLKDA,"I")),"^") I PSNLKIND,PSNLKIND<DT  S Y=PSNLKIND D DD^%DT W !!,"This drug has an Inactive date of "_$G(Y),! D MESS G SELD
"RTN","PSNLOOK",23,0)
 D DSPLY
"RTN","PSNLOOK",24,0)
 D HG
"RTN","PSNLOOK",25,0)
 G SELD
"RTN","PSNLOOK",26,0)
 ;
"RTN","PSNLOOK",27,0)
ASK W !!,"This option will allow you to look up entries in your local DRUG file. It will",!,"display National Drug File software match information.",!
"RTN","PSNLOOK",28,0)
 Q
"RTN","PSNLOOK",29,0)
DSPLY W @IOF W !?14,"DRUG Generic Name:  ",$P($G(^PSDRUG(PSNLKDA,0)),"^") I $D(^PSDRUG(PSNLKDA,"ND")) S PSNLKCL=$P(^("ND"),"^",6)
"RTN","PSNLOOK",30,0)
 I $D(^PSDRUG(PSNLKDA,"ND")),$P(^PSDRUG(PSNLKDA,"ND"),"^",2)]"" S PSNLKNOD=^PSDRUG(PSNLKDA,"ND") D DSPLY1,DSPLY2,PRODF,DSP,ING,SV,DSP1,RESTN Q
"RTN","PSNLOOK",31,0)
 W !?8,"*** NO NATIONAL DRUG FILE INFORMATION ***",!
"RTN","PSNLOOK",32,0)
 Q
"RTN","PSNLOOK",33,0)
DSPLY1 W !?5,"VA Product Name: ",$P(PSNLKNOD,"^",2)
"RTN","PSNLOOK",34,0)
 W !?5,"VA Generic Name: ",$P($G(^PSNDF(50.6,$P(PSNLKNOD,"^"),0)),"^")
"RTN","PSNLOOK",35,0)
 Q
"RTN","PSNLOOK",36,0)
DSPLY2 ;
"RTN","PSNLOOK",37,0)
 S (PSNLKVPN,PSNLKID,PSNLKVDU,PSNLKTR)=""
"RTN","PSNLOOK",38,0)
 K X S PSNLKDAV=$P(PSNLKNOD,"^"),PSNLKGK=$P(PSNLKNOD,"^",3),X=$$PROD2^PSNAPIS(PSNLKDAV,PSNLKGK) I $P(X,"^")]"" S PSNLKVPN=$P(X,"^"),PSNLKID=$P(X,"^",2),PSNLKTR=$P(X,"^",3),PSNLKVDU=$P(X,"^",4)
"RTN","PSNLOOK",39,0)
 K PSNLKPMI I X]"" S PSNLKQQ=$P(^PSNDF(50.68,PSNLKGK,1),"^",5) D GCN
"RTN","PSNLOOK",40,0)
 K X
"RTN","PSNLOOK",41,0)
 Q
"RTN","PSNLOOK",42,0)
GCN I PSNLKQQ']"" S PSNLKPMI="None" Q
"RTN","PSNLOOK",43,0)
 ;
"RTN","PSNLOOK",44,0)
GCN1 ; 
"RTN","PSNLOOK",45,0)
 I $D(^PS(50.623,"B",PSNLKQQ)) S PSNLKMAP=$O(^PS(50.623,"B",PSNLKQQ,0)),PSNLKENG=$P(^PS(50.623,PSNLKMAP,0),"^",2),PSNLKPMI=$P(^PS(50.621,+PSNLKENG,0),"^") Q
"RTN","PSNLOOK",46,0)
 S PSNLKPMI="None"
"RTN","PSNLOOK",47,0)
 Q
"RTN","PSNLOOK",48,0)
DSPLY3 W ?50,"Transmit To CMOP: "
"RTN","PSNLOOK",49,0)
 I PSNLKTR=1 W "YES"
"RTN","PSNLOOK",50,0)
 I PSNLKTR=0 W "NO"
"RTN","PSNLOOK",51,0)
 Q
"RTN","PSNLOOK",52,0)
PRODF ;
"RTN","PSNLOOK",53,0)
 S X=$$PROD0^PSNAPIS(PSNLKDAV,PSNLKGK)
"RTN","PSNLOOK",54,0)
 S PSNLKDF=+$P(X,"^",2),PSNLKSTR=$P(X,"^",3),PSNLKUN=+$P(X,"^",4),PSNLKFRM=$S($G(PSNLKDF):$P($G(^PS(50.606,PSNLKDF,0)),"^"),1:""),PSNLKUNT=$S($G(PSNLKUN):$P($G(^PS(50.607,PSNLKUN,0)),"^"),1:""),PSNLKNFN=$P(^PSNDF(50.68,PSNLKGK,0),"^",6)
"RTN","PSNLOOK",55,0)
 K X
"RTN","PSNLOOK",56,0)
 Q
"RTN","PSNLOOK",57,0)
ING F PSNLKBB=0:0 S PSNLKBB=$O(^PSNDF(50.68,PSNLKGK,2,PSNLKBB)) Q:'PSNLKBB  D
"RTN","PSNLOOK",58,0)
 .I $D(^PSNDF(50.68,PSNLKGK,2,PSNLKBB,0)) S PSNLKAND=$G(^PSNDF(50.68,PSNLKGK,2,PSNLKBB,0)),PSNLKGR=$P(^PS(50.416,$P(PSNLKAND,"^",1),0),"^"),PSNLKIST=$P(PSNLKAND,"^",2),PSNLKIUT=$P(PSNLKAND,"^",3) K PSNLKIUN D ING1,IN2
"RTN","PSNLOOK",59,0)
 Q
"RTN","PSNLOOK",60,0)
IN2 W ?3,PSNLKGR,?50,"Str: ",PSNLKIST W:PSNLKIUT ?65,"Unt: ",$G(PSNLKIUN) W !
"RTN","PSNLOOK",61,0)
 Q
"RTN","PSNLOOK",62,0)
ING1 S:$P(^PS(50.416,$P(PSNLKAND,"^"),0),"^",2) PSNLKGR=$P($G(^PS(50.416,$P(^PS(50.416,$P(PSNLKAND,"^"),0),"^",2),0)),"^") I PSNLKIUT S PSNLKIUN=$P(^PS(50.607,PSNLKIUT,0),"^")
"RTN","PSNLOOK",63,0)
 Q
"RTN","PSNLOOK",64,0)
SC I $O(^PSNDF(50.68,PSNLKGK,4,0)) W !,"Secondary Class(es): ",! F PSNLKCC=0:0 S PSNLKCC=$O(^PSNDF(50.68,PSNLKGK,4,PSNLKCC)) Q:'PSNLKCC  S PSNLKZ=$P($G(^PSNDF(50.68,PSNLKGK,4,PSNLKCC,0)),"^") I PSNLKZ D
"RTN","PSNLOOK",65,0)
 .S PSNLKSCL=$P($G(^PS(50.605,PSNLKZ,0)),"^") D SC1
"RTN","PSNLOOK",66,0)
 Q
"RTN","PSNLOOK",67,0)
SC1 W "   ",PSNLKSCL
"RTN","PSNLOOK",68,0)
 Q
"RTN","PSNLOOK",69,0)
SV S PSNLKSEV=$G(^PSNDF(50.68,PSNLKGK,7)) I PSNLKSEV]"" S PSNLKCSF=$P(PSNLKSEV,"^"),PSNLKSP=$P(PSNLKSEV,"^",2) S:PSNLKSP="M" PSNLKSP="Multi" S:PSNLKSP="S" PSNLKSP="Single" D SV1
"RTN","PSNLOOK",70,0)
 Q
"RTN","PSNLOOK",71,0)
SV1 S PSNZZFSA=PSNLKGK_"," S PSNZZFS=$$GET1^DIQ(50.68,PSNZZFSA,19) I $G(PSNZZFS)="" S PSNZZFS="None"
"RTN","PSNLOOK",72,0)
 S PSNLKNND=$P(^PSNDF(50.68,PSNLKGK,7),"^",3)
"RTN","PSNLOOK",73,0)
 Q
"RTN","PSNLOOK",74,0)
DSP W !,"Dosage Form: ",PSNLKFRM_$S('$G(PSNLKDF):"",$P($G(^PS(50.606,PSNLKDF,1)),"^")=1:"  (Exclude from Dosing Cks)",1:"")
"RTN","PSNLOOK",75,0)
 S PSNLKL1=$L(PSNLKSTR),PSNLKL2=$S($G(PSNLKUN):$L(PSNLKUNT),1:0)
"RTN","PSNLOOK",76,0)
 I (PSNLKL1+PSNLKL2)<62 W !,"Strength: ",PSNLKSTR W:$G(PSNLKUN) " Units: "_PSNLKUNT G PSDZZ
"RTN","PSNLOOK",77,0)
 W !,"Strength: ",PSNLKSTR
"RTN","PSNLOOK",78,0)
 I $G(PSNLKUN) D
"RTN","PSNLOOK",79,0)
 .W !,"Units: " I PSNLKL2<72 W PSNLKUNT Q
"RTN","PSNLOOK",80,0)
 .W !,PSNLKUNT
"RTN","PSNLOOK",81,0)
PSDZZ ;
"RTN","PSNLOOK",82,0)
 W !,"National Formulary Name: ",PSNLKNFN,!,"VA Print Name: ",PSNLKVPN,!,"VA Product Identifier: ",PSNLKID D DSPLY3 W !,"VA Dispense Unit: ",PSNLKVDU I $D(PSNLKPMI) W !,"PMIS: ",PSNLKPMI
"RTN","PSNLOOK",83,0)
 W !,"Active Ingredients: ",!
"RTN","PSNLOOK",84,0)
 Q
"RTN","PSNLOOK",85,0)
DSP1 D HG W "Primary Drug Class: ",$P(^PS(50.605,PSNLKCL,0),"^") D SC W !,"CS Federal Schedule: ",$G(PSNLKCSF)_"  "_$G(PSNZZFS),!,"Single/Multi Source Product: ",$G(PSNLKSP)
"RTN","PSNLOOK",86,0)
 I $G(PSNLKNND)]"" W !,"Inactivation Date: " S Y=PSNLKNND D DD^%DT W Y K Y
"RTN","PSNLOOK",87,0)
 W !,"Max Single Dose: ",$P(PSNLKSEV,"^",4),?45,"Min Single Dose: ",$P(PSNLKSEV,"^",5)
"RTN","PSNLOOK",88,0)
 W !,"Max Daily Dose: ",$P(PSNLKSEV,"^",6),?45,"Min Daily Dose: ",$P(PSNLKSEV,"^",7),!,"Max Cumulative Dose: ",$P(PSNLKSEV,"^",8)
"RTN","PSNLOOK",89,0)
 W !,"National Formulary Indicator: " I $D(^PSNDF(50.68,PSNLKGK,5)) W:$P(^PSNDF(50.68,PSNLKGK,5),"^")=0 "No" W:$P(^PSNDF(50.68,PSNLKGK,5),"^")=1 "Yes"
"RTN","PSNLOOK",90,0)
 D FD^PSNACT(PSNLKGK),FDT^PSNACT(PSNLKGK) ;ppsn
"RTN","PSNLOOK",91,0)
 N CPDATE,X D NOW^%DTC S CPDATE=X S PSNLKCP=$$CPTIER^PSNAPIS(PSNLKGK,CPDATE,"",1) K CPDATE,X
"RTN","PSNLOOK",92,0)
 ;  PSNLKCP = Copay Tier^Effective Date^End Date
"RTN","PSNLOOK",93,0)
 W !,"Copay Tier: ",$P(PSNLKCP,"^",1)
"RTN","PSNLOOK",94,0)
 W !,"Copay Effective Date: " S Y=$P(PSNLKCP,"^",2) D DD^%DT W Y K Y
"RTN","PSNLOOK",95,0)
 W !
"RTN","PSNLOOK",96,0)
 I $G(^PSNDF(50.68,PSNLKGK,8)) W !,"Exclude Drg-Drg Interaction Ck: Yes (No check for Drug-Drug Interactions)"
"RTN","PSNLOOK",97,0)
 D OVER
"RTN","PSNLOOK",98,0)
 D:$Y>18 HG
"RTN","PSNLOOK",99,0)
 ;CLINICAL EFFECTS
"RTN","PSNLOOK",100,0)
 W !
"RTN","PSNLOOK",101,0)
 D CLEFF^PSNCLEHW(PSNLKGK)  D:$Y>18 HG
"RTN","PSNLOOK",102,0)
 W !
"RTN","PSNLOOK",103,0)
 D POSDOS^PSNACT(PSNLKGK)
"RTN","PSNLOOK",104,0)
 W !,"Maximum Days Supply: ",$$GET1^DIQ(50.68,PSNLKGK,32)
"RTN","PSNLOOK",105,0)
 ;HAZ WASTE
"RTN","PSNLOOK",106,0)
 D:$Y>20 HG
"RTN","PSNLOOK",107,0)
 D HAZWASTE^PSNCLEHW(PSNLKGK)
"RTN","PSNLOOK",108,0)
 N I,J,PSNCODX,PSNCODJ,PSNRXCUI S PSNCODX=0
"RTN","PSNLOOK",109,0)
 F I=1:1 S PSNCODX=$O(^PSNDF(50.68,PSNLKGK,11,PSNCODX)) Q:PSNCODX="B"!(PSNCODX="")  D
"RTN","PSNLOOK",110,0)
 . S PSNRXCUI=$G(^PSNDF(50.68,PSNLKGK,11,PSNCODX,0)) Q:PSNRXCUI'="RxNorm"
"RTN","PSNLOOK",111,0)
 . W !!,"Coding System: ",$P(^PSNDF(50.68,PSNLKGK,11,PSNCODX,0),"^",1) S PSNCODJ=0
"RTN","PSNLOOK",112,0)
 . F J=1:1 S PSNCODJ=$O(^PSNDF(50.68,PSNLKGK,11,PSNCODX,1,PSNCODJ)) Q:PSNCODJ="B"!(PSNCODJ="")  D
"RTN","PSNLOOK",113,0)
 .. W !,"Code: ",$P(^PSNDF(50.68,PSNLKGK,11,PSNCODX,1,PSNCODJ,0),"^",1)
"RTN","PSNLOOK",114,0)
 W !
"RTN","PSNLOOK",115,0)
 Q
"RTN","PSNLOOK",116,0)
RESTN I $O(^PSNDF(50.68,PSNLKGK,6,0)) W !,"Restriction: " F PSNLKRE=0:0 S PSNLKRE=$O(^PSNDF(50.68,PSNLKGK,6,PSNLKRE)) Q:'PSNLKRE  S PSNLKWRT=$G(^PSNDF(50.68,PSNLKGK,6,PSNLKRE,0)) W !,PSNLKWRT
"RTN","PSNLOOK",117,0)
 Q
"RTN","PSNLOOK",118,0)
HG ;
"RTN","PSNLOOK",119,0)
 W ! K DIR S DIR(0)="E",DIR("A")="Press Return to Continue" D ^DIR K DIR
"RTN","PSNLOOK",120,0)
 W @IOF
"RTN","PSNLOOK",121,0)
 Q
"RTN","PSNLOOK",122,0)
MESS ;
"RTN","PSNLOOK",123,0)
 W ! K DIR S DIR(0)="E",DIR("A")="Press Return to Continue" D ^DIR K DIR
"RTN","PSNLOOK",124,0)
 Q
"RTN","PSNLOOK",125,0)
 ;
"RTN","PSNLOOK",126,0)
OVER ;
"RTN","PSNLOOK",127,0)
 W !,"Override DF Exclude from Dosage Checks: "_$S($P($G(^PSNDF(50.68,PSNLKGK,9)),"^")=1:"Yes",$P($G(^PSNDF(50.68,PSNLKGK,9)),"^")=0:"No",1:"") I $P($G(^PSNDF(50.68,PSNLKGK,9)),"^")=1 D
"RTN","PSNLOOK",128,0)
 .I '$G(PSNLKDF) Q
"RTN","PSNLOOK",129,0)
 .I '$D(^PS(50.606,PSNLKDF,0)) Q
"RTN","PSNLOOK",130,0)
 .I $P($G(^PS(50.606,PSNLKDF,1)),"^")=1 W " (Dosage Checks shall be performed)" Q
"RTN","PSNLOOK",131,0)
 .I $P($G(^PS(50.606,PSNLKDF,1)),"^")=0 W " (No Dosage Checks performed)"
"RTN","PSNLOOK",132,0)
 Q
"RTN","PSNLOOK",133,0)
 ;
"RTN","PSNLOOK",134,0)
GETTIER(PSNTDRUG) ;called by DIC; look up copay tier by file 50 ien for current date
"RTN","PSNLOOK",135,0)
 N VAPID,CPDATE,X,PSSCP,VAPROD,PSNINACT,PSNCONVD,PSNFD
"RTN","PSNLOOK",136,0)
 S VAPROD=$$GET1^DIQ(50,PSNTDRUG,22,"I")
"RTN","PSNLOOK",137,0)
 S PSNFD=$$GET1^DIQ(50.68,VAPROD,109)
"RTN","PSNLOOK",138,0)
 W:PSNFD'="" " "_PSNFD
"RTN","PSNLOOK",139,0)
 Q:'$G(VAPROD)
"RTN","PSNLOOK",140,0)
 D NOW^%DTC S CPDATE=$P(%,".")
"RTN","PSNLOOK",141,0)
 S PSSCP=$$CPTIER^PSNAPIS(VAPROD,CPDATE,PSNTDRUG,1) K CPDATE,X
"RTN","PSNLOOK",142,0)
 I $P(PSSCP,"^")'="" W " Tier ",$P(PSSCP,"^")
"RTN","PSNLOOK",143,0)
 S PSNINACT=$$GET1^DIQ(50,PSNTDRUG,100,"I")  ;inactive date
"RTN","PSNLOOK",144,0)
 S:$G(PSNINACT) PSNCONVD=$$DATE(PSNINACT)
"RTN","PSNLOOK",145,0)
 W:$G(PSNCONVD)'="" "  "_PSNCONVD
"RTN","PSNLOOK",146,0)
 Q
"RTN","PSNLOOK",147,0)
 ;
"RTN","PSNLOOK",148,0)
DATE(PSNCONVD) ;convert fileman date to mm/dd/yyyy
"RTN","PSNLOOK",149,0)
 N DATE
"RTN","PSNLOOK",150,0)
 S DATE="",DATE=$E(PSNCONVD,4,5)_"/"_$E(PSNCONVD,6,7)_"/"_(1700+$E(PSNCONVD,1,3))
"RTN","PSNLOOK",151,0)
 Q DATE
"RTN","PSNVFY")
0^15^B18516900^B17319517
"RTN","PSNVFY",1,0)
PSNVFY ;BIR/CCH&WRT-verifies matches allows rematch ; 02/08/00 8:45
"RTN","PSNVFY",2,0)
 ;;4.0;NATIONAL DRUG FILE;**3,22,65,492,396**; 30 Oct 98;Build 190
"RTN","PSNVFY",3,0)
 ;
"RTN","PSNVFY",4,0)
 ;Reference to ^DIC(51.5 supported by DBIA #1931
"RTN","PSNVFY",5,0)
 ;Reference to ^PSDRUG supported by DBIA #2352,#221
"RTN","PSNVFY",6,0)
 ;
"RTN","PSNVFY",7,0)
 S PSNFL=0,PSNW=0 F PSNB=0:0 S PSNB=$O(^PSNTRAN(PSNB)) Q:'PSNB  D CHK I $D(PSNFL) Q:PSNFL
"RTN","PSNVFY",8,0)
DONE W:PSNW=0 !!,?13,"No Data has been generated" K PSNB,PSNFL D KILL Q
"RTN","PSNVFY",9,0)
CHK I $D(PSNFL) Q:PSNFL
"RTN","PSNVFY",10,0)
 S PSNP=$G(^PSDRUG(PSNB,"I")) I PSNP,PSNP<DT K ^PSNTRAN(PSNB,0) Q
"RTN","PSNVFY",11,0)
 Q:'$D(^PSNTRAN(PSNB,0))  Q:$P(^PSNTRAN(PSNB,0),"^",9)="Y"  Q:'$P(^PSNTRAN(PSNB,0),"^",2)
"RTN","PSNVFY",12,0)
 S PSNPST=^PSNTRAN(PSNB,0),PSNOLD=$P(^PSDRUG(PSNB,0),U),PSNNEW=$P(^PSNDF(50.68,$P(PSNPST,"^",2),0),"^")
"RTN","PSNVFY",13,0)
START W @IOF W ?2,"LOCAL DRUG NAME: ",PSNOLD S PSNW=1 W:$P(^PSDRUG(PSNB,0),"^",9)=1 ?68,"N/F"
"RTN","PSNVFY",14,0)
 W !,?40,"ORDER UNIT:"
"RTN","PSNVFY",15,0)
 I $D(^PSDRUG(PSNB,660)) S NODE=^PSDRUG(PSNB,660) I $P(NODE,"^",2) S PSNWRT=$P(NODE,"^",2) I $D(^DIC(51.5)),$D(^DIC(51.5,PSNWRT)) W ?52,$S('$D(PSNWRT):"",1:$P(^DIC(51.5,PSNWRT,0),"^",1))
"RTN","PSNVFY",16,0)
 W !,?24,"DISPENSE UNITS/ORDER UNITS: ",$S('$D(NODE):"",1:$P(NODE,"^",5)),!,?37,"DISPENSE UNIT: ",$S('$D(NODE):"",1:$P(NODE,"^",8))
"RTN","PSNVFY",17,0)
 W !!,"VA PRODUCT NAME: ",PSNNEW
"RTN","PSNVFY",18,0)
 S D0=$P(^PSNTRAN(PSNB,0),"^",1),PSNFNM=$P(^PSNTRAN(PSNB,0),"^",2)
"RTN","PSNVFY",19,0)
 S DA=D0,K=PSNFNM,X=$$PROD2^PSNAPIS(DA,K) I X]"",$P(X,"^")]"" W !,"VA PRINT NAME: ",$P(X,"^"),?57,"CMOP ID: ",$P(X,"^",2),!,"VA DISPENSE UNIT: ",$P(X,"^",4)
"RTN","PSNVFY",20,0)
 W ?57,"MARKABLE FOR CMOP: " W:$P(X,"^",3)=1 "YES" W:$P(X,"^",3)=0 "NO" W:$P(X,"^",3)="" "NOT MARKED"
"RTN","PSNVFY",21,0)
 S PSNSIZE=$P(^PSNTRAN(PSNB,0),"^",5),PSNTYPE=$P(^PSNTRAN(PSNB,0),"^",7)
"RTN","PSNVFY",22,0)
 D PKSIZE^PSNOUT,PKTYPE^PSNOUT W !,?5,"PACKAGE SIZE: ",PSNSZE,!,?5,"PACKAGE TYPE: ",PSNTPE
"RTN","PSNVFY",23,0)
 S PSNVADC=$P(^PSNTRAN(PSNB,0),"^",3) W !,"VA CLASS: ",$P(^PS(50.605,PSNVADC,0),"^",1)_"  "_$P(^PS(50.605,PSNVADC,0),"^",2)
"RTN","PSNVFY",24,0)
 W !,"CS FEDERAL SCHEDULE: "_$S($P($G(^PSNDF(50.68,PSNFNM,7)),"^"):$P(^PSNDF(50.68,PSNFNM,7),"^"),1:"")
"RTN","PSNVFY",25,0)
 W !,"INGREDIENTS:" D INGRED^PSNOUT
"RTN","PSNVFY",26,0)
 S NFI=$P($G(^PSNDF(50.68,PSNFNM,5)),"^"),NFR=$P($G(^PSNDF(50.68,PSNFNM,6,1,0)),"^")
"RTN","PSNVFY",27,0)
 W !,"NATIONAL FORMULARY INDICATOR: " W:NFI=1 ?30,"YES" W:NFI=0 ?30,"NO"
"RTN","PSNVFY",28,0)
 N PSNFD S PSNFD=$$GET1^DIQ(50.68,PSNFNM,109)
"RTN","PSNVFY",29,0)
 W:PSNFD'="" !,"Formulary Designator: ",PSNFD  ;PPSN
"RTN","PSNVFY",30,0)
 W !,"NATIONAL FORMULARY RESTRICTION:",!,NFR
"RTN","PSNVFY",31,0)
 I $D(^PSNDF(50.68,PSNFNM,5.1,1,0)) D FDT^PSNACT(PSNFNM)  ;ppsn - formulary designator text
"RTN","PSNVFY",32,0)
 N CPDATE,X,PSNCP D NOW^%DTC S CPDATE=X S PSNCP=$$CPTIER^PSNAPIS(PSNFNM,CPDATE,"",1) K CPDATE,X
"RTN","PSNVFY",33,0)
 ;  PSNCP = Copay Tier^Effective Date^End Date
"RTN","PSNVFY",34,0)
 W !,"Copay Tier: ",$P(PSNCP,"^",1)
"RTN","PSNVFY",35,0)
 W !,"Copay Effective Date: " S Y=$P(PSNCP,"^",2) D DD^%DT W Y K Y
"RTN","PSNVFY",36,0)
 K D0,Y,PSNSIZE,PSNTYPE,PSNTPE,PSNSZE,PSNCON,STOPIT
"RTN","PSNVFY",37,0)
RESP W !!,"< Enter ""Y"" for yes, ""N"" for no >"
"RTN","PSNVFY",38,0)
 W:'$D(Z9) !,"< Press RETURN to Pass to Next Drug >"
"RTN","PSNVFY",39,0)
 R !!!,?10,"Is this a match ? ",ANS:DTIME I '$T S ANS="^" S PSNFL=1 Q
"RTN","PSNVFY",40,0)
 I ANS?.E1C.E G RESP
"RTN","PSNVFY",41,0)
 I ANS="" K ANS Q
"RTN","PSNVFY",42,0)
 W ! I ANS["^" S PSNFL=1 Q
"RTN","PSNVFY",43,0)
 I "Nn"[$E(ANS) K ANS D BLDIT^PSNCOMP Q:$P(^PSNTRAN(PSNB,0),"^",2)']""  G CHK
"RTN","PSNVFY",44,0)
 I ANS["?" D RES2^PSNHELP K ANS G START
"RTN","PSNVFY",45,0)
 I "YyNn"'[$E(ANS) W !," Invalid Response " G RESP
"RTN","PSNVFY",46,0)
 S $P(^PSNTRAN(PSNB,0),"^",9)="Y",$P(^PSNTRAN(PSNB,0),"^",10)=DUZ D:$G(PSEDIT)'=1 SET^PSNMRG    ;PSEDIT set in ^PSNOUT
"RTN","PSNVFY",47,0)
 Q
"RTN","PSNVFY",48,0)
KILL K ANS,PSNSIZE,PSNSZ,PSNTYP,PSNTYPE,PSNDA,PSNSTDA,PSNDDA,PSNUNDA,PSNCLASS,PSNDF,PSNFNM,PSNFORM,PSNNDF,DIC,PSNFL,NBR,PSNNEW,PSNOLD,PSNPST,X,Y,PSNCON,STOPIT
"RTN","PSNVFY",49,0)
 K PSNFN,PSNNAM,PSNNAME,PSNNL,PSNVAR,PSND,PSNDFM,PSNVC,PSNVCL,RM,SL,ZZ,ZZZ,PSNTPE,PSNSZE,VV,VVV,JJ,MJL,KK,IN,PSNODE,PSNOU,NODE,PSNWRT,PSNVADC,PSNENT,PSNF,PSNM,PSNLOC,^TMP($J,"PSNND"),ASC,PSNRAN,PSNV,PSNWR,PSNX,PSNZ,WRT,BB,END,PSNP,PSNW
"RTN","PSNVFY",50,0)
 K CODE,DA,DATE,DIR,EEE,FFF,FL,GGG,IEN,J,K,NO31,NOM31,NOMSYN,DUNCE,PP,PSNARY,PSNIEN,PSNP,PTPS,QQ,RR,ST,TT,TTT,WR,XX,XXX,Y,ZXZX,DDD,LIST,PPQ,PSNTRFL,PSNXZ,STOP,PSNPD,PSNUP,PSNINQ,NFI
"UP",50.68,50.681,-1)
50.68^5.1
"UP",50.68,50.681,0)
50.681
"UP",50.68,50.68105,-1)
50.68^HAZTODIS2
"UP",50.68,50.68105,0)
50.68105
"UP",50.68,50.68108,-1)
50.68^12
"UP",50.68,50.68108,0)
50.68108
"VER")
8.0^22.0
"^DD",50.68,50.68,101,0)
HAZARDOUS TO HANDLE^Sa^0:NO;1:YES;^HAZTOHAN;1^Q
"^DD",50.68,50.68,101,3)
Enter Y for Yes or N for No to mark this drug as hazardous to handle.
"^DD",50.68,50.68,101,8.5)
^
"^DD",50.68,50.68,101,9)
^
"^DD",50.68,50.68,101,21,0)
^.001^3^3^3170113^^
"^DD",50.68,50.68,101,21,1,0)
Answering yes to this field indicates that the drug 
"^DD",50.68,50.68,101,21,2,0)
exhibits one or more characteristics that makes it  
"^DD",50.68,50.68,101,21,3,0)
hazardous to handle (i.e. toxicity, carcinogenicity, etc.) 
"^DD",50.68,50.68,101,"AUDIT")
y
"^DD",50.68,50.68,101,"DT")
3150622
"^DD",50.68,50.68,102,0)
HAZARDOUS TO DISPOSE^Sa^0:NO;1:YES;^HAZTODIS;1^Q
"^DD",50.68,50.68,102,3)
Enter Y for Yes or N for No to mark this drug hazardous to dispose.
"^DD",50.68,50.68,102,8.5)
^
"^DD",50.68,50.68,102,9)
^
"^DD",50.68,50.68,102,21,0)
^^3^3^3150617^
"^DD",50.68,50.68,102,21,1,0)
Answering yes to this field indicates that the drug 
"^DD",50.68,50.68,102,21,2,0)
exhibits one or more characteristics that makes it
"^DD",50.68,50.68,102,21,3,0)
hazardous to dispose (i.e. toxicity, carcinogenicity, etc.)
"^DD",50.68,50.68,102,"AUDIT")
y
"^DD",50.68,50.68,102,"DT")
3150617
"^DD",50.68,50.68,103,0)
PRIMARY EPA CODE^Fa^^HAZTODIS;2^K:$L(X)>50!($L(X)<1)!'($L(X)<51) X
"^DD",50.68,50.68,103,3)
Enter the Primary EPA code up to 50 characters.  Ex: D001 for Ignitable waste
"^DD",50.68,50.68,103,8.5)
^
"^DD",50.68,50.68,103,9)
^
"^DD",50.68,50.68,103,21,0)
^^5^5^3150617^^
"^DD",50.68,50.68,103,21,1,0)
This field contains the Environmental Protection 
"^DD",50.68,50.68,103,21,2,0)
Agency (EPA) waste code which identifies the drugs
"^DD",50.68,50.68,103,21,3,0)
hazardous waste characteristics For example: EPA 
"^DD",50.68,50.68,103,21,4,0)
waste code P001 for Warfarin, & salts, when present
"^DD",50.68,50.68,103,21,5,0)
at concentrations greater than 0.3%).
"^DD",50.68,50.68,103,"AUDIT")
y
"^DD",50.68,50.68,103,"DT")
3150617
"^DD",50.68,50.68,104,0)
WASTE SORT CODE^Fa^^HAZTODIS;3^K:$L(X)>50!($L(X)<1)!'($L(X)<51) X
"^DD",50.68,50.68,104,3)
Enter the waste sort code up to 50 characters for the drug.  Example: CHEMO, DEA, etc.
"^DD",50.68,50.68,104,8.5)
^
"^DD",50.68,50.68,104,9)
^
"^DD",50.68,50.68,104,21,0)
^^2^2^3150617^
"^DD",50.68,50.68,104,21,1,0)
This is the waste sort code associated with the
"^DD",50.68,50.68,104,21,2,0)
disposal of this drug.
"^DD",50.68,50.68,104,"AUDIT")
y
"^DD",50.68,50.68,104,"DT")
3150622
"^DD",50.68,50.68,105,0)
DOT SHIPPING CODE^50.68105^^HAZTODIS2;0
"^DD",50.68,50.68,105,21,0)
^^2^2^3170612^
"^DD",50.68,50.68,105,21,1,0)
This field contains the DOT shipping code associated with 
"^DD",50.68,50.68,105,21,2,0)
the disposal of this drug.
"^DD",50.68,50.68,108,0)
CLINICAL EFFECTS OF DRUG^50.68108S^^12;0
"^DD",50.68,50.68,108,8.5)
^
"^DD",50.68,50.68,108,9)
^
"^DD",50.68,50.68,108,21,0)
^^4^4^3170516^
"^DD",50.68,50.68,108,21,1,0)
This multiple field is used to define a time parameter 
"^DD",50.68,50.68,108,21,2,0)
that can be set to determine whether expired or recently
"^DD",50.68,50.68,108,21,3,0)
discontinued drugs should be included or excluded in 
"^DD",50.68,50.68,108,21,4,0)
order checks.
"^DD",50.68,50.68,109,0)
FORMULARY DESIGNATOR^Fa^^5;2^K:$L(X)>30!($L(X)<1) X
"^DD",50.68,50.68,109,3)
Answer must be 1-30 alpha-numeric characters for Formulary Designator (i.e. PA-N, PA-N1, PA-V, PA-F, DOD COC, etc.).
"^DD",50.68,50.68,109,21,0)
^^24^24^3170214^
"^DD",50.68,50.68,109,21,1,0)
This Formulary Designator field is used to classify prior 
"^DD",50.68,50.68,109,21,2,0)
authorization levels before dispensing.  Prior
"^DD",50.68,50.68,109,21,3,0)
Authorization is used to ensure that the medication is 
"^DD",50.68,50.68,109,21,4,0)
appropriate for each individual Veteran. Examples are:
"^DD",50.68,50.68,109,21,5,0)
 
"^DD",50.68,50.68,109,21,6,0)
 - Prior Authorization-National (PA-N) refers
"^DD",50.68,50.68,109,21,7,0)
   to medications that are formulary, but 
"^DD",50.68,50.68,109,21,8,0)
   require prior approval at the national
"^DD",50.68,50.68,109,21,9,0)
   level before dispensing.
"^DD",50.68,50.68,109,21,10,0)
 
"^DD",50.68,50.68,109,21,11,0)
 - Prior Authorization-VISN (PA-V) refers
"^DD",50.68,50.68,109,21,12,0)
   to medications that are formulary, require
"^DD",50.68,50.68,109,21,13,0)
   prior approval at the VISN level before
"^DD",50.68,50.68,109,21,14,0)
   dispensing.
"^DD",50.68,50.68,109,21,15,0)
 
"^DD",50.68,50.68,109,21,16,0)
 - Prior Authorization-Facility (PA-F) refers
"^DD",50.68,50.68,109,21,17,0)
   to medications that are formulary, but 
"^DD",50.68,50.68,109,21,18,0)
   require prior approval at the facility
"^DD",50.68,50.68,109,21,19,0)
   level before dispensing.
"^DD",50.68,50.68,109,21,20,0)
 
"^DD",50.68,50.68,109,21,21,0)
- Prior Authorization-DOD COC refers to 
"^DD",50.68,50.68,109,21,22,0)
   medications that are formulary, but require
"^DD",50.68,50.68,109,21,23,0)
   prior approval for Department of Defense 
"^DD",50.68,50.68,109,21,24,0)
   Continuity of Care.
"^DD",50.68,50.68,109,"AUDIT")
y
"^DD",50.68,50.68,109,"DT")
3170214
"^DD",50.68,50.68,110,0)
FORMULARY DESIGNATOR TEXT^50.681^^5.1;0
"^DD",50.68,50.68,110,21,0)
^.001^2^2^3170612^^^
"^DD",50.68,50.68,110,21,1,0)
This field contains a description for the Formulary
"^DD",50.68,50.68,110,21,2,0)
Designator defined for the product.
"^DD",50.68,50.681,0)
FORMULARY DESIGNATOR TEXT SUB-FIELD^^.01^1
"^DD",50.68,50.681,0,"DT")
3170214
"^DD",50.68,50.681,0,"NM","FORMULARY DESIGNATOR TEXT")

"^DD",50.68,50.681,0,"UP")
50.68
"^DD",50.68,50.681,.01,0)
FORMULARY DESIGNATOR TEXT^Wx^^0;1^Q
"^DD",50.68,50.681,.01,3)
Enter the associated text for the Formulary Indicator.
"^DD",50.68,50.681,.01,21,0)
^.001^1^1^3170612^^^^
"^DD",50.68,50.681,.01,21,1,0)
Enter the descriptive text for the Formulary Designator.
"^DD",50.68,50.681,.01,"DT")
3170214
"^DD",50.68,50.68105,0)
DOT SHIPPING CODE SUB-FIELD^^.01^1
"^DD",50.68,50.68105,0,"DT")
3151110
"^DD",50.68,50.68105,0,"NM","DOT SHIPPING CODE")

"^DD",50.68,50.68105,0,"UP")
50.68
"^DD",50.68,50.68105,.01,0)
DOT SHIPPING CODE^W^^0;1^Q
"^DD",50.68,50.68105,.01,3)
Enter the DOT Shipping Code up to 50 characters. Example: Toxic Liquids, Organic, n.o.s.
"^DD",50.68,50.68105,.01,21,0)
^.001^2^2^3170612^^^^
"^DD",50.68,50.68105,.01,21,1,0)
This field contains the DOT shipping code associated
"^DD",50.68,50.68105,.01,21,2,0)
with the disposal of this drug. 
"^DD",50.68,50.68105,.01,"DT")
3151110
"^DD",50.68,50.68108,0)
CLINICAL EFFECTS OF DRUG SUB-FIELD^^2^3
"^DD",50.68,50.68108,0,"DT")
3170516
"^DD",50.68,50.68108,0,"IX","B",50.68108,.01)

"^DD",50.68,50.68108,0,"NM","CLINICAL EFFECTS OF DRUG")

"^DD",50.68,50.68108,0,"UP")
50.68
"^DD",50.68,50.68108,.01,0)
PACKAGE^MS^I:INPATIENT;O:OUTPATIENT;IO:BOTH INPATIENT AND OUTPATIENT;^0;1^Q
"^DD",50.68,50.68108,.01,1,0)
^.1
"^DD",50.68,50.68108,.01,1,1,0)
50.68108^B
"^DD",50.68,50.68108,.01,1,1,1)
S ^PSNDF(50.68,DA(1),12,"B",$E(X,1,30),DA)=""
"^DD",50.68,50.68108,.01,1,1,2)
K ^PSNDF(50.68,DA(1),12,"B",$E(X,1,30),DA)
"^DD",50.68,50.68108,.01,3)
Select the Package associated with the clinical effect duration I, O, or IO.
"^DD",50.68,50.68108,.01,21,0)
^.001^2^2^3170516^^^
"^DD",50.68,50.68108,.01,21,1,0)
This field contains the package associated
"^DD",50.68,50.68108,.01,21,2,0)
with the clinical effect duration.
"^DD",50.68,50.68108,.01,"DT")
3170516
"^DD",50.68,50.68108,1,0)
OMIT EXP/DC ORDER CHECK^S^0:NO;1:YES;^0;2^Q
"^DD",50.68,50.68108,1,3)
Enter Y for YES or N for NO to exclude EXP/DC orders from order checking.
"^DD",50.68,50.68108,1,21,0)
^.001^3^3^3170426^^
"^DD",50.68,50.68108,1,21,1,0)
Answering yes to this field will exclude expired
"^DD",50.68,50.68108,1,21,2,0)
and discontinued orders from the order check 
"^DD",50.68,50.68108,1,21,3,0)
process for the package.
"^DD",50.68,50.68108,1,23,0)
^^2^2^3170426^
"^DD",50.68,50.68108,1,23,1,0)
A yes answer in this field overrides the
"^DD",50.68,50.68108,1,23,2,0)
DURATION LIMIT field (#2) in this multiple.
"^DD",50.68,50.68108,1,"DT")
3170426
"^DD",50.68,50.68108,2,0)
DURATION LIMIT^F^^0;3^K:$L(X)>6!($L(X)<1) X
"^DD",50.68,50.68108,2,3)
Answer must be 1-6 characters in length. Enter the number of days (99999D) or hours (99999H) for excluding EXP/DC orders from order checking.
"^DD",50.68,50.68108,2,21,0)
^.001^5^5^3170501^^^
"^DD",50.68,50.68108,2,21,1,0)
This field indicates the duration, in hours, 
"^DD",50.68,50.68108,2,21,2,0)
that an expired or recently discontinued order 
"^DD",50.68,50.68108,2,21,3,0)
should be included in Order Checks.  The format
"^DD",50.68,50.68108,2,21,4,0)
should be 99999x, where 99999 represents the days
"^DD",50.68,50.68108,2,21,5,0)
or hours and x represents D for days or H for hours.
"^DD",50.68,50.68108,2,23,0)
^^3^3^3170501^
"^DD",50.68,50.68108,2,23,1,0)
This field will be superseded if the OMIT EXP/DC
"^DD",50.68,50.68108,2,23,2,0)
ORDER CHECK field (#1) of this multiple is 
"^DD",50.68,50.68108,2,23,3,0)
answered YES.
"^DD",50.68,50.68108,2,"DT")
3170501
"BLD",9663,6)
^513
**END**
**END**

