Released PSD*3*75 SEQ #64
Extracted from mail message
**KIDS**:PSD*3.0*75^

**INSTALL NAME**
PSD*3.0*75
"BLD",9381,0)
PSD*3.0*75^CONTROLLED SUBSTANCES^0^3130701^y
"BLD",9381,1,0)
^^9^9^3130409^
"BLD",9381,1,1,0)
This patch addresses the following problems:
"BLD",9381,1,2,0)
 
"BLD",9381,1,3,0)
1. A portion of this report is not working correctly Rx (Prescription)
"BLD",9381,1,4,0)
   Outpatient Dispensing Report
"BLD",9381,1,5,0)
 
"BLD",9381,1,6,0)
2. Destruction holding numbers do not appear on the Destroyed Drugs Report
"BLD",9381,1,7,0)
   after being destroyed.
"BLD",9381,1,8,0)
 
"BLD",9381,1,9,0)
3. Printing Issue
"BLD",9381,4,0)
^9.64PA^^
"BLD",9381,6.3)
2
"BLD",9381,"ABPKG")
n
"BLD",9381,"KRN",0)
^9.67PA^779.2^20
"BLD",9381,"KRN",.4,0)
.4
"BLD",9381,"KRN",.401,0)
.401
"BLD",9381,"KRN",.402,0)
.402
"BLD",9381,"KRN",.403,0)
.403
"BLD",9381,"KRN",.5,0)
.5
"BLD",9381,"KRN",.84,0)
.84
"BLD",9381,"KRN",3.6,0)
3.6
"BLD",9381,"KRN",3.8,0)
3.8
"BLD",9381,"KRN",9.2,0)
9.2
"BLD",9381,"KRN",9.8,0)
9.8
"BLD",9381,"KRN",9.8,"NM",0)
^9.68A^4^4
"BLD",9381,"KRN",9.8,"NM",1,0)
PSDOPTN^^0^B20101780
"BLD",9381,"KRN",9.8,"NM",2,0)
PSDESTP^^0^B48298563
"BLD",9381,"KRN",9.8,"NM",3,0)
PSDNU2^^0^B22108701
"BLD",9381,"KRN",9.8,"NM",4,0)
PSDNU3^^0^B3988500
"BLD",9381,"KRN",9.8,"NM","B","PSDESTP",2)

"BLD",9381,"KRN",9.8,"NM","B","PSDNU2",3)

"BLD",9381,"KRN",9.8,"NM","B","PSDNU3",4)

"BLD",9381,"KRN",9.8,"NM","B","PSDOPTN",1)

"BLD",9381,"KRN",19,0)
19
"BLD",9381,"KRN",19,"NM",0)
^9.68A^^
"BLD",9381,"KRN",19.1,0)
19.1
"BLD",9381,"KRN",101,0)
101
"BLD",9381,"KRN",409.61,0)
409.61
"BLD",9381,"KRN",771,0)
771
"BLD",9381,"KRN",779.2,0)
779.2
"BLD",9381,"KRN",870,0)
870
"BLD",9381,"KRN",8989.51,0)
8989.51
"BLD",9381,"KRN",8989.52,0)
8989.52
"BLD",9381,"KRN",8994,0)
8994
"BLD",9381,"KRN","B",.4,.4)

"BLD",9381,"KRN","B",.401,.401)

"BLD",9381,"KRN","B",.402,.402)

"BLD",9381,"KRN","B",.403,.403)

"BLD",9381,"KRN","B",.5,.5)

"BLD",9381,"KRN","B",.84,.84)

"BLD",9381,"KRN","B",3.6,3.6)

"BLD",9381,"KRN","B",3.8,3.8)

"BLD",9381,"KRN","B",9.2,9.2)

"BLD",9381,"KRN","B",9.8,9.8)

"BLD",9381,"KRN","B",19,19)

"BLD",9381,"KRN","B",19.1,19.1)

"BLD",9381,"KRN","B",101,101)

"BLD",9381,"KRN","B",409.61,409.61)

"BLD",9381,"KRN","B",771,771)

"BLD",9381,"KRN","B",779.2,779.2)

"BLD",9381,"KRN","B",870,870)

"BLD",9381,"KRN","B",8989.51,8989.51)

"BLD",9381,"KRN","B",8989.52,8989.52)

"BLD",9381,"KRN","B",8994,8994)

"BLD",9381,"QDEF")
^^^^NO^^^^^^NO
"BLD",9381,"QUES",0)
^9.62^^
"BLD",9381,"REQB",0)
^9.611^2^2
"BLD",9381,"REQB",1,0)
PSD*3.0*71^1
"BLD",9381,"REQB",2,0)
PSD*3.0*55^1
"BLD",9381,"REQB","B","PSD*3.0*55",2)

"BLD",9381,"REQB","B","PSD*3.0*71",1)

"MBREQ")
0
"PKG",499,-1)
1^1
"PKG",499,0)
CONTROLLED SUBSTANCES^PSD^Controlled Substances Inventory and Tracking module.
"PKG",499,20,0)
^9.402P^^
"PKG",499,22,0)
^9.49I^1^1
"PKG",499,22,1,0)
3.0^2970213^2981028^66481
"PKG",499,22,1,"PAH",1,0)
75^3130701^100104
"PKG",499,22,1,"PAH",1,1,0)
^^9^9^3130701
"PKG",499,22,1,"PAH",1,1,1,0)
This patch addresses the following problems:
"PKG",499,22,1,"PAH",1,1,2,0)
 
"PKG",499,22,1,"PAH",1,1,3,0)
1. A portion of this report is not working correctly Rx (Prescription)
"PKG",499,22,1,"PAH",1,1,4,0)
   Outpatient Dispensing Report
"PKG",499,22,1,"PAH",1,1,5,0)
 
"PKG",499,22,1,"PAH",1,1,6,0)
2. Destruction holding numbers do not appear on the Destroyed Drugs Report
"PKG",499,22,1,"PAH",1,1,7,0)
   after being destroyed.
"PKG",499,22,1,"PAH",1,1,8,0)
 
"PKG",499,22,1,"PAH",1,1,9,0)
3. Printing Issue
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
4
"RTN","PSDESTP")
0^2^B48298563^B48187487
"RTN","PSDESTP",1,0)
PSDESTP ;BIR/BJW-Destroyed CS Drugs Report ; 28 Feb 98
"RTN","PSDESTP",2,0)
 ;;3.0;CONTROLLED SUBSTANCES ;**8,62,71,75**;13 Feb 97;Build 2
"RTN","PSDESTP",3,0)
 ;**Y2K compliance**,"P" added to date input string 2/9/98
"RTN","PSDESTP",4,0)
 ;*Y2K* chg to print four digit year in body of report
"RTN","PSDESTP",5,0)
 I '$D(PSDSITE) D ^PSDSET Q:'$D(PSDSITE)
"RTN","PSDESTP",6,0)
 I '$D(^XUSEC("PSJ RPHARM",DUZ))&('$D(^XUSEC("PSD TECH ADV",DUZ))) D  G END
"RTN","PSDESTP",7,0)
 .W !!,"Please contact your Pharmacy Coordinator for access to",!,"the pending Controlled Substances destruction data.",!!,"PSJ RPHARM or PSD TECH ADV security key required.",!
"RTN","PSDESTP",8,0)
ASKD ;ask disp location
"RTN","PSDESTP",9,0)
 S PSDS=$P(PSDSITE,U,3),PSDSN=$P(PSDSITE,U,4)
"RTN","PSDESTP",10,0)
ASKV ;ask vault(s)
"RTN","PSDESTP",11,0)
 W !!,?5,"You may select a single VAULT, several VAULT(s),",!,?5,"or enter ^ALL to select all VAULT(s).",!
"RTN","PSDESTP",12,0)
 K DA,DIC D NOW^%DTC S (PSDT,Y)=X X ^DD("DD") S RPDT=Y
"RTN","PSDESTP",13,0)
 F  S DIC=58.8,DIC("A")="Select VAULT: ",DIC(0)="QEA",DIC("S")="I $S('$D(^(""I"")):1,'^(""I""):1,+^(""I"")>PSDT:1,1:0),$P(^(0),""^"",2)'=""N"",$P(^(0),""^"",3)=+PSDSITE" D ^DIC K DIC Q:Y<0  S PSDVAU(+Y)=""
"RTN","PSDESTP",14,0)
ASKV2 ;
"RTN","PSDESTP",15,0)
 I '$O(PSDVAU(0))&(X'="^ALL") G END
"RTN","PSDESTP",16,0)
 I X="^ALL" F PSD=0:0 S PSD=$O(^PSD(58.8,PSD)) Q:'PSD  I $S('$D(^PSD(58.8,PSD,"I")):1,'^("I"):1,+^("I")>PSDT:1,1:0),$P($G(^(0)),"^",2)'="N",$P($G(^(0)),"^",3)=+PSDSITE S PSDVAU(PSD)=""
"RTN","PSDESTP",17,0)
 S JJ=$O(PSDVAU(0)),JJ=$S($O(PSDVAU(JJ)):1,1:2)
"RTN","PSDESTP",18,0)
 S DIC="^DIC(4,",DR=.01,DA=+$P($G(^XMB(1,1,"XUS")),U,17),DIQ="PSD"
"RTN","PSDESTP",19,0)
 D EN^DIQ1 S PSD=PSD(4,DA,.01) K DIC,DR,DA,DIQ
"RTN","PSDESTP",20,0)
 S PSDSN=$S(JJ=1:PSD,1:$P($G(^PSD(58.8,+$O(PSDVAU(0)),0)),U)) K PSD
"RTN","PSDESTP",21,0)
DRUG ;ask drug
"RTN","PSDESTP",22,0)
 W !!,?5,"You may select a single drug, several drugs,",!,?5,"or enter ^ALL to select all drugs.",!!
"RTN","PSDESTP",23,0)
 W ! K DA,DIC
"RTN","PSDESTP",24,0)
 S PSDS=$O(PSDVAU(0))
"RTN","PSDESTP",25,0)
 I $O(PSDVAU(PSDS)) D  G SKIP
"RTN","PSDESTP",26,0)
 .F  S DIC=50,DIC(0)="QEAM",DIC("A")="SELECT DRUG: " D ^DIC K DIC Q:Y<0  S PSDRG(+Y)=""
"RTN","PSDESTP",27,0)
 F  S DIC("W")="W:$P(^PSDRUG(Y,0),""^"",9) ""   N/F"" I $P(^PSD(58.8,PSDS,1,Y,0),""^"",14)]"""",$P(^(0),""^"",14)'>DT W $C(7),""   *** INACTIVE ***""",DA(1)=+PSDS,DIC(0)="QEAM",DIC="^PSD(58.8,"_PSDS_",1," D ^DIC K DIC Q:Y<0  D
"RTN","PSDESTP",28,0)
 .S PSDRG(+Y)=""
"RTN","PSDESTP",29,0)
SKIP I '$D(PSDRG)&(X'="^ALL") G END
"RTN","PSDESTP",30,0)
 I X="^ALL" S ALL=1
"RTN","PSDESTP",31,0)
DATE ;ask date range
"RTN","PSDESTP",32,0)
 W ! K %DT S %DT="AEP",%DT("A")="Start with Date: " D ^%DT I Y<0 S PSDOUT=1 G END
"RTN","PSDESTP",33,0)
 S PSDSD=Y D D^DIQ S PSDATE=Y,%DT("A")="End with Date: " D ^%DT I Y<0 S PSDOUT=1 G END
"RTN","PSDESTP",34,0)
 I Y<PSDSD W !!,"The ending date of the range must be later than the starting date." G DATE
"RTN","PSDESTP",35,0)
 S PSDED=Y D D^DIQ S PSDATE=PSDATE_"^"_Y,PSDSD=PSDSD-.0001,PSDED=PSDED+.9999
"RTN","PSDESTP",36,0)
DEV ;select device
"RTN","PSDESTP",37,0)
 W !!,"This report is designed for a 80 column format.",!,"You may queue this report to print at a later time.",!!
"RTN","PSDESTP",38,0)
 S Y=$P($G(^PSD(58.8,+PSDS,2)),"^",9),C=$P(^DD(58.8,24,0),"^",2) D Y^DIQ S PSDEV=Y
"RTN","PSDESTP",39,0)
 K %ZIS,IOP,IO("Q"),POP S %ZIS="QM",%ZIS("B")=PSDEV D ^%ZIS I POP W !,"NO DEVICE SELECTED OR REPORT PRINTED!" G END
"RTN","PSDESTP",40,0)
 I $D(IO("Q")) K IO("Q"),ZTIO,ZTSAVE,ZTDTH,ZTSK S ZTRTN="START^PSDESTP",ZTDESC="Destroyed CS Drug Report" D SAVE,^%ZTLOAD,HOME^%ZIS K ZTSK G END
"RTN","PSDESTP",41,0)
 U IO
"RTN","PSDESTP",42,0)
START ;start looping
"RTN","PSDESTP",43,0)
 K ^TMP("PSDESTP",$J)
"RTN","PSDESTP",44,0)
 D NOW^%DTC S Y=X X ^DD("DD") S RPDT=Y
"RTN","PSDESTP",45,0)
 K LN S (CNT,PG,PSDOUT,PSDTOT)=0,$P(LN,"-",80)=""
"RTN","PSDESTP",46,0)
 F PSD=PSDSD:0 S PSD=$O(^PSD(58.86,"AC",PSD)) Q:'PSD!(PSD>PSDED)   S PSDS=0 F  S PSDS=$O(^PSD(58.86,"AC",PSD,PSDS)) Q:'PSDS  D:$D(PSDVAU(PSDS))
"RTN","PSDESTP",47,0)
 .F PSDR=0:0 S PSDR=$O(^PSD(58.86,"AC",PSD,PSDS,PSDR)) Q:'PSDR  D
"RTN","PSDESTP",48,0)
 ..F PSDA=0:0 S PSDA=$O(^PSD(58.86,"AC",PSD,PSDS,PSDR,PSDA)) Q:'PSDA  I $D(ALL)!($D(PSDRG(+PSDR))) D SET
"RTN","PSDESTP",49,0)
 I $D(ALL) F PSD=PSDSD:0 S PSD=$O(^PSD(58.86,"AD",PSD)) Q:'PSD!(PSD>PSDED)  S PSDS=0 F  S PSDS=$O(^PSD(58.86,"AD",PSD,PSDS)) Q:'PSDS  D:$D(PSDVAU(PSDS))
"RTN","PSDESTP",50,0)
 .S PSDN="" F  S PSDN=$O(^PSD(58.86,"AD",PSD,PSDS,PSDN)) Q:PSDN=""  F PSDA=0:0 S PSDA=$O(^PSD(58.86,"AD",PSD,PSDS,PSDN,PSDA)) Q:'PSDA  D SET
"RTN","PSDESTP",51,0)
 I CNT=0 D HDR W !!,?10,"*** NO CONTROLLED SUBSTANCE DESTRUCTIONS ***",!! G DONE
"RTN","PSDESTP",52,0)
PRINT ;prints data,L-6 added 8/24/95 accum summ.total,10/20/95 chgs made
"RTN","PSDESTP",53,0)
 D HDR
"RTN","PSDESTP",54,0)
 F PSDA=0:0 S PSDA=$O(^TMP("PSDESTP",$J,PSDA)) D:'PSDA GTOT Q:'PSDA!(PSDOUT)  D:$Y+12>IOSL HDR Q:PSDOUT  S PSDRN="" F  S PSDRN=$O(^TMP("PSDESTP",$J,PSDA,PSDRN)) Q:PSDRN=""  D 
"RTN","PSDESTP",55,0)
 .I $Y+12>IOSL D HDR Q:PSDOUT
"RTN","PSDESTP",56,0)
 .S NODE=^TMP("PSDESTP",$J,PSDA,PSDRN)
"RTN","PSDESTP",57,0)
 .W !,"HOLDING #: ",PSDA,! S PVAULT=$P(NODE,U,9) W:JJ=1 "=> ",$P($G(^PSD(58.8,+PVAULT,0)),U),! W "Drug: ",PSDRN W ?60 W:$P(NODE,"^",8) "GS #: ",$P(NODE,U,8) W !,"Quantity: ",$P(NODE,"^"),!,"Cost of above Qty: ",$P(NODE,U,11)
"RTN","PSDESTP",58,0)
 .I $P(NODE,U,10)']"" S PSDTOT=$P(NODE,U,11)+PSDTOT
"RTN","PSDESTP",59,0)
 .I $P(NODE,U,6)']"" D
"RTN","PSDESTP",60,0)
 ..W !,"Date Destroyed: ",$P(NODE,U,3),!,"Destroyed By: ",$P(NODE,U,2),!,"Patient Returning Drug: ",$P(NODE,U,10),!
"RTN","PSDESTP",61,0)
 ..W:$P(NODE,U,4) "Comments: ",$P(NODE,U,4),!!
"RTN","PSDESTP",62,0)
 ..W:'$P(NODE,U,4) "Comments: ",$P(NODE,U,12),!!
"RTN","PSDESTP",63,0)
 .I $P(NODE,U,6)]"" D
"RTN","PSDESTP",64,0)
 ..W !,"Date/Time Cancelled: ",$P(NODE,U,5),!,"Cancelled By: ",$P(NODE,U,6),!,"Patient Returning Drug: ",$P(NODE,U,10),!,"Comments: ",$P(NODE,U,7),!!
"RTN","PSDESTP",65,0)
DONE ;
"RTN","PSDESTP",66,0)
 I $E(IOST)'="C" W @IOF
"RTN","PSDESTP",67,0)
 I $E(IOST,1,2)="C-",'PSDOUT W !! K DIR,DIRUT S DIR(0)="EA",DIR("A")="END OF REPORT!  Press <RET> to return to the menu" D ^DIR K DIR
"RTN","PSDESTP",68,0)
END ;
"RTN","PSDESTP",69,0)
 K %,%DT,%H,%I,%ZIS,ALL,C,CNT,DA,DIC,DIR,DIROUT,DIRUT,DTOUT,DUOUT,LN,NODE
"RTN","PSDESTP",70,0)
 K JJ,PG,PBACOM,PHARM,PHARMC,PHARMN,PHARMNC,POP,PPDU,PSD,PSDA,PSDATE,PSDCD,PSDCOMS,PSDCOM3,PSDED,PSDEV,PSDGS,PSDN,PSDPAT,PSDPATR,PSDPDU,PSDOUT,PSDR,PSDRG,PSDRN,PSDS,PSDTOT,PSDSD,PSDSN,PSDT,PSDTR,PSDVAU,PVAULT,PSDYR,PSDCYR
"RTN","PSDESTP",71,0)
 K QTY,RPDT,X,Y,ZTDESC,ZTDTH,ZTIO,ZTRTN,ZTSAVE,ZTSK
"RTN","PSDESTP",72,0)
 K ^TMP("PSDESTP",$J)
"RTN","PSDESTP",73,0)
 D ^%ZISC S:$D(ZTQUEUED) ZTREQ="@"
"RTN","PSDESTP",74,0)
 Q
"RTN","PSDESTP",75,0)
HDR ;prints header information
"RTN","PSDESTP",76,0)
 I $E(IOST,1,2)="C-",PG W ! K DA,DIR S DIR(0)="E" D ^DIR K DIR I 'Y S PSDOUT=1 Q
"RTN","PSDESTP",77,0)
 S PG=PG+1 W:$Y @IOF W !,?70,"PAGE: ",PG,!,?15,"DESTROYED CS DRUGS REPORT for ",PSDSN
"RTN","PSDESTP",78,0)
 W !,?15,"Period From: ",$P(PSDATE,"^")," to: ",$P(PSDATE,"^",2),!,?15,"Run Date: ",RPDT,!!,"=> VAULT",!,LN,!
"RTN","PSDESTP",79,0)
 Q
"RTN","PSDESTP",80,0)
GTOT ;10/20/95 msg added,grand total,inserted 8/24/95
"RTN","PSDESTP",81,0)
 Q:PSDOUT
"RTN","PSDESTP",82,0)
 W !!!!?50,"Summary Total: ",PSDTOT
"RTN","PSDESTP",83,0)
 W !!!?15,"*** Drugs returned by a patient ARE NOT ADDED to Summary Total***"
"RTN","PSDESTP",84,0)
 Q
"RTN","PSDESTP",85,0)
SAVE ;saves variables for queueing
"RTN","PSDESTP",86,0)
 S (ZTSAVE("JJ"),ZTSAVE("PSDSD"),ZTSAVE("PSDED"),ZTSAVE("PSDATE"),ZTSAVE("PSDS"),ZTSAVE("PSDSN"),ZTSAVE("PSDTOT"))=""
"RTN","PSDESTP",87,0)
 S:$D(ALL) ZTSAVE("ALL")="" S:$D(PSDRG) ZTSAVE("PSDRG(")=""
"RTN","PSDESTP",88,0)
 S:$D(PSDVAU) ZTSAVE("PSDVAU(")=""
"RTN","PSDESTP",89,0)
 Q
"RTN","PSDESTP",90,0)
SET ;sets data;10/20/95 added bal.adj comms. PBACOM
"RTN","PSDESTP",91,0)
 S CNT=CNT+1
"RTN","PSDESTP",92,0)
 I '$D(PSDR) S PSDR=""  ;<- JD *62
"RTN","PSDESTP",93,0)
 S (PSDGS,PBACOM)=""
"RTN","PSDESTP",94,0)
 S NODE=^PSD(58.86,PSDA,0),PSDRN=$S($G(^PSD(58.86,PSDA,1))]"":$G(^PSD(58.86,PSDA,1))_"*",$P($G(^PSDRUG(+PSDR,0)),"^")]"":$P($G(^PSDRUG(+PSDR,0)),"^"),1:"#"_PSDA_" DRUG NAME MISSING")
"RTN","PSDESTP",95,0)
 S PSDTR=$P(NODE,"^",9) I +PSDTR S PSDGS=$P($G(^PSD(58.81,PSDTR,0)),U,17),PBACOM=$P($G(^PSD(58.81,PSDTR,0)),U,16)
"RTN","PSDESTP",96,0)
 S QTY=$P(NODE,"^",3),PHARM=+$P(NODE,"^",10),PHARMN=$S($P($G(^VA(200,PHARM,0)),"^")]"":$P(^(0),"^"),1:"")
"RTN","PSDESTP",97,0)
 S PPDU=$P($G(^PSDRUG(+PSDR,660)),U,6),PSDPDU=$J(PPDU*QTY,1,3)
"RTN","PSDESTP",98,0)
 S Y=PSD X ^DD("DD") S PSDYR=$P(Y,",",2)
"RTN","PSDESTP",99,0)
 S PSDT=$E(PSD,4,5)_"/"_$E(PSD,6,7)_"/"_PSDYR
"RTN","PSDESTP",100,0)
 S PVAULT=+$P($G(^PSD(58.86,PSDA,0)),"^",7)
"RTN","PSDESTP",101,0)
 S PSDCOMS=$P($G(^PSD(58.86,PSDA,2)),"^")
"RTN","PSDESTP",102,0)
 S PSDCD=$P($G(^PSD(58.86,PSDA,3)),"^") I PSDCD S Y=PSDCD X ^DD("DD") S PSDCYR=$P(Y,",",2) S PSDCD=$E(PSDCD,4,5)_"/"_$E(PSDCD,6,7)_"/"_PSDCYR
"RTN","PSDESTP",103,0)
 S PHARMC=+$P($G(^PSD(58.86,PSDA,3)),"^",2),PHARMNC=$S($P($G(^VA(200,PHARMC,0)),"^")]"":$P(^(0),"^"),1:"")
"RTN","PSDESTP",104,0)
 S PSDCOM3=$P($G(^PSD(58.86,PSDA,3)),"^",3)
"RTN","PSDESTP",105,0)
 S PSDPAT=+$P(NODE,"^",13),PSDPATR=$S($P($G(^DPT(PSDPAT,0)),"^")]"":$P(^(0),"^"),1:"")
"RTN","PSDESTP",106,0)
 S ^TMP("PSDESTP",$J,PSDA,PSDRN)=QTY_"^"_PHARMN_"^"_PSDT_"^"_PSDCOMS_"^"_PSDCD_"^"_PHARMNC_"^"_PSDCOM3_"^"_PSDGS_"^"_PVAULT_"^"_PSDPATR_"^"_PSDPDU_"^"_PBACOM
"RTN","PSDESTP",107,0)
 Q
"RTN","PSDNU2")
0^3^B22108701^B19397437
"RTN","PSDNU2",1,0)
PSDNU2 ;BIR/JPW-Print NAOU Usage Report by NAOU ; 2 Aug 94
"RTN","PSDNU2",2,0)
 ;;3.0;CONTROLLED SUBSTANCES ;**75**;13 Feb 97;Build 2
"RTN","PSDNU2",3,0)
START ;entry point for report
"RTN","PSDNU2",4,0)
 K ^TMP("PSDNU",$J),^TMP("PSDNUS",$J),^TMP("PSDNUT",$J),^TMP("PSDNUG",$J),^TMP("PSDNUQ",$J)
"RTN","PSDNU2",5,0)
 F JJ2=2,3,4,5 F JJ=PSDSD:0 S JJ=$O(^PSD(58.81,"ACT",JJ)) Q:'JJ!(JJ>PSDED)  F JJ1=0:0 S JJ1=$O(^PSD(58.81,"ACT",JJ,JJ1)) Q:'JJ1  F PSDR=0:0 S PSDR=$O(^PSD(58.81,"ACT",JJ,JJ1,PSDR)) Q:'PSDR  D
"RTN","PSDNU2",6,0)
 .F KK=0:0 S KK=$O(^PSD(58.81,"ACT",JJ,JJ1,PSDR,JJ2,KK)) Q:'KK  D SET
"RTN","PSDNU2",7,0)
 D NODATA  ;; RJS*75
"RTN","PSDNU2",8,0)
PRINT ;prints data for stock drugs
"RTN","PSDNU2",9,0)
 I SUM D ^PSDNU3 G DONE
"RTN","PSDNU2",10,0)
 K LN S $P(LN,"-",80)="",(PG,PSDOUT)=0,%DT="",X="T" D ^%DT X ^DD("DD") S RPDT=Y
"RTN","PSDNU2",11,0)
 S PSDNAOU="" F  S PSDNAOU=$O(^TMP("PSDNU",$J,PSDNAOU)) D:PSDNAOU="" GTOT Q:PSDNAOU=""!(PSDOUT)  D HDR D
"RTN","PSDNU2",12,0)
 .I $D(^TMP("PSDNU",$J,PSDNAOU,0)) W !,"*****  NO DATA AVAILABLE FOR THIS REPORT  *****",! D NTOT Q  ;; RJS*75
"RTN","PSDNU2",13,0)
 .S PSDR="" F  S PSDR=$O(^TMP("PSDNU",$J,PSDNAOU,PSDR)) D:PSDR="" NTOT Q:PSDR=""!(PSDOUT)  W !,?2,"=> ",PSDR,!! D
"RTN","PSDNU2",14,0)
 ..S NUM="" F  S NUM=$O(^TMP("PSDNU",$J,PSDNAOU,PSDR,NUM)) D:NUM="" TOT Q:NUM=""!(PSDOUT)  F JJ=0:0 S JJ=$O(^TMP("PSDNU",$J,PSDNAOU,PSDR,NUM,JJ)) Q:'JJ!(PSDOUT)  D
"RTN","PSDNU2",15,0)
 ...S NODE=^TMP("PSDNU",$J,PSDNAOU,PSDR,NUM,JJ),DATE=$E(JJ,4,5)_"/"_$E(JJ,6,7)_"/"_$E(JJ,2,3)
"RTN","PSDNU2",16,0)
 ...I $Y+8>IOSL D HDR Q:PSDOUT  W !,?2,"=> ",PSDR,!!
"RTN","PSDNU2",17,0)
 ...W NUM,?16,DATE,?25,$J($P(NODE,"^"),6),?37,$P(NODE,"^",2),?70,$P(NODE,"^",3),!
"RTN","PSDNU2",18,0)
DONE I $E(IOST)'="C" W @IOF
"RTN","PSDNU2",19,0)
 I $E(IOST,1,2)="C-",'PSDOUT W ! K DIR,DIRUT S DIR(0)="EA",DIR("A")="END OF REPORT!  Press <RET> to return to the menu" D ^DIR K DIR
"RTN","PSDNU2",20,0)
END ;
"RTN","PSDNU2",21,0)
 K %,%DT,%H,%I,%ZIS,ALL,ANS,DA,DATE,DIR,DIROUT,DIRUT,DTOUT,DUOUT,IO("Q"),JJ,JJ1,JJ2,KK,LOC,LN
"RTN","PSDNU2",22,0)
 K PSDNAOU,PSDNAOUN,NODE,NUM,NURS,QTY,PG,POP,PSD,PSDATE,PSDED,PSDOK,PSDOUT,PSDPN,PSDR,PSDRN,PSDSD,PSDT,PSDTR,RPDT,SUM,X,Y
"RTN","PSDNU2",23,0)
 K ZTDESC,ZTDTH,ZTIO,ZTRTN,ZTSAVE,ZTSK
"RTN","PSDNU2",24,0)
 K ^TMP("PSDNU",$J),^TMP("PSDNUT",$J),^TMP("PSDNUG",$J),^TMP("PSDNUQ",$J),^TMP("PSDNUS",$J)
"RTN","PSDNU2",25,0)
 D ^%ZISC S:$D(ZTQUEUED) ZTREQ="@"
"RTN","PSDNU2",26,0)
 Q
"RTN","PSDNU2",27,0)
SET ;sets data
"RTN","PSDNU2",28,0)
 Q:'$D(^PSD(58.81,KK,0))  S NODE=^PSD(58.81,KK,0),PSD=+$P(NODE,"^",18)
"RTN","PSDNU2",29,0)
 Q:'$D(LOC(PSD))  Q:+$P($G(^PSD(58.8,PSD,0)),"^",3)'=+PSDSITE  S PSDOK=0
"RTN","PSDNU2",30,0)
 S PSDRN=$S($P($G(^PSDRUG(PSDR,0)),"^")]"":$P(^(0),"^"),1:"DRUG NAME MISSING")
"RTN","PSDNU2",31,0)
 S PSDNAOUN=$S($P($G(^PSD(58.8,PSD,0)),"^")]"":$P(^(0),"^"),1:"NAOU NAME MISSING")
"RTN","PSDNU2",32,0)
 S PSDPN=$S($P(NODE,"^",17)]"":$P(NODE,"^",17),1:"DISP W/O GS"),QTY=+$P(NODE,"^",6)
"RTN","PSDNU2",33,0)
 S:+$P($G(^PSD(58.81,KK,4)),"^",3) QTY=+$P($G(^(4)),"^",3)
"RTN","PSDNU2",34,0)
 I JJ2=2,$D(^PSD(58.81,KK,7)),+$P(^(7),"^",3)'=PSD S QTY=QTY-(+$P(^(7),"^",7))
"RTN","PSDNU2",35,0)
 S QTY=$S(JJ2=3:-(+$P($G(^PSD(58.81,KK,3)),"^",2)),JJ2=4:-(+$P($G(^PSD(58.81,KK,3)),"^",5)),JJ2=14:+$P($G(^PSD(58.81,KK,4)),"^",3),1:QTY)
"RTN","PSDNU2",36,0)
 I JJ2=5 S PSDTR=+$P($G(^PSD(58.81,KK,7)),"^",6) D:PSDTR
"RTN","PSDNU2",37,0)
 .I +$P($G(^PSD(58.81,PSDTR,0)),"^",18)=PSD S PSDOK=1
"RTN","PSDNU2",38,0)
 S NURS=$S(+$P($G(^PSD(58.81,KK,1)),"^",7):+$P($G(^(1)),"^",7),1:+$P($G(^PSD(58.81,KK,1)),"^",3))
"RTN","PSDNU2",39,0)
 S NURS=$S($P($G(^VA(200,NURS,0)),"^")]"":$P(^(0),"^"),PSDPN="DISP W/O GS":"N/A",1:"UNKNOWN")
"RTN","PSDNU2",40,0)
 S ^TMP("PSDNU",$J,PSDNAOUN,PSDRN,PSDPN,JJ)=QTY_"^"_NURS_"^"_$S(JJ2=2:"DISPENSE",JJ2=3:"RET/STK",JJ2=4:"DESTROY",JJ2=5:"TRANSFER",1:"N/A")
"RTN","PSDNU2",41,0)
 S:'$D(^TMP("PSDNUT",$J,PSDNAOUN)) ^TMP("PSDNUT",$J,PSDNAOUN)=0 S:'PSDOK ^TMP("PSDNUT",$J,PSDNAOUN)=+^TMP("PSDNUT",$J,PSDNAOUN)+1
"RTN","PSDNU2",42,0)
 S:'$D(^TMP("PSDNUS",$J,PSDNAOUN,PSDRN)) ^TMP("PSDNUS",$J,PSDNAOUN,PSDRN)=0 S:'PSDOK ^TMP("PSDNUS",$J,PSDNAOUN,PSDRN)=+^TMP("PSDNUS",$J,PSDNAOUN,PSDRN)+1
"RTN","PSDNU2",43,0)
 S:'$D(^TMP("PSDNUQ",$J,PSDNAOUN,PSDRN)) ^TMP("PSDNUQ",$J,PSDNAOUN,PSDRN)=0 S ^TMP("PSDNUQ",$J,PSDNAOUN,PSDRN)=+^TMP("PSDNUQ",$J,PSDNAOUN,PSDRN)+QTY
"RTN","PSDNU2",44,0)
 S:'$D(^TMP("PSDNUG",$J)) ^TMP("PSDNUG",$J)=0 S:'PSDOK ^TMP("PSDNUG",$J)=+^TMP("PSDNUG",$J)+1
"RTN","PSDNU2",45,0)
 S PSDOK=0
"RTN","PSDNU2",46,0)
 Q
"RTN","PSDNU2",47,0)
HDR ;lists header information
"RTN","PSDNU2",48,0)
 I $E(IOST,1,2)="C-",PG K DA,DIR S DIR(0)="E" D ^DIR K DIR I 'Y S PSDOUT=1 Q
"RTN","PSDNU2",49,0)
 W:$Y @IOF S PG=PG+1 W !,"NAOU/DRUG USAGE REPORT  -  DATE: "_RPDT,?70,"PAGE: ",PG,!
"RTN","PSDNU2",50,0)
 W:$D(PSDNAOU) "NAOU: ",PSDNAOU,!
"RTN","PSDNU2",51,0)
 W "From ",$P(PSDATE,"^")," to ",$P(PSDATE,"^",2),!!
"RTN","PSDNU2",52,0)
 W !,?2,"=> DRUG",!,?16,"DATE",!,"DISP #",?15,"FILLED",?25,"QUANTITY",?37,"ORDERED BY",?70,"TYPE",!,LN,!
"RTN","PSDNU2",53,0)
 Q
"RTN","PSDNU2",54,0)
TOT Q:PSDOUT  W !,"---------",?25,"----------",!,?3,^TMP("PSDNUS",$J,PSDNAOU,PSDR),?25,$J(^TMP("PSDNUQ",$J,PSDNAOU,PSDR),6),?37,"Totals",!
"RTN","PSDNU2",55,0)
 Q
"RTN","PSDNU2",56,0)
NTOT Q:PSDOUT  W !,"NAOU Subtotal # of Orders: ",^TMP("PSDNUT",$J,PSDNAOU),!
"RTN","PSDNU2",57,0)
 Q
"RTN","PSDNU2",58,0)
GTOT ;grand total
"RTN","PSDNU2",59,0)
 Q:PSDOUT
"RTN","PSDNU2",60,0)
 W !,"Grand Total # of Orders: ",+$G(^TMP("PSDNUG",$J)),!
"RTN","PSDNU2",61,0)
 Q
"RTN","PSDNU2",62,0)
NODATA ; PRINT NO DATA MESSAGE FOR NAOUS THAT HAVE NO USAGE  ;; RJS*75
"RTN","PSDNU2",63,0)
 I $D(LOC) D
"RTN","PSDNU2",64,0)
 .S PSDLOC=0 F  S PSDLOC=$O(LOC(PSDLOC)) Q:'PSDLOC  D
"RTN","PSDNU2",65,0)
 ..S PSDNAOUN=$P($G(^PSD(58.8,PSDLOC,0)),"^",1)
"RTN","PSDNU2",66,0)
 ..I '$D(^TMP("PSDNU",$J,PSDNAOUN)) S ^TMP("PSDNU",$J,PSDNAOUN,0)="",^TMP("PSDNUT",$J,PSDNAOUN)=0,^TMP("PSDNUS",$J,PSDNAOUN,0)=0
"RTN","PSDNU2",67,0)
 Q
"RTN","PSDNU3")
0^4^B3988500^B3705047
"RTN","PSDNU3",1,0)
PSDNU3 ;BIR/JPW-Print NAOU Usage Report Summary Totals ; 2 Aug 94
"RTN","PSDNU3",2,0)
 ;;3.0;CONTROLLED SUBSTANCES ;**75**;13 Feb 97;Build 2
"RTN","PSDNU3",3,0)
PRINT ;prints data for stock drugs
"RTN","PSDNU3",4,0)
 K LN S $P(LN,"-",80)="",(PG,PSDOUT)=0,%DT="",X="T" D ^%DT X ^DD("DD") S RPDT=Y
"RTN","PSDNU3",5,0)
 I '$D(^TMP("PSDNU",$J)) D HDR W !!,?10,"*****  NO DATA AVAILABLE FOR THIS REPORT  *****" Q
"RTN","PSDNU3",6,0)
 S JJ="" F  S JJ=$O(^TMP("PSDNUS",$J,JJ)) Q:JJ=""!(PSDOUT)  D HDR S KK="" F  S KK=$O(^TMP("PSDNUS",$J,JJ,KK)) D:KK="" NTOT Q:KK=""!(PSDOUT)  D TOT
"RTN","PSDNU3",7,0)
 Q
"RTN","PSDNU3",8,0)
HDR ;lists header information
"RTN","PSDNU3",9,0)
 I $E(IOST,1,2)="C-",PG K DA,DIR S DIR(0)="E" D ^DIR K DIR I 'Y S PSDOUT=1 Q
"RTN","PSDNU3",10,0)
 W:$Y @IOF S PG=PG+1 W !,"SUMMARY NAOU/DRUG USAGE REPORT  -  DATE: "_RPDT,?70,"PAGE: ",PG,!
"RTN","PSDNU3",11,0)
 I ANS="N",$D(JJ) W "NAOU: ",JJ,!
"RTN","PSDNU3",12,0)
 I ANS="D",$D(JJ) W "DRUG: ",JJ,!
"RTN","PSDNU3",13,0)
 W "From ",$P(PSDATE,"^")," to ",$P(PSDATE,"^",2),!!
"RTN","PSDNU3",14,0)
 W !,?2,"=> ",$S(ANS="D":"NAOU",1:"DRUG"),!,"TOTAL # OF ORDERS",?30,"TOTAL QUANTITY",!,LN,!
"RTN","PSDNU3",15,0)
 Q
"RTN","PSDNU3",16,0)
TOT Q:PSDOUT  I $Y+8>IOSL D HDR
"RTN","PSDNU3",17,0)
 I ANS="N",KK=0 W !!,?10,"*****  NO DATA AVAILABLE FOR THIS REPORT  *****" Q
"RTN","PSDNU3",18,0)
 W !!,?2,"=> ",KK,!,$J(^TMP("PSDNUS",$J,JJ,KK),8),?34,$J(^TMP("PSDNUQ",$J,JJ,KK),6)
"RTN","PSDNU3",19,0)
 Q
"RTN","PSDNU3",20,0)
NTOT Q:PSDOUT  I $Y+6>IOSL D HDR
"RTN","PSDNU3",21,0)
 W !!,?2,"=> ",KK
"RTN","PSDNU3",22,0)
 W !!,$S(ANS="D":"DRUG",1:"NAOU")," Subtotal # of Orders: ",^TMP("PSDNUT",$J,JJ) W:ANS="D" "    Total Quantity: ",^TMP("PSDNUQT",$J,JJ)
"RTN","PSDNU3",23,0)
 W !!,"Grand Total # of Orders: ",+$G(^TMP("PSDNUG",$J)),!
"RTN","PSDNU3",24,0)
 Q
"RTN","PSDOPTN")
0^1^B20101780^B18659539
"RTN","PSDOPTN",1,0)
PSDOPTN ;BIR/LTL - Review OP Transactions for a Drug (cont.) ; 24 Jan 95
"RTN","PSDOPTN",2,0)
 ;;3.0;CONTROLLED SUBSTANCES ;**18,55,75**;13 Feb 97;Build 2
"RTN","PSDOPTN",3,0)
 ;
"RTN","PSDOPTN",4,0)
 ;References to ^PSD(58.8, covered by DBIA2711
"RTN","PSDOPTN",5,0)
 ;References to DD(58.81 and ^PSD(58.81 are covered by DBIA2808
"RTN","PSDOPTN",6,0)
 ;References to ^PSDRUG( are covered by DBIA221
"RTN","PSDOPTN",7,0)
 ;References to ^PSRX( are covered by DBIA986
"RTN","PSDOPTN",8,0)
 S DIR(0)="DA^2910501::AEPT"
"RTN","PSDOPTN",9,0)
 S DIR("A")="Beginning date@time filled (not posted): ",DIR("?")="I will list Outpatient transactions for your selected drug(s) within your selected date@time range.  Please don't enter a date@time in the future" W ! D ^DIR G:Y<1 END
"RTN","PSDOPTN",10,0)
 S (PSDT,PSDTB)=Y,PSDTB(2)=Y(0)
"RTN","PSDOPTN",11,0)
 S DIR(0)="DA^"_PSDT_"::AET"
"RTN","PSDOPTN",12,0)
 S DIR("A")="Ending date@time filled (not posted): "
"RTN","PSDOPTN",13,0)
 S DIR("?")=$G(DIR("?"))_" or before "_$G(PSDTB(2))
"RTN","PSDOPTN",14,0)
 W ! D ^DIR K DIR G:Y<1 END S PSDTB(1)=Y,PSDTB(3)=Y(0)
"RTN","PSDOPTN",15,0)
 S:'$P(PSDTB(1),".",2) PSDTB(1)=PSDTB(1)+.999999
"RTN","PSDOPTN",16,0)
 S Y=$P($G(^PSD(58.8,+PSDLOC,2)),"^",9),C=$P(^DD(58.8,24,0),"^",2) D Y^DIQ S PSDEV=Y
"RTN","PSDOPTN",17,0)
DEV ;device
"RTN","PSDOPTN",18,0)
 K IO("Q") N %ZIS,IOP,POP S %ZIS="Q",%ZIS("B")=PSDEV W ! D ^%ZIS I POP W !,"NO DEVICE SELECTED OR OUTPUT PRINTED!" Q
"RTN","PSDOPTN",19,0)
 I $D(IO("Q")) N ZTDESC,ZTIO,ZTRTN,ZTSAVE,ZTDTH,ZTSK S ZTRTN="START^PSDOPTN",ZTDESC="Drug OP transaction review" D SAVE D ^%ZTLOAD,HOME^%ZIS S PSDOUT=1 G END
"RTN","PSDOPTN",20,0)
START ;compiles
"RTN","PSDOPTN",21,0)
 U IO N PSDR,PG S (PG,PSDOUT)=0 K LN D HEADER S PSDT=PSDT-1
"RTN","PSDOPTN",22,0)
 ;loop thru Prescription file by date filled
"RTN","PSDOPTN",23,0)
 F  S PSDT=$O(^PSRX("AD",PSDT)) Q:'PSDT!(PSDT>PSDTB(1))  W:$E(IOST)="C" "." S PSDT(1)=0 D
"RTN","PSDOPTN",24,0)
 .F  S PSDT(1)=$O(^PSRX("AD",PSDT,PSDT(1))) Q:'PSDT(1)  D
"RTN","PSDOPTN",25,0)
 ..S PSDT(5)=$G(^PSRX(PSDT(1),0))
"RTN","PSDOPTN",26,0)
 ..S PSDT(2)=$P($G(^PSDRUG(+$P(PSDT(5),U,6),0)),U) Q:PSDT(2)']""
"RTN","PSDOPTN",27,0)
 ..Q:'$D(^TMP("PSD",$J,PSDT(2)))  S PSDT(4)=""
"RTN","PSDOPTN",28,0)
 ..F  S PSDT(4)=$O(^PSRX("AD",PSDT,PSDT(1),PSDT(4))) Q:PSDT(4)=""  D
"RTN","PSDOPTN",29,0)
 ...S PSDCMOP=0
"RTN","PSDOPTN",30,0)
 ...I $D(^PSRX(PSDT(1),4)) S PSDCMP=0 F  S PSDCMP=$O(^PSRX(PSDT(1),4,PSDCMP)) Q:'PSDCMP  D
"RTN","PSDOPTN",31,0)
 ....I $P(^PSRX(PSDT(1),4,PSDCMP,0),U,4)<3 S PSDCMOP=1
"RTN","PSDOPTN",32,0)
 ...;Returned to stock?
"RTN","PSDOPTN",33,0)
 ...Q:$S('PSDT(4):$P($G(^PSRX(PSDT(1),2)),U,15),1:$P($G(^PSRX(PSDT(1),1,PSDT(4),0)),U,16))
"RTN","PSDOPTN",34,0)
 ...;posted to the vault?
"RTN","PSDOPTN",35,0)
 ...S PSDT(3)=0
"RTN","PSDOPTN",36,0)
 ...F  S PSDT(3)=$O(^PSD(58.81,"AOP",PSDT(1),PSDT(3))) Q:'PSDT(3)!($S('PSDT(4)&('$P($G(^PSD(58.81,+PSDT(3),6)),U,2)):1,PSDT(4)=$P($G(^(6)),U,2):1,1:0))
"RTN","PSDOPTN",37,0)
 ...Q:PSDT(3)
"RTN","PSDOPTN",38,0)
 ...;suspended & printed
"RTN","PSDOPTN",39,0)
 ...S (PSDT(3),PSDT(8))=0
"RTN","PSDOPTN",40,0)
 ...I PSDT>DT D  Q:'PSDT(8)
"RTN","PSDOPTN",41,0)
 ....F  S PSDT(3)=$O(^PSRX(PSDT(1),"L",PSDT(3))) Q:'PSDT(3)  S:$P($G(^PSRX(PSDT(1),"L",PSDT(3),0)),U,2)=PSDT(4) PSDT(8)=1
"RTN","PSDOPTN",42,0)
 ...;quantity
"RTN","PSDOPTN",43,0)
 ...S PSDT(6)=$S('PSDT(4):$P(PSDT(5),U,7),1:$P($G(^PSRX(PSDT(1),1,PSDT(4),0)),U,4))
"RTN","PSDOPTN",44,0)
 ...S DFN=$P(PSDT(5),U,2) N C S Y=DFN,C=$P(^DD(58.81,73,0),U,2) D Y^DIQ
"RTN","PSDOPTN",45,0)
 ...S PSDT(7)=Y D PID^VADPT6 S PSDT(7)=PSDT(7)_" ("_VA("BID")_")"
"RTN","PSDOPTN",46,0)
 ...I $G(PSDCMOP) S PSDCMOP=0 Q
"RTN","PSDOPTN",47,0)
 ...S:$P(PSDT(5),U)]"" ^TMP("PSDO",$J,PSDT(2),$P(PSDT(5),U),PSDT(4))=PSDT(6)_U_PSDT_U_PSDT(7)
"RTN","PSDOPTN",48,0)
 K PSDCMP
"RTN","PSDOPTN",49,0)
 I '$D(^TMP("PSDO",$J)) W !!,"Nothing to Report.",!! G END
"RTN","PSDOPTN",50,0)
 F  S PSDT=$O(^TMP("PSDO",$J,PSDT)) Q:PSDT']""!PSDOUT  D  Q:PSDOUT
"RTN","PSDOPTN",51,0)
 .D:$Y+5>IOSL HEADER Q:PSDOUT  W !!,"Drug =>  ",PSDT  S PSDT(1)=0
"RTN","PSDOPTN",52,0)
 .F  S PSDT(1)=$O(^TMP("PSDO",$J,PSDT,PSDT(1))) Q:'PSDT(1)!PSDOUT  D  Q:PSDOUT
"RTN","PSDOPTN",53,0)
 ..S PSDT(2)=""
"RTN","PSDOPTN",54,0)
 ..F  S PSDT(2)=$O(^TMP("PSDO",$J,PSDT,PSDT(1),PSDT(2))) Q:PSDT(2)=""!PSDOUT  D  Q:PSDOUT
"RTN","PSDOPTN",55,0)
 ...I $Y+4>IOSL D HEADER Q:PSDOUT  W !!,PSDT," (continued)"
"RTN","PSDOPTN",56,0)
 ...W !!,PSDT(1)," (",PSDT(2),")"
"RTN","PSDOPTN",57,0)
 ...S PSDT(3)=$G(^TMP("PSDO",$J,PSDT,PSDT(1),PSDT(2)))
"RTN","PSDOPTN",58,0)
 ...W ?9,$J($P(PSDT(3),U),4) S Y=$P(PSDT(3),U,2) X ^DD("DD") W ?20,Y
"RTN","PSDOPTN",59,0)
 ...W ?40,$P(PSDT(3),U,3)
"RTN","PSDOPTN",60,0)
END W:$E(IOST)'="C" @IOF
"RTN","PSDOPTN",61,0)
 I $E(IOST)="C",'PSDOUT S DIR(0)="EA",DIR("A")="END OF REPORT!  Press <RET> to return to the menu." W ! D ^DIR
"RTN","PSDOPTN",62,0)
 D ^%ZISC S:$D(ZTQUEUED) ZTREQ="@"
"RTN","PSDOPTN",63,0)
 D KVAR^VADPT K IO("Q"),VA("PID"),VA("BID"),^TMP("PSDO",$J),PSDCMOP
"RTN","PSDOPTN",64,0)
 Q
"RTN","PSDOPTN",65,0)
HEADER I $E(IOST,1,2)'="P-",PG S DIR(0)="E" D ^DIR K DIR I 'Y S PSDOUT=1 Q
"RTN","PSDOPTN",66,0)
 I $$S^%ZTLOAD W !!,"Task #",$G(ZTSK),", ",$G(ZTDESC)," was stopped by ",$P($G(^VA(200,+$G(DUZ),0)),U),"." S PSDOUT=1
"RTN","PSDOPTN",67,0)
 W:$Y @IOF S $P(LN,"-",81)="",PG=PG+1 W !,"Outpatient Activity from ",PSDTB(2)," to ",PSDTB(3),?70,"PAGE: ",PG,!,LN,!,"Rx#",?10,"QTY",?20,"Fill Date",?40,"Patient",!,LN
"RTN","PSDOPTN",68,0)
 Q
"RTN","PSDOPTN",69,0)
SAVE ;
"RTN","PSDOPTN",70,0)
 S ZTSAVE("^TMP(""PSD"",$J,")=""
"RTN","PSDOPTN",71,0)
 S (ZTSAVE("PSDT"),ZTSAVE("PSDLOC"),ZTSAVE("PSDTB"),ZTSAVE("PSDTB("))=""
"RTN","PSDOPTN",72,0)
 Q
"VER")
8.0^22.0
"BLD",9381,6)
^64
**END**
**END**

