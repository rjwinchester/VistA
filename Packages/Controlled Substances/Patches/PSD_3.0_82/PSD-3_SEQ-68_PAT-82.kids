Released PSD*3*82 SEQ #68
Extracted from mail message
**KIDS**:PSD*3.0*82^

**INSTALL NAME**
PSD*3.0*82
"BLD",10421,0)
PSD*3.0*82^CONTROLLED SUBSTANCES^0^3171213^y
"BLD",10421,1,0)
^^2^2^3171205^
"BLD",10421,1,1,0)
NSR20160911 To allow PSD TECH ADV key holders to run the Controlled 
"BLD",10421,1,2,0)
Substances NAOU Usage Report.
"BLD",10421,4,0)
^9.64PA^^
"BLD",10421,6.3)
3
"BLD",10421,"ABPKG")
n
"BLD",10421,"KRN",0)
^9.67PA^779.2^20
"BLD",10421,"KRN",.4,0)
.4
"BLD",10421,"KRN",.401,0)
.401
"BLD",10421,"KRN",.402,0)
.402
"BLD",10421,"KRN",.403,0)
.403
"BLD",10421,"KRN",.5,0)
.5
"BLD",10421,"KRN",.84,0)
.84
"BLD",10421,"KRN",3.6,0)
3.6
"BLD",10421,"KRN",3.8,0)
3.8
"BLD",10421,"KRN",9.2,0)
9.2
"BLD",10421,"KRN",9.8,0)
9.8
"BLD",10421,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",10421,"KRN",9.8,"NM",1,0)
PSDNU^^0^B18350062
"BLD",10421,"KRN",9.8,"NM","B","PSDNU",1)

"BLD",10421,"KRN",19,0)
19
"BLD",10421,"KRN",19.1,0)
19.1
"BLD",10421,"KRN",101,0)
101
"BLD",10421,"KRN",409.61,0)
409.61
"BLD",10421,"KRN",771,0)
771
"BLD",10421,"KRN",779.2,0)
779.2
"BLD",10421,"KRN",870,0)
870
"BLD",10421,"KRN",8989.51,0)
8989.51
"BLD",10421,"KRN",8989.52,0)
8989.52
"BLD",10421,"KRN",8994,0)
8994
"BLD",10421,"KRN","B",.4,.4)

"BLD",10421,"KRN","B",.401,.401)

"BLD",10421,"KRN","B",.402,.402)

"BLD",10421,"KRN","B",.403,.403)

"BLD",10421,"KRN","B",.5,.5)

"BLD",10421,"KRN","B",.84,.84)

"BLD",10421,"KRN","B",3.6,3.6)

"BLD",10421,"KRN","B",3.8,3.8)

"BLD",10421,"KRN","B",9.2,9.2)

"BLD",10421,"KRN","B",9.8,9.8)

"BLD",10421,"KRN","B",19,19)

"BLD",10421,"KRN","B",19.1,19.1)

"BLD",10421,"KRN","B",101,101)

"BLD",10421,"KRN","B",409.61,409.61)

"BLD",10421,"KRN","B",771,771)

"BLD",10421,"KRN","B",779.2,779.2)

"BLD",10421,"KRN","B",870,870)

"BLD",10421,"KRN","B",8989.51,8989.51)

"BLD",10421,"KRN","B",8989.52,8989.52)

"BLD",10421,"KRN","B",8994,8994)

"BLD",10421,"QDEF")
^^^^NO^^^^NO^^NO
"BLD",10421,"QUES",0)
^9.62^^
"BLD",10421,"REQB",0)
^9.611^1^1
"BLD",10421,"REQB",1,0)
PSD*3.0*8^1
"BLD",10421,"REQB","B","PSD*3.0*8",1)

"MBREQ")
0
"PKG",328,-1)
1^1
"PKG",328,0)
CONTROLLED SUBSTANCES^PSD^Controlled Substances Inventory and Tracking module.
"PKG",328,20,0)
^9.402P^^
"PKG",328,22,0)
^9.49I^1^1
"PKG",328,22,1,0)
3.0^2970213^2980330^1
"PKG",328,22,1,"PAH",1,0)
82^3171213
"PKG",328,22,1,"PAH",1,1,0)
^^2^2^3171213
"PKG",328,22,1,"PAH",1,1,1,0)
NSR20160911 To allow PSD TECH ADV key holders to run the Controlled 
"PKG",328,22,1,"PAH",1,1,2,0)
Substances NAOU Usage Report.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","PSDNU")
0^1^B18350062^B18180510
"RTN","PSDNU",1,0)
PSDNU ;BIR/BJW-Usage Report for NAOUs ; 13 Nov 17
"RTN","PSDNU",2,0)
 ;;3.0;CONTROLLED SUBSTANCES;**8,82**;13 Feb 97;Build 3
"RTN","PSDNU",3,0)
 ;**Y2K compliance**,"P" added to date input string
"RTN","PSDNU",4,0)
 I '$D(PSDSITE) D ^PSDSET Q:'$D(PSDSITE)
"RTN","PSDNU",5,0)
 I '$D(^XUSEC("PSJ RPHARM",DUZ))&('$D(^XUSEC("PSD TECH ADV",DUZ))) D  G END  ; PSD*3.0*82 changes this and next 3 lines
"RTN","PSDNU",6,0)
 . W $C(7),!!,?9,"** Please contact your Pharmacy Coordinator for access to print"
"RTN","PSDNU",7,0)
 . W !,?12,"the narcotic NAOU Usage Report."
"RTN","PSDNU",8,0)
 . W !!,"PSJ RPHARM or PSD TECH ADV security key is required.",!
"RTN","PSDNU",9,0)
 W !!,"Select Date Range for NAOU Usage Report",!
"RTN","PSDNU",10,0)
DATE ;ask date range
"RTN","PSDNU",11,0)
 W ! K %DT S %DT="AEP",%DT("A")="Start with Date: " D ^%DT I Y<0 S PSDOUT=1 G END
"RTN","PSDNU",12,0)
 S PSDSD=Y D D^DIQ S PSDATE=Y,%DT("A")="End with Date: " D ^%DT I Y<0 S PSDOUT=1 G END
"RTN","PSDNU",13,0)
 I Y<PSDSD W !!,"The ending date of the range must be later than the starting date." G DATE
"RTN","PSDNU",14,0)
 S PSDED=Y D D^DIQ S PSDATE=PSDATE_"^"_Y,PSDSD=PSDSD-.0001,PSDED=PSDED+.9999
"RTN","PSDNU",15,0)
 D NOW^%DTC S PSDT=X
"RTN","PSDNU",16,0)
SUM ;if summary only
"RTN","PSDNU",17,0)
 W ! K DA,DIR,DIRUT S DIR(0)="Y",DIR("A")="Do you want to print the summary totals only",DIR("B")="NO"
"RTN","PSDNU",18,0)
 S DIR("?",1)="Answer 'YES' to print only the summary totals for this report,",DIR("?")="answer 'NO' to print the detail report including summary totals."
"RTN","PSDNU",19,0)
 D ^DIR K DIR G:$D(DIRUT) END S SUM=Y
"RTN","PSDNU",20,0)
SORT ;sel sort order
"RTN","PSDNU",21,0)
 K DA,DIR,DIRUT S DIR(0)="SO^D:DRUG/ALL NAOUS;N:NAOU/ALL DRUGS",DIR("A",1)="You may print by either of these sorting methods."
"RTN","PSDNU",22,0)
 S DIR("?",1)="Enter 'D' if you wish to print the NAOU Usage Report sorted by DRUG",DIR("?",2)="  and within DRUG by each NAOU."
"RTN","PSDNU",23,0)
 S DIR("?",3)="Enter 'N' to print the NAOU Usage Report by NAOU",DIR("?")="  and within NAOU by each DRUG."
"RTN","PSDNU",24,0)
 S DIR("A")="Select SORT ORDER for Report" D ^DIR K DIR G:$D(DIRUT) END S ANS=Y
"RTN","PSDNU",25,0)
 G:ANS="D" DRUG
"RTN","PSDNU",26,0)
ASKN ;ask NAOU(s)
"RTN","PSDNU",27,0)
 W !!,?5,"You may select a single NAOU, several NAOUs,",!,?5,"or enter ^ALL to select all NAOUs.",!!
"RTN","PSDNU",28,0)
 K DA,DIC
"RTN","PSDNU",29,0)
 F  S DIC=58.8,DIC("A")="Select NAOU: ",DIC(0)="QEA",DIC("S")="I $S('$D(^(""I"")):1,'^(""I""):1,+^(""I"")>PSDT:1,1:0),$P(^(0),""^"",2)=""N"",$P(^(0),""^"",3)=+PSDSITE" D ^DIC K DIC Q:Y<0  S LOC(+Y)=""
"RTN","PSDNU",30,0)
 I '$D(LOC)&(X'="^ALL") G END
"RTN","PSDNU",31,0)
 I X="^ALL" F PSD=0:0 S PSD=$O(^PSD(58.8,PSD)) Q:'PSD  I $S('$D(^PSD(58.8,PSD,"I")):1,'^("I"):1,+^("I")>PSDT:1,1:0),$P($G(^(0)),"^",2)="N",$P($G(^(0)),"^",3)=+PSDSITE S LOC(PSD)=""
"RTN","PSDNU",32,0)
 G DEV
"RTN","PSDNU",33,0)
DRUG ;ask drug(s)
"RTN","PSDNU",34,0)
 W !!,?5,"You may select a single drug, several drugs,",!,?5,"or enter ^ALL to select all drugs.",!!
"RTN","PSDNU",35,0)
 K DA,DIC F  S DIC("A")="Select DRUG: ",DIC=50,DIC(0)="QEAM",DIC("S")="I $S('$D(^(""I"")):1,+^(""I"")>DT:1,1:0),$P($G(^(2)),""^"",3)[""N""" D ^DIC K DIC Q:Y<0  S LOC(+Y)=""
"RTN","PSDNU",36,0)
 I '$D(LOC)&(X'="^ALL") G END
"RTN","PSDNU",37,0)
 I X="^ALL" S ALL=1
"RTN","PSDNU",38,0)
DEV ;asks device and queueing information
"RTN","PSDNU",39,0)
 W !!,"This report is designed for a 80 column format.",!,"You may queue this report to print at a later time.",!!
"RTN","PSDNU",40,0)
 K %ZIS,IOP,IO("Q"),POP S %ZIS="QM",%ZIS("B")="" D ^%ZIS I POP W !,"NO DEVICE SELECTED OR REPORT PRINTED!" G END
"RTN","PSDNU",41,0)
 I $D(IO("Q")) K IO("Q"),ZTIO,ZTSAVE,ZTDTH,ZTSK S ZTRTN=$S(ANS="D":"START^PSDNU1",1:"START^PSDNU2"),ZTDESC="CS PHARM NAOU Usage Report" D SAVE,^%ZTLOAD,HOME^%ZIS K ZTSK G END
"RTN","PSDNU",42,0)
 U IO G:ANS="D" START^PSDNU1 G:ANS="N" START^PSDNU2
"RTN","PSDNU",43,0)
END ;
"RTN","PSDNU",44,0)
 K %,%DT,%H,%I,%ZIS,ALL,ANS,DA,DATE,DIC,DIR,DIROUT,DIRUT,DTOUT,DUOUT,IO("Q"),LOC
"RTN","PSDNU",45,0)
 K POP,PSD,PSDATE,PSDED,PSDOUT,PSDSD,PSDT,SUM,X,Y,ZTDESC,ZTIO,ZTRTN,ZTSAVE D ^%ZISC
"RTN","PSDNU",46,0)
 S:$D(ZTQUEUED) ZTREQ="@"
"RTN","PSDNU",47,0)
 Q
"RTN","PSDNU",48,0)
SAVE ;save variables for queueing
"RTN","PSDNU",49,0)
 S ZTSAVE("ANS")="",ZTSAVE("SUM")="",ZTSAVE("PSDSITE")="",ZTSAVE("PSD")="",ZTSAVE("PSDT")="" S:$D(LOC) ZTSAVE("LOC(")=""
"RTN","PSDNU",50,0)
 S:$D(ALL) ZTSAVE("ALL")=""
"RTN","PSDNU",51,0)
 S (ZTSAVE("PSDATE"),ZTSAVE("PSDED"),ZTSAVE("PSDSD"))=""
"RTN","PSDNU",52,0)
 Q
"VER")
8.0^22.2
"BLD",10421,6)
^68
**END**
**END**

