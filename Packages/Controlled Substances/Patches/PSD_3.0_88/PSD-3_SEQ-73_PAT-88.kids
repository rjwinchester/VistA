Released PSD*3*88 SEQ #73
Extracted from mail message
**KIDS**:PSD*3.0*88^

**INSTALL NAME**
PSD*3.0*88
"BLD",11182,0)
PSD*3.0*88^CONTROLLED SUBSTANCES^0^3190618^y
"BLD",11182,1,0)
^^2^2^3190618^^
"BLD",11182,1,1,0)
The description of this build can be found in the National Patch Module 
"BLD",11182,1,2,0)
under PSD*3.0*88.
"BLD",11182,4,0)
^9.64PA^^
"BLD",11182,6.3)
1
"BLD",11182,"KRN",0)
^9.67PA^1.5^24
"BLD",11182,"KRN",.4,0)
.4
"BLD",11182,"KRN",.401,0)
.401
"BLD",11182,"KRN",.402,0)
.402
"BLD",11182,"KRN",.403,0)
.403
"BLD",11182,"KRN",.5,0)
.5
"BLD",11182,"KRN",.84,0)
.84
"BLD",11182,"KRN",1.5,0)
1.5
"BLD",11182,"KRN",1.6,0)
1.6
"BLD",11182,"KRN",1.61,0)
1.61
"BLD",11182,"KRN",1.62,0)
1.62
"BLD",11182,"KRN",3.6,0)
3.6
"BLD",11182,"KRN",3.8,0)
3.8
"BLD",11182,"KRN",9.2,0)
9.2
"BLD",11182,"KRN",9.8,0)
9.8
"BLD",11182,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",11182,"KRN",9.8,"NM",1,0)
PSDOPT1^^0^B23235328
"BLD",11182,"KRN",9.8,"NM","B","PSDOPT1",1)

"BLD",11182,"KRN",19,0)
19
"BLD",11182,"KRN",19.1,0)
19.1
"BLD",11182,"KRN",101,0)
101
"BLD",11182,"KRN",409.61,0)
409.61
"BLD",11182,"KRN",771,0)
771
"BLD",11182,"KRN",779.2,0)
779.2
"BLD",11182,"KRN",870,0)
870
"BLD",11182,"KRN",8989.51,0)
8989.51
"BLD",11182,"KRN",8989.52,0)
8989.52
"BLD",11182,"KRN",8994,0)
8994
"BLD",11182,"KRN","B",.4,.4)

"BLD",11182,"KRN","B",.401,.401)

"BLD",11182,"KRN","B",.402,.402)

"BLD",11182,"KRN","B",.403,.403)

"BLD",11182,"KRN","B",.5,.5)

"BLD",11182,"KRN","B",.84,.84)

"BLD",11182,"KRN","B",1.5,1.5)

"BLD",11182,"KRN","B",1.6,1.6)

"BLD",11182,"KRN","B",1.61,1.61)

"BLD",11182,"KRN","B",1.62,1.62)

"BLD",11182,"KRN","B",3.6,3.6)

"BLD",11182,"KRN","B",3.8,3.8)

"BLD",11182,"KRN","B",9.2,9.2)

"BLD",11182,"KRN","B",9.8,9.8)

"BLD",11182,"KRN","B",19,19)

"BLD",11182,"KRN","B",19.1,19.1)

"BLD",11182,"KRN","B",101,101)

"BLD",11182,"KRN","B",409.61,409.61)

"BLD",11182,"KRN","B",771,771)

"BLD",11182,"KRN","B",779.2,779.2)

"BLD",11182,"KRN","B",870,870)

"BLD",11182,"KRN","B",8989.51,8989.51)

"BLD",11182,"KRN","B",8989.52,8989.52)

"BLD",11182,"KRN","B",8994,8994)

"BLD",11182,"QUES",0)
^9.62^^
"BLD",11182,"REQB",0)
^9.611^1^1
"BLD",11182,"REQB",1,0)
PSD*3.0*71^1
"BLD",11182,"REQB","B","PSD*3.0*71",1)

"MBREQ")
0
"PKG",328,-1)
1^1
"PKG",328,0)
CONTROLLED SUBSTANCES^PSD^Controlled Substances Inventory and Tracking module.
"PKG",328,22,0)
^9.49I^1^1
"PKG",328,22,1,0)
3.0^2970213^2980330^1
"PKG",328,22,1,"PAH",1,0)
88^3190618
"PKG",328,22,1,"PAH",1,1,0)
^^2^2^3190618
"PKG",328,22,1,"PAH",1,1,1,0)
The description of this build can be found in the National Patch Module 
"PKG",328,22,1,"PAH",1,1,2,0)
under PSD*3.0*88.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","PSDOPT1")
0^1^B23235328^B23121655
"RTN","PSDOPT1",1,0)
PSDOPT1 ;BIR/JPW,LTL - Outpatient Rx Entry (cont'd) ;20 July 94
"RTN","PSDOPT1",2,0)
 ;;3.0;CONTROLLED SUBSTANCES;**30,66,71,88**;13 Feb 97;Build 1
"RTN","PSDOPT1",3,0)
 ;Reference to PS(52.5 supported by DBIA #786
"RTN","PSDOPT1",4,0)
 ;References to ^PSD(58.8 are covered by DBIA #2711
"RTN","PSDOPT1",5,0)
 ;References to file 58.81 are covered by DBIA #2808
"RTN","PSDOPT1",6,0)
 ;Reference to PSRX( supported by DBIA #986
"RTN","PSDOPT1",7,0)
 ;Reference to routine PSOCSRL supported by DBIA #983
"RTN","PSDOPT1",8,0)
UPDATE W !!,"Creating an Outpatient Transaction..."
"RTN","PSDOPT1",9,0)
 F  L +^PSD(58.8,+PSDS,1,PSDR,0):$S($G(DILOCKTM)>0:DILOCKTM,1:3) I  Q
"RTN","PSDOPT1",10,0)
 D NOW^%DTC S PSDT=+% S BAL=+$P(^PSD(58.8,+PSDS,1,PSDR,0),"^",4),$P(^(0),"^",4)=$P(^(0),"^",4)-QTY
"RTN","PSDOPT1",11,0)
 L -^PSD(58.8,+PSDS,1,PSDR,0)
"RTN","PSDOPT1",12,0)
 W "updating..."
"RTN","PSDOPT1",13,0)
 F  L +^PSD(58.81,0):$S($G(DILOCKTM)>0:DILOCKTM,1:3) I  Q
"RTN","PSDOPT1",14,0)
FIND S PSDA=$P(^PSD(58.81,0),"^",3)+1 I $D(^PSD(58.81,PSDA)) S $P(^PSD(58.81,0),"^",3)=PSDA G FIND
"RTN","PSDOPT1",15,0)
 K DA,DIC,DLAYGO S (DIC,DLAYGO)=58.81,DIC(0)="L",(X,DINUM)=PSDA D ^DIC K DIC,DLAYGO
"RTN","PSDOPT1",16,0)
 L -^PSD(58.81,0)
"RTN","PSDOPT1",17,0)
ADD ;set trans
"RTN","PSDOPT1",18,0)
 S ^PSD(58.81,PSDA,0)=PSDA_"^6^"_+PSDS_"^"_PSDT_"^"_PSDR_"^"_QTY_"^"_PSDUZ_"^^^"_BAL
"RTN","PSDOPT1",19,0)
 S ^PSD(58.81,PSDA,6)=PSDRX_"^"_$S($G(NEW(1)):NEW(1),1:"")_"^"_DAT_"^"_$S($G(NEW(2)):NEW(2),1:"")_"^"_RXNUM_"^"_PSDRPH
"RTN","PSDOPT1",20,0)
 S ^PSD(58.81,PSDA,"CS")=1
"RTN","PSDOPT1",21,0)
 S DIK="^PSD(58.81,",DA=PSDA D IX^DIK K DA,DIK
"RTN","PSDOPT1",22,0)
 W "vault activity..."
"RTN","PSDOPT1",23,0)
DIE I '$D(^PSD(58.8,+PSDS,1,PSDR,4,0)) S ^(0)="^58.800119PA^^"
"RTN","PSDOPT1",24,0)
 K DA,DIC,DD,DO S DA(1)=PSDR,DA(2)=+PSDS,(X,DINUM)=PSDA,DIC(0)="L",DIC="^PSD(58.8,"_+PSDS_",1,"_PSDR_",4," D FILE^DICN K DIC,DINUM
"RTN","PSDOPT1",25,0)
 ;monthly activity
"RTN","PSDOPT1",26,0)
 I '$D(^PSD(58.8,+PSDS,1,PSDR,5,0)) S ^(0)="^58.801A^^"
"RTN","PSDOPT1",27,0)
 I '$D(^PSD(58.8,+PSDS,1,PSDR,5,$E(DT,1,5)*100,0)) K DA,DIC S DIC="^PSD(58.8,"_+PSDS_",1,"_PSDR_",5,",DIC(0)="LM",DLAYGO=58.8,(X,DINUM)=$E(DT,1,5)*100,DA(2)=+PSDS,DA(1)=PSDR D ^DIC K DA,DIC,DINUM,DLAYGO
"RTN","PSDOPT1",28,0)
 K DA,DIE,DR S DIE="^PSD(58.8,"_+PSDS_",1,"_PSDR_",5,",DA(2)=+PSDS,DA(1)=PSDR,DA=$E(DT,1,5)*100,DR="9////^S X=$P($G(^(0)),""^"",6)+QTY" D ^DIE K DA,DIE,DR
"RTN","PSDOPT1",29,0)
 W "done."
"RTN","PSDOPT1",30,0)
 ;check if user has access to release
"RTN","PSDOPT1",31,0)
 D CHKEY^PSDOPT I $G(PSDOUT) Q
"RTN","PSDOPT1",32,0)
 ;PSD*3*30 (Dave B) Check for already released
"RTN","PSDOPT1",33,0)
 I $G(PSDREL)'="" Q
"RTN","PSDOPT1",34,0)
 I $G(PSDRTS)=1 K PSDRTS Q
"RTN","PSDOPT1",35,0)
PSDREL S X="PSOCSRL" X ^%ZOSF("TEST") I $T S XTYPE=$S($G(NEW(2)):"P"_U_NEW(2),$G(NEW(1)):1_U_NEW(1),1:"") D EN^PSOCSRL(PSDRX,XTYPE,PSDRPH)
"RTN","PSDOPT1",36,0)
 Q
"RTN","PSDOPT1",37,0)
 ;
"RTN","PSDOPT1",38,0)
PSDRTS ;Returned to stock continued
"RTN","PSDOPT1",39,0)
 W !,"Updating balances"
"RTN","PSDOPT1",40,0)
 F  L +^PSD(58.8,+PSDS,1,PSDR,0):$S($G(DILOCKTM)>0:DILOCKTM,1:3) I  Q
"RTN","PSDOPT1",41,0)
 D NOW^%DTC S PSDT=+%,BAL=+$P(^PSD(58.8,+PSDS,1,PSDR,0),"^",4),$P(^PSD(58.8,+PSDS,1,PSDR,0),"^",4)=$P(^PSD(58.8,+PSDS,1,PSDR,0),"^",4)+PSDQTY
"RTN","PSDOPT1",42,0)
 L -^PSD(58.8,+PSDS,1,PSDR,0) W "."
"RTN","PSDOPT1",43,0)
 F  L +^PSD(58.81,0):$S($G(DILOCKTM)>0:DILOCKTM,1:3) I  Q
"RTN","PSDOPT1",44,0)
FIND1 S PSDA=$P(^PSD(58.81,0),"^",3)+1 I $D(^PSD(58.81,PSDA)) S $P(^PSD(58.81,0),"^",3)=PSDA G FIND1
"RTN","PSDOPT1",45,0)
 K DA,DIC,DLAYGO S (DIC,DLAYGO)=58.81,DIC(0)="L",(X,DINUM)=PSDA D ^DIC K DIC,DLAYGO
"RTN","PSDOPT1",46,0)
 L -^PSD(58.81,0)
"RTN","PSDOPT1",47,0)
 S ^PSD(58.81,PSDA,0)=PSDA_"^3^"_+PSDS_"^"_PSDT_"^"_PSDR_"^"_PSDQTY_"^"_PSDUZ_"^^^"_BAL
"RTN","PSDOPT1",48,0)
 S ^PSD(58.81,PSDA,3)=PSDT_"^"_PSDQTY_"^"_"Returned by Outpatient"
"RTN","PSDOPT1",49,0)
 S ^PSD(58.81,PSDA,"CS")=1
"RTN","PSDOPT1",50,0)
 S ^PSD(58.81,PSDA,6)=PSDRX_"^"_$S($G(PSDFILL)="R":PSDNUM1,1:"")_"^"_DAT_"^"_$S($G(PSDFILL)="P":PSDNUM1,1:"")_"^"_RXNUM_"^"_PSDRPH
"RTN","PSDOPT1",51,0)
 S PSDRTS=1,QTY=-PSDQTY D DIE
"RTN","PSDOPT1",52,0)
 Q
"RTN","PSDOPT1",53,0)
 ;
"RTN","PSDOPT1",54,0)
PSDORIG ;Check original labels
"RTN","PSDOPT1",55,0)
 ;Check for suspense
"RTN","PSDOPT1",56,0)
 I +$P($G(^PSRX(PSDRX,2)),U,2)'<PSDOIN S PSDRXFD=$P(^(2),U,2) D
"RTN","PSDOPT1",57,0)
 .S PSDSUPN=$O(^PS(52.5,"B",PSDRX,0))
"RTN","PSDOPT1",58,0)
 .I PSDSUPN,$D(^PS(52.5,"C",PSDRXFD,PSDSUPN)),$G(^PS(52.5,PSDSUPN,"P"))'=1 W !!,"Original suspended." S PSDRX(1)="",PSDOUT=1 Q
"RTN","PSDOPT1",59,0)
 .K PSDLBL D VER^PSDOPT
"RTN","PSDOPT1",60,0)
 .I $G(PSOVR) F PSDLBL=0:0 S PSDLBL=$O(^PSRX(PSDRX,"L",PSDLBL)) Q:'PSDLBL  I '+$P($G(^PSRX(PSDRX,"L",PSDLBL,0)),"^",2),'$P($G(^(0)),"^",5) S PSDLBL(1)=1
"RTN","PSDOPT1",61,0)
 .I '$G(PSOVR) F PSDLBL=0:0 S PSDLBL=$O(^PSRX(PSDRX,"L",PSDLBL)) Q:'PSDLBL  I '+$P($G(^PSRX(PSDRX,"L",PSDLBL,0)),"^",2),$P($G(^(0)),"^",5)'["INTERACTION" S PSDLBL(1)=1
"RTN","PSDOPT1",62,0)
 .K PSOVR,PSDERR,PSDSTA,PSDRXIN I '$G(PSDLBL(1)) S PSDRX(1)="",PSDOUT=1 W !!,"Original label not printed." Q
"RTN","PSDOPT1",63,0)
 Q
"RTN","PSDOPT1",64,0)
PSDRFL ;Check refill labels
"RTN","PSDOPT1",65,0)
 I $D(^PSRX(PSDRX,1,PSDFLNO,0)),'$P(^(0),U,16),$P($G(^(0)),U)'<PSDOIN D
"RTN","PSDOPT1",66,0)
 .F PSDLBL=0:0 S PSDLBL=$O(^PSRX(PSDRX,"L",PSDLBL)) Q:'PSDLBL  I $P(^PSRX(PSDRX,"L",PSDLBL,0),U,2)=PSDFLNO S PSDLBL(1)=1
"RTN","PSDOPT1",67,0)
 .I '$G(PSDLBL(1)) W !!,"Refill #",PSDFLNO," label not printed." S PSDOUT=1,PSDRX(1)="" Q
"RTN","PSDOPT1",68,0)
 Q
"RTN","PSDOPT1",69,0)
PSDPRTL ;Chec partial labels
"RTN","PSDOPT1",70,0)
 I $D(^PSRX(PSDRX,"P",PSDFLNO,0)),'$P(^(0),U,16),$P($G(^(0)),U)'<PSDOIN D
"RTN","PSDOPT1",71,0)
 .F PSDLBL=0:0 S PSDLBL=$O(^PSRX(PSDRX,"L",PSDLBL)) Q:'PSDLBL  I $P(^PSRX(PSDRX,"L",0),U,2)=99-PSDFLNO S PSDLBL(1)=1
"RTN","PSDOPT1",72,0)
 .I '$G(PSDLBL(1)) W !!,"Partial #",PSDFLNO," label not printed." S PSDOUT=1,PSDRX(1)="" Q
"RTN","PSDOPT1",73,0)
 Q
"RTN","PSDOPT1",74,0)
RTSMUL ; Setup local array of refills in reverse order
"RTN","PSDOPT1",75,0)
 S PSD1=0 F  S PSD1=$O(^PSD(58.81,"AOP",PSDRX,PSD1)) Q:PSD1'>0  S DATA6=$G(^PSD(58.81,PSD1,6)) D
"RTN","PSDOPT1",76,0)
 .S PSDXXX=PSD1
"RTN","PSDOPT1",77,0)
 .S PSD1MUL=PSD1*-1
"RTN","PSDOPT1",78,0)
 .S PSDMUL(PSD1MUL)=$P(DATA6,"^",2)
"RTN","PSDOPT1",79,0)
 Q
"VER")
8.0^22.2
"BLD",11182,6)
^73
**END**
**END**

