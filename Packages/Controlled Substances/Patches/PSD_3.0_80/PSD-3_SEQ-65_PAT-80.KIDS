Released PSD*3*80 SEQ #65
Extracted from mail message
**KIDS**:PSD*3.0*80^

**INSTALL NAME**
PSD*3.0*80
"BLD",10159,0)
PSD*3.0*80^CONTROLLED SUBSTANCES^0^3160622^y
"BLD",10159,1,0)
^^18^18^3160622^
"BLD",10159,1,1,0)
This patch addresses the following problems:
"BLD",10159,1,2,0)
 
"BLD",10159,1,3,0)
1. INC000000997119 - PRESCRIPTION TRANSACTION
"BLD",10159,1,4,0)
 
"BLD",10159,1,5,0)
Problem:
"BLD",10159,1,6,0)
--------
"BLD",10159,1,7,0)
If two outpatient prescription transaction are created at the same 
"BLD",10159,1,8,0)
date/time for the same pharmacy location, both will not display in the 
"BLD",10159,1,9,0)
Rx (Prescription) Outpatient Dispensing Report [PSD RX DISPENSING REPORT].
"BLD",10159,1,10,0)
 
"BLD",10159,1,11,0)
 
"BLD",10159,1,12,0)
2. INC000001234782 - Ordered By Field
"BLD",10159,1,13,0)
 
"BLD",10159,1,14,0)
Problem:
"BLD",10159,1,15,0)
--------
"BLD",10159,1,16,0)
The CS WORKSHEET (#58.85) file ORDERED BY (#12) field is not being 
"BLD",10159,1,17,0)
updated correctly when someone edits a controlled substance order for an 
"BLD",10159,1,18,0)
NAOU using the CS Order Entry for Ward [PSD ORDER ENTRY] option.
"BLD",10159,4,0)
^9.64PA^^
"BLD",10159,6.3)
20
"BLD",10159,"KRN",0)
^9.67PA^779.2^20
"BLD",10159,"KRN",.4,0)
.4
"BLD",10159,"KRN",.401,0)
.401
"BLD",10159,"KRN",.401,"NM",0)
^9.68A^^0
"BLD",10159,"KRN",.402,0)
.402
"BLD",10159,"KRN",.402,"NM",0)
^9.68A^^0
"BLD",10159,"KRN",.403,0)
.403
"BLD",10159,"KRN",.5,0)
.5
"BLD",10159,"KRN",.84,0)
.84
"BLD",10159,"KRN",3.6,0)
3.6
"BLD",10159,"KRN",3.8,0)
3.8
"BLD",10159,"KRN",9.2,0)
9.2
"BLD",10159,"KRN",9.2,"NM",0)
^9.68A^^0
"BLD",10159,"KRN",9.8,0)
9.8
"BLD",10159,"KRN",9.8,"NM",0)
^9.68A^2^2
"BLD",10159,"KRN",9.8,"NM",1,0)
PSDORP1^^0^B15832867
"BLD",10159,"KRN",9.8,"NM",2,0)
PSDOPTS^^0^B23723637
"BLD",10159,"KRN",9.8,"NM","B","PSDOPTS",2)

"BLD",10159,"KRN",9.8,"NM","B","PSDORP1",1)

"BLD",10159,"KRN",19,0)
19
"BLD",10159,"KRN",19,"NM",0)
^9.68A^^0
"BLD",10159,"KRN",19.1,0)
19.1
"BLD",10159,"KRN",19.1,"NM",0)
^9.68A^^0
"BLD",10159,"KRN",101,0)
101
"BLD",10159,"KRN",101,"NM",0)
^9.68A^^0
"BLD",10159,"KRN",409.61,0)
409.61
"BLD",10159,"KRN",771,0)
771
"BLD",10159,"KRN",771,"NM",0)
^9.68A^^0
"BLD",10159,"KRN",779.2,0)
779.2
"BLD",10159,"KRN",870,0)
870
"BLD",10159,"KRN",870,"NM",0)
^9.68A^^0
"BLD",10159,"KRN",8989.51,0)
8989.51
"BLD",10159,"KRN",8989.52,0)
8989.52
"BLD",10159,"KRN",8994,0)
8994
"BLD",10159,"KRN","B",.4,.4)

"BLD",10159,"KRN","B",.401,.401)

"BLD",10159,"KRN","B",.402,.402)

"BLD",10159,"KRN","B",.403,.403)

"BLD",10159,"KRN","B",.5,.5)

"BLD",10159,"KRN","B",.84,.84)

"BLD",10159,"KRN","B",3.6,3.6)

"BLD",10159,"KRN","B",3.8,3.8)

"BLD",10159,"KRN","B",9.2,9.2)

"BLD",10159,"KRN","B",9.8,9.8)

"BLD",10159,"KRN","B",19,19)

"BLD",10159,"KRN","B",19.1,19.1)

"BLD",10159,"KRN","B",101,101)

"BLD",10159,"KRN","B",409.61,409.61)

"BLD",10159,"KRN","B",771,771)

"BLD",10159,"KRN","B",779.2,779.2)

"BLD",10159,"KRN","B",870,870)

"BLD",10159,"KRN","B",8989.51,8989.51)

"BLD",10159,"KRN","B",8989.52,8989.52)

"BLD",10159,"KRN","B",8994,8994)

"BLD",10159,"QUES",0)
^9.62^^
"BLD",10159,"REQB",0)
^9.611^2^2
"BLD",10159,"REQB",1,0)
PSD*3.0*55^1
"BLD",10159,"REQB",2,0)
PSD*3.0*66^1
"BLD",10159,"REQB","B","PSD*3.0*55",1)

"BLD",10159,"REQB","B","PSD*3.0*66",2)

"MBREQ")
0
"PKG",499,-1)
1^1
"PKG",499,0)
CONTROLLED SUBSTANCES^PSD^Controlled Substances Inventory and Tracking module.
"PKG",499,20,0)
^9.402P^^
"PKG",499,22,0)
^9.49I^1^1
"PKG",499,22,1,0)
3.0^2970213^2981028^66481
"PKG",499,22,1,"PAH",1,0)
80^3160622
"PKG",499,22,1,"PAH",1,1,0)
^^18^18^3160622
"PKG",499,22,1,"PAH",1,1,1,0)
This patch addresses the following problems:
"PKG",499,22,1,"PAH",1,1,2,0)
 
"PKG",499,22,1,"PAH",1,1,3,0)
1. INC000000997119 - PRESCRIPTION TRANSACTION
"PKG",499,22,1,"PAH",1,1,4,0)
 
"PKG",499,22,1,"PAH",1,1,5,0)
Problem:
"PKG",499,22,1,"PAH",1,1,6,0)
--------
"PKG",499,22,1,"PAH",1,1,7,0)
If two outpatient prescription transaction are created at the same 
"PKG",499,22,1,"PAH",1,1,8,0)
date/time for the same pharmacy location, both will not display in the 
"PKG",499,22,1,"PAH",1,1,9,0)
Rx (Prescription) Outpatient Dispensing Report [PSD RX DISPENSING REPORT].
"PKG",499,22,1,"PAH",1,1,10,0)
 
"PKG",499,22,1,"PAH",1,1,11,0)
 
"PKG",499,22,1,"PAH",1,1,12,0)
2. INC000001234782 - Ordered By Field
"PKG",499,22,1,"PAH",1,1,13,0)
 
"PKG",499,22,1,"PAH",1,1,14,0)
Problem:
"PKG",499,22,1,"PAH",1,1,15,0)
--------
"PKG",499,22,1,"PAH",1,1,16,0)
The CS WORKSHEET (#58.85) file ORDERED BY (#12) field is not being 
"PKG",499,22,1,"PAH",1,1,17,0)
updated correctly when someone edits a controlled substance order for an 
"PKG",499,22,1,"PAH",1,1,18,0)
NAOU using the CS Order Entry for Ward [PSD ORDER ENTRY] option.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
2
"RTN","PSDOPTS")
0^2^B23723637^B25017679
"RTN","PSDOPTS",1,0)
PSDOPTS ;BIR/LT L- Review OP Transactions for a Drug (cont.) ; 29 Aug 94
"RTN","PSDOPTS",2,0)
 ;;3.0;CONTROLLED SUBSTANCES;**18,26,55,80**;13 Feb 97;Build 20
"RTN","PSDOPTS",3,0)
 ;
"RTN","PSDOPTS",4,0)
 ;References to ^PSD(58.8, covered by DBIA2711
"RTN","PSDOPTS",5,0)
 ;References to DD(58.81 and ^PSD(58.81 are covered by DBIA2808
"RTN","PSDOPTS",6,0)
 ;References to ^PSDRUG( are covered by DBIA221
"RTN","PSDOPTS",7,0)
 ;References to ^PSRX( are covered by DBIA986
"RTN","PSDOPTS",8,0)
 S CNT=0 W !!,"You may select one, several, or ^ALL drugs."
"RTN","PSDOPTS",9,0)
CHKD F  S DIC="^PSD(58.8,+PSDLOC,1,",DIC(0)="AEQ",DIC("A")="Please Select "_PSDLOCN_"'s Drug: ",DIC("S")="I $S($G(^(""I"")):$G(^(""I""))>DT,1:1)" W ! D ^DIC K DIC G:X'="^ALL"&(Y<1)&('CNT) END Q:Y<0  D
"RTN","PSDOPTS",10,0)
 .I '$O(^PSD(58.81,"F",+Y,0)) W !!,"There have been no transactions for this drug.",!! Q
"RTN","PSDOPTS",11,0)
 .S PSD=$P($G(^PSDRUG(+Y,0)),U),CNT=CNT+1
"RTN","PSDOPTS",12,0)
 .S PSD=$S(PSD]"":PSD,1:"UNKNOWN DRUG #"_+Y)
"RTN","PSDOPTS",13,0)
 .S ^TMP("PSD",$J,PSD,+Y)="" K PSD
"RTN","PSDOPTS",14,0)
 I X="^ALL" F  S PSDU=$O(^PSD(58.8,+PSDLOC,1,PSDU)) Q:'PSDU  D
"RTN","PSDOPTS",15,0)
 .Q:'$O(^PSD(58.81,"F",PSDU,0))
"RTN","PSDOPTS",16,0)
 .S PSD=$P($G(^PSDRUG(PSDU,0)),U)
"RTN","PSDOPTS",17,0)
 .S PSD=$S(PSD]"":PSD,1:"UNKNOWN DRUG #"_PSDU)
"RTN","PSDOPTS",18,0)
 .S ^TMP("PSD",$J,PSD,PSDU)="" K PSD
"RTN","PSDOPTS",19,0)
 S DIR(0)="S^1:Sort by Rx #;2:Sort by Date Posted;3:Sort by Date Filled (Not Posted)"
"RTN","PSDOPTS",20,0)
 S DIR("A")="Within Drug, Sort by",DIR("B")=1
"RTN","PSDOPTS",21,0)
 S DIR("?")="For each drug, do you want the transactions listed in the order they were posted, by Rx #, or by fill date (not posted)?"
"RTN","PSDOPTS",22,0)
 D ^DIR K DIR G:$D(DIRUT) END G:Y=1 ^PSDOPTX G:Y=3 ^PSDOPTN
"RTN","PSDOPTS",23,0)
 S DIR(0)="DA^2910501:NOW:AEPT"
"RTN","PSDOPTS",24,0)
 S DIR("A")="Beginning date@time posted: ",DIR("?")="I will list Outpatient transactions for your selected drug(s) within your selected date@time range.  Please don't enter a date@time in the future" W ! D ^DIR G:Y<1 END
"RTN","PSDOPTS",25,0)
 S (PSDT,PSDTB)=Y,PSDTB(2)=Y(0)
"RTN","PSDOPTS",26,0)
 S DIR(0)="DA^"_PSDT_":NOW:AET"
"RTN","PSDOPTS",27,0)
 S DIR("A")="Ending date@time posted: "
"RTN","PSDOPTS",28,0)
 S DIR("?")=$G(DIR("?"))_" or before "_$G(PSDTB(2))
"RTN","PSDOPTS",29,0)
 W ! D ^DIR K DIR G:Y<1 END S PSDTB(1)=Y,PSDTB(3)=Y(0)
"RTN","PSDOPTS",30,0)
 S:'$P(PSDTB(1),".",2) PSDTB(1)=PSDTB(1)+.999999
"RTN","PSDOPTS",31,0)
 S Y=$P($G(^PSD(58.8,+PSDLOC,2)),"^",9),C=$P(^DD(58.8,24,0),"^",2) D Y^DIQ S PSDEV=Y
"RTN","PSDOPTS",32,0)
DEV ;device
"RTN","PSDOPTS",33,0)
 K IO("Q") N %ZIS,IOP,POP S %ZIS="Q",%ZIS("B")=PSDEV W ! D ^%ZIS I POP W !,"NO DEVICE SELECTED OR OUTPUT PRINTED!" Q
"RTN","PSDOPTS",34,0)
 I $D(IO("Q")) N ZTDESC,ZTIO,ZTRTN,ZTSAVE,ZTDTH,ZTSK S ZTRTN="START^PSDOPTS",ZTDESC="Drug OP transaction review" D SAVE D ^%ZTLOAD,HOME^%ZIS S PSDOUT=1 G END
"RTN","PSDOPTS",35,0)
START ;compiles
"RTN","PSDOPTS",36,0)
 U IO N PSDR,PG S (PG,PSDOUT)=0 K LN D HEADER S PSDU=0
"RTN","PSDOPTS",37,0)
 F  S PSDU=$O(^TMP("PSD",$J,PSDU)) Q:PSDU']""  S PSDU(1)=$O(^TMP("PSD",$J,PSDU,0)) D  G:PSDOUT END S PSDT=PSDTB,PSDT(1)=0
"RTN","PSDOPTS",38,0)
 .;DAVE B (PSD*3*26   16MAY00)
"RTN","PSDOPTS",39,0)
LOOP .F  S PSDT=$O(^PSD(58.81,"ACT",PSDT)) W:$E(IOST)="C" "." Q:'PSDT!(PSDT>PSDTB(1))  S L=0 F  S L=$O(^PSD(58.81,"ACT",PSDT,PSDLOC,+PSDU(1),6,L)) Q:L=""  D  Q:PSDOUT
"RTN","PSDOPTS",40,0)
 ..S PSDR(3)=L
"RTN","PSDOPTS",41,0)
 ..S PSDR(2)=$G(^PSD(58.81,PSDR(3),0))
"RTN","PSDOPTS",42,0)
 ..S PSDR(4)=$G(^PSD(58.81,PSDR(3),6))
"RTN","PSDOPTS",43,0)
 ..D:$Y+6>IOSL HEADER Q:PSDOUT
"RTN","PSDOPTS",44,0)
 ..S PSDT(1)=$G(PSDT(1))+1 W:PSDT(1)=1 !,PSDU
"RTN","PSDOPTS",45,0)
 ..W:$P(PSDR(4),U,6)&($P(PSDR(2),U,7)'=$P(PSDR(4),U,6)) ?54,"RPH=> ",$E($P($G(^VA(200,+$P(PSDR(4),U,6),0)),U),1,20)
"RTN","PSDOPTS",46,0)
 ..S Y=$E($P(PSDR(2),U,4),1,12) X ^DD("DD") W !!,Y,?19
"RTN","PSDOPTS",47,0)
 ..S DFN=$P($G(^PSRX(+$P(PSDR(4),U),0)),U,2)
"RTN","PSDOPTS",48,0)
 ..N C S Y=DFN,C=$P(^DD(58.81,73,0),U,2) D Y^DIQ
"RTN","PSDOPTS",49,0)
 ..W $P(PSDR(4),U,5),?28,Y
"RTN","PSDOPTS",50,0)
 ..D PID^VADPT6 W " ("_VA("BID")_")",?60
"RTN","PSDOPTS",51,0)
 ..I $P(PSDR(4),U,2) S Y=$P($G(^PSRX(+$P(PSDR(4),U),1,+$P(PSDR(4),U,2),0)),U,18) X ^DD("DD") W Y
"RTN","PSDOPTS",52,0)
 ..I $P(PSDR(4),U,4) S Y=$P($G(^PSRX(+$P(PSDR(4),U),"P",+$P(PSDR(4),U,4),0)),U,19) X ^DD("DD") W Y
"RTN","PSDOPTS",53,0)
 ..I '$P(PSDR(4),U,2)&('$P(PSDR(4),U,4)) S Y=$P($G(^PSRX(+$P(PSDR(4),U),2)),U,13) X ^DD("DD") W Y
"RTN","PSDOPTS",54,0)
 ..W !,"Qty: ",$P(PSDR(2),U,6),"  Bal: ",$P(PSDR(2),U,10)-$P(PSDR(2),U,6),?22,"RPH=> ",$P($G(^VA(200,+$P(PSDR(2),U,7),0)),U),?60
"RTN","PSDOPTS",55,0)
 ..W $S($P(PSDR(4),U,2):"Refill #"_$P(PSDR(4),U,2),$P(PSDR(4),U,4):"Partial #"_$P(PSDR(4),U,4),1:"Original")
"RTN","PSDOPTS",56,0)
 ..W !,LN,!
"RTN","PSDOPTS",57,0)
END W:$E(IOST)'="C" @IOF
"RTN","PSDOPTS",58,0)
 I $E(IOST)="C",'PSDOUT S DIR(0)="EA",DIR("A")="END OF REPORT!  Press <RET> to return to the menu." D ^DIR
"RTN","PSDOPTS",59,0)
 D ^%ZISC S:$D(ZTQUEUED) ZTREQ="@"
"RTN","PSDOPTS",60,0)
 D KVAR^VADPT K IO("Q"),VA("PID"),VA("BID"),^TMP("PSD",$J)
"RTN","PSDOPTS",61,0)
 Q
"RTN","PSDOPTS",62,0)
HEADER I $E(IOST,1,2)'="P-",PG S DIR(0)="E" D ^DIR K DIR I 'Y S PSDOUT=1 Q
"RTN","PSDOPTS",63,0)
 I $$S^%ZTLOAD W !!,"Task #",$G(ZTSK),", ",$G(ZTDESC)," was stopped by ",$P($G(^VA(200,+$G(DUZ),0)),U),"." S PSDOUT=1
"RTN","PSDOPTS",64,0)
 W:$Y @IOF S $P(LN,"-",81)="",PG=PG+1 W !,"Outpatient Activity from ",PSDTB(2)," to ",PSDTB(3),?70,"PAGE: ",PG,!,LN,!,"Date Posted",?19,"Rx#",?28,"Patient",?60,"Date Released",!,LN W:$G(PSDT(1)) !,PSDU," (continued)",!
"RTN","PSDOPTS",65,0)
 Q
"RTN","PSDOPTS",66,0)
SAVE ;
"RTN","PSDOPTS",67,0)
 S ZTSAVE("^TMP(""PSD"",$J,")=""
"RTN","PSDOPTS",68,0)
 S (ZTSAVE("PSDT"),ZTSAVE("PSDLOC"),ZTSAVE("PSDTB"),ZTSAVE("PSDTB("))=""
"RTN","PSDOPTS",69,0)
 Q
"RTN","PSDORP1")
0^1^B15832867^B15402116
"RTN","PSDORP1",1,0)
PSDORP1 ;BIR/JPW-Pharm CS Order Entry (cont'd) ; 2 Aug 94
"RTN","PSDORP1",2,0)
 ;;3.0;CONTROLLED SUBSTANCES;**66,80**;13 Feb 97;Build 20
"RTN","PSDORP1",3,0)
 ;MULTIPLE ORDERS
"RTN","PSDORP1",4,0)
 I $D(ORD) F CNT1=1:1:CNT S PSDA=+ORD(CNT1) S:$G(PSDR(2))&(CNT1=1) PSDQTY=PSDR(2) D ASK
"RTN","PSDORP1",5,0)
 Q
"RTN","PSDORP1",6,0)
ASK ;displays order for review
"RTN","PSDORP1",7,0)
 D DISPLAY
"RTN","PSDORP1",8,0)
 W !! K DA,DIR,DIRUT S DIR(0)="Y",DIR("B")="YES",DIR("A")="Is this OK",DIR("?",1)="Answer 'YES' to send this request to pharmacy for processing,"
"RTN","PSDORP1",9,0)
 S DIR("?",2)="or 'NO' to edit or delete this request",DIR("?")="or '^' to quit and DELETE this CS order request." D ^DIR K DIR
"RTN","PSDORP1",10,0)
 I $D(DIRUT) S PSDOUT=1 D DEL Q
"RTN","PSDORP1",11,0)
 I 'Y D EDIT Q:PSDOUT  G ASK
"RTN","PSDORP1",12,0)
 I Y N X,X1 D SIG^XUSESIG S:X1="" PSDOUT=1 D:X1="" DEL Q:X1=""  D PHARM W !! W:$D(ORD) "Your order request #"_CNT1_" of "_CNT W ?32,"Sent to Pharmacy...",!! R:$D(ORD) "Press <RET> to continue",X:DTIME,!!
"RTN","PSDORP1",13,0)
 Q
"RTN","PSDORP1",14,0)
DISPLAY ;displays order request to screen
"RTN","PSDORP1",15,0)
 K LN S $P(LN,"-",80)=""
"RTN","PSDORP1",16,0)
 W @IOF,!,?23,"Controlled Substance Order Request" I $D(ORD) W " # "_CNT1_" of "_CNT
"RTN","PSDORP1",17,0)
 W !!,"Pharmacy Dispensing #: ",!,"Requested by",?16,": ",$P($G(^VA(200,PSDUZ,0)),"^"),?52,"Request Date: ",REQD,!,LN,!
"RTN","PSDORP1",18,0)
 W !,"Drug",?16,": ",PSDRN,?56,"Quantity: ",?66,PSDQTY,!,"Dispensed by",?16,": N/A",?50,"Dispensed Date: N/A"
"RTN","PSDORP1",19,0)
 W !,"Disp. Location",?16,": " W:+PSDS $P($G(^PSD(58.8,+PSDS,0)),"^") W !,"Exp. Date",?16,": ",!,"Manufacturer",?16,": ",!,"Lot #",?16,": "
"RTN","PSDORP1",20,0)
 W !,"Ord. Location",?16,": ",NAOUN,!,"Order Status",?16,": ",$P($G(^PSD(58.82,1,0)),"^"),!,"Comments:"
"RTN","PSDORP1",21,0)
 I $D(^PSD(58.8,NAOU,1,PSDR,3,PSDA,1,0)) K ^UTILITY($J,"W") F TEXT=0:0 S TEXT=$O(^PSD(58.8,NAOU,1,PSDR,3,PSDA,1,TEXT)) Q:'TEXT  D
"RTN","PSDORP1",22,0)
 .S X=$G(^PSD(58.8,NAOU,1,PSDR,3,PSDA,1,TEXT,0)),DIWL=5,DIWR=75,DIWF="W" D ^DIWP
"RTN","PSDORP1",23,0)
 I  D ^DIWW
"RTN","PSDORP1",24,0)
 Q
"RTN","PSDORP1",25,0)
EDIT ;edit or delete order request
"RTN","PSDORP1",26,0)
 W !!,"Edit or Delete this Order Request:  EDIT//  " R X:DTIME I '$T S PSDOUT=1 D DEL Q
"RTN","PSDORP1",27,0)
 Q:X["^"  S X=$E(X) S:X="" X="E" I "EeDd"'[X W !!,"Press <RET> to edit this order request, or enter 'D' to delete the request.",! G EDIT
"RTN","PSDORP1",28,0)
 I "Dd"[X D DEL Q
"RTN","PSDORP1",29,0)
 K DA,DIE,DR S DA=PSDA,DA(1)=PSDR,DA(2)=NAOU,DIE="^PSD(58.8,"_NAOU_",1,"_PSDR_",3,",DR="3;13" D ^DIE K DIE,DR
"RTN","PSDORP1",30,0)
 Q
"RTN","PSDORP1",31,0)
DEL ;deletes order request
"RTN","PSDORP1",32,0)
 S PSDOUT=1 W !!,?25,"Request being deleted...",! K DIK S DA=PSDA,DA(1)=PSDR,DA(2)=NAOU,DIK="^PSD(58.8,"_NAOU_",1,"_PSDR_",3," D ^DIK K DIK
"RTN","PSDORP1",33,0)
 Q
"RTN","PSDORP1",34,0)
PHARM ;create worksheet entry in file 58.85
"RTN","PSDORP1",35,0)
 W ?5,!!,"Processing your request now..." F  L +^PSD(58.85,0):$S($G(DILOCKTM)>0:DILOCKTM,1:3) I  Q
"RTN","PSDORP1",36,0)
ADD S PSDREC=$P(^PSD(58.85,0),"^",3)+1 I $D(^PSD(58.85,PSDREC)) S $P(^PSD(58.85,0),"^",3)=PSDREC G ADD
"RTN","PSDORP1",37,0)
 K DA,DIC,DIE,DR,DLAYGO S (DIC,DIE,DLAYGO)=58.85,DIC(0)="L",X=PSDREC D ^DIC K DIC,DLAYGO
"RTN","PSDORP1",38,0)
 L -^PSD(58.85,0)
"RTN","PSDORP1",39,0)
 S PSDRD=$S($P($G(^PSD(58.8,NAOU,1,PSDR,3,PSDA,0)),"^",2):$P(^(0),"^",2),1:DT)
"RTN","PSDORP1",40,0)
 S DA=PSDREC,DR="1////"_PSDS_";2////"_NAOU_";3////"_PSDR_";4////"_PSDA_";5////"_PSDQTY_";6////1;12////"_($P(^PSD(58.8,NAOU,1,PSDR,3,PSDA,0),U,4))_";19////"_PSDRD_";20////"_PSDUZ D ^DIE K DIE
"RTN","PSDORP1",41,0)
 I $D(^PSD(58.8,NAOU,1,PSDR,3,PSDA,1,0)) S ^PSD(58.85,PSDREC,1,0)=^PSD(58.8,NAOU,1,PSDR,3,PSDA,1,0) D
"RTN","PSDORP1",42,0)
 .F WORD=0:0 S WORD=$O(^PSD(58.8,NAOU,1,PSDR,3,PSDA,1,WORD)) Q:'WORD  S ^PSD(58.85,PSDREC,1,WORD,0)=^PSD(58.8,NAOU,1,PSDR,3,PSDA,1,WORD,0)
"RTN","PSDORP1",43,0)
 K DA,DIC,DIE,DLAYGO,DR,PSDREC,WORD S PSDQTY=$S($G(PSDR(1)):PSDR(1),1:NPKG)
"RTN","PSDORP1",44,0)
 Q
"VER")
8.0^22.0
"BLD",10159,6)
^65
**END**
**END**

