Released PSD*3*85 SEQ #69
Extracted from mail message
**KIDS**:PSD*3.0*85^

**INSTALL NAME**
PSD*3.0*85
"BLD",11048,0)
PSD*3.0*85^CONTROLLED SUBSTANCES^0^3180418^y
"BLD",11048,1,0)
^^15^15^3180418^
"BLD",11048,1,1,0)
Defect Tracking System Ticket(s) & Overview:
"BLD",11048,1,2,0)
--------------------------------------------
"BLD",11048,1,3,0)
1. R19391179FY18  - Rx not showing on Rx Disp Report
"BLD",11048,1,4,0)
  
"BLD",11048,1,5,0)
Problem: 
"BLD",11048,1,6,0)
--------
"BLD",11048,1,7,0)
Togus VA noticed a problem with a controlled substance prescription that
"BLD",11048,1,8,0)
was filled locally and released but was not showing up on the Rx
"BLD",11048,1,9,0)
(Prescription) Outpatient Dispensing Report [PSD RX DISPENSING REPORT] 
"BLD",11048,1,10,0)
report option. Upon further research it was determined that if a 
"BLD",11048,1,11,0)
prescription had at least one fill that was transmitted to CMOP (not yet
"BLD",11048,1,12,0)
released) it would prevent all the prescription fills from being listed on
"BLD",11048,1,13,0)
this report even though they could have been dispensed locally, which is the
"BLD",11048,1,14,0)
purpose of the report, to list locally dispensed controlled substance
"BLD",11048,1,15,0)
prescription fills that have not posted on the CS Vault inventory.
"BLD",11048,4,0)
^9.64PA^^
"BLD",11048,6.3)
2
"BLD",11048,"KRN",0)
^9.67PA^779.2^20
"BLD",11048,"KRN",.4,0)
.4
"BLD",11048,"KRN",.401,0)
.401
"BLD",11048,"KRN",.402,0)
.402
"BLD",11048,"KRN",.403,0)
.403
"BLD",11048,"KRN",.5,0)
.5
"BLD",11048,"KRN",.84,0)
.84
"BLD",11048,"KRN",3.6,0)
3.6
"BLD",11048,"KRN",3.8,0)
3.8
"BLD",11048,"KRN",9.2,0)
9.2
"BLD",11048,"KRN",9.8,0)
9.8
"BLD",11048,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",11048,"KRN",9.8,"NM",1,0)
PSDOPTN^^0^B20393543
"BLD",11048,"KRN",9.8,"NM","B","PSDOPTN",1)

"BLD",11048,"KRN",19,0)
19
"BLD",11048,"KRN",19.1,0)
19.1
"BLD",11048,"KRN",101,0)
101
"BLD",11048,"KRN",409.61,0)
409.61
"BLD",11048,"KRN",771,0)
771
"BLD",11048,"KRN",779.2,0)
779.2
"BLD",11048,"KRN",870,0)
870
"BLD",11048,"KRN",8989.51,0)
8989.51
"BLD",11048,"KRN",8989.52,0)
8989.52
"BLD",11048,"KRN",8994,0)
8994
"BLD",11048,"KRN","B",.4,.4)

"BLD",11048,"KRN","B",.401,.401)

"BLD",11048,"KRN","B",.402,.402)

"BLD",11048,"KRN","B",.403,.403)

"BLD",11048,"KRN","B",.5,.5)

"BLD",11048,"KRN","B",.84,.84)

"BLD",11048,"KRN","B",3.6,3.6)

"BLD",11048,"KRN","B",3.8,3.8)

"BLD",11048,"KRN","B",9.2,9.2)

"BLD",11048,"KRN","B",9.8,9.8)

"BLD",11048,"KRN","B",19,19)

"BLD",11048,"KRN","B",19.1,19.1)

"BLD",11048,"KRN","B",101,101)

"BLD",11048,"KRN","B",409.61,409.61)

"BLD",11048,"KRN","B",771,771)

"BLD",11048,"KRN","B",779.2,779.2)

"BLD",11048,"KRN","B",870,870)

"BLD",11048,"KRN","B",8989.51,8989.51)

"BLD",11048,"KRN","B",8989.52,8989.52)

"BLD",11048,"KRN","B",8994,8994)

"BLD",11048,"QDEF")
^^^^NO^^^^NO^^NO
"BLD",11048,"QUES",0)
^9.62^^
"BLD",11048,"REQB",0)
^9.611^1^1
"BLD",11048,"REQB",1,0)
PSD*3.0*75^2
"BLD",11048,"REQB","B","PSD*3.0*75",1)

"MBREQ")
0
"PKG",499,-1)
1^1
"PKG",499,0)
CONTROLLED SUBSTANCES^PSD^Controlled Substances Inventory and Tracking module.
"PKG",499,20,0)
^9.402P^^
"PKG",499,22,0)
^9.49I^1^1
"PKG",499,22,1,0)
3.0^2970213^2981028^66481
"PKG",499,22,1,"PAH",1,0)
85^3180418^100877
"PKG",499,22,1,"PAH",1,1,0)
^^15^15^3180418
"PKG",499,22,1,"PAH",1,1,1,0)
Defect Tracking System Ticket(s) & Overview:
"PKG",499,22,1,"PAH",1,1,2,0)
--------------------------------------------
"PKG",499,22,1,"PAH",1,1,3,0)
1. R19391179FY18  - Rx not showing on Rx Disp Report
"PKG",499,22,1,"PAH",1,1,4,0)
  
"PKG",499,22,1,"PAH",1,1,5,0)
Problem: 
"PKG",499,22,1,"PAH",1,1,6,0)
--------
"PKG",499,22,1,"PAH",1,1,7,0)
Togus VA noticed a problem with a controlled substance prescription that
"PKG",499,22,1,"PAH",1,1,8,0)
was filled locally and released but was not showing up on the Rx
"PKG",499,22,1,"PAH",1,1,9,0)
(Prescription) Outpatient Dispensing Report [PSD RX DISPENSING REPORT] 
"PKG",499,22,1,"PAH",1,1,10,0)
report option. Upon further research it was determined that if a 
"PKG",499,22,1,"PAH",1,1,11,0)
prescription had at least one fill that was transmitted to CMOP (not yet
"PKG",499,22,1,"PAH",1,1,12,0)
released) it would prevent all the prescription fills from being listed on
"PKG",499,22,1,"PAH",1,1,13,0)
this report even though they could have been dispensed locally, which is the
"PKG",499,22,1,"PAH",1,1,14,0)
purpose of the report, to list locally dispensed controlled substance
"PKG",499,22,1,"PAH",1,1,15,0)
prescription fills that have not posted on the CS Vault inventory.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","PSDOPTN")
0^1^B20393543^B20101780
"RTN","PSDOPTN",1,0)
PSDOPTN ;BIR/LTL - Review OP Transactions for a Drug (cont.) ; 24 Jan 95
"RTN","PSDOPTN",2,0)
 ;;3.0;CONTROLLED SUBSTANCES ;**18,55,75,85**;13 Feb 97;Build 2
"RTN","PSDOPTN",3,0)
 ;
"RTN","PSDOPTN",4,0)
 ;References to ^PSD(58.8, covered by DBIA2711
"RTN","PSDOPTN",5,0)
 ;References to DD(58.81 and ^PSD(58.81 are covered by DBIA2808
"RTN","PSDOPTN",6,0)
 ;References to ^PSDRUG( are covered by DBIA221
"RTN","PSDOPTN",7,0)
 ;References to ^PSRX( are covered by DBIA986
"RTN","PSDOPTN",8,0)
 S DIR(0)="DA^2910501::AEPT"
"RTN","PSDOPTN",9,0)
 S DIR("A")="Beginning date@time filled (not posted): ",DIR("?")="I will list Outpatient transactions for your selected drug(s) within your selected date@time range.  Please don't enter a date@time in the future" W ! D ^DIR G:Y<1 END
"RTN","PSDOPTN",10,0)
 S (PSDT,PSDTB)=Y,PSDTB(2)=Y(0)
"RTN","PSDOPTN",11,0)
 S DIR(0)="DA^"_PSDT_"::AET"
"RTN","PSDOPTN",12,0)
 S DIR("A")="Ending date@time filled (not posted): "
"RTN","PSDOPTN",13,0)
 S DIR("?")=$G(DIR("?"))_" or before "_$G(PSDTB(2))
"RTN","PSDOPTN",14,0)
 W ! D ^DIR K DIR G:Y<1 END S PSDTB(1)=Y,PSDTB(3)=Y(0)
"RTN","PSDOPTN",15,0)
 S:'$P(PSDTB(1),".",2) PSDTB(1)=PSDTB(1)+.999999
"RTN","PSDOPTN",16,0)
 S Y=$P($G(^PSD(58.8,+PSDLOC,2)),"^",9),C=$P(^DD(58.8,24,0),"^",2) D Y^DIQ S PSDEV=Y
"RTN","PSDOPTN",17,0)
DEV ;device
"RTN","PSDOPTN",18,0)
 K IO("Q") N %ZIS,IOP,POP S %ZIS="Q",%ZIS("B")=PSDEV W ! D ^%ZIS I POP W !,"NO DEVICE SELECTED OR OUTPUT PRINTED!" Q
"RTN","PSDOPTN",19,0)
 I $D(IO("Q")) N ZTDESC,ZTIO,ZTRTN,ZTSAVE,ZTDTH,ZTSK S ZTRTN="START^PSDOPTN",ZTDESC="Drug OP transaction review" D SAVE D ^%ZTLOAD,HOME^%ZIS S PSDOUT=1 G END
"RTN","PSDOPTN",20,0)
START ;compiles
"RTN","PSDOPTN",21,0)
 U IO N PSDR,PG S (PG,PSDOUT)=0 K LN D HEADER S PSDT=PSDT-1
"RTN","PSDOPTN",22,0)
 ;loop thru Prescription file by date filled
"RTN","PSDOPTN",23,0)
 F  S PSDT=$O(^PSRX("AD",PSDT)) Q:'PSDT!(PSDT>PSDTB(1))  W:$E(IOST)="C" "." S PSDT(1)=0 D
"RTN","PSDOPTN",24,0)
 .F  S PSDT(1)=$O(^PSRX("AD",PSDT,PSDT(1))) Q:'PSDT(1)  D
"RTN","PSDOPTN",25,0)
 ..S PSDT(5)=$G(^PSRX(PSDT(1),0))
"RTN","PSDOPTN",26,0)
 ..S PSDT(2)=$P($G(^PSDRUG(+$P(PSDT(5),U,6),0)),U) Q:PSDT(2)']""
"RTN","PSDOPTN",27,0)
 ..Q:'$D(^TMP("PSD",$J,PSDT(2)))  S PSDT(4)=""
"RTN","PSDOPTN",28,0)
 ..F  S PSDT(4)=$O(^PSRX("AD",PSDT,PSDT(1),PSDT(4))) Q:PSDT(4)=""  D
"RTN","PSDOPTN",29,0)
 ...S PSDCMOP=0
"RTN","PSDOPTN",30,0)
 ...I $D(^PSRX(PSDT(1),4)) S PSDCMP=0 F  S PSDCMP=$O(^PSRX(PSDT(1),4,PSDCMP)) Q:'PSDCMP  D
"RTN","PSDOPTN",31,0)
 ....I +$P(^PSRX(PSDT(1),4,PSDCMP,0),U,3)=+PSDT(4),$P(^PSRX(PSDT(1),4,PSDCMP,0),U,4)<3 S PSDCMOP=1
"RTN","PSDOPTN",32,0)
 ...;Returned to stock?
"RTN","PSDOPTN",33,0)
 ...Q:$S('PSDT(4):$P($G(^PSRX(PSDT(1),2)),U,15),1:$P($G(^PSRX(PSDT(1),1,PSDT(4),0)),U,16))
"RTN","PSDOPTN",34,0)
 ...;posted to the vault?
"RTN","PSDOPTN",35,0)
 ...S PSDT(3)=0
"RTN","PSDOPTN",36,0)
 ...F  S PSDT(3)=$O(^PSD(58.81,"AOP",PSDT(1),PSDT(3))) Q:'PSDT(3)!($S('PSDT(4)&('$P($G(^PSD(58.81,+PSDT(3),6)),U,2)):1,PSDT(4)=$P($G(^(6)),U,2):1,1:0))
"RTN","PSDOPTN",37,0)
 ...Q:PSDT(3)
"RTN","PSDOPTN",38,0)
 ...;suspended & printed
"RTN","PSDOPTN",39,0)
 ...S (PSDT(3),PSDT(8))=0
"RTN","PSDOPTN",40,0)
 ...I PSDT>DT D  Q:'PSDT(8)
"RTN","PSDOPTN",41,0)
 ....F  S PSDT(3)=$O(^PSRX(PSDT(1),"L",PSDT(3))) Q:'PSDT(3)  S:$P($G(^PSRX(PSDT(1),"L",PSDT(3),0)),U,2)=PSDT(4) PSDT(8)=1
"RTN","PSDOPTN",42,0)
 ...;quantity
"RTN","PSDOPTN",43,0)
 ...S PSDT(6)=$S('PSDT(4):$P(PSDT(5),U,7),1:$P($G(^PSRX(PSDT(1),1,PSDT(4),0)),U,4))
"RTN","PSDOPTN",44,0)
 ...S DFN=$P(PSDT(5),U,2) N C S Y=DFN,C=$P(^DD(58.81,73,0),U,2) D Y^DIQ
"RTN","PSDOPTN",45,0)
 ...S PSDT(7)=Y D PID^VADPT6 S PSDT(7)=PSDT(7)_" ("_VA("BID")_")"
"RTN","PSDOPTN",46,0)
 ...I $G(PSDCMOP) S PSDCMOP=0 Q
"RTN","PSDOPTN",47,0)
 ...S:$P(PSDT(5),U)]"" ^TMP("PSDO",$J,PSDT(2),$P(PSDT(5),U),PSDT(4))=PSDT(6)_U_PSDT_U_PSDT(7)
"RTN","PSDOPTN",48,0)
 K PSDCMP
"RTN","PSDOPTN",49,0)
 I '$D(^TMP("PSDO",$J)) W !!,"Nothing to Report.",!! G END
"RTN","PSDOPTN",50,0)
 F  S PSDT=$O(^TMP("PSDO",$J,PSDT)) Q:PSDT']""!PSDOUT  D  Q:PSDOUT
"RTN","PSDOPTN",51,0)
 .D:$Y+5>IOSL HEADER Q:PSDOUT  W !!,"Drug =>  ",PSDT  S PSDT(1)=0
"RTN","PSDOPTN",52,0)
 .F  S PSDT(1)=$O(^TMP("PSDO",$J,PSDT,PSDT(1))) Q:'PSDT(1)!PSDOUT  D  Q:PSDOUT
"RTN","PSDOPTN",53,0)
 ..S PSDT(2)=""
"RTN","PSDOPTN",54,0)
 ..F  S PSDT(2)=$O(^TMP("PSDO",$J,PSDT,PSDT(1),PSDT(2))) Q:PSDT(2)=""!PSDOUT  D  Q:PSDOUT
"RTN","PSDOPTN",55,0)
 ...I $Y+4>IOSL D HEADER Q:PSDOUT  W !!,PSDT," (continued)"
"RTN","PSDOPTN",56,0)
 ...W !!,PSDT(1)," (",PSDT(2),")"
"RTN","PSDOPTN",57,0)
 ...S PSDT(3)=$G(^TMP("PSDO",$J,PSDT,PSDT(1),PSDT(2)))
"RTN","PSDOPTN",58,0)
 ...W ?9,$J($P(PSDT(3),U),4) S Y=$P(PSDT(3),U,2) X ^DD("DD") W ?20,Y
"RTN","PSDOPTN",59,0)
 ...W ?40,$P(PSDT(3),U,3)
"RTN","PSDOPTN",60,0)
END W:$E(IOST)'="C" @IOF
"RTN","PSDOPTN",61,0)
 I $E(IOST)="C",'PSDOUT S DIR(0)="EA",DIR("A")="END OF REPORT!  Press <RET> to return to the menu." W ! D ^DIR
"RTN","PSDOPTN",62,0)
 D ^%ZISC S:$D(ZTQUEUED) ZTREQ="@"
"RTN","PSDOPTN",63,0)
 D KVAR^VADPT K IO("Q"),VA("PID"),VA("BID"),^TMP("PSDO",$J),PSDCMOP
"RTN","PSDOPTN",64,0)
 Q
"RTN","PSDOPTN",65,0)
HEADER I $E(IOST,1,2)'="P-",PG S DIR(0)="E" D ^DIR K DIR I 'Y S PSDOUT=1 Q
"RTN","PSDOPTN",66,0)
 I $$S^%ZTLOAD W !!,"Task #",$G(ZTSK),", ",$G(ZTDESC)," was stopped by ",$P($G(^VA(200,+$G(DUZ),0)),U),"." S PSDOUT=1
"RTN","PSDOPTN",67,0)
 W:$Y @IOF S $P(LN,"-",81)="",PG=PG+1 W !,"Outpatient Activity from ",PSDTB(2)," to ",PSDTB(3),?70,"PAGE: ",PG,!,LN,!,"Rx#",?10,"QTY",?20,"Fill Date",?40,"Patient",!,LN
"RTN","PSDOPTN",68,0)
 Q
"RTN","PSDOPTN",69,0)
SAVE ;
"RTN","PSDOPTN",70,0)
 S ZTSAVE("^TMP(""PSD"",$J,")=""
"RTN","PSDOPTN",71,0)
 S (ZTSAVE("PSDT"),ZTSAVE("PSDLOC"),ZTSAVE("PSDTB"),ZTSAVE("PSDTB("))=""
"RTN","PSDOPTN",72,0)
 Q
"VER")
8.0^22.2
"BLD",11048,6)
^69
**END**
**END**

