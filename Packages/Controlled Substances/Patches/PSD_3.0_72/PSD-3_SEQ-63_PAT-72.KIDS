Released PSD*3*72 SEQ #63
Extracted from mail message
**KIDS**:PSD*3.0*72^

**INSTALL NAME**
PSD*3.0*72
"BLD",8777,0)
PSD*3.0*72^CONTROLLED SUBSTANCES^0^3131212^y
"BLD",8777,1,0)
^^12^12^3110208^^^
"BLD",8777,1,1,0)
This patch addresses the following problems:
"BLD",8777,1,2,0)
1. HD0000000438928 - Balance Adjustment Problem w/Activity Report
"BLD",8777,1,3,0)
The Activity Report [PSD NURSE DISP REPORT] option does not print the
"BLD",8777,1,4,0)
corrected drug balances for drugs that have a combination of Verify
"BLD",8777,1,5,0)
Count, Sign Out Dose for Patient with a balance adjustment and then 
"BLD",8777,1,6,0)
Verify Count a second time.
"BLD",8777,1,7,0)
 
"BLD",8777,1,8,0)
2. HD0000000457994 - RX not showing on report
"BLD",8777,1,9,0)
When there are multiple transactions for the same date/time and
"BLD",8777,1,10,0)
different pharmacy locations, not all of transactions show up on
"BLD",8777,1,11,0)
the RX (Prescription) Outpatient Dispensing Report [PSD RX DISPENSING
"BLD",8777,1,12,0)
REPORT].
"BLD",8777,4,0)
^9.64PA^^
"BLD",8777,6)
2^
"BLD",8777,6.3)
8
"BLD",8777,"ABPKG")
n
"BLD",8777,"KRN",0)
^9.67PA^779.2^20
"BLD",8777,"KRN",.4,0)
.4
"BLD",8777,"KRN",.401,0)
.401
"BLD",8777,"KRN",.402,0)
.402
"BLD",8777,"KRN",.403,0)
.403
"BLD",8777,"KRN",.5,0)
.5
"BLD",8777,"KRN",.84,0)
.84
"BLD",8777,"KRN",3.6,0)
3.6
"BLD",8777,"KRN",3.8,0)
3.8
"BLD",8777,"KRN",9.2,0)
9.2
"BLD",8777,"KRN",9.8,0)
9.8
"BLD",8777,"KRN",9.8,"NM",0)
^9.68A^3^3
"BLD",8777,"KRN",9.8,"NM",1,0)
PSDPAT1^^0^B84339158
"BLD",8777,"KRN",9.8,"NM",2,0)
PSDOPTI^^0^B27705341
"BLD",8777,"KRN",9.8,"NM",3,0)
PSDPAT2^^0^B54527056
"BLD",8777,"KRN",9.8,"NM","B","PSDOPTI",2)

"BLD",8777,"KRN",9.8,"NM","B","PSDPAT1",1)

"BLD",8777,"KRN",9.8,"NM","B","PSDPAT2",3)

"BLD",8777,"KRN",19,0)
19
"BLD",8777,"KRN",19,"NM",0)
^9.68A^^
"BLD",8777,"KRN",19.1,0)
19.1
"BLD",8777,"KRN",101,0)
101
"BLD",8777,"KRN",409.61,0)
409.61
"BLD",8777,"KRN",771,0)
771
"BLD",8777,"KRN",779.2,0)
779.2
"BLD",8777,"KRN",870,0)
870
"BLD",8777,"KRN",8989.51,0)
8989.51
"BLD",8777,"KRN",8989.52,0)
8989.52
"BLD",8777,"KRN",8994,0)
8994
"BLD",8777,"KRN","B",.4,.4)

"BLD",8777,"KRN","B",.401,.401)

"BLD",8777,"KRN","B",.402,.402)

"BLD",8777,"KRN","B",.403,.403)

"BLD",8777,"KRN","B",.5,.5)

"BLD",8777,"KRN","B",.84,.84)

"BLD",8777,"KRN","B",3.6,3.6)

"BLD",8777,"KRN","B",3.8,3.8)

"BLD",8777,"KRN","B",9.2,9.2)

"BLD",8777,"KRN","B",9.8,9.8)

"BLD",8777,"KRN","B",19,19)

"BLD",8777,"KRN","B",19.1,19.1)

"BLD",8777,"KRN","B",101,101)

"BLD",8777,"KRN","B",409.61,409.61)

"BLD",8777,"KRN","B",771,771)

"BLD",8777,"KRN","B",779.2,779.2)

"BLD",8777,"KRN","B",870,870)

"BLD",8777,"KRN","B",8989.51,8989.51)

"BLD",8777,"KRN","B",8989.52,8989.52)

"BLD",8777,"KRN","B",8994,8994)

"BLD",8777,"QDEF")
^^^^NO^^^^NO^^NO
"BLD",8777,"QUES",0)
^9.62^^
"BLD",8777,"REQB",0)
^9.611^2^2
"BLD",8777,"REQB",1,0)
PSD*3.0*55^1
"BLD",8777,"REQB",2,0)
PSD*3.0*68^1
"BLD",8777,"REQB","B","PSD*3.0*55",1)

"BLD",8777,"REQB","B","PSD*3.0*68",2)

"MBREQ")
0
"PKG",499,-1)
1^1
"PKG",499,0)
CONTROLLED SUBSTANCES^PSD^Controlled Substances Inventory and Tracking module.
"PKG",499,20,0)
^9.402P^^
"PKG",499,22,0)
^9.49I^1^1
"PKG",499,22,1,0)
3.0^2970213^2981028^66481
"PKG",499,22,1,"PAH",1,0)
72^3131212^100104
"PKG",499,22,1,"PAH",1,1,0)
^^12^12^3131212
"PKG",499,22,1,"PAH",1,1,1,0)
This patch addresses the following problems:
"PKG",499,22,1,"PAH",1,1,2,0)
1. HD0000000438928 - Balance Adjustment Problem w/Activity Report
"PKG",499,22,1,"PAH",1,1,3,0)
The Activity Report [PSD NURSE DISP REPORT] option does not print the
"PKG",499,22,1,"PAH",1,1,4,0)
corrected drug balances for drugs that have a combination of Verify
"PKG",499,22,1,"PAH",1,1,5,0)
Count, Sign Out Dose for Patient with a balance adjustment and then 
"PKG",499,22,1,"PAH",1,1,6,0)
Verify Count a second time.
"PKG",499,22,1,"PAH",1,1,7,0)
 
"PKG",499,22,1,"PAH",1,1,8,0)
2. HD0000000457994 - RX not showing on report
"PKG",499,22,1,"PAH",1,1,9,0)
When there are multiple transactions for the same date/time and
"PKG",499,22,1,"PAH",1,1,10,0)
different pharmacy locations, not all of transactions show up on
"PKG",499,22,1,"PAH",1,1,11,0)
the RX (Prescription) Outpatient Dispensing Report [PSD RX DISPENSING
"PKG",499,22,1,"PAH",1,1,12,0)
REPORT].
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
3
"RTN","PSDOPTI")
0^2^B27705341^B27738410
"RTN","PSDOPTI",1,0)
PSDOPTI ;BIR/LTL - Review OP Transactions by Inventory Type ; 29 Aug 94
"RTN","PSDOPTI",2,0)
 ;;3.0;CONTROLLED SUBSTANCES;**18,55,72**;13 Feb 97;Build 8
"RTN","PSDOPTI",3,0)
 ;
"RTN","PSDOPTI",4,0)
 ;References to ^PSD(58.8, covered by DBIA2711
"RTN","PSDOPTI",5,0)
 ;References to DD(58.81 and ^PSD(58.81 are covered by DBIA2808
"RTN","PSDOPTI",6,0)
 ;References to ^PSDRUG( are covered by DBIA221
"RTN","PSDOPTI",7,0)
 ;References to ^PSI(58.16 are covered by DBIA213
"RTN","PSDOPTI",8,0)
 ;References to ^PSRX( are covered by DBIA986
"RTN","PSDOPTI",9,0)
 S CNT=0 W !!,"You may select one, several, or ^ALL Inventory Types."
"RTN","PSDOPTI",10,0)
 N PSDI S PSDI=0
"RTN","PSDOPTI",11,0)
INV F  S DIC="^PSI(58.16,",DIC(0)="AEQ",DIC("A")="Please Select Inventory Type: " W ! D ^DIC K DIC G:X'="^ALL"&(Y<1)&('CNT) END Q:Y<0  S PSDI(+Y)=$P(Y,U,2),CNT=CNT+1
"RTN","PSDOPTI",12,0)
 I X="^ALL" F  S PSDI=$O(^PSI(58.16,PSDI)) Q:'PSDI  S PSDI(PSDI)=$P($G(^PSI(58.16,PSDI,0)),U)
"RTN","PSDOPTI",13,0)
 S CNT=0 W !!,"Now, you may select one, several, or ^ALL drugs."
"RTN","PSDOPTI",14,0)
CHKD F  S DIC="^PSD(58.8,+PSDLOC,1,",DIC(0)="AEQ",DIC("A")="Please Select "_PSDLOCN_"'s Drug: ",DIC("S")="I $S($G(^(""I"")):$G(^(""I""))>DT,1:1)" W ! D ^DIC K DIC G:X'="^ALL"&(Y<1)&('CNT) END Q:Y<0  D
"RTN","PSDOPTI",15,0)
 .I '$O(^PSD(58.81,"F",+Y,0)) W !!,"There have been no transactions for this drug.",!! Q
"RTN","PSDOPTI",16,0)
 .S PSD(1)=0 F  S PSD(1)=$O(^PSD(58.8,PSDLOC,1,+Y,2,PSD(1))) S:$D(PSDI(+PSD(1))) PSD(2)=PSD(1) Q:$G(PSD(2))!('PSD(1))
"RTN","PSDOPTI",17,0)
 .I '$G(PSD(2)) W !!,"Not in selected Inventory Type(s)",!! Q
"RTN","PSDOPTI",18,0)
 .S PSD=$P($G(^PSDRUG(+Y,0)),U),CNT=CNT+1
"RTN","PSDOPTI",19,0)
 .S PSD=$S(PSD]"":PSD,1:"UNKNOWN DRUG #"_+Y)
"RTN","PSDOPTI",20,0)
 .S ^TMP("PSD",$J,PSDI(PSD(2)),PSD,+Y)="" K PSD
"RTN","PSDOPTI",21,0)
 I X="^ALL" F  S PSDU=$O(^PSD(58.8,+PSDLOC,1,PSDU)) Q:'PSDU  D
"RTN","PSDOPTI",22,0)
 .Q:'$O(^PSD(58.81,"F",PSDU,0))
"RTN","PSDOPTI",23,0)
 .S PSD(1)=0 F  S PSD(1)=$O(^PSD(58.8,PSDLOC,1,PSDU,2,PSD(1))) S:$D(PSDI(+PSD(1))) PSD(2)=PSD(1) Q:$G(PSD(2))!('PSD(1))
"RTN","PSDOPTI",24,0)
 .Q:'$G(PSD(2))
"RTN","PSDOPTI",25,0)
 .S PSD=$P($G(^PSDRUG(PSDU,0)),U)
"RTN","PSDOPTI",26,0)
 .S PSD=$S(PSD]"":PSD,1:"UNKNOWN DRUG #"_PSDU)
"RTN","PSDOPTI",27,0)
 .S ^TMP("PSD",$J,PSDI(PSD(2)),PSD,PSDU)="" K PSD
"RTN","PSDOPTI",28,0)
 S DIR(0)="S^1:Sort by Rx #;2:Sort by Date Posted"
"RTN","PSDOPTI",29,0)
 S DIR("A")="Within Drug, Sort by",DIR("B")=1
"RTN","PSDOPTI",30,0)
 S DIR("?")="For each drug, do you want the transactions listed in the order they were posted or by Rx #?"
"RTN","PSDOPTI",31,0)
 D ^DIR K DIR G:$D(DIRUT) END I Y=1 S PSDI=1 G ^PSDOPTX
"RTN","PSDOPTI",32,0)
 S DIR(0)="D^2910501:NOW:AEPT",DIR("A")="Beginning date@time",DIR("?")="I will list Outpatient transactions for your selected drug(s) within your selected date@time range" W ! D ^DIR G:Y<1 END
"RTN","PSDOPTI",33,0)
 S (PSDT,PSDTB)=Y,PSDTB(2)=Y(0),DIR(0)="D^"_PSDT_":NOW:AEPT"
"RTN","PSDOPTI",34,0)
 S DIR("A")="Ending date@time"
"RTN","PSDOPTI",35,0)
 W ! D ^DIR K DIR G:Y<1 END S PSDTB(1)=Y,PSDTB(3)=Y(0)
"RTN","PSDOPTI",36,0)
 S:'$P(PSDTB(1),".",2) PSDTB(1)=PSDTB(1)+.999999
"RTN","PSDOPTI",37,0)
 S Y=$P($G(^PSD(58.8,+PSDLOC,2)),"^",9),C=$P(^DD(58.8,24,0),"^",2) D Y^DIQ S PSDEV=Y
"RTN","PSDOPTI",38,0)
DEV ;asks device and queuing info
"RTN","PSDOPTI",39,0)
 K IO("Q") N %ZIS,IOP,POP S %ZIS="Q",%ZIS("B")=PSDEV W ! D ^%ZIS I POP W !,"NO DEVICE SELECTED OR OUTPUT PRINTED!" Q
"RTN","PSDOPTI",40,0)
 I $D(IO("Q")) N ZTDESC,ZTIO,ZTRTN,ZTSAVE,ZTDTH,ZTSK S ZTRTN="START^PSDOPTI",ZTDESC="Drug OP transaction review" D SAVE D ^%ZTLOAD,HOME^%ZIS S PSDOUT=1 G END
"RTN","PSDOPTI",41,0)
START ;compiles and prints output
"RTN","PSDOPTI",42,0)
 U IO N LN,PSDR,PG S (PG,PSDOUT)=0 D HEADER S (PSD,PSDU)=0
"RTN","PSDOPTI",43,0)
 F  S PSD=$O(^TMP("PSD",$J,PSD)) Q:PSD']""  F  S PSDU=$O(^TMP("PSD",$J,PSD,PSDU)) Q:PSDU']""  S PSDU(1)=$O(^TMP("PSD",$J,PSD,PSDU,0)) D  G:PSDOUT END S PSDT=PSDTB,PSDT(1)=0
"RTN","PSDOPTI",44,0)
LOOP .F  S PSDT=$O(^PSD(58.81,"ACT",PSDT)) W:$E(IOST)="C" "." Q:'PSDT!(PSDT>PSDTB(1))  D:$D(^PSD(58.81,"ACT",PSDT,PSDLOC))&($O(^PSD(58.81,"ACT",PSDT,PSDLOC,0))=PSDU(1))&($O(^PSD(58.81,"ACT",PSDT,PSDLOC,+PSDU(1),6,0)))  Q:PSDOUT
"RTN","PSDOPTI",45,0)
 ..S PSDR(3)=+$O(^PSD(58.81,"ACT",PSDT,PSDLOC,+PSDU(1),6,0))
"RTN","PSDOPTI",46,0)
 ..S PSDR(2)=$G(^PSD(58.81,PSDR(3),0))
"RTN","PSDOPTI",47,0)
 ..S PSDR(4)=$G(^PSD(58.81,PSDR(3),6))
"RTN","PSDOPTI",48,0)
 ..D:$Y+6>IOSL HEADER Q:PSDOUT
"RTN","PSDOPTI",49,0)
 ..S PSDT(1)=$G(PSDT(1))+1 W:PSDT(1)=1 !,PSDU,?60,PSD,!
"RTN","PSDOPTI",50,0)
 ..S Y=$E($P(PSDR(2),U,4),1,12) X ^DD("DD") W !,Y,?19
"RTN","PSDOPTI",51,0)
 ..S DFN=$P($G(^PSRX(+$P(PSDR(4),U),0)),U,2)
"RTN","PSDOPTI",52,0)
 ..N C S Y=DFN,C=$P(^DD(58.81,73,0),U,2) D Y^DIQ
"RTN","PSDOPTI",53,0)
 ..W $P(PSDR(4),U,5),?28,Y
"RTN","PSDOPTI",54,0)
 ..D PID^VADPT6 W " ("_VA("BID")_")",?60
"RTN","PSDOPTI",55,0)
 ..I $P(PSDR(4),U,2) S Y=$P($G(^PSRX(+$P(PSDR(4),U),1,+$P(PSDR(4),U,2),0)),U,18) X ^DD("DD") W Y
"RTN","PSDOPTI",56,0)
 ..I $P(PSDR(4),U,4) S Y=$P($G(^PSRX(+$P(PSDR(4),U),"P",+$P(PSDR(4),U,4),0)),U,19) X ^DD("DD") W Y
"RTN","PSDOPTI",57,0)
 ..I '$P(PSDR(4),U,2)&('$P(PSDR(4),U,4)) S Y=$P($G(^PSRX(+$P(PSDR(4),U),2)),U,13) X ^DD("DD") W Y
"RTN","PSDOPTI",58,0)
 ..W !,"Qty: ",$P(PSDR(2),U,6),"  Bal: ",$P(PSDR(2),U,10)-$P(PSDR(2),U,6),?22,"RPH=> ",$P($G(^VA(200,+$P(PSDR(2),U,7),0)),U),?60
"RTN","PSDOPTI",59,0)
 ..W $S($P(PSDR(4),U,2):"Refill #"_$P(PSDR(4),U,2),$P(PSDR(4),U,4):"Partial #"_$P(PSDR(4),U,4),1:"Original")
"RTN","PSDOPTI",60,0)
 ..W !,LN,!
"RTN","PSDOPTI",61,0)
END W:$E(IOST)'="C" @IOF
"RTN","PSDOPTI",62,0)
 I $E(IOST)="C",'PSDOUT S DIR(0)="EA",DIR("A")="END OF REPORT!  Press <RET> to return to the menu." D ^DIR
"RTN","PSDOPTI",63,0)
 D ^%ZISC S:$D(ZTQUEUED) ZTREQ="@"
"RTN","PSDOPTI",64,0)
 D KVAR^VADPT K IO("Q"),VA("PID"),VA("BID"),^TMP("PSD",$J)
"RTN","PSDOPTI",65,0)
 Q
"RTN","PSDOPTI",66,0)
HEADER ;prints header info
"RTN","PSDOPTI",67,0)
 I $E(IOST,1,2)'="P-",PG S DIR(0)="E" D ^DIR K DIR I 'Y S PSDOUT=1 Q
"RTN","PSDOPTI",68,0)
 I $$S^%ZTLOAD W !!,"Task #",$G(ZTSK),", ",$G(ZTDESC)," was stopped by ",$P($G(^VA(200,+$G(DUZ),0)),U),"." S PSDOUT=1
"RTN","PSDOPTI",69,0)
 W:$Y @IOF S $P(LN,"-",81)="",PG=PG+1 W !,"Outpatient Activity from ",PSDTB(2)," to ",PSDTB(3),?70,"PAGE: ",PG,!,LN,!,"Date Posted",?19,"Rx#",?28,"Patient",?60,"Date Released",!,LN W:$G(PSDT(1)) !,PSDU," (continued)",!
"RTN","PSDOPTI",70,0)
 Q
"RTN","PSDOPTI",71,0)
SAVE ;save queued variables
"RTN","PSDOPTI",72,0)
 S ZTSAVE("^TMP(""PSD"",$J,")=""
"RTN","PSDOPTI",73,0)
 S (ZTSAVE("PSDT"),ZTSAVE("PSDTB"),ZTSAVE("PSDTB("),ZTSAVE("PSDLOC"))=""
"RTN","PSDOPTI",74,0)
 Q
"RTN","PSDPAT1")
0^1^B84339158^B73058275
"RTN","PSDPAT1",1,0)
PSDPAT1 ;B'ham ISC/JPW,BJW - Prt activity report (Patient/Drug) ; 17 Apr 98
"RTN","PSDPAT1",2,0)
 ;;3.0;CONTROLLED SUBSTANCES ;**7,62,68,72**;13 Feb 97;Build 8
"RTN","PSDPAT1",3,0)
 ;modified for nois:det-0198-42285;displays drugs for destruction,returns,waste,transfers
"RTN","PSDPAT1",4,0)
START ;entry for compile and print
"RTN","PSDPAT1",5,0)
 K ^TMP("PSDPAT",$J),^TMP("PSDPAT1",$J),^TMP("PSDPATL",$J) S (PSDAQTY,PSDCNT)=0,PSDNAOU=NAOU
"RTN","PSDPAT1",6,0)
 I $D(ALL) F PSDR=0:0 S PSDR=$O(^PSD(58.8,+PSDNAOU,1,PSDR)) Q:'PSDR  I $D(^PSD(58.8,+PSDNAOU,1,+PSDR,0)) S PSDRG(+PSDR)=+$P(^(0),U,4)
"RTN","PSDPAT1",7,0)
 F PSDR=0:0 S PSDR=$O(PSDRG(PSDR)) Q:'PSDR  D
"RTN","PSDPAT1",8,0)
 .F PSD=PSDSD:0 S PSD=$O(^PSD(58.81,"ACT",PSD)) Q:'PSD  D
"RTN","PSDPAT1",9,0)
 ..S PSD58=0  F  S PSD58=$O(^PSD(58.81,"ACT",PSD,PSD58)) Q:'PSD58  D
"RTN","PSDPAT1",10,0)
 ...F PSDTYP=0:0 S PSDTYP=$O(^PSD(58.81,"ACT",PSD,PSD58,PSDR,PSDTYP)) Q:'PSDTYP  D
"RTN","PSDPAT1",11,0)
 ....F PSDA=0:0 S PSDA=$O(^PSD(58.81,"ACT",PSD,PSD58,PSDR,PSDTYP,PSDA)) Q:'PSDA  I $P(^PSD(58.81,PSDA,0),U,18)=PSDNAOU!($P(^PSD(58.81,PSDA,0),U,3)=PSDNAOU) D
"RTN","PSDPAT1",12,0)
 .....D CHK2
"RTN","PSDPAT1",13,0)
 .....Q:$D(^TMP("PSDPAT1",$J,PSDR,PSDA))
"RTN","PSDPAT1",14,0)
 .....I $D(^PSD(58.81,PSDA,1)),$P(^PSD(58.81,PSDA,1),"^",4)<PSDSD S PSDSTOP=1
"RTN","PSDPAT1",15,0)
 .....I $D(^PSD(58.81,PSDA,3)) S PSDSTOP=0
"RTN","PSDPAT1",16,0)
 .....Q:$G(PSDSTOP)
"RTN","PSDPAT1",17,0)
 .....S PSDEND=0 I PSD>PSDED S PSDEND=1
"RTN","PSDPAT1",18,0)
 .....S ^TMP("PSDPAT1",$J,PSDR,PSDA)=PSDEND
"RTN","PSDPAT1",19,0)
 F PSDR=0:0 S PSDR=$O(PSDRG(PSDR)) Q:'PSDR  D
"RTN","PSDPAT1",20,0)
 .F PSD=PSDSD:0 S PSD=$O(^PSD(58.81,"AK",PSD)) Q:'PSD  D
"RTN","PSDPAT1",21,0)
 ..S PSDA=0  F  S PSDA=$O(^PSD(58.81,"AK",PSD,PSDNAOU,PSDA)) Q:'PSDA  D
"RTN","PSDPAT1",22,0)
 ...Q:$P(^PSD(58.81,PSDA,0),"^",5)'=PSDR
"RTN","PSDPAT1",23,0)
 ...D CHK2
"RTN","PSDPAT1",24,0)
 ...Q:$D(^TMP("PSDPAT1",$J,PSDR,PSDA))
"RTN","PSDPAT1",25,0)
 ...I $D(^PSD(58.81,PSDA,1)),$P(^PSD(58.81,PSDA,1),"^",4)<PSDSD S PSDSTOP=1
"RTN","PSDPAT1",26,0)
 ...Q:$G(PSDSTOP)
"RTN","PSDPAT1",27,0)
 ...S PSDEND=0 I PSD>PSDED S PSDEND=1
"RTN","PSDPAT1",28,0)
 ...S ^TMP("PSDPAT1",$J,PSDR,PSDA)=PSDEND
"RTN","PSDPAT1",29,0)
 F PSDR=0:0 S PSDR=$O(PSDRG(PSDR)) Q:'PSDR  F PSDA=0:0 S PSDA=$O(^PSD(58.8,+PSDNAOU,1,PSDR,3,PSDA)) Q:'PSDA  D
"RTN","PSDPAT1",30,0)
 .Q:'$D(^PSD(58.8,PSDNAOU,1,PSDR,3,PSDA,0))  S PSD0=^(0),PSD=$P(PSD0,U,15)
"RTN","PSDPAT1",31,0)
 .I (PSD>PSDSD) D
"RTN","PSDPAT1",32,0)
 ..S PSDEND=0 I PSD>PSDED S PSDEND=1
"RTN","PSDPAT1",33,0)
 ..S PSDTR=+$P($G(PSD0),U,17),PSDTYP=$P(^PSD(58.81,PSDTR,0),U,2),PSDSTOP=0 I PSDTYP'=23 D CHK2
"RTN","PSDPAT1",34,0)
 ..Q:$G(PSDSTOP)!($D(^TMP("PSDPAT1",$J,PSDR,PSDTR)))
"RTN","PSDPAT1",35,0)
 ..S ^TMP("PSDPAT1",$J,PSDR,PSDTR)=PSDEND
"RTN","PSDPAT1",36,0)
 F PSD=PSDSD:0 S PSD=$O(^PSD(58.81,"ATRN",PSD)) Q:'PSD  D
"RTN","PSDPAT1",37,0)
 .F PSDA=0:0 S PSDA=$O(^PSD(58.81,"ATRN",PSD,PSDA)) Q:'PSDA  D
"RTN","PSDPAT1",38,0)
 ..S PSD0=^PSD(58.81,PSDA,0) Q:$P(PSD0,U,18)'=NAOU!('$D(PSDRG($P(PSD0,U,5))))  D
"RTN","PSDPAT1",39,0)
 ...S PSDEND=0 I PSD>PSDED S PSDEND=1
"RTN","PSDPAT1",40,0)
 ...Q:$D(^TMP("PSDPAT1",$J,$P(PSD0,U,5),PSDA))
"RTN","PSDPAT1",41,0)
 ...S:PSDRG($P(PSD0,U,5)) ^TMP("PSDPAT1",$J,$P(PSD0,U,5),PSDA)=PSDEND
"RTN","PSDPAT1",42,0)
 S PSDRUG=0 F  S PSDRUG=$O(^TMP("PSDPAT1",$J,PSDRUG)) Q:'PSDRUG  D
"RTN","PSDPAT1",43,0)
 .S (PSDNBAL,PSDA)=0 F  S PSDA=$O(^TMP("PSDPAT1",$J,PSDRUG,PSDA)) Q:'PSDA  D
"RTN","PSDPAT1",44,0)
 ..S PSD0=$G(^PSD(58.81,PSDA,0)),PSDTYP=$P(PSD0,U,2),PSD=$P(PSD0,U,4),PSDRQ=""
"RTN","PSDPAT1",45,0)
 ..S PSDRN=$S($P($G(^PSDRUG(+PSDRUG,0)),U)]"":$P(^(0),U),1:"ZZ/"_PSDRUG_" NAME MISSING")
"RTN","PSDPAT1",46,0)
 ..Q:$P(PSD0,U,11)=3!($P(PSD0,U,2)=12)
"RTN","PSDPAT1",47,0)
 ..S PSDSTOP=0 I PSDTYP'=23 D CHK2
"RTN","PSDPAT1",48,0)
 ..Q:$G(PSDSTOP)
"RTN","PSDPAT1",49,0)
 ..S PSDEND=$G(^TMP("PSDPAT1",$J,PSDRUG,PSDA))
"RTN","PSDPAT1",50,0)
 ..I PSDTYP'=17 S PSDRQ=$P(^PSD(58.81,PSDA,0),U,20) S:$G(PSDRQ) PSD0=$G(^PSD(58.8,PSDNAOU,1,PSDRUG,3,PSDRQ,0))
"RTN","PSDPAT1",51,0)
 ..I '$G(PSDRQ) D  Q
"RTN","PSDPAT1",52,0)
 ...S PSDBAL=$P(PSD0,U,10)
"RTN","PSDPAT1",53,0)
 ...D SET^PSDPAT2 Q
"RTN","PSDPAT1",54,0)
 ..I $G(PSDRQ) D  Q
"RTN","PSDPAT1",55,0)
 ...S PSD=$P(PSD0,U,15)
"RTN","PSDPAT1",56,0)
 ...Q:'$G(PSD)
"RTN","PSDPAT1",57,0)
 ...S PSDNR1=+$P(PSD0,U,7),PSDNR2="",PSDQTY=+$P(PSD0,U,20),PSDBAL=$P(PSD0,U,22),PSDPAT="PHARMACY DISP #"_$P(PSD0,U,16)
"RTN","PSDPAT1",58,0)
 ...S PSDRN=$S($P($G(^PSDRUG(+PSDRUG,0)),U)]"":$P(^(0),U),1:"ZZ/"_PSDRUG_" NAME MISSING") S PSDTR=+$P($G(PSD0),U,17)
"RTN","PSDPAT1",59,0)
 ...I (PSDTYP=18)!(PSDTYP=17) S $P(PSDRG(+PSDRUG),U,2)=+$P(PSDRG(+PSDRUG),U,2)+PSDQTY
"RTN","PSDPAT1",60,0)
 ...S PSDNR1=$S($P($G(^VA(200,PSDNR1,0)),U)]"":$P(^(0),U),1:"UNKNOWN")
"RTN","PSDPAT1",61,0)
 ...S (PSDWQT,PSDWRE,PSDRQT,PSDRRE,PSDDRG1,PSDSOQT,PSDDQT,PSDDRE,PSDRET,PSDDT)="",PSD9="",$P(PSD0,U,16)="",PSDTYP=0
"RTN","PSDPAT1",62,0)
 ...S PSD3=$G(^PSD(58.81,PSDA,3))
"RTN","PSDPAT1",63,0)
 ...I $P(^PSD(58.81,PSDA,0),U,2)=9 S PSDTYP=9 D SET^PSDPAT2 Q
"RTN","PSDPAT1",64,0)
 ...I $P(^PSD(58.81,PSDA,0),U,2)=5 S PSDTYP=5 D SET2^PSDPAT2 Q
"RTN","PSDPAT1",65,0)
 ...S $P(PSD0,U,10)=$P(PSD0,U,22) D SET1^PSDPAT2
"RTN","PSDPAT1",66,0)
 F  S PSDR=$O(PSDRG(PSDR)) Q:'PSDR  I $G(PSDRG(PSDR))  S PSDRN=$S($P($G(^PSDRUG(+PSDR,0)),U)]"":$P(^(0),U),1:"ZZ/"_PSDR_" NAME MISSING") D:'$D(^TMP("PSDPAT",$J,PSDRN))
"RTN","PSDPAT1",67,0)
 .S ^TMP("PSDPAT",$J,PSDRN,DT,"NO ACTIVITY",1)=0,^TMP("PSDPATL",$J,PSDRN)=U_PSDRG(PSDR)
"RTN","PSDPAT1",68,0)
PRINT ;prints data
"RTN","PSDPAT1",69,0)
 I SUM="S" D ^PSDPAT2 G DONE
"RTN","PSDPAT1",70,0)
 S (PG,PSDOUT,PSDAQTY)=0,PSDRN="",$P(LN,"-",132)="" D NOW^%DTC S Y=+$E(%,1,12) X ^DD("DD") S PSDRPDT=Y
"RTN","PSDPAT1",71,0)
 I '$D(^TMP("PSDPAT",$J)) D HDR W !!,?15,"**** NO DISPENSING ACTIVITY ****",!! G DONE
"RTN","PSDPAT1",72,0)
 D HDR S PSDRG="" F  S PSDRG=$O(^TMP("PSDPAT",$J,PSDRG)) Q:PSDRG=""!(PSDOUT)  W !,?5,"=> ",PSDRG,! D CHK F PSD=0:0 S PSD=$O(^TMP("PSDPAT",$J,PSDRG,PSD)) D:'PSD TOT Q:PSD=""!(PSDOUT)  D  Q:PSDOUT
"RTN","PSDPAT1",73,0)
 .S PSDPAT="" F  S PSDPAT=$O(^TMP("PSDPAT",$J,PSDRG,PSD,PSDPAT)) Q:PSDPAT=""!(PSDOUT)  F PSD1=0:0 S PSD1=$O(^TMP("PSDPAT",$J,PSDRG,PSD,PSDPAT,PSD1)) Q:'PSD1!(PSDOUT)  D  Q:PSDOUT
"RTN","PSDPAT1",74,0)
 ..S (PSDQTY,PSDSOQT,PSDRQT,PSDWQT,PSDDQT,PSDSTAT)=0,(PSDRRE,PSDWRE,PSDDRE)=""
"RTN","PSDPAT1",75,0)
 ..S PSD0=^TMP("PSDPAT",$J,PSDRG,PSD,PSDPAT,PSD1),PSDRGN=PSDRG
"RTN","PSDPAT1",76,0)
 ..Q:$P(PSD0,U,4)=3
"RTN","PSDPAT1",77,0)
 ..W ! I $Y+8>IOSL D HDR Q:PSDOUT  W !,?5,"=> ",PSDRG,!
"RTN","PSDPAT1",78,0)
 ..S Y=+$E(PSD,1,12) X ^DD("DD") S PSDT=Y
"RTN","PSDPAT1",79,0)
 ..I $G(PSD0)=0 S PSDQTY=0,PSDPQT=$P(^TMP("PSDPATL",$J,PSDRGN),U,2) W PSDT,?22,PSDPAT,?55,$J(PSDQTY,6),?75,$J(PSDPQT,6),! Q
"RTN","PSDPAT1",80,0)
 ..S PSDTYP=+$P(PSD0,U,4),PSDR=$P(PSD0,U,11),PSDSTAT=+$P(PSD0,U,24),PSDQTY=+$P(PSD0,U)
"RTN","PSDPAT1",81,0)
 ..I (PSDTYP)=9,+$P(PSD0,U,5) D
"RTN","PSDPAT1",82,0)
 ...S PSDPQT=+PSDNBAL+PSDQTY,PSDNBAL=PSDPQT W PSDT,?22,PSDPAT,?45,"*WASTED*",?55,$J(PSDQTY,6),?75,$J(PSDPQT,6),?98,$P(PSD0,U,2),!
"RTN","PSDPAT1",83,0)
 ...S PSDWQT=+$P(PSD0,U,5),PSDWRE=$P(PSD0,U,6),PSDQTY=PSDQTY-PSDWQT
"RTN","PSDPAT1",84,0)
 ...W ?25,PSDWRE,?55,$J(PSDWQT,6),?98,$P(PSD0,U,3),!
"RTN","PSDPAT1",85,0)
 ..I (PSDTYP)=9,'+$P(PSD0,U,5) S PSDPQT=+PSDNBAL+PSDQTY,PSDNBAL=PSDPQT W PSDT,?22,PSDPAT,?55,$J(PSDQTY,6),?75,$J(PSDPQT,6),?98,$P(PSD0,U,2),!,?98,$P(PSD0,U,3),!,?25,$P(PSD0,U,6),!
"RTN","PSDPAT1",86,0)
 ..I PSDTYP=11 S PSDPQT=+PSDNBAL+PSDQTY,PSDNBAL=PSDPQT W PSDT,?22,PSDPAT,?55,$J(PSDQTY,6),?75,$J(PSDPQT,6),?98,$P(PSD0,U,2),!,?98,$P(PSD0,U,3),!
"RTN","PSDPAT1",87,0)
 ..I (+$P(PSD0,U,9)) S PSDRQT=+$P(PSD0,U,9)
"RTN","PSDPAT1",88,0)
 ..I PSDTYP=17 D
"RTN","PSDPAT1",89,0)
 ...S PSDSOQT=+$P(PSD0,U,12)+$P(PSD0,U,5),PSDNBAL=+(PSDNBAL-PSDSOQT)+PSDRQT D
"RTN","PSDPAT1",90,0)
 ....W PSDT,?22,PSDPAT,?54 W:PSDTYP=17 "-" W $J(PSDSOQT,6)
"RTN","PSDPAT1",91,0)
 ....W ?75,$J(PSDNBAL,6),?98,$P(PSD0,U,2),! W:$P(PSD0,U,3)'="" ?98,$P(PSD0,U,3),!
"RTN","PSDPAT1",92,0)
 ....W PSDT,?22,PSDPAT,?45,"*GIVEN*" S PSDQTY=$P(PSD0,U,12) W ?55,$J(PSDQTY,6),!
"RTN","PSDPAT1",93,0)
 ....I PSDRQT S PSDPRT=1 D PRTRET
"RTN","PSDPAT1",94,0)
 ..I (PSDTYP)'=9,+$P(PSD0,U,5) S PSDWQT=+$P(PSD0,U,5),PSDWRE=$P(PSD0,U,6),PSDQTY=PSDQTY-PSDWQT D
"RTN","PSDPAT1",95,0)
 ...W PSDT,?22,PSDPAT,?45,"*WASTED*",?55,$J(PSDWQT,6)
"RTN","PSDPAT1",96,0)
 ...W ?98,$P(PSD0,U,2),!,?25,PSDWRE,?98,$P(PSD0,U,3),!
"RTN","PSDPAT1",97,0)
 ..I PSDTYP=23 S PSDPQT=+PSDNBAL+PSDQTY,PSDNBAL=PSDPQT W PSDT,?22,PSDPAT,?55,$J(PSDQTY,6),?75,$J(PSDPQT,6),?98,$P(PSD0,U,2),!,?98,$P(PSD0,U,3),!
"RTN","PSDPAT1",98,0)
 ..I PSDTYP=0,'$G(PSDSTAT) D
"RTN","PSDPAT1",99,0)
 ...S PSDPQT=+PSDNBAL+PSDQTY,PSDNBAL=PSDPQT W PSDT,?22,PSDPAT,?55,$J(PSDQTY,6),?75,$J(PSDPQT,6),?98,$P(PSD0,U,2),! I $P(PSD0,U,3)'="" W ?98,$P(PSD0,U,3),!
"RTN","PSDPAT1",100,0)
 ...S PSDRQT=+$P(PSD0,U,9),PSDPRT=0 I $G(PSDRQT) D PRTRET
"RTN","PSDPAT1",101,0)
 ..I PSDTYP=0,$G(PSDSTAT)=10 D
"RTN","PSDPAT1",102,0)
 ...S PSDPQT=+PSDNBAL+$P(PSD0,U),PSDNBAL=PSDPQT
"RTN","PSDPAT1",103,0)
 ...W:$P(PSD0,U)'=0 PSDT,?22,PSDPAT,?55,$J(PSDQTY,6),?75,$J(PSDPQT,6),?98,$P(PSD0,U,2),!,?98,$P(PSD0,U,3),!  ; < *62 RJS
"RTN","PSDPAT1",104,0)
 ... S PSDTFDT=$P(PSD0,U,17),Y=PSDTFDT X ^DD("DD") S PSDTFDT=$E(Y,1,17),PSDTFN=$P(PSD0,U,18),PSDT2N=$P(PSD0,U,19),PSDTTDT=$P(PSD0,U,20)
"RTN","PSDPAT1",105,0)
 ...S PSDTTNR=$P(PSD0,U,21),PSDTRQT=+$P(PSD0,U,23),PSDNBAL=+PSDNBAL-PSDTRQT D PRTTRT
"RTN","PSDPAT1",106,0)
 ..I PSDTYP=5,'$G(PSDSTAT) S PSDPQT=+PSDNBAL+PSDQTY,PSDNBAL=PSDPQT D
"RTN","PSDPAT1",107,0)
 ...W PSDT,?22,PSDPAT,?45,"*TRFER*",?55,$J(PSDQTY,6),?75,$J(PSDPQT,6),?98,$P(PSD0,U,2),! I $P(PSD0,U,3)'="" W ?98,$P(PSD0,U,3),!
"RTN","PSDPAT1",108,0)
 ...W ?29,"*TRANSFERED FROM "_$P(PSD0,U,19),"*",?98,$P(PSD0,U,21)
"RTN","PSDPAT1",109,0)
 ...S PSDRQT=+$P(PSD0,U,9) I $G(PSDRQT) D
"RTN","PSDPAT1",110,0)
 ....S PSDRRE=$P(PSD0,U,10),PSDNBAL=+PSDNBAL-PSDRQT,PSDRET=$P(PSD0,U,15),Y=PSDRET X ^DD("DD") S PSDRET=$E(Y,1,17)
"RTN","PSDPAT1",111,0)
 ....S:$G(PSDRET)=0 PSDRET="" W !,PSDRET,?22,PSDPAT,?45,"*RETURN* -",?55,$J(PSDRQT,6),?75,$J(PSDNBAL,6),?98,$P(PSD0,U,2),!,?25,PSDRRE,?98,!
"RTN","PSDPAT1",112,0)
 ..I +$P(PSD0,U,13) S PSDDQT=+$P(PSD0,U,13),PSDDRE=$P(PSD0,U,14),PSDDT=+$P(PSD0,U,16),PSDNBAL=PSDNBAL-PSDDQT D
"RTN","PSDPAT1",113,0)
 ...W PSDT,?22,PSDPAT,?44,"*DESTROY* -",?55,$J(PSDDQT,6),?75,$J(PSDNBAL,6),?98,$P(PSD0,U,2),!,?25,PSDDRE,?98,$P(PSD0,U,3),!
"RTN","PSDPAT1",114,0)
 ..I PSDTYP=5,$G(PSDSTAT)=10 D
"RTN","PSDPAT1",115,0)
 ...S PSDPQT=+PSDNBAL+$P(PSD0,U)-$P(PSD0,U,23),PSDNBAL=PSDPQT
"RTN","PSDPAT1",116,0)
 ...W:$P(PSD0,U)'="" PSDT,?22,PSDPAT,?55,$J(PSDQTY,6),?75,$J(PSDPQT,6),?98,$P(PSD0,U,2),!,?98,$P(PSD0,U,3),!  ; < *62 RJS
"RTN","PSDPAT1",117,0)
 ... S PSDTFDT=$P(PSD0,U,17),Y=PSDTFDT X ^DD("DD") S PSDTFDT=$E(Y,1,17),PSDTFN=$P(PSD0,U,18),PSDT2N=$P(PSD0,U,19),PSDTTDT=$P(PSD0,U,20)
"RTN","PSDPAT1",118,0)
 ...S PSDTTNR=$P(PSD0,U,21),PSDTRQT=+$P(PSD0,U,23) D PRTTRT
"RTN","PSDPAT1",119,0)
 ..I PSDTYP=99,+$P(PSD0,U,9)'=0 D
"RTN","PSDPAT1",120,0)
 ...S PSDRQT=+$P(PSD0,U,9),PSDNBAL=+PSDNBAL-PSDRQT D PRTRET
"RTN","PSDPAT1",121,0)
DONE I $E(IOST)'="C" W @IOF
"RTN","PSDPAT1",122,0)
 I $E(IOST,1,2)="C-",'PSDOUT W ! K DIR,DIRUT S DIR(0)="EA",DIR("A")="END OF REPORT!  Press <RET> to return to the menu" D ^DIR K DIR
"RTN","PSDPAT1",123,0)
END ;
"RTN","PSDPAT1",124,0)
 D KVAR^VADPT K VA,%,%DT,%H,%I,%ZIS,ALL,PSDAQTY,PSDBAL,PSDCNT,DA,PSDT,PSDDT,DFN,DIC,DIR,DIROUT,DIRUT,PSDDQT,DTOUT,PSDDRE,PSDDRG1,DUOUT,LN,LOOP,PSDNAOU,NAOU,NAOUN,PSDNBAL,PSD0,PSD3,PSD7,PSD9,PSDNR1,PSDSTOP
"RTN","PSDPAT1",125,0)
 K PSDNR2,PSDSTAT,PSDPAT,PG,POP,PSD,PSD1,PSDA,PSDATE,PSDED,PSDOUT,PSDPN,PSDPQT,PSDR,PSDRET,PSDRG,PSDRGN,PSDRN,PSDSD,PSDRQT,PSDRRE,PSDRPDT,PSDSOQT,PSD58,PSDRQ,PSDRUG,PSDTBAL,PSDTMP,PSDEND,PSDT2N,PSDTFDT,PSDPRT
"RTN","PSDPAT1",126,0)
 K PSDTFN,PSDTPRV,PSDTR,PSDTRQT,PSDTTDT,PSDTTNR,PSDTTON,PSDTQTY,PSDTYP,PSDQTY,SUM,PSDUQT,VADM,VAERR,PSDWQT,PSDWRE,X,Y,ZTDESC,ZTDTH,ZTIO,ZTRTN,ZTSAVE,ZTSK,^TMP("PSDPAT",$J),^TMP("PSDPAT1",$J),^TMP("PSDPATB",$J),^TMP("PSDPATL",$J)
"RTN","PSDPAT1",127,0)
 D ^%ZISC S:$D(ZTQUEUED) ZTREQ="@"
"RTN","PSDPAT1",128,0)
 Q
"RTN","PSDPAT1",129,0)
PRTTRT ; PRINT TRANSFER TO INFORMATION
"RTN","PSDPAT1",130,0)
 W PSDTFDT,?22,PSDPAT,?45,"*TRFER* -",?55,$J(PSDTRQT,6),?75,$J(PSDNBAL,6),?98,$P(PSD0,U,18),!,?32,"*TRANSFER TO "_$P(PSD0,U,19),"*",?98,$P(PSD0,U,21),!
"RTN","PSDPAT1",131,0)
 Q
"RTN","PSDPAT1",132,0)
PRTRET ; PRINT RETURN INFORMATION
"RTN","PSDPAT1",133,0)
 S PSDRRE=$P(PSD0,U,10),PSDRET=$P(PSD0,U,15),Y=PSDRET X ^DD("DD") S PSDRET=$E(Y,1,17)
"RTN","PSDPAT1",134,0)
 S:$G(PSDRET)=0 PSDRET="",PSDNBAL=+PSDNBAL-PSDRQT
"RTN","PSDPAT1",135,0)
 W PSDRET,?22,PSDPAT,?45,"*RETURN*" W:'$G(PSDPRT) " -" W ?55,$J(PSDRQT,6) W:'$G(PSDPRT) ?75,$J(PSDNBAL,6)
"RTN","PSDPAT1",136,0)
 W ?98,$P(PSD0,U,2),!,?25,PSDRRE,?98,$P(PSD0,U,3),!
"RTN","PSDPAT1",137,0)
 K PSDPRT
"RTN","PSDPAT1",138,0)
 Q
"RTN","PSDPAT1",139,0)
HDR ;header
"RTN","PSDPAT1",140,0)
 I $E(IOST,1,2)="C-",PG K DA,DIR S DIR(0)="E" D ^DIR K DIR I 'Y S PSDOUT=1 Q
"RTN","PSDPAT1",141,0)
 S PG=PG+1 W:$Y @IOF W !,?20,"Activity Report for ",NAOUN,?55,PSDRPDT,?115,"Page: ",PG,!,?20,"Date: ",$P(PSDATE,U)," to ",$P(PSDATE,U,2),!!
"RTN","PSDPAT1",142,0)
 W ?5,"=>  DRUG",!,"DATE/TIME",?22,"PATIENT",?55,"QUANTITY",?75,"BALANCE",?98,"NURSE 1",!,?98,"NURSE2",!,LN,!!
"RTN","PSDPAT1",143,0)
 Q
"RTN","PSDPAT1",144,0)
CHK ;sets total qty used and balance
"RTN","PSDPAT1",145,0)
 S PSDTQTY=+$G(^TMP("PSDPATL",$J,PSDRG)),PSDBAL=+$P($G(^TMP("PSDPATL",$J,PSDRG)),U,2),PSDUQT=PSDBAL-PSDTQTY,PSDNBAL=$P($G(^TMP("PSDPATL",$J,PSDRG)),U,2)-$P($G(^TMP("PSDPATL",$J,PSDRG)),U,1)
"RTN","PSDPAT1",146,0)
 Q
"RTN","PSDPAT1",147,0)
CHK2 ;CHECK THE TTYPE
"RTN","PSDPAT1",148,0)
 S PSDSTOP=0 I PSDTYP'=23 D
"RTN","PSDPAT1",149,0)
 .I '$D(^PSD(58.81,PSDA,1)) D
"RTN","PSDPAT1",150,0)
 ..I PSDTYP'=17 S PSDSTOP=1
"RTN","PSDPAT1",151,0)
 ..I PSDTYP=9 S PSDSTOP=0
"RTN","PSDPAT1",152,0)
 Q
"RTN","PSDPAT1",153,0)
TOT ;prints total qty used and balance
"RTN","PSDPAT1",154,0)
 I $Y+4>IOSL D HDR Q:PSDOUT  W !,?5,"=> ",$S(PSDRG]"":PSDRG,1:PSDRGN),!
"RTN","PSDPAT1",155,0)
 ;W !,?55,"----------",?75,"----------",!,?5,"Total Quantity Used and Balance",?55,$J(PSDAQTY,6),?70,$J(PSDPQT,6),!
"RTN","PSDPAT1",156,0)
 W ! S PSDAQTY=0
"RTN","PSDPAT1",157,0)
 Q
"RTN","PSDPAT2")
0^3^B54527056^B45069536
"RTN","PSDPAT2",1,0)
PSDPAT2 ;B'ham ISC/JPW - Print Patient/Drug Report (summary) ; 1 Feb 94
"RTN","PSDPAT2",2,0)
 ;;3.0;CONTROLLED SUBSTANCES ;**68,72**;13 Feb 97;Build 8
"RTN","PSDPAT2",3,0)
 D NOW^%DTC S Y=+$E(%,1,12) X ^DD("DD") S RPDT=Y
"RTN","PSDPAT2",4,0)
 S (PG,PSDOUT)=0,$P(LN,"-",80)=""
"RTN","PSDPAT2",5,0)
 I '$D(^TMP("PSDPATL",$J)) D HDR W !!,?45,"****  NO DISPENSING SUMMARY  ****" Q
"RTN","PSDPAT2",6,0)
PRINT ;prints data for dispensing
"RTN","PSDPAT2",7,0)
 D HDR Q:PSDOUT
"RTN","PSDPAT2",8,0)
 S LOOP="" F  S LOOP=$O(^TMP("PSDPATL",$J,LOOP)) Q:LOOP=""!(PSDOUT)  D:$Y+4>IOSL HDR Q:PSDOUT  D  Q:PSDOUT
"RTN","PSDPAT2",9,0)
 .W !,LOOP,?55,$J(+$P(^TMP("PSDPATL",$J,LOOP),"^",3),6),?70,$J(+$P(^(LOOP),"^",2),6),!
"RTN","PSDPAT2",10,0)
DONE I SUM,$E(IOST)'="C" W @IOF
"RTN","PSDPAT2",11,0)
 Q
"RTN","PSDPAT2",12,0)
HDR ;lists header information
"RTN","PSDPAT2",13,0)
 I $E(IOST,1,2)="C-",PG W ! K DA,DIR S DIR(0)="E" D ^DIR K DIR I 'Y S PSDOUT=1 Q
"RTN","PSDPAT2",14,0)
 W:$Y @IOF S PG=PG+1 W !,?22,"ACTIVITY",?70,"PG "_PG,!,?29,"** SUMMARY **",!,?27,"Date: ",$P(PSDATE,"^")," to ",$P(PSDATE,"^",2),!!,"NAOU: ",NAOUN,!!
"RTN","PSDPAT2",15,0)
 W "DRUG",?55,"QUANTITY USED",?70,"BALANCE",!,LN,!
"RTN","PSDPAT2",16,0)
 Q
"RTN","PSDPAT2",17,0)
 ;; ADDED FOR 3*68 - RJS
"RTN","PSDPAT2",18,0)
SET ;sets data
"RTN","PSDPAT2",19,0)
 N PSDREA
"RTN","PSDPAT2",20,0)
 Q:'$D(^PSD(58.81,PSDA,0))  S PSD0=^(0),PSDQTY=+$P(PSD0,U,6),PSD=$P(PSD0,U,4),PSDREA=$P(PSD0,U,16)
"RTN","PSDPAT2",21,0)
 S PSD9=$G(^PSD(58.81,PSDA,9)) S PSDSOQT=+$P(PSD9,U,3),PSDWQT=+$P(PSD9,U,4)
"RTN","PSDPAT2",22,0)
 I +$P(PSD0,U,5) S PSDDRG1=+$P(PSD0,U,5)
"RTN","PSDPAT2",23,0)
 I PSDTYP=17,'+$P(^PSD(58.81,PSDA,9),"^",1) D
"RTN","PSDPAT2",24,0)
 .S PSDTYP=9,PSDQTY=PSDQTY*-1,PSDREA="DEFECTIVE DOSE"
"RTN","PSDPAT2",25,0)
 I PSDTYP=17 S $P(PSDRG(+PSDRUG),U,2)=+$P(PSDRG(+PSDRUG),U,2)+PSDSOQT+PSDWQT
"RTN","PSDPAT2",26,0)
 S PSD3=$G(^PSD(58.81,PSDA,3)) S PSDRET=+$P(PSD3,U),PSDRQT=+$P(PSD3,U,2),PSDRRE=$P(PSD3,U,3),PSDDQT=+$P(PSD3,U,5),PSDDRE=$P(PSD3,U,6),PSDDT=+$P(PSD3,U,4)
"RTN","PSDPAT2",27,0)
 S DFN=+$P($G(PSD9),U) D DEM^VADPT
"RTN","PSDPAT2",28,0)
 S PSDPAT=$S(PSDTYP=18:"WASTED AMOUNT",PSDTYP=11:"INITIALIZE BALANCE",PSDTYP=9:"BALANCE ADJUSTMENT",PSDTYP=23:"COUNT VERIFICATION",'VAERR:VADM(1),1:"UNKNOWN")
"RTN","PSDPAT2",29,0)
 S:PSDTYP=2!(PSDTYP=3) PSDPAT="PHARMACY DISP#"_$P(PSD0,U,17),PSDTYP=0,PSDTR=PSDA
"RTN","PSDPAT2",30,0)
 S PSDNR1=$S($P(PSD9,U,2)'="":$P(PSD9,U,2),1:$P(PSD0,U,7))
"RTN","PSDPAT2",31,0)
 S:PSDNR1'=$P(PSD0,U,7) PSDNR1(1)=$P(PSD0,U,7)
"RTN","PSDPAT2",32,0)
 S:+$G(PSDNR1) PSDNR1=$S($P($G(^VA(200,+PSDNR1,0)),U)]"":$P(^(0),U),1:"UNKNOWN")
"RTN","PSDPAT2",33,0)
 S PSDNR2=$P($G(PSD9),U,6) S:PSDNR2 PSDNR2=$S($P($G(^VA(200,+PSDNR2,0)),U)]"":$P(^(0),U),1:"")
"RTN","PSDPAT2",34,0)
 S PSDRN=$S($P($G(^PSDRUG(+PSDRUG,0)),U)]"":$P(^(0),U),1:"ZZ/"_PSDRUG_" NAME MISSING")
"RTN","PSDPAT2",35,0)
SET1 ;sets ^TMP("PSDPAT"
"RTN","PSDPAT2",36,0)
 I PSDTYP=17,'+$P(^PSD(58.81,PSDA,9),"^",1) S PSDTYP=9
"RTN","PSDPAT2",37,0)
 I $G(^PSD(58.81,PSDA,1)),$P(PSD3,U,1)'="" D CHKRET Q:PSD<PSDSD
"RTN","PSDPAT2",38,0)
 I $P(PSD3,U,4)'="" D CHKDEST
"RTN","PSDPAT2",39,0)
 I PSDTYP=0 D CHKNOD7
"RTN","PSDPAT2",40,0)
 S PSDQTY=$S(PSDTYP=17:0,1:PSDQTY),PSDRQT=$S(PSDTYP=17:PSDRQT,1:-PSDRQT)
"RTN","PSDPAT2",41,0)
 I PSD>PSDED N PSDEND S PSDEND=1
"RTN","PSDPAT2",42,0)
 I '$G(PSDEND) D
"RTN","PSDPAT2",43,0)
 .Q:PSD<PSDSD
"RTN","PSDPAT2",44,0)
 .K PSDATA
"RTN","PSDPAT2",45,0)
 .I '$D(PSDREA) N PSDREA S PSDREA=$P(PSD0,U,16)
"RTN","PSDPAT2",46,0)
 .S PSDATA=PSDQTY_U_PSDNR1_U_PSDNR2_U_PSDTYP_U_PSDWQT_U_PSDREA_U_PSDBAL_U_$G(PSDNR1(1))_U_PSDRQT_U_PSDRRE_U_PSDDRG1_U_PSDSOQT_"^^^"_PSDRET_U_PSDDT
"RTN","PSDPAT2",47,0)
 .S PSDCNT=PSDCNT+1 D PSDPAT,PSDPATL I $P(PSD3,U,4)'=""
"RTN","PSDPAT2",48,0)
 I $G(PSDEND) D
"RTN","PSDPAT2",49,0)
 .Q:PSD<PSDSD
"RTN","PSDPAT2",50,0)
 .S PSDATA=1 D PSDPATL
"RTN","PSDPAT2",51,0)
 I $G(PSDTRQT),PSDTFDT<PSDED D
"RTN","PSDPAT2",52,0)
 .I '$G(PSDEND) D
"RTN","PSDPAT2",53,0)
 ..I PSD<PSDED,PSD>PSDSD S PSDATA="0^^^"_PSDTYP_"^^^"_PSDBAL_"^^^^^^^^^"_U_PSDTFDT_U_PSDNR1_U_PSDT2N_U_PSDTTDT_U_PSDTTNR_U_PSDTPRV_U_PSDTRQT_U_PSDSTAT
"RTN","PSDPAT2",54,0)
 ..S PSDQTY=PSDTRQT*-1
"RTN","PSDPAT2",55,0)
 ..N PSD S PSD=PSDTFDT,PSDCNT=PSDCNT+1 D PSDPAT,PSDPATL
"RTN","PSDPAT2",56,0)
 . I $G(PSDEND) S PSDATA=1 D PSDPATL
"RTN","PSDPAT2",57,0)
 .S PSDEND=$G(^TMP("PSDPAT1",$J,PSDRUG,PSDA))
"RTN","PSDPAT2",58,0)
 I $G(PSDTRQT),(PSDTFDT>PSDED!(PSDTFDT=PSDED)) N PSDEND S PSDQTY=PSDTRQT*-1,PSDEND=1 D
"RTN","PSDPAT2",59,0)
 .I $G(PSDEND) S PSDATA=1 D PSDPATL
"RTN","PSDPAT2",60,0)
 K PSDATA,PSDQTY,PSDTRQT,PSDNR1,PSDNR2,PSD0,PSD3,PSD7,PSDTR Q
"RTN","PSDPAT2",61,0)
SET2 ;SETS ^TMP("PSDPAT"
"RTN","PSDPAT2",62,0)
 N PSDTRDT,PSDPAT
"RTN","PSDPAT2",63,0)
 S PSD0=$G(^PSD(58.81,PSDA,0)),PSDRN=$S($P($G(^PSDRUG(+PSDRUG,0)),U)]"":$P(^(0),U),1:"ZZ/"_PSDRUG_" NAME MISSING")
"RTN","PSDPAT2",64,0)
 S PSDTRDT=$P(^PSD(58.81,PSDA,1),U,4),PSDPAT="PHARMACY DISP #"_$P(PSD0,U,17),PSD=$P(PSD0,U,4)
"RTN","PSDPAT2",65,0)
 Q:$D(^TMP("PSDPAT",$J,PSDRN,PSDTRDT))
"RTN","PSDPAT2",66,0)
 I PSDTYP=5 S PSD7=$G(^PSD(58.81,+PSDA,7)) D NODE7
"RTN","PSDPAT2",67,0)
 S PSDTR=PSDA D
"RTN","PSDPAT2",68,0)
 .D CHKNOD7
"RTN","PSDPAT2",69,0)
 .I $G(PSDTRQT) D
"RTN","PSDPAT2",70,0)
 ..I PSD<PSDED,PSD>PSDSD S PSDEND=0
"RTN","PSDPAT2",71,0)
 ..I '$G(PSDEND) D
"RTN","PSDPAT2",72,0)
 ...K PSDATA
"RTN","PSDPAT2",73,0)
 ...S PSDCNT=PSDCNT+1,PSDPAT="PHARMACY DISP #"_$P(PSD0,U,17),PSDATA="^^^0^^^^^^^^^^^^^"_PSDTFDT_U_PSDTFN_U_PSDT2N_U_PSDTTDT_U_PSDTTNR_U_PSDTPRV_U_PSDTRQT_U_PSDSTAT
"RTN","PSDPAT2",74,0)
 ...D PSDPAT,PSDPATL
"RTN","PSDPAT2",75,0)
 ..S PSDEND=$G(^TMP("PSDPAT1",$J,PSDRUG,PSDA))
"RTN","PSDPAT2",76,0)
 K PSDATA,PSDQTY,PSDTRQT,PSDNR1,PSDNR2,PSD0,PSD3,PSD7,PSDTR
"RTN","PSDPAT2",77,0)
 Q
"RTN","PSDPAT2",78,0)
CHKNOD7 ; COLLECTS TRANSFER DATA
"RTN","PSDPAT2",79,0)
 S PSD7=$G(^PSD(58.81,+PSDTR,7)) Q:$G(PSD7)=""
"RTN","PSDPAT2",80,0)
 S PSDSTAT=$P($G(^PSD(58.81,+PSDTR,0)),U,11)
"RTN","PSDPAT2",81,0)
 S PSDTFDT=+$P(PSD7,U),PSDTTON=+$P(PSD7,U,3),PSDT2N=$P($G(^PSD(58.8,PSDTTON,0)),U),PSDTTDT=+$P(PSD7,U,4),PSDTPRV=+$P(PSD7,U,6),PSDTRQT=+$P(PSD7,U,7)
"RTN","PSDPAT2",82,0)
 S PSDTFN=$S($P(PSD7,U,2):$P(PSD7,U,2),1:$P(PSD0,U,7))
"RTN","PSDPAT2",83,0)
 S:PSDTFN'=$P(PSD0,U,7) PSDTFN(1)=$P(PSD0,U,7) S PSDTFN=$S($P($G(^VA(200,+PSDTFN,0)),U)]"":$P(^(0),U),1:"UNKNOWN")
"RTN","PSDPAT2",84,0)
 S PSDTTNR=$P($G(PSD7),U,5) S:PSDTTNR PSDTTNR=$S($P($G(^VA(200,+PSDTTNR,0)),U)]"":$P(^(0),U),1:"")
"RTN","PSDPAT2",85,0)
 Q
"RTN","PSDPAT2",86,0)
NODE7 ; SETS TRANSFERS BETWEEN NAOU'S
"RTN","PSDPAT2",87,0)
 I $P(PSD3,U,1)'="" D CHKRET Q:PSD<PSDSD
"RTN","PSDPAT2",88,0)
 I $P(PSD3,U,4)'="" D CHKDEST Q:PSD<PSDSD
"RTN","PSDPAT2",89,0)
 S (PSDTFDT,PSDTFN,PSDTTDT,PSDTTNR,PSDTPRV,PSDTRQT,PSDSTAT)=""
"RTN","PSDPAT2",90,0)
 S PSDTTON=+$P(^PSD(58.81,$P(PSD7,U,6),0),U,18),PSDT2N=$P($G(^PSD(58.8,PSDTTON,0)),U),PSDTRQT=+PSDQTY
"RTN","PSDPAT2",91,0)
 I PSD<PSDED,PSD>PSDSD S PSDEND=0
"RTN","PSDPAT2",92,0)
 I '$G(PSDEND) D
"RTN","PSDPAT2",93,0)
 .S PSDTFN=+$P(^PSD(58.81,$P(PSD7,U,6),7),U,2) S:PSDTFN PSDTFN=$S($P($G(^VA(200,+PSDTFN,0)),U)]"":$P(^(0),U),1:"")
"RTN","PSDPAT2",94,0)
 .S PSDTRQT=$P(^PSD(58.81,$P(PSD7,U,6),7),U,7)
"RTN","PSDPAT2",95,0)
 .K PSDATA S PSDATA=PSDQTY_U_PSDNR1_U_PSDNR2_U_PSDTYP_U_PSDWQT_U_$P(PSD0,U,16)_"^^"_$G(PSDNR1(1))_U_PSDRQT_U_PSDRRE
"RTN","PSDPAT2",96,0)
 .S PSDATA=PSDATA_U_PSDDRG1_U_PSDSOQT_"^^^^^^^"_PSDT2N_U_U_PSDTFN_"^^"_PSDTRQT_U,PSDCNT=PSDCNT+1
"RTN","PSDPAT2",97,0)
 .Q:PSD<PSDSD
"RTN","PSDPAT2",98,0)
 .D PSDPAT,PSDPATL
"RTN","PSDPAT2",99,0)
 .S PSDEND=$G(^TMP("PSDPAT1",$J,PSDRUG,PSDA))
"RTN","PSDPAT2",100,0)
 I $G(PSDEND) D PSDPAT,PSDPATL
"RTN","PSDPAT2",101,0)
 I $P(PSD7,U,1) S PSDTR=PSDA D
"RTN","PSDPAT2",102,0)
 .D CHKNOD7
"RTN","PSDPAT2",103,0)
 .I PSD<PSDED,PSD>PSDSD S PSDEND=0
"RTN","PSDPAT2",104,0)
 .I '$G(PSDEND) D
"RTN","PSDPAT2",105,0)
 ..K PSDATA
"RTN","PSDPAT2",106,0)
 ..S $P(PSDATA,U,4)=PSDTYP,$P(PSDATA,U,17)=PSDTFDT,PSDATA=PSDATA_U_PSDTFN_U_PSDT2N_U_PSDTTDT_U_PSDTTNR_U_PSDTPRV_U_PSDTRQT_U_PSDSTAT
"RTN","PSDPAT2",107,0)
 ..S PSDCNT=PSDCNT+1,PSDQTY=PSDTRQT*-1 D PSDPAT,PSDPATL
"RTN","PSDPAT2",108,0)
 .S PSDEND=$G(^TMP("PSDPAT1",$J,PSDRUG,PSDA))
"RTN","PSDPAT2",109,0)
 I $G(PSDEND) s PSDATA=1 D PSDPATL
"RTN","PSDPAT2",110,0)
 Q
"RTN","PSDPAT2",111,0)
CHKRET ; SETS RETURNED ITEM INFORMATION
"RTN","PSDPAT2",112,0)
 N PSD,PSDNR1,PSDNR2,PSDQTY S PSD=$P(^PSD(58.81,PSDA,0),U,19),(PSDQTY,PSDWQT,PSDSOQT,PSDDQT,PSDDRE)=0
"RTN","PSDPAT2",113,0)
 S PSDNR1=+$P(^PSD(58.81,PSDA,1),U,10),PSDNR1=$S($P($G(^VA(200,+PSDNR1,0)),U)]"":$P(^(0),U),1:"UNKNOWN")
"RTN","PSDPAT2",114,0)
 S PSDNR2=+$P(^PSD(58.81,PSDA,1),U,14) S:PSDNR2 PSDNR2=$S($P($G(^VA(200,+PSDNR2,0)),U)]"":$P(^(0),U),1:"")
"RTN","PSDPAT2",115,0)
 S PSDRET=+$P(PSD3,U),PSDRQT=+$P(PSD3,U,2),PSDRRE=$P(PSD3,U,3),PSDDQT=+$P(PSD3,U,5),PSDDRE=$P(PSD3,U,6),PSDDT=+$P(PSD3,U,4)
"RTN","PSDPAT2",116,0)
 K PSDATA
"RTN","PSDPAT2",117,0)
 S PSDQTY=PSDRQT*-1
"RTN","PSDPAT2",118,0)
 I PSD>PSDED N PSDEND S PSDEND=1
"RTN","PSDPAT2",119,0)
 I '$G(PSDEND) D
"RTN","PSDPAT2",120,0)
 .I PSD<PSDED D
"RTN","PSDPAT2",121,0)
 ..S PSDATA="0^"_PSDNR1_U_PSDNR2_"^99^0^"_$P(PSD0,U,16)_"^0^^"_PSDRQT_U_PSDRRE_U_PSDDRG1_"^0^0^0^"_PSDRET
"RTN","PSDPAT2",122,0)
 ..S PSDCNT=PSDCNT+1
"RTN","PSDPAT2",123,0)
 ..D PSDPAT,PSDPATL
"RTN","PSDPAT2",124,0)
 ..S PSDRQT=0,(PSDRRE,PSDRET)=""
"RTN","PSDPAT2",125,0)
 I $G(PSDEND) D
"RTN","PSDPAT2",126,0)
 .Q:PSD<PSDSD
"RTN","PSDPAT2",127,0)
 .S PSDATA=1 D PSDPATL
"RTN","PSDPAT2",128,0)
 S PSDRQT=0,PSDRRE="" K PSDATA
"RTN","PSDPAT2",129,0)
 Q 
"RTN","PSDPAT2",130,0)
CHKDEST ; SETS DESTROYED ITEM INFORMATION
"RTN","PSDPAT2",131,0)
 N PSD,PSDNR1,PSDNR2,PSDQTY  S PSD=$P(PSD3,U,4)
"RTN","PSDPAT2",132,0)
 S PSDNR1=+$P(^PSD(58.81,PSDA,1),U,10),PSDNR1=$S($P($G(^VA(200,+PSDNR1,0)),U)]"":$P(^(0),U),1:"UNKNOWN")
"RTN","PSDPAT2",133,0)
 S PSDNR2=+$P(^PSD(58.81,PSDA,1),U,14) S:PSDNR2 PSDNR2=$S($P($G(^VA(200,+PSDNR2,0)),U)]"":$P(^(0),U),1:"")
"RTN","PSDPAT2",134,0)
 S PSDDQT=$P(PSD3,U,5),PSDDRE=$P(PSD3,U,6) K PSDATA
"RTN","PSDPAT2",135,0)
 I PSD>PSDED N PSDEND S PSDEND=1
"RTN","PSDPAT2",136,0)
 I '$G(PSDEND) D
"RTN","PSDPAT2",137,0)
 .Q:PSD<PSDSD
"RTN","PSDPAT2",138,0)
 .S PSDATA="0^"_PSDNR1_U_PSDNR2_"^4^0^"_$P(PSD0,U,16)_"^0^^0^0^"_PSDDRG1_"^0^"_PSDDQT_U_PSDDRE
"RTN","PSDPAT2",139,0)
 .S PSDCNT=PSDCNT+1 D PSDPAT
"RTN","PSDPAT2",140,0)
 .S PSDQTY=PSDDQT*-1,PSDATA=1 D PSDPATL
"RTN","PSDPAT2",141,0)
 I $G(PSDEND) S PSDQTY=PSDDQT*-1,PSDATA=1 D PSDPATL
"RTN","PSDPAT2",142,0)
 K PSDATA
"RTN","PSDPAT2",143,0)
 Q 
"RTN","PSDPAT2",144,0)
PSDPAT ;sets ^TMP("PSDPAT"
"RTN","PSDPAT2",145,0)
 Q:'$D(PSDATA)
"RTN","PSDPAT2",146,0)
 S ^TMP("PSDPAT",$J,PSDRN,PSD,PSDPAT,PSDCNT)=PSDATA
"RTN","PSDPAT2",147,0)
 Q
"RTN","PSDPAT2",148,0)
PSDPATL ;sets ^TMP("PSDPATL"
"RTN","PSDPAT2",149,0)
 Q:'$D(PSDATA)
"RTN","PSDPAT2",150,0)
 S:'$D(^TMP("PSDPATL",$J,PSDRN)) ^TMP("PSDPATL",$J,PSDRN)=0
"RTN","PSDPAT2",151,0)
 S ^TMP("PSDPATL",$J,PSDRN)=+^TMP("PSDPATL",$J,PSDRN)+($S(PSDTYP=18:-PSDQTY,PSDTYP=17:-((PSDSOQT+PSDWQT)-PSDRQT),1:PSDQTY)),$P(^(PSDRN),U,2)=+PSDRG(PSDRUG)
"RTN","PSDPAT2",152,0)
 S $P(^TMP("PSDPATL",$J,PSDRN),U,3)=+$P(^TMP("PSDPATL",$J,PSDRN),U,3)+$P(PSDRG(+PSDRUG),U,2)
"RTN","PSDPAT2",153,0)
 Q
"VER")
8.0^22.0
"BLD",8777,6)
^63
**END**
**END**

