Released PSS*1*220 SEQ #198
Extracted from mail message
**KIDS**:PSS*1.0*220^

**INSTALL NAME**
PSS*1.0*220
"BLD",10784,0)
PSS*1.0*220^PHARMACY DATA MANAGEMENT^0^3180907^y
"BLD",10784,1,0)
^^4^4^3180906^
"BLD",10784,1,1,0)
1) Errors when using the PSS LOOK option in VistA
"BLD",10784,1,2,0)
2) Hard error within PSS DRUG ENTER/EDIT option for Lab Monitoring
"BLD",10784,1,3,0)
3) Duplicate prompt to create a new Orderable Item when entering a new 
"BLD",10784,1,4,0)
   Drug File entry
"BLD",10784,4,0)
^9.64PA^^
"BLD",10784,6.3)
4
"BLD",10784,"KRN",0)
^9.67PA^779.2^20
"BLD",10784,"KRN",.4,0)
.4
"BLD",10784,"KRN",.401,0)
.401
"BLD",10784,"KRN",.402,0)
.402
"BLD",10784,"KRN",.403,0)
.403
"BLD",10784,"KRN",.5,0)
.5
"BLD",10784,"KRN",.84,0)
.84
"BLD",10784,"KRN",3.6,0)
3.6
"BLD",10784,"KRN",3.8,0)
3.8
"BLD",10784,"KRN",9.2,0)
9.2
"BLD",10784,"KRN",9.8,0)
9.8
"BLD",10784,"KRN",9.8,"NM",0)
^9.68A^5^5
"BLD",10784,"KRN",9.8,"NM",1,0)
PSSDEE^^0^B151722192
"BLD",10784,"KRN",9.8,"NM",2,0)
PSSDEE1^^0^B22862330
"BLD",10784,"KRN",9.8,"NM",3,0)
PSSLOOK^^0^B137641364
"BLD",10784,"KRN",9.8,"NM",4,0)
PSSPOIMN^^0^B82922600
"BLD",10784,"KRN",9.8,"NM",5,0)
PSSPOIM1^^0^B133407770
"BLD",10784,"KRN",9.8,"NM","B","PSSDEE",1)

"BLD",10784,"KRN",9.8,"NM","B","PSSDEE1",2)

"BLD",10784,"KRN",9.8,"NM","B","PSSLOOK",3)

"BLD",10784,"KRN",9.8,"NM","B","PSSPOIM1",5)

"BLD",10784,"KRN",9.8,"NM","B","PSSPOIMN",4)

"BLD",10784,"KRN",19,0)
19
"BLD",10784,"KRN",19.1,0)
19.1
"BLD",10784,"KRN",101,0)
101
"BLD",10784,"KRN",409.61,0)
409.61
"BLD",10784,"KRN",771,0)
771
"BLD",10784,"KRN",779.2,0)
779.2
"BLD",10784,"KRN",870,0)
870
"BLD",10784,"KRN",8989.51,0)
8989.51
"BLD",10784,"KRN",8989.52,0)
8989.52
"BLD",10784,"KRN",8994,0)
8994
"BLD",10784,"KRN","B",.4,.4)

"BLD",10784,"KRN","B",.401,.401)

"BLD",10784,"KRN","B",.402,.402)

"BLD",10784,"KRN","B",.403,.403)

"BLD",10784,"KRN","B",.5,.5)

"BLD",10784,"KRN","B",.84,.84)

"BLD",10784,"KRN","B",3.6,3.6)

"BLD",10784,"KRN","B",3.8,3.8)

"BLD",10784,"KRN","B",9.2,9.2)

"BLD",10784,"KRN","B",9.8,9.8)

"BLD",10784,"KRN","B",19,19)

"BLD",10784,"KRN","B",19.1,19.1)

"BLD",10784,"KRN","B",101,101)

"BLD",10784,"KRN","B",409.61,409.61)

"BLD",10784,"KRN","B",771,771)

"BLD",10784,"KRN","B",779.2,779.2)

"BLD",10784,"KRN","B",870,870)

"BLD",10784,"KRN","B",8989.51,8989.51)

"BLD",10784,"KRN","B",8989.52,8989.52)

"BLD",10784,"KRN","B",8994,8994)

"BLD",10784,"QDEF")
^^^^NO^^^^^^NO
"BLD",10784,"QUES",0)
^9.62^^
"BLD",10784,"REQB",0)
^9.611^4^3
"BLD",10784,"REQB",1,0)
PSS*1.0*208^2
"BLD",10784,"REQB",3,0)
PSS*1.0*204^2
"BLD",10784,"REQB",4,0)
PSS*1.0*227^2
"BLD",10784,"REQB","B","PSS*1.0*204",3)

"BLD",10784,"REQB","B","PSS*1.0*208",1)

"BLD",10784,"REQB","B","PSS*1.0*227",4)

"MBREQ")
0
"PKG",488,-1)
1^1
"PKG",488,0)
PHARMACY DATA MANAGEMENT^PSS^Maintenance of Pharmacy files.
"PKG",488,20,0)
^9.402P^^
"PKG",488,22,0)
^9.49I^1^1
"PKG",488,22,1,0)
1.0^2970930^3000316^66481
"PKG",488,22,1,"PAH",1,0)
220^3180907
"PKG",488,22,1,"PAH",1,1,0)
^^4^4^3180907
"PKG",488,22,1,"PAH",1,1,1,0)
1) Errors when using the PSS LOOK option in VistA
"PKG",488,22,1,"PAH",1,1,2,0)
2) Hard error within PSS DRUG ENTER/EDIT option for Lab Monitoring
"PKG",488,22,1,"PAH",1,1,3,0)
3) Duplicate prompt to create a new Orderable Item when entering a new 
"PKG",488,22,1,"PAH",1,1,4,0)
   Drug File entry
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
5
"RTN","PSSDEE")
0^1^B151722192^B151650966
"RTN","PSSDEE",1,0)
PSSDEE ;BIR/WRT - MASTER DRUG ENTER/EDIT ROUTINE ; 18 May 2018  10:54 AM
"RTN","PSSDEE",2,0)
 ;;1.0;PHARMACY DATA MANAGEMENT;**3,5,15,16,20,22,28,32,34,33,38,57,47,68,61,82,90,110,155,156,180,193,200,207,195,227,220**;9/30/97;Build 4
"RTN","PSSDEE",3,0)
 ;
"RTN","PSSDEE",4,0)
 ;Reference to ^PS(59 supported by DBIA #1976
"RTN","PSSDEE",5,0)
 ;Reference to REACT1^PSNOUT supported by DBIA #2080
"RTN","PSSDEE",6,0)
 ;Reference to $$UP^XLFSTR(X) supported by DBIA #10104
"RTN","PSSDEE",7,0)
 ;Reference to $$PSJDF^PSNAPIS(P1,P3) supported by DBIA #2531
"RTN","PSSDEE",8,0)
 ;Reference to PSNAPIS supported by DBIA #2531
"RTN","PSSDEE",9,0)
 ;Reference to ^XMB("NETNAME" supported by DBIA #1131
"RTN","PSSDEE",10,0)
 ;Reference to ^XUSEC supported by DIBA #10076
"RTN","PSSDEE",11,0)
 ;Reference to FDR & FDT^PSNACT supported by DBIA #6754
"RTN","PSSDEE",12,0)
 ;
"RTN","PSSDEE",13,0)
BEGIN N PSSUPRAF,PSSTDRUG
"RTN","PSSDEE",14,0)
 S PSSFLAG=0 D ^PSSDEE2 S PSSZ=1 F PSSXX=1:1 K DA D ASK Q:PSSFLAG
"RTN","PSSDEE",15,0)
DONE D ^PSSDEE2 K PSSFLAGK,PSSXX,DIE,DIR,CLFLAG,CLFALG,DISPDRG,DLAYGO,DR,ENTRY,FLAG,FLG1,FLG2,FLG4,FLG5,FLG6,FLG7,FLGKY,FLGMTH,FLGNDF,FLGOI,K,NEWDF
"RTN","PSSDEE",16,0)
 K NFLAG,NWND,NWPC1,NWPC2,NWPC3OLDDF,PSIUDA,PSIUX,PSNP,PSSANS,PSSASK,PSSDA,PSSDD,PSSFLAG,PSSOR,PSSZ,PSXBT,PSXF,PSXFL,PSXUM,PSXGOOD,PSXLOC,ZAPFLG
"RTN","PSSDEE",17,0)
 Q
"RTN","PSSDEE",18,0)
ASK ;
"RTN","PSSDEE",19,0)
 W ! S DIC="^PSDRUG(",DIC(0)="QEALMNTV",DLAYGO=50,DIC("T")="",DIC("W")="S PSSTDRUG=Y D GETTIER^PSSDEE(PSSTDRUG)" D ^DIC K DIC I Y<0 S PSSFLAG=1 Q
"RTN","PSSDEE",20,0)
 N PSINACT S (FLG1,FLG2,FLG3,FLG4,FLG5,FLG6,FLG7,FLAG,FLGKY,FLGOI,PSINACT)=0 K ^TMP($J,"ADD"),^TMP($J,"SOL")
"RTN","PSSDEE",21,0)
 S DA=+Y,DISPDRG=DA L +^PSDRUG(DISPDRG):0 I '$T W !,$C(7),"Another person is editing this one." Q
"RTN","PSSDEE",22,0)
 D BEFORE^PSSDEEA($T(+0))  ; drug enter/edit auditing
"RTN","PSSDEE",23,0)
 I $G(^PSDRUG(DA,"I")) S PSINACT=$G(^PSDRUG(DA,"I")) I PSINACT,PSINACT<DT S PSINACT=1  ;;<<*180 - RJS
"RTN","PSSDEE",24,0)
 S PSSHUIDG=1,PSSNEW=$P(Y,"^",3) D USE,NOPE,COMMON,DEA,MF K PSSHUIDG,PSSUPRAF
"RTN","PSSDEE",25,0)
 ; if any outpatient site has a dispense machine running HL7 V.2.4, then
"RTN","PSSDEE",26,0)
 ; run the new routine and create message
"RTN","PSSDEE",27,0)
 N XX,DNSNAM,DNSPORT,DVER,DMFU,PSSUPRA S XX=""
"RTN","PSSDEE",28,0)
 F XX=0:0 S XX=$O(^PS(59,XX)) Q:'XX  D
"RTN","PSSDEE",29,0)
 .S DVER=$$GET1^DIQ(59,XX_",",105,"I"),DMFU=$$GET1^DIQ(59,XX_",",105.2)
"RTN","PSSDEE",30,0)
 .S DNSNAM=$$GET1^DIQ(59,XX_",",2006),DNSPORT=$$GET1^DIQ(59,XX_",",2007)
"RTN","PSSDEE",31,0)
 .D:DVER="2.4"&(DNSNAM'="")&(DMFU="YES") DRG^PSSDGUPD(DISPDRG,PSSNEW,DNSNAM,DNSPORT)
"RTN","PSSDEE",32,0)
 D DRG^PSSHUIDG(DISPDRG,PSSNEW) L -^PSDRUG(DISPDRG)
"RTN","PSSDEE",33,0)
 D AFTER^PSSDEEA($T(+0))  ; drug enter/edit auditing
"RTN","PSSDEE",34,0)
 S XX=$P($G(^PSDRUG(DISPDRG,2)),"^",3) I XX["U"!(XX["I") D  S XX=""
"RTN","PSSDEE",35,0)
 .S XX=$$SNDHL7^PSSMSTR() D:XX
"RTN","PSSDEE",36,0)
 ..Q:PSSNEW&'((XX=2)!(XX=3))  ;U=1,N=2,B=3
"RTN","PSSDEE",37,0)
 ..Q:'PSSNEW&(XX=2)  ;U=1,N=2,B=3
"RTN","PSSDEE",38,0)
 ..N VAR
"RTN","PSSDEE",39,0)
 ..I PSSNEW&((XX=2)!(XX=3)) S VAR="Would you like to send this new drug to PADE"
"RTN","PSSDEE",40,0)
 ..E  S VAR="Would you like to send a drug file update to PADE"
"RTN","PSSDEE",41,0)
 ..W !!,"This drug is marked for either UD or IV use, and you have at least"
"RTN","PSSDEE",42,0)
 ..W !,"one active Pharmacy Automated Dispensing Equipment (PADE)."
"RTN","PSSDEE",43,0)
 ..K DIR,DIRUT,DUOUT,DTOUT
"RTN","PSSDEE",44,0)
 ..S DIR(0)="Y",DIR("A")=VAR
"RTN","PSSDEE",45,0)
 ..S DIR("?")="Enter Y for Yes or N for No." D ^DIR K DIR
"RTN","PSSDEE",46,0)
 ..Q:'Y
"RTN","PSSDEE",47,0)
 ..N PSSPADE S PSSPADE=1 S XX=""
"RTN","PSSDEE",48,0)
 ..D ENP^PSSHLDFS(DISPDRG,$S(PSSNEW:"MAD",1:"MUP"))
"RTN","PSSDEE",49,0)
 K FLG3,PSSNEW
"RTN","PSSDEE",50,0)
 Q
"RTN","PSSDEE",51,0)
COMMON S DIE="^PSDRUG(",DR="[PSSCOMMON]" D ^DIE Q:$D(Y)!($D(DTOUT))  W:'$D(Y) !,"PRICE PER DISPENSE UNIT: " S:'$D(^PSDRUG(DA,660)) $P(^PSDRUG(DA,660),"^",6)="" W:'$D(Y) $P(^PSDRUG(DA,660),"^",6)
"RTN","PSSDEE",52,0)
 D DEA,CK,ASKND,OIKILL^PSSDEE1,COMMON1
"RTN","PSSDEE",53,0)
 Q
"RTN","PSSDEE",54,0)
COMMON1 W !,"Just a reminder...you are editing ",$P(^PSDRUG(DISPDRG,0),"^"),"."
"RTN","PSSDEE",55,0)
 S (PSSVVDA,DA)=DISPDRG D DOSN^PSSDOS S DA=PSSVVDA K PSSVVDA D USE,APP,ORDITM^PSSDEE1
"RTN","PSSDEE",56,0)
 Q
"RTN","PSSDEE",57,0)
CK D DSPY^PSSDEE1 S FLGNDF=0
"RTN","PSSDEE",58,0)
 Q
"RTN","PSSDEE",59,0)
ASKND S %=-1 I $D(^XUSEC("PSNMGR",DUZ)) D MESSAGE^PSSDEE1 W !!,"Do you wish to match/rematch to NATIONAL DRUG file" S %=1 S:FLGMTH=1 %=2 D YN^DICN
"RTN","PSSDEE",60,0)
 I %=0 W !,"If you answer ""yes"", you will attempt to match to NDF." G ASKND
"RTN","PSSDEE",61,0)
 S PSSUPRAF=%
"RTN","PSSDEE",62,0)
 I %=2 K X,Y Q
"RTN","PSSDEE",63,0)
 I %<0 K X,Y Q
"RTN","PSSDEE",64,0)
 I %=1 D  ;;<<*180 - RJS
"RTN","PSSDEE",65,0)
 .D RSET^PSSDEE1
"RTN","PSSDEE",66,0)
 .I 'PSINACT D EN1^PSSUTIL(DISPDRG,1)
"RTN","PSSDEE",67,0)
 .S X="PSNOUT" X ^%ZOSF("TEST") I  D REACT1^PSNOUT S DA=DISPDRG I $D(^PSDRUG(DA,"ND")),$P(^PSDRUG(DA,"ND"),"^",2)]"" D ONE
"RTN","PSSDEE",68,0)
 Q  ;;<< *180 - RJS
"RTN","PSSDEE",69,0)
ONE S PSNP=$G(^PSDRUG(DA,"I")) I PSNP,PSNP<DT Q
"RTN","PSSDEE",70,0)
 W !,"You have just VERIFIED this match and MERGED the entry." D CKDF D EN2^PSSUTIL(DISPDRG,1) S:'$D(OLDDF) OLDDF="" I OLDDF'=NEWDF S FLGNDF=1 D WR
"RTN","PSSDEE",71,0)
 Q
"RTN","PSSDEE",72,0)
CKDF S NWND=^PSDRUG(DA,"ND"),NWPC1=$P(NWND,"^",1),NWPC3=$P(NWND,"^",3),DA=NWPC1,K=NWPC3 S X=$$PSJDF^PSNAPIS(DA,K) S NEWDF=$P(X,"^",2),DA=DISPDRG
"RTN","PSSDEE",73,0)
 N PSSK D PKIND^PSSDDUT2
"RTN","PSSDEE",74,0)
 Q
"RTN","PSSDEE",75,0)
NOPE S ZAPFLG=0 I '$D(^PSDRUG(DA,"ND")),$D(^PSDRUG(DA,2)),$P(^PSDRUG(DA,2),"^",1)']"" D DFNULL
"RTN","PSSDEE",76,0)
 I '$D(^PSDRUG(DA,"ND")),'$D(^PSDRUG(DA,2)) D DFNULL
"RTN","PSSDEE",77,0)
 I $D(^PSDRUG(DA,"ND")),$P(^PSDRUG(DA,"ND"),"^",2)']"",$D(^PSDRUG(DA,2)),$P(^PSDRUG(DA,2),"^",1)']"" D DFNULL
"RTN","PSSDEE",78,0)
 Q
"RTN","PSSDEE",79,0)
DFNULL S OLDDF="",ZAPFLG=1
"RTN","PSSDEE",80,0)
 Q
"RTN","PSSDEE",81,0)
ZAPIT I $D(ZAPFLG),ZAPFLG=1,FLGNDF=1,OLDDF'=NEWDF D CKIV^PSSDEE1
"RTN","PSSDEE",82,0)
 Q
"RTN","PSSDEE",83,0)
APP W !!,"MARK THIS DRUG AND EDIT IT FOR: " D CHOOSE
"RTN","PSSDEE",84,0)
 Q
"RTN","PSSDEE",85,0)
CHOOSE I $D(^XUSEC("PSORPH",DUZ))!($D(^XUSEC("PSXCMOPMGR",DUZ))) W !,"O  - Outpatient" S FLG1=1
"RTN","PSSDEE",86,0)
 I $D(^XUSEC("PSJU MGR",DUZ)) W !,"U  - Unit Dose" S FLG2=1
"RTN","PSSDEE",87,0)
 I $D(^XUSEC("PSJI MGR",DUZ)) W !,"I  - IV" S FLG3=1
"RTN","PSSDEE",88,0)
 I $D(^XUSEC("PSGWMGR",DUZ)) W !,"W  - Ward Stock" S FLG4=1
"RTN","PSSDEE",89,0)
 I $D(^XUSEC("PSAMGR",DUZ))!($D(^XUSEC("PSA ORDERS",DUZ))) W !,"D  - Drug Accountability" S FLG5=1
"RTN","PSSDEE",90,0)
 I $D(^XUSEC("PSDMGR",DUZ)) W !,"C  - Controlled Substances" S FLG6=1
"RTN","PSSDEE",91,0)
 I $D(^XUSEC("PSORPH",DUZ)) W !,"X  - Non-VA Med" S FLG7=1
"RTN","PSSDEE",92,0)
 I FLG1,FLG2,FLG3,FLG4,FLG5,FLG6 S FLAG=1
"RTN","PSSDEE",93,0)
 I FLAG W !,"A  - ALL"
"RTN","PSSDEE",94,0)
 W !
"RTN","PSSDEE",95,0)
 I 'FLG1,'FLG2,'FLG3,'FLG4,'FLG5,'FLG6,'FLG7 W !,"You do not have the proper keys to continue. Sorry, this concludes your editing session.",! S FLGKY=1 K DIRUT,X Q
"RTN","PSSDEE",96,0)
 I FLGKY'=1 D
"RTN","PSSDEE",97,0)
 . K DIR S DIR(0)="FO^1:30"
"RTN","PSSDEE",98,0)
 . S DIR("A")="Enter your choice(s) separated by commas "
"RTN","PSSDEE",99,0)
 . F  D ^DIR Q:$$CHECK($$UP^XLFSTR(X))
"RTN","PSSDEE",100,0)
 . S PSSANS=X,PSSANS=$$UP^XLFSTR(PSSANS) D BRANCH,BRANCH1
"RTN","PSSDEE",101,0)
 Q
"RTN","PSSDEE",102,0)
 ;
"RTN","PSSDEE",103,0)
CHECK(X) ; Validates Application Use response
"RTN","PSSDEE",104,0)
 N CHECK,I,C
"RTN","PSSDEE",105,0)
 S CHECK=1 I X=""!(Y["^")!($D(DIRUT)) Q CHECK
"RTN","PSSDEE",106,0)
 F I=1:1:$L(X,",") D
"RTN","PSSDEE",107,0)
 . S C=$P(X,",",I) W !?43,C," - "
"RTN","PSSDEE",108,0)
 . I C="O",FLG1 W "Outpatient" Q
"RTN","PSSDEE",109,0)
 . I C="U",FLG2 W "Unit Dose" Q
"RTN","PSSDEE",110,0)
 . I C="I",FLG3 W "IV" Q
"RTN","PSSDEE",111,0)
 . I C="W",FLG4 W "Ward Stock" Q
"RTN","PSSDEE",112,0)
 . I C="D",FLG5 W "Drug Accountability" Q
"RTN","PSSDEE",113,0)
 . I C="C",FLG6 W "Controlled Substances" Q
"RTN","PSSDEE",114,0)
 . I C="X",FLG7 W "Non-VA Med" Q
"RTN","PSSDEE",115,0)
 . W "Invalid Entry",$C(7) S CHECK=0
"RTN","PSSDEE",116,0)
 Q CHECK
"RTN","PSSDEE",117,0)
BRANCH D:PSSANS["O" OP D:PSSANS["U" UD D:PSSANS["I" IV D:PSSANS["W" WS
"RTN","PSSDEE",118,0)
 D:PSSANS["D" DACCT D:PSSANS["C" CS D:PSSANS["X" NVM
"RTN","PSSDEE",119,0)
 Q
"RTN","PSSDEE",120,0)
BRANCH1 I FLAG,PSSANS["A" D OP,UD,IV,WS,DACCT,CS,NVM
"RTN","PSSDEE",121,0)
 Q
"RTN","PSSDEE",122,0)
OP I FLG1 D
"RTN","PSSDEE",123,0)
 . W !,"** You are NOW editing OUTPATIENT fields. **"
"RTN","PSSDEE",124,0)
 . S PSIUDA=DA,PSIUX="O^Outpatient Pharmacy" D ^PSSGIU
"RTN","PSSDEE",125,0)
 . I %=1 D
"RTN","PSSDEE",126,0)
 . . S DIE="^PSDRUG(",DR="[PSSOP]" D ^DIE K DIR D OPEI,ASKCMOP
"RTN","PSSDEE",127,0)
 . . S X="PSOCLO1" X ^%ZOSF("TEST") I  D ASKCLOZ S FLGOI=1
"RTN","PSSDEE",128,0)
 I FLG1 D CKCMOP
"RTN","PSSDEE",129,0)
 Q
"RTN","PSSDEE",130,0)
CKCMOP I $P($G(^PSDRUG(DISPDRG,2)),"^",3)'["O" S:$D(^PSDRUG(DISPDRG,3)) $P(^PSDRUG(DISPDRG,3),"^",1)=0 K:$D(^PSDRUG("AQ",DISPDRG)) ^PSDRUG("AQ",DISPDRG) S DA=DISPDRG D ^PSSREF
"RTN","PSSDEE",131,0)
 Q
"RTN","PSSDEE",132,0)
UD I FLG2 W !,"** You are NOW editing UNIT DOSE fields. **" S PSIUDA=DA,PSIUX="U^Unit Dose" D ^PSSGIU I %=1 S DIE="^PSDRUG(",DR="62.05;212.2" D ^DIE S DIE="^PSDRUG(",DR="212",DR(2,50.0212)=".01;1" D ^DIE S FLGOI=1
"RTN","PSSDEE",133,0)
 Q
"RTN","PSSDEE",134,0)
IV I FLG3 W !,"** You are NOW editing IV fields. **" S (PSIUDA,PSSDA)=DA,PSIUX="I^IV" D ^PSSGIU I %=1 D IV1 S FLGOI=1
"RTN","PSSDEE",135,0)
 Q
"RTN","PSSDEE",136,0)
IV1 K PSSIVOUT ;This variable controls the selection process loop.
"RTN","PSSDEE",137,0)
 W !,"Edit Additives or Solutions: " K DIR S DIR(0)="SO^A:ADDITIVES;S:SOLUTIONS;" D ^DIR Q:$D(DIRUT)  S PSSASK=Y(0) D:PSSASK="ADDITIVES" ENA^PSSVIDRG D:PSSASK="SOLUTIONS" ENS^PSSVIDRG I '$D(PSSIVOUT) G IV1
"RTN","PSSDEE",138,0)
 K PSSIVOUT
"RTN","PSSDEE",139,0)
 Q
"RTN","PSSDEE",140,0)
WS I FLG4 W !,"** You are NOW editing WARD STOCK fields. **" S DIE="^PSDRUG(",DR="300;301;302" D ^DIE
"RTN","PSSDEE",141,0)
 Q
"RTN","PSSDEE",142,0)
DACCT I FLG5 W !,"** You are NOW editing DRUG ACCOUNTABILITY fields. **" S DIE="^PSDRUG(",DR="441" D ^DIE S DIE="^PSDRUG(",DR="9",DR(2,50.1)="1;2;400;401;402;403;404;405" D ^DIE
"RTN","PSSDEE",143,0)
 Q
"RTN","PSSDEE",144,0)
CS I FLG6 W !,"** You are NOW Marking/Unmarking for CONTROLLED SUBS. **" S PSIUDA=DA,PSIUX="N^Controlled Substances" D ^PSSGIU
"RTN","PSSDEE",145,0)
 Q
"RTN","PSSDEE",146,0)
NVM I FLG7 W !,"** You are NOW Marking/Unmarking for NON-VA MEDS. **" S PSIUDA=DA,PSIUX="X^Non-VA Med" D ^PSSGIU
"RTN","PSSDEE",147,0)
 Q
"RTN","PSSDEE",148,0)
ASKCMOP I $D(^XUSEC("PSXCMOPMGR",DUZ)) W !!,"Do you wish to mark to transmit to CMOP? " K DIR S DIR(0)="Y",DIR("?")="If you answer ""yes"", you will attempt to mark this drug to transmit to CMOP."
"RTN","PSSDEE",149,0)
 D ^DIR I "Nn"[X K X,Y,DIRUT Q
"RTN","PSSDEE",150,0)
 I "Yy"[X S PSXFL=0 D TEXT^PSSMARK H 7 N PSXUDA S (PSXUM,PSXUDA)=DA,PSXLOC=$P(^PSDRUG(DA,0),"^"),PSXGOOD=0,PSXF=0,PSXBT=0 D BLD^PSSMARK,PICK2^PSSMARK S DA=PSXUDA
"RTN","PSSDEE",151,0)
 Q
"RTN","PSSDEE",152,0)
ASKCLOZ W !!,"Do you wish to mark/unmark as a LAB MONITOR or CLOZAPINE DRUG? " K DIR S DIR(0)="Y",DIR("?")="If you answer ""yes"", you will have the opportunity to edit LAB MONITOR or CLOZAPINE fields."
"RTN","PSSDEE",153,0)
 D ^DIR I "Nn"[X K X,Y,DIRUT Q
"RTN","PSSDEE",154,0)
 I "Yy"[X S NFLAG=0 D MONCLOZ
"RTN","PSSDEE",155,0)
 Q
"RTN","PSSDEE",156,0)
MONCLOZ K PSSAST D FLASH W !,"Mark/Unmark for Lab Monitor or Clozapine: " K DIR S DIR(0)="S^L:LAB MONITOR;C:CLOZAPINE;" D ^DIR Q:$D(DIRUT)  S PSSAST=Y(0) D:PSSAST="LAB MONITOR" ^PSSLAB D:$G(PSSAST)="CLOZAPINE" CLOZ
"RTN","PSSDEE",157,0)
 Q
"RTN","PSSDEE",158,0)
FLASH K LMFLAG,CLFALG,WHICH S WHICH=$P($G(^PSDRUG(DISPDRG,"CLOZ1")),"^"),LMFLAG=0,CLFLAG=0
"RTN","PSSDEE",159,0)
 I WHICH="PSOCLO1" S CLFLAG=1
"RTN","PSSDEE",160,0)
 I WHICH'="PSOCLO1" S:WHICH'="" LMFLAG=1
"RTN","PSSDEE",161,0)
 Q
"RTN","PSSDEE",162,0)
CLOZ Q:NFLAG  Q:$D(DTOUT)  Q:$D(DIRUT)  Q:$D(DUOUT)  W !,"** You are NOW editing CLOZAPINE fields. **" D ^PSSCLDRG
"RTN","PSSDEE",163,0)
 Q
"RTN","PSSDEE",164,0)
USE K PACK S PACK="" S:$P($G(^PSDRUG(DISPDRG,"PSG")),"^",2)]"" PACK="W" I $D(^PSDRUG(DISPDRG,2)) S PACK=PACK_$P(^PSDRUG(DISPDRG,2),"^",3)
"RTN","PSSDEE",165,0)
 I PACK'="" D
"RTN","PSSDEE",166,0)
 .W $C(7) N XX W !! F XX=1:1:79 W "*"
"RTN","PSSDEE",167,0)
 .W !,"This entry is marked for the following PHARMACY packages: "
"RTN","PSSDEE",168,0)
 .D USE1
"RTN","PSSDEE",169,0)
 Q
"RTN","PSSDEE",170,0)
USE1 W:PACK["O" !," Outpatient" W:PACK["U" !," Unit Dose" W:PACK["I" !," IV"
"RTN","PSSDEE",171,0)
 W:PACK["W" !," Ward Stock" W:PACK["D" !," Drug Accountability"
"RTN","PSSDEE",172,0)
 W:PACK["N" !," Controlled Substances" W:PACK["X" !," Non-VA Med"
"RTN","PSSDEE",173,0)
 W:'$D(PACK) !," NONE"
"RTN","PSSDEE",174,0)
 I PACK'["O",PACK'["U",PACK'["I",PACK'["W",PACK'["D",PACK'["N",PACK'["X" W !," NONE"
"RTN","PSSDEE",175,0)
 Q
"RTN","PSSDEE",176,0)
WR I ^XMB("NETNAME")'["CMOP-" W:OLDDF'="" !,"The dosage form has changed from "_OLDDF_" to "_NEWDF_" due to",!,"matching/rematching to NDF.",!,"You will need to rematch to Orderable Item.",!
"RTN","PSSDEE",177,0)
 Q
"RTN","PSSDEE",178,0)
PRIMDRG I $D(^PS(59.7,1,20)),$P(^PS(59.7,1,20),"^",1)=4!($P(^PS(59.7,1,20),"^",1)=4.5) I $D(^PSDRUG(DISPDRG,2)) S VAR=$P(^PSDRUG(DISPDRG,2),"^",3) I VAR["U"!(VAR["I") D PRIM1
"RTN","PSSDEE",179,0)
 Q
"RTN","PSSDEE",180,0)
PRIM1 W !!,"You need to match this drug to ""PRIMARY DRUG"" file as well.",! S DIE="^PSDRUG(",DR="64",DA=DISPDRG D ^DIE K VAR
"RTN","PSSDEE",181,0)
 Q
"RTN","PSSDEE",182,0)
MF I $P($G(^PS(59.7,1,80)),"^",2)>1 I $D(^PSDRUG(DISPDRG,2)) S PSSOR=$P(^PSDRUG(DISPDRG,2),"^",1) I PSSOR]"" D EN^PSSPOIDT(PSSOR),EN2^PSSHL1(PSSOR,"MUP")
"RTN","PSSDEE",183,0)
 Q
"RTN","PSSDEE",184,0)
MFA I $P($G(^PS(59.7,1,80)),"^",2)>1 S PSSOR=$P(^PS(52.6,ENTRY,0),"^",11),PSSDD=$P(^PS(52.6,ENTRY,0),"^",2) I PSSOR]"" D EN^PSSPOIDT(PSSOR),EN2^PSSHL1(PSSOR,"MUP") D MFDD
"RTN","PSSDEE",185,0)
 Q
"RTN","PSSDEE",186,0)
MFS I $P($G(^PS(59.7,1,80)),"^",2)>1 S PSSOR=$P(^PS(52.7,ENTRY,0),"^",11),PSSDD=$P(^PS(52.7,ENTRY,0),"^",2) I PSSOR]"" D EN^PSSPOIDT(PSSOR),EN2^PSSHL1(PSSOR,"MUP") D MFDD
"RTN","PSSDEE",187,0)
 Q
"RTN","PSSDEE",188,0)
MFDD I $D(^PSDRUG(PSSDD,2)) S PSSOR=$P(^PSDRUG(PSSDD,2),"^",1) I PSSOR]"" D EN^PSSPOIDT(PSSOR),EN2^PSSHL1(PSSOR,"MUP")
"RTN","PSSDEE",189,0)
 Q
"RTN","PSSDEE",190,0)
OPEI ;
"RTN","PSSDEE",191,0)
 S DIE="^PSDRUG(",DR="28",DA=DISPDRG
"RTN","PSSDEE",192,0)
 D ^DIE
"RTN","PSSDEE",193,0)
 Q:'+$P($G(^PSDRUG(DA,6)),"^")
"RTN","PSSDEE",194,0)
OPEI2 ; get external dispensing devices associated with the drug
"RTN","PSSDEE",195,0)
 W !!,"Defining a dispensing device at the drug level for a division will override"
"RTN","PSSDEE",196,0)
 W !,"the dispensing device settings in the OUTPATIENT SITE File (#59). If populated,",!,"the drug will be sent to the dispensing device for that division.",!
"RTN","PSSDEE",197,0)
 S DR="906"
"RTN","PSSDEE",198,0)
 D ^DIE
"RTN","PSSDEE",199,0)
 Q
"RTN","PSSDEE",200,0)
DEA ;
"RTN","PSSDEE",201,0)
 I $P($G(^PSDRUG(DISPDRG,3)),"^")=1,($P(^PSDRUG(DISPDRG,0),"^",3)[1!($P(^(0),"^",3)[2)) D DSH
"RTN","PSSDEE",202,0)
 Q
"RTN","PSSDEE",203,0)
DSH W !!,"****************************************************************************"
"RTN","PSSDEE",204,0)
 W !,"This entry contains a ""1"" or a ""2"" in the ""DEA, SPECIAL HDLG""",!,"field, therefore this item has been UNMARKED for CMOP transmission."
"RTN","PSSDEE",205,0)
 W !,"****************************************************************************",! S $P(^PSDRUG(DISPDRG,3),"^")=0 K ^PSDRUG("AQ",DISPDRG) S DA=DISPDRG N % D ^PSSREF
"RTN","PSSDEE",206,0)
 Q
"RTN","PSSDEE",207,0)
CPTIER(VAPID) ;Called from PSSCOMMON Input Template
"RTN","PSSDEE",208,0)
 ; VAPID = IEN OF DRUG FILE #50
"RTN","PSSDEE",209,0)
 N CPDATE,X,PSSCP D NOW^%DTC S CPDATE=X S PSSCP=$$CPTIER^PSNAPIS("",CPDATE,VAPID,1) K CPDATE,X
"RTN","PSSDEE",210,0)
 ;  PSSCP = Copay Tier^Effective Date^End Date
"RTN","PSSDEE",211,0)
 W !,"Copay Tier: ",$P(PSSCP,"^",1)
"RTN","PSSDEE",212,0)
 W !,"Copay Effective Date: " S Y=$P(PSSCP,"^",2) D DD^%DT W Y K Y,PSSCP
"RTN","PSSDEE",213,0)
 Q
"RTN","PSSDEE",214,0)
 ;
"RTN","PSSDEE",215,0)
GETTIER(PSSTDRUG) ;called by DIC to get copay tier for today's date 
"RTN","PSSDEE",216,0)
 N VAPID,CPDATE,X,PSSCP,VAPROD,PSSDRGCL,PSSCONVD,PSSINACT,PSSFSN,PSSNFORM,PSSMSG,PSSRESTR,PSSDRDAT,PSSFD D NOW^%DTC S CPDATE=X
"RTN","PSSDEE",217,0)
 D GETS^DIQ(50,PSSTDRUG,"2;22;51;6;100;101;102","IE","PSSDRDAT")
"RTN","PSSDEE",218,0)
 S (PSSDRGCL,PSSFSN,PSSNFORM,PSSINACT,PSSMSG,PSSRESTR,VAPROD)=""
"RTN","PSSDEE",219,0)
 S:$G(PSSDRDAT(50,PSSTDRUG_",",2,"E"))'="" PSSDRGCL=PSSDRDAT(50,PSSTDRUG_",",2,"E")
"RTN","PSSDEE",220,0)
 S:$G(PSSDRDAT(50,PSSTDRUG_",",6,"E"))'="" PSSFSN=PSSDRDAT(50,PSSTDRUG_",",6,"E")
"RTN","PSSDEE",221,0)
 S:$G(PSSDRDAT(50,PSSTDRUG_",",51,"E"))'="" PSSNFORM=PSSDRDAT(50,PSSTDRUG_",",51,"E")
"RTN","PSSDEE",222,0)
 S:$G(PSSDRDAT(50,PSSTDRUG_",",100,"I")) PSSINACT=PSSDRDAT(50,PSSTDRUG_",",100,"I")
"RTN","PSSDEE",223,0)
 S:$G(PSSDRDAT(50,PSSTDRUG_",",101,"E"))'="" PSSMSG=PSSDRDAT(50,PSSTDRUG_",",101,"E")
"RTN","PSSDEE",224,0)
 S:$G(PSSDRDAT(50,PSSTDRUG_",",102,"E"))'="" PSSRESTR=PSSDRDAT(50,PSSTDRUG_",",102,"E")
"RTN","PSSDEE",225,0)
 S:$G(PSSDRDAT(50,PSSTDRUG_",",22,"I")) VAPROD=PSSDRDAT(50,PSSTDRUG_",",22,"I")
"RTN","PSSDEE",226,0)
 W " "_$$GET1^DIQ(50,PSSTDRUG,2)
"RTN","PSSDEE",227,0)
 S PSSCP=$$CPTIER^PSNAPIS(VAPROD,CPDATE,"",1) K CPDATE,X
"RTN","PSSDEE",228,0)
 W:$G(PSSFSN)["" "  "_PSSFSN W:$G(PSSNFORM)["" "  ",PSSNFORM ;FSN; local non-formulary
"RTN","PSSDEE",229,0)
 S PSSFD=$$FDR^PSNACT(VAPROD) ;ppsn
"RTN","PSSDEE",230,0)
 W:PSSFD'="" "  "_PSSFD
"RTN","PSSDEE",231,0)
 I $G(VAPROD),$P(PSSCP,"^")'="" W "  Tier ",$P(PSSCP,"^")
"RTN","PSSDEE",232,0)
 S:$G(PSSINACT) PSSCONVD=$$DATE(PSSINACT)  ;inactive date
"RTN","PSSDEE",233,0)
 W:$G(PSSCONVD)'="" "  "_PSSCONVD
"RTN","PSSDEE",234,0)
 W:$G(PSSMSG)'="" "  "_PSSMSG
"RTN","PSSDEE",235,0)
 W:$G(PSSRESTR)'="" "  "_PSSRESTR
"RTN","PSSDEE",236,0)
 Q
"RTN","PSSDEE",237,0)
 ;
"RTN","PSSDEE",238,0)
DATE(PSSCONVD) ;convert fileman date to mm/dd/yyyy
"RTN","PSSDEE",239,0)
 N DATE
"RTN","PSSDEE",240,0)
 S DATE="",DATE=$E(PSSCONVD,4,5)_"/"_$E(PSSCONVD,6,7)_"/"_(1700+$E(PSSCONVD,1,3))
"RTN","PSSDEE",241,0)
 Q DATE
"RTN","PSSDEE",242,0)
 ;
"RTN","PSSDEE",243,0)
FD(PSSTDRUG) ;
"RTN","PSSDEE",244,0)
 N VAPROD,PSSDRDAT
"RTN","PSSDEE",245,0)
 D GETS^DIQ(50,PSSTDRUG,22,"I","PSSDRDAT")
"RTN","PSSDEE",246,0)
 S VAPROD=PSSDRDAT(50,PSSTDRUG_",",22,"I")
"RTN","PSSDEE",247,0)
 Q:VAPROD=""
"RTN","PSSDEE",248,0)
 S PSSFD="",PSSFD=$$GET1^DIQ(50.68,VAPROD,109)  ;ppsn
"RTN","PSSDEE",249,0)
 W:PSSFD'="" !,"Formulary Designator: "_PSSFD
"RTN","PSSDEE",250,0)
 I $D(^PSNDF(50.68,VAPROD,5.1,1,0)) D FDT^PSNACT(VAPROD) ;ppsn
"RTN","PSSDEE",251,0)
 Q
"RTN","PSSDEE1")
0^2^B22862330^B22862365
"RTN","PSSDEE1",1,0)
PSSDEE1 ;BIR/WRT - PDM match routine ;09/01/98
"RTN","PSSDEE1",2,0)
 ;;1.0;PHARMACY DATA MANAGEMENT;**15,20,34,38,68,90,208,220**;9/30/97;Build 4
"RTN","PSSDEE1",3,0)
 ;
"RTN","PSSDEE1",4,0)
 ;Reference to $$PSJDF^PSNAPIS(P1,P3) supported by DBIA #2531
"RTN","PSSDEE1",5,0)
 ;
"RTN","PSSDEE1",6,0)
DSPY S FLGMTH=0 I $D(^PSDRUG(DA,"ND")) I $P(^PSDRUG(DA,"ND"),"^",2)]"" W !!,?5,"points to ",$P(^("ND"),"^",2)," in the National Drug file.",! S NDE=^PSDRUG(DA,"ND"),PC1=$P(NDE,"^",1),PC3=$P(NDE,"^",3),FLGMTH=1 D GETDF
"RTN","PSSDEE1",7,0)
 I $D(^PSDRUG(DA,2)),$P(^PSDRUG(DA,2),"^",1)]"" S PSSOITM=$P(^PSDRUG(DA,2),"^",1) I $D(^PS(50.7,PSSOITM,0)) S PTR=$P(^PS(50.7,PSSOITM,0),"^",2),OLDDF=$P(^PS(50.606,PTR,0),"^",1)
"RTN","PSSDEE1",8,0)
 Q
"RTN","PSSDEE1",9,0)
GETDF S DA=PC1,K=PC3,X=$$PSJDF^PSNAPIS(DA,K),OLDDF=$P(X,"^",2),DA=DISPDRG
"RTN","PSSDEE1",10,0)
 Q
"RTN","PSSDEE1",11,0)
MESSAGE ; REMATCH PROMPT
"RTN","PSSDEE1",12,0)
 I $D(^PSDRUG(DA,"ND")) W:$P(^PSDRUG(DA,"ND"),"^",2)]"" !!,"This drug has already been matched and classified with the National Drug",!,"file." D PART2
"RTN","PSSDEE1",13,0)
 I $D(^PSDRUG(DA,3)) W:$P(^PSDRUG(DA,3),"^",1)=1 !,"This drug has also been marked to transmit to CMOP.",!,"If you choose to rematch it, the drug will be marked NOT TO TRANSMIT to CMOP.",!
"RTN","PSSDEE1",14,0)
 I $D(^PSDRUG(DA,"ND")) W:$P(^PSDRUG(DA,"ND"),"^",2)']"" !!,"This drug has been manually classed but not matched (merged with NDF)."
"RTN","PSSDEE1",15,0)
 Q
"RTN","PSSDEE1",16,0)
RSET S:$D(^PSDRUG(DA,"ND")) PSNID=$P(^PSDRUG(DA,"ND"),"^",10)
"RTN","PSSDEE1",17,0)
 S PSNP=$G(^PSDRUG(DA,"I")) I PSNP,PSNP<DT W !,"This drug cannot be matched because it has an INACTIVE date.",! Q:$D(^PSDRUG(DA,"I"))
"RTN","PSSDEE1",18,0)
 S DA=DISPDRG D:$D(^PSDRUG(DA,"ND")) SETNULL  S:$D(^PSDRUG(DA,3)) $P(^PSDRUG(DA,3),"^",1)=0 K:$D(^PSDRUG("AQ",DA)) ^PSDRUG("AQ",DA) I $D(PSNID),PSNID]"" K ^PSDRUG("AQ1",PSNID,DA) K PSNID
"RTN","PSSDEE1",19,0)
 D ^PSSREF Q
"RTN","PSSDEE1",20,0)
SETNULL  N PSSI
"RTN","PSSDEE1",21,0)
 S ZXZX=$P(^PSDRUG(DA,"ND"),"^",2)
"RTN","PSSDEE1",22,0)
 F PSSI=1:1:5,10,11 S $P(^PSDRUG(DA,"ND"),"^",PSSI)=""
"RTN","PSSDEE1",23,0)
 D NULL1
"RTN","PSSDEE1",24,0)
 Q
"RTN","PSSDEE1",25,0)
NULL1 I ZXZX]"" S ZXZX=$E(ZXZX,1,30) I $D(^PSDRUG("VAPN",ZXZX,DA)) K ^PSDRUG("VAPN",ZXZX,DA) K ZXZX
"RTN","PSSDEE1",26,0)
 Q
"RTN","PSSDEE1",27,0)
PART2 W:$P(^PSDRUG(DA,"ND"),"^",2)]"" " In addition, if the dosage form changes as a result of rematching,",!,"you will have to match/rematch to Orderable Item."
"RTN","PSSDEE1",28,0)
 Q
"RTN","PSSDEE1",29,0)
ORDITM I FLGKY'=1 I $D(^PSDRUG(DISPDRG,2)) S APU=$P(^PSDRUG(DISPDRG,2),"^",3) I (APU["O")!(APU["I")!(APU["U")!(APU["X") D OICK
"RTN","PSSDEE1",30,0)
 Q
"RTN","PSSDEE1",31,0)
OICK I ^XMB("NETNAME")'["CMOP-",$D(^PS(59.7,1,80)),$P(^PS(59.7,1,80),"^",2)>1 D OIMESS S PSIEN=DISPDRG,PSNAME=$P(^PSDRUG(DISPDRG,0),"^",1),PSMASTER=1 D MAS^PSSPOIMN K PSIEN,PSNAME,PSMASTER
"RTN","PSSDEE1",32,0)
 Q
"RTN","PSSDEE1",33,0)
OIKILL I $D(FLGNDF),FLGNDF=1,$D(PSDRUG(DISPDRG,2)),$P(^PSDRUG(DISPDRG,2),"^",1)]"" D KMTCH
"RTN","PSSDEE1",34,0)
 Q
"RTN","PSSDEE1",35,0)
KMTCH S DIE="^PSDRUG(",DR="2.1///"_"@" D ^DIE D  D CKIV
"RTN","PSSDEE1",36,0)
 .;S PSSINSTX=$O(^PS(59.7,0)) I $P($G(^PS(59.7,+$G(PSSINSTX),80)),"^",3)<2 K PSSINSTX Q
"RTN","PSSDEE1",37,0)
 .K PSSINSTX W !!,"Deleting Local Possible Dosages.." K ^PSDRUG(DISPDRG,"DOS2")
"RTN","PSSDEE1",38,0)
 Q
"RTN","PSSDEE1",39,0)
OIMESS W !!,"** You are NOW in the ORDERABLE ITEM matching for the dispense drug. **",!
"RTN","PSSDEE1",40,0)
 Q
"RTN","PSSDEE1",41,0)
CKIV K ^TMP($J,"SOL"),^TMP($J,"ADD") ;D SOLIO
"RTN","PSSDEE1",42,0)
 ;D ADDIO
"RTN","PSSDEE1",43,0)
 Q
"RTN","PSSDEE1",44,0)
SOLIO I $D(^PS(52.7,"AC",DISPDRG)) F BBC=0:0 S BBC=$O(^PS(52.7,"AC",DISPDRG,BBC)) Q:'BBC  S SOLITM=$P(^PS(52.7,BBC,0),"^",11) I SOLITM]"" I $D(^PS(52.7,"AOI",SOLITM,BBC)) D SOLIO1
"RTN","PSSDEE1",45,0)
 Q
"RTN","PSSDEE1",46,0)
SOLIO1 S IVDFPTR=$P(^PS(50.7,SOLITM,0),"^",2),IVDF=$P(^PS(50.606,IVDFPTR,0),"^",1),SOLNM=$P(^PS(52.7,BBC,0),"^",1) D CP
"RTN","PSSDEE1",47,0)
 Q
"RTN","PSSDEE1",48,0)
CP I IVDF'=NEWDF S ^TMP($J,"SOL",BBC)=SOLNM I $P(^PS(52.7,BBC,0),"^",11)]"" S DA=BBC,DIE="^PS(52.7,",DR="9///"_"@" D ^DIE
"RTN","PSSDEE1",49,0)
 Q
"RTN","PSSDEE1",50,0)
SOLMESS ;I FLG3=1,PSSANS'["I",$D(^TMP($J,"SOL")) W !,"You have SOLUTIONS that need to rematched to ORDERABLE ITEM." F NUM=0:0 S NUM=$O(^TMP($J,"SOL",NUM)) Q:'NUM  S ENTRY=NUM D SOI^PSSVIDRG K ^TMP($J,"SOL",NUM)
"RTN","PSSDEE1",51,0)
 Q
"RTN","PSSDEE1",52,0)
ADDIO I $D(^PS(52.6,"AC",DISPDRG)) F BBC=0:0 S BBC=$O(^PS(52.6,"AC",DISPDRG,BBC)) Q:'BBC  S ADDITM=$P(^PS(52.6,BBC,0),"^",11) I ADDITM]"",$D(^PS(52.6,"AOI",ADDITM,BBC)) D ADDIO1
"RTN","PSSDEE1",53,0)
 Q
"RTN","PSSDEE1",54,0)
ADDIO1 S IVDFPTR=$P(^PS(50.7,ADDITM,0),"^",2),IVDF=$P(^PS(50.606,IVDFPTR,0),"^",1),ADDNM=$P(^PS(52.6,BBC,0),"^",1) D CP1
"RTN","PSSDEE1",55,0)
 Q
"RTN","PSSDEE1",56,0)
CP1 I IVDF'=NEWDF S ^TMP($J,"ADD",BBC)=ADDNM I $P(^PS(52.6,BBC,0),"^",11)]"" S DA=BBC,DIE="^PS(52.6,",DR="15///"_"@" D ^DIE
"RTN","PSSDEE1",57,0)
 Q
"RTN","PSSDEE1",58,0)
ADDMESS ;I FLG3=1,PSSANS'["I",$D(^TMP($J,"ADD")) W !!,"You have ADDITIVES that need to rematched to ORDERABLE ITEM." F NUM=0:0 S NUM=$O(^TMP($J,"ADD",NUM)) Q:'NUM  S ENTRY=NUM D ADDOI^PSSVIDRG K ^TMP($J,"ADD",NUM)
"RTN","PSSDEE1",59,0)
 Q
"RTN","PSSDEE1",60,0)
ADDMESS1 ;I FLG3=0,$D(^TMP($J,"ADD")) W !!,"The following ADDITIVES need to rematched to ORDERABLE ITEM, however you do",!,"not have the ""PSJI MGR"" IV key. These must be matched before they made be used.",! D MESSA
"RTN","PSSDEE1",61,0)
 Q
"RTN","PSSDEE1",62,0)
MESSA F NUM=0:0 S NUM=$O(^TMP($J,"ADD",NUM)) Q:'NUM  W !?3,$P(^TMP($J,"ADD",NUM),"^")
"RTN","PSSDEE1",63,0)
 Q
"RTN","PSSDEE1",64,0)
SOLMESS1 ;I FLG3=0,$D(^TMP($J,"SOL")) W !!,"The following SOLUTIONS need to rematched to ORDERABLE ITEM, however you do",!,"not have the ""PSJI MGR"" IV key. These must be matched before they may be used.",! D MESSS
"RTN","PSSDEE1",65,0)
 Q
"RTN","PSSDEE1",66,0)
MESSS F NUM=0:0 S NUM=$O(^TMP($J,"SOL",NUM)) Q:'NUM  W !?3,$P(^TMP($J,"SOL",NUM),"^")
"RTN","PSSDEE1",67,0)
 Q
"RTN","PSSDEE1",68,0)
ADDMESS2 ;I FLG3=1,PSSANS["I",$D(^TMP($J,"ADD")) W !!,"The following ADDITIVES need to rematched to ORDERABLE ITEM.",!,"These must be matched before they made be used.",! D MESSA
"RTN","PSSDEE1",69,0)
 Q
"RTN","PSSDEE1",70,0)
SOLMESS2 ;I FLG3=1,PSSANS["I",$D(^TMP($J,"SOL")) W !!,"The following SOLUTIONS need to rematched to ORDERABLE ITEM.",!,"These must be matched before they may be used.",! D MESSS
"RTN","PSSDEE1",71,0)
 Q
"RTN","PSSLOOK")
0^3^B137641364^B137576490
"RTN","PSSLOOK",1,0)
PSSLOOK ;BIR/WRT - Drug file lookup ; 22 May 2018  10:10 AM
"RTN","PSSLOOK",2,0)
 ;;1.0;PHARMACY DATA MANAGEMENT;**3,7,15,16,20,24,29,38,68,61,87,90,127,147,170,189,192,200,195,213,227,220**;9/30/97;Build 4
"RTN","PSSLOOK",3,0)
 ;
"RTN","PSSLOOK",4,0)
 ;Reference to ^PS(50.605 supported by DBIA #2138
"RTN","PSSLOOK",5,0)
 ;Reference to ^PS(50.608 supported by DBIA #2136
"RTN","PSSLOOK",6,0)
 ;Reference to ^PS(50.609 supported by DBIA #2137
"RTN","PSSLOOK",7,0)
 ;Reference to ^PS(50.607 supported by DBIA #2221
"RTN","PSSLOOK",8,0)
 ;Reference to $$FORMRX^PSNAPIS(DA,K,.LIST) supported by DBIA #2574
"RTN","PSSLOOK",9,0)
 ;Reference to $$FORMI^PSNAPIS(P1,P3) supported by DBIA #2574
"RTN","PSSLOOK",10,0)
 ;Reference to $$PSJDF^PSNAPIS(P1,P3) supported by DBIA #2531
"RTN","PSSLOOK",11,0)
 ;Reference to $$PSJST^PSNAPIS(P1,P3) supported by DBIA #2531
"RTN","PSSLOOK",12,0)
 ;Reference to $$PROD2^PSNAPIS(P1,P3) supported by DBIA #2531
"RTN","PSSLOOK",13,0)
 ;Reference to $$CPTIER^PSNAPIS(P1,P3) supported by DBIA #2531
"RTN","PSSLOOK",14,0)
 ;Reference to $$VAGN^PSNAPIS(P1) supported by DBIA #2531
"RTN","PSSLOOK",15,0)
 ;Reference to ^PSNDF(50.68 supported by DBIA 3735
"RTN","PSSLOOK",16,0)
 ;Reference to DATA^PSN50P68 supported by DBIA 4545
"RTN","PSSLOOK",17,0)
 ;Reference to FD & FDT^PSNACT supported by DBIA #6754
"RTN","PSSLOOK",18,0)
 ;
"RTN","PSSLOOK",19,0)
START S QUIT=0,PSSFG=0 D KILL F PSSXX=1:1 D PICK Q:PSSFG
"RTN","PSSLOOK",20,0)
DONE D KILL K PSSFG,PSSXX,QUIT,FM,FMS,Y2K
"RTN","PSSLOOK",21,0)
 Q
"RTN","PSSLOOK",22,0)
PICK W ! K DIC S DIC="^PSDRUG(",DIC(0)="AEQMVTN",DIC("T")="",DIC("W")="S PSSTDRUG=Y D GETTIER^PSSDEE(PSSTDRUG)" D ^DIC K DIC I Y<0 S PSSFG=1 Q
"RTN","PSSLOOK",23,0)
 S IFN=+Y D NDDATA,GETDATA,INACT,NOD66,FORMAT,KILL
"RTN","PSSLOOK",24,0)
 Q
"RTN","PSSLOOK",25,0)
NDDATA I $D(^PSDRUG(IFN,"ND")) S CLPTR=$P(^PSDRUG(IFN,"ND"),"^",6) I $P(^PSDRUG(IFN,"ND"),"^",2)]"" S NDNODE=^PSDRUG(IFN,"ND"),VAGNPTR=$P(NDNODE,"^",1),VAPN=$P(NDNODE,"^",2),SZPTR=$P(NDNODE,"^",4),TYPTR=$P(NDNODE,"^",5) D NDF,NDF1
"RTN","PSSLOOK",26,0)
 Q
"RTN","PSSLOOK",27,0)
NDF S DA=VAGNPTR,X=$$VAGN^PSNAPIS(DA),VAGN=X,PS=$P(^PS(50.609,SZPTR,0),"^",1),PT=$P(^PS(50.608,TYPTR,0),"^",1),P3=$P(NDNODE,"^",3)
"RTN","PSSLOOK",28,0)
 K X S DA=VAGNPTR,K=P3,X=$$PROD2^PSNAPIS(DA,K) I X]"",$P(X,"^")]"" S VAPRN=$P(X,"^"),VADU=$P(X,"^",4),CMOPID=$P(X,"^",2)
"RTN","PSSLOOK",29,0)
 S CSF="" I $P(NDNODE,"^",3) S CSF=$$GET1^DIQ(50.68,$P(NDNODE,"^",3),19,"I")
"RTN","PSSLOOK",30,0)
 ;
"RTN","PSSLOOK",31,0)
 S (PSSNIEN,CSF)="",PSSNIEN=$P(NDNODE,"^",3)
"RTN","PSSLOOK",32,0)
 K ^TMP($J,"PSNVAPR"),PSSHTH,PSSHTD,PSSPEPAC,PSSDOTSN
"RTN","PSSLOOK",33,0)
 I PSSNIEN'="" D DATA^PSN50P68(PSSNIEN,"","PSNVAPR")  ;using the PRE encapuslation API instead
"RTN","PSSLOOK",34,0)
 I $D(^TMP($J,"PSNVAPR",PSSNIEN)) D
"RTN","PSSLOOK",35,0)
 .S:$G(^TMP($J,"PSNVAPR",PSSNIEN,19))'="" CSF=$P(^TMP($J,"PSNVAPR",PSSNIEN,19),"^")
"RTN","PSSLOOK",36,0)
 .S:$G(^TMP($J,"PSNVAPR",PSSNIEN,5))'="" VAPRN=^TMP($J,"PSNVAPR",PSSNIEN,5)
"RTN","PSSLOOK",37,0)
 .S:$G(^TMP($J,"PSNVAPR",PSSNIEN,6))'="" CMOPID=^TMP($J,"PSNVAPR",PSSNIEN,6)
"RTN","PSSLOOK",38,0)
 .; Hazardous Waste fields
"RTN","PSSLOOK",39,0)
 .S (PSSHTH,PSSHTD,PSSPEPAC,PSSWSC,PSSDOTSN)=""
"RTN","PSSLOOK",40,0)
 .S:$G(^TMP($J,"PSNVAPR",PSSNIEN,101))'="" PSSHTH=^TMP($J,"PSNVAPR",PSSNIEN,101)
"RTN","PSSLOOK",41,0)
 .S:$G(^TMP($J,"PSNVAPR",PSSNIEN,102))'="" PSSHTD=^TMP($J,"PSNVAPR",PSSNIEN,102)
"RTN","PSSLOOK",42,0)
 .S:$G(^TMP($J,"PSNVAPR",PSSNIEN,103))'="" PSSPEPAC=^TMP($J,"PSNVAPR",PSSNIEN,103)
"RTN","PSSLOOK",43,0)
 .S:$G(^TMP($J,"PSNVAPR",PSSNIEN,104))'="" PSSWSC=^TMP($J,"PSNVAPR",PSSNIEN,104)
"RTN","PSSLOOK",44,0)
 .S HAZWCNT2=1,HAZWCNT=0,DIWL=1,DIWR=50
"RTN","PSSLOOK",45,0)
 .F  S HAZWCNT=$O(^TMP($J,"PSNVAPR",PSSNIEN,105,HAZWCNT)) Q:'HAZWCNT  D
"RTN","PSSLOOK",46,0)
 .. S X="",X=^TMP($J,"PSNVAPR",PSSNIEN,105,HAZWCNT) S PSSDOTSN(HAZWCNT)=X
"RTN","PSSLOOK",47,0)
 Q
"RTN","PSSLOOK",48,0)
IT S CMOPID=$P(X,"^",2)
"RTN","PSSLOOK",49,0)
 Q
"RTN","PSSLOOK",50,0)
NDF1 S X=$$PSJDF^PSNAPIS(DA,K),VADF=$P(X,"^",2)
"RTN","PSSLOOK",51,0)
 Q
"RTN","PSSLOOK",52,0)
INACT S ACT="" I $D(^PSDRUG(IFN,"I")) S Y=$P(^PSDRUG(IFN,"I"),"^",1) X ^DD("DD") S ACT=Y
"RTN","PSSLOOK",53,0)
 Q
"RTN","PSSLOOK",54,0)
GETDATA S NODE0=^PSDRUG(IFN,0),GN=$P(NODE0,"^",1),CL=$P(NODE0,"^",2),DEA=$P(NODE0,"^",3),WRN=$P(NODE0,"^",8),NF=$P(NODE0,"^",9),MESS=$P(NODE0,"^",10),VNF=$P(NODE0,"^",11),CLASS="",WARN="" S:NF=1 NF="N/F" S:VNF=1 VNF="V-N/F"
"RTN","PSSLOOK",55,0)
 S PSSNODE=$G(^PSDRUG(IFN,"DOS"))
"RTN","PSSLOOK",56,0)
 I CL]""&CLPTR]"" S CLASS=CL_"  "_$P(^PS(50.605,CLPTR,0),"^",2)
"RTN","PSSLOOK",57,0)
 S PSSX=$Q(^PSDRUG(IFN,950)),PSSMAX=$P(@PSSX,"^",3)
"RTN","PSSLOOK",58,0)
 D GETS^DIQ(50.095,PSSMAX_","_IFN_",","*","E","PSSDAT","PSSERR")
"RTN","PSSLOOK",59,0)
 S PSSDT=$G(PSSDAT(50.095,PSSMAX_","_IFN_",",.01,"E"))
"RTN","PSSLOOK",60,0)
 S PSSUSR=$G(PSSDAT(50.095,PSSMAX_","_IFN_",",1,"E"))
"RTN","PSSLOOK",61,0)
 S PSSVAL=$G(PSSDAT(50.095,PSSMAX_","_IFN_",",3,"E"))
"RTN","PSSLOOK",62,0)
 I $D(^PSDRUG(IFN,3)) S:$P(^PSDRUG(IFN,3),"^")=0 CMOP="NO" S:$P(^PSDRUG(IFN,3),"^")=1 CMOP="YES"
"RTN","PSSLOOK",63,0)
 I $D(^PSDRUG(IFN,5)) S QDM=^PSDRUG(IFN,5)
"RTN","PSSLOOK",64,0)
 S OINM="" S NDC="" I $D(^PSDRUG(IFN,2)) S NODE2=^PSDRUG(IFN,2) S:$P(NODE2,"^",1)]"" OIPTR=$P(NODE2,"^",1) S NDC=$P(NODE2,"^",4) S:$P(NODE2,"^",6)]"" PDPTR=$P(NODE2,"^",6) S APP=$P(NODE2,"^",3),FM="" D TWOA
"RTN","PSSLOOK",65,0)
 Q
"RTN","PSSLOOK",66,0)
TWOA I $D(OIPTR) S OI=$P(^PS(50.7,OIPTR,0),"^",1),DFPTR=$P(^PS(50.7,OIPTR,0),"^",2),DF=$P(^PS(50.606,DFPTR,0),"^",1),FMS=$P(^PS(50.7,OIPTR,0),"^",12) S:FMS]"" FM=" (N/F)" S OINM=OI_" "_DF_FM
"RTN","PSSLOOK",67,0)
 ;I $D(PDPTR) S PD=$P(^PS(50.3,PDPTR,0),"^",1)
"RTN","PSSLOOK",68,0)
 Q
"RTN","PSSLOOK",69,0)
NOD66 S (DUPOU,PPDU,PPOU,DU,SS)="" I $D(^PSDRUG(IFN,660)) S NDE=^PSDRUG(IFN,660),OUPTR=$P(NDE,"^",2),PPOU=$P(NDE,"^",3),DUPOU=$P(NDE,"^",5),PPDU=$P(NDE,"^",6),SS=$P(NDE,"^",7),DU=$P(NDE,"^",8) I OUPTR]"" S OU=$P(^DIC(51.5,OUPTR,0),"^")
"RTN","PSSLOOK",70,0)
 Q
"RTN","PSSLOOK",71,0)
SYN I $D(^PSDRUG(IFN,1,0)) F ZZZ=0:0 S ZZZ=$O(^PSDRUG(IFN,1,ZZZ)) Q:'ZZZ  S SYNM=$P(^PSDRUG(IFN,1,ZZZ,0),"^",1),INT=$P(^PSDRUG(IFN,1,ZZZ,0),"^",3) D SYN1
"RTN","PSSLOOK",72,0)
 Q
"RTN","PSSLOOK",73,0)
SYN1 S INT=$S(INT=0:"Trade Name",INT=1:"Quick Code",INT="C":"Ctrl Substances",INT="D":"Drug Accountability",1:"") D FULL Q:$G(QUIT)  W ?14,SYNM,?55,INT,!
"RTN","PSSLOOK",74,0)
 Q
"RTN","PSSLOOK",75,0)
SYN2 S:INT=0 INT="Trade" S:INT=1 INT="Quick" S:INT="C" INT="Ctrl Subs" S:INT="D" INT="Drug Acct" W ?16,SYNM,?57,INT,!
"RTN","PSSLOOK",76,0)
 Q
"RTN","PSSLOOK",77,0)
IFCAP I $D(^PSDRUG(IFN,441,0)) F QQQ=0:0 S QQQ=$O(^PSDRUG(IFN,441,QQQ)) Q:'QQQ  S IFCAPNM=$P(^PSDRUG(IFN,441,QQQ,0),"^",1)
"RTN","PSSLOOK",78,0)
 Q
"RTN","PSSLOOK",79,0)
FORMAT ; BEGIN WRITING
"RTN","PSSLOOK",80,0)
 N DAW
"RTN","PSSLOOK",81,0)
 W @IOF,"DRUG NAME: ",GN,"  (IEN: ",IFN,")",!
"RTN","PSSLOOK",82,0)
 F XX=1:1:77 W "="
"RTN","PSSLOOK",83,0)
 W !
"RTN","PSSLOOK",84,0)
 W:$D(VAPRN) "VA PRINT NAME: ",?17,VAPRN W:$D(CMOPID) ?60,"CMOP ID#: ",CMOPID W:$D(VAPN) !,"VA PRODUCT NAME: ",?17,VAPN W:$D(CMOP) ?60,"CMOP DISPENSE: ",CMOP
"RTN","PSSLOOK",85,0)
 W:$D(OINM) !,"ORDERABLE ITEM: ",?17,OINM W:$D(VAPN) ?60,"NDF DF: ",VADF
"RTN","PSSLOOK",86,0)
 I $D(OIPTR),OIPTR]"" W !,"ORDERABLE ITEM TEXT: ",! D OITXT
"RTN","PSSLOOK",87,0)
 W:$D(PD) !,"PRIMARY DRUG: ",?17,PD
"RTN","PSSLOOK",88,0)
 W !,"SYNONYM(S): " D SYN D FULL Q:$G(QUIT)  W !,"MESSAGE: ",MESS,!
"RTN","PSSLOOK",89,0)
 D FULL Q:$G(QUIT)  F XX=1:1:77 W "-"
"RTN","PSSLOOK",90,0)
 W !
"RTN","PSSLOOK",91,0)
 D FULL Q:$G(QUIT)  W "DEA, SPECIAL HDLG: ",DEA,?48,"NDC: ",?63,NDC
"RTN","PSSLOOK",92,0)
 S DAW=+$$GET1^DIQ(50,IFN,81)
"RTN","PSSLOOK",93,0)
 D FULL Q:$G(QUIT)  W !,"DAW CODE:  ",DAW," - ",$$DAWEXT^PSSDAWUT(DAW)
"RTN","PSSLOOK",94,0)
 D FULL Q:$G(QUIT)  W !,"CS FEDERAL SCHEDULE: ",$G(CSF)
"RTN","PSSLOOK",95,0)
 ;
"RTN","PSSLOOK",96,0)
 ;Hazardous Waste
"RTN","PSSLOOK",97,0)
 W !
"RTN","PSSLOOK",98,0)
 S PSSHTDX=0
"RTN","PSSLOOK",99,0)
 I $G(PSSHTD)=1 S PSSHTDX=1
"RTN","PSSLOOK",100,0)
 D FULL Q:$G(QUIT)  W:$G(PSSHTH)'="" !,"Hazardous to Handle: ",$S(PSSHTH=1:"YES",PSSHTH=0:"NO",1:"")
"RTN","PSSLOOK",101,0)
 D FULL Q:$G(QUIT)  W:$G(PSSHTD)'="" !,"Hazardous to Dispose: ",$S(PSSHTD=1:"YES",PSSHTD=0:"NO",1:"")
"RTN","PSSLOOK",102,0)
 I $G(PSSPEPAC)'=""&(PSSHTDX) D FULL Q:$G(QUIT)  W !,"        Primary EPA Code: ",PSSPEPAC
"RTN","PSSLOOK",103,0)
 I $G(PSSWSC)'=""&(PSSHTDX) D FULL Q:$G(QUIT)  W !,"         Waste Sort Code: ",PSSWSC
"RTN","PSSLOOK",104,0)
 ;
"RTN","PSSLOOK",105,0)
 N HAZWCNT,HAZWCNT2,X,DIWL,DIWR,DIWF
"RTN","PSSLOOK",106,0)
 K ^UTILITY($J,"W")
"RTN","PSSLOOK",107,0)
 S HAZWCNT=0,HAZWCNT2=1,HAZWCNT=0,DIWL=1,DIWR=50
"RTN","PSSLOOK",108,0)
 F  S HAZWCNT=$O(PSSDOTSN(HAZWCNT)) Q:HAZWCNT=""  S X=PSSDOTSN(HAZWCNT) D ^DIWP
"RTN","PSSLOOK",109,0)
 S HAZWCNT=0 F  S HAZWCNT=$O(^UTILITY($J,"W",DIWL,HAZWCNT)) Q:'HAZWCNT  D
"RTN","PSSLOOK",110,0)
 .D FULL Q:$G(QUIT)
"RTN","PSSLOOK",111,0)
 .I HAZWCNT2=1 W !,"       DOT Shipping Name: "
"RTN","PSSLOOK",112,0)
 .I HAZWCNT2>1 W !,"                          "
"RTN","PSSLOOK",113,0)
 .W $G(^UTILITY($J,"W",DIWL,HAZWCNT,0)) S HAZWCNT2=2
"RTN","PSSLOOK",114,0)
 K ^UTILITY($J,"W")
"RTN","PSSLOOK",115,0)
 ;I $G(PSSDOTSN)'=""&(PSSHTDX) D FULL Q:$G(QUIT)  W !,"       DOT Shipping Name: ",PSSDOTSN
"RTN","PSSLOOK",116,0)
 W !
"RTN","PSSLOOK",117,0)
 ;
"RTN","PSSLOOK",118,0)
 D FULL Q:$G(QUIT)  W !,"INACTIVE DATE: ",ACT
"RTN","PSSLOOK",119,0)
 D FULL Q:$G(QUIT)  W:$D(QDM) !,"QUANTITY DISPENSE MESSAGE: ",QDM,!
"RTN","PSSLOOK",120,0)
 D FULL Q:$G(QUIT)  I WRN]"" W !,"WARNING LABEL: " S X=WRN F Z0=1:1 Q:$P(X,",",Z0,99)=""  S Z1=$P(X,",",Z0) W:$D(^PS(54,Z1,0)) ?19,$P(^(0),"^",1),! I '$D(^(0)) W ?19,"NO SUCH WARNING LABEL" K X Q
"RTN","PSSLOOK",121,0)
 D FULL Q:$G(QUIT)  S PSSLOOK=1 D
"RTN","PSSLOOK",122,0)
 .N DRUG,PSSWSITE
"RTN","PSSLOOK",123,0)
 .I $P($G(^PSDRUG(IFN,0)),"^")="" K PSSLOOK Q
"RTN","PSSLOOK",124,0)
 .S PSSWSITE=+$O(^PS(59.7,0)) W !,"WARNING LABEL SOURCE is " D
"RTN","PSSLOOK",125,0)
 ..I $P($G(^PS(59.7,PSSWSITE,10)),"^",9)="N" W "set to 'NEW'" Q
"RTN","PSSLOOK",126,0)
 ..W "not set to 'NEW'"
"RTN","PSSLOOK",127,0)
 .K PSSWRN
"RTN","PSSLOOK",128,0)
 .D FULL Q:$G(QUIT)  W !,"NEW WARNING LABEL:"
"RTN","PSSLOOK",129,0)
 .S ^TMP("PSSWRNB",$J,$P(^PSDRUG(IFN,0),"^"))="" D ^PSSWRNE
"RTN","PSSLOOK",130,0)
 .K PSSLOOK,^TMP("PSSWRNB",$J),PSSWRN
"RTN","PSSLOOK",131,0)
 D FULL Q:$G(QUIT)  W:'$D(QDM) ! F XX=1:1:77 W "-"
"RTN","PSSLOOK",132,0)
 D FULL Q:$G(QUIT)  W !
"RTN","PSSLOOK",133,0)
 W "ORDER UNIT: ",?27 W:$D(OU) OU W ?40,"PRICE/ORDER UNIT: ",?67,PPOU
"RTN","PSSLOOK",134,0)
 D FULL Q:$G(QUIT)  W !,"DISPENSE UNIT: ",?27,DU W:$D(VADU) ?40,"VA DISPENSE UNIT: ",?67,VADU
"RTN","PSSLOOK",135,0)
 D FULL Q:$G(QUIT)  W !,"DISPENSE UNITS/ORDER UNIT: ",?21,DUPOU,?40,"PRICE/DISPENSE UNIT: ",?67,PPDU
"RTN","PSSLOOK",136,0)
 D:$G(PSSVAL)]""
"RTN","PSSLOOK",137,0)
 . D FULL Q:$G(QUIT)  W !,"DATE PRICE/DISPENSE UNIT LAST CHANGED:  ",?27,PSSDT
"RTN","PSSLOOK",138,0)
 . D FULL Q:$G(QUIT)  W !,"BY:  ",PSSUSR,?27,"VALUE:  ",PSSVAL
"RTN","PSSLOOK",139,0)
 D FULL Q:$G(QUIT)  W !,"NCPDP DISPENSE UNIT: ",$$GET1^DIQ(50,IFN,82),?40,"NCPDP QUANTITY MULTIPLIER: ",?67,$J($$GET1^DIQ(50,IFN,83),8,3)
"RTN","PSSLOOK",140,0)
 D FULL Q:$G(QUIT)  W !,"MAXIMUM DAYS SUPPLY: ",$$GET1^DIQ(50,IFN,66)
"RTN","PSSLOOK",141,0)
 D FULL Q:$G(QUIT)  W !,"ePharmacy Billable: ",$$GET1^DIQ(50,IFN,84)
"RTN","PSSLOOK",142,0)
 D FULL Q:$G(QUIT)  W !?2,"ePharmacy Billable (TRICARE): ",$$GET1^DIQ(50,IFN,85) W ?40,"ePharmacy Billable (CHAMPVA): ",$$GET1^DIQ(50,IFN,86)
"RTN","PSSLOOK",143,0)
 D FULL Q:$G(QUIT)  W !,"Sensitive Diagnosis Drug: ",$$GET1^DIQ(50,IFN,87) W !
"RTN","PSSLOOK",144,0)
 D FULL Q:$G(QUIT)  W !,"APPL PKG USE:" S APPL="" S:'$D(APP) APPL="  NONE"
"RTN","PSSLOOK",145,0)
 I $D(APP) D
"RTN","PSSLOOK",146,0)
 . S:APP["O" APPL=APPL_"  Outpatient" S:APP["U" APPL=APPL_"  Unit Dose"
"RTN","PSSLOOK",147,0)
 . S:APP["I" APPL=APPL_"  IV" S:APP["W" APPL=APPL_"  Ward Stock"
"RTN","PSSLOOK",148,0)
 . S:APP["N" APPL=APPL_"  Control Subs" S:APP["X" APPL=APPL_"  Non-VA Med"
"RTN","PSSLOOK",149,0)
 . S:APPL="" APPL="  NONE"
"RTN","PSSLOOK",150,0)
 W ?13,APPL
"RTN","PSSLOOK",151,0)
 I $P(PSSNODE,"^",2) S (PSSCALC,PSSUNIT)=$P($G(^PS(50.607,+$P(PSSNODE,U,2),0)),U),PSSSTR=$P(PSSNODE,"^")
"RTN","PSSLOOK",152,0)
 I $G(PSSUNIT)'="",$G(PSSUNIT)["/" D UNCALC
"RTN","PSSLOOK",153,0)
 D FULL Q:$G(QUIT)  W !,"STRENGTH: ",$S($E($P(PSSNODE,U),1)=".":"0",1:"")_$P(PSSNODE,U),?35,"UNIT: ",$G(PSSCALC)
"RTN","PSSLOOK",154,0)
 D FULL Q:$G(QUIT)  W !,"POSSIBLE DOSAGES:"
"RTN","PSSLOOK",155,0)
 I $D(^PSDRUG(IFN,"DOS1",0)) F PDS=0:0 S PDS=$O(^PSDRUG(IFN,"DOS1",PDS)) Q:'PDS  D
"RTN","PSSLOOK",156,0)
 .S POSDOS=^PSDRUG(IFN,"DOS1",PDS,0)
"RTN","PSSLOOK",157,0)
 .D FULL Q:$G(QUIT)  W !,"   DISPENSE UNITS PER DOSE: ",$S($E($P(POSDOS,U),1)=".":"0",1:"")_$P(POSDOS,U),?40,"DOSE: ",$S($E($P(POSDOS,U,2),1)=".":"0",1:"")_$P(POSDOS,U,2),?55,"PACKAGE: ",$P(POSDOS,U,3)
"RTN","PSSLOOK",158,0)
 .D FULL Q:$G(QUIT)  W !,"       BCMA UNITS PER DOSE: ",$P(POSDOS,U,4)
"RTN","PSSLOOK",159,0)
 D FULL Q:$G(QUIT)  W !,"LOCAL POSSIBLE DOSAGES:"
"RTN","PSSLOOK",160,0)
 I $D(^PSDRUG(IFN,"DOS2",0)) F PDS=0:0 S PDS=$O(^PSDRUG(IFN,"DOS2",PDS)) Q:'PDS  D
"RTN","PSSLOOK",161,0)
 .S LPDOS=^PSDRUG(IFN,"DOS2",PDS,0)
"RTN","PSSLOOK",162,0)
 .D FULL Q:$G(QUIT)  W !,"   LOCAL POSSIBLE DOSAGE: " D
"RTN","PSSLOOK",163,0)
 ..I $L($P(LPDOS,U))'>27 W $P(LPDOS,U),?55,"PACKAGE: ",$P(LPDOS,U,2)
"RTN","PSSLOOK",164,0)
 ..E   W !,?10,$P(LPDOS,U),!,?55,"PACKAGE: ",$P(LPDOS,U,2)
"RTN","PSSLOOK",165,0)
 ..D FULL Q:$G(QUIT)  W !,"     BCMA UNITS PER DOSE: ",$P(LPDOS,U,3) D FULL Q:$G(QUIT)  D LPDNW
"RTN","PSSLOOK",166,0)
 D FULL Q:$G(QUIT)  W ! F XX=1:1:77 W "-"
"RTN","PSSLOOK",167,0)
 D FULL Q:$G(QUIT)  W !,"VA CLASS: ",$G(CLASS)
"RTN","PSSLOOK",168,0)
 D FULL Q:$G(QUIT)  W !,"LOCAL NON-FORMULARY: ",$G(NF),"          ","VISN NON-FORMULARY: ",$G(VNF)
"RTN","PSSLOOK",169,0)
 N DA,K,LIST,PSXDN,PSXGN,X,XX1,XX2
"RTN","PSSLOOK",170,0)
 K PSXGN,PSXVP I $D(^PSDRUG(IFN,"ND")) S PSXDN=$G(^PSDRUG(IFN,"ND")),PSXGN=$P(PSXDN,"^"),PSXVP=$P(PSXDN,"^",3)
"RTN","PSSLOOK",171,0)
 I $G(PSXGN),$G(PSXVP) S X=$$PROD2^PSNAPIS(PSXGN,PSXVP),XX1=$$FORMI^PSNAPIS(PSXGN,PSXVP)
"RTN","PSSLOOK",172,0)
 D FULL Q:$G(QUIT)  W !,"National Formulary Indicator: "_$S($G(XX1)=1:"YES",$G(XX1)=0:"NO",1:"Not Matched to NDF")
"RTN","PSSLOOK",173,0)
 I $G(PSXVP) D FD^PSNACT(PSXVP) ;PPSN
"RTN","PSSLOOK",174,0)
 I $D(^PSDRUG(IFN,65,0)) D FULL Q:$G(QUIT)  W !,"FORMULARY ALTERNATIVES: ",! F FA=0:0 S FA=$O(^PSDRUG(IFN,65,FA)) Q:'FA  S LDFPTR=$P($G(^PSDRUG(IFN,65,FA,0)),"^") I LDFPTR D FULL Q:$G(QUIT)  W ?26,$P($G(^PSDRUG(LDFPTR,0)),"^"),!
"RTN","PSSLOOK",175,0)
 N CPDATE,PSSTIER D NOW^%DTC S CPDATE=$P(%,".") S PSSTIER=$$CPTIER^PSNAPIS($P($G(^PSDRUG(IFN,"ND")),"^",3),CPDATE,IFN,1) K CPDATE,%
"RTN","PSSLOOK",176,0)
 ;  PSSTIER = Copay Tier^Effective Date^End Date
"RTN","PSSLOOK",177,0)
 W !,"Copay Tier: ",$P(PSSTIER,"^",1)
"RTN","PSSLOOK",178,0)
 W !,"Copay Effective Date: " S Y=$P(PSSTIER,"^",2) D DD^%DT W Y K Y
"RTN","PSSLOOK",179,0)
 D FULL Q:$G(QUIT)  I $G(PSXGN),$G(PSXVP) W !,"National Restriction: " S XX2=$$FORMRX^PSNAPIS(PSXGN,PSXVP,.LIST) I $G(XX2)=1,$D(LIST) F XX2=0:0 S XX2=$O(LIST(XX2)) Q:'XX2  D FULL Q:$G(QUIT)  W !,LIST(XX2,0)
"RTN","PSSLOOK",180,0)
 I $G(PSXVP) D FDT^PSNACT(PSXVP) ;PPSN
"RTN","PSSLOOK",181,0)
 W !,"Local Drug Text: ",! I $D(^PSDRUG(IFN,9,0)) D LDT
"RTN","PSSLOOK",182,0)
 Q
"RTN","PSSLOOK",183,0)
LDT F TXT1=0:0 S TXT1=$O(^PSDRUG(IFN,9,TXT1)) Q:'TXT1  S TEXPTR=^PSDRUG(IFN,9,TXT1,0) F PPP=0:0 S PPP=$O(^PS(51.7,TEXPTR,2,PPP)) Q:'PPP  S PST=$P($G(^PS(51.7,TEXPTR,0)),"^",2) I 'PST S WPT=^PS(51.7,TEXPTR,2,PPP,0) D FULL Q:$G(QUIT)  W WPT,!
"RTN","PSSLOOK",184,0)
 ;
"RTN","PSSLOOK",185,0)
 ;
"RTN","PSSLOOK",186,0)
KILL K IFN,APP,INT,VADU,VAGN,VAPN,VAPRN,P3,VAGNPTR,MESS,CLASS,DEA,ACT,CL,CLPTR,CMOP,DF,DFPTR,DU,DUPOUGN,IFCAPNM,NDC,NDE,NDNODE,NF,NODE0,NODE2,OI,OINM,OIPTR,OU,PD,PDPTR,PPDU,PPOU,PS,PT,NOD66,SYNM,SZPTR,TYPTR,WARN,WRN,XX,ZZZ,SS,OUPTR,CMOPID
"RTN","PSSLOOK",187,0)
 K DUPOU,QQQ,GN,QDM,APPL,VADF,DFP,DFRM,Y,Z0,Z1,DDD,PPP,TEXT,TXTPTR,TXT,TXT1,TEXPTR,VNF,WPT,FA,LDFPTR,TEXTPTR,QUIT,PST,D0,DA,K,DIR
"RTN","PSSLOOK",188,0)
 K PSSNODE,PSDOSUN,PDS,POSDOS,LPDOS,CSF,PSSSTR,PSSUNIT,PSSCALC,PSSTIER
"RTN","PSSLOOK",189,0)
 K ^TMP($J,"PSNVAPR")
"RTN","PSSLOOK",190,0)
 K PSSWSC,PSSNIEN,PSSHTH,PSSHTD,PSSPEPAC,PSSDOTSN,PSSCLEF,PSSPKG,PSSOMIT,PSSEXLMT,PSSHTDX,PSSII,PSSIII
"RTN","PSSLOOK",191,0)
 Q
"RTN","PSSLOOK",192,0)
OITXT I $D(^PS(50.7,OIPTR,1,0)) F TXT=0:0 S TXT=$O(^PS(50.7,OIPTR,1,TXT)) Q:'TXT  S TEXTPTR=^PS(50.7,OIPTR,1,TXT,0) F DDD=0:0 S DDD=$O(^PS(51.7,TEXTPTR,2,DDD)) Q:'DDD  D IDATE I 'Y2K S TEXT=^PS(51.7,TEXTPTR,2,DDD,0) D FULL Q:$G(QUIT)  W TEXT,!
"RTN","PSSLOOK",193,0)
 Q
"RTN","PSSLOOK",194,0)
FULL D:($Y+5)>IOSL&('$G(QUIT)) FSCRN
"RTN","PSSLOOK",195,0)
 Q
"RTN","PSSLOOK",196,0)
FSCRN Q:$G(QUIT)  W ! K DIR S DIR(0)="E",DIR("A")="Press Return to continue,'^' to exit" D ^DIR W @IOF S:Y'=1 QUIT=1
"RTN","PSSLOOK",197,0)
 Q
"RTN","PSSLOOK",198,0)
IDATE S Y2K=$P($G(^PS(51.7,TEXTPTR,0)),"^",2)
"RTN","PSSLOOK",199,0)
 Q
"RTN","PSSLOOK",200,0)
UNCALC ;
"RTN","PSSLOOK",201,0)
 N PSSVA,PSSVA1,PSSVB,PSSVB1,PSSDASH,PSSNDFS,PSSDASH2,PSSDASH3,PSSDASH5 K PSSCALC
"RTN","PSSLOOK",202,0)
 S PSSDASH=0 S PSSNDFS=$$PSJST^PSNAPIS(+$P($G(^PSDRUG(IFN,"ND")),"^"),+$P($G(^PSDRUG(IFN,"ND")),"^",3)) S PSSNDFS=+$P($G(PSSNDFS),"^",2)
"RTN","PSSLOOK",203,0)
 I $G(PSSNDFS),$G(PSSSTR),+$G(PSSSTR)'=+$G(PSSNDFS) S PSSDASH=1
"RTN","PSSLOOK",204,0)
 S PSSVA=$P(PSSUNIT,"/"),PSSVB=$P(PSSUNIT,"/",2),PSSVA1=+$G(PSSVA),PSSVB1=+$G(PSSVB)
"RTN","PSSLOOK",205,0)
 I $G(PSSDASH) S PSSDASH2=PSSSTR/PSSNDFS,PSSDASH3=PSSDASH2*$S($G(PSSVB1):PSSVB1,1:1) S PSSDASH5=$S('$G(PSSVB1):PSSDASH3_$G(PSSVB),1:PSSDASH3_$P(PSSVB,PSSVB1,2))
"RTN","PSSLOOK",206,0)
 S PSSCALC=$S($G(PSSDASH):$S('$G(PSSVA1):PSSVA,1:$P(PSSVA1,PSSVA1,2))_"/"_$G(PSSDASH5),1:PSSUNIT)
"RTN","PSSLOOK",207,0)
 Q
"RTN","PSSLOOK",208,0)
 ;
"RTN","PSSLOOK",209,0)
LPDNW ;Display Dose Unit and Numeric Dose fields, added with patch PSS*1*147
"RTN","PSSLOOK",210,0)
 N PSSLKL1,PSSLKL2,PSSLKL3,PSSLKL4
"RTN","PSSLOOK",211,0)
 S PSSLKL4=""
"RTN","PSSLOOK",212,0)
 S PSSLKL1=$P(LPDOS,"^",5),PSSLKL2=$P(LPDOS,"^",6)
"RTN","PSSLOOK",213,0)
 I PSSLKL1 S PSSLKL4=$P($G(^PS(51.24,+PSSLKL1,0)),"^")
"RTN","PSSLOOK",214,0)
 S PSSLKL3=$S($E(PSSLKL2)=".":"0",1:"")_PSSLKL2
"RTN","PSSLOOK",215,0)
 I $L(PSSLKL3)<18 D FULL Q:$G(QUIT)  W !?5,"NUMERIC DOSE: "_PSSLKL3,?38,"DOSE UNIT: "_PSSLKL4 Q
"RTN","PSSLOOK",216,0)
 D FULL Q:$G(QUIT)  W !?5,"NUMERIC DOSE: "_PSSLKL3
"RTN","PSSLOOK",217,0)
 D FULL Q:$G(QUIT)  W !?38,"DOSE UNIT: "_PSSLKL4
"RTN","PSSLOOK",218,0)
 Q
"RTN","PSSPOIM1")
0^5^B133407770^B133178041
"RTN","PSSPOIM1",1,0)
PSSPOIM1 ;BIR/RTR,WRT - Manual create of Orderable Item continued ;05/12/17  07:10
"RTN","PSSPOIM1",2,0)
 ;;1.0;PHARMACY DATA MANAGEMENT;**29,38,47,141,153,159,166,191,198,204,220**;9/30/97;Build 4
"RTN","PSSPOIM1",3,0)
 ;
"RTN","PSSPOIM1",4,0)
CHK S PSNO=0 I $G(PSMAN) W !!,"Matching ",PSNAME,!,"   to",!,SPHOLD," ",$P($G(^PS(50.606,+DOSEPTR,0)),"^"),!
"RTN","PSSPOIM1",5,0)
 I '$G(PSMAN) S PSMC=$P($G(^PS(50.7,PSSP,0)),"^") W !!,"Matching ",PSNAME,!,"   to",!,PSMC," ",$P($G(^PS(50.606,+$P(^PS(50.7,PSSP,0),"^",2),0)),"^"),!
"RTN","PSSPOIM1",6,0)
 K DIR S DIR(0)="Y",DIR("B")="YES",DIR("A")="Is this OK" D ^DIR
"RTN","PSSPOIM1",7,0)
 S:Y=0 PSNO=1 I Y'=1,'PSNO S PSOUT=1
"RTN","PSSPOIM1",8,0)
 ;Add trace of whether inactive date is present.
"RTN","PSSPOIM1",9,0)
 ;If one is added erroneously by code logic when the
"RTN","PSSPOIM1",10,0)
 ;orderable item should remain active,
"RTN","PSSPOIM1",11,0)
 ;the inactive date will be deleted at INACT^PSSPOIM1.
"RTN","PSSPOIM1",12,0)
 K ^TMP($J,"INACTIVE_DATE")
"RTN","PSSPOIM1",13,0)
 N PSOITMP
"RTN","PSSPOIM1",14,0)
 S PSOITMP=$S($G(PSPOINT):PSPOINT,$G(PSSP):PSSP,1:"")
"RTN","PSSPOIM1",15,0)
 I PSOITMP]"" S ^TMP($J,"INACTIVE_DATE",PSOITMP)=$P($G(^PS(50.7,PSOITMP,0)),"^",4)
"RTN","PSSPOIM1",16,0)
 K PSMAN,PSOITMP
"RTN","PSSPOIM1",17,0)
 Q
"RTN","PSSPOIM1",18,0)
END K ^TMP($J,"PSSOO"),PSSSSS,PSCREATE,^TMP("PSSLOOP",$J),^TMP($J,"INACTIVE_DATE")
"RTN","PSSPOIM1",19,0)
 K AAA,ANS,APLU,COMM,DA,DIC,DIE,DOSEFORM,DOSEFV,DOSEPTR,DR,FFF,MATCH,NEWSP,NODE,NOFLAG,OTH,POINT,PSCNT,PSIEN,PSMAN,PSMC,PSNAME,PSNO,PSSP,PSND,PSOUT,SPHOLD,SPR,TMPTR,TT,VAGEN,X,Y,ZZ,PSOOOUT,PSXDATE,PSXADATE,PSXSDATE,AAAAA,BBBBB,ZXX,PSXDDATE
"RTN","PSSPOIM1",20,0)
 K PSSDACT,PSSSACT,PSSAACT,PSSINACT,PSSDTENT,PSSCOMP,PSSDGDT,PSSDGIDL,PSSARR,PSSACT,PSSNEWIA
"RTN","PSSPOIM1",21,0)
 Q
"RTN","PSSPOIM1",22,0)
MESS W !!,"This option enables you to match Dispense Drugs to an entry in the Pharmacy",!,"Orderable Item file, or create a new Pharmacy Orderable Item entry for a",!,"Dispense Drug.",! Q
"RTN","PSSPOIM1",23,0)
MESSZ S ^TMP("PSSLOOP",$J,DUZ)="" W !!,"This option is for matching IV Additives, IV Solutions, and all Dispense Drugs",!,"marked with an I, O, or U in the Application Packages' Use field to an",!,"Orderable Item."
"RTN","PSSPOIM1",24,0)
 W !,"You will need to keep accessing this option until all drugs are matched.",!,"A check will be done every time this option is exited to see if the matching",!,"process is complete.",!!
"RTN","PSSPOIM1",25,0)
 K DIR S DIR(0)="E" D ^DIR K DIR I X["^"!($D(DTOUT)) S PSOUT=1
"RTN","PSSPOIM1",26,0)
 Q
"RTN","PSSPOIM1",27,0)
CHECK W !!!,"Checking Drug files, please wait..."
"RTN","PSSPOIM1",28,0)
 S X1=DT,X2=-365 D C^%DTC S PSZXDATE=X,DONEFLAG=1
"RTN","PSSPOIM1",29,0)
 F FFFF=0:0 S FFFF=$O(^PSDRUG(FFFF)) Q:'FFFF!('DONEFLAG)  S QQNM=$P($G(^PSDRUG(FFFF,0)),"^") I QQNM'="",$D(^PSDRUG("B",QQNM)) D  I ZZG I USAGE["O"!(USAGE["I")!(USAGE["U") I '$P($G(^PSDRUG(FFFF,2)),"^") S DONEFLAG=0
"RTN","PSSPOIM1",30,0)
 .S USAGE=$P($G(^PSDRUG(FFFF,2)),"^",3)
"RTN","PSSPOIM1",31,0)
 .S ZZG=1 S PSZZDATE=+$P($G(^PSDRUG(FFFF,"I")),"^") I PSZZDATE,PSZZDATE<PSZXDATE S ZZG=0
"RTN","PSSPOIM1",32,0)
 I DONEFLAG=1 D
"RTN","PSSPOIM1",33,0)
 .F QQQ=0:0 S QQQ=$O(^PS(52.6,QQQ)) Q:'QQQ!('DONEFLAG)  S PSZNAME=$P($G(^PS(52.6,QQQ,0)),"^") I PSZNAME'="",$D(^PS(52.6,"B",PSZNAME)),$P($G(^PS(52.6,QQQ,0)),"^",2),'$P($G(^(0)),"^",11) D  I ZZG S DONEFLAG=0
"RTN","PSSPOIM1",34,0)
 ..S ZZG=1 S PSZZDATE=+$P($G(^PS(52.6,QQQ,"I")),"^") I PSZZDATE,PSZZDATE<PSZXDATE S ZZG=0
"RTN","PSSPOIM1",35,0)
 .I DONEFLAG F QQQ=0:0 S QQQ=$O(^PS(52.7,QQQ)) Q:'QQQ!('DONEFLAG)  S PSZNAME=$P($G(^PS(52.7,QQQ,0)),"^") I PSZNAME'="",$D(^PS(52.7,"B",PSZNAME)),$P($G(^PS(52.7,QQQ,0)),"^",2),'$P($G(^(0)),"^",11) D  I ZZG S DONEFLAG=0
"RTN","PSSPOIM1",36,0)
 ..S ZZG=1 S PSZZDATE=+$P($G(^PS(52.7,QQQ,"I")),"^") I PSZZDATE,PSZZDATE<PSZXDATE S ZZG=0
"RTN","PSSPOIM1",37,0)
MAIL I DONEFLAG W !!!,?3,"You are finished matching to the Orderable Item File!",!!,"A clean-up job is being queued now, and when it is finished, you will"
"RTN","PSSPOIM1",38,0)
 I  W !,"receive a mail message informing you of its completion.",! K DIR S DIR(0)="E",DIR("A")="Press Return to continue" D ^DIR K DIR
"RTN","PSSPOIM1",39,0)
 I $G(DONEFLAG) S PSSOMAIL=1,PSOUDUZ=DUZ S ZTRTN="DATE^PSSPOIM1",ZTIO="",ZTDTH=$H,ZTDESC="ORDERABLE ITEM CLEAN UP",ZTSAVE("DUZ")="",ZTSAVE("PSSOMAIL")="" D ^%ZTLOAD
"RTN","PSSPOIM1",40,0)
 I 'DONEFLAG W $C(7),$C(7),!!?5,"There are still Drugs not matched, you will need to come back",!?5,"and continue matching Drugs!",! K DIR S DIR(0)="E",DIR("A")="Press Return to continue" D ^DIR K DIR
"RTN","PSSPOIM1",41,0)
 K DONEFLAG,QQQ,QQNM,PSZZDATE,PSZXDATE,ZZG,USAGE,FFFF,PSZNAME Q
"RTN","PSSPOIM1",42,0)
OTHER W @IOF W !,"There are other Dispense Drugs with the same VA Generic Name and same Dose",!,"Form already matched to orderable items. Choose a number to match, or enter",!,"'^' to enter a new one.",!!?6,"Disp. drug -> ",PSNAME,! Q
"RTN","PSSPOIM1",43,0)
EN(PSVAR) ;
"RTN","PSSPOIM1",44,0)
 N PSSDACT,PSSSACT,PSSAACT,PSSINACT,PSSDTENT
"RTN","PSSPOIM1",45,0)
 N PSSCOMP,PSSDGDT,PSSDGIDL,PSSARR,PSSACT
"RTN","PSSPOIM1",46,0)
 W !?3,"Now editing Orderable Item:",!?3,$P(^PS(50.7,PSVAR,0),"^"),"   ",$P($G(^PS(50.606,+$P(^(0),"^",2),0)),"^")
"RTN","PSSPOIM1",47,0)
 W ! K DIE,DA,DR N MFLG S PSBEFORE1=+$P(^PS(50.7,PSVAR,0),"^",2),PSAFTER=0,PSINORDE=""
"RTN","PSSPOIM1",48,0)
 S DIE="^PS(50.7,",DA=PSVAR,DR="5;6" D ^DIE K DIE,DA,DR I $D(DTOUT)!($D(Y)>10) Q
"RTN","PSSPOIM1",49,0)
 D INACT
"RTN","PSSPOIM1",50,0)
 I $G(Y)["^"!($D(DTOUT))!($G(DUOUT)) Q
"RTN","PSSPOIM1",51,0)
 D EN1
"RTN","PSSPOIM1",52,0)
 Q
"RTN","PSSPOIM1",53,0)
 ;
"RTN","PSSPOIM1",54,0)
INACT ;
"RTN","PSSPOIM1",55,0)
 ;check to see if an inactive date was added by code logic
"RTN","PSSPOIM1",56,0)
 ;(not by a user) but was erroneously added since there is
"RTN","PSSPOIM1",57,0)
 ;an active component for this orderable item
"RTN","PSSPOIM1",58,0)
 ;
"RTN","PSSPOIM1",59,0)
 ;The inactive date can be erroneously added at EN1+15^PSSPOIDT
"RTN","PSSPOIM1",60,0)
 ;when there is only one active component on an orderable item
"RTN","PSSPOIM1",61,0)
 ;and that component is being edited.
"RTN","PSSPOIM1",62,0)
 ;
"RTN","PSSPOIM1",63,0)
 ;The logic in PSSPOIDT cannot be changed without restructuring
"RTN","PSSPOIM1",64,0)
 ;much of the core logic.  Hence, the decision to insert the
"RTN","PSSPOIM1",65,0)
 ;following check to determine whether the inactive date
"RTN","PSSPOIM1",66,0)
 ;was not present when the user invoked option PSS MAINTAIN
"RTN","PSSPOIM1",67,0)
 ;ORDERABLE ITEM and was erroneously added to file 50.7 by
"RTN","PSSPOIM1",68,0)
 ;EN1^PSSPOIDT.
"RTN","PSSPOIM1",69,0)
 ;
"RTN","PSSPOIM1",70,0)
 D CHECK^PSSPOID2(PSVAR)
"RTN","PSSPOIM1",71,0)
 S PSBEFORE=$P(^PS(50.7,PSVAR,0),"^",4)
"RTN","PSSPOIM1",72,0)
 I $G(^TMP($J,"INACTIVE_DATE",PSVAR))="",PSBEFORE]"" D
"RTN","PSSPOIM1",73,0)
 . ;Information returned by CHECK^PSSPOID2(PSVAR):
"RTN","PSSPOIM1",74,0)
 . ;  PSSDACT = array of active dispense drugs
"RTN","PSSPOIM1",75,0)
 . ;  PSSSACT = array of active solutions
"RTN","PSSPOIM1",76,0)
 . ;  PSSAACT = array of active additives
"RTN","PSSPOIM1",77,0)
 . I $O(PSSDACT(0))!($O(PSSSACT(0)))!($O(PSSAACT(0))) D
"RTN","PSSPOIM1",78,0)
 . . ;Attempt to delete the inactive date since it
"RTN","PSSPOIM1",79,0)
 . . ;may have been added erroneously.
"RTN","PSSPOIM1",80,0)
 . . ;An inactive date may still be present after this call
"RTN","PSSPOIM1",81,0)
 . . ;if all components have an inactive date and
"RTN","PSSPOIM1",82,0)
 . . ;and one or more of those dates are in the future
"RTN","PSSPOIM1",83,0)
 . . S DIE="^PS(50.7,",DA=PSVAR,DR=".04////@" D ^DIE K DIE,DA,DR
"RTN","PSSPOIM1",84,0)
 . . S PSBEFORE=$P(^PS(50.7,PSVAR,0),"^",4)
"RTN","PSSPOIM1",85,0)
 ;
"RTN","PSSPOIM1",86,0)
 ;Check to see if an inactive date did not exist when user
"RTN","PSSPOIM1",87,0)
 ;invoked the option and one has been added that is incorrect.
"RTN","PSSPOIM1",88,0)
 ;This can occur if all components have an inactive date on
"RTN","PSSPOIM1",89,0)
 ;file, and all inactive dates are today or in the past.
"RTN","PSSPOIM1",90,0)
 ;If user is working on a component with the latest inactive
"RTN","PSSPOIM1",91,0)
 ;date, that date was not set as the orderable item inactive
"RTN","PSSPOIM1",92,0)
 ;date as it should have.
"RTN","PSSPOIM1",93,0)
 ;
"RTN","PSSPOIM1",94,0)
 D IACHK
"RTN","PSSPOIM1",95,0)
 I $G(^TMP($J,"INACTIVE_DATE",PSVAR))="",PSSDGIDL]"",PSBEFORE]"",PSSDGIDL'=PSBEFORE D
"RTN","PSSPOIM1",96,0)
 . S PSBEFORE=PSSDGIDL
"RTN","PSSPOIM1",97,0)
 . S DIE="^PS(50.7,",DA=PSVAR,DR=".04////"_PSSDGIDL
"RTN","PSSPOIM1",98,0)
 . D ^DIE K DIE,DA,DR
"RTN","PSSPOIM1",99,0)
 D INACT1
"RTN","PSSPOIM1",100,0)
 I $G(Y)["^"!($D(DTOUT))!($G(DUOUT)) Q
"RTN","PSSPOIM1",101,0)
 D IACHK1
"RTN","PSSPOIM1",102,0)
 Q
"RTN","PSSPOIM1",103,0)
 ;
"RTN","PSSPOIM1",104,0)
INACT1 ;
"RTN","PSSPOIM1",105,0)
 N PSSNEWIA S PSSNEWIA=""
"RTN","PSSPOIM1",106,0)
 ;Does the user wish to add or change the inactive date
"RTN","PSSPOIM1",107,0)
 K DIR S DIR(0)="DO",DIR("A")="INACTIVE DATE" D  D ^DIR K DIR I $G(Y)["^"!($D(DTOUT))!($G(DUOUT)) Q
"RTN","PSSPOIM1",108,0)
 .I $G(PSBEFORE) S Y=PSBEFORE D DD^%DT S DIR("B")=$G(Y)
"RTN","PSSPOIM1",109,0)
 S DIE="^PS(50.7,",DA=PSVAR,PSSNEWIA=Y
"RTN","PSSPOIM1",110,0)
 I $G(PSBEFORE),'PSSNEWIA D
"RTN","PSSPOIM1",111,0)
 . I '$O(PSSDACT(0)),'$O(PSSSACT(0)),'$O(PSSAACT(0)) D  Q
"RTN","PSSPOIM1",112,0)
 . . W !!,?15,"All Drugs/Additives/Solutions matched to this"
"RTN","PSSPOIM1",113,0)
 . . W !,?15,"Orderable Item are inactive."
"RTN","PSSPOIM1",114,0)
 . . W !!,?15,"The INACTIVE DATE cannot be deleted.",!
"RTN","PSSPOIM1",115,0)
 . S DR=".04////@"
"RTN","PSSPOIM1",116,0)
 . D ^DIE K DIE,DA,DR
"RTN","PSSPOIM1",117,0)
 . ;An inactive date may have been set if all components
"RTN","PSSPOIM1",118,0)
 . ;are defined with an inactive date and one or more
"RTN","PSSPOIM1",119,0)
 . ;of those dates are in the future.
"RTN","PSSPOIM1",120,0)
 . I $P(^PS(50.7,PSVAR,0),"^",4)="" D
"RTN","PSSPOIM1",121,0)
 . . W ?35,"The inactive date has been deleted.",!
"RTN","PSSPOIM1",122,0)
 I PSSNEWIA D
"RTN","PSSPOIM1",123,0)
 . S DR=".04////"_PSSNEWIA
"RTN","PSSPOIM1",124,0)
 . D DD^%DT W ?40,Y,!
"RTN","PSSPOIM1",125,0)
 . D ^DIE K DIE,DA,DR
"RTN","PSSPOIM1",126,0)
 S PSSINACT=$P(^PS(50.7,PSVAR,0),"^",4)
"RTN","PSSPOIM1",127,0)
 I PSSINACT="" Q
"RTN","PSSPOIM1",128,0)
 ;
"RTN","PSSPOIM1",129,0)
 ;Inform user if user specified that inactive date should
"RTN","PSSPOIM1",130,0)
 ;be deleted.
"RTN","PSSPOIM1",131,0)
 ;
"RTN","PSSPOIM1",132,0)
 I 'PSSNEWIA D
"RTN","PSSPOIM1",133,0)
 . W !,?15,"The Inactive Date is: "
"RTN","PSSPOIM1",134,0)
 . S Y=PSSINACT D DD^%DT W Y,"."
"RTN","PSSPOIM1",135,0)
 Q
"RTN","PSSPOIM1",136,0)
 ;
"RTN","PSSPOIM1",137,0)
IACHK ;
"RTN","PSSPOIM1",138,0)
 ;Check to see if the inactive date on the orderable item
"RTN","PSSPOIM1",139,0)
 ;is greater than the greatest inactive date on
"RTN","PSSPOIM1",140,0)
 ;corresponding Drugs/Additives/Solutions.
"RTN","PSSPOIM1",141,0)
 ;Not automatically setting to that value unless the inactive date
"RTN","PSSPOIM1",142,0)
 ;was null when user invoked the option.
"RTN","PSSPOIM1",143,0)
 ;Otherwise, leave as is in case user wishes it defined as such.
"RTN","PSSPOIM1",144,0)
 ;
"RTN","PSSPOIM1",145,0)
 S PSSCOMP="",PSSACT=0
"RTN","PSSPOIM1",146,0)
 F  S PSSCOMP=$O(^PS(50.7,"A50",PSVAR,PSSCOMP)) Q:PSSCOMP=""  D
"RTN","PSSPOIM1",147,0)
 . S PSSARR(PSSCOMP)=""
"RTN","PSSPOIM1",148,0)
 ;Latest inactive date = PSSDGIDL
"RTN","PSSPOIM1",149,0)
 ;Inactive date on each component = PSSDGDT
"RTN","PSSPOIM1",150,0)
 S PSSDGIDL=""
"RTN","PSSPOIM1",151,0)
 F  S PSSCOMP=$O(PSSARR(PSSCOMP)) Q:PSSCOMP=""  D
"RTN","PSSPOIM1",152,0)
 . S PSSDGDT=$G(^PSDRUG(PSSCOMP,"I"))
"RTN","PSSPOIM1",153,0)
 . I PSSDGDT="" S PSSACT=1
"RTN","PSSPOIM1",154,0)
 . I PSSDGDT>PSSDGIDL S PSSDGIDL=PSSDGDT
"RTN","PSSPOIM1",155,0)
 Q
"RTN","PSSPOIM1",156,0)
 ;
"RTN","PSSPOIM1",157,0)
IACHK1 ;
"RTN","PSSPOIM1",158,0)
 ;message to user
"RTN","PSSPOIM1",159,0)
 I PSSDGIDL]"",'PSSACT D
"RTN","PSSPOIM1",160,0)
 . S Y=PSSDGIDL D DD^%DT
"RTN","PSSPOIM1",161,0)
 . I PSSDGIDL<PSSINACT D  Q
"RTN","PSSPOIM1",162,0)
 . . W !!,?15,"**** **** NOTE **** ****",!
"RTN","PSSPOIM1",163,0)
 . . W !,?15,"All Drugs/Additives/Solutions for this orderable item"
"RTN","PSSPOIM1",164,0)
 . . W !,?15,"are inactive as of ",Y,".",!
"RTN","PSSPOIM1",165,0)
 . . S Y=$P(^PS(50.7,PSVAR,0),"^",4) D DD^%DT
"RTN","PSSPOIM1",166,0)
 . . W !,?15,"However, the orderable item ",$P(^PS(50.7,PSVAR,0),"^")
"RTN","PSSPOIM1",167,0)
 . . W !,?15,"is inactive on ",Y,".",!
"RTN","PSSPOIM1",168,0)
 . . W !,?15,"You may need to change the inactive date on the orderable item"
"RTN","PSSPOIM1",169,0)
 . . W !,?15,"using option PSS EDIT ORDERABLE ITEMS.",!
"RTN","PSSPOIM1",170,0)
 . . W !,?15,"****    ****    ****    ****    ****",!
"RTN","PSSPOIM1",171,0)
 . ;
"RTN","PSSPOIM1",172,0)
 . W !,?15,"All Drugs/Additives/Solutions matched to this"
"RTN","PSSPOIM1",173,0)
 . W !,?15,"Orderable Item are inactive as of ",Y,".",!
"RTN","PSSPOIM1",174,0)
 Q
"RTN","PSSPOIM1",175,0)
 ;
"RTN","PSSPOIM1",176,0)
EN1 ;
"RTN","PSSPOIM1",177,0)
 ;PSSDTENT is used by routine PSSPOIMO
"RTN","PSSPOIM1",178,0)
 N PSSDTENT
"RTN","PSSPOIM1",179,0)
 S PSSDTENT=PSSINACT
"RTN","PSSPOIM1",180,0)
 S PSSOTH=$P($G(^PS(59.7,1,40.2)),"^"),DIE="^PS(50.7,",DA=PSVAR
"RTN","PSSPOIM1",181,0)
 S DR=".05;@1;D SETF^PSSPOIMO;.06;D DFR^PSSPOIMO(PSBEFORE1);10//YES;I X=""Y"" S Y=""@2"";S:$G(DUOUT) Y=""@3"";" D
"RTN","PSSPOIM1",182,0)
 .S DR=DR_"D PDCHK^PSSPOIMO S:PSSFG Y=""@1"";S:$G(DUOUT) Y=""@3"";@2;K DIE(""NO^""),DIRUT;D MRSEL^PSSPOIMO;.07;.08;1;12//0;7;S:'$G(PSSOTH) Y=""@3"";7.1;@3" ;*191
"RTN","PSSPOIM1",183,0)
 D ^DIE S PSAFTER=$P(^PS(50.7,PSVAR,0),"^",4) K DIE,DA,DR,PSSOTH,^TMP("PSJMR",$J),^TMP("PSSDMR",$J) I $D(PSSOU),'$G(PSSOU) D MRSEL^PSSPOIMO K ^TMP("PSJMR",$J)
"RTN","PSSPOIM1",184,0)
 S:PSBEFORE&('PSAFTER) PSINORDE="D" S:PSAFTER PSINORDE="I"
"RTN","PSSPOIM1",185,0)
 I PSINORDE'="" D REST^PSSPOIDT(PSVAR)
"RTN","PSSPOIM1",186,0)
 K PSBEFORE,PSBEFORE1,PSAFTER,PSINORDE
"RTN","PSSPOIM1",187,0)
 N DIE,DA,DR  ; Indications for Use fields PSS*1*204
"RTN","PSSPOIM1",188,0)
 S DIE="^PS(50.7,",DA=PSVAR,DR="14;13" D ^DIE K DIE
"RTN","PSSPOIM1",189,0)
IMMUN ;PSS*1*141 FOR 'IMMUNIZATIONS DOCUMENTATION BY BCMA'
"RTN","PSSPOIM1",190,0)
 I $O(^PSDRUG("AOC",PSVAR,"IM000"))'["IM" G SYN ;ASK WHEN APPROPRIATE
"RTN","PSSPOIM1",191,0)
 W ! S DIE="^PS(50.7,",DA=PSVAR,DR=9 D ^DIE K DIE
"RTN","PSSPOIM1",192,0)
SYN I $G(Y)["^"!($G(DIRUT))!$D(DTOUT)!($D(Y)>10) G FINS
"RTN","PSSPOIM1",193,0)
 W ! K DIC S:'$D(^PS(50.7,PSVAR,2,0)) ^PS(50.7,PSVAR,2,0)="^50.72^0^0" S DIC="^PS(50.7,"_PSVAR_",2,",DA(1)=PSVAR,DIC(0)="QEAMZL",DIC("A")="Select SYNONYM: ",DLAYGO=50.72 D ^DIC K DIC
"RTN","PSSPOIM1",194,0)
 I Y<0!($D(DTOUT))!($D(DUOUT)) K:'$O(^PS(50.7,PSVAR,2,0)) ^PS(50.7,PSVAR,2,0) S PSSNOOI=1 G FIN
"RTN","PSSPOIM1",195,0)
 W ! S DA=+Y,DIE="^PS(50.7,"_PSVAR_",2,",DA(1)=PSVAR,DR=.01 D ^DIE K DIE G SYN
"RTN","PSSPOIM1",196,0)
FIN D EN^PSSPOIDT(PSVAR) I $G(PSVAR1) D EN2^PSSHL1(PSVAR,"MAD") G FINS
"RTN","PSSPOIM1",197,0)
 D EN2^PSSHL1(PSVAR,"MUP")
"RTN","PSSPOIM1",198,0)
FINS K PSVAR,PSVAR1 Q
"RTN","PSSPOIM1",199,0)
 ;
"RTN","PSSPOIM1",200,0)
DATE ;
"RTN","PSSPOIM1",201,0)
 F ZZZ=0:0 S ZZZ=$O(^PS(50.7,ZZZ)) Q:'ZZZ  S PSOTYPE=$P($G(^PS(50.7,ZZZ,0)),"^",3) D
"RTN","PSSPOIM1",202,0)
 .I PSOTYPE,'$D(^PS(52.6,"AOI",ZZZ)),'$D(^PS(52.7,"AOI",ZZZ)),'$P($G(^PS(50.7,ZZZ,0)),"^",4) K DIE S DIE="^PS(50.7,",DA=ZZZ,DR=".04////"_DT D ^DIE K DIE Q
"RTN","PSSPOIM1",203,0)
 .Q:PSOTYPE
"RTN","PSSPOIM1",204,0)
 .D SUPP
"RTN","PSSPOIM1",205,0)
 .I '$D(^PSDRUG("ASP",ZZZ)),'$P($G(^PS(50.7,ZZZ,0)),"^",4) K DIE S DIE="^PS(50.7,",DA=ZZZ,DR=".04////"_DT D ^DIE K DIE Q
"RTN","PSSPOIM1",206,0)
 .D:'$P($G(^PS(50.7,ZZZ,0)),"^",4)
"RTN","PSSPOIM1",207,0)
 ..S PSDFLAG=0 F WW=0:0 S WW=$O(^PSDRUG("ASP",ZZZ,WW)) Q:'WW!(PSDFLAG)  S PSAPPL=$P($G(^PSDRUG(WW,2)),"^",3) I PSAPPL["I"!(PSAPPL["O")!(PSAPPL["U") S PSDFLAG=1
"RTN","PSSPOIM1",208,0)
 ..I 'PSDFLAG K DIE S DIE="^PS(50.7,",DA=ZZZ,DR=".04////"_DT D ^DIE K DIE
"RTN","PSSPOIM1",209,0)
 F ZZZ=0:0 S ZZZ=$O(^PS(52.7,ZZZ)) Q:'ZZZ  S RRRR=$P($G(^PS(52.7,ZZZ,0)),"^",11) I RRRR,'$P($G(^PS(50.7,RRRR,0)),"^",3) K DIE S DA=ZZZ,DIE="^PS(52.7,",DR="9////"_"@" D ^DIE K DIE
"RTN","PSSPOIM1",210,0)
 F ZZZ=0:0 S ZZZ=$O(^PS(52.6,ZZZ)) Q:'ZZZ  S RRRR=$P($G(^PS(52.6,ZZZ,0)),"^",11) I RRRR,'$P($G(^PS(50.7,RRRR,0)),"^",3) K DIE S DA=ZZZ,DIE="^PS(52.6,",DR="15////"_"@" D ^DIE K DIE
"RTN","PSSPOIM1",211,0)
 D:$G(PSCREATE) MAIL^PSSCREAT
"RTN","PSSPOIM1",212,0)
 I '$G(PSSOMAIL) K PSOTYPE,DA,DIE,WW,RRRR,PSDFLAG,PSAPPL,GGG,HHH,ZZZZZ Q
"RTN","PSSPOIM1",213,0)
 S PSOTEXT(1)="You have completed the matching process required for the installation of",PSOTEXT(2)="Outpatient V. 7.0 and Inpatient Medications V. 5.0!"
"RTN","PSSPOIM1",214,0)
 S XMDUZ=.5,XMY(DUZ)="",XMTEXT="PSOTEXT(",XMSUB="Pharmacy Orderable Item File" D ^XMD
"RTN","PSSPOIM1",215,0)
 S PSSITE=+$O(^PS(59.7,0)) S $P(^PS(59.7,PSSITE,80),"^",2)=3 K PSSITE
"RTN","PSSPOIM1",216,0)
 D ^%ZISC K PSOTYPE,DA,DIE,WW,RRRR,PSDFLAG,PSAPPL,GGG,HHH,ZZZZZ,PSSOMAIL S:$D(ZTQUEUED) ZTREQ="@" Q
"RTN","PSSPOIM1",217,0)
RMES W !!,"This report takes a long time to first build the data to print, then to",!,"actually print the data. To avoid tying up a terminal for a long period of time,",!,"the report must be QUEUED to a printer."
"RTN","PSSPOIM1",218,0)
 W !!,"This report must be QUEUED to a printer!"
"RTN","PSSPOIM1",219,0)
 Q
"RTN","PSSPOIM1",220,0)
KMES W !!,"Due to the length of this report, and to avoid tying up a terminal for a long",!,"time, this report must be QUEUED to a printer!"
"RTN","PSSPOIM1",221,0)
 Q
"RTN","PSSPOIM1",222,0)
SUPP ;Mark as supply
"RTN","PSSPOIM1",223,0)
 N SSSUP,SSSIN,SSSAP,SSLOOP,SSSQUE,SSSQUEY,SSSQDATE,SLIP,SLDO,SLDP
"RTN","PSSPOIM1",224,0)
 S (SSSQUE,SSSQUEY)=0 F SSLOOP=0:0 S SSLOOP=$O(^PSDRUG("ASP",ZZZ,SSLOOP)) Q:'SSLOOP!(SSSQUEY)  D
"RTN","PSSPOIM1",225,0)
 .I $P($G(^PSDRUG(SSLOOP,0)),"^",3)["S" S SSSAP=$P($G(^(2)),"^",3),SSSIN=$P($G(^("I")),"^") D
"RTN","PSSPOIM1",226,0)
 ..I SSSAP["O"!(SSSAP["I")!(SSSAP["U") I 'SSSIN S $P(^PS(50.7,ZZZ,0),"^",9)=1 S (SSSQUEY,SSSQUE)=1 Q
"RTN","PSSPOIM1",227,0)
 ..I SSSAP["O"!(SSSAP["I")!(SSSAP["U") I +SSSIN>DT S $P(^PS(50.7,ZZZ,0),"^",9)=1 S SSSQUE=1,SSSQDATE($E(SSSIN,1,7))=""
"RTN","PSSPOIM1",228,0)
 I 'SSSQUEY,SSSQUE,$O(SSSQDATE(0)) F SLIP=0:0 S SLIP=$O(SSSQDATE(SLIP)) Q:'SLIP  D
"RTN","PSSPOIM1",229,0)
 .S ZTRTN="ENT^PSSPOIDT",ZTDESC="Supply update for Orderable Item",ZTIO="",ZTDTH=SLIP_.01 S SLDO=$G(PSSORDIT),SLDP=$G(PSSCROSS) S PSSORDIT=ZZZ,PSSCROSS=1 S ZTSAVE("PSSORDIT")="",ZTSAVE("PSSCROSS")="" D ^%ZTLOAD D
"RTN","PSSPOIM1",230,0)
 ..S PSSORDIT=$G(SLDO) K:'PSSORDIT PSSORDIT
"RTN","PSSPOIM1",231,0)
 ..S PSSCROSS=$G(SLDP) K:'PSSCROSS PSSCROSS
"RTN","PSSPOIM1",232,0)
 Q
"RTN","PSSPOIM1",233,0)
 ;
"RTN","PSSPOIMN")
0^4^B82922600^B82446313
"RTN","PSSPOIMN",1,0)
PSSPOIMN ;BIR/RTR/WRT - Orderable Item manual create ;09/01/98
"RTN","PSSPOIMN",2,0)
 ;;1.0;PHARMACY DATA MANAGEMENT;**15,32,34,38,51,57,82,125,189,220**;9/30/97;Build 4
"RTN","PSSPOIMN",3,0)
 ;
"RTN","PSSPOIMN",4,0)
 ;Reference to ^PS(59 supported by DBIA #1976
"RTN","PSSPOIMN",5,0)
 ;Reference to $$PSJDF^PSNAPIS(P1,P3) supported by DBIA #2531
"RTN","PSSPOIMN",6,0)
 ;Reference to $$VAGN^PSNAPIS(P1) supported by DBIA #2531
"RTN","PSSPOIMN",7,0)
 ;
"RTN","PSSPOIMN",8,0)
 N PSSDONE
"RTN","PSSPOIMN",9,0)
 S PSSITE=+$O(^PS(59.7,0)) I +$P($G(^PS(59.7,PSSITE,80)),"^",2)<2 W !!?3,"Orderable Item Auto-Create has not been completed yet!",! K PSSITE,DIR S DIR(0)="E",DIR("A")="Press RETURN to continue" D ^DIR K DIR Q
"RTN","PSSPOIMN",10,0)
 K PSSITE D MESS^PSSPOIM1
"RTN","PSSPOIMN",11,0)
BEG I $D(PSIEN) L -^PSDRUG(PSIEN)
"RTN","PSSPOIMN",12,0)
 K PSSCROSS,DOSEFV,DOSEFORM,POINT,SPHOLD,NEWSP,PSVAR1,PSITEM,PSTOP,PSMASTER,DIC("S")
"RTN","PSSPOIMN",13,0)
 S PSOUT=0 W !! K DIC S DIC(0)="QEAM",DIC="^PSDRUG(",DIC("A")="Select DISPENSE DRUG: "
"RTN","PSSPOIMN",14,0)
 ;DIC("S")="I $P($G(^PSDRUG(+Y,2)),""^"",3)[""I""!($P($G(^(2)),""^"",3)[""O"")!($P($G(^(2)),""^"",3)[""U"")"
"RTN","PSSPOIMN",15,0)
 D ^DIC G:$D(DTOUT)!($D(DUOUT))!(Y<1) END K DIC("S") S PSIEN=+Y,PSNAME=$P(^PSDRUG(PSIEN,0),"^") L +^PSDRUG(PSIEN):$S($G(DILOCKTM)>0:DILOCKTM,1:3) I '$T W !,$C(7),"Another person is editing this one." Q
"RTN","PSSPOIMN",16,0)
MAS I $G(PSMASTER) S PSOUT=0 N DOSEFV,DOSEFORM,POINT,SPHOLD,NEWSP,PSVAR1,PSITEM,PSTOP
"RTN","PSSPOIMN",17,0)
 S NODE=$G(^PSDRUG(PSIEN,"ND")),DOSEPTR=0,DA=$P(NODE,"^"),X=$$VAGN^PSNAPIS(DA),VAGEN=X I +$P(NODE,"^"),+$P(NODE,"^",3),VAGEN'=0 S K=$P(NODE,"^",3),X=$$PSJDF^PSNAPIS(DA,K),DOSEFV=X I DOSEFV'=0 D
"RTN","PSSPOIMN",18,0)
 .S DOSEPTR=$P(X,"^"),DOSEFORM=$P(X,"^",2)
"RTN","PSSPOIMN",19,0)
 D TMP
"RTN","PSSPOIMN",20,0)
 I +$P($G(^PSDRUG(PSIEN,2)),"^") S (POINT,PSITEM)=$P(^(2),"^") W !!,PSNAME," is already matched to",!!,?5,$P($G(^PS(50.7,POINT,0)),"^")_" "_$P($G(^PS(50.606,+$P($G(^(0)),"^",2),0)),"^"),!
"RTN","PSSPOIMN",21,0)
 ;Warn user the Orderable Item is inactive. Display date and option to use.
"RTN","PSSPOIMN",22,0)
 I $G(POINT) N PSSIAD D
"RTN","PSSPOIMN",23,0)
 .S PSSIAD=$P($G(^PS(50.7,POINT,0)),"^",4) I $G(PSSIAD) S Y=PSSIAD D DD^%DT W !,"This Orderable Item has an Inactive Date.  *** "_Y,!,"To modify the Orderable Item, use the 'Edit Orderable Item' option."
"RTN","PSSPOIMN",24,0)
 I $G(POINT) D  W ! K DIR S DIR("B")="NO",DIR(0)="Y",DIR("A")="Do you want to match to a different Orderable Item" D ^DIR K DIR D:Y=1 MORE,SET,REM D SETX G:$G(PSMASTER) END G BEG
"RTN","PSSPOIMN",25,0)
 .K PSSDXLF
"RTN","PSSPOIMN",26,0)
 D MCH
"RTN","PSSPOIMN",27,0)
 G:'$G(PSMASTER) BEG
"RTN","PSSPOIMN",28,0)
END I $D(PSIEN) I '$G(PSSHUIDG) D DRG^PSSHUIDG(PSIEN) D  L -^PSDRUG(PSIEN)
"RTN","PSSPOIMN",29,0)
 .N XX,DVER,DNSNAM,DNSPORT,DMFU S XX=""
"RTN","PSSPOIMN",30,0)
 .F XX=0:0 S XX=$O(^PS(59,XX)) Q:'XX  D
"RTN","PSSPOIMN",31,0)
 ..S DVER=$$GET1^DIQ(59,XX_",",105,"I"),DMFU=$$GET1^DIQ(59,XX_",",105.2)
"RTN","PSSPOIMN",32,0)
 ..I DVER="2.4" S DNSNAM=$$GET1^DIQ(59,XX_",",2006),DNSPORT=$$GET1^DIQ(59,XX_",",2007) I DNSNAM'=""&(DMFU="YES") D DRG^PSSDGUPD(PSIEN,"",DNSNAM,DNSPORT)
"RTN","PSSPOIMN",33,0)
 G END^PSSPOIM1
"RTN","PSSPOIMN",34,0)
REM D TMP
"RTN","PSSPOIMN",35,0)
 I $O(^TMP($J,"PSSOO",0)) H 1 D OTHER^PSSPOIM1,DISP
"RTN","PSSPOIMN",36,0)
 I $G(PSOUT) Q
"RTN","PSSPOIMN",37,0)
 S PSSDONE=0
"RTN","PSSPOIMN",38,0)
 I $O(^TMP($J,"PSSOO",0)),$G(MATCH) D  I PSSDONE Q
"RTN","PSSPOIMN",39,0)
 .S PSSP=MATCH D ^PSSPOIM1 Q:(PSOUT)!(PSNO)
"RTN","PSSPOIMN",40,0)
 .;Checking whether the Orderable Item would have duplicate IV Solution Volumes
"RTN","PSSPOIMN",41,0)
 .I $$CKDUPVOL(+MATCH,PSIEN) Q
"RTN","PSSPOIMN",42,0)
 .S DIE="^PSDRUG(",DA=PSIEN,DR="2.1////"_MATCH  D ^DIE K DIE S PSITEM=MATCH,PSSDONE=1 D COM
"RTN","PSSPOIMN",43,0)
 G MCHA
"RTN","PSSPOIMN",44,0)
TMP K ^TMP($J,"PSSOO") S PSCNT=0 I +$P(NODE,"^"),+$P(NODE,"^",3) F ZZ=0:0 S ZZ=$O(^PSDRUG("AND",+NODE,ZZ)) Q:'ZZ  I +$P($G(^PSDRUG(ZZ,2)),"^"),$P(^PSDRUG(ZZ,2),"^")'=$G(POINT),$D(^PS(50.7,$P(^PSDRUG(ZZ,2),"^"),0)) S OTH=$G(^PSDRUG(ZZ,"ND")) D
"RTN","PSSPOIMN",45,0)
 .I +$P(OTH,"^"),+$P(OTH,"^",3),DOSEFV'=0 S DA=$P(OTH,"^"),K=$P(OTH,"^",3),X=$$PSJDF^PSNAPIS(DA,K),DOSA=X I DOSA'=0,DOSEFV=DOSA D
"RTN","PSSPOIMN",46,0)
 ..S NOFLAG=0,TMPTR=$P(^PSDRUG(ZZ,2),"^") F FFF=0:0 S FFF=$O(^TMP($J,"PSSOO",FFF)) Q:'FFF  I $P(^TMP($J,"PSSOO",FFF),"^")=TMPTR S NOFLAG=1
"RTN","PSSPOIMN",47,0)
 ..I 'NOFLAG S PSCNT=PSCNT+1 S ^TMP($J,"PSSOO",PSCNT)=$P(^PSDRUG(ZZ,2),"^")_"^"_ZZ
"RTN","PSSPOIMN",48,0)
 Q
"RTN","PSSPOIMN",49,0)
DISP S MATCH=0 F TT=0:0 S TT=$O(^TMP($J,"PSSOO",TT)) Q:'TT  S SPT=$P(^TMP($J,"PSSOO",TT),"^") W !,TT,"  ",$P($G(^PS(50.7,SPT,0)),"^")_" "_$P($G(^PS(50.606,+$P($G(^(0)),"^",2),0)),"^") I $Y+5>IOSL D  Q:Y=0  I Y="" S PSOUT=1 Q
"RTN","PSSPOIMN",50,0)
 .W ! K DIR S DIR(0)="E" D ^DIR I Y W @IOF W !,?3,"Dispense Drug -> ",PSNAME,!
"RTN","PSSPOIMN",51,0)
DISPO Q:$G(PSOUT)  W ! K DIR S DIR(0)="N",DIR("A")="Choose number of Orderable Item to match, or '^' to enter a new one" D ^DIR K DIR I Y=""!($D(DTOUT)) S PSOUT=1 Q
"RTN","PSSPOIMN",52,0)
 Q:Y["^"  I '$D(^TMP($J,"PSSOO",+Y)) W !!,?5,"INVALID NUMBER" G DISPO
"RTN","PSSPOIMN",53,0)
 S MATCH=$P(^TMP($J,"PSSOO",+Y),"^") Q
"RTN","PSSPOIMN",54,0)
 S PSOUT=1 Q
"RTN","PSSPOIMN",55,0)
MCH ;
"RTN","PSSPOIMN",56,0)
 I $O(^TMP($J,"PSSOO",0)) H 1 D OTHER^PSSPOIM1,DISP
"RTN","PSSPOIMN",57,0)
 I $G(PSOUT) Q
"RTN","PSSPOIMN",58,0)
 S PSSDONE=0
"RTN","PSSPOIMN",59,0)
 I $O(^TMP($J,"PSSOO",0)),$G(MATCH) D  I PSSDONE Q
"RTN","PSSPOIMN",60,0)
 .S PSSP=MATCH D ^PSSPOIM1 I (PSOUT)!(PSNO) Q
"RTN","PSSPOIMN",61,0)
 .;Checking whether the Orderable Item would have duplicate IV Solution Volumes
"RTN","PSSPOIMN",62,0)
 .I $$CKDUPVOL(+MATCH,PSIEN) Q
"RTN","PSSPOIMN",63,0)
 .K DIE S DIE="^PSDRUG(",DA=PSIEN,DR="2.1////"_MATCH D ^DIE S PSITEM=MATCH D COM S PSSDONE=1
"RTN","PSSPOIMN",64,0)
MCHA W ! I $G(DOSEFORM)'="" W !?3,"Dosage Form -> ",DOSEFORM,!! K DIR S DIR(0)="Y",DIR("B")="NO",DIR("A")="Match to another Orderable Item with same Dosage Form" D ^DIR G:Y=1 LOOK I Y["^"!(Y="")!($D(DTOUT)) Q
"RTN","PSSPOIMN",65,0)
 I $G(DOSEFORM)="" K DIC S DIC="^PS(50.606,",DIC(0)="QEAMZ",DIC("A")="Choose Dosage Form: " D ^DIC Q:$D(DTOUT)!($D(DUOUT))!(Y<1)  S DOSEPTR=+Y W !!?3,"Dose Form -> ",$G(Y(0,0))
"RTN","PSSPOIMN",66,0)
 I $G(DOSEFORM)="" K DIR W ! S DIR(0)="Y",DIR("B")="NO",DIR("A")="Match to another Orderable Item with same Dosage Form" D ^DIR
"RTN","PSSPOIMN",67,0)
 I $G(DOSEFORM)="" Q:$D(DTOUT)!($D(DUOUT))!(Y<0)  S DOSEFORM=$P(^PS(50.606,DOSEPTR,0),"^") G:Y>0 LOOK
"RTN","PSSPOIMN",68,0)
MCHAN W !! I $L(VAGEN)>40 W !,"VA Generic Name -> ",VAGEN,!
"RTN","PSSPOIMN",69,0)
 W !,?3,"Dosage Form   -> ",DOSEFORM,!,?3,"Dispense Drug -> ",PSNAME,!!
"RTN","PSSPOIMN",70,0)
 K DIR S DIR(0)="F^3:40",DIR("A")="Orderable Item Name" S:$L(VAGEN)>2&($L(VAGEN)<41) DIR("B")=VAGEN
"RTN","PSSPOIMN",71,0)
 D ^DIR Q:$D(DUOUT)!($D(DTOUT))!(Y["^")!(Y="")
"RTN","PSSPOIMN",72,0)
 I X[""""!($A(X)=45)!('(X'?1P.E))!(X?2"z".E) W $C(7),!!?5,"??" G MCHAN
"RTN","PSSPOIMN",73,0)
 S (X,SPHOLD)=Y,(STOP,PSNO)=0
"RTN","PSSPOIMN",74,0)
 F COMM=0:0 S COMM=$O(^PS(50.7,"ADF",SPHOLD,DOSEPTR,COMM)) Q:'COMM!(STOP)!($G(PSOUT))  I COMM,$P($G(^PS(50.7,COMM,0)),"^",3)="" D
"RTN","PSSPOIMN",75,0)
 .S PSSP=COMM D ^PSSPOIM1 S:PSNO STOP=1 I PSOUT!(STOP) Q
"RTN","PSSPOIMN",76,0)
 .;Checking whether the Orderable Item would have duplicate IV Solution Volumes
"RTN","PSSPOIMN",77,0)
 .I $$CKDUPVOL(+COMM,PSIEN) S PSOUT=1 Q
"RTN","PSSPOIMN",78,0)
 .K DIE S DIE="^PSDRUG(",DA=PSIEN,DR="2.1////"_COMM D ^DIE S PSITEM=COMM D COM S STOP=1
"RTN","PSSPOIMN",79,0)
 Q:PSOUT
"RTN","PSSPOIMN",80,0)
 I STOP,$G(PSNO) G MCHAN
"RTN","PSSPOIMN",81,0)
 Q:STOP
"RTN","PSSPOIMN",82,0)
 S PSMAN=1
"RTN","PSSPOIMN",83,0)
 D ^PSSPOIM1
"RTN","PSSPOIMN",84,0)
 G:PSNO MCHAN Q:PSOUT  K DIC S DIC="^PS(50.7,",DIC(0)="L",X=SPHOLD,DIC("DR")=".02////"_DOSEPTR K DD,DO D FILE^DICN K DD,DO D:Y<1  G:(Y<1) MCHAN S NEWSP=+Y,DIE="^PSDRUG(",DA=PSIEN,DR="2.1////"_NEWSP D ^DIE S PSVAR1=1,PSITEM=NEWSP D COM Q
"RTN","PSSPOIMN",85,0)
 .W $C(7),!?5,"Invalid entry!",!! Q
"RTN","PSSPOIMN",86,0)
 Q
"RTN","PSSPOIMN",87,0)
 ;
"RTN","PSSPOIMN",88,0)
LOOK ;
"RTN","PSSPOIMN",89,0)
 N PSSDONE
"RTN","PSSPOIMN",90,0)
 W !!!?3,"Enter ?? for Pharmacy Orderable Item List!",!
"RTN","PSSPOIMN",91,0)
 K DIC S DIC="^PS(50.7,",DIC(0)="QEAM"
"RTN","PSSPOIMN",92,0)
 S DIC("S")="I $P($G(^(0)),""^"",2)=DOSEPTR,$P($G(^(0)),""^"",3)=""""" D ^DIC
"RTN","PSSPOIMN",93,0)
 S PSSDONE=0
"RTN","PSSPOIMN",94,0)
 I Y>0 D  I PSSDONE Q
"RTN","PSSPOIMN",95,0)
 .S (NEWSP,PSSP)=+Y D ^PSSPOIM1 G:PSNO LOOK I PSOUT Q
"RTN","PSSPOIMN",96,0)
 .;Checking whether the Orderable Item would have duplicate IV Solution Volumes
"RTN","PSSPOIMN",97,0)
 .I $$CKDUPVOL(+NEWSP,PSIEN) Q
"RTN","PSSPOIMN",98,0)
 .S DIE="^PSDRUG(",DA=PSIEN,DR="2.1////"_NEWSP D ^DIE S PSITEM=NEWSP D COM S PSSDONE=1
"RTN","PSSPOIMN",99,0)
 I '$D(PSSNOOI) W ! K DIR S DIR(0)="Y",DIR("B")="YES",DIR("A")="Create a new Orderable Item to match" D ^DIR I Y=1 G MCHAN
"RTN","PSSPOIMN",100,0)
 K PSSNOOI
"RTN","PSSPOIMN",101,0)
 Q
"RTN","PSSPOIMN",102,0)
COM W !,"Match Complete!",! D EN^PSSPOIM1(PSITEM) Q
"RTN","PSSPOIMN",103,0)
 ;
"RTN","PSSPOIMN",104,0)
SET ;
"RTN","PSSPOIMN",105,0)
 S PSSDXLF=1,PSSDXL=+$P($G(^PS(50.7,+$G(POINT),0)),"^",2)
"RTN","PSSPOIMN",106,0)
 Q
"RTN","PSSPOIMN",107,0)
SETX ;
"RTN","PSSPOIMN",108,0)
 I $G(PSSDXLF),$G(PSSDXL),$G(PSITEM),$G(PSSDXL)'=+$P($G(^PS(50.7,+$G(PSITEM),0)),"^",2) K ^PSDRUG(PSIEN,"DOS2") I $G(PSIEN) D EN2^PSSUTIL(PSIEN,1)
"RTN","PSSPOIMN",109,0)
 K PSSDXL,PSSDXLF
"RTN","PSSPOIMN",110,0)
 Q
"RTN","PSSPOIMN",111,0)
MORE ;Show Additives and Solutions
"RTN","PSSPOIMN",112,0)
 Q:'$G(PSIEN)
"RTN","PSSPOIMN",113,0)
 N PSSMORA,PSSMORS,PSSMZ,PSSMZOUT,PSSMODT
"RTN","PSSPOIMN",114,0)
 S (PSSMORA,PSSMORS,PSSMZOUT)=0
"RTN","PSSPOIMN",115,0)
 I $O(^PS(52.6,"AC",PSIEN,0)) S PSSMORA=1
"RTN","PSSPOIMN",116,0)
 I $O(^PS(52.7,"AC",PSIEN,0)) S PSSMORS=1
"RTN","PSSPOIMN",117,0)
 I 'PSSMORA,'PSSMORS Q
"RTN","PSSPOIMN",118,0)
 W !!!,"There are "_$S('$G(PSSMORS):"IV Additives",'$G(PSSMORA):"IV Solutions",1:"IV Additives and IV Solutions")_" tied to this Dispense Drug."
"RTN","PSSPOIMN",119,0)
 W !,"By rematching the Dispense Drug to a new Pharmacy Orderable Item, all of these",!,$S('$G(PSSMORS):"IV Additives",'$G(PSSMORA):"IV Solutions",1:"IV Additives and IV Solutions")_" will also be rematched to the new Orderable Item.",!
"RTN","PSSPOIMN",120,0)
 K DIR S DIR(0)="E",DIR("A")="Press Return to see "_$S('$G(PSSMORS):"IV Additive",'$G(PSSMORA):"IV Solution",1:"IV Additive/Solution")_" list" D ^DIR I Y'=1 W ! Q
"RTN","PSSPOIMN",121,0)
 W @IOF
"RTN","PSSPOIMN",122,0)
 W !,$S('$G(PSSMORA):"IV Solutions",'$G(PSSMORS):"IV Additives",1:"IV Additives/Solutions"),!,"------------" I $G(PSSMORS),$G(PSSMORA) W "----------"
"RTN","PSSPOIMN",123,0)
 I $G(PSSMORA) D  G:$G(PSSMZOUT) MOREZ
"RTN","PSSPOIMN",124,0)
 .F PSSMZ=0:0 S PSSMZ=$O(^PS(52.6,"AC",PSIEN,PSSMZ)) Q:'PSSMZ!($G(PSSMZOUT))  D
"RTN","PSSPOIMN",125,0)
 ..D:($Y+5)>IOSL MOREH Q:$G(PSSMZOUT)
"RTN","PSSPOIMN",126,0)
 ..W !,$P($G(^PS(52.6,PSSMZ,0)),"^"),?42,"(A)"
"RTN","PSSPOIMN",127,0)
 ..S PSSMODT=$P($G(^PS(52.6,PSSMZ,"I")),"^") I PSSMODT D MODT
"RTN","PSSPOIMN",128,0)
 ;I $G(PSSMORA),$G(PSSMORS) W !
"RTN","PSSPOIMN",129,0)
 I $G(PSSMORS) D
"RTN","PSSPOIMN",130,0)
 .F PSSMZ=0:0 S PSSMZ=$O(^PS(52.7,"AC",PSIEN,PSSMZ)) Q:'PSSMZ!($G(PSSMZOUT))  D
"RTN","PSSPOIMN",131,0)
 ..D:($Y+5)>IOSL MOREH Q:$G(PSSMZOUT)
"RTN","PSSPOIMN",132,0)
 ..W !,$P($G(^PS(52.7,PSSMZ,0)),"^"),?31,$P($G(^(0)),"^",3),?42,"(S)"
"RTN","PSSPOIMN",133,0)
 ..S PSSMODT=$P($G(^PS(52.7,PSSMZ,"I")),"^") I PSSMODT D MODT
"RTN","PSSPOIMN",134,0)
MOREZ ;
"RTN","PSSPOIMN",135,0)
 I '$G(PSSMZOUT) W ! K DIR S DIR(0)="E",DIR("A")="Press RETURN to continue" D ^DIR K DIR
"RTN","PSSPOIMN",136,0)
 Q
"RTN","PSSPOIMN",137,0)
 ;
"RTN","PSSPOIMN",138,0)
MOREH ;
"RTN","PSSPOIMN",139,0)
 W ! K DIR S DIR(0)="E",DIR("A")="Press RETURN to continue" D ^DIR K DIR I 'Y S PSSMZOUT=1 Q
"RTN","PSSPOIMN",140,0)
 W @IOF
"RTN","PSSPOIMN",141,0)
 Q
"RTN","PSSPOIMN",142,0)
MODT ;
"RTN","PSSPOIMN",143,0)
 S Y=$G(PSSMODT) I $G(Y) D DD^%DT W ?50,$G(Y) K Y
"RTN","PSSPOIMN",144,0)
 Q
"RTN","PSSPOIMN",145,0)
 ;
"RTN","PSSPOIMN",146,0)
CKDUPVOL(OIIEN,DRUGIEN) ; Checks OI to see if it will have duplicate IV Solution Volumes
"RTN","PSSPOIMN",147,0)
 ; Input: OIIEN   - PHARMACY ORDERABLE ITEM File (#50.7) IEN
"RTN","PSSPOIMN",148,0)
 ;        DRUGIEN - DRUG File (#50) IEN
"RTN","PSSPOIMN",149,0)
 ;Output: DUPVOL  - 0: No Duplicate Volume / 1: Duplicate Volume
"RTN","PSSPOIMN",150,0)
 N DUPVOL,IVSOL,PSSQUIT S (IVSOL,DUPVOL)=0
"RTN","PSSPOIMN",151,0)
 F  S IVSOL=$O(^PS(52.7,"AC",DRUGIEN,IVSOL)) Q:'IVSOL  D  I DUPVOL Q
"RTN","PSSPOIMN",152,0)
 .; IV Solution field USED IN IV FLUID ORDER ENTRY set to 'NO'
"RTN","PSSPOIMN",153,0)
 .I '$$GET1^DIQ(52.7,IVSOL,17,"I") Q
"RTN","PSSPOIMN",154,0)
 .; IV Solution is INACTIVE, no issues
"RTN","PSSPOIMN",155,0)
 .I $$GET1^DIQ(52.7,IVSOL,8,"I"),$$GET1^DIQ(52.7,IVSOL,8,"I")'>DT Q
"RTN","PSSPOIMN",156,0)
 .I $$CKDUPSOL^PSSDDUT2(OIIEN,IVSOL,$$GET1^DIQ(52.7,IVSOL,2),0) D
"RTN","PSSPOIMN",157,0)
 ..W !!,"Matching ",$$GET1^DIQ(50,DRUGIEN,.01)," to ",$$GET1^DIQ(50.7,OIIEN,.01)," would cause the"
"RTN","PSSPOIMN",158,0)
 ..W !,"orderable item to have more than one Active IV Solution with the same volume"
"RTN","PSSPOIMN",159,0)
 ..W !,"marked to be used in the IV FLUID ORDER ENTRY, which is not allowed."
"RTN","PSSPOIMN",160,0)
 ..W !,""
"RTN","PSSPOIMN",161,0)
 ..W !,"Please, review the IV Solutions associated with this drug before matching it"
"RTN","PSSPOIMN",162,0)
 ..W !,"to this orderable item or match it to a different orderable item."
"RTN","PSSPOIMN",163,0)
 ..S DUPVOL=1
"RTN","PSSPOIMN",164,0)
 Q DUPVOL
"VER")
8.0^22.2
"BLD",10784,6)
^198
**END**
**END**

