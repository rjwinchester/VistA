Released PSS*1*195 SEQ #181
Extracted from mail message
**KIDS**:PSS*1.0*195^

**INSTALL NAME**
PSS*1.0*195
"BLD",9668,0)
PSS*1.0*195^PHARMACY DATA MANAGEMENT^0^3170525^y
"BLD",9668,4,0)
^9.64PA^59.7^1
"BLD",9668,4,59.7,0)
59.7
"BLD",9668,4,59.7,2,0)
^9.641^59.7^1
"BLD",9668,4,59.7,2,59.7,0)
PHARMACY SYSTEM  (File-top level)
"BLD",9668,4,59.7,2,59.7,1,0)
^9.6411^17^1
"BLD",9668,4,59.7,2,59.7,1,17,0)
PPS-N NATIONAL SQA ACCOUNT
"BLD",9668,4,59.7,222)
y^y^p^^^^n^^n
"BLD",9668,4,59.7,224)

"BLD",9668,4,"APDD",59.7,59.7)

"BLD",9668,4,"APDD",59.7,59.7,17)

"BLD",9668,4,"B",59.7,59.7)

"BLD",9668,6)
9^
"BLD",9668,6.3)
25
"BLD",9668,"KRN",0)
^9.67PA^779.2^20
"BLD",9668,"KRN",.4,0)
.4
"BLD",9668,"KRN",.401,0)
.401
"BLD",9668,"KRN",.402,0)
.402
"BLD",9668,"KRN",.402,"NM",0)
^9.68A^1^1
"BLD",9668,"KRN",.402,"NM",1,0)
PSSCOMMON    FILE #50^50^0
"BLD",9668,"KRN",.402,"NM","B","PSSCOMMON    FILE #50",1)

"BLD",9668,"KRN",.403,0)
.403
"BLD",9668,"KRN",.5,0)
.5
"BLD",9668,"KRN",.84,0)
.84
"BLD",9668,"KRN",3.6,0)
3.6
"BLD",9668,"KRN",3.8,0)
3.8
"BLD",9668,"KRN",9.2,0)
9.2
"BLD",9668,"KRN",9.8,0)
9.8
"BLD",9668,"KRN",9.8,"NM",0)
^9.68A^4^4
"BLD",9668,"KRN",9.8,"NM",1,0)
PSSLOOK^^0^B130430402
"BLD",9668,"KRN",9.8,"NM",2,0)
PSSDRDOS^^0^B159075215
"BLD",9668,"KRN",9.8,"NM",3,0)
PSSDRDO2^^0^B6056930
"BLD",9668,"KRN",9.8,"NM",4,0)
PSSDEE^^0^B149682695
"BLD",9668,"KRN",9.8,"NM","B","PSSDEE",4)

"BLD",9668,"KRN",9.8,"NM","B","PSSDRDO2",3)

"BLD",9668,"KRN",9.8,"NM","B","PSSDRDOS",2)

"BLD",9668,"KRN",9.8,"NM","B","PSSLOOK",1)

"BLD",9668,"KRN",19,0)
19
"BLD",9668,"KRN",19,"NM",0)
^9.68A^^
"BLD",9668,"KRN",19.1,0)
19.1
"BLD",9668,"KRN",101,0)
101
"BLD",9668,"KRN",409.61,0)
409.61
"BLD",9668,"KRN",771,0)
771
"BLD",9668,"KRN",779.2,0)
779.2
"BLD",9668,"KRN",870,0)
870
"BLD",9668,"KRN",8989.51,0)
8989.51
"BLD",9668,"KRN",8989.52,0)
8989.52
"BLD",9668,"KRN",8994,0)
8994
"BLD",9668,"KRN","B",.4,.4)

"BLD",9668,"KRN","B",.401,.401)

"BLD",9668,"KRN","B",.402,.402)

"BLD",9668,"KRN","B",.403,.403)

"BLD",9668,"KRN","B",.5,.5)

"BLD",9668,"KRN","B",.84,.84)

"BLD",9668,"KRN","B",3.6,3.6)

"BLD",9668,"KRN","B",3.8,3.8)

"BLD",9668,"KRN","B",9.2,9.2)

"BLD",9668,"KRN","B",9.8,9.8)

"BLD",9668,"KRN","B",19,19)

"BLD",9668,"KRN","B",19.1,19.1)

"BLD",9668,"KRN","B",101,101)

"BLD",9668,"KRN","B",409.61,409.61)

"BLD",9668,"KRN","B",771,771)

"BLD",9668,"KRN","B",779.2,779.2)

"BLD",9668,"KRN","B",870,870)

"BLD",9668,"KRN","B",8989.51,8989.51)

"BLD",9668,"KRN","B",8989.52,8989.52)

"BLD",9668,"KRN","B",8994,8994)

"BLD",9668,"QUES",0)
^9.62^^
"BLD",9668,"REQB",0)
^9.611^6^4
"BLD",9668,"REQB",3,0)
PSS*1.0*173^2
"BLD",9668,"REQB",4,0)
PSS*1.0*189^2
"BLD",9668,"REQB",5,0)
PSS*1.0*207^2
"BLD",9668,"REQB",6,0)
PSN*4.0*396^2
"BLD",9668,"REQB","B","PSN*4.0*396",6)

"BLD",9668,"REQB","B","PSS*1.0*173",3)

"BLD",9668,"REQB","B","PSS*1.0*189",4)

"BLD",9668,"REQB","B","PSS*1.0*207",5)

"FIA",59.7)
PHARMACY SYSTEM
"FIA",59.7,0)
^PS(59.7,
"FIA",59.7,0,0)
59.7
"FIA",59.7,0,1)
y^y^p^^^^n^^n
"FIA",59.7,0,10)

"FIA",59.7,0,11)

"FIA",59.7,0,"RLRO")

"FIA",59.7,0,"VR")
1.0^PSS
"FIA",59.7,59.7)
1
"FIA",59.7,59.7,17)

"KRN",.402,1998,-1)
0^1
"KRN",.402,1998,0)
PSSCOMMON^3170523.1648^@^50^^@^3170523
"KRN",.402,1998,"DIAB",1,1,50.037,0)
ALL
"KRN",.402,1998,"DIAB",1,1,50.065,0)
ALL
"KRN",.402,1998,"DIAB",6,0,50,0)
84;"ePharmacy Billable"
"KRN",.402,1998,"DIAB",7,0,50,0)
85;"  ePharmacy Billable (TRICARE)"
"KRN",.402,1998,"DIAB",8,0,50,0)
86;"  ePharmacy Billable (CHAMPVA)"
"KRN",.402,1998,"DIAB",9,0,50,0)
87;"Sensitive Diagnosis Drug"
"KRN",.402,1998,"DR",1,50)
.01;2;D PKIND^PSSDDUT2;3;W !;84ePharmacy Billable~;85  ePharmacy Billable (TRICARE)~;86  ePharmacy Billable (CHAMPVA)~;87Sensitive Diagnosis Drug~;81;D PKIND^PSSDDUT2;
"KRN",.402,1998,"DR",1,50,1)
W !!,"NATIONAL FORMULARY INDICATOR: " W:$P($G(^PSDRUG(DA,"ND")),"^",11)=1 "YES" W:$P($G(^PSDRUG(DA,"ND")),"^",11)="" "Not Matched To NDF" W:$P($G(^PSDRUG(DA,"ND")),"^",11)=0 "NO";D FD^PSSDEE(DA);D CPTIER^PSSDEE(DA);51;52;37;65;9;
"KRN",.402,1998,"DR",1,50,2)
101;102;6;31;100;N ND S ND=$G(^PSDRUG(DA,"ND")) I +ND,+$P(ND,"^",3),+$P($G(^PSNDF(50.68,+$P(ND,"^",3),"PFS")),"^") S Y="@4";W !!,"If you are planning to match to a NDF entry later or have no plan of using";
"KRN",.402,1998,"DR",1,50,3)
W !,"the external billing function, you may skip the Service Code entry.";W !!,"Unmatched items that are not copay exempt (ie. Supplies) default to Tier 2";400;@4;
"KRN",.402,1998,"DR",1,50,4)
S PSONEWW=$S($P($G(^PS(59.7,1,10)),"^",9)="N":1,1:0) W !!,"WARNING LABEL SOURCE is "_$S(PSONEWW:"'NEW'.",1:"not 'NEW'.");
"KRN",.402,1998,"DR",1,50,5)
I PSONEWW W !,"The following WARNING LABEL may continue to be used for a limited time for some external interfaces.";I 'PSONEWW W !,"WARNING LABEL will be used until the WARNING LABEL SOURCE is set to 'NEW'.";8;@5;
"KRN",.402,1998,"DR",1,50,6)
D WARN^PSSWRNB S:$G(WARNEDIT) Y="@10" I '$G(WARNEDIT) S Y="@15";@10;8.1;S Y="@5";@15;D GENDER2^PSSWRNA I GENDER="" S Y="@20";8.2;@20;12;13;14.5;15;D NCINIT^PSSDDUT2 S Y="@24";@24;82;D NCPDPDU^PSSDDUT2 S PSSNDU=X S Y="@25";@25;83;
"KRN",.402,1998,"DR",1,50,7)
66;
"KRN",.402,1998,"DR",2,50.037)
.01
"KRN",.402,1998,"DR",2,50.065)
.01
"KRN",.402,1998,"DR",2,50.1)
.01;1;2;
"MBREQ")
0
"ORD",7,.402)
.402;7;;;EDEOUT^DIFROMSO(.402,DA,"",XPDA);FPRE^DIFROMSI(.402,"",XPDA);EPRE^DIFROMSI(.402,DA,$E("N",$G(XPDNEW)),XPDA,"",OLDA);;EPOST^DIFROMSI(.402,DA,"",XPDA);DEL^DIFROMSK(.402,"",%)
"ORD",7,.402,0)
INPUT TEMPLATE
"PKG",517,-1)
1^1
"PKG",517,0)
PHARMACY DATA MANAGEMENT^PSS^Maintenance of Pharmacy files.
"PKG",517,20,0)
^9.402P^^
"PKG",517,22,0)
^9.49I^1^1
"PKG",517,22,1,0)
1.0^2970930^2971014^11595
"PKG",517,22,1,"PAH",1,0)
195^3170525^10000000068
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
4
"RTN","PSSDEE")
0^4^B149682695^B142583898
"RTN","PSSDEE",1,0)
PSSDEE ;BIR/WRT-MASTER DRUG ENTER/EDIT ROUTINE ;01/21/00
"RTN","PSSDEE",2,0)
 ;;1.0;PHARMACY DATA MANAGEMENT;**3,5,15,16,20,22,28,32,34,33,38,57,47,68,61,82,90,110,155,156,180,193,200,207,195**;9/30/97;Build 25
"RTN","PSSDEE",3,0)
 ;
"RTN","PSSDEE",4,0)
 ;Reference to ^PS(59 supported by DBIA #1976
"RTN","PSSDEE",5,0)
 ;Reference to REACT1^PSNOUT supported by DBIA #2080
"RTN","PSSDEE",6,0)
 ;Reference to $$UP^XLFSTR(X) supported by DBIA #10104
"RTN","PSSDEE",7,0)
 ;Reference to $$PSJDF^PSNAPIS(P1,P3) supported by DBIA #2531
"RTN","PSSDEE",8,0)
 ;Reference to PSNAPIS supported by DBIA #2531
"RTN","PSSDEE",9,0)
 ;Reference to ^XMB("NETNAME" supported by DBIA #1131
"RTN","PSSDEE",10,0)
 ;Reference to ^XUSEC supported by DIBA #10076
"RTN","PSSDEE",11,0)
 ;Reference to FDR & FDT^PSNACT supported by DBIA #6754
"RTN","PSSDEE",12,0)
 ;
"RTN","PSSDEE",13,0)
BEGIN N PSSUPRAF,PSSTDRUG
"RTN","PSSDEE",14,0)
 S PSSFLAG=0 D ^PSSDEE2 S PSSZ=1 F PSSXX=1:1 K DA D ASK Q:PSSFLAG
"RTN","PSSDEE",15,0)
DONE D ^PSSDEE2 K PSSFLAGK,PSSXX,DIE,DIR,CLFLAG,CLFALG,DISPDRG,DLAYGO,DR,ENTRY,FLAG,FLG1,FLG2,FLG4,FLG5,FLG6,FLG7,FLGKY,FLGMTH,FLGNDF,FLGOI,K,NEWDF
"RTN","PSSDEE",16,0)
 K NFLAG,NWND,NWPC1,NWPC2,NWPC3OLDDF,PSIUDA,PSIUX,PSNP,PSSANS,PSSASK,PSSDA,PSSDD,PSSFLAG,PSSOR,PSSZ,PSXBT,PSXF,PSXFL,PSXUM,PSXGOOD,PSXLOC,ZAPFLG
"RTN","PSSDEE",17,0)
 Q
"RTN","PSSDEE",18,0)
ASK ;
"RTN","PSSDEE",19,0)
 W ! S DIC="^PSDRUG(",DIC(0)="QEALMNTV",DLAYGO=50,DIC("T")="",DIC("W")="S PSSTDRUG=Y D GETTIER^PSSDEE(PSSTDRUG)" D ^DIC K DIC I Y<0 S PSSFLAG=1 Q
"RTN","PSSDEE",20,0)
 N PSINACT S (FLG1,FLG2,FLG3,FLG4,FLG5,FLG6,FLG7,FLAG,FLGKY,FLGOI,PSINACT)=0 K ^TMP($J,"ADD"),^TMP($J,"SOL")
"RTN","PSSDEE",21,0)
 S DA=+Y,DISPDRG=DA L +^PSDRUG(DISPDRG):0 I '$T W !,$C(7),"Another person is editing this one." Q
"RTN","PSSDEE",22,0)
 I $G(^PSDRUG(DA,"I")) S PSINACT=$G(^PSDRUG(DA,"I")) I PSINACT,PSINACT<DT S PSINACT=1  ;;<<*180 - RJS
"RTN","PSSDEE",23,0)
 S PSSHUIDG=1,PSSNEW=$P(Y,"^",3) D USE,NOPE,COMMON,DEA,MF K PSSHUIDG,PSSUPRAF
"RTN","PSSDEE",24,0)
 ; if any outpatient site has a dispense machine running HL7 V.2.4, then
"RTN","PSSDEE",25,0)
 ; run the new routine and create message
"RTN","PSSDEE",26,0)
 N XX,DNSNAM,DNSPORT,DVER,DMFU,PSSUPRA S XX=""
"RTN","PSSDEE",27,0)
 F XX=0:0 S XX=$O(^PS(59,XX)) Q:'XX  D
"RTN","PSSDEE",28,0)
 .S DVER=$$GET1^DIQ(59,XX_",",105,"I"),DMFU=$$GET1^DIQ(59,XX_",",105.2)
"RTN","PSSDEE",29,0)
 .S DNSNAM=$$GET1^DIQ(59,XX_",",2006),DNSPORT=$$GET1^DIQ(59,XX_",",2007)
"RTN","PSSDEE",30,0)
 .D:DVER="2.4"&(DNSNAM'="")&(DMFU="YES") DRG^PSSDGUPD(DISPDRG,PSSNEW,DNSNAM,DNSPORT)
"RTN","PSSDEE",31,0)
 D DRG^PSSHUIDG(DISPDRG,PSSNEW) L -^PSDRUG(DISPDRG)
"RTN","PSSDEE",32,0)
 S XX=$P($G(^PSDRUG(DISPDRG,2)),"^",3) I XX["U"!(XX["I") D  S XX=""
"RTN","PSSDEE",33,0)
 .S XX=$$SNDHL7^PSSMSTR() D:XX
"RTN","PSSDEE",34,0)
 ..Q:PSSNEW&'((XX=2)!(XX=3))  ;U=1,N=2,B=3
"RTN","PSSDEE",35,0)
 ..Q:'PSSNEW&(XX=2)  ;U=1,N=2,B=3
"RTN","PSSDEE",36,0)
 ..N VAR
"RTN","PSSDEE",37,0)
 ..I PSSNEW&((XX=2)!(XX=3)) S VAR="Would you like to send this new drug to PADE"
"RTN","PSSDEE",38,0)
 ..E  S VAR="Would you like to send a drug file update to PADE"
"RTN","PSSDEE",39,0)
 ..W !!,"This drug is marked for either UD or IV use, and you have at least"
"RTN","PSSDEE",40,0)
 ..W !,"one active Pharmacy Automated Dispensing Equipment (PADE)."
"RTN","PSSDEE",41,0)
 ..K DIR,DIRUT,DUOUT,DTOUT
"RTN","PSSDEE",42,0)
 ..S DIR(0)="Y",DIR("A")=VAR
"RTN","PSSDEE",43,0)
 ..S DIR("?")="Enter Y for Yes or N for No." D ^DIR K DIR
"RTN","PSSDEE",44,0)
 ..Q:'Y
"RTN","PSSDEE",45,0)
 ..N PSSPADE S PSSPADE=1 S XX=""
"RTN","PSSDEE",46,0)
 ..D ENP^PSSHLDFS(DISPDRG,$S(PSSNEW:"MAD",1:"MUP"))
"RTN","PSSDEE",47,0)
 K FLG3,PSSNEW
"RTN","PSSDEE",48,0)
 Q
"RTN","PSSDEE",49,0)
COMMON S DIE="^PSDRUG(",DR="[PSSCOMMON]" D ^DIE Q:$D(Y)!($D(DTOUT))  W:'$D(Y) !,"PRICE PER DISPENSE UNIT: " S:'$D(^PSDRUG(DA,660)) $P(^PSDRUG(DA,660),"^",6)="" W:'$D(Y) $P(^PSDRUG(DA,660),"^",6)
"RTN","PSSDEE",50,0)
 D DEA,CK,ASKND,OIKILL^PSSDEE1,COMMON1
"RTN","PSSDEE",51,0)
 Q
"RTN","PSSDEE",52,0)
COMMON1 W !,"Just a reminder...you are editing ",$P(^PSDRUG(DISPDRG,0),"^"),"."
"RTN","PSSDEE",53,0)
 S (PSSVVDA,DA)=DISPDRG D DOSN^PSSDOS S DA=PSSVVDA K PSSVVDA D USE,APP,ORDITM^PSSDEE1
"RTN","PSSDEE",54,0)
 Q
"RTN","PSSDEE",55,0)
CK D DSPY^PSSDEE1 S FLGNDF=0
"RTN","PSSDEE",56,0)
 Q
"RTN","PSSDEE",57,0)
ASKND S %=-1 I $D(^XUSEC("PSNMGR",DUZ)) D MESSAGE^PSSDEE1 W !!,"Do you wish to match/rematch to NATIONAL DRUG file" S %=1 S:FLGMTH=1 %=2 D YN^DICN
"RTN","PSSDEE",58,0)
 I %=0 W !,"If you answer ""yes"", you will attempt to match to NDF." G ASKND
"RTN","PSSDEE",59,0)
 S PSSUPRAF=%
"RTN","PSSDEE",60,0)
 I %=2 K X,Y Q
"RTN","PSSDEE",61,0)
 I %<0 K X,Y Q
"RTN","PSSDEE",62,0)
 I %=1 D  ;;<<*180 - RJS
"RTN","PSSDEE",63,0)
 .D RSET^PSSDEE1
"RTN","PSSDEE",64,0)
 .I 'PSINACT D EN1^PSSUTIL(DISPDRG,1)
"RTN","PSSDEE",65,0)
 .S X="PSNOUT" X ^%ZOSF("TEST") I  D REACT1^PSNOUT S DA=DISPDRG I $D(^PSDRUG(DA,"ND")),$P(^PSDRUG(DA,"ND"),"^",2)]"" D ONE
"RTN","PSSDEE",66,0)
 Q  ;;<< *180 - RJS
"RTN","PSSDEE",67,0)
ONE S PSNP=$G(^PSDRUG(DA,"I")) I PSNP,PSNP<DT Q
"RTN","PSSDEE",68,0)
 W !,"You have just VERIFIED this match and MERGED the entry." D CKDF D EN2^PSSUTIL(DISPDRG,1) S:'$D(OLDDF) OLDDF="" I OLDDF'=NEWDF S FLGNDF=1 D WR
"RTN","PSSDEE",69,0)
 Q
"RTN","PSSDEE",70,0)
CKDF S NWND=^PSDRUG(DA,"ND"),NWPC1=$P(NWND,"^",1),NWPC3=$P(NWND,"^",3),DA=NWPC1,K=NWPC3 S X=$$PSJDF^PSNAPIS(DA,K) S NEWDF=$P(X,"^",2),DA=DISPDRG
"RTN","PSSDEE",71,0)
 N PSSK D PKIND^PSSDDUT2
"RTN","PSSDEE",72,0)
 Q
"RTN","PSSDEE",73,0)
NOPE S ZAPFLG=0 I '$D(^PSDRUG(DA,"ND")),$D(^PSDRUG(DA,2)),$P(^PSDRUG(DA,2),"^",1)']"" D DFNULL
"RTN","PSSDEE",74,0)
 I '$D(^PSDRUG(DA,"ND")),'$D(^PSDRUG(DA,2)) D DFNULL
"RTN","PSSDEE",75,0)
 I $D(^PSDRUG(DA,"ND")),$P(^PSDRUG(DA,"ND"),"^",2)']"",$D(^PSDRUG(DA,2)),$P(^PSDRUG(DA,2),"^",1)']"" D DFNULL
"RTN","PSSDEE",76,0)
 Q
"RTN","PSSDEE",77,0)
DFNULL S OLDDF="",ZAPFLG=1
"RTN","PSSDEE",78,0)
 Q
"RTN","PSSDEE",79,0)
ZAPIT I $D(ZAPFLG),ZAPFLG=1,FLGNDF=1,OLDDF'=NEWDF D CKIV^PSSDEE1
"RTN","PSSDEE",80,0)
 Q
"RTN","PSSDEE",81,0)
APP W !!,"MARK THIS DRUG AND EDIT IT FOR: " D CHOOSE
"RTN","PSSDEE",82,0)
 Q
"RTN","PSSDEE",83,0)
CHOOSE I $D(^XUSEC("PSORPH",DUZ))!($D(^XUSEC("PSXCMOPMGR",DUZ))) W !,"O  - Outpatient" S FLG1=1
"RTN","PSSDEE",84,0)
 I $D(^XUSEC("PSJU MGR",DUZ)) W !,"U  - Unit Dose" S FLG2=1
"RTN","PSSDEE",85,0)
 I $D(^XUSEC("PSJI MGR",DUZ)) W !,"I  - IV" S FLG3=1
"RTN","PSSDEE",86,0)
 I $D(^XUSEC("PSGWMGR",DUZ)) W !,"W  - Ward Stock" S FLG4=1
"RTN","PSSDEE",87,0)
 I $D(^XUSEC("PSAMGR",DUZ))!($D(^XUSEC("PSA ORDERS",DUZ))) W !,"D  - Drug Accountability" S FLG5=1
"RTN","PSSDEE",88,0)
 I $D(^XUSEC("PSDMGR",DUZ)) W !,"C  - Controlled Substances" S FLG6=1
"RTN","PSSDEE",89,0)
 I $D(^XUSEC("PSORPH",DUZ)) W !,"X  - Non-VA Med" S FLG7=1
"RTN","PSSDEE",90,0)
 I FLG1,FLG2,FLG3,FLG4,FLG5,FLG6 S FLAG=1
"RTN","PSSDEE",91,0)
 I FLAG W !,"A  - ALL"
"RTN","PSSDEE",92,0)
 W !
"RTN","PSSDEE",93,0)
 I 'FLG1,'FLG2,'FLG3,'FLG4,'FLG5,'FLG6,'FLG7 W !,"You do not have the proper keys to continue. Sorry, this concludes your editing session.",! S FLGKY=1 K DIRUT,X Q
"RTN","PSSDEE",94,0)
 I FLGKY'=1 D
"RTN","PSSDEE",95,0)
 . K DIR S DIR(0)="FO^1:30"
"RTN","PSSDEE",96,0)
 . S DIR("A")="Enter your choice(s) separated by commas "
"RTN","PSSDEE",97,0)
 . F  D ^DIR Q:$$CHECK($$UP^XLFSTR(X))
"RTN","PSSDEE",98,0)
 . S PSSANS=X,PSSANS=$$UP^XLFSTR(PSSANS) D BRANCH,BRANCH1
"RTN","PSSDEE",99,0)
 Q
"RTN","PSSDEE",100,0)
 ;
"RTN","PSSDEE",101,0)
CHECK(X) ; Validates Application Use response
"RTN","PSSDEE",102,0)
 N CHECK,I,C
"RTN","PSSDEE",103,0)
 S CHECK=1 I X=""!(Y["^")!($D(DIRUT)) Q CHECK
"RTN","PSSDEE",104,0)
 F I=1:1:$L(X,",") D
"RTN","PSSDEE",105,0)
 . S C=$P(X,",",I) W !?43,C," - "
"RTN","PSSDEE",106,0)
 . I C="O",FLG1 W "Outpatient" Q
"RTN","PSSDEE",107,0)
 . I C="U",FLG2 W "Unit Dose" Q
"RTN","PSSDEE",108,0)
 . I C="I",FLG3 W "IV" Q
"RTN","PSSDEE",109,0)
 . I C="W",FLG4 W "Ward Stock" Q
"RTN","PSSDEE",110,0)
 . I C="D",FLG5 W "Drug Accountability" Q
"RTN","PSSDEE",111,0)
 . I C="C",FLG6 W "Controlled Substances" Q
"RTN","PSSDEE",112,0)
 . I C="X",FLG7 W "Non-VA Med" Q
"RTN","PSSDEE",113,0)
 . W "Invalid Entry",$C(7) S CHECK=0
"RTN","PSSDEE",114,0)
 Q CHECK
"RTN","PSSDEE",115,0)
BRANCH D:PSSANS["O" OP D:PSSANS["U" UD D:PSSANS["I" IV D:PSSANS["W" WS
"RTN","PSSDEE",116,0)
 D:PSSANS["D" DACCT D:PSSANS["C" CS D:PSSANS["X" NVM
"RTN","PSSDEE",117,0)
 Q
"RTN","PSSDEE",118,0)
BRANCH1 I FLAG,PSSANS["A" D OP,UD,IV,WS,DACCT,CS,NVM
"RTN","PSSDEE",119,0)
 Q
"RTN","PSSDEE",120,0)
OP I FLG1 D
"RTN","PSSDEE",121,0)
 . W !,"** You are NOW editing OUTPATIENT fields. **"
"RTN","PSSDEE",122,0)
 . S PSIUDA=DA,PSIUX="O^Outpatient Pharmacy" D ^PSSGIU
"RTN","PSSDEE",123,0)
 . I %=1 D
"RTN","PSSDEE",124,0)
 . . S DIE="^PSDRUG(",DR="[PSSOP]" D ^DIE K DIR D OPEI,ASKCMOP
"RTN","PSSDEE",125,0)
 . . S X="PSOCLO1" X ^%ZOSF("TEST") I  D ASKCLOZ S FLGOI=1
"RTN","PSSDEE",126,0)
 I FLG1 D CKCMOP
"RTN","PSSDEE",127,0)
 Q
"RTN","PSSDEE",128,0)
CKCMOP I $P($G(^PSDRUG(DISPDRG,2)),"^",3)'["O" S:$D(^PSDRUG(DISPDRG,3)) $P(^PSDRUG(DISPDRG,3),"^",1)=0 K:$D(^PSDRUG("AQ",DISPDRG)) ^PSDRUG("AQ",DISPDRG) S DA=DISPDRG D ^PSSREF
"RTN","PSSDEE",129,0)
 Q
"RTN","PSSDEE",130,0)
UD I FLG2 W !,"** You are NOW editing UNIT DOSE fields. **" S PSIUDA=DA,PSIUX="U^Unit Dose" D ^PSSGIU I %=1 S DIE="^PSDRUG(",DR="62.05;212.2" D ^DIE S DIE="^PSDRUG(",DR="212",DR(2,50.0212)=".01;1" D ^DIE S FLGOI=1
"RTN","PSSDEE",131,0)
 Q
"RTN","PSSDEE",132,0)
IV I FLG3 W !,"** You are NOW editing IV fields. **" S (PSIUDA,PSSDA)=DA,PSIUX="I^IV" D ^PSSGIU I %=1 D IV1 S FLGOI=1
"RTN","PSSDEE",133,0)
 Q
"RTN","PSSDEE",134,0)
IV1 K PSSIVOUT ;This variable controls the selection process loop.
"RTN","PSSDEE",135,0)
 W !,"Edit Additives or Solutions: " K DIR S DIR(0)="SO^A:ADDITIVES;S:SOLUTIONS;" D ^DIR Q:$D(DIRUT)  S PSSASK=Y(0) D:PSSASK="ADDITIVES" ENA^PSSVIDRG D:PSSASK="SOLUTIONS" ENS^PSSVIDRG I '$D(PSSIVOUT) G IV1
"RTN","PSSDEE",136,0)
 K PSSIVOUT
"RTN","PSSDEE",137,0)
 Q
"RTN","PSSDEE",138,0)
WS I FLG4 W !,"** You are NOW editing WARD STOCK fields. **" S DIE="^PSDRUG(",DR="300;301;302" D ^DIE
"RTN","PSSDEE",139,0)
 Q
"RTN","PSSDEE",140,0)
DACCT I FLG5 W !,"** You are NOW editing DRUG ACCOUNTABILITY fields. **" S DIE="^PSDRUG(",DR="441" D ^DIE S DIE="^PSDRUG(",DR="9",DR(2,50.1)="1;2;400;401;402;403;404;405" D ^DIE
"RTN","PSSDEE",141,0)
 Q
"RTN","PSSDEE",142,0)
CS I FLG6 W !,"** You are NOW Marking/Unmarking for CONTROLLED SUBS. **" S PSIUDA=DA,PSIUX="N^Controlled Substances" D ^PSSGIU
"RTN","PSSDEE",143,0)
 Q
"RTN","PSSDEE",144,0)
NVM I FLG7 W !,"** You are NOW Marking/Unmarking for NON-VA MEDS. **" S PSIUDA=DA,PSIUX="X^Non-VA Med" D ^PSSGIU
"RTN","PSSDEE",145,0)
 Q
"RTN","PSSDEE",146,0)
ASKCMOP I $D(^XUSEC("PSXCMOPMGR",DUZ)) W !!,"Do you wish to mark to transmit to CMOP? " K DIR S DIR(0)="Y",DIR("?")="If you answer ""yes"", you will attempt to mark this drug to transmit to CMOP."
"RTN","PSSDEE",147,0)
 D ^DIR I "Nn"[X K X,Y,DIRUT Q
"RTN","PSSDEE",148,0)
 I "Yy"[X S PSXFL=0 D TEXT^PSSMARK H 7 N PSXUDA S (PSXUM,PSXUDA)=DA,PSXLOC=$P(^PSDRUG(DA,0),"^"),PSXGOOD=0,PSXF=0,PSXBT=0 D BLD^PSSMARK,PICK2^PSSMARK S DA=PSXUDA
"RTN","PSSDEE",149,0)
 Q
"RTN","PSSDEE",150,0)
ASKCLOZ W !!,"Do you wish to mark/unmark as a LAB MONITOR or CLOZAPINE DRUG? " K DIR S DIR(0)="Y",DIR("?")="If you answer ""yes"", you will have the opportunity to edit LAB MONITOR or CLOZAPINE fields."
"RTN","PSSDEE",151,0)
 D ^DIR I "Nn"[X K X,Y,DIRUT Q
"RTN","PSSDEE",152,0)
 I "Yy"[X S NFLAG=0 D MONCLOZ
"RTN","PSSDEE",153,0)
 Q
"RTN","PSSDEE",154,0)
MONCLOZ K PSSAST D FLASH W !,"Mark/Unmark for Lab Monitor or Clozapine: " K DIR S DIR(0)="S^L:LAB MONITOR;C:CLOZAPINE;" D ^DIR Q:$D(DIRUT)  S PSSAST=Y(0) D:PSSAST="LAB MONITOR" ^PSSLAB D:PSSAST="CLOZAPINE" CLOZ
"RTN","PSSDEE",155,0)
 Q
"RTN","PSSDEE",156,0)
FLASH K LMFLAG,CLFALG,WHICH S WHICH=$P($G(^PSDRUG(DISPDRG,"CLOZ1")),"^"),LMFLAG=0,CLFLAG=0
"RTN","PSSDEE",157,0)
 I WHICH="PSOCLO1" S CLFLAG=1
"RTN","PSSDEE",158,0)
 I WHICH'="PSOCLO1" S:WHICH'="" LMFLAG=1
"RTN","PSSDEE",159,0)
 Q
"RTN","PSSDEE",160,0)
CLOZ Q:NFLAG  Q:$D(DTOUT)  Q:$D(DIRUT)  Q:$D(DUOUT)  W !,"** You are NOW editing CLOZAPINE fields. **" D ^PSSCLDRG
"RTN","PSSDEE",161,0)
 Q
"RTN","PSSDEE",162,0)
USE K PACK S PACK="" S:$P($G(^PSDRUG(DISPDRG,"PSG")),"^",2)]"" PACK="W" I $D(^PSDRUG(DISPDRG,2)) S PACK=PACK_$P(^PSDRUG(DISPDRG,2),"^",3)
"RTN","PSSDEE",163,0)
 I PACK'="" D
"RTN","PSSDEE",164,0)
 .W $C(7) N XX W !! F XX=1:1:79 W "*"
"RTN","PSSDEE",165,0)
 .W !,"This entry is marked for the following PHARMACY packages: "
"RTN","PSSDEE",166,0)
 .D USE1
"RTN","PSSDEE",167,0)
 Q
"RTN","PSSDEE",168,0)
USE1 W:PACK["O" !," Outpatient" W:PACK["U" !," Unit Dose" W:PACK["I" !," IV"
"RTN","PSSDEE",169,0)
 W:PACK["W" !," Ward Stock" W:PACK["D" !," Drug Accountability"
"RTN","PSSDEE",170,0)
 W:PACK["N" !," Controlled Substances" W:PACK["X" !," Non-VA Med"
"RTN","PSSDEE",171,0)
 W:'$D(PACK) !," NONE"
"RTN","PSSDEE",172,0)
 I PACK'["O",PACK'["U",PACK'["I",PACK'["W",PACK'["D",PACK'["N",PACK'["X" W !," NONE"
"RTN","PSSDEE",173,0)
 Q
"RTN","PSSDEE",174,0)
WR I ^XMB("NETNAME")'["CMOP-" W:OLDDF'="" !,"The dosage form has changed from "_OLDDF_" to "_NEWDF_" due to",!,"matching/rematching to NDF.",!,"You will need to rematch to Orderable Item.",!
"RTN","PSSDEE",175,0)
 Q
"RTN","PSSDEE",176,0)
PRIMDRG I $D(^PS(59.7,1,20)),$P(^PS(59.7,1,20),"^",1)=4!($P(^PS(59.7,1,20),"^",1)=4.5) I $D(^PSDRUG(DISPDRG,2)) S VAR=$P(^PSDRUG(DISPDRG,2),"^",3) I VAR["U"!(VAR["I") D PRIM1
"RTN","PSSDEE",177,0)
 Q
"RTN","PSSDEE",178,0)
PRIM1 W !!,"You need to match this drug to ""PRIMARY DRUG"" file as well.",! S DIE="^PSDRUG(",DR="64",DA=DISPDRG D ^DIE K VAR
"RTN","PSSDEE",179,0)
 Q
"RTN","PSSDEE",180,0)
MF I $P($G(^PS(59.7,1,80)),"^",2)>1 I $D(^PSDRUG(DISPDRG,2)) S PSSOR=$P(^PSDRUG(DISPDRG,2),"^",1) I PSSOR]"" D EN^PSSPOIDT(PSSOR),EN2^PSSHL1(PSSOR,"MUP")
"RTN","PSSDEE",181,0)
 Q
"RTN","PSSDEE",182,0)
MFA I $P($G(^PS(59.7,1,80)),"^",2)>1 S PSSOR=$P(^PS(52.6,ENTRY,0),"^",11),PSSDD=$P(^PS(52.6,ENTRY,0),"^",2) I PSSOR]"" D EN^PSSPOIDT(PSSOR),EN2^PSSHL1(PSSOR,"MUP") D MFDD
"RTN","PSSDEE",183,0)
 Q
"RTN","PSSDEE",184,0)
MFS I $P($G(^PS(59.7,1,80)),"^",2)>1 S PSSOR=$P(^PS(52.7,ENTRY,0),"^",11),PSSDD=$P(^PS(52.7,ENTRY,0),"^",2) I PSSOR]"" D EN^PSSPOIDT(PSSOR),EN2^PSSHL1(PSSOR,"MUP") D MFDD
"RTN","PSSDEE",185,0)
 Q
"RTN","PSSDEE",186,0)
MFDD I $D(^PSDRUG(PSSDD,2)) S PSSOR=$P(^PSDRUG(PSSDD,2),"^",1) I PSSOR]"" D EN^PSSPOIDT(PSSOR),EN2^PSSHL1(PSSOR,"MUP")
"RTN","PSSDEE",187,0)
 Q
"RTN","PSSDEE",188,0)
OPEI ;
"RTN","PSSDEE",189,0)
 S DIE="^PSDRUG(",DR="28",DA=DISPDRG
"RTN","PSSDEE",190,0)
 D ^DIE
"RTN","PSSDEE",191,0)
 Q:'+$P($G(^PSDRUG(DA,6)),"^")
"RTN","PSSDEE",192,0)
OPEI2 ; get external dispensing devices associated with the drug
"RTN","PSSDEE",193,0)
 W !!,"Defining a dispensing device at the drug level for a division will override"
"RTN","PSSDEE",194,0)
 W !,"the dispensing device settings in the OUTPATIENT SITE File (#59). If populated,",!,"the drug will be sent to the dispensing device for that division.",!
"RTN","PSSDEE",195,0)
 S DR="906"
"RTN","PSSDEE",196,0)
 D ^DIE
"RTN","PSSDEE",197,0)
 Q
"RTN","PSSDEE",198,0)
DEA ;
"RTN","PSSDEE",199,0)
 I $P($G(^PSDRUG(DISPDRG,3)),"^")=1,($P(^PSDRUG(DISPDRG,0),"^",3)[1!($P(^(0),"^",3)[2)) D DSH
"RTN","PSSDEE",200,0)
 Q
"RTN","PSSDEE",201,0)
DSH W !!,"****************************************************************************"
"RTN","PSSDEE",202,0)
 W !,"This entry contains a ""1"" or a ""2"" in the ""DEA, SPECIAL HDLG""",!,"field, therefore this item has been UNMARKED for CMOP transmission."
"RTN","PSSDEE",203,0)
 W !,"****************************************************************************",! S $P(^PSDRUG(DISPDRG,3),"^")=0 K ^PSDRUG("AQ",DISPDRG) S DA=DISPDRG N % D ^PSSREF
"RTN","PSSDEE",204,0)
 Q
"RTN","PSSDEE",205,0)
CPTIER(VAPID) ;Called from PSSCOMMON Input Template
"RTN","PSSDEE",206,0)
 ; VAPID = IEN OF DRUG FILE #50
"RTN","PSSDEE",207,0)
 N CPDATE,X,PSSCP D NOW^%DTC S CPDATE=X S PSSCP=$$CPTIER^PSNAPIS("",CPDATE,VAPID,1) K CPDATE,X
"RTN","PSSDEE",208,0)
 ;  PSSCP = Copay Tier^Effective Date^End Date
"RTN","PSSDEE",209,0)
 W !,"Copay Tier: ",$P(PSSCP,"^",1)
"RTN","PSSDEE",210,0)
 W !,"Copay Effective Date: " S Y=$P(PSSCP,"^",2) D DD^%DT W Y K Y,PSSCP
"RTN","PSSDEE",211,0)
 Q
"RTN","PSSDEE",212,0)
 ;
"RTN","PSSDEE",213,0)
GETTIER(PSSTDRUG) ;called by DIC to get copay tier for today's date 
"RTN","PSSDEE",214,0)
 N VAPID,CPDATE,X,PSSCP,VAPROD,PSSDRGCL,PSSCONVD,PSSINACT,PSSFSN,PSSNFORM,PSSMSG,PSSRESTR,PSSDRDAT,PSSFD D NOW^%DTC S CPDATE=X
"RTN","PSSDEE",215,0)
 D GETS^DIQ(50,PSSTDRUG,"2;22;51;6;100;101;102","IE","PSSDRDAT")
"RTN","PSSDEE",216,0)
 S (PSSDRGCL,PSSFSN,PSSNFORM,PSSINACT,PSSMSG,PSSRESTR,VAPROD)=""
"RTN","PSSDEE",217,0)
 S:$G(PSSDRDAT(50,PSSTDRUG_",",2,"E"))'="" PSSDRGCL=PSSDRDAT(50,PSSTDRUG_",",2,"E")
"RTN","PSSDEE",218,0)
 S:$G(PSSDRDAT(50,PSSTDRUG_",",6,"E"))'="" PSSFSN=PSSDRDAT(50,PSSTDRUG_",",6,"E")
"RTN","PSSDEE",219,0)
 S:$G(PSSDRDAT(50,PSSTDRUG_",",51,"E"))'="" PSSNFORM=PSSDRDAT(50,PSSTDRUG_",",51,"E")
"RTN","PSSDEE",220,0)
 S:$G(PSSDRDAT(50,PSSTDRUG_",",100,"I")) PSSINACT=PSSDRDAT(50,PSSTDRUG_",",100,"I")
"RTN","PSSDEE",221,0)
 S:$G(PSSDRDAT(50,PSSTDRUG_",",101,"E"))'="" PSSMSG=PSSDRDAT(50,PSSTDRUG_",",101,"E")
"RTN","PSSDEE",222,0)
 S:$G(PSSDRDAT(50,PSSTDRUG_",",102,"E"))'="" PSSRESTR=PSSDRDAT(50,PSSTDRUG_",",102,"E")
"RTN","PSSDEE",223,0)
 S:$G(PSSDRDAT(50,PSSTDRUG_",",22,"I")) VAPROD=PSSDRDAT(50,PSSTDRUG_",",22,"I")
"RTN","PSSDEE",224,0)
 W " "_$$GET1^DIQ(50,PSSTDRUG,2)
"RTN","PSSDEE",225,0)
 S PSSCP=$$CPTIER^PSNAPIS(VAPROD,CPDATE,"",1) K CPDATE,X
"RTN","PSSDEE",226,0)
 W:$G(PSSFSN)["" "  "_PSSFSN W:$G(PSSNFORM)["" "  ",PSSNFORM ;FSN; local non-formulary
"RTN","PSSDEE",227,0)
 S PSSFD=$$FDR^PSNACT(VAPROD) ;ppsn
"RTN","PSSDEE",228,0)
 W:PSSFD'="" "  "_PSSFD
"RTN","PSSDEE",229,0)
 I $G(VAPROD),$P(PSSCP,"^")'="" W "  Tier ",$P(PSSCP,"^")
"RTN","PSSDEE",230,0)
 S:$G(PSSINACT) PSSCONVD=$$DATE(PSSINACT)  ;inactive date
"RTN","PSSDEE",231,0)
 W:$G(PSSCONVD)'="" "  "_PSSCONVD
"RTN","PSSDEE",232,0)
 W:$G(PSSMSG)'="" "  "_PSSMSG
"RTN","PSSDEE",233,0)
 W:$G(PSSRESTR)'="" "  "_PSSRESTR
"RTN","PSSDEE",234,0)
 Q
"RTN","PSSDEE",235,0)
 ;
"RTN","PSSDEE",236,0)
DATE(PSSCONVD) ;convert fileman date to mm/dd/yyyy
"RTN","PSSDEE",237,0)
 N DATE
"RTN","PSSDEE",238,0)
 S DATE="",DATE=$E(PSSCONVD,4,5)_"/"_$E(PSSCONVD,6,7)_"/"_(1700+$E(PSSCONVD,1,3))
"RTN","PSSDEE",239,0)
 Q DATE
"RTN","PSSDEE",240,0)
 ;
"RTN","PSSDEE",241,0)
FD(PSSTDRUG) ;
"RTN","PSSDEE",242,0)
 N VAPROD,PSSDRDAT
"RTN","PSSDEE",243,0)
 D GETS^DIQ(50,PSSTDRUG,22,"I","PSSDRDAT")
"RTN","PSSDEE",244,0)
 S VAPROD=PSSDRDAT(50,PSSTDRUG_",",22,"I")
"RTN","PSSDEE",245,0)
 Q:VAPROD=""
"RTN","PSSDEE",246,0)
 S PSSFD="",PSSFD=$$GET1^DIQ(50.68,VAPROD,109)  ;ppsn
"RTN","PSSDEE",247,0)
 W:PSSFD'="" !,"Formulary Designator: "_PSSFD
"RTN","PSSDEE",248,0)
 I $D(^PSNDF(50.68,VAPROD,5.1,1,0)) D FDT^PSNACT(VAPROD) ;ppsn
"RTN","PSSDEE",249,0)
 Q
"RTN","PSSDRDO2")
0^3^B6056930^n/a
"RTN","PSSDRDO2",1,0)
PSSDRDO2 ;BIR/LE-Display Dosing related information for DRUG File(#50) entry ;07/14/15
"RTN","PSSDRDO2",2,0)
 ;;1.0;PHARMACY DATA MANAGEMENT;**195**;9/30/97;Build 25
"RTN","PSSDRDO2",3,0)
 ;
"RTN","PSSDRDO2",4,0)
 ;Reference to DATA^PSN50P68 supported by DBIA 4545
"RTN","PSSDRDO2",5,0)
 ;
"RTN","PSSDRDO2",6,0)
 ;called from PSSDRDOS
"RTN","PSSDRDO2",7,0)
CLEFF(PSSVAPRD) ;Retrieve and write Clinical Effects of Drug fields
"RTN","PSSDRDO2",8,0)
 ;input:  PSSVAPRD = IEN for VA Product file (#50.68) 
"RTN","PSSDRDO2",9,0)
 ;
"RTN","PSSDRDO2",10,0)
 ; Clinical Effects of Drug fields
"RTN","PSSDRDO2",11,0)
 Q:'$G(PSSVAPRD)
"RTN","PSSDRDO2",12,0)
 K ^TMP($J,"PSSVAPR")
"RTN","PSSDRDO2",13,0)
 D DATA^PSN50P68(PSSVAPRD,"","PSSVAPR") ;using the PRE encapuslation API
"RTN","PSSDRDO2",14,0)
 N PSSII,PSSIII,PSSPKG,PSSPKG,PSSOMIT,PSSEXLMT,PSSCLEF,PSSNIEN
"RTN","PSSDRDO2",15,0)
 S PSSNIEN=PSSVAPRD
"RTN","PSSDRDO2",16,0)
 I $D(^TMP($J,"PSSVAPR",PSSNIEN)) D
"RTN","PSSDRDO2",17,0)
 .S (PSSII,PSSIII)=0
"RTN","PSSDRDO2",18,0)
 .F  S PSSII=$O(^TMP($J,"PSSVAPR",PSSNIEN,108,PSSII)) Q:PSSII=""  D
"RTN","PSSDRDO2",19,0)
 ..S (PSSPKG,PSSOMIT,PSSEXLMT)=""
"RTN","PSSDRDO2",20,0)
 ..F  S PSSIII=$O(^TMP($J,"PSSVAPR",PSSNIEN,108,PSSII,PSSIII)) Q:PSSIII=""  D
"RTN","PSSDRDO2",21,0)
 ...S:PSSIII=.01 PSSPKG=^TMP($J,"PSSVAPR",PSSNIEN,108,PSSII,PSSIII)
"RTN","PSSDRDO2",22,0)
 ...S:PSSIII=1 PSSOMIT=^TMP($J,"PSSVAPR",PSSNIEN,108,PSSII,PSSIII)
"RTN","PSSDRDO2",23,0)
 ...S:PSSIII=2 PSSEXLMT=^TMP($J,"PSSVAPR",PSSNIEN,108,PSSII,PSSIII)
"RTN","PSSDRDO2",24,0)
 ..S:PSSPKG'="" PSSCLEF(PSSPKG)=PSSOMIT_"^"_PSSEXLMT
"RTN","PSSDRDO2",25,0)
 ;
"RTN","PSSDRDO2",26,0)
 W !!,"CLINICAL EFFECT DURATION: ",$S($D(^TMP($J,"PSSVAPR",PSSNIEN,108)):"YES",1:"NO")
"RTN","PSSDRDO2",27,0)
 ;If package IO is defined only show it, otherwise show all packages
"RTN","PSSDRDO2",28,0)
 I $D(PSSCLEF("IO")) S PSSPKG="IO" D CLEFFS,CLEFFW(PSSPKG,PSSOMIT,PSSEXLMT) Q
"RTN","PSSDRDO2",29,0)
 S PSSPKG="" F  S PSSPKG=$O(PSSCLEF(PSSPKG)) Q:PSSPKG=""  D
"RTN","PSSDRDO2",30,0)
 .D CLEFFS,CLEFFW(PSSPKG,PSSOMIT,PSSEXLMT)
"RTN","PSSDRDO2",31,0)
 Q
"RTN","PSSDRDO2",32,0)
 ;
"RTN","PSSDRDO2",33,0)
CLEFFS ;
"RTN","PSSDRDO2",34,0)
 S (PSSOMIT,PSSEXLMT)="",PSSOMIT=$P(PSSCLEF(PSSPKG),"^"),PSSEXLMT=$P(PSSCLEF(PSSPKG),"^",2)
"RTN","PSSDRDO2",35,0)
 Q
"RTN","PSSDRDO2",36,0)
 ;
"RTN","PSSDRDO2",37,0)
CLEFFW(PSSPKG,PSSOMIT,PSSEXLMT) ;
"RTN","PSSDRDO2",38,0)
 N PSSPACK2 S PSSPACK2=""
"RTN","PSSDRDO2",39,0)
 S (PSSOMIT,PSSEXLMT)="",PSSOMIT=$P(PSSCLEF(PSSPKG),"^"),PSSEXLMT=$P(PSSCLEF(PSSPKG),"^",2)
"RTN","PSSDRDO2",40,0)
 N PSSPACK2 S PSSPACK2=""
"RTN","PSSDRDO2",41,0)
 S PSSPACK2=$S(PSSPKG="I":"INPATIENT",PSSPKG="O":"OUTPATIENT",PSSPKG="IO":"BOTH INPATIENT AND OUTPATIENT",1:"")
"RTN","PSSDRDO2",42,0)
 W !?3,PSSPACK2," DURATION LIMIT: "  W:PSSOMIT=0 PSSEXLMT
"RTN","PSSDRDO2",43,0)
 W !?6,"OMIT EXP/DC ORDER CHECK: ",$S(PSSOMIT=1:"YES",PSSOMIT=0:"NO",1:"")
"RTN","PSSDRDO2",44,0)
 K ^TMP($J,"PSSVAPR")
"RTN","PSSDRDO2",45,0)
 Q
"RTN","PSSDRDO2",46,0)
 ;
"RTN","PSSDRDOS")
0^2^B159075215^B158735065
"RTN","PSSDRDOS",1,0)
PSSDRDOS ;BIR/RTR-Display Dosing related information for DRUG File(#50) entry ;08/20/11
"RTN","PSSDRDOS",2,0)
 ;;1.0;PHARMACY DATA MANAGEMENT;**160,173,195**;9/30/97;Build 25
"RTN","PSSDRDOS",3,0)
 ;
"RTN","PSSDRDOS",4,0)
 ;Reference to $$PROD0^PSNAPIS(P1,P3) supported by DBIA #2531
"RTN","PSSDRDOS",5,0)
 ;Reference to $$OVRIDE^PSNAPIS(P1,P3) supported by DBIA #2531
"RTN","PSSDRDOS",6,0)
 ;
"RTN","PSSDRDOS",7,0)
EN ;
"RTN","PSSDRDOS",8,0)
 N X,Y,DIR,DTOUT,DUOUT,DIRUT,DIROUT,DIC,DA,DR,DLAYGO,DIDEL,%,%DT,D0,I,J,XX,D
"RTN","PSSDRDOS",9,0)
 N PSSVVHIN,PSSVVHZR,PSSVVHND,PSSVVHN1,PSSVVHN3,PSSVVHRS,PSSVVHMT,PSSVVHOV,PSSVVHNM,PSSVVHDF,PSSVVHGC,PSSVVHDX,PSSVVHLG,PSSVVHQT,PSSVVHL3,PSSVVHL4
"RTN","PSSDRDOS",10,0)
 N PSSVVHA1,PSSVVHA2,PSSVVHA3,PSSVVHA4,PSSVVHA5,PSSVVHA7,PSSVVHA8,PSSVVHA9,PSSVVHAR,PSSIEN,PSSVVHXX,PSSVVHPL,PSSVVHHH
"RTN","PSSDRDOS",11,0)
 N PSSVVHL1,PSSVVHL2
"RTN","PSSDRDOS",12,0)
 S $P(PSSVVHL1,"=",75)=""
"RTN","PSSDRDOS",13,0)
 S $P(PSSVVHL2,"-",75)=""
"RTN","PSSDRDOS",14,0)
EN1 ;Come back through to prompt for another drug before exiting option
"RTN","PSSDRDOS",15,0)
 K X,Y,DIR,DTOUT,DUOUT,DIRUT,DIROUT,DIC,DA,DR,DLAYGO,DIDEL,%,%DT,D0,I,J,XX,D
"RTN","PSSDRDOS",16,0)
 K PSSVVHIN,PSSVVHZR,PSSVVHND,PSSVVHN1,PSSVVHN3,PSSVVHRS,PSSVVHMT,PSSVVHOV,PSSVVHNM,PSSVVHDF,PSSVVHGC,PSSVVHDX,PSSVVHLG,PSSVVHQT,PSSVVHL3,PSSVVHL4
"RTN","PSSDRDOS",17,0)
 K PSSVVHA1,PSSVVHA2,PSSVVHA3,PSSVVHA4,PSSVVHA5,PSSVVHA7,PSSVVHA8,PSSVVHA9,PSSVVHAR,PSSIEN,PSSVVHXX,PSSVVHPL,PSSVVHHH
"RTN","PSSDRDOS",18,0)
 W ! K DIC,X,DTOUT,DUOUT S DIC="^PSDRUG(",DIC(0)="AEQMZ" D ^DIC K DIC,X I Y<0!($D(DUOUT))!($D(DTOUT)) W ! Q
"RTN","PSSDRDOS",19,0)
 S PSSVVHIN=+Y
"RTN","PSSDRDOS",20,0)
 S (PSSVVHDX,PSSVVHQT,PSSVVHLG)=0,(PSSVVHOV,PSSVVHGC,PSSVVHNM,PSSVVHDF,PSSVVHPL,PSSVVHHH)=""
"RTN","PSSDRDOS",21,0)
 S PSSVVHZR=$G(^PSDRUG(PSSVVHIN,0)),PSSVVHND=$G(^PSDRUG(PSSVVHIN,"ND")),PSSVVHMT=1
"RTN","PSSDRDOS",22,0)
 S PSSVVHN1=$P(PSSVVHND,"^"),PSSVVHN3=$P(PSSVVHND,"^",3) I 'PSSVVHN1!('PSSVVHN3) S PSSVVHMT=0
"RTN","PSSDRDOS",23,0)
 I 'PSSVVHMT S PSSVVHLG=1 G NOTM
"RTN","PSSDRDOS",24,0)
 S PSSVVHRS=$$PROD0^PSNAPIS(PSSVVHN1,PSSVVHN3),PSSVVHOV=$$OVRIDE^PSNAPIS(PSSVVHN1,PSSVVHN3) S PSSVVHHH=$S(PSSVVHOV:1,1:0)
"RTN","PSSDRDOS",25,0)
 S PSSVVHNM=$P(PSSVVHRS,"^"),PSSVVHDF=$P(PSSVVHRS,"^",2),PSSVVHGC=$P(PSSVVHRS,"^",7)
"RTN","PSSDRDOS",26,0)
 I PSSVVHDF S PSSVVHPL=0 I $P($G(^PS(50.606,PSSVVHDF,1)),"^") S (PSSVVHDX,PSSVVHPL)=1
"RTN","PSSDRDOS",27,0)
 S PSSVVHLG=$$ELG
"RTN","PSSDRDOS",28,0)
 ;
"RTN","PSSDRDOS",29,0)
NOTM ;Jump to here if not matched to National Drug File
"RTN","PSSDRDOS",30,0)
 W @IOF
"RTN","PSSDRDOS",31,0)
 S PSSVVHL3=$L($P(PSSVVHZR,"^")),PSSVVHL4=$S(PSSVVHGC'="":$L(PSSVVHGC),1:4) D
"RTN","PSSDRDOS",32,0)
 .I (PSSVVHL3+PSSVVHL4)<54 W !?12,$P(PSSVVHZR,"^")_"  (GCNSEQNO: "_$S(PSSVVHGC'="":PSSVVHGC,1:"None")_")" D PAUSE Q
"RTN","PSSDRDOS",33,0)
 .W !?12,$P(PSSVVHZR,"^") D PAUSE Q:PSSVVHQT
"RTN","PSSDRDOS",34,0)
 .W !?12,"(GCNSEQNO: "_$S(PSSVVHGC'="":PSSVVHGC,1:"None")_")" D PAUSE
"RTN","PSSDRDOS",35,0)
 G:PSSVVHQT EN1
"RTN","PSSDRDOS",36,0)
 W !,PSSVVHL1 D PAUSE G:PSSVVHQT EN1
"RTN","PSSDRDOS",37,0)
 S PSSVVHL3=$L(PSSVVHNM) D
"RTN","PSSDRDOS",38,0)
 .I PSSVVHL3<63 W !,"VA PRODUCT NAME: "_PSSVVHNM D PAUSE Q
"RTN","PSSDRDOS",39,0)
 .W !,"VA PRODUCT NAME:" D PAUSE Q:PSSVVHQT
"RTN","PSSDRDOS",40,0)
 .W !?2,PSSVVHNM D PAUSE
"RTN","PSSDRDOS",41,0)
 G:PSSVVHQT EN1
"RTN","PSSDRDOS",42,0)
 W !,"NDF DOSAGE FORM: "_$S(PSSVVHDF:$P($G(^PS(50.606,+PSSVVHDF,0)),"^"),1:"") D PAUSE G:PSSVVHQT EN1
"RTN","PSSDRDOS",43,0)
 W !,"DEA, SPECIAL HDLG: "_$P(PSSVVHZR,"^",3)_"   VA DRUG CLASS: "_$P(PSSVVHZR,"^",2) D PAUSE G:PSSVVHQT EN1
"RTN","PSSDRDOS",44,0)
 W !,"EXCLUDE DOSAGE FORM FROM DOSAGE CHECKS: " W $S(PSSVVHPL:"YES",PSSVVHPL=0:"NO",1:"") D PAUSE G:PSSVVHQT EN1
"RTN","PSSDRDOS",45,0)
 W !,"OVERRIDE DOSAGE FORM DOSE CHECK EXCLUSION FOR VA PRODUCT: " W $S(PSSVVHHH:"YES",PSSVVHHH=0:"NO",1:"") D PAUSE G:PSSVVHQT EN1
"RTN","PSSDRDOS",46,0)
 W ! D PAUSE G:PSSVVHQT EN1
"RTN","PSSDRDOS",47,0)
 W !?7,"***DRUG "_$S(PSSVVHLG:"NOT ",1:"")_"ELIGIBLE FOR DOSAGE CHECKS***" D PAUSE G:PSSVVHQT EN1
"RTN","PSSDRDOS",48,0)
 W !,PSSVVHL2 D PAUSE G:PSSVVHQT EN1
"RTN","PSSDRDOS",49,0)
 ;
"RTN","PSSDRDOS",50,0)
 S PSSVVHA1=$G(^PSDRUG(PSSVVHIN,"DOS")) S PSSVVHL3=0
"RTN","PSSDRDOS",51,0)
 S PSSVVHA2=$P(PSSVVHA1,"^"),PSSVVHA3=$P(PSSVVHA1,"^",2) I PSSVVHA3,$P($G(^PS(50.507,+PSSVVHA3,0)),"^")'["/" S PSSVVHL3=$L($P($G(^PS(50.607,+PSSVVHA3,0)),"^"))
"RTN","PSSDRDOS",52,0)
 W !,"Strength: "_$S($E($G(PSSVVHA2),1)=".":"0",1:"")_$G(PSSVVHA2) D
"RTN","PSSDRDOS",53,0)
 .I PSSVVHA3="" W "   Unit:" D PAUSE Q
"RTN","PSSDRDOS",54,0)
 .I PSSVVHL3<46 W "   Unit: "_$S($P($G(^PS(50.607,+$G(PSSVVHA3),0)),"^")'["/":$P($G(^(0)),"^"),1:"") D PAUSE Q
"RTN","PSSDRDOS",55,0)
 .W ! D PAUSE Q:PSSVVHQT
"RTN","PSSDRDOS",56,0)
 .W "   Unit: "_$S($P($G(^PS(50.607,+$G(PSSVVHA3),0)),"^")'["/":$P($G(^(0)),"^"),1:"") D PAUSE Q
"RTN","PSSDRDOS",57,0)
 G:PSSVVHQT EN1
"RTN","PSSDRDOS",58,0)
 W !,"POSSIBLE DOSAGES:" D PAUSE G:PSSVVHQT EN1 D
"RTN","PSSDRDOS",59,0)
 .F PSSVVHA4=0:0 S PSSVVHA4=$O(^PSDRUG(PSSVVHIN,"DOS1",PSSVVHA4)) Q:'PSSVVHA4!(PSSVVHQT)  D
"RTN","PSSDRDOS",60,0)
 ..S PSSVVHA5=$G(^PSDRUG(PSSVVHIN,"DOS1",PSSVVHA4,0))
"RTN","PSSDRDOS",61,0)
 ..W !,"  DISPENSE UNITS PER DOSE: " D
"RTN","PSSDRDOS",62,0)
 ...W $S($E($P(PSSVVHA5,"^"),1)=".":"0",1:"")_$P(PSSVVHA5,"^")
"RTN","PSSDRDOS",63,0)
 ...S X=$P(PSSVVHA5,"^"),PSSIEN=PSSVVHIN D SET^PSSDOSLZ S PSSVVHXX=$G(X)
"RTN","PSSDRDOS",64,0)
 ...W ?43,"DOSE: ",PSSVVHXX
"RTN","PSSDRDOS",65,0)
 ...I $L(PSSVVHXX)'>14 W ?65,"PACKAGE: ",$P(PSSVVHA5,U,3) D PAUSE Q
"RTN","PSSDRDOS",66,0)
 ...W ! D PAUSE Q:PSSVVHQT
"RTN","PSSDRDOS",67,0)
 ...W ?65,"PACKAGE: ",$P(PSSVVHA5,U,3) D PAUSE
"RTN","PSSDRDOS",68,0)
 ..Q:PSSVVHQT
"RTN","PSSDRDOS",69,0)
 ..W !,"      BCMA UNITS PER DOSE: "_$S($E($P(PSSVVHA5,"^",4),1)=".":"0",1:"")_$P(PSSVVHA5,"^",4) D PAUSE
"RTN","PSSDRDOS",70,0)
 G:PSSVVHQT EN1
"RTN","PSSDRDOS",71,0)
 W !!,"LOCAL POSSIBLE DOSAGES:" D PAUSE G:PSSVVHQT EN1 D
"RTN","PSSDRDOS",72,0)
 .F PSSVVHA7=0:0 S PSSVVHA7=$O(^PSDRUG(PSSVVHIN,"DOS2",PSSVVHA7)) Q:'PSSVVHA7!(PSSVVHQT)  D
"RTN","PSSDRDOS",73,0)
 ..S PSSVVHA8=$G(^PSDRUG(PSSVVHIN,"DOS2",PSSVVHA7,0)) W !,"  LOCAL POSSIBLE DOSAGE: " D
"RTN","PSSDRDOS",74,0)
 ...I $L($P(PSSVVHA8,"^"))'>37 W $P(PSSVVHA8,"^"),?65,"PACKAGE: ",$P(PSSVVHA8,"^",2) D PAUSE Q:PSSVVHQT  D WXFPT(PSSVVHA8) Q
"RTN","PSSDRDOS",75,0)
 ...W !,?3,$P(PSSVVHA8,"^"),?65,"PACKAGE: ",$P(PSSVVHA8,"^",2) D PAUSE Q:PSSVVHQT  D WXFPT(PSSVVHA8)
"RTN","PSSDRDOS",76,0)
 G:PSSVVHQT EN1
"RTN","PSSDRDOS",77,0)
 W !,PSSVVHL2 D PAUSE G:PSSVVHQT EN1
"RTN","PSSDRDOS",78,0)
 I $G(PSSVVHGC)=""!(PSSVVHLG) D  G EN1
"RTN","PSSDRDOS",79,0)
 .W !,"FDB ROUTES:" D PAUSE Q:PSSVVHQT
"RTN","PSSDRDOS",80,0)
 .W !,"FDB DOSE UNITS:" D PAUSE Q:PSSVVHQT
"RTN","PSSDRDOS",81,0)
 .W !,"BSA REQUIRED FOR DOSAGE CHECKS:" D PAUSE Q:PSSVVHQT
"RTN","PSSDRDOS",82,0)
 .W !,"WEIGHT REQUIRED FOR DOSAGE CHECKS:" D PAUSE
"RTN","PSSDRDOS",83,0)
 D NGC,NGCK
"RTN","PSSDRDOS",84,0)
 I $P($G(^PSDRUG(PSSVVHIN,"ND")),"^",3)'="" D CLEFF^PSSDRDO2(PSSVVHN3) D PAUSE Q:PSSVVHQT  ; Clinical Effects of Drug fields
"RTN","PSSDRDOS",85,0)
 G EN1
"RTN","PSSDRDOS",86,0)
 ;
"RTN","PSSDRDOS",87,0)
WXFPT(PSSVVHCL) ;
"RTN","PSSDRDOS",88,0)
 N PSSVVHC1,PSSVVHC2,PSSVVHC3,PSSVVHC4,PSSVVHC5,PSSVVHC6,PSSVVHC7
"RTN","PSSDRDOS",89,0)
 S PSSVVHC4=""
"RTN","PSSDRDOS",90,0)
 S PSSVVHC1=$P(PSSVVHCL,"^",3),PSSVVHC2=$P(PSSVVHCL,"^",5),PSSVVHC3=$P(PSSVVHCL,"^",6)
"RTN","PSSDRDOS",91,0)
 I PSSVVHC2 S PSSVVHC4=$P($G(^PS(51.24,+PSSVVHC2,0)),"^")
"RTN","PSSDRDOS",92,0)
 S PSSVVHC5=$S($E(PSSVVHC3)=".":"0",1:"")_PSSVVHC3
"RTN","PSSDRDOS",93,0)
 S PSSVVHC7=$S($E(PSSVVHC1)=".":"0",1:"")_PSSVVHC1
"RTN","PSSDRDOS",94,0)
 S PSSVVHC6=$L(PSSVVHC5)
"RTN","PSSDRDOS",95,0)
 W !?4,"BCMA UNITS PER DOSE: "_PSSVVHC7 D PAUSE Q:PSSVVHQT
"RTN","PSSDRDOS",96,0)
 I PSSVVHC6<12 W !?4,"       NUMERIC DOSE: "_PSSVVHC5,?38,"DOSE UNIT: "_PSSVVHC4 D PAUSE Q
"RTN","PSSDRDOS",97,0)
 W !,?4,"       NUMERIC DOSE: "_PSSVVHC5 D PAUSE Q:PSSVVHQT
"RTN","PSSDRDOS",98,0)
 W !,?38,"DOSE UNIT: "_PSSVVHC4 D PAUSE
"RTN","PSSDRDOS",99,0)
 Q
"RTN","PSSDRDOS",100,0)
 ;
"RTN","PSSDRDOS",101,0)
PAUSE ;
"RTN","PSSDRDOS",102,0)
 I ($Y+5)'>IOSL Q
"RTN","PSSDRDOS",103,0)
 W ! K DIR S DIR(0)="E",DIR("A")="Press Return to continue, '^' to exit" D ^DIR K DIR I 'Y S PSSVVHQT=1 Q
"RTN","PSSDRDOS",104,0)
 W @IOF
"RTN","PSSDRDOS",105,0)
 Q
"RTN","PSSDRDOS",106,0)
 ;
"RTN","PSSDRDOS",107,0)
ELG() ;Is drug Dose Call Eligible, for matched drugs
"RTN","PSSDRDOS",108,0)
 N PSSVVHDA
"RTN","PSSDRDOS",109,0)
 S PSSVVHDA=PSSVVHDF
"RTN","PSSDRDOS",110,0)
 ;1=exempt from Dose Check, 0=not exempt from Dose check
"RTN","PSSDRDOS",111,0)
 I $P(PSSVVHZR,"^",3)["S"!($E($P(PSSVVHZR,"^",2),1,2)="XA") Q 1
"RTN","PSSDRDOS",112,0)
 I $G(PSSVVHGC)="" Q 1
"RTN","PSSDRDOS",113,0)
 I $G(PSSVVHDA)'>0,$P($G(^PSDRUG(PSSVVHIN,2)),"^") S PSSVVHDA=$P($G(^PS(50.7,+$P($G(^PSDRUG(PSSVVHIN,2)),"^"),0)),"^",2) I PSSVVHDA,$P($G(^PS(50.606,+$G(PSSVVHDA),1)),"^") S PSSVVHDX=1
"RTN","PSSDRDOS",114,0)
 I PSSVVHOV=""!('$G(PSSVVHDA))!($P($G(^PS(50.606,+$G(PSSVVHDA),1)),"^")="") Q 0
"RTN","PSSDRDOS",115,0)
 I $P($G(^PS(50.606,+$G(PSSVVHDA),1)),"^"),'PSSVVHOV Q 1
"RTN","PSSDRDOS",116,0)
 I '$P($G(^PS(50.606,+$G(PSSVVHDA),1)),"^"),PSSVVHOV Q 1
"RTN","PSSDRDOS",117,0)
 Q 0
"RTN","PSSDRDOS",118,0)
 ;
"RTN","PSSDRDOS",119,0)
NGC ;Print First Databank data from Dosing records
"RTN","PSSDRDOS",120,0)
 N PSSDCR1,PSSDCR2,PSSDCR3,PSSDCR4,PSSDCR5,PSSDCR6,PSSDCR7,PSSDCR8,PSSDCR9,PSSDCRN3,PSSDCRVL,PSSDCRMR,PSSDCRUN,PSSDCRWT,PSSDCRBS,PSSDCRCO,PSSDCRF1,PSSDCRF2,PSSDCRF3,PSSDCRF4,PSSDCRF5,PSSDCRX1,PSSDCRX2,PSSDCRXX,PSSDCRK1,PSSDCRK2
"RTN","PSSDRDOS",121,0)
 N PSSDCRJ1,PSSDCRJ2,PSSDCRJ3,PSSDCRJ4,PSSDCRJ5,PSSDCRJ6
"RTN","PSSDRDOS",122,0)
 D NGCK
"RTN","PSSDRDOS",123,0)
 D EN^PSSFDBDI(PSSVVHGC,.PSSDCRVL)
"RTN","PSSDRDOS",124,0)
 I $P($G(PSSDCRVL(0)),"^")=-1 D  Q
"RTN","PSSDRDOS",125,0)
 .W !,"Vendor database cannot be reached. FDB Dosing information could not be" D PAUSE Q:PSSVVHQT
"RTN","PSSDRDOS",126,0)
 .W !,"retrieved at this time." D PAUSE
"RTN","PSSDRDOS",127,0)
 ;
"RTN","PSSDRDOS",128,0)
 ;set arrays used for printing from doseRanges records
"RTN","PSSDRDOS",129,0)
 S (PSSDCRX1,PSSDCRX2)=1
"RTN","PSSDRDOS",130,0)
 S PSSVVHGC=+PSSVVHGC
"RTN","PSSDRDOS",131,0)
 S PSSDCR1="" F  S PSSDCR1=$O(^TMP($J,"PSSFDBDI",PSSVVHGC,"doseRanges",PSSDCR1)) Q:PSSDCR1=""  D
"RTN","PSSDRDOS",132,0)
 .S PSSDCR2=$G(^TMP($J,"PSSFDBDI",PSSVVHGC,"doseRanges",PSSDCR1,1,0)) Q:$P(PSSDCR2,"^",4)'="SINGLE DOSE"&($P(PSSDCR2,"^",4)'="MAINTENANCE")  S:$P(PSSDCR2,"^",6)'="" PSSDCRMR($P(PSSDCR2,"^",6))=""
"RTN","PSSDRDOS",133,0)
 .S PSSDCR5=$G(^TMP($J,"PSSFDBDI",PSSVVHGC,"doseRanges",PSSDCR1,5,0))
"RTN","PSSDRDOS",134,0)
 .S PSSDCR6=$G(^TMP($J,"PSSFDBDI",PSSVVHGC,"doseRanges",PSSDCR1,6,0))
"RTN","PSSDRDOS",135,0)
 .S PSSDCR7=$G(^TMP($J,"PSSFDBDI",PSSVVHGC,"doseRanges",PSSDCR1,7,0))
"RTN","PSSDRDOS",136,0)
 .S PSSDCRN3=$G(^TMP($J,"PSSFDBDI",PSSVVHGC,"doseRanges",PSSDCR1,3,0))
"RTN","PSSDRDOS",137,0)
 .F PSSDCR8=2,4,6,8 D
"RTN","PSSDRDOS",138,0)
 ..S:$P(PSSDCR5,"^",PSSDCR8)'="" PSSDCRUN($P($P(PSSDCR5,"^",PSSDCR8),"/"))="" S:$P(PSSDCR6,"^",PSSDCR8)'="" PSSDCRUN($P($P(PSSDCR6,"^",PSSDCR8),"/"))=""
"RTN","PSSDRDOS",139,0)
 .F PSSDCR8=2,4 D
"RTN","PSSDRDOS",140,0)
 ..S:$P(PSSDCR7,"^",PSSDCR8)'="" PSSDCRUN($P($P(PSSDCR7,"^",PSSDCR8),"/"))=""
"RTN","PSSDRDOS",141,0)
 .I $P(PSSDCR2,"^",7)'="",$P(PSSDCR2,"^",8)'="" S PSSDCRCO=$P(PSSDCR2,"^",7)_"-"_$P(PSSDCR2,"^",8) D
"RTN","PSSDRDOS",142,0)
 ..I $P(PSSDCRN3,"^")="true"!($P(PSSDCRN3,"^")="false") I '$$DUP1 S PSSDCRBS(PSSDCRX1,PSSDCRCO,$P(PSSDCRN3,"^"))=$P(PSSDCR2,"^",6)_"^"_$P(PSSDCR2,"^",4) S PSSDCRX1=PSSDCRX1+1
"RTN","PSSDRDOS",143,0)
 ..I $P(PSSDCRN3,"^",2)="true"!($P(PSSDCRN3,"^",2)="false") I '$$DUP2 S PSSDCRWT(PSSDCRX2,PSSDCRCO,$P(PSSDCRN3,"^",2))=$P(PSSDCR2,"^",6)_"^"_$P(PSSDCR2,"^",4) S PSSDCRX2=PSSDCRX2+1
"RTN","PSSDRDOS",144,0)
 ;
"RTN","PSSDRDOS",145,0)
 ;Removed all Min/Max Dosing records per CR 5781, CR 5783 and CCR 5778
"RTN","PSSDRDOS",146,0)
 W !,"FDB ROUTES: " S PSSDCR3=0 D
"RTN","PSSDRDOS",147,0)
 .S PSSDCR4="" F  S PSSDCR4=$O(PSSDCRMR(PSSDCR4)) Q:PSSDCR4=""!(PSSVVHQT)  D
"RTN","PSSDRDOS",148,0)
 ..I 'PSSDCR3 W PSSDCR4 S PSSDCR3=1 D PAUSE Q
"RTN","PSSDRDOS",149,0)
 ..W !?12,PSSDCR4 D PAUSE
"RTN","PSSDRDOS",150,0)
 I PSSVVHQT Q
"RTN","PSSDRDOS",151,0)
 ;
"RTN","PSSDRDOS",152,0)
 W !,"FDB DOSE UNITS: " S PSSDCR3=0 D
"RTN","PSSDRDOS",153,0)
 .S PSSDCR4="" F  S PSSDCR4=$O(PSSDCRUN(PSSDCR4)) Q:PSSDCR4=""!(PSSVVHQT)  D
"RTN","PSSDRDOS",154,0)
 ..I 'PSSDCR3 W PSSDCR4 S PSSDCR3=1 D PAUSE Q
"RTN","PSSDRDOS",155,0)
 ..W !?16,PSSDCR4 D PAUSE
"RTN","PSSDRDOS",156,0)
 I PSSVVHQT Q
"RTN","PSSDRDOS",157,0)
 ;
"RTN","PSSDRDOS",158,0)
 ;Write BSA and WT required data
"RTN","PSSDRDOS",159,0)
 ;If all Age ranges under BSA or WT, are the same do not list individual age ranges
"RTN","PSSDRDOS",160,0)
 ;When listing Age ranges under BSA or WT, then within that Yes or No, if 2 or more and ranges exist, and one or more has
"RTN","PSSDRDOS",161,0)
 ;a route associated with it, do not show the age range that does not have a route. Other than that, duplicates are not screened out.
"RTN","PSSDRDOS",162,0)
 S (PSSDCRF3,PSSDCRF4)="" D
"RTN","PSSDRDOS",163,0)
 .S PSSDCRXX="" F  S PSSDCRXX=$O(PSSDCRBS(PSSDCRXX)) Q:PSSDCRXX=""!(PSSDCRF4)  D
"RTN","PSSDRDOS",164,0)
 ..S PSSDCRF1="" F  S PSSDCRF1=$O(PSSDCRBS(PSSDCRXX,PSSDCRF1)) Q:PSSDCRF1=""!(PSSDCRF4)  D
"RTN","PSSDRDOS",165,0)
 ...S PSSDCRF2="" F  S PSSDCRF2=$O(PSSDCRBS(PSSDCRXX,PSSDCRF1,PSSDCRF2)) Q:PSSDCRF2=""!(PSSDCRF4)  D
"RTN","PSSDRDOS",166,0)
 ....I PSSDCRF3="" S PSSDCRF3=PSSDCRF2 Q
"RTN","PSSDRDOS",167,0)
 ....I PSSDCRF3'=PSSDCRF2 S PSSDCRF4=1 Q
"RTN","PSSDRDOS",168,0)
 ....S PSSDCRF3=PSSDCRF2
"RTN","PSSDRDOS",169,0)
 W !,"BSA REQUIRED FOR DOSAGE CHECKS:" D
"RTN","PSSDRDOS",170,0)
 .I 'PSSDCRF4 W $S(PSSDCRF3="true":" YES",PSSDCRF3="false":" NO",1:"") D PAUSE Q
"RTN","PSSDRDOS",171,0)
 .;Resort by starting age for printing
"RTN","PSSDRDOS",172,0)
 .K PSSDCRJ1,PSSDCRJ2,PSSDCRJ3,PSSDCRJ4,PSSDCRJ5,PSSDCRJ6
"RTN","PSSDRDOS",173,0)
 .F PSSDCRJ1=1:1 Q:'$D(PSSDCRBS(PSSDCRJ1))  S PSSDCRJ2="" F  S PSSDCRJ2=$O(PSSDCRBS(PSSDCRJ1,PSSDCRJ2)) Q:PSSDCRJ2=""  D
"RTN","PSSDRDOS",174,0)
 ..S PSSDCRJ3="" F  S PSSDCRJ3=$O(PSSDCRBS(PSSDCRJ1,PSSDCRJ2,PSSDCRJ3)) Q:PSSDCRJ3=""  S PSSDCRJ4=$P(PSSDCRJ2,"-") D
"RTN","PSSDRDOS",175,0)
 ...S PSSDCRJ5(PSSDCRJ4,PSSDCRJ1,PSSDCRJ2,PSSDCRJ3)=PSSDCRBS(PSSDCRJ1,PSSDCRJ2,PSSDCRJ3)
"RTN","PSSDRDOS",176,0)
 .W !?2,"YES for Age in Days:" S PSSDCR3=0 D
"RTN","PSSDRDOS",177,0)
 ..S PSSDCRJ6="" F  S PSSDCRJ6=$O(PSSDCRJ5(PSSDCRJ6)) Q:PSSDCRJ6=""!(PSSVVHQT)  D
"RTN","PSSDRDOS",178,0)
 ...S PSSDCRXX="" F  S PSSDCRXX=$O(PSSDCRJ5(PSSDCRJ6,PSSDCRXX)) Q:PSSDCRXX=""!(PSSVVHQT)  D
"RTN","PSSDRDOS",179,0)
 ....S PSSDCR4="" F  S PSSDCR4=$O(PSSDCRJ5(PSSDCRJ6,PSSDCRXX,PSSDCR4)) Q:PSSDCR4=""!(PSSVVHQT)  D
"RTN","PSSDRDOS",180,0)
 .....S PSSDCRF5="" F  S PSSDCRF5=$O(PSSDCRJ5(PSSDCRJ6,PSSDCRXX,PSSDCR4,PSSDCRF5)) Q:PSSDCRF5=""!(PSSVVHQT)  D:PSSDCRF5="true"
"RTN","PSSDRDOS",181,0)
 ......S PSSDCRK1=PSSDCRJ5(PSSDCRJ6,PSSDCRXX,PSSDCR4,PSSDCRF5)
"RTN","PSSDRDOS",182,0)
 ......W:PSSDCR3 !?22 W " "_PSSDCR4_"  " D  Q:PSSVVHQT  S PSSDCR3=1 D PAUSE Q
"RTN","PSSDRDOS",183,0)
 .......D LWRP(PSSDCRK1)
"RTN","PSSDRDOS",184,0)
 .Q:PSSVVHQT
"RTN","PSSDRDOS",185,0)
 .W !?3,"NO for Age in Days:" S PSSDCR3=0 D
"RTN","PSSDRDOS",186,0)
 ..S PSSDCRJ6="" F  S PSSDCRJ6=$O(PSSDCRJ5(PSSDCRJ6)) Q:PSSDCRJ6=""!(PSSVVHQT)  D
"RTN","PSSDRDOS",187,0)
 ...S PSSDCRXX="" F  S PSSDCRXX=$O(PSSDCRJ5(PSSDCRJ6,PSSDCRXX)) Q:PSSDCRXX=""!(PSSVVHQT)  D
"RTN","PSSDRDOS",188,0)
 ....S PSSDCR4="" F  S PSSDCR4=$O(PSSDCRJ5(PSSDCRJ6,PSSDCRXX,PSSDCR4)) Q:PSSDCR4=""!(PSSVVHQT)  D
"RTN","PSSDRDOS",189,0)
 .....S PSSDCRF5="" F  S PSSDCRF5=$O(PSSDCRJ5(PSSDCRJ6,PSSDCRXX,PSSDCR4,PSSDCRF5)) Q:PSSDCRF5=""!(PSSVVHQT)  D:PSSDCRF5="false"
"RTN","PSSDRDOS",190,0)
 ......S PSSDCRK2=PSSDCRJ5(PSSDCRJ6,PSSDCRXX,PSSDCR4,PSSDCRF5)
"RTN","PSSDRDOS",191,0)
 ......W:PSSDCR3 !?22 W " "_PSSDCR4_"  " D  Q:PSSVVHQT  S PSSDCR3=1 D PAUSE Q
"RTN","PSSDRDOS",192,0)
 .......D LWRP(PSSDCRK2)
"RTN","PSSDRDOS",193,0)
 I PSSVVHQT Q 
"RTN","PSSDRDOS",194,0)
 ;
"RTN","PSSDRDOS",195,0)
 S (PSSDCRF3,PSSDCRF4)="" D
"RTN","PSSDRDOS",196,0)
 .S PSSDCRXX="" F  S PSSDCRXX=$O(PSSDCRWT(PSSDCRXX)) Q:PSSDCRXX=""!(PSSDCRF4)  D
"RTN","PSSDRDOS",197,0)
 ..S PSSDCRF1="" F  S PSSDCRF1=$O(PSSDCRWT(PSSDCRXX,PSSDCRF1)) Q:PSSDCRF1=""!(PSSDCRF4)  D
"RTN","PSSDRDOS",198,0)
 ...S PSSDCRF2="" F  S PSSDCRF2=$O(PSSDCRWT(PSSDCRXX,PSSDCRF1,PSSDCRF2)) Q:PSSDCRF2=""!(PSSDCRF4)  D
"RTN","PSSDRDOS",199,0)
 ....I PSSDCRF3="" S PSSDCRF3=PSSDCRF2 Q
"RTN","PSSDRDOS",200,0)
 ....I PSSDCRF3'=PSSDCRF2 S PSSDCRF4=1 Q
"RTN","PSSDRDOS",201,0)
 ....S PSSDCRF3=PSSDCRF2
"RTN","PSSDRDOS",202,0)
 W !,"WEIGHT REQUIRED FOR DOSAGE CHECKS:" D 
"RTN","PSSDRDOS",203,0)
 .I 'PSSDCRF4 W $S(PSSDCRF3="true":" YES",PSSDCRF3="false":" NO",1:"") D PAUSE Q
"RTN","PSSDRDOS",204,0)
 .;Resort by starting age for printing
"RTN","PSSDRDOS",205,0)
 .K PSSDCRJ1,PSSDCRJ2,PSSDCRJ3,PSSDCRJ4,PSSDCRJ5,PSSDCRJ6
"RTN","PSSDRDOS",206,0)
 .F PSSDCRJ1=1:1 Q:'$D(PSSDCRWT(PSSDCRJ1))  S PSSDCRJ2="" F  S PSSDCRJ2=$O(PSSDCRWT(PSSDCRJ1,PSSDCRJ2)) Q:PSSDCRJ2=""  D
"RTN","PSSDRDOS",207,0)
 ..S PSSDCRJ3="" F  S PSSDCRJ3=$O(PSSDCRWT(PSSDCRJ1,PSSDCRJ2,PSSDCRJ3)) Q:PSSDCRJ3=""  S PSSDCRJ4=$P(PSSDCRJ2,"-") D
"RTN","PSSDRDOS",208,0)
 ...S PSSDCRJ5(PSSDCRJ4,PSSDCRJ1,PSSDCRJ2,PSSDCRJ3)=PSSDCRWT(PSSDCRJ1,PSSDCRJ2,PSSDCRJ3)
"RTN","PSSDRDOS",209,0)
 .W !?2,"YES for Age in Days:" S PSSDCR3=0 D
"RTN","PSSDRDOS",210,0)
 ..S PSSDCRJ6="" F  S PSSDCRJ6=$O(PSSDCRJ5(PSSDCRJ6)) Q:PSSDCRJ6=""!(PSSVVHQT)  D
"RTN","PSSDRDOS",211,0)
 ...S PSSDCRXX="" F  S PSSDCRXX=$O(PSSDCRJ5(PSSDCRJ6,PSSDCRXX)) Q:PSSDCRXX=""!(PSSVVHQT)  D
"RTN","PSSDRDOS",212,0)
 ....S PSSDCR4="" F  S PSSDCR4=$O(PSSDCRJ5(PSSDCRJ6,PSSDCRXX,PSSDCR4)) Q:PSSDCR4=""!(PSSVVHQT)  D
"RTN","PSSDRDOS",213,0)
 .....S PSSDCRF5="" F  S PSSDCRF5=$O(PSSDCRJ5(PSSDCRJ6,PSSDCRXX,PSSDCR4,PSSDCRF5)) Q:PSSDCRF5=""!(PSSVVHQT)  D:PSSDCRF5="true"
"RTN","PSSDRDOS",214,0)
 ......S PSSDCRK1=PSSDCRJ5(PSSDCRJ6,PSSDCRXX,PSSDCR4,PSSDCRF5)
"RTN","PSSDRDOS",215,0)
 ......W:PSSDCR3 !?22 W " "_PSSDCR4_"  " D  Q:PSSVVHQT  S PSSDCR3=1 D PAUSE Q
"RTN","PSSDRDOS",216,0)
 .......D LWRP(PSSDCRK1)
"RTN","PSSDRDOS",217,0)
 .Q:PSSVVHQT
"RTN","PSSDRDOS",218,0)
 .W !?3,"NO for Age in Days:" S PSSDCR3=0 D
"RTN","PSSDRDOS",219,0)
 ..S PSSDCRJ6="" F  S PSSDCRJ6=$O(PSSDCRJ5(PSSDCRJ6)) Q:PSSDCRJ6=""!(PSSVVHQT)  D
"RTN","PSSDRDOS",220,0)
 ...S PSSDCRXX="" F  S PSSDCRXX=$O(PSSDCRJ5(PSSDCRJ6,PSSDCRXX)) Q:PSSDCRXX=""!(PSSVVHQT)  D
"RTN","PSSDRDOS",221,0)
 ....S PSSDCR4="" F  S PSSDCR4=$O(PSSDCRJ5(PSSDCRJ6,PSSDCRXX,PSSDCR4)) Q:PSSDCR4=""!(PSSVVHQT)  D
"RTN","PSSDRDOS",222,0)
 .....S PSSDCRF5="" F  S PSSDCRF5=$O(PSSDCRJ5(PSSDCRJ6,PSSDCRXX,PSSDCR4,PSSDCRF5)) Q:PSSDCRF5=""!(PSSVVHQT)  D:PSSDCRF5="false"
"RTN","PSSDRDOS",223,0)
 ......S PSSDCRK2=PSSDCRJ5(PSSDCRJ6,PSSDCRXX,PSSDCR4,PSSDCRF5)
"RTN","PSSDRDOS",224,0)
 ......W:PSSDCR3 !?22 W " "_PSSDCR4_"  " D  Q:PSSVVHQT  S PSSDCR3=1 D PAUSE Q
"RTN","PSSDRDOS",225,0)
 .......D LWRP(PSSDCRK2)
"RTN","PSSDRDOS",226,0)
 Q
"RTN","PSSDRDOS",227,0)
 ;
"RTN","PSSDRDOS",228,0)
NGCK ;
"RTN","PSSDRDOS",229,0)
 K ^TMP($J,"PSSFDBDI")
"RTN","PSSDRDOS",230,0)
 Q
"RTN","PSSDRDOS",231,0)
 ;
"RTN","PSSDRDOS",232,0)
DUP1() ;Screen out duplicates, needed if Min/max records are added back
"RTN","PSSDRDOS",233,0)
 N PSSDCRD1,PSSDCRD2,PSSDCRDF,PSSDCRD4,PSSDCRG1,PSSDCRG2
"RTN","PSSDRDOS",234,0)
 S PSSDCRDF=0
"RTN","PSSDRDOS",235,0)
 S PSSDCRD1=$P(PSSDCRN3,"^"),PSSDCRD2=$P(PSSDCR2,"^",6),PSSDCRG1=$P(PSSDCR2,"^",4),PSSDCRG2=PSSDCRD2_"^"_PSSDCRG1
"RTN","PSSDRDOS",236,0)
 S PSSDCRD4="" F  S PSSDCRD4=$O(PSSDCRBS(PSSDCRD4)) Q:PSSDCRD4=""!(PSSDCRDF)  D
"RTN","PSSDRDOS",237,0)
 .I $G(PSSDCRBS(PSSDCRD4,PSSDCRCO,PSSDCRD1))=PSSDCRG2 S PSSDCRDF=1
"RTN","PSSDRDOS",238,0)
 Q PSSDCRDF
"RTN","PSSDRDOS",239,0)
 ;
"RTN","PSSDRDOS",240,0)
DUP2() ;
"RTN","PSSDRDOS",241,0)
 N PSSDCRD5,PSSDCRD6,PSSDCRDG,PSSDCRD7,PSSDCRG4,PSSDCRG5
"RTN","PSSDRDOS",242,0)
 S PSSDCRDG=0
"RTN","PSSDRDOS",243,0)
 S PSSDCRD5=$P(PSSDCRN3,"^",2),PSSDCRD6=$P(PSSDCR2,"^",6),PSSDCRG4=$P(PSSDCR2,"^",4),PSSDCRG5=PSSDCRD6_"^"_PSSDCRG4
"RTN","PSSDRDOS",244,0)
 S PSSDCRD7="" F  S PSSDCRD7=$O(PSSDCRWT(PSSDCRD7)) Q:PSSDCRD7=""!(PSSDCRDG)  D
"RTN","PSSDRDOS",245,0)
 .I $G(PSSDCRWT(PSSDCRD7,PSSDCRCO,PSSDCRD5))=PSSDCRG5 S PSSDCRDG=1
"RTN","PSSDRDOS",246,0)
 Q PSSDCRDG
"RTN","PSSDRDOS",247,0)
 ;
"RTN","PSSDRDOS",248,0)
LWRP(PSSDCRL1) ;Print last line, check for wrapping
"RTN","PSSDRDOS",249,0)
 N PSSDCRL2,PSSDCRL3,PSSDCRL4,PSSDCRL5
"RTN","PSSDRDOS",250,0)
 S PSSDCRL2=$S($P(PSSDCRL1,"^")'="":$L($P(PSSDCRL1,"^")),1:13),PSSDCRL3=$S($P(PSSDCRL1,"^",2)'="":$L($P(PSSDCRL1,"^",2)),1:12) I $P(PSSDCRL1,"^",2)="MAINTENANCE" S PSSDCRL3=PSSDCRL3+5
"RTN","PSSDRDOS",251,0)
 S PSSDCRL4=PSSDCRL2+PSSDCRL3+$L(PSSDCR4)
"RTN","PSSDRDOS",252,0)
 W "("_$S($P(PSSDCRL1,"^",2)="":"No Dose Type",1:$P(PSSDCRL1,"^",2))_$S($P(PSSDCRL1,"^",2)="MAINTENANCE":" DOSE, ",1:", ")
"RTN","PSSDRDOS",253,0)
 I PSSDCRL4<51 W $S($P(PSSDCRL1,"^")="":"No Dose Route)",1:$P(PSSDCRL1,"^")_")") Q
"RTN","PSSDRDOS",254,0)
 D PAUSE Q:PSSVVHQT  S PSSDCRL5=$L(PSSDCR4)+26 W !?PSSDCRL5,$S($P(PSSDCRL1,"^")="":"No Dose Route)",1:$P(PSSDCRL1,"^")_")")
"RTN","PSSDRDOS",255,0)
 Q
"RTN","PSSDRDOS",256,0)
 ;
"RTN","PSSLOOK")
0^1^B130430402^B94208630
"RTN","PSSLOOK",1,0)
PSSLOOK ;BIR/WRT-Drug file lookup ;02/03/00
"RTN","PSSLOOK",2,0)
 ;;1.0;PHARMACY DATA MANAGEMENT;**3,7,15,16,20,24,29,38,68,61,87,90,127,147,170,189,192,200,195**;9/30/97;Build 25
"RTN","PSSLOOK",3,0)
 ;
"RTN","PSSLOOK",4,0)
 ;Reference to ^PS(50.605 supported by DBIA #2138
"RTN","PSSLOOK",5,0)
 ;Reference to ^PS(50.608 supported by DBIA #2136
"RTN","PSSLOOK",6,0)
 ;Reference to ^PS(50.609 supported by DBIA #2137
"RTN","PSSLOOK",7,0)
 ;Reference to ^PS(50.607 supported by DBIA #2221
"RTN","PSSLOOK",8,0)
 ;Reference to $$FORMRX^PSNAPIS(DA,K,.LIST) supported by DBIA #2574
"RTN","PSSLOOK",9,0)
 ;Reference to $$FORMI^PSNAPIS(P1,P3) supported by DBIA #2574
"RTN","PSSLOOK",10,0)
 ;Reference to $$PSJDF^PSNAPIS(P1,P3) supported by DBIA #2531
"RTN","PSSLOOK",11,0)
 ;Reference to $$PSJST^PSNAPIS(P1,P3) supported by DBIA #2531
"RTN","PSSLOOK",12,0)
 ;Reference to $$PROD2^PSNAPIS(P1,P3) supported by DBIA #2531
"RTN","PSSLOOK",13,0)
 ;Reference to $$CPTIER^PSNAPIS(P1,P3) supported by DBIA #2531
"RTN","PSSLOOK",14,0)
 ;Reference to $$VAGN^PSNAPIS(P1) supported by DBIA #2531
"RTN","PSSLOOK",15,0)
 ;Reference to ^PSNDF(50.68 supported by DBIA 3735
"RTN","PSSLOOK",16,0)
 ;Reference to DATA^PSN50P68 supported by DBIA 4545
"RTN","PSSLOOK",17,0)
 ;Reference to FD & FDT^PSNACT supported by DBIA #6754
"RTN","PSSLOOK",18,0)
 ;
"RTN","PSSLOOK",19,0)
START S QUIT=0,PSSFG=0 D KILL F PSSXX=1:1 D PICK Q:PSSFG
"RTN","PSSLOOK",20,0)
DONE D KILL K PSSFG,PSSXX,QUIT,FM,FMS,Y2K
"RTN","PSSLOOK",21,0)
 Q
"RTN","PSSLOOK",22,0)
PICK W ! K DIC S DIC="^PSDRUG(",DIC(0)="AEQMVTN",DIC("T")="",DIC("W")="S PSSTDRUG=Y D GETTIER^PSSDEE(PSSTDRUG)" D ^DIC K DIC I Y<0 S PSSFG=1 Q
"RTN","PSSLOOK",23,0)
 S IFN=+Y D NDDATA,GETDATA,INACT,NOD66,FORMAT,KILL
"RTN","PSSLOOK",24,0)
 Q
"RTN","PSSLOOK",25,0)
NDDATA I $D(^PSDRUG(IFN,"ND")) S CLPTR=$P(^PSDRUG(IFN,"ND"),"^",6) I $P(^PSDRUG(IFN,"ND"),"^",2)]"" S NDNODE=^PSDRUG(IFN,"ND"),VAGNPTR=$P(NDNODE,"^",1),VAPN=$P(NDNODE,"^",2),SZPTR=$P(NDNODE,"^",4),TYPTR=$P(NDNODE,"^",5) D NDF,NDF1
"RTN","PSSLOOK",26,0)
 Q
"RTN","PSSLOOK",27,0)
NDF S DA=VAGNPTR,X=$$VAGN^PSNAPIS(DA),VAGN=X,PS=$P(^PS(50.609,SZPTR,0),"^",1),PT=$P(^PS(50.608,TYPTR,0),"^",1),P3=$P(NDNODE,"^",3)
"RTN","PSSLOOK",28,0)
 K X S DA=VAGNPTR,K=P3,X=$$PROD2^PSNAPIS(DA,K) I X]"",$P(X,"^")]"" S VAPRN=$P(X,"^"),VADU=$P(X,"^",4),CMOPID=$P(X,"^",2)
"RTN","PSSLOOK",29,0)
 S CSF="" I $P(NDNODE,"^",3) S CSF=$$GET1^DIQ(50.68,$P(NDNODE,"^",3),19,"I")
"RTN","PSSLOOK",30,0)
 ;
"RTN","PSSLOOK",31,0)
 S (PSSNIEN,CSF)="",PSSNIEN=$P(NDNODE,"^",3)
"RTN","PSSLOOK",32,0)
 K ^TMP($J,"PSNVAPR"),PSSHTH,PSSHTD,PSSPEPAC,PSSDOTSN
"RTN","PSSLOOK",33,0)
 I PSSNIEN'="" D DATA^PSN50P68(PSSNIEN,"","PSNVAPR")  ;using the PRE encapuslation API instead
"RTN","PSSLOOK",34,0)
 I $D(^TMP($J,"PSNVAPR",PSSNIEN)) D
"RTN","PSSLOOK",35,0)
 .S:$G(^TMP($J,"PSNVAPR",PSSNIEN,19))'="" CSF=$P(^TMP($J,"PSNVAPR",PSSNIEN,19),"^")
"RTN","PSSLOOK",36,0)
 .S:$G(^TMP($J,"PSNVAPR",PSSNIEN,5))'="" VAPRN=^TMP($J,"PSNVAPR",PSSNIEN,5)
"RTN","PSSLOOK",37,0)
 .S:$G(^TMP($J,"PSNVAPR",PSSNIEN,6))'="" CMOPID=^TMP($J,"PSNVAPR",PSSNIEN,6)
"RTN","PSSLOOK",38,0)
 .; Hazardous Waste fields
"RTN","PSSLOOK",39,0)
 .S (PSSHTH,PSSHTD,PSSPEPAC,PSSWSC,PSSDOTSN)=""
"RTN","PSSLOOK",40,0)
 .S:$G(^TMP($J,"PSNVAPR",PSSNIEN,101))'="" PSSHTH=^TMP($J,"PSNVAPR",PSSNIEN,101)
"RTN","PSSLOOK",41,0)
 .S:$G(^TMP($J,"PSNVAPR",PSSNIEN,102))'="" PSSHTD=^TMP($J,"PSNVAPR",PSSNIEN,102)
"RTN","PSSLOOK",42,0)
 .S:$G(^TMP($J,"PSNVAPR",PSSNIEN,103))'="" PSSPEPAC=^TMP($J,"PSNVAPR",PSSNIEN,103)
"RTN","PSSLOOK",43,0)
 .S:$G(^TMP($J,"PSNVAPR",PSSNIEN,104))'="" PSSWSC=^TMP($J,"PSNVAPR",PSSNIEN,104)
"RTN","PSSLOOK",44,0)
 .S HAZWCNT2=1,HAZWCNT=0,DIWL=1,DIWR=50
"RTN","PSSLOOK",45,0)
 .F  S HAZWCNT=$O(^TMP($J,"PSNVAPR",PSSNIEN,105,HAZWCNT)) Q:'HAZWCNT  D
"RTN","PSSLOOK",46,0)
 .. S X="",X=^TMP($J,"PSNVAPR",PSSNIEN,105,HAZWCNT) S PSSDOTSN(HAZWCNT)=X
"RTN","PSSLOOK",47,0)
 Q
"RTN","PSSLOOK",48,0)
IT S CMOPID=$P(X,"^",2)
"RTN","PSSLOOK",49,0)
 Q
"RTN","PSSLOOK",50,0)
NDF1 S X=$$PSJDF^PSNAPIS(DA,K),VADF=$P(X,"^",2)
"RTN","PSSLOOK",51,0)
 Q
"RTN","PSSLOOK",52,0)
INACT S ACT="" I $D(^PSDRUG(IFN,"I")) S Y=$P(^PSDRUG(IFN,"I"),"^",1) X ^DD("DD") S ACT=Y
"RTN","PSSLOOK",53,0)
 Q
"RTN","PSSLOOK",54,0)
GETDATA S NODE0=^PSDRUG(IFN,0),GN=$P(NODE0,"^",1),CL=$P(NODE0,"^",2),DEA=$P(NODE0,"^",3),WRN=$P(NODE0,"^",8),NF=$P(NODE0,"^",9),MESS=$P(NODE0,"^",10),VNF=$P(NODE0,"^",11),CLASS="",WARN="" S:NF=1 NF="N/F" S:VNF=1 VNF="V-N/F"
"RTN","PSSLOOK",55,0)
 S PSSNODE=$G(^PSDRUG(IFN,"DOS"))
"RTN","PSSLOOK",56,0)
 I CL]"" S CLASS=CL_"  "_$P(^PS(50.605,CLPTR,0),"^",2)
"RTN","PSSLOOK",57,0)
 I $D(^PSDRUG(IFN,3)) S:$P(^PSDRUG(IFN,3),"^")=0 CMOP="NO" S:$P(^PSDRUG(IFN,3),"^")=1 CMOP="YES"
"RTN","PSSLOOK",58,0)
 I $D(^PSDRUG(IFN,5)) S QDM=^PSDRUG(IFN,5)
"RTN","PSSLOOK",59,0)
 S OINM="" S NDC="" I $D(^PSDRUG(IFN,2)) S NODE2=^PSDRUG(IFN,2) S:$P(NODE2,"^",1)]"" OIPTR=$P(NODE2,"^",1) S NDC=$P(NODE2,"^",4) S:$P(NODE2,"^",6)]"" PDPTR=$P(NODE2,"^",6) S APP=$P(NODE2,"^",3),FM="" D TWOA
"RTN","PSSLOOK",60,0)
 Q
"RTN","PSSLOOK",61,0)
TWOA I $D(OIPTR) S OI=$P(^PS(50.7,OIPTR,0),"^",1),DFPTR=$P(^PS(50.7,OIPTR,0),"^",2),DF=$P(^PS(50.606,DFPTR,0),"^",1),FMS=$P(^PS(50.7,OIPTR,0),"^",12) S:FMS]"" FM=" (N/F)" S OINM=OI_" "_DF_FM
"RTN","PSSLOOK",62,0)
 ;I $D(PDPTR) S PD=$P(^PS(50.3,PDPTR,0),"^",1)
"RTN","PSSLOOK",63,0)
 Q
"RTN","PSSLOOK",64,0)
NOD66 S (DUPOU,PPDU,PPOU,DU,SS)="" I $D(^PSDRUG(IFN,660)) S NDE=^PSDRUG(IFN,660),OUPTR=$P(NDE,"^",2),PPOU=$P(NDE,"^",3),DUPOU=$P(NDE,"^",5),PPDU=$P(NDE,"^",6),SS=$P(NDE,"^",7),DU=$P(NDE,"^",8) I OUPTR]"" S OU=$P(^DIC(51.5,OUPTR,0),"^")
"RTN","PSSLOOK",65,0)
 Q
"RTN","PSSLOOK",66,0)
SYN I $D(^PSDRUG(IFN,1,0)) F ZZZ=0:0 S ZZZ=$O(^PSDRUG(IFN,1,ZZZ)) Q:'ZZZ  S SYNM=$P(^PSDRUG(IFN,1,ZZZ,0),"^",1),INT=$P(^PSDRUG(IFN,1,ZZZ,0),"^",3) D SYN1
"RTN","PSSLOOK",67,0)
 Q
"RTN","PSSLOOK",68,0)
SYN1 S INT=$S(INT=0:"Trade Name",INT=1:"Quick Code",INT="C":"Ctrl Substances",INT="D":"Drug Accountability",1:"") D FULL Q:$G(QUIT)  W ?14,SYNM,?55,INT,!
"RTN","PSSLOOK",69,0)
 Q
"RTN","PSSLOOK",70,0)
SYN2 S:INT=0 INT="Trade" S:INT=1 INT="Quick" S:INT="C" INT="Ctrl Subs" S:INT="D" INT="Drug Acct" W ?16,SYNM,?57,INT,!
"RTN","PSSLOOK",71,0)
 Q
"RTN","PSSLOOK",72,0)
IFCAP I $D(^PSDRUG(IFN,441,0)) F QQQ=0:0 S QQQ=$O(^PSDRUG(IFN,441,QQQ)) Q:'QQQ  S IFCAPNM=$P(^PSDRUG(IFN,441,QQQ,0),"^",1)
"RTN","PSSLOOK",73,0)
 Q
"RTN","PSSLOOK",74,0)
FORMAT ; BEGIN WRITING
"RTN","PSSLOOK",75,0)
 N DAW
"RTN","PSSLOOK",76,0)
 W @IOF,"DRUG NAME: ",GN,"  (IEN: ",IFN,")",!
"RTN","PSSLOOK",77,0)
 F XX=1:1:77 W "="
"RTN","PSSLOOK",78,0)
 W !
"RTN","PSSLOOK",79,0)
 W:$D(VAPRN) "VA PRINT NAME: ",?17,VAPRN W:$D(CMOPID) ?60,"CMOP ID#: ",CMOPID W:$D(VAPN) !,"VA PRODUCT NAME: ",?17,VAPN W:$D(CMOP) ?60,"CMOP DISPENSE: ",CMOP
"RTN","PSSLOOK",80,0)
 W:$D(OINM) !,"ORDERABLE ITEM: ",?17,OINM W:$D(VAPN) ?60,"NDF DF: ",VADF
"RTN","PSSLOOK",81,0)
 I $D(OIPTR),OIPTR]"" W !,"ORDERABLE ITEM TEXT: ",! D OITXT
"RTN","PSSLOOK",82,0)
 W:$D(PD) !,"PRIMARY DRUG: ",?17,PD
"RTN","PSSLOOK",83,0)
 W !,"SYNONYM(S): " D SYN D FULL Q:$G(QUIT)  W !,"MESSAGE: ",MESS,!
"RTN","PSSLOOK",84,0)
 D FULL Q:$G(QUIT)  F XX=1:1:77 W "-"
"RTN","PSSLOOK",85,0)
 W !
"RTN","PSSLOOK",86,0)
 D FULL Q:$G(QUIT)  W "DEA, SPECIAL HDLG: ",DEA,?48,"NDC: ",?63,NDC
"RTN","PSSLOOK",87,0)
 S DAW=+$$GET1^DIQ(50,IFN,81)
"RTN","PSSLOOK",88,0)
 D FULL Q:$G(QUIT)  W !,"DAW CODE:  ",DAW," - ",$$DAWEXT^PSSDAWUT(DAW)
"RTN","PSSLOOK",89,0)
 D FULL Q:$G(QUIT)  W !,"CS FEDERAL SCHEDULE: ",$G(CSF)
"RTN","PSSLOOK",90,0)
 ;
"RTN","PSSLOOK",91,0)
 ;Hazardous Waste
"RTN","PSSLOOK",92,0)
 W !
"RTN","PSSLOOK",93,0)
 S PSSHTDX=0
"RTN","PSSLOOK",94,0)
 I $G(PSSHTD)=1 S PSSHTDX=1
"RTN","PSSLOOK",95,0)
 D FULL Q:$G(QUIT)  W:$G(PSSHTH)'="" !,"Hazardous to Handle: ",$S(PSSHTH=1:"YES",PSSHTH=0:"NO",1:"")
"RTN","PSSLOOK",96,0)
 D FULL Q:$G(QUIT)  W:$G(PSSHTD)'="" !,"Hazardous to Dispose: ",$S(PSSHTD=1:"YES",PSSHTD=0:"NO",1:"")
"RTN","PSSLOOK",97,0)
 I $G(PSSPEPAC)'=""&(PSSHTDX) D FULL Q:$G(QUIT)  W !,"        Primary EPA Code: ",PSSPEPAC
"RTN","PSSLOOK",98,0)
 I $G(PSSWSC)'=""&(PSSHTDX) D FULL Q:$G(QUIT)  W !,"         Waste Sort Code: ",PSSWSC
"RTN","PSSLOOK",99,0)
 ;
"RTN","PSSLOOK",100,0)
 N HAZWCNT,HAZWCNT2,X,DIWL,DIWR,DIWF
"RTN","PSSLOOK",101,0)
 K ^UTILITY($J,"W")
"RTN","PSSLOOK",102,0)
 S HAZWCNT=0,HAZWCNT2=1,HAZWCNT=0,DIWL=1,DIWR=50
"RTN","PSSLOOK",103,0)
 F  S HAZWCNT=$O(PSSDOTSN(HAZWCNT)) Q:HAZWCNT=""  S X=PSSDOTSN(HAZWCNT) D ^DIWP
"RTN","PSSLOOK",104,0)
 S HAZWCNT=0 F  S HAZWCNT=$O(^UTILITY($J,"W",DIWL,HAZWCNT)) Q:'HAZWCNT  D
"RTN","PSSLOOK",105,0)
 .D FULL Q:$G(QUIT)
"RTN","PSSLOOK",106,0)
 .I HAZWCNT2=1 W !,"       DOT Shipping Name: "
"RTN","PSSLOOK",107,0)
 .I HAZWCNT2>1 W !,"                          "
"RTN","PSSLOOK",108,0)
 .W $G(^UTILITY($J,"W",DIWL,HAZWCNT,0)) S HAZWCNT2=2
"RTN","PSSLOOK",109,0)
 K ^UTILITY($J,"W")
"RTN","PSSLOOK",110,0)
 ;I $G(PSSDOTSN)'=""&(PSSHTDX) D FULL Q:$G(QUIT)  W !,"       DOT Shipping Name: ",PSSDOTSN
"RTN","PSSLOOK",111,0)
 W !
"RTN","PSSLOOK",112,0)
 ;
"RTN","PSSLOOK",113,0)
 D FULL Q:$G(QUIT)  W !,"INACTIVE DATE: ",ACT
"RTN","PSSLOOK",114,0)
 D FULL Q:$G(QUIT)  W:$D(QDM) !,"QUANTITY DISPENSE MESSAGE: ",QDM,!
"RTN","PSSLOOK",115,0)
 D FULL Q:$G(QUIT)  I WRN]"" W !,"WARNING LABEL: " S X=WRN F Z0=1:1 Q:$P(X,",",Z0,99)=""  S Z1=$P(X,",",Z0) W:$D(^PS(54,Z1,0)) ?19,$P(^(0),"^",1),! I '$D(^(0)) W ?19,"NO SUCH WARNING LABEL" K X Q
"RTN","PSSLOOK",116,0)
 D FULL Q:$G(QUIT)  S PSSLOOK=1 D
"RTN","PSSLOOK",117,0)
 .N DRUG
"RTN","PSSLOOK",118,0)
 .I $P($G(^PSDRUG(IFN,0)),"^")="" K PSSLOOK Q
"RTN","PSSLOOK",119,0)
 .S PSSWSITE=+$O(^PS(59.7,0)) W !,"WARNING LABEL SOURCE is " D
"RTN","PSSLOOK",120,0)
 ..I $P($G(^PS(59.7,PSSWSITE,10)),"^",9)="N" W "set to 'NEW'" Q
"RTN","PSSLOOK",121,0)
 ..W "not set to 'NEW'"
"RTN","PSSLOOK",122,0)
 .K PSSWRN
"RTN","PSSLOOK",123,0)
 .D FULL Q:$G(QUIT)  W !,"NEW WARNING LABEL:"
"RTN","PSSLOOK",124,0)
 .S ^TMP("PSSWRNB",$J,$P(^PSDRUG(IFN,0),"^"))="" D ^PSSWRNE
"RTN","PSSLOOK",125,0)
 .K PSSLOOK,^TMP("PSSWRNB",$J),PSSWRN
"RTN","PSSLOOK",126,0)
 D FULL Q:$G(QUIT)  W:'$D(QDM) ! F XX=1:1:77 W "-"
"RTN","PSSLOOK",127,0)
 D FULL Q:$G(QUIT)  W !
"RTN","PSSLOOK",128,0)
 W "ORDER UNIT: ",?27 W:$D(OU) OU W ?40,"PRICE/ORDER UNIT: ",?67,PPOU
"RTN","PSSLOOK",129,0)
 D FULL Q:$G(QUIT)  W !,"DISPENSE UNIT: ",?27,DU W:$D(VADU) ?40,"VA DISPENSE UNIT: ",?67,VADU
"RTN","PSSLOOK",130,0)
 D FULL Q:$G(QUIT)  W !,"DISPENSE UNITS/ORDER UNIT: ",?21,DUPOU,?40,"PRICE/DISPENSE UNIT: ",?67,PPDU
"RTN","PSSLOOK",131,0)
 D FULL Q:$G(QUIT)  W !,"NCPDP DISPENSE UNIT: ",$$GET1^DIQ(50,IFN,82),?40,"NCPDP QUANTITY MULTIPLIER: ",?67,$J($$GET1^DIQ(50,IFN,83),8,3)
"RTN","PSSLOOK",132,0)
 D FULL Q:$G(QUIT)  W !,"MAXIMUM DAYS SUPPLY: ",$$GET1^DIQ(50,IFN,66)
"RTN","PSSLOOK",133,0)
 D FULL Q:$G(QUIT)  W !,"ePharmacy Billable: ",$$GET1^DIQ(50,IFN,84)
"RTN","PSSLOOK",134,0)
 D FULL Q:$G(QUIT)  W !?2,"ePharmacy Billable (TRICARE): ",$$GET1^DIQ(50,IFN,85) W ?40,"ePharmacy Billable (CHAMPVA): ",$$GET1^DIQ(50,IFN,86)
"RTN","PSSLOOK",135,0)
 D FULL Q:$G(QUIT)  W !,"Sensitive Diagnosis Drug: ",$$GET1^DIQ(50,IFN,87) W !
"RTN","PSSLOOK",136,0)
 D FULL Q:$G(QUIT)  W !,"APPL PKG USE:" S APPL="" S:'$D(APP) APPL="  NONE"
"RTN","PSSLOOK",137,0)
 I $D(APP) D
"RTN","PSSLOOK",138,0)
 . S:APP["O" APPL=APPL_"  Outpatient" S:APP["U" APPL=APPL_"  Unit Dose"
"RTN","PSSLOOK",139,0)
 . S:APP["I" APPL=APPL_"  IV" S:APP["W" APPL=APPL_"  Ward Stock"
"RTN","PSSLOOK",140,0)
 . S:APP["N" APPL=APPL_"  Control Subs" S:APP["X" APPL=APPL_"  Non-VA Med"
"RTN","PSSLOOK",141,0)
 . S:APPL="" APPL="  NONE"
"RTN","PSSLOOK",142,0)
 W ?13,APPL
"RTN","PSSLOOK",143,0)
 I $P(PSSNODE,"^",2) S (PSSCALC,PSSUNIT)=$P($G(^PS(50.607,+$P(PSSNODE,U,2),0)),U),PSSSTR=$P(PSSNODE,"^")
"RTN","PSSLOOK",144,0)
 I $G(PSSUNIT)'="",$G(PSSUNIT)["/" D UNCALC
"RTN","PSSLOOK",145,0)
 D FULL Q:$G(QUIT)  W !,"STRENGTH: ",$S($E($P(PSSNODE,U),1)=".":"0",1:"")_$P(PSSNODE,U),?35,"UNIT: ",$G(PSSCALC)
"RTN","PSSLOOK",146,0)
 D FULL Q:$G(QUIT)  W !,"POSSIBLE DOSAGES:"
"RTN","PSSLOOK",147,0)
 I $D(^PSDRUG(IFN,"DOS1",0)) F PDS=0:0 S PDS=$O(^PSDRUG(IFN,"DOS1",PDS)) Q:'PDS  D
"RTN","PSSLOOK",148,0)
 .S POSDOS=^PSDRUG(IFN,"DOS1",PDS,0)
"RTN","PSSLOOK",149,0)
 .D FULL Q:$G(QUIT)  W !,"   DISPENSE UNITS PER DOSE: ",$S($E($P(POSDOS,U),1)=".":"0",1:"")_$P(POSDOS,U),?40,"DOSE: ",$S($E($P(POSDOS,U,2),1)=".":"0",1:"")_$P(POSDOS,U,2),?55,"PACKAGE: ",$P(POSDOS,U,3)
"RTN","PSSLOOK",150,0)
 .D FULL Q:$G(QUIT)  W !,"       BCMA UNITS PER DOSE: ",$P(POSDOS,U,4)
"RTN","PSSLOOK",151,0)
 D FULL Q:$G(QUIT)  W !,"LOCAL POSSIBLE DOSAGES:"
"RTN","PSSLOOK",152,0)
 I $D(^PSDRUG(IFN,"DOS2",0)) F PDS=0:0 S PDS=$O(^PSDRUG(IFN,"DOS2",PDS)) Q:'PDS  D
"RTN","PSSLOOK",153,0)
 .S LPDOS=^PSDRUG(IFN,"DOS2",PDS,0)
"RTN","PSSLOOK",154,0)
 .D FULL Q:$G(QUIT)  W !,"   LOCAL POSSIBLE DOSAGE: " D
"RTN","PSSLOOK",155,0)
 ..I $L($P(LPDOS,U))'>27 W $P(LPDOS,U),?55,"PACKAGE: ",$P(LPDOS,U,2)
"RTN","PSSLOOK",156,0)
 ..E   W !,?10,$P(LPDOS,U),!,?55,"PACKAGE: ",$P(LPDOS,U,2)
"RTN","PSSLOOK",157,0)
 ..D FULL Q:$G(QUIT)  W !,"     BCMA UNITS PER DOSE: ",$P(LPDOS,U,3) D FULL Q:$G(QUIT)  D LPDNW
"RTN","PSSLOOK",158,0)
 D FULL Q:$G(QUIT)  W ! F XX=1:1:77 W "-"
"RTN","PSSLOOK",159,0)
 D FULL Q:$G(QUIT)  W !,"VA CLASS: ",$G(CLASS)
"RTN","PSSLOOK",160,0)
 D FULL Q:$G(QUIT)  W !,"LOCAL NON-FORMULARY: ",$G(NF),"          ","VISN NON-FORMULARY: ",$G(VNF)
"RTN","PSSLOOK",161,0)
 N DA,K,LIST,PSXDN,PSXGN,PSXVP,X,XX1,XX2
"RTN","PSSLOOK",162,0)
 K PSXGN,PSXVP I $D(^PSDRUG(IFN,"ND")) S PSXDN=$G(^PSDRUG(IFN,"ND")),PSXGN=$P(PSXDN,"^"),PSXVP=$P(PSXDN,"^",3)
"RTN","PSSLOOK",163,0)
 I $G(PSXGN),$G(PSXVP) S X=$$PROD2^PSNAPIS(PSXGN,PSXVP),XX1=$$FORMI^PSNAPIS(PSXGN,PSXVP)
"RTN","PSSLOOK",164,0)
 D FULL Q:$G(QUIT)  W !,"National Formulary Indicator: "_$S($G(XX1)=1:"YES",$G(XX1)=0:"NO",1:"Not Matched to NDF")
"RTN","PSSLOOK",165,0)
 I PSXVP'="" D FD^PSNACT(PSXVP) ;PPSN
"RTN","PSSLOOK",166,0)
 I $D(^PSDRUG(IFN,65,0)) D FULL Q:$G(QUIT)  W !,"FORMULARY ALTERNATIVES: ",! F FA=0:0 S FA=$O(^PSDRUG(IFN,65,FA)) Q:'FA  S LDFPTR=$P($G(^PSDRUG(IFN,65,FA,0)),"^") I LDFPTR D FULL Q:$G(QUIT)  W ?26,$P($G(^PSDRUG(LDFPTR,0)),"^"),!
"RTN","PSSLOOK",167,0)
 N CPDATE,PSSTIER D NOW^%DTC S CPDATE=$P(%,".") S PSSTIER=$$CPTIER^PSNAPIS($P($G(^PSDRUG(IFN,"ND")),"^",3),CPDATE,IFN,1) K CPDATE,%
"RTN","PSSLOOK",168,0)
 ;  PSSTIER = Copay Tier^Effective Date^End Date
"RTN","PSSLOOK",169,0)
 W !,"Copay Tier: ",$P(PSSTIER,"^",1)
"RTN","PSSLOOK",170,0)
 W !,"Copay Effective Date: " S Y=$P(PSSTIER,"^",2) D DD^%DT W Y K Y
"RTN","PSSLOOK",171,0)
 D FULL Q:$G(QUIT)  I $G(PSXGN),$G(PSXVP) W !,"National Restriction: " S XX2=$$FORMRX^PSNAPIS(PSXGN,PSXVP,.LIST) I $G(XX2)=1,$D(LIST) F XX2=0:0 S XX2=$O(LIST(XX2)) Q:'XX2  D FULL Q:$G(QUIT)  W !,LIST(XX2,0)
"RTN","PSSLOOK",172,0)
 I PSXVP'="" D FDT^PSNACT(PSXVP) ;ppsn
"RTN","PSSLOOK",173,0)
 W !,"Local Drug Text: ",! I $D(^PSDRUG(IFN,9,0)) D LDT
"RTN","PSSLOOK",174,0)
 Q
"RTN","PSSLOOK",175,0)
LDT F TXT1=0:0 S TXT1=$O(^PSDRUG(IFN,9,TXT1)) Q:'TXT1  S TEXPTR=^PSDRUG(IFN,9,TXT1,0) F PPP=0:0 S PPP=$O(^PS(51.7,TEXPTR,2,PPP)) Q:'PPP  S PST=$P($G(^PS(51.7,TEXPTR,0)),"^",2) I 'PST S WPT=^PS(51.7,TEXPTR,2,PPP,0) D FULL Q:$G(QUIT)  W WPT,!
"RTN","PSSLOOK",176,0)
 ;
"RTN","PSSLOOK",177,0)
 ;
"RTN","PSSLOOK",178,0)
KILL K IFN,APP,INT,VADU,VAGN,VAPN,VAPRN,P3,VAGNPTR,MESS,CLASS,DEA,ACT,CL,CLPTR,CMOP,DF,DFPTR,DU,DUPOUGN,IFCAPNM,NDC,NDE,NDNODE,NF,NODE0,NODE2,OI,OINM,OIPTR,OU,PD,PDPTR,PPDU,PPOU,PS,PT,NOD66,SYNM,SZPTR,TYPTR,WARN,WRN,XX,ZZZ,SS,OUPTR,CMOPID
"RTN","PSSLOOK",179,0)
 K DUPOU,QQQ,GN,QDM,APPL,VADF,DFP,DFRM,Y,Z0,Z1,DDD,PPP,TEXT,TXTPTR,TXT,TXT1,TEXPTR,VNF,WPT,FA,LDFPTR,TEXTPTR,QUIT,PST,D0,DA,K,DIR
"RTN","PSSLOOK",180,0)
 K PSSNODE,PSDOSUN,PDS,POSDOS,LPDOS,CSF,PSSSTR,PSSUNIT,PSSCALC,PSSTIER
"RTN","PSSLOOK",181,0)
 K ^TMP($J,"PSNVAPR")
"RTN","PSSLOOK",182,0)
 K PSSWSC,PSSNIEN,PSSHTH,PSSHTD,PSSPEPAC,PSSDOTSN,PSSCLEF,PSSPKG,PSSOMIT,PSSEXLMT,PSSHTDX,PSSII,PSSIII
"RTN","PSSLOOK",183,0)
 Q
"RTN","PSSLOOK",184,0)
OITXT I $D(^PS(50.7,OIPTR,1,0)) F TXT=0:0 S TXT=$O(^PS(50.7,OIPTR,1,TXT)) Q:'TXT  S TEXTPTR=^PS(50.7,OIPTR,1,TXT,0) F DDD=0:0 S DDD=$O(^PS(51.7,TEXTPTR,2,DDD)) Q:'DDD  D IDATE I 'Y2K S TEXT=^PS(51.7,TEXTPTR,2,DDD,0) D FULL Q:$G(QUIT)  W TEXT,!
"RTN","PSSLOOK",185,0)
 Q
"RTN","PSSLOOK",186,0)
FULL D:($Y+5)>IOSL&('$G(QUIT)) FSCRN
"RTN","PSSLOOK",187,0)
 Q
"RTN","PSSLOOK",188,0)
FSCRN Q:$G(QUIT)  W ! K DIR S DIR(0)="E",DIR("A")="Press Return to continue,'^' to exit" D ^DIR W @IOF S:Y'=1 QUIT=1
"RTN","PSSLOOK",189,0)
 Q
"RTN","PSSLOOK",190,0)
IDATE S Y2K=$P($G(^PS(51.7,TEXTPTR,0)),"^",2)
"RTN","PSSLOOK",191,0)
 Q
"RTN","PSSLOOK",192,0)
UNCALC ;
"RTN","PSSLOOK",193,0)
 N PSSVA,PSSVA1,PSSVB,PSSVB1,PSSDASH,PSSNDFS,PSSDASH2,PSSDASH3,PSSDASH5 K PSSCALC
"RTN","PSSLOOK",194,0)
 S PSSDASH=0 S PSSNDFS=$$PSJST^PSNAPIS(+$P($G(^PSDRUG(IFN,"ND")),"^"),+$P($G(^PSDRUG(IFN,"ND")),"^",3)) S PSSNDFS=+$P($G(PSSNDFS),"^",2)
"RTN","PSSLOOK",195,0)
 I $G(PSSNDFS),$G(PSSSTR),+$G(PSSSTR)'=+$G(PSSNDFS) S PSSDASH=1
"RTN","PSSLOOK",196,0)
 S PSSVA=$P(PSSUNIT,"/"),PSSVB=$P(PSSUNIT,"/",2),PSSVA1=+$G(PSSVA),PSSVB1=+$G(PSSVB)
"RTN","PSSLOOK",197,0)
 I $G(PSSDASH) S PSSDASH2=PSSSTR/PSSNDFS,PSSDASH3=PSSDASH2*$S($G(PSSVB1):PSSVB1,1:1) S PSSDASH5=$S('$G(PSSVB1):PSSDASH3_$G(PSSVB),1:PSSDASH3_$P(PSSVB,PSSVB1,2))
"RTN","PSSLOOK",198,0)
 S PSSCALC=$S($G(PSSDASH):$S('$G(PSSVA1):PSSVA,1:$P(PSSVA1,PSSVA1,2))_"/"_$G(PSSDASH5),1:PSSUNIT)
"RTN","PSSLOOK",199,0)
 Q
"RTN","PSSLOOK",200,0)
 ;
"RTN","PSSLOOK",201,0)
LPDNW ;Display Dose Unit and Numeric Dose fields, added with patch PSS*1*147
"RTN","PSSLOOK",202,0)
 N PSSLKL1,PSSLKL2,PSSLKL3,PSSLKL4
"RTN","PSSLOOK",203,0)
 S PSSLKL4=""
"RTN","PSSLOOK",204,0)
 S PSSLKL1=$P(LPDOS,"^",5),PSSLKL2=$P(LPDOS,"^",6)
"RTN","PSSLOOK",205,0)
 I PSSLKL1 S PSSLKL4=$P($G(^PS(51.24,+PSSLKL1,0)),"^")
"RTN","PSSLOOK",206,0)
 S PSSLKL3=$S($E(PSSLKL2)=".":"0",1:"")_PSSLKL2
"RTN","PSSLOOK",207,0)
 I $L(PSSLKL3)<18 D FULL Q:$G(QUIT)  W !?5,"NUMERIC DOSE: "_PSSLKL3,?38,"DOSE UNIT: "_PSSLKL4 Q
"RTN","PSSLOOK",208,0)
 D FULL Q:$G(QUIT)  W !?5,"NUMERIC DOSE: "_PSSLKL3
"RTN","PSSLOOK",209,0)
 D FULL Q:$G(QUIT)  W !?38,"DOSE UNIT: "_PSSLKL4
"RTN","PSSLOOK",210,0)
 Q
"VER")
8.0^22.0
"^DD",59.7,59.7,17,0)
PPS-N ACCOUNT TYPE^RS^P:PRODUCTION;Q:NATIONAL TEST SQA;S:PRODUCT SUPPORT;T:TEST ACCOUNT;N:QA NDFMS;^10;12^Q
"^DD",59.7,59.7,17,.1)
PPS-N Account Type
"^DD",59.7,59.7,17,3)
Only the National Test SQA team should select "Q" for SQA or "N" for QA NDFMS. All others, enter "P" for PRODUCTION, "S" for PRODUCT SUPPORT, or "T" for TEST/MIRROR ACCOUNT.  
"^DD",59.7,59.7,17,21,0)
^^8^8^3170222^
"^DD",59.7,59.7,17,21,1,0)
This field defines the type of Pharmacy Product System - 
"^DD",59.7,59.7,17,21,2,0)
National (PPS-N) account.  The account type can be one of
"^DD",59.7,59.7,17,21,3,0)
the following: "Q" for National Test SQA system, "T" for
"^DD",59.7,59.7,17,21,4,0)
Test/Mirror Account, "S" for Product Support, "N" for
"^DD",59.7,59.7,17,21,5,0)
QA NDFMS account, or "P" for Production account.
"^DD",59.7,59.7,17,21,6,0)
 
"^DD",59.7,59.7,17,21,7,0)
Local VA sites will use "P" for their production accounts
"^DD",59.7,59.7,17,21,8,0)
and "T" for their test/mirror accounts.
"^DD",59.7,59.7,17,23,0)
^.001^15^15^3170222^^^
"^DD",59.7,59.7,17,23,1,0)
The PPS-N/NDF National SQA Test Team are the only
"^DD",59.7,59.7,17,23,2,0)
users who should defined this field as "Q" for 
"^DD",59.7,59.7,17,23,3,0)
National SQA or "N" for QA NDFMS.
"^DD",59.7,59.7,17,23,4,0)
 
"^DD",59.7,59.7,17,23,5,0)
Defining the account type as "Q" or "N" flags the system 
"^DD",59.7,59.7,17,23,6,0)
that the account should define the full complement of 5000 
"^DD",59.7,59.7,17,23,7,0)
range of files utilized during the installation process and
"^DD",59.7,59.7,17,23,8,0)
for KIDS build generation.
"^DD",59.7,59.7,17,23,9,0)
 
"^DD",59.7,59.7,17,23,10,0)
Also the "Q" and "P" account types flag the system to send
"^DD",59.7,59.7,17,23,11,0)
install status information to PPS-N via the HWSC Web Service 
"^DD",59.7,59.7,17,23,12,0)
Manager "PPSN" Web Server and the UPDATE_STATUS web service 
"^DD",59.7,59.7,17,23,13,0)
manager.  For local site production accounts, the compliance
"^DD",59.7,59.7,17,23,14,0)
report in PPS-N is updated upon completion of PPS-N/NDF Update
"^DD",59.7,59.7,17,23,15,0)
file installation.
"^DD",59.7,59.7,17,"DT")
3170222
"BLD",9668,6)
^181
**END**
**END**

