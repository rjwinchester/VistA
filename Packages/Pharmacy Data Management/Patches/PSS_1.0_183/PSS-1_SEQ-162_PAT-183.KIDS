Released PSS*1*183 SEQ #162
Extracted from mail message
**KIDS**:PSS*1.0*183^

**INSTALL NAME**
PSS*1.0*183
"BLD",8885,0)
PSS*1.0*183^PHARMACY DATA MANAGEMENT^0^3140108^y
"BLD",8885,1,0)
^^4^4^3140108^^
"BLD",8885,1,1,0)
This patch modifies the Application Programming Interfaces (API), 
"BLD",8885,1,2,0)
$$DETOX^PSSOPKI to return a "1" (one) only if the drug name contains 
"BLD",8885,1,3,0)
"BUPREN" and the dosage form does not contain "PATCH", otherwise a 0 
"BLD",8885,1,4,0)
("zero").
"BLD",8885,4,0)
^9.64PA^^
"BLD",8885,6.3)
10
"BLD",8885,"ABPKG")
n
"BLD",8885,"KRN",0)
^9.67PA^779.2^20
"BLD",8885,"KRN",.4,0)
.4
"BLD",8885,"KRN",.401,0)
.401
"BLD",8885,"KRN",.402,0)
.402
"BLD",8885,"KRN",.403,0)
.403
"BLD",8885,"KRN",.5,0)
.5
"BLD",8885,"KRN",.84,0)
.84
"BLD",8885,"KRN",3.6,0)
3.6
"BLD",8885,"KRN",3.8,0)
3.8
"BLD",8885,"KRN",9.2,0)
9.2
"BLD",8885,"KRN",9.8,0)
9.8
"BLD",8885,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",8885,"KRN",9.8,"NM",1,0)
PSSOPKI^^0^B14161499
"BLD",8885,"KRN",9.8,"NM","B","PSSOPKI",1)

"BLD",8885,"KRN",19,0)
19
"BLD",8885,"KRN",19.1,0)
19.1
"BLD",8885,"KRN",101,0)
101
"BLD",8885,"KRN",409.61,0)
409.61
"BLD",8885,"KRN",771,0)
771
"BLD",8885,"KRN",779.2,0)
779.2
"BLD",8885,"KRN",870,0)
870
"BLD",8885,"KRN",8989.51,0)
8989.51
"BLD",8885,"KRN",8989.52,0)
8989.52
"BLD",8885,"KRN",8994,0)
8994
"BLD",8885,"KRN","B",.4,.4)

"BLD",8885,"KRN","B",.401,.401)

"BLD",8885,"KRN","B",.402,.402)

"BLD",8885,"KRN","B",.403,.403)

"BLD",8885,"KRN","B",.5,.5)

"BLD",8885,"KRN","B",.84,.84)

"BLD",8885,"KRN","B",3.6,3.6)

"BLD",8885,"KRN","B",3.8,3.8)

"BLD",8885,"KRN","B",9.2,9.2)

"BLD",8885,"KRN","B",9.8,9.8)

"BLD",8885,"KRN","B",19,19)

"BLD",8885,"KRN","B",19.1,19.1)

"BLD",8885,"KRN","B",101,101)

"BLD",8885,"KRN","B",409.61,409.61)

"BLD",8885,"KRN","B",771,771)

"BLD",8885,"KRN","B",779.2,779.2)

"BLD",8885,"KRN","B",870,870)

"BLD",8885,"KRN","B",8989.51,8989.51)

"BLD",8885,"KRN","B",8989.52,8989.52)

"BLD",8885,"KRN","B",8994,8994)

"BLD",8885,"QDEF")
^^^^NO^^^^NO^^NO
"BLD",8885,"QUES",0)
^9.62^^
"BLD",8885,"REQB",0)
^9.611^1^1
"BLD",8885,"REQB",1,0)
PSS*1.0*166^1
"BLD",8885,"REQB","B","PSS*1.0*166",1)

"MBREQ")
0
"PKG",517,-1)
1^1
"PKG",517,0)
PHARMACY DATA MANAGEMENT^PSS^Maintenance of Pharmacy files.
"PKG",517,20,0)
^9.402P^^
"PKG",517,22,0)
^9.49I^1^1
"PKG",517,22,1,0)
1.0^2970930^2971014^11595
"PKG",517,22,1,"PAH",1,0)
183^3140108
"PKG",517,22,1,"PAH",1,1,0)
^^4^4^3140108
"PKG",517,22,1,"PAH",1,1,1,0)
This patch modifies the Application Programming Interfaces (API), 
"PKG",517,22,1,"PAH",1,1,2,0)
$$DETOX^PSSOPKI to return a "1" (one) only if the drug name contains 
"PKG",517,22,1,"PAH",1,1,3,0)
"BUPREN" and the dosage form does not contain "PATCH", otherwise a 0 
"PKG",517,22,1,"PAH",1,1,4,0)
("zero").
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","PSSOPKI")
0^1^B14161499^B11838560
"RTN","PSSOPKI",1,0)
PSSOPKI ;BHAM ISC/MHA-New API's to CPRS for DEA/PKI Pilot Project ;03/11/02
"RTN","PSSOPKI",2,0)
 ;;1.0;PHARMACY DATA MANAGEMENT;**61,69,166,183**;9/30/97;Build 10
"RTN","PSSOPKI",3,0)
 ;Reference to ^PSNDF(50.68 supported by DBIA 3735
"RTN","PSSOPKI",4,0)
 ;
"RTN","PSSOPKI",5,0)
OIDEA(PSSXOI,PSSXOIP) ; CPRS Orderable Item call 
"RTN","PSSOPKI",6,0)
 ;returns the CS Federal Schedule code in the VA PRODUCT file (#50.68)
"RTN","PSSOPKI",7,0)
 ;or the DEA Special Hndl code depending on the "ND" node of the 
"RTN","PSSOPKI",8,0)
 ;drugs associated to the Orderable Item, and Usage passed in
"RTN","PSSOPKI",9,0)
 ;1  Sch. I Nar.
"RTN","PSSOPKI",10,0)
 ;2  II
"RTN","PSSOPKI",11,0)
 ;2n II Non-Nar.
"RTN","PSSOPKI",12,0)
 ;3  III
"RTN","PSSOPKI",13,0)
 ;3n III Non-Nar.
"RTN","PSSOPKI",14,0)
 ;4  IV
"RTN","PSSOPKI",15,0)
 ;5  V
"RTN","PSSOPKI",16,0)
 ;0  there are other active drugs
"RTN","PSSOPKI",17,0)
 ;"" no active drugs
"RTN","PSSOPKI",18,0)
 ;
"RTN","PSSOPKI",19,0)
 N PSSXOLP,PSSXOLPD,PSSXOLPX,PSSXNODD,PSSPKLX,PSSI,PSSK,PSSJ,PSSGD
"RTN","PSSOPKI",20,0)
 S (PSSXOLPD,PSSXNODD)=0 I PSSXOIP="X" G OIQ
"RTN","PSSOPKI",21,0)
 I '$G(PSSXOI)!($G(PSSXOIP)="") G OIQ
"RTN","PSSOPKI",22,0)
 S PSSPKLX=$S(PSSXOIP="I":1,PSSXOIP="U":1,1:0)
"RTN","PSSOPKI",23,0)
 F PSSXOLP=0:0 S PSSXOLP=$O(^PSDRUG("ASP",PSSXOI,PSSXOLP)) Q:'PSSXOLP  D
"RTN","PSSOPKI",24,0)
 .I $P($G(^PSDRUG(PSSXOLP,"I")),"^"),$P($G(^("I")),"^")<DT Q
"RTN","PSSOPKI",25,0)
 .I 'PSSPKLX,$P($G(^PSDRUG(PSSXOLP,2)),"^",3)'["O" Q
"RTN","PSSOPKI",26,0)
 .I PSSPKLX I $P($G(^PSDRUG(PSSXOLP,2)),"^",3)'["U",$P($G(^(2)),"^",3)'["I" Q
"RTN","PSSOPKI",27,0)
 .S PSSXNODD=1,PSSJ=($P($G(^PSDRUG(PSSXOLP,0)),"^",3)) S:PSSJ]"" PSSGD(PSSJ)=""
"RTN","PSSOPKI",28,0)
 .I +$P($G(^PSDRUG(PSSXOLP,"ND")),"^",3) S PSSK=$P(^("ND"),"^",3) D
"RTN","PSSOPKI",29,0)
 ..I +$P($G(^PSNDF(50.68,PSSK,7)),"^") S PSSK=$P(^(7),"^"),PSSI($S($E(PSSK,2)="n":$E(PSSK)_".5",1:PSSK))=""
"RTN","PSSOPKI",30,0)
 G:$O(PSSI(""))]"" CSS
"RTN","PSSOPKI",31,0)
 S PSSXOLPX="" F  S PSSXOLPX=$O(PSSGD(PSSXOLPX)) Q:PSSXOLPX=""  D
"RTN","PSSOPKI",32,0)
 .I PSSXOLPX[1 S PSSI(1)="" Q
"RTN","PSSOPKI",33,0)
 .I PSSXOLPX[2,PSSXOLPX'["C" S PSSI(2)="" Q
"RTN","PSSOPKI",34,0)
 .I PSSXOLPX[2,PSSXOLPX["C" S PSSI(2.5)="" Q
"RTN","PSSOPKI",35,0)
 .I PSSXOLPX[3,PSSXOLPX'["C" S PSSI(3)="" Q
"RTN","PSSOPKI",36,0)
 .I PSSXOLPX[3,PSSXOLPX["C" S PSSI(3.5)="" Q
"RTN","PSSOPKI",37,0)
 .I PSSXOLPX[4 S PSSI(4)="" Q
"RTN","PSSOPKI",38,0)
 .I PSSXOLPX[5 S PSSI(5)=""
"RTN","PSSOPKI",39,0)
CSS S PSSK=0 S PSSK=$O(PSSI(PSSK)) I PSSK S PSSXOLPD=$E(PSSK)_$S($L(PSSK)>1:"n",1:"")
"RTN","PSSOPKI",40,0)
OIQ I PSSXOLPD=0 S:'PSSXNODD PSSXOLPD=""
"RTN","PSSOPKI",41,0)
 I +PSSXOLPD=1!(+PSSXOLPD=2) S PSSXOLPD=1_";"_PSSXOLPD
"RTN","PSSOPKI",42,0)
 I +PSSXOLPD=3!(+PSSXOLPD=4)!(+PSSXOLPD=5) S PSSXOLPD=2_";"_PSSXOLPD
"RTN","PSSOPKI",43,0)
 Q PSSXOLPD
"RTN","PSSOPKI",44,0)
 ;
"RTN","PSSOPKI",45,0)
DEAPKI(PSSDIENM) ;Return CS Federal Sch or the DEA Special Hndl for CPRS Dose Call - PKI Project
"RTN","PSSOPKI",46,0)
 Q:'$G(PSSDIENM)
"RTN","PSSOPKI",47,0)
 N PSSDEAX,PSSDEAXV,PSSJ
"RTN","PSSOPKI",48,0)
 I +$P($G(^PSDRUG(PSSDIENM,"ND")),"^",3) S PSSDEAX=$P(^("ND"),"^",3) D
"RTN","PSSOPKI",49,0)
 .I +$P($G(^PSNDF(50.68,PSSDEAX,7)),"^") S PSSDEAXV=$P(^(7),"^"),PSSJ=1
"RTN","PSSOPKI",50,0)
 G:$G(PSSJ) DSET
"RTN","PSSOPKI",51,0)
 S PSSDEAX=$P($G(^PSDRUG(PSSDIENM,0)),"^",3)
"RTN","PSSOPKI",52,0)
 I PSSDEAX[1 S PSSDEAXV=1 G DSET
"RTN","PSSOPKI",53,0)
 I PSSDEAX[2,PSSDEAX'["C" S PSSDEAXV=2 G DSET
"RTN","PSSOPKI",54,0)
 I PSSDEAX[2,PSSDEAX["C" S PSSDEAXV="2n" G DSET
"RTN","PSSOPKI",55,0)
 I PSSDEAX[3,PSSDEAX'["C" S PSSDEAXV=3 G DSET
"RTN","PSSOPKI",56,0)
 I PSSDEAX[3,PSSDEAX["C" S PSSDEAXV="3n" G DSET
"RTN","PSSOPKI",57,0)
 I PSSDEAX[4 S PSSDEAXV=4 G DSET
"RTN","PSSOPKI",58,0)
 I PSSDEAX[5 S PSSDEAXV=5 G DSET
"RTN","PSSOPKI",59,0)
 S PSSDEAXV=0
"RTN","PSSOPKI",60,0)
DSET ;
"RTN","PSSOPKI",61,0)
 I +PSSDEAXV=1!(+PSSDEAXV=2) S PSSDEAXV=1_";"_PSSDEAXV
"RTN","PSSOPKI",62,0)
 I +PSSDEAXV=3!(+PSSDEAXV=4)!(+PSSDEAXV=5) S PSSDEAXV=2_";"_PSSDEAXV
"RTN","PSSOPKI",63,0)
 S PSSX("DD",PSSDIENM)=PSSX("DD",PSSDIENM)_"^"_PSSDEAXV_"^"_$S($D(PSSHLF(PSSDIENM)):1,1:0)
"RTN","PSSOPKI",64,0)
 Q
"RTN","PSSOPKI",65,0)
 ;
"RTN","PSSOPKI",66,0)
DETOX(PSSDIEN) ;Returns 1 if the drug is a detox drug - drug name contains "BUPREN" & the dosage form is not a patch
"RTN","PSSOPKI",67,0)
 Q:'$G(PSSDIEN) 0
"RTN","PSSOPKI",68,0)
 Q:$P($G(^PSDRUG(PSSDIEN,0)),"^")'["BUPREN" 0
"RTN","PSSOPKI",69,0)
 N PSSJ,PSSY,PSSNDF S PSSJ=1
"RTN","PSSOPKI",70,0)
 I +$P($G(^PSDRUG(PSSDIEN,"ND")),"^",3) S PSSNDF=$P(^("ND"),"^",3) D  Q PSSJ
"RTN","PSSOPKI",71,0)
 .S PSSY=+$P($G(^PSNDF(50.68,PSSNDF,0)),"^",3) I $P($G(^PS(50.606,PSSY,0)),"^")["PATCH" S PSSJ=0
"RTN","PSSOPKI",72,0)
 S PSSY=$P($G(^PSDRUG(PSSDIEN,2)),"^") I PSSY,$P($G(^PS(50.606,$P(^PS(50.7,PSSY,0),"^",2),0)),"^")["PATCH" S PSSJ=0
"RTN","PSSOPKI",73,0)
 Q PSSJ
"RTN","PSSOPKI",74,0)
 ;
"RTN","PSSOPKI",75,0)
OIDETOX(PSSXOI,PSSXOIP) ; CPRS Orderable Item to check a drug is a DETOX or not 
"RTN","PSSOPKI",76,0)
 ;Input - PSSXOI - Orderable Item IEN
"RTN","PSSOPKI",77,0)
 ;      - PSSXOIP - Package
"RTN","PSSOPKI",78,0)
 ;Output - returns 1 if the drugs associated to the Orderable Item contains the text "BUPREN" as part of the name
"RTN","PSSOPKI",79,0)
 ;         otherwise it returns 0
"RTN","PSSOPKI",80,0)
 N PSSDTOX,PSSLP,PSSDPK
"RTN","PSSOPKI",81,0)
 I '$G(PSSXOI)!($G(PSSXOIP)="")!(PSSXOIP'="O") Q 0
"RTN","PSSOPKI",82,0)
 S (PSSLP,PSSDTOX)=0
"RTN","PSSOPKI",83,0)
 F  S PSSLP=$O(^PSDRUG("ASP",PSSXOI,PSSLP)) Q:'PSSLP!PSSDTOX  D
"RTN","PSSOPKI",84,0)
 .I $P($G(^PSDRUG(PSSLP,"I")),"^"),$P($G(^("I")),"^")<DT Q
"RTN","PSSOPKI",85,0)
 .S PSSDPK=$P($G(^PSDRUG(PSSLP,2)),"^",3)
"RTN","PSSOPKI",86,0)
 .Q:PSSDPK=""!(PSSDPK'["O")
"RTN","PSSOPKI",87,0)
 .I $$DETOX(PSSLP) S PSSDTOX=1 Q
"RTN","PSSOPKI",88,0)
 Q PSSDTOX
"RTN","PSSOPKI",89,0)
 ;
"VER")
8.0^22.0
"BLD",8885,6)
^162
**END**
**END**

