Released PSS*1*233 SEQ #204
Extracted from mail message
**KIDS**:PSS*1.0*233^

**INSTALL NAME**
PSS*1.0*233
"BLD",11385,0)
PSS*1.0*233^PHARMACY DATA MANAGEMENT^0^3190130^y
"BLD",11385,1,0)
^^2^2^3190121^
"BLD",11385,1,1,0)
This patch addresses some display issues in the Lookup into Dispense 
"BLD",11385,1,2,0)
Drug File Option [PSS LOOK]
"BLD",11385,4,0)
^9.64PA^^
"BLD",11385,6.3)
2
"BLD",11385,"KRN",0)
^9.67PA^1.61^23
"BLD",11385,"KRN",.4,0)
.4
"BLD",11385,"KRN",.401,0)
.401
"BLD",11385,"KRN",.402,0)
.402
"BLD",11385,"KRN",.403,0)
.403
"BLD",11385,"KRN",.5,0)
.5
"BLD",11385,"KRN",.84,0)
.84
"BLD",11385,"KRN",1.6,0)
1.6
"BLD",11385,"KRN",1.61,0)
1.61
"BLD",11385,"KRN",1.62,0)
1.62
"BLD",11385,"KRN",3.6,0)
3.6
"BLD",11385,"KRN",3.8,0)
3.8
"BLD",11385,"KRN",9.2,0)
9.2
"BLD",11385,"KRN",9.8,0)
9.8
"BLD",11385,"KRN",9.8,"NM",0)
^9.68A^2^2
"BLD",11385,"KRN",9.8,"NM",1,0)
PSSLOOK^^0^B140116759
"BLD",11385,"KRN",9.8,"NM",2,0)
PSSWRNE^^0^B31443486
"BLD",11385,"KRN",9.8,"NM","B","PSSLOOK",1)

"BLD",11385,"KRN",9.8,"NM","B","PSSWRNE",2)

"BLD",11385,"KRN",19,0)
19
"BLD",11385,"KRN",19.1,0)
19.1
"BLD",11385,"KRN",101,0)
101
"BLD",11385,"KRN",409.61,0)
409.61
"BLD",11385,"KRN",771,0)
771
"BLD",11385,"KRN",779.2,0)
779.2
"BLD",11385,"KRN",870,0)
870
"BLD",11385,"KRN",8989.51,0)
8989.51
"BLD",11385,"KRN",8989.52,0)
8989.52
"BLD",11385,"KRN",8994,0)
8994
"BLD",11385,"KRN","B",.4,.4)

"BLD",11385,"KRN","B",.401,.401)

"BLD",11385,"KRN","B",.402,.402)

"BLD",11385,"KRN","B",.403,.403)

"BLD",11385,"KRN","B",.5,.5)

"BLD",11385,"KRN","B",.84,.84)

"BLD",11385,"KRN","B",1.6,1.6)

"BLD",11385,"KRN","B",1.61,1.61)

"BLD",11385,"KRN","B",1.62,1.62)

"BLD",11385,"KRN","B",3.6,3.6)

"BLD",11385,"KRN","B",3.8,3.8)

"BLD",11385,"KRN","B",9.2,9.2)

"BLD",11385,"KRN","B",9.8,9.8)

"BLD",11385,"KRN","B",19,19)

"BLD",11385,"KRN","B",19.1,19.1)

"BLD",11385,"KRN","B",101,101)

"BLD",11385,"KRN","B",409.61,409.61)

"BLD",11385,"KRN","B",771,771)

"BLD",11385,"KRN","B",779.2,779.2)

"BLD",11385,"KRN","B",870,870)

"BLD",11385,"KRN","B",8989.51,8989.51)

"BLD",11385,"KRN","B",8989.52,8989.52)

"BLD",11385,"KRN","B",8994,8994)

"BLD",11385,"QDEF")
^^^^NO^^^^^^NO
"BLD",11385,"QUES",0)
^9.62^^
"BLD",11385,"REQB",0)
^9.611^1^1
"BLD",11385,"REQB",1,0)
PSS*1.0*214^2
"BLD",11385,"REQB","B","PSS*1.0*214",1)

"MBREQ")
0
"PKG",488,-1)
1^1
"PKG",488,0)
PHARMACY DATA MANAGEMENT^PSS^Maintenance of Pharmacy files.
"PKG",488,22,0)
^9.49I^1^1
"PKG",488,22,1,0)
1.0^2970930^3000316^66481
"PKG",488,22,1,"PAH",1,0)
233^3190130
"PKG",488,22,1,"PAH",1,1,0)
^^2^2^3190130
"PKG",488,22,1,"PAH",1,1,1,0)
This patch addresses some display issues in the Lookup into Dispense 
"PKG",488,22,1,"PAH",1,1,2,0)
Drug File Option [PSS LOOK]
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
2
"RTN","PSSLOOK")
0^1^B140116759^B137686641
"RTN","PSSLOOK",1,0)
PSSLOOK ;BIR/WRT - Drug file lookup ;Nov 27, 2018@10:04
"RTN","PSSLOOK",2,0)
 ;;1.0;PHARMACY DATA MANAGEMENT;**3,7,15,16,20,24,29,38,68,61,87,90,127,147,170,189,192,200,195,213,227,220,214,233**;9/30/97;Build 2
"RTN","PSSLOOK",3,0)
 ;
"RTN","PSSLOOK",4,0)
 ;Reference to ^PS(50.605 supported by DBIA #2138
"RTN","PSSLOOK",5,0)
 ;Reference to ^PS(50.608 supported by DBIA #2136
"RTN","PSSLOOK",6,0)
 ;Reference to ^PS(50.609 supported by DBIA #2137
"RTN","PSSLOOK",7,0)
 ;Reference to ^PS(50.607 supported by DBIA #2221
"RTN","PSSLOOK",8,0)
 ;Reference to $$FORMRX^PSNAPIS(DA,K,.LIST) supported by DBIA #2574
"RTN","PSSLOOK",9,0)
 ;Reference to $$FORMI^PSNAPIS(P1,P3) supported by DBIA #2574
"RTN","PSSLOOK",10,0)
 ;Reference to $$PSJDF^PSNAPIS(P1,P3) supported by DBIA #2531
"RTN","PSSLOOK",11,0)
 ;Reference to $$PSJST^PSNAPIS(P1,P3) supported by DBIA #2531
"RTN","PSSLOOK",12,0)
 ;Reference to $$PROD2^PSNAPIS(P1,P3) supported by DBIA #2531
"RTN","PSSLOOK",13,0)
 ;Reference to $$CPTIER^PSNAPIS(P1,P3) supported by DBIA #2531
"RTN","PSSLOOK",14,0)
 ;Reference to $$VAGN^PSNAPIS(P1) supported by DBIA #2531
"RTN","PSSLOOK",15,0)
 ;Reference to ^PSNDF(50.68 supported by DBIA 3735
"RTN","PSSLOOK",16,0)
 ;Reference to DATA^PSN50P68 supported by DBIA 4545
"RTN","PSSLOOK",17,0)
 ;Reference to FD & FDT^PSNACT supported by DBIA #6754
"RTN","PSSLOOK",18,0)
 ;
"RTN","PSSLOOK",19,0)
START S QUIT=0,PSSFG=0 D KILL F PSSXX=1:1 D PICK Q:PSSFG
"RTN","PSSLOOK",20,0)
DONE D KILL K PSSFG,PSSXX,QUIT,FM,FMS,Y2K
"RTN","PSSLOOK",21,0)
 Q
"RTN","PSSLOOK",22,0)
PICK W ! K DIC S DIC="^PSDRUG(",DIC(0)="AEQMVTN",DIC("T")="",DIC("W")="S PSSTDRUG=Y D GETTIER^PSSDEE(PSSTDRUG)" D ^DIC K DIC I Y<0 S PSSFG=1 Q
"RTN","PSSLOOK",23,0)
 S IFN=+Y D NDDATA,GETDATA,INACT,NOD66,FORMAT,KILL
"RTN","PSSLOOK",24,0)
 Q
"RTN","PSSLOOK",25,0)
NDDATA I $D(^PSDRUG(IFN,"ND")) S CLPTR=$P(^PSDRUG(IFN,"ND"),"^",6) I $P(^PSDRUG(IFN,"ND"),"^",2)]"" S NDNODE=^PSDRUG(IFN,"ND"),VAGNPTR=$P(NDNODE,"^",1),VAPN=$P(NDNODE,"^",2),SZPTR=$P(NDNODE,"^",4),TYPTR=$P(NDNODE,"^",5) D NDF,NDF1
"RTN","PSSLOOK",26,0)
 Q
"RTN","PSSLOOK",27,0)
NDF S DA=VAGNPTR,X=$$VAGN^PSNAPIS(DA),VAGN=X,PS=$P(^PS(50.609,SZPTR,0),"^",1),PT=$P(^PS(50.608,TYPTR,0),"^",1),P3=$P(NDNODE,"^",3)
"RTN","PSSLOOK",28,0)
 K X S DA=VAGNPTR,K=P3,X=$$PROD2^PSNAPIS(DA,K) I X]"",$P(X,"^")]"" S VAPRN=$P(X,"^"),VADU=$P(X,"^",4),CMOPID=$P(X,"^",2)
"RTN","PSSLOOK",29,0)
 S CSF="" I $P(NDNODE,"^",3) S CSF=$$GET1^DIQ(50.68,$P(NDNODE,"^",3),19,"I")
"RTN","PSSLOOK",30,0)
 ;
"RTN","PSSLOOK",31,0)
 S (PSSNIEN,CSF)="",PSSNIEN=$P(NDNODE,"^",3)
"RTN","PSSLOOK",32,0)
 K ^TMP($J,"PSNVAPR"),PSSHTH,PSSHTD,PSSPEPAC,PSSDOTSN
"RTN","PSSLOOK",33,0)
 I PSSNIEN'="" D DATA^PSN50P68(PSSNIEN,"","PSNVAPR")  ;using the PRE encapuslation API instead
"RTN","PSSLOOK",34,0)
 I $D(^TMP($J,"PSNVAPR",PSSNIEN)) D
"RTN","PSSLOOK",35,0)
 .S:$G(^TMP($J,"PSNVAPR",PSSNIEN,19))'="" CSF=$P(^TMP($J,"PSNVAPR",PSSNIEN,19),"^")
"RTN","PSSLOOK",36,0)
 .S:$G(^TMP($J,"PSNVAPR",PSSNIEN,5))'="" VAPRN=^TMP($J,"PSNVAPR",PSSNIEN,5)
"RTN","PSSLOOK",37,0)
 .S:$G(^TMP($J,"PSNVAPR",PSSNIEN,6))'="" CMOPID=^TMP($J,"PSNVAPR",PSSNIEN,6)
"RTN","PSSLOOK",38,0)
 .; Hazardous Waste fields
"RTN","PSSLOOK",39,0)
 .S (PSSHTH,PSSHTD,PSSPEPAC,PSSWSC,PSSDOTSN)=""
"RTN","PSSLOOK",40,0)
 .S:$G(^TMP($J,"PSNVAPR",PSSNIEN,101))'="" PSSHTH=^TMP($J,"PSNVAPR",PSSNIEN,101)
"RTN","PSSLOOK",41,0)
 .S:$G(^TMP($J,"PSNVAPR",PSSNIEN,102))'="" PSSHTD=^TMP($J,"PSNVAPR",PSSNIEN,102)
"RTN","PSSLOOK",42,0)
 .S:$G(^TMP($J,"PSNVAPR",PSSNIEN,103))'="" PSSPEPAC=^TMP($J,"PSNVAPR",PSSNIEN,103)
"RTN","PSSLOOK",43,0)
 .S:$G(^TMP($J,"PSNVAPR",PSSNIEN,104))'="" PSSWSC=^TMP($J,"PSNVAPR",PSSNIEN,104)
"RTN","PSSLOOK",44,0)
 .S HAZWCNT2=1,HAZWCNT=0,DIWL=1,DIWR=50
"RTN","PSSLOOK",45,0)
 .F  S HAZWCNT=$O(^TMP($J,"PSNVAPR",PSSNIEN,105,HAZWCNT)) Q:'HAZWCNT  D
"RTN","PSSLOOK",46,0)
 .. S X="",X=^TMP($J,"PSNVAPR",PSSNIEN,105,HAZWCNT) S PSSDOTSN(HAZWCNT)=X
"RTN","PSSLOOK",47,0)
 Q
"RTN","PSSLOOK",48,0)
IT S CMOPID=$P(X,"^",2)
"RTN","PSSLOOK",49,0)
 Q
"RTN","PSSLOOK",50,0)
NDF1 S X=$$PSJDF^PSNAPIS(DA,K),VADF=$P(X,"^",2)
"RTN","PSSLOOK",51,0)
 Q
"RTN","PSSLOOK",52,0)
INACT S ACT="" I $D(^PSDRUG(IFN,"I")) S Y=$P(^PSDRUG(IFN,"I"),"^",1) X ^DD("DD") S ACT=Y
"RTN","PSSLOOK",53,0)
 Q
"RTN","PSSLOOK",54,0)
GETDATA S NODE0=^PSDRUG(IFN,0),GN=$P(NODE0,"^",1),CL=$P(NODE0,"^",2),DEA=$P(NODE0,"^",3),WRN=$P(NODE0,"^",8),NF=$P(NODE0,"^",9),MESS=$P(NODE0,"^",10),VNF=$P(NODE0,"^",11),CLASS="",WARN="" S:NF=1 NF="N/F" S:VNF=1 VNF="V-N/F"
"RTN","PSSLOOK",55,0)
 S PSSNODE=$G(^PSDRUG(IFN,"DOS"))
"RTN","PSSLOOK",56,0)
 I CL'="",$G(CLPTR)'="" S CLASS=CL_"  "_$P(^PS(50.605,CLPTR,0),"^",2)
"RTN","PSSLOOK",57,0)
 S PSSX=$Q(^PSDRUG(IFN,950)),PSSMAX=$P(@PSSX,"^",3)
"RTN","PSSLOOK",58,0)
 D GETS^DIQ(50.095,PSSMAX_","_IFN_",","*","E","PSSDAT","PSSERR")
"RTN","PSSLOOK",59,0)
 S PSSDT=$G(PSSDAT(50.095,PSSMAX_","_IFN_",",.01,"E"))
"RTN","PSSLOOK",60,0)
 S PSSUSR=$G(PSSDAT(50.095,PSSMAX_","_IFN_",",1,"E"))
"RTN","PSSLOOK",61,0)
 S PSSVAL=$G(PSSDAT(50.095,PSSMAX_","_IFN_",",3,"E"))
"RTN","PSSLOOK",62,0)
 I $D(^PSDRUG(IFN,3)) S:$P(^PSDRUG(IFN,3),"^")=0 CMOP="NO" S:$P(^PSDRUG(IFN,3),"^")=1 CMOP="YES"
"RTN","PSSLOOK",63,0)
 I $D(^PSDRUG(IFN,5)) S QDM=^PSDRUG(IFN,5)
"RTN","PSSLOOK",64,0)
 S OINM="" S NDC="" I $D(^PSDRUG(IFN,2)) S NODE2=^PSDRUG(IFN,2) S:$P(NODE2,"^",1)]"" OIPTR=$P(NODE2,"^",1) S NDC=$P(NODE2,"^",4) S:$P(NODE2,"^",6)]"" PDPTR=$P(NODE2,"^",6) S APP=$P(NODE2,"^",3),FM="" D TWOA
"RTN","PSSLOOK",65,0)
 Q
"RTN","PSSLOOK",66,0)
TWOA I $D(OIPTR) S OI=$P(^PS(50.7,OIPTR,0),"^",1),DFPTR=$P(^PS(50.7,OIPTR,0),"^",2),DF=$P(^PS(50.606,DFPTR,0),"^",1),FMS=$P(^PS(50.7,OIPTR,0),"^",12) S:FMS]"" FM=" (N/F)" S OINM=OI_" "_DF_FM
"RTN","PSSLOOK",67,0)
 ;I $D(PDPTR) S PD=$P(^PS(50.3,PDPTR,0),"^",1)
"RTN","PSSLOOK",68,0)
 Q
"RTN","PSSLOOK",69,0)
NOD66 S (DUPOU,PPDU,PPOU,DU,SS)="" I $D(^PSDRUG(IFN,660)) S NDE=^PSDRUG(IFN,660),OUPTR=$P(NDE,"^",2),PPOU=$P(NDE,"^",3),DUPOU=$P(NDE,"^",5),PPDU=$P(NDE,"^",6),SS=$P(NDE,"^",7),DU=$P(NDE,"^",8) I OUPTR]"" S OU=$P(^DIC(51.5,OUPTR,0),"^")
"RTN","PSSLOOK",70,0)
 Q
"RTN","PSSLOOK",71,0)
SYN I $D(^PSDRUG(IFN,1,0)) F ZZZ=0:0 S ZZZ=$O(^PSDRUG(IFN,1,ZZZ)) Q:'ZZZ  S SYNM=$P(^PSDRUG(IFN,1,ZZZ,0),"^",1),INT=$P(^PSDRUG(IFN,1,ZZZ,0),"^",3) D SYN1
"RTN","PSSLOOK",72,0)
 Q
"RTN","PSSLOOK",73,0)
SYN1 S INT=$S(INT=0:"Trade Name",INT=1:"Quick Code",INT="C":"Ctrl Substances",INT="D":"Drug Accountability",1:"") D FULL Q:$G(QUIT)  W ?14,SYNM,?55,INT,!
"RTN","PSSLOOK",74,0)
 Q
"RTN","PSSLOOK",75,0)
SYN2 S:INT=0 INT="Trade" S:INT=1 INT="Quick" S:INT="C" INT="Ctrl Subs" S:INT="D" INT="Drug Acct" W ?16,SYNM,?57,INT,!
"RTN","PSSLOOK",76,0)
 Q
"RTN","PSSLOOK",77,0)
IFCAP I $D(^PSDRUG(IFN,441,0)) F QQQ=0:0 S QQQ=$O(^PSDRUG(IFN,441,QQQ)) Q:'QQQ  S IFCAPNM=$P(^PSDRUG(IFN,441,QQQ,0),"^",1)
"RTN","PSSLOOK",78,0)
 Q
"RTN","PSSLOOK",79,0)
FORMAT ; BEGIN WRITING
"RTN","PSSLOOK",80,0)
 N DAW
"RTN","PSSLOOK",81,0)
 W @IOF,"DRUG NAME: ",GN,"  (IEN: ",IFN,")",!
"RTN","PSSLOOK",82,0)
 F XX=1:1:77 W "="
"RTN","PSSLOOK",83,0)
 W !
"RTN","PSSLOOK",84,0)
 W:$D(VAPRN) "VA PRINT NAME: ",?17,VAPRN W:$D(CMOPID) ?60,"CMOP ID#: ",CMOPID W:$D(VAPN) !,"VA PRODUCT NAME: ",?17,VAPN
"RTN","PSSLOOK",85,0)
 I $L($G(VAPN))>42 W !
"RTN","PSSLOOK",86,0)
 W:$D(CMOP) ?60,"CMOP DISPENSE: ",CMOP
"RTN","PSSLOOK",87,0)
 W:$D(OINM) !,"ORDERABLE ITEM: ",?17,OINM
"RTN","PSSLOOK",88,0)
 I $L($G(OINM))>42 W !
"RTN","PSSLOOK",89,0)
 W:$D(VAPN) ?60,"NDF DF: ",VADF
"RTN","PSSLOOK",90,0)
 I $D(OIPTR),OIPTR]"" W !,"ORDERABLE ITEM TEXT: ",! D OITXT
"RTN","PSSLOOK",91,0)
 W:$D(PD) !,"PRIMARY DRUG: ",?17,PD
"RTN","PSSLOOK",92,0)
 W !,"SYNONYM(S): " D SYN D FULL Q:$G(QUIT)  W !,"MESSAGE: ",MESS,!
"RTN","PSSLOOK",93,0)
 D FULL Q:$G(QUIT)  F XX=1:1:77 W "-"
"RTN","PSSLOOK",94,0)
 W !
"RTN","PSSLOOK",95,0)
 D FULL Q:$G(QUIT)  W "DEA, SPECIAL HDLG: ",DEA,?48,"NDC: ",?63,NDC
"RTN","PSSLOOK",96,0)
 S DAW=+$$GET1^DIQ(50,IFN,81)
"RTN","PSSLOOK",97,0)
 D FULL Q:$G(QUIT)  W !,"DAW CODE:  ",DAW," - ",$$DAWEXT^PSSDAWUT(DAW)
"RTN","PSSLOOK",98,0)
 D FULL Q:$G(QUIT)  W !,"CS FEDERAL SCHEDULE: ",$G(CSF)
"RTN","PSSLOOK",99,0)
 ;
"RTN","PSSLOOK",100,0)
 ;Hazardous Waste
"RTN","PSSLOOK",101,0)
 W !
"RTN","PSSLOOK",102,0)
 S PSSHTDX=0
"RTN","PSSLOOK",103,0)
 I $G(PSSHTD)=1 S PSSHTDX=1
"RTN","PSSLOOK",104,0)
 D FULL Q:$G(QUIT)  W:$G(PSSHTH)'="" !,"Hazardous to Handle: ",$S(PSSHTH=1:"YES",PSSHTH=0:"NO",1:"")
"RTN","PSSLOOK",105,0)
 D FULL Q:$G(QUIT)  W:$G(PSSHTD)'="" !,"Hazardous to Dispose: ",$S(PSSHTD=1:"YES",PSSHTD=0:"NO",1:"")
"RTN","PSSLOOK",106,0)
 I $G(PSSPEPAC)'=""&(PSSHTDX) D FULL Q:$G(QUIT)  W !,"        Primary EPA Code: ",PSSPEPAC
"RTN","PSSLOOK",107,0)
 I $G(PSSWSC)'=""&(PSSHTDX) D FULL Q:$G(QUIT)  W !,"         Waste Sort Code: ",PSSWSC
"RTN","PSSLOOK",108,0)
 ;
"RTN","PSSLOOK",109,0)
 N HAZWCNT,HAZWCNT2,X,DIWL,DIWR,DIWF
"RTN","PSSLOOK",110,0)
 K ^UTILITY($J,"W")
"RTN","PSSLOOK",111,0)
 S HAZWCNT=0,HAZWCNT2=1,HAZWCNT=0,DIWL=1,DIWR=50
"RTN","PSSLOOK",112,0)
 F  S HAZWCNT=$O(PSSDOTSN(HAZWCNT)) Q:HAZWCNT=""  S X=PSSDOTSN(HAZWCNT) D ^DIWP
"RTN","PSSLOOK",113,0)
 S HAZWCNT=0 F  S HAZWCNT=$O(^UTILITY($J,"W",DIWL,HAZWCNT)) Q:'HAZWCNT  D
"RTN","PSSLOOK",114,0)
 .D FULL Q:$G(QUIT)
"RTN","PSSLOOK",115,0)
 .I HAZWCNT2=1 W !,"       DOT Shipping Name: "
"RTN","PSSLOOK",116,0)
 .I HAZWCNT2>1 W !,"                          "
"RTN","PSSLOOK",117,0)
 .W $G(^UTILITY($J,"W",DIWL,HAZWCNT,0)) S HAZWCNT2=2
"RTN","PSSLOOK",118,0)
 K ^UTILITY($J,"W")
"RTN","PSSLOOK",119,0)
 ;I $G(PSSDOTSN)'=""&(PSSHTDX) D FULL Q:$G(QUIT)  W !,"       DOT Shipping Name: ",PSSDOTSN
"RTN","PSSLOOK",120,0)
 W !
"RTN","PSSLOOK",121,0)
 ;
"RTN","PSSLOOK",122,0)
 D FULL Q:$G(QUIT)  W !,"INACTIVE DATE: ",ACT
"RTN","PSSLOOK",123,0)
 D FULL Q:$G(QUIT)  W:$D(QDM) !,"QUANTITY DISPENSE MESSAGE: ",QDM,!
"RTN","PSSLOOK",124,0)
 D FULL Q:$G(QUIT)  I WRN]"" W !,"WARNING LABEL: " S X=WRN F Z0=1:1 Q:$P(X,",",Z0,99)=""  S Z1=$P(X,",",Z0) W:$D(^PS(54,Z1,0)) ?19,$P(^(0),"^",1),! I '$D(^(0)) W ?19,"NO SUCH WARNING LABEL" K X Q
"RTN","PSSLOOK",125,0)
 D FULL Q:$G(QUIT)  S PSSLOOK=1 D
"RTN","PSSLOOK",126,0)
 .N DRUG,PSSWSITE
"RTN","PSSLOOK",127,0)
 .I $P($G(^PSDRUG(IFN,0)),"^")="" K PSSLOOK Q
"RTN","PSSLOOK",128,0)
 .S PSSWSITE=+$O(^PS(59.7,0)) W !,"WARNING LABEL SOURCE is " D
"RTN","PSSLOOK",129,0)
 ..I $P($G(^PS(59.7,PSSWSITE,10)),"^",9)="N" W "set to 'NEW'" Q
"RTN","PSSLOOK",130,0)
 ..W "not set to 'NEW'"
"RTN","PSSLOOK",131,0)
 .K PSSWRN
"RTN","PSSLOOK",132,0)
 .D FULL Q:$G(QUIT)  W !,"NEW WARNING LABEL:"
"RTN","PSSLOOK",133,0)
 .S ^TMP("PSSWRNB",$J,$P(^PSDRUG(IFN,0),"^"))="" D EN^PSSWRNE(.QUIT)
"RTN","PSSLOOK",134,0)
 .K PSSLOOK,^TMP("PSSWRNB",$J),PSSWRN
"RTN","PSSLOOK",135,0)
 D FULL Q:$G(QUIT)  W:'$D(QDM) !
"RTN","PSSLOOK",136,0)
 W ! F XX=1:1:77 W "-"
"RTN","PSSLOOK",137,0)
 D FULL Q:$G(QUIT)  W !
"RTN","PSSLOOK",138,0)
 W "ORDER UNIT: ",?27 W:$D(OU) OU W ?40,"PRICE/ORDER UNIT: ",?67,PPOU
"RTN","PSSLOOK",139,0)
 D FULL Q:$G(QUIT)  W !,"DISPENSE UNIT: ",?27,DU W:$D(VADU) ?40,"VA DISPENSE UNIT: ",?67,VADU
"RTN","PSSLOOK",140,0)
 D FULL Q:$G(QUIT)  W !,"DISPENSE UNITS/ORDER UNIT: ",?21,DUPOU,?40,"PRICE/DISPENSE UNIT: ",?67,PPDU
"RTN","PSSLOOK",141,0)
 D:$G(PSSVAL)]""
"RTN","PSSLOOK",142,0)
 . D FULL Q:$G(QUIT)  W !,"DATE PRICE/DISPENSE UNIT LAST CHANGED:  ",?27,PSSDT
"RTN","PSSLOOK",143,0)
 . D FULL Q:$G(QUIT)  W !,"BY:  ",PSSUSR,?27,"VALUE:  ",PSSVAL
"RTN","PSSLOOK",144,0)
 D FULL Q:$G(QUIT)  W !,"NCPDP DISPENSE UNIT: ",$$GET1^DIQ(50,IFN,82),?40,"NCPDP QUANTITY MULTIPLIER: ",?67,$J($$GET1^DIQ(50,IFN,83),10,5)
"RTN","PSSLOOK",145,0)
 D FULL Q:$G(QUIT)  W !,"MAXIMUM DAYS SUPPLY: ",$$GET1^DIQ(50,IFN,66)
"RTN","PSSLOOK",146,0)
 D FULL Q:$G(QUIT)  W !,"ePharmacy Billable: ",$$GET1^DIQ(50,IFN,84)
"RTN","PSSLOOK",147,0)
 D FULL Q:$G(QUIT)  W !?2,"ePharmacy Billable (TRICARE): ",$$GET1^DIQ(50,IFN,85) W ?40,"ePharmacy Billable (CHAMPVA): ",$$GET1^DIQ(50,IFN,86)
"RTN","PSSLOOK",148,0)
 D FULL Q:$G(QUIT)  W !,"Sensitive Diagnosis Drug: ",$$GET1^DIQ(50,IFN,87) W !
"RTN","PSSLOOK",149,0)
 D FULL Q:$G(QUIT)  W !,"APPL PKG USE:" S APPL="" S:'$D(APP) APPL="  NONE"
"RTN","PSSLOOK",150,0)
 I $D(APP) D
"RTN","PSSLOOK",151,0)
 . S:APP["O" APPL=APPL_"  Outpatient" S:APP["U" APPL=APPL_"  Unit Dose"
"RTN","PSSLOOK",152,0)
 . S:APP["I" APPL=APPL_"  IV" S:APP["W" APPL=APPL_"  Ward Stock"
"RTN","PSSLOOK",153,0)
 . S:APP["N" APPL=APPL_"  Control Subs" S:APP["X" APPL=APPL_"  Non-VA Med"
"RTN","PSSLOOK",154,0)
 . S:APPL="" APPL="  NONE"
"RTN","PSSLOOK",155,0)
 W ?13,APPL
"RTN","PSSLOOK",156,0)
 I $P(PSSNODE,"^",2) S (PSSCALC,PSSUNIT)=$P($G(^PS(50.607,+$P(PSSNODE,U,2),0)),U),PSSSTR=$P(PSSNODE,"^")
"RTN","PSSLOOK",157,0)
 I $G(PSSUNIT)'="",$G(PSSUNIT)["/" D UNCALC
"RTN","PSSLOOK",158,0)
 D FULL Q:$G(QUIT)  W !,"STRENGTH: ",$S($E($P(PSSNODE,U),1)=".":"0",1:"")_$P(PSSNODE,U),?35,"UNIT: ",$G(PSSCALC)
"RTN","PSSLOOK",159,0)
 D FULL Q:$G(QUIT)  W !,"POSSIBLE DOSAGES:"
"RTN","PSSLOOK",160,0)
 I $D(^PSDRUG(IFN,"DOS1",0)) F PDS=0:0 S PDS=$O(^PSDRUG(IFN,"DOS1",PDS)) Q:'PDS  D
"RTN","PSSLOOK",161,0)
 .S POSDOS=^PSDRUG(IFN,"DOS1",PDS,0)
"RTN","PSSLOOK",162,0)
 .D FULL Q:$G(QUIT)  W !,"   DISPENSE UNITS PER DOSE: ",$S($E($P(POSDOS,U),1)=".":"0",1:"")_$P(POSDOS,U),?40,"DOSE: ",$S($E($P(POSDOS,U,2),1)=".":"0",1:"")_$P(POSDOS,U,2),?55,"PACKAGE: ",$P(POSDOS,U,3)
"RTN","PSSLOOK",163,0)
 .D FULL Q:$G(QUIT)  W !,"       BCMA UNITS PER DOSE: ",$P(POSDOS,U,4)
"RTN","PSSLOOK",164,0)
 D FULL Q:$G(QUIT)  W !,"LOCAL POSSIBLE DOSAGES:"
"RTN","PSSLOOK",165,0)
 I $D(^PSDRUG(IFN,"DOS2",0)) F PDS=0:0 S PDS=$O(^PSDRUG(IFN,"DOS2",PDS)) Q:'PDS  D
"RTN","PSSLOOK",166,0)
 .S LPDOS=^PSDRUG(IFN,"DOS2",PDS,0)
"RTN","PSSLOOK",167,0)
 .D FULL Q:$G(QUIT)  W !,"   LOCAL POSSIBLE DOSAGE: " D
"RTN","PSSLOOK",168,0)
 ..I $L($P(LPDOS,U))'>27 W $P(LPDOS,U),?55,"PACKAGE: ",$P(LPDOS,U,2)
"RTN","PSSLOOK",169,0)
 ..E   W !,?10,$P(LPDOS,U),!,?55,"PACKAGE: ",$P(LPDOS,U,2)
"RTN","PSSLOOK",170,0)
 ..D FULL Q:$G(QUIT)  W !,"     BCMA UNITS PER DOSE: ",$P(LPDOS,U,3) D FULL Q:$G(QUIT)  D LPDNW
"RTN","PSSLOOK",171,0)
 D FULL Q:$G(QUIT)  W ! F XX=1:1:77 W "-"
"RTN","PSSLOOK",172,0)
 D FULL Q:$G(QUIT)  W !,"VA CLASS: ",$G(CLASS)
"RTN","PSSLOOK",173,0)
 D FULL Q:$G(QUIT)  W !,"LOCAL NON-FORMULARY: ",$G(NF),"          ","VISN NON-FORMULARY: ",$G(VNF)
"RTN","PSSLOOK",174,0)
 N DA,K,LIST,PSXDN,PSXGN,X,XX1,XX2
"RTN","PSSLOOK",175,0)
 K PSXGN,PSXVP I $D(^PSDRUG(IFN,"ND")) S PSXDN=$G(^PSDRUG(IFN,"ND")),PSXGN=$P(PSXDN,"^"),PSXVP=$P(PSXDN,"^",3)
"RTN","PSSLOOK",176,0)
 I $G(PSXGN),$G(PSXVP) S X=$$PROD2^PSNAPIS(PSXGN,PSXVP),XX1=$$FORMI^PSNAPIS(PSXGN,PSXVP)
"RTN","PSSLOOK",177,0)
 D FULL Q:$G(QUIT)  W !,"National Formulary Indicator: "_$S($G(XX1)=1:"YES",$G(XX1)=0:"NO",1:"Not Matched to NDF")
"RTN","PSSLOOK",178,0)
 I $G(PSXVP) D FD^PSNACT(PSXVP) ;PPSN
"RTN","PSSLOOK",179,0)
 I $D(^PSDRUG(IFN,65,0)) D FULL Q:$G(QUIT)  W !,"FORMULARY ALTERNATIVES: ",! F FA=0:0 S FA=$O(^PSDRUG(IFN,65,FA)) Q:'FA  S LDFPTR=$P($G(^PSDRUG(IFN,65,FA,0)),"^") I LDFPTR D FULL Q:$G(QUIT)  W ?26,$P($G(^PSDRUG(LDFPTR,0)),"^"),!
"RTN","PSSLOOK",180,0)
 N CPDATE,PSSTIER D NOW^%DTC S CPDATE=$P(%,".") S PSSTIER=$$CPTIER^PSNAPIS($P($G(^PSDRUG(IFN,"ND")),"^",3),CPDATE,IFN,1) K CPDATE,%
"RTN","PSSLOOK",181,0)
 ;  PSSTIER = Copay Tier^Effective Date^End Date
"RTN","PSSLOOK",182,0)
 W !,"Copay Tier: ",$P(PSSTIER,"^",1)
"RTN","PSSLOOK",183,0)
 W !,"Copay Effective Date: " S Y=$P(PSSTIER,"^",2) D DD^%DT W Y K Y
"RTN","PSSLOOK",184,0)
 D FULL Q:$G(QUIT)  I $G(PSXGN),$G(PSXVP) W !,"National Restriction: " S XX2=$$FORMRX^PSNAPIS(PSXGN,PSXVP,.LIST) I $G(XX2)=1,$D(LIST) F XX2=0:0 S XX2=$O(LIST(XX2)) Q:'XX2  D FULL Q:$G(QUIT)  W !,LIST(XX2,0)
"RTN","PSSLOOK",185,0)
 I $G(PSXVP) D FDT^PSNACT(PSXVP) ;PPSN
"RTN","PSSLOOK",186,0)
 W !,"Local Drug Text: ",! I $D(^PSDRUG(IFN,9,0)) D LDT
"RTN","PSSLOOK",187,0)
 Q
"RTN","PSSLOOK",188,0)
LDT F TXT1=0:0 S TXT1=$O(^PSDRUG(IFN,9,TXT1)) Q:'TXT1  S TEXPTR=^PSDRUG(IFN,9,TXT1,0) F PPP=0:0 S PPP=$O(^PS(51.7,TEXPTR,2,PPP)) Q:'PPP  S PST=$P($G(^PS(51.7,TEXPTR,0)),"^",2) I 'PST S WPT=^PS(51.7,TEXPTR,2,PPP,0) D FULL Q:$G(QUIT)  W WPT,!
"RTN","PSSLOOK",189,0)
 ;
"RTN","PSSLOOK",190,0)
 ;
"RTN","PSSLOOK",191,0)
KILL K IFN,APP,INT,VADU,VAGN,VAPN,VAPRN,P3,VAGNPTR,MESS,CLASS,DEA,ACT,CL,CLPTR,CMOP,DF,DFPTR,DU,DUPOUGN,IFCAPNM,NDC,NDE,NDNODE,NF,NODE0,NODE2,OI,OINM,OIPTR,OU,PD,PDPTR,PPDU,PPOU,PS,PT,NOD66,SYNM,SZPTR,TYPTR,WARN,WRN,XX,ZZZ,SS,OUPTR,CMOPID
"RTN","PSSLOOK",192,0)
 K DUPOU,QQQ,GN,QDM,APPL,VADF,DFP,DFRM,Y,Z0,Z1,DDD,PPP,TEXT,TXTPTR,TXT,TXT1,TEXPTR,VNF,WPT,FA,LDFPTR,TEXTPTR,QUIT,PST,D0,DA,K,DIR
"RTN","PSSLOOK",193,0)
 K PSSNODE,PSDOSUN,PDS,POSDOS,LPDOS,CSF,PSSSTR,PSSUNIT,PSSCALC,PSSTIER
"RTN","PSSLOOK",194,0)
 K ^TMP($J,"PSNVAPR")
"RTN","PSSLOOK",195,0)
 K PSSWSC,PSSNIEN,PSSHTH,PSSHTD,PSSPEPAC,PSSDOTSN,PSSCLEF,PSSPKG,PSSOMIT,PSSEXLMT,PSSHTDX,PSSII,PSSIII
"RTN","PSSLOOK",196,0)
 Q
"RTN","PSSLOOK",197,0)
OITXT I $D(^PS(50.7,OIPTR,1,0)) F TXT=0:0 S TXT=$O(^PS(50.7,OIPTR,1,TXT)) Q:'TXT  S TEXTPTR=^PS(50.7,OIPTR,1,TXT,0) F DDD=0:0 S DDD=$O(^PS(51.7,TEXTPTR,2,DDD)) Q:'DDD  D IDATE I 'Y2K S TEXT=^PS(51.7,TEXTPTR,2,DDD,0) D FULL Q:$G(QUIT)  W TEXT,!
"RTN","PSSLOOK",198,0)
 Q
"RTN","PSSLOOK",199,0)
FULL D:($Y+5)>IOSL&('$G(QUIT)) FSCRN
"RTN","PSSLOOK",200,0)
 Q
"RTN","PSSLOOK",201,0)
FSCRN Q:$G(QUIT)  W ! K DIR S DIR(0)="E",DIR("A")="Press Return to continue,'^' to exit" D ^DIR W @IOF S:Y'=1 QUIT=1
"RTN","PSSLOOK",202,0)
 Q
"RTN","PSSLOOK",203,0)
IDATE S Y2K=$P($G(^PS(51.7,TEXTPTR,0)),"^",2)
"RTN","PSSLOOK",204,0)
 Q
"RTN","PSSLOOK",205,0)
UNCALC ;
"RTN","PSSLOOK",206,0)
 N PSSVA,PSSVA1,PSSVB,PSSVB1,PSSDASH,PSSNDFS,PSSDASH2,PSSDASH3,PSSDASH5 K PSSCALC
"RTN","PSSLOOK",207,0)
 S PSSDASH=0 S PSSNDFS=$$PSJST^PSNAPIS(+$P($G(^PSDRUG(IFN,"ND")),"^"),+$P($G(^PSDRUG(IFN,"ND")),"^",3)) S PSSNDFS=+$P($G(PSSNDFS),"^",2)
"RTN","PSSLOOK",208,0)
 I $G(PSSNDFS),$G(PSSSTR),+$G(PSSSTR)'=+$G(PSSNDFS) S PSSDASH=1
"RTN","PSSLOOK",209,0)
 S PSSVA=$P(PSSUNIT,"/"),PSSVB=$P(PSSUNIT,"/",2),PSSVA1=+$G(PSSVA),PSSVB1=+$G(PSSVB)
"RTN","PSSLOOK",210,0)
 I $G(PSSDASH) S PSSDASH2=PSSSTR/PSSNDFS,PSSDASH3=PSSDASH2*$S($G(PSSVB1):PSSVB1,1:1) S PSSDASH5=$S('$G(PSSVB1):PSSDASH3_$G(PSSVB),1:PSSDASH3_$P(PSSVB,PSSVB1,2))
"RTN","PSSLOOK",211,0)
 S PSSCALC=$S($G(PSSDASH):$S('$G(PSSVA1):PSSVA,1:$P(PSSVA1,PSSVA1,2))_"/"_$G(PSSDASH5),1:PSSUNIT)
"RTN","PSSLOOK",212,0)
 Q
"RTN","PSSLOOK",213,0)
 ;
"RTN","PSSLOOK",214,0)
LPDNW ;Display Dose Unit and Numeric Dose fields, added with patch PSS*1*147
"RTN","PSSLOOK",215,0)
 N PSSLKL1,PSSLKL2,PSSLKL3,PSSLKL4
"RTN","PSSLOOK",216,0)
 S PSSLKL4=""
"RTN","PSSLOOK",217,0)
 S PSSLKL1=$P(LPDOS,"^",5),PSSLKL2=$P(LPDOS,"^",6)
"RTN","PSSLOOK",218,0)
 I PSSLKL1 S PSSLKL4=$P($G(^PS(51.24,+PSSLKL1,0)),"^")
"RTN","PSSLOOK",219,0)
 S PSSLKL3=$S($E(PSSLKL2)=".":"0",1:"")_PSSLKL2
"RTN","PSSLOOK",220,0)
 I $L(PSSLKL3)<18 D FULL Q:$G(QUIT)  W !?5,"NUMERIC DOSE: "_PSSLKL3,?38,"DOSE UNIT: "_PSSLKL4 Q
"RTN","PSSLOOK",221,0)
 D FULL Q:$G(QUIT)  W !?5,"NUMERIC DOSE: "_PSSLKL3
"RTN","PSSLOOK",222,0)
 D FULL Q:$G(QUIT)  W !?38,"DOSE UNIT: "_PSSLKL4
"RTN","PSSLOOK",223,0)
 Q
"RTN","PSSWRNE")
0^2^B31443486^B30090017
"RTN","PSSWRNE",1,0)
PSSWRNE ;BIR/EJW - NEW WARNING SOURCE NEW WARNING LABEL LIST EDITOR ;05/24/04
"RTN","PSSWRNE",2,0)
 ;;1.0;PHARMACY DATA MANAGEMENT;**87,233**;9/30/97;Build 2
"RTN","PSSWRNE",3,0)
 ;
"RTN","PSSWRNE",4,0)
 ;Reference to ^PS(50.625 supported by DBIA 4445
"RTN","PSSWRNE",5,0)
EN(RTN) ; Entry from ^PSSLOOK PSS*1*233
"RTN","PSSWRNE",6,0)
 N PSSSTWN
"RTN","PSSWRNE",7,0)
 S PSSSTWN=1
"RTN","PSSWRNE",8,0)
EDIT ;
"RTN","PSSWRNE",9,0)
 N STAR,QUIT,PSSOUT
"RTN","PSSWRNE",10,0)
 S QUIT=0,STAR="",PSSOUT=0
"RTN","PSSWRNE",11,0)
 S DRUG="" F  S DRUG=$O(^TMP("PSSWRNB",$J,DRUG)) Q:DRUG=""  D  I QUIT Q
"RTN","PSSWRNE",12,0)
 .S DRUGN=$O(^PSDRUG("B",DRUG,0)) Q:'DRUGN  D DEA,PRINT
"RTN","PSSWRNE",13,0)
 I $G(PSSSTWN) S RTN=QUIT
"RTN","PSSWRNE",14,0)
 Q
"RTN","PSSWRNE",15,0)
 ;
"RTN","PSSWRNE",16,0)
PRINT ;
"RTN","PSSWRNE",17,0)
 N NEWLIST,STAR
"RTN","PSSWRNE",18,0)
 I '$G(PSSLOOK) D
"RTN","PSSWRNE",19,0)
 .W @IOF
"RTN","PSSWRNE",20,0)
 .W "Current Warning labels for ",DRUG
"RTN","PSSWRNE",21,0)
 .I $G(NEWLIST)="",PSSWRN'["N" W !,"No warnings from the new data source exist for this drug." D
"RTN","PSSWRNE",22,0)
 ..W !,"Verify that the drug is matched to the National Drug File."
"RTN","PSSWRNE",23,0)
 I PSSWRN'="" D
"RTN","PSSWRNE",24,0)
 .I '$G(PSSLOOK) W !,"Labels will print in the order in which they appear for local and CMOP fills:"
"RTN","PSSWRNE",25,0)
 .I '$G(ENDWARN) S ENDWARN=5
"RTN","PSSWRNE",26,0)
 .S STAR=""
"RTN","PSSWRNE",27,0)
 .F WWW=1:1:ENDWARN S PSOWARN=$P(PSSWRN,",",WWW) Q:PSOWARN=""  D
"RTN","PSSWRNE",28,0)
 ..I WWW>5 S STAR="*"
"RTN","PSSWRNE",29,0)
 ..I PSOWARN["N" D NEWWARN Q
"RTN","PSSWRNE",30,0)
 ..D WARN54
"RTN","PSSWRNE",31,0)
 .Q:$G(QUIT)  D FULL Q:$G(PSSOUT)  W !!,"Pharmacy fill card display: DRUG WARNING ",PSSWRN
"RTN","PSSWRNE",32,0)
 .I $G(PSSLOOK) Q
"RTN","PSSWRNE",33,0)
 .I $G(SEL)=6 D
"RTN","PSSWRNE",34,0)
 ..S WARN54=$G(^TMP("PSSWRNB",$J,DRUG))
"RTN","PSSWRNE",35,0)
 ..D FULL W !,"  RX CONSULT file Drug Warning="_WARN54
"RTN","PSSWRNE",36,0)
 ..N I,WARN F I=1:1:$L(WARN54,",") S WARN=$P(WARN54,",",I) I WARN'="",$G(^PS(54,WARN,2))="" D FULL W !,"  ",WARN_" "_$G(^PS(54,WARN,0))_" is not mapped to the new data source"
"RTN","PSSWRNE",37,0)
 .I $G(SEL)=8 D
"RTN","PSSWRNE",38,0)
 ..W !
"RTN","PSSWRNE",39,0)
 ..S DIE="^PSDRUG(",DA=DRUGN,DR=8.2 D ^DIE K DIE,DA,DR
"RTN","PSSWRNE",40,0)
 .S NEWLIST=$P($G(^PSDRUG(DRUGN,"WARN")),"^") I NEWLIST="" D
"RTN","PSSWRNE",41,0)
 ..I PSSWRN'["N" Q
"RTN","PSSWRNE",42,0)
 ..D FULL Q:$G(PSSOUT)  W !,"NOTE: Because the NEW WARNING LABEL LIST field is empty, the warnings above"
"RTN","PSSWRNE",43,0)
 ..D FULL Q:$G(PSSOUT)  W !,"are the warnings that our national data source distributes for this drug."
"RTN","PSSWRNE",44,0)
 I $G(PSSLOOK) Q
"RTN","PSSWRNE",45,0)
 I $G(NEWLIST)'="" D FULL Q:$G(PSSOUT)  W !,"NEW WARNING LABEL LIST: ",NEWLIST
"RTN","PSSWRNE",46,0)
 D FULL Q:$G(PSSOUT)  W ! K DIR S DIR(0)="Y",DIR("B")="N",DIR("A")="Would you like to edit this list of warnings" D ^DIR K DIR I $D(DTOUT)!($D(DUOUT)) S QUIT=1
"RTN","PSSWRNE",47,0)
 I 'Y D  Q
"RTN","PSSWRNE",48,0)
 .I $G(DRUGENT) S WARNEDIT=0 K ^TMP("PSSWRNB",$J)
"RTN","PSSWRNE",49,0)
 I $G(DRUGENT) S WARNEDIT=1 K ^TMP("PSSWRNB",$J) Q
"RTN","PSSWRNE",50,0)
 S OLDWARN=PSSWRN
"RTN","PSSWRNE",51,0)
 S DIE="^PSDRUG(",DA=DRUGN,DR=8.1 D ^DIE K DIE,DA,DR
"RTN","PSSWRNE",52,0)
 S PSSWRN=$P($G(^PSDRUG(DRUGN,"WARN")),"^") I PSSWRN'="" D CHECK20^PSSWRNA G PRINT
"RTN","PSSWRNE",53,0)
 I $G(OLDWARN)'="",PSSWRN="" D DEA G PRINT
"RTN","PSSWRNE",54,0)
 Q
"RTN","PSSWRNE",55,0)
FULL ;
"RTN","PSSWRNE",56,0)
 I ($Y+3)>IOSL&('$G(PSSOUT)) D HDR
"RTN","PSSWRNE",57,0)
 Q
"RTN","PSSWRNE",58,0)
NEWWARN ;
"RTN","PSSWRNE",59,0)
 N PSOWRNN,JJJ,STR
"RTN","PSSWRNE",60,0)
 S TEXT=""
"RTN","PSSWRNE",61,0)
 S PSOWRNN=+PSOWARN I $D(^PS(50.625,PSOWRNN)) D
"RTN","PSSWRNE",62,0)
 .I '$G(PSSLOOK) W !
"RTN","PSSWRNE",63,0)
 .S TEXT=STAR_PSOWARN_" "
"RTN","PSSWRNE",64,0)
 .S JJJ=0 F  S JJJ=$O(^PS(50.625,PSOWRNN,1,JJJ)) Q:'JJJ  S STR=$G(^PS(50.625,PSOWRNN,1,JJJ,0)) S TEXT=TEXT_" "_STR
"RTN","PSSWRNE",65,0)
 I TEXT'="" D FORMAT I $G(PSSLOOK) D FULL^PSSLOOK
"RTN","PSSWRNE",66,0)
 Q
"RTN","PSSWRNE",67,0)
WARN54 ;
"RTN","PSSWRNE",68,0)
 S TEXT=""
"RTN","PSSWRNE",69,0)
 I $D(^PS(54,PSOWARN,1)) D
"RTN","PSSWRNE",70,0)
 .I '$G(PSSLOOK) W !
"RTN","PSSWRNE",71,0)
 .S TEXT=STAR_PSOWARN_" "
"RTN","PSSWRNE",72,0)
 .S JJJ=0 F  S JJJ=$O(^PS(54,PSOWARN,1,JJJ)) Q:'JJJ  S TEXT=TEXT_" "_$G(^PS(54,PSOWARN,1,JJJ,0))
"RTN","PSSWRNE",73,0)
 I TEXT'="" D FORMAT I $G(PSSLOOK) D FULL^PSSLOOK
"RTN","PSSWRNE",74,0)
 Q
"RTN","PSSWRNE",75,0)
VALID ; VALIDATE NEW WARNING LABEL LIST
"RTN","PSSWRNE",76,0)
 N BAD
"RTN","PSSWRNE",77,0)
 S BAD=0
"RTN","PSSWRNE",78,0)
 I $G(X)="" W !,"TOO MANY WARNINGS. LIMIT ANSWER STRING TO 30 CHARACTERS OR LESS" K Y Q
"RTN","PSSWRNE",79,0)
 F I=1:1:$L(X,",") S PSOWARN=$P(X,",",I) I PSOWARN'="" D
"RTN","PSSWRNE",80,0)
 .I PSOWARN["N" S PSOWRNN=+PSOWARN D  Q
"RTN","PSSWRNE",81,0)
 ..I '$D(^PS(50.625,PSOWRNN)) W !,PSOWARN," does not exist in the WARNING LABEL-ENGLISH file" S BAD=1
"RTN","PSSWRNE",82,0)
 .I '$D(^PS(54,PSOWARN)) W !,PSOWARN," does not exist in the RX CONSULT file" S BAD=1
"RTN","PSSWRNE",83,0)
 I BAD K X
"RTN","PSSWRNE",84,0)
 Q
"RTN","PSSWRNE",85,0)
FORMAT ;
"RTN","PSSWRNE",86,0)
 N I,LEN,PTEXT
"RTN","PSSWRNE",87,0)
 S LEN=0,PTEXT=""
"RTN","PSSWRNE",88,0)
 F I=1:1:$L(TEXT," ") S STR=$P(TEXT," ",I)_" " D
"RTN","PSSWRNE",89,0)
 .I LEN+$L(STR)<80 S PTEXT=PTEXT_STR,LEN=LEN+$L(STR) Q
"RTN","PSSWRNE",90,0)
 .S LEN=0,I=I-1 D FULL Q:$G(PSSOUT)  W !,PTEXT S PTEXT=""
"RTN","PSSWRNE",91,0)
 I PTEXT'="" D FULL Q:$G(PSSOUT)  W !,PTEXT S PTEXT=""
"RTN","PSSWRNE",92,0)
 Q
"RTN","PSSWRNE",93,0)
 ;
"RTN","PSSWRNE",94,0)
NOTE ;
"RTN","PSSWRNE",95,0)
 N PSSWSITE
"RTN","PSSWRNE",96,0)
 S PSSWSITE=+$O(^PS(59.7,0)) I $P($G(^PS(59.7,PSSWSITE,10)),"^",9)'="N" D
"RTN","PSSWRNE",97,0)
 .W !,?2,"NOTE: You must edit the WARNING LABEL SOURCE field using the option"
"RTN","PSSWRNE",98,0)
 .W !,?2,"Pharmacy System Parameters Edit to enable national warning labels."
"RTN","PSSWRNE",99,0)
 Q
"RTN","PSSWRNE",100,0)
 ;
"RTN","PSSWRNE",101,0)
DEA ;
"RTN","PSSWRNE",102,0)
 S DEA=$P($G(^PSDRUG(DRUGN,0)),"^",3)
"RTN","PSSWRNE",103,0)
 S XX=DRUGN D WARNLST^PSSWRNA S:PSSWRN="" PSSWRN=$P($G(^PSDRUG(DRUGN,0)),"^",8)
"RTN","PSSWRNE",104,0)
 D CHECK20^PSSWRNA,CHECKLST^PSSWRNA
"RTN","PSSWRNE",105,0)
 Q
"RTN","PSSWRNE",106,0)
 ;
"RTN","PSSWRNE",107,0)
HDR ;
"RTN","PSSWRNE",108,0)
 K DIR S DIR(0)="E" D ^DIR K DIR I 'Y S PSSOUT=1,QUIT=1 Q
"RTN","PSSWRNE",109,0)
 W @IOF
"RTN","PSSWRNE",110,0)
 W "Current Warning labels for ",DRUG,"  (continued)"
"RTN","PSSWRNE",111,0)
 Q
"RTN","PSSWRNE",112,0)
 ;
"RTN","PSSWRNE",113,0)
NOTE2 W !!,?5,"The RX CONSULT File (#54) contains local label expansions."
"RTN","PSSWRNE",114,0)
 W !,?5,"The WARNING LABEL-ENGLISH file (#50.625) contains national label"
"RTN","PSSWRNE",115,0)
 W !,?5,"expansions in English."
"RTN","PSSWRNE",116,0)
 W !,?5,"The WARNING LABEL-SPANISH file (#50.626) contains national label"
"RTN","PSSWRNE",117,0)
 W !,?5,"expansions in Spanish."
"RTN","PSSWRNE",118,0)
 W !,?5,"It is important to note that RX Consult entry numbers do not"
"RTN","PSSWRNE",119,0)
 W !,?5,"correlate with the other files (i.e. Number 7 in file 54 is not"
"RTN","PSSWRNE",120,0)
 W !,?5,"included in file 50.625)."
"RTN","PSSWRNE",121,0)
 W !!,?5,"You should print a list of the current RX CONSULT file entries"
"RTN","PSSWRNE",122,0)
 W !,?5,"and the current WARNING LABEL-ENGLISH file entries."
"RTN","PSSWRNE",123,0)
 W !
"RTN","PSSWRNE",124,0)
 Q
"VER")
8.0^22.2
"BLD",11385,6)
^204
**END**
**END**

