Released PSS*1*227 SEQ #195
Extracted from mail message
**KIDS**:PSS*1.0*227^

**INSTALL NAME**
PSS*1.0*227
"BLD",10636,0)
PSS*1.0*227^PHARMACY DATA MANAGEMENT^0^3180525^y
"BLD",10636,1,0)
^^1^1^3180522^
"BLD",10636,1,1,0)
PSS*1.0*227
"BLD",10636,4,0)
^9.64PA^50^1
"BLD",10636,4,50,0)
50
"BLD",10636,4,50,2,0)
^9.641^50.095^2
"BLD",10636,4,50,2,50,0)
DRUG  (File-top level)
"BLD",10636,4,50,2,50,1,0)
^9.6411^13^1
"BLD",10636,4,50,2,50,1,13,0)
PRICE PER ORDER UNIT
"BLD",10636,4,50,2,50.095,0)
DT/TM DISP UNIT PRICE CHANGED  (sub-file)
"BLD",10636,4,50,2,50.095,1,0)
^9.6411^3^3
"BLD",10636,4,50,2,50.095,1,.01,0)
DT/TM DISP UNIT PRICE CHANGED
"BLD",10636,4,50,2,50.095,1,1,0)
EDITED BY
"BLD",10636,4,50,2,50.095,1,3,0)
NEW VALUE
"BLD",10636,4,50,222)
y^n^p^^^^n^^n
"BLD",10636,4,50,224)

"BLD",10636,4,"APDD",50,50)

"BLD",10636,4,"APDD",50,50,13)

"BLD",10636,4,"APDD",50,50.095)

"BLD",10636,4,"APDD",50,50.095,.01)

"BLD",10636,4,"APDD",50,50.095,1)

"BLD",10636,4,"APDD",50,50.095,3)

"BLD",10636,4,"B",50,50)

"BLD",10636,6)
13^
"BLD",10636,6.3)
18
"BLD",10636,"ABPKG")
n
"BLD",10636,"INID")
^y
"BLD",10636,"INIT")
EN^PSSP227
"BLD",10636,"KRN",0)
^9.67PA^779.2^20
"BLD",10636,"KRN",.4,0)
.4
"BLD",10636,"KRN",.401,0)
.401
"BLD",10636,"KRN",.402,0)
.402
"BLD",10636,"KRN",.403,0)
.403
"BLD",10636,"KRN",.5,0)
.5
"BLD",10636,"KRN",.84,0)
.84
"BLD",10636,"KRN",3.6,0)
3.6
"BLD",10636,"KRN",3.8,0)
3.8
"BLD",10636,"KRN",3.8,"NM",0)
^9.68A^1^1
"BLD",10636,"KRN",3.8,"NM",1,0)
PSS DEE AUDIT^^0
"BLD",10636,"KRN",3.8,"NM","B","PSS DEE AUDIT",1)

"BLD",10636,"KRN",9.2,0)
9.2
"BLD",10636,"KRN",9.8,0)
9.8
"BLD",10636,"KRN",9.8,"NM",0)
^9.68A^5^5
"BLD",10636,"KRN",9.8,"NM",1,0)
PSSDEE^^0^B151650966
"BLD",10636,"KRN",9.8,"NM",2,0)
PSSDEEA^^0^B35151478
"BLD",10636,"KRN",9.8,"NM",3,0)
PSSLOOK^^0^B137576490
"BLD",10636,"KRN",9.8,"NM",4,0)
PSSPRICE^^0^B5169572
"BLD",10636,"KRN",9.8,"NM",5,0)
PSSP227^^0^B5754647
"BLD",10636,"KRN",9.8,"NM","B","PSSDEE",1)

"BLD",10636,"KRN",9.8,"NM","B","PSSDEEA",2)

"BLD",10636,"KRN",9.8,"NM","B","PSSLOOK",3)

"BLD",10636,"KRN",9.8,"NM","B","PSSP227",5)

"BLD",10636,"KRN",9.8,"NM","B","PSSPRICE",4)

"BLD",10636,"KRN",19,0)
19
"BLD",10636,"KRN",19.1,0)
19.1
"BLD",10636,"KRN",101,0)
101
"BLD",10636,"KRN",409.61,0)
409.61
"BLD",10636,"KRN",771,0)
771
"BLD",10636,"KRN",779.2,0)
779.2
"BLD",10636,"KRN",870,0)
870
"BLD",10636,"KRN",8989.51,0)
8989.51
"BLD",10636,"KRN",8989.51,"NM",0)
^9.68A^1^1
"BLD",10636,"KRN",8989.51,"NM",1,0)
PSS DRUG AUDIT RETENTION MOS^^0
"BLD",10636,"KRN",8989.51,"NM","B","PSS DRUG AUDIT RETENTION MOS",1)

"BLD",10636,"KRN",8989.52,0)
8989.52
"BLD",10636,"KRN",8994,0)
8994
"BLD",10636,"KRN","B",.4,.4)

"BLD",10636,"KRN","B",.401,.401)

"BLD",10636,"KRN","B",.402,.402)

"BLD",10636,"KRN","B",.403,.403)

"BLD",10636,"KRN","B",.5,.5)

"BLD",10636,"KRN","B",.84,.84)

"BLD",10636,"KRN","B",3.6,3.6)

"BLD",10636,"KRN","B",3.8,3.8)

"BLD",10636,"KRN","B",9.2,9.2)

"BLD",10636,"KRN","B",9.8,9.8)

"BLD",10636,"KRN","B",19,19)

"BLD",10636,"KRN","B",19.1,19.1)

"BLD",10636,"KRN","B",101,101)

"BLD",10636,"KRN","B",409.61,409.61)

"BLD",10636,"KRN","B",771,771)

"BLD",10636,"KRN","B",779.2,779.2)

"BLD",10636,"KRN","B",870,870)

"BLD",10636,"KRN","B",8989.51,8989.51)

"BLD",10636,"KRN","B",8989.52,8989.52)

"BLD",10636,"KRN","B",8994,8994)

"BLD",10636,"QUES",0)
^9.62^^
"BLD",10636,"REQB",0)
^9.611^2^2
"BLD",10636,"REQB",1,0)
PSS*1.0*195^1
"BLD",10636,"REQB",2,0)
PSS*1.0*213^1
"BLD",10636,"REQB","B","PSS*1.0*195",1)

"BLD",10636,"REQB","B","PSS*1.0*213",2)

"FIA",50)
DRUG
"FIA",50,0)
^PSDRUG(
"FIA",50,0,0)
50I
"FIA",50,0,1)
y^n^p^^^^n^^n
"FIA",50,0,10)

"FIA",50,0,11)

"FIA",50,0,"RLRO")

"FIA",50,0,"VR")
1.0^PSS
"FIA",50,50)
1
"FIA",50,50,13)

"FIA",50,50,50.095)

"FIA",50,50.095)
1
"FIA",50,50.095,.01)

"FIA",50,50.095,1)

"FIA",50,50.095,3)

"INIT")
EN^PSSP227
"KRN",3.8,1477,-1)
0^1
"KRN",3.8,1477,0)
PSS DEE AUDIT^PU^^^^^
"KRN",3.8,1477,2,0)
^3.801^1^1^3180521^^^^
"KRN",3.8,1477,2,1,0)
Mail group for DRUG file audits.
"KRN",3.8,1477,3)

"KRN",8989.51,874,-1)
0^1
"KRN",8989.51,874,0)
PSS DRUG AUDIT RETENTION MOS^NO. OF MONTHS TO RETAIN DRUG AUDIT DATA^0^^NUMBER OF MONTHS
"KRN",8989.51,874,1)
N^1:999^ENTER THE NUMBER OF MONTHS TO RETAIN DRUG AUDIT DATA BEFORE PURGING THEM
"KRN",8989.51,874,20,0)
^^8^8^3170309^
"KRN",8989.51,874,20,1,0)
The purpose of this parameter is to store the number of months that old 
"KRN",8989.51,874,20,2,0)
Drug Audit data will be retained in the DRUG (#50) file. If this value is
"KRN",8989.51,874,20,3,0)
not set, or set to 0, then all audit data will be retained in the file.  
"KRN",8989.51,874,20,4,0)
If set to a whole number value, this value will be multipled by 30 to
"KRN",8989.51,874,20,5,0)
formulate the date that will be the last date of data stored in the file
"KRN",8989.51,874,20,6,0)
(i.e.: 
"KRN",8989.51,874,20,7,0)
2 mos. X 30 = 60, Today's date - 60 will be the lower limit of the data 
"KRN",8989.51,874,20,8,0)
stored).
"KRN",8989.51,874,30,0)
^8989.513I^1^1
"KRN",8989.51,874,30,1,0)
10^4.2
"MBREQ")
0
"ORD",11,3.8)
3.8;11;;;MAILG^XPDTA1;MAILGF1^XPDIA1;MAILGE1^XPDIA1;MAILGF2^XPDIA1;;MAILGDEL^XPDIA1(%)
"ORD",11,3.8,0)
MAIL GROUP
"ORD",20,8989.51)
8989.51;20;;;PAR1E1^XPDTA2;PAR1F1^XPDIA3;PAR1E1^XPDIA3;PAR1F2^XPDIA3;;PAR1DEL^XPDIA3(%)
"ORD",20,8989.51,0)
PARAMETER DEFINITION
"PKG",586,-1)
1^1
"PKG",586,0)
PHARMACY DATA MANAGEMENT^PSS^Maintenance of Pharmacy files.
"PKG",586,20,0)
^9.402P^^
"PKG",586,22,0)
^9.49I^1^1
"PKG",586,22,1,0)
1.0^2970930^2971128^1
"PKG",586,22,1,"PAH",1,0)
227^3180525
"PKG",586,22,1,"PAH",1,1,0)
^^1^1^3180525
"PKG",586,22,1,"PAH",1,1,1,0)
PSS*1.0*227
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
5
"RTN","PSSDEE")
0^1^B151650966^B149682695
"RTN","PSSDEE",1,0)
PSSDEE ;BIR/WRT-MASTER DRUG ENTER/EDIT ROUTINE ; 18 May 2018  10:54 AM
"RTN","PSSDEE",2,0)
 ;;1.0;PHARMACY DATA MANAGEMENT;**3,5,15,16,20,22,28,32,34,33,38,57,47,68,61,82,90,110,155,156,180,193,200,207,195,227**;9/30/97;Build 18
"RTN","PSSDEE",3,0)
 ;
"RTN","PSSDEE",4,0)
 ;Reference to ^PS(59 supported by DBIA #1976
"RTN","PSSDEE",5,0)
 ;Reference to REACT1^PSNOUT supported by DBIA #2080
"RTN","PSSDEE",6,0)
 ;Reference to $$UP^XLFSTR(X) supported by DBIA #10104
"RTN","PSSDEE",7,0)
 ;Reference to $$PSJDF^PSNAPIS(P1,P3) supported by DBIA #2531
"RTN","PSSDEE",8,0)
 ;Reference to PSNAPIS supported by DBIA #2531
"RTN","PSSDEE",9,0)
 ;Reference to ^XMB("NETNAME" supported by DBIA #1131
"RTN","PSSDEE",10,0)
 ;Reference to ^XUSEC supported by DIBA #10076
"RTN","PSSDEE",11,0)
 ;Reference to FDR & FDT^PSNACT supported by DBIA #6754
"RTN","PSSDEE",12,0)
 ;
"RTN","PSSDEE",13,0)
BEGIN N PSSUPRAF,PSSTDRUG
"RTN","PSSDEE",14,0)
 S PSSFLAG=0 D ^PSSDEE2 S PSSZ=1 F PSSXX=1:1 K DA D ASK Q:PSSFLAG
"RTN","PSSDEE",15,0)
DONE D ^PSSDEE2 K PSSFLAGK,PSSXX,DIE,DIR,CLFLAG,CLFALG,DISPDRG,DLAYGO,DR,ENTRY,FLAG,FLG1,FLG2,FLG4,FLG5,FLG6,FLG7,FLGKY,FLGMTH,FLGNDF,FLGOI,K,NEWDF
"RTN","PSSDEE",16,0)
 K NFLAG,NWND,NWPC1,NWPC2,NWPC3OLDDF,PSIUDA,PSIUX,PSNP,PSSANS,PSSASK,PSSDA,PSSDD,PSSFLAG,PSSOR,PSSZ,PSXBT,PSXF,PSXFL,PSXUM,PSXGOOD,PSXLOC,ZAPFLG
"RTN","PSSDEE",17,0)
 Q
"RTN","PSSDEE",18,0)
ASK ;
"RTN","PSSDEE",19,0)
 W ! S DIC="^PSDRUG(",DIC(0)="QEALMNTV",DLAYGO=50,DIC("T")="",DIC("W")="S PSSTDRUG=Y D GETTIER^PSSDEE(PSSTDRUG)" D ^DIC K DIC I Y<0 S PSSFLAG=1 Q
"RTN","PSSDEE",20,0)
 N PSINACT S (FLG1,FLG2,FLG3,FLG4,FLG5,FLG6,FLG7,FLAG,FLGKY,FLGOI,PSINACT)=0 K ^TMP($J,"ADD"),^TMP($J,"SOL")
"RTN","PSSDEE",21,0)
 S DA=+Y,DISPDRG=DA L +^PSDRUG(DISPDRG):0 I '$T W !,$C(7),"Another person is editing this one." Q
"RTN","PSSDEE",22,0)
 D BEFORE^PSSDEEA($T(+0))  ; drug enter/edit auditing
"RTN","PSSDEE",23,0)
 I $G(^PSDRUG(DA,"I")) S PSINACT=$G(^PSDRUG(DA,"I")) I PSINACT,PSINACT<DT S PSINACT=1  ;;<<*180 - RJS
"RTN","PSSDEE",24,0)
 S PSSHUIDG=1,PSSNEW=$P(Y,"^",3) D USE,NOPE,COMMON,DEA,MF K PSSHUIDG,PSSUPRAF
"RTN","PSSDEE",25,0)
 ; if any outpatient site has a dispense machine running HL7 V.2.4, then
"RTN","PSSDEE",26,0)
 ; run the new routine and create message
"RTN","PSSDEE",27,0)
 N XX,DNSNAM,DNSPORT,DVER,DMFU,PSSUPRA S XX=""
"RTN","PSSDEE",28,0)
 F XX=0:0 S XX=$O(^PS(59,XX)) Q:'XX  D
"RTN","PSSDEE",29,0)
 .S DVER=$$GET1^DIQ(59,XX_",",105,"I"),DMFU=$$GET1^DIQ(59,XX_",",105.2)
"RTN","PSSDEE",30,0)
 .S DNSNAM=$$GET1^DIQ(59,XX_",",2006),DNSPORT=$$GET1^DIQ(59,XX_",",2007)
"RTN","PSSDEE",31,0)
 .D:DVER="2.4"&(DNSNAM'="")&(DMFU="YES") DRG^PSSDGUPD(DISPDRG,PSSNEW,DNSNAM,DNSPORT)
"RTN","PSSDEE",32,0)
 D DRG^PSSHUIDG(DISPDRG,PSSNEW) L -^PSDRUG(DISPDRG)
"RTN","PSSDEE",33,0)
 D AFTER^PSSDEEA($T(+0))  ; drug enter/edit auditing
"RTN","PSSDEE",34,0)
 S XX=$P($G(^PSDRUG(DISPDRG,2)),"^",3) I XX["U"!(XX["I") D  S XX=""
"RTN","PSSDEE",35,0)
 .S XX=$$SNDHL7^PSSMSTR() D:XX
"RTN","PSSDEE",36,0)
 ..Q:PSSNEW&'((XX=2)!(XX=3))  ;U=1,N=2,B=3
"RTN","PSSDEE",37,0)
 ..Q:'PSSNEW&(XX=2)  ;U=1,N=2,B=3
"RTN","PSSDEE",38,0)
 ..N VAR
"RTN","PSSDEE",39,0)
 ..I PSSNEW&((XX=2)!(XX=3)) S VAR="Would you like to send this new drug to PADE"
"RTN","PSSDEE",40,0)
 ..E  S VAR="Would you like to send a drug file update to PADE"
"RTN","PSSDEE",41,0)
 ..W !!,"This drug is marked for either UD or IV use, and you have at least"
"RTN","PSSDEE",42,0)
 ..W !,"one active Pharmacy Automated Dispensing Equipment (PADE)."
"RTN","PSSDEE",43,0)
 ..K DIR,DIRUT,DUOUT,DTOUT
"RTN","PSSDEE",44,0)
 ..S DIR(0)="Y",DIR("A")=VAR
"RTN","PSSDEE",45,0)
 ..S DIR("?")="Enter Y for Yes or N for No." D ^DIR K DIR
"RTN","PSSDEE",46,0)
 ..Q:'Y
"RTN","PSSDEE",47,0)
 ..N PSSPADE S PSSPADE=1 S XX=""
"RTN","PSSDEE",48,0)
 ..D ENP^PSSHLDFS(DISPDRG,$S(PSSNEW:"MAD",1:"MUP"))
"RTN","PSSDEE",49,0)
 K FLG3,PSSNEW
"RTN","PSSDEE",50,0)
 Q
"RTN","PSSDEE",51,0)
COMMON S DIE="^PSDRUG(",DR="[PSSCOMMON]" D ^DIE Q:$D(Y)!($D(DTOUT))  W:'$D(Y) !,"PRICE PER DISPENSE UNIT: " S:'$D(^PSDRUG(DA,660)) $P(^PSDRUG(DA,660),"^",6)="" W:'$D(Y) $P(^PSDRUG(DA,660),"^",6)
"RTN","PSSDEE",52,0)
 D DEA,CK,ASKND,OIKILL^PSSDEE1,COMMON1
"RTN","PSSDEE",53,0)
 Q
"RTN","PSSDEE",54,0)
COMMON1 W !,"Just a reminder...you are editing ",$P(^PSDRUG(DISPDRG,0),"^"),"."
"RTN","PSSDEE",55,0)
 S (PSSVVDA,DA)=DISPDRG D DOSN^PSSDOS S DA=PSSVVDA K PSSVVDA D USE,APP,ORDITM^PSSDEE1
"RTN","PSSDEE",56,0)
 Q
"RTN","PSSDEE",57,0)
CK D DSPY^PSSDEE1 S FLGNDF=0
"RTN","PSSDEE",58,0)
 Q
"RTN","PSSDEE",59,0)
ASKND S %=-1 I $D(^XUSEC("PSNMGR",DUZ)) D MESSAGE^PSSDEE1 W !!,"Do you wish to match/rematch to NATIONAL DRUG file" S %=1 S:FLGMTH=1 %=2 D YN^DICN
"RTN","PSSDEE",60,0)
 I %=0 W !,"If you answer ""yes"", you will attempt to match to NDF." G ASKND
"RTN","PSSDEE",61,0)
 S PSSUPRAF=%
"RTN","PSSDEE",62,0)
 I %=2 K X,Y Q
"RTN","PSSDEE",63,0)
 I %<0 K X,Y Q
"RTN","PSSDEE",64,0)
 I %=1 D  ;;<<*180 - RJS
"RTN","PSSDEE",65,0)
 .D RSET^PSSDEE1
"RTN","PSSDEE",66,0)
 .I 'PSINACT D EN1^PSSUTIL(DISPDRG,1)
"RTN","PSSDEE",67,0)
 .S X="PSNOUT" X ^%ZOSF("TEST") I  D REACT1^PSNOUT S DA=DISPDRG I $D(^PSDRUG(DA,"ND")),$P(^PSDRUG(DA,"ND"),"^",2)]"" D ONE
"RTN","PSSDEE",68,0)
 Q  ;;<< *180 - RJS
"RTN","PSSDEE",69,0)
ONE S PSNP=$G(^PSDRUG(DA,"I")) I PSNP,PSNP<DT Q
"RTN","PSSDEE",70,0)
 W !,"You have just VERIFIED this match and MERGED the entry." D CKDF D EN2^PSSUTIL(DISPDRG,1) S:'$D(OLDDF) OLDDF="" I OLDDF'=NEWDF S FLGNDF=1 D WR
"RTN","PSSDEE",71,0)
 Q
"RTN","PSSDEE",72,0)
CKDF S NWND=^PSDRUG(DA,"ND"),NWPC1=$P(NWND,"^",1),NWPC3=$P(NWND,"^",3),DA=NWPC1,K=NWPC3 S X=$$PSJDF^PSNAPIS(DA,K) S NEWDF=$P(X,"^",2),DA=DISPDRG
"RTN","PSSDEE",73,0)
 N PSSK D PKIND^PSSDDUT2
"RTN","PSSDEE",74,0)
 Q
"RTN","PSSDEE",75,0)
NOPE S ZAPFLG=0 I '$D(^PSDRUG(DA,"ND")),$D(^PSDRUG(DA,2)),$P(^PSDRUG(DA,2),"^",1)']"" D DFNULL
"RTN","PSSDEE",76,0)
 I '$D(^PSDRUG(DA,"ND")),'$D(^PSDRUG(DA,2)) D DFNULL
"RTN","PSSDEE",77,0)
 I $D(^PSDRUG(DA,"ND")),$P(^PSDRUG(DA,"ND"),"^",2)']"",$D(^PSDRUG(DA,2)),$P(^PSDRUG(DA,2),"^",1)']"" D DFNULL
"RTN","PSSDEE",78,0)
 Q
"RTN","PSSDEE",79,0)
DFNULL S OLDDF="",ZAPFLG=1
"RTN","PSSDEE",80,0)
 Q
"RTN","PSSDEE",81,0)
ZAPIT I $D(ZAPFLG),ZAPFLG=1,FLGNDF=1,OLDDF'=NEWDF D CKIV^PSSDEE1
"RTN","PSSDEE",82,0)
 Q
"RTN","PSSDEE",83,0)
APP W !!,"MARK THIS DRUG AND EDIT IT FOR: " D CHOOSE
"RTN","PSSDEE",84,0)
 Q
"RTN","PSSDEE",85,0)
CHOOSE I $D(^XUSEC("PSORPH",DUZ))!($D(^XUSEC("PSXCMOPMGR",DUZ))) W !,"O  - Outpatient" S FLG1=1
"RTN","PSSDEE",86,0)
 I $D(^XUSEC("PSJU MGR",DUZ)) W !,"U  - Unit Dose" S FLG2=1
"RTN","PSSDEE",87,0)
 I $D(^XUSEC("PSJI MGR",DUZ)) W !,"I  - IV" S FLG3=1
"RTN","PSSDEE",88,0)
 I $D(^XUSEC("PSGWMGR",DUZ)) W !,"W  - Ward Stock" S FLG4=1
"RTN","PSSDEE",89,0)
 I $D(^XUSEC("PSAMGR",DUZ))!($D(^XUSEC("PSA ORDERS",DUZ))) W !,"D  - Drug Accountability" S FLG5=1
"RTN","PSSDEE",90,0)
 I $D(^XUSEC("PSDMGR",DUZ)) W !,"C  - Controlled Substances" S FLG6=1
"RTN","PSSDEE",91,0)
 I $D(^XUSEC("PSORPH",DUZ)) W !,"X  - Non-VA Med" S FLG7=1
"RTN","PSSDEE",92,0)
 I FLG1,FLG2,FLG3,FLG4,FLG5,FLG6 S FLAG=1
"RTN","PSSDEE",93,0)
 I FLAG W !,"A  - ALL"
"RTN","PSSDEE",94,0)
 W !
"RTN","PSSDEE",95,0)
 I 'FLG1,'FLG2,'FLG3,'FLG4,'FLG5,'FLG6,'FLG7 W !,"You do not have the proper keys to continue. Sorry, this concludes your editing session.",! S FLGKY=1 K DIRUT,X Q
"RTN","PSSDEE",96,0)
 I FLGKY'=1 D
"RTN","PSSDEE",97,0)
 . K DIR S DIR(0)="FO^1:30"
"RTN","PSSDEE",98,0)
 . S DIR("A")="Enter your choice(s) separated by commas "
"RTN","PSSDEE",99,0)
 . F  D ^DIR Q:$$CHECK($$UP^XLFSTR(X))
"RTN","PSSDEE",100,0)
 . S PSSANS=X,PSSANS=$$UP^XLFSTR(PSSANS) D BRANCH,BRANCH1
"RTN","PSSDEE",101,0)
 Q
"RTN","PSSDEE",102,0)
 ;
"RTN","PSSDEE",103,0)
CHECK(X) ; Validates Application Use response
"RTN","PSSDEE",104,0)
 N CHECK,I,C
"RTN","PSSDEE",105,0)
 S CHECK=1 I X=""!(Y["^")!($D(DIRUT)) Q CHECK
"RTN","PSSDEE",106,0)
 F I=1:1:$L(X,",") D
"RTN","PSSDEE",107,0)
 . S C=$P(X,",",I) W !?43,C," - "
"RTN","PSSDEE",108,0)
 . I C="O",FLG1 W "Outpatient" Q
"RTN","PSSDEE",109,0)
 . I C="U",FLG2 W "Unit Dose" Q
"RTN","PSSDEE",110,0)
 . I C="I",FLG3 W "IV" Q
"RTN","PSSDEE",111,0)
 . I C="W",FLG4 W "Ward Stock" Q
"RTN","PSSDEE",112,0)
 . I C="D",FLG5 W "Drug Accountability" Q
"RTN","PSSDEE",113,0)
 . I C="C",FLG6 W "Controlled Substances" Q
"RTN","PSSDEE",114,0)
 . I C="X",FLG7 W "Non-VA Med" Q
"RTN","PSSDEE",115,0)
 . W "Invalid Entry",$C(7) S CHECK=0
"RTN","PSSDEE",116,0)
 Q CHECK
"RTN","PSSDEE",117,0)
BRANCH D:PSSANS["O" OP D:PSSANS["U" UD D:PSSANS["I" IV D:PSSANS["W" WS
"RTN","PSSDEE",118,0)
 D:PSSANS["D" DACCT D:PSSANS["C" CS D:PSSANS["X" NVM
"RTN","PSSDEE",119,0)
 Q
"RTN","PSSDEE",120,0)
BRANCH1 I FLAG,PSSANS["A" D OP,UD,IV,WS,DACCT,CS,NVM
"RTN","PSSDEE",121,0)
 Q
"RTN","PSSDEE",122,0)
OP I FLG1 D
"RTN","PSSDEE",123,0)
 . W !,"** You are NOW editing OUTPATIENT fields. **"
"RTN","PSSDEE",124,0)
 . S PSIUDA=DA,PSIUX="O^Outpatient Pharmacy" D ^PSSGIU
"RTN","PSSDEE",125,0)
 . I %=1 D
"RTN","PSSDEE",126,0)
 . . S DIE="^PSDRUG(",DR="[PSSOP]" D ^DIE K DIR D OPEI,ASKCMOP
"RTN","PSSDEE",127,0)
 . . S X="PSOCLO1" X ^%ZOSF("TEST") I  D ASKCLOZ S FLGOI=1
"RTN","PSSDEE",128,0)
 I FLG1 D CKCMOP
"RTN","PSSDEE",129,0)
 Q
"RTN","PSSDEE",130,0)
CKCMOP I $P($G(^PSDRUG(DISPDRG,2)),"^",3)'["O" S:$D(^PSDRUG(DISPDRG,3)) $P(^PSDRUG(DISPDRG,3),"^",1)=0 K:$D(^PSDRUG("AQ",DISPDRG)) ^PSDRUG("AQ",DISPDRG) S DA=DISPDRG D ^PSSREF
"RTN","PSSDEE",131,0)
 Q
"RTN","PSSDEE",132,0)
UD I FLG2 W !,"** You are NOW editing UNIT DOSE fields. **" S PSIUDA=DA,PSIUX="U^Unit Dose" D ^PSSGIU I %=1 S DIE="^PSDRUG(",DR="62.05;212.2" D ^DIE S DIE="^PSDRUG(",DR="212",DR(2,50.0212)=".01;1" D ^DIE S FLGOI=1
"RTN","PSSDEE",133,0)
 Q
"RTN","PSSDEE",134,0)
IV I FLG3 W !,"** You are NOW editing IV fields. **" S (PSIUDA,PSSDA)=DA,PSIUX="I^IV" D ^PSSGIU I %=1 D IV1 S FLGOI=1
"RTN","PSSDEE",135,0)
 Q
"RTN","PSSDEE",136,0)
IV1 K PSSIVOUT ;This variable controls the selection process loop.
"RTN","PSSDEE",137,0)
 W !,"Edit Additives or Solutions: " K DIR S DIR(0)="SO^A:ADDITIVES;S:SOLUTIONS;" D ^DIR Q:$D(DIRUT)  S PSSASK=Y(0) D:PSSASK="ADDITIVES" ENA^PSSVIDRG D:PSSASK="SOLUTIONS" ENS^PSSVIDRG I '$D(PSSIVOUT) G IV1
"RTN","PSSDEE",138,0)
 K PSSIVOUT
"RTN","PSSDEE",139,0)
 Q
"RTN","PSSDEE",140,0)
WS I FLG4 W !,"** You are NOW editing WARD STOCK fields. **" S DIE="^PSDRUG(",DR="300;301;302" D ^DIE
"RTN","PSSDEE",141,0)
 Q
"RTN","PSSDEE",142,0)
DACCT I FLG5 W !,"** You are NOW editing DRUG ACCOUNTABILITY fields. **" S DIE="^PSDRUG(",DR="441" D ^DIE S DIE="^PSDRUG(",DR="9",DR(2,50.1)="1;2;400;401;402;403;404;405" D ^DIE
"RTN","PSSDEE",143,0)
 Q
"RTN","PSSDEE",144,0)
CS I FLG6 W !,"** You are NOW Marking/Unmarking for CONTROLLED SUBS. **" S PSIUDA=DA,PSIUX="N^Controlled Substances" D ^PSSGIU
"RTN","PSSDEE",145,0)
 Q
"RTN","PSSDEE",146,0)
NVM I FLG7 W !,"** You are NOW Marking/Unmarking for NON-VA MEDS. **" S PSIUDA=DA,PSIUX="X^Non-VA Med" D ^PSSGIU
"RTN","PSSDEE",147,0)
 Q
"RTN","PSSDEE",148,0)
ASKCMOP I $D(^XUSEC("PSXCMOPMGR",DUZ)) W !!,"Do you wish to mark to transmit to CMOP? " K DIR S DIR(0)="Y",DIR("?")="If you answer ""yes"", you will attempt to mark this drug to transmit to CMOP."
"RTN","PSSDEE",149,0)
 D ^DIR I "Nn"[X K X,Y,DIRUT Q
"RTN","PSSDEE",150,0)
 I "Yy"[X S PSXFL=0 D TEXT^PSSMARK H 7 N PSXUDA S (PSXUM,PSXUDA)=DA,PSXLOC=$P(^PSDRUG(DA,0),"^"),PSXGOOD=0,PSXF=0,PSXBT=0 D BLD^PSSMARK,PICK2^PSSMARK S DA=PSXUDA
"RTN","PSSDEE",151,0)
 Q
"RTN","PSSDEE",152,0)
ASKCLOZ W !!,"Do you wish to mark/unmark as a LAB MONITOR or CLOZAPINE DRUG? " K DIR S DIR(0)="Y",DIR("?")="If you answer ""yes"", you will have the opportunity to edit LAB MONITOR or CLOZAPINE fields."
"RTN","PSSDEE",153,0)
 D ^DIR I "Nn"[X K X,Y,DIRUT Q
"RTN","PSSDEE",154,0)
 I "Yy"[X S NFLAG=0 D MONCLOZ
"RTN","PSSDEE",155,0)
 Q
"RTN","PSSDEE",156,0)
MONCLOZ K PSSAST D FLASH W !,"Mark/Unmark for Lab Monitor or Clozapine: " K DIR S DIR(0)="S^L:LAB MONITOR;C:CLOZAPINE;" D ^DIR Q:$D(DIRUT)  S PSSAST=Y(0) D:PSSAST="LAB MONITOR" ^PSSLAB D:PSSAST="CLOZAPINE" CLOZ
"RTN","PSSDEE",157,0)
 Q
"RTN","PSSDEE",158,0)
FLASH K LMFLAG,CLFALG,WHICH S WHICH=$P($G(^PSDRUG(DISPDRG,"CLOZ1")),"^"),LMFLAG=0,CLFLAG=0
"RTN","PSSDEE",159,0)
 I WHICH="PSOCLO1" S CLFLAG=1
"RTN","PSSDEE",160,0)
 I WHICH'="PSOCLO1" S:WHICH'="" LMFLAG=1
"RTN","PSSDEE",161,0)
 Q
"RTN","PSSDEE",162,0)
CLOZ Q:NFLAG  Q:$D(DTOUT)  Q:$D(DIRUT)  Q:$D(DUOUT)  W !,"** You are NOW editing CLOZAPINE fields. **" D ^PSSCLDRG
"RTN","PSSDEE",163,0)
 Q
"RTN","PSSDEE",164,0)
USE K PACK S PACK="" S:$P($G(^PSDRUG(DISPDRG,"PSG")),"^",2)]"" PACK="W" I $D(^PSDRUG(DISPDRG,2)) S PACK=PACK_$P(^PSDRUG(DISPDRG,2),"^",3)
"RTN","PSSDEE",165,0)
 I PACK'="" D
"RTN","PSSDEE",166,0)
 .W $C(7) N XX W !! F XX=1:1:79 W "*"
"RTN","PSSDEE",167,0)
 .W !,"This entry is marked for the following PHARMACY packages: "
"RTN","PSSDEE",168,0)
 .D USE1
"RTN","PSSDEE",169,0)
 Q
"RTN","PSSDEE",170,0)
USE1 W:PACK["O" !," Outpatient" W:PACK["U" !," Unit Dose" W:PACK["I" !," IV"
"RTN","PSSDEE",171,0)
 W:PACK["W" !," Ward Stock" W:PACK["D" !," Drug Accountability"
"RTN","PSSDEE",172,0)
 W:PACK["N" !," Controlled Substances" W:PACK["X" !," Non-VA Med"
"RTN","PSSDEE",173,0)
 W:'$D(PACK) !," NONE"
"RTN","PSSDEE",174,0)
 I PACK'["O",PACK'["U",PACK'["I",PACK'["W",PACK'["D",PACK'["N",PACK'["X" W !," NONE"
"RTN","PSSDEE",175,0)
 Q
"RTN","PSSDEE",176,0)
WR I ^XMB("NETNAME")'["CMOP-" W:OLDDF'="" !,"The dosage form has changed from "_OLDDF_" to "_NEWDF_" due to",!,"matching/rematching to NDF.",!,"You will need to rematch to Orderable Item.",!
"RTN","PSSDEE",177,0)
 Q
"RTN","PSSDEE",178,0)
PRIMDRG I $D(^PS(59.7,1,20)),$P(^PS(59.7,1,20),"^",1)=4!($P(^PS(59.7,1,20),"^",1)=4.5) I $D(^PSDRUG(DISPDRG,2)) S VAR=$P(^PSDRUG(DISPDRG,2),"^",3) I VAR["U"!(VAR["I") D PRIM1
"RTN","PSSDEE",179,0)
 Q
"RTN","PSSDEE",180,0)
PRIM1 W !!,"You need to match this drug to ""PRIMARY DRUG"" file as well.",! S DIE="^PSDRUG(",DR="64",DA=DISPDRG D ^DIE K VAR
"RTN","PSSDEE",181,0)
 Q
"RTN","PSSDEE",182,0)
MF I $P($G(^PS(59.7,1,80)),"^",2)>1 I $D(^PSDRUG(DISPDRG,2)) S PSSOR=$P(^PSDRUG(DISPDRG,2),"^",1) I PSSOR]"" D EN^PSSPOIDT(PSSOR),EN2^PSSHL1(PSSOR,"MUP")
"RTN","PSSDEE",183,0)
 Q
"RTN","PSSDEE",184,0)
MFA I $P($G(^PS(59.7,1,80)),"^",2)>1 S PSSOR=$P(^PS(52.6,ENTRY,0),"^",11),PSSDD=$P(^PS(52.6,ENTRY,0),"^",2) I PSSOR]"" D EN^PSSPOIDT(PSSOR),EN2^PSSHL1(PSSOR,"MUP") D MFDD
"RTN","PSSDEE",185,0)
 Q
"RTN","PSSDEE",186,0)
MFS I $P($G(^PS(59.7,1,80)),"^",2)>1 S PSSOR=$P(^PS(52.7,ENTRY,0),"^",11),PSSDD=$P(^PS(52.7,ENTRY,0),"^",2) I PSSOR]"" D EN^PSSPOIDT(PSSOR),EN2^PSSHL1(PSSOR,"MUP") D MFDD
"RTN","PSSDEE",187,0)
 Q
"RTN","PSSDEE",188,0)
MFDD I $D(^PSDRUG(PSSDD,2)) S PSSOR=$P(^PSDRUG(PSSDD,2),"^",1) I PSSOR]"" D EN^PSSPOIDT(PSSOR),EN2^PSSHL1(PSSOR,"MUP")
"RTN","PSSDEE",189,0)
 Q
"RTN","PSSDEE",190,0)
OPEI ;
"RTN","PSSDEE",191,0)
 S DIE="^PSDRUG(",DR="28",DA=DISPDRG
"RTN","PSSDEE",192,0)
 D ^DIE
"RTN","PSSDEE",193,0)
 Q:'+$P($G(^PSDRUG(DA,6)),"^")
"RTN","PSSDEE",194,0)
OPEI2 ; get external dispensing devices associated with the drug
"RTN","PSSDEE",195,0)
 W !!,"Defining a dispensing device at the drug level for a division will override"
"RTN","PSSDEE",196,0)
 W !,"the dispensing device settings in the OUTPATIENT SITE File (#59). If populated,",!,"the drug will be sent to the dispensing device for that division.",!
"RTN","PSSDEE",197,0)
 S DR="906"
"RTN","PSSDEE",198,0)
 D ^DIE
"RTN","PSSDEE",199,0)
 Q
"RTN","PSSDEE",200,0)
DEA ;
"RTN","PSSDEE",201,0)
 I $P($G(^PSDRUG(DISPDRG,3)),"^")=1,($P(^PSDRUG(DISPDRG,0),"^",3)[1!($P(^(0),"^",3)[2)) D DSH
"RTN","PSSDEE",202,0)
 Q
"RTN","PSSDEE",203,0)
DSH W !!,"****************************************************************************"
"RTN","PSSDEE",204,0)
 W !,"This entry contains a ""1"" or a ""2"" in the ""DEA, SPECIAL HDLG""",!,"field, therefore this item has been UNMARKED for CMOP transmission."
"RTN","PSSDEE",205,0)
 W !,"****************************************************************************",! S $P(^PSDRUG(DISPDRG,3),"^")=0 K ^PSDRUG("AQ",DISPDRG) S DA=DISPDRG N % D ^PSSREF
"RTN","PSSDEE",206,0)
 Q
"RTN","PSSDEE",207,0)
CPTIER(VAPID) ;Called from PSSCOMMON Input Template
"RTN","PSSDEE",208,0)
 ; VAPID = IEN OF DRUG FILE #50
"RTN","PSSDEE",209,0)
 N CPDATE,X,PSSCP D NOW^%DTC S CPDATE=X S PSSCP=$$CPTIER^PSNAPIS("",CPDATE,VAPID,1) K CPDATE,X
"RTN","PSSDEE",210,0)
 ;  PSSCP = Copay Tier^Effective Date^End Date
"RTN","PSSDEE",211,0)
 W !,"Copay Tier: ",$P(PSSCP,"^",1)
"RTN","PSSDEE",212,0)
 W !,"Copay Effective Date: " S Y=$P(PSSCP,"^",2) D DD^%DT W Y K Y,PSSCP
"RTN","PSSDEE",213,0)
 Q
"RTN","PSSDEE",214,0)
 ;
"RTN","PSSDEE",215,0)
GETTIER(PSSTDRUG) ;called by DIC to get copay tier for today's date 
"RTN","PSSDEE",216,0)
 N VAPID,CPDATE,X,PSSCP,VAPROD,PSSDRGCL,PSSCONVD,PSSINACT,PSSFSN,PSSNFORM,PSSMSG,PSSRESTR,PSSDRDAT,PSSFD D NOW^%DTC S CPDATE=X
"RTN","PSSDEE",217,0)
 D GETS^DIQ(50,PSSTDRUG,"2;22;51;6;100;101;102","IE","PSSDRDAT")
"RTN","PSSDEE",218,0)
 S (PSSDRGCL,PSSFSN,PSSNFORM,PSSINACT,PSSMSG,PSSRESTR,VAPROD)=""
"RTN","PSSDEE",219,0)
 S:$G(PSSDRDAT(50,PSSTDRUG_",",2,"E"))'="" PSSDRGCL=PSSDRDAT(50,PSSTDRUG_",",2,"E")
"RTN","PSSDEE",220,0)
 S:$G(PSSDRDAT(50,PSSTDRUG_",",6,"E"))'="" PSSFSN=PSSDRDAT(50,PSSTDRUG_",",6,"E")
"RTN","PSSDEE",221,0)
 S:$G(PSSDRDAT(50,PSSTDRUG_",",51,"E"))'="" PSSNFORM=PSSDRDAT(50,PSSTDRUG_",",51,"E")
"RTN","PSSDEE",222,0)
 S:$G(PSSDRDAT(50,PSSTDRUG_",",100,"I")) PSSINACT=PSSDRDAT(50,PSSTDRUG_",",100,"I")
"RTN","PSSDEE",223,0)
 S:$G(PSSDRDAT(50,PSSTDRUG_",",101,"E"))'="" PSSMSG=PSSDRDAT(50,PSSTDRUG_",",101,"E")
"RTN","PSSDEE",224,0)
 S:$G(PSSDRDAT(50,PSSTDRUG_",",102,"E"))'="" PSSRESTR=PSSDRDAT(50,PSSTDRUG_",",102,"E")
"RTN","PSSDEE",225,0)
 S:$G(PSSDRDAT(50,PSSTDRUG_",",22,"I")) VAPROD=PSSDRDAT(50,PSSTDRUG_",",22,"I")
"RTN","PSSDEE",226,0)
 W " "_$$GET1^DIQ(50,PSSTDRUG,2)
"RTN","PSSDEE",227,0)
 S PSSCP=$$CPTIER^PSNAPIS(VAPROD,CPDATE,"",1) K CPDATE,X
"RTN","PSSDEE",228,0)
 W:$G(PSSFSN)["" "  "_PSSFSN W:$G(PSSNFORM)["" "  ",PSSNFORM ;FSN; local non-formulary
"RTN","PSSDEE",229,0)
 S PSSFD=$$FDR^PSNACT(VAPROD) ;ppsn
"RTN","PSSDEE",230,0)
 W:PSSFD'="" "  "_PSSFD
"RTN","PSSDEE",231,0)
 I $G(VAPROD),$P(PSSCP,"^")'="" W "  Tier ",$P(PSSCP,"^")
"RTN","PSSDEE",232,0)
 S:$G(PSSINACT) PSSCONVD=$$DATE(PSSINACT)  ;inactive date
"RTN","PSSDEE",233,0)
 W:$G(PSSCONVD)'="" "  "_PSSCONVD
"RTN","PSSDEE",234,0)
 W:$G(PSSMSG)'="" "  "_PSSMSG
"RTN","PSSDEE",235,0)
 W:$G(PSSRESTR)'="" "  "_PSSRESTR
"RTN","PSSDEE",236,0)
 Q
"RTN","PSSDEE",237,0)
 ;
"RTN","PSSDEE",238,0)
DATE(PSSCONVD) ;convert fileman date to mm/dd/yyyy
"RTN","PSSDEE",239,0)
 N DATE
"RTN","PSSDEE",240,0)
 S DATE="",DATE=$E(PSSCONVD,4,5)_"/"_$E(PSSCONVD,6,7)_"/"_(1700+$E(PSSCONVD,1,3))
"RTN","PSSDEE",241,0)
 Q DATE
"RTN","PSSDEE",242,0)
 ;
"RTN","PSSDEE",243,0)
FD(PSSTDRUG) ;
"RTN","PSSDEE",244,0)
 N VAPROD,PSSDRDAT
"RTN","PSSDEE",245,0)
 D GETS^DIQ(50,PSSTDRUG,22,"I","PSSDRDAT")
"RTN","PSSDEE",246,0)
 S VAPROD=PSSDRDAT(50,PSSTDRUG_",",22,"I")
"RTN","PSSDEE",247,0)
 Q:VAPROD=""
"RTN","PSSDEE",248,0)
 S PSSFD="",PSSFD=$$GET1^DIQ(50.68,VAPROD,109)  ;ppsn
"RTN","PSSDEE",249,0)
 W:PSSFD'="" !,"Formulary Designator: "_PSSFD
"RTN","PSSDEE",250,0)
 I $D(^PSNDF(50.68,VAPROD,5.1,1,0)) D FDT^PSNACT(VAPROD) ;ppsn
"RTN","PSSDEE",251,0)
 Q
"RTN","PSSDEEA")
0^2^B35151478^B35151478
"RTN","PSSDEEA",1,0)
PSSDEEA ;PBM/RMS - DRUG FILE ENTER/EDIT AUDIT ; 18 May 2018  10:55 AM
"RTN","PSSDEEA",2,0)
 ;;1.0;PHARMACY DATA MANAGEMENT;**227**;;Build 18
"RTN","PSSDEEA",3,0)
 ;------------------------------------------------------------------
"RTN","PSSDEEA",4,0)
BEFORE(TAG) ;
"RTN","PSSDEEA",5,0)
 ; Capture the drug entry before it is edited to have to compare to
"RTN","PSSDEEA",6,0)
 ; after the user completes the editing.  Email changes in
"RTN","PSSDEEA",7,0)
 ; linetag 'AFTER' (called at the end of PSSDEE).
"RTN","PSSDEEA",8,0)
 ; From: PSSDEE [PSS DRUG ENTER/EDIT]
"RTN","PSSDEEA",9,0)
 ; Output:
"RTN","PSSDEEA",10,0)
 ;   1. ^UTILITY(TAG,$J,DA)=Drug file entry number DA before editing
"RTN","PSSDEEA",11,0)
 ;   2. ZDA ; DA or IEN of Drug file #50 entry
"RTN","PSSDEEA",12,0)
 ;   3. ZN    ; Will be equal to 1 if a new drug was entered into file
"RTN","PSSDEEA",13,0)
 ;
"RTN","PSSDEEA",14,0)
 ;ZEXCEPT: DA,Y,ZDA,ZN
"RTN","PSSDEEA",15,0)
 ;
"RTN","PSSDEEA",16,0)
 K ^UTILITY(TAG,$J,DA)
"RTN","PSSDEEA",17,0)
 M ^UTILITY(TAG,$J,DA)=^PSDRUG(DA)
"RTN","PSSDEEA",18,0)
 ;
"RTN","PSSDEEA",19,0)
 S ZDA=DA,ZN=$P(Y,"^",3)
"RTN","PSSDEEA",20,0)
 ;
"RTN","PSSDEEA",21,0)
 Q
"RTN","PSSDEEA",22,0)
 ;------------------------------------------------------------------
"RTN","PSSDEEA",23,0)
AFTER(TAG) ;
"RTN","PSSDEEA",24,0)
 ;
"RTN","PSSDEEA",25,0)
 ; DOCUMENTATION AND SETUP INFORMATION
"RTN","PSSDEEA",26,0)
 ;
"RTN","PSSDEEA",27,0)
 ; Modifications:
"RTN","PSSDEEA",28,0)
 ;
"RTN","PSSDEEA",29,0)
 ; * PSSDEE calls BEFORE^PSSDEEA to create ^UTILITY("PSSDEE",$J,DA) data.
"RTN","PSSDEEA",30,0)
 ;   ^UTILITY data holds all ^PSDRUG data for drug prior to any
"RTN","PSSDEEA",31,0)
 ;   editing.
"RTN","PSSDEEA",32,0)
 ; * PSSDEE later calls AFTER^PSSDEEA to compare the value of the drug
"RTN","PSSDEEA",33,0)
 ;   file entry after editing to the pre-snapshot values held in
"RTN","PSSDEEA",34,0)
 ;   ^UTILITY.  If changes have been made, a Mailman message is
"RTN","PSSDEEA",35,0)
 ;   sent to members of a mail group.  (See SETUP below)
"RTN","PSSDEEA",36,0)
 ;
"RTN","PSSDEEA",37,0)
 ; Note: USING the Drug Enter/Edit option is sufficient to trigger
"RTN","PSSDEEA",38,0)
 ; the audit email, even if a non-audited field is the only change
"RTN","PSSDEEA",39,0)
 ; made by the user.
"RTN","PSSDEEA",40,0)
 ;
"RTN","PSSDEEA",41,0)
 ; ZEXCEPT: PSSZMES,PSSZNOC,ANS,CHANGES,COUNT,FIELD,FLAG,LABEL,NEWVAL,OLDVAL,USER,ZDA,ZDAN,ZN,PSSZNODE,ZZJ
"RTN","PSSDEEA",42,0)
EN Q:'$G(ZDA)
"RTN","PSSDEEA",43,0)
 N COUNT,USER S COUNT=6,USER=$P(^VA(200,DUZ,0),"^"),ZDAN=$P(^PSDRUG(ZDA,0),"^")
"RTN","PSSDEEA",44,0)
 D HEADER
"RTN","PSSDEEA",45,0)
 D COMPAR
"RTN","PSSDEEA",46,0)
 D SEND
"RTN","PSSDEEA",47,0)
 K PSSZMES,ZDA,ZDAN,LABEL,PSSZNODE,OLDVAL,NEWVAL,FIELD,CHANGES,FLAG,ZZJ,ANS,ZN,PSSZNOC
"RTN","PSSDEEA",48,0)
 S NEWVAL=""
"RTN","PSSDEEA",49,0)
 Q
"RTN","PSSDEEA",50,0)
HEADER ;HEADER FOR FIELDS CHANGED IN THE DRUG ENTER/EDIT OPTION
"RTN","PSSDEEA",51,0)
 ; ZEXCEPT: PSSZMES,USER,ZDAN
"RTN","PSSDEEA",52,0)
 S PSSZMES(1)="Please Note:  The Drug Enter/Edit option was used by "_USER_"."
"RTN","PSSDEEA",53,0)
 S PSSZMES(2)="The drug that was entered/edited was "_ZDAN_"."
"RTN","PSSDEEA",54,0)
 S PSSZMES(3)="-------------------------------------------------------------------------------"
"RTN","PSSDEEA",55,0)
 Q
"RTN","PSSDEEA",56,0)
COMPAR ;
"RTN","PSSDEEA",57,0)
 ; ZEXCEPT: PSSZMES,ANS,FLAG,LABEL,NEWVAL,OLDVAL,ZDA,TAG,PSSZNOC
"RTN","PSSDEEA",58,0)
 N CHANGES,NEWVAL,OLDVAL,SPACES,PSSZNODE,ZZJ
"RTN","PSSDEEA",59,0)
 S $P(SPACES," ",80)="",PSSZNOC=0
"RTN","PSSDEEA",60,0)
 F PSSZNODE=0,2,3,8.5,660,660.1,"EPH","I","ND" I $G(ZDA) D
"RTN","PSSDEEA",61,0)
 .S:ZN=1 ^UTILITY(TAG,$J,ZDA,PSSZNODE)=""
"RTN","PSSDEEA",62,0)
 .Q:'$D(^PSDRUG(ZDA,PSSZNODE))&('$D(^UTILITY(TAG,$J,ZDA,PSSZNODE)))
"RTN","PSSDEEA",63,0)
 .I '$D(^UTILITY(TAG,$J,ZDA,PSSZNODE))&($D(^PSDRUG(ZDA,PSSZNODE))) S CHANGES(PSSZNODE)=^PSDRUG(ZDA,PSSZNODE)
"RTN","PSSDEEA",64,0)
 .I '$D(^PSDRUG(ZDA,PSSZNODE))&($D(^UTILITY(TAG,$J,ZDA,PSSZNODE))) S CHANGES(PSSZNODE)=^UTILITY(TAG,$J,ZDA,PSSZNODE)
"RTN","PSSDEEA",65,0)
 .Q:$D(CHANGES(PSSZNODE))!('$D(^PSDRUG(ZDA,PSSZNODE)))!('$D(^UTILITY(TAG,$J,ZDA,PSSZNODE)))
"RTN","PSSDEEA",66,0)
 .Q:^UTILITY(TAG,$J,ZDA,PSSZNODE)=^PSDRUG(ZDA,PSSZNODE)
"RTN","PSSDEEA",67,0)
 .S CHANGES(PSSZNODE)=""
"RTN","PSSDEEA",68,0)
 .F ZZJ=1:1:10 S FLAG=0,ANS="" S:$P(^PSDRUG(ZDA,PSSZNODE),"^",ZZJ)'=$P(^UTILITY(TAG,$J,ZDA,PSSZNODE),"^",ZZJ) ANS=$P(^UTILITY(TAG,$J,ZDA,PSSZNODE),"^",ZZJ),FLAG=1 S:FLAG=1&(ANS="") ANS="NULL" S CHANGES(PSSZNODE)=CHANGES(PSSZNODE)_ANS_"^"
"RTN","PSSDEEA",69,0)
 I '$D(CHANGES) S PSSZNOC=1,PSSZMES(4)="     ***   No Audited Changes Made  ***" Q
"RTN","PSSDEEA",70,0)
 S FLAG=0
"RTN","PSSDEEA",71,0)
 F PSSZNODE=0,2,3,8.5,660,660.1,"EPH","I","ND" S LABEL="SUB"_PSSZNODE I $D(CHANGES(PSSZNODE)) F ZZJ=1:1:11 Q:"^^^^^^^^^^^^^^^^^"[$P(CHANGES(PSSZNODE),"^",ZZJ,11)  Q:$P(CHANGES(PSSZNODE),"^",ZZJ,11)=""  D:'$D(^UTILITY(TAG,$J,ZDA)) SETLB Q:FLAG  D
"RTN","PSSDEEA",72,0)
 .S OLDVAL=$P(CHANGES(PSSZNODE),"^",ZZJ) Q:OLDVAL=""  S OLDVAL=OLDVAL_$$OLDEXT(OLDVAL,PSSZNODE,ZZJ)
"RTN","PSSDEEA",73,0)
 .S:$D(^PSDRUG(ZDA,PSSZNODE)) NEWVAL=$P(^PSDRUG(ZDA,PSSZNODE),"^",ZZJ)_$$NEWEXT(ZDA,PSSZNODE,ZZJ)
"RTN","PSSDEEA",74,0)
 .D STOR
"RTN","PSSDEEA",75,0)
 Q
"RTN","PSSDEEA",76,0)
OLDEXT(OLDVAL,PSSZNODE,PIECE) ;COMPUTE EXTERNAL 'OLD' VALUE WHERE NECESSARY
"RTN","PSSDEEA",77,0)
 N FIELDNUM,FIELDTYP,PTRFILE
"RTN","PSSDEEA",78,0)
 S FIELDNUM=$O(^DD(50,"GL",PSSZNODE,PIECE,0))
"RTN","PSSDEEA",79,0)
 Q:'+FIELDNUM ""
"RTN","PSSDEEA",80,0)
 S FIELDTYP=$P(^DD(50,FIELDNUM,0),U,2)
"RTN","PSSDEEA",81,0)
 I $E(FIELDTYP)'="P" Q ""
"RTN","PSSDEEA",82,0)
 S PTRFILE=+$E(FIELDTYP,2,99)
"RTN","PSSDEEA",83,0)
 Q " ("_$$GET1^DIQ(PTRFILE,OLDVAL,.01)_")"
"RTN","PSSDEEA",84,0)
NEWEXT(ZDA,PSSZNODE,PIECE) ;COMPUTE EXTERNAL 'NEW' VALUE WHERE NECESSARY
"RTN","PSSDEEA",85,0)
 N FIELDNUM,INTERNAL,EXTERNAL
"RTN","PSSDEEA",86,0)
 S FIELDNUM=$O(^DD(50,"GL",PSSZNODE,PIECE,0))
"RTN","PSSDEEA",87,0)
 Q:'+FIELDNUM ""
"RTN","PSSDEEA",88,0)
 S EXTERNAL=$$GET1^DIQ(50,ZDA,FIELDNUM)
"RTN","PSSDEEA",89,0)
 S INTERNAL=$$GET1^DIQ(50,ZDA,FIELDNUM,"I")
"RTN","PSSDEEA",90,0)
 Q:(INTERNAL=EXTERNAL) ""
"RTN","PSSDEEA",91,0)
 Q " ("_EXTERNAL_")"
"RTN","PSSDEEA",92,0)
SEND ;
"RTN","PSSDEEA",93,0)
 ; ZEXCEPT: ZDA,ZDAN,PSSZNOC
"RTN","PSSDEEA",94,0)
 N XMDUZ,XMSUB,XMTEXT,XMY
"RTN","PSSDEEA",95,0)
 S XMSUB=$S(PSSZNOC:"DRUG ENTER/EDIT ACCESS (",1:"DRUG ENTER/EDIT AUDIT (")_$G(ZDA)_":"_$G(ZDAN)_")",XMDUZ=$S($G(DUZ):DUZ,1:.5)
"RTN","PSSDEEA",96,0)
 S XMTEXT="PSSZMES("
"RTN","PSSDEEA",97,0)
 S XMY("G.PSS DEE AUDIT")="",XMY(DUZ)=""
"RTN","PSSDEEA",98,0)
 D ^XMD
"RTN","PSSDEEA",99,0)
 Q
"RTN","PSSDEEA",100,0)
STOR ;STORES VALUES INTO MAILMAN VARIABLES
"RTN","PSSDEEA",101,0)
 ; ZEXCEPT: PSSZMES,COUNT,FIELD,LABEL,NEWVAL,OLDVAL,SPACES
"RTN","PSSDEEA",102,0)
 S:LABEL["660.1" LABEL="SUB6601"
"RTN","PSSDEEA",103,0)
 S:LABEL["8.5" LABEL="SUB85"
"RTN","PSSDEEA",104,0)
 S FIELD=$P($T(@(LABEL)+ZZJ),";",3)
"RTN","PSSDEEA",105,0)
 ;S PSSZMES(COUNT)=FIELD_$E(SPACES,1,30-$L(FIELD))_OLDVAL_$E(SPACES,1,30-$L(OLDVAL))_$G(NEWVAL),COUNT=COUNT+1
"RTN","PSSDEEA",106,0)
 S PSSZMES(COUNT)=FIELD,COUNT=COUNT+1
"RTN","PSSDEEA",107,0)
 S PSSZMES(COUNT)=$E(SPACES,1,5)_"OLD: "_OLDVAL,COUNT=COUNT+1
"RTN","PSSDEEA",108,0)
 S PSSZMES(COUNT)=$E(SPACES,1,5)_"NEW: "_$G(NEWVAL),COUNT=COUNT+1
"RTN","PSSDEEA",109,0)
 S PSSZMES(COUNT)=" ",COUNT=COUNT+1
"RTN","PSSDEEA",110,0)
 Q
"RTN","PSSDEEA",111,0)
SETLB ;SETS $TEXT LABEL
"RTN","PSSDEEA",112,0)
 ; ZEXCEPT: LABEL,PSSZNODE
"RTN","PSSDEEA",113,0)
 S LABEL=$S(PSSZNODE=0:"SUB0",PSSZNODE=2:"SUB2",PSSZNODE=3:"SUB3",PSSZNODE=8.5:"SUB85",PSSZNODE=660:"SUB660",PSSZNODE=660.1:"SUB6601",PSSZNODE="EPH":"SUBEPH",PSSZNODE="ND":"SUBND",1:"SUBI")
"RTN","PSSDEEA",114,0)
 Q
"RTN","PSSDEEA",115,0)
SUB0 ;FIELDS FOR ^PSDRUG(ZDA,0)
"RTN","PSSDEEA",116,0)
 ;;GENERIC NAME
"RTN","PSSDEEA",117,0)
 ;;VA CLASSIFICATION
"RTN","PSSDEEA",118,0)
 ;;DEA, SPECIAL HDLG
"RTN","PSSDEEA",119,0)
 ;;MAXIMUM DOSE PER DAY
"RTN","PSSDEEA",120,0)
 ;;STANDARD SIG
"RTN","PSSDEEA",121,0)
 ;;FSN
"RTN","PSSDEEA",122,0)
 ;;DRUG GROUP/INTERACTION
"RTN","PSSDEEA",123,0)
 ;;WARNING LABEL
"RTN","PSSDEEA",124,0)
 ;;NON-FORMULARY
"RTN","PSSDEEA",125,0)
 ;;MESSAGE
"RTN","PSSDEEA",126,0)
SUB2 ;FIELDS FOR ^PSDRUG(ZDA,2)
"RTN","PSSDEEA",127,0)
 ;;PHARMACY ORDERABLE ITEM
"RTN","PSSDEEA",128,0)
 ;;RESTRICTION
"RTN","PSSDEEA",129,0)
 ;;APPLICATION PACKAGES' USE
"RTN","PSSDEEA",130,0)
 ;;NDC
"RTN","PSSDEEA",131,0)
 ;;
"RTN","PSSDEEA",132,0)
 ;;*PRIMARY DRUG
"RTN","PSSDEEA",133,0)
SUB3 ;FIELDS FOR ^PSDRUG(ZDA,3)
"RTN","PSSDEEA",134,0)
 ;;CMOP DISPENSE
"RTN","PSSDEEA",135,0)
SUB85 ;
"RTN","PSSDEEA",136,0)
 ;;*ATC CANISTER
"RTN","PSSDEEA",137,0)
 ;;ATC MNEMONIC
"RTN","PSSDEEA",138,0)
SUB660 ;FIELDS FOR ^PSDRUG(ZDA,660)
"RTN","PSSDEEA",139,0)
 ;;REORDER LEVEL
"RTN","PSSDEEA",140,0)
 ;;ORDER UNIT
"RTN","PSSDEEA",141,0)
 ;;PRICE PER ORDER UNIT
"RTN","PSSDEEA",142,0)
 ;;NORMAL AMOUNT TO ORDER
"RTN","PSSDEEA",143,0)
 ;;DISPENSE UNITS PER ORDER UNIT
"RTN","PSSDEEA",144,0)
 ;;PRICE PER DISPENSE UNIT
"RTN","PSSDEEA",145,0)
 ;;SOURCE OF SUPPLY
"RTN","PSSDEEA",146,0)
 ;;DISPENSE UNIT
"RTN","PSSDEEA",147,0)
SUB6601 ;FIELDS FOR ^PSDRUG(ZDA,660.1)
"RTN","PSSDEEA",148,0)
 ;;CURRENT INVENTORY
"RTN","PSSDEEA",149,0)
SUBEPH ;FIELDS FOR ^PSDRUG(ZDA,"EPH")
"RTN","PSSDEEA",150,0)
 ;;DAW CODE
"RTN","PSSDEEA",151,0)
 ;;NCPDP DISPENSE UNIT
"RTN","PSSDEEA",152,0)
 ;;NCPDP QUANTITY MULTIPLIER
"RTN","PSSDEEA",153,0)
 ;;EPHARMACY BILLABLE
"RTN","PSSDEEA",154,0)
 ;;EPHARMACY BILLABLE (TRICARE)
"RTN","PSSDEEA",155,0)
 ;;EPHARMACY BILLABLE (CHAMPVA)
"RTN","PSSDEEA",156,0)
 ;;SENSITIVE DIAGNOSIS DRUG
"RTN","PSSDEEA",157,0)
SUBI ;FIELDS FOR ^PSDRUG(ZDA,"I")
"RTN","PSSDEEA",158,0)
 ;;INACTIVE DATE
"RTN","PSSDEEA",159,0)
SUBND ;FIELDS FOR ^PSDRUG(ZDA,"ND")
"RTN","PSSDEEA",160,0)
 ;;NATIONAL DRUG FILE ENTRY
"RTN","PSSDEEA",161,0)
 ;;VA PRODUCT NAME
"RTN","PSSDEEA",162,0)
 ;;PSNDF VA PRODUCT NAME ENTRY
"RTN","PSSDEEA",163,0)
 ;;PACKAGE SIZE
"RTN","PSSDEEA",164,0)
 ;;PACKAGE TYPE
"RTN","PSSDEEA",165,0)
 ;;NATIONAL DRUG CLASS
"RTN","PSSDEEA",166,0)
 ;;
"RTN","PSSDEEA",167,0)
 ;;
"RTN","PSSDEEA",168,0)
 ;;
"RTN","PSSDEEA",169,0)
 ;;CMOP ID
"RTN","PSSDEEA",170,0)
 ;;NATIONAL FORMULARY INDICATOR
"RTN","PSSLOOK")
0^3^B137576490^B130410178
"RTN","PSSLOOK",1,0)
PSSLOOK ;BIR/WRT-Drug file lookup ; 22 May 2018  10:10 AM
"RTN","PSSLOOK",2,0)
 ;;1.0;PHARMACY DATA MANAGEMENT;**3,7,15,16,20,24,29,38,68,61,87,90,127,147,170,189,192,200,195,213,227**;9/30/97;Build 18
"RTN","PSSLOOK",3,0)
 ;
"RTN","PSSLOOK",4,0)
 ;Reference to ^PS(50.605 supported by DBIA #2138
"RTN","PSSLOOK",5,0)
 ;Reference to ^PS(50.608 supported by DBIA #2136
"RTN","PSSLOOK",6,0)
 ;Reference to ^PS(50.609 supported by DBIA #2137
"RTN","PSSLOOK",7,0)
 ;Reference to ^PS(50.607 supported by DBIA #2221
"RTN","PSSLOOK",8,0)
 ;Reference to $$FORMRX^PSNAPIS(DA,K,.LIST) supported by DBIA #2574
"RTN","PSSLOOK",9,0)
 ;Reference to $$FORMI^PSNAPIS(P1,P3) supported by DBIA #2574
"RTN","PSSLOOK",10,0)
 ;Reference to $$PSJDF^PSNAPIS(P1,P3) supported by DBIA #2531
"RTN","PSSLOOK",11,0)
 ;Reference to $$PSJST^PSNAPIS(P1,P3) supported by DBIA #2531
"RTN","PSSLOOK",12,0)
 ;Reference to $$PROD2^PSNAPIS(P1,P3) supported by DBIA #2531
"RTN","PSSLOOK",13,0)
 ;Reference to $$CPTIER^PSNAPIS(P1,P3) supported by DBIA #2531
"RTN","PSSLOOK",14,0)
 ;Reference to $$VAGN^PSNAPIS(P1) supported by DBIA #2531
"RTN","PSSLOOK",15,0)
 ;Reference to ^PSNDF(50.68 supported by DBIA 3735
"RTN","PSSLOOK",16,0)
 ;Reference to DATA^PSN50P68 supported by DBIA 4545
"RTN","PSSLOOK",17,0)
 ;Reference to FD & FDT^PSNACT supported by DBIA #6754
"RTN","PSSLOOK",18,0)
 ;
"RTN","PSSLOOK",19,0)
START S QUIT=0,PSSFG=0 D KILL F PSSXX=1:1 D PICK Q:PSSFG
"RTN","PSSLOOK",20,0)
DONE D KILL K PSSFG,PSSXX,QUIT,FM,FMS,Y2K
"RTN","PSSLOOK",21,0)
 Q
"RTN","PSSLOOK",22,0)
PICK W ! K DIC S DIC="^PSDRUG(",DIC(0)="AEQMVTN",DIC("T")="",DIC("W")="S PSSTDRUG=Y D GETTIER^PSSDEE(PSSTDRUG)" D ^DIC K DIC I Y<0 S PSSFG=1 Q
"RTN","PSSLOOK",23,0)
 S IFN=+Y D NDDATA,GETDATA,INACT,NOD66,FORMAT,KILL
"RTN","PSSLOOK",24,0)
 Q
"RTN","PSSLOOK",25,0)
NDDATA I $D(^PSDRUG(IFN,"ND")) S CLPTR=$P(^PSDRUG(IFN,"ND"),"^",6) I $P(^PSDRUG(IFN,"ND"),"^",2)]"" S NDNODE=^PSDRUG(IFN,"ND"),VAGNPTR=$P(NDNODE,"^",1),VAPN=$P(NDNODE,"^",2),SZPTR=$P(NDNODE,"^",4),TYPTR=$P(NDNODE,"^",5) D NDF,NDF1
"RTN","PSSLOOK",26,0)
 Q
"RTN","PSSLOOK",27,0)
NDF S DA=VAGNPTR,X=$$VAGN^PSNAPIS(DA),VAGN=X,PS=$P(^PS(50.609,SZPTR,0),"^",1),PT=$P(^PS(50.608,TYPTR,0),"^",1),P3=$P(NDNODE,"^",3)
"RTN","PSSLOOK",28,0)
 K X S DA=VAGNPTR,K=P3,X=$$PROD2^PSNAPIS(DA,K) I X]"",$P(X,"^")]"" S VAPRN=$P(X,"^"),VADU=$P(X,"^",4),CMOPID=$P(X,"^",2)
"RTN","PSSLOOK",29,0)
 S CSF="" I $P(NDNODE,"^",3) S CSF=$$GET1^DIQ(50.68,$P(NDNODE,"^",3),19,"I")
"RTN","PSSLOOK",30,0)
 ;
"RTN","PSSLOOK",31,0)
 S (PSSNIEN,CSF)="",PSSNIEN=$P(NDNODE,"^",3)
"RTN","PSSLOOK",32,0)
 K ^TMP($J,"PSNVAPR"),PSSHTH,PSSHTD,PSSPEPAC,PSSDOTSN
"RTN","PSSLOOK",33,0)
 I PSSNIEN'="" D DATA^PSN50P68(PSSNIEN,"","PSNVAPR")  ;using the PRE encapuslation API instead
"RTN","PSSLOOK",34,0)
 I $D(^TMP($J,"PSNVAPR",PSSNIEN)) D
"RTN","PSSLOOK",35,0)
 .S:$G(^TMP($J,"PSNVAPR",PSSNIEN,19))'="" CSF=$P(^TMP($J,"PSNVAPR",PSSNIEN,19),"^")
"RTN","PSSLOOK",36,0)
 .S:$G(^TMP($J,"PSNVAPR",PSSNIEN,5))'="" VAPRN=^TMP($J,"PSNVAPR",PSSNIEN,5)
"RTN","PSSLOOK",37,0)
 .S:$G(^TMP($J,"PSNVAPR",PSSNIEN,6))'="" CMOPID=^TMP($J,"PSNVAPR",PSSNIEN,6)
"RTN","PSSLOOK",38,0)
 .; Hazardous Waste fields
"RTN","PSSLOOK",39,0)
 .S (PSSHTH,PSSHTD,PSSPEPAC,PSSWSC,PSSDOTSN)=""
"RTN","PSSLOOK",40,0)
 .S:$G(^TMP($J,"PSNVAPR",PSSNIEN,101))'="" PSSHTH=^TMP($J,"PSNVAPR",PSSNIEN,101)
"RTN","PSSLOOK",41,0)
 .S:$G(^TMP($J,"PSNVAPR",PSSNIEN,102))'="" PSSHTD=^TMP($J,"PSNVAPR",PSSNIEN,102)
"RTN","PSSLOOK",42,0)
 .S:$G(^TMP($J,"PSNVAPR",PSSNIEN,103))'="" PSSPEPAC=^TMP($J,"PSNVAPR",PSSNIEN,103)
"RTN","PSSLOOK",43,0)
 .S:$G(^TMP($J,"PSNVAPR",PSSNIEN,104))'="" PSSWSC=^TMP($J,"PSNVAPR",PSSNIEN,104)
"RTN","PSSLOOK",44,0)
 .S HAZWCNT2=1,HAZWCNT=0,DIWL=1,DIWR=50
"RTN","PSSLOOK",45,0)
 .F  S HAZWCNT=$O(^TMP($J,"PSNVAPR",PSSNIEN,105,HAZWCNT)) Q:'HAZWCNT  D
"RTN","PSSLOOK",46,0)
 .. S X="",X=^TMP($J,"PSNVAPR",PSSNIEN,105,HAZWCNT) S PSSDOTSN(HAZWCNT)=X
"RTN","PSSLOOK",47,0)
 Q
"RTN","PSSLOOK",48,0)
IT S CMOPID=$P(X,"^",2)
"RTN","PSSLOOK",49,0)
 Q
"RTN","PSSLOOK",50,0)
NDF1 S X=$$PSJDF^PSNAPIS(DA,K),VADF=$P(X,"^",2)
"RTN","PSSLOOK",51,0)
 Q
"RTN","PSSLOOK",52,0)
INACT S ACT="" I $D(^PSDRUG(IFN,"I")) S Y=$P(^PSDRUG(IFN,"I"),"^",1) X ^DD("DD") S ACT=Y
"RTN","PSSLOOK",53,0)
 Q
"RTN","PSSLOOK",54,0)
GETDATA S NODE0=^PSDRUG(IFN,0),GN=$P(NODE0,"^",1),CL=$P(NODE0,"^",2),DEA=$P(NODE0,"^",3),WRN=$P(NODE0,"^",8),NF=$P(NODE0,"^",9),MESS=$P(NODE0,"^",10),VNF=$P(NODE0,"^",11),CLASS="",WARN="" S:NF=1 NF="N/F" S:VNF=1 VNF="V-N/F"
"RTN","PSSLOOK",55,0)
 S PSSNODE=$G(^PSDRUG(IFN,"DOS"))
"RTN","PSSLOOK",56,0)
 I CL]"" S CLASS=CL_"  "_$P(^PS(50.605,CLPTR,0),"^",2)
"RTN","PSSLOOK",57,0)
 S PSSX=$Q(^PSDRUG(IFN,950)),PSSMAX=$P(@PSSX,"^",3)
"RTN","PSSLOOK",58,0)
 D GETS^DIQ(50.095,PSSMAX_","_IFN_",","*","E","PSSDAT","PSSERR")
"RTN","PSSLOOK",59,0)
 S PSSDT=$G(PSSDAT(50.095,PSSMAX_","_IFN_",",.01,"E"))
"RTN","PSSLOOK",60,0)
 S PSSUSR=$G(PSSDAT(50.095,PSSMAX_","_IFN_",",1,"E"))
"RTN","PSSLOOK",61,0)
 S PSSVAL=$G(PSSDAT(50.095,PSSMAX_","_IFN_",",3,"E"))
"RTN","PSSLOOK",62,0)
 I $D(^PSDRUG(IFN,3)) S:$P(^PSDRUG(IFN,3),"^")=0 CMOP="NO" S:$P(^PSDRUG(IFN,3),"^")=1 CMOP="YES"
"RTN","PSSLOOK",63,0)
 I $D(^PSDRUG(IFN,5)) S QDM=^PSDRUG(IFN,5)
"RTN","PSSLOOK",64,0)
 S OINM="" S NDC="" I $D(^PSDRUG(IFN,2)) S NODE2=^PSDRUG(IFN,2) S:$P(NODE2,"^",1)]"" OIPTR=$P(NODE2,"^",1) S NDC=$P(NODE2,"^",4) S:$P(NODE2,"^",6)]"" PDPTR=$P(NODE2,"^",6) S APP=$P(NODE2,"^",3),FM="" D TWOA
"RTN","PSSLOOK",65,0)
 Q
"RTN","PSSLOOK",66,0)
TWOA I $D(OIPTR) S OI=$P(^PS(50.7,OIPTR,0),"^",1),DFPTR=$P(^PS(50.7,OIPTR,0),"^",2),DF=$P(^PS(50.606,DFPTR,0),"^",1),FMS=$P(^PS(50.7,OIPTR,0),"^",12) S:FMS]"" FM=" (N/F)" S OINM=OI_" "_DF_FM
"RTN","PSSLOOK",67,0)
 ;I $D(PDPTR) S PD=$P(^PS(50.3,PDPTR,0),"^",1)
"RTN","PSSLOOK",68,0)
 Q
"RTN","PSSLOOK",69,0)
NOD66 S (DUPOU,PPDU,PPOU,DU,SS)="" I $D(^PSDRUG(IFN,660)) S NDE=^PSDRUG(IFN,660),OUPTR=$P(NDE,"^",2),PPOU=$P(NDE,"^",3),DUPOU=$P(NDE,"^",5),PPDU=$P(NDE,"^",6),SS=$P(NDE,"^",7),DU=$P(NDE,"^",8) I OUPTR]"" S OU=$P(^DIC(51.5,OUPTR,0),"^")
"RTN","PSSLOOK",70,0)
 Q
"RTN","PSSLOOK",71,0)
SYN I $D(^PSDRUG(IFN,1,0)) F ZZZ=0:0 S ZZZ=$O(^PSDRUG(IFN,1,ZZZ)) Q:'ZZZ  S SYNM=$P(^PSDRUG(IFN,1,ZZZ,0),"^",1),INT=$P(^PSDRUG(IFN,1,ZZZ,0),"^",3) D SYN1
"RTN","PSSLOOK",72,0)
 Q
"RTN","PSSLOOK",73,0)
SYN1 S INT=$S(INT=0:"Trade Name",INT=1:"Quick Code",INT="C":"Ctrl Substances",INT="D":"Drug Accountability",1:"") D FULL Q:$G(QUIT)  W ?14,SYNM,?55,INT,!
"RTN","PSSLOOK",74,0)
 Q
"RTN","PSSLOOK",75,0)
SYN2 S:INT=0 INT="Trade" S:INT=1 INT="Quick" S:INT="C" INT="Ctrl Subs" S:INT="D" INT="Drug Acct" W ?16,SYNM,?57,INT,!
"RTN","PSSLOOK",76,0)
 Q
"RTN","PSSLOOK",77,0)
IFCAP I $D(^PSDRUG(IFN,441,0)) F QQQ=0:0 S QQQ=$O(^PSDRUG(IFN,441,QQQ)) Q:'QQQ  S IFCAPNM=$P(^PSDRUG(IFN,441,QQQ,0),"^",1)
"RTN","PSSLOOK",78,0)
 Q
"RTN","PSSLOOK",79,0)
FORMAT ; BEGIN WRITING
"RTN","PSSLOOK",80,0)
 N DAW
"RTN","PSSLOOK",81,0)
 W @IOF,"DRUG NAME: ",GN,"  (IEN: ",IFN,")",!
"RTN","PSSLOOK",82,0)
 F XX=1:1:77 W "="
"RTN","PSSLOOK",83,0)
 W !
"RTN","PSSLOOK",84,0)
 W:$D(VAPRN) "VA PRINT NAME: ",?17,VAPRN W:$D(CMOPID) ?60,"CMOP ID#: ",CMOPID W:$D(VAPN) !,"VA PRODUCT NAME: ",?17,VAPN W:$D(CMOP) ?60,"CMOP DISPENSE: ",CMOP
"RTN","PSSLOOK",85,0)
 W:$D(OINM) !,"ORDERABLE ITEM: ",?17,OINM W:$D(VAPN) ?60,"NDF DF: ",VADF
"RTN","PSSLOOK",86,0)
 I $D(OIPTR),OIPTR]"" W !,"ORDERABLE ITEM TEXT: ",! D OITXT
"RTN","PSSLOOK",87,0)
 W:$D(PD) !,"PRIMARY DRUG: ",?17,PD
"RTN","PSSLOOK",88,0)
 W !,"SYNONYM(S): " D SYN D FULL Q:$G(QUIT)  W !,"MESSAGE: ",MESS,!
"RTN","PSSLOOK",89,0)
 D FULL Q:$G(QUIT)  F XX=1:1:77 W "-"
"RTN","PSSLOOK",90,0)
 W !
"RTN","PSSLOOK",91,0)
 D FULL Q:$G(QUIT)  W "DEA, SPECIAL HDLG: ",DEA,?48,"NDC: ",?63,NDC
"RTN","PSSLOOK",92,0)
 S DAW=+$$GET1^DIQ(50,IFN,81)
"RTN","PSSLOOK",93,0)
 D FULL Q:$G(QUIT)  W !,"DAW CODE:  ",DAW," - ",$$DAWEXT^PSSDAWUT(DAW)
"RTN","PSSLOOK",94,0)
 D FULL Q:$G(QUIT)  W !,"CS FEDERAL SCHEDULE: ",$G(CSF)
"RTN","PSSLOOK",95,0)
 ;
"RTN","PSSLOOK",96,0)
 ;Hazardous Waste
"RTN","PSSLOOK",97,0)
 W !
"RTN","PSSLOOK",98,0)
 S PSSHTDX=0
"RTN","PSSLOOK",99,0)
 I $G(PSSHTD)=1 S PSSHTDX=1
"RTN","PSSLOOK",100,0)
 D FULL Q:$G(QUIT)  W:$G(PSSHTH)'="" !,"Hazardous to Handle: ",$S(PSSHTH=1:"YES",PSSHTH=0:"NO",1:"")
"RTN","PSSLOOK",101,0)
 D FULL Q:$G(QUIT)  W:$G(PSSHTD)'="" !,"Hazardous to Dispose: ",$S(PSSHTD=1:"YES",PSSHTD=0:"NO",1:"")
"RTN","PSSLOOK",102,0)
 I $G(PSSPEPAC)'=""&(PSSHTDX) D FULL Q:$G(QUIT)  W !,"        Primary EPA Code: ",PSSPEPAC
"RTN","PSSLOOK",103,0)
 I $G(PSSWSC)'=""&(PSSHTDX) D FULL Q:$G(QUIT)  W !,"         Waste Sort Code: ",PSSWSC
"RTN","PSSLOOK",104,0)
 ;
"RTN","PSSLOOK",105,0)
 N HAZWCNT,HAZWCNT2,X,DIWL,DIWR,DIWF
"RTN","PSSLOOK",106,0)
 K ^UTILITY($J,"W")
"RTN","PSSLOOK",107,0)
 S HAZWCNT=0,HAZWCNT2=1,HAZWCNT=0,DIWL=1,DIWR=50
"RTN","PSSLOOK",108,0)
 F  S HAZWCNT=$O(PSSDOTSN(HAZWCNT)) Q:HAZWCNT=""  S X=PSSDOTSN(HAZWCNT) D ^DIWP
"RTN","PSSLOOK",109,0)
 S HAZWCNT=0 F  S HAZWCNT=$O(^UTILITY($J,"W",DIWL,HAZWCNT)) Q:'HAZWCNT  D
"RTN","PSSLOOK",110,0)
 .D FULL Q:$G(QUIT)
"RTN","PSSLOOK",111,0)
 .I HAZWCNT2=1 W !,"       DOT Shipping Name: "
"RTN","PSSLOOK",112,0)
 .I HAZWCNT2>1 W !,"                          "
"RTN","PSSLOOK",113,0)
 .W $G(^UTILITY($J,"W",DIWL,HAZWCNT,0)) S HAZWCNT2=2
"RTN","PSSLOOK",114,0)
 K ^UTILITY($J,"W")
"RTN","PSSLOOK",115,0)
 ;I $G(PSSDOTSN)'=""&(PSSHTDX) D FULL Q:$G(QUIT)  W !,"       DOT Shipping Name: ",PSSDOTSN
"RTN","PSSLOOK",116,0)
 W !
"RTN","PSSLOOK",117,0)
 ;
"RTN","PSSLOOK",118,0)
 D FULL Q:$G(QUIT)  W !,"INACTIVE DATE: ",ACT
"RTN","PSSLOOK",119,0)
 D FULL Q:$G(QUIT)  W:$D(QDM) !,"QUANTITY DISPENSE MESSAGE: ",QDM,!
"RTN","PSSLOOK",120,0)
 D FULL Q:$G(QUIT)  I WRN]"" W !,"WARNING LABEL: " S X=WRN F Z0=1:1 Q:$P(X,",",Z0,99)=""  S Z1=$P(X,",",Z0) W:$D(^PS(54,Z1,0)) ?19,$P(^(0),"^",1),! I '$D(^(0)) W ?19,"NO SUCH WARNING LABEL" K X Q
"RTN","PSSLOOK",121,0)
 D FULL Q:$G(QUIT)  S PSSLOOK=1 D
"RTN","PSSLOOK",122,0)
 .N DRUG,PSSWSITE
"RTN","PSSLOOK",123,0)
 .I $P($G(^PSDRUG(IFN,0)),"^")="" K PSSLOOK Q
"RTN","PSSLOOK",124,0)
 .S PSSWSITE=+$O(^PS(59.7,0)) W !,"WARNING LABEL SOURCE is " D
"RTN","PSSLOOK",125,0)
 ..I $P($G(^PS(59.7,PSSWSITE,10)),"^",9)="N" W "set to 'NEW'" Q
"RTN","PSSLOOK",126,0)
 ..W "not set to 'NEW'"
"RTN","PSSLOOK",127,0)
 .K PSSWRN
"RTN","PSSLOOK",128,0)
 .D FULL Q:$G(QUIT)  W !,"NEW WARNING LABEL:"
"RTN","PSSLOOK",129,0)
 .S ^TMP("PSSWRNB",$J,$P(^PSDRUG(IFN,0),"^"))="" D ^PSSWRNE
"RTN","PSSLOOK",130,0)
 .K PSSLOOK,^TMP("PSSWRNB",$J),PSSWRN
"RTN","PSSLOOK",131,0)
 D FULL Q:$G(QUIT)  W:'$D(QDM) ! F XX=1:1:77 W "-"
"RTN","PSSLOOK",132,0)
 D FULL Q:$G(QUIT)  W !
"RTN","PSSLOOK",133,0)
 W "ORDER UNIT: ",?27 W:$D(OU) OU W ?40,"PRICE/ORDER UNIT: ",?67,PPOU
"RTN","PSSLOOK",134,0)
 D FULL Q:$G(QUIT)  W !,"DISPENSE UNIT: ",?27,DU W:$D(VADU) ?40,"VA DISPENSE UNIT: ",?67,VADU
"RTN","PSSLOOK",135,0)
 D FULL Q:$G(QUIT)  W !,"DISPENSE UNITS/ORDER UNIT: ",?21,DUPOU,?40,"PRICE/DISPENSE UNIT: ",?67,PPDU
"RTN","PSSLOOK",136,0)
 D:$G(PSSVAL)]""
"RTN","PSSLOOK",137,0)
 . D FULL Q:$G(QUIT)  W !,"DATE PRICE/DISPENSE UNIT LAST CHANGED:  ",?27,PSSDT
"RTN","PSSLOOK",138,0)
 . D FULL Q:$G(QUIT)  W !,"BY:  ",PSSUSR,?27,"VALUE:  ",PSSVAL
"RTN","PSSLOOK",139,0)
 D FULL Q:$G(QUIT)  W !,"NCPDP DISPENSE UNIT: ",$$GET1^DIQ(50,IFN,82),?40,"NCPDP QUANTITY MULTIPLIER: ",?67,$J($$GET1^DIQ(50,IFN,83),8,3)
"RTN","PSSLOOK",140,0)
 D FULL Q:$G(QUIT)  W !,"MAXIMUM DAYS SUPPLY: ",$$GET1^DIQ(50,IFN,66)
"RTN","PSSLOOK",141,0)
 D FULL Q:$G(QUIT)  W !,"ePharmacy Billable: ",$$GET1^DIQ(50,IFN,84)
"RTN","PSSLOOK",142,0)
 D FULL Q:$G(QUIT)  W !?2,"ePharmacy Billable (TRICARE): ",$$GET1^DIQ(50,IFN,85) W ?40,"ePharmacy Billable (CHAMPVA): ",$$GET1^DIQ(50,IFN,86)
"RTN","PSSLOOK",143,0)
 D FULL Q:$G(QUIT)  W !,"Sensitive Diagnosis Drug: ",$$GET1^DIQ(50,IFN,87) W !
"RTN","PSSLOOK",144,0)
 D FULL Q:$G(QUIT)  W !,"APPL PKG USE:" S APPL="" S:'$D(APP) APPL="  NONE"
"RTN","PSSLOOK",145,0)
 I $D(APP) D
"RTN","PSSLOOK",146,0)
 . S:APP["O" APPL=APPL_"  Outpatient" S:APP["U" APPL=APPL_"  Unit Dose"
"RTN","PSSLOOK",147,0)
 . S:APP["I" APPL=APPL_"  IV" S:APP["W" APPL=APPL_"  Ward Stock"
"RTN","PSSLOOK",148,0)
 . S:APP["N" APPL=APPL_"  Control Subs" S:APP["X" APPL=APPL_"  Non-VA Med"
"RTN","PSSLOOK",149,0)
 . S:APPL="" APPL="  NONE"
"RTN","PSSLOOK",150,0)
 W ?13,APPL
"RTN","PSSLOOK",151,0)
 I $P(PSSNODE,"^",2) S (PSSCALC,PSSUNIT)=$P($G(^PS(50.607,+$P(PSSNODE,U,2),0)),U),PSSSTR=$P(PSSNODE,"^")
"RTN","PSSLOOK",152,0)
 I $G(PSSUNIT)'="",$G(PSSUNIT)["/" D UNCALC
"RTN","PSSLOOK",153,0)
 D FULL Q:$G(QUIT)  W !,"STRENGTH: ",$S($E($P(PSSNODE,U),1)=".":"0",1:"")_$P(PSSNODE,U),?35,"UNIT: ",$G(PSSCALC)
"RTN","PSSLOOK",154,0)
 D FULL Q:$G(QUIT)  W !,"POSSIBLE DOSAGES:"
"RTN","PSSLOOK",155,0)
 I $D(^PSDRUG(IFN,"DOS1",0)) F PDS=0:0 S PDS=$O(^PSDRUG(IFN,"DOS1",PDS)) Q:'PDS  D
"RTN","PSSLOOK",156,0)
 .S POSDOS=^PSDRUG(IFN,"DOS1",PDS,0)
"RTN","PSSLOOK",157,0)
 .D FULL Q:$G(QUIT)  W !,"   DISPENSE UNITS PER DOSE: ",$S($E($P(POSDOS,U),1)=".":"0",1:"")_$P(POSDOS,U),?40,"DOSE: ",$S($E($P(POSDOS,U,2),1)=".":"0",1:"")_$P(POSDOS,U,2),?55,"PACKAGE: ",$P(POSDOS,U,3)
"RTN","PSSLOOK",158,0)
 .D FULL Q:$G(QUIT)  W !,"       BCMA UNITS PER DOSE: ",$P(POSDOS,U,4)
"RTN","PSSLOOK",159,0)
 D FULL Q:$G(QUIT)  W !,"LOCAL POSSIBLE DOSAGES:"
"RTN","PSSLOOK",160,0)
 I $D(^PSDRUG(IFN,"DOS2",0)) F PDS=0:0 S PDS=$O(^PSDRUG(IFN,"DOS2",PDS)) Q:'PDS  D
"RTN","PSSLOOK",161,0)
 .S LPDOS=^PSDRUG(IFN,"DOS2",PDS,0)
"RTN","PSSLOOK",162,0)
 .D FULL Q:$G(QUIT)  W !,"   LOCAL POSSIBLE DOSAGE: " D
"RTN","PSSLOOK",163,0)
 ..I $L($P(LPDOS,U))'>27 W $P(LPDOS,U),?55,"PACKAGE: ",$P(LPDOS,U,2)
"RTN","PSSLOOK",164,0)
 ..E   W !,?10,$P(LPDOS,U),!,?55,"PACKAGE: ",$P(LPDOS,U,2)
"RTN","PSSLOOK",165,0)
 ..D FULL Q:$G(QUIT)  W !,"     BCMA UNITS PER DOSE: ",$P(LPDOS,U,3) D FULL Q:$G(QUIT)  D LPDNW
"RTN","PSSLOOK",166,0)
 D FULL Q:$G(QUIT)  W ! F XX=1:1:77 W "-"
"RTN","PSSLOOK",167,0)
 D FULL Q:$G(QUIT)  W !,"VA CLASS: ",$G(CLASS)
"RTN","PSSLOOK",168,0)
 D FULL Q:$G(QUIT)  W !,"LOCAL NON-FORMULARY: ",$G(NF),"          ","VISN NON-FORMULARY: ",$G(VNF)
"RTN","PSSLOOK",169,0)
 N DA,K,LIST,PSXDN,PSXGN,X,XX1,XX2
"RTN","PSSLOOK",170,0)
 K PSXGN,PSXVP I $D(^PSDRUG(IFN,"ND")) S PSXDN=$G(^PSDRUG(IFN,"ND")),PSXGN=$P(PSXDN,"^"),PSXVP=$P(PSXDN,"^",3)
"RTN","PSSLOOK",171,0)
 I $G(PSXGN),$G(PSXVP) S X=$$PROD2^PSNAPIS(PSXGN,PSXVP),XX1=$$FORMI^PSNAPIS(PSXGN,PSXVP)
"RTN","PSSLOOK",172,0)
 D FULL Q:$G(QUIT)  W !,"National Formulary Indicator: "_$S($G(XX1)=1:"YES",$G(XX1)=0:"NO",1:"Not Matched to NDF")
"RTN","PSSLOOK",173,0)
 I $G(PSXVP) D FD^PSNACT(PSXVP) ;PPSN
"RTN","PSSLOOK",174,0)
 I $D(^PSDRUG(IFN,65,0)) D FULL Q:$G(QUIT)  W !,"FORMULARY ALTERNATIVES: ",! F FA=0:0 S FA=$O(^PSDRUG(IFN,65,FA)) Q:'FA  S LDFPTR=$P($G(^PSDRUG(IFN,65,FA,0)),"^") I LDFPTR D FULL Q:$G(QUIT)  W ?26,$P($G(^PSDRUG(LDFPTR,0)),"^"),!
"RTN","PSSLOOK",175,0)
 N CPDATE,PSSTIER D NOW^%DTC S CPDATE=$P(%,".") S PSSTIER=$$CPTIER^PSNAPIS($P($G(^PSDRUG(IFN,"ND")),"^",3),CPDATE,IFN,1) K CPDATE,%
"RTN","PSSLOOK",176,0)
 ;  PSSTIER = Copay Tier^Effective Date^End Date
"RTN","PSSLOOK",177,0)
 W !,"Copay Tier: ",$P(PSSTIER,"^",1)
"RTN","PSSLOOK",178,0)
 W !,"Copay Effective Date: " S Y=$P(PSSTIER,"^",2) D DD^%DT W Y K Y
"RTN","PSSLOOK",179,0)
 D FULL Q:$G(QUIT)  I $G(PSXGN),$G(PSXVP) W !,"National Restriction: " S XX2=$$FORMRX^PSNAPIS(PSXGN,PSXVP,.LIST) I $G(XX2)=1,$D(LIST) F XX2=0:0 S XX2=$O(LIST(XX2)) Q:'XX2  D FULL Q:$G(QUIT)  W !,LIST(XX2,0)
"RTN","PSSLOOK",180,0)
 I $G(PSXVP) D FDT^PSNACT(PSXVP) ;PPSN
"RTN","PSSLOOK",181,0)
 W !,"Local Drug Text: ",! I $D(^PSDRUG(IFN,9,0)) D LDT
"RTN","PSSLOOK",182,0)
 Q
"RTN","PSSLOOK",183,0)
LDT F TXT1=0:0 S TXT1=$O(^PSDRUG(IFN,9,TXT1)) Q:'TXT1  S TEXPTR=^PSDRUG(IFN,9,TXT1,0) F PPP=0:0 S PPP=$O(^PS(51.7,TEXPTR,2,PPP)) Q:'PPP  S PST=$P($G(^PS(51.7,TEXPTR,0)),"^",2) I 'PST S WPT=^PS(51.7,TEXPTR,2,PPP,0) D FULL Q:$G(QUIT)  W WPT,!
"RTN","PSSLOOK",184,0)
 ;
"RTN","PSSLOOK",185,0)
 ;
"RTN","PSSLOOK",186,0)
KILL K IFN,APP,INT,VADU,VAGN,VAPN,VAPRN,P3,VAGNPTR,MESS,CLASS,DEA,ACT,CL,CLPTR,CMOP,DF,DFPTR,DU,DUPOUGN,IFCAPNM,NDC,NDE,NDNODE,NF,NODE0,NODE2,OI,OINM,OIPTR,OU,PD,PDPTR,PPDU,PPOU,PS,PT,NOD66,SYNM,SZPTR,TYPTR,WARN,WRN,XX,ZZZ,SS,OUPTR,CMOPID
"RTN","PSSLOOK",187,0)
 K DUPOU,QQQ,GN,QDM,APPL,VADF,DFP,DFRM,Y,Z0,Z1,DDD,PPP,TEXT,TXTPTR,TXT,TXT1,TEXPTR,VNF,WPT,FA,LDFPTR,TEXTPTR,QUIT,PST,D0,DA,K,DIR
"RTN","PSSLOOK",188,0)
 K PSSNODE,PSDOSUN,PDS,POSDOS,LPDOS,CSF,PSSSTR,PSSUNIT,PSSCALC,PSSTIER
"RTN","PSSLOOK",189,0)
 K ^TMP($J,"PSNVAPR")
"RTN","PSSLOOK",190,0)
 K PSSWSC,PSSNIEN,PSSHTH,PSSHTD,PSSPEPAC,PSSDOTSN,PSSCLEF,PSSPKG,PSSOMIT,PSSEXLMT,PSSHTDX,PSSII,PSSIII
"RTN","PSSLOOK",191,0)
 Q
"RTN","PSSLOOK",192,0)
OITXT I $D(^PS(50.7,OIPTR,1,0)) F TXT=0:0 S TXT=$O(^PS(50.7,OIPTR,1,TXT)) Q:'TXT  S TEXTPTR=^PS(50.7,OIPTR,1,TXT,0) F DDD=0:0 S DDD=$O(^PS(51.7,TEXTPTR,2,DDD)) Q:'DDD  D IDATE I 'Y2K S TEXT=^PS(51.7,TEXTPTR,2,DDD,0) D FULL Q:$G(QUIT)  W TEXT,!
"RTN","PSSLOOK",193,0)
 Q
"RTN","PSSLOOK",194,0)
FULL D:($Y+5)>IOSL&('$G(QUIT)) FSCRN
"RTN","PSSLOOK",195,0)
 Q
"RTN","PSSLOOK",196,0)
FSCRN Q:$G(QUIT)  W ! K DIR S DIR(0)="E",DIR("A")="Press Return to continue,'^' to exit" D ^DIR W @IOF S:Y'=1 QUIT=1
"RTN","PSSLOOK",197,0)
 Q
"RTN","PSSLOOK",198,0)
IDATE S Y2K=$P($G(^PS(51.7,TEXTPTR,0)),"^",2)
"RTN","PSSLOOK",199,0)
 Q
"RTN","PSSLOOK",200,0)
UNCALC ;
"RTN","PSSLOOK",201,0)
 N PSSVA,PSSVA1,PSSVB,PSSVB1,PSSDASH,PSSNDFS,PSSDASH2,PSSDASH3,PSSDASH5 K PSSCALC
"RTN","PSSLOOK",202,0)
 S PSSDASH=0 S PSSNDFS=$$PSJST^PSNAPIS(+$P($G(^PSDRUG(IFN,"ND")),"^"),+$P($G(^PSDRUG(IFN,"ND")),"^",3)) S PSSNDFS=+$P($G(PSSNDFS),"^",2)
"RTN","PSSLOOK",203,0)
 I $G(PSSNDFS),$G(PSSSTR),+$G(PSSSTR)'=+$G(PSSNDFS) S PSSDASH=1
"RTN","PSSLOOK",204,0)
 S PSSVA=$P(PSSUNIT,"/"),PSSVB=$P(PSSUNIT,"/",2),PSSVA1=+$G(PSSVA),PSSVB1=+$G(PSSVB)
"RTN","PSSLOOK",205,0)
 I $G(PSSDASH) S PSSDASH2=PSSSTR/PSSNDFS,PSSDASH3=PSSDASH2*$S($G(PSSVB1):PSSVB1,1:1) S PSSDASH5=$S('$G(PSSVB1):PSSDASH3_$G(PSSVB),1:PSSDASH3_$P(PSSVB,PSSVB1,2))
"RTN","PSSLOOK",206,0)
 S PSSCALC=$S($G(PSSDASH):$S('$G(PSSVA1):PSSVA,1:$P(PSSVA1,PSSVA1,2))_"/"_$G(PSSDASH5),1:PSSUNIT)
"RTN","PSSLOOK",207,0)
 Q
"RTN","PSSLOOK",208,0)
 ;
"RTN","PSSLOOK",209,0)
LPDNW ;Display Dose Unit and Numeric Dose fields, added with patch PSS*1*147
"RTN","PSSLOOK",210,0)
 N PSSLKL1,PSSLKL2,PSSLKL3,PSSLKL4
"RTN","PSSLOOK",211,0)
 S PSSLKL4=""
"RTN","PSSLOOK",212,0)
 S PSSLKL1=$P(LPDOS,"^",5),PSSLKL2=$P(LPDOS,"^",6)
"RTN","PSSLOOK",213,0)
 I PSSLKL1 S PSSLKL4=$P($G(^PS(51.24,+PSSLKL1,0)),"^")
"RTN","PSSLOOK",214,0)
 S PSSLKL3=$S($E(PSSLKL2)=".":"0",1:"")_PSSLKL2
"RTN","PSSLOOK",215,0)
 I $L(PSSLKL3)<18 D FULL Q:$G(QUIT)  W !?5,"NUMERIC DOSE: "_PSSLKL3,?38,"DOSE UNIT: "_PSSLKL4 Q
"RTN","PSSLOOK",216,0)
 D FULL Q:$G(QUIT)  W !?5,"NUMERIC DOSE: "_PSSLKL3
"RTN","PSSLOOK",217,0)
 D FULL Q:$G(QUIT)  W !?38,"DOSE UNIT: "_PSSLKL4
"RTN","PSSLOOK",218,0)
 Q
"RTN","PSSP227")
0^5^B5754647^n/a
"RTN","PSSP227",1,0)
PSSP227 ;EPIP/WLC - POST-INSTALLATION FOR PACKAGE ; 18 May 2018  10:57 AM
"RTN","PSSP227",2,0)
 ;;1.0;PHARMACY DATA MANAGEMENT;**227**;12/08/17;Build 18
"RTN","PSSP227",3,0)
 ;CHECKS FOR EXISTENSE OF MAIL AND CREATES IT IF NOT PRESENT
"RTN","PSSP227",4,0)
 ;
"RTN","PSSP227",5,0)
EN ;
"RTN","PSSP227",6,0)
 N PSSMGPNM,PSSMGPOR,PSSMGPDS,PSSMGPRS,PSSMGPMY,PSSMGPNM,PSSMGPSL,PSSMGPQT,PSSMGPTP
"RTN","PSSP227",7,0)
 N DTOUT,DUOUT,Y
"RTN","PSSP227",8,0)
 K XPDABORT,PSSMGPAR
"RTN","PSSP227",9,0)
 ;If mail group already exists quit.
"RTN","PSSP227",10,0)
 I $$FIND1^DIC(3.8,"","X","PSS DEE AUDIT","B") Q
"RTN","PSSP227",11,0)
 S PSSMGPAR(1)="A 'PSS DEE AUDIT' Mail Group is now being created. Mail Group members will"
"RTN","PSSP227",12,0)
 S PSSMGPAR(2)="receive notifications whenever there are modifications performed"
"RTN","PSSP227",13,0)
 S PSSMGPAR(3)="on the DRUG (#50) file through PSS DRUG ENTER/EDIT option."
"RTN","PSSP227",14,0)
 S PSSMGPAR(4)="Please enter the Pharmacy ADPAC or a designee to be the Mail Group Organizer."
"RTN","PSSP227",15,0)
 S PSSMGPAR(5)=" "
"RTN","PSSP227",16,0)
 S PSSMGPAR(6)="To continue this install, you must now enter a Mail Group organizer."
"RTN","PSSP227",17,0)
 S PSSMGPAR(7)=" "
"RTN","PSSP227",18,0)
 D MES^XPDUTL(.PSSMGPAR)
"RTN","PSSP227",19,0)
 K DIC S DIC=200,DIC(0)="QEAMZ",DIC("A")="Enter Mail Group Organizer: "
"RTN","PSSP227",20,0)
 ;abort install if user does not enter a coordinator
"RTN","PSSP227",21,0)
 D ^DIC K DIC I $D(DTOUT)!($D(DUOUT))!(+Y'>0) K PSSMGPAR S XPDABORT=2 Q
"RTN","PSSP227",22,0)
 S PSSMGPOR=+Y,PSSMGPMY(+Y)=""
"RTN","PSSP227",23,0)
 S PSSMGPNM="PSS DEE AUDIT",PSSMGPTP=0,PSSMGPSL=0,PSSMGPQT=1
"RTN","PSSP227",24,0)
 S PSSMGPDS(1)="Members of this mail group will receive notifications whenever there"
"RTN","PSSP227",25,0)
 S PSSMGPDS(2)="are modifications made to the DRUG (#50) file "
"RTN","PSSP227",26,0)
 S PSSMGPDS(3)="through the PSS DRUG ENTER/EDIT menu option."
"RTN","PSSP227",27,0)
 S PSSMGPRS=$$MG^XMBGRP(PSSMGPNM,PSSMGPTP,PSSMGPOR,PSSMGPSL,.PSSMGPMY,.PSSMGPDS,PSSMGPQT)
"RTN","PSSP227",28,0)
 I 'PSSMGPRS D BMES^XPDUTL(" ") D  Q
"RTN","PSSP227",29,0)
 .D BMES^XPDUTL("Unable to create PSS DEE AUDIT Mail Group, aborting install.") S XPDABORT=2
"RTN","PSSP227",30,0)
 .K PSSMGPAR
"RTN","PSSP227",31,0)
 ;Last line above also aborts install if the call to MG^XMBGRP fails to create the Mail Group
"RTN","PSSP227",32,0)
 K PSSMGPAR
"RTN","PSSP227",33,0)
 Q
"RTN","PSSPRICE")
0^4^B5169572^B5179495
"RTN","PSSPRICE",1,0)
PSSPRICE ;EPIP/WC - PHARMACY PRICE TRACKER FILE 50;03-06-2017  ; 22 May 2018  10:11 AM
"RTN","PSSPRICE",2,0)
 ;;1.0;PHARMACY DATA MANAGEMENT;**227**;2/28/17;Build 18
"RTN","PSSPRICE",3,0)
 Q  ; call by line tag
"RTN","PSSPRICE",4,0)
 ; UDPATE^DIE supported by ICR #2053
"RTN","PSSPRICE",5,0)
 ; ^XMD supported by ICR #10113
"RTN","PSSPRICE",6,0)
ST(PSSIEN,PSSDUZ) ;
"RTN","PSSPRICE",7,0)
 ;  PSSIEN=DRUG IEN
"RTN","PSSPRICE",8,0)
 ;  PSSNEW=NEW PRICE
"RTN","PSSPRICE",9,0)
 ;  PSSDUZ=USER CHANGING PRICE
"RTN","PSSPRICE",10,0)
 ; CLASS 3 CROSS REFER ON FILE 50 FIELD #16 
"RTN","PSSPRICE",11,0)
 N DA,DIE,X,Y,DIC
"RTN","PSSPRICE",12,0)
 ;LEAST GET THE TIME THE CHANGE WAS MADE
"RTN","PSSPRICE",13,0)
 D NOW^%DTC S PSSTIME=%
"RTN","PSSPRICE",14,0)
 S PSSNEW=$P($G(^PSDRUG(PSSIEN,660)),"^",6)
"RTN","PSSPRICE",15,0)
 ;
"RTN","PSSPRICE",16,0)
QUE ;ENTER THE DATA IN FILE 50 MULTIPLE FIELD 950 
"RTN","PSSPRICE",17,0)
 S ZTRTN="HIS^PSSPRICE"
"RTN","PSSPRICE",18,0)
 S ZTDESC="PHARMACY PRICE TRACKER "
"RTN","PSSPRICE",19,0)
 S ZTSAVE("PSSIEN")=""
"RTN","PSSPRICE",20,0)
 S ZTSAVE("PSSNEW")=""
"RTN","PSSPRICE",21,0)
 S ZTSAVE("PSSDUZ")=""
"RTN","PSSPRICE",22,0)
 S ZTSAVE("PSSTIME")=""
"RTN","PSSPRICE",23,0)
 S ZTIO=""
"RTN","PSSPRICE",24,0)
 D NOW^%DTC S ZTDTH=%
"RTN","PSSPRICE",25,0)
 D ^%ZTLOAD
"RTN","PSSPRICE",26,0)
 D HOME^%ZIS
"RTN","PSSPRICE",27,0)
 Q
"RTN","PSSPRICE",28,0)
HIS ;LOGS CHANGES IN FILE 50 HISTORY PRICE DISPENSE #950
"RTN","PSSPRICE",29,0)
 ; first delete any price updates prior to the retention limit set up in the paramater PSS DRUG AUDIT RETENTION MOS 
"RTN","PSSPRICE",30,0)
 N DEFDT,PSIEN2 S DEFDT=+$$GET^XPAR("ALL","PSS DRUG AUDIT RETENTION MOS")
"RTN","PSSPRICE",31,0)
 S DEFMOS=$S(DEFDT>0:DEFDT,1:999999999)
"RTN","PSSPRICE",32,0)
 S X1=$$NOW^XLFDT,X2=DEFMOS*30 D C^%DTC S ENDDT=X
"RTN","PSSPRICE",33,0)
 S X1=$P($$NOW^XLFDT,".",1)
"RTN","PSSPRICE",34,0)
 S ENDDT=$$FMADD^XLFDT(DT,"-"_(DEFMOS*30))
"RTN","PSSPRICE",35,0)
 I $O(^PSDRUG(PSSIEN,950,0)) D
"RTN","PSSPRICE",36,0)
 . F  S PSIEN2=$O(^PSDRUG(PSSIEN,950,0)) Q:^(PSIEN2,0)>ENDDT  D
"RTN","PSSPRICE",37,0)
 . . N DIK,DA
"RTN","PSSPRICE",38,0)
 . . S DIK="^PSDRUG(PSSIEN,950,",DA(1)=PSSIEN,DA=PSIEN2 D ^DIK  ; Delete old data
"RTN","PSSPRICE",39,0)
 N FDA
"RTN","PSSPRICE",40,0)
 S FDA(50.095,"?+1,"_PSSIEN_",",.01)=PSSTIME
"RTN","PSSPRICE",41,0)
 S FDA(50.095,"?+1,"_PSSIEN_",",1)=PSSDUZ
"RTN","PSSPRICE",42,0)
 S FDA(50.095,"?+1,"_PSSIEN_",",3)=PSSNEW
"RTN","PSSPRICE",43,0)
 D UPDATE^DIE("","FDA")
"RTN","PSSPRICE",44,0)
 S PSSNAME=$$GET1^DIQ(200,PSSDUZ_",",.01)
"RTN","PSSPRICE",45,0)
BULL ;Generate the bulletin.
"RTN","PSSPRICE",46,0)
 S XMY("G.PSS DEE AUDIT")=""
"RTN","PSSPRICE",47,0)
 S XMSUB="Pharmacy Price Tracker",XMDUZ=.5
"RTN","PSSPRICE",48,0)
 S ^UTILITY($J,"PHARM TRACK",1)=PSSNAME_" has changed the PRICE PER DISPENSE UNIT of:"
"RTN","PSSPRICE",49,0)
 S ^UTILITY($J,"PHARM TRACK",2)=$P($G(^PSDRUG(PSSIEN,0)),"^",1)_" to: "_PSSNEW
"RTN","PSSPRICE",50,0)
 S XMTEXT="^UTILITY($J,""PHARM TRACK""," D ^XMD
"RTN","PSSPRICE",51,0)
 K %,PSSTIME,PSSIEN,PSSNAME,PSSOLD,PSSNEW,PSSDUZ,^UTILITY($J),XMSUB,XMTEXT,XMDUZ
"RTN","PSSPRICE",52,0)
 Q
"RTN","PSSPRICE",53,0)
 ;
"UP",50,50.095,-1)
50^950
"UP",50,50.095,0)
50.095
"VER")
8.0^22.2
"^DD",50,50,13,0)
PRICE PER ORDER UNIT^NJ7,2X^^660;3^S:X["$" X=$P(X,"$",2) K:X'?.N.1".".2N!(X>99999)!(X<0)!(X?.E1"."3.N) X
"^DD",50,50,13,.1)

"^DD",50,50,13,1,0)
^.1^^-1
"^DD",50,50,13,1,1,0)
^^TRIGGER^50^16
"^DD",50,50,13,1,1,1)
K DIV S DIV=X,D0=DA,DIV(0)=D0 S Y(0)=X S Y(1)=$S($D(^PSDRUG(D0,660)):^(660),1:"") S X=$P(Y(1),U,5)>0 I X S X=DIV S Y(1)=$S($D(^PSDRUG(D0,660)):^(660),1:"") S X=$P(Y(1),U,6),X=X S DIU=X K Y X ^DD(50,13,1,1,1.1) X ^DD(50,13,1,1,1.4)
"^DD",50,50,13,1,1,1.1)
S X=DIV S Y(1)=$S($D(^PSDRUG(D0,660)):^(660),1:"") S X=DIV,X=$S($P(Y(1),U,5):X/$P(Y(1),U,5),1:"*******"),Y(2)=$G(X) S X=1,Y(3)=$G(X) S X=4,X=$J(Y(2),Y(3),X)
"^DD",50,50,13,1,1,1.4)
S DIH=$G(^PSDRUG(DIV(0),660)),DIV=X S $P(^(660),U,6)=DIV,DIH=50,DIG=16 D ^DICR
"^DD",50,50,13,1,1,2)
K DIV S DIV=X,D0=DA,DIV(0)=D0 S Y(1)=$S($D(^PSDRUG(D0,660)):^(660),1:"") S X=$P(Y(1),U,6),X=X S DIU=X K Y S X="" S DIH=$G(^PSDRUG(DIV(0),660)),DIV=X S $P(^(660),U,6)=DIV,DIH=50,DIG=16 D ^DICR
"^DD",50,50,13,1,1,"CREATE CONDITION")
#15>0
"^DD",50,50,13,1,1,"CREATE VALUE")
$J(#13/#15,1,4)
"^DD",50,50,13,1,1,"DELETE VALUE")
@
"^DD",50,50,13,1,1,"DT")
3130327
"^DD",50,50,13,1,1,"FIELD")
#16
"^DD",50,50,13,1,2,0)
50^PRC^MUMPS
"^DD",50,50,13,1,2,1)
D ST^PSSPRICE(DA,DUZ)
"^DD",50,50,13,1,2,2)
S:X'="" X=X
"^DD",50,50,13,1,2,"%D",0)
^^2^2^3170511^
"^DD",50,50,13,1,2,"%D",1,0)
Cross-reference to set history of price change multiple (field #950) for
"^DD",50,50,13,1,2,"%D",2,0)
changes to this field.
"^DD",50,50,13,1,2,"DT")
3170306
"^DD",50,50,13,3)
Type a Dollar Amount between 0 and 99999, 2 Decimal Digits.
"^DD",50,50,13,20,0)
^.3LA^1^1
"^DD",50,50,13,20,1,0)
PS
"^DD",50,50,13,21,0)
^^1^1^3060407^^
"^DD",50,50,13,21,1,0)
  This is the price per order unit for this drug.
"^DD",50,50,13,"AUDIT")

"^DD",50,50,13,"DT")
3180517
"^DD",50,50,50.095,0)
DT/TM DISP UNIT PRICE CHANGED^50.095DA^^950;0
"^DD",50,50,50.095,21,0)
^.001^3^3^3180523^^
"^DD",50,50,50.095,21,1,0)
This field tracks the Date and Time whenever the PRICE PER DISPENSE UNIT
"^DD",50,50,50.095,21,2,0)
(#16) field is changed.  It is set using a trigger cross-reference on the
"^DD",50,50,50.095,21,3,0)
PRICE PER DISPENSE UNIT (#16) field.
"^DD",50,50.095,0)
DT/TM DISP UNIT PRICE CHANGED SUB-FIELD^^3^3
"^DD",50,50.095,0,"NM","DT/TM DISP UNIT PRICE CHANGED")

"^DD",50,50.095,.01,0)
DT/TM DISP UNIT PRICE CHANGED^MD^^0;1^S %DT="ESTXR" D ^%DT S X=Y K:Y<1 X
"^DD",50,50.095,.01,1,0)
^.1
"^DD",50,50.095,.01,1,1,0)
50.095^B
"^DD",50,50.095,.01,1,1,1)
S ^PSDRUG(DA(1),950,"B",$E(X,1,30),DA)=""
"^DD",50,50.095,.01,1,1,2)
K ^PSDRUG(DA(1),950,"B",$E(X,1,30),DA)
"^DD",50,50.095,.01,3)
Enter the Date/Time the dispense unit price was changed.
"^DD",50,50.095,.01,21,0)
^^3^3^3180522^
"^DD",50,50.095,.01,21,1,0)
This field tracks the Date and Time whenever the PRICE PER DISPENSE UNIT
"^DD",50,50.095,.01,21,2,0)
(#16) field is changed.  It is set using a trigger cross-reference on the
"^DD",50,50.095,.01,21,3,0)
PRICE PER DISPENSE UNIT (#16) field.
"^DD",50,50.095,.01,"DT")
3180522
"^DD",50,50.095,1,0)
EDITED BY^P200^VA(200,^0;2^Q
"^DD",50,50.095,1,3)
Select the person making the price change.
"^DD",50,50.095,1,21,0)
^^1^1^3180523^
"^DD",50,50.095,1,21,1,0)
This is the name of the person making the price change.
"^DD",50,50.095,1,"DT")
3180522
"^DD",50,50.095,3,0)
NEW VALUE^NJ8,2^^0;3^S:X["$" X=$P(X,"$",2) K:X'?.N.1".".2N!(X>99999.99999)!(X<0) X
"^DD",50,50.095,3,3)
Type a dollar amount between 0 and 99999.99999, 5 decimal digits.
"^DD",50,50.095,3,21,0)
^^1^1^3180522^
"^DD",50,50.095,3,21,1,0)
This is the new price value to be tracked.
"^DD",50,50.095,3,"DT")
3180522
"BLD",10636,6)
^195
**END**
**END**

