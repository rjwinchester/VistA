Released PSS*1*189 SEQ #170
Extracted from mail message
**KIDS**:PSS*1.0*189^

**INSTALL NAME**
PSS*1.0*189
"BLD",9246,0)
PSS*1.0*189^PHARMACY DATA MANAGEMENT^0^3160405^y
"BLD",9246,1,0)
^^378^378^3160330^
"BLD",9246,1,1,0)
This patch is part of the Pharmacy Safety Updates project which was 
"BLD",9246,1,2,0)
established to address specific New Service Requests (NSRs) as well as a
"BLD",9246,1,3,0)
Remedy Ticket and a Patient Safety Issue (PSI) related to the VistA Pharmacy
"BLD",9246,1,4,0)
applications as approved by the Health Systems Enterprise Systems Manager
"BLD",9246,1,5,0)
(ESM).
"BLD",9246,1,6,0)
 
"BLD",9246,1,7,0)
This project is comprised of patches from five different applications, as
"BLD",9246,1,8,0)
shown below:
"BLD",9246,1,9,0)
  
"BLD",9246,1,10,0)
   APPLICATION/VERSION                                  PATCH
"BLD",9246,1,11,0)
   -----------------------------------------------------------------
"BLD",9246,1,12,0)
   OUTPATIENT PHARMACY (OP) V. 7.0                      PSO*7*444
"BLD",9246,1,13,0)
   INTEGRATED BILLING (IB) V. 2.0                       IB*2*545
"BLD",9246,1,14,0)
   PHARMACY DATA MANAGEMENT (PDM) V. 1.0                PSS*1*189
"BLD",9246,1,15,0)
   NATIONAL DRUG FILE (NDF) V. 4.0                      PSN*4*429
"BLD",9246,1,16,0)
   INPATIENT MEDICATIONS (IM) V.5.0                     PSJ*5*313
"BLD",9246,1,17,0)
 
"BLD",9246,1,18,0)
 
"BLD",9246,1,19,0)
The following New service Requests (NSRs) are being addressed by this patch:
"BLD",9246,1,20,0)
 
"BLD",9246,1,21,0)
 NSRs 20060601/20111206 Allow Dispensing of Greater Than 90 Day Supply
"BLD",9246,1,22,0)
 ---------------------------------------------------------------------------
"BLD",9246,1,23,0)
 The Outpatient Pharmacy and supporting VistA applications are being modified
"BLD",9246,1,24,0)
 to allow dispensing of more than 90 day supply fill for outpatient 
"BLD",9246,1,25,0)
 prescriptions. The new limit will be 365 days and will be set for each drug
"BLD",9246,1,26,0)
 individually. See below for more information on specific menu 
"BLD",9246,1,27,0)
 options related to this enhancement.  
"BLD",9246,1,28,0)
 
"BLD",9246,1,29,0)
 NSR 20110308 Addition of a STRENGTH Property to IV ADDITIVES and Premixed 
"BLD",9246,1,30,0)
              IV SOLUTIONS
"BLD",9246,1,31,0)
 ----------------------------------------------------------------------------
"BLD",9246,1,32,0)
 Although patches PSJ*5*289 and PSS*1*174 introduced quite a few enhancements
"BLD",9246,1,33,0)
 to the IV Additives and IV Solutions ordering functionality they did not go
"BLD",9246,1,34,0)
 far enough in addressing all the issues originally in the NSR. Patches 
"BLD",9246,1,35,0)
 PSJ*5*313 and PSS*1*189 will extend the display of the IV Additive strength
"BLD",9246,1,36,0)
 to other parts of the Inpatient Medications and Pharmacy Data Management 
"BLD",9246,1,37,0)
 applications. In addition, it will also impose a new rule where an Orderable
"BLD",9246,1,38,0)
 Item can only have one IV Solution for a specific volume when it is marked
"BLD",9246,1,39,0)
 to be used in the CPRS IV Fluid Order Entry. 
"BLD",9246,1,40,0)
  
"BLD",9246,1,41,0)
 NSR 20080907 Inactivate Pharmacy Standard Schedule
"BLD",9246,1,42,0)
 ----------------------------------------------------------------------------
"BLD",9246,1,43,0)
 This enhancement is a conversion of an existing Class III software solution
"BLD",9246,1,44,0)
 that permits an entry in the ADMINISTRATION SCHEDULE file (#51.1) to be 
"BLD",9246,1,45,0)
 marked as INACTIVE via the Standard Schedule Edit [PSS SCHEDULE EDIT] option.
"BLD",9246,1,46,0)
 Once marked INACTIVE the schedule is no longer shown on the CPRS 
"BLD",9246,1,47,0)
 ADMINISTRATION SCHEDULE list.
"BLD",9246,1,48,0)
 
"BLD",9246,1,49,0)
  
"BLD",9246,1,50,0)
  
"BLD",9246,1,51,0)
The following Pharmacy Data Management functionality was modified:
"BLD",9246,1,52,0)
   
"BLD",9246,1,53,0)
1. New MAXIMUM DAYS SUPPLY field (#66) in the DRUG file (#50)
"BLD",9246,1,54,0)
   This new field shown below was added to the DRUG file (#50) for storing
"BLD",9246,1,55,0)
   the local maximum day supply value for a medication in an outpatient 
"BLD",9246,1,56,0)
   prescription.
"BLD",9246,1,57,0)
 
"BLD",9246,1,58,0)
   Field Name: MAXIMUM DAYS SUPPLY   Format: Numeric
"BLD",9246,1,59,0)
 
"BLD",9246,1,60,0)
   INPUT TRANSFORM: D MXDAYSUP^PSSDDUT2
"BLD",9246,1,61,0)
   HELP-PROMPT:     This is the maximum number of days supply for this drug. 
"BLD",9246,1,62,0)
   DESCRIPTION:     This field is used to determine the maximum number for
"BLD",9246,1,63,0)
                    days supply that may be assigned to this drug. The
"BLD",9246,1,64,0)
                    maximum value allowed for this field is 365 (days) for
"BLD",9246,1,65,0)
                    most drugs, however: 
"BLD",9246,1,66,0)
                              
"BLD",9246,1,67,0)
                    - Schedule 2 controlled substances have a 30-day maximum
"BLD",9246,1,68,0)
                      days supply limit
"BLD",9246,1,69,0)
                    - Schedules 3 thru 5 controlled substances have a 90-day
"BLD",9246,1,70,0)
                      maximum days supply limit 
"BLD",9246,1,71,0)
                    - The maximum number of days supply for this drug cannot
"BLD",9246,1,72,0)
                      exceed the National Drug File (NDF) maximum value if it
"BLD",9246,1,73,0)
                      exists 
"BLD",9246,1,74,0)
                    - No value can be entered for Clozapine drugs as the
"BLD",9246,1,75,0)
                      maximum days supply is controlled by the Clozapine
"BLD",9246,1,76,0)
                      functionality
"BLD",9246,1,77,0)
 
"BLD",9246,1,78,0)
2. ADMINISTRATION SCHEDULE file (#51.1)
"BLD",9246,1,79,0)
   a) A new field named INACTIVE (#12) shown below was added to the 
"BLD",9246,1,80,0)
      ADMINISTRATION SCHEDULE file (#51.1) to allow the filtering inactive
"BLD",9246,1,81,0)
      schedules when providing a list to the CPRS application.
"BLD",9246,1,82,0)
 
"BLD",9246,1,83,0)
      Field Name: INACTIVE      Format: Set of Codes ('1' FOR YES)
"BLD",9246,1,84,0)
 
"BLD",9246,1,85,0)
      HELP-PROMPT:    Answer YES to mark this administration schedule entry
"BLD",9246,1,86,0)
                      as inactive. 
"BLD",9246,1,87,0)
      DESCRIPTION:    This field is used to indicate that a Standard Schedule
"BLD",9246,1,88,0)
                      is inactive. Inactive schedules are filtered from the
"BLD",9246,1,89,0)
                      list of schedules sent to CPRS for selection when users
"BLD",9246,1,90,0)
                      are placing a medication order.  
"BLD",9246,1,91,0)
 
"BLD",9246,1,92,0)
   b) The upper limit for the FREQUENCY (IN MINUTES) field (#2) was increased
"BLD",9246,1,93,0)
      from 129,600 (90 days) to 525,600 (365 days).
"BLD",9246,1,94,0)
  
"BLD",9246,1,95,0)
3. MEDICATION INSTRUCTION file (#51)
"BLD",9246,1,96,0)
   The upper limit for the FREQUENCY (IN MINUTES) field (#31) was increased
"BLD",9246,1,97,0)
   from 129,600 (90 days) to 525,600 (365 days).
"BLD",9246,1,98,0)
  
"BLD",9246,1,99,0)
4. IV SOLUTIONS file (#52.7)
"BLD",9246,1,100,0)
   New INPUT TRANSFORMS have been added to the VOLUME (#2) and USED IN IV
"BLD",9246,1,101,0)
   FLUID ORDER ENTRY (#17) to enforce the following new rule introduced 
"BLD",9246,1,102,0)
   relating to this file: 
"BLD",9246,1,103,0)
  
"BLD",9246,1,104,0)
   Rule: An Orderable Item can have only ONE IV solution with a specific
"BLD",9246,1,105,0)
         volume when it is marked to be used in the IV Order Dialog.
"BLD",9246,1,106,0)
 
"BLD",9246,1,107,0)
5. PSSCOMMON input template
"BLD",9246,1,108,0)
   The PSSCOMMON input template used by the Drug File Enter/Edit [PSS DRUG
"BLD",9246,1,109,0)
   ENTER/EDIT] option was modified to include the new MAXIMUM
"BLD",9246,1,110,0)
   DAYS SUPPLY field (#66) in the DRUG file (#50) so that it can be edited
"BLD",9246,1,111,0)
   along with the other fields in this option.
"BLD",9246,1,112,0)
 
"BLD",9246,1,113,0)
6. PSSJ SCHEDULE EDIT Input template
"BLD",9246,1,114,0)
   The PSSJ SCHEDULE EDIT input template used by the Standard Schedule 
"BLD",9246,1,115,0)
   Edit [PSS SCHEDULE EDIT] option was modified to include the new INACTIVE
"BLD",9246,1,116,0)
   field (#12) in the ADMINISTRATION SCHEDULE file (#51.1) so that it can
"BLD",9246,1,117,0)
   be edited along with the other fields in this option.
"BLD",9246,1,118,0)
 
"BLD",9246,1,119,0)
7. Edit Orderable Items [PSS EDIT ORDERABLE ITEMS] option 
"BLD",9246,1,120,0)
   This option was modified to display the IV Additive Strength value as
"BLD",9246,1,121,0)
   seen below:
"BLD",9246,1,122,0)
 
"BLD",9246,1,123,0)
   ... 
"BLD",9246,1,124,0)
      Orderable Item ->  PIPERACILLIN/TAZOBACTAM
"BLD",9246,1,125,0)
      Dosage Form    ->  INJ
"BLD",9246,1,126,0)
 
"BLD",9246,1,127,0)
   Dispense Drugs:
"BLD",9246,1,128,0)
   ---------------
"BLD",9246,1,129,0)
   PIPERACILLIN 3/TAZOBACTAM 0.375GM/VI INJ
"BLD",9246,1,130,0)
   PIPERACILLIN 2/TAZOBACTAM 0.25GM/VI INJ
"BLD",9246,1,131,0)
   PIPERACILLIN 4/TAZOBACTAM 0.5GM/VI INJ
"BLD",9246,1,132,0)
   PIPERACILLIN/TAZOBACTAM         (A)     Additive Strength: 3.375 GM 
"BLD",9246,1,133,0)
   PIPERACILLIN/TAZOBACTAM         (A)     Additive Strength: 2.25 GM 
"BLD",9246,1,134,0)
   PIPERACILLIN/TAZOBACTAM         (A)     Additive Strength: 4.5 GM 
"BLD",9246,1,135,0)
  ...
"BLD",9246,1,136,0)
 
"BLD",9246,1,137,0)
8. PRimary Solution File (IV) [PSSJI SOLN] option
"BLD",9246,1,138,0)
   This option was modified to enforce a new rule introduced to ensure that
"BLD",9246,1,139,0)
   an Orderable Item can only have 1 active IV SOLUTION linked to it with a
"BLD",9246,1,140,0)
   specific VOLUME when the IV SOLUTION is marked YES for the USED IN IV
"BLD",9246,1,141,0)
   FLUID ORDER ENTRY field (#17). When they user tries to perform an edit
"BLD",9246,1,142,0)
   that breaks this rule by editing the screen fields VOLUME, USED IN IV
"BLD",9246,1,143,0)
   FLUID ORDER ENTRY or INACTIVATION DATE, the error message below will be
"BLD",9246,1,144,0)
   displayed and the editing won't be permitted.
"BLD",9246,1,145,0)
  
"BLD",9246,1,146,0)
         Only one Active IV Solution with a specific volume can be linked to
"BLD",9246,1,147,0)
         an Orderable Item or Dispense Drug when the IV Solution is marked to
"BLD",9246,1,148,0)
         be used in the CPRS IV Fluid Order Entry.
"BLD",9246,1,149,0)
 
"BLD",9246,1,150,0)
9. Drug Enter/Edit [PSS DRUG ENTER/EDIT] option 
"BLD",9246,1,151,0)
   a) This option was modified to allow entry of the new MAXIMUM DAY SUPPLY
"BLD",9246,1,152,0)
    
"BLD",9246,1,153,0)
   ...
"BLD",9246,1,154,0)
   NCPDP DISPENSE UNIT: EACH// 
"BLD",9246,1,155,0)
   NCPDP QUANTITY MULTIPLIER: 1// 
"BLD",9246,1,156,0)
   MAXIMUM DAYS SUPPLY: ??
"BLD",9246,1,157,0)
     This field is used to determine the maximum number for days supply that
"BLD",9246,1,158,0)
     may be assigned to this drug. The maximum value allowed for this field
"BLD",9246,1,159,0)
     is 365 (days) for most drugs, however: 
"BLD",9246,1,160,0)
       
"BLD",9246,1,161,0)
       - Schedule 2 controlled substances have a 30-day maximum days supply 
"BLD",9246,1,162,0)
         limit 
"BLD",9246,1,163,0)
       - Schedules 3 thru 5 controlled substances have a 90-day maximum days
"BLD",9246,1,164,0)
         supply limit 
"BLD",9246,1,165,0)
       - The maximum number of days supply for this drug cannot exceed the
"BLD",9246,1,166,0)
         National Drug File (NDF) maximum value if it exists
"BLD",9246,1,167,0)
       - No value can be entered for Clozapine drugs as the maximum days
"BLD",9246,1,168,0)
         supply is controlled by the Clozapine functionality
"BLD",9246,1,169,0)
   
"BLD",9246,1,170,0)
   MAXIMUM DAYS SUPPLY: 
"BLD",9246,1,171,0)
   PRICE PER DISPENSE UNIT: 0.8280
"BLD",9246,1,172,0)
   ...
"BLD",9246,1,173,0)
 
"BLD",9246,1,174,0)
   b) The exact same change described above in #8 was applied to this option
"BLD",9246,1,175,0)
      where the user can create, edit and link IV Solution entries to a 
"BLD",9246,1,176,0)
      dispense drug.
"BLD",9246,1,177,0)
       
"BLD",9246,1,178,0)
10. Lookup into Dispense Drug File [PSS LOOK] option
"BLD",9246,1,179,0)
   This option was modified to display the new MAXIMUM DAYS SUPPLY (#66)
"BLD",9246,1,180,0)
   field in the DRUG file (#50) along with the other dispense drug fields for
"BLD",9246,1,181,0)
   the dispense drug selected, as shown below:
"BLD",9246,1,182,0)
 
"BLD",9246,1,183,0)
    ...
"BLD",9246,1,184,0)
    DISPENSE UNIT:                       VA DISPENSE UNIT:          CAP
"BLD",9246,1,185,0)
    DISPENSE UNITS/ORDER UNIT: 20        PRICE/DISPENSE UNIT:    0.8280
"BLD",9246,1,186,0)
    NCPDP DISPENSE UNIT: EACH            NCPDP QUANTITY MULTIPLIER:  1.000
"BLD",9246,1,187,0)
    MAXIMUM DAYS SUPPLY: 100
"BLD",9246,1,188,0)
    APPL PKG USE:  Outpatient  Unit Dose  Non-VA Med
"BLD",9246,1,189,0)
    STRENGTH: 10                       UNIT: MG
"BLD",9246,1,190,0)
    POSSIBLE DOSAGES:
"BLD",9246,1,191,0)
    ... 
"BLD",9246,1,192,0)
 
"BLD",9246,1,193,0)
11. Standard Schedule Edit [PSS SCHEDULE EDIT] option
"BLD",9246,1,194,0)
   This option was modified to add the new INACTIVE field (#12) in the 
"BLD",9246,1,195,0)
   ADMINISTRATION SCHEDULE file (#51.1) to be updated for a schedule.
"BLD",9246,1,196,0)
    
"BLD",9246,1,197,0)
   ...
"BLD",9246,1,198,0)
   OTHER LANGUAGE EXPANSION: 
"BLD",9246,1,199,0)
   INACTIVE: ??
"BLD",9246,1,200,0)
     This field is used to indicate that a Standard Schedule is inactive.
"BLD",9246,1,201,0)
     Inactive schedules are filtered from the list of schedules sent to CPRS
"BLD",9246,1,202,0)
     for selection when users are placing a medication order.
"BLD",9246,1,203,0)
      
"BLD",9246,1,204,0)
        Choose from: 
"BLD",9246,1,205,0)
          1        YES
"BLD",9246,1,206,0)
   INACTIVE: 
"BLD",9246,1,207,0)
   ...
"BLD",9246,1,208,0)
 
"BLD",9246,1,209,0)
12. Administration Schedule File Report [PSS SCHEDULE REPORT] option
"BLD",9246,1,210,0)
    This option was modified to display the new INACTIVE field (#12)
"BLD",9246,1,211,0)
    created in the ADMINISTRATION SCHEDULE file (#51.1) as seen below:
"BLD",9246,1,212,0)
 
"BLD",9246,1,213,0)
      ADMINISTRATION SCHEDULE FILE REPORT (All)                     PAGE: NN
"BLD",9246,1,214,0)
      ----------------------------------------------------------------------
"BLD",9246,1,215,0)
      ...  
"BLD",9246,1,216,0)
      *Q4H
"BLD",9246,1,217,0)
           STANDARD ADMINISTRATION TIMES: 01-05-09-13-17-21
"BLD",9246,1,218,0)
                    OUTPATIENT EXPANSION: EVERY 4 HOURS
"BLD",9246,1,219,0)
                OTHER LANGUAGE EXPANSION: 
"BLD",9246,1,220,0)
                           SCHEDULE TYPE: CONTINUOUS
"BLD",9246,1,221,0)
                  FREQUENCY (IN MINUTES): 240
"BLD",9246,1,222,0)
            EXCLUDE FROM ALL DOSE CHECKS: 
"BLD",9246,1,223,0)
           EXCLUDE FROM DAILY DOSE CHECK: 
"BLD",9246,1,224,0)
                                INACTIVE: YES
"BLD",9246,1,225,0)
     ...
"BLD",9246,1,226,0)
  
"BLD",9246,1,227,0)
13. Dispense Drug/Orderable Item Maintenance [PSS MAINTAIN ORDERABLE ITEMS] &
"BLD",9246,1,228,0)
    Drug Enter/Edit [PSS DRUG ENTER/EDIT] options
"BLD",9246,1,229,0)
    A new rule described below is being introduced which is related to the
"BLD",9246,1,230,0)
    relationship between IV Solutions and Orderable Items.
"BLD",9246,1,231,0)
  
"BLD",9246,1,232,0)
    Rule: An Orderable Item can only have ONE IV solution with a specific
"BLD",9246,1,233,0)
          volume when it is marked to be used in the CPRS IV Order Dialog.
"BLD",9246,1,234,0)
 
"BLD",9246,1,235,0)
    This option was modified to check every time the user tries to link a 
"BLD",9246,1,236,0)
    dispense drug to an orderable item whether the new rule is being broken
"BLD",9246,1,237,0)
    or not. If the new rule is being broken the message below will be
"BLD",9246,1,238,0)
    displayed and the user will not be able to proceed with linking the drug
"BLD",9246,1,239,0)
    to the orderable item.
"BLD",9246,1,240,0)
  
"BLD",9246,1,241,0)
       Matching [Dispense Drug Name]  to [Orderable Item Name] would cause
"BLD",9246,1,242,0)
       the orderable item to have more than one Active IV Solution with the
"BLD",9246,1,243,0)
       same volume marked to be used in the IV FLUID ORDER ENTRY, which is
"BLD",9246,1,244,0)
       not allowed.
"BLD",9246,1,245,0)
  
"BLD",9246,1,246,0)
       Please, review the IV Solutions associated with this drug before
"BLD",9246,1,247,0)
       matching it to this orderable item or match it to a different 
"BLD",9246,1,248,0)
       orderable item.
"BLD",9246,1,249,0)
  
"BLD",9246,1,250,0)
14. IV Solution Pre-Install Manual Clean-up (Environment Check routine)
"BLD",9246,1,251,0)
    An environment check routine will run before the patch is installed to
"BLD",9246,1,252,0)
    ensure that an orderable item does not have more than one IV Solution
"BLD",9246,1,253,0)
    with the same volume when they are marked YES to be used in the CPRS IV
"BLD",9246,1,254,0)
    Fluid Order Entry. If at least one orderable item entry is found, the
"BLD",9246,1,255,0)
    patch installation will be aborted and a Mailman message will be sent to
"BLD",9246,1,256,0)
    all users holding the following security keys: PSIVMGR, PSIJ MGR, PSNMGR.
"BLD",9246,1,257,0)
    The message will contain a list of all orderable items that need to be 
"BLD",9246,1,258,0)
    cleaned up, as seen in the sample message below:
"BLD",9246,1,259,0)
   
"BLD",9246,1,260,0)
    Subj: Duplicate IV Solution Volume under same Orderable Item  [#215733]
"BLD",9246,1,261,0)
    From: PATCH PSS*1*189  In 'IN' basket.   Page 1
"BLD",9246,1,262,0)
    -------------------------------------------------------------------------
"BLD",9246,1,263,0)
    The list below shows IV Solutions in your database that need to be
"BLD",9246,1,264,0)
    cleaned up before patch PSS*1*189 can be installed.
"BLD",9246,1,265,0)
 
"BLD",9246,1,266,0)
    Rule: An Orderable Item can only have ONE IV solution with a specific
"BLD",9246,1,267,0)
          volume when it is marked to be used in the IV Order Dialog.
"BLD",9246,1,268,0)
 
"BLD",9246,1,269,0)
    Run Date/Time: Jun 12, 2015@09:49:16
"BLD",9246,1,270,0)
    -------------------------------------------------------------------------
"BLD",9246,1,271,0)
    ORDERABLE ITEM (IEN)
"BLD",9246,1,272,0)
          IV DISPENSE DRUG (IEN)
"BLD",9246,1,273,0)
             IV SOLUTION (IEN)
"BLD",9246,1,274,0)
    -------------------------------------------------------------------------
"BLD",9246,1,275,0)
    DEXTROSE (196)
"BLD",9246,1,276,0)
       Solution Volume: 1000 ML
"BLD",9246,1,277,0)
          DEXTROSE 10% IN WATER (620)
"BLD",9246,1,278,0)
             DEXTROSE 10%  (7)
"BLD",9246,1,279,0)
          DEXTROSE 5% IN 0.45% NS (623)
"BLD",9246,1,280,0)
             DEXTROSE 5% 1/2 NS (10)
"BLD",9246,1,281,0)
          DEXTROSE 5% 1000ML INJ (627)
"BLD",9246,1,282,0)
         5% DEXTROSE (1)
"BLD",9246,1,283,0)
 
"BLD",9246,1,284,0)
15. IV Solution Post-Install Automatic Clean-up (Post-install routine)
"BLD",9246,1,285,0)
    IV Solutions that are no longer used, meaning that either the IV
"BLD",9246,1,286,0)
    Solution and/or the Dispense Drug and/or the Orderable Item are marked
"BLD",9246,1,287,0)
    INACTIVE will have the field USED IN IV FLUID ORDER ENTRY set to 'NO'.
"BLD",9246,1,288,0)
    A list of such IV Solutions will be sent to all users holding the
"BLD",9246,1,289,0)
    following security keys: PSIVMGR, PSIJ MGR, PSNMGR. The message will
"BLD",9246,1,290,0)
    contain a list of all IV Solutions that have been automatically updated
"BLD",9246,1,291,0)
    as seen in the sample message below:
"BLD",9246,1,292,0)
 
"BLD",9246,1,293,0)
    Subj: Auto-update of the IV Solution file  [#216328] 08/18/15@09:58 
"BLD",9246,1,294,0)
    From: PATCH PSS*1*189  In 'IN' basket.   Page 1  *New*
"BLD",9246,1,295,0)
    -------------------------------------------------------------------------
"BLD",9246,1,296,0)
    The list below shows IV Solutions in your database that had the field
"BLD",9246,1,297,0)
    USED IN IV FLUID ORDER ENTRY set to 'NO' because either the Orderable
"BLD",9246,1,298,0)
    Item, the Dispense Drug or the IV Solution itself was marked INACTIVE.
"BLD",9246,1,299,0)
    
"BLD",9246,1,300,0)
    Run Date/Time: Aug 18, 2015@09:58:38
"BLD",9246,1,301,0)
    -------------------------------------------------------------------------
"BLD",9246,1,302,0)
    ORDERABLE ITEM (IEN)
"BLD",9246,1,303,0)
       IV DISPENSE DRUG (IEN)
"BLD",9246,1,304,0)
          IV SOLUTION (IEN/VOLUME)
"BLD",9246,1,305,0)
    -------------------------------------------------------------------------
"BLD",9246,1,306,0)
    CEFAZOLIN (106)
"BLD",9246,1,307,0)
       CEFAZOLIN SOD 1GM INJ (1498)
"BLD",9246,1,308,0)
          20% DEXTROSE (2/500 ML)   *** INACTIVE DATE: JAN 11, 1994 ***
"BLD",9246,1,309,0)
          20% DEXTROSE (11/500 ML)   *** INACTIVE DATE: JAN 11, 1994 ***
"BLD",9246,1,310,0)
 
"BLD",9246,1,311,0)
16. New API for CPRS: $$MAXDS^PSSUTIL1
"BLD",9246,1,312,0)
    This new API was created for CPRS to retrieve the Maximum Days Supply
"BLD",9246,1,313,0)
    value for a specific medication. This API is available to CPRS through
"BLD",9246,1,314,0)
    the Integration Control Registration (ICR) #3239. Below is a detailed 
"BLD",9246,1,315,0)
    description of the API.
"BLD",9246,1,316,0)
 
"BLD",9246,1,317,0)
       $$MAXDS^PSSUTIL1(INPUT)
"BLD",9246,1,318,0)
       This API accepts an array containing the Pharmacy Orderable Item
"BLD",9246,1,319,0)
       (required) and Dispense Drug (optional) and returns the maximum number
"BLD",9246,1,320,0)
       of Days Supply allowed to be dispensed for the specific medication.
"BLD",9246,1,321,0)
  
"BLD",9246,1,322,0)
       Parameters:
"BLD",9246,1,323,0)
       Input:  INPUT("PSOI") (Required)
"BLD",9246,1,324,0)
               Pointer to the PHARMACY ORDERABLE ITEM file (#50.7). 
"BLD",9246,1,325,0)
 
"BLD",9246,1,326,0)
               INPUT("DRUG") (Optional)
"BLD",9246,1,327,0)
               Pointer to the DRUG file (#50). This parameter is optional.
"BLD",9246,1,328,0)
               If not passed, the API will return the highest value from all
"BLD",9246,1,329,0)
               the dispense drugs linked to the Pharmacy Orderable Item.      
"BLD",9246,1,330,0)
    
"BLD",9246,1,331,0)
       Output $$MAXDS
"BLD",9246,1,332,0)
              Maximum number of days supply that can be dispensed for the
"BLD",9246,1,333,0)
              orderable item and/or dispense drug.
"BLD",9246,1,334,0)
 
"BLD",9246,1,335,0)
17. IV Additives and Solutions - Display "INACTIVATION DATE"
"BLD",9246,1,336,0)
  
"BLD",9246,1,337,0)
     The INACTIVATION DATE will display whenever a VistA lookup is done on
"BLD",9246,1,338,0)
     IV Additives and Solutions.
"BLD",9246,1,339,0)
  
"BLD",9246,1,340,0)
     This was accomplished by making the following two fields identifiers:
"BLD",9246,1,341,0)
  
"BLD",9246,1,342,0)
     FIELD NAME           FIELD NUMBER     FILE NAME/NUMBER
"BLD",9246,1,343,0)
     ----------------------------------------------------------
"BLD",9246,1,344,0)
     INACTIVATION DATE         12          IV ADDITIVES (#52.6)
"BLD",9246,1,345,0)
     INACTIVATION DATE          8          IV SOLUTIONS (#52.7)
"BLD",9246,1,346,0)
 
"BLD",9246,1,347,0)
 
"BLD",9246,1,348,0)
     Note: The following 'HELP'-PROMPT text will display for fields 8 & 12
"BLD",9246,1,349,0)
           "Enter the date this drug was inactivated.
"BLD",9246,1,350,0)
 
"BLD",9246,1,351,0)
 
"BLD",9246,1,352,0)
 
"BLD",9246,1,353,0)
       ********************* EXAMPLE(1) ADDITIVES *********************
"BLD",9246,1,354,0)
  
"BLD",9246,1,355,0)
 Inpatient Drug Management - Additives File [PSSJI DRUG] 
"BLD",9246,1,356,0)
  
"BLD",9246,1,357,0)
 Select Inpatient Drug Management Option: Additives File
"BLD",9246,1,358,0)
 Select IV ADDITIVES PRINT NAME: PIPERACILLIN
"BLD",9246,1,359,0)
  
"BLD",9246,1,360,0)
 Lookup: IV ADDITIVES  PRINT NAME
"BLD",9246,1,361,0)
  1   PIPERACILLIN/TAZOBACTAM              Additive Strength: 3.375 GM
"BLD",9246,1,362,0)
  2   PIPERACILLIN/TAZOBACTAM              Additive Strength: 2.25 GM 
"BLD",9246,1,363,0)
  3   PIPERACILLIN/TAZOBACTAM   03-5-2015  Additive Strength: 4.5 GM 
"BLD",9246,1,364,0)
  
"BLD",9246,1,365,0)
  
"BLD",9246,1,366,0)
      ********************* EXAMPLE(2) SOLUTIONS *********************
"BLD",9246,1,367,0)
  
"BLD",9246,1,368,0)
 Inpatient Drug Management - Primary Solution File (IV)
"BLD",9246,1,369,0)
  
"BLD",9246,1,370,0)
 Select Inpatient Drug Management Option: PRImary Solution File(IV) 
"BLD",9246,1,371,0)
 Select IV SOLUTIONS PRINT NAME: DEXTROSE 5% / NACL
"BLD",9246,1,372,0)
   Lookup: PRINT NAME
"BLD",9246,1,373,0)
      1   DEXTROSE 5% / NACL 0.2%       1000 ML                
"BLD",9246,1,374,0)
      2   DEXTROSE 5% / NACL 0.33%      1000 ML                
"BLD",9246,1,375,0)
      3   DEXTROSE 5% / NACL 0.45%      1000 ML   12-03-15     
"BLD",9246,1,376,0)
      4   DEXTROSE 5% / NACL 0.9%       1000 ML    
"BLD",9246,1,377,0)
                
"BLD",9246,1,378,0)
       ********************* END EXAMPLES ********************* 
"BLD",9246,4,0)
^9.64PA^52.6^5
"BLD",9246,4,50,0)
50
"BLD",9246,4,50,2,0)
^9.641^50^1
"BLD",9246,4,50,2,50,0)
DRUG  (File-top level)
"BLD",9246,4,50,2,50,1,0)
^9.6411^66^1
"BLD",9246,4,50,2,50,1,66,0)
MAXIMUM DAYS SUPPLY
"BLD",9246,4,50,222)
y^y^p^^^^n^^n
"BLD",9246,4,50,224)

"BLD",9246,4,51,0)
51
"BLD",9246,4,51,2,0)
^9.641^51^1
"BLD",9246,4,51,2,51,0)
MEDICATION INSTRUCTION  (File-top level)
"BLD",9246,4,51,2,51,1,0)
^9.6411^31^1
"BLD",9246,4,51,2,51,1,31,0)
FREQUENCY (IN MINUTES)
"BLD",9246,4,51,222)
y^n^p^^^^n^^n
"BLD",9246,4,51,224)

"BLD",9246,4,51.1,0)
51.1
"BLD",9246,4,51.1,2,0)
^9.641^51.1^1
"BLD",9246,4,51.1,2,51.1,0)
ADMINISTRATION SCHEDULE  (File-top level)
"BLD",9246,4,51.1,2,51.1,1,0)
^9.6411^12^2
"BLD",9246,4,51.1,2,51.1,1,2,0)
FREQUENCY (IN MINUTES)
"BLD",9246,4,51.1,2,51.1,1,12,0)
INACTIVE
"BLD",9246,4,51.1,222)
y^n^p^^^^n^^n
"BLD",9246,4,51.1,224)

"BLD",9246,4,52.6,0)
52.6
"BLD",9246,4,52.6,2,0)
^9.641^52.6^1
"BLD",9246,4,52.6,2,52.6,0)
IV ADDITIVES  (File-top level)
"BLD",9246,4,52.6,2,52.6,1,0)
^9.6411^12^1
"BLD",9246,4,52.6,2,52.6,1,12,0)
INACTIVATION DATE
"BLD",9246,4,52.6,222)
y^y^p^^^^n^^n
"BLD",9246,4,52.6,224)

"BLD",9246,4,52.7,0)
52.7
"BLD",9246,4,52.7,2,0)
^9.641^52.7^1
"BLD",9246,4,52.7,2,52.7,0)
IV SOLUTIONS  (File-top level)
"BLD",9246,4,52.7,2,52.7,1,0)
^9.6411^8^3
"BLD",9246,4,52.7,2,52.7,1,2,0)
VOLUME
"BLD",9246,4,52.7,2,52.7,1,8,0)
INACTIVATION DATE
"BLD",9246,4,52.7,2,52.7,1,17,0)
USED IN IV FLUID ORDER ENTRY
"BLD",9246,4,52.7,222)
y^n^p^^^^n^^n
"BLD",9246,4,52.7,224)

"BLD",9246,4,"APDD",50,50)

"BLD",9246,4,"APDD",50,50,66)

"BLD",9246,4,"APDD",51,51)

"BLD",9246,4,"APDD",51,51,31)

"BLD",9246,4,"APDD",51.1,51.1)

"BLD",9246,4,"APDD",51.1,51.1,2)

"BLD",9246,4,"APDD",51.1,51.1,12)

"BLD",9246,4,"APDD",52.6,52.6)

"BLD",9246,4,"APDD",52.6,52.6,12)

"BLD",9246,4,"APDD",52.7,52.7)

"BLD",9246,4,"APDD",52.7,52.7,2)

"BLD",9246,4,"APDD",52.7,52.7,8)

"BLD",9246,4,"APDD",52.7,52.7,17)

"BLD",9246,4,"B",50,50)

"BLD",9246,4,"B",51,51)

"BLD",9246,4,"B",51.1,51.1)

"BLD",9246,4,"B",52.6,52.6)

"BLD",9246,4,"B",52.7,52.7)

"BLD",9246,6.3)
54
"BLD",9246,"INI")

"BLD",9246,"INID")
y^y^
"BLD",9246,"INIT")
PSS189PI
"BLD",9246,"KRN",0)
^9.67PA^779.2^20
"BLD",9246,"KRN",.4,0)
.4
"BLD",9246,"KRN",.4,"NM",0)
^9.68A^^
"BLD",9246,"KRN",.401,0)
.401
"BLD",9246,"KRN",.401,"NM",0)
^9.68A^^
"BLD",9246,"KRN",.402,0)
.402
"BLD",9246,"KRN",.402,"NM",0)
^9.68A^2^2
"BLD",9246,"KRN",.402,"NM",1,0)
PSSCOMMON    FILE #50^50^0
"BLD",9246,"KRN",.402,"NM",2,0)
PSSJ SCHEDULE EDIT    FILE #51.1^51.1^0
"BLD",9246,"KRN",.402,"NM","B","PSSCOMMON    FILE #50",1)

"BLD",9246,"KRN",.402,"NM","B","PSSJ SCHEDULE EDIT    FILE #51.1",2)

"BLD",9246,"KRN",.403,0)
.403
"BLD",9246,"KRN",.403,"NM",0)
^9.68A^^
"BLD",9246,"KRN",.5,0)
.5
"BLD",9246,"KRN",.5,"NM",0)
^9.68A^^
"BLD",9246,"KRN",.84,0)
.84
"BLD",9246,"KRN",3.6,0)
3.6
"BLD",9246,"KRN",3.8,0)
3.8
"BLD",9246,"KRN",9.2,0)
9.2
"BLD",9246,"KRN",9.8,0)
9.8
"BLD",9246,"KRN",9.8,"NM",0)
^9.68A^9^9
"BLD",9246,"KRN",9.8,"NM",1,0)
PSSSCHED^^0^B16362165
"BLD",9246,"KRN",9.8,"NM",2,0)
PSSLOOK^^0^B86061726
"BLD",9246,"KRN",9.8,"NM",3,0)
PSSDDUT2^^0^B170893168
"BLD",9246,"KRN",9.8,"NM",4,0)
PSSPOIMO^^0^B140931303
"BLD",9246,"KRN",9.8,"NM",5,0)
PSSSCHRP^^0^B109340534
"BLD",9246,"KRN",9.8,"NM",6,0)
PSSVIDRG^^0^B88124860
"BLD",9246,"KRN",9.8,"NM",7,0)
PSSPOIMN^^0^B82446313
"BLD",9246,"KRN",9.8,"NM",8,0)
PSSJSV^^0^B76380719
"BLD",9246,"KRN",9.8,"NM",9,0)
PSSUTIL1^^0^B48136582
"BLD",9246,"KRN",9.8,"NM","B","PSSDDUT2",3)

"BLD",9246,"KRN",9.8,"NM","B","PSSJSV",8)

"BLD",9246,"KRN",9.8,"NM","B","PSSLOOK",2)

"BLD",9246,"KRN",9.8,"NM","B","PSSPOIMN",7)

"BLD",9246,"KRN",9.8,"NM","B","PSSPOIMO",4)

"BLD",9246,"KRN",9.8,"NM","B","PSSSCHED",1)

"BLD",9246,"KRN",9.8,"NM","B","PSSSCHRP",5)

"BLD",9246,"KRN",9.8,"NM","B","PSSUTIL1",9)

"BLD",9246,"KRN",9.8,"NM","B","PSSVIDRG",6)

"BLD",9246,"KRN",19,0)
19
"BLD",9246,"KRN",19,"NM",0)
^9.68A^^
"BLD",9246,"KRN",19.1,0)
19.1
"BLD",9246,"KRN",19.1,"NM",0)
^9.68A^^
"BLD",9246,"KRN",101,0)
101
"BLD",9246,"KRN",101,"NM",0)
^9.68A^^
"BLD",9246,"KRN",409.61,0)
409.61
"BLD",9246,"KRN",771,0)
771
"BLD",9246,"KRN",779.2,0)
779.2
"BLD",9246,"KRN",870,0)
870
"BLD",9246,"KRN",8989.51,0)
8989.51
"BLD",9246,"KRN",8989.52,0)
8989.52
"BLD",9246,"KRN",8994,0)
8994
"BLD",9246,"KRN","B",.4,.4)

"BLD",9246,"KRN","B",.401,.401)

"BLD",9246,"KRN","B",.402,.402)

"BLD",9246,"KRN","B",.403,.403)

"BLD",9246,"KRN","B",.5,.5)

"BLD",9246,"KRN","B",.84,.84)

"BLD",9246,"KRN","B",3.6,3.6)

"BLD",9246,"KRN","B",3.8,3.8)

"BLD",9246,"KRN","B",9.2,9.2)

"BLD",9246,"KRN","B",9.8,9.8)

"BLD",9246,"KRN","B",19,19)

"BLD",9246,"KRN","B",19.1,19.1)

"BLD",9246,"KRN","B",101,101)

"BLD",9246,"KRN","B",409.61,409.61)

"BLD",9246,"KRN","B",771,771)

"BLD",9246,"KRN","B",779.2,779.2)

"BLD",9246,"KRN","B",870,870)

"BLD",9246,"KRN","B",8989.51,8989.51)

"BLD",9246,"KRN","B",8989.52,8989.52)

"BLD",9246,"KRN","B",8994,8994)

"BLD",9246,"PRE")
PSS189EN
"BLD",9246,"QDEF")
^^^^NO^^^^NO^^NO
"BLD",9246,"QUES",0)
^9.62^^
"BLD",9246,"REQB",0)
^9.611^7^6
"BLD",9246,"REQB",1,0)
PSS*1.0*174^2
"BLD",9246,"REQB",2,0)
PSS*1.0*160^2
"BLD",9246,"REQB",3,0)
PSS*1.0*170^2
"BLD",9246,"REQB",5,0)
PSS*1.0*94^2
"BLD",9246,"REQB",6,0)
PSS*1.0*188^2
"BLD",9246,"REQB",7,0)
PSS*1.0*191^2
"BLD",9246,"REQB","B","PSS*1.0*160",2)

"BLD",9246,"REQB","B","PSS*1.0*170",3)

"BLD",9246,"REQB","B","PSS*1.0*174",1)

"BLD",9246,"REQB","B","PSS*1.0*188",6)

"BLD",9246,"REQB","B","PSS*1.0*191",7)

"BLD",9246,"REQB","B","PSS*1.0*94",5)

"FIA",50)
DRUG
"FIA",50,0)
^PSDRUG(
"FIA",50,0,0)
50I
"FIA",50,0,1)
y^y^p^^^^n^^n
"FIA",50,0,10)

"FIA",50,0,11)

"FIA",50,0,"RLRO")

"FIA",50,0,"VR")
1.0^PSS
"FIA",50,50)
1
"FIA",50,50,66)

"FIA",51)
MEDICATION INSTRUCTION
"FIA",51,0)
^PS(51,
"FIA",51,0,0)
51I
"FIA",51,0,1)
y^n^p^^^^n^^n
"FIA",51,0,10)

"FIA",51,0,11)

"FIA",51,0,"RLRO")

"FIA",51,0,"VR")
1.0^PSS
"FIA",51,51)
1
"FIA",51,51,31)

"FIA",51.1)
ADMINISTRATION SCHEDULE
"FIA",51.1,0)
^PS(51.1,
"FIA",51.1,0,0)
51.1I
"FIA",51.1,0,1)
y^n^p^^^^n^^n
"FIA",51.1,0,10)

"FIA",51.1,0,11)

"FIA",51.1,0,"RLRO")

"FIA",51.1,0,"VR")
1.0^PSS
"FIA",51.1,51.1)
1
"FIA",51.1,51.1,2)

"FIA",51.1,51.1,12)

"FIA",52.6)
IV ADDITIVES
"FIA",52.6,0)
^PS(52.6,
"FIA",52.6,0,0)
52.6I
"FIA",52.6,0,1)
y^y^p^^^^n^^n
"FIA",52.6,0,10)

"FIA",52.6,0,11)

"FIA",52.6,0,"RLRO")

"FIA",52.6,0,"VR")
1.0^PSS
"FIA",52.6,52.6)
1
"FIA",52.6,52.6,12)

"FIA",52.7)
IV SOLUTIONS
"FIA",52.7,0)
^PS(52.7,
"FIA",52.7,0,0)
52.7I
"FIA",52.7,0,1)
y^n^p^^^^n^^n
"FIA",52.7,0,10)

"FIA",52.7,0,11)

"FIA",52.7,0,"RLRO")

"FIA",52.7,0,"VR")
1.0^PSS
"FIA",52.7,52.7)
1
"FIA",52.7,52.7,2)

"FIA",52.7,52.7,8)

"FIA",52.7,52.7,17)

"INIT")
PSS189PI
"KRN",.402,1998,-1)
0^1
"KRN",.402,1998,0)
PSSCOMMON^3150401.1633^@^50^^@^3160324
"KRN",.402,1998,"DIAB",1,1,50.037,0)
ALL
"KRN",.402,1998,"DIAB",1,1,50.065,0)
ALL
"KRN",.402,1998,"DR",1,50)
.01;2;D PKIND^PSSDDUT2;3;81;D PKIND^PSSDDUT2;W !!,"NATIONAL FORMULARY INDICATOR: " W:$P($G(^PSDRUG(DA,"ND")),"^",11)=1 "YES" W:$P($G(^PSDRUG(DA,"ND")),"^",11)="" "Not Matched To NDF" W:$P($G(^PSDRUG(DA,"ND")),"^",11)=0 "NO";51;52;
"KRN",.402,1998,"DR",1,50,1)
37;65;9;101;102;6;31;100;N ND S ND=$G(^PSDRUG(DA,"ND")) I +ND,+$P(ND,"^",3),+$P($G(^PSNDF(50.68,+$P(ND,"^",3),"PFS")),"^") S Y="@4";W !!,"If you are planning to match to a NDF entry later or have no plan of using";
"KRN",.402,1998,"DR",1,50,2)
W !,"the external billing function, you may skip the Service Code entry.";400;@4;S PSONEWW=$S($P($G(^PS(59.7,1,10)),"^",9)="N":1,1:0) W !!,"WARNING LABEL SOURCE is "_$S(PSONEWW:"'NEW'.",1:"not 'NEW'.");
"KRN",.402,1998,"DR",1,50,3)
I PSONEWW W !,"The following WARNING LABEL may continue to be used for a limited time for some external interfaces.";I 'PSONEWW W !,"WARNING LABEL will be used until the WARNING LABEL SOURCE is set to 'NEW'.";8;@5;
"KRN",.402,1998,"DR",1,50,4)
D WARN^PSSWRNB S:$G(WARNEDIT) Y="@10" I '$G(WARNEDIT) S Y="@15";@10;8.1;S Y="@5";@15;D GENDER2^PSSWRNA I GENDER="" S Y="@20";8.2;@20;12;13;14.5;15;D NCINIT^PSSDDUT2 S Y="@24";@24;82;D NCPDPDU^PSSDDUT2 S PSSNDU=X S Y="@25";@25;83;
"KRN",.402,1998,"DR",1,50,5)
66;
"KRN",.402,1998,"DR",2,50.037)
.01
"KRN",.402,1998,"DR",2,50.065)
.01
"KRN",.402,1998,"DR",2,50.1)
.01;1;2;
"KRN",.402,2003,-1)
0^2
"KRN",.402,2003,0)
PSSJ SCHEDULE EDIT^3151016.2001^@^51.1^^@^3160331
"KRN",.402,2003,"DIAB",3,1,51.11,0)
WARD ADMINISTRATION TIMES;REQ
"KRN",.402,2003,"DIAB",7,0,51.1,6)
STANDARD ADMINISTRATION TIMES;REQ
"KRN",.402,2003,"DIAB",12,0,51.1,0)
TYPE OF SCHEDULE//CONTINUOUS;REQ
"KRN",.402,2003,"DR",1,51.1)
S PSSJSE=1;S ZPSJS=$$GET1^DIQ(51.1,DA,5,"I");.01;8;8.1;12;S:'$D(PSJIVSEF) Y="@2";5////C//;S PSSSCT=X;S Y=1,PSJS="C";@2;5R~//CONTINUOUS;S PSSSCT=X;S XPSJS=0;I ZPSJS'="",ZPSJS'=X,X'="C" S XPSJS=1;I PSSSCT="P" S XPSJS=1;
"KRN",.402,2003,"DR",1,51.1,1)
I XPSJS=0 S Y="@3";2////@;1////@;D RMTIME^PSSJSV;W !,"The Type of Schedule has changed, the frequency will be removed",!;@3;I PSSSCT="O" D TEMSF^PSSJEEU;S (ZPSJS,PSJS)=X;I PSSSCT'="O" D TEMSFX^PSSJEEU;9;
"KRN",.402,2003,"DR",1,51.1,2)
I PSSSCT="O"!(PSSSCT="OC")!($G(X)=1) S Y="@11";10;@12;I PSSSCT'="O" D TEMSFRX^PSSJEEU;I PSSSCT="O" D TEMSFR^PSSJEEU S Y="";I PSSSCT="P" S Y="@999";I ",O,D,"[(","_PSSSCT_",") S Y="@5" Q;@4;S ZZZ=$$GET1^DIQ(51.1,DA,2,"I");
"KRN",.402,2003,"DR",1,51.1,3)
2//^D ENFQD^PSSJSV;S PSSFRQ=$G(X);I PSSSCT="OC" S Y="@60" Q;I X="" W " Must enter a frequency." K X S Y="@4" Q;I PSSSCT="P" S Y="@999";I PSSFRQ=""!(PSSFRQ=ZZZ) S Y="@60";1////@;D RMTIME^PSSJSV;
"KRN",.402,2003,"DR",1,51.1,4)
W !,"The Frequency has changed, the Admin Times will be removed",!;@60;S PSJS=$$NSO^PSGS0($G(PSSFRQ)),OFLG=0;I PSJS'="" W !?10,"The schedule entered equals ",PSJS,".",!;I PSSFRQ>1439,PSSFRQ#1440 S OFLG=1;
"KRN",.402,2003,"DR",1,51.1,5)
I PSSFRQ,PSSFRQ<1440,1440#PSSFRQ S OFLG=1;I PSSSCT="OC" S OFLG=1;I 'OFLG S Y="@5";W !?10,"This is an odd schedule that does not require administration times.",!;W ?10,"BCMA will determine the administration times based off the",!;
"KRN",.402,2003,"DR",1,51.1,6)
W ?10,"start date/time of the medication order.";1////@;D RMTIME^PSSJSV;S Y="@999";@5;I PSSSCT'="D",PSSSCT'="C",PSSSCT'="O" S Y="@6" Q;1R~;I X="",PSSSCT="C" W "Must enter administration times. " K X S Y="@5" Q;S Y="@7";@6;1;@7;3;
"KRN",.402,2003,"DR",1,51.1,7)
@999;K PSSSCT,PSSFRQ,PSSJSE,ZPSJS;
"KRN",.402,2003,"DR",2,51.11)
.01;I X="" S Y="@999" Q;1R~;
"MBREQ")
0
"ORD",7,.402)
.402;7;;;EDEOUT^DIFROMSO(.402,DA,"",XPDA);FPRE^DIFROMSI(.402,"",XPDA);EPRE^DIFROMSI(.402,DA,$E("N",$G(XPDNEW)),XPDA,"",OLDA);;EPOST^DIFROMSI(.402,DA,"",XPDA);DEL^DIFROMSK(.402,"",%)
"ORD",7,.402,0)
INPUT TEMPLATE
"PKG",517,-1)
1^1
"PKG",517,0)
PHARMACY DATA MANAGEMENT^PSS^Maintenance of Pharmacy files.
"PKG",517,20,0)
^9.402P^^
"PKG",517,22,0)
^9.49I^1^1
"PKG",517,22,1,0)
1.0^2970930^2971014^11595
"PKG",517,22,1,"PAH",1,0)
189^3160405
"PKG",517,22,1,"PAH",1,1,0)
^^378^378^3160405
"PKG",517,22,1,"PAH",1,1,1,0)
This patch is part of the Pharmacy Safety Updates project which was 
"PKG",517,22,1,"PAH",1,1,2,0)
established to address specific New Service Requests (NSRs) as well as a
"PKG",517,22,1,"PAH",1,1,3,0)
Remedy Ticket and a Patient Safety Issue (PSI) related to the VistA Pharmacy
"PKG",517,22,1,"PAH",1,1,4,0)
applications as approved by the Health Systems Enterprise Systems Manager
"PKG",517,22,1,"PAH",1,1,5,0)
(ESM).
"PKG",517,22,1,"PAH",1,1,6,0)
 
"PKG",517,22,1,"PAH",1,1,7,0)
This project is comprised of patches from five different applications, as
"PKG",517,22,1,"PAH",1,1,8,0)
shown below:
"PKG",517,22,1,"PAH",1,1,9,0)
  
"PKG",517,22,1,"PAH",1,1,10,0)
   APPLICATION/VERSION                                  PATCH
"PKG",517,22,1,"PAH",1,1,11,0)
   -----------------------------------------------------------------
"PKG",517,22,1,"PAH",1,1,12,0)
   OUTPATIENT PHARMACY (OP) V. 7.0                      PSO*7*444
"PKG",517,22,1,"PAH",1,1,13,0)
   INTEGRATED BILLING (IB) V. 2.0                       IB*2*545
"PKG",517,22,1,"PAH",1,1,14,0)
   PHARMACY DATA MANAGEMENT (PDM) V. 1.0                PSS*1*189
"PKG",517,22,1,"PAH",1,1,15,0)
   NATIONAL DRUG FILE (NDF) V. 4.0                      PSN*4*429
"PKG",517,22,1,"PAH",1,1,16,0)
   INPATIENT MEDICATIONS (IM) V.5.0                     PSJ*5*313
"PKG",517,22,1,"PAH",1,1,17,0)
 
"PKG",517,22,1,"PAH",1,1,18,0)
 
"PKG",517,22,1,"PAH",1,1,19,0)
The following New service Requests (NSRs) are being addressed by this patch:
"PKG",517,22,1,"PAH",1,1,20,0)
 
"PKG",517,22,1,"PAH",1,1,21,0)
 NSRs 20060601/20111206 Allow Dispensing of Greater Than 90 Day Supply
"PKG",517,22,1,"PAH",1,1,22,0)
 ---------------------------------------------------------------------------
"PKG",517,22,1,"PAH",1,1,23,0)
 The Outpatient Pharmacy and supporting VistA applications are being modified
"PKG",517,22,1,"PAH",1,1,24,0)
 to allow dispensing of more than 90 day supply fill for outpatient 
"PKG",517,22,1,"PAH",1,1,25,0)
 prescriptions. The new limit will be 365 days and will be set for each drug
"PKG",517,22,1,"PAH",1,1,26,0)
 individually. See below for more information on specific menu 
"PKG",517,22,1,"PAH",1,1,27,0)
 options related to this enhancement.  
"PKG",517,22,1,"PAH",1,1,28,0)
 
"PKG",517,22,1,"PAH",1,1,29,0)
 NSR 20110308 Addition of a STRENGTH Property to IV ADDITIVES and Premixed 
"PKG",517,22,1,"PAH",1,1,30,0)
              IV SOLUTIONS
"PKG",517,22,1,"PAH",1,1,31,0)
 ----------------------------------------------------------------------------
"PKG",517,22,1,"PAH",1,1,32,0)
 Although patches PSJ*5*289 and PSS*1*174 introduced quite a few enhancements
"PKG",517,22,1,"PAH",1,1,33,0)
 to the IV Additives and IV Solutions ordering functionality they did not go
"PKG",517,22,1,"PAH",1,1,34,0)
 far enough in addressing all the issues originally in the NSR. Patches 
"PKG",517,22,1,"PAH",1,1,35,0)
 PSJ*5*313 and PSS*1*189 will extend the display of the IV Additive strength
"PKG",517,22,1,"PAH",1,1,36,0)
 to other parts of the Inpatient Medications and Pharmacy Data Management 
"PKG",517,22,1,"PAH",1,1,37,0)
 applications. In addition, it will also impose a new rule where an Orderable
"PKG",517,22,1,"PAH",1,1,38,0)
 Item can only have one IV Solution for a specific volume when it is marked
"PKG",517,22,1,"PAH",1,1,39,0)
 to be used in the CPRS IV Fluid Order Entry. 
"PKG",517,22,1,"PAH",1,1,40,0)
  
"PKG",517,22,1,"PAH",1,1,41,0)
 NSR 20080907 Inactivate Pharmacy Standard Schedule
"PKG",517,22,1,"PAH",1,1,42,0)
 ----------------------------------------------------------------------------
"PKG",517,22,1,"PAH",1,1,43,0)
 This enhancement is a conversion of an existing Class III software solution
"PKG",517,22,1,"PAH",1,1,44,0)
 that permits an entry in the ADMINISTRATION SCHEDULE file (#51.1) to be 
"PKG",517,22,1,"PAH",1,1,45,0)
 marked as INACTIVE via the Standard Schedule Edit [PSS SCHEDULE EDIT] option.
"PKG",517,22,1,"PAH",1,1,46,0)
 Once marked INACTIVE the schedule is no longer shown on the CPRS 
"PKG",517,22,1,"PAH",1,1,47,0)
 ADMINISTRATION SCHEDULE list.
"PKG",517,22,1,"PAH",1,1,48,0)
 
"PKG",517,22,1,"PAH",1,1,49,0)
  
"PKG",517,22,1,"PAH",1,1,50,0)
  
"PKG",517,22,1,"PAH",1,1,51,0)
The following Pharmacy Data Management functionality was modified:
"PKG",517,22,1,"PAH",1,1,52,0)
   
"PKG",517,22,1,"PAH",1,1,53,0)
1. New MAXIMUM DAYS SUPPLY field (#66) in the DRUG file (#50)
"PKG",517,22,1,"PAH",1,1,54,0)
   This new field shown below was added to the DRUG file (#50) for storing
"PKG",517,22,1,"PAH",1,1,55,0)
   the local maximum day supply value for a medication in an outpatient 
"PKG",517,22,1,"PAH",1,1,56,0)
   prescription.
"PKG",517,22,1,"PAH",1,1,57,0)
 
"PKG",517,22,1,"PAH",1,1,58,0)
   Field Name: MAXIMUM DAYS SUPPLY   Format: Numeric
"PKG",517,22,1,"PAH",1,1,59,0)
 
"PKG",517,22,1,"PAH",1,1,60,0)
   INPUT TRANSFORM: D MXDAYSUP^PSSDDUT2
"PKG",517,22,1,"PAH",1,1,61,0)
   HELP-PROMPT:     This is the maximum number of days supply for this drug. 
"PKG",517,22,1,"PAH",1,1,62,0)
   DESCRIPTION:     This field is used to determine the maximum number for
"PKG",517,22,1,"PAH",1,1,63,0)
                    days supply that may be assigned to this drug. The
"PKG",517,22,1,"PAH",1,1,64,0)
                    maximum value allowed for this field is 365 (days) for
"PKG",517,22,1,"PAH",1,1,65,0)
                    most drugs, however: 
"PKG",517,22,1,"PAH",1,1,66,0)
                              
"PKG",517,22,1,"PAH",1,1,67,0)
                    - Schedule 2 controlled substances have a 30-day maximum
"PKG",517,22,1,"PAH",1,1,68,0)
                      days supply limit
"PKG",517,22,1,"PAH",1,1,69,0)
                    - Schedules 3 thru 5 controlled substances have a 90-day
"PKG",517,22,1,"PAH",1,1,70,0)
                      maximum days supply limit 
"PKG",517,22,1,"PAH",1,1,71,0)
                    - The maximum number of days supply for this drug cannot
"PKG",517,22,1,"PAH",1,1,72,0)
                      exceed the National Drug File (NDF) maximum value if it
"PKG",517,22,1,"PAH",1,1,73,0)
                      exists 
"PKG",517,22,1,"PAH",1,1,74,0)
                    - No value can be entered for Clozapine drugs as the
"PKG",517,22,1,"PAH",1,1,75,0)
                      maximum days supply is controlled by the Clozapine
"PKG",517,22,1,"PAH",1,1,76,0)
                      functionality
"PKG",517,22,1,"PAH",1,1,77,0)
 
"PKG",517,22,1,"PAH",1,1,78,0)
2. ADMINISTRATION SCHEDULE file (#51.1)
"PKG",517,22,1,"PAH",1,1,79,0)
   a) A new field named INACTIVE (#12) shown below was added to the 
"PKG",517,22,1,"PAH",1,1,80,0)
      ADMINISTRATION SCHEDULE file (#51.1) to allow the filtering inactive
"PKG",517,22,1,"PAH",1,1,81,0)
      schedules when providing a list to the CPRS application.
"PKG",517,22,1,"PAH",1,1,82,0)
 
"PKG",517,22,1,"PAH",1,1,83,0)
      Field Name: INACTIVE      Format: Set of Codes ('1' FOR YES)
"PKG",517,22,1,"PAH",1,1,84,0)
 
"PKG",517,22,1,"PAH",1,1,85,0)
      HELP-PROMPT:    Answer YES to mark this administration schedule entry
"PKG",517,22,1,"PAH",1,1,86,0)
                      as inactive. 
"PKG",517,22,1,"PAH",1,1,87,0)
      DESCRIPTION:    This field is used to indicate that a Standard Schedule
"PKG",517,22,1,"PAH",1,1,88,0)
                      is inactive. Inactive schedules are filtered from the
"PKG",517,22,1,"PAH",1,1,89,0)
                      list of schedules sent to CPRS for selection when users
"PKG",517,22,1,"PAH",1,1,90,0)
                      are placing a medication order.  
"PKG",517,22,1,"PAH",1,1,91,0)
 
"PKG",517,22,1,"PAH",1,1,92,0)
   b) The upper limit for the FREQUENCY (IN MINUTES) field (#2) was increased
"PKG",517,22,1,"PAH",1,1,93,0)
      from 129,600 (90 days) to 525,600 (365 days).
"PKG",517,22,1,"PAH",1,1,94,0)
  
"PKG",517,22,1,"PAH",1,1,95,0)
3. MEDICATION INSTRUCTION file (#51)
"PKG",517,22,1,"PAH",1,1,96,0)
   The upper limit for the FREQUENCY (IN MINUTES) field (#31) was increased
"PKG",517,22,1,"PAH",1,1,97,0)
   from 129,600 (90 days) to 525,600 (365 days).
"PKG",517,22,1,"PAH",1,1,98,0)
  
"PKG",517,22,1,"PAH",1,1,99,0)
4. IV SOLUTIONS file (#52.7)
"PKG",517,22,1,"PAH",1,1,100,0)
   New INPUT TRANSFORMS have been added to the VOLUME (#2) and USED IN IV
"PKG",517,22,1,"PAH",1,1,101,0)
   FLUID ORDER ENTRY (#17) to enforce the following new rule introduced 
"PKG",517,22,1,"PAH",1,1,102,0)
   relating to this file: 
"PKG",517,22,1,"PAH",1,1,103,0)
  
"PKG",517,22,1,"PAH",1,1,104,0)
   Rule: An Orderable Item can have only ONE IV solution with a specific
"PKG",517,22,1,"PAH",1,1,105,0)
         volume when it is marked to be used in the IV Order Dialog.
"PKG",517,22,1,"PAH",1,1,106,0)
 
"PKG",517,22,1,"PAH",1,1,107,0)
5. PSSCOMMON input template
"PKG",517,22,1,"PAH",1,1,108,0)
   The PSSCOMMON input template used by the Drug File Enter/Edit [PSS DRUG
"PKG",517,22,1,"PAH",1,1,109,0)
   ENTER/EDIT] option was modified to include the new MAXIMUM
"PKG",517,22,1,"PAH",1,1,110,0)
   DAYS SUPPLY field (#66) in the DRUG file (#50) so that it can be edited
"PKG",517,22,1,"PAH",1,1,111,0)
   along with the other fields in this option.
"PKG",517,22,1,"PAH",1,1,112,0)
 
"PKG",517,22,1,"PAH",1,1,113,0)
6. PSSJ SCHEDULE EDIT Input template
"PKG",517,22,1,"PAH",1,1,114,0)
   The PSSJ SCHEDULE EDIT input template used by the Standard Schedule 
"PKG",517,22,1,"PAH",1,1,115,0)
   Edit [PSS SCHEDULE EDIT] option was modified to include the new INACTIVE
"PKG",517,22,1,"PAH",1,1,116,0)
   field (#12) in the ADMINISTRATION SCHEDULE file (#51.1) so that it can
"PKG",517,22,1,"PAH",1,1,117,0)
   be edited along with the other fields in this option.
"PKG",517,22,1,"PAH",1,1,118,0)
 
"PKG",517,22,1,"PAH",1,1,119,0)
7. Edit Orderable Items [PSS EDIT ORDERABLE ITEMS] option 
"PKG",517,22,1,"PAH",1,1,120,0)
   This option was modified to display the IV Additive Strength value as
"PKG",517,22,1,"PAH",1,1,121,0)
   seen below:
"PKG",517,22,1,"PAH",1,1,122,0)
 
"PKG",517,22,1,"PAH",1,1,123,0)
   ... 
"PKG",517,22,1,"PAH",1,1,124,0)
      Orderable Item ->  PIPERACILLIN/TAZOBACTAM
"PKG",517,22,1,"PAH",1,1,125,0)
      Dosage Form    ->  INJ
"PKG",517,22,1,"PAH",1,1,126,0)
 
"PKG",517,22,1,"PAH",1,1,127,0)
   Dispense Drugs:
"PKG",517,22,1,"PAH",1,1,128,0)
   ---------------
"PKG",517,22,1,"PAH",1,1,129,0)
   PIPERACILLIN 3/TAZOBACTAM 0.375GM/VI INJ
"PKG",517,22,1,"PAH",1,1,130,0)
   PIPERACILLIN 2/TAZOBACTAM 0.25GM/VI INJ
"PKG",517,22,1,"PAH",1,1,131,0)
   PIPERACILLIN 4/TAZOBACTAM 0.5GM/VI INJ
"PKG",517,22,1,"PAH",1,1,132,0)
   PIPERACILLIN/TAZOBACTAM         (A)     Additive Strength: 3.375 GM 
"PKG",517,22,1,"PAH",1,1,133,0)
   PIPERACILLIN/TAZOBACTAM         (A)     Additive Strength: 2.25 GM 
"PKG",517,22,1,"PAH",1,1,134,0)
   PIPERACILLIN/TAZOBACTAM         (A)     Additive Strength: 4.5 GM 
"PKG",517,22,1,"PAH",1,1,135,0)
  ...
"PKG",517,22,1,"PAH",1,1,136,0)
 
"PKG",517,22,1,"PAH",1,1,137,0)
8. PRimary Solution File (IV) [PSSJI SOLN] option
"PKG",517,22,1,"PAH",1,1,138,0)
   This option was modified to enforce a new rule introduced to ensure that
"PKG",517,22,1,"PAH",1,1,139,0)
   an Orderable Item can only have 1 active IV SOLUTION linked to it with a
"PKG",517,22,1,"PAH",1,1,140,0)
   specific VOLUME when the IV SOLUTION is marked YES for the USED IN IV
"PKG",517,22,1,"PAH",1,1,141,0)
   FLUID ORDER ENTRY field (#17). When they user tries to perform an edit
"PKG",517,22,1,"PAH",1,1,142,0)
   that breaks this rule by editing the screen fields VOLUME, USED IN IV
"PKG",517,22,1,"PAH",1,1,143,0)
   FLUID ORDER ENTRY or INACTIVATION DATE, the error message below will be
"PKG",517,22,1,"PAH",1,1,144,0)
   displayed and the editing won't be permitted.
"PKG",517,22,1,"PAH",1,1,145,0)
  
"PKG",517,22,1,"PAH",1,1,146,0)
         Only one Active IV Solution with a specific volume can be linked to
"PKG",517,22,1,"PAH",1,1,147,0)
         an Orderable Item or Dispense Drug when the IV Solution is marked to
"PKG",517,22,1,"PAH",1,1,148,0)
         be used in the CPRS IV Fluid Order Entry.
"PKG",517,22,1,"PAH",1,1,149,0)
 
"PKG",517,22,1,"PAH",1,1,150,0)
9. Drug Enter/Edit [PSS DRUG ENTER/EDIT] option 
"PKG",517,22,1,"PAH",1,1,151,0)
   a) This option was modified to allow entry of the new MAXIMUM DAY SUPPLY
"PKG",517,22,1,"PAH",1,1,152,0)
    
"PKG",517,22,1,"PAH",1,1,153,0)
   ...
"PKG",517,22,1,"PAH",1,1,154,0)
   NCPDP DISPENSE UNIT: EACH// 
"PKG",517,22,1,"PAH",1,1,155,0)
   NCPDP QUANTITY MULTIPLIER: 1// 
"PKG",517,22,1,"PAH",1,1,156,0)
   MAXIMUM DAYS SUPPLY: ??
"PKG",517,22,1,"PAH",1,1,157,0)
     This field is used to determine the maximum number for days supply that
"PKG",517,22,1,"PAH",1,1,158,0)
     may be assigned to this drug. The maximum value allowed for this field
"PKG",517,22,1,"PAH",1,1,159,0)
     is 365 (days) for most drugs, however: 
"PKG",517,22,1,"PAH",1,1,160,0)
       
"PKG",517,22,1,"PAH",1,1,161,0)
       - Schedule 2 controlled substances have a 30-day maximum days supply 
"PKG",517,22,1,"PAH",1,1,162,0)
         limit 
"PKG",517,22,1,"PAH",1,1,163,0)
       - Schedules 3 thru 5 controlled substances have a 90-day maximum days
"PKG",517,22,1,"PAH",1,1,164,0)
         supply limit 
"PKG",517,22,1,"PAH",1,1,165,0)
       - The maximum number of days supply for this drug cannot exceed the
"PKG",517,22,1,"PAH",1,1,166,0)
         National Drug File (NDF) maximum value if it exists
"PKG",517,22,1,"PAH",1,1,167,0)
       - No value can be entered for Clozapine drugs as the maximum days
"PKG",517,22,1,"PAH",1,1,168,0)
         supply is controlled by the Clozapine functionality
"PKG",517,22,1,"PAH",1,1,169,0)
   
"PKG",517,22,1,"PAH",1,1,170,0)
   MAXIMUM DAYS SUPPLY: 
"PKG",517,22,1,"PAH",1,1,171,0)
   PRICE PER DISPENSE UNIT: 0.8280
"PKG",517,22,1,"PAH",1,1,172,0)
   ...
"PKG",517,22,1,"PAH",1,1,173,0)
 
"PKG",517,22,1,"PAH",1,1,174,0)
   b) The exact same change described above in #8 was applied to this option
"PKG",517,22,1,"PAH",1,1,175,0)
      where the user can create, edit and link IV Solution entries to a 
"PKG",517,22,1,"PAH",1,1,176,0)
      dispense drug.
"PKG",517,22,1,"PAH",1,1,177,0)
       
"PKG",517,22,1,"PAH",1,1,178,0)
10. Lookup into Dispense Drug File [PSS LOOK] option
"PKG",517,22,1,"PAH",1,1,179,0)
   This option was modified to display the new MAXIMUM DAYS SUPPLY (#66)
"PKG",517,22,1,"PAH",1,1,180,0)
   field in the DRUG file (#50) along with the other dispense drug fields for
"PKG",517,22,1,"PAH",1,1,181,0)
   the dispense drug selected, as shown below:
"PKG",517,22,1,"PAH",1,1,182,0)
 
"PKG",517,22,1,"PAH",1,1,183,0)
    ...
"PKG",517,22,1,"PAH",1,1,184,0)
    DISPENSE UNIT:                       VA DISPENSE UNIT:          CAP
"PKG",517,22,1,"PAH",1,1,185,0)
    DISPENSE UNITS/ORDER UNIT: 20        PRICE/DISPENSE UNIT:    0.8280
"PKG",517,22,1,"PAH",1,1,186,0)
    NCPDP DISPENSE UNIT: EACH            NCPDP QUANTITY MULTIPLIER:  1.000
"PKG",517,22,1,"PAH",1,1,187,0)
    MAXIMUM DAYS SUPPLY: 100
"PKG",517,22,1,"PAH",1,1,188,0)
    APPL PKG USE:  Outpatient  Unit Dose  Non-VA Med
"PKG",517,22,1,"PAH",1,1,189,0)
    STRENGTH: 10                       UNIT: MG
"PKG",517,22,1,"PAH",1,1,190,0)
    POSSIBLE DOSAGES:
"PKG",517,22,1,"PAH",1,1,191,0)
    ... 
"PKG",517,22,1,"PAH",1,1,192,0)
 
"PKG",517,22,1,"PAH",1,1,193,0)
11. Standard Schedule Edit [PSS SCHEDULE EDIT] option
"PKG",517,22,1,"PAH",1,1,194,0)
   This option was modified to add the new INACTIVE field (#12) in the 
"PKG",517,22,1,"PAH",1,1,195,0)
   ADMINISTRATION SCHEDULE file (#51.1) to be updated for a schedule.
"PKG",517,22,1,"PAH",1,1,196,0)
    
"PKG",517,22,1,"PAH",1,1,197,0)
   ...
"PKG",517,22,1,"PAH",1,1,198,0)
   OTHER LANGUAGE EXPANSION: 
"PKG",517,22,1,"PAH",1,1,199,0)
   INACTIVE: ??
"PKG",517,22,1,"PAH",1,1,200,0)
     This field is used to indicate that a Standard Schedule is inactive.
"PKG",517,22,1,"PAH",1,1,201,0)
     Inactive schedules are filtered from the list of schedules sent to CPRS
"PKG",517,22,1,"PAH",1,1,202,0)
     for selection when users are placing a medication order.
"PKG",517,22,1,"PAH",1,1,203,0)
      
"PKG",517,22,1,"PAH",1,1,204,0)
        Choose from: 
"PKG",517,22,1,"PAH",1,1,205,0)
          1        YES
"PKG",517,22,1,"PAH",1,1,206,0)
   INACTIVE: 
"PKG",517,22,1,"PAH",1,1,207,0)
   ...
"PKG",517,22,1,"PAH",1,1,208,0)
 
"PKG",517,22,1,"PAH",1,1,209,0)
12. Administration Schedule File Report [PSS SCHEDULE REPORT] option
"PKG",517,22,1,"PAH",1,1,210,0)
    This option was modified to display the new INACTIVE field (#12)
"PKG",517,22,1,"PAH",1,1,211,0)
    created in the ADMINISTRATION SCHEDULE file (#51.1) as seen below:
"PKG",517,22,1,"PAH",1,1,212,0)
 
"PKG",517,22,1,"PAH",1,1,213,0)
      ADMINISTRATION SCHEDULE FILE REPORT (All)                     PAGE: NN
"PKG",517,22,1,"PAH",1,1,214,0)
      ----------------------------------------------------------------------
"PKG",517,22,1,"PAH",1,1,215,0)
      ...  
"PKG",517,22,1,"PAH",1,1,216,0)
      *Q4H
"PKG",517,22,1,"PAH",1,1,217,0)
           STANDARD ADMINISTRATION TIMES: 01-05-09-13-17-21
"PKG",517,22,1,"PAH",1,1,218,0)
                    OUTPATIENT EXPANSION: EVERY 4 HOURS
"PKG",517,22,1,"PAH",1,1,219,0)
                OTHER LANGUAGE EXPANSION: 
"PKG",517,22,1,"PAH",1,1,220,0)
                           SCHEDULE TYPE: CONTINUOUS
"PKG",517,22,1,"PAH",1,1,221,0)
                  FREQUENCY (IN MINUTES): 240
"PKG",517,22,1,"PAH",1,1,222,0)
            EXCLUDE FROM ALL DOSE CHECKS: 
"PKG",517,22,1,"PAH",1,1,223,0)
           EXCLUDE FROM DAILY DOSE CHECK: 
"PKG",517,22,1,"PAH",1,1,224,0)
                                INACTIVE: YES
"PKG",517,22,1,"PAH",1,1,225,0)
     ...
"PKG",517,22,1,"PAH",1,1,226,0)
  
"PKG",517,22,1,"PAH",1,1,227,0)
13. Dispense Drug/Orderable Item Maintenance [PSS MAINTAIN ORDERABLE ITEMS] &
"PKG",517,22,1,"PAH",1,1,228,0)
    Drug Enter/Edit [PSS DRUG ENTER/EDIT] options
"PKG",517,22,1,"PAH",1,1,229,0)
    A new rule described below is being introduced which is related to the
"PKG",517,22,1,"PAH",1,1,230,0)
    relationship between IV Solutions and Orderable Items.
"PKG",517,22,1,"PAH",1,1,231,0)
  
"PKG",517,22,1,"PAH",1,1,232,0)
    Rule: An Orderable Item can only have ONE IV solution with a specific
"PKG",517,22,1,"PAH",1,1,233,0)
          volume when it is marked to be used in the CPRS IV Order Dialog.
"PKG",517,22,1,"PAH",1,1,234,0)
 
"PKG",517,22,1,"PAH",1,1,235,0)
    This option was modified to check every time the user tries to link a 
"PKG",517,22,1,"PAH",1,1,236,0)
    dispense drug to an orderable item whether the new rule is being broken
"PKG",517,22,1,"PAH",1,1,237,0)
    or not. If the new rule is being broken the message below will be
"PKG",517,22,1,"PAH",1,1,238,0)
    displayed and the user will not be able to proceed with linking the drug
"PKG",517,22,1,"PAH",1,1,239,0)
    to the orderable item.
"PKG",517,22,1,"PAH",1,1,240,0)
  
"PKG",517,22,1,"PAH",1,1,241,0)
       Matching [Dispense Drug Name]  to [Orderable Item Name] would cause
"PKG",517,22,1,"PAH",1,1,242,0)
       the orderable item to have more than one Active IV Solution with the
"PKG",517,22,1,"PAH",1,1,243,0)
       same volume marked to be used in the IV FLUID ORDER ENTRY, which is
"PKG",517,22,1,"PAH",1,1,244,0)
       not allowed.
"PKG",517,22,1,"PAH",1,1,245,0)
  
"PKG",517,22,1,"PAH",1,1,246,0)
       Please, review the IV Solutions associated with this drug before
"PKG",517,22,1,"PAH",1,1,247,0)
       matching it to this orderable item or match it to a different 
"PKG",517,22,1,"PAH",1,1,248,0)
       orderable item.
"PKG",517,22,1,"PAH",1,1,249,0)
  
"PKG",517,22,1,"PAH",1,1,250,0)
14. IV Solution Pre-Install Manual Clean-up (Environment Check routine)
"PKG",517,22,1,"PAH",1,1,251,0)
    An environment check routine will run before the patch is installed to
"PKG",517,22,1,"PAH",1,1,252,0)
    ensure that an orderable item does not have more than one IV Solution
"PKG",517,22,1,"PAH",1,1,253,0)
    with the same volume when they are marked YES to be used in the CPRS IV
"PKG",517,22,1,"PAH",1,1,254,0)
    Fluid Order Entry. If at least one orderable item entry is found, the
"PKG",517,22,1,"PAH",1,1,255,0)
    patch installation will be aborted and a Mailman message will be sent to
"PKG",517,22,1,"PAH",1,1,256,0)
    all users holding the following security keys: PSIVMGR, PSIJ MGR, PSNMGR.
"PKG",517,22,1,"PAH",1,1,257,0)
    The message will contain a list of all orderable items that need to be 
"PKG",517,22,1,"PAH",1,1,258,0)
    cleaned up, as seen in the sample message below:
"PKG",517,22,1,"PAH",1,1,259,0)
   
"PKG",517,22,1,"PAH",1,1,260,0)
    Subj: Duplicate IV Solution Volume under same Orderable Item  [#215733]
"PKG",517,22,1,"PAH",1,1,261,0)
    From: PATCH PSS*1*189  In 'IN' basket.   Page 1
"PKG",517,22,1,"PAH",1,1,262,0)
    -------------------------------------------------------------------------
"PKG",517,22,1,"PAH",1,1,263,0)
    The list below shows IV Solutions in your database that need to be
"PKG",517,22,1,"PAH",1,1,264,0)
    cleaned up before patch PSS*1*189 can be installed.
"PKG",517,22,1,"PAH",1,1,265,0)
 
"PKG",517,22,1,"PAH",1,1,266,0)
    Rule: An Orderable Item can only have ONE IV solution with a specific
"PKG",517,22,1,"PAH",1,1,267,0)
          volume when it is marked to be used in the IV Order Dialog.
"PKG",517,22,1,"PAH",1,1,268,0)
 
"PKG",517,22,1,"PAH",1,1,269,0)
    Run Date/Time: Jun 12, 2015@09:49:16
"PKG",517,22,1,"PAH",1,1,270,0)
    -------------------------------------------------------------------------
"PKG",517,22,1,"PAH",1,1,271,0)
    ORDERABLE ITEM (IEN)
"PKG",517,22,1,"PAH",1,1,272,0)
          IV DISPENSE DRUG (IEN)
"PKG",517,22,1,"PAH",1,1,273,0)
             IV SOLUTION (IEN)
"PKG",517,22,1,"PAH",1,1,274,0)
    -------------------------------------------------------------------------
"PKG",517,22,1,"PAH",1,1,275,0)
    DEXTROSE (196)
"PKG",517,22,1,"PAH",1,1,276,0)
       Solution Volume: 1000 ML
"PKG",517,22,1,"PAH",1,1,277,0)
          DEXTROSE 10% IN WATER (620)
"PKG",517,22,1,"PAH",1,1,278,0)
             DEXTROSE 10%  (7)
"PKG",517,22,1,"PAH",1,1,279,0)
          DEXTROSE 5% IN 0.45% NS (623)
"PKG",517,22,1,"PAH",1,1,280,0)
             DEXTROSE 5% 1/2 NS (10)
"PKG",517,22,1,"PAH",1,1,281,0)
          DEXTROSE 5% 1000ML INJ (627)
"PKG",517,22,1,"PAH",1,1,282,0)
         5% DEXTROSE (1)
"PKG",517,22,1,"PAH",1,1,283,0)
 
"PKG",517,22,1,"PAH",1,1,284,0)
15. IV Solution Post-Install Automatic Clean-up (Post-install routine)
"PKG",517,22,1,"PAH",1,1,285,0)
    IV Solutions that are no longer used, meaning that either the IV
"PKG",517,22,1,"PAH",1,1,286,0)
    Solution and/or the Dispense Drug and/or the Orderable Item are marked
"PKG",517,22,1,"PAH",1,1,287,0)
    INACTIVE will have the field USED IN IV FLUID ORDER ENTRY set to 'NO'.
"PKG",517,22,1,"PAH",1,1,288,0)
    A list of such IV Solutions will be sent to all users holding the
"PKG",517,22,1,"PAH",1,1,289,0)
    following security keys: PSIVMGR, PSIJ MGR, PSNMGR. The message will
"PKG",517,22,1,"PAH",1,1,290,0)
    contain a list of all IV Solutions that have been automatically updated
"PKG",517,22,1,"PAH",1,1,291,0)
    as seen in the sample message below:
"PKG",517,22,1,"PAH",1,1,292,0)
 
"PKG",517,22,1,"PAH",1,1,293,0)
    Subj: Auto-update of the IV Solution file  [#216328] 08/18/15@09:58 
"PKG",517,22,1,"PAH",1,1,294,0)
    From: PATCH PSS*1*189  In 'IN' basket.   Page 1  *New*
"PKG",517,22,1,"PAH",1,1,295,0)
    -------------------------------------------------------------------------
"PKG",517,22,1,"PAH",1,1,296,0)
    The list below shows IV Solutions in your database that had the field
"PKG",517,22,1,"PAH",1,1,297,0)
    USED IN IV FLUID ORDER ENTRY set to 'NO' because either the Orderable
"PKG",517,22,1,"PAH",1,1,298,0)
    Item, the Dispense Drug or the IV Solution itself was marked INACTIVE.
"PKG",517,22,1,"PAH",1,1,299,0)
    
"PKG",517,22,1,"PAH",1,1,300,0)
    Run Date/Time: Aug 18, 2015@09:58:38
"PKG",517,22,1,"PAH",1,1,301,0)
    -------------------------------------------------------------------------
"PKG",517,22,1,"PAH",1,1,302,0)
    ORDERABLE ITEM (IEN)
"PKG",517,22,1,"PAH",1,1,303,0)
       IV DISPENSE DRUG (IEN)
"PKG",517,22,1,"PAH",1,1,304,0)
          IV SOLUTION (IEN/VOLUME)
"PKG",517,22,1,"PAH",1,1,305,0)
    -------------------------------------------------------------------------
"PKG",517,22,1,"PAH",1,1,306,0)
    CEFAZOLIN (106)
"PKG",517,22,1,"PAH",1,1,307,0)
       CEFAZOLIN SOD 1GM INJ (1498)
"PKG",517,22,1,"PAH",1,1,308,0)
          20% DEXTROSE (2/500 ML)   *** INACTIVE DATE: JAN 11, 1994 ***
"PKG",517,22,1,"PAH",1,1,309,0)
          20% DEXTROSE (11/500 ML)   *** INACTIVE DATE: JAN 11, 1994 ***
"PKG",517,22,1,"PAH",1,1,310,0)
 
"PKG",517,22,1,"PAH",1,1,311,0)
16. New API for CPRS: $$MAXDS^PSSUTIL1
"PKG",517,22,1,"PAH",1,1,312,0)
    This new API was created for CPRS to retrieve the Maximum Days Supply
"PKG",517,22,1,"PAH",1,1,313,0)
    value for a specific medication. This API is available to CPRS through
"PKG",517,22,1,"PAH",1,1,314,0)
    the Integration Control Registration (ICR) #3239. Below is a detailed 
"PKG",517,22,1,"PAH",1,1,315,0)
    description of the API.
"PKG",517,22,1,"PAH",1,1,316,0)
 
"PKG",517,22,1,"PAH",1,1,317,0)
       $$MAXDS^PSSUTIL1(INPUT)
"PKG",517,22,1,"PAH",1,1,318,0)
       This API accepts an array containing the Pharmacy Orderable Item
"PKG",517,22,1,"PAH",1,1,319,0)
       (required) and Dispense Drug (optional) and returns the maximum number
"PKG",517,22,1,"PAH",1,1,320,0)
       of Days Supply allowed to be dispensed for the specific medication.
"PKG",517,22,1,"PAH",1,1,321,0)
  
"PKG",517,22,1,"PAH",1,1,322,0)
       Parameters:
"PKG",517,22,1,"PAH",1,1,323,0)
       Input:  INPUT("PSOI") (Required)
"PKG",517,22,1,"PAH",1,1,324,0)
               Pointer to the PHARMACY ORDERABLE ITEM file (#50.7). 
"PKG",517,22,1,"PAH",1,1,325,0)
 
"PKG",517,22,1,"PAH",1,1,326,0)
               INPUT("DRUG") (Optional)
"PKG",517,22,1,"PAH",1,1,327,0)
               Pointer to the DRUG file (#50). This parameter is optional.
"PKG",517,22,1,"PAH",1,1,328,0)
               If not passed, the API will return the highest value from all
"PKG",517,22,1,"PAH",1,1,329,0)
               the dispense drugs linked to the Pharmacy Orderable Item.      
"PKG",517,22,1,"PAH",1,1,330,0)
    
"PKG",517,22,1,"PAH",1,1,331,0)
       Output $$MAXDS
"PKG",517,22,1,"PAH",1,1,332,0)
              Maximum number of days supply that can be dispensed for the
"PKG",517,22,1,"PAH",1,1,333,0)
              orderable item and/or dispense drug.
"PKG",517,22,1,"PAH",1,1,334,0)
 
"PKG",517,22,1,"PAH",1,1,335,0)
17. IV Additives and Solutions - Display "INACTIVATION DATE"
"PKG",517,22,1,"PAH",1,1,336,0)
  
"PKG",517,22,1,"PAH",1,1,337,0)
     The INACTIVATION DATE will display whenever a VistA lookup is done on
"PKG",517,22,1,"PAH",1,1,338,0)
     IV Additives and Solutions.
"PKG",517,22,1,"PAH",1,1,339,0)
  
"PKG",517,22,1,"PAH",1,1,340,0)
     This was accomplished by making the following two fields identifiers:
"PKG",517,22,1,"PAH",1,1,341,0)
  
"PKG",517,22,1,"PAH",1,1,342,0)
     FIELD NAME           FIELD NUMBER     FILE NAME/NUMBER
"PKG",517,22,1,"PAH",1,1,343,0)
     ----------------------------------------------------------
"PKG",517,22,1,"PAH",1,1,344,0)
     INACTIVATION DATE         12          IV ADDITIVES (#52.6)
"PKG",517,22,1,"PAH",1,1,345,0)
     INACTIVATION DATE          8          IV SOLUTIONS (#52.7)
"PKG",517,22,1,"PAH",1,1,346,0)
 
"PKG",517,22,1,"PAH",1,1,347,0)
 
"PKG",517,22,1,"PAH",1,1,348,0)
     Note: The following 'HELP'-PROMPT text will display for fields 8 & 12
"PKG",517,22,1,"PAH",1,1,349,0)
           "Enter the date this drug was inactivated.
"PKG",517,22,1,"PAH",1,1,350,0)
 
"PKG",517,22,1,"PAH",1,1,351,0)
 
"PKG",517,22,1,"PAH",1,1,352,0)
 
"PKG",517,22,1,"PAH",1,1,353,0)
       ********************* EXAMPLE(1) ADDITIVES *********************
"PKG",517,22,1,"PAH",1,1,354,0)
  
"PKG",517,22,1,"PAH",1,1,355,0)
 Inpatient Drug Management - Additives File [PSSJI DRUG] 
"PKG",517,22,1,"PAH",1,1,356,0)
  
"PKG",517,22,1,"PAH",1,1,357,0)
 Select Inpatient Drug Management Option: Additives File
"PKG",517,22,1,"PAH",1,1,358,0)
 Select IV ADDITIVES PRINT NAME: PIPERACILLIN
"PKG",517,22,1,"PAH",1,1,359,0)
  
"PKG",517,22,1,"PAH",1,1,360,0)
 Lookup: IV ADDITIVES  PRINT NAME
"PKG",517,22,1,"PAH",1,1,361,0)
  1   PIPERACILLIN/TAZOBACTAM              Additive Strength: 3.375 GM
"PKG",517,22,1,"PAH",1,1,362,0)
  2   PIPERACILLIN/TAZOBACTAM              Additive Strength: 2.25 GM 
"PKG",517,22,1,"PAH",1,1,363,0)
  3   PIPERACILLIN/TAZOBACTAM   03-5-2015  Additive Strength: 4.5 GM 
"PKG",517,22,1,"PAH",1,1,364,0)
  
"PKG",517,22,1,"PAH",1,1,365,0)
  
"PKG",517,22,1,"PAH",1,1,366,0)
      ********************* EXAMPLE(2) SOLUTIONS *********************
"PKG",517,22,1,"PAH",1,1,367,0)
  
"PKG",517,22,1,"PAH",1,1,368,0)
 Inpatient Drug Management - Primary Solution File (IV)
"PKG",517,22,1,"PAH",1,1,369,0)
  
"PKG",517,22,1,"PAH",1,1,370,0)
 Select Inpatient Drug Management Option: PRImary Solution File(IV) 
"PKG",517,22,1,"PAH",1,1,371,0)
 Select IV SOLUTIONS PRINT NAME: DEXTROSE 5% / NACL
"PKG",517,22,1,"PAH",1,1,372,0)
   Lookup: PRINT NAME
"PKG",517,22,1,"PAH",1,1,373,0)
      1   DEXTROSE 5% / NACL 0.2%       1000 ML                
"PKG",517,22,1,"PAH",1,1,374,0)
      2   DEXTROSE 5% / NACL 0.33%      1000 ML                
"PKG",517,22,1,"PAH",1,1,375,0)
      3   DEXTROSE 5% / NACL 0.45%      1000 ML   12-03-15     
"PKG",517,22,1,"PAH",1,1,376,0)
      4   DEXTROSE 5% / NACL 0.9%       1000 ML    
"PKG",517,22,1,"PAH",1,1,377,0)
                
"PKG",517,22,1,"PAH",1,1,378,0)
       ********************* END EXAMPLES ********************* 
"PRE")
PSS189EN
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
11
"RTN","PSS189EN")
0^^B30409440^n/a
"RTN","PSS189EN",1,0)
PSS189EN ;BHAM-ISC/MFR - Environment Check Routine for Patch PSS*1*189 ;07/26/06
"RTN","PSS189EN",2,0)
 ;;1.0;PHARMACY DATA MANAGEMENT;**189**;9/30/97;Build 54
"RTN","PSS189EN",3,0)
 ;
"RTN","PSS189EN",4,0)
EN ; Environemnt Check Routine Entry Point (PRODUCTION Environments only)
"RTN","PSS189EN",5,0)
 I $$PROD^XUPROD D
"RTN","PSS189EN",6,0)
 . N MSGBODY
"RTN","PSS189EN",7,0)
 . K ^TMP("PSS189EN",$J)
"RTN","PSS189EN",8,0)
 . D GATHER
"RTN","PSS189EN",9,0)
 . I $O(^TMP("PSS189EN",$J,0)) D  S XPDABORT=2
"RTN","PSS189EN",10,0)
 . . D MSG(.MSGBODY)
"RTN","PSS189EN",11,0)
 . . D MAIL(.MSGBODY)
"RTN","PSS189EN",12,0)
 . . D MES^XPDUTL("*****************************************************************************")
"RTN","PSS189EN",13,0)
 . . D MES^XPDUTL("***           THE INSTALLATION OF THIS PATCH CANNOT PROCEED               ***")
"RTN","PSS189EN",14,0)
 . . D MES^XPDUTL("*****************************************************************************")
"RTN","PSS189EN",15,0)
 . . D MES^XPDUTL("There are entries in the IV SOLUTIONS file (#52.7) that need to be cleaned up")
"RTN","PSS189EN",16,0)
 . . D MES^XPDUTL("before this patch can be installed. A Mailman message was sent to you and to")
"RTN","PSS189EN",17,0)
 . . D MES^XPDUTL("all users that hold one of the following security keys: PSIVMGR,PSJI MGR")
"RTN","PSS189EN",18,0)
 . . D MES^XPDUTL("and PSNMGR.")
"RTN","PSS189EN",19,0)
 . . D MES^XPDUTL("")
"RTN","PSS189EN",20,0)
 . . D MES^XPDUTL("Rule: An Orderable Item can only have ONE IV solution with a specific volume")
"RTN","PSS189EN",21,0)
 . . D MES^XPDUTL("      when it is marked to be used in the IV Fluid Order Dialog.")
"RTN","PSS189EN",22,0)
 . . D MES^XPDUTL("")
"RTN","PSS189EN",23,0)
 . . D MES^XPDUTL("Please, review and update the IV SOLUTIONS entries that need to be cleaned up")
"RTN","PSS189EN",24,0)
 . . D MES^XPDUTL("and try to install this patch again.")
"RTN","PSS189EN",25,0)
 . . D MES^XPDUTL("")
"RTN","PSS189EN",26,0)
 . . D MES^XPDUTL("For more information about the cleanup process please refer to the Patch")
"RTN","PSS189EN",27,0)
 . . D MES^XPDUTL("Description and the Release Notes document.")
"RTN","PSS189EN",28,0)
 . K ^TMP("PSS189EN",$J)
"RTN","PSS189EN",29,0)
 Q
"RTN","PSS189EN",30,0)
 ;
"RTN","PSS189EN",31,0)
GATHER ; Gathering IV Solution entries with the problem
"RTN","PSS189EN",32,0)
 N OI,IVSOL,IVVOL,IVDRUG,DUPSOL,DUPVOL,DUPDRUG
"RTN","PSS189EN",33,0)
 S IVSOL=0
"RTN","PSS189EN",34,0)
 F  S IVSOL=$O(^PS(52.7,IVSOL)) Q:'IVSOL  D
"RTN","PSS189EN",35,0)
 . ; Not used in the IV Dialog
"RTN","PSS189EN",36,0)
 . I '$$GET1^DIQ(52.7,IVSOL,17,"I") Q
"RTN","PSS189EN",37,0)
 . ; IV Solution is INACTIVE
"RTN","PSS189EN",38,0)
 . I $$GET1^DIQ(52.7,IVSOL,8,"I"),$$GET1^DIQ(52.7,IVSOL,8,"I")'>DT Q
"RTN","PSS189EN",39,0)
 . ; Pharmacy Orderable Item
"RTN","PSS189EN",40,0)
 . S OI=+$$GET1^DIQ(52.7,IVSOL,9,"I") I 'OI Q
"RTN","PSS189EN",41,0)
 . ; Pharmacy Orderable Item is INACTIVE
"RTN","PSS189EN",42,0)
 . I $$GET1^DIQ(50.7,OI,.04,"I") Q
"RTN","PSS189EN",43,0)
 . ; IV Dispense Drug
"RTN","PSS189EN",44,0)
 . S IVDRUG=$$GET1^DIQ(52.7,IVSOL,1,"I")
"RTN","PSS189EN",45,0)
 . ; Dispense Drug is INACTIVE
"RTN","PSS189EN",46,0)
 . I $$GET1^DIQ(50,IVDRUG,100,"I") Q
"RTN","PSS189EN",47,0)
 . ; IV Solution IVVOL
"RTN","PSS189EN",48,0)
 . S IVVOL=$$GET1^DIQ(52.7,IVSOL,2) I IVVOL="" Q
"RTN","PSS189EN",49,0)
 . ; No IV Solutions with same Volume and marked for IV Dialog found
"RTN","PSS189EN",50,0)
 . S DUPSOL=$$DUPSOL(OI,IVSOL,IVVOL,1) I 'DUPSOL Q
"RTN","PSS189EN",51,0)
 . ; Duplicate IV Dispense Drug
"RTN","PSS189EN",52,0)
 . S DUPDRUG=$$GET1^DIQ(52.7,DUPSOL,1,"I")
"RTN","PSS189EN",53,0)
 . ; Capturing the IV Solutions with issues
"RTN","PSS189EN",54,0)
 . S ^TMP("PSS189EN",$J,OI,IVVOL,IVDRUG,IVSOL)=""
"RTN","PSS189EN",55,0)
 . S ^TMP("PSS189EN",$J,OI,IVVOL,DUPDRUG,DUPSOL)=""
"RTN","PSS189EN",56,0)
 Q
"RTN","PSS189EN",57,0)
 ;
"RTN","PSS189EN",58,0)
DUPSOL(OI,IVSOL,IVVOL,SKPIN) ; Check if there's a Duplicate IV Solution Marked to be Used in the IV Order Dialog
"RTN","PSS189EN",59,0)
 ;  Input: OI    - PHARMACY ORDERABLE ITEM (#50.7) Pointer
"RTN","PSS189EN",60,0)
 ;         IVSOL - IV SOLUTIONS (#52.7) Pointer
"RTN","PSS189EN",61,0)
 ;         IVVOL - IV Solution Volume
"RTN","PSS189EN",62,0)
 ;         SKPIN - Skip Inactive? (1/0)
"RTN","PSS189EN",63,0)
 ;Output: DUPSOL - Duplicate IV SOLUTION (#52.7) Pointer (if any)
"RTN","PSS189EN",64,0)
 ;
"RTN","PSS189EN",65,0)
 N DUPSOL,OTHSOL,OTHVOL,OTHDRUG
"RTN","PSS189EN",66,0)
 S (DUPSOL,OTHSOL)=0
"RTN","PSS189EN",67,0)
 F  S OTHSOL=$O(^PS(52.7,"AOI",OI,OTHSOL)) Q:'OTHSOL!DUPSOL  D
"RTN","PSS189EN",68,0)
 . ; Cannot check against itself
"RTN","PSS189EN",69,0)
 . I (IVSOL=OTHSOL) Q
"RTN","PSS189EN",70,0)
 . ; Not Used in the IV Order Dialog
"RTN","PSS189EN",71,0)
 . I '$$GET1^DIQ(52.7,OTHSOL,17,"I") Q
"RTN","PSS189EN",72,0)
 . ; Other IV Solution is INACTIVE
"RTN","PSS189EN",73,0)
 . I $$GET1^DIQ(52.7,OTHSOL,8,"I"),$$GET1^DIQ(52.7,OTHSOL,8,"I")'>DT,SKPIN Q
"RTN","PSS189EN",74,0)
 . ; Other IV Dispense Drug
"RTN","PSS189EN",75,0)
 . S OTHDRUG=$$GET1^DIQ(52.7,OTHSOL,1,"I")
"RTN","PSS189EN",76,0)
 . ; Other Dispense Drug is INACTIVE
"RTN","PSS189EN",77,0)
 . I $$GET1^DIQ(50,OTHDRUG,100,"I"),SKPIN Q
"RTN","PSS189EN",78,0)
 . ; IV Solution Volume
"RTN","PSS189EN",79,0)
 . S OTHVOL=$$GET1^DIQ(52.7,OTHSOL,2)
"RTN","PSS189EN",80,0)
 . ; IV Solutions have different volumes
"RTN","PSS189EN",81,0)
 . I (IVVOL'=OTHVOL) Q
"RTN","PSS189EN",82,0)
 . ; Capturing the IV Solutions with issues
"RTN","PSS189EN",83,0)
 . S DUPSOL=OTHSOL
"RTN","PSS189EN",84,0)
 Q DUPSOL
"RTN","PSS189EN",85,0)
 ;
"RTN","PSS189EN",86,0)
MSG(MSGBODY) ; Creating the Mailman Message body
"RTN","PSS189EN",87,0)
 ;Input: MSGBODY - Array containing the list of duplicate IV Solutions for the Mailman message (passed by Reference)
"RTN","PSS189EN",88,0)
 N LN,OI,IVVOL,IVDRUG,IVSOL
"RTN","PSS189EN",89,0)
 D ADDLINE(.MSGBODY,"The list below shows IV Solutions in your database that need to be cleaned up")
"RTN","PSS189EN",90,0)
 D ADDLINE(.MSGBODY,"before patch PSS*1*189 can be installed.")
"RTN","PSS189EN",91,0)
 D ADDLINE(.MSGBODY,"")
"RTN","PSS189EN",92,0)
 D ADDLINE(.MSGBODY,"Rule: An Orderable Item can only have ONE IV solution with a specific volume")
"RTN","PSS189EN",93,0)
 D ADDLINE(.MSGBODY,"      when it is marked to be used in the IV Order Dialog.")
"RTN","PSS189EN",94,0)
 D ADDLINE(.MSGBODY,"")
"RTN","PSS189EN",95,0)
 ;
"RTN","PSS189EN",96,0)
 D ADDLINE(.MSGBODY,"Run Date/Time: "_$$FMTE^XLFDT($$NOW^XLFDT))
"RTN","PSS189EN",97,0)
 S $P(LN,"-",80)="" D ADDLINE(.MSGBODY,LN)
"RTN","PSS189EN",98,0)
 D ADDLINE(.MSGBODY,"ORDERABLE ITEM (IEN)")
"RTN","PSS189EN",99,0)
 D ADDLINE(.MSGBODY,"      IV DISPENSE DRUG (IEN)")
"RTN","PSS189EN",100,0)
 D ADDLINE(.MSGBODY,"         IV SOLUTION (IEN)")
"RTN","PSS189EN",101,0)
 S LN="",$P(LN,"-",80)="" D ADDLINE(.MSGBODY,LN)
"RTN","PSS189EN",102,0)
 ;
"RTN","PSS189EN",103,0)
 S (OI,IVVOL,IVDRUG,IVSOL)=""
"RTN","PSS189EN",104,0)
 F  S OI=$O(^TMP("PSS189EN",$J,OI)) Q:'OI  D
"RTN","PSS189EN",105,0)
 . D ADDLINE(.MSGBODY,$$GET1^DIQ(50.7,OI,.01)_" ("_OI_")")
"RTN","PSS189EN",106,0)
 . F  S IVVOL=$O(^TMP("PSS189EN",$J,OI,IVVOL)) Q:'IVVOL  D
"RTN","PSS189EN",107,0)
 . . D ADDLINE(.MSGBODY,"   Solution Volume: "_IVVOL)
"RTN","PSS189EN",108,0)
 . . F  S IVDRUG=$O(^TMP("PSS189EN",$J,OI,IVVOL,IVDRUG)) Q:'IVDRUG  D
"RTN","PSS189EN",109,0)
 . . . D ADDLINE(.MSGBODY,"      "_$$GET1^DIQ(50,+IVDRUG,.01)_" ("_IVDRUG_")")
"RTN","PSS189EN",110,0)
 . . . F  S IVSOL=$O(^TMP("PSS189EN",$J,OI,IVVOL,IVDRUG,IVSOL)) Q:'IVSOL  D
"RTN","PSS189EN",111,0)
 . . . . D ADDLINE(.MSGBODY,"         "_$$GET1^DIQ(52.7,IVSOL,.01)_" ("_IVSOL_")")
"RTN","PSS189EN",112,0)
 . D ADDLINE(.MSGBODY,"")
"RTN","PSS189EN",113,0)
 Q
"RTN","PSS189EN",114,0)
 ;
"RTN","PSS189EN",115,0)
MAIL(MSGTEXT) ; Compose/Send the Mailman message
"RTN","PSS189EN",116,0)
 ;Input: MSGTEXT - Complete Mailman Message Text array (passed by Reference)
"RTN","PSS189EN",117,0)
 N XMDUZ,XMSUB,XMY,XMTEXT,RECPT,SECKEY,DIFROM
"RTN","PSS189EN",118,0)
 S XMDUZ="Patch PSS*1*189",XMSUB="Duplicate IV Solution Volume under same Orderable Item"
"RTN","PSS189EN",119,0)
 ;
"RTN","PSS189EN",120,0)
 ; Sending the message to the holders of the PSIVMGR, PSJI MGR and PSNMGR security key + Patch installer
"RTN","PSS189EN",121,0)
 F SECKEY="PSIVMGR","PSJI MGR","PSNMGR" D
"RTN","PSS189EN",122,0)
 . S RECPT=0 F  S RECPT=$O(^XUSEC(SECKEY,RECPT)) Q:'RECPT  S XMY(RECPT)=""
"RTN","PSS189EN",123,0)
 S XMY(DUZ)=""
"RTN","PSS189EN",124,0)
 S XMTEXT="MSGTEXT(" D ^XMD
"RTN","PSS189EN",125,0)
 Q
"RTN","PSS189EN",126,0)
 ;
"RTN","PSS189EN",127,0)
ADDLINE(MSG,TXT) ; Adds a line to the Mailman Message Text
"RTN","PSS189EN",128,0)
 N LINE
"RTN","PSS189EN",129,0)
 S LINE=$O(MSG(99999),-1)+1,MSG(LINE)=TXT
"RTN","PSS189EN",130,0)
 Q
"RTN","PSS189PI")
0^^B23976606^n/a
"RTN","PSS189PI",1,0)
PSS189PI ;BHAM-ISC/MFR - Post-install Routine for Patch PSS*1*189 ;07/26/06
"RTN","PSS189PI",2,0)
 ;;1.0;PHARMACY DATA MANAGEMENT;**189**;9/30/97;Build 54
"RTN","PSS189PI",3,0)
 ;
"RTN","PSS189PI",4,0)
 ;Reference to ^PS(52.6 supported by DBIA #6338
"RTN","PSS189PI",5,0)
 ;Reference to ^PS(52.7 supported by DBIA #6339
"RTN","PSS189PI",6,0)
 ;
"RTN","PSS189PI",7,0)
EN ; Environemnt Check Routine Entry Point
"RTN","PSS189PI",8,0)
 N MSGBODY
"RTN","PSS189PI",9,0)
 K ^TMP("PSS189PI",$J)
"RTN","PSS189PI",10,0)
 D UPDATE
"RTN","PSS189PI",11,0)
 D MSG(.MSGBODY)
"RTN","PSS189PI",12,0)
 I $O(^TMP("PSS189PI",$J,0)) D MAIL(.MSGBODY)
"RTN","PSS189PI",13,0)
 K ^TMP("PSS189PI",$J)
"RTN","PSS189PI",14,0)
 ;
"RTN","PSS189PI",15,0)
 ;Set up identifier for 52.6 field 12
"RTN","PSS189PI",16,0)
 ;Set up identifier for 52.7 field 8
"RTN","PSS189PI",17,0)
 N TXT
"RTN","PSS189PI",18,0)
 S TXT="W:$G(^(""I"")) ""   "",$E($P(^(""I""),U,1),4,5)_""-""_$E($P(^(""I""),U,1),6,7)_""-""_$E($P(^(""I""),U,1),2,3)"
"RTN","PSS189PI",19,0)
 S ^DD(52.6,0,"ID",12)=TXT ;IV Additives
"RTN","PSS189PI",20,0)
 S ^DD(52.7,0,"ID",8)=TXT  ;IV Solutions
"RTN","PSS189PI",21,0)
 Q
"RTN","PSS189PI",22,0)
 ;
"RTN","PSS189PI",23,0)
UPDATE ; Updating the USED IN IV FLUID ORDER ENTRY field (Setting to 'NO' for no longer IV Solutions)
"RTN","PSS189PI",24,0)
 N OI,IVSOL,IVVOL,IVDRUG,OIINADT,DRGINADT,IVINADT
"RTN","PSS189PI",25,0)
 S IVSOL=0
"RTN","PSS189PI",26,0)
 F  S IVSOL=$O(^PS(52.7,IVSOL)) Q:'IVSOL  D
"RTN","PSS189PI",27,0)
 . ; Not used in the IV Dialog
"RTN","PSS189PI",28,0)
 . I '$$GET1^DIQ(52.7,IVSOL,17,"I") Q
"RTN","PSS189PI",29,0)
 . ; Pharmacy Orderable Item
"RTN","PSS189PI",30,0)
 . S OI=+$$GET1^DIQ(52.7,IVSOL,9,"I") I 'OI Q
"RTN","PSS189PI",31,0)
 . ; IV Dispense Drug
"RTN","PSS189PI",32,0)
 . S IVDRUG=$$GET1^DIQ(52.7,IVSOL,1,"I") I 'IVDRUG Q
"RTN","PSS189PI",33,0)
 . ; IV Solution IVVOL
"RTN","PSS189PI",34,0)
 . S IVVOL=$$GET1^DIQ(52.7,IVSOL,2) I IVVOL="" Q
"RTN","PSS189PI",35,0)
 . ; At least one of IV Solution OR Orderable Item OR Dispense Drug is INACTIVE
"RTN","PSS189PI",36,0)
 . S OIINADT=$$GET1^DIQ(50.7,OI,.04,"I"),DRGINADT=$$GET1^DIQ(50,IVDRUG,100,"I"),IVINADT=$$GET1^DIQ(52.7,IVSOL,8,"I")
"RTN","PSS189PI",37,0)
 . I (OIINADT&(OIINADT<DT))!(DRGINADT&(DRGINADT<DT))!(IVINADT&(IVINADT<DT)) D  Q
"RTN","PSS189PI",38,0)
 . . ; Setting USED IN THE IV FLUID ORDER ENTRY field to 'NO'
"RTN","PSS189PI",39,0)
 . . S $P(^PS(52.7,IVSOL,0),"^",13)=0
"RTN","PSS189PI",40,0)
 . . S ^TMP("PSS189PI",$J,OI,IVDRUG,IVSOL)=IVVOL
"RTN","PSS189PI",41,0)
 Q
"RTN","PSS189PI",42,0)
 ;
"RTN","PSS189PI",43,0)
DUPSOL(OI,IVSOL,IVVOL,SKPIN) ; Check if there's a Duplicate IV Solution Marked to be Used in the IV Order Dialog
"RTN","PSS189PI",44,0)
 ;  Input: OI    - PHARMACY ORDERABLE ITEM (#50.7) Pointer
"RTN","PSS189PI",45,0)
 ;         IVSOL - IV SOLUTIONS (#52.7) Pointer
"RTN","PSS189PI",46,0)
 ;         IVVOL - IV Solution Volume
"RTN","PSS189PI",47,0)
 ;         SKPIN - Skip Inactive? (1/0)
"RTN","PSS189PI",48,0)
 ;Output: DUPSOL - Duplicate IV SOLUTION (#52.7) Pointer (if any)
"RTN","PSS189PI",49,0)
 ;
"RTN","PSS189PI",50,0)
 N DUPSOL,OTHSOL,OTHVOL,OTHDRUG
"RTN","PSS189PI",51,0)
 S (DUPSOL,OTHSOL)=0
"RTN","PSS189PI",52,0)
 F  S OTHSOL=$O(^PS(52.7,"AOI",OI,OTHSOL)) Q:'OTHSOL!DUPSOL  D
"RTN","PSS189PI",53,0)
 . ; Cannot check against itself
"RTN","PSS189PI",54,0)
 . I (IVSOL=OTHSOL) Q
"RTN","PSS189PI",55,0)
 . ; Not Used in the IV Order Dialog
"RTN","PSS189PI",56,0)
 . I '$$GET1^DIQ(52.7,OTHSOL,17,"I") Q
"RTN","PSS189PI",57,0)
 . ; Other IV Solution is INACTIVE
"RTN","PSS189PI",58,0)
 . I SKPIN,$$GET1^DIQ(52.7,OTHSOL,8,"I"),$$GET1^DIQ(52.7,OTHSOL,8,"I")'>DT Q
"RTN","PSS189PI",59,0)
 . ; Other IV Dispense Drug
"RTN","PSS189PI",60,0)
 . S OTHDRUG=$$GET1^DIQ(52.7,OTHSOL,1,"I")
"RTN","PSS189PI",61,0)
 . ; Other Dispense Drug is INACTIVE
"RTN","PSS189PI",62,0)
 . I SKPIN,$$GET1^DIQ(50,OTHDRUG,100,"I"),$$GET1^DIQ(50,OTHDRUG,100,"I")'>DT Q
"RTN","PSS189PI",63,0)
 . ; IV Solution Volume
"RTN","PSS189PI",64,0)
 . S OTHVOL=$$GET1^DIQ(52.7,OTHSOL,2)
"RTN","PSS189PI",65,0)
 . ; IV Solutions have different volumes
"RTN","PSS189PI",66,0)
 . I (IVVOL'=OTHVOL) Q
"RTN","PSS189PI",67,0)
 . ; Capturing the IV Solutions with issues
"RTN","PSS189PI",68,0)
 . S DUPSOL=OTHSOL
"RTN","PSS189PI",69,0)
 Q DUPSOL
"RTN","PSS189PI",70,0)
 ;
"RTN","PSS189PI",71,0)
MSG(MSGBODY) ; Creating the Mailman Message body
"RTN","PSS189PI",72,0)
 N LN,OI,IVDRUG,IVSOL,DUPVOL
"RTN","PSS189PI",73,0)
 D ADDLINE(.MSGBODY,"The list below shows IV Solutions in your database that had the field")
"RTN","PSS189PI",74,0)
 D ADDLINE(.MSGBODY,"USED IN IV FLUID ORDER ENTRY set to 'NO' because either the Orderable")
"RTN","PSS189PI",75,0)
 D ADDLINE(.MSGBODY,"Item, the Dispense Drug or the IV Solution itself was marked INACTIVE.")
"RTN","PSS189PI",76,0)
 D ADDLINE(.MSGBODY,"")
"RTN","PSS189PI",77,0)
 ;
"RTN","PSS189PI",78,0)
 D ADDLINE(.MSGBODY,"Run Date/Time: "_$$FMTE^XLFDT($$NOW^XLFDT))
"RTN","PSS189PI",79,0)
 S $P(LN,"-",80)="" D ADDLINE(.MSGBODY,LN)
"RTN","PSS189PI",80,0)
 D ADDLINE(.MSGBODY,"ORDERABLE ITEM (IEN)")
"RTN","PSS189PI",81,0)
 S LN="   IV DISPENSE DRUG (IEN)" D ADDLINE(.MSGBODY,LN)
"RTN","PSS189PI",82,0)
 S LN="      IV SOLUTION (IEN/VOLUME)" D ADDLINE(.MSGBODY,LN)
"RTN","PSS189PI",83,0)
 S LN="",$P(LN,"-",80)="" D ADDLINE(.MSGBODY,LN)
"RTN","PSS189PI",84,0)
 ;
"RTN","PSS189PI",85,0)
 S (OI,IVDRUG,IVSOL)=""
"RTN","PSS189PI",86,0)
 F  S OI=$O(^TMP("PSS189PI",$J,OI)) Q:'OI  D
"RTN","PSS189PI",87,0)
 . D ADDLINE(.MSGBODY,$$GET1^DIQ(50.7,OI,.01)_" ("_OI_")"_$S($$GET1^DIQ(50.7,OI,.04,"I"):"   *** INACTIVE DATE: "_$$GET1^DIQ(50.7,OI,.04)_" ***",1:""))
"RTN","PSS189PI",88,0)
 . F  S IVDRUG=$O(^TMP("PSS189PI",$J,OI,IVDRUG)) Q:'IVDRUG  D
"RTN","PSS189PI",89,0)
 . . S LN="   "_$$GET1^DIQ(50,+IVDRUG,.01)_" ("_+IVDRUG_")"_$S($$GET1^DIQ(50,IVDRUG,100,"I"):"   *** INACTIVE DATE: "_$$GET1^DIQ(50,IVDRUG,100)_" ***",1:"")
"RTN","PSS189PI",90,0)
 . . D ADDLINE(.MSGBODY,LN)
"RTN","PSS189PI",91,0)
 . . F  S IVSOL=$O(^TMP("PSS189PI",$J,OI,IVDRUG,IVSOL)) Q:'IVSOL  D
"RTN","PSS189PI",92,0)
 . . . S DUPVOL=^TMP("PSS189PI",$J,OI,IVDRUG,IVSOL)
"RTN","PSS189PI",93,0)
 . . . S LN="      "_$$GET1^DIQ(52.7,+IVSOL,.01)_" ("_+IVSOL_"/"_DUPVOL_")"_$S($$GET1^DIQ(52.7,IVSOL,8,"I"):"   *** INACTIVE DATE: "_$$GET1^DIQ(52.7,IVSOL,8)_" ***",1:"")
"RTN","PSS189PI",94,0)
 . . . D ADDLINE(.MSGBODY,LN)
"RTN","PSS189PI",95,0)
 . D ADDLINE(.MSGBODY,"")
"RTN","PSS189PI",96,0)
 Q
"RTN","PSS189PI",97,0)
 ;
"RTN","PSS189PI",98,0)
MAIL(MSGTEXT) ; Compose/Send the Mailman message
"RTN","PSS189PI",99,0)
 N XMDUZ,XMSUB,XMY,XMTEXT,RECPT,SECKEY,DIFROM
"RTN","PSS189PI",100,0)
 S XMDUZ="Patch PSS*1*189",XMSUB="Auto-update of the IV Solution file"
"RTN","PSS189PI",101,0)
 ;
"RTN","PSS189PI",102,0)
 ; Sending the message to the holders of the PSIVMGR, PSJI MGR and PSNMGR security key + Patch installer
"RTN","PSS189PI",103,0)
 F SECKEY="PSIVMGR","PSJI MGR","PSNMGR" D
"RTN","PSS189PI",104,0)
 . S RECPT=0 F  S RECPT=$O(^XUSEC(SECKEY,RECPT)) Q:'RECPT  S XMY(RECPT)=""
"RTN","PSS189PI",105,0)
 S XMY(DUZ)=""
"RTN","PSS189PI",106,0)
 S XMTEXT="MSGTEXT(" D ^XMD
"RTN","PSS189PI",107,0)
 Q
"RTN","PSS189PI",108,0)
 ;
"RTN","PSS189PI",109,0)
ADDLINE(MSG,TXT) ; Adds a line to the Mailman Message Text
"RTN","PSS189PI",110,0)
 N LINE
"RTN","PSS189PI",111,0)
 S LINE=$O(MSG(99999),-1)+1,MSG(LINE)=TXT
"RTN","PSS189PI",112,0)
 Q
"RTN","PSSDDUT2")
0^3^B170893168^B103530932
"RTN","PSSDDUT2",1,0)
PSSDDUT2 ;BIR/LDT - Pharmacy Data Management DD Utility ;1/20/16 2:45pm
"RTN","PSSDDUT2",2,0)
 ;;1.0;PHARMACY DATA MANAGEMENT;**3,21,61,81,95,127,126,139,131,143,188,189**;9/30/97;Build 54
"RTN","PSSDDUT2",3,0)
 ;
"RTN","PSSDDUT2",4,0)
 ;Reference to ^DIC(42 supported by DBIA #10039
"RTN","PSSDDUT2",5,0)
 ;Reference to ^DD(59.723 supported by DBIA #2159
"RTN","PSSDDUT2",6,0)
 ;Reference to ^PSNDF(50.68 supported by DBIA 3735
"RTN","PSSDDUT2",7,0)
 ;
"RTN","PSSDDUT2",8,0)
DEA ;(Replaces ^PSODEA)
"RTN","PSSDDUT2",9,0)
 S PSSHLP(1)="THE SPECIAL HANDLING CODE IS A 2 TO 6 POSTION FIELD.  IF APPLICABLE,"
"RTN","PSSDDUT2",10,0)
 S PSSHLP(2)="A SCHEDULE CODE MUST APPEAR IN THE FIRST POSITION.  FOR EXAMPLE,"
"RTN","PSSDDUT2",11,0)
 S PSSHLP(3)="A SCHEDULE 3 NARCOTIC WILL BE CODED '3A', A SCHEDULE 3 NON-NARCOTIC WILL BE"
"RTN","PSSDDUT2",12,0)
 S PSSHLP(4)="CODED '3C' AND A SCHEDULE 2 DEPRESSANT WILL BE CODED '2L'."
"RTN","PSSDDUT2",13,0)
 S PSSHLP(5)="THE CODES ARE:"
"RTN","PSSDDUT2",14,0)
 D WRITE
"RTN","PSSDDUT2",15,0)
 F II=1:1 Q:$P($T(D+II),";",3)=""  S PSSHLP(II)=$P($T(D+II),";",3,99)
"RTN","PSSDDUT2",16,0)
 S PSSHLP(1,"F")="!!" D WRITE
"RTN","PSSDDUT2",17,0)
 D PKIND,WRITE
"RTN","PSSDDUT2",18,0)
D K II Q
"RTN","PSSDDUT2",19,0)
 ;;0          MANUFACTURED IN PHARMACY
"RTN","PSSDDUT2",20,0)
 ;;1          SCHEDULE 1 ITEM
"RTN","PSSDDUT2",21,0)
 ;;2          SCHEDULE 2 ITEM
"RTN","PSSDDUT2",22,0)
 ;;3          SCHEDULE 3 ITEM
"RTN","PSSDDUT2",23,0)
 ;;4          SCHEDULE 4 ITEM
"RTN","PSSDDUT2",24,0)
 ;;5          SCHEDULE 5 ITEM
"RTN","PSSDDUT2",25,0)
 ;;6          LEGEND ITEM
"RTN","PSSDDUT2",26,0)
 ;;9          OVER-THE-COUNTER
"RTN","PSSDDUT2",27,0)
 ;;L          DEPRESSANTS AND STIMULANTS
"RTN","PSSDDUT2",28,0)
 ;;A          NARCOTICS AND ALCOHOLS
"RTN","PSSDDUT2",29,0)
 ;;P          DATED DRUGS
"RTN","PSSDDUT2",30,0)
 ;;I          INVESTIGATIONAL DRUGS
"RTN","PSSDDUT2",31,0)
 ;;M          BULK COMPOUND ITEMS
"RTN","PSSDDUT2",32,0)
 ;;C          CONTROLLED SUBSTANCES - NON NARCOTIC
"RTN","PSSDDUT2",33,0)
 ;;R          RESTRICTED ITEMS
"RTN","PSSDDUT2",34,0)
 ;;S          SUPPLY ITEMS
"RTN","PSSDDUT2",35,0)
 ;;B          ALLOW REFILL (SCH. 3, 4, 5 ONLY)
"RTN","PSSDDUT2",36,0)
 ;;W          NOT RENEWABLE
"RTN","PSSDDUT2",37,0)
 ;;F          NON REFILLABLE
"RTN","PSSDDUT2",38,0)
 ;;E          ELECTRONICALLY BILLABLE
"RTN","PSSDDUT2",39,0)
 ;;N          NUTRITIONAL SUPPLEMENT
"RTN","PSSDDUT2",40,0)
 ;;U          SENSITIVE DRUG
"RTN","PSSDDUT2",41,0)
 ;;
"RTN","PSSDDUT2",42,0)
DEATBL ; More Help regarding DEA Codes
"RTN","PSSDDUT2",43,0)
 K PSSHLP
"RTN","PSSDDUT2",44,0)
 F II=1:1 Q:$P($T(TBL+II),";",3)=""  S PSSHLP(II)=$P($T(TBL+II),";",3,99)
"RTN","PSSDDUT2",45,0)
 S PSSHLP(1,"F")="!!" D WRITE
"RTN","PSSDDUT2",46,0)
 ;
"RTN","PSSDDUT2",47,0)
TBL K II Q
"RTN","PSSDDUT2",48,0)
 ;;          DEA CODE TABLE
"RTN","PSSDDUT2",49,0)
 ;; CODE   ALLOW RENEWS ALLOW REFILLS
"RTN","PSSDDUT2",50,0)
 ;; 1            NO           NO
"RTN","PSSDDUT2",51,0)
 ;; 2            NO           NO
"RTN","PSSDDUT2",52,0)
 ;; 2A           NO           NO 
"RTN","PSSDDUT2",53,0)
 ;; 3            YES          YES
"RTN","PSSDDUT2",54,0)
 ;; 3A           YES          NO
"RTN","PSSDDUT2",55,0)
 ;; 3AB          YES          YES
"RTN","PSSDDUT2",56,0)
 ;; 4            YES          YES
"RTN","PSSDDUT2",57,0)
 ;; 4A           YES          NO
"RTN","PSSDDUT2",58,0)
 ;; 4AB          YES          YES
"RTN","PSSDDUT2",59,0)
 ;; 5            YES          YES
"RTN","PSSDDUT2",60,0)
 ;; 5A           YES          NO
"RTN","PSSDDUT2",61,0)
 ;; 5AB          YES          YES
"RTN","PSSDDUT2",62,0)
 ;; ADDING W TO A SCHED. 3,4,OR 5 CODE DISALLOWS RENEWS.
"RTN","PSSDDUT2",63,0)
 ;; ADDING F TO A SCHED. 3,4,OR 5 CODE DISALLOWS REFILLS
"RTN","PSSDDUT2",64,0)
 ;; IF A CODE IS NOT LISTED IN THE ABOVE TABLE
"RTN","PSSDDUT2",65,0)
 ;; IT HAS NO EFFECT ON RENEW OR REFILL
"RTN","PSSDDUT2",66,0)
SIG ;checks SIG for RXs (Replaces SIG^PSOHELP)
"RTN","PSSDDUT2",67,0)
 I $E(X)=" " D EN^DDIOL("Leading spaces are not allowed in the SIG! ","","$C(7),!") K X Q
"RTN","PSSDDUT2",68,0)
SIGONE S SIG="" Q:$L(X)<1  F Z0=1:1:$L(X," ") G:Z0="" EN S Z1=$P(X," ",Z0) D  G:'$D(X) EN
"RTN","PSSDDUT2",69,0)
 .I $L(Z1)>32 D EN^DDIOL("MAX OF 32 CHARACTERS ALLOWED BETWEEN SPACES.","","$C(7),!?5") K X Q
"RTN","PSSDDUT2",70,0)
 .D:$D(X)&($G(Z1)]"")  S SIG=SIG_" "_Z1
"RTN","PSSDDUT2",71,0)
 ..S Y=$O(^PS(51,"B",Z1,0)) Q:'Y!($P($G(^PS(51,+Y,0)),"^",4)>1)  S Z1=$P(^PS(51,Y,0),"^",2) Q:'$D(^(9))  S Y=$P(X," ",Z0-1),Y=$E(Y,$L(Y)) S:Y>1 Z1=^(9)
"RTN","PSSDDUT2",72,0)
EN K Z1,Z0 ;S:$G(POERR) PSOERR("SIG")="("_$E(SIG,2,999999999)_")"
"RTN","PSSDDUT2",73,0)
 Q
"RTN","PSSDDUT2",74,0)
 ;
"RTN","PSSDDUT2",75,0)
DRUGW ;(Replaces DRUGW^PSOUTLA)
"RTN","PSSDDUT2",76,0)
 F Z0=1:1 Q:$P(X,",",Z0,99)=""  S Z1=$P(X,",",Z0) D:$D(^PS(54,Z1,0)) EN^DDIOL($P(^(0),"^"),"","!,?35") I '$D(^(0)) D EN^DDIOL("NO SUCH WARNING LABEL","","?35") K X Q
"RTN","PSSDDUT2",77,0)
 Q
"RTN","PSSDDUT2",78,0)
 ;
"RTN","PSSDDUT2",79,0)
P ;(Replaces ^PSODSRC)
"RTN","PSSDDUT2",80,0)
 S PSSHLP(1)="A TWO OR THREE POSITION CODE IDENTIFIES THE SOURCE OF SUPPLY AND WHETHER"
"RTN","PSSDDUT2",81,0)
 S PSSHLP(2)="THE DRUG IS STOCKED BY THE STATION SUPPLY DIVISION.  THE FIRST"
"RTN","PSSDDUT2",82,0)
 S PSSHLP(3)="POSITION OF THE CODE IDENTIFIES SOURCE OF SUPPLY.  THE CODES ARE:"
"RTN","PSSDDUT2",83,0)
 D WRITE
"RTN","PSSDDUT2",84,0)
 F II=0:1:10 S PSSHLP(II+1)=$P($T(S+II+1),";",3),PSSHLP(II+1,"F")="!?10"
"RTN","PSSDDUT2",85,0)
 S PSSHLP(1,"F")="!!?10"
"RTN","PSSDDUT2",86,0)
 D WRITE
"RTN","PSSDDUT2",87,0)
 S PSSHLP(1)="THE SECOND POSITION OF THE CODE INDICATES WHETHER THE ITEM IS"
"RTN","PSSDDUT2",88,0)
 S PSSHLP(2)="OR IS NOT AVAILABLE FROM SUPPLY WAREHOUSE STOCK.  THE CODES ARE:"
"RTN","PSSDDUT2",89,0)
 S PSSHLP(3)="P          POSTED STOCK"
"RTN","PSSDDUT2",90,0)
 S PSSHLP(3,"F")="!!?10"
"RTN","PSSDDUT2",91,0)
 S PSSHLP(4)="U          UNPOSTED"
"RTN","PSSDDUT2",92,0)
 S PSSHLP(4,"F")="!?10"
"RTN","PSSDDUT2",93,0)
 S PSSHLP(5)="M          BULK COMPOUND"
"RTN","PSSDDUT2",94,0)
 S PSSHLP(5,"F")="!?10"
"RTN","PSSDDUT2",95,0)
 S PSSHLP(6)="*  USE CODE 0 ONLY WITH SECOND POSITION M."
"RTN","PSSDDUT2",96,0)
 D WRITE Q
"RTN","PSSDDUT2",97,0)
 ;
"RTN","PSSDDUT2",98,0)
S ;;DESCRIPTION MEANINGS
"RTN","PSSDDUT2",99,0)
 ;;0          BULK COMPOUND ITEMS *
"RTN","PSSDDUT2",100,0)
 ;;1          VA SERVICING SUPPLY DEPOT
"RTN","PSSDDUT2",101,0)
 ;;2          OPEN MARKET
"RTN","PSSDDUT2",102,0)
 ;;3          GSA STORES DEPOT
"RTN","PSSDDUT2",103,0)
 ;;4          VA DECENTRALIZED CONTRACTS
"RTN","PSSDDUT2",104,0)
 ;;5          FEDERAL PRISON INDUSTRIES, INC.
"RTN","PSSDDUT2",105,0)
 ;;6          FEDERAL SUPPLY SCHEDULES
"RTN","PSSDDUT2",106,0)
 ;;7          VA SUPPLY DEPOT, HINES
"RTN","PSSDDUT2",107,0)
 ;;8          VA SUPPLY DEPOT, SOMERVILLE
"RTN","PSSDDUT2",108,0)
 ;;9          APPROPRIATE MARKETING DIVISION
"RTN","PSSDDUT2",109,0)
 ;;10         VA SUPPLY DEPOT, BELL
"RTN","PSSDDUT2",110,0)
EDIT ;INPUT XFORM FOR DEA FIELD IN DRUG FILE (Replaces EDIT^PSODEA)
"RTN","PSSDDUT2",111,0)
 I X["F",X["B" D EN^DDIOL("Inappropriate F designation!","","$C(7),!") K X Q
"RTN","PSSDDUT2",112,0)
 ;;DEA CHANGE PSS*1*126
"RTN","PSSDDUT2",113,0)
 I X["B",(+X<3) D EN^DDIOL("The B designation is only valid for schedule 3, 4, 5 !","","$C(7),!") K X Q
"RTN","PSSDDUT2",114,0)
 I X["A"&(X["C"),+X=2!(+X=3) D EN^DDIOL("The A & C designation is not valid for schedule 2 or 3 narcotics!","","$C(7),!") K X Q
"RTN","PSSDDUT2",115,0)
 I $E(X)=1,X[2!(X[3)!(X[4)!(X[5) D EN^DDIOL("It contains other inappropriate schedule 2-5 narcotics!","","$C(7),!") K X Q
"RTN","PSSDDUT2",116,0)
 I $E(X)=2,X[1!(X[3)!(X[4)!(X[5) D EN^DDIOL("It contains other inappropriate schedule 1,3-5 narcotics!","","$C(7),!") K X Q
"RTN","PSSDDUT2",117,0)
 I $E(X)=3,X[1!(X[2)!(X[4)!(X[5) D EN^DDIOL("It contains other inappropriate schedule 1-2,4-5 narcotics!","","$C(7),!") K X Q
"RTN","PSSDDUT2",118,0)
 I $E(X)=4,X[1!(X[2)!(X[3)!(X[5) D EN^DDIOL("It contains other inappropriate schedule 1-3,5 narcotics!","","$C(7),!") K X Q
"RTN","PSSDDUT2",119,0)
 I $E(X)=5,X[1!(X[2)!(X[3)!(X[4) D EN^DDIOL("It contains other inappropriate schedule 1-4 narcotics!","","$C(7),!") K X Q
"RTN","PSSDDUT2",120,0)
 I $E(X)="E" D EN^DDIOL("Inappropriate E designation! Can only modify other codes.","","$C(7),!") K X Q
"RTN","PSSDDUT2",121,0)
 Q
"RTN","PSSDDUT2",122,0)
 ;
"RTN","PSSDDUT2",123,0)
WRITE ;Calls EN^DDIOL to write text
"RTN","PSSDDUT2",124,0)
 D EN^DDIOL(.PSSHLP) K PSSHLP
"RTN","PSSDDUT2",125,0)
 Q
"RTN","PSSDDUT2",126,0)
 ;
"RTN","PSSDDUT2",127,0)
PKIND I +$P($G(^PSDRUG(DA,"ND")),"^",3) S PSSK=$P(^("ND"),"^",3) D
"RTN","PSSDDUT2",128,0)
 .S PSSK=$$GET1^DIQ(50.68,PSSK,19,"I") I PSSK S PSSK=$$CSDEA^PSSDDUT2(PSSK) D
"RTN","PSSDDUT2",129,0)
 ..I $L(PSSK)=1,$P(^PSDRUG(DA,0),"^",3)[PSSK Q
"RTN","PSSDDUT2",130,0)
 ..I $P(^PSDRUG(DA,0),"^",3)[$E(PSSK),$P(^PSDRUG(DA,0),"^",3)[$E(PSSK,2) Q
"RTN","PSSDDUT2",131,0)
 ..W !!,"The CS Federal Schedule associated with this drug in the VA Product file"
"RTN","PSSDDUT2",132,0)
 ..W !,"represents a DEA, Special Handling code of "_PSSK
"RTN","PSSDDUT2",133,0)
 Q
"RTN","PSSDDUT2",134,0)
 ;
"RTN","PSSDDUT2",135,0)
CSDEA(CS) ;
"RTN","PSSDDUT2",136,0)
 Q:'CS ""
"RTN","PSSDDUT2",137,0)
 Q $S(CS?1(1"2n",1"3n"):+CS_"C",+CS=2!(+CS=3)&(CS'["C"):+CS_"A",1:CS)
"RTN","PSSDDUT2",138,0)
 ;
"RTN","PSSDDUT2",139,0)
CLOZ ;DEL node of DRUG file 50, fields 17.2, 17.3, 17.4
"RTN","PSSDDUT2",140,0)
 S PSSHLP(1)="To delete this field use the Unmark Clozapine Drug option in the"
"RTN","PSSDDUT2",141,0)
 S PSSHLP(2)="Clozapine Pharmacy Manager menu."
"RTN","PSSDDUT2",142,0)
 D WRITE
"RTN","PSSDDUT2",143,0)
 Q
"RTN","PSSDDUT2",144,0)
 ;
"RTN","PSSDDUT2",145,0)
NONF ;Non-Formulary Input Transform DRUG file 50, field 51
"RTN","PSSDDUT2",146,0)
 S PSSHLP(1)="This drug cannot be marked as a non-formulary item because it is"
"RTN","PSSDDUT2",147,0)
 S PSSHLP(2)="designated as a formulary alternative for the following drugs."
"RTN","PSSDDUT2",148,0)
 S PSSHLP(3)=" ",PSSHLP(1,"F")="!!"
"RTN","PSSDDUT2",149,0)
 D WRITE
"RTN","PSSDDUT2",150,0)
 F MM=0:0 S MM=$O(^PSDRUG("AFA",DA,MM)) Q:'MM  S SHEMP=$P(^PSDRUG(MM,0),"^") D EN^DDIOL(SHEMP,"","!?3")
"RTN","PSSDDUT2",151,0)
 S X=""
"RTN","PSSDDUT2",152,0)
 Q
"RTN","PSSDDUT2",153,0)
 ;
"RTN","PSSDDUT2",154,0)
ATC ;Executable help for field 212.2, DRUG file 50
"RTN","PSSDDUT2",155,0)
 S PSSHLP(1)="The mnemonic entered here must match the mnemonic entered into the"
"RTN","PSSDDUT2",156,0)
 S PSSHLP(2)="ATC for this drug EXACTLY, and cannot be numbers only."
"RTN","PSSDDUT2",157,0)
 D WRITE
"RTN","PSSDDUT2",158,0)
 Q
"RTN","PSSDDUT2",159,0)
 ;
"RTN","PSSDDUT2",160,0)
ADTM ;ADMINISTRATION SCHEDULE file 51.1, field 1 Executable Help
"RTN","PSSDDUT2",161,0)
 S PSSHLP(1)="All times must be the same length (2 or 4 characters), must be"
"RTN","PSSDDUT2",162,0)
 S PSSHLP(2)="separated by dashes ('-'), and be in ascending order"
"RTN","PSSDDUT2",163,0)
 S PSSHLP(3)=""
"RTN","PSSDDUT2",164,0)
 S PSSHLP(4)="This is the set of administration times for this Schedule."
"RTN","PSSDDUT2",165,0)
 S PSSHLP(5)=""
"RTN","PSSDDUT2",166,0)
 S PSSHLP(6)="If the Schedule Type is CONTINUOUS the number of administration"
"RTN","PSSDDUT2",167,0)
 S PSSHLP(7)="times cannot conflict with the frequency of the schedule.  For"
"RTN","PSSDDUT2",168,0)
 S PSSHLP(8)="example, a schedule frequency of 720 minutes must have two"
"RTN","PSSDDUT2",169,0)
 S PSSHLP(9)="administration times and a schedule frequency of 360 must have a"
"RTN","PSSDDUT2",170,0)
 S PSSHLP(10)="four administration times."
"RTN","PSSDDUT2",171,0)
 S PSSHLP(11)=""
"RTN","PSSDDUT2",172,0)
 S PSSHLP(12)="If the Schedule Type is CONTINUOUS and is an Odd Schedule (A"
"RTN","PSSDDUT2",173,0)
 S PSSHLP(13)="schedule whose frequency is not evenly divisible by or into"
"RTN","PSSDDUT2",174,0)
 S PSSHLP(14)="1440 minutes or 1 day). Administration Times are not allowed."
"RTN","PSSDDUT2",175,0)
 S PSSHLP(15)="For example Q5H, Q17H - these are not evenly divisible by 1440."
"RTN","PSSDDUT2",176,0)
 S PSSHLP(16)=""
"RTN","PSSDDUT2",177,0)
 S PSSHLP(17)="If the Schedule Type is CONTINUOUS with a non-odd frequency of"
"RTN","PSSDDUT2",178,0)
 S PSSHLP(18)="greater than of 1 day (1440 minutes) then more than one"
"RTN","PSSDDUT2",179,0)
 S PSSHLP(19)="administration time is not allowed.  For example schedules of"
"RTN","PSSDDUT2",180,0)
 S PSSHLP(20)="Q72H, Q3Day, and Q5Day."
"RTN","PSSDDUT2",181,0)
 D WRITE
"RTN","PSSDDUT2",182,0)
 Q
"RTN","PSSDDUT2",183,0)
 ;
"RTN","PSSDDUT2",184,0)
LBLS ;PHARMACY SYSTEM file 59.7, field 61.2 Executable Help
"RTN","PSSDDUT2",185,0)
 S PSSHLP(1)="ANY NEW LABELS OLDER THAN THE NUMBER OF DAYS SPECIFIED HERE WILL"
"RTN","PSSDDUT2",186,0)
 S PSSHLP(2)="AUTOMATICALLY BE PURGED."
"RTN","PSSDDUT2",187,0)
 D WRITE
"RTN","PSSDDUT2",188,0)
 Q
"RTN","PSSDDUT2",189,0)
NFH I '$D(DA(1)) D EN^DDIOL(" (This non-formulary item is "_$P(^PSDRUG($S($D(DA(1)):DA(1),1:DA),0),"^")_".)")
"RTN","PSSDDUT2",190,0)
 Q
"RTN","PSSDDUT2",191,0)
STRTH S STR=" "_$P(X," ",2),PSSHLP(1)=STR,PSSHLP(1,"F")="" D WRITE K STR
"RTN","PSSDDUT2",192,0)
 Q
"RTN","PSSDDUT2",193,0)
PSYS1 D EN^DDIOL("(""From"" ward is "_$S('$D(^PS(59.7,D0,22,D1,0)):"UNKNOWN",'$D(^DIC(42,+^(0),0)):"UNKNOWN",$P(^(0),"^")]"":$P(^(0),"^"),1:"UNKNOWN")_")","","!?3")
"RTN","PSSDDUT2",194,0)
 Q
"RTN","PSSDDUT2",195,0)
PSYS2 ;PSS*1.0*95
"RTN","PSSDDUT2",196,0)
 D EN^DDIOL("(""From"" service is "_$S('$D(^PS(59.7,D0,23,D1,0)):"UNKNOWN",$P(^(0),"^")]"":$P($P(";"_$P(^DD(59.723,.01,0),"^",3),";"_$P(^PS(59.7,D0,23,D1,0),"^")_":",2),";"),1:"UNKNOWN")_")")
"RTN","PSSDDUT2",197,0)
 Q
"RTN","PSSDDUT2",198,0)
 ;
"RTN","PSSDDUT2",199,0)
NCINIT ;
"RTN","PSSDDUT2",200,0)
 K PSSNQM,PSSNQM2,PSSNQM3,PSSONDU,PSSONQM
"RTN","PSSDDUT2",201,0)
NCINIT1 ;
"RTN","PSSDDUT2",202,0)
 I $P($G(^PSDRUG(DA,"EPH")),"^",2)="" S $P(^PSDRUG(DA,"EPH"),"^",2)="EA",$P(^PSDRUG(DA,"EPH"),"^",3)=1 D
"RTN","PSSDDUT2",203,0)
 . S PSSHLP(1)="  Note:     Defaulting the NCPDP DISPENSE UNIT to EACH and the"
"RTN","PSSDDUT2",204,0)
 . S PSSHLP(2)="            NCPDP QUANTITY MULTIPLIER to 1 (one)." S PSSHLP(1,"F")="!!"
"RTN","PSSDDUT2",205,0)
 . D WRITE S PSSHLP(2,"F")="!" D WRITE
"RTN","PSSDDUT2",206,0)
 S PSSONDU=$P(^PSDRUG(DA,"EPH"),"^",2),PSSONQM=$P(^PSDRUG(DA,"EPH"),"^",3)
"RTN","PSSDDUT2",207,0)
 Q
"RTN","PSSDDUT2",208,0)
 ;
"RTN","PSSDDUT2",209,0)
NCPDPDU ;Drug file 50, field 82
"RTN","PSSDDUT2",210,0)
 S:X="" X="EA"
"RTN","PSSDDUT2",211,0)
 D NCINIT1:'$D(PSSONDU)
"RTN","PSSDDUT2",212,0)
 I $G(PSSONDU)'=X&($G(PSSONQM)'=1) D
"RTN","PSSDDUT2",213,0)
 . S PSSHLP(1)="Defaulting the NCPDP QUANTITY MULTIPLIER to 1 (one)." S PSSHLP(1,"F")="!!" D WRITE
"RTN","PSSDDUT2",214,0)
 . S $P(^PSDRUG(DA,"EPH"),"^",3)=1,PSSONDU=$P(^PSDRUG(DA,"EPH"),"^",2),PSSONQM=$P(^PSDRUG(DA,"EPH"),"^",3)
"RTN","PSSDDUT2",215,0)
 Q
"RTN","PSSDDUT2",216,0)
 ;
"RTN","PSSDDUT2",217,0)
NCPDPQM ;Drug file 50, field 83
"RTN","PSSDDUT2",218,0)
 N ZXX S PSSNQM=0,(PSSNQM2,PSSNQM3)=""
"RTN","PSSDDUT2",219,0)
 I $G(X)<.00001 K X S PSSNQM3=1 Q
"RTN","PSSDDUT2",220,0)
 S:$G(X)="" X=1
"RTN","PSSDDUT2",221,0)
 I +$G(X)'=1 D NCPDPWRN D
"RTN","PSSDDUT2",222,0)
NCPDPQM1 . ;
"RTN","PSSDDUT2",223,0)
 . R !,"Ok to continue? (Y/N) ",ZXX:30 S ZXX=$TR(ZXX,"yn","YN")
"RTN","PSSDDUT2",224,0)
 . I ZXX="^" S X=1 W !!?5,"Warning:  Defaulting NCPDP QUANTITY MULTIPLIER to 1 (one).",!! Q
"RTN","PSSDDUT2",225,0)
 . I ZXX'="Y"&(ZXX'="N") W !,"Y or N must be entered." G NCPDPQM1
"RTN","PSSDDUT2",226,0)
 . I ZXX'="Y"&(ZXX'="y") S PSSNQM=1,PSSNQM2=X K X
"RTN","PSSDDUT2",227,0)
 Q
"RTN","PSSDDUT2",228,0)
 ;
"RTN","PSSDDUT2",229,0)
NCPDPWRN ;Message called from NCPDPQM
"RTN","PSSDDUT2",230,0)
 S PSSHLP(2)="WARNING:    For most drug products, the value for this field should be 1 (one)."
"RTN","PSSDDUT2",231,0)
 S PSSHLP(3)="            Answering NO for the following prompt will display more information"
"RTN","PSSDDUT2",232,0)
 S PSSHLP(4)="            on how this field is used."
"RTN","PSSDDUT2",233,0)
 S PSSHLP(2,"F")="!!" D WRITE
"RTN","PSSDDUT2",234,0)
 S PSSHLP(5,"F")="!" D WRITE
"RTN","PSSDDUT2",235,0)
 Q
"RTN","PSSDDUT2",236,0)
 ;
"RTN","PSSDDUT2",237,0)
MXDAYSUP ; INPUT TRANSFORM for Drug file (#50), MAXIMUM DAYS SUPPLY Field (#66)
"RTN","PSSDDUT2",238,0)
 ; Input: X  - Maximum Days Supply Entered by user
"RTN","PSSDDUT2",239,0)
 ;        DA - DRUG file (#50) IEN
"RTN","PSSDDUT2",240,0)
 Q:'$D(^PSDRUG(+$G(DA),0))
"RTN","PSSDDUT2",241,0)
 S X=+$G(X)
"RTN","PSSDDUT2",242,0)
 ; - DAY SUPPLY must be between 1 and 365 (inclusive)
"RTN","PSSDDUT2",243,0)
 I (X<1)!(X>365) D  Q
"RTN","PSSDDUT2",244,0)
 . D EN^DDIOL("Type a number between 1 and 365, 0 decimal digits.","","!!") K X W !
"RTN","PSSDDUT2",245,0)
 ;
"RTN","PSSDDUT2",246,0)
 ; - Checking against NDF Maximum
"RTN","PSSDDUT2",247,0)
 N VAPRDIEN S VAPRDIEN=+$$GET1^DIQ(50,DA,22,"I")
"RTN","PSSDDUT2",248,0)
 I VAPRDIEN D  I '$D(X) Q
"RTN","PSSDDUT2",249,0)
 . N NDFMAXDS
"RTN","PSSDDUT2",250,0)
 . S NDFMAXDS=$$GET1^DIQ(50.68,VAPRDIEN,32)
"RTN","PSSDDUT2",251,0)
 . I NDFMAXDS,NDFMAXDS<X D
"RTN","PSSDDUT2",252,0)
 . . D EN^DDIOL("Cannot be greater than NDF Maximum Days Supply: "_NDFMAXDS,"","!!") K X W !
"RTN","PSSDDUT2",253,0)
 ;
"RTN","PSSDDUT2",254,0)
 ; - Controlled Substances have different upper limits (not 365)
"RTN","PSSDDUT2",255,0)
 N DEASPHLG S DEASPHLG=$$GET1^DIQ(50,DA,3)
"RTN","PSSDDUT2",256,0)
 I DEASPHLG["2",X>30 D  Q
"RTN","PSSDDUT2",257,0)
 . D EN^DDIOL("Schedule 2 controlled substances have a maximum days supply limit of 30 days","","!!") K X W !
"RTN","PSSDDUT2",258,0)
 I (DEASPHLG["3")!(DEASPHLG["4")!(DEASPHLG["5"),X>90 D  Q
"RTN","PSSDDUT2",259,0)
 . D EN^DDIOL("Schedule 3-5 controlled substances have a maximum days supply limit of 90 days","","!!") K X W !
"RTN","PSSDDUT2",260,0)
 ;
"RTN","PSSDDUT2",261,0)
 ; - Clozapine Drug (Not controlled by this field)
"RTN","PSSDDUT2",262,0)
 I ($P($G(^PSDRUG(DA,"CLOZ1")),"^")="PSOCLO1") D  Q
"RTN","PSSDDUT2",263,0)
 . D EN^DDIOL("Maximum Days Supply for this drug is controlled by the Clozapine functionality","","!!") K X W !
"RTN","PSSDDUT2",264,0)
 ;
"RTN","PSSDDUT2",265,0)
 I X<$$MXDAYSUP^PSSUTIL1(DA) D
"RTN","PSSDDUT2",266,0)
 . W ! D EN^DDIOL("Note: Decreasing the MAXIMUM DAYS SUPPLY field will only affect new","","!")
"RTN","PSSDDUT2",267,0)
 . D EN^DDIOL("      prescriptions, including renewals and copies. Orders that are pending","","!")
"RTN","PSSDDUT2",268,0)
 . D EN^DDIOL("      or unreleased when the MAXIMUM DAYS SUPPLY field is decreased are not","","!")
"RTN","PSSDDUT2",269,0)
 . D EN^DDIOL("      affected by the decrease, so prescriptions with a DAYS SUPPLY above the","","!")
"RTN","PSSDDUT2",270,0)
 . D EN^DDIOL("      new MAXIMUM DAYS SUPPLY may need to be edited manually before they are","","!")
"RTN","PSSDDUT2",271,0)
 . D EN^DDIOL("      finished or released.","","!")
"RTN","PSSDDUT2",272,0)
 . W ! N DIR,X,Y S DIR(0)="E",DIR("A")="Press Return to continue" D ^DIR
"RTN","PSSDDUT2",273,0)
 Q
"RTN","PSSDDUT2",274,0)
 ;
"RTN","PSSDDUT2",275,0)
IVSOLVOL ; IV Solution VOLUME field INPUT TRANSFORM
"RTN","PSSDDUT2",276,0)
 N OI
"RTN","PSSDDUT2",277,0)
 I X[""""!($A(X)=45)!(X'?.N0.1".".N)!(X>9999)!(X<.01) K X Q
"RTN","PSSDDUT2",278,0)
 I $$GET1^DIQ(52.7,DA,17,"I") S OI=+$$GET1^DIQ(52.7,DA,9,"I") I $$CKDUPSOL(OI,DA,+X,1) K X Q
"RTN","PSSDDUT2",279,0)
 S X=X_" ML" D EN^DDIOL(" ML","","?0")
"RTN","PSSDDUT2",280,0)
 Q
"RTN","PSSDDUT2",281,0)
 ;
"RTN","PSSDDUT2",282,0)
UIVFOE ; USED IN THE IV FLUID ORDER ENTRY field INPUT TRANSFORM
"RTN","PSSDDUT2",283,0)
 I X D
"RTN","PSSDDUT2",284,0)
 . N OI
"RTN","PSSDDUT2",285,0)
 . S OI=$$GET1^DIQ(52.7,DA,9,"I") I $$CKDUPSOL(OI,DA,+$$GET1^DIQ(52.7,DA,2),1) K X
"RTN","PSSDDUT2",286,0)
 Q
"RTN","PSSDDUT2",287,0)
 ;
"RTN","PSSDDUT2",288,0)
CKDUPSOL(OI,IVSOL,IVVOL,DSPMSG) ; Check if there's an ACTIVE Duplicate IV Solution Marked to be Used in the IV Order Dialog
"RTN","PSSDDUT2",289,0)
 ; Input: OI     - PHARMACY ORDERABLE ITEM (#50.7) Pointer
"RTN","PSSDDUT2",290,0)
 ;        IVSOL  - IV SOLUTIONS (#52.7) Pointer
"RTN","PSSDDUT2",291,0)
 ;        IVVOL  - IV Solution Volume
"RTN","PSSDDUT2",292,0)
 ;        DSPMSG - Display Message? (1:Yes/0:No)
"RTN","PSSDDUT2",293,0)
 ;Output: DUPSOL - Duplicate IV Solution IEN
"RTN","PSSDDUT2",294,0)
 N DUPSOL,OTHSOL,OTHVOL,DRUG
"RTN","PSSDDUT2",295,0)
 S (DUPSOL,OTHSOL)=0
"RTN","PSSDDUT2",296,0)
 ;
"RTN","PSSDDUT2",297,0)
 ; Invalid IV Solution
"RTN","PSSDDUT2",298,0)
 I '$D(^PS(52.7,+$G(IVSOL),0)) Q 0
"RTN","PSSDDUT2",299,0)
 ;
"RTN","PSSDDUT2",300,0)
 ; IV Solution is INACTIVE, no issues
"RTN","PSSDDUT2",301,0)
 I $$GET1^DIQ(52.7,IVSOL,8,"I"),$$GET1^DIQ(52.7,IVSOL,8,"I")'>DT Q 0
"RTN","PSSDDUT2",302,0)
 ;
"RTN","PSSDDUT2",303,0)
 ; Dispense Drug might not be matched to an Orderable Item yet
"RTN","PSSDDUT2",304,0)
 S DRUG=+$$GET1^DIQ(52.7,IVSOL,1,"I")
"RTN","PSSDDUT2",305,0)
 ;
"RTN","PSSDDUT2",306,0)
 I +$G(OI) D
"RTN","PSSDDUT2",307,0)
 . F  S OTHSOL=$O(^PS(52.7,"AOI",OI,OTHSOL)) Q:'OTHSOL!DUPSOL  D
"RTN","PSSDDUT2",308,0)
 . . I $$DUPVOL(IVSOL,OTHSOL) S DUPSOL=OTHSOL
"RTN","PSSDDUT2",309,0)
 E  D
"RTN","PSSDDUT2",310,0)
 . F  S OTHSOL=$O(^PS(52.7,"AC",DRUG,OTHSOL)) Q:'OTHSOL!DUPSOL  D
"RTN","PSSDDUT2",311,0)
 . . I $$DUPVOL(IVSOL,OTHSOL) S DUPSOL=OTHSOL
"RTN","PSSDDUT2",312,0)
 I $G(DSPMSG),DUPSOL D
"RTN","PSSDDUT2",313,0)
 . W !!,"The following IV Solution with the same volume is already linked to"
"RTN","PSSDDUT2",314,0)
 . W:$G(OI) !,"the Orderable Item ",$$GET1^DIQ(50.7,OI,.01)
"RTN","PSSDDUT2",315,0)
 . W:'$G(OI) !,"this dispense drug."
"RTN","PSSDDUT2",316,0)
 . W !
"RTN","PSSDDUT2",317,0)
 . W:$G(OI) !,"Dispense Drug: ",$$GET1^DIQ(52.7,DUPSOL,1)
"RTN","PSSDDUT2",318,0)
 . W !,"  IV Solution: ",$$GET1^DIQ(52.7,DUPSOL,.01)
"RTN","PSSDDUT2",319,0)
 . W !
"RTN","PSSDDUT2",320,0)
 . W !,"Only one Active IV Solution with a specific volume can be linked to an"
"RTN","PSSDDUT2",321,0)
 . W !,"Orderable Item or Dispense Drug when the IV Solution is marked to be used"
"RTN","PSSDDUT2",322,0)
 . W !,"in the CPRS IV Fluid Order Entry."
"RTN","PSSDDUT2",323,0)
 . W !,$C(7)
"RTN","PSSDDUT2",324,0)
 Q DUPSOL
"RTN","PSSDDUT2",325,0)
 ;
"RTN","PSSDDUT2",326,0)
DUPVOL(IVSOL1,IVSOL2) ; Check 2 IV Solutions to see if they have Duplicate Volumes
"RTN","PSSDDUT2",327,0)
 ; Cannot check against itself
"RTN","PSSDDUT2",328,0)
 I (IVSOL1=IVSOL2) Q 0
"RTN","PSSDDUT2",329,0)
 ; Not Used in the IV Order Dialog
"RTN","PSSDDUT2",330,0)
 I '$$GET1^DIQ(52.7,IVSOL2,17,"I") Q 0
"RTN","PSSDDUT2",331,0)
 ; Other IV Solution is INACTIVE
"RTN","PSSDDUT2",332,0)
 I $$GET1^DIQ(52.7,IVSOL2,8,"I"),$$GET1^DIQ(52.7,IVSOL2,8,"I")'>DT Q 0
"RTN","PSSDDUT2",333,0)
 ; IV Solution Volume
"RTN","PSSDDUT2",334,0)
 S OTHVOL=$$GET1^DIQ(52.7,IVSOL2,2)
"RTN","PSSDDUT2",335,0)
 ; IV Solutions have different volumes
"RTN","PSSDDUT2",336,0)
 I (+IVVOL'=+OTHVOL) Q 0
"RTN","PSSDDUT2",337,0)
 ; Capturing the Duplicate IV Solution IEN
"RTN","PSSDDUT2",338,0)
 Q 1
"RTN","PSSJSV")
0^8^B76380719^B76380727
"RTN","PSSJSV",1,0)
PSSJSV ;BIR/CML3/WRT-SCHEDULE VALIDATION ;06/24/96
"RTN","PSSJSV",2,0)
 ;;1.0;PHARMACY DATA MANAGEMENT;**20,38,56,59,110,121,143,149,146,189**;9/30/97;Build 54
"RTN","PSSJSV",3,0)
 ;
"RTN","PSSJSV",4,0)
 ; Reference to ^PS(51.15 is supported by DBIA #2132
"RTN","PSSJSV",5,0)
 ; Reference to $$UP^XLFSTR(P1) is supported by DBIA #10104
"RTN","PSSJSV",6,0)
 ;
"RTN","PSSJSV",7,0)
EN ;
"RTN","PSSJSV",8,0)
 S X=PSJX,(PSJAT,PSJM,PSJTS,PSJY,PSJAX)="" I $S(X["""":1,$A(X)=45:1,X'?.ANP:1,$L(X," ")>2:1,$L(X)>70:1,$L(X)<1:1,X["P RN":1,1:X["PR N") K PSJX,X Q
"RTN","PSSJSV",9,0)
 I X["PRN"!(X="ON CALL")!(X="ONCALL")!(X="ON-CALL") G DONE
"RTN","PSSJSV",10,0)
 I X?1."?" D:'$D(PSJNE) ENSVH^PSSJSV0 Q
"RTN","PSSJSV",11,0)
 I X["@" D DW S:$D(X) PSJAT=$P(X,"@",2) G DONE
"RTN","PSSJSV",12,0)
 S X0=X,(XT,Y)="" I X,X'["X",(X?2.4N1"-".E!(X?2.4N)) D ENCHK S:$D(X) PSJAT=X G DONE
"RTN","PSSJSV",13,0)
 I $S($D(^PS(51.1,"AC",PSJPP,X)):1,1:$E($O(^(X)),1,$L(X))=X) D DIC G:$S(PSJY:PSJTS'="C",1:PSJM) DONE
"RTN","PSSJSV",14,0)
 I $S(X="NOW":1,X="ONCE":1,X="STAT":1,X="ONE TIME":1,X="ONETIME":1,X="1TIME":1,X="1-TIME":1,X="1 TIME":1,1:X="ONE-TIME") S PSJTS="O" W:'$D(PSJNE) "  (ONCE ONLY)" G DONE
"RTN","PSSJSV",15,0)
 S:PSJTS="" PSJTS="C" I PSJAT="" W:'$D(PSJNE) "  (Non standard schedule)" S X=PSJX
"RTN","PSSJSV",16,0)
 I $E(X,1,2)="AD" K X G DONE
"RTN","PSSJSV",17,0)
 I $E(X,1,3)="BID"!($E(X,1,3)="TID")!($E(X,1,3)="QID") S PSJM=1440\$F("BTQ",$E(X)) G DONE
"RTN","PSSJSV",18,0)
 S:$E(X)="Q" X=$E(X,2,99) S:'X X="1"_X S X1=+X,X=$P(X,+X,2),X2=0 S:X1<0 X1=-X1 S:$E(X)="X" X2=X1,X=$E(X,2,99) I 'X2,$E(X)="O" S X2=.5,X=$E(X,2,99)
"RTN","PSSJSV",19,0)
 S XT=$S(X["'":1,(X["D"&(X'["AD"))!(X["AM")!(X["PM")!(X["HS"&(X'["THS")):1440,X["H"&(X'["TH"):60,X["AC"!(X["PC"):480,X["W":10080,X["M":40320,1:-1) I XT<0,PSJAT="" K X G DONE
"RTN","PSSJSV",20,0)
 S X=PSJX I XT S:X2 XT=XT\X2 S:'X2 XT=XT*X1
"RTN","PSSJSV",21,0)
 S PSJM=XT
"RTN","PSSJSV",22,0)
 ;
"RTN","PSSJSV",23,0)
DONE ;
"RTN","PSSJSV",24,0)
 K:$D(X)[0 PSJX K D,DIC,Q,QX,SDW,SWD,X,X0,X1,X2,XT,Y,Z Q
"RTN","PSSJSV",25,0)
 ;
"RTN","PSSJSV",26,0)
ENCHK ; admin times
"RTN","PSSJSV",27,0)
 N SCHED
"RTN","PSSJSV",28,0)
 I $S($L($P(X,"-"))>4:1,$L(X)>119:1,$L(X)<2:1,X'>0:1,1:X'?.ANP) K X Q
"RTN","PSSJSV",29,0)
 S X(1)=$P(X,"-") I X(1)'?2N,X(1)'?4N K X Q
"RTN","PSSJSV",30,0)
 S X(1)=$L(X(1)) F X(2)=2:1:$L(X,"-") S X(3)=$P(X,"-",X(2)) I $S($L(X(3))'=X(1):1,X(3)>$S(X(1)=2:24,1:2400):1,1:X(3)'>$P(X,"-",X(2)-1)) K X Q
"RTN","PSSJSV",31,0)
 Q:'$D(X)
"RTN","PSSJSV",32,0)
 S X(1)=$L(X,"-")
"RTN","PSSJSV",33,0)
 S SCHED=$S($G(DA(1)):$$GET1^DIQ(52.61,+$G(DA)_","_DA(1),4),$G(DA):$$GET1^DIQ(52.6,+DA,4),1:"")
"RTN","PSSJSV",34,0)
 Q:(SCHED="")
"RTN","PSSJSV",35,0)
 S IENS=$O(^PS(51.1,"B",SCHED,0))
"RTN","PSSJSV",36,0)
 S X(4)=$S($G(PSSJSE)&($G(PSSSCT)]""):PSSSCT,1:$$GET1^DIQ(51.1,IENS,5,"I"))
"RTN","PSSJSV",37,0)
 I X(4)="D" D  Q  ;DOW schedules require at least one admin time
"RTN","PSSJSV",38,0)
 . I X(1)>0 K:$D(X) X(1),X(2),X(3) Q
"RTN","PSSJSV",39,0)
 . K X
"RTN","PSSJSV",40,0)
 I X(4)="O" D  Q
"RTN","PSSJSV",41,0)
 . I $L(X,"-")>1 K X Q  ;One Time schedules allow one admin time
"RTN","PSSJSV",42,0)
 . I X="" K X Q  ;One Time schedules require one admin time
"RTN","PSSJSV",43,0)
 S X(2)=$S($G(PSSJSE)&($G(PSSFRQ)):PSSFRQ,1:$$GET1^DIQ(51.1,IENS,2,"I"))
"RTN","PSSJSV",44,0)
 I X(2)="" K:$D(X) X(1),X(2),X(3) Q
"RTN","PSSJSV",45,0)
 I X(2)>0,X(2)<1440,(1440/X(2))'=X(1) K X Q  ;PSS*1*143 Admin times must match frequency
"RTN","PSSJSV",46,0)
 I X(2)>0,X(2)<1440,(1440#X(2))'=0,X(1)>0 K X Q  ;PSS*1*143 Odd schedules cannot have admin times
"RTN","PSSJSV",47,0)
 I X(2)>1440,(X(2)#1440)'=0,X(1)>1 K X Q  ;PSS*1*143 Odd schedules cannot have admin times
"RTN","PSSJSV",48,0)
 I X(2)>1439,$L(X,"-")'=1 K X Q  ;PSS*1*143 Schedules with frequency equal to or greater than 1 day can only have one admin time.
"RTN","PSSJSV",49,0)
 K:$D(X) X(1),X(2),X(3)
"RTN","PSSJSV",50,0)
 Q
"RTN","PSSJSV",51,0)
 ;
"RTN","PSSJSV",52,0)
DIC ; 51.1 look-up
"RTN","PSSJSV",53,0)
 S DIC="^PS(51.1,",DIC(0)=$E("E",'$D(PSJNE))_"ISZ",DIC("W")="I '$D(PSJNE) D DICW^PSSJSV0",D="AP"_PSJPP
"RTN","PSSJSV",54,0)
 D IX^DIC K DIC Q:Y'>0  S PSJY=+Y,(PSJX,X,X0)=Y(0,0),PSJM=$P(Y(0),"^",3),PSJTS=$P(Y(0),"^",5),PSJAX=$P(Y(0),U,7) S:PSJTS="" PSJTS="C" Q:PSJTS="O"!(PSJTS["R")  I $D(PSJW),$D(^PS(51.1,+Y,1,+PSJW,0)) S PSJAT=$P(^(0),"^",PSJTS="S"+2)
"RTN","PSSJSV",55,0)
 E  S PSJAT=$P(Y(0),"^",PSJTS="S"*4+2)
"RTN","PSSJSV",56,0)
 Q:PSJTS'="S"
"RTN","PSSJSV",57,0)
 F Y=1:1:$L(PSJAT,"-") S Y(1)=$P(PSJAT,"-",Y),PSJAT(Y(1))="",Y(2)=$O(^PS(51.15,"ACP",PSJPP,Y(1),0)) I Y(2),$D(^PS(51.15,Y(2),0)) S PSJAT(Y(1))=$P(^(0),"^",3) I $D(PSJW),$D(^(1,PSJW,0)),$P(^(0),"^",2)]"" S PSJAT(Y(1))=$P(^(0),"^",2)
"RTN","PSSJSV",58,0)
 Q
"RTN","PSSJSV",59,0)
 ;
"RTN","PSSJSV",60,0)
DW ;  week days
"RTN","PSSJSV",61,0)
 S SWD="SUNDAYS^MONDAYS^TUESDAYS^WEDNESDAYS^THURSDAYS^FRIDAYS^SATURDAYS",SDW=X,X=$P(X,"@",2) D ENCHK Q:'$D(X)
"RTN","PSSJSV",62,0)
 S X=$P(SDW,"@"),X(1)="-" I X?.E1P.E,X'["-" F QX=1:1:$L(X) I $E(X,QX)?1P S X(1)=$E(X,QX) Q
"RTN","PSSJSV",63,0)
 F Q=1:1:$L(X,X(1)) K:SWD="" X Q:SWD=""  S Z=$P(X,X(1),Q) D DWC Q:'$D(X)
"RTN","PSSJSV",64,0)
 K X(1) S:$D(X) X=SDW Q
"RTN","PSSJSV",65,0)
DWC I $L(Z)<2 K X Q
"RTN","PSSJSV",66,0)
 F QX=1:1:$L(SWD,"^") S Y=$P(SWD,"^",QX) I $P(Y,Z)="" S SWD=$P(SWD,Y,2) S:$L(SWD) SWD=$E(SWD,2,50) Q
"RTN","PSSJSV",67,0)
 E  K X
"RTN","PSSJSV",68,0)
 Q
"RTN","PSSJSV",69,0)
 ;
"RTN","PSSJSV",70,0)
ENSNV ; schedule name
"RTN","PSSJSV",71,0)
 I $S(X["""":1,$A(X)=45:1,X'?.ANP:1,$L(X)>20:1,$L(X)<2:1,1:X?1P.E) K X Q
"RTN","PSSJSV",72,0)
 I $S('$D(PSJPP):0,PSJPP="":1,PSJPP'?.ANP:1,1:'$$VERSION^XPDUTL(PSJPP)) K X
"RTN","PSSJSV",73,0)
 I $D(DA),$D(^PS(51.1,DA,0)),$P(^(0),"^",5)["D" S ZX=X D DNVX S:$D(X) X=ZX K Z1,Z2,Z3,Z4,ZX
"RTN","PSSJSV",74,0)
 Q
"RTN","PSSJSV",75,0)
 ;
"RTN","PSSJSV",76,0)
ENSHV ;  shift in 51.1
"RTN","PSSJSV",77,0)
 I $S($L(X)>11:1,$L(X)<1:1,'$D(PSJPP):1,PSJPP="":1,PSJPP'?.ANP:1,1:'$$VERSION^XPDUTL(PSJPP)) K X Q
"RTN","PSSJSV",78,0)
 F X(1)=1:1:$L(X,"-") S X(2)=$P(X,"-",X(1)) I $S(X(2)="":1,X(2)'?.ANP:1,1:'$D(^PS(51.15,"ACP",PSJPP,X(2)))) K X Q
"RTN","PSSJSV",79,0)
 K X(1),X(2) Q
"RTN","PSSJSV",80,0)
 ;
"RTN","PSSJSV",81,0)
ENVSST ;  shift start/stop times
"RTN","PSSJSV",82,0)
 I X'?2N1"-"2N,X'?4N1"-"4N K X Q
"RTN","PSSJSV",83,0)
 F X(1)=1,2 I $P(X,"-",X(1))>$S($L($P(X,"-",X(1)))<4:24,1:2400) K X Q
"RTN","PSSJSV",84,0)
 K X(1) Q
"RTN","PSSJSV",85,0)
 ;
"RTN","PSSJSV",86,0)
ENFQD ; frequency default
"RTN","PSSJSV",87,0)
 N X1,X2,Z S Z=$S($D(^PS(51.1,DA,0)):$P(^(0),"^"),1:""),X=""
"RTN","PSSJSV",88,0)
 S X=$P(Z,"^",3) I Z]"" Q
"RTN","PSSJSV",89,0)
 S Z=DA I $E(Z,1,2)="AD" Q
"RTN","PSSJSV",90,0)
 I $E(Z,1,3)="BID"!($E(Z,1,3)="TID")!($E(Z,1,3)="QID") S X=1440/$F("BTQ",$E(Z)) Q
"RTN","PSSJSV",91,0)
 E  S:$E(Z)="Q" Z=$E(Z,2,99) S:'Z Z="1"_Z S X1=+Z,Z=$P(Z,+Z,2),X2=0 S:$E(Z)="X" X2=X1,Z=$E(Z,2,99) I 'X2,$E(Z)="O" S X2=.5,Z=$E(Z,2,99)
"RTN","PSSJSV",92,0)
 S X=$S(Z["'":1,(Z["D"&(Z'["AD"))!(Z["AM")!(Z["PM")!(Z["HS"&(Z'["THS")):1440,Z["H"&(Z'["TH"):60,Z["AC"!(Z["PC"):480,Z["W":10080,Z["M":40320,1:"") Q:'X  S:X2 X=X\X2 S:'X2 X=X*X1 Q
"RTN","PSSJSV",93,0)
 ;
"RTN","PSSJSV",94,0)
ENFREQ ;validate frequency
"RTN","PSSJSV",95,0)
 K:+X'=X!(X>525600)!(X<1)!(X?.E1"."1N.N) X
"RTN","PSSJSV",96,0)
 Q
"RTN","PSSJSV",97,0)
 ;
"RTN","PSSJSV",98,0)
ENDNV ; day of the week name
"RTN","PSSJSV",99,0)
 N Z1,Z2,Z3,Z4 S X=$S($D(^PS(51.1,DA,0)):$P(^(0),"^"),1:"") I X="" K X Q
"RTN","PSSJSV",100,0)
 ;
"RTN","PSSJSV",101,0)
DNVX S Z2=1,Z4="-" I X'["-",X?.E1P.E F Z1=1:1:$L(X) I $E(X,Z1)?1P S Z4=$E(X,Z1) Q
"RTN","PSSJSV",102,0)
 F Z1=1:1:$L(X,Z4) Q:'Z2  S Z2=0 I $L($P(X,Z4,Z1))>1 F Z3="MONDAYS","TUESDAYS","WEDNESDAYS","THURSDAYS","FRIDAYS","SATURDAYS","SUNDAYS" I $P(Z3,$P(X,Z4,Z1))="" S Z2=1 Q
"RTN","PSSJSV",103,0)
 K:'Z2 X S:Z2 X="D" Q
"RTN","PSSJSV",104,0)
 ;
"RTN","PSSJSV",105,0)
ENPSJ ;validate schedule names for PSJ package
"RTN","PSSJSV",106,0)
 N A,B,I,PSSCNT
"RTN","PSSJSV",107,0)
 S X=$$UP^XLFSTR(X)
"RTN","PSSJSV",108,0)
 I $G(PSJPP)'="PSJ" Q
"RTN","PSSJSV",109,0)
 S A=$TR(X,".","") I A="OTHER" K X Q
"RTN","PSSJSV",110,0)
 F I=1:1:$L(A," ") S B=$P(A," ",I) I B="QD"!(B="QOD")!(B="HS")!(B="TIW") K X ;;>> *149 RJS
"RTN","PSSJSV",111,0)
 Q:'$D(X)
"RTN","PSSJSV",112,0)
 S DOW=0,ZX=X S X=$P(X,"@") D DNVX I $G(X)="" S X=ZX K ZX
"RTN","PSSJSV",113,0)
 I X="D" S X=ZX,DOW=1 D:X["@" CHKORD I $D(X),$G(PSSCNT)>1 D  S:'$D(X) X=ZX K Z1,Z2,Z3,Z4,ZX
"RTN","PSSJSV",114,0)
 .N MSG
"RTN","PSSJSV",115,0)
 .S MSG(1)="",MSG(2)="The day of the week schedule must be in the correct day of week order."
"RTN","PSSJSV",116,0)
 .S MSG(3)="The correct order is: SU-MO-TU-WE-TH-FR-SA"
"RTN","PSSJSV",117,0)
 .D EN^DDIOL(.MSG,"","!")
"RTN","PSSJSV",118,0)
 .Q
"RTN","PSSJSV",119,0)
SCRN ;LOGIC TO SCREEN OUT @ IF NOT DAILY
"RTN","PSSJSV",120,0)
 S (PSSFLG,PSSDFLG,PSSTFLG,PSSAFLG)=0
"RTN","PSSJSV",121,0)
 Q:X'["@"
"RTN","PSSJSV",122,0)
 I $G(PSSCNT) K PSSCNT,X Q
"RTN","PSSJSV",123,0)
 D DAYS,TIMECHK
"RTN","PSSJSV",124,0)
 I $L(X)<2!($L(X)>20) D MSG1
"RTN","PSSJSV",125,0)
 I $G(PSSAFLG) D MSG4
"RTN","PSSJSV",126,0)
 I $G(PSSTFLG) D MSG3
"RTN","PSSJSV",127,0)
 I $G(PSSDFLG) D MSG2
"RTN","PSSJSV",128,0)
 I $G(PSSFLG) S MSG(4)="",MSG(5)="  "_X D EN^DDIOL(.MSG,"","!") K MSG
"RTN","PSSJSV",129,0)
 K:$G(PSSFLG) X
"RTN","PSSJSV",130,0)
 K PSSFLG,PSSDFLG,PSSTFLG,PSSAFLG
"RTN","PSSJSV",131,0)
 Q
"RTN","PSSJSV",132,0)
 ;
"RTN","PSSJSV",133,0)
ENPSJT ; Validate schedule type (one-time PRN conflict)
"RTN","PSSJSV",134,0)
 N A,B
"RTN","PSSJSV",135,0)
 S A=$$GET1^DIQ(51.1,DA,.01),B=""
"RTN","PSSJSV",136,0)
 I A["PRN",X'="P" D
"RTN","PSSJSV",137,0)
 . S B="Conflict: Schedule Name contains PRN but selected Schedule Type is not PRN."
"RTN","PSSJSV",138,0)
 . K X
"RTN","PSSJSV",139,0)
 I A'["PRN",X="P" D
"RTN","PSSJSV",140,0)
 . S B="Conflict: Schedule Name does not contain PRN but selected Schedule Type is PRN."
"RTN","PSSJSV",141,0)
 . K X
"RTN","PSSJSV",142,0)
 I $L(B)>0 D EN^DDIOL(.B,"","!") Q
"RTN","PSSJSV",143,0)
 S A=$$GET1^DIQ(51.1,DA,2),B=""
"RTN","PSSJSV",144,0)
 Q
"RTN","PSSJSV",145,0)
 ;
"RTN","PSSJSV",146,0)
CHKORD ;Check order of days in DOW schedule name
"RTN","PSSJSV",147,0)
 N I,J,L,N,P,W
"RTN","PSSJSV",148,0)
 S N=$P(X,"@"),L=0,P=$L(N,"-"),W="SUNDAYS,MONDAYS,TUESDAYS,WEDNESDAYS,THURSDAYS,FRIDAYS,SATURDAYS",PSSCNT=0
"RTN","PSSJSV",149,0)
 F I=1:1:P F J=1:1:7 I $P(W,",",J)=$P(N,"-",I) K:J'>L X Q:'$D(X)  S:J>L L=J,PSSCNT=PSSCNT+1
"RTN","PSSJSV",150,0)
 Q
"RTN","PSSJSV",151,0)
 ;
"RTN","PSSJSV",152,0)
RMTIME ;Remove ward times when schedule becomes odd
"RTN","PSSJSV",153,0)
 N R
"RTN","PSSJSV",154,0)
 S R=0 F  S R=$O(^PS(51.1,D0,1,R)) Q:R=""  K ^PS(51.1,D0,1,R)
"RTN","PSSJSV",155,0)
 Q
"RTN","PSSJSV",156,0)
DAYS ; check days of week for correct order sequence
"RTN","PSSJSV",157,0)
 N PSSD2,PSSD3,PSSD4,PSSD1,PSSD5,PSSD6,PSSFND
"RTN","PSSJSV",158,0)
 S PSSD1=$P(X,"@"),PSSD4=0,PSSD5=$L(PSSD1,"-"),PSSD6="SU,MO,TU,WE,TH,FR,SA",PSSFND=0
"RTN","PSSJSV",159,0)
 F PSSD2=1:1:PSSD5 Q:'$D(PSSD1)  D
"RTN","PSSJSV",160,0)
 .F PSSD3=1:1:7 D  Q:'$D(PSSD1)
"RTN","PSSJSV",161,0)
 ..I $P(PSSD6,",",PSSD3)=$P(PSSD1,"-",PSSD2) K:PSSD3'>PSSD4 PSSD1 Q:'$D(PSSD1)  S PSSFND=PSSFND+1 S:PSSD3>PSSD4 PSSD4=PSSD3
"RTN","PSSJSV",162,0)
 ..I $L($P(PSSD1,"-",PSSD2))>2 K PSSD1
"RTN","PSSJSV",163,0)
 .K:PSSFND'=PSSD2 PSSD1
"RTN","PSSJSV",164,0)
 I ('$D(PSSD1)!('$D(PSSFND))) S PSSDFLG=1
"RTN","PSSJSV",165,0)
 Q
"RTN","PSSJSV",166,0)
MSG1 ; max length exceeded message
"RTN","PSSJSV",167,0)
 S MSG(1)="",MSG(2)="The Administration Schedule you entered has "_$L(X)_" characters."
"RTN","PSSJSV",168,0)
 S MSG(3)="Answer must be 2-20 characters in length."
"RTN","PSSJSV",169,0)
 D EN^DDIOL(.MSG,"","!")
"RTN","PSSJSV",170,0)
 S PSSFLG=1
"RTN","PSSJSV",171,0)
 K MSG
"RTN","PSSJSV",172,0)
 Q
"RTN","PSSJSV",173,0)
MSG2 ; day of week order squence message
"RTN","PSSJSV",174,0)
 S MSG(1)="",MSG(2)="The day of the week schedule must be in the correct day of week order."
"RTN","PSSJSV",175,0)
 S MSG(3)="The correct order is: SU-MO-TU-WE-TH-FR-SA"
"RTN","PSSJSV",176,0)
 D EN^DDIOL(.MSG,"","!")
"RTN","PSSJSV",177,0)
 S PSSFLG=1
"RTN","PSSJSV",178,0)
 K MSG
"RTN","PSSJSV",179,0)
 Q
"RTN","PSSJSV",180,0)
MSG3 ; time input message
"RTN","PSSJSV",181,0)
 S MSG(1)="",MSG(2)="The time must be between 0001 - 2400."
"RTN","PSSJSV",182,0)
 S MSG(3)="A correct time entry would be: 0800-1200-1600 etc."
"RTN","PSSJSV",183,0)
 D EN^DDIOL(.MSG,"","!")
"RTN","PSSJSV",184,0)
 S PSSFLG=1
"RTN","PSSJSV",185,0)
 K MSG
"RTN","PSSJSV",186,0)
 Q
"RTN","PSSJSV",187,0)
MSG4 ; time sequence message
"RTN","PSSJSV",188,0)
 S MSG(1)="",MSG(2)="The time must be entered in ascending order."
"RTN","PSSJSV",189,0)
 S MSG(3)="A correct time entry would be: 0800-1200-1600 etc."
"RTN","PSSJSV",190,0)
 D EN^DDIOL(.MSG,"","!")
"RTN","PSSJSV",191,0)
 S PSSFLG=1
"RTN","PSSJSV",192,0)
 K MSG
"RTN","PSSJSV",193,0)
 Q
"RTN","PSSJSV",194,0)
TIMECHK ; time validation
"RTN","PSSJSV",195,0)
 N PSSXTIME,PSSTLN,PSSLOOP,PSSTCHR,PSSDASH,PSSLEN,PSSTCHK,PSSTIMCT,PSSTIME
"RTN","PSSJSV",196,0)
 I $L(X,"@")>2 S (PSSDFLG,PSSTFLG)=1 Q
"RTN","PSSJSV",197,0)
 S PSSXTIME=$P(X,"@",2),PSSTLN=$L(PSSXTIME),PSSTFLG=0,PSSDASH=$L(PSSXTIME,"-")
"RTN","PSSJSV",198,0)
 I PSSXTIME=0 S PSSTFLG=1 Q
"RTN","PSSJSV",199,0)
 F PSSTIMCT=1:1:PSSDASH S PSSTIME=$P(PSSXTIME,"-",PSSTIMCT) D
"RTN","PSSJSV",200,0)
 .S PSSTCHK(PSSTIMCT)=PSSTIME,PSSLEN=$L(PSSTIME)
"RTN","PSSJSV",201,0)
 .I $L(PSSTCHK(PSSTIMCT))=2 S PSSTCHK(PSSTIMCT)=PSSTCHK(PSSTIMCT)_"00"
"RTN","PSSJSV",202,0)
 .F PSSLOOP=1:1:PSSLEN D
"RTN","PSSJSV",203,0)
 ..S PSSTCHR=$E(PSSTIME,PSSLOOP)
"RTN","PSSJSV",204,0)
 ..I $A(PSSTCHR)<48!($A(PSSTCHR)>57) S PSSTFLG=1
"RTN","PSSJSV",205,0)
 .I ((PSSTIME<1)!(PSSLEN=1)!(PSSLEN=3)!(PSSLEN>4)) S PSSTFLG=1
"RTN","PSSJSV",206,0)
 F PSSTIMCT=1:1:PSSDASH D
"RTN","PSSJSV",207,0)
 .I $G(PSSTCHK(PSSTIMCT+1)),PSSTCHK(PSSTIMCT)>PSSTCHK(PSSTIMCT+1) S PSSAFLG=1
"RTN","PSSJSV",208,0)
 .I $L(PSSTCHK(PSSTIMCT))=4 D
"RTN","PSSJSV",209,0)
 ..I $E(PSSTCHK(PSSTIMCT),1,4)>2400 S PSSTFLG=1
"RTN","PSSJSV",210,0)
 ..I $E(PSSTCHK(PSSTIMCT),1,2)<24 D
"RTN","PSSJSV",211,0)
 ...I $E(PSSTCHK(PSSTIMCT),3,4)>59 S PSSTFLG=1
"RTN","PSSJSV",212,0)
 Q
"RTN","PSSLOOK")
0^2^B86061726^B85846814
"RTN","PSSLOOK",1,0)
PSSLOOK ;BIR/WRT-Drug file lookup ;02/03/00
"RTN","PSSLOOK",2,0)
 ;;1.0;PHARMACY DATA MANAGEMENT;**3,7,15,16,20,24,29,38,68,61,87,90,127,147,170,189**;9/30/97;Build 54
"RTN","PSSLOOK",3,0)
 ;
"RTN","PSSLOOK",4,0)
 ;Reference to ^PS(50.605 supported by DBIA #2138
"RTN","PSSLOOK",5,0)
 ;Reference to ^PS(50.608 supported by DBIA #2136
"RTN","PSSLOOK",6,0)
 ;Reference to ^PS(50.609 supported by DBIA #2137
"RTN","PSSLOOK",7,0)
 ;Reference to ^PS(50.607 supported by DBIA #2221
"RTN","PSSLOOK",8,0)
 ;Reference to $$FORMRX^PSNAPIS(DA,K,.LIST) supported by DBIA #2574
"RTN","PSSLOOK",9,0)
 ;Reference to $$FORMI^PSNAPIS(P1,P3) supported by DBIA #2574
"RTN","PSSLOOK",10,0)
 ;Reference to $$PSJDF^PSNAPIS(P1,P3) supported by DBIA #2531
"RTN","PSSLOOK",11,0)
 ;Reference to $$PSJST^PSNAPIS(P1,P3) supported by DBIA #2531
"RTN","PSSLOOK",12,0)
 ;Reference to $$PROD2^PSNAPIS(P1,P3) supported by DBIA #2531
"RTN","PSSLOOK",13,0)
 ;Reference to $$VAGN^PSNAPIS(P1) supported by DBIA #2531
"RTN","PSSLOOK",14,0)
 ;Reference to ^PSNDF(50.68 supported by DBIA 3735
"RTN","PSSLOOK",15,0)
 ;
"RTN","PSSLOOK",16,0)
START S QUIT=0,PSSFG=0 D KILL F PSSXX=1:1 D PICK Q:PSSFG
"RTN","PSSLOOK",17,0)
DONE D KILL K PSSFG,PSSXX,QUIT,FM,FMS,Y2K
"RTN","PSSLOOK",18,0)
 Q
"RTN","PSSLOOK",19,0)
PICK W ! K DIC S DIC="^PSDRUG(",DIC(0)="AEQMVTN",DIC("T")="" D ^DIC K DIC I Y<0 S PSSFG=1 Q
"RTN","PSSLOOK",20,0)
 S IFN=+Y D NDDATA,GETDATA,INACT,NOD66,FORMAT,KILL
"RTN","PSSLOOK",21,0)
 Q
"RTN","PSSLOOK",22,0)
NDDATA I $D(^PSDRUG(IFN,"ND")) S CLPTR=$P(^PSDRUG(IFN,"ND"),"^",6) I $P(^PSDRUG(IFN,"ND"),"^",2)]"" S NDNODE=^PSDRUG(IFN,"ND"),VAGNPTR=$P(NDNODE,"^",1),VAPN=$P(NDNODE,"^",2),SZPTR=$P(NDNODE,"^",4),TYPTR=$P(NDNODE,"^",5) D NDF,NDF1
"RTN","PSSLOOK",23,0)
 Q
"RTN","PSSLOOK",24,0)
NDF S DA=VAGNPTR,X=$$VAGN^PSNAPIS(DA),VAGN=X,PS=$P(^PS(50.609,SZPTR,0),"^",1),PT=$P(^PS(50.608,TYPTR,0),"^",1),P3=$P(NDNODE,"^",3)
"RTN","PSSLOOK",25,0)
 K X S DA=VAGNPTR,K=P3,X=$$PROD2^PSNAPIS(DA,K) I X]"",$P(X,"^")]"" S VAPRN=$P(X,"^"),VADU=$P(X,"^",4),CMOPID=$P(X,"^",2)
"RTN","PSSLOOK",26,0)
 S CSF="" I $P(NDNODE,"^",3) S CSF=$$GET1^DIQ(50.68,$P(NDNODE,"^",3),19,"I")
"RTN","PSSLOOK",27,0)
 Q
"RTN","PSSLOOK",28,0)
IT S CMOPID=$P(X,"^",2)
"RTN","PSSLOOK",29,0)
 Q
"RTN","PSSLOOK",30,0)
NDF1 S X=$$PSJDF^PSNAPIS(DA,K),VADF=$P(X,"^",2)
"RTN","PSSLOOK",31,0)
 Q
"RTN","PSSLOOK",32,0)
INACT S ACT="" I $D(^PSDRUG(IFN,"I")) S Y=$P(^PSDRUG(IFN,"I"),"^",1) X ^DD("DD") S ACT=Y
"RTN","PSSLOOK",33,0)
 Q
"RTN","PSSLOOK",34,0)
GETDATA S NODE0=^PSDRUG(IFN,0),GN=$P(NODE0,"^",1),CL=$P(NODE0,"^",2),DEA=$P(NODE0,"^",3),WRN=$P(NODE0,"^",8),NF=$P(NODE0,"^",9),MESS=$P(NODE0,"^",10),VNF=$P(NODE0,"^",11),CLASS="",WARN="" S:NF=1 NF="N/F" S:VNF=1 VNF="V-N/F"
"RTN","PSSLOOK",35,0)
 S PSSNODE=$G(^PSDRUG(IFN,"DOS"))
"RTN","PSSLOOK",36,0)
 I CL]"" S CLASS=CL_"  "_$P(^PS(50.605,CLPTR,0),"^",2)
"RTN","PSSLOOK",37,0)
 I $D(^PSDRUG(IFN,3)) S:$P(^PSDRUG(IFN,3),"^")=0 CMOP="NO" S:$P(^PSDRUG(IFN,3),"^")=1 CMOP="YES"
"RTN","PSSLOOK",38,0)
 I $D(^PSDRUG(IFN,5)) S QDM=^PSDRUG(IFN,5)
"RTN","PSSLOOK",39,0)
 S OINM="" S NDC="" I $D(^PSDRUG(IFN,2)) S NODE2=^PSDRUG(IFN,2) S:$P(NODE2,"^",1)]"" OIPTR=$P(NODE2,"^",1) S NDC=$P(NODE2,"^",4) S:$P(NODE2,"^",6)]"" PDPTR=$P(NODE2,"^",6) S APP=$P(NODE2,"^",3),FM="" D TWOA
"RTN","PSSLOOK",40,0)
 Q
"RTN","PSSLOOK",41,0)
TWOA I $D(OIPTR) S OI=$P(^PS(50.7,OIPTR,0),"^",1),DFPTR=$P(^PS(50.7,OIPTR,0),"^",2),DF=$P(^PS(50.606,DFPTR,0),"^",1),FMS=$P(^PS(50.7,OIPTR,0),"^",12) S:FMS]"" FM=" (N/F)" S OINM=OI_" "_DF_FM
"RTN","PSSLOOK",42,0)
 ;I $D(PDPTR) S PD=$P(^PS(50.3,PDPTR,0),"^",1)
"RTN","PSSLOOK",43,0)
 Q
"RTN","PSSLOOK",44,0)
NOD66 S (DUPOU,PPDU,PPOU,DU,SS)="" I $D(^PSDRUG(IFN,660)) S NDE=^PSDRUG(IFN,660),OUPTR=$P(NDE,"^",2),PPOU=$P(NDE,"^",3),DUPOU=$P(NDE,"^",5),PPDU=$P(NDE,"^",6),SS=$P(NDE,"^",7),DU=$P(NDE,"^",8) I OUPTR]"" S OU=$P(^DIC(51.5,OUPTR,0),"^")
"RTN","PSSLOOK",45,0)
 Q
"RTN","PSSLOOK",46,0)
SYN I $D(^PSDRUG(IFN,1,0)) F ZZZ=0:0 S ZZZ=$O(^PSDRUG(IFN,1,ZZZ)) Q:'ZZZ  S SYNM=$P(^PSDRUG(IFN,1,ZZZ,0),"^",1),INT=$P(^PSDRUG(IFN,1,ZZZ,0),"^",3) D SYN1
"RTN","PSSLOOK",47,0)
 Q
"RTN","PSSLOOK",48,0)
SYN1 S INT=$S(INT=0:"Trade Name",INT=1:"Quick Code",INT="C":"Ctrl Substances",INT="D":"Drug Accountability",1:"") D FULL Q:$G(QUIT)  W ?14,SYNM,?55,INT,!
"RTN","PSSLOOK",49,0)
 Q
"RTN","PSSLOOK",50,0)
SYN2 S:INT=0 INT="Trade" S:INT=1 INT="Quick" S:INT="C" INT="Ctrl Subs" S:INT="D" INT="Drug Acct" W ?16,SYNM,?57,INT,!
"RTN","PSSLOOK",51,0)
 Q
"RTN","PSSLOOK",52,0)
IFCAP I $D(^PSDRUG(IFN,441,0)) F QQQ=0:0 S QQQ=$O(^PSDRUG(IFN,441,QQQ)) Q:'QQQ  S IFCAPNM=$P(^PSDRUG(IFN,441,QQQ,0),"^",1)
"RTN","PSSLOOK",53,0)
 Q
"RTN","PSSLOOK",54,0)
FORMAT ; BEGIN WRITING
"RTN","PSSLOOK",55,0)
 N DAW
"RTN","PSSLOOK",56,0)
 W @IOF,"DRUG NAME: ",GN,"  (IEN: ",IFN,")",!
"RTN","PSSLOOK",57,0)
 F XX=1:1:77 W "="
"RTN","PSSLOOK",58,0)
 W !
"RTN","PSSLOOK",59,0)
 W:$D(VAPRN) "VA PRINT NAME: ",?17,VAPRN W:$D(CMOPID) ?60,"CMOP ID#: ",CMOPID W:$D(VAPN) !,"VA PRODUCT NAME: ",?17,VAPN W:$D(CMOP) ?60,"CMOP DISPENSE: ",CMOP
"RTN","PSSLOOK",60,0)
 W:$D(OINM) !,"ORDERABLE ITEM: ",?17,OINM W:$D(VAPN) ?60,"NDF DF: ",VADF
"RTN","PSSLOOK",61,0)
 I $D(OIPTR),OIPTR]"" W !,"ORDERABLE ITEM TEXT: ",! D OITXT
"RTN","PSSLOOK",62,0)
 W:$D(PD) !,"PRIMARY DRUG: ",?17,PD
"RTN","PSSLOOK",63,0)
 W !,"SYNONYM(S): " D SYN D FULL Q:$G(QUIT)  W !,"MESSAGE: ",MESS,!
"RTN","PSSLOOK",64,0)
 D FULL Q:$G(QUIT)  F XX=1:1:77 W "-"
"RTN","PSSLOOK",65,0)
 W !
"RTN","PSSLOOK",66,0)
 D FULL Q:$G(QUIT)  W "DEA, SPECIAL HDLG: ",DEA,?48,"NDC: ",?63,NDC
"RTN","PSSLOOK",67,0)
 S DAW=+$$GET1^DIQ(50,IFN,81)
"RTN","PSSLOOK",68,0)
 D FULL Q:$G(QUIT)  W !,"DAW CODE:  ",DAW," - ",$$DAWEXT^PSSDAWUT(DAW)
"RTN","PSSLOOK",69,0)
 D FULL Q:$G(QUIT)  W !,"CS FEDERAL SCHEDULE: ",$G(CSF)
"RTN","PSSLOOK",70,0)
 D FULL Q:$G(QUIT)  W !,"INACTIVE DATE: ",ACT
"RTN","PSSLOOK",71,0)
 D FULL Q:$G(QUIT)  W:$D(QDM) !,"QUANTITY DISPENSE MESSAGE: ",QDM,!
"RTN","PSSLOOK",72,0)
 D FULL Q:$G(QUIT)  I WRN]"" W !,"WARNING LABEL: " S X=WRN F Z0=1:1 Q:$P(X,",",Z0,99)=""  S Z1=$P(X,",",Z0) W:$D(^PS(54,Z1,0)) ?19,$P(^(0),"^",1),! I '$D(^(0)) W ?19,"NO SUCH WARNING LABEL" K X Q
"RTN","PSSLOOK",73,0)
 D FULL Q:$G(QUIT)  S PSSLOOK=1 D
"RTN","PSSLOOK",74,0)
 .N DRUG
"RTN","PSSLOOK",75,0)
 .I $P($G(^PSDRUG(IFN,0)),"^")="" K PSSLOOK Q
"RTN","PSSLOOK",76,0)
 .S PSSWSITE=+$O(^PS(59.7,0)) W !,"WARNING LABEL SOURCE is " D
"RTN","PSSLOOK",77,0)
 ..I $P($G(^PS(59.7,PSSWSITE,10)),"^",9)="N" W "set to 'NEW'" Q
"RTN","PSSLOOK",78,0)
 ..W "not set to 'NEW'"
"RTN","PSSLOOK",79,0)
 .K PSSWRN
"RTN","PSSLOOK",80,0)
 .D FULL Q:$G(QUIT)  W !,"NEW WARNING LABEL:"
"RTN","PSSLOOK",81,0)
 .S ^TMP("PSSWRNB",$J,$P(^PSDRUG(IFN,0),"^"))="" D ^PSSWRNE
"RTN","PSSLOOK",82,0)
 .K PSSLOOK,^TMP("PSSWRNB",$J),PSSWRN
"RTN","PSSLOOK",83,0)
 D FULL Q:$G(QUIT)  W:'$D(QDM) ! F XX=1:1:77 W "-"
"RTN","PSSLOOK",84,0)
 D FULL Q:$G(QUIT)  W !
"RTN","PSSLOOK",85,0)
 W "ORDER UNIT: ",?27 W:$D(OU) OU W ?40,"PRICE/ORDER UNIT: ",?67,PPOU
"RTN","PSSLOOK",86,0)
 D FULL Q:$G(QUIT)  W !,"DISPENSE UNIT: ",?27,DU W:$D(VADU) ?40,"VA DISPENSE UNIT: ",?67,VADU
"RTN","PSSLOOK",87,0)
 D FULL Q:$G(QUIT)  W !,"DISPENSE UNITS/ORDER UNIT: ",?21,DUPOU,?40,"PRICE/DISPENSE UNIT: ",?67,PPDU
"RTN","PSSLOOK",88,0)
 D FULL Q:$G(QUIT)  W !,"NCPDP DISPENSE UNIT: ",$$GET1^DIQ(50,IFN,82),?40,"NCPDP QUANTITY MULTIPLIER: ",?67,$J($$GET1^DIQ(50,IFN,83),8,3)
"RTN","PSSLOOK",89,0)
 D FULL Q:$G(QUIT)  W !,"MAXIMUM DAYS SUPPLY: ",$$GET1^DIQ(50,IFN,66)
"RTN","PSSLOOK",90,0)
 D FULL Q:$G(QUIT)  W !,"APPL PKG USE:" S APPL="" S:'$D(APP) APPL="  NONE"
"RTN","PSSLOOK",91,0)
 I $D(APP) D
"RTN","PSSLOOK",92,0)
 . S:APP["O" APPL=APPL_"  Outpatient" S:APP["U" APPL=APPL_"  Unit Dose"
"RTN","PSSLOOK",93,0)
 . S:APP["I" APPL=APPL_"  IV" S:APP["W" APPL=APPL_"  Ward Stock"
"RTN","PSSLOOK",94,0)
 . S:APP["N" APPL=APPL_"  Control Subs" S:APP["X" APPL=APPL_"  Non-VA Med"
"RTN","PSSLOOK",95,0)
 . S:APPL="" APPL="  NONE"
"RTN","PSSLOOK",96,0)
 W ?13,APPL
"RTN","PSSLOOK",97,0)
 I $P(PSSNODE,"^",2) S (PSSCALC,PSSUNIT)=$P($G(^PS(50.607,+$P(PSSNODE,U,2),0)),U),PSSSTR=$P(PSSNODE,"^")
"RTN","PSSLOOK",98,0)
 I $G(PSSUNIT)'="",$G(PSSUNIT)["/" D UNCALC
"RTN","PSSLOOK",99,0)
 D FULL Q:$G(QUIT)  W !,"STRENGTH: ",$S($E($P(PSSNODE,U),1)=".":"0",1:"")_$P(PSSNODE,U),?35,"UNIT: ",$G(PSSCALC)
"RTN","PSSLOOK",100,0)
 D FULL Q:$G(QUIT)  W !,"POSSIBLE DOSAGES:"
"RTN","PSSLOOK",101,0)
 I $D(^PSDRUG(IFN,"DOS1",0)) F PDS=0:0 S PDS=$O(^PSDRUG(IFN,"DOS1",PDS)) Q:'PDS  D
"RTN","PSSLOOK",102,0)
 .S POSDOS=^PSDRUG(IFN,"DOS1",PDS,0)
"RTN","PSSLOOK",103,0)
 .D FULL Q:$G(QUIT)  W !,"   DISPENSE UNITS PER DOSE: ",$S($E($P(POSDOS,U),1)=".":"0",1:"")_$P(POSDOS,U),?40,"DOSE: ",$S($E($P(POSDOS,U,2),1)=".":"0",1:"")_$P(POSDOS,U,2),?55,"PACKAGE: ",$P(POSDOS,U,3)
"RTN","PSSLOOK",104,0)
 .D FULL Q:$G(QUIT)  W !,"       BCMA UNITS PER DOSE: ",$P(POSDOS,U,4)
"RTN","PSSLOOK",105,0)
 D FULL Q:$G(QUIT)  W !,"LOCAL POSSIBLE DOSAGES:"
"RTN","PSSLOOK",106,0)
 I $D(^PSDRUG(IFN,"DOS2",0)) F PDS=0:0 S PDS=$O(^PSDRUG(IFN,"DOS2",PDS)) Q:'PDS  D
"RTN","PSSLOOK",107,0)
 .S LPDOS=^PSDRUG(IFN,"DOS2",PDS,0)
"RTN","PSSLOOK",108,0)
 .D FULL Q:$G(QUIT)  W !,"   LOCAL POSSIBLE DOSAGE: " D
"RTN","PSSLOOK",109,0)
 ..I $L($P(LPDOS,U))'>27 W $P(LPDOS,U),?55,"PACKAGE: ",$P(LPDOS,U,2)
"RTN","PSSLOOK",110,0)
 ..E   W !,?10,$P(LPDOS,U),!,?55,"PACKAGE: ",$P(LPDOS,U,2)
"RTN","PSSLOOK",111,0)
 ..D FULL Q:$G(QUIT)  W !,"     BCMA UNITS PER DOSE: ",$P(LPDOS,U,3) D FULL Q:$G(QUIT)  D LPDNW
"RTN","PSSLOOK",112,0)
 D FULL Q:$G(QUIT)  W ! F XX=1:1:77 W "-"
"RTN","PSSLOOK",113,0)
 D FULL Q:$G(QUIT)  W !,"VA CLASS: ",$G(CLASS)
"RTN","PSSLOOK",114,0)
 D FULL Q:$G(QUIT)  W !,"LOCAL NON-FORMULARY: ",$G(NF),"          ","VISN NON-FORMULARY: ",$G(VNF)
"RTN","PSSLOOK",115,0)
 N DA,K,LIST,PSXDN,PSXGN,PSXVP,X,XX1,XX2
"RTN","PSSLOOK",116,0)
 K PSXGN,PSXVP I $D(^PSDRUG(IFN,"ND")) S PSXDN=$G(^PSDRUG(IFN,"ND")),PSXGN=$P(PSXDN,"^"),PSXVP=$P(PSXDN,"^",3)
"RTN","PSSLOOK",117,0)
 I $G(PSXGN),$G(PSXVP) S X=$$PROD2^PSNAPIS(PSXGN,PSXVP),XX1=$$FORMI^PSNAPIS(PSXGN,PSXVP)
"RTN","PSSLOOK",118,0)
 D FULL Q:$G(QUIT)  W !,"National Formulary Indicator: "_$S($G(XX1)=1:"YES",$G(XX1)=0:"NO",1:"Not Matched to NDF")
"RTN","PSSLOOK",119,0)
 I $D(^PSDRUG(IFN,65,0)) D FULL Q:$G(QUIT)  W !,"FORMULARY ALTERNATIVES: ",! F FA=0:0 S FA=$O(^PSDRUG(IFN,65,FA)) Q:'FA  S LDFPTR=$P($G(^PSDRUG(IFN,65,FA,0)),"^") I LDFPTR D FULL Q:$G(QUIT)  W ?26,$P($G(^PSDRUG(LDFPTR,0)),"^"),!
"RTN","PSSLOOK",120,0)
 D FULL Q:$G(QUIT)  I $G(PSXGN),$G(PSXVP) W !,"National Restriction: " S XX2=$$FORMRX^PSNAPIS(PSXGN,PSXVP,.LIST) I $G(XX2)=1,$D(LIST) F XX2=0:0 S XX2=$O(LIST(XX2)) Q:'XX2  D FULL Q:$G(QUIT)  W !,LIST(XX2,0)
"RTN","PSSLOOK",121,0)
 W !,"Local Drug Text: ",! I $D(^PSDRUG(IFN,9,0)) D LDT
"RTN","PSSLOOK",122,0)
 Q
"RTN","PSSLOOK",123,0)
LDT F TXT1=0:0 S TXT1=$O(^PSDRUG(IFN,9,TXT1)) Q:'TXT1  S TEXPTR=^PSDRUG(IFN,9,TXT1,0) F PPP=0:0 S PPP=$O(^PS(51.7,TEXPTR,2,PPP)) Q:'PPP  S PST=$P($G(^PS(51.7,TEXPTR,0)),"^",2) I 'PST S WPT=^PS(51.7,TEXPTR,2,PPP,0) D FULL Q:$G(QUIT)  W WPT,!
"RTN","PSSLOOK",124,0)
 ;
"RTN","PSSLOOK",125,0)
 ;
"RTN","PSSLOOK",126,0)
KILL K IFN,APP,INT,VADU,VAGN,VAPN,VAPRN,P3,VAGNPTR,MESS,CLASS,DEA,ACT,CL,CLPTR,CMOP,DF,DFPTR,DU,DUPOUGN,IFCAPNM,NDC,NDE,NDNODE,NF,NODE0,NODE2,OI,OINM,OIPTR,OU,PD,PDPTR,PPDU,PPOU,PS,PT,NOD66,SYNM,SZPTR,TYPTR,WARN,WRN,XX,ZZZ,SS,OUPTR,CMOPID
"RTN","PSSLOOK",127,0)
 K DUPOU,QQQ,GN,QDM,APPL,VADF,DFP,DFRM,Y,Z0,Z1,DDD,PPP,TEXT,TXTPTR,TXT,TXT1,TEXPTR,VNF,WPT,FA,LDFPTR,TEXTPTR,QUIT,PST,D0,DA,K,DIR
"RTN","PSSLOOK",128,0)
 K PSSNODE,PSDOSUN,PDS,POSDOS,LPDOS,CSF,PSSSTR,PSSUNIT,PSSCALC
"RTN","PSSLOOK",129,0)
 Q
"RTN","PSSLOOK",130,0)
OITXT I $D(^PS(50.7,OIPTR,1,0)) F TXT=0:0 S TXT=$O(^PS(50.7,OIPTR,1,TXT)) Q:'TXT  S TEXTPTR=^PS(50.7,OIPTR,1,TXT,0) F DDD=0:0 S DDD=$O(^PS(51.7,TEXTPTR,2,DDD)) Q:'DDD  D IDATE I 'Y2K S TEXT=^PS(51.7,TEXTPTR,2,DDD,0) D FULL Q:$G(QUIT)  W TEXT,!
"RTN","PSSLOOK",131,0)
 Q
"RTN","PSSLOOK",132,0)
FULL D:($Y+5)>IOSL&('$G(QUIT)) FSCRN
"RTN","PSSLOOK",133,0)
 Q
"RTN","PSSLOOK",134,0)
FSCRN Q:$G(QUIT)  W ! K DIR S DIR(0)="E",DIR("A")="Press Return to continue,'^' to exit" D ^DIR W @IOF S:Y'=1 QUIT=1
"RTN","PSSLOOK",135,0)
 Q
"RTN","PSSLOOK",136,0)
IDATE S Y2K=$P($G(^PS(51.7,TEXTPTR,0)),"^",2)
"RTN","PSSLOOK",137,0)
 Q
"RTN","PSSLOOK",138,0)
UNCALC ;
"RTN","PSSLOOK",139,0)
 N PSSVA,PSSVA1,PSSVB,PSSVB1,PSSDASH,PSSNDFS,PSSDASH2,PSSDASH3,PSSDASH5 K PSSCALC
"RTN","PSSLOOK",140,0)
 S PSSDASH=0 S PSSNDFS=$$PSJST^PSNAPIS(+$P($G(^PSDRUG(IFN,"ND")),"^"),+$P($G(^PSDRUG(IFN,"ND")),"^",3)) S PSSNDFS=+$P($G(PSSNDFS),"^",2)
"RTN","PSSLOOK",141,0)
 I $G(PSSNDFS),$G(PSSSTR),+$G(PSSSTR)'=+$G(PSSNDFS) S PSSDASH=1
"RTN","PSSLOOK",142,0)
 S PSSVA=$P(PSSUNIT,"/"),PSSVB=$P(PSSUNIT,"/",2),PSSVA1=+$G(PSSVA),PSSVB1=+$G(PSSVB)
"RTN","PSSLOOK",143,0)
 I $G(PSSDASH) S PSSDASH2=PSSSTR/PSSNDFS,PSSDASH3=PSSDASH2*$S($G(PSSVB1):PSSVB1,1:1) S PSSDASH5=$S('$G(PSSVB1):PSSDASH3_$G(PSSVB),1:PSSDASH3_$P(PSSVB,PSSVB1,2))
"RTN","PSSLOOK",144,0)
 S PSSCALC=$S($G(PSSDASH):$S('$G(PSSVA1):PSSVA,1:$P(PSSVA1,PSSVA1,2))_"/"_$G(PSSDASH5),1:PSSUNIT)
"RTN","PSSLOOK",145,0)
 Q
"RTN","PSSLOOK",146,0)
 ;
"RTN","PSSLOOK",147,0)
LPDNW ;Display Dose Unit and Numeric Dose fields, added with patch PSS*1*147
"RTN","PSSLOOK",148,0)
 N PSSLKL1,PSSLKL2,PSSLKL3,PSSLKL4
"RTN","PSSLOOK",149,0)
 S PSSLKL4=""
"RTN","PSSLOOK",150,0)
 S PSSLKL1=$P(LPDOS,"^",5),PSSLKL2=$P(LPDOS,"^",6)
"RTN","PSSLOOK",151,0)
 I PSSLKL1 S PSSLKL4=$P($G(^PS(51.24,+PSSLKL1,0)),"^")
"RTN","PSSLOOK",152,0)
 S PSSLKL3=$S($E(PSSLKL2)=".":"0",1:"")_PSSLKL2
"RTN","PSSLOOK",153,0)
 I $L(PSSLKL3)<18 D FULL Q:$G(QUIT)  W !?5,"NUMERIC DOSE: "_PSSLKL3,?38,"DOSE UNIT: "_PSSLKL4 Q
"RTN","PSSLOOK",154,0)
 D FULL Q:$G(QUIT)  W !?5,"NUMERIC DOSE: "_PSSLKL3
"RTN","PSSLOOK",155,0)
 D FULL Q:$G(QUIT)  W !?38,"DOSE UNIT: "_PSSLKL4
"RTN","PSSLOOK",156,0)
 Q
"RTN","PSSPOIMN")
0^7^B82446313^B62103637
"RTN","PSSPOIMN",1,0)
PSSPOIMN ;BIR/RTR/WRT-Orderable Item manual create ;09/01/98
"RTN","PSSPOIMN",2,0)
 ;;1.0;PHARMACY DATA MANAGEMENT;**15,32,34,38,51,57,82,125,189**;9/30/97;Build 54
"RTN","PSSPOIMN",3,0)
 ;
"RTN","PSSPOIMN",4,0)
 ;Reference to ^PS(59 supported by DBIA #1976
"RTN","PSSPOIMN",5,0)
 ;Reference to $$PSJDF^PSNAPIS(P1,P3) supported by DBIA #2531
"RTN","PSSPOIMN",6,0)
 ;Reference to $$VAGN^PSNAPIS(P1) supported by DBIA #2531
"RTN","PSSPOIMN",7,0)
 ;
"RTN","PSSPOIMN",8,0)
 N PSSDONE
"RTN","PSSPOIMN",9,0)
 S PSSITE=+$O(^PS(59.7,0)) I +$P($G(^PS(59.7,PSSITE,80)),"^",2)<2 W !!?3,"Orderable Item Auto-Create has not been completed yet!",! K PSSITE,DIR S DIR(0)="E",DIR("A")="Press RETURN to continue" D ^DIR K DIR Q
"RTN","PSSPOIMN",10,0)
 K PSSITE D MESS^PSSPOIM1
"RTN","PSSPOIMN",11,0)
BEG I $D(PSIEN) L -^PSDRUG(PSIEN)
"RTN","PSSPOIMN",12,0)
 K PSSCROSS,DOSEFV,DOSEFORM,POINT,SPHOLD,NEWSP,PSVAR1,PSITEM,PSTOP,PSMASTER,DIC("S")
"RTN","PSSPOIMN",13,0)
 S PSOUT=0 W !! K DIC S DIC(0)="QEAM",DIC="^PSDRUG(",DIC("A")="Select DISPENSE DRUG: "
"RTN","PSSPOIMN",14,0)
 ;DIC("S")="I $P($G(^PSDRUG(+Y,2)),""^"",3)[""I""!($P($G(^(2)),""^"",3)[""O"")!($P($G(^(2)),""^"",3)[""U"")"
"RTN","PSSPOIMN",15,0)
 D ^DIC G:$D(DTOUT)!($D(DUOUT))!(Y<1) END K DIC("S") S PSIEN=+Y,PSNAME=$P(^PSDRUG(PSIEN,0),"^") L +^PSDRUG(PSIEN):$S($G(DILOCKTM)>0:DILOCKTM,1:3) I '$T W !,$C(7),"Another person is editing this one." Q
"RTN","PSSPOIMN",16,0)
MAS I $G(PSMASTER) S PSOUT=0 N DOSEFV,DOSEFORM,POINT,SPHOLD,NEWSP,PSVAR1,PSITEM,PSTOP
"RTN","PSSPOIMN",17,0)
 S NODE=$G(^PSDRUG(PSIEN,"ND")),DOSEPTR=0,DA=$P(NODE,"^"),X=$$VAGN^PSNAPIS(DA),VAGEN=X I +$P(NODE,"^"),+$P(NODE,"^",3),VAGEN'=0 S K=$P(NODE,"^",3),X=$$PSJDF^PSNAPIS(DA,K),DOSEFV=X I DOSEFV'=0 D
"RTN","PSSPOIMN",18,0)
 .S DOSEPTR=$P(X,"^"),DOSEFORM=$P(X,"^",2)
"RTN","PSSPOIMN",19,0)
 D TMP
"RTN","PSSPOIMN",20,0)
 I +$P($G(^PSDRUG(PSIEN,2)),"^") S (POINT,PSITEM)=$P(^(2),"^") W !!,PSNAME," is already matched to",!!,?5,$P($G(^PS(50.7,POINT,0)),"^")_" "_$P($G(^PS(50.606,+$P($G(^(0)),"^",2),0)),"^"),!
"RTN","PSSPOIMN",21,0)
 ;Warn user the Orderable Item is inactive. Display date and option to use.
"RTN","PSSPOIMN",22,0)
 I $G(POINT) N PSSIAD D
"RTN","PSSPOIMN",23,0)
 .S PSSIAD=$P($G(^PS(50.7,POINT,0)),"^",4) I $G(PSSIAD) S Y=PSSIAD D DD^%DT W !,"This Orderable Item has an Inactive Date.  *** "_Y,!,"To modify the Orderable Item, use the 'Edit Orderable Item' option."
"RTN","PSSPOIMN",24,0)
 I $G(POINT) D  W ! K DIR S DIR("B")="NO",DIR(0)="Y",DIR("A")="Do you want to match to a different Orderable Item" D ^DIR K DIR D:Y=1 MORE,SET,REM D SETX G:$G(PSMASTER) END G BEG
"RTN","PSSPOIMN",25,0)
 .K PSSDXLF
"RTN","PSSPOIMN",26,0)
 D MCH
"RTN","PSSPOIMN",27,0)
 G:'$G(PSMASTER) BEG
"RTN","PSSPOIMN",28,0)
END I $D(PSIEN) I '$G(PSSHUIDG) D DRG^PSSHUIDG(PSIEN) D  L -^PSDRUG(PSIEN)
"RTN","PSSPOIMN",29,0)
 .N XX,DVER,DNSNAM,DNSPORT,DMFU S XX=""
"RTN","PSSPOIMN",30,0)
 .F XX=0:0 S XX=$O(^PS(59,XX)) Q:'XX  D
"RTN","PSSPOIMN",31,0)
 ..S DVER=$$GET1^DIQ(59,XX_",",105,"I"),DMFU=$$GET1^DIQ(59,XX_",",105.2)
"RTN","PSSPOIMN",32,0)
 ..I DVER="2.4" S DNSNAM=$$GET1^DIQ(59,XX_",",2006),DNSPORT=$$GET1^DIQ(59,XX_",",2007) I DNSNAM'=""&(DMFU="YES") D DRG^PSSDGUPD(PSIEN,"",DNSNAM,DNSPORT)
"RTN","PSSPOIMN",33,0)
 G END^PSSPOIM1
"RTN","PSSPOIMN",34,0)
REM D TMP
"RTN","PSSPOIMN",35,0)
 I $O(^TMP($J,"PSSOO",0)) H 1 D OTHER^PSSPOIM1,DISP
"RTN","PSSPOIMN",36,0)
 I $G(PSOUT) Q
"RTN","PSSPOIMN",37,0)
 S PSSDONE=0
"RTN","PSSPOIMN",38,0)
 I $O(^TMP($J,"PSSOO",0)),$G(MATCH) D  I PSSDONE Q
"RTN","PSSPOIMN",39,0)
 .S PSSP=MATCH D ^PSSPOIM1 Q:(PSOUT)!(PSNO)
"RTN","PSSPOIMN",40,0)
 .;Checking whether the Orderable Item would have duplicate IV Solution Volumes
"RTN","PSSPOIMN",41,0)
 .I $$CKDUPVOL(+MATCH,PSIEN) Q
"RTN","PSSPOIMN",42,0)
 .S DIE="^PSDRUG(",DA=PSIEN,DR="2.1////"_MATCH  D ^DIE K DIE S PSITEM=MATCH,PSSDONE=1 D COM
"RTN","PSSPOIMN",43,0)
 G MCHA
"RTN","PSSPOIMN",44,0)
TMP K ^TMP($J,"PSSOO") S PSCNT=0 I +$P(NODE,"^"),+$P(NODE,"^",3) F ZZ=0:0 S ZZ=$O(^PSDRUG("AND",+NODE,ZZ)) Q:'ZZ  I +$P($G(^PSDRUG(ZZ,2)),"^"),$P(^PSDRUG(ZZ,2),"^")'=$G(POINT),$D(^PS(50.7,$P(^PSDRUG(ZZ,2),"^"),0)) S OTH=$G(^PSDRUG(ZZ,"ND")) D
"RTN","PSSPOIMN",45,0)
 .I +$P(OTH,"^"),+$P(OTH,"^",3),DOSEFV'=0 S DA=$P(OTH,"^"),K=$P(OTH,"^",3),X=$$PSJDF^PSNAPIS(DA,K),DOSA=X I DOSA'=0,DOSEFV=DOSA D
"RTN","PSSPOIMN",46,0)
 ..S NOFLAG=0,TMPTR=$P(^PSDRUG(ZZ,2),"^") F FFF=0:0 S FFF=$O(^TMP($J,"PSSOO",FFF)) Q:'FFF  I $P(^TMP($J,"PSSOO",FFF),"^")=TMPTR S NOFLAG=1
"RTN","PSSPOIMN",47,0)
 ..I 'NOFLAG S PSCNT=PSCNT+1 S ^TMP($J,"PSSOO",PSCNT)=$P(^PSDRUG(ZZ,2),"^")_"^"_ZZ
"RTN","PSSPOIMN",48,0)
 Q
"RTN","PSSPOIMN",49,0)
DISP S MATCH=0 F TT=0:0 S TT=$O(^TMP($J,"PSSOO",TT)) Q:'TT  S SPT=$P(^TMP($J,"PSSOO",TT),"^") W !,TT,"  ",$P($G(^PS(50.7,SPT,0)),"^")_" "_$P($G(^PS(50.606,+$P($G(^(0)),"^",2),0)),"^") I $Y+5>IOSL D  Q:Y=0  I Y="" S PSOUT=1 Q
"RTN","PSSPOIMN",50,0)
 .W ! K DIR S DIR(0)="E" D ^DIR I Y W @IOF W !,?3,"Dispense Drug -> ",PSNAME,!
"RTN","PSSPOIMN",51,0)
DISPO Q:$G(PSOUT)  W ! K DIR S DIR(0)="N",DIR("A")="Choose number of Orderable Item to match, or '^' to enter a new one" D ^DIR K DIR I Y=""!($D(DTOUT)) S PSOUT=1 Q
"RTN","PSSPOIMN",52,0)
 Q:Y["^"  I '$D(^TMP($J,"PSSOO",+Y)) W !!,?5,"INVALID NUMBER" G DISPO
"RTN","PSSPOIMN",53,0)
 S MATCH=$P(^TMP($J,"PSSOO",+Y),"^") Q
"RTN","PSSPOIMN",54,0)
 S PSOUT=1 Q
"RTN","PSSPOIMN",55,0)
MCH ;
"RTN","PSSPOIMN",56,0)
 I $O(^TMP($J,"PSSOO",0)) H 1 D OTHER^PSSPOIM1,DISP
"RTN","PSSPOIMN",57,0)
 I $G(PSOUT) Q
"RTN","PSSPOIMN",58,0)
 S PSSDONE=0
"RTN","PSSPOIMN",59,0)
 I $O(^TMP($J,"PSSOO",0)),$G(MATCH) D  I PSSDONE Q
"RTN","PSSPOIMN",60,0)
 .S PSSP=MATCH D ^PSSPOIM1 I (PSOUT)!(PSNO) Q
"RTN","PSSPOIMN",61,0)
 .;Checking whether the Orderable Item would have duplicate IV Solution Volumes
"RTN","PSSPOIMN",62,0)
 .I $$CKDUPVOL(+MATCH,PSIEN) Q
"RTN","PSSPOIMN",63,0)
 .K DIE S DIE="^PSDRUG(",DA=PSIEN,DR="2.1////"_MATCH D ^DIE S PSITEM=MATCH D COM S PSSDONE=1
"RTN","PSSPOIMN",64,0)
MCHA W ! I $G(DOSEFORM)'="" W !?3,"Dosage Form -> ",DOSEFORM,!! K DIR S DIR(0)="Y",DIR("B")="NO",DIR("A")="Match to another Orderable Item with same Dosage Form" D ^DIR G:Y=1 LOOK I Y["^"!(Y="")!($D(DTOUT)) Q
"RTN","PSSPOIMN",65,0)
 I $G(DOSEFORM)="" K DIC S DIC="^PS(50.606,",DIC(0)="QEAMZ",DIC("A")="Choose Dosage Form: " D ^DIC Q:$D(DTOUT)!($D(DUOUT))!(Y<1)  S DOSEPTR=+Y W !!?3,"Dose Form -> ",$G(Y(0,0))
"RTN","PSSPOIMN",66,0)
 I $G(DOSEFORM)="" K DIR W ! S DIR(0)="Y",DIR("B")="NO",DIR("A")="Match to another Orderable Item with same Dosage Form" D ^DIR
"RTN","PSSPOIMN",67,0)
 I $G(DOSEFORM)="" Q:$D(DTOUT)!($D(DUOUT))!(Y<0)  S DOSEFORM=$P(^PS(50.606,DOSEPTR,0),"^") G:Y>0 LOOK
"RTN","PSSPOIMN",68,0)
MCHAN W !! I $L(VAGEN)>40 W !,"VA Generic Name -> ",VAGEN,!
"RTN","PSSPOIMN",69,0)
 W !,?3,"Dosage Form   -> ",DOSEFORM,!,?3,"Dispense Drug -> ",PSNAME,!!
"RTN","PSSPOIMN",70,0)
 K DIR S DIR(0)="F^3:40",DIR("A")="Orderable Item Name" S:$L(VAGEN)>2&($L(VAGEN)<41) DIR("B")=VAGEN
"RTN","PSSPOIMN",71,0)
 D ^DIR Q:$D(DUOUT)!($D(DTOUT))!(Y["^")!(Y="")
"RTN","PSSPOIMN",72,0)
 I X[""""!($A(X)=45)!('(X'?1P.E))!(X?2"z".E) W $C(7),!!?5,"??" G MCHAN
"RTN","PSSPOIMN",73,0)
 S (X,SPHOLD)=Y,(STOP,PSNO)=0
"RTN","PSSPOIMN",74,0)
 F COMM=0:0 S COMM=$O(^PS(50.7,"ADF",SPHOLD,DOSEPTR,COMM)) Q:'COMM!(STOP)!($G(PSOUT))  I COMM,$P($G(^PS(50.7,COMM,0)),"^",3)="" D
"RTN","PSSPOIMN",75,0)
 .S PSSP=COMM D ^PSSPOIM1 S:PSNO STOP=1 I PSOUT!(STOP) Q
"RTN","PSSPOIMN",76,0)
 .;Checking whether the Orderable Item would have duplicate IV Solution Volumes
"RTN","PSSPOIMN",77,0)
 .I $$CKDUPVOL(+COMM,PSIEN) S PSOUT=1 Q
"RTN","PSSPOIMN",78,0)
 .K DIE S DIE="^PSDRUG(",DA=PSIEN,DR="2.1////"_COMM D ^DIE S PSITEM=COMM D COM S STOP=1
"RTN","PSSPOIMN",79,0)
 Q:PSOUT
"RTN","PSSPOIMN",80,0)
 I STOP,$G(PSNO) G MCHAN
"RTN","PSSPOIMN",81,0)
 Q:STOP
"RTN","PSSPOIMN",82,0)
 S PSMAN=1
"RTN","PSSPOIMN",83,0)
 D ^PSSPOIM1
"RTN","PSSPOIMN",84,0)
 G:PSNO MCHAN Q:PSOUT  K DIC S DIC="^PS(50.7,",DIC(0)="L",X=SPHOLD,DIC("DR")=".02////"_DOSEPTR K DD,DO D FILE^DICN K DD,DO D:Y<1  G:(Y<1) MCHAN S NEWSP=+Y,DIE="^PSDRUG(",DA=PSIEN,DR="2.1////"_NEWSP D ^DIE S PSVAR1=1,PSITEM=NEWSP D COM Q
"RTN","PSSPOIMN",85,0)
 .W $C(7),!?5,"Invalid entry!",!! Q
"RTN","PSSPOIMN",86,0)
 Q
"RTN","PSSPOIMN",87,0)
 ;
"RTN","PSSPOIMN",88,0)
LOOK ;
"RTN","PSSPOIMN",89,0)
 N PSSDONE
"RTN","PSSPOIMN",90,0)
 W !!!?3,"Enter ?? for Pharmacy Orderable Item List!",!
"RTN","PSSPOIMN",91,0)
 K DIC S DIC="^PS(50.7,",DIC(0)="QEAM"
"RTN","PSSPOIMN",92,0)
 S DIC("S")="I $P($G(^(0)),""^"",2)=DOSEPTR,$P($G(^(0)),""^"",3)=""""" D ^DIC
"RTN","PSSPOIMN",93,0)
 S PSSDONE=0
"RTN","PSSPOIMN",94,0)
 I Y>0 D  I PSSDONE Q
"RTN","PSSPOIMN",95,0)
 .S (NEWSP,PSSP)=+Y D ^PSSPOIM1 G:PSNO LOOK I PSOUT Q
"RTN","PSSPOIMN",96,0)
 .;Checking whether the Orderable Item would have duplicate IV Solution Volumes
"RTN","PSSPOIMN",97,0)
 .I $$CKDUPVOL(+NEWSP,PSIEN) Q
"RTN","PSSPOIMN",98,0)
 .S DIE="^PSDRUG(",DA=PSIEN,DR="2.1////"_NEWSP D ^DIE S PSITEM=NEWSP D COM S PSSDONE=1
"RTN","PSSPOIMN",99,0)
 W ! K DIR S DIR(0)="Y",DIR("B")="YES",DIR("A")="Create a new Orderable Item to match" D ^DIR I Y=1 G MCHAN
"RTN","PSSPOIMN",100,0)
 Q
"RTN","PSSPOIMN",101,0)
COM W !,"Match Complete!",! D EN^PSSPOIM1(PSITEM) Q
"RTN","PSSPOIMN",102,0)
 ;
"RTN","PSSPOIMN",103,0)
SET ;
"RTN","PSSPOIMN",104,0)
 S PSSDXLF=1,PSSDXL=+$P($G(^PS(50.7,+$G(POINT),0)),"^",2)
"RTN","PSSPOIMN",105,0)
 Q
"RTN","PSSPOIMN",106,0)
SETX ;
"RTN","PSSPOIMN",107,0)
 I $G(PSSDXLF),$G(PSSDXL),$G(PSITEM),$G(PSSDXL)'=+$P($G(^PS(50.7,+$G(PSITEM),0)),"^",2) K ^PSDRUG(PSIEN,"DOS2") I $G(PSIEN) D EN2^PSSUTIL(PSIEN,1)
"RTN","PSSPOIMN",108,0)
 K PSSDXL,PSSDXLF
"RTN","PSSPOIMN",109,0)
 Q
"RTN","PSSPOIMN",110,0)
MORE ;Show Additives and Solutions
"RTN","PSSPOIMN",111,0)
 Q:'$G(PSIEN)
"RTN","PSSPOIMN",112,0)
 N PSSMORA,PSSMORS,PSSMZ,PSSMZOUT,PSSMODT
"RTN","PSSPOIMN",113,0)
 S (PSSMORA,PSSMORS,PSSMZOUT)=0
"RTN","PSSPOIMN",114,0)
 I $O(^PS(52.6,"AC",PSIEN,0)) S PSSMORA=1
"RTN","PSSPOIMN",115,0)
 I $O(^PS(52.7,"AC",PSIEN,0)) S PSSMORS=1
"RTN","PSSPOIMN",116,0)
 I 'PSSMORA,'PSSMORS Q
"RTN","PSSPOIMN",117,0)
 W !!!,"There are "_$S('$G(PSSMORS):"IV Additives",'$G(PSSMORA):"IV Solutions",1:"IV Additives and IV Solutions")_" tied to this Dispense Drug."
"RTN","PSSPOIMN",118,0)
 W !,"By rematching the Dispense Drug to a new Pharmacy Orderable Item, all of these",!,$S('$G(PSSMORS):"IV Additives",'$G(PSSMORA):"IV Solutions",1:"IV Additives and IV Solutions")_" will also be rematched to the new Orderable Item.",!
"RTN","PSSPOIMN",119,0)
 K DIR S DIR(0)="E",DIR("A")="Press Return to see "_$S('$G(PSSMORS):"IV Additive",'$G(PSSMORA):"IV Solution",1:"IV Additive/Solution")_" list" D ^DIR I Y'=1 W ! Q
"RTN","PSSPOIMN",120,0)
 W @IOF
"RTN","PSSPOIMN",121,0)
 W !,$S('$G(PSSMORA):"IV Solutions",'$G(PSSMORS):"IV Additives",1:"IV Additives/Solutions"),!,"------------" I $G(PSSMORS),$G(PSSMORA) W "----------"
"RTN","PSSPOIMN",122,0)
 I $G(PSSMORA) D  G:$G(PSSMZOUT) MOREZ
"RTN","PSSPOIMN",123,0)
 .F PSSMZ=0:0 S PSSMZ=$O(^PS(52.6,"AC",PSIEN,PSSMZ)) Q:'PSSMZ!($G(PSSMZOUT))  D
"RTN","PSSPOIMN",124,0)
 ..D:($Y+5)>IOSL MOREH Q:$G(PSSMZOUT)
"RTN","PSSPOIMN",125,0)
 ..W !,$P($G(^PS(52.6,PSSMZ,0)),"^"),?42,"(A)"
"RTN","PSSPOIMN",126,0)
 ..S PSSMODT=$P($G(^PS(52.6,PSSMZ,"I")),"^") I PSSMODT D MODT
"RTN","PSSPOIMN",127,0)
 ;I $G(PSSMORA),$G(PSSMORS) W !
"RTN","PSSPOIMN",128,0)
 I $G(PSSMORS) D
"RTN","PSSPOIMN",129,0)
 .F PSSMZ=0:0 S PSSMZ=$O(^PS(52.7,"AC",PSIEN,PSSMZ)) Q:'PSSMZ!($G(PSSMZOUT))  D
"RTN","PSSPOIMN",130,0)
 ..D:($Y+5)>IOSL MOREH Q:$G(PSSMZOUT)
"RTN","PSSPOIMN",131,0)
 ..W !,$P($G(^PS(52.7,PSSMZ,0)),"^"),?31,$P($G(^(0)),"^",3),?42,"(S)"
"RTN","PSSPOIMN",132,0)
 ..S PSSMODT=$P($G(^PS(52.7,PSSMZ,"I")),"^") I PSSMODT D MODT
"RTN","PSSPOIMN",133,0)
MOREZ ;
"RTN","PSSPOIMN",134,0)
 I '$G(PSSMZOUT) W ! K DIR S DIR(0)="E",DIR("A")="Press RETURN to continue" D ^DIR K DIR
"RTN","PSSPOIMN",135,0)
 Q
"RTN","PSSPOIMN",136,0)
 ;
"RTN","PSSPOIMN",137,0)
MOREH ;
"RTN","PSSPOIMN",138,0)
 W ! K DIR S DIR(0)="E",DIR("A")="Press RETURN to continue" D ^DIR K DIR I 'Y S PSSMZOUT=1 Q
"RTN","PSSPOIMN",139,0)
 W @IOF
"RTN","PSSPOIMN",140,0)
 Q
"RTN","PSSPOIMN",141,0)
MODT ;
"RTN","PSSPOIMN",142,0)
 S Y=$G(PSSMODT) I $G(Y) D DD^%DT W ?50,$G(Y) K Y
"RTN","PSSPOIMN",143,0)
 Q
"RTN","PSSPOIMN",144,0)
 ;
"RTN","PSSPOIMN",145,0)
CKDUPVOL(OIIEN,DRUGIEN) ; Checks OI to see if it will have duplicate IV Solution Volumes
"RTN","PSSPOIMN",146,0)
 ; Input: OIIEN   - PHARMACY ORDERABLE ITEM File (#50.7) IEN
"RTN","PSSPOIMN",147,0)
 ;        DRUGIEN - DRUG File (#50) IEN
"RTN","PSSPOIMN",148,0)
 ;Output: DUPVOL  - 0: No Duplicate Volume / 1: Duplicate Volume
"RTN","PSSPOIMN",149,0)
 N DUPVOL,IVSOL,PSSQUIT S (IVSOL,DUPVOL)=0
"RTN","PSSPOIMN",150,0)
 F  S IVSOL=$O(^PS(52.7,"AC",DRUGIEN,IVSOL)) Q:'IVSOL  D  I DUPVOL Q
"RTN","PSSPOIMN",151,0)
 .; IV Solution field USED IN IV FLUID ORDER ENTRY set to 'NO'
"RTN","PSSPOIMN",152,0)
 .I '$$GET1^DIQ(52.7,IVSOL,17,"I") Q
"RTN","PSSPOIMN",153,0)
 .; IV Solution is INACTIVE, no issues
"RTN","PSSPOIMN",154,0)
 .I $$GET1^DIQ(52.7,IVSOL,8,"I"),$$GET1^DIQ(52.7,IVSOL,8,"I")'>DT Q
"RTN","PSSPOIMN",155,0)
 .I $$CKDUPSOL^PSSDDUT2(OIIEN,IVSOL,$$GET1^DIQ(52.7,IVSOL,2),0) D
"RTN","PSSPOIMN",156,0)
 ..W !!,"Matching ",$$GET1^DIQ(50,DRUGIEN,.01)," to ",$$GET1^DIQ(50.7,OIIEN,.01)," would cause the"
"RTN","PSSPOIMN",157,0)
 ..W !,"orderable item to have more than one Active IV Solution with the same volume"
"RTN","PSSPOIMN",158,0)
 ..W !,"marked to be used in the IV FLUID ORDER ENTRY, which is not allowed."
"RTN","PSSPOIMN",159,0)
 ..W !,""
"RTN","PSSPOIMN",160,0)
 ..W !,"Please, review the IV Solutions associated with this drug before matching it"
"RTN","PSSPOIMN",161,0)
 ..W !,"to this orderable item or match it to a different orderable item."
"RTN","PSSPOIMN",162,0)
 ..S DUPVOL=1
"RTN","PSSPOIMN",163,0)
 Q DUPVOL
"RTN","PSSPOIMO")
0^4^B140931303^B139454544
"RTN","PSSPOIMO",1,0)
PSSPOIMO ;BIR/RTR/WRT-Edit Orderable Item Name and Inactive date ;4/28/09 4:39pm
"RTN","PSSPOIMO",2,0)
 ;;1.0;PHARMACY DATA MANAGEMENT;**29,32,38,47,68,102,125,141,153,159,166,172,191,189**;9/30/97;Build 54
"RTN","PSSPOIMO",3,0)
 S PSSITE=+$O(^PS(59.7,0)) I +$P($G(^PS(59.7,PSSITE,80)),"^",2)<2 W !!?3,"Orderable Item Auto-Create has not been completed yet!",! K PSSITE K DIR S DIR("A")="Press RETURN to continue",DIR(0)="E" D ^DIR K DIR Q
"RTN","PSSPOIMO",4,0)
 K PSSITE W !!,"This option enables you to edit Orderable Item names, Formulary status,",!,"drug text, Inactive Dates, and Synonyms."
"RTN","PSSPOIMO",5,0)
EN I $D(PSOIEN) L -^PS(50.7,PSOIEN)
"RTN","PSSPOIMO",6,0)
 K PSSCROSS,DTOUT,DUOUT,DIRUT
"RTN","PSSPOIMO",7,0)
 K DIC ; S PY=$P($G(^PS(59.7,1,31)),"^",2)
"RTN","PSSPOIMO",8,0)
 S PSS1="W ""  ""_$P(^PS(50.606,$P(^PS(50.7,+Y,0),""^"",2),0),""^"")_""  ""_$S($P($G(^PS(50.7,+Y,0)),""^"",4):$E($P(^(0),""^"",4),4,5)_""-""_$E($P(^(0),""^"",4),6,7)_""-""_$E($P(^(0),""^"",4),2,3),1:"""")"
"RTN","PSSPOIMO",9,0)
 S PSS2=" S NF=$P($G(^PS(50.7,+Y,0)),""^"",12) I NF S NF=""   N/F"" W NF"
"RTN","PSSPOIMO",10,0)
 S DIC("W")=PSS1_PSS2,DIC("S")="I '$P($G(^PS(50.7,+Y,0)),""^"",3)"
"RTN","PSSPOIMO",11,0)
 ;PSO*7*102;ONLY SEARCH B AND C X-REFS
"RTN","PSSPOIMO",12,0)
 S $P(PLINE,"-",79)="" W !! K PSOUT S DIC="^PS(50.7,",DIC(0)="QEAMZ",D="B^C" D MIX^DIC1 K DIC,PY,D G:Y<0!($D(DTOUT))!($D(DUOUT)) END
"RTN","PSSPOIMO",13,0)
 S PSOIEN=+Y,PSOINAME=$P(Y,"^",2),PSDOSE=+$P(^PS(50.7,PSOIEN,0),"^",2) L +^PS(50.7,PSOIEN):$S($G(DILOCKTM)>0:DILOCKTM,1:3) I '$T W !,$C(7),"Another person is editing this one." Q
"RTN","PSSPOIMO",14,0)
 W !!!,?5,"Orderable Item -> ",PSOINAME,!?5,"Dosage Form    -> ",$P($G(^PS(50.606,PSDOSE,0)),"^"),!
"RTN","PSSPOIMO",15,0)
 K DIR S DIR("?")=" ",DIR("?",1)="Enter 'Yes' to see all of the Dispense Drugs, IV Additives, and IV Solutions",DIR("?",2)="that are matched to this Orderable Item. IV Additives will be identified with"
"RTN","PSSPOIMO",16,0)
 S DIR("?",3)="an (A), and IV Solutions with an (S)."
"RTN","PSSPOIMO",17,0)
 S DIR(0)="Y",DIR("B")="YES",DIR("A")="List all Drugs/Additives/Solutions tied to this Orderable Item" D ^DIR K DIR I Y["^"!($D(DTOUT))!($D(DUOUT)) G EN
"RTN","PSSPOIMO",18,0)
 I Y D DISP
"RTN","PSSPOIMO",19,0)
EDIT K DIR W ! S DIR(0)="Y",DIR("A")="Are you sure you want to edit this Orderable Item",DIR("B")="NO",DIR("?")="Answer YES to edit the fields associated with this Orderable Item." D ^DIR K DIR I 'Y!($D(DTOUT))!($D(DUOUT)) G EN
"RTN","PSSPOIMO",20,0)
 W !!?3,"Now editing Orderable Item:",!?3,PSOINAME,"   ",$P($G(^PS(50.606,PSDOSE,0)),"^")
"RTN","PSSPOIMO",21,0)
DIR K DIR S DIR(0)="F^3:40",DIR("B")=PSOINAME,DIR("A")="Orderable Item Name" D ^DIR
"RTN","PSSPOIMO",22,0)
 I Y["^"!($D(DUOUT))!($D(DTOUT)) G EN
"RTN","PSSPOIMO",23,0)
 I X[""""!($A(X)=45)!('(X'?1P.E))!(X?2"z".E) W $C(7),!!?5,"??" G DIR
"RTN","PSSPOIMO",24,0)
 I X'=PSOINAME S ZZFLAG=0 D @$S('$P($G(^PS(50.7,PSOIEN,0)),"^",3):"CHECK",1:"ZCHECK") I ZZFLAG G DIR
"RTN","PSSPOIMO",25,0)
 S PSONEW=X,DIE="^PS(50.7,",DA=PSOIEN,DR=".01////"_X D ^DIE I PSONEW'=PSOINAME W !!,"Name changed from  ",PSOINAME,!?15,"to  ",PSONEW
"RTN","PSSPOIMO",26,0)
 S PSSDTENT=0 W ! K DIE N MFLG S PSBEFORE=$P(^PS(50.7,PSOIEN,0),"^",4),PSAFTER=0,PSINORDE="" D
"RTN","PSSPOIMO",27,0)
 .;If reactivate OI, prompt to reactivate DD's only if there are any, then always give message saying OI now Active. If Inactivate, prompt to inactivate any active DD's if there are any, and give message
"RTN","PSSPOIMO",28,0)
 .;but if OI is reactivated, and there are no activities matched to it, and user does not want to activate the drugs, then inactivate the OI again, and give a clear message explaining this.
"RTN","PSSPOIMO",29,0)
 .W !,"This Orderable Item is "_$S($P($G(^PS(50.7,PSOIEN,0)),"^",12):"Non-Formulary.",1:"Formulary."),!
"RTN","PSSPOIMO",30,0)
 .I $P($G(^PS(50.7,PSOIEN,0)),"^",10) W !,"This Orderable Item is marked as a Non-VA Med.",!
"RTN","PSSPOIMO",31,0)
 .S DIE="^PS(50.7,",DA=PSOIEN,DR=6 S PSCREATE=1 D ^DIE K DIE,PSCREATE I $D(DTOUT)!($D(Y)>10) Q
"RTN","PSSPOIMO",32,0)
 .;PSS*1*102;ADD DRUG TEXT AS SYNONYM IS REQUESTED BY USER
"RTN","PSSPOIMO",33,0)
 .D ADDSYN^PSSPOIMP
"RTN","PSSPOIMO",34,0)
 .K DIR S DIR(0)="DO",DIR("A")="INACTIVE DATE" D  D ^DIR K DIR I $G(Y)["^"!($D(DTOUT))!($G(DUOUT)) Q
"RTN","PSSPOIMO",35,0)
 ..I $G(PSBEFORE) S Y=PSBEFORE D DD^%DT S DIR("B")=$G(Y)
"RTN","PSSPOIMO",36,0)
 .I $G(PSBEFORE),'$G(Y) W ?40,"Inactive Date deleted!"
"RTN","PSSPOIMO",37,0)
 .S PSSDTENT=$G(Y) I $G(Y) D DD^%DT W ?40,$G(Y)
"RTN","PSSPOIMO",38,0)
 .S PSSOTH=$S($P($G(^PS(59.7,1,40.2)),"^"):1,1:0)
"RTN","PSSPOIMO",39,0)
 .S DIE="^PS(50.7,",DA=PSOIEN N PSSFG,PSSOU
"RTN","PSSPOIMO",40,0)
 .S DR=".05;@1;D SETF^PSSPOIMO;.06;D DFR^PSSPOIMO(PSDOSE);10//YES;I X=""Y"" S Y=""@2"";S:$G(DUOUT) Y=""@3"";" D
"RTN","PSSPOIMO",41,0)
 ..S DR=DR_"D PDCHK^PSSPOIMO S:PSSFG Y=""@1"";S:$G(DUOUT) Y=""@3"";@2;K DIE(""NO^""),DIRUT;D MRSEL^PSSPOIMO;.07;.08;1;12//0;7;S:'$G(PSSOTH) Y=""@3"";7.1;@3" ;*191
"RTN","PSSPOIMO",42,0)
 .S PSCREATE=1 D ^DIE K DIE,PSCREATE,PSSOTH,^TMP("PSJMR",$J),^TMP("PSSDMR",$J) I $D(PSSOU),'$G(PSSOU) D MRSEL K ^TMP("PSJMR",$J)
"RTN","PSSPOIMO",43,0)
 .S $P(^PS(50.7,PSOIEN,0),"^",4)=PSSDTENT,PSAFTER=PSSDTENT
"RTN","PSSPOIMO",44,0)
 S:PSBEFORE&('$P(^PS(50.7,PSOIEN,0),"^",4)) PSINORDE="D" S:$P(^PS(50.7,PSOIEN,0),"^",4) PSINORDE="I"
"RTN","PSSPOIMO",45,0)
 I PSINORDE'="" D CHECK^PSSPOID2(PSOIEN) D
"RTN","PSSPOIMO",46,0)
 .I PSINORDE="D" D  Q
"RTN","PSSPOIMO",47,0)
 ..I $O(PSSDACTI(0))!($O(PSSSACTI(0)))!($O(PSSAACTI(0))) D
"RTN","PSSPOIMO",48,0)
 ...W !!,"There are inactive "_$S($O(PSSDACTI(0)):"drugs, ",1:"")_$S($O(PSSAACTI(0)):"additives, ",1:"")_$S($O(PSSSACTI(0)):"solutions,",1:""),!,"matched to this Pharmacy Orderable Item."
"RTN","PSSPOIMO",49,0)
 .I $O(PSSDACT(0))!($O(PSSSACT(0)))!($O(PSSAACT(0))) D
"RTN","PSSPOIMO",50,0)
 ..W !!,"There are active "_$S($O(PSSDACT(0)):"drugs, ",1:"")_$S($O(PSSAACT(0)):"additives, ",1:"")_$S($O(PSSSACT(0)):"solutions,",1:""),!,"matched to this Pharmacy Orderable Item."
"RTN","PSSPOIMO",51,0)
 I $G(PSINORDE)="D" I $O(PSSDACTI(0))!($O(PSSSACTI(0)))!($O(PSSAACTI(0))) D REST^PSSPOIDT(PSOIEN)
"RTN","PSSPOIMO",52,0)
 I $G(PSINORDE)="I" I $O(PSSDACT(0))!($O(PSSSACT(0)))!($O(PSSAACT(0))) D REST^PSSPOIDT(PSOIEN)
"RTN","PSSPOIMO",53,0)
 S DIK="^PS(50.7,",DA=PSOIEN,DIK(1)=.04 D EN^DIK K DIK
"RTN","PSSPOIMO",54,0)
 K PSBEFORE,PSAFTER,PSINORDE,PSSDTENT,PSSDACT,PSSDACTI,PSSSACT,PSSSACTI,PSSAACT,PSSAACTI
"RTN","PSSPOIMO",55,0)
IMMUN ;PSS*1*141 FOR 'IMMUNIZATIONS DOCUMENTATION BY BCMA'
"RTN","PSSPOIMO",56,0)
 I $O(^PSDRUG("AOC",PSOIEN,"IM000"))'["IM" G SYN ;ASK WHEN APPROPRIATE
"RTN","PSSPOIMO",57,0)
 W ! S DIE="^PS(50.7,",DA=PSOIEN,DR=9 D ^DIE K DIE
"RTN","PSSPOIMO",58,0)
SYN I $G(Y)["^"!($G(DIRUT))!$D(DTOUT)!($D(Y)>10) G EN
"RTN","PSSPOIMO",59,0)
 W ! K DIC S:'$D(^PS(50.7,PSOIEN,2,0)) ^PS(50.7,PSOIEN,2,0)="^50.72^0^0" S DIC="^PS(50.7,"_PSOIEN_",2,",DA(1)=PSOIEN,DIC(0)="QEAMZL",DIC("A")="Select SYNONYM: ",DLAYGO=50.72 D ^DIC K DIC
"RTN","PSSPOIMO",60,0)
 I Y<0!($D(DUOUT))!($D(DTOUT)) K:'$O(^PS(50.7,PSOIEN,2,0)) ^PS(50.7,PSOIEN,2,0) D EN^PSSPOIDT(PSOIEN),EN2^PSSHL1(PSOIEN,"MUP") G EN
"RTN","PSSPOIMO",61,0)
 W ! S DA=+Y,DIE="^PS(50.7,"_PSOIEN_",2,",DA(1)=PSOIEN,DR=.01 D ^DIE K DIE G SYN
"RTN","PSSPOIMO",62,0)
 D EN^PSSPOIDT(PSOIEN),EN2^PSSHL1(PSOIEN,"MUP")
"RTN","PSSPOIMO",63,0)
 G EN
"RTN","PSSPOIMO",64,0)
END K ZZFLAG,DIC,DIR,DIE,DTOUT,DUOUT,DIRUT,FLAG,PSOINAME,PSOUT,PSDOSE,PSONEW,UPFLAG,VV,ZZ,AA,BB,Y,AAA,SSS,PSOARR,PSOARRAD,PLINE I $D(PSOIEN) L -^PS(50.7,PSOIEN) K PSOIEN
"RTN","PSSPOIMO",65,0)
 Q
"RTN","PSSPOIMO",66,0)
DISP N PSSLFLAG,PSSLDATE S FLAG=1 D HEAD F ZZ=0:0 S ZZ=$O(^PSDRUG("ASP",PSOIEN,ZZ)) Q:'ZZ!($G(PSOUT))  S FLAG=0 D:($Y+5)>IOSL HEAD Q:$G(PSOUT)  I ZZ W !,$P($G(^PSDRUG(ZZ,0)),"^") W:$P($G(^PSDRUG(ZZ,0)),"^",9) "   N/F" D DTE
"RTN","PSSPOIMO",67,0)
 Q:$G(PSOUT)
"RTN","PSSPOIMO",68,0)
 S (FLAG,PSSLFLAG)=0
"RTN","PSSPOIMO",69,0)
 F ZZ=0:0 S ZZ=$O(^PS(52.6,"AOI",PSOIEN,ZZ)) Q:'ZZ!($G(PSOUT))  D:($Y+5)>IOSL HEAD Q:$G(PSOUT)  I ZZ D
"RTN","PSSPOIMO",70,0)
 .S PSSLFLAG=1
"RTN","PSSPOIMO",71,0)
 .W !,$P($G(^PS(52.6,ZZ,0)),"^"),?31," (A) "
"RTN","PSSPOIMO",72,0)
 .W ?40,"Additive Strength: ",$S($$GET1^DIQ(52.6,ZZ,19)'="":$$GET1^DIQ(52.6,ZZ,19)_" "_$$GET1^DIQ(52.6,ZZ,2),1:"N/A")," "
"RTN","PSSPOIMO",73,0)
 .S PSSLDATE=$P($G(^PS(52.6,ZZ,"I")),"^") I PSSLDATE D DTEX
"RTN","PSSPOIMO",74,0)
 Q:$G(PSOUT)
"RTN","PSSPOIMO",75,0)
 ;I $G(PSSLFLAG) W !
"RTN","PSSPOIMO",76,0)
 F ZZ=0:0 S ZZ=$O(^PS(52.7,"AOI",PSOIEN,ZZ)) Q:'ZZ!($G(PSOUT))  D:($Y+5)>IOSL HEAD Q:$G(PSOUT)  I ZZ D
"RTN","PSSPOIMO",77,0)
 .W !,$P($G(^PS(52.7,ZZ,0)),"^"),?31,$P($G(^(0)),"^",3),?42,"(S)"
"RTN","PSSPOIMO",78,0)
 .S PSSLDATE=$P($G(^PS(52.7,ZZ,"I")),"^") I PSSLDATE D DTEX
"RTN","PSSPOIMO",79,0)
 Q
"RTN","PSSPOIMO",80,0)
HEAD I 'FLAG W ! K DIR S DIR(0)="E",DIR("A")="Press RETURN to continue" D ^DIR K DIR I 'Y S PSOUT=1 Q
"RTN","PSSPOIMO",81,0)
 W @IOF W !,?6,"Orderable Item ->  ",PSOINAME,!?6,"Dosage Form    ->  ",$P($G(^PS(50.606,+$P($G(^PS(50.7,PSOIEN,0)),"^",2),0)),"^"),!!,"Dispense Drugs:"_$S('FLAG:" (continued)",1:""),!,"---------------"
"RTN","PSSPOIMO",82,0)
 Q
"RTN","PSSPOIMO",83,0)
ADDIT ;If orderable item is flagged for IV
"RTN","PSSPOIMO",84,0)
 S AA=$O(^PS(52.6,"AOI",PSOIEN,0))
"RTN","PSSPOIMO",85,0)
 S BB=$O(^PS(52.7,"AOI",PSOIEN,0))
"RTN","PSSPOIMO",86,0)
 I 'AA,'BB W $C(7),!,"This Orderable Item is flagged for IV use, but currently there are no IV",!,"Additives or IV Solutions matched to this Orderable Item!" G EDIT
"RTN","PSSPOIMO",87,0)
 G SOL
"RTN","PSSPOIMO",88,0)
CHECK ;
"RTN","PSSPOIMO",89,0)
 S ZZFLAG=0 F VV=0:0 S VV=$O(^PS(50.7,"ADF",X,PSDOSE,VV)) Q:'VV  I VV,'$P($G(^PS(50.7,VV,0)),"^",3) S ZZFLAG=1
"RTN","PSSPOIMO",90,0)
 I ZZFLAG W $C(7),!!?5,"There is already an Orderable Item with this same name and Dosage Form",!?5,"that is not flagged as 'IV'. Use the 'DISPENSE DRUG/ORDERABLE ITEM",!?5,"MAINTENANCE' option if you want to re-match to this Orderable Item!",!
"RTN","PSSPOIMO",91,0)
 Q
"RTN","PSSPOIMO",92,0)
ZCHECK ;
"RTN","PSSPOIMO",93,0)
 S ZZFLAG=0 F VV=0:0 S VV=$O(^PS(50.7,"ADF",X,PSDOSE,VV)) Q:'VV  I VV,$P($G(^PS(50.7,VV,0)),"^",3) S ZZFLAG=1
"RTN","PSSPOIMO",94,0)
 I ZZFLAG W $C(7),!!?5,"There is already an Orderable Item with the same name and Dosage Form,",!?5,"that is flagged for 'IV' use.",!
"RTN","PSSPOIMO",95,0)
 Q
"RTN","PSSPOIMO",96,0)
SOL ;
"RTN","PSSPOIMO",97,0)
 K DIR S DIR(0)="Y",DIR("B")="YES",DIR("A")="List all Additives and Solutions tied to this Orderable Item" D ^DIR K DIR G:Y["^"!($D(DTOUT)) EN G:Y=0 EDIT
"RTN","PSSPOIMO",98,0)
 H 1 K PSOARR,PSOARRAD S AAA=$O(^PS(52.6,"AOI",PSOIEN,0)) I AAA,$D(^PS(52.6,AAA,0)) S PSOARRAD=AAA
"RTN","PSSPOIMO",99,0)
 F SSS=0:0 S SSS=$O(^PS(52.7,"AOI",PSOIEN,SSS)) Q:'SSS  S:$D(^PS(52.7,SSS,0)) PSOARR(SSS)=""
"RTN","PSSPOIMO",100,0)
 S FLAG=1,UPFLAG=0 D SHEAD F ZZ=0:0 S ZZ=$O(PSOARR(ZZ)) Q:'ZZ!($G(PSOUT))!($G(UPFLAG))  S FLAG=0 D:($Y+7)>IOSL SHEAD Q:$G(PSOUT)!($G(UPFLAG))  I ZZ W !,$P($G(^PS(52.7,ZZ,0)),"^"),"   ",$P($G(^(0)),"^",3)
"RTN","PSSPOIMO",101,0)
 G:$G(PSOUT) EN
"RTN","PSSPOIMO",102,0)
 G EDIT
"RTN","PSSPOIMO",103,0)
SHEAD I 'FLAG W ! K DIR S DIR(0)="E",DIR("A")="Press RETURN to continue" D ^DIR K DIR I 'Y S:Y="" PSOUT=1 S:Y=0 UPFLAG=1 Q
"RTN","PSSPOIMO",104,0)
 W @IOF W !?6,"Orderable Item ->  ",PSOINAME,?68,"(IV)",!?6,"Dosage Form    ->  ",$P($G(^PS(50.606,+$P($G(^PS(50.7,PSOIEN,0)),"^",2),0)),"^"),!,PLINE I FLAG,'$G(PSOARRAD) W !?5,"IV Solutions:",!
"RTN","PSSPOIMO",105,0)
 I 'FLAG W !?5,"IV Solutions:",!
"RTN","PSSPOIMO",106,0)
 I FLAG,$G(PSOARRAD) W !,$P($G(^PS(52.6,PSOARRAD,0)),"^"),"    ","(IV Additive)",! I $D(PSOARR) W !?5,"IV Solutions:",!
"RTN","PSSPOIMO",107,0)
 Q
"RTN","PSSPOIMO",108,0)
DTE I $D(^PSDRUG(ZZ,"I")) S Y=$P(^PSDRUG(ZZ,"I"),"^") D DD^%DT W ?50,Y K Y
"RTN","PSSPOIMO",109,0)
 Q
"RTN","PSSPOIMO",110,0)
DTEX S Y=$G(PSSLDATE) D DD^%DT W ?50,$G(Y) K Y
"RTN","PSSPOIMO",111,0)
 Q
"RTN","PSSPOIMO",112,0)
IVMSG ; display a message if the CORRESPONDING IV field is entered
"RTN","PSSPOIMO",113,0)
 ;
"RTN","PSSPOIMO",114,0)
 S PSSIVMSG=$P(^PS(50.7,PSOIEN,0),"^",11) I PSSIVMSG="" Q
"RTN","PSSPOIMO",115,0)
 S PSSIVFRM=$P(^PS(50.7,PSSIVMSG,0),"^",2) I PSSIVFRM S PSSIVFRM=$P(^PS(50.606,PSSIVFRM,0),"^")
"RTN","PSSPOIMO",116,0)
 S PSSIVMSG=$P(^PS(50.7,PSSIVMSG,0),"^")_" "_PSSIVFRM
"RTN","PSSPOIMO",117,0)
 W !!,"The Corresponding IV Item is currently identified as: "_PSSIVMSG,!
"RTN","PSSPOIMO",118,0)
 K PSSIVFRM,PSSIVMSG
"RTN","PSSPOIMO",119,0)
 Q
"RTN","PSSPOIMO",120,0)
UDMSG ; display a message if the CORRESPONDING UD field is entered
"RTN","PSSPOIMO",121,0)
 ;
"RTN","PSSPOIMO",122,0)
 S PSSUDMSG=$P(^PS(50.7,PSOIEN,0),"^",10) I PSSUDMSG="" Q
"RTN","PSSPOIMO",123,0)
 S PSSUDFRM=$P(^PS(50.7,PSSUDMSG,0),"^",2) I PSSUDFRM S PSSUDFRM=$P(^PS(50.606,PSSUDFRM,0),"^")
"RTN","PSSPOIMO",124,0)
 S PSSUDMSG=$P(^PS(50.7,PSSUDMSG,0),"^")_" "_PSSUDFRM
"RTN","PSSPOIMO",125,0)
 W !!,"The Corresponding UD Item is currently identified as: "_PSSUDMSG,!
"RTN","PSSPOIMO",126,0)
 K PSSUDMSG,PSSUDFRM
"RTN","PSSPOIMO",127,0)
 Q
"RTN","PSSPOIMO",128,0)
DFR(PSDOSE) ; dosage form med routes - called by DR string at DIR+20^PSSPOIMO
"RTN","PSSPOIMO",129,0)
 D SETF
"RTN","PSSPOIMO",130,0)
 N MR,MRNODE,XX K ^TMP("PSSDMR",$J)
"RTN","PSSPOIMO",131,0)
 S (MCT,MR)=0 F  S MR=$O(^PS(50.606,PSDOSE,"MR",MR)) Q:'MR  D
"RTN","PSSPOIMO",132,0)
 .S XX=+$G(^PS(50.606,PSDOSE,"MR",MR,0)) Q:'XX  S MRNODE=$G(^PS(51.2,XX,0)) I $P($G(MRNODE),"^",4)'=1 Q
"RTN","PSSPOIMO",133,0)
 .S MCT=MCT+1,^TMP("PSSDMR",$J,MCT)=$P(MRNODE,U),^TMP("PSSDMR",$J,"B",XX)=""
"RTN","PSSPOIMO",134,0)
 D DFRL
"RTN","PSSPOIMO",135,0)
 Q
"RTN","PSSPOIMO",136,0)
DFRL W !!," List of med routes associated with the DOSAGE FORM of the orderable item:",!
"RTN","PSSPOIMO",137,0)
 S MCT=0 I '$O(^TMP("PSSDMR",$J,MCT)) W !,?3,"NO MED ROUTE DEFINED"
"RTN","PSSPOIMO",138,0)
 F  S MCT=$O(^TMP("PSSDMR",$J,MCT)) Q:'MCT  W !,?3,$G(^(MCT))
"RTN","PSSPOIMO",139,0)
 D EN^DDIOL(" If you answer YES to the next prompt, the DEFAULT MED ROUTE (if populated)",,"!!")
"RTN","PSSPOIMO",140,0)
 D EN^DDIOL(" and this list (if populated) will be displayed as selectable med routes",,"!")
"RTN","PSSPOIMO",141,0)
 D EN^DDIOL(" during medication ordering dialog. If you answer NO, the DEFAULT MED ROUTE",,"!")
"RTN","PSSPOIMO",142,0)
 D EN^DDIOL(" (if populated) and POSSIBLE MED ROUTES list will be displayed instead.",,"!") W !
"RTN","PSSPOIMO",143,0)
 ;K ^TMP("PSSMR",$J)
"RTN","PSSPOIMO",144,0)
 Q
"RTN","PSSPOIMO",145,0)
PDR ; possible med routes - called by DR string at DIR+20^PSSPOIMO
"RTN","PSSPOIMO",146,0)
 N MCT,MR,MRNODE,XX K ^TMP("PSSMR",$J)
"RTN","PSSPOIMO",147,0)
 S (XX,MCT)=0 F  S XX=$O(^PS(50.7,$S($G(PSVAR):PSVAR,1:PSOIEN),3,"B",XX)) Q:'XX  S MRNODE=$G(^PS(51.2,XX,0)),MCT=MCT+1,^TMP("PSSMR",$J,MCT)=$P(MRNODE,U)
"RTN","PSSPOIMO",148,0)
 I $O(^TMP("PSSMR",$J,0)) D
"RTN","PSSPOIMO",149,0)
 .W !!," List of Possible Med Routes associated with the orderable item:",!
"RTN","PSSPOIMO",150,0)
 .S MCT=0 F  S MCT=$O(^TMP("PSSMR",$J,MCT)) Q:'MCT  W !,?3,$G(^(MCT))
"RTN","PSSPOIMO",151,0)
 W ! K ^TMP("PSSMR",$J)
"RTN","PSSPOIMO",152,0)
 Q
"RTN","PSSPOIMO",153,0)
PDCHK ; called by DR string at DIR+20^PSSPOIMO
"RTN","PSSPOIMO",154,0)
 N ANS,D,DIC,DIE,DO,DICR,DR,DIR,PSOUT,PSSDA,PSSX,PSSXA,PSSY,Q,X,Y,Z
"RTN","PSSPOIMO",155,0)
 S DIR(0)="PO^51.2:EMZ",DIR("A")="POSSIBLE MED ROUTES",DIR("S")="I $P(^(0),U,4)" S PSOUT=0
"RTN","PSSPOIMO",156,0)
 S DIR("PRE")="I X=""?"" D MRTHLP^PSSPOIMO"
"RTN","PSSPOIMO",157,0)
 F  D PDR,^DIR D  I PSOUT Q
"RTN","PSSPOIMO",158,0)
 .I (X="")!$D(DTOUT)!$D(DUOUT) S PSOUT=1 Q
"RTN","PSSPOIMO",159,0)
 .I X="@",$D(PSSY) S ANS=DA D:$$DASK  Q
"RTN","PSSPOIMO",160,0)
 ..N DIK,DA S DA(1)=ANS,DIK="^PS(50.7,"_DA(1)_",3,"
"RTN","PSSPOIMO",161,0)
 ..S DA=$O(^PS(50.7,DA(1),3,"B",PSSY,"")) I DA="" Q
"RTN","PSSPOIMO",162,0)
 ..D ^DIK K PSSY,DIR("B")
"RTN","PSSPOIMO",163,0)
 .I Y="" W "  ??" Q
"RTN","PSSPOIMO",164,0)
 .I $D(^PS(50.7,DA,3,"B",+Y)) D  Q
"RTN","PSSPOIMO",165,0)
 ..I $D(DIR("B")) K PSSY,DIR("B") Q
"RTN","PSSPOIMO",166,0)
 ..S DIR("B")=Y(0,0),PSSY=+Y Q
"RTN","PSSPOIMO",167,0)
 .S PSSXA=Y(0,0),PSSX=+Y D DFR(+$P(^PS(50.7,DA,0),"^",2))
"RTN","PSSPOIMO",168,0)
 .I $G(PSSX) S ANS=$$ASK() I 'ANS Q
"RTN","PSSPOIMO",169,0)
 .S PSSDA(50.711,"+1,"_DA_",",.01)=+PSSX
"RTN","PSSPOIMO",170,0)
 .D UPDATE^DIE("","PSSDA")
"RTN","PSSPOIMO",171,0)
 .K ^TMP("PSSMR",$J)
"RTN","PSSPOIMO",172,0)
 D DP
"RTN","PSSPOIMO",173,0)
 Q
"RTN","PSSPOIMO",174,0)
ASK() ; confirm adding the new entry
"RTN","PSSPOIMO",175,0)
 N DIR,X,Y W ! S DIR(0)="YO",DIR("B")="YES"
"RTN","PSSPOIMO",176,0)
 I $D(^TMP("PSSDMR",$J)),'$D(^TMP("PSSDMR",$J,"B",PSSX)) S DIR("B")="NO",DIR("A",1)="The selected entry does not match to any of the dosage form med routes."
"RTN","PSSPOIMO",177,0)
 W $C(7) S DIR("A")="  Are you adding '"_PSSXA_"' as a new POSSIBLE MED ROUTE" D ^DIR
"RTN","PSSPOIMO",178,0)
 Q $S(Y=1:1,1:0)
"RTN","PSSPOIMO",179,0)
DASK() ; delete possible med route
"RTN","PSSPOIMO",180,0)
 N DIR
"RTN","PSSPOIMO",181,0)
 W $C(7) S DIR("A")="     SURE YOU WANT TO DELETE ",DIR(0)="Y" D ^DIR
"RTN","PSSPOIMO",182,0)
 Q $S(Y=1:1,1:0)
"RTN","PSSPOIMO",183,0)
MRTHLP ; help of possible med route
"RTN","PSSPOIMO",184,0)
 N DIC,RTE,D
"RTN","PSSPOIMO",185,0)
 S RTE=0 F  S RTE=$O(^PS(50.7,DA,3,"B",RTE)) Q:'RTE   D EN^DDIOL($P($G(^PS(51.2,RTE,0)),"^"),,"!,?4")
"RTN","PSSPOIMO",186,0)
 W ! D EN^DDIOL("Enter the most common MED ROUTE associated with this Orderable Item.",,"!,?5")
"RTN","PSSPOIMO",187,0)
 D EN^DDIOL("ONLY MED ROUTES MARKED FOR USE BY ALL PACKAGES ARE SELECTABLE.",,"!,?5")
"RTN","PSSPOIMO",188,0)
 Q
"RTN","PSSPOIMO",189,0)
DP ; check the existence of Default Med Route & Possible Med Routes
"RTN","PSSPOIMO",190,0)
 N D,DIC,DIE,DO,DICR,DR,DIR,Q,X,Y,Z
"RTN","PSSPOIMO",191,0)
 I '$P($G(^PS(50.7,$S($G(PSVAR):PSVAR,1:PSOIEN),0)),"^",6)&('$O(^PS(50.7,$S($G(PSVAR):PSVAR,1:PSOIEN),3,0))) D
"RTN","PSSPOIMO",192,0)
 .S PSR(1)=" You have not selected ANY med routes to display during order entry. In"
"RTN","PSSPOIMO",193,0)
 .S PSR(2)=" order to have med routes displayed during order entry, you must either"
"RTN","PSSPOIMO",194,0)
 .S PSR(3)=" define a DEFAULT MED ROUTE and/or at least one POSSIBLE MED ROUTE, or"
"RTN","PSSPOIMO",195,0)
 .S PSR(4)=" answer YES to the USE DOSAGE FORM MED ROUTE LIST prompt."
"RTN","PSSPOIMO",196,0)
 .S PSR(5)=" **WITH THE CURRENT SETTINGS, NO MED ROUTES WILL DISPLAY FOR SELECTION ",PSR(5,"F")="!!"
"RTN","PSSPOIMO",197,0)
 .S PSR(6)=" DURING ORDER ENTRY FOR THIS ORDERABLE ITEM**"
"RTN","PSSPOIMO",198,0)
 .D EN^DDIOL(.PSR),EN^DDIOL(" ","","!")
"RTN","PSSPOIMO",199,0)
 .K DIR S DIR(0)="Y",DIR("?",1)="If you select NO, you will continue to loop back to the Default Med Route"
"RTN","PSSPOIMO",200,0)
 .S DIR("?")="prompt until either a selection is made or you answer YES to this prompt to proceed."
"RTN","PSSPOIMO",201,0)
 .S DIR("A",1)="",DIR("A",2)="The current setting is usually only appropriate for supply items."
"RTN","PSSPOIMO",202,0)
 .S DIR("A")="Continue with NO med route displaying for selection during order entry",DIR("B")="NO"
"RTN","PSSPOIMO",203,0)
 .D ^DIR K DIR W ! I 'Y!($D(DTOUT))!($D(DUOUT)) S PSSFG=1
"RTN","PSSPOIMO",204,0)
 .S:Y PSSFG=0
"RTN","PSSPOIMO",205,0)
 E  S PSSFG=0
"RTN","PSSPOIMO",206,0)
 Q
"RTN","PSSPOIMO",207,0)
 ;
"RTN","PSSPOIMO",208,0)
SETF ;
"RTN","PSSPOIMO",209,0)
 S PSSOU=0 K ^TMP("PSJMR",$J) D MEDRT^PSSJORDF($S($G(PSVAR):PSVAR,1:PSOIEN))
"RTN","PSSPOIMO",210,0)
 I '$D(^TMP("PSJMR",$J)) S DIE("NO^")="",PSSFG=1
"RTN","PSSPOIMO",211,0)
 E  S PSSFG=0 K DIE("NO^")
"RTN","PSSPOIMO",212,0)
 Q
"RTN","PSSPOIMO",213,0)
MRSEL ;
"RTN","PSSPOIMO",214,0)
 K ^TMP("PSJMR",$J) D MEDRT^PSSJORDF($S($G(PSVAR):PSVAR,1:PSOIEN))
"RTN","PSSPOIMO",215,0)
 W !,"The following Med Routes will now be displayed during order entry:"
"RTN","PSSPOIMO",216,0)
 N I S (PSSOU,I)=0 F  S I=$O(^TMP("PSJMR",$J,I)) Q:'I   W !,$P(^(I),"^",2) S PSSOU=1
"RTN","PSSPOIMO",217,0)
 W:'PSSOU !,"(None)"
"RTN","PSSPOIMO",218,0)
 W ! S PSSOU=1
"RTN","PSSPOIMO",219,0)
 Q
"RTN","PSSPOIMO",220,0)
 ;
"RTN","PSSSCHED")
0^1^B16362165^B15804053
"RTN","PSSSCHED",1,0)
PSSSCHED ;BIR/JMC-BUILD SCHEDULE LIST FOR CPRS GUI SELECTION ; 10/15/15 4:21pm
"RTN","PSSSCHED",2,0)
 ;;1.0;PHARMACY DATA MANAGEMENT;**94,189**;9/30/97;Build 54
"RTN","PSSSCHED",3,0)
 ;
"RTN","PSSSCHED",4,0)
 ;
"RTN","PSSSCHED",5,0)
 Q  ;Cannot be called directly.  Must use API
"RTN","PSSSCHED",6,0)
 ;
"RTN","PSSSCHED",7,0)
SCHED(PSSWIEN,PSSARRY) ;Receive ward IEN from CPRS and return list of schedules.
"RTN","PSSSCHED",8,0)
 ;
"RTN","PSSSCHED",9,0)
 ;PSSWIEN   = Ward IEN
"RTN","PSSSCHED",10,0)
 ;PSSARRY   = array passed by reference from CPRS
"RTN","PSSSCHED",11,0)
 ;
"RTN","PSSSCHED",12,0)
 ;If there is a duplicate schedule, and if one of them contains
"RTN","PSSSCHED",13,0)
 ;ward-specific admin times for the ward location of the patient,
"RTN","PSSSCHED",14,0)
 ;the schedule returned for inclusion in the list of selectable
"RTN","PSSSCHED",15,0)
 ;schedules to CPRS will be the one with the ward-specific admin
"RTN","PSSSCHED",16,0)
 ;times.  If neither duplicate has ward-specific admin times,
"RTN","PSSSCHED",17,0)
 ;then the current functionality of the schedule with the lowest
"RTN","PSSSCHED",18,0)
 ;IEN number will remain in place.  If both (or more than one)
"RTN","PSSSCHED",19,0)
 ;duplicate schedules have ward-specific admin times for the ward
"RTN","PSSSCHED",20,0)
 ;location of the patient, then the one with the lowest IEN number
"RTN","PSSSCHED",21,0)
 ;will be the schedule returned to CPRS.
"RTN","PSSSCHED",22,0)
 ;
"RTN","PSSSCHED",23,0)
 ;Example:  Patient's ward location is ICU
"RTN","PSSSCHED",24,0)
 ;^PS(51.1,"APPSJ","BID",1)=""
"RTN","PSSSCHED",25,0)
 ;^PS(51.1,"APPSJ","BID",2)=""
"RTN","PSSSCHED",26,0)
 ;
"RTN","PSSSCHED",27,0)
 ;If ^PS(51.1,1 does not have ward-specific admin times for
"RTN","PSSSCHED",28,0)
 ;the ICU, but ^PS(51.1,2 does, ^PS(51.1,2 will be in the list
"RTN","PSSSCHED",29,0)
 ;of schedules returned to CPRS.
"RTN","PSSSCHED",30,0)
 ;
"RTN","PSSSCHED",31,0)
 ;If neither schedule has ward-specific admin times for the ICU
"RTN","PSSSCHED",32,0)
 ;then ^PS(51.1,1 will be in the list of schedules returned to CPRS.            
"RTN","PSSSCHED",33,0)
 ;
"RTN","PSSSCHED",34,0)
 ;If both schedules have ward-specific admin times for the ICU
"RTN","PSSSCHED",35,0)
 ;then ^PS(51.1,1 will be in the list of schedules returned to CPRS.
"RTN","PSSSCHED",36,0)
 ;
"RTN","PSSSCHED",37,0)
 ;The returned array to CPRS will be in the format:
"RTN","PSSSCHED",38,0)
 ;PSSARRY(n)=IEN^NAME^OUTPATIENT EXPANSION^SCHEDULE TYPE^ADMIN TIME
"RTN","PSSSCHED",39,0)
 ;
"RTN","PSSSCHED",40,0)
 N PSSSKED,PSSSKED1,PSSSK
"RTN","PSSSCHED",41,0)
 K ^TMP("PSSADMIN"),^TMP("PSSDUP")
"RTN","PSSSCHED",42,0)
 I $G(PSSWIEN)="" S PSSWIEN=0
"RTN","PSSSCHED",43,0)
 S PSSSKED=""
"RTN","PSSSCHED",44,0)
 F  S PSSSKED=$O(^PS(51.1,"APPSJ",PSSSKED)) Q:PSSSKED=""  D
"RTN","PSSSCHED",45,0)
 . S PSSSKED1="",PSSSK=1
"RTN","PSSSCHED",46,0)
 . F  S PSSSKED1=$O(^PS(51.1,"APPSJ",PSSSKED,PSSSKED1)) Q:PSSSKED1=""  D
"RTN","PSSSCHED",47,0)
 . . Q:$P($G(^PS(51.1,PSSSKED1,0)),"^",5)=""
"RTN","PSSSCHED",48,0)
 . . Q:$$GET1^DIQ(51.1,PSSSKED1,12,"I")  ;Schedule is marked Inactive
"RTN","PSSSCHED",49,0)
 . . S ^TMP("PSSDUP",$J,PSSSKED,PSSSK)=PSSSKED1  ;Identify duplicate schedules to work with.
"RTN","PSSSCHED",50,0)
 . . S ^TMP("PSSADMIN",$J,"STD",PSSSKED,PSSSKED1)=$S($P($G(^PS(51.1,PSSSKED1,1,PSSWIEN,0)),"^",2)'="":$P($G(^PS(51.1,PSSSKED1,1,PSSWIEN,0)),"^",2),1:$P($G(^PS(51.1,PSSSKED1,0)),"^",2))
"RTN","PSSSCHED",51,0)
 . . S PSSSK=PSSSK+1
"RTN","PSSSCHED",52,0)
 . I '$D(^TMP("PSSDUP",$J,PSSSKED,2)) K ^TMP("PSSDUP",$J,PSSSKED)
"RTN","PSSSCHED",53,0)
 I $D(^TMP("PSSDUP")) D DUP,FORMAT,KILL Q  ;Duplicate schedules - determine if any have ward-specific admin times
"RTN","PSSSCHED",54,0)
 I '$D(^TMP("PSSDUP")) D FORMAT,KILL Q  ;No duplicates in the schedule file - format for proper return to CPRS
"RTN","PSSSCHED",55,0)
 Q
"RTN","PSSSCHED",56,0)
KILL ;
"RTN","PSSSCHED",57,0)
 K ^TMP("PSSADMIN"),PSSSKED,PSSSKED1,PSSSK,PSSWIEN
"RTN","PSSSCHED",58,0)
 Q
"RTN","PSSSCHED",59,0)
DUP ;Compare duplicates to see if any have ward-specific admin times.
"RTN","PSSSCHED",60,0)
 S PSSSKED="",PSSSKED1=""
"RTN","PSSSCHED",61,0)
 F  S PSSSKED=$O(^TMP("PSSDUP",$J,PSSSKED)) Q:PSSSKED=""  D
"RTN","PSSSCHED",62,0)
 . S PSSSK=""
"RTN","PSSSCHED",63,0)
 . F  S PSSSK=$O(^TMP("PSSDUP",$J,PSSSKED,PSSSK)) Q:PSSSK=""  D
"RTN","PSSSCHED",64,0)
 . . S PSSSKED1=$G(^TMP("PSSDUP",$J,PSSSKED,PSSSK))
"RTN","PSSSCHED",65,0)
 . . I '$D(^TMP("PSSADMIN",$J,"STD",PSSSKED)) S ^TMP("PSSADMIN",$J,"STD",PSSSKED,PSSSKED1)=$P($G(^PS(51.1,PSSSKED1,0)),"^",2)
"RTN","PSSSCHED",66,0)
 . . I '$D(^PS(51.1,PSSSKED1,1,PSSWIEN,0)),PSSSK>1 K ^TMP("PSSADMIN",$J,"STD",PSSSKED,PSSSKED1) Q
"RTN","PSSSCHED",67,0)
 . . I $D(^PS(51.1,PSSSKED1,1,PSSWIEN,0)),'$D(^TMP("PSSADMIN",$J,"WARD",PSSSKED)) S ^TMP("PSSADMIN",$J,"WARD",PSSSKED,PSSSKED1)=$P($G(^PS(51.1,PSSSKED1,1,PSSWIEN,0)),"^",2)
"RTN","PSSSCHED",68,0)
 . . I $D(^TMP("PSSADMIN",$J,"WARD",PSSSKED)) D  Q
"RTN","PSSSCHED",69,0)
 . . . K ^TMP("PSSADMIN",$J,"STD",PSSSKED)
"RTN","PSSSCHED",70,0)
 . . . S ^TMP("PSSADMIN",$J,"STD",PSSSKED,PSSSKED1)=$G(^TMP("PSSADMIN",$J,"WARD",PSSSKED,PSSSKED1))
"RTN","PSSSCHED",71,0)
 . . . K ^TMP("PSSADMIN",$J,"WARD",PSSSKED)
"RTN","PSSSCHED",72,0)
 K ^TMP("PSSDUP")
"RTN","PSSSCHED",73,0)
 Q
"RTN","PSSSCHED",74,0)
FORMAT ;Format array for proper return to CPRS
"RTN","PSSSCHED",75,0)
 N PSSCNTR,PSSTMP
"RTN","PSSSCHED",76,0)
 S PSSSKED="",PSSSKED1="",PSSCNTR=1
"RTN","PSSSCHED",77,0)
 F  S PSSSKED=$O(^TMP("PSSADMIN",$J,"STD",PSSSKED)) Q:PSSSKED=""  D
"RTN","PSSSCHED",78,0)
 . F  S PSSSKED1=$O(^TMP("PSSADMIN",$J,"STD",PSSSKED,PSSSKED1)) Q:PSSSKED1=""  D
"RTN","PSSSCHED",79,0)
 . . S PSSTMP=$G(^PS(51.1,PSSSKED1,0))
"RTN","PSSSCHED",80,0)
 . . S PSSARRY(PSSCNTR)=PSSSKED1_"^"_PSSSKED_"^"_$P(PSSTMP,"^",8)_"^"_$P(PSSTMP,"^",5)_"^"_$G(^TMP("PSSADMIN",$J,"STD",PSSSKED,PSSSKED1))
"RTN","PSSSCHED",81,0)
 . . S PSSCNTR=PSSCNTR+1
"RTN","PSSSCHED",82,0)
 K PSSCNTR,PSSTMP
"RTN","PSSSCHED",83,0)
 Q
"RTN","PSSSCHRP")
0^5^B109340534^B109553620
"RTN","PSSSCHRP",1,0)
PSSSCHRP ;BIR/RTR-Schedule Report ; 10/15/15 4:26pm
"RTN","PSSSCHRP",2,0)
 ;;1.0;PHARMACY DATA MANAGEMENT;**129,160,189**;9/30/07;Build 54
"RTN","PSSSCHRP",3,0)
 ;
"RTN","PSSSCHRP",4,0)
EN ;Prompts for Administration File Schedule Report
"RTN","PSSSCHRP",5,0)
 W !!,"This report displays entries from the ADMINISTRATION SCHEDULE (#51.1) File."
"RTN","PSSSCHRP",6,0)
 W !,"It can be run for all Schedules, or only Schedules without a FREQUENCY"
"RTN","PSSSCHRP",7,0)
 W !,"(IN MINUTES). Only schedules with a PSJ Package Prefix will be displayed, since"
"RTN","PSSSCHRP",8,0)
 W !,"they are the only schedules the software will look at when deriving a FREQUENCY"
"RTN","PSSSCHRP",9,0)
 W !,"(IN MINUTES) for the daily dosage checks. If a FREQUENCY (IN MINUTES) cannot",!,"be determined for an order, the daily dosage check cannot occur for that order."
"RTN","PSSSCHRP",10,0)
 N DIR,PSSAFRP,PSSALONG,Y,X,DTOUT,DUOUT,DIRUT,DIROUT,IOP,%ZIS,POP,ZTRTN,ZTDESC,ZTSAVE,ZTSK
"RTN","PSSSCHRP",11,0)
 K DIR,Y S DIR(0)="SO^A:All Schedules;O:Only Schedules with a missing frequency",DIR("A")="Print All Schedules, or Only Schedules without a frequency",DIR("B")="A"
"RTN","PSSSCHRP",12,0)
 S DIR("?")=" ",DIR("?",1)=" ",DIR("?",2)="Enter 'A' to see all Administration Schedules, enter 'O' to see only",DIR("?",3)="those Administration Schedules without data in the FREQUENCY (IN MINUTES)"
"RTN","PSSSCHRP",13,0)
 S DIR("?",4)="(#2) Field. A FREQUENCY (IN MINUTES) must be derived from a Schedule",DIR("?",5)="for the daily dosage check to occur for an order."
"RTN","PSSSCHRP",14,0)
 W ! D ^DIR K DIR I $D(DUOUT)!($D(DTOUT)) D MESS K DIR,Y S DIR(0)="E",DIR("A")="Press Return to continue" D ^DIR K DIR Q
"RTN","PSSSCHRP",15,0)
 I Y'="A",Y'="O" D MESS K DIR,Y S DIR(0)="E",DIR("A")="Press Return to continue" D ^DIR K DIR Q
"RTN","PSSSCHRP",16,0)
 S PSSAFRP=Y
"RTN","PSSSCHRP",17,0)
 K DIR,Y S DIR(0)="SO^80:80 Column;132:132 Column",DIR("A")="Print report in 80 or 132 column format",DIR("B")="80"
"RTN","PSSSCHRP",18,0)
 S DIR("?")=" ",DIR("?",1)="Enter 80 to print the report in an 80 column format,",DIR("?",2)="Enter 132 to print the report in an 132 column format."
"RTN","PSSSCHRP",19,0)
 W ! D ^DIR K DIR I $D(DUOUT)!($D(DTOUT)) D MESS K DIR,Y S DIR(0)="E",DIR("A")="Press Return to continue" D ^DIR K DIR Q
"RTN","PSSSCHRP",20,0)
 I Y'="80",Y'="132" D MESS K DIR,Y S DIR(0)="E",DIR("A")="Press Return to continue" D ^DIR K DIR Q
"RTN","PSSSCHRP",21,0)
 S PSSALONG=Y W !
"RTN","PSSSCHRP",22,0)
 K IOP,%ZIS,POP S %ZIS="QM" D ^%ZIS I $G(POP)>0 D MESS K DIR,Y S DIR(0)="E",DIR("A")="Press Return to continue" D ^DIR K DIR,IOP,%ZIS,POP Q
"RTN","PSSSCHRP",23,0)
 I $D(IO("Q")) S ZTRTN="START^PSSSCHRP",ZTDESC="Administration Schedule Report",ZTSAVE("PSSAFRP")="",ZTSAVE("PSSALONG")="" D ^%ZTLOAD K %ZIS W !!,"Report queued to print.",! K DIR,Y S DIR(0)="E",DIR("A")="Press Return to continue" D ^DIR K DIR Q
"RTN","PSSSCHRP",24,0)
 ;
"RTN","PSSSCHRP",25,0)
 ;
"RTN","PSSSCHRP",26,0)
START ;Print Administration Schedule File report
"RTN","PSSSCHRP",27,0)
 U IO
"RTN","PSSSCHRP",28,0)
 N PSSAFCT,PSSAFOUT,PSSAFDEV,PSSAFLIN,PSSAFQ,PSSAFQEN,PSSAFQS,PSSAFQL,PSSAFQQ,PSSAFQC,PSSAFAA,PSSAFAL,PSSWAS,PSSWASEN,PSSWASNM,PSSWASAD,PSSWASLL,PSSTPE
"RTN","PSSSCHRP",29,0)
 N PSSAFRA,PSSAFRAA,PSSAFROP,PSSAFQL,PSSAFROO,PSSAFRFL,PSSWASX,PSSAFZZZ,PSSAFABC,PSSAFNOF
"RTN","PSSSCHRP",30,0)
 S (PSSAFOUT,PSSAFNOF)=0,PSSAFDEV=$S($E(IOST,1,2)'="C-":"P",1:"C"),PSSAFCT=1
"RTN","PSSSCHRP",31,0)
 K PSSAFLIN S:PSSALONG=132 $P(PSSAFLIN,"-",130)="" S:PSSALONG=80 $P(PSSAFLIN,"-",78)=""
"RTN","PSSSCHRP",32,0)
 D HD
"RTN","PSSSCHRP",33,0)
 S PSSAFQ="" F  S PSSAFQ=$O(^PS(51.1,"B",PSSAFQ)) Q:PSSAFQ=""!(PSSAFOUT)  D
"RTN","PSSSCHRP",34,0)
 .F PSSAFQEN=0:0 S PSSAFQEN=$O(^PS(51.1,"B",PSSAFQ,PSSAFQEN)) Q:'PSSAFQEN!(PSSAFOUT)  D
"RTN","PSSSCHRP",35,0)
 ..K PSSAFRA,PSSAFRAA,PSSAFROP,PSSAFQS,PSSAFROP,PSSAFROO,PSSAFQL,PSSWASX,PSSAFQC,PSSAFQQ
"RTN","PSSSCHRP",36,0)
 ..S PSSAFRA=PSSAFQEN_","
"RTN","PSSSCHRP",37,0)
 ..D GETS^DIQ(51.1,PSSAFRA,".01;1;2;4;8;8.1;9;10;12","E","PSSAFRAA")
"RTN","PSSSCHRP",38,0)
 ..I $G(PSSAFRAA(51.1,PSSAFRA,4,"E"))'="PSJ" Q
"RTN","PSSSCHRP",39,0)
 ..I PSSAFRP="O",$G(PSSAFRAA(51.1,PSSAFRA,2,"E")) Q
"RTN","PSSSCHRP",40,0)
 ..S PSSAFNOF=1
"RTN","PSSSCHRP",41,0)
 ..W !!,$G(PSSAFRAA(51.1,PSSAFRA,.01,"E"))
"RTN","PSSSCHRP",42,0)
 ..I ($Y+5)>IOSL D HD Q:PSSAFOUT
"RTN","PSSSCHRP",43,0)
 ..S PSSAFQS=$G(PSSAFRAA(51.1,PSSAFRA,1,"E"))
"RTN","PSSSCHRP",44,0)
 ..W !?5,"STANDARD ADMINISTRATION TIMES: " D  K PSSAFAA Q:PSSAFOUT
"RTN","PSSSCHRP",45,0)
 ...Q:PSSAFQS=""
"RTN","PSSSCHRP",46,0)
 ...S PSSAFQL=$L(PSSAFQS)
"RTN","PSSSCHRP",47,0)
 ...I PSSALONG=132 D  Q
"RTN","PSSSCHRP",48,0)
 ....I PSSAFQL<96 D  Q
"RTN","PSSSCHRP",49,0)
 .....W PSSAFQS
"RTN","PSSSCHRP",50,0)
 .....I ($Y+5)>IOSL D HD Q:PSSAFOUT
"RTN","PSSSCHRP",51,0)
 ....K PSSAFAA D FORMAT(PSSAFQS,96)
"RTN","PSSSCHRP",52,0)
 ....S PSSAFRFL=0 F PSSAFAL=0:0 S PSSAFAL=$O(PSSAFAA(PSSAFAL)) Q:'PSSAFAL!(PSSAFOUT)  D
"RTN","PSSSCHRP",53,0)
 .....W:'PSSAFRFL ?36,$G(PSSAFAA(PSSAFAL)) W:PSSAFRFL !?36,$G(PSSAFAA(PSSAFAL)) S PSSAFRFL=1
"RTN","PSSSCHRP",54,0)
 .....I ($Y+5)>IOSL D HD Q:PSSAFOUT
"RTN","PSSSCHRP",55,0)
 ...I PSSAFQL<44 D  Q
"RTN","PSSSCHRP",56,0)
 ....W PSSAFQS
"RTN","PSSSCHRP",57,0)
 ....I ($Y+5)>IOSL D HD Q:PSSAFOUT
"RTN","PSSSCHRP",58,0)
 ...K PSSAFAA D FORMAT(PSSAFQS,44)
"RTN","PSSSCHRP",59,0)
 ...S PSSAFRFL=0 F PSSAFAL=0:0 S PSSAFAL=$O(PSSAFAA(PSSAFAL)) Q:'PSSAFAL!(PSSAFOUT)  D
"RTN","PSSSCHRP",60,0)
 ....W:'PSSAFRFL ?36,$G(PSSAFAA(PSSAFAL)) W:PSSAFRFL !?36,$G(PSSAFAA(PSSAFAL)) S PSSAFRFL=1
"RTN","PSSSCHRP",61,0)
 ....I ($Y+5)>IOSL D HD Q:PSSAFOUT
"RTN","PSSSCHRP",62,0)
 ..I ($Y+5)>IOSL D HD Q:PSSAFOUT
"RTN","PSSSCHRP",63,0)
 ..W !?14,"OUTPATIENT EXPANSION: " D
"RTN","PSSSCHRP",64,0)
 ...S PSSAFROP=$G(PSSAFRAA(51.1,PSSAFRA,8,"E"))
"RTN","PSSSCHRP",65,0)
 ...I PSSALONG=132 D  Q
"RTN","PSSSCHRP",66,0)
 ....I $L(PSSAFROP)<96 W PSSAFROP,! Q
"RTN","PSSSCHRP",67,0)
 ....N X,DIWL,DIWR,DIWF S X=PSSAFROP,DIWL=37,DIWR=131,DIWF="W" K ^UTILITY($J,"W") D ^DIWP D ^DIWW K ^UTILITY($J,"W")
"RTN","PSSSCHRP",68,0)
 ...I $L(PSSAFROP)<44 W PSSAFROP,! Q
"RTN","PSSSCHRP",69,0)
 ...N X,DIWL,DIWR,DIWF S X=PSSAFROP,DIWL=37,DIWR=79,DIWF="W" K ^UTILITY($J,"W") D ^DIWP D ^DIWW K ^UTILITY($J,"W")
"RTN","PSSSCHRP",70,0)
 ..I ($Y+5)>IOSL D HD Q:PSSAFOUT  W !
"RTN","PSSSCHRP",71,0)
 ..W ?10,"OTHER LANGUAGE EXPANSION: " D
"RTN","PSSSCHRP",72,0)
 ...S PSSAFROO=$G(PSSAFRAA(51.1,PSSAFRA,8.1,"E"))
"RTN","PSSSCHRP",73,0)
 ...I PSSALONG=132 D  Q
"RTN","PSSSCHRP",74,0)
 ....I $L(PSSAFROO)<96 W PSSAFROO,! Q
"RTN","PSSSCHRP",75,0)
 ....N X,DIWL,DIWR,DIWF S X=PSSAFROO,DIWL=37,DIWR=131,DIWF="W" K ^UTILITY($J,"W") D ^DIWP D ^DIWW K ^UTILITY($J,"W")
"RTN","PSSSCHRP",76,0)
 ...I $L(PSSAFROO)<44 W PSSAFROO,! Q
"RTN","PSSSCHRP",77,0)
 ...N X,DIWL,DIWR,DIWF S X=PSSAFROO,DIWL=37,DIWR=79,DIWF="W" K ^UTILITY($J,"W") D ^DIWP D ^DIWW K ^UTILITY($J,"W")
"RTN","PSSSCHRP",78,0)
 ..;Set PSSAFZZZ=0 if last write had a line feed, PSSAFZZZ=1 if last write did not have a line feed, to use for Schedule Type
"RTN","PSSSCHRP",79,0)
 ..S PSSAFZZZ=0 I ($Y+5)>IOSL D HD S PSSAFZZZ=0 Q:PSSAFOUT
"RTN","PSSSCHRP",80,0)
 ..S PSSAFRFL=0 F PSSWAS=0:0 S PSSWAS=$O(^PS(51.1,PSSAFQEN,1,PSSWAS)) Q:'PSSWAS!(PSSAFOUT)  D
"RTN","PSSSCHRP",81,0)
 ...S PSSWASEN=$P($G(^PS(51.1,PSSAFQEN,1,PSSWAS,0)),"^") Q:'PSSWASEN
"RTN","PSSSCHRP",82,0)
 ...S PSSWASX=PSSWAS_","_PSSAFQEN_"," S PSSWASNM=$$GET1^DIQ(51.11,PSSWASX,".01") Q:PSSWASNM=""
"RTN","PSSSCHRP",83,0)
 ...;PSSARFRL=0 if last Write ended in Line Feed, =1 if Last Write did not end in line feed, for writing Wards
"RTN","PSSSCHRP",84,0)
 ...W:'PSSAFRFL ?30,"WARD: "_PSSWASNM W:PSSAFRFL !?30,"WARD: "_PSSWASNM S (PSSAFZZZ,PSSAFRFL)=1
"RTN","PSSSCHRP",85,0)
 ...I ($Y+5)>IOSL D HD S (PSSAFZZZ,PSSAFRFL)=0 Q:PSSAFOUT
"RTN","PSSSCHRP",86,0)
 ...W !?9,"WARD ADMINISTRATION TIMES: " S (PSSAFZZZ,PSSAFRFL)=1
"RTN","PSSSCHRP",87,0)
 ...S PSSWASAD=$P($G(^PS(51.1,PSSAFQEN,1,PSSWAS,0)),"^",2)
"RTN","PSSSCHRP",88,0)
 ...Q:PSSWASAD=""
"RTN","PSSSCHRP",89,0)
 ...S (PSSWASLL,PSSAFQL)=$L(PSSWASAD)
"RTN","PSSSCHRP",90,0)
 ...I PSSALONG=132 D  Q
"RTN","PSSSCHRP",91,0)
 ....I PSSWASLL<96 D  Q
"RTN","PSSSCHRP",92,0)
 .....W PSSWASAD S (PSSAFZZZ,PSSAFRFL)=1
"RTN","PSSSCHRP",93,0)
 .....I ($Y+5)>IOSL D HD S (PSSAFZZZ,PSSAFRFL)=0 Q:PSSAFOUT
"RTN","PSSSCHRP",94,0)
 ....K PSSAFAA D FORMAT(PSSWASAD,96)
"RTN","PSSSCHRP",95,0)
 ....S PSSAFABC=0 F PSSAFAL=0:0 S PSSAFAL=$O(PSSAFAA(PSSAFAL)) Q:'PSSAFAL!(PSSAFOUT)  D
"RTN","PSSSCHRP",96,0)
 .....W:'PSSAFABC ?36,$G(PSSAFAA(PSSAFAL)) W:PSSAFABC !?36,$G(PSSAFAA(PSSAFAL)) S PSSAFABC=1 S (PSSAFZZZ,PSSAFRFL)=1
"RTN","PSSSCHRP",97,0)
 .....I ($Y+5)>IOSL D HD S (PSSAFZZZ,PSSAFRFL)=0 Q:PSSAFOUT
"RTN","PSSSCHRP",98,0)
 ...I PSSWASLL<37 D  Q
"RTN","PSSSCHRP",99,0)
 ....W PSSWASAD S (PSSAFZZZ,PSSAFRFL)=1
"RTN","PSSSCHRP",100,0)
 ....I ($Y+5)>IOSL D HD S (PSSAFZZZ,PSSAFRFL)=0 Q:PSSAFOUT
"RTN","PSSSCHRP",101,0)
 ...K PSSAFAA D FORMAT(PSSWASAD,44)
"RTN","PSSSCHRP",102,0)
 ...S PSSAFABC=0 F PSSAFAL=0:0 S PSSAFAL=$O(PSSAFAA(PSSAFAL)) Q:'PSSAFAL!(PSSAFOUT)  D
"RTN","PSSSCHRP",103,0)
 ....W:'PSSAFABC ?36,$G(PSSAFAA(PSSAFAL)) W:PSSAFABC !?36,$G(PSSAFAA(PSSAFAL)) S PSSAFABC=1 S (PSSAFZZZ,PSSAFRFL)=1
"RTN","PSSSCHRP",104,0)
 ....I ($Y+5)>IOSL D HD S (PSSAFZZZ,PSSAFRFL)=0 Q:PSSAFOUT
"RTN","PSSSCHRP",105,0)
 ..Q:PSSAFOUT
"RTN","PSSSCHRP",106,0)
 ..K PSSAFAA
"RTN","PSSSCHRP",107,0)
 ..I ($Y+5)>IOSL D HD S (PSSAFZZZ,PSSAFRFL)=0 Q:PSSAFOUT
"RTN","PSSSCHRP",108,0)
 ..K PSSTPE S PSSTPE=$$GET1^DIQ(51.1,PSSAFQEN_",",5)
"RTN","PSSSCHRP",109,0)
 ..W:'PSSAFZZZ ?21,"SCHEDULE TYPE: "_$G(PSSTPE) W:PSSAFZZZ !?21,"SCHEDULE TYPE: "_$G(PSSTPE)
"RTN","PSSSCHRP",110,0)
 ..I ($Y+5)>IOSL D HD Q:PSSAFOUT
"RTN","PSSSCHRP",111,0)
 ..W !?12,"FREQUENCY (IN MINUTES): "_$G(PSSAFRAA(51.1,PSSAFRA,2,"E"))
"RTN","PSSSCHRP",112,0)
 ..I ($Y+5)>IOSL D HD Q:PSSAFOUT
"RTN","PSSSCHRP",113,0)
 ..W !?6,"EXCLUDE FROM ALL DOSE CHECKS: "_$G(PSSAFRAA(51.1,PSSAFRA,9,"E"))
"RTN","PSSSCHRP",114,0)
 ..I ($Y+5)>IOSL D HD Q:PSSAFOUT
"RTN","PSSSCHRP",115,0)
 ..W !?5,"EXCLUDE FROM DAILY DOSE CHECK: "_$G(PSSAFRAA(51.1,PSSAFRA,10,"E"))
"RTN","PSSSCHRP",116,0)
 ..I ($Y+5)>IOSL D HD Q:PSSAFOUT
"RTN","PSSSCHRP",117,0)
 ..W !?26,"INACTIVE: "_$G(PSSAFRAA(51.1,PSSAFRA,12,"E"))
"RTN","PSSSCHRP",118,0)
 ..I ($Y+5)>IOSL D HD Q:PSSAFOUT
"RTN","PSSSCHRP",119,0)
 ;
"RTN","PSSSCHRP",120,0)
END ;
"RTN","PSSSCHRP",121,0)
 I '$G(PSSAFOUT),PSSAFRP="O",'$G(PSSAFNOF) W !!,"No schedules found without frequencies.",!
"RTN","PSSSCHRP",122,0)
 I $G(PSSAFDEV)="P"  W !!,"End of Report.",!
"RTN","PSSSCHRP",123,0)
 I '$G(PSSAFOUT),$G(PSSAFDEV)="C" W !!,"End of Report." K DIR S DIR(0)="E",DIR("A")="Press Return to continue" D ^DIR K DIR
"RTN","PSSSCHRP",124,0)
 I $G(PSSAFDEV)="C" W !
"RTN","PSSSCHRP",125,0)
 E  W @IOF
"RTN","PSSSCHRP",126,0)
 K PSSAFRP,PSSALONG
"RTN","PSSSCHRP",127,0)
 D ^%ZISC S:$D(ZTQUEUED) ZTREQ="@"
"RTN","PSSSCHRP",128,0)
 Q
"RTN","PSSSCHRP",129,0)
 ;
"RTN","PSSSCHRP",130,0)
 ;
"RTN","PSSSCHRP",131,0)
HD ;Report Header
"RTN","PSSSCHRP",132,0)
 I $G(PSSAFDEV)="C",$G(PSSAFCT)'=1 W ! K DIR,Y S DIR(0)="E",DIR("A")="Press Return to continue, '^' to exit" D ^DIR K DIR I 'Y S PSSAFOUT=1 Q
"RTN","PSSSCHRP",133,0)
 W @IOF
"RTN","PSSSCHRP",134,0)
 I PSSAFRP="A" W !,"ADMINISTRATION SCHEDULE FILE REPORT (All)"
"RTN","PSSSCHRP",135,0)
 I PSSAFRP="O" W !,"ADMINISTRATION SCHEDULE WITHOUT FREQUENCY REPORT"
"RTN","PSSSCHRP",136,0)
 W ?$S(PSSALONG=80:68,1:120),"PAGE: "_PSSAFCT,!,PSSAFLIN,! S PSSAFCT=PSSAFCT+1
"RTN","PSSSCHRP",137,0)
 Q
"RTN","PSSSCHRP",138,0)
 ;
"RTN","PSSSCHRP",139,0)
 ;
"RTN","PSSSCHRP",140,0)
MESS ;
"RTN","PSSSCHRP",141,0)
 W !!,"Nothing queued to print.",!
"RTN","PSSSCHRP",142,0)
 Q
"RTN","PSSSCHRP",143,0)
 ;
"RTN","PSSSCHRP",144,0)
 ;
"RTN","PSSSCHRP",145,0)
FORMAT(PSSAFQC,PSSAFQQ) ;Format print arrays, breaking on the "-" character
"RTN","PSSSCHRP",146,0)
 ;PSSAFQC = Administration Times text
"RTN","PSSSCHRP",147,0)
 ;PSSAFQQ = Character at which to break
"RTN","PSSSCHRP",148,0)
 N PSSAFAC,PSSAFAB,PSSAFAZ,PSSAFAD,PSSAFAF,PSSAFAX
"RTN","PSSSCHRP",149,0)
 S PSSAFAC=1,PSSAFAZ=0 K PSSAFAB
"RTN","PSSSCHRP",150,0)
 F PSSAFAD=1:1:PSSAFQL I $E(PSSAFQC,PSSAFAD)="-" S PSSAFAB(PSSAFAC)=$P(PSSAFQC,"-",PSSAFAC)_"-" S PSSAFAC=PSSAFAC+1,PSSAFAZ=PSSAFAD+1
"RTN","PSSSCHRP",151,0)
 I PSSAFAZ<PSSAFAD S:PSSAFAZ=0 PSSAFAZ=1 S PSSAFAB(PSSAFAC)=$E(PSSAFQC,PSSAFAZ,PSSAFQL) S PSSAFAC=PSSAFAC+1
"RTN","PSSSCHRP",152,0)
 S PSSAFAF=1
"RTN","PSSSCHRP",153,0)
 F PSSAFAX=1:1:PSSAFAC D
"RTN","PSSSCHRP",154,0)
 .Q:'$D(PSSAFAB(PSSAFAX))
"RTN","PSSSCHRP",155,0)
 .I '$D(PSSAFAA(PSSAFAF)) S PSSAFAA(PSSAFAF)=PSSAFAB(PSSAFAX) Q
"RTN","PSSSCHRP",156,0)
 .I $L(PSSAFAA(PSSAFAF))+$L(PSSAFAB(PSSAFAX))<PSSAFQQ S PSSAFAA(PSSAFAF)=PSSAFAA(PSSAFAF)_PSSAFAB(PSSAFAX) Q
"RTN","PSSSCHRP",157,0)
 .S PSSAFAF=PSSAFAF+1 S PSSAFAA(PSSAFAF)=PSSAFAB(PSSAFAX)
"RTN","PSSSCHRP",158,0)
 Q
"RTN","PSSSCHRP",159,0)
 ;
"RTN","PSSSCHRP",160,0)
 ;
"RTN","PSSSCHRP",161,0)
TRAIL ;Trailing spaces Report
"RTN","PSSSCHRP",162,0)
 W !!,"This report displays active, multi-ingredient entries from the DRUG (#50) File"
"RTN","PSSSCHRP",163,0)
 W !,"with Local Possible Dosages defined, with trailing spaces in the name. Entries"
"RTN","PSSSCHRP",164,0)
 W !,"not matched to National Drug File are also included if there are trailing"
"RTN","PSSSCHRP",165,0)
 W !,"spaces. Trailing spaces can potentially cause the Dose check to fail, and"
"RTN","PSSSCHRP",166,0)
 W !,"also possibly cause the conjunction and drug name to become part of the Dosage.",!
"RTN","PSSSCHRP",167,0)
 N DIR,Y,X,DTOUT,DUOUT,DIRUT,DIROUT,IOP,%ZIS,POP,ZTRTN,ZTDESC,ZTSAVE,ZTSK
"RTN","PSSSCHRP",168,0)
 K IOP,%ZIS,POP S %ZIS="QM" D ^%ZIS I $G(POP)>0 D MESS K DIR,Y S DIR(0)="E",DIR("A")="Press Return to continue" D ^DIR K DIR,IOP,%ZIS,POP Q
"RTN","PSSSCHRP",169,0)
 I $D(IO("Q")) S ZTRTN="STRAIL^PSSSCHRP",ZTDESC="Trailing Spaces Report" D ^%ZTLOAD K %ZIS W !!,"Report queued to print.",! K DIR,Y S DIR(0)="E",DIR("A")="Press Return to continue" D ^DIR K DIR Q
"RTN","PSSSCHRP",170,0)
 ;
"RTN","PSSSCHRP",171,0)
 ;
"RTN","PSSSCHRP",172,0)
STRAIL ;Print Trailing spaces report
"RTN","PSSSCHRP",173,0)
 U IO
"RTN","PSSSCHRP",174,0)
 N PSSTRSOT,PSSTRSLG,PSSTRSFL,PSSTRSDV,PSSTRSPG,PSSTRSAA,PSSTRSBB,PSSTRSNM,PSSTRSIN,PSSTRSST,PSSTRSUN,PSSTRSN1,PSSTRSN3,PSSTRSN9
"RTN","PSSSCHRP",175,0)
 S (PSSTRSOT,PSSTRSFL)=0,PSSTRSDV=$S($E(IOST,1,2)'="C-":"P",1:"C"),PSSTRSPG=1
"RTN","PSSSCHRP",176,0)
 K PSSTRSLG S $P(PSSTRSLG,"-",78)=""
"RTN","PSSSCHRP",177,0)
 D STHD
"RTN","PSSSCHRP",178,0)
 S PSSTRSAA="" F  S PSSTRSAA=$O(^PSDRUG("B",PSSTRSAA)) Q:PSSTRSAA=""!(PSSTRSOT)  D
"RTN","PSSSCHRP",179,0)
 .F PSSTRSBB=0:0 S PSSTRSBB=$O(^PSDRUG("B",PSSTRSAA,PSSTRSBB)) Q:'PSSTRSBB!(PSSTRSOT)  D:$O(^PSDRUG(PSSTRSBB,"DOS2",0))
"RTN","PSSSCHRP",180,0)
 ..S PSSTRSNM=$P($G(^PSDRUG(PSSTRSBB,0)),"^"),PSSTRSIN=$P($G(^PSDRUG(PSSTRSBB,"I")),"^")
"RTN","PSSSCHRP",181,0)
 ..I $E(PSSTRSNM,$L(PSSTRSNM))'=" " Q
"RTN","PSSSCHRP",182,0)
 ..I PSSTRSIN,PSSTRSIN<DT Q
"RTN","PSSSCHRP",183,0)
 ..S PSSTRSN1=$P($G(^PSDRUG(PSSTRSBB,"ND")),"^"),PSSTRSN3=$P($G(^PSDRUG(PSSTRSBB,"ND")),"^",3)
"RTN","PSSSCHRP",184,0)
 ..I 'PSSTRSN1!('PSSTRSN3) W !,PSSTRSNM_"   ("_PSSTRSBB_")" S PSSTRSFL=1 D:($Y+5)>IOSL STHD Q
"RTN","PSSSCHRP",185,0)
 ..S PSSTRSST=$P($G(^PSDRUG(PSSTRSBB,"DOS")),"^"),PSSTRSUN=$P($G(^PSDRUG(PSSTRSBB,"DOS")),"^",2)
"RTN","PSSSCHRP",186,0)
 ..I PSSTRSST'="" Q
"RTN","PSSSCHRP",187,0)
 ..K PSSTRSN9 I PSSTRSST=""!('PSSTRSUN) S PSSTRSN9=$$DFSU^PSNAPIS(PSSTRSN1,PSSTRSN3)
"RTN","PSSSCHRP",188,0)
 ..S PSSTRSST=$P($G(PSSTRSN9),"^",4) I $$STST() Q
"RTN","PSSSCHRP",189,0)
 ..W !,PSSTRSNM_"   ("_PSSTRSBB_")" S PSSTRSFL=1 I ($Y+5)>IOSL D STHD
"RTN","PSSSCHRP",190,0)
 ;
"RTN","PSSSCHRP",191,0)
 ;
"RTN","PSSSCHRP",192,0)
STEND ;
"RTN","PSSSCHRP",193,0)
 I '$G(PSSTRSOT),'$G(PSSTRSFL) W !!,"No drug names found.",!
"RTN","PSSSCHRP",194,0)
 I $G(PSSTRSDV)="P"  W !!,"End of Report.",!
"RTN","PSSSCHRP",195,0)
 I '$G(PSSTRSOT),$G(PSSTRSDV)="C" W !!,"End of Report." K DIR S DIR(0)="E",DIR("A")="Press Return to continue" D ^DIR K DIR
"RTN","PSSSCHRP",196,0)
 I $G(PSSTRSDV)="C" W !
"RTN","PSSSCHRP",197,0)
 E  W @IOF
"RTN","PSSSCHRP",198,0)
 D ^%ZISC S:$D(ZTQUEUED) ZTREQ="@"
"RTN","PSSSCHRP",199,0)
 Q
"RTN","PSSSCHRP",200,0)
 ;
"RTN","PSSSCHRP",201,0)
 ;
"RTN","PSSSCHRP",202,0)
STHD ;Report Header
"RTN","PSSSCHRP",203,0)
 I $G(PSSTRSDV)="C",$G(PSSTRSPG)'=1 W ! K DIR,Y S DIR(0)="E",DIR("A")="Press Return to continue, '^' to exit" D ^DIR K DIR I 'Y S PSSTRSOT=1 Q
"RTN","PSSSCHRP",204,0)
 W @IOF
"RTN","PSSSCHRP",205,0)
 W !,"DRUG NAME TRAILING SPACES REPORT"
"RTN","PSSSCHRP",206,0)
 W ?68,"PAGE: "_PSSTRSPG,!,PSSTRSLG,! S PSSTRSPG=PSSTRSPG+1
"RTN","PSSSCHRP",207,0)
 Q
"RTN","PSSSCHRP",208,0)
 ;
"RTN","PSSSCHRP",209,0)
 ;
"RTN","PSSSCHRP",210,0)
STST() ;Is strength numeric
"RTN","PSSSCHRP",211,0)
 I PSSTRSST="" Q 0
"RTN","PSSSCHRP",212,0)
 I PSSTRSST'?.N&(PSSTRSST'?.N1".".N) Q 0
"RTN","PSSSCHRP",213,0)
 Q 1
"RTN","PSSUTIL1")
0^9^B48136582^B37379824
"RTN","PSSUTIL1",1,0)
PSSUTIL1 ;BIR/RTR-Utility routine ;08/21/00
"RTN","PSSUTIL1",2,0)
 ;;1.0;PHARMACY DATA MANAGEMENT;**38,66,69,166,189**;9/30/97;Build 54
"RTN","PSSUTIL1",3,0)
 ;Reference to ^PS(50.607 supported by DBIA #2221
"RTN","PSSUTIL1",4,0)
 ;Reference to ^PSNAPIS supported by DBIA 2531
"RTN","PSSUTIL1",5,0)
 ;
"RTN","PSSUTIL1",6,0)
EN(PSSDRIEN) ;
"RTN","PSSUTIL1",7,0)
 N PSSMASH,PSSMNDFS,PSSMSSTR,PSSMUNIT,PSSUNZ,PSSMA,PSSMB,PSSMA1,PSSMB1,PSSUNX,PSSMASH2,PSSMASH3,PSSNAT1,PSSNAT3,PSSNODEU
"RTN","PSSUTIL1",8,0)
 I '$G(PSSDRIEN) Q "|^^^^^99PSU"
"RTN","PSSUTIL1",9,0)
 S PSSMSSTR=$P($G(^PSDRUG(PSSDRIEN,"DOS")),"^"),PSSMUNIT=$P($G(^("DOS")),"^",2)
"RTN","PSSUTIL1",10,0)
 S PSSNAT1=$P($G(^PSDRUG(PSSDRIEN,"ND")),"^"),PSSNAT3=$P($G(^("ND")),"^",3) I PSSNAT1,PSSNAT3 S PSSNODEU=$$DFSU^PSNAPIS(PSSNAT1,PSSNAT3) S PSSMNDFS=$P(PSSNODEU,"^",4) S:'$G(PSSMUNIT) PSSMUNIT=$P(PSSNODEU,"^",5)
"RTN","PSSUTIL1",11,0)
 S PSSUNZ=$P($G(^PS(50.607,+$G(PSSMUNIT),0)),"^")
"RTN","PSSUTIL1",12,0)
 I PSSUNZ'["/" Q $S($G(PSSMSSTR)'="":$G(PSSMSSTR),$G(PSSMNDFS)'="":$G(PSSMNDFS),1:"")_"|"_"^^^"_$S($G(PSSMUNIT):$G(PSSMUNIT),1:"")_"^"_$G(PSSUNZ)_"^"_"99PSU"
"RTN","PSSUTIL1",13,0)
 S PSSMASH=0
"RTN","PSSUTIL1",14,0)
 I $G(PSSMSSTR),$G(PSSMNDFS),+$G(PSSMSSTR)'=+$G(PSSMNDFS) S PSSMASH=1
"RTN","PSSUTIL1",15,0)
 I 'PSSMASH Q PSSMSSTR_"|"_"^^^"_$S($G(PSSMUNIT):$G(PSSMUNIT),1:"")_"^"_$G(PSSUNZ)_"^"_"99PSU"
"RTN","PSSUTIL1",16,0)
 S PSSMA=$P(PSSUNZ,"/"),PSSMB=$P(PSSUNZ,"/",2),PSSMA1=+$G(PSSMA),PSSMB1=+$G(PSSMB)
"RTN","PSSUTIL1",17,0)
 S PSSMASH2=PSSMSSTR/PSSMNDFS,PSSMASH3=PSSMASH2*($S($G(PSSMB1):$G(PSSMB1),1:1))
"RTN","PSSUTIL1",18,0)
 S PSSUNX=$G(PSSMA)_"/"_$G(PSSMASH3)_$S('$G(PSSMB1):$G(PSSMB),1:$P(PSSMB,PSSMB1,2))
"RTN","PSSUTIL1",19,0)
 Q $S($G(PSSMSSTR)'="":$G(PSSMSSTR),$G(PSSMNDFS)'="":$G(PSSMNDFS),1:"")_"|"_"^^^^"_$G(PSSUNX)_"^"_"99PSU"
"RTN","PSSUTIL1",20,0)
 ;
"RTN","PSSUTIL1",21,0)
 Q
"RTN","PSSUTIL1",22,0)
 ;
"RTN","PSSUTIL1",23,0)
DRG(PSSDD,PSSOI,PSSPK) ;
"RTN","PSSUTIL1",24,0)
 ; PSSDD - Array of Drugs
"RTN","PSSUTIL1",25,0)
 ; PSSOI - Orderable Item (Pharmacy)
"RTN","PSSUTIL1",26,0)
 ; PSSPK - Application Package ("O"-Outpatient;"I"-IV;"X"-Non-VA Med)
"RTN","PSSUTIL1",27,0)
 ;Return active dispense drugs for package based on Orderable Item 
"RTN","PSSUTIL1",28,0)
 N PSSL,PSSAP,PSSIN,PSSND
"RTN","PSSUTIL1",29,0)
 Q:'$G(PSSOI)
"RTN","PSSUTIL1",30,0)
 I $G(PSSPK)'="O",$G(PSSPK)'="I",$G(PSSPK)'="X" Q
"RTN","PSSUTIL1",31,0)
 F PSSL=0:0 S PSSL=$O(^PSDRUG("ASP",PSSOI,PSSL)) Q:'PSSL  D
"RTN","PSSUTIL1",32,0)
 . S PSSIN=$P($G(^PSDRUG(PSSL,"I")),"^"),PSSAP=$P($G(^(2)),"^",3)
"RTN","PSSUTIL1",33,0)
 . I PSSIN,PSSIN<DT Q
"RTN","PSSUTIL1",34,0)
 . S PSSND=$P($G(^PSDRUG(PSSL,"ND")),"^")
"RTN","PSSUTIL1",35,0)
 . I PSSPK="O"!(PSSPK="X") D  Q
"RTN","PSSUTIL1",36,0)
 . . S:PSSAP[PSSPK PSSDD(PSSL_";"_PSSND)=$P($G(^PSDRUG(PSSL,0)),"^")
"RTN","PSSUTIL1",37,0)
 . I PSSAP["I"!(PSSAP["U") D
"RTN","PSSUTIL1",38,0)
 . . S PSSDD(PSSL_";"_PSSND)=$P($G(^PSDRUG(PSSL,0)),"^")
"RTN","PSSUTIL1",39,0)
 Q
"RTN","PSSUTIL1",40,0)
 ;
"RTN","PSSUTIL1",41,0)
ITEM(PSSIT,PSSDR) ;Return Orderable Item to CPRS
"RTN","PSSUTIL1",42,0)
 N PSSNEW
"RTN","PSSUTIL1",43,0)
 I '$G(PSSIT)!('$G(PSSDR)) Q -1
"RTN","PSSUTIL1",44,0)
 I '$D(^PS(50.7,+$G(PSSIT),0))!('$D(^PSDRUG(+$G(PSSDR),0))) Q -1
"RTN","PSSUTIL1",45,0)
 S PSSNEW=+$P($G(^PSDRUG(+$G(PSSDR),2)),"^")
"RTN","PSSUTIL1",46,0)
 I PSSNEW,PSSNEW=$G(PSSIT) Q 0
"RTN","PSSUTIL1",47,0)
 I PSSNEW,PSSNEW'=$G(PSSIT) Q 1_"^"_PSSNEW
"RTN","PSSUTIL1",48,0)
 Q -1
"RTN","PSSUTIL1",49,0)
 ;
"RTN","PSSUTIL1",50,0)
 Q
"RTN","PSSUTIL1",51,0)
 ;
"RTN","PSSUTIL1",52,0)
EN1(PSSOA,PSSOAP) ;
"RTN","PSSUTIL1",53,0)
 ;Return Orderable Item Forumary Alternatives to CPRS
"RTN","PSSUTIL1",54,0)
 ;PSSOA = Pharmacy Orderable Item number
"RTN","PSSUTIL1",55,0)
 ;PSSOAP = "I" For Inpatient, "O" For Outpatient
"RTN","PSSUTIL1",56,0)
 Q:'$G(PSSOA)
"RTN","PSSUTIL1",57,0)
 I $G(PSSOAP)'="O",$G(PSSOAP)'="I" Q
"RTN","PSSUTIL1",58,0)
 N PSSOAL,PSSOALD,PSSOAN,PSSOAIT,PSSOADT,PSSOAZ
"RTN","PSSUTIL1",59,0)
 S PSSOAL="" F  S PSSOAL=$O(^PSDRUG("ASP",PSSOA,PSSOAL)) Q:PSSOAL=""  D
"RTN","PSSUTIL1",60,0)
 .S PSSOALD="" F  S PSSOALD=$O(^PSDRUG(PSSOAL,65,PSSOALD)) Q:PSSOALD=""  D
"RTN","PSSUTIL1",61,0)
 ..S PSSOAN=$P($G(^PSDRUG(PSSOAL,65,PSSOALD,0)),"^") I PSSOAN S PSSOAIT=$P($G(^PSDRUG(PSSOAN,2)),"^") D:PSSOAIT
"RTN","PSSUTIL1",62,0)
 ...Q:PSSOAIT=PSSOA
"RTN","PSSUTIL1",63,0)
 ...Q:$D(PSSOA(PSSOAIT))
"RTN","PSSUTIL1",64,0)
 ...Q:'$D(^PS(50.7,PSSOAIT,0))!($P($G(^PS(50.7,PSSOAIT,0)),"^",12))
"RTN","PSSUTIL1",65,0)
 ...Q:$P($G(^PS(50.7,PSSOAIT,0)),"^",4)&(+$P($G(^(0)),"^",4)'>DT)
"RTN","PSSUTIL1",66,0)
 ...S PSSOAZ="" F  S PSSOAZ=$O(^PSDRUG("ASP",PSSOAIT,PSSOAZ)) Q:PSSOAZ=""!($D(PSSOA(PSSOAIT)))  D
"RTN","PSSUTIL1",67,0)
 ....Q:$P($G(^PSDRUG(PSSOAZ,"I")),"^")&(+$P($G(^("I")),"^")'>DT)
"RTN","PSSUTIL1",68,0)
 ....Q:$P($G(^PSDRUG(PSSOAZ,0)),"^",9)
"RTN","PSSUTIL1",69,0)
 ....I $G(PSSOAP)="O" S:$P($G(^PSDRUG(PSSOAZ,2)),"^",3)["O" PSSOA(PSSOAIT)="" Q
"RTN","PSSUTIL1",70,0)
 ....I $P($G(^PSDRUG(PSSOAZ,2)),"^",3)["I"!($P($G(^(2)),"^",3)["U") S PSSOA(PSSOAIT)=""
"RTN","PSSUTIL1",71,0)
 Q
"RTN","PSSUTIL1",72,0)
SCH(SCH) ;Expand schedule for Outpatient order in CPRS
"RTN","PSSUTIL1",73,0)
 N SQFLAG,SCLOOP,SCLP,SCLPS,SCLHOLD,SCIN,SODL,SST,SCHEX
"RTN","PSSUTIL1",74,0)
 S SCHEX=$G(SCH) S SQFLAG=0
"RTN","PSSUTIL1",75,0)
 I $G(SCH)="" G SCHQT
"RTN","PSSUTIL1",76,0)
 ;I SCH[""""!($A(SCH)=45)!(SCH?.E1C.E)!($L(SCH," ")>3)!($L(SCH)>20)!($L(SCH)<1) K SCH Q
"RTN","PSSUTIL1",77,0)
 F SCLOOP=0:0 S SCLOOP=$O(^PS(51.1,"B",SCH,SCLOOP)) Q:'SCLOOP!(SQFLAG)  I $P($G(^PS(51.1,SCLOOP,0)),"^",8)'="" S SCHEX=$P($G(^(0)),"^",8),SQFLAG=1
"RTN","PSSUTIL1",78,0)
 I SQFLAG G SCHQT
"RTN","PSSUTIL1",79,0)
 I $P($G(^PS(51,"A",SCH)),"^")'="" S SCHEX=$P(^(SCH),"^") G SCHQT
"RTN","PSSUTIL1",80,0)
 S SCLOOP=0 F SCLP=1:1:$L(SCH) S SCLPS=$E(SCH,SCLP) I SCLPS=" " S SCLOOP=SCLOOP+1
"RTN","PSSUTIL1",81,0)
 I SCLOOP=0 S SCHEX=SCH G SCHQT
"RTN","PSSUTIL1",82,0)
 S SCLOOP=SCLOOP+1
"RTN","PSSUTIL1",83,0)
 K SCLHOLD F SCIN=1:1:SCLOOP S (SODL,SCLHOLD(SCIN))=$P(SCH," ",SCIN) D
"RTN","PSSUTIL1",84,0)
 .Q:$G(SODL)=""
"RTN","PSSUTIL1",85,0)
 .S SQFLAG=0 F SST=0:0 S SST=$O(^PS(51.1,"B",SODL,SST)) Q:'SST!($G(SQFLAG))  I $P($G(^PS(51.1,SST,0)),"^",8)'="" S SCLHOLD(SCIN)=$P($G(^(0)),"^",8),SQFLAG=1
"RTN","PSSUTIL1",86,0)
 .Q:$G(SQFLAG)
"RTN","PSSUTIL1",87,0)
 .I $P($G(^PS(51,"A",SODL)),"^")'="" S SCLHOLD(SCIN)=$P(^(SODL),"^")
"RTN","PSSUTIL1",88,0)
 S SCHEX="",SQFLAG=0 F SST=1:1:SCLOOP S SCHEX=SCHEX_$S($G(SQFLAG):" ",1:"")_$G(SCLHOLD(SST)),SQFLAG=1
"RTN","PSSUTIL1",89,0)
SCHQT ;
"RTN","PSSUTIL1",90,0)
 S SCH=SCHEX
"RTN","PSSUTIL1",91,0)
 Q
"RTN","PSSUTIL1",92,0)
 ;
"RTN","PSSUTIL1",93,0)
IVDEA(PSSIVOI,PSSIVOIP) ;CS Federal Schedule/DEA Special Handling to CPRS for IV Fluids dialogue
"RTN","PSSUTIL1",94,0)
 ;parameter 1 is Orderable Item
"RTN","PSSUTIL1",95,0)
 ;parameter 2 is "A" for Additive, "S" for Solution
"RTN","PSSUTIL1",96,0)
 ;Return the CS Federal Schedule code in the VA PRODUCT file (#50.68)
"RTN","PSSUTIL1",97,0)
 ;or the DEA Special Hndl code depending on the "ND" node of the 
"RTN","PSSUTIL1",98,0)
 ;drugs associated to the Orderable Item.
"RTN","PSSUTIL1",99,0)
 ;1;1  Sch. I Nar.
"RTN","PSSUTIL1",100,0)
 ;1;2  II
"RTN","PSSUTIL1",101,0)
 ;1;2n II Non-Nar.
"RTN","PSSUTIL1",102,0)
 ;2;3  III
"RTN","PSSUTIL1",103,0)
 ;2;3n III Non-Nar.
"RTN","PSSUTIL1",104,0)
 ;2;4  IV
"RTN","PSSUTIL1",105,0)
 ;2;5  V
"RTN","PSSUTIL1",106,0)
 ;0  there are other active drugs
"RTN","PSSUTIL1",107,0)
 ;"" no active drugs
"RTN","PSSUTIL1",108,0)
 N PSSIVDO,PSSIVDD,PSSIVL,PSSIVLP,PSSIVDEA,PSSIVLPX,PSSK,PSSI,PSSGD
"RTN","PSSUTIL1",109,0)
 S (PSSIVDO,PSSIVDD)=0
"RTN","PSSUTIL1",110,0)
 I $G(PSSIVOIP)'="S" S PSSIVOIP="A"
"RTN","PSSUTIL1",111,0)
 I '$G(PSSIVOI) G IVQ1
"RTN","PSSUTIL1",112,0)
 S PSSIVL="" F  S PSSIVL=$O(^PSDRUG("ASP",PSSIVOI,PSSIVL)) Q:'PSSIVL  D
"RTN","PSSUTIL1",113,0)
 .I $P($G(^PSDRUG(PSSIVL,"I")),"^"),$P($G(^("I")),"^")<DT Q
"RTN","PSSUTIL1",114,0)
 .I $P($G(^PSDRUG(PSSIVL,2)),"^",3)'["I",$P($G(^(2)),"^",3)'["U" Q
"RTN","PSSUTIL1",115,0)
 .S PSSIVDD=1
"RTN","PSSUTIL1",116,0)
 .I PSSIVOIP="A" D  Q
"RTN","PSSUTIL1",117,0)
 ..S (PSSIVLP,PSSIVLPX)=0 F  S PSSIVLP=$O(^PSDRUG("A526",PSSIVL,PSSIVLP)) Q:'PSSIVLP!(PSSIVLPX)  D
"RTN","PSSUTIL1",118,0)
 ...I $D(^PS(52.6,PSSIVLP,0)) I '$P($G(^("I")),"^")!($P($G(^("I")),"^")>DT) D IVX
"RTN","PSSUTIL1",119,0)
 .S (PSSIVLP,PSSIVLPX)=0 F  S PSSIVLP=$O(^PSDRUG("A527",PSSIVL,PSSIVLP)) Q:'PSSIVLP!(PSSIVLPX)  D
"RTN","PSSUTIL1",120,0)
 ..I $D(^PS(52.7,PSSIVLP,0)) I '$P($G(^("I")),"^")!($P($G(^("I")),"^")>DT) D IVX
"RTN","PSSUTIL1",121,0)
IVQ ;
"RTN","PSSUTIL1",122,0)
 G:$O(PSSI(""))]"" CSS
"RTN","PSSUTIL1",123,0)
 S PSSIVLPX="" F  S PSSIVLPX=$O(PSSGD(PSSIVLPX)) Q:PSSIVLPX=""  D
"RTN","PSSUTIL1",124,0)
 .I PSSIVLPX[1 S PSSI(1)="" Q
"RTN","PSSUTIL1",125,0)
 .I PSSIVLPX[2,PSSIVLPX'["C" S PSSI(2)="" Q
"RTN","PSSUTIL1",126,0)
 .I PSSIVLPX[2,PSSIVLPX["C" S PSSI(2.5)="" Q
"RTN","PSSUTIL1",127,0)
 .I PSSIVLPX[3,PSSIVLPX'["C" S PSSI(3)="" Q
"RTN","PSSUTIL1",128,0)
 .I PSSIVLPX[3,PSSIVLPX["C" S PSSI(3.5)="" Q
"RTN","PSSUTIL1",129,0)
 .I PSSIVLPX[4 S PSSI(4)="" Q
"RTN","PSSUTIL1",130,0)
 .I PSSIVLPX[5 S PSSI(5)=""
"RTN","PSSUTIL1",131,0)
CSS S PSSK=0 S PSSK=$O(PSSI(PSSK)) I PSSK S PSSIVDO=$E(PSSK)_$S($L(PSSK)>1:"n",1:"")
"RTN","PSSUTIL1",132,0)
OIQ I PSSIVDO=0 S:'PSSIVDD PSSIVDO=""
"RTN","PSSUTIL1",133,0)
 I +PSSIVDO=1!(+PSSIVDO=2) S PSSIVDO=1_";"_PSSIVDO
"RTN","PSSUTIL1",134,0)
 I +PSSIVDO=3!(+PSSIVDO=4)!(+PSSIVDO=5) S PSSIVDO=2_";"_PSSIVDO
"RTN","PSSUTIL1",135,0)
 Q PSSIVDO
"RTN","PSSUTIL1",136,0)
IVQ1 ;
"RTN","PSSUTIL1",137,0)
 I PSSIVDO=0,'PSSIVDD S PSSIVDO=""
"RTN","PSSUTIL1",138,0)
 Q PSSIVDO
"RTN","PSSUTIL1",139,0)
 ;
"RTN","PSSUTIL1",140,0)
IVX ;
"RTN","PSSUTIL1",141,0)
 S (PSSIVDD,PSSIVLPX)=1
"RTN","PSSUTIL1",142,0)
 S PSSIVDEA=$P($G(^PSDRUG(PSSIVL,0)),"^",3) S:PSSIVDEA]"" PSSGD(PSSIVDEA)=""
"RTN","PSSUTIL1",143,0)
 I +$P($G(^PSDRUG(PSSIVL,"ND")),"^",3) S PSSK=$P(^("ND"),"^",3) D
"RTN","PSSUTIL1",144,0)
 .I +$P($G(^PSNDF(50.68,PSSK,7)),"^") S PSSK=$P(^(7),"^"),PSSI($S($E(PSSK,2)="n":$E(PSSK)_".5",1:PSSK))=""
"RTN","PSSUTIL1",145,0)
 Q
"RTN","PSSUTIL1",146,0)
 ;
"RTN","PSSUTIL1",147,0)
MAXDS(INPUT) ; Returns the Maximum Day Supply to CPRS for a specific Drug or Orderable Item
"RTN","PSSUTIL1",148,0)
 ; Input: INPUT("PSOI") - PHARMACY ORDERABLE ITEM (#50.7) IEN  
"RTN","PSSUTIL1",149,0)
 ;        INPUT("DRUG") - DRUG file (#50) IEN
"RTN","PSSUTIL1",150,0)
 ;Output: Maximum Days Supply (1 thru 365) - Default: 90
"RTN","PSSUTIL1",151,0)
 ;
"RTN","PSSUTIL1",152,0)
 N MAXDS,DRG,DRGMAXDS
"RTN","PSSUTIL1",153,0)
 I +$G(INPUT("DRUG")) Q $$MXDAYSUP(+INPUT("DRUG"))
"RTN","PSSUTIL1",154,0)
 S MAXDS=90
"RTN","PSSUTIL1",155,0)
 I +$G(INPUT("PSOI")) D
"RTN","PSSUTIL1",156,0)
 . S DRG=0
"RTN","PSSUTIL1",157,0)
 . F  S DRG=$O(^PSDRUG("ASP",+INPUT("PSOI"),DRG)) Q:'DRG  D
"RTN","PSSUTIL1",158,0)
 . . S DRGMAXDS=$$MXDAYSUP(DRG) I DRGMAXDS>MAXDS S MAXDS=DRGMAXDS
"RTN","PSSUTIL1",159,0)
 Q MAXDS
"RTN","PSSUTIL1",160,0)
 ;
"RTN","PSSUTIL1",161,0)
MXDAYSUP(DRUG) ; Returns the Maximum Day Supply for the Dispense Drug
"RTN","PSSUTIL1",162,0)
 ; Input: DRUG     - Pointer to the DRUG file (#50)
"RTN","PSSUTIL1",163,0)
 ;Output: MXDAYSUP - Maximum Days Supply allowed for the Dispense Drug
"RTN","PSSUTIL1",164,0)
 ;
"RTN","PSSUTIL1",165,0)
 N MXDAYSUP,DRGMAXDS,NDFMAXDS,VAPRDIEN,DEASPHLG
"RTN","PSSUTIL1",166,0)
 ; - Default value = 90
"RTN","PSSUTIL1",167,0)
 S MXDAYSUP=90
"RTN","PSSUTIL1",168,0)
 ; - Invalid Dispense Drug
"RTN","PSSUTIL1",169,0)
 I '$D(^PSDRUG(+$G(DRUG),0)) Q MXDAYSUP
"RTN","PSSUTIL1",170,0)
 ; - Retrieving Dispense Drug (If value is populated)
"RTN","PSSUTIL1",171,0)
 S DRGMAXDS=$$GET1^DIQ(50,DRUG,66) I DRGMAXDS S MXDAYSUP=DRGMAXDS
"RTN","PSSUTIL1",172,0)
 ; - Retrieving NDF Maximum (If Drug is matched to NDF and value is populated)
"RTN","PSSUTIL1",173,0)
 S VAPRDIEN=+$$GET1^DIQ(50,DRUG,22,"I")
"RTN","PSSUTIL1",174,0)
 I VAPRDIEN D
"RTN","PSSUTIL1",175,0)
 . S NDFMAXDS=$$GET1^DIQ(50.68,VAPRDIEN,32)
"RTN","PSSUTIL1",176,0)
 . I NDFMAXDS,'DRGMAXDS S MXDAYSUP=NDFMAXDS
"RTN","PSSUTIL1",177,0)
 . I NDFMAXDS,DRGMAXDS,NDFMAXDS<DRGMAXDS S MXDAYSUP=NDFMAXDS
"RTN","PSSUTIL1",178,0)
 ; - Controlled Substances have different upper limits (not 365)
"RTN","PSSUTIL1",179,0)
 S DEASPHLG=$$GET1^DIQ(50,DRUG,3)
"RTN","PSSUTIL1",180,0)
 I DEASPHLG["2",MXDAYSUP>30 S MXDAYSUP=30
"RTN","PSSUTIL1",181,0)
 I (DEASPHLG["3")!(DEASPHLG["4")!(DEASPHLG["5"),MXDAYSUP>90 S MXDAYSUP=90
"RTN","PSSUTIL1",182,0)
 ;- Clozapine Drug
"RTN","PSSUTIL1",183,0)
 I $P($G(^PSDRUG(DRUG,"CLOZ1")),"^")="PSOCLO1" S MXDAYSUP=28
"RTN","PSSUTIL1",184,0)
 ;
"RTN","PSSUTIL1",185,0)
 Q MXDAYSUP
"RTN","PSSVIDRG")
0^6^B88124860^B83452863
"RTN","PSSVIDRG",1,0)
PSSVIDRG ;BIR/PR,WRT-ADD OR EDIT IV DRUGS ; 11/19/09 11:02am
"RTN","PSSVIDRG",2,0)
 ;;1.0;PHARMACY DATA MANAGEMENT;**2,10,32,38,125,146,174,189**;9/30/97;Build 54
"RTN","PSSVIDRG",3,0)
 ;
"RTN","PSSVIDRG",4,0)
 ;Reference to ENIVKV^PSGSETU is supported by DBIA # 2153.
"RTN","PSSVIDRG",5,0)
 ;Reference to ^PSIV is supported by DBIA # 2155.
"RTN","PSSVIDRG",6,0)
 ;Reference to ^PSIVHLP1 is supported by DBIA # 2156.
"RTN","PSSVIDRG",7,0)
 ;Reference to ^PSIVXU is supported by DBIA # 2157.
"RTN","PSSVIDRG",8,0)
 ;
"RTN","PSSVIDRG",9,0)
ENS ;Enter here to enter/edit solutions
"RTN","PSSVIDRG",10,0)
 N FI,PSPRNM S DRUGEDIT=1,FI=52.7
"RTN","PSSVIDRG",11,0)
 L +^PS(FI):$S($G(DILOCKTM)>0:DILOCKTM,1:3) E  W $C(7),!!,"Someone else is entering drugs ... try later !",!! G K
"RTN","PSSVIDRG",12,0)
ENS1 ;
"RTN","PSSVIDRG",13,0)
 ; PSS*1*146 Compare and confirm SOLUTION Print name change
"RTN","PSSVIDRG",14,0)
 N DA,DIC,DLAYGO,II,PSDA,PSI,PSSY,PSSDG,PSSEL1,PSSDRG
"RTN","PSSVIDRG",15,0)
NS2 S PSI=0 I $G(DISPDRG),$O(^PS(52.7,"AC",DISPDRG,0)) S PSSY=0 F  S PSSY=$O(^PS(52.7,"AC",DISPDRG,PSSY)) Q:'PSSY  S PSI=PSI+1,PSSY(PSI)=PSSY
"RTN","PSSVIDRG",16,0)
 ;I PSI=1 S DIC("B")=$G(PSSY(1)) S DIC=FI,DIC(0)="QEALMNTV",DLAYGO=52.7,DIC("T")="" D ^DIC I Y<0 K PSFLGA G K1
"RTN","PSSVIDRG",17,0)
 I PSI=0 S DIC=FI,DIC(0)="QEALMNTV",DLAYGO=52.7 D ^DIC I Y<0 K PSFLGA G K1
"RTN","PSSVIDRG",18,0)
 ;
"RTN","PSSVIDRG",19,0)
ENS2 ; IV Solutions Editing
"RTN","PSSVIDRG",20,0)
 S PSSQUIT=0
"RTN","PSSVIDRG",21,0)
 I '$G(PSFLGA)&(PSI>0) F  D  Q:$G(Y)
"RTN","PSSVIDRG",22,0)
 . W !!," ",$$GET1^DIQ(50,DISPDRG,.01)," currently linked to IV Solutions:",!
"RTN","PSSVIDRG",23,0)
 . S (PSDA,II)=0 F  S PSDA=$O(PSSY(PSDA)) Q:'PSDA  S II=II+1 W !,?3,II_". ",$P(^PS(52.7,$G(PSSY(PSDA)),0),"^")_"   "_$P(^PS(52.7,$G(PSSY(PSDA)),0),"^",3)
"RTN","PSSVIDRG",24,0)
 . W !!,"Select "_$S(PSI=1:1,1:"1-"_PSI)_" from list above or type 'NEW' to link to a new IV Solution: "
"RTN","PSSVIDRG",25,0)
 . R X:DTIME I '$T!("^"[X) S Y=-1 Q
"RTN","PSSVIDRG",26,0)
 . W ! I $$UP^XLFSTR(X)="NEW" D NEW(52.7) Q
"RTN","PSSVIDRG",27,0)
 . I '$D(PSSY(X)) W !!,"Select the number corresponding to the IV SOLUTION you want to edit",!,"or type 'NEW' to link ",$$GET1^DIQ(50,DISPDRG,.01)," to a new IV SOLUTION.",$C(7) Q
"RTN","PSSVIDRG",28,0)
 . I $D(PSSY(X)) S Y=$G(PSSY(X))
"RTN","PSSVIDRG",29,0)
 G K1:($G(Y)<0)
"RTN","PSSVIDRG",30,0)
 W ! K PSSEL1 S PSSASK="SOLUTIONS",DRUG=+Y,DIE=FI,(DA,ENTRY)=+Y,DR=".01" D EECK G K1:$G(PSSEL1)="^" I $G(PSSEL1)=2 S Y=0 W ! G NS2
"RTN","PSSVIDRG",31,0)
 N PSSQUIT,PSSINADT S PSSQUIT=0
"RTN","PSSVIDRG",32,0)
 S PSSINADT=$$GET1^DIQ(52.7,ENTRY,8,"I")
"RTN","PSSVIDRG",33,0)
 S PSSDRG=$P($G(^PS(52.7,ENTRY,0)),"^",2),DA=ENTRY
"RTN","PSSVIDRG",34,0)
 S DIE="^PS(52.7,",DR="D PRNMHD^PSSVIDRG;.01;.01///^S X=$$PRNM^PSSVIDRG();.02;"
"RTN","PSSVIDRG",35,0)
 S DR=DR_"1///^S X=$$GEND^PSSVIDRG($S($G(DISPDRG):DISPDRG,$G(PSSDRG):PSSDRG,1:""""));D GETD^PSSVIDRG;"
"RTN","PSSVIDRG",36,0)
 S DR=DR_"2:7;@8;8;D IVSOLINA^PSSVIDRG;10:15;17:99999"
"RTN","PSSVIDRG",37,0)
 N PSSENTRY I $G(DA) S PSSENTRY=DA D ^DIE I '$G(PSSQUIT) D MFS^PSSDEE K PSFLGS,PSSY
"RTN","PSSVIDRG",38,0)
 Q
"RTN","PSSVIDRG",39,0)
ENA ;Enter here to enter/edit additives.
"RTN","PSSVIDRG",40,0)
 N FI,PSPRNM S DRUGEDIT=1,FI=52.6
"RTN","PSSVIDRG",41,0)
 L +^PS(FI):$S($G(DILOCKTM)>0:DILOCKTM,1:3) E  W $C(7),!!,"Someone else is entering drugs ... try later !",!! G K
"RTN","PSSVIDRG",42,0)
 ;
"RTN","PSSVIDRG",43,0)
ENA1 ;
"RTN","PSSVIDRG",44,0)
 ; PSS*1*146 Compare and confirm ADDITIVE Print name change
"RTN","PSSVIDRG",45,0)
 N DA,DIC,DIE,DLAYGO,PSI,PSSY,PSSEL1,PSSDRG
"RTN","PSSVIDRG",46,0)
NA2 S PSI=0
"RTN","PSSVIDRG",47,0)
 I $G(DISPDRG),$O(^PS(52.6,"AC",DISPDRG,0)) D
"RTN","PSSVIDRG",48,0)
 . S PSSY=0 F  S PSSY=$O(^PS(52.6,"AC",DISPDRG,PSSY)) Q:'PSSY  S PSI=PSI+1,PSSY(PSI)=PSSY
"RTN","PSSVIDRG",49,0)
 ;I PSI=1 S DIC("B")=$G(PSSY(1)) S DIC=FI,DIC(0)="QEALMNTV",DLAYGO=52.6,DIC("T")="" D ^DIC I Y<0 K PSFLGA G K1
"RTN","PSSVIDRG",50,0)
 I PSI=0 S DIC=FI,DIC(0)="QEALMNTV",DLAYGO=52.6 D ^DIC I Y<0 K PSFLGA G K1
"RTN","PSSVIDRG",51,0)
 ;
"RTN","PSSVIDRG",52,0)
ENA2 ; IV Additives Editing
"RTN","PSSVIDRG",53,0)
 S PSSQUIT=0
"RTN","PSSVIDRG",54,0)
 I '$G(PSFLGA)&(PSI>0) F  D  Q:$G(Y)
"RTN","PSSVIDRG",55,0)
 . W !!," ",$$GET1^DIQ(50,DISPDRG,.01)," currently linked to the following IV Additives:",!
"RTN","PSSVIDRG",56,0)
 . S (PSDA,II)=0 F  S PSDA=$O(PSSY(PSDA)) Q:'PSDA  D
"RTN","PSSVIDRG",57,0)
 .. S PSSY15=$P(^PS(52.6,$G(PSSY(PSDA)),0),"^",15) I $E($G(PSSY15))="." S PSSY15="0"_PSSY15
"RTN","PSSVIDRG",58,0)
 .. S II=II+1 W !,?3,II_". ",$P(^PS(52.6,$G(PSSY(PSDA)),0),"^"),?32,"Additive Strength: "_$S($G(PSSY15)="":"N/A",1:$G(PSSY15))_" "_$S($G(PSSY15)="":"",1:$$GET1^DIQ(52.6,$G(PSSY(PSDA)),2))
"RTN","PSSVIDRG",59,0)
 .. W:$D(^PSDRUG(+$P(^PS(52.6,$G(PSSY(PSDA)),0),"^",2),0)) !?15,$P(^(0),"^",10)
"RTN","PSSVIDRG",60,0)
 .. F PSIV=0:0 S PSIV=$O(^PS(52.6,$G(PSSY(PSDA)),1,PSIV)) Q:'PSIV  D
"RTN","PSSVIDRG",61,0)
 ... W !?7,"- ",$P(^(PSIV,0),"^")," -        Quick Code Strength: ",$S($P($G(^PS(52.6,$G(PSSY(PSDA)),1,PSIV,0)),"^",2)'="":$P($G(^PS(52.6,$G(PSSY(PSDA)),1,PSIV,0)),"^",2),1:"N/A")
"RTN","PSSVIDRG",62,0)
 ... W "     Schedule: ",$S($P($G(^PS(52.6,$G(PSSY(PSDA)),1,PSIV,0)),"^",5)'="":$P($G(^PS(52.6,$G(PSSY(PSDA)),1,PSIV,0)),"^",5),1:"N/A"),!
"RTN","PSSVIDRG",63,0)
 . W !!,"Select "_$S(PSI=1:1,1:"1-"_PSI)_" from list above or type 'NEW' to link to a new IV Additive: "
"RTN","PSSVIDRG",64,0)
 . R X:DTIME I '$T!("^"[X) S Y=-1 Q
"RTN","PSSVIDRG",65,0)
 . W ! I $$UP^XLFSTR(X)="NEW" D NEW(52.6) Q
"RTN","PSSVIDRG",66,0)
 . I '$D(PSSY(X)) W !!,"Select the number corresponding to the IV ADDITIVE you want to edit",!,"or type 'NEW' to link ",$$GET1^DIQ(50,DISPDRG,.01)," to a new IV ADDITIVE.",$C(7) Q
"RTN","PSSVIDRG",67,0)
 . I $D(PSSY(X)) S Y=$G(PSSY(X))
"RTN","PSSVIDRG",68,0)
 G K1:($G(Y)<0)
"RTN","PSSVIDRG",69,0)
 K PSSEL1 S PSSASK="ADDITIVES",DRUG=+Y,DIE=FI,(DA,ENTRY)=+Y D EECK  G K1:$G(PSSEL1)="^" I $G(PSSEL1)=2 S Y=0 W ! G NA2
"RTN","PSSVIDRG",70,0)
 S PSSDRG=$P($G(^PS(52.6,ENTRY,0)),"^",2),DIE="^PS(52.6,",DA=ENTRY,DR="[PSSIV ADD]"
"RTN","PSSVIDRG",71,0)
 N PSSENTRY I '$G(PSSQUIT),$G(DA) S PSSENTRY=DA D ^DIE S ENTRY=PSSENTRY D MFA^PSSDEE
"RTN","PSSVIDRG",72,0)
 K PSFLGA,PSSY,PSSY15
"RTN","PSSVIDRG",73,0)
 Q
"RTN","PSSVIDRG",74,0)
ENC ;Enter here to enter/edit IV Categories
"RTN","PSSVIDRG",75,0)
 ;S X="PSIVXU" X ^%ZOSF("TEST") I  D ^PSIVXU Q:$D(XQUIT)  K DA,DIC,DIE,DR,DLAYGO S DIC="^PS(50.2,",DIC(0)="AEQL",DLAYGO=50.2 D ^DIC G:Y<0 K S DIE=DIC,DR=".01;1",DA=+Y D ^DIE G K
"RTN","PSSVIDRG",76,0)
 Q
"RTN","PSSVIDRG",77,0)
K1 ;
"RTN","PSSVIDRG",78,0)
 L -^PS(FI)
"RTN","PSSVIDRG",79,0)
K S X="PSGSETU" X ^%ZOSF("TEST") I  D ENIVKV^PSGSETU
"RTN","PSSVIDRG",80,0)
KDRG K B,DA,DG,DIC,DIE,DIJ,DIX,DIY,DIYS,DLAYGO,DO,DRUG,DRUGEDIT,FI,I,J,P,PSIV,PSIVAT,PSSIVDRG,PSIVSC,XT,Z
"RTN","PSSVIDRG",81,0)
 Q
"RTN","PSSVIDRG",82,0)
 ;
"RTN","PSSVIDRG",83,0)
GETD ;See if generic drug is inactive in file 50.
"RTN","PSSVIDRG",84,0)
 I $D(^PSDRUG(X,"I")),^("I"),(DT+1>+^("I")) D
"RTN","PSSVIDRG",85,0)
 . W $C(7),$C(7),!!,"This drug is inactive and will not be selectable during IV order entry.",!
"RTN","PSSVIDRG",86,0)
 . S ^PS(FI,DRUG,"I")=^PSDRUG(X,"I")
"RTN","PSSVIDRG",87,0)
 Q
"RTN","PSSVIDRG",88,0)
ENTDRG ;This module is no longer utilized by the Inpatient Medications application.
"RTN","PSSVIDRG",89,0)
 ;Will print word-processing field in IV add. file (52.6) and
"RTN","PSSVIDRG",90,0)
 ;IV sol. file (52.7).
"RTN","PSSVIDRG",91,0)
 ;
"RTN","PSSVIDRG",92,0)
 Q
"RTN","PSSVIDRG",93,0)
 ;S X="PSIV" X ^%ZOSF("TEST") I  D ^PSIV Q:$D(XQUIT)
"RTN","PSSVIDRG",94,0)
 S X="PSIV" X ^%ZOSF("TEST") I  D ^PSIVHLP1 Q:$D(XQUIT)
"RTN","PSSVIDRG",95,0)
 N P W !!,"Are you inquiring on" S X="... an IV ADDITIVE or IV SOLUTION (A/S): ^ADDITIVE^^ADDITIVE,SOLUTION" D ENQ^PSIV S X=$E(X) Q:"^"[X  I X["?" S HELP="DRGINQ" D ^PSIVHLP1 G ENTDRG
"RTN","PSSVIDRG",96,0)
 S FI=$S(X["A":52.6,1:52.7) N D0,D1,DA,DI,DIE,DP,DR,DQ
"RTN","PSSVIDRG",97,0)
DRG F Y=0:0 W ! X ^DD(55.11,.01,12.1) K DA,DIC S DIC="^PS("_FI_",",DIC(0)="QEAM" D ^DIC G:Y<0 KDRG S PSSIVDRG=+Y D WPH,WP
"RTN","PSSVIDRG",98,0)
 G KDRG
"RTN","PSSVIDRG",99,0)
WPH ;
"RTN","PSSVIDRG",100,0)
 W:$Y @IOF W ! F Y=1:1:79 W "-"
"RTN","PSSVIDRG",101,0)
 W !,"Drug information on: ",$P(^PS(FI,PSSIVDRG,0),"^")
"RTN","PSSVIDRG",102,0)
 W !?7,"Last updated: " W:'$D(^PS(FI,PSSIVDRG,4,0)) "N/A" I $D(^(0)) S Y=$P(^(0),"^",5) X ^DD("DD") W $P(Y,"@")," ",$P(Y,"@",2)
"RTN","PSSVIDRG",103,0)
 W ! Q
"RTN","PSSVIDRG",104,0)
WP W ! I '$D(^PS(FI,PSSIVDRG,4,0)) W !,"*** No information on file. ***"
"RTN","PSSVIDRG",105,0)
 F Z=0:0 S Z=$O(^PS(FI,PSSIVDRG,4,Z)) Q:'Z  W !,^(Z,0) I $Y+5>IOSL W $C(7),!!,"Press return key: " R I:DTIME Q:'$T!(I["^")  D WPH
"RTN","PSSVIDRG",106,0)
 W ! F Y=1:1:79 W "-"
"RTN","PSSVIDRG",107,0)
 Q
"RTN","PSSVIDRG",108,0)
ENT ;
"RTN","PSSVIDRG",109,0)
 ;Will print out information on IV DRUGS
"RTN","PSSVIDRG",110,0)
 Q
"RTN","PSSVIDRG",111,0)
 ;S X="PSIV" X ^%ZOSF("TEST") I  D ^PSIV Q:$D(XQUIT)
"RTN","PSSVIDRG",112,0)
 S X="PSIV" X ^%ZOSF("TEST") I  D ^PSIVHLP1 Q:$D(XQUIT)
"RTN","PSSVIDRG",113,0)
 ;
"RTN","PSSVIDRG",114,0)
BEG W !!,"Are you printing drug information from ..." S X="the IV ADDITIVE file or IV SOLUTION file ? ^ADDITIVE^^ADDITIVE,SOLUTION" D ENQ^PSIV G:"^"[X K I X["?" S HELP="DRGINQ" D ^PSIVHLP1 G BEG
"RTN","PSSVIDRG",115,0)
 S L=0,DIC="^PS("_$S(X["A":52.6,1:52.7)_"," D EN1^DIP D ^%ZISC G K
"RTN","PSSVIDRG",116,0)
ELECTRO ;Edit Electrolyte file
"RTN","PSSVIDRG",117,0)
 S X="PSIVXU" X ^%ZOSF("TEST") I  D ^PSIVXU Q:$D(XQUIT)  K DA,DIC S DIC="^PS(50.4,",DIC(0)="AEQLM",DLAYGO=50.4 D ^DIC G:Y<0 K
"RTN","PSSVIDRG",118,0)
 S DIE=DIC,DR="[PSSJIDE]",DA=+Y D ^DIE G ELECTRO
"RTN","PSSVIDRG",119,0)
 Q
"RTN","PSSVIDRG",120,0)
EECK I $D(PSSZ) S FILE=$S(PSSASK="ADDITIVES":$G(^PS(52.6,ENTRY,0)),1:$G(^PS(52.7,ENTRY,0))),PSSIEN=$P(FILE,"^",2) D:PSSIEN']"" PASSIN I PSSIEN'=DISPDRG D:$D(^PSDRUG(PSSIEN)) ECK,EECK1 D
"RTN","PSSVIDRG",121,0)
 . W !,"Do you really want to link this ",$S(PSSASK="ADDITIVES":"Additive",1:"Solution")," to ",$P(^PSDRUG(DISPDRG,0),"^",1)
"RTN","PSSVIDRG",122,0)
 . F  S %=2 D YN^DICN Q:%  W !,"  (A 'YES' or 'NO' response is required.)"
"RTN","PSSVIDRG",123,0)
 . I %Y="^" S PSSEL1="^" Q
"RTN","PSSVIDRG",124,0)
 . S PSSEL1=%
"RTN","PSSVIDRG",125,0)
 Q
"RTN","PSSVIDRG",126,0)
EECK1 Q:'$D(^PSDRUG(PSSIEN,0))  W !,"This Additive or Solution is linked to ",$P(^PSDRUG(PSSIEN,0),"^",1),".",!,"You are editing dispense drug ",$P(^PSDRUG(DISPDRG,0),"^",1),".",!
"RTN","PSSVIDRG",127,0)
 Q
"RTN","PSSVIDRG",128,0)
ECK W !,"You are editing a Additive or Solution which is linked to a different",!,"dispense drug from the one you are currently editing."
"RTN","PSSVIDRG",129,0)
 Q
"RTN","PSSVIDRG",130,0)
SOI I $D(^PS(59.7,1,80)),$P(^PS(59.7,1,80),"^",2)>1 W !!,"You are NOW in the ORDERABLE ITEM matching for Solutions." S Y=ENTRY_"^"_$P(^PS(52.7,ENTRY,0),"^",1),PSMASTER=1 D MAS^PSSSOLIT K PSMASTER
"RTN","PSSVIDRG",131,0)
 Q
"RTN","PSSVIDRG",132,0)
ADDOI I $D(^PS(59.7,1,80)),$P(^PS(59.7,1,80),"^",2)>1 W !!,"You are NOW in the ORDERABLE ITEM matching for Additives." S Y=ENTRY_"^"_$P(^PS(52.6,ENTRY,0),"^",1),PSMASTER=1 D MAS^PSSADDIT K PSMASTER
"RTN","PSSVIDRG",133,0)
 Q
"RTN","PSSVIDRG",134,0)
PASSIN S FILE=$S(PSSASK="ADDITIVES":$G(^PS(52.6,ENTRY,0)),1:$G(^PS(52.7,ENTRY,0))) S (X,PSSIEN)=DISPDRG ;146
"RTN","PSSVIDRG",135,0)
 Q
"RTN","PSSVIDRG",136,0)
MASTER F PSSOR=0:0 S PSSOR=$O(^PS(50.7,PSSOR)) Q:'PSSOR  D EN2^PSSHL1(PSSOR,"MUP")
"RTN","PSSVIDRG",137,0)
 Q
"RTN","PSSVIDRG",138,0)
PRNMHD ; PSS*1*146 Hold the print name when editing
"RTN","PSSVIDRG",139,0)
 N FI K PSPRNM
"RTN","PSSVIDRG",140,0)
 S FI=DIC I FI'["^" S FI="^PS("_FI_","
"RTN","PSSVIDRG",141,0)
 S FI=FI_DA_",0)",PSPRNM=$P($G(@FI),"^")
"RTN","PSSVIDRG",142,0)
 Q
"RTN","PSSVIDRG",143,0)
PRNM() ; PSS*1*146 compare and confirm Print name change
"RTN","PSSVIDRG",144,0)
 N PRNMDONE,%,FI,PRNAME,DUP,DUPLIC S PRNMDONE=0
"RTN","PSSVIDRG",145,0)
 S FI=DIC I FI'["^" S FI="^PS("_FI_","
"RTN","PSSVIDRG",146,0)
 S FI=FI_DA_",0)",PRNAME=$P($G(@FI),"^")
"RTN","PSSVIDRG",147,0)
 I (PSPRNM]"")&(PRNAME]"")&(PSPRNM'=PRNAME) F  Q:$G(PRNMDONE)  D
"RTN","PSSVIDRG",148,0)
 . W !,"  ARE YOU SURE YOU WANT TO CHANGE THE PRINT NAME TO "_PRNAME
"RTN","PSSVIDRG",149,0)
 . S %=2 D YN^DICN
"RTN","PSSVIDRG",150,0)
 . S:(%=1) PSPRNM=PRNAME S:% PRNMDONE=1
"RTN","PSSVIDRG",151,0)
 . I %Y="^" S PSSQUIT=1,PRNMDONE=1
"RTN","PSSVIDRG",152,0)
 . I 'PRNMDONE W !,"  Answer with 'Yes' or 'No'.",$C(7),! Q
"RTN","PSSVIDRG",153,0)
 . W !,"  PRINT NAME set to "_PSPRNM
"RTN","PSSVIDRG",154,0)
 Q PSPRNM
"RTN","PSSVIDRG",155,0)
GEND(CUR) ;PSS*1*146
"RTN","PSSVIDRG",156,0)
 ;Ask and Confirm generic drug.
"RTN","PSSVIDRG",157,0)
 ;Returns Selected drug IEN (file 50)
"RTN","PSSVIDRG",158,0)
 ; CUR -> Default (Current Drug)
"RTN","PSSVIDRG",159,0)
 N DIC,%,PSSEL,Y,X
"RTN","PSSVIDRG",160,0)
 S PSSEL=0,DIC=50,DIC("A")="GENERIC DRUG: ",DIC(0)="AEMQ",DIC("B")=$S($G(CUR):CUR,1:"")
"RTN","PSSVIDRG",161,0)
 F  D  Q:PSSEL=1
"RTN","PSSVIDRG",162,0)
 . D ^DIC W:(Y>0)&($G(CUR)']"") " ??" I $G(CUR)]""!(Y'>0),$G(DUOUT)!$G(DTOUT) S PSSEL=1,PSSQUIT=1 Q
"RTN","PSSVIDRG",163,0)
 . I +Y=+CUR D  I PSSEL=1 Q
"RTN","PSSVIDRG",164,0)
 . . I PSSASK="ADDITIVES",$D(^PS(52.6,"AC",+Y,+$G(DA))) S PSSEL=1 Q
"RTN","PSSVIDRG",165,0)
 . . I PSSASK="SOLUTIONS",$D(^PS(52.7,"AC",+Y,+$G(DA))) S PSSEL=1 Q
"RTN","PSSVIDRG",166,0)
 . I Y>0 F  D  Q:$G(PSSEL)
"RTN","PSSVIDRG",167,0)
 . . N CURADD,CURGEND
"RTN","PSSVIDRG",168,0)
 . . S CURADD=$S($G(PSSASK)="ADDITIVES":$$GET1^DIQ(52.6,$G(DA),.01,"E"),1:$$GET1^DIQ(52.7,$G(DA),.01,"E"))
"RTN","PSSVIDRG",169,0)
 . . S CURGEND=$$GET1^DIQ($S($G(PSSASK)="ADDITIVES":52.6,1:52.7),$G(DA),1,"E")
"RTN","PSSVIDRG",170,0)
 . . W !!,"  You are about to change the GENERIC DRUG linked to this "_$S($G(PSSASK)="ADDITIVES":"ADDITIVE.",1:"SOLUTION.")
"RTN","PSSVIDRG",171,0)
 . . W !,"  "_$S($G(PSSASK)="ADDITIVES":"ADDITIVE",1:"SOLUTION")_" "_$G(CURADD)_" is "_$S($G(CURGEND)="":"not ",1:"")_"currently linked to "_$S($G(CURGEND)="":"any",1:"")
"RTN","PSSVIDRG",172,0)
 . . W !,"  GENERIC DRUG "_$G(CURGEND)_"."
"RTN","PSSVIDRG",173,0)
 . . W !!,"  Are you sure you want to link "_$S($G(PSSASK)="ADDITIVES":"ADDITIVE",1:"SOLUTION")_" "_$G(CURADD)
"RTN","PSSVIDRG",174,0)
 . . W !,"  to GENERIC DRUG "_$$GET1^DIQ(50,+Y,.01,"E")
"RTN","PSSVIDRG",175,0)
 . . S %=2 D YN^DICN S:% PSSEL=% I %Y="^" S PSSQUIT=1,DUOUT=1,PSSEL=1 Q
"RTN","PSSVIDRG",176,0)
 . . I 'PSSEL W !,"   Answer with 'Yes' or 'No'.",$C(7),! Q
"RTN","PSSVIDRG",177,0)
 Q $S($G(DUOUT)!$G(DTOUT)!(Y<0):"^",1:+Y)
"RTN","PSSVIDRG",178,0)
 ;
"RTN","PSSVIDRG",179,0)
NEW(FI) ; add new additive/solution
"RTN","PSSVIDRG",180,0)
 N DA,DIC,DIE,DR,DLAYGO
"RTN","PSSVIDRG",181,0)
 S (DLAYGO,DIC)=FI,DIC(0)="QEALMNTV",DIC("T")="" D ^DIC K DIC
"RTN","PSSVIDRG",182,0)
 Q
"RTN","PSSVIDRG",183,0)
 ;
"RTN","PSSVIDRG",184,0)
IVSOLINA ; Checking for Duplicate IV Solution Volume when INACTIVATION DATE is removed
"RTN","PSSVIDRG",185,0)
 ; Global variable: PSSINADT - INACTIVATION DATE value being deleted
"RTN","PSSVIDRG",186,0)
 I '$G(PSSINADT),$$GET1^DIQ(52.7,DA,8,"I") S PSSINADT=$$GET1^DIQ(52.7,DA,8,"I")
"RTN","PSSVIDRG",187,0)
 ;I +$G(PSSINADT),('X&PSSINADT)!(X&(X'=PSSINADT)) D
"RTN","PSSVIDRG",188,0)
 I 'X!(X>DT) D
"RTN","PSSVIDRG",189,0)
 . N OI
"RTN","PSSVIDRG",190,0)
 . I $$GET1^DIQ(52.7,DA,17,"I") D
"RTN","PSSVIDRG",191,0)
 . . S OI=+$$GET1^DIQ(52.7,DA,9,"I")
"RTN","PSSVIDRG",192,0)
 . . I $$CKDUPSOL^PSSDDUT2(OI,DA,+$$GET1^DIQ(52.7,DA,2),1) D
"RTN","PSSVIDRG",193,0)
 . . . S $P(^PS(52.7,DA,"I"),"^")=$G(PSSINADT)
"RTN","PSSVIDRG",194,0)
 . . . S Y="@8"
"RTN","PSSVIDRG",195,0)
 . . E  S PSSINADT=X
"RTN","PSSVIDRG",196,0)
 E  S PSSINADT=X
"RTN","PSSVIDRG",197,0)
 Q
"VER")
8.0^22.0
"^DD",50,50,66,0)
MAXIMUM DAYS SUPPLY^NJ3,0X^^2;7^D MXDAYSUP^PSSDDUT2
"^DD",50,50,66,3)
Enter the maximum number of days supply allowed for this drug. Enter ?? for important information regarding default values and copays.
"^DD",50,50,66,4)

"^DD",50,50,66,21,0)
^^20^20^3160405^
"^DD",50,50,66,21,1,0)
This field is used to determine the maximum number for days supply that
"^DD",50,50,66,21,2,0)
may be assigned to this drug. If this field is left blank, the MAXIMUM
"^DD",50,50,66,21,3,0)
DAYS SUPPLY is set to a default of 90 unless the drug is a controlled 
"^DD",50,50,66,21,4,0)
substance or Clozapine. Any value greater than 90 increases the number
"^DD",50,50,66,21,5,0)
of potential copay units above 3. 
"^DD",50,50,66,21,6,0)
 
"^DD",50,50,66,21,7,0)
The maximum value allowed for this field is 365 (days) for most drugs, 
"^DD",50,50,66,21,8,0)
however:
"^DD",50,50,66,21,9,0)
 
"^DD",50,50,66,21,10,0)
- Schedule 2 controlled substances have a 30-day maximum days supply
"^DD",50,50,66,21,11,0)
  limit.
"^DD",50,50,66,21,12,0)
 
"^DD",50,50,66,21,13,0)
- Schedules 3 thru 5 controlled substances have a 90-day maximum days
"^DD",50,50,66,21,14,0)
  supply limit. 
"^DD",50,50,66,21,15,0)
 
"^DD",50,50,66,21,16,0)
- The maximum number of days supply for this drug cannot exceed the
"^DD",50,50,66,21,17,0)
  National Drug File (NDF) maximum value if it exists.
"^DD",50,50,66,21,18,0)
 
"^DD",50,50,66,21,19,0)
- No value can be entered for Clozapine drugs as the maximum days supply
"^DD",50,50,66,21,20,0)
  is controlled by the Clozapine functionality.
"^DD",50,50,66,"DT")
3160405
"^DD",51,51,31,0)
FREQUENCY (IN MINUTES)^NJ6,0^^0;8^K:+X'=X!(X>525600)!(X<0)!(X?.E1"."1.N) X
"^DD",51,51,31,3)
Type a number between 0 and 525600, 0 decimal digits.
"^DD",51,51,31,21,0)
^^5^5^3000513^
"^DD",51,51,31,21,1,0)
This is the number of minutes between each time that the action should
"^DD",51,51,31,21,2,0)
take place. This field will be used to calculate defaults for Quantity and
"^DD",51,51,31,21,3,0)
Days Supply in the Outpatient Pharmacy Package. It will also be used to
"^DD",51,51,31,21,4,0)
calculate defaults for the fields in the pharmacy dialog in Computerized
"^DD",51,51,31,21,5,0)
Patient Record System (CPRS).
"^DD",51,51,31,"DT")
3150318
"^DD",51.1,51.1,2,0)
FREQUENCY (IN MINUTES)^NJ6,0X^^0;3^D ENFREQ^PSSJSV
"^DD",51.1,51.1,2,3)
Type a number between 1 and 525600, 0 Decimal Digits
"^DD",51.1,51.1,2,20,0)
^.3LA^1^1
"^DD",51.1,51.1,2,20,1,0)
PSJ
"^DD",51.1,51.1,2,21,0)
^.001^2^2^3150318^^^^
"^DD",51.1,51.1,2,21,1,0)
  The number of minutes between each time that the action should take
"^DD",51.1,51.1,2,21,2,0)
place.
"^DD",51.1,51.1,2,23,0)
^.001^2^2^3150318^^^^
"^DD",51.1,51.1,2,23,1,0)
 
"^DD",51.1,51.1,2,23,2,0)
 
"^DD",51.1,51.1,2,"DT")
3150727
"^DD",51.1,51.1,12,0)
INACTIVE^S^1:YES;^0;12^Q
"^DD",51.1,51.1,12,3)
Answer YES to mark this administration schedule entry as inactive.
"^DD",51.1,51.1,12,21,0)
^.001^3^3^3151016^^
"^DD",51.1,51.1,12,21,1,0)
This field is used to indicate that a Standard Schedule is inactive.
"^DD",51.1,51.1,12,21,2,0)
Inactive schedules are filtered from the list of schedules sent to CPRS
"^DD",51.1,51.1,12,21,3,0)
for selection when users are placing a medication order.
"^DD",51.1,51.1,12,"DT")
3151016
"^DD",52.6,52.6,12,0)
INACTIVATION DATE^D^^I;1^S %DT="EX" D ^%DT S X=Y K:Y<1 X
"^DD",52.6,52.6,12,1,0)
^.1
"^DD",52.6,52.6,12,1,1,0)
52.6^AE^MUMPS
"^DD",52.6,52.6,12,1,1,1)
I '$D(DIU(0)) N PSSTEST S PSSTEST=$P($G(^PS(52.6,DA,0)),"^",11) Q:'PSSTEST  S PSSCROSS=1 D EN1^PSSPOIDT K PSSCROSS Q
"^DD",52.6,52.6,12,1,1,2)
I '$D(DIU(0)) N PSSTEST S PSSTEST=$P($G(^PS(52.6,DA,0)),"^",11) Q:'PSSTEST  S PSSCROSS=1 D EN1^PSSPOIDT K PSSCROSS Q
"^DD",52.6,52.6,12,1,1,3)
Do Not Delete
"^DD",52.6,52.6,12,1,1,"%D",0)
^^8^8^3001026^
"^DD",52.6,52.6,12,1,1,"%D",1,0)
This cross reference is used to keep the Pharmacy Orderable Item entry in
"^DD",52.6,52.6,12,1,1,"%D",2,0)
the PHARMACY ORDERABLE ITEM file (#50.7) up to date with current
"^DD",52.6,52.6,12,1,1,"%D",3,0)
information, based on all active Drugs, IV Additives, and IV Solutions
"^DD",52.6,52.6,12,1,1,"%D",4,0)
that are matched to the Pharmacy Orderable Item. This information includes
"^DD",52.6,52.6,12,1,1,"%D",5,0)
Inactivation Date status, Non-Formulary status, Supply status, and Usage
"^DD",52.6,52.6,12,1,1,"%D",6,0)
status. This information is also sent to CPRS (Computerized Patient Record
"^DD",52.6,52.6,12,1,1,"%D",7,0)
System) by using the "PS MFSEND OR" protocol to update the corresponding
"^DD",52.6,52.6,12,1,1,"%D",8,0)
Orderable Item entry in the ORDERABLE ITEMS file (#101.43).
"^DD",52.6,52.6,12,1,1,"DT")
3001017
"^DD",52.6,52.6,12,3)
Enter the date this drug was inactivated.
"^DD",52.6,52.6,12,20,0)
^.3LA^1^1
"^DD",52.6,52.6,12,20,1,0)
PSJI
"^DD",52.6,52.6,12,21,0)
^.001^4^4^3160211^^^^
"^DD",52.6,52.6,12,21,1,0)
  This field is used to inactivate a drug.  An IV drug should NEVER be
"^DD",52.6,52.6,12,21,2,0)
deleted from a file since some IV ORDERS may still be using it.  Enter
"^DD",52.6,52.6,12,21,3,0)
the date the drug should be inactivated.  Once the date of inactivation
"^DD",52.6,52.6,12,21,4,0)
arrives, the drug will no longer be a valid choice for IV ADDITIVES.
"^DD",52.6,52.6,12,"DT")
3001017
"^DD",52.7,52.7,2,0)
VOLUME^RFX^^0;3^D IVSOLVOL^PSSDDUT2
"^DD",52.7,52.7,2,1,0)
^.1^^0
"^DD",52.7,52.7,2,3)
Enter a number from 0.01-9999.
"^DD",52.7,52.7,2,20,0)
^.3LA^1^1
"^DD",52.7,52.7,2,20,1,0)
PSJI
"^DD",52.7,52.7,2,21,0)
^^3^3^2981218^^^^
"^DD",52.7,52.7,2,21,1,0)
  The number entered here will represent the volume of this solution.
"^DD",52.7,52.7,2,21,2,0)
When entering an IV order, this volume will be stuffed into the
"^DD",52.7,52.7,2,21,3,0)
volume field for that IV ORDER.
"^DD",52.7,52.7,2,"DT")
3150701
"^DD",52.7,52.7,8,0)
INACTIVATION DATE^DX^^I;1^S %DT="EX" D ^%DT S X=Y K:Y<1 X
"^DD",52.7,52.7,8,1,0)
^.1
"^DD",52.7,52.7,8,1,1,0)
52.7^AE^MUMPS
"^DD",52.7,52.7,8,1,1,1)
I '$D(DIU(0)) N PSSTEST S PSSTEST=$P($G(^PS(52.7,DA,0)),"^",11) Q:'PSSTEST  S PSSCROSS=1 D EN1^PSSPOIDT K PSSCROSS Q
"^DD",52.7,52.7,8,1,1,2)
I '$D(DIU(0)) N PSSTEST S PSSTEST=$P($G(^PS(52.7,DA,0)),"^",11) Q:'PSSTEST  S PSSCROSS=1 D EN1^PSSPOIDT K PSSCROSS Q
"^DD",52.7,52.7,8,1,1,3)
Do Not Delete
"^DD",52.7,52.7,8,1,1,"%D",0)
^^8^8^3001026^
"^DD",52.7,52.7,8,1,1,"%D",1,0)
This cross reference is used to keep the Pharmacy Orderable Item entry in
"^DD",52.7,52.7,8,1,1,"%D",2,0)
the PHARMACY ORDERABLE ITEM file (#50.7) up to date with current
"^DD",52.7,52.7,8,1,1,"%D",3,0)
information, based on all active Drugs, IV Additives, and IV Solutions
"^DD",52.7,52.7,8,1,1,"%D",4,0)
that are matched to the Pharmacy Orderable Item. This information includes
"^DD",52.7,52.7,8,1,1,"%D",5,0)
Inactivation Date status, Non-Formulary status, Supply status, and Usage
"^DD",52.7,52.7,8,1,1,"%D",6,0)
status. This information is also sent to CPRS (Computerized Patient Record
"^DD",52.7,52.7,8,1,1,"%D",7,0)
System) by using the "PS MFSEND OR" protocol to update the corresponding
"^DD",52.7,52.7,8,1,1,"%D",8,0)
Orderable Item entry in the ORDERABLE ITEMS file (#101.43).
"^DD",52.7,52.7,8,1,1,"DT")
3001017
"^DD",52.7,52.7,8,3)
Enter the date this drug was inactivated.
"^DD",52.7,52.7,8,20,0)
^.3LA^1^1
"^DD",52.7,52.7,8,20,1,0)
PSJI
"^DD",52.7,52.7,8,21,0)
^.001^4^4^3160119^^^^
"^DD",52.7,52.7,8,21,1,0)
  This field is used to inactivate a drug.  An IV drug should NEVER be
"^DD",52.7,52.7,8,21,2,0)
deleted from a file since some IV ORDERS may still be using it.  Enter
"^DD",52.7,52.7,8,21,3,0)
the date the drug should be inactivated.  Once the date of inactivation
"^DD",52.7,52.7,8,21,4,0)
arrives, the drug will no longer be a valid choice for IV SOLUTIONS.
"^DD",52.7,52.7,8,"DT")
3150702
"^DD",52.7,52.7,17,0)
USED IN IV FLUID ORDER ENTRY^*SX^1:YES;0:NO;^0;13^D UIVFOE^PSSDDUT2
"^DD",52.7,52.7,17,.1)

"^DD",52.7,52.7,17,1,0)
^.1
"^DD",52.7,52.7,17,1,1,0)
52.7^AF^MUMPS
"^DD",52.7,52.7,17,1,1,1)
I '$D(DIU(0)) N PSSTEST S PSSTEST=$P($G(^PS(52.7,DA,0)),"^",11) Q:'PSSTEST  S PSSCROSS=1 D EN1^PSSPOIDT K PSSCROSS Q
"^DD",52.7,52.7,17,1,1,2)
I '$D(DIU(0)) N PSSTEST S PSSTEST=$P($G(^PS(52.7,DA,0)),"^",11) Q:'PSSTEST  S PSSCROSS=1 D EN1^PSSPOIDT K PSSCROSS Q
"^DD",52.7,52.7,17,1,1,"%D",0)
^^8^8^3001026^
"^DD",52.7,52.7,17,1,1,"%D",1,0)
This cross reference is used to keep the Pharmacy Orderable Item entry in
"^DD",52.7,52.7,17,1,1,"%D",2,0)
the PHARMACY ORDERABLE ITEM file (#50.7) up to date with current
"^DD",52.7,52.7,17,1,1,"%D",3,0)
information, based on all active Drugs, IV Additives, and IV Solutions
"^DD",52.7,52.7,17,1,1,"%D",4,0)
that are matched to the Pharmacy Orderable Item. This information includes
"^DD",52.7,52.7,17,1,1,"%D",5,0)
Inactivation Date status, Non-Formulary status, Supply status, and Usage
"^DD",52.7,52.7,17,1,1,"%D",6,0)
status. This information is also sent to CPRS (Computerized Patient Record
"^DD",52.7,52.7,17,1,1,"%D",7,0)
System) by using the "PS MFSEND OR" protocol to update the corresponding
"^DD",52.7,52.7,17,1,1,"%D",8,0)
Orderable Item entry in the ORDERABLE ITEMS file (#101.43).
"^DD",52.7,52.7,17,1,1,"DT")
3001017
"^DD",52.7,52.7,17,3)
Answer YES to indicate this IV Solution will be available to be ordered via the CPRS IV Fluid Order Entry or NO if it will not be available for selection.
"^DD",52.7,52.7,17,12)
Only solutions with no data in the PRINT NAME {2} field may be selected.
"^DD",52.7,52.7,17,12.1)
S DIC("S")="I $P(^PS(52.7,DA,0),U,4)="""""
"^DD",52.7,52.7,17,21,0)
^^3^3^2940714^^^^
"^DD",52.7,52.7,17,21,1,0)
Allows Pharmacy to limit the solutions available in IV Fluid order entry.
"^DD",52.7,52.7,17,21,2,0)
Solutions having data in the PRINT NAME {2} field are assumed to be 
"^DD",52.7,52.7,17,21,3,0)
multi-ingredient drugs, and are not selectable.
"^DD",52.7,52.7,17,23,0)
^^1^1^2940714^^^
"^DD",52.7,52.7,17,23,1,0)
Limits solutions used in clinician IV Fluid order entry to single ingredient drugs only. Solutions with data in the PRINT NAME {2} field (.02) are now allowed to be marked.
"^DD",52.7,52.7,17,"DT")
3150929
"BLD",9246,6)
^170
**END**
**END**

