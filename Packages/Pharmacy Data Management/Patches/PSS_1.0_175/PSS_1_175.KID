KIDS Distribution saved on Apr 29, 2015@12:41:52
PSS*1*175
**KIDS**:PSS*1.0*175^

**INSTALL NAME**
PSS*1.0*175
"BLD",9234,0)
PSS*1.0*175^PHARMACY DATA MANAGEMENT^0^3150429^y
"BLD",9234,4,0)
^9.64PA^^
"BLD",9234,6)
5^
"BLD",9234,6.3)
9
"BLD",9234,"ABPKG")
n
"BLD",9234,"KRN",0)
^9.67PA^779.2^20
"BLD",9234,"KRN",.4,0)
.4
"BLD",9234,"KRN",.401,0)
.401
"BLD",9234,"KRN",.402,0)
.402
"BLD",9234,"KRN",.403,0)
.403
"BLD",9234,"KRN",.5,0)
.5
"BLD",9234,"KRN",.84,0)
.84
"BLD",9234,"KRN",3.6,0)
3.6
"BLD",9234,"KRN",3.8,0)
3.8
"BLD",9234,"KRN",9.2,0)
9.2
"BLD",9234,"KRN",9.8,0)
9.8
"BLD",9234,"KRN",9.8,"NM",0)
^9.68A^5^4
"BLD",9234,"KRN",9.8,"NM",2,0)
PSSCKOS^^0^B13066686
"BLD",9234,"KRN",9.8,"NM",3,0)
PSSDIUTX^^0^B3013700
"BLD",9234,"KRN",9.8,"NM",4,0)
PSSDIUTL^^0^B168823037
"BLD",9234,"KRN",9.8,"NM",5,0)
PSSFDBDI^^0^B130530909
"BLD",9234,"KRN",9.8,"NM","B","PSSCKOS",2)

"BLD",9234,"KRN",9.8,"NM","B","PSSDIUTL",4)

"BLD",9234,"KRN",9.8,"NM","B","PSSDIUTX",3)

"BLD",9234,"KRN",9.8,"NM","B","PSSFDBDI",5)

"BLD",9234,"KRN",19,0)
19
"BLD",9234,"KRN",19.1,0)
19.1
"BLD",9234,"KRN",101,0)
101
"BLD",9234,"KRN",409.61,0)
409.61
"BLD",9234,"KRN",771,0)
771
"BLD",9234,"KRN",779.2,0)
779.2
"BLD",9234,"KRN",870,0)
870
"BLD",9234,"KRN",8989.51,0)
8989.51
"BLD",9234,"KRN",8989.52,0)
8989.52
"BLD",9234,"KRN",8994,0)
8994
"BLD",9234,"KRN","B",.4,.4)

"BLD",9234,"KRN","B",.401,.401)

"BLD",9234,"KRN","B",.402,.402)

"BLD",9234,"KRN","B",.403,.403)

"BLD",9234,"KRN","B",.5,.5)

"BLD",9234,"KRN","B",.84,.84)

"BLD",9234,"KRN","B",3.6,3.6)

"BLD",9234,"KRN","B",3.8,3.8)

"BLD",9234,"KRN","B",9.2,9.2)

"BLD",9234,"KRN","B",9.8,9.8)

"BLD",9234,"KRN","B",19,19)

"BLD",9234,"KRN","B",19.1,19.1)

"BLD",9234,"KRN","B",101,101)

"BLD",9234,"KRN","B",409.61,409.61)

"BLD",9234,"KRN","B",771,771)

"BLD",9234,"KRN","B",779.2,779.2)

"BLD",9234,"KRN","B",870,870)

"BLD",9234,"KRN","B",8989.51,8989.51)

"BLD",9234,"KRN","B",8989.52,8989.52)

"BLD",9234,"KRN","B",8994,8994)

"BLD",9234,"QUES",0)
^9.62^^
"BLD",9234,"REQB",0)
^9.611^1^1
"BLD",9234,"REQB",1,0)
PSS*1.0*169^2
"BLD",9234,"REQB","B","PSS*1.0*169",1)

"MBREQ")
0
"PKG",517,-1)
1^1
"PKG",517,0)
PHARMACY DATA MANAGEMENT^PSS^Maintenance of Pharmacy files.
"PKG",517,20,0)
^9.402P^^
"PKG",517,22,0)
^9.49I^1^1
"PKG",517,22,1,0)
1.0^2970930^2971014^11595
"PKG",517,22,1,"PAH",1,0)
175^3150429^636
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
4
"RTN","PSSCKOS")
0^2^B13066686
"RTN","PSSCKOS",1,0)
PSSCKOS ;BP/AGV - Returns order status for OP pharmacy using the CK option ;12/14/12
"RTN","PSSCKOS",2,0)
 ;;1.0;PHARMACY DATA MANAGEMENT;**175**;9/30/97;Build 9
"RTN","PSSCKOS",3,0)
 ;
"RTN","PSSCKOS",4,0)
 ; @Author  - Alberto Vargas
"RTN","PSSCKOS",5,0)
 ; @Date    - December 14, 2012
"RTN","PSSCKOS",6,0)
 ; @Version - 1.0
"RTN","PSSCKOS",7,0)
 ; @CCRs    - 5828, 6450, 6600
"RTN","PSSCKOS",8,0)
 ;
"RTN","PSSCKOS",9,0)
THOSTAT(DRG,THR,TCTR) ;**Add order status to THERAPY order check messages while using the hidden CK option
"RTN","PSSCKOS",10,0)
 NEW DRGN,PSOSTA,PSONM,PSOPON,PSOCFLG,PSOFLG SET DRGN="",PSOSTA="",PSONM="",PSOPON="",PSOCFLG="",PSOFLG=""
"RTN","PSSCKOS",11,0)
 ;**Retrieve and extract associated order number
"RTN","PSSCKOS",12,0)
 SET DRGN=DRG,PSOPON=$P($G(^TMP($J,LIST,"OUT","THERAPY",THR,"DRUGS",TCTR)),U,1),PSOCFLG=$P(PSOPON,";",1),PSOPON=$P(PSOPON,";",2)
"RTN","PSSCKOS",13,0)
 ;**Check for a clinic order
"RTN","PSSCKOS",14,0)
 IF PSOCFLG["C" SET DRGN=DRG_" (Clinic order)" Q DRGN
"RTN","PSSCKOS",15,0)
 ;**Order through PSOSD array to retrieve associated order statuses from patient's profile
"RTN","PSSCKOS",16,0)
 FOR  SET PSOSTA=$O(PSOSD(PSOSTA)) Q:(PSOSTA="")!($G(PSOFLG))  D
"RTN","PSSCKOS",17,0)
 .IF '$D(PSOSD(PSOSTA,DRG)),DRG=PSODRUG("NAME") SET DRGN=DRG_" (Prospective)",PSOFLG=1
"RTN","PSSCKOS",18,0)
 .FOR  SET PSONM=$O(PSOSD(PSOSTA,PSONM)) Q:(PSONM="")!($G(PSOFLG))  D
"RTN","PSSCKOS",19,0)
 ..IF DRG=$P(PSONM,U,1)  D
"RTN","PSSCKOS",20,0)
 ...IF PSOSTA="ACTIVE",PSOPON=$P(PSOSD(PSOSTA,PSONM),U,1) SET DRGN=DRG_" (Local Rx)",PSOFLG=1
"RTN","PSSCKOS",21,0)
 ...IF PSOSTA="ZNONVA",PSOPON=$P(PSOSD(PSOSTA,PSONM),U,10) SET DRGN=DRG_" (Non-VA)",PSOFLG=1
"RTN","PSSCKOS",22,0)
 ...IF PSOSTA="DISCONTINUED",PSOPON=$P(PSOSD(PSOSTA,PSONM),U,1) SET DRGN=DRG_" (Discontinued)",PSOFLG=1
"RTN","PSSCKOS",23,0)
 ...IF PSOSTA="PENDING",PSOPON=$P(PSOSD(PSOSTA,PSONM),U,10) SET DRGN=DRG_" (Pending)",PSOFLG=1
"RTN","PSSCKOS",24,0)
 Q DRGN
"RTN","PSSCKOS",25,0)
 ;
"RTN","PSSCKOS",26,0)
OSTAT(DRG,ON) ;**Add order status to DRUG order check messages while using the hidden CK option
"RTN","PSSCKOS",27,0)
 NEW DRGN,PSOSTA,PSONM,PSOPON,PSOCFLG,PSOFLG SET DRGN="",PSOSTA="",PSONM="",PSOPON="",PSOCFLG="",PSOFLG=""
"RTN","PSSCKOS",28,0)
 ;**Retrieve and extract associated order number
"RTN","PSSCKOS",29,0)
 SET DRGN=DRG,PSOCFLG=$P(ON,";",1),PSOPON=$P(ON,";",2)
"RTN","PSSCKOS",30,0)
 ;**Check for a clinic order
"RTN","PSSCKOS",31,0)
 IF PSOCFLG["C" SET DRGN=DRG_" (Clinic order)" Q DRGN
"RTN","PSSCKOS",32,0)
 ;**Order through PSOSD array to retrieve associated order statuses from patient's profile
"RTN","PSSCKOS",33,0)
 FOR  SET PSOSTA=$O(PSOSD(PSOSTA)) Q:(PSOSTA="")!($G(PSOFLG))  D
"RTN","PSSCKOS",34,0)
 .IF '$D(PSOSD(PSOSTA,DRG)),DRG=PSODRUG("NAME") SET DRGN=DRG_" (Prospective)",PSOFLG=1
"RTN","PSSCKOS",35,0)
 .FOR  SET PSONM=$O(PSOSD(PSOSTA,PSONM)) Q:(PSONM="")!($G(PSOFLG))  D
"RTN","PSSCKOS",36,0)
 ..IF DRG=$P(PSONM,U,1)  D
"RTN","PSSCKOS",37,0)
 ...IF PSOSTA="ACTIVE",PSOPON=$P(PSOSD(PSOSTA,PSONM),U,1) SET DRGN=DRG_" (Local Rx)",PSOFLG=1
"RTN","PSSCKOS",38,0)
 ...IF PSOSTA="ZNONVA",PSOPON=$P(PSOSD(PSOSTA,PSONM),U,10) SET DRGN=DRG_" (Non-VA)",PSOFLG=1
"RTN","PSSCKOS",39,0)
 ...IF PSOSTA="PENDING",PSOPON=$P(PSOSD(PSOSTA,PSONM),U,10) SET DRGN=DRG_" (Pending)",PSOFLG=1
"RTN","PSSCKOS",40,0)
 Q DRGN
"RTN","PSSCKOS",41,0)
 ;
"RTN","PSSCKOS",42,0)
POSTAT(DRG,PDRG,SV,ON,CT) ;**Add order status to PDRUG order check messages while using the hidden CK option
"RTN","PSSCKOS",43,0)
 NEW PDRGN,PSOSTA,PSONM,PSOPON,PSOCFLG,PSOFLG SET PDRGN="",PSOSTA="",PSONM="",PSOPON="",PSOCFLG="",PSOFLG=""
"RTN","PSSCKOS",44,0)
 ;**Retrieve and extract associated order number
"RTN","PSSCKOS",45,0)
 SET PDRGN=PDRG,PSOPON=$P($G(^TMP($J,LIST,"OUT","DRUGDRUG",SV,DRG,ON,CT)),U,1),PSOCFLG=$P(PSOPON,";",1),PSOPON=$P(PSOPON,";",2)
"RTN","PSSCKOS",46,0)
 ;**Check for a clinic order
"RTN","PSSCKOS",47,0)
 IF PSOCFLG["C" SET PDRGN=PDRG_" (Clinic order)" Q PDRGN
"RTN","PSSCKOS",48,0)
 ;**Order through PSOSD array to retrieve associated order statuses from patient's profile
"RTN","PSSCKOS",49,0)
 FOR  SET PSOSTA=$O(PSOSD(PSOSTA)) Q:(PSOSTA="")!($G(PSOFLG))  D
"RTN","PSSCKOS",50,0)
 .IF '$D(PSOSD(PSOSTA,PDRG)),PDRG=PSODRUG("NAME") SET PDRGN=PDRG_" (Prospective)",PSOFLG=1
"RTN","PSSCKOS",51,0)
 .FOR  SET PSONM=$O(PSOSD(PSOSTA,PSONM)) Q:(PSONM="")!($G(PSOFLG))  D
"RTN","PSSCKOS",52,0)
 ..IF PDRG=$P(PSONM,U,1)  D
"RTN","PSSCKOS",53,0)
 ...IF PSOSTA="ACTIVE",PSOPON=$P(PSOSD(PSOSTA,PSONM),U,1) SET PDRGN=PDRG_" (Local Rx)",PSOFLG=1
"RTN","PSSCKOS",54,0)
 ...IF PSOSTA="ZNONVA",PSOPON=$P(PSOSD(PSOSTA,PSONM),U,10) SET PDRGN=PDRG_" (Non-VA)",PSOFLG=1
"RTN","PSSCKOS",55,0)
 ...IF PSOSTA="PENDING",PSOPON=$P(PSOSD(PSOSTA,PSONM),U,10) SET PDRGN=PDRG_" (Pending)",PSOFLG=1
"RTN","PSSCKOS",56,0)
 Q PDRGN
"RTN","PSSDIUTL")
0^4^B168823037
"RTN","PSSDIUTL",1,0)
PSSDIUTL ;HP/MJE - Drug Interaction Utility ;09/22/11 5:00pm
"RTN","PSSDIUTL",2,0)
 ;;1.0;PHARMACY DATA MANAGEMENT;**169,175**;9/30/97;Build 9
"RTN","PSSDIUTL",3,0)
 ;Reference ^PSDRUG supported by DBIA 221
"RTN","PSSDIUTL",4,0)
 ;Reference to XTID is supported DBIS 4631
"RTN","PSSDIUTL",5,0)
 ;Reference to IN^PSSHRQ2 supported by DBIA 5369
"RTN","PSSDIUTL",6,0)
CHKFDB ;ping FDB
"RTN","PSSDIUTL",7,0)
 N BASE
"RTN","PSSDIUTL",8,0)
 S BASE="PINGTST^"_$T(+0)
"RTN","PSSDIUTL",9,0)
 K ^TMP($J,BASE),DRGLST
"RTN","PSSDIUTL",10,0)
 S ^TMP($J,BASE,"IN","PING")=""
"RTN","PSSDIUTL",11,0)
 D IN^PSSHRQ2(BASE)
"RTN","PSSDIUTL",12,0)
 D:$G(^TMP($J,BASE,"OUT",0))'=0  Q:$G(^TMP($J,BASE,"OUT",0))'=0
"RTN","PSSDIUTL",13,0)
 .S DIR(0)="E",DIR("A",1)="The FDB database is not available at this time!"
"RTN","PSSDIUTL",14,0)
 .S DIR("A",2)="Reason: "_$P($G(^TMP($J,BASE,"OUT",0)),"^",2)
"RTN","PSSDIUTL",15,0)
 .S DIR("A",4)="Please contact the National Service Desk."
"RTN","PSSDIUTL",16,0)
 .S DIR("A",5)=""
"RTN","PSSDIUTL",17,0)
 .S DIR("A")="Press Return to continue...",DIR("?")="Press Return to continue"
"RTN","PSSDIUTL",18,0)
 .W ! D ^DIR K DIRUT,DUOUT,DIR,X,Y  W @IOF
"RTN","PSSDIUTL",19,0)
 K ^TMP($J,BASE),BASE
"RTN","PSSDIUTL",20,0)
 N NUM,MON,TEXTSTR S DRGLST=0,NUM=1,TEXTSTR="",PSSDGCK=1 N ID,ORTYP,NDF,DRUG,ON,PSONULN,PSONULN2 S $P(PSONULN,"-",60)="-",$P(PSONULN2,"=",60)="="
"RTN","PSSDIUTL",21,0)
 K ^TMP($J)
"RTN","PSSDIUTL",22,0)
SELECT ;
"RTN","PSSDIUTL",23,0)
 K:'$G(PSORXED) CLOZPAT
"RTN","PSSDIUTL",24,0)
 K IT,DIC,X,Y,PSODRUG("TRADE NAME"),PSODRUG("NDC"),PSODRUG("DAW"),PSODRUG("BAD") S:$G(POERR)&($P($G(OR0),"^",9)) Y=$P(^PSDRUG($P(OR0,"^",9),0),"^")
"RTN","PSSDIUTL",25,0)
 I $G(PSODRUG("IEN"))]"" S Y=PSODRUG("NAME"),PSONEW("OLD VAL")=PSODRUG("IEN")
"RTN","PSSDIUTL",26,0)
 W !,"Drug "_NUM_": "_$S($G(Y)]"":Y_"// ",1:"") R X:$S($D(DTIME):DTIME,1:300) I '$T S DTOUT=1
"RTN","PSSDIUTL",27,0)
 I X="",$G(Y)]"" S:Y X=Y S:'X X=$G(PSODRUG("IEN")) S:X X="`"_X
"RTN","PSSDIUTL",28,0)
 I X="",DRGLST>1 W !!,"Now Processing Enhanced Order Checks!  Please wait...",! H 1 G FDBCALL
"RTN","PSSDIUTL",29,0)
 I X="",DRGLST<2 W !!,"A minimum of 2 Drugs are required!",! G SELECT
"RTN","PSSDIUTL",30,0)
 I X?1."?" W !!,"Answer with DRUG NUMBER, or GENERIC NAME, or VA PRODUCT NAME, or",!,"NATIONAL DRUG CLASS, or SYNONYM" G SELECT
"RTN","PSSDIUTL",31,0)
 I $G(PSORXED),X["^" S PSORXED("DFLG")=1 W ! G SELECTX
"RTN","PSSDIUTL",32,0)
 I X="^"!(X["^^")!($D(DTOUT)) S PSONEW("DFLG")=1 W ! G SELECTX
"RTN","PSSDIUTL",33,0)
 S DIC=50,DIC(0)="EMQZVT",DIC("T")="",D="B^C^VAPN^VAC"
"RTN","PSSDIUTL",34,0)
 S DIC("S")="I $S('$D(^PSDRUG(+Y,""I"")):1,'^(""I""):1,DT'>^(""I""):1,1:0),$$GCN^PSSDIUTL(+Y),$$PKGFLG^PSSDIUTL($P($G(^PSDRUG(+Y,2)),""^"",3)),$D(^PSDRUG(""ASP"",+$G(^(2)),+Y))"
"RTN","PSSDIUTL",35,0)
 D MIX^DIC1 K DIC,PKF2,D
"RTN","PSSDIUTL",36,0)
 I $D(DTOUT) S PSONEW("DFLG")=1 G SELECTX
"RTN","PSSDIUTL",37,0)
 I $D(DUOUT) K DUOUT G SELECT
"RTN","PSSDIUTL",38,0)
 I Y<0 G SELECT
"RTN","PSSDIUTL",39,0)
 S:$G(PSONEW("OLD VAL"))=+Y&('$G(PSOEDIT)) PSODRG("QFLG")=1
"RTN","PSSDIUTL",40,0)
 K PSOY S PSOY=Y,PSOY(0)=Y(0)
"RTN","PSSDIUTL",41,0)
 I $P(PSOY(0),"^")="OTHER DRUG"!($P(PSOY(0),"^")="OUTSIDE DRUG") D TRADE
"RTN","PSSDIUTL",42,0)
 G:Y<0 SELECT
"RTN","PSSDIUTL",43,0)
 F DRGLSTI=0:0 S DRGLSTI=$O(DRGLST(DRGLSTI)) Q:'DRGLSTI  D
"RTN","PSSDIUTL",44,0)
 .I DRGLSTI=+Y S DRGLSTF=1
"RTN","PSSDIUTL",45,0)
 I $D(DRGLSTF) S NUM=DRGLST+1 K DRGLSTF W !!,"You have selected a duplicate drug please enter a different drug.." K DIR,DRGLSTI,Y S DIR(0)="E",DIR("A")="Press Return to Continue..." W ! D ^DIR K DIR G SELECT
"RTN","PSSDIUTL",46,0)
 S DRGLST=$G(DRGLST)+1,DRGLST(+Y)=Y_"^"_DRGLST,NUM=NUM+1 G SELECT
"RTN","PSSDIUTL",47,0)
SELECTX K DIC,X,Y,DTOUT,DUOUT,PSONEW("OLD VAL"),DRGLST
"RTN","PSSDIUTL",48,0)
 Q
"RTN","PSSDIUTL",49,0)
GCN(PSSIENID) ;Return 0 for not matched, 1 for matched with no GCNSEQNO, 1^1 for matched with a GCNSEQNO
"RTN","PSSDIUTL",50,0)
 N PSSNDFID,PSSGCNPT,PSSGCNID
"RTN","PSSDIUTL",51,0)
 S PSSNDFID=$P($G(^PSDRUG(PSSIENID,"ND")),"^"),PSSGCNPT=$P($G(^PSDRUG(PSSIENID,"ND")),"^",3)
"RTN","PSSDIUTL",52,0)
 I 'PSSNDFID!('PSSGCNPT) Q 0
"RTN","PSSDIUTL",53,0)
 S PSSGCNID=$$PROD0^PSNAPIS(PSSNDFID,PSSGCNPT)
"RTN","PSSDIUTL",54,0)
 I $P(PSSGCNID,"^",7) Q PSSIENID_";"_PSSNDFID_";"_$P(PSSGCNID,"^",7)
"RTN","PSSDIUTL",55,0)
 Q PSSIENID_";"_PSSNDFID
"RTN","PSSDIUTL",56,0)
PKGFLG(PKF2) ;
"RTN","PSSDIUTL",57,0)
 I $S(PKF2["O":1,1:0) Q 1
"RTN","PSSDIUTL",58,0)
 I $S(PKF2["X":1,1:0) Q 1
"RTN","PSSDIUTL",59,0)
 I $S(PKF2["U":1,1:0) Q 1
"RTN","PSSDIUTL",60,0)
 I $S(PKF2["I":1,1:0) Q 1
"RTN","PSSDIUTL",61,0)
 Q 0
"RTN","PSSDIUTL",62,0)
TRADE ;
"RTN","PSSDIUTL",63,0)
 K DIR,DIC,DA,X,Y
"RTN","PSSDIUTL",64,0)
 S DIR(0)="52,6.5" S:$G(PSOTRN)]"" DIR("B")=$G(PSOTRN) D ^DIR K DIR,DIC
"RTN","PSSDIUTL",65,0)
 I X="@" S Y=X K DIRUT
"RTN","PSSDIUTL",66,0)
 I $D(DIRUT) S:$D(DUOUT)!$D(DTOUT)&('$D(PSORX("EDIT"))) PSONEW("DFLG")=1 G TRADEX
"RTN","PSSDIUTL",67,0)
 S PSODRUG("TRADE NAME")=Y
"RTN","PSSDIUTL",68,0)
TRADEX I $G(PSORXED("DFLG")),$D(DIRUT) S PSORXED("DFLG")=1
"RTN","PSSDIUTL",69,0)
 K DIRUT,DTOUT,DUOUT,X,Y,DA,DR,DIE Q
"RTN","PSSDIUTL",70,0)
FDBCALL S LIST="PSOPEPS",^TMP($J,LIST,"IN","DRUGDRUG")=""
"RTN","PSSDIUTL",71,0)
 F I=0:0 S I=$O(DRGLST(I)) Q:'I  D
"RTN","PSSDIUTL",72,0)
 .S DIEN=$P(DRGLST(I),"^"),DNM=$P(DRGLST(I),"^",2),ON="Z;"_$P(DRGLST(I),"^",3)_";PROSPECTIVE;"_$P(DRGLST(I),"^",3)
"RTN","PSSDIUTL",73,0)
 .K ID,P1,P2 S ID=+$$GETVUID^XTID(50.68,,+$P($G(^PSDRUG(DIEN,"ND")),"^",3)_",")
"RTN","PSSDIUTL",74,0)
 .S:ID=0 PSODRUG("IEN")=DIEN
"RTN","PSSDIUTL",75,0)
 .S P1=$P($G(^PSDRUG(DIEN,"ND")),"^"),P2=$P($G(^("ND")),"^",3),X=$$PROD0^PSNAPIS(P1,P2)
"RTN","PSSDIUTL",76,0)
 .S SEQN=$P(X,"^",7)
"RTN","PSSDIUTL",77,0)
 .S ^TMP($J,LIST,"IN","PROSPECTIVE",ON)=SEQN_"^"_ID_"^"_DIEN_"^"_DNM K ID
"RTN","PSSDIUTL",78,0)
 S ^TMP($J,LIST,"IN","THERAPY")=""
"RTN","PSSDIUTL",79,0)
 D IN^PSSHRQ2(LIST)
"RTN","PSSDIUTL",80,0)
 S THSW2=0
"RTN","PSSDIUTL",81,0)
 I +$G(^TMP($J,LIST,"OUT",0))=1 D PROC
"RTN","PSSDIUTL",82,0)
 I '$G(^TMP($J,LIST,"OUT",0)) W !,"No drug interactions or therapeutic duplication occurred." W ! K DIR S DIR(0)="E",DIR("A")="Press Return to Continue..." D ^DIR K DIR G EXIT
"RTN","PSSDIUTL",83,0)
 I +$G(^TMP($J,LIST,"OUT",0))=-1 W !,"Error: "_$P(^TMP($J,"PSOPEPS","OUT",0),"^",2),! G EXIT
"RTN","PSSDIUTL",84,0)
 G:'$D(^TMP($J,"PSOPEPS","OUT","THERAPY")) RMON
"RTN","PSSDIUTL",85,0)
 W !,PSONULN2 K DIR S DIR(0)="E",DIR("A")="Press Return to Continue..." D ^DIR K DIR W @IOF
"RTN","PSSDIUTL",86,0)
RMON I $G(MON) D MON I $G(X)="" W ! D RMON
"RTN","PSSDIUTL",87,0)
EXIT ;
"RTN","PSSDIUTL",88,0)
 K DRGLST,DIC,X,Y,ID,ORTYP,DIEN,DNM,PSONULN,PSSDGCK,MON,^TMP($J),LIST,PSODRUG("IEN") Q
"RTN","PSSDIUTL",89,0)
PROC ;
"RTN","PSSDIUTL",90,0)
 I $D(PSODGCK) N PSONULN,PSONULN2,THSW2 S $P(PSONULN,"-",60)="-",$P(PSONULN2,"=",60)="=",THSW2=0
"RTN","PSSDIUTL",91,0)
 W @IOF K ^UTILITY($J) I $O(^TMP($J,LIST,"OUT","EXCEPTIONS",""))]"" D EXC^PSODDPR5
"RTN","PSSDIUTL",92,0)
 I '$D(^TMP($J,LIST,"OUT","DRUGDRUG"))&'$D(^TMP($J,LIST,"OUT","THERAPY",1)) W !,"No Order Check Warnings Found",! K DIR S DIR(0)="E",DIR("A")="Press Return to Continue..." D ^DIR K DIR W @IOF
"RTN","PSSDIUTL",93,0)
 I $D(PSODGCK),'$D(^TMP($J,LIST,"OUT","DRUGDRUG")),$D(^TMP($J,"PSOPEPS","OUT","THERAPY")) G DGCKTHER
"RTN","PSSDIUTL",94,0)
 D DELDISC^PSSDIUTX I $D(^TMP($J,LIST,"OUT","DRUGDRUG")) W !,"*** DRUG INTERACTION(S) ***",!,PSONULN2,!
"RTN","PSSDIUTL",95,0)
 N DRG,ON,CT,DRGI,PDRG,SEV,SEVH,STX,INT,CLI,PDRG S (ON,DRG,SV)="",CT=0,SEVH="Critical"
"RTN","PSSDIUTL",96,0)
 F  S SV=$O(^TMP($J,LIST,"OUT","DRUGDRUG",SV)) Q:SV=""  F  S DRG=$O(^TMP($J,LIST,"OUT","DRUGDRUG",SV,DRG)) Q:DRG=""  D
"RTN","PSSDIUTL",97,0)
 .F  S ON=$O(^TMP($J,LIST,"OUT","DRUGDRUG",SV,DRG,ON)) Q:ON=""  F  S CT=$O(^TMP($J,LIST,"OUT","DRUGDRUG",SV,DRG,ON,CT)) Q:'CT  D DUP
"RTN","PSSDIUTL",98,0)
 I $D(^TMP($J,LIST,"OUT","DRUGDRUG")) W !,PSONULN2 K DIR S DIR(0)="E",DIR("A")="Press Return to Continue..." D ^DIR K DIR ;(end of inter data)
"RTN","PSSDIUTL",99,0)
DGCKTHER I $D(^TMP($J,"PSOPEPS","OUT","THERAPY")) W @IOF W PSONULN2,!,"*** THERAPEUTIC DUPLICATION(S) ***",! D THER
"RTN","PSSDIUTL",100,0)
 I $D(PSODGCK),'$D(^TMP($J,LIST,"OUT","DRUGDRUG")),$D(^TMP($J,"PSOPEPS","OUT","THERAPY")) K DIR S DIR(0)="E",DIR("A")="Press Return to Continue..." W ! D ^DIR K DIR W @IOF Q
"RTN","PSSDIUTL",101,0)
DGCKMON I $D(PSODGCK),$D(^TMP($J,LIST,"OUT","DRUGDRUG")),$G(MON) D MON I $G(X)="" W ! D DGCKMON
"RTN","PSSDIUTL",102,0)
 Q
"RTN","PSSDIUTL",103,0)
THER ;
"RTN","PSSDIUTL",104,0)
 S (THR,THR1,THR2,TCTR,TCLSTR)="" S TALWNUM=0 N TLN,TLN2 S $P(TLN,"=",60)="",$P(TLN2,"-",60)="" S THSW=0
"RTN","PSSDIUTL",105,0)
 F  S THR=$O(^TMP($J,LIST,"OUT","THERAPY",THR)) Q:THR=""  D
"RTN","PSSDIUTL",106,0)
 .S THR1="",TCLSTR=""
"RTN","PSSDIUTL",107,0)
 .F  S THR1=$O(^TMP($J,LIST,"OUT","THERAPY",THR,THR1)) Q:THR1=""  D
"RTN","PSSDIUTL",108,0)
 ..S TALWNUM=TALWNUM+$G(^TMP($J,LIST,"OUT","THERAPY",THR,THR1,"ALLOW"))
"RTN","PSSDIUTL",109,0)
 ..S TCLSTR=TCLSTR_$G(^TMP($J,LIST,"OUT","THERAPY",THR,THR1,"CLASS"))
"RTN","PSSDIUTL",110,0)
 ..S:+$O(^TMP($J,LIST,"OUT","THERAPY",THR,THR1))'=0 TCLSTR=TCLSTR_", "
"RTN","PSSDIUTL",111,0)
 .I TALWNUM=0 I ($Y+8)>IOSL,$E(IOST)="C" D
"RTN","PSSDIUTL",112,0)
 ..K DIR S DIR(0)="E",DIR("A")="Press Return to Continue..." D ^DIR K DIR W @IOF
"RTN","PSSDIUTL",113,0)
 .W:THSW !,TLN2 S THSW=1
"RTN","PSSDIUTL",114,0)
 .I TALWNUM=0 D
"RTN","PSSDIUTL",115,0)
 ..F  S TCTR=$O(^TMP($J,LIST,"OUT","THERAPY",THR,"DRUGS",TCTR)) Q:TCTR=""  D
"RTN","PSSDIUTL",116,0)
 ...W !,?12,"Drug Name: ",$$THOSTAT^PSSCKOS($P($G(^TMP($J,LIST,"OUT","THERAPY",THR,"DRUGS",TCTR)),U,3),THR,TCTR)
"RTN","PSSDIUTL",117,0)
 ..W !,!,"Duplication Allowance: 0",!,?11,"Drug Class: "
"RTN","PSSDIUTL",118,0)
 ..I $L(TCLSTR)>50 D
"RTN","PSSDIUTL",119,0)
 ...K BSIG N BBSIG,BVAR,BVAR1,III,ZNT,NNN,BLIM
"RTN","PSSDIUTL",120,0)
 ...S BBSIG=TCLSTR,(BVAR,BVAR1)="",III=1
"RTN","PSSDIUTL",121,0)
 ...S ZNT=0 F NNN=1:1:$L(BBSIG) I $E(BBSIG,NNN)=" "!($L(BBSIG)=NNN) S ZNT=ZNT+1 D  I $L(BVAR)>50 S BSIG(III)=BLIM_" ",III=III+1,BVAR=BVAR1
"RTN","PSSDIUTL",122,0)
 ....S BVAR1=$P(BBSIG," ",(ZNT)),BLIM=BVAR,BVAR=$S(BVAR="":BVAR1,1:BVAR_" "_BVAR1)
"RTN","PSSDIUTL",123,0)
 ...I $G(BVAR)'="" S BSIG(III)=BVAR
"RTN","PSSDIUTL",124,0)
 ...I $G(BSIG(1))=""!($G(BSIG(1))=" ") S BSIG(1)=$G(BSIG(2)) K BSIG(2)
"RTN","PSSDIUTL",125,0)
 ..I $L(TCLSTR)>50 D
"RTN","PSSDIUTL",126,0)
 ...S I=""
"RTN","PSSDIUTL",127,0)
 ...F  S I=$O(BSIG(I)) Q:'I  D
"RTN","PSSDIUTL",128,0)
 ....W:I=1 BSIG(I),! W:I>1 ?23,BSIG(I)
"RTN","PSSDIUTL",129,0)
 ..E  D
"RTN","PSSDIUTL",130,0)
 ...W TCLSTR
"RTN","PSSDIUTL",131,0)
 .I TALWNUM>0 D
"RTN","PSSDIUTL",132,0)
 ..S THR2="",TCLSTR=""
"RTN","PSSDIUTL",133,0)
 ..F  S THR2=$O(^TMP($J,LIST,"OUT","THERAPY",THR,THR2)) Q:+THR2=0  D
"RTN","PSSDIUTL",134,0)
 ...F  S TCTR=$O(^TMP($J,LIST,"OUT","THERAPY",THR,"DRUGS",TCTR)) Q:TCTR=""  D
"RTN","PSSDIUTL",135,0)
 ....W !,?12,"Drug Name: ",$$THOSTAT^PSSCKOS($P($G(^TMP($J,LIST,"OUT","THERAPY",THR,"DRUGS",TCTR)),U,3),THR,TCTR)
"RTN","PSSDIUTL",136,0)
 ...W !,!,"Duplication Allowance: ",$G(^TMP($J,LIST,"OUT","THERAPY",THR,THR2,"ALLOW"))
"RTN","PSSDIUTL",137,0)
 ...K TCLSTR S TCLSTR=^TMP($J,LIST,"OUT","THERAPY",THR,THR2,"CLASS")
"RTN","PSSDIUTL",138,0)
 ...W !,?11,"Drug Class: "
"RTN","PSSDIUTL",139,0)
 ...I $L(TCLSTR)>50 D
"RTN","PSSDIUTL",140,0)
 ....K BSIG N BBSIG,BVAR,BVAR1,III,ZNT,NNN,BLIM
"RTN","PSSDIUTL",141,0)
 ....S BBSIG=TCLSTR,(BVAR,BVAR1)="",III=1
"RTN","PSSDIUTL",142,0)
 ....S ZNT=0 F NNN=1:1:$L(BBSIG) I $E(BBSIG,NNN)=" "!($L(BBSIG)=NNN) S ZNT=ZNT+1 D  I $L(BVAR)>50 S BSIG(III)=BLIM_" ",III=III+1,BVAR=BVAR1
"RTN","PSSDIUTL",143,0)
 .....S BVAR1=$P(BBSIG," ",(ZNT)),BLIM=BVAR,BVAR=$S(BVAR="":BVAR1,1:BVAR_" "_BVAR1)
"RTN","PSSDIUTL",144,0)
 ....I $G(BVAR)'="" S BSIG(III)=BVAR
"RTN","PSSDIUTL",145,0)
 ....I $G(BSIG(1))=""!($G(BSIG(1))=" ") S BSIG(1)=$G(BSIG(2)) K BSIG(2)
"RTN","PSSDIUTL",146,0)
 ...I $L(TCLSTR)>50 D
"RTN","PSSDIUTL",147,0)
 ....S I=""
"RTN","PSSDIUTL",148,0)
 ....F  S I=$O(BSIG(I)) Q:'I  D
"RTN","PSSDIUTL",149,0)
 .....I ($Y+6)>IOSL,$E(IOST)="C" D
"RTN","PSSDIUTL",150,0)
 ......K DIR S DIR(0)="E",DIR("A")="Press Return to Continue..." D ^DIR K DIR W @IOF
"RTN","PSSDIUTL",151,0)
 .....W:I=1 BSIG(I),! W:I>1 ?23,BSIG(I),!
"RTN","PSSDIUTL",152,0)
 ...E  D
"RTN","PSSDIUTL",153,0)
 ....W TCLSTR,!
"RTN","PSSDIUTL",154,0)
 ...I ($Y+6)>IOSL,$E(IOST)="C" D
"RTN","PSSDIUTL",155,0)
 ....K DIR S DIR(0)="E",DIR("A")="Press Return to Continue..." D ^DIR K DIR
"RTN","PSSDIUTL",156,0)
 Q
"RTN","PSSDIUTL",157,0)
DUP ;
"RTN","PSSDIUTL",158,0)
 N PDRGN,DRGN S PDRGN="",DRGN=""
"RTN","PSSDIUTL",159,0)
 I ($Y+8)>IOSL,$E(IOST)="C" D
"RTN","PSSDIUTL",160,0)
 .K DIR S DIR(0)="E",DIR("A")="Press Return to Continue..." D ^DIR K DIR W @IOF
"RTN","PSSDIUTL",161,0)
 I $O(^TMP($J,LIST,"OUT","DRUGDRUG",SV,DRG,ON,CT,"PMON",0)) S MON=1
"RTN","PSSDIUTL",162,0)
 S PDRG=$P(^TMP($J,LIST,"OUT","DRUGDRUG",SV,DRG,ON,CT),"^",4)
"RTN","PSSDIUTL",163,0)
 S CLI=$G(^TMP($J,LIST,"OUT","DRUGDRUG",SV,DRG,ON,CT,"CLIN"))
"RTN","PSSDIUTL",164,0)
 S SEV=$G(^TMP($J,LIST,"OUT","DRUGDRUG",SV,DRG,ON,CT,"SEV"))
"RTN","PSSDIUTL",165,0)
 S:SEVH'=SEV PSONULN="",$P(PSONULN,"=",60)="="
"RTN","PSSDIUTL",166,0)
 I ($Y+6)>IOSL,$E(IOST)="C" D
"RTN","PSSDIUTL",167,0)
 .K DIR S DIR(0)="E",DIR("A")="Press Return to Continue..." D ^DIR K DIR
"RTN","PSSDIUTL",168,0)
 W:THSW2 PSONULN,! S THSW2=1
"RTN","PSSDIUTL",169,0)
 SET PDRGN=$$POSTAT^PSSCKOS(DRG,PDRG,SV,ON,CT),DRGN=$$OSTAT^PSSCKOS(DRG,ON)
"RTN","PSSDIUTL",170,0)
 W "***"_SEV_"*** Drug Interaction with ",!,DRGN_" and" W:SEV="Critical" !,PDRGN,!! W:SEV="Significant" !,PDRGN,!!
"RTN","PSSDIUTL",171,0)
 S:SEVH'=SEV PSONULN="",$P(PSONULN,"-",60)="-"
"RTN","PSSDIUTL",172,0)
 S SEVH=SEV
"RTN","PSSDIUTL",173,0)
 I $L(CLI)>70 D
"RTN","PSSDIUTL",174,0)
 .K BSIG N BBSIG,BVAR,BVAR1,III,ZNT,NNN,BLIM
"RTN","PSSDIUTL",175,0)
 .S BBSIG=CLI,(BVAR,BVAR1)="",III=1
"RTN","PSSDIUTL",176,0)
 .S ZNT=0 F NNN=1:1:$L(BBSIG) I $E(BBSIG,NNN)=" "!($L(BBSIG)=NNN) S ZNT=ZNT+1 D  I $L(BVAR)>70 S BSIG(III)=BLIM_" ",III=III+1,BVAR=BVAR1
"RTN","PSSDIUTL",177,0)
 ..S BVAR1=$P(BBSIG," ",(ZNT)),BLIM=BVAR,BVAR=$S(BVAR="":BVAR1,1:BVAR_" "_BVAR1)
"RTN","PSSDIUTL",178,0)
 .I $G(BVAR)'="" S BSIG(III)=BVAR
"RTN","PSSDIUTL",179,0)
 .I $G(BSIG(1))=""!($G(BSIG(1))=" ") S BSIG(1)=$G(BSIG(2)) K BSIG(2)
"RTN","PSSDIUTL",180,0)
 I $L(CLI)>70 D
"RTN","PSSDIUTL",181,0)
 .S I=""
"RTN","PSSDIUTL",182,0)
 .F  S I=$O(BSIG(I)) Q:'I  D
"RTN","PSSDIUTL",183,0)
 ..W BSIG(I),!
"RTN","PSSDIUTL",184,0)
 E  D
"RTN","PSSDIUTL",185,0)
 .W CLI,!
"RTN","PSSDIUTL",186,0)
 K BSIG,BBSIG,BVAR,BVAR1,III,ZNT,NNN,BLIM
"RTN","PSSDIUTL",187,0)
 Q
"RTN","PSSDIUTL",188,0)
MON ;
"RTN","PSSDIUTL",189,0)
 W ! K DIR S DIR("A")="Display Professional Interaction Monograph",DIR("B")="N",DIR(0)="Y",DIR("?")="Enter Y if you would like to see the Monograph." D ^DIR W !
"RTN","PSSDIUTL",190,0)
 I X="^"!(X["^^")!($D(DTOUT)) Q
"RTN","PSSDIUTL",191,0)
 K SEL,DIR,DTOUT,DUOUT,DIRUT Q:Y=0
"RTN","PSSDIUTL",192,0)
 S MONT=1,SEL=1 K Y D BLD Q:$G(SEL)=0
"RTN","PSSDIUTL",193,0)
 K IOP,%ZIS,POP S %ZIS="QM" W ! D ^%ZIS
"RTN","PSSDIUTL",194,0)
 I POP K SEL,DIR,DTOUT,DUOUT,DIRUT,MONT W !,"NOTHING PRINTED" G MON
"RTN","PSSDIUTL",195,0)
 I $D(IO("Q")) D  Q
"RTN","PSSDIUTL",196,0)
 .S ZTRTN="OUT^PSOIDPRE",ZTDESC="Monograph Report of Drug Interactions",ZTSAVE("MONT")=""
"RTN","PSSDIUTL",197,0)
 .S ZTSAVE("PSONULN")="",ZTSAVE("LIST")="",ZTSAVE("^TMP($J,LIST,""OUT"",""DRUGDRUG"",")="",ZTSAVE("^TMP($J,""PSOMONP"",")=""
"RTN","PSSDIUTL",198,0)
 .D ^%ZTLOAD,^%ZISC W !,"Monograph Queued to Print!",! S:$D(ZTQUEUED) ZTREQ="Q"
"RTN","PSSDIUTL",199,0)
 D OUT,^%ZISC
"RTN","PSSDIUTL",200,0)
 W ! G:Y'=0 MON
"RTN","PSSDIUTL",201,0)
 Q
"RTN","PSSDIUTL",202,0)
OUT ;print monograph
"RTN","PSSDIUTL",203,0)
 N DRG,ON,CT,DRGI,PDRG,SEV,STX,INT,CLI,PDRG,RNG,QX
"RTN","PSSDIUTL",204,0)
 D:MONT=1 PROF D:MONT=2 CON D:MONT=3 PROF
"RTN","PSSDIUTL",205,0)
 Q
"RTN","PSSDIUTL",206,0)
BLD ;
"RTN","PSSDIUTL",207,0)
 K SEL,X,Y,DRG,ON,CT,RNG,^TMP($J,"PSOMON"),^TMP($J,"PSOMONP") S (DRG,ON,SV)="",CT=0
"RTN","PSSDIUTL",208,0)
 F  S SV=$O(^TMP($J,LIST,"OUT","DRUGDRUG",SV)) Q:SV=""  F  S DRG=$O(^TMP($J,LIST,"OUT","DRUGDRUG",SV,DRG)) Q:DRG=""  F  S ON=$O(^TMP($J,LIST,"OUT","DRUGDRUG",SV,DRG,ON)) Q:ON=""  D
"RTN","PSSDIUTL",209,0)
 .F  S CT=$O(^TMP($J,LIST,"OUT","DRUGDRUG",SV,DRG,ON,CT)) Q:'CT  I $O(^TMP($J,LIST,"OUT","DRUGDRUG",SV,DRG,ON,CT,"PMON",0)) D
"RTN","PSSDIUTL",210,0)
 ..S RNG=$G(RNG)+1
"RTN","PSSDIUTL",211,0)
 ..S ^TMP($J,"PSOMON",RNG,DRG)=DRG_"^"_ON_"^"_CT_"^"_$P(^TMP($J,LIST,"OUT","DRUGDRUG",SV,DRG,ON,CT),"^",4)_"^"_$G(^TMP($J,LIST,"OUT","DRUGDRUG",SV,DRG,ON,CT,"SEV"))
"RTN","PSSDIUTL",212,0)
 I '$D(^TMP($J,"PSOMON",2)) S Y=1 G ONEMONO
"RTN","PSSDIUTL",213,0)
 K DIR S IND=0,DRG=""
"RTN","PSSDIUTL",214,0)
 ;F  S IND=$O(^TMP($J,"PSOMON",IND)) Q:'IND  F  S DRG=$O(^TMP($J,"PSOMON",IND,DRG)) Q:DRG=""  S DIR("A",IND)=IND_". "_DRG_" and "_$P(^TMP($J,"PSOMON",IND,DRG),"^",4) S DIR("A",IND+1)=""
"RTN","PSSDIUTL",215,0)
 F  S IND=$O(^TMP($J,"PSOMON",IND)) Q:'IND  F  S DRG=$O(^TMP($J,"PSOMON",IND,DRG)) Q:DRG=""  D
"RTN","PSSDIUTL",216,0)
 .I ($Y+6)>IOSL,$E(IOST)="C" D
"RTN","PSSDIUTL",217,0)
 ..W ! K DIR S DIR(0)="E",DIR("A")="Press Return to Continue..." D ^DIR K DIR W @IOF
"RTN","PSSDIUTL",218,0)
 .W !,IND_". "_DRG_" and "_$P(^TMP($J,"PSOMON",IND,DRG),"^",4)
"RTN","PSSDIUTL",219,0)
 W ! S DIR("A")="Select Monograph for printing by number",DIR(0)="LO^1:"_RNG D ^DIR K DIR
"RTN","PSSDIUTL",220,0)
 I $D(DUOUT)!($D(DTOUT))!(X="^")!(X="") S SEL=0 Q
"RTN","PSSDIUTL",221,0)
ONEMONO F G=1:1:$L(Y) Q:$P(Y,",",G)=""  S DRG=$O(^TMP($J,"PSOMON",$P(Y,",",G),"")),^TMP($J,"PSOMONP",$P(Y,",",G),0)=^TMP($J,"PSOMON",$P(Y,",",G),DRG)
"RTN","PSSDIUTL",222,0)
 K ^TMP($J,"PSOMON")
"RTN","PSSDIUTL",223,0)
 Q
"RTN","PSSDIUTL",224,0)
FORMAT ; WATCH OUT WITH CHANGES HERE!!!
"RTN","PSSDIUTL",225,0)
 K BSIG,XX N BBSIG,BVAR,BVAR1,III,ZNT,NNN,BLIM
"RTN","PSSDIUTL",226,0)
 I $L(TEXTSTR)>70 D  F XX=0:0 S XX=$O(BSIG(XX)) Q:'XX  W ?5,BSIG(XX),!
"RTN","PSSDIUTL",227,0)
 .S BBSIG=TEXTSTR,(BVAR,BVAR1)="",III=1
"RTN","PSSDIUTL",228,0)
 .S ZNT=0 F NNN=1:1:$L(BBSIG) I $E(BBSIG,NNN)=" "!($L(BBSIG)=NNN) S ZNT=ZNT+1 D  I $L(BVAR)>70 S BSIG(III)=BLIM_" ",III=III+1,BVAR=BVAR1
"RTN","PSSDIUTL",229,0)
 ..S BVAR1=$P(BBSIG," ",(ZNT)),BLIM=BVAR,BVAR=$S(BVAR="":BVAR1,1:BVAR_" "_BVAR1)
"RTN","PSSDIUTL",230,0)
 .I $G(BVAR)'="" S BSIG(III)=BVAR
"RTN","PSSDIUTL",231,0)
 .I $G(BSIG(1))=""!($G(BSIG(1))=" ") S BSIG(1)=$G(BSIG(2)) K BSIG(2)
"RTN","PSSDIUTL",232,0)
 E  W ?5,TEXTSTR,!
"RTN","PSSDIUTL",233,0)
 K BSIG,BBSIG,BVAR,BVAR1,III,ZNT,NNN,BLIM S TEXTSTR=""
"RTN","PSSDIUTL",234,0)
 Q
"RTN","PSSDIUTL",235,0)
PROF ;
"RTN","PSSDIUTL",236,0)
 F I=0:0 S I=$O(^TMP($J,"PSOMONP",I)) Q:'I  S DRG=$P(^TMP($J,"PSOMONP",I,0),"^"),ON=$P(^(0),"^",2),CT=$P(^(0),"^",3),PDRG=$P(^(0),"^",4),SEV=$E($P(^(0),"^",5),1,1) D  Q:$D(DUOUT)!($D(DTOUT))
"RTN","PSSDIUTL",237,0)
 .U IO W @IOF,!,PSONULN,!,"Professional Monograph",!,"Drug Interaction with "_DRG_" and "_PDRG,!
"RTN","PSSDIUTL",238,0)
 .F QX=0:0 S QX=$O(^TMP($J,LIST,"OUT","DRUGDRUG",SEV,DRG,ON,CT,"PMON",QX)) Q:'QX  D  Q:($D(DUOUT)!($D(DTOUT)))
"RTN","PSSDIUTL",239,0)
 ..I $Y+6>IOSL,$E(IOST)="C" D
"RTN","PSSDIUTL",240,0)
 ...K DIR S DIR(0)="E",DIR("A")="Press Return to Continue or ""^"" to Exit" D ^DIR K DIR
"RTN","PSSDIUTL",241,0)
 ...W @IOF,"Professional Monograph",!?3,"Drug Interaction with "_DRG_" and "_PDRG,!
"RTN","PSSDIUTL",242,0)
 ..S TEXTSTR=^TMP($J,LIST,"OUT","DRUGDRUG",SEV,DRG,ON,CT,"PMON",QX,0) D FORMAT
"RTN","PSSDIUTL",243,0)
 ..I ($Y+6)>IOSL,$E(IOST)="C" W !
"RTN","PSSDIUTL",244,0)
 K DTOUT,DUOUT
"RTN","PSSDIUTL",245,0)
 D:MONT=3
"RTN","PSSDIUTL",246,0)
 .U IO W @IOF,!,PSONULN,!,"Consumer Monograph",!?3,"Drug Interaction with "_DRG_" and "_PDRG,!
"RTN","PSSDIUTL",247,0)
 .F QX=0:0 S QX=$O(^TMP($J,LIST,"OUT","DRUGDRUG",SEV,DRG,ON,CT,"CMON",QX)) Q:'QX  D  Q:($D(DUOUT)!($D(DTOUT)))
"RTN","PSSDIUTL",248,0)
 ..I $Y+6>IOSL,$E(IOST)="C" D
"RTN","PSSDIUTL",249,0)
 ...K DIR S DIR(0)="E",DIR("A")="Press Return to Continue..." D ^DIR K DIR
"RTN","PSSDIUTL",250,0)
 ...W @IOF,!,"Consumer Monograph",!?3,"Drug Interaction with "_DRG_" and "_PDRG,!
"RTN","PSSDIUTL",251,0)
 ..W !?5,^TMP($J,LIST,"OUT","DRUGDRUG",SEV,DRG,ON,CT,"CMON",QX,0)
"RTN","PSSDIUTL",252,0)
 W !,PSONULN,!
"RTN","PSSDIUTL",253,0)
 K DTOUT,DUOUT I $E(IOST)="C" K DIR S DIR(0)="E" D ^DIR K DIR,DTOUT,DUOUT
"RTN","PSSDIUTL",254,0)
 Q
"RTN","PSSDIUTL",255,0)
CON F I=0:0 S I=$O(^TMP($J,"PSOMONP",I)) Q:'I  S DRG=$P(^TMP($J,"PSOMONP",I,0),"^"),ON=$P(^(0),"^",2),CT=$P(^(0),"^",3),PDRG=$P(^(0),"^",4),SEV=$P(^(0),"^",5) D  Q:$D(DUOUT)!($D(DTOUT))
"RTN","PSSDIUTL",256,0)
 .U IO W @IOF,!,"Consumer Monograph",!?3,PSONULN,!,"Drug Interaction with "_DRG_" and "_PDRG,!
"RTN","PSSDIUTL",257,0)
 .F QX=0:0 S QX=$O(^TMP($J,LIST,"OUT","DRUGDRUG",SEV,DRG,ON,CT,"CMON",QX)) Q:'QX  D  Q:($D(DUOUT)!($D(DTOUT)))
"RTN","PSSDIUTL",258,0)
 ..I $Y+6>IOSL,$E(IOST)="C" D
"RTN","PSSDIUTL",259,0)
 ...K DIR S DIR(0)="E",DIR("A")="Press Return to Continue or ""^"" to Exit" D ^DIR K DIR
"RTN","PSSDIUTL",260,0)
 ...W @IOF,!,"Consumer Monograph",!?3,"Drug Interaction with "_DRG_" and "_PDRG,!
"RTN","PSSDIUTL",261,0)
 ..W !?5,^TMP($J,LIST,"OUT","DRUGDRUG",DRG,ON,CT,"CMON",QX,0)
"RTN","PSSDIUTL",262,0)
 W !,PSONULN,!
"RTN","PSSDIUTL",263,0)
 K DTOUT,DUOUT I $E(IOST)="C" K DIR S DIR(0)="E",DIR("A")="Press Return to Continue..." D ^DIR K DIR,DTOUT,DUOUT
"RTN","PSSDIUTL",264,0)
 Q
"RTN","PSSDIUTX")
0^3^B3013700
"RTN","PSSDIUTX",1,0)
PSSDIUTX ;HP/MJE - Drug Interaction Utility ;05/14/11 5:00pm
"RTN","PSSDIUTX",2,0)
 ;;1.0;PHARMACY DATA MANAGEMENT;**175**;9/30/97;Build 9
"RTN","PSSDIUTX",3,0)
 ;This routine can be used for PSS namespace additional code
"RTN","PSSDIUTX",4,0)
 ;
"RTN","PSSDIUTX",5,0)
DELDISC ;This will delete discontinued drugs from drug interaction order checks result set but not dup therapy results
"RTN","PSSDIUTX",6,0)
 I $D(PSOSD("DISCONTINUED")) D
"RTN","PSSDIUTX",7,0)
 .N CKSV,CKDRG,CKON,CKCT,CKVAL,CKNM,DCRCMN S (CKSV,CKDRG,CKON,CKCT,CKVAL,CKNM,DCRCMN)=""
"RTN","PSSDIUTX",8,0)
 .F  S CKNM=$O(PSOSD("DISCONTINUED",CKNM)) Q:CKNM=""  D
"RTN","PSSDIUTX",9,0)
 ..S DCRCNM=$P(PSOSD("DISCONTINUED",CKNM),"^") D
"RTN","PSSDIUTX",10,0)
 ...F  S CKSV=$O(^TMP($J,LIST,"OUT","DRUGDRUG",CKSV)) Q:CKSV=""  F  S CKDRG=$O(^TMP($J,LIST,"OUT","DRUGDRUG",CKSV,CKDRG)) Q:CKDRG=""  D
"RTN","PSSDIUTX",11,0)
 ....F  S CKON=$O(^TMP($J,LIST,"OUT","DRUGDRUG",CKSV,CKDRG,CKON)) Q:CKON=""  F  S CKCT=$O(^TMP($J,LIST,"OUT","DRUGDRUG",CKSV,CKDRG,CKON,CKCT)) Q:CKCT=""  D
"RTN","PSSDIUTX",12,0)
 .....S CKVAL=$P($P(^TMP($J,LIST,"OUT","DRUGDRUG",CKSV,CKDRG,CKON,CKCT),"^"),";",2)
"RTN","PSSDIUTX",13,0)
 .....I DCRCNM=CKVAL K ^TMP($J,LIST,"OUT","DRUGDRUG",CKSV,CKDRG,CKON,CKCT)
"RTN","PSSDIUTX",14,0)
 .....I DCRCNM=$P(CKON,";",2) K ^TMP($J,LIST,"OUT","DRUGDRUG",CKSV,CKDRG,CKON,CKCT)
"RTN","PSSDIUTX",15,0)
 K CKSV,CKDRG,CKON,CKCT,CKVAL,CKNM,DCRCMN
"RTN","PSSDIUTX",16,0)
 Q
"RTN","PSSFDBDI")
0^5^B130530909
"RTN","PSSFDBDI",1,0)
PSSFDBDI ;BIR/LE - Sends XML Request to PEPS via HWSC for Dose Information ;01/23/12
"RTN","PSSFDBDI",2,0)
 ;;1.0;PHARMACY DATA MANAGEMENT;**160,175**;9/30/97;Build 9
"RTN","PSSFDBDI",3,0)
 ;
"RTN","PSSFDBDI",4,0)
 ;Reference to PSNDF(50.68 supported by DBIA 3735
"RTN","PSSFDBDI",5,0)
 ;
"RTN","PSSFDBDI",6,0)
 ; this routine is responsible for performing dosing information queries against a drug database to retrieve dose information.
"RTN","PSSFDBDI",7,0)
 ; the architecture parses the XML stream into tokens and is stored in a ^TMP($J,"PSSFDBDI")
"RTN","PSSFDBDI",8,0)
 ;
"RTN","PSSFDBDI",9,0)
 ;NEW file structure:
"RTN","PSSFDBDI",10,0)
 ;^TMP($J,"PSSFDBDI",0)=file description^^total # sequences^total # sequences
"RTN","PSSFDBDI",11,0)
 ;^TMP($J,"PSSFDBDI",PSSGCN,0)=GCNSEQNO evaluated^passed in GCNSEQNO^dispensableDrugName^dispensableDrugDescription^fdbdx
"RTN","PSSFDBDI",12,0)
 ;^TMP($J,"PSSFDBDI",PSSGCN,doseRanges",SEQ,1,0)=custom^category^dosetypeid^dosetypedescription^doserouteid^doseroutedescription^agelowindays^agehigh indays
"RTN","PSSFDBDI",13,0)
 ;^TMP($J,"PSSFDBDI",PSSGCN,doseRanges",SEQ,2,0)=hitIndicationID^hitindication description^indicationid^indicationdescription^^indicationidtype^resulttype^warningcode
"RTN","PSSFDBDI",14,0)
 ;^TMP($J,"PSSFDBDI",PSSGCN,doseRanges",SEQ,3,0)=bsarequired^weightrequired^hepaticimpairement^renal impairement^loweliminationhalflife^higheliminationhalflife^halflifeunit^crclthreshold^crclthresholdunit
"RTN","PSSFDBDI",15,0)
 ;^TMP($J,"PSSFDBDI",PSSGCN,doseRanges",SEQ,4,0)=durationlow^durationhigh^maxduration^frequencylow^frequencyhigh
"RTN","PSSFDBDI",16,0)
 ;^TMP($J,"PSSFDBDI",PSSGCN,doseRanges",SEQ,5,0)=doselow^doselowunit^dosehigh^dosehighunit^doseformlow^doseformlowunit^doseformhigh^doseformhighunit
"RTN","PSSFDBDI",17,0)
 ;^TMP($J,"PSSFDBDI",PSSGCN,doseRanges",SEQ,6,0)=maxsingledose^maxsingledoseunit^maxsingledoseform^maxsingledoseformunit^maxdailydose^maxdailydoseunit^maxdailydoseform^maxdailydoseformunit
"RTN","PSSFDBDI",18,0)
 ;^TMP($J,"PSSFDBDI",PSSGCN,doseRanges",SEQ,7,0)maxlidfetimedose^maxlifetimedoseunit^maxlifetimedoseform^maxlifetimedoseformunit
"RTN","PSSFDBDI",19,0)
 ;^TMP($J,"PSSFDBDI",PSSGCN,"minMax",ageLowInDays,ageHighInDays,1)=doseLow^doseLowUnit^doseHigh^doseHighUnit^doseFormLow^doseFormLowUnit^doseFormHigh^doseFormHighUnit
"RTN","PSSFDBDI",20,0)
 ;^TMP($J,"PSSFDBDI",PSSGCN,"minMax",ageLowInDays,ageHighInDays,2)=maxDailyDose^maxDailyDoseUnit^maxDailyDoseForm^maxDailyDoseFormUnit^resultType^warningCode^bsaRequired^weightRequired
"RTN","PSSFDBDI",21,0)
 ;
"RTN","PSSFDBDI",22,0)
 ; Cross References "doseRanges" nodes:
"RTN","PSSFDBDI",23,0)
 ;^TMP($J,"PSSFDBDI","A",doseTypeId,ageLowInDays,ageHighInDays,SEQ)=custom
"RTN","PSSFDBDI",24,0)
 ;^TMP($J,"PSSFDBDI","B",gcnSeqNo)=dispensableDrugName
"RTN","PSSFDBDI",25,0)
 ;^TMP($J,"PSSFDBDI","C",ageLowInDays,ageHighInDays,doseTypeId,SEQ)=custom
"RTN","PSSFDBDI",26,0)
 ;
"RTN","PSSFDBDI",27,0)
 Q
"RTN","PSSFDBDI",28,0)
EN(PSSGCN,PSSOUT) ;get dosing information based on GCNSEQNO
"RTN","PSSFDBDI",29,0)
 ; input: PSSGCN  - GCCNSEQNO from file 50.68
"RTN","PSSFDBDI",30,0)
 ;
"RTN","PSSFDBDI",31,0)
 ; output: builds TMP file for dosing information
"RTN","PSSFDBDI",32,0)
 ;             e.g.  ^TMP($J,"PSSFDBDI"
"RTN","PSSFDBDI",33,0)
 ;                     PSSOUT(0) = 1 for successful
"RTN","PSSFDBDI",34,0)
 ;                                           -1^error message  (when an error occurs:  example  "-1^ERROR #6059: Unable to open TCP/IP socket to server nn.n.nnn.nn:nnnn"
"RTN","PSSFDBDI",35,0)
 ;
"RTN","PSSFDBDI",36,0)
 K ^TMP($J,"PSSFDBDI")
"RTN","PSSFDBDI",37,0)
 I PSSGCN=""!(PSSGCN=0) S PSSOUT="",PSSOUT(0)="-1^GCN sequence number is not defined." Q
"RTN","PSSFDBDI",38,0)
 N PSSXML,PSSFDBDX,GCNSEQ,BASE,PSSRETR2,PSSFDBDN
"RTN","PSSFDBDI",39,0)
 S PSSFDBDN=$$CHKSTAT^PSSDSFDB() I PSSFDBDN S PSSOUT(0)=PSSFDBDN Q
"RTN","PSSFDBDI",40,0)
 S GCNSEQ=PSSGCN,BASE=$T(+0)_" DOSEINFO"
"RTN","PSSFDBDI",41,0)
 S PSSXML=$$BLDXML(GCNSEQ)   ; build the xml request
"RTN","PSSFDBDI",42,0)
RETRY ;Retry line tag
"RTN","PSSFDBDI",43,0)
 D POST(PSSXML,PSSGCN,.PSSOUT)    ; post the request and process the results
"RTN","PSSFDBDI",44,0)
 I $P($G(PSSOUT(0)),"^")=-1,'$G(PSSRETR2) K PSSOUT S PSSRETR2=1 H 3 G RETRY
"RTN","PSSFDBDI",45,0)
 Q
"RTN","PSSFDBDI",46,0)
 ;
"RTN","PSSFDBDI",47,0)
BLDXML(GCNSEQ) ; build and return the XML request with drug information for given GCN sequence number
"RTN","PSSFDBDI",48,0)
 ;  input: drug IEN from drug file (#50)
"RTN","PSSFDBDI",49,0)
 ; output: returns the XML request for given GCN sequence number
"RTN","PSSFDBDI",50,0)
 ;             Example:  where 22211 is the GCN Sequence number passed by reference at line tag EN above.
"RTN","PSSFDBDI",51,0)
 ;                                PSSXML="<?xml version=""1.0"" encoding=""utf-8"" ?><dosingInfoRequest  xmlns:xsi=""http://www.w3.org/2001/XMLSchema-instance"" 
"RTN","PSSFDBDI",52,0)
 ;                                         xsi:schemaLocation=""gov/va/med/pharmacy/peps/external/common/preencapsulation/vo/dosing/info/request dosingInfoSchemaInput.xsd"" 
"RTN","PSSFDBDI",53,0)
 ;                                         xmlns=""gov/va/med/pharmacy/peps/external/common/preencapsulation/vo/dosing/info/request"">
"RTN","PSSFDBDI",54,0)
 ;                                         <dosingInfo gcnSeqNo=""22211"" fdbdx=""999"" />
"RTN","PSSFDBDI",55,0)
 ;                                         </dosingInfoRequest>"
"RTN","PSSFDBDI",56,0)
 ;
"RTN","PSSFDBDI",57,0)
 N DRUGTAG,ENDTAG,FDBDX,SPACE,TAG,SUBXML,SCHEMA,XMLNS,SPACE,DOSETAG
"RTN","PSSFDBDI",58,0)
 S PSSXML="",SPACE=$C(32)
"RTN","PSSFDBDI",59,0)
 ;
"RTN","PSSFDBDI",60,0)
 ;xml header info - <?xml version="1.0" encoding="utf-8" ?>
"RTN","PSSFDBDI",61,0)
 S PSSXML=PSSXML_$$XMLHDR^MXMLUTL
"RTN","PSSFDBDI",62,0)
 ;
"RTN","PSSFDBDI",63,0)
 S SPACE=$C(32)
"RTN","PSSFDBDI",64,0)
 S SCHEMA="gov/va/med/pharmacy/peps/external/common/preencapsulation/vo/dosing/info/request dosingInfoSchemaInput.xsd"
"RTN","PSSFDBDI",65,0)
 S XMLNS="gov/va/med/pharmacy/peps/external/common/preencapsulation/vo/dosing/info/request"
"RTN","PSSFDBDI",66,0)
 S TAG="dosingInfoRequest"
"RTN","PSSFDBDI",67,0)
 S SUBXML="<"_TAG_SPACE
"RTN","PSSFDBDI",68,0)
 S SUBXML=SUBXML_$$ATRIBUTE^PSSHRCOM(SPACE_"xmlns:xsi","http://www.w3.org/2001/XMLSchema-instance")
"RTN","PSSFDBDI",69,0)
 S SUBXML=SUBXML_$$ATRIBUTE^PSSHRCOM(SPACE_"xsi:schemaLocation",SCHEMA)
"RTN","PSSFDBDI",70,0)
 S SUBXML=SUBXML_$$ATRIBUTE^PSSHRCOM(SPACE_"xmlns",XMLNS)
"RTN","PSSFDBDI",71,0)
 S PSSXML=PSSXML_SUBXML_">"
"RTN","PSSFDBDI",72,0)
 S DOSETAG="<dosingInfo",ENDTAG="/>",FDBDX=999
"RTN","PSSFDBDI",73,0)
 S PSSXML=PSSXML_DOSETAG_SPACE_$$ATRIBUTE^PSSHRCOM("gcnSeqNo",GCNSEQ)_SPACE_$$ATRIBUTE^PSSHRCOM("fdbdx",FDBDX)_SPACE_ENDTAG
"RTN","PSSFDBDI",74,0)
 S PSSXML=PSSXML_"</"_TAG_">"
"RTN","PSSFDBDI",75,0)
 Q PSSXML
"RTN","PSSFDBDI",76,0)
 ;
"RTN","PSSFDBDI",77,0)
POST(XML,PSSGCN,PSSOUT) ; post the XML request to PEPS server and return the routes
"RTN","PSSFDBDI",78,0)
 ;  input: XML request
"RTN","PSSFDBDI",79,0)
 ; output: PSSOUT - array containing the list of route names for the given drug.
"RTN","PSSFDBDI",80,0)
 ;
"RTN","PSSFDBDI",81,0)
 N PSS,PSSERR,PSSFDBDI S PSSFDBDI=1
"RTN","PSSFDBDI",82,0)
 N $ETRAP,$ESTACK
"RTN","PSSFDBDI",83,0)
 ; Set error trap
"RTN","PSSFDBDI",84,0)
 SET $ETRAP="DO ERROR^PSSHTTP"
"RTN","PSSFDBDI",85,0)
 K ^TMP($J,"OUT")    ; if exists from previous runs, posting would not execute.
"RTN","PSSFDBDI",86,0)
 ;
"RTN","PSSFDBDI",87,0)
 S PSS("server")="PEPS"
"RTN","PSSFDBDI",88,0)
 S PSS("webserviceName")="DOSING_INFO"
"RTN","PSSFDBDI",89,0)
 S PSS("path")="dosinginfo"
"RTN","PSSFDBDI",90,0)
 S PSS("parameterName")="xmlRequest"
"RTN","PSSFDBDI",91,0)
 S PSS("parameterValue")=XML
"RTN","PSSFDBDI",92,0)
 ;
"RTN","PSSFDBDI",93,0)
 ; get instance of client REST request object
"RTN","PSSFDBDI",94,0)
 SET PSS("restObject")=$$GETREST^XOBWLIB(PSS("webserviceName"),PSS("server"))
"RTN","PSSFDBDI",95,0)
 IF $DATA(^TMP($JOB,"OUT","EXCEPTION"))>0 S PSSOUT(0)="-1^"_^TMP($JOB,"OUT","EXCEPTION") K ^TMP($JOB,"OUT","EXCEPTION") Q PSSOUT
"RTN","PSSFDBDI",96,0)
 ;
"RTN","PSSFDBDI",97,0)
 ; insert XML as parameter
"RTN","PSSFDBDI",98,0)
 DO PSS("restObject").InsertFormData(PSS("parameterName"),PSS("parameterValue"))
"RTN","PSSFDBDI",99,0)
 IF $DATA(^TMP($JOB,"OUT","EXCEPTION"))>0 S PSSOUT(0)="-1^"_^TMP($JOB,"OUT","EXCEPTION") K ^TMP($JOB,"OUT","EXCEPTION") QUIT PSSOUT
"RTN","PSSFDBDI",100,0)
 ;
"RTN","PSSFDBDI",101,0)
 ; execute HTTP Post method
"RTN","PSSFDBDI",102,0)
 SET PSS("postResult")=$$POST^XOBWLIB(PSS("restObject"),PSS("path"),.PSSERR)
"RTN","PSSFDBDI",103,0)
 IF $DATA(^TMP($JOB,"OUT","EXCEPTION"))>0 S PSSOUT(0)="-1^"_^TMP($JOB,"OUT","EXCEPTION") K ^TMP($JOB,"OUT","EXCEPTION") QUIT PSSOUT
"RTN","PSSFDBDI",104,0)
 ;
"RTN","PSSFDBDI",105,0)
 ; error handling
"RTN","PSSFDBDI",106,0)
 DO:'PSS("postResult")
"RTN","PSSFDBDI",107,0)
 . SET PSSOUT(0)=-1_U_"Unable to make http request."
"RTN","PSSFDBDI",108,0)
 . SET PSS("result")=0
"RTN","PSSFDBDI",109,0)
 . QUIT
"RTN","PSSFDBDI",110,0)
 ;
"RTN","PSSFDBDI",111,0)
 ; if every thing is ok parse the returned xml result
"RTN","PSSFDBDI",112,0)
 I PSS("postResult") S PSS("result")=1 D PRSSTRM(PSS("restObject"),PSSGCN,.PSSOUT)
"RTN","PSSFDBDI",113,0)
 S PSSOUT(0)=1
"RTN","PSSFDBDI",114,0)
 I $D(^TMP($J,"OUT","EXCEPTION")) S PSSOUT(0)="-1^"_^TMP($J,"OUT","EXCEPTION") K ^TMP($J,"OUT","EXCEPTION"),^TMP($J,"PSSFDBDI")
"RTN","PSSFDBDI",115,0)
 Q PSS("result")
"RTN","PSSFDBDI",116,0)
 ;
"RTN","PSSFDBDI",117,0)
PRSSTRM(RESTOBJ,PSSGCN,PSSOUT) ;  parse the XML into token
"RTN","PSSFDBDI",118,0)
 ;  input: RESTOBJ--a rest object
"RTN","PSSFDBDI",119,0)
 ; output: PSSOUT - array containing the list of route names for the given drug.
"RTN","PSSFDBDI",120,0)
 ;
"RTN","PSSFDBDI",121,0)
 ; parse the XML into tokens. the first part of the token is the type of node being read.
"RTN","PSSFDBDI",122,0)
 ; the second part is the data--either the name of the node, or data. these fields are delimited using "<>".
"RTN","PSSFDBDI",123,0)
 ; if the node is type attribute, each attribute is separated by a caret ("^").
"RTN","PSSFDBDI",124,0)
 ;
"RTN","PSSFDBDI",125,0)
 N AREADER
"RTN","PSSFDBDI",126,0)
 S AREADER=$$GETREADR^PSSFDBRT(RESTOBJ)
"RTN","PSSFDBDI",127,0)
 D PARSXML(AREADER,PSSGCN,.PSSOUT)
"RTN","PSSFDBDI",128,0)
 Q
"RTN","PSSFDBDI",129,0)
 ;
"RTN","PSSFDBDI",130,0)
PARSXML(AREADER,PSSGCN,PSSOUT) ; extract the list of routes from XML results
"RTN","PSSFDBDI",131,0)
 ;  input: AREADER-%XML.TextReader object.
"RTN","PSSFDBDI",132,0)
 ;
"RTN","PSSFDBDI",133,0)
 N DRGDESC,DRGFLG,ATOKEN,DTOKEN,NODETYPE,GCNSEQ,FDBDX,PSSDR,PSSMM,PSSOUT2,PSSSEQ,I,SEQ,SEQ2,SEQ3,SEQ4,TYP2,TYP3,LDAY,HDAY,FTYPE,MMSEQ,MMATR
"RTN","PSSFDBDI",134,0)
 D GETFILE(.PSSDR,.PSSMM) S (PSSSEQ,MMSEQ,MMATR)=0
"RTN","PSSFDBDI",135,0)
 F  D  Q:AREADER.EOF
"RTN","PSSFDBDI",136,0)
 .S ATOKEN=$$GETTOKEN(AREADER)
"RTN","PSSFDBDI",137,0)
 .I '$L(ATOKEN) Q
"RTN","PSSFDBDI",138,0)
 .S NODETYPE=$P(ATOKEN,"<>"),ATOKEN=$P(ATOKEN,"<>",2)
"RTN","PSSFDBDI",139,0)
 .Q:NODETYPE["exception"
"RTN","PSSFDBDI",140,0)
 .; inside dosing attributes
"RTN","PSSFDBDI",141,0)
 .I ATOKEN="dispensableDrugName" S DTOKEN="",DTOKEN=$$GETTOKEN(AREADER) S $P(PSSOUT2(GCNSEQ),"^",3)=$P(DTOKEN,"<>",2) Q
"RTN","PSSFDBDI",142,0)
 .I ATOKEN="dispensableDrugDescription"  S DTOKEN="",DTOKEN=$$GETTOKEN(AREADER) S $P(PSSOUT2(GCNSEQ),"^",4)=$P(DTOKEN,"<>",2) Q
"RTN","PSSFDBDI",143,0)
 .I NODETYPE="dosingInfo(attributes)" S FTYPE="doseRanges",GCNSEQ=$P($P(ATOKEN,"^",2),"=",2),FDBDX=$P($P(ATOKEN,"^",1),"=",2) S:$G(GCNSEQ)="999" GCNSEQ=$G(FDBDX),FDBDX="999" S PSSOUT2(GCNSEQ)=GCNSEQ_"^"_PSSGCN_"^^^"_FDBDX Q
"RTN","PSSFDBDI",144,0)
 .I NODETYPE="doseRange(attributes)"  S (FIELD,FLDNAM,FLDDATA)="" S PSSSEQ=PSSSEQ+1,FTYPE="doseRanges" D 
"RTN","PSSFDBDI",145,0)
 ..F I=1:1:4 S FIELD=$P(ATOKEN,"^",I),FLDNAM=$P(FIELD,"="),FLDDATA=$P(FIELD,"=",2) D SETARRAY
"RTN","PSSFDBDI",146,0)
 ..D DOSE
"RTN","PSSFDBDI",147,0)
 .I NODETYPE="minMax(attributes)" D
"RTN","PSSFDBDI",148,0)
 ..S MMSEQ=MMSEQ+1,MMATR=1,FTYPE="minMax",LDAY=$P($P(ATOKEN,"^",1),"=",2),HDAY=$P($P(ATOKEN,"^",2),"=",2) D DOSE
"RTN","PSSFDBDI",149,0)
 ;
"RTN","PSSFDBDI",150,0)
 N FIRST,FLD2,FLD8,FLD7,FLD3
"RTN","PSSFDBDI",151,0)
 S (FIRST,GCNSEQ,SEQ,SEQ2,SEQ3,SEQ4,FTYPE,TYP2,TYP3)="",FTYPE=0
"RTN","PSSFDBDI",152,0)
 F  S GCNSEQ=$O(PSSOUT2(GCNSEQ)) Q:GCNSEQ=""  D
"RTN","PSSFDBDI",153,0)
 .I '$G(FIRST),$D(PSSOUT2(GCNSEQ)) D
"RTN","PSSFDBDI",154,0)
 ..S ^TMP($J,"PSSFDBDI",GCNSEQ,0)=PSSOUT2(GCNSEQ)
"RTN","PSSFDBDI",155,0)
 ..S ^TMP($J,"PSSFDBDI","B",GCNSEQ)=$P(PSSOUT2(GCNSEQ),"^",3),FIRST=1
"RTN","PSSFDBDI",156,0)
 ..F  S FTYPE=$O(PSSOUT2(GCNSEQ,FTYPE)) Q:FTYPE=""!(FTYPE="A")  F  S SEQ=$O(PSSOUT2(GCNSEQ,FTYPE,SEQ)) Q:SEQ=""  F  S SEQ2=$O(PSSOUT2(GCNSEQ,FTYPE,SEQ,SEQ2)) Q:SEQ2=""  D
"RTN","PSSFDBDI",157,0)
 ...F  S SEQ3=$O(PSSOUT2(GCNSEQ,FTYPE,SEQ,SEQ2,SEQ3)) Q:SEQ3=""  D
"RTN","PSSFDBDI",158,0)
 ....S ^TMP($J,"PSSFDBDI",GCNSEQ,FTYPE,SEQ,SEQ2,SEQ3)=PSSOUT2(GCNSEQ,FTYPE,SEQ,SEQ2,SEQ3)  I SEQ2=1,FTYPE="doseRanges" D SETXREF
"RTN","PSSFDBDI",159,0)
 S ^TMP($J,"PSSFDBDI",0)="DOSING INFORMATION FOR A SPECIFIC DRUG^^"_(SEQ3)_"^"_(SEQ3)
"RTN","PSSFDBDI",160,0)
 Q
"RTN","PSSFDBDI",161,0)
 ;
"RTN","PSSFDBDI",162,0)
SETXREF ;
"RTN","PSSFDBDI",163,0)
 Q:FTYPE="minMax"
"RTN","PSSFDBDI",164,0)
 N FLDS,FLD1
"RTN","PSSFDBDI",165,0)
 S (FLDS,FLD3,FLD7,FLD8,FLD1)="",FLDS=PSSOUT2(GCNSEQ,FTYPE,SEQ,SEQ2,SEQ3) F I=1,3,7,8 S @("FLD"_I)=$P(FLDS,"^",I)
"RTN","PSSFDBDI",166,0)
 S ^TMP($J,"PSSFDBDI","A",FLD3,FLD7,FLD8,SEQ)=FLD1
"RTN","PSSFDBDI",167,0)
 S ^TMP($J,"PSSFDBDI","C",FLD7,FLD8,FLD3,SEQ)=FLD1
"RTN","PSSFDBDI",168,0)
 Q
"RTN","PSSFDBDI",169,0)
  ;
"RTN","PSSFDBDI",170,0)
DOSE ; extract list of routes
"RTN","PSSFDBDI",171,0)
 N ID,BNODE,BTOKEN,CTOKEN,CTYPE,ROUTNM,FIELD,OFLDNAM,FLDNAM,FLDDATA,I
"RTN","PSSFDBDI",172,0)
 S FLDNAM=""
"RTN","PSSFDBDI",173,0)
 F  D  Q:(CTOKEN="/doseRange"!(CTOKEN="/minMax"))!(AREADER.EOF)
"RTN","PSSFDBDI",174,0)
 .S BTOKEN=$$GETTOKEN(AREADER)
"RTN","PSSFDBDI",175,0)
 .Q:'$L(BTOKEN)
"RTN","PSSFDBDI",176,0)
 .S CTYPE=$P(BTOKEN,"<>"),CTOKEN=$P(BTOKEN,"<>",2)
"RTN","PSSFDBDI",177,0)
 .I CTOKEN="/doseRange" Q
"RTN","PSSFDBDI",178,0)
 .I (CTOKEN="/minMax") Q
"RTN","PSSFDBDI",179,0)
 .Q:CTYPE="endElement"&(BTOKEN="/"_FLDNAM)
"RTN","PSSFDBDI",180,0)
 .I CTYPE="element" S FLDNAM="",FLDNAM=CTOKEN
"RTN","PSSFDBDI",181,0)
 .I CTYPE="chars" S FLDDATA="",FLDDATA=CTOKEN D SETARRAY
"RTN","PSSFDBDI",182,0)
 Q
"RTN","PSSFDBDI",183,0)
 ;
"RTN","PSSFDBDI",184,0)
SETARRAY ;set dose ranges array
"RTN","PSSFDBDI",185,0)
 N ANODE,APIECE,FILENAME,FILENODE
"RTN","PSSFDBDI",186,0)
 I '$G(MMATR) D  Q
"RTN","PSSFDBDI",187,0)
 .S (FILENAME,APIECE,ANODE)="",FILENODE=$G(PSSDR(FLDNAM)) S:FILENODE'="" ANODE=$P(FILENODE,"^"),APIECE=$P(FILENODE,"^",2)
"RTN","PSSFDBDI",188,0)
 .S:ANODE'="" $P(PSSOUT2(GCNSEQ,FTYPE,PSSSEQ,ANODE,0),"^",APIECE)=FLDDATA
"RTN","PSSFDBDI",189,0)
 I $G(MMATR) D
"RTN","PSSFDBDI",190,0)
 .S (FILENAME,APIECE,ANODE)="",FILENODE=$G(PSSMM(FLDNAM)) S:FILENODE'="" ANODE=$P(FILENODE,"^"),APIECE=$P(FILENODE,"^",2)
"RTN","PSSFDBDI",191,0)
 .S:ANODE'="" $P(PSSOUT2(GCNSEQ,FTYPE,LDAY,HDAY,ANODE),"^",APIECE)=FLDDATA
"RTN","PSSFDBDI",192,0)
 Q
"RTN","PSSFDBDI",193,0)
 ;
"RTN","PSSFDBDI",194,0)
GETTOKEN(READER) ; get a token at a time
"RTN","PSSFDBDI",195,0)
 ;  input: AREADER-%XML.TextReader object
"RTN","PSSFDBDI",196,0)
 ; Output: returns a token
"RTN","PSSFDBDI",197,0)
 ;
"RTN","PSSFDBDI",198,0)
 ;   this is the key to the parsing of the XML stream.
"RTN","PSSFDBDI",199,0)
 ;   each element is parsed with its associated data (if any)
"RTN","PSSFDBDI",200,0)
 ;   the nodetype is concatenated with "<>" with the Token
"RTN","PSSFDBDI",201,0)
 ;   which can be the tag or the data.
"RTN","PSSFDBDI",202,0)
 ;   for example each time is called return one of the following:
"RTN","PSSFDBDI",203,0)
 N TOKEN,NODETYPE,SUBTOKEN,ALLTOKEN
"RTN","PSSFDBDI",204,0)
 S TOKEN="",SUBTOKEN="",NODETYPE="",ALLTOKEN=""
"RTN","PSSFDBDI",205,0)
 D
"RTN","PSSFDBDI",206,0)
 .Q:READER.EOF
"RTN","PSSFDBDI",207,0)
 .D READER.Read()  ; go to first node
"RTN","PSSFDBDI",208,0)
 .Q:READER.EOF     ; try before and after read
"RTN","PSSFDBDI",209,0)
 .;W !,READER.NodeTypeGet()
"RTN","PSSFDBDI",210,0)
 .;S NODETYPE=READER.NodeTypeGet()
"RTN","PSSFDBDI",211,0)
 .I READER.HasAttributes D
"RTN","PSSFDBDI",212,0)
 ..S NODETYPE=READER.Name_"(attributes)"
"RTN","PSSFDBDI",213,0)
 ..S TOKEN=$$GETATTS(READER)
"RTN","PSSFDBDI",214,0)
 .I '$L(TOKEN) S NODETYPE=READER.NodeTypeGet() D
"RTN","PSSFDBDI",215,0)
 ..I NODETYPE="element" S TOKEN=READER.Name Q
"RTN","PSSFDBDI",216,0)
 ..I NODETYPE="chars" S TOKEN=READER.Value Q
"RTN","PSSFDBDI",217,0)
 ..I NODETYPE="endelement" S TOKEN="/"_READER.Name Q
"RTN","PSSFDBDI",218,0)
 ..I NODETYPE="comment" S TOKEN="^"
"RTN","PSSFDBDI",219,0)
 ..I NODETYPE="processinginstruction" S TOKEN=READER.Value Q
"RTN","PSSFDBDI",220,0)
 ..I NODETYPE="ignorablewhitespace" S TOKEN="^" Q
"RTN","PSSFDBDI",221,0)
 ..I NODETYPE="startprefixmapping" S TOKEN=READER.Value Q
"RTN","PSSFDBDI",222,0)
 ..I NODETYPE="warning" S TOKEN=READER.Value Q
"RTN","PSSFDBDI",223,0)
 ..I '$L(TOKEN) S TOKEN="^"
"RTN","PSSFDBDI",224,0)
 ..;
"RTN","PSSFDBDI",225,0)
 .I $L(NODETYPE) S ALLTOKEN=NODETYPE_"<>"_TOKEN
"RTN","PSSFDBDI",226,0)
 ;W !,"TOKEN="_ALLTOKEN
"RTN","PSSFDBDI",227,0)
 Q ALLTOKEN
"RTN","PSSFDBDI",228,0)
 ;
"RTN","PSSFDBDI",229,0)
GETATTS(AREADER) ; get attributes
"RTN","PSSFDBDI",230,0)
 ;  input: AREADER-%XML.TextReader object
"RTN","PSSFDBDI",231,0)
 ; Output: returns the attributes
"RTN","PSSFDBDI",232,0)
 ;
"RTN","PSSFDBDI",233,0)
 N I,INDEX,TOKEN,SUBTOKEN,ATTRB
"RTN","PSSFDBDI",234,0)
 S (TOKEN,SUBTOKEN)=""
"RTN","PSSFDBDI",235,0)
 S INDEX=AREADER.AttributeCountGet()
"RTN","PSSFDBDI",236,0)
 FOR I=1:1:INDEX D
"RTN","PSSFDBDI",237,0)
 .S ATTRB=AREADER.MoveToAttributeIndex(I) D
"RTN","PSSFDBDI",238,0)
 .S SUBTOKEN=AREADER.Name_"="_AREADER.Value
"RTN","PSSFDBDI",239,0)
 .I '$L(TOKEN) S TOKEN=SUBTOKEN Q
"RTN","PSSFDBDI",240,0)
 .S TOKEN=TOKEN_"^"_SUBTOKEN
"RTN","PSSFDBDI",241,0)
 ;W !,"  ATT=",TOKEN
"RTN","PSSFDBDI",242,0)
 Q TOKEN
"RTN","PSSFDBDI",243,0)
 ;
"RTN","PSSFDBDI",244,0)
GETFILE(PSSDR,PSSMM) ;
"RTN","PSSFDBDI",245,0)
 N I,PSSTYPE,PSSFILE,PSSFLD,PSSNODE,PSSPIECE
"RTN","PSSFDBDI",246,0)
 F I=1:1 S PSSFILE=$P($T(FILE+I),";;",2,99) Q:PSSFILE=""  D
"RTN","PSSFDBDI",247,0)
 .S PSSTYPE=$P(PSSFILE,";"),PSSFLD=$P(PSSFILE,";",2),PSSNODE=$P(PSSFILE,";",3),PSSPIECE=$P(PSSFILE,";",4)
"RTN","PSSFDBDI",248,0)
 .I PSSTYPE="" S PSSDR(PSSFLD)=PSSNODE_"^"_PSSPIECE
"RTN","PSSFDBDI",249,0)
 .I PSSTYPE="MM" S PSSMM(PSSFLD)=PSSNODE_"^"_PSSPIECE
"RTN","PSSFDBDI",250,0)
 Q
"RTN","PSSFDBDI",251,0)
 ;
"RTN","PSSFDBDI",252,0)
FILE ;file structure for the temp file for each data field imported from FDB
"RTN","PSSFDBDI",253,0)
 ;;;custom;1;1
"RTN","PSSFDBDI",254,0)
 ;;;category;1;2
"RTN","PSSFDBDI",255,0)
 ;;;doseTypeId;1;3
"RTN","PSSFDBDI",256,0)
 ;;;doseTypeDescription;1;4
"RTN","PSSFDBDI",257,0)
 ;;;doseRouteId;1;5
"RTN","PSSFDBDI",258,0)
 ;;;intlDoseRouteDescription;1;6
"RTN","PSSFDBDI",259,0)
 ;;;ageLowInDays;1;7
"RTN","PSSFDBDI",260,0)
 ;;;ageHighInDays;1;8
"RTN","PSSFDBDI",261,0)
 ;;;hitIndicationId;2;1
"RTN","PSSFDBDI",262,0)
 ;;;hitIndicationDescription;2;2
"RTN","PSSFDBDI",263,0)
 ;;;indicationId;2;3
"RTN","PSSFDBDI",264,0)
 ;;;indicationDescription;2;4
"RTN","PSSFDBDI",265,0)
 ;;;indicationIdType;2;5
"RTN","PSSFDBDI",266,0)
 ;;;resultType;2;6
"RTN","PSSFDBDI",267,0)
 ;;;warningCode;2;7
"RTN","PSSFDBDI",268,0)
 ;;;bsaRequired;3;1
"RTN","PSSFDBDI",269,0)
 ;;;weightRequired;3;2
"RTN","PSSFDBDI",270,0)
 ;;;hepaticImpairment;3;3
"RTN","PSSFDBDI",271,0)
 ;;;renalImpairment;3;4
"RTN","PSSFDBDI",272,0)
 ;;;lowEliminationHalfLife;3;5
"RTN","PSSFDBDI",273,0)
 ;;;highEliminationHalfLife;3;6
"RTN","PSSFDBDI",274,0)
 ;;;halfLifeUnit;3;7
"RTN","PSSFDBDI",275,0)
 ;;;crclThreshold;3;8
"RTN","PSSFDBDI",276,0)
 ;;;crclThresholdUnit;3;9
"RTN","PSSFDBDI",277,0)
 ;;;durationLow;4;1
"RTN","PSSFDBDI",278,0)
 ;;;durationHigh;4;2
"RTN","PSSFDBDI",279,0)
 ;;;maxDuration;4;3
"RTN","PSSFDBDI",280,0)
 ;;;frequencyLow;4;4
"RTN","PSSFDBDI",281,0)
 ;;;frequencyHigh;4;5
"RTN","PSSFDBDI",282,0)
 ;;;doseLow;5;1
"RTN","PSSFDBDI",283,0)
 ;;;doseLowUnit;5;2
"RTN","PSSFDBDI",284,0)
 ;;;doseHigh;5;3
"RTN","PSSFDBDI",285,0)
 ;;;doseHighUnit;5;4
"RTN","PSSFDBDI",286,0)
 ;;;doseFormLow;5;5
"RTN","PSSFDBDI",287,0)
 ;;;doseFormLowUnit;5;6
"RTN","PSSFDBDI",288,0)
 ;;;doseFormHigh;5;7
"RTN","PSSFDBDI",289,0)
 ;;;doseFormHighUnit;5;8
"RTN","PSSFDBDI",290,0)
 ;;;maxSingleDose;6;1
"RTN","PSSFDBDI",291,0)
 ;;;maxSingleDoseUnit;6;2
"RTN","PSSFDBDI",292,0)
 ;;;maxSingleDoseForm;6;3
"RTN","PSSFDBDI",293,0)
 ;;;maxSingleDoseFormUnit;6;4
"RTN","PSSFDBDI",294,0)
 ;;;maxDailyDose6;5
"RTN","PSSFDBDI",295,0)
 ;;;maxDailyDoseUnit;6;6
"RTN","PSSFDBDI",296,0)
 ;;;maxDailyDoseForm;6;7
"RTN","PSSFDBDI",297,0)
 ;;;maxDailyDoseFormUnit;6;8
"RTN","PSSFDBDI",298,0)
 ;;;maxLifetimeDose;7;1
"RTN","PSSFDBDI",299,0)
 ;;;maxLifetimeDoseUnit;7;2
"RTN","PSSFDBDI",300,0)
 ;;;maxLifetimeDoseForm;7;3
"RTN","PSSFDBDI",301,0)
 ;;;maxLifetimeDoseFormUnit;7;4
"RTN","PSSFDBDI",302,0)
 ;;MM;doseLow;1;1
"RTN","PSSFDBDI",303,0)
 ;;MM;doseLowUnit;1;2
"RTN","PSSFDBDI",304,0)
 ;;MM;doseHigh;1;3
"RTN","PSSFDBDI",305,0)
 ;;MM;doseHighUnit;1;4
"RTN","PSSFDBDI",306,0)
 ;;MM;doseFormLow;1;5
"RTN","PSSFDBDI",307,0)
 ;;MM;doseFormLowUnit;1;6
"RTN","PSSFDBDI",308,0)
 ;;MM;doseFormHigh;1;7
"RTN","PSSFDBDI",309,0)
 ;;MM;doseFormHighUnit;1;8
"RTN","PSSFDBDI",310,0)
 ;;MM;maxDailyDose;2;1
"RTN","PSSFDBDI",311,0)
 ;;MM;maxDailyDoseUnit;2;2
"RTN","PSSFDBDI",312,0)
 ;;MM;maxDailyDoseForm;2;3
"RTN","PSSFDBDI",313,0)
 ;;MM;maxDailyDoseFormUnit;2;4
"RTN","PSSFDBDI",314,0)
 ;;MM;resultType;2;5
"RTN","PSSFDBDI",315,0)
 ;;MM;warningCode;2;6
"RTN","PSSFDBDI",316,0)
 ;;MM;bsaRequired;2;7
"RTN","PSSFDBDI",317,0)
 ;;MM;weightRequired;2;8
"VER")
8.0^22.0
**END**
**END**
