Released PSS*1*207 SEQ #177
Extracted from mail message
**KIDS**:PSS*1.0*207^

**INSTALL NAME**
PSS*1.0*207
"BLD",9625,0)
PSS*1.0*207^PHARMACY DATA MANAGEMENT^0^3161212^y
"BLD",9625,4,0)
^9.64PA^^
"BLD",9625,6)
3^
"BLD",9625,6.3)
31
"BLD",9625,"ABPKG")
n
"BLD",9625,"KRN",0)
^9.67PA^9002226^21
"BLD",9625,"KRN",.4,0)
.4
"BLD",9625,"KRN",.401,0)
.401
"BLD",9625,"KRN",.402,0)
.402
"BLD",9625,"KRN",.402,"NM",0)
^9.68A^^0
"BLD",9625,"KRN",.403,0)
.403
"BLD",9625,"KRN",.5,0)
.5
"BLD",9625,"KRN",.84,0)
.84
"BLD",9625,"KRN",3.6,0)
3.6
"BLD",9625,"KRN",3.8,0)
3.8
"BLD",9625,"KRN",9.2,0)
9.2
"BLD",9625,"KRN",9.8,0)
9.8
"BLD",9625,"KRN",9.8,"NM",0)
^9.68A^5^1
"BLD",9625,"KRN",9.8,"NM",5,0)
PSSDEE^^0^B142583898
"BLD",9625,"KRN",9.8,"NM","B","PSSDEE",5)

"BLD",9625,"KRN",19,0)
19
"BLD",9625,"KRN",19.1,0)
19.1
"BLD",9625,"KRN",101,0)
101
"BLD",9625,"KRN",409.61,0)
409.61
"BLD",9625,"KRN",771,0)
771
"BLD",9625,"KRN",779.2,0)
779.2
"BLD",9625,"KRN",870,0)
870
"BLD",9625,"KRN",8989.51,0)
8989.51
"BLD",9625,"KRN",8989.52,0)
8989.52
"BLD",9625,"KRN",8994,0)
8994
"BLD",9625,"KRN",9002226,0)
9002226
"BLD",9625,"KRN","B",.4,.4)

"BLD",9625,"KRN","B",.401,.401)

"BLD",9625,"KRN","B",.402,.402)

"BLD",9625,"KRN","B",.403,.403)

"BLD",9625,"KRN","B",.5,.5)

"BLD",9625,"KRN","B",.84,.84)

"BLD",9625,"KRN","B",3.6,3.6)

"BLD",9625,"KRN","B",3.8,3.8)

"BLD",9625,"KRN","B",9.2,9.2)

"BLD",9625,"KRN","B",9.8,9.8)

"BLD",9625,"KRN","B",19,19)

"BLD",9625,"KRN","B",19.1,19.1)

"BLD",9625,"KRN","B",101,101)

"BLD",9625,"KRN","B",409.61,409.61)

"BLD",9625,"KRN","B",771,771)

"BLD",9625,"KRN","B",779.2,779.2)

"BLD",9625,"KRN","B",870,870)

"BLD",9625,"KRN","B",8989.51,8989.51)

"BLD",9625,"KRN","B",8989.52,8989.52)

"BLD",9625,"KRN","B",8994,8994)

"BLD",9625,"KRN","B",9002226,9002226)

"BLD",9625,"QDEF")
^^^^NO^^^^NO^^NO
"BLD",9625,"QUES",0)
^9.62^^
"BLD",9625,"REQB",0)
^9.611^1^1
"BLD",9625,"REQB",1,0)
PSS*1.0*200^1
"BLD",9625,"REQB","B","PSS*1.0*200",1)

"MBREQ")
0
"PKG",517,-1)
1^1
"PKG",517,0)
PHARMACY DATA MANAGEMENT^PSS^Maintenance of Pharmacy files.
"PKG",517,20,0)
^9.402P^^
"PKG",517,22,0)
^9.49I^1^1
"PKG",517,22,1,0)
1.0^2970930^2971014^11595
"PKG",517,22,1,"PAH",1,0)
207^3161212
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","PSSDEE")
0^5^B142583898^B142621269
"RTN","PSSDEE",1,0)
PSSDEE ;BIR/WRT-MASTER DRUG ENTER/EDIT ROUTINE ;01/21/00
"RTN","PSSDEE",2,0)
 ;;1.0;PHARMACY DATA MANAGEMENT;**3,5,15,16,20,22,28,32,34,33,38,57,47,68,61,82,90,110,155,156,180,193,200,207**;9/30/97;Build 31
"RTN","PSSDEE",3,0)
 ;
"RTN","PSSDEE",4,0)
 ;Reference to ^PS(59 supported by DBIA #1976
"RTN","PSSDEE",5,0)
 ;Reference to REACT1^PSNOUT supported by DBIA #2080
"RTN","PSSDEE",6,0)
 ;Reference to $$UP^XLFSTR(X) supported by DBIA #10104
"RTN","PSSDEE",7,0)
 ;Reference to $$PSJDF^PSNAPIS(P1,P3) supported by DBIA #2531
"RTN","PSSDEE",8,0)
 ;Reference to PSNAPIS supported by DBIA #2531
"RTN","PSSDEE",9,0)
 ;Reference to ^XMB("NETNAME" supported by DBIA #1131
"RTN","PSSDEE",10,0)
 ;Reference to ^XUSEC supported by DIBA #10076
"RTN","PSSDEE",11,0)
 ;
"RTN","PSSDEE",12,0)
BEGIN N PSSUPRAF,PSSTDRUG
"RTN","PSSDEE",13,0)
 S PSSFLAG=0 D ^PSSDEE2 S PSSZ=1 F PSSXX=1:1 K DA D ASK Q:PSSFLAG
"RTN","PSSDEE",14,0)
DONE D ^PSSDEE2 K PSSFLAGK,PSSXX,DIE,DIR,CLFLAG,CLFALG,DISPDRG,DLAYGO,DR,ENTRY,FLAG,FLG1,FLG2,FLG4,FLG5,FLG6,FLG7,FLGKY,FLGMTH,FLGNDF,FLGOI,K,NEWDF
"RTN","PSSDEE",15,0)
 K NFLAG,NWND,NWPC1,NWPC2,NWPC3OLDDF,PSIUDA,PSIUX,PSNP,PSSANS,PSSASK,PSSDA,PSSDD,PSSFLAG,PSSOR,PSSZ,PSXBT,PSXF,PSXFL,PSXUM,PSXGOOD,PSXLOC,ZAPFLG
"RTN","PSSDEE",16,0)
 Q
"RTN","PSSDEE",17,0)
ASK ;
"RTN","PSSDEE",18,0)
 W ! S DIC="^PSDRUG(",DIC(0)="QEALMNTV",DLAYGO=50,DIC("T")="",DIC("W")="S PSSTDRUG=Y D GETTIER^PSSDEE(PSSTDRUG)" D ^DIC K DIC I Y<0 S PSSFLAG=1 Q
"RTN","PSSDEE",19,0)
 N PSINACT S (FLG1,FLG2,FLG3,FLG4,FLG5,FLG6,FLG7,FLAG,FLGKY,FLGOI,PSINACT)=0 K ^TMP($J,"ADD"),^TMP($J,"SOL")
"RTN","PSSDEE",20,0)
 S DA=+Y,DISPDRG=DA L +^PSDRUG(DISPDRG):0 I '$T W !,$C(7),"Another person is editing this one." Q
"RTN","PSSDEE",21,0)
 I $G(^PSDRUG(DA,"I")) S PSINACT=$G(^PSDRUG(DA,"I")) I PSINACT,PSINACT<DT S PSINACT=1  ;;<<*180 - RJS
"RTN","PSSDEE",22,0)
 S PSSHUIDG=1,PSSNEW=$P(Y,"^",3) D USE,NOPE,COMMON,DEA,MF K PSSHUIDG,PSSUPRAF
"RTN","PSSDEE",23,0)
 ; if any outpatient site has a dispense machine running HL7 V.2.4, then
"RTN","PSSDEE",24,0)
 ; run the new routine and create message
"RTN","PSSDEE",25,0)
 N XX,DNSNAM,DNSPORT,DVER,DMFU,PSSUPRA S XX=""
"RTN","PSSDEE",26,0)
 F XX=0:0 S XX=$O(^PS(59,XX)) Q:'XX  D
"RTN","PSSDEE",27,0)
 .S DVER=$$GET1^DIQ(59,XX_",",105,"I"),DMFU=$$GET1^DIQ(59,XX_",",105.2)
"RTN","PSSDEE",28,0)
 .S DNSNAM=$$GET1^DIQ(59,XX_",",2006),DNSPORT=$$GET1^DIQ(59,XX_",",2007)
"RTN","PSSDEE",29,0)
 .D:DVER="2.4"&(DNSNAM'="")&(DMFU="YES") DRG^PSSDGUPD(DISPDRG,PSSNEW,DNSNAM,DNSPORT)
"RTN","PSSDEE",30,0)
 D DRG^PSSHUIDG(DISPDRG,PSSNEW) L -^PSDRUG(DISPDRG)
"RTN","PSSDEE",31,0)
 S XX=$P($G(^PSDRUG(DISPDRG,2)),"^",3) I XX["U"!(XX["I") D  S XX=""
"RTN","PSSDEE",32,0)
 .S XX=$$SNDHL7^PSSMSTR() D:XX
"RTN","PSSDEE",33,0)
 ..Q:PSSNEW&'((XX=2)!(XX=3))  ;U=1,N=2,B=3
"RTN","PSSDEE",34,0)
 ..Q:'PSSNEW&(XX=2)  ;U=1,N=2,B=3
"RTN","PSSDEE",35,0)
 ..N VAR
"RTN","PSSDEE",36,0)
 ..I PSSNEW&((XX=2)!(XX=3)) S VAR="Would you like to send this new drug to PADE"
"RTN","PSSDEE",37,0)
 ..E  S VAR="Would you like to send a drug file update to PADE"
"RTN","PSSDEE",38,0)
 ..W !!,"This drug is marked for either UD or IV use, and you have at least"
"RTN","PSSDEE",39,0)
 ..W !,"one active Pharmacy Automated Dispensing Equipment (PADE)."
"RTN","PSSDEE",40,0)
 ..K DIR,DIRUT,DUOUT,DTOUT
"RTN","PSSDEE",41,0)
 ..S DIR(0)="Y",DIR("A")=VAR
"RTN","PSSDEE",42,0)
 ..S DIR("?")="Enter Y for Yes or N for No." D ^DIR K DIR
"RTN","PSSDEE",43,0)
 ..Q:'Y
"RTN","PSSDEE",44,0)
 ..N PSSPADE S PSSPADE=1 S XX=""
"RTN","PSSDEE",45,0)
 ..D ENP^PSSHLDFS(DISPDRG,$S(PSSNEW:"MAD",1:"MUP"))
"RTN","PSSDEE",46,0)
 K FLG3,PSSNEW
"RTN","PSSDEE",47,0)
 Q
"RTN","PSSDEE",48,0)
COMMON S DIE="^PSDRUG(",DR="[PSSCOMMON]" D ^DIE Q:$D(Y)!($D(DTOUT))  W:'$D(Y) !,"PRICE PER DISPENSE UNIT: " S:'$D(^PSDRUG(DA,660)) $P(^PSDRUG(DA,660),"^",6)="" W:'$D(Y) $P(^PSDRUG(DA,660),"^",6)
"RTN","PSSDEE",49,0)
 D DEA,CK,ASKND,OIKILL^PSSDEE1,COMMON1
"RTN","PSSDEE",50,0)
 Q
"RTN","PSSDEE",51,0)
COMMON1 W !,"Just a reminder...you are editing ",$P(^PSDRUG(DISPDRG,0),"^"),"."
"RTN","PSSDEE",52,0)
 S (PSSVVDA,DA)=DISPDRG D DOSN^PSSDOS S DA=PSSVVDA K PSSVVDA D USE,APP,ORDITM^PSSDEE1
"RTN","PSSDEE",53,0)
 Q
"RTN","PSSDEE",54,0)
CK D DSPY^PSSDEE1 S FLGNDF=0
"RTN","PSSDEE",55,0)
 Q
"RTN","PSSDEE",56,0)
ASKND S %=-1 I $D(^XUSEC("PSNMGR",DUZ)) D MESSAGE^PSSDEE1 W !!,"Do you wish to match/rematch to NATIONAL DRUG file" S %=1 S:FLGMTH=1 %=2 D YN^DICN
"RTN","PSSDEE",57,0)
 I %=0 W !,"If you answer ""yes"", you will attempt to match to NDF." G ASKND
"RTN","PSSDEE",58,0)
 S PSSUPRAF=%
"RTN","PSSDEE",59,0)
 I %=2 K X,Y Q
"RTN","PSSDEE",60,0)
 I %<0 K X,Y Q
"RTN","PSSDEE",61,0)
 I %=1 D  ;;<<*180 - RJS
"RTN","PSSDEE",62,0)
 .D RSET^PSSDEE1
"RTN","PSSDEE",63,0)
 .I 'PSINACT D EN1^PSSUTIL(DISPDRG,1)
"RTN","PSSDEE",64,0)
 .S X="PSNOUT" X ^%ZOSF("TEST") I  D REACT1^PSNOUT S DA=DISPDRG I $D(^PSDRUG(DA,"ND")),$P(^PSDRUG(DA,"ND"),"^",2)]"" D ONE
"RTN","PSSDEE",65,0)
 Q  ;;<< *180 - RJS
"RTN","PSSDEE",66,0)
ONE S PSNP=$G(^PSDRUG(DA,"I")) I PSNP,PSNP<DT Q
"RTN","PSSDEE",67,0)
 W !,"You have just VERIFIED this match and MERGED the entry." D CKDF D EN2^PSSUTIL(DISPDRG,1) S:'$D(OLDDF) OLDDF="" I OLDDF'=NEWDF S FLGNDF=1 D WR
"RTN","PSSDEE",68,0)
 Q
"RTN","PSSDEE",69,0)
CKDF S NWND=^PSDRUG(DA,"ND"),NWPC1=$P(NWND,"^",1),NWPC3=$P(NWND,"^",3),DA=NWPC1,K=NWPC3 S X=$$PSJDF^PSNAPIS(DA,K) S NEWDF=$P(X,"^",2),DA=DISPDRG
"RTN","PSSDEE",70,0)
 N PSSK D PKIND^PSSDDUT2
"RTN","PSSDEE",71,0)
 Q
"RTN","PSSDEE",72,0)
NOPE S ZAPFLG=0 I '$D(^PSDRUG(DA,"ND")),$D(^PSDRUG(DA,2)),$P(^PSDRUG(DA,2),"^",1)']"" D DFNULL
"RTN","PSSDEE",73,0)
 I '$D(^PSDRUG(DA,"ND")),'$D(^PSDRUG(DA,2)) D DFNULL
"RTN","PSSDEE",74,0)
 I $D(^PSDRUG(DA,"ND")),$P(^PSDRUG(DA,"ND"),"^",2)']"",$D(^PSDRUG(DA,2)),$P(^PSDRUG(DA,2),"^",1)']"" D DFNULL
"RTN","PSSDEE",75,0)
 Q
"RTN","PSSDEE",76,0)
DFNULL S OLDDF="",ZAPFLG=1
"RTN","PSSDEE",77,0)
 Q
"RTN","PSSDEE",78,0)
ZAPIT I $D(ZAPFLG),ZAPFLG=1,FLGNDF=1,OLDDF'=NEWDF D CKIV^PSSDEE1
"RTN","PSSDEE",79,0)
 Q
"RTN","PSSDEE",80,0)
APP W !!,"MARK THIS DRUG AND EDIT IT FOR: " D CHOOSE
"RTN","PSSDEE",81,0)
 Q
"RTN","PSSDEE",82,0)
CHOOSE I $D(^XUSEC("PSORPH",DUZ))!($D(^XUSEC("PSXCMOPMGR",DUZ))) W !,"O  - Outpatient" S FLG1=1
"RTN","PSSDEE",83,0)
 I $D(^XUSEC("PSJU MGR",DUZ)) W !,"U  - Unit Dose" S FLG2=1
"RTN","PSSDEE",84,0)
 I $D(^XUSEC("PSJI MGR",DUZ)) W !,"I  - IV" S FLG3=1
"RTN","PSSDEE",85,0)
 I $D(^XUSEC("PSGWMGR",DUZ)) W !,"W  - Ward Stock" S FLG4=1
"RTN","PSSDEE",86,0)
 I $D(^XUSEC("PSAMGR",DUZ))!($D(^XUSEC("PSA ORDERS",DUZ))) W !,"D  - Drug Accountability" S FLG5=1
"RTN","PSSDEE",87,0)
 I $D(^XUSEC("PSDMGR",DUZ)) W !,"C  - Controlled Substances" S FLG6=1
"RTN","PSSDEE",88,0)
 I $D(^XUSEC("PSORPH",DUZ)) W !,"X  - Non-VA Med" S FLG7=1
"RTN","PSSDEE",89,0)
 I FLG1,FLG2,FLG3,FLG4,FLG5,FLG6 S FLAG=1
"RTN","PSSDEE",90,0)
 I FLAG W !,"A  - ALL"
"RTN","PSSDEE",91,0)
 W !
"RTN","PSSDEE",92,0)
 I 'FLG1,'FLG2,'FLG3,'FLG4,'FLG5,'FLG6,'FLG7 W !,"You do not have the proper keys to continue. Sorry, this concludes your editing session.",! S FLGKY=1 K DIRUT,X Q
"RTN","PSSDEE",93,0)
 I FLGKY'=1 D
"RTN","PSSDEE",94,0)
 . K DIR S DIR(0)="FO^1:30"
"RTN","PSSDEE",95,0)
 . S DIR("A")="Enter your choice(s) separated by commas "
"RTN","PSSDEE",96,0)
 . F  D ^DIR Q:$$CHECK($$UP^XLFSTR(X))
"RTN","PSSDEE",97,0)
 . S PSSANS=X,PSSANS=$$UP^XLFSTR(PSSANS) D BRANCH,BRANCH1
"RTN","PSSDEE",98,0)
 Q
"RTN","PSSDEE",99,0)
 ;
"RTN","PSSDEE",100,0)
CHECK(X) ; Validates Application Use response
"RTN","PSSDEE",101,0)
 N CHECK,I,C
"RTN","PSSDEE",102,0)
 S CHECK=1 I X=""!(Y["^")!($D(DIRUT)) Q CHECK
"RTN","PSSDEE",103,0)
 F I=1:1:$L(X,",") D
"RTN","PSSDEE",104,0)
 . S C=$P(X,",",I) W !?43,C," - "
"RTN","PSSDEE",105,0)
 . I C="O",FLG1 W "Outpatient" Q
"RTN","PSSDEE",106,0)
 . I C="U",FLG2 W "Unit Dose" Q
"RTN","PSSDEE",107,0)
 . I C="I",FLG3 W "IV" Q
"RTN","PSSDEE",108,0)
 . I C="W",FLG4 W "Ward Stock" Q
"RTN","PSSDEE",109,0)
 . I C="D",FLG5 W "Drug Accountability" Q
"RTN","PSSDEE",110,0)
 . I C="C",FLG6 W "Controlled Substances" Q
"RTN","PSSDEE",111,0)
 . I C="X",FLG7 W "Non-VA Med" Q
"RTN","PSSDEE",112,0)
 . W "Invalid Entry",$C(7) S CHECK=0
"RTN","PSSDEE",113,0)
 Q CHECK
"RTN","PSSDEE",114,0)
BRANCH D:PSSANS["O" OP D:PSSANS["U" UD D:PSSANS["I" IV D:PSSANS["W" WS
"RTN","PSSDEE",115,0)
 D:PSSANS["D" DACCT D:PSSANS["C" CS D:PSSANS["X" NVM
"RTN","PSSDEE",116,0)
 Q
"RTN","PSSDEE",117,0)
BRANCH1 I FLAG,PSSANS["A" D OP,UD,IV,WS,DACCT,CS,NVM
"RTN","PSSDEE",118,0)
 Q
"RTN","PSSDEE",119,0)
OP I FLG1 D
"RTN","PSSDEE",120,0)
 . W !,"** You are NOW editing OUTPATIENT fields. **"
"RTN","PSSDEE",121,0)
 . S PSIUDA=DA,PSIUX="O^Outpatient Pharmacy" D ^PSSGIU
"RTN","PSSDEE",122,0)
 . I %=1 D
"RTN","PSSDEE",123,0)
 . . S DIE="^PSDRUG(",DR="[PSSOP]" D ^DIE K DIR D OPEI,ASKCMOP
"RTN","PSSDEE",124,0)
 . . S X="PSOCLO1" X ^%ZOSF("TEST") I  D ASKCLOZ S FLGOI=1
"RTN","PSSDEE",125,0)
 I FLG1 D CKCMOP
"RTN","PSSDEE",126,0)
 Q
"RTN","PSSDEE",127,0)
CKCMOP I $P($G(^PSDRUG(DISPDRG,2)),"^",3)'["O" S:$D(^PSDRUG(DISPDRG,3)) $P(^PSDRUG(DISPDRG,3),"^",1)=0 K:$D(^PSDRUG("AQ",DISPDRG)) ^PSDRUG("AQ",DISPDRG) S DA=DISPDRG D ^PSSREF
"RTN","PSSDEE",128,0)
 Q
"RTN","PSSDEE",129,0)
UD I FLG2 W !,"** You are NOW editing UNIT DOSE fields. **" S PSIUDA=DA,PSIUX="U^Unit Dose" D ^PSSGIU I %=1 S DIE="^PSDRUG(",DR="62.05;212.2" D ^DIE S DIE="^PSDRUG(",DR="212",DR(2,50.0212)=".01;1" D ^DIE S FLGOI=1
"RTN","PSSDEE",130,0)
 Q
"RTN","PSSDEE",131,0)
IV I FLG3 W !,"** You are NOW editing IV fields. **" S (PSIUDA,PSSDA)=DA,PSIUX="I^IV" D ^PSSGIU I %=1 D IV1 S FLGOI=1
"RTN","PSSDEE",132,0)
 Q
"RTN","PSSDEE",133,0)
IV1 K PSSIVOUT ;This variable controls the selection process loop.
"RTN","PSSDEE",134,0)
 W !,"Edit Additives or Solutions: " K DIR S DIR(0)="SO^A:ADDITIVES;S:SOLUTIONS;" D ^DIR Q:$D(DIRUT)  S PSSASK=Y(0) D:PSSASK="ADDITIVES" ENA^PSSVIDRG D:PSSASK="SOLUTIONS" ENS^PSSVIDRG I '$D(PSSIVOUT) G IV1
"RTN","PSSDEE",135,0)
 K PSSIVOUT
"RTN","PSSDEE",136,0)
 Q
"RTN","PSSDEE",137,0)
WS I FLG4 W !,"** You are NOW editing WARD STOCK fields. **" S DIE="^PSDRUG(",DR="300;301;302" D ^DIE
"RTN","PSSDEE",138,0)
 Q
"RTN","PSSDEE",139,0)
DACCT I FLG5 W !,"** You are NOW editing DRUG ACCOUNTABILITY fields. **" S DIE="^PSDRUG(",DR="441" D ^DIE S DIE="^PSDRUG(",DR="9",DR(2,50.1)="1;2;400;401;402;403;404;405" D ^DIE
"RTN","PSSDEE",140,0)
 Q
"RTN","PSSDEE",141,0)
CS I FLG6 W !,"** You are NOW Marking/Unmarking for CONTROLLED SUBS. **" S PSIUDA=DA,PSIUX="N^Controlled Substances" D ^PSSGIU
"RTN","PSSDEE",142,0)
 Q
"RTN","PSSDEE",143,0)
NVM I FLG7 W !,"** You are NOW Marking/Unmarking for NON-VA MEDS. **" S PSIUDA=DA,PSIUX="X^Non-VA Med" D ^PSSGIU
"RTN","PSSDEE",144,0)
 Q
"RTN","PSSDEE",145,0)
ASKCMOP I $D(^XUSEC("PSXCMOPMGR",DUZ)) W !!,"Do you wish to mark to transmit to CMOP? " K DIR S DIR(0)="Y",DIR("?")="If you answer ""yes"", you will attempt to mark this drug to transmit to CMOP."
"RTN","PSSDEE",146,0)
 D ^DIR I "Nn"[X K X,Y,DIRUT Q
"RTN","PSSDEE",147,0)
 I "Yy"[X S PSXFL=0 D TEXT^PSSMARK H 7 N PSXUDA S (PSXUM,PSXUDA)=DA,PSXLOC=$P(^PSDRUG(DA,0),"^"),PSXGOOD=0,PSXF=0,PSXBT=0 D BLD^PSSMARK,PICK2^PSSMARK S DA=PSXUDA
"RTN","PSSDEE",148,0)
 Q
"RTN","PSSDEE",149,0)
ASKCLOZ W !!,"Do you wish to mark/unmark as a LAB MONITOR or CLOZAPINE DRUG? " K DIR S DIR(0)="Y",DIR("?")="If you answer ""yes"", you will have the opportunity to edit LAB MONITOR or CLOZAPINE fields."
"RTN","PSSDEE",150,0)
 D ^DIR I "Nn"[X K X,Y,DIRUT Q
"RTN","PSSDEE",151,0)
 I "Yy"[X S NFLAG=0 D MONCLOZ
"RTN","PSSDEE",152,0)
 Q
"RTN","PSSDEE",153,0)
MONCLOZ K PSSAST D FLASH W !,"Mark/Unmark for Lab Monitor or Clozapine: " K DIR S DIR(0)="S^L:LAB MONITOR;C:CLOZAPINE;" D ^DIR Q:$D(DIRUT)  S PSSAST=Y(0) D:PSSAST="LAB MONITOR" ^PSSLAB D:PSSAST="CLOZAPINE" CLOZ
"RTN","PSSDEE",154,0)
 Q
"RTN","PSSDEE",155,0)
FLASH K LMFLAG,CLFALG,WHICH S WHICH=$P($G(^PSDRUG(DISPDRG,"CLOZ1")),"^"),LMFLAG=0,CLFLAG=0
"RTN","PSSDEE",156,0)
 I WHICH="PSOCLO1" S CLFLAG=1
"RTN","PSSDEE",157,0)
 I WHICH'="PSOCLO1" S:WHICH'="" LMFLAG=1
"RTN","PSSDEE",158,0)
 Q
"RTN","PSSDEE",159,0)
CLOZ Q:NFLAG  Q:$D(DTOUT)  Q:$D(DIRUT)  Q:$D(DUOUT)  W !,"** You are NOW editing CLOZAPINE fields. **" D ^PSSCLDRG
"RTN","PSSDEE",160,0)
 Q
"RTN","PSSDEE",161,0)
USE K PACK S PACK="" S:$P($G(^PSDRUG(DISPDRG,"PSG")),"^",2)]"" PACK="W" I $D(^PSDRUG(DISPDRG,2)) S PACK=PACK_$P(^PSDRUG(DISPDRG,2),"^",3)
"RTN","PSSDEE",162,0)
 I PACK'="" D
"RTN","PSSDEE",163,0)
 .W $C(7) N XX W !! F XX=1:1:79 W "*"
"RTN","PSSDEE",164,0)
 .W !,"This entry is marked for the following PHARMACY packages: "
"RTN","PSSDEE",165,0)
 .D USE1
"RTN","PSSDEE",166,0)
 Q
"RTN","PSSDEE",167,0)
USE1 W:PACK["O" !," Outpatient" W:PACK["U" !," Unit Dose" W:PACK["I" !," IV"
"RTN","PSSDEE",168,0)
 W:PACK["W" !," Ward Stock" W:PACK["D" !," Drug Accountability"
"RTN","PSSDEE",169,0)
 W:PACK["N" !," Controlled Substances" W:PACK["X" !," Non-VA Med"
"RTN","PSSDEE",170,0)
 W:'$D(PACK) !," NONE"
"RTN","PSSDEE",171,0)
 I PACK'["O",PACK'["U",PACK'["I",PACK'["W",PACK'["D",PACK'["N",PACK'["X" W !," NONE"
"RTN","PSSDEE",172,0)
 Q
"RTN","PSSDEE",173,0)
WR I ^XMB("NETNAME")'["CMOP-" W:OLDDF'="" !,"The dosage form has changed from "_OLDDF_" to "_NEWDF_" due to",!,"matching/rematching to NDF.",!,"You will need to rematch to Orderable Item.",!
"RTN","PSSDEE",174,0)
 Q
"RTN","PSSDEE",175,0)
PRIMDRG I $D(^PS(59.7,1,20)),$P(^PS(59.7,1,20),"^",1)=4!($P(^PS(59.7,1,20),"^",1)=4.5) I $D(^PSDRUG(DISPDRG,2)) S VAR=$P(^PSDRUG(DISPDRG,2),"^",3) I VAR["U"!(VAR["I") D PRIM1
"RTN","PSSDEE",176,0)
 Q
"RTN","PSSDEE",177,0)
PRIM1 W !!,"You need to match this drug to ""PRIMARY DRUG"" file as well.",! S DIE="^PSDRUG(",DR="64",DA=DISPDRG D ^DIE K VAR
"RTN","PSSDEE",178,0)
 Q
"RTN","PSSDEE",179,0)
MF I $P($G(^PS(59.7,1,80)),"^",2)>1 I $D(^PSDRUG(DISPDRG,2)) S PSSOR=$P(^PSDRUG(DISPDRG,2),"^",1) I PSSOR]"" D EN^PSSPOIDT(PSSOR),EN2^PSSHL1(PSSOR,"MUP")
"RTN","PSSDEE",180,0)
 Q
"RTN","PSSDEE",181,0)
MFA I $P($G(^PS(59.7,1,80)),"^",2)>1 S PSSOR=$P(^PS(52.6,ENTRY,0),"^",11),PSSDD=$P(^PS(52.6,ENTRY,0),"^",2) I PSSOR]"" D EN^PSSPOIDT(PSSOR),EN2^PSSHL1(PSSOR,"MUP") D MFDD
"RTN","PSSDEE",182,0)
 Q
"RTN","PSSDEE",183,0)
MFS I $P($G(^PS(59.7,1,80)),"^",2)>1 S PSSOR=$P(^PS(52.7,ENTRY,0),"^",11),PSSDD=$P(^PS(52.7,ENTRY,0),"^",2) I PSSOR]"" D EN^PSSPOIDT(PSSOR),EN2^PSSHL1(PSSOR,"MUP") D MFDD
"RTN","PSSDEE",184,0)
 Q
"RTN","PSSDEE",185,0)
MFDD I $D(^PSDRUG(PSSDD,2)) S PSSOR=$P(^PSDRUG(PSSDD,2),"^",1) I PSSOR]"" D EN^PSSPOIDT(PSSOR),EN2^PSSHL1(PSSOR,"MUP")
"RTN","PSSDEE",186,0)
 Q
"RTN","PSSDEE",187,0)
OPEI ;
"RTN","PSSDEE",188,0)
 S DIE="^PSDRUG(",DR="28",DA=DISPDRG
"RTN","PSSDEE",189,0)
 D ^DIE
"RTN","PSSDEE",190,0)
 Q:'+$P($G(^PSDRUG(DA,6)),"^")
"RTN","PSSDEE",191,0)
OPEI2 ; get external dispensing devices associated with the drug
"RTN","PSSDEE",192,0)
 W !!,"Defining a dispensing device at the drug level for a division will override"
"RTN","PSSDEE",193,0)
 W !,"the dispensing device settings in the OUTPATIENT SITE File (#59). If populated,",!,"the drug will be sent to the dispensing device for that division.",!
"RTN","PSSDEE",194,0)
 S DR="906"
"RTN","PSSDEE",195,0)
 D ^DIE
"RTN","PSSDEE",196,0)
 Q
"RTN","PSSDEE",197,0)
DEA ;
"RTN","PSSDEE",198,0)
 I $P($G(^PSDRUG(DISPDRG,3)),"^")=1,($P(^PSDRUG(DISPDRG,0),"^",3)[1!($P(^(0),"^",3)[2)) D DSH
"RTN","PSSDEE",199,0)
 Q
"RTN","PSSDEE",200,0)
DSH W !!,"****************************************************************************"
"RTN","PSSDEE",201,0)
 W !,"This entry contains a ""1"" or a ""2"" in the ""DEA, SPECIAL HDLG""",!,"field, therefore this item has been UNMARKED for CMOP transmission."
"RTN","PSSDEE",202,0)
 W !,"****************************************************************************",! S $P(^PSDRUG(DISPDRG,3),"^")=0 K ^PSDRUG("AQ",DISPDRG) S DA=DISPDRG N % D ^PSSREF
"RTN","PSSDEE",203,0)
 Q
"RTN","PSSDEE",204,0)
CPTIER(VAPID) ;Called from PSSCOMMON Input Template
"RTN","PSSDEE",205,0)
 ; VAPID = IEN OF DRUG FILE #50
"RTN","PSSDEE",206,0)
 N CPDATE,X,PSSCP D NOW^%DTC S CPDATE=X S PSSCP=$$CPTIER^PSNAPIS("",CPDATE,VAPID,1) K CPDATE,X
"RTN","PSSDEE",207,0)
 ;  PSSCP = Copay Tier^Effective Date^End Date
"RTN","PSSDEE",208,0)
 W !,"Copay Tier: ",$P(PSSCP,"^",1)
"RTN","PSSDEE",209,0)
 W !,"Copay Effective Date: " S Y=$P(PSSCP,"^",2) D DD^%DT W Y K Y,PSSCP
"RTN","PSSDEE",210,0)
 Q
"RTN","PSSDEE",211,0)
 ;
"RTN","PSSDEE",212,0)
GETTIER(PSSTDRUG) ;called by DIC to get copay tier for today's date 
"RTN","PSSDEE",213,0)
 N VAPID,CPDATE,X,PSSCP,VAPROD,PSSDRGCL,PSSCONVD,PSSINACT,PSSFSN,PSSNFORM,PSSMSG,PSSRESTR,PSSDRDAT D NOW^%DTC S CPDATE=X
"RTN","PSSDEE",214,0)
 D GETS^DIQ(50,PSSTDRUG,"2;22;51;6;100;101;102","IE","PSSDRDAT")
"RTN","PSSDEE",215,0)
 S (PSSDRGCL,PSSFSN,PSSNFORM,PSSINACT,PSSMSG,PSSRESTR,VAPROD)=""
"RTN","PSSDEE",216,0)
 S:$G(PSSDRDAT(50,PSSTDRUG_",",2,"E"))'="" PSSDRGCL=PSSDRDAT(50,PSSTDRUG_",",2,"E")
"RTN","PSSDEE",217,0)
 S:$G(PSSDRDAT(50,PSSTDRUG_",",6,"E"))'="" PSSFSN=PSSDRDAT(50,PSSTDRUG_",",6,"E")
"RTN","PSSDEE",218,0)
 S:$G(PSSDRDAT(50,PSSTDRUG_",",51,"E"))'="" PSSNFORM=PSSDRDAT(50,PSSTDRUG_",",51,"E")
"RTN","PSSDEE",219,0)
 S:$G(PSSDRDAT(50,PSSTDRUG_",",100,"I")) PSSINACT=PSSDRDAT(50,PSSTDRUG_",",100,"I")
"RTN","PSSDEE",220,0)
 S:$G(PSSDRDAT(50,PSSTDRUG_",",101,"E"))'="" PSSMSG=PSSDRDAT(50,PSSTDRUG_",",101,"E")
"RTN","PSSDEE",221,0)
 S:$G(PSSDRDAT(50,PSSTDRUG_",",102,"E"))'="" PSSRESTR=PSSDRDAT(50,PSSTDRUG_",",102,"E")
"RTN","PSSDEE",222,0)
 S:$G(PSSDRDAT(50,PSSTDRUG_",",22,"I")) VAPROD=PSSDRDAT(50,PSSTDRUG_",",22,"I")
"RTN","PSSDEE",223,0)
 W " "_$$GET1^DIQ(50,PSSTDRUG,2) 
"RTN","PSSDEE",224,0)
 S PSSCP=$$CPTIER^PSNAPIS(VAPROD,CPDATE,"",1) K CPDATE,X
"RTN","PSSDEE",225,0)
 W:$G(PSSFSN)["" "  "_PSSFSN W:$G(PSSNFORM)["" "  ",PSSNFORM ;FSN; local non-formulary
"RTN","PSSDEE",226,0)
 I $G(VAPROD),$P(PSSCP,"^")'="" W "  Tier ",$P(PSSCP,"^")
"RTN","PSSDEE",227,0)
 S:$G(PSSINACT) PSSCONVD=$$DATE(PSSINACT)  ;inactive date
"RTN","PSSDEE",228,0)
 W:$G(PSSCONVD)'="" "  "_PSSCONVD
"RTN","PSSDEE",229,0)
 W:$G(PSSMSG)'="" "  "_PSSMSG
"RTN","PSSDEE",230,0)
 W:$G(PSSRESTR)'="" "  "_PSSRESTR
"RTN","PSSDEE",231,0)
 Q
"RTN","PSSDEE",232,0)
 ;
"RTN","PSSDEE",233,0)
DATE(PSSCONVD) ;convert fileman date to mm/dd/yyyy
"RTN","PSSDEE",234,0)
 N DATE
"RTN","PSSDEE",235,0)
 S DATE="",DATE=$E(PSSCONVD,4,5)_"/"_$E(PSSCONVD,6,7)_"/"_(1700+$E(PSSCONVD,1,3))
"RTN","PSSDEE",236,0)
 Q DATE
"VER")
8.0^22.0
"BLD",9625,6)
^177
**END**
**END**

