Released PSS*1*210 SEQ #191
Extracted from mail message
**KIDS**:PSS*1.0*210^

**INSTALL NAME**
PSS*1.0*210
"BLD",10734,0)
PSS*1.0*210^PHARMACY DATA MANAGEMENT^0^3180315^y
"BLD",10734,1,0)
^^8^8^3180315^^
"BLD",10734,1,1,0)
1.  Free text is accepted in the NAME field (#.01) of the 
"BLD",10734,1,2,0)
    ADMINISTRATION SCHEDULE file (#51.1) when the TYPE OF
"BLD",10734,1,3,0)
    SCHEDULE field (#5) is set to D (Day of the Week).
"BLD",10734,1,4,0)
               
"BLD",10734,1,5,0)
2.  Changes made to the NAME field (#.01) of the 
"BLD",10734,1,6,0)
    PHARMACY ORDERABLE ITEMS file (#50.7) via the Drug 
"BLD",10734,1,7,0)
    Enter/Edit [PSS DRUG ENTER/EDIT] option are not  
"BLD",10734,1,8,0)
    always reflected in the ORDERABLE ITEMS file (#101.43).
"BLD",10734,4,0)
^9.64PA^^0
"BLD",10734,6)
4^
"BLD",10734,6.3)
9
"BLD",10734,"INID")
^n
"BLD",10734,"INIT")
EN^PSS1P210
"BLD",10734,"KRN",0)
^9.67PA^779.2^20
"BLD",10734,"KRN",.4,0)
.4
"BLD",10734,"KRN",.4,"NM",0)
^9.68A^^0
"BLD",10734,"KRN",.401,0)
.401
"BLD",10734,"KRN",.401,"NM",0)
^9.68A^^0
"BLD",10734,"KRN",.402,0)
.402
"BLD",10734,"KRN",.402,"NM",0)
^9.68A^^0
"BLD",10734,"KRN",.403,0)
.403
"BLD",10734,"KRN",.5,0)
.5
"BLD",10734,"KRN",.84,0)
.84
"BLD",10734,"KRN",3.6,0)
3.6
"BLD",10734,"KRN",3.6,"NM",0)
^9.68A^^0
"BLD",10734,"KRN",3.8,0)
3.8
"BLD",10734,"KRN",3.8,"NM",0)
^9.68A^^0
"BLD",10734,"KRN",9.2,0)
9.2
"BLD",10734,"KRN",9.8,0)
9.8
"BLD",10734,"KRN",9.8,"NM",0)
^9.68A^5^4
"BLD",10734,"KRN",9.8,"NM",1,0)
PSSPOIMO^^0^B143564555
"BLD",10734,"KRN",9.8,"NM",3,0)
PSSJSV^^0^B157152089
"BLD",10734,"KRN",9.8,"NM",4,0)
PSS1P210^^0^B20795612
"BLD",10734,"KRN",9.8,"NM",5,0)
PSSJEEU^^0^B14262573
"BLD",10734,"KRN",9.8,"NM","B","PSS1P210",4)

"BLD",10734,"KRN",9.8,"NM","B","PSSJEEU",5)

"BLD",10734,"KRN",9.8,"NM","B","PSSJSV",3)

"BLD",10734,"KRN",9.8,"NM","B","PSSPOIMO",1)

"BLD",10734,"KRN",19,0)
19
"BLD",10734,"KRN",19,"NM",0)
^9.68A^^0
"BLD",10734,"KRN",19.1,0)
19.1
"BLD",10734,"KRN",19.1,"NM",0)
^9.68A^^0
"BLD",10734,"KRN",101,0)
101
"BLD",10734,"KRN",101,"NM",0)
^9.68A^^0
"BLD",10734,"KRN",409.61,0)
409.61
"BLD",10734,"KRN",771,0)
771
"BLD",10734,"KRN",771,"NM",0)
^9.68A^^0
"BLD",10734,"KRN",779.2,0)
779.2
"BLD",10734,"KRN",870,0)
870
"BLD",10734,"KRN",8989.51,0)
8989.51
"BLD",10734,"KRN",8989.52,0)
8989.52
"BLD",10734,"KRN",8994,0)
8994
"BLD",10734,"KRN","B",.4,.4)

"BLD",10734,"KRN","B",.401,.401)

"BLD",10734,"KRN","B",.402,.402)

"BLD",10734,"KRN","B",.403,.403)

"BLD",10734,"KRN","B",.5,.5)

"BLD",10734,"KRN","B",.84,.84)

"BLD",10734,"KRN","B",3.6,3.6)

"BLD",10734,"KRN","B",3.8,3.8)

"BLD",10734,"KRN","B",9.2,9.2)

"BLD",10734,"KRN","B",9.8,9.8)

"BLD",10734,"KRN","B",19,19)

"BLD",10734,"KRN","B",19.1,19.1)

"BLD",10734,"KRN","B",101,101)

"BLD",10734,"KRN","B",409.61,409.61)

"BLD",10734,"KRN","B",771,771)

"BLD",10734,"KRN","B",779.2,779.2)

"BLD",10734,"KRN","B",870,870)

"BLD",10734,"KRN","B",8989.51,8989.51)

"BLD",10734,"KRN","B",8989.52,8989.52)

"BLD",10734,"KRN","B",8994,8994)

"BLD",10734,"QDEF")
^^^^NO^^^^^^NO
"BLD",10734,"QUES",0)
^9.62^^
"BLD",10734,"REQB",0)
^9.611^4^2
"BLD",10734,"REQB",3,0)
PSS*1.0*201^2
"BLD",10734,"REQB",4,0)
PSS*1.0*204^2
"BLD",10734,"REQB","B","PSS*1.0*201",3)

"BLD",10734,"REQB","B","PSS*1.0*204",4)

"INIT")
EN^PSS1P210
"MBREQ")
0
"PKG",488,-1)
1^1
"PKG",488,0)
PHARMACY DATA MANAGEMENT^PSS^Maintenance of Pharmacy files.
"PKG",488,20,0)
^9.402P^^
"PKG",488,22,0)
^9.49I^1^1
"PKG",488,22,1,0)
1.0^2970930^3000316^66481
"PKG",488,22,1,"PAH",1,0)
210^3180315^1235
"PKG",488,22,1,"PAH",1,1,0)
^^8^8^3180315
"PKG",488,22,1,"PAH",1,1,1,0)
1.  Free text is accepted in the NAME field (#.01) of the 
"PKG",488,22,1,"PAH",1,1,2,0)
    ADMINISTRATION SCHEDULE file (#51.1) when the TYPE OF
"PKG",488,22,1,"PAH",1,1,3,0)
    SCHEDULE field (#5) is set to D (Day of the Week).
"PKG",488,22,1,"PAH",1,1,4,0)
               
"PKG",488,22,1,"PAH",1,1,5,0)
2.  Changes made to the NAME field (#.01) of the 
"PKG",488,22,1,"PAH",1,1,6,0)
    PHARMACY ORDERABLE ITEMS file (#50.7) via the Drug 
"PKG",488,22,1,"PAH",1,1,7,0)
    Enter/Edit [PSS DRUG ENTER/EDIT] option are not  
"PKG",488,22,1,"PAH",1,1,8,0)
    always reflected in the ORDERABLE ITEMS file (#101.43).
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
4
"RTN","PSS1P210")
0^4^B20795612^n/a
"RTN","PSS1P210",1,0)
PSS1P210 ;PAW - Patch 210 Post Install Routine;4/25/2017
"RTN","PSS1P210",2,0)
 ;;1.0;PHARMACY DATA MANAGEMENT;**210**;9/30/97;Build 9
"RTN","PSS1P210",3,0)
 ;
"RTN","PSS1P210",4,0)
 ;This post-installation routine will identify and report free text in the NAME field  
"RTN","PSS1P210",5,0)
 ;(#.01) of the ADMINISTRATION SCHEDULE file (#51.1) when the TYPE OF SCHEDULE field (#5) 
"RTN","PSS1P210",6,0)
 ;is set to D (Day of the Week).  
"RTN","PSS1P210",7,0)
 Q
"RTN","PSS1P210",8,0)
 ;
"RTN","PSS1P210",9,0)
EN ; Begin post-installation routine 
"RTN","PSS1P210",10,0)
 I $G(DUZ)="" W !,"Your DUZ is not defined.  It must be defined to run this routine." Q
"RTN","PSS1P210",11,0)
 N NAMSP,PATCH,JOBN,ZTSK,ZTRTN,ZTIO,ZTDTH,ZTDESC,Y,ZTQUEUED,ZTREQ,ZTSAVE,CNT,SBJM
"RTN","PSS1P210",12,0)
 S NAMSP="PSS1P210"
"RTN","PSS1P210",13,0)
 S JOBN="PSS*1.0*210 Post-Installation"
"RTN","PSS1P210",14,0)
 S PATCH="PSS*1.0*210"
"RTN","PSS1P210",15,0)
 S Y=$$NOW^XLFDT S ZTDTH=$$FMTH^XLFDT(Y)
"RTN","PSS1P210",16,0)
 D BMES^XPDUTL("=============================================================")
"RTN","PSS1P210",17,0)
 D MES^XPDUTL("Queuing background job for "_JOBN_"...")
"RTN","PSS1P210",18,0)
 D MES^XPDUTL("Start time: "_$$HTE^XLFDT(ZTDTH))
"RTN","PSS1P210",19,0)
 D MES^XPDUTL("A MailMan message will be sent to the installer upon Post")
"RTN","PSS1P210",20,0)
 D MES^XPDUTL("Install Completion.")
"RTN","PSS1P210",21,0)
 D MES^XPDUTL("==============================================================")
"RTN","PSS1P210",22,0)
 ;
"RTN","PSS1P210",23,0)
 S ZTRTN="ENQN^"_NAMSP,ZTIO=""
"RTN","PSS1P210",24,0)
 S (SBJM,ZTDESC)="Background job for "_JOBN
"RTN","PSS1P210",25,0)
 S ZTSAVE("JOBN")="",ZTSAVE("ZTDTH")="",ZTSAVE("DUZ")="",ZTSAVE("SBJM")=""
"RTN","PSS1P210",26,0)
 D ^%ZTLOAD
"RTN","PSS1P210",27,0)
 D:$D(ZTSK)
"RTN","PSS1P210",28,0)
 . D MES^XPDUTL("*** Task #"_ZTSK_" Queued! ***")
"RTN","PSS1P210",29,0)
 . D BMES^XPDUTL("")
"RTN","PSS1P210",30,0)
 . S ZTSAVE("ZTSK")=""
"RTN","PSS1P210",31,0)
 D BMES^XPDUTL("")
"RTN","PSS1P210",32,0)
 K XPDQUES
"RTN","PSS1P210",33,0)
 Q
"RTN","PSS1P210",34,0)
 ;
"RTN","PSS1P210",35,0)
ENQN  ; Loop through file 51.1 and look for Day of the Week Schedule Types with Free Text 
"RTN","PSS1P210",36,0)
 N CNT,PSSCREAT,PSSDASH,PSSEXPR,PSSTIME,PSSXTIME,PSSTIMCT,PSSIEN
"RTN","PSS1P210",37,0)
 N PSSSTART,PSSX,PSSZX,PSSZ1,PSSZ2,PSSZ3,PSSZ4
"RTN","PSS1P210",38,0)
 D NOW^%DTC S PSSSTART=$E(%,1,12),PSSCREAT=$E(%,1,7),PSSEXPR=$$FMADD^XLFDT(PSSCREAT,60,0,0,0)
"RTN","PSS1P210",39,0)
 K ^TMP("PSS1P210R",$J)
"RTN","PSS1P210",40,0)
 S CNT=8
"RTN","PSS1P210",41,0)
 S PSSIEN=0
"RTN","PSS1P210",42,0)
 F  S PSSIEN=$O(^PS(51.1,PSSIEN)) Q:PSSIEN=""  D
"RTN","PSS1P210",43,0)
 . I $P($G(^PS(51.1,PSSIEN,0)),U,5)'="D" Q
"RTN","PSS1P210",44,0)
 . S PSSX=$P(^PS(51.1,PSSIEN,0),U)
"RTN","PSS1P210",45,0)
 . S PSSZX=PSSX S PSSX=$P(PSSX,"@")
"RTN","PSS1P210",46,0)
 . S PSSZ2=1,PSSZ4="-" I PSSX'["-",PSSX?.E1P.E F PSSZ1=1:1:$L(PSSX) I $E(PSSX,PSSZ1)?1P S PSSZ4=$E(PSSX,PSSZ1) Q
"RTN","PSS1P210",47,0)
 . F PSSZ1=1:1:$L(PSSX,PSSZ4) Q:'PSSZ2  S PSSZ2=0 I $L($P(PSSX,PSSZ4,PSSZ1))>1 F PSSZ3="MONDAYS","TUESDAYS","WEDNESDAYS","THURSDAYS","FRIDAYS","SATURDAYS","SUNDAYS" I $P(PSSZ3,$P(PSSX,PSSZ4,PSSZ1))="" S PSSZ2=1 Q
"RTN","PSS1P210",48,0)
 . I PSSZ2=0 K PSSX
"RTN","PSS1P210",49,0)
 . S PSSXTIME=$P(PSSZX,"@",2),PSSDASH=$L(PSSXTIME,"-")
"RTN","PSS1P210",50,0)
 . F PSSTIMCT=1:1:PSSDASH S PSSTIME=$P(PSSXTIME,"-",PSSTIMCT)
"RTN","PSS1P210",51,0)
 . I $L(PSSTIME)>4 K PSSX
"RTN","PSS1P210",52,0)
 . I '$D(PSSX) S ^TMP("PSS1P210R",$J,CNT)=PSSZX,CNT=CNT+1
"RTN","PSS1P210",53,0)
 D STOP
"RTN","PSS1P210",54,0)
 Q
"RTN","PSS1P210",55,0)
 ;
"RTN","PSS1P210",56,0)
STOP K DA,DIE,DR,NUM,CPS,CPSX,DFN,ORSTA,ORSTOP,UDIV,UIEN,UIEN1,%
"RTN","PSS1P210",57,0)
 D XMAIL1
"RTN","PSS1P210",58,0)
 D XMAIL2
"RTN","PSS1P210",59,0)
 Q
"RTN","PSS1P210",60,0)
 ;
"RTN","PSS1P210",61,0)
XMAIL1 ; Post-installation Notification for Installer
"RTN","PSS1P210",62,0)
 K PSG,XMY S XMDUZ=.5,XMSUB="PATCH PSS*1.0*210 INSTALLATION COMPLETE",XMTEXT="PSG(",XMY(DUZ)="" D NOW^%DTC S Y=% X ^DD("DD")
"RTN","PSS1P210",63,0)
 S PSG(1,0)="  -- INSTALLER --"
"RTN","PSS1P210",64,0)
 S PSG(2,0)="  The post-install for PSS*1.0*210 completed "_Y_"."
"RTN","PSS1P210",65,0)
 D ^XMD
"RTN","PSS1P210",66,0)
 Q
"RTN","PSS1P210",67,0)
 ;
"RTN","PSS1P210",68,0)
XMAIL2 ; Post-installation Notification for Users 
"RTN","PSS1P210",69,0)
 N PSSDUZ,PSSX
"RTN","PSS1P210",70,0)
 S XMSUB="PSS*1.0*210 Pharmacy Expired Order Status Change"
"RTN","PSS1P210",71,0)
 S XMDUZ=.5
"RTN","PSS1P210",72,0)
 S XMSUB="PSS*1*210 Post-Install ADMINISTRATION SCHEDULE Report"
"RTN","PSS1P210",73,0)
 I $D(^XUSEC("PSA ORDERS")) S PSSDUZ=0 F  S PSSDUZ=$O(^XUSEC("PSA ORDERS",PSSDUZ)) Q:'PSSDUZ  S XMY(PSSDUZ)=""
"RTN","PSS1P210",74,0)
 I $D(^XUSEC("PSAMGR")) S PSSDUZ=0 F  S PSSDUZ=$O(^XUSEC("PSAMGR",PSSDUZ)) Q:'PSSDUZ  S XMY(PSSDUZ)=""
"RTN","PSS1P210",75,0)
 I $D(^XUSEC("PSDMGR")) S PSSDUZ=0 F  S PSSDUZ=$O(^XUSEC("PSDMGR",PSSDUZ)) Q:'PSSDUZ  S XMY(PSSDUZ)=""
"RTN","PSS1P210",76,0)
 S PSSDUZ=0 F  S PSSDUZ=$O(^XUSEC("PSNMGR",PSSDUZ)) Q:PSSDUZ'>0  S XMY(PSSDUZ)=""
"RTN","PSS1P210",77,0)
 S ^TMP("PSS1P210R",$J,1)=" Patch PSS*1.0*210 post-installation routine has identified"
"RTN","PSS1P210",78,0)
 S ^TMP("PSS1P210R",$J,2)=" "_(CNT-8)_" Day of the Week ADMINISTRATION SCHEDULES with free"
"RTN","PSS1P210",79,0)
 S ^TMP("PSS1P210R",$J,3)=" text in the NAME field.  Please review."
"RTN","PSS1P210",80,0)
 S ^TMP("PSS1P210R",$J,4)=" "
"RTN","PSS1P210",81,0)
 S ^TMP("PSS1P210R",$J,5)="Schedule Name"
"RTN","PSS1P210",82,0)
 S ^TMP("PSS1P210R",$J,6)="======== ===="
"RTN","PSS1P210",83,0)
 S ^TMP("PSS1P210R",$J,7)=" "
"RTN","PSS1P210",84,0)
 S XMY(DUZ)=""
"RTN","PSS1P210",85,0)
 I CNT=8 S ^TMP("PSS1P210R",$J,8)="No discrepancy found, nothing to update..."
"RTN","PSS1P210",86,0)
 S XMTEXT="^TMP(""PSS1P210R"",$J," N DIFROM D ^XMD
"RTN","PSS1P210",87,0)
 K CNT,XMSUB,XMDUZ,XMY,XMTEXT,^TMP("PSS1P210R",$J)
"RTN","PSS1P210",88,0)
 Q
"RTN","PSS1P210",89,0)
 ;
"RTN","PSSJEEU")
0^5^B14262573^B14040872
"RTN","PSSJEEU",1,0)
PSSJEEU ;BIR/CML3,WRT-EXTERNAL ENTRIES UTILITY ; 09/16/97 10:04
"RTN","PSSJEEU",2,0)
 ;;1.0;PHARMACY DATA MANAGEMENT;**24,47,160,184,201,210**;9/30/97;Build 9
"RTN","PSSJEEU",3,0)
 ;
"RTN","PSSJEEU",4,0)
 ;Reference to ^SC(IEN,0 supported by DBIA #10040
"RTN","PSSJEEU",5,0)
 ;
"RTN","PSSJEEU",6,0)
ENSV ; schedule validation
"RTN","PSSJEEU",7,0)
 N PSSPKG
"RTN","PSSJEEU",8,0)
 I $D(PSJPP) K PSSPKG S PSSPKG=$$FIND1^DIC(9.4,"","O",PSJPP,"C")
"RTN","PSSJEEU",9,0)
 K PSJAT,PSJM I $S('$D(PSJPP):1,PSJPP="":1,PSJPP?.E1C.E:1,1:'$G(PSSPKG)) Q
"RTN","PSSJEEU",10,0)
 Q:$D(PSJX)[0  I $D(PSJW),$S('PSJW:1,1:'$D(^SC(PSJW,0))) K PSJW
"RTN","PSSJEEU",11,0)
 N D,DIC,DIE,Q,QX,SDW,SWD,X,X0,X1,X2,XT,Y,Z D EN^PSSJSV Q
"RTN","PSSJEEU",12,0)
 ;
"RTN","PSSJEEU",13,0)
ENSVI ; standard schedule inquire
"RTN","PSSJEEU",14,0)
 N PSSPKG
"RTN","PSSJEEU",15,0)
 I $D(PSJPP) K PSSPKG S PSSPKG=$$FIND1^DIC(9.4,"","O","PSJPP","C")
"RTN","PSSJEEU",16,0)
 Q:$S('$D(PSJPP):1,PSJPP="":1,PSJPP?.E1C.E:1,1:'$G(PSSPKG))  D ENI^PSSJSV0
"RTN","PSSJEEU",17,0)
 Q
"RTN","PSSJEEU",18,0)
 ;
"RTN","PSSJEEU",19,0)
ENSPU ; schedule processor (count)
"RTN","PSSJEEU",20,0)
 K PSJC S PSJC=-1 I $S('$D(PSJAT):1,'$D(PSJM):1,'$D(PSJSCH):1,'$D(PSJSD):1,1:'$D(PSJFD)) Q
"RTN","PSSJEEU",21,0)
 S:'$D(PSJOSD) PSJOSD=PSJSD S:'$D(PSJOFD) PSJOFD=PSJFD N AM,CD,H,HCD,I,J,M,MID,OD,PDL,PLSD,ST,Q,QQ,WD,WDT,WS,WS1,X,X1,X2,XX D EN^PSSJSPU Q
"RTN","PSSJEEU",22,0)
 ;
"RTN","PSSJEEU",23,0)
ENPSJSE ; schedule edit for Inpatient Meds
"RTN","PSSJEEU",24,0)
 S PSJPP="PSJ" N PSSTSVZP,PSSTSVXP,PSSTSVXX,PSSTSVYY,PSSTSVZZ,PSSTSVZ1,PSSTSVX1,PSSTSVX2,PSSTSVY1,PSSTSVZ2,PSSDOW
"RTN","PSSJEEU",25,0)
 ;
"RTN","PSSJEEU",26,0)
ENSE ; schedule edit
"RTN","PSSJEEU",27,0)
 N PSSPKG,PSSON,DICATTZ SET PSSON=""
"RTN","PSSJEEU",28,0)
 I $D(PSJPP) K PSSPKG S PSSPKG=$$FIND1^DIC(9.4,"","O",PSJPP,"C")
"RTN","PSSJEEU",29,0)
 I $S('$D(PSJPP):1,PSJPP="":1,PSJPP?.E1C.E:1,1:'$G(PSSPKG)) Q
"RTN","PSSJEEU",30,0)
 I $D(PSJW),$S('PSJW:1,1:'$D(^SC(PSJW,0))) K PSJW
"RTN","PSSJEEU",31,0)
 F FQ=0:0 K DIC S DICATTZ=1,DIC="^PS(51.1,",DIC(0)="EASL",DLAYGO=51.1,DIC("DR")="4////"_PSJPP,DIC("W")="D DICW^PSSJSV0",D="AP"_PSJPP W ! D IX^DIC K DIC Q:Y'>0   D
"RTN","PSSJEEU",32,0)
 .S PSSON=$$UP^XLFSTR($P($G(Y),U,2))
"RTN","PSSJEEU",33,0)
 .S DIE="^PS(51.1,",DA=+Y,DR="[PSSJ "_$S(PSJPP="PSJ":"",1:"EXT ")_"SCHEDULE EDIT]",DIE("NO^")="OUTOK" D ^DIE K DA,DIE,DR,PSJS
"RTN","PSSJEEU",34,0)
 ;* I $D(PSJHLDA) S X=$O(^ORD(101,"B","PS EVSEND SCH",0))_";ORD(101," D:X EN1^XQOR
"RTN","PSSJEEU",35,0)
 I $D(PSJHLDA) D EN2^PSSHLSCH
"RTN","PSSJEEU",36,0)
 K:PSJPP="PSJ" PSJPP K D0,DI,DISYS,DQ,FQ,X,Y Q
"RTN","PSSJEEU",37,0)
 ;
"RTN","PSSJEEU",38,0)
ENDSD ; default start date
"RTN","PSSJEEU",39,0)
 I $S('$D(PSJSCH):1,'$D(PSJAT):1,1:'$D(PSJTS)) S PSJX="" Q
"RTN","PSSJEEU",40,0)
 D ENDSD^PSSJSPU0 Q
"RTN","PSSJEEU",41,0)
 ;
"RTN","PSSJEEU",42,0)
ENPSJSHE ; shift edit for Inpatient Meds
"RTN","PSSJEEU",43,0)
 S PSJPP="PSJ"
"RTN","PSSJEEU",44,0)
 ;
"RTN","PSSJEEU",45,0)
ENSHE ; shift edit
"RTN","PSSJEEU",46,0)
 N PSSPKG
"RTN","PSSJEEU",47,0)
 I $D(PSJPP) K PSSPKG S PSSPKG=$$FIND1^DIC(9.4,"","O",PSJPP,"C")
"RTN","PSSJEEU",48,0)
 I $S('$D(PSJPP):1,PSJPP="":1,PSJPP'?.ANP:1,1:'$G(PSSPKG)) Q
"RTN","PSSJEEU",49,0)
 I $D(PSJW),$S('PSJW:1,1:'$D(^SC(PSJW,0))) K PSJW
"RTN","PSSJEEU",50,0)
 F FQ=0:0 K DIC S DIC="^PS(51.15,",DIC(0)="AEQLS",DLAYGO=51.15,DIC("DR")="4////"_PSJPP,D="AP"_PSJPP W ! D IX^DIC K DIC Q:Y'>0  S DIE="^PS(51.15,",DA=+Y,DR="[PSJ SHIFT EDIT]" D ^DIE K DA,DIE,DR
"RTN","PSSJEEU",51,0)
 K FQ,PSSPKG,X,Y Q
"RTN","PSSJEEU",52,0)
 ;
"RTN","PSSJEEU",53,0)
ENATV ; validate admin times
"RTN","PSSJEEU",54,0)
 D ENCHK^PSSJSV Q
"RTN","PSSJEEU",55,0)
 ;
"RTN","PSSJEEU",56,0)
ENSHV ;
"RTN","PSSJEEU",57,0)
 D ENSHV^PSSJSV
"RTN","PSSJEEU",58,0)
 Q
"RTN","PSSJEEU",59,0)
OTHLAN ;entry point to add translations for another language
"RTN","PSSJEEU",60,0)
 K DIK,DIC,DIRUT,DIE,DA,DR
"RTN","PSSJEEU",61,0)
 S DIE="^PS(59.7,",DA=1,DR="40.2;S:'$G(X) Y=""@1"";40.21:40.45;@1"
"RTN","PSSJEEU",62,0)
 D ^DIE K DIE,DA,X,Y,DR,DIC,D,D0,DDER,DI,DQ,%
"RTN","PSSJEEU",63,0)
 Q
"RTN","PSSJEEU",64,0)
 ;
"RTN","PSSJEEU",65,0)
 ;
"RTN","PSSJEEU",66,0)
TEMSF ;Template saves, called form the PSSJ SCHEDULE EDIT template
"RTN","PSSJEEU",67,0)
 I $D(X) S PSSTSVXX=X
"RTN","PSSJEEU",68,0)
 I $D(Y) S PSSTSVYY=Y
"RTN","PSSJEEU",69,0)
 I $D(PSJS) S PSSTSVZZ=PSJS
"RTN","PSSJEEU",70,0)
 I $D(ZPSJS) S PSSTSVZP=ZPSJS
"RTN","PSSJEEU",71,0)
 I $D(XPSJS) S PSSTSVXP=XPSJS
"RTN","PSSJEEU",72,0)
 Q
"RTN","PSSJEEU",73,0)
 ;
"RTN","PSSJEEU",74,0)
TEMSFR ;Template restores called from the PSSJ SCHEDULE EDIT template
"RTN","PSSJEEU",75,0)
 K X,Y,PSJS,ZPSJS,XPSJS
"RTN","PSSJEEU",76,0)
 I $D(PSSTSVXX) S X=PSSTSVXX
"RTN","PSSJEEU",77,0)
 I $D(PSSTSVYY) S Y=PSSTSVYY
"RTN","PSSJEEU",78,0)
 I $D(PSSTSVZZ) S PSJS=PSSTSVZZ
"RTN","PSSJEEU",79,0)
 I $D(PSSTSVZP) S ZPSJS=PSSTSVZP
"RTN","PSSJEEU",80,0)
 I $D(PSSTSVXP) S XPSJS=PSSTSVXP
"RTN","PSSJEEU",81,0)
 Q
"RTN","PSSJEEU",82,0)
 ;
"RTN","PSSJEEU",83,0)
 ;
"RTN","PSSJEEU",84,0)
TEMSFX ;Template saves, called form the PSSJ SCHEDULE EDIT template
"RTN","PSSJEEU",85,0)
 I $D(X) S PSSTSVX1=X
"RTN","PSSJEEU",86,0)
 I $D(Y) S PSSTSVY1=Y
"RTN","PSSJEEU",87,0)
 I $D(PSJS) S PSSTSVZ1=PSJS
"RTN","PSSJEEU",88,0)
 I $D(ZPSJS) S PSSTSVZ2=ZPSJS
"RTN","PSSJEEU",89,0)
 I $D(XPSJS) S PSSTSVX2=XPSJS
"RTN","PSSJEEU",90,0)
 Q
"RTN","PSSJEEU",91,0)
 ;
"RTN","PSSJEEU",92,0)
TEMSFRX ;Template restores called from the PSSJ SCHEDULE EDIT template
"RTN","PSSJEEU",93,0)
 K X,Y,PSJS,ZPSJS,XPSJS
"RTN","PSSJEEU",94,0)
 I $D(PSSTSVX1) S X=PSSTSVX1
"RTN","PSSJEEU",95,0)
 I $D(PSSTSVY1) S Y=PSSTSVY1
"RTN","PSSJEEU",96,0)
 I $D(PSSTSVZ1) S PSJS=PSSTSVZ1
"RTN","PSSJEEU",97,0)
 I $D(PSSTSVZ2) S ZPSJS=PSSTSVZ2
"RTN","PSSJEEU",98,0)
 I $D(PSSTSVX2) S XPSJS=PSSTSVX2
"RTN","PSSJEEU",99,0)
 Q
"RTN","PSSJSV")
0^3^B157152089^B148569138
"RTN","PSSJSV",1,0)
PSSJSV ;BIR/CML3/WRT-SCHEDULE VALIDATION ;06/24/96
"RTN","PSSJSV",2,0)
 ;;1.0;PHARMACY DATA MANAGEMENT;**20,38,56,59,110,121,143,149,146,189,201,210**;9/30/97;Build 9
"RTN","PSSJSV",3,0)
 ;
"RTN","PSSJSV",4,0)
 ; Reference to ^PS(51.15 is supported by DBIA #2132
"RTN","PSSJSV",5,0)
 ; Reference to $$UP^XLFSTR(P1) is supported by DBIA #10104
"RTN","PSSJSV",6,0)
 ;
"RTN","PSSJSV",7,0)
EN ;
"RTN","PSSJSV",8,0)
 S X=PSJX,(PSJAT,PSJM,PSJTS,PSJY,PSJAX)="" I $S(X["""":1,$A(X)=45:1,X'?.ANP:1,$L(X," ")>2:1,$L(X)>70:1,$L(X)<1:1,X["P RN":1,1:X["PR N") K PSJX,X Q
"RTN","PSSJSV",9,0)
 I X["PRN"!(X="ON CALL")!(X="ONCALL")!(X="ON-CALL") G DONE
"RTN","PSSJSV",10,0)
 I X?1."?" D:'$D(PSJNE) ENSVH^PSSJSV0 Q
"RTN","PSSJSV",11,0)
 I X["@" D DW S:$D(X) PSJAT=$P(X,"@",2) G DONE
"RTN","PSSJSV",12,0)
 S X0=X,(XT,Y)="" I X,X'["X",(X?2.4N1"-".E!(X?2.4N)) D ENCHK S:$D(X) PSJAT=X G DONE
"RTN","PSSJSV",13,0)
 I $S($D(^PS(51.1,"AC",PSJPP,X)):1,1:$E($O(^(X)),1,$L(X))=X) D DIC G:$S(PSJY:PSJTS'="C",1:PSJM) DONE
"RTN","PSSJSV",14,0)
 I $S(X="NOW":1,X="ONCE":1,X="STAT":1,X="ONE TIME":1,X="ONETIME":1,X="1TIME":1,X="1-TIME":1,X="1 TIME":1,1:X="ONE-TIME") S PSJTS="O" W:'$D(PSJNE) "  (ONCE ONLY)" G DONE
"RTN","PSSJSV",15,0)
 S:PSJTS="" PSJTS="C" I PSJAT="" W:'$D(PSJNE) "  (Non standard schedule)" S X=PSJX
"RTN","PSSJSV",16,0)
 I $E(X,1,2)="AD" K X G DONE
"RTN","PSSJSV",17,0)
 I $E(X,1,3)="BID"!($E(X,1,3)="TID")!($E(X,1,3)="QID") S PSJM=1440\$F("BTQ",$E(X)) G DONE
"RTN","PSSJSV",18,0)
 S:$E(X)="Q" X=$E(X,2,99) S:'X X="1"_X S X1=+X,X=$P(X,+X,2),X2=0 S:X1<0 X1=-X1 S:$E(X)="X" X2=X1,X=$E(X,2,99) I 'X2,$E(X)="O" S X2=.5,X=$E(X,2,99)
"RTN","PSSJSV",19,0)
 S XT=$S(X["'":1,(X["D"&(X'["AD"))!(X["AM")!(X["PM")!(X["HS"&(X'["THS")):1440,X["H"&(X'["TH"):60,X["AC"!(X["PC"):480,X["W":10080,X["M":40320,1:-1) I XT<0,PSJAT="" K X G DONE
"RTN","PSSJSV",20,0)
 S X=PSJX I XT S:X2 XT=XT\X2 S:'X2 XT=XT*X1
"RTN","PSSJSV",21,0)
 S PSJM=XT
"RTN","PSSJSV",22,0)
 ;
"RTN","PSSJSV",23,0)
DONE ;
"RTN","PSSJSV",24,0)
 K:$D(X)[0 PSJX K D,DIC,Q,QX,SDW,SWD,X,X0,X1,X2,XT,Y,Z Q
"RTN","PSSJSV",25,0)
 ;
"RTN","PSSJSV",26,0)
ENCHK ; admin times
"RTN","PSSJSV",27,0)
 N SCHED
"RTN","PSSJSV",28,0)
 I $S($L($P(X,"-"))>4:1,$L(X)>119:1,$L(X)<2:1,X'>0:1,1:X'?.ANP) K X Q
"RTN","PSSJSV",29,0)
 S X(1)=$P(X,"-") I X(1)'?2N,X(1)'?4N K X Q
"RTN","PSSJSV",30,0)
 S X(1)=$L(X(1)) F X(2)=2:1:$L(X,"-") S X(3)=$P(X,"-",X(2)) I $S($L(X(3))'=X(1):1,X(3)>$S(X(1)=2:24,1:2400):1,1:X(3)'>$P(X,"-",X(2)-1)) K X Q
"RTN","PSSJSV",31,0)
 Q:'$D(X)
"RTN","PSSJSV",32,0)
 S X(1)=$L(X,"-")
"RTN","PSSJSV",33,0)
 S SCHED=$S($G(DA(1)):$$GET1^DIQ(52.61,+$G(DA)_","_DA(1),4),$G(DA):$$GET1^DIQ(52.6,+DA,4),1:"")
"RTN","PSSJSV",34,0)
 Q:(SCHED="")
"RTN","PSSJSV",35,0)
 S IENS=$O(^PS(51.1,"B",SCHED,0))
"RTN","PSSJSV",36,0)
 S X(4)=$S($G(PSSJSE)&($G(PSSSCT)]""):PSSSCT,1:$$GET1^DIQ(51.1,IENS,5,"I"))
"RTN","PSSJSV",37,0)
 I X(4)="D" D  Q  ;DOW schedules require at least one admin time
"RTN","PSSJSV",38,0)
 . I X(1)>0 K:$D(X) X(1),X(2),X(3) Q
"RTN","PSSJSV",39,0)
 . K X
"RTN","PSSJSV",40,0)
 I X(4)="O" D  Q
"RTN","PSSJSV",41,0)
 . I $L(X,"-")>1 K X Q  ;One Time schedules allow one admin time
"RTN","PSSJSV",42,0)
 . I X="" K X Q  ;One Time schedules require one admin time
"RTN","PSSJSV",43,0)
 S X(2)=$S($G(PSSJSE)&($G(PSSFRQ)):PSSFRQ,1:$$GET1^DIQ(51.1,IENS,2,"I"))
"RTN","PSSJSV",44,0)
 I X(2)="" K:$D(X) X(1),X(2),X(3) Q
"RTN","PSSJSV",45,0)
 I X(2)>0,X(2)<1440,(1440/X(2))'=X(1) K X Q  ;PSS*1*143 Admin times must match frequency
"RTN","PSSJSV",46,0)
 I X(2)>0,X(2)<1440,(1440#X(2))'=0,X(1)>0 K X Q  ;PSS*1*143 Odd schedules cannot have admin times
"RTN","PSSJSV",47,0)
 I X(2)>1440,(X(2)#1440)'=0,X(1)>1 K X Q  ;PSS*1*143 Odd schedules cannot have admin times
"RTN","PSSJSV",48,0)
 I X(2)>1439,$L(X,"-")'=1 K X Q  ;PSS*1*143 Schedules with frequency equal to or greater than 1 day can only have one admin time.
"RTN","PSSJSV",49,0)
 K:$D(X) X(1),X(2),X(3)
"RTN","PSSJSV",50,0)
 Q
"RTN","PSSJSV",51,0)
 ;
"RTN","PSSJSV",52,0)
DIC ; 51.1 look-up
"RTN","PSSJSV",53,0)
 S DIC="^PS(51.1,",DIC(0)=$E("E",'$D(PSJNE))_"ISZ",DIC("W")="I '$D(PSJNE) D DICW^PSSJSV0",D="AP"_PSJPP
"RTN","PSSJSV",54,0)
 D IX^DIC K DIC Q:Y'>0  S PSJY=+Y,(PSJX,X,X0)=Y(0,0),PSJM=$P(Y(0),"^",3),PSJTS=$P(Y(0),"^",5),PSJAX=$P(Y(0),U,7) S:PSJTS="" PSJTS="C" Q:PSJTS="O"!(PSJTS["R")  I $D(PSJW),$D(^PS(51.1,+Y,1,+PSJW,0)) S PSJAT=$P(^(0),"^",PSJTS="S"+2)
"RTN","PSSJSV",55,0)
 E  S PSJAT=$P(Y(0),"^",PSJTS="S"*4+2)
"RTN","PSSJSV",56,0)
 Q:PSJTS'="S"
"RTN","PSSJSV",57,0)
 F Y=1:1:$L(PSJAT,"-") S Y(1)=$P(PSJAT,"-",Y),PSJAT(Y(1))="",Y(2)=$O(^PS(51.15,"ACP",PSJPP,Y(1),0)) I Y(2),$D(^PS(51.15,Y(2),0)) S PSJAT(Y(1))=$P(^(0),"^",3) I $D(PSJW),$D(^(1,PSJW,0)),$P(^(0),"^",2)]"" S PSJAT(Y(1))=$P(^(0),"^",2)
"RTN","PSSJSV",58,0)
 Q
"RTN","PSSJSV",59,0)
 ;
"RTN","PSSJSV",60,0)
DW ;  week days
"RTN","PSSJSV",61,0)
 S SWD="SUNDAYS^MONDAYS^TUESDAYS^WEDNESDAYS^THURSDAYS^FRIDAYS^SATURDAYS",SDW=X,X=$P(X,"@",2) D ENCHK Q:'$D(X)
"RTN","PSSJSV",62,0)
 S X=$P(SDW,"@"),X(1)="-" I X?.E1P.E,X'["-" F QX=1:1:$L(X) I $E(X,QX)?1P S X(1)=$E(X,QX) Q
"RTN","PSSJSV",63,0)
 F Q=1:1:$L(X,X(1)) K:SWD="" X Q:SWD=""  S Z=$P(X,X(1),Q) D DWC Q:'$D(X)
"RTN","PSSJSV",64,0)
 K X(1) S:$D(X) X=SDW Q
"RTN","PSSJSV",65,0)
DWC I $L(Z)<2 K X Q
"RTN","PSSJSV",66,0)
 F QX=1:1:$L(SWD,"^") S Y=$P(SWD,"^",QX) I $P(Y,Z)="" S SWD=$P(SWD,Y,2) S:$L(SWD) SWD=$E(SWD,2,50) Q
"RTN","PSSJSV",67,0)
 E  K X
"RTN","PSSJSV",68,0)
 Q
"RTN","PSSJSV",69,0)
 ;
"RTN","PSSJSV",70,0)
ENSNV ; schedule name
"RTN","PSSJSV",71,0)
 I $S(X["""":1,$A(X)=45:1,X'?.ANP:1,$L(X)>20:1,$L(X)<2:1,1:X?1P.E) K X Q
"RTN","PSSJSV",72,0)
 I $S('$D(PSJPP):0,PSJPP="":1,PSJPP'?.ANP:1,1:'$$VERSION^XPDUTL(PSJPP)) K X
"RTN","PSSJSV",73,0)
 I $D(DA),$D(^PS(51.1,DA,0)),$P(^(0),"^",5)["D" S ZX=X D DNVX S:$D(X) X=ZX K Z1,Z2,Z3,Z4,ZX
"RTN","PSSJSV",74,0)
 Q
"RTN","PSSJSV",75,0)
 ;
"RTN","PSSJSV",76,0)
ENSHV ;  shift in 51.1
"RTN","PSSJSV",77,0)
 I $S($L(X)>11:1,$L(X)<1:1,'$D(PSJPP):1,PSJPP="":1,PSJPP'?.ANP:1,1:'$$VERSION^XPDUTL(PSJPP)) K X Q
"RTN","PSSJSV",78,0)
 F X(1)=1:1:$L(X,"-") S X(2)=$P(X,"-",X(1)) I $S(X(2)="":1,X(2)'?.ANP:1,1:'$D(^PS(51.15,"ACP",PSJPP,X(2)))) K X Q
"RTN","PSSJSV",79,0)
 K X(1),X(2) Q
"RTN","PSSJSV",80,0)
 ;
"RTN","PSSJSV",81,0)
ENVSST ;  shift start/stop times
"RTN","PSSJSV",82,0)
 I X'?2N1"-"2N,X'?4N1"-"4N K X Q
"RTN","PSSJSV",83,0)
 F X(1)=1,2 I $P(X,"-",X(1))>$S($L($P(X,"-",X(1)))<4:24,1:2400) K X Q
"RTN","PSSJSV",84,0)
 K X(1) Q
"RTN","PSSJSV",85,0)
 ;
"RTN","PSSJSV",86,0)
ENFQD ; frequency default
"RTN","PSSJSV",87,0)
 N X1,X2,Z S Z=$S($D(^PS(51.1,DA,0)):$P(^(0),"^"),1:""),X=""
"RTN","PSSJSV",88,0)
 S X=$P(Z,"^",3) I Z]"" Q
"RTN","PSSJSV",89,0)
 S Z=DA I $E(Z,1,2)="AD" Q
"RTN","PSSJSV",90,0)
 I $E(Z,1,3)="BID"!($E(Z,1,3)="TID")!($E(Z,1,3)="QID") S X=1440/$F("BTQ",$E(Z)) Q
"RTN","PSSJSV",91,0)
 E  S:$E(Z)="Q" Z=$E(Z,2,99) S:'Z Z="1"_Z S X1=+Z,Z=$P(Z,+Z,2),X2=0 S:$E(Z)="X" X2=X1,Z=$E(Z,2,99) I 'X2,$E(Z)="O" S X2=.5,Z=$E(Z,2,99)
"RTN","PSSJSV",92,0)
 S X=$S(Z["'":1,(Z["D"&(Z'["AD"))!(Z["AM")!(Z["PM")!(Z["HS"&(Z'["THS")):1440,Z["H"&(Z'["TH"):60,Z["AC"!(Z["PC"):480,Z["W":10080,Z["M":40320,1:"") Q:'X  S:X2 X=X\X2 S:'X2 X=X*X1 Q
"RTN","PSSJSV",93,0)
 ;
"RTN","PSSJSV",94,0)
ENFREQ ; validate frequency
"RTN","PSSJSV",95,0)
 K:+X'=X!(X>525600)!(X<1)!(X?.E1"."1N.N) X
"RTN","PSSJSV",96,0)
 Q
"RTN","PSSJSV",97,0)
 ;
"RTN","PSSJSV",98,0)
DFCHK ; validate dosing check frequency **pss_1_201**
"RTN","PSSJSV",99,0)
 N PSSX1,PSSX2 S PSSX1="",X=$$UP^XLFSTR(X),PSSX2=$E(X,$L(X))
"RTN","PSSJSV",100,0)
 ;
"RTN","PSSJSV",101,0)
 I $L(X)>4!($L(X)<3) K X Q
"RTN","PSSJSV",102,0)
 ;
"RTN","PSSJSV",103,0)
 I '+($E(X,2)) K X Q
"RTN","PSSJSV",104,0)
 I $L(X)=4 S PSSX1=($E(X,2,3)) I PSSX1'?.N K X Q
"RTN","PSSJSV",105,0)
 ;
"RTN","PSSJSV",106,0)
 I $L(X)=3,$E(X,1)="Q",PSSX2="L",$E(X,2)'<7 K X Q
"RTN","PSSJSV",107,0)
 I $G(PSSX1),$E(X,1)="Q",PSSX2="L",PSSX1'<7 K X Q
"RTN","PSSJSV",108,0)
 I $G(PSSX1),$E(X,1)="Q",PSSX2="W",PSSX1'<29 K X Q
"RTN","PSSJSV",109,0)
 ;
"RTN","PSSJSV",110,0)
 I $E(X,1)="Q"&(PSSX2="H"!(PSSX2="D")!(PSSX2="W")!(PSSX2="L")) Q
"RTN","PSSJSV",111,0)
 I $E(X,1)="X"&(PSSX2="D"!(PSSX2="W")!(PSSX2="L")) Q
"RTN","PSSJSV",112,0)
 E  K X Q
"RTN","PSSJSV",113,0)
 ;
"RTN","PSSJSV",114,0)
HPDCHK ; help prompt with specified formats for the dosing check frequency fields **pss_1_201**
"RTN","PSSJSV",115,0)
 N MSG,PSSHFLG S (MSG,PSSHFLG)=""
"RTN","PSSJSV",116,0)
 ;
"RTN","PSSJSV",117,0)
 I $G(X)="??" S PSSHFLG=1
"RTN","PSSJSV",118,0)
 ;
"RTN","PSSJSV",119,0)
 I 'PSSHFLG D  Q
"RTN","PSSJSV",120,0)
 .S MSG(1)="     The numeric limit is 99, except for the following formats:"
"RTN","PSSJSV",121,0)
 .S MSG(2)=""
"RTN","PSSJSV",122,0)
 .S MSG(3)="     Q#W - Maximum 28 weeks allowed"
"RTN","PSSJSV",123,0)
 .S MSG(4)="     Q#L - Maximum 6 months allowed"
"RTN","PSSJSV",124,0)
 .S MSG(5)=""
"RTN","PSSJSV",125,0)
 .S MSG(6)="     Enter '??' to view the available dosing check frequency formats"
"RTN","PSSJSV",126,0)
 .S MSG(7)="     for this field."
"RTN","PSSJSV",127,0)
 .S MSG(8)=""
"RTN","PSSJSV",128,0)
 .D EN^DDIOL(.MSG,"","!")
"RTN","PSSJSV",129,0)
 Q
"RTN","PSSJSV",130,0)
 ;
"RTN","PSSJSV",131,0)
OASCHK ; check the 'D' cross reference to see if duplicates exist **pss_1_201**
"RTN","PSSJSV",132,0)
 N MSG,PSSCNT,PSSD,PSSFLG,PSSDA,PSSDONE,PSSAIEN S (MSG,PSSAIEN)="",(PSSCNT,PSSD,PSSFLG)=0,PSSDA=$G(DA),PSSDONE=$G(DA(1))
"RTN","PSSJSV",133,0)
 ;
"RTN","PSSJSV",134,0)
 I $G(X)="@" S PSSD=1,DIR(0)="YAO",DIR("A")="SURE YOU WANT TO DELETE? " D ^DIR
"RTN","PSSJSV",135,0)
 I $G(Y)=1 F  S PSSCNT=$O(^PS(51.1,$G(DA),5,PSSCNT)) Q:PSSCNT=""!(PSSFLG=1)  D
"RTN","PSSJSV",136,0)
 .I $G(^PS(51.1,$G(DA),5,PSSCNT,0))=$P(PSSRN,"//",1) S PSSFLG=1 S DIE=DIC,DA(1)=$G(DA),DA=PSSCNT,DR=".01///@" D ^DIE K DIR,X
"RTN","PSSJSV",137,0)
 .S DA=PSSDA,DA(1)=PSSDONE,PSSRN=$$OASLE^PSSOAS(DA),DIC("A")="Select OLD SCHEDULE NAME(S): "_$G(PSSRN)
"RTN","PSSJSV",138,0)
 I $G(PSSD)=1 K X Q
"RTN","PSSJSV",139,0)
 I $L($G(X))>20!($L($G(X))<2) D EN^DDIOL("Answer must be 2-20 characters in length.","","!") K X Q
"RTN","PSSJSV",140,0)
 ;
"RTN","PSSJSV",141,0)
 S X=$$UP^XLFSTR($G(X))
"RTN","PSSJSV",142,0)
 ;
"RTN","PSSJSV",143,0)
 N PSSRCHK,PSSRFL,MSG S (PSSRCHK,PSSRFL)=""
"RTN","PSSJSV",144,0)
 F  S PSSRCHK=$O(^PS(51.1,"D",PSSRCHK)) Q:PSSRCHK']""!($G(PSSRFL))  D
"RTN","PSSJSV",145,0)
 .I PSSRCHK=$G(X) S PSSRFL=1 F  S PSSAIEN=$O(^PS(51.1,"D",PSSRCHK,PSSAIEN)) Q:PSSAIEN'=""
"RTN","PSSJSV",146,0)
 I $G(PSSRFL)=1,$G(PSSAIEN)'=$G(PSSDA) K X D  Q
"RTN","PSSJSV",147,0)
 .S MSG(1)=""
"RTN","PSSJSV",148,0)
 .S MSG(2)="      Duplicate exists in Old Schedule Name multiple for the entry"
"RTN","PSSJSV",149,0)
 .S MSG(3)="      "_$P(^PS(51.1,$G(PSSAIEN),0),U,1)_" ("_$G(PSSAIEN)_") in the file.  Please enter a new name."
"RTN","PSSJSV",150,0)
 .D EN^DDIOL(.MSG,"","!")
"RTN","PSSJSV",151,0)
 ;
"RTN","PSSJSV",152,0)
 N PSSMCHK,PSSMFL S PSSMCHK="",PSSMFL=0
"RTN","PSSJSV",153,0)
 I $G(Y)=-1,$G(DA) F  S PSSMCHK=$O(^PS(51.1,$G(DA),5,PSSMCHK)) Q:PSSMCHK']""!($G(PSSMFL))  D
"RTN","PSSJSV",154,0)
 .I $G(^PS(51.1,$G(DA),5,PSSMCHK,0))=$G(X) S PSSMFL=1
"RTN","PSSJSV",155,0)
 I $G(PSSMFL)=1 K X Q
"RTN","PSSJSV",156,0)
 Q
"RTN","PSSJSV",157,0)
 ;
"RTN","PSSJSV",158,0)
ENDNV ; day of the week name
"RTN","PSSJSV",159,0)
 N Z1,Z2,Z3,Z4,PSSDASH,PSSTIME,PSSXTIME,PSSTIMCT
"RTN","PSSJSV",160,0)
 S X=$S($D(^PS(51.1,DA,0)):$P(^(0),"^"),1:"") I X="" K X Q
"RTN","PSSJSV",161,0)
 ;
"RTN","PSSJSV",162,0)
DNVX ; validate day of the week name
"RTN","PSSJSV",163,0)
 S Z2=1,Z4="-" I X'["-",X?.E1P.E F Z1=1:1:$L(X) I $E(X,Z1)?1P S Z4=$E(X,Z1) Q
"RTN","PSSJSV",164,0)
 F Z1=1:1:$L(X,Z4) Q:'Z2  S Z2=0 I $L($P(X,Z4,Z1))>1 F Z3="MONDAYS","TUESDAYS","WEDNESDAYS","THURSDAYS","FRIDAYS","SATURDAYS","SUNDAYS" I $P(Z3,$P(X,Z4,Z1))="" S Z2=1 Q
"RTN","PSSJSV",165,0)
 I Z2=0 K X
"RTN","PSSJSV",166,0)
 S PSSXTIME=$P(ZX,"@",2),PSSDASH=$L(PSSXTIME,"-")
"RTN","PSSJSV",167,0)
 F PSSTIMCT=1:1:PSSDASH S PSSTIME=$P(PSSXTIME,"-",PSSTIMCT)
"RTN","PSSJSV",168,0)
 I $L(PSSTIME)>4 K X
"RTN","PSSJSV",169,0)
 I '$D(X) S PSSDOW=1
"RTN","PSSJSV",170,0)
 S:Z2 X="D"
"RTN","PSSJSV",171,0)
 Q
"RTN","PSSJSV",172,0)
 ;
"RTN","PSSJSV",173,0)
ENPSJ ;validate schedule names for PSJ package **pss_1_201**
"RTN","PSSJSV",174,0)
 N A,B,I,PSSCNT,PSSFLG SET (PSSFLG,PSSDOW)=0
"RTN","PSSJSV",175,0)
 ;
"RTN","PSSJSV",176,0)
 S X=$$UP^XLFSTR(X)
"RTN","PSSJSV",177,0)
 I $G(X)'="",+$G(Y) D OASCHK I $G(X)="" Q
"RTN","PSSJSV",178,0)
 I $G(PSSON)'="",$G(X)'=$G(PSSON) D ENOAS(PSSON,X)
"RTN","PSSJSV",179,0)
 ;
"RTN","PSSJSV",180,0)
 I $G(PSJPP)'="PSJ" Q
"RTN","PSSJSV",181,0)
 S A=$TR(X,".","") I A="OTHER" K X Q
"RTN","PSSJSV",182,0)
 F I=1:1:$L(A," ") S B=$P(A," ",I) I B="QD"!(B="QOD")!(B="HS")!(B="TIW") K X ;;>> *149 RJS
"RTN","PSSJSV",183,0)
 Q:'$D(X)
"RTN","PSSJSV",184,0)
 S DOW=0,ZX=X S X=$P(X,"@") D DNVX I $G(X)="" S X=ZX K ZX
"RTN","PSSJSV",185,0)
 I X="D" S X=ZX,DOW=1 D:X["@" CHKORD I $D(X),$G(PSSCNT)>1 D  S:'$D(X) X=ZX K Z1,Z2,Z3,Z4,ZX
"RTN","PSSJSV",186,0)
 .N MSG
"RTN","PSSJSV",187,0)
 .S MSG(1)="",MSG(2)="The day of the week schedule must be in the correct day of week order."
"RTN","PSSJSV",188,0)
 .S MSG(3)="The correct order is: SU-MO-TU-WE-TH-FR-SA"
"RTN","PSSJSV",189,0)
 .D EN^DDIOL(.MSG,"","!")
"RTN","PSSJSV",190,0)
 .Q
"RTN","PSSJSV",191,0)
 ;
"RTN","PSSJSV",192,0)
ENOAS(PSSOLD,PSSX) ; entry for new OLD SCHEDULE NAME(S) into the multiple **pss_1_201**
"RTN","PSSJSV",193,0)
 N PSSMCHK,PSSRCHK,PSSBCHK,PSSCCHK,PSSMFL,PSSRFL,PSSBFL,PSSNNM,PSSDA,MSG S (PSSRCHK,PSSBCHK,MSG)="",(PSSMCHK,PSSCCHK,PSSMFL,PSSRFL,PSSBFL)=0,PSSNNM=$$UP^XLFSTR($G(X)),PSSDA=$G(DA)
"RTN","PSSJSV",194,0)
 N PSSCHK,PSSAIEN,PSSDFL S (PSSCHK,PSSAIEN)="",PSSDFL=0
"RTN","PSSJSV",195,0)
 ;
"RTN","PSSJSV",196,0)
 I $G(DA) F  S PSSMCHK=$O(^PS(51.1,$G(DA),5,PSSMCHK)) Q:'+PSSMCHK!($G(PSSMFL))  D
"RTN","PSSJSV",197,0)
 .I $G(^PS(51.1,$G(DA),5,PSSMCHK,0))=$G(PSSX) S PSSMFL=1
"RTN","PSSJSV",198,0)
 I $G(PSSMFL)=1 S X=$G(PSSOLD) D  Q
"RTN","PSSJSV",199,0)
 .S MSG(1)=""
"RTN","PSSJSV",200,0)
 .S MSG(2)="A duplicate exists in the OLD SCHEDULE NAME(S) multiple for this entry."
"RTN","PSSJSV",201,0)
 .S MSG(3)=""
"RTN","PSSJSV",202,0)
 .D EN^DDIOL(.MSG,"","!")
"RTN","PSSJSV",203,0)
 ;
"RTN","PSSJSV",204,0)
 I $G(X)'="" F  S PSSCHK=$O(^PS(51.1,"D",PSSCHK)) Q:PSSCHK=""!($G(PSSDFL))  D
"RTN","PSSJSV",205,0)
 .I $G(PSSCHK)=$G(X) S PSSDFL=1 F  S PSSAIEN=$O(^PS(51.1,"D",PSSCHK,PSSAIEN)) Q:PSSAIEN'=""
"RTN","PSSJSV",206,0)
 .I $G(PSSDFL)=1 S X=$G(PSSOLD) D  Q
"RTN","PSSJSV",207,0)
 ..S MSG(1)=""
"RTN","PSSJSV",208,0)
 ..S MSG(2)="A duplicate exists in the OLD SCHEDULE NAME(S) multiple for the entry"
"RTN","PSSJSV",209,0)
 ..S MSG(3)=$P(^PS(51.1,$G(PSSAIEN),0),U,1)_" ("_$G(PSSAIEN)_")."
"RTN","PSSJSV",210,0)
 ..S MSG(4)=""
"RTN","PSSJSV",211,0)
 ..D EN^DDIOL(.MSG,"","!")
"RTN","PSSJSV",212,0)
 ;
"RTN","PSSJSV",213,0)
 I $G(X)["""" F  S PSSBCHK=$O(^PS(51.1,"B",PSSBCHK)) Q:PSSBCHK']""!($G(PSSBFL))  D
"RTN","PSSJSV",214,0)
 .I $G(PSSBCHK)=$G(PSSOLD) S PSSBFL=1
"RTN","PSSJSV",215,0)
 ;
"RTN","PSSJSV",216,0)
 I $G(X)'["""" F  S PSSBCHK=$O(^PS(51.1,"B",PSSBCHK)) Q:PSSBCHK']""!($G(PSSBFL))  D
"RTN","PSSJSV",217,0)
 .F  S PSSCCHK=$O(^PS(51.1,"B",PSSBCHK,PSSCCHK)) Q:PSSCCHK']""!($G(PSSBFL))  D
"RTN","PSSJSV",218,0)
 ..I $G(PSSBCHK)=$G(PSSOLD),$G(PSSCCHK)'=$G(DA) S PSSBFL=1
"RTN","PSSJSV",219,0)
 ;
"RTN","PSSJSV",220,0)
 F  S PSSRCHK=$O(^PS(51.1,"D",PSSRCHK)) Q:PSSRCHK']""!($G(PSSRFL))  D
"RTN","PSSJSV",221,0)
 .I $G(PSSRCHK)=$G(PSSOLD) S PSSRFL=1
"RTN","PSSJSV",222,0)
 I '$G(PSSMFL),'$G(PSSRFL),'$G(PSSBFL),'$G(PSSDFL),$G(DA),$G(X)'="",$G(X)'?." " K DO S X=$G(PSSON),DA(1)=$G(DA),DIC=DIC_DA(1)_",5,",DIC(0)="L" D FILE^DICN S X=PSSNNM,DIC="^PS(51.1,"
"RTN","PSSJSV",223,0)
 ;
"RTN","PSSJSV",224,0)
 Q
"RTN","PSSJSV",225,0)
 ;
"RTN","PSSJSV",226,0)
SCRN ;LOGIC TO SCREEN OUT @ IF NOT DAILY
"RTN","PSSJSV",227,0)
 S (PSSFLG,PSSDFLG,PSSTFLG,PSSAFLG)=0
"RTN","PSSJSV",228,0)
 Q:X'["@"
"RTN","PSSJSV",229,0)
 I $G(PSSCNT) K PSSCNT,X Q
"RTN","PSSJSV",230,0)
 D DAYS,TIMECHK
"RTN","PSSJSV",231,0)
 I $L(X)<2!($L(X)>20) D MSG1
"RTN","PSSJSV",232,0)
 I $G(PSSAFLG) D MSG4
"RTN","PSSJSV",233,0)
 I $G(PSSTFLG) D MSG3
"RTN","PSSJSV",234,0)
 I $G(PSSDFLG) D MSG2
"RTN","PSSJSV",235,0)
 I $G(PSSFLG) S MSG(4)="",MSG(5)="  "_X D EN^DDIOL(.MSG,"","!") K MSG
"RTN","PSSJSV",236,0)
 K:$G(PSSFLG) X
"RTN","PSSJSV",237,0)
 K PSSFLG,PSSDFLG,PSSTFLG,PSSAFLG
"RTN","PSSJSV",238,0)
 Q
"RTN","PSSJSV",239,0)
 ;
"RTN","PSSJSV",240,0)
ENPSJT ; Validate schedule type (one-time PRN conflict)
"RTN","PSSJSV",241,0)
 N A,B
"RTN","PSSJSV",242,0)
 S A=$$GET1^DIQ(51.1,DA,.01),B=""
"RTN","PSSJSV",243,0)
 I A["PRN",X'="P" D
"RTN","PSSJSV",244,0)
 . S B="Conflict: Schedule Name contains PRN but selected Schedule Type is not PRN."
"RTN","PSSJSV",245,0)
 . K X
"RTN","PSSJSV",246,0)
 I A'["PRN",X="P" D
"RTN","PSSJSV",247,0)
 . S B="Conflict: Schedule Name does not contain PRN but selected Schedule Type is PRN."
"RTN","PSSJSV",248,0)
 . K X
"RTN","PSSJSV",249,0)
 I $G(X)="D",$G(PSSDOW) D
"RTN","PSSJSV",250,0)
 . S B="Conflict: Schedule Name contains free text but selected Schedule Type is Day of the Week."
"RTN","PSSJSV",251,0)
 . K X
"RTN","PSSJSV",252,0)
 I $L(B)>0 D EN^DDIOL(.B,"","!") Q
"RTN","PSSJSV",253,0)
 S A=$$GET1^DIQ(51.1,DA,2),B=""
"RTN","PSSJSV",254,0)
 Q
"RTN","PSSJSV",255,0)
 ;
"RTN","PSSJSV",256,0)
CHKORD ;Check order of days in DOW schedule name
"RTN","PSSJSV",257,0)
 N I,J,L,N,P,W
"RTN","PSSJSV",258,0)
 S N=$P(X,"@"),L=0,P=$L(N,"-"),W="SUNDAYS,MONDAYS,TUESDAYS,WEDNESDAYS,THURSDAYS,FRIDAYS,SATURDAYS",PSSCNT=0
"RTN","PSSJSV",259,0)
 F I=1:1:P F J=1:1:7 I $P(W,",",J)=$P(N,"-",I) K:J'>L X Q:'$D(X)  S:J>L L=J,PSSCNT=PSSCNT+1
"RTN","PSSJSV",260,0)
 Q
"RTN","PSSJSV",261,0)
 ;
"RTN","PSSJSV",262,0)
RMTIME ;Remove ward times when schedule becomes odd
"RTN","PSSJSV",263,0)
 N R
"RTN","PSSJSV",264,0)
 S R=0 F  S R=$O(^PS(51.1,D0,1,R)) Q:R=""  K ^PS(51.1,D0,1,R)
"RTN","PSSJSV",265,0)
 Q
"RTN","PSSJSV",266,0)
DAYS ; check days of week for correct order sequence
"RTN","PSSJSV",267,0)
 N PSSD2,PSSD3,PSSD4,PSSD1,PSSD5,PSSD6,PSSFND
"RTN","PSSJSV",268,0)
 S PSSD1=$P(X,"@"),PSSD4=0,PSSD5=$L(PSSD1,"-"),PSSD6="SU,MO,TU,WE,TH,FR,SA",PSSFND=0
"RTN","PSSJSV",269,0)
 F PSSD2=1:1:PSSD5 Q:'$D(PSSD1)  D
"RTN","PSSJSV",270,0)
 .F PSSD3=1:1:7 D  Q:'$D(PSSD1)
"RTN","PSSJSV",271,0)
 ..I $P(PSSD6,",",PSSD3)=$P(PSSD1,"-",PSSD2) K:PSSD3'>PSSD4 PSSD1 Q:'$D(PSSD1)  S PSSFND=PSSFND+1 S:PSSD3>PSSD4 PSSD4=PSSD3
"RTN","PSSJSV",272,0)
 ..I $L($P(PSSD1,"-",PSSD2))>2 K PSSD1
"RTN","PSSJSV",273,0)
 .K:PSSFND'=PSSD2 PSSD1
"RTN","PSSJSV",274,0)
 I ('$D(PSSD1)!('$D(PSSFND))) S PSSDFLG=1
"RTN","PSSJSV",275,0)
 Q
"RTN","PSSJSV",276,0)
MSG1 ; max length exceeded message
"RTN","PSSJSV",277,0)
 S MSG(1)="",MSG(2)="The Administration Schedule you entered has "_$L(X)_" characters."
"RTN","PSSJSV",278,0)
 S MSG(3)="Answer must be 2-20 characters in length."
"RTN","PSSJSV",279,0)
 D EN^DDIOL(.MSG,"","!")
"RTN","PSSJSV",280,0)
 S PSSFLG=1
"RTN","PSSJSV",281,0)
 K MSG
"RTN","PSSJSV",282,0)
 Q
"RTN","PSSJSV",283,0)
MSG2 ; day of week order squence message
"RTN","PSSJSV",284,0)
 S MSG(1)="",MSG(2)="The day of the week schedule must be in the correct day of week order."
"RTN","PSSJSV",285,0)
 S MSG(3)="The correct order is: SU-MO-TU-WE-TH-FR-SA"
"RTN","PSSJSV",286,0)
 D EN^DDIOL(.MSG,"","!")
"RTN","PSSJSV",287,0)
 S PSSFLG=1
"RTN","PSSJSV",288,0)
 K MSG
"RTN","PSSJSV",289,0)
 Q
"RTN","PSSJSV",290,0)
MSG3 ; time input message
"RTN","PSSJSV",291,0)
 S MSG(1)="",MSG(2)="The time must be between 0001 - 2400."
"RTN","PSSJSV",292,0)
 S MSG(3)="A correct time entry would be: 0800-1200-1600 etc."
"RTN","PSSJSV",293,0)
 D EN^DDIOL(.MSG,"","!")
"RTN","PSSJSV",294,0)
 S PSSFLG=1
"RTN","PSSJSV",295,0)
 K MSG
"RTN","PSSJSV",296,0)
 Q
"RTN","PSSJSV",297,0)
MSG4 ; time sequence message
"RTN","PSSJSV",298,0)
 S MSG(1)="",MSG(2)="The time must be entered in ascending order."
"RTN","PSSJSV",299,0)
 S MSG(3)="A correct time entry would be: 0800-1200-1600 etc."
"RTN","PSSJSV",300,0)
 D EN^DDIOL(.MSG,"","!")
"RTN","PSSJSV",301,0)
 S PSSFLG=1
"RTN","PSSJSV",302,0)
 K MSG
"RTN","PSSJSV",303,0)
 Q
"RTN","PSSJSV",304,0)
TIMECHK ; time validation
"RTN","PSSJSV",305,0)
 N PSSXTIME,PSSTLN,PSSLOOP,PSSTCHR,PSSDASH,PSSLEN,PSSTCHK,PSSTIMCT,PSSTIME
"RTN","PSSJSV",306,0)
 I $L(X,"@")>2 S (PSSDFLG,PSSTFLG)=1 Q
"RTN","PSSJSV",307,0)
 S PSSXTIME=$P(X,"@",2),PSSTLN=$L(PSSXTIME),PSSTFLG=0,PSSDASH=$L(PSSXTIME,"-")
"RTN","PSSJSV",308,0)
 I PSSXTIME=0 S PSSTFLG=1 Q
"RTN","PSSJSV",309,0)
 F PSSTIMCT=1:1:PSSDASH S PSSTIME=$P(PSSXTIME,"-",PSSTIMCT) D
"RTN","PSSJSV",310,0)
 .S PSSTCHK(PSSTIMCT)=PSSTIME,PSSLEN=$L(PSSTIME)
"RTN","PSSJSV",311,0)
 .I $L(PSSTCHK(PSSTIMCT))=2 S PSSTCHK(PSSTIMCT)=PSSTCHK(PSSTIMCT)_"00"
"RTN","PSSJSV",312,0)
 .F PSSLOOP=1:1:PSSLEN D
"RTN","PSSJSV",313,0)
 ..S PSSTCHR=$E(PSSTIME,PSSLOOP)
"RTN","PSSJSV",314,0)
 ..I $A(PSSTCHR)<48!($A(PSSTCHR)>57) S PSSTFLG=1
"RTN","PSSJSV",315,0)
 .I ((PSSTIME<1)!(PSSLEN=1)!(PSSLEN=3)!(PSSLEN>4)) S PSSTFLG=1
"RTN","PSSJSV",316,0)
 F PSSTIMCT=1:1:PSSDASH D
"RTN","PSSJSV",317,0)
 .I $G(PSSTCHK(PSSTIMCT+1)),PSSTCHK(PSSTIMCT)>PSSTCHK(PSSTIMCT+1) S PSSAFLG=1
"RTN","PSSJSV",318,0)
 .I $L(PSSTCHK(PSSTIMCT))=4 D
"RTN","PSSJSV",319,0)
 ..I $E(PSSTCHK(PSSTIMCT),1,4)>2400 S PSSTFLG=1
"RTN","PSSJSV",320,0)
 ..I $E(PSSTCHK(PSSTIMCT),1,2)<24 D
"RTN","PSSJSV",321,0)
 ...I $E(PSSTCHK(PSSTIMCT),3,4)>59 S PSSTFLG=1
"RTN","PSSJSV",322,0)
 Q
"RTN","PSSPOIMO")
0^1^B143564555^B142972365
"RTN","PSSPOIMO",1,0)
PSSPOIMO ;BIR/RTR/WRT-Edit Orderable Item Name and Inactive date ;05/12/17  07:11
"RTN","PSSPOIMO",2,0)
 ;;1.0;PHARMACY DATA MANAGEMENT;**29,32,38,47,68,102,125,141,153,159,166,172,191,189,204,210**;9/30/97;Build 9
"RTN","PSSPOIMO",3,0)
 S PSSITE=+$O(^PS(59.7,0)) I +$P($G(^PS(59.7,PSSITE,80)),"^",2)<2 W !!?3,"Orderable Item Auto-Create has not been completed yet!",! K PSSITE K DIR S DIR("A")="Press RETURN to continue",DIR(0)="E" D ^DIR K DIR Q
"RTN","PSSPOIMO",4,0)
 K PSSITE W !!,"This option enables you to edit Orderable Item names, Formulary status,",!,"drug text, Inactive Dates, Indications for Use, and Synonyms."
"RTN","PSSPOIMO",5,0)
EN I $D(PSOIEN) L -^PS(50.7,PSOIEN)
"RTN","PSSPOIMO",6,0)
 K PSSCROSS,DTOUT,DUOUT,DIRUT
"RTN","PSSPOIMO",7,0)
 K DIC ; S PY=$P($G(^PS(59.7,1,31)),"^",2)
"RTN","PSSPOIMO",8,0)
 S PSS1="W ""  ""_$P(^PS(50.606,$P(^PS(50.7,+Y,0),""^"",2),0),""^"")_""  ""_$S($P($G(^PS(50.7,+Y,0)),""^"",4):$E($P(^(0),""^"",4),4,5)_""-""_$E($P(^(0),""^"",4),6,7)_""-""_$E($P(^(0),""^"",4),2,3),1:"""")"
"RTN","PSSPOIMO",9,0)
 S PSS2=" S NF=$P($G(^PS(50.7,+Y,0)),""^"",12) I NF S NF=""   N/F"" W NF"
"RTN","PSSPOIMO",10,0)
 S DIC("W")=PSS1_PSS2,DIC("S")="I '$P($G(^PS(50.7,+Y,0)),""^"",3)"
"RTN","PSSPOIMO",11,0)
 ;PSO*7*102;ONLY SEARCH B AND C X-REFS
"RTN","PSSPOIMO",12,0)
 S $P(PLINE,"-",79)="" W !! K PSOUT S DIC="^PS(50.7,",DIC(0)="QEAMZ",D="B^C" D MIX^DIC1 K DIC,PY,D G:Y<0!($D(DTOUT))!($D(DUOUT)) END
"RTN","PSSPOIMO",13,0)
 S PSOIEN=+Y,PSOINAME=$P(Y,"^",2),PSDOSE=+$P(^PS(50.7,PSOIEN,0),"^",2) L +^PS(50.7,PSOIEN):$S($G(DILOCKTM)>0:DILOCKTM,1:3) I '$T W !,$C(7),"Another person is editing this one." Q
"RTN","PSSPOIMO",14,0)
 W !!!,?5,"Orderable Item -> ",PSOINAME,!?5,"Dosage Form    -> ",$P($G(^PS(50.606,PSDOSE,0)),"^"),!
"RTN","PSSPOIMO",15,0)
 K DIR S DIR("?")=" ",DIR("?",1)="Enter 'Yes' to see all of the Dispense Drugs, IV Additives, and IV Solutions",DIR("?",2)="that are matched to this Orderable Item. IV Additives will be identified with"
"RTN","PSSPOIMO",16,0)
 S DIR("?",3)="an (A), and IV Solutions with an (S)."
"RTN","PSSPOIMO",17,0)
 S DIR(0)="Y",DIR("B")="YES",DIR("A")="List all Drugs/Additives/Solutions tied to this Orderable Item" D ^DIR K DIR I Y["^"!($D(DTOUT))!($D(DUOUT)) G EN
"RTN","PSSPOIMO",18,0)
 I Y D DISP
"RTN","PSSPOIMO",19,0)
EDIT K DIR W ! S DIR(0)="Y",DIR("A")="Are you sure you want to edit this Orderable Item",DIR("B")="NO",DIR("?")="Answer YES to edit the fields associated with this Orderable Item." D ^DIR K DIR I 'Y!($D(DTOUT))!($D(DUOUT)) G EN
"RTN","PSSPOIMO",20,0)
 W !!?3,"Now editing Orderable Item:",!?3,PSOINAME,"   ",$P($G(^PS(50.606,PSDOSE,0)),"^")
"RTN","PSSPOIMO",21,0)
DIR K DIR S DIR(0)="F^3:40",DIR("B")=PSOINAME,DIR("A")="Orderable Item Name" D ^DIR
"RTN","PSSPOIMO",22,0)
 I Y["^"!($D(DUOUT))!($D(DTOUT)) G EN
"RTN","PSSPOIMO",23,0)
 I X[""""!($A(X)=45)!('(X'?1P.E))!(X?2"z".E) W $C(7),!!?5,"??" G DIR
"RTN","PSSPOIMO",24,0)
 I X'=PSOINAME S ZZFLAG=0 D @$S('$P($G(^PS(50.7,PSOIEN,0)),"^",3):"CHECK",1:"ZCHECK") I ZZFLAG G DIR
"RTN","PSSPOIMO",25,0)
 S PSONEW=X,DIE="^PS(50.7,",DA=PSOIEN,DR=".01////"_X D ^DIE I PSONEW'=PSOINAME W !!,"Name changed from  ",PSOINAME,!?15,"to  ",PSONEW
"RTN","PSSPOIMO",26,0)
 S PSSDTENT=0 W ! K DIE N MFLG S PSBEFORE=$P(^PS(50.7,PSOIEN,0),"^",4),PSAFTER=0,PSINORDE="" D
"RTN","PSSPOIMO",27,0)
 .;If reactivate OI, prompt to reactivate DD's only if there are any, then always give message saying OI now Active. If Inactivate, prompt to inactivate any active DD's if there are any, and give message
"RTN","PSSPOIMO",28,0)
 .;but if OI is reactivated, and there are no activities matched to it, and user does not want to activate the drugs, then inactivate the OI again, and give a clear message explaining this.
"RTN","PSSPOIMO",29,0)
 .W !,"This Orderable Item is "_$S($P($G(^PS(50.7,PSOIEN,0)),"^",12):"Non-Formulary.",1:"Formulary."),!
"RTN","PSSPOIMO",30,0)
 .I $P($G(^PS(50.7,PSOIEN,0)),"^",10) W !,"This Orderable Item is marked as a Non-VA Med.",!
"RTN","PSSPOIMO",31,0)
 .S DIE="^PS(50.7,",DA=PSOIEN,DR=6 S PSCREATE=1 D ^DIE K DIE,PSCREATE I $D(DTOUT)!($D(Y)>10) Q
"RTN","PSSPOIMO",32,0)
 .;PSS*1*102;ADD DRUG TEXT AS SYNONYM IS REQUESTED BY USER
"RTN","PSSPOIMO",33,0)
 .D ADDSYN^PSSPOIMP
"RTN","PSSPOIMO",34,0)
 .K DIR S DIR(0)="DO",DIR("A")="INACTIVE DATE" D  D ^DIR K DIR I $G(Y)["^"!($D(DTOUT))!($G(DUOUT)) Q
"RTN","PSSPOIMO",35,0)
 ..I $G(PSBEFORE) S Y=PSBEFORE D DD^%DT S DIR("B")=$G(Y)
"RTN","PSSPOIMO",36,0)
 .I $G(PSBEFORE),'$G(Y) W ?40,"Inactive Date deleted!"
"RTN","PSSPOIMO",37,0)
 .S PSSDTENT=$G(Y) I $G(Y) D DD^%DT W ?40,$G(Y)
"RTN","PSSPOIMO",38,0)
 .S PSSOTH=$S($P($G(^PS(59.7,1,40.2)),"^"):1,1:0)
"RTN","PSSPOIMO",39,0)
 .S DIE="^PS(50.7,",DA=PSOIEN N PSSFG,PSSOU
"RTN","PSSPOIMO",40,0)
 .S DR=".05;@1;D SETF^PSSPOIMO;.06;D DFR^PSSPOIMO(PSDOSE);10//YES;I X=""Y"" S Y=""@2"";S:$G(DUOUT) Y=""@3"";" D
"RTN","PSSPOIMO",41,0)
 ..S DR=DR_"D PDCHK^PSSPOIMO S:PSSFG Y=""@1"";S:$G(DUOUT) Y=""@3"";@2;K DIE(""NO^""),DIRUT;D MRSEL^PSSPOIMO;.07;.08;1;12//0;7;S:'$G(PSSOTH) Y=""@3"";7.1;@3" ;*191
"RTN","PSSPOIMO",42,0)
 .S PSCREATE=1 D ^DIE K DIE,PSCREATE,PSSOTH,^TMP("PSJMR",$J),^TMP("PSSDMR",$J) I $D(PSSOU),'$G(PSSOU) D MRSEL K ^TMP("PSJMR",$J)
"RTN","PSSPOIMO",43,0)
 .S $P(^PS(50.7,PSOIEN,0),"^",4)=PSSDTENT,PSAFTER=PSSDTENT
"RTN","PSSPOIMO",44,0)
 S:PSBEFORE&('$P(^PS(50.7,PSOIEN,0),"^",4)) PSINORDE="D" S:$P(^PS(50.7,PSOIEN,0),"^",4) PSINORDE="I"
"RTN","PSSPOIMO",45,0)
 I PSINORDE'="" D CHECK^PSSPOID2(PSOIEN) D
"RTN","PSSPOIMO",46,0)
 .I PSINORDE="D" D  Q
"RTN","PSSPOIMO",47,0)
 ..I $O(PSSDACTI(0))!($O(PSSSACTI(0)))!($O(PSSAACTI(0))) D
"RTN","PSSPOIMO",48,0)
 ...W !!,"There are inactive "_$S($O(PSSDACTI(0)):"drugs, ",1:"")_$S($O(PSSAACTI(0)):"additives, ",1:"")_$S($O(PSSSACTI(0)):"solutions,",1:""),!,"matched to this Pharmacy Orderable Item."
"RTN","PSSPOIMO",49,0)
 .I $O(PSSDACT(0))!($O(PSSSACT(0)))!($O(PSSAACT(0))) D
"RTN","PSSPOIMO",50,0)
 ..W !!,"There are active "_$S($O(PSSDACT(0)):"drugs, ",1:"")_$S($O(PSSAACT(0)):"additives, ",1:"")_$S($O(PSSSACT(0)):"solutions,",1:""),!,"matched to this Pharmacy Orderable Item."
"RTN","PSSPOIMO",51,0)
 I $G(PSINORDE)="D" I $O(PSSDACTI(0))!($O(PSSSACTI(0)))!($O(PSSAACTI(0))) D REST^PSSPOIDT(PSOIEN)
"RTN","PSSPOIMO",52,0)
 I $G(PSINORDE)="I" I $O(PSSDACT(0))!($O(PSSSACT(0)))!($O(PSSAACT(0))) D REST^PSSPOIDT(PSOIEN)
"RTN","PSSPOIMO",53,0)
 S DIK="^PS(50.7,",DA=PSOIEN,DIK(1)=.04 D EN^DIK K DIK
"RTN","PSSPOIMO",54,0)
 K PSBEFORE,PSAFTER,PSINORDE,PSSDTENT,PSSDACT,PSSDACTI,PSSSACT,PSSSACTI,PSSAACT,PSSAACTI
"RTN","PSSPOIMO",55,0)
 N DIE,DA,DR  ; Indications for Use fields PSS*1*204
"RTN","PSSPOIMO",56,0)
 S DIE="^PS(50.7,",DA=PSOIEN,DR="14;13" D ^DIE K DIE
"RTN","PSSPOIMO",57,0)
IMMUN ;PSS*1*141 FOR 'IMMUNIZATIONS DOCUMENTATION BY BCMA'
"RTN","PSSPOIMO",58,0)
 I $O(^PSDRUG("AOC",PSOIEN,"IM000"))'["IM" G SYN ;ASK WHEN APPROPRIATE
"RTN","PSSPOIMO",59,0)
 W ! S DIE="^PS(50.7,",DA=PSOIEN,DR=9 D ^DIE K DIE
"RTN","PSSPOIMO",60,0)
SYN I $G(Y)["^"!($G(DIRUT))!$D(DTOUT)!($D(Y)>10) G SYN1
"RTN","PSSPOIMO",61,0)
 W ! K DIC S:'$D(^PS(50.7,PSOIEN,2,0)) ^PS(50.7,PSOIEN,2,0)="^50.72^0^0" S DIC="^PS(50.7,"_PSOIEN_",2,",DA(1)=PSOIEN,DIC(0)="QEAMZL",DIC("A")="Select SYNONYM: ",DLAYGO=50.72 D ^DIC K DIC
"RTN","PSSPOIMO",62,0)
 I Y<0!($D(DUOUT))!($D(DTOUT)) K:'$O(^PS(50.7,PSOIEN,2,0)) ^PS(50.7,PSOIEN,2,0) D EN^PSSPOIDT(PSOIEN),EN2^PSSHL1(PSOIEN,"MUP") G EN
"RTN","PSSPOIMO",63,0)
 W ! S DA=+Y,DIE="^PS(50.7,"_PSOIEN_",2,",DA(1)=PSOIEN,DR=.01 D ^DIE K DIE G SYN
"RTN","PSSPOIMO",64,0)
SYN1 ;File
"RTN","PSSPOIMO",65,0)
 D EN^PSSPOIDT(PSOIEN),EN2^PSSHL1(PSOIEN,"MUP")
"RTN","PSSPOIMO",66,0)
 G EN
"RTN","PSSPOIMO",67,0)
END K ZZFLAG,DIC,DIR,DIE,DTOUT,DUOUT,DIRUT,FLAG,PSOINAME,PSOUT,PSDOSE,PSONEW,UPFLAG,VV,ZZ,AA,BB,Y,AAA,SSS,PSOARR,PSOARRAD,PLINE I $D(PSOIEN) L -^PS(50.7,PSOIEN) K PSOIEN
"RTN","PSSPOIMO",68,0)
 Q
"RTN","PSSPOIMO",69,0)
DISP N PSSLFLAG,PSSLDATE S FLAG=1 D HEAD F ZZ=0:0 S ZZ=$O(^PSDRUG("ASP",PSOIEN,ZZ)) Q:'ZZ!($G(PSOUT))  S FLAG=0 D:($Y+5)>IOSL HEAD Q:$G(PSOUT)  I ZZ W !,$P($G(^PSDRUG(ZZ,0)),"^") W:$P($G(^PSDRUG(ZZ,0)),"^",9) "   N/F" D DTE
"RTN","PSSPOIMO",70,0)
 Q:$G(PSOUT)
"RTN","PSSPOIMO",71,0)
 S (FLAG,PSSLFLAG)=0
"RTN","PSSPOIMO",72,0)
 F ZZ=0:0 S ZZ=$O(^PS(52.6,"AOI",PSOIEN,ZZ)) Q:'ZZ!($G(PSOUT))  D:($Y+5)>IOSL HEAD Q:$G(PSOUT)  I ZZ D
"RTN","PSSPOIMO",73,0)
 .S PSSLFLAG=1
"RTN","PSSPOIMO",74,0)
 .W !,$P($G(^PS(52.6,ZZ,0)),"^"),?31," (A) "
"RTN","PSSPOIMO",75,0)
 .W ?40,"Additive Strength: ",$S($$GET1^DIQ(52.6,ZZ,19)'="":$$GET1^DIQ(52.6,ZZ,19)_" "_$$GET1^DIQ(52.6,ZZ,2),1:"N/A")," "
"RTN","PSSPOIMO",76,0)
 .S PSSLDATE=$P($G(^PS(52.6,ZZ,"I")),"^") I PSSLDATE D DTEX
"RTN","PSSPOIMO",77,0)
 Q:$G(PSOUT)
"RTN","PSSPOIMO",78,0)
 ;I $G(PSSLFLAG) W !
"RTN","PSSPOIMO",79,0)
 F ZZ=0:0 S ZZ=$O(^PS(52.7,"AOI",PSOIEN,ZZ)) Q:'ZZ!($G(PSOUT))  D:($Y+5)>IOSL HEAD Q:$G(PSOUT)  I ZZ D
"RTN","PSSPOIMO",80,0)
 .W !,$P($G(^PS(52.7,ZZ,0)),"^"),?31,$P($G(^(0)),"^",3),?42,"(S)"
"RTN","PSSPOIMO",81,0)
 .S PSSLDATE=$P($G(^PS(52.7,ZZ,"I")),"^") I PSSLDATE D DTEX
"RTN","PSSPOIMO",82,0)
 Q
"RTN","PSSPOIMO",83,0)
HEAD I 'FLAG W ! K DIR S DIR(0)="E",DIR("A")="Press RETURN to continue" D ^DIR K DIR I 'Y S PSOUT=1 Q
"RTN","PSSPOIMO",84,0)
 W @IOF W !,?6,"Orderable Item ->  ",PSOINAME,!?6,"Dosage Form    ->  ",$P($G(^PS(50.606,+$P($G(^PS(50.7,PSOIEN,0)),"^",2),0)),"^"),!!,"Dispense Drugs:"_$S('FLAG:" (continued)",1:""),!,"---------------"
"RTN","PSSPOIMO",85,0)
 Q
"RTN","PSSPOIMO",86,0)
ADDIT ;If orderable item is flagged for IV
"RTN","PSSPOIMO",87,0)
 S AA=$O(^PS(52.6,"AOI",PSOIEN,0))
"RTN","PSSPOIMO",88,0)
 S BB=$O(^PS(52.7,"AOI",PSOIEN,0))
"RTN","PSSPOIMO",89,0)
 I 'AA,'BB W $C(7),!,"This Orderable Item is flagged for IV use, but currently there are no IV",!,"Additives or IV Solutions matched to this Orderable Item!" G EDIT
"RTN","PSSPOIMO",90,0)
 G SOL
"RTN","PSSPOIMO",91,0)
CHECK ;
"RTN","PSSPOIMO",92,0)
 S ZZFLAG=0 F VV=0:0 S VV=$O(^PS(50.7,"ADF",X,PSDOSE,VV)) Q:'VV  I VV,'$P($G(^PS(50.7,VV,0)),"^",3) S ZZFLAG=1
"RTN","PSSPOIMO",93,0)
 I ZZFLAG W $C(7),!!?5,"There is already an Orderable Item with this same name and Dosage Form",!?5,"that is not flagged as 'IV'. Use the 'DISPENSE DRUG/ORDERABLE ITEM",!?5,"MAINTENANCE' option if you want to re-match to this Orderable Item!",!
"RTN","PSSPOIMO",94,0)
 Q
"RTN","PSSPOIMO",95,0)
ZCHECK ;
"RTN","PSSPOIMO",96,0)
 S ZZFLAG=0 F VV=0:0 S VV=$O(^PS(50.7,"ADF",X,PSDOSE,VV)) Q:'VV  I VV,$P($G(^PS(50.7,VV,0)),"^",3) S ZZFLAG=1
"RTN","PSSPOIMO",97,0)
 I ZZFLAG W $C(7),!!?5,"There is already an Orderable Item with the same name and Dosage Form,",!?5,"that is flagged for 'IV' use.",!
"RTN","PSSPOIMO",98,0)
 Q
"RTN","PSSPOIMO",99,0)
SOL ;
"RTN","PSSPOIMO",100,0)
 K DIR S DIR(0)="Y",DIR("B")="YES",DIR("A")="List all Additives and Solutions tied to this Orderable Item" D ^DIR K DIR G:Y["^"!($D(DTOUT)) EN G:Y=0 EDIT
"RTN","PSSPOIMO",101,0)
 H 1 K PSOARR,PSOARRAD S AAA=$O(^PS(52.6,"AOI",PSOIEN,0)) I AAA,$D(^PS(52.6,AAA,0)) S PSOARRAD=AAA
"RTN","PSSPOIMO",102,0)
 F SSS=0:0 S SSS=$O(^PS(52.7,"AOI",PSOIEN,SSS)) Q:'SSS  S:$D(^PS(52.7,SSS,0)) PSOARR(SSS)=""
"RTN","PSSPOIMO",103,0)
 S FLAG=1,UPFLAG=0 D SHEAD F ZZ=0:0 S ZZ=$O(PSOARR(ZZ)) Q:'ZZ!($G(PSOUT))!($G(UPFLAG))  S FLAG=0 D:($Y+7)>IOSL SHEAD Q:$G(PSOUT)!($G(UPFLAG))  I ZZ W !,$P($G(^PS(52.7,ZZ,0)),"^"),"   ",$P($G(^(0)),"^",3)
"RTN","PSSPOIMO",104,0)
 G:$G(PSOUT) EN
"RTN","PSSPOIMO",105,0)
 G EDIT
"RTN","PSSPOIMO",106,0)
SHEAD I 'FLAG W ! K DIR S DIR(0)="E",DIR("A")="Press RETURN to continue" D ^DIR K DIR I 'Y S:Y="" PSOUT=1 S:Y=0 UPFLAG=1 Q
"RTN","PSSPOIMO",107,0)
 W @IOF W !?6,"Orderable Item ->  ",PSOINAME,?68,"(IV)",!?6,"Dosage Form    ->  ",$P($G(^PS(50.606,+$P($G(^PS(50.7,PSOIEN,0)),"^",2),0)),"^"),!,PLINE I FLAG,'$G(PSOARRAD) W !?5,"IV Solutions:",!
"RTN","PSSPOIMO",108,0)
 I 'FLAG W !?5,"IV Solutions:",!
"RTN","PSSPOIMO",109,0)
 I FLAG,$G(PSOARRAD) W !,$P($G(^PS(52.6,PSOARRAD,0)),"^"),"    ","(IV Additive)",! I $D(PSOARR) W !?5,"IV Solutions:",!
"RTN","PSSPOIMO",110,0)
 Q
"RTN","PSSPOIMO",111,0)
DTE I $D(^PSDRUG(ZZ,"I")) S Y=$P(^PSDRUG(ZZ,"I"),"^") D DD^%DT W ?50,Y K Y
"RTN","PSSPOIMO",112,0)
 Q
"RTN","PSSPOIMO",113,0)
DTEX S Y=$G(PSSLDATE) D DD^%DT W ?50,$G(Y) K Y
"RTN","PSSPOIMO",114,0)
 Q
"RTN","PSSPOIMO",115,0)
IVMSG ; display a message if the CORRESPONDING IV field is entered
"RTN","PSSPOIMO",116,0)
 ;
"RTN","PSSPOIMO",117,0)
 S PSSIVMSG=$P(^PS(50.7,PSOIEN,0),"^",11) I PSSIVMSG="" Q
"RTN","PSSPOIMO",118,0)
 S PSSIVFRM=$P(^PS(50.7,PSSIVMSG,0),"^",2) I PSSIVFRM S PSSIVFRM=$P(^PS(50.606,PSSIVFRM,0),"^")
"RTN","PSSPOIMO",119,0)
 S PSSIVMSG=$P(^PS(50.7,PSSIVMSG,0),"^")_" "_PSSIVFRM
"RTN","PSSPOIMO",120,0)
 W !!,"The Corresponding IV Item is currently identified as: "_PSSIVMSG,!
"RTN","PSSPOIMO",121,0)
 K PSSIVFRM,PSSIVMSG
"RTN","PSSPOIMO",122,0)
 Q
"RTN","PSSPOIMO",123,0)
UDMSG ; display a message if the CORRESPONDING UD field is entered
"RTN","PSSPOIMO",124,0)
 ;
"RTN","PSSPOIMO",125,0)
 S PSSUDMSG=$P(^PS(50.7,PSOIEN,0),"^",10) I PSSUDMSG="" Q
"RTN","PSSPOIMO",126,0)
 S PSSUDFRM=$P(^PS(50.7,PSSUDMSG,0),"^",2) I PSSUDFRM S PSSUDFRM=$P(^PS(50.606,PSSUDFRM,0),"^")
"RTN","PSSPOIMO",127,0)
 S PSSUDMSG=$P(^PS(50.7,PSSUDMSG,0),"^")_" "_PSSUDFRM
"RTN","PSSPOIMO",128,0)
 W !!,"The Corresponding UD Item is currently identified as: "_PSSUDMSG,!
"RTN","PSSPOIMO",129,0)
 K PSSUDMSG,PSSUDFRM
"RTN","PSSPOIMO",130,0)
 Q
"RTN","PSSPOIMO",131,0)
DFR(PSDOSE) ; dosage form med routes - called by DR string at DIR+20^PSSPOIMO
"RTN","PSSPOIMO",132,0)
 D SETF
"RTN","PSSPOIMO",133,0)
 N MR,MRNODE,XX K ^TMP("PSSDMR",$J)
"RTN","PSSPOIMO",134,0)
 S (MCT,MR)=0 F  S MR=$O(^PS(50.606,PSDOSE,"MR",MR)) Q:'MR  D
"RTN","PSSPOIMO",135,0)
 .S XX=+$G(^PS(50.606,PSDOSE,"MR",MR,0)) Q:'XX  S MRNODE=$G(^PS(51.2,XX,0)) I $P($G(MRNODE),"^",4)'=1 Q
"RTN","PSSPOIMO",136,0)
 .S MCT=MCT+1,^TMP("PSSDMR",$J,MCT)=$P(MRNODE,U),^TMP("PSSDMR",$J,"B",XX)=""
"RTN","PSSPOIMO",137,0)
 D DFRL
"RTN","PSSPOIMO",138,0)
 Q
"RTN","PSSPOIMO",139,0)
DFRL W !!," List of med routes associated with the DOSAGE FORM of the orderable item:",!
"RTN","PSSPOIMO",140,0)
 S MCT=0 I '$O(^TMP("PSSDMR",$J,MCT)) W !,?3,"NO MED ROUTE DEFINED"
"RTN","PSSPOIMO",141,0)
 F  S MCT=$O(^TMP("PSSDMR",$J,MCT)) Q:'MCT  W !,?3,$G(^(MCT))
"RTN","PSSPOIMO",142,0)
 D EN^DDIOL(" If you answer YES to the next prompt, the DEFAULT MED ROUTE (if populated)",,"!!")
"RTN","PSSPOIMO",143,0)
 D EN^DDIOL(" and this list (if populated) will be displayed as selectable med routes",,"!")
"RTN","PSSPOIMO",144,0)
 D EN^DDIOL(" during medication ordering dialog. If you answer NO, the DEFAULT MED ROUTE",,"!")
"RTN","PSSPOIMO",145,0)
 D EN^DDIOL(" (if populated) and POSSIBLE MED ROUTES list will be displayed instead.",,"!") W !
"RTN","PSSPOIMO",146,0)
 ;K ^TMP("PSSMR",$J)
"RTN","PSSPOIMO",147,0)
 Q
"RTN","PSSPOIMO",148,0)
PDR ; possible med routes - called by DR string at DIR+20^PSSPOIMO
"RTN","PSSPOIMO",149,0)
 N MCT,MR,MRNODE,XX K ^TMP("PSSMR",$J)
"RTN","PSSPOIMO",150,0)
 S (XX,MCT)=0 F  S XX=$O(^PS(50.7,$S($G(PSVAR):PSVAR,1:PSOIEN),3,"B",XX)) Q:'XX  S MRNODE=$G(^PS(51.2,XX,0)),MCT=MCT+1,^TMP("PSSMR",$J,MCT)=$P(MRNODE,U)
"RTN","PSSPOIMO",151,0)
 I $O(^TMP("PSSMR",$J,0)) D
"RTN","PSSPOIMO",152,0)
 .W !!," List of Possible Med Routes associated with the orderable item:",!
"RTN","PSSPOIMO",153,0)
 .S MCT=0 F  S MCT=$O(^TMP("PSSMR",$J,MCT)) Q:'MCT  W !,?3,$G(^(MCT))
"RTN","PSSPOIMO",154,0)
 W ! K ^TMP("PSSMR",$J)
"RTN","PSSPOIMO",155,0)
 Q
"RTN","PSSPOIMO",156,0)
PDCHK ; called by DR string at DIR+20^PSSPOIMO
"RTN","PSSPOIMO",157,0)
 N ANS,D,DIC,DIE,DO,DICR,DR,DIR,PSOUT,PSSDA,PSSX,PSSXA,PSSY,Q,X,Y,Z
"RTN","PSSPOIMO",158,0)
 S DIR(0)="PO^51.2:EMZ",DIR("A")="POSSIBLE MED ROUTES",DIR("S")="I $P(^(0),U,4)" S PSOUT=0
"RTN","PSSPOIMO",159,0)
 S DIR("PRE")="I X=""?"" D MRTHLP^PSSPOIMO"
"RTN","PSSPOIMO",160,0)
 F  D PDR,^DIR D  I PSOUT Q
"RTN","PSSPOIMO",161,0)
 .I (X="")!$D(DTOUT)!$D(DUOUT) S PSOUT=1 Q
"RTN","PSSPOIMO",162,0)
 .I X="@",$D(PSSY) S ANS=DA D:$$DASK  Q
"RTN","PSSPOIMO",163,0)
 ..N DIK,DA S DA(1)=ANS,DIK="^PS(50.7,"_DA(1)_",3,"
"RTN","PSSPOIMO",164,0)
 ..S DA=$O(^PS(50.7,DA(1),3,"B",PSSY,"")) I DA="" Q
"RTN","PSSPOIMO",165,0)
 ..D ^DIK K PSSY,DIR("B")
"RTN","PSSPOIMO",166,0)
 .I Y="" W "  ??" Q
"RTN","PSSPOIMO",167,0)
 .I $D(^PS(50.7,DA,3,"B",+Y)) D  Q
"RTN","PSSPOIMO",168,0)
 ..I $D(DIR("B")) K PSSY,DIR("B") Q
"RTN","PSSPOIMO",169,0)
 ..S DIR("B")=Y(0,0),PSSY=+Y Q
"RTN","PSSPOIMO",170,0)
 .S PSSXA=Y(0,0),PSSX=+Y D DFR(+$P(^PS(50.7,DA,0),"^",2))
"RTN","PSSPOIMO",171,0)
 .I $G(PSSX) S ANS=$$ASK() I 'ANS Q
"RTN","PSSPOIMO",172,0)
 .S PSSDA(50.711,"+1,"_DA_",",.01)=+PSSX
"RTN","PSSPOIMO",173,0)
 .D UPDATE^DIE("","PSSDA")
"RTN","PSSPOIMO",174,0)
 .K ^TMP("PSSMR",$J)
"RTN","PSSPOIMO",175,0)
 D DP
"RTN","PSSPOIMO",176,0)
 Q
"RTN","PSSPOIMO",177,0)
ASK() ; confirm adding the new entry
"RTN","PSSPOIMO",178,0)
 N DIR,X,Y W ! S DIR(0)="YO",DIR("B")="YES"
"RTN","PSSPOIMO",179,0)
 I $D(^TMP("PSSDMR",$J)),'$D(^TMP("PSSDMR",$J,"B",PSSX)) S DIR("B")="NO",DIR("A",1)="The selected entry does not match to any of the dosage form med routes."
"RTN","PSSPOIMO",180,0)
 W $C(7) S DIR("A")="  Are you adding '"_PSSXA_"' as a new POSSIBLE MED ROUTE" D ^DIR
"RTN","PSSPOIMO",181,0)
 Q $S(Y=1:1,1:0)
"RTN","PSSPOIMO",182,0)
DASK() ; delete possible med route
"RTN","PSSPOIMO",183,0)
 N DIR
"RTN","PSSPOIMO",184,0)
 W $C(7) S DIR("A")="     SURE YOU WANT TO DELETE ",DIR(0)="Y" D ^DIR
"RTN","PSSPOIMO",185,0)
 Q $S(Y=1:1,1:0)
"RTN","PSSPOIMO",186,0)
MRTHLP ; help of possible med route
"RTN","PSSPOIMO",187,0)
 N DIC,RTE,D
"RTN","PSSPOIMO",188,0)
 S RTE=0 F  S RTE=$O(^PS(50.7,DA,3,"B",RTE)) Q:'RTE   D EN^DDIOL($P($G(^PS(51.2,RTE,0)),"^"),,"!,?4")
"RTN","PSSPOIMO",189,0)
 W ! D EN^DDIOL("Enter the most common MED ROUTE associated with this Orderable Item.",,"!,?5")
"RTN","PSSPOIMO",190,0)
 D EN^DDIOL("ONLY MED ROUTES MARKED FOR USE BY ALL PACKAGES ARE SELECTABLE.",,"!,?5")
"RTN","PSSPOIMO",191,0)
 Q
"RTN","PSSPOIMO",192,0)
DP ; check the existence of Default Med Route & Possible Med Routes
"RTN","PSSPOIMO",193,0)
 N D,DIC,DIE,DO,DICR,DR,DIR,Q,X,Y,Z
"RTN","PSSPOIMO",194,0)
 I '$P($G(^PS(50.7,$S($G(PSVAR):PSVAR,1:PSOIEN),0)),"^",6)&('$O(^PS(50.7,$S($G(PSVAR):PSVAR,1:PSOIEN),3,0))) D
"RTN","PSSPOIMO",195,0)
 .S PSR(1)=" You have not selected ANY med routes to display during order entry. In"
"RTN","PSSPOIMO",196,0)
 .S PSR(2)=" order to have med routes displayed during order entry, you must either"
"RTN","PSSPOIMO",197,0)
 .S PSR(3)=" define a DEFAULT MED ROUTE and/or at least one POSSIBLE MED ROUTE, or"
"RTN","PSSPOIMO",198,0)
 .S PSR(4)=" answer YES to the USE DOSAGE FORM MED ROUTE LIST prompt."
"RTN","PSSPOIMO",199,0)
 .S PSR(5)=" **WITH THE CURRENT SETTINGS, NO MED ROUTES WILL DISPLAY FOR SELECTION ",PSR(5,"F")="!!"
"RTN","PSSPOIMO",200,0)
 .S PSR(6)=" DURING ORDER ENTRY FOR THIS ORDERABLE ITEM**"
"RTN","PSSPOIMO",201,0)
 .D EN^DDIOL(.PSR),EN^DDIOL(" ","","!")
"RTN","PSSPOIMO",202,0)
 .K DIR S DIR(0)="Y",DIR("?",1)="If you select NO, you will continue to loop back to the Default Med Route"
"RTN","PSSPOIMO",203,0)
 .S DIR("?")="prompt until either a selection is made or you answer YES to this prompt to proceed."
"RTN","PSSPOIMO",204,0)
 .S DIR("A",1)="",DIR("A",2)="The current setting is usually only appropriate for supply items."
"RTN","PSSPOIMO",205,0)
 .S DIR("A")="Continue with NO med route displaying for selection during order entry",DIR("B")="NO"
"RTN","PSSPOIMO",206,0)
 .D ^DIR K DIR W ! I 'Y!($D(DTOUT))!($D(DUOUT)) S PSSFG=1
"RTN","PSSPOIMO",207,0)
 .S:Y PSSFG=0
"RTN","PSSPOIMO",208,0)
 E  S PSSFG=0
"RTN","PSSPOIMO",209,0)
 Q
"RTN","PSSPOIMO",210,0)
 ;
"RTN","PSSPOIMO",211,0)
SETF ;
"RTN","PSSPOIMO",212,0)
 S PSSOU=0 K ^TMP("PSJMR",$J) D MEDRT^PSSJORDF($S($G(PSVAR):PSVAR,1:PSOIEN))
"RTN","PSSPOIMO",213,0)
 I '$D(^TMP("PSJMR",$J)) S DIE("NO^")="",PSSFG=1
"RTN","PSSPOIMO",214,0)
 E  S PSSFG=0 K DIE("NO^")
"RTN","PSSPOIMO",215,0)
 Q
"RTN","PSSPOIMO",216,0)
MRSEL ;
"RTN","PSSPOIMO",217,0)
 K ^TMP("PSJMR",$J) D MEDRT^PSSJORDF($S($G(PSVAR):PSVAR,1:PSOIEN))
"RTN","PSSPOIMO",218,0)
 W !,"The following Med Routes will now be displayed during order entry:"
"RTN","PSSPOIMO",219,0)
 N I S (PSSOU,I)=0 F  S I=$O(^TMP("PSJMR",$J,I)) Q:'I   W !,$P(^(I),"^",2) S PSSOU=1
"RTN","PSSPOIMO",220,0)
 W:'PSSOU !,"(None)"
"RTN","PSSPOIMO",221,0)
 W ! S PSSOU=1
"RTN","PSSPOIMO",222,0)
 Q
"RTN","PSSPOIMO",223,0)
 ;
"VER")
8.0^22.2
"BLD",10734,6)
^191
**END**
**END**

