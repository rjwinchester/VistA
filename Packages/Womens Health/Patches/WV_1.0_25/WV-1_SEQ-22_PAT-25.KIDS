Released WV*1*25 SEQ #22
Extracted from mail message
**KIDS**:WV*1.0*25^

**INSTALL NAME**
WV*1.0*25
"BLD",9672,0)
WV*1.0*25^WOMEN'S HEALTH^0^3140603^y
"BLD",9672,1,0)
^^6^6^3140603^^
"BLD",9672,1,1,0)
This patch is a VM patch that addresses 2 issues in the Women's Health
"BLD",9672,1,2,0)
package.
"BLD",9672,1,3,0)
 
"BLD",9672,1,4,0)
1.      No alert to case manager for PAP supplementary reports
"BLD",9672,1,5,0)
 
"BLD",9672,1,6,0)
2.      Errors when reports are sent to  Women's Health package
"BLD",9672,4,0)
^9.64PA^^
"BLD",9672,6.3)
1
"BLD",9672,"ABPKG")
n
"BLD",9672,"KRN",0)
^9.67PA^779.2^20
"BLD",9672,"KRN",.4,0)
.4
"BLD",9672,"KRN",.401,0)
.401
"BLD",9672,"KRN",.402,0)
.402
"BLD",9672,"KRN",.403,0)
.403
"BLD",9672,"KRN",.5,0)
.5
"BLD",9672,"KRN",.84,0)
.84
"BLD",9672,"KRN",3.6,0)
3.6
"BLD",9672,"KRN",3.8,0)
3.8
"BLD",9672,"KRN",9.2,0)
9.2
"BLD",9672,"KRN",9.8,0)
9.8
"BLD",9672,"KRN",9.8,"NM",0)
^9.68A^3^3
"BLD",9672,"KRN",9.8,"NM",1,0)
WVLRLINK^^0^B51640405
"BLD",9672,"KRN",9.8,"NM",2,0)
WVSNOMED^^0^B27535535
"BLD",9672,"KRN",9.8,"NM",3,0)
WVRALINK^^0^B50516773
"BLD",9672,"KRN",9.8,"NM","B","WVLRLINK",1)

"BLD",9672,"KRN",9.8,"NM","B","WVRALINK",3)

"BLD",9672,"KRN",9.8,"NM","B","WVSNOMED",2)

"BLD",9672,"KRN",19,0)
19
"BLD",9672,"KRN",19,"NM",0)
^9.68A^^
"BLD",9672,"KRN",19.1,0)
19.1
"BLD",9672,"KRN",19.1,"NM",0)
^9.68A^^
"BLD",9672,"KRN",101,0)
101
"BLD",9672,"KRN",101,"NM",0)
^9.68A^^
"BLD",9672,"KRN",409.61,0)
409.61
"BLD",9672,"KRN",409.61,"NM",0)
^9.68A^^
"BLD",9672,"KRN",771,0)
771
"BLD",9672,"KRN",771,"NM",0)
^9.68A^^
"BLD",9672,"KRN",779.2,0)
779.2
"BLD",9672,"KRN",779.2,"NM",0)
^9.68A^^
"BLD",9672,"KRN",870,0)
870
"BLD",9672,"KRN",870,"NM",0)
^9.68A^^
"BLD",9672,"KRN",8989.51,0)
8989.51
"BLD",9672,"KRN",8989.51,"NM",0)
^9.68A^^
"BLD",9672,"KRN",8989.52,0)
8989.52
"BLD",9672,"KRN",8989.52,"NM",0)
^9.68A^^
"BLD",9672,"KRN",8994,0)
8994
"BLD",9672,"KRN",8994,"NM",0)
^9.68A^^
"BLD",9672,"KRN","B",.4,.4)

"BLD",9672,"KRN","B",.401,.401)

"BLD",9672,"KRN","B",.402,.402)

"BLD",9672,"KRN","B",.403,.403)

"BLD",9672,"KRN","B",.5,.5)

"BLD",9672,"KRN","B",.84,.84)

"BLD",9672,"KRN","B",3.6,3.6)

"BLD",9672,"KRN","B",3.8,3.8)

"BLD",9672,"KRN","B",9.2,9.2)

"BLD",9672,"KRN","B",9.8,9.8)

"BLD",9672,"KRN","B",19,19)

"BLD",9672,"KRN","B",19.1,19.1)

"BLD",9672,"KRN","B",101,101)

"BLD",9672,"KRN","B",409.61,409.61)

"BLD",9672,"KRN","B",771,771)

"BLD",9672,"KRN","B",779.2,779.2)

"BLD",9672,"KRN","B",870,870)

"BLD",9672,"KRN","B",8989.51,8989.51)

"BLD",9672,"KRN","B",8989.52,8989.52)

"BLD",9672,"KRN","B",8994,8994)

"BLD",9672,"QUES",0)
^9.62^^
"BLD",9672,"REQB",0)
^9.611^2^2
"BLD",9672,"REQB",1,0)
WV*1.0*16^2
"BLD",9672,"REQB",2,0)
WV*1.0*23^2
"BLD",9672,"REQB","B","WV*1.0*16",1)

"BLD",9672,"REQB","B","WV*1.0*23",2)

"MBREQ")
0
"PKG",518,-1)
1^1
"PKG",518,0)
WOMEN'S HEALTH^WV^Tracks health issues specific to female patients.
"PKG",518,20,0)
^9.402P^^
"PKG",518,22,0)
^9.49I^1^1
"PKG",518,22,1,0)
1.0^2980925^2981209^3694
"PKG",518,22,1,"PAH",1,0)
25^3140603
"PKG",518,22,1,"PAH",1,1,0)
^^6^6^3140603
"PKG",518,22,1,"PAH",1,1,1,0)
This patch is a VM patch that addresses 2 issues in the Women's Health
"PKG",518,22,1,"PAH",1,1,2,0)
package.
"PKG",518,22,1,"PAH",1,1,3,0)
 
"PKG",518,22,1,"PAH",1,1,4,0)
1.      No alert to case manager for PAP supplementary reports
"PKG",518,22,1,"PAH",1,1,5,0)
 
"PKG",518,22,1,"PAH",1,1,6,0)
2.      Errors when reports are sent to  Women's Health package
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
3
"RTN","WVLRLINK")
0^1^B51640405^B51320384
"RTN","WVLRLINK",1,0)
WVLRLINK ;HIOFO/FT-LAB-WOMEN'S HEALTH LINK  ;9/29/04  14:34
"RTN","WVLRLINK",2,0)
 ;;1.0;WOMEN'S HEALTH;**6,10,16,25**;Sep 30, 1998;Build 1
"RTN","WVLRLINK",3,0)
 ;
"RTN","WVLRLINK",4,0)
 ; This routine uses the following IAs:
"RTN","WVLRLINK",5,0)
 ; #10035 - ^DPT references     (supported)
"RTN","WVLRLINK",6,0)
 ; #10063 - ^%ZTLOAD            (supported)
"RTN","WVLRLINK",7,0)
 ; #10070 - ^XMD                (supported)
"RTN","WVLRLINK",8,0)
 ; #10103 - ^XLFDT              (supported)
"RTN","WVLRLINK",9,0)
 ;
"RTN","WVLRLINK",10,0)
CREATE(DFN,LRDFN,LRI,LRA,LRSS) ;
"RTN","WVLRLINK",11,0)
 ; Add lab test to WH file (#790.08).
"RTN","WVLRLINK",12,0)
 ; Called by REPORT RELEASE DATE/TIME field in:
"RTN","WVLRLINK",13,0)
 ; a) File 63, Field 63.08,.11
"RTN","WVLRLINK",14,0)
 ; b) File 63, Field 63.09,.11
"RTN","WVLRLINK",15,0)
 ; Input: DFN    = PATIENT DFN
"RTN","WVLRLINK",16,0)
 ;        LRDFN  = FILE 63 IEN (+^DPT(DFN,"LR"))
"RTN","WVLRLINK",17,0)
 ;        LRI    = INVERSE DATE/TIME OF TEST
"RTN","WVLRLINK",18,0)
 ;        LRA    = ZERO NODE OF THE CY or SP ENTRY
"RTN","WVLRLINK",19,0)
 ;        LRSS   = File 63 subscript (e.g., CY or SP)
"RTN","WVLRLINK",20,0)
 ;
"RTN","WVLRLINK",21,0)
 Q:($G(DFN)']"")!($G(LRDFN)']"")!($G(LRI)']"")!($G(LRA)']"")!($G(LRSS)']"")
"RTN","WVLRLINK",22,0)
 Q:'$D(^WV(790.02,DUZ(2)))  ;no site parameter entry
"RTN","WVLRLINK",23,0)
 Q:'$P($G(^WV(790.02,+$G(DUZ(2)),0)),U,24)  ;lab link is NO or null
"RTN","WVLRLINK",24,0)
 N ZTDESC,ZTDTH,ZTIO,ZTRTN,ZTSAVE
"RTN","WVLRLINK",25,0)
 S ZTRTN="CREATEQ^WVLRLINK",ZTDESC="WV CREATE FILE 790.08 ENTRY"
"RTN","WVLRLINK",26,0)
 S ZTSAVE("DFN")="",ZTSAVE("LRDFN")="",ZTSAVE("LRI")="",ZTSAVE("LRA")=""
"RTN","WVLRLINK",27,0)
 S ZTSAVE("LRSS")="",ZTIO=""
"RTN","WVLRLINK",28,0)
 S ZTDTH=$$HADD^XLFDT($H,"","","",120) ;time delay if MOVE entry point
"RTN","WVLRLINK",29,0)
 ; is called to delete a bogus entry first so check of lab accession
"RTN","WVLRLINK",30,0)
 ; x-ref doesn't fail.
"RTN","WVLRLINK",31,0)
 D ^%ZTLOAD
"RTN","WVLRLINK",32,0)
 Q
"RTN","WVLRLINK",33,0)
CREATEQ ; Called from CREATE above
"RTN","WVLRLINK",34,0)
 ; WVLOC   = WARD/CLINIC/LOCATION (FILE #44)
"RTN","WVLRLINK",35,0)
 ; WVDATE  = DATE OF THE PROCEDURE (FM date/time)
"RTN","WVLRLINK",36,0)
 ;   WVDR  = DR STRING
"RTN","WVLRLINK",37,0)
 ; WVPROV  = ORDERING PROVIDER (FILE #200)
"RTN","WVLRLINK",38,0)
 ; WVLABAN = LAB ACCESSION # (e.g., CY 99 1)
"RTN","WVLRLINK",39,0)
 N WVDATE,WVDR,WVLABAN,WVLABAN0,WVLOC,WVPROV
"RTN","WVLRLINK",40,0)
 Q:$P($G(^DPT(DFN,0)),U,2)'="F"  ;not female
"RTN","WVLRLINK",41,0)
 Q:'$$VNVEC()  ;vet/non-vet/eligibility code check
"RTN","WVLRLINK",42,0)
 S WVDATE=$P(LRA,U,1) ;date/time specimen taken
"RTN","WVLRLINK",43,0)
 S WVLABAN=$P(LRA,U,6) ;lab accession#
"RTN","WVLRLINK",44,0)
 S WVLOC=$P(LRA,U,8) ;patient location
"RTN","WVLRLINK",45,0)
 I WVLOC]"" S WVLOC=$$HL(WVLOC) ;convert location to File 44 pointer
"RTN","WVLRLINK",46,0)
 S WVPROV=$P(LRA,U,7) ;requesting provider
"RTN","WVLRLINK",47,0)
 ; Quit if this lab test has already been sent to FILE 790.1.
"RTN","WVLRLINK",48,0)
 ;Q:$D(^WV(790.1,"F",WVLABAN))
"RTN","WVLRLINK",49,0)
 I LRSS'="CY",LRSS'="SP" Q  ;not cytology or surgical pathology
"RTN","WVLRLINK",50,0)
 ; ===============================================================
"RTN","WVLRLINK",51,0)
 ; Check SNOMED codes and determine if lab test is a pap smear and
"RTN","WVLRLINK",52,0)
 ; can be automatically created in FILE 790.1.
"RTN","WVLRLINK",53,0)
 I $$SNOMED^WVSNOMED() D  Q
"RTN","WVLRLINK",54,0)
 .D ADD^WVSNOMED
"RTN","WVLRLINK",55,0)
 .Q
"RTN","WVLRLINK",56,0)
 ; ===============================================================
"RTN","WVLRLINK",57,0)
 Q:$D(^WV(790.1,"F",WVLABAN))
"RTN","WVLRLINK",58,0)
 S WVDR=".02////"_DFN
"RTN","WVLRLINK",59,0)
 S:WVPROV]"" WVDR=WVDR_";.07////"_WVPROV
"RTN","WVLRLINK",60,0)
 S WVDR=WVDR_";.1////"_$G(DUZ(2))
"RTN","WVLRLINK",61,0)
 S:WVLOC]"" WVDR=WVDR_";.11////"_WVLOC
"RTN","WVLRLINK",62,0)
 S WVDR=WVDR_";.12////"_WVDATE
"RTN","WVLRLINK",63,0)
 S WVDR=WVDR_";.18////.5;.19////"_DT_";.34////"_$G(DUZ(2))
"RTN","WVLRLINK",64,0)
 S WVDR=WVDR_";2.18////"_LRDFN_";2.19////"_LRI_";2.2////"_LRSS
"RTN","WVLRLINK",65,0)
 S X=WVLABAN,Y=0
"RTN","WVLRLINK",66,0)
 K DD,DO
"RTN","WVLRLINK",67,0)
 N DIC,DLAYGO
"RTN","WVLRLINK",68,0)
 S DIC("DR")=WVDR,DIC="^WV(790.08,",DIC(0)="ML",DLAYGO=790.08
"RTN","WVLRLINK",69,0)
 D FILE^DICN
"RTN","WVLRLINK",70,0)
 Q:Y<1  ;FILE 790.08 entry was not created
"RTN","WVLRLINK",71,0)
 D MAIL^WVLABWP(DFN,WVLABAN,WVPROV,LRSS) ;patient, lab accession #, provider/requestor, lab subscript (CY or SP)
"RTN","WVLRLINK",72,0)
 Q
"RTN","WVLRLINK",73,0)
EXIT ;EP
"RTN","WVLRLINK",74,0)
 K I,N,X
"RTN","WVLRLINK",75,0)
 I $D(ZTQUEUED) S ZTREQ="@"
"RTN","WVLRLINK",76,0)
 Q
"RTN","WVLRLINK",77,0)
DELETE(DFN,LRDFN,LRI,LRA,LRSS) ;
"RTN","WVLRLINK",78,0)
 ; Modify WH to reflect change in lab report status (no longer released).
"RTN","WVLRLINK",79,0)
 ; Called by REPORT RELEASE DATE/TIME field xref in:
"RTN","WVLRLINK",80,0)
 ; a) File 63, Field 63.08,.11
"RTN","WVLRLINK",81,0)
 ; b) File 63, Field 63.09,.11
"RTN","WVLRLINK",82,0)
 Q:'$D(DFN)!('$D(LRDFN))!('$D(LRI))!('$D(LRA))!('$D(LRSS))
"RTN","WVLRLINK",83,0)
 Q:'$D(^WV(790.02,DUZ(2)))  ;no site parameter entry
"RTN","WVLRLINK",84,0)
 Q:'$P($G(^WV(790.02,+$G(DUZ(2)),0)),U,24)  ;lab link is NO or null
"RTN","WVLRLINK",85,0)
 N ZTDESC,ZTDTH,ZTIO,ZTRTN,ZTSAVE
"RTN","WVLRLINK",86,0)
 S ZTRTN="DELETEQ^WVLRLINK",ZTDESC="WV Change in Lab Rpt Status"
"RTN","WVLRLINK",87,0)
 S ZTSAVE("DFN")="",ZTSAVE("LRDFN")="",ZTSAVE("LRI")="",ZTSAVE("LRA")=""
"RTN","WVLRLINK",88,0)
 S ZTSAVE("LRSS")=""
"RTN","WVLRLINK",89,0)
 S ZTIO="",ZTDTH=$H
"RTN","WVLRLINK",90,0)
 D ^%ZTLOAD
"RTN","WVLRLINK",91,0)
 Q
"RTN","WVLRLINK",92,0)
DELETEQ ; Called from DELETE above.
"RTN","WVLRLINK",93,0)
 N WVIEN,WVDATE,WVCMGR,WVLABAN,WVLOOP,WVMSG,WVNODE,WVPN ;,WVPROV
"RTN","WVLRLINK",94,0)
 N XMDUZ,XMSUB,XMTEXT,XMY ;send mail message to case manager
"RTN","WVLRLINK",95,0)
 S WVLABAN=$P(LRA,U,6) ;lab accession#
"RTN","WVLRLINK",96,0)
 Q:WVLABAN=""
"RTN","WVLRLINK",97,0)
 S WVIEN=$O(^WV(790.08,"B",WVLABAN,0))
"RTN","WVLRLINK",98,0)
 I WVIEN D DELETE^WVLABADD(WVIEN) Q  ;delete, not yet addressed
"RTN","WVLRLINK",99,0)
 Q:'$D(^WV(790.1,"F",WVLABAN))  ;never entered in WH procedure file
"RTN","WVLRLINK",100,0)
 ; Next look up lab test in WH procedure file and send warning message
"RTN","WVLRLINK",101,0)
 ; to WH case manager.
"RTN","WVLRLINK",102,0)
 S WVIEN=$O(^WV(790.1,"F",WVLABAN,0))
"RTN","WVLRLINK",103,0)
 Q:'$D(^WV(790.1,WVIEN,0))
"RTN","WVLRLINK",104,0)
 D RADMOD^WVPROC(WVIEN) ;update procedure status to "open"
"RTN","WVLRLINK",105,0)
 S WVCMGR=+$$GET1^DIQ(790,DFN,.1,"I") ;get case manager
"RTN","WVLRLINK",106,0)
 S:WVCMGR XMY(WVCMGR)=""
"RTN","WVLRLINK",107,0)
 ; if no case manager, then get default case manager(s)
"RTN","WVLRLINK",108,0)
 I 'WVCMGR S WVLOOP=0 F  S WVLOOP=$O(^WV(790.02,WVLOOP)) Q:'WVLOOP  D
"RTN","WVLRLINK",109,0)
 .S WVCMGR=$$GET1^DIQ(790.02,WVLOOP,.02,"I")
"RTN","WVLRLINK",110,0)
 .S:WVCMGR XMY(WVCMGR)=""
"RTN","WVLRLINK",111,0)
 .Q
"RTN","WVLRLINK",112,0)
 Q:$O(XMY(0))'>0  ;no case manager(s)
"RTN","WVLRLINK",113,0)
 ;S:WVPROV XMY(WVPROV)=""
"RTN","WVLRLINK",114,0)
 S WVNODE=$G(^WV(790.1,+WVIEN,0))
"RTN","WVLRLINK",115,0)
 S WVPN=$E($P(WVNODE,U,1),1,2),WVPN=$$PN(WVPN)
"RTN","WVLRLINK",116,0)
 S XMDUZ=.5 ;message sender
"RTN","WVLRLINK",117,0)
 S XMSUB="Lab Report for WH patient is UNVERIFIED"
"RTN","WVLRLINK",118,0)
 S WVMSG(1)="        Patient: "_$P($G(^DPT(DFN,0)),U,1)_" (SSN: "_$$SSN^WVUTL1(DFN)_")"
"RTN","WVLRLINK",119,0)
 S WVMSG(2)=" WH Accession #: "_$P(WVNODE,U,1)_"  Procedure Type: "_$S(WVPN]"":WVPN,1:"Unknown")
"RTN","WVLRLINK",120,0)
 S WVMSG(3)="Lab Accession #: "_WVLABAN
"RTN","WVLRLINK",121,0)
 S WVMSG(4)=" "
"RTN","WVLRLINK",122,0)
 S WVMSG(5)="NOTE: This lab test has been UNVERIFIED in the LAB package."
"RTN","WVLRLINK",123,0)
 S WVMSG(6)=" "
"RTN","WVLRLINK",124,0)
 S WVMSG(7)="The status of the associated WH procedure has been changed to 'open',"
"RTN","WVLRLINK",125,0)
 S WVMSG(8)="You may wish to contact Lab Service to find out the reason for the change."
"RTN","WVLRLINK",126,0)
 S WVMSG(9)="Please use the 'Edit a Procedure' option in the WOMEN'S HEALTH package"
"RTN","WVLRLINK",127,0)
 S WVMSG(10)="to modify/close this procedure."
"RTN","WVLRLINK",128,0)
 S XMTEXT="WVMSG("
"RTN","WVLRLINK",129,0)
 D ^XMD
"RTN","WVLRLINK",130,0)
 I $D(ZTQUEUED) S ZTREQ="@"
"RTN","WVLRLINK",131,0)
 Q
"RTN","WVLRLINK",132,0)
HL(WVLOC) ; Get Hospital Location file (#44) pointer
"RTN","WVLRLINK",133,0)
 N WVARRAY,WVERR
"RTN","WVLRLINK",134,0)
 D FIND^DIC(44,"","","X",WVLOC,"","C","","","WVARRAY","WVERR")
"RTN","WVLRLINK",135,0)
 I +$G(WVARRAY("DILIST",0))=1 Q +WVARRAY("DILIST",2,1)
"RTN","WVLRLINK",136,0)
 Q ""
"RTN","WVLRLINK",137,0)
PN(X) ; Get procedure name
"RTN","WVLRLINK",138,0)
 I X="" Q ""
"RTN","WVLRLINK",139,0)
 S X=$O(^WV(790.2,"D",X,0)) ;look at abbreviation x-ref
"RTN","WVLRLINK",140,0)
 I 'X Q ""
"RTN","WVLRLINK",141,0)
 S X=$P($G(^WV(790.2,+X,0)),U,1)
"RTN","WVLRLINK",142,0)
 Q X
"RTN","WVLRLINK",143,0)
 ;
"RTN","WVLRLINK",144,0)
MOVE(DFN,LRDFN,LRI,LRA,LRSS) ; Called from Lab package when a lab accession is
"RTN","WVLRLINK",145,0)
 ; moved from one patient to another because the test was originally
"RTN","WVLRLINK",146,0)
 ; associated to the wrong patient.
"RTN","WVLRLINK",147,0)
 Q:'$D(DFN)!('$D(LRDFN))!('$D(LRI))!('$D(LRA))!('$D(LRSS))
"RTN","WVLRLINK",148,0)
 N ZTDESC,ZTDTH,ZTIO,ZTRTN,ZTSAVE
"RTN","WVLRLINK",149,0)
 S ZTRTN="MOVEQ^WVLRLINK",ZTDESC="WV Lab Accession moved to another patient"
"RTN","WVLRLINK",150,0)
 S ZTSAVE("DFN")="",ZTSAVE("LRDFN")="",ZTSAVE("LRI")="",ZTSAVE("LRA")=""
"RTN","WVLRLINK",151,0)
 S ZTSAVE("LRSS")="",ZTIO="",ZTDTH=$H
"RTN","WVLRLINK",152,0)
 D ^%ZTLOAD
"RTN","WVLRLINK",153,0)
 Q
"RTN","WVLRLINK",154,0)
MOVEQ ; Called from MOVE above
"RTN","WVLRLINK",155,0)
 N DA,DIE,DR
"RTN","WVLRLINK",156,0)
 N WVACCN,WVCMGR,WVDFN,WVIEN,WVLABAN,WVLOOP,WVNIEN,WVNODE,WVPIEN,WVPN,WVRD
"RTN","WVLRLINK",157,0)
 S WVLABAN=$P(LRA,U,6) ;lab accession#
"RTN","WVLRLINK",158,0)
 Q:WVLABAN=""
"RTN","WVLRLINK",159,0)
 S WVIEN=$O(^WV(790.08,"B",WVLABAN,0)) ;check WV LAB TESTS first
"RTN","WVLRLINK",160,0)
 I WVIEN D  Q  ;fix/delete File 790.8 entry, not a file (790.1) entry
"RTN","WVLRLINK",161,0)
 .D DELETE^WVLABADD(WVIEN)
"RTN","WVLRLINK",162,0)
 .Q
"RTN","WVLRLINK",163,0)
 ;
"RTN","WVLRLINK",164,0)
 S WVPIEN=$O(^WV(790.1,"F",WVLABAN,0)) ;check WH Procedure file
"RTN","WVLRLINK",165,0)
 Q:'WVPIEN  ;lab test was not converted into a WH procedure
"RTN","WVLRLINK",166,0)
 S WVNODE=$G(^WV(790.1,WVPIEN,0))
"RTN","WVLRLINK",167,0)
 S WVACCN=$P(WVNODE,U,1) ;WH accession#
"RTN","WVLRLINK",168,0)
 S WVDFN=+$P(WVNODE,U,2) ;DFN for existing patient
"RTN","WVLRLINK",169,0)
 Q:WVACCN=""
"RTN","WVLRLINK",170,0)
 S WVRD=$$RDC("Error/disregard")
"RTN","WVLRLINK",171,0)
 ; delete links to lab test entry so wrong lab report doesn't display
"RTN","WVLRLINK",172,0)
 S DIE="^WV(790.1,",DA=WVPIEN,DR=".05////"_WVRD_";2.17///@;2.18///@;2.19///@;2.2///@"
"RTN","WVLRLINK",173,0)
 ; include amended comment?
"RTN","WVLRLINK",174,0)
 D ^DIE
"RTN","WVLRLINK",175,0)
 S WVNIEN=$O(^WV(790.4,"C",WVACCN,0)) ;notification for that procedure?
"RTN","WVLRLINK",176,0)
 ; Send a mail message to case manager about patient change
"RTN","WVLRLINK",177,0)
 D MOVE^WVLABWP(WVDFN,WVNODE,WVNIEN)
"RTN","WVLRLINK",178,0)
 I $D(ZTQUEUED) S ZTREQ="@"
"RTN","WVLRLINK",179,0)
 Q
"RTN","WVLRLINK",180,0)
RDC(WVRD) ; Return ien of Result/Diagnosis code
"RTN","WVLRLINK",181,0)
 ; input text of result/diagnois
"RTN","WVLRLINK",182,0)
 I WVRD="" Q ""
"RTN","WVLRLINK",183,0)
 Q +$O(^WV(790.31,"B",WVRD,0))
"RTN","WVLRLINK",184,0)
 ;
"RTN","WVLRLINK",185,0)
VNVEC() ; Veteran/Non-Veteran/Eligibility Code check
"RTN","WVLRLINK",186,0)
 ; DFN must be defined
"RTN","WVLRLINK",187,0)
 ; Returns 1 - veteran
"RTN","WVLRLINK",188,0)
 ;             include all non-vets flag set to YES
"RTN","WVLRLINK",189,0)
 ;             non-vet patient's eligibility code is on list to track 
"RTN","WVLRLINK",190,0)
 N WVALL,WVLOOP,X,Y
"RTN","WVLRLINK",191,0)
 I $E($$VET^WVUTL1A(DFN))="Y" Q 1  ;veteran
"RTN","WVLRLINK",192,0)
 S WVALL=$P($G(^WV(790.02,DUZ(2),0)),U,26) ;include all non-vets
"RTN","WVLRLINK",193,0)
 I WVALL=1!(WVALL="") Q 1  ;1=YES
"RTN","WVLRLINK",194,0)
 S WVLOOP=+$$ELIG^WVUTL9(DFN) ;internal^external elig code
"RTN","WVLRLINK",195,0)
 I 'WVLOOP Q 0  ;no eligibility code
"RTN","WVLRLINK",196,0)
 I $D(^WV(790.02,DUZ(2),6,WVLOOP)) Q 1  ;code is on list to be tracked
"RTN","WVLRLINK",197,0)
 Q 0
"RTN","WVLRLINK",198,0)
 ;
"RTN","WVRALINK")
0^3^B50516773^B50520938
"RTN","WVRALINK",1,0)
WVRALINK ;HCIOFO/FT-RAD/NM-WOMEN'S HEALTH LINK  ;6/10/04  14:51
"RTN","WVRALINK",2,0)
 ;;1.0;WOMEN'S HEALTH;**3,5,7,9,10,16,18,23,25**;Sep 30, 1998;Build 1
"RTN","WVRALINK",3,0)
 ;
"RTN","WVRALINK",4,0)
 ; This routine uses the following IAs:
"RTN","WVRALINK",5,0)
 ; #2480  - FILE 70         (private)
"RTN","WVRALINK",6,0)
 ; #2481  - FILE 71         (private)
"RTN","WVRALINK",7,0)
 ; #2482  - FILE 71.2       (private)
"RTN","WVRALINK",8,0)
 ; #10035 - FILE 2          (supported)
"RTN","WVRALINK",9,0)
 ; #10063 - ^%ZTLOAD        (supported)
"RTN","WVRALINK",10,0)
 ; #10070 - ^XMD            (supported)
"RTN","WVRALINK",11,0)
 ; #10141 - ^XPDUTL         (supported)
"RTN","WVRALINK",12,0)
 ; #2541  - ^XUPARAM        (supported)
"RTN","WVRALINK",13,0)
 ;
"RTN","WVRALINK",14,0)
 ;;  Original routine created by IHS/ANMC/MWR
"RTN","WVRALINK",15,0)
 ;;* MICHAEL REMILLARD, DDS * ALASKA NATIVE MEDICAL CENTER *
"RTN","WVRALINK",16,0)
 ;;  CREATE MAMMOGRAM PROCEDURE IN WOMEN'S HEALTH FOR THIS PATIENT.
"RTN","WVRALINK",17,0)
 ;;  CALLED BY ^RART WHEN A RADIOLOGY REPORT IS VERIFIED.
"RTN","WVRALINK",18,0)
 ;;  CALLED BY ^RARTE1 WHEN A RADIOLOGY REPORT IS UNVERIFIED.
"RTN","WVRALINK",19,0)
 ;;  CALLED BY ^WVEXPTRA WHEN EXPORTING HISTORICAL MAMS TO WOMEN'S HEALTH
"RTN","WVRALINK",20,0)
 ;
"RTN","WVRALINK",21,0)
 ;---> REQUIRED VARIABLES: DFN  = DFN OF RADIOLOGY PATIENT.
"RTN","WVRALINK",22,0)
 ;--->                     DATE = INVERSE DATE/TIME OF VISIT.
"RTN","WVRALINK",23,0)
 ;--->                     CASE = IEN OF RADIOLOGY EXAM (CASE).
"RTN","WVRALINK",24,0)
 ;
"RTN","WVRALINK",25,0)
 ;---> OPTIONAL VARIABLE:  WVNEWP = TOTAL NEW WH PATIENTS ADDED.
"RTN","WVRALINK",26,0)
 ;--->                     WVMCNT = TOTAL NEW MAMS PROCEDURES ADDED.
"RTN","WVRALINK",27,0)
 ;--->                     THESE IF CALLED FROM ^WVEXPTRA ROUTINE.
"RTN","WVRALINK",28,0)
 ;
"RTN","WVRALINK",29,0)
 ;---> GENERATED VARIBLES:
"RTN","WVRALINK",30,0)
 ;---> WVPROC = IEN OF RADIOLOGY PROCEDURE (FILE #71), THEN IT
"RTN","WVRALINK",31,0)
 ;--->          GETS CHANGED TO WOMEN'S HEALTH PROCEDURE TYPE
"RTN","WVRALINK",32,0)
 ;--->                                   (FILE #790.2).
"RTN","WVRALINK",33,0)
 ;---> WVLOC  = WARD/CLINIC/LOCATION (FILE #44).
"RTN","WVRALINK",34,0)
 ;---> WVDATE = DATE OF THE PROCEDURE.
"RTN","WVRALINK",35,0)
 ;---> WVPROV = ORDERING PROVIDER.
"RTN","WVRALINK",36,0)
 ;---> WVMOD  = LEFT OR RIGHT, IF IT'S A UNILATERAL MAMMOGRAM.
"RTN","WVRALINK",37,0)
 ;---> WVDX   = RADIOLOGY DIAGNOSTIC CODE.
"RTN","WVRALINK",38,0)
 ;---> WVBWDX = WOMEN'S HEALTH RESULT/DIAGNOSIS.
"RTN","WVRALINK",39,0)
 ;
"RTN","WVRALINK",40,0)
CREATE(DFN,DATE,CASE) ;
"RTN","WVRALINK",41,0)
 Q:'+$$VERSION^XPDUTL("WV")
"RTN","WVRALINK",42,0)
 Q:($G(DFN)']"")!($G(DATE)']"")!($G(CASE)']"")
"RTN","WVRALINK",43,0)
 N ZTDESC,ZTDTH,ZTIO,ZTRTN,ZTSAVE
"RTN","WVRALINK",44,0)
 S:'$D(DUZ)#2 DUZ=.5
"RTN","WVRALINK",45,0)
 S:'+$G(DUZ(2)) DUZ(2)=$$KSP^XUPARAM("INST")
"RTN","WVRALINK",46,0)
 S ZTRTN="CREATEQ^WVRALINK",ZTDESC="WV CREATE MAMMOGRAM ENTRY"
"RTN","WVRALINK",47,0)
 S ZTSAVE("DFN")="",ZTSAVE("DATE")="",ZTSAVE("CASE")=""
"RTN","WVRALINK",48,0)
 S ZTIO="",ZTDTH=$H
"RTN","WVRALINK",49,0)
 D ^%ZTLOAD
"RTN","WVRALINK",50,0)
 Q
"RTN","WVRALINK",51,0)
CREATEH(DFN,DATE,CASE,STATUS) ; Entry from ^WVEXPTRA which looks for exams
"RTN","WVRALINK",52,0)
 ; created before the WH package was installed.
"RTN","WVRALINK",53,0)
 Q:($G(DFN)']"")!($G(DATE)']"")!($G(CASE)']"")!($G(STATUS)']"")
"RTN","WVRALINK",54,0)
 ; 
"RTN","WVRALINK",55,0)
CREATEQ ; Queue data entry creation. Called from CREATE above
"RTN","WVRALINK",56,0)
 N WVPROC,WVLOC,WVDATE,WVDR,WVPROV,WVMOD,WVDX,WVBWDX,WVLEFT,WVRIGHT
"RTN","WVRALINK",57,0)
 N WVCASE,WVCPT,WVERR,WVCREDIT,WVEXAM0,WVZSTAT
"RTN","WVRALINK",58,0)
 ;---> QUIT IF RADIOLOGY DATA IS NOT DEFINED OR ="".
"RTN","WVRALINK",59,0)
 I $D(ZTQUEUED) S ZTREQ="@"
"RTN","WVRALINK",60,0)
 Q:'$D(^RADPT(DFN,"DT",DATE,"P",CASE,0))
"RTN","WVRALINK",61,0)
 ;
"RTN","WVRALINK",62,0)
 ;---> QUIT IF THIS PROCEDURE DOES NOT HAVE A MAM CPT CODE.
"RTN","WVRALINK",63,0)
 ;---> QUIT IF THIS PROCEDURE DOES NOT HAVE AN ULTRASOUND CPT CODE.
"RTN","WVRALINK",64,0)
 ;---> WVEXAM0=ZERO NODE OF RADIOLOGY EXAM.
"RTN","WVRALINK",65,0)
 S WVEXAM0=^RADPT(DFN,"DT",DATE,"P",CASE,0)
"RTN","WVRALINK",66,0)
 S WVCPT=$$GET1^DIQ(71,$P(WVEXAM0,U,2),9,"I") Q:WVCPT=""
"RTN","WVRALINK",67,0)
 S WVPROC=$O(^WV(790.2,"AC",WVCPT,0)) ;cpt code x-ref to get 790.2 ien
"RTN","WVRALINK",68,0)
 Q:'WVPROC  ;cpt code is not tracked in 790.2
"RTN","WVRALINK",69,0)
 Q:$P($G(^WV(790.2,+WVPROC,0)),U,5)'="R"  ;cpt is not rad/nm procedure
"RTN","WVRALINK",70,0)
 Q:$P($G(^DPT(DFN,0)),U,2)'="F"  ;not female
"RTN","WVRALINK",71,0)
 ;
"RTN","WVRALINK",72,0)
 ;---> QUIT IF NO WOMEN'S HEALTH SITE PARAMETER FILE ON THIS MACHINE.
"RTN","WVRALINK",73,0)
 ;     OR NO DEFAULT CASE MANAGER
"RTN","WVRALINK",74,0)
 Q:'$D(^WV(790.02,DUZ(2)))
"RTN","WVRALINK",75,0)
 Q:'$P($G(^WV(790.02,+$G(DUZ(2)),0)),U,2)
"RTN","WVRALINK",76,0)
 ;
"RTN","WVRALINK",77,0)
 ;---> IF NOT CALLED FROM ^WVEXPTRA (i.e., STATUS is undefined) CHECK
"RTN","WVRALINK",78,0)
 ;---> SITE PARAMETER AND QUIT IF "IMPORT MAMMOGRAMS FROM RADIOLOGY"
"RTN","WVRALINK",79,0)
 ;---> IS NOT SET TO "YES". CHECK VETERAN STATUS AND ELIGIBILITY CODE.
"RTN","WVRALINK",80,0)
 N Y S Y=^WV(790.02,DUZ(2),0)
"RTN","WVRALINK",81,0)
 I '$D(STATUS) Q:'$P(Y,U,10)
"RTN","WVRALINK",82,0)
 I '$D(STATUS) Q:'$$VNVEC^WVRALIN1()  ;vet/non-vet/eligibility code check
"RTN","WVRALINK",83,0)
 ;
"RTN","WVRALINK",84,0)
 ;---> SET WVZSTAT =THE STATUS (OPEN OR CLOSED) IN WOMEN'S HEALTH.
"RTN","WVRALINK",85,0)
 ;---> THAT MAMMOGRAMS SHOULD RECEIVE WHEN COPIED OVER FROM RADIOLOGY.
"RTN","WVRALINK",86,0)
 S WVZSTAT=$P(Y,U,23) S:WVZSTAT="" WVZSTAT="o"
"RTN","WVRALINK",87,0)
 I $G(STATUS)]"" S WVZSTAT=$G(STATUS) ;status selected in ^WVEXPTRA
"RTN","WVRALINK",88,0)
 ;
"RTN","WVRALINK",89,0)
 D COPY(WVEXAM0)
"RTN","WVRALINK",90,0)
 ;
"RTN","WVRALINK",91,0)
EXIT ;EP
"RTN","WVRALINK",92,0)
 K I,N,X
"RTN","WVRALINK",93,0)
 Q
"RTN","WVRALINK",94,0)
 ;
"RTN","WVRALINK",95,0)
COPY(Y) ;EP
"RTN","WVRALINK",96,0)
 ;---> COPY MAM PROCEDURE DATA FROM RADIOLOGY TO WOMEN'S HEALTH.
"RTN","WVRALINK",97,0)
 ;---> VARIABLE DFN=PATIENT
"RTN","WVRALINK",98,0)
 ;---> LOCATION=DUZ(2)
"RTN","WVRALINK",99,0)
 ;---> WARD/CLINIC/LOCATION
"RTN","WVRALINK",100,0)
 N X
"RTN","WVRALINK",101,0)
 S WVLOC=$P(Y,U,8)
"RTN","WVRALINK",102,0)
 ;
"RTN","WVRALINK",103,0)
 ;---> WVDATE=DATE OF THE PROCEDURE.
"RTN","WVRALINK",104,0)
 S WVDATE=$P($P(^RADPT(DFN,"DT",DATE,0),U),".")
"RTN","WVRALINK",105,0)
 ;
"RTN","WVRALINK",106,0)
 ;---> RECONSTRUCT THE FULL CASE# FOR THIS RAD PROCEDURE.
"RTN","WVRALINK",107,0)
 ;---> THIS IS USED AS A LINK (XREF) BETWEEN THE RADIOLOGY PROCEDURE
"RTN","WVRALINK",108,0)
 ;---> AND THE WOMEN'S HEALTH PROCEDURE.
"RTN","WVRALINK",109,0)
 S WVCASE=$E(WVDATE,4,7)_$E(WVDATE,2,3)_"-"_$P(Y,U)
"RTN","WVRALINK",110,0)
 ;---> CHECK TO BE SURE THE CASE# XREF IS REALLY DOWN THERE.
"RTN","WVRALINK",111,0)
 S:'$D(^RADPT("ADC",WVCASE,DFN,DATE,CASE)) WVCASE="UNKNOWN"
"RTN","WVRALINK",112,0)
 ;
"RTN","WVRALINK",113,0)
 ;---> QUIT IF THIS PROCEDURE HAS ALREADY BEEN SENT TO WOMEN'S HEALTH.
"RTN","WVRALINK",114,0)
 Q:$D(^WV(790.1,"E",WVCASE))
"RTN","WVRALINK",115,0)
 ;
"RTN","WVRALINK",116,0)
 ;---> REQUESTING PROVIDER/ORDERING PROVIDER
"RTN","WVRALINK",117,0)
 S WVPROV=$P(Y,U,14)
"RTN","WVRALINK",118,0)
 ;
"RTN","WVRALINK",119,0)
 ;---> IF UNILATERAL, ATTEMPT TO PICK UP LEFT OR RIGHT MODIFIER.
"RTN","WVRALINK",120,0)
 I WVPROC=26 D
"RTN","WVRALINK",121,0)
 .I $D(^RADPT(DFN,"DT",DATE,"P",CASE,"M",0)) D
"RTN","WVRALINK",122,0)
 ..N N S N=0
"RTN","WVRALINK",123,0)
 ..F  S N=$O(^RADPT(DFN,"DT",DATE,"P",CASE,"M",N)) Q:'N  D
"RTN","WVRALINK",124,0)
 ...S WVMOD=$P(^RADPT(DFN,"DT",DATE,"P",CASE,"M",N,0),U)
"RTN","WVRALINK",125,0)
 ...S WVMOD=$$GET1^DIQ(71.2,WVMOD,.01,"I")
"RTN","WVRALINK",126,0)
 ...I "LEFTleft"[WVMOD S WVLEFT=1
"RTN","WVRALINK",127,0)
 ...I "RIGHTright"[WVMOD S WVRIGHT=1
"RTN","WVRALINK",128,0)
 ..Q:$D(WVLEFT)&($D(WVRIGHT))
"RTN","WVRALINK",129,0)
 ..I $D(WVLEFT) S WVMOD="l" Q
"RTN","WVRALINK",130,0)
 ..I $D(WVRIGHT) S WVMOD="r" Q
"RTN","WVRALINK",131,0)
 ;
"RTN","WVRALINK",132,0)
 ;---> IF THERE'S A DIAGNOSTIC CODE, ATTEMPT TO PICK UP DIAGNOSIS.
"RTN","WVRALINK",133,0)
 ;---> USE "WV DIAGNOSTIC CODE TRANSLATION" FILE #790.32.
"RTN","WVRALINK",134,0)
 S WVDX=$P(Y,U,13)
"RTN","WVRALINK",135,0)
 I +WVDX I $D(^WV(790.32,"C",WVDX)) S WVBWDX=$O(^WV(790.32,"C",WVDX,0))
"RTN","WVRALINK",136,0)
 ;
"RTN","WVRALINK",137,0)
 ;---> GET CREDIT METHOD.
"RTN","WVRALINK",138,0)
 S WVCREDIT=$P(Y,U,26)
"RTN","WVRALINK",139,0)
 ;
"RTN","WVRALINK",140,0)
PATIENT ;---> IF PATIENT ISN'T IN WOMEN'S HEALTH DATABASE, ADD HER.
"RTN","WVRALINK",141,0)
 S WVERR=1
"RTN","WVRALINK",142,0)
 I '$D(^WV(790,DFN,0)) D
"RTN","WVRALINK",143,0)
 .D AUTOADD^WVPATE(DFN,DUZ(2),.WVERR)
"RTN","WVRALINK",144,0)
 .I $D(WVNEWP) S:WVERR WVNEWP=WVNEWP+1
"RTN","WVRALINK",145,0)
 Q:WVERR<0
"RTN","WVRALINK",146,0)
 D FIND^WVRALIN1 ;check for 'unlinked' entry in File 790.1
"RTN","WVRALINK",147,0)
 Q:$D(^WV(790.1,"E",WVCASE))  ;quit if link was made in WVRALIN1
"RTN","WVRALINK",148,0)
PROC ;---> CREATE MAMMOGRAM PROCEDURE IN WV PROCEDURE FILE #790.1.
"RTN","WVRALINK",149,0)
 S WVDR=".02////"_DFN_";.04////"_WVPROC
"RTN","WVRALINK",150,0)
 S WVDR=WVDR_";.05////"_$G(WVBWDX)_";.07////"_WVPROV
"RTN","WVRALINK",151,0)
 S WVDR=WVDR_";.09////"_$G(WVMOD)_";.1////"_DUZ(2)_";.11////"_WVLOC
"RTN","WVRALINK",152,0)
 S WVDR=WVDR_";.12////"_WVDATE_";.14////"_WVZSTAT_";.15////"_WVCASE
"RTN","WVRALINK",153,0)
 S WVDR=WVDR_";.18////.5;.19////"_DT_";.34////"_$G(DUZ(2))_";.35////"_WVCREDIT
"RTN","WVRALINK",154,0)
 ;
"RTN","WVRALINK",155,0)
 D NEW2^WVPROC(DFN,WVPROC,WVDATE,WVDR,"","",.WVERR)
"RTN","WVRALINK",156,0)
 I $D(WVMCNT) S:WVERR>-1 WVMCNT=WVMCNT+1
"RTN","WVRALINK",157,0)
 Q:WVERR<0  ;procedure not added
"RTN","WVRALINK",158,0)
 Q:$D(WVMCNT)  ;mass import of Rad/NM exams
"RTN","WVRALINK",159,0)
 ;Q:$P($G(^WV(790.02,+DUZ(2),0)),U,23)="c"  ;Status=closed
"RTN","WVRALINK",160,0)
 I (WVCPT=76856)!(WVCPT=76830)!(WVCPT=76645) D  Q  ;not breast related
"RTN","WVRALINK",161,0)
 .D MAIL^WVRADWP(DFN,+Y,WVPROC,WVPROV) ;iens for patient, accession, procedure, provider/requestor
"RTN","WVRALINK",162,0)
 .Q
"RTN","WVRALINK",163,0)
 D CPRS^WVSNOMED(69,DFN,"",WVPROV,"Mammogram results available.",DATE_"~"_CASE)
"RTN","WVRALINK",164,0)
 Q
"RTN","WVRALINK",165,0)
 ;
"RTN","WVRALINK",166,0)
DELETE(DFN,DATE,CASE) ;EP
"RTN","WVRALINK",167,0)
 ;---> MODIFY WOMEN'S HEALTH PROCEDURE TO REFLECT CHANGE.
"RTN","WVRALINK",168,0)
 ;---> CALLED FROM RARTE1 (DELETE A REPORT AND UNVERIFY A REPORT).
"RTN","WVRALINK",169,0)
 ;
"RTN","WVRALINK",170,0)
 Q:'+$$VERSION^XPDUTL("WV")
"RTN","WVRALINK",171,0)
 Q:'$D(DFN)!('$D(DATE))!('$D(CASE))
"RTN","WVRALINK",172,0)
 N ZTDESC,ZTDTH,ZTIO,ZTRTN,ZTSAVE
"RTN","WVRALINK",173,0)
 S ZTRTN="DELETEQ^WVRALINK",ZTDESC="WV MAMMOGRAM RPT CHANGE"
"RTN","WVRALINK",174,0)
 S ZTSAVE("DFN")="",ZTSAVE("DATE")="",ZTSAVE("CASE")=""
"RTN","WVRALINK",175,0)
 S ZTIO="",ZTDTH=$H
"RTN","WVRALINK",176,0)
 D ^%ZTLOAD
"RTN","WVRALINK",177,0)
 Q
"RTN","WVRALINK",178,0)
DELETEQ ; Modify WV entry when mammogram report is unverified or deleted
"RTN","WVRALINK",179,0)
 Q:'$D(^RADPT(DFN,"DT",DATE,"P",CASE,0))
"RTN","WVRALINK",180,0)
 N WVIEN,WVDATE,WVCASE,WVCMGR,WVLOOP,WVMSG,WVPROV
"RTN","WVRALINK",181,0)
 N XMDUZ,XMSUB,XMTEXT,XMY ;send mail message to case manager
"RTN","WVRALINK",182,0)
 I $D(ZTQUEUED) S ZTREQ="@"
"RTN","WVRALINK",183,0)
 ;
"RTN","WVRALINK",184,0)
 ;---> WVDATE=DATE OF PROCEDURE.
"RTN","WVRALINK",185,0)
 S WVDATE=$P($P(^RADPT(DFN,"DT",DATE,0),U),".")
"RTN","WVRALINK",186,0)
 S WVCASE=$P(^RADPT(DFN,"DT",DATE,"P",CASE,0),U)
"RTN","WVRALINK",187,0)
 ;
"RTN","WVRALINK",188,0)
 ;---> WVCASE=RECONSTRUCTED CASE# OF PROCEDURE.
"RTN","WVRALINK",189,0)
 S WVCASE=$E(WVDATE,4,7)_$E(WVDATE,2,3)_"-"_WVCASE
"RTN","WVRALINK",190,0)
 ;---> QUIT IF NO CASE# XREF IN WOMEN'S HEALTH PROCEDURE FILE.
"RTN","WVRALINK",191,0)
 Q:'$D(^WV(790.1,"E",WVCASE))
"RTN","WVRALINK",192,0)
 ;
"RTN","WVRALINK",193,0)
 S WVIEN=$O(^WV(790.1,"E",WVCASE,0))
"RTN","WVRALINK",194,0)
 Q:'$D(^WV(790.1,WVIEN,0))
"RTN","WVRALINK",195,0)
 D RADMOD^WVPROC(WVIEN) ;update wh status to "open"
"RTN","WVRALINK",196,0)
 S WVPROV=+$$GET1^DIQ(790.1,WVIEN,.07,"I") ;get provider/requestor
"RTN","WVRALINK",197,0)
 S WVCMGR=+$$GET1^DIQ(790,DFN,.1,"I") ;get case manager
"RTN","WVRALINK",198,0)
 S:WVCMGR XMY(WVCMGR)=""
"RTN","WVRALINK",199,0)
 ; if no case manager, then get default case manager(s)
"RTN","WVRALINK",200,0)
 I 'WVCMGR S WVLOOP=0 F  S WVLOOP=$O(^WV(790.02,WVLOOP)) Q:'WVLOOP  D
"RTN","WVRALINK",201,0)
 .S WVCMGR=$$GET1^DIQ(790.02,WVLOOP,.02,"I")
"RTN","WVRALINK",202,0)
 .S:WVCMGR XMY(WVCMGR)=""
"RTN","WVRALINK",203,0)
 .Q
"RTN","WVRALINK",204,0)
 Q:$O(XMY(0))'>0  ;no case manager(s)
"RTN","WVRALINK",205,0)
 S:WVPROV XMY(WVPROV)=""
"RTN","WVRALINK",206,0)
 S XMDUZ=.5 ;message sender
"RTN","WVRALINK",207,0)
 S XMSUB="RAD/NM Rpt for WH patient is UNVERIFIED/DELETED"
"RTN","WVRALINK",208,0)
 S WVMSG(1)="        Patient: "_$P($G(^DPT(DFN,0)),U,1)_" (SSN: "_$$SSN^WVUTL1(DFN)_")"
"RTN","WVRALINK",209,0)
 S WVMSG(2)=" WH Accession #: "_$P($G(^WV(790.1,+WVIEN,0)),U,1)
"RTN","WVRALINK",210,0)
 S WVMSG(3)="  RAD/NM Case #: "_WVCASE
"RTN","WVRALINK",211,0)
 S WVMSG(4)=" "
"RTN","WVRALINK",212,0)
 S WVMSG(5)="NOTE: THIS PROCEDURE HAS BEEN ALTERED IN RADIOLOGY/NM."
"RTN","WVRALINK",213,0)
 S WVMSG(6)="Follow-up is required in the WOMEN'S HEALTH package!"
"RTN","WVRALINK",214,0)
 S XMTEXT="WVMSG("
"RTN","WVRALINK",215,0)
 D ^XMD
"RTN","WVRALINK",216,0)
 Q
"RTN","WVSNOMED")
0^2^B27535535^B25930871
"RTN","WVSNOMED",1,0)
WVSNOMED ;HIOFO/FT-IS LAB TEST A PAP SMEAR? ;2/12/04  14:37
"RTN","WVSNOMED",2,0)
 ;;1.0;WOMEN'S HEALTH;**16,23,25**;Sep 30, 1998;Build 1
"RTN","WVSNOMED",3,0)
 ;
"RTN","WVSNOMED",4,0)
 ; This routine uses the following IAs:
"RTN","WVSNOMED",5,0)
 ;  #1362 - ^ORB3               (controlled)
"RTN","WVSNOMED",6,0)
 ;   #525 - ^LR references      (controlled)
"RTN","WVSNOMED",7,0)
 ;  #4298 - ^LR references      (private)
"RTN","WVSNOMED",8,0)
 ; #10035 - ^DPT( references    (supported)
"RTN","WVSNOMED",9,0)
 ; #10070 - ^XMD                (supported)
"RTN","WVSNOMED",10,0)
 ; #10141 - ^XPDUTL             (supported)
"RTN","WVSNOMED",11,0)
 ;
"RTN","WVSNOMED",12,0)
SNOMED() ; Check lab test for SNOMED codes that indicate if pap smear.
"RTN","WVSNOMED",13,0)
 ; LRDFN,LRI,LRSS must be defined.
"RTN","WVSNOMED",14,0)
 ; Returns: 0 - lab test is not a pap smear
"RTN","WVSNOMED",15,0)
 ;          1 - lab test is a pap smear
"RTN","WVSNOMED",16,0)
 ; 
"RTN","WVSNOMED",17,0)
 N WVPAP,WVPIEN,WVPIEN1,WVSNOMED,WVTOP
"RTN","WVSNOMED",18,0)
 ; WVTOP array identifies SNOMED codes (IENS) used for pap smears
"RTN","WVSNOMED",19,0)
 S WVTOP(0)=0
"RTN","WVSNOMED",20,0)
 S WVPIEN=$$PAPIEN^WVRPCPR()
"RTN","WVSNOMED",21,0)
 I 'WVPIEN Q 0  ;pap smear procedure entry not found
"RTN","WVSNOMED",22,0)
 S WVPIEN1=0
"RTN","WVSNOMED",23,0)
 F  S WVPIEN1=$O(^WV(790.2,WVPIEN,2,WVPIEN1)) Q:'WVPIEN1  D
"RTN","WVSNOMED",24,0)
 .S WVSNOMED=$P($G(^WV(790.2,WVPIEN,2,WVPIEN1,0)),U,1)
"RTN","WVSNOMED",25,0)
 .Q:'WVSNOMED
"RTN","WVSNOMED",26,0)
 .S WVTOP(0)=WVTOP(0)+1
"RTN","WVSNOMED",27,0)
 .S WVTOP(WVSNOMED)=""
"RTN","WVSNOMED",28,0)
 .Q
"RTN","WVSNOMED",29,0)
 I WVTOP(0)=0 Q 0  ;no SNOMED codes identified
"RTN","WVSNOMED",30,0)
 K WVTOP(0)
"RTN","WVSNOMED",31,0)
 S WVPAP=0
"RTN","WVSNOMED",32,0)
 I LRSS="CY" S WVPAP=$$CY()
"RTN","WVSNOMED",33,0)
 I LRSS="SP" S WVPAP=$$SP()
"RTN","WVSNOMED",34,0)
 Q WVPAP
"RTN","WVSNOMED",35,0)
 ;
"RTN","WVSNOMED",36,0)
CY() ; Check SNOMED codes used by cytology entry
"RTN","WVSNOMED",37,0)
 N WVFLAG,WVLOOP,WVLOOP1,WVSNOMED
"RTN","WVSNOMED",38,0)
 S (WVFLAG,WVLOOP)=0
"RTN","WVSNOMED",39,0)
 ; check topography multiple
"RTN","WVSNOMED",40,0)
 F  S WVLOOP=$O(^LR(LRDFN,"CY",LRI,2,WVLOOP)) Q:'WVLOOP!(WVFLAG=1)  D
"RTN","WVSNOMED",41,0)
 .S WVSNOMED=+$P($G(^LR(LRDFN,"CY",LRI,2,WVLOOP,0)),U,1)
"RTN","WVSNOMED",42,0)
 .Q:'WVSNOMED
"RTN","WVSNOMED",43,0)
 .I $D(WVTOP(WVSNOMED)) S WVFLAG=1
"RTN","WVSNOMED",44,0)
 .Q
"RTN","WVSNOMED",45,0)
 Q WVFLAG
"RTN","WVSNOMED",46,0)
 ;
"RTN","WVSNOMED",47,0)
SP() ; Check SNOMED codes used by surgical pathology entry
"RTN","WVSNOMED",48,0)
 N WVFLAG,WVLOOP,WVLOOP1,WVSNOMED
"RTN","WVSNOMED",49,0)
 ; check topography multiple
"RTN","WVSNOMED",50,0)
 S (WVFLAG,WVLOOP)=0
"RTN","WVSNOMED",51,0)
 F  S WVLOOP=$O(^LR(LRDFN,"SP",LRI,2,WVLOOP)) Q:'WVLOOP!(WVFLAG=1)  D
"RTN","WVSNOMED",52,0)
 .S WVSNOMED=+$P($G(^LR(LRDFN,"SP",LRI,2,WVLOOP,0)),U,1)
"RTN","WVSNOMED",53,0)
 .Q:'WVSNOMED
"RTN","WVSNOMED",54,0)
 .I $D(WVTOP(WVSNOMED)) S WVFLAG=1
"RTN","WVSNOMED",55,0)
 .Q
"RTN","WVSNOMED",56,0)
 Q WVFLAG
"RTN","WVSNOMED",57,0)
 ;
"RTN","WVSNOMED",58,0)
ADD ; Add pap smear to FILE 790.1
"RTN","WVSNOMED",59,0)
 N WV7901,WVDR,WVPIEN,WVERR
"RTN","WVSNOMED",60,0)
 S WVERR=0
"RTN","WVSNOMED",61,0)
 I $D(^WV(790.1,"F",WVLABAN)) D  Q
"RTN","WVSNOMED",62,0)
 . I $$PATCH^XPDUTL("OR*3.0*210") D  Q
"RTN","WVSNOMED",63,0)
 ..D CPRS^WVSNOMED(70,DFN,"",WVPROV,"Pap Smear results available.",LRSS_U_WVLABAN_U_LRI)
"RTN","WVSNOMED",64,0)
 I '$D(^WV(790,DFN,0)) D  ;add patient to File 790, if not there
"RTN","WVSNOMED",65,0)
 .D AUTOADD^WVPATE(DFN,DUZ(2),.WVERR)
"RTN","WVSNOMED",66,0)
 .Q
"RTN","WVSNOMED",67,0)
 Q:WVERR<0  ;quit if new patient could not be added to File 790
"RTN","WVSNOMED",68,0)
 S WVPIEN=$$PAPIEN^WVRPCPR()
"RTN","WVSNOMED",69,0)
 S WVDR=".02////"_DFN
"RTN","WVSNOMED",70,0)
 S WVDR=WVDR_";.04////"_WVPIEN ;File 790.2 pointer
"RTN","WVSNOMED",71,0)
 S:WVPROV]"" WVDR=WVDR_";.07////"_WVPROV ;provider
"RTN","WVSNOMED",72,0)
 S WVDR=WVDR_";.1////"_$G(DUZ(2)) ;health care facility
"RTN","WVSNOMED",73,0)
 S:WVLOC]"" WVDR=WVDR_";.11////"_WVLOC ;patient location
"RTN","WVSNOMED",74,0)
 S WVDR=WVDR_";.12////"_WVDATE ;procedure date/time
"RTN","WVSNOMED",75,0)
 S WVDR=WVDR_";.14////"_"o" ;status
"RTN","WVSNOMED",76,0)
 S WVDR=WVDR_";.18////.5;.19////"_DT ;entering user and date
"RTN","WVSNOMED",77,0)
 S WVDR=WVDR_";.34////"_$G(DUZ(2)) ;accessioning facility
"RTN","WVSNOMED",78,0)
 S WVDR=WVDR_";2.17////"_WVLABAN ;lab accession#
"RTN","WVSNOMED",79,0)
 S WVDR=WVDR_";2.18////"_LRDFN ;Lab Data file (#63) pointer
"RTN","WVSNOMED",80,0)
 S WVDR=WVDR_";2.19////"_LRI ;Lab Data file inverse d/t
"RTN","WVSNOMED",81,0)
 S WVDR=WVDR_";2.2////"_LRSS ;Lab Data file subscript (CY/SP)
"RTN","WVSNOMED",82,0)
 ; add procedure to File 790.1
"RTN","WVSNOMED",83,0)
 D NEW2^WVPROC(DFN,WVPIEN,WVDATE,WVDR,"","",.WVERR)
"RTN","WVSNOMED",84,0)
 Q:'Y
"RTN","WVSNOMED",85,0)
 S WV7901=+Y
"RTN","WVSNOMED",86,0)
 I $$PATCH^XPDUTL("OR*3.0*210") D  Q
"RTN","WVSNOMED",87,0)
 .D CPRS^WVSNOMED(70,DFN,"",WVPROV,"Pap Smear results available.",LRSS_U_WVLABAN_U_LRI)
"RTN","WVSNOMED",88,0)
 .Q
"RTN","WVSNOMED",89,0)
 D MAIL(DFN,WVLABAN,WVPROV,LRSS,WV7901)
"RTN","WVSNOMED",90,0)
 Q
"RTN","WVSNOMED",91,0)
MAIL(DFN,WVLABAN,WVPROV,LRSS,WV7901) ; Send mail message to case manager
"RTN","WVSNOMED",92,0)
 ; when pap smear added to FILE 790.1
"RTN","WVSNOMED",93,0)
 ; Called from above
"RTN","WVSNOMED",94,0)
 ;      DFN -> Patient ien
"RTN","WVSNOMED",95,0)
 ;  WVLABAN -> Lab Accession# (e.g., CY 99 1)
"RTN","WVSNOMED",96,0)
 ;   WVPROV -> File 200   IEN (provider/requestor)
"RTN","WVSNOMED",97,0)
 ;     LRSS -> File 63 subscript (e.g., CY or SP)
"RTN","WVSNOMED",98,0)
 ;   WV7901 -> FILE 790.1 IEN
"RTN","WVSNOMED",99,0)
 Q:'$G(DFN)!($G(WVLABAN)="")!($G(LRSS)="")
"RTN","WVSNOMED",100,0)
 N WVCMGR,WVLOOP,WVMSG,XMDUZ,XMSUB,XMTEXT,XMY
"RTN","WVSNOMED",101,0)
 S WVCMGR=+$$GET1^DIQ(790,DFN,.1,"I") ;get case manager
"RTN","WVSNOMED",102,0)
 S:WVCMGR XMY(WVCMGR)=""
"RTN","WVSNOMED",103,0)
 ; if no case manager, then get default case manager(s)
"RTN","WVSNOMED",104,0)
 I 'WVCMGR S WVLOOP=0 F  S WVLOOP=$O(^WV(790.02,WVLOOP)) Q:'WVLOOP  D
"RTN","WVSNOMED",105,0)
 .S WVCMGR=$$GET1^DIQ(790.02,WVLOOP,.02,"I")
"RTN","WVSNOMED",106,0)
 .S:WVCMGR XMY(WVCMGR)=""
"RTN","WVSNOMED",107,0)
 .Q
"RTN","WVSNOMED",108,0)
 Q:$O(XMY(0))'>0  ;no case manager(s)
"RTN","WVSNOMED",109,0)
 S XMDUZ=.5 ;message sender
"RTN","WVSNOMED",110,0)
 S XMSUB="Pap Smear report verified for a WH patient"
"RTN","WVSNOMED",111,0)
 S WVMSG(1)="A "_$S(LRSS="CY":"Cytology ",LRSS="SP":"Surgical Pathology ",1:"")_"lab test was verified for:"
"RTN","WVSNOMED",112,0)
 S WVMSG(2)=" "
"RTN","WVSNOMED",113,0)
 S WVMSG(3)="                Patient: "_$P($G(^DPT(DFN,0)),U,1)_" (SSN: "_$$SSN^WVUTL1(DFN)_")"
"RTN","WVSNOMED",114,0)
 S WVMSG(4)="         WH Accession #: "_$P($G(^WV(790.1,+WV7901,0)),U,1)
"RTN","WVSNOMED",115,0)
 S WVMSG(5)="        LAB Accession #: "_WVLABAN
"RTN","WVSNOMED",116,0)
 S WVMSG(6)="Test Requestor/Provider: "_$S(+WVPROV:$$GET1^DIQ(200,+WVPROV,.01,"E"),1:"UNKNOWN")
"RTN","WVSNOMED",117,0)
 S WVMSG(7)=" "
"RTN","WVSNOMED",118,0)
 S WVMSG(8)="Please use CPRS to resolve the Clinical Reminder for this procedure and"
"RTN","WVSNOMED",119,0)
 S WVMSG(9)="complete the result."
"RTN","WVSNOMED",120,0)
 S XMTEXT="WVMSG("
"RTN","WVSNOMED",121,0)
 D ^XMD
"RTN","WVSNOMED",122,0)
 Q
"RTN","WVSNOMED",123,0)
 ;
"RTN","WVSNOMED",124,0)
CPRS(WVORN,WVDFN,WVORDER,WVPROV,WVMSG,WVIEN) ; Generate a CPRS alert
"RTN","WVSNOMED",125,0)
 ;   WVORN - FILE 100.9 IEN
"RTN","WVSNOMED",126,0)
 ;   WVDFN - FILE 2 IEN
"RTN","WVSNOMED",127,0)
 ; WVORDER - FILE 100 IEN (not currently used)
"RTN","WVSNOMED",128,0)
 ;  WVPROV - FILE 200 IEN
"RTN","WVSNOMED",129,0)
 ;   WVMSG - Free text message
"RTN","WVSNOMED",130,0)
 ;   WVIEN - IEN for a lab or radiology report (not currently used)
"RTN","WVSNOMED",131,0)
 ;
"RTN","WVSNOMED",132,0)
 Q:'$$PATCH^XPDUTL("OR*3.0*210")  ;no pap & mam alerts 
"RTN","WVSNOMED",133,0)
 Q:'WVDFN
"RTN","WVSNOMED",134,0)
 Q:'WVORN
"RTN","WVSNOMED",135,0)
 I WVPROV]"" S WVARRAY(WVPROV)="" ;provider's IEN
"RTN","WVSNOMED",136,0)
 S WVCMGR=$P($G(^WV(790,WVDFN,0)),U,10)
"RTN","WVSNOMED",137,0)
 I WVCMGR]"" S WVARRAY(WVCMGR)="" ;women's health case manager's IEN
"RTN","WVSNOMED",138,0)
 D EN^ORB3(WVORN,WVDFN,WVORDER,.WVARRAY,WVMSG,WVIEN)
"RTN","WVSNOMED",139,0)
 K WVARRAY,WVCMGR
"RTN","WVSNOMED",140,0)
 Q 
"VER")
8.0^22.0
"BLD",9672,6)
^22
**END**
**END**

