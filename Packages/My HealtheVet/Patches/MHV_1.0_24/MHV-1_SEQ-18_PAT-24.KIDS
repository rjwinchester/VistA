EMERGENCY Released MHV*1*24 SEQ #18
Extracted from mail message
**KIDS**:MHV*1.0*24^

**INSTALL NAME**
MHV*1.0*24
"BLD",8122,0)
MHV*1.0*24^My HealtheVet^0^3160216^y
"BLD",8122,1,0)
^^5^5^3160216^
"BLD",8122,1,1,0)
 
"BLD",8122,1,2,0)
 
"BLD",8122,1,3,0)
 
"BLD",8122,1,4,0)
 
"BLD",8122,1,5,0)
MHV Secure Messaging Workload Credit (SM WLC) ICD 10 EMERGENCY Issues Fix
"BLD",8122,4,0)
^9.64PA^^
"BLD",8122,6.3)
24
"BLD",8122,"ABPKG")
n
"BLD",8122,"INI")

"BLD",8122,"INID")
^^
"BLD",8122,"INIT")

"BLD",8122,"KRN",0)
^9.67PA^779.2^20
"BLD",8122,"KRN",.4,0)
.4
"BLD",8122,"KRN",.401,0)
.401
"BLD",8122,"KRN",.401,"NM",0)
^9.68A^^0
"BLD",8122,"KRN",.402,0)
.402
"BLD",8122,"KRN",.402,"NM",0)
^9.68A^^0
"BLD",8122,"KRN",.403,0)
.403
"BLD",8122,"KRN",.5,0)
.5
"BLD",8122,"KRN",.84,0)
.84
"BLD",8122,"KRN",3.6,0)
3.6
"BLD",8122,"KRN",3.8,0)
3.8
"BLD",8122,"KRN",9.2,0)
9.2
"BLD",8122,"KRN",9.2,"NM",0)
^9.68A^^
"BLD",8122,"KRN",9.8,0)
9.8
"BLD",8122,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",8122,"KRN",9.8,"NM",1,0)
MHVUMRPC^^0^B53770789
"BLD",8122,"KRN",9.8,"NM","B","MHVUMRPC",1)

"BLD",8122,"KRN",19,0)
19
"BLD",8122,"KRN",19,"NM",0)
^9.68A^^0
"BLD",8122,"KRN",19.1,0)
19.1
"BLD",8122,"KRN",19.1,"NM",0)
^9.68A^^
"BLD",8122,"KRN",101,0)
101
"BLD",8122,"KRN",101,"NM",0)
^9.68A^^0
"BLD",8122,"KRN",409.61,0)
409.61
"BLD",8122,"KRN",771,0)
771
"BLD",8122,"KRN",771,"NM",0)
^9.68A^^0
"BLD",8122,"KRN",779.2,0)
779.2
"BLD",8122,"KRN",870,0)
870
"BLD",8122,"KRN",870,"NM",0)
^9.68A^^0
"BLD",8122,"KRN",8989.51,0)
8989.51
"BLD",8122,"KRN",8989.52,0)
8989.52
"BLD",8122,"KRN",8994,0)
8994
"BLD",8122,"KRN",8994,"NM",0)
^9.68A^^0
"BLD",8122,"KRN","B",.4,.4)

"BLD",8122,"KRN","B",.401,.401)

"BLD",8122,"KRN","B",.402,.402)

"BLD",8122,"KRN","B",.403,.403)

"BLD",8122,"KRN","B",.5,.5)

"BLD",8122,"KRN","B",.84,.84)

"BLD",8122,"KRN","B",3.6,3.6)

"BLD",8122,"KRN","B",3.8,3.8)

"BLD",8122,"KRN","B",9.2,9.2)

"BLD",8122,"KRN","B",9.8,9.8)

"BLD",8122,"KRN","B",19,19)

"BLD",8122,"KRN","B",19.1,19.1)

"BLD",8122,"KRN","B",101,101)

"BLD",8122,"KRN","B",409.61,409.61)

"BLD",8122,"KRN","B",771,771)

"BLD",8122,"KRN","B",779.2,779.2)

"BLD",8122,"KRN","B",870,870)

"BLD",8122,"KRN","B",8989.51,8989.51)

"BLD",8122,"KRN","B",8989.52,8989.52)

"BLD",8122,"KRN","B",8994,8994)

"BLD",8122,"QDEF")
^^^^NO^^^^NO^^NO
"BLD",8122,"QUES",0)
^9.62^^
"BLD",8122,"REQB",0)
^9.611^^0
"MBREQ")
0
"PKG",594,-1)
1^1
"PKG",594,0)
My HealtheVet^MHV^Support for My HealtheVet web site.
"PKG",594,20,0)
^9.402P^^
"PKG",594,22,0)
^9.49I^1^1
"PKG",594,22,1,0)
1.0^3050823^3080526^50209
"PKG",594,22,1,"PAH",1,0)
24^3160216
"PKG",594,22,1,"PAH",1,1,0)
^^5^5^3160216
"PKG",594,22,1,"PAH",1,1,1,0)
 
"PKG",594,22,1,"PAH",1,1,2,0)
 
"PKG",594,22,1,"PAH",1,1,3,0)
 
"PKG",594,22,1,"PAH",1,1,4,0)
 
"PKG",594,22,1,"PAH",1,1,5,0)
MHV Secure Messaging Workload Credit (SM WLC) ICD 10 EMERGENCY Issues Fix
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","MHVUMRPC")
0^1^B53770789^B47575713
"RTN","MHVUMRPC",1,0)
MHVUMRPC ;KUM/LB - myHealtheVet Management Utilities ; 6/18/2013
"RTN","MHVUMRPC",2,0)
 ;;1.0;My HealtheVet;**11,22,24**;Mar 05, 2014;Build 24
"RTN","MHVUMRPC",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified
"RTN","MHVUMRPC",4,0)
 ;
"RTN","MHVUMRPC",5,0)
 Q
"RTN","MHVUMRPC",6,0)
 ;
"RTN","MHVUMRPC",7,0)
 ;  Integration Agreements:
"RTN","MHVUMRPC",8,0)
 ;
"RTN","MHVUMRPC",9,0)
 ;                5266 : ^SC(D0
"RTN","MHVUMRPC",10,0)
 ;                6013 : ^ECD(D0
"RTN","MHVUMRPC",11,0)
 ;                2051 : LIST^DIC
"RTN","MHVUMRPC",12,0)
 ;                6009 : ^ECJ(D0
"RTN","MHVUMRPC",13,0)
 ;                6009 : ^ECJ("AP"
"RTN","MHVUMRPC",14,0)
 ;                6010 : Event Capture API $$ELIG^ECUERPC
"RTN","MHVUMRPC",15,0)
 ;                6011 : Event Capture API $$PATCLAST^ECUERPC1
"RTN","MHVUMRPC",16,0)
 ;                6016 : Event Capture API $$SRCLST^ECUMRPC1
"RTN","MHVUMRPC",17,0)
 ;                2701 : $$GETDFN^MPIF001
"RTN","MHVUMRPC",18,0)
 ;                1874 : ^EC(725,D0
"RTN","MHVUMRPC",19,0)
 ;                1873 : Read File 721
"RTN","MHVUMRPC",20,0)
 ;                2741 : OE/RR Calls to GMPLUTL2
"RTN","MHVUMRPC",21,0)
 ;                1995 : CPT Code APIs
"RTN","MHVUMRPC",22,0)
 ;                3990 : ICD Code APIs
"RTN","MHVUMRPC",23,0)
 ;                6155 : Read access to DMMS Units in NEW PERSON File 
"RTN","MHVUMRPC",24,0)
 ;               10004 : $$GET1^DIQ
"RTN","MHVUMRPC",25,0)
 ;
"RTN","MHVUMRPC",26,0)
 Q
"RTN","MHVUMRPC",27,0)
DSSUNT(RESULTS,MHVSTRING) ;
"RTN","MHVUMRPC",28,0)
 ;
"RTN","MHVUMRPC",29,0)
 ;This broker entry point returns DSS units from file 724
"RTN","MHVUMRPC",30,0)
 ;        RPC: MHV GETDSSUNIT
"RTN","MHVUMRPC",31,0)
 ;INPUTS         MHVARY - Contains the following subscripted elements
"RTN","MHVUMRPC",32,0)
 ;                ACLNIEN   - Associated Clinic IEN (required) and PRVDUZ - Provider
"RTN","MHVUMRPC",33,0)
 ;               
"RTN","MHVUMRPC",34,0)
 ;OUTPUTS        RESULTS - Array of DSS units. Data pieces as follows:-
"RTN","MHVUMRPC",35,0)
 ;               PIECE - Description
"RTN","MHVUMRPC",36,0)
 ;                 1     IEN of Location
"RTN","MHVUMRPC",37,0)
 ;                 2     Name of Location
"RTN","MHVUMRPC",38,0)
 ;                 3     IEN of DSS Unit
"RTN","MHVUMRPC",39,0)
 ;                 4     Name of DSS Unit
"RTN","MHVUMRPC",40,0)
 ;                 5     Inactive flag (1-Yes/0-No)
"RTN","MHVUMRPC",41,0)
 ;                 6     Send to PCE flag
"RTN","MHVUMRPC",42,0)
 ;
"RTN","MHVUMRPC",43,0)
 N MHVLIEN,MHVLNAM,MHVCIEN,MHVDIEN,MHVDNAM,MHVCNT,MHVDIACT,MHVCHKF,MHVDPCE,MHVR1
"RTN","MHVUMRPC",44,0)
 N MHVR1E,MHVR1C,MHVDIV,MHVDIVN,MHVPDUZ
"RTN","MHVUMRPC",45,0)
 S MHVCNT=0
"RTN","MHVUMRPC",46,0)
 S MHVDPCE=0
"RTN","MHVUMRPC",47,0)
 S MHVCIEN=+$P(MHVSTRING,"^",1)
"RTN","MHVUMRPC",48,0)
 S MHVPDUZ=+$P(MHVSTRING,"^",2)
"RTN","MHVUMRPC",49,0)
 K ^TMP($J,"MHVDUNT")
"RTN","MHVUMRPC",50,0)
 ; Fetch Location IEN and Location Name
"RTN","MHVUMRPC",51,0)
 I '$D(^SC(MHVCIEN,0)) S RESULTS(1)="0^DSS1-No clinic for IEN:"_MHVCIEN Q
"RTN","MHVUMRPC",52,0)
 S MHVLIEN=$$GET1^DIQ(44,+MHVCIEN,3,"I")
"RTN","MHVUMRPC",53,0)
 S MHVLNAM=$$GET1^DIQ(44,+MHVCIEN,3,"E")
"RTN","MHVUMRPC",54,0)
 S MHVDIV=$$GET1^DIQ(44,+MHVCIEN,3.5,"I")
"RTN","MHVUMRPC",55,0)
 S MHVDIVN=$$GET1^DIQ(44,+MHVCIEN,3.5,"E")
"RTN","MHVUMRPC",56,0)
 I +$G(MHVLIEN)=0 S RESULTS(1)="0^DSS1-No Institution found for clinic IEN:"_MHVCIEN Q
"RTN","MHVUMRPC",57,0)
 I $G(MHVLNAM)="" S RESULTS(1)="0^DSS1-No Institution found for clinic IEN:"_MHVCIEN Q
"RTN","MHVUMRPC",58,0)
 I +$G(MHVDIV)=0 S RESULTS(1)="0^DSS2-No Division found for clinic IEN:"_MHVCIEN Q
"RTN","MHVUMRPC",59,0)
 I $G(MHVDIVN)="" S RESULTS(1)="0^DSS2-No Divison found for clinic IEN:"_MHVCIEN Q 
"RTN","MHVUMRPC",60,0)
 ; Fetch DSS Unit IEN from file #200
"RTN","MHVUMRPC",61,0)
 D LIST^DIC(200.72,","_MHVPDUZ_",","@","QP","","","","","","","MHVR1","MHVR1E")
"RTN","MHVUMRPC",62,0)
 I $G(MHVR1("DILIST",0))'>0 S RESULTS(1)="0^DSS3-No DSS Units found in New Person File" Q
"RTN","MHVUMRPC",63,0)
 D:$G(MHVR1("DILIST",0))>0
"RTN","MHVUMRPC",64,0)
 . S MHVR1C=0
"RTN","MHVUMRPC",65,0)
 . F  S MHVR1C=$O(MHVR1("DILIST",MHVR1C))  Q:MHVR1C'>0  D
"RTN","MHVUMRPC",66,0)
 . . S MHVDIEN=$G(MHVR1("DILIST",MHVR1C,0))
"RTN","MHVUMRPC",67,0)
 . . I +$G(MHVDIEN)'>0 Q
"RTN","MHVUMRPC",68,0)
 . . S MHVDNAM=$$GET1^DIQ(724,+MHVDIEN,.01)
"RTN","MHVUMRPC",69,0)
 . . S MHVDIACT=$$GET1^DIQ(724,+MHVDIEN,5,"I")
"RTN","MHVUMRPC",70,0)
 . . S MHVDPCE=$$GET1^DIQ(724,+MHVDIEN,13,"I")
"RTN","MHVUMRPC",71,0)
 . . D MHVCHK
"RTN","MHVUMRPC",72,0)
 . . I (+$G(MHVDIACT)=1)!(MHVCHKF=1)!('$D(^ECJ("AP",MHVLIEN,MHVDIEN))) Q 
"RTN","MHVUMRPC",73,0)
 . . D MHVRST
"RTN","MHVUMRPC",74,0)
 I MHVCNT=0 S RESULTS(1)="0^DSS4-No DSS Units found (Missing Event Code Screen) clinic IEN:"_MHVCIEN Q
"RTN","MHVUMRPC",75,0)
 Q
"RTN","MHVUMRPC",76,0)
MHVRST ;Populate results array
"RTN","MHVUMRPC",77,0)
 S MHVCNT=MHVCNT+1
"RTN","MHVUMRPC",78,0)
 S RESULTS(MHVCNT)=$G(MHVLIEN)_"^"_$G(MHVLNAM)_"^"_$G(MHVDIEN)_"^"_$G(MHVDNAM)_"^"_$G(MHVDIACT)_"^"_$G(MHVDPCE)
"RTN","MHVUMRPC",79,0)
 Q
"RTN","MHVUMRPC",80,0)
MHVCHK ;Check if DSS Unit is already populated in results array
"RTN","MHVUMRPC",81,0)
 S MHVCHKF=0
"RTN","MHVUMRPC",82,0)
 S MHVI=0 F  S MHVI=$O(^TMP($J,"MHVDUNT",MHVI)) Q:'MHVI!MHVCHKF  D
"RTN","MHVUMRPC",83,0)
 . I MHVDIEN=$P(^TMP($J,"MHVDUNT",MHVI),"^",3) S MHVCHKF=1
"RTN","MHVUMRPC",84,0)
 Q
"RTN","MHVUMRPC",85,0)
PRINTRES ; Print Results
"RTN","MHVUMRPC",86,0)
 N I
"RTN","MHVUMRPC",87,0)
 S I="" F  S I=$O(@RESULTS@(I)) Q:I=""  D
"RTN","MHVUMRPC",88,0)
 . W !,"LOCATIONIEN LOCATIONNAME DSSUNITIEN DSSUNITNAME INACTIVE"
"RTN","MHVUMRPC",89,0)
 . W !,@RESULTS@(I)
"RTN","MHVUMRPC",90,0)
 Q
"RTN","MHVUMRPC",91,0)
DSSPROCS(RESULTS,MHVARY) ; Get Procedures from DSS Unit IEN and Locaiton IEN
"RTN","MHVUMRPC",92,0)
 ; MHVARY IS DSS UNIT IEN AND LOCATION IEN
"RTN","MHVUMRPC",93,0)
 ; RESULTS = Procedure IEN^Procedure 5 digit code and description^synonym^Active flag
"RTN","MHVUMRPC",94,0)
 N MHVLOC,MHVECD,MHVCAT,MHVPX,MHVIEN,MHVNODE,MHVPRO,MHVSYN,MHVPN,MHVSTAT,MHVCNT
"RTN","MHVUMRPC",95,0)
 S MHVLOC=+$P(MHVARY,"^",1)
"RTN","MHVUMRPC",96,0)
 S MHVECD=+$P(MHVARY,"^",2)
"RTN","MHVUMRPC",97,0)
 S MHVCNT=0
"RTN","MHVUMRPC",98,0)
 S MHVCAT="" F  S MHVCAT=$O(^ECJ("AP",MHVLOC,MHVECD,MHVCAT)) Q:MHVCAT=""  D
"RTN","MHVUMRPC",99,0)
 . S MHVPX="" F  S MHVPX=$O(^ECJ("AP",MHVLOC,MHVECD,MHVCAT,MHVPX)) Q:MHVPX=""  S MHVIEN=0 D
"RTN","MHVUMRPC",100,0)
 ..F  S MHVIEN=$O(^ECJ("AP",MHVLOC,MHVECD,MHVCAT,MHVPX,MHVIEN)) Q:'MHVIEN  D
"RTN","MHVUMRPC",101,0)
 ...S MHVNODE=$G(^ECJ(MHVIEN,0)) I MHVNODE="" Q
"RTN","MHVUMRPC",102,0)
 ...S MHVPRO=$G(^ECJ(MHVIEN,"PRO")),MHVSYN=$P(MHVPRO,U,2),MHVPN=$P($P(MHVPRO,U),";")
"RTN","MHVUMRPC",103,0)
 ...I $G(MHVPN)="" Q
"RTN","MHVUMRPC",104,0)
 ...I $P(MHVPRO,U)["EC" S MHVPN=$G(^EC(725,MHVPN,0)),MHVPRO=$P(MHVPN,U,2)_" "_$P(MHVPN,U)
"RTN","MHVUMRPC",105,0)
 ...E  S MHVPN=$$CPT^ICPTCOD(MHVPN) S MHVPRO=$P(MHVPN,U,2)_" "_$P(MHVPN,U,3)
"RTN","MHVUMRPC",106,0)
 ...S MHVSTAT=$S($P(MHVNODE,U,2)'="":"No",1:"Yes")
"RTN","MHVUMRPC",107,0)
 ...; STATUS (Y-Active/N-Inactive)
"RTN","MHVUMRPC",108,0)
 ...I $G(MHVSTAT)="No" Q
"RTN","MHVUMRPC",109,0)
 ...S MHVCNT=MHVCNT+1
"RTN","MHVUMRPC",110,0)
 ...S RESULTS(MHVCNT)=$G(MHVPX)_U_$P($G(MHVPN),U)_U_$P($G(MHVPN),U,2)_U_$G(MHVSYN)_U_$G(MHVSTAT)
"RTN","MHVUMRPC",111,0)
 I MHVCNT=0 S RESULTS(1)="0^No Procedures found for DSS Unit IEN:"_MHVECD_" and Location IEN:"_MHVLOC Q
"RTN","MHVUMRPC",112,0)
 Q
"RTN","MHVUMRPC",113,0)
PATECLS(RESULTS,MHVSTRING) ; Get Patient eligibility and Classification data
"RTN","MHVUMRPC",114,0)
 ; MHVSTRING IS PATIENT ICN, DSS UNIT IEN, PROCEDURE DATE AND TIME IN FILEMAN FORMAT
"RTN","MHVUMRPC",115,0)
 ; RESULTS = PATIENT STATUS ^CLASSIFICATION DATA (AGENT ORANCE, IONIZING RADIATION, SC CONDITION, ENVIRONMENTAL CONTAMINANTS, MILITARY SEXUAL TRUMA
"RTN","MHVUMRPC",116,0)
 ; RESULTS(1,2...)=PRIMARY/SECONDARY FLAG (1-PRIMARY,0-SECONDARY)^ELIGIBILITY IEN^ELIGIBILITY DESCRIPTION
"RTN","MHVUMRPC",117,0)
 N MHVPIEN,MHVECD,MHVPDT,MHVI,MHVCNT,MHVPICN,ECARY
"RTN","MHVUMRPC",118,0)
 ; Get Patient IEN from Patient ICN
"RTN","MHVUMRPC",119,0)
 S MHVPICN=+$P(MHVSTRING,"^",1)
"RTN","MHVUMRPC",120,0)
 I $G(MHVPICN)'>0 S RESULTS(1)="0^No Patient ICN" Q
"RTN","MHVUMRPC",121,0)
 S MHVPIEN=$$GETDFN^MPIF001(MHVPICN)
"RTN","MHVUMRPC",122,0)
 I $P($G(MHVPIEN),"^",1)=-1 S RESULTS(1)="0^Patient ICN not in Database" Q
"RTN","MHVUMRPC",123,0)
 ;
"RTN","MHVUMRPC",124,0)
 S $P(MHVSTRING,"^",1)=MHVPIEN
"RTN","MHVUMRPC",125,0)
 S MHVECD=$P(MHVSTRING,"^",2)
"RTN","MHVUMRPC",126,0)
 S MHVPDT=$P(MHVSTRING,"^",3)
"RTN","MHVUMRPC",127,0)
 ; GET PATIENT ELIGIBILITY
"RTN","MHVUMRPC",128,0)
 S ECARY=$G(MHVPIEN)
"RTN","MHVUMRPC",129,0)
 D ELIG^ECUERPC(.RESULTS,.ECARY)
"RTN","MHVUMRPC",130,0)
 I $G(RESULTS)="" S RESULTS(1)="0^No Eligibility codes found for Patient DFN:"_MHVPIEN Q 
"RTN","MHVUMRPC",131,0)
 S MHVCNT=0
"RTN","MHVUMRPC",132,0)
 S MHVI="" F  S MHVI=$O(@RESULTS@(MHVI)) Q:MHVI=""  D
"RTN","MHVUMRPC",133,0)
 . S MHVCNT=MHVCNT+1
"RTN","MHVUMRPC",134,0)
 . S RESULTS(MHVCNT)=@RESULTS@(MHVI)
"RTN","MHVUMRPC",135,0)
 I MHVCNT=0 S RESULTS(1)="0^No Eligibility codes found for Patient DFN:"_MHVPIEN Q 
"RTN","MHVUMRPC",136,0)
 ; GET PATIENT CLASSIFICATION DATA
"RTN","MHVUMRPC",137,0)
 S ECARY=MHVSTRING
"RTN","MHVUMRPC",138,0)
 S RESULTS=""
"RTN","MHVUMRPC",139,0)
 D PATCLAST^ECUERPC1(.RESULTS,.ECARY)
"RTN","MHVUMRPC",140,0)
 S RESULTS(0)=RESULTS
"RTN","MHVUMRPC",141,0)
 I RESULTS="" S RESULTS(1)="0^No Classification data found for Patient DFN:"_MHVPIEN Q
"RTN","MHVUMRPC",142,0)
 Q
"RTN","MHVUMRPC",143,0)
DIAGPL(RESULTS,MHVSTRING) ; Get Patient Diagnosis codes from Patient Probelm list
"RTN","MHVUMRPC",144,0)
 ; MHVSTRING IS PATIENT ICN
"RTN","MHVUMRPC",145,0)
 ; RESULTS = DIAGNOSIS CODE IEN^DIAGNOSIS CODE^SNOMED-CT DESCRIPTION~ICD-10 DESCRIPTION^ICD CODING SYSTEM 
"RTN","MHVUMRPC",146,0)
 N MHVPIEN,MHVPICN,MHVCNT,MHVDCOD,PRB,DCOD
"RTN","MHVUMRPC",147,0)
 ; Get Patient IEN from Patient ICN
"RTN","MHVUMRPC",148,0)
 S MHVPICN=+$P(MHVSTRING,"^",1)
"RTN","MHVUMRPC",149,0)
 I $G(MHVPICN)'>0 S RESULTS(1)="0^No Patient ICN" Q
"RTN","MHVUMRPC",150,0)
 S MHVPIEN=$$GETDFN^MPIF001(MHVPICN)
"RTN","MHVUMRPC",151,0)
 I $P($G(MHVPIEN),"^",1)=-1 S RESULTS(1)="0^Patient ICN not in Database" Q
"RTN","MHVUMRPC",152,0)
 ;
"RTN","MHVUMRPC",153,0)
 S $P(MHVSTRING,"^",1)=$G(MHVPIEN)
"RTN","MHVUMRPC",154,0)
 K MHVROOTP
"RTN","MHVUMRPC",155,0)
 D LIST^GMPLUTL2(.MHVROOTP,MHVPIEN,"A")
"RTN","MHVUMRPC",156,0)
 I $G(MHVROOTP(0))<1 S RESULTS(1)="0^No Diagnosis codes found in Patient Problem List" Q
"RTN","MHVUMRPC",157,0)
 S MHVCNT=0
"RTN","MHVUMRPC",158,0)
 ;Fix for ICD 10 PRODUCTION ISSUE on date switch
"RTN","MHVUMRPC",159,0)
 ;Item#2.Story 223914: SM WLC - ICD10 - SNOMED CT Problem List and Encounter Completion and Workload 
"RTN","MHVUMRPC",160,0)
 F  S MHVCNT=MHVCNT+1 Q:MHVCNT>$G(MHVROOTP(0))  D
"RTN","MHVUMRPC",161,0)
 . S MHVDCOD=$P($P(MHVROOTP(MHVCNT),"^",4),"/",1)
"RTN","MHVUMRPC",162,0)
 . S MHVDIEN=$P($$CODEN^ICDCODE(MHVDCOD,80),"~",1)
"RTN","MHVUMRPC",163,0)
 . ;Story 272695 Emergency Fix 
"RTN","MHVUMRPC",164,0)
 . ;- adding the ICD-10 Description as second " - " piece to Problem SNOMED-CT Description
"RTN","MHVUMRPC",165,0)
 . I $P(MHVROOTP(MHVCNT),"^",13)="10D",$L($G(MHVDCOD)) D
"RTN","MHVUMRPC",166,0)
 . . S DCOD="757.01^"_$G(MHVDCOD)
"RTN","MHVUMRPC",167,0)
 . . D DIAGSRCH(.PRB,.DCOD)
"RTN","MHVUMRPC",168,0)
 . . I $L($G(PRB(1))),($P(PRB(1),"^",2)'=0) S $P(MHVROOTP(MHVCNT),"^",3)=$P(MHVROOTP(MHVCNT),"^",3)_" - "_$P($G(PRB(1)),"^",3)
"RTN","MHVUMRPC",169,0)
 . .;- end of code for Story 272695 Emergency Fix 
"RTN","MHVUMRPC",170,0)
 . S RESULTS(MHVCNT)=$G(MHVDIEN)_"^"_$G(MHVDCOD)_"^"_$P(MHVROOTP(MHVCNT),"^",3)_"^"_$P(MHVROOTP(MHVCNT),"^",13)
"RTN","MHVUMRPC",171,0)
 Q
"RTN","MHVUMRPC",172,0)
DIAGSRCH(RESULTS,MHVSTRING) ; Get Diagnosis codes and description from Search string
"RTN","MHVUMRPC",173,0)
 ; MHVSTRING IS SEARCH STRING AND FILE TO SEARCH
"RTN","MHVUMRPC",174,0)
 ; RESULTS = DIAGNOSIS CODE IEN IN FILE 80^DIAGNOSIS CODE^DESCRIPTION
"RTN","MHVUMRPC",175,0)
 N MHVSTR,MHVCNT
"RTN","MHVUMRPC",176,0)
 K MHVROOT
"RTN","MHVUMRPC",177,0)
 ; FILENAME^ICD
"RTN","MHVUMRPC",178,0)
 ;S MHVSTR=$P(MHVSTRING,U)_"^ICD|"_$P(MHVSTRING,U,2)_"|DT^"
"RTN","MHVUMRPC",179,0)
 ;Fix for ICD 10 PRODUCTION ISSUE on date switch
"RTN","MHVUMRPC",180,0)
 ;Item#1.Story 26244 SM WLC - ICD10 - SNOMED CT Problem List and Encounter Completion and Workload 
"RTN","MHVUMRPC",181,0)
 S MHVSTR=$P(MHVSTRING,U)_"^ICD|"_$P(MHVSTRING,U,2)_"|"_DT_"^"
"RTN","MHVUMRPC",182,0)
 D SRCLST^ECUMRPC1(.MHVROOT,.MHVSTR)
"RTN","MHVUMRPC",183,0)
 I $G(MHVROOT)="" S RESULTS(1)="^0^No results found" Q
"RTN","MHVUMRPC",184,0)
 S MHVCNT=0
"RTN","MHVUMRPC",185,0)
 ;Per Secure Messaging (SM) Change Request (CR)Release 12.15
"RTN","MHVUMRPC",186,0)
 ;User Story:  Problem List ICD-10 enhancement:
"RTN","MHVUMRPC",187,0)
 ;restrict the number of records returned from VistA to 199 or less
"RTN","MHVUMRPC",188,0)
 ;S I="" F  S I=$O(@MHVROOT@(I)) Q:I=""  D
"RTN","MHVUMRPC",189,0)
 S I="" F  S I=$O(@MHVROOT@(I)) Q:(I="")!(MHVCNT>199)  D
"RTN","MHVUMRPC",190,0)
 . S MHVCNT=MHVCNT+1
"RTN","MHVUMRPC",191,0)
 . S RESULTS(I)=@MHVROOT@(I)
"RTN","MHVUMRPC",192,0)
 . S RESULTS(I)=$P(RESULTS(I),"^",3)_"^"_$P(RESULTS(I),"^",1)_"^"_$P(RESULTS(I),"^",2)_"^"_$P($P(RESULTS(I),"(",2),")",1)
"RTN","MHVUMRPC",193,0)
 I MHVCNT=0 S RESULTS(1)="^0^No results found" Q
"RTN","MHVUMRPC",194,0)
 Q
"VER")
8.0^22.0
"BLD",8122,6)
^18
**END**
**END**

