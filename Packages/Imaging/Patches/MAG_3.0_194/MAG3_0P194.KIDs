KIDS Distribution saved on Oct 10, 2018@10:52:45
VistA Imaging 3.0 - P194 - Duplicate Radiology Order Defect
**KIDS**:MAG*3.0*194^

**INSTALL NAME**
MAG*3.0*194
"BLD",8372,0)
MAG*3.0*194^IMAGING^0^3181010^y
"BLD",8372,1,0)
^^10^10^3181004^^
"BLD",8372,1,1,0)
VistA Imaging V3.0 - Patch 194 - Duplicate Rad Order Defect
"BLD",8372,1,2,0)
 
"BLD",8372,1,3,0)
 
"BLD",8372,1,4,0)
Routines:
"BLD",8372,1,5,0)
 
"BLD",8372,1,6,0)
MAGVIM05 
"BLD",8372,1,7,0)
MAGIP194
"BLD",8372,1,8,0)
 
"BLD",8372,1,9,0)
Please note that routine MAGIP194 is deleted after the KIDS build is
"BLD",8372,1,10,0)
installed.
"BLD",8372,4,0)
^9.64PA^2006.1^1
"BLD",8372,4,2006.1,0)
2006.1
"BLD",8372,4,2006.1,2,0)
^9.641^2006.1^1
"BLD",8372,4,2006.1,2,2006.1,0)
IMAGING SITE PARAMETERS  (File-top level)
"BLD",8372,4,2006.1,2,2006.1,1,0)
^9.6411^305^1
"BLD",8372,4,2006.1,2,2006.1,1,305,0)
IMPORTER PROCEDURE/DAY MAX
"BLD",8372,4,2006.1,222)
y^y^p^^^^n^^n
"BLD",8372,4,2006.1,224)

"BLD",8372,4,"APDD",2006.1,2006.1)

"BLD",8372,4,"APDD",2006.1,2006.1,305)

"BLD",8372,4,"B",2006.1,2006.1)

"BLD",8372,6.3)
23
"BLD",8372,"ABNS",0)
^9.66A^^
"BLD",8372,"ABPKG")
n^n^G.IMAGING DEVELOPMENT TEAM@FORUM.VA.GOV
"BLD",8372,"INID")
n^y^n
"BLD",8372,"INIT")
POS^MAGIP194
"BLD",8372,"KRN",0)
^9.67PA^779.2^20
"BLD",8372,"KRN",.4,0)
.4
"BLD",8372,"KRN",.401,0)
.401
"BLD",8372,"KRN",.402,0)
.402
"BLD",8372,"KRN",.403,0)
.403
"BLD",8372,"KRN",.5,0)
.5
"BLD",8372,"KRN",.84,0)
.84
"BLD",8372,"KRN",3.6,0)
3.6
"BLD",8372,"KRN",3.8,0)
3.8
"BLD",8372,"KRN",9.2,0)
9.2
"BLD",8372,"KRN",9.8,0)
9.8
"BLD",8372,"KRN",9.8,"NM",0)
^9.68A^2^2
"BLD",8372,"KRN",9.8,"NM",1,0)
MAGIP194^^0^B4110438
"BLD",8372,"KRN",9.8,"NM",2,0)
MAGVIM05^^0^B169489489
"BLD",8372,"KRN",9.8,"NM","B","MAGIP194",1)

"BLD",8372,"KRN",9.8,"NM","B","MAGVIM05",2)

"BLD",8372,"KRN",19,0)
19
"BLD",8372,"KRN",19.1,0)
19.1
"BLD",8372,"KRN",101,0)
101
"BLD",8372,"KRN",409.61,0)
409.61
"BLD",8372,"KRN",771,0)
771
"BLD",8372,"KRN",779.2,0)
779.2
"BLD",8372,"KRN",870,0)
870
"BLD",8372,"KRN",8989.51,0)
8989.51
"BLD",8372,"KRN",8989.52,0)
8989.52
"BLD",8372,"KRN",8994,0)
8994
"BLD",8372,"KRN",8994,"NM",0)
^9.68A^^0
"BLD",8372,"KRN","B",.4,.4)

"BLD",8372,"KRN","B",.401,.401)

"BLD",8372,"KRN","B",.402,.402)

"BLD",8372,"KRN","B",.403,.403)

"BLD",8372,"KRN","B",.5,.5)

"BLD",8372,"KRN","B",.84,.84)

"BLD",8372,"KRN","B",3.6,3.6)

"BLD",8372,"KRN","B",3.8,3.8)

"BLD",8372,"KRN","B",9.2,9.2)

"BLD",8372,"KRN","B",9.8,9.8)

"BLD",8372,"KRN","B",19,19)

"BLD",8372,"KRN","B",19.1,19.1)

"BLD",8372,"KRN","B",101,101)

"BLD",8372,"KRN","B",409.61,409.61)

"BLD",8372,"KRN","B",771,771)

"BLD",8372,"KRN","B",779.2,779.2)

"BLD",8372,"KRN","B",870,870)

"BLD",8372,"KRN","B",8989.51,8989.51)

"BLD",8372,"KRN","B",8989.52,8989.52)

"BLD",8372,"KRN","B",8994,8994)

"BLD",8372,"QUES",0)
^9.62^^
"BLD",8372,"REQB",0)
^9.611^3^2
"BLD",8372,"REQB",2,0)
MAG*3.0*192^2
"BLD",8372,"REQB",3,0)
MAG*3.0*172^2
"BLD",8372,"REQB","B","MAG*3.0*172",3)

"BLD",8372,"REQB","B","MAG*3.0*192",2)

"FIA",2006.1)
IMAGING SITE PARAMETERS
"FIA",2006.1,0)
^MAG(2006.1,
"FIA",2006.1,0,0)
2006.1P
"FIA",2006.1,0,1)
y^y^p^^^^n^^n
"FIA",2006.1,0,10)

"FIA",2006.1,0,11)

"FIA",2006.1,0,"RLRO")

"FIA",2006.1,0,"VR")
3.0^MAG
"FIA",2006.1,2006.1)
1
"FIA",2006.1,2006.1,305)

"INIT")
POS^MAGIP194
"MBREQ")
0
"PKG",454,-1)
1^1
"PKG",454,0)
IMAGING^MAG^Imaging-V1 to release 
"PKG",454,20,0)
^9.402P^^
"PKG",454,22,0)
^9.49I^1^1
"PKG",454,22,1,0)
3.0^3020319^3020517^126
"PKG",454,22,1,"PAH",1,0)
194^3181010^126
"PKG",454,22,1,"PAH",1,1,0)
^^10^10^3181010
"PKG",454,22,1,"PAH",1,1,1,0)
VistA Imaging V3.0 - Patch 194 - Duplicate Rad Order Defect
"PKG",454,22,1,"PAH",1,1,2,0)
 
"PKG",454,22,1,"PAH",1,1,3,0)
 
"PKG",454,22,1,"PAH",1,1,4,0)
Routines:
"PKG",454,22,1,"PAH",1,1,5,0)
 
"PKG",454,22,1,"PAH",1,1,6,0)
MAGVIM05 
"PKG",454,22,1,"PAH",1,1,7,0)
MAGIP194
"PKG",454,22,1,"PAH",1,1,8,0)
 
"PKG",454,22,1,"PAH",1,1,9,0)
Please note that routine MAGIP194 is deleted after the KIDS build is
"PKG",454,22,1,"PAH",1,1,10,0)
installed.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
2
"RTN","MAGIP194")
0^1^B4110438
"RTN","MAGIP194",1,0)
MAGIP194 ;WOIFO/DAC - Install code for MAG*3.0*194 ; 11 Nov 2017 10:05 AM
"RTN","MAGIP194",2,0)
 ;;3.0;IMAGING;**194**;Mar 19, 2002;Build 23
"RTN","MAGIP194",3,0)
 ;; Per VHA Directive 2004-038, this routine should not be modified.
"RTN","MAGIP194",4,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGIP194",5,0)
 ;; | Property of the US Government.                                |
"RTN","MAGIP194",6,0)
 ;; | No permission to copy or redistribute this software is given. |
"RTN","MAGIP194",7,0)
 ;; | Use of unreleased versions of this software requires the user |
"RTN","MAGIP194",8,0)
 ;; | to execute a written test agreement with the VistA Imaging    |
"RTN","MAGIP194",9,0)
 ;; | Development Office of the Department of Veterans Affairs,     |
"RTN","MAGIP194",10,0)
 ;; | telephone (301) 734-0100.                                     |
"RTN","MAGIP194",11,0)
 ;; | The Food and Drug Administration classifies this software as  |
"RTN","MAGIP194",12,0)
 ;; | a medical device.  As such, it may not be changed in any way. |
"RTN","MAGIP194",13,0)
 ;; | Modifications to this software may result in an adulterated   |
"RTN","MAGIP194",14,0)
 ;; | medical device under 21CFR820, the use of which is considered |
"RTN","MAGIP194",15,0)
 ;; | to be a violation of US Federal Statutes.                     |
"RTN","MAGIP194",16,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGIP194",17,0)
 ;;
"RTN","MAGIP194",18,0)
 ; There are no environment checks here but the MAGIP194 has to be
"RTN","MAGIP194",19,0)
 ; referenced by the "Environment Check Routine" field of the KIDS
"RTN","MAGIP194",20,0)
 ; build so that entry points of the routine are available to the
"RTN","MAGIP194",21,0)
 ; KIDS during all installation phases.
"RTN","MAGIP194",22,0)
 Q
"RTN","MAGIP194",23,0)
 ;
"RTN","MAGIP194",24,0)
 ;+++++ INSTALLATION ERROR HANDLING
"RTN","MAGIP194",25,0)
ERROR ;
"RTN","MAGIP194",26,0)
 S:$D(XPDNM) XPDABORT=1
"RTN","MAGIP194",27,0)
 ;--- Display the messages and store them to the INSTALL file
"RTN","MAGIP194",28,0)
 D DUMP^MAGUERR1(),ABTMSG^MAGKIDS()
"RTN","MAGIP194",29,0)
 Q
"RTN","MAGIP194",30,0)
 ;
"RTN","MAGIP194",31,0)
 ;***** POST-INSTALL CODE
"RTN","MAGIP194",32,0)
POS ;
"RTN","MAGIP194",33,0)
 N CALLBACK
"RTN","MAGIP194",34,0)
 D CLEAR^MAGUERR(1)
"RTN","MAGIP194",35,0)
 ;
"RTN","MAGIP194",36,0)
 ;--- Send the notification e-mail
"RTN","MAGIP194",37,0)
 D BMES^XPDUTL("Post Install Mail Message: "_$$FMTE^XLFDT($$NOW^XLFDT))
"RTN","MAGIP194",38,0)
 D INS^MAGQBUT4(XPDNM,DUZ,$$NOW^XLFDT,XPDA)
"RTN","MAGIP194",39,0)
 Q
"RTN","MAGIP194",40,0)
 ;
"RTN","MAGIP194",41,0)
 ;***** PRE-INSTALL CODE
"RTN","MAGIP194",42,0)
PRE ;
"RTN","MAGIP194",43,0)
 Q
"RTN","MAGVIM05")
0^2^B169489489
"RTN","MAGVIM05",1,0)
MAGVIM05 ;WOIFO/MAT,BT,JL,DAC,PMK - Utilities for RPC calls for DICOM file processing ;14 Aug 2018 3:13 PM
"RTN","MAGVIM05",2,0)
 ;;3.0;IMAGING;**118,138,164,166,194**;Mar 19, 2002;Build 23
"RTN","MAGVIM05",3,0)
 ;; Per VHA Directive 2004-038, this routine should not be modified.
"RTN","MAGVIM05",4,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGVIM05",5,0)
 ;; | Property of the US Government.                                |
"RTN","MAGVIM05",6,0)
 ;; | No permission to copy or redistribute this software is given. |
"RTN","MAGVIM05",7,0)
 ;; | Use of unreleased versions of this software requires the user |
"RTN","MAGVIM05",8,0)
 ;; | to execute a written test agreement with the VistA Imaging    |
"RTN","MAGVIM05",9,0)
 ;; | Development Office of the Department of Veterans Affairs,     |
"RTN","MAGVIM05",10,0)
 ;; | telephone (301) 734-0100.                                     |
"RTN","MAGVIM05",11,0)
 ;; | The Food and Drug Administration classifies this software as  |
"RTN","MAGVIM05",12,0)
 ;; | a medical device.  As such, it may not be changed in any way. |
"RTN","MAGVIM05",13,0)
 ;; | Modifications to this software may result in an adulterated   |
"RTN","MAGVIM05",14,0)
 ;; | medical device under 21CFR820, the use of which is considered |
"RTN","MAGVIM05",15,0)
 ;; | to be a violation of US Federal Statutes.                     |
"RTN","MAGVIM05",16,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGVIM05",17,0)
 ;;
"RTN","MAGVIM05",18,0)
 ;
"RTN","MAGVIM05",19,0)
 Q
"RTN","MAGVIM05",20,0)
 ;
"RTN","MAGVIM05",21,0)
 ;+++++ Wrap call to code underlying RPC: RAMAG EXAM COMPLETE & re-format output
"RTN","MAGVIM05",22,0)
 ;
"RTN","MAGVIM05",23,0)
 ; RPC: MAGV RAD STAT COMPLETE   Private IA #5072
"RTN","MAGVIM05",24,0)
 ;
"RTN","MAGVIM05",25,0)
 ; Inputs:
"RTN","MAGVIM05",26,0)
 ; =======
"RTN","MAGVIM05",27,0)
 ;
"RTN","MAGVIM05",28,0)
 ;  RETURN ...... variable to hold the results
"RTN","MAGVIM05",29,0)
 ;  RADPT ....... IEN of the RAD/NUC MED PATIENT file (#70)
"RTN","MAGVIM05",30,0)
 ;  RAEXAM1 ..... EXAM DATE (#.01) of the REGISTERED EXAMS sub-file (#70.02)
"RTN","MAGVIM05",31,0)
 ;  RAEXAM2 ..... IEN of the EXAMINATIONS sub-file (#70.03)
"RTN","MAGVIM05",32,0)
 ;  MAGVUSR ..... DUZ of the Importer 2 application user.
"RTN","MAGVIM05",33,0)
 ;  MAGVUSRDV ... DUZ(2) of the Importer 2 user.
"RTN","MAGVIM05",34,0)
 ;  RAIMGTYP .... TYPE OF IMAGING (#2) of the REGISTERED EXAMS sub-file (#70.02)
"RTN","MAGVIM05",35,0)
 ; [RASTDRPT] ... IEN of an entry in the STANDARD REPORTS file (#74.1)
"RTN","MAGVIM05",36,0)
 ;           ---- Next two are IEN(s) of entries in the DIAGNOSTIC CODES file(#78.3)
"RTN","MAGVIM05",37,0)
 ; [RADXPRIM]  .. Primary Diagnostic Code --> RAMISC Param PRIMDXCODE
"RTN","MAGVIM05",38,0)
 ; [RADXSCND] ... List of Secondary Diagnostic Codes --> RAMISC Param SECDXCODE
"RTN","MAGVIM05",39,0)
 ;  
"RTN","MAGVIM05",40,0)
 ; Outputs:
"RTN","MAGVIM05",41,0)
 ; ========
"RTN","MAGVIM05",42,0)
 ; 
"RTN","MAGVIM05",43,0)
 ; Notes:
"RTN","MAGVIM05",44,0)
 ; ======
"RTN","MAGVIM05",45,0)
 ; 
"RTN","MAGVIM05",46,0)
 ; The parameters mirror those of the underlying call.
"RTN","MAGVIM05",47,0)
 ;
"RTN","MAGVIM05",48,0)
XMCOMPLT(RETURN,RADPT,RAEXAM1,RAEXAM2,MAGVUSR,MAGVUSRDV,RAIMGTYP,RASTDRPT,RADXPRIM,RADXSCND) ;
"RTN","MAGVIM05",49,0)
 ;
"RTN","MAGVIM05",50,0)
 ;--- Initialize
"RTN","MAGVIM05",51,0)
 K RETURN
"RTN","MAGVIM05",52,0)
 N MSG,RARESULT,SEPSTAT,SEPOUTP D ZRUSEPIN
"RTN","MAGVIM05",53,0)
 ;
"RTN","MAGVIM05",54,0)
 ;--- Validate incoming parameters.
"RTN","MAGVIM05",55,0)
 N MAGERR,PARAM S MAGERR=0
"RTN","MAGVIM05",56,0)
 D
"RTN","MAGVIM05",57,0)
 . F PARAM="RADPT","RAEXAM1","RAEXAM2","MAGVUSR","MAGVUSRDV","RAIMGTYP" D  Q:MAGERR
"RTN","MAGVIM05",58,0)
 . . S:@PARAM="" MAGERR=1
"RTN","MAGVIM05",59,0)
 . . Q
"RTN","MAGVIM05",60,0)
 . Q
"RTN","MAGVIM05",61,0)
 ;
"RTN","MAGVIM05",62,0)
 I MAGERR D  Q
"RTN","MAGVIM05",63,0)
 . S RETURN(0)="-1"_SEPSTAT_"Required parameter "_PARAM_" missing or invalid."
"RTN","MAGVIM05",64,0)
 . Q
"RTN","MAGVIM05",65,0)
 ;
"RTN","MAGVIM05",66,0)
 ;--- Format incoming RAD Exam Identifiers.
"RTN","MAGVIM05",67,0)
 S RAEXAM=RADPT_U_RAEXAM1_U_RAEXAM2
"RTN","MAGVIM05",68,0)
 ;
"RTN","MAGVIM05",69,0)
 ;--- Set IMAGING SITE PARAMETERS file (#2006.1) IEN from DUZ(2).
"RTN","MAGVIM05",70,0)
 N MAGSITEP
"RTN","MAGVIM05",71,0)
 D
"RTN","MAGVIM05",72,0)
 . S MAGVUSRDV=$G(MAGVUSRDV,$G(DUZ(2))),MAGSITEP=$O(^MAG(2006.1,"B",MAGVUSRDV,"")) ;P164
"RTN","MAGVIM05",73,0)
 . I MAGSITEP="" D   ;P164 - if it is not Site IEN, try Station Number
"RTN","MAGVIM05",74,0)
 . . ;--- Get IEN of INSTITUTION file (#4) from STATION NUMBER (Supported IA# 2171)
"RTN","MAGVIM05",75,0)
 . . N IENINST S IENINST=$$IEN^XUAF4(MAGVUSRDV)
"RTN","MAGVIM05",76,0)
 . . S MAGSITEP=$O(^MAG(2006.1,"B",IENINST,"")) Q:+MAGSITEP  ;found the site
"RTN","MAGVIM05",77,0)
 . . S MAGERR=1,MSG="Unable to resolve Imaging Site Parameters entry. {DUZ(2)="_MAGVUSRDV_"} "
"RTN","MAGVIM05",78,0)
 . Q
"RTN","MAGVIM05",79,0)
 ;
"RTN","MAGVIM05",80,0)
 I MAGERR D  Q
"RTN","MAGVIM05",81,0)
 . S RETURN(0)="-1"_SEPSTAT_MSG
"RTN","MAGVIM05",82,0)
 . Q
"RTN","MAGVIM05",83,0)
 ; 
"RTN","MAGVIM05",84,0)
 ;--- Set additional RAD Order/Exam parameters.
"RTN","MAGVIM05",85,0)
 S MAGERR=$$MAKELIST("C",RAIMGTYP,.RAMSC,MAGVUSR,MAGSITEP)
"RTN","MAGVIM05",86,0)
 I MAGERR D  Q
"RTN","MAGVIM05",87,0)
 . S RETURN(0)="-1"_SEPSTAT_$P(MAGERR,U,2)
"RTN","MAGVIM05",88,0)
 . Q
"RTN","MAGVIM05",89,0)
 ;
"RTN","MAGVIM05",90,0)
 ;--- Set flag to insert Primary DX code if passed in.
"RTN","MAGVIM05",91,0)
 D:$G(RADXPRIM)'="" OUTPUT("PRIMDXCODE^^"_RADXPRIM,.RAMSC)
"RTN","MAGVIM05",92,0)
 ;
"RTN","MAGVIM05",93,0)
 ;--- Set flag to insert Secondary DX code(s) if passed in.
"RTN","MAGVIM05",94,0)
 D:$G(RADXSCND(0))'=""
"RTN","MAGVIM05",95,0)
 . ;
"RTN","MAGVIM05",96,0)
 . N CT S CT=""
"RTN","MAGVIM05",97,0)
 . F  S CT=$O(RADXSCND(CT)) Q:CT=""  D OUTPUT("SECDXCODE"_U_(CT+1)_U_RADXSCND(CT),.RAMSC)
"RTN","MAGVIM05",98,0)
 . Q
"RTN","MAGVIM05",99,0)
 ;
"RTN","MAGVIM05",100,0)
 ;--- Set flag to suppress HL7 message to dictation systems.
"RTN","MAGVIM05",101,0)
 D OUTPUT("FLAGS^^FS",.RAMSC)
"RTN","MAGVIM05",102,0)
 ;--- Call code underlying RPC: RAMAG EXAM COMPLETE (Private IA #5072)
"RTN","MAGVIM05",103,0)
 D COMPLETE^RAMAGRP1(.RARESULT,RAEXAM,.RAMSC)
"RTN","MAGVIM05",104,0)
 I $G(RARESULT(1))="-11^2" D  ; add the OUTSIDE STUDY and try the RPC again 
"RTN","MAGVIM05",105,0)
 . N INFO
"RTN","MAGVIM05",106,0)
 . D ADDROOM(.INFO,RAEXAM)
"RTN","MAGVIM05",107,0)
 . K RARESULT
"RTN","MAGVIM05",108,0)
 . I INFO(1)<0 M RARESULT=INFO Q
"RTN","MAGVIM05",109,0)
 . D COMPLETE^RAMAGRP1(.RARESULT,RAEXAM,.RAMSC)
"RTN","MAGVIM05",110,0)
 . Q
"RTN","MAGVIM05",111,0)
 ;
"RTN","MAGVIM05",112,0)
 ;--- Re-format error output or return 0.
"RTN","MAGVIM05",113,0)
 I RARESULT(0)<0 D
"RTN","MAGVIM05",114,0)
 . ;
"RTN","MAGVIM05",115,0)
 . S RETURN(0)=-1_SEPSTAT_$O(RARESULT("A"),-1)_" error lines returned."
"RTN","MAGVIM05",116,0)
 . N X S X=0
"RTN","MAGVIM05",117,0)
 . F  S X=$O(RARESULT(X)) Q:X=""  D
"RTN","MAGVIM05",118,0)
 . . S RETURN(X)=$P(RARESULT(X),U,1)_SEPSTAT_$P(RARESULT(X),U,2,999)
"RTN","MAGVIM05",119,0)
 . . Q
"RTN","MAGVIM05",120,0)
 E  D
"RTN","MAGVIM05",121,0)
 . S RETURN(0)=0_SEPSTAT_RARESULT(0)
"RTN","MAGVIM05",122,0)
 . N X S X=0
"RTN","MAGVIM05",123,0)
 . F  S X=$O(RARESULT(X)) Q:X=""  D
"RTN","MAGVIM05",124,0)
 . . S RETURN(X)=$TR(RARESULT(X),U,SEPOUTP)
"RTN","MAGVIM05",125,0)
 . . Q
"RTN","MAGVIM05",126,0)
 . ;--- Call RA* code to trigger alerts for DX codes.
"RTN","MAGVIM05",127,0)
 . D ALERT^MAGVIMRA(RADPT,RAEXAM1,RAEXAM2,1)
"RTN","MAGVIM05",128,0)
 . Q
"RTN","MAGVIM05",129,0)
 Q
"RTN","MAGVIM05",130,0)
 ;+++++ Wrap call to code underlying RPC: RAMAG EXAMINED & re-format output
"RTN","MAGVIM05",131,0)
 ;
"RTN","MAGVIM05",132,0)
 ; RPC: MAGV RAD STAT EXAMINED  Private IA #5071
"RTN","MAGVIM05",133,0)
 ;
"RTN","MAGVIM05",134,0)
 ; Inputs:
"RTN","MAGVIM05",135,0)
 ; =======
"RTN","MAGVIM05",136,0)
 ;
"RTN","MAGVIM05",137,0)
 ;  See input parameter descriptions above tag XMCOMPLT (above).
"RTN","MAGVIM05",138,0)
 ;
"RTN","MAGVIM05",139,0)
XMEXAMIN(RETURN,RADFN,RAEXAM1,RAEXAM2,MAGVUSR,MAGVUSRDV,RAIMGTYP) ;
"RTN","MAGVIM05",140,0)
 ;
"RTN","MAGVIM05",141,0)
 ;--- Initialize.
"RTN","MAGVIM05",142,0)
 K RETURN
"RTN","MAGVIM05",143,0)
 N MSG,RARESULT,SEPSTAT,SEPOUTP D ZRUSEPIN
"RTN","MAGVIM05",144,0)
 ;--- Validate incoming parameters.
"RTN","MAGVIM05",145,0)
 N MAGERR,PARAM S MAGERR=0
"RTN","MAGVIM05",146,0)
 D
"RTN","MAGVIM05",147,0)
 . F PARAM="RADFN","RAEXAM1","RAEXAM2","MAGVUSR","MAGVUSRDV","RAIMGTYP" D  Q:MAGERR
"RTN","MAGVIM05",148,0)
 . . S:@PARAM="" MAGERR=1
"RTN","MAGVIM05",149,0)
 . . Q
"RTN","MAGVIM05",150,0)
 . Q
"RTN","MAGVIM05",151,0)
 ;
"RTN","MAGVIM05",152,0)
 I MAGERR D  Q
"RTN","MAGVIM05",153,0)
 . S RETURN(0)="-1"_SEPSTAT_"Required parameter "_PARAM_" missing or invalid."
"RTN","MAGVIM05",154,0)
 . Q
"RTN","MAGVIM05",155,0)
 ;
"RTN","MAGVIM05",156,0)
 ;--- Format incoming RAD Exam Identifiers
"RTN","MAGVIM05",157,0)
 N RAEXAM S RAEXAM=RADFN_U_RAEXAM1_U_RAEXAM2
"RTN","MAGVIM05",158,0)
 ;
"RTN","MAGVIM05",159,0)
 ;--- Set IMAGING SITE PARAMETERS file (#2006.1) IEN from DUZ(2).
"RTN","MAGVIM05",160,0)
 N MAGSITEP
"RTN","MAGVIM05",161,0)
 D
"RTN","MAGVIM05",162,0)
 . S MAGVUSRDV=$G(MAGVUSRDV,$G(DUZ(2))),MAGSITEP=$O(^MAG(2006.1,"B",MAGVUSRDV,"")) ;DAC P166
"RTN","MAGVIM05",163,0)
 . I MAGSITEP="" D   ;DAC P166 - if it is not Site IEN, try Station Number
"RTN","MAGVIM05",164,0)
 . . ;--- Get IEN of INSTITUTION file (#4) from STATION NUMBER (Supported IA# 2171)
"RTN","MAGVIM05",165,0)
 . . N IENINST S IENINST=$$IEN^XUAF4(MAGVUSRDV)
"RTN","MAGVIM05",166,0)
 . . I IENINST'="" S MAGSITEP=$O(^MAG(2006.1,"B",IENINST,"")) Q:+MAGSITEP  ;found the site
"RTN","MAGVIM05",167,0)
 . . S MAGERR=1,MSG="Unable to resolve Imaging Site Parameters entry. {DUZ(2)="_MAGVUSRDV_"} "
"RTN","MAGVIM05",168,0)
 . Q
"RTN","MAGVIM05",169,0)
 ;
"RTN","MAGVIM05",170,0)
 I MAGERR D  Q
"RTN","MAGVIM05",171,0)
 . S RETURN(0)="-1"_SEPSTAT_MSG
"RTN","MAGVIM05",172,0)
 . Q
"RTN","MAGVIM05",173,0)
 ; 
"RTN","MAGVIM05",174,0)
 ;
"RTN","MAGVIM05",175,0)
 ;--- Set required parameters
"RTN","MAGVIM05",176,0)
 S MAGERR=$$MAKELIST("E",RAIMGTYP,.RAMSC,MAGVUSR,MAGSITEP)
"RTN","MAGVIM05",177,0)
 I MAGERR D  Q
"RTN","MAGVIM05",178,0)
 . S RETURN(0)="-1"_SEPSTAT_$P(MAGERR,U,2)
"RTN","MAGVIM05",179,0)
 . Q
"RTN","MAGVIM05",180,0)
 ;
"RTN","MAGVIM05",181,0)
 ;--- Set flag to suppress HL7 message to dictation systems.
"RTN","MAGVIM05",182,0)
 D OUTPUT("FLAGS^^FS",.RAMSC)
"RTN","MAGVIM05",183,0)
 ;--- Call code underlying RPC: RAMAG EXAMINED (Private IA #5071).
"RTN","MAGVIM05",184,0)
 D EXAMINED^RAMAGRP2(.RARESULT,RAEXAM,.RAMSC)
"RTN","MAGVIM05",185,0)
 I $G(RARESULT(1))="-11^2" D  ; add the OUTSIDE STUDY and try the RPC again 
"RTN","MAGVIM05",186,0)
 . N INFO
"RTN","MAGVIM05",187,0)
 . D ADDROOM(.INFO,RAEXAM)
"RTN","MAGVIM05",188,0)
 . K RARESULT
"RTN","MAGVIM05",189,0)
 . I INFO(1)<0 M RARESULT=INFO Q
"RTN","MAGVIM05",190,0)
 . D EXAMINED^RAMAGRP2(.RARESULT,RAEXAM,.RAMSC)
"RTN","MAGVIM05",191,0)
 . Q
"RTN","MAGVIM05",192,0)
 ;
"RTN","MAGVIM05",193,0)
 ;--- Re-format error output or return 0.
"RTN","MAGVIM05",194,0)
 I RARESULT(0)<0 D
"RTN","MAGVIM05",195,0)
 . ;
"RTN","MAGVIM05",196,0)
 . S RETURN(0)=-1_SEPSTAT_$O(RARESULT("A"),-1)_" error lines returned."
"RTN","MAGVIM05",197,0)
 . N X S X=0
"RTN","MAGVIM05",198,0)
 . F  S X=$O(RARESULT(X)) Q:X=""  D
"RTN","MAGVIM05",199,0)
 . . S RETURN(X)=$P(RARESULT(X),U,1)_SEPSTAT_$P(RARESULT(X),U,2,999)
"RTN","MAGVIM05",200,0)
 . . Q
"RTN","MAGVIM05",201,0)
 E  D
"RTN","MAGVIM05",202,0)
 . S RETURN(0)=0_SEPSTAT_RARESULT(0)
"RTN","MAGVIM05",203,0)
 . N X S X=0
"RTN","MAGVIM05",204,0)
 . F  S X=$O(RARESULT(X)) Q:X=""  D
"RTN","MAGVIM05",205,0)
 . . S RETURN(X)=$TR(RARESULT(X),U,SEPOUTP)
"RTN","MAGVIM05",206,0)
 . . Q
"RTN","MAGVIM05",207,0)
 . Q
"RTN","MAGVIM05",208,0)
 Q
"RTN","MAGVIM05",209,0)
 ;+++++ Wrap calls to RPC: RAMAG EXAM ORDER & re-format output.
"RTN","MAGVIM05",210,0)
 ;
"RTN","MAGVIM05",211,0)
 ; RPC: MAGV RAD EXAM ORDER  Private IA #5068
"RTN","MAGVIM05",212,0)
 ;
"RTN","MAGVIM05",213,0)
 ; Inputs:
"RTN","MAGVIM05",214,0)
 ; =======
"RTN","MAGVIM05",215,0)
 ;
"RTN","MAGVIM05",216,0)
 ;  RETURN
"RTN","MAGVIM05",217,0)
 ;  DFN
"RTN","MAGVIM05",218,0)
 ;  RAMLC
"RTN","MAGVIM05",219,0)
 ;  RADPROC
"RTN","MAGVIM05",220,0)
 ;  STUDYDAT
"RTN","MAGVIM05",221,0)
 ;  RACAT
"RTN","MAGVIM05",222,0)
 ;  REQLOC
"RTN","MAGVIM05",223,0)
 ;  REQPHYS
"RTN","MAGVIM05",224,0)
 ;  REASON
"RTN","MAGVIM05",225,0)
 ;  MISC
"RTN","MAGVIM05",226,0)
 ;
"RTN","MAGVIM05",227,0)
 ; Notes:
"RTN","MAGVIM05",228,0)
 ; ======
"RTN","MAGVIM05",229,0)
 ; 
"RTN","MAGVIM05",230,0)
 ; The parameters are the same as those of the underlying call.
"RTN","MAGVIM05",231,0)
 ;
"RTN","MAGVIM05",232,0)
XMORDER(RETURN,DFN,RAMLC,RADPROC,STUDYDAT,RACAT,REQLOC,REQPHYS,REASON,MISC) ;
"RTN","MAGVIM05",233,0)
 ;
"RTN","MAGVIM05",234,0)
 K RETURN
"RTN","MAGVIM05",235,0)
 N SEPSTAT,SEPOUTP,I,FMDAY,MAXORDER,RAOIEN,REVERSEDAY D ZRUSEPIN
"RTN","MAGVIM05",236,0)
 ;
"RTN","MAGVIM05",237,0)
 ; maximum number of same procedures for same date for patient - P194 PMK/DAC 8/14/2018
"RTN","MAGVIM05",238,0)
 S MAXORDER=$P($G(^MAG(2006.1,1,"IMPORTER")),U,6)
"RTN","MAGVIM05",239,0)
 I MAXORDER="" S MAXORDER=10
"RTN","MAGVIM05",240,0)
 ;
"RTN","MAGVIM05",241,0)
 S FMDAY=$$HL7TFM^XLFDT($G(STUDYDAT))
"RTN","MAGVIM05",242,0)
 I FMDAY'>0 D  Q
"RTN","MAGVIM05",243,0)
 . S RETURN(0)=-1_SEPSTAT_"1 error line returned."
"RTN","MAGVIM05",244,0)
 . S RETURN(1)=-1001_SEPSTAT_"Illegal or non-existent STUDYDAT="""_$G(STUDYDAT)_""""
"RTN","MAGVIM05",245,0)
 . Q
"RTN","MAGVIM05",246,0)
 S REVERSEDAY=9999999.9999-(FMDAY\1) ; strip the time and reverse the date
"RTN","MAGVIM05",247,0)
 ;
"RTN","MAGVIM05",248,0)
 S RAOIEN=0
"RTN","MAGVIM05",249,0)
 F I=1:1:MAXORDER S RAOIEN=$O(^RAO(75.1,"AP",DFN,RADPROC,REVERSEDAY,RAOIEN)) Q:'RAOIEN
"RTN","MAGVIM05",250,0)
 I RAOIEN D  Q
"RTN","MAGVIM05",251,0)
 . S RETURN(0)=-1_SEPSTAT_"1 error line returned."
"RTN","MAGVIM05",252,0)
 . S RETURN(1)=-1000_SEPSTAT_"Order already on file with IEN="_RAOIEN
"RTN","MAGVIM05",253,0)
 . Q
"RTN","MAGVIM05",254,0)
 ;
"RTN","MAGVIM05",255,0)
 ;--- Private IA #5068.
"RTN","MAGVIM05",256,0)
 D ORDER^RAMAGRP1(.ORDINFO,DFN,RAMLC,RADPROC,STUDYDAT,RACAT,REQLOC,REQPHYS,REASON,.MISC)
"RTN","MAGVIM05",257,0)
 ;
"RTN","MAGVIM05",258,0)
 ;--- Re-format error output or return new IEN in RAD/NUC MED ORDERS File (#75.1)
"RTN","MAGVIM05",259,0)
 I ORDINFO(0)<0 D  K ORDINFO
"RTN","MAGVIM05",260,0)
 . ;
"RTN","MAGVIM05",261,0)
 . S RETURN(0)=-1_SEPSTAT_$O(ORDINFO("A"),-1)_" error lines returned."
"RTN","MAGVIM05",262,0)
 . N X S X=0 F  S X=$O(ORDINFO(X)) Q:X=""  D
"RTN","MAGVIM05",263,0)
 . . ;
"RTN","MAGVIM05",264,0)
 . . S RETURN(X)=$P(ORDINFO(X),U,1)_SEPSTAT_$P(ORDINFO(X),U,2,999)
"RTN","MAGVIM05",265,0)
 . . Q
"RTN","MAGVIM05",266,0)
 . Q
"RTN","MAGVIM05",267,0)
 E  S RETURN(0)=ORDINFO(0)
"RTN","MAGVIM05",268,0)
 K ORDINFO
"RTN","MAGVIM05",269,0)
 Q
"RTN","MAGVIM05",270,0)
 ;
"RTN","MAGVIM05",271,0)
 ;+++++ Wrap calls to RPC: RAMAG EXAM REGISTER & re-format output.
"RTN","MAGVIM05",272,0)
 ;
"RTN","MAGVIM05",273,0)
 ; RPC: MAGV RAD EXAM REGISTER  Private IA #5069.
"RTN","MAGVIM05",274,0)
 ; 
"RTN","MAGVIM05",275,0)
 ; Inputs:
"RTN","MAGVIM05",276,0)
 ; =======
"RTN","MAGVIM05",277,0)
 ; 
"RTN","MAGVIM05",278,0)
 ;  RETURN
"RTN","MAGVIM05",279,0)
 ;  RAOIFN
"RTN","MAGVIM05",280,0)
 ;  EXMDTE
"RTN","MAGVIM05",281,0)
 ;  RAMSC
"RTN","MAGVIM05",282,0)
 ;
"RTN","MAGVIM05",283,0)
 ; Notes:
"RTN","MAGVIM05",284,0)
 ; ======
"RTN","MAGVIM05",285,0)
 ; 
"RTN","MAGVIM05",286,0)
 ;  The parameters are the same as those of the underlying call.
"RTN","MAGVIM05",287,0)
 ;
"RTN","MAGVIM05",288,0)
XMREGSTR(RETURN,RAOIFN,EXMDTE,RAMSC) ;
"RTN","MAGVIM05",289,0)
 ;
"RTN","MAGVIM05",290,0)
 K RETURN
"RTN","MAGVIM05",291,0)
 N SEPSTAT,SEPOUTP,IMAGLOC D ZRUSEPIN
"RTN","MAGVIM05",292,0)
 ;
"RTN","MAGVIM05",293,0)
 ; Check if imaging location is present - if not find outside imaging location for procedure and division
"RTN","MAGVIM05",294,0)
 N RODATA S RODATA=$G(^RAO(75.1,RAOIFN,0))
"RTN","MAGVIM05",295,0)
 D:$P(RODATA,U,20)=""
"RTN","MAGVIM05",296,0)
 . N LOCINFO,PROCIEN,RAMLC S PROCIEN=$P(RODATA,U,2)
"RTN","MAGVIM05",297,0)
 . D IMAGELOC(.RAMLC,PROCIEN,DUZ(2))
"RTN","MAGVIM05",298,0)
 . S:$P(RAMLC,SEPSTAT)<0 RETURN(0)=RAMLC
"RTN","MAGVIM05",299,0)
 . Q:$G(RETURN(0))
"RTN","MAGVIM05",300,0)
 . S RAMLC=$P(RAMLC,SEPSTAT,2)
"RTN","MAGVIM05",301,0)
 . ; call the RPC to update the radiology imaging location in the radiology order file (#75.1).
"RTN","MAGVIM05",302,0)
 . D IMAGELOC^MAGDRPCB(.LOCINFO,RAOIFN,RAMLC)
"RTN","MAGVIM05",303,0)
 . I $G(LOCINFO)<0 S RETURN(0)=LOCINFO ;"-1"_SEPSTAT_"Error in rpc MAG DICOM SET IMAGING LOCATION"
"RTN","MAGVIM05",304,0)
 . Q
"RTN","MAGVIM05",305,0)
 ;
"RTN","MAGVIM05",306,0)
 ;Get imaging location IEN (#79.1)
"RTN","MAGVIM05",307,0)
 K RAMLC,PROCIEN
"RTN","MAGVIM05",308,0)
 S PROCIEN=$P(RODATA,U,2)
"RTN","MAGVIM05",309,0)
 D IMAGELOC(.RAMLC,PROCIEN,DUZ(2))
"RTN","MAGVIM05",310,0)
 S:$P(RAMLC,SEPSTAT)<0 RETURN(0)=RAMLC
"RTN","MAGVIM05",311,0)
 Q:$G(RETURN(0))
"RTN","MAGVIM05",312,0)
 S RAMLC=$P(RAMLC,SEPSTAT,2)
"RTN","MAGVIM05",313,0)
 ;Get corresponding hospital location IEN (#44)
"RTN","MAGVIM05",314,0)
 S IMAGLOC=$$GET1^DIQ(79.1,.RAMLC,.01,"I")
"RTN","MAGVIM05",315,0)
 K RAMSC
"RTN","MAGVIM05",316,0)
 S RAMSC(1)="PRINCLIN^^"_$G(IMAGLOC)
"RTN","MAGVIM05",317,0)
 S RAMSC(2)="FLAGS^^D"
"RTN","MAGVIM05",318,0)
 ;
"RTN","MAGVIM05",319,0)
 Q:$G(RETURN(0))
"RTN","MAGVIM05",320,0)
 ;--- Private IA #5069.
"RTN","MAGVIM05",321,0)
 D REGISTER^RAMAGRP1(.RARESULT,RAOIFN,EXMDTE,.RAMSC)
"RTN","MAGVIM05",322,0)
 ;
"RTN","MAGVIM05",323,0)
 I RARESULT(0)<0 D
"RTN","MAGVIM05",324,0)
 . ;
"RTN","MAGVIM05",325,0)
 . S RETURN(0)=-1_SEPSTAT_$O(RARESULT("A"),-1)_" error lines returned."
"RTN","MAGVIM05",326,0)
 . N X S X=0 F  S X=$O(RARESULT(X)) Q:X=""  D
"RTN","MAGVIM05",327,0)
 . . ;
"RTN","MAGVIM05",328,0)
 . . S RETURN(X)=$P(RARESULT(X),U,1)_SEPSTAT_$P(RARESULT(X),U,2,999)
"RTN","MAGVIM05",329,0)
 . . Q
"RTN","MAGVIM05",330,0)
 E  D
"RTN","MAGVIM05",331,0)
 . S RETURN(0)=0_SEPSTAT_RARESULT(0)
"RTN","MAGVIM05",332,0)
 . N X S X=0 F  S X=$O(RARESULT(X)) Q:X=""  D
"RTN","MAGVIM05",333,0)
 . . ;
"RTN","MAGVIM05",334,0)
 . . S RETURN(X)=$TR(RARESULT(X),U,SEPOUTP)
"RTN","MAGVIM05",335,0)
 . . Q
"RTN","MAGVIM05",336,0)
 . Q
"RTN","MAGVIM05",337,0)
 Q
"RTN","MAGVIM05",338,0)
 ;+++ Routine Utility: Initialize Separators
"RTN","MAGVIM05",339,0)
ZRUSEPIN ;
"RTN","MAGVIM05",340,0)
 S SEPOUTP=$$OUTSEP^MAGVIM01
"RTN","MAGVIM05",341,0)
 S SEPSTAT=$$STATSEP^MAGVIM01
"RTN","MAGVIM05",342,0)
 Q
"RTN","MAGVIM05",343,0)
 ;
"RTN","MAGVIM05",344,0)
MAKELIST(RACTION,RAIMGTYP,RAMSC,MAGVUSR,MAGSITEP) ; output required fields
"RTN","MAGVIM05",345,0)
 ; Load required flags 
"RTN","MAGVIM05",346,0)
 N INFO
"RTN","MAGVIM05",347,0)
 D EXMSTREQ^RAMAGRP2(.INFO,RACTION,RAIMGTYP)
"RTN","MAGVIM05",348,0)
 I INFO(0)<0 Q INFO(1)
"RTN","MAGVIM05",349,0)
 ;
"RTN","MAGVIM05",350,0)
 N TODAYHL7
"RTN","MAGVIM05",351,0)
 S TODAYHL7=$$NOW^XLFDT()\1,$E(TODAYHL7)=$E(TODAYHL7)+17
"RTN","MAGVIM05",352,0)
 ;
"RTN","MAGVIM05",353,0)
 N REQ,RADPVAL
"RTN","MAGVIM05",354,0)
 ;REQ001 - technologist
"RTN","MAGVIM05",355,0)
 S REQ(1)="TECH^1^"_MAGVUSR
"RTN","MAGVIM05",356,0)
 ;
"RTN","MAGVIM05",357,0)
 ;REQ002 - resident or staff
"RTN","MAGVIM05",358,0)
 ;REQ003 - detailed procedure - taken care of already
"RTN","MAGVIM05",359,0)
 ;
"RTN","MAGVIM05",360,0)
 ;REQ004 - film entry
"RTN","MAGVIM05",361,0)
 S RADPVAL=$$GET1^DIQ(2006.1,MAGSITEP,"RAD FILM SIZE","I")
"RTN","MAGVIM05",362,0)
 S REQ(4)="FILMSIZE^1^"_RADPVAL_U_"0"
"RTN","MAGVIM05",363,0)
 ;
"RTN","MAGVIM05",364,0)
 ;REQ005 - diagnostic code default, if not supplied by user.
"RTN","MAGVIM05",365,0)
 D:$G(RADXPRIM)=""
"RTN","MAGVIM05",366,0)
 . S RADPVAL=$$GET1^DIQ(2006.1,MAGSITEP,"RAD PRIMARY DIAGNOSTIC CODE","I")
"RTN","MAGVIM05",367,0)
 . S REQ(5)="PRIMDXCODE^^"_RADPVAL
"RTN","MAGVIM05",368,0)
 . Q
"RTN","MAGVIM05",369,0)
 ;
"RTN","MAGVIM05",370,0)
 ;REQ006 - camera / equipment / room
"RTN","MAGVIM05",371,0)
 S RADPVAL=$$GET1^DIQ(2006.1,MAGSITEP,"RAD PRIMARY CAMERA/EQUIP/RM","I")
"RTN","MAGVIM05",372,0)
 S REQ(6)="PRIMCAM^^"_RADPVAL
"RTN","MAGVIM05",373,0)
 ;
"RTN","MAGVIM05",374,0)
 ;REQ007 - reserved
"RTN","MAGVIM05",375,0)
 ;REQ008 - reserved
"RTN","MAGVIM05",376,0)
 ;REQ009 - reserved
"RTN","MAGVIM05",377,0)
 ;REQ010 - reserved
"RTN","MAGVIM05",378,0)
 ;
"RTN","MAGVIM05",379,0)
 ;REQ011 - report entered
"RTN","MAGVIM05",380,0)
 S REQ(11)="RPTDTE^^"_TODAYHL7
"RTN","MAGVIM05",381,0)
 I $G(RASTDRPT)="" D
"RTN","MAGVIM05",382,0)
 . S REQ(11,1)="REPORT^1^Electronically generated report for outside study."
"RTN","MAGVIM05",383,0)
 . Q
"RTN","MAGVIM05",384,0)
 ;--- Add the REPORT text of a selected STANDARD REPORT to the RAMSC array.
"RTN","MAGVIM05",385,0)
 E  D STNDRPRT(RASTDRPT,"R",1)
"RTN","MAGVIM05",386,0)
 ;
"RTN","MAGVIM05",387,0)
 ;REQ012 - verified report
"RTN","MAGVIM05",388,0)
 S REQ(12)="VERDTE^^"_TODAYHL7
"RTN","MAGVIM05",389,0)
 S REQ(12,1)="RPTSTATUS^^EF"
"RTN","MAGVIM05",390,0)
 ;
"RTN","MAGVIM05",391,0)
 ;REQ013 - procedure modifiers required - previously done
"RTN","MAGVIM05",392,0)
 ;
"RTN","MAGVIM05",393,0)
 ;REQ014 - cpt modifiers
"RTN","MAGVIM05",394,0)
 S RADPVAL=$$GET1^DIQ(2006.1,MAGSITEP,"RAD CPT MODIFIERS","I")
"RTN","MAGVIM05",395,0)
 S:RADPVAL REQ(14)="CPTMODS^1^"_RADPVAL
"RTN","MAGVIM05",396,0)
 ;
"RTN","MAGVIM05",397,0)
 ;REQ015 - reserved
"RTN","MAGVIM05",398,0)
 ;
"RTN","MAGVIM05",399,0)
 ;REQ016 - impression
"RTN","MAGVIM05",400,0)
 I $G(RASTDRPT)="" D
"RTN","MAGVIM05",401,0)
 . S REQ(16)="IMPRESSION^1^Electronically generated report for outside study."
"RTN","MAGVIM05",402,0)
 . Q
"RTN","MAGVIM05",403,0)
 ;--- Add the IMPRESSION text of a selected STANDARD REPORT to the RAMSC array.
"RTN","MAGVIM05",404,0)
 E  D STNDRPRT(RASTDRPT,"I",1)
"RTN","MAGVIM05",405,0)
 ;
"RTN","MAGVIM05",406,0)
 N INDEX
"RTN","MAGVIM05",407,0)
 F INDEX=1:1:16 I $P(INFO(0),"^",INDEX) D
"RTN","MAGVIM05",408,0)
 . D:$D(REQ(INDEX)) OUTPUT(REQ(INDEX),.RAMSC)
"RTN","MAGVIM05",409,0)
 . D:$D(REQ(INDEX,1)) OUTPUT(REQ(INDEX,1),.RAMSC)
"RTN","MAGVIM05",410,0)
 . Q
"RTN","MAGVIM05",411,0)
 ;
"RTN","MAGVIM05",412,0)
 Q 0
"RTN","MAGVIM05",413,0)
 ;
"RTN","MAGVIM05",414,0)
 ;+++++ Add selected STANDARD REPORT text to the Miscellaneous Parameters array.
"RTN","MAGVIM05",415,0)
 ;
"RTN","MAGVIM05",416,0)
STNDRPRT(RASTDRPT,SSCR,INDEX1) ;
"RTN","MAGVIM05",417,0)
 ;
"RTN","MAGVIM05",418,0)
 N PREFIX S PREFIX=$S(SSCR="R":"REPORT",SSCR="I":"IMPRESSION")
"RTN","MAGVIM05",419,0)
 ;
"RTN","MAGVIM05",420,0)
 N CT
"RTN","MAGVIM05",421,0)
 S CT=0 F  S CT=$O(^RA(74.1,RASTDRPT,SSCR,CT)) Q:CT=""  D
"RTN","MAGVIM05",422,0)
 . N RPTXT
"RTN","MAGVIM05",423,0)
 . S RPTXT=PREFIX_U_(CT+INDEX1)_U_$G(^RA(74.1,RASTDRPT,SSCR,CT,0)) D OUTPUT(RPTXT,.RAMSC)
"RTN","MAGVIM05",424,0)
 . Q
"RTN","MAGVIM05",425,0)
 Q
"RTN","MAGVIM05",426,0)
 ;
"RTN","MAGVIM05",427,0)
OUTPUT(TEXT,ARRAY) ;
"RTN","MAGVIM05",428,0)
 N I
"RTN","MAGVIM05",429,0)
 S I=$O(ARRAY(""),-1)+1
"RTN","MAGVIM05",430,0)
 S ARRAY(I)=TEXT
"RTN","MAGVIM05",431,0)
 Q
"RTN","MAGVIM05",432,0)
 ;
"RTN","MAGVIM05",433,0)
 ; MAGV OUTSIDE IMAGE LOCATION
"RTN","MAGVIM05",434,0)
 ;
"RTN","MAGVIM05",435,0)
 ; Inputs:
"RTN","MAGVIM05",436,0)
 ; =======
"RTN","MAGVIM05",437,0)
 ;
"RTN","MAGVIM05",438,0)
 ; PROCIEN -- IEN of procedure in RAD/NUC MED PROCEDURES (file #71)
"RTN","MAGVIM05",439,0)
 ; DIVISION - IEN of division in INSTITUTION (file #4)
"RTN","MAGVIM05",440,0)
 ;  
"RTN","MAGVIM05",441,0)
 ; Output:
"RTN","MAGVIM05",442,0)
 ; ========
"RTN","MAGVIM05",443,0)
 ; 
"RTN","MAGVIM05",444,0)
 ;     <0 Error message
"RTN","MAGVIM05",445,0)
 ;      0 IEN of the Outside Image Location in the IMAGE LOCATIONS (file #79.1)
"RTN","MAGVIM05",446,0)
 ;
"RTN","MAGVIM05",447,0)
IMAGELOC(RESULT,PROCIEN,DIVISION) ;
"RTN","MAGVIM05",448,0)
 ; return the outside imaging location for a given radiology procedure and division
"RTN","MAGVIM05",449,0)
 N IEN,IMAGETYPE,SEPSTAT,SEPOUTP D ZRUSEPIN
"RTN","MAGVIM05",450,0)
 K RESULT
"RTN","MAGVIM05",451,0)
 S PROCIEN=$G(PROCIEN)
"RTN","MAGVIM05",452,0)
 I (PROCIEN'>0)!(PROCIEN'=+PROCIEN) D  Q
"RTN","MAGVIM05",453,0)
 . S RESULT="-1"_SEPSTAT_"Invalid or missing Radiology Procedure pointer: """_PROCIEN_"""."
"RTN","MAGVIM05",454,0)
 . Q
"RTN","MAGVIM05",455,0)
 ;
"RTN","MAGVIM05",456,0)
 S DIVISION=$G(DIVISION)
"RTN","MAGVIM05",457,0)
 I (DIVISION'>0)!(DIVISION'=+DIVISION) D  Q
"RTN","MAGVIM05",458,0)
 . S RESULT="-2"_SEPSTAT_"Invalid or missing Division pointer:"""_DIVISION_"""."
"RTN","MAGVIM05",459,0)
 . Q
"RTN","MAGVIM05",460,0)
 ;
"RTN","MAGVIM05",461,0)
 S IMAGETYPE=$$GET1^DIQ(71,PROCIEN,12,"I")
"RTN","MAGVIM05",462,0)
 I 'IMAGETYPE D  Q
"RTN","MAGVIM05",463,0)
 . S RESULT="-3"_SEPSTAT_"Image Type could not be determined for Radiology Procedure pointer: """_PROCIEN_"""."
"RTN","MAGVIM05",464,0)
 . Q
"RTN","MAGVIM05",465,0)
 ;
"RTN","MAGVIM05",466,0)
 I $$GET1^DIQ(4,DIVISION,.01)="" D  Q
"RTN","MAGVIM05",467,0)
 . S RESULT="-4"_SEPSTAT_"Invalid Division (Institution) pointer:"""_DIVISION_"""."
"RTN","MAGVIM05",468,0)
 . Q
"RTN","MAGVIM05",469,0)
 S IEN=$O(^MAGD(2006.5759,"D",DIVISION,IMAGETYPE,""))
"RTN","MAGVIM05",470,0)
 I IEN="" D  Q
"RTN","MAGVIM05",471,0)
 . S RESULT="-5"_SEPSTAT_"Outside Imaging Location could not be determined for Division: "_DIVISION_" & Procedure: """_PROCIEN_"""."
"RTN","MAGVIM05",472,0)
 . Q
"RTN","MAGVIM05",473,0)
 S RESULT=0_SEPSTAT_$$GET1^DIQ(2006.5759,IEN,.01,"I")
"RTN","MAGVIM05",474,0)
 Q
"RTN","MAGVIM05",475,0)
ADDROOM(INFO,RAEXAM) ; add the OUTSIDE STUDY camera equipment room to the IMAGING LOCATION
"RTN","MAGVIM05",476,0)
 ;S RPCERR=$$CALLRPC^MAGM2VCU("MAG DICOM ADD CAMERA EQUIP RM","M",.INFO,RAEXAM)
"RTN","MAGVIM05",477,0)
 D ADDROOM^MAGDRPCB(.INFO,RAEXAM)
"RTN","MAGVIM05",478,0)
 Q
"VER")
8.0^22.2
"^DD",2006.1,2006.1,305,0)
IMPORTER PROCEDURE/DAY MAX^NJ4,0^^IMPORTER;6^K:+X'=X!(X>9999)!(X<1)!(X?.E1"."1N.N) X
"^DD",2006.1,2006.1,305,3)
Type a number between 1 and 9999, 0 decimal digits.
"^DD",2006.1,2006.1,305,21,0)
^.001^3^3^3180822^^^
"^DD",2006.1,2006.1,305,21,1,0)
This field will determine the maximum number of orders that the
"^DD",2006.1,2006.1,305,21,2,0)
Importer may create for a patient for a single procedure on the same
"^DD",2006.1,2006.1,305,21,3,0)
day.
"^DD",2006.1,2006.1,305,"DT")
3180822
**END**
**END**
