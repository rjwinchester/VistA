KIDS Distribution saved on Dec 20, 2016@13:10:51
VistA Imaging V3 - Patch 151 - Version and Import directory length fix.
**KIDS**:MAG*3.0*151^

**INSTALL NAME**
MAG*3.0*151
"BLD",8336,0)
MAG*3.0*151^IMAGING^0^3161220^y
"BLD",8336,1,0)
^^38^38^3160825^^^
"BLD",8336,1,1,0)
VistA Imaging V3.0 Patch 151 - Scanning Enhancements
"BLD",8336,1,2,0)
    
"BLD",8336,1,3,0)
Patch 151 has fixes for the Clinical Capture Client. 
"BLD",8336,1,4,0)
Summary of the issues fixed:
"BLD",8336,1,5,0)
Progress Notes window has been modified to fix errors when
"BLD",8336,1,6,0)
 returning a list of Patient Notes.
"BLD",8336,1,7,0)
Issues when Scanning Images as PDF files have been fixed
"BLD",8336,1,8,0)
Abstracts are now created for PDF files.
"BLD",8336,1,9,0)
Specialty, Proc/Event values were incorrectly saved.
"BLD",8336,1,10,0)
Option to add Additional Images to an Existing Image Group.
"BLD",8336,1,11,0)
More details included in the list of Patient Consults.
"BLD",8336,1,12,0)
TWAIN device sharing issues fixed.
"BLD",8336,1,13,0)
Unsigned Notes are now correctly displayed for a Patient.
"BLD",8336,1,14,0)
User is no longer asked to select Patient for Lab Selection.
"BLD",8336,1,15,0)
Date/Time dialog correctly displays am/pm for selected time.
"BLD",8336,1,16,0)
Option to display Configuration Buttons on Top or Left of window.
"BLD",8336,1,17,0)
Changes to captured PDF images (rotate ) are now
"BLD",8336,1,18,0)
saved correctly.
"BLD",8336,1,19,0)
Annotations are no longer created in the Capture
"BLD",8336,1,20,0)
application.  Capture application now communicates with
"BLD",8336,1,21,0)
the Display application. Starting with Clinical Display patch 167
"BLD",8336,1,22,0)
an annotation window will open automatically and enable
"BLD",8336,1,23,0)
the user to annotate immediately after the image is
"BLD",8336,1,24,0)
captured.  User can also select any image from the 'Latest
"BLD",8336,1,25,0)
Patient Images' window, and have that image open in the
"BLD",8336,1,26,0)
Annotation window of Clinical Display
"BLD",8336,1,27,0)
    
"BLD",8336,1,28,0)
Please note that routine MAGIP151 is deleted after the KIDS Build is
"BLD",8336,1,29,0)
installed.
"BLD",8336,1,30,0)
This will check the routines from a BUILD file.
"BLD",8336,1,31,0)
Select BUILD NAME:    MAG*3.0*151     IMAGING
"BLD",8336,1,32,0)
MAGGA03A  value = 26454333
"BLD",8336,1,33,0)
MAGGNLKP  value = 14768217
"BLD",8336,1,34,0)
MAGGTIG   value = 77381599
"BLD",8336,1,35,0)
MAGGTU3   value = 35227017
"BLD",8336,1,36,0)
MAGGTU4C  value = 5135697
"BLD",8336,1,37,0)
MAGIP151  value = 7810500
"BLD",8336,1,38,0)
done
"BLD",8336,4,0)
^9.64PA^2006.1^1
"BLD",8336,4,2006.1,0)
2006.1
"BLD",8336,4,2006.1,2,0)
^9.641^2006.1^1
"BLD",8336,4,2006.1,2,2006.1,0)
IMAGING SITE PARAMETERS  (File-top level)
"BLD",8336,4,2006.1,2,2006.1,1,0)
^9.6411^76^2
"BLD",8336,4,2006.1,2,2006.1,1,75,0)
DISPLAY HELP URL
"BLD",8336,4,2006.1,2,2006.1,1,76,0)
CAPTURE HELP URL
"BLD",8336,4,2006.1,222)
y^y^p^^^^n^^n
"BLD",8336,4,2006.1,224)

"BLD",8336,4,"APDD",2006.1,2006.1)

"BLD",8336,4,"APDD",2006.1,2006.1,75)

"BLD",8336,4,"APDD",2006.1,2006.1,76)

"BLD",8336,4,"B",2006.1,2006.1)

"BLD",8336,6.3)
21
"BLD",8336,"ABNS",0)
^9.66A^^
"BLD",8336,"ABPKG")
n^n^G.IMAGING DEVELOPMENT TEAM@DOMAIN.EXT
"BLD",8336,"INI")
PRE^MAGIP151
"BLD",8336,"INID")
n^y^n
"BLD",8336,"INIT")
POS^MAGIP151
"BLD",8336,"KRN",0)
^9.67PA^779.2^20
"BLD",8336,"KRN",.4,0)
.4
"BLD",8336,"KRN",.401,0)
.401
"BLD",8336,"KRN",.402,0)
.402
"BLD",8336,"KRN",.403,0)
.403
"BLD",8336,"KRN",.5,0)
.5
"BLD",8336,"KRN",.84,0)
.84
"BLD",8336,"KRN",3.6,0)
3.6
"BLD",8336,"KRN",3.8,0)
3.8
"BLD",8336,"KRN",9.2,0)
9.2
"BLD",8336,"KRN",9.8,0)
9.8
"BLD",8336,"KRN",9.8,"NM",0)
^9.68A^6^6
"BLD",8336,"KRN",9.8,"NM",1,0)
MAGIP151^^0^B7810500
"BLD",8336,"KRN",9.8,"NM",2,0)
MAGGTU4C^^0^B5134971
"BLD",8336,"KRN",9.8,"NM",3,0)
MAGGA03A^^0^B26454333
"BLD",8336,"KRN",9.8,"NM",4,0)
MAGGTIG^^0^B77381599
"BLD",8336,"KRN",9.8,"NM",5,0)
MAGGTU3^^0^B35227017
"BLD",8336,"KRN",9.8,"NM",6,0)
MAGGNLKP^^0^B14768217
"BLD",8336,"KRN",9.8,"NM","B","MAGGA03A",3)

"BLD",8336,"KRN",9.8,"NM","B","MAGGNLKP",6)

"BLD",8336,"KRN",9.8,"NM","B","MAGGTIG",4)

"BLD",8336,"KRN",9.8,"NM","B","MAGGTU3",5)

"BLD",8336,"KRN",9.8,"NM","B","MAGGTU4C",2)

"BLD",8336,"KRN",9.8,"NM","B","MAGIP151",1)

"BLD",8336,"KRN",19,0)
19
"BLD",8336,"KRN",19,"NM",0)
^9.68A^^
"BLD",8336,"KRN",19.1,0)
19.1
"BLD",8336,"KRN",19.1,"NM",0)
^9.68A^^
"BLD",8336,"KRN",101,0)
101
"BLD",8336,"KRN",409.61,0)
409.61
"BLD",8336,"KRN",771,0)
771
"BLD",8336,"KRN",779.2,0)
779.2
"BLD",8336,"KRN",870,0)
870
"BLD",8336,"KRN",8989.51,0)
8989.51
"BLD",8336,"KRN",8989.52,0)
8989.52
"BLD",8336,"KRN",8994,0)
8994
"BLD",8336,"KRN",8994,"NM",0)
^9.68A^1^1
"BLD",8336,"KRN",8994,"NM",1,0)
MAGG PAT EACH IMAGE^^0
"BLD",8336,"KRN",8994,"NM","B","MAGG PAT EACH IMAGE",1)

"BLD",8336,"KRN","B",.4,.4)

"BLD",8336,"KRN","B",.401,.401)

"BLD",8336,"KRN","B",.402,.402)

"BLD",8336,"KRN","B",.403,.403)

"BLD",8336,"KRN","B",.5,.5)

"BLD",8336,"KRN","B",.84,.84)

"BLD",8336,"KRN","B",3.6,3.6)

"BLD",8336,"KRN","B",3.8,3.8)

"BLD",8336,"KRN","B",9.2,9.2)

"BLD",8336,"KRN","B",9.8,9.8)

"BLD",8336,"KRN","B",19,19)

"BLD",8336,"KRN","B",19.1,19.1)

"BLD",8336,"KRN","B",101,101)

"BLD",8336,"KRN","B",409.61,409.61)

"BLD",8336,"KRN","B",771,771)

"BLD",8336,"KRN","B",779.2,779.2)

"BLD",8336,"KRN","B",870,870)

"BLD",8336,"KRN","B",8989.51,8989.51)

"BLD",8336,"KRN","B",8989.52,8989.52)

"BLD",8336,"KRN","B",8994,8994)

"BLD",8336,"QDEF")
^^^^NO^^^^NO^^NO
"BLD",8336,"QUES",0)
^9.62^^
"BLD",8336,"REQB",0)
^9.611^1^1
"BLD",8336,"REQB",1,0)
MAG*3.0*140^2
"BLD",8336,"REQB","B","MAG*3.0*140",1)

"FIA",2006.1)
IMAGING SITE PARAMETERS
"FIA",2006.1,0)
^MAG(2006.1,
"FIA",2006.1,0,0)
2006.1P
"FIA",2006.1,0,1)
y^y^p^^^^n^^n
"FIA",2006.1,0,10)

"FIA",2006.1,0,11)

"FIA",2006.1,0,"RLRO")

"FIA",2006.1,0,"VR")
3.0^MAG
"FIA",2006.1,2006.1)
1
"FIA",2006.1,2006.1,75)

"FIA",2006.1,2006.1,76)

"INI")
PRE^MAGIP151
"INIT")
POS^MAGIP151
"KRN",8994,699,-1)
0^1
"KRN",8994,699,0)
MAGG PAT EACH IMAGE^EACHIMG^MAGGTIG^2^R
"KRN",8994,699,1,0)
^8994.01^5^5^3151123^^^^
"KRN",8994,699,1,1,0)
Returns a list of Images with Capture date/time, image description for
"KRN",8994,699,1,2,0)
each patient image, and it will list all images of all groups and all
"KRN",8994,699,1,3,0)
single images.
"KRN",8994,699,1,4,0)
Called from capture application to list most recent images captured
"KRN",8994,699,1,5,0)
for a patient.  
"KRN",8994,699,2,0)
^8994.02A^3^3
"KRN",8994,699,2,1,0)
MAGDFN^1^30^1^1
"KRN",8994,699,2,1,1,0)
^8994.021^1^1^3151123^^^^
"KRN",8994,699,2,1,1,1,0)
Patient's DFN.
"KRN",8994,699,2,2,0)
MAX^1^4^0^2
"KRN",8994,699,2,2,1,0)
^8994.021^1^1^3151123^^^^
"KRN",8994,699,2,2,1,1,0)
The maximum number of images to return.
"KRN",8994,699,2,3,0)
FLAGS^1^60^0^3
"KRN",8994,699,2,3,1,0)
^^9^9^3151123^
"KRN",8994,699,2,3,1,1,0)
FLAGS is a delimited string of values
"KRN",8994,699,2,3,1,2,0)
Piece 1 is combination of C,I,D
"KRN",8994,699,2,3,1,3,0)
if C then include images captured by Capture Client
"KRN",8994,699,2,3,1,4,0)
if I then include images captured by Import API
"KRN",8994,699,2,3,1,5,0)
if D then include images captured by DICOM Gateway
"KRN",8994,699,2,3,1,6,0)
Piece 2 is the Image IEN to start from
"KRN",8994,699,2,3,1,7,0)
IEN is included if the user is adding images to an existing
"KRN",8994,699,2,3,1,8,0)
list of images.  the last IEN of the existing list is 
"KRN",8994,699,2,3,1,9,0)
sent as the IEN to start from.
"KRN",8994,699,2,"B","FLAGS",3)

"KRN",8994,699,2,"B","MAGDFN",1)

"KRN",8994,699,2,"B","MAX",2)

"KRN",8994,699,2,"PARAMSEQ",1,1)

"KRN",8994,699,2,"PARAMSEQ",2,2)

"KRN",8994,699,2,"PARAMSEQ",3,3)

"KRN",8994,699,3,0)
^8994.03^2^2^3151123^^^^
"KRN",8994,699,3,1,0)
Returns the array, reverse chronological order of
"KRN",8994,699,3,2,0)
 recent images for a patient.
"MBREQ")
0
"ORD",16,8994)
8994;16;1;;;;;;;RPCDEL^XPDIA1
"ORD",16,8994,0)
REMOTE PROCEDURE
"PKG",454,-1)
1^1
"PKG",454,0)
IMAGING^MAG^Imaging-V1 to release 
"PKG",454,20,0)
^9.402P^^
"PKG",454,22,0)
^9.49I^1^1
"PKG",454,22,1,0)
3.0^3020319^3020517^126
"PKG",454,22,1,"PAH",1,0)
151^3161220^126
"PKG",454,22,1,"PAH",1,1,0)
^^38^38^3161220
"PKG",454,22,1,"PAH",1,1,1,0)
VistA Imaging V3.0 Patch 151 - Scanning Enhancements
"PKG",454,22,1,"PAH",1,1,2,0)
    
"PKG",454,22,1,"PAH",1,1,3,0)
Patch 151 has fixes for the Clinical Capture Client. 
"PKG",454,22,1,"PAH",1,1,4,0)
Summary of the issues fixed:
"PKG",454,22,1,"PAH",1,1,5,0)
Progress Notes window has been modified to fix errors when
"PKG",454,22,1,"PAH",1,1,6,0)
 returning a list of Patient Notes.
"PKG",454,22,1,"PAH",1,1,7,0)
Issues when Scanning Images as PDF files have been fixed
"PKG",454,22,1,"PAH",1,1,8,0)
Abstracts are now created for PDF files.
"PKG",454,22,1,"PAH",1,1,9,0)
Specialty, Proc/Event values were incorrectly saved.
"PKG",454,22,1,"PAH",1,1,10,0)
Option to add Additional Images to an Existing Image Group.
"PKG",454,22,1,"PAH",1,1,11,0)
More details included in the list of Patient Consults.
"PKG",454,22,1,"PAH",1,1,12,0)
TWAIN device sharing issues fixed.
"PKG",454,22,1,"PAH",1,1,13,0)
Unsigned Notes are now correctly displayed for a Patient.
"PKG",454,22,1,"PAH",1,1,14,0)
User is no longer asked to select Patient for Lab Selection.
"PKG",454,22,1,"PAH",1,1,15,0)
Date/Time dialog correctly displays am/pm for selected time.
"PKG",454,22,1,"PAH",1,1,16,0)
Option to display Configuration Buttons on Top or Left of window.
"PKG",454,22,1,"PAH",1,1,17,0)
Changes to captured PDF images (rotate ) are now
"PKG",454,22,1,"PAH",1,1,18,0)
saved correctly.
"PKG",454,22,1,"PAH",1,1,19,0)
Annotations are no longer created in the Capture
"PKG",454,22,1,"PAH",1,1,20,0)
application.  Capture application now communicates with
"PKG",454,22,1,"PAH",1,1,21,0)
the Display application. Starting with Clinical Display patch 167
"PKG",454,22,1,"PAH",1,1,22,0)
an annotation window will open automatically and enable
"PKG",454,22,1,"PAH",1,1,23,0)
the user to annotate immediately after the image is
"PKG",454,22,1,"PAH",1,1,24,0)
captured.  User can also select any image from the 'Latest
"PKG",454,22,1,"PAH",1,1,25,0)
Patient Images' window, and have that image open in the
"PKG",454,22,1,"PAH",1,1,26,0)
Annotation window of Clinical Display
"PKG",454,22,1,"PAH",1,1,27,0)
    
"PKG",454,22,1,"PAH",1,1,28,0)
Please note that routine MAGIP151 is deleted after the KIDS Build is
"PKG",454,22,1,"PAH",1,1,29,0)
installed.
"PKG",454,22,1,"PAH",1,1,30,0)
This will check the routines from a BUILD file.
"PKG",454,22,1,"PAH",1,1,31,0)
Select BUILD NAME:    MAG*3.0*151     IMAGING
"PKG",454,22,1,"PAH",1,1,32,0)
MAGGA03A  value = 26454333
"PKG",454,22,1,"PAH",1,1,33,0)
MAGGNLKP  value = 14768217
"PKG",454,22,1,"PAH",1,1,34,0)
MAGGTIG   value = 77381599
"PKG",454,22,1,"PAH",1,1,35,0)
MAGGTU3   value = 35227017
"PKG",454,22,1,"PAH",1,1,36,0)
MAGGTU4C  value = 5135697
"PKG",454,22,1,"PAH",1,1,37,0)
MAGIP151  value = 7810500
"PKG",454,22,1,"PAH",1,1,38,0)
done
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
6
"RTN","MAGGA03A")
0^3^B26454333
"RTN","MAGGA03A",1,0)
MAGGA03A ;WOIFO/SG - CALLBACK FOR IMAGE QUERIES ; 3/9/09 12:50pm
"RTN","MAGGA03A",2,0)
 ;;3.0;IMAGING;**93,151**;Mar 19, 2002;Build 21;Dec 19, 2016
"RTN","MAGGA03A",3,0)
 ;; Per VHA Directive 2004-038, this routine should not be modified.
"RTN","MAGGA03A",4,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGGA03A",5,0)
 ;; | Property of the US Government.                                |
"RTN","MAGGA03A",6,0)
 ;; | No permission to copy or redistribute this software is given. |
"RTN","MAGGA03A",7,0)
 ;; | Use of unreleased versions of this software requires the user |
"RTN","MAGGA03A",8,0)
 ;; | to execute a written test agreement with the VistA Imaging    |
"RTN","MAGGA03A",9,0)
 ;; | Development Office of the Department of Veterans Affairs,     |
"RTN","MAGGA03A",10,0)
 ;; | telephone (301) 734-0100.                                     |
"RTN","MAGGA03A",11,0)
 ;; |                                                               |
"RTN","MAGGA03A",12,0)
 ;; | The Food and Drug Administration classifies this software as  |
"RTN","MAGGA03A",13,0)
 ;; | a medical device.  As such, it may not be changed in any way. |
"RTN","MAGGA03A",14,0)
 ;; | Modifications to this software may result in an adulterated   |
"RTN","MAGGA03A",15,0)
 ;; | medical device under 21CFR820, the use of which is considered |
"RTN","MAGGA03A",16,0)
 ;; | to be a violation of US Federal Statutes.                     |
"RTN","MAGGA03A",17,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGGA03A",18,0)
 ;;
"RTN","MAGGA03A",19,0)
 Q
"RTN","MAGGA03A",20,0)
 ;
"RTN","MAGGA03A",21,0)
 ;+++++ CALLBACK FUNCTION FOR IMAGE QUERIES
"RTN","MAGGA03A",22,0)
 ;
"RTN","MAGGA03A",23,0)
 ; IMGIEN        IEN of the image record (file #2005 or #2005.1)
"RTN","MAGGA03A",24,0)
 ;
"RTN","MAGGA03A",25,0)
 ; FLAGS         Flags that control the execution
"RTN","MAGGA03A",26,0)
 ;
"RTN","MAGGA03A",27,0)
 ; .DATA         Reference to a local array passed via the MAG8DATA
"RTN","MAGGA03A",28,0)
 ;               parameter of the $$QUERY^MAGGI13 function.
"RTN","MAGGA03A",29,0)
 ; DATA(
"RTN","MAGGA03A",30,0)
 ;   "FLAGS")    Original control flags passed into the
"RTN","MAGGA03A",31,0)
 ;               $$IMGQUERY^MAGGA03 function.
"RTN","MAGGA03A",32,0)
 ;
"RTN","MAGGA03A",33,0)
 ; Return Values
"RTN","MAGGA03A",34,0)
 ; =============
"RTN","MAGGA03A",35,0)
 ;           <0  Error descriptor (see the $$ERROR^MAGUERR)
"RTN","MAGGA03A",36,0)
 ;            0  Continue
"RTN","MAGGA03A",37,0)
 ;           >0  Terminate the query
"RTN","MAGGA03A",38,0)
 ;
"RTN","MAGGA03A",39,0)
 ; This function accumulates the data in the ^TMP($J,"MAGGA03A")
"RTN","MAGGA03A",40,0)
 ; global node:
"RTN","MAGGA03A",41,0)
 ;
"RTN","MAGGA03A",42,0)
 ; ^TMP($J,"MAGGA03A",
"RTN","MAGGA03A",43,0)
 ;
"RTN","MAGGA03A",44,0)
 ;   "S",StatusCode)     Image counts
"RTN","MAGGA03A",45,0)
 ;                         ^01: Number of image entries
"RTN","MAGGA03A",46,0)
 ;                         ^02: Number of images/pages
"RTN","MAGGA03A",47,0)
 ;
"RTN","MAGGA03A",48,0)
 ;   "U",UserIEN,
"RTN","MAGGA03A",49,0)
 ;     StatusCode)       Image counts
"RTN","MAGGA03A",50,0)
 ;                         ^01: Number of image entries
"RTN","MAGGA03A",51,0)
 ;                         ^02: Number of images/pages
"RTN","MAGGA03A",52,0)
 ;
"RTN","MAGGA03A",53,0)
QRYCBK(IMGIEN,FLAGS,DATA) ;
"RTN","MAGGA03A",54,0)
 N FD,FE,GROUP,GRPCNTS,IMGNODE,IMGNP,RC,SKIP,TMP
"RTN","MAGGA03A",55,0)
 ;=== Skip "child" (RC>0) and invalid (RC<0) image entries
"RTN","MAGGA03A",56,0)
 S RC=$$GRPIEN^MAGGI12(IMGIEN)  Q:RC 0
"RTN","MAGGA03A",57,0)
 ;
"RTN","MAGGA03A",58,0)
 ;=== Initialize variables
"RTN","MAGGA03A",59,0)
 S FD=(FLAGS["D"),FE=(FLAGS["E")
"RTN","MAGGA03A",60,0)
 S GROUP=$$ISGRP^MAGGI11(IMGIEN)
"RTN","MAGGA03A",61,0)
 ;
"RTN","MAGGA03A",62,0)
 ;=== Perform additional screening according to the image counts
"RTN","MAGGA03A",63,0)
 S TMP=$$TRFLAGS^MAGUTL05(DATA("FLAGS"),"SU")
"RTN","MAGGA03A",64,0)
 S GRPCNTS=$$GRPCT^MAGGI14(IMGIEN,"P"_TMP,.GRPCNTS)
"RTN","MAGGA03A",65,0)
 S SKIP=0  D  Q:SKIP 0
"RTN","MAGGA03A",66,0)
 . ;--- Check if the image entry references "child" images of
"RTN","MAGGA03A",67,0)
 . ;    requested kind(s). Also, safeguard against a wrong object
"RTN","MAGGA03A",68,0)
 . ;--- type in the group header.
"RTN","MAGGA03A",69,0)
 . I $P(GRPCNTS,U,1)>0  S GROUP=1  Q:FE  ; Existing "child" entries
"RTN","MAGGA03A",70,0)
 . I $P(GRPCNTS,U,2)>0  S GROUP=1  Q:FD  ; Deleted "child" entries
"RTN","MAGGA03A",71,0)
 . ;--- Skip group headers that do not reference
"RTN","MAGGA03A",72,0)
 . ;--- any "child" images of requested kind(s)
"RTN","MAGGA03A",73,0)
 . I GROUP  S SKIP=1  Q
"RTN","MAGGA03A",74,0)
 . ;--- If existing images are not requested, then
"RTN","MAGGA03A",75,0)
 . ;--- skip existing standalone image entries
"RTN","MAGGA03A",76,0)
 . I 'FE,'$$ISDEL^MAGGI11(IMGIEN)  S SKIP=1  Q
"RTN","MAGGA03A",77,0)
 . ;--- Get the number of pages from the standalone image entry
"RTN","MAGGA03A",78,0)
 . S IMGNODE=$$NODE^MAGGI11(IMGIEN)  Q:IMGNODE=""
"RTN","MAGGA03A",79,0)
 . ;P151 - Skip if this image was captured by Dicom Gateway.
"RTN","MAGGA03A",80,0)
 . S CAPP=$P($G(@IMGNODE@(2)),U,12) I (CAPP="D") S SKIP=1 Q
"RTN","MAGGA03A",81,0)
 . S IMGNP=+$P($G(@IMGNODE@(100)),U,10)
"RTN","MAGGA03A",82,0)
 . Q
"RTN","MAGGA03A",83,0)
 ;
"RTN","MAGGA03A",84,0)
 ;=== Image counts (grouped by status)
"RTN","MAGGA03A",85,0)
 I DATA("FLAGS")["S"  D
"RTN","MAGGA03A",86,0)
 . N OLDCNT,STC
"RTN","MAGGA03A",87,0)
 . ;--- Standalone image entry
"RTN","MAGGA03A",88,0)
 . I 'GROUP  D  Q
"RTN","MAGGA03A",89,0)
 . . S STC=+$$IMGST^MAGGI11(IMGIEN)
"RTN","MAGGA03A",90,0)
 . . S TMP=$G(^TMP("MAGGA03A",$J,"S",STC))
"RTN","MAGGA03A",91,0)
 . . S $P(TMP,U,1)=$P(TMP,U,1)+1
"RTN","MAGGA03A",92,0)
 . . S $P(TMP,U,2)=$P(TMP,U,2)+$S($G(IMGNP)>0:IMGNP,1:1)
"RTN","MAGGA03A",93,0)
 . . S ^TMP("MAGGA03A",$J,"S",STC)=TMP
"RTN","MAGGA03A",94,0)
 . . Q
"RTN","MAGGA03A",95,0)
 . ;--- Image group
"RTN","MAGGA03A",96,0)
 . S STC=""
"RTN","MAGGA03A",97,0)
 . F  S STC=$O(GRPCNTS("S",STC))  Q:STC=""  D
"RTN","MAGGA03A",98,0)
 . . S TMP=$G(^TMP("MAGGA03A",$J,"S",STC)),OLDCNT=+TMP
"RTN","MAGGA03A",99,0)
 . . D:FE
"RTN","MAGGA03A",100,0)
 . . . S $P(TMP,U,1)=$P(TMP,U,1)+$P(GRPCNTS("S",STC),U,1)
"RTN","MAGGA03A",101,0)
 . . . S $P(TMP,U,2)=$P(TMP,U,2)+$P(GRPCNTS("S",STC),U,3)
"RTN","MAGGA03A",102,0)
 . . . Q
"RTN","MAGGA03A",103,0)
 . . D:FD
"RTN","MAGGA03A",104,0)
 . . . S $P(TMP,U,1)=$P(TMP,U,1)+$P(GRPCNTS("S",STC),U,2)
"RTN","MAGGA03A",105,0)
 . . . S $P(TMP,U,2)=$P(TMP,U,2)+$P(GRPCNTS("S",STC),U,4)
"RTN","MAGGA03A",106,0)
 . . . Q
"RTN","MAGGA03A",107,0)
 . . S:+TMP'=OLDCNT ^TMP("MAGGA03A",$J,"S",STC)=TMP
"RTN","MAGGA03A",108,0)
 . . Q
"RTN","MAGGA03A",109,0)
 . Q
"RTN","MAGGA03A",110,0)
 ;
"RTN","MAGGA03A",111,0)
 ;=== Image capture users
"RTN","MAGGA03A",112,0)
 I DATA("FLAGS")["U"  D
"RTN","MAGGA03A",113,0)
 . N CNT,STC,USRIEN
"RTN","MAGGA03A",114,0)
 . ;--- Standalone image entry
"RTN","MAGGA03A",115,0)
 . I 'GROUP  D  Q
"RTN","MAGGA03A",116,0)
 . . S USRIEN=$S($G(IMGNODE)'="":+$P($G(@IMGNODE@(2)),U,2),1:0)
"RTN","MAGGA03A",117,0)
 . . I USRIEN=0 S USRIEN=".5" ;150 - Put Postmaster, this will stop <undefined> 
"RTN","MAGGA03A",118,0)
 . . S STC=+$$IMGST^MAGGI11(IMGIEN)
"RTN","MAGGA03A",119,0)
 . . S TMP=$G(^TMP("MAGGA03A",$J,"U",USRIEN,STC))
"RTN","MAGGA03A",120,0)
 . . S $P(TMP,U,1)=$P(TMP,U,1)+1
"RTN","MAGGA03A",121,0)
 . . S $P(TMP,U,2)=$P(TMP,U,2)+$S($G(IMGNP)>0:IMGNP,1:1)
"RTN","MAGGA03A",122,0)
 . . S ^TMP("MAGGA03A",$J,"U",USRIEN,STC)=TMP
"RTN","MAGGA03A",123,0)
 . . Q
"RTN","MAGGA03A",124,0)
 . ;--- Image group
"RTN","MAGGA03A",125,0)
 . S USRIEN=""
"RTN","MAGGA03A",126,0)
 . F  S USRIEN=$O(GRPCNTS("U",USRIEN))  Q:USRIEN=""  D
"RTN","MAGGA03A",127,0)
 . . S STC=""
"RTN","MAGGA03A",128,0)
 . . F  S STC=$O(GRPCNTS("U",USRIEN,STC))  Q:STC=""  D
"RTN","MAGGA03A",129,0)
 . . . S TMP=$G(^TMP("MAGGA03A",$J,"U",USRIEN,STC)),OLDCNT=+TMP
"RTN","MAGGA03A",130,0)
 . . . D:FE
"RTN","MAGGA03A",131,0)
 . . . . S $P(TMP,U,1)=$P(TMP,U,1)+$P(GRPCNTS("U",USRIEN,STC),U,1)
"RTN","MAGGA03A",132,0)
 . . . . S $P(TMP,U,2)=$P(TMP,U,2)+$P(GRPCNTS("U",USRIEN,STC),U,3)
"RTN","MAGGA03A",133,0)
 . . . . Q
"RTN","MAGGA03A",134,0)
 . . . D:FD
"RTN","MAGGA03A",135,0)
 . . . . S $P(TMP,U,1)=$P(TMP,U,1)+$P(GRPCNTS("U",USRIEN,STC),U,2)
"RTN","MAGGA03A",136,0)
 . . . . S $P(TMP,U,2)=$P(TMP,U,2)+$P(GRPCNTS("U",USRIEN,STC),U,4)
"RTN","MAGGA03A",137,0)
 . . . . Q
"RTN","MAGGA03A",138,0)
 . . . S:+TMP'=OLDCNT ^TMP("MAGGA03A",$J,"U",USRIEN,STC)=TMP
"RTN","MAGGA03A",139,0)
 . . . Q
"RTN","MAGGA03A",140,0)
 . . Q
"RTN","MAGGA03A",141,0)
 . Q
"RTN","MAGGA03A",142,0)
 ;
"RTN","MAGGA03A",143,0)
 ;===
"RTN","MAGGA03A",144,0)
 Q 0
"RTN","MAGGNLKP")
0^6^B14768217
"RTN","MAGGNLKP",1,0)
MAGGNLKP ;WOIFO/GEK - Lookup from delphi into any file ; [ 06/20/2001 08:56 ]
"RTN","MAGGNLKP",2,0)
 ;;3.0;IMAGING;**8,92,46,59,151**;Mar 19, 2002;Build 21;Dec 19, 2016
"RTN","MAGGNLKP",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","MAGGNLKP",4,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGGNLKP",5,0)
 ;; | Property of the US Government.                                |
"RTN","MAGGNLKP",6,0)
 ;; | No permission to copy or redistribute this software is given. |
"RTN","MAGGNLKP",7,0)
 ;; | Use of unreleased versions of this software requires the user |
"RTN","MAGGNLKP",8,0)
 ;; | to execute a written test agreement with the VistA Imaging    |
"RTN","MAGGNLKP",9,0)
 ;; | Development Office of the Department of Veterans Affairs,     |
"RTN","MAGGNLKP",10,0)
 ;; | telephone (301) 734-0100.                                     |
"RTN","MAGGNLKP",11,0)
 ;; |                                                               |
"RTN","MAGGNLKP",12,0)
 ;; | The Food and Drug Administration classifies this software as  |
"RTN","MAGGNLKP",13,0)
 ;; | a medical device.  As such, it may not be changed in any way. |
"RTN","MAGGNLKP",14,0)
 ;; | Modifications to this software may result in an adulterated   |
"RTN","MAGGNLKP",15,0)
 ;; | medical device under 21CFR820, the use of which is considered |
"RTN","MAGGNLKP",16,0)
 ;; | to be a violation of US Federal Statutes.                     |
"RTN","MAGGNLKP",17,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGGNLKP",18,0)
 ;;
"RTN","MAGGNLKP",19,0)
 Q
"RTN","MAGGNLKP",20,0)
 ;
"RTN","MAGGNLKP",21,0)
LKP(MAGRY,MAGIN,DATA) ;RPC [MAG3 LOOKUP ANY] 
"RTN","MAGGNLKP",22,0)
 ; Generic lookup using FIND^DIC
"RTN","MAGGNLKP",23,0)
 ; MAGRY is the Array to return.
"RTN","MAGGNLKP",24,0)
 ; MAGIN is parameter sent by calling app (Delphi)
"RTN","MAGGNLKP",25,0)
 ;    FILE NUM ^ NUM TO RETURN ^ TEXT TO MATCH ^ FIELDS ^ SCREEN ($P 5-99)
"RTN","MAGGNLKP",26,0)
 ;    
"RTN","MAGGNLKP",27,0)
 ; DATA : 
"RTN","MAGGNLKP",28,0)
 ;  LVIEW =Piece 1 
"RTN","MAGGNLKP",29,0)
 ;     +LVIEW = 1  :  
"RTN","MAGGNLKP",30,0)
 ;          result array is formatted for a magListView control
"RTN","MAGGNLKP",31,0)
 ;              i.e.  ^ delimiter for data and "|" delimiter for IEN
"RTN","MAGGNLKP",32,0)
 ;     +LVIEW = 0  : 
"RTN","MAGGNLKP",33,0)
 ;         old way,  "  " delim for data and '^' delim for IEN
"RTN","MAGGNLKP",34,0)
 ;  INDEX = Piece 2      ;151T4 corrected spelling, from INDX
"RTN","MAGGNLKP",35,0)
 ;                       This is the index to search 
"RTN","MAGGNLKP",36,0)
 ;                       Defaults to "B"
"RTN","MAGGNLKP",37,0)
 ;    
"RTN","MAGGNLKP",38,0)
 N $ETRAP,$ESTACK S $ETRAP="D ERRA^MAGGTERR"
"RTN","MAGGNLKP",39,0)
 ;
"RTN","MAGGNLKP",40,0)
 N Y,XI,Z,FI,MAGIEN,INFO,LVIEW ;151T4 Deleted the INDX variable.
"RTN","MAGGNLKP",41,0)
 N FILE,IENS,FLDS,FLAGS,VAL,NUM,INDEX,SCR,IDENT,TROOT
"RTN","MAGGNLKP",42,0)
 S (FILE,IENS,FLDS,FLAGS,VAL,NUM,INDEX,SCR,IDENT,TROOT)=""
"RTN","MAGGNLKP",43,0)
 S MAGIN=$G(MAGIN)
"RTN","MAGGNLKP",44,0)
 S DATA=$G(DATA)
"RTN","MAGGNLKP",45,0)
 ;
"RTN","MAGGNLKP",46,0)
 S FILE=+$P(MAGIN,U,1)
"RTN","MAGGNLKP",47,0)
 S NUM=$S(+$P(MAGIN,U,2):+$P(MAGIN,U,2),1:200)
"RTN","MAGGNLKP",48,0)
 S VAL=$P(MAGIN,U,3)
"RTN","MAGGNLKP",49,0)
 S FLDS=$P(MAGIN,U,4)
"RTN","MAGGNLKP",50,0)
 S SCR=$P(MAGIN,U,5,99)
"RTN","MAGGNLKP",51,0)
 ;
"RTN","MAGGNLKP",52,0)
 S LVIEW=+$P(DATA,"^",1)
"RTN","MAGGNLKP",53,0)
 S INDEX=$S($L($P(DATA,"^",2)):$P(DATA,"^",2),1:"B")
"RTN","MAGGNLKP",54,0)
 ;
"RTN","MAGGNLKP",55,0)
 I 'FILE S MAGRY(1)="0^ERROR - Invalid Parameter:  File Number ? " Q
"RTN","MAGGNLKP",56,0)
 I '$$VFILE^DILFD(FILE) S MAGRY(1)="0^ERROR - Invalid File # - "_FILE Q
"RTN","MAGGNLKP",57,0)
 ;          Number of entries to return, If 0 we'll stop at 200
"RTN","MAGGNLKP",58,0)
 ;
"RTN","MAGGNLKP",59,0)
 K ^TMP("DILIST",$J)
"RTN","MAGGNLKP",60,0)
 K ^TMP("DIERR",$J)
"RTN","MAGGNLKP",61,0)
 ;  VAL is the initial value to search for. i.e. the user input.
"RTN","MAGGNLKP",62,0)
 ;  Next line is to stop the FM Infinite Error Trap problem.
"RTN","MAGGNLKP",63,0)
 I $L(VAL)>30 S MAGRY(0)="0^Invalid Input: '"_$E(VAL,1,40)_"...' is too long. "_$L(VAL)_" characters." Q
"RTN","MAGGNLKP",64,0)
 D FIND^DIC(FILE,IENS,FLDS,FLAGS,VAL,NUM,INDEX,SCR,IDENT,TROOT)
"RTN","MAGGNLKP",65,0)
 ;
"RTN","MAGGNLKP",66,0)
 I '$D(^TMP("DILIST",$J,1)) S XI=1 D  Q
"RTN","MAGGNLKP",67,0)
 . I $D(^TMP("DIERR",$J)) D FINDERR(XI) Q
"RTN","MAGGNLKP",68,0)
 . S MAGRY(XI)="0^NO MATCH for lookup on """_$P(MAGIN,"^",3)_""""
"RTN","MAGGNLKP",69,0)
 ;  so we have some matches, (BUT we could still have an error)
"RTN","MAGGNLKP",70,0)
 ;  so first list all matches, then the ERROR
"RTN","MAGGNLKP",71,0)
 ;  Next lines were Q&D but old .EXE's expect return string with 
"RTN","MAGGNLKP",72,0)
 ;  this syntax, when all T11 code is gone, this can be rewritten
"RTN","MAGGNLKP",73,0)
 I LVIEW S XI="" F  S XI=$O(^TMP("DILIST",$J,1,XI)) Q:XI=""  S X=^(XI) D
"RTN","MAGGNLKP",74,0)
 . S MAGIEN=^TMP("DILIST",$J,2,XI)
"RTN","MAGGNLKP",75,0)
 . S Z=".01",FLD="NAME"
"RTN","MAGGNLKP",76,0)
 . F  S Z=$O(^TMP("DILIST",$J,"ID",XI,Z)) Q:Z=""  S X=X_"^"_^(Z),FLD=FLD_"^"_$$GET1^DID(FILE,Z,"","LABEL","MAGFLD")
"RTN","MAGGNLKP",77,0)
 . S MAGRY(.05)=FLD
"RTN","MAGGNLKP",78,0)
 . S MAGRY(XI)=X_"^|"_MAGIEN
"RTN","MAGGNLKP",79,0)
 . Q
"RTN","MAGGNLKP",80,0)
 I 'LVIEW  S XI="" F  S XI=$O(^TMP("DILIST",$J,1,XI)) Q:XI=""  S X=^(XI) D
"RTN","MAGGNLKP",81,0)
 . S MAGIEN=^TMP("DILIST",$J,2,XI)
"RTN","MAGGNLKP",82,0)
 . S Z=""
"RTN","MAGGNLKP",83,0)
 . F  S Z=$O(^TMP("DILIST",$J,"ID",XI,Z)) Q:Z=""  S X=X_"   "_^(Z)
"RTN","MAGGNLKP",84,0)
 . S MAGRY(XI)=X_"^"_MAGIEN
"RTN","MAGGNLKP",85,0)
 . Q
"RTN","MAGGNLKP",86,0)
 I $D(^TMP("DIERR",$J)) D FINDERR() Q
"RTN","MAGGNLKP",87,0)
 I $D(^TMP("DILIST",$J,0)) S INFO=^(0) D
"RTN","MAGGNLKP",88,0)
 . S MAGRY(0)=$P(INFO,"^")_U_"Found "_$P(INFO,"^")_" entr"_$S((+INFO=1):"y",1:"ies")_" matching """_$P(MAGIN,"^",3)_""""
"RTN","MAGGNLKP",89,0)
 . I $P(INFO,"^",3)>0 S MAGRY(0)=MAGRY(0)_" there are more"
"RTN","MAGGNLKP",90,0)
 . Q
"RTN","MAGGNLKP",91,0)
 Q
"RTN","MAGGNLKP",92,0)
FINDERR(XI) ;
"RTN","MAGGNLKP",93,0)
 ;
"RTN","MAGGNLKP",94,0)
 I '+$G(XI) S XI=$O(MAGRY(""),-1)+1
"RTN","MAGGNLKP",95,0)
 S MAGRY(XI)="ERROR^"_^TMP("DIERR",$J,1,"TEXT",1)
"RTN","MAGGNLKP",96,0)
 Q
"RTN","MAGGTIG")
0^4^B77381599
"RTN","MAGGTIG",1,0)
MAGGTIG ;WOIFO/GEK/SG/NST - MAGGT Image Get. Callbacks to Get Image lists ; 14 Sep 2010 10:15 AM
"RTN","MAGGTIG",2,0)
 ;;3.0;IMAGING;**8,48,93,117,150,151**;Mar 19, 2002;Build 21;Dec 19, 2016
"RTN","MAGGTIG",3,0)
 ;; Per VHA Directive 2004-038, this routine should not be modified.
"RTN","MAGGTIG",4,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGGTIG",5,0)
 ;; | Property of the US Government.                                |
"RTN","MAGGTIG",6,0)
 ;; | No permission to copy or redistribute this software is given. |
"RTN","MAGGTIG",7,0)
 ;; | Use of unreleased versions of this software requires the user |
"RTN","MAGGTIG",8,0)
 ;; | to execute a written test agreement with the VistA Imaging    |
"RTN","MAGGTIG",9,0)
 ;; | Development Office of the Department of Veterans Affairs,     |
"RTN","MAGGTIG",10,0)
 ;; | telephone (301) 734-0100.                                     |
"RTN","MAGGTIG",11,0)
 ;; | The Food and Drug Administration classifies this software as  |
"RTN","MAGGTIG",12,0)
 ;; | a medical device.  As such, it may not be changed in any way. |
"RTN","MAGGTIG",13,0)
 ;; | Modifications to this software may result in an adulterated   |
"RTN","MAGGTIG",14,0)
 ;; | medical device under 21CFR820, the use of which is considered |
"RTN","MAGGTIG",15,0)
 ;; | to be a violation of US Federal Statutes.                     |
"RTN","MAGGTIG",16,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGGTIG",17,0)
 ;;
"RTN","MAGGTIG",18,0)
 Q
"RTN","MAGGTIG",19,0)
GRPCOUNT(MAGRY,MAGIEN) ;
"RTN","MAGGTIG",20,0)
 S MAGRY=+$P($G(^MAG(2005,MAGIEN,1,0)),U,4)
"RTN","MAGGTIG",21,0)
 Q
"RTN","MAGGTIG",22,0)
IMAGES(MAGRY,MAGDFN) ;RPC [MAGG PAT IMAGES]
"RTN","MAGGTIG",23,0)
 ;  Call to return a list of images for a patient.
"RTN","MAGGTIG",24,0)
 ;   We are returning all images for a patient, Groups are returned
"RTN","MAGGTIG",25,0)
 ;   as one Image.
"RTN","MAGGTIG",26,0)
 ;   The Images are returned in Rev Chronological Order, latest image
"RTN","MAGGTIG",27,0)
 ;   first, oldest image last.
"RTN","MAGGTIG",28,0)
 ;   User can reorder at the workstation level.
"RTN","MAGGTIG",29,0)
 K MAGRY
"RTN","MAGGTIG",30,0)
 N Y,RDT,PRX,CT,IEN,GBLRET,MAGFILE
"RTN","MAGGTIG",31,0)
 N $ETRAP,$ESTACK S $ETRAP="D ERRA^MAGGTERR"
"RTN","MAGGTIG",32,0)
 S MAGDFN=+MAGDFN
"RTN","MAGGTIG",33,0)
 ;  if no Images for the patient, then quit.
"RTN","MAGGTIG",34,0)
 I '$D(^MAG(2005,"APDTPX",MAGDFN)) S MAGRY(0)="1^0" Q
"RTN","MAGGTIG",35,0)
 ;   the "APDTPX" cross reference is :
"RTN","MAGGTIG",36,0)
 ;     "APDTPX",DFN,Rev Date,Procedure,MAGIEN )
"RTN","MAGGTIG",37,0)
 ;
"RTN","MAGGTIG",38,0)
 ;  we'll use @ notation, this'll work if an Array or a Global Array is begin returned
"RTN","MAGGTIG",39,0)
 S GBLRET=0
"RTN","MAGGTIG",40,0)
 S MAGRY="MAGRY"
"RTN","MAGGTIG",41,0)
 S CT=0,RDT=""
"RTN","MAGGTIG",42,0)
 F  S RDT=$O(^MAG(2005,"APDTPX",MAGDFN,RDT)) Q:'RDT  D
"RTN","MAGGTIG",43,0)
 . S PRX="" F  S PRX=$O(^MAG(2005,"APDTPX",MAGDFN,RDT,PRX)) Q:PRX=""  D
"RTN","MAGGTIG",44,0)
 . . S IEN=""
"RTN","MAGGTIG",45,0)
 . . F  S IEN=$O(^MAG(2005,"APDTPX",MAGDFN,RDT,PRX,IEN)) Q:'IEN  D
"RTN","MAGGTIG",46,0)
 . . . Q:$P($G(^MAG(2005,IEN,0)),"^",10)  ; CHILD OF GROUP
"RTN","MAGGTIG",47,0)
 . . . Q:$$ISDEL^MAGGI11(IEN)             ; Deleted image
"RTN","MAGGTIG",48,0)
 . . . S CT=CT+1
"RTN","MAGGTIG",49,0)
 . . . I (CT>100),'GBLRET D ARY2GLB
"RTN","MAGGTIG",50,0)
 . . . S MAGFILE=$$INFO^MAGGAII(IEN,"E")
"RTN","MAGGTIG",51,0)
 . . . S @MAGRY@(CT)="B2^"_MAGFILE
"RTN","MAGGTIG",52,0)
 S @MAGRY@(0)="1^"_CT
"RTN","MAGGTIG",53,0)
 Q
"RTN","MAGGTIG",54,0)
PHOTOS(MAGRY,MAGDFN) ;RPC [MAGG PAT PHOTOS]
"RTN","MAGGTIG",55,0)
 ; Call to return list of all Photo ID's on file for a patient.
"RTN","MAGGTIG",56,0)
 ;   We are returning all Photo ID images for a patient.
"RTN","MAGGTIG",57,0)
 ;   The Images are returned in Rev Chronological Order, latest image
"RTN","MAGGTIG",58,0)
 ;   first, oldest image last.
"RTN","MAGGTIG",59,0)
 ;             
"RTN","MAGGTIG",60,0)
 K MAGRY
"RTN","MAGGTIG",61,0)
 N Y,RDT,PRX,CT,IEN,IENS,GBLRET,MAGFILE
"RTN","MAGGTIG",62,0)
 N $ETRAP,$ESTACK S $ETRAP="D ERRA^MAGGTERR"
"RTN","MAGGTIG",63,0)
 S MAGDFN=+MAGDFN
"RTN","MAGGTIG",64,0)
 ;  if no Photo ID Images for the patient, then quit.
"RTN","MAGGTIG",65,0)
 I '$D(^MAG(2005,"APPXDT",MAGDFN,"PHOTO ID")) S MAGRY(0)="1^0" Q
"RTN","MAGGTIG",66,0)
 ;   the "APPXDT" cross reference is :
"RTN","MAGGTIG",67,0)
 ;     "APPXDT",DFN,Procedure,Rev Date,MAGIEN )
"RTN","MAGGTIG",68,0)
 ;
"RTN","MAGGTIG",69,0)
 ;  we'll use @ notation, this'll work if an Array or a Global Array is begin returned
"RTN","MAGGTIG",70,0)
 S GBLRET=0
"RTN","MAGGTIG",71,0)
 S MAGRY="MAGRY"
"RTN","MAGGTIG",72,0)
 S CT=0
"RTN","MAGGTIG",73,0)
 S RDT="" F  S RDT=$O(^MAG(2005,"APPXDT",MAGDFN,"PHOTO ID",RDT)) Q:RDT=""  D
"RTN","MAGGTIG",74,0)
 . S IEN=""
"RTN","MAGGTIG",75,0)
 . F  S IEN=$O(^MAG(2005,"APPXDT",MAGDFN,"PHOTO ID",RDT,IEN)) Q:'IEN  D
"RTN","MAGGTIG",76,0)
 . . ;Q:$P($G(^MAG(2005,IEN,0)),"^",10)  ; CHILD OF GROUP
"RTN","MAGGTIG",77,0)
 . . Q:$$ISDEL^MAGGI11(IEN)             ; Deleted image
"RTN","MAGGTIG",78,0)
 . . S IENS(IEN)=""
"RTN","MAGGTIG",79,0)
 . . Q
"RTN","MAGGTIG",80,0)
 . Q
"RTN","MAGGTIG",81,0)
 S IEN="" F  S IEN=$O(IENS(IEN),-1) Q:'IEN  D
"RTN","MAGGTIG",82,0)
 . S CT=CT+1
"RTN","MAGGTIG",83,0)
 . S MAGFILE=$$INFO^MAGGAII(IEN,"E")
"RTN","MAGGTIG",84,0)
 . S @MAGRY@(CT)="B2^"_MAGFILE
"RTN","MAGGTIG",85,0)
 . Q
"RTN","MAGGTIG",86,0)
 S @MAGRY@(0)="1^"_CT
"RTN","MAGGTIG",87,0)
 Q
"RTN","MAGGTIG",88,0)
EACHIMG(MAGRY,MAGDFN,MAX,FLAGS) ;RPC [MAGG PAT EACH IMAGE]
"RTN","MAGGTIG",89,0)
 ; Call Returns list of recent Patient images.
"RTN","MAGGTIG",90,0)
 ;   MAX = maximum number of images to return
"RTN","MAGGTIG",91,0)
 ;   MAGDFN = patient DFN
"RTN","MAGGTIG",92,0)
 ;   FLAGS  = MAGDEV^START IEN  ; p150
"RTN","MAGGTIG",93,0)
 ;
"RTN","MAGGTIG",94,0)
 ;   MAGDEV = [CID]  C and/or I and/or D.   Null = ALL
"RTN","MAGGTIG",95,0)
 ;   List images that were captured by these Devices.
"RTN","MAGGTIG",96,0)
 ;              C : Capture Application
"RTN","MAGGTIG",97,0)
 ;              I : Import API
"RTN","MAGGTIG",98,0)
 ;              D : DICOM Gateway
"RTN","MAGGTIG",99,0)
 ;   START IEN = the Image IEN to start the search on.
"RTN","MAGGTIG",100,0)
 ;   Patch 151 introduced the option of getting 'more' images added 
"RTN","MAGGTIG",101,0)
 ;   to the list in the 'Latest Patient Images' window of capture. 
"RTN","MAGGTIG",102,0)
 ; 
"RTN","MAGGTIG",103,0)
 ;   We are returning all images for a patient, and listing each image.
"RTN","MAGGTIG",104,0)
 ;   This is called from Capture Window where groups aren't listed.
"RTN","MAGGTIG",105,0)
 ;   The Images are returned in Rev Chronological Order, latest image
"RTN","MAGGTIG",106,0)
 ;   first, oldest image last.
"RTN","MAGGTIG",107,0)
 ;   User can decide how many of the most recent they want to list.
"RTN","MAGGTIG",108,0)
 K MAGRY
"RTN","MAGGTIG",109,0)
 N Y,RDT,PRX,CT,IEN,GBLRET
"RTN","MAGGTIG",110,0)
 N N0,N2
"RTN","MAGGTIG",111,0)
 S FLAGS=$G(FLAGS)
"RTN","MAGGTIG",112,0)
 I FLAGS="" S FLAGS="CID"
"RTN","MAGGTIG",113,0)
 S MAX=$S($G(MAX)>0:MAX,1:50) ; 50 IS DEFAULT
"RTN","MAGGTIG",114,0)
 S MAX=MAX-1
"RTN","MAGGTIG",115,0)
 S MAGDEV=$P(FLAGS,"^",1)
"RTN","MAGGTIG",116,0)
 S IEN=$P(FLAGS,"^",2)
"RTN","MAGGTIG",117,0)
 N $ETRAP,$ESTACK S $ETRAP="D AERRA^MAGGTERR"
"RTN","MAGGTIG",118,0)
 S MAGDFN=+MAGDFN
"RTN","MAGGTIG",119,0)
 ;  if no Images for the patient, then quit.
"RTN","MAGGTIG",120,0)
 I '$D(^MAG(2005,"AC",MAGDFN)) S MAGRY(0)="1^0" Q
"RTN","MAGGTIG",121,0)
 ;   the "AC" cross reference is :
"RTN","MAGGTIG",122,0)
 ;     "AC",DFN,IEN )
"RTN","MAGGTIG",123,0)
 ;
"RTN","MAGGTIG",124,0)
 ;  we'll use @ notation, this'll work if an Array or a Global Array is begin returned
"RTN","MAGGTIG",125,0)
 S GBLRET=0
"RTN","MAGGTIG",126,0)
 S MAGRY="MAGRY"
"RTN","MAGGTIG",127,0)
 S CT=0
"RTN","MAGGTIG",128,0)
 F  S IEN=$O(^MAG(2005,"AC",MAGDFN,IEN),-1) Q:'IEN  D  Q:(CT>MAX)
"RTN","MAGGTIG",129,0)
 . Q:$P($G(^MAG(2005,IEN,0)),U,6)=11  ; NOT LISTING GROUP ENTRIES
"RTN","MAGGTIG",130,0)
 . Q:$$ISDEL^MAGGI11(IEN)             ; Skip deleted images
"RTN","MAGGTIG",131,0)
 . S N2=$G(^MAG(2005,IEN,2))
"RTN","MAGGTIG",132,0)
 . Q:MAGDEV'[$P(N2,"^",12)
"RTN","MAGGTIG",133,0)
 . S CT=CT+1
"RTN","MAGGTIG",134,0)
 . I (CT>100),'GBLRET D ARY2GLB
"RTN","MAGGTIG",135,0)
 . S @MAGRY@(CT)=$$CAPINFO(IEN)
"RTN","MAGGTIG",136,0)
 S @MAGRY@(0)="1^"_CT
"RTN","MAGGTIG",137,0)
 Q
"RTN","MAGGTIG",138,0)
CAPINFO(IEN) ; RETURN A STRING OF INFORMATION ABOUT THE IMAGE
"RTN","MAGGTIG",139,0)
 ; This is for Capture App
"RTN","MAGGTIG",140,0)
 N RETY,N2,PN2,X,MAGFILE,GPAR
"RTN","MAGGTIG",141,0)
 ;
"RTN","MAGGTIG",142,0)
 S MAGFILE=$$INFO^MAGGAII(IEN,"E")
"RTN","MAGGTIG",143,0)
 S RETY=$P(MAGFILE,U,1,7)_U
"RTN","MAGGTIG",144,0)
 S N2=$G(^MAG(2005,IEN,2))
"RTN","MAGGTIG",145,0)
 S N0=$G(^MAG(2005,IEN,0))
"RTN","MAGGTIG",146,0)
 S RETY=RETY_$$FMTE^XLFDT($P(N2,U,1),"5P")_U
"RTN","MAGGTIG",147,0)
 S X=$P(RETY,U,5),X=$$FMTE^XLFDT(X,"5"),X=$P(X,"@")
"RTN","MAGGTIG",148,0)
 S $P(RETY,U,5)=X
"RTN","MAGGTIG",149,0)
 S $P(RETY,U,9)=$P(N2,"^",12) ; NEW FOR P151 Capture Application
"RTN","MAGGTIG",150,0)
 S GPAR=$P(N0,"^",10) ; NEW FOR P151 T4 Group Parent
"RTN","MAGGTIG",151,0)
 S $P(RETY,U,10)=GPAR
"RTN","MAGGTIG",152,0)
 ; P151 T2  show Note Title if Note
"RTN","MAGGTIG",153,0)
 I $P($G(N2),"^",6)=8925 S $P(RETY,"^",7)=$$TITLE($P(N2,"^",7))
"RTN","MAGGTIG",154,0)
 I GPAR]"" D  ; P151T4 if Group, check Group TITLE
"RTN","MAGGTIG",155,0)
 . S PN2=$G(^MAG(2005,GPAR,2))
"RTN","MAGGTIG",156,0)
 . I $P($G(PN2),"^",6)=8925 S $P(RETY,"^",7)=$$TITLE($P(PN2,"^",7))
"RTN","MAGGTIG",157,0)
 Q RETY
"RTN","MAGGTIG",158,0)
 Q
"RTN","MAGGTIG",159,0)
TITLE(TIUDA) ; Return TIU Note TITLE
"RTN","MAGGTIG",160,0)
 N TITLE,TIUDAT
"RTN","MAGGTIG",161,0)
 I '(+$G(TIUDA)) Q " - Note Title ? - "
"RTN","MAGGTIG",162,0)
 D DATA^MAGGNTI(.TIUDAT,TIUDA)
"RTN","MAGGTIG",163,0)
 S TITLE=$P(TIUDAT,"^",2)
"RTN","MAGGTIG",164,0)
 I TITLE="" S TITLE=" - Note Title ? - "
"RTN","MAGGTIG",165,0)
 Q TITLE
"RTN","MAGGTIG",166,0)
 ;
"RTN","MAGGTIG",167,0)
ARY2GLB ; Image count is getting big, switch from array to Global return type
"RTN","MAGGTIG",168,0)
 S GBLRET=1
"RTN","MAGGTIG",169,0)
 K ^TMP("MAGGTIG",$J)
"RTN","MAGGTIG",170,0)
 S MAGRY=""
"RTN","MAGGTIG",171,0)
 M ^TMP("MAGGTIG",$J)=MAGRY
"RTN","MAGGTIG",172,0)
 K MAGRY
"RTN","MAGGTIG",173,0)
 S X=$$RTRNFMT^XWBLIB("GLOBAL ARRAY",1)
"RTN","MAGGTIG",174,0)
 S MAGRY=$NA(^TMP("MAGGTIG",$J))
"RTN","MAGGTIG",175,0)
 Q
"RTN","MAGGTIG",176,0)
GROUP(MAGRY,MAGIEN,NOCHK,FLAGS) ;RPC [MAGG GROUP IMAGES]
"RTN","MAGGTIG",177,0)
 ; CalL to Return image list of a Group.
"RTN","MAGGTIG",178,0)
 ; MAGIEN        =  the entry in MAG(2005 we assume it is a group.
"RTN","MAGGTIG",179,0)
 ; NOCHK         =  flag - Do (or) Not Do QI Check.
"RTN","MAGGTIG",180,0)
 N Y,MAGDFN,I,MAGCHILD,MAGCT,MAGTMPAR,MSGX,MAGQI,MAGY,MAGFILE
"RTN","MAGGTIG",181,0)
 N MAGNOCHK
"RTN","MAGGTIG",182,0)
 S FLAGS=$G(FLAGS)
"RTN","MAGGTIG",183,0)
 ;Test BigGroup S BKG=+$G(BKG)
"RTN","MAGGTIG",184,0)
 ;Test BigGroup K ^TMP("MAGBGRP")
"RTN","MAGGTIG",185,0)
 S MAGIEN=+MAGIEN,MSGX=""
"RTN","MAGGTIG",186,0)
 S NOCHK=+$G(NOCHK)
"RTN","MAGGTIG",187,0)
 I '$D(^MAG(2005,MAGIEN,0)) S MAGRY(0)="0^ERROR: Image entry "_MAGIEN_" Doesn't exist" Q
"RTN","MAGGTIG",188,0)
 I $O(^MAG(2005,MAGIEN,1,0))="" S MAGRY(0)="0^ERROR: There are NO Images defined for this Group" Q
"RTN","MAGGTIG",189,0)
 ;
"RTN","MAGGTIG",190,0)
 ;  we'll use @ notation, this'll work if an Array or a Global Array is being returned
"RTN","MAGGTIG",191,0)
 S MAGRY="MAGRY"
"RTN","MAGGTIG",192,0)
 ;
"RTN","MAGGTIG",193,0)
 ;  if we are switching to a Global Array because too many images, 
"RTN","MAGGTIG",194,0)
 ;  then set MAGRY and clean it up first
"RTN","MAGGTIG",195,0)
 ;I +$P($G(^MAG(2005,MAGIEN,1,0)),U,4)>100
"RTN","MAGGTIG",196,0)
 D
"RTN","MAGGTIG",197,0)
 . S X=$$RTRNFMT^XWBLIB("GLOBAL ARRAY",1)
"RTN","MAGGTIG",198,0)
 . S MAGRY=$NA(^TMP("MAGGTIG",$J))
"RTN","MAGGTIG",199,0)
 . K @MAGRY
"RTN","MAGGTIG",200,0)
 N $ETRAP,$ESTACK S $ETRAP="D ERRA^MAGGTERR"
"RTN","MAGGTIG",201,0)
 ;
"RTN","MAGGTIG",202,0)
 ;Test BigGroup I $D(^TMP("MAGBGRP",MAGIEN)) D  Q
"RTN","MAGGTIG",203,0)
 ;Test BigGroup . M ^TMP("MAGGTIG",$J)=^TMP("MAGBGRP",MAGIEN)
"RTN","MAGGTIG",204,0)
 ;Test BigGroup . Q
"RTN","MAGGTIG",205,0)
 ; integrity check, stop if group entry is questionable
"RTN","MAGGTIG",206,0)
 ;  NOCHK is sent from Image Delete window (so user with DELETE and SYSTEM keys)
"RTN","MAGGTIG",207,0)
 ;    can see group abstracts before the group is deleted.
"RTN","MAGGTIG",208,0)
 I 'NOCHK D CHK^MAGGSQI(.MAGQI,MAGIEN) I 'MAGQI(0) D  Q
"RTN","MAGGTIG",209,0)
 . S @MAGRY@(0)=MAGQI(0)
"RTN","MAGGTIG",210,0)
 ;
"RTN","MAGGTIG",211,0)
 S MAGNOCHK=1
"RTN","MAGGTIG",212,0)
 S I=0,MAGCT=0,MAGDFN=$P(^MAG(2005,MAGIEN,0),"^",7)
"RTN","MAGGTIG",213,0)
 I $D(^MAG(2005,MAGIEN,1,"ADCM")) D
"RTN","MAGGTIG",214,0)
 . N INUM,SNUM
"RTN","MAGGTIG",215,0)
 . S INUM="" ; GEK 4/3/00  changed Q:'INUM  to  Q:INUM="" below
"RTN","MAGGTIG",216,0)
 . F  S INUM=$O(^MAG(2005,MAGIEN,1,"ADCM",INUM)) Q:INUM=""  D
"RTN","MAGGTIG",217,0)
 . . S SNUM=""
"RTN","MAGGTIG",218,0)
 . . F  S SNUM=$O(^MAG(2005,MAGIEN,1,"ADCM",INUM,SNUM)) Q:SNUM=""  D
"RTN","MAGGTIG",219,0)
 . . . S MAGCHILD=""
"RTN","MAGGTIG",220,0)
 . . . F  S MAGCHILD=$O(^MAG(2005,MAGIEN,1,"ADCM",INUM,SNUM,MAGCHILD)) Q:'MAGCHILD  D
"RTN","MAGGTIG",221,0)
 . . . . S MAGCT=MAGCT+1
"RTN","MAGGTIG",222,0)
 . . . . I '$D(^MAG(2005,MAGCHILD)) D INVALID(MAGCHILD,.MSGX) S @MAGRY@(MAGCT)=MSGX Q
"RTN","MAGGTIG",223,0)
 . . . . ; Added for MAGQI integrity check
"RTN","MAGGTIG",224,0)
 . . . . K MAGY
"RTN","MAGGTIG",225,0)
 . . . . D CHKGRPCH^MAGGSQI(.MAGY,MAGIEN,MAGDFN,MAGCHILD) I 'MAGY D INVCH(.MAGY,MAGCHILD) S @MAGRY@(MAGCT)=MAGY Q
"RTN","MAGGTIG",226,0)
 . . . . S MAGTMPAR(MAGCHILD)=""
"RTN","MAGGTIG",227,0)
 . . . . S MAGFILE=$$INFO^MAGGAII(MAGCHILD,"E")
"RTN","MAGGTIG",228,0)
 . . . . S $P(MAGFILE,U,12,13)=INUM_U_SNUM
"RTN","MAGGTIG",229,0)
 . . . . S @MAGRY@(MAGCT)="B2^"_MAGFILE
"RTN","MAGGTIG",230,0)
 . . . . ;Test BigGroup I 'BKG S @MAGRY@(MAGCT)="B2^"_MAGFILE
"RTN","MAGGTIG",231,0)
 . . . . ;Test BigGroup E  S ^TMP("MAGBGRP",MAGIEN,MAGCT)="B2^"_MAGFILE
"RTN","MAGGTIG",232,0)
 ;GEK 4/8/99 MODIFIED, because now we have groups, that some entries 
"RTN","MAGGTIG",233,0)
 ;                     have dicom numbers and some don't.  So we have to go through the group again.
"RTN","MAGGTIG",234,0)
 ;Test BigGroup - Need a Pre/Post init, that fixes Groups where some entries have Dicom values, and some 
"RTN","MAGGTIG",235,0)
 ;         don't.  In such a group, we will make Dicom values for the images that don't have them.
"RTN","MAGGTIG",236,0)
 ;         Testing in Washington - this will take hours.
"RTN","MAGGTIG",237,0)
 ;
"RTN","MAGGTIG",238,0)
 S I=0
"RTN","MAGGTIG",239,0)
 F  S I=$O(^MAG(2005,MAGIEN,1,I)) Q:'I  D
"RTN","MAGGTIG",240,0)
 . S MAGCHILD=+^MAG(2005,MAGIEN,1,I,0)
"RTN","MAGGTIG",241,0)
 . I $D(MAGTMPAR(MAGCHILD)) Q
"RTN","MAGGTIG",242,0)
 . S MAGCT=MAGCT+1
"RTN","MAGGTIG",243,0)
 . I '$D(^MAG(2005,MAGCHILD)) D INVALID(MAGCHILD,.MSGX) S @MAGRY@(MAGCT)=MSGX Q
"RTN","MAGGTIG",244,0)
 . ;Added for MAGQI integrity check
"RTN","MAGGTIG",245,0)
 . K MAGY
"RTN","MAGGTIG",246,0)
 . D CHKGRPCH^MAGGSQI(.MAGY,MAGIEN,MAGDFN,MAGCHILD) I 'MAGY D INVCH(.MAGY,MAGCHILD) S @MAGRY@(MAGCT)=MAGY Q
"RTN","MAGGTIG",247,0)
 . S MAGFILE=$$INFO^MAGGAII(MAGCHILD,"E")
"RTN","MAGGTIG",248,0)
 . S @MAGRY@(MAGCT)="B2^"_MAGFILE
"RTN","MAGGTIG",249,0)
 . ;Test BigGroup        I 'BKG S @MAGRY@(MAGCT)="B2^"_MAGFILE
"RTN","MAGGTIG",250,0)
 . ;Test BigGroup        E  S ^TMP("MAGBGRP",MAGIEN,MAGCT)="B2^"_MAGFILE
"RTN","MAGGTIG",251,0)
 I FLAGS["D" D  ; Patch 117
"RTN","MAGGTIG",252,0)
 . ; Get Deleted images
"RTN","MAGGTIG",253,0)
 . S MAGCHILD=0
"RTN","MAGGTIG",254,0)
 . F  S MAGCHILD=$O(^MAG(2005.1,"AGP",MAGIEN,MAGCHILD)) Q:'MAGCHILD  D
"RTN","MAGGTIG",255,0)
 . . I ($P(^MAG(2005.1,MAGCHILD,100),"^",8)=13) Q  ;p150 If ImageNeverExisted Quit.
"RTN","MAGGTIG",256,0)
 . . S MAGCT=MAGCT+1
"RTN","MAGGTIG",257,0)
 . . S MAGFILE=$$INFO^MAGGAII(MAGCHILD,"D")
"RTN","MAGGTIG",258,0)
 . . S @MAGRY@(MAGCT)="B2^"_MAGFILE
"RTN","MAGGTIG",259,0)
 . . Q
"RTN","MAGGTIG",260,0)
 S @MAGRY@(0)="1^"_MAGCT
"RTN","MAGGTIG",261,0)
 Q
"RTN","MAGGTIG",262,0)
INVALID(MAGX,MAGZ) ;
"RTN","MAGGTIG",263,0)
 ;
"RTN","MAGGTIG",264,0)
 I $$ISDEL^MAGGI11(MAGX)  S MAGZ="B2^"_MAGX_"^^^INVALID Reference to Deleted Image^^66^^^^^^^^"
"RTN","MAGGTIG",265,0)
 E  S MAGZ="B2^"_MAGX_"^^^INVALID Image ID (IEN)^^67^^^^^^^^"
"RTN","MAGGTIG",266,0)
 ;Added with MAGQI integrity check, 
"RTN","MAGGTIG",267,0)
 S MAGTMPAR(MAGX)=""
"RTN","MAGGTIG",268,0)
 Q
"RTN","MAGGTIG",269,0)
INVCH(MSG,CHILD) ;Added for MAGQI integrity check
"RTN","MAGGTIG",270,0)
 ; MSG is passed by reference, we create a MAGFILE equivalent and pass it back.
"RTN","MAGGTIG",271,0)
 N EMSG
"RTN","MAGGTIG",272,0)
 S EMSG=$P(MSG,U,2)
"RTN","MAGGTIG",273,0)
 K MSG
"RTN","MAGGTIG",274,0)
 S $P(MSG,U)=CHILD
"RTN","MAGGTIG",275,0)
 ; remove dependency on c:\program files.   with   .\bmp\
"RTN","MAGGTIG",276,0)
 S $P(MSG,U,2,3)="-1~Questionable Data Integrity^.\bmp\imageQA.bmp"
"RTN","MAGGTIG",277,0)
 S $P(MSG,U,4)=$P($G(^MAG(2005,CHILD,2)),U,4)
"RTN","MAGGTIG",278,0)
 S $P(MSG,U,6)=$S(($P(MSG,U,6)'=11):"99",1:11)
"RTN","MAGGTIG",279,0)
 ;this stops Delphi App from changing Abstract BMP to OFFLINE IMAGE
"RTN","MAGGTIG",280,0)
 S $P(MSG,U,10)="M"
"RTN","MAGGTIG",281,0)
 ;Send the error message
"RTN","MAGGTIG",282,0)
 S $P(MSG,U,17)=EMSG
"RTN","MAGGTIG",283,0)
 S MSG="B2^"_MSG
"RTN","MAGGTIG",284,0)
 S MAGTMPAR(CHILD)=""
"RTN","MAGGTIG",285,0)
 Q
"RTN","MAGGTU3")
0^5^B35227017
"RTN","MAGGTU3",1,0)
MAGGTU3 ;WOIFO/GEK/SG/NST - Silent calls for Imaging ; 21 Sep 2010 8:56 AM
"RTN","MAGGTU3",2,0)
 ;;3.0;IMAGING;**7,8,48,45,20,46,59,93,117,151**;Mar 19, 2002;Build 21;Dec 19, 2016
"RTN","MAGGTU3",3,0)
 ;; Per VHA Directive 2004-038, this routine should not be modified.
"RTN","MAGGTU3",4,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGGTU3",5,0)
 ;; | Property of the US Government.                                |
"RTN","MAGGTU3",6,0)
 ;; | No permission to copy or redistribute this software is given. |
"RTN","MAGGTU3",7,0)
 ;; | Use of unreleased versions of this software requires the user |
"RTN","MAGGTU3",8,0)
 ;; | to execute a written test agreement with the VistA Imaging    |
"RTN","MAGGTU3",9,0)
 ;; | Development Office of the Department of Veterans Affairs,     |
"RTN","MAGGTU3",10,0)
 ;; | telephone (301) 734-0100.                                     |
"RTN","MAGGTU3",11,0)
 ;; | The Food and Drug Administration classifies this software as  |
"RTN","MAGGTU3",12,0)
 ;; | a medical device.  As such, it may not be changed in any way. |
"RTN","MAGGTU3",13,0)
 ;; | Modifications to this software may result in an adulterated   |
"RTN","MAGGTU3",14,0)
 ;; | medical device under 21CFR820, the use of which is considered |
"RTN","MAGGTU3",15,0)
 ;; | to be a violation of US Federal Statutes.                     |
"RTN","MAGGTU3",16,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGGTU3",17,0)
 ;;
"RTN","MAGGTU3",18,0)
 Q
"RTN","MAGGTU3",19,0)
IMAGEINF(MAGRY,IEN,NOCHK) ;RPC [MAGG IMAGE INFO] Call to return information for 1 image;
"RTN","MAGGTU3",20,0)
 ; IEN   =       Image IEN  ^MAG(2005,IEN
"RTN","MAGGTU3",21,0)
 ; NOCHK =    1|""   if 1 then do not run QA check on this image.
"RTN","MAGGTU3",22,0)
 ; 
"RTN","MAGGTU3",23,0)
 N ERR,MAGFILE,Y,Z,MAGNOCHK
"RTN","MAGGTU3",24,0)
 ;--- Check if the image is deleted
"RTN","MAGGTU3",25,0)
 I $$ISDEL^MAGGI11(IEN,.ERR)  D  Q
"RTN","MAGGTU3",26,0)
 . S Y=$$NODE^MAGGI11(IEN)  S:Y'="" Y=$G(@Y@(2))
"RTN","MAGGTU3",27,0)
 . S MAGRY(0)="0^Image : """_$P(Y,U,4)_""" has been deleted."
"RTN","MAGGTU3",28,0)
 . Q
"RTN","MAGGTU3",29,0)
 ;--- Check for errors. Ignore the problem if there are 2 records
"RTN","MAGGTU3",30,0)
 ;    with the same IEN in files #2005 and #2005.1. After the file
"RTN","MAGGTU3",31,0)
 ;--- #2005.1 is completeley eliminated, ",+ERR'=-43" can be deleted.
"RTN","MAGGTU3",32,0)
 I ERR<0,+ERR'=-43  S MAGRY(0)="0^INVALID Image number "_IEN  Q
"RTN","MAGGTU3",33,0)
 ;--- MAGGTII queries the variable MAGNOCHK to run QA check or not.
"RTN","MAGGTU3",34,0)
 S MAGNOCHK=+$G(NOCHK)
"RTN","MAGGTU3",35,0)
 S MAGFILE=$$INFO^MAGGAII(IEN,"E")
"RTN","MAGGTU3",36,0)
 S Z=$P(^MAG(2005,IEN,0),U,7)
"RTN","MAGGTU3",37,0)
 I '$D(^DPT(Z)) S Z="1^Invalid patient pointer"
"RTN","MAGGTU3",38,0)
 E  S Z=Z_U_$P(^DPT(Z,0),U)
"RTN","MAGGTU3",39,0)
 S MAGRY(0)="1^"_MAGFILE
"RTN","MAGGTU3",40,0)
 S MAGRY(1)=Z ; dfn^name
"RTN","MAGGTU3",41,0)
 Q
"RTN","MAGGTU3",42,0)
USERINF2(MAGRY,MAGWRKID) ;RPC [MAGGUSER2] Return user info.
"RTN","MAGGTU3",43,0)
 ; MAGRY(1) = DUZ ^ FULL NAME  ^ INITIALS
"RTN","MAGGTU3",44,0)
 ; MAGRY(2) = Network UserName ^ PassWord.
"RTN","MAGGTU3",45,0)
 ; MAGRY(3) = MUSE Site number. ( default = 1)
"RTN","MAGGTU3",46,0)
 ; Node 4 is data from IMAGING SITE PARAMATERS File #2006.1 and INSTITUTION File #4
"RTN","MAGGTU3",47,0)
 ; MAGRY(4)= PLACE IEN  ^ SITE CODE ^ DUZ(2) ^ INSTITUTION NAME (.01) ^ $$CONSOLID ^ User's local STATION NUMBER (99)
"RTN","MAGGTU3",48,0)
 ; MAGRY(5) = +<CP Version>|0 ^ Version of CP installed on Server
"RTN","MAGGTU3",49,0)
 ; MAGRY(6) = Warning message if we can't resolve which Site Parameter entry to use.
"RTN","MAGGTU3",50,0)
 ; MAGRY(7) = Warning message  <reserved for future>
"RTN","MAGGTU3",51,0)
 ; MAGRY(8) = 1|0  1 = Production account    0 = Test Account (or couldn't determine) ;Patch 41
"RTN","MAGGTU3",52,0)
 ; MAGRY(9) = Vista Site Service PHYSICAL REFERENCE from Network Location File.
"RTN","MAGGTU3",53,0)
 ; MAGRY(10)=Domain Name
"RTN","MAGGTU3",54,0)
 ; MAGRY(11)=Primary Division IEN
"RTN","MAGGTU3",55,0)
 ; MAGRY(12)=Primary Division STATION NUMBER
"RTN","MAGGTU3",56,0)
 ; p151 Added 13 and 14
"RTN","MAGGTU3",57,0)
 ; MAGRY(13)=Clinical Display User Manual URL
"RTN","MAGGTU3",58,0)
 ; MAGRY(14)=Clinical Capture User Manual URL
"RTN","MAGGTU3",59,0)
 ;  
"RTN","MAGGTU3",60,0)
 N J,K,Y,MAGPLC,MAGWARN,MAGWARN1,VSRV,PHYREF,X ; DBI - SEB 9/20/2002
"RTN","MAGGTU3",61,0)
 S MAGPLC=0
"RTN","MAGGTU3",62,0)
 I $D(DUZ(2)) S MAGPLC=+$$PLACE^MAGBAPI(DUZ(2)) ; DBI - SEB 9/20/2002
"RTN","MAGGTU3",63,0)
 ;
"RTN","MAGGTU3",64,0)
 ; SET THE PARTITION VARIABLE MAGSYS   i.e.'IGK_Garrett's Desk'
"RTN","MAGGTU3",65,0)
 S MAGSYS=$G(MAGWRKID,"")
"RTN","MAGGTU3",66,0)
 I +$G(DUZ)=0 S MAGRY(0)="0^DUZ Undefined, Null or Zero" Q
"RTN","MAGGTU3",67,0)
 I 'MAGPLC D
"RTN","MAGGTU3",68,0)
 . S MAGWARN="Can't resolve Site Param, DUZ(2): "_$S($D(DUZ(2)):DUZ(2),1:"NULL")_" DUZ: "_DUZ
"RTN","MAGGTU3",69,0)
 . S MAGPLC=$$DUZ2PLC^MAGBAPIP(.MAGWARN1) ; DBI - SEB 9/20/2002
"RTN","MAGGTU3",70,0)
 . Q
"RTN","MAGGTU3",71,0)
 S MAGRY(0)="1^"
"RTN","MAGGTU3",72,0)
 ;          DUZ     FULL NAME                INITIALS
"RTN","MAGGTU3",73,0)
 S MAGRY(1)=DUZ_U_$$GET1^DIQ(200,DUZ_",",.01)_U_$$GET1^DIQ(200,DUZ_",",1)
"RTN","MAGGTU3",74,0)
 ; NOW NET STUFF
"RTN","MAGGTU3",75,0)
 I 'MAGPLC Q 
"RTN","MAGGTU3",76,0)
 ; From IMAGING SITE PARAMETERS File
"RTN","MAGGTU3",77,0)
 ;   get the Network UserName and PassWord.
"RTN","MAGGTU3",78,0)
 S MAGRY(2)=$P($G(^MAG(2006.1,MAGPLC,"NET")),U,1,2)
"RTN","MAGGTU3",79,0)
 ;   get the default MUSE Site number.
"RTN","MAGGTU3",80,0)
 S MAGRY(3)=+$P($G(^MAG(2006.1,MAGPLC,"USERPREF")),U,2)
"RTN","MAGGTU3",81,0)
 ;   default to 1 if nothing is entered in Site Parameters File
"RTN","MAGGTU3",82,0)
 I MAGRY(3)=0 S MAGRY(3)=1
"RTN","MAGGTU3",83,0)
 ; This SITEIEN^SITECODE^USER INSTITUTION IEN^INSTITUTION NAME^CONSOLIDATED^User's local STATION NUMBER
"RTN","MAGGTU3",84,0)
 ;  is  used by Display to determine location of Workstation
"RTN","MAGGTU3",85,0)
 ;  and used by Capture to determine the Write Location.
"RTN","MAGGTU3",86,0)
 S MAGRY(4)=MAGPLC_U_$$GET1^DIQ(2006.1,MAGPLC,.09)_U_$G(DUZ(2))_U_$$GET1^DIQ(2006.1,MAGPLC,.01,"E")
"RTN","MAGGTU3",87,0)
 S MAGJOB("PLC")=MAGPLC
"RTN","MAGGTU3",88,0)
 S MAGJOB("PLCODE")=$$GET1^DIQ(2006.1,MAGPLC,.09)
"RTN","MAGGTU3",89,0)
 S MAGRY(4)=MAGRY(4)_U_$$CONSOLID^MAGBAPI_U_$$GET1^DIQ(4,DUZ(2),99,"E")
"RTN","MAGGTU3",90,0)
 ; is CP not installed at this site, the Client will hide options
"RTN","MAGGTU3",91,0)
 ;  related to CP.
"RTN","MAGGTU3",92,0)
 S X=$$VERSION^XPDUTL("CLINICAL PROCEDURES")
"RTN","MAGGTU3",93,0)
 S MAGRY(5)=+X_U_X
"RTN","MAGGTU3",94,0)
 S MAGRY(6)=$G(MAGWARN)
"RTN","MAGGTU3",95,0)
 S MAGRY(7)=$G(MAGWARN1)
"RTN","MAGGTU3",96,0)
 S MAGRY(8)=$S($L($T(PROD^XUPROD)):+$$PROD^XUPROD,1:0)
"RTN","MAGGTU3",97,0)
 S VSRV=$P($G(^MAG(2006.1,MAGPLC,"NET")),"^",5)
"RTN","MAGGTU3",98,0)
 I VSRV I +$P($G(^MAG(2005.2,VSRV,0)),"^",6) S PHYREF=$P($G(^MAG(2005.2,VSRV,0)),"^",2)
"RTN","MAGGTU3",99,0)
 S MAGRY(9)=$G(PHYREF)
"RTN","MAGGTU3",100,0)
 S MAGRY(10)=$$KSP^XUPARAM("WHERE")
"RTN","MAGGTU3",101,0)
 S MAGRY(11)=$P($$SITE^VASITE(),"^")
"RTN","MAGGTU3",102,0)
 S MAGRY(12)=$P($$SITE^VASITE(),"^",3)
"RTN","MAGGTU3",103,0)
 S MAGRY(13)=$P($G(^MAG(2006.1,MAGPLC,"HELPD")),"^",1) ; p151
"RTN","MAGGTU3",104,0)
 S MAGRY(14)=$P($G(^MAG(2006.1,MAGPLC,"HELPC")),"^",1) ; p151
"RTN","MAGGTU3",105,0)
 Q
"RTN","MAGGTU3",106,0)
 ;
"RTN","MAGGTU3",107,0)
CATEGORY(MAGRY) ; RPC [MAGGDESCCAT] Call to return Mag Descriptive Categories in array
"RTN","MAGGTU3",108,0)
 ; for listing in a list box.
"RTN","MAGGTU3",109,0)
 N I,K,CT,Y
"RTN","MAGGTU3",110,0)
 S I=0,CT=0
"RTN","MAGGTU3",111,0)
 I '$D(^MAG(2005.81)) D  Q
"RTN","MAGGTU3",112,0)
 . S MAGRY(0)="0^ERROR Mag Descriptive Category File doesn't exist"
"RTN","MAGGTU3",113,0)
 F  S I=$O(^MAG(2005.81,"B",I)) Q:I=""  D
"RTN","MAGGTU3",114,0)
 . ;Next line adds ADMIN, CLIN 3rd piece of the data returned
"RTN","MAGGTU3",115,0)
 . S K=$O(^MAG(2005.81,"B",I,"")),CT=CT+1
"RTN","MAGGTU3",116,0)
 . S MAGRY(CT)=I_U_K_U_$P(^MAG(2005.81,K,0),U,2)
"RTN","MAGGTU3",117,0)
 S MAGRY(0)=CT_"^Categories on file"
"RTN","MAGGTU3",118,0)
 Q
"RTN","MAGGTU3",119,0)
USERKEYS(MAGKEY) ; RPC [MAGGUSERKEYS]
"RTN","MAGGTU3",120,0)
 ; Call to return an array of IMAGING Security Keys
"RTN","MAGGTU3",121,0)
 D USERKEYS^MAGGTU31(.MAGKEY)
"RTN","MAGGTU3",122,0)
 Q
"RTN","MAGGTU3",123,0)
MAIL(MAGRY,MAGFILE,MAGIEN) ;RPC [MAGG OFFLINE IMAGE ACCESSED]
"RTN","MAGGTU3",124,0)
 ;   Called to log an Offline Image accessed.
"RTN","MAGGTU3",125,0)
 ;   ^MAGQUEUE(2006.033,0) = OFFLINE IMAGES
"RTN","MAGGTU3",126,0)
 ;   User must edit 2006.033 by hand to mark images as OFFLINE.
"RTN","MAGGTU3",127,0)
 ;
"RTN","MAGGTU3",128,0)
 N FILEREF,PLATTER,A
"RTN","MAGGTU3",129,0)
 S MAGRY="0^Error : logging access to Off-Line Image"
"RTN","MAGGTU3",130,0)
 N $ETRAP,$ESTACK S $ETRAP="D ERR^MAGGTERR"
"RTN","MAGGTU3",131,0)
 S FILEREF=$$UP^XLFSTR($P(MAGFILE,"\",$L(MAGFILE,"\")))
"RTN","MAGGTU3",132,0)
 S PLATTER=$O(^MAGQUEUE(2006.033,"B",FILEREF,""))
"RTN","MAGGTU3",133,0)
 S PLATTER=$P(^MAGQUEUE(2006.033,PLATTER,0),U,2)
"RTN","MAGGTU3",134,0)
 I MAGFILE[".ABS" Q
"RTN","MAGGTU3",135,0)
 N XMDUZ,XMSUB,XMTEXT,XMY
"RTN","MAGGTU3",136,0)
 S XMDUZ=$S($D(DUZ):DUZ,1:.5)
"RTN","MAGGTU3",137,0)
 S XMSUB="Offline Image Request"
"RTN","MAGGTU3",138,0)
 S XMTEXT="A("
"RTN","MAGGTU3",139,0)
 S A(1)="Patient   : "_$P(^DPT($P($G(^MAG(2005,+MAGIEN,0)),U,7),0),U,1)
"RTN","MAGGTU3",140,0)
 S A(2)="FileName  : "_MAGFILE_"  "_MAGIEN
"RTN","MAGGTU3",141,0)
 S A(3)="Desc      : "_$P($G(^MAG(2005,MAGIEN,2)),U,4)
"RTN","MAGGTU3",142,0)
 S A(4)="Procedure : "_$P($G(^MAG(2005,MAGIEN,0)),U,8)
"RTN","MAGGTU3",143,0)
 S A(5)="Platter   : "_PLATTER
"RTN","MAGGTU3",144,0)
 S A(6)="User      : "_$$GET1^DIQ(200,DUZ_",",.01)_"("_$G(DUZ)_")"
"RTN","MAGGTU3",145,0)
 S XMY("G.OFFLINE IMAGE TRACKERS")="" D ^XMD
"RTN","MAGGTU3",146,0)
 S MAGRY="1^Message sent :  Offline Image Accessed"
"RTN","MAGGTU3",147,0)
 Q
"RTN","MAGGTU3",148,0)
LOGERROR(MAGRY,TEXT) ;RPC [MAGG LOG ERROR TEXT]
"RTN","MAGGTU3",149,0)
 ; Call to stuff error information from Delphi app into the Session file.
"RTN","MAGGTU3",150,0)
 Q:($P($G(MAGJOB("VERSION")),".",1,2))<"3.0"
"RTN","MAGGTU3",151,0)
 D LOGERR^MAGGTERR("---- New Error ----")
"RTN","MAGGTU3",152,0)
 S I="" F  S I=$O(TEXT(I)) Q:I=""  D LOGERR^MAGGTERR(TEXT(I))
"RTN","MAGGTU3",153,0)
 S MAGRY="1^Error text saved to Session file"
"RTN","MAGGTU3",154,0)
 Q
"RTN","MAGGTU3",155,0)
RSLVABS(MAGIEN,FILENAME) ;Resolve Abstract into the Default Bitmap 
"RTN","MAGGTU3",156,0)
 ; Return the default bitmap, If the image file extension resolves into a default bitmap
"RTN","MAGGTU3",157,0)
 ; MAGIEN        : Image internal entry number
"RTN","MAGGTU3",158,0)
 ; FILENAME      : ""  or Relative Path and Default Bitmap. ie ('.\BMP\magavi.bmp')
"RTN","MAGGTU3",159,0)
 N FTIEN,EXT ; 
"RTN","MAGGTU3",160,0)
 S FILENAME=""
"RTN","MAGGTU3",161,0)
 I '$D(^MAG(2005.021)) Q  ; IMAGE FILE TYPES doesn't exist on this system.
"RTN","MAGGTU3",162,0)
 S EXT=$P($P(^MAG(2005,MAGIEN,0),"^",2),".",2) ; image file extension   JPG, TGA, etc.
"RTN","MAGGTU3",163,0)
 Q:EXT=""  ;
"RTN","MAGGTU3",164,0)
 S FTIEN=$O(^MAG(2005.021,"B",EXT,""))
"RTN","MAGGTU3",165,0)
 Q:'FTIEN  ; No extension in IMAGE FILE TYPES file.
"RTN","MAGGTU3",166,0)
 ; stop dependency on "c:\program files"
"RTN","MAGGTU3",167,0)
 I '+$P(^MAG(2005.021,FTIEN,0),"^",5) S FILENAME=".\BMP\"_$P(^MAG(2005.021,FTIEN,0),"^",4)
"RTN","MAGGTU3",168,0)
 ;out 151T6; I +$P(^MAG(2005.021,FTIEN,0),"^",5) S FILENAME=".\BMP\NOTEXIST.BMP"
"RTN","MAGGTU3",169,0)
 Q
"RTN","MAGGTU4C")
0^2^B5134971
"RTN","MAGGTU4C",1,0)
MAGGTU4C ;WOIFO/SG/NST/JSL - VERSION CONTROL (CLINICAL CAPTURE) ; 08 Mar 2011 2:52 PM
"RTN","MAGGTU4C",2,0)
 ;;3.0;IMAGING;**93,94,106,117,122,129,140,151**;Mar 19, 2002;Build 21;Dec 19, 2016
"RTN","MAGGTU4C",3,0)
 ;; Per VHA Directive 2004-038, this routine should not be modified.
"RTN","MAGGTU4C",4,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGGTU4C",5,0)
 ;; | Property of the US Government.                                |
"RTN","MAGGTU4C",6,0)
 ;; | No permission to copy or redistribute this software is given. |
"RTN","MAGGTU4C",7,0)
 ;; | Use of unreleased versions of this software requires the user |
"RTN","MAGGTU4C",8,0)
 ;; | to execute a written test agreement with the VistA Imaging    |
"RTN","MAGGTU4C",9,0)
 ;; | Development Office of the Department of Veterans Affairs,     |
"RTN","MAGGTU4C",10,0)
 ;; | telephone (301) 734-0100.                                     |
"RTN","MAGGTU4C",11,0)
 ;; | The Food and Drug Administration classifies this software as  |
"RTN","MAGGTU4C",12,0)
 ;; | a medical device.  As such, it may not be changed in any way. |
"RTN","MAGGTU4C",13,0)
 ;; | Modifications to this software may result in an adulterated   |
"RTN","MAGGTU4C",14,0)
 ;; | medical device under 21CFR820, the use of which is considered |
"RTN","MAGGTU4C",15,0)
 ;; | to be a violation of US Federal Statutes.                     |
"RTN","MAGGTU4C",16,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGGTU4C",17,0)
 ;;
"RTN","MAGGTU4C",18,0)
 ; This routine contains the version control code and data specific
"RTN","MAGGTU4C",19,0)
 ; to the Clinical Capture application. DO NOT ADD ANYTHING ELSE!
"RTN","MAGGTU4C",20,0)
 Q
"RTN","MAGGTU4C",21,0)
 ;
"RTN","MAGGTU4C",22,0)
 ; Build 5 changed to Stop support for 122 and older.
"RTN","MAGGTU4C",23,0)
CLVERCT ;***** VERSION CONTROL TABLE FOR THE CLINICAL CAPTURE CLIENTS
"RTN","MAGGTU4C",24,0)
 ;;==================================================================
"RTN","MAGGTU4C",25,0)
 ;;| Version |Build|Seq #|                Comment                   |
"RTN","MAGGTU4C",26,0)
 ;;|---------+-----+------------------------------------------------|
"RTN","MAGGTU4C",27,0)
 ;;| 3.0.151 |   7 |  75 | Jan 2017                                 |
"RTN","MAGGTU4C",28,0)
 ;;| 3.0.140 |  21 |  70 | Sep 2013                                 |
"RTN","MAGGTU4C",29,0)
 ;;| 3.0.129 |  18 |  60 | Apr 2013                                 |
"RTN","MAGGTU4C",30,0)
 ;;| 3.0.122 |  15 |  55 | Nov 2012                                 |
"RTN","MAGGTU4C",31,0)
 ;;==================================================================
"RTN","MAGGTU4C",32,0)
 ;
"RTN","MAGGTU4C",33,0)
 ; Each row of the version control table contains the version and
"RTN","MAGGTU4C",34,0)
 ; build number of a supported client. Released patches must also
"RTN","MAGGTU4C",35,0)
 ; indicate the sequential numbers.
"RTN","MAGGTU4C",36,0)
 ; Sort order of the rows does not matter. However, the reversed
"RTN","MAGGTU4C",37,0)
 ; order of patch sequential numbers is recommended.
"RTN","MAGGTU4C",38,0)
 ;  p151 Stopping support for these
"RTN","MAGGTU4C",39,0)
 ; 3.0.117 |   8 |  45 | Jul 2011
"RTN","MAGGTU4C",40,0)
 ; 3.0.106 |  13 |  40 | Feb 2011
"RTN","MAGGTU4C",41,0)
 ; 3.0.94  |  12 |  35 | May 2010 
"RTN","MAGGTU4C",42,0)
 ;
"RTN","MAGGTU4C",43,0)
 Q
"RTN","MAGGTU4C",44,0)
 ;
"RTN","MAGGTU4C",45,0)
 ;***** ADDS A CLIENT-SPECIFIC WARNING (IF NECESSARY)
"RTN","MAGGTU4C",46,0)
 ;
"RTN","MAGGTU4C",47,0)
 ; .MAGBUF       Reference to a local array that the warning text
"RTN","MAGGTU4C",48,0)
 ;               is returned to. It is appended to the RPC result
"RTN","MAGGTU4C",49,0)
 ;               array by the caller (WARNING^MAGGTU41).
"RTN","MAGGTU4C",50,0)
 ;
"RTN","MAGGTU4C",51,0)
 ; CLVER         Client application version (Major.Minor.Patch.Build)
"RTN","MAGGTU4C",52,0)
 ;
"RTN","MAGGTU4C",53,0)
 ; CVRC          Version check code returned by the $$CHKVER1^MAGGTU41
"RTN","MAGGTU4C",54,0)
 ;
"RTN","MAGGTU4C",55,0)
 ; Notes
"RTN","MAGGTU4C",56,0)
 ; =====
"RTN","MAGGTU4C",57,0)
 ;
"RTN","MAGGTU4C",58,0)
 ; If the RPC result array already contains an error message that
"RTN","MAGGTU4C",59,0)
 ; will terminate the client, application, this procedure is not
"RTN","MAGGTU4C",60,0)
 ; called.
"RTN","MAGGTU4C",61,0)
 ;
"RTN","MAGGTU4C",62,0)
WARNING(MAGBUF,CLVER,CVRC) ;
"RTN","MAGGTU4C",63,0)
 Q
"RTN","MAGIP151")
0^1^B7810500
"RTN","MAGIP151",1,0)
MAGIP151 ;WOIFO/GEK - INSTALL CODE FOR MAG*3.0*151 - Scanning issues ;
"RTN","MAGIP151",2,0)
 ;;3.0;IMAGING;**151**;Mar 19, 2002;Build 21;Dec 19, 2016
"RTN","MAGIP151",3,0)
 ;; Per VHA Directive 2004-038, this routine should not be modified.
"RTN","MAGIP151",4,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGIP151",5,0)
 ;; | Property of the US Government.                                |
"RTN","MAGIP151",6,0)
 ;; | No permission to copy or redistribute this software is given. |
"RTN","MAGIP151",7,0)
 ;; | Use of unreleased versions of this software requires the user |
"RTN","MAGIP151",8,0)
 ;; | to execute a written test agreement with the VistA Imaging    |
"RTN","MAGIP151",9,0)
 ;; | Development Office of the Department of Veterans Affairs,     |
"RTN","MAGIP151",10,0)
 ;; | telephone (301) 734-0100.                                     |
"RTN","MAGIP151",11,0)
 ;; | The Food and Drug Administration classifies this software as  |
"RTN","MAGIP151",12,0)
 ;; | a medical device.  As such, it may not be changed in any way. |
"RTN","MAGIP151",13,0)
 ;; | Modifications to this software may result in an adulterated   |
"RTN","MAGIP151",14,0)
 ;; | medical device under 21CFR820, the use of which is considered |
"RTN","MAGIP151",15,0)
 ;; | to be a violation of US Federal Statutes.                     |
"RTN","MAGIP151",16,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGIP151",17,0)
 ;;
"RTN","MAGIP151",18,0)
 ; There are no environment checks here but the MAGIP151 has to be
"RTN","MAGIP151",19,0)
 ; referenced by the "Environment Check Routine" field of the KIDS
"RTN","MAGIP151",20,0)
 ; build so that entry points of the routine are available to the
"RTN","MAGIP151",21,0)
 ; KIDS during all installation phases.
"RTN","MAGIP151",22,0)
 ;
"RTN","MAGIP151",23,0)
 Q
"RTN","MAGIP151",24,0)
 ;
"RTN","MAGIP151",25,0)
 ;+++++ INSTALLATION ERROR HANDLING
"RTN","MAGIP151",26,0)
ERROR ;
"RTN","MAGIP151",27,0)
 S:$D(XPDNM) XPDABORT=1
"RTN","MAGIP151",28,0)
 ;--- Display the messages and store them to the INSTALL file
"RTN","MAGIP151",29,0)
 D DUMP^MAGUERR1(),ABTMSG^MAGKIDS()
"RTN","MAGIP151",30,0)
 Q
"RTN","MAGIP151",31,0)
 ;
"RTN","MAGIP151",32,0)
 ;***** POST-INSTALL CODE
"RTN","MAGIP151",33,0)
POS ;
"RTN","MAGIP151",34,0)
 N CALLBACK
"RTN","MAGIP151",35,0)
 N I,HUD,HUC
"RTN","MAGIP151",36,0)
 D CLEAR^MAGUERR(1)
"RTN","MAGIP151",37,0)
 ;
"RTN","MAGIP151",38,0)
 ;--- Link new remote procedures to the Broker context option
"RTN","MAGIP151",39,0)
 ;*** None for 151 **
"RTN","MAGIP151",40,0)
 ;S CALLBACK="$$ADDRPCS^"_$NA(MAGKIDS1("RPCLST^"_$T(+0),"MAG WINDOWS"))
"RTN","MAGIP151",41,0)
 ;I $$CP^MAGKIDS("MAG ATTACH RPCS",CALLBACK)<0  D ERROR  Q
"RTN","MAGIP151",42,0)
 ;
"RTN","MAGIP151",43,0)
 ;
"RTN","MAGIP151",44,0)
 ;--- Misc Updates
"RTN","MAGIP151",45,0)
 ;*** None for 151 **
"RTN","MAGIP151",46,0)
 ;I $$CP^MAGKIDS("MAG 151 MISC UPDATES ","$$UPDATE^"_$T(+0))<0 D ERROR Q
"RTN","MAGIP151",47,0)
 ;
"RTN","MAGIP151",48,0)
 ;--- Add Display and Capture User Manual url's to the IMAGING SITE PARAMETERS File.
"RTN","MAGIP151",49,0)
 ;   #(2006.1)
"RTN","MAGIP151",50,0)
 S HUD="http://vaww.oed.portal.domain.ext/applications/VistAImaging/VistA%20Enterprise%20Documents/User%20Manuals/MAG_Display_User_Manual.pdf"
"RTN","MAGIP151",51,0)
 S HUC="http://vaww.oed.portal.domain.ext/applications/VistAImaging/VistA%20Enterprise%20Documents/User%20Manuals/MAG_Capture_User_Manual.pdf"
"RTN","MAGIP151",52,0)
 S I=0 
"RTN","MAGIP151",53,0)
 F  S I=$O(^MAG(2006.1,I)) Q:'I  D  ;
"RTN","MAGIP151",54,0)
 . S ^MAG(2006.1,I,"HELPD")=HUD
"RTN","MAGIP151",55,0)
 . S ^MAG(2006.1,I,"HELPC")=HUC
"RTN","MAGIP151",56,0)
 . Q
"RTN","MAGIP151",57,0)
 ;--- Send the notification e-mail
"RTN","MAGIP151",58,0)
 D BMES^XPDUTL("Post Install Mail Message: "_$$FMTE^XLFDT($$NOW^XLFDT))
"RTN","MAGIP151",59,0)
 D INS^MAGQBUT4(XPDNM,DUZ,$$NOW^XLFDT,XPDA)
"RTN","MAGIP151",60,0)
 ;
"RTN","MAGIP151",61,0)
 Q
"RTN","MAGIP151",62,0)
 ;
"RTN","MAGIP151",63,0)
 ;***** PRE-INSTALL CODE
"RTN","MAGIP151",64,0)
PRE ;
"RTN","MAGIP151",65,0)
 ;
"RTN","MAGIP151",66,0)
 Q
"VER")
8.0^22.0
"^DD",2006.1,2006.1,75,0)
DISPLAY HELP URL^F^^HELPD;1^K:$L(X)>250!($L(X)<3) X
"^DD",2006.1,2006.1,75,3)
Enter the url of the Clinical Display User Manual, 3 to 250 characters.
"^DD",2006.1,2006.1,75,21,0)
^.001^4^4^3160720^^
"^DD",2006.1,2006.1,75,21,1,0)
The Display Client help menu has an option to open the
"^DD",2006.1,2006.1,75,21,2,0)
VistA Imaging Clinical Display User Manual.
"^DD",2006.1,2006.1,75,21,3,0)
The User Manual is on the VistA Imaging Sharepoint Web site.
"^DD",2006.1,2006.1,75,21,4,0)
Enter the url of the Display User Manual here.
"^DD",2006.1,2006.1,75,"DT")
3160707
"^DD",2006.1,2006.1,76,0)
CAPTURE HELP URL^F^^HELPC;1^K:$L(X)>250!($L(X)<3) X
"^DD",2006.1,2006.1,76,3)
Enter the url of the Clinical Capture User Manual, 3 to 250 characters.
"^DD",2006.1,2006.1,76,21,0)
^.001^4^4^3160720^^
"^DD",2006.1,2006.1,76,21,1,0)
The Capture Client help menu has an option to open the
"^DD",2006.1,2006.1,76,21,2,0)
VistA Imaging Clinical Capture User Manual.
"^DD",2006.1,2006.1,76,21,3,0)
The User Manual is on the VistA Imaging Sharepoint Web site.
"^DD",2006.1,2006.1,76,21,4,0)
Enter the url of the Capture User Manual here.
"^DD",2006.1,2006.1,76,"DT")
3160707
**END**
**END**
