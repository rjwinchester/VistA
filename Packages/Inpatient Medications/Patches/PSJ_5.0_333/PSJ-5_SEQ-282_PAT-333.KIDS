EMERGENCY Released PSJ*5*333 SEQ #282
Extracted from mail message
**KIDS**:PSJ*5.0*333^

**INSTALL NAME**
PSJ*5.0*333
"BLD",9314,0)
PSJ*5.0*333^INPATIENT MEDICATIONS^0^3160817^y
"BLD",9314,1,0)
^^12^12^3160817^
"BLD",9314,1,1,0)
 This patch is part of the Pharmacy Safety Updates project and will 
"BLD",9314,1,2,0)
 address the Patient Safety Issue (PSI) #PSPO00003281. 
"BLD",9314,1,3,0)
 
"BLD",9314,1,4,0)
 The issue is that an <UNDEFINED> error is occurring while finishing a 
"BLD",9314,1,5,0)
 pending order in the Inpatient Medications application causing a forced 
"BLD",9314,1,6,0)
 exit from the Inpatient Order Entry [PSJ OE] option when attempting to 
"BLD",9314,1,7,0)
 finish UNIT DOSE orders. The order being finished presents as an IV order
"BLD",9314,1,8,0)
 and prompts the user to finish as either UD or IV. The user is choosing
"BLD",9314,1,9,0)
 to finish as UD.
"BLD",9314,1,10,0)
 
"BLD",9314,1,11,0)
 PSI PSPO00003281 is CA Service Desk Ticket I9935231FY16-IP MEDS HARD 
"BLD",9314,1,12,0)
 ERRORING IN FINISHING ORDERS.
"BLD",9314,4,0)
^9.64PA^^
"BLD",9314,6.3)
2
"BLD",9314,"ABPKG")
n
"BLD",9314,"KRN",0)
^9.67PA^779.2^20
"BLD",9314,"KRN",.4,0)
.4
"BLD",9314,"KRN",.401,0)
.401
"BLD",9314,"KRN",.402,0)
.402
"BLD",9314,"KRN",.403,0)
.403
"BLD",9314,"KRN",.5,0)
.5
"BLD",9314,"KRN",.84,0)
.84
"BLD",9314,"KRN",3.6,0)
3.6
"BLD",9314,"KRN",3.8,0)
3.8
"BLD",9314,"KRN",9.2,0)
9.2
"BLD",9314,"KRN",9.8,0)
9.8
"BLD",9314,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",9314,"KRN",9.8,"NM",1,0)
PSJLIFN^^0^B52505954
"BLD",9314,"KRN",9.8,"NM","B","PSJLIFN",1)

"BLD",9314,"KRN",19,0)
19
"BLD",9314,"KRN",19,"NM",0)
^9.68A^^
"BLD",9314,"KRN",19.1,0)
19.1
"BLD",9314,"KRN",19.1,"NM",0)
^9.68A^^
"BLD",9314,"KRN",101,0)
101
"BLD",9314,"KRN",101,"NM",0)
^9.68A^^
"BLD",9314,"KRN",409.61,0)
409.61
"BLD",9314,"KRN",409.61,"NM",0)
^9.68A^^
"BLD",9314,"KRN",771,0)
771
"BLD",9314,"KRN",771,"NM",0)
^9.68A^^
"BLD",9314,"KRN",779.2,0)
779.2
"BLD",9314,"KRN",779.2,"NM",0)
^9.68A^^
"BLD",9314,"KRN",870,0)
870
"BLD",9314,"KRN",870,"NM",0)
^9.68A^^
"BLD",9314,"KRN",8989.51,0)
8989.51
"BLD",9314,"KRN",8989.51,"NM",0)
^9.68A^^
"BLD",9314,"KRN",8989.52,0)
8989.52
"BLD",9314,"KRN",8989.52,"NM",0)
^9.68A^^
"BLD",9314,"KRN",8994,0)
8994
"BLD",9314,"KRN",8994,"NM",0)
^9.68A^^
"BLD",9314,"KRN","B",.4,.4)

"BLD",9314,"KRN","B",.401,.401)

"BLD",9314,"KRN","B",.402,.402)

"BLD",9314,"KRN","B",.403,.403)

"BLD",9314,"KRN","B",.5,.5)

"BLD",9314,"KRN","B",.84,.84)

"BLD",9314,"KRN","B",3.6,3.6)

"BLD",9314,"KRN","B",3.8,3.8)

"BLD",9314,"KRN","B",9.2,9.2)

"BLD",9314,"KRN","B",9.8,9.8)

"BLD",9314,"KRN","B",19,19)

"BLD",9314,"KRN","B",19.1,19.1)

"BLD",9314,"KRN","B",101,101)

"BLD",9314,"KRN","B",409.61,409.61)

"BLD",9314,"KRN","B",771,771)

"BLD",9314,"KRN","B",779.2,779.2)

"BLD",9314,"KRN","B",870,870)

"BLD",9314,"KRN","B",8989.51,8989.51)

"BLD",9314,"KRN","B",8989.52,8989.52)

"BLD",9314,"KRN","B",8994,8994)

"BLD",9314,"QUES",0)
^9.62^^
"BLD",9314,"REQB",0)
^9.611^1^1
"BLD",9314,"REQB",1,0)
PSJ*5.0*313^2
"BLD",9314,"REQB","B","PSJ*5.0*313",1)

"MBREQ")
0
"PKG",197,-1)
1^1
"PKG",197,0)
INPATIENT MEDICATIONS^PSJ^UNIT DOSE AND IVS
"PKG",197,20,0)
^9.402P^^
"PKG",197,22,0)
^9.49I^1^1
"PKG",197,22,1,0)
5.0^2971215^2980917^11712
"PKG",197,22,1,"PAH",1,0)
333^3160817
"PKG",197,22,1,"PAH",1,1,0)
^^12^12^3160817
"PKG",197,22,1,"PAH",1,1,1,0)
 This patch is part of the Pharmacy Safety Updates project and will 
"PKG",197,22,1,"PAH",1,1,2,0)
 address the Patient Safety Issue (PSI) #PSPO00003281. 
"PKG",197,22,1,"PAH",1,1,3,0)
 
"PKG",197,22,1,"PAH",1,1,4,0)
 The issue is that an <UNDEFINED> error is occurring while finishing a 
"PKG",197,22,1,"PAH",1,1,5,0)
 pending order in the Inpatient Medications application causing a forced 
"PKG",197,22,1,"PAH",1,1,6,0)
 exit from the Inpatient Order Entry [PSJ OE] option when attempting to 
"PKG",197,22,1,"PAH",1,1,7,0)
 finish UNIT DOSE orders. The order being finished presents as an IV order
"PKG",197,22,1,"PAH",1,1,8,0)
 and prompts the user to finish as either UD or IV. The user is choosing
"PKG",197,22,1,"PAH",1,1,9,0)
 to finish as UD.
"PKG",197,22,1,"PAH",1,1,10,0)
 
"PKG",197,22,1,"PAH",1,1,11,0)
 PSI PSPO00003281 is CA Service Desk Ticket I9935231FY16-IP MEDS HARD 
"PKG",197,22,1,"PAH",1,1,12,0)
 ERRORING IN FINISHING ORDERS.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","PSJLIFN")
0^1^B52505954^B52671541
"RTN","PSJLIFN",1,0)
PSJLIFN ;BIR/MV-IV FINISH USING LM ;13 Jan 98 / 11:32 AM
"RTN","PSJLIFN",2,0)
 ;;5.0;INPATIENT MEDICATIONS ;**1,29,34,37,42,47,50,56,94,80,116,110,181,261,252,313,333**;16 DEC 97;Build 2
"RTN","PSJLIFN",3,0)
 ;
"RTN","PSJLIFN",4,0)
 ; Reference to ^PS(51.2 is supported by DBIA #2178.
"RTN","PSJLIFN",5,0)
 ; Reference to ^PS(52.6 supported by DBIA #1231.
"RTN","PSJLIFN",6,0)
 ; Reference to ^PS(52.7 supported by DBIA #2173.
"RTN","PSJLIFN",7,0)
 ; Reference to ^PSDRUG( is supported by DBIA #2192.
"RTN","PSJLIFN",8,0)
 ; Reference to ^PSOORDRG is supported by DBIA #2190.
"RTN","PSJLIFN",9,0)
 ; Reference to ^%DT is supported by DBIA #10003.
"RTN","PSJLIFN",10,0)
 ; Reference to ^VALM is supported by DBIA #10118.
"RTN","PSJLIFN",11,0)
 ; Reference to ^VALM1 is supported by DBIA #10116.
"RTN","PSJLIFN",12,0)
 ; Reference to RE^VALM4 is supported by DBIA #10120.
"RTN","PSJLIFN",13,0)
 ;
"RTN","PSJLIFN",14,0)
EN ; Display order with numbers.
"RTN","PSJLIFN",15,0)
 L +^PS(53.1,+PSJORD):1 I '$T W !,$C(7),$C(7),"This order is being edited by another user. Try later." D PAUSE^VALM1 Q
"RTN","PSJLIFN",16,0)
 NEW PSJOCFG
"RTN","PSJLIFN",17,0)
 S PSJOCFG="FN IV"
"RTN","PSJLIFN",18,0)
 D PENDING K PSJREN,PSJOCFG
"RTN","PSJLIFN",19,0)
 L -^PS(53.1,+PSJORD)
"RTN","PSJLIFN",20,0)
 Q
"RTN","PSJLIFN",21,0)
PENDING ; Process pending order.
"RTN","PSJLIFN",22,0)
 ;* PSIVFN1 is used so it will display the AC/Edit screen
"RTN","PSJLIFN",23,0)
 ;* instead of go to the "IS this O.K." prompt
"RTN","PSJLIFN",24,0)
 ;* PSIVACEP only when accept the order. Original screen won't redisp.
"RTN","PSJLIFN",25,0)
 ;* PSJLMX is defined in WRTDRG^PSIVUTL and it was being call in PSJLIVMD & PSJLIVFD
"RTN","PSJLIFN",26,0)
 ;*        to count # of AD/SOL 
"RTN","PSJLIFN",27,0)
 NEW PSIVFN1,PSIVACEP,PSJLMX,PSIVOI,PSJOCCHK,PSJFNDS
"RTN","PSJLIFN",28,0)
 K PSJIVBD ;This variable was left over from the new backdoor order entry.
"RTN","PSJLIFN",29,0)
 ; PSJOCCHK is set so if EDIT was use instead of FN to finish order the OC is triggered
"RTN","PSJLIFN",30,0)
 S PSJOCCHK=1
"RTN","PSJLIFN",31,0)
 ;* PSJFNDS is set so dosing is trigger during finishing without changes to the add/sol
"RTN","PSJLIFN",32,0)
 S PSJFNDS=1
"RTN","PSJLIFN",33,0)
 S PSIVAC="CF" S (P("PON"),ON)=+PSJORD_"P",DFN=PSGP
"RTN","PSJLIFN",34,0)
 S PSIVUP=+$$GTPCI^PSIVUTL D GT531^PSIVORFA(DFN,ON)
"RTN","PSJLIFN",35,0)
 D:'$D(P("OT")) GTOT^PSIVUTL(P(4))
"RTN","PSJLIFN",36,0)
 NEW PSJL
"RTN","PSJLIFN",37,0)
 N PSIVNUM,PSJSTAR S PSIVNUM=1
"RTN","PSJLIFN",38,0)
 Q:ON'=PSJORD
"RTN","PSJLIFN",39,0)
 I $G(PSJLYN)]"" Q:ON'=PSJLYN
"RTN","PSJLIFN",40,0)
 S PSJMAI=ON
"RTN","PSJLIFN",41,0)
 I P("OT")="I" D  Q
"RTN","PSJLIFN",42,0)
 . S PSJSTAR="(5)^(7)^(9)^(10)"
"RTN","PSJLIFN",43,0)
 . D EN^VALM("PSJ LM IV INPT PENDING") ;; ^PSJLIVMD
"RTN","PSJLIFN",44,0)
 S PSJSTAR="(1)^(2)^(3)^(5)^(7)^(9)"
"RTN","PSJLIFN",45,0)
 D GTDATA D EN^VALM("PSJ LM IV PENDING") ;; ^PSJLIVFD
"RTN","PSJLIFN",46,0)
 K PSJMAI Q
"RTN","PSJLIFN",47,0)
 ;
"RTN","PSJLIFN",48,0)
DISPLAY ;
"RTN","PSJLIFN",49,0)
 S PSGACT=""
"RTN","PSJLIFN",50,0)
 S VALMSG="Press Return to continue"
"RTN","PSJLIFN",51,0)
 D:$E(P("OT"))="I" EN^VALM("PSJ LM IV INPT DISPLAY")
"RTN","PSJLIFN",52,0)
 D:$E(P("OT"))'="I" EN^VALM("PSJ LM IV DISPLAY")
"RTN","PSJLIFN",53,0)
 K PSJDISP
"RTN","PSJLIFN",54,0)
 S:'$G(PSJHIS) VALMBCK=""
"RTN","PSJLIFN",55,0)
 Q
"RTN","PSJLIFN",56,0)
GTDATA ;
"RTN","PSJLIFN",57,0)
 ;* D:P(4)="" 53^PSIVORC1 Q:P(4)=""  S P("DTYP")=$S(P(4)="":0,P(4)="P"!(P(23)="P")!(P(5)):1,P(4)="H":2,1:3)
"RTN","PSJLIFN",58,0)
 S P("DTYP")=$S(P(4)="":0,P(4)="P"!(P(23)="P")!(P(5)):1,P(4)="H":2,1:3)
"RTN","PSJLIFN",59,0)
 I 'P(2) D
"RTN","PSJLIFN",60,0)
 .I P("RES")="R" S PSJREN=1
"RTN","PSJLIFN",61,0)
 .D ENT^PSIVCAL K %DT S X=P(2),%DT="RTX" D ^%DT S P(2)=+Y
"RTN","PSJLIFN",62,0)
 I 'P(3) D ENSTOP^PSIVCAL K %DT S X=P(3),%DT="RTX" D ^%DT S P(3)=+Y
"RTN","PSJLIFN",63,0)
 I 'P("MR") S P("MR")=$O(^PS(51.2,"B","INTRAVENOUS",0))_"^IV"
"RTN","PSJLIFN",64,0)
 Q
"RTN","PSJLIFN",65,0)
FINISH ; Prompt for missing data
"RTN","PSJLIFN",66,0)
 ;* Ord chk for Inpat. pending only. Pend renew should not be checked.
"RTN","PSJLIFN",67,0)
 ;* PSIVOCON needed so this order will be excluded from the order
"RTN","PSJLIFN",68,0)
 ;*          list(ORDCHK^PSJLMUT1)
"RTN","PSJLIFN",69,0)
 ;* PSGORQF defined means cancel the order due to order check.
"RTN","PSJLIFN",70,0)
 ;Q:'$$LS^PSSLOCK(DFN,PSJORD)
"RTN","PSJLIFN",71,0)
 N PSJCOM,PSIVEDIT
"RTN","PSJLIFN",72,0)
 S PSJCOM=+$P($G(^PS(53.1,+PSJORD,.2)),"^",8)
"RTN","PSJLIFN",73,0)
 K PSJIVBD,PSGRDTX,PSIVEDIT
"RTN","PSJLIFN",74,0)
 N FIL,PSIVS,DRGOC,PSIVXD,DRGTMP,PSIVOCON,PSGORQF,ON55,NSFF K PSGORQF S NSFF=1
"RTN","PSJLIFN",75,0)
 S (ON,PSIVOCON,ON55,PSGORD)=PSJORD D GTDRG^PSIVORFA Q:PSJORD'=PSJMAI  I $G(PSJLYN)]"" Q:PSJORD'=PSJLYN
"RTN","PSJLIFN",76,0)
 D UDVARS^PSJLIORD
"RTN","PSJLIFN",77,0)
 I $G(PSJPROT)=3,'$$ENIVUD^PSGOEF1(PSJORD) K NSFF Q
"RTN","PSJLIFN",78,0)
 D HOLDHDR^PSJOE
"RTN","PSJLIFN",79,0)
 ;PRE UAT group requested to not show the second screen since FDB OC has more text and provider override reason appears after 2nd screen 
"RTN","PSJLIFN",80,0)
 ; force the display of the second screen if CPRS order checks exist
"RTN","PSJLIFN",81,0)
 ;I $O(^PS(53.1,+PSJORD,12,0))!$O(^PS(53.1,+PSJORD,10,0)) D
"RTN","PSJLIFN",82,0)
 ;.Q:$G(PSJLMX)=1   ;no second screen to display
"RTN","PSJLIFN",83,0)
 ;.S VALMBG=16 D RE^VALM4,PAUSE^VALM1 S VALMBG=1
"RTN","PSJLIFN",84,0)
 S P("OPI")=$$ENPC^PSJUTL("V",+PSIVUP,60,P("OPI"))
"RTN","PSJLIFN",85,0)
 ;I $E(P("OT"))="I" D GTDATA Q:P(4)=""
"RTN","PSJLIFN",86,0)
 ;I $E(P("OT"))="I",'$D(DRG("AD")),('$D(DRG("SOL"))) D
"RTN","PSJLIFN",87,0)
 I $G(P("RES"))'="R" D 53^PSIVORC1
"RTN","PSJLIFN",88,0)
 I $G(P(4))]"",$G(P(15))]"",$G(P(9))]"",$$SCHREQ^PSJLIVFD(.P) D
"RTN","PSJLIFN",89,0)
 . N PSGS0XT,X,PSJNSS S PSJNSS=1,X=P(9),PSGS0XT=P(15) D Q2^PSGS0
"RTN","PSJLIFN",90,0)
 I P(4)="" D RE^VALM4 Q
"RTN","PSJLIFN",91,0)
 I $E(P("OT"))="I" D GTDATA  D
"RTN","PSJLIFN",92,0)
 . I '$D(DRG("AD")),('$D(DRG("SOL"))) S DNE=0 D GTIVDRG^PSIVORC2 S P(3)="" D ENSTOP^PSIVCAL
"RTN","PSJLIFN",93,0)
 S VALMBG=1
"RTN","PSJLIFN",94,0)
 I $E(P("OT"))="F" S DNE=0 I $G(PSGORQF) D RE^VALM4 Q
"RTN","PSJLIFN",95,0)
 I $G(PSGORQF) S VALMBCK="R",P(4)="" K DRG Q
"RTN","PSJLIFN",96,0)
 ;
"RTN","PSJLIFN",97,0)
 ; Will prompt users to choose Dispense IV Additive when more than one are available for the Orderable Item
"RTN","PSJLIFN",98,0)
 N PSJQUIT S PSJQUIT=0 D MULTADDS I $G(PSJQUIT) S VALMBCK="R" Q
"RTN","PSJLIFN",99,0)
 ;
"RTN","PSJLIFN",100,0)
 S PSIVEDIT=""
"RTN","PSJLIFN",101,0)
 S PSIVOK="1^3^10^25^26^39^57^58^59^63^64" D CKFLDS^PSIVORC1 I EDIT]"" D EDIT^PSIVEDT
"RTN","PSJLIFN",102,0)
 ;S PSIVOK="1^3^10^25^26^39^57^58^59^63^64" D CKFLDS^PSIVORC1 I EDIT]"" S PSIVEDIT=EDIT D EDIT^PSIVEDT
"RTN","PSJLIFN",103,0)
 ;I $G(EDIT)="" D OC^PSIVOC D:'$G(PSGORQF) IN^PSJOCDS($G(ON),"IV","") Q:$G(PSGORQF)
"RTN","PSJLIFN",104,0)
 I $D(PSIVEDIT) D OC^PSIVOC
"RTN","PSJLIFN",105,0)
 ;PSJ*5*261 - Remedy #490875 PSPO 2040 
"RTN","PSJLIFN",106,0)
 D ENSTOP^PSIVCAL
"RTN","PSJLIFN",107,0)
 ;D:'$G(PSGORQF) IN^PSJOCDS($G(ON),"IV","")
"RTN","PSJLIFN",108,0)
  ;If quit then restore DRG( to pre-edit state
"RTN","PSJLIFN",109,0)
 I $G(PSGORQF) D GT531^PSIVORFA(DFN,ON) Q
"RTN","PSJLIFN",110,0)
 I $G(DONE) S VALMBCK="R" Q
"RTN","PSJLIFN",111,0)
 ;* PSJFNDS is set so dosing is trigger during finishing without changes to the add/sol
"RTN","PSJLIFN",112,0)
 ;S PSJFNDS=1
"RTN","PSJLIFN",113,0)
 D COMPLTE^PSIVORC1
"RTN","PSJLIFN",114,0)
 S:$G(PSIVACEP) VALMBCK="Q"
"RTN","PSJLIFN",115,0)
 ;Reset PSJFNDS so if FN again, the dosing check is triggered.
"RTN","PSJLIFN",116,0)
 S:'$G(PSIVACEP) PSJFNDS=1
"RTN","PSJLIFN",117,0)
 I $G(PSGORQF) S VALMBG=1 D RE^VALM4
"RTN","PSJLIFN",118,0)
 K NSFF
"RTN","PSJLIFN",119,0)
 Q
"RTN","PSJLIFN",120,0)
 ;
"RTN","PSJLIFN",121,0)
MULTADDS ; If there are multiple IV Additives per Orderable Item, it will prompt for selection
"RTN","PSJLIFN",122,0)
 N TMPDRG
"RTN","PSJLIFN",123,0)
 S PSJQUIT=0
"RTN","PSJLIFN",124,0)
 I $O(DRG("AD",0)) D  I PSJQUIT D SAVEDRG^PSIVEDRG(.DRG,.TMPDRG) Q
"RTN","PSJLIFN",125,0)
 . D SAVEDRG^PSIVEDRG(.TMPDRG,.DRG)
"RTN","PSJLIFN",126,0)
 . N PSIDX,OI,IVLIST
"RTN","PSJLIFN",127,0)
 . F PSIDX=1:1 Q:'$D(DRG("AD",PSIDX))  D  I PSJQUIT Q
"RTN","PSJLIFN",128,0)
 . . S OI=$P(DRG("AD",PSIDX),"^",6) I 'OI Q
"RTN","PSJLIFN",129,0)
 . . K IVLIST D IVADDCNT(OI,.IVLIST) I $O(IVLIST(""),-1)'>1 Q
"RTN","PSJLIFN",130,0)
 . . W !!,"More than one dispense IV Additives are available for:"
"RTN","PSJLIFN",131,0)
 . . W !,"Orderable Item: ",$$GET1^DIQ(50.7,OI,.01)
"RTN","PSJLIFN",132,0)
 . . W !,"  Ordered Dose: ",$P(DRG("AD",PSIDX),"^",3)
"RTN","PSJLIFN",133,0)
 . . W !!,"Please select the correct dispense IV Additive below for this order:"
"RTN","PSJLIFN",134,0)
 . . N DIR,IVADD,IVCNT,X,Y,DIRUT,DUOUT
"RTN","PSJLIFN",135,0)
 . . S DIR("?")="Please select the correct dispense IV Additive below for this order:"
"RTN","PSJLIFN",136,0)
 . . F IVCNT=1:1 Q:'$D(IVLIST(IVCNT))  D  I PSJQUIT Q
"RTN","PSJLIFN",137,0)
 . . . S IVADD=IVLIST(IVCNT)
"RTN","PSJLIFN",138,0)
 . . . S X="  "_IVCNT_"  "_$$GET1^DIQ(52.6,IVADD,.01)
"RTN","PSJLIFN",139,0)
 . . . S $E(X,45)="Additive Strength: "_$S($$GET1^DIQ(52.6,IVADD,19)'="":$$GET1^DIQ(52.6,IVADD,19)_" "_$$GET1^DIQ(52.6,IVADD,2),1:"N/A")
"RTN","PSJLIFN",140,0)
 . . . S DIR("A",IVCNT)=X
"RTN","PSJLIFN",141,0)
 . . S DIR("A")="Select (1 - "_(IVCNT-1)_"): "
"RTN","PSJLIFN",142,0)
 . . S DIR(0)="LA^1:"_(IVCNT-1) D ^DIR I $D(DUOUT)!$D(DIRUT) S PSJQUIT=1 Q
"RTN","PSJLIFN",143,0)
 . . I (Y>0) D
"RTN","PSJLIFN",144,0)
 . . . S $P(DRG("AD",PSIDX),"^",1,2)=+IVLIST(+Y)_"^"_$$GET1^DIQ(52.6,+IVLIST(+Y),.01)
"RTN","PSJLIFN",145,0)
 . W !
"RTN","PSJLIFN",146,0)
 Q
"RTN","PSJLIFN",147,0)
 ;
"RTN","PSJLIFN",148,0)
ORDCHK ;* Do order check for Inpatient Meds IV.
"RTN","PSJLIFN",149,0)
 ; PSGORQF is defined (CONT^PSGSICHK) if not log an intervention
"RTN","PSJLIFN",150,0)
 ; No longer use after PSJ*5*181
"RTN","PSJLIFN",151,0)
 K PSGORQF
"RTN","PSJLIFN",152,0)
 Q
"RTN","PSJLIFN",153,0)
 ;NEW DRGOC
"RTN","PSJLIFN",154,0)
 ;D OCORD Q:$G(PSGORQF) 
"RTN","PSJLIFN",155,0)
 ;D GTIVDRG^PSIVORC2 S P(3)="" D ENSTOP^PSIVCAL
"RTN","PSJLIFN",156,0)
ORDCHKA ;* Do order check against existing orders on the profile
"RTN","PSJLIFN",157,0)
 ;No longer use as of PSJ*5*181
"RTN","PSJLIFN",158,0)
 Q
"RTN","PSJLIFN",159,0)
 F PSIVAS="AD","SOL" Q:$G(PSGORQF)  S FIL=$S(PSIVAS="AD":52.6,1:52.7) D
"RTN","PSJLIFN",160,0)
 . F PSIVX=0:0 S PSIVX=$O(DRG(PSIVAS,PSIVX)) Q:'PSIVX!($G(PSGORQF))  D
"RTN","PSJLIFN",161,0)
 .. S DRGTMP=DRG(PSIVAS,PSIVX)
"RTN","PSJLIFN",162,0)
 .. ;* Do only 1 duplicate warning when order has >1 of the same additive
"RTN","PSJLIFN",163,0)
 .. Q:$D(PSJADTMP(+DRGTMP))
"RTN","PSJLIFN",164,0)
 .. D ORDERCHK^PSIVEDRG(PSGP,ON,$D(DRGOC(ON)))
"RTN","PSJLIFN",165,0)
 .. S DRGOC(ON,PSIVAS,PSIVX)=DRG(PSIVAS,PSIVX)
"RTN","PSJLIFN",166,0)
 .. S PSJADTMP(+DRGTMP)=""
"RTN","PSJLIFN",167,0)
 K PSJADTMP
"RTN","PSJLIFN",168,0)
 Q
"RTN","PSJLIFN",169,0)
OCORD ;* Do order check for each drug against the drugs within the order.
"RTN","PSJLIFN",170,0)
 ;OCORD was called by ORDCHK.  This entry point is no longer use as of PSJ*5*181
"RTN","PSJLIFN",171,0)
 Q
"RTN","PSJLIFN",172,0)
 NEW X,Y,DDRUG,PSIVX,PSJAD,PSJSOL,TMPDRG
"RTN","PSJLIFN",173,0)
 D SAVEDRG^PSIVEDRG(.TMPDRG,.DRG)
"RTN","PSJLIFN",174,0)
 ; Find the corresponding DD for the additive within the order
"RTN","PSJLIFN",175,0)
 F X=0:0 S X=$O(DRG("AD",X)) Q:'X  D
"RTN","PSJLIFN",176,0)
 . S DDRUG=$P($G(^PS(52.6,+DRG("AD",X),0)),U,2)
"RTN","PSJLIFN",177,0)
 . S:+DDRUG (DDRUG(DDRUG),PSJAD(DDRUG))=$D(DDRUG(DDRUG))+1
"RTN","PSJLIFN",178,0)
 ;
"RTN","PSJLIFN",179,0)
 ; Find the corresponding DD for the solution
"RTN","PSJLIFN",180,0)
 ;
"RTN","PSJLIFN",181,0)
 F X=0:0 S X=$O(DRG("SOL",X)) Q:'X  D
"RTN","PSJLIFN",182,0)
 . S DDRUG=$P($G(^PS(52.7,+DRG("SOL",X),0)),U,2)
"RTN","PSJLIFN",183,0)
 . S:+DDRUG (DDRUG(DDRUG),PSJSOL(DDRUG))=$D(DDRUG(DDRUG))+1
"RTN","PSJLIFN",184,0)
 ;
"RTN","PSJLIFN",185,0)
 ; Loop thru each additive to check for DD,DI & DC against the
"RTN","PSJLIFN",186,0)
 ; order's dispense drugs
"RTN","PSJLIFN",187,0)
 ;
"RTN","PSJLIFN",188,0)
 NEW PSJDFN,INTERVEN S INTERVEN=""
"RTN","PSJLIFN",189,0)
 S PSJDFN=DFN ;DFN will be killed when call ^PSOORDRG
"RTN","PSJLIFN",190,0)
 F PSIVX=0:0 S PSIVX=$O(PSJAD(PSIVX)) Q:'PSIVX  D
"RTN","PSJLIFN",191,0)
 . K DDRUG(PSIVX) D DRGCHK^PSOORDRG(PSJDFN,PSIVX,.DDRUG)
"RTN","PSJLIFN",192,0)
 . I PSJAD(PSIVX)>1 S ^TMP($J,"DD",1,0)=PSIVX_U_$P($G(^PSDRUG(PSIVX,0)),U)_"^^"_ON_";I"
"RTN","PSJLIFN",193,0)
 . NEW TYPE F TYPE="DD","DI","DC" D ORDCHK^PSJLIFNI(PSJDFN,TYPE)
"RTN","PSJLIFN",194,0)
 F PSIVX=0:0 S PSIVX=$O(PSJSOL(PSIVX)) Q:'PSIVX  D
"RTN","PSJLIFN",195,0)
 . K DDRUG(PSIVX) D DRGCHK^PSOORDRG(PSJDFN,PSIVX,.DDRUG)
"RTN","PSJLIFN",196,0)
 . NEW TYPE F TYPE="DI" D ORDCHK^PSJLIFNI(PSJDFN,TYPE)
"RTN","PSJLIFN",197,0)
 S DFN=PSJDFN
"RTN","PSJLIFN",198,0)
 D SAVEDRG^PSIVEDRG(.DRG,.TMPDRG)
"RTN","PSJLIFN",199,0)
 Q
"RTN","PSJLIFN",200,0)
 ;
"RTN","PSJLIFN",201,0)
IVADDCNT(OI,IVLIST) ; Returns the number of IV Addtives Associated to the OI and Marked for IV Order Dialog
"RTN","PSJLIFN",202,0)
 ;Input: OI - PHARMACY ORDERABLE ITEM file (#50.7) IEN
"RTN","PSJLIFN",203,0)
 ;Output: $$IVADDCNT - Number of IV Additives linked to the Orderable Item
"RTN","PSJLIFN",204,0)
 ;        IVLIST(IV_IEN) - List of IV Additives linked to the Orderable Item
"RTN","PSJLIFN",205,0)
 N IVADD,IVADDCNT
"RTN","PSJLIFN",206,0)
 S IVADDCNT=0,IVADD=""
"RTN","PSJLIFN",207,0)
 F  S IVADD=$O(^PS(52.6,"AOI",OI,IVADD)) Q:'IVADD  D
"RTN","PSJLIFN",208,0)
 . ; Not Used in the IV Order Dialog
"RTN","PSJLIFN",209,0)
 . I '$$GET1^DIQ(52.6,IVADD,17,"I") Q
"RTN","PSJLIFN",210,0)
 . ; Other IV Solution is INACTIVE
"RTN","PSJLIFN",211,0)
 . I $$GET1^DIQ(52.6,IVADD,12,"I"),($$GET1^DIQ(52.6,IVADD,12,"I")'>DT) Q
"RTN","PSJLIFN",212,0)
 . ; Other IV Dispense Drug
"RTN","PSJLIFN",213,0)
 . S IVADDCNT=IVADDCNT+1,IVLIST(IVADDCNT)=IVADD
"RTN","PSJLIFN",214,0)
 Q
"VER")
8.0^22.0
"BLD",9314,6)
^282
**END**
**END**

