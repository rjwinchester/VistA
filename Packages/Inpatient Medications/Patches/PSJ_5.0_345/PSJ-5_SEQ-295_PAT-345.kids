Released PSJ*5*345 SEQ #295
Extracted from mail message
**KIDS**:PSJ*5.0*345^

**INSTALL NAME**
PSJ*5.0*345
"BLD",10680,0)
PSJ*5.0*345^INPATIENT MEDICATIONS^0^3170804^y
"BLD",10680,1,0)
^^3^3^3170804^
"BLD",10680,1,1,0)
This patch will resolve the following ISSUE:
"BLD",10680,1,2,0)
 
"BLD",10680,1,3,0)
   When the PSJI BACKGROUND JOB runs, no report is produced.
"BLD",10680,4,0)
^9.64PA^^
"BLD",10680,6.3)
1
"BLD",10680,"KRN",0)
^9.67PA^779.2^20
"BLD",10680,"KRN",.4,0)
.4
"BLD",10680,"KRN",.401,0)
.401
"BLD",10680,"KRN",.402,0)
.402
"BLD",10680,"KRN",.403,0)
.403
"BLD",10680,"KRN",.5,0)
.5
"BLD",10680,"KRN",.84,0)
.84
"BLD",10680,"KRN",3.6,0)
3.6
"BLD",10680,"KRN",3.8,0)
3.8
"BLD",10680,"KRN",9.2,0)
9.2
"BLD",10680,"KRN",9.8,0)
9.8
"BLD",10680,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",10680,"KRN",9.8,"NM",1,0)
PSIVSTAT^^0^B21482507
"BLD",10680,"KRN",9.8,"NM","B","PSIVSTAT",1)

"BLD",10680,"KRN",19,0)
19
"BLD",10680,"KRN",19.1,0)
19.1
"BLD",10680,"KRN",101,0)
101
"BLD",10680,"KRN",409.61,0)
409.61
"BLD",10680,"KRN",771,0)
771
"BLD",10680,"KRN",779.2,0)
779.2
"BLD",10680,"KRN",870,0)
870
"BLD",10680,"KRN",8989.51,0)
8989.51
"BLD",10680,"KRN",8989.52,0)
8989.52
"BLD",10680,"KRN",8994,0)
8994
"BLD",10680,"KRN","B",.4,.4)

"BLD",10680,"KRN","B",.401,.401)

"BLD",10680,"KRN","B",.402,.402)

"BLD",10680,"KRN","B",.403,.403)

"BLD",10680,"KRN","B",.5,.5)

"BLD",10680,"KRN","B",.84,.84)

"BLD",10680,"KRN","B",3.6,3.6)

"BLD",10680,"KRN","B",3.8,3.8)

"BLD",10680,"KRN","B",9.2,9.2)

"BLD",10680,"KRN","B",9.8,9.8)

"BLD",10680,"KRN","B",19,19)

"BLD",10680,"KRN","B",19.1,19.1)

"BLD",10680,"KRN","B",101,101)

"BLD",10680,"KRN","B",409.61,409.61)

"BLD",10680,"KRN","B",771,771)

"BLD",10680,"KRN","B",779.2,779.2)

"BLD",10680,"KRN","B",870,870)

"BLD",10680,"KRN","B",8989.51,8989.51)

"BLD",10680,"KRN","B",8989.52,8989.52)

"BLD",10680,"KRN","B",8994,8994)

"BLD",10680,"QUES",0)
^9.62^^
"BLD",10680,"REQB",0)
^9.611^1^1
"BLD",10680,"REQB",1,0)
PSJ*5.0*199^2
"BLD",10680,"REQB","B","PSJ*5.0*199",1)

"MBREQ")
0
"PKG",471,-1)
1^1
"PKG",471,0)
INPATIENT MEDICATIONS^PSJ^UNIT DOSE AND IVS
"PKG",471,20,0)
^9.402P^^
"PKG",471,22,0)
^9.49I^1^1
"PKG",471,22,1,0)
5.0^2971215^2990325^66481
"PKG",471,22,1,"PAH",1,0)
345^3170804
"PKG",471,22,1,"PAH",1,1,0)
^^3^3^3170804
"PKG",471,22,1,"PAH",1,1,1,0)
This patch will resolve the following ISSUE:
"PKG",471,22,1,"PAH",1,1,2,0)
 
"PKG",471,22,1,"PAH",1,1,3,0)
   When the PSJI BACKGROUND JOB runs, no report is produced.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","PSIVSTAT")
0^1^B21482507^B21471707
"RTN","PSIVSTAT",1,0)
PSIVSTAT ;BIR/PR-BUILD COST TRANS NODE, ENTER COMPILE ;6 Nov 98 / 4:45 PM
"RTN","PSIVSTAT",2,0)
 ;;5.0;INPATIENT MEDICATIONS ;**3,18,84,81,104,111,130,199,345**;16 DEC 97;Build 1
"RTN","PSIVSTAT",3,0)
 ;
"RTN","PSIVSTAT",4,0)
 ; Reference to ^ECXPIV1 is supported by DBIA# 1882.
"RTN","PSIVSTAT",5,0)
 ; Reference to ^PS(52.6 is supported by DBIA# 1231.
"RTN","PSIVSTAT",6,0)
 ; Reference to ^PS(52.7 is supported by DBIA# 2173.
"RTN","PSIVSTAT",7,0)
 ; Reference to ^PS(55 is supported by DBIA# 2191.
"RTN","PSIVSTAT",8,0)
 ; 
"RTN","PSIVSTAT",9,0)
 ;Needs dfn,on,psivnol,psivc (optional:dis/ret/des).
"RTN","PSIVSTAT",10,0)
 ;
"RTN","PSIVSTAT",11,0)
 S PSIVV=1 L +^PS(50.8,PSIVSN):5000
"RTN","PSIVSTAT",12,0)
 I '$G(PSIVC) S PSIVC=$S(($G(PSJRDC)="R"):2,($G(PSJRDC)="D"):3,($G(PSJRDC)]""):4,1:1)
"RTN","PSIVSTAT",13,0)
 ;D NOW^%DTC S (Y,PSIVNOW)=% I '$D(^PS(50.8,PSIVSN,0)) L +^PS(50.8,0) S ^PS(50.8,PSIVSN,0)=PSIVSN,$P(^(0),U,3,4)=PSIVSN_U_($P(^PS(50.8,0),U,4)+1) L -^PS(50.8,0)
"RTN","PSIVSTAT",14,0)
 D NOW^%DTC S (Y,PSIVNOW)=% I '$D(^PS(50.8,PSIVSN,0)) D  S ^PS(50.8,PSIVSN,0)=PSIVSN,$P(^(0),U,3,4)=PSIVSN_U_($P(^PS(50.8,0),U,4)+1) L -^PS(50.8,0)
"RTN","PSIVSTAT",15,0)
 .F  L +^PS(50.8,0):1 Q:$T
"RTN","PSIVSTAT",16,0)
 S $P(^PS(50.8,PSIVSN,1,0),U,1,3)="^50.801P^"_DFN S:'$D(^(DFN,0)) ^(0)=DFN,$P(^(0),U,3,4)=DFN_U_($P(^PS(50.8,PSIVSN,1,0),U,4)+1)
"RTN","PSIVSTAT",17,0)
 S PSIVTN=1 I $D(^PS(50.8,PSIVSN,1,DFN,1,0)) F PSIVTN=$P(^(0),U,3)+1:1 Q:'$D(^PS(50.8,PSIVSN,1,DFN,1,PSIVTN,0))
"RTN","PSIVSTAT",18,0)
 ;
"RTN","PSIVSTAT",19,0)
RETDET ;Get the ward that returns or destroyed need to be associated with.
"RTN","PSIVSTAT",20,0)
 ;RDFLAG & RDWARD ARE set in routine PSIVRD.
"RTN","PSIVSTAT",21,0)
 I $D(RDFLAG) S PSIVWD=RDWARD S:'$D(^PS(55,DFN,"IV",+ON,9)) $P(^(9),U,1,2)="" S $P(^(9),U,3)=$P(^(9),U,3)-PSIVNOL G SKIP
"RTN","PSIVSTAT",22,0)
 ;
"RTN","PSIVSTAT",23,0)
LBWD ;Get the ward we that we are printing labels on.
"RTN","PSIVSTAT",24,0)
 S PSIVWD=$P(^PS(55,DFN,"IV",+ON,0),U,22) G:PSIVWD SKIP
"RTN","PSIVSTAT",25,0)
 S PSIVWD=$S($D(^DPT(DFN,.1)):$O(^DIC(42,"B",^DPT(DFN,.1),0)),1:.5)
"RTN","PSIVSTAT",26,0)
 ;
"RTN","PSIVSTAT",27,0)
SKIP ;
"RTN","PSIVSTAT",28,0)
 ;Set up the transaction node here.
"RTN","PSIVSTAT",29,0)
 S ^PS(50.8,PSIVSN,1,DFN,1,0)="^50.802^"_PSIVTN_U_PSIVTN,^(PSIVTN,0)=PSIVTN_U_+ON_U_PSIVC_U_PSIVNOW_U_PSIVNOL_U_PSIVWD
"RTN","PSIVSTAT",30,0)
 ;
"RTN","PSIVSTAT",31,0)
DSS ; Update DSS for IV extract
"RTN","PSIVSTAT",32,0)
 ;
"RTN","PSIVSTAT",33,0)
 S X="ECXPIV1" X ^%ZOSF("TEST") Q:'$T
"RTN","PSIVSTAT",34,0)
 N ADSTR,ADUNITS,DCST,DDRG,DRG,PROV,SOLSTR,TYP,START,IVROOM,DSDATE,A,B
"RTN","PSIVSTAT",35,0)
 K ^TMP($J)
"RTN","PSIVSTAT",36,0)
 S X=$G(^PS(55,DFN,"IV",+ON,0)),PROV=$P(X,U,6),TYP=$P(X,U,4),START=$P(X,U,2)
"RTN","PSIVSTAT",37,0)
 S A=$G(^PS(55,DFN,"IV",+ON,2)),IVROOM=$P(A,"^",2),B=$G(^PS(55,DFN,"IV",+ON,4)),DSDATE=$S($P(B,"^",2)]"":$P(B,"^",2),1:$P(A,"^"))
"RTN","PSIVSTAT",38,0)
 F DRGTYP="AD","SOL" F DRG=0:0 S DRG=$O(^PS(55,DFN,"IV",+ON,DRGTYP,DRG)) Q:'DRG  D
"RTN","PSIVSTAT",39,0)
 .S ND=$G(^PS(55,DFN,"IV",+ON,DRGTYP,DRG,0)),(ADSTR,ADUNITS,SOLSTR)=""
"RTN","PSIVSTAT",40,0)
 .S @(DRGTYP_"STR")=$P(ND,U,2),ND=$G(^PS($S(DRGTYP="AD":52.6,1:52.7),+ND,0)),DDRG=$P(ND,U,2),DCST=$P(ND,U,7)
"RTN","PSIVSTAT",41,0)
 .I DRGTYP="AD" S Y=$P(ND,U,3) I Y S Y=$$CODES^PSIVUTL(Y,52.6,2) S ADUNITS=Y
"RTN","PSIVSTAT",42,0)
 .S ECUD=DFN_U_+ON_U_DDRG_U_PSIVNOW_U_PSIVC_U_ADSTR_U_ADUNITS_U_+SOLSTR_U_PROV_U_TYP_U_DCST
"RTN","PSIVSTAT",43,0)
 .S ECUD=ECUD_U_$P($G(^PS(55,DFN,"IV",+ON,"DSS")),"^")_U_START_U_IVROOM_U_DSDATE S ^TMP($J,DFN,ON,DDRG)=ECUD N PSII F PSII=1:1:PSIVNOL D ^ECXPIV1
"RTN","PSIVSTAT",44,0)
Q1 L -^PS(50.8,PSIVSN) K PSIVD,PSIVTN,PSIVV,PSIVWD,PSIVLP Q
"RTN","PSIVSTAT",45,0)
 ;
"RTN","PSIVSTAT",46,0)
EN ;Compile IV stats hold file here.
"RTN","PSIVSTAT",47,0)
 I $D(PSIVSITE),$D(PSIVSN) K ZTSAVE S ZTDTH=$H,ZTDESC="COMPILE IV STATS (FROM MENU)",ZTRTN="EN^PSIVSTAT",ZTIO="" D ^%ZTLOAD W:$D(ZTSK) !,"Queued." G Q
"RTN","PSIVSTAT",48,0)
 ;K ^TMP("PSIVNC",$J) S PSIVV=1,X="T-"_$S(+$G(^PS(59.7,1,31)):+^(31),1:100),%DT="" D ^%DT
"RTN","PSIVSTAT",49,0)
 ;F X=0:0 S X=$O(^PS(50.8,X)) Q:'X  F I=0:0 S I=$O(^PS(50.8,X,2,I)) Q:'I  I I<Y K ^PS(50.8,X,2,I) S $P(^(0),U,4)=$P(^(0),U,4)-1
"RTN","PSIVSTAT",50,0)
 K ^TMP("PSIVNC",$J) F Q=0:0 S Q=$O(^PS(50.8,Q)) Q:'Q  D
"RTN","PSIVSTAT",51,0)
 .S X="T-"_$S($P($G(^PS(59.5,Q,1)),U,19):$P(^(1),U,19),1:100) D ^%DT
"RTN","PSIVSTAT",52,0)
 .F I=0:0 S I=$O(^PS(50.8,Q,2,I)) Q:'I  I I<Y K ^PS(50.8,Q,2,I) S $P(^(0),U,4)=$P(^(0),U,4)-1
"RTN","PSIVSTAT",53,0)
 ;F PSIVS=0:0 S PSIVS=$O(^PS(50.8,PSIVS)) Q:'PSIVS  L +^PS(50.8,PSIVS,0) D CNT L -^PS(50.8,PSIVS,0)
"RTN","PSIVSTAT",54,0)
 F PSIVS=0:0 S PSIVS=$O(^PS(50.8,PSIVS)) Q:'PSIVS  D  D CNT L -^PS(50.8,PSIVS,0)
"RTN","PSIVSTAT",55,0)
 .F  L +^PS(50.8,PSIVS,0):1 Q:$T
"RTN","PSIVSTAT",56,0)
Q K D,PSGDT,PSIVNOL,PSIVD,PSIVC,PSIVS,PSIVV,%DT,Z,ZTSK,DFN,PSIV,PNL,POP,LO,IV,PSIVDG,PSIVDRG D ENIVKV^PSGSETU Q
"RTN","PSIVSTAT",57,0)
CNT F DFN=0:0 S DFN=$O(^PS(50.8,PSIVS,1,DFN)) Q:'DFN  F TN=0:0 S TN=$O(^PS(50.8,PSIVS,1,DFN,1,TN)) Q:'TN  D SET
"RTN","PSIVSTAT",58,0)
 S:$D(ZTQUEUED) ZTREQ="@" I $D(^TMP("PSIVNC",$J)) D MSG K TN,ZTIO,ZTRTN,X,Y Q
"RTN","PSIVSTAT",59,0)
 K ^PS(50.8,PSIVS,1),TN,ZTIO,ZTRTN,X,Y Q
"RTN","PSIVSTAT",60,0)
SET S TN=^PS(50.8,PSIVS,1,DFN,1,TN,0),ON=$P(TN,U,2),PSIVC=$P(TN,U,3),PSIVNOL=$P(TN,U,5),W42=$P(TN,U,6),PSIVD=$P(TN,U,4)\1
"RTN","PSIVSTAT",61,0)
 F PSIVDG=52.6,52.7 F I=0:0 S I=$O(^PS(55,DFN,"IV",+ON,$S(PSIVDG=52.6:"AD",1:"SOL"),I)) Q:'I!($D(NON))  S PSIVDRG=+^(I,0) I $P(^PS(PSIVDG,PSIVDRG,0),U,7)="" S NON=1 D NOCOST
"RTN","PSIVSTAT",62,0)
 I $D(NON) K PSIVDG,PSIVDRG,NON Q
"RTN","PSIVSTAT",63,0)
 D ^PSIVST2 K ^PS(50.8,PSIVS,1,DFN,1,+TN) Q
"RTN","PSIVSTAT",64,0)
NOCOST ;Send message if the drug is missing a unit cost.
"RTN","PSIVSTAT",65,0)
 ;
"RTN","PSIVSTAT",66,0)
 S $P(^PS(50.8,PSIVS,1,DFN,1,+TN,0),U,7)=PSIVDG_";"_PSIVDRG,NUM=$S('$D(NUM):1,1:NUM+1),^TMP("PSIVNC",$J,NUM,0)=$P(^PS(PSIVDG,PSIVDRG,0),U)_" IN THE "_$S(PSIVDG=52.6:"ADDITIVES",1:"SOLUTIONS")_" FILE." Q
"RTN","PSIVSTAT",67,0)
MSG S XMDUZ="IV PHARMACY PACKAGE",XMSUB="MISSING COST INFORMATION",XMTEXT="^TMP(""PSIVNC"",$J,"
"RTN","PSIVSTAT",68,0)
 F PSIVDUZ=0:0 S PSIVDUZ=$O(^XUSEC("PSJI MGR",PSIVDUZ)) Q:'PSIVDUZ  S XMY(PSIVDUZ)=""
"RTN","PSIVSTAT",69,0)
 D ^XMD K ^TMP("PSIVNC",$J),XMY,XMDUZ,NUM,XMTEXT,PSIVDUZ,XMSUB
"RTN","PSIVSTAT",70,0)
 Q
"VER")
8.0^22.2
"BLD",10680,6)
^295
**END**
**END**

