Released PSJ*5*317 SEQ #283
Extracted from mail message
**KIDS**:PSJ*5.0*317^

**INSTALL NAME**
PSJ*5.0*317
"BLD",9173,0)
PSJ*5.0*317^INPATIENT MEDICATIONS^0^3160825^y
"BLD",9173,1,0)
^^217^217^3160602^
"BLD",9173,1,1,0)
The Pharmacy Interface Automation Project (PIA) will provide a new
"BLD",9173,1,2,0)
standard bi-directional Health Level Seven (HL7) to the Pharmacy
"BLD",9173,1,3,0)
Automated Dispensing Equipment (PADE) server. The PADE will route the
"BLD",9173,1,4,0)
message to a cabinet located at the point of care areas such as Inpatient
"BLD",9173,1,5,0)
wards, Outpatient Clinics etc.
"BLD",9173,1,6,0)
 
"BLD",9173,1,7,0)
The following two patches are provided for this project:
"BLD",9173,1,8,0)
  PSJ*5*317 - Inpatient Medications V. 5.0.
"BLD",9173,1,9,0)
  PSS*1*193 - Pharmacy Data Management V. 1.0.
"BLD",9173,1,10,0)
 
"BLD",9173,1,11,0)
Note: The patches should be installed in the order listed above as the 
"BLD",9173,1,12,0)
logical link, PSJ PADE used in the PSS patch is transported in the PSJ
"BLD",9173,1,13,0)
patch.
"BLD",9173,1,14,0)
 
"BLD",9173,1,15,0)
1.  The following new files were created:
"BLD",9173,1,16,0)
    PADE SYSTEM SETUP file (#58.7)
"BLD",9173,1,17,0)
    PADE SEND AREA file (#58.71)
"BLD",9173,1,18,0)
    PADE OUTBOUND MESSAGES file (#58.72)
"BLD",9173,1,19,0)
    PADE INVENTORY SYSTEM file (#58.601) 
"BLD",9173,1,20,0)
    PADE INBOUND TRANSACTIONS file (#58.6)
"BLD",9173,1,21,0)
    PADE DISPENSING DEVICE file (#58.63)
"BLD",9173,1,22,0)
    PADE USER file (#58.64)
"BLD",9173,1,23,0)
    
"BLD",9173,1,24,0)
2.  A new menu, PADE Main Menu [PSJ PADE MAIN MENU], with the following
"BLD",9173,1,25,0)
    options was created:
"BLD",9173,1,26,0)
    PADE Send Area Setup [PSJ PADE SEND AREA SETUP] option
"BLD",9173,1,27,0)
    PADE System Setup [PSJ PADE SETUP] option
"BLD",9173,1,28,0)
    PADE Send Surgery Cases [PSJ PADE SEND SURGERY CASES] option
"BLD",9173,1,29,0)
    PADE Send Patient Orders [PSJ PADE SEND ORDERS] option
"BLD",9173,1,30,0)
    PADE Inventory Setup [PSJ PADE INVENTORY MENU] option
"BLD",9173,1,31,0)
       ...Inventory System Setup [PSJ PADE INVENTORY SYSTEM] option
"BLD",9173,1,32,0)
       ...Dispensing Device Setup [PSJ PADE DEVICE SETUP] option
"BLD",9173,1,33,0)
    PADE Reports [PSJ PADE REPORTS MENU] option
"BLD",9173,1,34,0)
       ...PADE On-Hand Amounts [PSJ PADE INVENTORY REPORT] option
"BLD",9173,1,35,0)
       ...PADE Transaction Report [PSJ PADE TRANSACTION REPORT] option
"BLD",9173,1,36,0)
 
"BLD",9173,1,37,0)
3.  A new security key, PSJ PADE MGR, was created to allow access to the 
"BLD",9173,1,38,0)
    above menus noted in item 2.
"BLD",9173,1,39,0)
 
"BLD",9173,1,40,0)
4.  The option, PADE System Division Setup [PSJ PADE DIVISION SETUP],
"BLD",9173,1,41,0)
    was exported as a separate option so that it can be given to an
"BLD",9173,1,42,0)
    assigned user to set up a division under a PADE.
"BLD",9173,1,43,0)
 
"BLD",9173,1,44,0)
5.  A new security key, PSJ PADE ADV, was created to allow access to the 
"BLD",9173,1,45,0)
    above option noted in item 4.
"BLD",9173,1,46,0)
 
"BLD",9173,1,47,0)
6.  The option, PADE Surgery Task [PSJ PADE SURGERY TASK], was exported as
"BLD",9173,1,48,0)
    a standalone option so that sites can schedule it as a recurring task.
"BLD",9173,1,49,0)
 
"BLD",9173,1,50,0)
7.  The option, PADE Appointment Task [PSJ PADE APPOINTMENT TASK], was
"BLD",9173,1,51,0)
    exported as a standalone option so that sites can schedule it as a
"BLD",9173,1,52,0)
    recurring task.
"BLD",9173,1,53,0)
 
"BLD",9173,1,54,0)
8.  Two HL7 application parameters, PSJ VISTA and PSJ PADE SERVER, were
"BLD",9173,1,55,0)
    created for site specific information.
"BLD",9173,1,56,0)
 
"BLD",9173,1,57,0)
9.  One Logical Link, PSJ PADE, was created to support the Outbound HL7
"BLD",9173,1,58,0)
    messages.
"BLD",9173,1,59,0)
 
"BLD",9173,1,60,0)
10. The following protocols were created to receive and send outbound
"BLD",9173,1,61,0)
    Admission, Discharge and Transfer (ADT) events:
"BLD",9173,1,62,0)
    PSJ ADT-A01 ROUTER
"BLD",9173,1,63,0)
    PSJ ADT-A01 SERVER - Admission event
"BLD",9173,1,64,0)
    PSJ ADT-A01 CLIENT
"BLD",9173,1,65,0)
    PSJ ADT-A02 SERVER - Transfer event
"BLD",9173,1,66,0)
    PSJ ADT-A02 CLIENT
"BLD",9173,1,67,0)
    PSJ ADT-A03 SERVER - Discharge event 
"BLD",9173,1,68,0)
    PSJ ADT-A03 CLIENT
"BLD",9173,1,69,0)
    PSJ ADT-A08 SERVER - Demographic changes
"BLD",9173,1,70,0)
    PSJ ADT-A08 CLIENT
"BLD",9173,1,71,0)
    PSJ ADT-A11 SERVER - Cancel Admission event
"BLD",9173,1,72,0)
    PSJ ADT-A11 CLIENT
"BLD",9173,1,73,0)
    PSJ ADT-A12 SERVER - Cancel Transfer event
"BLD",9173,1,74,0)
    PSJ ADT-A12 CLIENT
"BLD",9173,1,75,0)
    PSJ ADT-A13 SERVER - Cancel Discharge event
"BLD",9173,1,76,0)
    PSJ ADT-A13 CLIENT
"BLD",9173,1,77,0)
 
"BLD",9173,1,78,0)
    PSJ ADT-A01 ROUTER is setup as a subscribing protocol to VAFC ADT-A01 
"BLD",9173,1,79,0)
    SERVER, VAFC ADT-A02 SERVER, VAFC ADT-A03 SERVER, VAFC ADT-A08 SERVER,
"BLD",9173,1,80,0)
    VAFC ADT-A08-TSP SERVER (bed switch), VAFC ADT-A11 SERVER, VAFC
"BLD",9173,1,81,0)
    ADT-A12 SERVER, VAFC ADT-A13 SERVER.
"BLD",9173,1,82,0)
 
"BLD",9173,1,83,0)
    In the REGISTRATION V. 5.3 package, options like Admit a Patient [DG
"BLD",9173,1,84,0)
    ADMIT PATIENT], Transfer a Patient [DG TRANSFER PATIENT], Discharge a
"BLD",9173,1,85,0)
    Patient [DG DISCHARGE PATIENT], Switch Bed [DG BED SWITCH] etc., will
"BLD",9173,1,86,0)
    trigger appropriate outbound HL7 messages.
"BLD",9173,1,87,0)
    The routine tied to protocol PSJ ADT-A01 ROUTER that subscribes to 
"BLD",9173,1,88,0)
    these events (VAFC ADT related protocol) will scan the HL7 message and
"BLD",9173,1,89,0)
    will build a modified copy of the HL7  message including the Allergy
"BLD",9173,1,90,0)
    (AL1) and the Observation/Result (OBX) segments. The generated HL7
"BLD",9173,1,91,0)
    message will be sent to the respective PADE via the Vitria Interface
"BLD",9173,1,92,0)
    Engine (VIE).
"BLD",9173,1,93,0)
 
"BLD",9173,1,94,0)
11. The following protocols were created to receive and send outbound
"BLD",9173,1,95,0)
    Clinic check-ins and appointments.
"BLD",9173,1,96,0)
     PSJ SIU-SDAM ROUTER - subscribing protocol to VAFC ADT-A08-SDAM
"BLD",9173,1,97,0)
     SERVER 
"BLD",9173,1,98,0)
     PSJ SIU-S12 SERVER - event driver for clinic check-in 
"BLD",9173,1,99,0)
     PSJ SIU-S12 CLIENT - subscriber 
"BLD",9173,1,100,0)
 
"BLD",9173,1,101,0)
    During patient check-in in the Scheduling V. 5.3 package, the 
"BLD",9173,1,102,0)
    protocol, VAFC ADT-A08-SDAM SERVER builds a standard HL7 message.
"BLD",9173,1,103,0)
    The routine tied to protocol PSJ SIU-SDAM ROUTER that subscribes
"BLD",9173,1,104,0)
    to the VAFC ADT-A08-SDAM SERVER, will scan the HL7 message and will
"BLD",9173,1,105,0)
    build and modify a copy of the HL7 message including the Allergy (AL1)
"BLD",9173,1,106,0)
    and the Observation/Result (OBX) segments. The generated HL7 message
"BLD",9173,1,107,0)
    will be sent to the respective PADE via the Vitria Interface Engine
"BLD",9173,1,108,0)
    (VIE).
"BLD",9173,1,109,0)
 
"BLD",9173,1,110,0)
12. The following protocols were created to send outbound order messages
"BLD",9173,1,111,0)
    in the form of RDE-O11 HL7 messages to the appropriate PADE system.
"BLD",9173,1,112,0)
    PSJ RDEO11 SERVER
"BLD",9173,1,113,0)
    PSJ RDEO11 CLIENT
"BLD",9173,1,114,0)
 
"BLD",9173,1,115,0)
    In Inpatient Medications, when orders are verified, edited, renewed, 
"BLD",9173,1,116,0)
    discontinued, reinstated, put on hold/removed from hold, and when 
"BLD",9173,1,117,0)
    orders are discontinued in Computerized Patient Record System (CPRS)
"BLD",9173,1,118,0)
    V. 3.0, an outbound HL7 message will be sent to the respective PADE
"BLD",9173,1,119,0)
    via the Vitria Interface Engine (VIE).
"BLD",9173,1,120,0)
 
"BLD",9173,1,121,0)
13. The following protocols were created to receive and process inbound 
"BLD",9173,1,122,0)
    PADE Activity (e.g., Dispense, Load, etc.) in the form of
"BLD",9173,1,123,0)
    OMS-O05 HL7 messages:
"BLD",9173,1,124,0)
    PSJ PADE OMS-O05 EVENT
"BLD",9173,1,125,0)
    PSJ PADE OMS-O05 SUB
"BLD",9173,1,126,0)
    PSJ PADE OMS-O05 EVENT 2.3
"BLD",9173,1,127,0)
    PSJ PADE OMS-O05 SUB 2.3
"BLD",9173,1,128,0)
 
"BLD",9173,1,129,0)
    Backward compatible HL7 v2.3 protocols accept and parse current 
"BLD",9173,1,130,0)
    industry standard Pocket Maintenance (ZPM) segments to facilitate
"BLD",9173,1,131,0)
    transition to the new PADE standard.
"BLD",9173,1,132,0)
  
"BLD",9173,1,133,0)
    Inbound HL7 messages from the PADE vendor are validated and filed into
"BLD",9173,1,134,0)
    the PADE INBOUND TRANSACTION file (#58.6), which triggers an 
"BLD",9173,1,135,0)
    automatic update of the inventory information in the PADE INVENTORY
"BLD",9173,1,136,0)
    SYSTEM file (#58.601).
"BLD",9173,1,137,0)
 
"BLD",9173,1,138,0)
 14. A new multiple, DWO MESSAGE ENTITY, has been added to the PADE
"BLD",9173,1,139,0)
     INVENTORY SYSTEM file (#58.601) to contain mail groups that will
"BLD",9173,1,140,0)
     receive Mailman messages when PADE drugs are Dispensed Without an
"BLD",9173,1,141,0)
     Order (DWO). 
"BLD",9173,1,142,0)
 
"BLD",9173,1,143,0)
 15. A new multiple, CONFIG ERRORS MAIL GROUPS, has been added to the PADE
"BLD",9173,1,144,0)
     INVENTORY SYSTEM file (#58.601) to receive error messages when 
"BLD",9173,1,145,0)
     configuration problems are encountered with Inbound PADE HL7
"BLD",9173,1,146,0)
     messages.
"BLD",9173,1,147,0)
 
"BLD",9173,1,148,0)
 16. A new multiple, DATA ERRORS MAIL GROUPS, has been added to the PADE 
"BLD",9173,1,149,0)
     INVENTORY SYSTEM file (#58.601) to receive error messages when data 
"BLD",9173,1,150,0)
     validation problems are encountered with Inbound PADE HL7 messages.
"BLD",9173,1,151,0)
 
"BLD",9173,1,152,0)
 17. Inpatient Pharmacy Order Entry screens have been modified to 
"BLD",9173,1,153,0)
     display PADE inventory information, specifically:
"BLD",9173,1,154,0)
 
"BLD",9173,1,155,0)
     a. The Inpatient Pharmacy Order Entry order detail screens
"BLD",9173,1,156,0)
        will contain a new "PADE" column when displaying Dispense Drugs,
"BLD",9173,1,157,0)
        containing the PADE inventory availability for the displayed
"BLD",9173,1,158,0)
        dispense drug. To make room for the PADE inventory information,
"BLD",9173,1,159,0)
        the message field will continue displaying, but drug classes will
"BLD",9173,1,160,0)
        no longer display as a FileMan identifier when a list of dispense
"BLD",9173,1,161,0)
        drug choices are displayed.
"BLD",9173,1,162,0)
 
"BLD",9173,1,163,0)
     b. The Inpatient Pharmacy Order Entry Patient Profile screen
"BLD",9173,1,164,0)
        includes a flag, (PD), indicating whether or not the order
"BLD",9173,1,165,0)
        contains a drug that is a PADE stock item. If a drug is both a
"BLD",9173,1,166,0)
        PADE item and a Ward Stock item, the ward stock flag (WS) is
"BLD",9173,1,167,0)
        combined with the PADE flag (WP).
"BLD",9173,1,168,0)
 
"BLD",9173,1,169,0)
 18. A Kernel parameter, PSJ PADE OE BALANCES, has been created to allow
"BLD",9173,1,170,0)
     each site to control whether or not PADE inventory information
"BLD",9173,1,171,0)
     displays in the Inpatient Order Entry profile screens and drug
"BLD",9173,1,172,0)
     lookups. A prompt to set the parameter has been added to the new PSJ
"BLD",9173,1,173,0)
     PADE INVENTORY Input Template, accessible via the Inventory System
"BLD",9173,1,174,0)
     Setup [PSJ PADE INVENTORY SYSTEM] option.
"BLD",9173,1,175,0)
 
"BLD",9173,1,176,0)
 19. The option, Pick List [PSJU PL], has been modified to include the 
"BLD",9173,1,177,0)
     drug Internal Entry Number (IEN) field after the drug name and to
"BLD",9173,1,178,0)
     include the word "PADE" if the medication listed is a PADE stock
"BLD",9173,1,179,0)
     item.
"BLD",9173,1,180,0)
 
"BLD",9173,1,181,0)
 20. A new Protocol, PSJ LM PADE ACTIVITY, has been added to the PSJ LM 
"BLD",9173,1,182,0)
     PROFILE HIDDEN ACTIONS Protocol to display a new hidden action (PD) 
"BLD",9173,1,183,0)
     in the Inpatient Pharmacy patient profile screen. The new PD hidden
"BLD",9173,1,184,0)
     action displays all of the PADE transactions for the patient being
"BLD",9173,1,185,0)
     displayed.
"BLD",9173,1,186,0)
 
"BLD",9173,1,187,0)
 21. The Pre-Exchange DOSES prompt that displays after verifying an 
"BLD",9173,1,188,0)
     Inpatient Unit Dose order has been modified to default the number of 
"BLD",9173,1,189,0)
     doses to zero when the drug may be dispensed from PADE, and a message
"BLD",9173,1,190,0)
     is displayed explaining the drug is a PADE item.
"BLD",9173,1,191,0)
 
"BLD",9173,1,192,0)
 22. This patch also provides a log file, PADE OUTBOUND MESSAGES 
"BLD",9173,1,193,0)
     file (#58.72) of the outbound ADT, SIU and RDE HL7 messages to use 
"BLD",9173,1,194,0)
     with FileMan for trouble shooting purposes only.
"BLD",9173,1,195,0)
     Note: The nightly background job (PSGBRJ) has been modified to purge 
"BLD",9173,1,196,0)
     records older than 30 days.
"BLD",9173,1,197,0)
 
"BLD",9173,1,198,0)
Note: This patch also exports a post-install routine PSJ317P that will 
"BLD",9173,1,199,0)
setup PSJ ADT-A01 ROUTER as a subscribing protocol to VAFC ADT-A01 
"BLD",9173,1,200,0)
SERVER, VAFC ADT-A02 SERVER, VAFC ADT-A03 SERVER, VAFC ADT-A08 SERVER,
"BLD",9173,1,201,0)
VAFC ADT-A08-TSP SERVER, VAFC ADT-A11 SERVER, VAFC ADT-A12 SERVER and VAFC
"BLD",9173,1,202,0)
ADT-A13 SERVER protocols. It will also setup protocol PSJ SIU-SDAM ROUTER
"BLD",9173,1,203,0)
as a subscribing protocol to VAFC ADT-A08-SDAM SERVER protocol. 
"BLD",9173,1,204,0)
The post-install also sets the following field to the PSJ PADE entry in 
"BLD",9173,1,205,0)
the HL LOGICAL LINK file (#870):
"BLD",9173,1,206,0)
   a. AUTOSTART field (#4.5) is set to 1 (Enabled) so that the PSJ PADE 
"BLD",9173,1,207,0)
      logical link will be started automatically when Cache or TaskMan is 
"BLD",9173,1,208,0)
      restarted.
"BLD",9173,1,209,0)
   b. DO NOT PING field (#24) is set to 1 (Yes) due to the unique aspects
"BLD",9173,1,210,0)
      of the PADE interface. If PSJ PADE is sent an HLO PING CLIENT 
"BLD",9173,1,211,0)
      message, an infinite loop will be created consisting of VIE sending
"BLD",9173,1,212,0)
      VistA additional CR messages and VistA not responding. This 
"BLD",9173,1,213,0)
      situation requires manual intervention by a member of the VIE
"BLD",9173,1,214,0)
      National Admins team and therefore needs to be avoided.
"BLD",9173,1,215,0)
 
"BLD",9173,1,216,0)
This post-install routine will be deleted from your system upon completion
"BLD",9173,1,217,0)
of the patch installation.
"BLD",9173,4,0)
^9.64PA^58.72^8
"BLD",9173,4,58.6,0)
58.6
"BLD",9173,4,58.6,222)
y^y^f^^^^n
"BLD",9173,4,58.601,0)
58.601
"BLD",9173,4,58.601,222)
y^y^f^^^^n
"BLD",9173,4,58.63,0)
58.63
"BLD",9173,4,58.63,222)
y^y^f^^^^n
"BLD",9173,4,58.64,0)
58.64
"BLD",9173,4,58.64,222)
y^y^f^^^^n
"BLD",9173,4,58.7,0)
58.7
"BLD",9173,4,58.7,222)
y^y^f^^^^n
"BLD",9173,4,58.71,0)
58.71
"BLD",9173,4,58.71,222)
y^y^f^^^^n
"BLD",9173,4,58.72,0)
58.72
"BLD",9173,4,58.72,222)
y^y^f^^^^n
"BLD",9173,4,59.6,0)
59.6
"BLD",9173,4,59.6,2,0)
^9.641^59.6^1
"BLD",9173,4,59.6,2,59.6,0)
INPATIENT WARD PARAMETERS  (File-top level)
"BLD",9173,4,59.6,2,59.6,1,0)
^9.6411^8^1
"BLD",9173,4,59.6,2,59.6,1,8,0)
DEFAULT 0 ON PADE PRE-EXCHANGE
"BLD",9173,4,59.6,222)
y^y^p^^^^n^^n
"BLD",9173,4,59.6,224)

"BLD",9173,4,"APDD",59.6,59.6)

"BLD",9173,4,"APDD",59.6,59.6,8)

"BLD",9173,4,"B",58.6,58.6)

"BLD",9173,4,"B",58.601,58.601)

"BLD",9173,4,"B",58.63,58.63)

"BLD",9173,4,"B",58.64,58.64)

"BLD",9173,4,"B",58.7,58.7)

"BLD",9173,4,"B",58.71,58.71)

"BLD",9173,4,"B",58.72,58.72)

"BLD",9173,4,"B",59.6,59.6)

"BLD",9173,6)
4^
"BLD",9173,6.3)
130
"BLD",9173,"ABPKG")
n
"BLD",9173,"INID")
^y
"BLD",9173,"INIT")
POST^PSJ317P
"BLD",9173,"KRN",0)
^9.67PA^779.2^20
"BLD",9173,"KRN",.4,0)
.4
"BLD",9173,"KRN",.4,"NM",0)
^9.68A^^
"BLD",9173,"KRN",.401,0)
.401
"BLD",9173,"KRN",.402,0)
.402
"BLD",9173,"KRN",.402,"NM",0)
^9.68A^4^4
"BLD",9173,"KRN",.402,"NM",1,0)
PSJ PADE SYSTEM    FILE #58.7^58.7^0
"BLD",9173,"KRN",.402,"NM",2,0)
PSJ PADE INVENTORY    FILE #58.601^58.601^0
"BLD",9173,"KRN",.402,"NM",3,0)
PSJ PADE DISPENSING DEVICE    FILE #58.63^58.63^0
"BLD",9173,"KRN",.402,"NM",4,0)
PSJ IWP EDIT    FILE #59.6^59.6^0
"BLD",9173,"KRN",.402,"NM","B","PSJ IWP EDIT    FILE #59.6",4)

"BLD",9173,"KRN",.402,"NM","B","PSJ PADE DISPENSING DEVICE    FILE #58.63",3)

"BLD",9173,"KRN",.402,"NM","B","PSJ PADE INVENTORY    FILE #58.601",2)

"BLD",9173,"KRN",.402,"NM","B","PSJ PADE SYSTEM    FILE #58.7",1)

"BLD",9173,"KRN",.403,0)
.403
"BLD",9173,"KRN",.5,0)
.5
"BLD",9173,"KRN",.84,0)
.84
"BLD",9173,"KRN",3.6,0)
3.6
"BLD",9173,"KRN",3.8,0)
3.8
"BLD",9173,"KRN",3.8,"NM",0)
^9.68A^^0
"BLD",9173,"KRN",9.2,0)
9.2
"BLD",9173,"KRN",9.8,0)
9.8
"BLD",9173,"KRN",9.8,"NM",0)
^9.68A^32^31
"BLD",9173,"KRN",9.8,"NM",1,0)
PSJPADE^^0^B89070355
"BLD",9173,"KRN",9.8,"NM",2,0)
PSJPADIT^^0^B218833371
"BLD",9173,"KRN",9.8,"NM",3,0)
PSJPDCL^^0^B59118380
"BLD",9173,"KRN",9.8,"NM",4,0)
PSJPADSI^^0^B210554864
"BLD",9173,"KRN",9.8,"NM",5,0)
PSJPDCLA^^0^B123693086
"BLD",9173,"KRN",9.8,"NM",6,0)
PSJPAD7I^^0^B91877682
"BLD",9173,"KRN",9.8,"NM",7,0)
PSJPAD7U^^0^B183094975
"BLD",9173,"KRN",9.8,"NM",8,0)
PSGOE7^^0^B40214304
"BLD",9173,"KRN",9.8,"NM",9,0)
PSGOE82^^0^B33061347
"BLD",9173,"KRN",9.8,"NM",10,0)
PSGOE92^^0^B43137679
"BLD",9173,"KRN",9.8,"NM",11,0)
PSGOEF1^^0^B38004561
"BLD",9173,"KRN",9.8,"NM",12,0)
PSJLMPRU^^0^B19004803
"BLD",9173,"KRN",9.8,"NM",13,0)
PSJLMUDE^^0^B86619867
"BLD",9173,"KRN",9.8,"NM",14,0)
PSJO^^0^B32312057
"BLD",9173,"KRN",9.8,"NM",15,0)
PSJO2^^0^B21667076
"BLD",9173,"KRN",9.8,"NM",16,0)
PSJPAD50^^0^B143814904
"BLD",9173,"KRN",9.8,"NM",17,0)
PSGPLR^^0^B40061443
"BLD",9173,"KRN",9.8,"NM",19,0)
PSJHLU^^0^B50964072
"BLD",9173,"KRN",9.8,"NM",20,0)
PSJPDCLU^^0^B182600427
"BLD",9173,"KRN",9.8,"NM",21,0)
PSJ317P^^0^B6017554
"BLD",9173,"KRN",9.8,"NM",22,0)
PSJPDRIN^^0^B220627483
"BLD",9173,"KRN",9.8,"NM",23,0)
PSJPDRIP^^0^B92189032
"BLD",9173,"KRN",9.8,"NM",24,0)
PSJPDRTR^^0^B204379013
"BLD",9173,"KRN",9.8,"NM",25,0)
PSJPDRTP^^0^B164604296
"BLD",9173,"KRN",9.8,"NM",26,0)
PSJPDAPP^^0^B26391444
"BLD",9173,"KRN",9.8,"NM",27,0)
PSJPADPT^^0^B74926353
"BLD",9173,"KRN",9.8,"NM",28,0)
PSGPEN^^0^B57822787
"BLD",9173,"KRN",9.8,"NM",29,0)
PSJPAD70^^0^B193106268
"BLD",9173,"KRN",9.8,"NM",30,0)
PSJPDRUT^^0^B233123274
"BLD",9173,"KRN",9.8,"NM",31,0)
PSGBRJ^^0^B21011842
"BLD",9173,"KRN",9.8,"NM",32,0)
PSJPDRU1^^0^B196519581
"BLD",9173,"KRN",9.8,"NM","B","PSGBRJ",31)

"BLD",9173,"KRN",9.8,"NM","B","PSGOE7",8)

"BLD",9173,"KRN",9.8,"NM","B","PSGOE82",9)

"BLD",9173,"KRN",9.8,"NM","B","PSGOE92",10)

"BLD",9173,"KRN",9.8,"NM","B","PSGOEF1",11)

"BLD",9173,"KRN",9.8,"NM","B","PSGPEN",28)

"BLD",9173,"KRN",9.8,"NM","B","PSGPLR",17)

"BLD",9173,"KRN",9.8,"NM","B","PSJ317P",21)

"BLD",9173,"KRN",9.8,"NM","B","PSJHLU",19)

"BLD",9173,"KRN",9.8,"NM","B","PSJLMPRU",12)

"BLD",9173,"KRN",9.8,"NM","B","PSJLMUDE",13)

"BLD",9173,"KRN",9.8,"NM","B","PSJO",14)

"BLD",9173,"KRN",9.8,"NM","B","PSJO2",15)

"BLD",9173,"KRN",9.8,"NM","B","PSJPAD50",16)

"BLD",9173,"KRN",9.8,"NM","B","PSJPAD70",29)

"BLD",9173,"KRN",9.8,"NM","B","PSJPAD7I",6)

"BLD",9173,"KRN",9.8,"NM","B","PSJPAD7U",7)

"BLD",9173,"KRN",9.8,"NM","B","PSJPADE",1)

"BLD",9173,"KRN",9.8,"NM","B","PSJPADIT",2)

"BLD",9173,"KRN",9.8,"NM","B","PSJPADPT",27)

"BLD",9173,"KRN",9.8,"NM","B","PSJPADSI",4)

"BLD",9173,"KRN",9.8,"NM","B","PSJPDAPP",26)

"BLD",9173,"KRN",9.8,"NM","B","PSJPDCL",3)

"BLD",9173,"KRN",9.8,"NM","B","PSJPDCLA",5)

"BLD",9173,"KRN",9.8,"NM","B","PSJPDCLU",20)

"BLD",9173,"KRN",9.8,"NM","B","PSJPDRIN",22)

"BLD",9173,"KRN",9.8,"NM","B","PSJPDRIP",23)

"BLD",9173,"KRN",9.8,"NM","B","PSJPDRTP",25)

"BLD",9173,"KRN",9.8,"NM","B","PSJPDRTR",24)

"BLD",9173,"KRN",9.8,"NM","B","PSJPDRU1",32)

"BLD",9173,"KRN",9.8,"NM","B","PSJPDRUT",30)

"BLD",9173,"KRN",19,0)
19
"BLD",9173,"KRN",19,"NM",0)
^9.68A^17^15
"BLD",9173,"KRN",19,"NM",1,0)
PSJ PADE SETUP^^0
"BLD",9173,"KRN",19,"NM",3,0)
PSJ PADE SEND AREA SETUP^^0
"BLD",9173,"KRN",19,"NM",4,0)
PSJ PADE MAIN MENU^^0
"BLD",9173,"KRN",19,"NM",5,0)
PSJ PADE SEND SURGERY CASES^^0
"BLD",9173,"KRN",19,"NM",6,0)
PSJU MGR^^2
"BLD",9173,"KRN",19,"NM",7,0)
PSJ PADE SURGERY TASK^^0
"BLD",9173,"KRN",19,"NM",8,0)
PSJ PADE INVENTORY MENU^^0
"BLD",9173,"KRN",19,"NM",9,0)
PSJ PADE DEVICE SETUP^^0
"BLD",9173,"KRN",19,"NM",10,0)
PSJ PADE INVENTORY SYSTEM^^0
"BLD",9173,"KRN",19,"NM",11,0)
PSJ PADE DIVISION SETUP^^0
"BLD",9173,"KRN",19,"NM",12,0)
PSJ PADE SEND ORDERS^^0
"BLD",9173,"KRN",19,"NM",13,0)
PSJ PADE TRANSACTION REPORT^^0
"BLD",9173,"KRN",19,"NM",15,0)
PSJ PADE INVENTORY REPORT^^0
"BLD",9173,"KRN",19,"NM",16,0)
PSJ PADE REPORTS MENU^^0
"BLD",9173,"KRN",19,"NM",17,0)
PSJ PADE APPOINTMENT TASK^^0
"BLD",9173,"KRN",19,"NM","B","PSJ PADE APPOINTMENT TASK",17)

"BLD",9173,"KRN",19,"NM","B","PSJ PADE DEVICE SETUP",9)

"BLD",9173,"KRN",19,"NM","B","PSJ PADE DIVISION SETUP",11)

"BLD",9173,"KRN",19,"NM","B","PSJ PADE INVENTORY MENU",8)

"BLD",9173,"KRN",19,"NM","B","PSJ PADE INVENTORY REPORT",15)

"BLD",9173,"KRN",19,"NM","B","PSJ PADE INVENTORY SYSTEM",10)

"BLD",9173,"KRN",19,"NM","B","PSJ PADE MAIN MENU",4)

"BLD",9173,"KRN",19,"NM","B","PSJ PADE REPORTS MENU",16)

"BLD",9173,"KRN",19,"NM","B","PSJ PADE SEND AREA SETUP",3)

"BLD",9173,"KRN",19,"NM","B","PSJ PADE SEND ORDERS",12)

"BLD",9173,"KRN",19,"NM","B","PSJ PADE SEND SURGERY CASES",5)

"BLD",9173,"KRN",19,"NM","B","PSJ PADE SETUP",1)

"BLD",9173,"KRN",19,"NM","B","PSJ PADE SURGERY TASK",7)

"BLD",9173,"KRN",19,"NM","B","PSJ PADE TRANSACTION REPORT",13)

"BLD",9173,"KRN",19,"NM","B","PSJU MGR",6)

"BLD",9173,"KRN",19.1,0)
19.1
"BLD",9173,"KRN",19.1,"NM",0)
^9.68A^2^2
"BLD",9173,"KRN",19.1,"NM",1,0)
PSJ PADE MGR^^0
"BLD",9173,"KRN",19.1,"NM",2,0)
PSJ PADE ADV^^0
"BLD",9173,"KRN",19.1,"NM","B","PSJ PADE ADV",2)

"BLD",9173,"KRN",19.1,"NM","B","PSJ PADE MGR",1)

"BLD",9173,"KRN",101,0)
101
"BLD",9173,"KRN",101,"NM",0)
^9.68A^40^27
"BLD",9173,"KRN",101,"NM",1,0)
PSJ ADT-A01 CLIENT^^0
"BLD",9173,"KRN",101,"NM",2,0)
PSJ ADT-A01 ROUTER^^0
"BLD",9173,"KRN",101,"NM",3,0)
PSJ ADT-A01 SERVER^^0
"BLD",9173,"KRN",101,"NM",4,0)
PSJ ADT-A02 SERVER^^0
"BLD",9173,"KRN",101,"NM",5,0)
PSJ ADT-A02 CLIENT^^0
"BLD",9173,"KRN",101,"NM",6,0)
PSJ ADT-A03 SERVER^^0
"BLD",9173,"KRN",101,"NM",7,0)
PSJ ADT-A03 CLIENT^^0
"BLD",9173,"KRN",101,"NM",8,0)
PSJ ADT-A11 SERVER^^0
"BLD",9173,"KRN",101,"NM",9,0)
PSJ ADT-A11 CLIENT^^0
"BLD",9173,"KRN",101,"NM",10,0)
PSJ ADT-A12 SERVER^^0
"BLD",9173,"KRN",101,"NM",11,0)
PSJ ADT-A12 CLIENT^^0
"BLD",9173,"KRN",101,"NM",12,0)
PSJ ADT-A13 SERVER^^0
"BLD",9173,"KRN",101,"NM",13,0)
PSJ ADT-A13 CLIENT^^0
"BLD",9173,"KRN",101,"NM",25,0)
PSJ PADE OMS-O05 EVENT^^0
"BLD",9173,"KRN",101,"NM",26,0)
PSJ PADE OMS-O05 SUB^^0
"BLD",9173,"KRN",101,"NM",27,0)
PSJ RDEO11 SERVER^^0
"BLD",9173,"KRN",101,"NM",28,0)
PSJ RDEO11 CLIENT^^0
"BLD",9173,"KRN",101,"NM",29,0)
PSJ LM PADE ACTIVITY^^0
"BLD",9173,"KRN",101,"NM",30,0)
PSJ LM PROFILE HIDDEN ACTIONS^^3
"BLD",9173,"KRN",101,"NM",31,0)
PSJ SIU-S12 CLIENT^^0
"BLD",9173,"KRN",101,"NM",32,0)
PSJ SIU-S12 SERVER^^0
"BLD",9173,"KRN",101,"NM",33,0)
PSJ SIU-SDAM ROUTER^^0
"BLD",9173,"KRN",101,"NM",34,0)
PSJ LM BPI HIDDEN ACTIONS^^3
"BLD",9173,"KRN",101,"NM",37,0)
PSJ ADT-A08 SERVER^^0
"BLD",9173,"KRN",101,"NM",38,0)
PSJ ADT-A08 CLIENT^^0
"BLD",9173,"KRN",101,"NM",39,0)
PSJ PADE OMS-O05 EVENT 2.3^^0
"BLD",9173,"KRN",101,"NM",40,0)
PSJ PADE OMS-O05 SUB 2.3^^0
"BLD",9173,"KRN",101,"NM","B","PSJ ADT-A01 CLIENT",1)

"BLD",9173,"KRN",101,"NM","B","PSJ ADT-A01 ROUTER",2)

"BLD",9173,"KRN",101,"NM","B","PSJ ADT-A01 SERVER",3)

"BLD",9173,"KRN",101,"NM","B","PSJ ADT-A02 CLIENT",5)

"BLD",9173,"KRN",101,"NM","B","PSJ ADT-A02 SERVER",4)

"BLD",9173,"KRN",101,"NM","B","PSJ ADT-A03 CLIENT",7)

"BLD",9173,"KRN",101,"NM","B","PSJ ADT-A03 SERVER",6)

"BLD",9173,"KRN",101,"NM","B","PSJ ADT-A08 CLIENT",38)

"BLD",9173,"KRN",101,"NM","B","PSJ ADT-A08 SERVER",37)

"BLD",9173,"KRN",101,"NM","B","PSJ ADT-A11 CLIENT",9)

"BLD",9173,"KRN",101,"NM","B","PSJ ADT-A11 SERVER",8)

"BLD",9173,"KRN",101,"NM","B","PSJ ADT-A12 CLIENT",11)

"BLD",9173,"KRN",101,"NM","B","PSJ ADT-A12 SERVER",10)

"BLD",9173,"KRN",101,"NM","B","PSJ ADT-A13 CLIENT",13)

"BLD",9173,"KRN",101,"NM","B","PSJ ADT-A13 SERVER",12)

"BLD",9173,"KRN",101,"NM","B","PSJ LM BPI HIDDEN ACTIONS",34)

"BLD",9173,"KRN",101,"NM","B","PSJ LM PADE ACTIVITY",29)

"BLD",9173,"KRN",101,"NM","B","PSJ LM PROFILE HIDDEN ACTIONS",30)

"BLD",9173,"KRN",101,"NM","B","PSJ PADE OMS-O05 EVENT",25)

"BLD",9173,"KRN",101,"NM","B","PSJ PADE OMS-O05 EVENT 2.3",39)

"BLD",9173,"KRN",101,"NM","B","PSJ PADE OMS-O05 SUB",26)

"BLD",9173,"KRN",101,"NM","B","PSJ PADE OMS-O05 SUB 2.3",40)

"BLD",9173,"KRN",101,"NM","B","PSJ RDEO11 CLIENT",28)

"BLD",9173,"KRN",101,"NM","B","PSJ RDEO11 SERVER",27)

"BLD",9173,"KRN",101,"NM","B","PSJ SIU-S12 CLIENT",31)

"BLD",9173,"KRN",101,"NM","B","PSJ SIU-S12 SERVER",32)

"BLD",9173,"KRN",101,"NM","B","PSJ SIU-SDAM ROUTER",33)

"BLD",9173,"KRN",409.61,0)
409.61
"BLD",9173,"KRN",409.61,"NM",0)
^9.68A^^
"BLD",9173,"KRN",771,0)
771
"BLD",9173,"KRN",771,"NM",0)
^9.68A^2^2
"BLD",9173,"KRN",771,"NM",1,0)
PSJ VISTA^^0
"BLD",9173,"KRN",771,"NM",2,0)
PSJ PADE SERVER^^0
"BLD",9173,"KRN",771,"NM","B","PSJ PADE SERVER",2)

"BLD",9173,"KRN",771,"NM","B","PSJ VISTA",1)

"BLD",9173,"KRN",779.2,0)
779.2
"BLD",9173,"KRN",870,0)
870
"BLD",9173,"KRN",870,"NM",0)
^9.68A^1^1
"BLD",9173,"KRN",870,"NM",1,0)
PSJ PADE^^0
"BLD",9173,"KRN",870,"NM","B","PSJ PADE",1)

"BLD",9173,"KRN",8989.51,0)
8989.51
"BLD",9173,"KRN",8989.51,"NM",0)
^9.68A^1^1
"BLD",9173,"KRN",8989.51,"NM",1,0)
PSJ PADE OE BALANCES^^0
"BLD",9173,"KRN",8989.51,"NM","B","PSJ PADE OE BALANCES",1)

"BLD",9173,"KRN",8989.52,0)
8989.52
"BLD",9173,"KRN",8994,0)
8994
"BLD",9173,"KRN","B",.4,.4)

"BLD",9173,"KRN","B",.401,.401)

"BLD",9173,"KRN","B",.402,.402)

"BLD",9173,"KRN","B",.403,.403)

"BLD",9173,"KRN","B",.5,.5)

"BLD",9173,"KRN","B",.84,.84)

"BLD",9173,"KRN","B",3.6,3.6)

"BLD",9173,"KRN","B",3.8,3.8)

"BLD",9173,"KRN","B",9.2,9.2)

"BLD",9173,"KRN","B",9.8,9.8)

"BLD",9173,"KRN","B",19,19)

"BLD",9173,"KRN","B",19.1,19.1)

"BLD",9173,"KRN","B",101,101)

"BLD",9173,"KRN","B",409.61,409.61)

"BLD",9173,"KRN","B",771,771)

"BLD",9173,"KRN","B",779.2,779.2)

"BLD",9173,"KRN","B",870,870)

"BLD",9173,"KRN","B",8989.51,8989.51)

"BLD",9173,"KRN","B",8989.52,8989.52)

"BLD",9173,"KRN","B",8994,8994)

"BLD",9173,"QUES",0)
^9.62^^
"BLD",9173,"REQB",0)
^9.611^10^5
"BLD",9173,"REQB",3,0)
PSJ*5.0*316^2
"BLD",9173,"REQB",4,0)
PSJ*5.0*191^2
"BLD",9173,"REQB",8,0)
PSJ*5.0*244^2
"BLD",9173,"REQB",9,0)
PSJ*5.0*323^2
"BLD",9173,"REQB",10,0)
PSJ*5.0*315^2
"BLD",9173,"REQB","B","PSJ*5.0*191",4)

"BLD",9173,"REQB","B","PSJ*5.0*244",8)

"BLD",9173,"REQB","B","PSJ*5.0*315",10)

"BLD",9173,"REQB","B","PSJ*5.0*316",3)

"BLD",9173,"REQB","B","PSJ*5.0*323",9)

"FIA",58.6)
PADE INBOUND TRANSACTIONS
"FIA",58.6,0)
^PS(58.6,
"FIA",58.6,0,0)
58.6D
"FIA",58.6,0,1)
y^y^f^^^^n
"FIA",58.6,0,10)

"FIA",58.6,0,11)

"FIA",58.6,0,"RLRO")

"FIA",58.6,0,"VR")
5.0^PSJ
"FIA",58.6,58.6)
0
"FIA",58.601)
PADE INVENTORY SYSTEM
"FIA",58.601,0)
^PS(58.601,
"FIA",58.601,0,0)
58.601I
"FIA",58.601,0,1)
y^y^f^^^^n
"FIA",58.601,0,10)

"FIA",58.601,0,11)

"FIA",58.601,0,"RLRO")

"FIA",58.601,0,"VR")
5.0^PSJ
"FIA",58.601,58.601)
0
"FIA",58.601,58.6011)
0
"FIA",58.601,58.60111)
0
"FIA",58.601,58.60112)
0
"FIA",58.601,58.601121)
0
"FIA",58.601,58.601122)
0
"FIA",58.601,58.601123)
0
"FIA",58.601,58.6014)
0
"FIA",58.601,58.60141)
0
"FIA",58.601,58.6015)
0
"FIA",58.601,58.6016)
0
"FIA",58.63)
PADE DISPENSING DEVICE
"FIA",58.63,0)
^PS(58.63,
"FIA",58.63,0,0)
58.63Is
"FIA",58.63,0,1)
y^y^f^^^^n
"FIA",58.63,0,10)

"FIA",58.63,0,11)

"FIA",58.63,0,"RLRO")

"FIA",58.63,0,"VR")
5.0^PSJ
"FIA",58.63,58.63)
0
"FIA",58.63,58.635)
0
"FIA",58.63,58.636)
0
"FIA",58.63,58.637)
0
"FIA",58.63,58.638)
0
"FIA",58.63,58.639)
0
"FIA",58.63,58.65)
0
"FIA",58.64)
PADE USER
"FIA",58.64,0)
^PS(58.64,
"FIA",58.64,0,0)
58.64IO
"FIA",58.64,0,1)
y^y^f^^^^n
"FIA",58.64,0,10)

"FIA",58.64,0,11)

"FIA",58.64,0,"RLRO")

"FIA",58.64,0,"VR")
5.0^PSJ
"FIA",58.64,58.64)
0
"FIA",58.7)
PADE SYSTEM SETUP
"FIA",58.7,0)
^PS(58.7,
"FIA",58.7,0,0)
58.7
"FIA",58.7,0,1)
y^y^f^^^^n
"FIA",58.7,0,10)

"FIA",58.7,0,11)

"FIA",58.7,0,"RLRO")

"FIA",58.7,0,"VR")
5.0^PSJ
"FIA",58.7,58.7)
0
"FIA",58.7,58.74)
0
"FIA",58.7,58.741)
0
"FIA",58.7,58.7411)
0
"FIA",58.7,58.7412)
0
"FIA",58.7,58.7413)
0
"FIA",58.7,58.742)
0
"FIA",58.7,58.746)
0
"FIA",58.7,58.747)
0
"FIA",58.7,58.748)
0
"FIA",58.7,58.7481)
0
"FIA",58.7,58.749)
0
"FIA",58.71)
PADE SEND AREA
"FIA",58.71,0)
^PS(58.71,
"FIA",58.71,0,0)
58.71
"FIA",58.71,0,1)
y^y^f^^^^n
"FIA",58.71,0,10)

"FIA",58.71,0,11)

"FIA",58.71,0,"RLRO")

"FIA",58.71,0,"VR")
5.0^PSJ
"FIA",58.71,58.71)
0
"FIA",58.72)
PADE OUTBOUND MESSAGES
"FIA",58.72,0)
^PS(58.72,
"FIA",58.72,0,0)
58.72DI
"FIA",58.72,0,1)
y^y^f^^^^n
"FIA",58.72,0,10)

"FIA",58.72,0,11)

"FIA",58.72,0,"RLRO")

"FIA",58.72,0,"VR")
5.0^PSJ
"FIA",58.72,58.72)
0
"FIA",59.6)
INPATIENT WARD PARAMETERS
"FIA",59.6,0)
^PS(59.6,
"FIA",59.6,0,0)
59.6P
"FIA",59.6,0,1)
y^y^p^^^^n^^n
"FIA",59.6,0,10)

"FIA",59.6,0,11)

"FIA",59.6,0,"RLRO")

"FIA",59.6,0,"VR")
5.0^PSJ
"FIA",59.6,59.6)
1
"FIA",59.6,59.6,8)

"INIT")
POST^PSJ317P
"IX",58.6,58.6,"AC",0)
58.6^AC^File incoming PADE transaction into PADE INVENTORY (#58.601) file.^MU^^R^IR^I^58.6^^^^^A
"IX",58.6,58.6,"AC",.1,0)
^^8^8^3151202^
"IX",58.6,58.6,"AC",.1,1,0)
This action cross reference files incoming HL7 data received from PADE 
"IX",58.6,58.6,"AC",.1,2,0)
vendors into the PADE INVENTORY SYSTEM (#58.601) file by invoking
"IX",58.6,58.6,"AC",.1,3,0)
FIL58601^PSJPADIT. 
"IX",58.6,58.6,"AC",.1,4,0)
 
"IX",58.6,58.6,"AC",.1,5,0)
The PADE TRANSACTION (#58.6) file serves as a queue for the incoming
"IX",58.6,58.6,"AC",.1,6,0)
transaction, with minimal validation, in order to capture the activity in 
"IX",58.6,58.6,"AC",.1,7,0)
the HL7 message for reporting purposes; the PADE INVENTORY SYSTEM 
"IX",58.6,58.6,"AC",.1,8,0)
(#58.601) file is only updated if required data is present.
"IX",58.6,58.6,"AC",1)
D FIL58601^PSJPADIT(.X,.PSJOMS)
"IX",58.6,58.6,"AC",2)
Q
"IX",58.6,58.6,"AC",11.1,0)
^.114IA^11^10
"IX",58.6,58.6,"AC",11.1,1,0)
1^F^58.6^1.1^30^1^F
"IX",58.6,58.6,"AC",11.1,2,0)
2^F^58.6^1^30^2^F
"IX",58.6,58.6,"AC",11.1,3,0)
3^F^58.6^1.2^30^3^F
"IX",58.6,58.6,"AC",11.1,4,0)
4^C^^^30^4^F
"IX",58.6,58.6,"AC",11.1,4,1.5)
S X=$$DRGXREF^PSJPAD7I(DA,.PSJOMS)
"IX",58.6,58.6,"AC",11.1,5,0)
5^F^58.6^4^30^5^F
"IX",58.6,58.6,"AC",11.1,6,0)
6^F^58.6^3^30^6^F
"IX",58.6,58.6,"AC",11.1,7,0)
7^F^58.6^10^30^7^F
"IX",58.6,58.6,"AC",11.1,9,0)
8^F^58.6^13^30^8^F
"IX",58.6,58.6,"AC",11.1,10,0)
9^F^58.6^.01^^9^F
"IX",58.6,58.6,"AC",11.1,11,0)
10^F^58.6^11^^10^F
"IX",58.6,58.6,"DEV",0)
58.6^DEV^PADE device by Date^R^^R^IR^I^58.6^^^^^LS
"IX",58.6,58.6,"DEV",.1,0)
^^4^4^3151202^
"IX",58.6,58.6,"DEV",.1,1,0)
This cross reference groups transactions by PADE dispensing system,
"IX",58.6,58.6,"DEV",.1,2,0)
device, and by date/time to optimize lookups and reports. With this cross 
"IX",58.6,58.6,"DEV",.1,3,0)
reference, a list of PADE dispensing devices with transaction activity
"IX",58.6,58.6,"DEV",.1,4,0)
for a given range of dates may be quickly retrieved.
"IX",58.6,58.6,"DEV",1)
S ^PS(58.6,"DEV",$E(X(1),1,30),$E(X(2),1,30),X(3),DA)=""
"IX",58.6,58.6,"DEV",2)
K ^PS(58.6,"DEV",$E(X(1),1,30),$E(X(2),1,30),X(3),DA)
"IX",58.6,58.6,"DEV",2.5)
K ^PS(58.6,"DEV")
"IX",58.6,58.6,"DEV",11.1,0)
^.114IA^3^3
"IX",58.6,58.6,"DEV",11.1,1,0)
1^F^58.6^1.1^30^1^F
"IX",58.6,58.6,"DEV",11.1,2,0)
2^F^58.6^1^30^2^F
"IX",58.6,58.6,"DEV",11.1,3,0)
3^F^58.6^.01^^3^F
"IX",58.6,58.6,"DEVD",0)
58.6^DEVD^Link Device to Drug by Date^R^^R^IR^I^58.6^^^^^LS
"IX",58.6,58.6,"DEVD",.1,0)
^^4^4^3151202^
"IX",58.6,58.6,"DEVD",.1,1,0)
This cross reference groups PADE transactions by PADE dispensing device, 
"IX",58.6,58.6,"DEVD",.1,2,0)
and by drug, and by date/time to optimize lookups and reports. With this 
"IX",58.6,58.6,"DEVD",.1,3,0)
cross reference, a list of drug items acted upon for a specific PADE 
"IX",58.6,58.6,"DEVD",.1,4,0)
device within a selected range of dates may be quickly retrieved.
"IX",58.6,58.6,"DEVD",1)
S ^PS(58.6,"DEVD",$E(X(1),1,30),$E(X(2),1,30),$E(X(3),1,30),$E(X(4),1,30),DA)=""
"IX",58.6,58.6,"DEVD",2)
K ^PS(58.6,"DEVD",$E(X(1),1,30),$E(X(2),1,30),$E(X(3),1,30),$E(X(4),1,30),DA)
"IX",58.6,58.6,"DEVD",2.5)
K ^PS(58.6,"DEVD")
"IX",58.6,58.6,"DEVD",11.1,0)
^.114IA^4^4
"IX",58.6,58.6,"DEVD",11.1,1,0)
1^F^58.6^1.1^30^1^F
"IX",58.6,58.6,"DEVD",11.1,2,0)
2^F^58.6^1^30^2^F
"IX",58.6,58.6,"DEVD",11.1,3,0)
3^F^58.6^2^30^3^F
"IX",58.6,58.6,"DEVD",11.1,4,0)
4^F^58.6^.01^30^4^F
"IX",58.6,58.6,"DRG",0)
58.6^DRG^Drug ITEM by Date^R^^R^IR^I^58.6^^^^^LS
"IX",58.6,58.6,"DRG",.1,0)
^^4^4^3151202^
"IX",58.6,58.6,"DRG",.1,1,0)
This cross reference groups transactions by drug item and by transaction 
"IX",58.6,58.6,"DRG",.1,2,0)
date/time to optimize lookups and reports. With this cross reference, a 
"IX",58.6,58.6,"DRG",.1,3,0)
list of drugs with transaction activity for a given range of dates may be 
"IX",58.6,58.6,"DRG",.1,4,0)
quickly retrieved.
"IX",58.6,58.6,"DRG",1)
S ^PS(58.6,"DRG",$E(X(1),1,30),X(2),X(3),DA)=""
"IX",58.6,58.6,"DRG",2)
K ^PS(58.6,"DRG",$E(X(1),1,30),X(2),X(3),DA)
"IX",58.6,58.6,"DRG",2.5)
K ^PS(58.6,"DRG")
"IX",58.6,58.6,"DRG",11.1,0)
^.114IA^3^3
"IX",58.6,58.6,"DRG",11.1,1,0)
1^F^58.6^1.1^30^1^F
"IX",58.6,58.6,"DRG",11.1,2,0)
2^F^58.6^2^^2^F
"IX",58.6,58.6,"DRG",11.1,3,0)
3^F^58.6^.01^^3^F
"IX",58.6,58.6,"MDRG",0)
58.6^MDRG^DRUG NOT ON FILE^MU^^R^IR^I^58.6^^^^^LS
"IX",58.6,58.6,"MDRG",.1,0)
^^2^2^3151210^
"IX",58.6,58.6,"MDRG",.1,1,0)
This cross reference contains drug items received via the PADE HL7 
"IX",58.6,58.6,"MDRG",.1,2,0)
interface that do not match to a drug in the DRUG (#50) file.
"IX",58.6,58.6,"MDRG",1)
S ^PS(58.6,"MDRG",X(1),X(2),X(3),X(4),$G(DA))=""
"IX",58.6,58.6,"MDRG",1.4)
I $L($G(X(5))) S X='$D(^PSDRUG(+$G(X(5)),2))
"IX",58.6,58.6,"MDRG",2)
K ^PS(58.6,"MDRG",X(1),X(2),X(3),X(4),$G(DA))
"IX",58.6,58.6,"MDRG",2.5)
K ^PS(58.6,"MDRG")
"IX",58.6,58.6,"MDRG",11.1,0)
^.114IA^5^5
"IX",58.6,58.6,"MDRG",11.1,1,0)
1^F^58.6^1.1^^1^F
"IX",58.6,58.6,"MDRG",11.1,2,0)
2^F^58.6^1^^2^F
"IX",58.6,58.6,"MDRG",11.1,3,0)
3^F^58.6^18^30^3^F
"IX",58.6,58.6,"MDRG",11.1,4,0)
4^F^58.6^.01^^4^F
"IX",58.6,58.6,"MDRG",11.1,5,0)
5^F^58.6^19^^5^F
"IX",58.6,58.6,"MPT",0)
58.6^MPT^Missing Patient^R^^F^IR^I^58.6^^^^^LS
"IX",58.6,58.6,"MPT",.1,0)
^^2^2^3151218^
"IX",58.6,58.6,"MPT",.1,1,0)
This cross reference contains patient names received from the PADE system 
"IX",58.6,58.6,"MPT",.1,2,0)
without a corresponding patient ID matching a patient in VistA.
"IX",58.6,58.6,"MPT",1)
S ^PS(58.6,"MPT",$E(X,1,30),DA)=""
"IX",58.6,58.6,"MPT",2)
K ^PS(58.6,"MPT",$E(X,1,30),DA)
"IX",58.6,58.6,"MPT",2.5)
K ^PS(58.6,"MPT")
"IX",58.6,58.6,"MPT",11.1,0)
^.114IA^1^1
"IX",58.6,58.6,"MPT",11.1,1,0)
1^F^58.6^25^30^1^F
"IX",58.6,58.6,"P",0)
58.6^P^Link patient to PADE transaction^R^^F^IR^I^58.6^^^^^LS
"IX",58.6,58.6,"P",.1,0)
^^4^4^3151202^
"IX",58.6,58.6,"P",.1,1,0)
This cross reference groups PADE transactions by patient, by date, and 
"IX",58.6,58.6,"P",.1,2,0)
by drug item, to optimize lookups and report processing. With this cross
"IX",58.6,58.6,"P",.1,3,0)
reference, all transactions related to a specific patient may be retrieved
"IX",58.6,58.6,"P",.1,4,0)
quickly and efficiently.
"IX",58.6,58.6,"P",1)
S ^PS(58.6,"P",$E(X(1),1,30),X(2),$E(X(3),1,45),DA)=""
"IX",58.6,58.6,"P",2)
K ^PS(58.6,"P",$E(X(1),1,30),X(2),$E(X(3),1,45),DA)
"IX",58.6,58.6,"P",2.5)
K ^PS(58.6,"P")
"IX",58.6,58.6,"P",11.1,0)
^.114IA^3^3
"IX",58.6,58.6,"P",11.1,1,0)
1^C^^^30^1
"IX",58.6,58.6,"P",11.1,1,1.5)
S X=$$PTIX^PSJPDRUT(DA,.PSJOMS)
"IX",58.6,58.6,"P",11.1,2,0)
2^F^58.6^.01^^2^F
"IX",58.6,58.6,"P",11.1,2,3)

"IX",58.6,58.6,"P",11.1,3,0)
3^C^^^45^3
"IX",58.6,58.6,"P",11.1,3,1.5)
S X=$$DRGIX^PSJPDRUT(DA,.PSJOMS)
"IX",58.6,58.6,"ST",0)
58.6^ST^Transaction Processing Status^R^^R^IR^I^58.6^^^^^LS
"IX",58.6,58.6,"ST",.1,0)
^^6^6^3151202^
"IX",58.6,58.6,"ST",.1,1,0)
This cross reference represents the processsing status of the incoming 
"IX",58.6,58.6,"ST",.1,2,0)
HL7 transaction in the PADE TRANSACTIONS (#58.6) file, which serves as a 
"IX",58.6,58.6,"ST",.1,3,0)
queue for incoming HL7 PADE transactions. The status is set to 'P' 
"IX",58.6,58.6,"ST",.1,4,0)
(Pending) when the entry is initially filed, then set to 'I' (In 
"IX",58.6,58.6,"ST",.1,5,0)
Progress) when the transaction begins processing, and 'C' (Complete) when 
"IX",58.6,58.6,"ST",.1,6,0)
the entry has been successfully processed.
"IX",58.6,58.6,"ST",1)
S ^PS(58.6,"ST",X(1),X(2),DA)=""
"IX",58.6,58.6,"ST",2)
K ^PS(58.6,"ST",X(1),X(2),DA)
"IX",58.6,58.6,"ST",2.5)
K ^PS(58.6,"ST")
"IX",58.6,58.6,"ST",11.1,0)
^.114IA^2^2
"IX",58.6,58.6,"ST",11.1,1,0)
1^F^58.6^22^^1^F
"IX",58.6,58.6,"ST",11.1,2,0)
2^F^58.6^.01^^2^F
"IX",58.6,58.6,"USR",0)
58.6^USR^Link and group PADE user to PADE Inbound transactions^R^^R^IR^I^58.6^^^^^LS
"IX",58.6,58.6,"USR",.1,0)
^^4^4^3151202^
"IX",58.6,58.6,"USR",.1,1,0)
This cross reference grouips PADE transactions by PADE user ID and 
"IX",58.6,58.6,"USR",.1,2,0)
date/time to optimize lookups and reports. With this cross reference, a 
"IX",58.6,58.6,"USR",.1,3,0)
list of clinical users performing PADE actions within a selected range of 
"IX",58.6,58.6,"USR",.1,4,0)
dates may be quickly retrieved.
"IX",58.6,58.6,"USR",1)
S ^PS(58.6,"USR",$E(X(1),1,30),X(2),DA)=""
"IX",58.6,58.6,"USR",2)
K ^PS(58.6,"USR",$E(X(1),1,30),X(2),DA)
"IX",58.6,58.6,"USR",2.5)
K ^PS(58.6,"USR")
"IX",58.6,58.6,"USR",11.1,0)
^.114IA^2^2
"IX",58.6,58.6,"USR",11.1,1,0)
1^F^58.6^6.1^30^1^F
"IX",58.6,58.6,"USR",11.1,2,0)
2^F^58.6^.01^^2^F
"IX",58.601,58.601,"DEV",0)
58.601^DEV^Group drugs by PADE device^R^^F^IR^W^58.60111^^^^^LS
"IX",58.601,58.601,"DEV",.1,0)
^^2^2^3151201^^
"IX",58.601,58.601,"DEV",.1,1,0)
This cross reference groups drug items by PADE dispensing device in order 
"IX",58.601,58.601,"DEV",.1,2,0)
to optimized lookups and reports.
"IX",58.601,58.601,"DEV",1)
S ^PS(58.601,"DEV",X(1),X(2),DA(2),DA(1),DA)=""
"IX",58.601,58.601,"DEV",2)
K ^PS(58.601,"DEV",X(1),X(2),DA(2),DA(1),DA)
"IX",58.601,58.601,"DEV",2.5)
K ^PS(58.601,"DEV")
"IX",58.601,58.601,"DEV",11.1,0)
^.114IA^2^2
"IX",58.601,58.601,"DEV",11.1,1,0)
1^C^^^^1
"IX",58.601,58.601,"DEV",11.1,1,1.5)
S X=$G(^PS(58.601,+$G(DA(2)),"DEVICE",+$G(DA(1)),0))
"IX",58.601,58.601,"DEV",11.1,2,0)
2^F^58.60111^.01^^2^F
"IX",58.601,58.601,"DRG",0)
58.601^DRG^Group PADE Device by Drug^R^^F^IR^W^58.60111^^^^^LS
"IX",58.601,58.601,"DRG",.1,0)
^^4^4^3151201^^
"IX",58.601,58.601,"DRG",.1,1,0)
This cross reference groups PADE Dispensing Devices by drug, to 
"IX",58.601,58.601,"DRG",.1,2,0)
optimize PADE inventory lookups and reports. Grouping PADE Dispensing 
"IX",58.601,58.601,"DRG",.1,3,0)
Devices by drug allows the quick retrieval of a list of all PADE 
"IX",58.601,58.601,"DRG",.1,4,0)
Dispensing Devices containing a specific drug item.
"IX",58.601,58.601,"DRG",1)
S ^PS(58.601,"DRG",X(1),X(2),DA(2),DA(1),DA)=""
"IX",58.601,58.601,"DRG",2)
K ^PS(58.601,"DRG",X(1),X(2),DA(2),DA(1),DA)
"IX",58.601,58.601,"DRG",2.5)
K ^PS(58.601,"DRG")
"IX",58.601,58.601,"DRG",11.1,0)
^.114IA^2^2
"IX",58.601,58.601,"DRG",11.1,1,0)
1^F^58.60111^.01^^1^F
"IX",58.601,58.601,"DRG",11.1,2,0)
2^C^^^^2
"IX",58.601,58.601,"DRG",11.1,2,1.5)
S X=$G(^PS(58.601,DA(2),"DEVICE",DA(1),0))
"IX",58.63,58.63,"AC",0)
58.63^AC^Add device to PADE INVENTORY file (#58.601)^MU^^R^IR^I^58.63^^^^^A
"IX",58.63,58.63,"AC",.1,0)
^^2^2^3151201^
"IX",58.63,58.63,"AC",.1,1,0)
This Action cross reference files new entries into the PADE INVENTORY 
"IX",58.63,58.63,"AC",.1,2,0)
SYSTEM (#58.601) file, if not already on file.
"IX",58.63,58.63,"AC",1)
D FILEDEV^PSJPADIT(.X)
"IX",58.63,58.63,"AC",2)
Q
"IX",58.63,58.63,"AC",11.1,0)
^.114IA^2^2
"IX",58.63,58.63,"AC",11.1,1,0)
1^F^58.63^.01^^1^F
"IX",58.63,58.63,"AC",11.1,2,0)
2^F^58.63^1^^2^F
"IX",58.63,58.63,"C",0)
58.63^C^Uniqueness Index for Key 'A' of File #58.63^R^^R^IR^I^58.63^^^^^LS
"IX",58.63,58.63,"C",.1,0)
^^5^5^3151201^
"IX",58.63,58.63,"C",.1,1,0)
This cross reference enforces the uniquess of PADE devices with duplicate 
"IX",58.63,58.63,"C",.1,2,0)
names. While this file may contain multiple PADE dispensing devices with
"IX",58.63,58.63,"C",.1,3,0)
the same NAME (.01) field value, each duplicate name must remain unique 
"IX",58.63,58.63,"C",.1,4,0)
by being associated with a different PADE INVENTORY SYSTEM (#58.601)
"IX",58.63,58.63,"C",.1,5,0)
file entry.
"IX",58.63,58.63,"C",1)
S ^PS(58.63,"C",X(1),X(2),DA)=""
"IX",58.63,58.63,"C",2)
K ^PS(58.63,"C",X(1),X(2),DA)
"IX",58.63,58.63,"C",2.5)
K ^PS(58.63,"C")
"IX",58.63,58.63,"C",11.1,0)
^.114IA^2^2
"IX",58.63,58.63,"C",11.1,1,0)
1^F^58.63^.01^^1
"IX",58.63,58.63,"C",11.1,2,0)
2^F^58.63^1^^2
"IX",58.63,58.63,"CG",0)
58.63^CG^CLINIC GROUPS^MU^^F^IR^W^58.637^^^^^LS
"IX",58.63,58.63,"CG",1)
S ^PS(58.63,"CG",X(1),$G(DA(1)))=""
"IX",58.63,58.63,"CG",2)
K ^PS(58.63,"CG",X(1),$G(DA(1)))
"IX",58.63,58.63,"CG",2.5)
K ^PS(58.63,"CG")
"IX",58.63,58.63,"CG",11.1,0)
^.114IA^1^1
"IX",58.63,58.63,"CG",11.1,1,0)
1^F^58.637^.01^^1^F
"IX",58.63,58.63,"CG",11.1,1,3)

"IX",58.63,58.63,"CL",0)
58.63^CL^CLINIC LOCATIONS^MU^^F^IR^W^58.638^^^^^LS
"IX",58.63,58.63,"CL",.1,0)
^^6^6^3151208^
"IX",58.63,58.63,"CL",.1,1,0)
This cross reference contains Clinics associated with PADE Dispensing 
"IX",58.63,58.63,"CL",.1,2,0)
cabinets. This cross reference will be used to enable and disable the 
"IX",58.63,58.63,"CL",.1,3,0)
display of PADE information in Inpatient Order Entry by enabling the 
"IX",58.63,58.63,"CL",.1,4,0)
display when an order's clinic location is linked to a PADE device, and 
"IX",58.63,58.63,"CL",.1,5,0)
disabling the display when a patient's clinic location is not linked to a 
"IX",58.63,58.63,"CL",.1,6,0)
PADE device.
"IX",58.63,58.63,"CL",1)
S ^PS(58.63,"CL",X(1),$G(DA(1)))=""
"IX",58.63,58.63,"CL",2)
K ^PS(58.63,"CL",X(1),$G(DA(1)))
"IX",58.63,58.63,"CL",2.5)
K ^PS(58.63,"CL")
"IX",58.63,58.63,"CL",11.1,0)
^.114IA^1^1
"IX",58.63,58.63,"CL",11.1,1,0)
1^F^58.638^.01^^1^F
"IX",58.63,58.63,"D",0)
58.63^D^Link Division to PADE device^R^^R^IR^I^58.63^^^^^LS
"IX",58.63,58.63,"D",.1,0)
^^8^8^3160502^
"IX",58.63,58.63,"D",.1,1,0)
This cross reference allows PADE dispensing devices to be sorted by the 
"IX",58.63,58.63,"D",.1,2,0)
Division to which the device is associated, to optimize lookups and 
"IX",58.63,58.63,"D",.1,3,0)
reports. Each dispensing device in this file must be associated with a
"IX",58.63,58.63,"D",.1,4,0)
VistA Division in order for inbound PADE transactions to properly 
"IX",58.63,58.63,"D",.1,5,0)
update PADE inventory in the PADE INVENTORY SYSTEM (#58.601) file. 
"IX",58.63,58.63,"D",.1,6,0)
Each dispensing device must be associated with one or more hospital
"IX",58.63,58.63,"D",.1,7,0)
locations (Wards, Ward Groups, Clinics, Clinic Groups) in order for
"IX",58.63,58.63,"D",.1,8,0)
PADE inventory to display in Inpatient Order Entry.
"IX",58.63,58.63,"D",1)
S ^PS(58.63,"D",X(1),$E(X(2),1,30),DA)=""
"IX",58.63,58.63,"D",2)
K ^PS(58.63,"D",X(1),$E(X(2),1,30),DA)
"IX",58.63,58.63,"D",2.5)
K ^PS(58.63,"D")
"IX",58.63,58.63,"D",11.1,0)
^.114IA^2^2
"IX",58.63,58.63,"D",11.1,1,0)
1^F^58.63^2^^1^F
"IX",58.63,58.63,"D",11.1,2,0)
2^F^58.63^.01^30^2^F
"IX",58.63,58.63,"F",0)
58.63^F^TEST^MU^^F^IR^I^58.63^^^^^LS
"IX",58.63,58.63,"F",1)
S ^PS(58.63,"F",$$UPPER^PSJPDRUT(X(1)),DA)=""
"IX",58.63,58.63,"F",2)
K ^PS(58.63,"F",$$UPPER^PSJPDRUT(X(1)),DA)
"IX",58.63,58.63,"F",2.5)
K ^PS(58.63,"F")
"IX",58.63,58.63,"F",11.1,0)
^.114IA^1^1
"IX",58.63,58.63,"F",11.1,1,0)
1^C^^^^1
"IX",58.63,58.63,"F",11.1,1,1.5)
S X=$P($G(^PS(58.63,+$G(DA),0)),"^")
"IX",58.63,58.63,"WC",0)
58.63^WC^CLINIC WILDCARD^MU^^F^IR^W^58.65^^^^^LS
"IX",58.63,58.63,"WC",.1,0)
^^14^14^3151209^
"IX",58.63,58.63,"WC",.1,1,0)
This cross reference allows a group of CLINICS with a common naming 
"IX",58.63,58.63,"WC",.1,2,0)
convention, where that naming convention or 'wildcard' has been linked to
"IX",58.63,58.63,"WC",.1,3,0)
a PADE cabinet, to be quickly searched and tested to determine if a given 
"IX",58.63,58.63,"WC",.1,4,0)
clinic is linked to any PADE cabinets.
"IX",58.63,58.63,"WC",.1,5,0)
 
"IX",58.63,58.63,"WC",.1,6,0)
For example, if all of a division's surgery clinics began with
"IX",58.63,58.63,"WC",.1,7,0)
'AL-SURGERY', all the surgery clinics could be linked to a PADE cabinet by
"IX",58.63,58.63,"WC",.1,8,0)
creating a wildcard called "AL-SURGERY". Other PADE cabinets could be 
"IX",58.63,58.63,"WC",.1,9,0)
linked to the "AL-SURGERY" wildcard as well. 
"IX",58.63,58.63,"WC",.1,10,0)
 
"IX",58.63,58.63,"WC",.1,11,0)
When clinic orders are viewed, finished, or edited in Inpatient Order 
"IX",58.63,58.63,"WC",.1,12,0)
Entry, the order's clinic location is compared to the pattern/wildcard in 
"IX",58.63,58.63,"WC",.1,13,0)
this cross reference to determine if PADE information should be displayed,
"IX",58.63,58.63,"WC",.1,14,0)
indicating the order's medication may be dispensed from a PADE cabinet.
"IX",58.63,58.63,"WC",1)
S ^PS(58.63,"WC",X(1),DA(1))=""
"IX",58.63,58.63,"WC",2)
K ^PS(58.63,"WC",X(1),DA(1))
"IX",58.63,58.63,"WC",2.5)
K ^PS(58.63,"WC")
"IX",58.63,58.63,"WC",11.1,0)
^.114IA^1^1
"IX",58.63,58.63,"WC",11.1,1,0)
1^F^58.65^.01^^1^F
"IX",58.63,58.63,"WD",0)
58.63^WD^WARDS^R^^F^IR^W^58.636^^^^^LS
"IX",58.63,58.63,"WD",.1,0)
^^4^4^3151208^
"IX",58.63,58.63,"WD",.1,1,0)
This cross reference contains list of all Wards linked to PADE 
"IX",58.63,58.63,"WD",.1,2,0)
cabinets. This cross reference is used to determine if Inpatient Order 
"IX",58.63,58.63,"WD",.1,3,0)
Entry screens include Pharmacy Automated Dispensing Equipment (PADE) 
"IX",58.63,58.63,"WD",.1,4,0)
information.
"IX",58.63,58.63,"WD",1)
S ^PS(58.63,"WD",X,DA(1),DA)=""
"IX",58.63,58.63,"WD",2)
K ^PS(58.63,"WD",X,DA(1),DA)
"IX",58.63,58.63,"WD",2.5)
K ^PS(58.63,"WD")
"IX",58.63,58.63,"WD",11.1,0)
^.114IA^1^1
"IX",58.63,58.63,"WD",11.1,1,0)
1^F^58.636^.01^^1^F
"IX",58.63,58.63,"WD",11.1,1,3)

"IX",58.63,58.63,"WG",0)
58.63^WG^WARD GROUPS^MU^^F^IR^W^58.635^^^^^LS
"IX",58.63,58.63,"WG",.1,0)
^^6^6^3151208^
"IX",58.63,58.63,"WG",.1,1,0)
This cross reference contains Ward Groups associated with PADE Dispensing 
"IX",58.63,58.63,"WG",.1,2,0)
cabinets. This cross reference will be used to enable and disable the 
"IX",58.63,58.63,"WG",.1,3,0)
display of PADE information in Inpatient Order Entry by enabling the 
"IX",58.63,58.63,"WG",.1,4,0)
display when the patient's ward location is linked to a PADE device, and 
"IX",58.63,58.63,"WG",.1,5,0)
disabling the display when the patient's ward location is not linked to a 
"IX",58.63,58.63,"WG",.1,6,0)
PADE device.
"IX",58.63,58.63,"WG",1)
S ^PS(58.63,"WG",X(1),$G(DA(1)))=""
"IX",58.63,58.63,"WG",2)
K ^PS(58.63,"WG",X(1),$G(DA(1)))
"IX",58.63,58.63,"WG",2.5)
K ^PS(58.63,"WG")
"IX",58.63,58.63,"WG",11.1,0)
^.114IA^1^1
"IX",58.63,58.63,"WG",11.1,1,0)
1^F^58.635^.01^^1^F
"IX",58.64,58.64,"C",0)
58.64^C^PADE ID by PADE Inbound System^R^^R^IR^I^58.64^^^^^LS
"IX",58.64,58.64,"C",.1,0)
^^3^3^3151201^
"IX",58.64,58.64,"C",.1,1,0)
This cross reference groups PADE user ID by PADE Inbound System to 
"IX",58.64,58.64,"C",.1,2,0)
optimize lookups and reports run for a specific PADE INVENTORY SYSTEM
"IX",58.64,58.64,"C",.1,3,0)
(#58.601) file entry.
"IX",58.64,58.64,"C",1)
S ^PS(58.64,"C",X(1),X(2),DA)=""
"IX",58.64,58.64,"C",2)
K ^PS(58.64,"C",X(1),X(2),DA)
"IX",58.64,58.64,"C",2.5)
K ^PS(58.64,"C")
"IX",58.64,58.64,"C",11.1,0)
^.114IA^2^2
"IX",58.64,58.64,"C",11.1,1,0)
1^F^58.64^1.1^^1
"IX",58.64,58.64,"C",11.1,2,0)
2^F^58.64^1^^2
"IX",58.64,58.64,"DUZ",0)
58.64^DUZ^User DUZ to PADE ID^R^^R^IR^I^58.64^^^^^LS
"IX",58.64,58.64,"DUZ",.1,0)
^^5^5^3151201^^
"IX",58.64,58.64,"DUZ",.1,1,0)
This cross reference groups all of a PADE user's external PADE ID's 
"IX",58.64,58.64,"DUZ",.1,2,0)
together by their VistA user ID, when the linkage between PADE ID and 
"IX",58.64,58.64,"DUZ",.1,3,0)
VistA ID has been established. The VistA user may have different PADE 
"IX",58.64,58.64,"DUZ",.1,4,0)
ID's for each PADE Inbound System; this cross reference optimizes lookups 
"IX",58.64,58.64,"DUZ",.1,5,0)
focused on a specific PADE user, across multiple PADE Inbound Systems.
"IX",58.64,58.64,"DUZ",1)
S ^PS(58.64,"DUZ",X(1),X(2),$E(X(3),1,30),DA)=""
"IX",58.64,58.64,"DUZ",2)
K ^PS(58.64,"DUZ",X(1),X(2),$E(X(3),1,30),DA)
"IX",58.64,58.64,"DUZ",2.5)
K ^PS(58.64,"DUZ")
"IX",58.64,58.64,"DUZ",11.1,0)
^.114IA^3^3
"IX",58.64,58.64,"DUZ",11.1,1,0)
1^F^58.64^2^^1^F
"IX",58.64,58.64,"DUZ",11.1,2,0)
2^F^58.64^1.1^^2^F
"IX",58.64,58.64,"DUZ",11.1,3,0)
3^F^58.64^1^30^3^F
"IX",58.64,58.64,"KEY",0)
58.64^KEY^PADE ID by PADE INBOUND SYSTEM^R^^R^IR^I^58.64^^^^^LS
"IX",58.64,58.64,"KEY",.1,0)
^^5^5^3151201^^
"IX",58.64,58.64,"KEY",.1,1,0)
This cross reference is the primary Key for this file, enforcing the
"IX",58.64,58.64,"KEY",.1,2,0)
uniqueness of each PADE user ID by linking it to a PADE Inbound System. 
"IX",58.64,58.64,"KEY",.1,3,0)
Duplicate PADE user ID's may exist for different (or the same) PADE users 
"IX",58.64,58.64,"KEY",.1,4,0)
in different PADE Inbound Systems; duplicate PADE user ID's are not 
"IX",58.64,58.64,"KEY",.1,5,0)
permitted within a single PADE Inbound System.
"IX",58.64,58.64,"KEY",1)
S ^PS(58.64,"KEY",X(1),$E(X(2),1,30),DA)=""
"IX",58.64,58.64,"KEY",2)
K ^PS(58.64,"KEY",X(1),$E(X(2),1,30),DA)
"IX",58.64,58.64,"KEY",2.5)
K ^PS(58.64,"KEY")
"IX",58.64,58.64,"KEY",11.1,0)
^.114IA^2^2
"IX",58.64,58.64,"KEY",11.1,1,0)
1^F^58.64^1.1^^1^F
"IX",58.64,58.64,"KEY",11.1,2,0)
2^F^58.64^1^30^2^F
"IX",58.64,58.64,"PID",0)
58.64^PID^PADE User to PADE ID^R^^R^IR^I^58.64^^^^^LS
"IX",58.64,58.64,"PID",.1,0)
^^6^6^3151201^
"IX",58.64,58.64,"PID",.1,1,0)
This cross reference groups PADE user names by PADE user ID, to optimize 
"IX",58.64,58.64,"PID",.1,2,0)
PADE lookups and reports by quickly determining if there are multiple 
"IX",58.64,58.64,"PID",.1,3,0)
PADE users with the same PADE ID associated with different PADE Inbound 
"IX",58.64,58.64,"PID",.1,4,0)
Systems. This information may be used to find all PADE user ID's for the
"IX",58.64,58.64,"PID",.1,5,0)
same user across multiple PADE Inbound Systems, when the user is not 
"IX",58.64,58.64,"PID",.1,6,0)
linked to a VistA user ID.
"IX",58.64,58.64,"PID",1)
S ^PS(58.64,"PID",$E(X(1),1,30),$E(X(2),1,30),DA)=""
"IX",58.64,58.64,"PID",2)
K ^PS(58.64,"PID",$E(X(1),1,30),$E(X(2),1,30),DA)
"IX",58.64,58.64,"PID",2.5)
K ^PS(58.64,"PID")
"IX",58.64,58.64,"PID",11.1,0)
^.114IA^2^2
"IX",58.64,58.64,"PID",11.1,1,0)
1^F^58.64^1^30^1^F
"IX",58.64,58.64,"PID",11.1,2,0)
2^F^58.64^.01^30^2^F
"IX",58.7,58.7,"AD",0)
58.7^AD^INDEX BY DIVISION AND PADE^R^^F^IR^W^58.74^^^^^S
"IX",58.7,58.7,"AD",.1,0)
^^4^4^3151209^
"IX",58.7,58.7,"AD",.1,1,0)
If there are multiple PADE system associated with a Medical Center
"IX",58.7,58.7,"AD",.1,2,0)
Division, then this cross reference will sort them under each division,
"IX",58.7,58.7,"AD",.1,3,0)
which will be very helpful in generating HL7 messages to multiple PADE
"IX",58.7,58.7,"AD",.1,4,0)
system.
"IX",58.7,58.7,"AD",1)
S ^PS(58.7,"AD",X,DA(1),DA)=""
"IX",58.7,58.7,"AD",2)
K ^PS(58.7,"AD",X,DA(1),DA)
"IX",58.7,58.7,"AD",2.5)
K ^PS(58.7,"AD")
"IX",58.7,58.7,"AD",11.1,0)
^.114IA^1^1
"IX",58.7,58.7,"AD",11.1,1,0)
1^F^58.74^.01^^1^F
"KEY",58.63,58.63,"A",0)
58.63^A^P^1213
"KEY",58.63,58.63,"A",2,0)
^.312IA^2^2
"KEY",58.63,58.63,"A",2,1,0)
.01^58.63^1
"KEY",58.63,58.63,"A",2,2,0)
1^58.63^2
"KEY",58.64,58.64,"A",0)
58.64^A^P^1227
"KEY",58.64,58.64,"A",2,0)
^.312IA^2^2
"KEY",58.64,58.64,"A",2,1,0)
1.1^58.64^1
"KEY",58.64,58.64,"A",2,2,0)
1^58.64^2
"KEYPTR",58.63,58.63,"A")
58.63^C
"KEYPTR",58.64,58.64,"A")
58.64^C
"KRN",.402,1356,-1)
0^4
"KRN",.402,1356,0)
PSJ IWP EDIT^3150928.1417^ ^59.6^^^3160524
"KRN",.402,1356,"%D",0)
^^3^3^3090619^
"KRN",.402,1356,"%D",1,0)
  Used by the Inpatient Medications package to allow the Inpatient
"KRN",.402,1356,"%D",2,0)
Supervisor to tailor various aspects of the package on a ward-by-ward
"KRN",.402,1356,"%D",3,0)
basis.
"KRN",.402,1356,"DR",1,59.6)
.03;S X="";3;.04;.07;.05;.08;7;.12;.19;.16;.2;.15;.18;.11;1;2;.24;4;5;6;8;
"KRN",.402,2244,-1)
0^1
"KRN",.402,2244,0)
PSJ PADE SYSTEM^3160226.1232^^58.7^^^3160810
"KRN",.402,2244,"DR",1,58.7)
I $D(^XUSEC("PSJ PADE ADV",DUZ)) S Y="@0";.01;1;2;2.5;3;3.5//Y;3.6;@0;4;
"KRN",.402,2244,"DR",2,58.74)
.01;S PSJDIV=X;1;5;4.5;3.5;3.7;3.8;N ZZAR;@1;2;S ZZAR=X;I X="N"!(X="") S Y="@2";3;2.1;@2;I $P(^PS(58.7,D0,"DIV",D1,0),U,3)="N"!($P(^PS(58.7,D0,"DIV",D1,0),U,3)="") S $P(^(0),U,4)="",$P(^(0),U,9)="";11;@3;8;@4;K DIE("NO^");12;@5;9;
"KRN",.402,2244,"DR",2,58.74,1)
@6;4;6;@7;10;@8;K DIE("NO^");7;@9;13;@10;
"KRN",.402,2244,"DR",3,58.741)
S ZZAR="",DIE("NO^")="Q";.01;S ZZAR=X S:X="" Y="@8";1;2;K DIE("NO^");I ZZAR]"",X="" W *7,!,"Bed group must be mapped to a PADE Send Area - Incomplete entry...deleting",! S DIK=DIE D ^DIK;
"KRN",.402,2244,"DR",3,58.7412)
.01;S:X="" Y="@5";1;.2;
"KRN",.402,2244,"DR",3,58.7413)
S ZZAR="";.01;S ZZAR=X S:X="" Y="10";1;K DIE("NO^");I ZZAR]"",X="" W *7,!,"Operating Room must be mapped to a PADE Send Area - Incomplete entry...deleting",! S DIK=DIE D ^DIK;
"KRN",.402,2244,"DR",3,58.742)
.01;S:X="" Y="@3";1;.2;
"KRN",.402,2244,"DR",3,58.746)
.01;S:X="" Y="@7";1;
"KRN",.402,2244,"DR",3,58.747)
S ZZAR="";.01;S ZZAR=X S:X="" Y="@9";1;
"KRN",.402,2244,"DR",3,58.748)
S ZZAR="",DIE("NO^")="Q";.01;S ZZAR=X S:X="" Y="@4";1;2;K DIE("NO^");I ZZAR]"",X="" W *7,!,"Clinic group must be mapped to a PADE Send Area - Incomple entry...deleting",! S DIK=DIE D ^DIK;1.1;
"KRN",.402,2244,"DR",3,58.749)
.01;S:X="" Y="@6";1;.2;
"KRN",.402,2244,"DR",4,58.7411)
.01;
"KRN",.402,2244,"DR",4,58.7481)
.01;
"KRN",.402,2245,-1)
0^2
"KRN",.402,2245,0)
PSJ PADE INVENTORY^3160321.1636^@^58.601^^@^3160822
"KRN",.402,2245,"DR",1,58.601)
@1;4;5;6;3;D PSJOE^PSJPADSI;S PSJASKDN=$$ASKDONE^PSJPADSI S Y="@"_PSJASKDN;@2;@3;
"KRN",.402,2245,"DR",2,58.6014)
.01;1;
"KRN",.402,2245,"DR",2,58.6015)
.01;
"KRN",.402,2245,"DR",2,58.6016)
.01;
"KRN",.402,2245,"DR",3,58.60141)
.01;
"KRN",.402,2246,-1)
0^3
"KRN",.402,2246,0)
PSJ PADE DISPENSING DEVICE^3160125.0913^@^58.63^^@^3160705
"KRN",.402,2246,"DIAB",1,1,58.635,0)
ALL
"KRN",.402,2246,"DIAB",1,1,58.636,0)
ALL
"KRN",.402,2246,"DIAB",1,1,58.637,0)
ALL
"KRN",.402,2246,"DIAB",1,1,58.638,0)
ALL
"KRN",.402,2246,"DIAB",11,0,58.63,0)
SEND DWO MESSAGES;REQ
"KRN",.402,2246,"DR",1,58.63)
N PSJPDEV S PSJPDEV=DA;4;D ASKRESET^PSJPADPT(.DA);2;5;6;7;8;10;11;3R~;I $G(X)'=1 S Y="@1";D DWODEV^PSJPADSI(.DA);@1;
"KRN",.402,2246,"DR",2,58.635)
.01
"KRN",.402,2246,"DR",2,58.636)
.01
"KRN",.402,2246,"DR",2,58.637)
.01
"KRN",.402,2246,"DR",2,58.638)
.01
"KRN",.402,2246,"DR",2,58.65)
.01;
"KRN",19,687,-1)
2^6
"KRN",19,687,0)
PSJU MGR^Unit Dose Medications^^M^11908^^^^^^^117^^1^1
"KRN",19,687,10,0)
^19.01IP^41^41
"KRN",19,687,10,41,0)
14226^^
"KRN",19,687,10,41,"^")
PSJ PADE MAIN MENU
"KRN",19,687,"U")
UNIT DOSE MEDICATIONS
"KRN",19,14223,-1)
0^1
"KRN",19,14223,0)
PSJ PADE SETUP^PADE System Setup^^A^^PSJ PADE MGR^^^^^^INPATIENT MEDICATIONS^^1
"KRN",19,14223,1,0)
^19.06^8^8^3150902^^^
"KRN",19,14223,1,1,0)
This option is used to setup the Pharmacy Automated Dispensing Equipment 
"KRN",19,14223,1,2,0)
(PADE) system like Pyxis, Omnicell, AccuDose, etc., which has dispensing
"KRN",19,14223,1,3,0)
cabinets distributed around the VA Medical Centers to stock and dispense
"KRN",19,14223,1,4,0)
drug/non-drug items in Inpatient Wards or Outpatient Clinics. Defining 
"KRN",19,14223,1,5,0)
the wards/clinics associated with a division, and mapping to a PADE 
"KRN",19,14223,1,6,0)
cabinet (location/area), is crucial for VistA to communicate precisely the
"KRN",19,14223,1,7,0)
outbound messages related to ADT, clinic visits, order details, drug 
"KRN",19,14223,1,8,0)
formulary etc.  
"KRN",19,14223,20)
D PADE^PSJPADE
"KRN",19,14223,99.1)
63922,33955
"KRN",19,14223,"U")
PADE SYSTEM SETUP
"KRN",19,14224,-1)
0^10
"KRN",19,14224,0)
PSJ PADE INVENTORY SYSTEM^PADE Inventory System Setup^^A^^PSJ PADE MGR^^^^^^INPATIENT MEDICATIONS^^1
"KRN",19,14224,1,0)
^19.06^3^3^3160415^^^^
"KRN",19,14224,1,1,0)
Pharmacy Automated Dispensing Equipment (PADE) devices must be mapped to 
"KRN",19,14224,1,2,0)
VistA locations for accurate reporting, and to accurately track PADE 
"KRN",19,14224,1,3,0)
inventory.
"KRN",19,14224,20)
D ENSYS^PSJPADSI
"KRN",19,14224,69.1)

"KRN",19,14224,99)
63789,36130
"KRN",19,14224,"U")
PADE INVENTORY SYSTEM SETUP
"KRN",19,14225,-1)
0^3
"KRN",19,14225,0)
PSJ PADE SEND AREA SETUP^PADE Send Area Setup^^A^^PSJ PADE MGR^^^^^^INPATIENT MEDICATIONS^^1
"KRN",19,14225,1,0)
^^3^3^3150902^
"KRN",19,14225,1,1,0)
This option is used to setup the Pharmacy Automated Dispensing Equipment 
"KRN",19,14225,1,2,0)
(PADE) send area, which will help map locations to the cabinets on the 
"KRN",19,14225,1,3,0)
vendor systems.
"KRN",19,14225,20)
D PDSAR^PSJPADE
"KRN",19,14225,"U")
PADE SEND AREA SETUP
"KRN",19,14226,-1)
0^4
"KRN",19,14226,0)
PSJ PADE MAIN MENU^PADE Main Menu^^M^^^^^^^^
"KRN",19,14226,1,0)
^19.06^1^1^3160122^^^^
"KRN",19,14226,1,1,0)
This menu gives access to all PADE functions. 
"KRN",19,14226,10,0)
^19.01IP^7^7
"KRN",19,14226,10,1,0)
14223^SS^2
"KRN",19,14226,10,1,"^")
PSJ PADE SETUP
"KRN",19,14226,10,2,0)
14225^SA^1
"KRN",19,14226,10,2,"^")
PSJ PADE SEND AREA SETUP
"KRN",19,14226,10,4,0)
14228^SC
"KRN",19,14226,10,4,"^")
PSJ PADE SEND SURGERY CASES
"KRN",19,14226,10,5,0)
14230^IN
"KRN",19,14226,10,5,"^")
PSJ PADE INVENTORY MENU
"KRN",19,14226,10,6,0)
14238^RP
"KRN",19,14226,10,6,"^")
PSJ PADE REPORTS MENU
"KRN",19,14226,10,7,0)
14234^SO
"KRN",19,14226,10,7,"^")
PSJ PADE SEND ORDERS
"KRN",19,14226,99)
63939,51534
"KRN",19,14226,"U")
PADE MAIN MENU
"KRN",19,14227,-1)
0^7
"KRN",19,14227,0)
PSJ PADE SURGERY TASK^PADE Surgery Task^^A^^^^^^^^^^1
"KRN",19,14227,1,0)
^19.06^2^2^3160308^^
"KRN",19,14227,1,1,0)
This option can be used to schedule a nightly job to generate HL7 
"KRN",19,14227,1,2,0)
messages of Surgery cases for that day to be sent to a PADE.
"KRN",19,14227,10.1)
PADE Surgery Nightly Job
"KRN",19,14227,20)
S PSJTASK=1 D TASK^PSJPDCLA
"KRN",19,14227,99.1)
63831,33203
"KRN",19,14227,200.9)
y
"KRN",19,14227,"U")
PADE SURGERY TASK
"KRN",19,14228,-1)
0^5
"KRN",19,14228,0)
PSJ PADE SEND SURGERY CASES^PADE Send Surgery Cases^^A^^^^^^^^^^1
"KRN",19,14228,1,0)
^19.06^2^2^3150923^^^
"KRN",19,14228,1,1,0)
This option can be used to send surgery cases manually to a PADE for that
"KRN",19,14228,1,2,0)
date or future date.
"KRN",19,14228,20)
D SRCS^PSJPDCLA
"KRN",19,14228,"U")
PADE SEND SURGERY CASES
"KRN",19,14230,-1)
0^8
"KRN",19,14230,0)
PSJ PADE INVENTORY MENU^PADE Inventory Setup^^M^^PSJ PADE MGR^^^^^^
"KRN",19,14230,1,0)
^^8^8^3160415^
"KRN",19,14230,1,1,0)
This menu contains options used to set up Pharmacy Automated Dispensing 
"KRN",19,14230,1,2,0)
Equipment (PADE) Inbound information. PADE vendor system parameters may 
"KRN",19,14230,1,3,0)
be set, including the activation of the display of  vendor drug item
"KRN",19,14230,1,4,0)
balances in Inpatient Order Entry and the entry of mail groups to which
"KRN",19,14230,1,5,0)
inbound HL7 error messages are sent. Individual PADE dispensing device
"KRN",19,14230,1,6,0)
(cabinet) parameters may also be defined, including initializing the
"KRN",19,14230,1,7,0)
device, activating/inactiving the device, and linking the device to a
"KRN",19,14230,1,8,0)
hospital division and ward or clinic location.
"KRN",19,14230,10,0)
^19.01IP^2^2
"KRN",19,14230,10,1,0)
14224^SYS
"KRN",19,14230,10,1,"^")
PSJ PADE INVENTORY SYSTEM
"KRN",19,14230,10,2,0)
14231^DEV
"KRN",19,14230,10,2,"^")
PSJ PADE DEVICE SETUP
"KRN",19,14230,99)
63924,47622
"KRN",19,14230,"U")
PADE INVENTORY SETUP
"KRN",19,14231,-1)
0^9
"KRN",19,14231,0)
PSJ PADE DEVICE SETUP^PADE Dispensing Device Setup^^A^^PSJ PADE MGR^^^^^^^^1
"KRN",19,14231,20)
D ENCAB^PSJPADSI
"KRN",19,14231,25)

"KRN",19,14231,"U")
PADE DISPENSING DEVICE SETUP
"KRN",19,14234,-1)
0^12
"KRN",19,14234,0)
PSJ PADE SEND ORDERS^PADE Send Patient Orders^^A^^^^^^^^^^1
"KRN",19,14234,1,0)
^19.06^1^1^3151122^^
"KRN",19,14234,1,1,0)
This option is used to send UD/IV orders to PADE.
"KRN",19,14234,20)
D PDORD^PSJPADE
"KRN",19,14234,99)
63861,64209
"KRN",19,14234,"U")
PADE SEND PATIENT ORDERS
"KRN",19,14235,-1)
0^15
"KRN",19,14235,0)
PSJ PADE INVENTORY REPORT^PADE On-Hand Amounts^^R^^^^^^^^
"KRN",19,14235,25)
EN^PSJPDRIN
"KRN",19,14235,"U")
PADE ON-HAND AMOUNTS
"KRN",19,14236,-1)
0^11
"KRN",19,14236,0)
PSJ PADE DIVISION SETUP^PADE System Division Setup^^A^^PSJ PADE ADV^^^^^^^^1
"KRN",19,14236,1,0)
^^2^2^3151121^
"KRN",19,14236,1,1,0)
This option is used to setup the Pharmacy Automated Dispensing
"KRN",19,14236,1,2,0)
Equipment (PADE) system at the division level. 
"KRN",19,14236,20)
D PDUSR^PSJPADE
"KRN",19,14236,99.1)
63922,33922
"KRN",19,14236,"U")
PADE SYSTEM DIVISION SETUP
"KRN",19,14237,-1)
0^13
"KRN",19,14237,0)
PSJ PADE TRANSACTION REPORT^PADE Transaction Report^^R^^^^^^^^^^
"KRN",19,14237,20)

"KRN",19,14237,25)
EN^PSJPDRTR
"KRN",19,14237,99)
63880,67586
"KRN",19,14237,"U")
PADE TRANSACTION REPORT
"KRN",19,14238,-1)
0^16
"KRN",19,14238,0)
PSJ PADE REPORTS MENU^PADE Reports^^M^^^^^^^^
"KRN",19,14238,1,0)
^19.06^6^6^3160415^^
"KRN",19,14238,1,1,0)
This menu contains options to run Pharmacy Automated Dispensing Equipment 
"KRN",19,14238,1,2,0)
(PADE) Inbound inventory reports. The PADE Transaction Report contains
"KRN",19,14238,1,3,0)
information on individual HL7 transactions received from the PADE vendor,
"KRN",19,14238,1,4,0)
and is run for a specific date range. The PADE On Hand Report contains 
"KRN",19,14238,1,5,0)
current inventory information for each drug item stocked in each PADE 
"KRN",19,14238,1,6,0)
dispensing device (cabinet).
"KRN",19,14238,10,0)
^19.01IP^2^2
"KRN",19,14238,10,1,0)
14235^IN^1
"KRN",19,14238,10,1,"^")
PSJ PADE INVENTORY REPORT
"KRN",19,14238,10,2,0)
14237^TR^2
"KRN",19,14238,10,2,"^")
PSJ PADE TRANSACTION REPORT
"KRN",19,14238,99)
63900,52030
"KRN",19,14238,"U")
PADE REPORTS
"KRN",19,14239,-1)
0^17
"KRN",19,14239,0)
PSJ PADE APPOINTMENT TASK^PADE Appointment Task^^A^^^^^^^^^^1
"KRN",19,14239,1,0)
^19.06^4^4^3160229^^^
"KRN",19,14239,1,1,0)
This option can be used to schedule a nightly job to generate HL7 messages
"KRN",19,14239,1,2,0)
of the appointments for that day to sent to a PADE. If the DAYS TO PULL
"KRN",19,14239,1,3,0)
AHEAD FOR BG JOB field in the PADE SYSTEM SETUP file (#58.7) have a value,
"KRN",19,14239,1,4,0)
the appointments for those days will be included in the messages.
"KRN",19,14239,10.1)
PADE Appointment Nightly Job
"KRN",19,14239,20)
D EN^PSJPDAPP
"KRN",19,14239,200.9)
y
"KRN",19,14239,"U")
PADE APPOINTMENT TASK
"KRN",19.1,690,-1)
0^1
"KRN",19.1,690,0)
PSJ PADE MGR
"KRN",19.1,690,1,0)
^^2^2^3160413^
"KRN",19.1,690,1,1,0)
This key is given to Pharmacy users who will need full access to the PSJ 
"KRN",19.1,690,1,2,0)
PADE MAIN MENU including the PADE System setup.
"KRN",19.1,691,-1)
0^2
"KRN",19.1,691,0)
PSJ PADE ADV
"KRN",19.1,691,1,0)
^^4^4^3160413^
"KRN",19.1,691,1,1,0)
This key is given to Pharmacy users in addition to the PSJ PADE MGR key 
"KRN",19.1,691,1,2,0)
to prevent the user from PADE System setup like IP address/port, and to 
"KRN",19.1,691,1,3,0)
allow setting up division specific lower level parameters (i.e. wards and 
"KRN",19.1,691,1,4,0)
clinics) of the PADE system.
"KRN",101,3937,-1)
3^34
"KRN",101,3937,0)
PSJ LM BPI HIDDEN ACTIONS^Brief Patient Info Hidden Actions Menu^^M^^^^^^^^INPATIENT MEDICATIONS
"KRN",101,3937,1,0)
^101.06^3^3^3160105^^^^
"KRN",101,3937,1,1,0)
This is the Hidden Menu that will be attached to the Patient Information
"KRN",101,3937,1,2,0)
list template.  It includes the standard hidden menu item and some extra
"KRN",101,3937,1,3,0)
Inpatient Pharmacy Items felt to be beneficial to the user.
"KRN",101,3937,4)
26
"KRN",101,3937,10,0)
^101.01PA^23^23
"KRN",101,3937,10,23,0)
6146^PD^^
"KRN",101,3937,10,23,"^")
PSJ LM PADE ACTIVITY
"KRN",101,3937,15)
S VALMBCK="R"
"KRN",101,3937,24)

"KRN",101,3937,99)
63900,52030
"KRN",101,3938,-1)
3^30
"KRN",101,3938,0)
PSJ LM PROFILE HIDDEN ACTIONS^Profile Hidden Actions Menu^^M^^^^^^^^INPATIENT MEDICATIONS
"KRN",101,3938,1,0)
^101.06^4^4^3151204^^^^
"KRN",101,3938,1,1,0)
This is the Hidden Menu that will be attached to the List Templates
"KRN",101,3938,1,2,0)
that show pharmacy order profiles.  It includes most of the standard
"KRN",101,3938,1,3,0)
hidden items and some other items Inpatient Pharmacy felt would
"KRN",101,3938,1,4,0)
be beneficial to the user.
"KRN",101,3938,4)
26
"KRN",101,3938,10,0)
^101.01PA^31^31
"KRN",101,3938,10,31,0)
6146^PD^^
"KRN",101,3938,10,31,"^")
PSJ LM PADE ACTIVITY
"KRN",101,3938,15)
S VALMBCK="R"
"KRN",101,3938,20)

"KRN",101,3938,24)

"KRN",101,3938,99)
63900,52030
"KRN",101,6113,-1)
0^27
"KRN",101,6113,0)
PSJ RDEO11 SERVER^^^E^^^^^^^^
"KRN",101,6113,1,0)
^^1^1^3150611^
"KRN",101,6113,1,1,0)
Inpatient - send RDE^011 message.
"KRN",101,6113,15)

"KRN",101,6113,20)

"KRN",101,6113,770)
PSJ VISTA^^RDE^O11^^^^AL^NE^2.4^
"KRN",101,6113,772)

"KRN",101,6113,775,0)
^101.0775PA^1^1
"KRN",101,6113,775,1,0)
6114
"KRN",101,6113,775,1,"^")
PSJ RDEO11 CLIENT
"KRN",101,6114,-1)
0^28
"KRN",101,6114,0)
PSJ RDEO11 CLIENT^^^S^^^^^^^^
"KRN",101,6114,770)
^PSJ PADE SERVER^^O11^^^PSJ PADE^^^^ACK
"KRN",101,6114,773)
1^1^0
"KRN",101,6114,774)

"KRN",101,6118,-1)
0^1
"KRN",101,6118,0)
PSJ ADT-A01 CLIENT^^^S^^^^^^^^
"KRN",101,6118,20)

"KRN",101,6118,770)
^PSJ PADE SERVER^^A01^^^^^^^ACK
"KRN",101,6118,771)

"KRN",101,6118,773)
1^1^
"KRN",101,6118,774)

"KRN",101,6119,-1)
0^4
"KRN",101,6119,0)
PSJ ADT-A02 SERVER^^^E^^^^^^^^
"KRN",101,6119,1,0)
^^2^2^3151224^
"KRN",101,6119,1,1,0)
A modified copy of the A02 message from PIMS (patient transfer) is 
"KRN",101,6119,1,2,0)
created to send to PADE.
"KRN",101,6119,770)
PSJ VISTA^^ADT^A02^^^^AL^NE^2.4^
"KRN",101,6119,775,0)
^101.0775PA^1^1
"KRN",101,6119,775,1,0)
6120
"KRN",101,6119,775,1,"^")
PSJ ADT-A02 CLIENT
"KRN",101,6120,-1)
0^5
"KRN",101,6120,0)
PSJ ADT-A02 CLIENT^^^S^^^^^^^^
"KRN",101,6120,770)
^PSJ PADE SERVER^^A02^^^^^^^ACK
"KRN",101,6120,773)
1^1
"KRN",101,6120,774)

"KRN",101,6121,-1)
0^6
"KRN",101,6121,0)
PSJ ADT-A03 SERVER^^^E^^^^^^^^
"KRN",101,6121,1,0)
^^2^2^3151224^
"KRN",101,6121,1,1,0)
A modified copy of the A03 message from PIMS (patient discharge) is 
"KRN",101,6121,1,2,0)
created to send to PADE.
"KRN",101,6121,770)
PSJ VISTA^^ADT^A03^^^^AL^NE^2.4^
"KRN",101,6121,775,0)
^101.0775PA^1^1
"KRN",101,6121,775,1,0)
6122
"KRN",101,6121,775,1,"^")
PSJ ADT-A03 CLIENT
"KRN",101,6122,-1)
0^7
"KRN",101,6122,0)
PSJ ADT-A03 CLIENT^^^S^^^^^^^^
"KRN",101,6122,770)
^PSJ PADE SERVER^^A03^^^^^^^ACK
"KRN",101,6122,773)
1^1
"KRN",101,6122,774)

"KRN",101,6123,-1)
0^3
"KRN",101,6123,0)
PSJ ADT-A01 SERVER^^^E^^^^^^^^
"KRN",101,6123,1,0)
^^2^2^3151224^
"KRN",101,6123,1,1,0)
A modified copy of the A01 message from PIMS (patient admission) is 
"KRN",101,6123,1,2,0)
created to send to PADE.
"KRN",101,6123,770)
PSJ VISTA^^ADT^A01^^^^AL^NE^2.4^
"KRN",101,6123,775,0)
^101.0775PA^1^1
"KRN",101,6123,775,1,0)
6118
"KRN",101,6123,775,1,"^")
PSJ ADT-A01 CLIENT
"KRN",101,6124,-1)
0^2
"KRN",101,6124,0)
PSJ ADT-A01 ROUTER^^^S^^^^^^^^
"KRN",101,6124,1,0)
^^2^2^3151224^
"KRN",101,6124,1,1,0)
This is the routing protocol for all VAFC ADT events (ADT, cancel ADT
"KRN",101,6124,1,2,0)
& bed switch).
"KRN",101,6124,770)
^PSJ VISTA^^A01^^^^^^^ACK
"KRN",101,6124,774)
D EN^PSJPDCL
"KRN",101,6132,-1)
0^38
"KRN",101,6132,0)
PSJ ADT-A08 CLIENT^^^S^^^^^^^^
"KRN",101,6132,770)
^PSJ PADE SERVER^^A08^^^^^^^ACK
"KRN",101,6132,773)
1^1
"KRN",101,6133,-1)
0^37
"KRN",101,6133,0)
PSJ ADT-A08 SERVER^^^E^^^^^^^^
"KRN",101,6133,1,0)
^^2^2^3151224^
"KRN",101,6133,1,1,0)
A modified copy of the A08 message from PIMS (bed switch) is created to 
"KRN",101,6133,1,2,0)
send to PADE.
"KRN",101,6133,770)
PSJ VISTA^^ADT^A08^^^^AL^NE^2.4^
"KRN",101,6133,775,0)
^101.0775PA^1^1
"KRN",101,6133,775,1,0)
6132
"KRN",101,6133,775,1,"^")
PSJ ADT-A08 CLIENT
"KRN",101,6134,-1)
0^9
"KRN",101,6134,0)
PSJ ADT-A11 CLIENT^^^S^^^^^^^^
"KRN",101,6134,770)
^PSJ PADE SERVER^^A11^^^^^^^ACK
"KRN",101,6134,773)
1^1
"KRN",101,6135,-1)
0^8
"KRN",101,6135,0)
PSJ ADT-A11 SERVER^^^E^^^^^^^^
"KRN",101,6135,1,0)
^^2^2^3151224^
"KRN",101,6135,1,1,0)
A modified copy of the A11 message from PIMS (cancel admission) is 
"KRN",101,6135,1,2,0)
created to send to PADE.
"KRN",101,6135,770)
PSJ VISTA^^ADT^A11^^^^AL^NE^2.4^
"KRN",101,6135,775,0)
^101.0775PA^1^1
"KRN",101,6135,775,1,0)
6134
"KRN",101,6135,775,1,"^")
PSJ ADT-A11 CLIENT
"KRN",101,6136,-1)
0^11
"KRN",101,6136,0)
PSJ ADT-A12 CLIENT^^^S^^^^^^^^
"KRN",101,6136,770)
^PSJ PADE SERVER^^A12^^^^^^^ACK
"KRN",101,6136,773)
1^1
"KRN",101,6137,-1)
0^10
"KRN",101,6137,0)
PSJ ADT-A12 SERVER^^^E^^^^^^^^
"KRN",101,6137,1,0)
^^2^2^3151224^
"KRN",101,6137,1,1,0)
A modified copy of the A12 message from PIMS (cancel transfer) is created 
"KRN",101,6137,1,2,0)
to send to PADE.
"KRN",101,6137,770)
PSJ VISTA^^ADT^A12^^^^AL^NE^2.4^
"KRN",101,6137,775,0)
^101.0775PA^1^1
"KRN",101,6137,775,1,0)
6136
"KRN",101,6137,775,1,"^")
PSJ ADT-A12 CLIENT
"KRN",101,6138,-1)
0^13
"KRN",101,6138,0)
PSJ ADT-A13 CLIENT^^^S^^^^^^^^
"KRN",101,6138,770)
^PSJ PADE SERVER^^A12^^^^^^^ACK
"KRN",101,6138,773)
1^1
"KRN",101,6139,-1)
0^12
"KRN",101,6139,0)
PSJ ADT-A13 SERVER^^^E^^^^^^^^
"KRN",101,6139,1,0)
^^2^2^3151224^
"KRN",101,6139,1,1,0)
A modified copy of the A13 message from PIMS (cancel discharge) is 
"KRN",101,6139,1,2,0)
created to send to PADE.
"KRN",101,6139,770)
PSJ VISTA^^ADT^A13^^^^AL^NE^2.4^
"KRN",101,6139,775,0)
^101.0775PA^1^1
"KRN",101,6139,775,1,0)
6138
"KRN",101,6139,775,1,"^")
PSJ ADT-A13 CLIENT
"KRN",101,6141,-1)
0^26
"KRN",101,6141,0)
PSJ PADE OMS-O05 SUB^Process OMS_O05 from PADE system.^^S^^^^^^^^INPATIENT MEDICATIONS
"KRN",101,6141,1,0)
^^3^3^3151218^
"KRN",101,6141,1,1,0)
This protocol processes HL7 messages received from Pharmacy Automated 
"KRN",101,6141,1,2,0)
Dispensing Equipment (PADE) containing dispensing cabinet activity. This 
"KRN",101,6141,1,3,0)
protocol subscribes to the PSJ PADE OMS-O05 EVENT protocol.
"KRN",101,6141,4)
^^^
"KRN",101,6141,99)
63900,52030
"KRN",101,6141,770)
^PSJ VISTA^^O05^^^^^^^ACK
"KRN",101,6141,771)
D OMS^PSJPAD7I(HLMTIENS,HLMTIEN)
"KRN",101,6141,773)
^^0
"KRN",101,6142,-1)
0^25
"KRN",101,6142,0)
PSJ PADE OMS-O05 EVENT^Inbound OMS_O05 triggered from PADE system.^^E^^^^^^^^
"KRN",101,6142,1,0)
^^4^4^3151218^
"KRN",101,6142,1,1,0)
This protocol represents the trigger event on the Pharmacy Automated 
"KRN",101,6142,1,2,0)
Dispensing Equipment (PADE) system when pocket activity occurs at a 
"KRN",101,6142,1,3,0)
dispensing device. A Stock Requisition Order message OMS^O05 is sent from
"KRN",101,6142,1,4,0)
the PADE system and processed by subscriber protocol PSJ PAD OMS_O05 SUB.
"KRN",101,6142,99)
63900,52030
"KRN",101,6142,770)
PSJ PADE SERVER^^OMS^O05^155^^^AL^NE^2.5^
"KRN",101,6142,775,0)
^101.0775PA^1^1
"KRN",101,6142,775,1,0)
6141
"KRN",101,6142,775,1,"^")
PSJ PADE OMS-O05 SUB
"KRN",101,6146,-1)
0^29
"KRN",101,6146,0)
PSJ LM PADE ACTIVITY^PADE Activity^^A^^^^^^^^INPATIENT MEDICATIONS
"KRN",101,6146,1,0)
^^5^5^3151218^
"KRN",101,6146,1,1,0)
This displays all Pharamcy Automated Dispensing Equipment (PADE) activity
"KRN",101,6146,1,2,0)
for the current patient. The display includes the Date and Time the 
"KRN",101,6146,1,3,0)
activity occured, the type of activity, the drug item, the quantity, and 
"KRN",101,6146,1,4,0)
the PADE cabinet/dispensing device. This hidden action is available in
"KRN",101,6146,1,5,0)
Inpatient Order Entry.
"KRN",101,6146,10,0)
^101.01PA
"KRN",101,6146,20)
D PADECK^PSJPADPT
"KRN",101,6146,99)
63900,52030
"KRN",101,6149,-1)
0^32
"KRN",101,6149,0)
PSJ SIU-S12 SERVER^^^E^^^^^^^^
"KRN",101,6149,1,0)
^^2^2^3151113^
"KRN",101,6149,1,1,0)
Clinic appointments/Surgery bookings will generate S12 type HL7 messages 
"KRN",101,6149,1,2,0)
as part of the nightly scheduled job.
"KRN",101,6149,770)
PSJ VISTA^^SIU^S12^^^^AL^NE^2.4^
"KRN",101,6149,775,0)
^101.0775PA^1^1
"KRN",101,6149,775,1,0)
6150
"KRN",101,6149,775,1,"^")
PSJ SIU-S12 CLIENT
"KRN",101,6150,-1)
0^31
"KRN",101,6150,0)
PSJ SIU-S12 CLIENT^^^S^^^^^^^^
"KRN",101,6150,770)
^PSJ PADE SERVER^^S12^^^PSJ PADE^^^^ACK
"KRN",101,6150,773)
1^1
"KRN",101,6154,-1)
0^33
"KRN",101,6154,0)
PSJ SIU-SDAM ROUTER^^^S^^^^^^^^
"KRN",101,6154,1,0)
^^2^2^3151224^
"KRN",101,6154,1,1,0)
This is the routing protocol for Scheduling event (patient appointment
"KRN",101,6154,1,2,0)
check-in).
"KRN",101,6154,770)
^PSJ VISTA^^S12^^^^^^^ACK
"KRN",101,6154,773)
0^0
"KRN",101,6154,774)
D EN^PSJPDCLA
"KRN",101,6155,-1)
0^39
"KRN",101,6155,0)
PSJ PADE OMS-O05 EVENT 2.3^Process OMS_O05 v2.3 from PADE.^^E^^^^^^^^
"KRN",101,6155,99)
63901,82020
"KRN",101,6155,770)
PSJ PADE SERVER^^OMS^O05^155^^^AL^NE^2.3^
"KRN",101,6155,775,0)
^101.0775PA^1^1
"KRN",101,6155,775,1,0)
6156
"KRN",101,6155,775,1,"^")
PSJ PADE OMS-O05 SUB 2.3
"KRN",101,6156,-1)
0^40
"KRN",101,6156,0)
PSJ PADE OMS-O05 SUB 2.3^Process OMS_O05 v2.3 from PADE.^^S^^^^^^^^INPATIENT MEDICATIONS
"KRN",101,6156,99)
63901,71229
"KRN",101,6156,770)
^PSJ VISTA^^O05^^^^^^^ACK
"KRN",101,6156,771)
D OMS^PSJPAD7I(HLMTIENS,HLMTIEN)
"KRN",101,6156,773)
^^0
"KRN",771,234,-1)
0^1
"KRN",771,234,0)
PSJ VISTA^a^^^^^USA
"KRN",771,234,"EC")
~^\&
"KRN",771,234,"FS")
|
"KRN",771,234,"MSG",0)
^771.06P^1^1
"KRN",771,234,"MSG",1,0)
MSA
"KRN",771,234,"MSG",1,"R")
NONE
"KRN",771,234,"SEG",0)
^771.05P^12^12
"KRN",771,234,"SEG",1,0)
RQD
"KRN",771,234,"SEG",1,"F")
1-12
"KRN",771,234,"SEG",2,0)
AL1
"KRN",771,234,"SEG",2,"F")
1,2,3,4,5,6,7,8,9,10
"KRN",771,234,"SEG",3,0)
FT1
"KRN",771,234,"SEG",3,"F")
1-23
"KRN",771,234,"SEG",4,0)
MFE
"KRN",771,234,"SEG",4,"F")
1-8
"KRN",771,234,"SEG",5,0)
MFI
"KRN",771,234,"SEG",5,"F")
1-6
"KRN",771,234,"SEG",6,0)
NTE
"KRN",771,234,"SEG",6,"F")
1-6
"KRN",771,234,"SEG",7,0)
ORC
"KRN",771,234,"SEG",7,"F")
1-19
"KRN",771,234,"SEG",8,0)
PID
"KRN",771,234,"SEG",8,"F")
1-18
"KRN",771,234,"SEG",9,0)
PV1
"KRN",771,234,"SEG",9,"F")
1-3
"KRN",771,234,"SEG",10,0)
RXC
"KRN",771,234,"SEG",10,"F")
1-6
"KRN",771,234,"SEG",11,0)
RXE
"KRN",771,234,"SEG",11,"F")
1-26
"KRN",771,234,"SEG",12,0)
RXR
"KRN",771,234,"SEG",12,"F")
1
"KRN",771,235,-1)
0^2
"KRN",771,235,0)
PSJ PADE SERVER^a^^^^^USA
"KRN",771,235,"EC")
~^\&
"KRN",771,235,"FS")
|
"KRN",771,235,"SEG",0)
^771.05P
"KRN",870,261,-1)
0^1
"KRN",870,261,0)
PSJ PADE^^TCP^^^^^^^^^^^^^^^^^^10
"KRN",870,261,200)
^5^^^^^^^^
"KRN",870,261,400)
^^C^^^^^^
"KRN",8989.51,783,-1)
0^1
"KRN",8989.51,783,0)
PSJ PADE OE BALANCES^DISPLAY PADE BALANCES IN ORDER ENTRY^0^^DISPLAY PADE INDICATORS IN IOE?
"KRN",8989.51,783,1)
S^1:YES;0:NO^Enter YES to display PADE device drug balances in Inpatient Order Entry.
"KRN",8989.51,783,20,0)
^8989.512^2^2^3160510^^^^
"KRN",8989.51,783,20,1,0)
This activates or deactivates the display of PADE drug balances when 
"KRN",8989.51,783,20,2,0)
doing Dispense Drug lookups in Inpatient Order Entry.
"KRN",8989.51,783,30,0)
^8989.513I^2^2
"KRN",8989.51,783,30,1,0)
1^4.2
"KRN",8989.51,783,30,2,0)
2^4
"MBREQ")
0
"ORD",3,19.1)
19.1;3;;;KEY^XPDTA1;KEYF1^XPDIA1;KEYE1^XPDIA1;KEYF2^XPDIA1;;KEYDEL^XPDIA1
"ORD",3,19.1,0)
SECURITY KEY
"ORD",7,.402)
.402;7;;;EDEOUT^DIFROMSO(.402,DA,"",XPDA);FPRE^DIFROMSI(.402,"",XPDA);EPRE^DIFROMSI(.402,DA,$E("N",$G(XPDNEW)),XPDA,"",OLDA);;EPOST^DIFROMSI(.402,DA,"",XPDA);DEL^DIFROMSK(.402,"",%)
"ORD",7,.402,0)
INPUT TEMPLATE
"ORD",13,870)
870;13;1;;HLLL^XPDTA1;;HLLLE^XPDIA1;;;HLLLDEL^XPDIA1(%)
"ORD",13,870,0)
HL LOGICAL LINK
"ORD",14,771)
771;14;;;HLAP^XPDTA1;HLAPF1^XPDIA1;HLAPE1^XPDIA1;HLAPF2^XPDIA1;;HLAPDEL^XPDIA1(%)
"ORD",14,771,0)
HL7 APPLICATION PARAMETER
"ORD",15,101)
101;15;;;PRO^XPDTA;PROF1^XPDIA;PROE1^XPDIA;PROF2^XPDIA;;PRODEL^XPDIA
"ORD",15,101,0)
PROTOCOL
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"ORD",20,8989.51)
8989.51;20;;;PAR1E1^XPDTA2;PAR1F1^XPDIA3;PAR1E1^XPDIA3;PAR1F2^XPDIA3;;PAR1DEL^XPDIA3(%)
"ORD",20,8989.51,0)
PARAMETER DEFINITION
"PKG",197,-1)
1^1
"PKG",197,0)
INPATIENT MEDICATIONS^PSJ^UNIT DOSE AND IVS
"PKG",197,20,0)
^9.402P^^
"PKG",197,22,0)
^9.49I^1^1
"PKG",197,22,1,0)
5.0^2971215^2980917^11712
"PKG",197,22,1,"PAH",1,0)
317^3160825^11943
"PKG",197,22,1,"PAH",1,1,0)
^^217^217^3160825
"PKG",197,22,1,"PAH",1,1,1,0)
The Pharmacy Interface Automation Project (PIA) will provide a new
"PKG",197,22,1,"PAH",1,1,2,0)
standard bi-directional Health Level Seven (HL7) to the Pharmacy
"PKG",197,22,1,"PAH",1,1,3,0)
Automated Dispensing Equipment (PADE) server. The PADE will route the
"PKG",197,22,1,"PAH",1,1,4,0)
message to a cabinet located at the point of care areas such as Inpatient
"PKG",197,22,1,"PAH",1,1,5,0)
wards, Outpatient Clinics etc.
"PKG",197,22,1,"PAH",1,1,6,0)
 
"PKG",197,22,1,"PAH",1,1,7,0)
The following two patches are provided for this project:
"PKG",197,22,1,"PAH",1,1,8,0)
  PSJ*5*317 - Inpatient Medications V. 5.0.
"PKG",197,22,1,"PAH",1,1,9,0)
  PSS*1*193 - Pharmacy Data Management V. 1.0.
"PKG",197,22,1,"PAH",1,1,10,0)
 
"PKG",197,22,1,"PAH",1,1,11,0)
Note: The patches should be installed in the order listed above as the 
"PKG",197,22,1,"PAH",1,1,12,0)
logical link, PSJ PADE used in the PSS patch is transported in the PSJ
"PKG",197,22,1,"PAH",1,1,13,0)
patch.
"PKG",197,22,1,"PAH",1,1,14,0)
 
"PKG",197,22,1,"PAH",1,1,15,0)
1.  The following new files were created:
"PKG",197,22,1,"PAH",1,1,16,0)
    PADE SYSTEM SETUP file (#58.7)
"PKG",197,22,1,"PAH",1,1,17,0)
    PADE SEND AREA file (#58.71)
"PKG",197,22,1,"PAH",1,1,18,0)
    PADE OUTBOUND MESSAGES file (#58.72)
"PKG",197,22,1,"PAH",1,1,19,0)
    PADE INVENTORY SYSTEM file (#58.601) 
"PKG",197,22,1,"PAH",1,1,20,0)
    PADE INBOUND TRANSACTIONS file (#58.6)
"PKG",197,22,1,"PAH",1,1,21,0)
    PADE DISPENSING DEVICE file (#58.63)
"PKG",197,22,1,"PAH",1,1,22,0)
    PADE USER file (#58.64)
"PKG",197,22,1,"PAH",1,1,23,0)
    
"PKG",197,22,1,"PAH",1,1,24,0)
2.  A new menu, PADE Main Menu [PSJ PADE MAIN MENU], with the following
"PKG",197,22,1,"PAH",1,1,25,0)
    options was created:
"PKG",197,22,1,"PAH",1,1,26,0)
    PADE Send Area Setup [PSJ PADE SEND AREA SETUP] option
"PKG",197,22,1,"PAH",1,1,27,0)
    PADE System Setup [PSJ PADE SETUP] option
"PKG",197,22,1,"PAH",1,1,28,0)
    PADE Send Surgery Cases [PSJ PADE SEND SURGERY CASES] option
"PKG",197,22,1,"PAH",1,1,29,0)
    PADE Send Patient Orders [PSJ PADE SEND ORDERS] option
"PKG",197,22,1,"PAH",1,1,30,0)
    PADE Inventory Setup [PSJ PADE INVENTORY MENU] option
"PKG",197,22,1,"PAH",1,1,31,0)
       ...Inventory System Setup [PSJ PADE INVENTORY SYSTEM] option
"PKG",197,22,1,"PAH",1,1,32,0)
       ...Dispensing Device Setup [PSJ PADE DEVICE SETUP] option
"PKG",197,22,1,"PAH",1,1,33,0)
    PADE Reports [PSJ PADE REPORTS MENU] option
"PKG",197,22,1,"PAH",1,1,34,0)
       ...PADE On-Hand Amounts [PSJ PADE INVENTORY REPORT] option
"PKG",197,22,1,"PAH",1,1,35,0)
       ...PADE Transaction Report [PSJ PADE TRANSACTION REPORT] option
"PKG",197,22,1,"PAH",1,1,36,0)
 
"PKG",197,22,1,"PAH",1,1,37,0)
3.  A new security key, PSJ PADE MGR, was created to allow access to the 
"PKG",197,22,1,"PAH",1,1,38,0)
    above menus noted in item 2.
"PKG",197,22,1,"PAH",1,1,39,0)
 
"PKG",197,22,1,"PAH",1,1,40,0)
4.  The option, PADE System Division Setup [PSJ PADE DIVISION SETUP],
"PKG",197,22,1,"PAH",1,1,41,0)
    was exported as a separate option so that it can be given to an
"PKG",197,22,1,"PAH",1,1,42,0)
    assigned user to set up a division under a PADE.
"PKG",197,22,1,"PAH",1,1,43,0)
 
"PKG",197,22,1,"PAH",1,1,44,0)
5.  A new security key, PSJ PADE ADV, was created to allow access to the 
"PKG",197,22,1,"PAH",1,1,45,0)
    above option noted in item 4.
"PKG",197,22,1,"PAH",1,1,46,0)
 
"PKG",197,22,1,"PAH",1,1,47,0)
6.  The option, PADE Surgery Task [PSJ PADE SURGERY TASK], was exported as
"PKG",197,22,1,"PAH",1,1,48,0)
    a standalone option so that sites can schedule it as a recurring task.
"PKG",197,22,1,"PAH",1,1,49,0)
 
"PKG",197,22,1,"PAH",1,1,50,0)
7.  The option, PADE Appointment Task [PSJ PADE APPOINTMENT TASK], was
"PKG",197,22,1,"PAH",1,1,51,0)
    exported as a standalone option so that sites can schedule it as a
"PKG",197,22,1,"PAH",1,1,52,0)
    recurring task.
"PKG",197,22,1,"PAH",1,1,53,0)
 
"PKG",197,22,1,"PAH",1,1,54,0)
8.  Two HL7 application parameters, PSJ VISTA and PSJ PADE SERVER, were
"PKG",197,22,1,"PAH",1,1,55,0)
    created for site specific information.
"PKG",197,22,1,"PAH",1,1,56,0)
 
"PKG",197,22,1,"PAH",1,1,57,0)
9.  One Logical Link, PSJ PADE, was created to support the Outbound HL7
"PKG",197,22,1,"PAH",1,1,58,0)
    messages.
"PKG",197,22,1,"PAH",1,1,59,0)
 
"PKG",197,22,1,"PAH",1,1,60,0)
10. The following protocols were created to receive and send outbound
"PKG",197,22,1,"PAH",1,1,61,0)
    Admission, Discharge and Transfer (ADT) events:
"PKG",197,22,1,"PAH",1,1,62,0)
    PSJ ADT-A01 ROUTER
"PKG",197,22,1,"PAH",1,1,63,0)
    PSJ ADT-A01 SERVER - Admission event
"PKG",197,22,1,"PAH",1,1,64,0)
    PSJ ADT-A01 CLIENT
"PKG",197,22,1,"PAH",1,1,65,0)
    PSJ ADT-A02 SERVER - Transfer event
"PKG",197,22,1,"PAH",1,1,66,0)
    PSJ ADT-A02 CLIENT
"PKG",197,22,1,"PAH",1,1,67,0)
    PSJ ADT-A03 SERVER - Discharge event 
"PKG",197,22,1,"PAH",1,1,68,0)
    PSJ ADT-A03 CLIENT
"PKG",197,22,1,"PAH",1,1,69,0)
    PSJ ADT-A08 SERVER - Demographic changes
"PKG",197,22,1,"PAH",1,1,70,0)
    PSJ ADT-A08 CLIENT
"PKG",197,22,1,"PAH",1,1,71,0)
    PSJ ADT-A11 SERVER - Cancel Admission event
"PKG",197,22,1,"PAH",1,1,72,0)
    PSJ ADT-A11 CLIENT
"PKG",197,22,1,"PAH",1,1,73,0)
    PSJ ADT-A12 SERVER - Cancel Transfer event
"PKG",197,22,1,"PAH",1,1,74,0)
    PSJ ADT-A12 CLIENT
"PKG",197,22,1,"PAH",1,1,75,0)
    PSJ ADT-A13 SERVER - Cancel Discharge event
"PKG",197,22,1,"PAH",1,1,76,0)
    PSJ ADT-A13 CLIENT
"PKG",197,22,1,"PAH",1,1,77,0)
 
"PKG",197,22,1,"PAH",1,1,78,0)
    PSJ ADT-A01 ROUTER is setup as a subscribing protocol to VAFC ADT-A01 
"PKG",197,22,1,"PAH",1,1,79,0)
    SERVER, VAFC ADT-A02 SERVER, VAFC ADT-A03 SERVER, VAFC ADT-A08 SERVER,
"PKG",197,22,1,"PAH",1,1,80,0)
    VAFC ADT-A08-TSP SERVER (bed switch), VAFC ADT-A11 SERVER, VAFC
"PKG",197,22,1,"PAH",1,1,81,0)
    ADT-A12 SERVER, VAFC ADT-A13 SERVER.
"PKG",197,22,1,"PAH",1,1,82,0)
 
"PKG",197,22,1,"PAH",1,1,83,0)
    In the REGISTRATION V. 5.3 package, options like Admit a Patient [DG
"PKG",197,22,1,"PAH",1,1,84,0)
    ADMIT PATIENT], Transfer a Patient [DG TRANSFER PATIENT], Discharge a
"PKG",197,22,1,"PAH",1,1,85,0)
    Patient [DG DISCHARGE PATIENT], Switch Bed [DG BED SWITCH] etc., will
"PKG",197,22,1,"PAH",1,1,86,0)
    trigger appropriate outbound HL7 messages.
"PKG",197,22,1,"PAH",1,1,87,0)
    The routine tied to protocol PSJ ADT-A01 ROUTER that subscribes to 
"PKG",197,22,1,"PAH",1,1,88,0)
    these events (VAFC ADT related protocol) will scan the HL7 message and
"PKG",197,22,1,"PAH",1,1,89,0)
    will build a modified copy of the HL7  message including the Allergy
"PKG",197,22,1,"PAH",1,1,90,0)
    (AL1) and the Observation/Result (OBX) segments. The generated HL7
"PKG",197,22,1,"PAH",1,1,91,0)
    message will be sent to the respective PADE via the Vitria Interface
"PKG",197,22,1,"PAH",1,1,92,0)
    Engine (VIE).
"PKG",197,22,1,"PAH",1,1,93,0)
 
"PKG",197,22,1,"PAH",1,1,94,0)
11. The following protocols were created to receive and send outbound
"PKG",197,22,1,"PAH",1,1,95,0)
    Clinic check-ins and appointments.
"PKG",197,22,1,"PAH",1,1,96,0)
     PSJ SIU-SDAM ROUTER - subscribing protocol to VAFC ADT-A08-SDAM
"PKG",197,22,1,"PAH",1,1,97,0)
     SERVER 
"PKG",197,22,1,"PAH",1,1,98,0)
     PSJ SIU-S12 SERVER - event driver for clinic check-in 
"PKG",197,22,1,"PAH",1,1,99,0)
     PSJ SIU-S12 CLIENT - subscriber 
"PKG",197,22,1,"PAH",1,1,100,0)
 
"PKG",197,22,1,"PAH",1,1,101,0)
    During patient check-in in the Scheduling V. 5.3 package, the 
"PKG",197,22,1,"PAH",1,1,102,0)
    protocol, VAFC ADT-A08-SDAM SERVER builds a standard HL7 message.
"PKG",197,22,1,"PAH",1,1,103,0)
    The routine tied to protocol PSJ SIU-SDAM ROUTER that subscribes
"PKG",197,22,1,"PAH",1,1,104,0)
    to the VAFC ADT-A08-SDAM SERVER, will scan the HL7 message and will
"PKG",197,22,1,"PAH",1,1,105,0)
    build and modify a copy of the HL7 message including the Allergy (AL1)
"PKG",197,22,1,"PAH",1,1,106,0)
    and the Observation/Result (OBX) segments. The generated HL7 message
"PKG",197,22,1,"PAH",1,1,107,0)
    will be sent to the respective PADE via the Vitria Interface Engine
"PKG",197,22,1,"PAH",1,1,108,0)
    (VIE).
"PKG",197,22,1,"PAH",1,1,109,0)
 
"PKG",197,22,1,"PAH",1,1,110,0)
12. The following protocols were created to send outbound order messages
"PKG",197,22,1,"PAH",1,1,111,0)
    in the form of RDE-O11 HL7 messages to the appropriate PADE system.
"PKG",197,22,1,"PAH",1,1,112,0)
    PSJ RDEO11 SERVER
"PKG",197,22,1,"PAH",1,1,113,0)
    PSJ RDEO11 CLIENT
"PKG",197,22,1,"PAH",1,1,114,0)
 
"PKG",197,22,1,"PAH",1,1,115,0)
    In Inpatient Medications, when orders are verified, edited, renewed, 
"PKG",197,22,1,"PAH",1,1,116,0)
    discontinued, reinstated, put on hold/removed from hold, and when 
"PKG",197,22,1,"PAH",1,1,117,0)
    orders are discontinued in Computerized Patient Record System (CPRS)
"PKG",197,22,1,"PAH",1,1,118,0)
    V. 3.0, an outbound HL7 message will be sent to the respective PADE
"PKG",197,22,1,"PAH",1,1,119,0)
    via the Vitria Interface Engine (VIE).
"PKG",197,22,1,"PAH",1,1,120,0)
 
"PKG",197,22,1,"PAH",1,1,121,0)
13. The following protocols were created to receive and process inbound 
"PKG",197,22,1,"PAH",1,1,122,0)
    PADE Activity (e.g., Dispense, Load, etc.) in the form of
"PKG",197,22,1,"PAH",1,1,123,0)
    OMS-O05 HL7 messages:
"PKG",197,22,1,"PAH",1,1,124,0)
    PSJ PADE OMS-O05 EVENT
"PKG",197,22,1,"PAH",1,1,125,0)
    PSJ PADE OMS-O05 SUB
"PKG",197,22,1,"PAH",1,1,126,0)
    PSJ PADE OMS-O05 EVENT 2.3
"PKG",197,22,1,"PAH",1,1,127,0)
    PSJ PADE OMS-O05 SUB 2.3
"PKG",197,22,1,"PAH",1,1,128,0)
 
"PKG",197,22,1,"PAH",1,1,129,0)
    Backward compatible HL7 v2.3 protocols accept and parse current 
"PKG",197,22,1,"PAH",1,1,130,0)
    industry standard Pocket Maintenance (ZPM) segments to facilitate
"PKG",197,22,1,"PAH",1,1,131,0)
    transition to the new PADE standard.
"PKG",197,22,1,"PAH",1,1,132,0)
  
"PKG",197,22,1,"PAH",1,1,133,0)
    Inbound HL7 messages from the PADE vendor are validated and filed into
"PKG",197,22,1,"PAH",1,1,134,0)
    the PADE INBOUND TRANSACTION file (#58.6), which triggers an 
"PKG",197,22,1,"PAH",1,1,135,0)
    automatic update of the inventory information in the PADE INVENTORY
"PKG",197,22,1,"PAH",1,1,136,0)
    SYSTEM file (#58.601).
"PKG",197,22,1,"PAH",1,1,137,0)
 
"PKG",197,22,1,"PAH",1,1,138,0)
 14. A new multiple, DWO MESSAGE ENTITY, has been added to the PADE
"PKG",197,22,1,"PAH",1,1,139,0)
     INVENTORY SYSTEM file (#58.601) to contain mail groups that will
"PKG",197,22,1,"PAH",1,1,140,0)
     receive Mailman messages when PADE drugs are Dispensed Without an
"PKG",197,22,1,"PAH",1,1,141,0)
     Order (DWO). 
"PKG",197,22,1,"PAH",1,1,142,0)
 
"PKG",197,22,1,"PAH",1,1,143,0)
 15. A new multiple, CONFIG ERRORS MAIL GROUPS, has been added to the PADE
"PKG",197,22,1,"PAH",1,1,144,0)
     INVENTORY SYSTEM file (#58.601) to receive error messages when 
"PKG",197,22,1,"PAH",1,1,145,0)
     configuration problems are encountered with Inbound PADE HL7
"PKG",197,22,1,"PAH",1,1,146,0)
     messages.
"PKG",197,22,1,"PAH",1,1,147,0)
 
"PKG",197,22,1,"PAH",1,1,148,0)
 16. A new multiple, DATA ERRORS MAIL GROUPS, has been added to the PADE 
"PKG",197,22,1,"PAH",1,1,149,0)
     INVENTORY SYSTEM file (#58.601) to receive error messages when data 
"PKG",197,22,1,"PAH",1,1,150,0)
     validation problems are encountered with Inbound PADE HL7 messages.
"PKG",197,22,1,"PAH",1,1,151,0)
 
"PKG",197,22,1,"PAH",1,1,152,0)
 17. Inpatient Pharmacy Order Entry screens have been modified to 
"PKG",197,22,1,"PAH",1,1,153,0)
     display PADE inventory information, specifically:
"PKG",197,22,1,"PAH",1,1,154,0)
 
"PKG",197,22,1,"PAH",1,1,155,0)
     a. The Inpatient Pharmacy Order Entry order detail screens
"PKG",197,22,1,"PAH",1,1,156,0)
        will contain a new "PADE" column when displaying Dispense Drugs,
"PKG",197,22,1,"PAH",1,1,157,0)
        containing the PADE inventory availability for the displayed
"PKG",197,22,1,"PAH",1,1,158,0)
        dispense drug. To make room for the PADE inventory information,
"PKG",197,22,1,"PAH",1,1,159,0)
        the message field will continue displaying, but drug classes will
"PKG",197,22,1,"PAH",1,1,160,0)
        no longer display as a FileMan identifier when a list of dispense
"PKG",197,22,1,"PAH",1,1,161,0)
        drug choices are displayed.
"PKG",197,22,1,"PAH",1,1,162,0)
 
"PKG",197,22,1,"PAH",1,1,163,0)
     b. The Inpatient Pharmacy Order Entry Patient Profile screen
"PKG",197,22,1,"PAH",1,1,164,0)
        includes a flag, (PD), indicating whether or not the order
"PKG",197,22,1,"PAH",1,1,165,0)
        contains a drug that is a PADE stock item. If a drug is both a
"PKG",197,22,1,"PAH",1,1,166,0)
        PADE item and a Ward Stock item, the ward stock flag (WS) is
"PKG",197,22,1,"PAH",1,1,167,0)
        combined with the PADE flag (WP).
"PKG",197,22,1,"PAH",1,1,168,0)
 
"PKG",197,22,1,"PAH",1,1,169,0)
 18. A Kernel parameter, PSJ PADE OE BALANCES, has been created to allow
"PKG",197,22,1,"PAH",1,1,170,0)
     each site to control whether or not PADE inventory information
"PKG",197,22,1,"PAH",1,1,171,0)
     displays in the Inpatient Order Entry profile screens and drug
"PKG",197,22,1,"PAH",1,1,172,0)
     lookups. A prompt to set the parameter has been added to the new PSJ
"PKG",197,22,1,"PAH",1,1,173,0)
     PADE INVENTORY Input Template, accessible via the Inventory System
"PKG",197,22,1,"PAH",1,1,174,0)
     Setup [PSJ PADE INVENTORY SYSTEM] option.
"PKG",197,22,1,"PAH",1,1,175,0)
 
"PKG",197,22,1,"PAH",1,1,176,0)
 19. The option, Pick List [PSJU PL], has been modified to include the 
"PKG",197,22,1,"PAH",1,1,177,0)
     drug Internal Entry Number (IEN) field after the drug name and to
"PKG",197,22,1,"PAH",1,1,178,0)
     include the word "PADE" if the medication listed is a PADE stock
"PKG",197,22,1,"PAH",1,1,179,0)
     item.
"PKG",197,22,1,"PAH",1,1,180,0)
 
"PKG",197,22,1,"PAH",1,1,181,0)
 20. A new Protocol, PSJ LM PADE ACTIVITY, has been added to the PSJ LM 
"PKG",197,22,1,"PAH",1,1,182,0)
     PROFILE HIDDEN ACTIONS Protocol to display a new hidden action (PD) 
"PKG",197,22,1,"PAH",1,1,183,0)
     in the Inpatient Pharmacy patient profile screen. The new PD hidden
"PKG",197,22,1,"PAH",1,1,184,0)
     action displays all of the PADE transactions for the patient being
"PKG",197,22,1,"PAH",1,1,185,0)
     displayed.
"PKG",197,22,1,"PAH",1,1,186,0)
 
"PKG",197,22,1,"PAH",1,1,187,0)
 21. The Pre-Exchange DOSES prompt that displays after verifying an 
"PKG",197,22,1,"PAH",1,1,188,0)
     Inpatient Unit Dose order has been modified to default the number of 
"PKG",197,22,1,"PAH",1,1,189,0)
     doses to zero when the drug may be dispensed from PADE, and a message
"PKG",197,22,1,"PAH",1,1,190,0)
     is displayed explaining the drug is a PADE item.
"PKG",197,22,1,"PAH",1,1,191,0)
 
"PKG",197,22,1,"PAH",1,1,192,0)
 22. This patch also provides a log file, PADE OUTBOUND MESSAGES 
"PKG",197,22,1,"PAH",1,1,193,0)
     file (#58.72) of the outbound ADT, SIU and RDE HL7 messages to use 
"PKG",197,22,1,"PAH",1,1,194,0)
     with FileMan for trouble shooting purposes only.
"PKG",197,22,1,"PAH",1,1,195,0)
     Note: The nightly background job (PSGBRJ) has been modified to purge 
"PKG",197,22,1,"PAH",1,1,196,0)
     records older than 30 days.
"PKG",197,22,1,"PAH",1,1,197,0)
 
"PKG",197,22,1,"PAH",1,1,198,0)
Note: This patch also exports a post-install routine PSJ317P that will 
"PKG",197,22,1,"PAH",1,1,199,0)
setup PSJ ADT-A01 ROUTER as a subscribing protocol to VAFC ADT-A01 
"PKG",197,22,1,"PAH",1,1,200,0)
SERVER, VAFC ADT-A02 SERVER, VAFC ADT-A03 SERVER, VAFC ADT-A08 SERVER,
"PKG",197,22,1,"PAH",1,1,201,0)
VAFC ADT-A08-TSP SERVER, VAFC ADT-A11 SERVER, VAFC ADT-A12 SERVER and VAFC
"PKG",197,22,1,"PAH",1,1,202,0)
ADT-A13 SERVER protocols. It will also setup protocol PSJ SIU-SDAM ROUTER
"PKG",197,22,1,"PAH",1,1,203,0)
as a subscribing protocol to VAFC ADT-A08-SDAM SERVER protocol. 
"PKG",197,22,1,"PAH",1,1,204,0)
The post-install also sets the following field to the PSJ PADE entry in 
"PKG",197,22,1,"PAH",1,1,205,0)
the HL LOGICAL LINK file (#870):
"PKG",197,22,1,"PAH",1,1,206,0)
   a. AUTOSTART field (#4.5) is set to 1 (Enabled) so that the PSJ PADE 
"PKG",197,22,1,"PAH",1,1,207,0)
      logical link will be started automatically when Cache or TaskMan is 
"PKG",197,22,1,"PAH",1,1,208,0)
      restarted.
"PKG",197,22,1,"PAH",1,1,209,0)
   b. DO NOT PING field (#24) is set to 1 (Yes) due to the unique aspects
"PKG",197,22,1,"PAH",1,1,210,0)
      of the PADE interface. If PSJ PADE is sent an HLO PING CLIENT 
"PKG",197,22,1,"PAH",1,1,211,0)
      message, an infinite loop will be created consisting of VIE sending
"PKG",197,22,1,"PAH",1,1,212,0)
      VistA additional CR messages and VistA not responding. This 
"PKG",197,22,1,"PAH",1,1,213,0)
      situation requires manual intervention by a member of the VIE
"PKG",197,22,1,"PAH",1,1,214,0)
      National Admins team and therefore needs to be avoided.
"PKG",197,22,1,"PAH",1,1,215,0)
 
"PKG",197,22,1,"PAH",1,1,216,0)
This post-install routine will be deleted from your system upon completion
"PKG",197,22,1,"PAH",1,1,217,0)
of the patch installation.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
31
"RTN","PSGBRJ")
0^31^B21011842^B19761653
"RTN","PSGBRJ",1,0)
PSGBRJ ;BIR/CML3-UD JANITOR (BACKGROUND TASKMAN JOB) ; 6/4/10 9:57am
"RTN","PSGBRJ",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**12,50,244,317**;16 DEC 97;Build 130
"RTN","PSGBRJ",3,0)
 ;
"RTN","PSGBRJ",4,0)
 ; Reference to ^PS(55 is supported by DBIA# 2191.
"RTN","PSGBRJ",5,0)
 ; Reference to ^PS(59.7 is supported by DBIA# 2181.
"RTN","PSGBRJ",6,0)
 ;
"RTN","PSGBRJ",7,0)
LK ; kill off old labels
"RTN","PSGBRJ",8,0)
 D NOW^%DTC S (PSGBRJDT,PSGDT)=%,^PS(53.42,PSGBRJDT,0)=PSGBRJDT,PSJACIVF=1
"RTN","PSGBRJ",9,0)
 F PSGL1=1,2 D
"RTN","PSGBRJ",10,0)
 .F PSGL2=0:0 S PSGL2=$O(^PS(53.41,PSGL1,1,PSGL2)) Q:'PSGL2  D
"RTN","PSGBRJ",11,0)
 ..F PSGL3=0:0 S PSGL3=$O(^PS(53.41,PSGL1,1,PSGL2,1,PSGL3)) Q:'PSGL3  D
"RTN","PSGBRJ",12,0)
 ...S PSGKD=$$LABELDT(PSGL3,PSGDT)
"RTN","PSGBRJ",13,0)
 ...F PSGL4=1,2,3 F PSGL5=0:0 S PSGL5=$O(^PS(53.41,PSGL1,1,PSGL2,1,PSGL3,1,PSGL4,1,PSGL5)) Q:'PSGL5  D
"RTN","PSGBRJ",14,0)
 ....S X=$P($G(^PS(53.41,PSGL1,1,PSGL2,1,PSGL3,1,PSGL4,1,PSGL5,0)),"^",3)
"RTN","PSGBRJ",15,0)
 ....I X<PSGKD K DA S DIK="^PS(53.41,"_PSGL1_",1,"_PSGL2_",1,"_PSGL3_",1,"_PSGL4_",1,",DA(4)=PSGL1,DA(3)=PSGL2,DA(2)=PSGL3,DA(1)=PSGL4,DA=PSGL5 D ^DIK
"RTN","PSGBRJ",16,0)
 ;
"RTN","PSGBRJ",17,0)
AK ; kill off all orders in 53.1 that have gone active (into 55)
"RTN","PSGBRJ",18,0)
 N PSJNO,PSJNOACT,ON100 S PSJNOACT=1
"RTN","PSGBRJ",19,0)
 S DIK="^PS(53.1," F PSGP=0:0 S PSGP=$O(^PS(53.1,"AS","A",PSGP)) Q:'PSGP  F PSJNO=0:0 S PSJNO=$O(^PS(53.1,"AS","A",PSGP,PSJNO)) Q:'PSJNO  S DA=PSJNO D 
"RTN","PSGBRJ",20,0)
 . S ON100=+$P($G(^PS(53.1,DA,0)),U,21) I '$D(^XTMP("ORLK-"_$G(ON100))) D ^DIK ;*PSJ*5*244 - Check for lock
"RTN","PSGBRJ",21,0)
 ;
"RTN","PSGBRJ",22,0)
DE ; kill off de orders in 53.1 that no longer tie to order in 55
"RTN","PSGBRJ",23,0)
 S X="ORX" X ^%ZOSF("TEST") S PSGOERRF=$T
"RTN","PSGBRJ",24,0)
 NEW PSJDA,ON K ^TMP($J)
"RTN","PSGBRJ",25,0)
 F PSGP=0:0 S PSGP=$O(^PS(53.1,"AS","DE",PSGP)) Q:'PSGP  F PSJDA=0:0 S PSJDA=$O(^PS(53.1,"AS","DE",PSGP,PSJDA)) Q:'PSJDA  S ON=$P($G(^PS(53.1,PSJDA,0)),U,26) D
"RTN","PSGBRJ",26,0)
 . I ON["A"!(ON["O")!(ON["U") S:'$D(^PS(55,PSGP,5,+ON,0)) ^TMP($J,PSJDA)=PSGP Q
"RTN","PSGBRJ",27,0)
 . I ON["V" S:'$D(^PS(55,PSGP,"IV",+ON,0)) ^TMP($J,PSJDA)=PSGP Q
"RTN","PSGBRJ",28,0)
 . I '$D(^PS(53.1,+ON,0)) S ^TMP($J,PSJDA)=PSGP Q
"RTN","PSGBRJ",29,0)
 F PSJDA=0:0 S PSJDA=$O(^TMP($J,PSJDA)) Q:'PSJDA  D:$D(^PS(53.1,PSJDA,0)) PDE(PSJDA,^TMP($J,PSJDA))
"RTN","PSGBRJ",30,0)
 K ^TMP($J)
"RTN","PSGBRJ",31,0)
 ;
"RTN","PSGBRJ",32,0)
DK ; kill off dc'd orders in 53.1 around longer than life of labels
"RTN","PSGBRJ",33,0)
 N PSJNOACT S PSJNOACT=1
"RTN","PSGBRJ",34,0)
 S X="ORX" X ^%ZOSF("TEST") S PSGOERRF=$T
"RTN","PSGBRJ",35,0)
 F PSGP=0:0 S PSGP=$O(^PS(53.1,"AS","D",PSGP)) Q:'PSGP  D
"RTN","PSGBRJ",36,0)
 .S PSGKD=$$LABELDT(PSGP,PSGDT) F DA=0:0 S DA=$O(^PS(53.1,"AS","D",PSGP,DA)) Q:'DA  D
"RTN","PSGBRJ",37,0)
 ..S S=$P($G(^PS(53.1,DA,0)),"^",9),ST=$P($G(^(2)),"^",3) I $S(S="U":1,S="P":1,1:ST<PSGKD) D ORPRG:PSGOERRF S DIK="^PS(53.1," D ^DIK
"RTN","PSGBRJ",38,0)
 ;
"RTN","PSGBRJ",39,0)
PLP ; purge pick lists that are filed away and older than auto purge days
"RTN","PSGBRJ",40,0)
 I $D(^PS(59.7,1,63.5)),^(63.5) S X2=-^(63.5),X1=DT D C^%DTC S PSJX=X F Q=0:0 S Q=$O(^PS(53.5,"AO",Q)) Q:'Q  F QQ=0:0 S QQ=$O(^PS(53.5,"AO",Q,QQ)) Q:'QQ!(QQ>PSJX)  S Y=$O(^(QQ,0)) I Y D
"RTN","PSGBRJ",41,0)
 .K DA,DIK,^PS(53.5,"AU",Y) S DIK="^PS(53.5,",DA=Y D ^DIK
"RTN","PSGBRJ",42,0)
 F PSJX=0:0 S PSJX=$O(^PS(53.55,PSJX)) Q:'PSJX  I '$D(^PS(53.5,PSJX)) K DA,DIK S DA=PSJX,DIK="^PS(53.55," D ^DIK
"RTN","PSGBRJ",43,0)
 ;
"RTN","PSGBRJ",44,0)
GLK ; kill off entries in ^PS(53.42) 20 days or more old
"RTN","PSGBRJ",45,0)
 S X1=DT,X2=-20 D C^%DTC F D=0:0 S D=$O(^PS(53.42,D)) Q:'D!(D'<X)  K ^(D)
"RTN","PSGBRJ",46,0)
 ;
"RTN","PSGBRJ",47,0)
UPARAM ; kill off entries in ^PS(53.45) INPATIENT USER PARAMETERS file if there is no corresponding entry in the NEW PERSON file or they have a TERMINATION DATE before today.
"RTN","PSGBRJ",48,0)
 S DA=0 F  S DA=$O(^PS(53.45,DA)) Q:'DA  D
"RTN","PSGBRJ",49,0)
 .I '$D(^VA(200,DA)) S DIK="^PS(53.45," D ^DIK K DIK Q
"RTN","PSGBRJ",50,0)
 .S PSGX=$P(^VA(200,DA,0),"^",11),PSGX=$S(PSGX="":9999999,1:PSGX) I PSGX<DT S DIK="^PS(53.45," D ^DIK K DIK
"RTN","PSGBRJ",51,0)
 ;
"RTN","PSGBRJ",52,0)
NVK ; *PSJ*5*244 - kill discontinued orders from non-verified X-refs
"RTN","PSGBRJ",53,0)
 N DFN,ON,PSGREF,X
"RTN","PSGBRJ",54,0)
 S PSGREF(1)="ANV",PSGREF(2)="APV",PSGREF(3)="ANIV",PSGREF(4)="APIV"
"RTN","PSGBRJ",55,0)
 F X=1:1:4 D
"RTN","PSGBRJ",56,0)
 . F DFN=0:0 S DFN=$O(^PS(55,PSGREF(X),DFN)) Q:'DFN  D
"RTN","PSGBRJ",57,0)
 .. F ON=0:0 S ON=$O(^PS(55,PSGREF(X),DFN,ON)) Q:'ON  D
"RTN","PSGBRJ",58,0)
 ... I $P($G(^PS(55,DFN,5,ON,0)),U,9)["D" K ^PS(55,PSGREF(X),DFN,ON)
"RTN","PSGBRJ",59,0)
 ;
"RTN","PSGBRJ",60,0)
PADE ; *317 - kill messages older than 30 days
"RTN","PSGBRJ",61,0)
 N D,PDT,PDI S X1=DT,X2=-30 D C^%DTC S D=0,PDT=X,DIK="^PS(58.72,"
"RTN","PSGBRJ",62,0)
 F  S D=$O(^PS(58.72,"B",D)) Q:'D!(D>PDT)  D
"RTN","PSGBRJ",63,0)
 .S PDI=0 F  S PDI=$O(^PS(58.72,"B",D,PDI)) Q:'PDI  S DA=PDI D ^DIK
"RTN","PSGBRJ",64,0)
 Q
"RTN","PSGBRJ",65,0)
 ;
"RTN","PSGBRJ",66,0)
DONE ;
"RTN","PSGBRJ",67,0)
 S:$D(ZTQUEUED) ZTREQ="@"
"RTN","PSGBRJ",68,0)
 D NOW^%DTC S $P(^PS(53.42,PSGBRJDT,0),"^",2)=%
"RTN","PSGBRJ",69,0)
 D ENKV^PSGSETU K CA,D,DA,DFN,DIK,DND,GOTO,PSGL1,PSGL2,PSGL3,PSGL4,PSGL4,PSGKD,PSGOERRF,PSGX,PSJACIVF,PSJX,PSGBRJDT,S,ST,X1,X2 Q
"RTN","PSGBRJ",70,0)
 ;
"RTN","PSGBRJ",71,0)
ORPRG ;
"RTN","PSGBRJ",72,0)
 ;*** COMMENT OUT FOR NOW.  NEED TO GET BACK WITH MELANIE TO SEE
"RTN","PSGBRJ",73,0)
 ;*** WHAT TO BE DONE WHEN WE PURGE INPATIENT MEDS ORDERS.  7/19/96.
"RTN","PSGBRJ",74,0)
 ; removed old call to ORX routine!
"RTN","PSGBRJ",75,0)
 Q
"RTN","PSGBRJ",76,0)
LABELDT(PSGP,X1) ; Find patient's ward and get days to keep new labels.
"RTN","PSGBRJ",77,0)
 S X=$G(^DPT(PSGP,.1)),X2=0 I X]"" S X=+$O(^DIC(42,"B",X,0)),X=+$O(^PS(59.6,"B",X,0)),X2=-$P($G(^PS(59.6,X,0)),U,11)
"RTN","PSGBRJ",78,0)
 D C^%DTC
"RTN","PSGBRJ",79,0)
 Q X
"RTN","PSGBRJ",80,0)
 ;
"RTN","PSGBRJ",81,0)
PDE(PSJDA1,PSGP) ;Remove all related pending orders with the "DE" status.
"RTN","PSGBRJ",82,0)
 N DA,DIK,PDE,PSJNUM,PDEFLG,PSJ55,PSJNOACT S (PDEFLG,PSJ55)=0,PSJNOACT=1
"RTN","PSGBRJ",83,0)
 F  S PSJNUM=$P($G(^PS(53.1,PSJDA1,0)),U,25) Q:'+PSJNUM  D  Q:PSJ55
"RTN","PSGBRJ",84,0)
 . I PSJNUM["A"!(PSJNUM["O")!(PSJNUM["U") S PSJ55=1 I $D(^PS(55,PSGP,5,+PSJNUM,0)) S PDEFLG=1 Q
"RTN","PSGBRJ",85,0)
 . I PSJNUM["V" S PSJ55=1 I $D(^PS(55,PSGP,"IV",+PSJNUM,0)) S PDEFLG=1 Q
"RTN","PSGBRJ",86,0)
 . S PDE(PSJDA1)="",PSJDA1=+PSJNUM
"RTN","PSGBRJ",87,0)
 S:'PSJ55 PDE(PSJDA1)=""
"RTN","PSGBRJ",88,0)
 I 'PDEFLG,$O(PDE(0)) F PSJDA1=0:0 S PSJDA1=$O(PDE(PSJDA1)) Q:'PSJDA1  I $D(^PS(53.1,PSJDA1,0)) S DA=PSJDA1 D ORPRG:PSGOERRF S DIK="^PS(53.1,",DA=+PSJDA1 D ^DIK K DA,DIK
"RTN","PSGBRJ",89,0)
 Q
"RTN","PSGBRJ",90,0)
 ;
"RTN","PSGOE7")
0^8^B40214304^B30726260
"RTN","PSGOE7",1,0)
PSGOE7 ;BIR/CML3-SELECT DRUG ;15 MAY 00 / 1:43 PM
"RTN","PSGOE7",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**9,26,34,52,55,50,87,111,181,254,267,260,288,281,317**;16 DEC 97;Build 130
"RTN","PSGOE7",3,0)
 ;
"RTN","PSGOE7",4,0)
 ; Reference to ^PS(50.7 is supported by DBIA 2180
"RTN","PSGOE7",5,0)
 ; Reference to ^PS(59.7 is supported by DBIA 2181
"RTN","PSGOE7",6,0)
 ; Reference to ^PSDRUG( is supported by DBIA 2192
"RTN","PSGOE7",7,0)
 ; Reference to ^PSNAPIS is supported by DBIA 2531
"RTN","PSGOE7",8,0)
 ; Reference to $$GET^XPAR is supported by DBIA 2263
"RTN","PSGOE7",9,0)
 ; Reference to ^VADPT is supported by DBIA 10061
"RTN","PSGOE7",10,0)
 ; Reference to ^TMP("PSODAOC",$J supported by DBIA 6071
"RTN","PSGOE7",11,0)
 ; NFI-UD chgs for FR#: 1
"RTN","PSGOE7",12,0)
 ; 
"RTN","PSGOE7",13,0)
 ;S PSGDICS="U"_$S($D(PSJOERR):",I",1:"")
"RTN","PSGOE7",14,0)
 S PSGDICS="U"
"RTN","PSGOE7",15,0)
 ;
"RTN","PSGOE7",16,0)
AD ; Ask Drug
"RTN","PSGOE7",17,0)
 K PSJDOSE,PSJDOX ;var array use in ^PSJDOSE
"RTN","PSGOE7",18,0)
 K PSGODO,^TMP("PSJINTER",$J) D KILL^PSJBCMA5(+$G(PSJSYSP))
"RTN","PSGOE7",19,0)
 K DIC S DIC="^PS(50.7,",DIC(0)="EMQZVT",D="B^C" I '$P(PSJSYSU,";",4) S DIC("S")="I $$ENOISC^PSJUTL(Y,""U"")"
"RTN","PSGOE7",20,0)
 N PSJTABS,PSJPLTYP,PSJPDLOC
"RTN","PSGOE7",21,0)
 E  D
"RTN","PSGOE7",22,0)
 .I '$D(PSJDGCK) S DIC("T")="",DIC="^PSDRUG(",DIC("S")="I +$G(^PSDRUG(+Y,2)),$P($G(^PSDRUG(+Y,2)),""^"",3)[""U"" S X(1)=+$G(^(""I"")) I $S('X(1):1,1:X(1)>DT)",D="B^C^VAPN^VAC^NDC^XATC"
"RTN","PSGOE7",23,0)
 .I $D(PSJDGCK) S DIC("T")="",DIC="^PSDRUG(",DIC("S")="I +$G(^PSDRUG(+Y,2)),$$GCN^PSGOE7(+Y),$$PKGFLG^PSGOE7($P($G(^PSDRUG(+Y,2)),""^"",3)) S X(1)=+$G(^(""I"")) I $S('X(1):1,1:X(1)>DT)",D="B^C^VAPN^VAC^NDC^XATC"
"RTN","PSGOE7",24,0)
 ;
"RTN","PSGOE7",25,0)
AD1 ;
"RTN","PSGOE7",26,0)
 K PSGORD,PSJORD,PSJALLGY,PSGUSRX,^TMP("PSJINTER",$J),^PS(53.45,+$G(PSJSYSP),5),^PS(53.45,+$G(PSJSYSP),6),PSJPLTYP,PSJPDLOC
"RTN","PSGOE7",27,0)
 K ^TMP("PSODAOC",$J)
"RTN","PSGOE7",28,0)
 S PSGORQF=0 R !!,"Select DRUG: ",X:DTIME I '$T W $C(7) S X="^"
"RTN","PSGOE7",29,0)
 ; -- save off value of X in PSGUSRX so variable can be reliable checked at DO tag
"RTN","PSGOE7",30,0)
 S PSGUSRX=X
"RTN","PSGOE7",31,0)
 I $D(PSJDGCK) I ($G(PSJOCNT)=1&(X="")) D  Q
"RTN","PSGOE7",32,0)
 .W !!,"Not enough active profile drugs to perform drug check",!
"RTN","PSGOE7",33,0)
 .K DIR S DIR(0)="E",DIR("A")="Press Return to Continue..." D ^DIR K DIR W @IOF
"RTN","PSGOE7",34,0)
 I $D(PSJDGCK),X="" N PSGDGCKF S PSGDGCKF=1 G DGCKX
"RTN","PSGOE7",35,0)
 I ("^"[X)!(X="") S PSGORQF=1 G DONE
"RTN","PSGOE7",36,0)
 G:X?1"S."1.E DONE
"RTN","PSGOE7",37,0)
 I X?1."?" W !!?2,"Select the medication you wish the patient to receive." W:PSJSYSU<3 "  You should consult",!,"with your pharmacy before ordering any non-formulary medication." W !
"RTN","PSGOE7",38,0)
 ; PSJ*5*317 - PADE - Define PADE identifier for lookups if kernel parameter turned on
"RTN","PSGOE7",39,0)
 I $$GET^XPAR("SYS","PSJ PADE OE BALANCES") N PSJTABS N:'$G(VAIN(4))&$G(PSGP) VAIN,DFN,PSJTABS D
"RTN","PSGOE7",40,0)
 .N PSJORCL,PSJCLNK K DIC("W")
"RTN","PSGOE7",41,0)
 .I '$G(VAIN(4)),$G(PSGP) S DFN=PSGP D INP^VADPT
"RTN","PSGOE7",42,0)
 .; If clinic order, quit if clinic location is not linked to PADE
"RTN","PSGOE7",43,0)
 .S PSJORCL=$S($G(PSGORD)["P":$G(^PS(53.1,+$G(PSGORD),"DSS")),$G(PSGORD)["U":$G(^PS(55,+$G(PSGP),5,+$G(PSGORD),8)),$G(PSGORD)["V":$G(^PS(55,+$G(PSGP),"IV",+$G(PSGORD),"DSS")),1:"")
"RTN","PSGOE7",44,0)
 .I PSJORCL,$P(PSJORCL,"^",2) S PSJCLNK=$$PADECL^PSJPAD50(+$G(PSJORCL)) Q:'PSJCLNK
"RTN","PSGOE7",45,0)
 .I '$G(PSJCLNK) Q:'$$PADEWD^PSJPAD50(+$G(VAIN(4)))
"RTN","PSGOE7",46,0)
 .S $P(PSJTABS," ",40)=""
"RTN","PSGOE7",47,0)
 .S PSJPLTYP=$S($G(PSJCLNK):"""CL""",1:"""WD"""),PSJPDLOC=$S(PSJPLTYP="CL":+PSJORCL,1:+$G(VAIN(4)))
"RTN","PSGOE7",48,0)
 .S DIC("W")="W $E(PSJTABS,1,(40-$L($S($G(DIY)]"""":$G(DIY),1:$P($G(^PSDRUG(+$G(Y),0)),""^"")))))_""  PADE: ""_$$DRGQTY^PSJPADSI(+Y,"_PSJPLTYP_","_$G(PSJPDLOC)_")_""   ""_$P($G(^PSDRUG(+Y,0)),""^"",10)"
"RTN","PSGOE7",49,0)
 ;
"RTN","PSGOE7",50,0)
 D MIX^DIC1 G:X?1."?" AD1 G:"^"[X!(Y'>0) AD1 S (PSGDO,PSGDRG,PSGDRGN,PSGNEDFD,PSGPDRG,PSGPDRGN)=""
"RTN","PSGOE7",51,0)
 I $D(PSJDGCK) I $$PSJSUPCK^PSJDGCK(+Y) G AD1
"RTN","PSGOE7",52,0)
 ;
"RTN","PSGOE7",53,0)
DGCKX I $P(PSJSYSU,";",4) D  G DO
"RTN","PSGOE7",54,0)
 .S:'$D(PSJDGCK) PSGDRG=+Y,PSGDRGN=Y(0,0)
"RTN","PSGOE7",55,0)
 .S:$D(PSJDGCK)&'$D(PSGDGCKF) PSGDRG=+Y,PSGDRGN=Y(0,0)
"RTN","PSGOE7",56,0)
 .S:$D(PSJDGCK)&$D(PSGDGCKF) PSGDRG=$P($$DGCKIEN^PSJDGCK(),";",2),PSGDRGN=$P($G(^PSDRUG(PSGDRG,0)),U)
"RTN","PSGOE7",57,0)
 .D DIN^PSJDIN(+$G(^PSDRUG(PSGDRG,2)),PSGDRG)
"RTN","PSGOE7",58,0)
 .I '$D(PSJDGCK) I $P(Y(0),"^",9) D NF S:Y>0 PSGDRG=+Y(0),PSGDRGN=Y(0,0) D SNFM
"RTN","PSGOE7",59,0)
 .I $D(PSJDGCK)&'$D(PSGDGCKF) I $P(Y(0),"^",9) D NF S:Y>0 PSGDRG=+Y(0),PSGDRGN=Y(0,0) D SNFM
"RTN","PSGOE7",60,0)
 .S PSGPDRG=+$G(^PSDRUG(PSGDRG,2)),PSGPDRGN=$$OINAME^PSJLMUTL(PSGPDRG)
"RTN","PSGOE7",61,0)
 I '$D(PSJDGCK) S PSGPDRG=+Y,PSGPDRGN=$$OINAME^PSJLMUTL(PSGPDRG)
"RTN","PSGOE7",62,0)
 I $D(PSJDGCK)&'$D(PSGDGCKF) S PSGPDRG=+Y,PSGPDRGN=$$OINAME^PSJLMUTL(PSGPDRG)
"RTN","PSGOE7",63,0)
 ;F Q=1:1:$L(PSGDICS) S X=$P(PSGDICS,",",Q) Q:X=""  S PSJLUAPP=$O(^PS(50.3,PSGPDRG,1,"B",X,0)) I PSJLUAPP S X=$G(^PS(50.3,PSGPDRG,1,PSJLUAPP,0)) Q
"RTN","PSGOE7",64,0)
 S X=$O(^PSDRUG("ASP",PSGPDRG,0)) I X,'$O(^(X)) S PSGDRG=X,PSGDRGN=$$ENDDN^PSGMI(X)
"RTN","PSGOE7",65,0)
 ;
"RTN","PSGOE7",66,0)
DO ; dosage ordered
"RTN","PSGOE7",67,0)
 NEW PSJALLGY
"RTN","PSGOE7",68,0)
 S PSGNEDFD=$$GTNEDFD("U",PSGPDRG)
"RTN","PSGOE7",69,0)
 ; -- if PSGDGCKF is set, CK action is being used and no DRUG was entered, do not set PSJALLGY array
"RTN","PSGOE7",70,0)
 I $G(PSGDRG),$P(PSJSYSU,";",4) S:'$G(PSGDGCKF) PSJALLGY(PSGDRG)=$S($G(PSGUSRX)=""&($G(PSGDRG)):"",1:"P") D ENDDC^PSGSICHK(PSGP,PSGDRG) G:$G(PSGORQF) AD
"RTN","PSGOE7",71,0)
 I '$P(PSJSYSU,";",4) S PSGX=PSGPDRG D END^PSGSICHK G:Y<0 AD
"RTN","PSGOE7",72,0)
 S PSGDO=""
"RTN","PSGOE7",73,0)
 ;
"RTN","PSGOE7",74,0)
DONE ;
"RTN","PSGOE7",75,0)
 K DIC,%,%Y,PSGDICS,PSJLUAPP,Q1,Q2,Q3,Z,PSJALLGY,PSGUSRX Q
"RTN","PSGOE7",76,0)
 ;
"RTN","PSGOE7",77,0)
 ;
"RTN","PSGOE7",78,0)
NF ;
"RTN","PSGOE7",79,0)
 S Y=0 W $C(7),!!,"PLEASE NOTE: The selected item is not currently on your medical center's",!?13,"formulary." Q:'$P(PSJSYSU,";",2)
"RTN","PSGOE7",80,0)
 N CNT S CNT=0 F Q1=0:0 S Q1=$O(^PSDRUG(PSGDRG,65,Q1)) Q:'Q1  I $$CHKDRG(+$G(^(Q1,0))) S CNT=CNT+1
"RTN","PSGOE7",81,0)
 I CNT=0 W !!,"There are no formulary alternatives entered for this item." W:PSJSYSU>2 "  You should consult",!,"with your pharmacy before ordering this item." S Y=0 Q
"RTN","PSGOE7",82,0)
 I CNT=1 S Q1=$O(^PSDRUG(PSGDRG,65,0)),Q1=+$G(^(Q1,0)),Q3=$P(^PSDRUG(Q1,0),"^") W !!,Q3," has been entered as a formulary " W:$X>67 ! W "alternative."
"RTN","PSGOE7",83,0)
 I  F Q=1:1 S %=2 W !!,"Is ",$S(Q=1:"this",1:Q3)," acceptable" D YN^DICN Q:%  D NFOH
"RTN","PSGOE7",84,0)
 I CNT=1 S:%=1 (Y(0),Y)=Q1,Y(0,0)=Q3 S:%<0 Y=-1 Q
"RTN","PSGOE7",85,0)
 K DA,DIC S DA(1)=PSGDRG,DIC="^PSDRUG("_PSGDRG_",65,",DIC(0)="AEMQZ",DIC("A")="Select FORMULARY ALTERNATIVE: " W ! D ^DIC K DIC Q
"RTN","PSGOE7",86,0)
 ;
"RTN","PSGOE7",87,0)
NFOH ;
"RTN","PSGOE7",88,0)
 S X="Answer 'YES' to order this formulary alternative ("_Q3_") for the patient instead of the non-formulary item originally selected.  Answer 'NO' to use the drug originally selected."
"RTN","PSGOE7",89,0)
 W !!?2 F Y=1:1:$L(X," ") S Z=$P(X," ",Y) W:$L(Z)+$X+2>IOM ! W Z," "
"RTN","PSGOE7",90,0)
 Q
"RTN","PSGOE7",91,0)
CHKDRG(DRG) ; Determine if dispense drug is valid for Unit Dose.
"RTN","PSGOE7",92,0)
 I $D(^PSDRUG(DRG,0)),$P($G(^(2)),U,3)["U" S X=+$G(^("I")) I 'X!(X>DT) Q DRG
"RTN","PSGOE7",93,0)
 Q 0
"RTN","PSGOE7",94,0)
 ;
"RTN","PSGOE7",95,0)
SNFM ; show non-formulary message
"RTN","PSGOE7",96,0)
 S Y=1 Q:PSJSYSU=3!'$O(^PS(59.7,1,21,0))  W $C(7),! S Q=0 F  S Q=$O(^PS(59.7,1,21,Q)) Q:'Q  W !,$G(^(Q,0))
"RTN","PSGOE7",97,0)
 W ! D READ^PSJUTL S Y=1 Q
"RTN","PSGOE7",98,0)
 ;
"RTN","PSGOE7",99,0)
GTNEDFD(APP,PDRG) ; Find defaults from Orderable Item.
"RTN","PSGOE7",100,0)
 Q $P($G(^PS(50.7,+PDRG,0)),"^",5,8)
"RTN","PSGOE7",101,0)
 N Q,X S X=""
"RTN","PSGOE7",102,0)
 F Q=1:1:$L(APP) S X=$E(APP,Q) Q:X=""  S X=$O(^PS(50.3,+PDRG,1,"B",X,0)) I X S X=$P($G(^PS(50.3,+PDRG,1,X,0)),"^",5,8) Q
"RTN","PSGOE7",103,0)
 Q X
"RTN","PSGOE7",104,0)
 ;
"RTN","PSGOE7",105,0)
PKGFLG(PKF) ;Return 0 for not in range of acceptable package flags, 1 for within range
"RTN","PSGOE7",106,0)
 I $S(PKF["U":1,1:0) Q 1
"RTN","PSGOE7",107,0)
 I $S(PKF["I":1,1:0) Q 1
"RTN","PSGOE7",108,0)
 Q 0
"RTN","PSGOE7",109,0)
 ;
"RTN","PSGOE7",110,0)
GCN(PSGIENID) ;Return 0 for not matched, 1 for matched with no GCNSEQNO, 1^1 for matched with a GCNSEQNO
"RTN","PSGOE7",111,0)
 N PSGNDFID,PSGGCNPT,PSGGCNID
"RTN","PSGOE7",112,0)
 S PSGNDFID=$P($G(^PSDRUG(PSGIENID,"ND")),"^"),PSGGCNPT=$P($G(^PSDRUG(PSGIENID,"ND")),"^",3)
"RTN","PSGOE7",113,0)
 I 'PSGNDFID!('PSGGCNPT) Q 0
"RTN","PSGOE7",114,0)
 S PSGGCNID=$$PROD0^PSNAPIS(PSGNDFID,PSGGCNPT)
"RTN","PSGOE7",115,0)
 I $P(PSGGCNID,"^",7) Q PSGIENID_";"_PSGNDFID_";"_$P(PSGGCNID,"^",7)
"RTN","PSGOE7",116,0)
 Q PSGIENID_";"_PSGNDFID
"RTN","PSGOE82")
0^9^B33061347^B21878874
"RTN","PSGOE82",1,0)
PSGOE82 ;BIR/CML3-NON-VERIFIED ORDER EDIT (CONT.) ;27 Jan 98 / 9:32 AM
"RTN","PSGOE82",2,0)
 ;;5.0;INPATIENT MEDICATIONS ;**2,35,50,67,58,81,127,168,181,276,317**;16 DEC 97;Build 130
"RTN","PSGOE82",3,0)
 ;
"RTN","PSGOE82",4,0)
 ; Reference to ^DD(53.1 is supported by DBIA #2256.
"RTN","PSGOE82",5,0)
 ; Reference to ^VA(200 is supported by DBIA #10060.
"RTN","PSGOE82",6,0)
 ; Reference to ^DIE is supported by DBIA #10018.
"RTN","PSGOE82",7,0)
 ; Reference to ^DIC is supported by DBIA #10006.
"RTN","PSGOE82",8,0)
 ; Reference to ^DICN is supported by DBIA #10009.
"RTN","PSGOE82",9,0)
 ; Reference to $$GET^XPAR is supported by DBIA #2263
"RTN","PSGOE82",10,0)
 ;
"RTN","PSGOE82",11,0)
1 ; provider
"RTN","PSGOE82",12,0)
 S MSG=0,PSGF2=1 S:PSGOEEF(PSGF2) BACK="1^PSGOE82"
"RTN","PSGOE82",13,0)
A1 I $G(PSGORD)["P",$G(PSGP) I $$LASTREN^PSJLMPRI(PSGP,PSGORD) D  Q
"RTN","PSGOE82",14,0)
 . W !?5,"This order has been renewed. Provider may not be edited at this point. " D PAUSE^VALM1
"RTN","PSGOE82",15,0)
 W !,"PROVIDER: ",$S(PSGPR:PSGPRN_"// ",1:"") R X:DTIME I X="^"!'$T W:'$T $C(7) S PSGOEE=0 G DONE
"RTN","PSGOE82",16,0)
 I $S(X="":'PSGPR,1:X="@") W $C(7),"  (Required)" S X="?" D ENHLP^PSGOEM(53.1,1) G A1
"RTN","PSGOE82",17,0)
 I X="",PSGPR S X=PSGPRN I PSGPR'=PSGPRN,$D(^VA(200,PSGPR,"PS")) W:0 "    "_$P(^("PS"),"^",2)_"    "_$P(^("PS"),"^",3) G DONE
"RTN","PSGOE82",18,0)
 I X?1."?" D ENHLP^PSGOEM(53.1,1)
"RTN","PSGOE82",19,0)
 I $E(X)="^" D ENFF G:Y>0 @Y G A1
"RTN","PSGOE82",20,0)
 K DIC S DIC="^VA(200,",DIC(0)="EMQZ",DIC("S")="I $D(^(""PS"")),^(""PS""),$S('$P(^(""PS""),""^"",4):1,1:$P(^(""PS""),""^"",4)>DT)" D ^DIC K DIC I Y'>0 G A1
"RTN","PSGOE82",21,0)
 S PSGPR=+Y,PSGPRN=Y(0,0) G DONE
"RTN","PSGOE82",22,0)
 ;
"RTN","PSGOE82",23,0)
5 ; self med
"RTN","PSGOE82",24,0)
 S MSG=0,PSGF2=5 S:PSGOEEF(PSGF2) BACK="5^PSGOE82" K PSGOEEF(6) S:PSGSM PSGOEEF(6)=1
"RTN","PSGOE82",25,0)
A5 W !,"SELF MED: " W $P("NO^YES","^",PSGSM+1),"// " R X:DTIME I X="^"!'$T W:'$T $C(7) S PSGOEE=0 G DONE
"RTN","PSGOE82",26,0)
 ;I "01"[X,$L(X)<2 S:PSGSM=""&(X]"") PSGSM=X W:PSGSM]"" "  (",$P("NO^YES","^",PSGSM+1),")" G:'PSGSM DONE S PSGOEEF(6)=1 G 6
"RTN","PSGOE82",27,0)
 I "01"[X,$L(X)<2 S:X]"" PSGSM=+X W:PSGSM]"" "  (",$P("NO^YES","^",PSGSM+1),")" G:'PSGSM DONE S PSGOEEF(6)=1 G 6
"RTN","PSGOE82",28,0)
 I X="@" W $C(7),"  (Required)" G A5
"RTN","PSGOE82",29,0)
 I X?1"^".E D ENFF G:Y>0 @Y G A5
"RTN","PSGOE82",30,0)
 I X?1."?" D ENHLP^PSGOEM(53.1,5) G A5
"RTN","PSGOE82",31,0)
 D YN I  S PSGSM=$E(X)="Y" K PSGOEEF(6) G:'PSGSM DONE S PSGOEEF(6)=1 G 6
"RTN","PSGOE82",32,0)
 W $C(7) D ENHLP^PSGOEM(53.1,5) G A5
"RTN","PSGOE82",33,0)
 ;
"RTN","PSGOE82",34,0)
6 ; hospital supplied self med
"RTN","PSGOE82",35,0)
 S MSG=0,PSGF2=6 S:PSGOEEF(PSGF2) BACK="6^PSGOE82"
"RTN","PSGOE82",36,0)
A6 W !,"HOSPITAL SUPPLIED SELF MED: " W:PSGHSM]"" $P("NO^YES","^",PSGHSM+1),"// " R X:DTIME I X="^"!'$T W:'$T $C(7) S PSGOEE=0 G DONE
"RTN","PSGOE82",37,0)
 I "01"[X,$L(X)=1 S:X]"" PSGHSM=+X W "  (",$P("NO^YES","^",PSGHSM+1),")" S MSG=0,PSGF2=5 G DONE
"RTN","PSGOE82",38,0)
 I X="@" W $C(7),"  (Required)" G A6
"RTN","PSGOE82",39,0)
 I X?1"^".E D ENFF G:Y>0 @Y G A6
"RTN","PSGOE82",40,0)
 I X?1."?" D ENHLP^PSGOEM(53.1,6) G A6
"RTN","PSGOE82",41,0)
 D YN I  S PSGHSM=$E(X)="Y" S MSG=0,PSGF2=5 G DONE
"RTN","PSGOE82",42,0)
 W $C(7) D ENHLP^PSGOEM(53.1,6) G A6
"RTN","PSGOE82",43,0)
 ;
"RTN","PSGOE82",44,0)
2 ; dispense drug multiple
"RTN","PSGOE82",45,0)
 ;*276 - Disallow unauthorized nurses from editing Dispense Drug
"RTN","PSGOE82",46,0)
 I '$P($G(PSJSYSU),";",4) W !,"You are not authorized to edit Dispense Drugs." D PAUSE^VALM1 Q
"RTN","PSGOE82",47,0)
 S MSG=0,PSGF2=2,BACK="2^PSGOE82" K PSGOEEND
"RTN","PSGOE82",48,0)
 N PSGX,PSGXX F PSGXX=0:0 S PSGX=PSGXX,PSGXX=$O(^PS(53.45,PSJSYSP,2,PSGXX)) Q:'PSGXX
"RTN","PSGOE82",49,0)
 N PSJPNDRN I $G(PSGORD) I $E(PSGORD,$L(PSGORD))="P",$P($G(^PS(53.1,+PSGORD,0)),"^",24)="R" S PSJPNDRN=1 D
"RTN","PSGOE82",50,0)
 .S $P(PSJPNDRN,"^",2)="Dispense drugs for renewal orders cannot be deleted, but can be given an INACTIVE DATE.  "
"RTN","PSGOE82",51,0)
 ; PSJ*5*317 - If PSJ PADE OE BALANCES parameter is YES, PADE balances should display as identifier.
"RTN","PSGOE82",52,0)
 N PSJPADLK S PSJPADLK=0  ; Flag indicating PADE drug lookup was done, don't do drug lookup twice - PSJ*5*317
"RTN","PSGOE82",53,0)
 I $$GET^XPAR("SYS","PSJ PADE OE BALANCES") D
"RTN","PSGOE82",54,0)
 .N DA,DIC,DIE,DR,DIR,PSJLOC,PSJDRG,PSJDDC,DFN,PSJORD,PSJPOI,PSJORCL,PSJCLNK,PSJCLND
"RTN","PSGOE82",55,0)
 .; If clinic order, quit if clinic location is not linked to PADE
"RTN","PSGOE82",56,0)
 .S PSJORCL=$S($G(PSGORD)["P":$G(^PS(53.1,+$G(PSGORD),"DSS")),1:"")
"RTN","PSGOE82",57,0)
 .I PSJORCL,$P(PSJORCL,"^",2) S PSJCLNK=$$PADECL^PSJPAD50(+$G(PSJORCL)) Q:'PSJCLNK
"RTN","PSGOE82",58,0)
 .I '$G(PSJCLNK) Q:'$$PADEWD^PSJPAD50(+$G(VAIN(4)))
"RTN","PSGOE82",59,0)
 .I $G(PSGORD) S PSJPOI=+$G(^PS(53.1,+$G(PSGORD),.2))
"RTN","PSGOE82",60,0)
 .S DFN=$G(PSGP),PSJORD=$G(PSGORD)
"RTN","PSGOE82",61,0)
 .S PSJDDC=0 F  S PSJDDC=$O(^PS(53.45,+$G(PSJSYSP),2,PSJDDC)) Q:'PSJDDC  S PSJDRG(PSJDDC)=^(PSJDDC,0) I '$G(PSJPOI) D
"RTN","PSGOE82",62,0)
 ..S PSJPOI=+$G(^PSDRUG(+$G(PSJDRG(PSJDDC)),2))
"RTN","PSGOE82",63,0)
 ..I '$G(PSJPOI),$G(PSGPD),($G(^PS(50.7,+$G(PSGPD),0))]"") S PSJPOI=+PSGPD
"RTN","PSGOE82",64,0)
 .S PSJCLND=$S($G(PSJORD)["U":$G(^PS(55,DFN,5,+PSJORD,8)),$G(PSJORD)["P":$G(^PS(53.1,+PSJORD,"DSS")),1:"")
"RTN","PSGOE82",65,0)
 .S PSJLOC=$S(PSJCLND&$P(PSJCLND,"^",2):+PSJCLND_"C",1:"")
"RTN","PSGOE82",66,0)
 .;S PSJLOC=$S($G(PSJORD)["U":+$G(^PS(55,DFN,5,+PSJORD,8))_"C",$G(PSJORD)["P":+$G(^PS(53.1,+PSJORD,"DSS"))_"C",1:"")
"RTN","PSGOE82",67,0)
 .S:'PSJLOC PSJLOC=+$G(VAIN(4)) I '$G(PSJLOC) D
"RTN","PSGOE82",68,0)
 ..N VAIN D INP^VADPT S PSJLOC=$G(VAIN(4))
"RTN","PSGOE82",69,0)
 .S PSJPADLK=1
"RTN","PSGOE82",70,0)
 .D READDD^PSJPAD50(.PSJDRG,$S($G(PSGPD):+$G(PSGPD),1:+$G(PSJPOI)),PSJLOC,PSJORD,$G(PSGORD))
"RTN","PSGOE82",71,0)
 ; PSJ*5*317 - If PSJ PADE OE BALANCES parameter is NO, PADE balances should NOT display as identifer.
"RTN","PSGOE82",72,0)
 I '$G(PSJPADLK) N DA,DIC,DIE,DR,DIR S DIE="^PS(53.45,",DA=PSJSYSP,DR=2,DR(2,53.4502)=".01;.02"_$S($G(PSJPNDRN):";.03",1:"") D ^DIE
"RTN","PSGOE82",73,0)
 I '$O(^PS(53.45,PSJSYSP,2,0)) W $C(7),!!,"WARNING: This order must have at least one dispense drug before pharmacy can",!?9,"verify it!",! S MSG=1
"RTN","PSGOE82",74,0)
 D DDOC(PSGX)
"RTN","PSGOE82",75,0)
 NEW PSJDOSE
"RTN","PSGOE82",76,0)
 D DOSECHK^PSJDOSE
"RTN","PSGOE82",77,0)
 I +$G(PSJDSFLG) D DSPWARN^PSJDOSE S PSGOEEF(109)=1
"RTN","PSGOE82",78,0)
 G DONE
"RTN","PSGOE82",79,0)
 ;
"RTN","PSGOE82",80,0)
40 ; comments
"RTN","PSGOE82",81,0)
 S MSG=0,PSGF2=40,BACK="40^PSGOE82",DA=PSJSYSP,DR=1,DIE="^PS(53.45," D ^DIE W ! G DONE
"RTN","PSGOE82",82,0)
 ;
"RTN","PSGOE82",83,0)
66 ; provider comments
"RTN","PSGOE82",84,0)
 ;S MSG=0,PSGF2=66,BACK="66^PSGOE82",DA=PSJSYSP,DR=4,DIE="^PS(53.45," D ^DIE W ! G DONE
"RTN","PSGOE82",85,0)
 ;
"RTN","PSGOE82",86,0)
DONE ;
"RTN","PSGOE82",87,0)
 I PSGOEE G:'PSGOEEF(PSGF2) @BACK S PSGOEE=PSGOEEF(PSGF2)
"RTN","PSGOE82",88,0)
 K F,F0,PSGF2,F3,PSG,SDT Q
"RTN","PSGOE82",89,0)
 ;
"RTN","PSGOE82",90,0)
ENFF ; up-arrow to another field
"RTN","PSGOE82",91,0)
 S Y=-1 I '$D(PSGOEEF)!(X?1"^"1.9N) W $C(7),"  ??" Q
"RTN","PSGOE82",92,0)
 S X=$E(X,2,99) I X=+X S Y=$S($D(PSGOEEF(X)):X,1:-1) W "  " W:Y>0 $$CODES2^PSIVUTL(53.1,X) W:Y'>0 $C(7),"??" Q
"RTN","PSGOE82",93,0)
 K DIC S DIC="^DD(53.1,",DIC(0)="QEM",DIC("S")="I $D(PSGOEEF(+Y))" D ^DIC K DIC S Y=+Y S:Y>0 Y=$P($T(@("F"_Y)),";",3) Q
"RTN","PSGOE82",94,0)
 ;
"RTN","PSGOE82",95,0)
DEL ; delete entry
"RTN","PSGOE82",96,0)
 W !?3,"SURE YOU WANT TO DELETE" S %=0 D YN^DICN I %'=1 W $C(7),"  <NOTHING DELETED>"
"RTN","PSGOE82",97,0)
 Q
"RTN","PSGOE82",98,0)
 ;
"RTN","PSGOE82",99,0)
YN ; yes/no as a set of codes
"RTN","PSGOE82",100,0)
 I X'?.U F Y=1:1:$L(X) I $E(X,Y)?1L S X=$E(X,1,Y-1)_$C($A(X,Y)-32)_$E(X,Y+1,$L(X))
"RTN","PSGOE82",101,0)
 F Y="NO","YES" I $P(Y,X)="" W $P(Y,X,2) Q
"RTN","PSGOE82",102,0)
 Q
"RTN","PSGOE82",103,0)
DDOC(PSGX) ; Order check on additional dispense drug for allergy and adv. reactions.
"RTN","PSGOE82",104,0)
 N PSGY,PSGND1,PSGND3,PSJALLGY
"RTN","PSGOE82",105,0)
 S PSGY=0 F  S PSGX=$O(^PS(53.45,PSJSYSP,2,PSGX)) Q:'PSGX  S PSGY=$P($G(^PS(53.45,PSJSYSP,2,PSGX,0)),"^") Q:PSGY=""  D
"RTN","PSGOE82",106,0)
 . N INTERVEN,PSJDDI,PSJIREQ,PSJRXREQ,PSJDD,PSGORQF,PSJPDRG S PSJDD=PSGY
"RTN","PSGOE82",107,0)
 . S Y=1,(PSJIREQ,PSJRXREQ,INTERVEN,X)=""
"RTN","PSGOE82",108,0)
 . I '$G(PSJALGY1) S PSJALLGY(PSJDD)="" D ALLERGY^PSJOC
"RTN","PSGOE82",109,0)
 . ;D IVSOL^PSGSICHK
"RTN","PSGOE82",110,0)
 . I ($D(PSGORQF)) D
"RTN","PSGOE82",111,0)
 .. K ^PS(53.45,PSJSYSP,2,PSGX),^PS(53.45,PSJSYSP,2,"B",PSGY)
"RTN","PSGOE82",112,0)
 Q
"RTN","PSGOE82",113,0)
 ;
"RTN","PSGOE82",114,0)
F101 ;;101^PSGOE8
"RTN","PSGOE82",115,0)
F109 ;;109^PSGOE8
"RTN","PSGOE82",116,0)
F3 ;;3^PSGOE8
"RTN","PSGOE82",117,0)
F7 ;;7^PSGOE8
"RTN","PSGOE82",118,0)
PSGF26 ;;26^PSGOE8
"RTN","PSGOE82",119,0)
F39 ;;39^PSGOE81
"RTN","PSGOE82",120,0)
F8 ;;8^PSGOE81
"RTN","PSGOE82",121,0)
F10 ;;10^PSGOE81
"RTN","PSGOE82",122,0)
PSGF25 ;;25^PSGOE81
"RTN","PSGOE82",123,0)
F1 ;;1^PSGOE82
"RTN","PSGOE82",124,0)
F5 ;;5^PSGOE82
"RTN","PSGOE82",125,0)
PSGF2 ;;2^PSGOE82
"RTN","PSGOE92")
0^10^B43137679^B30935948
"RTN","PSGOE92",1,0)
PSGOE92 ;BIR/CML3 - ACTIVE ORDER EDIT (CONT.) ; 2/18/10 4:15pm
"RTN","PSGOE92",2,0)
 ;;5.0;INPATIENT MEDICATIONS ;**2,35,50,58,81,110,215,237,276,316,317**;16 DEC 97;Build 130
"RTN","PSGOE92",3,0)
 ;
"RTN","PSGOE92",4,0)
 ;Reference to ^DD(53.1 is supported by DBIA #2256.
"RTN","PSGOE92",5,0)
 ;Reference to ^PS(55 is supported by DBIA #2191.
"RTN","PSGOE92",6,0)
 ;Reference to ^PSDRUG is supported by DBIA #2192.
"RTN","PSGOE92",7,0)
 ;Reference to $$GET^XPAR is supported by DBIA #2263
"RTN","PSGOE92",8,0)
 ;
"RTN","PSGOE92",9,0)
1 ; provider
"RTN","PSGOE92",10,0)
 S MSG=0,PSGF2=1 S:PSGOEEF(PSGF2) BACK="1^PSGOE92"
"RTN","PSGOE92",11,0)
A1 I $G(PSJORD),$G(PSGP) I $$COMPLEX^PSJOE(PSGP,PSJORD) S PSGOEE=0 D  G DONE
"RTN","PSGOE92",12,0)
 . W !!?5,"Provider may not be edited for active complex orders." D PAUSE^VALM1
"RTN","PSGOE92",13,0)
 W !,"PROVIDER: ",$S(PSGPR:PSGPRN_"// ",1:"") R X:DTIME I X="^"!'$T W:'$T $C(7) S PSGOEE=0 G DONE
"RTN","PSGOE92",14,0)
 I $S(X="":'PSGPR,1:X="@") W $C(7),"  (Required)" S X="?" D ENHLP^PSGOEM(55.06,1) G A1
"RTN","PSGOE92",15,0)
 I X="",PSGPR S X=PSGPRN I PSGPR'=PSGPRN,$D(^VA(200,PSGPR,"PS")) W:0 "    "_$P(^("PS"),"^",2)_"    "_$P(^("PS"),"^",3) G DONE
"RTN","PSGOE92",16,0)
 I X?1."?" D ENHLP^PSGOEM(55.06,1)
"RTN","PSGOE92",17,0)
 I $E(X)="^" D ENFF G:Y>0 @Y G A1
"RTN","PSGOE92",18,0)
 K DIC S DIC="^VA(200,",DIC(0)="EMQZ",DIC("S")="I $D(^(""PS"")),^(""PS""),$S('$P(^(""PS""),""^"",4):1,1:$P(^(""PS""),""^"",4)>DT)" D ^DIC K DIC I Y'>0 G A1
"RTN","PSGOE92",19,0)
 S PSGPR=+Y,PSGPRN=Y(0,0) G DONE
"RTN","PSGOE92",20,0)
 ;
"RTN","PSGOE92",21,0)
5 ; self med
"RTN","PSGOE92",22,0)
 I $G(PSJORD),$G(PSGP) I $$COMPLEX^PSJOE(PSGP,PSJORD) S PSGOEE=0 D  G DONE
"RTN","PSGOE92",23,0)
 . W !!?5,"Self Med may not be edited for active complex orders." D PAUSE^VALM1
"RTN","PSGOE92",24,0)
 S MSG=0,PSGF2=5 S:PSGOEEF(PSGF2) BACK="5^PSGOE92" K PSGOEEF(6) S:PSGSM PSGOEEF(6)=""
"RTN","PSGOE92",25,0)
A5 W !,"SELF MED: " W:PSGSM]"" $P("NO^YES","^",PSGSM+1),"// " R X:DTIME I X="^"!'$T W:'$T $C(7) S PSGOEE=0 G DONE
"RTN","PSGOE92",26,0)
 I "01"[X,$L(X)<2 S:X]"" PSGSM=+X W:PSGSM]"" "  (",$P("NO^YES","^",PSGSM+1),")" G:'PSGSM DONE S PSGOEEF(6)="" G 6
"RTN","PSGOE92",27,0)
 I X="@" W $C(7),"  (Required)" G A5
"RTN","PSGOE92",28,0)
 I X?1"^".E D ENFF G:Y>0 @Y G A5
"RTN","PSGOE92",29,0)
 I X?1."?" D ENHLP^PSGOEM(55.06,5) G A5
"RTN","PSGOE92",30,0)
 D YN I  S PSGSM=$E(X)="Y" K PSGOEEF(6) G:'PSGSM DONE S PSGOEEF(6)="" G 6
"RTN","PSGOE92",31,0)
 W $C(7) D ENHLP^PSGOEM(55.06,5) G A5
"RTN","PSGOE92",32,0)
 ;
"RTN","PSGOE92",33,0)
6 ; hospital supplied self med
"RTN","PSGOE92",34,0)
 S MSG=0,PSGF2=6 S:PSGOEEF(PSGF2) BACK="6^PSGOE92"
"RTN","PSGOE92",35,0)
A6 I $G(PSJORD),$G(PSGP) I $$COMPLEX^PSJOE(PSGP,PSJORD) S PSGOEE=0 D  G DONE
"RTN","PSGOE92",36,0)
 . W !!?5,"Hospital Supplied Self Med may not be edited for active complex orders." D PAUSE^VALM1
"RTN","PSGOE92",37,0)
 W !,"HOSPITAL SUPPLIED SELF MED: " W:PSGHSM]"" $P("NO^YES","^",PSGHSM+1),"// " R X:DTIME I X="^"!'$T W:'$T $C(7) S PSGOEE=0 G DONE
"RTN","PSGOE92",38,0)
 I "01"[X,$L(X)=1 S:X]"" PSGHSM=+X W "  (",$P("NO^YES","^",PSGHSM+1),")" S MSG=0,PSGF2=5 G DONE
"RTN","PSGOE92",39,0)
 I X="@" W $C(7),"  (Required)" G A6
"RTN","PSGOE92",40,0)
 I X?1"^".E D ENFF G:Y>0 @Y G A6
"RTN","PSGOE92",41,0)
 I X?1."?" D ENHLP^PSGOEM(55.06,6) G A6
"RTN","PSGOE92",42,0)
 D YN I  S PSGHSM=$E(X)="Y" S MSG=0,PSGF2=5 G DONE
"RTN","PSGOE92",43,0)
 W $C(7) D ENHLP^PSGOEM(55.06,6) G A6
"RTN","PSGOE92",44,0)
 ;
"RTN","PSGOE92",45,0)
2 ; dispense drug multiple
"RTN","PSGOE92",46,0)
 ;*276 - Disallow unauthorized nurses from editing Dispense Drug
"RTN","PSGOE92",47,0)
 I '$P($G(PSJSYSU),";",4) W !,"You are not authorized to edit Dispense Drugs." D PAUSE^VALM1 Q
"RTN","PSGOE92",48,0)
 I $G(PSGP),$G(PSGORD) I $$COMPLEX^PSJOE(PSGP,PSGORD) D
"RTN","PSGOE92",49,0)
 . N X,Y,PARENT,P2ND S P2ND=$S(PSGORD["U":$G(^PS(55,PSGP,5,+PSGORD,.2)),1:$G(^PS(53.1,+PSGORD,.2))),PARENT=$P(P2ND,"^",8)
"RTN","PSGOE92",50,0)
 . I PARENT D FULL^VALM1 W !!?5,"This order is part of a complex order. Please review the following ",!?5,"associated orders before changing this order." D CMPLX^PSJCOM1(PSGP,PARENT,PSGORD)
"RTN","PSGOE92",51,0)
 S MSG=0,PSGF2=2,BACK="2^PSGOE92",PSGOEEND=1
"RTN","PSGOE92",52,0)
 NEW PSGX,PSGXX F PSGXX=0:0 S PSGX=PSGXX,PSGXX=$O(^PS(53.45,PSJSYSP,2,PSGXX)) Q:'PSGXX
"RTN","PSGOE92",53,0)
 K PSGXX
"RTN","PSGOE92",54,0)
 ; PSJ*5*317 - If PSJ PADE OE BALANCES parameter is YES, PADE balances should display as identifier.
"RTN","PSGOE92",55,0)
 N PSJPADLK S PSJPADLK=0  ; Flag indicating PADE drug lookup was done, don't do drug lookup twice - PSJ*5*317
"RTN","PSGOE92",56,0)
 I $$GET^XPAR("SYS","PSJ PADE OE BALANCES") D
"RTN","PSGOE92",57,0)
 .N DA,DIC,DIE,DR,DIR,PSJLOC,PSJDRG,PSJDDC,PSJORD,DFN,PSJORCL,PSJCLNK,PSJCLND
"RTN","PSGOE92",58,0)
 .; If clinic order, quit if clinic location is not linked to PADE
"RTN","PSGOE92",59,0)
 .S PSJCLND=$S($G(PSGORD)["P":$G(^PS(53.1,+$G(PSGORD),"DSS")),$G(PSGORD)["U":$G(^PS(55,+$G(PSGP),5,+$G(PSGORD),8)),$G(PSGORD)["V":$G(^PS(55,+$G(PSGP),"IV",+$G(PSGORD),"DSS")),1:"")
"RTN","PSGOE92",60,0)
 .S PSJORCL=$S(PSJCLND&$P(PSJCLND,"^",2):+PSJCLND_"C",1:"")
"RTN","PSGOE92",61,0)
 .;S PSJORCL=$S($G(PSGORD)["P":$G(^PS(53.1,+$G(PSGORD),"DSS")),$G(PSGORD)["U":$G(^PS(55,+$G(PSGP),5,+$G(PSGORD),8)),$G(PSGORD)["V":$G(^PS(55,+$G(PSGP),"IV",+$G(PSGORD),"DSS")),1:"")
"RTN","PSGOE92",62,0)
 .I PSJORCL S PSJCLNK=$$PADECL^PSJPAD50(+$G(PSJORCL)) Q:'PSJCLNK
"RTN","PSGOE92",63,0)
 .I '$G(PSJCLNK) Q:'$$PADEWD^PSJPAD50(+$G(VAIN(4)))
"RTN","PSGOE92",64,0)
 .S DFN=$G(PSGP),PSJORD=$G(PSGORD)
"RTN","PSGOE92",65,0)
 .S PSJDDC=0 F  S PSJDDC=$O(^PS(53.45,PSJSYSP,2,PSJDDC)) Q:'PSJDDC  S PSJDRG(PSJDDC)=^(PSJDDC,0)
"RTN","PSGOE92",66,0)
 .S PSJLOC=$S($G(PSJORD)["U":+$G(^PS(55,DFN,5,+PSJORD,8))_"C",$G(PSJORD)["P":+$G(^PS(53.1,+PSJORD,"DSS"))_"C",1:"")
"RTN","PSGOE92",67,0)
 .S:'PSJLOC PSJLOC=+$G(VAIN(4)) I '$G(PSJLOC) D
"RTN","PSGOE92",68,0)
 ..N VAIN D INP^VADPT S PSJLOC=$G(VAIN(4))
"RTN","PSGOE92",69,0)
 .S PSJPADLK=1
"RTN","PSGOE92",70,0)
 .D READDD^PSJPAD50(.PSJDRG,$G(PSGPDRG),PSJLOC,PSJORD,$G(PSGORD))
"RTN","PSGOE92",71,0)
 ; PSJ*5*317 - If PSJ PADE OE BALANCES parameter is NO, PADE balances should NOT display as identifer.
"RTN","PSGOE92",72,0)
 I '$G(PSJPADLK) N DA,DIE,DR S DIE="^PS(53.45,",DA=PSJSYSP,DR=2,DR(2,53.4502)=".02//1;.03" D ^DIE
"RTN","PSGOE92",73,0)
 I '$O(^PS(53.45,PSJSYSP,2,0)) W $C(7),!!,"WARNING: This order must have at least one dispense drug before pharmacy can",!?9,"verify it!",! S MSG=1
"RTN","PSGOE92",74,0)
 D DDOC^PSGOE82(PSGX) ;* Perform allergy/adv. reaction order checks
"RTN","PSGOE92",75,0)
 NEW PSJDOSE
"RTN","PSGOE92",76,0)
 D DOSECHK^PSJDOSE
"RTN","PSGOE92",77,0)
 I +$G(PSJDSFLG) D DSPWARN^PSJDOSE S:$G(PSGOEEF(109))="" PSGOEEF(109)=1 ; PSJ*5*237 - Check PSGOEEF(109) to prevent infinite loop
"RTN","PSGOE92",78,0)
 ; PSJ*5*215 - If Dispense Drug(s) changed, make entry in Activity Log.
"RTN","PSGOE92",79,0)
 ; Compare the edited dispense drug information in ^PS(53.45 to the active
"RTN","PSGOE92",80,0)
 ; order dispense drug information in ^PS(55.
"RTN","PSGOE92",81,0)
 S (PSJDDTMP,PSJDD55,PSJDTMP1,PSJDD551)=""
"RTN","PSGOE92",82,0)
 F PSJDDTMP=0:0 S PSJDDTMP=$O(^PS(53.45,PSJSYSP,2,PSJDDTMP)) Q:'PSJDDTMP  D
"RTN","PSGOE92",83,0)
 . S PSJDDTMP(PSJDDTMP)=$G(^PS(53.45,PSJSYSP,2,PSJDDTMP,0))
"RTN","PSGOE92",84,0)
 . S PSJDTMP1="Disp Drug: "_"("_$P($G(PSJDDTMP(PSJDDTMP)),"^",1)_") "_$P($G(^PSDRUG($P($G(PSJDDTMP(PSJDDTMP)),"^",1),0)),"^")_" Units: "_$P($G(PSJDDTMP(PSJDDTMP)),"^",2)_" "
"RTN","PSGOE92",85,0)
 F PSJDD55=0:0 S PSJDD55=$O(^PS(55,DFN,5,+ON,1,PSJDD55)) Q:'PSJDD55  D
"RTN","PSGOE92",86,0)
 . S PSJDD55(PSJDD55)=$G(^PS(55,DFN,5,+ON,1,PSJDD55,0))
"RTN","PSGOE92",87,0)
 . S PSJDD551="Disp Drug: "_"("_$P($G(PSJDD55(PSJDD55)),"^",1)_") "_$P($G(^PSDRUG($P($G(PSJDD55(PSJDD55)),"^",1),0)),"^")_" Units: "_$P($G(PSJDD55(PSJDD55)),"^",2)_" "
"RTN","PSGOE92",88,0)
 ; If the two temporary strings PSJDTMP1 and PSJDD551 do not match each other exactly
"RTN","PSGOE92",89,0)
 ; then an edit has been made to the Dispense Drug Field.  Make a new entry in
"RTN","PSGOE92",90,0)
 ; the Activity Log for this order.
"RTN","PSGOE92",91,0)
 I PSJDTMP1'=PSJDD551 D NEWUDAL^PSGAL5(DFN,+ON,6000,"Dispense Drug",PSJDD551)
"RTN","PSGOE92",92,0)
 K PSGOEEND,PSJDDTMP,PSJDTMP1,PSJDD55,PSJDD551 G DONE
"RTN","PSGOE92",93,0)
 ;
"RTN","PSGOE92",94,0)
15 ; comments
"RTN","PSGOE92",95,0)
 I $G(PSJORD),$G(PSGP) I $$COMPLEX^PSJOE(PSGP,PSJORD) S PSGOEE=0 D  G DONE
"RTN","PSGOE92",96,0)
 . W !!?5,"Comments may not be edited for active complex orders." D PAUSE^VALM1
"RTN","PSGOE92",97,0)
 S MSG=0,PSGF2=15,BACK="15^PSGOE92",DA=PSJSYSP,DR=1,DIE="^PS(53.45," D ^DIE W ! G DONE
"RTN","PSGOE92",98,0)
 ;
"RTN","PSGOE92",99,0)
72 ; provider comments
"RTN","PSGOE92",100,0)
 ;
"RTN","PSGOE92",101,0)
DONE ;
"RTN","PSGOE92",102,0)
 I PSGOEE G:'PSGOEEF(PSGF2) @BACK S PSGOEE=PSGOEEF(PSGF2)
"RTN","PSGOE92",103,0)
 K F,F0,PSGF2,F3,PSG,SDT Q
"RTN","PSGOE92",104,0)
 ;
"RTN","PSGOE92",105,0)
ENFF ; up-arrow to another field
"RTN","PSGOE92",106,0)
 S Y=-1 I '$D(PSGOEEF) W $C(7),"  ??" Q
"RTN","PSGOE92",107,0)
 S X=$E(X,2,99) I X=+X S Y=$S($D(PSGOEEF(X)):X,1:-1) W "  " W:Y>0 $$CODES2^PSIVUTL(53.1,X) W:Y'>0 $C(7),"??" Q
"RTN","PSGOE92",108,0)
 K DIC S DIC="^DD(53.1,",DIC(0)="QEM",DIC("S")="I $D(PSGOEEF(+Y))" D ^DIC K DIC S Y=+Y S:Y>0 Y=$P($T(@("F"_Y)),";",3) Q
"RTN","PSGOE92",109,0)
 ;
"RTN","PSGOE92",110,0)
DEL ; delete entry
"RTN","PSGOE92",111,0)
 W !?3,"SURE YOU WANT TO DELETE" S %=0 D YN^DICN I %'=1 W $C(7),"  <NOTHING DELETED>"
"RTN","PSGOE92",112,0)
 Q
"RTN","PSGOE92",113,0)
 ;
"RTN","PSGOE92",114,0)
YN ; yes/no as a set of codes
"RTN","PSGOE92",115,0)
 I X'?.U F Y=1:1:$L(X) I $E(X,Y)?1L S X=$E(X,1,Y-1)_$C($A(X,Y)-32)_$E(X,Y+1,$L(X))
"RTN","PSGOE92",116,0)
 F Y="NO","YES" I $P(Y,X)="" W $P(Y,X,2) Q
"RTN","PSGOE92",117,0)
 Q
"RTN","PSGOE92",118,0)
 ;
"RTN","PSGOE92",119,0)
F101 ;;101^PSGOE9
"RTN","PSGOE92",120,0)
F109 ;;109^PSGOE9
"RTN","PSGOE92",121,0)
F3 ;;3^PSGOE9
"RTN","PSGOE92",122,0)
F7 ;;7^PSGOE9
"RTN","PSGOE92",123,0)
PSGF26 ;;26^PSGOE9
"RTN","PSGOE92",124,0)
F41 ;;41^PSGOE91
"RTN","PSGOE92",125,0)
F8 ;;8^PSGOE91
"RTN","PSGOE92",126,0)
F10 ;;10^PSGOE91
"RTN","PSGOE92",127,0)
F34 ;;34^PSGOE91
"RTN","PSGOE92",128,0)
F1 ;;1^PSGOE92
"RTN","PSGOE92",129,0)
F5 ;;5^PSGOE92
"RTN","PSGOE92",130,0)
PSGF2 ;;2^PSGOE92
"RTN","PSGOEF1")
0^11^B38004561^B30874451
"RTN","PSGOEF1",1,0)
PSGOEF1 ;BIR/CML3-FINISH ORDERS ENTERED THROUGH OE/RR (CONT) ;02 Feb 2001  12:20 PM
"RTN","PSGOEF1",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**2,7,35,39,45,47,50,63,67,58,95,110,186,181,267,315,317**;16 DEC 97;Build 130
"RTN","PSGOEF1",3,0)
 ;
"RTN","PSGOEF1",4,0)
 ; Reference to ^VALM1 is supported by DBIA# 10116.
"RTN","PSGOEF1",5,0)
 ; Reference to ^PS(55 is supported by DBIA 2191.
"RTN","PSGOEF1",6,0)
 ; Reference to ^PSDRUG( is supported by DBIA 2192.
"RTN","PSGOEF1",7,0)
 ; Reference to ^%DTC is supported by DBIA 10000.
"RTN","PSGOEF1",8,0)
 ; Reference to ^%RCR is supported by DBIA 10022.
"RTN","PSGOEF1",9,0)
 ; Reference to ^DIE is supported by DBIA 10018.
"RTN","PSGOEF1",10,0)
 ; Reference to ^DIR is supported by DBIA 10026.
"RTN","PSGOEF1",11,0)
 ;Reference to $$GET^XPAR is supported by DBIA #2263
"RTN","PSGOEF1",12,0)
 ;
"RTN","PSGOEF1",13,0)
UPD ;
"RTN","PSGOEF1",14,0)
 W !!,"...accepting order..."
"RTN","PSGOEF1",15,0)
 I PSGST="",(PSGSCH="NOW"!(PSGSCH="ONCE")) S PSGST="O"
"RTN","PSGOEF1",16,0)
 I PSJCOM D UPD^PSJCOM Q
"RTN","PSGOEF1",17,0)
 K DA,DR S DA=+PSGORD,DIE="^PS(53.1,",DR="28////N;4////U"_";7////"_PSGST_";10////"_PSGSD_";25////"_PSGFD
"RTN","PSGOEF1",18,0)
 I $D(PSGSI),$P($G(^PS(53.1,+PSGORD,0)),U,24)'="R" S ^PS(53.1,DA,6)=PSGSI
"RTN","PSGOEF1",19,0)
 I $D(PSGSI),$P($G(^PS(53.1,+PSGORD,0)),U,24)="R" S $P(^PS(53.1,DA,6),U)=$P(PSGSI,U) I $P(^PS(53.1,DA,6),U)="" S $P(^PS(53.1,DA,6),U,2)=""
"RTN","PSGOEF1",20,0)
 S:PSGOEFF#2 DR=DR_";26////"_PSGSCH
"RTN","PSGOEF1",21,0)
 ;*315 DRP Add removal fields if flag set.
"RTN","PSGOEF1",22,0)
 S:+$G(PSGRF) DR=DR_";137////"_$G(PSGDUR)_";138////"_$G(PSGRMVT)_";139////"_$G(PSGRMV)_";140////"_$G(PSGRF)
"RTN","PSGOEF1",23,0)
 I PSGSM,PSGOHSM'=PSGHSM S DR=DR_";5////"_PSGSM_";6////"_PSGHSM
"RTN","PSGOEF1",24,0)
 D ^DIE W "."
"RTN","PSGOEF1",25,0)
 F Q=1,3 K @(PSGOEEWF_Q_")") S %X="^PS(53.45,"_PSJSYSP_","_$S(Q=1:2,1:1)_",",%Y=PSGOEEWF_Q_"," K @(PSGOEEWF_Q_")") D %XY^%RCR W "."  ;MOU-0100-30945
"RTN","PSGOEF1",26,0)
 S PSGND=$G(^PS(53.1,+PSGORD,0)),X=$P(PSGND,U,24)
"RTN","PSGOEF1",27,0)
 I $S(X="R":1,+$G(^PS(55,PSGP,5.1))>PSGDT:0,1:X'="E") S X=$G(^PS(53.1,DA,2)) D ENWALL^PSGNE3(+$P(X,U,2),+$P(X,U,4),PSGP)
"RTN","PSGOEF1",28,0)
 I $P(PSGND,U,24)="R",$P(PSGND,U,25),PSGSD<$P($G(^PS(55,PSGP,5,+$P(PSGND,U,25),2)),U,4) D
"RTN","PSGOEF1",29,0)
 .K DA,DR S DA(1)=PSGP,DA=+$P(PSGND,U,25),DIE="^PS(55,"_PSGP_",5,",DR="34////"_PSGFD_";25////"_$P($G(^PS(55,PSGP,5,+$P(PSGND,U,25),2)),U,4)
"RTN","PSGOEF1",30,0)
 .S:+$G(PSGRF) DR=DR_";137////"_$G(PSGDUR)_";138////"_$G(PSGRMVT)_";139////"_$G(PSGRMV)_";140////"_$G(PSGRF) ;*315
"RTN","PSGOEF1",31,0)
 .D ^DIE,EN1^PSJHL2(PSGP,"XX",$P(PSGND,U,25))
"RTN","PSGOEF1",32,0)
 S $P(^PS(53.1,+PSGORD,.2),U,2)=PSGDO,$P(^PS(53.1,+PSGORD,2),U,5)=PSGAT S:$G(PSGS0XT) $P(^(2),U,6)=PSGS0XT
"RTN","PSGOEF1",33,0)
 I 'PSGOEAV D NEWNVAL^PSGAL5(PSGORD,$S(+PSJSYSU=3:22005,1:22000))
"RTN","PSGOEF1",34,0)
 I $D(^PS(53.45,+$G(DUZ),5,1,0)) D FILESI^PSJBCMA5(PSGP,PSGORD) N SIARRAY S SIARRAY="" D NEWNVAL^PSGAL5(PSGORD,6000,"SPECIAL INSTRUCTIONS",,.SIARRAY)
"RTN","PSGOEF1",35,0)
 I $D(^PS(53.45,+$G(DUZ),6,1,0)) D FILEOPI^PSJBCMA5(PSGP,PSGORD) N SIARRAY S SIARRAY="" D NEWNVAL^PSGAL5(PSGORD,6000,"OTHER PRINT INFO",,.SIARRAY)
"RTN","PSGOEF1",36,0)
 I PSGOEAV,+$G(PSJSYSU)=3 D VFY^PSGOEV Q
"RTN","PSGOEF1",37,0)
 I PSGOEAV,$G(PSJRNF) D VFY^PSGOEV
"RTN","PSGOEF1",38,0)
 Q
"RTN","PSGOEF1",39,0)
 ;
"RTN","PSGOEF1",40,0)
ENDRG(PSGPDRG,DRGDA) ; enter dispense drug for order w/o one
"RTN","PSGOEF1",41,0)
 NEW PSJALLGY
"RTN","PSGOEF1",42,0)
 K PSGORQF
"RTN","PSGOEF1",43,0)
 D NOW^%DTC K DRG S (DRG,Q)=0 F  S Q=$O(^PSDRUG("ASP",+PSGPDRG,Q)) Q:'Q  I $D(^PSDRUG(Q,0)),$P($G(^(2)),U,3)["U" S X=+$G(^("I")) I 'X!(X>%) S DRG=DRG+1,DRG(DRG)=Q_"^"_^(0)
"RTN","PSGOEF1",44,0)
 I 'DRG W $C(7),!!,"No dispense drugs were found for this order's Orderable Item." K DIR S DIR(0)="E" D ^DIR K DIR S CHK=-1 Q
"RTN","PSGOEF1",45,0)
 S:DRG=1 Y(0)=1
"RTN","PSGOEF1",46,0)
 I DRG>1 D  I 'Y S DRG=0,CHK=-1 Q
"RTN","PSGOEF1",47,0)
 .N PSJPADLK
"RTN","PSGOEF1",48,0)
 .; PSJ*5*317 - If PSJ PADE OE BALANCES parameter is YES, PADE balances should display.
"RTN","PSGOEF1",49,0)
 .I $$GET^XPAR("SYS","PSJ PADE OE BALANCES") D
"RTN","PSGOEF1",50,0)
 ..N DFN,PSJORD,PSJORCL,PSJCLNK S DFN=$G(PSGP),PSJORD=$G(PSGORD)
"RTN","PSGOEF1",51,0)
 ..I '$G(VAIN(4)) N VAIN D INP^VADPT
"RTN","PSGOEF1",52,0)
 ..; If clinic order, quit if clinic location is not linked to PADE
"RTN","PSGOEF1",53,0)
 ..S PSJORCL=$S($G(PSGORD)["P":$G(^PS(53.1,+$G(PSGORD),"DSS")),$G(PSGORD)["U":$G(^PS(55,+$G(PSGP),5,+$G(PSGORD),8)),$G(PSGORD)["V":$G(^PS(55,+$G(PSGP),"IV",+$G(PSGORD),"DSS")),1:"")
"RTN","PSGOEF1",54,0)
 ..I PSJORCL,$P(PSJORCL,"^",2) S PSJCLNK=$$PADECL^PSJPAD50(+$G(PSJORCL)) Q:'PSJCLNK
"RTN","PSGOEF1",55,0)
 ..I '$G(PSJCLNK) Q:'$$PADEWD^PSJPAD50(+$G(VAIN(4)))
"RTN","PSGOEF1",56,0)
 ..S PSJPADLK=1
"RTN","PSGOEF1",57,0)
 ..W !!,"CHOOSE FROM:",?59,"PADE" F Q=1:1:DRG W !?3,$J(Q,3),". ",$P(DRG(Q),"^",2),?60,$$DRGSTOCK^PSJPADSI(DFN,PSGORD,,,+$G(DRG(Q)))
"RTN","PSGOEF1",58,0)
 .I '$G(PSJPADLK) W !!,"CHOOSE FROM:" F Q=1:1:DRG W !?3,$J(Q,3),". ",$P(DRG(Q),"^",2)
"RTN","PSGOEF1",59,0)
 .N DIR S DIR(0)="LAO^1:"_DRG_U_"I X#1!(X[""."") K X",DIR("A")="Select DISPENSE DRUG(S) for this order: " S:DRG=1 DIR("B")=1 S DIR("?")="^D DRGH^PSGOEF1" W ! D ^DIR
"RTN","PSGOEF1",60,0)
 ;
"RTN","PSGOEF1",61,0)
 S DRG=Y(0) F Q1=1:1 S Q2=$P(DRG,",",Q1) Q:'Q2  D
"RTN","PSGOEF1",62,0)
 . S PSJALLGY(+DRG(Q2))=""
"RTN","PSGOEF1",63,0)
 I 'DRGDA S ^PS(53.45,PSJSYSP,2,0)="^53.4502P"
"RTN","PSGOEF1",64,0)
 F Q1=1:1 S Q2=$P(DRG,",",Q1) Q:'Q2  D
"RTN","PSGOEF1",65,0)
 . S DRGDA=DRGDA+1,^PS(53.45,PSJSYSP,2,DRGDA,0)=+DRG(Q2),^PS(53.45,PSJSYSP,2,"B",+DRG(Q2),DRGDA)=""
"RTN","PSGOEF1",66,0)
 . S DA(1)=PSJSYSP,DA=DRGDA,DIE="^PS(53.45,"_PSJSYSP_",2,",DR=".02//1" W !!,$P(DRG(Q2),U,2) D ^DIE
"RTN","PSGOEF1",67,0)
 D ENCKDD(PSGP,+$O(PSJALLGY(0))) Q:$G(PSGORQF)
"RTN","PSGOEF1",68,0)
 S PSGDI=0
"RTN","PSGOEF1",69,0)
 S:DRGDA>0 $P(^PS(53.45,PSJSYSP,2,0),"^",3,4)=DRGDA_"^"_DRGDA,CHK=0 Q
"RTN","PSGOEF1",70,0)
 Q
"RTN","PSGOEF1",71,0)
 ;
"RTN","PSGOEF1",72,0)
DRGH ;
"RTN","PSGOEF1",73,0)
 W !!?2,"This order must have at least one dispense drug before it can be completed.",!,"Select one or more items listed.  For each item selected, you will be",!,"prompted for the UNITS PER DOSE for the item."
"RTN","PSGOEF1",74,0)
 Q
"RTN","PSGOEF1",75,0)
ENIVUD(PSJORD)     ;
"RTN","PSGOEF1",76,0)
 ;Determine if user should be prompted to transfer the order to IV.
"RTN","PSGOEF1",77,0)
 ;  INPUT: PSJORD - IEN in 53.1_order location code.
"RTN","PSGOEF1",78,0)
 ; OUTPUT: 1 - Order not transferred, process as always.
"RTN","PSGOEF1",79,0)
 ;         0 - User selected to transfer order and quit upon return.
"RTN","PSGOEF1",80,0)
 ;
"RTN","PSGOEF1",81,0)
 NEW DIR,DIRUT,PSJCOI,PSJND0,Y
"RTN","PSGOEF1",82,0)
 S PSJND0=$G(^PS(53.1,+PSJORD,0)),PSJCOI=+$G(^PS(53.1,+PSJORD,.2))
"RTN","PSGOEF1",83,0)
 I $P(PSJND0,U,4)="F" Q 1
"RTN","PSGOEF1",84,0)
 D FULL^VALM1
"RTN","PSGOEF1",85,0)
 I $S($P(PSJND0,U,24)="R":1,1:'$P(PSJND0,U,13)) Q 1
"RTN","PSGOEF1",86,0)
 S DIR(0)="SAB^I:IV;U:UNIT DOSE",DIR("A")="COMPLETE THIS ORDER AS IV OR UNIT DOSE? ",DIR("B")=$S($P(PSJND0,U,4)="I":"IV",1:"UNIT DOSE")
"RTN","PSGOEF1",87,0)
 S DIR("??")="^D THELP^PSGOEF1("""_$S(DIR("B")="IV":"UNIT DOSE",1:"IV")_""","_PSJCOI_")"
"RTN","PSGOEF1",88,0)
 D ^DIR K DIR
"RTN","PSGOEF1",89,0)
 I $D(DTOUT)!$D(DUOUT) Q 0
"RTN","PSGOEF1",90,0)
 I Y="I" D  Q 0
"RTN","PSGOEF1",91,0)
 . I +PSJSYSU=1,'$G(PSJIRNF) W !!!!,"You need the PSJI RNFINISH key to finish this order as IV!" D PAUSE^VALM1 S VALMBCK="R" Q
"RTN","PSGOEF1",92,0)
 . D IV^PSJLIFNI(PSJORD,PSJCOI)
"RTN","PSGOEF1",93,0)
 I Y="U" D  Q 0
"RTN","PSGOEF1",94,0)
 . I +PSJSYSU=1,'$G(PSJRNF) W !!!!,"You need the PSJ RNFINISH key to finish this order as Unit Dose!" D PAUSE^VALM1 S VALMBCK="R" Q
"RTN","PSGOEF1",95,0)
 . I $G(PSJITECH),($P(PSJSYSU,";",3)'=3) W !!!!,"You may not finish this order as Unit Dose!" D PAUSE^VALM1 S VALMBCK="R" Q
"RTN","PSGOEF1",96,0)
 . D ENUD^PSGOEF1(PSJORD,PSJCOI)
"RTN","PSGOEF1",97,0)
 Q 1
"RTN","PSGOEF1",98,0)
 ;
"RTN","PSGOEF1",99,0)
ENUD(PSJORD,PSGPD)       ;
"RTN","PSGOEF1",100,0)
 N PSJTUD S PSJTUD=1,DFN=$P($G(^PS(53.1,+PSJORD,0)),U,15)
"RTN","PSGOEF1",101,0)
 K DRG,DRGOC,DRGT,DRGTMP,ERR,ON,ON55,P,PSJSTAR,PSJTIM,UL80
"RTN","PSGOEF1",102,0)
 D DISACTIO^PSJOE(DFN,PSJORD,$G(PSJPNV)) S VALMBCK="Q"
"RTN","PSGOEF1",103,0)
 I +$G(PSGORQF) S VALMBCK="R"
"RTN","PSGOEF1",104,0)
 Q
"RTN","PSGOEF1",105,0)
THELP(PKG,COI) ;
"RTN","PSGOEF1",106,0)
 W !,"Choose the package this order should be completed as a IV or Unit Dose order",!
"RTN","PSGOEF1",107,0)
 Q
"RTN","PSGOEF1",108,0)
 ;
"RTN","PSGOEF1",109,0)
ENCKDD(PSGP,PSJDRG) ;
"RTN","PSGOEF1",110,0)
 ;If the OI is edited, the OC is done in ^PSGOEE (PSGOE8 - Non-VFY; PSGOE9 - Active)
"RTN","PSGOEF1",111,0)
 Q:$G(PSGOEER)["101^PSGOE8"
"RTN","PSGOEF1",112,0)
 Q:$G(PSGOEER)["101^PSGOE9"
"RTN","PSGOEF1",113,0)
 N DRG
"RTN","PSGOEF1",114,0)
 S PSGORQF=0
"RTN","PSGOEF1",115,0)
 D ENDDC^PSGSICHK(PSGP,PSJDRG) Q:$G(PSGORQF)
"RTN","PSGOEF1",116,0)
 D IN^PSJOCDS($G(PSGORD),"UD",+PSJDRG)
"RTN","PSGOEF1",117,0)
 Q
"RTN","PSGPEN")
0^28^B57822787^B40801558
"RTN","PSGPEN",1,0)
PSGPEN ;BIR/CML3 - FIND DEFAULT FOR PRE-EXCHANGE NEEDS ;03 Feb 99 / 9:13 AM
"RTN","PSGPEN",2,0)
 ;;5.0;INPATIENT MEDICATIONS ;**30,37,50,58,115,110,127,129,323,317**;16 DEC 97;Build 130
"RTN","PSGPEN",3,0)
 ;
"RTN","PSGPEN",4,0)
 ; References to ^PSD(58.8 supported by DBIA #2283.
"RTN","PSGPEN",5,0)
 ; References to ^PSI(58.1 supported by DBIA #2284.
"RTN","PSGPEN",6,0)
 ; Reference to ^PS(55 is supported by DBIA #2191.
"RTN","PSGPEN",7,0)
 ; Reference to ^PSDRUG is supported by DBIA #2192.
"RTN","PSGPEN",8,0)
 ; Reference to ^PS(59.7 is supported by DBIA #2181.
"RTN","PSGPEN",9,0)
 ;
"RTN","PSGPEN",10,0)
EN(PSGPENO) ;
"RTN","PSGPEN",11,0)
 S PSGPENO=+PSGPENO
"RTN","PSGPEN",12,0)
 N PSJPADE
"RTN","PSGPEN",13,0)
 S PSJPADE=$$PADE($G(PSJPWD),PSGP,PSGPENO_"U")  ; PADE check - PSJ*5*317
"RTN","PSGPEN",14,0)
 N PSJSITE,PSJPRN,PSJCLO,ND8 S PSJCLO=0,ND8=0 S PSJSITE=0,PSJSITE=$O(^PS(59.7,PSJSITE)) I $P($G(^(PSJSITE,26)),U,5)=1 S PSJPRN=1
"RTN","PSGPEN",15,0)
 D NOW^%DTC S PSGDT=%,DT=$$DT^XLFDT,PSGPEN="" S ND=$G(^PS(55,PSGP,5,PSGPENO,0)),ND8=$G(^PS(55,PSGP,5,PSGPENO,8))
"RTN","PSGPEN",16,0)
 S:$P(ND8,"^",2) PSJCLO=1
"RTN","PSGPEN",17,0)
 S PSGPENWS=0 I PSJPWD,'PSJCLO F Q=0:0 S Q=$O(^PS(55,PSGP,5,PSGPENO,1,Q)) Q:'Q  S ND=$G(^(Q,0)) I ND,'$P(ND,"^",3),($D(^PSI(58.1,"D",+ND,PSJPWD))!$D(^PSD(58.8,"D",+ND,PSJPWD))) S PSGPENWS=1 Q
"RTN","PSGPEN",18,0)
 I PSGPENWS F  S Q=$O(^PS(55,PSGP,5,PSGPENO,1,Q)) Q:'Q  S ND=$G(^(Q,0)) I ND,'$P(ND,"^",3) S:'$D(^PSI(58.1,"D",+ND,PSJPWD))&'$D(^PSD(58.8,"D",+ND,PSJPWD)) PSGPENWS=0 Q:'PSGPENWS  S $P(PSGPENWS,"^",2)=1
"RTN","PSGPEN",19,0)
 I PSJPADE&'PSGPENWS W !!,"The dispense drug",$S(PSJPADE>1:"s",1:"")," for this order ",$S(PSJPADE>1:"are",1:"is a")," PADE item",$S(PSJPADE>1:"s",1:""),"." S PSGPEN=0
"RTN","PSGPEN",20,0)
 I PSJPADE&PSGPENWS W !!,"The dispense drug",$S(PSJPADE>1:"s",1:"")," for this order ",$S(PSJPADE>1:"are",1:"is a")," WARD STOCK/PADE item",$S(PSJPADE>1:"s",1:""),"." S PSGPEN=0
"RTN","PSGPEN",21,0)
 I PSGPENWS&'PSJPADE W !!,"The dispense drug",$E("s",$P(PSGPENWS,"^",2))," for this order ",$S($P(PSGPENWS,"^",2):"are",1:"is a")," WARD STOCK item",$E("s",$P(PSGPENWS,"^",2)),"." S PSGPEN=0
"RTN","PSGPEN",22,0)
 I 'PSGPENWS,PSJPWD,'PSJPADE S WG=+$O(^PS(57.5,"AB",PSJPWD,0)),PSGPLS=$P($G(^PS(55,PSGP,5,PSGPENO,2)),"^",2) I PSGPLS D
"RTN","PSGPEN",23,0)
 .S PSGPLF=$O(^PS(53.5,"AB",WG,PSGDT))
"RTN","PSGPEN",24,0)
 .N RNDT,PSJRNOS S RNDT=$$LASTREN^PSJLMPRI(PSGP,$S($G(PSJORD)["P":PSJORD,1:"")),PSJRNOS=$P(RNDT,"^",4) I PSJRNOS,'$G(PSJREN) S PSGPLS=PSJRNOS
"RTN","PSGPEN",25,0)
 .I $G(PSJREN),$G(PSJORD)["U" S PSJRNOS=$P(^PS(55,PSGP,5,+PSJORD,2),"^",4) S PSGPLS=$S(PSJRNOS>PSGDT:PSJRNOS,1:$$DATE2^PSJUTL2(PSGDT))
"RTN","PSGPEN",26,0)
 .D:'PSGPLF GF I PSGPLF S PSGPLO=PSGPENO D NCE,^PSGPL0 S:PSGPLC'<0 PSGPEN=PSGPLC
"RTN","PSGPEN",27,0)
 I $G(PSGPRIO)="DONE" S PSGPEN=0
"RTN","PSGPEN",28,0)
 ;
"RTN","PSGPEN",29,0)
UPDD ;
"RTN","PSGPEN",30,0)
 N DIR S DIR(0)="NOA^0:9999:0",DIR("A")="Pre-Exchange DOSES: ",DIR("?")="^D DH^PSGPEN" S:PSGPEN]"" DIR("B")=PSGPEN W ! D ^DIR G:'Y DONE S PSGY=+Y W !!,"...updating dispense drug(s)..."
"RTN","PSGPEN",31,0)
 F FQ=0:0 S FQ=$O(^PS(55,PSGP,5,PSGPENO,1,FQ)) Q:'FQ  S ND=$G(^(FQ,0)),$P(^(0),"^",9)="" I ND,'$P(ND,"^",3) D DD
"RTN","PSGPEN",32,0)
 ;
"RTN","PSGPEN",33,0)
DONE ;
"RTN","PSGPEN",34,0)
 I $P(PSJSYSW0,"^",29)="",$$DEFON^PSGPER1 S $P(PSJSYSW0,"^",29)=0
"RTN","PSGPEN",35,0)
 K PSGID,PSGMAR,PSGOD,PSGPLC,PSGPLF,PSGPLO,PSGPLS,PSGPLUD,WG S:$G(PSJREN) DUOUT=0 Q
"RTN","PSGPEN",36,0)
 ;
"RTN","PSGPEN",37,0)
NCE ;
"RTN","PSGPEN",38,0)
 W !!,"The next cart exchange is ",$$ENDTC^PSGMI(PSGPLF),! Q
"RTN","PSGPEN",39,0)
 ;
"RTN","PSGPEN",40,0)
GF ;
"RTN","PSGPEN",41,0)
 S QQ=0 F Q=0:0 S Q=$O(^PS(53.5,"AB",WG,Q)) Q:'Q  S QQ=Q
"RTN","PSGPEN",42,0)
 I QQ S QQ=$O(^PS(53.5,"AB",WG,QQ,0)) I QQ,$D(^PS(53.5,QQ,0)) S QQ=$P(^(0),"^",4) I QQ>PSGDT S PSGPLF=QQ
"RTN","PSGPEN",43,0)
 Q
"RTN","PSGPEN",44,0)
 ;
"RTN","PSGPEN",45,0)
DD ;
"RTN","PSGPEN",46,0)
 N DA S DRG=$S($P(ND,"^")="":"NOT FOUND",'$D(^PSDRUG(+ND,0)):"NOT FOUND ("_$P(ND,"^")_")",$P(^(0),"^")]"":$P(^(0),"^"),1:$P(ND,"^")_";PSDRUG("),UD=$S('$P(ND,"^",2):1,1:$P(ND,"^",2))
"RTN","PSGPEN",47,0)
 W !,"...",DRG,?45,"U/D: ",UD,"..."
"RTN","PSGPEN",48,0)
 S PSGDA=PSGY I 'PSGPENWS,'PSJCLO,ND,PSJPWD,($D(^PSI(58.1,"D",+ND,PSJPWD))!$D(^PSD(58.8,"D",+ND,PSJPWD))) D PSGPENWS Q:'PSGDA
"RTN","PSGPEN",49,0)
 K DA,DR S PSGDA=$S(UD#1:(PSGDA*((UD\1)+1)),1:PSGDA*UD)
"RTN","PSGPEN",50,0)
 S DIE="^PS(55,"_PSGP_",5,"_PSGPENO_",1,",DA(2)=PSGP,DA(1)=PSGPENO,DA=FQ,DR=".09////"_PSGDA D ^DIE
"RTN","PSGPEN",51,0)
 S PSGPXN=$G(PSGPXN)
"RTN","PSGPEN",52,0)
 D:'PSGPXN
"RTN","PSGPEN",53,0)
 .D NOW^%DTC L +^PS(53.4,0):0 S ND=$G(^PS(53.4,0)) S:ND="" ND="PRE-EXCHANGE NEEDS^53.4P" F PSGPXN=$P(ND,"^",3)+1:1 I '$D(^PS(53.4,PSGPXN)) L +^PS(53.4,PSGPXN):0 I  S ^PS(53.4,0)=$P(ND,"^",1,2)_"^"_PSGPXN_"^"_($P(ND,"^",4)+1) L -^PS(53.4,0) Q
"RTN","PSGPEN",54,0)
 .S ^PS(53.4,PSGPXN,0)=DUZ_"^"_%,^PS(53.4,"B",DUZ,PSGPXN)="",^PS(53.4,"AUD",DUZ,%,PSGPXN)="" L -^PS(53.4,PSGPXN) Q
"RTN","PSGPEN",55,0)
 I $D(^PS(53.4,PSGPXN,1,PSGP,1,PSGPENO,1,FQ,0)) S $P(^(0),"^",2)=$P(^(0),"^",2)+PSGDA Q
"RTN","PSGPEN",56,0)
 ; naked reference below refers to line above
"RTN","PSGPEN",57,0)
 S ^(0)=FQ_"^"_PSGDA I $D(^PS(53.4,PSGPXN,1,PSGP,1,PSGPENO,1,0)) S $P(^(0),"^",3,4)=FQ_"^"_($P(^(0),"^",4)+1) Q
"RTN","PSGPEN",58,0)
 ; naked reference below refers to line above
"RTN","PSGPEN",59,0)
 S ^(0)="^53.401101A^"_FQ_"^1" Q:$D(^PS(53.4,PSGPXN,1,PSGP,1,PSGPENO,0))  S ^(0)=PSGPENO
"RTN","PSGPEN",60,0)
 I $D(^PS(53.4,PSGPXN,1,PSGP,1,0)) S $P(^(0),"^",3,4)=PSGPENO_"^"_($P(^(0),"^",4)+1) Q
"RTN","PSGPEN",61,0)
 ; naked reference below is from line above
"RTN","PSGPEN",62,0)
 S ^(0)="^53.4011A^"_PSGPENO_"^1" Q:$D(^PS(53.4,PSGPXN,1,PSGP,0))  S ^(0)=PSGP
"RTN","PSGPEN",63,0)
 I $D(^PS(53.4,PSGPXN,1,0)) S $P(^(0),"^",3,4)=PSGP_"^"_($P(^(0),"^",4)+1) Q
"RTN","PSGPEN",64,0)
 ; naked reference below is from line above
"RTN","PSGPEN",65,0)
 S ^(0)="^53.401PA^"_PSGP_"^1" Q
"RTN","PSGPEN",66,0)
 ;
"RTN","PSGPEN",67,0)
DH ;
"RTN","PSGPEN",68,0)
 W !!?2,"Enter a number from 0 to 9999, 0 decimal digits."
"RTN","PSGPEN",69,0)
 W !!?2,"Enter the number DOSES needed for this order until the next cart exchange.",!,"This will be the number of times the order will be administered to the patient",!,"from the start of the order until the next cart exchange."
"RTN","PSGPEN",70,0)
 W !!?2,"PLEASE NOTE that this is DOSES, and NOT UNITS.  The doses entered will be",!,"converted to units for each dispense drug of this order, as each dispense drug",!,"may have a different units per dose." Q
"RTN","PSGPEN",71,0)
 ;
"RTN","PSGPEN",72,0)
PSGPENWS ;
"RTN","PSGPEN",73,0)
 W !,"This dispense drug is a WARD STOCK item."
"RTN","PSGPEN",74,0)
 W !,"Would you like to:",!?3,"1 - Enter 0 (no) doses needed for this dispense drug.",!?3,"2 - Enter ",PSGDA," doses needed for this dispense drug.",!?3,"3 - Enter another amount as the doses needed for this dispense drug."
"RTN","PSGPEN",75,0)
 K DIR S DIR(0)="SA^1:0 (no) doses;2:"_PSGDA_" doses;3:another amount",DIR("A")="Select ACTION: ",DIR("?")="^D WH^PSGPEN" W ! D ^DIR I Y=1!'Y S PSGDA=0 Q
"RTN","PSGPEN",76,0)
 Q:Y=2  K DIR S DIR(0)="NA^0:9999:0",DIR("A")="Pre-Exchange DOSES for this dispense drug: ",DIR("?")="^D WDH^PSGPEN" W ! D ^DIR S PSGDA=+Y Q
"RTN","PSGPEN",77,0)
 ;
"RTN","PSGPEN",78,0)
WH ;
"RTN","PSGPEN",79,0)
 S Q="This dispense drug ("_DRG_") is a ward stock item.  Select:"
"RTN","PSGPEN",80,0)
 W !! F Q1=1:1:$L(Q," ") S Q2=$P(Q," ",Q1) W:$X+$L(Q2)>78 ! W Q2," "
"RTN","PSGPEN",81,0)
 W !?3,"1 to enter 0 (no) pre-exchange doses for this dispense drug.",!?3,"2 to enter ",PSGDA," doses for this dispense drug.",!?3,"3 to enter another amount for this dispense drug." Q
"RTN","PSGPEN",82,0)
 ;
"RTN","PSGPEN",83,0)
WDH ;
"RTN","PSGPEN",84,0)
 W !!?2,"Enter a number from 0 to 9999, 0 decimal digits.  If you enter an '^' to exit",!,"NO pre-exchange doses will be entered for this dispense drug." Q
"RTN","PSGPEN",85,0)
 ;
"RTN","PSGPEN",86,0)
PADE(PSJPWD,PSGP,PSGORD)  ; Pharmacy Automation Dispensing Equipment (PADE) check - PSJ*5*317
"RTN","PSGPEN",87,0)
 ; INPUT: PSJPWD = Ward location
"RTN","PSGPEN",88,0)
 ;        PSGP   = Patient DFN
"RTN","PSGPEN",89,0)
 ;        PSGORD = Order number
"RTN","PSGPEN",90,0)
 ; OUTPUT: PADE = Can this order be dispensed via PADE?
"RTN","PSGPEN",91,0)
 ;
"RTN","PSGPEN",92,0)
 N PADE,DFN,PSJDDND,PSJWDFLG
"RTN","PSGPEN",93,0)
 I '$G(PSJPWD)!'$G(PSGP)!'$G(PSGORD) Q ""
"RTN","PSGPEN",94,0)
 S PADE="",DFN=$G(PSGP)
"RTN","PSGPEN",95,0)
 ; Check DEFAULT 0 ON PADE PRE-EXCHANGE parameter
"RTN","PSGPEN",96,0)
 D GETS^DIQ(59.6,+$G(PSJSYSW),8,"I","PSJWDFLG")
"RTN","PSGPEN",97,0)
 I $G(PSJWDFLG("59.6",+$G(PSJSYSW)_",",8,"I")) D
"RTN","PSGPEN",98,0)
 .N PSJPDLOC,PSJORCL,PSJCLNK
"RTN","PSGPEN",99,0)
 .; If clinic order, quit if clinic location is not linked to PADE
"RTN","PSGPEN",100,0)
 .S PSJORCL=$S($G(PSGORD)["P":$G(^PS(53.1,+$G(PSGORD),"DSS")),$G(PSGORD)["U":$G(^PS(55,+$G(PSGP),5,+$G(PSGORD),8)),$G(PSGORD)["V":$G(^PS(55,+$G(PSGP),"IV",+$G(PSGORD),"DSS")),1:"")
"RTN","PSGPEN",101,0)
 .I PSJORCL,$P(PSJORCL,"^",2) S PSJCLNK=$$PADECL^PSJPAD50(+$G(PSJORCL)) Q:'PSJCLNK
"RTN","PSGPEN",102,0)
 .I '$G(PSJCLNK) Q:'$$PADEWD^PSJPAD50(PSJPWD)   ; Quit if patient location not linked to PADE
"RTN","PSGPEN",103,0)
 .S PSJPDLOC=$S($G(PSGORD)["P":+$G(^PS(53.1,+PSGORD,"DSS"))_"C",$G(PSGORD)["U":+$G(^PS(55,+$G(DFN),5,+$G(PSGORD),8))_"C",1:"")
"RTN","PSGPEN",104,0)
 .S:'PSJPDLOC PSJPDLOC=+$G(PSJPWD)
"RTN","PSGPEN",105,0)
 .N PADEFLAG,DDCNT S PADEFLAG=1
"RTN","PSGPEN",106,0)
 .I $G(PSGORD)["U" S Q=0 F DDCNT=0:1 S Q=$O(^PS(55,+$G(PSGP),5,+PSGORD,1,Q)) Q:'Q!'PADEFLAG  S PSJDDND=$G(^(Q,0)) D
"RTN","PSGPEN",107,0)
 ..S PADEFLAG=+$$DRGQTY^PSJPADSI(+PSJDDND,$S(PSJPDLOC["C":"CL",1:"WD"),+PSJPDLOC)
"RTN","PSGPEN",108,0)
 .I $G(PSGORD)'["U" S Q=0 F DDCNT=0:1 S Q=$O(^PS(53.45,+$G(PSJSYSP),2,Q)) Q:'Q!'PADEFLAG  S PSJDDND=$G(^(Q,0)) D
"RTN","PSGPEN",109,0)
 ..S PADEFLAG=+$$DRGQTY^PSJPADSI(+PSJDDND,$S(PSJPDLOC["C":"CL",1:"WD"),+PSJPDLOC)
"RTN","PSGPEN",110,0)
 .I DDCNT,PADEFLAG S PADE=DDCNT
"RTN","PSGPEN",111,0)
 Q PADE
"RTN","PSGPLR")
0^17^B40061443^B39066813
"RTN","PSGPLR",1,0)
PSGPLR ;BIR/CML3-PRINTS PICK LIST REPORT ; 6/15/07 1:12pm
"RTN","PSGPLR",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**10,50,67,119,129,191,317**;16 DEC 97;Build 130
"RTN","PSGPLR",3,0)
 ;
"RTN","PSGPLR",4,0)
 ; Reference to ^PS(55 is supported by DBIA# 2191.
"RTN","PSGPLR",5,0)
 ; Reference to ^PS(59.7 is supported by DBIA# 2181.
"RTN","PSGPLR",6,0)
 ; Reference to ^PSDRUG is supported by DBIA# 2192.
"RTN","PSGPLR",7,0)
 ; Reference to ^%DTC is supported by DBIA# 10000.
"RTN","PSGPLR",8,0)
 ; Reference to ^VADPT is supported by DBIA# 10061.
"RTN","PSGPLR",9,0)
 ;
"RTN","PSGPLR",10,0)
 N PSGY,OLDWARD,STPDT D NOW^%DTC S PSGDT=+$E(%,1,12),PPLD=$$ENDTC^PSGMI(PSGDT),$P(OLINE,"-",75)="",PSGPLXR=$S($G(PSGPLUPF)=1:"AU",1:"AC")
"RTN","PSGPLR",11,0)
 S PGN=0,(FACL,LINE)="",$P(LINE,"-",81)="",$P(FACL,"_",31)="",TND=$G(^PS(53.5,PSGPLG,0)),PSD=$P(TND,"^",3),PFD=$P(TND,"^",4),WSF=$P(TND,"^",7),WGPN=$S('$D(^PS(57.5,PSGPLWG,0)):"N/F",$P(^(0),"^")]"":$P(^(0),"^"),1:"N/F")
"RTN","PSGPLR",12,0)
 S FFF=$S($P(PSGPLWGP,"^",4):2,$P(PSGPLWGP,"^",5):1,1:0),CML=IO'=IO(0)!($E(IOST,1,2)'="C-")
"RTN","PSGPLR",13,0)
 F X="PSD","PFD" S @X=$$ENDTC^PSGMI(@X)
"RTN","PSGPLR",14,0)
 U IO
"RTN","PSGPLR",15,0)
 I '$D(^PS(53.5,$S($D(PSGPLUPF):"AU",1:"AC"),PSGPLG)) S NPLF=0 D HEADER W !!?25,"*** No orders to fill ***" W:(IO'=IO(0)!(IOST'["C-"))&($Y) @IOF G DONE
"RTN","PSGPLR",16,0)
 ;
"RTN","PSGPLR",17,0)
BEGIN ;
"RTN","PSGPLR",18,0)
 I '$$LOCK^PSGPLUTL(PSGPLG,"PSGPLR") H 60 G BEGIN
"RTN","PSGPLR",19,0)
 S NPLF=1,TM=0 F  S TM=$O(^PS(53.5,PSGPLXR,PSGPLG,TM)) Q:TM=""!(TM["~")  S (DDRG,PDRG,PN,PST,RM,WDN)="" D HEADER:'FFF,^PSGPLR0 I CML,'FFF D PAGECK W !!?25,"FILLED BY: ",FACL,!!?25,"CHECKED BY: ",FACL
"RTN","PSGPLR",20,0)
 I CML,FFF D PAGECK W !!?25,"FILLED BY: ",FACL,!!?25,"CHECKED BY: ",FACL W:$Y @IOF
"RTN","PSGPLR",21,0)
 ;
"RTN","PSGPLR",22,0)
DONE ;
"RTN","PSGPLR",23,0)
 D UNLOCK^PSGPLUTL(PSGPLG,"PSGPLR")
"RTN","PSGPLR",24,0)
 K AT,ATC,CML,DDRG,DIS,DND,DO,DR,DRN,DRG,FACL,FD,FFF,FQC,LINE,ND,ND0,ND1,ND2,ND6,NEED,NPLF,OLINE,PSGPLDC,PSGPLXR,PSGPLXRX
"RTN","PSGPLR",25,0)
 K PSJJORD,PSJORDN,PFD,PGN,PN,POP,PPLD,PPN,PRM,PSD,PSGID,PSGOD,PSGP,PST,PW,RM,RTE,SCH,SD,SM,PSSN,TD,TM,TND,WDN,WL,WG,WSF,WGPN,X
"RTN","PSGPLR",26,0)
 Q
"RTN","PSGPLR",27,0)
 ;
"RTN","PSGPLR",28,0)
DD ;
"RTN","PSGPLR",29,0)
 N PSJRNW,CNT,PADE
"RTN","PSGPLR",30,0)
 I $D(PSGPLREN("B",$G(PSGP),$G(PSJJORD))),$G(PSGPLUP) D
"RTN","PSGPLR",31,0)
 .N OSTOP,DRGND S (DDRG,OLDWARD)="" S DRGND=$O(PSGPLREN("B",PSGP,PSJJORD,0)) Q:'DRGND  S OSTOP=PSGPLREN("B",PSGP,PSJJORD,DRGND) Q:'OSTOP
"RTN","PSGPLR",32,0)
 .N ST,TMPDRG S CNT=0,ST=$P(ND0,"^",7) S TMPDRG=0 S TMPDRG=$O(PSGPLREN("B",PSGP,PSJJORD,TMPDRG)) S TMPDRG=$P(DRG,"^")_"^"_TMPDRG
"RTN","PSGPLR",33,0)
 .F PSGPLXRX="AU","AC" Q:CNT  F I=0:1 S DDRG=$O(PSGPLREN(53.5,PSGPLXRX,PSGPLG,TM,WDN,RM,PN,PST,TMPDRG,DDRG)) Q:(DDRG="")!(DDRG="NO DISPENSE DRUG")  D
"RTN","PSGPLR",34,0)
 ..S X=$G(PSGPLREN(53.5,PSGPLG,1,PSGP,1,+DRGND,1,$P(DDRG,"^",2),0)) S DR=+X,DND=$P(X,U,2,4) Q:'X
"RTN","PSGPLR",35,0)
 ..S DRN=$G(^PS(55,PSGP,5,PSJJORD,1,DR,0)),DR=$$ENDDN^PSGMI($P(DRN,"^")) I DND?7N1"DI" S DND=$E($$ENDTC^PSGMI(+DND),1,8)
"RTN","PSGPLR",36,0)
 ..S DIS=$P(DND,"^",2),NEED=$S($P(DND,"^")]"":$P(DND,"^"),1:0)
"RTN","PSGPLR",37,0)
 ..;GMZ;PSJ*5*191;Allow for Multiple Dispensed Drug units needed
"RTN","PSGPLR",38,0)
 ..S PSJRNW(I)=1_"^"_+NEED
"RTN","PSGPLR",39,0)
 ..Q
"RTN","PSGPLR",40,0)
 .K PSGPLREN("B",PSGP,PSJJORD),PSGPLREN(53.5,PSGPLG,1,PSGP,1,+DRGND) W !!
"RTN","PSGPLR",41,0)
 ;
"RTN","PSGPLR",42,0)
 S CNT=0
"RTN","PSGPLR",43,0)
 S (DDRG,OLDWARD)="" N ST S ST=$P(ND0,"^",7) F  S DDRG=$O(^PS(53.5,PSGPLXR,PSGPLG,TM,WDN,RM,PN,PST,DRG,DDRG)) Q:(DDRG="")!(DDRG="NO DISPENSE DRUG")  S X=$G(^PS(53.5,PSGPLG,1,+$P(PN,U,2),1,+$P(DRG,U,2),1,+$P(DDRG,U,2),0)),DR=+X,DND=$P(X,U,2,4) D
"RTN","PSGPLR",44,0)
 .S DRN=$G(^PS(55,PSGP,5,PSJJORD,1,DR,0)),DR=$$ENDDN^PSGMI($P(DRN,"^")) I DND?7N1"DI" S DND=$E($$ENDTC^PSGMI(+DND),1,8) W !?6,DR,?48,ST,?51,"(DI "_DND_")",?66,"Returns: ____" Q
"RTN","PSGPLR",45,0)
 .S UD=$P(DRN,"^",2),ATC=$P($G(^PSDRUG(+DRN,8.5)),"^",2)]"" S:ATC ATC=$D(^(212,"AC",PSGPLWG))
"RTN","PSGPLR",46,0)
 .S DIS=$P(DND,"^",2),NEED=$S($P(DND,"^")]"":$P(DND,"^"),1:0) I ATC S ATCFF=+$P($G(^PS(59.7,1,26)),"^",7),ATC=$S(ATCFF:NEED,UD#1:0,DIS]"":+DIS,1:NEED) I ATC,$S(ATC<1:1,ATC'?1.3N:1,1:ATC#1) S ATC=0
"RTN","PSGPLR",47,0)
 .I ATC S X=0,X=$O(^PS(59.7,X)) I $P($G(^(X,26)),U,2)=1,PST="OC" S ATC=0
"RTN","PSGPLR",48,0)
 .S UD=$S('UD:1,UD=.5:"1/2",UD=.25:"1/4",UD<1:"0"_UD,1:UD)
"RTN","PSGPLR",49,0)
 .I $D(PSJRNW) D
"RTN","PSGPLR",50,0)
 ..I 'CNT W !?35,"**** RENEWAL ****"
"RTN","PSGPLR",51,0)
 ..S NEED=NEED-$P(PSJRNW(CNT),"^",2) S:NEED<0 NEED=0 S CNT=CNT+1
"RTN","PSGPLR",52,0)
 .N TMPORD S TMPORD=PSJJORD_"U" S PADE=$S($$DRGSTOCK^PSJPADSI(PSGP,TMPORD,,,+$G(DRN)):"PADE",1:"")
"RTN","PSGPLR",53,0)
 .W !,DR_" ("_+DRN_")",?48,ST,?52,PADE W:(ATC)&(NEED>0) ?57,"ATC" W ?61,$J(UD,4),?68,$J(NEED,4),?75,$S(DIS]"":$J(DIS,4),1:"____")
"RTN","PSGPLR",54,0)
 .S:ST="DISCONTINUED" OLDWARD=1 S ST=""
"RTN","PSGPLR",55,0)
 I DDRG="NO DISPENSE DRUG" W !?6,PDRG,?48,ST,?57,"OI" S:ST="DISCONTINUED" OLDWARD=1 S ST=""
"RTN","PSGPLR",56,0)
 N GIVSTR S GIVSTR=$S(DO]"":DO_" ",1:"")_RTE_" "_SCH D
"RTN","PSGPLR",57,0)
 .N MARX,I,Y,X D TXT^PSGMUTL(GIVSTR,60)
"RTN","PSGPLR",58,0)
 .F I=1:1:MARX W:I=1 !?10,"Give: ",MARX(1) W:I>1 !?16,MARX(I)
"RTN","PSGPLR",59,0)
 D:OLDWARD WARDCHK W:AT]"" !,?65-$L(AT),AT W !?7,"Start: ",SD,?37,"Stop: ",FD
"RTN","PSGPLR",60,0)
 I Y]"" W !?10 F Q=1:1:$L(Y," ") S X=$P(Y," ",Q) W:$X+$L(X)>65 !?10 W X_" "
"RTN","PSGPLR",61,0)
 K ST
"RTN","PSGPLR",62,0)
 Q
"RTN","PSGPLR",63,0)
 ;
"RTN","PSGPLR",64,0)
EXDD ;
"RTN","PSGPLR",65,0)
 W ! S (DDRG,OLDWARD)="" F  S DDRG=$O(^PS(53.5,PSGPLXR,PSGPLG,TM,WDN,RM,PN,PST,DRG,DDRG)) Q:(DDRG="")!(DDRG="NO DISPENSE DRUG")  S DND=^(DDRG) D
"RTN","PSGPLR",66,0)
 .S DR=$P(DDRG,"^",2),DRN=$G(^PS(55,PSGP,5,PSJJORD,1,DR,0)),ID=$P(DRN,"^",3),DR=$$ENDDN^PSGMI($P(DRN,"^")) W !?6,DR,?48,DIS,?66,"Returns: ____" S:DIS="DISCONTINUED" OLDWARD=1 S DIS=""
"RTN","PSGPLR",67,0)
 I DDRG="NO DISPENSE DRUG" S ND1=$G(^PS(55,PSGP,5,PSJJORD,.2)),PDRG=$$ENPDN^PSGMI($P(ND1,"^")) W !?6,PDRG,?48,DIS,?66,"Returns: ____" S:DIS="DISCONTINUED" OLDWARD=1 S DIS=""
"RTN","PSGPLR",68,0)
 W !?10,"Give: ",$S(DO]"":DO_" ",1:""),RTE," ",SCH D:OLDWARD WARDCHK W !?7,"Start: ",SD,?37,"Stop: ",FD
"RTN","PSGPLR",69,0)
 Q
"RTN","PSGPLR",70,0)
 ;
"RTN","PSGPLR",71,0)
FCL ;
"RTN","PSGPLR",72,0)
 I PGN,CML,$P(PSGPLWGP,"^",6) W !!?25,"FILLED BY: ",FACL,!!?25,"CHECKED BY: "_FACL
"RTN","PSGPLR",73,0)
 ;
"RTN","PSGPLR",74,0)
HEADER ;
"RTN","PSGPLR",75,0)
 S PGN=PGN+1 W:$Y @IOF
"RTN","PSGPLR",76,0)
 W ?1,"(",PSGPLG,")",?$S($D(PSGPLUPF):27,1:32),"PICK LIST REPORT" W:$D(PSGPLUPF) " (UPDATE)" W ?64,PPLD,!,"Ward group: ",WGPN,?73-$L(PGN),"Page: ",PGN,!?18,"For ",PSD," through ",PFD W:NPLF !,"Team: ",$S(TM'["zz":TM,1:"** N/F **")
"RTN","PSGPLR",77,0)
 W !!,$S($P(TND,"^",6)&'$P(TND,"^",8):"Bed-Room",1:"Room-Bed"),?15,"Patient",?67,"Units",?74,"Units",!?9,"Medication",?48,"ST",?62,"U/D",?66,"Needed",?74,"Disp'd",!,LINE Q
"RTN","PSGPLR",78,0)
 ;
"RTN","PSGPLR",79,0)
PAGECK ;
"RTN","PSGPLR",80,0)
 S PSGPY=$Y,PSGPY=$Y+4 I PSGPY+4>IOSL W @IOF
"RTN","PSGPLR",81,0)
 Q
"RTN","PSGPLR",82,0)
 ;
"RTN","PSGPLR",83,0)
WARDCHK ;  if patient has discontinued orders from a different ward, print the ward and room/bed that the orders were discontinued from.
"RTN","PSGPLR",84,0)
 Q:'$G(STPDT)
"RTN","PSGPLR",85,0)
 S VAINDT=$$MINUTES(STPDT,5)
"RTN","PSGPLR",86,0)
 S DFN=PSGP D INP^VADPT I PW'=$P(VAIN(4),"^",2) W ?48,$E("(from "_$P(VAIN(4),"^",2)_" "_VAIN(5)_")",1,31)
"RTN","PSGPLR",87,0)
 S OLDWARD="" Q
"RTN","PSGPLR",88,0)
 ;
"RTN","PSGPLR",89,0)
MINUTES(STPDT,LESS)     ; pass in a FM date/time and the number of minutes (9 or less) to subtract from it
"RTN","PSGPLR",90,0)
 S VAINDT=$S($E(STPDT,9,12)<LESS:($E(STPDT,1,7)-1)_"."_(($E(STPDT,9,12)+2360)-LESS),$E(STPDT,11,12)<5:$E(STPDT,1,8)_$S($E(STPDT,9,10)="10":"09",$E(STPDT,9,10)="20":"19",1:$E(STPDT,9)_($E(STPDT,10)-1))_(60+$E(STPDT,12)-LESS),1:STPDT-(LESS*.0001))
"RTN","PSGPLR",91,0)
 Q VAINDT
"RTN","PSJ317P")
0^21^B6017554^n/a
"RTN","PSJ317P",1,0)
PSJ317P ;BIR/MHA - PADE POST INSTALL ROUTINE; 07/07/15
"RTN","PSJ317P",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**317**;16 DEC 97;Build 130
"RTN","PSJ317P",3,0)
 ;Reference to ^ORD(101 supported by DBIA #872
"RTN","PSJ317P",4,0)
 ;
"RTN","PSJ317P",5,0)
 Q
"RTN","PSJ317P",6,0)
POST ; Add client to event driver as a subscriber
"RTN","PSJ317P",7,0)
 N SNAM,EX,I,J,LN,SEQ,IN,RETURN S SNAM="PSJ ADT-A01 ROUTER",EX=0
"RTN","PSJ317P",8,0)
 S I=$O(^ORD(101,"B",SNAM,0))
"RTN","PSJ317P",9,0)
 I 'I D MES^XPDUTL(SNAM_" Router Protocol Does Not Exist - Quitting!") Q
"RTN","PSJ317P",10,0)
 F SEQ=1:1 S LN=$T(TAG+SEQ) Q:$P(LN,";",3)="END"  D  Q:EX
"RTN","PSJ317P",11,0)
 . S J=$P(LN,";",3)_" SERVER",IN=$O(^ORD(101,"B",J,0))
"RTN","PSJ317P",12,0)
 . I 'IN D MES^XPDUTL(J_" Protocol Does Not Exist") S EX=1 Q
"RTN","PSJ317P",13,0)
 . I $D(^ORD(101,IN,775,"B",I)) D  Q  ;Skip if already present
"RTN","PSJ317P",14,0)
 . . D MES^XPDUTL(SNAM_" is already a Subscribing Protocol to "_J)
"RTN","PSJ317P",15,0)
 . ;Add subscriber to event driver
"RTN","PSJ317P",16,0)
 . S PEN(1)=IN,DATA(.01)=I
"RTN","PSJ317P",17,0)
 . S RETURN=$$ADD(101.0775,.PEN,.DATA,.ERROR)
"RTN","PSJ317P",18,0)
 . D MES^XPDUTL("Added "_SNAM_" as a subscriber to "_J)
"RTN","PSJ317P",19,0)
 ;S SNAM="PSJ ADT-A08-SDAM ROUTER"
"RTN","PSJ317P",20,0)
 S SNAM="PSJ SIU-SDAM ROUTER"
"RTN","PSJ317P",21,0)
 S I=$O(^ORD(101,"B",SNAM,0))
"RTN","PSJ317P",22,0)
 I 'I D MES^XPDUTL(SNAM_" Router Protocol Does Not Exist - Quitting!") Q
"RTN","PSJ317P",23,0)
 S J="VAFC ADT-A08-SDAM SERVER",IN=$O(^ORD(101,"B",J,0))
"RTN","PSJ317P",24,0)
 I 'IN D MES^XPDUTL(J_" Protocol Does Not Exist") Q
"RTN","PSJ317P",25,0)
 I $D(^ORD(101,IN,775,"B",I)) D  G LL  ;Skip if already present
"RTN","PSJ317P",26,0)
 . D MES^XPDUTL(SNAM_" is already a Subscribing Protocol to "_J)
"RTN","PSJ317P",27,0)
 ;Add subscriber to event driver
"RTN","PSJ317P",28,0)
 S PEN(1)=IN,DATA(.01)=I
"RTN","PSJ317P",29,0)
 S RETURN=$$ADD(101.0775,.PEN,.DATA,.ERROR)
"RTN","PSJ317P",30,0)
 D MES^XPDUTL("Added "_SNAM_" as a subscriber to "_J)
"RTN","PSJ317P",31,0)
 ;as per the VIE/HL7 team, hard set AUTOSTART field(4.5) to 1 (Enabled) & DO NOT PING field (#24) to "Yes" for PSJ PADE Logical Link 
"RTN","PSJ317P",32,0)
LL K DIC,DIE S (DIC,DIE)=870,DIC(0)="",X="PSJ PADE" D ^DIC Q:Y<0
"RTN","PSJ317P",33,0)
 S DR="4.5////1;24////1",DA=+Y D ^DIE K DIC,DIE,DR,DA
"RTN","PSJ317P",34,0)
 Q
"RTN","PSJ317P",35,0)
 ;
"RTN","PSJ317P",36,0)
ADD(FILE,PEN,DATA,ERROR,IEN) ;  Add 
"RTN","PSJ317P",37,0)
 N FDA,FIELD,IENA,IENS,ERRORS,DIERR
"RTN","PSJ317P",38,0)
 S PEN="+1"
"RTN","PSJ317P",39,0)
 S IENS=$$IENS^DILF(.PEN)
"RTN","PSJ317P",40,0)
 S FIELD=0
"RTN","PSJ317P",41,0)
 F  S FIELD=$O(DATA(FIELD)) Q:'FIELD  S FDA(FILE,IENS,FIELD)=$G(DATA(FIELD))
"RTN","PSJ317P",42,0)
 I $G(IEN) S IENA(1)=IEN
"RTN","PSJ317P",43,0)
 D UPDATE^DIE("","FDA","IENA","ERRORS(1)")
"RTN","PSJ317P",44,0)
 I +$G(DIERR) D
"RTN","PSJ317P",45,0)
 . D MES^XPDUTL($G(ERRORS(1,"DIERR",1,"TEXT",1)))
"RTN","PSJ317P",46,0)
 . S IEN=""
"RTN","PSJ317P",47,0)
 E  D
"RTN","PSJ317P",48,0)
 . S IEN=IENA(1)
"RTN","PSJ317P",49,0)
 D CLEAN^DILF
"RTN","PSJ317P",50,0)
 Q IEN
"RTN","PSJ317P",51,0)
TAG ;
"RTN","PSJ317P",52,0)
 ;;VAFC ADT-A01
"RTN","PSJ317P",53,0)
 ;;VAFC ADT-A02
"RTN","PSJ317P",54,0)
 ;;VAFC ADT-A03
"RTN","PSJ317P",55,0)
 ;;VAFC ADT-A08
"RTN","PSJ317P",56,0)
 ;;VAFC ADT-A08-TSP
"RTN","PSJ317P",57,0)
 ;;VAFC ADT-A11
"RTN","PSJ317P",58,0)
 ;;VAFC ADT-A12
"RTN","PSJ317P",59,0)
 ;;VAFC ADT-A13
"RTN","PSJ317P",60,0)
 ;;END
"RTN","PSJ317P",61,0)
 ;
"RTN","PSJHLU")
0^19^B50964072^B45959307
"RTN","PSJHLU",1,0)
PSJHLU ;BIR/RLW-UTILITIES USED IN BUILDING HL7 SEGMENTS ;4/24/12 2:52pm
"RTN","PSJHLU",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**1,56,72,102,134,181,267,285,317**;16 DEC 97;Build 130
"RTN","PSJHLU",3,0)
 ;
"RTN","PSJHLU",4,0)
 ; Reference to ^PS(52.6 is supported by DBIA# 1231.
"RTN","PSJHLU",5,0)
 ; Reference to ^PS(52.7 is supported by DBIA# 2173.
"RTN","PSJHLU",6,0)
 ; Reference to ^VA(200 is supported by DBIA 10060.
"RTN","PSJHLU",7,0)
 ; Reference to ^PS(55 is supported by DBIA# 2191.
"RTN","PSJHLU",8,0)
 ;
"RTN","PSJHLU",9,0)
 ;*267 Change NTE|21 so it can send over the Long Wp Special Inst/
"RTN","PSJHLU",10,0)
 ;     Other Prt Info fields if populated.
"RTN","PSJHLU",11,0)
 ;
"RTN","PSJHLU",12,0)
INIT ; set up HL7 application variables
"RTN","PSJHLU",13,0)
 S PSJHLSDT="PS",PSJHINST=$P($$SITE^VASITE(),"^")
"RTN","PSJHLU",14,0)
 S PSJCLEAR="K FIELD F J=0:1:LIMIT S FIELD(J)="""""
"RTN","PSJHLU",15,0)
 Q
"RTN","PSJHLU",16,0)
 ;
"RTN","PSJHLU",17,0)
SEGMENT(LIMIT) ;
"RTN","PSJHLU",18,0)
 K SEGMENT
"RTN","PSJHLU",19,0)
 N SUBSEG,SEGLENGT S SUBSEG=0,SEGMENT="" F J=0:1:LIMIT D
"RTN","PSJHLU",20,0)
 .I SEGMENT']"" S SEGMENT=FIELD(J) Q
"RTN","PSJHLU",21,0)
 .S SEGMENT=SEGMENT_"|"_FIELD(J)
"RTN","PSJHLU",22,0)
 F  S SEGLENGT=$L(SEGMENT) D  Q:$L(SEGMENT)'>246
"RTN","PSJHLU",23,0)
 .I SEGLENGT'>246 S SEGMENT(SUBSEG)=SEGMENT
"RTN","PSJHLU",24,0)
 .I SEGLENGT>245 S SEGMENT(SUBSEG)=$E(SEGMENT,1,245),SUBSEG=SUBSEG+1 D
"RTN","PSJHLU",25,0)
 ..S SEGMENT=$E(SEGMENT,246,SEGLENGT),SEGMENT(SUBSEG)=$E(SEGMENT,1,245)
"RTN","PSJHLU",26,0)
SET S PSJI=PSJI+1,^TMP("PSJHLS",$J,PSJHLSDT,PSJI)=SEGMENT(0)
"RTN","PSJHLU",27,0)
 F J=1:1 Q:'$D(SEGMENT(J))  S ^TMP("PSJHLS",$J,PSJHLSDT,PSJI,J)=SEGMENT(J)
"RTN","PSJHLU",28,0)
 Q
"RTN","PSJHLU",29,0)
 ;
"RTN","PSJHLU",30,0)
SEGMENT2 ; Retrieve text fields
"RTN","PSJHLU",31,0)
 K SEGMENT S JJ=0 F  S JJ=$O(@(PSJORDER_"12,"_JJ_")")) Q:'JJ  S SEGMENT(JJ-1)=$G(@(PSJORDER_"12,"_JJ_",0)"))
"RTN","PSJHLU",32,0)
 I $D(SEGMENT(0)) S SEGMENT(0)="NTE|6|L|"_$S($G(PSJBCBU):SEGMENT(0),1:$$ESC^ORHLESC(SEGMENT(0))) D
"RTN","PSJHLU",33,0)
 .D SET^PSJHLU K SEGMENT,JJ
"RTN","PSJHLU",34,0)
 ;build NTE 21 with Special Inst/Other Prt Info Wp fields  *267
"RTN","PSJHLU",35,0)
 N QQ K ^TMP("PSJBCMA5",$J)
"RTN","PSJHLU",36,0)
 D GETSIOPI^PSJBCMA5(PSJHLDFN,RXORDER,1)
"RTN","PSJHLU",37,0)
 I RXORDER["V"!(RXORDER["U") I ($G(PSJORD)["P"),($P($G(^PS(53.1,+PSJORD,0)),"^",25)=RXORDER) D
"RTN","PSJHLU",38,0)
 .D GETSIOPI^PSJBCMA5(PSJHLDFN,PSJORD,1)
"RTN","PSJHLU",39,0)
 .N LINES,TEXT1 S LINES=($G(^TMP("PSJBCMA5",$J,PSJHLDFN,PSJORD))),TEXT1=$G(^TMP("PSJBCMA5",$J,PSJHLDFN,PSJORD,1))
"RTN","PSJHLU",40,0)
 .I LINES<1!(LINES=1&(TEXT1["Instructions too long. See Order View or BCMA for full text")) Q
"RTN","PSJHLU",41,0)
 .K ^TMP("PSJBCMA5",$J,PSJHLDFN,RXORDER) M ^TMP("PSJBCMA5",$J,PSJHLDFN,RXORDER)=^TMP("PSJBCMA5",$J,PSJHLDFN,PSJORD) K ^TMP("PSJBCMA5",$J,PSJHLDFN,PSJORD)
"RTN","PSJHLU",42,0)
 F QQ=0:0 S QQ=$O(^TMP("PSJBCMA5",$J,PSJHLDFN,RXORDER,QQ)) Q:'QQ  D
"RTN","PSJHLU",43,0)
 .I QQ=1 D  Q
"RTN","PSJHLU",44,0)
 ..S SEGMENT(0)="NTE|21|L|"_$$ESC^ORHLESC(^TMP("PSJBCMA5",$J,PSJHLDFN,RXORDER,QQ))
"RTN","PSJHLU",45,0)
 ..S:$G(PSJBCBU) SEGMENT(0)=SEGMENT(0)_"\.br\"
"RTN","PSJHLU",46,0)
 .S SEGMENT(QQ-1)=$$ESC^ORHLESC(^TMP("PSJBCMA5",$J,PSJHLDFN,RXORDER,QQ))
"RTN","PSJHLU",47,0)
 .S:$G(PSJBCBU) SEGMENT(QQ-1)=SEGMENT(QQ-1)_"\.br\"
"RTN","PSJHLU",48,0)
 I $D(SEGMENT(0)) D SET^PSJHLU K SEGMENT,^TMP("PSJBCMA5",$J)
"RTN","PSJHLU",49,0)
 ;*267 end
"RTN","PSJHLU",50,0)
 Q
"RTN","PSJHLU",51,0)
 ;
"RTN","PSJHLU",52,0)
CALL(HLEVN) ; call DHCP HL7 package -or- protocol, to pass Orders
"RTN","PSJHLU",53,0)
 ; HLEVN = number of segments in message
"RTN","PSJHLU",54,0)
 ;*317
"RTN","PSJHLU",55,0)
 N PADE,PDTYP S PADE=0,PDTYP=""
"RTN","PSJHLU",56,0)
 I PSJORDER["^PS(55," D
"RTN","PSJHLU",57,0)
 . I $O(XQORMSG(0))&((PSOC="DR")!(PSOC="OD")) S PADE=1,PDTYP=PSOC Q
"RTN","PSJHLU",58,0)
 . I '$O(XQORMSG(0)) D
"RTN","PSJHLU",59,0)
 .. N PD0,PD1 S PD0=$G(@(PSJORDER_"0)"))
"RTN","PSJHLU",60,0)
 .. S PD1=$S(RXORDER["V":$P(PD0,"^",17),1:$P(PD0,"^",9)) Q:PD1=""
"RTN","PSJHLU",61,0)
 .. I ",A,D,H,"[(","_$E(PD1)_",") S PADE=1,PDTYP=PSOC
"RTN","PSJHLU",62,0)
 K CLERK,DDIEN,DDNUM,DOSEFORM,DOSEOR,FIELD,IVTYPE,LIMIT,NAME,NDNODE,NODE1,NODE2,PRODNAME,PROVIDER,PSGS0Y,PSJHINST,PSJHLSDT,PSJI,PSJORDER,PSOC,PSREASON,ROOMBED,SPDIEN,SEGMENT,%
"RTN","PSJHLU",63,0)
 I $G(PSJBCBU)=1 M PSJNAME=^TMP("PSJHLS",$J,"PS") Q
"RTN","PSJHLU",64,0)
 S PSJMSG="^TMP(""PSJHLS"",$J,""PS"")"
"RTN","PSJHLU",65,0)
 I PADE N RXO,PDMSG S RXO=RXORDER_$S(+RXORDER=RXORDER:"U",1:"") M PDMSG=^TMP("PSJHLS",$J,"PS")  ;*317
"RTN","PSJHLU",66,0)
 D MSG^XQOR("PS EVSEND OR",.PSJMSG)
"RTN","PSJHLU",67,0)
 I PADE D PDORD^PSJPDCLU  ;*317
"RTN","PSJHLU",68,0)
 I $G(RXORDER),$G(PSJHLDFN) N PSJSTOP S PSJSTOP=$S(RXORDER["U":$P(^PS(55,PSJHLDFN,5,+RXORDER,2),"^",4),RXORDER["V":$P(^PS(55,PSJHLDFN,"IV",+RXORDER,0),"^",3),1:"") I PSJSTOP D
"RTN","PSJHLU",69,0)
 .N PSJSTATU S PSJSTATU=$S(RXORDER["U":$P(^PS(55,PSJHLDFN,5,+RXORDER,0),"^",9),RXORDER["V":$P(^PS(55,PSJHLDFN,"IV",+RXORDER,0),"^",17),1:"")
"RTN","PSJHLU",70,0)
 .I ",A,H,"[(","_PSJSTATU_",") D NOW^%DTC I PSJSTOP<% N RXON S RXON=RXORDER D EXPIR^PSJHL6
"RTN","PSJHLU",71,0)
 Q
"RTN","PSJHLU",72,0)
 ;
"RTN","PSJHLU",73,0)
IVTYPE(PSJORDER) ; check whether a back-door order is Inpatient IV or IV fluid
"RTN","PSJHLU",74,0)
 I RXORDER["V",$P($G(@(PSJORDER_"0)")),"^",4)'="A" Q "I"
"RTN","PSJHLU",75,0)
 I RXORDER["P" I $P($G(@(PSJORDER_"0)")),"^",4)'="F" S IVTYPE="" Q IVTYPE
"RTN","PSJHLU",76,0)
 N SUB,AD,SOL,IVTYPE,NODE1 S SUB=0,IVTYPE="F"
"RTN","PSJHLU",77,0)
 ;naked reference on line below refers to the full indirect reference of PSJORDER_ which is from ^PS(55,DFN,"IV",PSJORD
"RTN","PSJHLU",78,0)
 F TYPE="AD","SOL" S SUB=0 F  S SUB=$O(@(PSJORDER_""""_TYPE_""""_","_SUB_")")) Q:(SUB="")!(IVTYPE="I")  S NODE1=$G(^(SUB,0)) Q:NODE1=""  D  Q:IVTYPE="I"
"RTN","PSJHLU",79,0)
 .I TYPE="AD" D
"RTN","PSJHLU",80,0)
 ..I '$P($G(^PS(52.6,$P(NODE1,"^"),0)),"^",13) S IVTYPE="I"
"RTN","PSJHLU",81,0)
 .D:TYPE="SOL"
"RTN","PSJHLU",82,0)
 ..S:'$P($G(^PS(52.7,$P(NODE1,"^"),0)),"^",13) IVTYPE="I"
"RTN","PSJHLU",83,0)
 Q IVTYPE
"RTN","PSJHLU",84,0)
ENI ;Calculate Frequency for IV orders
"RTN","PSJHLU",85,0)
 N INFUSE
"RTN","PSJHLU",86,0)
 I X?.E1L.E S INFUSE=$$ENLU^PSGMI(X) Q:(INFUSE="TITRATE")!(INFUSE="BOLUS")!($P(INFUSE," ")="INFUSE")!($P(INFUSE," ")="Infuse")
"RTN","PSJHLU",87,0)
 Q:(X="TITRATE")!(X="BOLUS")!($P(X," ")="INFUSE")!($P(X," ")="Infuse")
"RTN","PSJHLU",88,0)
 Q:$$INTRMT(X)
"RTN","PSJHLU",89,0)
 K:$L(X)<1!($L(X)>30)!(X["""")!($A(X)=45) X I '$D(X) Q
"RTN","PSJHLU",90,0)
 I X["=" D  Q   ; NOIS LOU-0501-42191
"RTN","PSJHLU",91,0)
 .N X2,X1 S X1=$P(X,"="),X2=$P(X,"=",2)
"RTN","PSJHLU",92,0)
 .I X1["ML/HR",(+X1=$P(X1,"ML/HR"))!(+X1=$P(X1," ML/HR")) D
"RTN","PSJHLU",93,0)
 ..S X1=$TR(X1,"ML/HR","ml/hr")
"RTN","PSJHLU",94,0)
 .I X2["ML/HR",(+X2=$P(X2,"ML/HR"))!(+X2=$P(X2," ML/HR")) D
"RTN","PSJHLU",95,0)
 ..S X2=$TR(X2,"ML/HR","ml/hr")
"RTN","PSJHLU",96,0)
 .I X1[" ml/hr",(+X1=$P(X1," ml/hr")) D
"RTN","PSJHLU",97,0)
 ..S X1=$P(X1," ml/hr")_$P(X1," ml/hr",2,9999)
"RTN","PSJHLU",98,0)
 .I X2[" ml/hr",(+X2=$P(X2," ml/hr")) D
"RTN","PSJHLU",99,0)
 ..S X2=$P(X2," ml/hr")_$P(X2," ml/hr",2,9999)
"RTN","PSJHLU",100,0)
 .I X1["ml/hr",(+X1=$P(X1,"ml/hr")) D
"RTN","PSJHLU",101,0)
 ..S X1=$P(X1,"ml/hr")_$P(X1,"ml/hr",2,9999)
"RTN","PSJHLU",102,0)
 .I X2["ml/hr",(+X2=$P(X2,"ml/hr")) D
"RTN","PSJHLU",103,0)
 ..S X2=$P(X2,"ml/hr")_$P(X2,"ml/hr",2,9999)
"RTN","PSJHLU",104,0)
 .I X2'=+X2 D
"RTN","PSJHLU",105,0)
 ..I ($P(X2,"@",2,999)'=+$P(X2,"@",2,999)!(+$P(X2,"@",2,999)<0)) K X Q
"RTN","PSJHLU",106,0)
 .I X1=+X1 S X1=X1_" ml/hr"
"RTN","PSJHLU",107,0)
 .I X2=+X2 S X2=X2_" ml/hr"
"RTN","PSJHLU",108,0)
 .S:$P(X2,"@")=+X2 $P(X2,"@")=$P(X2,"@")_" ml/hr"
"RTN","PSJHLU",109,0)
 .S X=X1_"="_X2
"RTN","PSJHLU",110,0)
 ;*285 - Allow for decimals with trailing zeroes
"RTN","PSJHLU",111,0)
 I X'?.N.1".".N,($P($TR(X," ml/hr",""),"@",2,999)'=+$P($TR(X," ml/hr",""),"@",2,999)!(+$P(X,"@",2,999)<0)),($P(X," ml/hr")'?.N.1".".N!(+$P(X," ml/hr")<0)) Q:(X>0&($E(X)=0))  K X Q
"RTN","PSJHLU",112,0)
 I X=+X!(X>0&($E(X)=0)) S:$S(X'["ml/hr":0,X["@":0,1:1) X=X_" ml/hr" D SPSOL S FREQ=$S('X:0,1:SPSOL\X*60+(SPSOL#X/X*60+.5)\1) K SPSOL Q
"RTN","PSJHLU",113,0)
 I X[" ml/hr" D SPSOL S FREQ=$S('X:0,1:SPSOL\X*60+(SPSOL#X/X*60+.5)\1) K SPSOL Q
"RTN","PSJHLU",114,0)
 S SPSOL=$P(X,"@",2) S:$P(X,"@")=+X $P(X,"@")=$P(X,"@")_" ml/hr" S FREQ=$S('SPSOL:0,1:1440/SPSOL\1) K SPSOL
"RTN","PSJHLU",115,0)
 Q
"RTN","PSJHLU",116,0)
SPSOL S SPSOL=+TVOLUME Q
"RTN","PSJHLU",117,0)
INTRMT(X) ;
"RTN","PSJHLU",118,0)
 Q:'$P(X," ") 0
"RTN","PSJHLU",119,0)
 Q:$P(X," ",2)="Minutes" 1
"RTN","PSJHLU",120,0)
 Q:$P(X," ",2)="Hours" 1
"RTN","PSJHLU",121,0)
 Q 0
"RTN","PSJHLU",122,0)
IVCAT(DFN,PSJORD,PARRAY) ; This returns the IV CATEGORY based on the IV TYPE and CHEMO TYPE (not what is already in the IV CATEGORY field)
"RTN","PSJHLU",123,0)
 ;  Passed in:  PSJORDER (file root of order)
"RTN","PSJHLU",124,0)
 N NODE,TYP,CHEMTYP,INTSYR,ND2P5
"RTN","PSJHLU",125,0)
 S (CHEMTYP,INTSYR)=""
"RTN","PSJHLU",126,0)
 S TYP=$G(P(4)),INTSYR=$G(P(5)),CHEMTYP=$G(P(23))
"RTN","PSJHLU",127,0)
 I TYP="",$G(PSJORD)["V" S NODE=$G(^PS(55,DFN,"IV",+PSJORD,0)) S TYP=$P(NODE,"^",4),INTSYR=$P(NODE,"^",5),CHEMTYP=$P(NODE,"^",23)
"RTN","PSJHLU",128,0)
 I TYP="",$G(PSJORD)["P" S NODE=$G(^PS(53.1,+PSJORD,8)) S TYP=$P(NODE,"^"),INTSYR=$P(NODE,"^",4),CHEMTYP=$P(NODE,"^",2)
"RTN","PSJHLU",129,0)
 I TYP="" S TYP=$G(PARRAY(4)),INTSYR=$G(PARRAY(5)),CHEMTYP=$G(PARRAY(23))
"RTN","PSJHLU",130,0)
 Q:$G(TYP)="" ""
"RTN","PSJHLU",131,0)
 S CAT=$S(",A,H,"[(","_TYP_","):"C",TYP="C"&(",A,H,S,"[(","_CHEMTYP_",")&'INTSYR):"C",TYP="C"&(CHEMTYP="P"):"I",TYP="S"&'INTSYR:"C",TYP="P":"I",$G(INTSYR):"I",1:"")
"RTN","PSJHLU",132,0)
 Q CAT
"RTN","PSJHLU",133,0)
ZRX ; Perform outbound processing
"RTN","PSJHLU",134,0)
 N NODE1
"RTN","PSJHLU",135,0)
 S NODE1=$G(@(PSJORDER_"0)"))
"RTN","PSJHLU",136,0)
 S LIMIT=6 X PSJCLEAR
"RTN","PSJHLU",137,0)
 S FIELD(0)="ZRX"
"RTN","PSJHLU",138,0)
 I '$G(PSJREN) N PREON,PSJREN I $G(PSJORD)["U"&($P(NODE1,"^",24)="R") S PSJREN=1
"RTN","PSJHLU",139,0)
 I $G(PSJORD)["V"&($P(NODE2,"^",8)="R") S PSJREN=1
"RTN","PSJHLU",140,0)
 S PREON=$S($G(PSJREN):$G(PSJORD),PSJORDER["IV":$P(NODE2,"^",5),1:$P(NODE1,"^",25))
"RTN","PSJHLU",141,0)
 S FIELD(1)=$S(PREON["P":$P($G(^PS(53.1,+PREON,0)),"^",21),PREON["V":$P($G(^PS(55,PSJHLDFN,"IV",+PREON,0)),"^",21),1:$P($G(^PS(55,PSJHLDFN,5,+PREON,0)),"^",21))
"RTN","PSJHLU",142,0)
 S FIELD(2)=$S(PSJORDER["IV":$G(P("NAT")),1:$G(PSJNOO))
"RTN","PSJHLU",143,0)
 S FIELD(3)=$S($G(PSJREN):"R",PSJORDER["IV":$P(NODE2,"^",8),1:$P(NODE1,"^",24))
"RTN","PSJHLU",144,0)
 I FIELD(3)="" I PSOC="SN" S FIELD(3)="N"
"RTN","PSJHLU",145,0)
 I $D(P)>1 S FIELD(6)=$$IVCAT^PSJHLU(PSJHLDFN,RXORDER,.P)
"RTN","PSJHLU",146,0)
 S NAME=$P($G(^VA(200,DUZ,0)),"^")
"RTN","PSJHLU",147,0)
 S FIELD(5)=DUZ_"^"_$S($G(PSJBCBU):NAME,1:$$ESC^ORHLESC(NAME))_"^"_"99NP"
"RTN","PSJHLU",148,0)
 D SEGMENT^PSJHLU(LIMIT),DISPLAY^PSJHL2
"RTN","PSJHLU",149,0)
 Q
"RTN","PSJLMPRU")
0^12^B19004803^B15059824
"RTN","PSJLMPRU",1,0)
PSJLMPRU ;BIR/MLM - INPATIENT LISTMAN UD PROFILE UTILITIES ;27 Aug 98 / 8:45 AM
"RTN","PSJLMPRU",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**16,58,85,110,185,181,267,323,317**;16 DEC 97;Build 130
"RTN","PSJLMPRU",3,0)
 ;
"RTN","PSJLMPRU",4,0)
 ; Reference to ^PSDRUG is supported by DBIA 2192.
"RTN","PSJLMPRU",5,0)
 ; Reference to ^PS(55 is supported by DBIA 2191.
"RTN","PSJLMPRU",6,0)
 ; Reference to $$GET^XPAR is supported by DBIA 2263
"RTN","PSJLMPRU",7,0)
 ;
"RTN","PSJLMPRU",8,0)
PUD(DFN,ON,PSJF,DN) ; Setup LM profile view for UD
"RTN","PSJLMPRU",9,0)
 N PSJFLAG,PSJV,PADE
"RTN","PSJLMPRU",10,0)
 ; Naked references on the two lines below refer to full reference ^PS(55,DFN,5,+ON in PSJF using indirection.
"RTN","PSJLMPRU",11,0)
 S ND=$G(@(PSJF_+ON_",0)")),SCH=$G(^(2)),ND4=$G(^(4)),ND6=$G(^(6)),NDP2=$G(^(.2)),PSJFLAG=$P(NDP2,U,7),X=$P(DN,U,2),DO=$S('X:"",1:$G(^(+X))) S:X=.2 DO=$P(DO,U,2)
"RTN","PSJLMPRU",12,0)
 S ND14=$G(@(PSJF_+ON_",14,0)")),RNDT="" I $P(ND14,"^",3) S ND14=$G(^($P(ND14,"^",3),0)),RNDT=$P(ND14,"^")
"RTN","PSJLMPRU",13,0)
 I ("AO"[PSJC)!(PSJC="DF") D
"RTN","PSJLMPRU",14,0)
 .S V='$P(ND4,"^",UDU),PSJL=$$SETSTR^VALM1($S(ND4="":" ",$P(ND4,"^",12):"D",$P(ND4,"^",19)&$P(ND4,"^",18):"H",$P(ND4,"^",23)&$P(ND4,"^",22):"H",$P(ND4,"^",15)&($P(ND4,"^",16)!V):"R",1:" "),PSJL,5,1)
"RTN","PSJLMPRU",15,0)
 .S PSJV=$S($P(NDP2,U,4)="D":"d",1:" ")_$S(+PSJSYSU=1&V:"->",+PSJSYSU=3&V:"->",1:"   ") I PSJFLAG D CNTRL^VALM10(PSJLN,1,4,IORVON,IORVOFF,0)
"RTN","PSJLMPRU",16,0)
 .S PSJL=$$SETSTR^VALM1(PSJV,PSJL,6,3)
"RTN","PSJLMPRU",17,0)
 S RTE=$P(ND,"^",3),SM=$S('$P(ND,"^",5):0,$P(ND,"^",6):1,1:2),STAT=$S($P(ND,U,28)]"":$P(ND,U,28),$P(ND,"^",9)]"":$P(ND,"^",9),1:"NF"),PF=$E("*",$P(ND,"^",20)>0),PSGID=$P(SCH,"^",2),SD=$P(SCH,"^",4),SCH=$P(SCH,"^")
"RTN","PSJLMPRU",18,0)
 I STAT="A",$P(ND,U,27)="R" S STAT="R"
"RTN","PSJLMPRU",19,0)
 S NF="",WS=$S(PSJPWD:$$WS^PSJO(PSJPWD,PSGP,PSJF,+ON),1:0)
"RTN","PSJLMPRU",20,0)
 I $D(PSJCLIN) S WS=0  ; PSJ*5*323
"RTN","PSJLMPRU",21,0)
 ; PSJ*5*317 - If PSJ PADE OE BALANCES parameter is YES, PADE balances should display as identifier
"RTN","PSJLMPRU",22,0)
 S PADE=0 I $$GET^XPAR("SYS","PSJ PADE OE BALANCES") D
"RTN","PSJLMPRU",23,0)
 .N PSJORCL,PSJCLNK
"RTN","PSJLMPRU",24,0)
 .; If clinic order, quit if clinic location is not linked to PADE
"RTN","PSJLMPRU",25,0)
 .S PSJORCL=$S($G(ON)["P":$G(^PS(53.1,+$G(ON),"DSS")),$G(ON)["U":$G(^PS(55,+$G(PSGP),5,+$G(ON),8)),$G(ON)["V":$G(^PS(55,+$G(PSGP),"IV",+$G(ON),"DSS")),1:"")
"RTN","PSJLMPRU",26,0)
 .I PSJORCL,$P(PSJORCL,"^",2) S PSJCLNK=$$PADECL^PSJPAD50(+$G(PSJORCL)) Q:'PSJCLNK
"RTN","PSJLMPRU",27,0)
 .I '$G(VAIN(4)) N VAIN D INP^VADPT
"RTN","PSJLMPRU",28,0)
 .I '$G(PSJCLNK) Q:'$$PADEWD^PSJPAD50(+$G(VAIN(4)))
"RTN","PSJLMPRU",29,0)
 .S PADE=$$DRGFLAG^PSJPADSI(PSGP,$G(ON),,$G(ON),$G(PSJNEWOE)) S:PADE=0 PADE=1
"RTN","PSJLMPRU",30,0)
 N PSJDISP F PSJDISP=0:0 S PSJDISP=$O(@(PSJF_+ON_",1,"_PSJDISP_")")) Q:'PSJDISP  D
"RTN","PSJLMPRU",31,0)
 .I $P($G(^PSDRUG(+$P($G(@(PSJF_+ON_",1,"_PSJDISP_",0)")),"^"),0)),"^",9)=1 S NF=1
"RTN","PSJLMPRU",32,0)
 NEW DRUGNAME,PSGID1,SD1,LEN,PSGID1,SD1 S LEN=$S($D(PSJEXPT):8,1:5)
"RTN","PSJLMPRU",33,0)
 F X="PSGID","SD" S @(X_1)=$S(PSJC["C":"*****",1:$E($$ENDTC^PSGMI(@X),1,LEN))
"RTN","PSJLMPRU",34,0)
 D DRGDISP^PSJLMUT1(PSGP,ON,39,54,.DRUGNAME,0)
"RTN","PSJLMPRU",35,0)
 F PSJX=0:0 S PSJX=$O(DRUGNAME(PSJX)) Q:'PSJX  D
"RTN","PSJLMPRU",36,0)
 .I PSJX=1 D
"RTN","PSJLMPRU",37,0)
 ..I PSJFLAG D CNTRL^VALM10(PSJLN,1,4,IORVON,IORVOFF,0)
"RTN","PSJLMPRU",38,0)
 ..S PSJL=$$SETSTR^VALM1($S($E(PSJS)="*":$P(PSJS,"^"),1:DRUGNAME(PSJX)),PSJL,9,39)
"RTN","PSJLMPRU",39,0)
 ..S PSJL=$$SETSTR^VALM1($S(PSJC["C":"?",PSJSCHT'="z":PSJSCHT,1:"?"),PSJL,50,3)
"RTN","PSJLMPRU",40,0)
 ..S PSJL=PSJL_PSGID1_"  "_SD1_" "_$E(STAT,1,2)_$S($L(STAT)=1:"     ",1:"    ")_$S($G(RNDT):$E($$ENDTC^PSGMI(RNDT),1,LEN),1:"")
"RTN","PSJLMPRU",41,0)
 ..I NF!WS!SM!PF!$G(PADE) S PSJL=$$SETSTR^VALM1($S(NF:"NF ",(WS&PADE):"WP ",(PADE&'WS):"PD ",WS:"WS ",SM:$E("HSM",SM,3),1:""),PSJL,69,3) S:PF PSJL=$$SETSTR^VALM1("*",PSJL,79,1)
"RTN","PSJLMPRU",42,0)
 . I PSJX>1 S PSJL="",PSJL=$$SETSTR^VALM1(DRUGNAME(PSJX),PSJL,11,66)
"RTN","PSJLMPRU",43,0)
 . D SETTMP("PSJPRO",PSJL) I ($P(NDP2,U,4)="S"),STAT="P" D CNTRL^VALM10((PSJLN-1),9,9+$L(PSJL),IOINHI_IOBON,IOINORM,0)
"RTN","PSJLMPRU",44,0)
 I ND6'="" N X,PSJTXT3 S X=$$GETSIOPI^PSJBCMA5(DFN,ON) N TXTLN S TXTLN=0 F  S TXTLN=$O(^PS(53.45,DUZ,5,TXTLN)) Q:'TXTLN!$G(PSJTXT3)  D
"RTN","PSJLMPRU",45,0)
 .I ($O(^PS(53.45,DUZ,5," "),-1)>3) S PSJTXT3=1 S PSJL="Instructions too long. See Order View for full text." D PTXT(PSJL,"PSJPRO",10,66) Q
"RTN","PSJLMPRU",46,0)
 .S PSJL=^PS(53.45,DUZ,5,TXTLN,0) D PTXT(PSJL,"PSJPRO",10,66)
"RTN","PSJLMPRU",47,0)
 K ^PS(53.45,DUZ,5)
"RTN","PSJLMPRU",48,0)
 Q
"RTN","PSJLMPRU",49,0)
 ;
"RTN","PSJLMPRU",50,0)
PTXT(TXT,SUB,LM,RM) ; Display Instructions/dosage ordered.
"RTN","PSJLMPRU",51,0)
 ;* Input:       TXT = Text to display.
"RTN","PSJLMPRU",52,0)
 ;                       SUB = First subscript for ^TMP node, ** MUST be PSJ namespace **
"RTN","PSJLMPRU",53,0)
 ;                       LM  = Begin display of text after LM spaces.
"RTN","PSJLMPRU",54,0)
 ;                       RM  = Length of display text.
"RTN","PSJLMPRU",55,0)
 ;                       
"RTN","PSJLMPRU",56,0)
 ;BHW;PSJ*5*185;Extra spaces causes display to "skip" part of the field. 
"RTN","PSJLMPRU",57,0)
 ;S PSJL="",$P(PSJL," ",LM)="" F X=1:1 S WRD=$P(TXT," ",X) Q:WRD=""  D
"RTN","PSJLMPRU",58,0)
 S PSJL="",$P(PSJL," ",LM)=""
"RTN","PSJLMPRU",59,0)
 F X=1:1:$L(TXT," ") S WRD=$P(TXT," ",X) D
"RTN","PSJLMPRU",60,0)
 .;BHW;PSJ*5*185;check if end of string or just extra space
"RTN","PSJLMPRU",61,0)
 .I WRD="" S PSJL=PSJL_" " Q 
"RTN","PSJLMPRU",62,0)
 .I $L(PSJL_" "_WRD)'<RM D SETTMP(SUB,PSJL) S PSJL="",$P(PSJL," ",10)=""
"RTN","PSJLMPRU",63,0)
 .I $L(PSJL_" "_WRD)'<RM S PSJL=PSJL_" "_$E(WRD,1,(RM-10)) D SETTMP(SUB,PSJL) S PSJL="",$P(PSJL," ",10)="",WRD=$E(WRD,(RM-9),$L(WRD))
"RTN","PSJLMPRU",64,0)
 .S PSJL=PSJL_" "_WRD
"RTN","PSJLMPRU",65,0)
 D SETTMP(SUB,PSJL)
"RTN","PSJLMPRU",66,0)
 Q
"RTN","PSJLMPRU",67,0)
SETTMP(SUB,PSJL) ;
"RTN","PSJLMPRU",68,0)
 S ^TMP(SUB,$J,PSJLN,0)=PSJL,PSJLN=PSJLN+1
"RTN","PSJLMPRU",69,0)
 Q
"RTN","PSJLMUDE")
0^13^B86619867^B69470677
"RTN","PSJLMUDE",1,0)
PSJLMUDE ;BIR/MLM-SHOW FIELDS FOR EDIT (LISTMAN STYLE) ;01 JUNE 00 / 2:40 PM
"RTN","PSJLMUDE",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**7,47,50,63,64,58,80,116,110,111,164,175,201,181,254,267,228,315,317**;16 DEC 97;Build 130
"RTN","PSJLMUDE",3,0)
 ;
"RTN","PSJLMUDE",4,0)
 ;NFI-UD Fr#:2 chgs@init+4 to display non-formulary (N/F)
"RTN","PSJLMUDE",5,0)
 ;also chgs @init+23
"RTN","PSJLMUDE",6,0)
 ;
"RTN","PSJLMUDE",7,0)
 ; Reference to ^PS(55 is supported by DBIA# 2191
"RTN","PSJLMUDE",8,0)
 ; Reference to ^PSDRUG is supported by DBIA 2192
"RTN","PSJLMUDE",9,0)
 ; Reference to $$GET^XPAR is supported by DBIA #2263
"RTN","PSJLMUDE",10,0)
 ;
"RTN","PSJLMUDE",11,0)
INIT(PSGP,PSGORD) ;
"RTN","PSJLMUDE",12,0)
 N D,ND,PSJBCMA,PSJL,PSJLM,PSJLN,Q,QQ,PSJDUR,J K ^TMP("PSJUDE",$J),^TMP($J,"GMRAING")
"RTN","PSJLMUDE",13,0)
 K:$G(PSJNORD) PSGOEEF S PSJLN=1
"RTN","PSJLMUDE",14,0)
 D CLEAN^VALM10
"RTN","PSJLMUDE",15,0)
 S PSJL=$S($D(PSGEFN(1)):$E(" *",PSGEFN(1)+1)_"(1)",1:"   "),PSJL=$$SETSTR^VALM1("Orderable Item: "_PSGPDN_$$OINF^PSJDIN(PSGPD),PSJL,5,74) D  D SETTMP D:$G(PSGOEEF(108))!($G(PSGOEEF(101))) HILITE(1)
"RTN","PSJLMUDE",16,0)
 . NEW Q,PSJDDA,PSJVD F Q=0:0 S Q=$O(^PS(53.45,PSJSYSP,2,Q)) Q:'Q  S PSJDDA(+$G(^(Q,0)))=""
"RTN","PSJLMUDE",17,0)
 . S PSJVD=$$DINFLUD^PSJDIN(PSGPD,.PSJDDA)
"RTN","PSJLMUDE",18,0)
 . I $$OVRCHK^PSGSICH1(PSGP,PSGORD) S PSJVD="<OCI>"_PSJVD
"RTN","PSJLMUDE",19,0)
 . S PSJL=$$SETSTR^VALM1(PSJVD,PSJL,(80-$L(PSJVD)),80)
"RTN","PSJLMUDE",20,0)
 . D:PSJVD]"" CNTRL^VALM10(1,80-$L(PSJVD),$L(PSJVD),IORVON,IORVOFF,0)
"RTN","PSJLMUDE",21,0)
 I $G(PSJORD)["P" D REQDT^PSJLIVMD(PSJORD)
"RTN","PSJLMUDE",22,0)
 S PSJL="Instructions: "_PSGOINST D PTXT^PSJLMPRU(PSJL,"PSJUDE",6,80)
"RTN","PSJLMUDE",23,0)
 S PSJL=$S($D(PSGEFN(2)):$E(" *",PSGEFN(2)+1)_"(2)",1:"    "),PSJL=$$SETSTR^VALM1("Dosage Ordered: "_PSGDO,PSJL,5,76) D SETTMP D:$G(PSGOEEF(109)) HILITE(2)
"RTN","PSJLMUDE",24,0)
 I $G(PSGRDTX) S PSJDUR=$$FMTDUR^PSJLIVMD($P($G(PSGRDTX),U,2))
"RTN","PSJLMUDE",25,0)
 I $G(PSJORD),($G(PSJDUR)="") S P=$S(PSJORD["U":5,PSJORD["V":"IV",PSJORD["P":"P",1:-1) S PSJDUR=$$GETDUR^PSJLIVMD(PSGP,+PSJORD,P)
"RTN","PSJLMUDE",26,0)
 S PSJL=$$SETSTR^VALM1("Duration: "_$G(PSJDUR),PSJL,11,25)
"RTN","PSJLMUDE",27,0)
 S PSJL=$$SETSTR^VALM1($S($D(PSGEFN(3)):$E(" *",PSGEFN(3)+1)_"(3)",1:"    ")_"Start: "_$P(PSGSDN,U,2),PSJL,54,26) D:$G(PSGOEEF(10)) HILITE(3)
"RTN","PSJLMUDE",28,0)
 I $G(PSGORD)["P" N ND0,OLDO S ND0=@(PSGOEEWF_"0)") I $P(ND0,"^",24)="R" S OLDO=$P(ND0,"^",25) I OLDO,(OLDO["U") D
"RTN","PSJLMUDE",29,0)
 . N OSTRT,OSTRTN S OSTRT=$G(@("^PS(55,"_PSGP_",5,"_+OLDO_",2)")),OSTRT=$P(OSTRT,"^",2) Q:'OSTRT  S OSTRTN=$$ENDTC^PSGMI(+OSTRT)
"RTN","PSJLMUDE",30,0)
 . S PSJL=$$SETSTR^VALM1($S($D(PSGEFN(3)):$E(" *",PSGEFN(3)+1)_"(3)",1:"    ")_"Start: "_OSTRTN,PSJL,54,26)
"RTN","PSJLMUDE",31,0)
 D SETTMP
"RTN","PSJLMUDE",32,0)
 S PSJL=$S($D(PSGEFN(4)):$E(" *",PSGEFN(4)+1)_"(4)",1:"    "),PSJL=$$SETSTR^VALM1("Med Route: "_PSGMRN,PSJL,10,35) D:$G(PSGOEEF(3)) HILITE(4)
"RTN","PSJLMUDE",33,0)
 I $G(PSJORD)["P" N PSGRNDT S PSGRNDT=$$LASTREN^PSJLMPRI(DFN,PSGORD) S:PSGRNDT PSGRNDT=$$ENDTC^PSGMI(+PSGRNDT),PSJL=$$SETSTR^VALM1("Renewed: "_PSGRNDT,PSJL,56,32)
"RTN","PSJLMUDE",34,0)
 I '$G(PSGRNDT),$G(PSGRDTX) D
"RTN","PSJLMUDE",35,0)
 . I $D(PSGRDTX)<10 S PSGRSDN=$$ENDTC^PSGMI(+PSGRDTX),PSJL=$$SETSTR^VALM1("REQUESTED START: "_PSGRSDN,PSJL,48,32) Q
"RTN","PSJLMUDE",36,0)
 . I $G(PSGRDTX(+$G(PSJORD),"PSGRSD")),$P($G(PSGSDN),U,2) S PSGRSDN=$$ENDTC^PSGMI(PSGRDTX(+PSJORD,"PSGRSD")),PSJL=$$SETSTR^VALM1("Calc Start: "_PSGRSDN,PSJL,53,32) D
"RTN","PSJLMUDE",37,0)
 .. I PSGSD'=PSGRDTX(+PSJORD,"PSGRSD") D CNTRL^VALM10(5,53,80,IORVON,IORVOFF)
"RTN","PSJLMUDE",38,0)
 ; Indirect reference in PSGOEEWF below refers to either ^PS(53.1 or ^PS(55,DFN,5,. Naked reference refers to full indirect reference
"RTN","PSJLMUDE",39,0)
 I $G(PSJORD)["U" N ND14 S ND14=$G(@(PSGOEEWF_"14,0)")) I ND14]"" S ND14=$G(^($P(ND14,"^",3),0)),RNDT=$P(ND14,"^") I RNDT D
"RTN","PSJLMUDE",40,0)
 . N PSGRNDT S PSGRNDT=$$ENDTC^PSGMI(+RNDT),PSJL=$$SETSTR^VALM1("Renewed: "_PSGRNDT,PSJL,56,32)
"RTN","PSJLMUDE",41,0)
 D SETTMP
"RTN","PSJLMUDE",42,0)
 I PSGORD]"" S PSJBCMA=$$BCMALG^PSJUTL2(PSGP,PSGORD)
"RTN","PSJLMUDE",43,0)
 I $G(PSJBCMA)]"" S PSJL=$$SETSTR^VALM1(PSJBCMA,PSJL,1,52)
"RTN","PSJLMUDE",44,0)
 S PSJL=$$SETSTR^VALM1($S($D(PSGEFN(5)):$E(" *",PSGEFN(5)+1)_"(5)",1:"     ")_" Stop: "_$P(PSGFDN,U,2),PSJL,54,26) D SETTMP D:$G(PSGOEEF(25))!($G(PSGOEEF(34))) HILITE(5)
"RTN","PSJLMUDE",45,0)
 S PSJL=$S($D(PSGEFN(6)):$E(" *",PSGEFN(6)+1)_"(6)",1:"   "),PSJL=$$SETSTR^VALM1("Schedule Type: "_PSGSTN,PSJL,6,45) D:$G(PSGOEEF(7)) HILITE(6)
"RTN","PSJLMUDE",46,0)
 I $G(PSJORD)["P",$G(PSGRDTX(+$G(PSJORD),"PSGRFD")),$P($G(PSGFDN),U,2) S PSGRFDN=$$ENDTC^PSGMI(PSGRDTX(+PSJORD,"PSGRFD")),PSJL=$$SETSTR^VALM1("Calc Stop: "_PSGRFDN,PSJL,54,26) D
"RTN","PSJLMUDE",47,0)
 . I PSGFD'=PSGRDTX(+PSJORD,"PSGRFD") D CNTRL^VALM10(7,54,80,IORVON,IORVOFF)
"RTN","PSJLMUDE",48,0)
 D SETTMP
"RTN","PSJLMUDE",49,0)
 S PSGSMN=$P("NO^YES",U,PSGSM+1)
"RTN","PSJLMUDE",50,0)
 S PSJL=$S($D(PSGEFN(8)):$E(" *",PSGEFN(8)+1)_"(8)",1:"   "),PSJL=$$SETSTR^VALM1("Schedule: "_PSGSCH_$G(SCHMSG),PSJL,11,68) D SETTMP D:$G(PSGOEEF(26)) HILITE(8)
"RTN","PSJLMUDE",51,0)
 S PSJL=$S($D(PSGEFN(9)):$E(" *",PSGEFN(9)+1)_"(9)",1:"   "),PSJL=$$SETSTR^VALM1("Admin Times: "_PSGAT,PSJL,8,71) D SETTMP D:'$G(PSGNOHI)&($G(PSGOEEF(39))!($G(PSGOEEF(41)))) HILITE(9) ;*315
"RTN","PSJLMUDE",52,0)
 I +$G(PSGRF)>1 N PSGRMVD S PSGRMVD=$S(+$G(PSGRMVT):PSGRMVT,1:"") S PSJL=$$SETSTR^VALM1("Removal Times: "_PSGRMVD,PSJL,6,71) D SETTMP ;*315
"RTN","PSJLMUDE",53,0)
 S PSJL=$S($D(PSGEFN(10)):$E(" *",PSGEFN(10)+1)_"(10)",1:"   "),PSJL=$$SETSTR^VALM1("Provider: "_PSGPRN,PSJL,11,68) D:$G(PSGOEEF(1)) HILITE(10) D SETTMP
"RTN","PSJLMUDE",54,0)
 S PSJL=$S($D(PSGEFN(11)):$E(" *",PSGEFN(11))_" (11)",1:"   ")_" Special Instructions"_$S($P(PSGSI,"^",2)=1:"!: ",1:": ") D
"RTN","PSJLMUDE",55,0)
 .I '$D(^PS(53.45,DUZ,5,1)),$G(PSGORD) D GETSI^PSJBCMA5(PSGP,PSGORD)
"RTN","PSJLMUDE",56,0)
 .I '$P($G(^PS(53.45,DUZ,5,0)),"^",3) S PSJL=PSJL_$P($G(PSGSI),"^") D PTXT^PSJLMPRU(PSJL,"PSJUDE",1,80) Q
"RTN","PSJLMUDE",57,0)
 .S PSJL=PSJL_" (see below)" D SETTMP N I S I=0 F J=1:1 S I=$O(^PS(53.45,DUZ,5,I)) Q:'I  S PSJL="      "_^PS(53.45,DUZ,5,I,0) D SETTMP
"RTN","PSJLMUDE",58,0)
 S PSJL="" D SETTMP D:$G(PSGOEEF(8)) HILITE(11)
"RTN","PSJLMUDE",59,0)
 ; E3R 16130
"RTN","PSJLMUDE",60,0)
 I $O(^PS(53.45,PSJSYSP,2,1)) F  S PSJL="" D SETTMP Q:PSJLN>15
"RTN","PSJLMUDE",61,0)
 S PSJL=$S($D(PSGEFN(12)):$E(" *",PSGEFN(12))_" (12)",1:"   ")_" Dispense Drug",PSJL=$$SETSTR^VALM1("U/D",PSJL,52,60),PSJL=$$SETSTR^VALM1("Inactive Date",PSJL,59,16) D  D SETTMP,CNTRL^VALM10(PSJLN-1,1,80,IOUON,IOUOFF,0)
"RTN","PSJLMUDE",62,0)
 .I $$GET^XPAR("SYS","PSJ PADE OE BALANCES") D
"RTN","PSJLMUDE",63,0)
 ..I '$G(VAIN(4)) N VAIN,DFN S DFN=$G(PSGP) D INP^VADPT
"RTN","PSJLMUDE",64,0)
 ..N PSJORCL,PSJCLNK
"RTN","PSJLMUDE",65,0)
 ..; If clinic order, quit if clinic location is not linked to PADE
"RTN","PSJLMUDE",66,0)
 ..S PSJORCL=$S($G(PSGORD)["P":$G(^PS(53.1,+$G(PSGORD),"DSS")),$G(PSGORD)["U":$G(^PS(55,+$G(PSGP),5,+$G(PSGORD),8)),$G(PSGORD)["V":$G(^PS(55,+$G(PSGP),"IV",+$G(PSGORD),"DSS")),1:"")
"RTN","PSJLMUDE",67,0)
 ..I PSJORCL,$P(PSJORCL,"^",2) S PSJCLNK=$$PADECL^PSJPAD50(+$G(PSJORCL)) Q:'PSJCLNK
"RTN","PSJLMUDE",68,0)
 ..I '$G(PSJCLNK) Q:'$$PADEWD^PSJPAD50(+$G(VAIN(4)))   ; PADE device Inactive?
"RTN","PSJLMUDE",69,0)
 ..S PSJL=$$SETSTR^VALM1("PADE",PSJL,75,5)
"RTN","PSJLMUDE",70,0)
 NEW PSJX,PSJDLINE
"RTN","PSJLMUDE",71,0)
 F Q=0:0 S Q=$O(^PS(53.45,PSJSYSP,2,Q)) Q:'Q  S ND=$G(^(Q,0)) D
"RTN","PSJLMUDE",72,0)
 .S D=$P(ND,"^"),PSGID=$P(ND,"^",3) I PSGID S PSGID=$$ENDTC^PSGMI(PSGID)
"RTN","PSJLMUDE",73,0)
 .S D=$S(D="":"NOT FOUND",'$D(^PSDRUG(D,0)):D,$P(^(0),"^")]"":$P(^(0),"^"),1:D_";PSDRUG(")
"RTN","PSJLMUDE",74,0)
 .S PSJL="      "_D_$$DDNF^PSJDIN(+ND),PSJL=$$SETSTR^VALM1($S($P(ND,"^",2):$S($P(ND,"^",2)=.5:"1/2",$P(ND,"^",2)=.25:"1/4",1:$P(ND,"^",2)),$P(ND,"^",2)=0:0,1:1),PSJL,52,63) S:PSGID PSJL=$$SETSTR^VALM1(PSGID,PSJL,59,16) D  D SETTMP
"RTN","PSJLMUDE",75,0)
 ..; PSJ*5*317 - If PSJ PADE OE BALANCES parameter is YES, PADE balances should display as identifier.
"RTN","PSJLMUDE",76,0)
 ..I $$GET^XPAR("SYS","PSJ PADE OE BALANCES") D
"RTN","PSJLMUDE",77,0)
 ...N PSJPDLOC,VAIN,PSJORCL,PSJCLNK,PSJCLND D INP^VADPT
"RTN","PSJLMUDE",78,0)
 ...; If clinic order, quit if clinic location is not linked to PADE
"RTN","PSJLMUDE",79,0)
 ...S PSJCLND=$S($G(PSGORD)["P":$G(^PS(53.1,+$G(PSGORD),"DSS")),$G(PSGORD)["U":$G(^PS(55,+$G(PSGP),5,+$G(PSGORD),8)),$G(PSGORD)["V":$G(^PS(55,+$G(PSGP),"IV",+$G(PSGORD),"DSS")),1:"")
"RTN","PSJLMUDE",80,0)
 ...S PSJORCL=$S(+PSJCLND&$P(PSJCLND,"^",2):+PSJCLND,1:"")
"RTN","PSJLMUDE",81,0)
 ...I PSJORCL,$P(PSJCLND,"^",2) S PSJCLNK=$$PADECL^PSJPAD50(+$G(PSJORCL)) Q:'PSJCLNK
"RTN","PSJLMUDE",82,0)
 ...I '$G(PSJCLNK) Q:'$$PADEWD^PSJPAD50(+$G(VAIN(4)))   ; Quit if patient location not linked to PADE
"RTN","PSJLMUDE",83,0)
 ...S PSJPDLOC=$S($G(PSJCLNK):PSJORCL_"C",1:"")
"RTN","PSJLMUDE",84,0)
 ...S:'PSJPDLOC PSJPDLOC=+$G(VAIN(4))
"RTN","PSJLMUDE",85,0)
 ...N PADE S PADE=$J($$DRGQTY^PSJPADSI(+ND,$S(PSJPDLOC["C":"CL",1:"WD"),+PSJPDLOC),5)
"RTN","PSJLMUDE",86,0)
 ...S PSJL=$$SETSTR^VALM1(PADE,PSJL,74,5)
"RTN","PSJLMUDE",87,0)
 ..S PSJX=$G(PSJX)+1
"RTN","PSJLMUDE",88,0)
 ..S PSJDLINE=$S($P(^PS(53.45,PSJSYSP,2,0),U,3)>1:16,1:13) ;*228 - Highlight multiple dispense drugs
"RTN","PSJLMUDE",89,0)
 ..I $G(PSGOEEF(109)) D CNTRL^VALM10(PSJDLINE+PSJX,7,73,IORVON_IOBON,IORVOFF_IOBOFF,0)
"RTN","PSJLMUDE",90,0)
 I $S(PSGORD["P":$O(^PS(53.1,+$G(PSGORD),12,0)),1:$O(^PS(55,PSGP,5,+PSGORD,12,0))) S PSJL="Provider Comments:" D SETTMP S PSJL="" D
"RTN","PSJLMUDE",91,0)
 .F Q=0:0 S Q=$S(PSGORD["P":$O(^PS(53.1,+$G(PSGORD),12,Q)),1:$O(^PS(55,PSGP,5,+PSGORD,12,Q))) Q:'Q  S PSJL=$G(^(Q,0)) D SETTMP
"RTN","PSJLMUDE",92,0)
 D SETTMP S PSJL=$$SETSTR^VALM1($S($D(PSGEFN(7)):$E(" *",PSGEFN(7)+1)_"(7)",1:"   ")_"Self Med: "_PSGSMN,PSJL,1,24)
"RTN","PSJLMUDE",93,0)
 S:PSGSM&PSGHSM PSJL=$$SETSTR^VALM1("  (HS)",PSJL,16,7) D SETTMP D:$G(PSGOEEF(5)) HILITE(7)
"RTN","PSJLMUDE",94,0)
 D SETTMP S PSJL="Entry By: "_PSGEBN,PSJL=$$SETSTR^VALM1("Entry Date: "_$P(PSGLIN,U,2),PSJL,51,39) D SETTMP
"RTN","PSJLMUDE",95,0)
 I $G(PSGLRN) D SETTMP S PSJL="Renewed By: "_$$ENNPN^PSGMI($P(PSGLRN,"^",2)) D SETTMP
"RTN","PSJLMUDE",96,0)
 D SETTMP S PSJL="(13)"_" Comments:"
"RTN","PSJLMUDE",97,0)
 D:'$O(^PS(53.45,PSJSYSP,1,0)) SETTMP
"RTN","PSJLMUDE",98,0)
 D SETTMP F Q=0:0 S Q=$O(^PS(53.45,PSJSYSP,1,Q)) Q:'Q  S PSJWPL=PSJL_$S($E(PSJL)=" ":"",1:" ")_$G(^(Q,0)),PSJL="" D DISPLAY
"RTN","PSJLMUDE",99,0)
 D SETTMP
"RTN","PSJLMUDE",100,0)
 I PSGORD["P",($P($G(^PS(53.1,+PSGORD,0)),U,9)="P"),$O(^PS(53.1,+PSGORD,10,0)) D
"RTN","PSJLMUDE",101,0)
 .D SETTMP S PSJL="CPRS Order Checks:" D SETTMP
"RTN","PSJLMUDE",102,0)
 .F Q=0:0 S Q=$O(^PS(53.1,+PSGORD,10,Q)) Q:'Q  D
"RTN","PSJLMUDE",103,0)
 ..;S PSJL="" D SETTMP S PSJL=$G(^PS(53.1,+PSGORD,10,Q,0)) D SETTMP
"RTN","PSJLMUDE",104,0)
 ..S PSJL="" D SETTMP
"RTN","PSJLMUDE",105,0)
 ..D FORMATTX($G(^PS(53.1,+PSGORD,10,Q,0)))
"RTN","PSJLMUDE",106,0)
 ..S PSJL="Overriding Provider: "_$P($G(^PS(53.1,+PSGORD,10,Q,1)),U) D SETTMP
"RTN","PSJLMUDE",107,0)
 ..S PSJL="Overriding Reason: " F X=0:0 S X=$O(^PS(53.1,+PSGORD,10,Q,2,X)) Q:'X   D
"RTN","PSJLMUDE",108,0)
 ...S PSJL=PSJL_$G(^PS(53.1,+PSGORD,10,Q,2,X,0)) D SETTMP S PSJL="                   "
"RTN","PSJLMUDE",109,0)
ACTFLG ;
"RTN","PSJLMUDE",110,0)
 S ND4=$S(PSGORD["P":$G(^PS(53.1,+PSGORD,4)),1:$G(^PS(55,PSGP,5,+PSGORD,4)))
"RTN","PSJLMUDE",111,0)
 S AT="",Y="12,13,D,18,19,H1,22,23,H0,15,16,R" F X=1:3:12 I $P(ND4,"^",$P(Y,",",X)),$P(ND4,"^",$P(Y,",",X+1)) S AT=$P(Y,",",X+2) Q
"RTN","PSJLMUDE",112,0)
 I AT="",'$P(ND4,"^",$S($P(PSJSYSU,";",3)>1:3,1:1)) S AT="V"_$S($P(ND4,"^",18):"H1",$P(ND4,"^",22):"H0",$P(ND4,"^",15):"R",1:"")
"RTN","PSJLMUDE",113,0)
 I AT]"" D
"RTN","PSJLMUDE",114,0)
 .S PSJL="" D SETTMP
"RTN","PSJLMUDE",115,0)
 .S PSJL="ORDER "_$S(AT["V":"NOT VERIFIED"_$S($P(AT,"V",2)="":"",1:" ("_$S(AT["H1":"ON HOLD",AT["H0":"OFF HOLD",1:"RENEWAL")_")"),1:"MARKED TO BE "_$S(AT["D":"CANCELLED",AT["H1":"PLACED ON HOLD",AT["H0":"TAKEN OFF OF HOLD",1:"RENEWED"))
"RTN","PSJLMUDE",116,0)
 I AT'["V",AT["H1",$D(^PS(55,PSGP,5.1)) S AT=^(5.1) I $P(AT,"^",7),$P(AT,"^",10)]"" S PSJL=PSJL_"  ("_$P(AT,"^",10)_")"
"RTN","PSJLMUDE",117,0)
 D SETTMP
"RTN","PSJLMUDE",118,0)
 S VALMCNT=PSJLN-1
"RTN","PSJLMUDE",119,0)
 K PSGSMN,Q,Y,Y1,Y2,PSGLRN
"RTN","PSJLMUDE",120,0)
 S VALM("TITLE")=PSGSTAT_" UNIT DOSE "_$S((PSGSTAT="PENDING")&($G(PSGPRIO)]""):"("_PSGPRIO_")",$G(PSGPRIO)="DONE":"("_PSGPRIO_")",1:"") I $D(PSJLMP2) S VALMBG=16 K PSJLMP2
"RTN","PSJLMUDE",121,0)
TEST ;
"RTN","PSJLMUDE",122,0)
 I $G(PSGPFLG) S VALMSG="INVALID ORDERABLE ITEM"
"RTN","PSJLMUDE",123,0)
 I $G(PSGDI) S VALMSG=$S($G(VALMSG)="":"INVALID",1:VALMSG_",")_" DISPENSE DRUG"
"RTN","PSJLMUDE",124,0)
 I $G(PSGPI) S VALMSG=$S($G(VALMSG)="":"INVALID",1:VALMSG_",")_" PROVIDER"
"RTN","PSJLMUDE",125,0)
 Q
"RTN","PSJLMUDE",126,0)
DISPLAY ;
"RTN","PSJLMUDE",127,0)
 S PSJL=PSJWPL D SETTMP
"RTN","PSJLMUDE",128,0)
 Q
"RTN","PSJLMUDE",129,0)
 ;
"RTN","PSJLMUDE",130,0)
SETTMP ;
"RTN","PSJLMUDE",131,0)
 S ^TMP("PSJUDE",$J,PSJLN,0)=PSJL,PSJLN=PSJLN+1,PSJL=""
"RTN","PSJLMUDE",132,0)
 Q
"RTN","PSJLMUDE",133,0)
 ;
"RTN","PSJLMUDE",134,0)
HILITE(FLD) ; 
"RTN","PSJLMUDE",135,0)
 N COL,LIN,WID,X
"RTN","PSJLMUDE",136,0)
 S X="$T("_FLD_"^PSJLMUDE)",@("X="_X),X=$P(X,";;",2),LIN=+X,COL=$P(X,",",2),LAB=$P(X,",",3),X=$P(X,",",4),WID=(LAB+$L(@X))
"RTN","PSJLMUDE",137,0)
 I $G(PSGRF),FLD>9 S LIN=LIN+1 ;COMPENSATE FOR REMOVAL TIMES
"RTN","PSJLMUDE",138,0)
 I FLD=7 S LIN=+$G(PSJLN)-1 Q:LIN<13
"RTN","PSJLMUDE",139,0)
 D CNTRL^VALM10(LIN,COL,WID,IORVON_IOBON,IORVOFF_IOBOFF,0)
"RTN","PSJLMUDE",140,0)
 Q
"RTN","PSJLMUDE",141,0)
 ;
"RTN","PSJLMUDE",142,0)
FORMATTX(PSJX) ;
"RTN","PSJLMUDE",143,0)
 NEW PSJX1,Y,Y1
"RTN","PSJLMUDE",144,0)
 S PSJX1=""
"RTN","PSJLMUDE",145,0)
 F Y=1:1:$L(PSJX," ") S Y1=$P(PSJX," ",Y) D
"RTN","PSJLMUDE",146,0)
 . I ($L(PSJX1)+$L(Y1)+1)>79 S:$E(PSJX1,1,1)=" " PSJX1=$E(PSJX1,2,$L(PSJX1)) S PSJL=PSJX1,PSJX1="" D SETTMP
"RTN","PSJLMUDE",147,0)
 . S PSJX1=PSJX1_Y1_" "
"RTN","PSJLMUDE",148,0)
 I PSJX1]"" S PSJL=PSJX1 D SETTMP
"RTN","PSJLMUDE",149,0)
 K PSJX1
"RTN","PSJLMUDE",150,0)
 Q
"RTN","PSJLMUDE",151,0)
 ;
"RTN","PSJLMUDE",152,0)
1 ;;1,5,16,PSGPDN
"RTN","PSJLMUDE",153,0)
2 ;;3,5,16,PSGDO
"RTN","PSJLMUDE",154,0)
3 ;;4,58,7,PSGSDN
"RTN","PSJLMUDE",155,0)
4 ;;5,10,11,PSGMRN
"RTN","PSJLMUDE",156,0)
5 ;;6,59,6,PSGFDN
"RTN","PSJLMUDE",157,0)
6 ;;7,6,15,PSGSTN
"RTN","PSJLMUDE",158,0)
7 ;;18,5,14,PSGSMN
"RTN","PSJLMUDE",159,0)
8 ;;8,11,12,PSGSCH
"RTN","PSJLMUDE",160,0)
9 ;;9,8,13,PSGAT
"RTN","PSJLMUDE",161,0)
10 ;;10,11,10,PSGPRN
"RTN","PSJLMUDE",162,0)
11 ;;11,7,22,PSGSI
"RTN","PSJLMUDE",163,0)
ENKILL ;
"RTN","PSJLMUDE",164,0)
 K PSGNOHI,PSGAT,PSGEB,PSGEFN,PSGFD,PSGHSM,PSGNEFD,PSGNESD,PSGOEEF,PSGOEER,PSGOFD,PSGOHSM,PSGOMR,PSGOMRN,PSGOPD,PSGOPDN,PSGOPR,PSGOSCH,PSGOSD,PSGOSM,PSGOST,PSGPD,PSGPDN,PSGPR,PSGSD,PSGSM Q
"RTN","PSJO")
0^14^B32312057^B28881243
"RTN","PSJO",1,0)
PSJO ;BIR/CML3,PR-GET AND PRINT INPATIENT ORDERS ;28 Jun 99 / 10:20 AM
"RTN","PSJO",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**31,58,110,181,267,275,317**;16 DEC 97;Build 130
"RTN","PSJO",3,0)
 ;
"RTN","PSJO",4,0)
 ; Reference to ^PSD(58.8 supported by DBIA #2283.
"RTN","PSJO",5,0)
 ; Reference to ^PSI(58.1 supported by DBIA #2284.
"RTN","PSJO",6,0)
 ; Reference to ^PS(55 supported by DBIA #2191.
"RTN","PSJO",7,0)
 ; Reference to $$GET^XPAR supported by #2263
"RTN","PSJO",8,0)
 ;
"RTN","PSJO",9,0)
 K ^TMP("PSJON",$J),^TMP("PSJ",$J) N TF2 D @$S($D(PSJEXTP):"EN^PSJH1",1:"EN^PSJO1(3)")
"RTN","PSJO",10,0)
 S PSJDEV=IO'=IO(0)!($E(IOST,1,2)'="C-"),(NP,TF2,PSGON,PSJON)=""
"RTN","PSJO",11,0)
 U IO D ENGET^PSJO3 I '$D(^TMP("PSJ",$J)) W !,SLS,SLS,$E(SLS,1,25),!!?22,"NO ORDERS FOUND FOR ",$S(PSJOL="S":"SHORT",1:"LONG")," PROFILE."
"RTN","PSJO",12,0)
 E  S (PSJC,PSJS,PSJO,PSJST)="" F  S PSJC=$O(^TMP("PSJ",$J,PSJC)) Q:PSJC=""  D  G:NP["^" DONE
"RTN","PSJO",13,0)
 .D:$S(($P(PSJC,"^")="Cz")&($P(PSJC,"^",2)'=TF2):1,(($P(PSJC,"^")'="Cz")&PSJC["B"&'TF):0,($P(PSJC,"^")'="Cz"&(PSJC'["A")):1,($P(PSJC,"^")="Cz"&(TF2=$P(PSJC,"^",2))):0,1:1) TF
"RTN","PSJO",14,0)
 .F  S PSJST=$O(^TMP("PSJ",$J,PSJC,PSJST)) Q:PSJST=""  F  S PSJS=$O(^TMP("PSJ",$J,PSJC,PSJST,PSJS)) Q:PSJS=""!(NP[U)  D ON
"RTN","PSJO",15,0)
 G:NP[U DONE I PSJDEV,$S('$D(PSJPRP):1,1:PSJPRP="P") D BOT
"RTN","PSJO",16,0)
 ;
"RTN","PSJO",17,0)
DONE ;
"RTN","PSJO",18,0)
 I $S('$D(PSJPRP):1,1:PSJPRP="P") K ^TMP("PSJ",$J)
"RTN","PSJO",19,0)
 S PSGON=PSJON K:'$D(PSGVBW) PSGODT K %,%H,%I,C,DN,DO,DRG,FQ,GIVE,HDT,I,JJ,LN2,N,ND,ND4,ND6,NF,NP,O,ON,ORIFN,ORTX,P,PF,PG,PS,PSGID,PSGOD,PSIVSC,PSIVST,PSIVTY,PSJC,PSJDEV,PSJF,PSJO,PSJOS,PSJS,PSJSCHT,PSJST,QQ,RB,RTE,SCH,SD,SLS,SM
"RTN","PSJO",20,0)
 K ST,START,STAT,SUB,TF,TYP,UDU,UPD,V,WS,X,X1,X2,Y Q
"RTN","PSJO",21,0)
 ;
"RTN","PSJO",22,0)
ON ;
"RTN","PSJO",23,0)
 S PSJSCHT=$S(PSJOS:PSJS,1:PSJST)
"RTN","PSJO",24,0)
 F FQ=0:0 S PSJO=$O(^TMP("PSJ",$J,PSJC,PSJST,PSJS,PSJO)) Q:PSJO=""  S DN=^(PSJO) D:$Y+6>IOSL ENNP^PSJO3 Q:NP["^"  D  ;
"RTN","PSJO",25,0)
 .I $P(PSJC,"^")="Cz",($P(PSJC,"^",2)]"") S PSJF="^PS("_$S($P(PSJC,"^",4)'["C":"55,"_PSGP_",5,",1:"53.1,")
"RTN","PSJO",26,0)
 .S PSJON=PSJON+1 S:'PSJDEV ^TMP("PSJON",$J,PSJON)=PSJO W !,$J(PSJON,4),?5 D @$S(PSJO["V":"PIV^PSIVUTL(PSJO)",PSJO["U":"PUD",1:"PIV^PSIVUTL(PSJO)")
"RTN","PSJO",27,0)
 Q
"RTN","PSJO",28,0)
 ;
"RTN","PSJO",29,0)
PUD ; print unit dose
"RTN","PSJO",30,0)
 ; Naked reference below refers to full reference ^PS(53.1,+PSJO,0) or ^PS(55,DFN,5,+PSJO,0) using indirection.
"RTN","PSJO",31,0)
 I PSJO["U" S:'$$CLINIC^PSJO1(PSGP,PSJO) C=$G(PSJC)
"RTN","PSJO",32,0)
 I PSJO["P" S:'$$CLINIC^PSJO1(PSGP,PSJO) C=$G(PSJC)
"RTN","PSJO",33,0)
 S ND=$S($D(@(PSJF_+PSJO_",0)")):^(0),1:""),SCH=$G(^(2)),ND4=$G(^(4)),ND6=$P($G(^(6)),"^"),DO=$S($P(DN,"^",2)=.2:$P($G(@(PSJF_+PSJO_",.2)")),"^",2),1:$G(@(PSJF_+PSJO_",.3)")))
"RTN","PSJO",34,0)
 I ("AO"[PSJC)!(PSJC="DF") D
"RTN","PSJO",35,0)
 .S V='$P(ND4,"^",UDU),V=$S(+PSJSYSU=1&V:1,+PSJSYSU=3&V:1,1:0)
"RTN","PSJO",36,0)
 .W $S(ND4="":" ",$P(ND4,"^",12):"D",$P(ND4,"^",18)&($P(ND4,"^",19)!V):"H",$P(ND4,"^",22)&($P(ND4,"^",23)!V):"H",$P(ND4,"^",15)&($P(ND4,"^",16)!V):"R",1:" ")
"RTN","PSJO",37,0)
 .W $S($P($G(@(PSJF_+PSJO_",.2)")),"^",4)="D":"d",1:" ")_$S(V:"->",1:"  ")
"RTN","PSJO",38,0)
 I $S(PSJC["NZ":0,1:PSJC["N") W $S($P(ND4,"^",12):"D",1:" ")
"RTN","PSJO",39,0)
 S RTE=$P(ND,"^",3),SM=$S('$P(ND,"^",5):0,$P(ND,"^",6):1,1:2),STAT=$S($P(ND,"^",28)]"":$P(ND,"^",28),$P(ND,"^",9)]"":$P(ND,"^",9),1:"NF")
"RTN","PSJO",40,0)
 S PF=$E("*",$P(ND,"^",20)>0),PSGID=$P(SCH,"^",2),SD=$P(SCH,"^",4),SCH=$P(SCH,"^")
"RTN","PSJO",41,0)
 I STAT="A",$P(ND,U,27)="R" S STAT="R"
"RTN","PSJO",42,0)
 S NF=$P(DN,"^",2),WS=$S(PSJPWD:$$WS(PSJPWD,PSGP,PSJF,PSJO),1:0)
"RTN","PSJO",43,0)
 ; PSJ*5*317 - If PSJ PADE OE BALANCES parameter is YES, PADE balances should display.
"RTN","PSJO",44,0)
 N PADE S PADE=0 I $$GET^XPAR("SYS","PSJ PADE OE BALANCES") D
"RTN","PSJO",45,0)
 .N PSJTMNOE
"RTN","PSJO",46,0)
 .S PSJTMNOE=$G(PSJNEWOE) N PSJNEWOE S PSJNEWOE=PSJTMNOE
"RTN","PSJO",47,0)
 .I '$G(VAIN(4)),$G(PSGP) N VAIN,DFN S DFN=PSGP D INP^VADPT
"RTN","PSJO",48,0)
 .Q:'$$PADEWD^PSJPAD50(+$G(VAIN(4)))
"RTN","PSJO",49,0)
 .S PADE=$$DRGFLAG^PSJPADSI(PSGP,PSJO,,$G(ON),$G(PSJNEWOE)) S:PADE=0 PADE=1
"RTN","PSJO",50,0)
 NEW MARX,PSJRNDT
"RTN","PSJO",51,0)
 S:($P(PSJC,"^")'="Cz") PSJORFLG=$S(PSJC["A":"U",PSJC["O":"U",PSJC="DF":"U",1:"P")
"RTN","PSJO",52,0)
 S:($P(PSJC,"^")="Cz") PSJORFLG=$S($P(PSJC,"^",4)["A":"U",($P(PSJC,"^",4)["O"):"U",($P(PSJC,"^",4)["DF"):"U",1:"P")
"RTN","PSJO",53,0)
 S PSJRNDT=$$LASTREN^PSJLMPRI(DFN,PSJO) S:PSJRNDT PSJRNDT=$E($$ENDTC^PSGMI(+PSJRNDT),1,5)
"RTN","PSJO",54,0)
 D DRGDISP^PSJLMUT1(PSGP,+PSJO_PSJORFLG,40,54,.MARX,0)
"RTN","PSJO",55,0)
 F X=0:0 S X=$O(MARX(X)) Q:'X  W @($S(X=1:"?9",1:"!?11")),$S($E(PSJS)="*":$P(PSJS,"^"),1:MARX(X)) D:X=1
"RTN","PSJO",56,0)
 . W ?50,$S(PSJC["NZ":"?",PSJSCHT'="z":PSJSCHT,1:"?")
"RTN","PSJO",57,0)
 . W:'$D(PSJEXTP) ?53,$S(PSJC["NZ":"*****",1:$E($$ENDTC^PSGMI(PSGID),1,5)),?60,$S(PSJC["NZ":"*****",1:$E($$ENDTC^PSGMI(SD),1,5)),?67,STAT
"RTN","PSJO",58,0)
 . W:$D(PSJEXTP) ?53,$S(PSJC["NZ":"*****",1:$E($$ENDTC^PSGMI(PSGID),1,8)),?63,$S(PSJC["NZ":"*****",1:$E($$ENDTC^PSGMI(SD),1,8)),?73,STAT
"RTN","PSJO",59,0)
 . I NF!WS!SM!PF!$G(PADE)!(PSJRNDT]"") W ?71 W:NF "NF " W:(WS&'PADE) "WS " W:(WS&PADE) "WP " W:(PADE&'WS) "PD " W:SM $E("HSM",SM,3) W:$G(PSJRNDT) PSJRNDT W:PF ?79,"*"
"RTN","PSJO",60,0)
 I ND6]"" S Y=$$ENSET^PSGSICHK(ND6) D  K ^PS(53.45,DUZ,5)
"RTN","PSJO",61,0)
 .D GETSI^PSJBCMA5(DFN,PSJO) I $G(^PS(53.45,DUZ,5)) N TXTLN S TXTLN=0 F  S TXTLN=$O(^PS(53.45,DUZ,5,TXTLN)) Q:'TXTLN  D
"RTN","PSJO",62,0)
 ..W !?11,$G(^PS(53.45,DUZ,5,TXTLN,0))
"RTN","PSJO",63,0)
 .W !?11 F X=1:1:$L(Y," ") S V=$P(Y," ",X) W:$L(V)+$X>66 !?11 W V_" "
"RTN","PSJO",64,0)
 K PSJORFLG
"RTN","PSJO",65,0)
 Q
"RTN","PSJO",66,0)
 ;
"RTN","PSJO",67,0)
TF ;
"RTN","PSJO",68,0)
 NEW SLS,C S SLS="",C=PSJC,$P(SLS," -",40)=""
"RTN","PSJO",69,0)
 S LN2=$S(($P(C,"^")="Cz"):$$TXT(C),C="A":$$TXT(C),C["CC":$$TXT("PR"),C["CD":$$TXT("PC"),C["BD":$$TXT("NC"),C["C":$$TXT("P"),C["B":$$TXT("N"),C["NX":$$TXT("N"),C["DF":$$TXT("DF"),C["NZ":$$TXT("P"),1:$$TXT("NA"))
"RTN","PSJO",70,0)
 W:$D(^TMP("PSJ",$J,PSJC)) !,$E($E(SLS,1,(80-$L(LN2))/2)_" "_LN2_$E(SLS,1,(80-$L(LN2))/2),1,80)
"RTN","PSJO",71,0)
 S PSJF="^PS("_$S(PSJC'["C":"55,"_PSGP_",5,",1:"53.1,") S TF=$S(PSJC["C":0,1:TF)
"RTN","PSJO",72,0)
 I $P(PSJC,"^")="Cz",($P(PSJC,"^",2)]"") S PSJF="^PS("_$S($P(PSJC,"^",4)'["C":"55,"_PSGP_",5,",1:"53.1,"),TF2=$P(PSJC,"^",2)
"RTN","PSJO",73,0)
 Q
"RTN","PSJO",74,0)
 ;
"RTN","PSJO",75,0)
TXT(X) ;
"RTN","PSJO",76,0)
 I $G(X)="" Q ""
"RTN","PSJO",77,0)
 I X="A" Q "A C T I V E"
"RTN","PSJO",78,0)
 S PSJDCEXP=$$RECDCEXP^PSJP()
"RTN","PSJO",79,0)
 I $P(X,"^")="Cz" Q $P(X,"^",2)
"RTN","PSJO",80,0)
 I X="DF" Q "RECENTLY DISCONTINUED/EXPIRED (LAST "_+$G(PSJDCEXP)_" HOURS)"
"RTN","PSJO",81,0)
 I X="N" Q "N O N - V E R I F I E D"
"RTN","PSJO",82,0)
 I X="NA" Q "N O N - A C T I V E"
"RTN","PSJO",83,0)
 I X="NC" Q "N O N - V E R I F I E D  C O M P L E X"
"RTN","PSJO",84,0)
 I X="P" Q "P E N D I N G"
"RTN","PSJO",85,0)
 I X="PC" Q "P E N D I N G  C O M P L E X"
"RTN","PSJO",86,0)
 I X="PR" Q "P E N D I N G   R E N E W A L S"
"RTN","PSJO",87,0)
 Q ""
"RTN","PSJO",88,0)
 ;
"RTN","PSJO",89,0)
BOT ; print name, ssn, and dob on bottom of page
"RTN","PSJO",90,0)
 F Q=$Y:1:IOSL-4 W !
"RTN","PSJO",91,0)
 W !,?2,$P(PSGP(0),"^"),?40,PSJPPID,?70,$E($P(PSJPDOB,"^",2),1,8)
"RTN","PSJO",92,0)
 Q
"RTN","PSJO",93,0)
WS(PSJPWD,PSGP,PSJF,PSJO) ; - WARD STOCK flag, input=(ward,dfn,file root,order)
"RTN","PSJO",94,0)
 ; Naked reference below refers to full reference ^PS(55,DFN,5,+PSJO,1,"B",PSWS) using indirection.
"RTN","PSJO",95,0)
 S WS=0,PSJF=PSJF_+PSJO_",1,""B"")" I $D(@PSJF) N PSWS S PSWS=0 F  S PSWS=$O(^("B",PSWS)) Q:'PSWS  S WS=$$WSCHK(PSJPWD,PSWS) Q:WS
"RTN","PSJO",96,0)
 Q WS
"RTN","PSJO",97,0)
 ;
"RTN","PSJO",98,0)
WSCHK(PSJPWD,PSWS) ; Determine if drug is ward stock item.
"RTN","PSJO",99,0)
 Q $S(PSJPWD:$S($D(^PSI(58.1,"D",PSWS,PSJPWD)):1,$D(^PSD(58.8,"D",PSWS,PSJPWD)):1,1:0),1:0)
"RTN","PSJO2")
0^15^B21667076^B20134007
"RTN","PSJO2",1,0)
PSJO2 ;BIRC/CML3,PR-INPATIENT ORDERS - PRINT ;17 SEP 97 /  1:41 PM
"RTN","PSJO2",2,0)
 ;;5.0;INPATIENT MEDICATIONS ;**58,317**;16 DEC 97;Build 130
"RTN","PSJO2",3,0)
 ;
"RTN","PSJO2",4,0)
 ; Reference to ^PS(51.2 is supported by DBIA 2178.
"RTN","PSJO2",5,0)
 ; Reference to ^PS(55 is supported by DBIA 2191.
"RTN","PSJO2",6,0)
 ; Reference to ^PSI(58.1 is supported by DBIA 2284.
"RTN","PSJO2",7,0)
 ;
"RTN","PSJO2",8,0)
 F  S PSJC=$O(^UTILITY("PSG",$J,PSJC)) Q:PSJC=""  D TF F PSJST="C","O","OC","P","R","z" S PSJDRG="" F  S PSJDRG=$O(^UTILITY("PSG",$J,PSJC,PSJST,PSJDRG)) Q:PSJDRG=""  S NF=^(PSJDRG) D:$Y+4>IOSL NP G:PSJNP["^" DONE D P
"RTN","PSJO2",9,0)
 I PSJTD,$S('$D(PSGPRP):1,1:PSGPRP="P") D BOT
"RTN","PSJO2",10,0)
 ;
"RTN","PSJO2",11,0)
DONE ;
"RTN","PSJO2",12,0)
 I $S('$D(PSGPRP):1,1:PSGPRP="P") K ^UTILITY("PSG",$J)
"RTN","PSJO2",13,0)
 S PSGON=PSJON K:'$D(PSGVBW) PSGODT K C,PSJTD,DO,DOB,PSJDRG,F,GIVE,HDT,LN2,NF,ND,PSJNP,O,ON,PG,PSGID,PSGOD,RF,RTE,SCH,SD,SLS,SM,SSN,PADE,PSJST,TF,PSJU,V,WD,WDP,WS,WT Q
"RTN","PSJO2",14,0)
 ;
"RTN","PSJO2",15,0)
P ; data printed here
"RTN","PSJO2",16,0)
 S O=$P(PSJDRG,"^",2),DN=$P(PSJDRG,"^"),PSJON=PSJON+1 S:'PSJTD ^TMP("PSJON",$J,PSJON)=O_PSJC W !,$J(PSJON,4),?5
"RTN","PSJO2",17,0)
 I C["A" S ND=$S($D(^PS(55,PSGP,5,O,4)):^(4),1:""),V='$P(ND,"^",PSJU) ; $S(PSJSYSU:PSJSYSU,1:1))
"RTN","PSJO2",18,0)
 I  W $S(ND="":" ",$P(ND,"^",12):"D",$P(ND,"^",18)&($P(ND,"^",19)!V):"H",$P(ND,"^",22)&($P(ND,"^",23)!V):"H",$P(ND,"^",15)&($P(ND,"^",16)!V):"R",1:" ") W:V "->"
"RTN","PSJO2",19,0)
 I C["N" W $S('$D(^PS(53.1,O,4)):" ",$P(^(4),"^",12):"D",1:" "),$S(PSJSYSU:"->",1:"")
"RTN","PSJO2",20,0)
 S ND=$G(@(PSJF_O_",0)")),SCH=$G(^(2)),Y=$P($G(^(6)),"^"),DO=$G(^(.1)) I Y]"" S Y=$$ENSET^PSGSICHK(Y)
"RTN","PSJO2",21,0)
 S RTE=$P(ND,"^",3),SM=$S('$P(ND,"^",5):0,$P(ND,"^",6):1,1:2),X=$S($P(ND,"^",9)]"":$P(ND,"^",9),1:"NF")_$E("*",$P(ND,"^",20)),PSGID=$P(SCH,"^",2),SD=$P(SCH,"^",4),SCH=$P(SCH,"^")
"RTN","PSJO2",22,0)
 I C'["N",$P(ND,"^",22) S GIVE="*** NOT TO BE GIVEN ***"
"RTN","PSJO2",23,0)
 E  S RTE=$S('RTE:"N/F",'$D(^PS(51.2,RTE,0)):RTE,$P(^(0),"^",3)]"":$P(^(0),"^",3),$P(^(0),"^")]"":$P(^(0),"^"),1:RTE),GIVE="Give: "_$S($P(DO,"^",2)]"":$P(DO,"^",2)_" ",1:"")_" "_RTE_" "_$S(SCH]"":SCH,1:"SCHEDULE NOT FOUND")
"RTN","PSJO2",24,0)
 S WS=$S(DO&PSGPWD:$D(^PSI(58.1,"D",+DO,PSGPWD)),1:0)
"RTN","PSJO2",25,0)
 N PSJTMNOE S PSJTMNOE=$G(PSJNEWOE) N PSJNEWOE S PSJNEWOE=PSJTMNOE  ; PSJ*5*317-PADE
"RTN","PSJO2",26,0)
 S PADE=$$DRGFLAG^PSJPADSI(PSGP,$G(O),,$G(O),$G(PSJNEWOE)) S:PADE=0 PADE=1
"RTN","PSJO2",27,0)
 W ?9,$S(DN'="z":DN,1:"NOT FOUND"),?50,$S(PSJST'="z":PSJST,1:"?"),?53,$E($$ENDTC^PSGMI(PSGID),1,5),?60,$E($$ENDTC^PSGMI(SD),1,5),?67,X I NF!WS!SM W ?71 W:NF "NF " W:(WS&PADE) "WP" W:(PADE&'WS) "PD" W:(WS&'PADE) "WS " W:SM $E("HSM",SM,3)
"RTN","PSJO2",28,0)
 W !?11,GIVE I Y]"" W !?10 F X=1:1:$L(Y," ") S V=$P(Y," ",X) W:$L(V)+$X>77 !?10 W V_" "
"RTN","PSJO2",29,0)
 Q
"RTN","PSJO2",30,0)
 ;
"RTN","PSJO2",31,0)
PIV ; print IV order
"RTN","PSJO2",32,0)
 ;
"RTN","PSJO2",33,0)
TF ;
"RTN","PSJO2",34,0)
 Q:PSJC["N"&'PSJTF  S PSJLN2=PSJSLS_$S(PSJC["A":" - - - A C T I V E - - -",PSJC["N":" N O N - V E R I F I E D",1:" - N O N - A C T I V E -")_PSJSLS W:$D(^UTILITY("PSG",$J,PSJC)) !,PSJLN2
"RTN","PSJO2",35,0)
 S PSJF="^PS("_$S(PSJC'["N":"55,"_PSGP_",5,",1:"53.1,") S:PSJC["N" TF=0 Q
"RTN","PSJO2",36,0)
 ;
"RTN","PSJO2",37,0)
NP I PSJON,'PSJTD W $C(7) R !," `^' TO QUIT ",PSJNP:DTIME W:'$T $C(7) S:'$T PSJNP="^" W:PSJNP'["^" $C(13),"                     ",$C(13),# Q
"RTN","PSJO2",38,0)
 I PSJON,PSJTD D BOT
"RTN","PSJO2",39,0)
 ;
"RTN","PSJO2",40,0)
HEADER ; print new page, name, ssn, dob, and ward
"RTN","PSJO2",41,0)
 S PSJPG=PSJPG+1,PSGOD=$$ENDTC^PSGMI(PSGPAD)
"RTN","PSJO2",42,0)
 W @IOF,! W:$D(PSGPR) ?22,"U N I T   D O S E   P R O F I L E" W ?64,HDT,! W:$D(PSGPR) PSJSLS,PSJSLS,$E(PSJSLS,1,24),! W ?1,$P(PSGP(0),"^"),?34,"  Ward: ",$S(PSGPWDN]"":PSGPWDN,1:"* NF *") W:$D(PSGPR) ?75-$L(PSJPG),"Pg: ",PG-$D(PSGVWA)
"RTN","PSJO2",43,0)
 W !?7,"PID: ",PSJPPID,?30,"WEIGHT(kg): ",PSJPWT,?48,"Sex: ",$P(PSJPSEX,"^",2),?61,"Admitted: ",$E(PSGOD,1,8),!?7,"DOB: ",DOB_"  ("_AGE_")",?30,"Height(cm): ",PSJPHT
"RTN","PSJO2",44,0)
 S PSGID=$S(PSGPDD:PSGPDD,1:PSGPTD) I PSGID W ?$S(PSGPDD:59,1:53),$S(PSGPDD:"Discharged: ",1:"Last transferred: "),$E($$ENDTC^PSGMI(PSGID),1,8)
"RTN","PSJO2",45,0)
 W !?8,"Dx: ",$S(PSGPDX]"":PSGPDX,1:"* NF *"),?69-$L(RB),"Room-Bed: ",RB,!?1,"Reactions:" D ENRCT^PSGAPP I $D(^PS(55,PSGP,5.1)),$P(^(5.1),"^",7) W $C(7),!!?21,"** PATIENT'S ORDERS PLACED ON HOLD **"
"RTN","PSJO2",46,0)
 I '$D(PSGVWA),$S('$D(PSGPRP):1,1:PSGPRP'="E") W !!," No.",?19,"Drug",?50,"ST Start  Stop  Status/Info"
"RTN","PSJO2",47,0)
 W:PSJPG>1 !,PSJLN2 Q
"RTN","PSJO2",48,0)
 ;
"RTN","PSJO2",49,0)
BOT ; print name, ssn, and dob on bottom of page
"RTN","PSJO2",50,0)
 F Q=$Y:1:IOSL-4 W !
"RTN","PSJO2",51,0)
 W !,?2,$P(PSGP(0),"^"),?40,SSN,?60,DOB Q
"RTN","PSJPAD50")
0^16^B143814904^n/a
"RTN","PSJPAD50",1,0)
PSJPAD50 ;BIR/JCH PADE DRUG LOOKUP ;8/25/15
"RTN","PSJPAD50",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**317**;16 DEC 97;Build 130
"RTN","PSJPAD50",3,0)
 ;
"RTN","PSJPAD50",4,0)
 ; Reference to ^VADPT is supported by DBIA 10061.
"RTN","PSJPAD50",5,0)
 ; Reference to EN^DDIOL is supported by DBIA 10142.
"RTN","PSJPAD50",6,0)
 ; Reference to ^PSDRUG is supported by DBIA 2192.
"RTN","PSJPAD50",7,0)
 ; Reference to ^PS(55 is supported by DBIA 2191.
"RTN","PSJPAD50",8,0)
 ; Reference to ^SC( is supported by DBIA 10040.
"RTN","PSJPAD50",9,0)
 ;
"RTN","PSJPAD50",10,0)
 Q
"RTN","PSJPAD50",11,0)
 ;
"RTN","PSJPAD50",12,0)
READDD(PSJDRG,PSJOI,PSJLOC,PSJORD,PSGORD) ; Get Dispense Drug
"RTN","PSJPAD50",13,0)
 ;  Input :  PSJDRG - (required) Pointer to DRUG file (#50)
"RTN","PSJPAD50",14,0)
 ;           PSJOI  - (optional) Pointer to PHARMACY ORDERABLE ITEM (#50.7) file 
"RTN","PSJPAD50",15,0)
 ;           PSJLOC - (required) Pointer to WARD (#42) file if input value is purely numeric
"RTN","PSJPAD50",16,0)
 ;                               Pointer to Hospital Location (#44) if last character of input value is "C"
"RTN","PSJPAD50",17,0)
 ;           PSJORD - (optional) Inpatient Order number, pointer to NON-VERIFIED ORDERS (#53.1) file or PHARAMCY PATIENT (#55) file
"RTN","PSJPAD50",18,0)
 ;           PSGORD - (optional) Inpatient Order number, pointer to NON-VERIFIED ORDERS (#53.1) file or PHARMACY PATIENT (#55) file
"RTN","PSJPAD50",19,0)
 ;
"RTN","PSJPAD50",20,0)
 N DTOUT,DUOUT,PSII,PSJDONE
"RTN","PSJPAD50",21,0)
 I '$G(PSJLOC)!(($E($G(PSJLOC),$L($G(PSJLOC)))'="W")&($E($G(PSJLOC),$L($G(PSJLOC)))'="C")) D
"RTN","PSJPAD50",22,0)
 .N LOCTYP,CLFLAG
"RTN","PSJPAD50",23,0)
 .S (LOCTYP,CLFLAG)=""
"RTN","PSJPAD50",24,0)
 .I '$G(DFN),$G(PSGP) N DFN S DFN=PSGP
"RTN","PSJPAD50",25,0)
 .I '$G(VAIN(4)),$G(DFN) N VAIN,VAINDT,VAROOT,VAHOW D INP^VADPT
"RTN","PSJPAD50",26,0)
 .I $G(PSJORD) S CLFLAG=$S($E(PSJORD,$L(PSJORD))="U":$G(^PS(55,+$G(DFN),5,+PSJORD,8)),$E(PSJORD,$L(PSJORD))="P":$G(^PS(53.1,+PSJORD,"DSS")),1:"")
"RTN","PSJPAD50",27,0)
 .S LOCTYP=$S($D(^SC(+CLFLAG,0))&$P(CLFLAG,"^",2)?7N1.E:"CL",1:"WD")
"RTN","PSJPAD50",28,0)
 .S PSJLOC=$S((LOCTYP="CL")&CLFLAG:+CLFLAG_"CL",(LOCTYP="WD")&$G(VAIN(4)):+$G(VAIN(4))_"WD",1:"")
"RTN","PSJPAD50",29,0)
 F PSII=1:1:2 Q:$G(DTOUT)!$G(DUOUT)!$G(PSJDONE)  D READLOOP($G(PSJDRG),$G(PSJOI),$G(PSJLOC),$G(PSJORD),$G(PSGORD),PSII,.PSJDONE)
"RTN","PSJPAD50",30,0)
 Q
"RTN","PSJPAD50",31,0)
 ;
"RTN","PSJPAD50",32,0)
READLOOP(PSJDRG,PSJOI,PSJLOC,PSJORD,PSGORD,PSII,PSJDONE)  ; Prompt for dispense drug until intentionally exits
"RTN","PSJPAD50",33,0)
 ;    PSJSRCH - (optional)Partial name search done, drug selected from list, present Drug .01 field for edit
"RTN","PSJPAD50",34,0)
 N PSJDSRCH,NEWDRG,PSJSRCH,PSJDRG
"RTN","PSJPAD50",35,0)
 K PSJDONE
"RTN","PSJPAD50",36,0)
 ;
"RTN","PSJPAD50",37,0)
 S PSJSRCH=""
"RTN","PSJPAD50",38,0)
 S PSJLOC=$S($G(PSJLOC)["C":$G(PSJLOC),1:+$G(PSJLOC))
"RTN","PSJPAD50",39,0)
 F  Q:$G(DTOUT)!$G(NEWDRG)!$G(DUOUT)!$G(PSJDONE)  D
"RTN","PSJPAD50",40,0)
 .S PSJSRCH=""
"RTN","PSJPAD50",41,0)
 .S NEWDRG=$$PROMPT(.PSJDRG,.PSJDSRCH,PSJOI,PSJLOC,PSJORD,.PSJSRCH,PSII)
"RTN","PSJPAD50",42,0)
 ; If user quit, don't file anything into ^PS(53.4502
"RTN","PSJPAD50",43,0)
 Q:$G(DUOUT)!$G(DTOUT)
"RTN","PSJPAD50",44,0)
 ; If something was changed, file the change into ^PS(53.4502
"RTN","PSJPAD50",45,0)
 I $G(NEWDRG) D FILE(.NEWDRG,PSJSRCH)
"RTN","PSJPAD50",46,0)
 Q
"RTN","PSJPAD50",47,0)
 ;
"RTN","PSJPAD50",48,0)
PROMPT(DRGIEN,DRGSRCH,PSJOI,PSJLOC,PSJORD,PSJSRCH,PSII)  ;  Prompt for Dispense Drug
"RTN","PSJPAD50",49,0)
 ; Input: DRGIEN = pointer to DRUG (#50)
"RTN","PSJPAD50",50,0)
 ;        PSJOI  = pointer to pharmacy orderable item (#50.7)
"RTN","PSJPAD50",51,0)
 ;        PSJLOC = Patient ward location or order's clinic location
"RTN","PSJPAD50",52,0)
 ;        PSJORD = Inpatient Order, pointer to file 55 or 53.1
"RTN","PSJPAD50",53,0)
 ;        SELSRCH= Drug was selected from numbered list
"RTN","PSJPAD50",54,0)
 N DRGNAME,DIR,DA,X,Y,NEWDRIEN,DI,DCT,TMPSRCH
"RTN","PSJPAD50",55,0)
 K DRG
"RTN","PSJPAD50",56,0)
 S DIR(0)="FAO^1:30"
"RTN","PSJPAD50",57,0)
 S DRGNAME=""
"RTN","PSJPAD50",58,0)
 S DRGIEN=$G(DRGIEN)
"RTN","PSJPAD50",59,0)
 S DCT=0 F  S DCT=$O(^PS(53.45,PSJSYSP,2,DCT)) Q:'DCT  D
"RTN","PSJPAD50",60,0)
 .N DRGNAME
"RTN","PSJPAD50",61,0)
 .S DRGIEN=+$G(^PS(53.45,PSJSYSP,2,DCT,0))
"RTN","PSJPAD50",62,0)
 .Q:'$G(DRGIEN)
"RTN","PSJPAD50",63,0)
 .S DRGNAME=$P($G(^PSDRUG(+DRGIEN,0)),"^")
"RTN","PSJPAD50",64,0)
 .S DRGIEN(DCT)=DRGIEN_"^^"_DRGNAME,DRGIEN("NAM",DRGNAME,DCT)="",DRGIEN("NUM",+DRGIEN(DCT),DCT)=""
"RTN","PSJPAD50",65,0)
 I 'DRGIEN S DRGIEN=$O(DRGIEN("")),DRGIEN=+$G(DRGIEN(+DRGIEN))
"RTN","PSJPAD50",66,0)
 ;
"RTN","PSJPAD50",67,0)
 I $G(PSII)>1 S DRGIEN=""
"RTN","PSJPAD50",68,0)
 I $G(PSJORD) N PSJLOC S PSJLOC=$$ORDLOC($G(PSJORD),$G(PSGP))
"RTN","PSJPAD50",69,0)
 ;
"RTN","PSJPAD50",70,0)
 S NEWDRIEN=""
"RTN","PSJPAD50",71,0)
 K DRGSRCH
"RTN","PSJPAD50",72,0)
 S DRGNAME=$S($G(DRGIEN):$P($G(^PSDRUG(+DRGIEN,0)),"^"),1:"")
"RTN","PSJPAD50",73,0)
 S DIR("A")="Select DISPENSE DRUG: "_$S(DRGNAME]"":DRGNAME_"//",1:"")
"RTN","PSJPAD50",74,0)
 S DIR("?")="^D SEARCH^PSJPAD50(.DRGIEN,"""",PSJLOC,.NEWDRG,PSJOI,1)"
"RTN","PSJPAD50",75,0)
 ; Quit if default accepted, or user wants out
"RTN","PSJPAD50",76,0)
 D ^DIR I X=""!$G(DUOUT)!$G(DTOUT) D  Q DRGIEN
"RTN","PSJPAD50",77,0)
 .I '$G(DRGIEN) S PSJDONE=1
"RTN","PSJPAD50",78,0)
 ;
"RTN","PSJPAD50",79,0)
 I X="@",$G(DRGIEN) D  Q NEWDRIEN
"RTN","PSJPAD50",80,0)
 .I $G(PSJORD)["U" K X S NEWDRIEN="" D
"RTN","PSJPAD50",81,0)
 ..D EN^DDIOL("Drugs for active orders cannot be deleted, but can be given an INACTIVE DATE")
"RTN","PSJPAD50",82,0)
  .; If Pending renewal, set flag to prevent change to dispense drug, can only be inactivated.
"RTN","PSJPAD50",83,0)
 .N PSJPNDRN I $G(PSGORD) I $E(PSGORD,$L(PSGORD))="P",$P($G(^PS(53.1,+PSGORD,0)),"^",24)="R" K X S NEWDRIEN="" D
"RTN","PSJPAD50",84,0)
 ..D EN^DDIOL("Dispense drugs for renewal orders cannot be deleted, but can be given an INACTIVE DATE.")
"RTN","PSJPAD50",85,0)
 .I $G(X)="" D EN^DDIOL("<NOTHING DELETED>") Q
"RTN","PSJPAD50",86,0)
 .N DIR S DIR(0)="Y",DIR("A")="SURE YOU WANT TO DELETE THE ENTIRE DISPENSE DRUG" D ^DIR
"RTN","PSJPAD50",87,0)
 .S NEWDRIEN=DRGIEN_"^@"
"RTN","PSJPAD50",88,0)
 ; Default not accepted
"RTN","PSJPAD50",89,0)
 S TMPSRCH=X,PSJSRCH=1
"RTN","PSJPAD50",90,0)
 I X]"" D SELSRCH(.DRGIEN,.NEWDRIEN,PSJOI,PSJLOC,TMPSRCH)
"RTN","PSJPAD50",91,0)
 ;
"RTN","PSJPAD50",92,0)
 S:NEWDRIEN<1 NEWDRIEN=""
"RTN","PSJPAD50",93,0)
 I 'NEWDRIEN K DRGSRCH
"RTN","PSJPAD50",94,0)
 Q NEWDRIEN
"RTN","PSJPAD50",95,0)
 ;
"RTN","PSJPAD50",96,0)
SEARCH(DRGIEN,DRGSRCH,PSJLOC,NEWDRG,PSJOI,PSJHELP) ; Search Drug (#50) file using user input
"RTN","PSJPAD50",97,0)
 ; Input:   DRGIEN - Pointer to DRUG file (#50) passed in - default dispense drug
"RTN","PSJPAD50",98,0)
 ;         DRGSRCH - Search value for DRUG file (user input)
"RTN","PSJPAD50",99,0)
 ;          PSJLOC - Location of current order - Patient Ward (inpatient) or Clinic (clinic order)
"RTN","PSJPAD50",100,0)
 ;          NEWDRG - Pointer to DRUG file (#50) selected by user
"RTN","PSJPAD50",101,0)
 ;           PSJOI - Pointer to Pharmacy Orderable Item (#50.7), associated with order
"RTN","PSJPAD50",102,0)
 ;         PSJHELP - Flag indicating search is for 1) display only:      $G(PSJHELP)
"RTN","PSJPAD50",103,0)
 ;                                              or 2) allows selection: '$G(PSJHELP)
"RTN","PSJPAD50",104,0)
 ;
"RTN","PSJPAD50",105,0)
 N PSJSEL,PSJLIST,PSJDCNT,PSJDIEN,PSJCONT
"RTN","PSJPAD50",106,0)
 S PSJCONT=1
"RTN","PSJPAD50",107,0)
 ;
"RTN","PSJPAD50",108,0)
 D DDLIST(.DRGIEN)
"RTN","PSJPAD50",109,0)
 ;
"RTN","PSJPAD50",110,0)
 S PSJLIST="",PSJOSCRN="",DRGSRCH="?"
"RTN","PSJPAD50",111,0)
 S PSJSEL=$$PSDRUG(DRGIEN,DRGSRCH,.PSJLIST,PSJLOC,PSJOI,PSJOSCRN)
"RTN","PSJPAD50",112,0)
 ; If a drug was selected, return in NEWDRG parameter by reference 
"RTN","PSJPAD50",113,0)
 I PSJSEL S NEWDRG=PSJSEL
"RTN","PSJPAD50",114,0)
 Q
"RTN","PSJPAD50",115,0)
 ;
"RTN","PSJPAD50",116,0)
SELECT(PSJLIST,PSJHELP) ; Select a drug from the list PSJLIST
"RTN","PSJPAD50",117,0)
 N CNT,LAST,PSJSEL,PSJOUT,DIR
"RTN","PSJPAD50",118,0)
 S PSJSEL=""
"RTN","PSJPAD50",119,0)
 S LAST=$O(PSJLIST(1,999999),-1) S:'LAST LAST=1
"RTN","PSJPAD50",120,0)
 S CNT=0 F  S CNT=$O(PSJLIST(1,CNT)) Q:'CNT  S PSJOUT(CNT)="  "_CNT_"   "_PSJLIST(1,CNT)
"RTN","PSJPAD50",121,0)
 I '$D(PSJOUT) W:'$G(PSJHELP) " ??" Q ""
"RTN","PSJPAD50",122,0)
 D EN^DDIOL("  Choose from:")
"RTN","PSJPAD50",123,0)
 D EN^DDIOL(.PSJOUT)
"RTN","PSJPAD50",124,0)
 Q:$G(PSJHELP) ""
"RTN","PSJPAD50",125,0)
 S DIR(0)="NOA^1:"_LAST,DIR("A")="CHOOSE 1-"_$G(LAST)_": " D ^DIR
"RTN","PSJPAD50",126,0)
 S:$G(Y) PSJSEL=$G(PSJLIST(2,Y))
"RTN","PSJPAD50",127,0)
 Q PSJSEL
"RTN","PSJPAD50",128,0)
 ;
"RTN","PSJPAD50",129,0)
SELSRCH(DRGIEN,NEWDRIEN,PSJOI,PSJLOC,TMPSRCH,PSJSCRN) ; Select drug 
"RTN","PSJPAD50",130,0)
 ; OR, select drug from Orderable Item screened DRUG file (#50).
"RTN","PSJPAD50",131,0)
 ;
"RTN","PSJPAD50",132,0)
 N PARTNAM,FOUND,PSJLIST,DCT,PSJQSRCH,PSJLOC
"RTN","PSJPAD50",133,0)
 K DIR
"RTN","PSJPAD50",134,0)
 ;
"RTN","PSJPAD50",135,0)
 S PSJLOC=$$ORDLOC($G(PSJORD),$G(PSGP))
"RTN","PSJPAD50",136,0)
 I $L($G(TMPSRCH))>0,$D(DRGIEN)>1 D
"RTN","PSJPAD50",137,0)
 .N I,DRGNAME,PSJLAST,PSJDIR,DIR,Y
"RTN","PSJPAD50",138,0)
 .S DCT=0 F I=0:1 S DCT=$O(DRGIEN(DCT)) Q:'DCT
"RTN","PSJPAD50",139,0)
 .S DCT=$O(DRGIEN(0))
"RTN","PSJPAD50",140,0)
 .I I=1 S DRGNAME=$P($G(^PSDRUG(+DRGIEN(DCT),0)),"^") I $E(DRGNAME,1,$L(TMPSRCH))=TMPSRCH D  Q
"RTN","PSJPAD50",141,0)
 ..S PARTNAM=$E(DRGNAME,$L(TMPSRCH)+1,$L(DRGNAME)) W PARTNAM
"RTN","PSJPAD50",142,0)
 ..S DIR(0)="Y",DIR("B")="Y",DIR("A")="        ...OK" D ^DIR
"RTN","PSJPAD50",143,0)
 ..I Y>0 S NEWDRIEN=+$G(DRGIEN(DCT))
"RTN","PSJPAD50",144,0)
 .N PSJDIR S DCT=0 F I=1:1 S DCT=$O(DRGIEN(DCT)) Q:'DCT  D
"RTN","PSJPAD50",145,0)
 ..N PSJQTY,PSJMSG
"RTN","PSJPAD50",146,0)
 ..S PSJLOC=$$ORDLOC($G(PSJORD),$G(PSGP))
"RTN","PSJPAD50",147,0)
 ..S DRGNAME=$P($G(^PSDRUG(+DRGIEN(DCT),0)),"^")
"RTN","PSJPAD50",148,0)
 ..S PSJDIR=$G(PSJDIR)_I_":"_DRGNAME_";"
"RTN","PSJPAD50",149,0)
 ..S PSJQTY=$$DRGQTY^PSJPADSI(+$G(DRGIEN(DCT)),$S($E(PSJLOC,$L(PSJLOC))="C":"CL",1:"WD"),+PSJLOC)
"RTN","PSJPAD50",150,0)
 ..D GETS^DIQ(50,+$G(DRGIEN(DCT))_",",101,,"PSJMSG")
"RTN","PSJPAD50",151,0)
 ..S DIR("A",I)="  "_I_"     "_DRGNAME_"    PADE:"_PSJQTY_"   "_$G(PSJMSG(50,DRGIEN_",",101))
"RTN","PSJPAD50",152,0)
 .Q:$L(PSJDIR)<4  S PSJLAST=+$O(DRGIEN(999),-1)
"RTN","PSJPAD50",153,0)
 .Q:'PSJLAST
"RTN","PSJPAD50",154,0)
 .S DIR(0)="SAO^"_PSJDIR,DIR("A")="CHOOSE 1-"_PSJLAST_": "
"RTN","PSJPAD50",155,0)
 .D ^DIR Q:Y<1
"RTN","PSJPAD50",156,0)
 .S:$G(DRGIEN(Y)) NEWDRIEN=+$G(DRGIEN(Y))
"RTN","PSJPAD50",157,0)
 ;
"RTN","PSJPAD50",158,0)
 Q:$G(NEWDRIEN) 
"RTN","PSJPAD50",159,0)
 ;
"RTN","PSJPAD50",160,0)
 ; User input not matched to any dispense drugs already filed to order - try to find an exact match; if found, quit and return IEN
"RTN","PSJPAD50",161,0)
 S PSJQSRCH=0
"RTN","PSJPAD50",162,0)
 I '$G(FOUND) D  S:$G(FOUND) NEWDRIEN=DRGIEN(FOUND) I $G(FOUND)!$G(PSJQSRCH) Q
"RTN","PSJPAD50",163,0)
 .N PSJSCR,PSJFIND
"RTN","PSJPAD50",164,0)
 .S PSJSCRN="I $P($G(^(2)),U,3)[""U"",$S('$G(PSJOI):1,1:PSJOI=+$G(^(2))) I ($G(^PSDRUG(+$G(Y)))>($$NOW^XLFDT-1))!'$G(^PSDRUG(+$G(Y),""I""))"
"RTN","PSJPAD50",165,0)
 .S PSJFIND=$$FIND1^DIC(50,,"M",TMPSRCH,,PSJSCRN)
"RTN","PSJPAD50",166,0)
 .; If there's only one exact match, but it's aleady in the order, and user didn't select it, quit, there's nothing else to do
"RTN","PSJPAD50",167,0)
 .I PSJFIND,(+PSJFIND=+$G(DRGIEN)) S PSJQSRCH=1 Q
"RTN","PSJPAD50",168,0)
 .I $G(PSJFIND) D
"RTN","PSJPAD50",169,0)
 ..N DIR S DIR(0)="Y",DIR("B")="N",DIR("A")="  Are you adding '"_$P($G(^PSDRUG(+PSJFIND,0)),"^")_"' as a new DISPENSE DRUG? "
"RTN","PSJPAD50",170,0)
 ..D ^DIR Q:Y<1
"RTN","PSJPAD50",171,0)
 ..S FOUND=+$O(DRGIEN(999),-1)+1,DRGIEN(FOUND)=+PSJFIND_"^^"_$P($G(^PSDRUG(+PSJFIND,0)),"^")
"RTN","PSJPAD50",172,0)
 ; User selected a dispense drug that was already filed with the order - they must want to edit the Units per Dose
"RTN","PSJPAD50",173,0)
 I $G(FOUND) D
"RTN","PSJPAD50",174,0)
 .S PARTNAM=$S('TMPSRCH:$E($P(DRGIEN(FOUND),"^",3),$L(TMPSRCH)+1,99),1:"  "_$P(DRGIEN(FOUND),"^",3)) W PARTNAM
"RTN","PSJPAD50",175,0)
 .N DIR,Y S DIR(0)="Y",DIR("B")="Y",DIR("A")="        ...OK" D ^DIR
"RTN","PSJPAD50",176,0)
 .I Y>0 S NEWDRIEN=+$G(DRGIEN(FOUND))
"RTN","PSJPAD50",177,0)
 Q:$G(NEWDRIEN)  ; User accepted default
"RTN","PSJPAD50",178,0)
 ;
"RTN","PSJPAD50",179,0)
 S PSJLIST="",PSJOSCRN=""
"RTN","PSJPAD50",180,0)
 S FOUND=$$PSDRUG(DRGIEN,TMPSRCH,.PSJLIST,PSJLOC,PSJOI,PSJOSCRN)
"RTN","PSJPAD50",181,0)
 ; If a drug was selected, return in NEWDRIEN parameter by reference
"RTN","PSJPAD50",182,0)
 I FOUND S NEWDRIEN=FOUND
"RTN","PSJPAD50",183,0)
 Q
"RTN","PSJPAD50",184,0)
 ;
"RTN","PSJPAD50",185,0)
FILE(DRGIEN,PSJSRCH) ; File drug into ^PS(53.45
"RTN","PSJPAD50",186,0)
 ;
"RTN","PSJPAD50",187,0)
 N DA,DIC,DIE,DR,DIR,PSDD
"RTN","PSJPAD50",188,0)
 ;
"RTN","PSJPAD50",189,0)
 ; If an existing dispense drug was selected, allow the user to interactively edit the entry and quit
"RTN","PSJPAD50",190,0)
 ;I $D(^PS(53.45,PSJSYSP,2,"B",+$G(DRGIEN))) S PSDD=$O(^PS(53.45,PSJSYSP,2,"B",+DRGIEN,0)) D  Q
"RTN","PSJPAD50",191,0)
 S PSDD=$$CHK5345(+$G(PSJSYSP),+$G(DRGIEN)) I PSDD D  Q
"RTN","PSJPAD50",192,0)
 .; If Pending renewal, set flag to prevent change to dispense drug, can only be inactivated.
"RTN","PSJPAD50",193,0)
 .N PSJPNDRN I $G(PSGORD) I $E(PSGORD,$L(PSGORD))="P",$P($G(^PS(53.1,+PSGORD,0)),"^",24)="R" S PSJPNDRN=1
"RTN","PSJPAD50",194,0)
 .; User wants to delete the dispense drug - delete and quit
"RTN","PSJPAD50",195,0)
 .I $P(DRGIEN,"^",2)="@" D  Q
"RTN","PSJPAD50",196,0)
 ..N DIK,DA S DIK="^PS(53.45,"_+$G(PSJSYSP)_",2,",DA=PSDD,DA(1)=+$G(PSJSYSP)
"RTN","PSJPAD50",197,0)
 ..D ^DIK
"RTN","PSJPAD50",198,0)
 .;
"RTN","PSJPAD50",199,0)
 .; User wants to edit existing dispense drug
"RTN","PSJPAD50",200,0)
 .S DIE="^PS(53.45,"_PSJSYSP_",2,",DA=PSDD,DA(1)=PSJSYSP
"RTN","PSJPAD50",201,0)
 .S DR=$S($G(PSJSRCH):".01;",1:"")
"RTN","PSJPAD50",202,0)
 .S DR=DR_".02"_$S($G(PSJPNDRN):";.03",$E($G(PSJORD),$L(PSJORD))["U":";.03",1:"") D ^DIE
"RTN","PSJPAD50",203,0)
 ;
"RTN","PSJPAD50",204,0)
 ; If a new entry is being added, find the  next available node
"RTN","PSJPAD50",205,0)
 I '$G(PSDD) S PSDD=$O(^PS(53.45,PSJSYSP,2,999),-1)+1
"RTN","PSJPAD50",206,0)
 ;
"RTN","PSJPAD50",207,0)
 S DIE="^PS(53.45,"_PSJSYSP_",2,",DA=PSDD,DA(1)=PSJSYSP,DR=".01////"_+$G(DRGIEN) D ^DIE
"RTN","PSJPAD50",208,0)
 ;
"RTN","PSJPAD50",209,0)
 ; If adding a new entry, allow the user to interactively add the entry
"RTN","PSJPAD50",210,0)
 S DIE="^PS(53.45,"_PSJSYSP_",2,",DA=PSDD,DA(1)=PSJSYSP
"RTN","PSJPAD50",211,0)
 S DR=".01;.02"_$S($G(PSJPNDRN):";.03",$E($L($G(PSJORD)))["U":";.03",1:"") D ^DIE
"RTN","PSJPAD50",212,0)
 Q
"RTN","PSJPAD50",213,0)
 ;
"RTN","PSJPAD50",214,0)
PSDRUG(DRGIEN,DRGSRCH,PSJLIST,PSJLOC,PSJOI,PSJOSCRN)  ; Look for drug in file 50
"RTN","PSJPAD50",215,0)
 ;
"RTN","PSJPAD50",216,0)
 N DIC,D,PSJTABLN,PSJLT
"RTN","PSJPAD50",217,0)
 ; If PSJLOC is appended with "C", flag it as clinic, otherwise, flag as ward
"RTN","PSJPAD50",218,0)
 S PSJLT=$S(PSJLOC["C":"CL",1:"WD")
"RTN","PSJPAD50",219,0)
 ; If not a clinic, and we don't know the ward, try to find from DFN via call to INP^VADPT
"RTN","PSJPAD50",220,0)
 I PSJLT="WD",'$G(PSJLOC) N VAIN,VAINDT,VAROOT,VAHOW D INP^VADPT S PSJLOC=+$G(VAIN(4))
"RTN","PSJPAD50",221,0)
 S PSJLOC=$S(+$G(PSJLOC):PSJLOC,1:+$G(VAIN(4)))
"RTN","PSJPAD50",222,0)
 S DIC="^PSDRUG(",D="B^C^VAPN^VAC^NDC^XATC^ASP"
"RTN","PSJPAD50",223,0)
 S DIC("?")="Select the medication you wish the patient to receive." W:PSJSYSU<3 "  You should consult",!,"with your pharmacy before ordering any non-formulary medication." W !
"RTN","PSJPAD50",224,0)
 S DIC("S")="I $P($G(^(2)),U,3)[""U"",$S('$G(PSJOI):1,1:PSJOI=+$G(^(2))) I ($G(^PSDRUG(+$G(Y),""I""))>($G(PSGDT)))!'$G(^PSDRUG(+$G(Y),""I""))"
"RTN","PSJPAD50",225,0)
 S DIC(0)="QMEZ",X=DRGSRCH
"RTN","PSJPAD50",226,0)
 S $P(PSJTABLN," ",30)=" " S DIC("W")="W $E(PSJTABLN,1,(40-$L($P($G(^PSDRUG(+$G(Y),0)),""^""))))_""  PADE:""_$$DRGQTY^PSJPADSI(+Y,PSJLT,+$G(PSJLOC))_""   ""_$P($G(^PSDRUG(+Y,0)),""^"",10)"
"RTN","PSJPAD50",227,0)
 D MIX^DIC1
"RTN","PSJPAD50",228,0)
 Q Y
"RTN","PSJPAD50",229,0)
 ;
"RTN","PSJPAD50",230,0)
ORDLOC(PSJORD,PSGP) ; Get clinic location from PSJORD order, if it exists
"RTN","PSJPAD50",231,0)
 N PSJLOC
"RTN","PSJPAD50",232,0)
 Q:'$G(PSJORD) ""
"RTN","PSJPAD50",233,0)
 Q:",U,P,"'[(","_$E(PSJORD,$L(PSJORD))_",") ""
"RTN","PSJPAD50",234,0)
 I PSJORD["U" S PSJLOC=$G(^PS(55,+$G(PSGP),5,+$G(PSJORD),8)) D  Q PSJLOC
"RTN","PSJPAD50",235,0)
 .I PSJLOC,$P(PSJLOC,"^",2) S PSJLOC=+PSJLOC_"C"
"RTN","PSJPAD50",236,0)
 .I '$G(PSJLOC) S PSJLOC=+$G(VAIN(4))
"RTN","PSJPAD50",237,0)
 I PSJORD["P" S PSJLOC=$G(^PS(53.1,+$G(PSJORD),"DSS")) D  Q PSJLOC
"RTN","PSJPAD50",238,0)
 .I PSJLOC,$P(PSJLOC,"^",2) S PSJLOC=+PSJLOC_"C"
"RTN","PSJPAD50",239,0)
 .I '$G(PSJLOC) S PSJLOC=+$G(VAIN(4))
"RTN","PSJPAD50",240,0)
 Q ""
"RTN","PSJPAD50",241,0)
 ;
"RTN","PSJPAD50",242,0)
CHKWG(CAB,WARD) ; Return flag indicating WARD is linked to cabinet's WARD GROUPS
"RTN","PSJPAD50",243,0)
 N WG,WD
"RTN","PSJPAD50",244,0)
 S WG=0 F  S WG=$O(^PS(58.63,CAB,3,"B",WG)) Q:'WG  D
"RTN","PSJPAD50",245,0)
 .S WD=0 F  S WD=$O(^PS(57.5,WG,1,"B",WD)) Q:'WD  S WG(WD)=""
"RTN","PSJPAD50",246,0)
 Q $D(WG(+$G(WARD)))
"RTN","PSJPAD50",247,0)
 ;
"RTN","PSJPAD50",248,0)
CHKCG(CAB,CLINIC) ; Return flag indicating CLINIC is linked to cabinet's CLINIC GROUPS
"RTN","PSJPAD50",249,0)
 N CG,CL,CLIEN
"RTN","PSJPAD50",250,0)
 S CG=0 F  S CG=$O(^PS(58.63,CAB,5,"B",CG)) Q:'CG  D
"RTN","PSJPAD50",251,0)
 .S CL=0 F  S CL=$O(^PS(57.8,CG,1,CL)) Q:'CL  D
"RTN","PSJPAD50",252,0)
 ..S CLIEN=$G(^PS(57.8,CG,1,CL,0)) Q:'CLIEN
"RTN","PSJPAD50",253,0)
 ..S CG(CLIEN)=""
"RTN","PSJPAD50",254,0)
 Q $D(CG(+$G(CLINIC)))
"RTN","PSJPAD50",255,0)
 ;
"RTN","PSJPAD50",256,0)
PADEWD(WARD) ; Return flag indicating if WARD is linked to any active PADE ward groups
"RTN","PSJPAD50",257,0)
 Q:'$G(WARD) ""
"RTN","PSJPAD50",258,0)
 N PDWARDS,PWD,WG,PDLINK,PADE
"RTN","PSJPAD50",259,0)
 S PDLINK=0
"RTN","PSJPAD50",260,0)
 S WG=0 F  S WG=$O(^PS(58.63,"WG",WG)) Q:'WG  D
"RTN","PSJPAD50",261,0)
 .S PADE=0 F  S PADE=$O(^PS(58.63,"WG",WG,PADE)) Q:'PADE  D
"RTN","PSJPAD50",262,0)
 ..Q:$P($G(^PS(58.63,PADE,0)),"^",4)="I"
"RTN","PSJPAD50",263,0)
 ..S PWD=0 F  S PWD=$O(^PS(57.5,WG,1,"B",PWD)) Q:'PWD  S PWD(PWD)=""
"RTN","PSJPAD50",264,0)
 I $D(PWD(+WARD)) S PDLINK=1
"RTN","PSJPAD50",265,0)
 I '$G(PDLINK) I $D(^PS(58.63,"WD",+WARD)) D
"RTN","PSJPAD50",266,0)
 .S PADE=0 F  S PADE=$O(^PS(58.63,"WD",+WARD,PADE)) Q:'PADE  D
"RTN","PSJPAD50",267,0)
 ..Q:$P($G(^PS(58.63,PADE,0)),"^",4)="I"
"RTN","PSJPAD50",268,0)
 ..S PDLINK=1
"RTN","PSJPAD50",269,0)
 Q PDLINK
"RTN","PSJPAD50",270,0)
 ;
"RTN","PSJPAD50",271,0)
PADECL(CLINIC) ; Return flag indicating if CLINIC is linked to any PADE devices
"RTN","PSJPAD50",272,0)
 Q:'$G(CLINIC) ""
"RTN","PSJPAD50",273,0)
 N PDCLINS,PCL,CG,PDLINK,PADE,CLINAM,PARTIAL
"RTN","PSJPAD50",274,0)
 S PDLINK=0
"RTN","PSJPAD50",275,0)
 S CG=0 F  S CG=$O(^PS(58.63,"CG",CG)) Q:'CG  D
"RTN","PSJPAD50",276,0)
 .S PADE=0 F  S PADE=$O(^PS(58.63,"CG",CG,PADE)) Q:'PADE  D
"RTN","PSJPAD50",277,0)
 ..Q:$P($G(^PS(58.63,PADE,0)),"^",4)="I"
"RTN","PSJPAD50",278,0)
 ..S PCL=0 F  S PCL=$O(^PS(57.8,"AD",CG,PCL)) Q:'PCL  S PCL(PCL)=""
"RTN","PSJPAD50",279,0)
 I $D(PCL(+CLINIC)) S PDLINK=1
"RTN","PSJPAD50",280,0)
 I '$G(PDLINK) I $D(^PS(58.63,"CL",+CLINIC)) D
"RTN","PSJPAD50",281,0)
 .S PADE=0 F  S PADE=$O(^PS(58.63,"CL",+CLINIC,PADE)) Q:'PADE  D
"RTN","PSJPAD50",282,0)
 ..Q:$P($G(^PS(58.63,PADE,0)),"^",4)="I"
"RTN","PSJPAD50",283,0)
 ..S PDLINK=1
"RTN","PSJPAD50",284,0)
 ; If no match, check PADEs associated with clinic wildcards
"RTN","PSJPAD50",285,0)
 I '$G(PDLINK) D GETS^DIQ(44,+CLINIC,".01",,"CLINAM") D
"RTN","PSJPAD50",286,0)
 .S CLINAM=$G(CLINAM(44,+CLINIC_",",".01")),PARTIAL=$E(CLINAM,1,2)
"RTN","PSJPAD50",287,0)
 .F  S PARTIAL=$O(^PS(58.63,"WC",PARTIAL)) Q:$E(PARTIAL,1,3)'=$E(CLINAM,1,3)!$G(PDLINK)  D
"RTN","PSJPAD50",288,0)
 ..N PADE,STATUS S STATUS=""
"RTN","PSJPAD50",289,0)
 ..S PADE="" F  S PADE=$O(^PS(58.63,"WC",PARTIAL,PADE)) Q:'PADE!$G(PDLINK)  D
"RTN","PSJPAD50",290,0)
 ...S STATUS=$P($G(^PS(58.63,PADE,0)),"^",4)
"RTN","PSJPAD50",291,0)
 ...Q:(STATUS="I")
"RTN","PSJPAD50",292,0)
 ...I $E(CLINAM,1,$L(PARTIAL))=PARTIAL S PDLINK=1
"RTN","PSJPAD50",293,0)
 Q PDLINK
"RTN","PSJPAD50",294,0)
 ;
"RTN","PSJPAD50",295,0)
DDLIST(DRGARRAY)  ; List Drug Array when "?" entered at Dispense Drug prompt
"RTN","PSJPAD50",296,0)
 ;
"RTN","PSJPAD50",297,0)
 ;Select DISPENSE DRUG: ?
"RTN","PSJPAD50",298,0)
 N PSJDDAR,NXTDRG,LNCOUNT
"RTN","PSJPAD50",299,0)
 S LNCOUNT=1
"RTN","PSJPAD50",300,0)
 S PSJDDAR(LNCOUNT)="    Answer with DISPENSE DRUG",LNCOUNT=LNCOUNT+1
"RTN","PSJPAD50",301,0)
 S PSJDDAR(LNCOUNT)="   Choose from:",LNCOUNT=LNCOUNT+1
"RTN","PSJPAD50",302,0)
 S NXTDRG=0 F  S NXTDRG=$O(DRGARRAY(NXTDRG)) Q:'NXTDRG  D
"RTN","PSJPAD50",303,0)
 .N DRGIEN,DRGNAME
"RTN","PSJPAD50",304,0)
 .S DRGIEN=+$G(DRGARRAY(NXTDRG))
"RTN","PSJPAD50",305,0)
 .S DRGNAME=$P($G(^PSDRUG(+DRGIEN,0)),"^")
"RTN","PSJPAD50",306,0)
 .Q:DRGIEN=""  S PSJDDAR(LNCOUNT)="   "_DRGNAME,LNCOUNT=LNCOUNT+1
"RTN","PSJPAD50",307,0)
 S PSJDDAR(LNCOUNT)="",LNCOUNT=LNCOUNT+1
"RTN","PSJPAD50",308,0)
 S PSJDDAR(LNCOUNT)="     You may enter a new DISPENSE DRUG, if you wish",LNCOUNT=LNCOUNT+1
"RTN","PSJPAD50",309,0)
 S PSJDDAR(LNCOUNT)="     Only dispense drugs marked for Unit Dose use.",LNCOUNT=LNCOUNT+1
"RTN","PSJPAD50",310,0)
 S PSJDDR(LNCOUNT)="",LNCOUNT=LNCOUNT+1
"RTN","PSJPAD50",311,0)
 S PSJDDAR(LNCOUNT)="",LNCOUNT=LNCOUNT+1
"RTN","PSJPAD50",312,0)
 D EN^DDIOL(.PSJDDAR)
"RTN","PSJPAD50",313,0)
 Q
"RTN","PSJPAD50",314,0)
 ;
"RTN","PSJPAD50",315,0)
CHK5345(PSJSYSP,DRGIEN) ; Check if file 50 pointer DRGIEN exists in Dispense Drug temp global ^PS(53.45,PSJSYSP,2,n
"RTN","PSJPAD50",316,0)
 ; PSJSYSP=User DUZ
"RTN","PSJPAD50",317,0)
 ; DRGIEN=pointer to drug IEN in file 50
"RTN","PSJPAD50",318,0)
 N DDCOUNT,FOUND
"RTN","PSJPAD50",319,0)
 Q:'$G(DRGIEN) 0
"RTN","PSJPAD50",320,0)
 S FOUND=0
"RTN","PSJPAD50",321,0)
 S DDCOUNT=0 F  S DDCOUNT=$O(^PS(53.45,PSJSYSP,2,DDCOUNT)) Q:'DDCOUNT  I $P($G(^PS(53.45,PSJSYSP,2,DDCOUNT,0)),"^")=+$G(DRGIEN) S FOUND=DDCOUNT
"RTN","PSJPAD50",322,0)
 Q FOUND
"RTN","PSJPAD70")
0^29^B193106268^n/a
"RTN","PSJPAD70",1,0)
PSJPAD70 ;BIR/JCH-HL7 UTILITY FOR PADE INBOUND POCKET ACTIVITY ;01/06/16 1:34  PM
"RTN","PSJPAD70",2,0)
 ;;5.0;INPATIENT MEDICATIONS ;**317**;16 DEC 97;Build 130
"RTN","PSJPAD70",3,0)
 ;
"RTN","PSJPAD70",4,0)
 ; Reference to $$HLDATE^HLFNC is supported by DBIA 10106
"RTN","PSJPAD70",5,0)
 ; Reference to ^XMD is supported by DBIA 10070
"RTN","PSJPAD70",6,0)
 ; Reference to ^XLFDT is supported by DBIA# 10103.
"RTN","PSJPAD70",7,0)
 ;
"RTN","PSJPAD70",8,0)
 Q
"RTN","PSJPAD70",9,0)
 ;
"RTN","PSJPAD70",10,0)
DWO(PSJOMS) ; Send Dispensed Without Order (DWO) Alert
"RTN","PSJPAD70",11,0)
 N GROUPS
"RTN","PSJPAD70",12,0)
 S GROUPS=""
"RTN","PSJPAD70",13,0)
 Q:'$$ACTDWO(.PSJOMS)
"RTN","PSJPAD70",14,0)
 D GETGRPS(.PSJOMS,.GROUPS)
"RTN","PSJPAD70",15,0)
 D DWOSEND(.PSJOMS,.GROUPS)
"RTN","PSJPAD70",16,0)
 Q
"RTN","PSJPAD70",17,0)
 ;
"RTN","PSJPAD70",18,0)
ACTDWO(PSJOMS)  ; Check if dispensing device (cabinet) is active for DWO messages
"RTN","PSJPAD70",19,0)
 N CABNAME,CABIEN,RESULT,ERROR,PSJPSYS
"RTN","PSJPAD70",20,0)
 ; Get PADE Inbound System name
"RTN","PSJPAD70",21,0)
 S PSJPSYS=$G(PSJOMS("DISPSYS")) Q:(PSJPSYS="") 0
"RTN","PSJPAD70",22,0)
 S PSJPSYS=$$FIND1^DIC(58.601,"","",PSJPSYS) Q:'PSJPSYS ""
"RTN","PSJPAD70",23,0)
 ; Get Cabinet name
"RTN","PSJPAD70",24,0)
 S CABNAME=$G(PSJOMS("CABID")) Q:(CABNAME="") 0
"RTN","PSJPAD70",25,0)
 S CABIEN=$$FIND1^DIC(58.63,"","",CABNAME) Q:'CABIEN ""
"RTN","PSJPAD70",26,0)
 ; Get value in SEND DWO MESSAGES field (#3) in PADE DISPENSING DEVICE file (#58.63)
"RTN","PSJPAD70",27,0)
 D GETS^DIQ(58.63,CABIEN_",",3,"I","RESULT","ERROR")
"RTN","PSJPAD70",28,0)
 Q +$G(RESULT(58.63,CABIEN_",",3,"I"))
"RTN","PSJPAD70",29,0)
 ;
"RTN","PSJPAD70",30,0)
GETGRPS(PSJOMS,GROUPS)  ; Find Entity mail group in mail group variable pointer field
"RTN","PSJPAD70",31,0)
 ;                       DWO MAIL GROUP (#3) in the PADE INVENTORY SYSTEM file (58.601)
"RTN","PSJPAD70",32,0)
 ;
"RTN","PSJPAD70",33,0)
 ;  Input: PSJOMS("DISPSYS") = Inbound Dispensing System name.
"RTN","PSJPAD70",34,0)
 ;         PSJOMS("CABID")    = PADE cabinet name.
"RTN","PSJPAD70",35,0)
 ;
"RTN","PSJPAD70",36,0)
 ; Output: GROUPS(EntityPointer,Count)=MailGroupName
"RTN","PSJPAD70",37,0)
 ;
"RTN","PSJPAD70",38,0)
 ;  Dispensed Without Orders (DWO) mail groups may be associated with up to seven entities. 
"RTN","PSJPAD70",39,0)
 ;  Each entity is associated with a precedence level, creating a hierarchy such that only mail groups
"RTN","PSJPAD70",40,0)
 ;  associated with the entity(ies) with the highest precedence will receive a DWO message.
"RTN","PSJPAD70",41,0)
 ;  
"RTN","PSJPAD70",42,0)
 ;  If two entities have the same precedence, and both have DWO mail groups defined, both will receive
"RTN","PSJPAD70",43,0)
 ;  a DWO message. For example, if an incoming PADE inventory HL7 message is associated with a cabinet
"RTN","PSJPAD70",44,0)
 ;  that does not have a DWO mail group defined, but the cabinet is associated with a ward and a clinic,
"RTN","PSJPAD70",45,0)
 ;  each of which DOES have a DWO mail group defined, the DWO message will go the both the ward mail
"RTN","PSJPAD70",46,0)
 ;  group and the clinic mail group, because the ward and the clinic have the same precedence.
"RTN","PSJPAD70",47,0)
 ;
"RTN","PSJPAD70",48,0)
 ;  If none of the entities associated with an incoming PADE inventory HL7 message is associated with
"RTN","PSJPAD70",49,0)
 ;  a DWO mail group, no DWO message is sent.
"RTN","PSJPAD70",50,0)
 ;
"RTN","PSJPAD70",51,0)
 ; PADE DWO message entities, in  order of precedence
"RTN","PSJPAD70",52,0)
 ;   1)PADE CABINET : PADE DISPENSING DEVICE file (#58.63)
"RTN","PSJPAD70",53,0)
 ;   2)........WARD : WARD LOCATION file (#42)
"RTN","PSJPAD70",54,0)
 ;   ........CLINIC : HOSPITAL LOCATION file (#44)
"RTN","PSJPAD70",55,0)
 ;   3)..WARD GROUP : WARD GROUP file (#57.5)
"RTN","PSJPAD70",56,0)
 ;   ..CLINIC GROUP : CLINIC GROUP file (#57.8)
"RTN","PSJPAD70",57,0)
 ;   4).PADE SYSTEM : PADE INVENTORY SYSTEM file (#58.601)
"RTN","PSJPAD70",58,0)
 ;   ......DIVISION : DIVISION file (#40.8)
"RTN","PSJPAD70",59,0)
 ;    
"RTN","PSJPAD70",60,0)
 N PSJPSYS,PSJECNT,PSJMCT,PSJDWINS,PSJDWMG,PSJRSLT,PSJRSLT1,PSJDWENT,PRIO,TEMPGRP,PSJHI,NEXT
"RTN","PSJPAD70",61,0)
 K GROUPS N PSJCL,PSJCLGRP,PSJWRD,PSJWGRP,PSJCAB,PSJDIV,PSJFICHK,PSJENTYP
"RTN","PSJPAD70",62,0)
 ; Get PADE Inbound System pointer to file 58.601, store in "FICHK" node
"RTN","PSJPAD70",63,0)
 S PSJPSYS=$G(PSJOMS("DISPSYS")) Q:(PSJPSYS="") 0
"RTN","PSJPAD70",64,0)
 S PSJPSYS=$$FIND1^DIC(58.601,"","",PSJPSYS) Q:'PSJPSYS 0
"RTN","PSJPAD70",65,0)
 S PSJPSYS("FICHK",PSJPSYS)=PSJOMS("DISPSYS")
"RTN","PSJPAD70",66,0)
 ; Get PADE Cabinet pointer to file 58.63, store in "FICHK" node
"RTN","PSJPAD70",67,0)
 S PSJCAB=+$$FIND1^DIC(58.63,,,PSJOMS("CABID")),PSJCAB("FICHK",PSJCAB)=PSJOMS("CABID")
"RTN","PSJPAD70",68,0)
 D GETS^DIQ(58.63,PSJCAB,2,"IE","PSJDIV")
"RTN","PSJPAD70",69,0)
 ; Get PADE device Division pointer to file 40.8, store in "FICHK" node
"RTN","PSJPAD70",70,0)
 S PSJDIV("FICHK",+$G(PSJDIV(58.63,PSJCAB_",",2,"I")))=$G(PSJDIV(58.63,PSJCAB_",",2,"E"))
"RTN","PSJPAD70",71,0)
 ; Get PADE device Clinic pointer to file 44, store in "FICHK" node
"RTN","PSJPAD70",72,0)
 D LIST^DIC(58.638,","_PSJCAB_",",".01IE","P",,,,,,,"PSJCL") N CL,CC S CC=0 F  S CC=$O(PSJCL("DILIST",CC)) Q:'CC  D
"RTN","PSJPAD70",73,0)
 .S CL=$P($G(PSJCL("DILIST",CC,0)),"^",3) I CL S PSJCL("FICHK",+CL)=$P(PSJCL("DILIST",CC,0),"^",2)
"RTN","PSJPAD70",74,0)
 K PSJCL("DILIST")
"RTN","PSJPAD70",75,0)
 ; Get PADE device Clinic Group pointer to file 57.8, store in "FICHK" node
"RTN","PSJPAD70",76,0)
 D LIST^DIC(58.637,","_PSJCAB_",",".01IE","P",,,,,,,"PSJCLGRP") N CG,CC S CC=0 F  S CC=$O(PSJCLGRP("DILIST",CC)) Q:'CC  D
"RTN","PSJPAD70",77,0)
 .S CG=$P($G(PSJCLGRP("DILIST",CC,0)),"^",3) I CG S PSJCLGRP("FICHK",+CG)=$P(PSJCLGRP("DILIST",CC,0),"^",2)
"RTN","PSJPAD70",78,0)
 K PSJCLGRP("DILIST")
"RTN","PSJPAD70",79,0)
 ; Get PADE device Ward pointer to file 42, store in "FICHK" node
"RTN","PSJPAD70",80,0)
 D LIST^DIC(58.636,","_PSJCAB_",",".01IE","P",,,,,,,"PSJWRD") N WD,WC S WC=0 F  S WC=$O(PSJWRD("DILIST",WC)) Q:'WC  D
"RTN","PSJPAD70",81,0)
 .S WD=$P($G(PSJWRD("DILIST",WC,0)),"^",3) I WD S PSJWRD("FICHK",+WD)=$P(PSJWRD("DILIST",WC,0),"^",2)
"RTN","PSJPAD70",82,0)
 K PSJWRD("DILIST")
"RTN","PSJPAD70",83,0)
 ; Get PADE Ward Group pointer to file 57.5, store in "FICHK" node
"RTN","PSJPAD70",84,0)
 D LIST^DIC(58.635,","_PSJCAB_",",".01IE","P",,,,,,,"PSJWGRP") N WG,WC S WC=0 F  S WC=$O(PSJWGRP("DILIST",WC)) Q:'WC  D
"RTN","PSJPAD70",85,0)
 .S WG=$P($G(PSJWGRP("DILIST",WC,0)),"^",3) I WG S PSJWGRP("FICHK",+WG)=$P(PSJWGRP("DILIST",WC,0),"^",2)
"RTN","PSJPAD70",86,0)
 K PSJWGRP("DILIST")
"RTN","PSJPAD70",87,0)
 ; Get list of DWO MESSAGE ENTITY values for PADE system in PSJRSLT
"RTN","PSJPAD70",88,0)
 D LIST^DIC(58.6014,","_+PSJPSYS_",",.01,"P",,,,,,,"PSJRSLT","PSJROOT")
"RTN","PSJPAD70",89,0)
 ;
"RTN","PSJPAD70",90,0)
 ; Go through each DWO MESSAGE ENTITY, determine if the entity applies to this cabinet/device
"RTN","PSJPAD70",91,0)
 ; by comparing each DWO MESSAGE ENTITY to the list of entities defined for the cabinet. 
"RTN","PSJPAD70",92,0)
 ;
"RTN","PSJPAD70",93,0)
 S PSJECNT=0 F  S PSJECNT=$O(PSJRSLT("DILIST",PSJECNT)) Q:'PSJECNT  D
"RTN","PSJPAD70",94,0)
 .; Find the source file pointed to by the variable pointer DWO MESSAGE ENTITY field (#4) in the PADE INVENTORY SYSTEM file (#58.601)
"RTN","PSJPAD70",95,0)
 .S PSJDWINS=+$G(PSJRSLT("DILIST",PSJECNT,0))
"RTN","PSJPAD70",96,0)
 .; Get list of mail groups associated with this entity
"RTN","PSJPAD70",97,0)
 .D LIST^DIC(58.60141,","_+PSJDWINS_","_+PSJPSYS_",",.01,"P",,,,,,,"PSJRSLT1")
"RTN","PSJPAD70",98,0)
 .S PSJDWENT=$G(^PS(58.601,PSJPSYS,2,PSJDWINS,0))
"RTN","PSJPAD70",99,0)
 .; Define priority for this entity
"RTN","PSJPAD70",100,0)
 .S PSJENTYP=$S(PSJDWENT["PS(58.63":"1^PSJCAB",PSJDWENT["DG(40.8":"4^PSJDIV",PSJDWENT["PS(58.601":"4^PSJPSYS",PSJDWENT["DIC(42":"2^PSJWRD",PSJDWENT["PS(57.8":"3^PSJCLGRP",PSJDWENT["PS(57.5":"3^PSJWGRP",PSJDWENT["SC(":"2^PSJCL",1:99)
"RTN","PSJPAD70",101,0)
 .S PRIO=+PSJENTYP ;S PRIO=$S((PSJDWENT[58.63):1,(PSJDWENT["DIC(42,")!(PSJDWENT["SC("):2,(PSJDWENT[57.5)!(PSJDWENT[57.8):3,(PSJDWENT[58.601)!(PSJDWENT[40.8):4,1:99)
"RTN","PSJPAD70",102,0)
 .; Quit if this DWO MESSAGE ENTITY from PADE INVENTORY SYSTEM (#58.601) is not applicable to this PADE DISPENSING DEVICE (#58.63)
"RTN","PSJPAD70",103,0)
 .S PSJFICHK=$P(PSJENTYP,"^",2)_"(""FICHK"","_+PSJDWENT_")" Q:'$D(@PSJFICHK)
"RTN","PSJPAD70",104,0)
 .; Go through mail groups, set into TMPGRP by priority
"RTN","PSJPAD70",105,0)
 .S PSJMCT=0 F  S PSJMCT=$O(PSJRSLT1("DILIST",PSJMCT)) Q:'PSJMCT  D
"RTN","PSJPAD70",106,0)
 ..S PSJDWMG=$G(PSJRSLT1("DILIST",PSJMCT,0)) Q:'PSJDWMG
"RTN","PSJPAD70",107,0)
 ..S NEXT=+$O(TEMPGRP(PRIO,PSJDWENT,999),-1)+1
"RTN","PSJPAD70",108,0)
 ..S TEMPGRP(PRIO,PSJDWENT,NEXT)=$P(PSJDWMG,"^",2)
"RTN","PSJPAD70",109,0)
 ;
"RTN","PSJPAD70",110,0)
 ; Move highest priority entity mail groups into GROUPS
"RTN","PSJPAD70",111,0)
 S PSJHI=$O(TEMPGRP("")) I PSJHI]"" M GROUPS=TEMPGRP(PSJHI)
"RTN","PSJPAD70",112,0)
 Q
"RTN","PSJPAD70",113,0)
 ;
"RTN","PSJPAD70",114,0)
DWOSEND(PSJOMS,GROUPS) ;This routine will generate a mailman message when an order is dispensed without an order, and a DWO mail group is defined
"RTN","PSJPAD70",115,0)
 ;
"RTN","PSJPAD70",116,0)
 ;Input:  PSJOMS - Array generated from incoming OMS^O05 HL7 PADE pocket activity message
"RTN","PSJPAD70",117,0)
 ;        GROUPS - VistA Mail Groups to send the DWO message
"RTN","PSJPAD70",118,0)
 ;
"RTN","PSJPAD70",119,0)
 N MSGTEXT,XMTEXT,XMSUB,XMY,XMZ,XMDUZ,MSGTYPE,MSHREC,ENTITY,MAILGRP
"RTN","PSJPAD70",120,0)
 N HLFS,HLCS,MTXTLN,MGCNT,DRGFILNM
"RTN","PSJPAD70",121,0)
 S DRGFILNM="" I $G(PSJOMS("DRGITM")) S:PSJOMS("DRGITM")=+PSJOMS("DRGITM") DRGFILNM=$P($G(^PSDRUG(PSJOMS("DRGITM"),0)),"^")
"RTN","PSJPAD70",122,0)
 I DRGFILNM="" S DRGFILNM=$G(PSJOMS("DRGTXT"))
"RTN","PSJPAD70",123,0)
 S:'$G(PSJOMS("PSJDT")) PSJOMS("PSJDT")=$P($$FMTHL7^XLFDT($$NOW^XLFDT()),"-")
"RTN","PSJPAD70",124,0)
 Q:'($G(PSJOMS("TTYPE"))["V")
"RTN","PSJPAD70",125,0)
 S MTXTLN=0
"RTN","PSJPAD70",126,0)
 S MSGTEXT(MTXTLN)=" ",MTXTLN=MTXTLN+1
"RTN","PSJPAD70",127,0)
 S MSGTEXT(MTXTLN)="A medication was dispensed from a PADE device without an order",MTXTLN=MTXTLN+1
"RTN","PSJPAD70",128,0)
 S MSGTEXT(MTXTLN)=" ",MTXTLN=MTXTLN+1
"RTN","PSJPAD70",129,0)
 S MSGTEXT(MTXTLN)="PADE Device:    "_$G(PSJOMS("CABID")),MTXTLN=MTXTLN+1
"RTN","PSJPAD70",130,0)
 S MSGTEXT(MTXTLN)="",MTXTLN=MTXTLN+1
"RTN","PSJPAD70",131,0)
 S MSGTEXT(MTXTLN)="Date:           "_$$FMTE^XLFDT($$FMDATE^HLFNC(PSJOMS("PSJDT"))),MTXTLN=MTXTLN+1
"RTN","PSJPAD70",132,0)
 S MSGTEXT(MTXTLN)="",MTXTLN=MTXTLN+1
"RTN","PSJPAD70",133,0)
 S MSGTEXT(MTXTLN)="Drug:           "_DRGFILNM,MTXTLN=MTXTLN+1
"RTN","PSJPAD70",134,0)
 S MSGTEXT(MTXTLN)="",MTXTLN=MTXTLN+1
"RTN","PSJPAD70",135,0)
 S MSGTEXT(MTXTLN)="Patient:        "_$G(PSJOMS("PTNAMA"))_","_$G(PSJOMS("PTNAMB"))_" "_$G(PSJOMS("PTNAMC")) D
"RTN","PSJPAD70",136,0)
 .S MSGTEXT(MTXTLN)=MSGTEXT(MTXTLN)_"  "_$S($G(PSJOMS("SSN")):" ("_$G(PSJOMS("SSN"))_")",$G(PSJOMS("PTID"))]"":"(Unknown ID: "_$G(PSJOMS("PTID"))_")",1:" ()"),MTXTLN=MTXTLN+1
"RTN","PSJPAD70",137,0)
 S MSGTEXT(MTXTLN)="",MTXTLN=MTXTLN+1
"RTN","PSJPAD70",138,0)
 S MSGTEXT(MTXTLN)="User:           "_$G(PSJOMS("NUR1B"))_$S($G(PSJOMS("NUR1C"))]"":","_PSJOMS("NUR1C"),1:"")_"  - ID: "_$G(PSJOMS("NUR1A")),MTXTLN=MTXTLN+1
"RTN","PSJPAD70",139,0)
 ; Send message to mail groups
"RTN","PSJPAD70",140,0)
 S XMSUB="PADE DWO:"_$G(PSJOMS("CABID"))_"-"_DRGFILNM
"RTN","PSJPAD70",141,0)
 S XMTEXT="MSGTEXT("
"RTN","PSJPAD70",142,0)
 I $D(GROUPS)>1 S ENTITY="" F  S ENTITY=$O(GROUPS(ENTITY)) Q:ENTITY=""  D
"RTN","PSJPAD70",143,0)
 .S MGCNT=0 F  S MGCNT=$O(GROUPS(ENTITY,MGCNT)) Q:'MGCNT  D
"RTN","PSJPAD70",144,0)
 ..S MAILGRP=GROUPS(ENTITY,MGCNT) Q:MAILGRP=""
"RTN","PSJPAD70",145,0)
 ..S XMY("G."_MAILGRP)=""
"RTN","PSJPAD70",146,0)
 I $D(XMY)<10 D GETPDMGR^PSJPAD7I(.XMY)
"RTN","PSJPAD70",147,0)
 Q:$D(XMY)<10
"RTN","PSJPAD70",148,0)
 S XMDUZ="PADE"
"RTN","PSJPAD70",149,0)
 D ^XMD
"RTN","PSJPAD70",150,0)
 Q
"RTN","PSJPAD70",151,0)
 ;
"RTN","PSJPAD70",152,0)
UNLOAD(PSJPSYS,PADIEN,DRWIEN,DRGIEN,DRGDEV,PCKIEN) ; Unload (delete) a drug from pocket and drawer for device DEV and system SYS
"RTN","PSJPAD70",153,0)
 ; INPUT
"RTN","PSJPAD70",154,0)
 ;    PSJPSYS - Inventory System entry from file 58.601
"RTN","PSJPAD70",155,0)
 ;    PADIEN - Dispensing Device (#1) field (subfile 58.6011) from file 58.601
"RTN","PSJPAD70",156,0)
 ;    DRWIEN - Drawer (#2) field (subfile 58.60112) from dispensing device subfile (#58.60111) in file 58.601
"RTN","PSJPAD70",157,0)
 ;    DRGIEN - Drug (Drawer) (#1) field (subfile 58.601121) from drawer subfile (#58.60112) in file 58.61
"RTN","PSJPAD70",158,0)
 ;    DRGDEV - Drug (Device) (#2) field (subfile 58.60111) from dispensing device subfile (#58.6011) in file 58.601
"RTN","PSJPAD70",159,0)
 ;    PCKIEN - Pocket/Subdrawer (#2) field (subfile 58.601122) from drawer subfile (58.60112) in file 58.601
"RTN","PSJPAD70",160,0)
 ;
"RTN","PSJPAD70",161,0)
 N DIK,DA,PSERR
"RTN","PSJPAD70",162,0)
 ; If the unique location in the device, 
"RTN","PSJPAD70",163,0)
 I $G(PSJPSYS)&$G(PADIEN)&$G(DRWIEN) I $D(^PS(58.601,+PSJPSYS,"DEVICE",+PADIEN,"DRAWER",+DRWIEN)) D
"RTN","PSJPAD70",164,0)
 .S DIK="^PS(58.601,"_+PSJPSYS_",""DEVICE"","_+PADIEN_",""DRAWER"","_+DRWIEN_",""SUB"","
"RTN","PSJPAD70",165,0)
 .S DA(3)=+PSJPSYS,DA(2)=+PADIEN,DA(1)=DRWIEN,DA=PCKIEN D ^DIK
"RTN","PSJPAD70",166,0)
 .S DIK="^PS(58.601,"_+PSJPSYS_",""DEVICE"","_+PADIEN_",""DRAWER"","_+DRWIEN_",""DRUG"","
"RTN","PSJPAD70",167,0)
 .S DA(3)=+PSJPSYS,DA(2)=+PADIEN,DA(1)=DRWIEN,DA=DRGIEN D ^DIK
"RTN","PSJPAD70",168,0)
 ;
"RTN","PSJPAD70",169,0)
 ; Kill Drug (DEVICE) only if balance is less than 1
"RTN","PSJPAD70",170,0)
 N DA,DIK,DEVBAL
"RTN","PSJPAD70",171,0)
 S DEVBAL=$P($G(^PS(58.601,+$G(PSJPSYS),"DEVICE",+$G(PADIEN),"DRUG",+$G(DRGDEV),0)),"^",3)
"RTN","PSJPAD70",172,0)
 Q:DEVBAL>0                     ; Don't delete drug from device/cabinet/station if there it's stocked somewhere else
"RTN","PSJPAD70",173,0)
 S DIK="^PS(58.601,"_+PSJPSYS_",""DEVICE"","_+PADIEN_",""DRUG"","
"RTN","PSJPAD70",174,0)
 S DA(2)=+PSJPSYS,DA(1)=+PADIEN,DA=DRGDEV D ^DIK
"RTN","PSJPAD70",175,0)
 Q
"RTN","PSJPAD70",176,0)
 ;
"RTN","PSJPAD70",177,0)
MANUN(PADEV) ; Manually unload one drug at a time from PADE INVENTORY SYSTEM (#58.601) file for device PADEV pointer to DISPENSING DEVICE (#58.63) file
"RTN","PSJPAD70",178,0)
 ; Input : PADEV - Pointer to PADE DISPENSING DEVICE (#58.63) file
"RTN","PSJPAD70",179,0)
 ;
"RTN","PSJPAD70",180,0)
 N DIR,X,Y
"RTN","PSJPAD70",181,0)
 S DIR(0)="Y",DIR("A")="DELETE SINGLE DRUG FROM PADE CABINET"
"RTN","PSJPAD70",182,0)
 S DIR("?")="^D UNLHLP^PSJPAD70"
"RTN","PSJPAD70",183,0)
 S DIR("B")="N" D ^DIR
"RTN","PSJPAD70",184,0)
 Q:'Y
"RTN","PSJPAD70",185,0)
 ; User wants to go through with removing drug from device
"RTN","PSJPAD70",186,0)
 N PSJSTOP S PSJSTOP=0
"RTN","PSJPAD70",187,0)
 F  Q:$G(PSJSTOP)  D UNLDONE(PADEV)
"RTN","PSJPAD70",188,0)
 Q
"RTN","PSJPAD70",189,0)
 ;
"RTN","PSJPAD70",190,0)
UNLDONE(PADEV) ; Manually unload a drug from a pocket
"RTN","PSJPAD70",191,0)
 ; Input :  PADIEN = PADE Dispensing Device IEN (required)
"RTN","PSJPAD70",192,0)
 ;
"RTN","PSJPAD70",193,0)
 N PSJINP,PSDRG,PSJCSUB,SCHLST,PADIEN,DRWIEN,DRGIEN,DRGDEV,PCKIEN,DRWPCK,DRGDEV,PSJDRC,DRUG
"RTN","PSJPAD70",194,0)
 S PSJSTOP=0,DRWPCK="",DRWIEN="",DRGIEN="",PCKIEN=""
"RTN","PSJPAD70",195,0)
 Q:'$G(PADEV)  ; Quit if device IEN not passed in
"RTN","PSJPAD70",196,0)
 S PSJPSYS=$P($G(^PS(58.63,+PADEV,0)),"^",2)
"RTN","PSJPAD70",197,0)
 Q:'$G(PSJPSYS)  ; Quit if device not in inventory file 
"RTN","PSJPAD70",198,0)
 ; Get internal pointer to device from inventory file
"RTN","PSJPAD70",199,0)
 S PADIEN=$O(^PS(58.601,+PSJPSYS,"DEVICE","B",+PADEV,""))
"RTN","PSJPAD70",200,0)
 S PSJINP("PADEV",PADEV)="",PSJINP("PADEV")=PADEV
"RTN","PSJPAD70",201,0)
 S PSJINP("PSJPSYS")=PSJPSYS
"RTN","PSJPAD70",202,0)
 ; Find drugs stocked in device, all CS schedules
"RTN","PSJPAD70",203,0)
 S SCHLST="1:Schedule I;2:Schedule II;2n:Schedule II Non-Narcotics;3:Schedule III;3n:Schedule III Non-Narcotics;4:Schedule IV;5:Schedule V"
"RTN","PSJPAD70",204,0)
 S PSJCSUB="ALL" D ALLSCHED^PSJPDRIP(.PSJCSUB,SCHLST) S PSJCSUB="ALL" M PSJINP("PSJCSUB")=PSJCSUB
"RTN","PSJPAD70",205,0)
 S PSJINP("PSJCSUB",0)="Unscheduled"
"RTN","PSJPAD70",206,0)
 S PSJINP("MANUNLOD")=1
"RTN","PSJPAD70",207,0)
 D DRCAB^PSJPDRIN(.PSJINP,.PSJDRC)
"RTN","PSJPAD70",208,0)
 ; Prompt user to select drug
"RTN","PSJPAD70",209,0)
 D DRUGSEL^PSJPDRTR(.PSJINP,.PSJDRC,.DRUG,.DRWPCK,.PSJSTOP) ; Prompt for drug items
"RTN","PSJPAD70",210,0)
 I $G(DRWPCK)="" S PSJSTOP=1
"RTN","PSJPAD70",211,0)
 Q:$G(PSJSTOP)  ; nothing selected
"RTN","PSJPAD70",212,0)
 ; If ALL drugs selected, reset device and quit
"RTN","PSJPAD70",213,0)
 I DRWPCK="ALL" S PSJINP("PSDRG")="ALL" D ASKRESET^PSJPADPT(PADEV) Q
"RTN","PSJPAD70",214,0)
 N PCKSTR,SELCNT,PCKCNT,PSJSELY,PCKSEL,DIR
"RTN","PSJPAD70",215,0)
 S PCKSTR="",PCKCNT=0
"RTN","PSJPAD70",216,0)
 ; If specific drugs selected, find pockets containing drug, display for selection
"RTN","PSJPAD70",217,0)
 I DRWPCK'="ALL" S PSJINP("PSDRG")=DRWPCK D
"RTN","PSJPAD70",218,0)
 .N POCKET
"RTN","PSJPAD70",219,0)
 .S DRWIEN=0 F  S DRWIEN=$O(DRWPCK(DRWPCK,DRWIEN)) Q:'DRWIEN  D
"RTN","PSJPAD70",220,0)
 ..S POCKET=0 F  S POCKET=$O(DRWPCK(DRWPCK,DRWIEN,POCKET)) Q:'POCKET  D
"RTN","PSJPAD70",221,0)
 ...N PCKNAME,DRGDRW,SUBID
"RTN","PSJPAD70",222,0)
 ...S PCKNAME=$P($G(DRWPCK(DRWPCK,DRWIEN,POCKET)),"^")
"RTN","PSJPAD70",223,0)
 ...S DRGDRW=$P($G(DRWPCK(DRWPCK,DRWIEN,POCKET)),"^",2)
"RTN","PSJPAD70",224,0)
 ...S SUBID=$P($P($G(DRWPCK(DRWPCK,DRWIEN,POCKET)),"^",4),"~~") S:SUBID="" SUBID="-"
"RTN","PSJPAD70",225,0)
 ...S PCKSEL=PCKCNT+1_":"_PCKNAME
"RTN","PSJPAD70",226,0)
 ...S PCKSEL(PCKCNT+1)=DRWPCK_"^"_DRWIEN_"^"_POCKET_"^"_PCKNAME_"^"_DRGDRW_$S($L(SUBID):"^"_SUBID,1:"")
"RTN","PSJPAD70",227,0)
 ...I PCKCNT=0 S PCKSTR=PCKSEL,PCKCNT=PCKCNT+1 Q
"RTN","PSJPAD70",228,0)
 ...S PCKSTR=$G(PCKSTR)_";"_PCKSEL
"RTN","PSJPAD70",229,0)
 ...S PCKCNT=PCKCNT+1
"RTN","PSJPAD70",230,0)
 .Q:'PCKCNT
"RTN","PSJPAD70",231,0)
 .S DIR(0)="SA^"_PCKSTR,DIR("A")="Select Pocket: "
"RTN","PSJPAD70",232,0)
 .F SELCNT=1:1:$L(PCKSTR,";") Q:$P(PCKSTR,";",SELCNT)=""  D
"RTN","PSJPAD70",233,0)
 ..N SUBID S SUBID=$P($G(PCKSEL(SELCNT)),"^",6)
"RTN","PSJPAD70",234,0)
 ..S DIR("A",SELCNT)="   "_$P($P(PCKSTR,";",SELCNT),":")_"   - Drawer "_$P($P($P(PCKSTR,";",SELCNT),":",2),"_")_"  Pocket "_$P($P($P(PCKSTR,";",SELCNT),":",2),"_",2)_$S($L(SUBID):"  Subdrawer: "_SUBID,1:"")
"RTN","PSJPAD70",235,0)
 .D ^DIR I Y'>0 S PSJSTOP=1 Q
"RTN","PSJPAD70",236,0)
 .S PSJSELY=$G(PCKSEL(+Y))
"RTN","PSJPAD70",237,0)
 ; Get sub-file pointers to drawer and pocket selected by user
"RTN","PSJPAD70",238,0)
 Q:$G(PSJSTOP)
"RTN","PSJPAD70",239,0)
 S DRWIEN=$P($G(PSJSELY),"^",2)
"RTN","PSJPAD70",240,0)
 S PCKIEN=$P($G(PSJSELY),"^",3)
"RTN","PSJPAD70",241,0)
 S DRGDRW=$P($G(PSJSELY),"^",5)
"RTN","PSJPAD70",242,0)
 S DRGDEV=$G(DRWPCK(DRWPCK,"DRGDEV"))
"RTN","PSJPAD70",243,0)
 ; If the drug is not stocked in more than one pocket, set the device balance to zero so the UNLOAD removes it completely from device
"RTN","PSJPAD70",244,0)
 I '(PCKCNT>1) D
"RTN","PSJPAD70",245,0)
 .S DEVBAL=$P($G(^PS(58.601,+$G(PSJPSYS),"DEVICE",+$G(PADIEN),"DRUG",+$G(DRGDEV),0)),"^",3)
"RTN","PSJPAD70",246,0)
 .I DEVBAL S $P(^PS(58.601,+$G(PSJPSYS),"DEVICE",+$G(PADIEN),"DRUG",+$G(DRGDEV),0),"^",3)=0
"RTN","PSJPAD70",247,0)
 D UNLOAD(PSJPSYS,PADIEN,DRWIEN,DRGDRW,DRGDEV,PCKIEN)
"RTN","PSJPAD70",248,0)
 W "    ...Done."
"RTN","PSJPAD70",249,0)
 N DIR,X,Y S DIR(0)="Y"
"RTN","PSJPAD70",250,0)
 S DIR("A")="Delete another drug"
"RTN","PSJPAD70",251,0)
 D ^DIR
"RTN","PSJPAD70",252,0)
 I '$G(Y) S PSJSTOP=1
"RTN","PSJPAD70",253,0)
 Q
"RTN","PSJPAD70",254,0)
 ;
"RTN","PSJPAD70",255,0)
UNLHLP  ; Display help text explaining PADE manual unload
"RTN","PSJPAD70",256,0)
 N HELPAR
"RTN","PSJPAD70",257,0)
 S HELPAR(1)="This action removes one drug item from a specific pocket from this"
"RTN","PSJPAD70",258,0)
 S HELPAR(2)="PADE dispensing device in VistA. Manually deleting a drug item does"
"RTN","PSJPAD70",259,0)
 S HELPAR(3)="not affect the PADE vendor, and does not trigger any HL7 messages to"
"RTN","PSJPAD70",260,0)
 S HELPAR(4)="the PADE vendor system. Manually deleting a drug item reduces the"
"RTN","PSJPAD70",261,0)
 S HELPAR(5)="quantity of the drug that displays as available in VistA when running"
"RTN","PSJPAD70",262,0)
 S HELPAR(6)="the PADE INVENTORY REPORT, and also removes the drug from balances"
"RTN","PSJPAD70",263,0)
 S HELPAR(7)="displayed in Inpatient Order Entry."
"RTN","PSJPAD70",264,0)
 S HELPAR(8)="After a drug is deleted, the drug may be added back to the cabinet's"
"RTN","PSJPAD70",265,0)
 S HELPAR(9)="inventory as new HL7 messages are received from the vendor."
"RTN","PSJPAD70",266,0)
 D EN^DDIOL(.HELPAR)
"RTN","PSJPAD70",267,0)
 Q
"RTN","PSJPAD70",268,0)
 ;
"RTN","PSJPAD70",269,0)
OLDPKUP(TMPADATA,ERRMSG,PS586IEN)  ; Return 1 if data in TMPADATA indicates this pocket was updated more recently than the current transaction's date/time
"RTN","PSJPAD70",270,0)
 N POCKSUB  ;   POCKET_SUBDRAWER concatenated
"RTN","PSJPAD70",271,0)
 N PSPRVDT  ;   The last transaction date/time (date/time of the activity at the cabinet) this pocket was updated
"RTN","PSJPAD70",272,0)
 N PSPRVDIE  ;  The IEN of the last transaction date/time in the "PKUPDT" multiple
"RTN","PSJPAD70",273,0)
 N FDA,PSJPSYS,PSJSCR,PSJSCR
"RTN","PSJPAD70",274,0)
 ;
"RTN","PSJPAD70",275,0)
 S TMPADATA("SYS IEN")=$$FIND1^DIC(58.601,"","MX",$G(TMPADATA(1)),,,"ERR")
"RTN","PSJPAD70",276,0)
 I '$G(TMPADATA("SYS IEN")) Q 0
"RTN","PSJPAD70",277,0)
 ; 
"RTN","PSJPAD70",278,0)
 I '($G(TMPADATA(2))]"") Q 0
"RTN","PSJPAD70",279,0)
 I $G(PSJPSYS),$G(^PS(58.601,+PSJPSYS,0))]"" S TMPADATA("SYS IEN")=PSJPSYS
"RTN","PSJPAD70",280,0)
 S PSJPSYS=TMPADATA("SYS IEN"),PSJSCR="I $S('$G(PSJPSYS):1,1:PSJPSYS=$P(^(0),U,2))"
"RTN","PSJPAD70",281,0)
 I ($G(TMPADATA(1))=""&$G(PSJPSYS)) S TMPADATA(1)=$P(^PS(58.601,PSJPSYS,0),"^")
"RTN","PSJPAD70",282,0)
 S TMPADATA("DEVICE IEN")=$$FIND1^DIC(58.63,,"MX",TMPADATA(2),,PSJSCR,"ERR")
"RTN","PSJPAD70",283,0)
 Q:'$G(TMPADATA("DEVICE IEN")) 0
"RTN","PSJPAD70",284,0)
 S TMPADATA("DEVICE IEN")=$O(^PS(58.601,+$G(TMPADATA("SYS IEN")),"DEVICE","B",TMPADATA("DEVICE IEN"),0))
"RTN","PSJPAD70",285,0)
 Q:'$G(TMPADATA("DEVICE IEN")) 0
"RTN","PSJPAD70",286,0)
 ;
"RTN","PSJPAD70",287,0)
 I $G(TMPADATA(3))="" S TMPADATA(3)="zz"
"RTN","PSJPAD70",288,0)
 S TMPADATA("DRAWER IEN")=$O(^PS(58.601,+$G(TMPADATA("SYS IEN")),"DEVICE",+$G(TMPADATA("DEVICE IEN")),"DRAWER","B",$G(TMPADATA(3)),0))
"RTN","PSJPAD70",289,0)
 I '$G(TMPADATA("DRAWER IEN")) Q 0
"RTN","PSJPAD70",290,0)
 ;
"RTN","PSJPAD70",291,0)
 N DRUG,DEVIEN,SYSIEN
"RTN","PSJPAD70",292,0)
 S DRUG=$G(TMPADATA(4))                          ; Drug
"RTN","PSJPAD70",293,0)
 S DEVIEN=$G(TMPADATA("DEVICE IEN"))             ; Dispensing Device IEN
"RTN","PSJPAD70",294,0)
 S SYSIEN=$G(TMPADATA("SYS IEN"))                ; PADE System IEN
"RTN","PSJPAD70",295,0)
 I '(DRUG]"") Q 0                                ; No drug, no go
"RTN","PSJPAD70",296,0)
 I '$D(^PSDRUG(DRUG,0)) Q 0                      ; No valid drug
"RTN","PSJPAD70",297,0)
 ; Must have PADE system and Dispensing Device
"RTN","PSJPAD70",298,0)
 I '$G(DEVIEN) Q 0
"RTN","PSJPAD70",299,0)
 I '$G(SYSIEN) Q 0
"RTN","PSJPAD70",300,0)
 ;
"RTN","PSJPAD70",301,0)
 N DA,FDA,X,Y,DIC,DIE,DR,D0,ERR,D,DD,DICR,DICRS,DO
"RTN","PSJPAD70",302,0)
 S TMPADATA("DRUG DEV IEN")=$$FIND1^DIC(58.60111,","_DEVIEN_","_SYSIEN_",","MXQ",DRUG,,,"ERR")
"RTN","PSJPAD70",303,0)
 ;
"RTN","PSJPAD70",304,0)
 S TMPADATA(10)=$TR(TMPADATA(10),"~~")_"~~"_+$G(TMPADATA(4))   ; Append subdrawer unique drug IEN suffix to handle different drugs in same subdr-pocket combo
"RTN","PSJPAD70",305,0)
 S:$G(TMPADATA(10))="" TMPADATA(10)=$P($G(^PS(58.6,+$G(PS586IEN),0)),"^",12) S:TMPADATA(10)="" TMPADATA(10)="~~"_+$G(TMPADATA(4))
"RTN","PSJPAD70",306,0)
 S POCKSUB=$G(TMPADATA(7))_"_"_$G(TMPADATA(10))  ;  "POCKET_SUBDRAWER" storage location
"RTN","PSJPAD70",307,0)
 S TMPADATA("POCK/SUB IEN")=$$FIND1^DIC(58.601122,","_TMPADATA("DRAWER IEN")_","_TMPADATA("DEVICE IEN")_","_TMPADATA("SYS IEN")_",","MX",POCKSUB,,,"ERR")
"RTN","PSJPAD70",308,0)
 ; Get the last date/time this drawer/subdrawer~drug/pocket was updated
"RTN","PSJPAD70",309,0)
 S PSPRVDIE=$O(^PS(58.601,+$G(TMPADATA("SYS IEN")),"DEVICE",+$G(TMPADATA("DEVICE IEN")),"DRAWER",+$G(TMPADATA("DRAWER IEN")),"PKUPDT","B",POCKSUB,""))
"RTN","PSJPAD70",310,0)
 ;
"RTN","PSJPAD70",311,0)
 S PSPRVDT=$P($G(^PS(58.601,+$G(TMPADATA("SYS IEN")),"DEVICE",+$G(TMPADATA("DEVICE IEN")),"DRAWER",+$G(TMPADATA("DRAWER IEN")),"PKUPDT",+$G(PSPRVDIE),0)),"^",2)
"RTN","PSJPAD70",312,0)
 ; If this current update contains a transaction date/time (i.e., activity date/time) older than the last update, don't update inventory
"RTN","PSJPAD70",313,0)
 I $G(PSPRVDT)&$G(TMPADATA(9)) I TMPADATA(9)<PSPRVDT D  Q 1
"RTN","PSJPAD70",314,0)
 .S ERRMSG="- OUTDATED TRANSACTION - "_$G(TMPADATA(1))_"."_$G(TMPADATA(2))_".DRUG="_$P($G(^PSDRUG(+$G(TMPADATA(4)),0)),"^")_"("_$G(TMPADATA(4))_").POCKET="_$G(TMPADATA(7))
"RTN","PSJPAD70",315,0)
 .S ERRMSG=ERRMSG_".LAST UPDATED="_PSPRVDT_".TRANS DT="_TMPADATA(9)
"RTN","PSJPAD70",316,0)
 Q 0
"RTN","PSJPAD7I")
0^6^B91877682^n/a
"RTN","PSJPAD7I",1,0)
PSJPAD7I ;BIR/JCH-HL7 RECEIVER FOR OMH PADE POCKET ACTIVITY ;9/3/15 1:34  PM
"RTN","PSJPAD7I",2,0)
 ;;5.0;INPATIENT MEDICATIONS ;**317**;16 DEC 97;Build 130
"RTN","PSJPAD7I",3,0)
 ;
"RTN","PSJPAD7I",4,0)
 ; Reference to $$HLDATE^HLFNC is supported by DBIA 10106
"RTN","PSJPAD7I",5,0)
 ; Reference to ^XMD is supported by DBIA 10070
"RTN","PSJPAD7I",6,0)
 ; Reference to ^XLFDT is supported by DBIA# 10103.
"RTN","PSJPAD7I",7,0)
 ;
"RTN","PSJPAD7I",8,0)
 Q
"RTN","PSJPAD7I",9,0)
 ;
"RTN","PSJPAD7I",10,0)
OMS(PSJMSH,PSJSEG) ;Process OMS^O05 messages from the PSJ PADE OMS_O05 SUB subscriber protocol
"RTN","PSJPAD7I",11,0)
 ;
"RTN","PSJPAD7I",12,0)
 ; This routine and subroutines assume that all VistA HL7 environment
"RTN","PSJPAD7I",13,0)
 ; variables are properly initialized.
"RTN","PSJPAD7I",14,0)
 ;
"RTN","PSJPAD7I",15,0)
 ; The message will be checked to see if it is valid;
"RTN","PSJPAD7I",16,0)
 ;
"RTN","PSJPAD7I",17,0)
 ;  Input:   HL7 environment variables
"RTN","PSJPAD7I",18,0)
 ; Output:   Processed message or negative acknowledgement
"RTN","PSJPAD7I",19,0)
 ;
"RTN","PSJPAD7I",20,0)
 N PSJERR,PSJHL,PSJOMS,PSJDT
"RTN","PSJPAD7I",21,0)
 S PSJERR="",PSJDT=$$NOW^XLFDT
"RTN","PSJPAD7I",22,0)
 ;
"RTN","PSJPAD7I",23,0)
 D LOADMSG^PSJPAD7U(.PSJOMS,PSJMSH,.PSJERR)   ;Load inbound HL7 message
"RTN","PSJPAD7I",24,0)
 ;
"RTN","PSJPAD7I",25,0)
 Q:'$$VALIDMSG(.PSJOMS,.PSJHL,.PSJERR)
"RTN","PSJPAD7I",26,0)
 ;
"RTN","PSJPAD7I",27,0)
 D FILETRAN(.PSJOMS)
"RTN","PSJPAD7I",28,0)
 Q
"RTN","PSJPAD7I",29,0)
 ;
"RTN","PSJPAD7I",30,0)
VALIDMSG(PSJOMS,XMT,PSJERR)   ;Validate message
"RTN","PSJPAD7I",31,0)
 ;
"RTN","PSJPAD7I",32,0)
 ;  Messages handled: OMS^O05
"RTN","PSJPAD7I",33,0)
 ;
"RTN","PSJPAD7I",34,0)
 ;  OMS messages must contain RQD,ORC,and ZPM segments                                    
"RTN","PSJPAD7I",35,0)
 ;  NTE comments segment will be processed if received
"RTN","PSJPAD7I",36,0)
 ;  PID and PV1 segments are conditional: Transaction Type of V or R in ZPM.1
"RTN","PSJPAD7I",37,0)
 ;  Any additional segments are ignored
"RTN","PSJPAD7I",38,0)
 ;
"RTN","PSJPAD7I",39,0)
 ;  Input:
"RTN","PSJPAD7I",40,0)
 ;    MSGROOT - Root of array holding message
"RTN","PSJPAD7I",41,0)
 ;        XMT - Transmission parameters
"RTN","PSJPAD7I",42,0)
 ;
"RTN","PSJPAD7I",43,0)
 ; Output:
"RTN","PSJPAD7I",44,0)
 ;        XMT - Transmission parameters
"RTN","PSJPAD7I",45,0)
 ;        ERR - segment^sequence^field^code^ACK type^error text
"RTN","PSJPAD7I",46,0)
 ;
"RTN","PSJPAD7I",47,0)
 N MSH,PID,PV1,RQD,ORC,ZPM,NTE,PSJERR,PSJMUMPS,PSJIEN,DIC,DR,PSJHLIDS,I,PSJERR2,PSJERR3
"RTN","PSJPAD7I",48,0)
 S PSJERR="",PSJERR2="",PSJERR3=""
"RTN","PSJPAD7I",49,0)
 ;
"RTN","PSJPAD7I",50,0)
 ; Validate message is a well-formed OMS^O05 message type
"RTN","PSJPAD7I",51,0)
 ;-----------------------------------------------------------
"RTN","PSJPAD7I",52,0)
 ; All messages must have MSH, followed by ZPM
"RTN","PSJPAD7I",53,0)
 ; PID, RQD, ORC, and PV1 are conditional: Transaction Type = V or R ; ZPM.1
"RTN","PSJPAD7I",54,0)
 ; NTE segment is optional.  
"RTN","PSJPAD7I",55,0)
 ; All other segments are ignored.
"RTN","PSJPAD7I",56,0)
 ; Start with CONFIG errors
"RTN","PSJPAD7I",57,0)
 I '$D(PSJOMS("RQD")) D  I $G(PSJERR)]"" Q 0
"RTN","PSJPAD7I",58,0)
 .I $$PATRANS(.PSJOMS)  S PSJERR="Missing RQD segment. " D ERROR^PSJPAD7U(PSJERR,1)
"RTN","PSJPAD7I",59,0)
 I '$D(PSJOMS("ORC")) D  I $G(PSJERR)]"" Q 0
"RTN","PSJPAD7I",60,0)
 .I $$PATRANS(.PSJOMS)  S PSJERR="Missing ORC segment. " D ERROR^PSJPAD7U(PSJERR,1)
"RTN","PSJPAD7I",61,0)
 I '$D(PSJOMS("ZPM")) S PSJERR="Missing ZPM segment. " D ERROR^PSJPAD7U(PSJERR,1) Q 0
"RTN","PSJPAD7I",62,0)
 I $$PATRANS(.PSJOMS) F I="PID","PV1" Q:PSJERR'=""  D
"RTN","PSJPAD7I",63,0)
 .I '$D(PSJOMS(I)) S PSJERR=I_" - Missing segment" D ERROR^PSJPAD7U(PSJERR,1)
"RTN","PSJPAD7I",64,0)
 ;
"RTN","PSJPAD7I",65,0)
 ; Validate required fields
"RTN","PSJPAD7I",66,0)
 ;------------------------------------------------------
"RTN","PSJPAD7I",67,0)
 ; Check for missing/invalid required DATA fields
"RTN","PSJPAD7I",68,0)
 ; Missing PADE system is CONFIG issue
"RTN","PSJPAD7I",69,0)
 S PSJMUMPS="'$$FINDIENS^PSJPAD7U(58.601,PSJOMS(""DISPSYS""))"
"RTN","PSJPAD7I",70,0)
 S PSJERR=$$CHKFLD^PSJPAD7U(PSJOMS("DISPSYS"),,,PSJMUMPS,"PADE SYSTEM -ZPM.2") I $G(PSJERR)]"" D ERROR^PSJPAD7U(PSJERR,1)
"RTN","PSJPAD7I",71,0)
 ; End of CONFIG errors, begin DATA errors
"RTN","PSJPAD7I",72,0)
 S PSJERR=$$CHKFLD^PSJPAD7U(PSJOMS("STYP"),,,"","TRANS CODE -ZPM.1") I $G(PSJERR)]"" D ERROR^PSJPAD7U(PSJERR,1)
"RTN","PSJPAD7I",73,0)
 I $G(PSJOMS("DFN")) S PSJMUMPS="$G(PSJOMS(""DFN""))&$G(PSJOMS(""SSN""))&($P($G(^DPT(+$G(PSJOMS(""DFN"")),0)),""^"",9)'=$G(PSJOMS(""SSN"")))" D
"RTN","PSJPAD7I",74,0)
 .S PSJERR=$$CHKFLD^PSJPAD7U(PSJOMS("DFN"),,,PSJMUMPS,"MISMATCHED PATIENT SSN -PID.3") I $G(PSJERR)]"" D ERROR^PSJPAD7U(PSJERR)
"RTN","PSJPAD7I",75,0)
 S PSJMUMPS="$G(PSJOMS(""TTYPE""))=""V""&($G(PSJOMS(""TRNSAMT"")))&($G(PSJOMS(""VAORD""))="""")"
"RTN","PSJPAD7I",76,0)
 S PSJERR=$$CHKFLD^PSJPAD7U(PSJOMS("TTYPE"),,,PSJMUMPS,"TRANSACTION TYPE -ZPM.1") I $G(PSJERR)]"" D DWO(.PSJOMS)
"RTN","PSJPAD7I",77,0)
 S PSJERR=$$CHKFLD^PSJPAD7U(PSJOMS("NUR1A"),,,"","USER ID -ZPM.11.1") I $G(PSJERR)]"" D ERROR^PSJPAD7U(PSJERR)
"RTN","PSJPAD7I",78,0)
 S PSJERR2=$$CHKFLD^PSJPAD7U(PSJOMS("NUR1B"),,,"","USER ID -ZPM.11.2")
"RTN","PSJPAD7I",79,0)
 S PSJERR3=$$CHKFLD^PSJPAD7U(PSJOMS("NUR1C"),,,"","USER ID -ZPM.11.3")
"RTN","PSJPAD7I",80,0)
 I $G(PSJERR2)]""&($G(PSJERR3)]"") S PSJERR=PSJERR2_" "_PSJERR3 D ERROR^PSJPAD7U(PSJERR)
"RTN","PSJPAD7I",81,0)
 S PSJMUMPS="'$G(PSJOMS(""PSJDT""))?12N.14N&($$HL7TFM^XLFDT($G(PSJOMS(""PSJDT"")))'?7N1"".""1.N)"
"RTN","PSJPAD7I",82,0)
 S PSJERR=$$CHKFLD^PSJPAD7U(PSJOMS("PSJDT"),,,PSJMUMPS,"DATE/TIME -ZPM.19") I $G(PSJERR)]"" D ERROR^PSJPAD7U(PSJERR)
"RTN","PSJPAD7I",83,0)
 ; Check "SEND 'PATIENT NOT ON FILE' MSG" parameter
"RTN","PSJPAD7I",84,0)
 I $$NOPTMSG(.PSJOMS) D
"RTN","PSJPAD7I",85,0)
 .S PSJMUMPS="("",W,V,R,""[("",""_$G(PSJOMS(""TTYPE""))_"",""))&'$G(PSJOMS(""DFN""))"
"RTN","PSJPAD7I",86,0)
 .S PSJERR=$$CHKFLD^PSJPAD7U(+$G(PSJOMS("DFN")),,,PSJMUMPS,"PATIENT NOT ON FILE -PID.3/PID.19")
"RTN","PSJPAD7I",87,0)
 .Q:$G(PSJERR)=""
"RTN","PSJPAD7I",88,0)
 .I PSJERR[">0<" S PSJERR=$P(PSJERR,">0<") D
"RTN","PSJPAD7I",89,0)
 ..S PSJERR=PSJERR_">"_$S($L($G(PSJOMS("SSN"))):$G(PSJOMS("SSN")),$L($G(PSJOMS("PTID"))):$G(PSJOMS("PTID")),1:"")_"<"
"RTN","PSJPAD7I",90,0)
 .D ERROR^PSJPAD7U(PSJERR)
"RTN","PSJPAD7I",91,0)
 ;
"RTN","PSJPAD7I",92,0)
 Q 1
"RTN","PSJPAD7I",93,0)
 ;
"RTN","PSJPAD7I",94,0)
FILETRAN(PSJOMS) ; File into PADE INBOUND TRANSACTION file
"RTN","PSJPAD7I",95,0)
 ; Input - PSJOMS() - All input into PADE INBOUND TRANSACTIONS (#58.6) fields
"RTN","PSJPAD7I",96,0)
 N FDA,PSJDIERR,PSJMSG,PARRAY,TSIGN,PSJ7DT,PSJNOW,PCKBAL
"RTN","PSJPAD7I",97,0)
 S PSJNOW=$$NOW^XLFDT
"RTN","PSJPAD7I",98,0)
 ; Transaction Date/Time
"RTN","PSJPAD7I",99,0)
 S PSJ7DT=$$HL7TFM^XLFDT($E($G(PSJOMS("PSJDT")),1,14))
"RTN","PSJPAD7I",100,0)
 I '$G(PSJ7DT)!($L(PSJ7DT)<7) S PSJ7DT=PSJNOW
"RTN","PSJPAD7I",101,0)
 I PSJ7DT>PSJNOW S PSJ7DT=PSJNOW
"RTN","PSJPAD7I",102,0)
 S FDA(58.6,"+1,",.01)=PSJ7DT
"RTN","PSJPAD7I",103,0)
 ; Dispensing System (console for Integrated Facility)
"RTN","PSJPAD7I",104,0)
 S FDA(58.6,"+1,",1.1)=PSJOMS("DISPSYS")                              ; Dispensing System
"RTN","PSJPAD7I",105,0)
 S FDA(58.6,"+1,",1.2)=$S(PSJOMS("DRWR")]"":PSJOMS("DRWR"),1:"~~")    ; PADE Drawer
"RTN","PSJPAD7I",106,0)
 S FDA(58.6,"+1,",1)=PSJOMS("CABID")                                  ; Cabinet ID / Dispensing Device
"RTN","PSJPAD7I",107,0)
 I $L($G(PSJOMS("DRGITM"))) D                                         ; Drug ID
"RTN","PSJPAD7I",108,0)
 .I $D(^PSDRUG(PSJOMS("DRGITM"),2)) S FDA(58.6,"+1,",2)=PSJOMS("DRGITM") Q
"RTN","PSJPAD7I",109,0)
 .I '$D(^PSDRUG(PSJOMS("DRGITM"),2)) D
"RTN","PSJPAD7I",110,0)
 ..S FDA(58.6,"+1,",18)=PSJOMS("DRGTXT")
"RTN","PSJPAD7I",111,0)
 ..S FDA(58.6,"+1,",19)=PSJOMS("DRGITM")
"RTN","PSJPAD7I",112,0)
 ..S PSJOMS("DRGETXT")=PSJOMS("DRGTXT")
"RTN","PSJPAD7I",113,0)
 ..S PSJOMS("DRGEID")=PSJOMS("DRGITM")
"RTN","PSJPAD7I",114,0)
 S FDA(58.6,"+1,",3)=PSJOMS("TRNSAMT")                                ; Transaction Amount (Quantity)
"RTN","PSJPAD7I",115,0)
 S FDA(58.6,"+1,",4)=PSJOMS("TTYPE")                                  ; Transaction Type
"RTN","PSJPAD7I",116,0)
 S:$L($G(PSJOMS("NUR1A"))) FDA(58.6,"+1,",5)=$G(PSJOMS("DRGUNIT"))    ; Drug Unit
"RTN","PSJPAD7I",117,0)
 S:$L($G(PSJOMS("NUR1A"))) FDA(58.6,"+1,",6.1)=PSJOMS("NUR1A")        ; PADE User
"RTN","PSJPAD7I",118,0)
 S:$L($G(PSJOMS("NUR1B"))) FDA(58.6,"+1,",6.2)=PSJOMS("NUR1B")_","_$G(PSJOMS("NUR1C"))    ; PADE Witness
"RTN","PSJPAD7I",119,0)
 S:$L($G(PSJOMS("NUR2A"))) FDA(58.6,"+1,",7.1)=PSJOMS("NUR2A")
"RTN","PSJPAD7I",120,0)
 S:$L($G(PSJOMS("NUR2B"))) FDA(58.6,"+1,",7.2)=PSJOMS("NUR2B")_","_$G(PSJOMS("NUR2C"))
"RTN","PSJPAD7I",121,0)
 ; If User ID is pointer to NEW PERSON file (#200), update USER field (#6)
"RTN","PSJPAD7I",122,0)
 I $G(PSJOMS("NUR1")) S FDA(58.6,"+1,",6)=PSJOMS("NUR1")
"RTN","PSJPAD7I",123,0)
 ; If Witness ID is pointer to NEW PERSON file (#200), update WITNESS field (#7)
"RTN","PSJPAD7I",124,0)
 I $G(PSJOMS("NUR2")) S FDA(58.6,"+1,",7)=PSJOMS("NUR2")
"RTN","PSJPAD7I",125,0)
 S FDA(58.6,"+1,",10)=$S(PSJOMS("PKT")]"":PSJOMS("PKT"),1:"~~")      ; PADE Pocket
"RTN","PSJPAD7I",126,0)
 S FDA(58.6,"+1,",11)=PSJOMS("SBDRWR")                               ; PADE Subdrawer
"RTN","PSJPAD7I",127,0)
 S FDA(58.6,"+1,",12)=PSJOMS("EXBCNT")                               ; Expected Begin Count
"RTN","PSJPAD7I",128,0)
 S FDA(58.6,"+1,",13)=PSJOMS("ACBCNT")                               ; Actual Begin Count
"RTN","PSJPAD7I",129,0)
 ; Patient Data
"RTN","PSJPAD7I",130,0)
 N POCKET,PTRNSTYP S POCKET=$G(PSJOMS("PKT"))
"RTN","PSJPAD7I",131,0)
 ;I (PSJOMS("TTYPE")="V"!(PSJOMS("TTYPE")="R")!($E(PSJOMS("TTYPE"))="W")!($E(PSJOMS("TTYPE"))="N")!($E(PSJOMS("TTYPE")="A"))!($E(POCKET,$L(POCKET)-2,$L(POCKET))="PSB"))
"RTN","PSJPAD7I",132,0)
 S PTRNSTYP=$$PTRNSTYP(PSJOMS("TTYPE"),$G(POCKET))
"RTN","PSJPAD7I",133,0)
 I PTRNSTYP D SETPAT(.PSJOMS)
"RTN","PSJPAD7I",134,0)
 I (PSJOMS("TTYPE")="L")!(PSJOMS("TTYPE")="U")!(PSJOMS("TTYPE")="C") D
"RTN","PSJPAD7I",135,0)
 .N POCKBIN S POCKBIN=$G(PSJOMS("PKT"))
"RTN","PSJPAD7I",136,0)
 .I $E(POCKBIN,$L(POCKBIN)-2,$L(POCKBIN))="PSB"&($G(PSJOMS("COMMENT"))["PATIENT SPECIFIC BIN") D
"RTN","PSJPAD7I",137,0)
 ..D SETPAT(.PSJOMS)
"RTN","PSJPAD7I",138,0)
 S:$L($G(PSJOMS("VAORD"))) FDA(58.6,"+1,",15)=PSJOMS("VAORD")        ; Pharmacy Order
"RTN","PSJPAD7I",139,0)
 S PARRAY(5)=$G(PSJOMS("TTYPE")),PARRAY(6)=$G(PSJOMS("TRNSAMT"))
"RTN","PSJPAD7I",140,0)
 S TSIGN=$$TSIGN^PSJPADIT(.PARRAY)
"RTN","PSJPAD7I",141,0)
 S PSJOMS("TRNSAMT")=TSIGN_PSJOMS("PSDQ")
"RTN","PSJPAD7I",142,0)
 ; Pocket Balance Forward - If COUNT transaction, Actual Begin Count = Balance Forward (no change)
"RTN","PSJPAD7I",143,0)
 S PCKBAL=$S($E(PSJOMS("TTYPE"))="C":PSJOMS("ACBCNT"),$E(PSJOMS("TTYPE"))="A":PSJOMS("ACBCNT"),1:PSJOMS("EXBCNT")+PSJOMS("TRNSAMT"))
"RTN","PSJPAD7I",144,0)
 S PCKBAL=$S(PCKBAL<0:0,1:PCKBAL)
"RTN","PSJPAD7I",145,0)
 S FDA(58.6,"+1,",16)=PCKBAL
"RTN","PSJPAD7I",146,0)
 I $G(PSJOMS("TOTITMS"))]"" S FDA(58.6,"+1,",17)=PSJOMS("TOTITMS")   ; Total count of this drug in Cabinet
"RTN","PSJPAD7I",147,0)
 I ($G(PSJOMS("TOTITMS"))="") D
"RTN","PSJPAD7I",148,0)
 .S FDA(58.6,"+1,",17)=PSJOMS("ACBCNT")+PSJOMS("TRNSAMT")             ; Device balance not in ZPM.13, try to calculate
"RTN","PSJPAD7I",149,0)
 I $G(PSJOMS("TTYPE"))="B" K FDA(58.6,"+1,",17)
"RTN","PSJPAD7I",150,0)
 I '$L($G(FDA(58.6,"+1,",18))) S:$L($G(PSJOMS("DRGETXT"))) FDA(58.6,"+1,",18)=PSJOMS("DRGETXT") ; Drug Name
"RTN","PSJPAD7I",151,0)
 I '$L($G(FDA(58.6,"+1,",19))) S:$L($G(PSJOMS("DRGEID"))) FDA(58.6,"+1,",19)=PSJOMS("DRGEID")   ; Drug alternate ID
"RTN","PSJPAD7I",152,0)
 I $G(PSJOMS("LOTNUM"))?1.11ANP S FDA(58.6,"+1,",20)=PSJOMS("LOTNUM")  ; Drug Lot Number
"RTN","PSJPAD7I",153,0)
 S:$L($G(PSJOMS("COMMENT"))) FDA(58.6,"+1,",21)=PSJOMS("COMMENT")      ; Comment
"RTN","PSJPAD7I",154,0)
 I $G(PSJOMS("POREORD"))?1.4N S FDA(58.6,"+1,",23)=PSJOMS("POREORD")   ; Reorder level (PAR Qty)
"RTN","PSJPAD7I",155,0)
 I $G(PSJOMS("DRGEID"))?1.30ANP S FDA(58.6,"+1,",19)=PSJOMS("DRGEID")
"RTN","PSJPAD7I",156,0)
 I $G(PSJOMS("DRGETXT"))?1.40ANP S FDA(58.6,"+1,",18)=PSJOMS("DRGETXT")
"RTN","PSJPAD7I",157,0)
 ;
"RTN","PSJPAD7I",158,0)
 ; Set status to Pending
"RTN","PSJPAD7I",159,0)
 S FDA(58.6,"+1,",22)="P"
"RTN","PSJPAD7I",160,0)
 K PSJDIERR D UPDATE^DIE(,"FDA","","PSJDIERR")
"RTN","PSJPAD7I",161,0)
 S PSJDIERR=$G(PSJDIERR("DIERR")) I PSJDIERR D
"RTN","PSJPAD7I",162,0)
 .N PSJDIER2,PSJMSG S PSJDIER2=$P(PSJDIERR,"^",2)
"RTN","PSJPAD7I",163,0)
 .S PSJMSG=$G(PSJDIERR("DIERR",+PSJDIERR,"TEXT",$S(PSJDIER2:PSJDIER2,1:1)))
"RTN","PSJPAD7I",164,0)
 .S PSJMSG="FILEMAN ERROR: "_$G(PSJMSG)_"^"_" SYSTEM="_$G(PSJOMS("DISPSYS"))_" CABINET="_$G(PSJOMS("CABID"))
"RTN","PSJPAD7I",165,0)
 .D ERROR^PSJPAD7U(.PSJMSG)
"RTN","PSJPAD7I",166,0)
 Q
"RTN","PSJPAD7I",167,0)
 ;
"RTN","PSJPAD7I",168,0)
SETPAT(PSJOMS) ; Set patient data
"RTN","PSJPAD7I",169,0)
 N PSJMNAME ; Patient Missing from PATIENT (#2) file
"RTN","PSJPAD7I",170,0)
 S:$G(PSJOMS("DFN")) FDA(58.6,"+1,",14)=+$G(PSJOMS("DFN"))
"RTN","PSJPAD7I",171,0)
 S:$G(PSJOMS("PTNAMA"))]"" FDA(58.6,"+1,",14.1)=PSJOMS("PTNAMA")
"RTN","PSJPAD7I",172,0)
 S:$G(PSJOMS("PTNAMB"))]"" FDA(58.6,"+1,",14.2)=PSJOMS("PTNAMB")
"RTN","PSJPAD7I",173,0)
 S:$G(PSJOMS("PTID"))]"" FDA(58.6,"+1,",14.3)=PSJOMS("PTID")
"RTN","PSJPAD7I",174,0)
 S:$G(PSJOMS("VAORD"))]"" FDA(58.6,"+1,",15)=PSJOMS("VAORD")
"RTN","PSJPAD7I",175,0)
 S:$G(PSJOMS("MDFN"))]"" FDA(58.6,"+1,",24)=PSJOMS("MDFN")
"RTN","PSJPAD7I",176,0)
 I $G(PSJOMS("MPTNAMA"))]"" S FDA(58.6,"+1,",25)=PSJOMS("MPTNAMA")
"RTN","PSJPAD7I",177,0)
 I $G(PSJOMS("MPTNAMB"))]"" S FDA(58.6,"+1,",25)=$G(FDA(58.6,"+1,",25))_$S($G(FDA(58.6,"+1,",25))]"":",",1:"")_$G(PSJOMS("MPTNAMB"))
"RTN","PSJPAD7I",178,0)
 Q
"RTN","PSJPAD7I",179,0)
 ;
"RTN","PSJPAD7I",180,0)
DWO(PSJOMS) ; Send Dispensed Without Order (DWO) Alert
"RTN","PSJPAD7I",181,0)
 N GROUPS
"RTN","PSJPAD7I",182,0)
 S GROUPS=""
"RTN","PSJPAD7I",183,0)
 Q:'$$ACTDWO^PSJPAD70(.PSJOMS)
"RTN","PSJPAD7I",184,0)
 D GETGRPS^PSJPAD70(.PSJOMS,.GROUPS)
"RTN","PSJPAD7I",185,0)
 D DWOSEND^PSJPAD70(.PSJOMS,.GROUPS)
"RTN","PSJPAD7I",186,0)
 Q
"RTN","PSJPAD7I",187,0)
 ;
"RTN","PSJPAD7I",188,0)
NOPTMSG(PSJOMS)  ; Check "SEND 'NO PATIENT ON FILE' MSG' Parameter.
"RTN","PSJPAD7I",189,0)
 ; Input : PSJOMS("DISPSYS")        ; Dispensing System, ZPM-2, filed into Field #11 in PADE DISPENSING DEVICE (#58.63) file
"RTN","PSJPAD7I",190,0)
 ;         PSJOMS("PSJOMS("CABID")
"RTN","PSJPAD7I",191,0)
 N PADEVIEN,PSJPSYS,PSJERR2,PADPTMSG
"RTN","PSJPAD7I",192,0)
 S PADPTMSG=0
"RTN","PSJPAD7I",193,0)
 S PSJPSYS=$$FIND1^DIC(58.601,,"BX",$G(PSJOMS("DISPSYS")),,,"PSJERR2")
"RTN","PSJPAD7I",194,0)
 I '$G(PSJERR2("DIERR")) S PADEVIEN=$$FIND1^DIC(58.63,,"BX",$G(PSJOMS("CABID")),,,"PSJERR2")
"RTN","PSJPAD7I",195,0)
 I '$G(PSJERR2("DIERR")),$G(PADEVIEN) S PADPTMSG=+$G(^PS(58.63,+PADEVIEN,8))
"RTN","PSJPAD7I",196,0)
 Q $S($G(PADPTMSG):1,1:0)
"RTN","PSJPAD7I",197,0)
 ;
"RTN","PSJPAD7I",198,0)
GETDIV(PSJOMS) ; Get Division from DISPENSING CABINET file (#58.63)
"RTN","PSJPAD7I",199,0)
 N CABNAME,CABIEN,RESULT,PSJPSYS,PSJDIV
"RTN","PSJPAD7I",200,0)
 S CABNAME=$G(PSJOMS("CABID")) Q:(CABNAME="") ""
"RTN","PSJPAD7I",201,0)
 S PSJPSYS=$G(PSJOMS("DISPSYS")) Q:(PSJPSYS="") ""
"RTN","PSJPAD7I",202,0)
 S PSJPSYS=$$FIND1^DIC(58.601,"","",PSJPSYS) Q:'PSJPSYS ""
"RTN","PSJPAD7I",203,0)
 S CABIEN=$$FIND1^DIC(58.63,,,CABNAME,,,"RESULT") Q:'CABIEN ""
"RTN","PSJPAD7I",204,0)
 K RESULT
"RTN","PSJPAD7I",205,0)
 D GETS^DIQ(58.63,CABIEN,2,"I","RESULT")
"RTN","PSJPAD7I",206,0)
 S PSJDIV=$G(RESULT(58.63,CABIEN_",",2,"I"))
"RTN","PSJPAD7I",207,0)
 Q PSJDIV
"RTN","PSJPAD7I",208,0)
 ;
"RTN","PSJPAD7I",209,0)
PATRANS(PSJOMS) ; Return flag indicating whether or not transaction type REQUIRES PID and PV1 segments
"RTN","PSJPAD7I",210,0)
 I ($G(PSJOMS("TTYPE"))="V") Q 1
"RTN","PSJPAD7I",211,0)
 I ($G(PSJOMS("TTYPE"))="R") Q 1
"RTN","PSJPAD7I",212,0)
 Q 0
"RTN","PSJPAD7I",213,0)
 ;
"RTN","PSJPAD7I",214,0)
DRGXREF(DA,PSJOMS) ; Return Drug file (#50) IEN, if present in PSJOMS("DRGITM"). If no Drug IEN, return 0.
"RTN","PSJPAD7I",215,0)
 ; Called from 'AC' cross reference in PADE INBOUND TRANSACTION (#58.6) file
"RTN","PSJPAD7I",216,0)
 N DRUGIEN
"RTN","PSJPAD7I",217,0)
 S DRUGIEN=+$G(PSJOMS("DRGITM"))
"RTN","PSJPAD7I",218,0)
 ; If the drug id is not purely numeric, it's not an IEN
"RTN","PSJPAD7I",219,0)
 I DRUGIEN'=$G(PSJOMS("DRGITM")) S DRUGIEN=0
"RTN","PSJPAD7I",220,0)
 Q +$G(DRUGIEN)
"RTN","PSJPAD7I",221,0)
 ;
"RTN","PSJPAD7I",222,0)
GETPDMGR(XMY)  ; Return all users with PSJ PADE MGR key in XMY array
"RTN","PSJPAD7I",223,0)
 N X,PADMGR
"RTN","PSJPAD7I",224,0)
 D LIST^DIC(200,,.01,"PI",,,,,"I $D(^XUSEC(""PSJ PADE MGR"",+$G(Y)))",,"PADMGR")
"RTN","PSJPAD7I",225,0)
 S X=0 F  S X=$O(PADMGR("DILIST",X)) Q:'X  S PADMGR=+$G(PADMGR("DILIST",X,0)) I PADMGR S XMY(PADMGR)=""
"RTN","PSJPAD7I",226,0)
 Q
"RTN","PSJPAD7I",227,0)
 ;
"RTN","PSJPAD7I",228,0)
PTRNSTYP(TTYPE,POCKET) ; Return 1 if TTYPE is a patient transaction type, return zero if TTYPE is NOT patient transaction type
"RTN","PSJPAD7I",229,0)
 N PTRNSTYP,PADEPCK
"RTN","PSJPAD7I",230,0)
 S PADEPCK=$G(POCKET)
"RTN","PSJPAD7I",231,0)
 ; 
"RTN","PSJPAD7I",232,0)
 ; Vend, Return, and Waste are always patient transactions
"RTN","PSJPAD7I",233,0)
 ; Null and Discrepancy may be patient transactions
"RTN","PSJPAD7I",234,0)
 S PTRNSTYP=$S(TTYPE="":0,",V,R,W,N,A,"[(","_TTYPE_","):1,($E(PADEPCK,$L(PADEPCK)-2,$L(PADEPCK))="PSB"):1,1:0)
"RTN","PSJPAD7I",235,0)
 Q PTRNSTYP
"RTN","PSJPAD7U")
0^7^B183094975^n/a
"RTN","PSJPAD7U",1,0)
PSJPAD7U ;BIR/JCH-HL7 RECEIVER OMS PADE POCKET ACTIVITY ;9/3/15 1:34  PM
"RTN","PSJPAD7U",2,0)
 ;;5.0;INPATIENT MEDICATIONS ;**317**;16 DEC 97;Build 130
"RTN","PSJPAD7U",3,0)
 ;
"RTN","PSJPAD7U",4,0)
 ; Reference to ^HLPRS is supported by DBIA #4742
"RTN","PSJPAD7U",5,0)
 ; Reference to ^XLFDT is supported by DBIA #10103.
"RTN","PSJPAD7U",6,0)
 ; Reference to ^XLFMTH is supported by DBIA #10105.
"RTN","PSJPAD7U",7,0)
 ; Reference to ^XMD is supported by DBIA #10070.
"RTN","PSJPAD7U",8,0)
 ;
"RTN","PSJPAD7U",9,0)
 Q  ;Direct entry not supported
"RTN","PSJPAD7U",10,0)
 ;
"RTN","PSJPAD7U",11,0)
LOADMSG(PSJOMS,PSJMSH,PSJERR) ; Load HL7 message into temporary global for processing
"RTN","PSJPAD7U",12,0)
 ;This subroutine assumes that all VistA HL7 environment variables are properly initialized
"RTN","PSJPAD7U",13,0)
 N HEADER,OK,SEG,HLHDRO,HLMSG,HLMTIEN,HLMTIENS,HLVER
"RTN","PSJPAD7U",14,0)
 S PSJERR=""
"RTN","PSJPAD7U",15,0)
 S OK=$$STARTMSG^HLPRS(.HLMSG,+PSJMSH,.HEADER) I 'OK D  Q
"RTN","PSJPAD7U",16,0)
 .S PSJERR="MSH - No header message defined"
"RTN","PSJPAD7U",17,0)
 .D ERROR^PSJPAD7U(PSJERR,1) Q
"RTN","PSJPAD7U",18,0)
 ;
"RTN","PSJPAD7U",19,0)
 ;begin parsing of segments and validate
"RTN","PSJPAD7U",20,0)
 D MSH
"RTN","PSJPAD7U",21,0)
 F  Q:'$$NEXTSEG^HLPRS(.HLMSG,.SEG)  D DECODE
"RTN","PSJPAD7U",22,0)
 Q
"RTN","PSJPAD7U",23,0)
 ;
"RTN","PSJPAD7U",24,0)
DECODE ; parse out data from segments
"RTN","PSJPAD7U",25,0)
 K FIELD S FIELD(0)=""
"RTN","PSJPAD7U",26,0)
 S FIELD(0)=$G(SEG("SEGMENT TYPE"))
"RTN","PSJPAD7U",27,0)
 I (",MSH,ORC,PID,PV1,RQD,ZPM,NTE,")[(","_FIELD(0)_",") D @FIELD(0)
"RTN","PSJPAD7U",28,0)
 Q
"RTN","PSJPAD7U",29,0)
 ;
"RTN","PSJPAD7U",30,0)
MSH ; Get Message Identifiers
"RTN","PSJPAD7U",31,0)
 S PSJOMS("HLMTIEN")=$G(HLMTIEN)
"RTN","PSJPAD7U",32,0)
 S PSJOMS("HLMTIENS")=$G(HLMTIENS)
"RTN","PSJPAD7U",33,0)
 S PSJOMS("HLVER")=$G(HL("VER"))
"RTN","PSJPAD7U",34,0)
 Q
"RTN","PSJPAD7U",35,0)
 ;
"RTN","PSJPAD7U",36,0)
PID ; Parse PID segment
"RTN","PSJPAD7U",37,0)
 N II,PATICN,PATSSN,PATDFN,PATID,QQ
"RTN","PSJPAD7U",38,0)
 S PSJOMS("PID")=$G(SEG(0))
"RTN","PSJPAD7U",39,0)
 S PSJOMS("PTID")=$G(SEG(3,1,1,1))
"RTN","PSJPAD7U",40,0)
 ;
"RTN","PSJPAD7U",41,0)
 F QQ=1:1:4 S PATID=$G(SEG(3,QQ,3,1)) D
"RTN","PSJPAD7U",42,0)
 .S:PATID="NI" PATICN=$G(SEG(3,QQ,1,1))
"RTN","PSJPAD7U",43,0)
 .I PATID="SS" S PATSSN=$G(SEG(3,QQ,1,1))
"RTN","PSJPAD7U",44,0)
 .S:PATID="PI"!(PATID="M10") PATDFN=$G(SEG(3,QQ,1,1))
"RTN","PSJPAD7U",45,0)
 I PATID="" F QQ=1:1:4 S PATID=$G(SEG(3,3,QQ,1)) D
"RTN","PSJPAD7U",46,0)
 .S:PATID="NI" PATICN=$G(SEG(3,1,QQ,1))
"RTN","PSJPAD7U",47,0)
 .I PATID="SS" S PATSSN=$G(SEG(3,1,QQ,1))
"RTN","PSJPAD7U",48,0)
 .S:PATID="PI"!(PATID="M10") PATDFN=$G(SEG(3,1,QQ,1))
"RTN","PSJPAD7U",49,0)
 ; If it's not in PATIENT (#2) file, it's not a valid DFN
"RTN","PSJPAD7U",50,0)
 I $G(PATDFN),'$D(^DPT(PATDFN,0)) S PATDFN=0
"RTN","PSJPAD7U",51,0)
 S:$G(PATDFN) PSJOMS("DFN")=PATDFN
"RTN","PSJPAD7U",52,0)
 ; Get patient SSN from PID.19 Patient SSN
"RTN","PSJPAD7U",53,0)
 I '$G(PATSSN) S PATSSN=$TR($G(SEG(19,1,1,1)),"-")
"RTN","PSJPAD7U",54,0)
 ; If no SSN in PID.19, check PID.18
"RTN","PSJPAD7U",55,0)
 I '$G(PATSSN) S PATSSN=$TR($G(SEG(18,1,1,1)),"-")
"RTN","PSJPAD7U",56,0)
 I $G(PATSSN) S PSJOMS("SSN")=PATSSN
"RTN","PSJPAD7U",57,0)
 ; If unknown patient, find matching patient from SSN or ICN
"RTN","PSJPAD7U",58,0)
 I '$G(PSJOMS("DFN"))!($G(PSJOMS("DFN"))>0&'$D(^DPT(+$G(PSJOMS("DFN"))))) D
"RTN","PSJPAD7U",59,0)
 .N PSJDFN,X,Y,PSIX,PSVAL,PSERR,INDEX
"RTN","PSJPAD7U",60,0)
 .I $G(PATSSN) S PSVAL=PATSSN,INDEX="SSN" S PSJDFN=$$FIND1^DIC(2,,"X",PSVAL,INDEX,,"PSERR"),PSJOMS("DFN")=PSJDFN
"RTN","PSJPAD7U",61,0)
 .I $G(PSJDFN) S PSJOMS("DFN")=PSJDFN,PSJOMS("PTID")=PATSSN Q
"RTN","PSJPAD7U",62,0)
 .I $G(PATICN) S PSVAL=PATICN,INDEX="AICN" S PSJDFN=$$FIND1^DIC(2,,"X",PSVAL,INDEX,,"PSERR"),PSJOMS("DFN")=PSJDFN
"RTN","PSJPAD7U",63,0)
 ; Set Patient Name
"RTN","PSJPAD7U",64,0)
 S PSJOMS("PTNAMA")=$G(SEG(5,1,1,1))
"RTN","PSJPAD7U",65,0)
 S PSJOMS("PTNAMB")=$G(SEG(5,2,1,1)) S:PSJOMS("PTNAMB")="" PSJOMS("PTNAMB")=$G(SEG(5,1,2,1))
"RTN","PSJPAD7U",66,0)
 S PSJOMS("PTNAMC")=$G(SEG(5,3,1,1)) S:PSJOMS("PTNAMC")="" PSJOMS("PTNAMC")=$G(SEG(5,1,3,1))
"RTN","PSJPAD7U",67,0)
 I '$G(PSJOMS("DFN")),(PSJOMS("PTID")?1.N),'$G(PATSSN) D
"RTN","PSJPAD7U",68,0)
 .N DPTNAME
"RTN","PSJPAD7U",69,0)
 .Q:'$D(^DPT(+PSJOMS("PTID"),0))  S DPTNAME=$P($G(^DPT(PSJOMS("PTID"),0)),"^")
"RTN","PSJPAD7U",70,0)
 .Q:DPTNAME=""  I $$UPPER^HLFNC($E(PSJOMS("PTNAMA"),1,$L(PSJOMS("PTNAMA"))))=$$UPPER^HLFNC($E(DPTNAME,1,$L(PSJOMS("PTNAMA")))) S PSJOMS("DFN")=PSJOMS("PTID")
"RTN","PSJPAD7U",71,0)
 ;
"RTN","PSJPAD7U",72,0)
 I $G(PSJOMS("DFN")) N PSJNAM,PSJMINAM S PSJNAM=$P($G(^DPT(+$G(PSJOMS("DFN")),0)),"^") I $L(PSJNAM)>2 D
"RTN","PSJPAD7U",73,0)
 .S PSJMINAM=$P($P(PSJNAM,",",2)," ",2)
"RTN","PSJPAD7U",74,0)
 .I $L(PSJMINAM)>0 S PSJOMS("PTNAMC")=PSJMINAM
"RTN","PSJPAD7U",75,0)
 I '$G(PSJOMS("DFN"))!($G(PSJOMS("DFN"))&'$D(^DPT(+$G(PSJOMS("DFN")),0))) D
"RTN","PSJPAD7U",76,0)
 .S PSJOMS("MDFN")=$G(PSJOMS("DFN")),PSJOMS("MPTNAMA")=PSJOMS("PTNAMA"),PSJOMS("MPTNAMB")=PSJOMS("PTNAMB")
"RTN","PSJPAD7U",77,0)
 Q
"RTN","PSJPAD7U",78,0)
 ;
"RTN","PSJPAD7U",79,0)
PV1 ; Parse PV1 segment
"RTN","PSJPAD7U",80,0)
 S PSJOMS("PV1")=$G(SEG(0))
"RTN","PSJPAD7U",81,0)
 S PSJOMS("PTCLASS")=$G(SEG(2,1,1,1))         ; Patient Class
"RTN","PSJPAD7U",82,0)
 S PSJOMS("PTLOC")=$G(SEG(3,1,1,1))           ; Patient Location 
"RTN","PSJPAD7U",83,0)
 S PSJOMS("PTROOM")=$G(SEG(3,2,1,1))          ; Room
"RTN","PSJPAD7U",84,0)
 S PSJOMS("PTBED")=$G(SEG(3,3,1,1))           ; Bed
"RTN","PSJPAD7U",85,0)
 Q
"RTN","PSJPAD7U",86,0)
 ;
"RTN","PSJPAD7U",87,0)
ORC ; Parse ORC segment
"RTN","PSJPAD7U",88,0)
 S PSJOMS("ORC")=$G(SEG(0))
"RTN","PSJPAD7U",89,0)
 S PSJOMS("VAORD")=$G(SEG(2,1,1,1))           ; Pharmacy Order
"RTN","PSJPAD7U",90,0)
 S:'PSJOMS("VAORD") PSJOMS("VAORD")=""
"RTN","PSJPAD7U",91,0)
 S PSJOMS("XORD")=$G(SEG(3,1,1,1))            ; External order
"RTN","PSJPAD7U",92,0)
 S PSJOMS("DTRDT")=$G(SEG(9,1,1,1))           ; Transaction Date/Time
"RTN","PSJPAD7U",93,0)
 Q
"RTN","PSJPAD7U",94,0)
 ;
"RTN","PSJPAD7U",95,0)
RQD ; Parse RQD segment
"RTN","PSJPAD7U",96,0)
 S PSJOMS("RQD")=$G(SEG(0))
"RTN","PSJPAD7U",97,0)
 S PSJOMS("DRGIID")=$G(SEG(2,1,1,1))          ; Internal Drug ID
"RTN","PSJPAD7U",98,0)
 S PSJOMS("DRGITXT")=$G(SEG(2,2,1,1))         ; Interla drug text name
"RTN","PSJPAD7U",99,0)
 S PSJOMS("DRGEID")=$G(SEG(3,1,1,1))          ; External Drug ID
"RTN","PSJPAD7U",100,0)
 S PSJOMS("DRGETXT")=$G(SEG(3,2,1,1))         ; External drug text name
"RTN","PSJPAD7U",101,0)
 S PSJOMS("QTY")=$G(SEG(5,1,1,1))             ; Quantity of drug
"RTN","PSJPAD7U",102,0)
 S PSJOMS("DRGUNIT")=$G(SEG(6,1,1,1))         ; Drug Units
"RTN","PSJPAD7U",103,0)
 Q
"RTN","PSJPAD7U",104,0)
 ;
"RTN","PSJPAD7U",105,0)
ZPM ; Parse ZPM segment
"RTN","PSJPAD7U",106,0)
 N PSJFSET,PSJUFSET S PSJFSET=0,PSJUFSET=0
"RTN","PSJPAD7U",107,0)
 S PSJOMS("ZPM")=$G(SEG(0))
"RTN","PSJPAD7U",108,0)
 S PSJOMS("TTYPE")=$G(SEG(1,1,1,1))           ; Transaction Type
"RTN","PSJPAD7U",109,0)
 S PSJOMS("STYP")=$G(PSJOMS("TTYPE"))
"RTN","PSJPAD7U",110,0)
 S PSJOMS("DISPSYS")=$G(SEG(2,1,1,1))         ; PADE Inbound System
"RTN","PSJPAD7U",111,0)
 S PSJOMS("CABID")=$G(SEG(3,1,1,1))           ; Cabinet/Device ID
"RTN","PSJPAD7U",112,0)
 S PSJOMS("DRWR")=$G(SEG(4,1,1,1))            ; Drawer
"RTN","PSJPAD7U",113,0)
 S PSJOMS("PKT")=$G(SEG(5,1,1,1))             ; Pocket
"RTN","PSJPAD7U",114,0)
 S PSJOMS("DRGITM")=$G(SEG(6,1,1,1))          ; Drug Item
"RTN","PSJPAD7U",115,0)
 S PSJOMS("DRGIID")=PSJOMS("DRGITM")          ; Drug Internal ID
"RTN","PSJPAD7U",116,0)
 S:PSJOMS("TTYPE")="I" PSJOMS("TTYPE")="V"
"RTN","PSJPAD7U",117,0)
 S PSJOMS("DRGTXT")=$G(SEG(6,1,2,1)) I PSJOMS("DRGTXT")="" S PSJOMS("DRGTXT")=$G(SEG(6,2,1,1))  ; Drug text name
"RTN","PSJPAD7U",118,0)
 I $G(HL("VER"))=2.3 D  ; Backward compatible parsing - use field separator as component separator for ZPM only
"RTN","PSJPAD7U",119,0)
 .S PSJOMS("DRGTXT")=$G(SEG(7,1,1,1)),PSJFSET=PSJFSET+1
"RTN","PSJPAD7U",120,0)
 S PSJOMS("DITMCLS")=$G(SEG(7+PSJFSET,1,1,1))   ; Drug CS Class
"RTN","PSJPAD7U",121,0)
 S PSJOMS("EXBCNT")=$G(SEG(8+PSJFSET,1,1,1))    ; Expected Begin Count
"RTN","PSJPAD7U",122,0)
 S PSJOMS("ACBCNT")=$G(SEG(9+PSJFSET,1,1,1))    ; Actual Begin Count
"RTN","PSJPAD7U",123,0)
 ;
"RTN","PSJPAD7U",124,0)
 ; If NULL is sent as a Begin Count, it wasn't really sent. Must be numeric
"RTN","PSJPAD7U",125,0)
 I PSJOMS("TTYPE")'="A" D
"RTN","PSJPAD7U",126,0)
 .I PSJOMS("EXBCNT")="",(PSJOMS("ACBCNT")'="") S PSJOMS("EXBCNT")=PSJOMS("ACBCNT")
"RTN","PSJPAD7U",127,0)
 .I PSJOMS("ACBCNT")="",(PSJOMS("EXBCNT")'="") S PSJOMS("ACBCNT")=PSJOMS("EXBCNT")
"RTN","PSJPAD7U",128,0)
 .S PSJOMS("ACBCNT")=+PSJOMS("ACBCNT"),PSJOMS("EXBCNT")=+PSJOMS("EXBCNT")
"RTN","PSJPAD7U",129,0)
 ;
"RTN","PSJPAD7U",130,0)
 ; If "V"end transaction, use Expected Begin Count
"RTN","PSJPAD7U",131,0)
 I PSJOMS("TTYPE")="V" S PSJOMS("ACBCNT")=$G(PSJOMS("EXBCNT"))
"RTN","PSJPAD7U",132,0)
 ;
"RTN","PSJPAD7U",133,0)
 S PSJOMS("TRNSAMT")=$G(SEG(10+PSJFSET,1,1,1))  ; Transaction Amount
"RTN","PSJPAD7U",134,0)
 ;
"RTN","PSJPAD7U",135,0)
 ; Adjust inventory update transaction information, depending on transaction type
"RTN","PSJPAD7U",136,0)
 I PSJOMS("TTYPE")="L" D
"RTN","PSJPAD7U",137,0)
 .I $G(PSJOMS("EXBCNT")) S PSJOMS("TRNSAMT")=+$G(PSJOMS("EXBCNT"))
"RTN","PSJPAD7U",138,0)
 .I '$G(PSJOMS("EXBCNT")) S PSJOMS("TRNSAMT")=+$G(PSJOMS("ACBCNT"))
"RTN","PSJPAD7U",139,0)
 .S PSJOMS("EXBCNT")=0,PSJOMS("ACBCNT")=0
"RTN","PSJPAD7U",140,0)
 ;
"RTN","PSJPAD7U",141,0)
 I PSJOMS("TTYPE")="C" D   ; Ignore transaction amount for COUNT transactions
"RTN","PSJPAD7U",142,0)
 .I $G(PSJOMS("ACBCNT")) S PSJOMS("TRNSAMT")=PSJOMS("ACBCNT")
"RTN","PSJPAD7U",143,0)
 .I ($G(PSJOMS("ACBCNT"))=""),$G(PSJOMS("TRNSAMT")) S PSJOMS("ACBCNT")=+$G(PSJOMS("TRNSAMT"))
"RTN","PSJPAD7U",144,0)
 ;
"RTN","PSJPAD7U",145,0)
 I PSJOMS("TTYPE")="U" D
"RTN","PSJPAD7U",146,0)
 .I '$G(PSJOMS("ACBCNT")) S PSJOMS("TRNSAMT")=PSJOMS("EXBCNT"),PSJOMS("ACBCNT")=PSJOMS("EXBCNT")
"RTN","PSJPAD7U",147,0)
 .I '$G(PSJOMS("EXBCNT")) S PSJOMS("TRNSAMT")=PSJOMS("ACBCNT"),PSJOMS("EXBCNT")=PSJOMS("ACBCNT")
"RTN","PSJPAD7U",148,0)
 ;
"RTN","PSJPAD7U",149,0)
 I PSJOMS("TTYPE")="A",PSJOMS("ACBCNT")="" S PSJOMS("ACBCNT")=PSJOMS("EXBCNT")+PSJOMS("TRNSAMT") S:PSJOMS("ACBCNT")<0 PSJOMS("ACBCNT")=0
"RTN","PSJPAD7U",150,0)
 ;
"RTN","PSJPAD7U",151,0)
 ; Parse User information
"RTN","PSJPAD7U",152,0)
 S PSJOMS("NUR1A")=$G(SEG(11+PSJFSET,1,1,1))
"RTN","PSJPAD7U",153,0)
 S PSJOMS("NUR1B")=$G(SEG(11+PSJFSET,1,2,1)) I PSJOMS("NUR1B")="" S PSJOMS("NUR1B")=$G(SEG(11+PSJFSET,2,1,1))
"RTN","PSJPAD7U",154,0)
 S PSJOMS("NUR1C")=$G(SEG(11+PSJFSET,1,3,1)) I PSJOMS("NUR1C")="" S PSJOMS("NUR1C")=$G(SEG(11+PSJFSET,3,1,1))
"RTN","PSJPAD7U",155,0)
 I $G(HL("VER"))=2.3 D  ; Backward compatible parsing - use field separator as component separator for ZPM only
"RTN","PSJPAD7U",156,0)
 .S PSJFSET=PSJFSET+1,PSJOMS("NUR1B")=$G(SEG(11+PSJFSET,1,1,1))
"RTN","PSJPAD7U",157,0)
 .I PSJOMS("NUR1B")["," S PSJOMS("NUR1C")=$P(PSJOMS("NUR1B"),",",2),PSJOMS("NUR1B")=$P(PSJOMS("NUR1B"),",")
"RTN","PSJPAD7U",158,0)
 I PSJOMS("NUR1B")=""&(PSJOMS("NUR1C")="") S PSJOMS("NUR1B")="USER",PSJOMS("NUR1C")="PADE"
"RTN","PSJPAD7U",159,0)
 I PSJOMS("NUR1B")=""&(PSJOMS("NUR1C")["_") S PSJOMS("NUR1B")=$P(PSJOMS("NUR1C"),"_"),PSJOMS("NUR1C")=$P(PSJOMS("NUR1C"),"_",2)
"RTN","PSJPAD7U",160,0)
 I PSJOMS("NUR1C")=""&(PSJOMS("NUR1B")["_") S PSJOMS("NUR1C")=$P(PSJOMS("NUR1B"),"_",2),PSJOMS("NUR1B")=$P(PSJOMS("NUR1B"),"_")
"RTN","PSJPAD7U",161,0)
 ; Parse Witness information
"RTN","PSJPAD7U",162,0)
 S PSJOMS("NUR2A")=$G(SEG(12+PSJFSET,1,1,1))
"RTN","PSJPAD7U",163,0)
 S PSJOMS("NUR2B")=$G(SEG(12+PSJFSET,1,2,1)) I PSJOMS("NUR2B")="" S PSJOMS("NUR2B")=$G(SEG(12+PSJFSET,2,1,1))
"RTN","PSJPAD7U",164,0)
 S PSJOMS("NUR2C")=$G(SEG(12+PSJFSET,1,3,1)) I PSJOMS("NUR2C")="" S PSJOMS("NUR2C")=$G(SEG(12+PSJFSET,3,1,1))
"RTN","PSJPAD7U",165,0)
 I $G(HL("VER"))=2.3 D  ; Backward compatible parsing - use field separator as component separator for ZPM only
"RTN","PSJPAD7U",166,0)
 .S PSJFSET=PSJFSET+1,PSJOMS("NUR2B")=$G(SEG(12+PSJFSET,1,1,1))
"RTN","PSJPAD7U",167,0)
 .I PSJOMS("NUR2B")["," S PSJOMS("NUR2C")=$P(PSJOMS("NUR2B"),",",2),PSJOMS("NUR2B")=$P(PSJOMS("NUR2B"),",")
"RTN","PSJPAD7U",168,0)
 I PSJOMS("NUR2B")=""&(PSJOMS("NUR2C")["_") S PSJOMS("NUR2B")=$P(PSJOMS("NUR2C"),"_"),PSJOMS("NUR2C")=$P(PSJOMS("NUR2C"),"_",2)
"RTN","PSJPAD7U",169,0)
 I PSJOMS("NUR2C")=""&(PSJOMS("NUR2B")["_") S PSJOMS("NUR2C")=$P(PSJOMS("NUR2B"),"_",2),PSJOMS("NUR2B")=$P(PSJOMS("NUR2B"),"_")
"RTN","PSJPAD7U",170,0)
 ;
"RTN","PSJPAD7U",171,0)
 S PSJOMS("TOTITMS")=$G(SEG(13+PSJFSET,1,1,1))         ; Device Drug balance
"RTN","PSJPAD7U",172,0)
 S PSJOMS("FACIL")=$G(SEG(14+PSJFSET,1,1,1))           ; Facility
"RTN","PSJPAD7U",173,0)
 S PSJOMS("PSDQ")=$$ABS^XLFMTH($G(PSJOMS("TRNSAMT")))  ; Absolute value of transaction quantity
"RTN","PSJPAD7U",174,0)
 S PSJOMS("DWARD")=$G(SEG(15+PSJFSET,1,1,1))           ; Ward
"RTN","PSJPAD7U",175,0)
 S PSJOMS("SBDRWR")=$G(SEG(16+PSJFSET,1,1,1))          ; Subdrawer
"RTN","PSJPAD7U",176,0)
 S:PSJOMS("SBDRWR")="" PSJOMS("SBDRWR")="~~"
"RTN","PSJPAD7U",177,0)
 S PSJOMS("PKTCAP")=$G(SEG(17+PSJFSET,1,1,1))          ; PAR Quantity
"RTN","PSJPAD7U",178,0)
 S PSJOMS("POREORD")=$G(SEG(18+PSJFSET,1,1,1))         ; Reorder Qty
"RTN","PSJPAD7U",179,0)
 S PSJOMS("PSJDT")=$P($G(SEG(19+PSJFSET,1,1,1)),"-")   ; Transaction Date
"RTN","PSJPAD7U",180,0)
 S PSJOMS("PSJDT")=$E(PSJOMS("PSJDT"),1,14)
"RTN","PSJPAD7U",181,0)
 S PSJOMS("LOTNUM")=$G(SEG(20+PSJFSET,1,1,1))          ; Lot Number
"RTN","PSJPAD7U",182,0)
 S PSJOMS("SERNUM")=$G(SEG(21+PSJFSET,1,1,1))          ; Serial Number
"RTN","PSJPAD7U",183,0)
 I ($G(PSJOMS("DRGUNIT"))="") S PSJOMS("DRGUNIT")=$G(SEG(34+PSJFSET,1,1,1))
"RTN","PSJPAD7U",184,0)
 ;
"RTN","PSJPAD7U",185,0)
 S PSJOMS("NUR1")=$$USER(.PSJOMS,1)                    ; File User into PADE USER (#58.64) file, if it doesn't already exist
"RTN","PSJPAD7U",186,0)
 S PSJOMS("NUR2")=$$USER(.PSJOMS,2)                    ; File Witness into PADE USER (#58.64) file, if it doesn't already exist
"RTN","PSJPAD7U",187,0)
 Q
"RTN","PSJPAD7U",188,0)
 ;
"RTN","PSJPAD7U",189,0)
NTE ; Parse NTE segment
"RTN","PSJPAD7U",190,0)
 S PSJOMS("NTE")=$G(SEG(0))
"RTN","PSJPAD7U",191,0)
 S PSJOMS("COMMENT")=$G(SEG(3,1,1,1))                  ; Comment
"RTN","PSJPAD7U",192,0)
 S PSJOMS("CMTYPE")=$G(SEG(4,1,1,1))
"RTN","PSJPAD7U",193,0)
 I (PSJOMS("CMTYPE")["PATIENT SPECIFIC BIN")!(PSJOMS("CMTYPE")["RETURN BIN") D
"RTN","PSJPAD7U",194,0)
 .S PSJOMS("COMMENT")=$S((PSJOMS("COMMENT")'=""):PSJOMS("CMTYPE")_"//"_PSJOMS("COMMENT"),1:PSJOMS("CMTYPE"))
"RTN","PSJPAD7U",195,0)
 .I (PSJOMS("CMTYPE")["PATIENT SPECIFIC BIN") D PSB^PSJPDRUT(.PSJOMS)
"RTN","PSJPAD7U",196,0)
 .I $E(PSJOMS("CMTYPE"),1,10)="RETURN BIN" S PSJOMS("PKT")=PSJOMS("PKT")_"RB"
"RTN","PSJPAD7U",197,0)
 Q
"RTN","PSJPAD7U",198,0)
 ;
"RTN","PSJPAD7U",199,0)
ERROR(TEXT,PSPCFG) ; Log error with PADE inbound HL7 message
"RTN","PSJPAD7U",200,0)
 Q:$G(TEXT)=""
"RTN","PSJPAD7U",201,0)
 N GBL,NEXT S GBL="^XTMP(""PSJOMSERR""_+$H)"
"RTN","PSJPAD7U",202,0)
 S:'$G(@GBL@(0)) @GBL@(0)=$P($$FMADD^XLFDT($$NOW^XLFDT,7),".")_"^"_$P($$NOW^XLFDT,".")_"^"_"PADE HL7 OMS Message Error Log"
"RTN","PSJPAD7U",203,0)
 S NEXT=+$O(@GBL@(""),-1)+1 S @GBL@(NEXT)=TEXT
"RTN","PSJPAD7U",204,0)
 D MESSAGE(TEXT,$G(PSPCFG))
"RTN","PSJPAD7U",205,0)
 Q
"RTN","PSJPAD7U",206,0)
 ;
"RTN","PSJPAD7U",207,0)
CHKFLD(FLD,NONZ,LEN,MUMPS,FNAM) ; Validates a minimum Required fields for Not Null
"RTN","PSJPAD7U",208,0)
 ; Input: (r) FLD  = field contents from incoming segment
"RTN","PSJPAD7U",209,0)
 ;        (o) NONZ = 1 if want to check for field value is Not 0
"RTN","PSJPAD7U",210,0)
 ;        (o) LEN  = length if want to check specific length of field
"RTN","PSJPAD7U",211,0)
 ;        (o) MUMPS= executable True/False code to test specific cond.
"RTN","PSJPAD7U",212,0)
 ;        (r) FNAM = HL7 field name, i.e. ZPM.3
"RTN","PSJPAD7U",213,0)
 ;
"RTN","PSJPAD7U",214,0)
 N ERR S ERR=""
"RTN","PSJPAD7U",215,0)
 S NONZ=$G(NONZ),LEN=$G(LEN),MUMPS=$G(MUMPS)
"RTN","PSJPAD7U",216,0)
 S:FLD="" ERR=FNAM_" is null or invalid"
"RTN","PSJPAD7U",217,0)
 ;
"RTN","PSJPAD7U",218,0)
 ;check for more specific validation errors
"RTN","PSJPAD7U",219,0)
 I NONZ,FLD=0 D
"RTN","PSJPAD7U",220,0)
 . S ERR=FNAM_" field cannot be 0"
"RTN","PSJPAD7U",221,0)
 I LEN,$L(FLD)'=LEN D
"RTN","PSJPAD7U",222,0)
 . S ERR=FNAM_" field is required to be "_LEN_" in length"
"RTN","PSJPAD7U",223,0)
 I MUMPS]"",@MUMPS D
"RTN","PSJPAD7U",224,0)
 . S ERR=FNAM_" field is missing or invalid >"_FLD_"<"
"RTN","PSJPAD7U",225,0)
 Q ERR
"RTN","PSJPAD7U",226,0)
 ;
"RTN","PSJPAD7U",227,0)
MESSAGE(ERRTXT,PSPCFG) ;Build message and send to PADE mail group
"RTN","PSJPAD7U",228,0)
 N MSGTEXT,XMTEXT,XMSUB,XMY,XMZ,XMDUZ,MSGTYPE,MSHREC,PSJPOUT
"RTN","PSJPAD7U",229,0)
 N HLFS,HLCS,MTXTLN,PSPMGRP,PSPMGCNT,PSPMGTYP,PSPDSYS,PSMSGDT
"RTN","PSJPAD7U",230,0)
 S MTXTLN=0
"RTN","PSJPAD7U",231,0)
 S PSMSGDT=$S($G(PSJOMS("PSJDT")):PSJOMS("PSJDT"),1:$$FMTHL7^XLFDT($$NOW^XLFDT))
"RTN","PSJPAD7U",232,0)
 S MSGTEXT(MTXTLN)=" ",MTXTLN=MTXTLN+1
"RTN","PSJPAD7U",233,0)
 S MSGTEXT(MTXTLN)="An error was encountered while processing a message from PADE",MTXTLN=MTXTLN+1
"RTN","PSJPAD7U",234,0)
 S MSGTEXT(MTXTLN)="",MTXTLN=MTXTLN+1
"RTN","PSJPAD7U",235,0)
 S MSGTEXT(MTXTLN)="     Date:  "_$TR($$FMTE^XLFDT($$HL7TFM^XLFDT(PSMSGDT)),"@"," "),MTXTLN=MTXTLN+1
"RTN","PSJPAD7U",236,0)
 I $L($G(PSJOMS("PTNAMA")))!$L($G(PSJOMS("PTNAMB"))) D
"RTN","PSJPAD7U",237,0)
 .N PATNAM S PATNAM=$G(PSJOMS("PTNAMA"))_","_$G(PSJOMS("PTNAMB"))_"^"_$G(PSJOMS("DFN"))
"RTN","PSJPAD7U",238,0)
 .I $TR(PATNAM," ,^")="" S PATNAM="None"
"RTN","PSJPAD7U",239,0)
 .S MSGTEXT(MTXTLN)="Patient:   "_$G(PATNAM),MTXTLN=MTXTLN+1
"RTN","PSJPAD7U",240,0)
 I ($G(ERRTXT)'["CABINET=")&$L($G(PSJOMS("CABID"))) S ERRTXT=$G(ERRTXT)_"|CABINET="_PSJOMS("CABID")
"RTN","PSJPAD7U",241,0)
 I ($G(ERRTXT)'["SYSTEM=")&$L($G(PSJOMS("DISPSYS"))) S ERRTXT=$G(ERRTXT)_"|SYSTEM="_PSJOMS("DISPSYS")
"RTN","PSJPAD7U",242,0)
 S MSGTEXT(MTXTLN)="Error Msg:  "_$G(ERRTXT),MTXTLN=MTXTLN+1
"RTN","PSJPAD7U",243,0)
 I $E($G(HLHDRO(1,0)),1,3)="MSH" S MSGTEXT(MTXTLN)="   Header:  "_HLHDRO(1,0),MTXTLN=MTXTLN+1
"RTN","PSJPAD7U",244,0)
 ; Send message to mail group
"RTN","PSJPAD7U",245,0)
 S XMSUB=" PADE Error-Msg:"_$G(HLMTIENS)
"RTN","PSJPAD7U",246,0)
 I ERRTXT["DRUG NOT ON FILE" S XMSUB=XMSUB_"-DRUG NOT ON FILE"
"RTN","PSJPAD7U",247,0)
 I ERRTXT["PATIENT NOT ON FILE" S XMSUB=XMSUB_"-PATIENT NOT ON FILE"
"RTN","PSJPAD7U",248,0)
 S XMTEXT="MSGTEXT("
"RTN","PSJPAD7U",249,0)
 S PSPMGCNT="",PSPDSYS=$$FIND1^DIC(58.601,"","",$G(PSJOMS("DISPSYS")))
"RTN","PSJPAD7U",250,0)
 I '$G(PSPDSYS) S PSPDSYS=$O(^PS(58.601,0))
"RTN","PSJPAD7U",251,0)
 S PSPMGTYP=$S($G(PSPCFG):58.6015,1:58.6016)
"RTN","PSJPAD7U",252,0)
 D LIST^DIC(PSPMGTYP,","_+$G(PSPDSYS)_",",,"P",,,,,,,"PSJPOUT")
"RTN","PSJPAD7U",253,0)
 S PSPMGCNT=0 F  S PSPMGCNT=$O(PSJPOUT("DILIST",PSPMGCNT)) Q:'PSPMGCNT  D
"RTN","PSJPAD7U",254,0)
 .N PSPMGRP
"RTN","PSJPAD7U",255,0)
 .S PSPMGRP=$P($G(PSJPOUT("DILIST",PSPMGCNT,0)),"^",2)
"RTN","PSJPAD7U",256,0)
 .S XMY("G."_PSPMGRP)=""
"RTN","PSJPAD7U",257,0)
 I $D(XMY)<10 D GETPDMGR^PSJPAD7I(.XMY)
"RTN","PSJPAD7U",258,0)
 Q:$D(XMY)<10
"RTN","PSJPAD7U",259,0)
 S (XMDUZ)="PADE"
"RTN","PSJPAD7U",260,0)
 D ^XMD
"RTN","PSJPAD7U",261,0)
 Q
"RTN","PSJPAD7U",262,0)
 ;
"RTN","PSJPAD7U",263,0)
VALSYS(SYS) ; Validate PADE system SYS. Return PADE INVENTORY SYSTEM (#58.601) file IEN if SYS exists an entry.
"RTN","PSJPAD7U",264,0)
 K PSJIEN
"RTN","PSJPAD7U",265,0)
 D FIND^DIC(58.601,"","@","",SYS,"","","","","PSJIEN")
"RTN","PSJPAD7U",266,0)
 Q $G(PSJIEN("DILIST",2,1))
"RTN","PSJPAD7U",267,0)
 ;
"RTN","PSJPAD7U",268,0)
VALCAB(SYS,CAB) ; Validate PADE Cabinet CAB for system SYS. 
"RTN","PSJPAD7U",269,0)
 ; Return pointer to DISPENSING DEVICE (#1) multiple (sub-file 58.6011) in PADE INVENTORY SYSTEM (#58.601) file.
"RTN","PSJPAD7U",270,0)
 K PSJIEN
"RTN","PSJPAD7U",271,0)
 D FIND^DIC(58.6011,","_$$VALSYS(SYS)_",","@","",CAB,"","","","","PSJIEN","MSG")
"RTN","PSJPAD7U",272,0)
 Q $G(PSJIEN("DILIST",2,1))
"RTN","PSJPAD7U",273,0)
 ;
"RTN","PSJPAD7U",274,0)
USER(PSJOMS,TYPE) ; Find VistA User DUZ
"RTN","PSJPAD7U",275,0)
 K PSJUDUZ
"RTN","PSJPAD7U",276,0)
 ;
"RTN","PSJPAD7U",277,0)
 N NURNAM,SCR,PSJPSYS,PSJUSRID,PSUBB,PSUBC,PTMPF,PTMPL,PTMP
"RTN","PSJPAD7U",278,0)
 S PSJPSYS=$$FIND1^DIC(58.601,,"MX",$G(PSJOMS("DISPSYS")))
"RTN","PSJPAD7U",279,0)
 S PSJUSRID=""
"RTN","PSJPAD7U",280,0)
 S PSJUSRID=$S($G(TYPE)=1:$G(PSJOMS("NUR1A")),$G(TYPE)=2:$G(PSJOMS("NUR2A")),1:"")
"RTN","PSJPAD7U",281,0)
 ; If the Family Name was sent as FIRST,LAST, set PSJOMS("NUR<TYPE>B") and PSJOMS("NUR<TYPE>C")
"RTN","PSJPAD7U",282,0)
 I $G(TYPE) S PSUBB="NUR"_$G(TYPE)_"B",PTMP=$G(PSJOMS(PSUBB)) I PTMP]"" D
"RTN","PSJPAD7U",283,0)
 .N PSUBC S PSUBC="NUR"_$G(TYPE)_"C"
"RTN","PSJPAD7U",284,0)
 .S PTMPF="",PTMPL=""
"RTN","PSJPAD7U",285,0)
 .S PTMPF=$G(PSJOMS(PSUBC))
"RTN","PSJPAD7U",286,0)
 .S PTMPL=$G(PSJOMS(PSUBB))
"RTN","PSJPAD7U",287,0)
 .I PTMP["," S PTMPL=$P(PTMP,","),PTMPF=$P(PTMP,",",2)
"RTN","PSJPAD7U",288,0)
 .; If Given name also contains a name, quit
"RTN","PSJPAD7U",289,0)
 .S PSUBC="NUR"_$G(TYPE)_"C",PTMP=$G(PSJOMS(PSUBC)) I PTMP]"" Q
"RTN","PSJPAD7U",290,0)
 .S:PTMPL="" PTMPL="PADE"
"RTN","PSJPAD7U",291,0)
 .S:PTMPF="" PTMPF="USER"
"RTN","PSJPAD7U",292,0)
 .S PSJOMS(PSUBB)=PTMPL,PSJOMS(PSUBC)=PTMPF
"RTN","PSJPAD7U",293,0)
 I $G(TYPE)=1 S NURNAM=$TR($G(PSJOMS("NUR1B")),",")_","_$TR($G(PSJOMS("NUR1C")),",")
"RTN","PSJPAD7U",294,0)
 I $G(TYPE)=2 S NURNAM=$TR($G(PSJOMS("NUR2B")),",")_","_$TR($G(PSJOMS("NUR2C")),",")
"RTN","PSJPAD7U",295,0)
 ; If no primary USER is received, stuff in generic user
"RTN","PSJPAD7U",296,0)
 I $G(TYPE)=1 I ($P(NURNAM,",")="")&($P(NURNAM,",",2)="") S NURNAM="USER,PADE"
"RTN","PSJPAD7U",297,0)
 ;
"RTN","PSJPAD7U",298,0)
 S PSJUDUZ=""
"RTN","PSJPAD7U",299,0)
 S PSJUDUZ=$$FILUSR(PSJPSYS,NURNAM,PSJUSRID)
"RTN","PSJPAD7U",300,0)
 Q PSJUDUZ
"RTN","PSJPAD7U",301,0)
 ;
"RTN","PSJPAD7U",302,0)
FINDIENS(FILES,VALS) ; Find IENS for VALS in file/sub-files within FILE
"RTN","PSJPAD7U",303,0)
 K PSJIEN N PSJC,MSG,FILE,PSJIENS,VAL
"RTN","PSJPAD7U",304,0)
 F PSJC=1:1 S FILE=$P(FILES,"^",PSJC),VAL=$P(VALS,"^",PSJC) Q:FILE=""!(VAL="")  D
"RTN","PSJPAD7U",305,0)
 .I PSJC=1 D FIND^DIC(FILE,"","@","",VAL,"","","","","PSJIEN","MSG") S PSJIENS=","_$G(PSJIEN("DILIST",2,1))_"," Q
"RTN","PSJPAD7U",306,0)
 .D FIND^DIC(FILE,PSJIENS,"@","",VAL,"","","","","PSJIEN","MSG")
"RTN","PSJPAD7U",307,0)
 .S PSJIENS=$G(PSJIENS)_$G(PSJIEN("DILIST",2,1))_","
"RTN","PSJPAD7U",308,0)
 Q $P(PSJIENS,",",2,$L(PSJIENS,",")-1)
"RTN","PSJPAD7U",309,0)
 ;
"RTN","PSJPAD7U",310,0)
FILUSR(PSJPSYS,PSJNAME,PSJPUSR) ; File PADE user to PADE USER (#58.64) if not already on file
"RTN","PSJPAD7U",311,0)
 N PSJGETUS,PSJERR,PSJKEY,PSJVAL,PSJDUZ,FDA,ERR,PADUSIEN,PSJDUZ
"RTN","PSJPAD7U",312,0)
 Q:$G(PSJPUSR)="" ""
"RTN","PSJPAD7U",313,0)
 S PSJDUZ=""
"RTN","PSJPAD7U",314,0)
 S PADUSIEN=$O(^PS(58.64,"C",+$G(PSJPSYS),$G(PSJPUSR),""))
"RTN","PSJPAD7U",315,0)
 ; If user ID PSJPUSR has already been filed for PADE system PSJPSYS, return Vista DUZ if one has been added
"RTN","PSJPAD7U",316,0)
 I $G(PADUSIEN) S PSJDUZ=$P($G(^PS(58.64,PADUSIEN,0)),"^",3) I PSJDUZ Q PSJDUZ
"RTN","PSJPAD7U",317,0)
 ; If user ID PSJPUSR for PADE system PSJPSYS is not on file, add it
"RTN","PSJPAD7U",318,0)
 K FDA,ERR
"RTN","PSJPAD7U",319,0)
 I ($G(PSJPUSR)?1N.15N),$D(^VA(200,PSJPUSR,0)) D
"RTN","PSJPAD7U",320,0)
 .N DBNAMEF,DBNAMEG,HLNAMEF,HLNAMEG,FLEN,GLEN
"RTN","PSJPAD7U",321,0)
 .S DBNAMEF=$P($G(^VA(200,PSJPUSR,0)),"^")
"RTN","PSJPAD7U",322,0)
 .S DBNAMEG=$P(DBNAMEF,",",2),DBNAMEF=$P(DBNAMEF,",")
"RTN","PSJPAD7U",323,0)
 .S HLNAMEF=$P($G(PSJNAME),","),HLNAMEG=$P($G(PSJNAME),",",2)
"RTN","PSJPAD7U",324,0)
 .S FLEN=$L(HLNAMEF),GLEN=$L(HLNAMEG)
"RTN","PSJPAD7U",325,0)
 .Q:$$UPPER^HLFNC($E(DBNAMEF,1,2))'=$$UPPER^HLFNC($E(HLNAMEF,1,2))
"RTN","PSJPAD7U",326,0)
 .S FDA(58.64,"+1,",2)=+PSJPUSR,PSJDUZ=+PSJPUSR
"RTN","PSJPAD7U",327,0)
 ;
"RTN","PSJPAD7U",328,0)
 S FDA(58.64,"+1,",.01)=PSJNAME
"RTN","PSJPAD7U",329,0)
 S FDA(58.64,"+1,",1)=PSJPUSR
"RTN","PSJPAD7U",330,0)
 S FDA(58.64,"+1,",1.1)="`"_PSJPSYS
"RTN","PSJPAD7U",331,0)
 D UPDATE^DIE("E","FDA","","ERR")
"RTN","PSJPAD7U",332,0)
 Q $G(PSJDUZ)
"RTN","PSJPADE")
0^1^B89070355^n/a
"RTN","PSJPADE",1,0)
PSJPADE ;BIR/MHA PADE SYSTEM SET UP ;6/10/15
"RTN","PSJPADE",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**317**;16 DEC 97;Build 130
"RTN","PSJPADE",3,0)
 ;Reference to ^DGPMDDCF supported by DBIA 1246
"RTN","PSJPADE",4,0)
 ;Reference to ^DPT("CN" supported by DBIA 10035
"RTN","PSJPADE",5,0)
 ;Reference to ^SC supported by DBIA 10040
"RTN","PSJPADE",6,0)
 ;Reference to ^DIC(42 supported by DBIA 10039
"RTN","PSJPADE",7,0)
 ;Reference to ^HLMA (#773) supported by DBIA 4738
"RTN","PSJPADE",8,0)
 Q
"RTN","PSJPADE",9,0)
PADE ;enter/edit PADE system setup
"RTN","PSJPADE",10,0)
 W ! N PSJDIV,DA,DR S (DIC,DIE)="^PS(58.7,",DLAYGO=58.7,DIC(0)="AEQL"
"RTN","PSJPADE",11,0)
 I $D(^XUSEC("PSJ PADE ADV",DUZ)) S DIC(0)="AEQ" K DLAYGO
"RTN","PSJPADE",12,0)
 D ^DIC G:"^"[$E(X) PDX G:Y<1 PADE S DA=+Y,DR="[PSJ PADE SYSTEM]" W ! D ^DIE G PADE
"RTN","PSJPADE",13,0)
PDX K DIE,DIC
"RTN","PSJPADE",14,0)
 Q
"RTN","PSJPADE",15,0)
 ;
"RTN","PSJPADE",16,0)
PDSAR ;enter/edit SEND AREA
"RTN","PSJPADE",17,0)
 W ! S (DIC,DIE)=58.71,DLAYGO=58.71,DIC(0)="AEQL" D ^DIC G:"^"[$E(X) PDARX G:Y<1 PDARX S DA=+Y,DR=".01" D ^DIE G PDSAR
"RTN","PSJPADE",18,0)
PDARX K DIE,DIC
"RTN","PSJPADE",19,0)
 Q
"RTN","PSJPADE",20,0)
 ;
"RTN","PSJPADE",21,0)
PDUSR ;PADE division setup
"RTN","PSJPADE",22,0)
 N PSJAP,I,J,K,X,Y S (PSJAP,I)=0
"RTN","PSJPADE",23,0)
 F  S I=$O(^PS(58.7,I)) Q:'I  S J=$$PDACT^PSJPDCLA(I)
"RTN","PSJPADE",24,0)
 I 'PSJAP W !!,"PADE not setup - Quitting..." H 2 Q
"RTN","PSJPADE",25,0)
 S (I,J)=0 F  S I=$O(PSJAP(I)) Q:'I  S J=J+1
"RTN","PSJPADE",26,0)
 I J>1 D  Q:Y<0
"RTN","PSJPADE",27,0)
 .W ! K DIC S DIC("A")="Select PADE: ",DIC=58.7,DIC(0)="AEMQ"
"RTN","PSJPADE",28,0)
 .S DIC("S")="I '$P(^PS(58.7,+Y,0),U,4)&($P(^PS(58.7,+Y,0),U,4)<DT)"
"RTN","PSJPADE",29,0)
 .D ^DIC I Y<0 K DIC Q
"RTN","PSJPADE",30,0)
 .S K=+Y,I=0 F  S I=$O(PSJAP(I)) Q:'I  K:I'=K PSJAP(I)
"RTN","PSJPADE",31,0)
 S Y=$O(PSJAP(0))
"RTN","PSJPADE",32,0)
 W !!,"You are logged under PADE: "_$P($G(^PS(58.7,Y,0)),"^"),!
"RTN","PSJPADE",33,0)
 N PSJDIV S DIE="^PS(58.7,",DA=+Y,DR="[PSJ PADE SYSTEM]"
"RTN","PSJPADE",34,0)
 D ^DIE
"RTN","PSJPADE",35,0)
 K DIE,DIC
"RTN","PSJPADE",36,0)
 Q
"RTN","PSJPADE",37,0)
BDCHK(QZ) ;CHECK IF BED IS OUT-OF-SERVICE
"RTN","PSJPADE",38,0)
 N J S J=X N D0,X S D0=QZ D RIN^DGPMDDCF
"RTN","PSJPADE",39,0)
 I X W !,"BED is marked as OUT-OF-SERVICE",! Q 1
"RTN","PSJPADE",40,0)
 ;CHECK IF BED IS ASSIGNED TO ANOTHER GROUP
"RTN","PSJPADE",41,0)
 S X=J,J=0,J=$O(^PS(58.7,DA(3),"DIV",DA(2),"BG","C",X,J))
"RTN","PSJPADE",42,0)
 Q:'J 0
"RTN","PSJPADE",43,0)
 S J=$G(^PS(58.7,DA(3),"DIV",DA(2),"BG",J,0))
"RTN","PSJPADE",44,0)
 S:J="" J="UNKNOWN"
"RTN","PSJPADE",45,0)
 W !,"Bed is already assigned to group "_J,!
"RTN","PSJPADE",46,0)
 Q 1
"RTN","PSJPADE",47,0)
 ;
"RTN","PSJPADE",48,0)
CLCHK(QZ) ;CHECK IF CLINIC IS DEFINED IN ANOTHER GROUP
"RTN","PSJPADE",49,0)
 I $P(^(0),U,3)'="C" Q 0
"RTN","PSJPADE",50,0)
 I $P(^(0),U,15)'=$S($G(PSJDIV):PSJDIV,1:DA(2)) Q 0
"RTN","PSJPADE",51,0)
 N J S J=$O(^PS(58.7,DA(3),"DIV",DA(2),"PCG","C",QZ,""))
"RTN","PSJPADE",52,0)
 Q:'J 1
"RTN","PSJPADE",53,0)
 S J=$G(^PS(58.7,DA(3),"DIV",DA(2),"PCG",J,0))
"RTN","PSJPADE",54,0)
 S:J="" J="UNKNOWN"
"RTN","PSJPADE",55,0)
 W !,$P(^SC(QZ,0),U)_" Clinic is already assigned to group "_J,!!
"RTN","PSJPADE",56,0)
 Q 0
"RTN","PSJPADE",57,0)
 ;
"RTN","PSJPADE",58,0)
WGSEL(Q) ;CHECK IF ATLEAST ONE WARD IN THIS GROUP BELONGS TO THE SAME DIVISION
"RTN","PSJPADE",59,0)
 N I,J,K S (I,K)=0
"RTN","PSJPADE",60,0)
 I $P(^(0),U,2)="P" D
"RTN","PSJPADE",61,0)
 .F  S I=$O(^PS(57.5,Q,1,I)) Q:'I!(K)  D
"RTN","PSJPADE",62,0)
 .. S J=+^PS(57.5,Q,1,I,0) Q:'J
"RTN","PSJPADE",63,0)
 .. N D0,X S D0=J D WIN^DGPMDDCF Q:X
"RTN","PSJPADE",64,0)
 .. S J=+$P($G(^DIC(42,J,0)),"^",11) Q:'J
"RTN","PSJPADE",65,0)
 .. I J=$S($G(PSJDIV):PSJDIV,1:DA) S K=1
"RTN","PSJPADE",66,0)
 Q K
"RTN","PSJPADE",67,0)
 ;
"RTN","PSJPADE",68,0)
ORSEL() ;CHECK IF OR BELONGS TO THE SAME DIVISION
"RTN","PSJPADE",69,0)
 N FF S FF=0
"RTN","PSJPADE",70,0)
 I $P(^(0),U,15)=$S($G(PSJDIV):PSJDIV,1:DA(1))&($D(^SC("AC","OR",Y))) D
"RTN","PSJPADE",71,0)
 .I '$P($G(^SC(Y,"I")),U)!(+$P($G(^SC(Y,"I")),U)'<DT) S FF=1
"RTN","PSJPADE",72,0)
 Q FF
"RTN","PSJPADE",73,0)
 ;
"RTN","PSJPADE",74,0)
PDORD ;
"RTN","PSJPADE",75,0)
 N PSJAP,PSJCLPD,PSJPDNM,I,J,K,L,X,Y,Z S (PSJAP,I)=0
"RTN","PSJPADE",76,0)
 F  S I=$O(^PS(58.7,I)) Q:'I  S J=$$PDACT^PSJPDCLA(I)
"RTN","PSJPADE",77,0)
 I 'PSJAP W !!,"PADE not setup - Quitting..." H 2 Q
"RTN","PSJPADE",78,0)
SEL ;
"RTN","PSJPADE",79,0)
 D ENCV^PSGSETU
"RTN","PSJPADE",80,0)
 W !
"RTN","PSJPADE",81,0)
 K DIR,DIRUT
"RTN","PSJPADE",82,0)
 K PSJDIV,DIVI,DFN,RXO,PSJHLDFN,PDTYP,ALLC,SCL,SWD,WDN,PDCL,PDWD,NIV
"RTN","PSJPADE",83,0)
 S DIR("?")="^D PDH^PSJPADE",DIR("A")="Select By",DIR("B")=$S($D(SEL):SEL,1:"PT")
"RTN","PSJPADE",84,0)
 S DIR(0)="SMB^PT:PATIENT;WD:WARD;CL:CLINIC;E:EXIT"
"RTN","PSJPADE",85,0)
 D ^DIR K DIR I $D(DIRUT)!(Y="E") K SEL,X,Y Q
"RTN","PSJPADE",86,0)
 S SEL=Y
"RTN","PSJPADE",87,0)
 G:SEL="PT" PT
"RTN","PSJPADE",88,0)
 D:'$G(PSJCLPD) SELPD
"RTN","PSJPADE",89,0)
 G:'$G(PSJCLPD) SEL
"RTN","PSJPADE",90,0)
 W !!,"You are logged under PADE: "_PSJPDNM,!
"RTN","PSJPADE",91,0)
DIV ;
"RTN","PSJPADE",92,0)
 W ! K DIC S DIC=40.8,DIC(0)="AEMQ",DIC("A")="Select DIVISION: " D ^DIC K DIC
"RTN","PSJPADE",93,0)
 G:Y<0 SEL
"RTN","PSJPADE",94,0)
 S PSJDIV=+Y
"RTN","PSJPADE",95,0)
 S DIVI=$G(^PS(58.7,PSJCLPD,"DIV",PSJDIV,0))
"RTN","PSJPADE",96,0)
 I DIVI=""!($P(DIVI,"^",2)&($P(DIVI,"^",2)<DT)) W !,"This division is not setup for this PADE.",! G DIV
"RTN","PSJPADE",97,0)
 I $P($G(^(2)),"^")'="Y" W !,"This division is not setup to send order messages.",! G DIV
"RTN","PSJPADE",98,0)
 W !!,"You are logged under Division: "_$P(Y,"^",2),!!
"RTN","PSJPADE",99,0)
 S NIV=$P(DIVI,"^",7)'="Y"
"RTN","PSJPADE",100,0)
 G:SEL="CL" CL
"RTN","PSJPADE",101,0)
WD ;
"RTN","PSJPADE",102,0)
 I '$O(PDWD(0)) D WDARR
"RTN","PSJPADE",103,0)
 R !,"Select a Ward or ^ALL for all Wards: ",X:DTIME
"RTN","PSJPADE",104,0)
 G:"^"[X SEL
"RTN","PSJPADE",105,0)
 I "^AL"'[$E(X,1,3) G SWD
"RTN","PSJPADE",106,0)
 I '$D(^XUSEC("PSJ PADE MGR",DUZ)) W !!,"You must have the PSJ PADE MGR key to send all orders",! G WD
"RTN","PSJPADE",107,0)
 N CNT,WDCNT,Z11 S Z11=0
"RTN","PSJPADE",108,0)
 F  S Z11=$O(PDWD(Z11)) Q:'Z11  D
"RTN","PSJPADE",109,0)
 . S WDN=$P(^DIC(42,Z11,0),"^")
"RTN","PSJPADE",110,0)
 . I '$D(^DPT("CN",WDN)) W !,"No patient in WARD "_WDN
"RTN","PSJPADE",111,0)
 . E  W !,"Sending ward "_WDN S WDCNT=0 D SDWD W:'$G(WDCNT) !,?2,"No patients with active orders for this ward"
"RTN","PSJPADE",112,0)
 G SEL
"RTN","PSJPADE",113,0)
 ;
"RTN","PSJPADE",114,0)
SWD ;
"RTN","PSJPADE",115,0)
 W ! K SWD,WDN K DIC S DIC="^DIC(42,",DIC(0)="QME"
"RTN","PSJPADE",116,0)
 S DIC("S")="I $P(^(0),U,11)=PSJDIV"
"RTN","PSJPADE",117,0)
 D ^DIC K DIC G:"^"[X SEL G:Y<0 WD
"RTN","PSJPADE",118,0)
 S SWD=+Y,WDN=$P(Y,"^",2)
"RTN","PSJPADE",119,0)
 I '$D(^DPT("CN",WDN)) W !!,"This ward has no patient",! G WD
"RTN","PSJPADE",120,0)
 I '$D(PDWD(SWD)) W !!,"Ward is not setup for this PADE.",! G WD
"RTN","PSJPADE",121,0)
 D SDWD
"RTN","PSJPADE",122,0)
 K SWD,WDN
"RTN","PSJPADE",123,0)
 G WD
"RTN","PSJPADE",124,0)
 ;
"RTN","PSJPADE",125,0)
PDH ;
"RTN","PSJPADE",126,0)
 W !!,"Enter 'PT' to send orders by Patient"
"RTN","PSJPADE",127,0)
 W !,"      'WD' to send orders by Ward"
"RTN","PSJPADE",128,0)
 W !,"      'CL' to send orders by Clinic"
"RTN","PSJPADE",129,0)
 W !,"   or 'E' or '^' to exit" W !
"RTN","PSJPADE",130,0)
 Q
"RTN","PSJPADE",131,0)
 ;
"RTN","PSJPADE",132,0)
SELPD ;
"RTN","PSJPADE",133,0)
 S (I,J)=0 F  S I=$O(PSJAP(I)) Q:'I  S J=J+1
"RTN","PSJPADE",134,0)
 I J>1 D  Q:$D(DTOUT)!($D(DUOUT))  I X="" W !,"You must select a PADE" G SELPD
"RTN","PSJPADE",135,0)
 .W ! S DIC("A")="Select PADE: ",DIC=58.7,DIC(0)="AEMQ"
"RTN","PSJPADE",136,0)
 .S DIC("S")="I '$P(^PS(58.7,+Y,0),U,4)&($P(^PS(58.7,+Y,0),U,4)<DT)"
"RTN","PSJPADE",137,0)
 .D ^DIC K DIC Q:Y<0
"RTN","PSJPADE",138,0)
 .S PSJCLPD=+Y,I=0 F  S I=$O(PSJAP(I)) Q:'I  K:I'=PSJCLPD PSJAP(I)
"RTN","PSJPADE",139,0)
 S PSJCLPD=$O(PSJAP(0)),PSJPDNM=$P($G(^PS(58.7,PSJCLPD,0)),"^")
"RTN","PSJPADE",140,0)
 Q
"RTN","PSJPADE",141,0)
PT ;
"RTN","PSJPADE",142,0)
 K DFN
"RTN","PSJPADE",143,0)
 D ENDPT^PSJP
"RTN","PSJPADE",144,0)
 G:'$G(DFN) SEL
"RTN","PSJPADE",145,0)
 D GETPTO
"RTN","PSJPADE",146,0)
 K DFN G PT
"RTN","PSJPADE",147,0)
 ;
"RTN","PSJPADE",148,0)
GETPTO ;
"RTN","PSJPADE",149,0)
 K ^TMP("PS",$J) S CNT=0 N PTN
"RTN","PSJPADE",150,0)
 D OCL1^PSJORRE(DFN,"","",0)
"RTN","PSJPADE",151,0)
 S PTN=$P($G(^DPT(DFN,0)),"^")_" ("_$E($P($G(^DPT(DFN,0)),"^",9),6,9)_")"
"RTN","PSJPADE",152,0)
 I '$D(^TMP("PS",$J)) W:SEL="PT" !,"No Orders found for "_PTN,! Q
"RTN","PSJPADE",153,0)
 S I=0 S I=$O(^TMP("PS",$J,I)) I 'I W:SEL="PT" !,"No Orders found for "_PTN,! Q
"RTN","PSJPADE",154,0)
 N PDO,FP S I=0
"RTN","PSJPADE",155,0)
 F  S I=$O(^TMP("PS",$J,I)) Q:'I  D
"RTN","PSJPADE",156,0)
 .S J=^TMP("PS",$J,I,0),FP=$P(J,"^")
"RTN","PSJPADE",157,0)
 .I (FP["U"!(FP["V")&($P(J,"^",9)="ACTIVE")) S PDO($P(FP,";"))="",CNT=CNT+1,WDCNT=1
"RTN","PSJPADE",158,0)
 I '$O(PDO("")) W:SEL="PT" !,"No active IV/UD Orders found for "_PTN,! Q
"RTN","PSJPADE",159,0)
 W !,?2,CNT_" Order(s) Queued for "_PTN,!
"RTN","PSJPADE",160,0)
 S PDTYP="SN",PSJHLDFN=DFN
"RTN","PSJPADE",161,0)
 S RXO=0 F  S RXO=$O(PDO(RXO)) Q:'RXO  D
"RTN","PSJPADE",162,0)
 .D PDORD^PSJPDCLU
"RTN","PSJPADE",163,0)
 Q
"RTN","PSJPADE",164,0)
 ;
"RTN","PSJPADE",165,0)
CL ;
"RTN","PSJPADE",166,0)
 N ALL44 S ALL44=$P(DIVI,"^",3)="Y"
"RTN","PSJPADE",167,0)
 I '$O(PDCL(0)) I 'ALL44 D CLARR
"RTN","PSJPADE",168,0)
 K ALLC
"RTN","PSJPADE",169,0)
 R !,"Select a Clinic or ^ALL for all Clinics: ",X:DTIME
"RTN","PSJPADE",170,0)
 G:"^"[X SEL
"RTN","PSJPADE",171,0)
 I "^AL"'[$E(X,1,3) G SCL
"RTN","PSJPADE",172,0)
 I '$D(^XUSEC("PSJ PADE MGR",DUZ)) W !!,"You must have the PSJ PADE MGR key to send all orders",! G CL
"RTN","PSJPADE",173,0)
 S ALLC=1 D SDCL
"RTN","PSJPADE",174,0)
 G SEL
"RTN","PSJPADE",175,0)
 ;
"RTN","PSJPADE",176,0)
SCL ;
"RTN","PSJPADE",177,0)
 W ! K SCL K DIC S DIC="^SC(",DIC(0)="QME"
"RTN","PSJPADE",178,0)
 S DIC("S")="I $P(^(0),U,3)=""C"",$P(^(0),U,15)=PSJDIV"
"RTN","PSJPADE",179,0)
 D ^DIC K DIC G:"^"[X SEL G:Y<0 CL
"RTN","PSJPADE",180,0)
 S SCL=+Y
"RTN","PSJPADE",181,0)
 I '$D(PDCL(SCL)),'ALL44 W !!,"Clinic is not setup for this PADE.",! G CL
"RTN","PSJPADE",182,0)
 D SDCL
"RTN","PSJPADE",183,0)
 K SCL
"RTN","PSJPADE",184,0)
 G CL
"RTN","PSJPADE",185,0)
 ;
"RTN","PSJPADE",186,0)
SDCL ;
"RTN","PSJPADE",187,0)
 W !,"Orders Queued to be sent to PADE",!
"RTN","PSJPADE",188,0)
 N BDT S BDT=DT_".000001"
"RTN","PSJPADE",189,0)
 F  S BDT=$O(^PS(55,"AUD",BDT)) Q:'BDT  D
"RTN","PSJPADE",190,0)
 .S DFN=0 F  S DFN=$O(^PS(55,"AUD",BDT,DFN)) Q:'DFN  D
"RTN","PSJPADE",191,0)
 .. S I=0 F  S I=$O(^PS(55,"AUD",BDT,DFN,I)) Q:'I  D
"RTN","PSJPADE",192,0)
 ... S J=$G(^PS(55,DFN,5,I,0)) Q:$P(J,"^",9)'="A"
"RTN","PSJPADE",193,0)
 ... S K=$G(^(8)) Q:'$P(K,"^",2)  S K=+K Q:'K
"RTN","PSJPADE",194,0)
 ... I $G(SCL),K=$G(SCL) D SDO Q
"RTN","PSJPADE",195,0)
 ... I $G(ALLC),$D(PDCL),$D(PDCL(K)) D SDO Q
"RTN","PSJPADE",196,0)
 ... I $G(ALLC),ALL44,$P(^SC(K,0),U,15)=PSJDIV D SDO Q
"RTN","PSJPADE",197,0)
 Q:NIV
"RTN","PSJPADE",198,0)
SDCIV ;
"RTN","PSJPADE",199,0)
 S L="V",BDT=DT_".000001"
"RTN","PSJPADE",200,0)
 F  S BDT=$O(^PS(55,"AIV",BDT)) Q:'BDT  D
"RTN","PSJPADE",201,0)
 .S DFN=0 F  S DFN=$O(^PS(55,"AIV",BDT,DFN)) Q:'DFN  D
"RTN","PSJPADE",202,0)
 .. S I=0 F  S I=$O(^PS(55,"AIV",BDT,DFN,I)) Q:'I  D
"RTN","PSJPADE",203,0)
 ... S J=$G(^PS(55,DFN,"IV",I,0)) Q:$P(J,"^",17)'="A"
"RTN","PSJPADE",204,0)
 ... S K=+$G(^("DSS")) Q:'K
"RTN","PSJPADE",205,0)
 ... I $G(SCL),K=$G(SCL) D SDO Q
"RTN","PSJPADE",206,0)
 ... I $G(ALLC),$D(PDCL),$D(PDCL(K)) D SDO Q
"RTN","PSJPADE",207,0)
 ... I $G(ALLC),ALL44,$P(^SC(K,0),U,15)=PSJDIV D SDO Q
"RTN","PSJPADE",208,0)
 Q 
"RTN","PSJPADE",209,0)
 ;
"RTN","PSJPADE",210,0)
SDO ;
"RTN","PSJPADE",211,0)
 S RXO=I_$S($G(L)="V":L,1:"U"),PDTYP="SN",PSJHLDFN=DFN
"RTN","PSJPADE",212,0)
 D PDORD^PSJPDCLU
"RTN","PSJPADE",213,0)
 Q
"RTN","PSJPADE",214,0)
 ;
"RTN","PSJPADE",215,0)
CLARR ;
"RTN","PSJPADE",216,0)
 N Z S I=0
"RTN","PSJPADE",217,0)
 F  S I=$O(^PS(58.7,PSJCLPD,"DIV",PSJDIV,"CL",I)) Q:'I  S PDCL(+^(I,0))=""
"RTN","PSJPADE",218,0)
 S I=0
"RTN","PSJPADE",219,0)
 F  S I=$O(^PS(58.7,PSJCLPD,"DIV",PSJDIV,"PCG",I)) Q:'I  D
"RTN","PSJPADE",220,0)
 . S J=0 F  S J=$O(^PS(58.7,PSJCLPD,"DIV",PSJDIV,"PCG",I,1,J)) Q:'J  D
"RTN","PSJPADE",221,0)
 .. S K=^(J,0) I '$D(PDCL(K)) S PDCL(K)=""
"RTN","PSJPADE",222,0)
 S I=0
"RTN","PSJPADE",223,0)
 F  S I=$O(^PS(58.7,PSJCLPD,"DIV",PSJDIV,"VCG",I)) Q:'I  S J=^(I,0) D
"RTN","PSJPADE",224,0)
 . S Z=0 F  S Z=$O(^PS(57.8,+J,1,Z)) Q:'Z  D
"RTN","PSJPADE",225,0)
 .. S K=^(Z,0) I '$D(PDCL(K)) S PDCL(K)=""
"RTN","PSJPADE",226,0)
 S I=0,L=""
"RTN","PSJPADE",227,0)
 F  S I=$O(^PS(58.7,PSJCLPD,"DIV",PSJDIV,"WCN",I)) Q:'I  S J=^(I,0) D
"RTN","PSJPADE",228,0)
 . S (Y,Z)=$P(J,"^") F  S Z=$O(^SC("B",Z)) Q:Z=""!($E(Z,1,$L(Y))'=Y)  D
"RTN","PSJPADE",229,0)
 .. S K=$O(^SC("B",Z,0)),L=$G(^SC(K,0)) Q:$P(L,"^",3)'="C"  Q:$P(L,"^",15)'=PSJDIV  D
"RTN","PSJPADE",230,0)
 ... I '$D(PDCL(K)) S PDCL(K)=""
"RTN","PSJPADE",231,0)
 Q
"RTN","PSJPADE",232,0)
 ;
"RTN","PSJPADE",233,0)
WDARR ;
"RTN","PSJPADE",234,0)
 S I=0
"RTN","PSJPADE",235,0)
 F  S I=$O(^PS(58.7,PSJCLPD,"DIV",PSJDIV,"WD","B",I)) Q:'I  S PDWD(I)=""
"RTN","PSJPADE",236,0)
 S I=0
"RTN","PSJPADE",237,0)
 F  S I=$O(^PS(58.7,PSJCLPD,"DIV",PSJDIV,"WG","B",I)) Q:'I  D
"RTN","PSJPADE",238,0)
 . S J=0 F  S J=$O(^PS(57.5,I,1,J)) Q:'J  S K=(+^(J,0)) S:'$D(PDWD(K)) PDWD(K)=""
"RTN","PSJPADE",239,0)
 Q
"RTN","PSJPADE",240,0)
 ;
"RTN","PSJPADE",241,0)
SDWD ;
"RTN","PSJPADE",242,0)
 S DFN=0 F  S DFN=$O(^DPT("CN",WDN,DFN)) Q:'DFN  D
"RTN","PSJPADE",243,0)
 .D GETPTO
"RTN","PSJPADE",244,0)
 Q
"RTN","PSJPADE",245,0)
 ;
"RTN","PSJPADE",246,0)
LOG ;
"RTN","PSJPADE",247,0)
 Q:'$O(PDL(0))
"RTN","PSJPADE",248,0)
 N HLI
"RTN","PSJPADE",249,0)
 I PSJSND>0 S PDL(3)=+PSJSND D
"RTN","PSJPADE",250,0)
 .S HLI=$$FIND1^DIC(773,,"X",+PSJSND,"C")
"RTN","PSJPADE",251,0)
 .S HLI=$$GET1^DIQ(773,HLI,.01,"I") S:HLI PDL(17)=HLI
"RTN","PSJPADE",252,0)
 S:+PSJSND<1 PDL(13)=$P(PSJSND,"^",3)
"RTN","PSJPADE",253,0)
 S DR="",LI=0
"RTN","PSJPADE",254,0)
 F  S LI=$O(PDL(LI)) Q:'LI  S DR=DR_LI_"////"_PDL(LI)_";"
"RTN","PSJPADE",255,0)
 K DD,DO,DIC
"RTN","PSJPADE",256,0)
 D NOW^%DTC S DIC="^PS(58.72,",X=%,DIC(0)="",DIC("DR")=DR
"RTN","PSJPADE",257,0)
 D FILE^DICN K DD,DO,Y,DIC,PDL
"RTN","PSJPADE",258,0)
 Q
"RTN","PSJPADE",259,0)
 ;
"RTN","PSJPADE",260,0)
RXC ;
"RTN","PSJPADE",261,0)
 N PSJDD,PSJDU,RXC,DOS,NDF
"RTN","PSJPADE",262,0)
 S I=0 F  S I=$O(PS55(1,I)) Q:'I  D
"RTN","PSJPADE",263,0)
 .S PSJDD=$P(PS55(1,I,0),"^"),PSJDU=$P(PS55(1,I,0),"^",2)
"RTN","PSJPADE",264,0)
 .I $P(PS55(1,I,0),"^",3),$P(PS55(1,I,0),"^",3)'>DT Q
"RTN","PSJPADE",265,0)
 .S SEG="RXC"_NFS_"A"
"RTN","PSJPADE",266,0)
 .S $P(SEG,NFS,3)=PSJDD_NECH_$P($G(^PSDRUG(PSJDD,0)),"^")_NECH_"99PSD"
"RTN","PSJPADE",267,0)
 .S DOS=$G(^PSDRUG(PSJDD,"DOS")),NDF=$G(^("ND"))
"RTN","PSJPADE",268,0)
 .D:$P(DOS,"^")
"RTN","PSJPADE",269,0)
 .. S $P(SEG,NFS,4)=$P(DOS,"^")*PSJDU_NFS_NECH_$P($G(^PS(50.607,$P(DOS,"^",2),0)),"^")
"RTN","PSJPADE",270,0)
 .. S $P(SEG,NFS,6)=$P(DOS,"^")_NFS_NECH_$P($G(^PS(50.607,$P(DOS,"^",2),0)),"^")
"RTN","PSJPADE",271,0)
 .I $P(DOS,"^")="",$P(NDF,"^",3) D
"RTN","PSJPADE",272,0)
 .. S DOS=$P($$DFSU^PSNAPIS("",$P(NDF,"^",3)),"^",4,6)
"RTN","PSJPADE",273,0)
 .. D:DOS
"RTN","PSJPADE",274,0)
 ... S $P(SEG,NFS,4)=+DOS*PSJDU_NFS_NECH_$P(DOS,"^",3)
"RTN","PSJPADE",275,0)
 ... S $P(SEG,NFS,6)=$P(DOS,"^")_NFS_NECH_$P(DOS,"^",3)
"RTN","PSJPADE",276,0)
 .S SEQ=SEQ+1
"RTN","PSJPADE",277,0)
 .S NSEG(SEQ)=SEG
"RTN","PSJPADE",278,0)
 .D:$D(^XTMP("PADE")) DISP^PSJPDCLU
"RTN","PSJPADE",279,0)
 Q
"RTN","PSJPADE",280,0)
 ;
"RTN","PSJPADIT")
0^2^B218833371^n/a
"RTN","PSJPADIT",1,0)
PSJPADIT ;BIR/JCH-INPATIENT PADE INVENTORY FILE UTILITIES ;25 SEP 97 / 7:41 AM
"RTN","PSJPADIT",2,0)
 ;;5.0;INPATIENT MEDICATIONS ;**317**;16 DEC 97;Build 130
"RTN","PSJPADIT",3,0)
 ;
"RTN","PSJPADIT",4,0)
 ; Reference to ^XLFDT is supported by DBIA 10103.
"RTN","PSJPADIT",5,0)
 ; Reference to ^PSDRUG is supported by DBIA 2192.
"RTN","PSJPADIT",6,0)
 ;
"RTN","PSJPADIT",7,0)
FIL58601(PADATA,PSJOMS) ; File PADE data into PADE INVENTORY file #58.601
"RTN","PSJPADIT",8,0)
 ; PADE HL7 messages filed into the PADE IN TRANSACTION (#58.6) trigger new-style 'AC' action cross reference, entering here.
"RTN","PSJPADIT",9,0)
 ;
"RTN","PSJPADIT",10,0)
 ;INPUT:PADATA array - Passed in X(n) array from ACTION cross reference on PADE INBOUND TRANSACTIONS (#58.6) file.
"RTN","PSJPADIT",11,0)
 ;        Array Node   File#   Field#    Field Name              Description
"RTN","PSJPADIT",12,0)
 ;        ----------   ------  ------    ------------------      -------------   
"RTN","PSJPADIT",13,0)
 ;        PADATA(1)   58.6       1.1    PADE VENDOR             IEN of PADE system from file 58.7
"RTN","PSJPADIT",14,0)
 ;        PADATA(2)   58.6         1    DISPENSING DEVICE       Name (text) of PADE DEVICE
"RTN","PSJPADIT",15,0)
 ;        PADATA(3)   58.6       1.2    DRAWER                  Name (text) of PADE DRAWER
"RTN","PSJPADIT",16,0)
 ;        PADATA(4)   58.6         2    DRUG                    Pointer to DRUG (#50) file.
"RTN","PSJPADIT",17,0)
 ;        PADATA(5)   58.6         4    TYPE OF TRANSACTION     Set of codes describing transaction (L=LOAD,U=UNLOAD,D=DISPENSE,R=RETURN,X=DESTROY).
"RTN","PSJPADIT",18,0)
 ;        PADATA(6)   58.6         3    QUANTITY                Quantity (item count) of drugs documented in transaction.
"RTN","PSJPADIT",19,0)
 ;        PADATA(7)   58.6        10    POCKET                  Most specific storage location within drawer or subdrawer.
"RTN","PSJPADIT",20,0)
 ;        PADATA(8)   58.6        13    ACTUAL BEGIN BALANCE    Actual item count performed at PADE device prior to transaction.
"RTN","PSJPADIT",21,0)
 ;        PADATA(9)   58.6       .01    TRANSACTION DATE/TIME   Date/Time the activity occurred at the dispensing device
"RTN","PSJPADIT",22,0)
 ;        PADATA(10)  58.6        11    SUBDRAWER               Another storage division of a cabinet
"RTN","PSJPADIT",23,0)
 ;        PADATA(12)  58.6        12    EXPECTED BEGIN COUNT    Expected Quantity of Drug in Bin/Pocket at start of transaction
"RTN","PSJPADIT",24,0)
 ;        PADATA(16)  58.6        16    POCKET BALANCE          Item count of pocket/bin
"RTN","PSJPADIT",25,0)
 ;
"RTN","PSJPADIT",26,0)
 ;INPUT:PSJOMS array - Additional PADE HL7 information
"RTN","PSJPADIT",27,0)
 ;        PSJOMS("DRGITM") - Drug ID
"RTN","PSJPADIT",28,0)
 ;        PSJOMS("CABID")  - PADE Cabinet ID
"RTN","PSJPADIT",29,0)
 ;        PSJOMS("DISPSYS")- PADE System
"RTN","PSJPADIT",30,0)
 ;
"RTN","PSJPADIT",31,0)
 N ERRMSG,PADNOW,PSJNOTE
"RTN","PSJPADIT",32,0)
 Q:'$D(PADATA)>1          ; No data passed in
"RTN","PSJPADIT",33,0)
 ; Don't allow future Last Pocket Update date/times (could suppress actual updates)
"RTN","PSJPADIT",34,0)
 S PADNOW=$$NOW^XLFDT()
"RTN","PSJPADIT",35,0)
 I $G(PADATA(9))>PADNOW S PADATA(9)=PADNOW
"RTN","PSJPADIT",36,0)
 ;
"RTN","PSJPADIT",37,0)
 N INVDATA  ; Array to hold data returned from GETS^DIQ calls (re-initialized and re-used)
"RTN","PSJPADIT",38,0)
 N ERR      ; Array to hold messages returned from DIE and DIC calls. (re-initialized and re-used).
"RTN","PSJPADIT",39,0)
 N FDA      ; Array containing the name of the root of a VA FileMan Data Array
"RTN","PSJPADIT",40,0)
 ;
"RTN","PSJPADIT",41,0)
 N PS586IEN S PS586IEN=+$G(DA) I PS586IEN I $P($G(^PS(58.6,PS586IEN,3)),"^")]"" S $P(^PS(58.6,PS586IEN,3),"^")="I"
"RTN","PSJPADIT",42,0)
 S PSJNOTE=$$UPPER^HLFNC($G(^PS(58.6,+$G(PS586IEN),2)))
"RTN","PSJPADIT",43,0)
 I PSJNOTE["CANCEL" Q   ; Cancel Inventory Update if comments contain 'CANCEL'
"RTN","PSJPADIT",44,0)
 S PADATA(12)=$P($G(^PS(58.6,+$G(PS586IEN),0)),"^",13)
"RTN","PSJPADIT",45,0)
 S PADATA(16)=$P($G(^PS(58.6,+$G(PS586IEN),1)),"^",2)
"RTN","PSJPADIT",46,0)
 Q:$E($G(PADATA(5)))="W"&(PSJNOTE'["RETURN BIN")  ; Waste Transaction should not update inventory, unless RETURN BIN
"RTN","PSJPADIT",47,0)
 ;
"RTN","PSJPADIT",48,0)
 ; Quit if this transaction is older than the most recent update date/time for the pocket-drug
"RTN","PSJPADIT",49,0)
 N TMPARRAY M PSTMPAR=PADATA
"RTN","PSJPADIT",50,0)
 I $$OLDPKUP^PSJPAD70(.PSTMPAR,.ERR,PS586IEN) D LOGERR(.ERR) Q
"RTN","PSJPADIT",51,0)
 K PSTMPAR
"RTN","PSJPADIT",52,0)
 ;
"RTN","PSJPADIT",53,0)
 ; File PADE System from PADE INBOUND TRANSACTION file to PADE INVENTORY file
"RTN","PSJPADIT",54,0)
 I '$$FILSYS(.PADATA,.ERR) S ERR="CANNOT FILE SYSTEM "_ERR D LOGERR(.ERR) Q
"RTN","PSJPADIT",55,0)
 ;
"RTN","PSJPADIT",56,0)
 ; File PADE Device from PADE INBOUND TRANSACTION file to PADE INVENTORY file
"RTN","PSJPADIT",57,0)
 I '$$FILDEV(.PADATA,.ERR) S ERR="PADE DEVICE NOT UPDATED "_ERR D LOGERR(.ERR) Q
"RTN","PSJPADIT",58,0)
 ;
"RTN","PSJPADIT",59,0)
 I ($TR(PADATA(3),"~")="")&($TR(PADATA(7),"~")="") Q   ; No drawer, no pocket = no inventory update
"RTN","PSJPADIT",60,0)
 ;
"RTN","PSJPADIT",61,0)
 ; Add PADE Drawer from PADE INBOUND TRANSACTION file to PADE System Dispensing Device in PADE INVENTORY file
"RTN","PSJPADIT",62,0)
 I '$$FILDRWR(.PADATA,.ERR) S ERR="DRAWER NOT UPDATED "_ERR D LOGERR(.ERR) Q
"RTN","PSJPADIT",63,0)
 ;
"RTN","PSJPADIT",64,0)
 ; Add drug from PADE INBOUND TRANSACTION file to PADE System Dispensing Device in PADE INVENTORY file.
"RTN","PSJPADIT",65,0)
 I '$$FILDRUG(.PADATA,.ERR) S ERR="DRUG/DEVICE NOT UPDATED "_ERR D  Q
"RTN","PSJPADIT",66,0)
 .Q:'$G(PADATA(4))  ; Consider drug 'NOT ON FILE' only if a valid VistA IEN (all numeric). Otherwise, the ID was never intended for VistA.
"RTN","PSJPADIT",67,0)
 .I $L($G(PSJOMS("DRGITM"))) Q:PSJOMS("DRGITM")'?1.N
"RTN","PSJPADIT",68,0)
 .S:$L($G(PSJOMS("CABID"))) ERR=ERR_":CABINET="_PSJOMS("CABID")
"RTN","PSJPADIT",69,0)
 .S:$L($G(PSJOMS("DISPSYS"))) ERR=ERR_":SYSTEM="_PSJOMS("DISPSYS")
"RTN","PSJPADIT",70,0)
 .D LOGERR(.ERR) Q
"RTN","PSJPADIT",71,0)
 ;
"RTN","PSJPADIT",72,0)
 ; Add drug from PADE INBOUND TRANSACTION file to Drug sub-file in Drawer multiple of PADE INVENTORY file
"RTN","PSJPADIT",73,0)
 I '$$DRGDRWR(.PADATA,.ERR) S ERR="DRUG/DRAWER NOT UPDATED "_ERR D LOGERR(.ERR) Q
"RTN","PSJPADIT",74,0)
 ;
"RTN","PSJPADIT",75,0)
 ; Add Pocket sub-file entry to Drawer multiple in PADE INVENTORY file
"RTN","PSJPADIT",76,0)
 I '$$UPCKDRW(.PADATA,.ERR) S ERR="POCKET NOT UPDATED "_ERR D LOGERR(.ERR) Q
"RTN","PSJPADIT",77,0)
 ;
"RTN","PSJPADIT",78,0)
 ; Update Pocket balance
"RTN","PSJPADIT",79,0)
 I '$$UPCKBAL(.PADATA,.ERR) S ERR="POCKET BALANCE NOT UPDATED "_ERR D LOGERR(.ERR)
"RTN","PSJPADIT",80,0)
 ; Update Drug (Drawer) balance in PADE INVENTORY file
"RTN","PSJPADIT",81,0)
 I '$$UPDRWBAL(.PADATA,.ERR) S ERR="DRUG/DRAWER BALANCE NOT UPDATED "_ERR D LOGERR(.ERR)
"RTN","PSJPADIT",82,0)
 ;
"RTN","PSJPADIT",83,0)
 I '($G(PSJNOTE)["PATIENT SPECIFIC BIN")&'($G(PSJNOTE)["RETURN BIN") D
"RTN","PSJPADIT",84,0)
 .; Update Drug (Device) balance in PADE INVENTORY file
"RTN","PSJPADIT",85,0)
 .I '$$UPDEVBAL(.PADATA,.ERR) S ERR="DRUG/DEVICE BALANCE NOT UPDATED "_ERR D LOGERR(.ERR)
"RTN","PSJPADIT",86,0)
 ;
"RTN","PSJPADIT",87,0)
 ; Delete (Unload) drug from device
"RTN","PSJPADIT",88,0)
 I $$DELCHK(.PADATA) D
"RTN","PSJPADIT",89,0)
 .N SYS,DEV,DRW,DRGDEV,DRG,PCK
"RTN","PSJPADIT",90,0)
 .S SYS=$G(PADATA("SYS IEN"))          ; IEN of system in file 58.601
"RTN","PSJPADIT",91,0)
 .S DEV=$G(PADATA("DEVICE IEN"))       ; IEN of device from subfile 58.6011
"RTN","PSJPADIT",92,0)
 .S DRW=$G(PADATA("DRAWER IEN"))       ; IEN of drawer from subfile 58.60112
"RTN","PSJPADIT",93,0)
 .S DRGDEV=$G(PADATA("DRUG DEV IEN"))  ; IEN of drug (device) from subfile 58.60111
"RTN","PSJPADIT",94,0)
 .S DRG=$G(PADATA("DRUG IEN"))         ; IEN of drug (drawer) from subfile 58.601121
"RTN","PSJPADIT",95,0)
 .S PCK=$G(PADATA("POCK/SUB IEN"))     ; IEN of pocket/subdrawer from subfile 58.601122
"RTN","PSJPADIT",96,0)
 .D UNLOAD^PSJPAD70(SYS,DEV,DRW,DRG,DRGDEV,PCK)
"RTN","PSJPADIT",97,0)
 ;
"RTN","PSJPADIT",98,0)
 ; Transaction processing complete
"RTN","PSJPADIT",99,0)
 I $G(PS586IEN) I $P($G(^PS(58.6,PS586IEN,3)),"^")]"" S $P(^PS(58.6,PS586IEN,3),"^")="C"
"RTN","PSJPADIT",100,0)
 Q
"RTN","PSJPADIT",101,0)
 ;
"RTN","PSJPADIT",102,0)
DELCHK(PADATA) ; Check if incoming transaction represents a drug removed from the device
"RTN","PSJPADIT",103,0)
 N PSJTTRAN
"RTN","PSJPADIT",104,0)
 S PSJTTRAN=$G(PADATA(5)) I PSJTTRAN="U"!(PSJTTRAN="B") Q 1
"RTN","PSJPADIT",105,0)
 Q 0
"RTN","PSJPADIT",106,0)
 ;
"RTN","PSJPADIT",107,0)
FILSYS(PADATA,ERRMSG) ; Check for PADE Inbound System in PADE INVENTORY file
"RTN","PSJPADIT",108,0)
 S PADATA("SYS IEN")=$$FIND1^DIC(58.601,"","MXQ",$G(PADATA(1)),,,"ERR")
"RTN","PSJPADIT",109,0)
 I '$G(PADATA("SYS IEN")) S ERRMSG="UNABLE TO FIND PADE SYSTEM "_PADATA(1) Q 0
"RTN","PSJPADIT",110,0)
 Q 1
"RTN","PSJPADIT",111,0)
 ;
"RTN","PSJPADIT",112,0)
FILEDEV(XARRAY) ; File device from PADE DISPENSING DEVICE (#58.63) file
"RTN","PSJPADIT",113,0)
 N PADATA0
"RTN","PSJPADIT",114,0)
 I $G(XARRAY(2)) S PADATA("SYS IEN")=XARRAY(2)
"RTN","PSJPADIT",115,0)
 I '$G(XARRAY(2)),$G(XARRAY("SYS IEN"))]"" S PADATA(2)=$P($G(^PS(58.601,+XARRAY("SYS IEN"),0)),"^")
"RTN","PSJPADIT",116,0)
 I $G(XARRAY(1))]"" S PADATA(2)=XARRAY(1)
"RTN","PSJPADIT",117,0)
 D FILDEV(.PADATA)
"RTN","PSJPADIT",118,0)
 Q
"RTN","PSJPADIT",119,0)
FILDEV(PADATA,ERRMSG) ; File PADE DEVICE to PADE INVENTORY file
"RTN","PSJPADIT",120,0)
 N FDA,PSJPSYS,PSJSCR,PSJSCR
"RTN","PSJPADIT",121,0)
 I '($G(PADATA(2))]"") S ERRMSG="MISSING PADE DEVICE" Q 0
"RTN","PSJPADIT",122,0)
 I $G(PSJPSYS),$G(^PS(58.601,+PSJPSYS,0))]"" S PADATA("SYS IEN")=PSJPSYS
"RTN","PSJPADIT",123,0)
 S PSJPSYS=PADATA("SYS IEN"),PSJSCR="I $S('$G(PSJPSYS):1,1:PSJPSYS=$P(^(0),U,2))"
"RTN","PSJPADIT",124,0)
 I ($G(PADATA(1))=""&$G(PSJPSYS)) S PADATA(1)=$P(^PS(58.601,PSJPSYS,0),"^")
"RTN","PSJPADIT",125,0)
 S PADATA("DEVICE IEN")=$$FIND1^DIC(58.63,,"MX",PADATA(2),,PSJSCR,"ERR")
"RTN","PSJPADIT",126,0)
 I '$G(PADATA("DEVICE IEN")) D
"RTN","PSJPADIT",127,0)
 .N FDA S FDA(58.63,"?+1,",.01)=PADATA(2)
"RTN","PSJPADIT",128,0)
 .S FDA(58.63,"?+1,",1)=PADATA(1)
"RTN","PSJPADIT",129,0)
 .S FDA(58.63,"?+1,",12)=$$UPPER^PSJPDRUT(PADATA(2))
"RTN","PSJPADIT",130,0)
 .D UPDATE^DIE("E","FDA","","ERR")
"RTN","PSJPADIT",131,0)
 .S PADATA("DEVICE IEN")=$$FIND1^DIC(58.63,,"MX",PADATA(2),,PSJSCR,"ERR")
"RTN","PSJPADIT",132,0)
 I $G(PADATA("DEVICE IEN")) D
"RTN","PSJPADIT",133,0)
 .N FDA S FDA(58.6011,"?+1,"_PADATA("SYS IEN")_",",.01)=PADATA(2) D UPDATE^DIE("E","FDA","","ERR")
"RTN","PSJPADIT",134,0)
 .S PADATA("DEVICE IEN")=$$FIND1^DIC(58.6011,","_PADATA("SYS IEN")_",","MX",PADATA(2),,,"ERR")
"RTN","PSJPADIT",135,0)
 I '$G(PADATA("DEVICE IEN")) S ERRMSG="Unable to file PADE Device "_PADATA(2) Q 0
"RTN","PSJPADIT",136,0)
 Q 1
"RTN","PSJPADIT",137,0)
 ;
"RTN","PSJPADIT",138,0)
FILDRWR(PADATA,ERRMSG) ; Add PADE Drawer to PADE System's DISPENSING DEVICE in PADE INVENTORY file
"RTN","PSJPADIT",139,0)
 I $G(PADATA(3))="" S PADATA(3)="zz"
"RTN","PSJPADIT",140,0)
 S PADATA("DRAWER IEN")=$$FIND1^DIC(58.60112,","_PADATA("DEVICE IEN")_","_PADATA("SYS IEN")_",","MX",PADATA(3),,,"ERR")
"RTN","PSJPADIT",141,0)
 I '$G(PADATA("DRAWER IEN")) D
"RTN","PSJPADIT",142,0)
 .K FDA,ERR S FDA(58.60112,"?+1,"_+PADATA("DEVICE IEN")_","_+PADATA("SYS IEN")_",",.01)=PADATA(3) D UPDATE^DIE("E","FDA","","ERR")
"RTN","PSJPADIT",143,0)
 .S PADATA("DRAWER IEN")=$$FIND1^DIC(58.60112,","_PADATA("DEVICE IEN")_","_PADATA("SYS IEN")_",","MX",PADATA(3),,,"ERR")
"RTN","PSJPADIT",144,0)
 I '$G(PADATA("DRAWER IEN")) S ERRMSG="Unable to file PADE drawer"_PADATA(3) Q 0
"RTN","PSJPADIT",145,0)
 Q 1
"RTN","PSJPADIT",146,0)
 ;
"RTN","PSJPADIT",147,0)
FILDRUG(PADATA,ERRMSG)  ; Add drug from PADE INBOUND TRANSACTION file to PADE System Dispensing Device in PADE INVENTORY file
"RTN","PSJPADIT",148,0)
 N DRUG,DEVIEN,SYSIEN
"RTN","PSJPADIT",149,0)
 S DRUG=$G(PADATA(4))                          ; Drug
"RTN","PSJPADIT",150,0)
 S DEVIEN=$G(PADATA("DEVICE IEN"))             ; Dispensing Device IEN
"RTN","PSJPADIT",151,0)
 S SYSIEN=$G(PADATA("SYS IEN"))                ; PADE System IEN
"RTN","PSJPADIT",152,0)
 I '(DRUG]"") S ERRMSG="MISSING DRUG" Q 0      ; No drug, no go
"RTN","PSJPADIT",153,0)
 ;
"RTN","PSJPADIT",154,0)
 I '$D(^PSDRUG(+DRUG,0)) D  Q 0
"RTN","PSJPADIT",155,0)
 .N DRGNAME,DRGID,DRGNODE
"RTN","PSJPADIT",156,0)
 .S DRGNODE=$G(^PS(58.6,+$G(PS586IEN),1))
"RTN","PSJPADIT",157,0)
 .S DRGNAME=$P(DRGNODE,"^",6)
"RTN","PSJPADIT",158,0)
 .S DRGID=$P(DRGNODE,"^",7)
"RTN","PSJPADIT",159,0)
 .S ERRMSG="DRUG NOT ON FILE|"   ; No LAYGO - Unknown DRUG (#50) file IEN
"RTN","PSJPADIT",160,0)
 .S ERRMSG=ERRMSG_"DRG ID="_DRGID_"|NAME="_DRGNAME
"RTN","PSJPADIT",161,0)
 ; Must have PADE system and Dispensing Device
"RTN","PSJPADIT",162,0)
 I '$G(DEVIEN) S ERRMSG="MISSING DEVICE IEN" Q 0
"RTN","PSJPADIT",163,0)
 I '$G(SYSIEN) S ERRMSG="MISSING SYSTEM IEN" Q 0
"RTN","PSJPADIT",164,0)
 N DA,FDA,X,Y,DIC,DIE,DR,D0,ERR,D,DD,DICR,DICRS,DO
"RTN","PSJPADIT",165,0)
 S PADATA("DRUG DEV IEN")=$$FIND1^DIC(58.60111,","_DEVIEN_","_SYSIEN_",","MXQ",DRUG,,,"ERR")
"RTN","PSJPADIT",166,0)
 I 'PADATA("DRUG DEV IEN") D
"RTN","PSJPADIT",167,0)
 .S FDA(58.60111,"?+1,"_+DEVIEN_","_+SYSIEN_",",.01)=DRUG D UPDATE^DIE("E","FDA","ERR")
"RTN","PSJPADIT",168,0)
 .S PADATA("DRUG DEV IEN")=$$FIND1^DIC(58.60111,","_DEVIEN_","_SYSIEN_",","MXQ",DRUG,,,"ERR")
"RTN","PSJPADIT",169,0)
 S PADATA("DRUG DEV IEN")=$$FIND1^DIC(58.60111,","_DEVIEN_","_SYSIEN_",","MXQ",DRUG,,,"ERR")
"RTN","PSJPADIT",170,0)
 I '$G(PADATA("DRUG DEV IEN")) S ERRMSG="UNABLE TO FILE DRUG "_DRUG Q 0
"RTN","PSJPADIT",171,0)
 Q 1
"RTN","PSJPADIT",172,0)
 ;
"RTN","PSJPADIT",173,0)
DRGDRWR(PADATA,ERRMSG)  ; Add drug to drawer in PADE INVENTORY file
"RTN","PSJPADIT",174,0)
 N FDA,ERR
"RTN","PSJPADIT",175,0)
 S PADATA("DRUG IEN")=$$FIND1^DIC(58.601121,","_PADATA("DRAWER IEN")_","_PADATA("DEVICE IEN")_","_PADATA("SYS IEN")_",","MXQ",PADATA(4),,,"ERR")
"RTN","PSJPADIT",176,0)
 I '$G(PADATA("DRUG IEN")) D
"RTN","PSJPADIT",177,0)
 .S FDA(58.601121,"?+1,"_PADATA("DRAWER IEN")_","_PADATA("DEVICE IEN")_","_PADATA("SYS IEN")_",",.01)=PADATA(4) D UPDATE^DIE("","FDA","","ERR")
"RTN","PSJPADIT",178,0)
 .S PADATA("DRUG IEN")=$$FIND1^DIC(58.601121,","_PADATA("DRAWER IEN")_","_PADATA("DEVICE IEN")_","_PADATA("SYS IEN")_",","MXQ",PADATA(4),,,"ERR")
"RTN","PSJPADIT",179,0)
 .Q:'PADATA("DRUG IEN")  N DBALIENS,TRNSIGN,TRNSAMT
"RTN","PSJPADIT",180,0)
 .; If a new drug was added to drawer, initialize drug's drawer balance to Actual Begin Count (PADATA(8)) from HL7 message
"RTN","PSJPADIT",181,0)
 .S DBALIENS=PADATA("DRUG IEN")_","_PADATA("DRAWER IEN")_","_PADATA("DEVICE IEN")_","_PADATA("SYS IEN")_","
"RTN","PSJPADIT",182,0)
 .S FDA(58.601121,DBALIENS,1)=$G(PADATA(8))
"RTN","PSJPADIT",183,0)
 .; File the updated drawer total for this drug
"RTN","PSJPADIT",184,0)
 .D FILE^DIE("","FDA","ERR")
"RTN","PSJPADIT",185,0)
 I '$G(PADATA("DRUG IEN")) S ERRMSG="Unable to file PADE drug (drawer) IEN"_PADATA(4) Q 0
"RTN","PSJPADIT",186,0)
 Q 1
"RTN","PSJPADIT",187,0)
 ;
"RTN","PSJPADIT",188,0)
UPDEVBAL(PADATA,ERRMSG)  ; Update Drug (Device) balance
"RTN","PSJPADIT",189,0)
 ;  Get current device total count of drug
"RTN","PSJPADIT",190,0)
 N DBALIENS,FDA,INVDATA,BALANCE,TRERR,DOSFORM
"RTN","PSJPADIT",191,0)
 ;
"RTN","PSJPADIT",192,0)
 I $E($G(PADATA(5)))="B" Q 1  ; "BIN" transaction does not update device balance
"RTN","PSJPADIT",193,0)
 I $E($G(PADATA(5)))="W" Q 1  ; "WASTE" transaction does not update device balance
"RTN","PSJPADIT",194,0)
 ;
"RTN","PSJPADIT",195,0)
 ; Get Device Balance from transaction, if sent
"RTN","PSJPADIT",196,0)
 S BALANCE=+$P($G(^PS(58.6,+$G(PS586IEN),1)),"^",5)
"RTN","PSJPADIT",197,0)
 S:BALANCE<0 BALANCE=0
"RTN","PSJPADIT",198,0)
 ;
"RTN","PSJPADIT",199,0)
 ; Done with 58.6, now set IENS to refer to 58.60111
"RTN","PSJPADIT",200,0)
 S DBALIENS=PADATA("DRUG DEV IEN")_","_PADATA("DEVICE IEN")_","_PADATA("SYS IEN")_","
"RTN","PSJPADIT",201,0)
 ;
"RTN","PSJPADIT",202,0)
 ; Reported Device Balance. Do this before Calculated Balance.
"RTN","PSJPADIT",203,0)
 ; File transaction's Device Balance for current device and drug to the Reported Device Balance
"RTN","PSJPADIT",204,0)
 N TRERR,FDA S FDA(58.60111,DBALIENS,2)=BALANCE D FILE^DIE("","FDA","TRERR")
"RTN","PSJPADIT",205,0)
 ;
"RTN","PSJPADIT",206,0)
 ; Add transaction input quantity to Drug's calculated Device balance
"RTN","PSJPADIT",207,0)
 N TRERR,FDA,DOSFORM
"RTN","PSJPADIT",208,0)
 ; Update Drug Dosage Form from transaction
"RTN","PSJPADIT",209,0)
 S DOSFORM=$P($G(^PS(58.6,+$G(PS586IEN),0)),"^",6)
"RTN","PSJPADIT",210,0)
 S FDA(58.60111,DBALIENS,1)=$$DEVBAL(PADATA("SYS IEN"),PADATA("DEVICE IEN"),PADATA(4))
"RTN","PSJPADIT",211,0)
 I DOSFORM]"" S FDA(58.60111,DBALIENS,4)=DOSFORM
"RTN","PSJPADIT",212,0)
 D FILE^DIE("","FDA","TRERR")
"RTN","PSJPADIT",213,0)
 Q 1
"RTN","PSJPADIT",214,0)
 ;
"RTN","PSJPADIT",215,0)
UPDRWBAL(PADATA,ERRMSG)  ; Update Drug (Drawer) balance
"RTN","PSJPADIT",216,0)
 ; Get current drawer total count of drug
"RTN","PSJPADIT",217,0)
 N DBALIENS,INVDATA,FDA,BALANCE,II,PSYS,PDEV,PDRW,PDRG,POCK,PTOT,PNOD
"RTN","PSJPADIT",218,0)
 S PSYS=+$G(PADATA("SYS IEN")),PDEV=+$G(PADATA("DEVICE IEN")),PDRW=+$G(PADATA("DRAWER IEN")),PDRG=+$G(PADATA("DRUG IEN"))
"RTN","PSJPADIT",219,0)
 S (POCK,PTOT)=0 F  S POCK=$O(^PS(58.601,PSYS,"DEVICE",PDEV,"DRAWER",PDRW,"SUB",POCK)) Q:'POCK  S PNOD=^(POCK,0) D
"RTN","PSJPADIT",220,0)
 .Q:$P(PNOD,"^",5)'=$G(PADATA(4))
"RTN","PSJPADIT",221,0)
 .S PTOT=$G(PTOT)+$P(PNOD,"^",2)
"RTN","PSJPADIT",222,0)
 N ERR
"RTN","PSJPADIT",223,0)
 ; Add the updated pocket totals to the drawer total for this drug
"RTN","PSJPADIT",224,0)
 S DBALIENS=PDRG_","_PDRW_","_PDEV_","_PSYS_","
"RTN","PSJPADIT",225,0)
 S FDA(58.601121,DBALIENS,1)=PTOT
"RTN","PSJPADIT",226,0)
 ; File the updated drawer total for this drug
"RTN","PSJPADIT",227,0)
 D FILE^DIE("","FDA","ERR")
"RTN","PSJPADIT",228,0)
 Q 1
"RTN","PSJPADIT",229,0)
 ;
"RTN","PSJPADIT",230,0)
UPCKDRW(PADATA,ERRMSG)  ; Add pocket/subdrawer sub-file entry to Drawer multiple
"RTN","PSJPADIT",231,0)
 N FDA       ;   Fileman data array
"RTN","PSJPADIT",232,0)
 N ERR       ;   Fileman error message array
"RTN","PSJPADIT",233,0)
 N POCKSUB   ;   POCKET_SUBDRAWER concatenated
"RTN","PSJPADIT",234,0)
 N DRGIENS   ;   IEN string for Drug field
"RTN","PSJPADIT",235,0)
 N INVDATA   ;   Data returned from PADE INVENTORY (#58.601) file
"RTN","PSJPADIT",236,0)
 N DOSFORM   ;   Dose Form from HL7 message from PADE vendor
"RTN","PSJPADIT",237,0)
 N PADATA6   ;   Signed value of inbound Quantity; positive for PADATA(5)=LOAD or RETURN, negative for PADATA(5)=DISPENSE/VEND/ISSUE and UNLOAD
"RTN","PSJPADIT",238,0)
 N PSPRVDT   ;   The last transaction date/time (date/time of the activity at the cabinet) this pocket was updated
"RTN","PSJPADIT",239,0)
 N PSPRVDIE  ;  The IEN of the last transaction date/time in the "PKUPDT" multiple
"RTN","PSJPADIT",240,0)
 ;
"RTN","PSJPADIT",241,0)
 S DOSFORM=$P($G(^PS(58.6,+$G(PS586IEN),0)),"^",6)
"RTN","PSJPADIT",242,0)
 S PADATA(10)=$TR(PADATA(10),"~~")_"~~"_+$G(PADATA(4))   ; Append subdrawer unique drug IEN suffix to handle different drugs in same subdr-pocket combo
"RTN","PSJPADIT",243,0)
 S:$G(PADATA(10))="" PADATA(10)=$P($G(^PS(58.6,+$G(PS586IEN),0)),"^",12) S:PADATA(10)="" PADATA(10)="~~"_+$G(PADATA(4))
"RTN","PSJPADIT",244,0)
 S POCKSUB=$G(PADATA(7))_"_"_$G(PADATA(10))  ;  "POCKET_SUBDRAWER" storage location
"RTN","PSJPADIT",245,0)
 S PADATA("POCK/SUB IEN")=$$FIND1^DIC(58.601122,","_PADATA("DRAWER IEN")_","_PADATA("DEVICE IEN")_","_PADATA("SYS IEN")_",","MX",POCKSUB,,,"ERR")
"RTN","PSJPADIT",246,0)
 ; Get the last date/time this drawer/subdrawer~drug/pocket was updated
"RTN","PSJPADIT",247,0)
 S PSPRVDIE=$O(^PS(58.601,+$G(PADATA("SYS IEN")),"DEVICE",+$G(PADATA("DEVICE IEN")),"DRAWER",+$G(PADATA("DRAWER IEN")),"PKUPDT","B",POCKSUB,""))
"RTN","PSJPADIT",248,0)
 ;
"RTN","PSJPADIT",249,0)
 S PSPRVDT=$P($G(^PS(58.601,+$G(PADATA("SYS IEN")),"DEVICE",+$G(PADATA("DEVICE IEN")),"DRAWER",+$G(PADATA("DRAWER IEN")),"PKUPDT",+$G(PSPRVDIE),0)),"^",2)
"RTN","PSJPADIT",250,0)
 ; If this current update contains a transaction date/time (i.e., activity date/time) older than the last update, don't update inventory
"RTN","PSJPADIT",251,0)
 I $G(PSPRVDT)&$G(PADATA(9)) I PADATA(9)<PSPRVDT D  Q 0
"RTN","PSJPADIT",252,0)
 .S ERRMSG="- OUTDATED TRANSACTION - "_$G(PADATA(1))_"."_$G(PADATA(2))_".DRUG="_$G(PADATA(4))_".POCKET="_$G(PADATA(7))
"RTN","PSJPADIT",253,0)
 .S ERRMSG=ERRMSG_".LAST UPDATED="_PSPRVDT_".TRANS DT="_PADATA(9)
"RTN","PSJPADIT",254,0)
 I 'PADATA("POCK/SUB IEN") D
"RTN","PSJPADIT",255,0)
 .S FDA(58.601122,"?+1,"_PADATA("DRAWER IEN")_","_PADATA("DEVICE IEN")_","_PADATA("SYS IEN")_",",.01)=POCKSUB D UPDATE^DIE("","FDA","","ERR")
"RTN","PSJPADIT",256,0)
 .S PADATA("POCK/SUB IEN")=$$FIND1^DIC(58.601122,","_PADATA("DRAWER IEN")_","_PADATA("DEVICE IEN")_","_PADATA("SYS IEN")_",","MX",POCKSUB,,,"ERR")
"RTN","PSJPADIT",257,0)
 I PADATA("POCK/SUB IEN") D  ; File Pocket and Subdrawer references in the POCK/SUB sub-file to ensure distinguishing between the two
"RTN","PSJPADIT",258,0)
 .N PKSBIENS S PKSBIENS=PADATA("POCK/SUB IEN")_","_PADATA("DRAWER IEN")_","_PADATA("DEVICE IEN")_","_PADATA("SYS IEN")_","
"RTN","PSJPADIT",259,0)
 .S FDA(58.601122,PKSBIENS,1)=PADATA(4)                            ; DRUG
"RTN","PSJPADIT",260,0)
 .N PKBAL S PKBAL=PADATA(8)+PADATA(6) S FDA(58.601122,PKSBIENS,2)=$S(PKBAL<0:0,1:PKBAL)    ; NEW BALANCE (BALANCE FORWARD)
"RTN","PSJPADIT",261,0)
 .S FDA(58.601122,PKSBIENS,3)=PADATA(7)                            ; POCKET
"RTN","PSJPADIT",262,0)
 .S FDA(58.601122,PKSBIENS,4)=PADATA(10)                           ; SUBDRAWER
"RTN","PSJPADIT",263,0)
 .I DOSFORM]"" S FDA(58.601122,PKSBIENS,5)=DOSFORM                 ; DRUG DOSE FORM
"RTN","PSJPADIT",264,0)
 .D FILE^DIE("","FDA","ERR")
"RTN","PSJPADIT",265,0)
 .I '$G(PSPRVDT),($G(POCKSUB)]"") D
"RTN","PSJPADIT",266,0)
 ..N FDA S FDA(58.601123,"?+1,"_PADATA("DRAWER IEN")_","_PADATA("DEVICE IEN")_","_PADATA("SYS IEN")_",",.01)=POCKSUB
"RTN","PSJPADIT",267,0)
 ..S FDA(58.601123,"?+1,"_PADATA("DRAWER IEN")_","_PADATA("DEVICE IEN")_","_PADATA("SYS IEN")_",",1)=PADATA(9)
"RTN","PSJPADIT",268,0)
 ..D UPDATE^DIE("","FDA","","ERR")
"RTN","PSJPADIT",269,0)
 .S PSPRVDIE=$$FIND1^DIC(58.601123,","_PADATA("DRAWER IEN")_","_PADATA("DEVICE IEN")_","_PADATA("SYS IEN")_",","MX",POCKSUB,,,"ERR")
"RTN","PSJPADIT",270,0)
 .I PSPRVDIE S DBALIENS=PSPRVDIE_","_PADATA("DRAWER IEN")_","_PADATA("DEVICE IEN")_","_PADATA("SYS IEN")_"," D
"RTN","PSJPADIT",271,0)
 ..I $G(PADATA(9))?7N.".".8N S FDA(58.601123,DBALIENS,1)=PADATA(9)  ; TRANSACTION DATE/TIME
"RTN","PSJPADIT",272,0)
 ..Q:'$G(FDA(58.601123,DBALIENS,1))
"RTN","PSJPADIT",273,0)
 ..D FILE^DIE("","FDA","ERR")
"RTN","PSJPADIT",274,0)
 I 'PADATA("POCK/SUB IEN") S ERRMSG="Unable to file PADE pocket/subdrawer "_POCKSUB Q 0
"RTN","PSJPADIT",275,0)
 Q 1
"RTN","PSJPADIT",276,0)
 ;
"RTN","PSJPADIT",277,0)
UPCKBAL(PADATA,ERRMSG)  ; Update pocket / subdrawer balance
"RTN","PSJPADIT",278,0)
 ; Add transaction Quantity to Actual Begin Balance
"RTN","PSJPADIT",279,0)
 ;
"RTN","PSJPADIT",280,0)
 N PCK     ; Pocket ID
"RTN","PSJPADIT",281,0)
 N PCKBEG  ; Total of Actual Begin Balance
"RTN","PSJPADIT",282,0)
 N FDA     ; Fileman data array
"RTN","PSJPADIT",283,0)
 N TRNSAMT ; Transaction amount
"RTN","PSJPADIT",284,0)
 N PCKTOT  ; New balance of pocket
"RTN","PSJPADIT",285,0)
 N DRW     ; Drawer ID
"RTN","PSJPADIT",286,0)
 N SUBDRW  ; Subdrawer ID
"RTN","PSJPADIT",287,0)
 N DBALIENS ; IENS to System, Cabinet, Drawer, Drug, Pocket, Subdrawer
"RTN","PSJPADIT",288,0)
 ;
"RTN","PSJPADIT",289,0)
 S PCK=$G(PADATA(10))
"RTN","PSJPADIT",290,0)
 S TRNSAMT=$G(PADATA(6))
"RTN","PSJPADIT",291,0)
 S:$E(TRNSAMT)="-" TRNSAMT=+$P(TRNSAMT,"-",2)
"RTN","PSJPADIT",292,0)
 S TRNSAMT=$$TSIGN(.PADATA)_TRNSAMT
"RTN","PSJPADIT",293,0)
 S PCKBEG=$S($G(PADATA(8))&($G(PADATA(5))="C"):$G(PADATA(8)),1:$G(PADATA(12)))
"RTN","PSJPADIT",294,0)
 S PCKTOT=$S($E($G(PADATA(5)))="C":PCKBEG,1:PCKBEG+TRNSAMT)
"RTN","PSJPADIT",295,0)
 S PCKTOT=$S(PCKTOT<0:0,1:PCKTOT)
"RTN","PSJPADIT",296,0)
 S DRW=$G(PADATA(1.2))
"RTN","PSJPADIT",297,0)
 S SUBDRW=$G(PADATA(10))
"RTN","PSJPADIT",298,0)
 S DBALIENS=PADATA("POCK/SUB IEN")_","_PADATA("DRAWER IEN")_","_PADATA("DEVICE IEN")_","_PADATA("SYS IEN")_","
"RTN","PSJPADIT",299,0)
 S FDA(58.601122,DBALIENS,2)=PCKTOT
"RTN","PSJPADIT",300,0)
 ; File the updated drawer total for this drug
"RTN","PSJPADIT",301,0)
 D FILE^DIE("","FDA","ERR")
"RTN","PSJPADIT",302,0)
 Q 1
"RTN","PSJPADIT",303,0)
 ;
"RTN","PSJPADIT",304,0)
LOGERR(ERRMSG) ; Log error ERRMSG
"RTN","PSJPADIT",305,0)
 D ERROR^PSJPAD7U(.ERRMSG)
"RTN","PSJPADIT",306,0)
 Q
"RTN","PSJPADIT",307,0)
 ;
"RTN","PSJPADIT",308,0)
ORDIX(PS586IEN)  ; Computed ORDER to handle blank orders in primary patient sort PADE cross reference - "zz" = patient transaction types without order
"RTN","PSJPADIT",309,0)
 N ORDER,RESULTS,RESULT
"RTN","PSJPADIT",310,0)
 D GETS^DIQ(58.6,PS586IEN_",","4;15","","RESULT","ERROR")
"RTN","PSJPADIT",311,0)
 S ORDER=$G(RESULT(58.6,PS586IEN_",",15))
"RTN","PSJPADIT",312,0)
 Q:$G(ORDER) ORDER
"RTN","PSJPADIT",313,0)
 Q:(",LOAD,UNLOAD,"[(","_$G(RESULT(58.6,PS586IEN_",",4))_",")) "INVENTORY"
"RTN","PSJPADIT",314,0)
 Q "zz"
"RTN","PSJPADIT",315,0)
 ;
"RTN","PSJPADIT",316,0)
DRWRBAL(PADESYS,PADEDEV,PADEDRWR,DRUGIEN)  ; Calculate drawer balance for PADE device=PADEDEV, drawer=PADEDRWR, drug=DRUGIEN
"RTN","PSJPADIT",317,0)
 ; PADESYS  =  PADE vendor system IEN from file 58.601
"RTN","PSJPADIT",318,0)
 ; PADEDEV  =  PADE device IEN from file 58.601
"RTN","PSJPADIT",319,0)
 ; PADEDRWR =  PADE drawer from file 58.601
"RTN","PSJPADIT",320,0)
 ; DRUGIEN  =  Drug IEN from file 58.601 (points to file 50)            
"RTN","PSJPADIT",321,0)
 K DRWBAL S DRWBAL=""                        ; Initialize returned balance
"RTN","PSJPADIT",322,0)
 N SUBDRW                                      ; Pocket_subdrawer IEN
"RTN","PSJPADIT",323,0)
 N OUT                                         ; Return array from LIST^DIC
"RTN","PSJPADIT",324,0)
 ;
"RTN","PSJPADIT",325,0)
 Q:'$G(PADESYS)!'$G(PADEDEV)!'$G(PADEDRWR) ""  ; We need system, device, and drawer to find a drawer balance
"RTN","PSJPADIT",326,0)
 Q:'DRUGIEN ""
"RTN","PSJPADIT",327,0)
 D LIST^DIC(58.601121,","_PADEDRWR_","_PADEDEV_","_PADESYS_",","1IE;2","","","","","","","","OUT","WTF")
"RTN","PSJPADIT",328,0)
 S SUBDRW=0 F  S SUBDRW=$O(OUT("DILIST","ID",SUBDRW)) Q:'SUBDRW  D
"RTN","PSJPADIT",329,0)
 .N DRUG S DRUG=$G(OUT("DILIST","ID",SUBDRW,1,"I")) I DRUG,(DRUG=DRUGIEN) S DRWBAL=DRWBAL+$G(OUT("DILIST","ID",SUBDRW,2))
"RTN","PSJPADIT",330,0)
 Q DRWBAL
"RTN","PSJPADIT",331,0)
 ;
"RTN","PSJPADIT",332,0)
DEVBAL(PADESYS,PADEDEV,DRUGIEN)  ; Calculate Device BALANCE for PADE device=PADEDEV drug=DRUGIEN
"RTN","PSJPADIT",333,0)
 Q $$DEVBAL^PSJPDRU1(PADESYS,PADEDEV,DRUGIEN)
"RTN","PSJPADIT",334,0)
 ;
"RTN","PSJPADIT",335,0)
TSIGN(PADATA) ; Determine if the transaction amount needs to be added or subtracted, depending on the transaction type
"RTN","PSJPADIT",336,0)
 Q $$TSIGN^PSJPDRU1(.PADATA)
"RTN","PSJPADPT")
0^27^B74926353^n/a
"RTN","PSJPADPT",1,0)
PSJPADPT ;BIR/JCH - PADE Activity Utility ;09/22/11 5:00pm
"RTN","PSJPADPT",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**317**;16 DEC 97;Build 130
"RTN","PSJPADPT",3,0)
 ;
"RTN","PSJPADPT",4,0)
 ; References to ^PSSDSAPM is supported by DBIA 5570.
"RTN","PSJPADPT",5,0)
 ; Reference to FULL^VALM1 is supported by DBIA 10116.
"RTN","PSJPADPT",6,0)
 ; Reference to $$FMTE^XLFDT is supported by DBIA 10103.
"RTN","PSJPADPT",7,0)
 ; Reference to ^PSDRUG is supported by DBIA 2192.
"RTN","PSJPADPT",8,0)
 ;
"RTN","PSJPADPT",9,0)
PADECK ;
"RTN","PSJPADPT",10,0)
 N PSJTCNT,PSJTSCR
"RTN","PSJPADPT",11,0)
 K VALMBCK
"RTN","PSJPADPT",12,0)
 S PSJPADPT=1,PSJTSCR=15
"RTN","PSJPADPT",13,0)
 D FULL^VALM1
"RTN","PSJPADPT",14,0)
 I '$$ACTIVITY(DFN,PSJTSCR) D
"RTN","PSJPADPT",15,0)
 .W !!,"No PADE activity on file",!
"RTN","PSJPADPT",16,0)
 .K DIR S DIR(0)="EAO",DIR("A")="Press Return to Continue..." D ^DIR K DIR W @IOF
"RTN","PSJPADPT",17,0)
 .W @IOF
"RTN","PSJPADPT",18,0)
PADEND S VALMBCK="R"
"RTN","PSJPADPT",19,0)
 K PSJPADPT
"RTN","PSJPADPT",20,0)
 Q
"RTN","PSJPADPT",21,0)
 ;
"RTN","PSJPADPT",22,0)
ACTIVITY(DFN,PSJTSCR) ; Get PADE activity for patient DFN, display to screen length PSJTSCR
"RTN","PSJPADPT",23,0)
 N PSPDT,PSPDRG,PSTRANS,PSJPOP,PSJCONT,PSJPAGE,PSJPGTMP
"RTN","PSJPADPT",24,0)
 K DIR W @IOF
"RTN","PSJPADPT",25,0)
 S (PSJTCNT,PSJPOP,PSJPAGE)=0
"RTN","PSJPADPT",26,0)
 S PSPDT=99999999 F  S PSPDT=$O(^PS(58.6,"P",+$G(DFN),PSPDT),-1) Q:'PSPDT!PSJPOP  D
"RTN","PSJPADPT",27,0)
 .S PSPDRG="" F  S PSPDRG=$O(^PS(58.6,"P",+$G(DFN),PSPDT,PSPDRG)) Q:(PSPDRG="")!PSJPOP  D
"RTN","PSJPADPT",28,0)
 ..S PSTRANS=0 F  S PSTRANS=$O(^PS(58.6,"P",+$G(DFN),PSPDT,PSPDRG,PSTRANS)) Q:'PSTRANS!PSJPOP  D
"RTN","PSJPADPT",29,0)
 ...S PSJCONT=$G(PSJCONT)+1
"RTN","PSJPADPT",30,0)
 ...I 'PSJTCNT D PGHEAD
"RTN","PSJPADPT",31,0)
 ...N PSEXDT,PSEXTM,PSEXDRG,PSJCAB,PSJQTY,PSJSTS,PSJORD,ND0,ND1,ND2,PSEXDRG2,PSJOVOK,PSJQAR
"RTN","PSJPADPT",32,0)
 ...S ND0=$G(^PS(58.6,PSTRANS,0)),ND1=$G(^PS(58.6,PSTRANS,1))
"RTN","PSJPADPT",33,0)
 ...S PSEXDT=$$PSEXDT(PSPDT)
"RTN","PSJPADPT",34,0)
 ...S PSEXDRG=$S($G(PSPDRG):$P($G(^PSDRUG(+PSPDRG,0)),"^"),1:$P(PSPDRG,"zz",2))
"RTN","PSJPADPT",35,0)
 ...I PSPDRG="zz~UNKNOWN" S PSEXDRG2=$P(ND1,"^",6) I PSEXDRG2]"" S PSEXDRG=PSEXDRG2
"RTN","PSJPADPT",36,0)
 ...S:$L(PSEXDRG)>36 PSEXDRG=$E(PSEXDRG,1,36)_"_"
"RTN","PSJPADPT",37,0)
 ...S PSJORD=$P(ND1,"^")
"RTN","PSJPADPT",38,0)
 ...S PSJQTY=$P(ND0,"^",4) I PSJQTY["." N PSJDEC S PSJDEC="."_$E($P(PSJQTY,".",2),1,2) D
"RTN","PSJPADPT",39,0)
 ....I 'PSJDEC!(PSJDEC=".") S PSJQTY=$P(PSJQTY,".") Q  ; insignificant trailing zeroes
"RTN","PSJPADPT",40,0)
 ....S PSJQTY=$P(PSJQTY,".")_+PSJDEC
"RTN","PSJPADPT",41,0)
 ...S PSJCAB=$P(ND0,"^",2)
"RTN","PSJPADPT",42,0)
 ...S PSJSTS=$P(ND0,"^",5)
"RTN","PSJPADPT",43,0)
 ...S PSJQAR(5)=PSJSTS,PSJQAR(6)=PSJQTY N PSJSIGN S PSJSIGN=$$TSIGN^PSJPADIT(.PSJQAR) S:PSJQTY["-" PSJQTY=$P(PSJQTY,"-",2) S PSJQTY=PSJSIGN_PSJQTY
"RTN","PSJPADPT",44,0)
 ...S PSJOVOK=$S(PSJSTS="V":1,PSJSTS="R":1,PSJSTS="W":1,1:0)
"RTN","PSJPADPT",45,0)
 ...S PSJSTS=$S(PSJSTS="V":"DISP",PSJSTS="R":"RTN",PSJSTS="W":"WASTE",PSJSTS="D":"DESTK",PSJSTS="L":"LOAD",PSJSTS="U":"UNLD",PSJSTS="F":"FILL",PSJSTS="N":"CANCL",PSJSTS="C":"COUNT",PSJSTS="E":"EXP",PSJSTS="A":"DISCR",1:PSJSTS)
"RTN","PSJPADPT",46,0)
 ...S:$E(PSJSTS)="W" PSJQTY="NA"
"RTN","PSJPADPT",47,0)
 ...W !,PSEXDT S PSJTCNT=$G(PSJTCNT)+1
"RTN","PSJPADPT",48,0)
 ...W ?15,$S(PSJORD:"N",'PSJOVOK:"",1:"Y"),?18,$E(PSEXDRG,1,39),?56,$E(PSJSTS,1,6),?62,$J(PSJQTY,3),?69,PSJCAB
"RTN","PSJPADPT",49,0)
 ...S ND2=$P($G(^PS(58.6,PSTRANS,2)),"^") I ND2]"" W !,"   Comment: ",$E(ND2,1,66) S PSJTCNT=$G(PSJTCNT)+1
"RTN","PSJPADPT",50,0)
 ...I (PSJTCNT\PSJTSCR)>PSJPAGE D CONTINUE(.PSJPAGE)
"RTN","PSJPADPT",51,0)
 ...S PSJPGTMP=PSJPAGE
"RTN","PSJPADPT",52,0)
 I $G(PSJCONT) D CONTINUE(.PSJPAGE)
"RTN","PSJPADPT",53,0)
 K DIR W @IOF
"RTN","PSJPADPT",54,0)
 Q PSJTCNT
"RTN","PSJPADPT",55,0)
 ;
"RTN","PSJPADPT",56,0)
PGHEAD ; Print Page Header
"RTN","PSJPADPT",57,0)
 W !,"Pharmacy Automated Dispensing Equipment (PADE) Activity Log"
"RTN","PSJPADPT",58,0)
 D COHEAD
"RTN","PSJPADPT",59,0)
 Q
"RTN","PSJPADPT",60,0)
 ;
"RTN","PSJPADPT",61,0)
COHEAD ; Print Column Header
"RTN","PSJPADPT",62,0)
 W @IOF
"RTN","PSJPADPT",63,0)
 W !!,"Date/Time",?14,"O-R",?18,"Item",?55,"Status",?63,"Qty",?69,"PADE ID"
"RTN","PSJPADPT",64,0)
 W !,"================================================================================"
"RTN","PSJPADPT",65,0)
 Q
"RTN","PSJPADPT",66,0)
 ;
"RTN","PSJPADPT",67,0)
CONTINUE(PSJPAGE)  ; Press return to continue
"RTN","PSJPADPT",68,0)
 N X,DIR
"RTN","PSJPADPT",69,0)
 S DIR("A",1)=" "
"RTN","PSJPADPT",70,0)
 S DIR(0)="EAO",DIR("A")="Press Return to Continue..." D ^DIR S:$G(X)="^" PSJPOP=1
"RTN","PSJPADPT",71,0)
 K DIR
"RTN","PSJPADPT",72,0)
 D COHEAD
"RTN","PSJPADPT",73,0)
 S PSJPAGE=$G(PSJPAGE)+1
"RTN","PSJPADPT",74,0)
 K PSJCONT
"RTN","PSJPADPT",75,0)
 Q
"RTN","PSJPADPT",76,0)
 ;
"RTN","PSJPADPT",77,0)
PSEXDT(DT) ; Format Date for display
"RTN","PSJPADPT",78,0)
 N XDT,XTM,I
"RTN","PSJPADPT",79,0)
 S XDT=$P($TR($$FMTE^XLFDT(DT,2),"@"," "),":",1,2)
"RTN","PSJPADPT",80,0)
 S XTM=$P(XDT," ",2)
"RTN","PSJPADPT",81,0)
 F I=1:1:3 S $P(XDT,"/",I)=$TR($J(+$P(XDT,"/",I),2)," ",0)
"RTN","PSJPADPT",82,0)
 S XDT=XDT_" "_XTM
"RTN","PSJPADPT",83,0)
 Q XDT
"RTN","PSJPADPT",84,0)
 ;
"RTN","PSJPADPT",85,0)
ASKRESET(PADE)  ; Prompt to reset PADE device balances
"RTN","PSJPADPT",86,0)
 N DIR,X,Y
"RTN","PSJPADPT",87,0)
 S DIR(0)="Y",DIR("A")="RESET/INITIALIZE PADE DEVICE"
"RTN","PSJPADPT",88,0)
 S DIR("?")="^D RESHLP^PSJPADPT"
"RTN","PSJPADPT",89,0)
 S DIR("B")="N" D ^DIR
"RTN","PSJPADPT",90,0)
 I 'Y D MANUN^PSJPAD70(PADE) Q
"RTN","PSJPADPT",91,0)
 Q:'$$SURES()
"RTN","PSJPADPT",92,0)
 D CONTRES(PADE)
"RTN","PSJPADPT",93,0)
 Q
"RTN","PSJPADPT",94,0)
 ;
"RTN","PSJPADPT",95,0)
SURES()  ; Ask user if they're really sure about deleting all meds from device
"RTN","PSJPADPT",96,0)
 N DIR,X,Y
"RTN","PSJPADPT",97,0)
 S DIR(0)="Y"
"RTN","PSJPADPT",98,0)
 S DIR("A",1)=" "
"RTN","PSJPADPT",99,0)
 S DIR("A",2)="     CAUTION: THIS WILL DELETE THE LIST OF MEDICATIONS"
"RTN","PSJPADPT",100,0)
 S DIR("A",3)="      LINKED TO THIS PADE CABINET (in VistA only)."
"RTN","PSJPADPT",101,0)
 S DIR("A",4)=" "
"RTN","PSJPADPT",102,0)
 S DIR("A")="Are you sure you want to do this",DIR("B")="N"
"RTN","PSJPADPT",103,0)
 S DIR("?")="^D RESHLP^PSJPADPT"
"RTN","PSJPADPT",104,0)
 D ^DIR
"RTN","PSJPADPT",105,0)
 Q Y
"RTN","PSJPADPT",106,0)
 ;
"RTN","PSJPADPT",107,0)
CONTRES(PADE) ;  Finish device reset
"RTN","PSJPADPT",108,0)
 N FDA,PSPADER
"RTN","PSJPADPT",109,0)
 I '$$RESPADE(PADE) W " ...Unable to reset "_$G(PADE) Q
"RTN","PSJPADPT",110,0)
 S FDA(58.639,"?+1,"_+PADE_",",.01)=$$NOW^XLFDT()
"RTN","PSJPADPT",111,0)
 D UPDATE^DIE("","FDA","PSPADER")
"RTN","PSJPADPT",112,0)
 I $G(PSPADER(1,0))="+" W "  ...PADE initialization complete."
"RTN","PSJPADPT",113,0)
 Q
"RTN","PSJPADPT",114,0)
 ;
"RTN","PSJPADPT",115,0)
RESPADE(PADE) ; Reset balances in PADE cabinet to zero
"RTN","PSJPADPT",116,0)
 N DRUG,DRAWER,POCKET,SUBPCK,PSJPSYS,DIK,DA,PADIEN,PADENAM,PSPADER,PSJY
"RTN","PSJPADPT",117,0)
 D GETS^DIQ(58.63,PADE_",",1,"I","PSJPSYS")
"RTN","PSJPADPT",118,0)
 S PSJPSYS=$G(PSJPSYS("58.63",+PADE_",",1,"I"))
"RTN","PSJPADPT",119,0)
 Q:'$G(PSJPSYS)!'$D(^PS(58.601,+$G(PSJPSYS),0)) 0
"RTN","PSJPADPT",120,0)
 S PADENAM=$P($G(^PS(58.63,+PADE,0)),"^")
"RTN","PSJPADPT",121,0)
 S PADIEN=$$FIND1^DIC(58.6011,","_PSJPSYS_",","MX",PADENAM,,,"PSPADER")
"RTN","PSJPADPT",122,0)
 Q:'$G(PADIEN)!'$G(^PS(58.601,+PSJPSYS,"DEVICE",+PADIEN,0)) 0
"RTN","PSJPADPT",123,0)
 S DIK="^PS(58.601,"_+PSJPSYS_",""DEVICE"","_+PADIEN_",""DRAWER"","
"RTN","PSJPADPT",124,0)
 S DA(2)=+PSJPSYS,DA(1)=+PADIEN
"RTN","PSJPADPT",125,0)
 S DRAWER=0 F  S DRAWER=$O(^PS(58.601,+PSJPSYS,"DEVICE",+PADIEN,"DRAWER",DRAWER)) Q:'DRAWER  D
"RTN","PSJPADPT",126,0)
 .S DA=DRAWER D ^DIK
"RTN","PSJPADPT",127,0)
 S DIK="^PS(58.601,"_+PSJPSYS_",""DEVICE"","_+PADIEN_",""DRUG"","
"RTN","PSJPADPT",128,0)
 S DA(2)=+PSJPSYS,DA(1)=+PADIEN
"RTN","PSJPADPT",129,0)
 S DRUG=0 F  S DRUG=$O(^PS(58.601,+PSJPSYS,"DEVICE",+PADIEN,"DRUG",DRUG)) Q:'DRUG  D
"RTN","PSJPADPT",130,0)
 .S DA=DRUG D ^DIK
"RTN","PSJPADPT",131,0)
 Q 1
"RTN","PSJPADPT",132,0)
 ;
"RTN","PSJPADPT",133,0)
EMPTY(PADE)  ; Return 1 if PADE cabinet contains no drugs
"RTN","PSJPADPT",134,0)
 ; INPUT : PADE - Pointer to PADE DISPENSING DEVICE (#58.63) FILE
"RTN","PSJPADPT",135,0)
 N EMPTY
"RTN","PSJPADPT",136,0)
 S EMPTY=0
"RTN","PSJPADPT",137,0)
 I '$D(^PS(58.601,"DEV",+PADE)) S EMPTY=1
"RTN","PSJPADPT",138,0)
 Q EMPTY
"RTN","PSJPADPT",139,0)
 ;
"RTN","PSJPADPT",140,0)
RESHLP  ; Display help text explaining PADE reset
"RTN","PSJPADPT",141,0)
 N HELPAR
"RTN","PSJPADPT",142,0)
 S HELPAR(1)="This action deletes all medications from this PADE cabinet in VistA,"
"RTN","PSJPADPT",143,0)
 S HELPAR(2)="making the cabinet appear empty to VistA users. This does not affect"
"RTN","PSJPADPT",144,0)
 S HELPAR(3)="the vendor system. Resetting a cabinet makes the device unavailable"
"RTN","PSJPADPT",145,0)
 S HELPAR(4)="to the PADE INVENTORY REPORT as it will no longer have inventory."
"RTN","PSJPADPT",146,0)
 S HELPAR(5)="After a PADE cabinet is reset, medications will be added babck to the"
"RTN","PSJPADPT",147,0)
 S HELPAR(6)="cabinet as new HL7 messages are received from the vendor, and the"
"RTN","PSJPADPT",148,0)
 S HELPAR(7)="cabinet will be available again for reports and order entry lookups."
"RTN","PSJPADPT",149,0)
 D EN^DDIOL(.HELPAR)
"RTN","PSJPADPT",150,0)
 Q
"RTN","PSJPADPT",151,0)
 ;
"RTN","PSJPADPT",152,0)
PARTIAL(PSJY,INARRAY,OUTARRAY,DISPDATA,MSG,ARRAYX,FOUND,NOXREF,PSALLPC) ; Lookup PSJY in INARRAY
"RTN","PSJPADPT",153,0)
 ; INPUT  - PSJY=Lookup text
"RTN","PSJPADPT",154,0)
 ;        - INARRAY(text)=number - Array of selectable data
"RTN","PSJPADPT",155,0)
 ; OUTPUT - OUTARRAY(text)=number - Entry selected from INARRAY
"RTN","PSJPADPT",156,0)
 ;
"RTN","PSJPADPT",157,0)
 N PSJPART,ITMNAME,II,ITM,ITMX,Y,PSJTMP,PSJDUP
"RTN","PSJPADPT",158,0)
 K FOUND
"RTN","PSJPADPT",159,0)
 S II=1,ITMID="" F  S ITMID=$O(INARRAY(ITMID)) Q:ITMID=""  D
"RTN","PSJPADPT",160,0)
 .Q:ITMID="IEN"!(ITMID="NAME")
"RTN","PSJPADPT",161,0)
 .S ITM(ITMID)=$P(INARRAY(ITMID),"^"),ITMX(INARRAY(ITMID),ITMID)=$P(INARRAY(ITMID),"^",2)
"RTN","PSJPADPT",162,0)
 ;
"RTN","PSJPADPT",163,0)
 Q:$D(ITM)<10
"RTN","PSJPADPT",164,0)
 F ITM="" F  S ITM=$O(ITM(ITM)) Q:ITM=""  D
"RTN","PSJPADPT",165,0)
 .S PSJDUP=0
"RTN","PSJPADPT",166,0)
 .I $E(ITM,1,$L(PSJY))=PSJY D  Q:'$G(PSJDUP)
"RTN","PSJPADPT",167,0)
 ..N PP,QQ S PP="" F  S PP=$O(PSJPART(PP)) Q:PP=""  S QQ="" F  S QQ=$O(PSJPART(PP,QQ)) Q:QQ=""  I PSJPART(PP,QQ)=ITM(ITM) S PSJDUP=1
"RTN","PSJPADPT",168,0)
 ..Q:$G(PSJDUP)
"RTN","PSJPADPT",169,0)
 ..S PSJPART(II,ITM)=INARRAY(ITM)
"RTN","PSJPADPT",170,0)
 ..S PSJPART(II,ITM)=PSJPART(II,ITM)_"^"_$P($G(ARRAYX(ITM(ITM))),"^",2)
"RTN","PSJPADPT",171,0)
 ..S II=II+1
"RTN","PSJPADPT",172,0)
 .I '$G(NOXREF) I $E(ITM(ITM),1,$L(PSJY))=PSJY D  Q:'$G(PSJDUP)
"RTN","PSJPADPT",173,0)
 ..N PP,QQ S PP="" F  S PP=$O(PSJPART(PP)) Q:PP=""  S QQ="" F  S QQ=$O(PSJPART(PP,QQ)) Q:QQ=""  I PSJPART(PP,QQ)=ITM(ITM) S PSJDUP=1
"RTN","PSJPADPT",174,0)
 ..Q:$G(PSJDUP)
"RTN","PSJPADPT",175,0)
 ..S PSJPART(II,ITM)=ITM(ITM)
"RTN","PSJPADPT",176,0)
 ..S PSJPART(II,ITM)=PSJPART(II,ITM)_"^"_$P($G(ARRAYX(ITM(ITM))),"^",2)
"RTN","PSJPADPT",177,0)
 ..S II=II+1
"RTN","PSJPADPT",178,0)
 .I $$UPPER^HLFNC($E(ITM,1,$L(PSJY)))=$$UPPER^HLFNC(PSJY) D  Q:'$G(PSJDUP)
"RTN","PSJPADPT",179,0)
 ..N PP,QQ S PP="" F  S PP=$O(PSJPART(PP)) Q:PP=""  S QQ="" F  S QQ=$O(PSJPART(PP,QQ)) Q:QQ=""  I PSJPART(PP,QQ)=ITM(ITM) S PSJDUP=1
"RTN","PSJPADPT",180,0)
 ..Q:$G(PSJDUP)
"RTN","PSJPADPT",181,0)
 ..S PSJPART(II,ITM)=INARRAY(ITM)_"^"_$P($G(ARRAYX(ITM(ITM))),"^",2)
"RTN","PSJPADPT",182,0)
 ..S II=II+1
"RTN","PSJPADPT",183,0)
 .I '$G(NOXREF) I $$UPPER^HLFNC($E(ITM(ITM),1,$L(PSJY)))=$$UPPER^HLFNC(PSJY) D  Q:'$G(PSJDUP)
"RTN","PSJPADPT",184,0)
 ..N PP,QQ S PP="" F  S PP=$O(PSJPART(PP)) Q:PP=""  S QQ="" F  S QQ=$O(PSJPART(PP,QQ)) Q:QQ=""  I PSJPART(PP,QQ)=ITM(ITM) S PSJDUP=1
"RTN","PSJPADPT",185,0)
 ..Q:$G(PSJDUP)
"RTN","PSJPADPT",186,0)
 ..S PSJPART(II,ITM)=ITM(ITM)_"^"_$P($G(ARRAYX(ITM(ITM))),"^",2)
"RTN","PSJPADPT",187,0)
 ..S II=II+1
"RTN","PSJPADPT",188,0)
 I $D(PSJPART(1)) D
"RTN","PSJPADPT",189,0)
 .N DIR,STRING,CNT
"RTN","PSJPADPT",190,0)
 .I '$O(PSJPART(1)) S PSJTMP=$O(PSJPART(1,"")) D  Q
"RTN","PSJPADPT",191,0)
 ..S OUTARRAY(PSJTMP)=$S('$G(PSALLPC):$P(PSJPART(1,PSJTMP),"^"),1:PSJPART(1,PSJTMP)),FOUND=1
"RTN","PSJPADPT",192,0)
 ..W !," "_$O(PSJPART(1,"")),?15,$P(PSJPART(1,PSJTMP),"^")
"RTN","PSJPADPT",193,0)
 .I $L($G(MSG)) W !,MSG,!
"RTN","PSJPADPT",194,0)
 .S CNT=0 F  S CNT=$O(PSJPART(CNT)) Q:'CNT  D
"RTN","PSJPADPT",195,0)
 ..N ITMID S ITMID=$O(PSJPART(CNT,""))
"RTN","PSJPADPT",196,0)
 ..S STRING=$G(STRING)_CNT_":"_ITMID_";"
"RTN","PSJPADPT",197,0)
 ..S DIR("A",CNT)="   "_CNT_"      "_ITMID_$S($G(DISPDATA):"  "_$P($G(PSJPART(CNT,ITMID)),"^"),1:"")
"RTN","PSJPADPT",198,0)
 .S DIR("A")="Choose 1-"_+$O(PSJPART(9999999),-1)_": "
"RTN","PSJPADPT",199,0)
 .S DIR(0)="SAO^"_STRING D ^DIR
"RTN","PSJPADPT",200,0)
 .I Y>0 D  Q
"RTN","PSJPADPT",201,0)
 ..N PSPTSEL S PSPTSEL=$O(PSJPART(+Y,""))
"RTN","PSJPADPT",202,0)
 ..S OUTARRAY(PSPTSEL)=$S('$G(PSALLPC):$P(PSJPART(+Y,PSPTSEL),"^"),1:$G(PSJPART(+Y,PSPTSEL))),FOUND=1
"RTN","PSJPADPT",203,0)
 ..N ID2 S ID2=$G(OUTARRAY(PSPTSEL)) I ID2]"" W "  ",$P(ID2,"^")
"RTN","PSJPADPT",204,0)
 .S PSJY=""
"RTN","PSJPADPT",205,0)
 Q
"RTN","PSJPADSI")
0^4^B210554864^n/a
"RTN","PSJPADSI",1,0)
PSJPADSI ;BIR/JCH PADE INBOUND SYSTEM SET UP ;8/25/15
"RTN","PSJPADSI",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**317**;16 DEC 97;Build 130
"RTN","PSJPADSI",3,0)
 ;
"RTN","PSJPADSI",4,0)
 ; Reference to EDIT^XPAREDIT is supported by DBIA 2336.
"RTN","PSJPADSI",5,0)
 ; Reference to WIN^DGPMDDCF is supported by DBIA 1246.
"RTN","PSJPADSI",6,0)
 ; Reference to INP^VADPT is supported by DBIA 10061.
"RTN","PSJPADSI",7,0)
 ; Reference to ^DDIOL is supported by DBIA 10142.
"RTN","PSJPADSI",8,0)
 ; Reference to ^PS(55 is supported by DBIA 2191.
"RTN","PSJPADSI",9,0)
 ; Reference to ^DIC(42 is supported by DBIA 10039.
"RTN","PSJPADSI",10,0)
 ; Reference to ^SC( is supported by DBIA 10040.
"RTN","PSJPADSI",11,0)
 ; Reference to NOW^XLFDT is supported by DBIA 10153.
"RTN","PSJPADSI",12,0)
 ;
"RTN","PSJPADSI",13,0)
 Q
"RTN","PSJPADSI",14,0)
 ;
"RTN","PSJPADSI",15,0)
ENCAB ; Setup Cabinet device in file 58.63
"RTN","PSJPADSI",16,0)
 N PSJPADQ
"RTN","PSJPADSI",17,0)
 F  Q:$G(PSJPADQ)!$G(DUOUT)!$G(DTOUT)  D PADEV
"RTN","PSJPADSI",18,0)
 Q
"RTN","PSJPADSI",19,0)
 ;
"RTN","PSJPADSI",20,0)
PADEV ;enter/edit PADE devices and VistA locations
"RTN","PSJPADSI",21,0)
 N DR,DA,DIC,DIE,X,Y,PSJPSYS,PSJPDEV,PADAR,DEVDA W !
"RTN","PSJPADSI",22,0)
 S PSJPSYS=""
"RTN","PSJPADSI",23,0)
 W ! D GETFILD(PSJPSYS,.DEVDA)
"RTN","PSJPADSI",24,0)
 I '$G(DEVDA) S PSJPADQ=1 Q
"RTN","PSJPADSI",25,0)
 I $G(DEVDA) D
"RTN","PSJPADSI",26,0)
 .I $G(DUOUT)!($G(DTOUT))!$G(PSJPADQ) K DUOUT,DTOUT Q
"RTN","PSJPADSI",27,0)
 .S DIE="^PS(58.63,",DA=+DEVDA,DR="[PSJ PADE DISPENSING DEVICE]" W ! D ^DIE
"RTN","PSJPADSI",28,0)
 .Q:'$G(DA)!$G(DUOUT)!$G(DTOUT)  N PSJPDEV S PSJPDEV=DA
"RTN","PSJPADSI",29,0)
 K DIE,DIC
"RTN","PSJPADSI",30,0)
 Q
"RTN","PSJPADSI",31,0)
 ;
"RTN","PSJPADSI",32,0)
GETFILD(PSJPSYS,DEVIEN) ; Get Device if it exists, or File Device if not
"RTN","PSJPADSI",33,0)
 N PSJDIV,D K DEVIEN,LAYGO S DEVIEN=""
"RTN","PSJPADSI",34,0)
 N DR,DIR,ERR,DEV,RESULT,TOT,RANGE,DEVPRMPT,PAD,PSJPNAM
"RTN","PSJPADSI",35,0)
 W ! S DIC="^PS(58.63,",DIC(0)="EALNMV",LAYGO="58.63",DR="1"
"RTN","PSJPADSI",36,0)
 S DR=1,DLAYGO=LAYGO
"RTN","PSJPADSI",37,0)
 D ^DIC K DIC I Y>0 S DEVIEN=+Y
"RTN","PSJPADSI",38,0)
 I Y<0 D DELBADSY^PSJPDRU1  ; If user aborted new device entry, may have left "?BAD" entry in 58.601 file due to invalid uniqueness key
"RTN","PSJPADSI",39,0)
 I $G(DEVIEN),$G(PSJPSYS) D
"RTN","PSJPADSI",40,0)
 .N FDA S FDA(58.63,DA,1)=PSJPSYS
"RTN","PSJPADSI",41,0)
 .S FDA(58.63,DA,12)=$$UPPER^PSJPDRUT($P($G(^PS(58.63,+DEVIEN,0)),"^"))
"RTN","PSJPADSI",42,0)
 .D FILE^DIE("","FDA","RESULT")
"RTN","PSJPADSI",43,0)
 Q
"RTN","PSJPADSI",44,0)
 ;
"RTN","PSJPADSI",45,0)
ENSYS ; Setup PADE Inbound System in file 58.601
"RTN","PSJPADSI",46,0)
 N PSJPADQ
"RTN","PSJPADSI",47,0)
 F  Q:$G(PSJPADQ)!$G(DUOUT)!$G(DTOUT)  D PADESYS
"RTN","PSJPADSI",48,0)
 Q
"RTN","PSJPADSI",49,0)
 ;
"RTN","PSJPADSI",50,0)
PADESYS ;enter/edit PADE inventory system
"RTN","PSJPADSI",51,0)
 N DR,DA,DIC,DIE,X,Y,PSJPSYS,PSJPDEV,PADAR,DEVDA,PSJPSNM,DLAYGO,PSJASKDN W !
"RTN","PSJPADSI",52,0)
 S Y=$$ENSYS^PSJPDRUT
"RTN","PSJPADSI",53,0)
 Q:$G(DUOUT)!$G(DTOUT)
"RTN","PSJPADSI",54,0)
 I Y<1 S PSJPADQ=1 Q
"RTN","PSJPADSI",55,0)
 S (DA,PSJPSYS)=+Y
"RTN","PSJPADSI",56,0)
 S DIE="^PS(58.601,",DR="[PSJ PADE INVENTORY]" D ^DIE
"RTN","PSJPADSI",57,0)
 S PSJPSNM=$P($G(^PS(58.601,+$G(PSJPSYS),0)),"^")
"RTN","PSJPADSI",58,0)
 I PSJPSNM=""!($G(PSJASKDN)=3) S PSJPADQ=1 Q
"RTN","PSJPADSI",59,0)
 F  Q:$G(PSJPADQ)!$G(DUOUT)!$G(DTOUT)  D GETDEV(PSJPSYS,.DEVDA) I $G(DEVDA) D
"RTN","PSJPADSI",60,0)
 .I $G(DUOUT)!($G(DTOUT))!$G(PSJPADQ) K DUOUT,DTOUT Q
"RTN","PSJPADSI",61,0)
 .N DIE,DA,DR,X,Y
"RTN","PSJPADSI",62,0)
 .S DIE="^PS(58.63,",DA=+DEVDA,DR="[PSJ PADE DISPENSING DEVICE]" W ! D ^DIE
"RTN","PSJPADSI",63,0)
 .W !! S DIR(0)="FO",DIR("A")="Press return to continue" D ^DIR Q
"RTN","PSJPADSI",64,0)
 K DIE,DIC,DTOUT,DUOUT,PSJPADQ
"RTN","PSJPADSI",65,0)
 Q
"RTN","PSJPADSI",66,0)
 ;
"RTN","PSJPADSI",67,0)
GETDEV(PSJPSYS,DEVIEN) ; Get device ien
"RTN","PSJPADSI",68,0)
 N PSJDIV K DEVIEN S DEVIEN=""
"RTN","PSJPADSI",69,0)
 N DIR,ERR,DEV,RESULT,TOT,RANGE,DEVPRMPT,PAD,PSJPNAM
"RTN","PSJPADSI",70,0)
 W ! S DIC="^PS(58.63,",DIC(0)="EAMV"
"RTN","PSJPADSI",71,0)
 D ^DIC K DIC I Y>0 S DEVIEN=+Y
"RTN","PSJPADSI",72,0)
 I $G(DEVIEN),$G(PSJPSYS) D
"RTN","PSJPADSI",73,0)
 .N FDA S FDA(58.63,DEVIEN_",",1)=PSJPSYS
"RTN","PSJPADSI",74,0)
 .S FDA(58.63,DEVIEN_",",12)=$$UPPER^PSJPDRUT($P($G(^PS(58.63,+DEVIEN,0)),"^"))
"RTN","PSJPADSI",75,0)
 .D FILE^DIE("","FDA","RESULT")
"RTN","PSJPADSI",76,0)
 S:'$G(DEVIEN)>0 PSJPADQ=1
"RTN","PSJPADSI",77,0)
 Q
"RTN","PSJPADSI",78,0)
 ;
"RTN","PSJPADSI",79,0)
WARDSCR(Y) ; Ward Location Y must be associated with division PSJDIV in PADE inbound system DA(3)
"RTN","PSJPADSI",80,0)
 N D0,X
"RTN","PSJPADSI",81,0)
 S D0=+Y D WIN^DGPMDDCF Q:$G(X) 1
"RTN","PSJPADSI",82,0)
 I $P(^DIC(42,D0,0),U,11)=$G(^PS(58.601,DA(3),"DIV",DA(2),0)) Q 1
"RTN","PSJPADSI",83,0)
 Q 0
"RTN","PSJPADSI",84,0)
 ;
"RTN","PSJPADSI",85,0)
WARDSCR2(Y,DDEV) ; Ward Location Y must be associated with division PSJDIV in PADE inbound system DA(3)
"RTN","PSJPADSI",86,0)
 N D0,X,DIV
"RTN","PSJPADSI",87,0)
 S D0=+Y
"RTN","PSJPADSI",88,0)
 Q:'$G(DDEV) 0
"RTN","PSJPADSI",89,0)
 S DIV=$P($G(^PS(58.63,+DDEV,2)),"^")
"RTN","PSJPADSI",90,0)
 Q:'DIV 0
"RTN","PSJPADSI",91,0)
 I $P(^DIC(42,D0,0),U,11)=DIV Q 1
"RTN","PSJPADSI",92,0)
 Q 0
"RTN","PSJPADSI",93,0)
 ;
"RTN","PSJPADSI",94,0)
CLCHK(QZ) ; Clinic Location QZ must be associated with division PSJDIV in PADE inbound system DA(3)
"RTN","PSJPADSI",95,0)
 N PSJDIV S PSJDIV=$G(^PS(58.601,DA(3),"DIV",DA(2),0))
"RTN","PSJPADSI",96,0)
 I $P(^SC(QZ,0),U,3)'="C" Q 0
"RTN","PSJPADSI",97,0)
 I $P(^SC(QZ,0),U,15)'=PSJDIV Q 0
"RTN","PSJPADSI",98,0)
 Q 1
"RTN","PSJPADSI",99,0)
 ;
"RTN","PSJPADSI",100,0)
CLCHK2(QZ,DDEV) ; Clinic Location QZ must be associated with division PSJDIV in PADE inbound system DA(3)
"RTN","PSJPADSI",101,0)
 N PSJDIV
"RTN","PSJPADSI",102,0)
 Q:'$G(DDEV) 0
"RTN","PSJPADSI",103,0)
 S PSJDIV=$P($G(^PS(58.63,+DDEV,2)),"^")
"RTN","PSJPADSI",104,0)
 Q:'PSJDIV 0
"RTN","PSJPADSI",105,0)
 I $P(^SC(QZ,0),U,3)'="C" Q 0
"RTN","PSJPADSI",106,0)
 I $P(^SC(QZ,0),U,15)'=PSJDIV Q 0
"RTN","PSJPADSI",107,0)
 Q 1
"RTN","PSJPADSI",108,0)
 ;
"RTN","PSJPADSI",109,0)
CGCHK(QZ) ; Clinic Group QZ must have at least one clinic associated with division PSJDIV in PADE inbound system DA(3)
"RTN","PSJPADSI",110,0)
 N PSJDIV,CL,CLIEN,GOTONE S PSJDIV=$G(^PS(58.601,DA(3),"DIV",DA(2),0))
"RTN","PSJPADSI",111,0)
 S GOTONE=0
"RTN","PSJPADSI",112,0)
 S CL=0 F  Q:$G(GOTONE)  S CL=$O(^PS(57.8,+QZ,1,CL)) Q:'CL  D
"RTN","PSJPADSI",113,0)
 .S CLIEN=+$G(^PS(57.8,+QZ,1,CL,0))
"RTN","PSJPADSI",114,0)
 .I $P(^SC(CLIEN,0),U,15)=PSJDIV S GOTONE=1
"RTN","PSJPADSI",115,0)
 Q:GOTONE 1
"RTN","PSJPADSI",116,0)
 Q 0
"RTN","PSJPADSI",117,0)
 ;
"RTN","PSJPADSI",118,0)
CGCHK2(QZ,DDEV) ; Clinic Group QZ must have at least one clinic associated with division PSJDIV in PADE inbound system DA(3)
"RTN","PSJPADSI",119,0)
 N PSJDIV,CL,CLIEN,GOTONE
"RTN","PSJPADSI",120,0)
 Q:'$G(DDEV) 0
"RTN","PSJPADSI",121,0)
 S PSJDIV=$P($G(^PS(58.63,+DDEV,2)),"^")
"RTN","PSJPADSI",122,0)
 Q:'PSJDIV 0
"RTN","PSJPADSI",123,0)
 S GOTONE=0
"RTN","PSJPADSI",124,0)
 S CL=0 F  Q:$G(GOTONE)  S CL=$O(^PS(57.8,+QZ,1,CL)) Q:'CL  D
"RTN","PSJPADSI",125,0)
 .S CLIEN=+$G(^PS(57.8,+QZ,1,CL,0))
"RTN","PSJPADSI",126,0)
 .I $P(^SC(CLIEN,0),U,15)=PSJDIV S GOTONE=1
"RTN","PSJPADSI",127,0)
 Q:GOTONE 1
"RTN","PSJPADSI",128,0)
 Q 0
"RTN","PSJPADSI",129,0)
 ;
"RTN","PSJPADSI",130,0)
WGCHK(QZ) ; Ward Group QZ must have at least one ward associated with division PSJDIV in PADE inbound system DA(3)
"RTN","PSJPADSI",131,0)
 N PSJDIV,WD,WDIEN,GOTONE S PSJDIV=$G(^PS(58.601,DA(3),"DIV",DA(2),0))
"RTN","PSJPADSI",132,0)
 S GOTONE=0
"RTN","PSJPADSI",133,0)
 S WD=0 F  Q:$G(GOTONE)  S WD=$O(^PS(57.5,+QZ,1,WD)) Q:'WD  D
"RTN","PSJPADSI",134,0)
 .S WDIEN=+$G(^PS(57.5,+QZ,1,WD,0))
"RTN","PSJPADSI",135,0)
 .I $P(^DIC(42,WDIEN,0),U,11)=PSJDIV S GOTONE=1
"RTN","PSJPADSI",136,0)
 Q:GOTONE 1
"RTN","PSJPADSI",137,0)
 Q 0
"RTN","PSJPADSI",138,0)
 ;
"RTN","PSJPADSI",139,0)
WGCHK2(QZ,DDEV) ; Ward Group QZ must have at least one ward associated with division PSJDIV in PADE inbound system DA(3)
"RTN","PSJPADSI",140,0)
 N PSJDIV,WD,WDIEN,GOTONE
"RTN","PSJPADSI",141,0)
 Q:'$G(DDEV) 0
"RTN","PSJPADSI",142,0)
 S PSJDIV=$P($G(^PS(58.63,+DDEV,2)),"^")
"RTN","PSJPADSI",143,0)
 Q:'PSJDIV 0
"RTN","PSJPADSI",144,0)
 S GOTONE=0
"RTN","PSJPADSI",145,0)
 S WD=0 F  Q:$G(GOTONE)  S WD=$O(^PS(57.5,+QZ,1,WD)) Q:'WD  D
"RTN","PSJPADSI",146,0)
 .S WDIEN=+$G(^PS(57.5,+QZ,1,WD,0))
"RTN","PSJPADSI",147,0)
 .I $P(^DIC(42,WDIEN,0),U,11)=PSJDIV S GOTONE=1
"RTN","PSJPADSI",148,0)
 Q:GOTONE 1
"RTN","PSJPADSI",149,0)
 Q 0
"RTN","PSJPADSI",150,0)
 ;
"RTN","PSJPADSI",151,0)
SYSHLP ; User help for PADE INVENTORY SYSTEM (#.01) field of PADE INVENTORY SYSTEM (#58.601) file
"RTN","PSJPADSI",152,0)
 N ARRAY
"RTN","PSJPADSI",153,0)
 S ARRAY(1)=" Enter the name of the Pharmacy Automated Dispensing Equipment (PADE)."
"RTN","PSJPADSI",154,0)
 S ARRAY(2)=" system. This must be the same as the System Name in the HL7 messages"
"RTN","PSJPADSI",155,0)
 S ARRAY(3)=" received from the PADE vendor interface."
"RTN","PSJPADSI",156,0)
 S ARRAY(4)=""
"RTN","PSJPADSI",157,0)
 D WRITE(.ARRAY)
"RTN","PSJPADSI",158,0)
 Q
"RTN","PSJPADSI",159,0)
 ;
"RTN","PSJPADSI",160,0)
DDEVHLP ; User help for DISPENSING DEVICE (#1) field of PADE INVENTORY SYSTEM (#58.601) file
"RTN","PSJPADSI",161,0)
 N ARRAY
"RTN","PSJPADSI",162,0)
 S ARRAY(1)="  Enter the name of the specific dispensing device, also known as"
"RTN","PSJPADSI",163,0)
 S ARRAY(2)="  a Station or Cabinet. This must match exactly the name of the"
"RTN","PSJPADSI",164,0)
 S ARRAY(3)="  device on the PADE system."
"RTN","PSJPADSI",165,0)
 S ARRAY(4)=""
"RTN","PSJPADSI",166,0)
 D WRITE(.ARRAY)
"RTN","PSJPADSI",167,0)
 Q
"RTN","PSJPADSI",168,0)
 ;
"RTN","PSJPADSI",169,0)
CBALHLP ; User help for CALCULATED DEVICE BALANCE (#1) field in DRUG (DEVICE) (#58.60111) sub-file.
"RTN","PSJPADSI",170,0)
 N ARRAY
"RTN","PSJPADSI",171,0)
 S ARRAY(1)=" CAUTION: The Calculated Device Balance is calculated using information"
"RTN","PSJPADSI",172,0)
 S ARRAY(2)=" received from the dispensing system. Verify the balance on the dispensing"
"RTN","PSJPADSI",173,0)
 S ARRAY(3)=" device before making edits to this field."
"RTN","PSJPADSI",174,0)
 S ARRAY(4)=""
"RTN","PSJPADSI",175,0)
 D WRITE(.ARRAY)
"RTN","PSJPADSI",176,0)
 Q
"RTN","PSJPADSI",177,0)
RBALHLP ; User help for REPORTED DEVICE BALANCE (#2) field in DRUG (DEVICE) (#58.60111) sub-file.
"RTN","PSJPADSI",178,0)
 N ARRAY
"RTN","PSJPADSI",179,0)
 S ARRAY(1)=" CAUTION: The Reported Device Balance is received directly from the"
"RTN","PSJPADSI",180,0)
 S ARRAY(2)=" dispensing system. Verify the balance on the dispensing device before"
"RTN","PSJPADSI",181,0)
 S ARRAY(3)=" making edits to this field, or correct the balance on the PADE system."
"RTN","PSJPADSI",182,0)
 S ARRAY(4)=""
"RTN","PSJPADSI",183,0)
 D WRITE(.ARRAY)
"RTN","PSJPADSI",184,0)
 Q
"RTN","PSJPADSI",185,0)
 ;
"RTN","PSJPADSI",186,0)
DRGINHLP ; User help for INACTIVE DATE/TIME (#3) field in the DRUG (DEVICE) (#58.60111) sub-file.
"RTN","PSJPADSI",187,0)
 N ARRAY
"RTN","PSJPADSI",188,0)
 S ARRAY(1)=" Enter the Date/Time a drug was completely removed from the device,"
"RTN","PSJPADSI",189,0)
 S ARRAY(2)=" indicating the drug will no longer be available from that device."
"RTN","PSJPADSI",190,0)
 S ARRAY(3)=""
"RTN","PSJPADSI",191,0)
 D WRITE(.ARRAY)
"RTN","PSJPADSI",192,0)
 Q
"RTN","PSJPADSI",193,0)
 ;
"RTN","PSJPADSI",194,0)
DIVHLP ; User help for DIVISION (#3) field, sub-file 58.6013.
"RTN","PSJPADSI",195,0)
 N ARRAY
"RTN","PSJPADSI",196,0)
 S ARRAY(1)=" Enter a Medical Center Division associated with this PADE inbound system."
"RTN","PSJPADSI",197,0)
 S ARRAY(2)=" PADE dispensing devices may be associated with Divisions so that PADE"
"RTN","PSJPADSI",198,0)
 S ARRAY(3)=" inventory may be updated accurately in VistA."
"RTN","PSJPADSI",199,0)
 S ARRAY(4)=""
"RTN","PSJPADSI",200,0)
 D WRITE(.ARRAY)
"RTN","PSJPADSI",201,0)
 Q
"RTN","PSJPADSI",202,0)
 ;
"RTN","PSJPADSI",203,0)
WRITE(ARRAY) ; Write contents of ARRAY to screen
"RTN","PSJPADSI",204,0)
 D EN^DDIOL(.ARRAY)
"RTN","PSJPADSI",205,0)
 Q
"RTN","PSJPADSI",206,0)
 ;
"RTN","PSJPADSI",207,0)
DWOIN(DWOTIM) ; Input Transform-Dispensed without orders-length of time after dispense that order creation is allowed
"RTN","PSJPADSI",208,0)
 N DWOVAL,UNIT,MULT,NUM
"RTN","PSJPADSI",209,0)
 S NUM=+DWOTIM
"RTN","PSJPADSI",210,0)
 S UNIT=$E($P(DWOTIM,NUM,2))
"RTN","PSJPADSI",211,0)
 Q:'$G(DWOTIM) 0
"RTN","PSJPADSI",212,0)
 S MULT=$S(UNIT="H":60,UNIT="D":1440,UNIT="M":1,UNIT="S":1/60,1:1)
"RTN","PSJPADSI",213,0)
 S DWOVAL=DWOTIM*MULT
"RTN","PSJPADSI",214,0)
 Q $$ROUND(DWOVAL)
"RTN","PSJPADSI",215,0)
 ;
"RTN","PSJPADSI",216,0)
ROUND(NUM) ; Round
"RTN","PSJPADSI",217,0)
 Q:'NUM 0
"RTN","PSJPADSI",218,0)
 N DIV,REM
"RTN","PSJPADSI",219,0)
 S DIV=NUM\1,REM=NUM#1
"RTN","PSJPADSI",220,0)
 S DIV=$S(REM<.5:DIV,1:DIV+1)
"RTN","PSJPADSI",221,0)
 Q DIV
"RTN","PSJPADSI",222,0)
 ;
"RTN","PSJPADSI",223,0)
ASKDONE() ; Ask next action
"RTN","PSJPADSI",224,0)
 N DIR,PSJSNAM,X,Y
"RTN","PSJPADSI",225,0)
 S PSJSNAM=$P($G(^PS(58.601,+$G(PSJPSYS),0)),"^")
"RTN","PSJPADSI",226,0)
 S DIR(0)="S^R:Re-edit "_PSJSNAM_" System;D:Edit "_$S(PSJSNAM]"":PSJSNAM_" ",1:"")_"PADE Devices;Q:Quit"
"RTN","PSJPADSI",227,0)
 S DIR("A",1)="Finished editing PADE System "_PSJSNAM
"RTN","PSJPADSI",228,0)
 S DIR("A")="(R)e-edit PADE system, edit (D)evice, or (Q)uit (R,D,Q)"
"RTN","PSJPADSI",229,0)
 D ^DIR S PSJASKDN=$S(Y="R":1,Y="D":2,1:3)
"RTN","PSJPADSI",230,0)
 Q PSJASKDN
"RTN","PSJPADSI",231,0)
 ;
"RTN","PSJPADSI",232,0)
DWODEV(CABNUM) ; Prompt for Dispensed Without Orders Mail Group for Device CABINET
"RTN","PSJPADSI",233,0)
 N DIC,DA,DR,X,Y,DIE,DR,CABNAME,PSJPSYS,DWOIEN,DP,DL,DI
"RTN","PSJPADSI",234,0)
 Q:'$G(CABNUM)
"RTN","PSJPADSI",235,0)
 D GETS^DIQ(58.63,+CABNUM,".01;1","IE","CABNAME")
"RTN","PSJPADSI",236,0)
 S CABNAME=$G(CABNAME(58.63,CABNUM_",",.01,"E"))
"RTN","PSJPADSI",237,0)
 S PSJPSYS=$G(CABNAME(58.63,CABNUM_",",1,"I"))
"RTN","PSJPADSI",238,0)
 Q:(CABNAME="")
"RTN","PSJPADSI",239,0)
 S DWOIEN=$$FIND1^DIC(58.6014,","_+$G(PSJPSYS)_",","","PC."_CABNAME)
"RTN","PSJPADSI",240,0)
 I 'DWOIEN D  Q:'DWOIEN
"RTN","PSJPADSI",241,0)
 .N DIC,DA,DR,X,Y,DIE,DR,DP,DL,DO,DI
"RTN","PSJPADSI",242,0)
 .S DIC="^PS(58.601,"_PSJPSYS_",2,",DIC(0)="ZL",DIC("P")="58.6014V"
"RTN","PSJPADSI",243,0)
 .S DA(1)=PSJPSYS,X=CABNUM_";PS(58.63,"
"RTN","PSJPADSI",244,0)
 .D FILE^DICN I Y>0 S DWOIEN=+Y
"RTN","PSJPADSI",245,0)
 Q:'DWOIEN
"RTN","PSJPADSI",246,0)
 W ! D EN^DDIOL("DWO ENTITY: "_CABNAME)
"RTN","PSJPADSI",247,0)
 S DIE="^PS(58.601,"_PSJPSYS_",2,",DA=+DWOIEN,DA(1)=+PSJPSYS,DR="1" D ^DIE
"RTN","PSJPADSI",248,0)
 Q
"RTN","PSJPADSI",249,0)
 ;
"RTN","PSJPADSI",250,0)
DRGFLAG(DFN,PSGORD,PSJDFLOC,ON,PSJNEWOE) ; Get flag indicating order is PADE order
"RTN","PSJPADSI",251,0)
 N PSJPSYS,PSJDRGCT,PSJLOC,PSJDSTK,PSJLOCTP,PSDRGTOT,PSDRUG,PSJRFND,X,Y,PSJNOTPD
"RTN","PSJPADSI",252,0)
 I '$G(PSGORD),$G(PSJNEWOE),$G(ON)["P" N PSGORD S PSGORD=$G(ON)  ; If new order, no order number passed in
"RTN","PSJPADSI",253,0)
 ; Patient DFN and order PSGORD are required, quit if not passed
"RTN","PSJPADSI",254,0)
 Q:'$G(DFN)!'$G(PSGORD) ""
"RTN","PSJPADSI",255,0)
 ;
"RTN","PSJPADSI",256,0)
 S PSJRFND=0
"RTN","PSJPADSI",257,0)
 ; Unit Dose Active, Pending, Non-Verified
"RTN","PSJPADSI",258,0)
 I PSGORD["U"!(PSGORD["P") D  Q PSJRFND
"RTN","PSJPADSI",259,0)
 .I $S(PSGORD["U":'$D(^PS(55,+$G(DFN),5,+$G(PSGORD),1)),1:'$D(^PS(53.1,+PSGORD,1))) S PSJRFND="" Q
"RTN","PSJPADSI",260,0)
 .N PSDDIEN
"RTN","PSJPADSI",261,0)
 .D:PSGORD["U" GETUDRG(DFN,PSGORD,.PSJLOC,.PSJLOCTP,.PSDRUG)
"RTN","PSJPADSI",262,0)
 .D:PSGORD["P" GETPDRG(DFN,PSGORD,.PSJLOC,.PSJLOCTP,.PSDRUG)
"RTN","PSJPADSI",263,0)
 .S PSJRFND=$$PSJRFND(DFN,PSGORD,.PSJLOC,.PSJLOCTP,.PSDRUG)
"RTN","PSJPADSI",264,0)
 ;
"RTN","PSJPADSI",265,0)
 ; Complex orders
"RTN","PSJPADSI",266,0)
 I PSGORD=+PSGORD D  Q PSJRFND
"RTN","PSJPADSI",267,0)
 .N PSJPRNT S PSJPRNT=+PSGORD
"RTN","PSJPADSI",268,0)
 .S PSGORD=0 F  S PSGORD=$O(^PS(53.1,"ACX",PSJPRNT,PSGORD)) Q:'PSGORD!$G(PSJRFND)  D
"RTN","PSJPADSI",269,0)
 ..Q:'$D(^PS(53.1,+PSGORD,0))  N PSDDIEN
"RTN","PSJPADSI",270,0)
 ..D GETPDRG(DFN,PSGORD_"P",.PSJLOC,.PSJLOCTP,.PSDRUG)
"RTN","PSJPADSI",271,0)
 ..S PSJRFND=$$PSJRFND(DFN,PSGORD_"P",.PSJLOC,.PSJLOCTP,.PSDRUG)
"RTN","PSJPADSI",272,0)
 ;
"RTN","PSJPADSI",273,0)
 Q PSJRFND
"RTN","PSJPADSI",274,0)
 ;
"RTN","PSJPADSI",275,0)
DRGSTOCK(DFN,PSGORD,PSJDFLOC,PS5345,DRGIEN) ; Get Quantity of Drug in PADE for patient DFN order PSGORD
"RTN","PSJPADSI",276,0)
 ; PSGORD = Clinic Order - find PADEs associated with the Clinic, return total quantity in all qualifying PADEs
"RTN","PSJPADSI",277,0)
 ; PSGORD = Regular UD order - find PADEs associated with patient's ward location, return total quantity in all PADEs
"RTN","PSJPADSI",278,0)
 ;
"RTN","PSJPADSI",279,0)
 N PSJPSYS,PSJDRGCT,PSJLOC,PSJDSTK,PSJLOCTP,PSDRGTOT,PSDRUG,PSDRFND,X,Y,PSJNOTPD
"RTN","PSJPADSI",280,0)
 S PSJDSTK="",PSDRGTOT=0
"RTN","PSJPADSI",281,0)
 ; Patient DFN and order PSGORD are required, quit if not passed
"RTN","PSJPADSI",282,0)
 I '$G(DFN) Q ""
"RTN","PSJPADSI",283,0)
 I '$G(PSGORD) D  I '$G(DRGIEN)!'$G(PSJLOC) Q ""
"RTN","PSJPADSI",284,0)
 .S PSGORD=""
"RTN","PSJPADSI",285,0)
 .S PSJLOCTP=$P(PSJDFLOC,+PSJDFLOC,2) Q:PSJLOCTP=""
"RTN","PSJPADSI",286,0)
 .S PSJLOC=+$G(PSJDFLOC)
"RTN","PSJPADSI",287,0)
 ;
"RTN","PSJPADSI",288,0)
 ;Get location and default drug ien for Active UD and NON-VERIFIED/PENDING UD order.
"RTN","PSJPADSI",289,0)
 ; If a specific drug was passed in via DRGIEN or PS5345 skip this and find balance for that drug
"RTN","PSJPADSI",290,0)
 I PSGORD["U"!(PSGORD["P") S PSDRFND="" D  Q:PSDRFND]"" PSDRFND
"RTN","PSJPADSI",291,0)
 .Q:$S(PSGORD["U":'$D(^PS(55,+$G(DFN),5,+$G(PSGORD),0)),1:'$D(^PS(53.1,+PSGORD,0)))
"RTN","PSJPADSI",292,0)
 .N PSDDIEN
"RTN","PSJPADSI",293,0)
 .D:PSGORD["U" GETUDRG(DFN,PSGORD,.PSJLOC,.PSJLOCTP,.PSDRUG)
"RTN","PSJPADSI",294,0)
 .D:PSGORD["P" GETPDRG(DFN,PSGORD,.PSJLOC,.PSJLOCTP,.PSDRUG)
"RTN","PSJPADSI",295,0)
 ;
"RTN","PSJPADSI",296,0)
 ; If pointer to DISPENSE DRUG multiple (#2) in INPATIENT USER PARAMETERS (#53.45) file is passed, get default drug ien
"RTN","PSJPADSI",297,0)
 I $G(PS5345) N TMP S TMP=+$G(^PS(53.45,+$G(PSJSYSP),2,+$G(PS5345),0)) I $G(TMP) S PSDRUG=TMP
"RTN","PSJPADSI",298,0)
 ; If a specific drug ien pointer to DRUG file (#50) is passed in, use that
"RTN","PSJPADSI",299,0)
 I $G(DRGIEN) S PSDRUG=+DRGIEN
"RTN","PSJPADSI",300,0)
 ;
"RTN","PSJPADSI",301,0)
 I '$G(PSDRUG) Q "NA"
"RTN","PSJPADSI",302,0)
 ;
"RTN","PSJPADSI",303,0)
 S PSDRGTOT=$$DRGQTY(PSDRUG,PSJLOCTP,PSJLOC)
"RTN","PSJPADSI",304,0)
 Q PSDRGTOT
"RTN","PSJPADSI",305,0)
 ;
"RTN","PSJPADSI",306,0)
GETUDRG(DFN,PSGORD,PSJLOC,PSJLOCTP,PSDRUG) ; Get UD order location and drug from UD multiple (#62) of PHARMACY PATIENT file (#55)
"RTN","PSJPADSI",307,0)
 ; 
"RTN","PSJPADSI",308,0)
 K PSJLOC,PSJLOCTP,PSDRUG N DDCNT,TMPDRG,TMPLOC
"RTN","PSJPADSI",309,0)
 S DDCNT=0 F  S DDCNT=$O(^PS(55,+$G(DFN),5,+PSGORD,1,DDCNT)) Q:'DDCNT  D
"RTN","PSJPADSI",310,0)
 .S TMPDRG=+$G(^PS(55,+DFN,5,+PSGORD,1,DDCNT,0))
"RTN","PSJPADSI",311,0)
 .S:TMPDRG PSDRUG(TMPDRG)=""
"RTN","PSJPADSI",312,0)
 .S:'$G(PSDRUG) PSDRUG=TMPDRG
"RTN","PSJPADSI",313,0)
 S TMPLOC=$G(^PS(55,+DFN,5,+PSGORD,8)),PSJLOCTP="CL" S PSJLOC=$S(+TMPLOC&$P(TMPLOC,"^",2):+TMPLOC,1:"")
"RTN","PSJPADSI",314,0)
 I 'PSJLOC N VAIN,VAINDT,VAHOW,VAROOT D INP^VADPT S PSJLOC=$G(VAIN(4)) S PSJLOCTP="WD"
"RTN","PSJPADSI",315,0)
 Q
"RTN","PSJPADSI",316,0)
 ;
"RTN","PSJPADSI",317,0)
GETPDRG(DFN,PSGORD,PSJLOC,PSJLOCTP,PSDRUG) ; Get UD order location and drug from NON VERIFIED/PENDING file (#53.1)
"RTN","PSJPADSI",318,0)
 ;
"RTN","PSJPADSI",319,0)
 K PSJLOC,PSJLOCTP,PSDRUG N DDCNT,TMPDRG,TMPLOC
"RTN","PSJPADSI",320,0)
 S DDCNT=0 F  S DDCNT=$O(^PS(53.1,+PSGORD,1,DDCNT)) Q:'DDCNT  D
"RTN","PSJPADSI",321,0)
 .S TMPDRG=+$G(^PS(53.1,+PSGORD,1,DDCNT,0))
"RTN","PSJPADSI",322,0)
 .S:TMPDRG PSDRUG(TMPDRG)=""
"RTN","PSJPADSI",323,0)
 .S:'$G(PSDRUG) PSDRUG=TMPDRG
"RTN","PSJPADSI",324,0)
 S TMPLOC=$G(^PS(53.1,+PSGORD,"DSS")),PSJLOCTP="CL" S PSJLOC=$S(+TMPLOC&$P(TMPLOC,"^",2):+TMPLOC,1:"")
"RTN","PSJPADSI",325,0)
 I 'PSJLOC N VAIN D INP^VADPT S PSJLOC=$G(VAIN(4)),PSJLOCTP="WD"
"RTN","PSJPADSI",326,0)
 I $D(PSDRUG)<10 D
"RTN","PSJPADSI",327,0)
 .N PSJOI S PSJOI=+$G(^PS(53.1,+PSGORD,.2))
"RTN","PSJPADSI",328,0)
 Q
"RTN","PSJPADSI",329,0)
 ;
"RTN","PSJPADSI",330,0)
DRGQTY(DRGIEN,LOCTYP,LOCIEN) ; Get PADE quantity for drug DRGIEN for location LOCIEN
"RTN","PSJPADSI",331,0)
 ;
"RTN","PSJPADSI",332,0)
 ; Input: DRGIEN - Drug IEN pointer to DRUG (#50) file
"RTN","PSJPADSI",333,0)
 ;        LOCTYP - Location Type - "WD"=Ward, "WG"=Ward Group, "CL"=Clinic, "CG"=Clinic Group
"RTN","PSJPADSI",334,0)
 ;        LOCIEN - Location IEN, if LOCTYP="WD" :  pointer to Ward (#42) 
"RTN","PSJPADSI",335,0)
 ;                               if LOCTYP="WG" :  Ward Group (#57.5) 
"RTN","PSJPADSI",336,0)
 ;                               if LOCTYP="CL" :  Clinic (#44)  
"RTN","PSJPADSI",337,0)
 ;                               if LOCTYP="CG" :  Clinic Group (#57.8) 
"RTN","PSJPADSI",338,0)
 ;
"RTN","PSJPADSI",339,0)
 N PSJPSYS,PSJDEV,PSJDRGCT,PSJCAB,PSJSUBFI
"RTN","PSJPADSI",340,0)
 S PSJDRGCT="NA"
"RTN","PSJPADSI",341,0)
 ; Get proper location subfile in PADE DISPENSING DEVICE (#58.63)
"RTN","PSJPADSI",342,0)
 S PSJSUBFI=$S(LOCTYP="WG":58.635,LOCTYP="WD":58.636,LOCTYP="CG":58.637,LOCTYP="CL":58.638,1:"")
"RTN","PSJPADSI",343,0)
 ; Bad location type
"RTN","PSJPADSI",344,0)
 Q:'PSJSUBFI PSJDRGCT
"RTN","PSJPADSI",345,0)
 ; Get total sum of quantities of drug DRGIEN in each cabinet
"RTN","PSJPADSI",346,0)
 S PSJCAB=0 F  S PSJCAB=$O(^PS(58.601,"DRG",DRGIEN,PSJCAB)) Q:'PSJCAB  D
"RTN","PSJPADSI",347,0)
 .I $$CABLOC(PSJCAB,PSJSUBFI,+LOCIEN) S PSJDRGCT=PSJDRGCT+$$GETCABCT(PSJCAB,DRGIEN)
"RTN","PSJPADSI",348,0)
 Q PSJDRGCT
"RTN","PSJPADSI",349,0)
 ;
"RTN","PSJPADSI",350,0)
CABLOC(PSJCAB,PSJSUBFI,LOCIEN) ; Return true if location LOCIEN is linked to cabinet PSJCAB
"RTN","PSJPADSI",351,0)
 ;
"RTN","PSJPADSI",352,0)
 N CABLOC,CLINAM,PARTIAL,CABSTAT
"RTN","PSJPADSI",353,0)
 ; If PADE device is Inactive, return false
"RTN","PSJPADSI",354,0)
 D GETS^DIQ(58.63,PSJCAB_",",4,"I","CABSTAT")
"RTN","PSJPADSI",355,0)
 Q:$G(CABSTAT("58.63",PSJCAB_",",4,"I"))="I" ""
"RTN","PSJPADSI",356,0)
 ; Check if ward is directly linked to cabinet
"RTN","PSJPADSI",357,0)
 D LIST^DIC(PSJSUBFI,","_+$G(PSJCAB)_",","@;.01","PI","","","","","I ^(0)="_+$G(LOCIEN),"","CABLOC")
"RTN","PSJPADSI",358,0)
 S CABLOC=$S($G(CABLOC("DILIST",1,0)):1,1:0)
"RTN","PSJPADSI",359,0)
 ; If no match and looking for ward, check all wards linked to cabinet's ward groups
"RTN","PSJPADSI",360,0)
 I 'CABLOC,($G(PSJSUBFI)=58.636) S CABLOC=$$CHKWG^PSJPAD50(PSJCAB,+LOCIEN)
"RTN","PSJPADSI",361,0)
 ; If no match and looking for clinic, check all clinics linked to cabinet's clinic groups
"RTN","PSJPADSI",362,0)
 I 'CABLOC,($G(PSJSUBFI)=58.638) S CABLOC=$$CHKCG^PSJPAD50(PSJCAB,+LOCIEN) I 'CABLOC D
"RTN","PSJPADSI",363,0)
 .; If no match and looking for clinic, check all clinic wildcards linked to cabinet
"RTN","PSJPADSI",364,0)
 .D GETS^DIQ(44,+LOCIEN,".01",,"CLINAM") D
"RTN","PSJPADSI",365,0)
 ..S CLINAM=$G(CLINAM(44,+LOCIEN_",",".01")),PARTIAL=$E(CLINAM,1,2)
"RTN","PSJPADSI",366,0)
 ..F  S PARTIAL=$O(^PS(58.63,"WC",PARTIAL)) Q:$E(PARTIAL,1,3)'=$E(CLINAM,1,3)!$G(CABLOC)  D
"RTN","PSJPADSI",367,0)
 ...Q:'($E(CLINAM,1,$L(PARTIAL))=PARTIAL)
"RTN","PSJPADSI",368,0)
 ...I $D(^PS(58.63,"WC",PARTIAL,PSJCAB)) S CABLOC=1
"RTN","PSJPADSI",369,0)
 Q CABLOC
"RTN","PSJPADSI",370,0)
 ;
"RTN","PSJPADSI",371,0)
GETCABCT(CAB,DRG) ; Get PADE count of drug DRG for cabinet CAB
"RTN","PSJPADSI",372,0)
 N SYSDA,DEVDA,DRGDA,CABCT,CABSTAT
"RTN","PSJPADSI",373,0)
 S CABCT=0
"RTN","PSJPADSI",374,0)
 S SYSDA=$O(^PS(58.601,"DRG",+$G(DRG),+$G(CAB),0)) Q:'SYSDA 0
"RTN","PSJPADSI",375,0)
 S DEVDA=$O(^PS(58.601,"DRG",+$G(DRG),+$G(CAB),SYSDA,0)) Q:'DEVDA 0
"RTN","PSJPADSI",376,0)
 S DRGDA=$O(^PS(58.601,"DRG",+$G(DRG),+$G(CAB),SYSDA,DEVDA,0)) Q:'DRGDA 0
"RTN","PSJPADSI",377,0)
 ;
"RTN","PSJPADSI",378,0)
 D GETS^DIQ(58.60111,DRGDA_","_DEVDA_","_SYSDA_",",2,"","CABCT")
"RTN","PSJPADSI",379,0)
 D GETS^DIQ(58.63,CAB_",",4,"I","CABSTAT")
"RTN","PSJPADSI",380,0)
 Q:$G(CABSTAT("58.63",CAB_",",4,"I"))="I" ""
"RTN","PSJPADSI",381,0)
 ;
"RTN","PSJPADSI",382,0)
 Q +$G(CABCT(58.60111,DRGDA_","_DEVDA_","_SYSDA_",",2))
"RTN","PSJPADSI",383,0)
 ;
"RTN","PSJPADSI",384,0)
PSJOE ; Set the PSJ PADE OE BALANCES kernel parameter
"RTN","PSJPADSI",385,0)
 ; 
"RTN","PSJPADSI",386,0)
 N PSJMSG,PSPARIEN,X,Y
"RTN","PSJPADSI",387,0)
 N DIR,X,Y,PSYSTAT
"RTN","PSJPADSI",388,0)
 S PSPARIEN=$$FIND1^DIC(8989.51,,,"PSJ PADE OE BALANCES")
"RTN","PSJPADSI",389,0)
 Q:'PSPARIEN
"RTN","PSJPADSI",390,0)
 S PSJMSG(0)=" "
"RTN","PSJPADSI",391,0)
 S PSJMSG(1)="The PSJ PADE OE INDICATORS Parameter toggles the display of the"
"RTN","PSJPADSI",392,0)
 S PSJMSG(2)="PADE flag (PD) in Inpatient Order Entry and the display of PADE"
"RTN","PSJPADSI",393,0)
 S PSJMSG(3)="drug balances during entry of an order's Dispense Drug"
"RTN","PSJPADSI",394,0)
 D EN^DDIOL(.PSJMSG)
"RTN","PSJPADSI",395,0)
 S DIR("B")=$$GET^XPAR("SYS","PSJ PADE OE BALANCES")
"RTN","PSJPADSI",396,0)
 I DIR("B") S DIR("B")=$$DEVSTCHK^PSJPDRU1(+$G(PSJPSYS))
"RTN","PSJPADSI",397,0)
 S DIR("B")=$S(DIR("B")="":"",DIR("B")=1:"YES",1:"NO")
"RTN","PSJPADSI",398,0)
 S DIR(0)="Y"
"RTN","PSJPADSI",399,0)
 S DIR("A")="DISPLAY PADE INDICATORS IN IOE"
"RTN","PSJPADSI",400,0)
 S DIR("?",1)=" This activates/deactivates PADE indicators in Inpatient"
"RTN","PSJPADSI",401,0)
 S DIR("?")=" Order Entry (IOE) for this vendor only."
"RTN","PSJPADSI",402,0)
 D ^DIR
"RTN","PSJPADSI",403,0)
 S PSYSTAT=$S(Y=1:1,Y=0:0,1:"")
"RTN","PSJPADSI",404,0)
 Q:PSYSTAT=""
"RTN","PSJPADSI",405,0)
 D DEVONOFF^PSJPDRU1(+$G(PSJPSYS),PSYSTAT)
"RTN","PSJPADSI",406,0)
 D INSYSPAR^PSJPDRU1(PSYSTAT)
"RTN","PSJPADSI",407,0)
 Q
"RTN","PSJPADSI",408,0)
 ;
"RTN","PSJPADSI",409,0)
 ;CHG^XPAR(ENT,PAR,INST,VAL,ERR) ; change parameter value for a given instance
"RTN","PSJPADSI",410,0)
 ;EDIT(Entity,Parameter)
"RTN","PSJPADSI",411,0)
 Q
"RTN","PSJPADSI",412,0)
 ;
"RTN","PSJPADSI",413,0)
PSJRFND(DFN,PSGORD,PSJLOC,PSJLOCTP,PSDRUG) ; Return a flag indicating all Dispense Drugs in the order are PADE drugs
"RTN","PSJPADSI",414,0)
 ;
"RTN","PSJPADSI",415,0)
 N PSJPDCHK S PSJPDCHK=1
"RTN","PSJPADSI",416,0)
 ; Quit if patient/order location not linked to PADE
"RTN","PSJPADSI",417,0)
 I $G(PSJLOCTP)="CL",$G(PSJLOC) S PSJPDCHK=$$PADECL^PSJPAD50(+$G(PSJLOC))
"RTN","PSJPADSI",418,0)
 I $G(PSJLOCTP)="WD",$G(PSJLOC) S PSJPDCHK=$$PADEWD^PSJPAD50(+$G(PSJLOC))
"RTN","PSJPADSI",419,0)
 Q:'$G(PSJPDCHK) ""
"RTN","PSJPADSI",420,0)
 ;
"RTN","PSJPADSI",421,0)
 S (PSJNOTPD,PSJRFND)=0
"RTN","PSJPADSI",422,0)
 S PSDDIEN=0 F  Q:PSJNOTPD  S PSDDIEN=$O(PSDRUG(PSDDIEN)) Q:'PSDDIEN!PSJNOTPD  D
"RTN","PSJPADSI",423,0)
 .N INACT,DDX S DDX=$O(^PS(53.45,+$G(PSJSYSP),2,"B",PSDDIEN,0)) I DDX S INACT=$P($G(^PS(53.45,+$G(PSJSYSP),2,DDX,0)),"^",3)
"RTN","PSJPADSI",424,0)
 .Q:$G(INACT)&($G(INACT)<$P($$FMADD^XLFDT($$NOW^XLFDT,1),"."))
"RTN","PSJPADSI",425,0)
 .S PSJRFND=$$DRGQTY(PSDDIEN,PSJLOCTP,PSJLOC)
"RTN","PSJPADSI",426,0)
 .S:'(PSJRFND?1.N) PSJNOTPD=1
"RTN","PSJPADSI",427,0)
 S:PSJNOTPD PSJRFND=""
"RTN","PSJPADSI",428,0)
 Q PSJRFND
"RTN","PSJPDAPP")
0^26^B26391444^n/a
"RTN","PSJPDAPP",1,0)
PSJPDAPP ;BIR/MHA - SEND APPOINTMENTS TO PADE ;11/27/15
"RTN","PSJPDAPP",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**317**;16 DEC 97;Build 130
"RTN","PSJPDAPP",3,0)
 ;Reference to ^PS(55 is supported by DBIA 2191
"RTN","PSJPDAPP",4,0)
 ;Reference to ^ORD(101 supported by DBIA 872
"RTN","PSJPDAPP",5,0)
 ;Reference to GETPLIST^SDAMA202 supported by DBIA 3869
"RTN","PSJPDAPP",6,0)
 ;Reference to ^SC supported by DBIA 10040
"RTN","PSJPDAPP",7,0)
 ;Reference to ^DPT supported by DBIA 10035
"RTN","PSJPDAPP",8,0)
 Q
"RTN","PSJPDAPP",9,0)
 ;
"RTN","PSJPDAPP",10,0)
EN ;
"RTN","PSJPDAPP",11,0)
 N PDA,PDCL,PDCLA,PDI,PDJ,PDK,PSJAP,PSJCLPD,PSJPDNM,PSJDIV,DTP,SA,SEQ,I,J,K,L,P,X,Y,Z,PSJNIP,X1,X2
"RTN","PSJPDAPP",12,0)
 S (DTP,PSJAP,I)=0
"RTN","PSJPDAPP",13,0)
 F  S I=$O(^PS(58.7,I)) Q:'I  S J=$$PDACT^PSJPDCLA(I)
"RTN","PSJPDAPP",14,0)
 Q:'PSJAP
"RTN","PSJPDAPP",15,0)
 S I=0 F  S I=$O(PSJAP(I)) Q:'I  D
"RTN","PSJPDAPP",16,0)
 . S DTP=+$G(^PS(58.7,I,1))
"RTN","PSJPDAPP",17,0)
 . S J=0 F  S J=$O(^PS(58.7,I,"DIV",J)) Q:'J  D
"RTN","PSJPDAPP",18,0)
 .. S Y=$G(^PS(58.7,I,"DIV",J,0)) I Y=""!($P(Y,"^",2)&($P(Y,"^",2)<DT)) Q
"RTN","PSJPDAPP",19,0)
 .. S SA=""
"RTN","PSJPDAPP",20,0)
 .. I $P(Y,"^",9)="Y" S:$P(Y,"^",4) SA=$P($G(^PS(58.71,$P(Y,"^",4),0)),"^") D ALLCLN   ;send appt for all clinics
"RTN","PSJPDAPP",21,0)
 .. D CLARR
"RTN","PSJPDAPP",22,0)
 M PDCL=PDCLA
"RTN","PSJPDAPP",23,0)
 Q:'$D(PDCL)
"RTN","PSJPDAPP",24,0)
 N SNM,CNM S SNM="PSJ SIU-S12 SERVER",CNM="PSJ SIU-S12 CLIENT"
"RTN","PSJPDAPP",25,0)
 I '$O(^ORD(101,"B",SNM,0))!('$O(^ORD(101,"B",CNM,0))) Q
"RTN","PSJPDAPP",26,0)
 N NHL D INIT^HLFNC2(SNM,.NHL) Q:$D(NHL)=1
"RTN","PSJPDAPP",27,0)
 N NFS,NECH,HL,HLFS,NSEG,EDT,APT,DFN,PSJDTM,PSJND,PSJVP,PSJVNM,PSJDNS,PSJDNM,PSJOR,PSJORN
"RTN","PSJPDAPP",28,0)
 M HL=NHL S (NFS,HLFS)=HL("FS"),NECH=$E(HL("ECH"),1)
"RTN","PSJPDAPP",29,0)
 S PDI=0 F  S PDI=$O(PDCL(PDI)) Q:'PDI  D
"RTN","PSJPDAPP",30,0)
 . S PSJND=$G(^PS(58.7,PDI,0))
"RTN","PSJPDAPP",31,0)
 . S PSJVNM=$P(PSJND,"^"),PSJDNS=$P(PSJND,"^",2),PSJVP=$P(PSJND,"^",3)
"RTN","PSJPDAPP",32,0)
 . S PDJ=0 F  S PDJ=$O(PDCL(PDI,PDJ)) Q:'PDJ  D
"RTN","PSJPDAPP",33,0)
 .. S PSJDNM=$P($$SITE^VASITE(,PDJ),"^",3)
"RTN","PSJPDAPP",34,0)
 .. S PDK=0 F  S PDK=$O(PDCL(PDI,PDJ,PDK)) Q:'PDK  D APPT
"RTN","PSJPDAPP",35,0)
 Q
"RTN","PSJPDAPP",36,0)
 ;
"RTN","PSJPDAPP",37,0)
APPT ;
"RTN","PSJPDAPP",38,0)
 K ^TMP($J,"SDAMA202")
"RTN","PSJPDAPP",39,0)
 S PSJOR=PDK,PSJORN=$P(^SC(PDK,0),"^")
"RTN","PSJPDAPP",40,0)
 S DTP=PDCL(PDI,PDJ,PDK)
"RTN","PSJPDAPP",41,0)
 S EDT=DT
"RTN","PSJPDAPP",42,0)
 I DTP S X1=DT,X2=+DTP D C^%DTC S EDT=X
"RTN","PSJPDAPP",43,0)
 D GETPLIST^SDAMA202(PDK,"1;4","",DT,EDT)
"RTN","PSJPDAPP",44,0)
 Q:'$D(^TMP($J,"SDAMA202"))
"RTN","PSJPDAPP",45,0)
 K APDTM,CLNM
"RTN","PSJPDAPP",46,0)
 S PDA=0 F  S PDA=$O(^TMP($J,"SDAMA202","GETPLIST",PDA)) Q:'PDA  D
"RTN","PSJPDAPP",47,0)
 . S PSJDTM=+^TMP($J,"SDAMA202","GETPLIST",PDA,1)
"RTN","PSJPDAPP",48,0)
 . S DFN=+^TMP($J,"SDAMA202","GETPLIST",PDA,4)
"RTN","PSJPDAPP",49,0)
 . Q:$P($G(^DPT(DFN,.1)),"^")]""&($P(^PS(58.7,PDI,0),"^",6)'="Y")
"RTN","PSJPDAPP",50,0)
 . K NSEG N ZZ1,XX,FTS S (ZZ1,FTS)="",PSJNIP=0
"RTN","PSJPDAPP",51,0)
 . I $P($G(^DPT(DFN,.1)),"^")]"" D
"RTN","PSJPDAPP",52,0)
 .. D IN5^VADPT
"RTN","PSJPDAPP",53,0)
 .. N PSJQ,PSJWD,PSJRBD
"RTN","PSJPDAPP",54,0)
 .. S PSJWD=$P(VAIP(5),"^",2),PSJRBD=$P(VAIP(6),"^",2)
"RTN","PSJPDAPP",55,0)
 .. S PSJQ=$$CHKPD^PSJPDCL(PSJWD,PSJRBD)
"RTN","PSJPDAPP",56,0)
 .. I 'PSJQ S PSJNIP=1 Q
"RTN","PSJPDAPP",57,0)
 .. S FTS=$P(VAIP(8),"^")_NECH_$P(VAIP(8),"^",2)
"RTN","PSJPDAPP",58,0)
 .. S XX=0 F  S XX=$O(PSJQ(XX)) Q:'XX  D
"RTN","PSJPDAPP",59,0)
 ... I XX=PDI,$P(PSJQ(XX),"^",2)'="" S ZZ1=$P(PSJQ(XX),"^",2)
"RTN","PSJPDAPP",60,0)
 ... I XX'=PDI S PSJNIP=1
"RTN","PSJPDAPP",61,0)
 . S SEQ=0 D SRBLD^PSJPDCLA M HL=NHL N ZZ2 S ZZ2=$S($P(DTP,"^",2)'="":$P(DTP,"^",2),1:"")
"RTN","PSJPDAPP",62,0)
 . S SEQ=SEQ+1,NSEG(SEQ)="ZZZ"_HL("FS")_$S(ZZ1'="":ZZ1,1:"")_HL("FS")_ZZ2_HL("FS")_FTS
"RTN","PSJPDAPP",63,0)
 . K HLP,HLA,PSJSND S HLP="",HLP("SUBSCRIBER")="^^^^~"_PSJDNS_":"_PSJVP_"~DNS"
"RTN","PSJPDAPP",64,0)
 . N XX S XX=PDI D PV19 M HLA("HLS")=NSEG
"RTN","PSJPDAPP",65,0)
 . D GENERATE^HLMA(SNM,"LM",1,.PSJSND,"",.HLP)
"RTN","PSJPDAPP",66,0)
 . D LOG^PSJPADE
"RTN","PSJPDAPP",67,0)
 Q
"RTN","PSJPDAPP",68,0)
 ;
"RTN","PSJPDAPP",69,0)
ALLCLN ;
"RTN","PSJPDAPP",70,0)
 N ND S Z=0 F  S Z=$O(^SC(Z)) Q:'Z  D
"RTN","PSJPDAPP",71,0)
 .S ND=^SC(Z,0) Q:$P(ND,"^",3)'="C"  Q:$P(ND,"^",15)'=J
"RTN","PSJPDAPP",72,0)
 .I $D(^SC(Z,"I")) S X=$G(^SC(Z,"I")) I $P(X,"^"),$P(X,"^",2)'>$P(X,"^") Q
"RTN","PSJPDAPP",73,0)
 .S PDCL(I,J,Z)=DTP_$S(SA]"":"^"_SA,1:"")
"RTN","PSJPDAPP",74,0)
 Q
"RTN","PSJPDAPP",75,0)
 ;
"RTN","PSJPDAPP",76,0)
CLARR ;
"RTN","PSJPDAPP",77,0)
 S Z=0,SA=""
"RTN","PSJPDAPP",78,0)
 F  S Z=$O(^PS(58.7,I,"DIV",J,"CL",Z)) Q:'Z  S K=^PS(58.7,I,"DIV",J,"CL",Z,0) D:$P(K,"^",3)="Y"
"RTN","PSJPDAPP",79,0)
 . S SA=$P(K,"^",2)
"RTN","PSJPDAPP",80,0)
 . S:SA SA=$P($G(^PS(58.71,SA,0)),"^")
"RTN","PSJPDAPP",81,0)
 . S PDCLA(I,J,+K)=DTP_$S(SA]"":"^"_SA,1:"")
"RTN","PSJPDAPP",82,0)
 S Z=0
"RTN","PSJPDAPP",83,0)
 F  S Z=$O(^PS(58.7,I,"DIV",J,"PCG",Z)) Q:'Z  D:$P($G(^PS(58.7,I,"DIV",J,"PCG",Z,2)),"^")="Y"
"RTN","PSJPDAPP",84,0)
 . S SA=$P($G(^PS(58.7,I,"DIV",J,"PCG",Z,0)),"^",2)
"RTN","PSJPDAPP",85,0)
 . S:SA SA=$P($G(^PS(58.71,SA,0)),"^")
"RTN","PSJPDAPP",86,0)
 . S X=0 F  S X=$O(^PS(58.7,I,"DIV",J,"PCG",Z,1,X)) Q:'X  D
"RTN","PSJPDAPP",87,0)
 .. S K=+$G(^PS(58.7,I,"DIV",J,"PCG",Z,1,X,0))
"RTN","PSJPDAPP",88,0)
 .. I '$D(PDCLA(I,J,K)) S PDCLA(I,J,K)=DTP_$S(SA]"":"^"_SA,1:"")
"RTN","PSJPDAPP",89,0)
 S Z=0
"RTN","PSJPDAPP",90,0)
 F  S Z=$O(^PS(58.7,I,"DIV",J,"VCG",Z)) Q:'Z  S X=^PS(58.7,I,"DIV",J,"VCG",Z,0) D:$P(X,"^",3)="Y"
"RTN","PSJPDAPP",91,0)
 . S SA=$P(X,"^",2) S:SA SA=$P($G(^PS(58.71,SA,0)),"^")
"RTN","PSJPDAPP",92,0)
 . S Y=0 F  S Y=$O(^PS(57.8,+X,1,Y)) Q:'Y  D
"RTN","PSJPDAPP",93,0)
 .. S K=+^(Y,0) S:'$D(PDCLA(I,J,K)) PDCLA(I,J,K)=DTP_$S(SA]"":"^"_SA,1:"")
"RTN","PSJPDAPP",94,0)
 S Z=0,L=""
"RTN","PSJPDAPP",95,0)
 F  S Z=$O(^PS(58.7,I,"DIV",J,"WCN",Z)) Q:'Z  S X=^PS(58.7,I,"DIV",J,"WCN",Z,0) D:$P(X,"^",3)="Y"
"RTN","PSJPDAPP",96,0)
 . S SA=$P(X,"^",2) S:SA SA=$P($G(^PS(58.71,SA,0)),"^")
"RTN","PSJPDAPP",97,0)
 . S (Y,P)=$P(X,"^") F  S P=$O(^SC("B",P)) Q:P=""!($E(P,1,$L(Y))'=Y)  D
"RTN","PSJPDAPP",98,0)
 .. S K=$O(^SC("B",P,0)),L=$G(^SC(K,0)) Q:$P(L,"^",3)'="C"  Q:$P(L,"^",15)'=J
"RTN","PSJPDAPP",99,0)
 .. S:'$D(PDCLA(I,J,K)) PDCLA(I,J,K)=DTP_$S(SA]"":"^"_SA,1:"")
"RTN","PSJPDAPP",100,0)
 Q
"RTN","PSJPDAPP",101,0)
 ;
"RTN","PSJPDAPP",102,0)
PV19 ;
"RTN","PSJPDAPP",103,0)
 N NC,NDFN,NCLI,N19,NSA,NS,NWDI,NQ
"RTN","PSJPDAPP",104,0)
 S (NSA,N19)="",(NQ,NC)=0,NS=$E(HL("ECH"),1),PDL(10)=XX,PDL(4)=HL("ETN")
"RTN","PSJPDAPP",105,0)
 S:ZZ2]"" (NSA,PDL(12))=$O(^PS(58.71,"B",ZZ2,0))
"RTN","PSJPDAPP",106,0)
 S:ZZ1]"" PDL(11)=$O(^PS(58.71,"B",ZZ1,""))
"RTN","PSJPDAPP",107,0)
 F  S NC=$O(NSEG(NC)) Q:'NC  D  Q:NQ
"RTN","PSJPDAPP",108,0)
 . I $E(NSEG(NC),1,3)="PID" S (NDFN,PDL(1))=+$P(NSEG(NC),HL("FS"),4) Q
"RTN","PSJPDAPP",109,0)
 . I $E(NSEG(NC),1,3)="PV1" D  S NQ=1 Q
"RTN","PSJPDAPP",110,0)
 .. I $P(NSEG(NC),HL("FS"),12)]"" D
"RTN","PSJPDAPP",111,0)
 ... S NCLI=$P($P(NSEG(NC),HL("FS"),12),NS,2)
"RTN","PSJPDAPP",112,0)
 ... S:'NCLI NCLI=$O(^SC("B",$P($P(NSEG(NC),HL("FS"),12),NS),0))
"RTN","PSJPDAPP",113,0)
 ... S:NCLI PDL(5)=+$P($G(^SC(NCLI,0)),"^",15)
"RTN","PSJPDAPP",114,0)
 ... S N19=NDFN_"-"_$S(NSA]"":NSA_"S",1:NCLI),PDL(9)=N19 S:NCLI PDL(8)=NCLI
"RTN","PSJPDAPP",115,0)
 ... S $P(NSEG(NC),HL("FS"),20)=N19
"RTN","PSJPDAPP",116,0)
 .. I $P(NSEG(NC),HL("FS"),4)]"" D
"RTN","PSJPDAPP",117,0)
 ... S NWDI=$O(^DIC(42,"B",$P($P(NSEG(NC),HL("FS"),4),NS),0))
"RTN","PSJPDAPP",118,0)
 ... I NWDI S PDL(7)=NWDI S:'$G(PDL(5)) PDL(5)=+$P($G(^DIC(42,NWDI,0)),"^",11)
"RTN","PSJPDAPP",119,0)
 .. S:$P(NSEG(NC),HL("FS"),51)]"" PDL(6)=$P(NSEG(NC),HL("FS"),51)
"RTN","PSJPDAPP",120,0)
 Q
"RTN","PSJPDAPP",121,0)
 ;
"RTN","PSJPDCL")
0^3^B59118380^n/a
"RTN","PSJPDCL",1,0)
PSJPDCL ;BIR/MHA - PADE HL7 ADT MESSAGE CLIENT TO VAFC ADT SERVER ;07/08/15
"RTN","PSJPDCL",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**317**;16 DEC 97;Build 130
"RTN","PSJPDCL",3,0)
 ;Reference to ^SC supported by DBIA 10040
"RTN","PSJPDCL",4,0)
 ;Reference to ^DIC(42 supported by DBIA 10039
"RTN","PSJPDCL",5,0)
 ;Reference to ^ORD(101 supported by DBIA 872
"RTN","PSJPDCL",6,0)
 ;Reference to ^DG(405.4 supported by DBIA 1380
"RTN","PSJPDCL",7,0)
 ;Reference to ^GMRADPT supported by DBIA 10099
"RTN","PSJPDCL",8,0)
 ;Reference to ^GMRVUTL supported by DBIA 1120
"RTN","PSJPDCL",9,0)
 ;Reference to ^GMRAOR2 supported by DBIA 2422
"RTN","PSJPDCL",10,0)
 ;
"RTN","PSJPDCL",11,0)
 Q
"RTN","PSJPDCL",12,0)
 ;
"RTN","PSJPDCL",13,0)
EN ; Get ADT Message and send to PADE.
"RTN","PSJPDCL",14,0)
 Q:$O(^PS(58.7,"B",""))=""
"RTN","PSJPDCL",15,0)
 Q:'$G(HLEID)
"RTN","PSJPDCL",16,0)
 N PSJAP
"RTN","PSJPDCL",17,0)
 S PSJAP=0
"RTN","PSJPDCL",18,0)
 N I,J S I=0
"RTN","PSJPDCL",19,0)
 F  S I=$O(^PS(58.7,I)) Q:'I  S J=$$PDACT^PSJPDCLA(I)
"RTN","PSJPDCL",20,0)
 Q:'PSJAP
"RTN","PSJPDCL",21,0)
 I $G(HL("ETN"))="" D INIT^HLFNC2(HLEID,.HL) Q:$D(HL)=1
"RTN","PSJPDCL",22,0)
 N FS,ECH S FS=HL("FS"),ECH=$E(HL("ECH"),1)
"RTN","PSJPDCL",23,0)
 N SNM,SID,NHL S SNM="PSJ ADT-"_HL("ETN")_" SERVER"
"RTN","PSJPDCL",24,0)
 S SID=$O(^ORD(101,"B",SNM,0))
"RTN","PSJPDCL",25,0)
 Q:'SID
"RTN","PSJPDCL",26,0)
 D INIT^HLFNC2(SID,.NHL) Q:$D(NHL)=1
"RTN","PSJPDCL",27,0)
 N NFS,NECH S NFS=NHL("FS"),NECH=$E(NHL("ECH"),1)
"RTN","PSJPDCL",28,0)
 N NSEG,PSJQ,PSJLOC,PSJWARD,PSJRBD,SEQ,PSJX,VAIP,X,FTS
"RTN","PSJPDCL",29,0)
 S VAIP("D")="L" D IN5^VADPT S PSJRBD=$P(VAIP(6),"^",2),FTS=$S($P(VAIP(8),"^")]"":$P(VAIP(8),"^")_NECH_$P(VAIP(8),"^",2),1:"")
"RTN","PSJPDCL",30,0)
 S SEQ=0,PSJQ=0,PSJX=1
"RTN","PSJPDCL",31,0)
 F I=1:1 X HLNEXT Q:HLQUIT'>0!('PSJX)  D
"RTN","PSJPDCL",32,0)
 . Q:$E(HLNODE,1,3)="MSH"
"RTN","PSJPDCL",33,0)
 . Q:$E(HLNODE,1,3)="OBX"
"RTN","PSJPDCL",34,0)
 . Q:$E(HLNODE,1,3)="ROL"
"RTN","PSJPDCL",35,0)
 . Q:$E(HLNODE,1)="Z"
"RTN","PSJPDCL",36,0)
 . S SEQ=SEQ+1
"RTN","PSJPDCL",37,0)
 . S NSEG(SEQ)=$$TR(HLNODE)
"RTN","PSJPDCL",38,0)
 . S J=0 F  S J=$O(HLNODE(J)) Q:'J  S NSEG(SEQ,J)=$$TR(HLNODE(J))
"RTN","PSJPDCL",39,0)
 . I $E(HLNODE,1,3)="PV1" D
"RTN","PSJPDCL",40,0)
 .. S PSJLOC=$P(HLNODE,FS,4)
"RTN","PSJPDCL",41,0)
 .. S PSJWARD=$P(PSJLOC,ECH) Q:PSJWARD=""
"RTN","PSJPDCL",42,0)
 .. S PSJQ=$$CHKPD(PSJWARD,PSJRBD)
"RTN","PSJPDCL",43,0)
 .. I 'PSJQ S PSJX=0 Q
"RTN","PSJPDCL",44,0)
 .. D AGY
"RTN","PSJPDCL",45,0)
 Q:'PSJQ
"RTN","PSJPDCL",46,0)
 N XX,HL,HLFS,HLECH M HL=NHL
"RTN","PSJPDCL",47,0)
 S HLFS=NHL("FS")
"RTN","PSJPDCL",48,0)
 S HLECH=NHL("ECH")
"RTN","PSJPDCL",49,0)
 N ZTIO,ZTRTN,ZTSAVE,ZTDESC,ZTDTH
"RTN","PSJPDCL",50,0)
 S ZTIO=""
"RTN","PSJPDCL",51,0)
 S ZTRTN="SEND^PSJPDCL"
"RTN","PSJPDCL",52,0)
 F XX="PSJQ(","NSEG(","HLFS","HLECH","HL(","SNM","SID","FTS" S ZTSAVE(XX)=""
"RTN","PSJPDCL",53,0)
 S ZTDESC="PADE HL7 ADT Message Router"
"RTN","PSJPDCL",54,0)
 S ZTDTH=$H
"RTN","PSJPDCL",55,0)
 D ^%ZTLOAD
"RTN","PSJPDCL",56,0)
 Q
"RTN","PSJPDCL",57,0)
 ;
"RTN","PSJPDCL",58,0)
SEND ;
"RTN","PSJPDCL",59,0)
 N XX,CT,PSJND,PSJVNM,PSJDNS,PSJVP,VR,HLA,CNM,PSJSND
"RTN","PSJPDCL",60,0)
 M HLA("HLS")=NSEG
"RTN","PSJPDCL",61,0)
 Q:$G(SNM)=""
"RTN","PSJPDCL",62,0)
 I $G(HL("ETN"))="" D INIT^HLFNC2(SNM,.HL) Q:$D(HL)=1
"RTN","PSJPDCL",63,0)
 S CNM="PSJ ADT-"_HL("ETN")_" CLIENT"
"RTN","PSJPDCL",64,0)
 S XX=0,CT=0 F  S XX=$O(PSJQ(XX)) Q:'XX  D   ;sends HL7 message for each PADE SERVER
"RTN","PSJPDCL",65,0)
 .S PSJND=$G(^PS(58.7,XX,0))
"RTN","PSJPDCL",66,0)
 .Q:PSJND=""
"RTN","PSJPDCL",67,0)
 .S PSJVNM=$P(PSJND,"^"),PSJDNS=$P(PSJND,"^",2),PSJVP=$P(PSJND,"^",3)
"RTN","PSJPDCL",68,0)
 .Q:PSJVNM=""!(PSJDNS="")!('PSJVP)
"RTN","PSJPDCL",69,0)
 .N HLP,PSJSND,ZZ1,ZZ2 S (HLP,ZZ1,ZZ2)=""
"RTN","PSJPDCL",70,0)
 .I $G(HL("ETN"))="" D INIT^HLFNC2(SNM,.HL) Q:$D(HL)=1
"RTN","PSJPDCL",71,0)
 .K HLA,HLL M HLA("HLS")=NSEG
"RTN","PSJPDCL",72,0)
 .S HLP("SUBSCRIBER")="^^^^~"_PSJDNS_":"_PSJVP_"~DNS"
"RTN","PSJPDCL",73,0)
 .S HLL("LINKS",1)=CNM_"^"_"PSJ PADE",ZZ1=$P(PSJQ(XX),"^",2)
"RTN","PSJPDCL",74,0)
 .S CT=$O(HLA("HLS",9999),-1)+1 S:CT>1 HLA("HLS",CT)="ZZZ"_HL("FS")_ZZ1_HL("FS")_HL("FS")_FTS
"RTN","PSJPDCL",75,0)
 .D PV19^PSJPDAPP
"RTN","PSJPDCL",76,0)
 .D GENERATE^HLMA(SNM,"LM",1,.PSJSND,"",.HLP)
"RTN","PSJPDCL",77,0)
 .S:$G(PSJSND(1)) PSJSND=PSJSND(1)
"RTN","PSJPDCL",78,0)
 .D LOG^PSJPADE
"RTN","PSJPDCL",79,0)
 Q
"RTN","PSJPDCL",80,0)
 ;
"RTN","PSJPDCL",81,0)
TR(SEG) ; Translate the VAFC message delimiters to HL7 delimiters for PADE
"RTN","PSJPDCL",82,0)
 N CSEG
"RTN","PSJPDCL",83,0)
 S CSEG=$TR(SEG,HL("FS")_HL("ECH"),NHL("FS")_NHL("ECH"))
"RTN","PSJPDCL",84,0)
 S CSEG=$TR(CSEG,"""","")
"RTN","PSJPDCL",85,0)
 Q CSEG
"RTN","PSJPDCL",86,0)
 ;
"RTN","PSJPDCL",87,0)
CHKPD(PSJWD,PSJRB) ;
"RTN","PSJPDCL",88,0)
 N PSJWDI S PSJWDI=$O(^DIC(42,"B",PSJWD,"")) K PSJQ
"RTN","PSJPDCL",89,0)
 Q:'PSJWDI 0
"RTN","PSJPDCL",90,0)
 N PSJDIV,PSJDIVI S PSJDIV=+$P($G(^DIC(42,PSJWDI,0)),"^",11)
"RTN","PSJPDCL",91,0)
 Q:'PSJDIV 0
"RTN","PSJPDCL",92,0)
 N PSJPD,PSJSAR,PSJX S (PSJQ,PSJPD)=0
"RTN","PSJPDCL",93,0)
 F  S PSJPD=$O(^PS(58.7,"AD",PSJDIV,PSJPD)) Q:'PSJPD  D
"RTN","PSJPDCL",94,0)
 . Q:'$D(PSJAP(PSJPD)) 
"RTN","PSJPDCL",95,0)
 . S PSJDIVI=$O(^PS(58.7,PSJPD,"DIV","B",PSJDIV,0))
"RTN","PSJPDCL",96,0)
 . Q:'PSJDIVI
"RTN","PSJPDCL",97,0)
 . N DN S DN=$G(^PS(58.7,PSJPD,"DIV",PSJDIVI,0))
"RTN","PSJPDCL",98,0)
 . S PSJACT=$P(DN,"^",2)
"RTN","PSJPDCL",99,0)
 . I PSJACT,PSJACT<DT Q
"RTN","PSJPDCL",100,0)
 . I $G(PSJPDO)=1 N I S I=0 D  Q:I 
"RTN","PSJPDCL",101,0)
 .. I ($P($G(^PS(58.7,PSJPD,"DIV",PSJDIVI,2)),"^"))'="Y" S I=1 Q  ;DON'T SEND ORDER MESSAGES
"RTN","PSJPDCL",102,0)
 .. I $G(RXO)["V",$P(DN,"^",5)'="Y" S I=1 Q  ;DON'T SEND IP IV
"RTN","PSJPDCL",103,0)
 .. I "UV"[$E(RXO,$L(RXO)),($P($G(^(3)),"^")="Y"),'($S(RXO["V":$$CSIV^PSJPDCLA,1:$$CSUD^PSJPDCLA)) S I=1 Q  ;CS ONLY
"RTN","PSJPDCL",104,0)
 . S PSJX=0
"RTN","PSJPDCL",105,0)
 . I $G(PSJRB)]"" D:$O(^DG(405.4,"B",PSJRB,0)) 
"RTN","PSJPDCL",106,0)
 .. N PSJRBI S PSJRBI=$O(^DG(405.4,"B",PSJRB,0))
"RTN","PSJPDCL",107,0)
 .. S PSJSAR=$O(^PS(58.7,PSJPD,"DIV",PSJDIVI,"BG","C",PSJRBI,0))
"RTN","PSJPDCL",108,0)
 .. I PSJSAR D
"RTN","PSJPDCL",109,0)
 ... S PSJSAR=$G(^PS(58.7,PSJPD,"DIV",PSJDIVI,"BG",PSJSAR,2))
"RTN","PSJPDCL",110,0)
 ... I PSJSAR S PSJSAR=$P($G(^PS(58.71,PSJSAR,0)),"^") S:PSJSAR]"" PSJQ(PSJPD)="1^"_PSJSAR,(PSJX,PSJQ)=1
"RTN","PSJPDCL",111,0)
 . Q:PSJX 
"RTN","PSJPDCL",112,0)
 . S PSJSAR=$O(^PS(58.7,PSJPD,"DIV",PSJDIVI,"WD","B",PSJWDI,0))
"RTN","PSJPDCL",113,0)
 . I PSJSAR D
"RTN","PSJPDCL",114,0)
 .. S PSJSAR=$P($G(^PS(58.7,PSJPD,"DIV",PSJDIVI,"WD",PSJSAR,0)),"^",2)
"RTN","PSJPDCL",115,0)
 .. S:PSJSAR PSJSAR=$P($G(^PS(58.71,PSJSAR,0)),"^")
"RTN","PSJPDCL",116,0)
 .. S PSJQ(PSJPD)=1_$S(PSJSAR]"":"^"_PSJSAR,1:""),(PSJX,PSJQ)=1
"RTN","PSJPDCL",117,0)
 . Q:PSJX
"RTN","PSJPDCL",118,0)
 . I $O(^PS(57.5,"AB",PSJWDI,0)) D
"RTN","PSJPDCL",119,0)
 .. S PSJSAR=$O(^PS(57.5,"AB",PSJWDI,0)) Q:'PSJSAR
"RTN","PSJPDCL",120,0)
 .. S PSJSAR=$O(^PS(58.7,PSJPD,"DIV",PSJDIVI,"WG","B",PSJSAR,0))
"RTN","PSJPDCL",121,0)
 .. I PSJSAR S PSJSAR=$P($G(^PS(58.7,PSJPD,"DIV",PSJDIVI,"WG",PSJSAR,0)),"^",2) D
"RTN","PSJPDCL",122,0)
 ... S:PSJSAR PSJSAR=$P($G(^PS(58.71,PSJSAR,0)),"^")
"RTN","PSJPDCL",123,0)
 ... S PSJQ(PSJPD)="1"_$S(PSJSAR]"":"^"_PSJSAR,1:""),(PSJQ,PSJX)=1
"RTN","PSJPDCL",124,0)
 . K:'PSJX PSJAP(PSJPD)
"RTN","PSJPDCL",125,0)
 Q PSJQ
"RTN","PSJPDCL",126,0)
 ;
"RTN","PSJPDCL",127,0)
REACT ;
"RTN","PSJPDCL",128,0)
 N REAC S REAC="",IDX=0
"RTN","PSJPDCL",129,0)
 F  S IDX=$O(ADTL("S",IDX)) Q:IDX=""  D
"RTN","PSJPDCL",130,0)
 . I IDX>1 S REAC=REAC_NECH_$G(ADTL("S",IDX))
"RTN","PSJPDCL",131,0)
 . E  S REAC=$G(ADTL("S",IDX))
"RTN","PSJPDCL",132,0)
 S:REAC]"" $P(SEG,NFS,6)=REAC
"RTN","PSJPDCL",133,0)
 Q
"RTN","PSJPDCL",134,0)
 ;
"RTN","PSJPDCL",135,0)
AGY ;
"RTN","PSJPDCL",136,0)
 N SEG,GMRA,GMRAL
"RTN","PSJPDCL",137,0)
 S GMRA="0^0^111" D ^GMRADPT
"RTN","PSJPDCL",138,0)
 I GMRAL="" G OBX
"RTN","PSJPDCL",139,0)
 ;No known
"RTN","PSJPDCL",140,0)
 I GMRAL=0 D
"RTN","PSJPDCL",141,0)
 .S $P(SEG,NFS,1)="AL1"
"RTN","PSJPDCL",142,0)
 .S $P(SEG,NFS,2)=1
"RTN","PSJPDCL",143,0)
 .S $P(SEG,NFS,3)="OA"
"RTN","PSJPDCL",144,0)
 .S $P(SEG,NFS,4)="0;GMRD(120.82,"_NECH_"NO KNOWN ALLERGIES"
"RTN","PSJPDCL",145,0)
 .S $P(SEG,NFS,6)=""
"RTN","PSJPDCL",146,0)
 .S $P(SEG,NFS,7)=$$FMTHL7^XLFDT($$GET1^DIQ(120.86,DFN,3,"I"))
"RTN","PSJPDCL",147,0)
 .S SEQ=SEQ+1
"RTN","PSJPDCL",148,0)
 .S NSEG(SEQ)=SEG
"RTN","PSJPDCL",149,0)
 ;
"RTN","PSJPDCL",150,0)
 ;Yes, allergies
"RTN","PSJPDCL",151,0)
 I GMRAL=1 N KK,ACT,AEXT,ND D
"RTN","PSJPDCL",152,0)
 .S KK=0,ACT=0
"RTN","PSJPDCL",153,0)
 .F  S KK=$O(GMRAL(KK)) Q:'KK  D
"RTN","PSJPDCL",154,0)
 ..S ND=GMRAL(KK)
"RTN","PSJPDCL",155,0)
 ..S AEXT=$P(ND,U,2)
"RTN","PSJPDCL",156,0)
 ..S ACT=ACT+1
"RTN","PSJPDCL",157,0)
 ..S $P(SEG,NFS,1)="AL1"
"RTN","PSJPDCL",158,0)
 ..S $P(SEG,NFS,2)=ACT
"RTN","PSJPDCL",159,0)
 ..S $P(SEG,NFS,3)=$S($P(ND,U,3)="D":"DA",$P(ND,U,3)="F":"FA",1:"OA")
"RTN","PSJPDCL",160,0)
 ..S $P(SEG,NFS,4)=$P(ND,U,9)_NECH_AEXT
"RTN","PSJPDCL",161,0)
 ..N ADTL D EN1^GMRAOR2(KK,"ADTL") D:$O(ADTL("O",""))
"RTN","PSJPDCL",162,0)
 ... N IDX,SEV
"RTN","PSJPDCL",163,0)
 ... S IDX=$O(ADTL("O","")),SEV=$P($G(ADTL("O",IDX)),"^",2)
"RTN","PSJPDCL",164,0)
 ... S SEV=$S(SEV="MILD":"MI",SEV="MODERATE":"MO",SEV="SEVERE":"SV",1:"U")
"RTN","PSJPDCL",165,0)
 ... S $P(SEG,NFS,5)=SEV
"RTN","PSJPDCL",166,0)
 ..D:$O(ADTL("S","")) REACT
"RTN","PSJPDCL",167,0)
 ..S $P(SEG,NFS,7)=$$FMTHL7^XLFDT($$GET1^DIQ(120.8,KK,4,"I"))
"RTN","PSJPDCL",168,0)
 ..S SEQ=SEQ+1
"RTN","PSJPDCL",169,0)
 ..S NSEG(SEQ)=SEG,SEG=""
"RTN","PSJPDCL",170,0)
OBX ;HT,WT
"RTN","PSJPDCL",171,0)
 N GMRVSTR
"RTN","PSJPDCL",172,0)
 S GMRVSTR="HT" D EN6^GMRVUTL
"RTN","PSJPDCL",173,0)
 I X]"" S $P(SEG,NFS,1)="OBX",$P(SEG,NFS,2)=1,$P(SEG,NFS,3)="CE",$P(SEG,NFS,4)="1010.3"_NECH_"HEIGHT" D
"RTN","PSJPDCL",174,0)
 .S $P(SEG,NFS,6)=$J($P(X,U,8)*2.54,0,2),$P(SEG,NFS,7)="cm"
"RTN","PSJPDCL",175,0)
 .S $P(SEG,NFS,15)=$$HLDATE^HLFNC($P(X,U))
"RTN","PSJPDCL",176,0)
 .S SEQ=SEQ+1
"RTN","PSJPDCL",177,0)
 .S NSEG(SEQ)=SEG,SEG=""
"RTN","PSJPDCL",178,0)
 S GMRVSTR="WT" D EN6^GMRVUTL
"RTN","PSJPDCL",179,0)
 I X]"" S $P(SEG,NFS,1)="OBX",$P(SEG,NFS,2)=2,$P(SEG,NFS,3)="CE",$P(SEG,NFS,4)="1010.1"_NECH_"WEIGHT" D
"RTN","PSJPDCL",180,0)
 .S $P(SEG,NFS,6)=$J($P(X,U,8)/2.2,0,2),$P(SEG,NFS,7)="kg"
"RTN","PSJPDCL",181,0)
 .S $P(SEG,NFS,15)=$$HLDATE^HLFNC($P(X,"^"))
"RTN","PSJPDCL",182,0)
 .S SEQ=SEQ+1
"RTN","PSJPDCL",183,0)
 .S NSEG(SEQ)=SEG,SEG=""
"RTN","PSJPDCL",184,0)
 Q
"RTN","PSJPDCL",185,0)
 ;
"RTN","PSJPDCL",186,0)
A08 ;
"RTN","PSJPDCL",187,0)
 K ^TMP("A08")
"RTN","PSJPDCL",188,0)
 M ^TMP("A08","HLS")=^TMP("HLS",$J)
"RTN","PSJPDCL",189,0)
 M ^TMP("A08","HL")=HL
"RTN","PSJPDCL",190,0)
 Q:$O(^PS(58.7,"B",""))=""
"RTN","PSJPDCL",191,0)
 Q:$D(HL)=1
"RTN","PSJPDCL",192,0)
 Q:'$D(^TMP("HLS",$J))
"RTN","PSJPDCL",193,0)
 N XX,HLN,PSJND,PSJCLN,PSJCLNI,PSJDIV,PSJX S (PSJX,XX)=0
"RTN","PSJPDCL",194,0)
 F  S XX=$O(^TMP("HLS",$J,XX)) Q:'XX!(PSJX)  D
"RTN","PSJPDCL",195,0)
 . S HLN=^TMP("HLS",$J,XX)
"RTN","PSJPDCL",196,0)
 . I $E(HLN,1,3)="PV1" D
"RTN","PSJPDCL",197,0)
 .. S PSJCLN=$P(HLN,FS,4)
"RTN","PSJPDCL",198,0)
 .. S PSJCLNI=$O(^SC("B",PSJCLN,0))
"RTN","PSJPDCL",199,0)
 .. I 'PSJCLNI S PSJX=1 Q
"RTN","PSJPDCL",200,0)
 .. S PSJDIV=$P($G(^SC(PSJCLNI,0)),"^",15)
"RTN","PSJPDCL",201,0)
 .. I 'PSJDIV S PSJX=1 Q
"RTN","PSJPDCL",202,0)
 .. N PSJPD,PSJSAR,PSJQ S (PSJQ,PSJPD)=0
"RTN","PSJPDCL",203,0)
 .. F  S PSJPD=$O(^PS(58.7,"AD",PSJDIV,PSJPD)) Q:'PSJPD  D
"RTN","PSJPDCL",204,0)
 ... I '$D(^PS(58.7,PSJPD,0)) Q
"RTN","PSJPDCL",205,0)
 ... N PSJVNM,PSJDNS,PSJVP,PSJACT S PSJND=$G(^PS(58.7,PSJPD,0))
"RTN","PSJPDCL",206,0)
 ... S PSJVNM=$P(PSJND,"^"),PSJDNS=$P(PSJND,"^",2),PSJVP=$P(PSJND,"^",3)
"RTN","PSJPDCL",207,0)
 ... I PSJVNM=""!(PSJDNS="")!('PSJVP) Q
"RTN","PSJPDCL",208,0)
 ... S PSJACT=$P(PSJND,"^",4)
"RTN","PSJPDCL",209,0)
 ... I PSJACT&(PSJACT<DT) Q
"RTN","PSJPDCL",210,0)
 ... S PSJDIVI=$O(^PS(58.7,PSJPD,"DIV","B",PSJDIV,0))
"RTN","PSJPDCL",211,0)
 ... S PSJACT=$G(^PS(58.7,PSJPD,"DIV",PSJDIVI,0))
"RTN","PSJPDCL",212,0)
 ... S PSJACT=$P(PSJACT,"^",2)
"RTN","PSJPDCL",213,0)
 ... I PSJACT,PSJACT<DT Q
"RTN","PSJPDCL",214,0)
 ... S PSJQ=1,PSJQ(PSJPD)=1
"RTN","PSJPDCL",215,0)
 Q:'PSJQ 
"RTN","PSJPDCL",216,0)
 N SNM,SID S SNM="PSJ ADT-A08 SERVER"
"RTN","PSJPDCL",217,0)
 S SID=$O(^ORD(101,"B",SNM,0))
"RTN","PSJPDCL",218,0)
 Q:'SID
"RTN","PSJPDCL",219,0)
 D INIT^HLFNC2(SID,.NHL) Q:$D(NHL)=1
"RTN","PSJPDCL",220,0)
 N NFS,NECH S NFS=NHL("FS"),NECH=$E(NHL("ECH"),1)
"RTN","PSJPDCL",221,0)
 Q
"RTN","PSJPDCL",222,0)
 ;
"RTN","PSJPDCLA")
0^5^B123693086^n/a
"RTN","PSJPDCLA",1,0)
PSJPDCLA ;BIR/MA/MC - PADE HL7 - CLINIC CHECK ;07/08/15
"RTN","PSJPDCLA",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**317**;16 DEC 97;Build 130
"RTN","PSJPDCLA",3,0)
 ;Reference to EN^VAFCPID supported by DBIA 3015
"RTN","PSJPDCLA",4,0)
 ;Reference to IN^VAFHLPV1 supported by DBIA 3018
"RTN","PSJPDCLA",5,0)
 ;Reference to ^PS(55 is supported by DBIA 2191
"RTN","PSJPDCLA",6,0)
 ;Reference to ^PS(52.6 supported by DBIA 1231
"RTN","PSJPDCLA",7,0)
 ;Reference to ^PS(52.7 supported by DBIA 2173
"RTN","PSJPDCLA",8,0)
 ;Reference to ^DIC(42 supported by DBIA 10039
"RTN","PSJPDCLA",9,0)
 ;Reference to ^ORD(101 supported by DBIA 872
"RTN","PSJPDCLA",10,0)
 ;Reference to ^SC supported by DBIA 10040
"RTN","PSJPDCLA",11,0)
 ;Reference to ^DPT supported by DBIA 10035
"RTN","PSJPDCLA",12,0)
 ;Reference to ^PSDRUG supported by DBIA 2192
"RTN","PSJPDCLA",13,0)
 ;Reference to ^SRF supported by DBIA 103
"RTN","PSJPDCLA",14,0)
 ;Reference to ^SRS supported by DBIA 3362
"RTN","PSJPDCLA",15,0)
 Q
"RTN","PSJPDCLA",16,0)
 ;
"RTN","PSJPDCLA",17,0)
EN ; Get SDAM Message and send to PADE.
"RTN","PSJPDCLA",18,0)
 Q:$G(SDAMEVT)'=4!($P($G(SDATA),"^",4)<1)
"RTN","PSJPDCLA",19,0)
 N PSJAP S PSJAP=0
"RTN","PSJPDCLA",20,0)
EN1 ;
"RTN","PSJPDCLA",21,0)
 Q:'$P($$SEND^VAFHUTL(),"^",2)
"RTN","PSJPDCLA",22,0)
 Q:$O(^PS(58.7,"B",""))=""
"RTN","PSJPDCLA",23,0)
 N I,J S I=0
"RTN","PSJPDCLA",24,0)
 F  S I=$O(^PS(58.7,I)) Q:'I  S J=$$PDACT(I)
"RTN","PSJPDCLA",25,0)
 Q:'PSJAP
"RTN","PSJPDCLA",26,0)
 Q:$G(PSJPA)
"RTN","PSJPDCLA",27,0)
 Q:'$G(HLEID)
"RTN","PSJPDCLA",28,0)
 I $G(HL("ETN"))="" D INIT^HLFNC2(HLEID,.HL) Q:$D(HL)=1
"RTN","PSJPDCLA",29,0)
 N FS,ECH S FS=HL("FS"),ECH=$E(HL("ECH"),1)
"RTN","PSJPDCLA",30,0)
 N SNM,CNM S SNM="PSJ SIU-S12 SERVER",CNM="PSJ SIU-S12 CLIENT"
"RTN","PSJPDCLA",31,0)
 Q:'$O(^ORD(101,"B",SNM,0))
"RTN","PSJPDCLA",32,0)
 Q:'$O(^ORD(101,"B",CNM,0))
"RTN","PSJPDCLA",33,0)
 D INIT^HLFNC2(SNM,.NHL) Q:$D(NHL)=1
"RTN","PSJPDCLA",34,0)
 N NFS,NECH,HLFS,HLECH,Y S (HLFS,NFS)=NHL("FS"),NECH=$E(NHL("ECH"),1)
"RTN","PSJPDCLA",35,0)
 N PSJX,PSJQ,NSEG,SEQ,PSJORN,PSJOR,PSJDTM,PSJDIV,PSJDNM,PSJPV50,PDL
"RTN","PSJPDCLA",36,0)
 S (PSJQ,SEQ)=0,PSJX=1,(PSJPV50,PSJORN)=""
"RTN","PSJPDCLA",37,0)
 F I=1:1 X HLNEXT Q:HLQUIT'>0!(PSJORN]"")  D
"RTN","PSJPDCLA",38,0)
 . I $E(HLNODE,1,3)="PV1" S PSJORN=$P(HLNODE,FS,4),PSJPV50=$P(HLNODE,FS,51)
"RTN","PSJPDCLA",39,0)
 Q:PSJORN=""
"RTN","PSJPDCLA",40,0)
 D CHKINPF
"RTN","PSJPDCLA",41,0)
 Q:'$O(PSJAP(0))
"RTN","PSJPDCLA",42,0)
 N PSJBAP,FTS M PSJBAP=PSJAP
"RTN","PSJPDCLA",43,0)
 K NSEG N PSJQW,PSJNIP S PSJNIP=0,FTS=""
"RTN","PSJPDCLA",44,0)
 I $P($G(^DPT(DFN,.1)),"^")]"" D
"RTN","PSJPDCLA",45,0)
 . D IN5^VADPT
"RTN","PSJPDCLA",46,0)
 . N PSJQ,PSJWD,PSJRBD
"RTN","PSJPDCLA",47,0)
 . S PSJWD=$P(VAIP(5),"^",2),PSJRBD=$P(VAIP(6),"^",2)
"RTN","PSJPDCLA",48,0)
 . S PSJQ=$$CHKPD^PSJPDCL(PSJWD,PSJRBD)
"RTN","PSJPDCLA",49,0)
 . I 'PSJQ S PSJNIP=1 Q
"RTN","PSJPDCLA",50,0)
 . M PSJQW=PSJQ
"RTN","PSJPDCLA",51,0)
 . S FTS=$P(VAIP(8),"^")_NECH_$P(VAIP(8),"^",2)
"RTN","PSJPDCLA",52,0)
 M PSJAP=PSJBAP
"RTN","PSJPDCLA",53,0)
 K PSJQ S PSJQ=$$CHKPDCL(PSJORN)
"RTN","PSJPDCLA",54,0)
 Q:'PSJQ
"RTN","PSJPDCLA",55,0)
 S PSJDTM=$G(HLP("DT"))
"RTN","PSJPDCLA",56,0)
 S PSJOR=$O(^SC("B",PSJORN,0))
"RTN","PSJPDCLA",57,0)
 S PSJDIV=+$P($G(^SC(PSJOR,0)),"^",15)
"RTN","PSJPDCLA",58,0)
 S PSJDNM=$P($$SITE^VASITE(,PSJDIV),"^",3)
"RTN","PSJPDCLA",59,0)
 S ZTIO=""
"RTN","PSJPDCLA",60,0)
 S ZTRTN="CLCI^PSJPDCLA"
"RTN","PSJPDCLA",61,0)
 F XX="PSJPV50","PSJQ(","PSJOR","PSJORN","PSJDTM","PSJDIV","PSJDNM","DFN","PSJQW(","NHL(","SNM","CNM","FTS" S ZTSAVE(XX)=""
"RTN","PSJPDCLA",62,0)
 S ZTDESC="Send PADE HL7 Checkin Message"
"RTN","PSJPDCLA",63,0)
 S ZTDTH=$H
"RTN","PSJPDCLA",64,0)
 D ^%ZTLOAD
"RTN","PSJPDCLA",65,0)
 Q
"RTN","PSJPDCLA",66,0)
 ; 
"RTN","PSJPDCLA",67,0)
CLCI ;
"RTN","PSJPDCLA",68,0)
 N XX,ZZ1 S XX=0 F  S XX=$O(PSJQ(XX)) Q:'XX  D
"RTN","PSJPDCLA",69,0)
 . S PSJND=$G(^PS(58.7,XX,0))
"RTN","PSJPDCLA",70,0)
 . S PSJVNM=$P(PSJND,"^"),PSJDNS=$P(PSJND,"^",2),PSJVP=$P(PSJND,"^",3)
"RTN","PSJPDCLA",71,0)
 . S ZZ1="",PSJNIP=0
"RTN","PSJPDCLA",72,0)
 . I 'PSJNIP,$P(PSJND,"^",6)'="Y" Q
"RTN","PSJPDCLA",73,0)
 . I $D(PSJQW(XX)),$P(PSJQW(XX),"^",2)'="" S ZZ1=$P(PSJQW(XX),"^",2)
"RTN","PSJPDCLA",74,0)
 . I '$D(PSJQW(XX)) S PSJNIP=1
"RTN","PSJPDCLA",75,0)
 . S (HLFS,NFS)=NHL("FS"),NECH=$E(NHL("ECH"),1),HLECH=NHL("ECH")
"RTN","PSJPDCLA",76,0)
 . K NSEG S SEQ=0 N HL M HL=NHL D SRBLD N ZZ2 S ZZ2=$S($P(PSJQ(XX),"^",2)'="":$P(PSJQ(XX),"^",2),1:"")
"RTN","PSJPDCLA",77,0)
 . S SEQ=SEQ+1,NSEG(SEQ)="ZZZ"_HL("FS")_$S(ZZ1'="":ZZ1,1:"")_HL("FS")_ZZ2_HL("FS")_FTS
"RTN","PSJPDCLA",78,0)
 . K HLP,HLA S HLP="",HLP("SUBSCRIBER")="^^^^~"_PSJDNS_":"_PSJVP_"~DNS"
"RTN","PSJPDCLA",79,0)
 . D PV19^PSJPDAPP M HLA("HLS")=NSEG
"RTN","PSJPDCLA",80,0)
 . D GENERATE^HLMA(SNM,"LM",1,.PSJSND,"",.HLP)
"RTN","PSJPDCLA",81,0)
 . D LOG^PSJPADE
"RTN","PSJPDCLA",82,0)
 Q
"RTN","PSJPDCLA",83,0)
 ;
"RTN","PSJPDCLA",84,0)
SEND ;
"RTN","PSJPDCLA",85,0)
 N XX,PSJND,PSJVNM,PSJDNS,PSJVP,VR,HLA,CT
"RTN","PSJPDCLA",86,0)
 M HLA("HLS")=NSEG
"RTN","PSJPDCLA",87,0)
 D INIT^HLFNC2(SNM,.HL) Q:$D(HL)=1
"RTN","PSJPDCLA",88,0)
 S XX=0,CT=$O(NSEG(9999),-1)+1
"RTN","PSJPDCLA",89,0)
 F  S XX=$O(PSJQ(XX)) Q:'XX  D   ;sends HL7 message for each PADE SERVER
"RTN","PSJPDCLA",90,0)
 .S PSJND=$G(^PS(58.7,XX,0))
"RTN","PSJPDCLA",91,0)
 .Q:PSJND=""
"RTN","PSJPDCLA",92,0)
 .S PSJVNM=$P(PSJND,"^"),PSJDNS=$P(PSJND,"^",2),PSJVP=$P(PSJND,"^",3)
"RTN","PSJPDCLA",93,0)
 .Q:PSJVNM=""!(PSJDNS="")!('PSJVP)
"RTN","PSJPDCLA",94,0)
 .N HLP,PSJSND S HLP=""
"RTN","PSJPDCLA",95,0)
 .S HLP("SUBSCRIBER")="^^^^~"_PSJDNS_":"_PSJVP_"~DNS"
"RTN","PSJPDCLA",96,0)
 .I '$D(HL) M HL=NHL
"RTN","PSJPDCLA",97,0)
 .N ZZ2,ZZ1 S ZZ2=$P(PSJQ(XX),"^",2)
"RTN","PSJPDCLA",98,0)
 .S ZZ1=$S($P($G(PSJQS(XX)),"^",2)]"":$P($G(PSJQS(XX)),"^",2),1:"")
"RTN","PSJPDCLA",99,0)
 .S NSEG(CT)="ZZZ"_HL("FS")_ZZ1_HL("FS")_ZZ2_HL("FS")_FTS
"RTN","PSJPDCLA",100,0)
 .D PV19^PSJPDAPP
"RTN","PSJPDCLA",101,0)
 .K HLA M HLA("HLS")=NSEG
"RTN","PSJPDCLA",102,0)
 .D GENERATE^HLMA(SNM,"LM",1,.PSJSND,"",.HLP)
"RTN","PSJPDCLA",103,0)
 .D LOG^PSJPADE
"RTN","PSJPDCLA",104,0)
 Q
"RTN","PSJPDCLA",105,0)
 ;
"RTN","PSJPDCLA",106,0)
TR(SEG) ; Translate the VAFC message delimiters to HL7 delimiters for PADE
"RTN","PSJPDCLA",107,0)
 N CSEG
"RTN","PSJPDCLA",108,0)
 S CSEG=$TR(SEG,HL("FS")_HL("ECH"),NHL("FS")_NHL("ECH"))
"RTN","PSJPDCLA",109,0)
 S CSEG=$TR(CSEG,"""","")
"RTN","PSJPDCLA",110,0)
 Q CSEG
"RTN","PSJPDCLA",111,0)
 ;
"RTN","PSJPDCLA",112,0)
PDACT(PSJPD) ;
"RTN","PSJPDCLA",113,0)
 Q:'$D(^PS(58.7,PSJPD,0)) 0
"RTN","PSJPDCLA",114,0)
 N PSJVNM,PSJDNS,PSJVP,PSJACT,PSJND S PSJND=$G(^PS(58.7,PSJPD,0))
"RTN","PSJPDCLA",115,0)
 S PSJVNM=$P(PSJND,"^"),PSJDNS=$P(PSJND,"^",2),PSJVP=$P(PSJND,"^",3)
"RTN","PSJPDCLA",116,0)
 I PSJVNM=""!(PSJDNS="")!('PSJVP) Q 0
"RTN","PSJPDCLA",117,0)
 S PSJACT=$P(PSJND,"^",4)
"RTN","PSJPDCLA",118,0)
 I PSJACT&(PSJACT<DT) Q 0
"RTN","PSJPDCLA",119,0)
 S PSJAP(PSJPD)="",PSJAP=1
"RTN","PSJPDCLA",120,0)
 Q 1
"RTN","PSJPDCLA",121,0)
 ;
"RTN","PSJPDCLA",122,0)
CHKPDCL(PSJCL) ;
"RTN","PSJPDCLA",123,0)
 N PSJCLI S PSJCLI=$S($G(PSJPDO):PSJCL,1:$O(^SC("B",PSJCL,"")))
"RTN","PSJPDCLA",124,0)
 Q:'PSJCLI 0
"RTN","PSJPDCLA",125,0)
 N PSJDIV S PSJDIV=+$P($G(^SC(PSJCLI,0)),"^",15)
"RTN","PSJPDCLA",126,0)
 Q:'PSJDIV 0
"RTN","PSJPDCLA",127,0)
 S PSJCL=$P(^SC(PSJCLI,0),"^")
"RTN","PSJPDCLA",128,0)
 N PSJPD,PSJSAR S (PSJQ,PSJPD)=0
"RTN","PSJPDCLA",129,0)
 F  S PSJPD=$O(^PS(58.7,"AD",PSJDIV,PSJPD)) Q:'PSJPD  D
"RTN","PSJPDCLA",130,0)
 . Q:'$D(PSJAP(PSJPD))
"RTN","PSJPDCLA",131,0)
 . N DN S DN=$G(^PS(58.7,PSJPD,"DIV",PSJDIV,0)) Q:DN=""
"RTN","PSJPDCLA",132,0)
 . N DC S DC=$P(DN,"^",2)
"RTN","PSJPDCLA",133,0)
 . I DC&(DC<DT) Q  ;DIV INACTIVE
"RTN","PSJPDCLA",134,0)
 . I $G(PSJPDO)=1 N I S I=0 D  Q:I 
"RTN","PSJPDCLA",135,0)
 .. I $P($G(^(2)),"^")'="Y" S I=1 Q  ;DON'T SEND ORDER MESSAGES
"RTN","PSJPDCLA",136,0)
 .. I $G(RXO)["V",$P(DN,"^",7)'="Y" S I=1 Q  ;DON'T SEND CLINIC IV
"RTN","PSJPDCLA",137,0)
 .. I $G(RXO)["V" I ($P($G(^PS(58.7,PSJPD,"DIV",PSJDIV,3)),"^")="Y"),('$$CSIV) S I=1 Q  ;CS ONLY
"RTN","PSJPDCLA",138,0)
 .. I $G(RXO)["U" I ($P($G(^PS(58.7,PSJPD,"DIV",PSJDIV,3)),"^")="Y"),('$$CSUD) S I=1 Q  ;CS ONLY
"RTN","PSJPDCLA",139,0)
 . S PSJX=0
"RTN","PSJPDCLA",140,0)
 . S PSJSAR=$O(^PS(58.7,PSJPD,"DIV",PSJDIV,"CL","B",PSJCLI,0))
"RTN","PSJPDCLA",141,0)
 . I PSJSAR D
"RTN","PSJPDCLA",142,0)
 .. S PSJSAR=$P($G(^PS(58.7,PSJPD,"DIV",PSJDIV,"CL",PSJSAR,0)),"^",2)
"RTN","PSJPDCLA",143,0)
 .. S:PSJSAR PSJSAR=$P($G(^PS(58.71,PSJSAR,0)),"^")
"RTN","PSJPDCLA",144,0)
 .. S PSJQ(PSJPD)=1_$S(PSJSAR]"":"^"_PSJSAR,1:""),(PSJQ,PSJX)=1
"RTN","PSJPDCLA",145,0)
 . Q:PSJX
"RTN","PSJPDCLA",146,0)
 . S PSJSAR=$O(^PS(58.7,PSJPD,"DIV",PSJDIV,"PCG","C",PSJCLI,0))
"RTN","PSJPDCLA",147,0)
 . I PSJSAR D
"RTN","PSJPDCLA",148,0)
 .. S PSJSAR=$P($G(^PS(58.7,PSJPD,"DIV",PSJDIV,"PCG",PSJSAR,0)),"^",2)
"RTN","PSJPDCLA",149,0)
 .. S PSJSAR=$P($G(^PS(58.71,PSJSAR,0)),"^") S:PSJSAR]"" PSJQ(PSJPD)="1^"_PSJSAR,(PSJQ,PSJX)=1
"RTN","PSJPDCLA",150,0)
 . Q:PSJX
"RTN","PSJPDCLA",151,0)
 . I $O(^PS(57.8,"AC",PSJCLI,0)) D
"RTN","PSJPDCLA",152,0)
 .. S PSJSAR=$O(^PS(57.8,"AC",PSJCLI,0))
"RTN","PSJPDCLA",153,0)
 .. S PSJSAR=$O(^PS(58.7,PSJPD,"DIV",PSJDIV,"VCG","B",PSJSAR,0))
"RTN","PSJPDCLA",154,0)
 .. Q:'PSJSAR
"RTN","PSJPDCLA",155,0)
 .. S PSJSAR=$P($G(^PS(58.7,PSJPD,"DIV",PSJDIV,"VCG",PSJSAR,0)),"^",2)
"RTN","PSJPDCLA",156,0)
 .. S:PSJSAR PSJSAR=$P($G(^PS(58.71,PSJSAR,0)),"^")
"RTN","PSJPDCLA",157,0)
 .. S PSJQ(PSJPD)="1"_$S(PSJSAR]"":"^"_PSJSAR,1:""),(PSJQ,PSJX)=1
"RTN","PSJPDCLA",158,0)
 . Q:PSJX
"RTN","PSJPDCLA",159,0)
 . S PSJSAR=$O(^PS(58.7,PSJPD,"DIV",PSJDIV,"WCN","B",0)) I PSJSAR'="" D
"RTN","PSJPDCLA",160,0)
 .. N PSJWC,PSJLEN S PSJWC="" F  S PSJWC=$O(^PS(58.7,PSJPD,"DIV",PSJDIV,"WCN","B",PSJWC)) Q:PSJWC=""  D
"RTN","PSJPDCLA",161,0)
 ... I $E(PSJCL,1,$L(PSJWC))=PSJWC S PSJLEN($L(PSJWC),PSJWC)=""
"RTN","PSJPDCLA",162,0)
 .. I $D(PSJLEN) D
"RTN","PSJPDCLA",163,0)
 ... S PSJSAR=$O(PSJLEN(999),-1)
"RTN","PSJPDCLA",164,0)
 ... S PSJSAR=$O(PSJLEN(PSJSAR,0))
"RTN","PSJPDCLA",165,0)
 ... S PSJSAR=$O(^PS(58.7,PSJPD,"DIV",PSJDIV,"WCN","B",PSJSAR,0))
"RTN","PSJPDCLA",166,0)
 ... S PSJSAR=$P($G(^PS(58.7,PSJPD,"DIV",PSJDIV,"WCN",PSJSAR,0)),"^",2)
"RTN","PSJPDCLA",167,0)
 ... S:PSJSAR PSJSAR=$P($G(^PS(58.71,PSJSAR,0)),"^")
"RTN","PSJPDCLA",168,0)
 ... S PSJQ(PSJPD)="1"_$S(PSJSAR]"":"^"_PSJSAR,1:""),(PSJQ,PSJX)=1
"RTN","PSJPDCLA",169,0)
 . Q:PSJX
"RTN","PSJPDCLA",170,0)
 . I $P($G(^PS(58.7,PSJPD,"DIV",PSJDIV,0)),"^",3)="Y" D
"RTN","PSJPDCLA",171,0)
 .. S PSJSAR=$P($G(^PS(58.7,PSJPD,"DIV",PSJDIV,0)),"^",4)
"RTN","PSJPDCLA",172,0)
 .. S:PSJSAR PSJSAR=$P($G(^PS(58.71,PSJSAR,0)),"^")
"RTN","PSJPDCLA",173,0)
 .. S PSJQ(PSJPD)="1"_$S(PSJSAR]"":"^"_PSJSAR,1:""),PSJQ=1
"RTN","PSJPDCLA",174,0)
 Q PSJQ
"RTN","PSJPDCLA",175,0)
 ;
"RTN","PSJPDCLA",176,0)
CHKINPF ;
"RTN","PSJPDCLA",177,0)
 N VAIP D IN5^VADPT Q:'VAIP(5)
"RTN","PSJPDCLA",178,0)
 N PSJDIV S PSJDIV=+$P($G(^DIC(42,+VAIP(5),0)),"^",11)
"RTN","PSJPDCLA",179,0)
 Q:'PSJDIV
"RTN","PSJPDCLA",180,0)
 N PSJPD S PSJPD=0
"RTN","PSJPDCLA",181,0)
 F  S PSJPD=$O(^PS(58.7,"AD",PSJDIV,PSJPD)) Q:'PSJPD  D
"RTN","PSJPDCLA",182,0)
 . Q:'$D(PSJAP(PSJPD))
"RTN","PSJPDCLA",183,0)
 . I $P(^PS(58.7,PSJPD,0),"^",6)'="Y" K PSJAP(PSJPD) Q   ;SEND CHECKIN/SURG HL7 FOR INPT
"RTN","PSJPDCLA",184,0)
 . N DN S DN=$G(^PS(58.7,PSJPD,"DIV",PSJDIV,0)) I DN="" K PSJAP(PSJPD) Q
"RTN","PSJPDCLA",185,0)
 . N DC S DC=$P(DN,"^",2)
"RTN","PSJPDCLA",186,0)
 . I DC&(DC<DT) K PSJAP(PSJPD) Q  ;DIV INACTIVE
"RTN","PSJPDCLA",187,0)
 Q
"RTN","PSJPDCLA",188,0)
 ;
"RTN","PSJPDCLA",189,0)
SRCS ;Surgery case nightly task
"RTN","PSJPDCLA",190,0)
 N PSJAP,PSJPA S PSJAP=0,PSJPA=1 D EN1 I 'PSJAP W !!,"PADE not setup - Quitting..." Q
"RTN","PSJPDCLA",191,0)
 N SNM,CNM S SNM="PSJ SIU-S12 SERVER",CNM="PSJ SIU-S12 CLIENT"
"RTN","PSJPDCLA",192,0)
 I '$O(^ORD(101,"B",SNM,0))!('$O(^ORD(101,"B",CNM,0))) W !!,"PADE HL7 Protocols are not setup - Quitting..." Q
"RTN","PSJPDCLA",193,0)
 K %DT
"RTN","PSJPDCLA",194,0)
 S %DT(0)=DT,%DT("B")="T",%DT("A")="Enter date of Surgery cases to send to PADE: "
"RTN","PSJPDCLA",195,0)
 S %DT="EPXA" D ^%DT Q:Y<0
"RTN","PSJPDCLA",196,0)
 N SDT,BDT,EDT
"RTN","PSJPDCLA",197,0)
 S SDT=Y K %DT
"RTN","PSJPDCLA",198,0)
 S BDT=SDT-.1,EDT=SDT+.9,BDT=$O(^SRF("AC",BDT))
"RTN","PSJPDCLA",199,0)
 I 'BDT!(BDT>EDT) W !,"No data to send for the given date - Quitting..." Q
"RTN","PSJPDCLA",200,0)
 K DIR S DIR("B")="NO",DIR(0)="Y",DIR("A")="Do you want to continue"
"RTN","PSJPDCLA",201,0)
 D ^DIR Q:Y<1
"RTN","PSJPDCLA",202,0)
 S ZTDTH="",ZTRTN="TASK^PSJPDCLA",ZTDESC="Surgery appt. sent to PADE",ZTIO=""
"RTN","PSJPDCLA",203,0)
 F XX="PSJAP(","SDT","EDT","SNM","CNM" S ZTSAVE(XX)=""
"RTN","PSJPDCLA",204,0)
 D ^%ZTLOAD W:$D(ZTSK) !!,"Task Queued !",! K ZTSK,ZTIO S:$D(ZTQUEUED) ZTREQ="@"
"RTN","PSJPDCLA",205,0)
 Q
"RTN","PSJPDCLA",206,0)
 ;
"RTN","PSJPDCLA",207,0)
TASK ;
"RTN","PSJPDCLA",208,0)
 I $G(PSJTASK) N PSJAP,PSJPA S PSJAP=0,PSJPA=1 D EN1 Q:'PSJAP  N SNM,CNM D  Q:'PSJAP
"RTN","PSJPDCLA",209,0)
 .S SNM="PSJ SIU-S12 SERVER",CNM="PSJ SIU-S12 CLIENT"
"RTN","PSJPDCLA",210,0)
 .S:'$O(^ORD(101,"B",SNM,0))!('$O(^ORD(101,"B",CNM,0))) PSJAP=0
"RTN","PSJPDCLA",211,0)
 N NHL D INIT^HLFNC2(SNM,.NHL) Q:$D(NHL)=1
"RTN","PSJPDCLA",212,0)
 N NFS,NECH,HL,BDT,DFN,PSJPD,PSJDIV,PSJDNM,PSJOR,PSJORN,PSJT,PSJQ,SEQ,PSJSAR,NSEG,PSJDTM,II,PSJNIP,PSJBAP,FTS
"RTN","PSJPDCLA",213,0)
 M HL=NHL,PSJBAP=PSJAP S (NFS,HLFS)=HL("FS"),NECH=$E(HL("ECH"),1)
"RTN","PSJPDCLA",214,0)
 I '$G(SDT) N SDT S SDT=DT
"RTN","PSJPDCLA",215,0)
 S BDT=SDT-.1,EDT=SDT+.9
"RTN","PSJPDCLA",216,0)
 F  S BDT=$O(^SRF("AC",BDT)) Q:'BDT!(BDT>EDT)  D
"RTN","PSJPDCLA",217,0)
 .S II=0 F  S II=$O(^SRF("AC",BDT,II)) Q:'II  D
"RTN","PSJPDCLA",218,0)
 ..S DFN=+$G(^SRF(II,0)) Q:'DFN
"RTN","PSJPDCLA",219,0)
 ..Q:$P($G(^SRF(II,30)),"^")]""  ;cancel node
"RTN","PSJPDCLA",220,0)
 ..S PSJOR=+$P(^SRF(II,0),"^",2)
"RTN","PSJPDCLA",221,0)
 ..Q:'PSJOR
"RTN","PSJPDCLA",222,0)
 ..S PSJDTM=$P($G(^SRF(II,31)),"^",4) Q:'PSJDTM
"RTN","PSJPDCLA",223,0)
 ..S PSJOR=$P($G(^SRS(PSJOR,0)),"^")
"RTN","PSJPDCLA",224,0)
 ..Q:'PSJOR
"RTN","PSJPDCLA",225,0)
 ..S PSJDIV=+$P($G(^SC(PSJOR,0)),"^",15)
"RTN","PSJPDCLA",226,0)
 ..Q:'PSJDIV  S PSJDNM=$P($$SITE^VASITE(,PSJDIV),"^",3) Q:PSJDNM=""
"RTN","PSJPDCLA",227,0)
 ..S PSJORN=$P(^SC(PSJOR,0),"^"),PSJNIP=0,FTS=""
"RTN","PSJPDCLA",228,0)
 ..K PSJT,PSJQ M PSJT=PSJAP
"RTN","PSJPDCLA",229,0)
 ..S (SEQ,PSJPD)=0 K NSEG
"RTN","PSJPDCLA",230,0)
 ..F  S PSJPD=$O(^PS(58.7,"AD",PSJDIV,PSJPD)) Q:'PSJPD  D
"RTN","PSJPDCLA",231,0)
 ...Q:'$D(PSJT(PSJPD))
"RTN","PSJPDCLA",232,0)
 ...I $P($G(^PS(58.7,PSJPD,"DIV",PSJDIV,0)),"^",8)'="Y" K PSJT(PSJPD) Q
"RTN","PSJPDCLA",233,0)
 ...I $P($G(^DPT(DFN,.1)),"^")]""&($P(^PS(58.7,PSJPD,0),"^",6)'="Y") K PSJT(PSJPD) Q
"RTN","PSJPDCLA",234,0)
 ...S PSJSAR=$O(^PS(58.7,PSJPD,"DIV",PSJDIV,"OR","B",PSJOR,0))
"RTN","PSJPDCLA",235,0)
 ...I 'PSJSAR K PSJT(PSJPD) Q
"RTN","PSJPDCLA",236,0)
 ...S PSJSAR=$P($G(^PS(58.7,PSJPD,"DIV",PSJDIV,"OR",PSJSAR,0)),"^",2)
"RTN","PSJPDCLA",237,0)
 ...S:PSJSAR PSJSAR=$P($G(^PS(58.71,PSJSAR,0)),"^")
"RTN","PSJPDCLA",238,0)
 ...S PSJQ(PSJPD)=1_$S(PSJSAR]"":"^"_PSJSAR,1:""),PSJQ=1
"RTN","PSJPDCLA",239,0)
 ..Q:'$O(PSJQ(""))
"RTN","PSJPDCLA",240,0)
 ..N PSJQS I $P($G(^DPT(DFN,.1)),"^")]"" D
"RTN","PSJPDCLA",241,0)
 ...N PSJQ,PSJWD,PSJRBD
"RTN","PSJPDCLA",242,0)
 ...D IN5^VADPT
"RTN","PSJPDCLA",243,0)
 ...S PSJWD=$P(VAIP(5),"^",2),PSJRBD=$P(VAIP(6),"^",2)
"RTN","PSJPDCLA",244,0)
 ...S PSJQ=$$CHKPD^PSJPDCL(PSJWD,PSJRBD)
"RTN","PSJPDCLA",245,0)
 ...M PSJAP=PSJBAP
"RTN","PSJPDCLA",246,0)
 ...I 'PSJQ S PSJNIP=1 Q
"RTN","PSJPDCLA",247,0)
 ...M PSJQS=PSJQ
"RTN","PSJPDCLA",248,0)
 ...S FTS=$P(VAIP(8),"^")_NECH_$P(VAIP(8),"^",2)
"RTN","PSJPDCLA",249,0)
 ..D SRBLD,SEND
"RTN","PSJPDCLA",250,0)
 Q
"RTN","PSJPDCLA",251,0)
 ;
"RTN","PSJPDCLA",252,0)
SRBLD ;
"RTN","PSJPDCLA",253,0)
 N SEG,VAFSTR,EVNTHL7,EVNTDATE,VAFPID,HLQ
"RTN","PSJPDCLA",254,0)
 S VAFSTR="1,5,7,8,19",HLQ=""
"RTN","PSJPDCLA",255,0)
 N VAFPID,M
"RTN","PSJPDCLA",256,0)
 S VAFPID=$$EN^VAFCPID(DFN,VAFSTR)
"RTN","PSJPDCLA",257,0)
 S SEQ=SEQ+1
"RTN","PSJPDCLA",258,0)
 S NSEG(SEQ)=$TR(VAFPID,"""""","")
"RTN","PSJPDCLA",259,0)
 S M=$O(VAFPID(0)) I M S NSEG(SEQ,M)=$TR(VAFPID(M),"""""","")
"RTN","PSJPDCLA",260,0)
 S VAFSTR=",2,3,10,18,21,39"
"RTN","PSJPDCLA",261,0)
 I $G(PSJNIP) S VAFSTR=",2,10,18,21,39"
"RTN","PSJPDCLA",262,0)
 S SEG=$$IN^VAFHLPV1(DFN,"",VAFSTR,"","",1,"")
"RTN","PSJPDCLA",263,0)
 S SEG=$TR(SEG,"""""","")
"RTN","PSJPDCLA",264,0)
 S:$P(SEG,HLFS,4)="" $P(SEG,HLFS,3)="O"
"RTN","PSJPDCLA",265,0)
 S $P(SEG,HLFS,12)=PSJORN,$P(SEG,HLFS,40)=PSJDNM
"RTN","PSJPDCLA",266,0)
 S:$G(PSJPV50) $P(SEG,HLFS,51)=PSJPV50
"RTN","PSJPDCLA",267,0)
 S SEQ=SEQ+1
"RTN","PSJPDCLA",268,0)
 S NSEG(SEQ)=SEG
"RTN","PSJPDCLA",269,0)
 D AGY^PSJPDCL
"RTN","PSJPDCLA",270,0)
 D SCH
"RTN","PSJPDCLA",271,0)
 Q
"RTN","PSJPDCLA",272,0)
 ;
"RTN","PSJPDCLA",273,0)
DIVCHK(DIV) ;
"RTN","PSJPDCLA",274,0)
 N PSJPD
"RTN","PSJPDCLA",275,0)
 F  S PSJPD=$O(^PS(58.7,"AD",DIV,PSJPD)) Q:'PSJPD  D
"RTN","PSJPDCLA",276,0)
 . Q:'$D(PSJAP(PSJPD))
"RTN","PSJPDCLA",277,0)
 Q
"RTN","PSJPDCLA",278,0)
 ;
"RTN","PSJPDCLA",279,0)
CSIV() ;
"RTN","PSJPDCLA",280,0)
 N J,SCH,DIN,QQ S (J,SCH,QQ)=0 F  S J=$O(^PS(55,DFN,"IV",+RXO,"AD",J)) Q:'J!(QQ)  D
"RTN","PSJPDCLA",281,0)
 . S DIN=$P($G(^PS(55,DFN,"IV",+RXO,"AD",J,0)),"^")
"RTN","PSJPDCLA",282,0)
 . S DIN=$P($G(^PS(52.6,DIN,0)),"^",2) Q:DIN=""
"RTN","PSJPDCLA",283,0)
 . S SCH=$P($G(^PSDRUG(DIN,0)),"^",3)
"RTN","PSJPDCLA",284,0)
 . I SCH["2"!(SCH["3")!(SCH["4")!(SCH["5") S QQ=1
"RTN","PSJPDCLA",285,0)
 Q:QQ 1
"RTN","PSJPDCLA",286,0)
 S J=0 F  S J=$O(^PS(55,DFN,"IV",+RXO,"SOL",J)) Q:'J!(QQ)  D  Q:QQ
"RTN","PSJPDCLA",287,0)
 . S DIN=$P($G(^PS(55,DFN,"IV",+RXO,"SOL",J,0)),"^")
"RTN","PSJPDCLA",288,0)
 . S DIN=$P($G(^PS(52.7,J,0)),"^",2) Q:DIN=""
"RTN","PSJPDCLA",289,0)
 . S SCH=$P(^PSDRUG(DIN,0),"^",3)
"RTN","PSJPDCLA",290,0)
 . I SCH["2"!(SCH["3")!(SCH["4")!(SCH["5") S QQ=1
"RTN","PSJPDCLA",291,0)
 Q QQ
"RTN","PSJPDCLA",292,0)
 ;
"RTN","PSJPDCLA",293,0)
CSUD() ;
"RTN","PSJPDCLA",294,0)
 N J,SCH,QQ S (J,QQ,SCH)=0 F  S J=$O(^PS(55,DFN,5,+RXO,1,"B",J)) Q:'J!(QQ)  D  Q:QQ
"RTN","PSJPDCLA",295,0)
 . S SCH=$P($G(^PSDRUG(J,0)),"^",3)
"RTN","PSJPDCLA",296,0)
 . I SCH["2"!(SCH["3")!(SCH["4")!(SCH["5") S QQ=1
"RTN","PSJPDCLA",297,0)
 Q QQ
"RTN","PSJPDCLA",298,0)
 ;
"RTN","PSJPDCLA",299,0)
AIL ;
"RTN","PSJPDCLA",300,0)
 S SEG="AIL"
"RTN","PSJPDCLA",301,0)
 S $P(SEG,HLFS,2)=1
"RTN","PSJPDCLA",302,0)
 S $P(SEG,HLFS,3)=PSJDIV_NECH_NECH_NECH_PSJDNM
"RTN","PSJPDCLA",303,0)
 S $P(SEG,HLFS,4)=PSJOR_NECH_PSJORN
"RTN","PSJPDCLA",304,0)
 S SEQ=SEQ+1
"RTN","PSJPDCLA",305,0)
 S NSEG(SEQ)=SEG
"RTN","PSJPDCLA",306,0)
 Q
"RTN","PSJPDCLA",307,0)
 ;
"RTN","PSJPDCLA",308,0)
SCH ;
"RTN","PSJPDCLA",309,0)
 S SEG="SCH"
"RTN","PSJPDCLA",310,0)
 S $P(SEG,HLFS,2)=DFN_":"_PSJOR_":"_$$FMTHL7^XLFDT(PSJDTM)
"RTN","PSJPDCLA",311,0)
 S $P(SEG,HLFS,5)="S12"
"RTN","PSJPDCLA",312,0)
 S $P(SEG,HLFS,12)=NECH_NECH_NECH_$$FMTHL7^XLFDT(PSJDTM)
"RTN","PSJPDCLA",313,0)
 S SEQ=SEQ+1,PDL(16)=PSJDTM
"RTN","PSJPDCLA",314,0)
 S NSEG(SEQ)=SEG
"RTN","PSJPDCLA",315,0)
 Q
"RTN","PSJPDCLA",316,0)
 ;
"RTN","PSJPDCLU")
0^20^B182600427^n/a
"RTN","PSJPDCLU",1,0)
PSJPDCLU ;BIR/MHA/MC - PADE ORDER ; 10/28/15 9:31am
"RTN","PSJPDCLU",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**317**;16 DEC 97;Build 130
"RTN","PSJPDCLU",3,0)
 ;Reference to ^PS(50.7 supported by DBIA 2180
"RTN","PSJPDCLU",4,0)
 ;Reference to ^PS(50.606 supported by DBIA 2174
"RTN","PSJPDCLU",5,0)
 ;Reference to ^PS(50.607 supported by DBIA 2221
"RTN","PSJPDCLU",6,0)
 ;Reference to ^PS(51.2 supported by DBIA 2178
"RTN","PSJPDCLU",7,0)
 ;Reference to ^PS(52.6 supported by DBIA 1231
"RTN","PSJPDCLU",8,0)
 ;Reference to ^PS(52.7 supported by DBIA 2173
"RTN","PSJPDCLU",9,0)
 ;Reference to ^PSDRUG supported by DBIA 2192
"RTN","PSJPDCLU",10,0)
 ;Reference to $$PROD2^PSNAPIS supported by DBIA 2531
"RTN","PSJPDCLU",11,0)
 ;Reference to ^ORD(101 supported by DBIA #872
"RTN","PSJPDCLU",12,0)
 ;Reference to ^DIC(42 supported by DBIA 10039
"RTN","PSJPDCLU",13,0)
 ;Reference to ^SC supported by DBIA 10040
"RTN","PSJPDCLU",14,0)
 ;Reference to EN^VAFCPID supported by DBIA 3015
"RTN","PSJPDCLU",15,0)
 ;Reference to EN^VAFHLEVN supported by DBIA 3016
"RTN","PSJPDCLU",16,0)
 Q
"RTN","PSJPDCLU",17,0)
 ;
"RTN","PSJPDCLU",18,0)
PDORD ;
"RTN","PSJPDCLU",19,0)
 Q:'$P($$SEND^VAFHUTL(),"^",2)
"RTN","PSJPDCLU",20,0)
 Q:$O(^PS(58.7,"B",""))=""
"RTN","PSJPDCLU",21,0)
 N I,J,PSJAP,PSJQ,PSJBAP S (PSJAP,I)=0
"RTN","PSJPDCLU",22,0)
 F  S I=$O(^PS(58.7,I)) Q:'I  S J=$$PDACT^PSJPDCLA(I)
"RTN","PSJPDCLU",23,0)
 Q:'PSJAP
"RTN","PSJPDCLU",24,0)
 M PSJBAP=PSJAP
"RTN","PSJPDCLU",25,0)
 N SNM,CNM S SNM="PSJ RDEO11 SERVER"
"RTN","PSJPDCLU",26,0)
 Q:'$O(^ORD(101,"B",SNM,0))
"RTN","PSJPDCLU",27,0)
 S CNM="PSJ RDEO11 CLIENT"
"RTN","PSJPDCLU",28,0)
 Q:'$O(^ORD(101,"B",CNM,0))
"RTN","PSJPDCLU",29,0)
 N HL,NSEG,SEQ,SEG,NFS,NECH,NSCS D INIT^HLFNC2(SNM,.HL) Q:$D(HL)=1
"RTN","PSJPDCLU",30,0)
 S NFS=HL("FS"),NECH=$E(HL("ECH"),1),NSCS=$E(HL("ECH"),4)
"RTN","PSJPDCLU",31,0)
 N CLN,CLAPDT,PSJWARD,DFN,I,PSJRBD,ADMDT,PIVOT,PV,PSJDIV1,LOC,EVNDT,PDL,FTS
"RTN","PSJPDCLU",32,0)
 S DFN=PSJHLDFN,(CLN,PIVOT,ADMDT,CLAPDT,EVNDT)=0,(LOC,PSJWARD,PSJRBD,PV,PSJDIV1,FTS)=""
"RTN","PSJPDCLU",33,0)
 I RXO["V",$D(^PS(55,DFN,"IV",+RXO,"DSS")) S I=^("DSS") S CLN=$P(I,"^"),CLAPDT=$P(I,"^",2)
"RTN","PSJPDCLU",34,0)
 I RXO["U",$D(^PS(55,DFN,5,+RXO,8)) S I=^(8) S CLN=$P(I,"^"),CLAPDT=$P(I,"^",2)
"RTN","PSJPDCLU",35,0)
 N PSJQ,PSJQ2,PSJQCL,PSJPDON,VAIP,VAIN,PSJPDO,SETZ S (PSJQ,PSJQ2,SETZ)="",PSJPDO=0
"RTN","PSJPDCLU",36,0)
 D IN5^VADPT
"RTN","PSJPDCLU",37,0)
 I (VAIP(5)="")&($G(DGPMTYP)=6)&($G(DGPMP)'="")&($G(DGPMA)="")&($D(DGPMVI)) D
"RTN","PSJPDCLU",38,0)
 . M VAIP=DGPMVI
"RTN","PSJPDCLU",39,0)
 I VAIP(5)!$G(PSJDCA) D
"RTN","PSJPDCLU",40,0)
 . I VAIP(5)="" S VAIP("D")="L" D IN5^VADPT
"RTN","PSJPDCLU",41,0)
 . S I=+VAIP(5),PSJWARD=$P(VAIP(5),"^",2),PSJRBD=$P(VAIP(6),"^",2),ADMDT=+VAIP(13,1),EVNDT=+VAIP(3)
"RTN","PSJPDCLU",42,0)
 . S FTS=$P(VAIP(8),"^")_NECH_$P(VAIP(8),"^",2)
"RTN","PSJPDCLU",43,0)
 . S PSJDIV1=+$P($G(^DIC(42,I,0)),"^",11)
"RTN","PSJPDCLU",44,0)
 . S PIVOT=+$$PIVCHK^VAFHPIVT(DFN,ADMDT,1,VAIP(13)_";DGPM(")
"RTN","PSJPDCLU",45,0)
 . I PIVOT<0 D
"RTN","PSJPDCLU",46,0)
 .. S I=$O(^VAT(391.71,"AKY",1,ADMDT,VAIP(13)_";DGPM(","")) Q:'I
"RTN","PSJPDCLU",47,0)
 .. S PIVOT=+$$GET1^DIQ(391.71,I,.02)
"RTN","PSJPDCLU",48,0)
 I PSJWARD'="",CLN,CLAPDT D  Q:'PSJQ  S SETZ="IC" G CORD
"RTN","PSJPDCLU",49,0)
 . S PSJQ=$$CHKPD^PSJPDCL(PSJWARD,PSJRBD) S:'PSJQ PIVOT=0
"RTN","PSJPDCLU",50,0)
 . I PSJQ M PSJQ2=PSJQ K PSJQ
"RTN","PSJPDCLU",51,0)
 . M PSJAP=PSJBAP S PSJPDO=1
"RTN","PSJPDCLU",52,0)
 . S PSJQ=$$CHKPDCL^PSJPDCLA(CLN) Q:'PSJQ
"RTN","PSJPDCLU",53,0)
 . S PV="CLN"
"RTN","PSJPDCLU",54,0)
 I PSJWARD'="" D  Q:'PSJQ  G CORD
"RTN","PSJPDCLU",55,0)
 . S PSJPDO=1,PSJQ=$$CHKPD^PSJPDCL(PSJWARD,PSJRBD)
"RTN","PSJPDCLU",56,0)
 . Q:'PSJQ
"RTN","PSJPDCLU",57,0)
 . S PV="WARD",SETZ="I"
"RTN","PSJPDCLU",58,0)
 I CLN S PSJDIV1=+$P($G(^SC(CLN,0)),"^",15) D  Q:'PSJQ  M PSJQ2=PSJQ S SETZ="C"
"RTN","PSJPDCLU",59,0)
 . S PSJPDO=1,PSJQ=$$CHKPDCL^PSJPDCLA(CLN) Q:'PSJQ
"RTN","PSJPDCLU",60,0)
 . S PV="CLN"
"RTN","PSJPDCLU",61,0)
CORD ;
"RTN","PSJPDCLU",62,0)
 Q:'PSJQ
"RTN","PSJPDCLU",63,0)
 N ST0,PS55,PDL S (SEQ,ST0)=0
"RTN","PSJPDCLU",64,0)
 S PS55=$S(RXO["U":"^PS(55,DFN,5,+RXO)",1:"^PS(55,DFN,""IV"",+RXO)")
"RTN","PSJPDCLU",65,0)
 Q:PS55=""
"RTN","PSJPDCLU",66,0)
 M PS55=@PS55
"RTN","PSJPDCLU",67,0)
 I RXO["U" Q:'$P($G(PS55(2)),"^",2)!('$P($G(PS55(2)),"^",4))
"RTN","PSJPDCLU",68,0)
 I RXO["V" Q:'$G(PS55(.2))!('$P($G(PS55(0)),"^",2))
"RTN","PSJPDCLU",69,0)
 N VAR1,VAR2,STATUS,PDDT,PDHDT
"RTN","PSJPDCLU",70,0)
 S PDDT=$$NOW^XLFDT(),PDHDT=+$$HLDATE^HLFNC(PDDT,"TS")
"RTN","PSJPDCLU",71,0)
 D PID,PV1,AGY^PSJPDCL,ORC,RXE,RXR
"RTN","PSJPDCLU",72,0)
 D:RXO["V" IVRXC
"RTN","PSJPDCLU",73,0)
 I RXO["U" N CNT S CNT=0 D  D:CNT>1 RXC  ; IF THERE ARE > 1 ACTIVE DD, MAKE AN RXC FOR EACH
"RTN","PSJPDCLU",74,0)
 . N X1 S X1=0 F  S X1=$O(PS55(1,X1)) Q:'X1  D
"RTN","PSJPDCLU",75,0)
 .. I $P(PS55(1,X1,0),"^",3),$P(PS55(1,X1,0),"^",3)'>DT Q  ; DONT COUNT IF IT HAS AN INNACTIVATION DATE (PAST)
"RTN","PSJPDCLU",76,0)
 .. S CNT=CNT+1
"RTN","PSJPDCLU",77,0)
 D ZRX
"RTN","PSJPDCLU",78,0)
 N ZTIO,ZTRTN,ZTSAVE,ZTDESC,ZTDTH
"RTN","PSJPDCLU",79,0)
 S ZTIO=""
"RTN","PSJPDCLU",80,0)
 S:CLAPDT PDL(16)=CLAPDT
"RTN","PSJPDCLU",81,0)
 S ZTRTN="SEND^PSJPDCLU"
"RTN","PSJPDCLU",82,0)
 F XX="NSEG(","PSJQ(","PSJQ2(","SETZ","HLFS","HLECH","HL(","SNM","CNM","PDL(","FTS" S ZTSAVE(XX)=""
"RTN","PSJPDCLU",83,0)
 S ZTDESC="PADE HL7 Order Message Router"
"RTN","PSJPDCLU",84,0)
 S ZTDTH=$H
"RTN","PSJPDCLU",85,0)
 D ^%ZTLOAD
"RTN","PSJPDCLU",86,0)
 Q
"RTN","PSJPDCLU",87,0)
 ;
"RTN","PSJPDCLU",88,0)
SEND ;
"RTN","PSJPDCLU",89,0)
 N XX,PSJND,PSJVNM,PSJDNS,PSJVP,VR,HLA,NHL,CT
"RTN","PSJPDCLU",90,0)
 M NHL=HL
"RTN","PSJPDCLU",91,0)
 S XX=0,CT=$O(NSEG(9999),-1)+1
"RTN","PSJPDCLU",92,0)
 F  S XX=$O(PSJQ(XX)) Q:'XX  D
"RTN","PSJPDCLU",93,0)
 .M HL=NHL
"RTN","PSJPDCLU",94,0)
 .S PSJND=$G(^PS(58.7,XX,0))
"RTN","PSJPDCLU",95,0)
 .Q:PSJND=""
"RTN","PSJPDCLU",96,0)
 .S PSJVNM=$P(PSJND,"^"),PSJDNS=$P(PSJND,"^",2),PSJVP=$P(PSJND,"^",3)
"RTN","PSJPDCLU",97,0)
 .Q:PSJVNM=""!(PSJDNS="")!('PSJVP)
"RTN","PSJPDCLU",98,0)
 .N HLP,PSJSND
"RTN","PSJPDCLU",99,0)
 .S HLP("SUBSCRIBER")="^^^^~"_PSJDNS_":"_PSJVP_"~DNS"
"RTN","PSJPDCLU",100,0)
 .N ZZ1,ZZ2 S (ZZ1,ZZ2)=""
"RTN","PSJPDCLU",101,0)
 .I SETZ="C" S ZZ2=$P($G(PSJQ2(XX)),"^",2)
"RTN","PSJPDCLU",102,0)
 .I SETZ="IC" S ZZ1=$P($G(PSJQ2(XX)),"^",2),ZZ2=$P($G(PSJQ(XX)),"^",2)
"RTN","PSJPDCLU",103,0)
 .I SETZ="I" S ZZ1=$P($G(PSJQ(XX)),"^",2)
"RTN","PSJPDCLU",104,0)
 .S NSEG(CT)="ZZZ"_HL("FS")_ZZ1_HL("FS")_ZZ2_HL("FS")_FTS
"RTN","PSJPDCLU",105,0)
 .D PV19^PSJPDAPP
"RTN","PSJPDCLU",106,0)
 .K HLA M HLA("HLS")=NSEG
"RTN","PSJPDCLU",107,0)
 .D GENERATE^HLMA(SNM,"LM",1,.PSJSND,"",.HLP)
"RTN","PSJPDCLU",108,0)
 .D LOG^PSJPADE
"RTN","PSJPDCLU",109,0)
 Q
"RTN","PSJPDCLU",110,0)
 ;
"RTN","PSJPDCLU",111,0)
PID ;
"RTN","PSJPDCLU",112,0)
 N VAFSTR
"RTN","PSJPDCLU",113,0)
 S VAFSTR="1,2,3,4,5,6,7,8,9,19"
"RTN","PSJPDCLU",114,0)
 N VAFPID,M
"RTN","PSJPDCLU",115,0)
 S VAFPID=$$EN^VAFCPID(DFN,VAFSTR)
"RTN","PSJPDCLU",116,0)
 S SEQ=SEQ+1
"RTN","PSJPDCLU",117,0)
 S NSEG(SEQ)=$TR(VAFPID,"""""","")
"RTN","PSJPDCLU",118,0)
 Q
"RTN","PSJPDCLU",119,0)
 ;
"RTN","PSJPDCLU",120,0)
PV1 ;
"RTN","PSJPDCLU",121,0)
 N PV1
"RTN","PSJPDCLU",122,0)
 I PV="WARD" D
"RTN","PSJPDCLU",123,0)
 .S VAFSTR=",2,3,7,10,18,21,39,44,45"
"RTN","PSJPDCLU",124,0)
 .S PV1=$$IN^VAFHLPV1(DFN,"",VAFSTR,"","",1,"")
"RTN","PSJPDCLU",125,0)
 .S:$P(PV1,NFS,4)="" $P(PV1,NFS,4)=PSJWARD_NECH_$TR($P(PSJRBD,"-",1,2),"-",NECH)
"RTN","PSJPDCLU",126,0)
 .S SEG=PV1
"RTN","PSJPDCLU",127,0)
 I PV="CLN" D
"RTN","PSJPDCLU",128,0)
 .I PSJWARD'="",PIVOT S VAFSTR=",2,3,7,10,18,21,39,44,45"
"RTN","PSJPDCLU",129,0)
 .E  S VAFSTR=""
"RTN","PSJPDCLU",130,0)
 .S PV1=$$IN^VAFHLPV1(DFN,EVNDT,VAFSTR,"","",1,"")
"RTN","PSJPDCLU",131,0)
 .I RXO["U",CLAPDT S $P(PV1,NFS,12)=$P($G(^SC(CLN,0)),"^")_NECH_CLN
"RTN","PSJPDCLU",132,0)
 .I RXO["V" I (PSJWARD'=""&CLAPDT)!(PSJWARD="") S $P(PV1,NFS,12)=$P($G(^SC(CLN,0)),"^")_NECH_CLN
"RTN","PSJPDCLU",133,0)
 .S SEG=PV1
"RTN","PSJPDCLU",134,0)
 S:$G(PIVOT)>0 $P(SEG,NFS,51)=PIVOT
"RTN","PSJPDCLU",135,0)
 S:$P(PV1,NFS,4)="" $P(SEG,NFS,3)="O"
"RTN","PSJPDCLU",136,0)
 S SEQ=SEQ+1
"RTN","PSJPDCLU",137,0)
 S NSEG(SEQ)=$TR(SEG,"""""","")
"RTN","PSJPDCLU",138,0)
 S:$G(PSJDIV1) $P(NSEG(SEQ),NFS,40)=$P($$SITE^VASITE(,PSJDIV1),"^",3)
"RTN","PSJPDCLU",139,0)
 Q
"RTN","PSJPDCLU",140,0)
 ;
"RTN","PSJPDCLU",141,0)
ORC ;
"RTN","PSJPDCLU",142,0)
 S SEG="ORC"
"RTN","PSJPDCLU",143,0)
 S STATUS=$S(RXO["U":$P(PS55(0),"^",9),1:$P(PS55(0),"^",17))
"RTN","PSJPDCLU",144,0)
 S:$G(PSJEXPOE) STATUS="E"
"RTN","PSJPDCLU",145,0)
 S ($P(SEG,NFS,2),PDL(15))=$S(STATUS="A"&((PDTYP="SN")!(PDTYP="SC")):"NW",PDTYP="OH":"OH",PDTYP="OE":"RL",PDTYP="OD"!($E(STATUS)="D")!(STATUS="E"):"DC",1:"XX")
"RTN","PSJPDCLU",146,0)
 S $P(SEG,NFS,3)=+$P(PS55(0),"^",21)
"RTN","PSJPDCLU",147,0)
 S ($P(SEG,NFS,4),PDL(2))=RXO
"RTN","PSJPDCLU",148,0)
 S $P(SEG,NFS,6)=$S($E(STATUS)="D":"DC",STATUS="E":"ZE",(STATUS="H"!($G(PDTYP)="OH")):"HD",1:"CM")
"RTN","PSJPDCLU",149,0)
 S VAR1="",VAR2=$S(RXO["U":$P(PS55(0),"^",25),1:$P(PS55(2),"^",5))
"RTN","PSJPDCLU",150,0)
 D:VAR2
"RTN","PSJPDCLU",151,0)
 .I RXO["U" S VAR1=$P($G(^PS(55,DFN,5,+VAR2,0)),"^",21)_NECH_VAR2
"RTN","PSJPDCLU",152,0)
 .I RXO["V" S VAR1=$P($G(^PS(55,DFN,"IV",+VAR2,0)),"^",21)_NECH_VAR2
"RTN","PSJPDCLU",153,0)
 S $P(SEG,NFS,9)=VAR1
"RTN","PSJPDCLU",154,0)
 S $P(SEG,NFS,10)=+$$HLDATE^HLFNC($S(RXO["U":$P(PS55(0),"^",16),1:$P(PS55(2),"^")))
"RTN","PSJPDCLU",155,0)
 S VAR1=$S(RXO["U":$P(PS55(4),"^",7),1:$P(PS55(2),"^",11))
"RTN","PSJPDCLU",156,0)
 D:VAR1
"RTN","PSJPDCLU",157,0)
 .S VAR2=$P($G(^VA(200,VAR1,0)),"^")
"RTN","PSJPDCLU",158,0)
 .S:VAR2]"" VAR2=$$HLNAME^XLFNAME(VAR2,"",NECH)
"RTN","PSJPDCLU",159,0)
 .S ($P(SEG,NFS,11),$P(SEG,NFS,20))=VAR1_NECH_VAR2
"RTN","PSJPDCLU",160,0)
 S VAR1=$S(RXO["U":$P($G(PS55(4)),"^",3),1:$P($G(PS55(4)),"^",4))
"RTN","PSJPDCLU",161,0)
 S:VAR1="" VAR1=+$G(DUZ)
"RTN","PSJPDCLU",162,0)
 D:VAR1
"RTN","PSJPDCLU",163,0)
 .S VAR2=$P($G(^VA(200,+VAR1,0)),"^")
"RTN","PSJPDCLU",164,0)
 .S:VAR2]"" VAR2=$$HLNAME^XLFNAME(VAR2,"",NECH)
"RTN","PSJPDCLU",165,0)
 .S $P(SEG,NFS,12)=VAR1_NECH_VAR2
"RTN","PSJPDCLU",166,0)
 S VAR1=$S(RXO["U":$P(PS55(0),"^",2),1:$P($G(PS55(0)),"^",6))
"RTN","PSJPDCLU",167,0)
 D:VAR1
"RTN","PSJPDCLU",168,0)
 .S VAR2=$P($G(^VA(200,+VAR1,0)),"^")
"RTN","PSJPDCLU",169,0)
 .S:VAR2]"" VAR2=$$HLNAME^XLFNAME(VAR2,"",NECH)
"RTN","PSJPDCLU",170,0)
 .S $P(SEG,NFS,13)=VAR1_NECH_VAR2
"RTN","PSJPDCLU",171,0)
 S VAR1=$P(SEG,NFS,2)
"RTN","PSJPDCLU",172,0)
 S VAR2=$S(VAR1="NW":"NEW",VAR1="DC":"DISCONTINUE",VAR1="HD":"HOLD",VAR1="OH":"HOLD",VAR1="RL":"RELEASED HOLD",VAR1="XX":"CHANGE",1:"UNKNOWN")
"RTN","PSJPDCLU",173,0)
 S $P(SEG,NFS,17)=VAR2
"RTN","PSJPDCLU",174,0)
 I $G(PSJDMU) S VAR1=+$G(DUZ) D:VAR1
"RTN","PSJPDCLU",175,0)
 .S VAR2=$P($G(^VA(200,VAR1,0)),"^") S:VAR2]"" VAR2=$$HLNAME^XLFNAME(VAR2,"",NECH)
"RTN","PSJPDCLU",176,0)
 .S $P(SEG,NFS,20)=VAR1_NFS_VAR2
"RTN","PSJPDCLU",177,0)
 S SEQ=SEQ+1
"RTN","PSJPDCLU",178,0)
 S NSEG(SEQ)=SEG
"RTN","PSJPDCLU",179,0)
 D:$D(^XTMP("PADE")) DISP
"RTN","PSJPDCLU",180,0)
 Q
"RTN","PSJPDCLU",181,0)
 ;
"RTN","PSJPDCLU",182,0)
RXE ;
"RTN","PSJPDCLU",183,0)
 N DOSE
"RTN","PSJPDCLU",184,0)
 S SEG="RXE"
"RTN","PSJPDCLU",185,0)
 I RXO["V" D IVRXE Q
"RTN","PSJPDCLU",186,0)
 S $P(SEG,NFS,2)=$$QT(DFN,RXO,.PS55)
"RTN","PSJPDCLU",187,0)
 S $P(SEG,NFS,3)=$$GIVECODE(+$$DSPDRG,NECH)
"RTN","PSJPDCLU",188,0)
 N DOSETMP,MIN,MAX
"RTN","PSJPDCLU",189,0)
 S DOSE=$TR($P(PS55(.2),"^",2),","),MIN=+DOSE
"RTN","PSJPDCLU",190,0)
 S DOSETMP=$TR(DOSE," ")
"RTN","PSJPDCLU",191,0)
 I DOSETMP["-" S MIN=+$P(DOSETMP,"-"),MAX=$P(DOSETMP,"-",2,99)
"RTN","PSJPDCLU",192,0)
 S $P(SEG,NFS,4)=$S(MIN:MIN,1:"")
"RTN","PSJPDCLU",193,0)
 S $P(SEG,NFS,5)=$S($G(MAX):+$G(MAX),1:"")
"RTN","PSJPDCLU",194,0)
 I '$G(MAX),$G(MIN),+$TR($P($G(DOSE),MIN,2,99)," ") D
"RTN","PSJPDCLU",195,0)
 . S $P(SEG,NFS,6)=DOSE
"RTN","PSJPDCLU",196,0)
 E  D
"RTN","PSJPDCLU",197,0)
 . S DOSETMP=$S($G(MAX):$P(DOSE,+MAX,2,99),$G(MIN):$P($G(DOSE),MIN,2,99),1:DOSE)
"RTN","PSJPDCLU",198,0)
 . I $E(DOSETMP)=" " S DOSETMP=$E(DOSETMP,2,$L(DOSETMP))
"RTN","PSJPDCLU",199,0)
 . S $P(SEG,NFS,6)=DOSETMP
"RTN","PSJPDCLU",200,0)
 S VAR1=$$GETFORM(.PS55)
"RTN","PSJPDCLU",201,0)
 S $P(SEG,NFS,7)=VAR1
"RTN","PSJPDCLU",202,0)
 N PCE S PCE=""
"RTN","PSJPDCLU",203,0)
 I $D(PS55(15)) D
"RTN","PSJPDCLU",204,0)
 .N PC,I S I=0,PC="" F  S I=$O(PS55(15,I)) Q:'I  D
"RTN","PSJPDCLU",205,0)
 ..I PCE]"" S PCE=PCE_$TR(PS55(15,I,0),"|","/") Q
"RTN","PSJPDCLU",206,0)
 ..S PC=PC_$TR(PS55(15,I,0),"|","/")
"RTN","PSJPDCLU",207,0)
 ..I $L(PC)>200 S PCE=$E(PC,201,999)_" ",PC=$E(PC,1,200)
"RTN","PSJPDCLU",208,0)
 .S $P(SEG,NFS,22)=PC
"RTN","PSJPDCLU",209,0)
 S $P(SEG,NFS,11)=$P($$DSPDRG,"^",2)
"RTN","PSJPDCLU",210,0)
 S VAR1=+$P(PS55(0),"^",2),VAR2=$P($G(^VA(200,VAR1,0)),"^") S:VAR2]"" VAR2=$$HLNAME^XLFNAME(VAR2,"",NECH),VAR1=$$DEA^XUSER(,VAR1)
"RTN","PSJPDCLU",211,0)
 S $P(SEG,NFS,14)=VAR1_NECH_VAR2
"RTN","PSJPDCLU",212,0)
 S VAR1=$P($G(PS55(4)),"^",3),VAR2="" I VAR1 S VAR2=$P($G(^VA(200,+VAR1,0)),"^") S VAR2=$$HLNAME^XLFNAME(VAR2,"",NECH)
"RTN","PSJPDCLU",213,0)
 S $P(SEG,NFS,15)=VAR1_NECH_VAR2
"RTN","PSJPDCLU",214,0)
 S $P(SEG,NFS,16)=RXO
"RTN","PSJPDCLU",215,0)
 S SEQ=SEQ+1
"RTN","PSJPDCLU",216,0)
 S NSEG(SEQ)=SEG
"RTN","PSJPDCLU",217,0)
 I $O(SEG(0)) S I=0 F  S I=$O(SEG(I)) Q:'I  S NSEG(SEQ,I)=SEG(I)
"RTN","PSJPDCLU",218,0)
 I $G(PCE)]"" D
"RTN","PSJPDCLU",219,0)
 .S SEQ=SEQ+1
"RTN","PSJPDCLU",220,0)
 .S NSEG(SEQ)="NTE"_NFS_NFS_NFS_PCE
"RTN","PSJPDCLU",221,0)
 D:$D(^XTMP("PADE")) DISP
"RTN","PSJPDCLU",222,0)
 K SEG
"RTN","PSJPDCLU",223,0)
 Q
"RTN","PSJPDCLU",224,0)
 ;
"RTN","PSJPDCLU",225,0)
IVRXE ;
"RTN","PSJPDCLU",226,0)
 N ND0,NDPT2,NDAD,NDSOL,PCE S PCE=""
"RTN","PSJPDCLU",227,0)
 S ND0=PS55(0),NDPT2=PS55(.2),NDAD=$G(PS55("AD",1,0)),NDSOL=$G(PS55("SOL",1,0))
"RTN","PSJPDCLU",228,0)
 S $P(SEG,NFS,2)=$$QT(DFN,RXO,.PS55)
"RTN","PSJPDCLU",229,0)
 S $P(SEG,NFS,3)=$$GIVECODE($S(NDAD:$P(^PS(52.6,+NDAD,0),"^",2),1:$P(^PS(52.7,+NDSOL,0),"^",2)),NECH)
"RTN","PSJPDCLU",230,0)
 S $P(SEG,NFS,4)=+$$QT(DFN,RXO,.PS55)
"RTN","PSJPDCLU",231,0)
 S $P(SEG,NFS,6)=$TR($P($G(DOSE),+DOSE,2,9)," ")
"RTN","PSJPDCLU",232,0)
 S VAR1=+$G(PS55("AD",1,0)),VAR1=+$P($G(^PS(52.6,VAR1,0)),"^",11),VAR1=+$P($G(^PS(50.7,VAR1,0)),"^",2),VAR1=$G(^PS(50.606,VAR1,0))
"RTN","PSJPDCLU",233,0)
 S $P(SEG,NFS,7)=VAR1
"RTN","PSJPDCLU",234,0)
 I $D(PS55(10)) D
"RTN","PSJPDCLU",235,0)
 .N PC,I S I=0,PC="" F  S I=$O(PS55(10,I)) Q:'I  D
"RTN","PSJPDCLU",236,0)
 ..I PCE]"" S PCE=PCE_$TR(PS55(10,I,0),"|","/") Q
"RTN","PSJPDCLU",237,0)
 ..S PC=PC_$TR(PS55(10,I,0),"|","/")
"RTN","PSJPDCLU",238,0)
 ..I $L(PC)>200 S PCE=$E(PC,201,999)_" ",PC=$E(PC,1,200)
"RTN","PSJPDCLU",239,0)
 .S $P(SEG,NFS,22)=PC
"RTN","PSJPDCLU",240,0)
 S $P(SEG,NFS,11)=1
"RTN","PSJPDCLU",241,0)
 S $P(SEG,NFS,12)="BAG"
"RTN","PSJPDCLU",242,0)
 S VAR1=+$P(PS55(0),"^",6)
"RTN","PSJPDCLU",243,0)
 D:VAR1
"RTN","PSJPDCLU",244,0)
 . S VAR2=$P($G(^VA(200,VAR1,0)),"^") S:VAR2]"" VAR2=$$HLNAME^XLFNAME(VAR2,"",NECH)
"RTN","PSJPDCLU",245,0)
 . S VAR1=$$DEA^XUSER(,VAR1)
"RTN","PSJPDCLU",246,0)
 . S $P(SEG,NFS,14)=VAR1_NECH_VAR2
"RTN","PSJPDCLU",247,0)
 S VAR1=$P($G(PS55(4)),"^",4)
"RTN","PSJPDCLU",248,0)
 D:VAR1
"RTN","PSJPDCLU",249,0)
 .S VAR2=$P($G(^VA(200,+VAR1,0)),"^") S:VAR2]"" VAR2=$$HLNAME^XLFNAME(VAR2,"",NECH)
"RTN","PSJPDCLU",250,0)
 .S $P(SEG,NFS,15)=VAR1_NECH_VAR2
"RTN","PSJPDCLU",251,0)
 S $P(SEG,NFS,16)=RXO
"RTN","PSJPDCLU",252,0)
 I $P(PS55(0),"^",15)'="" S $P(SEG,NFS,23)="M"_$P(PS55(0),"^",15)
"RTN","PSJPDCLU",253,0)
 S VAR1=$P(PS55(0),"^",8),VAR2=$P(VAR1,+VAR1,2),VAR1=+VAR1
"RTN","PSJPDCLU",254,0)
 I $E(VAR2)=" " S VAR2=$P(VAR2," ",2)
"RTN","PSJPDCLU",255,0)
 I (VAR2="")!(VAR1=0),$P(PS55(0),"^",8)'="" S VAR2=$P(PS55(0),"^",8)
"RTN","PSJPDCLU",256,0)
 S $P(SEG,NFS,24)=$S(VAR1=0:"",1:VAR1)
"RTN","PSJPDCLU",257,0)
 S $P(SEG,NFS,25)=NECH_VAR2
"RTN","PSJPDCLU",258,0)
 S VAR1=$P($G(PS55("AD",1,0)),"^",2),VAR2=$P(VAR1,+VAR1,2)
"RTN","PSJPDCLU",259,0)
 I $E(VAR2)=" " S VAR2=$P(VAR2," ",2,99)
"RTN","PSJPDCLU",260,0)
 I VAR2="" S VAR1=$P($G(PS55("SOL",1,0)),"^",2),VAR2=$P(VAR1,+VAR1,2)
"RTN","PSJPDCLU",261,0)
 I $E(VAR2)=" " S VAR2=$P(VAR2," ",2,99)
"RTN","PSJPDCLU",262,0)
 S $P(SEG,NFS,26)=+VAR1
"RTN","PSJPDCLU",263,0)
 D CONT(VAR2,27,NFS)
"RTN","PSJPDCLU",264,0)
IVC ;
"RTN","PSJPDCLU",265,0)
 S SEQ=SEQ+1
"RTN","PSJPDCLU",266,0)
 S NSEG(SEQ)=SEG
"RTN","PSJPDCLU",267,0)
 I $O(SEG(0)) S I=0 F  S I=$O(SEG(I)) Q:'I  S NSEG(SEQ,I)=SEG(I)
"RTN","PSJPDCLU",268,0)
 I $G(PCE)]"" D
"RTN","PSJPDCLU",269,0)
 .S SEQ=SEQ+1
"RTN","PSJPDCLU",270,0)
 .S NSEG(SEQ)="NTE"_NFS_NFS_NFS_PCE
"RTN","PSJPDCLU",271,0)
 D:$D(^XTMP("PADE")) DISP
"RTN","PSJPDCLU",272,0)
 K SEG
"RTN","PSJPDCLU",273,0)
 Q
"RTN","PSJPDCLU",274,0)
 ;
"RTN","PSJPDCLU",275,0)
CONT(VALUE,PIECE,FS) ;
"RTN","PSJPDCLU",276,0)
 N TEMP,TEMP2,NODES,STRING,BEG,END,REM
"RTN","PSJPDCLU",277,0)
 I $L(SEG)+$L(VALUE)<246 S $P(SEG,FS,PIECE)=VALUE Q
"RTN","PSJPDCLU",278,0)
 S TEMP=SEG_FS_VALUE
"RTN","PSJPDCLU",279,0)
 S SEG=$E(TEMP,1,245)
"RTN","PSJPDCLU",280,0)
 S STRING=$E(TEMP,246,$L(TEMP)),NODES=$L(STRING)\245,REM=$L(STRING)#245,BEG=1,END=245 I REM S NODES=NODES+1
"RTN","PSJPDCLU",281,0)
 F TEMP2=1:1:NODES S SEG(TEMP2)=$E(STRING,BEG,END) S BEG=BEG+245,END=END+245
"RTN","PSJPDCLU",282,0)
 Q
"RTN","PSJPDCLU",283,0)
 ;
"RTN","PSJPDCLU",284,0)
RXR ;
"RTN","PSJPDCLU",285,0)
 S SEG="RXR"
"RTN","PSJPDCLU",286,0)
 S VAR1=$S(RXO["U":$P(PS55(0),"^",3),1:$P(PS55(.2),"^",3))
"RTN","PSJPDCLU",287,0)
 S VAR1=$G(^PS(51.2,+VAR1,0)) S VAR2=$P(VAR1,"^"),VAR1=$P(VAR1,"^",3)
"RTN","PSJPDCLU",288,0)
 S $P(SEG,NFS,2)=VAR1_NECH_VAR2_NECH_"99PSR"
"RTN","PSJPDCLU",289,0)
 S SEQ=SEQ+1
"RTN","PSJPDCLU",290,0)
 S NSEG(SEQ)=SEG
"RTN","PSJPDCLU",291,0)
 D:$D(^XTMP("PADE")) DISP
"RTN","PSJPDCLU",292,0)
 Q
"RTN","PSJPDCLU",293,0)
 ;
"RTN","PSJPDCLU",294,0)
RXC ;
"RTN","PSJPDCLU",295,0)
 D RXC^PSJPADE
"RTN","PSJPDCLU",296,0)
 Q
"RTN","PSJPDCLU",297,0)
 ;
"RTN","PSJPDCLU",298,0)
IVRXC ;
"RTN","PSJPDCLU",299,0)
 N D,X,PSJDD,PSJADSO,FIL
"RTN","PSJPDCLU",300,0)
 F PSJADSO="SOL","AD" S D=0 F  S D=$O(PS55(PSJADSO,D)) Q:'D  S PSJDD=$P(PS55(PSJADSO,D,0),"^") D
"RTN","PSJPDCLU",301,0)
 .Q:'PSJDD
"RTN","PSJPDCLU",302,0)
 .S FIL=$S(PSJADSO="AD":52.6,1:52.7) S PSJDD=^PS(FIL,PSJDD,0),PSJDD=$P(PSJDD,"^",2)
"RTN","PSJPDCLU",303,0)
 .S SEG="RXC"_NFS_$S(PSJADSO="AD":"A",1:"B")
"RTN","PSJPDCLU",304,0)
 .S $P(SEG,NFS,3)=$$GIVECODE(PSJDD,NECH)
"RTN","PSJPDCLU",305,0)
 .S VAR1=$P(PS55(PSJADSO,D,0),"^",2),VAR2=$P(VAR1,+VAR1,2)
"RTN","PSJPDCLU",306,0)
 .S:$E(VAR2)=" " VAR2=$P(VAR2," ",2)
"RTN","PSJPDCLU",307,0)
 .S $P(SEG,NFS,4)=+VAR1
"RTN","PSJPDCLU",308,0)
 .S $P(SEG,NFS,5)=NECH_VAR2
"RTN","PSJPDCLU",309,0)
 .S VAR1=$G(^PSDRUG(PSJDD,"DOS")),X=+$P(VAR1,"^",2)
"RTN","PSJPDCLU",310,0)
 .I X S VAR2=$P($G(^PS(50.607,X,0)),"^") S VAR2=X_NECH_VAR2_NECH_"99PSU"
"RTN","PSJPDCLU",311,0)
 .I VAR1 S $P(SEG,NFS,6)=+VAR1,$P(SEG,NFS,7)=VAR2
"RTN","PSJPDCLU",312,0)
 .S SEQ=SEQ+1
"RTN","PSJPDCLU",313,0)
 .S NSEG(SEQ)=SEG
"RTN","PSJPDCLU",314,0)
 .D:$D(^XTMP("PADE")) DISP
"RTN","PSJPDCLU",315,0)
 Q
"RTN","PSJPDCLU",316,0)
 ;
"RTN","PSJPDCLU",317,0)
ZRX ;
"RTN","PSJPDCLU",318,0)
 S STATUS=$S(RXO["U":$P(PS55(0),"^",9),1:$P(PS55(0),"^",17))
"RTN","PSJPDCLU",319,0)
 S VAR1=$S($G(PDTYP)="SN":"N",STATUS["E"!(STATUS["D"):"O",1:"F")
"RTN","PSJPDCLU",320,0)
 S SEG="ZRX"_NFS_VAR1_NFS_+PDHDT
"RTN","PSJPDCLU",321,0)
 S SEQ=SEQ+1
"RTN","PSJPDCLU",322,0)
 S NSEG(SEQ)=SEG
"RTN","PSJPDCLU",323,0)
 D:$D(^XTMP("PADE")) DISP
"RTN","PSJPDCLU",324,0)
 Q
"RTN","PSJPDCLU",325,0)
 ;
"RTN","PSJPDCLU",326,0)
GETFORM(PSJ55) ;
"RTN","PSJPDCLU",327,0)
 N X
"RTN","PSJPDCLU",328,0)
 S X=+$P($G(^PSDRUG(+$$DSPDRG,2)),"^")
"RTN","PSJPDCLU",329,0)
 I X S X=+$P($G(^PS(50.7,X,0)),"^",2),VAR1=$P($G(^PS(50.606,X,0)),"^")
"RTN","PSJPDCLU",330,0)
 I VAR1="" S VAR1=$P($G(^PSDRUG(+$$DSPDRG,660)),"^",8)
"RTN","PSJPDCLU",331,0)
 I VAR1="" S X=$P($G(^PSDRUG(+$$DSPDRG,"ND")),"^",3) S:X VAR1=$P($$PROD2^PSNAPIS(,X),"^",4)
"RTN","PSJPDCLU",332,0)
 Q VAR1
"RTN","PSJPDCLU",333,0)
 ;
"RTN","PSJPDCLU",334,0)
QT(DFN,RXO,PS55) ;
"RTN","PSJPDCLU",335,0)
 S VAR1=""
"RTN","PSJPDCLU",336,0)
 I RXO["U" D  Q VAR1
"RTN","PSJPDCLU",337,0)
 .S DOSE=$TR($P($G(PS55(.2)),"^",2),",")
"RTN","PSJPDCLU",338,0)
 .N AT,NAT S AT=$TR($P(PS55(2),"^",5),"-",","),NAT=""
"RTN","PSJPDCLU",339,0)
 .I AT N I,J F I=1:1:$L(AT,",") S J=$P(AT,",",I) D
"RTN","PSJPDCLU",340,0)
 ..S J=$S($L(J)=2:J_"00",1:J)
"RTN","PSJPDCLU",341,0)
 ..S $P(NAT,",",I)=J
"RTN","PSJPDCLU",342,0)
 .S VAR1=+DOSE_NECH_$P(PS55(2),"^")_NSCS_NAT_NECH_NECH
"RTN","PSJPDCLU",343,0)
 .S VAR1=VAR1_+$$HLDATE^HLFNC($P(PS55(2),"^",2),"TS")_NECH_+$$HLDATE^HLFNC($P(PS55(2),"^",4),"TS")_NECH
"RTN","PSJPDCLU",344,0)
 .S VAR2=$$PRNOK^PSGS0($P(PS55(2),"^"))
"RTN","PSJPDCLU",345,0)
 .S VAR1=VAR1_NECH_VAR2_NECH_$$DOWSTR($P(PS55(2),"^"))
"RTN","PSJPDCLU",346,0)
 I RXO["V" D  Q VAR1
"RTN","PSJPDCLU",347,0)
 .S ND0=PS55(0),NDPT2=PS55(.2),NDAD=$G(PS55("AD",1,0)),NDSOL=$G(PS55("SOL",1,0))
"RTN","PSJPDCLU",348,0)
 .S DOSE=$P($G(PS55("AD",1,0)),"^",2) S VAR2=$TR($P(DOSE,+DOSE,2,9)," ")
"RTN","PSJPDCLU",349,0)
 .I VAR2="" S DOSE=$P($G(PS55("SOL",1,0)),"^",2) S VAR2=$TR($P(DOSE,+DOSE,2,9)," ")
"RTN","PSJPDCLU",350,0)
 .N AT,NAT S AT=$TR($P(PS55(0),"^",11),"-",","),NAT=""
"RTN","PSJPDCLU",351,0)
 .I AT N I,J F I=1:1:$L(AT,",") S J=$P(AT,",",I) D
"RTN","PSJPDCLU",352,0)
 ..S J=$S($L(J)=2:J_"00",1:J)
"RTN","PSJPDCLU",353,0)
 ..S $P(NAT,",",I)=J
"RTN","PSJPDCLU",354,0)
 .S VAR1=+DOSE_NSCS_VAR2_NECH_$S(($P(PS55(0),"^",9)]""):$P(PS55(0),"^",9),1:"C")_NSCS_NAT_NECH_NECH
"RTN","PSJPDCLU",355,0)
 .S VAR1=VAR1_+$$HLDATE^HLFNC($P(PS55(0),"^",2))_NECH_+$$HLDATE^HLFNC($P(PS55(0),"^",3)) S VAR2=$P(PS55(.2),"^",4)
"RTN","PSJPDCLU",356,0)
 .S VAR2=$$PRNOK^PSGS0($P(PS55(2),"^"))
"RTN","PSJPDCLU",357,0)
 .S VAR1=VAR1_NECH_VAR2_NECH_$$DOWSTR($P(PS55(0),"^",9))
"RTN","PSJPDCLU",358,0)
 Q
"RTN","PSJPDCLU",359,0)
 ;
"RTN","PSJPDCLU",360,0)
DOWSTR(DOWSCH) ;
"RTN","PSJPDCLU",361,0)
 N SQ,SQ2,DD,QX,SDW,SWD,DOWSCH2,DAYSTR
"RTN","PSJPDCLU",362,0)
 S DAYSTR="00000000",DOWSCH=$P(DOWSCH,"@")
"RTN","PSJPDCLU",363,0)
 S DOWSCH2="-SU-MO-TU-WE-TH-FR-SA-"
"RTN","PSJPDCLU",364,0)
 F SQ=1:1:$L(DOWSCH,"-") S DD=$E($P(DOWSCH,"-",SQ),1,2) S SQ2=$P(DOWSCH2,DD) Q:(SQ2=DOWSCH2)  S SQ2=$L(SQ2,"-")-1 S $E(DAYSTR,SQ2)=1
"RTN","PSJPDCLU",365,0)
 Q DAYSTR
"RTN","PSJPDCLU",366,0)
 ;
"RTN","PSJPDCLU",367,0)
DSPDRG() ;
"RTN","PSJPDCLU",368,0)
 N I,J S I=0,J=999999
"RTN","PSJPDCLU",369,0)
 F  S J=$O(PS55(1,J),-1) Q:J=0  D  Q:I
"RTN","PSJPDCLU",370,0)
 . I $P(PS55(1,J,0),"^",3),$P(PS55(1,J,0),"^",3)'>DT Q  ;inactive drug
"RTN","PSJPDCLU",371,0)
 . S I=J
"RTN","PSJPDCLU",372,0)
 S:'I I=1
"RTN","PSJPDCLU",373,0)
 Q $G(PS55(1,I,0))
"RTN","PSJPDCLU",374,0)
 ;
"RTN","PSJPDCLU",375,0)
GIVECODE(ID,CS) ;
"RTN","PSJPDCLU",376,0)
 N DRGID,DRGNM,DRGNM2,DRGSTR,DRUGND
"RTN","PSJPDCLU",377,0)
 Q:'$D(^PSDRUG(ID)) ""
"RTN","PSJPDCLU",378,0)
 S DRUGND=$G(^PSDRUG(ID,"ND"))
"RTN","PSJPDCLU",379,0)
 S DRGNM=$P($G(^PSDRUG(ID,0)),"^"),PDL(14)=ID
"RTN","PSJPDCLU",380,0)
 S DRGSTR=ID_CS_DRGNM_CS_"99PSD"
"RTN","PSJPDCLU",381,0)
 S DRGNM2=$P(DRUGND,"^",2)
"RTN","PSJPDCLU",382,0)
 S DRGID=$P(DRUGND,"^",3)
"RTN","PSJPDCLU",383,0)
 S DRGSTR=DRGSTR_CS_DRGID_CS_DRGNM2_CS_"99PSP"
"RTN","PSJPDCLU",384,0)
 Q DRGSTR
"RTN","PSJPDCLU",385,0)
 ;
"RTN","PSJPDCLU",386,0)
DISP ;
"RTN","PSJPDCLU",387,0)
 Q:'$D(^XUSEC("PSJ PADE MGR",DUZ))
"RTN","PSJPDCLU",388,0)
 D FULL^VALM1
"RTN","PSJPDCLU",389,0)
 W !!,?5,"THIS IS THE PADE "_$P(NSEG(SEQ),NFS)_" SEGMENT."
"RTN","PSJPDCLU",390,0)
 N TR,TX F TR=1:1:$L(NSEG(SEQ),NFS) S TX=$P(NSEG(SEQ),NFS,TR) W !,$P(NSEG(SEQ),NFS)_"-"_(TR-1)_$S(TR<10:"= ",1:"=")_TX
"RTN","PSJPDCLU",391,0)
 D PAUSE^VALM1
"RTN","PSJPDCLU",392,0)
 Q
"RTN","PSJPDCLU",393,0)
 ;
"RTN","PSJPDRIN")
0^22^B220627483^n/a
"RTN","PSJPDRIN",1,0)
PSJPDRIN ;BIR/MV-MAIN DRIVER PADE INVENTORY REPORT  ;11/15/2015
"RTN","PSJPDRIN",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**317**;16 DEC 97;Build 130
"RTN","PSJPDRIN",3,0)
 ;
"RTN","PSJPDRIN",4,0)
 ; Reference to ^PS(50.7 is supported by DBIA 2180.
"RTN","PSJPDRIN",5,0)
 ; Reference to DATA^PSN50P68 is supported by DBIA 4545.
"RTN","PSJPDRIN",6,0)
 ; Reference to DIC^PSSDI is supported by DBIA 4551.
"RTN","PSJPDRIN",7,0)
 ; Reference to ^%ZTLOAD is supported by DBIA 10063.
"RTN","PSJPDRIN",8,0)
 ; Reference to CLEAR^VALM1 is supported by DBIA 10116.
"RTN","PSJPDRIN",9,0)
 ; Reference to EN^DDIOL is supported by DBIA 10142.
"RTN","PSJPDRIN",10,0)
 ; Reference to ^%ZIS is supported by DBIA 10086.
"RTN","PSJPDRIN",11,0)
 ;
"RTN","PSJPDRIN",12,0)
 Q
"RTN","PSJPDRIN",13,0)
 ;
"RTN","PSJPDRIN",14,0)
EN ; Main Entry point
"RTN","PSJPDRIN",15,0)
 N PSJSTOP,PSDRG,PSJINP,DTOUT,DUOUT,DA,DIC,DR,DIR
"RTN","PSJPDRIN",16,0)
 S PSJSTOP=0
"RTN","PSJPDRIN",17,0)
 F  Q:$G(PSJSTOP)<0  D ENLOOP
"RTN","PSJPDRIN",18,0)
 Q
"RTN","PSJPDRIN",19,0)
 ;
"RTN","PSJPDRIN",20,0)
ENLOOP ; Prompt loop
"RTN","PSJPDRIN",21,0)
 N PSJINP,ZTSK,ZTDESC,ZTRTN,ZTSAVE
"RTN","PSJPDRIN",22,0)
 S PSJSTOP=0
"RTN","PSJPDRIN",23,0)
 D ASK(.PSJINP) G:PSJSTOP EXIT
"RTN","PSJPDRIN",24,0)
 Q:$G(PSJINP("PSJDEV"))="Q"
"RTN","PSJPDRIN",25,0)
START ; Queued entry
"RTN","PSJPDRIN",26,0)
 N PSJSTOP S PSJSTOP=0
"RTN","PSJPDRIN",27,0)
 K ^TMP("PSJPDRIN",$J)
"RTN","PSJPDRIN",28,0)
 D PROCESS(.PSJINP) G:PSJSTOP EXIT
"RTN","PSJPDRIN",29,0)
 D EN^PSJPDRIP(.PSJINP)
"RTN","PSJPDRIN",30,0)
 I $G(PSJINP("PSJDELM"))="D" D
"RTN","PSJPDRIN",31,0)
 .N DIR,X,Y S DIR(0)="EA"
"RTN","PSJPDRIN",32,0)
 .S DIR("A",1)=""
"RTN","PSJPDRIN",33,0)
 .S DIR("A",2)="The delimited report is complete."
"RTN","PSJPDRIN",34,0)
 .S DIR("A")="Please turn logging off, then press return to continue."
"RTN","PSJPDRIN",35,0)
 .D ^DIR
"RTN","PSJPDRIN",36,0)
 Q
"RTN","PSJPDRIN",37,0)
 ;
"RTN","PSJPDRIN",38,0)
EXIT ; Clean up
"RTN","PSJPDRIN",39,0)
 K ^TMP("PSJPDRIN",$J),ZTSK
"RTN","PSJPDRIN",40,0)
 Q
"RTN","PSJPDRIN",41,0)
 ;
"RTN","PSJPDRIN",42,0)
ASK(PSJINP) ;Prompt for selection criteria.  Quit when PSJSTOP is true
"RTN","PSJPDRIN",43,0)
 ;
"RTN","PSJPDRIN",44,0)
 N PSJCSUB,PSJSYS,PSJDEV,PSJDIV,PADEV,PSJSUMM,PSJDELIM,PSJDRG,PSDRG
"RTN","PSJPDRIN",45,0)
 D CLEAR^VALM1 W !!
"RTN","PSJPDRIN",46,0)
 S PSJSTOP=0
"RTN","PSJPDRIN",47,0)
 W ?20,"PADE On-Hand Inventory Report",!
"RTN","PSJPDRIN",48,0)
 S PSJINP("PSJPSYS")=$$PSYS Q:PSJSTOP
"RTN","PSJPDRIN",49,0)
 D DIV^PSJPDRIP(.PSJDIV,.PSJSTOP) Q:PSJSTOP  M PSJINP("PSJDIV")=PSJDIV
"RTN","PSJPDRIN",50,0)
 D PADEV(.PADEV,.PSJINP) Q:PSJSTOP  M PSJINP("PADEV")=PADEV
"RTN","PSJPDRIN",51,0)
 D PSJCSUB(.PSJINP,.PSJCSUB) Q:PSJSTOP  M PSJINP("PSJCSUB")=PSJCSUB
"RTN","PSJPDRIN",52,0)
 D DRUG(.PSDRG,.PSJINP) Q:PSJSTOP  M PSJINP("PSDRG")=PSDRG
"RTN","PSJPDRIN",53,0)
 S PSJINP("PSJSUM")=$$SUMM Q:PSJSTOP
"RTN","PSJPDRIN",54,0)
 S PSJINP("PSJDELM")=$$DELIM Q:PSJSTOP
"RTN","PSJPDRIN",55,0)
 S PSJINP("PSJDEV")=$$SELDEV(,.PSJINP) S:$G(DUOUT)!$G(DTOUT) PSJSTOP=1 Q:PSJSTOP
"RTN","PSJPDRIN",56,0)
 Q
"RTN","PSJPDRIN",57,0)
 ;
"RTN","PSJPDRIN",58,0)
PSYS() ; Get PADE Inventory System
"RTN","PSJPDRIN",59,0)
 N PSYS
"RTN","PSJPDRIN",60,0)
 S PSYS=$$PSYS^PSJPDRUT()
"RTN","PSJPDRIN",61,0)
 Q PSYS
"RTN","PSJPDRIN",62,0)
 ;
"RTN","PSJPDRIN",63,0)
DIV() ; Get Division
"RTN","PSJPDRIN",64,0)
 N PSDIV,DIC,X,Y
"RTN","PSJPDRIN",65,0)
 S DIC("S")="I $D(^PS(58.63,""D"",+Y))"
"RTN","PSJPDRIN",66,0)
 S DIC=40.8,DIC(0)="QAE",DIC("A")="Select Division: " D ^DIC
"RTN","PSJPDRIN",67,0)
 S PSDIV=$S(Y>0:+Y,1:"")
"RTN","PSJPDRIN",68,0)
 I $G(DUOUT)!$G(DTOUT)!(PSDIV="") S PSJSTOP=1
"RTN","PSJPDRIN",69,0)
 Q PSDIV
"RTN","PSJPDRIN",70,0)
 ;
"RTN","PSJPDRIN",71,0)
PADEV(PADEV,PSJINP) ; Get PADE dispensing device(s), screen for Division and PADE Inventory System
"RTN","PSJPDRIN",72,0)
 ;Requires PSJINP("PSJDIV"),PSJINP("PSJPSYS")
"RTN","PSJPDRIN",73,0)
 N PADNAM,PADIEN,PADTMP
"RTN","PSJPDRIN",74,0)
 D PADEV^PSJPDRTR(.PADEV,.PSJINP,1)
"RTN","PSJPDRIN",75,0)
 Q:($D(PADEV)<10)
"RTN","PSJPDRIN",76,0)
 M PADTMP=PADEV
"RTN","PSJPDRIN",77,0)
 K PADEV
"RTN","PSJPDRIN",78,0)
 S PADNAM=0 F  S PADNAM=$O(PADTMP(PADNAM)) Q:PADNAM=""  D
"RTN","PSJPDRIN",79,0)
 .Q:'$G(PADTMP(PADNAM))
"RTN","PSJPDRIN",80,0)
 .S PADEV(PADTMP(PADNAM))=PADNAM
"RTN","PSJPDRIN",81,0)
 Q
"RTN","PSJPDRIN",82,0)
 ;
"RTN","PSJPDRIN",83,0)
CAB(PSJINP,PADEV) ; Get PADE (cabinets) 
"RTN","PSJPDRIN",84,0)
 N PSCAB,DIC,X,Y,PSJDIV,PSJPSYS,PSJSCR,PSCABHLP,PSJX
"RTN","PSJPDRIN",85,0)
 S PSJDIV=$G(PSJINP("PSJDIV"))
"RTN","PSJPDRIN",86,0)
 S PSJPSYS=$G(PSJINP("PSJPSYS"))
"RTN","PSJPDRIN",87,0)
 S PSCABHLP="Select one or more PADE Dispensing Devices, or enter '^ALL' to select all."
"RTN","PSJPDRIN",88,0)
 S DIC("S")="I ($D(PSJINP(""PSJDIV"",+$G(^PS(58.63,+Y,2)))))&('$$EMPTY^PSJPADPT(+Y))"
"RTN","PSJPDRIN",89,0)
 S DIC=58.63,DIC(0)="QABE",DIC("A")="Select PADE Dispensing Device: "_$S($D(PADEV)<10:"^ALL// ",1:"")
"RTN","PSJPDRIN",90,0)
 S DIC("W")="N PSJPADST S PSJPADST=$P($G(^PS(58.63,+$G(Y),0)),""^"",4),PSJPADST=$S(PSJPADST=""I"":"" (INACTIVE)"",1:"""") W PSJPADST"
"RTN","PSJPDRIN",91,0)
 D ^DIC S PSJX=X
"RTN","PSJPDRIN",92,0)
 S:$E(PSJX)="^" Y=$$XALL^PSJPDRIP(PSJX)
"RTN","PSJPDRIN",93,0)
 I X="",$D(PADEV)<10 S Y="ALL"
"RTN","PSJPDRIN",94,0)
 S:Y=-1 Y=""
"RTN","PSJPDRIN",95,0)
 S PSCAB=Y
"RTN","PSJPDRIN",96,0)
 S:($G(DUOUT)&(PSCAB'="ALL"))!$G(DTOUT) PSJSTOP=1
"RTN","PSJPDRIN",97,0)
 Q PSCAB
"RTN","PSJPDRIN",98,0)
 ;
"RTN","PSJPDRIN",99,0)
PSJCSUB(PSJINP,PSJCSUB) ; Get Controlled Subs (CS) Schedules
"RTN","PSJPDRIN",100,0)
 N DIR,X,Y,PSJDONE,SCHED,SCHLST
"RTN","PSJPDRIN",101,0)
 K PSJCSUB
"RTN","PSJPDRIN",102,0)
 W ! D EN^DDIOL("  Enter '^ALL' to select all Controlled substance")
"RTN","PSJPDRIN",103,0)
 D EN^DDIOL("   schedules and all non-controlled substances.") W !
"RTN","PSJPDRIN",104,0)
 S DIR("A")="Enter (C)S or (N)on-CS: ^ALL//",DIR(0)="SAO^C:Controlled Substances;N:Non-Controlled Substances;ALL:All CS Schedules and Non-CS"
"RTN","PSJPDRIN",105,0)
 D ^DIR S:X="" Y="ALL"
"RTN","PSJPDRIN",106,0)
 I $E(X)="^" S Y=$$XALL^PSJPDRIP(X)
"RTN","PSJPDRIN",107,0)
 S PSJCSUB=Y
"RTN","PSJPDRIN",108,0)
 I PSJCSUB'="ALL"&($G(DUOUT)!$G(DTOUT)!(Y="")) S PSJSTOP=1 Q
"RTN","PSJPDRIN",109,0)
 S:PSJCSUB="N"!(PSJCSUB="ALL") PSJCSUB(0)="Unscheduled"
"RTN","PSJPDRIN",110,0)
 Q:PSJCSUB="N"
"RTN","PSJPDRIN",111,0)
 ; If YES to Controlled Subs, get CS Schedule
"RTN","PSJPDRIN",112,0)
 S SCHLST="1:Schedule I;2:Schedule II;2n:Schedule II Non-Narcotics;3:Schedule III;3n:Schedule III Non-Narcotics;4:Schedule IV;5:Schedule V"
"RTN","PSJPDRIN",113,0)
 I PSJCSUB="ALL" D ALLSCHED^PSJPDRIP(.PSJCSUB,SCHLST) S PSJCSUB="ALL" Q
"RTN","PSJPDRIN",114,0)
 K PSJDONE,PSJCSUB
"RTN","PSJPDRIN",115,0)
 N DIR,X,Y,SCNT
"RTN","PSJPDRIN",116,0)
 F  Q:$G(PSJSTOP)!$G(PSJDONE)  D SELCSUB^PSJPDRTR(.PSJCSUB)
"RTN","PSJPDRIN",117,0)
 Q
"RTN","PSJPDRIN",118,0)
 ;
"RTN","PSJPDRIN",119,0)
DRUG(DRUG,PSJINP) ; Allow user to select appropriate subset of drug items
"RTN","PSJPDRIN",120,0)
 N PSDONE,DIC,X,Y,GETDRG,LSTCNT,PSJCSUB,DRGARAY,PSJPSYS,PADEV,PSJDRC
"RTN","PSJPDRIN",121,0)
 S PSJCSUB=$G(PSJINP("PSJCSUB"))
"RTN","PSJPDRIN",122,0)
 S PSJPSYS=$G(PSJINP("PSJPSYS"))
"RTN","PSJPDRIN",123,0)
 M PADEV=PSJINP("PADEV")
"RTN","PSJPDRIN",124,0)
 D DRCAB(.PSJINP,.PSJDRC)         ; Get drugs linked to cabinet(s)
"RTN","PSJPDRIN",125,0)
 D DRUGSEL^PSJPDRTR(.PSJINP,.PSJDRC,.DRUG,,.PSJSTOP) ; Prompt for drug items
"RTN","PSJPDRIN",126,0)
 Q
"RTN","PSJPDRIN",127,0)
 ;
"RTN","PSJPDRIN",128,0)
SUMM() ; Prompt user for Detailed or Summary report
"RTN","PSJPDRIN",129,0)
 N SUMM,DIR,X,Y
"RTN","PSJPDRIN",130,0)
 S DIR(0)="S^D:Detailed Report;S:Summary Report"
"RTN","PSJPDRIN",131,0)
 S DIR("A")="Select (D)etail or (S)ummary Report "
"RTN","PSJPDRIN",132,0)
 S DIR("B")="S",DIR("?")="You may select 'D'  for a detailed report or 'S' for a Summary report."
"RTN","PSJPDRIN",133,0)
 D ^DIR S:$G(DUOUT)!$G(DTOUT) PSJSTOP=1
"RTN","PSJPDRIN",134,0)
 Q Y
"RTN","PSJPDRIN",135,0)
 ;
"RTN","PSJPDRIN",136,0)
DELIM() ; Prompt user for delimited output or formatted report.
"RTN","PSJPDRIN",137,0)
 N DELIM,DIR,X,Y
"RTN","PSJPDRIN",138,0)
 S DIR(0)="S^R:Report;D:Delimited Output"
"RTN","PSJPDRIN",139,0)
 S DIR("A")="Select (R)eport or (D)elimited output "
"RTN","PSJPDRIN",140,0)
 S DIR("B")="R",DIR("?")="You may select 'R' for a report or 'D' for CSV delimited output (for spreadsheet)"
"RTN","PSJPDRIN",141,0)
 D ^DIR S:$G(DUOUT)!$G(DTOUT) PSJSTOP=1
"RTN","PSJPDRIN",142,0)
 S DELIM=Y
"RTN","PSJPDRIN",143,0)
 Q DELIM
"RTN","PSJPDRIN",144,0)
 ;
"RTN","PSJPDRIN",145,0)
GETCLASS(DRGIEN) ; Get Controlled Substance Federal Schedule from VA PRODUCT FILE for DRUG FILE (#50) entry DRGIEN
"RTN","PSJPDRIN",146,0)
 ;  Input :  pointer to DRUG (#50) file
"RTN","PSJPDRIN",147,0)
 ; Output : Value from CS FEDERAL SCHEDULE field (#19) in VA PRODUCT (#50.68) file
"RTN","PSJPDRIN",148,0)
 N PSJDPROD,PSJCLASS,PSJNDF
"RTN","PSJPDRIN",149,0)
 Q:'$G(DRGIEN) "-1"
"RTN","PSJPDRIN",150,0)
 K ^TMP($J,"PSJCLASS")
"RTN","PSJPDRIN",151,0)
 S PSJNDF=$P($G(^PSDRUG(+DRGIEN,"ND")),"^",3) I '$G(PSJNDF) Q 0
"RTN","PSJPDRIN",152,0)
 D DATA^PSN50P68(PSJNDF,,"PSJCLASS")
"RTN","PSJPDRIN",153,0)
 S PSJCLASS=+$G(^TMP($J,"PSJCLASS",+PSJNDF,19))
"RTN","PSJPDRIN",154,0)
 S PSJCLASS=$S(PSJCLASS]"":PSJCLASS,1:0)
"RTN","PSJPDRIN",155,0)
 K ^TMP($J,"PSJCLASS")
"RTN","PSJPDRIN",156,0)
 Q PSJCLASS
"RTN","PSJPDRIN",157,0)
 ;
"RTN","PSJPDRIN",158,0)
LISTDRG(SCREEN,DRGARAY) ; Get list of drugs from drug file screened by SCREEN, outpat DRGARAY
"RTN","PSJPDRIN",159,0)
 K DRGARAY
"RTN","PSJPDRIN",160,0)
 N DIC,X,Y
"RTN","PSJPDRIN",161,0)
 D LIST^DIC(50,,,"P",,,,,SCREEN,,"DRGARAY")
"RTN","PSJPDRIN",162,0)
 Q
"RTN","PSJPDRIN",163,0)
 ;
"RTN","PSJPDRIN",164,0)
PROCESS(PSJINP) ; Gather report data, store in ^TMP
"RTN","PSJPDRIN",165,0)
 I PSJINP("PSJSUM")="S" D PROCSUM(.PSJINP) Q
"RTN","PSJPDRIN",166,0)
 I PSJINP("PSJSUM")'="S" D PROCDET(.PSJINP)
"RTN","PSJPDRIN",167,0)
 Q
"RTN","PSJPDRIN",168,0)
 ;
"RTN","PSJPDRIN",169,0)
PROCSUM(PSJINP) ; Gather SUMMARY report data
"RTN","PSJPDRIN",170,0)
 N PSJCAB,PSJDRG,CC,LNCNT,TABMAR,PSJPSYS,PSJCABNM,PSJQTY,PSJDFORM,PSJII,PSJOI,PSJDFIEN,PSJCABST,PSJDRGX,PSJDNAM
"RTN","PSJPDRIN",171,0)
 S PSJINP("PSPGTOT")=1,LNCNT=1
"RTN","PSJPDRIN",172,0)
 S $P(TABMAR," ",40)=" "
"RTN","PSJPDRIN",173,0)
 S PSJPSYS=+PSJINP("PSJPSYS")
"RTN","PSJPDRIN",174,0)
 M PSJCAB=PSJINP("PADEV")
"RTN","PSJPDRIN",175,0)
 M PSJDRG=PSJINP("PSDRG")
"RTN","PSJPDRIN",176,0)
 S PSJCAB=0 F CC=0:1 S PSJCAB=$O(PSJCAB(PSJCAB)) Q:'PSJCAB  D
"RTN","PSJPDRIN",177,0)
 .S PSJCABNM=$P($G(^PS(58.63,PSJCAB,0)),"^"),PSJCABST=$P($G(^PS(58.63,PSJCAB,0)),"^",4),PSJCABST=$S(PSJCABST="I":"(I)",1:"")
"RTN","PSJPDRIN",178,0)
 .N PSJDRGX D ALPHADRG(PSJPSYS,PSJCAB,.PSJDRG,.PSJDRGX)
"RTN","PSJPDRIN",179,0)
 .I PSJINP("PSJDELM")="R" D
"RTN","PSJPDRIN",180,0)
 ..Q:'$D(PSJDRGX)
"RTN","PSJPDRIN",181,0)
 ..I $G(CC) S ^TMP("PSJPDRIN",$J,LNCNT)="^",LNCNT=LNCNT+1
"RTN","PSJPDRIN",182,0)
 ..S ^TMP("PSJPDRIN",$J,LNCNT)=PSJCABNM_PSJCABST,LNCNT=LNCNT+1
"RTN","PSJPDRIN",183,0)
 .S PSJDNAM="" F PSJII=1:1 S PSJDNAM=$O(PSJDRGX(PSJDNAM)) Q:PSJDNAM=""  S PSJDRG=0 S PSJDRG=$O(PSJDRGX(PSJDNAM,PSJDRG)) Q:'PSJDRG  D
"RTN","PSJPDRIN",184,0)
 ..S PSJCABNM=$S(PSJINP("PSJDELM")="D":PSJCABNM,1:"")
"RTN","PSJPDRIN",185,0)
 ..S PSJQTY=$$QTY(PSJPSYS,PSJCAB,PSJDRG)
"RTN","PSJPDRIN",186,0)
 ..S PSJOI=+$G(^PSDRUG(PSJDRG,2))
"RTN","PSJPDRIN",187,0)
 ..S PSJDFORM=$E($$DFORM(PSJPSYS,PSJCAB,PSJDRG),1,11)
"RTN","PSJPDRIN",188,0)
 ..I PSJDFORM="" S PSJDFIEN=$P($G(^PS(50.7,PSJOI,0)),"^",2) I PSJDFIEN D
"RTN","PSJPDRIN",189,0)
 ...N X,Y,DIC
"RTN","PSJPDRIN",190,0)
 ...S DIC(0)="XN",DIC="^PS(50.606,",X=+PSJDFIEN
"RTN","PSJPDRIN",191,0)
 ...D DIC^PSSDI(50.606,"PSJ",.DIC,.X)
"RTN","PSJPDRIN",192,0)
 ...S PSJDFORM=$P($G(Y),"^",2)
"RTN","PSJPDRIN",193,0)
 ..S ^TMP("PSJPDRIN",$J,LNCNT)=PSJCABNM_"^"_PSJDNAM_" ("_PSJDRG_")"_"^"_PSJDFORM_"^"_$S(PSJINP("PSJDELM")="R":$J(PSJQTY,4),1:PSJQTY),LNCNT=LNCNT+1
"RTN","PSJPDRIN",194,0)
 Q
"RTN","PSJPDRIN",195,0)
 ;
"RTN","PSJPDRIN",196,0)
PROCDET(PSJINP) ; Gather DETAIL report data
"RTN","PSJPDRIN",197,0)
 N PSJCAB,PSJDRG,CC,LNCNT,TABMAR,PSJPSYS,PSJCABNM,DRGTOT,QTY,PSJDFORM,PSJOI,PSJII,QTY,PSJCOL,PCKNAM
"RTN","PSJPDRIN",198,0)
 N PSJDFIEN,PSJDRNAM,PSJDRIEN,DRCNTOT
"RTN","PSJPDRIN",199,0)
 S PSJINP("PSPGTOT")=1,LNCNT=1
"RTN","PSJPDRIN",200,0)
 S $P(TABMAR," ",40)=" "
"RTN","PSJPDRIN",201,0)
 S PSJPSYS=+PSJINP("PSJPSYS")
"RTN","PSJPDRIN",202,0)
 M PSJCAB=PSJINP("PADEV")
"RTN","PSJPDRIN",203,0)
 M PSJDRG=PSJINP("PSDRG")
"RTN","PSJPDRIN",204,0)
 D SETCOLS^PSJPDRIP(.PSJINP,.PSJCOL)
"RTN","PSJPDRIN",205,0)
 S PSJDRIEN=0 F  S PSJDRIEN=$O(PSJDRG(PSJDRIEN)) Q:'PSJDRIEN  S PSJDRNAM=$P(PSJDRG(PSJDRIEN),"^") D
"RTN","PSJPDRIN",206,0)
 .S PSJDRNAM(PSJDRNAM_"^"_PSJDRIEN)=""
"RTN","PSJPDRIN",207,0)
 S PSJDRNAM="" F  S PSJDRNAM=$O(PSJDRNAM(PSJDRNAM)) Q:PSJDRNAM=""  D
"RTN","PSJPDRIN",208,0)
 .S PSJDRG=$P(PSJDRNAM,"^",2)
"RTN","PSJPDRIN",209,0)
 .N DRWPCK,PSBFLAG
"RTN","PSJPDRIN",210,0)
 .S:PSJINP("PSJDELM")="R" ^TMP("PSJPDRIN",$J,LNCNT)=" ^ ",LNCNT=LNCNT+1
"RTN","PSJPDRIN",211,0)
 .S DRGTOT=0,DRCNTOT=0
"RTN","PSJPDRIN",212,0)
 .S PSBFLAG=0     ; If a Patient Specific Bin is included in the list, set flag
"RTN","PSJPDRIN",213,0)
 .S PSJCAB=0 F  S PSJCAB=$O(PSJCAB(PSJCAB)) Q:'PSJCAB  I $D(^PS(58.601,"DEV",PSJCAB,PSJDRG)) D
"RTN","PSJPDRIN",214,0)
 ..N PSDRGLEN,PSJCABST,DRWPCK
"RTN","PSJPDRIN",215,0)
 ..S PSJCABST=$P($G(^PS(58.63,PSJCAB,0)),"^",4),PSJCABST=$S(PSJCABST="I":"(I)",1:"")
"RTN","PSJPDRIN",216,0)
 ..S PSJCABNM=$P($G(^PS(58.63,PSJCAB,0)),"^")_PSJCABST
"RTN","PSJPDRIN",217,0)
 ..S PSJQTY=$$QTY(PSJPSYS,PSJCAB,PSJDRG)
"RTN","PSJPDRIN",218,0)
 ..S DRGTOT=$G(DRGTOT)+PSJQTY
"RTN","PSJPDRIN",219,0)
 ..S PSJOI=+$G(^PSDRUG(PSJDRG,2))
"RTN","PSJPDRIN",220,0)
 ..S PSJDFIEN=$P($G(^PS(50.7,PSJOI,0)),"^",2)
"RTN","PSJPDRIN",221,0)
 ..S PSJDFORM=$$DFORM(PSJPSYS,PSJCAB,PSJDRG)
"RTN","PSJPDRIN",222,0)
 ..I PSJDFORM="" S PSJDFIEN=$P($G(^PS(50.7,PSJOI,0)),"^",2) I PSJDFIEN D
"RTN","PSJPDRIN",223,0)
 ...N X,Y,DIC
"RTN","PSJPDRIN",224,0)
 ...S DIC(0)="XN",DIC="^PS(50.606,",X=+PSJDFIEN
"RTN","PSJPDRIN",225,0)
 ...D DIC^PSSDI(50.606,"PSJ",.DIC,.X)
"RTN","PSJPDRIN",226,0)
 ...S PSJDFORM=$P($G(Y),"^",2)
"RTN","PSJPDRIN",227,0)
 ..D POCKDRG^PSJPDRIP(PSJPSYS,PSJCAB,PSJDRG,.DRWPCK)
"RTN","PSJPDRIN",228,0)
 ..N CC D  Q
"RTN","PSJPDRIN",229,0)
 ...S PCKNAM="" F CC=1:1 S PCKNAM=$O(DRWPCK(PSJDRG,PCKNAM)) Q:PCKNAM=""  D
"RTN","PSJPDRIN",230,0)
 ....N QTY,FMTQTY S QTY=+DRWPCK(PSJDRG,PCKNAM)
"RTN","PSJPDRIN",231,0)
 ....S DRCNTOT=$G(DRCNTOT)+QTY                           ; *Requires individual pocket balances for multi-pocket drugs*
"RTN","PSJPDRIN",232,0)
 ....N PSJDTRUN  ;  Handle max length drug names
"RTN","PSJPDRIN",233,0)
 ....S PSJDTRUN=$P($G(^PSDRUG(PSJDRG,0)),"^")
"RTN","PSJPDRIN",234,0)
 ....I $L(PSJDTRUN)>33 S PSJDTRUN=$E(PSJDTRUN,1,33)
"RTN","PSJPDRIN",235,0)
 ....S PSJDTRUN=PSJDTRUN_"("_PSJDRG_")"
"RTN","PSJPDRIN",236,0)
 ....S FMTQTY=$S(PCKNAM["PSB":"*"_QTY,$E(PCKNAM,$L(PCKNAM)-1,$L(PCKNAM))="RB":"*"_QTY,1:QTY)
"RTN","PSJPDRIN",237,0)
 ....I FMTQTY["*" D
"RTN","PSJPDRIN",238,0)
 .....S PSBFLAG("PSB")=$S($E(PCKNAM,$L(PCKNAM)-2,$L(PCKNAM))["PSB":1,1:$G(PSBFLAG("PSB")))
"RTN","PSJPDRIN",239,0)
 .....S PSBFLAG("RB")=$S($E(PCKNAM,$L(PCKNAM)-1,$L(PCKNAM))["RB":1,1:$G(PSBFLAG("RB")))
"RTN","PSJPDRIN",240,0)
 ....S ^TMP("PSJPDRIN",$J,LNCNT)=PSJDTRUN_"^"_PSJDFORM_"^"_$S(PSJINP("PSJDELM")="R":$J(FMTQTY,4),1:FMTQTY)_"^"_PSJCABNM_"^"_PCKNAM,LNCNT=LNCNT+1
"RTN","PSJPDRIN",241,0)
 ...I CC=1 N QTY,PSCABIEN,PSDRGIEN S PSCABIEN=$O(^PS(58.601,PSJPSYS,"DEVICE","B",PSJCAB,"")) D
"RTN","PSJPDRIN",242,0)
 ....S QTY="-" I PSCABIEN S PSDRGIEN=$O(^PS(58.601,PSJPSYS,"DEVICE",PSCABIEN,"DRUG","B",PSJDRG,""))
"RTN","PSJPDRIN",243,0)
 ....N PSJDTRUN  ;  Handle max length drug names
"RTN","PSJPDRIN",244,0)
 ....S PSJDTRUN=$P($G(^PSDRUG(PSJDRG,0)),"^")
"RTN","PSJPDRIN",245,0)
 ....I $L(PSJDTRUN)>33 S PSJDTRUN=$E(PSJDTRUN,1,33) S:$E(PSJDTRUN,$L(PSJDTRUN))=" " PSJDTRUN=$E(PSJDTRUN,1,$L(PSJDTRUN)-1)
"RTN","PSJPDRIN",246,0)
 ....S PSJDTRUN=PSJDTRUN_" ("_PSJDRG_")"
"RTN","PSJPDRIN",247,0)
 ....S ^TMP("PSJPDRIN",$J,LNCNT)=PSJDTRUN_"^"_PSJDFORM_"^"_$S(PSJINP("PSJDELM")="R":$J(QTY,4),1:QTY)_"^"_PSJCABNM_"^UNK",LNCNT=LNCNT+1
"RTN","PSJPDRIN",248,0)
 .I PSJINP("PSJDELM")="R" D
"RTN","PSJPDRIN",249,0)
 ..S ^TMP("PSJPDRIN",$J,LNCNT)=$E(TABMAR,1,34)_"^^----",LNCNT=LNCNT+1
"RTN","PSJPDRIN",250,0)
 ..S ^TMP("PSJPDRIN",$J,LNCNT)=$E(TABMAR,1,34)_"^SUB TOTAL:^"_$J(DRCNTOT,4),LNCNT=$G(LNCNT)+1
"RTN","PSJPDRIN",251,0)
 ..S ^TMP("PSJPDRIN",$J,LNCNT)=$E(TABMAR,1,24)_" REPORTED CABINET"_"^ TOTAL:^"_$J(DRGTOT,4),LNCNT=$G(LNCNT)+1
"RTN","PSJPDRIN",252,0)
 ..I $G(PSBFLAG("PSB")) S ^TMP("PSJPDRIN",$J,LNCNT)="* Patient Specific Bin counts not included in Reported Cabinet Total.",LNCNT=$G(LNCNT)+1
"RTN","PSJPDRIN",253,0)
 ..I $G(PSBFLAG("RB")) S ^TMP("PSJPDRIN",$J,LNCNT)="* Return Bin counts not included in Reported Cabinet Total.",LNCNT=$G(LNCNT)+1
"RTN","PSJPDRIN",254,0)
 Q
"RTN","PSJPDRIN",255,0)
 ;
"RTN","PSJPDRIN",256,0)
QTY(SYS,PSJCAB,PSJDRG) ; Return quantity of drug PSJDRG in cabinet PSJCAB
"RTN","PSJPDRIN",257,0)
 N QTY,PSYSIEN,PDEVIEN,PDRGIEN
"RTN","PSJPDRIN",258,0)
 S PSYSIEN=$O(^PS(58.601,"DEV",PSJCAB,PSJDRG,""))
"RTN","PSJPDRIN",259,0)
 S PDEVIEN=$O(^PS(58.601,"DEV",PSJCAB,PSJDRG,PSYSIEN,""))
"RTN","PSJPDRIN",260,0)
 S PDRGIEN=$O(^PS(58.601,"DEV",PSJCAB,PSJDRG,PSYSIEN,PDEVIEN,""))
"RTN","PSJPDRIN",261,0)
 S QTY=+$P($G(^PS(58.601,PSYSIEN,"DEVICE",PDEVIEN,"DRUG",PDRGIEN,0)),"^",3)
"RTN","PSJPDRIN",262,0)
 Q QTY
"RTN","PSJPDRIN",263,0)
 ;
"RTN","PSJPDRIN",264,0)
DFORM(SYS,PSJCAB,PSJDRG) ; Return Dose Form of drug PSJDRG in cabinet PSJCAB
"RTN","PSJPDRIN",265,0)
 N FORM,PSYSIEN,PDEVIEN,PDRGIEN
"RTN","PSJPDRIN",266,0)
 S PSYSIEN=$O(^PS(58.601,"DEV",PSJCAB,PSJDRG,""))
"RTN","PSJPDRIN",267,0)
 S PDEVIEN=$O(^PS(58.601,"DEV",PSJCAB,PSJDRG,PSYSIEN,""))
"RTN","PSJPDRIN",268,0)
 S PDRGIEN=$O(^PS(58.601,"DEV",PSJCAB,PSJDRG,PSYSIEN,PDEVIEN,""))
"RTN","PSJPDRIN",269,0)
 S FORM=$P($G(^PS(58.601,PSYSIEN,"DEVICE",PDEVIEN,"DRUG",PDRGIEN,0)),"^",5)
"RTN","PSJPDRIN",270,0)
 Q FORM
"RTN","PSJPDRIN",271,0)
 ;
"RTN","PSJPDRIN",272,0)
DRCAB(PSJINP,PSJDRCAB) ; Return list of drugs in each cabinet in PSJINP("PADEV")
"RTN","PSJPDRIN",273,0)
 ;   Input = PSJINP("PADEV",CABINET IEN) - Cabinet IEN points to PADE DISPENSING DEVICE file 58.63
"RTN","PSJPDRIN",274,0)
 ;  Output = PSJDRCAB(DRUG IEN)          - Drug IEN points to DRUG file 50
"RTN","PSJPDRIN",275,0)
 K PSJDRCAB
"RTN","PSJPDRIN",276,0)
 N CAB,CABDA,PSJPSYS,DRGDA,DRG
"RTN","PSJPDRIN",277,0)
 S PSJPSYS=$G(PSJINP("PSJPSYS"))
"RTN","PSJPDRIN",278,0)
 M CAB=PSJINP("PADEV")
"RTN","PSJPDRIN",279,0)
 S CAB=0 F  S CAB=$O(CAB(CAB)) Q:'CAB  S CABDA=$O(^PS(58.601,PSJPSYS,"DEVICE","B",CAB,0)) I CABDA D
"RTN","PSJPDRIN",280,0)
 .S DRGDA=0 F  S DRGDA=$O(^PS(58.601,PSJPSYS,"DEVICE",CABDA,"DRUG",DRGDA)) Q:'DRGDA  S DRG=+$G(^(DRGDA,0)) I DRG D
"RTN","PSJPDRIN",281,0)
 ..Q:$D(PSJDRCAB(DRG))
"RTN","PSJPDRIN",282,0)
 ..I '($G(PSJINP("PSJCSUB"))="ALL") Q:'$D(PSJINP("PSJCSUB",$$GETCLASS(DRG)))
"RTN","PSJPDRIN",283,0)
 ..S PSJDRCAB(DRG)=$P($G(^PSDRUG(+$G(DRG),0)),"^")
"RTN","PSJPDRIN",284,0)
 Q
"RTN","PSJPDRIN",285,0)
 ;
"RTN","PSJPDRIN",286,0)
LISTALL(DRGLIST) ; Write list of drugs in DRGLIST("IEN",DRUG IEN)
"RTN","PSJPDRIN",287,0)
 N II,DRGNAME,DRGIEN,TAB
"RTN","PSJPDRIN",288,0)
 S $P(TAB," ",80)=""
"RTN","PSJPDRIN",289,0)
 S DRGIEN=0 F  S DRGIEN=$O(DRGLIST("IEN",DRGIEN)) Q:'DRGIEN  D
"RTN","PSJPDRIN",290,0)
 .W !,$E(TAB,1,8-$L(DRGIEN))_DRGIEN_"  "_DRGLIST("IEN",DRGIEN)
"RTN","PSJPDRIN",291,0)
 Q
"RTN","PSJPDRIN",292,0)
 ;
"RTN","PSJPDRIN",293,0)
DRUGLIST(PSJINP,DRGLIST) ; Return DRGLIST array with "IEN" and "NAME" cross referenced
"RTN","PSJPDRIN",294,0)
 N I,DRG,DLST
"RTN","PSJPDRIN",295,0)
 S DRG=0 F I=1:1 S DRG=$O(DRGLIST(DRG)) Q:'DRG  D
"RTN","PSJPDRIN",296,0)
 .N DRGNAME S DRGNAME=$G(DRGLIST(DRG))
"RTN","PSJPDRIN",297,0)
 .S DRGLIST("IEN",DRG)=DRGNAME
"RTN","PSJPDRIN",298,0)
 .S DRGLIST("NAME",DRGNAME)=DRG
"RTN","PSJPDRIN",299,0)
 Q
"RTN","PSJPDRIN",300,0)
 ;
"RTN","PSJPDRIN",301,0)
SELDEV(RTN,PSJINP,PSJWIDE,ZTSK) ; Select Device
"RTN","PSJPDRIN",302,0)
 ;
"RTN","PSJPDRIN",303,0)
 N PSJDONE
"RTN","PSJPDRIN",304,0)
 ;
"RTN","PSJPDRIN",305,0)
 I $G(PSJINP("PSJDELM"))="D" D
"RTN","PSJPDRIN",306,0)
 .N DIR,X,Y
"RTN","PSJPDRIN",307,0)
 .S DIR("A",1)=""
"RTN","PSJPDRIN",308,0)
 .S DIR("A",2)="     ************************************************************"
"RTN","PSJPDRIN",309,0)
 .S DIR("A",3)="     **  You selected a Delimited report. Please verify you    **"
"RTN","PSJPDRIN",310,0)
 .S DIR("A",4)="     **  you have turned logging on to capture the output.     **"
"RTN","PSJPDRIN",311,0)
 .S DIR("A",5)="     **                                                        **"
"RTN","PSJPDRIN",312,0)
 .S DIR("A",6)="     **  To avoid undesired wrapping, please enter '0;512;999' **"
"RTN","PSJPDRIN",313,0)
 .S DIR("A",7)="     **  at the 'DEVICE:' prompt. You may need to set your     **"
"RTN","PSJPDRIN",314,0)
 .S DIR("A",8)="     **  Terminal Session display settings to 512 columns.     **"
"RTN","PSJPDRIN",315,0)
 .S DIR("A",9)="     ************************************************************"
"RTN","PSJPDRIN",316,0)
 .S DIR("A",10)=""
"RTN","PSJPDRIN",317,0)
 .S DIR("A",11)="",DIR("A",12)=""
"RTN","PSJPDRIN",318,0)
 .S DIR("A")=" Press return to continue"
"RTN","PSJPDRIN",319,0)
 .S DIR(0)="EA" D ^DIR W !
"RTN","PSJPDRIN",320,0)
 ;
"RTN","PSJPDRIN",321,0)
 W !,"This report is designed for a "_$S($G(PSJWIDE):132,1:80)_" column format."
"RTN","PSJPDRIN",322,0)
 W !,"You may queue this report to print at a later time.",!
"RTN","PSJPDRIN",323,0)
 F  Q:$G(PSJSTOP)!$G(PSJDONE)  D
"RTN","PSJPDRIN",324,0)
 .K %ZIS,IOP,POP,ZTSK N I S PSJION=$I,%ZIS="QM"
"RTN","PSJPDRIN",325,0)
 .D ^%ZIS K %ZIS
"RTN","PSJPDRIN",326,0)
 .I POP S IOP=PSJION D ^%ZIS K IOP,PSJION D  Q
"RTN","PSJPDRIN",327,0)
 ..N DIR,X,Y
"RTN","PSJPDRIN",328,0)
 ..S DIR(0)="YA",DIR("A",1)="  ** No Device Selected **",DIR("A")="Select a different device? (Y/N) " D ^DIR
"RTN","PSJPDRIN",329,0)
 ..S:'Y PSJSTOP=1
"RTN","PSJPDRIN",330,0)
 .S PSJDONE=1
"RTN","PSJPDRIN",331,0)
 ;
"RTN","PSJPDRIN",332,0)
 K PSJION I $D(IO("Q")) D  Q "Q"
"RTN","PSJPDRIN",333,0)
 .S ZTDESC="PADE Inventory Report",ZTRTN=$S($G(RTN)]"":$G(RTN),1:"START^PSJPDRIN")
"RTN","PSJPDRIN",334,0)
 .F I="PSJINP(","IO" S ZTSAVE(I)=""
"RTN","PSJPDRIN",335,0)
 .K IO("Q") D ^%ZTLOAD W:$D(ZTSK) !,"Report is Queued to print!"
"RTN","PSJPDRIN",336,0)
 Q ""
"RTN","PSJPDRIN",337,0)
 ;
"RTN","PSJPDRIN",338,0)
CONT(PGCNT,PSJQUIT,TMPLN) ; Press return to continue
"RTN","PSJPDRIN",339,0)
 N DIR
"RTN","PSJPDRIN",340,0)
 I ($E($G(IOST))="C") W ! D
"RTN","PSJPDRIN",341,0)
 .S:'$D(DIR("A")) DIR("A")="Press Return to continue or '^' to exit"
"RTN","PSJPDRIN",342,0)
 .S DIR(0)="FO"
"RTN","PSJPDRIN",343,0)
 .D ^DIR K DIR
"RTN","PSJPDRIN",344,0)
 .I $G(DTOUT)!$G(DUOUT) S PSJSTOP=1
"RTN","PSJPDRIN",345,0)
 Q
"RTN","PSJPDRIN",346,0)
 ;
"RTN","PSJPDRIN",347,0)
ALPHADRG(SYS,CAB,DRG,DRGX)  ; Alphabetize drug names DRGNAME in DRG(IEN)=DRGNAME, return in DRG(DRGNAME,IEN)=""
"RTN","PSJPDRIN",348,0)
 N DRGIEN,DRGNAME
"RTN","PSJPDRIN",349,0)
 S DRGIEN=0 F  S DRGIEN=$O(DRG(DRGIEN)) Q:'DRGIEN  S DRGNAME=$G(DRG(DRGIEN)) I DRGNAME]"" D
"RTN","PSJPDRIN",350,0)
 .Q:'$D(^PS(58.601,"DEV",CAB,DRGIEN))
"RTN","PSJPDRIN",351,0)
 .S DRGX(DRGNAME,DRGIEN)=""
"RTN","PSJPDRIN",352,0)
 Q
"RTN","PSJPDRIN",353,0)
 ;
"RTN","PSJPDRIN",354,0)
POCKET(PSJINP,PSDRG,OUTPOCK) ; Get pocket(s)
"RTN","PSJPDRIN",355,0)
 ;
"RTN","PSJPDRIN",356,0)
 N DRAWER,POCKET,DRGPCK,PSJPSYS,PADIEN,PADEV,DRGDEV,DRWIEN,DRGDRW,SUB,SUBID
"RTN","PSJPDRIN",357,0)
 S PSJPSYS=$G(PSJINP("PSJPSYS")),PADEV=$G(PSJINP("PADEV"))
"RTN","PSJPDRIN",358,0)
 S PADIEN=$O(^PS(58.601,+PSJPSYS,"DEVICE","B",+PADEV,""))
"RTN","PSJPDRIN",359,0)
 Q:'$G(PSDRG)!'$G(PSJPSYS)!'$G(PADIEN)
"RTN","PSJPDRIN",360,0)
 ;
"RTN","PSJPDRIN",361,0)
 S OUTPOCK=PSDRG
"RTN","PSJPDRIN",362,0)
 S DRWIEN=0 F  S DRWIEN=$O(^PS(58.601,+PSJPSYS,"DEVICE",+PADIEN,"DRAWER",DRWIEN)) Q:'DRWIEN  D
"RTN","PSJPDRIN",363,0)
 .S SUB=0 F  S SUB=$O(^PS(58.601,PSJPSYS,"DEVICE",PADIEN,"DRAWER",DRWIEN,"SUB",SUB)) Q:'SUB  D
"RTN","PSJPDRIN",364,0)
 ..S DRGPCK=$P(^PS(58.601,PSJPSYS,"DEVICE",PADIEN,"DRAWER",DRWIEN,"SUB",SUB,0),"^",5),POCKET=$P(^(0),"^",3),SUBID=$P($G(^(0)),"^",4)
"RTN","PSJPDRIN",365,0)
 ..Q:'(DRGPCK=$G(PSDRG))
"RTN","PSJPDRIN",366,0)
 ..S DRAWER=$G(^PS(58.601,+PSJPSYS,"DEVICE",+PADIEN,"DRAWER",DRWIEN,0))
"RTN","PSJPDRIN",367,0)
 ..S:DRAWER="" DRAWER="~~"
"RTN","PSJPDRIN",368,0)
 ..S POCKET=DRAWER_"_"_POCKET
"RTN","PSJPDRIN",369,0)
 ..S DRGDRW=$O(^PS(58.601,PSJPSYS,"DEVICE",PADIEN,"DRAWER",DRWIEN,"DRUG","B",PSDRG,""))
"RTN","PSJPDRIN",370,0)
 ..S OUTPOCK(DRGPCK,DRWIEN,SUB)=POCKET_"^"_DRGDRW_"^"_DRAWER_$S($L(SUBID):"^"_SUBID,1:"")
"RTN","PSJPDRIN",371,0)
 S DRGDEV=$O(^PS(58.601,PSJPSYS,"DEVICE",PADIEN,"DRUG","B",PSDRG,""))
"RTN","PSJPDRIN",372,0)
 S OUTPOCK(PSDRG,"DRGDEV")=DRGDEV
"RTN","PSJPDRIN",373,0)
 Q
"RTN","PSJPDRIP")
0^23^B92189032^n/a
"RTN","PSJPDRIP",1,0)
PSJPDRIP ;BIR/MV-MAIN DRIVER PADE INVENTORY REPORT  ;18 JUN 96 / 2:58 PM
"RTN","PSJPDRIP",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**317**;16 DEC 97;Build 130
"RTN","PSJPDRIP",3,0)
 ;
"RTN","PSJPDRIP",4,0)
 ; Reference to ^%ZISC is supported by DBIA 10089.
"RTN","PSJPDRIP",5,0)
 ; Reference to ^XLFDT is supported by DBIA 10103.
"RTN","PSJPDRIP",6,0)
 ; Reference to ^DG(40.8 is supported by DBIA 728.
"RTN","PSJPDRIP",7,0)
 ; Reference to ^PSDRUG is supported by DBIA 2192.
"RTN","PSJPDRIP",8,0)
 ; Reference to ^VA(200 is supported by DBIA 10060.
"RTN","PSJPDRIP",9,0)
 Q
"RTN","PSJPDRIP",10,0)
 ;
"RTN","PSJPDRIP",11,0)
EN(PSJINP) ; Write PADE Inventory Report
"RTN","PSJPDRIP",12,0)
 ; Required : ^TMP("PSJPDRIN",$J global array containing report data in delimited format.
"RTN","PSJPDRIP",13,0)
 ;            PSJINP array
"RTN","PSJPDRIP",14,0)
 ;            PSJINP("PADEV")         = PADE device(s) (pointer to PADE DISPENSING DEVICE #58.63) selected by user
"RTN","PSJPDRIP",15,0)
 ;            PSJINP("PSDRG")         = Drug(s) (pointer to DRUG #50) selected by user
"RTN","PSJPDRIP",16,0)
 ;            PSJINP("PSJCSUB")       = CS Federal Schedule(s) selected by user
"RTN","PSJPDRIP",17,0)
 ;            PSJINP("PSJDEV",CABIEN) = Pointer to PADE DISPENSING DEVICE (#58.63) file
"RTN","PSJPDRIP",18,0)
 ;            PSJINP("PSJDELM")       = (D)elimited or formatted (R)eport, selected by user
"RTN","PSJPDRIP",19,0)
 ;            PSJINP("PSJDIV")        = Division (pointer to MEDICAL CENTER DIVISION #40.8) selected by user
"RTN","PSJPDRIP",20,0)
 ;            PSJINP("PSJPSYS"        = PADE INVENTORY SYSTEM (#58.601) selected by user
"RTN","PSJPDRIP",21,0)
 ;            PSJINP("PSJSUM"         = (S)ummary or (D)etail report, selected by user
"RTN","PSJPDRIP",22,0)
 ;
"RTN","PSJPDRIP",23,0)
 N PSJDELIM,PSJQUIT,PSJIOSL,PSPGTOT,LNCNT,PSJPTOT,DTOUT,DUOUT,DA,DIC,X,Y,DIR,DR
"RTN","PSJPDRIP",24,0)
 S PSJIOSL=$S($G(IOSL):IOSL-5,1:20)
"RTN","PSJPDRIP",25,0)
 S PSJDELIM=$G(PSJINP("PSJDELM"))
"RTN","PSJPDRIP",26,0)
 U IO
"RTN","PSJPDRIP",27,0)
 I PSJDELIM="D" D DELIM(.PSJINP)
"RTN","PSJPDRIP",28,0)
 I PSJDELIM="R" D FORMAT(.PSJINP)
"RTN","PSJPDRIP",29,0)
 Q
"RTN","PSJPDRIP",30,0)
 ;
"RTN","PSJPDRIP",31,0)
DELIM(PSJINP) ; Output delimited report
"RTN","PSJPDRIP",32,0)
 N PSJPGTOT,PSJPCNT
"RTN","PSJPDRIP",33,0)
 S PSJPTOT=1,PSJPCNT=1
"RTN","PSJPDRIP",34,0)
 D RHEAD^PSJPDRIP(.PSJINP,PSJPTOT,PSJPCNT)
"RTN","PSJPDRIP",35,0)
 S LNCNT=0 F  S LNCNT=$O(^TMP("PSJPDRIN",$J,LNCNT)) Q:'LNCNT!$G(PSJQUIT)  D
"RTN","PSJPDRIP",36,0)
 .W !,^TMP("PSJPDRIN",$J,LNCNT)
"RTN","PSJPDRIP",37,0)
 D ^%ZISC
"RTN","PSJPDRIP",38,0)
 D EXIT
"RTN","PSJPDRIP",39,0)
 Q
"RTN","PSJPDRIP",40,0)
 ;
"RTN","PSJPDRIP",41,0)
FORMAT(PSJINP) ; Output formatted report
"RTN","PSJPDRIP",42,0)
 N CABNAME,PSJPGTOT,PSJPCNT
"RTN","PSJPDRIP",43,0)
 S PSJPCNT=1,PSJPGTOT=$$PGTOT()
"RTN","PSJPDRIP",44,0)
 D RHEAD^PSJPDRIP(.PSJINP,PSJPCNT,PSJPGTOT)
"RTN","PSJPDRIP",45,0)
 S LNCNT=0 F  S LNCNT=$O(^TMP("PSJPDRIN",$J,LNCNT)) Q:'LNCNT!$G(PSJQUIT)  D
"RTN","PSJPDRIP",46,0)
 .N LINE,PSCOL
"RTN","PSJPDRIP",47,0)
 .S LINE=$G(^TMP("PSJPDRIN",$J,LNCNT))
"RTN","PSJPDRIP",48,0)
 .D SETCOLS(.PSJINP,.PSCOL)
"RTN","PSJPDRIP",49,0)
 .I $G(PSJINP("PSJSUM"))="S" I $L($P(LINE,"^"))>1 S CABNAME=$P(LINE,"^")
"RTN","PSJPDRIP",50,0)
 .W !?PSCOL(1),$P(LINE,"^"),?PSCOL(2),$P(LINE,"^",2),?PSCOL(3),$P(LINE,"^",3),?PSCOL(4),$P(LINE,"^",4),?PSCOL(5),$P(LINE,"^",5),?PSCOL(6),$P(LINE,"^",6)
"RTN","PSJPDRIP",51,0)
 .N CABCONT
"RTN","PSJPDRIP",52,0)
 .Q:($Y<(PSJIOSL))
"RTN","PSJPDRIP",53,0)
 .I ($G(PSJINP("PSJSUM"))="S") I $G(CABNAME)]"" I ($P(LINE,"^")]"")!($P(LINE,"^",2)]"") D
"RTN","PSJPDRIP",54,0)
 ..N NXT S NXT=+$O(^TMP("PSJPDRIN",$J,LNCNT))
"RTN","PSJPDRIP",55,0)
 ..S NXT=$P($G(^TMP("PSJPDRIN",$J,NXT)),"^") S:NXT="" CABCONT=CABNAME_"(cont) "
"RTN","PSJPDRIP",56,0)
 .D CONT(.PSJPCNT,.PSJQUIT,LNCNT)
"RTN","PSJPDRIP",57,0)
 .Q:$G(PSJQUIT)
"RTN","PSJPDRIP",58,0)
 .D RHEAD(.PSJINP,PSJPCNT,PSJPGTOT,$G(CABCONT))
"RTN","PSJPDRIP",59,0)
 I '$G(PSJQUIT) D CONT(.PSJPCNT,.PSJQUIT,$O(^TMP("PSJPDRIN",$J,9999999),-1)+1)
"RTN","PSJPDRIP",60,0)
 D ^%ZISC
"RTN","PSJPDRIP",61,0)
 D EXIT
"RTN","PSJPDRIP",62,0)
 Q
"RTN","PSJPDRIP",63,0)
 ;
"RTN","PSJPDRIP",64,0)
RHEAD(PSJINP,PSJPCNT,PSJPGTOT,CABCONT) ; Report Header
"RTN","PSJPDRIP",65,0)
 N PSPGCNT,PSJDIV,CSCHED,PSJTMP,PADECAB,PADEDRG,PSJII,PSJCABS,PSJSUM
"RTN","PSJPDRIP",66,0)
 S PSJPGTOT=$S($G(PSJPGTOT):+$G(PSJPGTOT),1:1)
"RTN","PSJPDRIP",67,0)
 S PSJDIV=$G(PSJINP("PSJDIV"))
"RTN","PSJPDRIP",68,0)
 S PSPGTOT=$G(PSJINP("PSPGTOT")),PSPGCNT=1
"RTN","PSJPDRIP",69,0)
 S PSJSUM=$G(PSJINP("PSJSUM"))
"RTN","PSJPDRIP",70,0)
 W @IOF
"RTN","PSJPDRIP",71,0)
 W !,"Run Date: "_$P($TR($$FMTE^XLFDT($$NOW^XLFDT,2),"@"," "),":",1,2)
"RTN","PSJPDRIP",72,0)
 W ?27,"PADE On Hand Amounts Report ",$S(($G(PSJSUM)="S"):"(Summary)",1:"(Detail)")
"RTN","PSJPDRIP",73,0)
 W ?66,"Page ",PSJPCNT," of ",PSJPGTOT
"RTN","PSJPDRIP",74,0)
 W !,"Run By: ",$P($G(^VA(200,+$G(DUZ),0)),"^")
"RTN","PSJPDRIP",75,0)
 W ?35,"Division: ",$E($$DIVSTR^PSJPDRTR(.PSJINP),1,44)
"RTN","PSJPDRIP",76,0)
 S CSCHED=$$CSCHED(.PSJINP)
"RTN","PSJPDRIP",77,0)
 W !,"CS/Non-CS: ",$S($G(PSJINP("PSJCSUB"))="N":"N",1:$G(CSCHED))
"RTN","PSJPDRIP",78,0)
 S PSJCABS=$$CABSTR(.PSJINP)
"RTN","PSJPDRIP",79,0)
 W !,"PADE"_$S(PSJCABS[",":"s: ",1:": "),PSJCABS
"RTN","PSJPDRIP",80,0)
 S PADEDRG=$$DRGSTR(.PSJINP)
"RTN","PSJPDRIP",81,0)
 W !,"ITEM"_$S(PADEDRG[",":"(s): ",1:": "),PADEDRG
"RTN","PSJPDRIP",82,0)
 D:($G(PSJINP("PSJSUM"))="S") SUMHEAD(.PSJINP,$G(CABCONT))
"RTN","PSJPDRIP",83,0)
 D:($G(PSJINP("PSJSUM"))="D") DETHEAD(.PSJINP)
"RTN","PSJPDRIP",84,0)
 Q
"RTN","PSJPDRIP",85,0)
 ;
"RTN","PSJPDRIP",86,0)
SUMHEAD(PSJINP,CABCONT) ; Summary specific header
"RTN","PSJPDRIP",87,0)
 N DASHES,BLANK,PSJCOL
"RTN","PSJPDRIP",88,0)
 I $G(PSJINP("PSJDELM"))="D" D  Q
"RTN","PSJPDRIP",89,0)
 .W !,"PADE^ITEM^UNIT^QTY"
"RTN","PSJPDRIP",90,0)
 D SETCOLS(.PSJINP,.PSJCOL)
"RTN","PSJPDRIP",91,0)
 S $P(DASHES,"-",80)="-"
"RTN","PSJPDRIP",92,0)
 S $P(BLANK," ",80)=""
"RTN","PSJPDRIP",93,0)
 W !,DASHES
"RTN","PSJPDRIP",94,0)
 W !?2,"ITEM",?PSJCOL(3)-1,"UNIT",?PSJCOL(4)+1,"QTY"
"RTN","PSJPDRIP",95,0)
 W !,DASHES
"RTN","PSJPDRIP",96,0)
 W !,$S($G(CABCONT)]"":CABCONT,1:BLANK)
"RTN","PSJPDRIP",97,0)
 Q
"RTN","PSJPDRIP",98,0)
 ;
"RTN","PSJPDRIP",99,0)
DETHEAD(PSJINP) ; Detail specific header
"RTN","PSJPDRIP",100,0)
 N DASHES,PSJCOL
"RTN","PSJPDRIP",101,0)
 I $G(PSJINP("PSJDELM"))="D" D  Q
"RTN","PSJPDRIP",102,0)
 .W !,"ITEM^UNIT^QTY^PADE^ITEM LOCATION"
"RTN","PSJPDRIP",103,0)
 D SETCOLS(.PSJINP,.PSJCOL)
"RTN","PSJPDRIP",104,0)
 S $P(DASHES,"-",80)="-"
"RTN","PSJPDRIP",105,0)
 W !,DASHES
"RTN","PSJPDRIP",106,0)
 W !,"ITEM",?PSJCOL(2),"UNIT",?PSJCOL(3)," QTY",?PSJCOL(4),"PADE",?PSJCOL(5),"ITEM LOCATION"
"RTN","PSJPDRIP",107,0)
 W !,DASHES
"RTN","PSJPDRIP",108,0)
 Q
"RTN","PSJPDRIP",109,0)
 ;
"RTN","PSJPDRIP",110,0)
EXIT ; Clean up.
"RTN","PSJPDRIP",111,0)
 K ^TMP("PSJPDRIN",$J)
"RTN","PSJPDRIP",112,0)
 Q
"RTN","PSJPDRIP",113,0)
 ;
"RTN","PSJPDRIP",114,0)
POCKDRG(PSJPSYS,PSJCAB,DRUG,DRWPCK) ; Get Drawer.Pocket location of DRUG in PSJCAB cabinet
"RTN","PSJPDRIP",115,0)
 ;
"RTN","PSJPDRIP",116,0)
 N CABIEN,DRGIEN,DRWIEN,DRWNAM,PCKIEN,PCKNAM,ND,LOCNAM,PSJII
"RTN","PSJPDRIP",117,0)
 Q:'$G(PSJPSYS)!'$G(PSJCAB)!'$G(PSJCAB)
"RTN","PSJPDRIP",118,0)
 S CABIEN=$$FIND1^DIC(58.6011,","_PSJPSYS_",","MXQ",+$G(PSJCAB),,,"ERR")
"RTN","PSJPDRIP",119,0)
 S DRWIEN=0 F  S DRWIEN=$O(^PS(58.601,PSJPSYS,"DEVICE",CABIEN,"DRAWER",DRWIEN)) Q:'DRWIEN  S DRWNAM=$P(^(DRWIEN,0),"^") D
"RTN","PSJPDRIP",120,0)
 .S PCKIEN=0 F  S PCKIEN=$O(^PS(58.601,PSJPSYS,"DEVICE",CABIEN,"DRAWER",DRWIEN,"SUB",PCKIEN)) Q:'PCKIEN  S ND=^(PCKIEN,0) I $P(ND,"^",5)=DRUG D
"RTN","PSJPDRIP",121,0)
 ..N LOCNAM,SUBID
"RTN","PSJPDRIP",122,0)
 ..S SUBID=$P(ND,"^",4) S:SUBID["~~" SUBID=$P(SUBID,"~~") S:SUBID="" SUBID="N/A"
"RTN","PSJPDRIP",123,0)
 ..S PCKNAM=DRWNAM_"_"_SUBID_"_"_$P(ND,"^",3)
"RTN","PSJPDRIP",124,0)
 ..F PSJII=1:1:$L(PCKNAM,"_") D
"RTN","PSJPDRIP",125,0)
 ...N TMPLOC S TMPLOC=$P(PCKNAM,"_",PSJII)
"RTN","PSJPDRIP",126,0)
 ...S TMPLOC=$S(TMPLOC="~~":"N/A",1:TMPLOC)
"RTN","PSJPDRIP",127,0)
 ...S LOCNAM=$G(LOCNAM)_TMPLOC_"_"
"RTN","PSJPDRIP",128,0)
 ..S:$E(LOCNAM,$L(LOCNAM))="_" LOCNAM=$E(LOCNAM,1,$L(LOCNAM)-1)
"RTN","PSJPDRIP",129,0)
 ..S DRWPCK(DRUG,LOCNAM)=$P(ND,"^",2)
"RTN","PSJPDRIP",130,0)
 Q
"RTN","PSJPDRIP",131,0)
 ;
"RTN","PSJPDRIP",132,0)
CONT(PGCNT,PSJQUIT,TMPLN) ; Press return to continue
"RTN","PSJPDRIP",133,0)
 N DIR
"RTN","PSJPDRIP",134,0)
 I ($E($G(IOST))="C") W ! D  Q:$G(PSJQUIT)
"RTN","PSJPDRIP",135,0)
 .I '$O(^TMP("PSJPDRIN",$J,TMPLN)) S DIR("A")="End of Report. Press Return to continue" S PSJQUIT=1
"RTN","PSJPDRIP",136,0)
 .S DIR(0)="E"
"RTN","PSJPDRIP",137,0)
 .D ^DIR K DIR
"RTN","PSJPDRIP",138,0)
 .I $G(DTOUT)!$G(DUOUT) S PSJQUIT=1
"RTN","PSJPDRIP",139,0)
 .W @IOF
"RTN","PSJPDRIP",140,0)
 S PGCNT=$G(PGCNT)+1
"RTN","PSJPDRIP",141,0)
 Q
"RTN","PSJPDRIP",142,0)
 ;
"RTN","PSJPDRIP",143,0)
PGTOT() ; Return calculated number of pages for this report
"RTN","PSJPDRIP",144,0)
 N PGTOT,LN,PSJSL,INT,HDRPAD,HDR,HDRWRAP,SCHWRAP,PADEWRAP,DRGWRAP,PSJAVAIL,HDRTOP
"RTN","PSJPDRIP",145,0)
 S PSJIOSL=$S($G(PSJIOSL):PSJIOSL,1:20)
"RTN","PSJPDRIP",146,0)
 S LN=$O(^TMP("PSJPDRIN",$J,999999999),-1)
"RTN","PSJPDRIP",147,0)
 S SCHWRAP=($L($$CSCHED(.PSJINP))+10)/80
"RTN","PSJPDRIP",148,0)
 S:SCHWRAP#1 SCHWRAP=(SCHWRAP\1)+1
"RTN","PSJPDRIP",149,0)
 S PADEWRAP=($L($$CABSTR(.PSJINP))+6)/80
"RTN","PSJPDRIP",150,0)
 S:PADEWRAP#1 PADEWRAP=(PADEWRAP\1)+1
"RTN","PSJPDRIP",151,0)
 S DRGWRAP=($L($$DRGSTR(.PSJINP))+7)/80
"RTN","PSJPDRIP",152,0)
 S:DRGWRAP#1 DRGWRAP=(DRGWRAP\1)+1
"RTN","PSJPDRIP",153,0)
 S HDRWRAP=SCHWRAP+PADEWRAP+DRGWRAP
"RTN","PSJPDRIP",154,0)
 S HDRTOP=$S($G(PSJINP("PSJSUM"))="D":5,1:6)
"RTN","PSJPDRIP",155,0)
 S HDRPAD=(HDRTOP+HDRWRAP)
"RTN","PSJPDRIP",156,0)
 ; How many lines are availabe for actual report data, after header and footer are taken into account?
"RTN","PSJPDRIP",157,0)
 ; If less than five lines per page for report data, set to 5 (longer page length needed)
"RTN","PSJPDRIP",158,0)
 S PSJAVAIL=PSJIOSL-HDRPAD
"RTN","PSJPDRIP",159,0)
 ; Determine how many pages will be needed to print the total lines in ^TMP("PSJPDRIN", 
"RTN","PSJPDRIP",160,0)
 ; using the available area (PSJAVAIL) on each page
"RTN","PSJPDRIP",161,0)
 S PGTOT=LN\PSJAVAIL
"RTN","PSJPDRIP",162,0)
 ;S PSJLASTP=LN#PSJAVAIL
"RTN","PSJPDRIP",163,0)
 S:LN#PSJAVAIL PGTOT=PGTOT+1
"RTN","PSJPDRIP",164,0)
 ;
"RTN","PSJPDRIP",165,0)
 Q PGTOT
"RTN","PSJPDRIP",166,0)
 ;
"RTN","PSJPDRIP",167,0)
CSCHED(PSJINP) ; Return string of CS Federal Schedules from array PSJINP("PSJCSUB",SCHEDULE)
"RTN","PSJPDRIP",168,0)
 N CSCHED N PSJTMP
"RTN","PSJPDRIP",169,0)
 S CSCHED=$G(PSJINP("PSJCSUB")) I '(CSCHED="N") S CSCHED="CS (" D
"RTN","PSJPDRIP",170,0)
 .I $G(PSJINP("PSJCSUB"))["ALL" S CSCHED=PSJINP("PSJCSUB") Q
"RTN","PSJPDRIP",171,0)
 .S PSJTMP="" F  S PSJTMP=$O(PSJINP("PSJCSUB",PSJTMP)) Q:PSJTMP=""  S CSCHED=CSCHED_PSJTMP_","
"RTN","PSJPDRIP",172,0)
 .I $E(CSCHED,$L(CSCHED))="," S CSCHED=$E(CSCHED,1,$L(CSCHED)-1)_")"
"RTN","PSJPDRIP",173,0)
 Q CSCHED
"RTN","PSJPDRIP",174,0)
 ;
"RTN","PSJPDRIP",175,0)
CABSTR(PSJINP) ; Return string of PADE cabinets from array PSJINP("PADEV",CABINET)
"RTN","PSJPDRIP",176,0)
 N CABSTR N PSJTMP,PSJII,PSJDONE
"RTN","PSJPDRIP",177,0)
 S PSJTMP=0 F PSJII=0:1 S PSJTMP=$O(PSJINP("PADEV",PSJTMP)) Q:'PSJTMP!$G(PSJDONE)  D
"RTN","PSJPDRIP",178,0)
 .I $G(PSJINP("PADEV"))="ALL" S CABSTR="ALL",PSJDONE=1 Q
"RTN","PSJPDRIP",179,0)
 .I $L($G(CABSTR))+$L($P($G(^PS(58.63,+PSJTMP,0)),"^"))>140 S CABSTR=CABSTR_" >> more..." S PSJDONE=1 Q
"RTN","PSJPDRIP",180,0)
 .S CABSTR=$S(PSJII:$G(CABSTR)_",",1:"")_$P($G(^PS(58.63,+PSJTMP,0)),"^")
"RTN","PSJPDRIP",181,0)
 Q CABSTR
"RTN","PSJPDRIP",182,0)
 ;
"RTN","PSJPDRIP",183,0)
DRGSTR(PSJINP) ; Return string of PADE drugs selected by user from PSJINP("PSDRG",DRUG IEN)
"RTN","PSJPDRIP",184,0)
 N PADEDRG,PSJTMP,PSJII,PSJDONE
"RTN","PSJPDRIP",185,0)
 S PADEDRG="",PSJTMP="" F PSJII=0:1 S PSJTMP=$O(PSJINP("PSDRG",PSJTMP)) Q:'PSJTMP!$G(PSJDONE)  D
"RTN","PSJPDRIP",186,0)
 .I $G(PSJINP("PSDRG"))="ALL" S PADEDRG="ALL",PSJDONE=1 Q
"RTN","PSJPDRIP",187,0)
 .S PADEDRG=$S(PSJII:(PADEDRG_","),1:"")_$P($G(^PSDRUG(+PSJTMP,0)),"^")
"RTN","PSJPDRIP",188,0)
 .I $L(PADEDRG)>187 S PADEDRG=PADEDRG_" > more..." S PSJDONE=1 Q
"RTN","PSJPDRIP",189,0)
 S:$E(PADEDRG,$L(PADEDRG)) PADEDRG=$E(PADEDRG,1,$L(PADEDRG)=1)
"RTN","PSJPDRIP",190,0)
 Q PADEDRG
"RTN","PSJPDRIP",191,0)
 ;
"RTN","PSJPDRIP",192,0)
SETCOLS(PSJINP,COL) ; Set column widths
"RTN","PSJPDRIP",193,0)
 I $G(PSJINP("PSJSUM"))="S" D
"RTN","PSJPDRIP",194,0)
 .S COL(1)=0,COL(2)=2,COL(3)=50,COL(4)=60,COL(5)=68,COL(6)=74
"RTN","PSJPDRIP",195,0)
 I $G(PSJINP("PSJSUM"))="D" D
"RTN","PSJPDRIP",196,0)
 .S COL(1)=0,COL(2)=38,COL(3)=48,COL(4)=53,COL(5)=64,COL(6)=75
"RTN","PSJPDRIP",197,0)
 Q
"RTN","PSJPDRIP",198,0)
 ;
"RTN","PSJPDRIP",199,0)
TRANSTR(PSJINP) ; Return string of transaction types selected
"RTN","PSJPDRIP",200,0)
 N TRANS,TMP,II,PATFLG
"RTN","PSJPDRIP",201,0)
 S PATFLG=$$PTTRFLG^PSJPDRU1(.PSJINP)
"RTN","PSJPDRIP",202,0)
 S TRANS=""
"RTN","PSJPDRIP",203,0)
 I $G(PSJINP("PSJTRANS"))="ALL"&(PATFLG=1) Q "ALL"
"RTN","PSJPDRIP",204,0)
 I $G(PSJINP("PSJTRANS"))="ALL"&(PATFLG=2) Q "ALL PATIENT TRANSACTIONS"
"RTN","PSJPDRIP",205,0)
 I $G(PSJINP("PSJTRANS"))="ALL"&'PATFLG Q "ALL NON-PATIENT TRANSACTIONS"
"RTN","PSJPDRIP",206,0)
 S TMP="" F II=0:1 S TMP=$O(PSJINP("PSJTRANS",TMP)) Q:TMP=""  S TRANS=$S(II:TRANS_","_PSJINP("PSJTRANS",TMP),1:PSJINP("PSJTRANS",TMP))
"RTN","PSJPDRIP",207,0)
 Q TRANS
"RTN","PSJPDRIP",208,0)
 ;
"RTN","PSJPDRIP",209,0)
CABST(PSJPSYS,PSJPADE) ; Return PADE Status : (I)=Inactive or null
"RTN","PSJPDRIP",210,0)
 N STATUS,PADIEN
"RTN","PSJPDRIP",211,0)
 Q:'$G(PSJPSYS) ""
"RTN","PSJPDRIP",212,0)
 Q:$G(PSJPADE)="" ""
"RTN","PSJPDRIP",213,0)
 S PADIEN=$$FIND1^DIC(58.63,,,PSJPADE)
"RTN","PSJPDRIP",214,0)
 Q:'PADIEN ""
"RTN","PSJPDRIP",215,0)
 S STATUS=$P($G(^PS(58.63,+PADIEN,0)),"^",4)
"RTN","PSJPDRIP",216,0)
 S STATUS=$S(STATUS="I":"(I)",1:"")
"RTN","PSJPDRIP",217,0)
 Q STATUS
"RTN","PSJPDRIP",218,0)
 ;
"RTN","PSJPDRIP",219,0)
XALL(IN) ; Convert partial ^ALL to ALL
"RTN","PSJPDRIP",220,0)
 N OUT
"RTN","PSJPDRIP",221,0)
 S OUT=IN
"RTN","PSJPDRIP",222,0)
 I ($E(IN)'="^")!(IN="^") Q OUT
"RTN","PSJPDRIP",223,0)
 S OUT=$$ENLU^PSGMI(OUT)
"RTN","PSJPDRIP",224,0)
 I $E(OUT,1,$L(OUT))=$E("^ALL",1,$L(OUT)) D
"RTN","PSJPDRIP",225,0)
 .S OUT="ALL"
"RTN","PSJPDRIP",226,0)
 .K DUOUT,DTOUT
"RTN","PSJPDRIP",227,0)
 Q OUT
"RTN","PSJPDRIP",228,0)
 ;
"RTN","PSJPDRIP",229,0)
CONT2(PGCNT,PSJQUIT,PSJEND) ; Press return to continue
"RTN","PSJPDRIP",230,0)
 N DIR
"RTN","PSJPDRIP",231,0)
 I ($E($G(IOST))="C") W ! D  Q:$G(PSJQUIT)
"RTN","PSJPDRIP",232,0)
 .I $G(PSJEND) S DIR("A")="End of Report. Press Return to continue" S PSJQUIT=1
"RTN","PSJPDRIP",233,0)
 .S:'$D(DIR("A")) DIR("A")="Press Return to continue or '^' to exit"
"RTN","PSJPDRIP",234,0)
 .S DIR(0)="FO"
"RTN","PSJPDRIP",235,0)
 .D ^DIR K DIR
"RTN","PSJPDRIP",236,0)
 .I $G(DTOUT)!$G(DUOUT) S PSJQUIT=1
"RTN","PSJPDRIP",237,0)
 .W @IOF
"RTN","PSJPDRIP",238,0)
 S PGCNT=$G(PGCNT)+1
"RTN","PSJPDRIP",239,0)
 Q
"RTN","PSJPDRIP",240,0)
 ;
"RTN","PSJPDRIP",241,0)
CNVTYP(INTYP,PSJOUT) ; Convert Transaction Types to external format from raw HL7
"RTN","PSJPDRIP",242,0)
 N TTCNT,PSJOUTE K PSJOUT
"RTN","PSJPDRIP",243,0)
 S TTCNT=0 F  S TTCNT=$O(INTYP(TTCNT)) Q:'TTCNT  D
"RTN","PSJPDRIP",244,0)
 .N TTNAME,TTCODE S TTNAME=INTYP(TTCNT)
"RTN","PSJPDRIP",245,0)
 .S TTCODE=$$EXTT^PSJPDRUT(TTNAME)
"RTN","PSJPDRIP",246,0)
 .I TTCODE]"" S PSJOUT(TTCODE)=TTNAME
"RTN","PSJPDRIP",247,0)
 .Q
"RTN","PSJPDRIP",248,0)
 .I $E(INTYP(TTCNT))="D" S PSJOUT("V")="VEND",PSJOUT("I")="ISSUE" Q
"RTN","PSJPDRIP",249,0)
 .I $E(INTYP(TTCNT))="L" S PSJOUT("L")="LOAD" Q
"RTN","PSJPDRIP",250,0)
 .I $E(INTYP(TTCNT))="F" S PSJOUT("F")="FILL" Q
"RTN","PSJPDRIP",251,0)
 .I $E(INTYP(TTCNT))="U" S PSJOUT("U")="UNLOAD" Q
"RTN","PSJPDRIP",252,0)
 .I $E(INTYP(TTCNT))="B" S PSJOUT("B")="EMPTY BIN" Q
"RTN","PSJPDRIP",253,0)
 .I $E(INTYP(TTCNT))="C" S PSJOUT("C")="COUNT" Q
"RTN","PSJPDRIP",254,0)
 .I $E(INTYP(TTCNT))="R" S PSJOUT("R")="RETURN" Q
"RTN","PSJPDRIP",255,0)
 .I $E(INTYP(TTCNT))="W" S PSJOUT("W")="WASTE" Q
"RTN","PSJPDRIP",256,0)
 .I $E(INTYP(TTCNT))="E" S PSJOUT("E")="EXPIRED" Q
"RTN","PSJPDRIP",257,0)
 .I INTYP(TTCNT)="Destock" S PSJOUT("D")="DESTOCK" Q
"RTN","PSJPDRIP",258,0)
 Q
"RTN","PSJPDRIP",259,0)
 ;
"RTN","PSJPDRIP",260,0)
ALLSCHED(PSJCSUB,SCHLST) ; Return all CS Federal Schedules in PSJCSUB(SCHEDULE)
"RTN","PSJPDRIP",261,0)
 N SCHED,SCNT
"RTN","PSJPDRIP",262,0)
 F SCNT=1:1:$L(SCHLST,";") S SCHED=$P(SCHLST,";",SCNT),PSJCSUB($P(SCHED,":"))=$P(SCHED,":",2)
"RTN","PSJPDRIP",263,0)
 Q
"RTN","PSJPDRIP",264,0)
 ;
"RTN","PSJPDRIP",265,0)
DIV(PSJDIV,PSJSTOP) ; Get Division
"RTN","PSJPDRIP",266,0)
 N DIC,X,Y,PSJDONE,PSDIVLST,PSJDIC
"RTN","PSJPDRIP",267,0)
 S DIC("S")="I $D(^PS(58.63,""D"",+Y))"
"RTN","PSJPDRIP",268,0)
 S PSJSTOP=0
"RTN","PSJPDRIP",269,0)
 D LIST^DIC(40.8,,,"P",,,,,DIC("S"),,"PSDIVLST")
"RTN","PSJPDRIP",270,0)
 S PSJDIC=0 F  S PSJDIC=$O(PSDIVLST("DILIST",PSJDIC)) Q:'PSJDIC  D
"RTN","PSJPDRIP",271,0)
 .S PSDIVLST=+$G(PSDIVLST("DILIST",PSJDIC,0))
"RTN","PSJPDRIP",272,0)
 .S PSDIVLST("PSJDIV",PSDIVLST)=""
"RTN","PSJPDRIP",273,0)
 S PSJDIV="" K PSJDONE,PSJDIV
"RTN","PSJPDRIP",274,0)
 S DIC("S")="I $D(^PS(58.63,""D"",+Y))"
"RTN","PSJPDRIP",275,0)
 D DIV^PSJPDRUT(.PSJDIV,.PSJSTOP)
"RTN","PSJPDRIP",276,0)
 Q
"RTN","PSJPDRTP")
0^25^B164604296^n/a
"RTN","PSJPDRTP",1,0)
PSJPDRTP ;BIR/MV-PRINT PADE TRANSACTION REPORT  ;11/15/2015
"RTN","PSJPDRTP",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**317**;16 DEC 97;Build 130
"RTN","PSJPDRTP",3,0)
 ;
"RTN","PSJPDRTP",4,0)
 ; Reference to ^%ZISC is supported by DBIA 10089.
"RTN","PSJPDRTP",5,0)
 ; Reference to ^VA(200 is supported by DBIA 10060.
"RTN","PSJPDRTP",6,0)
 ; Reference to ^XLFDT is supported by DBIA 10103
"RTN","PSJPDRTP",7,0)
 ; Reference to ^DG(40.8 is supported by DBIA 728.
"RTN","PSJPDRTP",8,0)
 ; Reference to ^PSDRUG is supported by DBIA 2192.
"RTN","PSJPDRTP",9,0)
 ; Reference to ^VA(200 is supported by DBIA 10060.
"RTN","PSJPDRTP",10,0)
 ; Reference to ^DPT supported by DBIA 10035
"RTN","PSJPDRTP",11,0)
 Q
"RTN","PSJPDRTP",12,0)
 ;
"RTN","PSJPDRTP",13,0)
EN(PSJINP) ; Write PADE Inventory Report
"RTN","PSJPDRTP",14,0)
 ; Required : PSJINP array
"RTN","PSJPDRTP",15,0)
 ;   Input    PSJINP("PADEV")         = PADE device(s) (pointer to PADE DISPENSING DEVICE #58.63) selected by user
"RTN","PSJPDRTP",16,0)
 ;            PSJINP("PSDRG")         = Drug(s) (pointer to DRUG #50) selected by user
"RTN","PSJPDRTP",17,0)
 ;            PSJINP("PSJCSUB")       = CS Federal Schedule(s) selected by user
"RTN","PSJPDRTP",18,0)
 ;            PSJINP("PSJDEV",CABIEN) = Pointer to PADE DISPENSING DEVICE (#58.63) file
"RTN","PSJPDRTP",19,0)
 ;            PSJINP("PSJDELM")       = (D)elimited or formatted (R)eport, selected by user
"RTN","PSJPDRTP",20,0)
 ;            PSJINP("PSJDIV")        = Division (pointer to MEDICAL CENTER DIVISION #40.8) selected by user
"RTN","PSJPDRTP",21,0)
 ;            PSJINP("PSJPSYS"        = PADE INVENTORY SYSTEM (#58.601) selected by user
"RTN","PSJPDRTP",22,0)
 ;            PSJINP("PSJSUM"         = (S)ummary or (D)etail report, selected by user
"RTN","PSJPDRTP",23,0)
 ;
"RTN","PSJPDRTP",24,0)
 N PSJDELIM,PSJQUIT,PSJLNCNT,PSJIOSL,PSJPTOT,DTOUT,DUOUT
"RTN","PSJPDRTP",25,0)
 S PSJIOSL=$S($G(IOSL):IOSL-3,1:20)
"RTN","PSJPDRTP",26,0)
 S PSJDELIM=$G(PSJINP("PSJDELM"))
"RTN","PSJPDRTP",27,0)
 U IO
"RTN","PSJPDRTP",28,0)
 I PSJDELIM="D" D DELIM(.PSJINP)
"RTN","PSJPDRTP",29,0)
 I PSJDELIM="R" D FORMAT(.PSJINP,PSJIOSL)
"RTN","PSJPDRTP",30,0)
 Q
"RTN","PSJPDRTP",31,0)
 ;
"RTN","PSJPDRTP",32,0)
DELIM(PSJINP) ; Output delimited report
"RTN","PSJPDRTP",33,0)
 N PSJPGTOT,PSJLNCNT,PSJPGCNT
"RTN","PSJPDRTP",34,0)
 S PSJLNCNT=1,PSJPTOT=1,PSJPGCNT=1
"RTN","PSJPDRTP",35,0)
 D SRHEAD(.PSJINP,PSJLNCNT,PSJPTOT,PSJPGCNT)
"RTN","PSJPDRTP",36,0)
 S PSJPGCNT="" F  S PSJPGCNT=$O(^TMP($J,"PSJPDRTR",PSJPGCNT)) Q:PSJPGCNT=""  D
"RTN","PSJPDRTP",37,0)
 .S PSJLNCNT=0 F  S PSJLNCNT=$O(^TMP($J,"PSJPDRTR",PSJPGCNT,PSJLNCNT)) Q:'PSJLNCNT!$G(PSJQUIT)  D
"RTN","PSJPDRTP",38,0)
 ..N PSJLNRAW,PSJLNFMT   ; Get output, remove unused pieces in delimited
"RTN","PSJPDRTP",39,0)
 ..S PSJLNRAW=$G(^TMP($J,"PSJPDRTR",PSJPGCNT,PSJLNCNT))
"RTN","PSJPDRTP",40,0)
 ..S PSJLNFMT=$P(PSJLNRAW,"^",1,16)_"^"_$P(PSJLNRAW,"^",19)
"RTN","PSJPDRTP",41,0)
 ..W !,PSJLNFMT
"RTN","PSJPDRTP",42,0)
 D ^%ZISC
"RTN","PSJPDRTP",43,0)
 D EXIT
"RTN","PSJPDRTP",44,0)
 Q
"RTN","PSJPDRTP",45,0)
 ;
"RTN","PSJPDRTP",46,0)
FORMAT(PSJINP,PSJIOSL) ; Output formatted report
"RTN","PSJPDRTP",47,0)
 N CABNAME,PSJPGTOT,PSJPGCNT,PSJDASH,PSJLNCNT,PSJDLN,PSJCOL
"RTN","PSJPDRTP",48,0)
 S PSJLNCNT=1
"RTN","PSJPDRTP",49,0)
 S $P(PSJDASH,"-",131)=""
"RTN","PSJPDRTP",50,0)
 S PSJPGTOT=$$PGTOT()
"RTN","PSJPDRTP",51,0)
 D SETCOLS(.PSJINP,.PSJCOL)
"RTN","PSJPDRTP",52,0)
 S PSJPGCNT=0 F  S PSJPGCNT=$O(^TMP($J,"PSJPDRTR",PSJPGCNT)) Q:'PSJPGCNT!$G(PSJQUIT)  D
"RTN","PSJPDRTP",53,0)
 .S PSJDLN=0 F  S PSJDLN=$O(^TMP($J,"PSJPDRTR",PSJPGCNT,PSJDLN)) Q:'PSJDLN!$G(PSJQUIT)  D
"RTN","PSJPDRTP",54,0)
 ..N LINE,USER,WITNESS
"RTN","PSJPDRTP",55,0)
 ..S LINE=$G(^TMP($J,"PSJPDRTR",PSJPGCNT,PSJDLN))
"RTN","PSJPDRTP",56,0)
 ..I $E(LINE,1,9)="Run Date:" D CONT2^PSJPDRIP(PSJPGCNT,.PSJQUIT) S LINE=$P(LINE,"^")_PSJPGTOT
"RTN","PSJPDRTP",57,0)
 ..; Remove User ID and Witness ID from Formatted Report
"RTN","PSJPDRTP",58,0)
 ..S USER=$P($P(LINE,"^",8),"(") S $P(LINE,"^",8)=USER
"RTN","PSJPDRTP",59,0)
 ..S WITNESS=$P($P(LINE,"^",9),"(") S $P(LINE,"^",9)=WITNESS
"RTN","PSJPDRTP",60,0)
 ..U IO W !?PSJCOL(1),$P(LINE,"^"),?PSJCOL(2),$P(LINE,"^",2),?PSJCOL(3),$P(LINE,"^",3),?PSJCOL(4),$P(LINE,"^",4),?PSJCOL(5),$P(LINE,"^",5)
"RTN","PSJPDRTP",61,0)
 ..W ?PSJCOL(6),$P(LINE,"^",6),?PSJCOL(7),$P(LINE,"^",7),?PSJCOL(8),$P(LINE,"^",8),?PSJCOL(9),$P(LINE,"^",9) I $G(PSJCOL(10)) W ?PSJCOL(10),$P(LINE,"^",10)
"RTN","PSJPDRTP",62,0)
 D CONT2^PSJPDRIP(PSJPGCNT,.PSJQUIT,1) ; Press return to continue
"RTN","PSJPDRTP",63,0)
 D ^%ZISC
"RTN","PSJPDRTP",64,0)
 D EXIT
"RTN","PSJPDRTP",65,0)
 Q
"RTN","PSJPDRTP",66,0)
 ;
"RTN","PSJPDRTP",67,0)
PROCSUM(PSJINP) ; Gather report data
"RTN","PSJPDRTP",68,0)
 N PSJLNCNT,PSLNOD,PSLNHSTR,PSLNDSTR,PSTMPHDR,II,PSJCOL,PSJI,QTY
"RTN","PSJPDRTP",69,0)
 N PSJUSRID,PSJWITID,PSJDASH,PSJPGCNT,PSJIOSL,PSJPGTOT,TABMAR,PSDRWR
"RTN","PSJPDRTP",70,0)
 S PSJIOSL=$S($G(IOSL):IOSL-2,1:20)
"RTN","PSJPDRTP",71,0)
 D SETCOLS^PSJPDRTP(.PSJINP,.PSJCOL)
"RTN","PSJPDRTP",72,0)
 S $P(TABMAR," ",40)=" "
"RTN","PSJPDRTP",73,0)
 S $P(PSJDASH,"-",131)=""
"RTN","PSJPDRTP",74,0)
 S PSJLNCNT=1,PSJPGCNT=0
"RTN","PSJPDRTP",75,0)
 D SRHEAD(.PSJINP,.PSJLNCNT,.PSJPGCNT,.PSJPGTOT) ; Report Header
"RTN","PSJPDRTP",76,0)
 ; Loop through each record from File 58.6 returned in ^TMP($J,"TSCREEN", reformat and set in output global ^TMP($J,"PSJPDRTR"
"RTN","PSJPDRTP",77,0)
 S PSJI=0 F  S PSJI=$O(^TMP($J,"TSCREEN","DILIST",PSJI)) Q:'PSJI  D
"RTN","PSJPDRTP",78,0)
 .N PSJCOMM,PSJCABST,PSALTDRG,PSDLOC,PSJSUBDR,PSDRGID
"RTN","PSJPDRTP",79,0)
 .S PSLNOD=^TMP($J,"TSCREEN","DILIST",PSJI,0)
"RTN","PSJPDRTP",80,0)
 .; Ignore quantities for WASTE transactions - Display "NA"
"RTN","PSJPDRTP",81,0)
 .I $P(PSLNOD,"^",7)="WASTE" S $P(PSLNOD,"^",9)="NA",$P(PSLNOD,"^",11)="NA",(QTY,$P(PSLNOD,"^",10))="NA"
"RTN","PSJPDRTP",82,0)
 .S PSALTDRG="" I $P(PSLNOD,"^",2)="" S PSALTDRG=$P(PSLNOD,"^",19)
"RTN","PSJPDRTP",83,0)
 .S PSJCABST=$$CABST^PSJPDRIP(PSJINP("PSJPSYS"),$P(PSLNOD,"^",3))
"RTN","PSJPDRTP",84,0)
 .S PSDLOC=$P(PSLNOD,"^",5) I PSDLOC="~~" S PSDLOC=$S($P(PSLNOD,"^",7)="WASTE":"N/A",1:"UNK")
"RTN","PSJPDRTP",85,0)
 .S PSJSUBDR=$TR($P(PSLNOD,"^",22),"~~") S:PSJSUBDR="" PSJSUBDR="N/A"
"RTN","PSJPDRTP",86,0)
 .S PSDRWR=$P(PSLNOD,"^",21) S:$TR(PSDRWR,"~")="" PSDRWR="N/A"
"RTN","PSJPDRTP",87,0)
 .S PSDLOC=PSDRWR_"_"_PSJSUBDR_"_"_PSDLOC
"RTN","PSJPDRTP",88,0)
 .S PSDRGID=+$P($G(^PS(58.6,+PSLNOD,0)),"^",3)
"RTN","PSJPDRTP",89,0)
 .S PSLNHSTR="Item: "_$S(PSALTDRG]"":"*"_PSALTDRG,1:$P(PSLNOD,"^",2))_$S($G(PSDRGID):"("_PSDRGID_")",1:"")_"^^^^^     PADE: "_$P(PSLNOD,"^",3)_PSJCABST_"^^ Item Location: "_$G(PSDLOC)
"RTN","PSJPDRTP",90,0)
 .I PSJLNCNT>($G(PSJIOSL)-1) D PHEAD(.PSJINP,.PSJLNCNT,.PSJPGCNT,.PSJPGTOT,1) D
"RTN","PSJPDRTP",91,0)
 ..; If same drug spans multiple pages, print "Cont" text
"RTN","PSJPDRTP",92,0)
 ..I PSLNHSTR=PSTMPHDR D CONTRAN("(Cont) "_PSLNHSTR,PSJPGCNT,.PSJLNCNT,.PSJINP)
"RTN","PSJPDRTP",93,0)
 .; If we're working on a new drug, print the sub-header (e.g., Transaction Date, Type, Qty, etc.)
"RTN","PSJPDRTP",94,0)
 .I PSLNHSTR'=$G(PSTMPHDR) D
"RTN","PSJPDRTP",95,0)
 ..S PSTMPHDR=PSLNHSTR
"RTN","PSJPDRTP",96,0)
 ..I PSJLNCNT>($G(PSJIOSL)-6) D PHEAD(.PSJINP,.PSJLNCNT,.PSJPGCNT,.PSJPGTOT,1)
"RTN","PSJPDRTP",97,0)
 ..D CONTRAN(PSLNHSTR,PSJPGCNT,.PSJLNCNT,.PSJINP)
"RTN","PSJPDRTP",98,0)
 .; Arrange the data into output format, set into ^TMP($J,"PSJPDRTR"
"RTN","PSJPDRTP",99,0)
 .S PSLNDSTR=$$BLDSTR(.PSJINP,PSLNOD,.PSJCOMM)
"RTN","PSJPDRTP",100,0)
 .I PSJINP("PSJDELM")="D" N PSDLDRG,PSDLCAB,PSDLPAR,PSDLOC D
"RTN","PSJPDRTP",101,0)
 ..S PSDLDRG=$P(PSLNHSTR,"^"),PSDLCAB=$P(PSLNHSTR,"^",6),PSDLPAR=$TR($P($P(PSLNHSTR,"PAR Qty: ",2),"Location:")," ",""),PSDLOC=$P(PSLNHSTR,"Location: ",2)
"RTN","PSJPDRTP",102,0)
 ..S PSDLDRG=$P(PSDLDRG,"Item: ",2),PSDLCAB=$P(PSDLCAB,"PADE: ",2)
"RTN","PSJPDRTP",103,0)
 ..S PSLNDSTR=PSDLDRG_"^"_PSDLCAB_"^"_PSDLOC_"^"_PSLNDSTR
"RTN","PSJPDRTP",104,0)
 .I PSJLNCNT=1 D
"RTN","PSJPDRTP",105,0)
 ..S ^TMP($J,"PSJPDRTR",PSJPGCNT,PSJLNCNT)="Drug^Cabinet^Location^Date^Transaction Type^Override^Begin Balance^Qty^End Balance^Patient^Patient ID^User^User ID^Witness^Witness ID^^^Comment"
"RTN","PSJPDRTP",106,0)
 ..S PSJLNCNT=PSJLNCNT+1
"RTN","PSJPDRTP",107,0)
 .S ^TMP($J,"PSJPDRTR",PSJPGCNT,PSJLNCNT)=PSLNDSTR,PSJLNCNT=PSJLNCNT+1
"RTN","PSJPDRTP",108,0)
 .; If formatted output, print comment on separate line
"RTN","PSJPDRTP",109,0)
 .I ($G(PSJCOMM)'=""),$G(PSJINP("PSJDELM"))="R" S PSJCOMM="     Comment: "_PSJCOMM,^TMP($J,"PSJPDRTR",PSJPGCNT,PSJLNCNT)=PSJCOMM,PSJLNCNT=PSJLNCNT+1
"RTN","PSJPDRTP",110,0)
 Q
"RTN","PSJPDRTP",111,0)
 ;
"RTN","PSJPDRTP",112,0)
BLDSTR(PSJINP,PSLNOD,PSJCOMM) ; Build output data string
"RTN","PSJPDRTP",113,0)
 ; INPUT:  PSJINP() = array of user report input/selections
"RTN","PSJPDRTP",114,0)
 ;         PSLNOD   = header node from PADE INBOUND TRANSACTION file (#58.6), by way of LIST^DIC call output in ^TMP($J,"TSCREEN"
"RTN","PSJPDRTP",115,0)
 ; OUTPUT: PSLNDSTR  = string of report output to be stored in ^TMP($J,"PSJPDRTR"
"RTN","PSJPDRTP",116,0)
 ;
"RTN","PSJPDRTP",117,0)
 S PSLNDSTR=$$BLDSTR^PSJPDRU1(.PSJINP,PSLNOD,.PSJCOMM)
"RTN","PSJPDRTP",118,0)
 Q PSLNDSTR
"RTN","PSJPDRTP",119,0)
 ;
"RTN","PSJPDRTP",120,0)
SRHEAD(PSJINP,PSJLNCNT,PSJPGCNT,PSJPGTOT) ; Report Header
"RTN","PSJPDRTP",121,0)
 Q:$G(PSJINP("PSJDELM"))="D"
"RTN","PSJPDRTP",122,0)
 N PSPGCNT,PSJDIV,CSCHED,PSJTMP,PADECAB,PADEDRG,PSJII,PSJPAT,PSJDASH,USRSTR,TRANSTR,OVRIDE,PSJCABS,PSJSUM,PSJPTSTR
"RTN","PSJPDRTP",123,0)
 S $P(PSJDASH,"-",131)=""
"RTN","PSJPDRTP",124,0)
 S PSJPGTOT=$S($G(PSJPGTOT):+$G(PSJPGTOT),1:1)
"RTN","PSJPDRTP",125,0)
 S PSJDIV=$G(PSJINP("PSJDIV"))
"RTN","PSJPDRTP",126,0)
 S PSJSUM=$G(PSJINP("PSJSUM"))
"RTN","PSJPDRTP",127,0)
 S PSJLNCNT=1,PSJPGCNT=PSJPGCNT+1
"RTN","PSJPDRTP",128,0)
 D PHEAD(.PSJINP,.PSJLNCNT,.PSJPGCNT,.PSJPGTOT)
"RTN","PSJPDRTP",129,0)
 S CSCHED=$$CSCHED(.PSJINP)
"RTN","PSJPDRTP",130,0)
 S ^TMP($J,"PSJPDRTR",PSJPGCNT,PSJLNCNT)="CS/Non-CS: "_$S($G(PSJINP("PSJCSUB"))="ALL":"ALL",$G(PSJINP("PSJCSUB"))="N":"N",1:$G(CSCHED)),PSJLNCNT=PSJLNCNT+1
"RTN","PSJPDRTP",131,0)
 S PSJCABS=$$CABSTR(.PSJINP)
"RTN","PSJPDRTP",132,0)
 S ^TMP($J,"PSJPDRTR",PSJPGCNT,PSJLNCNT)="PADE"_$S(PSJCABS[",":"(s): ",1:": ")_PSJCABS,PSJLNCNT=PSJLNCNT+1
"RTN","PSJPDRTP",133,0)
 S PSJPTSTR=$$PTSTR(.PSJINP)
"RTN","PSJPDRTP",134,0)
 S ^TMP($J,"PSJPDRTR",PSJPGCNT,PSJLNCNT)="Patient: "_PSJPTSTR,PSJLNCNT=PSJLNCNT+1
"RTN","PSJPDRTP",135,0)
 S PADEDRG=$$DRGSTR(.PSJINP)
"RTN","PSJPDRTP",136,0)
 S ^TMP($J,"PSJPDRTR",PSJPGCNT,PSJLNCNT)="Item"_$S(PADEDRG[",":"(s): ",1:": ")_PADEDRG,PSJLNCNT=PSJLNCNT+1
"RTN","PSJPDRTP",137,0)
 S USRSTR=$$USRSTR(.PSJINP)
"RTN","PSJPDRTP",138,0)
 S ^TMP($J,"PSJPDRTR",PSJPGCNT,PSJLNCNT)="User: "_USRSTR,PSJLNCNT=PSJLNCNT+1
"RTN","PSJPDRTP",139,0)
 S TRANSTR=$$TRANSTR^PSJPDRIP(.PSJINP)
"RTN","PSJPDRTP",140,0)
 S ^TMP($J,"PSJPDRTR",PSJPGCNT,PSJLNCNT)="Transaction Type: "_TRANSTR,PSJLNCNT=PSJLNCNT+1
"RTN","PSJPDRTP",141,0)
 S OVRIDE=$S($G(PSJINP("PSJOVR")):"Y",1:"N")
"RTN","PSJPDRTP",142,0)
 S ^TMP($J,"PSJPDRTR",PSJPGCNT,PSJLNCNT)="Override Transactions Only?: "_OVRIDE,PSJLNCNT=PSJLNCNT+1
"RTN","PSJPDRTP",143,0)
 S ^TMP($J,"PSJPDRTR",PSJPGCNT,PSJLNCNT)=PSJDASH,PSJLNCNT=PSJLNCNT+1
"RTN","PSJPDRTP",144,0)
 Q
"RTN","PSJPDRTP",145,0)
 ;
"RTN","PSJPDRTP",146,0)
PHEAD(PSJINP,PSJLNCNT,PSJPGCNT,PSJPGTOT,PSADDPG) ; Page header
"RTN","PSJPDRTP",147,0)
 Q:$G(PSJINP("PSJDELM"))="D"
"RTN","PSJPDRTP",148,0)
 N PSJDIV,PAD,LINE,PDASH,PSDIVOUT,PSDCNT,PSDIVSTR
"RTN","PSJPDRTP",149,0)
 S $P(PDASH,"-",131)=""
"RTN","PSJPDRTP",150,0)
 S $P(PAD," ",80)=""
"RTN","PSJPDRTP",151,0)
 S PSJLNCNT=0
"RTN","PSJPDRTP",152,0)
 ;  Don't increment page count when called from Report Header
"RTN","PSJPDRTP",153,0)
 I $G(PSADDPG) S PSJPGCNT=$G(PSJPGCNT)+1
"RTN","PSJPDRTP",154,0)
 S PSDIVSTR=$G(PSJINP("PSJDIV"))
"RTN","PSJPDRTP",155,0)
 I PSDIVSTR'="ALL" S PSDIVSTR="",PSJDIV=0,PSDCNT=0 F PSDCNT=0:1 S PSJDIV=$O(PSJINP("PSJDIV",PSJDIV)) Q:'PSJDIV  D
"RTN","PSJPDRTP",156,0)
 .S PSDIVOUT=$P($G(^DG(40.8,+PSJDIV,0)),"^")
"RTN","PSJPDRTP",157,0)
 .S PSDIVSTR=$S(PSDCNT:PSDIVSTR_","_PSDIVOUT,1:PSDIVOUT)
"RTN","PSJPDRTP",158,0)
 S LINE="Run Date: "_$P($TR($$FMTE^XLFDT($$NOW^XLFDT,2),"@"," "),":",1,2)_$E(PAD,1,25)_"PADE Transaction Report Summary"_$E(PAD,1,30)_"Page "_PSJPGCNT_" of ^",PSJLNCNT=PSJLNCNT+1
"RTN","PSJPDRTP",159,0)
 S ^TMP($J,"PSJPDRTR",PSJPGCNT,PSJLNCNT)=LINE,PSJLNCNT=PSJLNCNT+1
"RTN","PSJPDRTP",160,0)
 S LINE="Run By: "_$P($G(^VA(200,+$G(DUZ),0)),"^")_$E(PAD,1,20)_"Division: "_PSDIVSTR
"RTN","PSJPDRTP",161,0)
 S ^TMP($J,"PSJPDRTR",PSJPGCNT,PSJLNCNT)=LINE,PSJLNCNT=PSJLNCNT+1
"RTN","PSJPDRTP",162,0)
 I $G(PSADDPG)  S ^TMP($J,"PSJPDRTR",PSJPGCNT,PSJLNCNT)=PDASH,PSJLNCNT=PSJLNCNT+1
"RTN","PSJPDRTP",163,0)
 Q
"RTN","PSJPDRTP",164,0)
EXIT ; Clean up.
"RTN","PSJPDRTP",165,0)
 N PSJOB
"RTN","PSJPDRTP",166,0)
 K ^TMP($J,"PSJPDRTR"),^TMP($J,"TSCREEN")
"RTN","PSJPDRTP",167,0)
 F PSJOB=$J,+$G(ZTSK) K ^TMP(PSJOB,"PSJPAT")
"RTN","PSJPDRTP",168,0)
 K ZTSK
"RTN","PSJPDRTP",169,0)
 Q
"RTN","PSJPDRTP",170,0)
 ;
"RTN","PSJPDRTP",171,0)
POCKDRG(PSJPSYS,PSJCAB,DRUG,DRWPCK) ; Get Drawer.Pocket location of DRUG in PSJCAB cabinet
"RTN","PSJPDRTP",172,0)
 N CABIEN,DRGIEN,DRWIEN,DRWNAM,PCKIEN,PCKNAM,ND,LOCNAM,I
"RTN","PSJPDRTP",173,0)
 Q:'$G(PSJPSYS)!'$G(PSJCAB)!'$G(PSJCAB)
"RTN","PSJPDRTP",174,0)
 S CABIEN=$$FIND1^DIC(58.6011,","_PSJPSYS_",","MXQ",+$G(PSJCAB),,,"ERR")
"RTN","PSJPDRTP",175,0)
 S DRWIEN=0 F  S DRWIEN=$O(^PS(58.601,PSJPSYS,"DEVICE",CABIEN,"DRAWER",DRWIEN)) Q:'DRWIEN  S DRWNAM=$P(^(DRWIEN,0),"^") D
"RTN","PSJPDRTP",176,0)
 .S PCKIEN=0 F  S PCKIEN=$O(^PS(58.601,PSJPSYS,"DEVICE",CABIEN,"DRAWER",DRWIEN,"SUB",PCKIEN)) Q:'PCKIEN  S ND=^(PCKIEN,0) I $P(ND,"^",5)=DRUG D
"RTN","PSJPDRTP",177,0)
 ..S PCKNAM=DRWNAM_"_"_$P(ND,"^",3)
"RTN","PSJPDRTP",178,0)
 ..F I=1:1:$L(PCKNAM,"_") S:$P(PCKNAM,"_",I)'="~~" LOCNAM=$G(LOCNAM)_$P(PCKNAM,"_",I)_"_"
"RTN","PSJPDRTP",179,0)
 ..S:$E(LOCNAM,$L(LOCNAM))="_" LOCNAM=$E(LOCNAM,1,$L(LOCNAM)-1)
"RTN","PSJPDRTP",180,0)
 ..S DRWPCK(DRUG,LOCNAM)=$P(ND,"^",2)
"RTN","PSJPDRTP",181,0)
 Q
"RTN","PSJPDRTP",182,0)
 ;
"RTN","PSJPDRTP",183,0)
PGTOT() ; Return calculated number of pages for this report
"RTN","PSJPDRTP",184,0)
 N PGTOT S PGTOT=$O(^TMP($J,"PSJPDRTR",999999),-1)
"RTN","PSJPDRTP",185,0)
 Q PGTOT
"RTN","PSJPDRTP",186,0)
 ;
"RTN","PSJPDRTP",187,0)
CSCHED(PSJINP) ; Return string of CS Federal Schedules from array PSJINP("PSJCSUB",SCHEDULE)
"RTN","PSJPDRTP",188,0)
 K CSCHED N PSJTMP
"RTN","PSJPDRTP",189,0)
 S CSCHED=$G(PSJINP("PSJCSUB")) I '(CSCHED="N") S CSCHED="CS (" D
"RTN","PSJPDRTP",190,0)
 .S PSJTMP="" F  S PSJTMP=$O(PSJINP("PSJCSUB",PSJTMP)) Q:PSJTMP=""  S CSCHED=CSCHED_PSJTMP_","
"RTN","PSJPDRTP",191,0)
 .I $E(CSCHED,$L(CSCHED))="," S CSCHED=$E(CSCHED,1,$L(CSCHED)-1)_")"
"RTN","PSJPDRTP",192,0)
 Q CSCHED
"RTN","PSJPDRTP",193,0)
 ;
"RTN","PSJPDRTP",194,0)
CABSTR(PSJINP) ; Return string of PADE cabinets from array PSJINP("PADEV",CABINET)
"RTN","PSJPDRTP",195,0)
 K CABSTR N PSJTMP,PSJII
"RTN","PSJPDRTP",196,0)
 I $G(PSJINP("PADEV"))="ALL" Q "ALL"
"RTN","PSJPDRTP",197,0)
 S PSJTMP="" F PSJII=0:1 S PSJTMP=$O(PSJINP("PADEV",PSJTMP)) Q:PSJTMP=""  D
"RTN","PSJPDRTP",198,0)
 .S CABSTR=$S(PSJII:CABSTR_",",1:"")_PSJTMP
"RTN","PSJPDRTP",199,0)
 Q CABSTR
"RTN","PSJPDRTP",200,0)
 ;
"RTN","PSJPDRTP",201,0)
DRGSTR(PSJINP) ; Return string of PADE drugs selected by user from PSJINP("PSDRG",DRUG IEN)
"RTN","PSJPDRTP",202,0)
 N PADEDRG
"RTN","PSJPDRTP",203,0)
 I $G(PSJINP("PSDRG"))="ALL" Q "ALL"
"RTN","PSJPDRTP",204,0)
 S PADEDRG="",PSJTMP="" F PSJII=0:1 S PSJTMP=$O(PSJINP("PSDRG",PSJTMP)) Q:PSJTMP=""  D
"RTN","PSJPDRTP",205,0)
 .I $G(PSJTMP),$D(^PSDRUG(+PSJTMP)) S PADEDRG=$S(PSJII:(PADEDRG_","),1:"")_$P($G(^PSDRUG(+PSJTMP,0)),"^") Q
"RTN","PSJPDRTP",206,0)
 .I $E(PSJTMP)="*" S PADEDRG=$S(PSJII:(PADEDRG_","),1:"")_PSJTMP
"RTN","PSJPDRTP",207,0)
 S:$E(PADEDRG,$L(PADEDRG)) PADEDRG=$E(PADEDRG,1,$L(PADEDRG)=1)
"RTN","PSJPDRTP",208,0)
 Q PADEDRG
"RTN","PSJPDRTP",209,0)
 ;
"RTN","PSJPDRTP",210,0)
PTSTR(PSJINP) ; Return string of patients selected by user from PSJINP("PSJPAT",DFN)
"RTN","PSJPDRTP",211,0)
 N PSJTMP,PATSTR,PSJII,PSJDONE
"RTN","PSJPDRTP",212,0)
 S PATSTR=""
"RTN","PSJPDRTP",213,0)
 I $G(^TMP($J,"PSJPAT"))="ALL"!($G(^TMP($J,"PSJPAT"))="NONE") Q $G(^TMP($J,"PSJPAT"))
"RTN","PSJPDRTP",214,0)
 S PSJTMP="" F PSJII=0:1 S PSJTMP=$O(^TMP($J,"PSJPAT",PSJTMP)) Q:PSJTMP=""!$G(PSJDONE)  D
"RTN","PSJPDRTP",215,0)
 .I $L($G(PATSTR))+$L(^TMP($J,"PSJPAT",PSJTMP))>250 S PATSTR=PATSTR_">> more..." S PSJDONE=1 Q
"RTN","PSJPDRTP",216,0)
 .S PATSTR=$S(PSJII:(PATSTR_","),1:"")_^TMP($J,"PSJPAT",PSJTMP)
"RTN","PSJPDRTP",217,0)
 Q PATSTR
"RTN","PSJPDRTP",218,0)
 ;
"RTN","PSJPDRTP",219,0)
USRSTR(PSJINP) ; Return string of Users selected by user from PSJINP("PSJUSER")
"RTN","PSJPDRTP",220,0)
 N PSJTMP,USRSTR,PSJII,PSJDONE
"RTN","PSJPDRTP",221,0)
 I $G(PSJINP("PSJUSER"))="ALL" Q PSJINP("PSJUSER")
"RTN","PSJPDRTP",222,0)
 S PSJTMP="" F PSJII=0:1 S PSJTMP=$O(PSJINP("PSJUSER",PSJTMP)) Q:PSJTMP=""!$G(PSJDONE)  D
"RTN","PSJPDRTP",223,0)
 .I $L($G(USRSTR))+PSJINP("PSJUSER",PSJTMP)>250 S USRSTR=USRSTR_">> more..." S PSJDONE=1 Q
"RTN","PSJPDRTP",224,0)
 .S USRSTR=$S(PSJII:(USRSTR_","),1:"")_PSJINP("PSJUSER",PSJTMP)_" ("_PSJTMP_")"
"RTN","PSJPDRTP",225,0)
 Q USRSTR
"RTN","PSJPDRTP",226,0)
 ;
"RTN","PSJPDRTP",227,0)
TSCREEN(PSJY,PSJINP) ; Screen PADE TRANSACTION file (#58.6) using user input criteria
"RTN","PSJPDRTP",228,0)
 ;
"RTN","PSJPDRTP",229,0)
 N PSJOK,PSJTDT,PSJPSYSE,PSJDIV,PSJBDT,PSJEDT,PSJCAB,PSJCSUB,PSJDRG,PSJSUM,PSJUSER,PSJTCAB,PSJDELM,PSJTPAT,PSJTADRG,PSJTADNM,PSJXPTNM,PSJOVQ
"RTN","PSJPDRTP",230,0)
 N PSJTDT,PSJTCAB,PSJTDRUG,PSJTSUB,PSJPTYP,PSJPAT,PSJTNOD0,PSJTORD,PSJOVR,PSJTRANS,PSJTTRAN,PSJTUSR,PSJTNOD1,PSJPTFLG,PSJOB,PSJTNOD3,PSJTSYS
"RTN","PSJPDRTP",231,0)
 S PSJOK=1
"RTN","PSJPDRTP",232,0)
 S PSJTNOD0=$G(^PS(58.6,+PSJY,0))
"RTN","PSJPDRTP",233,0)
 S PSJTNOD1=$G(^PS(58.6,+PSJY,1))
"RTN","PSJPDRTP",234,0)
 S PSJTNOD3=$G(^PS(58.6,+PSJY,3))
"RTN","PSJPDRTP",235,0)
 S PSJPSYSE=$G(PSJINP("PSJPSYSE"))
"RTN","PSJPDRTP",236,0)
 S PSJTSYS=$P(PSJTNOD1,"^",3)
"RTN","PSJPDRTP",237,0)
 I (PSJPSYSE'=""),(PSJTSYS'="") Q:(PSJPSYSE'=PSJTSYS) 0
"RTN","PSJPDRTP",238,0)
 S PSJDIV=$G(PSJINP("PSJDIV"))
"RTN","PSJPDRTP",239,0)
 S PSJBDT=$G(PSJINP("PSJBDT"))
"RTN","PSJPDRTP",240,0)
 S PSJEDT=$G(PSJINP("PSJEDT"))
"RTN","PSJPDRTP",241,0)
 M PSJCAB=PSJINP("PADEV")
"RTN","PSJPDRTP",242,0)
 M PSJCSUB=PSJINP("PSJCSUB")
"RTN","PSJPDRTP",243,0)
 M PSJDRG=PSJINP("PSDRG")
"RTN","PSJPDRTP",244,0)
 S PSJSUM=$G(PSJINP("PSJUM"))
"RTN","PSJPDRTP",245,0)
 M PSJUSER=PSJINP("PSJUSER")
"RTN","PSJPDRTP",246,0)
 M PSJTRANS=PSJINP("PSJTRANS")
"RTN","PSJPDRTP",247,0)
 M PSJPAT=PSJINP("PSJPAT")
"RTN","PSJPDRTP",248,0)
 D CNVTYP^PSJPDRIP(.PSJTRANS,.PSJPTYP)
"RTN","PSJPDRTP",249,0)
 S PSJDELM=$G(PSJINP("PSJDELM"))
"RTN","PSJPDRTP",250,0)
 S PSJOVR=$G(PSJINP("PSJOVR"))
"RTN","PSJPDRTP",251,0)
 ;  Transaction Date
"RTN","PSJPDRTP",252,0)
 S PSJTDT=$P(PSJTNOD0,"^")
"RTN","PSJPDRTP",253,0)
 I PSJBDT>PSJTDT!(PSJEDT<PSJTDT) Q 0
"RTN","PSJPDRTP",254,0)
 ;  PADE Device (Cabinet)
"RTN","PSJPDRTP",255,0)
 S PSJTCAB=$P(PSJTNOD0,"^",2) Q:PSJTCAB="" 0
"RTN","PSJPDRTP",256,0)
 I '$D(PSJCAB(PSJTCAB)) Q 0
"RTN","PSJPDRTP",257,0)
 ;  Drug Item
"RTN","PSJPDRTP",258,0)
 S PSJTDRUG=$P(PSJTNOD0,"^",3)
"RTN","PSJPDRTP",259,0)
 ; Alternate Drug ID and Name
"RTN","PSJPDRTP",260,0)
 S PSJTADRG=$P(PSJTNOD1,"^",7),PSJTADNM=$P(PSJTNOD1,"^",6)
"RTN","PSJPDRTP",261,0)
 I '($G(PSJDRG)="ALL") Q:PSJTDRUG=""&(PSJTADRG="") 0
"RTN","PSJPDRTP",262,0)
 I '($G(PSJDRG)="ALL") I '$D(PSJDRG(+PSJTDRUG))&'$D(PSJDRG("*"_PSJTADNM)) Q 0
"RTN","PSJPDRTP",263,0)
 ;  Controlled Substance Schedule
"RTN","PSJPDRTP",264,0)
 S PSJTSUB=$$GETCLASS^PSJPDRIN(PSJTDRUG)
"RTN","PSJPDRTP",265,0)
 I 'PSJTDRUG&$L($G(PSJTADRG)) S PSJTSUB=0
"RTN","PSJPDRTP",266,0)
 Q:PSJTSUB="" 0
"RTN","PSJPDRTP",267,0)
 I '$D(PSJCSUB(PSJTSUB)) Q 0
"RTN","PSJPDRTP",268,0)
 ;  Transaction Type
"RTN","PSJPDRTP",269,0)
 S PSJTTRAN=$P(PSJTNOD0,"^",5) Q:PSJTTRAN="" 0
"RTN","PSJPDRTP",270,0)
 I '$D(PSJPTYP(PSJTTRAN)) Q 0
"RTN","PSJPDRTP",271,0)
 ;  Patient
"RTN","PSJPDRTP",272,0)
 S PSJTPAT=$P(PSJTNOD0,"^",15) S PSJTPAT=$S(PSJTPAT="":+PSJTPAT,1:PSJTPAT)
"RTN","PSJPDRTP",273,0)
 I 'PSJTPAT S PSJTPAT=$P(PSJTNOD3,"^",7) S PSJTPAT=$S(PSJTPAT="":+PSJTPAT,1:PSJTPAT)
"RTN","PSJPDRTP",274,0)
 S PSJXPTNM=$P(PSJTNOD3,"^",4) I 'PSJTPAT&(PSJXPTNM]"") S PSJTPAT="*"
"RTN","PSJPDRTP",275,0)
 S PSJPTFLG=$$PTTRFLG^PSJPDRU1(.PSJINP)
"RTN","PSJPDRTP",276,0)
 ;  If only "NO PATIENT" selected, quit if patient in transaction
"RTN","PSJPDRTP",277,0)
 S PSJOB=$S($G(PSJINP("PSJTSK")):PSJINP("PSJTSK"),1:$J)
"RTN","PSJPDRTP",278,0)
 I PSJPTFLG=2,'$D(^TMP(PSJOB,"PSJPAT",PSJTPAT)) Q 0
"RTN","PSJPDRTP",279,0)
 ;  If not "NO PATIENT", and not "ALL" patients, 
"RTN","PSJPDRTP",280,0)
 I 'PSJPTFLG,(PSJTPAT'=""),(PSJTPAT'=0) Q 0
"RTN","PSJPDRTP",281,0)
 ;  User
"RTN","PSJPDRTP",282,0)
 S PSJTUSR=$P($G(^PS(58.6,+PSJY,5)),"^") Q:PSJTUSR="" 0
"RTN","PSJPDRTP",283,0)
 I ($G(PSJUSER)'="ALL")&($D(PSJUSER)>1)&'$D(PSJUSER(PSJTUSR)) Q 0
"RTN","PSJPDRTP",284,0)
 ;  Overrides
"RTN","PSJPDRTP",285,0)
 S PSJTORD=$P($G(^PS(58.6,+PSJY,1)),"^")
"RTN","PSJPDRTP",286,0)
 I PSJOVR D  Q:$G(PSJOVQ) 0
"RTN","PSJPDRTP",287,0)
 .I '$$PTRNSTYP^PSJPAD7I(PSJTTRAN) S PSJOVQ=1 Q
"RTN","PSJPDRTP",288,0)
 .I (PSJTORD'="")&(PSJTORD'="OVERRIDE") S PSJOVQ=1 Q
"RTN","PSJPDRTP",289,0)
 Q 1
"RTN","PSJPDRTP",290,0)
 ;
"RTN","PSJPDRTP",291,0)
SETCOLS(PSJINP,COL) ; Report column widths
"RTN","PSJPDRTP",292,0)
 S COL(1)=0,COL(2)=15,COL(3)=26,COL(4)=30,COL(5)=38,COL(6)=46,COL(7)=53,COL(8)=84,COL(9)=108
"RTN","PSJPDRTP",293,0)
 Q
"RTN","PSJPDRTP",294,0)
 ;
"RTN","PSJPDRTP",295,0)
SECTHD1() ; Sub-header line 1
"RTN","PSJPDRTP",296,0)
 N STRING
"RTN","PSJPDRTP",297,0)
 S STRING="Transaction^Trans^^  Beg^^  End^^Transaction^Witnessed"
"RTN","PSJPDRTP",298,0)
 Q STRING
"RTN","PSJPDRTP",299,0)
 ;
"RTN","PSJPDRTP",300,0)
SECTHD2() ; Sub-header line 2
"RTN","PSJPDRTP",301,0)
 N STRING
"RTN","PSJPDRTP",302,0)
 S STRING="Date/Time^Type^O-R^  Bal^  Qty^  Bal^Patient^By^By"
"RTN","PSJPDRTP",303,0)
 Q STRING
"RTN","PSJPDRTP",304,0)
 ;
"RTN","PSJPDRTP",305,0)
CONTRAN(PSLNHSTR,PSJPGCNT,PSJLNCNT,PSJINP) ; Print "Continued" message when listing spans multiple pages
"RTN","PSJPDRTP",306,0)
 ; Don't output "Cont" text if delimited output
"RTN","PSJPDRTP",307,0)
 Q:($G(PSJINP("PSJDELM"))="D")
"RTN","PSJPDRTP",308,0)
 I PSJLNCNT>($G(PSJIOSL)-6) D PHEAD(.PSJINP,.PSJLNCNT,.PSJPGCNT,.PSJPGTOT,1)
"RTN","PSJPDRTP",309,0)
 S ^TMP($J,"PSJPDRTR",PSJPGCNT,PSJLNCNT)="",PSJLNCNT=PSJLNCNT+1
"RTN","PSJPDRTP",310,0)
 S ^TMP($J,"PSJPDRTR",PSJPGCNT,PSJLNCNT)=PSLNHSTR,PSJLNCNT=PSJLNCNT+1
"RTN","PSJPDRTP",311,0)
 S ^TMP($J,"PSJPDRTR",PSJPGCNT,PSJLNCNT)="",PSJLNCNT=PSJLNCNT+1
"RTN","PSJPDRTP",312,0)
 S ^TMP($J,"PSJPDRTR",PSJPGCNT,PSJLNCNT)=$$SECTHD1^PSJPDRTP(),PSJLNCNT=PSJLNCNT+1
"RTN","PSJPDRTP",313,0)
 S ^TMP($J,"PSJPDRTR",PSJPGCNT,PSJLNCNT)=$$SECTHD2^PSJPDRTP(),PSJLNCNT=PSJLNCNT+1
"RTN","PSJPDRTP",314,0)
 S ^TMP($J,"PSJPDRTR",PSJPGCNT,PSJLNCNT)=PSJDASH,PSJLNCNT=PSJLNCNT+1
"RTN","PSJPDRTP",315,0)
 Q
"RTN","PSJPDRTR")
0^24^B204379013^n/a
"RTN","PSJPDRTR",1,0)
PSJPDRTR ;BIR/JH-MAIN DRIVER PADE TRANSACTION REPORT  ;18 JUN 96 / 2:58 PM
"RTN","PSJPDRTR",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**317**;16 DEC 97;Build 130
"RTN","PSJPDRTR",3,0)
 ;
"RTN","PSJPDRTR",4,0)
 ; Reference to ^%DT is supported by DBIA 10003.
"RTN","PSJPDRTR",5,0)
 ; Reference to CLEAR^VALM1 is supported by DBIA 10116.
"RTN","PSJPDRTR",6,0)
 ; Reference to ^XLFDT is supported by DBIA 10103.
"RTN","PSJPDRTR",7,0)
 ; Reference to ^DPT supported by DBIA 10035
"RTN","PSJPDRTR",8,0)
 ; Reference to ^PSDRUG supported by DBIA 2192
"RTN","PSJPDRTR",9,0)
 Q
"RTN","PSJPDRTR",10,0)
 ;
"RTN","PSJPDRTR",11,0)
EN ; Main Entry point
"RTN","PSJPDRTR",12,0)
 N PSJSTOP,PSDRG,PSJINP,DTOUT,DUOUT
"RTN","PSJPDRTR",13,0)
 S PSJSTOP=0
"RTN","PSJPDRTR",14,0)
 F  Q:$G(PSJSTOP)<0  D ENLOOP
"RTN","PSJPDRTR",15,0)
 Q
"RTN","PSJPDRTR",16,0)
 ;
"RTN","PSJPDRTR",17,0)
ENLOOP ; Prompt loop
"RTN","PSJPDRTR",18,0)
 N PSJINP,ZTSK,DIR,DIC,ZTSK,PSJTSK
"RTN","PSJPDRTR",19,0)
 K ^TMP($J,"PSJPTLST"),^TMP($J,"PSJPAT")
"RTN","PSJPDRTR",20,0)
 S PSJSTOP=0
"RTN","PSJPDRTR",21,0)
 D ASK(.PSJINP) G:PSJSTOP EXIT
"RTN","PSJPDRTR",22,0)
 Q:$G(PSJINP("PSJDEV"))="Q"
"RTN","PSJPDRTR",23,0)
START ; Queued entry
"RTN","PSJPDRTR",24,0)
 N PSJSTOP,PSJDLRJ S PSJSTOP=0
"RTN","PSJPDRTR",25,0)
 S PSJDLRJ=$J
"RTN","PSJPDRTR",26,0)
 I $G(ZTSK) S (PSJDLRJ,PSJINP("PSJTSK"))=ZTSK
"RTN","PSJPDRTR",27,0)
 K ^TMP($J,"PSJPDRTR"),^TMP($J,"TSCREEN")
"RTN","PSJPDRTR",28,0)
 D PROCESS(.PSJINP) G:PSJSTOP EXIT
"RTN","PSJPDRTR",29,0)
 D EN^PSJPDRTP(.PSJINP)
"RTN","PSJPDRTR",30,0)
 I $G(PSJINP("PSJDELM"))="D" D
"RTN","PSJPDRTR",31,0)
 .N DIR,X,Y S DIR(0)="EA"
"RTN","PSJPDRTR",32,0)
 .S DIR("A",1)=""
"RTN","PSJPDRTR",33,0)
 .S DIR("A",2)="The delimited report is complete."
"RTN","PSJPDRTR",34,0)
 .S DIR("A")="Please turn logging off, then press return to continue."
"RTN","PSJPDRTR",35,0)
 .D ^DIR
"RTN","PSJPDRTR",36,0)
 Q
"RTN","PSJPDRTR",37,0)
 ;
"RTN","PSJPDRTR",38,0)
EXIT ; Clean up
"RTN","PSJPDRTR",39,0)
 K ^TMP($J,"TSCREEN")
"RTN","PSJPDRTR",40,0)
 K ^TMP($J,"PSJPDRTR")
"RTN","PSJPDRTR",41,0)
 K ^TMP($J,"PSJPTLST")
"RTN","PSJPDRTR",42,0)
 K ^TMP($J,"PSJPAT")
"RTN","PSJPDRTR",43,0)
 Q
"RTN","PSJPDRTR",44,0)
 ;
"RTN","PSJPDRTR",45,0)
ASK(PSJINP) ;Prompt for selection criteria.  Quit if PSJSTOP is true
"RTN","PSJPDRTR",46,0)
 N PSJCSUB,PSJSYS,PSJDEV,PSJDIV,PADEV,PSJSUMM,PSJDELIM,PSJDRG,PSDRG,PSJUSER,PSJTRANS,PSJOVR,PSJDONE,PSJSYSE,PSJPAT,PSJPSYSE,PSJTRX
"RTN","PSJPDRTR",47,0)
 D CLEAR^VALM1 W !!
"RTN","PSJPDRTR",48,0)
 S PSJSTOP=0
"RTN","PSJPDRTR",49,0)
 W ?20,"PADE Transaction Report",!
"RTN","PSJPDRTR",50,0)
 S PSJINP("PSJPSYS")=$$PSYS^PSJPDRIN() Q:PSJSTOP
"RTN","PSJPDRTR",51,0)
 S PSJINP("PSJPSYSE")=$P($G(^PS(58.601,+$G(PSJINP("PSJPSYS")),0)),"^")
"RTN","PSJPDRTR",52,0)
 D DIV^PSJPDRIP(.PSJDIV,.PSJSTOP) Q:PSJSTOP  M PSJINP("PSJDIV")=PSJDIV
"RTN","PSJPDRTR",53,0)
 S PSJINP("PSJBDT")=$$DATE^PSJPDRUT("B",.PSJSTOP) Q:PSJSTOP
"RTN","PSJPDRTR",54,0)
 S PSJINP("PSJEDT")=$$DATE^PSJPDRUT("E",.PSJSTOP,.PSJINP) Q:PSJSTOP
"RTN","PSJPDRTR",55,0)
 D PADEV(.PADEV,.PSJINP) Q:PSJSTOP  M PSJINP("PADEV")=PADEV
"RTN","PSJPDRTR",56,0)
 D PSJCSUB^PSJPDRIN(.PSJINP,.PSJCSUB) Q:PSJSTOP  M PSJINP("PSJCSUB")=PSJCSUB
"RTN","PSJPDRTR",57,0)
 D DRUG(.PSDRG,.PSJINP) Q:PSJSTOP  M PSJINP("PSDRG")=PSDRG
"RTN","PSJPDRTR",58,0)
 D PATIENT(.PSJINP,.PSJPAT) Q:PSJSTOP  M PSJINP("PSJPAT")=PSJPAT M ^TMP($J,"PSJPAT")=^TMP($J,"PSJPTLST","SELPAT") K ^TMP($J,"PSJPTLST")
"RTN","PSJPDRTR",59,0)
 D TRANS(.PSJINP,.PSJTRANS,.PSJOVR) Q:PSJSTOP  M PSJINP("PSJTRANS")=PSJTRANS S PSJINP("PSJOVR")=$G(PSJOVR)
"RTN","PSJPDRTR",60,0)
 D USER(.PSJINP,.PSJUSER) Q:PSJSTOP  M PSJINP("PSJUSER")=PSJUSER
"RTN","PSJPDRTR",61,0)
 S PSJINP("PSJDELM")=$$DELIM^PSJPDRIN Q:PSJSTOP
"RTN","PSJPDRTR",62,0)
 S PSJINP("PSJDEV")=$$SELDEV^PSJPDRIN("START^PSJPDRTR",.PSJINP,1,.PSJTSK) D  Q:PSJSTOP
"RTN","PSJPDRTR",63,0)
 .I $G(PSJTSK) S PSJINP("PSJTSK")=PSJTSK M ^TMP(PSJTSK,"PSJPAT")=^TMP($J,"PSJPAT")
"RTN","PSJPDRTR",64,0)
 .S:$G(DUOUT)!$G(DTOUT) PSJSTOP=1
"RTN","PSJPDRTR",65,0)
 Q
"RTN","PSJPDRTR",66,0)
 ;
"RTN","PSJPDRTR",67,0)
PADEV(PADEV,PSJINP,PSJ58601) ; Get list of PADE device(s)
"RTN","PSJPDRTR",68,0)
 N PADE,PSJI,PSJPSYS,BDT,EDT,PADEDT,PSJDONE,PADEX,PSJPSYSI,PADEVTMP
"RTN","PSJPDRTR",69,0)
 S BDT=$G(PSJINP("PSJBDT")),EDT=$G(PSJINP("PSJEDT"))
"RTN","PSJPDRTR",70,0)
 S PSJPSYS=$P($G(^PS(58.601,+$G(PSJINP("PSJPSYS")),0)),"^")
"RTN","PSJPDRTR",71,0)
 S PSJPSYSI=$G(PSJINP("PSJPSYS"))
"RTN","PSJPDRTR",72,0)
 D PADELST(.PSJINP,.PADE,.PADEX,$G(PSJ58601))
"RTN","PSJPDRTR",73,0)
 ;
"RTN","PSJPDRTR",74,0)
 I $D(PADE)<10 D  Q
"RTN","PSJPDRTR",75,0)
 .S PSJSTOP=1
"RTN","PSJPDRTR",76,0)
 .W !!,"PADE Dispensing Device: "
"RTN","PSJPDRTR",77,0)
 .W !,"  No PADE dispensing device available for selection..",!
"RTN","PSJPDRTR",78,0)
 .S DIR(0)="E" D ^DIR
"RTN","PSJPDRTR",79,0)
 W ! D EN^DDIOL("  Enter '^ALL' to select all PADE dispensing devices.") W !
"RTN","PSJPDRTR",80,0)
 S PSJPSYS=PSJPSYSI
"RTN","PSJPDRTR",81,0)
 F  Q:$G(PSJDONE)!$G(PSJSTOP)  D SELPADE(.PADE,.PADEV,.PADEX,$G(PSJ58601))
"RTN","PSJPDRTR",82,0)
 Q:$G(PSJSTOP)
"RTN","PSJPDRTR",83,0)
 S PADE="" F  S PADE=$O(PADEV(PADE)) Q:PADE=""  D
"RTN","PSJPDRTR",84,0)
 .N PADVALS S PADVALS(1)=PADE,PADVALS(2)=PSJPSYS
"RTN","PSJPDRTR",85,0)
 .S PADEV(PADE)=$$FIND1^DIC(58.63,,"X",PADE)
"RTN","PSJPDRTR",86,0)
 Q
"RTN","PSJPDRTR",87,0)
 ;
"RTN","PSJPDRTR",88,0)
PADELST(PSJINP,PADE,PADEX,PSJ58601) ; Find selectable PADE devices for PADE Inbound System PSJPSYS 
"RTN","PSJPDRTR",89,0)
 ;                          and PADE transactions between PSJINP("PSJBDT") and PSJINP("EDT")
"RTN","PSJPDRTR",90,0)
 ; INPUT: PSJINP("PSJPSYS")
"RTN","PSJPDRTR",91,0)
 ;        PSJINP("PSJBDT")
"RTN","PSJPDRTR",92,0)
 ;        PSJINP("PSJEDT")
"RTN","PSJPDRTR",93,0)
 ; OUPUT: PADE(PADE NAME)=n
"RTN","PSJPDRTR",94,0)
 ;        PADE(n)=PADE NAME
"RTN","PSJPDRTR",95,0)
 ;
"RTN","PSJPDRTR",96,0)
 N PSJDIV,PSJHTM,PSJDOTS,PSPDIEN,PADETMP,PADETMPX,II
"RTN","PSJPDRTR",97,0)
 S PSJHTM=$P($H,",",2),PSJDOTS=""
"RTN","PSJPDRTR",98,0)
 S BDT=$G(PSJINP("PSJBDT")),EDT=$G(PSJINP("PSJEDT"))
"RTN","PSJPDRTR",99,0)
 S PSJPSYS=$P($G(^PS(58.601,+$G(PSJINP("PSJPSYS")),0)),"^")
"RTN","PSJPDRTR",100,0)
 S PSJPSYSI=$G(PSJINP("PSJPSYS"))
"RTN","PSJPDRTR",101,0)
 S PSJI=1
"RTN","PSJPDRTR",102,0)
 I '$G(PSJ58601) S PADE="" F  S PADE=$O(^PS(58.6,"DEV",PSJPSYS,PADE)) Q:PADE=""  D
"RTN","PSJPDRTR",103,0)
 .Q:$D(PADE(PADE))
"RTN","PSJPDRTR",104,0)
 .S PADEDT=BDT F  S PADEDT=$O(^PS(58.6,"DEV",PSJPSYS,PADE,PADEDT)) Q:'PADEDT  D
"RTN","PSJPDRTR",105,0)
 ..D DISPDOTS^PSJPDRUT(.PSJHTM,.PSJDOTS,1)
"RTN","PSJPDRTR",106,0)
 ..Q:PADEDT>EDT
"RTN","PSJPDRTR",107,0)
 ..D PADELST2(.PSJINP,.PADE,.PADEX)
"RTN","PSJPDRTR",108,0)
 I $G(PSJ58601) S PSPDIEN=0 F  S PSPDIEN=$O(^PS(58.601,+PSJPSYSI,"DEVICE","B",PSPDIEN)) Q:'PSPDIEN  D
"RTN","PSJPDRTR",109,0)
 .S PADE=$P($G(^PS(58.63,+PSPDIEN,0)),"^")
"RTN","PSJPDRTR",110,0)
 .Q:PADE=""!'$$DEVSCRN^PSJPDRUT(.PSJINP,PSPDIEN)
"RTN","PSJPDRTR",111,0)
 .D PADELST2(.PSJINP,.PADE,.PADEX)
"RTN","PSJPDRTR",112,0)
 I $D(PADEX)>1 N PADETMP,PADETMPX M PADETMP=PADE,PADETMPX=PADEX K PADE,PADEX D
"RTN","PSJPDRTR",113,0)
 .N PADNAME,PADIEN
"RTN","PSJPDRTR",114,0)
 .S PADNAME="" F II=1:1 S PADNAME=$O(PADETMP(PADNAME)) Q:PADNAME=""  S PADE(PADNAME)=II,PADEX(II)=PADNAME
"RTN","PSJPDRTR",115,0)
 Q
"RTN","PSJPDRTR",116,0)
 ;
"RTN","PSJPDRTR",117,0)
PADELST2(PSJINP,PADE,PADEX)  ; Continue building PADE device list
"RTN","PSJPDRTR",118,0)
 Q:$D(PADE(PADE))
"RTN","PSJPDRTR",119,0)
 N PADIEN,PADESTAT,PSJPSYS
"RTN","PSJPDRTR",120,0)
 S PSJPSYS=PSJPSYSI
"RTN","PSJPDRTR",121,0)
 S PADIEN=$$FIND1^DIC(58.63,,"O",PADE) I PADIEN S PADESTAT=$P($G(^PS(58.63,+PADIEN,0)),"^",4),PADESTAT=$S(PADESTAT="I":" (INACTIVE)",1:"")
"RTN","PSJPDRTR",122,0)
 K PSJDIV D GETS^DIQ(58.63,PADIEN,"2","I","PSJDIV")
"RTN","PSJPDRTR",123,0)
 S PSJDIV=+$G(PSJDIV("58.63",PADIEN_",",2,"I"))
"RTN","PSJPDRTR",124,0)
 Q:'$D(PSJINP("PSJDIV",PSJDIV))
"RTN","PSJPDRTR",125,0)
 S PADE(PADE)=PSJI
"RTN","PSJPDRTR",126,0)
 S PADEX(PSJI)=PADE_"^"_$G(PADESTAT),PSJI=PSJI+1
"RTN","PSJPDRTR",127,0)
 Q
"RTN","PSJPDRTR",128,0)
 ;
"RTN","PSJPDRTR",129,0)
SELPADE(PADE,PADEV,PADEX,PS58601) ; Prompt for one PADE device (or ALL)
"RTN","PSJPDRTR",130,0)
 N DIR,X,Y,DEVNAME,PSJY,PSJLSTA,PSFOUND,PADEUP,NOXREF
"RTN","PSJPDRTR",131,0)
 N PSJPART,II,PSELMSG,PLSTMSG,PADXDATA,PSALLPC
"RTN","PSJPDRTR",132,0)
 S PLSTMSG(1)="Transactions matching the entered Date Range and Division "
"RTN","PSJPDRTR",133,0)
 S PLSTMSG(2)="exist for the PADE Dispensing devices listed below."
"RTN","PSJPDRTR",134,0)
 S DIR(0)="FAO^1:30",DIR("?")="^D LIST^PSJPDRTR(.PADEX,.PLSTMSG,15,.PSJLSTA)"
"RTN","PSJPDRTR",135,0)
 S DIR("A")="Select PADE Dispensing Device: "_$S($D(PADEV)>1:"",1:" ^ALL// ")
"RTN","PSJPDRTR",136,0)
 D ^DIR
"RTN","PSJPDRTR",137,0)
 I X="",($D(PADEV)<10) S Y="ALL"
"RTN","PSJPDRTR",138,0)
 I $E(X)="^" S Y=$$XALL^PSJPDRIP(X)
"RTN","PSJPDRTR",139,0)
 I $G(DUOUT)!$G(DTOUT) S PSJSTOP=1 Q
"RTN","PSJPDRTR",140,0)
 I Y="ALL" M PADEV=PADE S PADEV="ALL",PSJDONE=1 Q
"RTN","PSJPDRTR",141,0)
 I Y="" D  Q
"RTN","PSJPDRTR",142,0)
 .I $D(PADEV)>1 S PSJDONE=1 Q
"RTN","PSJPDRTR",143,0)
 .W !!?2,"Select a single Item, several Items or enter ^ALL to select all Items."
"RTN","PSJPDRTR",144,0)
 S PSJY=Y
"RTN","PSJPDRTR",145,0)
 D PADEUP^PSJPDRUT(.PADE,.PADEUP)
"RTN","PSJPDRTR",146,0)
 I $D(PADE(PSJY))&$$UNIQUE^PSJPDRUT(PSJY,.PADE) D  Q
"RTN","PSJPDRTR",147,0)
 .W "  ",PSJY,$P($G(PADEX(PADE(PSJY))),"^",2) S PADEV(PSJY)=""
"RTN","PSJPDRTR",148,0)
 I $D(PADEUP($$UPPER^HLFNC(PSJY)))&$$UNIQUE^PSJPDRUT($$UPPER^HLFNC(PSJY),.PADE) D  Q:($P($G(PADXDATA),"^")]"")
"RTN","PSJPDRTR",149,0)
 .S PADXDATA=$G(PADEX(PADEUP($$UPPER^HLFNC(PSJY))))
"RTN","PSJPDRTR",150,0)
 .W "  ",$P(PADXDATA,"^"),$P(PADXDATA,"^",2) I $P(PADXDATA,"^")]"" S PADEV($P(PADXDATA,"^"))=""
"RTN","PSJPDRTR",151,0)
 ; If "?" list executed, check integers in PADEX list
"RTN","PSJPDRTR",152,0)
 I $G(PSJLSTA) I $D(PADEX(PSJY)) D  Q
"RTN","PSJPDRTR",153,0)
 .N PADENAME S PADENAME=$P($G(PADEX(PSJY)),"^") I PADENAME="" W "  ???" Q   ; Null cabinet/device name? (impossible?!?!)
"RTN","PSJPDRTR",154,0)
 .W "   ",$P($G(PADEX(PSJY)),"^") S PADEV(PADENAME)=""
"RTN","PSJPDRTR",155,0)
 S PSELMSG="Select a PADE device"
"RTN","PSJPDRTR",156,0)
 S NOXREF=1,PSALLPC=1  ; don't use cross refs, return all data from partial lookup
"RTN","PSJPDRTR",157,0)
 D PARTIAL^PSJPADPT(PSJY,.PADE,.PADEV,,PSELMSG,.PADEX,.PSFOUND,NOXREF,PSALLPC)
"RTN","PSJPDRTR",158,0)
 Q:$G(PSFOUND)
"RTN","PSJPDRTR",159,0)
 W "  ?? (No match found)"
"RTN","PSJPDRTR",160,0)
 Q
"RTN","PSJPDRTR",161,0)
 ;
"RTN","PSJPDRTR",162,0)
SELCSUB(PSJCSUB) ; Prompt for one controlled subs schedule or (ALL)
"RTN","PSJPDRTR",163,0)
 N X,Y,SCHED,SCHLST,SCNT,I,PSJPAD,PSJTMP
"RTN","PSJPDRTR",164,0)
 S $P(PSJPAD," ",80)=""
"RTN","PSJPDRTR",165,0)
 W ! D EN^DDIOL("  Enter '^ALL' to select all Controlled substance schedules.") W !
"RTN","PSJPDRTR",166,0)
 S SCHLST="1:Schedule I;2:Schedule II;2n:Schedule II Non-Narcotics;3:Schedule III;3n:Schedule III Non-Narcotics;4:Schedule IV;5:Schedule V;ALL:All CS Schedules"
"RTN","PSJPDRTR",167,0)
 F I=1:1:$L(SCHLST,";") S PSJTMP=$L($P($P(SCHLST,";",I),":")) D
"RTN","PSJPDRTR",168,0)
 .S DIR("A",I)=$E(PSJPAD,1,12-PSJTMP)_$P($P(SCHLST,";",I),":",1)_$E(PSJPAD,1,6)_$P($P(SCHLST,";",I),":",2)
"RTN","PSJPDRTR",169,0)
 S DIR(0)="SAO^"_SCHLST
"RTN","PSJPDRTR",170,0)
 S DIR("A")="Select CS Schedule: "_$S($D(PSJCSUB)<10:"^ALL//",1:"")
"RTN","PSJPDRTR",171,0)
 D ^DIR I X="",$D(PSJCSUB)<10 S Y="ALL"
"RTN","PSJPDRTR",172,0)
 I $E(X)="^" S Y=$$XALL^PSJPDRIP(X)
"RTN","PSJPDRTR",173,0)
 S SCHED=Y
"RTN","PSJPDRTR",174,0)
 I $G(DUOUT)!$G(DTOUT) S PSJSTOP=1 Q
"RTN","PSJPDRTR",175,0)
 I SCHED="ALL" D ALLSCHED^PSJPDRIP(.PSJCSUB,SCHLST) S PSJCSUB="CS (ALL)",PSJDONE=1 Q
"RTN","PSJPDRTR",176,0)
 I SCHED="" D  Q
"RTN","PSJPDRTR",177,0)
 .I $D(PSJCSUB)>1 S PSJDONE=1 Q
"RTN","PSJPDRTR",178,0)
 .W " Select a CS Schedule"
"RTN","PSJPDRTR",179,0)
 S PSJCSUB(SCHED)=""
"RTN","PSJPDRTR",180,0)
 Q
"RTN","PSJPDRTR",181,0)
 ;
"RTN","PSJPDRTR",182,0)
DRUG(DRUG,PSJINP) ; Allow user to select appropriate subset of drug items
"RTN","PSJPDRTR",183,0)
 N PSDONE,DIC,X,Y,GETDRG,LSTCNT,DRGARAY,PSJPSYS,PADEV,PSJDRC
"RTN","PSJPDRTR",184,0)
 M PADEV=PSJINP("PADEV")
"RTN","PSJPDRTR",185,0)
 D DRCAB(.PSJINP,.PSJDRC)         ; Get drugs linked to cabinet(s)
"RTN","PSJPDRTR",186,0)
 D DRUGSEL^PSJPDRTR(.PSJINP,.PSJDRC,.DRUG,,.PSJSTOP)  ; Prompt fo drug item, allow drugs not on file
"RTN","PSJPDRTR",187,0)
 Q
"RTN","PSJPDRTR",188,0)
 ;
"RTN","PSJPDRTR",189,0)
DRCAB(PSJINP,PSJDRCAB) ; Return list of drugs in each cabinet in PSJINP("PADEV")
"RTN","PSJPDRTR",190,0)
 ;   Input = PSJINP("PADEV",CABINET NAME) - Cabinet IEN points to PADE DISPENSING DEVICE file 58.63
"RTN","PSJPDRTR",191,0)
 ;  Output = PSJDRCAB(DRUG IEN)          - Drug IEN points to DRUG file 50
"RTN","PSJPDRTR",192,0)
 K PSJDRCAB
"RTN","PSJPDRTR",193,0)
 N CAB,CABDA,PSJPSYS,DRGDA,DRG,DRGDT,BDT,EDT,PSJPSYSE,PSDRGIEN,PSJHTM,PSJDOTS
"RTN","PSJPDRTR",194,0)
 S PSJHTM=$P($H,",",2),PSJDOTS=""
"RTN","PSJPDRTR",195,0)
 S PSJPSYS=$G(PSJINP("PSJPSYS"))
"RTN","PSJPDRTR",196,0)
 S PSJPSYSE=$G(PSJINP("PSJPSYSE"))
"RTN","PSJPDRTR",197,0)
 I PSJPSYSE="" S PSJPSYSE=$P($G(^PS(58.601,+PSJPSYS,0)),"^"),PSJINP("PSJPSYSE")=PSJPSYSE
"RTN","PSJPDRTR",198,0)
 S BDT=$G(PSJINP("PSJBDT")),EDT=$G(PSJINP("PSJEDT"))
"RTN","PSJPDRTR",199,0)
 M CAB=PSJINP("PADEV")
"RTN","PSJPDRTR",200,0)
 S CAB="" F  S CAB=$O(CAB(CAB)) Q:CAB=""  D
"RTN","PSJPDRTR",201,0)
 .S DRG=0 F  S DRG=$O(^PS(58.6,"DEVD",PSJPSYSE,CAB,DRG)) Q:'DRG  D
"RTN","PSJPDRTR",202,0)
 ..D DISPDOTS^PSJPDRUT(.PSJHTM,.PSJDOTS,1)
"RTN","PSJPDRTR",203,0)
 ..Q:$D(PSJDRCAB(DRG))
"RTN","PSJPDRTR",204,0)
 ..I '($G(PSJINP("PSJCSUB"))="ALL") Q:'$D(PSJINP("PSJCSUB",$$GETCLASS^PSJPDRIN(DRG)))
"RTN","PSJPDRTR",205,0)
 ..S DRGDT=$O(^PS(58.6,"DEVD",PSJPSYSE,CAB,DRG,BDT))
"RTN","PSJPDRTR",206,0)
 ..Q:'DRGDT!(DRGDT>EDT)
"RTN","PSJPDRTR",207,0)
 ..S PSJDRCAB(DRG)=$P($G(^PSDRUG(+DRG,0)),"^")
"RTN","PSJPDRTR",208,0)
 S CAB="" F  S CAB=$O(CAB(CAB)) Q:CAB=""  D
"RTN","PSJPDRTR",209,0)
 .S DRG=0 F  S DRG=$O(^PS(58.6,"MDRG",PSJPSYSE,CAB,DRG)) Q:DRG=""  D
"RTN","PSJPDRTR",210,0)
 ..Q:$D(PSJDRCAB("*"_+DRG))
"RTN","PSJPDRTR",211,0)
 ..S DRGDT=$O(^PS(58.6,"MDRG",PSJPSYSE,CAB,DRG,BDT))
"RTN","PSJPDRTR",212,0)
 ..Q:'DRGDT!(DRGDT>EDT)
"RTN","PSJPDRTR",213,0)
 ..N PSTRANS,PSALTID
"RTN","PSJPDRTR",214,0)
 ..S PSTRANS=+$O(^PS(58.6,"MDRG",PSJPSYSE,CAB,DRG,DRGDT,""))
"RTN","PSJPDRTR",215,0)
 ..Q:'PSTRANS
"RTN","PSJPDRTR",216,0)
 ..S PSDRGIEN=$P($G(^PS(58.6,+PSTRANS,0)),"^",3)
"RTN","PSJPDRTR",217,0)
 ..Q:PSDRGIEN
"RTN","PSJPDRTR",218,0)
 ..S PSALTID=$P($G(^PS(58.6,+PSTRANS,1)),"^",7)
"RTN","PSJPDRTR",219,0)
 ..S PSJDRCAB("*"_DRG)=$G(PSALTID)
"RTN","PSJPDRTR",220,0)
 Q
"RTN","PSJPDRTR",221,0)
 ;
"RTN","PSJPDRTR",222,0)
DRUGSEL(PSJINP,INDRUG,OUTDRUG,DRWPCK,PSJSTOP) ; Select drug(s)
"RTN","PSJPDRTR",223,0)
 N COUNT,PSJCNT,DIR,X,Y,PSJDONE,DRGLIST,DRGNAME,PSJY,DRGN,PSJTMP,SELDRG,PSFOUND,PSALLPC
"RTN","PSJPDRTR",224,0)
 K DRWPCK
"RTN","PSJPDRTR",225,0)
 M DRGLIST=INDRUG
"RTN","PSJPDRTR",226,0)
 S COUNT=0,PSJDONE=0,OUTDRUG=""
"RTN","PSJPDRTR",227,0)
 D DRUGLIST^PSJPDRIN(.PSJINP,.DRGLIST)
"RTN","PSJPDRTR",228,0)
 I $D(DRGLIST)<10 D  Q
"RTN","PSJPDRTR",229,0)
 .S PSJSTOP=1
"RTN","PSJPDRTR",230,0)
 .W !!,"Drug Item: "
"RTN","PSJPDRTR",231,0)
 .W !,"  No Drug Items available for selection..",!
"RTN","PSJPDRTR",232,0)
 .S DIR(0)="E" D ^DIR
"RTN","PSJPDRTR",233,0)
 I '$G(PSJINP("MANUNLOD")) W ! D EN^DDIOL("  Enter '^ALL' to select all available drug items") W !
"RTN","PSJPDRTR",234,0)
 F  Q:$G(DUOUT)!$G(DTOUT)!$G(PSJDONE)!$G(PSJSTOP)  D
"RTN","PSJPDRTR",235,0)
 .N PSJPART,II
"RTN","PSJPDRTR",236,0)
 .N DIR,X,Y,DUOUT
"RTN","PSJPDRTR",237,0)
 .S DIR(0)="FOA",DIR("A")="Select Drug Item: "_$S($D(OUTDRUG)>1:"",$G(PSJINP("MANUNLOD")):"",1:"^ALL// ")
"RTN","PSJPDRTR",238,0)
 .S DIR("?")="^D LIST^PSJPDRTR(.INDRUG,,15)"
"RTN","PSJPDRTR",239,0)
 .D ^DIR I X=""&($D(OUTDRUG)<10)&'$G(PSJINP("MANUNLOD")) S Y="ALL"
"RTN","PSJPDRTR",240,0)
 .I $E(X)="^" S Y=$$XALL^PSJPDRIP(X)
"RTN","PSJPDRTR",241,0)
 .I $G(DUOUT)!$G(DTOUT) S PSJSTOP=1 Q
"RTN","PSJPDRTR",242,0)
 .I Y="" D  Q
"RTN","PSJPDRTR",243,0)
 ..I $D(OUTDRUG)>1!$G(PSJINP("MANUNLOD")) S PSJDONE=1 Q
"RTN","PSJPDRTR",244,0)
 ..W !!?2,"Select a single Item, several Items or enter ^ALL to select all Items."
"RTN","PSJPDRTR",245,0)
 .S PSJY=Y
"RTN","PSJPDRTR",246,0)
 .I PSJY="ALL" S OUTDRUG="ALL",PSJDONE=1 D  Q
"RTN","PSJPDRTR",247,0)
 ..I $G(PSJINP("MANUNLOD")) S DRWPCK="ALL" Q
"RTN","PSJPDRTR",248,0)
 ..N DRGIEN S DRGIEN=0 F  S DRGIEN=$O(INDRUG(DRGIEN)) Q:DRGIEN=""  D
"RTN","PSJPDRTR",249,0)
 ...S OUTDRUG(DRGIEN)=$S(DRGIEN["*":$P(DRGIEN,"*",2),1:$P($G(^PSDRUG(+DRGIEN,0)),"^"))
"RTN","PSJPDRTR",250,0)
 .I $D(DRGLIST("IEN",+PSJY)) D  Q
"RTN","PSJPDRTR",251,0)
 ..W "  ",DRGLIST("IEN",+PSJY)
"RTN","PSJPDRTR",252,0)
 ..S OUTDRUG(+PSJY)=$P($G(^PSDRUG(+PSJY,0)),"^")
"RTN","PSJPDRTR",253,0)
 ..I $G(PSJINP("MANUNLOD")) D POCKET^PSJPDRIN(.PSJINP,+PSJY,.DRWPCK) S PSJDONE=1
"RTN","PSJPDRTR",254,0)
 .S PSALLPC=0  ; don't return all data pieces from partial lookup
"RTN","PSJPDRTR",255,0)
 .D PARTIAL^PSJPADPT(.PSJY,.DRGLIST,.SELDRG,1,,,.PSFOUND,,PSALLPC)
"RTN","PSJPDRTR",256,0)
 .M OUTDRUG=SELDRG
"RTN","PSJPDRTR",257,0)
 .I $G(PSJINP("MANUNLOD")) D  Q
"RTN","PSJPDRTR",258,0)
 ..S PSJY=$O(SELDRG(0))
"RTN","PSJPDRTR",259,0)
 ..I $G(PSJY) D POCKET^PSJPDRIN(.PSJINP,+PSJY,.DRWPCK) S PSJDONE=1 Q
"RTN","PSJPDRTR",260,0)
 ..W "  ??"
"RTN","PSJPDRTR",261,0)
 .I '$G(PSFOUND) W "  ?? (No match found)" S PSJDONE=0
"RTN","PSJPDRTR",262,0)
 Q
"RTN","PSJPDRTR",263,0)
 ;
"RTN","PSJPDRTR",264,0)
PATIENT(PSJINP,SELPAT) ; Get list of patients
"RTN","PSJPDRTR",265,0)
 D PATIENT^PSJPDRU1(.PSJINP)
"RTN","PSJPDRTR",266,0)
 Q
"RTN","PSJPDRTR",267,0)
 ;
"RTN","PSJPDRTR",268,0)
USER(PSJINP,PSJUSER) ; Get Vista Users (e.g., nurses) involved in PADE transactions
"RTN","PSJPDRTR",269,0)
 N PSJDONE,USER,USERX,SELUSER K PSJUSER
"RTN","PSJPDRTR",270,0)
 D USERLIST^PSJPDRUT(.PSJINP,.USER,.USERX)
"RTN","PSJPDRTR",271,0)
 ;
"RTN","PSJPDRTR",272,0)
 F  Q:$G(PSJDONE)!$G(PSJSTOP)  D
"RTN","PSJPDRTR",273,0)
 .D SELUSER^PSJPDRUT(.PSJINP,.USER,.SELUSER,.USERX,.PSJSTOP)
"RTN","PSJPDRTR",274,0)
 S PSJUSER=$G(SELUSER)
"RTN","PSJPDRTR",275,0)
 S USER="" F  S USER=$O(SELUSER(USER)) Q:USER=""  D
"RTN","PSJPDRTR",276,0)
 .S PSJUSER(USER)=SELUSER(USER)
"RTN","PSJPDRTR",277,0)
 Q
"RTN","PSJPDRTR",278,0)
 ;
"RTN","PSJPDRTR",279,0)
TRANS(PSJINP,PSJTRANS,PSJOVR) ; Get Transaction Types of PADE transactions
"RTN","PSJPDRTR",280,0)
 N PSJDONE K PSJTRANS,PSJOVR,PSJTRX
"RTN","PSJPDRTR",281,0)
 F  Q:$G(PSJSTOP)!$G(PSJDONE)  D SELTRANS(.PSJTRANS,.PSJTRX)
"RTN","PSJPDRTR",282,0)
 Q:$G(PSJSTOP)
"RTN","PSJPDRTR",283,0)
 ; Prompt for override only if a Vend (PSJTRANS(1)) or Return (PSJTRANS(7)) was selected
"RTN","PSJPDRTR",284,0)
 I $D(PSJTRX("Dispense"))!$D(PSJTRX("Return"))!$D(PSJTRX("Waste")) S PSJOVR=$$OVRTRAN()
"RTN","PSJPDRTR",285,0)
 Q
"RTN","PSJPDRTR",286,0)
 ;
"RTN","PSJPDRTR",287,0)
OVRTRAN() ; Prompt if only override transactions - only prompt if DISPENSE/VEND type was selected
"RTN","PSJPDRTR",288,0)
 N DIR
"RTN","PSJPDRTR",289,0)
 S DIR(0)="YA",DIR("B")="N"
"RTN","PSJPDRTR",290,0)
 S DIR("A")="Select Override Transaction only? "
"RTN","PSJPDRTR",291,0)
 S DIR("?",1)="  Select 'Y' to display transactions where the user"
"RTN","PSJPDRTR",292,0)
 S DIR("?",2)="  dispensed an item without an order. Otherwise ALL"
"RTN","PSJPDRTR",293,0)
 S DIR("?")="  entries will be displayed."
"RTN","PSJPDRTR",294,0)
 D ^DIR I $G(DUOUT)!$G(DTOUT) S PSJSTOP=1 Q ""
"RTN","PSJPDRTR",295,0)
 Q Y
"RTN","PSJPDRTR",296,0)
 ;
"RTN","PSJPDRTR",297,0)
SELTRANS(TRANS,TRANSX) ; Prompt for one transaction type (or ALL)
"RTN","PSJPDRTR",298,0)
 N DIR
"RTN","PSJPDRTR",299,0)
 W ! D EN^DDIOL("  Enter '^ALL' to select all Transaction Types.") W !
"RTN","PSJPDRTR",300,0)
 ;
"RTN","PSJPDRTR",301,0)
 D TRANLIST(.PSJINP,.DIR)
"RTN","PSJPDRTR",302,0)
 D ^DIR I X="",$D(TRANS)<10 S Y="ALL"
"RTN","PSJPDRTR",303,0)
 I $E(X)["^" S Y=$$XALL^PSJPDRIP(X)
"RTN","PSJPDRTR",304,0)
 I $G(DTOUT)!$G(DUOUT) S PSJSTOP=1 Q
"RTN","PSJPDRTR",305,0)
 I Y="",$D(TRANS)>1 S PSJDONE=1 Q
"RTN","PSJPDRTR",306,0)
 I Y="ALL" S PSJDONE=1 D  Q
"RTN","PSJPDRTR",307,0)
 .N PADLIST,CNT,TXPIECE
"RTN","PSJPDRTR",308,0)
 .S PADLIST=$P(DIR(0),"^",2)
"RTN","PSJPDRTR",309,0)
 .F CNT=1:1:$L(PADLIST,";") S TXPIECE=$P(PADLIST,";",CNT) S TRANS($P(TXPIECE,":"))=$P(TXPIECE,":",2),TRANSX($P(TXPIECE,":",2))=$P(TXPIECE,":")
"RTN","PSJPDRTR",310,0)
 .S TRANS="ALL"
"RTN","PSJPDRTR",311,0)
 I Y>0 D
"RTN","PSJPDRTR",312,0)
 .N PADLIST,CNT,TXPIECE
"RTN","PSJPDRTR",313,0)
 .S PADLIST=$P(DIR(0),"^",2)
"RTN","PSJPDRTR",314,0)
 .F CNT=1:1:$L(PADLIST,";") S TXPIECE=$P(PADLIST,";",CNT) I +TXPIECE=+Y S TRANS($P(TXPIECE,":"))=$P(TXPIECE,":",2),TRANSX($P(TXPIECE,":",2))=$P(TXPIECE,":")
"RTN","PSJPDRTR",315,0)
 Q
"RTN","PSJPDRTR",316,0)
 ;
"RTN","PSJPDRTR",317,0)
LIST(NLIST,MSG,MAX,AUDIT) ; Write list in LIST(ID1)=ID1
"RTN","PSJPDRTR",318,0)
 N II,NAME,NUMBER,TAB,NAME,ID1,ID2,PSCNT,DUOUT,DTOUT,DIR,X,Y,LIST,LISTX
"RTN","PSJPDRTR",319,0)
 K AUDIT S AUDIT=1  ; Return evidence this was called
"RTN","PSJPDRTR",320,0)
 S $P(TAB," ",80)=""
"RTN","PSJPDRTR",321,0)
 S PSCNT=0
"RTN","PSJPDRTR",322,0)
 Q:$D(NLIST)<10
"RTN","PSJPDRTR",323,0)
 I $L($G(MSG)) W !,MSG,!
"RTN","PSJPDRTR",324,0)
 I $D(MSG)>1 D  W !
"RTN","PSJPDRTR",325,0)
 .S II=0 F  S II=$O(MSG(II)) Q:'II  W !,MSG(II)
"RTN","PSJPDRTR",326,0)
 S ID2="" F  S ID2=$O(NLIST(ID2)) Q:ID2=""  S NAME=$G(NLIST(ID2)) S:NAME="" NAME="UNKNOWN" D
"RTN","PSJPDRTR",327,0)
 .S LIST($P(NAME,"^")_"^"_ID2)=$P(NAME,"^",2),LISTX(ID2)=$P(NAME,"^")_"^"_ID2
"RTN","PSJPDRTR",328,0)
 S II="" F  S II=$O(LISTX(II)) Q:II=""!$G(DTOUT)!$G(DUOUT)  D
"RTN","PSJPDRTR",329,0)
 .S ID1=LISTX(II)
"RTN","PSJPDRTR",330,0)
 .N PSJMARG
"RTN","PSJPDRTR",331,0)
 .S PSJMARG=" "
"RTN","PSJPDRTR",332,0)
 .S PSJMARG=$S($E(ID1)="*":$E(TAB,1,17),$E(II)="*":$E(TAB,1,17),1:$E(TAB,1,12-$L($P(ID1,"^",2))))
"RTN","PSJPDRTR",333,0)
 .W !,"   "_$P(ID1,"^",2)_PSJMARG_$P(ID1,"^")_" "_$P(LIST(ID1),"^")
"RTN","PSJPDRTR",334,0)
 .S PSCNT=$G(PSCNT)+1
"RTN","PSJPDRTR",335,0)
 .I $G(MAX),(PSCNT>$G(MAX)) W !! S DIR(0)="E" D ^DIR S PSCNT=0 W !!
"RTN","PSJPDRTR",336,0)
 Q
"RTN","PSJPDRTR",337,0)
 ;
"RTN","PSJPDRTR",338,0)
PROCESS(PSJINP) ; Gather report data, store in ^TMP
"RTN","PSJPDRTR",339,0)
 N PSJBDT,PSJSCR,TSCREEN
"RTN","PSJPDRTR",340,0)
 S PSJBDT=$G(PSJINP("PSJBDT"))
"RTN","PSJPDRTR",341,0)
 S PSJSCR="I $$TSCREEN^PSJPDRTP(Y,.PSJINP)"
"RTN","PSJPDRTR",342,0)
 D LIST^DIC(58.6,,"@;2;1;23;10;.01I;4;15;12;3;16;14I;6.1;6.2;7.1;7.2;21;25;18;19;1.2;11;13","P",,PSJBDT,,"B",PSJSCR,,"^TMP($J,""TSCREEN"")")
"RTN","PSJPDRTR",343,0)
 D PROCSUM^PSJPDRTP(.PSJINP) Q
"RTN","PSJPDRTR",344,0)
 K ^TMP(PSJDLRJ,"TSCREEN")
"RTN","PSJPDRTR",345,0)
 Q
"RTN","PSJPDRTR",346,0)
 ;
"RTN","PSJPDRTR",347,0)
DIVSTR(PSJINP)  ; Return Divisions in PSJINP("PSJDIV") in string
"RTN","PSJPDRTR",348,0)
 N DIVSTR,DIV,II,DIVNAM
"RTN","PSJPDRTR",349,0)
 S DIVSTR=""
"RTN","PSJPDRTR",350,0)
 I PSJINP("PSJDIV")="ALL" Q "ALL"
"RTN","PSJPDRTR",351,0)
 ;
"RTN","PSJPDRTR",352,0)
 S DIV="" F II=0:1 S DIV=$O(PSJINP("PSJDIV",DIV)) Q:DIV=""  D
"RTN","PSJPDRTR",353,0)
 .S DIVNAM=$P($G(^DG(40.8,+DIV,0)),"^")
"RTN","PSJPDRTR",354,0)
 .S DIVSTR=DIVSTR_$S(II:",",1:"")_DIVNAM
"RTN","PSJPDRTR",355,0)
 Q DIVSTR
"RTN","PSJPDRTR",356,0)
 ;
"RTN","PSJPDRTR",357,0)
TRANLIST(PSJINP,DIR)  ; Set selectable transactions into DIR based on patient selection
"RTN","PSJPDRTR",358,0)
 N PATFLG,PADLIST,CNT,TXPIECE,LAST,PSJPSYS,PSJBDT,PSJEDT
"RTN","PSJPDRTR",359,0)
 S PATFLG=0
"RTN","PSJPDRTR",360,0)
 S PSJPSYS=+$G(PSJINP("PSJPSYS")),PSJBDT=+$G(PSJINP("PSJBDT")),PSJEDT=+$G(PSJINP("PSJEDT"))
"RTN","PSJPDRTR",361,0)
 ; Filter to include ONLY transactions that have received from this vendor during this date range
"RTN","PSJPDRTR",362,0)
 S DIR(0)="SOA^"_$$TTYPDIR^PSJPDRUT(PSJPSYS,PSJBDT,PSJEDT)
"RTN","PSJPDRTR",363,0)
 I '$P(DIR(0),"^",2) D  Q
"RTN","PSJPDRTR",364,0)
 .K DIR S DIR("A")="No recognized Transaction types have been received for this vendor system."
"RTN","PSJPDRTR",365,0)
 .S PSJSTOP=-1
"RTN","PSJPDRTR",366,0)
 S DIR("A")="Select Transaction Type: "_$S($D(TRANS)>1:"",1:"^ALL//")
"RTN","PSJPDRTR",367,0)
 S DIR("A",1)="Select one of the following transaction types:"
"RTN","PSJPDRTR",368,0)
 S PADLIST=$P(DIR(0),"^",2)
"RTN","PSJPDRTR",369,0)
 F CNT=1:1:$L(PADLIST,";") S TXPIECE=$P(PADLIST,";",CNT) D
"RTN","PSJPDRTR",370,0)
 .S DIR("A",CNT+1)="    "_$P(TXPIECE,":")_"  "_$P(TXPIECE,":",2)
"RTN","PSJPDRTR",371,0)
 S LAST=$O(DIR("A",999999),-1)
"RTN","PSJPDRTR",372,0)
 S DIR("A",LAST+1)=" or ^ALL for all Transactions."
"RTN","PSJPDRTR",373,0)
 Q
"RTN","PSJPDRU1")
0^32^B196519581^n/a
"RTN","PSJPDRU1",1,0)
PSJPDRU1 ;BIR/MV-PADE REPORT UTILITIES ;18 JUN 96 / 2:58 PM
"RTN","PSJPDRU1",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**317**;16 DEC 97;Build 130
"RTN","PSJPDRU1",3,0)
 ;
"RTN","PSJPDRU1",4,0)
 ; Reference to ^%DT is supported by DBIA 10003.
"RTN","PSJPDRU1",5,0)
 ; Reference to CLEAR^VALM1 is supported by DBIA 10116.
"RTN","PSJPDRU1",6,0)
 ; Reference to ^XLFDT is supported by DBIA 10103.
"RTN","PSJPDRU1",7,0)
 ; Reference to ^DPT supported by DBIA 10035
"RTN","PSJPDRU1",8,0)
 ; Reference to ^PSDRUG supported by DBIA 2192
"RTN","PSJPDRU1",9,0)
 Q
"RTN","PSJPDRU1",10,0)
 ;
"RTN","PSJPDRU1",11,0)
PATIENT(PSJINP) ; Get list of patients
"RTN","PSJPDRU1",12,0)
 N PSJDONE,PATX,PAT,PATXX,PATSSN K PSJPAT,PSJSTOP
"RTN","PSJPDRU1",13,0)
 S PSJSTOP=""
"RTN","PSJPDRU1",14,0)
 D PATLIST^PSJPDRU1(.PSJINP)
"RTN","PSJPDRU1",15,0)
 I $D(^TMP($J,"PSJPTLST","PAT"))<10 D  Q
"RTN","PSJPDRU1",16,0)
 .W !!,"Patient: "
"RTN","PSJPDRU1",17,0)
 .W !," No patients available for selection..",!
"RTN","PSJPDRU1",18,0)
 F  Q:$G(PSJDONE)!$G(PSJSTOP)  D
"RTN","PSJPDRU1",19,0)
 .D SELPAT^PSJPDRU1(.PSJINP)
"RTN","PSJPDRU1",20,0)
 Q
"RTN","PSJPDRU1",21,0)
 ;
"RTN","PSJPDRU1",22,0)
PATLIST(PSJINP) ; Build list of patients that may be selected based on transaction date range and PADE Inbound System
"RTN","PSJPDRU1",23,0)
 N PSJDEV,PADEV,PSDRG,PSJBDT,PSJEDT,PSJTRDT,TRANS,PSJDONE,PSUNAME,PSJII,PSPTNAME,PSPTLN,PSPTFN,PSPTID,PSPTND3,PATRAWID,PSJHTM,PSJDOTS
"RTN","PSJPDRU1",24,0)
 S PSJHTM=$P($H,",",2),PSJDOTS=""     ; If search takes too long, may have to print "Searching..", followed by dots every 2 seconds
"RTN","PSJPDRU1",25,0)
 K ^TMP($J,"PSJPTLST")
"RTN","PSJPDRU1",26,0)
 K PAT S PSJII=1
"RTN","PSJPDRU1",27,0)
 M PSJDEV=PSJINP("PADEV")
"RTN","PSJPDRU1",28,0)
 M PSDRG=PSJINP("PSDRG")
"RTN","PSJPDRU1",29,0)
 S PSJBDT=$G(PSJINP("PSJBDT"))
"RTN","PSJPDRU1",30,0)
 S PSJEDT=$G(PSJINP("PSJEDT"))
"RTN","PSJPDRU1",31,0)
 S PAT="" F  S PAT=$O(^PS(58.6,"P",PAT)) Q:PAT=""  D
"RTN","PSJPDRU1",32,0)
 .D DISPDOTS^PSJPDRUT(.PSJHTM,.PSJDOTS,1)
"RTN","PSJPDRU1",33,0)
 .S PSJTRDT=$$FMADD^XLFDT(PSJBDT,,,,-1),PSJDONE=0
"RTN","PSJPDRU1",34,0)
 .F  S PSJTRDT=$O(^PS(58.6,"P",PAT,PSJTRDT)) Q:(PSJTRDT>PSJEDT)!$G(PSJDONE)!(PSJTRDT="")  D
"RTN","PSJPDRU1",35,0)
 ..N PSDRG S PSDRG="" F  S PSDRG=$O(^PS(58.6,"P",PAT,PSJTRDT,PSDRG)) Q:PSDRG=""  D
"RTN","PSJPDRU1",36,0)
 ...D DISPDOTS^PSJPDRUT(.PSJHTM,.PSJDOTS,1)
"RTN","PSJPDRU1",37,0)
 ...S TRANS=0 F  S TRANS=$O(^PS(58.6,"P",PAT,PSJTRDT,PSDRG,TRANS)) Q:'TRANS  D
"RTN","PSJPDRU1",38,0)
 ....I $E(PSDRG,1,3)'="zz~" Q:'$D(PSJINP("PSDRG",PSDRG))
"RTN","PSJPDRU1",39,0)
 ....I $E(PSDRG,1,3)="zz~" Q:'$D(PSJINP("PSDRG","*"_$E(PSDRG,4,99)))
"RTN","PSJPDRU1",40,0)
 ....N CAB,SYS,PSPTID,PATND0,PATSSN
"RTN","PSJPDRU1",41,0)
 ....S CAB=$P($G(^PS(58.6,+TRANS,0)),"^",2) I CAB]"" Q:'$D(PSJINP("PADEV",CAB))
"RTN","PSJPDRU1",42,0)
 ....S SYS=$P($G(^PS(58.6,+TRANS,1)),"^",3) I SYS]"" Q:SYS'=$G(PSJINP("PSJPSYSE"))
"RTN","PSJPDRU1",43,0)
 ....S PATND0=$G(^DPT(+PAT,0)) S PSPTNAME=$P(PATND0,"^"),PATSSN=$P(PATND0,"^",9) I PATSSN S PSPTNAME=PSPTNAME_" ("_$E(PATSSN,$L(PATSSN)-3,$L(PATSSN))_")"
"RTN","PSJPDRU1",44,0)
 ....S PSPTND3=$G(^PS(58.6,+TRANS,3)) S PSPTLN=$P(PSPTND3,"^",5),PSPTFN=$P(PSPTND3,"^",6),PATRAWID=$P(PSPTND3,"^",7)
"RTN","PSJPDRU1",45,0)
 ....S PSPTID=$S(($G(PAT)):PAT,$G(PATRAWID):PATRAWID,PAT="zz":"-",1:PAT)
"RTN","PSJPDRU1",46,0)
 ....S PATSSN=$S($G(PATSSN):PATSSN,1:PSPTID)
"RTN","PSJPDRU1",47,0)
 ....I PSPTNAME="" S PSPTNAME=$S((PSPTLN'="")&(PSPTFN'=""):PSPTLN_","_PSPTFN,PSPTLN'="":PSPTLN,PSPTFN'="":PSPTFN,1:"")
"RTN","PSJPDRU1",48,0)
 ....I PSPTNAME="" S PSPTNAME=$P(PSPTND3,"^",4)
"RTN","PSJPDRU1",49,0)
 ....I PSPTID="-",(PSPTNAME]"") S PSPTID="*",PSPTNAME="UNKNOWN PATIENT" S:'$G(PATSSN) PATSSN="*"
"RTN","PSJPDRU1",50,0)
 ....I PSPTNAME="" S PSPTNAME="NO PATIENT"
"RTN","PSJPDRU1",51,0)
 ....;
"RTN","PSJPDRU1",52,0)
 ....S ^TMP($J,"PSJPTLST","PAT",PSPTID)=PSPTNAME,^TMP($J,"PSJPTLST","PATX",PSPTNAME)=PSPTID
"RTN","PSJPDRU1",53,0)
 ....I PATSSN?9N S ^TMP($J,"PSJPTLST","PSPSSN",$E(PATSSN,6,9),PSPTID)=PSPTNAME
"RTN","PSJPDRU1",54,0)
 ....I PATSSN'="" S ^TMP($J,"PSJPTLST","PATRAW",PATSSN)=PSPTNAME
"RTN","PSJPDRU1",55,0)
 ....I PAT'="zz" S PSJDONE=1
"RTN","PSJPDRU1",56,0)
 ....S PSJII=PSJII+1
"RTN","PSJPDRU1",57,0)
 Q
"RTN","PSJPDRU1",58,0)
 ;
"RTN","PSJPDRU1",59,0)
SELPAT(PSJINP) ; Prompt for one patient (or ALL)
"RTN","PSJPDRU1",60,0)
 N DIR,X,Y,PATNAME,DUOUT,DTOUT
"RTN","PSJPDRU1",61,0)
 N PSJPART,II,PSELMSG,PLSTMSG
"RTN","PSJPDRU1",62,0)
 K PSJSTOP S PSJSTOP=""
"RTN","PSJPDRU1",63,0)
 W ! D EN^DDIOL(" Enter '^ALL' to select all Patients associated with PADE transactions.") W !
"RTN","PSJPDRU1",64,0)
 S PLSTMSG(1)="Transactions matching the entered Date Range and Division "
"RTN","PSJPDRU1",65,0)
 S PLSTMSG(2)="exist for the Patients listed below."
"RTN","PSJPDRU1",66,0)
 S DIR(0)="FAO^1:30",DIR("?")="^D TMPLIST^PSJPDRU1(""PATRAW"",20)"
"RTN","PSJPDRU1",67,0)
 ;
"RTN","PSJPDRU1",68,0)
 S DIR("A")="Select Patient: "_$S($D(^TMP($J,"PSJPTLST","SELPAT"))>1:"",1:"^ALL// ")
"RTN","PSJPDRU1",69,0)
 D ^DIR I X="" S Y=$S($D(^TMP($J,"PSJPTLST","SELPAT"))<10:"ALL",1:"")
"RTN","PSJPDRU1",70,0)
 I $E(X)="^" S Y=$$XALL^PSJPDRIP(X)
"RTN","PSJPDRU1",71,0)
 I $G(DUOUT)!$G(DTOUT) S PSJSTOP=1 Q
"RTN","PSJPDRU1",72,0)
 I Y="ALL" M ^TMP($J,"PSJPTLST","SELPAT")=^TMP($J,"PSJPTLST","PAT") S ^TMP($J,"PSJPTLST","SELPAT")="ALL",PSJDONE=1 Q
"RTN","PSJPDRU1",73,0)
 I Y="" D  Q
"RTN","PSJPDRU1",74,0)
 .I $D(^TMP($J,"PSJPTLST","SELPAT"))>1 S PSJDONE=1 Q
"RTN","PSJPDRU1",75,0)
 .W !!?2,"Select a single Patient, several Patients or enter ^ALL to select all Patients."
"RTN","PSJPDRU1",76,0)
 S PSJY=Y
"RTN","PSJPDRU1",77,0)
 I $D(^TMP($J,"PSJPTLST","PSPSSN",PSJY)) D  Q
"RTN","PSJPDRU1",78,0)
 .N I,SSN,ID,DIR,LISTDIR,LISTARR,NAME
"RTN","PSJPDRU1",79,0)
 .S SSN=PSJY S ID="" F I=1:1 S ID=$O(^TMP($J,"PSJPTLST","PSPSSN",SSN,ID)) Q:ID=""  D
"RTN","PSJPDRU1",80,0)
 ..I I=1 D  Q
"RTN","PSJPDRU1",81,0)
 ...S LISTDIR="1:"_^TMP($J,"PSJPTLST","PSPSSN",SSN,ID)_"("_SSN_")",LISTARR(1)=ID_"^"_^TMP($J,"PSJPTLST","PSPSSN",SSN,ID)
"RTN","PSJPDRU1",82,0)
 ...S DIR("A",1)="1   "_^TMP($J,"PSJPTLST","PSPSSN",SSN,ID)
"RTN","PSJPDRU1",83,0)
 ..S LISTDIR=$G(LISTDIR)_";"_I_":"_^TMP($J,"PSJPTLST","PSPSSN",SSN,ID)_"("_SSN_")",LISTARR(I)=ID_"^"_^TMP($J,"PSJPTLST","PSPSSN",SSN,ID)
"RTN","PSJPDRU1",84,0)
 ..S DIR("A",I)=I_"   "_^TMP($J,"PSJPTLST","PSPSSN",SSN,ID)
"RTN","PSJPDRU1",85,0)
 .I '$O(DIR("A",1)) S Y=1 W "   "_$P(LISTARR(Y),"^",2)
"RTN","PSJPDRU1",86,0)
 .I $O(DIR("A",1)) S DIR(0)="SOA^"_LISTDIR,DIR("A")="Select Patient: " D ^DIR
"RTN","PSJPDRU1",87,0)
 .I Y S ID=$P(LISTARR(Y),"^"),NAME=$P(LISTARR(Y),"^",2),^TMP($J,"PSJPTLST","SELPAT",ID)=NAME
"RTN","PSJPDRU1",88,0)
 I $D(^TMP($J,"PSJPTLST","PAT",PSJY)) D  Q
"RTN","PSJPDRU1",89,0)
 .W "  ",^TMP($J,"PSJPTLST","PAT",PSJY) S ^TMP($J,"PSJPTLST","SELPAT",PSJY)=^TMP($J,"PSJPTLST","PAT",PSJY)
"RTN","PSJPDRU1",90,0)
 I $D(^TMP($J,"PSJPTLST","PATX",PSJY)) D  Q
"RTN","PSJPDRU1",91,0)
 .W "  ",^TMP($J,"PSJPTLST","PATX",PSJY) S ^TMP($J,"PSJPTLST","SELPAT",PSJY)=^TMP($J,"PSJPTLST","PATX",PSJY)
"RTN","PSJPDRU1",92,0)
 S PSELMSG="Select a Patient"
"RTN","PSJPDRU1",93,0)
 D PARTPT^PSJPDRU1(PSJY)
"RTN","PSJPDRU1",94,0)
 Q:$D(^TMP($J,"PSJPTLST","SELPAT"))>1
"RTN","PSJPDRU1",95,0)
 W "  ?? (No match found)"
"RTN","PSJPDRU1",96,0)
 Q
"RTN","PSJPDRU1",97,0)
 ;
"RTN","PSJPDRU1",98,0)
TMPLIST(LIST,MAX) ; Write list in LIST(ID1)=ID1
"RTN","PSJPDRU1",99,0)
 N II,DRGNAME,NUMBER,TAB,NAME,ID1,ID2,PSCNT,DUOUT,DTOUT,DIR,X,Y
"RTN","PSJPDRU1",100,0)
 S $P(TAB," ",80)=""
"RTN","PSJPDRU1",101,0)
 S PSCNT=0
"RTN","PSJPDRU1",102,0)
 Q:$D(^TMP($J,"PSJPTLST",LIST))<10
"RTN","PSJPDRU1",103,0)
 S ID1="" F  S ID1=$O(^TMP($J,"PSJPTLST",LIST,ID1)) Q:ID1=""!$G(DTOUT)!$G(DUOUT)  D
"RTN","PSJPDRU1",104,0)
 .I ^TMP($J,"PSJPTLST",LIST,ID1)="" W !,$E(TAB,1,10)_ID1 Q
"RTN","PSJPDRU1",105,0)
 .N PSJMARG
"RTN","PSJPDRU1",106,0)
 .S PSJMARG=$S($E(ID1)="*":$E(TAB,1,17),1:$E(TAB,1,14-$L(ID1)))
"RTN","PSJPDRU1",107,0)
 .W !,PSJMARG_ID1_"    "_$P(^TMP($J,"PSJPTLST",LIST,ID1),"^")_" "_$P(^TMP($J,"PSJPTLST",LIST,ID1),"^",2)
"RTN","PSJPDRU1",108,0)
 .S PSCNT=$G(PSCNT)+1
"RTN","PSJPDRU1",109,0)
 .I $G(MAX),(PSCNT>$G(MAX)) W !! S DIR(0)="E" D ^DIR S PSCNT=0 W !!
"RTN","PSJPDRU1",110,0)
 Q
"RTN","PSJPDRU1",111,0)
 ;
"RTN","PSJPDRU1",112,0)
PARTPT(PSJY) ; Lookup PSJY in INARRAY
"RTN","PSJPDRU1",113,0)
 ; INPUT  - PSJY=Lookup text
"RTN","PSJPDRU1",114,0)
 ;        - INARRAY(text)=number - Array of selectable data
"RTN","PSJPDRU1",115,0)
 ; OUTPUT - OUTARRAY(text)=number - Entry selected from INARRAY
"RTN","PSJPDRU1",116,0)
 ;
"RTN","PSJPDRU1",117,0)
 N PSJPART,ITMNAME,II,ITM,ITMX,Y,PSJTMP
"RTN","PSJPDRU1",118,0)
 ;
"RTN","PSJPDRU1",119,0)
 ;     ^TMP($J,"PSJPTLST","PAT",PSPTID)=PSPTNAME
"RTN","PSJPDRU1",120,0)
 ;     ^TMP($J,"PSJPTLST","PATX",PSPTNAME)=PSPTID
"RTN","PSJPDRU1",121,0)
 ;     I PATSSN?9N S ^TMP($J,"PSJPTLST","PSPSSN",$E(PATSSN,6,9),PSPTID)=PSPTNAME
"RTN","PSJPDRU1",122,0)
 ;     I PATSSN'="" S ^TMP($J,"PSJPTLST","PATRAW",PATSSN)=PSPTNAME
"RTN","PSJPDRU1",123,0)
 ;
"RTN","PSJPDRU1",124,0)
 K ^TMP($J,"PSJPTLST","ITM"),^TMP($J,"PSJPTLST","ITMX")
"RTN","PSJPDRU1",125,0)
 S II=1,ITMID="" F  S ITMID=$O(^TMP($J,"PSJPTLST","PAT",ITMID)) Q:ITMID=""  D
"RTN","PSJPDRU1",126,0)
 .Q:ITMID="IEN"!(ITMID="NAME")
"RTN","PSJPDRU1",127,0)
 .S ^TMP($J,"PSJPTLST","ITM",ITMID)=$P(^TMP($J,"PSJPTLST","PAT",ITMID),"^")
"RTN","PSJPDRU1",128,0)
 .S ^TMP($J,"PSJPTLST","ITMX",^TMP($J,"PSJPTLST","PAT",ITMID))=$P(^TMP($J,"PSJPTLST","PAT",ITMID),"^",2)
"RTN","PSJPDRU1",129,0)
 ;
"RTN","PSJPDRU1",130,0)
 Q:$D(^TMP($J,"PSJPTLST","ITM"))<10
"RTN","PSJPDRU1",131,0)
 F ITM="" F  S ITM=$O(^TMP($J,"PSJPTLST","ITM",ITM)) Q:ITM=""  D
"RTN","PSJPDRU1",132,0)
 .I $E(ITM,1,$L(PSJY))=PSJY S PSJPART(II,ITM)=^TMP($J,"PSJPTLST","PAT",ITM) S II=II+1 Q
"RTN","PSJPDRU1",133,0)
 .I $E(^TMP($J,"PSJPTLST","ITM",ITM),1,$L(PSJY))=PSJY S PSJPART(II,ITM)=^TMP($J,"PSJPTLST","ITM",ITM) D  Q
"RTN","PSJPDRU1",134,0)
 ..S PSJPART(II,ITM)=PSJPART(II,ITM) S II=II+1
"RTN","PSJPDRU1",135,0)
 ;
"RTN","PSJPDRU1",136,0)
 I $D(PSJPART(1)) D
"RTN","PSJPDRU1",137,0)
 .N DIR,STRING,CNT
"RTN","PSJPDRU1",138,0)
 .I '$O(PSJPART(1)) S PSJTMP=$O(PSJPART(1,"")) S ^TMP($J,"PSJPTLST","SELPAT",PSJTMP)=PSJPART(1,PSJTMP) D  Q
"RTN","PSJPDRU1",139,0)
 ..W !," "_$O(PSJPART(1,"")),?15,PSJPART(1,PSJTMP)
"RTN","PSJPDRU1",140,0)
 .S CNT=0 F  S CNT=$O(PSJPART(CNT)) Q:'CNT  D
"RTN","PSJPDRU1",141,0)
 ..N ITMID S ITMID=$O(PSJPART(CNT,""))
"RTN","PSJPDRU1",142,0)
 ..S STRING=$G(STRING)_CNT_":"_ITMID_";"
"RTN","PSJPDRU1",143,0)
 ..S DIR("A",CNT)="   "_CNT_"      "_ITMID_"   "_$P($G(PSJPART(CNT,ITMID)),"^")
"RTN","PSJPDRU1",144,0)
 .S DIR("A")="Choose 1-"_+$O(PSJPART(9999999),-1)_": "
"RTN","PSJPDRU1",145,0)
 .S DIR(0)="SAO^"_STRING D ^DIR
"RTN","PSJPDRU1",146,0)
 .I Y>0 N PSPTSEL S PSPTSEL=$O(PSJPART(+Y,"")),^TMP($J,"PSJPTLST","SELPAT",PSPTSEL)=$G(PSJPART(+Y,PSPTSEL)) D  Q
"RTN","PSJPDRU1",147,0)
 ..N ID2 S ID2=$G(PSJPART(+Y,PSPTSEL)) I ID2]"" W "  ",ID2
"RTN","PSJPDRU1",148,0)
 .S PSJY=""
"RTN","PSJPDRU1",149,0)
 Q
"RTN","PSJPDRU1",150,0)
 ;
"RTN","PSJPDRU1",151,0)
PTTRFLG(PSJINP)  ; Return patient selection flag
"RTN","PSJPDRU1",152,0)
 ; INPUT: PSJINP array of all responses to report prompts
"RTN","PSJPDRU1",153,0)
 ; OUTPUT: FLAG indicating    1-All (Patients and Missing, or Blank, Patients), 
"RTN","PSJPDRU1",154,0)
 ;                            2-Only Individual Patients (exclude missing pateints),
"RTN","PSJPDRU1",155,0)
 ;                            0-Only Missing or Blank patients
"RTN","PSJPDRU1",156,0)
 K PATFLG,PSJOB
"RTN","PSJPDRU1",157,0)
 S PATFLG=0
"RTN","PSJPDRU1",158,0)
 S PSJOB=$S($G(PSJINP("PSJTSK")):+$G(PSJINP("PSJTSK")),1:$J)
"RTN","PSJPDRU1",159,0)
 S PATFLG=($G(^TMP(PSJOB,"PSJPAT"))="ALL")                          ; All individual patients PLUS all non-patient transactions
"RTN","PSJPDRU1",160,0)
 I 'PATFLG S PATFLG=$O(^TMP(PSJOB,"PSJPAT",0)) D                    ; One or more individual patients
"RTN","PSJPDRU1",161,0)
 .I PATFLG!(PATFLG="*") S PATFLG=2
"RTN","PSJPDRU1",162,0)
 I PATFLG=2,$D(^TMP(PSJOB,"PSJPAT","-")) S PATFLG=1                 ; One or more individual patients PLUS non-patient transactions
"RTN","PSJPDRU1",163,0)
 Q PATFLG
"RTN","PSJPDRU1",164,0)
 ;
"RTN","PSJPDRU1",165,0)
LIST(LIST,MSG) ; Write list in LIST(ID1)=ID1
"RTN","PSJPDRU1",166,0)
 N II,DRGNAME,NUMBER,TAB,NAME,ID1,ID2
"RTN","PSJPDRU1",167,0)
 S $P(TAB," ",80)=""
"RTN","PSJPDRU1",168,0)
 Q:$D(LIST)<10
"RTN","PSJPDRU1",169,0)
 I $L($G(MSG)) W !,MSG,!
"RTN","PSJPDRU1",170,0)
 I $D(MSG)>1 D  W !
"RTN","PSJPDRU1",171,0)
 .S II=0 F  S II=$O(MSG(II)) Q:'II  W !,MSG(II)
"RTN","PSJPDRU1",172,0)
 S ID1="" F  S ID1=$O(LIST(ID1)) Q:ID1=""  D
"RTN","PSJPDRU1",173,0)
 .I LIST(ID1)="" W !,$E(TAB,1,10)_ID1 Q
"RTN","PSJPDRU1",174,0)
 .W !,$E(TAB,1,14-$L(ID1))_ID1_"    "_$P(LIST(ID1),"^")_" "_$P(LIST(ID1),"^",2)
"RTN","PSJPDRU1",175,0)
 Q
"RTN","PSJPDRU1",176,0)
 ;
"RTN","PSJPDRU1",177,0)
BLDSTR(PSJINP,PSLNOD,PSJCOMM)  ; Build output data string
"RTN","PSJPDRU1",178,0)
 ; INPUT:  PSJINP() = array of user report input/selections
"RTN","PSJPDRU1",179,0)
 ;         PSLNOD   = header node from PADE INBOUND TRANSACTION file (#58.6), by way of LIST^DIC call output in ^TMP($J,"TSCREEN"
"RTN","PSJPDRU1",180,0)
 ; OUTPUT: PSLNDSTR  = string of report output to be stored in ^TMP($J,"PSJPDRTR"
"RTN","PSJPDRU1",181,0)
 N PSJPSYS,PSJCAB,PSJDRG,II,PSJCOL,PSJOVR,PSJUID,PSJPAT,PSJQTY,PSJTTYP,PSJPUSR,PSJTYABB,PSAB,PSTMP,PSJTRDT,PSJTRDMO,PSJTYPNM,PSJTYPCD
"RTN","PSJPDRU1",182,0)
 N PSJUSRID,PSJWITID
"RTN","PSJPDRU1",183,0)
 S PSJPSYS=+PSJINP("PSJPSYS")
"RTN","PSJPDRU1",184,0)
 M PSJCAB=PSJINP("PADEV")
"RTN","PSJPDRU1",185,0)
 M PSJDRG=PSJINP("PSDRG")
"RTN","PSJPDRU1",186,0)
 ;  Format Date to external
"RTN","PSJPDRU1",187,0)
 K PSLNDSTR
"RTN","PSJPDRU1",188,0)
 S PSLNDSTR=$P(PSLNOD,"^",6,99)
"RTN","PSJPDRU1",189,0)
 S PSJTRDT=$TR($P($$FMTE^XLFDT($P(PSLNDSTR,"^"),2),":",1,2),"@"," ")
"RTN","PSJPDRU1",190,0)
 S $P(PSJTRDT,"/")=$TR($J($P(PSJTRDT,"/"),2)," ",0)
"RTN","PSJPDRU1",191,0)
 S $P(PSLNDSTR,"^")=PSJTRDT
"RTN","PSJPDRU1",192,0)
 ;  Format Override; depends on transaction type of the 58.6 entry (e.g., load/unload can't be an override, should be null)
"RTN","PSJPDRU1",193,0)
 S PSJTYPNM=$P(PSLNDSTR,"^",2)
"RTN","PSJPDRU1",194,0)
 S PSJTYPCD=$$EXTT^PSJPDRUT(PSJTYPNM)
"RTN","PSJPDRU1",195,0)
 ;S PSJOVR=$S(PSJTYPCD="V":1,(PSJTYPCD="R"):1,1:"") I PSJOVR S PSJOVR=$S($P(PSLNDSTR,"^",3):"N",1:"Y")
"RTN","PSJPDRU1",196,0)
 S PSJOVR=$$PTRNSTYP^PSJPAD7I(PSJTYPCD) S:'PSJOVR PSJOVR=""
"RTN","PSJPDRU1",197,0)
 I PSJOVR S PSJOVR=$S($P(PSLNDSTR,"^",3):"N",1:"Y")
"RTN","PSJPDRU1",198,0)
 S $P(PSLNDSTR,"^",3)=$S($G(PSJINP("PSJDELM"))="R":" "_PSJOVR,1:PSJOVR)
"RTN","PSJPDRU1",199,0)
 ;  Format Patient (Add ID to name - last 4 of SSN)
"RTN","PSJPDRU1",200,0)
 S PSJPAT=$P(PSLNDSTR,"^",7) D
"RTN","PSJPDRU1",201,0)
 .N PATNAME,PATSSN
"RTN","PSJPDRU1",202,0)
 .S PATNAME=$P($G(^DPT(+PSJPAT,0)),"^")
"RTN","PSJPDRU1",203,0)
 .I PATNAME="" D  Q
"RTN","PSJPDRU1",204,0)
 ..N TRANS S TRANS=+$G(PSLNOD)
"RTN","PSJPDRU1",205,0)
 ..S PSJPAT=$P($G(PSLNDSTR),"^",13)
"RTN","PSJPDRU1",206,0)
 ..I TRANS S PATSSN=$P($G(^PS(58.6,+TRANS,3)),"^",7) I PATSSN S PSJPAT=PSJPAT_"("_PATSSN_")"
"RTN","PSJPDRU1",207,0)
 .S PATSSN=$P($G(^DPT(+PSJPAT,0)),"^",9) Q:$G(PATSSN)=""
"RTN","PSJPDRU1",208,0)
 .S PSJPAT=PATNAME_"("_$E(PATSSN,6,9)_")"
"RTN","PSJPDRU1",209,0)
 S $P(PSLNDSTR,"^",7)=PSJPAT
"RTN","PSJPDRU1",210,0)
 ;  Pull out Comment to PSJCOMM.
"RTN","PSJPDRU1",211,0)
 S PSJCOMM=$P(PSLNDSTR,"^",12)
"RTN","PSJPDRU1",212,0)
 ;  Add ID's to User and Witness
"RTN","PSJPDRU1",213,0)
 S PSJPUSR=""
"RTN","PSJPDRU1",214,0)
 S PSJUSRID=$P(PSLNDSTR,"^",8) D
"RTN","PSJPDRU1",215,0)
 .Q:PSJUSRID=""  S PSJPUSR=$$PADEUSR^PSJPDRUT(+$G(PSJPSYS),PSJUSRID)
"RTN","PSJPDRU1",216,0)
 .I 'PSJPUSR S PSJPUSR=$P(PSJPUSR,"^",3)
"RTN","PSJPDRU1",217,0)
 .S PSJUSRID="("_PSJUSRID_")"
"RTN","PSJPDRU1",218,0)
 S PSJWITID=$P(PSLNDSTR,"^",10) S:PSJWITID'="" PSJWITID="("_PSJWITID_")"
"RTN","PSJPDRU1",219,0)
 F II=4:1:6 S PSTMP=$P(PSLNDSTR,"^",II) I PSTMP["." S PSTMP=$P(PSTMP,".")_"."_$E($P(PSTMP,".",2),1,2),$P(PSLNDSTR,"^",II)=PSTMP
"RTN","PSJPDRU1",220,0)
 ; If Expected Balance is null, check for Actual Balance
"RTN","PSJPDRU1",221,0)
 N PSABC,PSEBC S PSABC=$P(PSLNOD,"^",23),PSEBC=$P(PSLNDSTR,"^",10)
"RTN","PSJPDRU1",222,0)
 S $P(PSLNDSTR,"^",10)=$S(((PSEBC="")&PSABC):PSABC,1:PSEBC)
"RTN","PSJPDRU1",223,0)
 S PSLNDSTR=$P(PSLNDSTR,"^",1,7)_"^"_$S($P(PSJPUSR,"^",2)]"":$P(PSJPUSR,"^",2),1:$P(PSLNDSTR,"^",9))_PSJUSRID_"^"_$P(PSLNDSTR,"^",11)_PSJWITID_"^^"
"RTN","PSJPDRU1",224,0)
 ;  Transaction Type conversion
"RTN","PSJPDRU1",225,0)
 S PSJTTYP=$$TTEX^PSJPDRUT(PSJTYPCD)
"RTN","PSJPDRU1",226,0)
 ;
"RTN","PSJPDRU1",227,0)
 ;  Signed Quantity as interpreted by PADE inbound based on Transaction Type 
"RTN","PSJPDRU1",228,0)
 S PSJQTY=+$P(PSLNDSTR,"^",5) D
"RTN","PSJPDRU1",229,0)
 .N TMPARRAY,TSIGN S TMPARRAY(6)=PSJQTY
"RTN","PSJPDRU1",230,0)
 .S TMPARRAY(5)=$$EXTT^PSJPDRUT(PSJTTYP)
"RTN","PSJPDRU1",231,0)
 .S TSIGN=$$TSIGN^PSJPADIT(.TMPARRAY) S TSIGN=$S(TSIGN="-":"-",1:"")
"RTN","PSJPDRU1",232,0)
 .S TMPARRAY(6)=$S(PSJQTY["-":PSJQTY/-1,1:PSJQTY)
"RTN","PSJPDRU1",233,0)
 .S PSJQTY=$S($G(TMPARRAY(5))="W":"NA",$G(TMPARRAY(6)):TSIGN_TMPARRAY(6),1:0)
"RTN","PSJPDRU1",234,0)
 ;
"RTN","PSJPDRU1",235,0)
 I PSJQTY["." S PSJQTY=$P(PSJQTY,".")_"."_$E($P(PSJQTY,".",2),1,2)
"RTN","PSJPDRU1",236,0)
 S $P(PSLNDSTR,"^",5)=PSJQTY
"RTN","PSJPDRU1",237,0)
 ;
"RTN","PSJPDRU1",238,0)
 I PSJTTYP="Count" D
"RTN","PSJPDRU1",239,0)
 .N PSENDBAL,PSBEGBAL S PSENDBAL=$P(PSLNDSTR,"^",6) I 'PSENDBAL,$G(PSJQTY) S PSENDBAL=PSJQTY S $P(PSLNDSTR,"^",6)=PSJQTY
"RTN","PSJPDRU1",240,0)
 .S PSBEGBAL=$P(PSLNDSTR,"^",4) I 'PSBEGBAL,$G(PSJQTY) S PSBEGBAL=PSJQTY S $P(PSLNDSTR,"^",4)=PSJQTY
"RTN","PSJPDRU1",241,0)
 ;  Right Justify Quantities if formatted output
"RTN","PSJPDRU1",242,0)
 I $G(PSJINP("PSJDELM"))'="D" F II=4:1:6 S $P(PSLNDSTR,"^",II)=$J($P(PSLNDSTR,"^",II),5)
"RTN","PSJPDRU1",243,0)
 S $P(PSLNDSTR,"^",2)=PSJTTYP
"RTN","PSJPDRU1",244,0)
 ; If delimited output, make adjustments
"RTN","PSJPDRU1",245,0)
 I $G(PSJINP("PSJDELM"))="D" D
"RTN","PSJPDRU1",246,0)
 .; If delimited output, add comment to end of string
"RTN","PSJPDRU1",247,0)
 .I PSJCOMM'="" S PSLNDSTR=PSLNDSTR_"^"_PSJCOMM
"RTN","PSJPDRU1",248,0)
 .; Break out Patient,User, and Witness ID's into separate delimited pieces if delimited output
"RTN","PSJPDRU1",249,0)
 .N PIECE F PIECE=7,9,11 D
"RTN","PSJPDRU1",250,0)
 ..N NAMID,NAM,ID S NAMID=$P(PSLNDSTR,"^",PIECE)
"RTN","PSJPDRU1",251,0)
 ..S NAM=$P(NAMID,"("),ID=$P(NAMID,"(",2),ID=$TR(ID,")")
"RTN","PSJPDRU1",252,0)
 ..S PSLNDSTR=$P(PSLNDSTR,"^",1,PIECE-1)_"^"_NAM_"^"_ID_"^"_$P(PSLNDSTR,"^",PIECE+1,99)
"RTN","PSJPDRU1",253,0)
 Q PSLNDSTR
"RTN","PSJPDRU1",254,0)
 ;
"RTN","PSJPDRU1",255,0)
INSYSPAR(PSPARACT)  ; Allow edit of PSJ PADE OE BALANCES parameter.
"RTN","PSJPDRU1",256,0)
 ; Input = PSPARACT - Default parameter setting - only prompt if 0(NO). 
"RTN","PSJPDRU1",257,0)
 ;                  - If 1(YES), set without prompting - if vendor is activated, system must also be activated
"RTN","PSJPDRU1",258,0)
 N DIR,X,Y,PSPARIEN,PSALLOFF,PSPARVAL,PSPARER
"RTN","PSJPDRU1",259,0)
 S PSPARIEN=$$FIND1^DIC(8989.51,,,"PSJ PADE OE BALANCES")
"RTN","PSJPDRU1",260,0)
 S PSALLOFF=0
"RTN","PSJPDRU1",261,0)
 I '$G(PSPARACT) D  Q:'PSALLOFF
"RTN","PSJPDRU1",262,0)
 .S DIR(0)="YAO",DIR("B")="Y"
"RTN","PSJPDRU1",263,0)
 .S DIR("A")="Completely disable PADE IOE indicators (for ALL vendors)? "
"RTN","PSJPDRU1",264,0)
 .S DIR("?",1)=" This sets the ""PSJ PADE OE BALANCES"" system parameter that"
"RTN","PSJPDRU1",265,0)
 .S DIR("?",2)=" inactivates all PADE indicators in Inpatient Order Entry,"
"RTN","PSJPDRU1",266,0)
 .S DIR("?",3)=" (IOE) for all vendors. To inactivate one specific vendor only,"
"RTN","PSJPDRU1",267,0)
 .S DIR("?")=" use the ""DISPLAY PADE INDICATORS IN IOE?"" prompt."
"RTN","PSJPDRU1",268,0)
 .D ^DIR
"RTN","PSJPDRU1",269,0)
 .S PSALLOFF=$S($G(Y):1,1:0)
"RTN","PSJPDRU1",270,0)
 S PSPARVAL=$S($G(PSPARACT):1,1:0)
"RTN","PSJPDRU1",271,0)
 D EN^XPAR("SYS",PSPARIEN,,PSPARVAL,"PSPARER")
"RTN","PSJPDRU1",272,0)
 I $D(PSPARER)>1 W !,"ERROR - Parameter not set"
"RTN","PSJPDRU1",273,0)
 Q
"RTN","PSJPDRU1",274,0)
 ;
"RTN","PSJPDRU1",275,0)
DEVONOFF(PSJPSYS,OFFON)  ; Set status of all dispensing devices (cabinet) to OFF or ON for system PSJPSYS
"RTN","PSJPDRU1",276,0)
 ;
"RTN","PSJPDRU1",277,0)
 N DIE,DA,DR,X,Y,PSVAL
"RTN","PSJPDRU1",278,0)
 N FDA,PSERR
"RTN","PSJPDRU1",279,0)
 N PSICAB  ; Pointer to cabinet in PADE INVENTORY SYSTEM "DEVICE" subfile (not to cabinet ien in DEVICE file #58.63)
"RTN","PSJPDRU1",280,0)
 N PSDCAB  ; Pointer to cabinet in PADE DISPENSING DEVICE (#58.63) file
"RTN","PSJPDRU1",281,0)
 Q:'$G(PSJPSYS)
"RTN","PSJPDRU1",282,0)
 Q:'$D(^PS(58.601,+$G(PSJPSYS),"DEVICE"))
"RTN","PSJPDRU1",283,0)
 Q:($G(OFFON)'=1)&($G(OFFON)'=0)   ; must be 1(yes=ACTIVE) or 0(no=INACTIVE)
"RTN","PSJPDRU1",284,0)
 S PSICAB=0 F  S PSICAB=$O(^PS(58.601,+$G(PSJPSYS),"DEVICE",PSICAB)) Q:'PSICAB  D
"RTN","PSJPDRU1",285,0)
 .S PSDCAB=+$G(^PS(58.601,PSJPSYS,"DEVICE",PSICAB,0))
"RTN","PSJPDRU1",286,0)
 .Q:'$G(PSDCAB)  Q:'$D(^PS(58.63,+PSDCAB,0))  ; Device not in device file #58.63
"RTN","PSJPDRU1",287,0)
 .S PSVAL=$S(OFFON=1:"A",1:"I")
"RTN","PSJPDRU1",288,0)
 .S FDA(58.63,PSDCAB_",",4)=PSVAL
"RTN","PSJPDRU1",289,0)
 .D FILE^DIE("","FDA","PSERR")
"RTN","PSJPDRU1",290,0)
 Q
"RTN","PSJPDRU1",291,0)
 ;
"RTN","PSJPDRU1",292,0)
DEVSTCHK(PSJPSYS)  ; Return status of all dispensing devices (cabinet) for system PSJPSYS
"RTN","PSJPDRU1",293,0)
 ;  If all devices have a status OFF, return 0; if ANY devices do NOT have a status of INACTIVE, return 1
"RTN","PSJPDRU1",294,0)
 N DIE,DA,DR,X,Y,PSTATUS
"RTN","PSJPDRU1",295,0)
 N PSICAB  ; Pointer to cabinet in PADE INVENTORY SYSTEM "DEVICE" subfile (not to cabinet ien in DEVICE file #58.63)
"RTN","PSJPDRU1",296,0)
 N PSDCAB  ; Pointer to cabinet in PADE DISPENSING DEVICE (#58.63) file
"RTN","PSJPDRU1",297,0)
 Q:'$G(PSJPSYS) 0
"RTN","PSJPDRU1",298,0)
 Q:'$D(^PS(58.601,+$G(PSJPSYS),"DEVICE")) 0
"RTN","PSJPDRU1",299,0)
 S PSTATUS=0
"RTN","PSJPDRU1",300,0)
 S PSICAB=0 F  S PSICAB=$O(^PS(58.601,+$G(PSJPSYS),"DEVICE",PSICAB)) Q:'PSICAB!$G(PSTATUS)  D
"RTN","PSJPDRU1",301,0)
 .S PSDCAB=+$G(^PS(58.601,PSJPSYS,"DEVICE",PSICAB,0))
"RTN","PSJPDRU1",302,0)
 .Q:'$G(PSDCAB)  Q:'$D(^PS(58.63,+PSDCAB,0))  ; Device not in device file #58.63
"RTN","PSJPDRU1",303,0)
 .S PSTATUS=$P($G(^PS(58.63,+PSDCAB,0)),"^",4)
"RTN","PSJPDRU1",304,0)
 .S PSTATUS=$S(PSTATUS="I":0,1:1)
"RTN","PSJPDRU1",305,0)
 Q PSTATUS
"RTN","PSJPDRU1",306,0)
 ;
"RTN","PSJPDRU1",307,0)
DELBADSY ; Check for and delete "?BAD" entries in PADE INVENTORY SYSTEM file (#58.601)
"RTN","PSJPDRU1",308,0)
 ; "?BAD" entry may result when user enters "" new DISPENSING DEVICE (#58.63) file entry, and FileMan creates the "?BAD" KEY index
"RTN","PSJPDRU1",309,0)
 N SYS,SYSNAM,BADSYS
"RTN","PSJPDRU1",310,0)
 S SYS=0 F  S SYS=$O(^PS(58.601,SYS)) Q:'SYS  D
"RTN","PSJPDRU1",311,0)
 .I $G(^PS(58.601,SYS,0))="?BAD",'$D(^PS(58.601,SYS,4)) S BADSYS(SYS)=$P($G(^PS(58.601,SYS,0)),"^")
"RTN","PSJPDRU1",312,0)
 Q:'$D(BADSYS)
"RTN","PSJPDRU1",313,0)
 S SYS=0 F  S SYS=$O(BADSYS(SYS)) Q:'SYS  D
"RTN","PSJPDRU1",314,0)
 .Q:$G(BADSYS(SYS))'="?BAD"
"RTN","PSJPDRU1",315,0)
 .N DIK,DA
"RTN","PSJPDRU1",316,0)
 .S DIK="^PS(58.601,",DA=+SYS D ^DIK
"RTN","PSJPDRU1",317,0)
 Q
"RTN","PSJPDRU1",318,0)
 ;
"RTN","PSJPDRU1",319,0)
TSIGN(PADATA) ; Determine if the transaction amount needs to be added or subtracted, depending on the transaction type
"RTN","PSJPDRU1",320,0)
 N TRNSIGN,II
"RTN","PSJPDRU1",321,0)
 S TRNSIGN="" F II="V","B","U","E","D" I PADATA(5)=II S TRNSIGN="-"
"RTN","PSJPDRU1",322,0)
 I PADATA(5)="A"&($E(PADATA(6))="-") S TRNSIGN="-"  ; Discrepancies (type="A") may be either + or -
"RTN","PSJPDRU1",323,0)
 Q $S(TRNSIGN="-":"-",1:"")
"RTN","PSJPDRU1",324,0)
 ;
"RTN","PSJPDRU1",325,0)
DEVBAL(PADESYS,PADEDEV,DRUGIEN)  ; Calculate Device BALANCE for PADE device=PADEDEV drug=DRUGIEN
"RTN","PSJPDRU1",326,0)
 K DEVBAL S DEVBAL=""                        ; Initialize returned balance
"RTN","PSJPDRU1",327,0)
 N DRAWER                                      ; Pocket_subdrawer IEN
"RTN","PSJPDRU1",328,0)
 N DRWOUT,DEVOUT                               ; Return array from LIST^DIC
"RTN","PSJPDRU1",329,0)
 N DRWDRG
"RTN","PSJPDRU1",330,0)
 N PSERR
"RTN","PSJPDRU1",331,0)
 N DRWTOT
"RTN","PSJPDRU1",332,0)
 ; We need system and device to find device balance
"RTN","PSJPDRU1",333,0)
 I '$G(PADESYS)!'$G(PADEDEV) Q ""
"RTN","PSJPDRU1",334,0)
 ;
"RTN","PSJPDRU1",335,0)
 Q:'DRUGIEN ""
"RTN","PSJPDRU1",336,0)
 S DRAWER=0 F  S DRAWER=$O(^PS(58.601,PADESYS,"DEVICE",PADEDEV,"DRAWER",DRAWER)) Q:'DRAWER  D
"RTN","PSJPDRU1",337,0)
 .S DRWDRG=0 F  S DRWDRG=$O(^PS(58.601,PADESYS,"DEVICE",PADEDEV,"DRAWER",DRAWER,"DRUG","B",DRWDRG)) Q:'DRWDRG  D
"RTN","PSJPDRU1",338,0)
 ..Q:DRWDRG'=DRUGIEN   ; Is this the drug we're looking for?
"RTN","PSJPDRU1",339,0)
 ..N DRWDRIEN          ; The IEN of the drug's entry in the drawer
"RTN","PSJPDRU1",340,0)
 ..S DRWDRIEN=$O(^PS(58.601,PADESYS,"DEVICE",PADEDEV,"DRAWER",DRAWER,"DRUG","B",DRWDRG,0))
"RTN","PSJPDRU1",341,0)
 ..Q:'DRWDRIEN         ; Bad index - this shouldn't happen
"RTN","PSJPDRU1",342,0)
 ..S DRWTOT=$P($G(^PS(58.601,PADESYS,"DEVICE",PADEDEV,"DRAWER",DRAWER,"DRUG",DRWDRIEN,0)),"^",2)
"RTN","PSJPDRU1",343,0)
 ..S DEVBAL=$G(DEVBAL)+DRWTOT
"RTN","PSJPDRU1",344,0)
 Q DEVBAL
"RTN","PSJPDRUT")
0^30^B233123274^n/a
"RTN","PSJPDRUT",1,0)
PSJPDRUT ;BIR/MV-PADE REPORT UTILITIES ;18 JUN 96 / 2:58 PM
"RTN","PSJPDRUT",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**317**;16 DEC 97;Build 130
"RTN","PSJPDRUT",3,0)
 ;
"RTN","PSJPDRUT",4,0)
 ; Reference to ^%DT is supported by DBIA 10003.
"RTN","PSJPDRUT",5,0)
 ; Reference to CLEAR^VALM1 is supported by DBIA 10116.
"RTN","PSJPDRUT",6,0)
 ; Reference to ^XLFDT is supported by DBIA 10103.
"RTN","PSJPDRUT",7,0)
 ; Reference to ^DPT supported by DBIA 10035
"RTN","PSJPDRUT",8,0)
 ; Reference to ^PSDRUG supported by DBIA 2192
"RTN","PSJPDRUT",9,0)
 Q
"RTN","PSJPDRUT",10,0)
 ;
"RTN","PSJPDRUT",11,0)
DATE(BEGEND,PSJSTOP,PSJINP) ; Prompt for Start Date
"RTN","PSJPDRUT",12,0)
 N DIR,X,Y,DATE,PSJNOW,PSJDONE,TMPY,DUOUT,DTOUT
"RTN","PSJPDRUT",13,0)
 S PSJNOW=$$NOW^XLFDT
"RTN","PSJPDRUT",14,0)
 K %DT S %DT("A")="Enter"_$S($G(BEGEND)="B":" Start ",$G(BEGEND)="E":" End ",1:" ")_"Date: ",%DT="TAE"
"RTN","PSJPDRUT",15,0)
 F  Q:$G(PSJSTOP)!$G(PSJDONE)  D
"RTN","PSJPDRUT",16,0)
 .D ^%DT S TMPY=Y I ($D(DTOUT))!$G(DUOUT) S PSJSTOP=1 Q
"RTN","PSJPDRUT",17,0)
 .I ($G(BEGEND)="E"),($G(X)="T") S TMPY=$P(TMPY,".")_".24"
"RTN","PSJPDRUT",18,0)
 .I $G(TMPY)<1 D  Q
"RTN","PSJPDRUT",19,0)
 ..I $E(X)="^" S PSJSTOP=1 Q
"RTN","PSJPDRUT",20,0)
 ..W !,?3,$S(BEGEND="B":"Start ",1:"End ")_"Date is required"
"RTN","PSJPDRUT",21,0)
 .I $G(BEGEND)="B" I TMPY>($$FMADD^XLFDT(PSJNOW)) D  Q
"RTN","PSJPDRUT",22,0)
 ..W $C(7),!?3,"Start Date cannot be in the future. Re-enter Start Date."
"RTN","PSJPDRUT",23,0)
 .I $G(BEGEND)="E",$G(PSJINP("PSJBDT")) I TMPY<PSJINP("PSJBDT") D  Q
"RTN","PSJPDRUT",24,0)
 ..W $C(7),!?3,"End Date cannot be before Start Date. Re-enter End Date."
"RTN","PSJPDRUT",25,0)
 .S PSJDONE=1
"RTN","PSJPDRUT",26,0)
 S:$G(PSJSTOP) TMPY=""
"RTN","PSJPDRUT",27,0)
 S DATE=TMPY
"RTN","PSJPDRUT",28,0)
 I $G(BEGEND)="E",($P(DATE,".",2)="") S DATE=$$FMADD^XLFDT($P(DATE,"."),1)
"RTN","PSJPDRUT",29,0)
 Q DATE
"RTN","PSJPDRUT",30,0)
 ;
"RTN","PSJPDRUT",31,0)
SELUSER(PSJINP,USER,SELUSER,USERX,PSJSTOP) ; Prompt for one user (or ALL)
"RTN","PSJPDRUT",32,0)
 N DIR,X,Y,USRNAME,DUOUT,DTOUT,PSFOUND,PSALLPC
"RTN","PSJPDRUT",33,0)
 N PSJPART,II,PSELMSG,PLSTMSG
"RTN","PSJPDRUT",34,0)
 W ! D EN^DDIOL("  Enter '^ALL' to select all Users associated with selected PADE transactions.") W !
"RTN","PSJPDRUT",35,0)
 S PLSTMSG(1)="Transactions matching the entered Date Range and Division "
"RTN","PSJPDRUT",36,0)
 S PLSTMSG(2)="exist for the Users listed below."
"RTN","PSJPDRUT",37,0)
 S DIR(0)="FAO^1:30",DIR("?")="^D LIST^PSJPDRTR(.USER,.PLSTMSG,15)"
"RTN","PSJPDRUT",38,0)
 S DIR("A")="Select User: "_$S($D(SELUSER)>1:"",1:"^ALL//")
"RTN","PSJPDRUT",39,0)
 D ^DIR I X="" S Y=$S($D(SELUSER)<10:"ALL",1:"")
"RTN","PSJPDRUT",40,0)
 I $E(X)="^" S Y=$$XALL^PSJPDRIP(X)
"RTN","PSJPDRUT",41,0)
 I $G(DUOUT)!$G(DTOUT) S PSJSTOP=1 Q
"RTN","PSJPDRUT",42,0)
 I Y="ALL" M SELUSER=USER S SELUSER="ALL",PSJDONE=1 Q
"RTN","PSJPDRUT",43,0)
 I Y="" D  Q
"RTN","PSJPDRUT",44,0)
 .I $D(SELUSER)>1 S PSJDONE=1 Q
"RTN","PSJPDRUT",45,0)
 .W !!?2,"Select a single User, several Items or enter ^ALL to select all Items."
"RTN","PSJPDRUT",46,0)
 S PSJY=Y
"RTN","PSJPDRUT",47,0)
 I $D(USER(PSJY)) D  Q
"RTN","PSJPDRUT",48,0)
 .W "  ",USER(PSJY) S SELUSER(PSJY)=""
"RTN","PSJPDRUT",49,0)
 I $D(USERX(PSJY)) D  Q
"RTN","PSJPDRUT",50,0)
 .W "  ",USERX(PSJY) S SELUSER(USERX(PSJY))=""
"RTN","PSJPDRUT",51,0)
 S PSELMSG="Select a User"
"RTN","PSJPDRUT",52,0)
 S PSALLPC=1  ; return all data pieces from partial lookup
"RTN","PSJPDRUT",53,0)
 D PARTIAL^PSJPADPT(PSJY,.USER,.SELUSER,1,PSELMSG,,.PSFOUND,,PSALLPC)
"RTN","PSJPDRUT",54,0)
 Q:$G(PSFOUND)
"RTN","PSJPDRUT",55,0)
 W "  ?? (No match found)"
"RTN","PSJPDRUT",56,0)
 ;
"RTN","PSJPDRUT",57,0)
 Q
"RTN","PSJPDRUT",58,0)
 ;
"RTN","PSJPDRUT",59,0)
LIST(LIST,MSG) ; Write list in LIST(ID1)=ID1
"RTN","PSJPDRUT",60,0)
 N II,DRGNAME,NUMBER,TAB,NAME,ID1,ID2
"RTN","PSJPDRUT",61,0)
 S $P(TAB," ",80)=""
"RTN","PSJPDRUT",62,0)
 Q:$D(LIST)<10
"RTN","PSJPDRUT",63,0)
 I $L($G(MSG)) W !,MSG,!
"RTN","PSJPDRUT",64,0)
 I $D(MSG)>1 D  W !
"RTN","PSJPDRUT",65,0)
 .S II=0 F  S II=$O(MSG(II)) Q:'II  W !,MSG(II)
"RTN","PSJPDRUT",66,0)
 S ID1="" F  S ID1=$O(LIST(ID1)) Q:ID1=""  D
"RTN","PSJPDRUT",67,0)
 .I LIST(ID1)="" W !,$E(TAB,1,10)_ID1 Q
"RTN","PSJPDRUT",68,0)
 .W !,$E(TAB,1,14-$L(ID1))_ID1_"    "_$P(LIST(ID1),"^")_" "_$P(LIST(ID1),"^",2)
"RTN","PSJPDRUT",69,0)
 Q
"RTN","PSJPDRUT",70,0)
 ;
"RTN","PSJPDRUT",71,0)
USERLIST(PSJINP,USER,USERX) ; Get list of selectable users in transactions matching date range, PADE device, and drug item criteria
"RTN","PSJPDRUT",72,0)
 ;  INPUT: PSJINP("
"RTN","PSJPDRUT",73,0)
 ; OUTPUT: USER
"RTN","PSJPDRUT",74,0)
 ;
"RTN","PSJPDRUT",75,0)
 N PSJDEV,PADEV,PSDRG,PSJBDT,PSJEDT,PSJTRDT,TRANS,PSJDONE,PSUNAME,PSJII,PSJHTM,PSJDOTS
"RTN","PSJPDRUT",76,0)
 S PSJHTM=$P($H,",",2),PSJDOTS=""
"RTN","PSJPDRUT",77,0)
 K USER S PSJII=1
"RTN","PSJPDRUT",78,0)
 M PSJDEV=PSJINP("PADEV")
"RTN","PSJPDRUT",79,0)
 M PSDRG=PSJINP("PSDRG")
"RTN","PSJPDRUT",80,0)
 S PSJBDT=$G(PSJINP("PSJBDT"))
"RTN","PSJPDRUT",81,0)
 S PSJEDT=$G(PSJINP("PSJEDT"))
"RTN","PSJPDRUT",82,0)
 S USER="" F  S USER=$O(^PS(58.6,"USR",USER)) Q:USER=""  D
"RTN","PSJPDRUT",83,0)
 .S PSJTRDT=$$FMADD^XLFDT(PSJEDT,,,,1),PSJDONE=0
"RTN","PSJPDRUT",84,0)
 .D DISPDOTS^PSJPDRUT(.PSJHTM,.PSJDOTS,1)
"RTN","PSJPDRUT",85,0)
 .F  S PSJTRDT=$O(^PS(58.6,"USR",USER,PSJTRDT),-1) Q:(PSJTRDT<PSJBDT)!$G(PSJDONE)!(PSJTRDT="")  D
"RTN","PSJPDRUT",86,0)
 ..D DISPDOTS^PSJPDRUT(.PSJHTM,.PSJDOTS,1)
"RTN","PSJPDRUT",87,0)
 ..S TRANS=0 F  S TRANS=$O(^PS(58.6,"USR",USER,PSJTRDT,TRANS)) Q:'TRANS!$G(PSJDONE)  D
"RTN","PSJPDRUT",88,0)
 ...N CAB,SYS
"RTN","PSJPDRUT",89,0)
 ...S CAB=$P($G(^PS(58.6,+TRANS,0)),"^",2) I CAB]"" Q:'$D(PSJINP("PADEV",CAB))
"RTN","PSJPDRUT",90,0)
 ...S SYS=$P($G(^PS(58.6,+TRANS,1)),"^",3) I SYS]"" Q:SYS'=$G(PSJINP("PSJPSYSE"))
"RTN","PSJPDRUT",91,0)
 ...S PSUNAME=$P($G(^PS(58.6,+TRANS,5)),"^",2)
"RTN","PSJPDRUT",92,0)
 ...S:$TR(PSUNAME,",")="" PSUNAME="PADE,USER"
"RTN","PSJPDRUT",93,0)
 ...S USER(USER)=PSUNAME,USERX(PSUNAME)=USER
"RTN","PSJPDRUT",94,0)
 ...S PSJDONE=1,PSJII=PSJII+1
"RTN","PSJPDRUT",95,0)
 Q
"RTN","PSJPDRUT",96,0)
 ;
"RTN","PSJPDRUT",97,0)
DRUGSEL(PSJINP,INDRUG,OUTDRUG,DRWPCK,PSJSTOP) ; Select drug(s) via screened ^PSDRUG lookup
"RTN","PSJPDRUT",98,0)
 N COUNT,PSJCNT,DIR,X,Y,PSJDONE,DRGLIST,DRGNAME,PSJY,DRGN,PSJTMP,DUOUT,DTOUT
"RTN","PSJPDRUT",99,0)
 K DRWPCK
"RTN","PSJPDRUT",100,0)
 M DRGLIST=INDRUG
"RTN","PSJPDRUT",101,0)
 S COUNT=0,PSJDONE=0
"RTN","PSJPDRUT",102,0)
 D DRUGLIST^PSJPDRIN(.PSJINP,.DRGLIST)
"RTN","PSJPDRUT",103,0)
 I $D(DRGLIST)<10 D  Q
"RTN","PSJPDRUT",104,0)
 .S PSJSTOP=1
"RTN","PSJPDRUT",105,0)
 .W !!,"Drug Item: "
"RTN","PSJPDRUT",106,0)
 .W !," No Drug Items available for selection.."
"RTN","PSJPDRUT",107,0)
 .S DIR(0)="E" D ^DIR
"RTN","PSJPDRUT",108,0)
 W ! D EN^DDIOL("  Enter '^ALL' to select all available drug items ") W !
"RTN","PSJPDRUT",109,0)
 F  Q:$G(DUOUT)!$G(DTOUT)!$G(PSJDONE)  D
"RTN","PSJPDRUT",110,0)
 .N PSJPART,II
"RTN","PSJPDRUT",111,0)
 .N DIC,X,Y,PSJX
"RTN","PSJPDRUT",112,0)
 .S DIC="^PSDRUG(",DIC(0)="QEAZ",DIC("A")="Select Drug Item: "_$S($D(OUTDRUG)>1:"",1:"^ALL// ")
"RTN","PSJPDRUT",113,0)
 .S DIC("S")="I $D(DRGLIST(""IEN"",+Y))"
"RTN","PSJPDRUT",114,0)
 .D ^DIC S PSJX=X
"RTN","PSJPDRUT",115,0)
 .I $E(PSJX)="^" S Y=$$XALL^PSJPDRIP(PSJX)
"RTN","PSJPDRUT",116,0)
 .I $G(DUOUT)!$G(DTOUT) S PSJSTOP=1 Q
"RTN","PSJPDRUT",117,0)
 .I Y=-1 S Y=$S($D(OUTDRUG)>1:"",1:"ALL")
"RTN","PSJPDRUT",118,0)
 .I Y="" D  Q
"RTN","PSJPDRUT",119,0)
 ..I $D(OUTDRUG)>1 S PSJDONE=1 Q
"RTN","PSJPDRUT",120,0)
 ..W !!?2,"Select a single Item, several Items or enter ^ALL to select all Items."
"RTN","PSJPDRUT",121,0)
 .S PSJY=Y
"RTN","PSJPDRUT",122,0)
 .I PSJY,$D(DRGLIST("IEN",+PSJY)) D  Q
"RTN","PSJPDRUT",123,0)
 ..W "  ",DRGLIST("IEN",+PSJY)
"RTN","PSJPDRUT",124,0)
 ..S OUTDRUG(+PSJY)=$P($G(^PSDRUG(+PSJY,0)),"^")
"RTN","PSJPDRUT",125,0)
 ..I $G(PSJINP("MANUNLOD")) D POCKET^PSJPDRIN(.PSJINP,+PSJY,.DRWPCK) S PSJDONE=1
"RTN","PSJPDRUT",126,0)
 .I PSJX="",($D(OUTDRUG)<10) S Y="ALL"
"RTN","PSJPDRUT",127,0)
 .I PSJX="",($D(OUTDRUG)>1) S PSJDONE=1
"RTN","PSJPDRUT",128,0)
 .I PSJY="ALL" S OUTDRUG="ALL",PSJDONE=1 D  Q
"RTN","PSJPDRUT",129,0)
 ..I $G(PSJINP("MANUNLOD")) S DRWPCK="ALL" Q
"RTN","PSJPDRUT",130,0)
 ..N DRGIEN S DRGIEN=0 F  S DRGIEN=$O(INDRUG(DRGIEN)) Q:'DRGIEN  S OUTDRUG(DRGIEN)=$P($G(^PSDRUG(+DRGIEN,0)),"^")
"RTN","PSJPDRUT",131,0)
 Q
"RTN","PSJPDRUT",132,0)
 ;
"RTN","PSJPDRUT",133,0)
PSYS(PSLAYGO) ; Get PADE Inventory System
"RTN","PSJPDRUT",134,0)
 N PSYSIEN,PSYSCNT,PSYS,DIR,X,Y,PSYSLST,LISTDIR
"RTN","PSJPDRUT",135,0)
 S PSYSIEN=0 F PSYSCNT=0:1 S PSYSIEN=$O(^PS(58.601,PSYSIEN)) Q:'PSYSIEN  D
"RTN","PSJPDRUT",136,0)
 .S PSYS=PSYSIEN
"RTN","PSJPDRUT",137,0)
 .S PSYSLST(PSYSIEN)=$$UPPER^HLFNC($P($G(^PS(58.601,PSYSIEN,0)),"^"))_"      "_$P($G(^PS(58.601,+PSYS,4)),"^")
"RTN","PSJPDRUT",138,0)
 .S PSYSLSTX(PSYSCNT+1)=PSYSLST(PSYSIEN)_"^"_PSYSIEN
"RTN","PSJPDRUT",139,0)
 .S LISTDIR=$G(LISTDIR)_$S($G(PSYSCNT):";",1:"")_(PSYSCNT+1)_":"_PSYSLST(PSYSIEN)
"RTN","PSJPDRUT",140,0)
 I 'PSYSCNT D  Q ""
"RTN","PSJPDRUT",141,0)
 .S PSJSTOP=-1
"RTN","PSJPDRUT",142,0)
 .D EN^DDIOL("No PADE Inventory data on file")
"RTN","PSJPDRUT",143,0)
 .N DIR S DIR(0)="EA",DIR("A")="Press Return to Continue... " D ^DIR
"RTN","PSJPDRUT",144,0)
 I PSYSCNT=1 S DIR("B")=$P($G(^PS(58.601,+PSYS,0)),"^")
"RTN","PSJPDRUT",145,0)
 S DIR(0)="SAO^"_LISTDIR
"RTN","PSJPDRUT",146,0)
 S DIR("A")="Select PADE Inventory System: "
"RTN","PSJPDRUT",147,0)
 D ^DIR
"RTN","PSJPDRUT",148,0)
 S PSYS=$S(Y>0:+Y,1:"") S:PSYS="" PSJSTOP=-1
"RTN","PSJPDRUT",149,0)
 I +$G(PSYS) S PSYS=$P(PSYSLSTX(PSYS),"^",2) S:PSYS="" PSJSTOP=-1
"RTN","PSJPDRUT",150,0)
 Q PSYS
"RTN","PSJPDRUT",151,0)
 ;
"RTN","PSJPDRUT",152,0)
ENSYS() ; Get PADE Inventory System
"RTN","PSJPDRUT",153,0)
 N PSYSIEN,PSYSCNT,PSYS,DIR,X,Y,PSYSLST,LISTDIR,PSYSNAM,PSYSALT
"RTN","PSJPDRUT",154,0)
 K PSJSTOP
"RTN","PSJPDRUT",155,0)
 F  Q:$G(PSYS)!$G(PSJSTOP)  D
"RTN","PSJPDRUT",156,0)
 .D GETSYS(.PSYSLST,.PSYSLSTX,.PSYSNAM,.PSYSALT)
"RTN","PSJPDRUT",157,0)
 .D SELSYS(.PSYSLST,.PSYSLSTX,.PSYSNAM,.PSYS)
"RTN","PSJPDRUT",158,0)
 Q PSYS
"RTN","PSJPDRUT",159,0)
 ;
"RTN","PSJPDRUT",160,0)
PTIX(PS586IEN,PSJOMS)  ; Computed PATIENT to handle blank patients in "P" x-ref in Transaction file 586
"RTN","PSJPDRUT",161,0)
 N PATIENT
"RTN","PSJPDRUT",162,0)
 S PATIENT=$P($G(^PS(58.6,+$G(PS586IEN),0)),"^",15)
"RTN","PSJPDRUT",163,0)
 I '$G(PATIENT) S PATIENT=$G(FDA(58.6,"+1,",14))
"RTN","PSJPDRUT",164,0)
 I '$G(PATIENT) S PATIENT=$G(PSJOMS("DFN"))
"RTN","PSJPDRUT",165,0)
 Q:$G(PATIENT) PATIENT
"RTN","PSJPDRUT",166,0)
 Q "zz"
"RTN","PSJPDRUT",167,0)
 ;
"RTN","PSJPDRUT",168,0)
DRGIX(PS586IEN,PSJOMS)  ; Computed DRUG ID to handle unknown drugs in "P" x-ref in Transaction file 58.6
"RTN","PSJPDRUT",169,0)
 I $P($G(^PS(58.6,+$G(PS586IEN),0)),"^",3) Q $P(^(0),"^",3)
"RTN","PSJPDRUT",170,0)
 I $P($G(^PS(58.6,+$G(PS586IEN),1)),"^",6)]"" Q "zz~"_$P(^(0),"^",6)
"RTN","PSJPDRUT",171,0)
 I $G(FDA(58.6,"+1,",2)) Q +$G(FDA(58.6,"+1,",2))
"RTN","PSJPDRUT",172,0)
 I $G(PSJOMS("DRGTXT"))]"" Q "zz~"_$G(PSJOMS("DRGTXT"))
"RTN","PSJPDRUT",173,0)
 Q "zz~UNKNOWN"
"RTN","PSJPDRUT",174,0)
 ;
"RTN","PSJPDRUT",175,0)
DISPDOTS(PSJHTM,PSJDOTS,SECONDS) ; Check to see if more than SECONDS seconds has elapsed in $H, since PSJHTM. 
"RTN","PSJPDRUT",176,0)
 ; INPUT - PSJHTM = the 2nd comma piece of $H (seconds)
"RTN","PSJPDRUT",177,0)
 ;         PSJDOTS = flag indicating whether initial message "Searching for matching transactions.." has (1) or has not 0 or "" already been displayed
"RTN","PSJPDRUT",178,0)
 I '$G(PSJHTM) S PSJHTM=$P($H,",",2)
"RTN","PSJPDRUT",179,0)
 I ($P($H,",",2)-PSJHTM)>1 D
"RTN","PSJPDRUT",180,0)
 .I '$G(PSJDOTS) W !?2,"Searching for matching transactions.." S PSJDOTS=1,PSJHTM=$P($H,",",2)
"RTN","PSJPDRUT",181,0)
 .W "." S PSJHTM=$P($H,",",2)
"RTN","PSJPDRUT",182,0)
 Q
"RTN","PSJPDRUT",183,0)
 ;
"RTN","PSJPDRUT",184,0)
PADEUP(PADEV,PADEVUP)  ; Return PADEVUP array, containing subscripts converted to upper case from incoming PADEV array
"RTN","PSJPDRUT",185,0)
 N PADE
"RTN","PSJPDRUT",186,0)
 S PADE="" F  S PADE=$O(PADEV(PADE)) Q:PADE=""  S PADEVUP($$UPPER^HLFNC(PADE))=PADEV(PADE)
"RTN","PSJPDRUT",187,0)
 Q
"RTN","PSJPDRUT",188,0)
 ;
"RTN","PSJPDRUT",189,0)
DIV(PSJDIV,PSJSTOP)  ; Perform manual entry and validation of DIVISION (40.8)
"RTN","PSJPDRUT",190,0)
 N PSJDONE,DIR,X,Y,DIVAR,DIVARX,PSJY,PSALLPC
"RTN","PSJPDRUT",191,0)
 K PSJDIV
"RTN","PSJPDRUT",192,0)
 D DIVLIST(.DIVAR,.DIVARX)
"RTN","PSJPDRUT",193,0)
 S PSJDIV=""
"RTN","PSJPDRUT",194,0)
 F  Q:$G(PSJSTOP)!$G(PSJDONE)  D
"RTN","PSJPDRUT",195,0)
 .N PSJTMP
"RTN","PSJPDRUT",196,0)
 .S DIR(0)="FAO^1:30",DIR("?")="^D DIVLKUP^PSJPDRUT(.DIVAR)"
"RTN","PSJPDRUT",197,0)
 .S DIR("A")="Select Division: "_$S($D(PSJDIV)>1:"",1:" ^ALL// ")
"RTN","PSJPDRUT",198,0)
 .D ^DIR I $E(X)="^" S Y=$$XALL^PSJPDRIP(X)
"RTN","PSJPDRUT",199,0)
 .I X="",($D(PSJDIV)<10) S Y="ALL"
"RTN","PSJPDRUT",200,0)
 .I Y="ALL" M PSJDIV=DIVAR S PSJDIV="ALL",PSJINP("PSJDIV")="ALL",PSJDONE=1 Q
"RTN","PSJPDRUT",201,0)
 .I $G(DUOUT)!$G(DTOUT) S PSJSTOP=1 Q
"RTN","PSJPDRUT",202,0)
 .I Y="" D  Q
"RTN","PSJPDRUT",203,0)
 ..I $D(PSJDIV)>1 S PSJDONE=1 Q
"RTN","PSJPDRUT",204,0)
 ..W !!?2,"Select a single Division, several Divisions or enter ^ALL to select all Divisions."
"RTN","PSJPDRUT",205,0)
 .S PSJY=Y
"RTN","PSJPDRUT",206,0)
 .I $D(DIVAR(PSJY)) D  Q
"RTN","PSJPDRUT",207,0)
 ..N DIVIEN,PSALLPC
"RTN","PSJPDRUT",208,0)
 ..S PSALLPC=1   ; return all data pieces from partial lookup
"RTN","PSJPDRUT",209,0)
 ..S DIVIEN=$P(DIVAR(PSJY),"^",2)
"RTN","PSJPDRUT",210,0)
 ..Q:'DIVIEN  S PSJDIV(DIVIEN)=DIVAR(PSJY)
"RTN","PSJPDRUT",211,0)
 ..W "  ",PSJY,"  ",$P(DIVAR(PSJY),"^")
"RTN","PSJPDRUT",212,0)
 .I $D(DIVARX(PSJY)) D  Q
"RTN","PSJPDRUT",213,0)
 ..N DIVIEN S DIVIEN=$P(DIVAR(DIVARX(PSJY)),"^",2)
"RTN","PSJPDRUT",214,0)
 ..Q:'DIVIEN  S PSJDIV(DIVIEN)=PSJY
"RTN","PSJPDRUT",215,0)
 ..W "  ",PSJY,"  ",DIVAR(PSJY)
"RTN","PSJPDRUT",216,0)
 .S PSELMSG="Select a Division"
"RTN","PSJPDRUT",217,0)
 .S PSALLPC=1  ; Return all data pieces from partial lookup
"RTN","PSJPDRUT",218,0)
 .D PARTIAL^PSJPADPT(PSJY,.DIVARX,.PSJTMP,,PSELMSG,.DIVAR,.PSFOUND,,PSALLPC)
"RTN","PSJPDRUT",219,0)
 .I $G(PSFOUND) N PSDIV,DIVIEN S PSDIV=$O(PSJTMP("")) I PSDIV]"" S DIVIEN=$P($G(PSJTMP(PSDIV)),"^",2) I DIVIEN S PSJDIV(DIVIEN)=PSDIV_"^"_DIVIEN
"RTN","PSJPDRUT",220,0)
 .Q:$G(PSFOUND)
"RTN","PSJPDRUT",221,0)
 .W "  ?? (No match found)"
"RTN","PSJPDRUT",222,0)
 Q
"RTN","PSJPDRUT",223,0)
 ;
"RTN","PSJPDRUT",224,0)
DIVLKUP(DIVAR)  ; Lookup Division
"RTN","PSJPDRUT",225,0)
 D LIST^PSJPDRTR(.DIVAR,,15)
"RTN","PSJPDRUT",226,0)
 Q
"RTN","PSJPDRUT",227,0)
 ;
"RTN","PSJPDRUT",228,0)
DIVLIST(DIVAR,DIVARX)  ; Get list of Divisions
"RTN","PSJPDRUT",229,0)
 N DIVNAM,DIVIEN,DIVCNT
"RTN","PSJPDRUT",230,0)
 S DIVNAM="" F DIVCNT=1:1 S DIVNAM=$O(^DG(40.8,"B",DIVNAM)) Q:DIVNAM=""  D
"RTN","PSJPDRUT",231,0)
 .S DIVIEN=$O(^DG(40.8,"B",DIVNAM,0))
"RTN","PSJPDRUT",232,0)
 .S DIVAR(DIVIEN)=DIVNAM_"^"_DIVIEN,DIVARX(DIVNAM)=DIVIEN
"RTN","PSJPDRUT",233,0)
 Q
"RTN","PSJPDRUT",234,0)
 ;
"RTN","PSJPDRUT",235,0)
UPPER(PSTEXT)  ; Convert X to upper case
"RTN","PSJPDRUT",236,0)
 N X,Y
"RTN","PSJPDRUT",237,0)
 S PSTEXT=$$UPPER^HLFNC(PSTEXT)
"RTN","PSJPDRUT",238,0)
 Q PSTEXT
"RTN","PSJPDRUT",239,0)
 ;
"RTN","PSJPDRUT",240,0)
GETSYS(PSYSLST,PSYSLSTX,PSYSNAM,PSYSALT)  ; Get list of PADE Inventory Systems from file 58.601
"RTN","PSJPDRUT",241,0)
 ;
"RTN","PSJPDRUT",242,0)
 N PSYSIEN,PSYSCNT
"RTN","PSJPDRUT",243,0)
 K PSYSLST,PSYSLSTX,PSYSNAM,PSYSALT,PSUPPER
"RTN","PSJPDRUT",244,0)
 S PSYSIEN=0 F PSYSCNT=0:1 S PSYSIEN=$O(^PS(58.601,PSYSIEN)) Q:'PSYSIEN  D
"RTN","PSJPDRUT",245,0)
 .S PSYS=PSYSIEN
"RTN","PSJPDRUT",246,0)
 .S PSYSLST("IEN",PSYSIEN)=$P($G(^PS(58.601,PSYSIEN,0)),"^")
"RTN","PSJPDRUT",247,0)
 .S PSYSLST("NAME",PSYSLST("IEN",PSYSIEN))=PSYSIEN
"RTN","PSJPDRUT",248,0)
 .S PSYSLSTX(PSYSCNT+1)=PSYSLST("IEN",PSYSIEN)_"    "_$P($G(^PS(58.601,+PSYSIEN,4)),"^")_"^"_PSYSIEN
"RTN","PSJPDRUT",249,0)
 .S PSYSNAM(PSYSLST("IEN",PSYSIEN))=PSYSIEN
"RTN","PSJPDRUT",250,0)
 .S PSYSALT=$P($G(^PS(58.601,+PSYSIEN,4)),"^") I PSYSALT]"" S PSYSNAM($$UPPER^PSJPDRUT(PSYSALT))=PSYSIEN
"RTN","PSJPDRUT",251,0)
 Q
"RTN","PSJPDRUT",252,0)
 ;
"RTN","PSJPDRUT",253,0)
SELSYS(PSYSLST,PSYSLTX,PSYSNAM,PSYS)  ; Select dispensing system for editing
"RTN","PSJPDRUT",254,0)
 ; Input:   PSYSLST   - list of dispensing systems, PSYSLST("IEN",IEN)=name, PSYSLST("NAME",name)=IEN
"RTN","PSJPDRUT",255,0)
 ;          PSYSLSTX  - list of dispensing systems, PSYSLSTX(list#)=name
"RTN","PSJPDRUT",256,0)
 ;          PSYSNAM   - list of dispensing systems, PSYSNAM(name)=list#
"RTN","PSJPDRUT",257,0)
 ; Output:  PSYS  - IEN of dispensing system in file 58.601
"RTN","PSJPDRUT",258,0)
 N PSJY,PSFOUND,PSALLPC
"RTN","PSJPDRUT",259,0)
 K PSYS S PSYS=""
"RTN","PSJPDRUT",260,0)
 S DIR(0)="FAO",DIR("?")="^D LIST^PSJPDRTR(.PSYSLSTX,,15)"
"RTN","PSJPDRUT",261,0)
 S DIR("A")="Select PADE Inventory System: "
"RTN","PSJPDRUT",262,0)
 D ^DIR
"RTN","PSJPDRUT",263,0)
 ;
"RTN","PSJPDRUT",264,0)
 I $G(DUOUT)!$G(DTOUT) S PSJSTOP=1 Q
"RTN","PSJPDRUT",265,0)
 I Y=""!($TR(Y," ")="")!(Y["^") D  Q
"RTN","PSJPDRUT",266,0)
 .W !!?2,"Select a PADE Dispensing Inventory system or '^' to exit."
"RTN","PSJPDRUT",267,0)
 S PSJY=Y
"RTN","PSJPDRUT",268,0)
 I $D(PSYSLSTX(+PSJY)) D  Q
"RTN","PSJPDRUT",269,0)
 .W "  ",$P(PSYSLSTX(+PSJY),"^")
"RTN","PSJPDRUT",270,0)
 .S PSYS=$P(PSYSLSTX(+PSJY),"^",2)
"RTN","PSJPDRUT",271,0)
 I $D(PSYSNAM(PSJY)) D  Q
"RTN","PSJPDRUT",272,0)
 .W "  ",PSYSNAM(PSJY)
"RTN","PSJPDRUT",273,0)
 .S PSYS=PSYSNAM(PSJY)
"RTN","PSJPDRUT",274,0)
 I $D(PSYSALT(PSJY)) D  Q
"RTN","PSJPDRUT",275,0)
 .W "  ",PSYSLST(PSYSALT(PSJY))
"RTN","PSJPDRUT",276,0)
 .S PSYS=PSYSALT(PSJY)
"RTN","PSJPDRUT",277,0)
 S PSALLPC=1  ; return all data pieces from partial lookup
"RTN","PSJPDRUT",278,0)
 D PARTIAL^PSJPADPT(.PSJY,.PSYSNAM,.PSJY,1,,.PSYSLSTX,.PSFOUND,,PSALLPC)
"RTN","PSJPDRUT",279,0)
 I '$G(PSFOUND),($G(PSJY)]"") D  Q
"RTN","PSJPDRUT",280,0)
 .N DIR,X,Y,FDA
"RTN","PSJPDRUT",281,0)
 .S DIR("A")="  Are you adding '"_PSJY_"' as a new PADE INVENTORY SYSTEM? "
"RTN","PSJPDRUT",282,0)
 .S DIR(0)="YAO",DIR("B")="N" D ^DIR Q:'Y
"RTN","PSJPDRUT",283,0)
 .S FDA(58.601,"?+1,",.01)=PSJY
"RTN","PSJPDRUT",284,0)
 .D UPDATE^DIE("E","FDA","PSYS","ERR")
"RTN","PSJPDRUT",285,0)
 .S PSYS=$S($G(PSYS(1)):+$G(PSYS(1)),1:"")
"RTN","PSJPDRUT",286,0)
 I $G(PSFOUND) S PSYS=$O(PSJY(0)),PSYS=+$G(PSYSNAM(PSYS)) I 'PSYS S PSYS=+$G(PSYSLST("NAME",PSYS))
"RTN","PSJPDRUT",287,0)
 Q
"RTN","PSJPDRUT",288,0)
 ;
"RTN","PSJPDRUT",289,0)
PADEUSR(PSJPSYS,PSJPDUSR) ; Return Vista user ID for PADE user PSJPDUSER, if it exists
"RTN","PSJPDRUT",290,0)
 N PSJSYSE,PSJVUSR,PSJVAL,PSJRSLT,PADUIEN
"RTN","PSJPDRUT",291,0)
 Q:$G(PSJPSYS)="" ""
"RTN","PSJPDRUT",292,0)
 Q:$G(PSJPDUSR)="" ""
"RTN","PSJPDRUT",293,0)
 S PSJSYSE=$P($G(^PS(58.601,+PSJPSYS,0)),"^")
"RTN","PSJPDRUT",294,0)
 Q:PSJSYSE="" ""
"RTN","PSJPDRUT",295,0)
 S PSJVAL(1)=PSJSYSE
"RTN","PSJPDRUT",296,0)
 S PSJVAL(2)=PSJPDUSR
"RTN","PSJPDRUT",297,0)
 S PSJVUSR=$$FIND1^DIC(58.64,,"K",.PSJVAL)
"RTN","PSJPDRUT",298,0)
 Q:'PSJVUSR ""
"RTN","PSJPDRUT",299,0)
 S PADUIEN=+$G(PSJVUSR)
"RTN","PSJPDRUT",300,0)
 D GETS^DIQ(58.64,+PSJVUSR,"2","IE","PSJRSLT")
"RTN","PSJPDRUT",301,0)
 S PSJVUSR=+$G(PSJRSLT(58.64,PSJVUSR_",",2,"I"))_"^"_$G(PSJRSLT(58.64,PSJVUSR_",",2,"E"))_"^"_PADUIEN
"RTN","PSJPDRUT",302,0)
 Q PSJVUSR
"RTN","PSJPDRUT",303,0)
 ;
"RTN","PSJPDRUT",304,0)
DEVSCRN(PSJINP,PSPDIEN)  ; Screen PADE cabinet PSPDIEN (file 58.63) 
"RTN","PSJPDRUT",305,0)
 ; Compare PSJINP("PSJPSYS") to System Field (#1)(#58.63)
"RTN","PSJPDRUT",306,0)
 ; and     PSJINP("PSJDIV") to Division Field (#2) (58.63)
"RTN","PSJPDRUT",307,0)
 ; Manually coded version of screen S PSJSCR="I $D(PSJINP(""PSJDIV"",+$G(^(2))))&($P($G(^(0)),""^"",2)=PSJPSYS)&'$$EMPTY^PSJPADPT(+Y)"
"RTN","PSJPDRUT",308,0)
 N PADEOK,DIVIEN,DIVNAME,SYSIEN,DIVTMP,DIVOK
"RTN","PSJPDRUT",309,0)
 S PADEOK=1
"RTN","PSJPDRUT",310,0)
 S DIVIEN=$P($G(^PS(58.63,+$G(PSPDIEN),2)),"^")
"RTN","PSJPDRUT",311,0)
 S DIVNAME=$P($G(^DG(40.8,+DIVIEN,0)),"^")
"RTN","PSJPDRUT",312,0)
 I DIVNAME="" Q 0  ; No division on file for cabinet, quit
"RTN","PSJPDRUT",313,0)
 ; Division doesn't match any in PSJINP("PSJDIV"), quit
"RTN","PSJPDRUT",314,0)
 S DIVOK=0 S DIVTMP="" F  S DIVTMP=$O(PSJINP("PSJDIV",DIVTMP)) Q:DIVTMP=""!$G(DIVOK)  I $P($G(PSJINP("PSJDIV",DIVTMP)),"^",2)=DIVIEN S DIVOK=1
"RTN","PSJPDRUT",315,0)
 Q:'DIVOK 0
"RTN","PSJPDRUT",316,0)
 ; System doesn't match PSJINP("PSJPSYS"), quit
"RTN","PSJPDRUT",317,0)
 S SYSIEN=$P($G(^PS(58.63,+$G(PSPDIEN),0)),"^",2)
"RTN","PSJPDRUT",318,0)
 I SYSIEN'=+$G(PSJINP("PSJPSYS")) Q 0
"RTN","PSJPDRUT",319,0)
 ; Cabinet is empty, quit
"RTN","PSJPDRUT",320,0)
 Q:$$EMPTY^PSJPADPT(+PSPDIEN) 0
"RTN","PSJPDRUT",321,0)
 Q PADEOK
"RTN","PSJPDRUT",322,0)
 ;
"RTN","PSJPDRUT",323,0)
UNIQUE(PSJY,PADE)   ; Is PSJY unique subscript in PADE(), or are there other partial matches (PADE(PSJY), PADE(PSJYnn), PADE(PSJYxx), etc)?
"RTN","PSJPDRUT",324,0)
 N NEXTSUB,PSJYLEN
"RTN","PSJPDRUT",325,0)
 I $G(PSJY)="" Q 1
"RTN","PSJPDRUT",326,0)
 I $D(PADE)<10 Q 1
"RTN","PSJPDRUT",327,0)
 S NEXTSUB=$O(PADE(PSJY))
"RTN","PSJPDRUT",328,0)
 S PSJYLEN=$L(PSJY)
"RTN","PSJPDRUT",329,0)
 I $E(NEXTSUB,1,PSJYLEN)=PSJY Q 0
"RTN","PSJPDRUT",330,0)
 Q 1
"RTN","PSJPDRUT",331,0)
 ;
"RTN","PSJPDRUT",332,0)
PSB(PSJOMS)  ; Get Patient Specific Bin info
"RTN","PSJPDRUT",333,0)
 ;
"RTN","PSJPDRUT",334,0)
 N PSPADFN,PSPADNM,PSPADPK
"RTN","PSJPDRUT",335,0)
 I (PSJOMS("COMMENT")'["PATIENT SPECIFIC BIN") Q
"RTN","PSJPDRUT",336,0)
 N PSSN S PSSN=$P(PSJOMS("COMMENT"),"-",2)
"RTN","PSJPDRUT",337,0)
 I $G(PSSN) S PSPADFN=$$PATSSN(PSSN) I $G(PSPADFN) S PSJOMS("SSN")=PSSN,PSJOMS("DFN")=PSPADFN
"RTN","PSJPDRUT",338,0)
 I $G(PSPADFN) S PSPADNM=$P($G(^DPT(+PSPADFN,0)),"^")
"RTN","PSJPDRUT",339,0)
 I ($G(PSPADNM)'="") S (PSJOMS("DFN"),PSJOMS("PTID"))=PSPADFN D
"RTN","PSJPDRUT",340,0)
 .S PSJOMS("PTNAMA")=$P(PSPADNM,",")
"RTN","PSJPDRUT",341,0)
 .S PSJOMS("PTNAMB")=$P(PSPADNM,",",2)
"RTN","PSJPDRUT",342,0)
 S PSPADPK=$G(PSJOMS("PKT"))
"RTN","PSJPDRUT",343,0)
 S PSJOMS("PKT")=PSJOMS("PKT")_"PSB"
"RTN","PSJPDRUT",344,0)
 Q
"RTN","PSJPDRUT",345,0)
 ;
"RTN","PSJPDRUT",346,0)
PATSSN(PSSN)  ; If valid PSSN patient SSN, return patient PDFN pointer to ^DPT
"RTN","PSJPDRUT",347,0)
 N PSVAL,PSINDEX,PSJDFN
"RTN","PSJPDRUT",348,0)
 S PSJDFN=""
"RTN","PSJPDRUT",349,0)
 I $G(PSSN) S (X,PSVAL)=PSSN,PSINDEX="SSN" S PSJDFN=$$FIND1^DIC(2,,"X",PSVAL,PSINDEX,,"PSERR")
"RTN","PSJPDRUT",350,0)
 I '$G(PSJDFN),$G(PSSN) S PSJDFN=$O(^DPT("SSN",PSSN,""))
"RTN","PSJPDRUT",351,0)
 I '$G(PSJDFN),$G(PSSN) N TMPSSN S TMPSSN=$TR($J(+PSSN,9)," ",0) S PSJDFN=$O(^DPT("SSN",TMPSSN,""))
"RTN","PSJPDRUT",352,0)
 I 'PSJDFN S PSJDFN=""
"RTN","PSJPDRUT",353,0)
 I PSJDFN I '$D(^DPT(PSJDFN)) S PSJDFN=""
"RTN","PSJPDRUT",354,0)
 Q PSJDFN
"RTN","PSJPDRUT",355,0)
 ;
"RTN","PSJPDRUT",356,0)
TTYPDIR(PSJPSYS,BDT,EDT)  ; build DIR(0) string of selectable transaction types
"RTN","PSJPDRUT",357,0)
 N TTYPDIR,TTARRAY,TT,II
"RTN","PSJPDRUT",358,0)
 Q:'$G(PSJPSYS) ""
"RTN","PSJPDRUT",359,0)
 Q:'$D(^PS(58.601,+PSJPSYS,0)) ""
"RTN","PSJPDRUT",360,0)
 D TTYPES(PSJPSYS,BDT,EDT,.TTARRAY)
"RTN","PSJPDRUT",361,0)
 S TTYPDIR=""
"RTN","PSJPDRUT",362,0)
 S TT="" F II=1:1 S TT=$O(TTARRAY(TT)) Q:TT=""  D
"RTN","PSJPDRUT",363,0)
 .N TTYPNAM
"RTN","PSJPDRUT",364,0)
 .S TTYPNAM=TT
"RTN","PSJPDRUT",365,0)
 .I II=1 S TTYPDIR="1:"_TTYPNAM
"RTN","PSJPDRUT",366,0)
 .I II>1 S TTYPDIR=TTYPDIR_";"_II_":"_TTYPNAM
"RTN","PSJPDRUT",367,0)
 Q TTYPDIR
"RTN","PSJPDRUT",368,0)
 ;
"RTN","PSJPDRUT",369,0)
TTYPES(PSJPSYS,BDT,EDT,OUTTYP)  ; Get list of all transaction Types for system PSJPSYS between begin date BDT and end date EDT
"RTN","PSJPDRUT",370,0)
 N TDT,SYSNAM,TDEV,TXIEN
"RTN","PSJPDRUT",371,0)
 K OUTTYP
"RTN","PSJPDRUT",372,0)
 S SYSNAM=$P($G(^PS(58.601,+$G(PSJPSYS),0)),"^")
"RTN","PSJPDRUT",373,0)
 S TDT=$$FMADD^XLFDT(BDT,,,-.1)
"RTN","PSJPDRUT",374,0)
 F  S TDT=$O(^PS(58.6,"B",TDT)) Q:(TDT="")!(TDT>EDT)  S TXIEN=0 F  S TXIEN=$O(^PS(58.6,"B",TDT,TXIEN)) Q:'TXIEN  D
"RTN","PSJPDRUT",375,0)
 .N TT
"RTN","PSJPDRUT",376,0)
 .Q:($P($G(^PS(58.6,TXIEN,1)),"^",3)'=SYSNAM)
"RTN","PSJPDRUT",377,0)
 .S TT=$P($G(^PS(58.6,TXIEN,0)),"^",5) Q:TT=""
"RTN","PSJPDRUT",378,0)
 .S TTYPNAM=$$TTEX(TT)
"RTN","PSJPDRUT",379,0)
 .Q:$D(OUTTYP(TTYPNAM))
"RTN","PSJPDRUT",380,0)
 .Q:'(",D,L,R,F,U,E,C,R,W,B,V,")[(","_TT_",")
"RTN","PSJPDRUT",381,0)
 .S OUTTYP(TTYPNAM)=""
"RTN","PSJPDRUT",382,0)
 Q
"RTN","PSJPDRUT",383,0)
 ;
"RTN","PSJPDRUT",384,0)
DEFTRAN(DEFTRAN)  ; Get default list of ALL transaction types if none were found in transaction file
"RTN","PSJPDRUT",385,0)
 N II,TTYPNAM,TRANLIST,TTYPCOD
"RTN","PSJPDRUT",386,0)
 S TRANLIST="V:Dispense,L:Load,U:Unload,F:Fill/Refill,B:Empty Bin,C:Count,R:Return,W:Waste,E:Expired,A:Discrepancy"
"RTN","PSJPDRUT",387,0)
 N II F II=1:1:$L(TRANLIST,",") S II=$P(TRANLIST,",",II) Q:II=""  D
"RTN","PSJPDRUT",388,0)
 .S TTYPCOD=$P(II,":"),TTYPNAM=$P(II,":",2)
"RTN","PSJPDRUT",389,0)
 .S DEFTRAN(TTYPNAM)=TTYPCOD
"RTN","PSJPDRUT",390,0)
 Q
"RTN","PSJPDRUT",391,0)
 ;
"RTN","PSJPDRUT",392,0)
TTEX(TTCODE)  ; Convert Transaction Type code to Type Name
"RTN","PSJPDRUT",393,0)
 N TTNAME,TT
"RTN","PSJPDRUT",394,0)
 S TT=$$UPPER^PSJPDRUT($G(TTCODE))
"RTN","PSJPDRUT",395,0)
 S TTNAME=$S(TT="V":"Dispense",TT="L":"Load",TT="U":"Unload",TT="F":"Refill",TT="B":"Empty Bin",TT="C":"Count",TT="R":"Return",TT="W":"Waste",TT="E":"Expired",TT="D":"Destock",TT="A":"Discrepancy",TT="N":"Cancel",1:"Other")
"RTN","PSJPDRUT",396,0)
 Q TTNAME
"RTN","PSJPDRUT",397,0)
 ;
"RTN","PSJPDRUT",398,0)
EXTT(TTNAME)  ; Convert Transaction Type Name to Type Code
"RTN","PSJPDRUT",399,0)
 N TTCODE,TT
"RTN","PSJPDRUT",400,0)
 S TT=$$UPPER^PSJPDRUT($G(TTNAME))
"RTN","PSJPDRUT",401,0)
 S:TT="" TT="OTHER"
"RTN","PSJPDRUT",402,0)
 S TTCODE=$P($T(@($E($P(TT," "),1,8)_"^PSJPDRUT")),";;",2)
"RTN","PSJPDRUT",403,0)
 S:TTCODE="" TTCODE="O"
"RTN","PSJPDRUT",404,0)
 Q TTCODE
"RTN","PSJPDRUT",405,0)
 ;
"RTN","PSJPDRUT",406,0)
DISPENSE ;;V
"RTN","PSJPDRUT",407,0)
VEND ;;V
"RTN","PSJPDRUT",408,0)
LOAD ;;L
"RTN","PSJPDRUT",409,0)
UNLOAD ;;U
"RTN","PSJPDRUT",410,0)
REFILL ;;F
"RTN","PSJPDRUT",411,0)
EMPTY ;;B
"RTN","PSJPDRUT",412,0)
COUNT ;;C
"RTN","PSJPDRUT",413,0)
RETURN ;;R
"RTN","PSJPDRUT",414,0)
WASTE ;;W
"RTN","PSJPDRUT",415,0)
EXPIRED ;;E
"RTN","PSJPDRUT",416,0)
DESTOCK ;;D
"RTN","PSJPDRUT",417,0)
DISCREPA ;;A
"RTN","PSJPDRUT",418,0)
CANCEL ;;N
"RTN","PSJPDRUT",419,0)
UNKNOWN ;;O
"RTN","PSJPDRUT",420,0)
OTHER ;;O
"RTN","PSJPDRUT",421,0)
 Q
"SEC","^DD",58.601,58.601,1,9)

"SEC","^DIC",58.6,58.6,0,"AUDIT")

"SEC","^DIC",58.6,58.6,0,"DD")

"SEC","^DIC",58.6,58.6,0,"DEL")

"SEC","^DIC",58.6,58.6,0,"LAYGO")

"SEC","^DIC",58.6,58.6,0,"RD")

"SEC","^DIC",58.6,58.6,0,"WR")

"SEC","^DIC",58.601,58.601,0,"AUDIT")

"SEC","^DIC",58.601,58.601,0,"DD")

"SEC","^DIC",58.601,58.601,0,"DEL")
 
"SEC","^DIC",58.601,58.601,0,"LAYGO")
 
"SEC","^DIC",58.601,58.601,0,"RD")
 
"SEC","^DIC",58.601,58.601,0,"WR")
 
"SEC","^DIC",58.63,58.63,0,"AUDIT")
@
"SEC","^DIC",58.63,58.63,0,"DD")
@
"SEC","^DIC",58.63,58.63,0,"DEL")

"SEC","^DIC",58.63,58.63,0,"LAYGO")

"SEC","^DIC",58.63,58.63,0,"RD")

"SEC","^DIC",58.63,58.63,0,"WR")

"SEC","^DIC",58.64,58.64,0,"AUDIT")
@
"SEC","^DIC",58.64,58.64,0,"DD")
@
"SEC","^DIC",58.64,58.64,0,"DEL")
@
"SEC","^DIC",58.64,58.64,0,"LAYGO")
 
"SEC","^DIC",58.64,58.64,0,"RD")
@
"SEC","^DIC",58.64,58.64,0,"WR")
@
"SEC","^DIC",58.7,58.7,0,"AUDIT")

"SEC","^DIC",58.7,58.7,0,"DD")

"SEC","^DIC",58.7,58.7,0,"DEL")

"SEC","^DIC",58.7,58.7,0,"LAYGO")

"SEC","^DIC",58.7,58.7,0,"RD")

"SEC","^DIC",58.7,58.7,0,"WR")

"SEC","^DIC",58.71,58.71,0,"AUDIT")

"SEC","^DIC",58.71,58.71,0,"DD")

"SEC","^DIC",58.71,58.71,0,"DEL")

"SEC","^DIC",58.71,58.71,0,"LAYGO")

"SEC","^DIC",58.71,58.71,0,"RD")

"SEC","^DIC",58.71,58.71,0,"WR")

"SEC","^DIC",58.72,58.72,0,"AUDIT")

"SEC","^DIC",58.72,58.72,0,"DD")

"SEC","^DIC",58.72,58.72,0,"DEL")

"SEC","^DIC",58.72,58.72,0,"LAYGO")

"SEC","^DIC",58.72,58.72,0,"RD")

"SEC","^DIC",58.72,58.72,0,"WR")

"VER")
8.0^22.0
"^DD",58.6,58.6,0)
FIELD^^25^36
"^DD",58.6,58.6,0,"DDA")
N
"^DD",58.6,58.6,0,"DT")
3160418
"^DD",58.6,58.6,0,"IX","B",58.6,.01)

"^DD",58.6,58.6,0,"NM","PADE INBOUND TRANSACTIONS")

"^DD",58.6,58.6,0,"VRPK")
PSJ
"^DD",58.6,58.6,.001,0)
NUMBER^NJ13,0^^ ^K:+X'=X!(X>9999999999999)!(X<0)!(X?.E1"."1N.N) X
"^DD",58.6,58.6,.001,3)
Type a number between 0 and 9999999999999, 0 decimal digits.
"^DD",58.6,58.6,.001,21,0)
^^3^3^3151201^
"^DD",58.6,58.6,.001,21,1,0)
This field is intended to allow for multiple transaction filed at the 
"^DD",58.6,58.6,.001,21,2,0)
exact same Date and Time, with identical Internal Entry Numbers equal to 
"^DD",58.6,58.6,.001,21,3,0)
the same Date and Time.
"^DD",58.6,58.6,.001,"DT")
3150728
"^DD",58.6,58.6,.01,0)
TRANSACTION DATE/TIME^RD^^0;1^S %DT="ESTXR" D ^%DT S X=Y K:Y<1 X
"^DD",58.6,58.6,.01,1,0)
^.1
"^DD",58.6,58.6,.01,1,1,0)
58.6^B
"^DD",58.6,58.6,.01,1,1,1)
S ^PS(58.6,"B",$E(X,1,30),DA)=""
"^DD",58.6,58.6,.01,1,1,2)
K ^PS(58.6,"B",$E(X,1,30),DA)
"^DD",58.6,58.6,.01,3)
Enter the Date/Time the transaction occurred.
"^DD",58.6,58.6,.01,21,0)
^.001^2^2^3151201^^^
"^DD",58.6,58.6,.01,21,1,0)
This field contains the Date and Time the transaction occurred at the PADE
"^DD",58.6,58.6,.01,21,2,0)
device.
"^DD",58.6,58.6,.01,"DEL",1,0)
I 1 D EN^DDIOL("Division cannot be deleted, it must be inactivated!","","$C(7),!?5")
"^DD",58.6,58.6,.01,"DT")
3160823
"^DD",58.6,58.6,1,0)
DISPENSING DEVICE^RF^^0;2^K:$L(X)>30!($L(X)<2) X
"^DD",58.6,58.6,1,3)
Answer must be 2-30 characters in length.
"^DD",58.6,58.6,1,12)
Only find devices associated with PADE Inbound system.
"^DD",58.6,58.6,1,12.1)
S DIC("S")="I 1"
"^DD",58.6,58.6,1,21,0)
^.001^2^2^3151001^^^^
"^DD",58.6,58.6,1,21,1,0)
This field contains the dispensive device or cabinet where the actions
"^DD",58.6,58.6,1,21,2,0)
described by the transaction were performed.
"^DD",58.6,58.6,1,"DT")
3160823
"^DD",58.6,58.6,1.1,0)
INBOUND PADE SYSTEM^RF^^1;3^K:$L(X)>30!($L(X)<2) X
"^DD",58.6,58.6,1.1,3)
Answer must be 2-30 characters in length.
"^DD",58.6,58.6,1.1,21,0)
^.001^3^3^3151001^^^
"^DD",58.6,58.6,1.1,21,1,0)
This fields contains a pointer to the PADE INVENTORY SYSTEM (#58.601)
"^DD",58.6,58.6,1.1,21,2,0)
file. This represents the Pharmacy Automation Dispensing Equipment (PADE)
"^DD",58.6,58.6,1.1,21,3,0)
system from which this transaction originated.
"^DD",58.6,58.6,1.1,"DT")
3160823
"^DD",58.6,58.6,1.2,0)
DRAWER^F^^1;4^K:$L(X)>30!($L(X)<1) X
"^DD",58.6,58.6,1.2,3)
Answer must be 1-30 characters in length.
"^DD",58.6,58.6,1.2,21,0)
^^5^5^3150806^
"^DD",58.6,58.6,1.2,21,1,0)
This field contains the PADE drawer from which, or into which, the drug
"^DD",58.6,58.6,1.2,21,2,0)
item in the trasaction was added or removed. A PADE drawer is a storage
"^DD",58.6,58.6,1.2,21,3,0)
location for drugs within a PADE dispensing device or cabinet. A drawer is
"^DD",58.6,58.6,1.2,21,4,0)
the primary storage location within a cabinet and may be subdivided into
"^DD",58.6,58.6,1.2,21,5,0)
pockets and/or sub-drawers.
"^DD",58.6,58.6,1.2,"DT")
3160823
"^DD",58.6,58.6,2,0)
DRUG^RP50'^PSDRUG(^0;3^Q
"^DD",58.6,58.6,2,3)
Enter the drug item added or removed from the PADE device.
"^DD",58.6,58.6,2,21,0)
^.001^2^2^3151202^^^
"^DD",58.6,58.6,2,21,1,0)
This field contains the drug in the PADE device acted upon by the
"^DD",58.6,58.6,2,21,2,0)
transaction.
"^DD",58.6,58.6,2,23,0)
^.001^1^1^3151202^^^^
"^DD",58.6,58.6,2,23,1,0)
Pointer to the DRUG (#50) file.
"^DD",58.6,58.6,2,"DT")
3160301
"^DD",58.6,58.6,3,0)
QUANTITY^NJ9,2^^0;4^K:+X'=X!(X>999999)!(X<-999999)!(X?.E1"."3N.N) X
"^DD",58.6,58.6,3,3)
Type a number between -999999 and 999999, 2 decimal digits.
"^DD",58.6,58.6,3,21,0)
^.001^3^3^3160122^^
"^DD",58.6,58.6,3,21,1,0)
This field contains the quantity of the drug acted upon in the
"^DD",58.6,58.6,3,21,2,0)
transaction. The quantity is a physical item count of drug items in the 
"^DD",58.6,58.6,3,21,3,0)
units in which the drug items are stocked and dispensed.
"^DD",58.6,58.6,3,"DT")
3160823
"^DD",58.6,58.6,4,0)
TYPE OF TRANSACTION^RS^L:LOAD;U:UNLOAD;R:RETURN;V:VEND;W:WASTE;C:COUNT;F:REFILL;B:EMPTY;E:EXPIRED;D:DESTOCK;A:DISCREPANCY;N:CANCEL;^0;5^Q
"^DD",58.6,58.6,4,3)
Enter the transaction type matching the PADE action.
"^DD",58.6,58.6,4,21,0)
^.001^4^4^3160418^^^^
"^DD",58.6,58.6,4,21,1,0)
This field contains the type of the transaction. LOAD and RETURN
"^DD",58.6,58.6,4,21,2,0)
transactions indicate item(s) were added to a PADE device, UNLOAD and
"^DD",58.6,58.6,4,21,3,0)
DISPENSE transactions indicate item(s) were removed from a PADE device. A
"^DD",58.6,58.6,4,21,4,0)
COUNT transaction neither adds nor removes items from the PADE device.
"^DD",58.6,58.6,4,"DT")
3160823
"^DD",58.6,58.6,5,0)
DRUG FORM^F^^0;6^K:$L(X)>30!($L(X)<1) X
"^DD",58.6,58.6,5,3)
Answer must be 1-30 characters in length.
"^DD",58.6,58.6,5,21,0)
^.001^3^3^3150830^^
"^DD",58.6,58.6,5,21,1,0)
This field contains the dispense form of the transaction's drug item. This
"^DD",58.6,58.6,5,21,2,0)
should indicate exactly what was added or removed from the PADE device.
"^DD",58.6,58.6,5,21,3,0)
For instance: TABLET, BOTTLE, INHALER.
"^DD",58.6,58.6,5,"DT")
3150830
"^DD",58.6,58.6,6,0)
USER^P200'^VA(200,^0;7^Q
"^DD",58.6,58.6,6,3)
Enter the user who performed the action at the PADE device.
"^DD",58.6,58.6,6,21,0)
^.001^2^2^3151202^^^
"^DD",58.6,58.6,6,21,1,0)
This field contains the name of the user physically adding or removing the
"^DD",58.6,58.6,6,21,2,0)
drug item(s) from or to the PADE device.
"^DD",58.6,58.6,6,"DT")
3151130
"^DD",58.6,58.6,6.1,0)
USER EXTERNAL ID^F^^5;1^K:$L(X)>30!($L(X)<1) X
"^DD",58.6,58.6,6.1,3)
Answer must be 1-30 characters in length.
"^DD",58.6,58.6,6.1,21,0)
^^4^4^3151202^
"^DD",58.6,58.6,6.1,21,1,0)
This field contains the external ID of the user performing the 
"^DD",58.6,58.6,6.1,21,2,0)
addition or removal of the drug item from the PADE dispensing 
"^DD",58.6,58.6,6.1,21,3,0)
device, as received from the PADE system via the PADE HL7
"^DD",58.6,58.6,6.1,21,4,0)
interface.
"^DD",58.6,58.6,6.1,"DT")
3151130
"^DD",58.6,58.6,6.2,0)
USER TEXT NAME^F^^5;2^K:$L(X)>30!($L(X)<1) X
"^DD",58.6,58.6,6.2,3)
Answer must be 1-30 characters in length.
"^DD",58.6,58.6,6.2,21,0)
^.001^5^5^3150830^^^
"^DD",58.6,58.6,6.2,21,1,0)
This field contains the text name of the user performing the transaction, 
"^DD",58.6,58.6,6.2,21,2,0)
as received from the vendor via the PADE HL7 interface. This should be 
"^DD",58.6,58.6,6.2,21,3,0)
the same as the user's name in VistA, however, this is not enforced by 
"^DD",58.6,58.6,6.2,21,4,0)
any automated process. Discrepancies in the user's name between VistA
"^DD",58.6,58.6,6.2,21,5,0)
and the vendor database should be reviewed and corrected.
"^DD",58.6,58.6,6.2,"DT")
3151130
"^DD",58.6,58.6,7,0)
WITNESS^P200'^VA(200,^0;8^Q
"^DD",58.6,58.6,7,3)
Enter the user who witnessed the action at the PADE device.
"^DD",58.6,58.6,7,21,0)
^.001^2^2^3151201^^
"^DD",58.6,58.6,7,21,1,0)
This field contains the name of the user formally witnessing the
"^DD",58.6,58.6,7,21,2,0)
adding or removing of drug item(s) to or from the PADE.
"^DD",58.6,58.6,7,"DT")
3151130
"^DD",58.6,58.6,7.1,0)
WITNESS EXTERNAL ID^F^^5;3^K:$L(X)>30!($L(X)<1) X
"^DD",58.6,58.6,7.1,3)
Answer must be 1-30 characters in length.
"^DD",58.6,58.6,7.1,21,0)
^^4^4^3151202^
"^DD",58.6,58.6,7.1,21,1,0)
This field contains the external PADE system identifier for the user 
"^DD",58.6,58.6,7.1,21,2,0)
acting as a witness to the addition or removal of the drug item from the 
"^DD",58.6,58.6,7.1,21,3,0)
PADE dispensing device, as received from the PADE system via the PADE HL7 
"^DD",58.6,58.6,7.1,21,4,0)
interface.
"^DD",58.6,58.6,7.1,"DT")
3151130
"^DD",58.6,58.6,7.2,0)
WITNESS TEXT NAME^F^^5;5^K:$L(X)>30!($L(X)<1) X
"^DD",58.6,58.6,7.2,3)
Answer must be 1-30 characters in length.
"^DD",58.6,58.6,7.2,21,0)
^.001^5^5^3151123^^
"^DD",58.6,58.6,7.2,21,1,0)
This field contains the text name of the person witnessing the
"^DD",58.6,58.6,7.2,21,2,0)
transaction, as received from the vendor via the PADE HL7  interface. This
"^DD",58.6,58.6,7.2,21,3,0)
should be the same as the person's name in VistA; however, as this is not
"^DD",58.6,58.6,7.2,21,4,0)
enforced by any automated process,  discrepancies in the witnesses' name
"^DD",58.6,58.6,7.2,21,5,0)
between VistA and the vendor database should be reviewed and corrected.
"^DD",58.6,58.6,7.2,"DT")
3151130
"^DD",58.6,58.6,8,0)
DIVISION^P4'^DIC(4,^0;9^Q
"^DD",58.6,58.6,8,3)
Enter the Division associated with the transaction.
"^DD",58.6,58.6,8,21,0)
^.001^2^2^3151201^^
"^DD",58.6,58.6,8,21,1,0)
This field conains the medical division associated with the PADE device
"^DD",58.6,58.6,8,21,2,0)
from which the transaction originated.
"^DD",58.6,58.6,8,23,0)
^.001^1^1^3151201^^^
"^DD",58.6,58.6,8,23,1,0)
Pointer to the INSTITUTION (#4) file.
"^DD",58.6,58.6,8,"DT")
3151118
"^DD",58.6,58.6,9,0)
HOSPITAL LOCATION^F^^0;10^K:$L(X)>30!($L(X)<2) X
"^DD",58.6,58.6,9,3)
Answer must be 2-30 characters in length.
"^DD",58.6,58.6,9,21,0)
^.001^2^2^3150830^^^
"^DD",58.6,58.6,9,21,1,0)
This field contains the ward or clinic location associated with the PADE 
"^DD",58.6,58.6,9,21,2,0)
device from which the transaction originated.
"^DD",58.6,58.6,9,"DT")
3150830
"^DD",58.6,58.6,10,0)
POCKET^F^^0;11^K:$L(X)>30!($L(X)<1) X
"^DD",58.6,58.6,10,3)
Answer must be 1-30 characters in length.
"^DD",58.6,58.6,10,21,0)
^.001^3^3^3150806^^
"^DD",58.6,58.6,10,21,1,0)
This field contains the name of the storage pocket in the PADE
"^DD",58.6,58.6,10,21,2,0)
transaction, from which or to which the transaction's drug item was 
"^DD",58.6,58.6,10,21,3,0)
removed or added.
"^DD",58.6,58.6,10,"DT")
3160823
"^DD",58.6,58.6,11,0)
SUBDRAWER^F^^0;12^K:$L(X)>30!($L(X)<1) X
"^DD",58.6,58.6,11,3)
Answer must be 1-30 characters in length.
"^DD",58.6,58.6,11,21,0)
^^3^3^3150806^
"^DD",58.6,58.6,11,21,1,0)
This field contains the name of the PADE device's subdrawer, from which 
"^DD",58.6,58.6,11,21,2,0)
the transaction's drug item was removed, or to which the transaction's 
"^DD",58.6,58.6,11,21,3,0)
drug was added.
"^DD",58.6,58.6,11,"DT")
3160823
"^DD",58.6,58.6,12,0)
EXPECTED BEGIN BALANCE^NJ7,0^^0;13^K:+X'=X!(X>9999999)!(X<-9999999)!(X?.E1"."1N.N) X
"^DD",58.6,58.6,12,3)
Type a number between -9999999 and 9999999, 0 decimal digits.
"^DD",58.6,58.6,12,21,0)
^^3^3^3150806^
"^DD",58.6,58.6,12,21,1,0)
This field contains a transaction's expected balance of a drug within a 
"^DD",58.6,58.6,12,21,2,0)
specific PADE drawer/pocket, prior to any actions described by the 
"^DD",58.6,58.6,12,21,3,0)
transaction.
"^DD",58.6,58.6,12,"DT")
3150728
"^DD",58.6,58.6,13,0)
ACTUAL BEGIN BALANCE^NJ7,0^^0;14^K:+X'=X!(X>9999999)!(X<-9999999)!(X?.E1"."1N.N) X
"^DD",58.6,58.6,13,3)
Type a number between -9999999 and 9999999, 0 decimal digits.
"^DD",58.6,58.6,13,21,0)
^^3^3^3151217^
"^DD",58.6,58.6,13,21,1,0)
This field contains a physical count of drug items in the specific PADE
"^DD",58.6,58.6,13,21,2,0)
storage location sent in the transaction, prior to any action described by
"^DD",58.6,58.6,13,21,3,0)
the transaction.
"^DD",58.6,58.6,13,"DT")
3160823
"^DD",58.6,58.6,14,0)
PATIENT^P2'^DPT(^0;15^Q
"^DD",58.6,58.6,14,3)
Enter the patient associated with the transaction.
"^DD",58.6,58.6,14,21,0)
^.001^2^2^3160316^^^^
"^DD",58.6,58.6,14,21,1,0)
This field contains the name of the patient in the transaction for
"^DD",58.6,58.6,14,21,2,0)
whom a drug item was removed or returned to the PADE.
"^DD",58.6,58.6,14,"DT")
3160316
"^DD",58.6,58.6,14.1,0)
PATIENT TEXT LAST NAME^F^^3;5^K:$L(X)>30!($L(X)<1) X
"^DD",58.6,58.6,14.1,3)
Answer must be 1-30 characters in length.
"^DD",58.6,58.6,14.1,21,0)
^^3^3^3160108^
"^DD",58.6,58.6,14.1,21,1,0)
This is the patient's last name received in field 5, component 1 of the 
"^DD",58.6,58.6,14.1,21,2,0)
PID segment received from the PADE vendor when a patient is involved in 
"^DD",58.6,58.6,14.1,21,3,0)
activity at the PADE dispensing device.
"^DD",58.6,58.6,14.1,23,0)
^^3^3^3160108^
"^DD",58.6,58.6,14.1,23,1,0)
This is the patient's first (given) name received in field 5, component 2
"^DD",58.6,58.6,14.1,23,2,0)
of the PID segment received from the PADE vendor when a patient is
"^DD",58.6,58.6,14.1,23,3,0)
involved in activity at the PADE dispensing device.
"^DD",58.6,58.6,14.1,"DT")
3160108
"^DD",58.6,58.6,14.2,0)
PATIENT TEXT FIRST NAME^F^^3;6^K:$L(X)>30!($L(X)<1) X
"^DD",58.6,58.6,14.2,3)
Answer must be 1-30 characters in length.
"^DD",58.6,58.6,14.2,21,0)
^.001^3^3^3160108^^
"^DD",58.6,58.6,14.2,21,1,0)
This is the patient's first name received in field 5, component 2 of the 
"^DD",58.6,58.6,14.2,21,2,0)
PID segment received from the PADE vendor when a patient is involved in 
"^DD",58.6,58.6,14.2,21,3,0)
activity at the PADE dispensing device.
"^DD",58.6,58.6,14.2,"DT")
3160108
"^DD",58.6,58.6,14.3,0)
PATIENT ID^F^^3;7^K:$L(X)>30!($L(X)<1) X
"^DD",58.6,58.6,14.3,3)
Answer must be 1-30 characters in length.
"^DD",58.6,58.6,14.3,21,0)
^^3^3^3160108^
"^DD",58.6,58.6,14.3,21,1,0)
This is the patient's identifier received in field 3, component 1 of the 
"^DD",58.6,58.6,14.3,21,2,0)
PID segment received from the PADE vendor when a patient is involved in 
"^DD",58.6,58.6,14.3,21,3,0)
activity at the PADE dispensing device.
"^DD",58.6,58.6,14.3,"DT")
3160108
"^DD",58.6,58.6,15,0)
PHARMACY ORDER^F^^1;1^K:$L(X)>30!($L(X)<1) X
"^DD",58.6,58.6,15,3)
Answer must be 1-30 characters in length.
"^DD",58.6,58.6,15,21,0)
^.001^2^2^3150806^^
"^DD",58.6,58.6,15,21,1,0)
This field contains the pharmacy order from the transaction for which the 
"^DD",58.6,58.6,15,21,2,0)
drug item was removed or returned to the PADE device.
"^DD",58.6,58.6,15,"DT")
3150730
"^DD",58.6,58.6,16,0)
POCKET BALANCE^NJ7,0^^1;2^K:+X'=X!(X>9999999)!(X<-9999999)!(X?.E1"."1N.N) X
"^DD",58.6,58.6,16,3)
Type a number between -9999999 and 9999999, 0 decimal digits.
"^DD",58.6,58.6,16,21,0)
^^4^4^3151217^
"^DD",58.6,58.6,16,21,1,0)
This field contains the sum of the Actual Begin Balance received in the 
"^DD",58.6,58.6,16,21,2,0)
transaction and the Quantity received in the transaction and represents 
"^DD",58.6,58.6,16,21,3,0)
the new balance in the PADE device after the event described by the 
"^DD",58.6,58.6,16,21,4,0)
transaction was completed.
"^DD",58.6,58.6,16,"DT")
3150909
"^DD",58.6,58.6,17,0)
DEVICE BALANCE^NJ5,0^^1;5^K:+X'=X!(X>99999)!(X<-99999)!(X?.E1"."1N.N) X
"^DD",58.6,58.6,17,3)
Type a number between -99999 and 99999, 0 decimal digits.
"^DD",58.6,58.6,17,21,0)
^.001^2^2^3150909^^
"^DD",58.6,58.6,17,21,1,0)
This field contains the total balance of a drug item within a PADE 
"^DD",58.6,58.6,17,21,2,0)
device as reported by the PADE device in the transaction.
"^DD",58.6,58.6,17,"DT")
3150806
"^DD",58.6,58.6,18,0)
DRUG NAME^F^^1;6^K:$L(X)>40!($L(X)<1) X
"^DD",58.6,58.6,18,3)
Answer must be 1-40 characters in length.
"^DD",58.6,58.6,18,21,0)
^.001^2^2^3160531^^
"^DD",58.6,58.6,18,21,1,0)
This field contains the name of the drug in the transaction, as
"^DD",58.6,58.6,18,21,2,0)
it is defined in the PADE device.
"^DD",58.6,58.6,18,"DT")
3160531
"^DD",58.6,58.6,19,0)
ALTERNATE DRUG ID^F^^1;7^K:$L(X)>30!($L(X)<1) X
"^DD",58.6,58.6,19,3)
Answer must be 1-30 characters in length.
"^DD",58.6,58.6,19,21,0)
^.001^2^2^3160531^^
"^DD",58.6,58.6,19,21,1,0)
This field contains an alternate ID of the drug in the PADE device acted
"^DD",58.6,58.6,19,21,2,0)
transaction.
"^DD",58.6,58.6,19,"DT")
3160531
"^DD",58.6,58.6,20,0)
DRUG LOT NUMBER^F^^1;8^K:$L(X)>11!($L(X)<1) X
"^DD",58.6,58.6,20,3)
Answer must be 1-11 characters in length.
"^DD",58.6,58.6,20,21,0)
^^1^1^3151217^
"^DD",58.6,58.6,20,21,1,0)
This field contains the lot number of the drug in the transaction.
"^DD",58.6,58.6,20,"DT")
3150909
"^DD",58.6,58.6,21,0)
TRANSACTION COMMENT^F^^2;1^K:$L(X)>245!($L(X)<1) X
"^DD",58.6,58.6,21,3)
Answer must be 1-245 characters in length.
"^DD",58.6,58.6,21,21,0)
^^2^2^3150909^
"^DD",58.6,58.6,21,21,1,0)
This field contains comments entered by the user performing the action 
"^DD",58.6,58.6,21,21,2,0)
described by the transaction.
"^DD",58.6,58.6,21,"DT")
3150909
"^DD",58.6,58.6,22,0)
STATUS^S^P:PENDING;C:COMPLETED;I:INCOMPLETE;^3;1^Q
"^DD",58.6,58.6,22,3)
Enter the processing status of the transaction in the inbound queue.
"^DD",58.6,58.6,22,21,0)
^.001^6^6^3160322^^^
"^DD",58.6,58.6,22,21,1,0)
This field indicates the status of the transaction's update to the 
"^DD",58.6,58.6,22,21,2,0)
PADE INVENTORY file (#58.601). The status is set to P (Pending) at the
"^DD",58.6,58.6,22,21,3,0)
time the transaction is filed, then changed to I (In Progress) when 
"^DD",58.6,58.6,22,21,4,0)
procesing of the transaction begins, and C (Complete) when the 
"^DD",58.6,58.6,22,21,5,0)
transaction has been successfully processed to update the PADE INVENTORY 
"^DD",58.6,58.6,22,21,6,0)
file.
"^DD",58.6,58.6,22,"DT")
3160322
"^DD",58.6,58.6,23,0)
PAR QUANTITY^NJ4,0^^3;2^K:+X'=X!(X>9999)!(X<0)!(X?.E1"."1N.N) X
"^DD",58.6,58.6,23,3)
Type a number between 0 and 9999, 0 decimal digits.
"^DD",58.6,58.6,23,21,0)
^.001^3^3^3160112^^
"^DD",58.6,58.6,23,21,1,0)
PAR Quantity represents the minimum quantity of the item that should be 
"^DD",58.6,58.6,23,21,2,0)
stocked in the PADE device; an inventory count below this level indicates 
"^DD",58.6,58.6,23,21,3,0)
the item should be restocked/refilled. 
"^DD",58.6,58.6,23,"DT")
3160112
"^DD",58.6,58.6,24,0)
MISSING PATIENT ID^F^^3;3^K:$L(X)>30!($L(X)<2) X
"^DD",58.6,58.6,24,3)
Answer must be 2-30 characters in length.
"^DD",58.6,58.6,24,21,0)
^.001^2^2^3151218^^
"^DD",58.6,58.6,24,21,1,0)
If the patient received from PADE via HL7 is not on file in the local 
"^DD",58.6,58.6,24,21,2,0)
VistA system, this field is populated with the unknown patient's ID.
"^DD",58.6,58.6,24,"DT")
3151207
"^DD",58.6,58.6,25,0)
MISSING PATIENT NAME^F^^3;4^K:$L(X)>30!($L(X)<2) X
"^DD",58.6,58.6,25,3)
Answer must be 2-30 characters in length.
"^DD",58.6,58.6,25,21,0)
^^2^2^3151207^
"^DD",58.6,58.6,25,21,1,0)
If the patient received from PADE via HL7 is not on file in the local 
"^DD",58.6,58.6,25,21,2,0)
VistA system, this field is populated with the unknown patient's name.
"^DD",58.6,58.6,25,"DT")
3151207
"^DD",58.601,58.601,0)
FIELD^^6^7
"^DD",58.601,58.601,0,"DDA")
N
"^DD",58.601,58.601,0,"DT")
3160520
"^DD",58.601,58.601,0,"ID",3)
W:$D(^(4)) "   ",$P(^(4),U,1)
"^DD",58.601,58.601,0,"IX","B",58.601,.01)

"^DD",58.601,58.601,0,"IX","C",58.601,3)

"^DD",58.601,58.601,0,"NM","PADE INVENTORY SYSTEM")

"^DD",58.601,58.601,0,"PT",58.6014,.01)

"^DD",58.601,58.601,0,"PT",58.63,1)

"^DD",58.601,58.601,0,"PT",58.64,1.1)

"^DD",58.601,58.601,0,"VRPK")
PSJ
"^DD",58.601,58.601,.01,0)
PADE INVENTORY SYSTEM^RFX^^0;1^K:$L(X)>30!($L(X)<2) X
"^DD",58.601,58.601,.01,1,0)
^.1^^-1
"^DD",58.601,58.601,.01,1,1,0)
58.601^B
"^DD",58.601,58.601,.01,1,1,1)
S ^PS(58.601,"B",$E(X,1,30),DA)=""
"^DD",58.601,58.601,.01,1,1,2)
K ^PS(58.601,"B",$E(X,1,30),DA)
"^DD",58.601,58.601,.01,3)
Answer must be 2-30 characters in length.
"^DD",58.601,58.601,.01,4)
D SYSHLP^PSJPADSI
"^DD",58.601,58.601,.01,21,0)
^.001^11^11^3160411^^^^
"^DD",58.601,58.601,.01,21,1,0)
A PADE Inventory System is a Pharmacy Automated Dispensing 
"^DD",58.601,58.601,.01,21,2,0)
Equipment (PADE) system that sends stock and dispense activity
"^DD",58.601,58.601,.01,21,3,0)
to VistA. 
"^DD",58.601,58.601,.01,21,4,0)
 
"^DD",58.601,58.601,.01,21,5,0)
At non-integrated sites, there may only be one PADE Inventory 
"^DD",58.601,58.601,.01,21,6,0)
System per PADE System (outbound). At integrated sites, the PADE 
"^DD",58.601,58.601,.01,21,7,0)
outbound system may represent a central PADE server, and each 
"^DD",58.601,58.601,.01,21,8,0)
PADE Inventory System represents a parent facility within the
"^DD",58.601,58.601,.01,21,9,0)
integrated site. At non-integrated sites, where there is only
"^DD",58.601,58.601,.01,21,10,0)
one parent facility, there may only be one PADE Inventory System,
"^DD",58.601,58.601,.01,21,11,0)
and one PADE System (outbound), for entire facility.
"^DD",58.601,58.601,.01,"DT")
3160411
"^DD",58.601,58.601,1,0)
DISPENSING DEVICE^58.6011P^^DEVICE;0
"^DD",58.601,58.601,1,21,0)
^.001^5^5^3151201^^^^
"^DD",58.601,58.601,1,21,1,0)
Dispensing Device represents a physical Pharmacy Automation Dispensing 
"^DD",58.601,58.601,1,21,2,0)
Equipment (PADE) device used for storage and retrieval of drug items.
"^DD",58.601,58.601,1,21,3,0)
PADE devices are associated with, and grouped by, a PADE Inbound vendor
"^DD",58.601,58.601,1,21,4,0)
system, and are linked to VistA ward and clinic locations via the 
"^DD",58.601,58.601,1,21,5,0)
Division sub-file.
"^DD",58.601,58.601,1,"DT")
3151007
"^DD",58.601,58.601,2,0)
PADE VENDOR^P58.7'^PS(58.7,^0;2^Q
"^DD",58.601,58.601,2,3)
Enter a PADE system defined in the PADE SYSTEM SETUP file.
"^DD",58.601,58.601,2,21,0)
^^2^2^3160317^
"^DD",58.601,58.601,2,21,1,0)
 The PADE Outbound System points to the PADE SYSTEM SETUP file and 
"^DD",58.601,58.601,2,21,2,0)
 is used to link a PADE vendor to the inbound HL7 message. 
"^DD",58.601,58.601,2,"DT")
3160125
"^DD",58.601,58.601,3,0)
ALTERNATE SYSTEM NAME^FX^^4;1^K:$L(X)>30!($L(X)<1) X I $L($G(X))>0 S X=$$UPPER^PSJPDRUT(X)
"^DD",58.601,58.601,3,1,0)
^.1
"^DD",58.601,58.601,3,1,1,0)
58.601^C
"^DD",58.601,58.601,3,1,1,1)
S ^PS(58.601,"C",$E(X,1,30),DA)=""
"^DD",58.601,58.601,3,1,1,2)
K ^PS(58.601,"C",$E(X,1,30),DA)
"^DD",58.601,58.601,3,1,1,"DT")
3160317
"^DD",58.601,58.601,3,3)
Answer must be 1-30 characters in length.
"^DD",58.601,58.601,3,21,0)
^^2^2^3160324^
"^DD",58.601,58.601,3,21,1,0)
This field contains an alternate name that may display during lookups 
"^DD",58.601,58.601,3,21,2,0)
to help identify the correct PADE Inventory System.
"^DD",58.601,58.601,3,"DT")
3160321
"^DD",58.601,58.601,4,0)
DWO MESSAGE ENTITY^58.6014V^^2;0
"^DD",58.601,58.601,4,21,0)
^.001^3^3^3151218^^^
"^DD",58.601,58.601,4,21,1,0)
The highest priority Dispensed Without Orders (DWO) Entity associated with
"^DD",58.601,58.601,4,21,2,0)
a mail group will receive MailMan messages when dispense transactions are
"^DD",58.601,58.601,4,21,3,0)
received without a corresponding pharmacy order. 
"^DD",58.601,58.601,4,"DT")
3151015
"^DD",58.601,58.601,5,0)
CONFIG ERRORS MAIL GROUP^58.6015P^^1;0
"^DD",58.601,58.601,5,21,0)
^.001^2^2^3160114^^^^
"^DD",58.601,58.601,5,21,1,0)
This multiple contains mail groups that receive alert MailMan messages 
"^DD",58.601,58.601,5,21,2,0)
when PADE configration problems are encountered.
"^DD",58.601,58.601,5,"DT")
3151230
"^DD",58.601,58.601,6,0)
DATA ERRORS MAIL GROUP^58.6016P^^3;0
"^DD",58.601,58.601,6,21,0)
^.001^6^6^3151230^^
"^DD",58.601,58.601,6,21,1,0)
Mail groups to receive alert MailMan messages when PADE data validation
"^DD",58.601,58.601,6,21,2,0)
problems are encountered by the PADE HL7 Inbound interface. If multiple 
"^DD",58.601,58.601,6,21,3,0)
mail groups are entered, the messages will be sent to all mail groups 
"^DD",58.601,58.601,6,21,4,0)
sequentially; entering several mail groups with overlapping members will
"^DD",58.601,58.601,6,21,5,0)
result in the same message being sent multiple times to the same 
"^DD",58.601,58.601,6,21,6,0)
recipients.
"^DD",58.601,58.601,6,"DT")
3151230
"^DD",58.601,58.6011,0)
DISPENSING DEVICE SUB-FIELD^^2^3
"^DD",58.601,58.6011,0,"DT")
3160210
"^DD",58.601,58.6011,0,"IX","B",58.6011,.01)

"^DD",58.601,58.6011,0,"NM","DISPENSING DEVICE")

"^DD",58.601,58.6011,0,"UP")
58.601
"^DD",58.601,58.6011,.01,0)
DISPENSING DEVICE^MP58.63^PS(58.63,^0;1^Q
"^DD",58.601,58.6011,.01,1,0)
^.1
"^DD",58.601,58.6011,.01,1,1,0)
58.6011^B
"^DD",58.601,58.6011,.01,1,1,1)
S ^PS(58.601,DA(1),"DEVICE","B",$E(X,1,30),DA)=""
"^DD",58.601,58.6011,.01,1,1,2)
K ^PS(58.601,DA(1),"DEVICE","B",$E(X,1,30),DA)
"^DD",58.601,58.6011,.01,3)
Enter the PADE DISPENSING DEVICE associated with this PADE INVENTORY SYSTEM.
"^DD",58.601,58.6011,.01,4)
D DDEVHLP^PSJPADSI
"^DD",58.601,58.6011,.01,21,0)
^.001^6^6^3160223^^^^
"^DD",58.601,58.6011,.01,21,1,0)
The Dispensing Device, also known as a dispensing station or cabinet, 
"^DD",58.601,58.6011,.01,21,2,0)
is located on wards or in clinics and contains drugs that can be removed
"^DD",58.601,58.6011,.01,21,3,0)
and dispensed to patients. The Dispensing Device defined here must match
"^DD",58.601,58.6011,.01,21,4,0)
exactly the name of the device as it is defined on the Pharmacy Automated 
"^DD",58.601,58.6011,.01,21,5,0)
Dispensing Equipment (PADE) vendor system in order for inventory to be 
"^DD",58.601,58.6011,.01,21,6,0)
updated accurately in VistA.
"^DD",58.601,58.6011,.01,"DT")
3151022
"^DD",58.601,58.6011,1,0)
DRUG (DEVICE)^58.60111P^^DRUG;0
"^DD",58.601,58.6011,1,21,0)
^.001^2^2^3151201^^^^
"^DD",58.601,58.6011,1,21,1,0)
This multiple points to the DRUG (#50) file and contains the list of all
"^DD",58.601,58.6011,1,21,2,0)
drugs stocked in the PADE device.
"^DD",58.601,58.6011,2,0)
DRAWER^58.60112^^DRAWER;0
"^DD",58.601,58.6011,2,21,0)
^.001^3^3^3151201^^^^
"^DD",58.601,58.6011,2,21,1,0)
The DRAWER multiple contains a list of drawers. Drawers are the primary
"^DD",58.601,58.6011,2,21,2,0)
storage location of drugs within a dispensing device. A drawer may be
"^DD",58.601,58.6011,2,21,3,0)
subdivided into pockets and/or sub-drawers.
"^DD",58.601,58.60111,0)
DRUG (DEVICE) SUB-FIELD^^4^5
"^DD",58.601,58.60111,0,"DT")
3160114
"^DD",58.601,58.60111,0,"IX","B",58.60111,.01)

"^DD",58.601,58.60111,0,"NM","DRUG (DEVICE)")

"^DD",58.601,58.60111,0,"UP")
58.6011
"^DD",58.601,58.60111,.01,0)
DRUG (DEVICE)^MP50'^PSDRUG(^0;1^Q
"^DD",58.601,58.60111,.01,1,0)
^.1
"^DD",58.601,58.60111,.01,1,1,0)
58.60111^B
"^DD",58.601,58.60111,.01,1,1,1)
S ^PS(58.601,DA(2),"DEVICE",DA(1),"DRUG","B",$E(X,1,30),DA)=""
"^DD",58.601,58.60111,.01,1,1,2)
K ^PS(58.601,DA(2),"DEVICE",DA(1),"DRUG","B",$E(X,1,30),DA)
"^DD",58.601,58.60111,.01,3)
Enter the drug stored in this PADE DISPENSING DEVICE.
"^DD",58.601,58.60111,.01,4)
W ?7,"Enter the drug stored in the PADE device.",!
"^DD",58.601,58.60111,.01,21,0)
^.001^1^1^3151201^^
"^DD",58.601,58.60111,.01,21,1,0)
The drug stored in this PADE device.
"^DD",58.601,58.60111,.01,"DT")
3151201
"^DD",58.601,58.60111,1,0)
CALCULATED DEVICE BALANCE^NJ7,0^^0;2^K:+X'=X!(X>9999999)!(X<-9999999)!(X?.E1"."1N.N) X
"^DD",58.601,58.60111,1,3)
Type a number between -9999999 and 9999999, 0 decimal digits.
"^DD",58.601,58.60111,1,4)
D CBALHLP^PSJPADSI
"^DD",58.601,58.60111,1,21,0)
^.001^3^3^3151201^^^^
"^DD",58.601,58.60111,1,21,1,0)
The CALCULATED DEVICE BALANCE contains a drug's device balance calculated
"^DD",58.601,58.60111,1,21,2,0)
by adding together all sub-drawer/pocket balances associated with the
"^DD",58.601,58.60111,1,21,3,0)
device.
"^DD",58.601,58.60111,1,"DT")
3150805
"^DD",58.601,58.60111,2,0)
REPORTED DEVICE BALANCE^NJ5,0^^0;3^K:+X'=X!(X>99999)!(X<-99999)!(X?.E1"."1N.N) X
"^DD",58.601,58.60111,2,3)
Type a number between -99999 and 99999, 0 decimal digits.
"^DD",58.601,58.60111,2,4)
D RBALHLP^PSJPADSI
"^DD",58.601,58.60111,2,21,0)
^.001^2^2^3151201^^^^
"^DD",58.601,58.60111,2,21,1,0)
The REPORTED DEVICE BALANCE contains a drug's device balance received 
"^DD",58.601,58.60111,2,21,2,0)
directly from the vendor HL7 message.
"^DD",58.601,58.60111,2,"DT")
3150806
"^DD",58.601,58.60111,3,0)
INACTIVE DATE/TIME^D^^0;4^S %DT="ESTXR" D ^%DT S X=Y K:Y<1 X
"^DD",58.601,58.60111,3,3)
Enter the Date/Time the drug was no longer available in this PADE device.
"^DD",58.601,58.60111,3,4)
D DRGINHLP^PSJPADSI
"^DD",58.601,58.60111,3,21,0)
^.001^3^3^3151201^^^
"^DD",58.601,58.60111,3,21,1,0)
The INACTIVE DATE/TIME field captures the date and time a drug was 
"^DD",58.601,58.60111,3,21,2,0)
completedly removed, or de-stocked, from a PADE device, indicating the 
"^DD",58.601,58.60111,3,21,3,0)
drug will no longer be available from the device.
"^DD",58.601,58.60111,3,"DT")
3150817
"^DD",58.601,58.60111,4,0)
DOSE FORM^F^^0;5^K:$L(X)>30!($L(X)<1) X
"^DD",58.601,58.60111,4,3)
Answer must be 1-30 characters in length.
"^DD",58.601,58.60111,4,21,0)
^.001^1^1^3160114^^
"^DD",58.601,58.60111,4,21,1,0)
This is the dosage form of the drug, for example, TABLET, VIAL, CAP.
"^DD",58.601,58.60111,4,"DT")
3160114
"^DD",58.601,58.60112,0)
DRAWER SUB-FIELD^^3^4
"^DD",58.601,58.60112,0,"DT")
3160210
"^DD",58.601,58.60112,0,"IX","B",58.60112,.01)

"^DD",58.601,58.60112,0,"NM","DRAWER")

"^DD",58.601,58.60112,0,"UP")
58.6011
"^DD",58.601,58.60112,.01,0)
DRAWER^MF^^0;1^K:$L(X)>30!($L(X)<1) X
"^DD",58.601,58.60112,.01,1,0)
^.1
"^DD",58.601,58.60112,.01,1,1,0)
58.60112^B
"^DD",58.601,58.60112,.01,1,1,1)
S ^PS(58.601,DA(2),"DEVICE",DA(1),"DRAWER","B",$E(X,1,30),DA)=""
"^DD",58.601,58.60112,.01,1,1,2)
K ^PS(58.601,DA(2),"DEVICE",DA(1),"DRAWER","B",$E(X,1,30),DA)
"^DD",58.601,58.60112,.01,3)
Answer must be 1-30 characters in length.
"^DD",58.601,58.60112,.01,4)
W !?5,"Enter the specific storage location on the dispensing device."
"^DD",58.601,58.60112,.01,21,0)
^.001^3^3^3151201^^^
"^DD",58.601,58.60112,.01,21,1,0)
The DRAWER multiple contains a list of drawers. Drawers are the primary
"^DD",58.601,58.60112,.01,21,2,0)
storage location of drugs within a dispensing device. A drawer may be
"^DD",58.601,58.60112,.01,21,3,0)
subdivided into pockets and/or sub-drawers.
"^DD",58.601,58.60112,.01,"DT")
3150729
"^DD",58.601,58.60112,1,0)
DRUG (DRAWER)^58.601121P^^DRUG;0
"^DD",58.601,58.60112,1,21,0)
^.001^2^2^3151217^^
"^DD",58.601,58.60112,1,21,1,0)
The DRUG multiple points to the DRUG (#50) file and contains a list of
"^DD",58.601,58.60112,1,21,2,0)
drugs stocked in a specific drawer within a dispensing device.
"^DD",58.601,58.60112,2,0)
POCKET/SUBDRAWER ID^58.601122^^SUB;0
"^DD",58.601,58.60112,2,21,0)
^.001^2^2^3151201^^^^
"^DD",58.601,58.60112,2,21,1,0)
The POCKET name represents the most precise storage location within a PADE
"^DD",58.601,58.60112,2,21,2,0)
device.
"^DD",58.601,58.60112,2,"DT")
3151001
"^DD",58.601,58.60112,3,0)
POCKET UPDATES^58.601123^^PKUPDT;0
"^DD",58.601,58.601121,0)
DRUG (DRAWER) SUB-FIELD^^1^2
"^DD",58.601,58.601121,0,"DT")
3150801
"^DD",58.601,58.601121,0,"IX","B",58.601121,.01)

"^DD",58.601,58.601121,0,"NM","DRUG (DRAWER)")

"^DD",58.601,58.601121,0,"UP")
58.60112
"^DD",58.601,58.601121,.01,0)
DRUG (DRAWER)^MP50'^PSDRUG(^0;1^Q
"^DD",58.601,58.601121,.01,1,0)
^.1^^-1
"^DD",58.601,58.601121,.01,1,1,0)
58.601121^B
"^DD",58.601,58.601121,.01,1,1,1)
S ^PS(58.601,DA(3),"DEVICE",DA(2),"DRAWER",DA(1),"DRUG","B",$E(X,1,30),DA)=""
"^DD",58.601,58.601121,.01,1,1,2)
K ^PS(58.601,DA(3),"DEVICE",DA(2),"DRAWER",DA(1),"DRUG","B",$E(X,1,30),DA)
"^DD",58.601,58.601121,.01,3)
Enter the drug stored in this PADE drawer.
"^DD",58.601,58.601121,.01,4)
W !?5,"Enter the drug stored in the drawer location."
"^DD",58.601,58.601121,.01,21,0)
^^4^4^3151217^
"^DD",58.601,58.601121,.01,21,1,0)
The drug stored in this PADE drawer storage location. A PADE 
"^DD",58.601,58.601121,.01,21,2,0)
Drawer is the primary storage location for drugs within a
"^DD",58.601,58.601121,.01,21,3,0)
dispensing device. A drawer may be subdivided into pockets 
"^DD",58.601,58.601121,.01,21,4,0)
and/or sub-drawers.
"^DD",58.601,58.601121,.01,"DT")
3150729
"^DD",58.601,58.601121,1,0)
DRAWER BALANCE^NJ7,0^^0;2^K:+X'=X!(X>9999999)!(X<-9999999)!(X?.E1"."1N.N) X
"^DD",58.601,58.601121,1,3)
Type a number between -9999999 and 9999999, 0 decimal digits.
"^DD",58.601,58.601121,1,4)
W !?5,"The drawer's drug balance is calculated automatically and",!?5,"should not be entered manually."
"^DD",58.601,58.601121,1,21,0)
^.001^2^2^3150902^^^^
"^DD",58.601,58.601121,1,21,1,0)
DRAWER BALANCE contains the total of all sub-drawer/pocket balances for 
"^DD",58.601,58.601121,1,21,2,0)
a specific drawer and specific drug.
"^DD",58.601,58.601121,1,"DT")
3150803
"^DD",58.601,58.601122,0)
POCKET/SUBDRAWER ID SUB-FIELD^^5^6
"^DD",58.601,58.601122,0,"DT")
3160210
"^DD",58.601,58.601122,0,"IX","B",58.601122,.01)

"^DD",58.601,58.601122,0,"NM","POCKET/SUBDRAWER ID")

"^DD",58.601,58.601122,0,"UP")
58.60112
"^DD",58.601,58.601122,.01,0)
POCKET^MF^^0;1^K:$L(X)>30!($L(X)<1) X
"^DD",58.601,58.601122,.01,1,0)
^.1
"^DD",58.601,58.601122,.01,1,1,0)
58.601122^B
"^DD",58.601,58.601122,.01,1,1,1)
S ^PS(58.601,DA(3),"DEVICE",DA(2),"DRAWER",DA(1),"SUB","B",$E(X,1,30),DA)=""
"^DD",58.601,58.601122,.01,1,1,2)
K ^PS(58.601,DA(3),"DEVICE",DA(2),"DRAWER",DA(1),"SUB","B",$E(X,1,30),DA)
"^DD",58.601,58.601122,.01,3)
Answer must be 1-30 characters in length.
"^DD",58.601,58.601122,.01,21,0)
^.001^2^2^3151201^^^^
"^DD",58.601,58.601122,.01,21,1,0)
The POCKET name represents the most precise storage location within a PADE
"^DD",58.601,58.601122,.01,21,2,0)
device.
"^DD",58.601,58.601122,.01,"DT")
3150902
"^DD",58.601,58.601122,1,0)
DRUG (POCKET)^P50'^PSDRUG(^0;5^Q
"^DD",58.601,58.601122,1,3)
Enter the drug stored in this PADE pocket.
"^DD",58.601,58.601122,1,21,0)
^.001^2^2^3151201^^^
"^DD",58.601,58.601122,1,21,1,0)
The DRUG field points to the DRUG (#50) file and contains the drug 
"^DD",58.601,58.601122,1,21,2,0)
stocked in the Pocket.
"^DD",58.601,58.601122,1,"DT")
3150902
"^DD",58.601,58.601122,2,0)
BALANCE (POCKET)^NJ5,0^^0;2^K:+X'=X!(X>99999)!(X<-99999)!(X?.E1"."1N.N) X
"^DD",58.601,58.601122,2,3)
Type a number between -99999 and 99999, 0 decimal digits.
"^DD",58.601,58.601122,2,21,0)
^.001^1^1^3151201^^^
"^DD",58.601,58.601122,2,21,1,0)
The BALANCE of the drug stocked in the pocket.
"^DD",58.601,58.601122,2,"DT")
3150902
"^DD",58.601,58.601122,3,0)
POCKET^F^^0;3^K:$L(X)>30!($L(X)<1) X
"^DD",58.601,58.601122,3,3)
Answer must be 1-30 characters in length.
"^DD",58.601,58.601122,3,21,0)
^.001^2^2^3151201^^
"^DD",58.601,58.601122,3,21,1,0)
The POCKET storage location within a PADE device that associated
"^DD",58.601,58.601122,3,21,2,0)
with the SUBDRAWER/POCKET sub-file entry.
"^DD",58.601,58.601122,3,"DT")
3150803
"^DD",58.601,58.601122,4,0)
SUBDRAWER^F^^0;4^K:$L(X)>30!($L(X)<1) X
"^DD",58.601,58.601122,4,3)
Answer must be 1-30 characters in length.
"^DD",58.601,58.601122,4,21,0)
^.001^2^2^3151201^^^
"^DD",58.601,58.601122,4,21,1,0)
The SUBDRAWER storage location associated with the SUBDRAWER/POCKET
"^DD",58.601,58.601122,4,21,2,0)
sub-file entry.
"^DD",58.601,58.601122,4,"DT")
3150803
"^DD",58.601,58.601122,5,0)
DOSE FORM^F^^0;6^K:$L(X)>30!($L(X)<1) X
"^DD",58.601,58.601122,5,3)
Answer must be 1-30 characters in length.
"^DD",58.601,58.601122,5,21,0)
^.001^1^1^3160114^^
"^DD",58.601,58.601122,5,21,1,0)
This is the dosage form of the drug, for example, TABLET, VIAL, CAP.
"^DD",58.601,58.601122,5,"DT")
3160114
"^DD",58.601,58.601123,0)
POCKET UPDATES SUB-FIELD^^1^2
"^DD",58.601,58.601123,0,"DT")
3160205
"^DD",58.601,58.601123,0,"IX","B",58.601123,.01)

"^DD",58.601,58.601123,0,"NM","POCKET UPDATES")

"^DD",58.601,58.601123,0,"UP")
58.60112
"^DD",58.601,58.601123,.01,0)
POCKET UPDATES^MF^^0;1^K:$L(X)>30!($L(X)<1) X
"^DD",58.601,58.601123,.01,1,0)
^.1
"^DD",58.601,58.601123,.01,1,1,0)
58.601123^B
"^DD",58.601,58.601123,.01,1,1,1)
S ^PS(58.601,DA(3),"DEVICE",DA(2),"DRAWER",DA(1),"PKUPDT","B",$E(X,1,30),DA)=""
"^DD",58.601,58.601123,.01,1,1,2)
K ^PS(58.601,DA(3),"DEVICE",DA(2),"DRAWER",DA(1),"PKUPDT","B",$E(X,1,30),DA)
"^DD",58.601,58.601123,.01,3)
Answer must be 1-30 characters in length.
"^DD",58.601,58.601123,.01,21,0)
^.001^4^4^3160206^^^^
"^DD",58.601,58.601123,.01,21,1,0)
This field contains the Date/Time of the most recent PADE activity for 
"^DD",58.601,58.601123,.01,21,2,0)
each pocket in this drawer. The Date/Time is received via the PADE 
"^DD",58.601,58.601123,.01,21,3,0)
Inbound HL7 interface, in the Transaction Date/Time field of the ZPM 
"^DD",58.601,58.601123,.01,21,4,0)
Segment (ZPM-19).
"^DD",58.601,58.601123,.01,"DT")
3160205
"^DD",58.601,58.601123,1,0)
LAST UPDATE DATE/TIME^D^^0;2^S %DT="EST" D ^%DT S X=Y K:Y<1 X
"^DD",58.601,58.601123,1,21,0)
^.001^4^4^3160206^^^
"^DD",58.601,58.601123,1,21,1,0)
This field contains the Date/Time of the most recent PADE activity for 
"^DD",58.601,58.601123,1,21,2,0)
each pocket in this drawer. The Date/Time is received via the PADE 
"^DD",58.601,58.601123,1,21,3,0)
Inbound HL7 interface, in the Transaction Date/Time field of the ZPM 
"^DD",58.601,58.601123,1,21,4,0)
Segment (ZPM-19).
"^DD",58.601,58.601123,1,"DT")
3160205
"^DD",58.601,58.6014,0)
DWO MESSAGE ENTITY SUB-FIELD^^1^2
"^DD",58.601,58.6014,0,"DT")
3151013
"^DD",58.601,58.6014,0,"IX","B",58.6014,.01)

"^DD",58.601,58.6014,0,"NM","DWO MESSAGE ENTITY")

"^DD",58.601,58.6014,0,"UP")
58.601
"^DD",58.601,58.6014,.01,0)
DWO MESSAGE ENTITY^MV^^0;1^Q
"^DD",58.601,58.6014,.01,1,0)
^.1
"^DD",58.601,58.6014,.01,1,1,0)
58.6014^B
"^DD",58.601,58.6014,.01,1,1,1)
S ^PS(58.601,DA(1),2,"B",$E(X,1,30),DA)=""
"^DD",58.601,58.6014,.01,1,1,2)
K ^PS(58.601,DA(1),2,"B",$E(X,1,30),DA)
"^DD",58.601,58.6014,.01,1,1,3)
Required Index for Variable Pointer
"^DD",58.601,58.6014,.01,3)
Enter ENTITY TYPE.ENTITY NAME (e.g., WD.ICU)
"^DD",58.601,58.6014,.01,4)

"^DD",58.601,58.6014,.01,21,0)
^.001^14^14^3151218^^^^
"^DD",58.601,58.6014,.01,21,1,0)
DWO ENTITIES
"^DD",58.601,58.6014,.01,21,2,0)
Dispensed Without Order (DWO) Entities link Pharmacy Automated 
"^DD",58.601,58.6014,.01,21,3,0)
Dispensing Equipment (PADE) to mail groups that will receive a message
"^DD",58.601,58.6014,.01,21,4,0)
when a medication is dispensed from PADE with no order. DWO Entities, 
"^DD",58.601,58.6014,.01,21,5,0)
in order from highest to lowest priority, are:
"^DD",58.601,58.6014,.01,21,6,0)
      1 - PADE DEVICE (CABINET)
"^DD",58.601,58.6014,.01,21,7,0)
      2 - WARD/CLINIC
"^DD",58.601,58.6014,.01,21,8,0)
      3 - WARD GROUP/CLINIC GROUP
"^DD",58.601,58.6014,.01,21,9,0)
      4 - PADE SYSTEM/DIVISION
"^DD",58.601,58.6014,.01,21,10,0)
Messages are ONLY sent for entities defined with the highest priority; 
"^DD",58.601,58.6014,.01,21,11,0)
for example, if a Ward, Clinic, and Ward Group are all linked to a PADE
"^DD",58.601,58.6014,.01,21,12,0)
device, and all contain DWO mail groups, only mail group(s) associated
"^DD",58.601,58.6014,.01,21,13,0)
with the Ward and Clinic receive a DWO message, since they both have the
"^DD",58.601,58.6014,.01,21,14,0)
same priority (2), and it is higher than the Ward Group priority (3).
"^DD",58.601,58.6014,.01,"DT")
3151015
"^DD",58.601,58.6014,.01,"V",0)
^.12P^7^7
"^DD",58.601,58.6014,.01,"V",1,0)
40.8^DIVISION for DWO messages.^1^DIV^n^n
"^DD",58.601,58.6014,.01,"V",2,0)
58.601^PADE SYSTEM for DWO messages.^2^PS^y^n
"^DD",58.601,58.6014,.01,"V",2,1)
S DIC("S")="I +$G(Y)=$G(DA(2))"
"^DD",58.601,58.6014,.01,"V",2,2)
PADE System already selected
"^DD",58.601,58.6014,.01,"V",3,0)
57.5^WARD GROUP for DWO messages.^3^WG^n^n
"^DD",58.601,58.6014,.01,"V",4,0)
42^WARD for DWO messages.^4^WD^n^y
"^DD",58.601,58.6014,.01,"V",5,0)
44^CLINIC for DWO messages.^5^CL^y^n
"^DD",58.601,58.6014,.01,"V",5,1)
S DIC("S")="I $P($G(^(0)),""^"",3)=""C"""
"^DD",58.601,58.6014,.01,"V",5,2)
Clinics from Hospital Location file
"^DD",58.601,58.6014,.01,"V",6,0)
57.8^CLINIC GROUP for DWO messages.^6^CG^n^n
"^DD",58.601,58.6014,.01,"V",7,0)
58.63^PADE DEVICE for DWO messages.^7^PC^n^n
"^DD",58.601,58.6014,1,0)
DWO ENTITY MAIL GROUP^58.60141P^^1;0
"^DD",58.601,58.6014,1,21,0)
^^1^1^3151201^
"^DD",58.601,58.6014,1,21,1,0)
The mail group associated with this DWO MESSAGE ENTITY.
"^DD",58.601,58.6014,1,"DT")
3151015
"^DD",58.601,58.60141,0)
DWO ENTITY MAIL GROUP SUB-FIELD^^.01^1
"^DD",58.601,58.60141,0,"DT")
3151013
"^DD",58.601,58.60141,0,"IX","B",58.60141,.01)

"^DD",58.601,58.60141,0,"NM","DWO ENTITY MAIL GROUP")

"^DD",58.601,58.60141,0,"UP")
58.6014
"^DD",58.601,58.60141,.01,0)
DWO ENTITY MAIL GROUP^MP3.8'^XMB(3.8,^0;1^Q
"^DD",58.601,58.60141,.01,1,0)
^.1
"^DD",58.601,58.60141,.01,1,1,0)
58.60141^B
"^DD",58.601,58.60141,.01,1,1,1)
S ^PS(58.601,DA(2),2,DA(1),1,"B",$E(X,1,30),DA)=""
"^DD",58.601,58.60141,.01,1,1,2)
K ^PS(58.601,DA(2),2,DA(1),1,"B",$E(X,1,30),DA)
"^DD",58.601,58.60141,.01,3)
Enter the mail groups associated with this DWO MESSAGE ENTITY.
"^DD",58.601,58.60141,.01,21,0)
^.001^3^3^3151201^^
"^DD",58.601,58.60141,.01,21,1,0)
The mail group associated with this DWO MESSAGE ENTITY that receives 
"^DD",58.601,58.60141,.01,21,2,0)
Dispensed Without Orders (DWO) MailMan messages when a PADE dispense 
"^DD",58.601,58.60141,.01,21,3,0)
transaction is received without a corresponding pharmacy order.
"^DD",58.601,58.60141,.01,"DT")
3151015
"^DD",58.601,58.6015,0)
CONFIG ERRORS MAIL GROUP SUB-FIELD^^.01^1
"^DD",58.601,58.6015,0,"DT")
3151021
"^DD",58.601,58.6015,0,"IX","B",58.6015,.01)

"^DD",58.601,58.6015,0,"NM","CONFIG ERRORS MAIL GROUP")

"^DD",58.601,58.6015,0,"UP")
58.601
"^DD",58.601,58.6015,.01,0)
CONFIG ERRORS MAIL GROUPS^MP3.8'^XMB(3.8,^0;1^Q
"^DD",58.601,58.6015,.01,1,0)
^.1
"^DD",58.601,58.6015,.01,1,1,0)
58.6015^B
"^DD",58.601,58.6015,.01,1,1,1)
S ^PS(58.601,DA(1),1,"B",$E(X,1,30),DA)=""
"^DD",58.601,58.6015,.01,1,1,2)
K ^PS(58.601,DA(1),1,"B",$E(X,1,30),DA)
"^DD",58.601,58.6015,.01,3)
Enter a mail group to receive PADE Configuration error messages.
"^DD",58.601,58.6015,.01,21,0)
^.001^7^7^3160114^^
"^DD",58.601,58.6015,.01,21,1,0)
 
"^DD",58.601,58.6015,.01,21,2,0)
 Mail groups to receive alert MailMan messages when PADE 
"^DD",58.601,58.6015,.01,21,3,0)
 configuration problems are encountered by the PADE HL7 Inbound 
"^DD",58.601,58.6015,.01,21,4,0)
 interface. Examples of configuration problems are no Division, 
"^DD",58.601,58.6015,.01,21,5,0)
 Ward, or Clinic locations defined for PADE device in the PADE 
"^DD",58.601,58.6015,.01,21,6,0)
 DISPENSING DEVICE (#58.63) file, and no PADE SYSTEM (#58.7) 
"^DD",58.601,58.6015,.01,21,7,0)
 file entry defined.
"^DD",58.601,58.6015,.01,"DT")
3151021
"^DD",58.601,58.6016,0)
DATA ERRORS MAIL GROUP SUB-FIELD^^.01^1
"^DD",58.601,58.6016,0,"DT")
3151021
"^DD",58.601,58.6016,0,"IX","B",58.6016,.01)

"^DD",58.601,58.6016,0,"NM","DATA ERRORS MAIL GROUP")

"^DD",58.601,58.6016,0,"UP")
58.601
"^DD",58.601,58.6016,.01,0)
DATA ERRORS MAIL GROUPS^MP3.8'^XMB(3.8,^0;1^Q
"^DD",58.601,58.6016,.01,1,0)
^.1
"^DD",58.601,58.6016,.01,1,1,0)
58.6016^B
"^DD",58.601,58.6016,.01,1,1,1)
S ^PS(58.601,DA(1),3,"B",$E(X,1,30),DA)=""
"^DD",58.601,58.6016,.01,1,1,2)
K ^PS(58.601,DA(1),3,"B",$E(X,1,30),DA)
"^DD",58.601,58.6016,.01,3)
Enter a MailMan mail group to receive PADE Inbound data validation error messages.
"^DD",58.601,58.6016,.01,21,0)
^^7^7^3160114^
"^DD",58.601,58.6016,.01,21,1,0)
 
"^DD",58.601,58.6016,.01,21,2,0)
 Mail groups to receive alert MailMan messages when PADE data 
"^DD",58.601,58.6016,.01,21,3,0)
 validation problems are encountered by the PADE HL7 Inbound 
"^DD",58.601,58.6016,.01,21,4,0)
 interface.
"^DD",58.601,58.6016,.01,21,5,0)
 
"^DD",58.601,58.6016,.01,21,6,0)
 Examples of data validation problems are Missing or invalid 
"^DD",58.601,58.6016,.01,21,7,0)
 Patient, Drug, or other required data.
"^DD",58.601,58.6016,.01,"DT")
3151021
"^DD",58.63,58.63,0)
FIELD^^12^13
"^DD",58.63,58.63,0,"DDA")
N
"^DD",58.63,58.63,0,"DT")
3160411
"^DD",58.63,58.63,0,"ID",4)
W "   ",@("$P($P($C(59)_$S($D(^DD(58.63,4,0)):$P(^(0),U,3),1:0)_$E("_DIC_"Y,0),0),$C(59)_$P(^(0),U,4)_"":"",2),$C(59),1)")
"^DD",58.63,58.63,0,"IX","B",58.63,.01)

"^DD",58.63,58.63,0,"IX","E",58.63,12)

"^DD",58.63,58.63,0,"NM","PADE DISPENSING DEVICE")

"^DD",58.63,58.63,0,"PT",58.6011,.01)

"^DD",58.63,58.63,0,"PT",58.6014,.01)

"^DD",58.63,58.63,0,"SCR")
I $S('$G(PSJPSYS):1,1:+$G(PSJPSYS)=+$P($G(^(0)),"^",2))
"^DD",58.63,58.63,0,"VRPK")
PSJ
"^DD",58.63,58.63,.01,0)
DISPENSING DEVICE^RF^^0;1^K:$L(X)>30!($L(X)<1)!'(X'?1P.E) X
"^DD",58.63,58.63,.01,1,0)
^.1
"^DD",58.63,58.63,.01,1,1,0)
58.63^B
"^DD",58.63,58.63,.01,1,1,1)
S ^PS(58.63,"B",$E(X,1,30),DA)=""
"^DD",58.63,58.63,.01,1,1,2)
K ^PS(58.63,"B",$E(X,1,30),DA)
"^DD",58.63,58.63,.01,3)
Answer must be 1-30 characters in length.
"^DD",58.63,58.63,.01,21,0)
^.001^2^2^3160223^^^
"^DD",58.63,58.63,.01,21,1,0)
The name of the PADE DISPENSING DEVICE; the name must match exactly the 
"^DD",58.63,58.63,.01,21,2,0)
name of the device on the vendor PADE system.
"^DD",58.63,58.63,.01,"DT")
3160318
"^DD",58.63,58.63,1,0)
PADE INVENTORY SYSTEM^R*P58.601^PS(58.601,^0;2^S DIC("S")="I $S('$G(PSJPSYS):1,1:PSJPSYS=+$G(Y))" D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"^DD",58.63,58.63,1,3)
Enter the PADE INVENTORY SYSTEM associated with this PADE device.
"^DD",58.63,58.63,1,12)
Default to current Inventory System
"^DD",58.63,58.63,1,12.1)
S DIC("S")="I $S('$G(PSJPSYS):1,1:PSJPSYS=+$G(Y))"
"^DD",58.63,58.63,1,21,0)
^^1^1^3151201^
"^DD",58.63,58.63,1,21,1,0)
The PADE INVENTORY SYSTEM associated with this PADE device.
"^DD",58.63,58.63,1,"DT")
3151008
"^DD",58.63,58.63,2,0)
DIVISION^P40.8'^DG(40.8,^2;1^Q
"^DD",58.63,58.63,2,3)
Enter the primary DIVISION supplied by this PADE device.
"^DD",58.63,58.63,2,21,0)
^.001^1^1^3160411^^
"^DD",58.63,58.63,2,21,1,0)
The primary DIVISION associated with this PADE device.
"^DD",58.63,58.63,2,"DT")
3160411
"^DD",58.63,58.63,3,0)
SEND DWO MESSAGES^S^1:YES;0:NO;^0;3^Q
"^DD",58.63,58.63,3,3)
Enter 'YES' if Dispense Without Orders should generate a message
"^DD",58.63,58.63,3,21,0)
^.001^3^3^3160324^^^^
"^DD",58.63,58.63,3,21,1,0)
This field contains a flag indicating if Dispensed Without Order (DWO) 
"^DD",58.63,58.63,3,21,2,0)
MailMan messages should be sent when this PADE device is involved in a 
"^DD",58.63,58.63,3,21,3,0)
dispense transaction that is not linked to a pharmacy order.
"^DD",58.63,58.63,3,"DT")
3160324
"^DD",58.63,58.63,4,0)
PADE STATUS^S^A:ACTIVE;I:INACTIVE;^0;4^Q
"^DD",58.63,58.63,4,3)
Enter the status of the PADE dispensing device, ACTIVE or INACTIVE.
"^DD",58.63,58.63,4,21,0)
^.001^10^10^3160411^^
"^DD",58.63,58.63,4,21,1,0)
This field allows a PADE dispensing device's status to be set to
"^DD",58.63,58.63,4,21,2,0)
ACTIVE or INACTIVE. Setting the status to INACTIVE does not affect the 
"^DD",58.63,58.63,4,21,3,0)
PADE's medication balances; however, an Inactive status prevents
"^DD",58.63,58.63,4,21,4,0)
the PADE cabinet's medication balances from being displayed
"^DD",58.63,58.63,4,21,5,0)
as available in Inpatient Order Entry. Inactive PADE cabinets will
"^DD",58.63,58.63,4,21,6,0)
continue to display in all PADE reports.
"^DD",58.63,58.63,4,21,7,0)
 
"^DD",58.63,58.63,4,21,8,0)
 If a PADE cabinet is being removed from service, the list of 
"^DD",58.63,58.63,4,21,9,0)
 medications stocked in a cabinet may be deleted using the 
"^DD",58.63,58.63,4,21,10,0)
 RESET/INITIALIZE PADE DEVICE? field.
"^DD",58.63,58.63,4,"DT")
3151207
"^DD",58.63,58.63,5,0)
WARD GROUP^58.635P^^3;0
"^DD",58.63,58.63,5,21,0)
^^1^1^3151201^
"^DD",58.63,58.63,5,21,1,0)
Ward Groups associated with this PADE device.
"^DD",58.63,58.63,6,0)
WARD LOCATION^58.636P^^4;0
"^DD",58.63,58.63,6,21,0)
^^1^1^3151201^
"^DD",58.63,58.63,6,21,1,0)
Ward Locations associated with this PADE device.
"^DD",58.63,58.63,7,0)
CLINIC GROUP^58.637P^^5;0
"^DD",58.63,58.63,7,21,0)
^.001^1^1^3151201^^
"^DD",58.63,58.63,7,21,1,0)
Clinic Groups associated with this PADE device.
"^DD",58.63,58.63,8,0)
CLINIC LOCATION^58.638P^^6;0
"^DD",58.63,58.63,8,21,0)
^^1^1^3151201^
"^DD",58.63,58.63,8,21,1,0)
Clinic Locations associated with this PADE device.
"^DD",58.63,58.63,9,0)
PADE RESET^58.639DA^^1;0
"^DD",58.63,58.63,9,21,0)
^.001^1^1^3151221^^
"^DD",58.63,58.63,9,21,1,0)
This multiple stores the date and time a PADE reset occurred.
"^DD",58.63,58.63,10,0)
WILDCARD CLINIC NAME^58.65^^7;0
"^DD",58.63,58.63,10,21,0)
^.001^9^9^3151209^^
"^DD",58.63,58.63,10,21,1,0)
This field allows a group of CLINICS with a common naming convention to
"^DD",58.63,58.63,10,21,2,0)
be linked to a PADE cabinet, making it unnecessary to type in each 
"^DD",58.63,58.63,10,21,3,0)
individual Clinic name. For example, if all surgery clinics in a division
"^DD",58.63,58.63,10,21,4,0)
begin with 'AL-SURGERY', the surgery clinics could all be linked to a PADE
"^DD",58.63,58.63,10,21,5,0)
cabinet by creating a wildcard called "AL-SURGERY". 
"^DD",58.63,58.63,10,21,6,0)
When clinic orders are viewed, finished, or edited in Inpatient Order 
"^DD",58.63,58.63,10,21,7,0)
Entry, the order's clinic location is compared to this pattern/wildcard to
"^DD",58.63,58.63,10,21,8,0)
determine if PADE information should be displayed, indicating the order's 
"^DD",58.63,58.63,10,21,9,0)
medication may be dispensed from a PADE cabinet.
"^DD",58.63,58.63,11,0)
SEND 'PATIENT NOT ON FILE' MSG^S^1:YES;0:NO;^8;1^Q
"^DD",58.63,58.63,11,3)
Enter 'YES' to generate error messages when invalid patient ID's are received.
"^DD",58.63,58.63,11,21,0)
^^3^3^3160125^
"^DD",58.63,58.63,11,21,1,0)
This field contains a flag indicating whether or not an error message 
"^DD",58.63,58.63,11,21,2,0)
should be generated by the inbound PADE HL7 interface when a patient ID
"^DD",58.63,58.63,11,21,3,0)
is received that does not exist in the local system.
"^DD",58.63,58.63,11,"DT")
3160125
"^DD",58.63,58.63,12,0)
ALTERNATE IDENTIFIER^FX^^8;2^K:$L(X)>30!($L(X)<1) X S X=$$UPPER^PSJPDRUT(X)
"^DD",58.63,58.63,12,1,0)
^.1
"^DD",58.63,58.63,12,1,1,0)
58.63^E
"^DD",58.63,58.63,12,1,1,1)
S ^PS(58.63,"E",$E(X,1,30),DA)=""
"^DD",58.63,58.63,12,1,1,2)
K ^PS(58.63,"E",$E(X,1,30),DA)
"^DD",58.63,58.63,12,1,1,"DT")
3160318
"^DD",58.63,58.63,12,3)
*No editing* 
"^DD",58.63,58.63,12,21,0)
^^4^4^3160505^
"^DD",58.63,58.63,12,21,1,0)
This is an internal alternate identifier that is used to create the "E" 
"^DD",58.63,58.63,12,21,2,0)
cross reference used to help identify the PADE dispensing device/cabinet 
"^DD",58.63,58.63,12,21,3,0)
when lower case and/or mixed case cabinet names are entered.
"^DD",58.63,58.63,12,21,4,0)
** Do NOT edit directly using VA FileMan.  **
"^DD",58.63,58.63,12,"DT")
3160318
"^DD",58.63,58.635,0)
WARD GROUP SUB-FIELD^^.01^1
"^DD",58.63,58.635,0,"DT")
3151005
"^DD",58.63,58.635,0,"IX","B",58.635,.01)

"^DD",58.63,58.635,0,"NM","WARD GROUP")

"^DD",58.63,58.635,0,"UP")
58.63
"^DD",58.63,58.635,.01,0)
WARD GROUP^M*P57.5'^PS(57.5,^0;1^S DIC("S")="I $$WGCHK2^PSJPADSI(Y,DA)" D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"^DD",58.63,58.635,.01,1,0)
^.1
"^DD",58.63,58.635,.01,1,1,0)
58.635^B
"^DD",58.63,58.635,.01,1,1,1)
S ^PS(58.63,DA(1),3,"B",$E(X,1,30),DA)=""
"^DD",58.63,58.635,.01,1,1,2)
K ^PS(58.63,DA(1),3,"B",$E(X,1,30),DA)
"^DD",58.63,58.635,.01,3)
Enter a Ward Group supplied by this PADE device.
"^DD",58.63,58.635,.01,12)
Ward must be associated with Device's Division.
"^DD",58.63,58.635,.01,12.1)
S DIC("S")="I $$WGCHK2^PSJPADSI(Y,DA)"
"^DD",58.63,58.635,.01,21,0)
^^1^1^3151201^
"^DD",58.63,58.635,.01,21,1,0)
Ward Group associated with this PADE device.
"^DD",58.63,58.635,.01,"DT")
3151208
"^DD",58.63,58.636,0)
WARD LOCATION SUB-FIELD^^.01^1
"^DD",58.63,58.636,0,"DT")
3151005
"^DD",58.63,58.636,0,"IX","B",58.636,.01)

"^DD",58.63,58.636,0,"NM","WARD LOCATION")

"^DD",58.63,58.636,0,"UP")
58.63
"^DD",58.63,58.636,.01,0)
WARD LOCATION^M*P42'^DIC(42,^0;1^S DIC("S")="I $$WARDSCR2^PSJPADSI(Y,DA)" D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"^DD",58.63,58.636,.01,1,0)
^.1^^-1
"^DD",58.63,58.636,.01,1,1,0)
58.636^B
"^DD",58.63,58.636,.01,1,1,1)
S ^PS(58.63,DA(1),4,"B",$E(X,1,30),DA)=""
"^DD",58.63,58.636,.01,1,1,2)
K ^PS(58.63,DA(1),4,"B",$E(X,1,30),DA)
"^DD",58.63,58.636,.01,3)
Enter a Ward Location supplied by this PADE device.
"^DD",58.63,58.636,.01,12)
Only allow ward associated with Division
"^DD",58.63,58.636,.01,12.1)
S DIC("S")="I $$WARDSCR2^PSJPADSI(Y,DA)"
"^DD",58.63,58.636,.01,21,0)
^^1^1^3151201^
"^DD",58.63,58.636,.01,21,1,0)
Ward Location associated with this PADE device.
"^DD",58.63,58.636,.01,"DT")
3151208
"^DD",58.63,58.637,0)
CLINIC GROUP SUB-FIELD^^.01^1
"^DD",58.63,58.637,0,"DT")
3151005
"^DD",58.63,58.637,0,"IX","B",58.637,.01)

"^DD",58.63,58.637,0,"NM","CLINIC GROUP")

"^DD",58.63,58.637,0,"UP")
58.63
"^DD",58.63,58.637,.01,0)
CLINIC GROUP^M*P57.8'^PS(57.8,^0;1^S DIC("S")="I $$CGCHK2^PSJPADSI(Y,DA)" D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"^DD",58.63,58.637,.01,1,0)
^.1
"^DD",58.63,58.637,.01,1,1,0)
58.637^B
"^DD",58.63,58.637,.01,1,1,1)
S ^PS(58.63,DA(1),5,"B",$E(X,1,30),DA)=""
"^DD",58.63,58.637,.01,1,1,2)
K ^PS(58.63,DA(1),5,"B",$E(X,1,30),DA)
"^DD",58.63,58.637,.01,3)
Enter a Clinic Group supplied by this PADE device.
"^DD",58.63,58.637,.01,12)
Allow only Clinic Groups associated with Division
"^DD",58.63,58.637,.01,12.1)
S DIC("S")="I $$CGCHK2^PSJPADSI(Y,DA)"
"^DD",58.63,58.637,.01,21,0)
^^1^1^3151201^
"^DD",58.63,58.637,.01,21,1,0)
Clinic Groups associated with this PADE device.
"^DD",58.63,58.637,.01,"DT")
3151208
"^DD",58.63,58.638,0)
CLINIC LOCATION SUB-FIELD^^.01^1
"^DD",58.63,58.638,0,"DT")
3151005
"^DD",58.63,58.638,0,"IX","B",58.638,.01)

"^DD",58.63,58.638,0,"NM","CLINIC LOCATION")

"^DD",58.63,58.638,0,"UP")
58.63
"^DD",58.63,58.638,.01,0)
CLINIC LOCATION^M*P44'^SC(^0;1^S DIC("S")="I $$CLCHK2^PSJPADSI(Y,DA)" D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"^DD",58.63,58.638,.01,1,0)
^.1
"^DD",58.63,58.638,.01,1,1,0)
58.638^B
"^DD",58.63,58.638,.01,1,1,1)
S ^PS(58.63,DA(1),6,"B",$E(X,1,30),DA)=""
"^DD",58.63,58.638,.01,1,1,2)
K ^PS(58.63,DA(1),6,"B",$E(X,1,30),DA)
"^DD",58.63,58.638,.01,3)
Enter a Clinic location supplied by this PADE device.
"^DD",58.63,58.638,.01,12)
Allow only Clinic associated with Division
"^DD",58.63,58.638,.01,12.1)
S DIC("S")="I $$CLCHK2^PSJPADSI(Y,DA)"
"^DD",58.63,58.638,.01,21,0)
^.001^1^1^3151201^^^^
"^DD",58.63,58.638,.01,21,1,0)
Clinic locations associated with this PADE device.
"^DD",58.63,58.638,.01,"DT")
3151208
"^DD",58.63,58.639,0)
PADE RESET SUB-FIELD^^.01^1
"^DD",58.63,58.639,0,"DT")
3151208
"^DD",58.63,58.639,0,"IX","B",58.639,.01)

"^DD",58.63,58.639,0,"NM","PADE RESET")

"^DD",58.63,58.639,0,"UP")
58.63
"^DD",58.63,58.639,.01,0)
PADE RESET^D^^0;1^S %DT="ESTXR" D ^%DT S X=Y K:Y<1 X
"^DD",58.63,58.639,.01,1,0)
^.1
"^DD",58.63,58.639,.01,1,1,0)
58.639^B
"^DD",58.63,58.639,.01,1,1,1)
S ^PS(58.63,DA(1),1,"B",$E(X,1,30),DA)=""
"^DD",58.63,58.639,.01,1,1,2)
K ^PS(58.63,DA(1),1,"B",$E(X,1,30),DA)
"^DD",58.63,58.639,.01,3)
Enter the Date/Time the PADE cabinet balances were reset to zero.
"^DD",58.63,58.639,.01,21,0)
^^10^10^3151221^
"^DD",58.63,58.639,.01,21,1,0)
This field removes all medications linked to this PADE cabinet in VistA,
"^DD",58.63,58.639,.01,21,2,0)
making the cabinet appear empty to VistA users. Resetting a PADE cabinet
"^DD",58.63,58.639,.01,21,3,0)
does not affect the PADE vendor, and does not trigger any HL7 messages to
"^DD",58.63,58.639,.01,21,4,0)
the PADE system. Resetting a PADE cabinet makes the device unavailable for
"^DD",58.63,58.639,.01,21,5,0)
selection when running the PADE INVENTORY REPORT, and also removes the 
"^DD",58.63,58.639,.01,21,6,0)
device from the list of PADE cabinets used to update Inpatient Order Entry
"^DD",58.63,58.639,.01,21,7,0)
with PADE information.
"^DD",58.63,58.639,.01,21,8,0)
 
"^DD",58.63,58.639,.01,21,9,0)
After a PADE cabinet is reset, medications will be automatically added
"^DD",58.63,58.639,.01,21,10,0)
back to the PADE as new HL7 messages are received from the vendor.
"^DD",58.63,58.639,.01,"DT")
3151208
"^DD",58.63,58.65,0)
WILDCARD CLINIC NAME SUB-FIELD^^.01^1
"^DD",58.63,58.65,0,"DT")
3151208
"^DD",58.63,58.65,0,"IX","B",58.65,.01)

"^DD",58.63,58.65,0,"NM","WILDCARD CLINIC NAME")

"^DD",58.63,58.65,0,"UP")
58.63
"^DD",58.63,58.65,.01,0)
WILDCARD CLINIC NAME^MF^^0;1^K:$L(X)>30!($L(X)<3) X
"^DD",58.63,58.65,.01,1,0)
^.1
"^DD",58.63,58.65,.01,1,1,0)
58.65^B
"^DD",58.63,58.65,.01,1,1,1)
S ^PS(58.63,DA(1),7,"B",$E(X,1,30),DA)=""
"^DD",58.63,58.65,.01,1,1,2)
K ^PS(58.63,DA(1),7,"B",$E(X,1,30),DA)
"^DD",58.63,58.65,.01,3)
Answer must be 3-30 characters in length.
"^DD",58.63,58.65,.01,21,0)
^^8^8^3151209^
"^DD",58.63,58.65,.01,21,1,0)
This field allows a group of Clinics with a common naming 
"^DD",58.63,58.65,.01,21,2,0)
convention, or 'wildcard', to be linked to a PADE cabinet, 
"^DD",58.63,58.65,.01,21,3,0)
automatically linking all matching Clinic names with the 
"^DD",58.63,58.65,.01,21,4,0)
PADE cabinet. 
"^DD",58.63,58.65,.01,21,5,0)
 
"^DD",58.63,58.65,.01,21,6,0)
For example, if all of a division's surgery clinics began with
"^DD",58.63,58.65,.01,21,7,0)
'AL-SURGERY', all the surgery clinics could be linked to a PADE 
"^DD",58.63,58.65,.01,21,8,0)
cabinet by creating a wildcard called "AL-SURGERY".
"^DD",58.63,58.65,.01,"DT")
3151208
"^DD",58.64,58.64,0)
FIELD^^2^4
"^DD",58.64,58.64,0,"DDA")
N
"^DD",58.64,58.64,0,"DT")
3160323
"^DD",58.64,58.64,0,"IX","B",58.64,.01)

"^DD",58.64,58.64,0,"NM","PADE USER")

"^DD",58.64,58.64,0,"VRPK")
PSJ
"^DD",58.64,58.64,.01,0)
NAME^RFX^^0;1^K XLFNC K:($L(X,",")'=2) X I $D(X) S XLFNC=X,(X,XLFNC)=$$FORMAT^XLFNAME7(.XLFNC,3,35,,,,,2) K:$L(X)>35!($L(X)<3)!($L(X,",")'=2)!(X'?1.E1","1.E) X,XLFNC K:'$G(XUITNAME) XLFNC
"^DD",58.64,58.64,.01,1,0)
^.1
"^DD",58.64,58.64,.01,1,1,0)
58.64^B
"^DD",58.64,58.64,.01,1,1,1)
S ^PS(58.64,"B",$E(X,1,30),DA)=""
"^DD",58.64,58.64,.01,1,1,2)
K ^PS(58.64,"B",$E(X,1,30),DA)
"^DD",58.64,58.64,.01,3)
Answer must be 3-35 upper-case characters in length, and be in the format Family(Last),Given(First) Middle Suffix. Enter '??' for more help.
"^DD",58.64,58.64,.01,21,0)
^.001^7^7^3160304^^^
"^DD",58.64,58.64,.01,21,1,0)
The PADE USER name as defined on the PADE vendor system.
"^DD",58.64,58.64,.01,21,2,0)
Enter only data that is actually part of the person's name. Do not
"^DD",58.64,58.64,.01,21,3,0)
include extra titles, identification, flags, local information, etc.
"^DD",58.64,58.64,.01,21,4,0)
Enter the person's name in 'LAST,FIRST MIDDLE SUFFIX' format.
"^DD",58.64,58.64,.01,21,5,0)
This value must be 3-35 characters in length and may contain only
"^DD",58.64,58.64,.01,21,6,0)
uppercase alpha characters, spaces, apostrophes, hyphens and one comma.
"^DD",58.64,58.64,.01,21,7,0)
All other characters and parenthetical text will be removed.
"^DD",58.64,58.64,1,0)
PADE ID^RF^^0;2^K:$L(X)>30!($L(X)<2) X
"^DD",58.64,58.64,1,3)
Answer must be 2-30 characters in length.
"^DD",58.64,58.64,1,21,0)
^^1^1^3151201^
"^DD",58.64,58.64,1,21,1,0)
The PADE identifier for this user.
"^DD",58.64,58.64,1,"DT")
3151123
"^DD",58.64,58.64,1.1,0)
PADE INBOUND SYSTEM^RP58.601'^PS(58.601,^0;4^Q
"^DD",58.64,58.64,1.1,3)
Select the PADE INVENTORY SYSTEM associated with this PADE USER.
"^DD",58.64,58.64,1.1,21,0)
^.001^2^2^3151201^^^
"^DD",58.64,58.64,1.1,21,1,0)
The PADE INVENTORY SYSTEM from which the PADE user was originally 
"^DD",58.64,58.64,1.1,21,2,0)
received.
"^DD",58.64,58.64,1.1,"DT")
3151123
"^DD",58.64,58.64,2,0)
VISTA USER^P200'^VA(200,^0;3^Q
"^DD",58.64,58.64,2,3)
Select a user from the NEW PERSON (#200) file.
"^DD",58.64,58.64,2,21,0)
^^1^1^3151201^
"^DD",58.64,58.64,2,21,1,0)
The VistA user associated with this PADE USER entry.
"^DD",58.64,58.64,2,"DT")
3151123
"^DD",58.7,58.7,0)
FIELD^^3.6^8
"^DD",58.7,58.7,0,"DDA")
N
"^DD",58.7,58.7,0,"DT")
3151117
"^DD",58.7,58.7,0,"IX","B",58.7,.01)

"^DD",58.7,58.7,0,"NM","PADE SYSTEM SETUP")

"^DD",58.7,58.7,0,"PT",58.601,2)

"^DD",58.7,58.7,0,"PT",58.72,10)

"^DD",58.7,58.7,0,"VRPK")
PSJ
"^DD",58.7,58.7,.01,0)
PADE SYSTEM^RFX^^0;1^K:$L(X)>30!($L(X)<3)!'(X'?1P.E) X
"^DD",58.7,58.7,.01,1,0)
^.1
"^DD",58.7,58.7,.01,1,1,0)
58.7^B
"^DD",58.7,58.7,.01,1,1,1)
S ^PS(58.7,"B",$E(X,1,30),DA)=""
"^DD",58.7,58.7,.01,1,1,2)
K ^PS(58.7,"B",$E(X,1,30),DA)
"^DD",58.7,58.7,.01,3)
Answer must be 3-30 characters in length.
"^DD",58.7,58.7,.01,21,0)
^.001^4^4^3150825^^^
"^DD",58.7,58.7,.01,21,1,0)
This is the name of the Pharmacy Automated Dispensing Equipment (PADE)
"^DD",58.7,58.7,.01,21,2,0)
system like Pyxis, OmniCell, AccuDose etc., that supports
"^DD",58.7,58.7,.01,21,3,0)
single/multiple cabinets, located in Inpatient Wards and Outpatient
"^DD",58.7,58.7,.01,21,4,0)
Clinics to stock items (drug/non-drug) for dispensing.
"^DD",58.7,58.7,.01,"DEL",1,0)
I 1 D EN^DDIOL("PADE System cannot be deleted, it must be inactivated!","","$C(7),!?5")
"^DD",58.7,58.7,.01,"DT")
3150824
"^DD",58.7,58.7,1,0)
DNS NAME/IP ADDRESS^F^^0;2^K:$L(X)>50!($L(X)<3) X
"^DD",58.7,58.7,1,3)
Answer must be 3-50 characters in length.
"^DD",58.7,58.7,1,21,0)
^^1^1^3150624^
"^DD",58.7,58.7,1,21,1,0)
This is the DNS name or the IP address of the PADE System.
"^DD",58.7,58.7,1,"DT")
3150624
"^DD",58.7,58.7,2,0)
PORT^NJ5,0^^0;3^K:+X'=X!(X>65535)!(X<3)!(X?.E1"."1.N) X
"^DD",58.7,58.7,2,3)
Type a number between 3 and 65535, 0 decimal digits.
"^DD",58.7,58.7,2,21,0)
^^1^1^3150624^
"^DD",58.7,58.7,2,21,1,0)
This is the port number associated with the PADE System.
"^DD",58.7,58.7,2,"DT")
3150624
"^DD",58.7,58.7,2.5,0)
SEND DRUG FILE MESSAGES^S^N:NEW DRUGS;U:UPDATES;B:BOTH;X:NONE;^0;5^Q
"^DD",58.7,58.7,2.5,3)
Select if users should be prompted to send HL7 messages to PADE during DRUG ENTER/EDIT option
"^DD",58.7,58.7,2.5,21,0)
^^18^18^3160226^
"^DD",58.7,58.7,2.5,21,1,0)
This parameter will determine if the user will be prompted to send HL7 
"^DD",58.7,58.7,2.5,21,2,0)
drug formulary messages to PADE when using the DRUG ENTER/EDIT option.  
"^DD",58.7,58.7,2.5,21,3,0)
When set to "N" (for New DRUGS), the user will be prompted to send a 
"^DD",58.7,58.7,2.5,21,4,0)
message to PADE only when the DRUG ENTER/EDIT option is used to create  
"^DD",58.7,58.7,2.5,21,5,0)
NEW entries. If the parameter is set to "U" (for UPDATES) then the user 
"^DD",58.7,58.7,2.5,21,6,0)
will only be prompted to send  messages when updating/changing current 
"^DD",58.7,58.7,2.5,21,7,0)
entries with the DRUG ENTER/EDIT OPTION. IF this parameter is set to
"^DD",58.7,58.7,2.5,21,8,0)
"B" (for BOTH), then the user will be prompted during both of these
"^DD",58.7,58.7,2.5,21,9,0)
scenarios. If the parameter is set to "X" (NONE) or left NULL/blank,
"^DD",58.7,58.7,2.5,21,10,0)
then the user will never be prompted to send NEW or UPDATES to PADE
"^DD",58.7,58.7,2.5,21,11,0)
when using the DRUG ENTER/EDIT option.
"^DD",58.7,58.7,2.5,21,12,0)
 
"^DD",58.7,58.7,2.5,21,13,0)
This parameter will also impact the functioning of the MASTER FILE
"^DD",58.7,58.7,2.5,21,14,0)
update option, which can always be used to send the formulary messages
"^DD",58.7,58.7,2.5,21,15,0)
for one or all appropriate drugs to PADE. As defined above, setting this
"^DD",58.7,58.7,2.5,21,16,0)
parameter to "N" (NEW), "U" (UPDATE) or "B" (BOTH) will allow you to
"^DD",58.7,58.7,2.5,21,17,0)
send the formulary messages to PADE as new drugs. Setting to "X" or left
"^DD",58.7,58.7,2.5,21,18,0)
NULL/blank, will not allow you to send any formulary messages to PADE.
"^DD",58.7,58.7,2.5,"DT")
3160226
"^DD",58.7,58.7,3,0)
INACTIVE DATE^D^^0;4^S %DT="EX" D ^%DT S X=Y K:X<1 X
"^DD",58.7,58.7,3,3)
Enter the date the PADE became inactive.
"^DD",58.7,58.7,3,21,0)
^^1^1^3151210^
"^DD",58.7,58.7,3,21,1,0)
This is the PADE inactivation date.
"^DD",58.7,58.7,3,"DT")
3151210
"^DD",58.7,58.7,3.5,0)
SEND CHECKIN/SURG HL7 FOR INPT^S^Y:YES;N:NO;^0;6^Q
"^DD",58.7,58.7,3.5,3)
Select if HL7 messages should be sent to PADE for admitted patients if they have clinical appointments, surgery cases or check-ins.
"^DD",58.7,58.7,3.5,21,0)
^^8^8^3151118^
"^DD",58.7,58.7,3.5,21,1,0)
This parameter applies to ADMITTED patient only. Enter "YES" if HL7 
"^DD",58.7,58.7,3.5,21,2,0)
scheduling messages should still be sent when checking in clinic
"^DD",58.7,58.7,3.5,21,3,0)
appointments (IP appointments) or surgical cases (via manual 
"^DD",58.7,58.7,3.5,21,4,0)
option/background task)or background job when the system finds that the
"^DD",58.7,58.7,3.5,21,5,0)
patient is ADMITTED.
"^DD",58.7,58.7,3.5,21,6,0)
This is vendor dependent and should only be set to "NO" when it is
"^DD",58.7,58.7,3.5,21,7,0)
known that these messages could cause the inpatient to be removed from
"^DD",58.7,58.7,3.5,21,8,0)
their IP location on the vendor device.
"^DD",58.7,58.7,3.5,"DT")
3151209
"^DD",58.7,58.7,3.6,0)
DAYS TO PULL AHEAD FOR BG JOB^NJ2,0^^1;1^K:+X'=X!(X>30)!(X<0)!(X?.E1"."1.N) X
"^DD",58.7,58.7,3.6,3)
Type a number between 0 and 30, 0 decimal digits.
"^DD",58.7,58.7,3.6,21,0)
^^7^7^3151118^
"^DD",58.7,58.7,3.6,21,1,0)
Check-in for a clinic will generate HL7 messages to PADE in real time.
"^DD",58.7,58.7,3.6,21,2,0)
Clinics that do not have check-in, there is a nightly job that can be 
"^DD",58.7,58.7,3.6,21,3,0)
scheduled to run on a daily basis that will generate HL7 messages to 
"^DD",58.7,58.7,3.6,21,4,0)
PADE. If there is a need for you to send clinic appointments for future 
"^DD",58.7,58.7,3.6,21,5,0)
days as well then populating this field will help to pull those 
"^DD",58.7,58.7,3.6,21,6,0)
appointments in your nightly job. We allow a maximum of 30 days, but
"^DD",58.7,58.7,3.6,21,7,0)
keep this to a minimum as it may impact your network traffic.
"^DD",58.7,58.7,3.6,"DT")
3151118
"^DD",58.7,58.7,4,0)
DIVISION^58.74P^^DIV;0
"^DD",58.7,58.7,4,21,0)
^^6^6^3151210^
"^DD",58.7,58.7,4,21,1,0)
All Medical Center Divisions associated with this PADE have to be defined 
"^DD",58.7,58.7,4,21,2,0)
here. The wards and clinics under these divisions if they are associated 
"^DD",58.7,58.7,4,21,3,0)
with this PADE then they need to be defined so that the HL7 messages 
"^DD",58.7,58.7,4,21,4,0)
triggered by events like admission/discharge/transfer, clinic 
"^DD",58.7,58.7,4,21,5,0)
appointments, surgery cases, check-ins, inpatient medication orders or 
"^DD",58.7,58.7,4,21,6,0)
drug formulary updates, will be sent to PADE.
"^DD",58.7,58.74,0)
DIVISION SUB-FIELD^^2.1^19
"^DD",58.7,58.74,0,"DT")
3151117
"^DD",58.7,58.74,0,"IX","B",58.74,.01)

"^DD",58.7,58.74,0,"NM","DIVISION")

"^DD",58.7,58.74,0,"UP")
58.7
"^DD",58.7,58.74,.01,0)
DIVISION^MMMP40.8'X^DG(40.8,^0;1^S DINUM=X I $D(^XUSEC("PSJ PADE ADV",DUZ)),'$D(^PS(58.7,DA,"DIV",X,0)) K X
"^DD",58.7,58.74,.01,1,0)
^.1
"^DD",58.7,58.74,.01,1,1,0)
58.74^B
"^DD",58.7,58.74,.01,1,1,1)
S ^PS(58.7,DA(1),"DIV","B",$E(X,1,30),DA)=""
"^DD",58.7,58.74,.01,1,1,2)
K ^PS(58.7,DA(1),"DIV","B",$E(X,1,30),DA)
"^DD",58.7,58.74,.01,3)
Enter the division you want to associate with the PADE system.
"^DD",58.7,58.74,.01,21,0)
^^5^5^3160425^
"^DD",58.7,58.74,.01,21,1,0)
This is the MEDICAL CENTER DIVISION associated with the WARDS and
"^DD",58.7,58.74,.01,21,2,0)
CLINICS that are to be defined for this PADE system. You will only be
"^DD",58.7,58.74,.01,21,3,0)
able to define WARDS and Clinics that are associated with this DIVISION.
"^DD",58.7,58.74,.01,21,4,0)
Users with the PSJ PADE ADV key may only edit existing divisions in the
"^DD",58.7,58.74,.01,21,5,0)
multiple and may not add new ones.
"^DD",58.7,58.74,.01,"DEL",1,0)
I 1 D EN^DDIOL("Division cannot be deleted, it must be inactivated!","","$C(7),!?5")
"^DD",58.7,58.74,.01,"DT")
3160425
"^DD",58.7,58.74,1,0)
INACTIVE DATE^D^^0;2^S %DT="EX" D ^%DT S X=Y K:X<1 X
"^DD",58.7,58.74,1,3)
Enter the date you want to inactivate the Division from this PADE.
"^DD",58.7,58.74,1,21,0)
^^2^2^3150429^
"^DD",58.7,58.74,1,21,1,0)
This is the date on or after which the division will no longer 
"^DD",58.7,58.74,1,21,2,0)
communicate with the PADE system.
"^DD",58.7,58.74,1,"DT")
3151209
"^DD",58.7,58.74,2,0)
SEND MESSAGES FOR ALL CLINICS?^S^Y:YES;N:NO;^0;3^Q
"^DD",58.7,58.74,2,3)
Select "YES" if all clinic medication order messages will be sent to PADE. This also includes SIU messages.
"^DD",58.7,58.74,2,21,0)
^^14^14^3160226^
"^DD",58.7,58.74,2,21,1,0)
Enter "YES" if all clinic medication order messages will be sent to
"^DD",58.7,58.74,2,21,2,0)
PADE. This also includes SIU messages generated by clinic appointment
"^DD",58.7,58.74,2,21,3,0)
activity/triggers.
"^DD",58.7,58.74,2,21,4,0)
 
"^DD",58.7,58.74,2,21,5,0)
Caution should be taken when choosing to send ALL clinic messages
"^DD",58.7,58.74,2,21,6,0)
(orders and SIU) from a particular division due to the potentially
"^DD",58.7,58.74,2,21,7,0)
large volume of messages sent. This is particularly true if you
"^DD",58.7,58.74,2,21,8,0)
answer YES to this field and leave the DEFAULT CLINIC SEND AREA
"^DD",58.7,58.74,2,21,9,0)
field Null/Blank. In that case, all clinic messages (orders and SIU)
"^DD",58.7,58.74,2,21,10,0)
will be sent to PADE for all clinics in that division using the FULL
"^DD",58.7,58.74,2,21,11,0)
clinic name instead of a DEFAULT CLINIC SEND AREA. This may create
"^DD",58.7,58.74,2,21,12,0)
a distinct location on the vendor side for each unique clinic name
"^DD",58.7,58.74,2,21,13,0)
passed. Be sure to work with your vendor to ensure their capabilities
"^DD",58.7,58.74,2,21,14,0)
prior to setting this field to YES.
"^DD",58.7,58.74,2,"DT")
3160226
"^DD",58.7,58.74,2.1,0)
INCLUDE ALL CLINICS IN BG JOB^S^Y:YES;^0;9^Q
"^DD",58.7,58.74,2.1,3)
Select "YES" if the nightly background job should run for all clinics in this division and generate SIU messages to PADE.
"^DD",58.7,58.74,2.1,21,0)
^^4^4^3151209^^
"^DD",58.7,58.74,2.1,21,1,0)
Enter "YES" if the nightly background job should run for all clinics in 
"^DD",58.7,58.74,2.1,21,2,0)
this division and generate appointment messages to PADE. If there are 
"^DD",58.7,58.74,2.1,21,3,0)
clinics where you do check-in then do not populate this field as 
"^DD",58.7,58.74,2.1,21,4,0)
check-in will generate appointment messages to PADE.
"^DD",58.7,58.74,2.1,"DT")
3151209
"^DD",58.7,58.74,3,0)
DEFAULT CLINIC SEND AREA^P58.71'X^PS(58.71,^0;4^Q
"^DD",58.7,58.74,3,3)
Enter a default PADE location that will be used for all clinic messages.
"^DD",58.7,58.74,3,21,0)
^^8^8^3160216^
"^DD",58.7,58.74,3,21,1,0)
This is the default PADE cabinet location for clinic messages that will
"^DD",58.7,58.74,3,21,2,0)
be used if the individual clinics are not defined. If SEND MESSAGES 
"^DD",58.7,58.74,3,21,3,0)
FOR ALL CLINICS? field is set to NULL or "NO" then this field is not
"^DD",58.7,58.74,3,21,4,0)
used and the PADE location must be defined individually for each clinic.
"^DD",58.7,58.74,3,21,5,0)
 
"^DD",58.7,58.74,3,21,6,0)
This area must be defined on the PADE vendor system and also defined in
"^DD",58.7,58.74,3,21,7,0)
PADE SEND AREA file (#58.71) to ensure that the messages are routed to
"^DD",58.7,58.74,3,21,8,0)
the intended location on the PADE vendor system.
"^DD",58.7,58.74,3,"DT")
3160216
"^DD",58.7,58.74,3.5,0)
SEND SURGERY MESSAGES?^S^Y:YES;N:NO;^0;8^Q
"^DD",58.7,58.74,3.5,3)
Select "YES" to send Surgery messages for this division.
"^DD",58.7,58.74,3.5,21,0)
^^4^4^3160229^
"^DD",58.7,58.74,3.5,21,1,0)
Entering "YES" in this field will send SIU messages for surgical cases 
"^DD",58.7,58.74,3.5,21,2,0)
scheduled in operating rooms defined within this division. This feature 
"^DD",58.7,58.74,3.5,21,3,0)
may not be needed if surgical cases for this division have associated 
"^DD",58.7,58.74,3.5,21,4,0)
clinic appointments into which patients are being checked into.
"^DD",58.7,58.74,3.5,"DT")
3160229
"^DD",58.7,58.74,3.7,0)
SEND ORDER MESSAGES?^S^Y:YES;N:NO;^2;1^Q
"^DD",58.7,58.74,3.7,3)
Enter "YES" to generate pharmacy order messages to PADE
"^DD",58.7,58.74,3.7,21,0)
^^7^7^3150913^
"^DD",58.7,58.74,3.7,21,1,0)
Entering YES in this field will allow pharmacy order messages from the 
"^DD",58.7,58.74,3.7,21,2,0)
inpatient medication package (including clinic orders) to be sent for 
"^DD",58.7,58.74,3.7,21,3,0)
wards and clinics defined in the PADE parameters for this division.
"^DD",58.7,58.74,3.7,21,4,0)
Note: You may also filter out IV package and non-CS orders in the
"^DD",58.7,58.74,3.7,21,5,0)
other parameters of this option, however this field must be set to YES
"^DD",58.7,58.74,3.7,21,6,0)
before those parameters are checked. Enter "NO" if this division's PADE
"^DD",58.7,58.74,3.7,21,7,0)
cabinets are not capable or not configured to accept order massages.
"^DD",58.7,58.74,3.7,"DT")
3150913
"^DD",58.7,58.74,3.8,0)
SEND CS ORDERS ONLY?^S^Y:YES;N:NO;^3;1^Q
"^DD",58.7,58.74,3.8,3)
Enter "YES" to only send orders for controlled substances to PADE
"^DD",58.7,58.74,3.8,21,0)
^^6^6^3150913^
"^DD",58.7,58.74,3.8,21,1,0)
When this field is set to "YES", and the field "SEND ORDER MESSAGES?"
"^DD",58.7,58.74,3.8,21,2,0)
is also set to "YES"; then only order messages for medications with
"^DD",58.7,58.74,3.8,21,3,0)
a dispense drug having a DEA, SPECIAL HDLG field (#3) of the DRUG
"^DD",58.7,58.74,3.8,21,4,0)
file (#50) containing 2,3,4 or 5 will transmit to PADE for the wards
"^DD",58.7,58.74,3.8,21,5,0)
and clinics defined for this division. Use this field if you only use
"^DD",58.7,58.74,3.8,21,6,0)
the PADE cabinets of this division to stock controlled substances.
"^DD",58.7,58.74,3.8,"DT")
3150913
"^DD",58.7,58.74,4,0)
SEND INPT IV PACKAGE ORDERS?^S^Y:YES;N:NO;^0;5^Q
"^DD",58.7,58.74,4,3)
Select "YES" if all IV package orders associated with wards of this division will send messages to PADE.
"^DD",58.7,58.74,4,21,0)
^^2^2^3151209^^
"^DD",58.7,58.74,4,21,1,0)
Enter "YES" if all IV package orders associated with wards of this 
"^DD",58.7,58.74,4,21,2,0)
division will send messages to PADE.
"^DD",58.7,58.74,4,"DT")
3151209
"^DD",58.7,58.74,4.5,0)
SEND CLINIC IV PACKAGE ORDERS?^S^Y:YES;N:NO;^0;7^Q
"^DD",58.7,58.74,4.5,3)
Select "YES" if all IV package orders associated with clinics of this division will send messages to PADE.
"^DD",58.7,58.74,4.5,21,0)
^^2^2^3150603^
"^DD",58.7,58.74,4.5,21,1,0)
Enter "YES" if all IV package orders associated with clinics of this
"^DD",58.7,58.74,4.5,21,2,0)
division will send messages to PADE.
"^DD",58.7,58.74,4.5,"DT")
3151209
"^DD",58.7,58.74,5,0)
MAIL GROUP FOR NOTIFICATION^P3.8'^XMB(3.8,^0;6^Q
"^DD",58.7,58.74,5,3)
Select the mail group for this division that will be used for system messages.
"^DD",58.7,58.74,5,21,0)
^^2^2^3151209^
"^DD",58.7,58.74,5,21,1,0)
Enter the mail group for this division that will be used for system
"^DD",58.7,58.74,5,21,2,0)
messages.
"^DD",58.7,58.74,5,"DT")
3151209
"^DD",58.7,58.74,6,0)
WARD GROUP^58.746P^^WG;0
"^DD",58.7,58.74,6,21,0)
^^2^2^3151210^
"^DD",58.7,58.74,6,21,1,0)
This multiple groups all wards in a division so that the messages 
"^DD",58.7,58.74,6,21,2,0)
associated to these wards can be sent to a defined PADE cabinet.
"^DD",58.7,58.74,7,0)
WARD^58.747P^^WD;0
"^DD",58.7,58.74,7,21,0)
^^1^1^3151209^
"^DD",58.7,58.74,7,21,1,0)
Enter all wards for this division that are associated with this PADE.
"^DD",58.7,58.74,8,0)
PADE CLINIC GROUP^58.748^^PCG;0
"^DD",58.7,58.74,8,21,0)
^^2^2^3151210^
"^DD",58.7,58.74,8,21,1,0)
This multiple groups selected clinics in a division so that the messages
"^DD",58.7,58.74,8,21,2,0)
associated to these clinics can be sent to a defined PADE cabinet.
"^DD",58.7,58.74,9,0)
CLINIC^58.749P^^CL;0
"^DD",58.7,58.74,9,21,0)
^^1^1^3151210^
"^DD",58.7,58.74,9,21,1,0)
Enter all clinics for this division that are associated with this PADE.
"^DD",58.7,58.74,10,0)
PADE BED GROUP^58.741^^BG;0
"^DD",58.7,58.74,10,21,0)
^^2^2^3151210^
"^DD",58.7,58.74,10,21,1,0)
This multiple groups selected beds in a ward so that the messages can be
"^DD",58.7,58.74,10,21,2,0)
sent to a defined PADE cabinet.
"^DD",58.7,58.74,10,"DT")
3150514
"^DD",58.7,58.74,11,0)
VISTA CLINIC GROUP^58.742P^^VCG;0
"^DD",58.7,58.74,11,21,0)
^^3^3^3151210^
"^DD",58.7,58.74,11,21,1,0)
This multiple groups the VistA clinic groups already setup in a division
"^DD",58.7,58.74,11,21,2,0)
so that the messages associated to the clinics in these groups can be sent
"^DD",58.7,58.74,11,21,3,0)
to a defined PADE cabinet.
"^DD",58.7,58.74,12,0)
PADE WILDCARD CLINIC NAME^58.7412^^WCN;0
"^DD",58.7,58.74,12,21,0)
^^3^3^3151210^
"^DD",58.7,58.74,12,21,1,0)
This multiple groups clinics that follow a specific naming convention for 
"^DD",58.7,58.74,12,21,2,0)
grouping clinics in a division so that the messages associated to these 
"^DD",58.7,58.74,12,21,3,0)
clinics can be sent to a defined PADE cabinet.
"^DD",58.7,58.74,13,0)
OPERATING ROOM^58.7413P^^OR;0
"^DD",58.7,58.74,13,21,0)
^^3^3^3151210^
"^DD",58.7,58.74,13,21,1,0)
This multiple groups all operating rooms in a division so that the 
"^DD",58.7,58.74,13,21,2,0)
messages associated to these operating rooms can be sent to a defined 
"^DD",58.7,58.74,13,21,3,0)
PADE cabinet.
"^DD",58.7,58.741,0)
PADE BED GROUP SUB-FIELD^^2^3
"^DD",58.7,58.741,0,"DT")
3150522
"^DD",58.7,58.741,0,"IX","B",58.741,.01)

"^DD",58.7,58.741,0,"NM","PADE BED GROUP")

"^DD",58.7,58.741,0,"UP")
58.74
"^DD",58.7,58.741,.01,0)
PADE BED GROUP NAME^MMF^^0;1^K:$L(X)>40!($L(X)<3) X
"^DD",58.7,58.741,.01,1,0)
^.1^^-1
"^DD",58.7,58.741,.01,1,1,0)
58.741^B
"^DD",58.7,58.741,.01,1,1,1)
S ^PS(58.7,DA(2),"DIV",DA(1),"BG","B",$E(X,1,30),DA)=""
"^DD",58.7,58.741,.01,1,1,2)
K ^PS(58.7,DA(2),"DIV",DA(1),"BG","B",$E(X,1,30),DA)
"^DD",58.7,58.741,.01,3)
Answer must be 3-40 characters in length.
"^DD",58.7,58.741,.01,21,0)
^^8^8^3151209^^
"^DD",58.7,58.741,.01,21,1,0)
Enter a bed group name. This is an arbitrary name of your choosing that 
"^DD",58.7,58.741,.01,21,2,0)
will be used to group beds for whom the messages for patients in those 
"^DD",58.7,58.741,.01,21,3,0)
beds will be sent to a specific send location. You should only define 
"^DD",58.7,58.741,.01,21,4,0)
this for wards that have multiples PADE cabinets (i.e. two "wings"); 
"^DD",58.7,58.741,.01,21,5,0)
where the bed designations can indicate which PADE cabinet will support 
"^DD",58.7,58.741,.01,21,6,0)
the patients in that groups of beds. If both cabinets will support all 
"^DD",58.7,58.741,.01,21,7,0)
patients on the ward, then the ward only need be defined and not
"^DD",58.7,58.741,.01,21,8,0)
specific groups of beds.
"^DD",58.7,58.741,.01,"DT")
3151209
"^DD",58.7,58.741,1,0)
PADE BEDS^58.7411P^^1;0
"^DD",58.7,58.741,1,21,0)
^^1^1^3151210^
"^DD",58.7,58.741,1,21,1,0)
Select all room-beds that belongs to this bed group.
"^DD",58.7,58.741,1,"DT")
3150514
"^DD",58.7,58.741,2,0)
PADE BED GROUP SEND AREA^P58.71'^PS(58.71,^2;1^Q
"^DD",58.7,58.741,2,3)
Enter the PADE location associated to this bed group.
"^DD",58.7,58.741,2,21,0)
^^2^2^3150504^
"^DD",58.7,58.741,2,21,1,0)
This is the PADE cabinet location that will be used for this bed group
"^DD",58.7,58.741,2,21,2,0)
when sending messages.
"^DD",58.7,58.741,2,"DT")
3150514
"^DD",58.7,58.7411,0)
PADE BEDS SUB-FIELD^^.01^1
"^DD",58.7,58.7411,0,"DT")
3150522
"^DD",58.7,58.7411,0,"IX","B",58.7411,.01)

"^DD",58.7,58.7411,0,"IX","C",58.7411,.01)

"^DD",58.7,58.7411,0,"NM","PADE BEDS")

"^DD",58.7,58.7411,0,"UP")
58.741
"^DD",58.7,58.7411,.01,0)
PADE INDIVIDUAL BED^MMP405.4'X^DG(405.4,^0;1^I $D(X),$$BDCHK^PSJPADE(X) K X
"^DD",58.7,58.7411,.01,1,0)
^.1
"^DD",58.7,58.7411,.01,1,1,0)
58.7411^B
"^DD",58.7,58.7411,.01,1,1,1)
S ^PS(58.7,DA(3),"DIV",DA(2),"BG",DA(1),1,"B",$E(X,1,30),DA)=""
"^DD",58.7,58.7411,.01,1,1,2)
K ^PS(58.7,DA(3),"DIV",DA(2),"BG",DA(1),1,"B",$E(X,1,30),DA)
"^DD",58.7,58.7411,.01,1,2,0)
58.7411^C^MUMPS
"^DD",58.7,58.7411,.01,1,2,1)
S ^PS(58.7,DA(3),"DIV",DA(2),"BG","C",$E(X,1,30),DA(1),DA)=""
"^DD",58.7,58.7411,.01,1,2,2)
K ^PS(58.7,DA(3),"DIV",DA(2),"BG","C",$E(X,1,30),DA(1),DA)
"^DD",58.7,58.7411,.01,1,2,"%D",0)
^^2^2^3151209^
"^DD",58.7,58.7411,.01,1,2,"%D",1,0)
This cross reference will be helpful in finding out the right PADE 
"^DD",58.7,58.7411,.01,1,2,"%D",2,0)
associated with the Room-Bed for generating the HL7 messages.
"^DD",58.7,58.7411,.01,1,2,"DT")
3150521
"^DD",58.7,58.7411,.01,3)
Enter the ROOM-BED that belongs to this bed group. Must be in the format ROOM-BED.
"^DD",58.7,58.7411,.01,21,0)
^^4^4^3151209^
"^DD",58.7,58.7411,.01,21,1,0)
These are the room-beds belonging to this group. Grouping the beds is
"^DD",58.7,58.7411,.01,21,2,0)
helpful if there are more than one PADE cabinet supporting a ward.
"^DD",58.7,58.7411,.01,21,3,0)
Defining the related send area with the accurate group of beds will
"^DD",58.7,58.7411,.01,21,4,0)
help send HL7 messages to the PADE BED GROUP SEND AREA.
"^DD",58.7,58.7411,.01,"DT")
3151209
"^DD",58.7,58.7412,0)
PADE WILDCARD CLINIC NAME SUB-FIELD^^.2^3
"^DD",58.7,58.7412,0,"DT")
3151117
"^DD",58.7,58.7412,0,"IX","B",58.7412,.01)

"^DD",58.7,58.7412,0,"NM","PADE WILDCARD CLINIC NAME")

"^DD",58.7,58.7412,0,"UP")
58.74
"^DD",58.7,58.7412,.01,0)
PADE WILDCARD CLINIC NAME^MF^^0;1^K:$L(X)>30!($L(X)<3) X
"^DD",58.7,58.7412,.01,1,0)
^.1
"^DD",58.7,58.7412,.01,1,1,0)
58.7412^B
"^DD",58.7,58.7412,.01,1,1,1)
S ^PS(58.7,DA(2),"DIV",DA(1),"WCN","B",$E(X,1,30),DA)=""
"^DD",58.7,58.7412,.01,1,1,2)
K ^PS(58.7,DA(2),"DIV",DA(1),"WCN","B",$E(X,1,30),DA)
"^DD",58.7,58.7412,.01,3)
Answer must be 3-30 characters in length.
"^DD",58.7,58.7412,.01,21,0)
^^7^7^3151210^
"^DD",58.7,58.7412,.01,21,1,0)
This field allows you to define CLINICS for PADE who follow a specific
"^DD",58.7,58.7412,.01,21,2,0)
naming convention. For example, if all of your surgery clinics in a
"^DD",58.7,58.7412,.01,21,3,0)
division begin with AL-SURGERY xxxx, then you could define all of them
"^DD",58.7,58.7412,.01,21,4,0)
by creating a wildcard called "AL-SURGERY". When an order for a clinic
"^DD",58.7,58.7412,.01,21,5,0)
is completed, or a SIU event for that clinic is triggered, the software
"^DD",58.7,58.7412,.01,21,6,0)
will check the clinic name against this pattern/wildcard to determine if
"^DD",58.7,58.7412,.01,21,7,0)
the message should be sent to PADE.
"^DD",58.7,58.7412,.01,"DT")
3151210
"^DD",58.7,58.7412,.2,0)
INCLUDE CLINICS IN BG JOB^S^Y:YES;^0;3^Q
"^DD",58.7,58.7412,.2,3)
Select "YES" if the nightly background job should run for all clinics in this group.
"^DD",58.7,58.7412,.2,21,0)
^^4^4^3151210^
"^DD",58.7,58.7412,.2,21,1,0)
Enter "YES" if the nightly background should run for these clinics and 
"^DD",58.7,58.7412,.2,21,2,0)
generate appointment messages to PADE. If you do check-in then do not
"^DD",58.7,58.7412,.2,21,3,0)
populate this field as check-in will also generate appointment messages
"^DD",58.7,58.7412,.2,21,4,0)
to PADE.
"^DD",58.7,58.7412,.2,"DT")
3151210
"^DD",58.7,58.7412,1,0)
PADE WILDCARD CLINIC SEND AREA^P58.71'^PS(58.71,^0;2^Q
"^DD",58.7,58.7412,1,3)
Enter the PADE location associated with these clinics.
"^DD",58.7,58.7412,1,21,0)
^^2^2^3151210^
"^DD",58.7,58.7412,1,21,1,0)
This is the PADE cabinet location that will be used to send messages 
"^DD",58.7,58.7412,1,21,2,0)
associated with clinics with this naming convention.
"^DD",58.7,58.7412,1,"DT")
3151210
"^DD",58.7,58.7413,0)
OPERATING ROOM SUB-FIELD^^1^2
"^DD",58.7,58.7413,0,"DT")
3150904
"^DD",58.7,58.7413,0,"IX","B",58.7413,.01)

"^DD",58.7,58.7413,0,"NM","OPERATING ROOM")

"^DD",58.7,58.7413,0,"UP")
58.74
"^DD",58.7,58.7413,.01,0)
OPERATING ROOM^MMMM*P44'^SC(^0;1^S DIC("S")="I $$ORSEL^PSJPADE()" D ^DIC K DIC S DIC=$G(DIE),X=+Y K:Y<0 X
"^DD",58.7,58.7413,.01,1,0)
^.1
"^DD",58.7,58.7413,.01,1,1,0)
58.7413^B
"^DD",58.7,58.7413,.01,1,1,1)
S ^PS(58.7,DA(2),"DIV",DA(1),"OR","B",$E(X,1,30),DA)=""
"^DD",58.7,58.7413,.01,1,1,2)
K ^PS(58.7,DA(2),"DIV",DA(1),"OR","B",$E(X,1,30),DA)
"^DD",58.7,58.7413,.01,3)
Select an operating room from this division.
"^DD",58.7,58.7413,.01,12)
Operating rooms belonging to this division are only selectable.
"^DD",58.7,58.7413,.01,12.1)
S DIC("S")="I $$ORSEL^PSJPADE()"
"^DD",58.7,58.7413,.01,21,0)
^^3^3^3160112^
"^DD",58.7,58.7413,.01,21,1,0)
If you have the "Send Surgery Messages?" set to "YES" for this
"^DD",58.7,58.7413,.01,21,2,0)
division, you must also define the operating rooms whose scheduled
"^DD",58.7,58.7413,.01,21,3,0)
cases should generate surgery messages to PADE.
"^DD",58.7,58.7413,.01,"DT")
3160112
"^DD",58.7,58.7413,1,0)
OPERATING ROOM SEND AREA^P58.71'^PS(58.71,^0;2^Q
"^DD",58.7,58.7413,1,3)
Choose a send location for surgical messages.
"^DD",58.7,58.7413,1,21,0)
^^4^4^3151210^^
"^DD",58.7,58.7413,1,21,1,0)
Choose a send location for the surgery messages that will generate for 
"^DD",58.7,58.7413,1,21,2,0)
surgical cases scheduled for this operating room. If you leave this
"^DD",58.7,58.7413,1,21,3,0)
field blank, the operating room name will be used as the location for
"^DD",58.7,58.7413,1,21,4,0)
the message.
"^DD",58.7,58.7413,1,"DT")
3160122
"^DD",58.7,58.742,0)
VISTA CLINIC GROUP SUB-FIELD^^.2^3
"^DD",58.7,58.742,0,"DT")
3151117
"^DD",58.7,58.742,0,"IX","B",58.742,.01)

"^DD",58.7,58.742,0,"NM","VISTA CLINIC GROUP")

"^DD",58.7,58.742,0,"UP")
58.74
"^DD",58.7,58.742,.01,0)
VISTA CLINIC GROUP^MMP57.8'^PS(57.8,^0;1^Q
"^DD",58.7,58.742,.01,1,0)
^.1
"^DD",58.7,58.742,.01,1,1,0)
58.742^B
"^DD",58.7,58.742,.01,1,1,1)
S ^PS(58.7,DA(2),"DIV",DA(1),"VCG","B",$E(X,1,30),DA)=""
"^DD",58.7,58.742,.01,1,1,2)
K ^PS(58.7,DA(2),"DIV",DA(1),"VCG","B",$E(X,1,30),DA)
"^DD",58.7,58.742,.01,3)
Enter the clinic group associated with this PADE.
"^DD",58.7,58.742,.01,21,0)
^^8^8^3160122^
"^DD",58.7,58.742,.01,21,1,0)
You may associate groups of clinics by their membership in a CLINIC
"^DD",58.7,58.742,.01,21,2,0)
GROUP (defined in pharmacy file 57.8). It is important to understand
"^DD",58.7,58.742,.01,21,3,0)
that this feature should only be used for sites that do NOT allow
"^DD",58.7,58.742,.01,21,4,0)
one clinic to be in more than one Clinic group (in file 57.8). In the
"^DD",58.7,58.742,.01,21,5,0)
event that a clinic is defined in TWO clinic groups associated with
"^DD",58.7,58.742,.01,21,6,0)
this file; the message will be sent to the VISTA CLINIC GROUP SEND 
"^DD",58.7,58.742,.01,21,7,0)
AREA associated with the first entered clinic group in this file. If
"^DD",58.7,58.742,.01,21,8,0)
this is unacceptable, then that clinic should be defined individually.
"^DD",58.7,58.742,.01,"DT")
3160122
"^DD",58.7,58.742,.2,0)
INCLUDE CLINICS IN BG JOB^S^Y:YES;^0;3^Q
"^DD",58.7,58.742,.2,3)
Select "YES" if the nightly background job should run for all clinics in this group.
"^DD",58.7,58.742,.2,21,0)
^^4^4^3151118^
"^DD",58.7,58.742,.2,21,1,0)
Enter "YES" if the nightly background job should run for all clinics in 
"^DD",58.7,58.742,.2,21,2,0)
this group and generate appointment messages to PADE. Do not populate 
"^DD",58.7,58.742,.2,21,3,0)
this field if check-in is done in these clinics as check-in will
"^DD",58.7,58.742,.2,21,4,0)
generate appointment messages to PADE in real time.
"^DD",58.7,58.742,.2,"DT")
3151210
"^DD",58.7,58.742,1,0)
VISTA CLINIC GROUP SEND AREA^P58.71'^PS(58.71,^0;2^Q
"^DD",58.7,58.742,1,3)
Enter the PADE location associated with this clinic group.
"^DD",58.7,58.742,1,21,0)
^^2^2^3160106^
"^DD",58.7,58.742,1,21,1,0)
This is the PADE cabinet location that will be used for this clinic
"^DD",58.7,58.742,1,21,2,0)
group when sending messages.
"^DD",58.7,58.742,1,"DT")
3160106
"^DD",58.7,58.746,0)
WARD GROUP SUB-FIELD^^1^2
"^DD",58.7,58.746,0,"DT")
3150828
"^DD",58.7,58.746,0,"IX","B",58.746,.01)

"^DD",58.7,58.746,0,"NM","WARD GROUP")

"^DD",58.7,58.746,0,"UP")
58.74
"^DD",58.7,58.746,.01,0)
WARD GROUP^MMM*P57.5'^PS(57.5,^0;1^S DIC("S")="I $$WGSEL^PSJPADE(Y)" D ^DIC K DIC S DIC=$G(DIE),X=+Y K:Y<0 X
"^DD",58.7,58.746,.01,1,0)
^.1
"^DD",58.7,58.746,.01,1,1,0)
58.746^B
"^DD",58.7,58.746,.01,1,1,1)
S ^PS(58.7,DA(2),"DIV",DA(1),"WG","B",$E(X,1,30),DA)=""
"^DD",58.7,58.746,.01,1,1,2)
K ^PS(58.7,DA(2),"DIV",DA(1),"WG","B",$E(X,1,30),DA)
"^DD",58.7,58.746,.01,3)
Enter the ward group associated with this PADE.
"^DD",58.7,58.746,.01,12)
Only PHARMACY ward groups are selectable.
"^DD",58.7,58.746,.01,12.1)
S DIC("S")="I $$WGSEL^PSJPADE(Y)"
"^DD",58.7,58.746,.01,21,0)
^^8^8^3151210^^
"^DD",58.7,58.746,.01,21,1,0)
You may use ward groups to associate all the wards within a "P" type
"^DD",58.7,58.746,.01,21,2,0)
ward group to this Division instead of defining them individually. If
"^DD",58.7,58.746,.01,21,3,0)
you also define a WARD individually, which is part of a ward group
"^DD",58.7,58.746,.01,21,4,0)
defined within this field, then the WARD SEND AREA in this multiple
"^DD",58.7,58.746,.01,21,5,0)
will be ignored for that ward and the send location of the individually
"^DD",58.7,58.746,.01,21,6,0)
defined ward will be used to send messages. This allows you to define
"^DD",58.7,58.746,.01,21,7,0)
behavior for an entire ward group but create exceptions for specific
"^DD",58.7,58.746,.01,21,8,0)
wards that are part of that group.
"^DD",58.7,58.746,.01,"DT")
3151210
"^DD",58.7,58.746,1,0)
WARD GROUP SEND AREA^P58.71'^PS(58.71,^0;2^Q
"^DD",58.7,58.746,1,3)
Enter the PADE location associated with this ward group.
"^DD",58.7,58.746,1,21,0)
^^2^2^3150514^
"^DD",58.7,58.746,1,21,1,0)
All the messages associated to the wards under this ward group will be
"^DD",58.7,58.746,1,21,2,0)
sent to the PADE location defined here.
"^DD",58.7,58.746,1,"DT")
3150819
"^DD",58.7,58.747,0)
WARD SUB-FIELD^^1^2
"^DD",58.7,58.747,0,"DT")
3150825
"^DD",58.7,58.747,0,"IX","B",58.747,.01)

"^DD",58.7,58.747,0,"NM","WARD")

"^DD",58.7,58.747,0,"UP")
58.74
"^DD",58.7,58.747,.01,0)
WARD^MMM*P42'X^DIC(42,^0;1^S DIC("S")="N D0,X S D0=+Y D WIN^DGPMDDCF I 'X,$P(^DIC(42,D0,0),U,11)=$S($G(PSJDIV):PSJDIV,1:DA)" D ^DIC K DIC S DIC=$G(DIE),X=+Y K:Y<0 X
"^DD",58.7,58.747,.01,1,0)
^.1
"^DD",58.7,58.747,.01,1,1,0)
58.747^B
"^DD",58.7,58.747,.01,1,1,1)
S ^PS(58.7,DA(2),"DIV",DA(1),"WD","B",$E(X,1,30),DA)=""
"^DD",58.7,58.747,.01,1,1,2)
K ^PS(58.7,DA(2),"DIV",DA(1),"WD","B",$E(X,1,30),DA)
"^DD",58.7,58.747,.01,3)
Enter the ward associated with this PADE.
"^DD",58.7,58.747,.01,12)
Only active wards belonging to this division are selectable.
"^DD",58.7,58.747,.01,12.1)
S DIC("S")="N D0,X S D0=+Y D WIN^DGPMDDCF I 'X,$P(^DIC(42,D0,0),U,11)=$S($G(PSJDIV):PSJDIV,1:DA)"
"^DD",58.7,58.747,.01,21,0)
^.001^3^3^3150825^^^^
"^DD",58.7,58.747,.01,21,1,0)
This field allows you to select Wards that are associated with a PADE. 
"^DD",58.7,58.747,.01,21,2,0)
When an order for an inpatient is completed, or an ADT event for that 
"^DD",58.7,58.747,.01,21,3,0)
Ward is triggered, messages will be sent to PADE.
"^DD",58.7,58.747,.01,"DT")
3150825
"^DD",58.7,58.747,1,0)
WARD SEND AREA^P58.71'^PS(58.71,^0;2^Q
"^DD",58.7,58.747,1,1,0)
^.1^^0
"^DD",58.7,58.747,1,3)
Enter the PADE location that will be used for this ward.
"^DD",58.7,58.747,1,21,0)
^^2^2^3150504^
"^DD",58.7,58.747,1,21,1,0)
This is the PADE cabinet location that will be used for this ward when 
"^DD",58.7,58.747,1,21,2,0)
sending messages.
"^DD",58.7,58.747,1,"DT")
3150819
"^DD",58.7,58.748,0)
PADE CLINIC GROUP SUB-FIELD^^1.1^4
"^DD",58.7,58.748,0,"DT")
3151117
"^DD",58.7,58.748,0,"IX","B",58.748,.01)

"^DD",58.7,58.748,0,"NM","PADE CLINIC GROUP")

"^DD",58.7,58.748,0,"UP")
58.74
"^DD",58.7,58.748,.01,0)
PADE CLINIC GROUP^MMF^^0;1^K:$L(X)>40!($L(X)<3) X
"^DD",58.7,58.748,.01,1,0)
^.1
"^DD",58.7,58.748,.01,1,1,0)
58.748^B
"^DD",58.7,58.748,.01,1,1,1)
S ^PS(58.7,DA(2),"DIV",DA(1),"PCG","B",$E(X,1,30),DA)=""
"^DD",58.7,58.748,.01,1,1,2)
K ^PS(58.7,DA(2),"DIV",DA(1),"PCG","B",$E(X,1,30),DA)
"^DD",58.7,58.748,.01,3)
Enter a free text clinic group name. Answer must be 3-40 characters in length.
"^DD",58.7,58.748,.01,21,0)
^^8^8^3150605^
"^DD",58.7,58.748,.01,21,1,0)
This field allows you to create a custom grouping of clinics for PADE
"^DD",58.7,58.748,.01,21,2,0)
messages that will all transmit to the same PADE CLINIC GROUP SEND 
"^DD",58.7,58.748,.01,21,3,0)
AREA. The benefit of adding clinics to this group, rather than 
"^DD",58.7,58.748,.01,21,4,0)
individually, would be that the OP PADE CLINIC GROUP SEND AREA only
"^DD",58.7,58.748,.01,21,5,0)
has to be defined ONCE for the group vs. each time if the clinics were
"^DD",58.7,58.748,.01,21,6,0)
added individually.
"^DD",58.7,58.748,.01,21,7,0)
It also makes the process easier for changing the PADE CLINIC GROUP 
"^DD",58.7,58.748,.01,21,8,0)
SEND AREA for an entire group, vs. if they were defined individually.
"^DD",58.7,58.748,.01,"DT")
3150605
"^DD",58.7,58.748,1,0)
PADE CLINIC^58.7481P^^1;0
"^DD",58.7,58.748,1,21,0)
^^1^1^3151210^^
"^DD",58.7,58.748,1,21,1,0)
Select all the clinics that should belong to this group.
"^DD",58.7,58.748,1.1,0)
INCLUDE CLINICS IN BG JOB^S^Y:YES;^2;1^Q
"^DD",58.7,58.748,1.1,3)
Select "YES" if the nightly background job should run for all clinics in this group.
"^DD",58.7,58.748,1.1,21,0)
^^4^4^3151118^
"^DD",58.7,58.748,1.1,21,1,0)
Enter "YES" if the nightly background job should run for all clinics in
"^DD",58.7,58.748,1.1,21,2,0)
this group and generate appointment messages to PADE. Do not populate 
"^DD",58.7,58.748,1.1,21,3,0)
this field if check-in is done in these clinics as check-in will
"^DD",58.7,58.748,1.1,21,4,0)
generate appointment messages to PADE in real time.
"^DD",58.7,58.748,1.1,"DT")
3151209
"^DD",58.7,58.748,2,0)
PADE CLINIC GROUP SEND AREA^P58.71'^PS(58.71,^0;2^Q
"^DD",58.7,58.748,2,3)
Enter the PADE location that will be used for this clinic group.
"^DD",58.7,58.748,2,21,0)
^^2^2^3151210^
"^DD",58.7,58.748,2,21,1,0)
This is the PADE cabinet location that will used to send messages 
"^DD",58.7,58.748,2,21,2,0)
associated with clinics under this group.
"^DD",58.7,58.748,2,"DT")
3151210
"^DD",58.7,58.7481,0)
PADE CLINIC SUB-FIELD^^.01^1
"^DD",58.7,58.7481,0,"DT")
3150522
"^DD",58.7,58.7481,0,"IX","B",58.7481,.01)

"^DD",58.7,58.7481,0,"IX","C",58.7481,.01)

"^DD",58.7,58.7481,0,"NM","PADE CLINIC")

"^DD",58.7,58.7481,0,"UP")
58.748
"^DD",58.7,58.7481,.01,0)
PADE CLINIC^MM*P44'^SC(^0;1^S DIC("S")="I $$CLCHK^PSJPADE(Y)" D ^DIC K DIC S DIC=$G(DIE),X=+Y K:Y<0 X
"^DD",58.7,58.7481,.01,1,0)
^.1
"^DD",58.7,58.7481,.01,1,1,0)
58.7481^B
"^DD",58.7,58.7481,.01,1,1,1)
S ^PS(58.7,DA(3),"DIV",DA(2),"PCG",DA(1),1,"B",$E(X,1,30),DA)=""
"^DD",58.7,58.7481,.01,1,1,2)
K ^PS(58.7,DA(3),"DIV",DA(2),"PCG",DA(1),1,"B",$E(X,1,30),DA)
"^DD",58.7,58.7481,.01,1,2,0)
58.7481^C^MUMPS
"^DD",58.7,58.7481,.01,1,2,1)
S ^PS(58.7,DA(3),"DIV",DA(2),"PCG","C",$E(X,1,30),DA(1),DA)=""
"^DD",58.7,58.7481,.01,1,2,2)
K ^PS(58.7,DA(3),"DIV",DA(2),"PCG","C",$E(X,1,30),DA(1),DA)
"^DD",58.7,58.7481,.01,1,2,"DT")
3150522
"^DD",58.7,58.7481,.01,3)
Enter the clinics belonging to this clinic group.
"^DD",58.7,58.7481,.01,12)
Only Clinics belonging to the division are selectable from the Hospital Location file.
"^DD",58.7,58.7481,.01,12.1)
S DIC("S")="I $$CLCHK^PSJPADE(Y)"
"^DD",58.7,58.7481,.01,21,0)
^^9^9^3150625^
"^DD",58.7,58.7481,.01,21,1,0)
These are the clinics belonging to this group. If you want to set up a
"^DD",58.7,58.7481,.01,21,2,0)
clinic group just for PADE use only to send messages to a particular
"^DD",58.7,58.7481,.01,21,3,0)
PADE location then you can do so here by defining all the clinics and
"^DD",58.7,58.7481,.01,21,4,0)
putting them under one group.
"^DD",58.7,58.7481,.01,21,5,0)
 
"^DD",58.7,58.7481,.01,21,6,0)
If you intend to use the Clinic group already existing in VistA and
"^DD",58.7,58.7481,.01,21,7,0)
there are no overlap of clinics within those clinic groups then you can
"^DD",58.7,58.7481,.01,21,8,0)
do so by selecting the VISTA CLINIC GROUP multiple provided as part of
"^DD",58.7,58.7481,.01,21,9,0)
the input template.
"^DD",58.7,58.7481,.01,"DT")
3150625
"^DD",58.7,58.749,0)
CLINIC SUB-FIELD^^.2^3
"^DD",58.7,58.749,0,"DT")
3151117
"^DD",58.7,58.749,0,"IX","B",58.749,.01)

"^DD",58.7,58.749,0,"NM","CLINIC")

"^DD",58.7,58.749,0,"UP")
58.74
"^DD",58.7,58.749,.01,0)
CLINIC^M*P44'X^SC(^0;1^S DIC("S")="I $P(^(0),U,3)=""C"",$P(^(0),U,15)=$S($G(PSJDIV):PSJDIV,1:DA)" D ^DIC K DIC S DIC=$G(DIE),X=+Y K:Y<0 X
"^DD",58.7,58.749,.01,1,0)
^.1
"^DD",58.7,58.749,.01,1,1,0)
58.749^B
"^DD",58.7,58.749,.01,1,1,1)
S ^PS(58.7,DA(2),"DIV",DA(1),"CL","B",$E(X,1,30),DA)=""
"^DD",58.7,58.749,.01,1,1,2)
K ^PS(58.7,DA(2),"DIV",DA(1),"CL","B",$E(X,1,30),DA)
"^DD",58.7,58.749,.01,3)
Enter the clinic associated with this PADE.
"^DD",58.7,58.749,.01,12)
Only Clinics belonging to the division are selectable from the Hospital Location file.
"^DD",58.7,58.749,.01,12.1)
S DIC("S")="I $P(^(0),U,3)=""C"",$P(^(0),U,15)=$S($G(PSJDIV):PSJDIV,1:DA)"
"^DD",58.7,58.749,.01,21,0)
^^3^3^3160112^
"^DD",58.7,58.749,.01,21,1,0)
This field allows you to select Clinics that are associated with a
"^DD",58.7,58.749,.01,21,2,0)
PADE. When an order for a clinic is completed, or an ADT event for
"^DD",58.7,58.749,.01,21,3,0)
that clinic is triggered, messages will be sent to PADE.
"^DD",58.7,58.749,.01,"DT")
3160112
"^DD",58.7,58.749,.2,0)
INCLUDE CLINIC IN BG JOB^S^Y:YES;^0;3^Q
"^DD",58.7,58.749,.2,3)
Select "YES" if the nightly background job should run for this clinic.
"^DD",58.7,58.749,.2,21,0)
^^4^4^3151210^^
"^DD",58.7,58.749,.2,21,1,0)
Enter "YES" if the nightly background job should run for this clinic
"^DD",58.7,58.749,.2,21,2,0)
and generate appointment messages to PADE. Do not populate this field 
"^DD",58.7,58.749,.2,21,3,0)
if check-in is done in this clinic as check-in will generate
"^DD",58.7,58.749,.2,21,4,0)
appointment messages to PADE in real time.
"^DD",58.7,58.749,.2,"DT")
3151210
"^DD",58.7,58.749,1,0)
CLINIC SEND AREA^P58.71'^PS(58.71,^0;2^Q
"^DD",58.7,58.749,1,3)
Enter the PADE location that will be used for this clinic.
"^DD",58.7,58.749,1,21,0)
^^2^2^3150504^
"^DD",58.7,58.749,1,21,1,0)
This is the PADE cabinet location that will be used for this clinic when
"^DD",58.7,58.749,1,21,2,0)
sending messages.
"^DD",58.7,58.749,1,"DT")
3150504
"^DD",58.71,58.71,0)
FIELD^^.01^1
"^DD",58.71,58.71,0,"DDA")
N
"^DD",58.71,58.71,0,"DT")
3160318
"^DD",58.71,58.71,0,"IX","B",58.71,.01)

"^DD",58.71,58.71,0,"NM","PADE SEND AREA")

"^DD",58.71,58.71,0,"PT",58.72,11)

"^DD",58.71,58.71,0,"PT",58.72,12)

"^DD",58.71,58.71,0,"PT",58.74,3)

"^DD",58.71,58.71,0,"PT",58.741,2)

"^DD",58.71,58.71,0,"PT",58.7412,1)

"^DD",58.71,58.71,0,"PT",58.7413,1)

"^DD",58.71,58.71,0,"PT",58.742,1)

"^DD",58.71,58.71,0,"PT",58.746,1)

"^DD",58.71,58.71,0,"PT",58.747,1)

"^DD",58.71,58.71,0,"PT",58.748,2)

"^DD",58.71,58.71,0,"PT",58.749,1)

"^DD",58.71,58.71,0,"VRPK")
PSJ
"^DD",58.71,58.71,.01,0)
PADE SEND AREA^RF^^0;1^K:$L(X)>50!($L(X)<2)!'(X'?1P.E) X
"^DD",58.71,58.71,.01,1,0)
^.1
"^DD",58.71,58.71,.01,1,1,0)
58.71^B
"^DD",58.71,58.71,.01,1,1,1)
S ^PS(58.71,"B",$E(X,1,30),DA)=""
"^DD",58.71,58.71,.01,1,1,2)
K ^PS(58.71,"B",$E(X,1,30),DA)
"^DD",58.71,58.71,.01,3)
Answer must be 2-50 characters in length.
"^DD",58.71,58.71,.01,21,0)
^^2^2^3150924^
"^DD",58.71,58.71,.01,21,1,0)
These are the pre-defined locations on the PADE vendor system where the
"^DD",58.71,58.71,.01,21,2,0)
messages will be sent to.
"^DD",58.71,58.71,.01,"DT")
3160318
"^DD",58.72,58.72,0)
FIELD^^17^19
"^DD",58.72,58.72,0,"DDA")
N
"^DD",58.72,58.72,0,"DT")
3160202
"^DD",58.72,58.72,0,"ID",1)
S %I=Y,Y=$S('$D(^(0)):"",$D(^DPT(+$P(^(0),U,2),0))#2:$P(^(0),U,1),1:""),C=$P(^DD(2,.01,0),U,2) D Y^DIQ:Y]"" W "   ",Y,@("$E("_DIC_"%I,0),0)") S Y=%I K %I
"^DD",58.72,58.72,0,"ID",4)
W "   ",$P(^(0),U,5)
"^DD",58.72,58.72,0,"IX","B",58.72,.01)

"^DD",58.72,58.72,0,"IX","C",58.72,1)

"^DD",58.72,58.72,0,"NM","PADE OUTBOUND MESSAGES")

"^DD",58.72,58.72,.01,0)
MESSAGE DATE/TIME^RD^^0;1^S %DT="ESTXR" D ^%DT S X=Y K:X<1 X
"^DD",58.72,58.72,.01,1,0)
^.1
"^DD",58.72,58.72,.01,1,1,0)
58.72^B
"^DD",58.72,58.72,.01,1,1,1)
S ^PS(58.72,"B",$E(X,1,30),DA)=""
"^DD",58.72,58.72,.01,1,1,2)
K ^PS(58.72,"B",$E(X,1,30),DA)
"^DD",58.72,58.72,.01,3)
Enter the Date/Time the message was sent to PADE.
"^DD",58.72,58.72,.01,21,0)
^^1^1^3160128^^
"^DD",58.72,58.72,.01,21,1,0)
This is the Date/Time the message was sent to PADE.
"^DD",58.72,58.72,.01,"DT")
3160128
"^DD",58.72,58.72,1,0)
PATIENT^P2'^DPT(^0;2^Q
"^DD",58.72,58.72,1,1,0)
^.1
"^DD",58.72,58.72,1,1,1,0)
58.72^C
"^DD",58.72,58.72,1,1,1,1)
S ^PS(58.72,"C",$E(X,1,30),DA)=""
"^DD",58.72,58.72,1,1,1,2)
K ^PS(58.72,"C",$E(X,1,30),DA)
"^DD",58.72,58.72,1,1,1,"%D",0)
^^1^1^3160204^
"^DD",58.72,58.72,1,1,1,"%D",1,0)
This x-ref allows lookup by patient.
"^DD",58.72,58.72,1,1,1,"DT")
3160204
"^DD",58.72,58.72,1,3)
Enter the patient the message belongs to.
"^DD",58.72,58.72,1,21,0)
^^1^1^3160128^
"^DD",58.72,58.72,1,21,1,0)
This is the patient the message belongs to.
"^DD",58.72,58.72,1,"DT")
3160204
"^DD",58.72,58.72,2,0)
ORDER NUMBER^F^^0;3^K:$L(X)>20!($L(X)<1) X
"^DD",58.72,58.72,2,3)
Enter the order number from the Pharmacy Patient file, 1-20 characters.
"^DD",58.72,58.72,2,21,0)
^^1^1^3160128^
"^DD",58.72,58.72,2,21,1,0)
This is the order number from the Pharmacy Patient file.
"^DD",58.72,58.72,2,"DT")
3160201
"^DD",58.72,58.72,3,0)
HL7 MESSAGE ID^NJ10,0^^0;4^K:+X'=X!(X>1000000000)!(X<1)!(X?.E1"."1.N) X
"^DD",58.72,58.72,3,3)
Enter the HL7 Message ID, a number between 1 and 1000000000.
"^DD",58.72,58.72,3,21,0)
^^1^1^3160201^
"^DD",58.72,58.72,3,21,1,0)
This is the HL7 message ID.
"^DD",58.72,58.72,3,"DT")
3160201
"^DD",58.72,58.72,4,0)
EVENT TYPE^F^^0;5^K:$L(X)>3!($L(X)<1) X
"^DD",58.72,58.72,4,3)
Enter 1-3 characters in length of the HL7 Message type.
"^DD",58.72,58.72,4,21,0)
^^1^1^3160201^
"^DD",58.72,58.72,4,21,1,0)
This is the HL7 Message type.
"^DD",58.72,58.72,4,"DT")
3160201
"^DD",58.72,58.72,5,0)
DIVISION^P40.8'^DG(40.8,^0;6^Q
"^DD",58.72,58.72,5,3)
Enter the division the message belongs to.
"^DD",58.72,58.72,5,21,0)
^^1^1^3160128^
"^DD",58.72,58.72,5,21,1,0)
This is the division the message belongs to.
"^DD",58.72,58.72,5,"DT")
3160128
"^DD",58.72,58.72,6,0)
PIVOT NUMBER^NJ10,0^^0;7^K:+X'=X!(X>1000000000)!(X<1)!(X?.E1"."1.N) X
"^DD",58.72,58.72,6,3)
Enter the pivot number assigned to this visit, a number between 1 and 1000000000.
"^DD",58.72,58.72,6,21,0)
^^2^2^3160128^
"^DD",58.72,58.72,6,21,1,0)
This is the pivot number that was generated during patient admission
"^DD",58.72,58.72,6,21,2,0)
or when the patient checked in to a clinic.
"^DD",58.72,58.72,6,"DT")
3160201
"^DD",58.72,58.72,7,0)
WARD^P42'^DIC(42,^0;8^Q
"^DD",58.72,58.72,7,3)
Enter the ward the patient is admitted to. 
"^DD",58.72,58.72,7,21,0)
^^1^1^3160201^
"^DD",58.72,58.72,7,21,1,0)
This is the ward the patient is admitted to.
"^DD",58.72,58.72,7,"DT")
3160201
"^DD",58.72,58.72,8,0)
CLINIC/OR^P44'^SC(^0;9^Q
"^DD",58.72,58.72,8,3)
Enter the Clinic/OR for the appointment/surgery.
"^DD",58.72,58.72,8,21,0)
^^1^1^3160201^^
"^DD",58.72,58.72,8,21,1,0)
This is the Clinic/OR the patient had the appointment/surgery.
"^DD",58.72,58.72,8,"DT")
3160201
"^DD",58.72,58.72,9,0)
VISIT NUMBER^F^^0;10^K:$L(X)>15!($L(X)<1) X
"^DD",58.72,58.72,9,3)
Enter the visit number assigned to this visit, 1-15 characters.
"^DD",58.72,58.72,9,21,0)
^^1^1^3160201^
"^DD",58.72,58.72,9,21,1,0)
This is the visit number assigned to this visit.
"^DD",58.72,58.72,9,"DT")
3160201
"^DD",58.72,58.72,10,0)
PADE SYSTEM^P58.7'^PS(58.7,^0;11^Q
"^DD",58.72,58.72,10,3)
Enter the PADE System the message was sent to.
"^DD",58.72,58.72,10,21,0)
^^1^1^3160128^
"^DD",58.72,58.72,10,21,1,0)
This is the PADE System the message was sent to.
"^DD",58.72,58.72,10,"DT")
3160202
"^DD",58.72,58.72,11,0)
WARD SEND AREA^P58.71'^PS(58.71,^0;12^Q
"^DD",58.72,58.72,11,3)
Enter the Inpatient ward send area.
"^DD",58.72,58.72,11,21,0)
^^1^1^3160128^
"^DD",58.72,58.72,11,21,1,0)
This is the Inpatient ward send area.
"^DD",58.72,58.72,11,"DT")
3160128
"^DD",58.72,58.72,12,0)
CLINIC/OR SEND AREA^P58.71'^PS(58.71,^0;13^Q
"^DD",58.72,58.72,12,3)
Enter the Clinic/OR room send area.
"^DD",58.72,58.72,12,21,0)
^^1^1^3160128^
"^DD",58.72,58.72,12,21,1,0)
This is the clinic/operating room send area.
"^DD",58.72,58.72,12,"DT")
3160201
"^DD",58.72,58.72,13,0)
COMMENTS^F^^0;14^K:$L(X)>50!($L(X)<1) X
"^DD",58.72,58.72,13,3)
Enter 1-50 characters in length of the error description.
"^DD",58.72,58.72,13,21,0)
^^2^2^3160128^
"^DD",58.72,58.72,13,21,1,0)
This is the error description returned by the HL7 message builder during 
"^DD",58.72,58.72,13,21,2,0)
a failed transmission.
"^DD",58.72,58.72,13,"DT")
3160128
"^DD",58.72,58.72,14,0)
DRUG^P50'^PSDRUG(^0;15^Q
"^DD",58.72,58.72,14,3)
Enter the Drug for this order message.
"^DD",58.72,58.72,14,21,0)
^^1^1^3160201^
"^DD",58.72,58.72,14,21,1,0)
This is the Drug for this order message.
"^DD",58.72,58.72,14,"DT")
3160201
"^DD",58.72,58.72,15,0)
ORDER ACTION^F^^0;16^K:$L(X)>3!($L(X)<1) X
"^DD",58.72,58.72,15,3)
Enter the order action that triggered this order message, 1-3 characters.
"^DD",58.72,58.72,15,21,0)
^^1^1^3160201^
"^DD",58.72,58.72,15,21,1,0)
This is the order action that triggered this order message.
"^DD",58.72,58.72,15,"DT")
3160201
"^DD",58.72,58.72,16,0)
APPOINTMENT DATE/TIME^D^^0;17^S %DT="ESTXR" D ^%DT S X=Y K:X<1 X
"^DD",58.72,58.72,16,3)
Enter the appointment date/time.
"^DD",58.72,58.72,16,21,0)
^^2^2^3160204^
"^DD",58.72,58.72,16,21,1,0)
This is the appointment date/time for an SIU messages. For RDE messages 
"^DD",58.72,58.72,16,21,2,0)
this is the appointment date/time for a clinic order.
"^DD",58.72,58.72,16,"DT")
3160204
"^DD",58.72,58.72,17,0)
772 POINTER^P772'^HL(772,^0;18^Q
"^DD",58.72,58.72,17,3)
Enter the HL7 Message Text file (#772).
"^DD",58.72,58.72,17,21,0)
^^1^1^3160202^
"^DD",58.72,58.72,17,21,1,0)
This is the pointer to the HL7 Message Text file (#772).
"^DD",58.72,58.72,17,"DT")
3160203
"^DD",59.6,59.6,8,0)
DEFAULT 0 ON PADE PRE-EXCHANGE^S^1:YES;0:NO;^0;10^Q
"^DD",59.6,59.6,8,3)
Enter YES to default PADE Pre-Exchange doses to zero.
"^DD",59.6,59.6,8,21,0)
^^7^7^3160105^
"^DD",59.6,59.6,8,21,1,0)
If set to YES, field defaults zero in the "Pre-Exchange DOSES:" prompt 
"^DD",59.6,59.6,8,21,2,0)
for orders that may be dispensed from Pharmacy Automation Dispensing 
"^DD",59.6,59.6,8,21,3,0)
Equipment (PADE).
"^DD",59.6,59.6,8,21,4,0)
 
"^DD",59.6,59.6,8,21,5,0)
An order may be dispensed from PADE if the order's drug is stocked in at
"^DD",59.6,59.6,8,21,6,0)
least one PADE dispensing cabinet that is associated with the patient's
"^DD",59.6,59.6,8,21,7,0)
ward location.
"^DD",59.6,59.6,8,"DT")
3160105
"^DIC",58.6,58.6,0)
PADE INBOUND TRANSACTIONS^58.6
"^DIC",58.6,58.6,0,"GL")
^PS(58.6,
"^DIC",58.6,58.6,"%",0)
^1.005^^0
"^DIC",58.6,58.6,"%D",0)
^^11^11^3150830^
"^DIC",58.6,58.6,"%D",1,0)
The PADE INBOUND TRANSACTIONS (#58.6) file contains Pharmacy Automation 
"^DIC",58.6,58.6,"%D",2,0)
Dispensing Equipment transactions received from PADE dispensing devices.
"^DIC",58.6,58.6,"%D",3,0)
The PADE HL7 transaction is first received by the VistA HL7 Messaging
"^DIC",58.6,58.6,"%D",4,0)
application, where the PADE inbound filer is invoked to create an entry in
"^DIC",58.6,58.6,"%D",5,0)
the PADE INBOUND TRANSACTIONS (#58.6).
"^DIC",58.6,58.6,"%D",6,0)
 
"^DIC",58.6,58.6,"%D",7,0)
This file creates several cross references designed to facilitate querying
"^DIC",58.6,58.6,"%D",8,0)
and reporting of PADE data using various search criteria. Supported
"^DIC",58.6,58.6,"%D",9,0)
transactions that are not associated with a patient include Load, Unload,
"^DIC",58.6,58.6,"%D",10,0)
and Count. Supported transaction associated with a patient include
"^DIC",58.6,58.6,"%D",11,0)
Dispense, Return, and Waste.
"^DIC",58.6,"B","PADE INBOUND TRANSACTIONS",58.6)

"^DIC",58.601,58.601,0)
PADE INVENTORY SYSTEM^58.601
"^DIC",58.601,58.601,0,"GL")
^PS(58.601,
"^DIC",58.601,58.601,"%",0)
^1.005^^0
"^DIC",58.601,58.601,"%D",0)
^^10^10^3160212^^
"^DIC",58.601,58.601,"%D",1,0)
The PADE INVENTORY (#58.601) file contains Pharmacy Automation Dispensing 
"^DIC",58.601,58.601,"%D",2,0)
Equipment (PADE) inventory information. The inventory is kept for a 
"^DIC",58.601,58.601,"%D",3,0)
specific PADE dispensing device, however, there may be more than one 
"^DIC",58.601,58.601,"%D",4,0)
vendor system operating at a site simultaneously, and as a result, 
"^DIC",58.601,58.601,"%D",5,0)
uniqueness of PADE device name (DISPENSING DEVICE multiple) is only 
"^DIC",58.601,58.601,"%D",6,0)
guaranteed within the specific vendor entry (PADE INBOUND SYSTEM).
"^DIC",58.601,58.601,"%D",7,0)
 
"^DIC",58.601,58.601,"%D",8,0)
The total balance for each drug within a PADE device is stored by 
"^DIC",58.601,58.601,"%D",9,0)
dispensing device, by drawer, and by pocket. Unloading, or de-stocking, a 
"^DIC",58.601,58.601,"%D",10,0)
drug item from a dispensing device deletes the drug from the device.
"^DIC",58.601,"B","PADE INVENTORY SYSTEM",58.601)

"^DIC",58.63,58.63,0)
PADE DISPENSING DEVICE^58.63
"^DIC",58.63,58.63,0,"GL")
^PS(58.63,
"^DIC",58.63,58.63,"%",0)
^1.005^^0
"^DIC",58.63,58.63,"%D",0)
^^15^15^3151201^
"^DIC",58.63,58.63,"%D",1,0)
Pharmacy Automated Dispensing Equipment (PADE) devices contain drug items 
"^DIC",58.63,58.63,"%D",2,0)
that may be removed to satisfy a pharmacy medication order. An inbound
"^DIC",58.63,58.63,"%D",3,0)
(to VistA) HL7 PADE interface receives transactions indicating drug items
"^DIC",58.63,58.63,"%D",4,0)
were added or removed from a specific PADE device. Each dispensing device 
"^DIC",58.63,58.63,"%D",5,0)
in this file must be associated with a VistA Division and one or more 
"^DIC",58.63,58.63,"%D",6,0)
hospital locations (Wards, Ward Groups, Clinics, Clinic Groups) in order 
"^DIC",58.63,58.63,"%D",7,0)
for inbound PADE transactions to properly update PADE inventory balances 
"^DIC",58.63,58.63,"%D",8,0)
in the PADE INVENTORY SYSTEM (#58.601) file.
"^DIC",58.63,58.63,"%D",9,0)
 
"^DIC",58.63,58.63,"%D",10,0)
The PADE DISPENSING DEVICE entry must be unique for the PADE INVENTORY 
"^DIC",58.63,58.63,"%D",11,0)
SYSTEM (#58.601) file entry to which is linked; this file may contain 
"^DIC",58.63,58.63,"%D",12,0)
multiple PADE dispensing devices with the same NAME (.01) field value,
"^DIC",58.63,58.63,"%D",13,0)
provided each duplicate name is associated with a different PADE INVENTORY
"^DIC",58.63,58.63,"%D",14,0)
SYSTEM file entry. New entries may be added to this file automatically via
"^DIC",58.63,58.63,"%D",15,0)
the PADE HL7 interface.
"^DIC",58.63,"B","PADE DISPENSING DEVICE",58.63)

"^DIC",58.64,58.64,0)
PADE USER^58.64
"^DIC",58.64,58.64,0,"GL")
^PS(58.64,
"^DIC",58.64,58.64,"%",0)
^1.005^^0
"^DIC",58.64,58.64,"%D",0)
^^15^15^3151201^
"^DIC",58.64,58.64,"%D",1,0)
This file is used to link Pharmacy Automated Dispensing Equipment (PADE) 
"^DIC",58.64,58.64,"%D",2,0)
users with VistA users. When a PADE Inbound HL7 message is received, this 
"^DIC",58.64,58.64,"%D",3,0)
file is checked for the user ID and PADE Inbound System combination from
"^DIC",58.64,58.64,"%D",4,0)
the incoming HL7 message. If the user ID and PADE Inbound System 
"^DIC",58.64,58.64,"%D",5,0)
combination is not on file, it is filed. If the user ID and PADE Inbound 
"^DIC",58.64,58.64,"%D",6,0)
System combination does exist in this file, the VISTA USER (#2) field is 
"^DIC",58.64,58.64,"%D",7,0)
checked to determine if the PADE user has been linked to a VistA user, 
"^DIC",58.64,58.64,"%D",8,0)
and if it has, the VistA user information is filed in the PADE INBOUND 
"^DIC",58.64,58.64,"%D",9,0)
TRANSACTION (#58.6) file, along with the PADE user information in the 
"^DIC",58.64,58.64,"%D",10,0)
incoming HL7 message.
"^DIC",58.64,58.64,"%D",11,0)
 
"^DIC",58.64,58.64,"%D",12,0)
Linking PADE users to VistA users is not required for the PADE interface 
"^DIC",58.64,58.64,"%D",13,0)
or reports to function, it is intended to improve readability of PADE
"^DIC",58.64,58.64,"%D",14,0)
reports and obviate the need for cross checking user ID's with the 
"^DIC",58.64,58.64,"%D",15,0)
external PADE database.
"^DIC",58.64,"B","PADE USER",58.64)

"^DIC",58.7,58.7,0)
PADE SYSTEM SETUP^58.7
"^DIC",58.7,58.7,0,"GL")
^PS(58.7,
"^DIC",58.7,58.7,"%",0)
^1.005^^0
"^DIC",58.7,58.7,"%D",0)
^^7^7^3150519^
"^DIC",58.7,58.7,"%D",1,0)
This file defines the Pharmacy Automated Dispensing Equipment (PADE)
"^DIC",58.7,58.7,"%D",2,0)
system like Pyxis, Omnicell, AccuDose, etc., that will be used by the VA
"^DIC",58.7,58.7,"%D",3,0)
Medical Centers to stock and to dispense drug/non-drug items in Inpatient
"^DIC",58.7,58.7,"%D",4,0)
Wards or Outpatient Clinics. Defining the wards/clinics associated with a
"^DIC",58.7,58.7,"%D",5,0)
division, and mapping to a PADE cabinet (location/area), will allow VistA 
"^DIC",58.7,58.7,"%D",6,0)
to communicate precisely the outbound messages related to ADT, clinic 
"^DIC",58.7,58.7,"%D",7,0)
visits, order details, drug formulary etc.
"^DIC",58.7,"B","PADE SYSTEM SETUP",58.7)

"^DIC",58.71,58.71,0)
PADE SEND AREA^58.71
"^DIC",58.71,58.71,0,"GL")
^PS(58.71,
"^DIC",58.71,58.71,"%",0)
^1.005^^0
"^DIC",58.71,58.71,"%D",0)
^^5^5^3150504^
"^DIC",58.71,58.71,"%D",1,0)
This free text area is mapped to a physical cabinet on the PADE vendor
"^DIC",58.71,58.71,"%D",2,0)
system.
"^DIC",58.71,58.71,"%D",3,0)
 
"^DIC",58.71,58.71,"%D",4,0)
These are the pre-defined designations on the PADE vendor system where the
"^DIC",58.71,58.71,"%D",5,0)
messages will be sent to.
"^DIC",58.71,"B","PADE SEND AREA",58.71)

"^DIC",58.72,58.72,0)
PADE OUTBOUND MESSAGES^58.72
"^DIC",58.72,58.72,0,"GL")
^PS(58.72,
"^DIC",58.72,58.72,"%",0)
^1.005^^
"^DIC",58.72,58.72,"%D",0)
^^3^3^3160128^
"^DIC",58.72,58.72,"%D",1,0)
This file holds a log of all outbound HL7 Pharmacy Automated Dispensing 
"^DIC",58.72,58.72,"%D",2,0)
Equipment (PADE) messages. Records in this file older than 30 days will
"^DIC",58.72,58.72,"%D",3,0)
be purged as part of the nightly Inpatient background job (PSGBRJ).
"^DIC",58.72,"B","PADE OUTBOUND MESSAGES",58.72)

"BLD",9173,6)
^283
**END**
**END**

