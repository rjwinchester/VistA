Released PSJ*5*380 SEQ #335
Extracted from mail message
**KIDS**:PSJ*5.0*380^

**INSTALL NAME**
PSJ*5.0*380
"BLD",11012,0)
PSJ*5.0*380^INPATIENT MEDICATIONS^0^3190917^y
"BLD",11012,1,0)
^^2^2^3190823^^^^
"BLD",11012,1,1,0)
The description of this build can be found in the National Patch Module 
"BLD",11012,1,2,0)
under PSJ*5*380.
"BLD",11012,4,0)
^9.64PA^^
"BLD",11012,6.3)
10
"BLD",11012,"ABPKG")
n
"BLD",11012,"KRN",0)
^9.67PA^1.61^23
"BLD",11012,"KRN",.4,0)
.4
"BLD",11012,"KRN",.401,0)
.401
"BLD",11012,"KRN",.402,0)
.402
"BLD",11012,"KRN",.403,0)
.403
"BLD",11012,"KRN",.5,0)
.5
"BLD",11012,"KRN",.84,0)
.84
"BLD",11012,"KRN",1.6,0)
1.6
"BLD",11012,"KRN",1.61,0)
1.61
"BLD",11012,"KRN",1.62,0)
1.62
"BLD",11012,"KRN",3.6,0)
3.6
"BLD",11012,"KRN",3.8,0)
3.8
"BLD",11012,"KRN",9.2,0)
9.2
"BLD",11012,"KRN",9.8,0)
9.8
"BLD",11012,"KRN",9.8,"NM",0)
^9.68A^5^4
"BLD",11012,"KRN",9.8,"NM",2,0)
PSJPDV0^^0^B33361495
"BLD",11012,"KRN",9.8,"NM",3,0)
PSGOE8^^0^B60937566
"BLD",11012,"KRN",9.8,"NM",4,0)
PSGOE9^^0^B47574767
"BLD",11012,"KRN",9.8,"NM",5,0)
PSJLIFN^^0^B58549614
"BLD",11012,"KRN",9.8,"NM","B","PSGOE8",3)

"BLD",11012,"KRN",9.8,"NM","B","PSGOE9",4)

"BLD",11012,"KRN",9.8,"NM","B","PSJLIFN",5)

"BLD",11012,"KRN",9.8,"NM","B","PSJPDV0",2)

"BLD",11012,"KRN",19,0)
19
"BLD",11012,"KRN",19.1,0)
19.1
"BLD",11012,"KRN",101,0)
101
"BLD",11012,"KRN",409.61,0)
409.61
"BLD",11012,"KRN",771,0)
771
"BLD",11012,"KRN",779.2,0)
779.2
"BLD",11012,"KRN",870,0)
870
"BLD",11012,"KRN",8989.51,0)
8989.51
"BLD",11012,"KRN",8989.52,0)
8989.52
"BLD",11012,"KRN",8994,0)
8994
"BLD",11012,"KRN","B",.4,.4)

"BLD",11012,"KRN","B",.401,.401)

"BLD",11012,"KRN","B",.402,.402)

"BLD",11012,"KRN","B",.403,.403)

"BLD",11012,"KRN","B",.5,.5)

"BLD",11012,"KRN","B",.84,.84)

"BLD",11012,"KRN","B",1.6,1.6)

"BLD",11012,"KRN","B",1.61,1.61)

"BLD",11012,"KRN","B",1.62,1.62)

"BLD",11012,"KRN","B",3.6,3.6)

"BLD",11012,"KRN","B",3.8,3.8)

"BLD",11012,"KRN","B",9.2,9.2)

"BLD",11012,"KRN","B",9.8,9.8)

"BLD",11012,"KRN","B",19,19)

"BLD",11012,"KRN","B",19.1,19.1)

"BLD",11012,"KRN","B",101,101)

"BLD",11012,"KRN","B",409.61,409.61)

"BLD",11012,"KRN","B",771,771)

"BLD",11012,"KRN","B",779.2,779.2)

"BLD",11012,"KRN","B",870,870)

"BLD",11012,"KRN","B",8989.51,8989.51)

"BLD",11012,"KRN","B",8989.52,8989.52)

"BLD",11012,"KRN","B",8994,8994)

"BLD",11012,"QDEF")
^^^^NO^^^^NO^^NO
"BLD",11012,"QUES",0)
^9.62^^
"BLD",11012,"REQB",0)
^9.611^3^2
"BLD",11012,"REQB",2,0)
PSJ*5.0*214^2
"BLD",11012,"REQB",3,0)
PSJ*5.0*327^2
"BLD",11012,"REQB","B","PSJ*5.0*214",2)

"BLD",11012,"REQB","B","PSJ*5.0*327",3)

"MBREQ")
0
"PKG",221,-1)
1^1
"PKG",221,0)
INPATIENT MEDICATIONS^PSJ^UNIT DOSE AND IVS
"PKG",221,22,0)
^9.49I^1^1
"PKG",221,22,1,0)
5.0^2971215^2981113^1
"PKG",221,22,1,"PAH",1,0)
380^3190917
"PKG",221,22,1,"PAH",1,1,0)
^^2^2^3190917
"PKG",221,22,1,"PAH",1,1,1,0)
The description of this build can be found in the National Patch Module 
"PKG",221,22,1,"PAH",1,1,2,0)
under PSJ*5*380.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
4
"RTN","PSGOE8")
0^3^B60937566^B60586386
"RTN","PSGOE8",1,0)
PSGOE8 ;BIR/CML3 - EDIT ORDERS IN 53.1 ;12 June 2019 09:31:53
"RTN","PSGOE8",2,0)
 ;;5.0;INPATIENT MEDICATIONS ;**47,50,65,72,110,111,188,192,113,223,269,287,315,338,366,327,380**;16 DEC 97;Build 10
"RTN","PSGOE8",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PSGOE8",4,0)
 ; Reference to ^PS(50.7 is supported by DBIA# 2180
"RTN","PSGOE8",5,0)
 ; Reference to ^PS(51.1 is supported by DBIA 2177
"RTN","PSGOE8",6,0)
 ; Reference to ^PS(51.2 is supported by DBIA# 2178
"RTN","PSGOE8",7,0)
 ; Reference to ^PSDRUG is supported by DBIA# 2192
"RTN","PSGOE8",8,0)
 ;
"RTN","PSGOE8",9,0)
101 ;Orderable Item
"RTN","PSGOE8",10,0)
 S MSG=0,F2=101,PSGOOPD=PSGPD,PSGOOPDN=PSGPDN S:PSGOEEF(F2) BACK="101^PSGOE8"
"RTN","PSGOE8",11,0)
 S %=1 I $P(PSJSYSU,";",3)>1 W !!,$C(7),"WARNING!  If you change the drug of an order, the Dosage Ordered and Dispense",!,"Drug(s) are deleted." F  W !,"Do you wish to continue" S %=2 D YN^DICN Q:%
"RTN","PSGOE8",12,0)
 I %'=1 G DONE
"RTN","PSGOE8",13,0)
A101 ;
"RTN","PSGOE8",14,0)
 I $$PNDREN($G(PSGORD)) D  Q
"RTN","PSGOE8",15,0)
 . W !!?5,"Orderable Item may not be edited at this point." D PAUSE^VALM1
"RTN","PSGOE8",16,0)
 W !,"ORDERABLE ITEM: ",$S(PSGPD:PSGPDN_"// ",1:"") R X:DTIME I X="^"!'$T W:'$T $C(7) S PSGOEE=0 G DONE
"RTN","PSGOE8",17,0)
 ;; START NCC T4 MODS >> 327*RJS
"RTN","PSGOE8",18,0)
A201 I X="",PSGPD S X=PSGPDN I PSGPD'=PSGPDN,$L($$GET1^DIQ(50.7,PSGPD,.01)) G:'$G(ANQX) DONE
"RTN","PSGOE8",19,0)
 S PSGPDOLD=PSGPD,PSGPDNOLD=PSGPDN,PSGPDRGOLD=PSGPDRG
"RTN","PSGOE8",20,0)
 ;; END NCC T4 MODS >> 327*RJS
"RTN","PSGOE8",21,0)
 I X="",PSGPD S X=PSGPDN I PSGPD'=PSGPDN,$D(^PS(50.7,PSGPD,0)) G DONE
"RTN","PSGOE8",22,0)
 I $S(X="@":1,X]"":0,1:'PSGPD) W $C(7),"  (Required)" S X="?" D ENHLP^PSGOEM(53.1,101) G A101
"RTN","PSGOE8",23,0)
 I X?1."?" D ENHLP^PSGOEM(53.1,101)
"RTN","PSGOE8",24,0)
 I $E(X)="^" D ENFF^PSGOE82 G:Y>0 @Y G A101
"RTN","PSGOE8",25,0)
 ;BHW;PSJ*5.0*192;Modify ^DIC call to use MIX^DIC and only B/C cross-references
"RTN","PSGOE8",26,0)
 K DIC,D S DIC="^PS(50.7,",DIC(0)="EMQZ",DIC("S")="I $$ENOISC^PSJUTL(Y,""U"")",D="B^C" D MIX^DIC1 K DIC,D I Y'>0 G A101
"RTN","PSGOE8",27,0)
 F  S %=2 D DH,YN^DICN Q:%
"RTN","PSGOE8",28,0)
 I %'=1 G A101
"RTN","PSGOE8",29,0)
 S (PSGPDRG,PSGPD)=+Y,(PSGPDN,PSGPDRGN)=$$OINAME^PSJLMUTL(PSGPDRG)
"RTN","PSGOE8",30,0)
 S PSGNEDFD=$$GTNEDFD^PSGOE7("U",PSGPDRG)
"RTN","PSGOE8",31,0)
 S PSGPDNX=1,PSGDO="",(PSGPDRG,PSGPD)=+Y,(PSGPDN,PSGPDRGN)=$$OINAME^PSJLMUTL(PSGPDRG) K ^PS(53.45,PSJSYSP,2) S X=$O(^PSDRUG("ASP",PSGPD,0)) I X,'$O(^(X)) D
"RTN","PSGOE8",32,0)
 .S ^PS(53.45,PSJSYSP,2,0)="^53.4502P^1^1",^(1,0)=X,^PS(53.45,PSJSYSP,2,"B",X,1)=""
"RTN","PSGOE8",33,0)
 S PSGDRGTMP=X
"RTN","PSGOE8",34,0)
 D ENDRG^PSGOEF1(PSGPD,0)
"RTN","PSGOE8",35,0)
 ;; START NCC T4 MODS >> 327*RJS
"RTN","PSGOE8",36,0)
 N CLOZFLG S CLOZFLG=$$ISCLOZ^PSJCLOZ(,PSGPD) I CLOZFLG D  I $G(ANQX) K ANQX G A201
"RTN","PSGOE8",37,0)
 .N PSGDRG S ANQX=0,PSGDRG=$P(CLOZFLG,U,2) D CLOZ^PSJCLOZ(DFN,PSGDRG)
"RTN","PSGOE8",38,0)
 .I $G(ANQX) W ! S X=$E(PSGPDNOLD,0,4),PSGPDN=PSGPDNOLD,PSGPD=PSGPDOLD,PSGPDRG=PSGPDRGOLD K PSGDRGTMP,PSGPDOLD,PSGPDNOLD,PSGPDRGOLD
"RTN","PSGOE8",39,0)
 ;; END NCC T4 MODS >> 327*RJS
"RTN","PSGOE8",40,0)
 I $S($D(DTOUT):1,$D(DUOUT):1,$D(DIRUT):1,1:0) G DONE
"RTN","PSGOE8",41,0)
 ;G DONE
"RTN","PSGOE8",42,0)
 ;
"RTN","PSGOE8",43,0)
109 ; dosage ordered
"RTN","PSGOE8",44,0)
 S MSG=0,F2=109 S:$G(PSGOEEF(F2)) BACK="109^PSGOE8"
"RTN","PSGOE8",45,0)
A109 ;
"RTN","PSGOE8",46,0)
 I $$PNDREN($G(PSGORD)) D  Q
"RTN","PSGOE8",47,0)
 . W !!?5,"Dosage may not be edited at this point." D PAUSE^VALM1
"RTN","PSGOE8",48,0)
 S PSGOEEF(F2)=PSGOEE
"RTN","PSGOE8",49,0)
 D EDITDOSE^PSJDOSE S X=PSGDO S:X="" PSGDREQ=1 G DONE
"RTN","PSGOE8",50,0)
 W !,"DOSAGE ORDERED: ",$S(PSGDO]"":PSGDO_"// ",1:"") R X:DTIME I X="^"!'$T W:'$T $C(7) S PSGOEE=0 G DONE
"RTN","PSGOE8",51,0)
 I X=""&(PSGDO]"") S X=PSGDO
"RTN","PSGOE8",52,0)
 I $$CHECK(PSJSYSP)&(X="")&(PSGDO']"") W $C(7),"    (Required) " G A109
"RTN","PSGOE8",53,0)
 I $$CHECK(PSJSYSP)&(X="@") W $C(7),"      (Required) " G A109
"RTN","PSGOE8",54,0)
 I '$$CHECK(PSJSYSP)&(X="@") S PSGDO="" G DONE
"RTN","PSGOE8",55,0)
 I X?1."?" D ENHLP^PSGOEM(53.1,109) G A109
"RTN","PSGOE8",56,0)
 I $E(X)="^" D ENFF^PSGOE82 G:Y>0 @Y G A109
"RTN","PSGOE8",57,0)
 I $E(X,$L(X))=" " F  S X=$E(X,1,$L(X)-1) Q:$E(X,$L(X))'=" "
"RTN","PSGOE8",58,0)
 I $S(X?.E1C.E:1,$L(X)>20:1,X="":0,X["^":1,X?1.P:1,1:X=+X) W $C(7),"  ",$S(X?1.P!(X=""):"(Required)",1:"??") D ENHLP^PSGOEM(53.1,109) G A109
"RTN","PSGOE8",59,0)
 S PSGDO=X G DONE
"RTN","PSGOE8",60,0)
 ;
"RTN","PSGOE8",61,0)
3 ; med route
"RTN","PSGOE8",62,0)
 N PSGS0XT
"RTN","PSGOE8",63,0)
 S MSG=0,F2=3 S:PSGOEEF(F2) BACK="3^PSGOE8"
"RTN","PSGOE8",64,0)
A3 I $$PNDREN($G(PSGORD)) D  Q
"RTN","PSGOE8",65,0)
 . W !!?5,"Med Route may not be edited at this point." D PAUSE^VALM1
"RTN","PSGOE8",66,0)
 W !,"MED ROUTE: ",$S(PSGMR:PSGMRN_"// ",1:"") R X:DTIME I X="^"!'$T W:'$T $C(7) S PSGOEE=0 G DONE
"RTN","PSGOE8",67,0)
 I X="",PSGMR S X=PSGMRN I PSGMR'=PSGMRN,$D(^PS(51.2,PSGMR,0)) W "  "_$P(^(0),"^",3) G DONE
"RTN","PSGOE8",68,0)
 I $S(X="@":1,X]"":0,1:'PSGMR) W $C(7),"  (Required)" S X="?" D ENHLP^PSGOEM(53.1,3) G A3
"RTN","PSGOE8",69,0)
 I X="?" D MRSL^PSGOE4 ;*366
"RTN","PSGOE8",70,0)
 I X?1."??" D ENHLP^PSGOEM(53.1,3)
"RTN","PSGOE8",71,0)
 ;I X?1."?" D ENHLP^PSGOEM(53.1,3)
"RTN","PSGOE8",72,0)
 I $E(X)="^" D ENFF^PSGOE82 G:Y>0 @Y G A3
"RTN","PSGOE8",73,0)
 D CKMRSL^PSGOE4 ;*366
"RTN","PSGOE8",74,0)
 K DIC S DIC="^PS(51.2,",DIC(0)="EMQZX",DIC("S")="I $P(^(0),""^"",4)" D ^DIC K DIC I Y'>0 G A3  ;*366
"RTN","PSGOE8",75,0)
 S PSGMR=+Y,PSGMRN=Y(0,0) G DONE
"RTN","PSGOE8",76,0)
 ;
"RTN","PSGOE8",77,0)
26 ; schedule
"RTN","PSGOE8",78,0)
 S MSG=0,F2=26 S:PSGOEEF(F2) BACK="26^PSGOE8"
"RTN","PSGOE8",79,0)
A26 I $$PNDREN($G(PSGORD)) D  Q
"RTN","PSGOE8",80,0)
 . W !!?5,"Schedule may not be edited at this point." D PAUSE^VALM1
"RTN","PSGOE8",81,0)
 W !,"SCHEDULE: ",$S(PSGSCH]"":PSGSCH_"// ",1:"") R X:DTIME I X="^"!'$T W:'$T $C(7) S PSGOEE=0 G DONE
"RTN","PSGOE8",82,0)
 S:X="" X=PSGSCH,PSGSCH="" I "@"[X W $C(7),"  (Required)" S X="?" D ENHLP^PSGOEM(53.1,26) G A26
"RTN","PSGOE8",83,0)
 S DOW=0 I $$DOW^PSIVUTL($$ENLU^PSGMI(X)) S DOW=1
"RTN","PSGOE8",84,0)
 I X?1."?" D ENHLP^PSGOEM(53.1,26) G A26
"RTN","PSGOE8",85,0)
 I $E(X)="^" D ENFF^PSGOE82 G:Y>0 @Y G A26
"RTN","PSGOE8",86,0)
 ;BHW;PSJ*5*188;Add flag and IEN return variable for PSGS0 (PSJ*5*134), Highlight Admin Times if they changed.
"RTN","PSGOE8",87,0)
 N PSGOES,PSJSLUP,PSGSFLG S PSJSLUP=1,PSGSFLG=1 D EN^PSGS0 I '$D(X) W $C(7),"  ??" S X="?" D ENHLP^PSGOEM(53.1,26) G A26
"RTN","PSGOE8",88,0)
 I X'=PSGSCH D
"RTN","PSGOE8",89,0)
 . K PSGDUR,PSGRMVT,PSGRMV,ND2P1 ;*315 Removal times are tied to ADMIN times.
"RTN","PSGOE8",90,0)
 . N XX
"RTN","PSGOE8",91,0)
 . S PSGSCH=X
"RTN","PSGOE8",92,0)
 . I PSGS0Y'=PSGAT S PSGAT=PSGS0Y  ;Change so that any schedule change will adjust the type and default the admin times - DRF
"RTN","PSGOE8",93,0)
 . D  ;Change schedule type to agree with schedule
"RTN","PSGOE8",94,0)
 .. I $G(DOW) S PSGST="C",PSGSTN=$$ENSTN^PSGMI(PSGST) Q
"RTN","PSGOE8",95,0)
 .. I (PSGSCH[" PRN")!(PSGSCH="PRN") I $$PRNOK^PSGS0(PSGSCH) S PSGOST=PSGST,PSGST="P",PSGSTN=$$ENSTN^PSGMI(PSGST) Q
"RTN","PSGOE8",96,0)
 .. I '$G(PSGSCIEN),PSGSCH]"" S XX=+$O(^PS(51.1,"AC","PSJ",PSGSCH,0)),PSGSCIEN=XX
"RTN","PSGOE8",97,0)
 .. S PSGOST=$G(PSGST),PSGST=$P($G(^PS(51.1,PSGSCIEN,0)),"^",5) I PSGST="D" S PSGST="C"  ;DOW schedules are converted to Continuous
"RTN","PSGOE8",98,0)
 .. S PSGSTN=$$ENSTN^PSGMI(PSGST)
"RTN","PSGOE8",99,0)
 . I $G(PSJSYSW0),($P(PSJSYSW0,U,5)'=2),'$G(PSGEFN(8)) W !!,"NOTE: This may cause the Admin Times and the Start Time to be out of sync."
"RTN","PSGOE8",100,0)
 . W !!,"NOTE: This change in schedule also changes the ADMIN TIMES and SCHEDULE TYPE.",!
"RTN","PSGOE8",101,0)
 . S MSG=1 S:'$G(PSGOEEF(39)) PSGOEEF(39)=1 ;*287 - Prevent infinite loop editing admin times
"RTN","PSGOE8",102,0)
 . I ($G(PSGRF)>1),PSGST="C" D
"RTN","PSGOE8",103,0)
 ..S PSGF2=39,BACK="39^PSGOE81" D 39^PSGOE81 S BACK="26^PSGOE8",PSGF2=26,PSGOAT=PSGAT ;*315 Prompt for Admin to get DOA
"RTN","PSGOE8",104,0)
 ..Q
"RTN","PSGOE8",105,0)
 . I $G(PSJNEWOE) D PAUSE^VALM1
"RTN","PSGOE8",106,0)
 I PSGST="O" S PSGOEEF(7)=1 I +$G(PSGRF) S PSGOEEF(25)=1 D 25^PSGOE81 S PSGF2=26
"RTN","PSGOE8",107,0)
 G DONE
"RTN","PSGOE8",108,0)
 ;
"RTN","PSGOE8",109,0)
7 ; schedule type
"RTN","PSGOE8",110,0)
 S MSG=0,F2=7 S:PSGOEEF(F2) BACK="7^PSGOE8"
"RTN","PSGOE8",111,0)
A7 W !,"SCHEDULE TYPE: "_$S(PSGSTN]"":PSGSTN_"// ",1:"") R X:DTIME S X=$TR(X,"coprocf","COPROCF") I X="^"!'$T S PSGOEE=0 W $C(7) G DONE
"RTN","PSGOE8",112,0)
 I X="" S X=PSGST,PSGSTN=$$ENSTN^PSGMI(X) W:PSGSTN]"" "  ",PSGSTN G DONE
"RTN","PSGOE8",113,0)
 S:X="F" X="R"
"RTN","PSGOE8",114,0)
 I ",?,??,C,O,OC,P,R,"'[(","_X_",") W " ??" G A7
"RTN","PSGOE8",115,0)
 I $$PRNOK^PSGS0($G(PSGSCH)),X="C" W "  ??" G A7
"RTN","PSGOE8",116,0)
 I X="@"!(X?1."?") W:X="@" $C(7),"  (Required)" S:X="@" X="?" D ENHLP^PSGOEM(53.1,7) G A7
"RTN","PSGOE8",117,0)
 I $E(X)="^" D ENFF^PSGOE82 G:Y>0 @Y G A7
"RTN","PSGOE8",118,0)
 ;*223 Don't allow O sched type on C orders
"RTN","PSGOE8",119,0)
 I X="O",$$SCHTP(PSGSCH)'="O" W !,"  SCHEDULE ("_PSGSCH_") is not a ONE TIME Schedule." G A7
"RTN","PSGOE8",120,0)
 ;*269 Don't allow C sched type on O orders
"RTN","PSGOE8",121,0)
 I X="C",$$SCHTP(PSGSCH)="O" W !,"  SCHEDULE ("_PSGSCH_") is not a CONTINUOUS Schedule." G A7
"RTN","PSGOE8",122,0)
 S PSGOST=PSGST
"RTN","PSGOE8",123,0)
 S PSGST=X,PSGSTN=$$ENSTN^PSGMI(X) W:PSGSTN]"" "  ",PSGSTN
"RTN","PSGOE8",124,0)
 I X="P",$G(PSGAT)]"" S PSGOAT=PSGAT S PSGAT="" D
"RTN","PSGOE8",125,0)
 .W !!,"NOTE: This change in schedule type also changes the ADMIN TIMES.",!
"RTN","PSGOE8",126,0)
 .S MSG=1,PSGOEEF(39)=1
"RTN","PSGOE8",127,0)
 .I $G(PSJNEWOE) D PAUSE^VALM1
"RTN","PSGOE8",128,0)
 ;
"RTN","PSGOE8",129,0)
DONE ;
"RTN","PSGOE8",130,0)
 I PSGOEE G:'PSGOEEF(F2) @BACK S PSGOEE=PSGOEEF(F2)
"RTN","PSGOE8",131,0)
 K F,F0,F2 Q
"RTN","PSGOE8",132,0)
 ;
"RTN","PSGOE8",133,0)
DEL ; delete entry
"RTN","PSGOE8",134,0)
 W !?3,"SURE YOU WANT TO DELETE" S %=0 D YN^DICN I %'=1 W $C(7),"  <NOTHING DELETED>"
"RTN","PSGOE8",135,0)
 Q
"RTN","PSGOE8",136,0)
 ;
"RTN","PSGOE8",137,0)
DH ;
"RTN","PSGOE8",138,0)
 W !!?2,"When the drug of an order is changed, the Dosage Ordered and Dispense Drug(s)",!,"for the order are no longer valid, and therefore deleted from the order.",!,"If possible, a new corresponding dispense drug will be added to the order."
"RTN","PSGOE8",139,0)
 W !!?2,"Answer 'YES' to continue with this change.  Answer 'NO' to select another",!,"drug or to accept the drug as it was.  Enter an '^' to exit this edit." Q
"RTN","PSGOE8",140,0)
 ;
"RTN","PSGOE8",141,0)
CHECK(PSJSYSP) ; Check to see if multiple dispense drugs
"RTN","PSGOE8",142,0)
 ; Input  -     PSJSYSP
"RTN","PSGOE8",143,0)
 ; Returns  0 = only one.
"RTN","PSGOE8",144,0)
 ;          1 = more than one
"RTN","PSGOE8",145,0)
 ; Checks Inactive Date and doesn't count if < or = today.
"RTN","PSGOE8",146,0)
 N PSJRSB,PSJINACT,PSJRBCNT S PSJRBCNT=0
"RTN","PSGOE8",147,0)
 F PSJRSB=0:0 S PSJRSB=$O(^PS(53.45,PSJSYSP,2,PSJRSB)) Q:'PSJRSB  D
"RTN","PSGOE8",148,0)
 .S PSJINACT=$P(^PS(53.45,PSJSYSP,2,PSJRSB,0),"^",3)
"RTN","PSGOE8",149,0)
 .I (PSJINACT="")!((PSJINACT>0)&(PSJINACT>DT)) D
"RTN","PSGOE8",150,0)
 ..S PSJRBCNT=$S('$D(PSJRBCNT):1,1:PSJRBCNT+1)
"RTN","PSGOE8",151,0)
 Q $S(PSJRBCNT>1:1,1:0)
"RTN","PSGOE8",152,0)
 ;
"RTN","PSGOE8",153,0)
PNDREN(PNDON) ;
"RTN","PSGOE8",154,0)
 I PNDON'["P" Q 0
"RTN","PSGOE8",155,0)
 S RNWL="^PS(53.1,"_+PNDON_",0)" S RNWL=$G(@(RNWL)) S RNWL=$S($P(RNWL,"^",24)="R":1,1:0)
"RTN","PSGOE8",156,0)
 Q RNWL
"RTN","PSGOE8",157,0)
 ;
"RTN","PSGOE8",158,0)
SCHTP(SCH) ; *223 Return SCHedule type
"RTN","PSGOE8",159,0)
 N X I SCH="" Q ""
"RTN","PSGOE8",160,0)
 S X=$O(^PS(51.1,"APPSJ",SCH,0))
"RTN","PSGOE8",161,0)
 Q:'$G(X) ""
"RTN","PSGOE8",162,0)
 Q $P(^PS(51.1,X,0),"^",5)
"RTN","PSGOE8",163,0)
 ;
"RTN","PSGOE9")
0^4^B47574767^B47270955
"RTN","PSGOE9",1,0)
PSGOE9 ;BIR/CML3 - EDIT ORDERS IN 55 ; 7/6/11 9:45am
"RTN","PSGOE9",2,0)
 ;;5.0;INPATIENT MEDICATIONS ;**11,47,50,72,110,111,188,192,207,113,223,269,315,338,352,366,380**;16 DEC 97;Build 10
"RTN","PSGOE9",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PSGOE9",4,0)
 ; Reference to ^PS(50.7 is supported by DBIA# 2180
"RTN","PSGOE9",5,0)
 ; Reference to ^PS(51.1 is supported by DBIA 2177
"RTN","PSGOE9",6,0)
 ; Reference to ^PS(51.2 is supported by DBIA# 2178
"RTN","PSGOE9",7,0)
 ; Reference to ^PS(55 is supported by DBIA #2191
"RTN","PSGOE9",8,0)
 ; Reference to ^PSDRUG is supported by DBIA# 2192
"RTN","PSGOE9",9,0)
 ;
"RTN","PSGOE9",10,0)
101 ; Orderable Item (AKA primary drug)
"RTN","PSGOE9",11,0)
 S MSG=0,PSGF2=101,PSGOOPD=PSGPD,PSGOOPDN=PSGPDN S:PSGOEEF(PSGF2) BACK="101^PSGOE9"
"RTN","PSGOE9",12,0)
 I $G(PSGOROE1)'=1 S %=1 W !!,$C(7),"WARNING!  If you change the drug of an order, the Dosage Ordered and Dispense",!,"Drug(s) are deleted." F  W !,"Do you wish to continue" S %=2 D YN^DICN Q:%  D DH^PSGOE8
"RTN","PSGOE9",13,0)
 I %'=1 G DONE
"RTN","PSGOE9",14,0)
A101 ;
"RTN","PSGOE9",15,0)
 I $G(PSJORD),$G(PSGP) I $$COMPLEX^PSJOE(PSGP,PSJORD) S PSGOEE=0 D  G DONE
"RTN","PSGOE9",16,0)
 . W !!?5,"Orderable Item may not be edited for active complex orders." D PAUSE^VALM1
"RTN","PSGOE9",17,0)
 W !,"ORDERABLE ITEM: ",$S(PSGPD:PSGPDN_"// ",1:"") R X:DTIME I X="^"!'$T W:'$T $C(7) S PSGOEE=0 G DONE
"RTN","PSGOE9",18,0)
 I X="",PSGPD S X=PSGPDN I PSGPD'=PSGPDN,$D(^PS(50.7,PSGPD,0)) G DONE
"RTN","PSGOE9",19,0)
 I $S(X="@":1,X]"":0,1:'PSGPD) W $C(7),"  (Required)" S X="?" D ENHLP^PSGOEM(55.06,101) G A101
"RTN","PSGOE9",20,0)
 I X?1."?" D ENHLP^PSGOEM(55.06,101)
"RTN","PSGOE9",21,0)
 I $E(X)="^" D ENFF^PSGOE92 G:Y>0 @Y G A101
"RTN","PSGOE9",22,0)
 ;BHW;PSJ*5.0*192;Modify ^DIC call to use MIX^DIC and only B/C cross-references
"RTN","PSGOE9",23,0)
 K DIC,D S DIC="^PS(50.7,",DIC(0)="EMQZ",DIC("S")="I $$ENOISC^PSJUTL(Y,""U"")",D="B^C" D MIX^DIC1 K DIC,D I Y'>0 G A101
"RTN","PSGOE9",24,0)
 I +Y=PSGPD G DONE  ;PSJ*5*269 - No change to Orderable Item
"RTN","PSGOE9",25,0)
 F  S %=2 D DH^PSGOE8,YN^DICN Q:%
"RTN","PSGOE9",26,0)
 I %'=1 G A101
"RTN","PSGOE9",27,0)
 S (PSGPDRG,PSGPD)=+Y,(PSGPDN,PSGPDRGN)=$$OINAME^PSJLMUTL(PSGPDRG)
"RTN","PSGOE9",28,0)
 S PSGNEDFD=$$GTNEDFD^PSGOE7("U",PSGPDRG)
"RTN","PSGOE9",29,0)
 S PSGPDNX=1,PSGPD=+Y,PSGPDN=$$OINAME^PSJLMUTL(PSGPD),PSGDO="" K ^PS(53.45,PSJSYSP,2) S X=$O(^PSDRUG("ASP",PSGPD,0)) I X,'$O(^(X)) S ^PS(53.45,PSJSYSP,2,0)="^53.4502P^1^1",^(1,0)=X,^PS(53.45,PSJSYSP,2,"B",X,1)="" G DONE
"RTN","PSGOE9",30,0)
 D ENDRG^PSGOEF1(PSGPD,0)
"RTN","PSGOE9",31,0)
 I $S($D(DTOUT):1,$D(DUOUT):1,$D(DIRUT):1,1:0) S PSGOROE1=1 G DONE
"RTN","PSGOE9",32,0)
 ;G DONE
"RTN","PSGOE9",33,0)
 ;
"RTN","PSGOE9",34,0)
109 ; dosage ordered
"RTN","PSGOE9",35,0)
 S MSG=0,PSGF2=109 S:$G(PSGOEEF(PSGF2)) BACK="109^PSGOE9"
"RTN","PSGOE9",36,0)
A109 ;
"RTN","PSGOE9",37,0)
 I $G(PSJORD),$G(PSGP) I $$COMPLEX^PSJOE(PSGP,PSJORD) S PSGOEE=0 D  G DONE
"RTN","PSGOE9",38,0)
 . W !!?5,"Dosage may not be edited for active complex orders." D PAUSE^VALM1
"RTN","PSGOE9",39,0)
 D EDITDOSE^PSJDOSE S X=PSGDO G DONE
"RTN","PSGOE9",40,0)
 W !,"DOSAGE ORDERED: ",$S(PSGDO]"":PSGDO_"// ",1:"") R X:DTIME I X="^"!'$T W:'$T $C(7) S PSGOEE=0 G DONE
"RTN","PSGOE9",41,0)
 I X=""&(PSGDO]"") S X=PSGDO
"RTN","PSGOE9",42,0)
 I $$CHECK^PSGOE8(PSJSYSP)&(X="")&(PSGDO']"") W $C(7),"    (Required) " G A109
"RTN","PSGOE9",43,0)
 I $$CHECK^PSGOE8(PSJSYSP)&(X="@") W $C(7),"  (Required)" G A109
"RTN","PSGOE9",44,0)
 I '$$CHECK^PSGOE8(PSJSYSP)&(X="@") S PSGDO="" G DONE
"RTN","PSGOE9",45,0)
 I X?1."?" D ENHLP^PSGOEM(55.06,109) G A109
"RTN","PSGOE9",46,0)
 I $E(X)="^" D ENFF^PSGOE92 G:Y>0 @Y G A109
"RTN","PSGOE9",47,0)
 I $E(X,$L(X))=" " F  S X=$E(X,1,$L(X)-1) Q:$E(X,$L(X))'=" "
"RTN","PSGOE9",48,0)
 I $S(X?.E1C.E:1,$L(X)>20:1,X="":0,X["^":1,X?1.P:1,1:X=+X) W $C(7),"  ",$S(X?1.P!(X=""):"(Required)",1:"??") D ENHLP^PSGOEM(55.06,109) G A109
"RTN","PSGOE9",49,0)
 S PSGDO=X G DONE
"RTN","PSGOE9",50,0)
 ;
"RTN","PSGOE9",51,0)
3 ; med route
"RTN","PSGOE9",52,0)
 N PSGS0XT
"RTN","PSGOE9",53,0)
 S MSG=0,PSGF2=3 S:PSGOEEF(PSGF2) BACK="3^PSGOE9"
"RTN","PSGOE9",54,0)
A3 I $G(PSJORD),$G(PSGP) I $$COMPLEX^PSJOE(PSGP,PSJORD) S PSGOEE=0 D  G DONE
"RTN","PSGOE9",55,0)
 . W !!?5,"Med Route may not be edited for active complex orders." D PAUSE^VALM1
"RTN","PSGOE9",56,0)
 W !,"MED ROUTE: ",$S(PSGMR:PSGMRN_"// ",1:"") R X:DTIME I X="^"!'$T W:'$T $C(7) S PSGOEE=0 G DONE
"RTN","PSGOE9",57,0)
 I X="",PSGMR S X=PSGMRN I PSGMR'=PSGMRN,$D(^PS(51.2,PSGMR,0)) W "  "_$P(^(0),"^",3) G DONE
"RTN","PSGOE9",58,0)
 I $S(X="@":1,X]"":0,1:'PSGMR) W $C(7),"  (Required)" S X="?" D ENHLP^PSGOEM(55.06,3) G A3
"RTN","PSGOE9",59,0)
 I X="?" D MRSL^PSGOE4 ;*366
"RTN","PSGOE9",60,0)
 I X?1."?" D ENHLP^PSGOEM(55.06,3)
"RTN","PSGOE9",61,0)
 I $E(X)="^" D ENFF^PSGOE92 G:Y>0 @Y G A3
"RTN","PSGOE9",62,0)
 D CKMRSL^PSGOE4 ;*366
"RTN","PSGOE9",63,0)
 K DIC S DIC="^PS(51.2,",DIC(0)="EMQZX",DIC("S")="I $P(^(0),""^"",4)" D ^DIC K DIC I Y'>0 G A3
"RTN","PSGOE9",64,0)
 S PSGMR=+Y,PSGMRN=Y(0,0) G DONE
"RTN","PSGOE9",65,0)
 ;
"RTN","PSGOE9",66,0)
7 ; schedule type
"RTN","PSGOE9",67,0)
 S MSG=0,PSGF2=7 S:PSGOEEF(PSGF2) BACK="7^PSGOE9"
"RTN","PSGOE9",68,0)
A7 I $G(PSGP),$G(PSGORD) I $$COMPLEX^PSJOE(PSGP,PSGORD) D
"RTN","PSGOE9",69,0)
 . N X,Y,PARENT,P2ND S P2ND=$S(PSGORD["U":$G(^PS(55,PSGP,5,+PSGORD,.2)),1:$G(^PS(53.1,+PSGORD,.2))),PARENT=$P(P2ND,"^",8)
"RTN","PSGOE9",70,0)
 . I PARENT D FULL^VALM1 W !!?5,"This order is part of a complex order. Please review the following ",!?5,"associated orders before changing this order." D CMPLX^PSJCOM1(PSGP,PARENT,PSGORD)
"RTN","PSGOE9",71,0)
 W !,"SCHEDULE TYPE: "_$S(PSGSTN]"":PSGSTN_"// ",1:"") R X:DTIME S X=$TR(X,"coprocf","COPROCF") I X="^"!'$T S PSGOEE=0 W $C(7) G DONE
"RTN","PSGOE9",72,0)
 I X="" S X=PSGST,PSGSTN=$$ENSTN^PSGMI(X) W:PSGSTN]"" "  ",PSGSTN G DONE
"RTN","PSGOE9",73,0)
 S:X="F" X="R"
"RTN","PSGOE9",74,0)
 I ",?,??,C,O,OC,P,R,"'[(","_X_",") W " ??" G A7
"RTN","PSGOE9",75,0)
 I $$PRNOK^PSGS0($G(PSGSCH)),X="C" W "  ??" G A7
"RTN","PSGOE9",76,0)
 I X="@"!(X?1."?") W:X="@" $C(7),"  (Required)" S:X="@" X="?" D ENHLP^PSGOEM(55.06,7) G A7
"RTN","PSGOE9",77,0)
 I $E(X)="^" D ENFF^PSGOE92 G:Y>0 @Y G A7
"RTN","PSGOE9",78,0)
 ;*223 Don't allow O sched type on C orders
"RTN","PSGOE9",79,0)
 I X="O",$$SCHTP^PSGOE8(PSGSCH)'="O" W !,"  SCHEDULE ("_PSGSCH_") is not a ONE TIME Schedule." G A7
"RTN","PSGOE9",80,0)
 ;*269 Don't allow C sched type on O orders
"RTN","PSGOE9",81,0)
 I X="C",$$SCHTP^PSGOE8(PSGSCH)="O" W !,"  SCHEDULE ("_PSGSCH_") is not a CONTINUOUS Schedule." G A7
"RTN","PSGOE9",82,0)
 S PSGOST=PSGST
"RTN","PSGOE9",83,0)
 S PSGST=X,PSGSTN=$$ENSTN^PSGMI(X) W:PSGSTN]"" "  ",PSGSTN
"RTN","PSGOE9",84,0)
 I X="P",$G(PSGAT)]"" S PSGOAT=PSGAT S PSGAT="" D
"RTN","PSGOE9",85,0)
 .W !!,"NOTE: This change in schedule type also changes the ADMIN TIMES.",!
"RTN","PSGOE9",86,0)
 .S MSG=1,PSGOEEF(39)=1
"RTN","PSGOE9",87,0)
 .I $G(PSJNEWOE) D PAUSE^VALM1
"RTN","PSGOE9",88,0)
 G DONE
"RTN","PSGOE9",89,0)
 ;
"RTN","PSGOE9",90,0)
26 ; schedule
"RTN","PSGOE9",91,0)
 S MSG=0,PSGF2=26 S:PSGOEEF(PSGF2) BACK="26^PSGOE9"
"RTN","PSGOE9",92,0)
A26 I $G(PSJORD),$G(PSGP) I $$COMPLEX^PSJOE(PSGP,PSJORD) S PSGOEE=0 D  G DONE
"RTN","PSGOE9",93,0)
 . W !!?5,"Schedule may not be edited for active complex orders." D PAUSE^VALM1
"RTN","PSGOE9",94,0)
 W !,"SCHEDULE: ",$S(PSGSCH]"":PSGSCH_"// ",1:"") R X:DTIME I X="^"!'$T W:'$T $C(7) S PSGOEE=0 G DONE
"RTN","PSGOE9",95,0)
 S:X="" X=PSGSCH,PSGSCH="" I "@"[X W $C(7),"  (Required)" S X="?" D ENHLP^PSGOEM(55.06,26) G A26
"RTN","PSGOE9",96,0)
 S DOW=0 I $$DOW^PSIVUTL($$ENLU^PSGMI(X)) S DOW=1
"RTN","PSGOE9",97,0)
 I X?1."?" D ENHLP^PSGOEM(55.06,26) G A26
"RTN","PSGOE9",98,0)
 I $E(X)="^" D ENFF^PSGOE92 G:Y>0 @Y G A26
"RTN","PSGOE9",99,0)
 ;BHW;PSJ*5*188;Add flag and IEN return variable for PSGS0 (PSJ*5*134), Highlight Admin Times if they changed.
"RTN","PSGOE9",100,0)
 N PSJSLUP,PSGSFLG S PSJSLUP=1,PSGSFLG=1 D EN^PSGS0 I '$D(X) W $C(7),"  ??" S X="?" D ENHLP^PSGOEM(55.06,26) G A26
"RTN","PSGOE9",101,0)
 I X'=PSGSCH D
"RTN","PSGOE9",102,0)
 . N XX
"RTN","PSGOE9",103,0)
 . K PSGDUR,PSGRMVT,PSGRMV,ND2P1 ;*315 Removal times are tied to ADMIN times.
"RTN","PSGOE9",104,0)
 . S PSGSCH=X
"RTN","PSGOE9",105,0)
 . I PSGS0Y'=PSGAT S PSGAT=PSGS0Y  ;Change so that any schedule change will adjust the type and default the admin times - DRF
"RTN","PSGOE9",106,0)
 . D  ;Change schedule type to agree with schedule
"RTN","PSGOE9",107,0)
 .. I $G(DOW) S PSGST="C",PSGSTN=$$ENSTN^PSGMI(PSGST) Q
"RTN","PSGOE9",108,0)
 .. I (PSGSCH[" PRN")!(PSGSCH="PRN") I $$PRNOK^PSGS0(PSGSCH) S PSGOST=PSGST,PSGST="P",PSGSTN=$$ENSTN^PSGMI(PSGST) Q
"RTN","PSGOE9",109,0)
 .. I '$G(PSGSCIEN),PSGSCH]"" S XX=+$O(^PS(51.1,"AC","PSJ",PSGSCH,0)),PSGSCIEN=XX ;PSGSCIEN should be set by call to EN^PSGS0
"RTN","PSGOE9",110,0)
 .. S PSGST=$P($G(^PS(51.1,PSGSCIEN,0)),"^",5) I PSGST="D" S PSGST="C"  ;DOW schedules are converted to Continuous
"RTN","PSGOE9",111,0)
 .. S PSGSTN=$$ENSTN^PSGMI(PSGST)
"RTN","PSGOE9",112,0)
 . W !!,"NOTE: This change in schedule also changes the ADMIN TIMES and SCHEDULE TYPE.",!
"RTN","PSGOE9",113,0)
 . S MSG=1,PSGOEEF(39)=1
"RTN","PSGOE9",114,0)
 . I ($G(PSGRF)>1),PSGST="C" D
"RTN","PSGOE9",115,0)
 .. S PSGF2=41,BACK="41^PSGOE91",PSGOEEF(PSGF2)=1 D 41^PSGOE91 S BACK="26^PSGOE9",PSGF2=26,PSGOAT=PSGAT ;*315 Prompt for Admin to get DOA
"RTN","PSGOE9",116,0)
 ..Q
"RTN","PSGOE9",117,0)
 . I $G(PSJNEWOE) D PAUSE^VALM1
"RTN","PSGOE9",118,0)
 I PSGST="O" S PSGOEEF(7)=1 I +$G(PSGRF) S PSGOEEF(34)=1 D 34^PSGOE91 S PSGF2=26
"RTN","PSGOE9",119,0)
 ;
"RTN","PSGOE9",120,0)
DONE ;
"RTN","PSGOE9",121,0)
 I PSGOEE G:'$G(PSGOEEF(PSGF2)) @BACK S PSGOEE=PSGOEEF(PSGF2)
"RTN","PSGOE9",122,0)
 K F,F0,PSGF2 Q
"RTN","PSGOE9",123,0)
 ;
"RTN","PSGOE9",124,0)
DEL ; delete entry
"RTN","PSGOE9",125,0)
 W !?3,"SURE YOU WANT TO DELETE" S %=0 D YN^DICN I %'=1 W $C(7),"  <NOTHING DELETED>"
"RTN","PSGOE9",126,0)
 Q
"RTN","PSJLIFN")
0^5^B58549614^B58490722
"RTN","PSJLIFN",1,0)
PSJLIFN ;BIR/MV-IV FINISH USING LM ;13 Jan 98 / 11:32 AM
"RTN","PSJLIFN",2,0)
 ;;5.0;INPATIENT MEDICATIONS ;**1,29,34,37,42,47,50,56,94,80,116,110,181,261,252,313,333,256,380**;16 DEC 97;Build 10
"RTN","PSJLIFN",3,0)
 ;
"RTN","PSJLIFN",4,0)
 ; Reference to ^PS(51.2 is supported by DBIA #2178.
"RTN","PSJLIFN",5,0)
 ; Reference to ^PS(52.6 supported by DBIA #1231.
"RTN","PSJLIFN",6,0)
 ; Reference to ^PS(52.7 supported by DBIA #2173.
"RTN","PSJLIFN",7,0)
 ; Reference to ^PSDRUG( is supported by DBIA #2192.
"RTN","PSJLIFN",8,0)
 ; Reference to ^PSOORDRG is supported by DBIA #2190.
"RTN","PSJLIFN",9,0)
 ; Reference to ^%DT is supported by DBIA #10003.
"RTN","PSJLIFN",10,0)
 ; Reference to ^VALM is supported by DBIA #10118.
"RTN","PSJLIFN",11,0)
 ; Reference to ^VALM1 is supported by DBIA #10116.
"RTN","PSJLIFN",12,0)
 ; Reference to RE^VALM4 is supported by DBIA #10120.
"RTN","PSJLIFN",13,0)
 ;
"RTN","PSJLIFN",14,0)
EN ; Display order with numbers.
"RTN","PSJLIFN",15,0)
 L +^PS(53.1,+PSJORD):1 I '$T W !,$C(7),$C(7),"This order is being edited by another user. Try later." D PAUSE^VALM1 Q
"RTN","PSJLIFN",16,0)
 NEW PSJOCFG
"RTN","PSJLIFN",17,0)
 S PSJOCFG="FN IV"
"RTN","PSJLIFN",18,0)
 D PENDING K PSJREN,PSJOCFG
"RTN","PSJLIFN",19,0)
 L -^PS(53.1,+PSJORD)
"RTN","PSJLIFN",20,0)
 Q
"RTN","PSJLIFN",21,0)
PENDING ; Process pending order.
"RTN","PSJLIFN",22,0)
 ;* PSIVFN1 is used so it will display the AC/Edit screen
"RTN","PSJLIFN",23,0)
 ;* instead of go to the "IS this O.K." prompt
"RTN","PSJLIFN",24,0)
 ;* PSIVACEP only when accept the order. Original screen won't redisp.
"RTN","PSJLIFN",25,0)
 ;* PSJLMX is defined in WRTDRG^PSIVUTL and it was being call in PSJLIVMD & PSJLIVFD
"RTN","PSJLIFN",26,0)
 ;*        to count # of AD/SOL 
"RTN","PSJLIFN",27,0)
 NEW PSIVFN1,PSIVACEP,PSJLMX,PSIVOI,PSJOCCHK,PSJFNDS
"RTN","PSJLIFN",28,0)
 K PSJIVBD ;This variable was left over from the new backdoor order entry.
"RTN","PSJLIFN",29,0)
 ; PSJOCCHK is set so if EDIT was use instead of FN to finish order the OC is triggered
"RTN","PSJLIFN",30,0)
 S PSJOCCHK=1
"RTN","PSJLIFN",31,0)
 ;* PSJFNDS is set so dosing is trigger during finishing without changes to the add/sol
"RTN","PSJLIFN",32,0)
 S PSJFNDS=1
"RTN","PSJLIFN",33,0)
 S PSIVAC="CF" S (P("PON"),ON)=+PSJORD_"P",DFN=PSGP
"RTN","PSJLIFN",34,0)
 S PSIVUP=+$$GTPCI^PSIVUTL D GT531^PSIVORFA(DFN,ON)
"RTN","PSJLIFN",35,0)
 D:'$D(P("OT")) GTOT^PSIVUTL(P(4))
"RTN","PSJLIFN",36,0)
 NEW PSJL
"RTN","PSJLIFN",37,0)
 N PSIVNUM,PSJSTAR S PSIVNUM=1
"RTN","PSJLIFN",38,0)
 Q:ON'=PSJORD
"RTN","PSJLIFN",39,0)
 I $G(PSJLYN)]"" Q:ON'=PSJLYN
"RTN","PSJLIFN",40,0)
 S PSJMAI=ON
"RTN","PSJLIFN",41,0)
 I P("OT")="I" D  Q
"RTN","PSJLIFN",42,0)
 . S PSJSTAR="(5)^(7)^(9)^(10)"
"RTN","PSJLIFN",43,0)
 . D EN^VALM("PSJ LM IV INPT PENDING") ;; ^PSJLIVMD
"RTN","PSJLIFN",44,0)
 S PSJSTAR="(1)^(2)^(3)^(5)^(7)^(9)"
"RTN","PSJLIFN",45,0)
 D GTDATA D EN^VALM("PSJ LM IV PENDING") ;; ^PSJLIVFD
"RTN","PSJLIFN",46,0)
 K PSJMAI Q
"RTN","PSJLIFN",47,0)
 ;
"RTN","PSJLIFN",48,0)
DISPLAY ;
"RTN","PSJLIFN",49,0)
 S PSGACT=""
"RTN","PSJLIFN",50,0)
 S VALMSG="Press Return to continue"
"RTN","PSJLIFN",51,0)
 D:$E(P("OT"))="I" EN^VALM("PSJ LM IV INPT DISPLAY")
"RTN","PSJLIFN",52,0)
 D:$E(P("OT"))'="I" EN^VALM("PSJ LM IV DISPLAY")
"RTN","PSJLIFN",53,0)
 K PSJDISP
"RTN","PSJLIFN",54,0)
 S:'$G(PSJHIS) VALMBCK=""
"RTN","PSJLIFN",55,0)
 Q
"RTN","PSJLIFN",56,0)
GTDATA ;
"RTN","PSJLIFN",57,0)
 ;* D:P(4)="" 53^PSIVORC1 Q:P(4)=""  S P("DTYP")=$S(P(4)="":0,P(4)="P"!(P(23)="P")!(P(5)):1,P(4)="H":2,1:3)
"RTN","PSJLIFN",58,0)
 S P("DTYP")=$S(P(4)="":0,P(4)="P"!(P(23)="P")!(P(5)):1,P(4)="H":2,1:3)
"RTN","PSJLIFN",59,0)
 I 'P(2) D
"RTN","PSJLIFN",60,0)
 .I P("RES")="R" S PSJREN=1
"RTN","PSJLIFN",61,0)
 .D ENT^PSIVCAL K %DT S X=P(2),%DT="RTX" D ^%DT S P(2)=+Y
"RTN","PSJLIFN",62,0)
 I 'P(3) D ENSTOP^PSIVCAL K %DT S X=P(3),%DT="RTX" D ^%DT S P(3)=+Y
"RTN","PSJLIFN",63,0)
 I 'P("MR") S P("MR")=$O(^PS(51.2,"B","INTRAVENOUS",0))_"^IV"
"RTN","PSJLIFN",64,0)
 Q
"RTN","PSJLIFN",65,0)
FINISH ; Prompt for missing data
"RTN","PSJLIFN",66,0)
 ;* Ord chk for Inpat. pending only. Pend renew should not be checked.
"RTN","PSJLIFN",67,0)
 ;* PSIVOCON needed so this order will be excluded from the order
"RTN","PSJLIFN",68,0)
 ;*          list(ORDCHK^PSJLMUT1)
"RTN","PSJLIFN",69,0)
 ;* PSGORQF defined means cancel the order due to order check.
"RTN","PSJLIFN",70,0)
 ;Q:'$$LS^PSSLOCK(DFN,PSJORD)
"RTN","PSJLIFN",71,0)
 N PSJCOM,PSIVEDIT,PSJOLDNM,PSIVCAL
"RTN","PSJLIFN",72,0)
 S PSJCOM=+$P($G(^PS(53.1,+PSJORD,.2)),"^",8)
"RTN","PSJLIFN",73,0)
 K PSJIVBD,PSGRDTX,PSIVEDIT
"RTN","PSJLIFN",74,0)
 N FIL,PSIVS,DRGOC,PSIVXD,DRGTMP,PSIVOCON,PSGORQF,ON55,NSFF K PSGORQF S NSFF=1
"RTN","PSJLIFN",75,0)
 S (ON,PSIVOCON,ON55,PSGORD)=PSJORD D GTDRG^PSIVORFA Q:PSJORD'=PSJMAI  I $G(PSJLYN)]"" Q:PSJORD'=PSJLYN
"RTN","PSJLIFN",76,0)
 D UDVARS^PSJLIORD
"RTN","PSJLIFN",77,0)
 I $G(PSJPROT)=3,'$$ENIVUD^PSGOEF1(PSJORD) K NSFF Q
"RTN","PSJLIFN",78,0)
 D HOLDHDR^PSJOE
"RTN","PSJLIFN",79,0)
 ;PRE UAT group requested to not show the second screen since FDB OC has more text and provider override reason appears after 2nd screen 
"RTN","PSJLIFN",80,0)
 ; force the display of the second screen if CPRS order checks exist
"RTN","PSJLIFN",81,0)
 ;I $O(^PS(53.1,+PSJORD,12,0))!$O(^PS(53.1,+PSJORD,10,0)) D
"RTN","PSJLIFN",82,0)
 ;.Q:$G(PSJLMX)=1   ;no second screen to display
"RTN","PSJLIFN",83,0)
 ;.S VALMBG=16 D RE^VALM4,PAUSE^VALM1 S VALMBG=1
"RTN","PSJLIFN",84,0)
 S P("OPI")=$$ENPC^PSJUTL("V",+PSIVUP,60,P("OPI"))
"RTN","PSJLIFN",85,0)
 ;I $E(P("OT"))="I" D GTDATA Q:P(4)=""
"RTN","PSJLIFN",86,0)
 ;I $E(P("OT"))="I",'$D(DRG("AD")),('$D(DRG("SOL"))) D
"RTN","PSJLIFN",87,0)
 I $G(P("RES"))'="R" D 53^PSIVORC1
"RTN","PSJLIFN",88,0)
 I $G(P(4))]"",$G(P(15))]"",$G(P(9))]"",$$SCHREQ^PSJLIVFD(.P) D  Q:$G(PSGORQF)
"RTN","PSJLIFN",89,0)
 . ;*** PSJ*5*256
"RTN","PSJLIFN",90,0)
 . S PSJOLDNM("ORD_SCHD")=P(9)
"RTN","PSJLIFN",91,0)
 . I $$CHKSCHD^PSJMISC2(.PSJOLDNM,$S($G(P("RES"))="R":"R",1:"")) S PSGORQF=1,VALMBCK="R" Q
"RTN","PSJLIFN",92,0)
 . S:$G(PSJOLDNM("NEW_SCHD"))]"" P(9)=PSJOLDNM("NEW_SCHD")
"RTN","PSJLIFN",93,0)
 . N PSGS0XT,X,PSJNSS S PSJNSS=1,X=P(9),PSGS0XT=P(15) D Q2^PSGS0
"RTN","PSJLIFN",94,0)
 . I ON["P",$G(PSJOLDNM("NEW_SCHD"))]"" D
"RTN","PSJLIFN",95,0)
 ..I $G(PSGS0Y)]"",$G(P(11))]"",(PSGS0Y'=PSJOLDNM("NEW_SCHD")) D 
"RTN","PSJLIFN",96,0)
 ...W $C(7),!!,"PLEASE NOTE:  This order's admin times (",P(11),") do not match the times"
"RTN","PSJLIFN",97,0)
 ...W !?13," for this administration schedule (",PSJOLDNM("NEW_SCHD"),")",!
"RTN","PSJLIFN",98,0)
 ...D PAUSE^VALM1
"RTN","PSJLIFN",99,0)
 I P(4)="" D RE^VALM4 Q
"RTN","PSJLIFN",100,0)
 I $E(P("OT"))="I" D GTDATA  D
"RTN","PSJLIFN",101,0)
 . I '$D(DRG("AD")),('$D(DRG("SOL"))) S DNE=0 D GTIVDRG^PSIVORC2 S P(3)="" D ENSTOP^PSIVCAL
"RTN","PSJLIFN",102,0)
 S VALMBG=1
"RTN","PSJLIFN",103,0)
 I $E(P("OT"))="F" S DNE=0 I $G(PSGORQF) D RE^VALM4 Q
"RTN","PSJLIFN",104,0)
 I $G(PSGORQF) S VALMBCK="R",P(4)="" K DRG Q
"RTN","PSJLIFN",105,0)
 ; Will prompt users to choose Dispense IV Additive when more than one are available for the Orderable Item
"RTN","PSJLIFN",106,0)
 N PSJQUIT S PSJQUIT=0 D MULTADDS I $G(PSJQUIT) S VALMBCK="R" Q
"RTN","PSJLIFN",107,0)
 S PSIVEDIT=""
"RTN","PSJLIFN",108,0)
 S PSIVOK="1^3^10^25^26^39^57^58^59^63^64" D CKFLDS^PSIVORC1 I EDIT]"" D EDIT^PSIVEDT
"RTN","PSJLIFN",109,0)
 ;S PSIVOK="1^3^10^25^26^39^57^58^59^63^64" D CKFLDS^PSIVORC1 I EDIT]"" S PSIVEDIT=EDIT D EDIT^PSIVEDT
"RTN","PSJLIFN",110,0)
 ;I $G(EDIT)="" D OC^PSIVOC D:'$G(PSGORQF) IN^PSJOCDS($G(ON),"IV","") Q:$G(PSGORQF)
"RTN","PSJLIFN",111,0)
 I $D(PSIVEDIT) D OC^PSIVOC
"RTN","PSJLIFN",112,0)
 ;PSJ*5*261 - Remedy #490875 PSPO 2040 
"RTN","PSJLIFN",113,0)
 D ENSTOP^PSIVCAL
"RTN","PSJLIFN",114,0)
 ;D:'$G(PSGORQF) IN^PSJOCDS($G(ON),"IV","")
"RTN","PSJLIFN",115,0)
  ;If quit then restore DRG( to pre-edit state
"RTN","PSJLIFN",116,0)
 I $G(PSGORQF) D GT531^PSIVORFA(DFN,ON) Q
"RTN","PSJLIFN",117,0)
 I $G(DONE) S VALMBCK="R" Q
"RTN","PSJLIFN",118,0)
 ;* PSJFNDS is set so dosing is trigger during finishing without changes to the add/sol
"RTN","PSJLIFN",119,0)
 ;S PSJFNDS=1
"RTN","PSJLIFN",120,0)
 D COMPLTE^PSIVORC1
"RTN","PSJLIFN",121,0)
 S:$G(PSIVACEP) VALMBCK="Q"
"RTN","PSJLIFN",122,0)
 ;Reset PSJFNDS so if FN again, the dosing check is triggered.
"RTN","PSJLIFN",123,0)
 S:'$G(PSIVACEP) PSJFNDS=1
"RTN","PSJLIFN",124,0)
 I $G(PSGORQF) S VALMBG=1 D RE^VALM4
"RTN","PSJLIFN",125,0)
 K NSFF
"RTN","PSJLIFN",126,0)
 Q
"RTN","PSJLIFN",127,0)
 ;
"RTN","PSJLIFN",128,0)
MULTADDS ; If there are multiple IV Additives per Orderable Item, it will prompt for selection
"RTN","PSJLIFN",129,0)
 N TMPDRG
"RTN","PSJLIFN",130,0)
 S PSJQUIT=0
"RTN","PSJLIFN",131,0)
 I $O(DRG("AD",0)) D  I PSJQUIT D SAVEDRG^PSIVEDRG(.DRG,.TMPDRG) Q
"RTN","PSJLIFN",132,0)
 . D SAVEDRG^PSIVEDRG(.TMPDRG,.DRG)
"RTN","PSJLIFN",133,0)
 . N PSIDX,OI,IVLIST
"RTN","PSJLIFN",134,0)
 . F PSIDX=1:1 Q:'$D(DRG("AD",PSIDX))  D  I PSJQUIT Q
"RTN","PSJLIFN",135,0)
 . . S OI=$P(DRG("AD",PSIDX),"^",6) I 'OI Q
"RTN","PSJLIFN",136,0)
 . . K IVLIST D IVADDCNT(OI,.IVLIST) I $O(IVLIST(""),-1)'>1 Q
"RTN","PSJLIFN",137,0)
 . . W !!,"More than one dispense IV Additives are available for:"
"RTN","PSJLIFN",138,0)
 . . W !,"Orderable Item: ",$$GET1^DIQ(50.7,OI,.01)
"RTN","PSJLIFN",139,0)
 . . W !,"  Ordered Dose: ",$P(DRG("AD",PSIDX),"^",3)
"RTN","PSJLIFN",140,0)
 . . W !!,"Please select the correct dispense IV Additive below for this order:"
"RTN","PSJLIFN",141,0)
 . . N DIR,IVADD,IVCNT,X,Y,DIRUT,DUOUT
"RTN","PSJLIFN",142,0)
 . . S DIR("?")="Please select the correct dispense IV Additive below for this order:"
"RTN","PSJLIFN",143,0)
 . . F IVCNT=1:1 Q:'$D(IVLIST(IVCNT))  D  I PSJQUIT Q
"RTN","PSJLIFN",144,0)
 . . . S IVADD=IVLIST(IVCNT)
"RTN","PSJLIFN",145,0)
 . . . S X="  "_IVCNT_"  "_$$GET1^DIQ(52.6,IVADD,.01)
"RTN","PSJLIFN",146,0)
 . . . S $E(X,45)="Additive Strength: "_$S($$GET1^DIQ(52.6,IVADD,19)'="":$$GET1^DIQ(52.6,IVADD,19)_" "_$$GET1^DIQ(52.6,IVADD,2),1:"N/A")
"RTN","PSJLIFN",147,0)
 . . . S DIR("A",IVCNT)=X
"RTN","PSJLIFN",148,0)
 . . S DIR("A")="Select (1 - "_(IVCNT-1)_"): "
"RTN","PSJLIFN",149,0)
 . . S DIR(0)="LA^1:"_(IVCNT-1) D ^DIR I $D(DUOUT)!$D(DIRUT) S PSJQUIT=1 Q
"RTN","PSJLIFN",150,0)
 . . I (Y>0) D
"RTN","PSJLIFN",151,0)
 . . . S $P(DRG("AD",PSIDX),"^",1,2)=+IVLIST(+Y)_"^"_$$GET1^DIQ(52.6,+IVLIST(+Y),.01)
"RTN","PSJLIFN",152,0)
 . W !
"RTN","PSJLIFN",153,0)
 Q
"RTN","PSJLIFN",154,0)
 ;
"RTN","PSJLIFN",155,0)
ORDCHK ;* Do order check for Inpatient Meds IV.
"RTN","PSJLIFN",156,0)
 ; PSGORQF is defined (CONT^PSGSICHK) if not log an intervention
"RTN","PSJLIFN",157,0)
 ; No longer use after PSJ*5*181
"RTN","PSJLIFN",158,0)
 K PSGORQF
"RTN","PSJLIFN",159,0)
 Q
"RTN","PSJLIFN",160,0)
 ;NEW DRGOC
"RTN","PSJLIFN",161,0)
 ;D OCORD Q:$G(PSGORQF) 
"RTN","PSJLIFN",162,0)
 ;D GTIVDRG^PSIVORC2 S P(3)="" D ENSTOP^PSIVCAL
"RTN","PSJLIFN",163,0)
ORDCHKA ;* Do order check against existing orders on the profile
"RTN","PSJLIFN",164,0)
 ;No longer use as of PSJ*5*181
"RTN","PSJLIFN",165,0)
 Q
"RTN","PSJLIFN",166,0)
 F PSIVAS="AD","SOL" Q:$G(PSGORQF)  S FIL=$S(PSIVAS="AD":52.6,1:52.7) D
"RTN","PSJLIFN",167,0)
 . F PSIVX=0:0 S PSIVX=$O(DRG(PSIVAS,PSIVX)) Q:'PSIVX!($G(PSGORQF))  D
"RTN","PSJLIFN",168,0)
 .. S DRGTMP=DRG(PSIVAS,PSIVX)
"RTN","PSJLIFN",169,0)
 .. ;* Do only 1 duplicate warning when order has >1 of the same additive
"RTN","PSJLIFN",170,0)
 .. Q:$D(PSJADTMP(+DRGTMP))
"RTN","PSJLIFN",171,0)
 .. D ORDERCHK^PSIVEDRG(PSGP,ON,$D(DRGOC(ON)))
"RTN","PSJLIFN",172,0)
 .. S DRGOC(ON,PSIVAS,PSIVX)=DRG(PSIVAS,PSIVX)
"RTN","PSJLIFN",173,0)
 .. S PSJADTMP(+DRGTMP)=""
"RTN","PSJLIFN",174,0)
 K PSJADTMP
"RTN","PSJLIFN",175,0)
 Q
"RTN","PSJLIFN",176,0)
OCORD ;* Do order check for each drug against the drugs within the order.
"RTN","PSJLIFN",177,0)
 ;OCORD was called by ORDCHK.  This entry point is no longer use as of PSJ*5*181
"RTN","PSJLIFN",178,0)
 Q
"RTN","PSJLIFN",179,0)
 NEW X,Y,DDRUG,PSIVX,PSJAD,PSJSOL,TMPDRG
"RTN","PSJLIFN",180,0)
 D SAVEDRG^PSIVEDRG(.TMPDRG,.DRG)
"RTN","PSJLIFN",181,0)
 ; Find the corresponding DD for the additive within the order
"RTN","PSJLIFN",182,0)
 F X=0:0 S X=$O(DRG("AD",X)) Q:'X  D
"RTN","PSJLIFN",183,0)
 . S DDRUG=$P($G(^PS(52.6,+DRG("AD",X),0)),U,2)
"RTN","PSJLIFN",184,0)
 . S:+DDRUG (DDRUG(DDRUG),PSJAD(DDRUG))=$D(DDRUG(DDRUG))+1
"RTN","PSJLIFN",185,0)
 ;
"RTN","PSJLIFN",186,0)
 ; Find the corresponding DD for the solution
"RTN","PSJLIFN",187,0)
 ;
"RTN","PSJLIFN",188,0)
 F X=0:0 S X=$O(DRG("SOL",X)) Q:'X  D
"RTN","PSJLIFN",189,0)
 . S DDRUG=$P($G(^PS(52.7,+DRG("SOL",X),0)),U,2)
"RTN","PSJLIFN",190,0)
 . S:+DDRUG (DDRUG(DDRUG),PSJSOL(DDRUG))=$D(DDRUG(DDRUG))+1
"RTN","PSJLIFN",191,0)
 ;
"RTN","PSJLIFN",192,0)
 ; Loop thru each additive to check for DD,DI & DC against the
"RTN","PSJLIFN",193,0)
 ; order's dispense drugs
"RTN","PSJLIFN",194,0)
 ;
"RTN","PSJLIFN",195,0)
 NEW PSJDFN,INTERVEN S INTERVEN=""
"RTN","PSJLIFN",196,0)
 S PSJDFN=DFN ;DFN will be killed when call ^PSOORDRG
"RTN","PSJLIFN",197,0)
 F PSIVX=0:0 S PSIVX=$O(PSJAD(PSIVX)) Q:'PSIVX  D
"RTN","PSJLIFN",198,0)
 . K DDRUG(PSIVX) D DRGCHK^PSOORDRG(PSJDFN,PSIVX,.DDRUG)
"RTN","PSJLIFN",199,0)
 . I PSJAD(PSIVX)>1 S ^TMP($J,"DD",1,0)=PSIVX_U_$P($G(^PSDRUG(PSIVX,0)),U)_"^^"_ON_";I"
"RTN","PSJLIFN",200,0)
 . NEW TYPE F TYPE="DD","DI","DC" D ORDCHK^PSJLIFNI(PSJDFN,TYPE)
"RTN","PSJLIFN",201,0)
 F PSIVX=0:0 S PSIVX=$O(PSJSOL(PSIVX)) Q:'PSIVX  D
"RTN","PSJLIFN",202,0)
 . K DDRUG(PSIVX) D DRGCHK^PSOORDRG(PSJDFN,PSIVX,.DDRUG)
"RTN","PSJLIFN",203,0)
 . NEW TYPE F TYPE="DI" D ORDCHK^PSJLIFNI(PSJDFN,TYPE)
"RTN","PSJLIFN",204,0)
 S DFN=PSJDFN
"RTN","PSJLIFN",205,0)
 D SAVEDRG^PSIVEDRG(.DRG,.TMPDRG)
"RTN","PSJLIFN",206,0)
 Q
"RTN","PSJLIFN",207,0)
 ;
"RTN","PSJLIFN",208,0)
IVADDCNT(OI,IVLIST) ; Returns the number of IV Addtives Associated to the OI and Marked for IV Order Dialog
"RTN","PSJLIFN",209,0)
 ;Input: OI - PHARMACY ORDERABLE ITEM file (#50.7) IEN
"RTN","PSJLIFN",210,0)
 ;Output: $$IVADDCNT - Number of IV Additives linked to the Orderable Item
"RTN","PSJLIFN",211,0)
 ;        IVLIST(IV_IEN) - List of IV Additives linked to the Orderable Item
"RTN","PSJLIFN",212,0)
 N IVADD,IVADDCNT
"RTN","PSJLIFN",213,0)
 S IVADDCNT=0,IVADD=""
"RTN","PSJLIFN",214,0)
 F  S IVADD=$O(^PS(52.6,"AOI",OI,IVADD)) Q:'IVADD  D
"RTN","PSJLIFN",215,0)
 . ; Not Used in the IV Order Dialog
"RTN","PSJLIFN",216,0)
 . I '$$GET1^DIQ(52.6,IVADD,17,"I") Q
"RTN","PSJLIFN",217,0)
 . ; Other IV Solution is INACTIVE
"RTN","PSJLIFN",218,0)
 . I $$GET1^DIQ(52.6,IVADD,12,"I"),($$GET1^DIQ(52.6,IVADD,12,"I")'>DT) Q
"RTN","PSJLIFN",219,0)
 . ; Other IV Dispense Drug
"RTN","PSJLIFN",220,0)
 . S IVADDCNT=IVADDCNT+1,IVLIST(IVADDCNT)=IVADD
"RTN","PSJLIFN",221,0)
 Q
"RTN","PSJPDV0")
0^2^B33361495^B28813203
"RTN","PSJPDV0",1,0)
PSJPDV0 ;BIR/KKA-LIST PATIENTS ON SPECIFIC DRUGS (CONT.) ; 7/6/09 2:20pm
"RTN","PSJPDV0",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**12,22,33,214,380**;16 DEC 97;Build 10
"RTN","PSJPDV0",3,0)
 ;
"RTN","PSJPDV0",4,0)
 ;Reference to ^PS(52.6 is supported by DBIA 1231
"RTN","PSJPDV0",5,0)
 ;Reference to ^PS(52.7 is supported by DBIA 2173
"RTN","PSJPDV0",6,0)
 ;Reference to ^PS(55 is supported by DBIA 2191
"RTN","PSJPDV0",7,0)
 ;Reference to ^SC is supported by DBIA 10040
"RTN","PSJPDV0",8,0)
 ;Reference to ^DG(40.8 is supported by DBIA 728
"RTN","PSJPDV0",9,0)
 ;Reference to ^DIC(42 is supported by DBIA 1377
"RTN","PSJPDV0",10,0)
 ;
"RTN","PSJPDV0",11,0)
ENQ N TMPWD,TMPRB D NOW^%DTC S PSGDT=%,DT=$$DT^XLFDT
"RTN","PSJPDV0",12,0)
 K ^TMP("PSJ",$J),^TMP("PSJPDV",$J)
"RTN","PSJPDV0",13,0)
 D:CHOICE'="IV" UDORD D:CHOICE'="UD" IVORD
"RTN","PSJPDV0",14,0)
 I $D(PMATCH) S PSGP=0 F  S PSGP=$O(PMATCH(PSGP)) Q:'PSGP  D GETMAT I MATCHES'<PSJMAT&($D(^TMP("PSJPDV",$J,+PSGP))) D
"RTN","PSJPDV0",15,0)
 .S PSJACNWP=1 D ^PSJAC S TMPWD=PSJPWDN,TMPRB=PSJPRB,NM=PSGP(0),PSJJORD=0 F  S PSJJORD=$O(^TMP("PSJPDV",$J,PSGP,PSJJORD)) Q:'PSJJORD  D:PSJJORD'["V"&$$DIVWARD UDSET D:PSJJORD["V"&$$DIVWARD IVSET
"RTN","PSJPDV0",16,0)
 D ^PSJPDV1
"RTN","PSJPDV0",17,0)
 ;
"RTN","PSJPDV0",18,0)
DONE K ^TMP("PSJ",$J),^TMP("PSJPDV",$J),%,ADD,CHOICE,CLS,DFN,DO,DRG,IVDO,IVDRG,IVIR,IVMR,IVND,IVORD,IVPSGP,IVSCH,IVSPD,IVSTD,MR,ND,ND2,NM,PATDRG,PDRG,PMATCH,PSGDT,PSGP,PSJJORD,SCH,SOL,SPD,SPPDRG,STD,VA,VADM,VAIN
"RTN","PSJPDV0",19,0)
 Q
"RTN","PSJPDV0",20,0)
 ;
"RTN","PSJPDV0",21,0)
DIVWARD() ;DIVISION/WARD MATCH FOR PATIENT (PSJ*5*214)
"RTN","PSJPDV0",22,0)
 N PSJV,PSJVA,PSJVC
"RTN","PSJPDV0",23,0)
 S PSJVA=0
"RTN","PSJPDV0",24,0)
 I $G(VAUTD) I $G(VAUTW) Q 1  ;ALL DIVISIONS/ALL WARDS
"RTN","PSJPDV0",25,0)
 I $D(VAUTW(PSJPWD)) Q 1  ;SPECIFIC WARD MATCHES
"RTN","PSJPDV0",26,0)
 I '$G(VAUTD),'$G(PSJPWD) Q 1 ;specific division & no ward. Elimination will be at order level (CLN label)
"RTN","PSJPDV0",27,0)
 I $G(VAUTW) D  Q PSJVA  ;SPECIFIC DIVISION MATCHES
"RTN","PSJPDV0",28,0)
 . S PSJVC=0 F  S PSJVC=$O(VAUTD(PSJVC)) Q:PSJVC'=+PSJVC  S PSJV=VAUTD(PSJVC) I $G(PSJPWD) I PSJV=$P($G(^DG(40.8,+$P($G(^DIC(42,(+PSJPWD),0)),"^",11),0)),U,1) S PSJVA=1
"RTN","PSJPDV0",29,0)
 Q 0
"RTN","PSJPDV0",30,0)
 ;
"RTN","PSJPDV0",31,0)
UDORD ;find all Unit Dose orders with specified dispense drugs
"RTN","PSJPDV0",32,0)
 S SPD=$P(PSJREPS,".")-.0001 F  S SPD=$O(^PS(55,"AUD",SPD)) Q:'SPD  S PSGP=0 F  S PSGP=$O(^PS(55,"AUD",SPD,PSGP)) Q:'PSGP  D
"RTN","PSJPDV0",33,0)
 .S PSJJORD=0 F  S PSJJORD=$O(^PS(55,"AUD",SPD,PSGP,PSJJORD)) Q:'PSJJORD  D
"RTN","PSJPDV0",34,0)
 ..S ND=$G(^PS(55,PSGP,5,PSJJORD,2)) I +$P(ND,U,2)=0!(+$P(ND,U,2)>PSJREPF) Q
"RTN","PSJPDV0",35,0)
 ..Q:'$O(^PS(55,PSGP,5,PSJJORD,1,0))
"RTN","PSJPDV0",36,0)
 ..S PDRG=0 F  S PDRG=$O(^PS(55,PSGP,5,PSJJORD,1,PDRG)) Q:+PDRG=0  S SPPDRG=+$P(^(PDRG,0),"^") I $D(PSJISP(SPPDRG_"D")) S ^TMP("PSJPDV",$J,PSGP,PSJJORD)=SPD,CLS=PSJISP(SPPDRG_"D"),$P(PMATCH(PSGP),U,+CLS)=+CLS
"RTN","PSJPDV0",37,0)
 Q
"RTN","PSJPDV0",38,0)
 ;
"RTN","PSJPDV0",39,0)
UDSET ;get patient and order information and set in global
"RTN","PSJPDV0",40,0)
 N CLN,SC0
"RTN","PSJPDV0",41,0)
 I '$G(VAUTD),'$G(PSJPWD) D  Q:'$$CLN(SC0)
"RTN","PSJPDV0",42,0)
 . S CLN=$P($G(^PS(55,PSGP,5,PSJJORD,8)),U),SC0=$P($G(^SC(CLN,0)),U,15)
"RTN","PSJPDV0",43,0)
 S ND=$G(^PS(55,PSGP,5,PSJJORD,0)),MR=$P(ND,"^",3),MR=$$ENMRN^PSGMI(MR)
"RTN","PSJPDV0",44,0)
 S ND=$G(^PS(55,PSGP,5,PSJJORD,2)),DRG=$G(^(.2)),SCH=$P(ND,"^"),SPD=^TMP("PSJPDV",$J,PSGP,PSJJORD),STD=$S($P(ND,"^",2):$P(ND,"^",2),1:"NOT FOUND"),DO=$P(DRG,"^",2),DRG=$$ENPDN^PSGMI($P(DRG,"^")) I DO]"",$E(DO,$L(DO))'=" " S DO=DO_" "
"RTN","PSJPDV0",45,0)
 N X,PSJ
"RTN","PSJPDV0",46,0)
 D DRGDISP^PSJLMUT1(PSGP,PSJJORD_"U",30,0,.PSJ,1)
"RTN","PSJPDV0",47,0)
 S DRG=PSJ(1)
"RTN","PSJPDV0",48,0)
 S ^TMP("PSJ",$J,$S(PSJSRT="P":NM_";"_DFN,1:+$G(STD)),$S(PSJSRT="P":+$G(STD),1:NM_";"_DFN),PSJJORD)=VA("PID")_"^"_PSJPWDN_"^"_PSJPRB_"^"_DRG_"^"_DO_MR_" "_SCH_"^"_SPD
"RTN","PSJPDV0",49,0)
 Q
"RTN","PSJPDV0",50,0)
IVORD ;get IV orders matching the requested drug
"RTN","PSJPDV0",51,0)
 S IVSPD=$P(PSJREPS,".")-.0001 F  S IVSPD=$O(^PS(55,"AIV",IVSPD)) Q:'IVSPD  S IVPSGP=0 F  S IVPSGP=$O(^PS(55,"AIV",IVSPD,IVPSGP)) Q:'IVPSGP  D
"RTN","PSJPDV0",52,0)
 .S IVORD=0 F  S IVORD=$O(^PS(55,"AIV",IVSPD,IVPSGP,IVORD)) Q:'IVORD  D
"RTN","PSJPDV0",53,0)
 ..S ND=$G(^PS(55,IVPSGP,"IV",IVORD,0)) I +$P(ND,U,2)=0!(+$P(ND,U,2)>PSJREPF) Q
"RTN","PSJPDV0",54,0)
 ..D MATADD,MATSOL
"RTN","PSJPDV0",55,0)
 Q
"RTN","PSJPDV0",56,0)
MATADD ;see if additives of the order match the drug
"RTN","PSJPDV0",57,0)
 Q:'$O(^PS(55,IVPSGP,"IV",IVORD,"AD",0))
"RTN","PSJPDV0",58,0)
 S ADD=0 F  S ADD=$O(^PS(55,IVPSGP,"IV",IVORD,"AD",ADD)) Q:'ADD  S ND=$G(^(ADD,0)),ND2=$G(^PS(52.6,+$P(ND,"^"),0)) D
"RTN","PSJPDV0",59,0)
 .I ND2]"" I $D(PSJISP($S(PSJSL="O":+$P($G(ND2),U,11)_"O",1:+$P($G(ND2),U,2)_"D"))) S CLS=PSJISP($S(PSJSL="O":$P(ND2,"^",11)_"O",1:$P(ND2,"^",2)_"D")),$P(PMATCH(IVPSGP),U,+CLS)=+CLS,^TMP("PSJPDV",$J,IVPSGP,IVORD_"V")=IVSPD
"RTN","PSJPDV0",60,0)
 Q
"RTN","PSJPDV0",61,0)
MATSOL ;see if solutions of the order match the drug
"RTN","PSJPDV0",62,0)
 Q:'$O(^PS(55,IVPSGP,"IV",IVORD,"SOL",0))
"RTN","PSJPDV0",63,0)
 S SOL=0 F  S SOL=$O(^PS(55,IVPSGP,"IV",IVORD,"SOL",SOL)) Q:'SOL  S ND=$G(^(SOL,0)),ND2=$G(^PS(52.7,+$P(ND,"^"),0))  D
"RTN","PSJPDV0",64,0)
 .I ND2]"" I $D(PSJISP($S(PSJSL="O":+$P($G(ND2),U,11)_"O",1:+$P($G(ND2),U,2)_"D"))) S CLS=PSJISP($S(PSJSL="O":$P(ND2,"^",11)_"O",1:$P(ND2,"^",2)_"D")),$P(PMATCH(IVPSGP),U,+CLS)=+CLS,^TMP("PSJPDV",$J,IVPSGP,IVORD_"V")=IVSPD
"RTN","PSJPDV0",65,0)
 Q
"RTN","PSJPDV0",66,0)
 ;
"RTN","PSJPDV0",67,0)
IVSET ;S IVND=$G(^PS(55,PSGP,"IV",+PSJJORD,0)),IVSCH=$P(IVND,"^",9),IVSTD=$P(IVND,"^",2),IVSPD=^TMP("PSJPDV",$J,PSGP,PSJJORD),IVMR=$P($G(^PS(55,PSGP,"IV",+PSJJORD,6)),"^",3),IVIR=$P(IVND,"^",8)
"RTN","PSJPDV0",68,0)
 ;S IVMR=$$ENMRN^PSGMI(IVMR)
"RTN","PSJPDV0",69,0)
 ;S IVDRG=$G(^PS(55,PSGP,"IV",+PSJJORD,6)),IVDO=$P(IVDRG,"^",2),IVDRG=$$ENPDN^PSGMI($P(IVDRG,"^")) I IVDO]"",$E(IVDO,$L(IVDO))'=" " S IVDO=IVDO_" "
"RTN","PSJPDV0",70,0)
 N X,ON55,CLN,SC0 S DFN=PSGP,ON=PSJJORD D GT55^PSIVORFB
"RTN","PSJPDV0",71,0)
 S DRG=$S($D(DRG("AD",1)):$P(DRG("AD",1),U,2),1:$P(DRG("SOL",1),U,2)),IVSCH=P(9),IVSTD=P(2),IVSPD=^TMP("PSJPDV",$J,PSGP,PSJJORD),IVMR=$P(P("MR"),U,2),IVIR=P(8),IVDRG=DRG
"RTN","PSJPDV0",72,0)
 S PSJPWDN=$S($G(^PS(55,PSGP,"IV",+ON,"DSS")):$P($G(^SC(+$G(^PS(55,PSGP,"IV",+ON,"DSS")),0)),"^"),($G(PSJPDD)]""&(IVSTD>+PSJPDD)):"",1:TMPWD),PSJPRB=$S($G(^PS(55,PSGP,"IV",+ON,"DSS")):"",($G(PSJPDD)]""&(IVSTD>+PSJPDD)):"",1:TMPRB)
"RTN","PSJPDV0",73,0)
 I '$G(VAUTD),'$G(PSJPWD) D  Q:'$$CLN(SC0)
"RTN","PSJPDV0",74,0)
 . S CLN=$P($G(^PS(55,PSGP,"IV",+ON,"DSS")),"^"),SC0=$P($G(^SC(CLN,0)),U,15)
"RTN","PSJPDV0",75,0)
 S ^TMP("PSJ",$J,$S(PSJSRT="P":NM_";"_DFN,1:+$G(IVSTD)),$S(PSJSRT="P":+$G(IVSTD),1:NM_";"_DFN),PSJJORD)=VA("PID")_"^"_PSJPWDN_"^"_PSJPRB_"^"_IVDRG_"^"_IVMR_" "_IVSCH_" "_IVIR_"^"_IVSPD
"RTN","PSJPDV0",76,0)
 ;
"RTN","PSJPDV0",77,0)
GETMAT ;see if the patient has the number of drugs necessary to be printed on
"RTN","PSJPDV0",78,0)
 ;the report
"RTN","PSJPDV0",79,0)
 S MATCHES=0 F GG=1:1:$L(PMATCH(PSGP),"^") S GGG=$P(PMATCH(PSGP),"^",GG) S:GGG MATCHES=MATCHES+1
"RTN","PSJPDV0",80,0)
 Q
"RTN","PSJPDV0",81,0)
 ;
"RTN","PSJPDV0",82,0)
CLN(SDIV) ; check Out patient clinic orders 
"RTN","PSJPDV0",83,0)
 N DIV,FLG,PSJVC
"RTN","PSJPDV0",84,0)
 I 'SDIV Q 0
"RTN","PSJPDV0",85,0)
 S FLG=0 I SDIV>0 S DIV=$P(^DG(40.8,SDIV,0),U)
"RTN","PSJPDV0",86,0)
 I DIV]"" S PSJVC=0 F  S PSJVC=$O(VAUTD(PSJVC)) Q:PSJVC'=+PSJVC  S PSJV=VAUTD(PSJVC) I PSJV=DIV S FLG=1 Q
"RTN","PSJPDV0",87,0)
 Q FLG
"VER")
8.0^22.2
"BLD",11012,6)
^335
**END**
**END**

