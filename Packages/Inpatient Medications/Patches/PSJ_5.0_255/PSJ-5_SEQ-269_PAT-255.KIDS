Released PSJ*5*255 SEQ #269
Extracted from mail message
**KIDS**:PSJ*5.0*255^

**INSTALL NAME**
PSJ*5.0*255
"BLD",9216,0)
PSJ*5.0*255^INPATIENT MEDICATIONS^0^3150305^y
"BLD",9216,1,0)
^^11^11^3141215^
"BLD",9216,1,1,0)
This patch makes 3 corrections to the Inpatient Medications package:
"BLD",9216,1,2,0)
 
"BLD",9216,1,3,0)
1. In the CPRS Meds tab, the alphabetical sorting is not working 
"BLD",9216,1,4,0)
   correctly.
"BLD",9216,1,5,0)
 
"BLD",9216,1,6,0)
2. After renewing and editing a complex order, the original order still
"BLD",9216,1,7,0)
   shows as active.
"BLD",9216,1,8,0)
 
"BLD",9216,1,9,0)
3. A complex order renewed in CPRS will record the provider as the 
"BLD",9216,1,10,0)
   provider who originally placed the order, rather than the provider 
"BLD",9216,1,11,0)
   who renewed it.
"BLD",9216,4,0)
^9.64PA^^
"BLD",9216,6.3)
8
"BLD",9216,"KRN",0)
^9.67PA^779.2^20
"BLD",9216,"KRN",.4,0)
.4
"BLD",9216,"KRN",.401,0)
.401
"BLD",9216,"KRN",.402,0)
.402
"BLD",9216,"KRN",.403,0)
.403
"BLD",9216,"KRN",.5,0)
.5
"BLD",9216,"KRN",.84,0)
.84
"BLD",9216,"KRN",3.6,0)
3.6
"BLD",9216,"KRN",3.8,0)
3.8
"BLD",9216,"KRN",9.2,0)
9.2
"BLD",9216,"KRN",9.8,0)
9.8
"BLD",9216,"KRN",9.8,"NM",0)
^9.68A^3^3
"BLD",9216,"KRN",9.8,"NM",1,0)
PSJORRN^^0^B66760055
"BLD",9216,"KRN",9.8,"NM",2,0)
PSJORRN1^^0^B63215435
"BLD",9216,"KRN",9.8,"NM",3,0)
PSGOTR^^0^B21776310
"BLD",9216,"KRN",9.8,"NM","B","PSGOTR",3)

"BLD",9216,"KRN",9.8,"NM","B","PSJORRN",1)

"BLD",9216,"KRN",9.8,"NM","B","PSJORRN1",2)

"BLD",9216,"KRN",19,0)
19
"BLD",9216,"KRN",19.1,0)
19.1
"BLD",9216,"KRN",101,0)
101
"BLD",9216,"KRN",409.61,0)
409.61
"BLD",9216,"KRN",771,0)
771
"BLD",9216,"KRN",779.2,0)
779.2
"BLD",9216,"KRN",870,0)
870
"BLD",9216,"KRN",8989.51,0)
8989.51
"BLD",9216,"KRN",8989.52,0)
8989.52
"BLD",9216,"KRN",8994,0)
8994
"BLD",9216,"KRN","B",.4,.4)

"BLD",9216,"KRN","B",.401,.401)

"BLD",9216,"KRN","B",.402,.402)

"BLD",9216,"KRN","B",.403,.403)

"BLD",9216,"KRN","B",.5,.5)

"BLD",9216,"KRN","B",.84,.84)

"BLD",9216,"KRN","B",3.6,3.6)

"BLD",9216,"KRN","B",3.8,3.8)

"BLD",9216,"KRN","B",9.2,9.2)

"BLD",9216,"KRN","B",9.8,9.8)

"BLD",9216,"KRN","B",19,19)

"BLD",9216,"KRN","B",19.1,19.1)

"BLD",9216,"KRN","B",101,101)

"BLD",9216,"KRN","B",409.61,409.61)

"BLD",9216,"KRN","B",771,771)

"BLD",9216,"KRN","B",779.2,779.2)

"BLD",9216,"KRN","B",870,870)

"BLD",9216,"KRN","B",8989.51,8989.51)

"BLD",9216,"KRN","B",8989.52,8989.52)

"BLD",9216,"KRN","B",8994,8994)

"BLD",9216,"QDEF")
^^^^^^^^^^YES
"BLD",9216,"QUES",0)
^9.62^^
"BLD",9216,"REQB",0)
^9.611^3^2
"BLD",9216,"REQB",2,0)
PSJ*5.0*275^2
"BLD",9216,"REQB",3,0)
PSJ*5.0*257^2
"BLD",9216,"REQB","B","PSJ*5.0*257",3)

"BLD",9216,"REQB","B","PSJ*5.0*275",2)

"MBREQ")
0
"PKG",471,-1)
1^1
"PKG",471,0)
INPATIENT MEDICATIONS^PSJ^UNIT DOSE AND IVS
"PKG",471,20,0)
^9.402P^^
"PKG",471,22,0)
^9.49I^1^1
"PKG",471,22,1,0)
5.0^2971215^2990325^66481
"PKG",471,22,1,"PAH",1,0)
255^3150305
"PKG",471,22,1,"PAH",1,1,0)
^^11^11^3150305
"PKG",471,22,1,"PAH",1,1,1,0)
This patch makes 3 corrections to the Inpatient Medications package:
"PKG",471,22,1,"PAH",1,1,2,0)
 
"PKG",471,22,1,"PAH",1,1,3,0)
1. In the CPRS Meds tab, the alphabetical sorting is not working 
"PKG",471,22,1,"PAH",1,1,4,0)
   correctly.
"PKG",471,22,1,"PAH",1,1,5,0)
 
"PKG",471,22,1,"PAH",1,1,6,0)
2. After renewing and editing a complex order, the original order still
"PKG",471,22,1,"PAH",1,1,7,0)
   shows as active.
"PKG",471,22,1,"PAH",1,1,8,0)
 
"PKG",471,22,1,"PAH",1,1,9,0)
3. A complex order renewed in CPRS will record the provider as the 
"PKG",471,22,1,"PAH",1,1,10,0)
   provider who originally placed the order, rather than the provider 
"PKG",471,22,1,"PAH",1,1,11,0)
   who renewed it.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
3
"RTN","PSGOTR")
0^3^B21776310^B19636030
"RTN","PSGOTR",1,0)
PSGOTR ;BIR/CML3-TRANSFERS RENEW DATA FROM 53.1 TO 55 ;23 SEP 03 / 7:54 AM
"RTN","PSGOTR",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**110,127,133,129,267,257,255**;16 DEC 97;Build 8
"RTN","PSGOTR",3,0)
 ;
"RTN","PSGOTR",4,0)
 ; Reference to ^PS(55 supported by DBIA 2191.
"RTN","PSGOTR",5,0)
 ;
"RTN","PSGOTR",6,0)
START(ODA,DA) ; lock record, and write
"RTN","PSGOTR",7,0)
 N OFD,PVND4,PSGPV S OFD=""
"RTN","PSGOTR",8,0)
 S OFD=$P($G(^PS(55,PSGP,5,DA,2)),"^",4) K:OFD ^PS(55,"AUD",+OFD,PSGP,+DA)
"RTN","PSGOTR",9,0)
 S ND2=^PS(53.1,+ODA,2) S ^PS(55,"AUD",+$P(ND2,"^",4),PSGP,DA)=""
"RTN","PSGOTR",10,0)
 ;PSJ*5*255 - Record renewing provider
"RTN","PSGOTR",11,0)
 I $P(^PS(53.1,+ODA,0),U,2)]"" S PSGPV=$P(^PS(53.1,+ODA,0),U,2) D
"RTN","PSGOTR",12,0)
 . N DR,DIE
"RTN","PSGOTR",13,0)
 . S DR="1////^S X=PSGPV",DIE="^PS(55,"_PSGP_",5,",DA(1)=PSGP D ^DIE
"RTN","PSGOTR",14,0)
 ;End PSJ*5*255
"RTN","PSGOTR",15,0)
 F X=6,7 I $D(^PS(53.1,+ODA,X)) S ^PS(55,PSGP,5,DA,X)=^(X)
"RTN","PSGOTR",16,0)
 I $O(^PS(53.1,+ODA,1,0)) D
"RTN","PSGOTR",17,0)
 .K ^PS(55,PSGP,5,DA,1)
"RTN","PSGOTR",18,0)
 .S (C,X)=0 F  S X=$O(^PS(53.1,+ODA,1,X)) Q:'X  S:$D(^(X,0)) C=C+1,^PS(55,PSGP,5,DA,1,C,0)=^(0),^PS(55,PSGP,5,DA,1,"B",+$P($G(^(0)),U),C)=""
"RTN","PSGOTR",19,0)
 .S ^PS(55,PSGP,5,DA,1,0)="^55.07P^"_C_"^"_C
"RTN","PSGOTR",20,0)
 F X=3,12 D  S ^PS(55,PSGP,5,DA,X,0)="^55.0"_$S(X=3:8,1:612)_U_CNT_U_CNT
"RTN","PSGOTR",21,0)
 .S CNT=0 F C=0:0 S C=$O(^PS(53.1,+ODA,X,C)) Q:'C  I $D(^(C,0)) S ^PS(55,PSGP,5,DA,X,C,0)=^(0),CNT=CNT+1
"RTN","PSGOTR",22,0)
 S $P(^PS(53.1,+ODA,0),"^",19)=DA
"RTN","PSGOTR",23,0)
 S $P(^PS(55,PSGP,5,DA,0),"^",7)=$P(^PS(53.1,+ODA,0),"^",7)
"RTN","PSGOTR",24,0)
 N PSGPND0,PSGPND2,RDUZ,OND14 S PSGPND0=^PS(53.1,+ODA,0),PSGPND2=^(2) S RNWDT=$P(PSGPND0,"^",16),PSGOEPR=$P(PSGPND0,"^",2)
"RTN","PSGOTR",25,0)
 S PSGFD=$P(PSGPND2,"^",4),PSJNOO=$P(^PS(53.1,+ODA,.2),"^",3) S OND14=$$LASTREN^PSJLMPRI(PSGP,+ODA_"P") S RDUZ=$P(OND14,"^",2) S:$P(OND14,"^",3) PSGOEPR=$P(OND14,"^",3)
"RTN","PSGOTR",26,0)
 I '$G(DUOUT) D
"RTN","PSGOTR",27,0)
 .I $G(PSJORD)["P" N PSGFDO S PSGFDO=$$LASTREN^PSJLMPRI(PSGP,PSJORD),PSGFDO=$P(PSGFDO,"^",4)
"RTN","PSGOTR",28,0)
 .D UPDREN^PSGOER(DA_"U",RNWDT,PSGOEPR,$S($G(PSGFDO):PSGFDO,1:PSGFD),PSJNOO,RDUZ)
"RTN","PSGOTR",29,0)
 S PVND4=$G(^PS(53.1,+ODA,4)) I $P(PVND4,"^"),$P(PVND4,"^",2) D
"RTN","PSGOTR",30,0)
 .N RNDT S RNDT=$$LASTREN^PSJLMPRI(DFN,+ODA_"P") Q:RNDT>$P(PVND4,"^",2)
"RTN","PSGOTR",31,0)
 .S $P(^PS(55,DFN,5,DA,4),"^")=$P(PVND4,"^"),$P(^PS(55,DFN,5,DA,4),"^",2)=$P(PVND4,"^",2)
"RTN","PSGOTR",32,0)
CR ; set x-refs
"RTN","PSGOTR",33,0)
 I $D(^PS(55,PSGP,5.1)),$P(^(5.1),"^",6) S X=$P(^(5.1),"^",6) I $P(ND2,"^",3),$P(ND2,"^",6)'>X S $P(^(5.1),"^",6)=$P(ND2,"^",3)
"RTN","PSGOTR",34,0)
 S ^PS(55,PSGP,5,"B",+ODA,DA)="",^PS(55,"AUE",PSGP,DA)=""
"RTN","PSGOTR",35,0)
 F S="C","O","P","R","OC" K ^PS(55,PSGP,5,"AU",S,+$P(PSGPND2,"^",4),DA)
"RTN","PSGOTR",36,0)
 ; PSJ*5.0*255/kill old "AU" x-ref of the last stop date
"RTN","PSGOTR",37,0)
 I $P(OND14,"^",4) F S="C","O","P","R","OC" K ^PS(55,PSGP,5,"AU",S,+$P(OND14,"^",4),DA)
"RTN","PSGOTR",38,0)
 S ^PS(55,PSGP,5,"AU",$P(PSGPND0,"^",7),+$P(PSGPND2,"^",4),DA)=""
"RTN","PSGOTR",39,0)
 S ^PS(55,PSGP,5,"AUS",+$P(ND2,"^",4),DA)="" I OFD,OFD'=$P(ND2,"^",4) K ^PS(55,PSGP,5,"AUS",+OFD,DA)
"RTN","PSGOTR",40,0)
 D CIMOU^PSJIMO1(PSGP,DA,"",ODA)
"RTN","PSGOTR",41,0)
 I $$PATCH^XPDUTL("PXRM*1.5*12") S X(1)=+$P(ND2,"^",2),X(2)=+$P(ND2,"^",4),DA(1)=PSGP D SPSPA^PSJXRFS(.X,.DA,"UD")
"RTN","PSGOTR",42,0)
 K DIK S DA(1)=PSGP S DIK="^PS(55,"_DA(1)_",5,",DIK(1)=125 D EN1^DIK K DIK
"RTN","PSGOTR",43,0)
 S PSGTOL=2,PSGTOO=1 F PSGUOW=0:0 S PSGUOW=$O(^PS(53.41,2,1,PSGUOW)) Q:'PSGUOW  I $D(^(PSGUOW,1,PSGP,1,2,1,+ODA)) K ^(+ODA) D ENL^PSGVDS
"RTN","PSGOTR",44,0)
DONE I $D(PSGOE2),PSGOE2]"",$D(^TMP("PSJON",$J,PSGOE2)) S ^(PSGOE2)=DA_"U"
"RTN","PSGOTR",45,0)
 S PSGODA=ODA,PSGORD=DA_"U"
"RTN","PSGOTR",46,0)
 F Q=0:0 S Q=$O(^PS(53.44,Q)) Q:'Q  I $D(^(Q,1,PSGP,+ODA,0)) S $P(^(0),"^",2)=DA
"RTN","PSGOTR",47,0)
 I $D(^PS(53.1,+ODA,15,0)) N SIARRAY D
"RTN","PSGOTR",48,0)
 .M SIARRAY=^PS(55,PSGP,5,+DA,15) I $$DIFFSI^PSJBCMA5(PSGP,+DA_"U") D NEWUDAL^PSGAL5(PSGP,+DA_"U",6000,"SPECIAL INSTRUCTIONS",,.SIARRAY)
"RTN","PSGOTR",49,0)
 .K ^PS(55,PSGP,5,DA,15) S ^PS(55,PSGP,5,DA,6)=$G(^PS(53.1,+ODA,6)) S ^PS(55,PSGP,5,DA,15,0)="^55.6135^"_$P($G(^PS(53.1,+ODA,15,0)),"^",3)_"^"_$P($G(^PS(53.1,+ODA,15,0)),"^",4)
"RTN","PSGOTR",50,0)
 .N LN,LNCNT S LNCNT=0,LN=9999 F  S LN=$O(^PS(53.1,+ODA,15,LN),-1) Q:'LN  D
"RTN","PSGOTR",51,0)
 ..I 'LNCNT,($G(^PS(53.1,+ODA,15,LN,0))="") Q
"RTN","PSGOTR",52,0)
 ..S ^PS(55,PSGP,5,DA,15,LN,0)=^PS(53.1,+ODA,15,LN,0) S LNCNT=LNCNT+1
"RTN","PSGOTR",53,0)
 .I LNCNT S $P(^PS(55,PSGP,5,DA,15,0),"^",3,4)=LNCNT_"^"_LNCNT
"RTN","PSGOTR",54,0)
 .N TXT,LNCNT,SIMSG S LNCNT=$O(^PS(53.1,+ODA,15,""),-1) S SIMSG="Instructions too long. See Order View or BCMA for full text."
"RTN","PSGOTR",55,0)
 .S PSJTMPTX="",PSJOVRMX=0 S TMPLIN=0 F  S TMPLIN=$O(^PS(55,+DFN,5,DA,15,TMPLIN)) Q:'TMPLIN!(PSJOVRMX)  D
"RTN","PSGOTR",56,0)
 ..S:($L(PSJTMPTX)+$L($G(^PS(55,+DFN,5,DA,15,TMPLIN,0))))>180 PSJOVRMX=1 Q:$G(PSJOVRMX)  S PSJTMPTX=$G(PSJTMPTX)_$S($G(PSJTMPTX)]"":" ",1:"")_$G(^PS(55,+DFN,5,DA,15,TMPLIN,0))
"RTN","PSGOTR",57,0)
 .S TXT=$S(PSJOVRMX:SIMSG,1:PSJTMPTX)
"RTN","PSGOTR",58,0)
 .S:($TR(TXT,"^ ")="")!'($D(^PS(55,PSGP,5,DA,15,1))) TXT="" S ^PS(55,PSGP,5,DA,6)=TXT S $P(^PS(55,PSGP,5,DA,6),"^",2)=$P(^PS(53.1,+ODA,6),"^",2)
"RTN","PSGOTR",59,0)
 .N LSTLNUM,LSTLNTXT S LSTLNUM=$O(^PS(55,+PSGP,5,+DA,15,""),-1) I LSTLNUM>1 S LSTLNTXT=$G(^PS(55,+PSGP,5,+DA,15,LSTLNUM,0)) I $TR(LSTLNTXT," ")="" D
"RTN","PSGOTR",60,0)
 ..K ^PS(55,+PSGP,5,+DA,15,LSTLNUM,0)
"RTN","PSGOTR",61,0)
 L -^PS(53.1,+ODA) L -^PS(55,PSGP,5,+DA) K CNT,ND,ODA,XX,ZND Q
"RTN","PSJORRN")
0^1^B66760055^B66656039
"RTN","PSJORRN",1,0)
PSJORRN ;BIR/MV-RETURN INPATIENT ACTIVE MEDS (CONDENSED) NEW SORT ; 2/28/11 3:21pm
"RTN","PSJORRN",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**134,213,225,275,255**;16 DEC 97;Build 8
"RTN","PSJORRN",3,0)
 ;
"RTN","PSJORRN",4,0)
 ;Reference to ^PS(52.6 is supported by DBIA 1231.
"RTN","PSJORRN",5,0)
 ;Reference to ^PS(52.7 is supported by DBIA 2173.
"RTN","PSJORRN",6,0)
 ;Reference to ^PS(55 is supported by DBIA 2191.
"RTN","PSJORRN",7,0)
 ;Reference to ^PS(50.7 is supported by DBIA #2180.
"RTN","PSJORRN",8,0)
 ;Reference to ^TMP("PS" is documented in DBIA #2383.
"RTN","PSJORRN",9,0)
 ;
"RTN","PSJORRN",10,0)
OCL(DFN,BDT,EDT,TFN) ; return condensed list of inpat meds
"RTN","PSJORRN",11,0)
 ; MVIEW=2   -  This is the new sort with GUI 27
"RTN","PSJORRN",12,0)
 ; Execute this section if MVIEW=2
"RTN","PSJORRN",13,0)
 N ADM,CNT,DN,DO,F,FON,INFUS,INST,MR,ND,ND0,ND2,ND6,ON,PON,PST,SCH,SIO,STAT,TYPE,UNITS,WBDT,X,Y,PSJCLIN,A,TFN2,%
"RTN","PSJORRN",14,0)
 S TFN2=0
"RTN","PSJORRN",15,0)
 ; PON=placer order number (oerr), FON=filler order number
"RTN","PSJORRN",16,0)
 ; *225 Add time or base on now
"RTN","PSJORRN",17,0)
 D NOW^%DTC S:BDT="" BDT=% S:BDT'["." BDT=BDT_".000001"
"RTN","PSJORRN",18,0)
 S:EDT="" EDT=9999999
"RTN","PSJORRN",19,0)
 S:EDT'["." EDT=EDT_".999999"
"RTN","PSJORRN",20,0)
 ;*225 Correct Display Calcualtion
"RTN","PSJORRN",21,0)
 S F="^PS(55,DFN,5,",WBDT=BDT F  S WBDT=$O(^PS(55,DFN,5,"AUS",WBDT)) Q:'WBDT  F ON=0:0 S ON=$O(^PS(55,DFN,5,"AUS",WBDT,ON)) Q:'ON  D UDTMP
"RTN","PSJORRN",22,0)
 S F="^PS(53.1," F PST="P","N" S ON=0 F  S ON=$O(^PS(53.1,"AS",PST,DFN,ON)) Q:'ON  S X=$P($G(^PS(53.1,+ON,0)),U,4) D @$S(X="U":"UDTMP",1:"IVTMP")
"RTN","PSJORRN",23,0)
 S F="^PS(55,"_DFN_",""IV"",",WBDT=BDT F  S WBDT=$O(^PS(55,DFN,"IV","AIS",WBDT)) Q:'WBDT  S ON=0 F  S ON=$O(^PS(55,DFN,"IV","AIS",WBDT,ON)) Q:'ON  D IVTMP
"RTN","PSJORRN",24,0)
 S X1="" F  S X1=$O(^TMP("PSJTMP",$J,X1)) Q:X1=""  S X2="" F  S X2=$O(^TMP("PSJTMP",$J,X1,X2)) Q:X2=""  D
"RTN","PSJORRN",25,0)
 .S X3="" F  S X3=$O(^TMP("PSJTMP",$J,X1,X2,X3)) Q:X3=""  S X4="" F  S X4=$O(^TMP("PSJTMP",$J,X1,X2,X3,X4)) Q:X4=""  D
"RTN","PSJORRN",26,0)
 ..S X5="" F  S X5=$O(^TMP("PSJTMP",$J,X1,X2,X3,X4,X5)) Q:X5=""  S TFN=$G(TFN)+1 D
"RTN","PSJORRN",27,0)
 ...; The merge below sends the proper ^TMP("PS",$J structure back to the calling
"RTN","PSJORRN",28,0)
 ...; routine PSJORRE
"RTN","PSJORRN",29,0)
 ...M ^TMP("PS",$J,TFN)=^TMP("PSJTMP",$J,X1,X2,X3,X4,X5) S ^TMP("PS",$J,"PC",0)=TFN
"RTN","PSJORRN",30,0)
 K ^TMP("PSJTMP",$J)
"RTN","PSJORRN",31,0)
 Q
"RTN","PSJORRN",32,0)
 ;
"RTN","PSJORRN",33,0)
UDTMP ;*** Set ^TMP for Unit dose orders.
"RTN","PSJORRN",34,0)
 N PROVIDER,ND8,RNWDT,EDTCMPLX,NDP2,PSJOINM,PSJOI,PSJDDNM,LOC,PRIO,NDDSS
"RTN","PSJORRN",35,0)
 S (MR,SCH,INST,PON,NDDSS)="",FON=+ON_$S(F["53.1":"P",1:"U")
"RTN","PSJORRN",36,0)
 D TYPE
"RTN","PSJORRN",37,0)
 S RNWDT=$$LASTREN^PSJLMPRI(DFN,FON) I RNWDT S RNWDT=+RNWDT
"RTN","PSJORRN",38,0)
 S NDP2=$G(@(F_ON_",.2)")) S EDTCMPLX=$P(NDP2,"^",8),PRIO=$P(NDP2,"^",4)
"RTN","PSJORRN",39,0)
 S ND2=$G(@(F_ON_",2)")) I 'EDTCMPLX I F'["53.1",($P(ND2,U,2)>EDT) Q
"RTN","PSJORRN",40,0)
 S ND0=$G(@(F_ON_",0)")) I 'EDTCMPLX I F["53.1",($P(ND0,U,16)>EDT) Q
"RTN","PSJORRN",41,0)
 S ND8=$G(@(F_ON_",8)")),NDP2=$P($G(@(F_ON_",.2)")),"^")
"RTN","PSJORRN",42,0)
 S STAT=$$CODES^PSIVUTL($P(ND0,U,9),$S(FON["P":53.1,1:55.06),28)
"RTN","PSJORRN",43,0)
 S ND6=$P($G(@(F_ON_",6)")),"^"),INST=$G(@(F_+ON_",.3)"))
"RTN","PSJORRN",44,0)
 S:ND6["Instructions too long. See Order View or BCMA for full text" ND6="Instructions too long. See order details for full text."
"RTN","PSJORRN",45,0)
 S FON=+ON_$S(F["53.1":"P",1:"U"),DO=$P($G(@(F_ON_",.2)")),"^",2)
"RTN","PSJORRN",46,0)
 D DRGDISP^PSJLMUT1(DFN,FON,40,0,.DN,1)
"RTN","PSJORRN",47,0)
 ;*225 Don't allow 0 Units
"RTN","PSJORRN",48,0)
 S UNITS="" I '$O(@(F_+ON_",1,1)")) S UNITS=$P($G(@(F_+ON_",1,1,0)")),U,2) S:(FON["U")&(+UNITS=0) UNITS=1
"RTN","PSJORRN",49,0)
 S:+$P(ND0,U,3) MR=$$MR^PSJORRE1(+$P(ND0,U,3))
"RTN","PSJORRN",50,0)
 N NOTGIVEN S NOTGIVEN=$S(FON["U":$P($G(^PS(55,DFN,5,+ON,0)),"^",22),1:"")
"RTN","PSJORRN",51,0)
 ;******** GUI 27 new sort for Meds Tab
"RTN","PSJORRN",52,0)
 I F[53.1 S NDDSS=$G(@(F_ON_",""DSS"")")),LOC=$P(NDDSS,"^")
"RTN","PSJORRN",53,0)
 S:F'[53.1 LOC=$P(ND8,"^") S LOC=$S($P($G(NDDSS),"^",2):LOC,1:"~") I LOC S LOC=$P($G(^SC(LOC,0)),"^")
"RTN","PSJORRN",54,0)
 S PSJST=$P(ND0,"^",9)
"RTN","PSJORRN",55,0)
 S GP=$S((",A,R,H,RE,")[(","_PSJST_","):1,(",P,N,")[(","_PSJST_","):2,PSJST="E":3,(",D,DE,DR,")[(","_PSJST_","):4,1:0)
"RTN","PSJORRN",56,0)
 S PSJST2=$S(PSJST="A":1,PSJST="R":2,PSJST="H":3,PSJST="S":4,PSJST="P":5,PSJST="O":6,PSJST="N":7,PSJST="I":8,PSJST="P":9,GP=4&($G(PRIO)="D"):10,PSJST="E":11,PSJST="D":12,PSJST="DE":13,PSJST="RE":14,PSJST="R":15,1:0)
"RTN","PSJORRN",57,0)
 S PSJOI=$P(NDP2,"^"),PSJOINM=$P($G(^PS(50.7,+PSJOI,0)),"^")
"RTN","PSJORRN",58,0)
 ;*******
"RTN","PSJORRN",59,0)
 S TFN2=$G(TFN2)+1
"RTN","PSJORRN",60,0)
 S CNT=0,PSJOINM=$$UP^XLFSTR($S(PSJOINM]"":PSJOINM,1:"UNKNOWN"))
"RTN","PSJORRN",61,0)
 S ^TMP("PSJTMP",$J,GP,PSJST,LOC,PSJOINM,TFN2,0)=FON_";I"_U_DN(1)_"^^"_$P(ND2,U,4)_"^^"_DO_U_UNITS_U_$P(ND0,U,21)_U_STAT_U_U_U_U_NOTGIVEN_U_($P(ND0,U,9)="P"&($P(ND0,U,24)="R"))_U_$P(ND2,U,2)_U_$G(RNWDT)
"RTN","PSJORRN",62,0)
 K ^TMP("PSJTMP",$J,GP,PSJST,LOC,PSJOINM,TFN2,"CLINIC",0) I PSJCLIN]"" S ^TMP("PSJTMP",$J,GP,PSJST,LOC,PSJOINM,TFN2,"CLINIC",0)=PSJCLIN
"RTN","PSJORRN",63,0)
 S PROVIDER=$P($G(@(F_+ON_",0)")),"^",2)
"RTN","PSJORRN",64,0)
 I PROVIDER S ^TMP("PSJTMP",$J,GP,PSJST,LOC,PSJOINM,TFN2,"P",0)=PROVIDER_"^"_$P($G(^VA(200,PROVIDER,0)),"^")
"RTN","PSJORRN",65,0)
 S ^TMP("PSJTMP",$J,GP,PSJST,LOC,PSJOINM,TFN2,"MDR",0)=MR]"" S:MR]"" ^TMP("PSJTMP",$J,GP,PSJST,LOC,PSJOINM,TFN2,"MDR",1,0)=MR
"RTN","PSJORRN",66,0)
 S ^TMP("PSJTMP",$J,GP,PSJST,LOC,PSJOINM,TFN2,"SCH",0)=$P(ND2,U)]"" S:$P(ND2,U)]"" ^TMP("PSJTMP",$J,GP,PSJST,LOC,PSJOINM,TFN2,"SCH",1,0)=$P(ND2,U)
"RTN","PSJORRN",67,0)
 S ^TMP("PSJTMP",$J,GP,PSJST,LOC,PSJOINM,TFN2,"SIG",0)=INST]"" S:INST]"" ^TMP("PSJTMP",$J,GP,PSJST,LOC,PSJOINM,TFN2,"SIG",1,0)=INST
"RTN","PSJORRN",68,0)
 S ^TMP("PSJTMP",$J,GP,PSJST,LOC,PSJOINM,TFN2,"ADM",0)=$P(ND2,U,5)]"" S:$P(ND2,U,5)]"" ^TMP("PSJTMP",$J,GP,PSJST,LOC,PSJOINM,TFN2,"ADM",1,0)=$P(ND2,U,5)
"RTN","PSJORRN",69,0)
 S ^TMP("PSJTMP",$J,GP,PSJST,LOC,PSJOINM,TFN2,"SIO",0)=ND6]"" S:ND6]"" ^TMP("PSJTMP",$J,GP,PSJST,LOC,PSJOINM,TFN2,"SIO",1,0)=ND6
"RTN","PSJORRN",70,0)
 Q
"RTN","PSJORRN",71,0)
 ;
"RTN","PSJORRN",72,0)
IVTMP ;*** Set ^TMP for IV orders.
"RTN","PSJORRN",73,0)
 N PROVIDER,START,STOP,EDTCMPLX,NDP2,IVLIM,PRIO,LOC,NDDSS
"RTN","PSJORRN",74,0)
 S (PROVIDER,START,STOP,EDTCMPLX,NDP2,IVLIM,PRIO,LOC,NDDSS)=""
"RTN","PSJORRN",75,0)
 S NDP2=$G(@(F_ON_",.2)")) S EDTCMPLX=$P(NDP2,"^",8),PRIO=$P(NDP2,"^",4)
"RTN","PSJORRN",76,0)
 S ND0=$G(@(F_ON_",0)")) I 'EDTCMPLX I F'["53.1",($P(ND0,U,2)>EDT) Q
"RTN","PSJORRN",77,0)
 D TYPE
"RTN","PSJORRN",78,0)
 S FON=+ON_$S(F["53.1":"P",1:"V"),TFN2=TFN2+1,CNT=0
"RTN","PSJORRN",79,0)
 S RNWDT=$$LASTREN^PSJLMPRI(DFN,FON) I RNWDT S RNWDT=+RNWDT
"RTN","PSJORRN",80,0)
 ;******** GUI 27 new sort for Meds Tab
"RTN","PSJORRN",81,0)
 S NDDSS=$G(@(F_ON_",""DSS"")")),NDP2=$G(@(F_ON_",.2)"))
"RTN","PSJORRN",82,0)
 S PSJOI=$P(NDP2,"^")
"RTN","PSJORRN",83,0)
 I F[53.1 S PSJST=$P(ND0,"^",9)
"RTN","PSJORRN",84,0)
 I F'[53.1 S PSJST=$P(ND0,"^",17)
"RTN","PSJORRN",85,0)
 S GP=$S((",A,R,H,RE,")[(","_PSJST_","):1,(",P,N,")[(","_PSJST_","):2,PSJST="E":3,(",D,DE,DR,")[(","_PSJST_","):4,1:0)
"RTN","PSJORRN",86,0)
 S PSJST2=$S(PSJST="A":1,PSJST="R":2,PSJST="H":3,PSJST="S":4,PSJST="P":5,PSJST="O":6,PSJST="N":7,PSJST="I":8,PSJST="P":9,GP=4&($G(PRIO)="D"):10,PSJST="E":11,PSJST="D":12,PSJST="DE":13,PSJST="RE":14,PSJST="R":15,1:0)
"RTN","PSJORRN",87,0)
 S LOC=$P(NDDSS,"^") S LOC=$S($P(NDDSS,"^",2):LOC,1:"~") I LOC S LOC=$P($G(^SC(LOC,0)),"^")
"RTN","PSJORRN",88,0)
 I PSJOI'="" S PSJOINM=$P($G(^PS(50.7,+PSJOI,0)),"^")
"RTN","PSJORRN",89,0)
 I PSJOI="" S PSJOINM="Orderable Item Not Found"
"RTN","PSJORRN",90,0)
 ;********
"RTN","PSJORRN",91,0)
 S CNT=0,PSJOINM=$S(PSJOINM]"":PSJOINM,1:"UNKNOWN")
"RTN","PSJORRN",92,0)
 F X=0:0 S X=$O(@(F_ON_",""AD"","_X_")")) Q:'X  S ND=$G(@(F_ON_",""AD"","_X_",0)")),DN=$P($G(^PS(52.6,+ND,0)),U),Y=DN_U_$P(ND,U,2) S:$P(ND,U,3) Y=Y_U_$P(ND,U,3) S CNT=CNT+1,^TMP("PSJTMP",$J,GP,PSJST,LOC,PSJOINM,TFN2,"A",CNT,0)=Y
"RTN","PSJORRN",93,0)
 S ^TMP("PSJTMP",$J,GP,PSJST,LOC,PSJOINM,TFN2,"A",0)=CNT,CNT=0
"RTN","PSJORRN",94,0)
 F X=0:0 S X=$O(@(F_ON_",""SOL"","_X_")")) Q:'X  S ND=$G(@(F_ON_",""SOL"","_X_",0)")),DN=$G(^PS(52.7,+ND,0)),CNT=CNT+1,^TMP("PSJTMP",$J,GP,PSJST,LOC,PSJOINM,TFN2,"B",CNT,0)=$P(DN,U)_U_$P(ND,U,2)_U_$P(DN,U,4)
"RTN","PSJORRN",95,0)
 S ^TMP("PSJTMP",$J,GP,PSJST,LOC,PSJOINM,TFN2,"B",0)=CNT
"RTN","PSJORRN",96,0)
 S TYPE=$P(ND0,U,4),(MR,SCH,INST,INFUS)=""
"RTN","PSJORRN",97,0)
 I FON["P" S ND2=$G(^PS(53.1,+ON,2)),SCH=$P(ND2,U),START=$P(ND2,U,2),STOP=$P(ND2,U,4),MR=$P(ND0,U,3),INFUS=$P($G(^PS(53.1,+ON,8)),U,5),STAT=$$CODES^PSIVUTL($P(ND0,U,9),53.1,28),ADM=$P(ND2,U,5),SIO=$P($G(@(F_+ON_",6)")),"^")
"RTN","PSJORRN",98,0)
 I FON'["P" S START=$P(ND0,U,2),STOP=$P(ND0,U,3),SCH=$P(ND0,U,9),INFUS=$P(ND0,U,8),MR=$P($G(^PS(55,DFN,"IV",+ON,.2)),U,3),STAT=$$CODES^PSIVUTL($P(ND0,U,17),55.01,100),ADM=$P(ND0,U,11),SIO=$P($G(@(F_+ON_",3)")),"^")
"RTN","PSJORRN",99,0)
 S:($G(SIO)["Instructions too long. See Order View or BCMA for full text") SIO="Instructions too long. See order details for full text."
"RTN","PSJORRN",100,0)
 S DN=$G(@(F_+ON_",.2)")),DO=$P(DN,U,2)
"RTN","PSJORRN",101,0)
 S DN=$S(+$P(DN,U):$$OIDF^PSJLMUT1($P(DN,U)),1:"")
"RTN","PSJORRN",102,0)
 S:MR MR=$$MR^PSJORRE1(+MR),INST=$G(@(F_+ON_",.3)"))
"RTN","PSJORRN",103,0)
 S ^TMP("PSJTMP",$J,GP,PSJST,LOC,PSJOINM,TFN2,0)=FON_";I"_U_DN_U_INFUS_U_STOP_"^^"_DO_"^^"_$P(ND0,"^",21)_U_STAT_U_U_U_U_U_($P(ND0,U,9)="P"&($P(ND0,U,24)="R"))_U_START_U_$G(RNWDT)
"RTN","PSJORRN",104,0)
 K ^TMP("PSJTMP",$J,GP,PSJST,LOC,PSJOINM,TFN2,"CLINIC",0) I PSJCLIN]"" S ^TMP("PSJTMP",$J,GP,PSJST,LOC,PSJOINM,TFN2,"CLINIC",0)=PSJCLIN
"RTN","PSJORRN",105,0)
 S PROVIDER=$P($G(@(F_+ON_",0)")),"^",6)
"RTN","PSJORRN",106,0)
 I PROVIDER S ^TMP("PSJTMP",$J,GP,PSJST,LOC,PSJOINM,TFN2,"P",0)=PROVIDER_"^"_$P($G(^VA(200,PROVIDER,0)),"^")
"RTN","PSJORRN",107,0)
 S ND2P5=$G(@(F_+ON_",2.5)")) S IVLIM=$P(ND2P5,U,4) I $E(IVLIM)="a" S IVLIM="doses"_$P(IVLIM,"a",2)
"RTN","PSJORRN",108,0)
 I IVLIM="" S IVLIM=$P(ND2P5,U,2) S:(IVLIM'["d")&(IVLIM'["h") IVLIM=""
"RTN","PSJORRN",109,0)
 S ^TMP("PSJTMP",$J,GP,PSJST,LOC,PSJOINM,TFN2,"MDR",0)=MR]"" S:MR]"" ^TMP("PSJTMP",$J,GP,PSJST,LOC,PSJOINM,TFN2,"MDR",1,0)=MR
"RTN","PSJORRN",110,0)
 S ^TMP("PSJTMP",$J,GP,PSJST,LOC,PSJOINM,TFN2,"SIG",0)=INST]"" S:INST]"" ^TMP("PSJTMP",$J,GP,PSJST,LOC,PSJOINM,TFN2,"SIG",1,0)=INST
"RTN","PSJORRN",111,0)
 S ^TMP("PSJTMP",$J,GP,PSJST,LOC,PSJOINM,TFN2,"SCH",0)=SCH]"" S:SCH]"" ^TMP("PSJTMP",$J,GP,PSJST,LOC,PSJOINM,TFN2,"SCH",1,0)=SCH
"RTN","PSJORRN",112,0)
 S ^TMP("PSJTMP",$J,GP,PSJST,LOC,PSJOINM,TFN2,"ADM",0)=ADM]"" S:ADM]"" ^TMP("PSJTMP",$J,GP,PSJST,LOC,PSJOINM,TFN2,"ADM",1,0)=ADM
"RTN","PSJORRN",113,0)
 S ^TMP("PSJTMP",$J,GP,PSJST,LOC,PSJOINM,TFN2,"SIO",0)=SIO]"" S:SIO]"" ^TMP("PSJTMP",$J,GP,PSJST,LOC,PSJOINM,TFN2,"SIO",1,0)=SIO
"RTN","PSJORRN",114,0)
 I $G(IVLIM)]"" S ^TMP("PSJTMP",$J,GP,PSJST,LOC,PSJOINM,TFN2,"IVLIM",0)=IVLIM
"RTN","PSJORRN",115,0)
 Q
"RTN","PSJORRN",116,0)
STAT(Y,X) ;* Return the full status instead of just the code for U/D.
"RTN","PSJORRN",117,0)
 S X=$P($P(";"_$P(Y,U,3),";"_X_":",2),";")
"RTN","PSJORRN",118,0)
 Q X
"RTN","PSJORRN",119,0)
TYPE ;determine if this is an IMO order or not
"RTN","PSJORRN",120,0)
 S (A,PSJCLIN)="" I F["PS(53.1" S A=$G(^PS(53.1,ON,"DSS"))
"RTN","PSJORRN",121,0)
 I F["PS(55" S A=$S(F["IV":$G(^PS(55,DFN,"IV",ON,"DSS")),1:$G(^PS(55,DFN,5,ON,8)))
"RTN","PSJORRN",122,0)
 I $P(A,"^",2)'="" S PSJCLIN=+A
"RTN","PSJORRN",123,0)
 Q
"RTN","PSJORRN1")
0^2^B63215435^B61358484
"RTN","PSJORRN1",1,0)
PSJORRN1 ;BIR/JCH-RETURN INPATIENT MEDS (CONDENSED) SECOND 'NEW' SORT ; 3/21/11 2:54pm
"RTN","PSJORRN1",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**134,213,225,275,255**;16 DEC 97;Build 8
"RTN","PSJORRN1",3,0)
 ;
"RTN","PSJORRN1",4,0)
 ;Reference to ^PS(52.6 is supported by DBIA 1231.
"RTN","PSJORRN1",5,0)
 ;Reference to ^PS(52.7 is supported by DBIA 2173.
"RTN","PSJORRN1",6,0)
 ;Reference to ^PS(55 is supported by DBIA 2191.
"RTN","PSJORRN1",7,0)
 ;Reference to ^TMP("PS" is documented in DBIA #2383.
"RTN","PSJORRN1",8,0)
 ;Reference to ^SC is documented in DBIA #10040.
"RTN","PSJORRN1",9,0)
 ;Reference to ^PS(50.7 is supported by DBIA #2180.
"RTN","PSJORRN1",10,0)
 ;
"RTN","PSJORRN1",11,0)
 ; return condensed list of inpat meds with Alpha Primary Sort
"RTN","PSJORRN1",12,0)
OCL(DFN,BDT,EDT,TFN) ; Execute this section if MVIEW=1
"RTN","PSJORRN1",13,0)
 N ADM,CNT,DN,DO,F,FON,INFUS,INST,MR,ND,ND0,ND2,ND6,ON,PON,PST,SCH,SIO,STAT,TYPE,UNITS,WBDT,X,Y,PSJCLIN,A,TFN2,PSJOTYP,PSJNOW,PSJ30DAY,%
"RTN","PSJORRN1",14,0)
 S TFN2=TFN,PSJNOW=$$DATE^PSJUTL2(),PSJ30DAY=$$FMADD^XLFDT(PSJNOW,-30) S $P(PSJ30DAY,".",2)="000001"
"RTN","PSJORRN1",15,0)
 ; PON=placer order number (oerr), FON=filler order number
"RTN","PSJORRN1",16,0)
 ; *225 Add time or base on now
"RTN","PSJORRN1",17,0)
 D NOW^%DTC S:BDT="" BDT=% S:BDT'["." BDT=BDT_".000001" S WBDT=BDT S:WBDT<PSJ30DAY WBDT=PSJ30DAY
"RTN","PSJORRN1",18,0)
 S:EDT="" EDT=9999999
"RTN","PSJORRN1",19,0)
 S:EDT'["." EDT=EDT_".999999"
"RTN","PSJORRN1",20,0)
 ;*225 Correct Display Calcualtion
"RTN","PSJORRN1",21,0)
 S F="^PS(55,DFN,5," F  S WBDT=$O(^PS(55,DFN,5,"AUS",WBDT)) Q:'WBDT  F ON=0:0 S ON=$O(^PS(55,DFN,5,"AUS",WBDT,ON)) Q:'ON  S PSJOTYP="D" D UDTMP
"RTN","PSJORRN1",22,0)
 S F="^PS(53.1," F PST="P","N" F ON=0:0 S ON=$O(^PS(53.1,"AS",PST,DFN,ON)) Q:'ON  S X=$P($G(^PS(53.1,+ON,0)),U,4) S PSJOTYP=$S(PST="P":"P1",1:"P2") D @$S(X="U":"UDTMP",1:"IVTMP")
"RTN","PSJORRN1",23,0)
 S F="^PS(55,"_DFN_",""IV"",",WBDT=BDT F  S WBDT=$O(^PS(55,DFN,"IV","AIS",WBDT)) Q:'WBDT  F ON=0:0 S ON=$O(^PS(55,DFN,"IV","AIS",WBDT,ON)) Q:'ON  S PSJOTYP="V" D IVTMP
"RTN","PSJORRN1",24,0)
 S X1="" F  S X1=$O(^TMP("PSJTMP",$J,X1)) Q:X1=""  S X2="" F  S X2=$O(^TMP("PSJTMP",$J,X1,X2)) Q:X2=""  S X3="" F  S X3=$O(^TMP("PSJTMP",$J,X1,X2,X3)) Q:X3=""  D
"RTN","PSJORRN1",25,0)
 .S X4="" F  S X4=$O(^TMP("PSJTMP",$J,X1,X2,X3,X4)) Q:X4=""  D
"RTN","PSJORRN1",26,0)
 ..; The merge below sends the proper ^TMP("PS",$J structure back to the calling routine PSJORRE
"RTN","PSJORRN1",27,0)
 ..S TFN=$G(TFN)+1 M ^TMP("PS",$J,TFN)=^TMP("PSJTMP",$J,X1,X2,X3,X4) S ^TMP("PS",$J,"PC",0)=TFN
"RTN","PSJORRN1",28,0)
 K ^TMP("PSJTMP",$J)
"RTN","PSJORRN1",29,0)
 Q
"RTN","PSJORRN1",30,0)
 ;
"RTN","PSJORRN1",31,0)
UDTMP ;*** Set ^TMP for Unit dose orders.
"RTN","PSJORRN1",32,0)
 N PROVIDER,RNWDT,EDTCMPLX,NDP2,PSJSTP,PSJLOC,PSJST2,NDDSS,NDORIG
"RTN","PSJORRN1",33,0)
 S (MR,SCH,INST,PON,NDDSS)="",FON=+ON_$S(F["53.1":"P",1:"U")
"RTN","PSJORRN1",34,0)
 I $E($G(PSJOTYP))="P",'$G(WBDT) S WBDT=+ON
"RTN","PSJORRN1",35,0)
 D TYPE S PSJLOC=$S($G(PSJCLIN):$P($G(^SC(+PSJCLIN,0)),"^"),1:"zzz")
"RTN","PSJORRN1",36,0)
 S RNWDT=$$LASTREN^PSJLMPRI(DFN,FON) I RNWDT S RNWDT=+RNWDT
"RTN","PSJORRN1",37,0)
 S NDP2=$G(@(F_ON_",.2)")) S EDTCMPLX=$P(NDP2,"^",8)
"RTN","PSJORRN1",38,0)
 S ND2=$G(@(F_ON_",2)")) I 'EDTCMPLX I F'["53.1",($P(ND2,U,2)>EDT) Q
"RTN","PSJORRN1",39,0)
 S ND0=$G(@(F_ON_",0)")) I 'EDTCMPLX I F["53.1",($P(ND0,U,16)>EDT) Q
"RTN","PSJORRN1",40,0)
 S STAT=$$CODES^PSIVUTL($P(ND0,U,9),$S(FON["P":53.1,1:55.06),28)
"RTN","PSJORRN1",41,0)
 S ND6=$P($G(@(F_ON_",6)")),"^"),INST=$G(@(F_+ON_",.3)"))
"RTN","PSJORRN1",42,0)
 S:ND6["Instructions too long. See Order View or BCMA for full text" ND6="Instructions too long. See order details for full text."
"RTN","PSJORRN1",43,0)
 S ND8=$P($G(@(F_ON_",8)")),"^")
"RTN","PSJORRN1",44,0)
 S FON=+ON_$S(F["53.1":"P",1:"U"),DO=$P($G(@(F_ON_",.2)")),"^",2)
"RTN","PSJORRN1",45,0)
 D DRGDISP^PSJLMUT1(DFN,FON,40,0,.DN,1)
"RTN","PSJORRN1",46,0)
 ;*225 Don't allow 0 Units
"RTN","PSJORRN1",47,0)
 S UNITS="" I '$O(@(F_+ON_",1,1)")) S UNITS=$P($G(@(F_+ON_",1,1,0)")),U,2) S:(FON["U")&(+UNITS=0) UNITS=1
"RTN","PSJORRN1",48,0)
 S:+$P(ND0,U,3) MR=$$MR^PSJORRE1(+$P(ND0,U,3))
"RTN","PSJORRN1",49,0)
 N NOTGIVEN S NOTGIVEN=$S(FON["U":$P($G(^PS(55,DFN,5,+ON,0)),"^",22),1:"")
"RTN","PSJORRN1",50,0)
 ;******** GUI 27 New sort format #2 for Meds Tab
"RTN","PSJORRN1",51,0)
 I F[53.1 S NDDSS=$G(@(F_ON_",""DSS"")")),LOC=$P(NDDSS,"^")
"RTN","PSJORRN1",52,0)
 S:F'[53.1 LOC=$P(ND8,"^") S LOC=$S(LOC]"":LOC,1:"~") I LOC S LOC=$P($G(^SC(LOC,0)),"^")
"RTN","PSJORRN1",53,0)
 ;PSJ*5*225 include HOLD orders
"RTN","PSJORRN1",54,0)
 S PSJST=$P(ND0,"^",9) S PSJST2=$S(PSJST="A":1,PSJST="E":2,PSJST="H":3,1:"") Q:'PSJST2
"RTN","PSJORRN1",55,0)
 S PSJOI=$P(NDP2,"^"),PSJOINM=$P($G(^PS(50.7,+PSJOI,0)),"^")
"RTN","PSJORRN1",56,0)
 S PSJSTP=+$P(ND2,"^",4)
"RTN","PSJORRN1",57,0)
 ;********
"RTN","PSJORRN1",58,0)
 S TFN2=$G(TFN2)+1
"RTN","PSJORRN1",59,0)
 S DN(1)=$S($G(DN(1))="":"UNKNOWN",1:DN(1))
"RTN","PSJORRN1",60,0)
 S DNORIG=DN(1),DN(1)=$$UP^XLFSTR(DN(1)) ;PSJ*5*255 - Fix Tallman sorting for unit dose
"RTN","PSJORRN1",61,0)
 S ^TMP("PSJTMP",$J,DN(1),PSJST2,WBDT,TFN2,0)=FON_";I"_U_DNORIG_"^^"_$P(ND2,U,4)_"^^"_DO_U_UNITS_U_$P(ND0,U,21)_U_STAT_U_U_U_U_NOTGIVEN_U_($P(ND0,U,9)="P"&($P(ND0,U,24)="R"))_U_$P(ND2,U,2)_U_$G(RNWDT)
"RTN","PSJORRN1",62,0)
 K ^TMP("PSJTMP",$J,DN(1),PSJST2,WBDT,TFN2,"CLINIC",0) I PSJCLIN]"" S ^TMP("PSJTMP",$J,DN(1),PSJST2,WBDT,TFN2,"CLINIC",0)=PSJCLIN
"RTN","PSJORRN1",63,0)
 S PROVIDER=$P($G(@(F_+ON_",0)")),"^",2)
"RTN","PSJORRN1",64,0)
 I PROVIDER S ^TMP("PSJTMP",$J,DN(1),PSJST2,WBDT,TFN2,"P",0)=PROVIDER_"^"_$P($G(^VA(200,PROVIDER,0)),"^")
"RTN","PSJORRN1",65,0)
 S ^TMP("PSJTMP",$J,DN(1),PSJST2,WBDT,TFN2,"MDR",0)=MR]"" S:MR]"" ^TMP("PSJTMP",$J,DN(1),PSJST2,WBDT,TFN2,"MDR",1,0)=MR
"RTN","PSJORRN1",66,0)
 S ^TMP("PSJTMP",$J,DN(1),PSJST2,WBDT,TFN2,"SCH",0)=$P(ND2,U)]"" S:$P(ND2,U)]"" ^TMP("PSJTMP",$J,DN(1),PSJST2,WBDT,TFN2,"SCH",1,0)=$P(ND2,U)
"RTN","PSJORRN1",67,0)
 S ^TMP("PSJTMP",$J,DN(1),PSJST2,WBDT,TFN2,"SIG",0)=INST]"" S:INST]"" ^TMP("PSJTMP",$J,DN(1),PSJST2,WBDT,TFN2,"SIG",1,0)=INST
"RTN","PSJORRN1",68,0)
 S ^TMP("PSJTMP",$J,DN(1),PSJST2,WBDT,TFN2,"ADM",0)=$P(ND2,U,5)]"" S:$P(ND2,U,5)]"" ^TMP("PSJTMP",$J,DN(1),PSJST2,WBDT,TFN2,"ADM",1,0)=$P(ND2,U,5)
"RTN","PSJORRN1",69,0)
 S ^TMP("PSJTMP",$J,DN(1),PSJST2,WBDT,TFN2,"SIO",0)=ND6]"" S:ND6]"" ^TMP("PSJTMP",$J,DN(1),PSJST2,WBDT,TFN2,"SIO",1,0)=ND6
"RTN","PSJORRN1",70,0)
 Q
"RTN","PSJORRN1",71,0)
 ;
"RTN","PSJORRN1",72,0)
IVTMP ;*** Set ^TMP for IV orders.
"RTN","PSJORRN1",73,0)
 N PROVIDER,START,STOP,EDTCMPLX,NDP2,IVLIM,PSJLOC,NDDSS
"RTN","PSJORRN1",74,0)
 S (PROVIDER,START,STOP,EDTCMPLX,NDP2,IVLIM,PSJLOC,NDDSS)=""
"RTN","PSJORRN1",75,0)
 I $E($G(PSJOTYP))="P",'$G(WBDT) S WBDT=+ON
"RTN","PSJORRN1",76,0)
 S NDP2=$G(@(F_ON_",.2)")) S EDTCMPLX=$P(NDP2,"^",8)
"RTN","PSJORRN1",77,0)
 S ND0=$G(@(F_ON_",0)")) I 'EDTCMPLX I F'["53.1",($P(ND0,U,2)>EDT) Q
"RTN","PSJORRN1",78,0)
 D TYPE S PSJLOC=$S($G(PSJCLIN):$P($G(^SC(+PSJCLIN,0)),"^"),1:"zzz")
"RTN","PSJORRN1",79,0)
 S FON=+ON_$S(F["53.1":"P",1:"V"),CNT=0
"RTN","PSJORRN1",80,0)
 S RNWDT=$$LASTREN^PSJLMPRI(DFN,FON) I RNWDT S RNWDT=+RNWDT
"RTN","PSJORRN1",81,0)
 ;******** GUI 27 old sort, new format for Meds Tab
"RTN","PSJORRN1",82,0)
 S NDDSS=$G(@(F_ON_",""DSS"")")),NDP2=$G(@(F_ON_",.2)"))
"RTN","PSJORRN1",83,0)
 S PSJOI=$P(NDP2,"^"),PSJST=""
"RTN","PSJORRN1",84,0)
 I F[53.1 S PSJST=$P(ND0,"^",9)
"RTN","PSJORRN1",85,0)
 I F'[53.1 S PSJST=$P(ND0,"^",17)
"RTN","PSJORRN1",86,0)
 ;PSJ*5*225 include HOLD orders
"RTN","PSJORRN1",87,0)
 S PSJST2=$S(PSJST="A":1,PSJST="E":2,PSJST="H":3,1:"") Q:'PSJST2
"RTN","PSJORRN1",88,0)
 S LOC=$P(NDDSS,"^") S LOC=$S(LOC]"":LOC,1:"~")  I LOC S LOC=$P($G(^SC(LOC,0)),"^")
"RTN","PSJORRN1",89,0)
 I PSJOI'="" S PSJOINM=$P($G(^PS(50.7,+PSJOI,0)),"^")
"RTN","PSJORRN1",90,0)
 I PSJOI="" S PSJOINM="Orderable Item Not Found"
"RTN","PSJORRN1",91,0)
 S PSJSTP=$P(ND0,"^",3)
"RTN","PSJORRN1",92,0)
 ;********
"RTN","PSJORRN1",93,0)
 S TFN2=$G(TFN2)+1
"RTN","PSJORRN1",94,0)
 S DN(1)=$S($G(DN(1))="":"UNKNOWN",1:DN(1)),CNT=0
"RTN","PSJORRN1",95,0)
 S DN(1)=PSJOINM ;PSJ*5*255 - Sort IV orders with no additive
"RTN","PSJORRN1",96,0)
 F X=0:0 S X=$O(@(F_ON_",""AD"","_X_")")) Q:'X  S ND=$G(@(F_ON_",""AD"","_X_",0)")),DN=$P($G(^PS(52.6,+ND,0)),U),Y=DN_U_$P(ND,U,2) S:$P(ND,U,3) Y=Y_U_$P(ND,U,3) S CNT=CNT+1,DN(CNT)=Y S ^TMP("PSJTMP",$J,DN(1),PSJST2,WBDT,TFN2,"A",CNT,0)=Y
"RTN","PSJORRN1",97,0)
 S ^TMP("PSJTMP",$J,DN(1),PSJST2,WBDT,TFN2,"A",0)=CNT,CNT=0
"RTN","PSJORRN1",98,0)
 F X=0:0 S X=$O(@(F_ON_",""SOL"","_X_")")) Q:'X  S ND=$G(@(F_ON_",""SOL"","_X_",0)")),DN=$G(^PS(52.7,+ND,0)),CNT=CNT+1,^TMP("PSJTMP",$J,DN(1),PSJST2,WBDT,TFN2,"B",CNT,0)=$P(DN,U)_U_$P(ND,U,2)_U_$P(DN,U,4)
"RTN","PSJORRN1",99,0)
 S ^TMP("PSJTMP",$J,DN(1),PSJST2,WBDT,TFN2,"B",0)=CNT
"RTN","PSJORRN1",100,0)
 S TYPE=$P(ND0,U,4),(MR,SCH,INST,INFUS)=""
"RTN","PSJORRN1",101,0)
 I FON["P" S ND2=$G(^PS(53.1,+ON,2)),SCH=$P(ND2,U),START=$P(ND2,U,2),STOP=$P(ND2,U,4),MR=$P(ND0,U,3),INFUS=$P($G(^PS(53.1,+ON,8)),U,5),STAT=$$CODES^PSIVUTL($P(ND0,U,9),53.1,28),ADM=$P(ND2,U,5),SIO=$P($G(@(F_+ON_",6)")),"^")
"RTN","PSJORRN1",102,0)
 I FON'["P" S START=$P(ND0,U,2),STOP=$P(ND0,U,3),SCH=$P(ND0,U,9),INFUS=$P(ND0,U,8),MR=$P($G(^PS(55,DFN,"IV",+ON,.2)),U,3),STAT=$$CODES^PSIVUTL($P(ND0,U,17),55.01,100),ADM=$P(ND0,U,11),SIO=$P($G(@(F_+ON_",3)")),"^")
"RTN","PSJORRN1",103,0)
 S:($G(SIO)["Instructions too long. See Order View or BCMA for full text") SIO="Instructions too long. See order details for full text."
"RTN","PSJORRN1",104,0)
 S DN=$G(@(F_+ON_",.2)")),DO=$P(DN,U,2)
"RTN","PSJORRN1",105,0)
 S DN=$S(+$P(DN,U):$$OIDF^PSJLMUT1($P(DN,U)),1:"")
"RTN","PSJORRN1",106,0)
 S:MR MR=$$MR^PSJORRE1(+MR),INST=$G(@(F_+ON_",.3)"))
"RTN","PSJORRN1",107,0)
 S ^TMP("PSJTMP",$J,DN(1),PSJST2,WBDT,TFN2,0)=FON_";I"_U_DN_U_INFUS_U_STOP_"^^"_DO_"^^"_$P(ND0,"^",21)_U_STAT_U_U_U_U_U_($P(ND0,U,9)="P"&($P(ND0,U,24)="R"))_U_START_U_$G(RNWDT)
"RTN","PSJORRN1",108,0)
 K ^TMP("PSJTMP",$J,DN(1),PSJST2,WBDT,TFN2,"CLINIC",0) I PSJCLIN]"" S ^TMP("PSJTMP",$J,DN(1),PSJST2,WBDT,TFN2,"CLINIC",0)=PSJCLIN
"RTN","PSJORRN1",109,0)
 S PROVIDER=$P($G(@(F_+ON_",0)")),"^",6)
"RTN","PSJORRN1",110,0)
 I PROVIDER S ^TMP("PSJTMP",$J,DN(1),PSJST2,WBDT,TFN2,"P",0)=PROVIDER_"^"_$P($G(^VA(200,PROVIDER,0)),"^")
"RTN","PSJORRN1",111,0)
 S ND2P5=$G(@(F_+ON_",2.5)")) S IVLIM=$P(ND2P5,U,4) I $E(IVLIM)="a" S IVLIM="doses"_$P(IVLIM,"a",2)
"RTN","PSJORRN1",112,0)
 I IVLIM="" S IVLIM=$P(ND2P5,U,2) S:(IVLIM'["d")&(IVLIM'["h") IVLIM=""
"RTN","PSJORRN1",113,0)
 S ^TMP("PSJTMP",$J,DN(1),PSJST2,WBDT,TFN2,"MDR",0)=MR]"" S:MR]"" ^TMP("PSJTMP",$J,DN(1),PSJST2,WBDT,TFN2,"MDR",1,0)=MR
"RTN","PSJORRN1",114,0)
 S ^TMP("PSJTMP",$J,DN(1),PSJST2,WBDT,TFN2,"SIG",0)=INST]"" S:INST]"" ^TMP("PSJTMP",$J,DN(1),PSJST2,WBDT,TFN2,"SIG",1,0)=INST
"RTN","PSJORRN1",115,0)
 S ^TMP("PSJTMP",$J,DN(1),PSJST2,WBDT,TFN2,"SCH",0)=SCH]"" S:SCH]"" ^TMP("PSJTMP",$J,DN(1),PSJST2,WBDT,TFN2,"SCH",1,0)=SCH
"RTN","PSJORRN1",116,0)
 S ^TMP("PSJTMP",$J,DN(1),PSJST2,WBDT,TFN2,"ADM",0)=ADM]"" S:ADM]"" ^TMP("PSJTMP",$J,DN(1),PSJST2,WBDT,TFN2,"ADM",1,0)=ADM
"RTN","PSJORRN1",117,0)
 S ^TMP("PSJTMP",$J,DN(1),PSJST2,WBDT,TFN2,"SIO",0)=SIO]"" S:SIO]"" ^TMP("PSJTMP",$J,DN(1),PSJST2,WBDT,TFN2,"SIO",1,0)=SIO
"RTN","PSJORRN1",118,0)
 I $G(IVLIM)]"" S ^TMP("PSJTMP",$J,DN(1),PSJST2,WBDT,TFN2,"IVLIM",0)=IVLIM
"RTN","PSJORRN1",119,0)
 Q
"RTN","PSJORRN1",120,0)
STAT(Y,X) ;* Return the full status instead of just the code for U/D.
"RTN","PSJORRN1",121,0)
 S X=$P($P(";"_$P(Y,U,3),";"_X_":",2),";")
"RTN","PSJORRN1",122,0)
 Q X
"RTN","PSJORRN1",123,0)
TYPE ;determine if this is an IMO order or not
"RTN","PSJORRN1",124,0)
 S (A,PSJCLIN)="" I F["PS(53.1" S A=$G(^PS(53.1,ON,"DSS"))
"RTN","PSJORRN1",125,0)
 I F["PS(55" S A=$S(F["IV":$G(^PS(55,DFN,"IV",ON,"DSS")),1:$G(^PS(55,DFN,5,ON,8)))
"RTN","PSJORRN1",126,0)
 I $P(A,"^",2)'="" S PSJCLIN=+A
"RTN","PSJORRN1",127,0)
 Q
"VER")
8.0^22.0
"BLD",9216,6)
^269
**END**
**END**

