Released PSJ*5*367 SEQ #318
Extracted from mail message
**KIDS**:PSJ*5.0*367^

**INSTALL NAME**
PSJ*5.0*367
"BLD",11044,0)
PSJ*5.0*367^INPATIENT MEDICATIONS^0^3180801^y
"BLD",11044,1,0)
^^9^9^3180716^^
"BLD",11044,1,1,0)
This patch will address three (3) INPATIENT MEDICATIONS issues:
"BLD",11044,1,2,0)
 
"BLD",11044,1,3,0)
1)Users are encountering an UNDEFINED error when an active order is 
"BLD",11044,1,4,0)
copied and one of the order's fields is modified and the new order 
"BLD",11044,1,5,0)
is made active.
"BLD",11044,1,6,0)
2)Complex orders are still locked after verification of all the child 
"BLD",11044,1,7,0)
orders.
"BLD",11044,1,8,0)
3)Complex orders are still locked when user is at SELECT ACTION QUIT 
"BLD",11044,1,9,0)
prompt.
"BLD",11044,4,0)
^9.64PA^^
"BLD",11044,6.3)
7
"BLD",11044,"ABPKG")
n
"BLD",11044,"KRN",0)
^9.67PA^779.2^20
"BLD",11044,"KRN",.4,0)
.4
"BLD",11044,"KRN",.401,0)
.401
"BLD",11044,"KRN",.402,0)
.402
"BLD",11044,"KRN",.403,0)
.403
"BLD",11044,"KRN",.5,0)
.5
"BLD",11044,"KRN",.84,0)
.84
"BLD",11044,"KRN",3.6,0)
3.6
"BLD",11044,"KRN",3.8,0)
3.8
"BLD",11044,"KRN",9.2,0)
9.2
"BLD",11044,"KRN",9.8,0)
9.8
"BLD",11044,"KRN",9.8,"NM",0)
^9.68A^3^3
"BLD",11044,"KRN",9.8,"NM",1,0)
PSGOD^^0^B30464827
"BLD",11044,"KRN",9.8,"NM",2,0)
PSJOEA^^0^B33792351
"BLD",11044,"KRN",9.8,"NM",3,0)
PSJOEA2^^0^B34608662
"BLD",11044,"KRN",9.8,"NM","B","PSGOD",1)

"BLD",11044,"KRN",9.8,"NM","B","PSJOEA",2)

"BLD",11044,"KRN",9.8,"NM","B","PSJOEA2",3)

"BLD",11044,"KRN",19,0)
19
"BLD",11044,"KRN",19.1,0)
19.1
"BLD",11044,"KRN",101,0)
101
"BLD",11044,"KRN",409.61,0)
409.61
"BLD",11044,"KRN",771,0)
771
"BLD",11044,"KRN",779.2,0)
779.2
"BLD",11044,"KRN",870,0)
870
"BLD",11044,"KRN",8989.51,0)
8989.51
"BLD",11044,"KRN",8989.52,0)
8989.52
"BLD",11044,"KRN",8994,0)
8994
"BLD",11044,"KRN","B",.4,.4)

"BLD",11044,"KRN","B",.401,.401)

"BLD",11044,"KRN","B",.402,.402)

"BLD",11044,"KRN","B",.403,.403)

"BLD",11044,"KRN","B",.5,.5)

"BLD",11044,"KRN","B",.84,.84)

"BLD",11044,"KRN","B",3.6,3.6)

"BLD",11044,"KRN","B",3.8,3.8)

"BLD",11044,"KRN","B",9.2,9.2)

"BLD",11044,"KRN","B",9.8,9.8)

"BLD",11044,"KRN","B",19,19)

"BLD",11044,"KRN","B",19.1,19.1)

"BLD",11044,"KRN","B",101,101)

"BLD",11044,"KRN","B",409.61,409.61)

"BLD",11044,"KRN","B",771,771)

"BLD",11044,"KRN","B",779.2,779.2)

"BLD",11044,"KRN","B",870,870)

"BLD",11044,"KRN","B",8989.51,8989.51)

"BLD",11044,"KRN","B",8989.52,8989.52)

"BLD",11044,"KRN","B",8994,8994)

"BLD",11044,"QUES",0)
^9.62^^
"BLD",11044,"REQB",0)
^9.611^1^1
"BLD",11044,"REQB",1,0)
PSJ*5.0*347^2
"BLD",11044,"REQB","B","PSJ*5.0*347",1)

"MBREQ")
0
"PKG",471,-1)
1^1
"PKG",471,0)
INPATIENT MEDICATIONS^PSJ^UNIT DOSE AND IVS
"PKG",471,20,0)
^9.402P^^
"PKG",471,22,0)
^9.49I^1^1
"PKG",471,22,1,0)
5.0^2971215^2990325^66481
"PKG",471,22,1,"PAH",1,0)
367^3180801
"PKG",471,22,1,"PAH",1,1,0)
^^9^9^3180801
"PKG",471,22,1,"PAH",1,1,1,0)
This patch will address three (3) INPATIENT MEDICATIONS issues:
"PKG",471,22,1,"PAH",1,1,2,0)
 
"PKG",471,22,1,"PAH",1,1,3,0)
1)Users are encountering an UNDEFINED error when an active order is 
"PKG",471,22,1,"PAH",1,1,4,0)
copied and one of the order's fields is modified and the new order 
"PKG",471,22,1,"PAH",1,1,5,0)
is made active.
"PKG",471,22,1,"PAH",1,1,6,0)
2)Complex orders are still locked after verification of all the child 
"PKG",471,22,1,"PAH",1,1,7,0)
orders.
"PKG",471,22,1,"PAH",1,1,8,0)
3)Complex orders are still locked when user is at SELECT ACTION QUIT 
"PKG",471,22,1,"PAH",1,1,9,0)
prompt.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
3
"RTN","PSGOD")
0^1^B30464827^B30203742
"RTN","PSGOD",1,0)
PSGOD ;BIR/CML3 - CREATES NEW ORDER FROM OLD ONE ;22 SEP 97 / 2:56 PM 
"RTN","PSGOD",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**67,58,111,133,181,286,281,315,338,256,347,367**;16 DEC 97;Build 7
"RTN","PSGOD",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PSGOD",4,0)
 ; Reference to ^PS(55 is supported by DBIA 2191.
"RTN","PSGOD",5,0)
 ;
"RTN","PSGOD",6,0)
 ;*286 - Do not allow copied Unit Dose orders for outpatients
"RTN","PSGOD",7,0)
 D INP^VADPT I 'VAIN(4) W !,"You cannot copy Unit Dose orders for this patient!" H 2 Q
"RTN","PSGOD",8,0)
 I $P($G(^PS(55,PSGP,5,+PSJORD,0)),"^",22) D  Q
"RTN","PSGOD",9,0)
 .W !,"This order is marked 'Not To Be Given' and can't be copied!" H 2
"RTN","PSGOD",10,0)
 F  W !!,"Do you want to copy this order" S %=2 D YN^DICN Q:%  D CH
"RTN","PSGOD",11,0)
 G:%'=1 DONE
"RTN","PSGOD",12,0)
 ;
"RTN","PSGOD",13,0)
 W !!,"...copying..." N OLDON
"RTN","PSGOD",14,0)
 K PSGORQF
"RTN","PSGOD",15,0)
 N PSGPDRG,Q
"RTN","PSGOD",16,0)
 NEW PSJOLDNM
"RTN","PSGOD",17,0)
 S PSGOEPR=$P($G(^PS(55,PSGP,5.1)),"^",2),OLDON=PSGORD,Q=""
"RTN","PSGOD",18,0)
 K PSGODN S F=$S(PSGORD["P":"^PS(53.1,"_+PSGORD_",",1:"^PS(55,"_PSGP_",5,"_+PSGORD_",") F N=0,.2,2,2.1,6 S PSGODN(N)=$G(@(F_N_")"))
"RTN","PSGOD",19,0)
 S PSGPR=$P(PSGODN(0),"^",2),PSGMR=$P(PSGODN(0),"^",3),PSGSM=$P(PSGODN(0),"^",5),PSGHSM=$P(PSGODN(0),"^",6),PSGST=$P(PSGODN(0),"^",7)
"RTN","PSGOD",20,0)
 S PSGPDRG=+PSGODN(.2),PSGDO=$P(PSGODN(.2),"^",2)
"RTN","PSGOD",21,0)
 ;*315
"RTN","PSGOD",22,0)
 S:$G(PSGODN(2.1))]"" PSGDUR=+PSGODN(2.1),PSGRMVT=$P(PSGODN(2.1),U,2),PSGRMV=$P(PSGODN(2.1),U,3),PSGRF=$P(PSGODN(2.1),U,4)
"RTN","PSGOD",23,0)
 S PSGSI=PSGODN(6)
"RTN","PSGOD",24,0)
 ; The naked reference below refers to the full reference inside indirection to ^PS(55,PSGP,5,+PSGORD, or ^PS(55,PSGP,"IV",+PSGORD, or ^PS(53.1,+PSGORD
"RTN","PSGOD",25,0)
 S PSGODN(3)=0 F Q=0:0 S Q=$O(@(F_"3,"_Q_")")) Q:'Q  I $D(^(Q,0)) S PSGODN(3,Q)=^(0),PSGODN(3)=PSGODN(3)+1 S ^PS(53.45,PSJSYSP,1,Q,0)=^(0)
"RTN","PSGOD",26,0)
 ;S:PSGODN(12)>0 ^PS(53.45,PSJSYSP,4,0)="^53.4504" S:PSGODN(3)>0 ^PS(53.45,PSJSYSP,1,0)="^53.4501"
"RTN","PSGOD",27,0)
 S:PSGODN(3)>0 ^PS(53.45,PSJSYSP,1,0)="^53.4501"
"RTN","PSGOD",28,0)
 ; The naked reference below refers to the full reference inside indirection to ^PS(55,PSGP,5,+PSGORD, or ^PS(55,PSGP,"IV",+PSGORD, or ^PS(53.1,+PSGORD  
"RTN","PSGOD",29,0)
 ;338
"RTN","PSGOD",30,0)
 N PSGK5345 S PSGK5345=0
"RTN","PSGOD",31,0)
 S (PSGODN(1),Q)=0 F  S Q=$O(@(F_"1,"_Q_")")) Q:'Q  S ND=$G(^(Q,0)) I ND D
"RTN","PSGOD",32,0)
 .I '$P(ND,"^",3),'PSGK5345 S PSGODN(1)=PSGODN(1)+1,PSGODN(1,PSGODN(1))=$P(ND,"^",1,2) S ^PS(53.45,PSJSYSP,2,PSGODN(1),0)=^(0)
"RTN","PSGOD",33,0)
 .I '$P(ND,"^",3),PSGK5345 S PSGODN(1,PSGODN(1))=$P(ND,"^",1,2) S ^PS(53.45,PSJSYSP,2,PSGODN(1),0)=^(0) S PSGODN(1)=PSGODN(1)+1,PSGK5345=0 K ^PS(53.45,PSJSYSP,2,PSGODN(1),0)
"RTN","PSGOD",34,0)
 .I $P(ND,"^",3) S PSGODN(1)=PSGODN(1)+1 K ^PS(53.45,PSJSYSP,2,PSGODN(1),0) S PSGK5345=1
"RTN","PSGOD",35,0)
 K PSGK5345
"RTN","PSGOD",36,0)
 S PSGS0Y=$P(PSGODN(2),"^",5),PSGS0XT=$P(PSGODN(2),"^",6),PSGNESD="",PSGSCH=$P(PSGODN(2),U)
"RTN","PSGOD",37,0)
 ;PSJ*5*256
"RTN","PSGOD",38,0)
 S PSJOLDNM("ORD_SCHD")=PSGSCH
"RTN","PSGOD",39,0)
 I $$CHKSCHD^PSJMISC2(.PSJOLDNM) W !!,"Order not copied." D PAUSE^VALM1 K PSJOLDNM G ORIG
"RTN","PSGOD",40,0)
 S:$G(PSJOLDNM("NEW_SCHD"))]"" PSGSCH=PSJOLDNM("NEW_SCHD") K PSJOLDNM
"RTN","PSGOD",41,0)
 S PSGODF=1,PSGNEDFD=$P($$GTNEDFD^PSGOE7("U",+PSGPDRG),U)_"^^"_PSGST_"^"_PSGSCH
"RTN","PSGOD",42,0)
 W "." D ^PSGNE3
"RTN","PSGOD",43,0)
 K PSGEFN,PSGOEEF,PSGOEE,PSGOEOS S PSGEFN="1:13" F X=1:1:13 S PSGEFN(X)=""
"RTN","PSGOD",44,0)
 S PSGPDN=$$OINAME^PSJLMUTL(PSGPDRG),PSGOINST="",PSGSDN=$$ENDD^PSGMI(PSGNESD)_U_$$ENDTC^PSGMI(PSGNESD),PSGFDN=$$ENDD^PSGMI(PSGNEFD)_U_$$ENDTC^PSGMI(PSGNEFD)
"RTN","PSGOD",45,0)
 S PSGAT=PSGS0Y,PSGEBN=DUZ,PSGLIN=$$ENDD^PSGMI(PSGDT)_U_$$ENDTC^PSGMI(PSGDT),PSGEBN=$$ENNPN^PSGMI(DUZ),PSGSTAT=$S(PSGOEAV:"ACTIVE",1:"NON-VERIFIED")
"RTN","PSGOD",46,0)
 W "." D CHK^PSGOEV("^^"_PSGMR_"^^^^"_PSGST,PSGPDRG_U_PSGDO,PSGSCH_U_PSGNESD_"^^"_PSGNEFD)
"RTN","PSGOD",47,0)
 I $G(PSGSCH)]"" D
"RTN","PSGOD",48,0)
 .N X S X=PSGSCH N SWD,SDW,XABB,QX D ENOS^PSGS0 I $G(X)=""!$G(PSJNSS) S CHK=1 K PSJNSS Q
"RTN","PSGOD",49,0)
 .I $G(PSGAT)="",$G(PSGS0Y) S PSGAT=PSGS0Y
"RTN","PSGOD",50,0)
 .I $G(PSGAT),($G(PSGS0Y)="") S PSGS0Y=PSGAT
"RTN","PSGOD",51,0)
 .I $G(PSGS0XT)="D",$G(PSGS0Y)="" S CHK=1 D  K PSJNSS
"RTN","PSGOD",52,0)
 ..W ! K DIR S DIR(0)="FOA",DIR("A")="   WARNING - Admin times are required for DAY OF WEEK schedules    " D ^DIR K DIR
"RTN","PSGOD",53,0)
 S PSGSD=PSGNESD,PSGFD=PSGNEFD
"RTN","PSGOD",54,0)
 K PSJACEPT S VALMBCK="Q" D:$D(Y) EN^VALM("PSJU LM ACCEPT")
"RTN","PSGOD",55,0)
 I $G(PSJACEPT)=1 D OC S:$D(PSGORQF) PSJACEPT=0 S:$G(PSJACEPT)=1 VALMBCK="",PSJNOO=$$ENNOO^PSJUTL5("N")
"RTN","PSGOD",56,0)
 I '$G(PSJACEPT)!($G(PSJNOO)<0) W:'$G(PSJCOFLG) !!,"Order not copied." D PAUSE^VALM1:'$G(PSJCOFLG) G ORIG    ;PSJCOFLG set in PSODGAL1 for allergies
"RTN","PSGOD",57,0)
 S PSGNESD=PSGSD,PSGNEFD=PSGFD
"RTN","PSGOD",58,0)
 K PSGOEE D ^PSGOETO S PSJORD=PSGORD I PSGOEAV D
"RTN","PSGOD",59,0)
 .I '$D(PSGOEE),+PSJSYSU=3 D EN^PSGPEN(PSGORD)
"RTN","PSGOD",60,0)
 .D SETOC^PSJNEWOC(PSGORD) ;RTC 178789 Store allergy if auto vf is on
"RTN","PSGOD",61,0)
 D GETUD^PSJLMGUD(PSGP,PSGORD) N PSGOEEF S PSGOEEF=0 D ENSFE^PSGOEE0(PSGP,PSGORD),^PSGOE1,EN^VALM("PSJ LM UD ACTION")
"RTN","PSGOD",62,0)
 ;RTC 178789 - store allery if not verified the newly copied order
"RTN","PSGOD",63,0)
 I ($G(PSGORD)["P"),($P($G(^PS(53.1,+PSGORD,0)),U,9)="N"),($G(PSJOCFG)="COPY UD") D SETOC^PSJNEWOC(PSGORD)
"RTN","PSGOD",64,0)
 ;
"RTN","PSGOD",65,0)
 S PSGCANFL=0,(PSGORD,PSJORD)=OLDON W !!,"You are finished with the new order.",!,"The following ACTION prompt is for the original order."
"RTN","PSGOD",66,0)
 K DIR S DIR(0)="E" D ^DIR K DIR
"RTN","PSGOD",67,0)
ORIG ;Redisplay original order
"RTN","PSGOD",68,0)
 D GETUD^PSJLMGUD(PSGP,OLDON),INIT^PSJLMUDE(PSGP,OLDON)
"RTN","PSGOD",69,0)
DONE ;
"RTN","PSGOD",70,0)
 K %,%H,%I,DA,F,N,PSGODN,PSGODF,PSGS0XT,PSGS0Y,PSGNESD,PSGTOL,PSGTOO,PSGUOW,X,Y,^PS(53.45,PSJSYSP,1),^PS(53.45,PSJSYSP,2)
"RTN","PSGOD",71,0)
 K PSGPR,PSGMR,PSGSM,PSGHSM,PSGST,PSGPDRG,PSGDO,PSGNEDFD,PSGSCH,PSGNEFD
"RTN","PSGOD",72,0)
 Q
"RTN","PSGOD",73,0)
 ;
"RTN","PSGOD",74,0)
CH ;
"RTN","PSGOD",75,0)
 W !!?2,"Answer 'YES' to have a new, non-verified order created for this patient,",!,"using the information from this order.  (The START and STOP dates will be",!,"recalculated.)  Enter 'NO' (or '^') to stop now." Q
"RTN","PSGOD",76,0)
 ;
"RTN","PSGOD",77,0)
WH ;
"RTN","PSGOD",78,0)
 W !!?2,"Answer 'YES' to take action on this new order.  Enter 'NO' (or '^') to return",!,"to the original order now." Q
"RTN","PSGOD",79,0)
 ;
"RTN","PSGOD",80,0)
OC ;Perform order checks
"RTN","PSGOD",81,0)
 NEW PSJDD,X,PSJALLGY
"RTN","PSGOD",82,0)
 ;*286 - Order checks on current dispense drugs
"RTN","PSGOD",83,0)
 F X=0:0 S X=$O(^PS(53.45,PSJSYSP,2,X)) Q:'X  D
"RTN","PSGOD",84,0)
 . S PSJDD=$G(^PS(53.45,PSJSYSP,2,X,0))
"RTN","PSGOD",85,0)
 . I +PSJDD S PSJALLGY(+PSJDD)=""
"RTN","PSGOD",86,0)
 ;S X=+$O(PSGODN(1,0)) Q:'X  S PSJDD=+$G(PSGODN(1,X)) Q:'PSJDD
"RTN","PSGOD",87,0)
 S PSJDD=+$O(PSJALLGY(0)) Q:'PSJDD
"RTN","PSGOD",88,0)
 D FULL^VALM1
"RTN","PSGOD",89,0)
 D ENDDC^PSGSICHK($G(PSGP),PSJDD) Q:$D(PSGORQF)
"RTN","PSGOD",90,0)
 D IN^PSJOCDS($G(PSGORD),"UD",PSJDD)
"RTN","PSGOD",91,0)
 Q
"RTN","PSJOEA")
0^2^B33792351^B31606537
"RTN","PSJOEA",1,0)
PSJOEA ;BIR/MLM-INPATIENT ORDER ENTRY ;23 Jun 98 / 1:46 PM
"RTN","PSJOEA",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**110,127,133,167,171,254,315,367**;16 DEC 97;Build 7
"RTN","PSJOEA",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PSJOEA",4,0)
 ; Reference to ^PS(55 is supported by DBIA #2191.
"RTN","PSJOEA",5,0)
 ; Reference to EN^VALM is supported by DBIA #10118.
"RTN","PSJOEA",6,0)
 ; Reference to ^PSSLOCK is supported by DBIA #2789
"RTN","PSJOEA",7,0)
 ; Reference to ^DPT is supported by DBIA #10035.
"RTN","PSJOEA",8,0)
 ; Reference to SDIMO^SDAMA203 is supported by DBIA #4133.
"RTN","PSJOEA",9,0)
 ;
"RTN","PSJOEA",10,0)
LOCK(DFN,PSJORD) ; Check to see if the order is already locked
"RTN","PSJOEA",11,0)
 N Q S Q=0
"RTN","PSJOEA",12,0)
 I PSJORD=+PSJORD N PSJO S PSJO=0 F  S PSJO=$O(^PS(53.1,"ACX",PSJORD,PSJO)) Q:'PSJO  S Q=$$LS^PSSLOCK(DFN,PSJO_"P") I 'Q Q
"RTN","PSJOEA",13,0)
 I Q Q 1
"RTN","PSJOEA",14,0)
 Q 0
"RTN","PSJOEA",15,0)
 ;
"RTN","PSJOEA",16,0)
SELECT ;
"RTN","PSJOEA",17,0)
 N PSJCLIN,O
"RTN","PSJOEA",18,0)
 Q:PSJORD=""!($G(Y)<0)  Q:('$$LOCK^PSJOEA(PSGP,PSJORD))
"RTN","PSJOEA",19,0)
 N PSJO S PSJO=0 F  S PSJO=$O(^PS(53.1,"ACX",PSJORD,PSJO)) Q:'PSJO  D
"RTN","PSJOEA",20,0)
 .S PSGORD="" S ON=PSJO_"P"
"RTN","PSJOEA",21,0)
 .D DISACTIO(PSGP,PSJO_"P",$G(PSJPNV)) S:$G(PSJO)["V" O=ON
"RTN","PSJOEA",22,0)
 I $D(^TMP("PSJCOM",$J)) D CHK^PSJOEA1
"RTN","PSJOEA",23,0)
 S:'$G(PSGP) PSGP=$G(DFN)
"RTN","PSJOEA",24,0)
 N PSJO S PSJO=0 F  S PSJO=$O(^PS(53.1,"ACX",PSJORD,PSJO)) Q:'PSJO  D
"RTN","PSJOEA",25,0)
 .L -^PS(53.1,PSJO) ; p367 
"RTN","PSJOEA",26,0)
 .D UNL^PSSLOCK(PSGP,PSJO_"P") ; Q:$G(Y)<0 p367 commented quit out
"RTN","PSJOEA",27,0)
 ; p367 Unlock complex orders (file 100) after verification of all child orders in the complex order. 
"RTN","PSJOEA",28,0)
 N PSJO S PSJO=0 F  S PSJO=$O(^TMP("PSJCVFY",$J,PSJO)) Q:'PSJO  D
"RTN","PSJOEA",29,0)
 .N PSJIDX S PSJIDX=$G(^TMP("PSJCVFY",$J,PSJO))
"RTN","PSJOEA",30,0)
 .D UNL^PSSLOCK(PSGP,PSJIDX) K ^TMP("PSJCVFY",$J,PSJO),PSJIDX
"RTN","PSJOEA",31,0)
 D DONE
"RTN","PSJOEA",32,0)
 Q
"RTN","PSJOEA",33,0)
 ;
"RTN","PSJOEA",34,0)
DISACTIO(DFN,PSJORD,PSJPNV)       ; Display UD order and allow actions.
"RTN","PSJOEA",35,0)
 ; DFN    - Patient IEN
"RTN","PSJOEA",36,0)
 ; PSJORD - Order #_location Code (P:53.1,V:55.01,U:55.06)
"RTN","PSJOEA",37,0)
 ; PSJPNV - Invoked from Pending/NV option; (gets different hidden menu)
"RTN","PSJOEA",38,0)
 N PSGP,PSJIVFLG,PSGSDX,PSGFDX,PSJXX1,ON55,PSJAPPT
"RTN","PSJOEA",39,0)
 Q:PSJORD'["P"
"RTN","PSJOEA",40,0)
 Q:$G(PSJCLIN)=-2
"RTN","PSJOEA",41,0)
 S PSGP=DFN D ENIV^PSJAC
"RTN","PSJOEA",42,0)
 D GETUD^PSJLMGUD(DFN,PSJORD)
"RTN","PSJOEA",43,0)
 S PSGOEAV=$P(PSJSYSP0,"^",9)&PSJSYSU
"RTN","PSJOEA",44,0)
 S:$G(PSJTUD) PSGPD=$G(PSJCOI),PSGPDN=$$OINAME^PSJLMUTL(+PSGPD)
"RTN","PSJOEA",45,0)
 K PSGOENG I '$D(PSGPRF) D  Q:$G(PSGOENG)
"RTN","PSJOEA",46,0)
 . I PSJORD["P" L +^PS(53.1,+PSJORD):1 E  S PSGOENG=1
"RTN","PSJOEA",47,0)
 . I $G(PSGOENG) W !,"This order is being edited by another terminal.",! S PSGOENG=1 K DIR S DIR(0)="E" D ^DIR K DIR Q
"RTN","PSJOEA",48,0)
 S PSGACT=$$ENACTION^PSGOE1(PSGP,PSJORD)
"RTN","PSJOEA",49,0)
 I PSJORD["P" S PSJXX1=$G(^PS(53.1,+PSJORD,0)) I PSGP'=$P(PSJXX1,U,15)!(DFN'=$P(PSJXX1,U,15)) Q  ;L -^PS(53.1,+PSJORD) Q
"RTN","PSJOEA",50,0)
 I PSJORD["P" D  S PSJXX1=$P($G(^PS(53.1,+PSJORD,0)),U,9) I $S($G(PSJIVFLG):1,$G(Y)<0:1,"PADE"[PSJXX1:1,1:0) Q  ;L -^PS(53.1,+PSJORD) Q
"RTN","PSJOEA",51,0)
 .I $P(PSJXX1,U,9)="N",($P(PSJXX1,U,4)'="U") D  Q
"RTN","PSJOEA",52,0)
 .. S P("PON")=PSJORD,PSIVFLG=1
"RTN","PSJOEA",53,0)
 .. D GT531^PSIVORFA(+PSGP,PSJORD),VF^PSIVORC2
"RTN","PSJOEA",54,0)
 .I $P(PSJXX1,U,9)="P" D  Q
"RTN","PSJOEA",55,0)
 ..S:$G(PSJTUD) $P(PSJXX1,U,4)="U"
"RTN","PSJOEA",56,0)
 ..N VAIP S PSJCLIN=$G(^PS(53.1,+PSJORD,"DSS")),PSJAPPT=$P(PSJCLIN,"^",2),PSJCLIN=$P(PSJCLIN,"^")
"RTN","PSJOEA",57,0)
 ..I $P(PSJXX1,U,4)="U",(+PSJPDD) D  Q:(PSJCLIN=-2)
"RTN","PSJOEA",58,0)
 ...I $$PATCH^XPDUTL("SD*5.3*285"),($$SDIMO^SDAMA203(PSJCLIN,DFN)>-1) Q
"RTN","PSJOEA",59,0)
 ...W !!,"Cannot process an Out-patient Unit Dose order for ",$P($G(^DPT(+PSGP,0)),U) D PAUSE^VALM1 S PSJIVFLG=1,PSJCLIN=-2
"RTN","PSJOEA",60,0)
 ..NEW PSGRSD,PSGRSDN,PSGRFD,PSGRFDN
"RTN","PSJOEA",61,0)
 ..D REQDT^PSJLIVMD(PSJORD)
"RTN","PSJOEA",62,0)
 ..I $P(PSJXX1,U,4)="U",($G(PSGSCH)="") W !!,"Invalid schedule, can't finish this order" D PAUSE^VALM1 Q
"RTN","PSJOEA",63,0)
 ..I $P(PSJXX1,U,4)="U" N PSJLM S PSJLM=1,PSGORD=PSJORD D START^PSGOEF,ENSFE^PSGOEE0(PSGP,PSGORD),@$S($G(PSJTUD):"FINISH^PSGOEF",1:"EN^VALM(""PSJ LM PENDING EDIT"")") D  Q
"RTN","PSJOEA",64,0)
 ...K ^TMP("PSJINTER",$J),PSJOVR
"RTN","PSJOEA",65,0)
 ..I $P(PSJXX1,U,4)'="U",PSGP=$P(PSJXX1,U,15),DFN=$P(PSJXX1,U,15) S PSJLYN=PSJORD D EN^PSJLIFN S PSJIVFLG=1 K PSJLYN,PSJMAI
"RTN","PSJOEA",66,0)
 I $G(PSIVFLG) K PSIVFLG Q
"RTN","PSJOEA",67,0)
 S PSGACT=$$ENACTION^PSGOE1(PSGP,PSJORD),PSGOEEF=0 D GETUD^PSJLMGUD(PSGP,PSJORD),ENSFE^PSGOEE0(PSGP,PSJORD),EN^VALM("PSJ LM UD ACTION")
"RTN","PSJOEA",68,0)
 ;Send SN to CPRS if autoverify OFF and Order Set Entry and no 21st piece
"RTN","PSJOEA",69,0)
 I $D(PSGOES),'PSGOEAV,$D(PSGORD),PSGORD["P",$P($G(^PS(53.1,+PSGORD,0)),"^",21)']"" D ORSET^PSGOETO1
"RTN","PSJOEA",70,0)
 Q
"RTN","PSJOEA",71,0)
 ;
"RTN","PSJOEA",72,0)
ACTLOG(PSGORDP,DFN,PSGORD)  ;Store 53.1 activity log in local array to be moved to 55
"RTN","PSJOEA",73,0)
 ;PSGORDP: IEN from 53.1
"RTN","PSJOEA",74,0)
 ;PSGORD : IEN from 55
"RTN","PSJOEA",75,0)
 NEW PSGX,PSGXDA,PSGAL531,Q,QQ
"RTN","PSJOEA",76,0)
 F PSGX=0:0 S PSGX=$O(^PS(53.1,+PSGORDP,"A",PSGX)) Q:'PSGX  D
"RTN","PSJOEA",77,0)
 . S PSGAL531=$G(^PS(53.1,+PSGORDP,"A",PSGX,0))
"RTN","PSJOEA",78,0)
 . S QQ=$G(^PS(55,DFN,5,+PSGORD,9,0)) S:QQ="" QQ="^55.09D" F Q=$P(QQ,U,3)+1:1 I '$D(^(Q)) S $P(QQ,U,3,4)=Q_U_Q,^(0)=QQ,PSGXDA=Q Q
"RTN","PSJOEA",79,0)
 . S ^PS(55,DFN,5,+PSGORD,9,PSGXDA,0)=PSGAL531
"RTN","PSJOEA",80,0)
 Q
"RTN","PSJOEA",81,0)
 ;
"RTN","PSJOEA",82,0)
UD ;
"RTN","PSJOEA",83,0)
 N DA,DR,DIE,PSJCMPDA D ENGNA^PSGOETO S $P(^TMP("PSJCOM",$J,PSJO,0),"^",26)=DA_"U",$P(^TMP("PSJCOM2",$J,PSJO,0),"^")=DA,$P(^(0),"^",18)=DA S PSJCMPDA=DA
"RTN","PSJOEA",84,0)
 M ^PS(55,PSGP,5,DA)=^TMP("PSJCOM2",$J,+PSJO) M ^PS(53.1,+PSJO)=^TMP("PSJCOM",$J,+PSJO) D EN1^PSJHL2(PSGP,"OD",+PSJO_"P") S PSJNOO=$P(^TMP("PSJCOM2",$J,+PSJO,.2),U,3) D EN1^PSJHL2(PSGP,"SN",+PSJCMPDA_"U")
"RTN","PSJOEA",85,0)
 N PSGPDRG,PSGST,PSGNESD,PSGNEFD,ND2,ND2P1
"RTN","PSJOEA",86,0)
 S PSGPDRG=$P($G(^PS(55,PSGP,5,PSJCMPDA,.2)),"^"),PSGST=$P($G(^PS(55,PSGP,5,PSJCMPDA,0)),"^",7)
"RTN","PSJOEA",87,0)
 S ND2=$G(^PS(55,PSGP,5,PSJCMPDA,2)),PSGNESD=$P(ND2,"^",2),PSGNEFD=$P(ND2,"^",4) D CRA^PSGOETO
"RTN","PSJOEA",88,0)
 S ND2P1=$G(^PS(55,PSGP,5,PSJCMPDA,2)),PSGRMVT=$P(ND2P1,"^",2) ;*315
"RTN","PSJOEA",89,0)
 K ^PS(53.1,"ACX",PSJORD,PSJO) K PSJPREX
"RTN","PSJOEA",90,0)
 I $G(PSJCMPDA) D CMPLX2^PSJCOM1(PSGP,PSJORD,+PSJCMPDA_"U") I $G(PSGPXN) S PSJPREX=1
"RTN","PSJOEA",91,0)
 Q
"RTN","PSJOEA",92,0)
IV ; 
"RTN","PSJOEA",93,0)
 K ON55 I $P($G(^PS(53.1,+PSJO,0)),"^",24)="R",$P($G(^PS(53.1,+PSJO,0)),"^",25) S ON55=$P(^PS(53.1,+PSJO,0),"^",25)
"RTN","PSJOEA",94,0)
 I '$G(ON55) D NEW55^PSIVORFB
"RTN","PSJOEA",95,0)
 S $P(^TMP("PSJCOM",$J,PSJO,0),"^",26)=ON55,$P(^TMP("PSJCOM2",$J,PSJO,0),"^")=+ON55
"RTN","PSJOEA",96,0)
 S $P(^TMP("PSJCOM2",$J,PSJO,2),U,5)=PSJO_"P",$P(^TMP("PSJCOM",$J,PSJO,0),U,26)=ON55
"RTN","PSJOEA",97,0)
 M ^PS(55,DFN,"IV",+ON55)=^TMP("PSJCOM2",$J,+PSJO) M ^PS(53.1,+PSJO)=^TMP("PSJCOM",$J,+PSJO) D EN1^PSJHL2(PSGP,"OD",+PSJO_"P") S P("NAT")=$P(^TMP("PSJCOM2",$J,+PSJO,.2),U,5) D EN1^PSJHL2(PSGP,"SN",ON55)
"RTN","PSJOEA",98,0)
 K DA,DIK S DA(1)=DFN,DA=+ON55,DIK="^PS(55,"_DA(1)_",""IV"",",PSIVACT=1 D IX^DIK K DA,DIK
"RTN","PSJOEA",99,0)
 K ^PS(53.1,"ACX",PSJORD,PSJO)
"RTN","PSJOEA",100,0)
 Q
"RTN","PSJOEA",101,0)
 ;
"RTN","PSJOEA",102,0)
DONE ; Clean up
"RTN","PSJOEA",103,0)
 K PSGPD,PSGPDN,PSGSCH,PSIVACT,PSJNOO
"RTN","PSJOEA",104,0)
 Q
"RTN","PSJOEA2")
0^3^B34608662^B32521096
"RTN","PSJOEA2",1,0)
PSJOEA2 ;BIR/MLM-INPATIENT ORDER ENTRY ; 5/11/09 7:50am
"RTN","PSJOEA2",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**127,133,200,267,268,257,281,367**;16 DEC 97;Build 7
"RTN","PSJOEA2",3,0)
 ;
"RTN","PSJOEA2",4,0)
 ; Reference to ^PS(55 is supported by DBIA #2191.
"RTN","PSJOEA2",5,0)
 ; Reference to ^PSSLOCK is supported by DBIA #2789.
"RTN","PSJOEA2",6,0)
 ; Reference to ^TMP("PSODAOC",$J supported by DBIA 6071
"RTN","PSJOEA2",7,0)
 ;
"RTN","PSJOEA2",8,0)
CHK ;Check to be sure all the orders in the complex order series are completed, continued.
"RTN","PSJOEA2",9,0)
 K ^TMP("PSJCVFY",$J) ; p367
"RTN","PSJOEA2",10,0)
 I 'PSJCOMV,'$G(COMQUIT) N PSJO S PSJO=0 F  S PSJO=$O(^TMP("PSJCOM",$J,PSJO)) Q:'PSJO  S PSGORD=+PSJO_"P",PSGND=$G(^PS(53.1,+PSJO,0)) D
"RTN","PSJOEA2",11,0)
 .S PSGP=$P(PSGND,"^",15)
"RTN","PSJOEA2",12,0)
 .I $P(PSGND,U,4)="U",$P(PSGND,U,9)="A",($P(PSGND,U,24)'="R") D ^PSGOT D  Q
"RTN","PSJOEA2",13,0)
 ..M ^PS(55,PSGP,5,+PSGORD,4)=^PS(53.1,PSJO,4)
"RTN","PSJOEA2",14,0)
 ..N PSGND2P5 S PSGND2P5=$G(^PS(53.1,+PSJO,2.5)),DUR=$P(PSGND2P5,"^",2) I $G(DUR)]"" N DA,DR,DIE S DIE="^PS(55,"_PSGP_",5,",DA(1)=PSGP,DA=+PSGORD,DR="126////"_$G(DUR) D ^DIE
"RTN","PSJOEA2",15,0)
 ..D KILL531^PSJIMO1(PSGP,"",+PSJO)
"RTN","PSJOEA2",16,0)
 ..D ACTLOG^PSJOEA(PSJO,PSGP,PSGORD)
"RTN","PSJOEA2",17,0)
 ..S VND4=$G(^PS(55,PSGP,5,+PSGORD,4))
"RTN","PSJOEA2",18,0)
 ..I PSJSYSL>1 S $P(^PS(55,PSGP,5,+PSGORD,7),U)=PSGDT S:$P(^(7),U,2)="" $P(^(7),U,2)="N"_$S($P(^PS(55,PSGP,5,+PSGORD,0),"^",24)="E":"E",1:"") S PSGTOL=2,PSGUOW=DUZ,PSGTOO=1,DA=+PSGORD D ENL^PSGVDS
"RTN","PSJOEA2",19,0)
 ..S:$P(VND4,"^",15)&'$P(VND4,"^",16) $P(VND4,"^",15)="" S:$P(VND4,"^",18)&'$P(VND4,"^",19) $P(VND4,"^",18)="" S:$P(VND4,"^",22)&'$P(VND4,"^",23) $P(VND4,"^",22)="" S $P(VND4,"^",PSJSYSU,PSJSYSU+1)=DUZ_"^"_PSGDT
"RTN","PSJOEA2",20,0)
 ..; Set PV and NV flag according to PSJSYSU  (PSJ*5*200)
"RTN","PSJOEA2",21,0)
 ..S $P(VND4,"^",+PSJSYSU=1+9)=1 S:'$P(VND4,U,+PSJSYSU=3+9) $P(VND4,U,+PSJSYSU=3+9)=+$P(VND4,U,+PSJSYSU=3+9) S ^PS(55,PSGP,5,+PSGORD,4)=VND4
"RTN","PSJOEA2",22,0)
 ..I '$P(VND4,U,10) S ^PS(55,"ANV",PSGP,+PSGORD)=""
"RTN","PSJOEA2",23,0)
 ..I $P(VND4,U,9) K ^PS(55,"APV",PSGP,+PSGORD)
"RTN","PSJOEA2",24,0)
 ..I $P(VND4,U,10) K ^PS(55,"ANV",PSGP,+PSGORD)
"RTN","PSJOEA2",25,0)
 ..S:+PSJSYSU=3 ^PS(55,"AUE",PSGP,+PSGORD)=""
"RTN","PSJOEA2",26,0)
 ..S PSJCOM=$P($G(^PS(55,PSGP,5,+PSGORD,.2)),"^",8) I PSJCOM]"" K ^PS(53.1,"ACX",PSJCOM,PSJO) ;S $P(^PS(55,PSGP,5,+PSGORD,4),"^",9)=1
"RTN","PSJOEA2",27,0)
 ..S:PSJCOM]"" ^TMP("PSJCVFY",$J,PSJO)=+PSGORD ; p367 store order index for file 55 to be used to unlock file 100.
"RTN","PSJOEA2",28,0)
 ..D EN1^PSJHL2(PSGP,$S(+PSJSYSU=3:"SC",+PSJSYSU=1:"SC",1:"XX"),+PSGORD_"U")     ; allow status change to be sent for pharmacists & nurses
"RTN","PSJOEA2",29,0)
 ..D:+PSJSYSU=1 EN1^PSJHL2(PSGP,"ZV",+PSGORD_"U") L -^PS(55,PSGP,5,+PSGORD)
"RTN","PSJOEA2",30,0)
 ..I $G(PSJCOM) S ^TMP("PSODAOC",$J,"IP IEN")=PSJO_"P",^TMP("PSODAOC",$J,"IP NEW IEN")=PSGORD D SETOC^PSJNEWOC(PSGORD)
"RTN","PSJOEA2",31,0)
 ..; ** This is where the Automated Dispensing hook is called. Do NOT DELETE or change location **
"RTN","PSJOEA2",32,0)
 ..D NEWJ^PSJADM
"RTN","PSJOEA2",33,0)
 ..; ** END to Interface Hook **
"RTN","PSJOEA2",34,0)
 ..S PSJPREX=1 D CMPLX2^PSJCOM1(PSGP,PSJORD,PSGORD) K PSJPREX
"RTN","PSJOEA2",35,0)
 .I $P(PSGND,U,4)'="U",$P(PSGND,U,9)="A" D GT531^PSIVORFA(PSGP,PSJO_"P") D  Q
"RTN","PSJOEA2",36,0)
 ..S ON55="" I $P(PSGND,"^",24)="R" S ON55=$P(PSGND,"^",25) D
"RTN","PSJOEA2",37,0)
 ...N PND0,PSGORDR S PND0=^PS(53.1,+PSJO,0),PSGORDR=$P(PND0,U,25)
"RTN","PSJOEA2",38,0)
 ...Q:'$$LS^PSSLOCK(PSGP,PSGORDR)
"RTN","PSJOEA2",39,0)
 ...D KILL531^PSJIMO1(PSGP,"",+PSJO)
"RTN","PSJOEA2",40,0)
 ...N OEORD,OOEORD,FILE55,FILE55N0,PNDP2 S PNDP2=^PS(53.1,+PSJO,.2),FILE55="^PS(55,"_DFN_",""IV"",",FILE55N0=FILE55_+PSGORDR_",0)"
"RTN","PSJOEA2",41,0)
 ...S OEORD=$P(PND0,U,21) I PSGORDR S OOEORD=$P(@FILE55N0,"^",21) I OEORD'=OOEORD D EXPOE^PSGOER(DFN,+PSJO_"P",+$$LASTREN^PSJLMPRI(DFN,+PSJO_"P"))
"RTN","PSJOEA2",42,0)
 ...S PSGORDP=PSJO,DIE="^PS(53.1,",DA=+PSJO,DR="28////A;104////@" W "." D ^DIE
"RTN","PSJOEA2",43,0)
 ...Q:'$G(OEORD)  K DA,DR,DIE S DA(1)=DFN,DA=+PSGORDR,DIE=FILE55,DR=110_"////"_+OEORD
"RTN","PSJOEA2",44,0)
 ...S:$P(PNDP2,U,8) DR=DR_";150////"_$P(PNDP2,U,8) D ^DIE S DIE=FILE55_+PSGORDR_",0)",$P(@DIE,U,21)=OEORD
"RTN","PSJOEA2",45,0)
 ...D EN1^PSJHL2(DFN,"SC",PSGORDR),UNL^PSSLOCK(PSGP,PSGORDR)
"RTN","PSJOEA2",46,0)
 ..I 'ON55 D SETNEW^PSIVORFB
"RTN","PSJOEA2",47,0)
 ..I $G(PSJCOM),ON55["V" S ^TMP("PSODAOC",$J,"IP IEN")=PSJO_"P",^TMP("PSODAOC",$J,"IP NEW IEN")=ON55 D SETOC^PSJNEWOC(ON55)
"RTN","PSJOEA2",48,0)
 ..S (P("NEWON"),ON)=ON55,PSGP=$P(PSGND,U,15)
"RTN","PSJOEA2",49,0)
 ..S VND4=$G(^TMP("PSJCOM",$J,+PSJO,4)) D
"RTN","PSJOEA2",50,0)
 ...N PSJRN,PSJRNDT,PSJRPH,PSJRPHD,PSJPVFL,PSJNVFL,DR,DIE,DA
"RTN","PSJOEA2",51,0)
 ...S (PSJPVFL,PSJNVFL)=""
"RTN","PSJOEA2",52,0)
 ...S PSJRN=$P(VND4,U,1),PSJRNDT=$P(VND4,U,2),PSJRPH=$P(VND4,U,3),PSJRPHD=$P(VND4,U,4),PSJPVFL=$P(VND4,U,16) S:PSJRN]"" PSJNVFL=1
"RTN","PSJOEA2",53,0)
 ...S DR="16////"_PSJRN_";17////"_PSJRNDT_";140////"_PSJRPH_";141////"_PSJRPHD_";142////"_PSJPVFL_";143////"_PSJNVFL
"RTN","PSJOEA2",54,0)
 ...S DA(1)=PSGP,DA=+ON55,DIE="^PS(55,"_PSGP_",""IV""," D ^DIE
"RTN","PSJOEA2",55,0)
 ..D:P("RES")="R" RUPDATE^PSIVOREN(PSGP,ON,P(2))
"RTN","PSJOEA2",56,0)
 ..I +PSJSYSU=3 K OD D ^PSIVORE1 ;LABEL STUFF
"RTN","PSJOEA2",57,0)
 ..I $G(P("PACT"))]"",+$P(P("PACT"),U,2),+$P(P("PACT"),U,3) D  Q
"RTN","PSJOEA2",58,0)
 ...NEW DIC,DA,X,Y,XX D NAME^PSJBCMA1($P(P("PACT"),U,2),.XX)
"RTN","PSJOEA2",59,0)
 ...S DIC(0)="L",DA(1)=DFN,DA(2)=+ON55,X=1
"RTN","PSJOEA2",60,0)
 ...S DIC="^PS(55,"_DA(1)_",""IV"","_DA(2)_",""A"","
"RTN","PSJOEA2",61,0)
 ...S DIC("DR")=".02////F;.03////"_XX_";.04////"_$P($G(^PS(53.3,+$P(P("PACT"),U,3),0)),U)_";.05////"_$P(P("PACT"),U)_";.06////"_$P(P("PACT"),U,2)
"RTN","PSJOEA2",62,0)
 ...K DO D FILE^DICN K DO
"RTN","PSJOEA2",63,0)
 ...N DIK,DA,PSIVACT S DIK="^PS(55,"_DFN_",""IV"",",DA=+ON,PSIVACT="" S:$G(DFN) DA(1)=DFN D IX^DIK K DIK,DA
"RTN","PSJOEA2",64,0)
 ...S PSJCOM=$P($G(^PS(55,DFN,"IV",+ON,.2)),"^",8) I PSJCOM]"" K ^PS(53.1,"ACX",PSJCOM,PSJO)
"RTN","PSJOEA2",65,0)
 ...S:PSJCOM]"" ^TMP("PSJCVFY",$J,PSJO)=ON ; p367 store IV order index for file 55. 
"RTN","PSJOEA2",66,0)
 ...D EN1^PSJHL2(DFN,"SC",ON)
"RTN","PSJOEA2",67,0)
 ...D:+PSJSYSU=1 EN1^PSJHL2(DFN,"ZV",ON) L -^PS(55,DFN,"IV",+ON) I $G(ON55) L -^PS(55,DFN,"IV",+ON55)
"RTN","PSJOEA2",68,0)
 ..L -^PS(55,DFN,"IV",+ON) I $G(ON55) L -^PS(55,DFN,"IV",+ON55)
"RTN","PSJOEA2",69,0)
 .I $P(PSGND,U,4)="U",$P(PSGND,U,9)="DE",$D(^TMP("PSJCOM2",$J,PSJO,0)),$P(^TMP("PSJCOM2",$J,PSJO,0),"^",9)="A",$P(^TMP("PSJCOM2",$J,PSJO,0),"^",4)="U" S PSGP=$P(PSGND,U,15) D UD^PSJOEA
"RTN","PSJOEA2",70,0)
 .I $P(PSGND,U,4)'="U",$P(PSGND,U,9)="DE",$D(^TMP("PSJCOM2",$J,PSJO,0)),$P(^TMP("PSJCOM2",$J,PSJO,0),"^",9)="A",$P(^TMP("PSJCOM2",$J,PSJO,0),"^",4)="U" S PSGP=$P(PSGND,U,15) D UD^PSJOEA
"RTN","PSJOEA2",71,0)
 .I $P(PSGND,U,4)'="U",$P(PSGND,U,9)="DE",$D(^TMP("PSJCOM2",$J,PSJO,0)),$P(^TMP("PSJCOM2",$J,PSJO,0),"^",4)'="U",$P(^TMP("PSJCOM2",$J,PSJO,0),"^",17)="A" S DFN=$S($G(PSGP)]"":PSGP,1:$P(PSGND,U,15)) D IV^PSJOEA
"RTN","PSJOEA2",72,0)
 .I $P(PSGND,U,4)="U",$P(PSGND,U,9)="DE",$D(^TMP("PSJCOM2",$J,PSJO,0)),$P(^TMP("PSJCOM2",$J,PSJO,0),"^",4)'="U",$P(^TMP("PSJCOM2",$J,PSJO,0),"^",17)="A" S DFN=$S($G(PSGP)]"":PSGP,1:$P(PSGND,U,15)) D IV^PSJOEA
"RTN","PSJOEA2",73,0)
 K ^TMP("PSJCOM",$J),^TMP("PSJCOM2",$J),PSJOWALL
"RTN","PSJOEA2",74,0)
 Q
"VER")
8.0^22.2
"BLD",11044,6)
^318
**END**
**END**

