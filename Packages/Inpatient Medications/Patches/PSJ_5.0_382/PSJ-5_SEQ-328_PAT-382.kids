Released PSJ*5*382 SEQ #328
Extracted from mail message
**KIDS**:PSJ*5.0*382^

**INSTALL NAME**
PSJ*5.0*382
"BLD",11330,0)
PSJ*5.0*382^INPATIENT MEDICATIONS^0^3190102^y
"BLD",11330,1,0)
^^4^4^3190102^
"BLD",11330,1,1,0)
When a user enters a complex order as a clinic order for an outpatient 
"BLD",11330,1,2,0)
and edits a part (child) of the order after finishing that part of the 
"BLD",11330,1,3,0)
order, the order displays as an inpatient medication instead of 
"BLD",11330,1,4,0)
displaying as a clinic order.
"BLD",11330,4,0)
^9.64PA^^
"BLD",11330,6.3)
1
"BLD",11330,"ABPKG")
n
"BLD",11330,"KRN",0)
^9.67PA^1.61^23
"BLD",11330,"KRN",.4,0)
.4
"BLD",11330,"KRN",.401,0)
.401
"BLD",11330,"KRN",.402,0)
.402
"BLD",11330,"KRN",.403,0)
.403
"BLD",11330,"KRN",.5,0)
.5
"BLD",11330,"KRN",.84,0)
.84
"BLD",11330,"KRN",1.6,0)
1.6
"BLD",11330,"KRN",1.61,0)
1.61
"BLD",11330,"KRN",1.62,0)
1.62
"BLD",11330,"KRN",3.6,0)
3.6
"BLD",11330,"KRN",3.8,0)
3.8
"BLD",11330,"KRN",9.2,0)
9.2
"BLD",11330,"KRN",9.8,0)
9.8
"BLD",11330,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",11330,"KRN",9.8,"NM",1,0)
PSJOEA1^^0^B31393636
"BLD",11330,"KRN",9.8,"NM","B","PSJOEA1",1)

"BLD",11330,"KRN",19,0)
19
"BLD",11330,"KRN",19.1,0)
19.1
"BLD",11330,"KRN",101,0)
101
"BLD",11330,"KRN",409.61,0)
409.61
"BLD",11330,"KRN",771,0)
771
"BLD",11330,"KRN",779.2,0)
779.2
"BLD",11330,"KRN",870,0)
870
"BLD",11330,"KRN",8989.51,0)
8989.51
"BLD",11330,"KRN",8989.52,0)
8989.52
"BLD",11330,"KRN",8994,0)
8994
"BLD",11330,"KRN","B",.4,.4)

"BLD",11330,"KRN","B",.401,.401)

"BLD",11330,"KRN","B",.402,.402)

"BLD",11330,"KRN","B",.403,.403)

"BLD",11330,"KRN","B",.5,.5)

"BLD",11330,"KRN","B",.84,.84)

"BLD",11330,"KRN","B",1.6,1.6)

"BLD",11330,"KRN","B",1.61,1.61)

"BLD",11330,"KRN","B",1.62,1.62)

"BLD",11330,"KRN","B",3.6,3.6)

"BLD",11330,"KRN","B",3.8,3.8)

"BLD",11330,"KRN","B",9.2,9.2)

"BLD",11330,"KRN","B",9.8,9.8)

"BLD",11330,"KRN","B",19,19)

"BLD",11330,"KRN","B",19.1,19.1)

"BLD",11330,"KRN","B",101,101)

"BLD",11330,"KRN","B",409.61,409.61)

"BLD",11330,"KRN","B",771,771)

"BLD",11330,"KRN","B",779.2,779.2)

"BLD",11330,"KRN","B",870,870)

"BLD",11330,"KRN","B",8989.51,8989.51)

"BLD",11330,"KRN","B",8989.52,8989.52)

"BLD",11330,"KRN","B",8994,8994)

"BLD",11330,"QUES",0)
^9.62^^
"BLD",11330,"REQB",0)
^9.611^1^1
"BLD",11330,"REQB",1,0)
PSJ*5.0*254^2
"BLD",11330,"REQB","B","PSJ*5.0*254",1)

"MBREQ")
0
"PKG",471,-1)
1^1
"PKG",471,0)
INPATIENT MEDICATIONS^PSJ^UNIT DOSE AND IVS
"PKG",471,22,0)
^9.49I^1^1
"PKG",471,22,1,0)
5.0^2971215^2990325^66481
"PKG",471,22,1,"PAH",1,0)
382^3190102
"PKG",471,22,1,"PAH",1,1,0)
^^4^4^3190102
"PKG",471,22,1,"PAH",1,1,1,0)
When a user enters a complex order as a clinic order for an outpatient 
"PKG",471,22,1,"PAH",1,1,2,0)
and edits a part (child) of the order after finishing that part of the 
"PKG",471,22,1,"PAH",1,1,3,0)
order, the order displays as an inpatient medication instead of 
"PKG",471,22,1,"PAH",1,1,4,0)
displaying as a clinic order.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","PSJOEA1")
0^1^B31393636^B29816523
"RTN","PSJOEA1",1,0)
PSJOEA1 ;BIR/MLM-INPATIENT ORDER ENTRY ;23 Jun 98 / 1:46 PM
"RTN","PSJOEA1",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**110,127,133,171,254,382**;16 DEC 97;Build 1
"RTN","PSJOEA1",3,0)
 ;
"RTN","PSJOEA1",4,0)
 ; Reference to ^PS(55 is supported by DBIA #2191.
"RTN","PSJOEA1",5,0)
 ; Reference to ^PSSLOCK is supported by DBIA #2789.
"RTN","PSJOEA1",6,0)
 ;
"RTN","PSJOEA1",7,0)
CHK ;Check to be sure all the orders in the complex order series are completed.
"RTN","PSJOEA1",8,0)
 N COMQUIT,PSJCOMV,PSJOT,PSJSTAT,PSJSTAT2,PSGND2P5,DUR,ND14,PSJPREX S (PSJCOMV,COMQUIT)=0,PSJSTAT2="" K ^TMP("PSJINTER",$J)
"RTN","PSJOEA1",9,0)
 I '$D(^TMP("PSJCOM",$J)) Q
"RTN","PSJOEA1",10,0)
 N PSJO S PSJO=0 F  S PSJO=$O(^PS(53.1,"ACX",PSJORD,PSJO)) Q:'PSJO  Q:COMQUIT  S PSJOT=$P(^PS(53.1,PSJO,0),"^",4) D
"RTN","PSJOEA1",11,0)
 . I '$D(^TMP("PSJCOM",$J,PSJO,0)) M ^TMP("PSJCOM",$J,PSJO)=^PS(53.1,PSJO) I '$D(^TMP("PSJCOM",$J,PSJO,0)) S COMQUIT=2 Q:COMQUIT
"RTN","PSJOEA1",12,0)
 . S PSJSTAT=$P(^TMP("PSJCOM",$J,PSJO,0),"^",9)
"RTN","PSJOEA1",13,0)
 . I PSJSTAT="DE" S PSJSTAT=$P($G(^TMP("PSJCOM2",$J,PSJO,0)),"^",9) I PSJSTAT="" S COMQUIT=1 Q
"RTN","PSJOEA1",14,0)
 . S:PSJSTAT2="" PSJSTAT2=PSJSTAT S:PSJSTAT'=PSJSTAT2 COMQUIT=2 Q:COMQUIT  S PSJSTAT2=PSJSTAT
"RTN","PSJOEA1",15,0)
 I COMQUIT,PSJOT="U",$G(^TMP("PSJCOM",$J))'="A" S:$G(PSJOWALL)]"" $P(^PS(55,PSGP,5.1),U)=PSJOWALL
"RTN","PSJOEA1",16,0)
 I (COMQUIT=2)!(COMQUIT&($G(^TMP("PSJCOM",$J))'="A")) D  Q
"RTN","PSJOEA1",17,0)
 .K ^TMP("PSJCOM",$J),^TMP("PSJCOM2",$J)
"RTN","PSJOEA1",18,0)
 .W !,"By not finishing all the orders, none of the orders will be updated." D PAUSE^VALM1
"RTN","PSJOEA1",19,0)
 I 'COMQUIT N PSJO S PSJO=0 F  S PSJO=$O(^TMP("PSJCOM",$J,PSJO)) Q:'PSJO  D
"RTN","PSJOEA1",20,0)
 .S PSGS0Y=$P($G(^TMP("PSJCOM",$J,+PSJO,2)),"^",5),PSGS0XT=$P($G(^TMP("PSJCOM",$J,+PSJO,2)),"^",6)
"RTN","PSJOEA1",21,0)
 .N EDITS0Y,EDITS0XT S EDITS0Y=$P($G(^TMP("PSJCOM2",$J,+PSJO,2)),"^",5),EDITS0XT=$P($G(^TMP("PSJCOM2",$J,+PSJO,2)),"^",6) D
"RTN","PSJOEA1",22,0)
 ..S:EDITS0Y PSGS0Y=EDITS0Y I EDITS0XT!(",O,D,"[(","_EDITS0XT_",")) S PSGS0XT=EDITS0XT
"RTN","PSJOEA1",23,0)
 .N DIE,DA,DR S DR="28////^S X=$P(^TMP(""PSJCOM"",$J,+PSJO,0),""^"",9)",DA=+PSJO,DIE="^PS(53.1," D ^DIE
"RTN","PSJOEA1",24,0)
 .N DIK,DA S DIK="^PS(53.1,",DA=+PSJO S:$G(DFN) DA(1)=DFN D IX^DIK K DIK,DA
"RTN","PSJOEA1",25,0)
 .M ^PS(53.1,+PSJO)=^TMP("PSJCOM",$J,+PSJO)
"RTN","PSJOEA1",26,0)
 .S PSGND=$G(^PS(53.1,+PSJO,0)),PSGND2P5=$G(^PS(53.1,+PSJO,2.5)),DUR=$P(PSGND2P5,"^",2),ND14=$$LASTREN^PSJLMPRI(DFN,+PSJO_"P")
"RTN","PSJOEA1",27,0)
 .I $P(PSGND,U,4)="U",$P(PSGND,U,24)="R" D
"RTN","PSJOEA1",28,0)
 ..N PND0,PSGORDR S PND0=^PS(53.1,+PSJO,0) I $P(PND0,U,24)="R" S PSGORDR=$P(PND0,U,25) D
"RTN","PSJOEA1",29,0)
 ...S:'$G(PSGP) PSGP=$G(DFN) Q:'$$LS^PSSLOCK(PSGP,PSGORDR)
"RTN","PSJOEA1",30,0)
 ...N OEORD,OOEORD,FILE55,FILE55N0,PNDP2 S PNDP2=^PS(53.1,+PSJO,.2),FILE55="^PS(55,"_DFN_$S($P(PND0,U,4)="U":",5,",1:",""IV"","),FILE55N0=FILE55_+PSGORDR_",0)"
"RTN","PSJOEA1",31,0)
 ...S OEORD=$P(PND0,U,21) I PSGORDR S OOEORD=$P(@FILE55N0,"^",21) I OEORD'=OOEORD D EXPOE^PSGOER(DFN,+PSJO_"P",+$$LASTREN^PSJLMPRI(DFN,+PSJO_"P"))
"RTN","PSJOEA1",32,0)
 ...S PSGORDP=PSJO,DIE="^PS(53.1,",DA=+PSJO,DR="28////A;104////@" W "." D ^DIE
"RTN","PSJOEA1",33,0)
 ...D START^PSGOTR(+PSJO_"P",+PSGORDR) I OEORD D
"RTN","PSJOEA1",34,0)
 ....K DA,DR,DIE S DA(1)=DFN,DA=+PSGORDR,DIE=FILE55,DR=$S(DIE["IV":110,1:66)_"////"_+OEORD
"RTN","PSJOEA1",35,0)
 ....S:$P(PNDP2,U,8) DR=DR_";125////"_$P(PNDP2,U,8) D ^DIE S DIE=FILE55_+PSGORDR_",0)",$P(@DIE,U,21)=OEORD
"RTN","PSJOEA1",36,0)
 ....D EN1^PSJHL2(DFN,"SC",PSGORDR),UNL^PSSLOCK(DFN,PSGORDR)
"RTN","PSJOEA1",37,0)
 ..I '$G(COMQUIT) S ND14=$$LASTREN^PSJLMPRI(DFN,+PSJO_"P") I $G(ND14) S DA=+$P(PSGND,U,25) I DA D
"RTN","PSJOEA1",38,0)
 ...N PSGAT S PSGAT=$P($G(^TMP("PSJCOM",$J,+PSJO,2)),"^",5)
"RTN","PSJOEA1",39,0)
 ...D UPDREN^PSGOER(DA,$P(ND14,U),$P(ND14,U,3),$P(ND14,U,4),$P($G(^PS(53.1,+PSJO,.2)),U,3),$P(ND14,U,2))
"RTN","PSJOEA1",40,0)
 ...K PSJPREX I $G(PSGORDR)["U" I $G(PSJORD)=+$G(PSJORD) D CMPLX2^PSJCOM1(DFN,PSJORD,PSGORDR) I $G(PSGPXN) S PSJPREX=1
"RTN","PSJOEA1",41,0)
 .I '$G(PSGP) S:$G(DFN) PSGP=DFN
"RTN","PSJOEA1",42,0)
 .I $P(PSGND,U,4)'="U",$P(PSGND,U,24)="R",$P(PSGND,U,25),$P($G(^PS(53.1,+PSJO,2)),U,2)<$P($G(^PS(55,PSGP,"IV",+$P(PSGND,U,25),0)),U,3) D
"RTN","PSJOEA1",43,0)
 ..K DA,DR S DA(1)=PSGP,DA=+$P(PSGND,U,25),DIE="^PS(55,"_PSGP_",""IV"",",DR=".03////"_$P($G(^PS(53.1,+PSJO,2)),U,2)_";116////"_$P($G(^PS(55,PSGP,"IV",+$P(PSGND,U,25),0)),U,3)
"RTN","PSJOEA1",44,0)
 ..D ^DIE,EN1^PSJHL2(PSGP,"XX",$P(PSGND,U,25)) L -^PS(53.1,+PSJO)
"RTN","PSJOEA1",45,0)
 .I $P(PSGND,U,9)="DE",$D(^TMP("PSJCOM2",$J,PSJO,0)),(",N,A,"[$P(^TMP("PSJCOM2",$J,PSJO,0),"^",9)) D
"RTN","PSJOEA1",46,0)
 ..S:'$G(PSGP) PSGP=DFN S PSGS0Y=$P($G(^TMP("PSJCOM2",$J,+PSJO,2)),"^",5)
"RTN","PSJOEA1",47,0)
 ..N DA,DR,DIE D ENGNN^PSGOETO S $P(^TMP("PSJCOM",$J,PSJO,0),"^",26)=DA_"P",$P(^TMP("PSJCOM2",$J,PSJO,0),"^")=DA,$P(^(0),"^",18)=DA
"RTN","PSJOEA1",48,0)
 ..S DR="28////^S X=$P(^TMP(""PSJCOM2"",$J,+PSJO,0),""^"",9)",DIE="^PS(53.1," D ^DIE
"RTN","PSJOEA1",49,0)
 ..M ^PS(53.1,DA)=^TMP("PSJCOM2",$J,+PSJO) M ^TMP("PSJCOM2",$J,DA)=^TMP("PSJCOM2",$J,+PSJO) N PSJOCHIL S PSJOCHIL=$P(^PS(53.1,DA,.2),"^",8) I PSJOCHIL S ^PS(53.1,"ACX",+PSJOCHIL,DA)=""
"RTN","PSJOEA1",50,0)
 ..M:$D(^TMP("PSJCOM",$J,PSJO,"DSS")) ^PS(53.1,DA,"DSS")=^TMP("PSJCOM",$J,PSJO,"DSS") ; p382 move clinic data to pending order file for corrected order
"RTN","PSJOEA1",51,0)
 ..I $P(^PS(53.1,+PSJO,2),"^",5)'=$P(^TMP("PSJCOM2",$J,+PSJO,2),"^",5) S $P(^PS(53.1,+PSJO,2),"^",5)=$P(^TMP("PSJCOM2",$J,+PSJO,2),"^",5)
"RTN","PSJOEA1",52,0)
 ..D EN1^PSJHL2(PSGP,"OD",+PSJO_"P"),EN1^PSJHL2(PSGP,"SN",+DA_"P")
"RTN","PSJOEA1",53,0)
 ..K ^PS(53.1,"ACX",PSJORD,PSJO) L -^PS(53.1,+PSJO) L -^PS(53.1,DA)
"RTN","PSJOEA1",54,0)
 ..D SETUDINT^PSGSICH1(PSJO_"P",DA_"P")
"RTN","PSJOEA1",55,0)
 I '$G(COMQUIT) N PSJO S PSJO=0 F  S PSJO=$O(^PS(53.1,"ACX",PSJORD,PSJO)) Q:'PSJO  Q:PSJCOMV  D
"RTN","PSJOEA1",56,0)
 .I '$D(^TMP("PSJCOM",$J,PSJO)) D  Q:$G(PSJCOMV)
"RTN","PSJOEA1",57,0)
 ..N EDITND0,PREV,REAS S EDITND0=$G(^PS(53.1,+PSJO,0)) S PREV=$P(EDITND0,"^",25),REAS=$P(EDITND0,"^",24)
"RTN","PSJOEA1",58,0)
 ..I PREV,REAS="E" I $P($G(^PS(53.1,+PREV,0)),"^",9)="DE" M ^TMP("PSJCOM",$J,+PSJO)=^PS(53.1,+PSJO) K ^TMP("PSJCOM",$J,+PREV),^PS(53.1,"ACX",+PREV) Q
"RTN","PSJOEA1",59,0)
 ..S PSJCOMV=1
"RTN","PSJOEA1",60,0)
 .I $P(^TMP("PSJCOM",$J,PSJO,0),"^",9)'="A",'$D(^TMP("PSJCOM2",$J,PSJO,0)) S PSJCOMV=1 Q
"RTN","PSJOEA1",61,0)
 .I $P($G(^TMP("PSJCOM2",$J,PSJO,0)),"^",4)="U",$P(^TMP("PSJCOM",$J,PSJO,0),"^",9)'="A",$P($G(^TMP("PSJCOM2",$J,PSJO,0)),"^",9)'="A" S PSJCOMV=1 Q
"RTN","PSJOEA1",62,0)
 .I $P($G(^TMP("PSJCOM2",$J,PSJO,0)),"^",4)'="U",$P(^TMP("PSJCOM",$J,PSJO,0),"^",9)'="A",$P($G(^TMP("PSJCOM2",$J,PSJO,0)),"^",17)'="A" S PSJCOMV=1
"RTN","PSJOEA1",63,0)
 I ($G(COMQUIT)=2)!(($G(COMQUIT)!PSJCOMV)&$G(^TMP("PSJCOM",$J))="A") K ^TMP("PSJCOM",$J),^TMP("PSJCOM2",$J) W !,"By not verifying all the orders, none of the orders will be verified." D PAUSE^VALM1 Q
"RTN","PSJOEA1",64,0)
 ; 
"RTN","PSJOEA1",65,0)
 D CHK^PSJOEA2
"RTN","PSJOEA1",66,0)
 Q
"VER")
8.0^22.2
"BLD",11330,6)
^328
**END**
**END**

