Released PSJ*5*329 SEQ #286
Extracted from mail message
**KIDS**:PSJ*5.0*329^

**INSTALL NAME**
PSJ*5.0*329
"BLD",10312,0)
PSJ*5.0*329^INPATIENT MEDICATIONS^0^3161005^y
"BLD",10312,1,0)
^^4^4^3160719^
"BLD",10312,1,1,0)
This patch will resolve the following issues:
"BLD",10312,1,2,0)
1)  Invalid IV type allowed
"BLD",10312,1,3,0)
2)  Incorrect orderable item displayed after edit
"BLD",10312,1,4,0)
3)  Vista mail shows "D" and should be "DA" for Auto Discontinue
"BLD",10312,4,0)
^9.64PA^^
"BLD",10312,6.3)
4
"BLD",10312,"KRN",0)
^9.67PA^779.2^20
"BLD",10312,"KRN",.4,0)
.4
"BLD",10312,"KRN",.401,0)
.401
"BLD",10312,"KRN",.402,0)
.402
"BLD",10312,"KRN",.403,0)
.403
"BLD",10312,"KRN",.5,0)
.5
"BLD",10312,"KRN",.84,0)
.84
"BLD",10312,"KRN",3.6,0)
3.6
"BLD",10312,"KRN",3.8,0)
3.8
"BLD",10312,"KRN",9.2,0)
9.2
"BLD",10312,"KRN",9.8,0)
9.8
"BLD",10312,"KRN",9.8,"NM",0)
^9.68A^3^3
"BLD",10312,"KRN",9.8,"NM",1,0)
PSIVORE^^0^B44897670
"BLD",10312,"KRN",9.8,"NM",2,0)
PSIVORE2^^0^B15080071
"BLD",10312,"KRN",9.8,"NM",3,0)
PSJLMUT1^^0^B74824116
"BLD",10312,"KRN",9.8,"NM","B","PSIVORE",1)

"BLD",10312,"KRN",9.8,"NM","B","PSIVORE2",2)

"BLD",10312,"KRN",9.8,"NM","B","PSJLMUT1",3)

"BLD",10312,"KRN",19,0)
19
"BLD",10312,"KRN",19.1,0)
19.1
"BLD",10312,"KRN",101,0)
101
"BLD",10312,"KRN",409.61,0)
409.61
"BLD",10312,"KRN",771,0)
771
"BLD",10312,"KRN",779.2,0)
779.2
"BLD",10312,"KRN",870,0)
870
"BLD",10312,"KRN",8989.51,0)
8989.51
"BLD",10312,"KRN",8989.52,0)
8989.52
"BLD",10312,"KRN",8994,0)
8994
"BLD",10312,"KRN","B",.4,.4)

"BLD",10312,"KRN","B",.401,.401)

"BLD",10312,"KRN","B",.402,.402)

"BLD",10312,"KRN","B",.403,.403)

"BLD",10312,"KRN","B",.5,.5)

"BLD",10312,"KRN","B",.84,.84)

"BLD",10312,"KRN","B",3.6,3.6)

"BLD",10312,"KRN","B",3.8,3.8)

"BLD",10312,"KRN","B",9.2,9.2)

"BLD",10312,"KRN","B",9.8,9.8)

"BLD",10312,"KRN","B",19,19)

"BLD",10312,"KRN","B",19.1,19.1)

"BLD",10312,"KRN","B",101,101)

"BLD",10312,"KRN","B",409.61,409.61)

"BLD",10312,"KRN","B",771,771)

"BLD",10312,"KRN","B",779.2,779.2)

"BLD",10312,"KRN","B",870,870)

"BLD",10312,"KRN","B",8989.51,8989.51)

"BLD",10312,"KRN","B",8989.52,8989.52)

"BLD",10312,"KRN","B",8994,8994)

"BLD",10312,"QDEF")
^^^^NO^^^^^^NO
"BLD",10312,"QUES",0)
^9.62^^
"BLD",10312,"REQB",0)
^9.611^2^2
"BLD",10312,"REQB",1,0)
PSJ*5.0*281^2
"BLD",10312,"REQB",2,0)
PSJ*5.0*290^2
"BLD",10312,"REQB","B","PSJ*5.0*281",1)

"BLD",10312,"REQB","B","PSJ*5.0*290",2)

"MBREQ")
0
"PKG",471,-1)
1^1
"PKG",471,0)
INPATIENT MEDICATIONS^PSJ^UNIT DOSE AND IVS
"PKG",471,20,0)
^9.402P^^
"PKG",471,22,0)
^9.49I^1^1
"PKG",471,22,1,0)
5.0^2971215^2990325^66481
"PKG",471,22,1,"PAH",1,0)
329^3161005
"PKG",471,22,1,"PAH",1,1,0)
^^4^4^3161005
"PKG",471,22,1,"PAH",1,1,1,0)
This patch will resolve the following issues:
"PKG",471,22,1,"PAH",1,1,2,0)
1)  Invalid IV type allowed
"PKG",471,22,1,"PAH",1,1,3,0)
2)  Incorrect orderable item displayed after edit
"PKG",471,22,1,"PAH",1,1,4,0)
3)  Vista mail shows "D" and should be "DA" for Auto Discontinue
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
3
"RTN","PSIVORE")
0^1^B44897670^B44481597
"RTN","PSIVORE",1,0)
PSIVORE ;BIR/PR,MLM - ORDER ENTRY ;1 APR 08 / 2:37 PM
"RTN","PSIVORE",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**18,29,50,56,58,81,110,127,133,157,203,213,181,252,305,281,329**;16 DEC 97;Build 4
"RTN","PSIVORE",3,0)
 ;
"RTN","PSIVORE",4,0)
 ; Reference to ^PS(55 is supported by DBIA 2191
"RTN","PSIVORE",5,0)
 ; Reference to ^ORX2 is supported by DBIA #867
"RTN","PSIVORE",6,0)
 ; Reference to ^PSSLOCK is supported by DBIA #2789
"RTN","PSIVORE",7,0)
 ; Reference to ^DICN is supported by DBIA #10009.
"RTN","PSIVORE",8,0)
 ; Reference to ^DIR is supported by DBIA #10026.
"RTN","PSIVORE",9,0)
 ; Reference to EN^VALM is supported by DBIA #10118.
"RTN","PSIVORE",10,0)
 ; Reference to ^VADPT is supported by DBIA #10061.
"RTN","PSIVORE",11,0)
 ; Reference to ^DD("DD" is supported by DBIA #999.
"RTN","PSIVORE",12,0)
 ; Reference to ^TMP("PSODAOC",$J is supported by #DBIA 6071.
"RTN","PSIVORE",13,0)
 ;
"RTN","PSIVORE",14,0)
 N PSJNEW,PSJOUT,PSGPTMP,PPAGE,FLAG S PSJNEW=1
"RTN","PSIVORE",15,0)
 ;
"RTN","PSIVORE",16,0)
 D SITE Q:'$G(PSIVQ)  K PSIVQ S PSGOP=""
"RTN","PSIVORE",17,0)
 ;
"RTN","PSIVORE",18,0)
BEG ;Get patient and make sure he is living.
"RTN","PSIVORE",19,0)
 L +^PS(53.45,DUZ):1 E  D LOCKERR^PSJOE G Q
"RTN","PSIVORE",20,0)
 ;* F  K WSCHADM S PSGPTMP=0,PPAGE=1 D ENGETP^PSIV Q:DFN<0  D ASK
"RTN","PSIVORE",21,0)
 ;* F  K WSCHADM S PSGPTMP=0,PPAGE=1 D ENGETP^PSIV Q:DFN<0  S X=DFN_";DPT(" D LK^ORX2 Q:'Y  D ASK S X=DFN_";DPT(" D ULK^ORX2
"RTN","PSIVORE",22,0)
 NEW PSJLK
"RTN","PSIVORE",23,0)
 F  K WSCHADM S PSGPTMP=0,PPAGE=1 D ENGETP^PSIV Q:DFN<0  S PSJLK='$$L^PSSLOCK(DFN,1) Q:PSJLK  D ASK,UL^PSSLOCK(DFN)
"RTN","PSIVORE",24,0)
 I PSGOP,$P(PSJSYSL,"^",2)]"" D ENQL^PSGLW
"RTN","PSIVORE",25,0)
 G Q
"RTN","PSIVORE",26,0)
 ;
"RTN","PSIVORE",27,0)
ASK ;See if patient has been admitted.
"RTN","PSIVORE",28,0)
 I VADM(6) W !?5,"Patient has died." Q
"RTN","PSIVORE",29,0)
 I 'VAIN(4) K DIK S DIR(0)="Y",DIR("A")="Do you wish to continue",DIR("B")="NO",DIR("??")="^S HELP=""ADMYN"" D ^PSIVHLP1" W !,"This patient has not been admitted." D ^DIR K DIR Q:'Y
"RTN","PSIVORE",30,0)
 S:VAIN(4) WSCHADM=+VAIN(4)
"RTN","PSIVORE",31,0)
 ;
"RTN","PSIVORE",32,0)
SETN ;Set up patient 0 node if needed.
"RTN","PSIVORE",33,0)
 I '$D(^PS(55,DFN,0)) K DO,DA,DD,DIC,PSIVFN S:$D(^(5.1)) PSIVFN=^(5.1) K:$D(PSIVFN) ^(5.1) S (DINUM,X)=DFN,DIC(0)="L",DIC="^PS(55," D FILE^DICN S:$D(PSIVFN) ^PS(55,DFN,5.1)=PSIVFN D  K DIC,PSIVFN,DO,DA,DD,DINUM
"RTN","PSIVORE",34,0)
 .; Mark PSJ and PSO as converted
"RTN","PSIVORE",35,0)
 .S $P(^PS(55,DFN,5.1),"^",11)=2
"RTN","PSIVORE",36,0)
 S PSJNARC=1
"RTN","PSIVORE",37,0)
 S PSGP=DFN,PSJPWD=+VAIN(4),PSIVAC="P",PSIVBR="D ^PSIVOPT" D HK,ENCHS1^PSIV Q:'$D(DFN)
"RTN","PSIVORE",38,0)
 Q
"RTN","PSIVORE",39,0)
 ;
"RTN","PSIVORE",40,0)
NEW ;Ask to enter new order.
"RTN","PSIVORE",41,0)
 D:'$D(VADM(1)) DEM^VADPT
"RTN","PSIVORE",42,0)
 K P,PSIVCHG,PSIVTYPE,PSJOE,DIR S DIR(0)="Y",DIR("A")="New order for "_VADM(1),DIR("B")="YES",DIR("??")="^S HELP=""NEWORD"" D ^PSIVHLP" D ^DIR K DIR Q:'Y
"RTN","PSIVORE",43,0)
 NEW X S X=DFN_";DPT(" D LK^ORX2 Q:'Y  S PSJLSORX=1
"RTN","PSIVORE",44,0)
INMED K ON55,PSJOUT S (P(4),P("OT"),P("FRES"))="" D NEW55^PSIVORFB I '$D(ON55) D ULK G:'$D(PSJOE)&('$D(PSJOUT)) NEW G Q
"RTN","PSIVORE",45,0)
 NEW PSJOCFG
"RTN","PSIVORE",46,0)
 S PSJOCFG="NEW OE IV"
"RTN","PSIVORE",47,0)
 S P("RES")="N",PSIVAC="PN",P("PON")=ON55,PSIVUP=+$$GTPCI^PSIVUTL D NEW^PSIVORE2 I $G(P(2))="" D DEL55^PSIVORE2 D ULK G:'$D(PSJOE) NEW Q
"RTN","PSIVORE",48,0)
 D OK L -^PS(55,DFN,"IV",+ON55) D ULK K PSJOCFG G:'$D(PSJOE) NEW
"RTN","PSIVORE",49,0)
 ;
"RTN","PSIVORE",50,0)
Q ; Kill and exit.
"RTN","PSIVORE",51,0)
 L:'$D(PSJOE) -^PS(53.45,DUZ) S PSJNKF=1 D Q^PSIV
"RTN","PSIVORE",52,0)
 K FIL,I1,ND,PC,PDM,PSGDT,PSGID,PSGLMT,PSGSI,PSJNARC,PSIVAC,PSIVCHG,PSIVUP,PSIVX,PSJOPC
"RTN","PSIVORE",53,0)
 Q
"RTN","PSIVORE",54,0)
 ;
"RTN","PSIVORE",55,0)
ULK ;
"RTN","PSIVORE",56,0)
 Q:'$G(PSJLSORX)  ;If NEW^PSIVORE did not lock, don't kill it here.
"RTN","PSIVORE",57,0)
 NEW X S X=DFN_";DPT(" D ULK^ORX2 K PSJLSORX
"RTN","PSIVORE",58,0)
 Q
"RTN","PSIVORE",59,0)
HK ;Queue job to print MAR labels generated for this patient.
"RTN","PSIVORE",60,0)
 I PSGOP,PSGOP'=DFN D
"RTN","PSIVORE",61,0)
 .N PSJACPF,PSJACNWP,PSJPWD,PSJSYSL,PSJSYSW,PSJSYSW0,DFN,VAIN,VAERR S DFN=PSGOP
"RTN","PSIVORE",62,0)
 .D INP^VADPT S PSJPWD=+VAIN(4) I PSJPWD S PSJACPF=10 S PSJACPF=10 D WP^PSJAC D:$P(PSJSYSL,U,2)]"" ENQL^PSGLW
"RTN","PSIVORE",63,0)
 S PSGOP=DFN
"RTN","PSIVORE",64,0)
 Q
"RTN","PSIVORE",65,0)
 ;
"RTN","PSIVORE",66,0)
SITE ;See if site parameters are ok.
"RTN","PSIVORE",67,0)
 K PSIVQ D ^PSIVXU Q:$D(XQUIT)
"RTN","PSIVORE",68,0)
 I '$D(PSIVSN)!('$D(PSIVSITE)) W $C(7),$C(7),!!,"You have no IV ROOM parameters ... PLEASE ... PLEASE ...",!,"Exit this package and reenter properly !!",!! Q
"RTN","PSIVORE",69,0)
 D ORPARM^PSIVOREN S PSIVQ=1
"RTN","PSIVORE",70,0)
 Q
"RTN","PSIVORE",71,0)
 ;
"RTN","PSIVORE",72,0)
OK ;Print example label, run order through checker, ask if it is ok.
"RTN","PSIVORE",73,0)
 S P16=0,PSIVEXAM=1,(PSIVNOL,PSIVCT)=1 D GTOT^PSIVUTL(P(4)) I $G(P("PD"))="" D GTPD^PSIVORE2
"RTN","PSIVORE",74,0)
 D ^PSIVCHK I $D(DUOUT) S X="^" G DOA
"RTN","PSIVORE",75,0)
 I ERR=1 S X="N" G BAD
"RTN","PSIVORE",76,0)
 W ! D ^PSIVORLB K PSIVEXAM S Y=P(2) W !,"Start date: " X ^DD("DD") W $P(Y,"@")," ",$P(Y,"@",2),?30," Stop date: " S Y=P(3) X ^DD("DD") W $P(Y,"@")," ",$P(Y,"@",2),!
"RTN","PSIVORE",77,0)
 ;PSJ*5*157 EFD for IVs
"RTN","PSIVORE",78,0)
 D EFDIV^PSJUTL($G(ZZND))
"RTN","PSIVORE",79,0)
 D:'$G(PSGORQF) IN^PSJOCDS($G(ON55),"IV","") I $G(PSGORQF) D DEL55 Q
"RTN","PSIVORE",80,0)
 W:$G(PSIVCHG) !,"*** This change will cause a new order to be created. ***"
"RTN","PSIVORE",81,0)
 I '$G(PSIVCOPY) G:PSIVAC["R" OK1 S X="Is this O.K.: ^"_$S(ERR:"NO",1:"YES")_"^^NO"_$S(ERR'=1:",YES",1:"") D ENQ^PSIV
"RTN","PSIVORE",82,0)
 S PSJIVBD=1 ;var use to indicate order enter from back door
"RTN","PSIVORE",83,0)
BAD ;; I X["N" D GSTRING^PSIVORE1,^PSIVORV2,GTFLDS^PSIVORFE G OK
"RTN","PSIVORE",84,0)
 I ON55["V",($G(P(21))="") S P(17)="N"
"RTN","PSIVORE",85,0)
 I X["N" NEW PSGEBN,PSGLI S (P("INS"),PSGEBN,PSGLI)="",(PSJORD,ON)=ON55 D EN^VALM("PSJ LM IV AC/EDIT") S VALMBCK="Q" Q
"RTN","PSIVORE",86,0)
 I X["?" S HELP="OK" D ^PSIVHLP G OK
"RTN","PSIVORE",87,0)
DOA I X["^" D DEL55^PSIVORE2 Q
"RTN","PSIVORE",88,0)
 Q:$$NONVF("SN")
"RTN","PSIVORE",89,0)
OK1 S PSJORL=$$ENORL^PSJUTL($G(VAIN(4))),P(17)="A",ORSTS=6,ON=ON55,PSJORNP=+P(6)
"RTN","PSIVORE",90,0)
 D:'$D(PSJIVORF) ORPARM^PSIVOREN
"RTN","PSIVORE",91,0)
 I PSJIVORF D NATURE^PSIVOREN I '$D(P("NAT")) D DEL55^PSIVORE2 Q
"RTN","PSIVORE",92,0)
 D SET55^PSIVORFB
"RTN","PSIVORE",93,0)
 I PSJIVORF,($G(P(22))=.5) D CLINIC^PSIVOREN
"RTN","PSIVORE",94,0)
 I PSJIVORF D SET^PSIVORFE S ORNATR=P("NAT"),ON=+ON55,OD=P(2) D EN1^PSJHL2(DFN,"SN",+ON55_"V","SEND ORDER NUMBER") ;,EN1^PSJHL2(DFN,"SC",+ON55_"V","NEW ORDER CREATED")
"RTN","PSIVORE",95,0)
 D VF1^PSJLIACT("V","ORDER ENTERED AS ACTIVE BY ",1)
"RTN","PSIVORE",96,0)
 D ENLBL^PSIVOPT(2,DUZ,DFN,3,+ON55,"N")
"RTN","PSIVORE",97,0)
 ;
"RTN","PSIVORE",98,0)
CAL ;Calculate doses.
"RTN","PSIVORE",99,0)
 ;S OD=P(2) D EN,^PSIVORE1,^PSIVOPT
"RTN","PSIVORE",100,0)
 S OD=P(2) D EN,^PSIVOPT
"RTN","PSIVORE",101,0)
 Q
"RTN","PSIVORE",102,0)
 ;
"RTN","PSIVORE",103,0)
EN ;Update schedule interval P(15) only on continuous orders.
"RTN","PSIVORE",104,0)
 ;This includes Hyp/Adm/Continuous Syringes/Chemos =>P(5)=0
"RTN","PSIVORE",105,0)
 Q:'$D(DFN)!('$D(ON55))  Q:$P(^PS(55,DFN,"IV",+ON55,0),U,4)="P"!($P(^(0),U,5))!($P(^(0),U,23)="P")
"RTN","PSIVORE",106,0)
 D SPSOL S XXX=$P(^PS(55,DFN,"IV",+ON55,0),U,8) G:'SPSOL ENQ I XXX?1N.N.1".".N1" ml/hr"!(XXX?1"0."1N1" ml/hr") S P(15)=$S('XXX:0,1:SPSOL\XXX*60+(SPSOL#XXX/XXX*60+.5)\1),$P(^PS(55,DFN,"IV",+ON55,0),U,15)=P(15) G ENQ
"RTN","PSIVORE",107,0)
 S P(15)=$S('$P(XXX,"@",2):0,1:1440/$P(XXX,"@",2)\1),$P(^PS(55,DFN,"IV",+ON55,0),U,15)=P(15)
"RTN","PSIVORE",108,0)
ENQ K SPSOL,XXX Q
"RTN","PSIVORE",109,0)
SPSOL S SPSOL=0 F XXX=0:0 S XXX=$O(^PS(55,DFN,"IV",+ON55,"SOL",XXX)) Q:'XXX  S SPSOL=SPSOL+$P(^(XXX,0),U,2)
"RTN","PSIVORE",110,0)
 K XXX Q
"RTN","PSIVORE",111,0)
ENIN ;Entry for Combined IV/UD order entry. Called by PSJOE0.
"RTN","PSIVORE",112,0)
 D HOLDHDR^PSJOE
"RTN","PSIVORE",113,0)
 W !
"RTN","PSIVORE",114,0)
 N PSJOUT S (DONE,FLAG)=0,PSIVAC="PN"
"RTN","PSIVORE",115,0)
ENIN1 ;
"RTN","PSIVORE",116,0)
 ;*305
"RTN","PSIVORE",117,0)
 N DA,DIR,PSJOE,PSJPCAF,PSJSYSL,WSCHADM,PSJALLGY,PSJEXMSG S:$G(VAIN(4)) WSCHADM=VAIN(4)
"RTN","PSIVORE",118,0)
 K P,PSIVCHG,PSJCOM,^TMP("PSODAOC",$J)
"RTN","PSIVORE",119,0)
 S PSJOE=1,DIR(0)="55.01,.04O",DIR("A")="Select IV TYPE" D ^DIR
"RTN","PSIVORE",120,0)
 I X]"",X'="^",$P("^PROFILE",X)="" S PSJOEPF=X Q
"RTN","PSIVORE",121,0)
 I X="^" S PSJOEPF=X Q
"RTN","PSIVORE",122,0)
 G:X["^" ENIN1
"RTN","PSIVORE",123,0)
 S:$D(DTOUT) X="^" I "^"[X S PSJORQF=PSJORQF+$S(X="^":2,$G(FLAG):0,1:1),X="." Q
"RTN","PSIVORE",124,0)
 S FLAG=1,PSIVTYPE=Y,(P(5),P(23))="" I "SC"[Y D @(Y_"^PSIVORC1") S $P(PSIVTYPE,U,2)=P(23)
"RTN","PSIVORE",125,0)
 D INMED G:'$D(PSJOUT) ENIN S:$D(PSJOUT) PSJORQF=2
"RTN","PSIVORE",126,0)
 Q
"RTN","PSIVORE",127,0)
NONVF(PSJOC)  ;If file at NonVF then quit with 1
"RTN","PSIVORE",128,0)
 NEW PSGOEAV S PSGOEAV=+$P(PSJSYSP0,U,9)
"RTN","PSIVORE",129,0)
 I +PSJSYSU=3,PSGOEAV Q 0
"RTN","PSIVORE",130,0)
 I +PSJSYSU=1,PSGOEAV Q 0
"RTN","PSIVORE",131,0)
 K DA D ENGNN^PSGOETO S ON=DA_"P",P(17)="N",P("REN")=0
"RTN","PSIVORE",132,0)
 D GTPD^PSIVORE2
"RTN","PSIVORE",133,0)
 D NATURE^PSIVOREN I '$D(P("NAT")) D:ON55["V" DEL55 Q 1
"RTN","PSIVORE",134,0)
 D:$G(VAIN(4))="" CLINIC^PSIVOREN
"RTN","PSIVORE",135,0)
 W !,"...transcribing this non-verified order...."
"RTN","PSIVORE",136,0)
 D PUT531^PSIVORFA
"RTN","PSIVORE",137,0)
 D:$G(PSJOC)]"" EN1^PSJHL2(DFN,PSJOC,ON,"SEND ORDER NUMBER")
"RTN","PSIVORE",138,0)
 ;RTC 178746 - Don't store allergy here
"RTN","PSIVORE",139,0)
 ;D SETOC^PSJNEWOC(ON)
"RTN","PSIVORE",140,0)
 D:ON55["V" DEL55
"RTN","PSIVORE",141,0)
 NEW PSJORD S (ON55,PSJORD)=ON
"RTN","PSIVORE",142,0)
 D VF^PSIVORC2
"RTN","PSIVORE",143,0)
 Q 1
"RTN","PSIVORE",144,0)
DEL55 ;
"RTN","PSIVORE",145,0)
 Q:ON55["P"
"RTN","PSIVORE",146,0)
 S X=$G(^PS(55,DFN,"IV",+ON55,0))
"RTN","PSIVORE",147,0)
 I $P(X,U,21)]"",($G(^PS(55,DFN,"IV",+ON55,2))]"") S $P(^(2),U,6)=ON,$P(^PS(53.1,+ON,0),U,25)=ON55 Q
"RTN","PSIVORE",148,0)
 NEW PSIVORFA S PSIVORFA=1
"RTN","PSIVORE",149,0)
 D DEL55^PSIVORE2
"RTN","PSIVORE",150,0)
 Q 
"RTN","PSIVORE2")
0^2^B15080071^B15145270
"RTN","PSIVORE2",1,0)
PSIVORE2 ;BIR/RGY,PR,MLM - ACT, NEW ORDER (CONT. OF PSIVORE1) ; 8/8/08 10:57am
"RTN","PSIVORE2",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**21,58,101,244,290,329**;16 DEC 97;Build 4
"RTN","PSIVORE2",3,0)
 ;
"RTN","PSIVORE2",4,0)
 ; References to ^PS(55 supported by DBIA #2191.
"RTN","PSIVORE2",5,0)
 ;
"RTN","PSIVORE2",6,0)
DEQ ;
"RTN","PSIVORE2",7,0)
 S P(4)=$P(^PS(55,DFN,"IV",+ON,0),U,4),ACTION=1,TRACK=4 D ^PSIVLTR D ^PSIVHYPL:P(4)="H",^PSIVLABL:P(4)'="H"
"RTN","PSIVORE2",8,0)
K ;
"RTN","PSIVORE2",9,0)
 S:$D(ZTQUEUED) ZTREQ="@" K PSIVMI,PSI,OD,PSIVEC,PSIVSC,I,PSIVNOL,PSIV1,PSIVA,PSIVDOSE,PSGCNT,PSGSA,PSCT,PDOSE,PDATE,PSIVLABN,UP1,PLAST Q
"RTN","PSIVORE2",10,0)
TL ;
"RTN","PSIVORE2",11,0)
 W ! F X=3:3:24 W "       ",$S($L(X)=1:" ",1:""),X
"RTN","PSIVORE2",12,0)
 W ! F X=1:1:24 W "..:"
"RTN","PSIVORE2",13,0)
 K PSI F X=0:0 S X=$O(^PS(59.5,PSIVSN,2,"AC",P(4),X)) Q:'X  S PSI(+("."_$P(^PS(59.5,PSIVSN,2,X,0),U)))=$S($P($P(^(0),U,6),".")=DT:"*",1:"")
"RTN","PSIVORE2",14,0)
 S PSI=P(4) D TL1
"RTN","PSIVORE2",15,0)
 K PSI S:'$D(PSGSA) PSGSA="" F PSI=1:1 S X=$P(PSGSA," ",PSI) Q:X=""  I X S PSI(X#1)=""
"RTN","PSIVORE2",16,0)
 S PSI="^" D TL1
"RTN","PSIVORE2",17,0)
 D NOW^%DTC S Y=% S PSI(Y#1)="",PSI="N" D TL1 Q
"RTN","PSIVORE2",18,0)
TL1 ;
"RTN","PSIVORE2",19,0)
 W ! S Y="" F X=0:0 S Y=$O(PSI(Y)) Q:'Y  W ?3*$E(Y_"000",2,3)-1+$S($E(Y_"000",4,5)>40:2,$E(Y_"000",4,5)>20:1,1:0),PSI,PSI(Y)
"RTN","PSIVORE2",20,0)
 K PSI Q
"RTN","PSIVORE2",21,0)
C ;
"RTN","PSIVORE2",22,0)
 S SNM=0 F DAT=0:0 S DAT=$O(^PS(55,"PSIVSUS",PSIVSN,DFN,+ON,DAT)) Q:'DAT  S SNM=SNM+$P(^(DAT),U)
"RTN","PSIVORE2",23,0)
 Q
"RTN","PSIVORE2",24,0)
 ;
"RTN","PSIVORE2",25,0)
CONVER(X,Y) ;
"RTN","PSIVORE2",26,0)
 ;***$$FMADD^XLFDT(DT.HH,D,H,M,S) returns the DT.HH+(D,H,M,S)
"RTN","PSIVORE2",27,0)
 ;*I +P(15)>1440 S X=$$FMADD^XLFDT($P(PSGSA," "),"","",(P(15)*(Y-1))) Q X
"RTN","PSIVORE2",28,0)
 I +P(15)>1440 S X=$$CONVER1($P(PSGSA," "),P(15),(Y-1)) Q X
"RTN","PSIVORE2",29,0)
 S PDOSE=X S:Y=2 PDATE=$E($P(PSGSA," "),1,7)
"RTN","PSIVORE2",30,0)
 I $P(PSGSA," ",Y-1)#1'<PDOSE!(P(15)>1440) S X1=PDATE,X2=1 D C^%DTC S PDATE=X,X=X_PDOSE Q X
"RTN","PSIVORE2",31,0)
 S X=PDATE_PDOSE
"RTN","PSIVORE2",32,0)
 Q X
"RTN","PSIVORE2",33,0)
 ;
"RTN","PSIVORE2",34,0)
CONVER1(ORDDT,X,Y)       ;
"RTN","PSIVORE2",35,0)
 ;* This sub-routine is necessary when a schedule such as q36h was
"RTN","PSIVORE2",36,0)
 ;* entered and the Start date is such as T-3@1200.  Without these codes
"RTN","PSIVORE2",37,0)
 ;* instead of schedule due for T@2400 it will display as T+1@0000.
"RTN","PSIVORE2",38,0)
 NEW DAYS,MINS S (DAYS,MINS)=0
"RTN","PSIVORE2",39,0)
 S DAYS=(X*Y)\1440,MINS=(X*Y)#1440
"RTN","PSIVORE2",40,0)
 S X=$$FMADD^XLFDT(ORDDT,DAYS,"",MINS)
"RTN","PSIVORE2",41,0)
 Q X
"RTN","PSIVORE2",42,0)
 ;
"RTN","PSIVORE2",43,0)
INCOMP ; Delete order missing critical information.
"RTN","PSIVORE2",44,0)
 N DIR,PSIVAC W !!,$C(7),"THIS ORDER IS NOT USABLE!",!,"Enter ""D"" to Delete, or ""B"" to Bypass",!
"RTN","PSIVORE2",45,0)
 S DIR(0)="SOA^D:DELETE;B:BYPASS",DIR("A")="ACTION (B/D): ",DIR("??")="^S HELP=""INCOMP"" D ^PSIVHLP2" D ^DIR K DIR Q:Y="B"!$D(DIRUT)  S PSIVAC="N"
"RTN","PSIVORE2",46,0)
 ;
"RTN","PSIVORE2",47,0)
DEL55 ; Delete order from 55.
"RTN","PSIVORE2",48,0)
 I ON55'["V"!($G(P(21))]"") Q
"RTN","PSIVORE2",49,0)
 I $G(^PS(55,DFN,"IV",+ON55,0))=+ON55 NEW PSIVORFA S PSIVORFA=1 ; P290 If only operating on a stub, do not display status message below
"RTN","PSIVORE2",50,0)
 S DIK="^PS(55,"_DFN_",""IV"",",DA(1)=DFN,DA=+ON55 D ^DIK W:'$G(PSIVORFA) $C(7),"...Order ",$S($E($G(PSIVAC),2)="N":"deleted.",1:"unchanged.")
"RTN","PSIVORE2",51,0)
 N DA,DIK,ORIFN S ORIFN=$P($G(^PS(55,DFN,"IV",+ON55,0)),U,21) I ORIFN,$E($G(PSIVAC),2)="N" D EN1^PSJHL2(DFN,"OD",+ON55_"V","ORDER DELETED")
"RTN","PSIVORE2",52,0)
 L -^PS(55,DFN,"IV",+ON55)
"RTN","PSIVORE2",53,0)
 Q
"RTN","PSIVORE2",54,0)
 ;
"RTN","PSIVORE2",55,0)
NEW ; New order entry
"RTN","PSIVORE2",56,0)
 N ON D NEWENT^PSIVORFE S DRGN="",P("IVRM")=+PSIVSN_U_$P($G(^PS(59.5,+PSIVSN,0)),U) ;*PSJ*5*244 - NEW ON
"RTN","PSIVORE2",57,0)
 K DRG,PSGFDX F X="AD","DRG","LF","LFA","CUM","MR","SOL","OPI","OT","SYRS","REM","SI",2,3,4,5,7,8,9,11,12,15,17,23 S:'$D(P(X)) P(X)=""
"RTN","PSIVORE2",58,0)
 S P(17)="A",P(4)=$E($G(PSIVTYPE)) S:"CS"[P(4) P(23)=$P($G(PSIVTYPE),U,2)
"RTN","PSIVORE2",59,0)
 D:P(4)="" 53^PSIVORC1 Q:$G(P(4))=""  S Y=$P($G(^PS(55,DFN,5.1)),U,2),P(6)=Y_U_$P($G(^VA(200,+Y,0)),U)
"RTN","PSIVORE2",60,0)
 D OTYP^PSIVORC1 S PSIVOK="",EDIT="57^58^59^3"_$S(P("DTYP")=1:"^26^39",1:"")_"^63^64^10^25^1"
"RTN","PSIVORE2",61,0)
 D EDIT^PSIVEDT Q:'$G(P(2))  D GTOT^PSIVUTL(P(4)) D:$G(P("PD"))="" GTPD
"RTN","PSIVORE2",62,0)
 Q
"RTN","PSIVORE2",63,0)
 ;
"RTN","PSIVORE2",64,0)
GTPD ; Find Orderable Item/dosage ordered for IM.
"RTN","PSIVORE2",65,0)
 S P("PD")="" F DRGT="AD","SOL" Q:P("PD")  F DRGI=0:0 S DRGI=$O(DRG(DRGT,DRGI)) Q:'DRGI  D
"RTN","PSIVORE2",66,0)
 . S X=DRG(DRGT,DRGI) S:$P(X,U,6) P("PD")=$P(X,U,6)_U_$$OIDF^PSJLMUT1(+$P(X,U,6))
"RTN","PSIVORE2",67,0)
 . S P("DO")=$P(X,U,3)
"RTN","PSIVORE2",68,0)
 . ;S:$G(P("DO"))="" P("DO")=$P(X,U,3)
"RTN","PSIVORE2",69,0)
 Q
"RTN","PSJLMUT1")
0^3^B74824116^B73799409
"RTN","PSJLMUT1",1,0)
PSJLMUT1 ;BIR/MLM - DRUG NAME DISPLAY ;05 Feb 98  1:39 PM
"RTN","PSJLMUT1",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**4,27,29,49,58,107,110,146,175,201,181,281,329**;16 DEC 97;Build 4
"RTN","PSJLMUT1",3,0)
 ;
"RTN","PSJLMUT1",4,0)
 ; Reference to ^PS(55 is supported by DBIA# 2191.
"RTN","PSJLMUT1",5,0)
 ; Reference to ^PS(50.7 is supported by DBIA# 2180.
"RTN","PSJLMUT1",6,0)
 ; Reference to ^PS(50.606 is supported by DBIA# 2174.
"RTN","PSJLMUT1",7,0)
 ; Reference to EN^PSODRDU2 is supported by DBIA# 2189.
"RTN","PSJLMUT1",8,0)
 ; Reference to ^PSDRUG( is supported by DBIA 2192.
"RTN","PSJLMUT1",9,0)
 ;
"RTN","PSJLMUT1",10,0)
DRGDISP(DFN,ON,NL,GL,NAME,DRUGONLY)       ;
"RTN","PSJLMUT1",11,0)
 ;; DRUGONLY = 1/0 - Only the drug name will be returned.
"RTN","PSJLMUT1",12,0)
 ;; NL       = The drug name display length
"RTN","PSJLMUT1",13,0)
 ;; GL       = The give line display length, total length-6 ("Give: ")
"RTN","PSJLMUT1",14,0)
 ;; NAME(X)  = Drug name and give line in displayable format.
"RTN","PSJLMUT1",15,0)
 ;; ON       = IEN#_U/P (U=Unit Dose; P=Pending)
"RTN","PSJLMUT1",16,0)
 ;
"RTN","PSJLMUT1",17,0)
 NEW F,OIND,MARX,MR,NOTGV,SCH,PSGUPDDO,PSGGV,X,PSGX,PSGINS,DRUGNAME
"RTN","PSJLMUT1",18,0)
 K NAME S PSGINS=""
"RTN","PSJLMUT1",19,0)
 S:ON["U" F="^PS(55,DFN,5,+ON,"
"RTN","PSJLMUT1",20,0)
 I ON["P" S F="^PS(53.1,+ON,",X=$G(@(F_".3)")),PSGINS=$S(X]"":X,1:"")
"RTN","PSJLMUT1",21,0)
 I $G(@(F_"0)"))="" S NAME(1)="NOT FOUND" Q
"RTN","PSJLMUT1",22,0)
 S OIND=$G(@(F_".2)")),PSGUPDDO=$P(OIND,U,2),X=@(F_"0)"),NOTGV=$P(X,U,22),MR=$$ENMRN^PSGMI(+$P(X,U,3))
"RTN","PSJLMUT1",23,0)
 I '+OIND,($P(X,U,4)'="U") NEW DRG D GTDRG^PSIVORFA F X="AD","SOL" Q:+OIND  F PSGX=0:0 S PSGX=$O(DRG(X,PSGX)) Q:'PSGX  S OIND=$P(DRG(X,PSGX),U,6) Q:+OIND
"RTN","PSJLMUT1",24,0)
 S SCH=$P($G(@(F_"2)")),U)
"RTN","PSJLMUT1",25,0)
 I +$O(@(F_"1,0)")),'+$O(@(F_"1,1)")),PSGUPDDO="" D DD(F,.DRUGNAME)
"RTN","PSJLMUT1",26,0)
 S:($G(DRUGNAME)=""!($G(DRUGNAME)["NOT FOUND")) DRUGNAME=$$OIDF(OIND)
"RTN","PSJLMUT1",27,0)
 ;S PSGGV=$S(NOTGV:"*** NOT TO BE GIVEN *** ",1:"")_PSGINS_PSGUPDDO_" "_MR_" "_SCH
"RTN","PSJLMUT1",28,0)
 S PSGGV=$S(NOTGV:"*** NOT TO BE GIVEN *** ",1:"")_$S(('$D(PSJPDDDP)&('$L(PSGUPDDO))):PSGINS,1:PSGUPDDO)_" "_MR_" "_SCH
"RTN","PSJLMUT1",29,0)
 S PSGX=0 K PSJPDDDP
"RTN","PSJLMUT1",30,0)
 D TXT^PSGMUTL(DRUGNAME,NL) F X=0:0 S X=$O(MARX(X)) Q:'X  S NAME(X)=$S(X>1:"  ",1:"")_MARX(X),PSGX=X
"RTN","PSJLMUT1",31,0)
 Q:+DRUGONLY
"RTN","PSJLMUT1",32,0)
 D TXT^PSGMUTL(PSGGV,GL) F X=0:0 S X=$O(MARX(X)) Q:'X  D
"RTN","PSJLMUT1",33,0)
 . I X=1 S NAME(PSGX+X)="Give: "_MARX(X) Q
"RTN","PSJLMUT1",34,0)
 . S NAME(PSGX+X)=$S(X>1:"      ",1:"")_MARX(X)
"RTN","PSJLMUT1",35,0)
 Q
"RTN","PSJLMUT1",36,0)
OIDF(OIND)    ; Return Orderable Item name and Dosage form.
"RTN","PSJLMUT1",37,0)
 ;; +OIND = orderable item IEN
"RTN","PSJLMUT1",38,0)
 NEW X,NAME
"RTN","PSJLMUT1",39,0)
 S X=$G(^PS(50.7,+OIND,0))
"RTN","PSJLMUT1",40,0)
 S:$P(X,U)]"" NAME=$P(X,U)_" "_$P($G(^PS(50.606,+$P(X,U,2),0)),U)
"RTN","PSJLMUT1",41,0)
 Q $S($G(NAME)]"":NAME,1:"NOT FOUND "_+OIND_";PS(50.7")
"RTN","PSJLMUT1",42,0)
 ;
"RTN","PSJLMUT1",43,0)
DD(F,NAME)        ; Return Dispense drug name.
"RTN","PSJLMUT1",44,0)
 ;; F = "^PS(55,DFN,5,+ON," or "^PS(53.1,+ON,"
"RTN","PSJLMUT1",45,0)
 NEW X K NAME
"RTN","PSJLMUT1",46,0)
 S X=$O(@(F_"1,0)")),X=$G(@(F_"1,"_+X_",0)"))
"RTN","PSJLMUT1",47,0)
 I $P(X,U)]"" S NAME=$P($G(^PSDRUG(+X,0)),U)
"RTN","PSJLMUT1",48,0)
 E  S NAME="NOT FOUND "_+X_";PSDRUG"
"RTN","PSJLMUT1",49,0)
 I '$O(@(F_"1,1)")),+$P(X,U,2)>1 S PSGUPDDO=+$P(X,U,2)
"RTN","PSJLMUT1",50,0)
 S PSJPDDDP=1
"RTN","PSJLMUT1",51,0)
 Q
"RTN","PSJLMUT1",52,0)
DSPLORDU(PSGP,ON)   ; Display UD order for order check as in the Inpat Profile.
"RTN","PSJLMUT1",53,0)
 NEW DRUGNAME,F,NODE0,NODE2,PSJID,PSJX,SCH,SD,STAT,X,Y
"RTN","PSJLMUT1",54,0)
 S F=$S(ON["U":"^PS(55,PSGP,5,"_+ON_",",1:"^PS(53.1,"_+ON_",")
"RTN","PSJLMUT1",55,0)
 S NODE0=$G(@(F_"0)")),NODE2=$G(@(F_"2)"))
"RTN","PSJLMUT1",56,0)
 D DRGDISP^PSJLMUT1(PSGP,ON,39,54,.DRUGNAME,0)
"RTN","PSJLMUT1",57,0)
 I ON["P",$P(NODE0,U,4)="F" D DSPLORDV(PSGP,ON) Q
"RTN","PSJLMUT1",58,0)
 S SCH=$P(NODE0,U,7)
"RTN","PSJLMUT1",59,0)
 S STAT=$P(NODE0,U,9) I STAT="A",$P(NODE0,U,27)="R" S STAT="R"
"RTN","PSJLMUT1",60,0)
 I STAT="D" S STAT=$P(NODE0,U,28)
"RTN","PSJLMUT1",61,0)
 I STAT'="P" S PSJID=$E($$ENDTC^PSGMI($P(NODE2,U,2)),1,5),SD=$E($$ENDTC^PSGMI($P(NODE2,U,4)),1,5)
"RTN","PSJLMUT1",62,0)
 I STAT="P" S (PSJID,SD)="*****",SCH="?"
"RTN","PSJLMUT1",63,0)
 F PSJX=0:0 S PSJX=$O(DRUGNAME(PSJX)) Q:'PSJX  D
"RTN","PSJLMUT1",64,0)
 . S:PSJX=1 X=SCH_"  "_PSJID_"  "_SD_"  "_$E(STAT,1,2)
"RTN","PSJLMUT1",65,0)
 . S:PSJX=1 DRUGNAME(1)=$$SETSTR^VALM1(X,$E(DRUGNAME(1),1,40),42,20)
"RTN","PSJLMUT1",66,0)
 . S PSJOC(ON,PSJLINE)="        "_DRUGNAME(PSJX)
"RTN","PSJLMUT1",67,0)
 . S PSJLINE=PSJLINE+1
"RTN","PSJLMUT1",68,0)
 Q
"RTN","PSJLMUT1",69,0)
DSPLORDV(DFN,ON)   ; Display IV order for order check as in the Inpat Profile.
"RTN","PSJLMUT1",70,0)
 N DRG,DRGI,DRGT,DRGX,FIL,ND,ON55,P,PSJIVFLG,PSJORIFN,TYP,X,Y,COMPDRG
"RTN","PSJLMUT1",71,0)
 S TYP="?" I ON["V" D
"RTN","PSJLMUT1",72,0)
 .S Y=$G(^PS(55,DFN,"IV",+ON,0)) F X=2,3,4,5,8,9,17,23 S P(X)=$P(Y,U,X)
"RTN","PSJLMUT1",73,0)
 .S:P(17)="D" P(17)=$P(Y,U,25)
"RTN","PSJLMUT1",74,0)
 .S TYP=$$ONE^PSJBCMA(DFN,ON,P(9),P(2),P(3)) I TYP'="O" S TYP="C"
"RTN","PSJLMUT1",75,0)
 .S ON55=ON,P("OT")=$S(P(4)="A":"F",P(4)="H":"H",1:"I") D GTDRG^PSIVORFB,GTOT^PSIVUTL(P(4))
"RTN","PSJLMUT1",76,0)
 S PSJCT=0,PSJL=""
"RTN","PSJLMUT1",77,0)
 I ON'["V" S (P(2),P(3))="",P(17)=$P($G(^PS(53.1,+ON,0)),U,9),Y=$G(^(8)),P(4)=$P(Y,U),P(8)=$P(Y,U,5),P(9)=$P($G(^(2)),U) D GTDRG^PSIVORFA,GTOT^PSIVUTL(P(4))
"RTN","PSJLMUT1",78,0)
 S PSJIVFLG=1 D PIVAD,SOL
"RTN","PSJLMUT1",79,0)
 Q
"RTN","PSJLMUT1",80,0)
SOL ;
"RTN","PSJLMUT1",81,0)
 S PSJL=$S($G(PSJIVFLG):PSJL,1:"")_"         in"
"RTN","PSJLMUT1",82,0)
 S DRG=0 F  S DRG=+$O(DRG("SOL",DRG)) Q:'DRG  D NAME^PSIVUTL(DRG("SOL",DRG),37,.NAME,0) S DRGX=0 F  S DRGX=$O(NAME(DRGX)) Q:'DRGX  D
"RTN","PSJLMUT1",83,0)
 .S COMPDRG="",COMPDRG=$P(DRG("SOL",DRG),"^",2)_" "_$P(DRG("SOL",DRG),"^",3)
"RTN","PSJLMUT1",84,0)
 .I PSJL["   in" D
"RTN","PSJLMUT1",85,0)
 ..I $D(PSJP(2)),COMPDRG=PSJP(2) S NAME(DRGX)="*"_NAME(DRGX) Q
"RTN","PSJLMUT1",86,0)
 ..I $D(PSJOCDT(10,COMPDRG))!($D(PSJOCDT(20,COMPDRG))) D  Q  ;PSJ*5*281 - identify the interacting drugs with an *
"RTN","PSJLMUT1",87,0)
 ...S NAME(DRGX)="*"_NAME(DRGX) Q
"RTN","PSJLMUT1",88,0)
 .I PSJL'["   in" S NAME(DRGX)=NAME(DRGX)
"RTN","PSJLMUT1",89,0)
 .S PSJL=$$SETSTR^VALM1(NAME(DRGX),PSJL,13,60) D:$G(PSJIVFLG) PIV1 D SETTMP S PSJL="       "
"RTN","PSJLMUT1",90,0)
 Q
"RTN","PSJLMUT1",91,0)
PIVAD ; Print IV Additives.
"RTN","PSJLMUT1",92,0)
 F DRG=0:0 S DRG=$O(DRG("AD",DRG)) Q:'DRG  D NAME^PSIVUTL(DRG("AD",DRG),39,.NAME,1) F DRGX=0:0 S DRGX=$O(NAME(DRGX)) Q:'DRGX  D
"RTN","PSJLMUT1",93,0)
 .D  ;PSJ*5*281 - identify the interacting drugs with an *
"RTN","PSJLMUT1",94,0)
 ..I $D(PSJP(2)),NAME(DRGX)=PSJP(2) S NAME(DRGX)="*"_NAME(DRGX) Q
"RTN","PSJLMUT1",95,0)
 ..I $D(PSJOCDT(10,NAME(DRGX)))!($D(PSJOCDT(20,NAME(DRGX)))) S NAME(DRGX)="*"_NAME(DRGX) Q
"RTN","PSJLMUT1",96,0)
 ..S NAME(DRGX)=" "_NAME(DRGX)
"RTN","PSJLMUT1",97,0)
 .S PSJL=$$SETSTR^VALM1(NAME(DRGX),PSJL,9,60) D:$G(PSJIVFLG) PIV1 D SETTMP
"RTN","PSJLMUT1",98,0)
 Q
"RTN","PSJLMUT1",99,0)
 ;
"RTN","PSJLMUT1",100,0)
PIV1 ; Print Sched type, start/stop dates, and status.
"RTN","PSJLMUT1",101,0)
 K PSJIVFLG
"RTN","PSJLMUT1",102,0)
 F X=2,3 S P(X)=$E($$ENDTC^PSGMI(P(X)),1,$S($D(PSJEXTP):8,1:5))
"RTN","PSJLMUT1",103,0)
 I '$D(PSJEXTP) S PSJL=$$SETSTR^VALM1(TYP,PSJL,50,1),PSJL=$$SETSTR^VALM1(P(2),PSJL,53,7),PSJL=$$SETSTR^VALM1(P(3),PSJL,60,7),PSJL=$$SETSTR^VALM1(P(17),PSJL,67,2)
"RTN","PSJLMUT1",104,0)
 E  S PSJL=$$SETSTR^VALM1(TYP,PSJL,50,1),PSJL=$$SETSTR^VALM1(P(2),53,7),PSJL=$$SETSTR^VALM1(P(3),PSJL,63,7),PSJL=$$SETSTR^VALM1(P(17),PSJL,73,2)
"RTN","PSJLMUT1",105,0)
 Q
"RTN","PSJLMUT1",106,0)
SETTMP ;
"RTN","PSJLMUT1",107,0)
 S PSJOC(ON,PSJLINE)=PSJL,PSJLINE=PSJLINE+1
"RTN","PSJLMUT1",108,0)
 Q
"RTN","PSJLMUT1",109,0)
ORDCHK(DFN,TYPE,PIECE)   ;
"RTN","PSJLMUT1",110,0)
 ;TYPE ="DD" - Duplicate drug
"RTN","PSJLMUT1",111,0)
 ;     ="DC" - Duplicate class
"RTN","PSJLMUT1",112,0)
 ;     -"DI" - Drug Interaction
"RTN","PSJLMUT1",113,0)
 ;PIECE = The piece order number is return from ^TMP($J,"DD"...
"RTN","PSJLMUT1",114,0)
 ;PSJOC(ON,x) = Array of inpatient orders to be displayed
"RTN","PSJLMUT1",115,0)
 ;
"RTN","PSJLMUT1",116,0)
 NEW ON,PSJL,PSIVX,PSJOC,PSJORIEN,PSJPACK,PSJLINE
"RTN","PSJLMUT1",117,0)
 S PSJOC=0,PSJLINE=1
"RTN","PSJLMUT1",118,0)
 F PSIVX=0:0 S PSIVX=$O(^TMP($J,TYPE,PSIVX)) Q:'PSIVX  D
"RTN","PSJLMUT1",119,0)
 . S PSJPACK=$P(^TMP($J,TYPE,PSIVX,0),U,PIECE)
"RTN","PSJLMUT1",120,0)
 . I $G(PSGORD) S PSJORD=PSGORD ; Set PSJORD if PSGORD exists and is not Null
"RTN","PSJLMUT1",121,0)
 . I $G(PSJORD)]"" I $S($D(PSJORD):$G(PSJORD),1:$G(PSGORD))'["V",$P(PSJPACK,";")=$S($D(PSJORD):$G(PSJORD),1:$G(PSGORD)) Q  ; don't flag order that is being renewed as duplicate, only checks Unit Dose orders
"RTN","PSJLMUT1",122,0)
 . I $G(PSJCOM),($G(PSJORD)["P") Q:$D(^PS(53.1,"ACX",PSJCOM,+PSJPACK))
"RTN","PSJLMUT1",123,0)
 . ; Don't flag if pending renewal from CPRS
"RTN","PSJLMUT1",124,0)
 . I $G(PSJORD)]"",(PSJORD["P"),($P($G(^PS(53.1,+PSJORD,0)),"^",24)="R"),($P(PSJPACK,";")["U"),($P($G(^PS(55,DFN,5,+$P(PSJPACK,";"),0)),"^",27)="R"),($P($G(^PS(55,DFN,5,+$P(PSJPACK,";"),0)),"^",26)=PSJORD) Q
"RTN","PSJLMUT1",125,0)
 . I $G(PSIVRNFG),$G(ON55)["V",$P(PSJPACK,";")=$G(ON55) Q  ;PSIVRNFG set and kill in R+2^PSIVOPT2. Needed to do dupl. check on new order but not renew.
"RTN","PSJLMUT1",126,0)
 . S PSJORIEN=$P(^TMP($J,TYPE,PSIVX,0),U,PIECE-1)
"RTN","PSJLMUT1",127,0)
 . I TYPE="DI",($P(^TMP($J,TYPE,PSIVX,0),U,4)="CRITICAL") S PSJIREQ=1
"RTN","PSJLMUT1",128,0)
 . ; Adding Drug Interactions check for use in Intervention defaults in PSJRXI.
"RTN","PSJLMUT1",129,0)
 . I TYPE="DI" S PSJRXREQ=$S($P(^TMP($J,TYPE,PSIVX,0),U,4)="CRITICAL":"CRITICAL DRUG INTERACTION",1:"SIGNIFICANT DRUG INTERACTION")
"RTN","PSJLMUT1",130,0)
 . ;I $P(PSJPACK,";",2)["O" D  Q
"RTN","PSJLMUT1",131,0)
 . N X S X=$P(PSJPACK,";",2) I X["O" D  Q
"RTN","PSJLMUT1",132,0)
 ..  D:PSJFST=1 PAUSE
"RTN","PSJLMUT1",133,0)
 ..  W !!,"The patient has this "_$S($P(PSJPACK,";")["N":"Non-VA Meds",$P(PSJPACK,";",2)["O":"Outpatient",1:"")_" order:",!
"RTN","PSJLMUT1",134,0)
 ..  I $D(^TMP($J,TYPE,PSIVX,1)) D SHOR^PSJLMUT2(TYPE,PSIVX),PAUSE S PSJFST=$S(PSJFST=0:PSJFST+2,1:PSJFST+1) Q
"RTN","PSJLMUT1",135,0)
 ..  D EN^PSODRDU2(DFN,PSJPACK,"PSJPRE"),PAUSE S PSJPDRG=1,PSJFST=$S(PSJFST=0:PSJFST+2,1:PSJFST+1)
"RTN","PSJLMUT1",136,0)
 . S ON=$P(PSJPACK,";") Q:$D(PSJOC(ON))
"RTN","PSJLMUT1",137,0)
 . I ON=$G(PSIVOCON),+PSJORIEN Q
"RTN","PSJLMUT1",138,0)
 . I ON=$G(PSIVOCON),'+PSJORIEN D SETPSJOC Q
"RTN","PSJLMUT1",139,0)
 . ;S PSJOC=PSJOC+1,PSJPDRG=1 D:PSJOC=1 WRITE(TYPE)
"RTN","PSJLMUT1",140,0)
 . I ON["V" D
"RTN","PSJLMUT1",141,0)
 .. I '$O(^PS(55,DFN,"IV",+ON,0)) D SETPSJOC Q
"RTN","PSJLMUT1",142,0)
 .. D DSPLORDV(DFN,ON) S PSJOC=PSJOC+1
"RTN","PSJLMUT1",143,0)
 . I ON'["V" D DSPLORDU(DFN,ON) S PSJOC=PSJOC+1
"RTN","PSJLMUT1",144,0)
 . S PSJOC(ON,PSJLINE)="",PSJLINE=PSJLINE+1
"RTN","PSJLMUT1",145,0)
 D:PSJOC WRITE(TYPE)
"RTN","PSJLMUT1",146,0)
 S ON="" F  S ON=$O(PSJOC(ON)) Q:ON=""  W ! S PSJLINE=PSJLINE+1,PSJFST=PSJFST+1 D
"RTN","PSJLMUT1",147,0)
 . F PSIVX=0:0 S PSIVX=$O(PSJOC(ON,PSIVX)) Q:'PSIVX  W !,PSJOC(ON,PSIVX) S PSJLINE=PSJLINE+1 D:'(PSIVX#6) PAUSE
"RTN","PSJLMUT1",148,0)
 W !
"RTN","PSJLMUT1",149,0)
 Q
"RTN","PSJLMUT1",150,0)
SETPSJOC ;Set PSJOC array to be displayed later
"RTN","PSJLMUT1",151,0)
 NEW PIECE S PIECE=$S(TYPE="DC":4,1:2)
"RTN","PSJLMUT1",152,0)
 S X=$$SETSTR^VALM1($P(^TMP($J,TYPE,PSIVX,0),U,PIECE),"",9,40)
"RTN","PSJLMUT1",153,0)
 S X=$$SETSTR^VALM1("* EXISTS IN CURRENT ORDER *",X,50,27)
"RTN","PSJLMUT1",154,0)
 S PSJOC(ON,PSJLINE)=X,PSJLINE=PSJLINE+1,PSJOC=PSJOC+1
"RTN","PSJLMUT1",155,0)
 Q
"RTN","PSJLMUT1",156,0)
WRITE(TYPE)        ;Display order check description
"RTN","PSJLMUT1",157,0)
 S PSJPDRG=1
"RTN","PSJLMUT1",158,0)
 I TYPE="DD" W !!,"This patient is already receiving the following order",$S(PSJOC>1:"s",1:"")," for ",$S($G(PSJDD)]"":$P($G(^PSDRUG(PSJDD,0)),U),1:"this drug"),":",!
"RTN","PSJLMUT1",159,0)
 I TYPE="DC" W !!,"This patient is already receiving ",$S(PSJOC>1:"orders",1:"an order")," for the following drug",$S(PSJOC>1:"s",1:"")," in the same",!,"class as ",$S($G(PSJDD)]"":$P($G(^PSDRUG(PSJDD,0)),U),1:"the drug selected"),":",!
"RTN","PSJLMUT1",160,0)
 I TYPE="DI" W !!,"This patient is receiving the following medication",$S(PSJOC>1:"s",1:"")," that ha",$S(PSJOC>1:"ve",1:"s")," an interaction",!,"with ",$P($G(^PSDRUG(PSJDD,0)),U),":",!
"RTN","PSJLMUT1",161,0)
 Q
"RTN","PSJLMUT1",162,0)
PAUSE ;
"RTN","PSJLMUT1",163,0)
 K DIR W ! S DIR(0)="EA",DIR("A")="Press Return to continue...",DIR("?")="Press Return to continue..." D ^DIR W !
"RTN","PSJLMUT1",164,0)
 Q
"VER")
8.0^22.0
"BLD",10312,6)
^286
**END**
**END**

