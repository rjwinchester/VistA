Released PSJ*5*346 SEQ #298
Extracted from mail message
**KIDS**:PSJ*5.0*346^

**INSTALL NAME**
PSJ*5.0*346
"BLD",10683,0)
PSJ*5.0*346^INPATIENT MEDICATIONS^0^3171020^y
"BLD",10683,1,0)
^^5^5^3171020^
"BLD",10683,1,1,0)
This patch will resolve the following Issues:
"BLD",10683,1,2,0)
 
"BLD",10683,1,3,0)
1)  I9190253FY16   Order displayed twice after edit if you press return at
"BLD",10683,1,4,0)
                     QUIT.
"BLD",10683,1,5,0)
2)  I11117041FY17  Accept order prompt duplicated on IV orders
"BLD",10683,4,0)
^9.64PA^^
"BLD",10683,6.3)
10
"BLD",10683,"KRN",0)
^9.67PA^779.2^20
"BLD",10683,"KRN",.4,0)
.4
"BLD",10683,"KRN",.401,0)
.401
"BLD",10683,"KRN",.402,0)
.402
"BLD",10683,"KRN",.403,0)
.403
"BLD",10683,"KRN",.5,0)
.5
"BLD",10683,"KRN",.84,0)
.84
"BLD",10683,"KRN",3.6,0)
3.6
"BLD",10683,"KRN",3.8,0)
3.8
"BLD",10683,"KRN",9.2,0)
9.2
"BLD",10683,"KRN",9.8,0)
9.8
"BLD",10683,"KRN",9.8,"NM",0)
^9.68A^4^3
"BLD",10683,"KRN",9.8,"NM",2,0)
PSJLIACT^^0^B54174893
"BLD",10683,"KRN",9.8,"NM",3,0)
PSIVORC2^^0^B64595795
"BLD",10683,"KRN",9.8,"NM",4,0)
PSIVOPT^^0^B58751530
"BLD",10683,"KRN",9.8,"NM","B","PSIVOPT",4)

"BLD",10683,"KRN",9.8,"NM","B","PSIVORC2",3)

"BLD",10683,"KRN",9.8,"NM","B","PSJLIACT",2)

"BLD",10683,"KRN",19,0)
19
"BLD",10683,"KRN",19,"NM",0)
^9.68A^^
"BLD",10683,"KRN",19.1,0)
19.1
"BLD",10683,"KRN",101,0)
101
"BLD",10683,"KRN",409.61,0)
409.61
"BLD",10683,"KRN",771,0)
771
"BLD",10683,"KRN",779.2,0)
779.2
"BLD",10683,"KRN",870,0)
870
"BLD",10683,"KRN",8989.51,0)
8989.51
"BLD",10683,"KRN",8989.52,0)
8989.52
"BLD",10683,"KRN",8994,0)
8994
"BLD",10683,"KRN","B",.4,.4)

"BLD",10683,"KRN","B",.401,.401)

"BLD",10683,"KRN","B",.402,.402)

"BLD",10683,"KRN","B",.403,.403)

"BLD",10683,"KRN","B",.5,.5)

"BLD",10683,"KRN","B",.84,.84)

"BLD",10683,"KRN","B",3.6,3.6)

"BLD",10683,"KRN","B",3.8,3.8)

"BLD",10683,"KRN","B",9.2,9.2)

"BLD",10683,"KRN","B",9.8,9.8)

"BLD",10683,"KRN","B",19,19)

"BLD",10683,"KRN","B",19.1,19.1)

"BLD",10683,"KRN","B",101,101)

"BLD",10683,"KRN","B",409.61,409.61)

"BLD",10683,"KRN","B",771,771)

"BLD",10683,"KRN","B",779.2,779.2)

"BLD",10683,"KRN","B",870,870)

"BLD",10683,"KRN","B",8989.51,8989.51)

"BLD",10683,"KRN","B",8989.52,8989.52)

"BLD",10683,"KRN","B",8994,8994)

"BLD",10683,"QDEF")
^^^^NO^^^^^^NO
"BLD",10683,"QUES",0)
^9.62^^
"BLD",10683,"REQB",0)
^9.611^2^2
"BLD",10683,"REQB",1,0)
PSJ*5.0*313^2
"BLD",10683,"REQB",2,0)
PSJ*5.0*252^2
"BLD",10683,"REQB","B","PSJ*5.0*252",2)

"BLD",10683,"REQB","B","PSJ*5.0*313",1)

"MBREQ")
0
"PKG",471,-1)
1^1
"PKG",471,0)
INPATIENT MEDICATIONS^PSJ^UNIT DOSE AND IVS
"PKG",471,20,0)
^9.402P^^
"PKG",471,22,0)
^9.49I^1^1
"PKG",471,22,1,0)
5.0^2971215^2990325^66481
"PKG",471,22,1,"PAH",1,0)
346^3171020
"PKG",471,22,1,"PAH",1,1,0)
^^5^5^3171020
"PKG",471,22,1,"PAH",1,1,1,0)
This patch will resolve the following Issues:
"PKG",471,22,1,"PAH",1,1,2,0)
 
"PKG",471,22,1,"PAH",1,1,3,0)
1)  I9190253FY16   Order displayed twice after edit if you press return at
"PKG",471,22,1,"PAH",1,1,4,0)
                     QUIT.
"PKG",471,22,1,"PAH",1,1,5,0)
2)  I11117041FY17  Accept order prompt duplicated on IV orders
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
3
"RTN","PSIVOPT")
0^4^B58751530^B58375431
"RTN","PSIVOPT",1,0)
PSIVOPT ;BIR/PR,MLM - OPTION DRIVER ; 1/4/12 7:36am
"RTN","PSIVOPT",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**17,27,58,88,104,110,155,181,271,252,346**;16 DEC 97;Build 10
"RTN","PSIVOPT",3,0)
 ;
"RTN","PSIVOPT",4,0)
 ; Reference to ^PS(55 is supported by DBIA# 2191
"RTN","PSIVOPT",5,0)
 ; Reference to ^PSDRUG is supported by DBIA# 2192        
"RTN","PSIVOPT",6,0)
 ; Reference to ^PS(52.6 is supported by DBIA# 1231
"RTN","PSIVOPT",7,0)
 ; Reference to ^PS(52.7 is supported by DBIA# 2173
"RTN","PSIVOPT",8,0)
 ;
"RTN","PSIVOPT",9,0)
 NEW PSIVLOCK S PSIVLOCK=0
"RTN","PSIVOPT",10,0)
 ;I ON["P" L +^PS(53.1,+ON):1 S:'$T PSIVLOCK=1
"RTN","PSIVOPT",11,0)
 I ON["V" L +^PS(55,DFN,"IV",+ON55):1 S:'$T PSIVLOCK=1
"RTN","PSIVOPT",12,0)
 I PSIVLOCK W !,$C(7),$C(7),"This order is being edited by another user. Try later." G K
"RTN","PSIVOPT",13,0)
 ;W ! L +^PS(55,DFN,"IV",+ON55):1 I '$T W !,$C(7),$C(7),"This order is being edited by another user. Try later." G K
"RTN","PSIVOPT",14,0)
 I PSIVAC="O"!(PSIVAC="H") S PSIVAC=PSIVAC_"(DFN,ON,P(17),P(3))"
"RTN","PSIVOPT",15,0)
 S TEX="Active order ***" I $D(UWLFLAG),UWLFLAG="1.001" S XED=0 D @PSIVAC G K
"RTN","PSIVOPT",16,0)
 S DONE=0 F  D ACT Q:DONE
"RTN","PSIVOPT",17,0)
 ;
"RTN","PSIVOPT",18,0)
UNLOCK ; Unlock order.
"RTN","PSIVOPT",19,0)
 ;I ON["P" L -^PS(53.1,+ON)
"RTN","PSIVOPT",20,0)
 ;E  L -^PS(55,DFN,"IV",+ON55)
"RTN","PSIVOPT",21,0)
 I ON["V" L -^PS(55,DFN,"IV",+ON55)
"RTN","PSIVOPT",22,0)
 ;
"RTN","PSIVOPT",23,0)
K ; Kill variables. *271
"RTN","PSIVOPT",24,0)
 K %,DA,DIE,DIK,DLAYGO,DNE,DR,DRG,DRGI,DRGT,ERR,HELP,J,OD,P,P16,PSIVAL,PSIVC,PSIVLOG,PSIVNOL,PSIVOK,PSIVOPT,PSIVREA,SCRNPRO,TEX,XED,ZZND
"RTN","PSIVOPT",25,0)
 Q
"RTN","PSIVOPT",26,0)
ACT ; Prompt for order action.
"RTN","PSIVOPT",27,0)
 K PSJIVBD NEW PSGFDX,PSGSDX S (PSJORD,ON)=ON55
"RTN","PSIVOPT",28,0)
 S PSJCOM=$S(ON["V":$P($G(^PS(55,DFN,"IV",+ON,.2)),"^",8),1:$P($G(^PS(53.1,+ON,.2)),"^",8))
"RTN","PSIVOPT",29,0)
 D:ON["V" EN^PSJLIORD(DFN,ON)
"RTN","PSIVOPT",30,0)
 I ON["P",($P($G(^PS(53.1,+ON,0)),U,9)="N"),'PSJCOM D GT531^PSIVORFA(DFN,ON),VF^PSIVORC2 S DONE=1 Q
"RTN","PSIVOPT",31,0)
 I ON["P",PSJCOM Q:'$$LOCK^PSJOEA(DFN,PSJCOM)  N PSJO,ON,PSJORD S PSJO=0 F  S PSJO=$O(^PS(53.1,"ACX",PSJCOM,PSJO)) Q:'PSJO  Q:$G(Y)="Q"  S (PSJORD,ON)=PSJO_"P" D
"RTN","PSIVOPT",32,0)
 .D:($P($G(^PS(53.1,+ON,0)),U,9)="N") GT531^PSIVORFA(DFN,ON),VF^PSIVORC2
"RTN","PSIVOPT",33,0)
 .D:($P($G(^PS(53.1,+ON,0)),U,9)="P") EN^PSJLIFN
"RTN","PSIVOPT",34,0)
 I $G(PSJCOM) N PSJORD S PSJORD=PSJCOM D CHK^PSJOEA1
"RTN","PSIVOPT",35,0)
 I ON'["V",'+$G(PSJCOM) D EN^PSJLIFN
"RTN","PSIVOPT",36,0)
 S DONE=1
"RTN","PSIVOPT",37,0)
 K PSJEDFLG
"RTN","PSIVOPT",38,0)
 Q
"RTN","PSIVOPT",39,0)
 ;
"RTN","PSIVOPT",40,0)
CK ; Check if drugs are still valid.
"RTN","PSIVOPT",41,0)
 F DRGT="AD","SOL" S FIL=$S(DRGT="AD":52.6,1:52.7) F DRGI=0:0 S DRGI=$O(DRG(DRGT,DRGI)) Q:'DRGI  D
"RTN","PSIVOPT",42,0)
 .S DRG=+$P(DRG(DRGT,DRGI),U),X=$G(^PS(FIL,DRG,"I")) I $S('X:0,DT<X:0,1:1)!$S('$G(^PSDRUG(+$P($G(^PS(FIL,DRG,0)),U,2),"I")):0,^("I")>DT:0,1:1) S ERR=1
"RTN","PSIVOPT",43,0)
 Q
"RTN","PSIVOPT",44,0)
 ;
"RTN","PSIVOPT",45,0)
D ; Discontinue order.
"RTN","PSIVOPT",46,0)
 D D^PSIVOPT2
"RTN","PSIVOPT",47,0)
 Q
"RTN","PSIVOPT",48,0)
 ;
"RTN","PSIVOPT",49,0)
O(DFN,ON,STAT,STOP) ; On/Off Call
"RTN","PSIVOPT",50,0)
 D NOW^%DTC I STAT="H",STOP<% D EXPIR Q
"RTN","PSIVOPT",51,0)
 I "OA"'[STAT W !,$C(7),"Only active orders may be placed on hold." Q
"RTN","PSIVOPT",52,0)
 S PSIVALT=1,PSIVREA=$S(STAT'="O":"O",1:"C"),(P(17),STAT)=$S(PSIVREA="O":"O",1:"A") W:PSIVREA="C" ?$X+4,$C(7),TEX
"RTN","PSIVOPT",53,0)
 D UPSTAT,LOG^PSIVORAL D:STAT="A" CKO^PSIVCHK
"RTN","PSIVOPT",54,0)
 Q
"RTN","PSIVOPT",55,0)
 ;
"RTN","PSIVOPT",56,0)
E ; Entry for Pharmacy edit
"RTN","PSIVOPT",57,0)
 N PSJEDIT1 D E^PSIVOPT1
"RTN","PSIVOPT",58,0)
 Q
"RTN","PSIVOPT",59,0)
 ;
"RTN","PSIVOPT",60,0)
R ; Renew order.
"RTN","PSIVOPT",61,0)
 NEW PSJOCFG
"RTN","PSIVOPT",62,0)
 S PSJOCFG="RENEW IV"
"RTN","PSIVOPT",63,0)
 D R^PSIVOPT2
"RTN","PSIVOPT",64,0)
 K PSJOCFG
"RTN","PSIVOPT",65,0)
 Q
"RTN","PSIVOPT",66,0)
 ;
"RTN","PSIVOPT",67,0)
H(DFN,ON,STAT,STOP)          ; Place order on hold.
"RTN","PSIVOPT",68,0)
 D NOW^%DTC I STAT="H" I STOP<% D EXPIR Q
"RTN","PSIVOPT",69,0)
 I "HA"'[STAT W !,$C(7),"Only active orders may be placed on hold." Q
"RTN","PSIVOPT",70,0)
 D NATURE^PSIVOREN I '$D(P("NAT")) W !!,"Order unchanged." Q
"RTN","PSIVOPT",71,0)
 S PSIVALT=1,PSIVREA=$S(STAT'="H":"H",1:"U"),(P(17),STAT)=$S(PSIVREA="H":"H",1:"A") W:PSIVREA="U" ?$X+4,$C(7),TEX
"RTN","PSIVOPT",72,0)
 D UPSTAT,LOG^PSIVORAL,HOLD^PSIVOE,ENLBL^PSIVOPT(2,DUZ,DFN,3,+ON55,$S(PSIVREA="H":"H1",1:"H0")) D:STAT="A" CKO^PSIVCHK
"RTN","PSIVOPT",73,0)
 Q
"RTN","PSIVOPT",74,0)
 ;
"RTN","PSIVOPT",75,0)
S ; View order.
"RTN","PSIVOPT",76,0)
 D @$S(ON55["V":"GT55^PSIVORFB",1:"GT531^PSIVORFA("_DFN_","""_ON55_""")") W @IOF D EN^PSIVORV2
"RTN","PSIVOPT",77,0)
 Q
"RTN","PSIVOPT",78,0)
 ;
"RTN","PSIVOPT",79,0)
EXPIR ; Update status of expired orders.
"RTN","PSIVOPT",80,0)
 I STAT="H" S PSIVREA="H",P(17)="E"
"RTN","PSIVOPT",81,0)
 S STAT="E" D UPSTAT,EXPIR^PSIVOE W $C(7),"  This order has expired."
"RTN","PSIVOPT",82,0)
 Q
"RTN","PSIVOPT",83,0)
 ;
"RTN","PSIVOPT",84,0)
UPSTAT ; Update orders status.
"RTN","PSIVOPT",85,0)
 N DA,DR,DIE,PSIVACT S PSIVACT=1,DA=+ON55,DA(1)=DFN,DIE="^PS(55,"_DFN_",""IV"",",DR="100///"_P(17)_$S($G(PSIVREA)="H":";149///1",$G(PSIVREA)="U":";149///@",1:"") D ^DIE
"RTN","PSIVOPT",86,0)
 Q
"RTN","PSIVOPT",87,0)
 ;
"RTN","PSIVOPT",88,0)
ENIN ; Entry for inpatient order entry/profile options.
"RTN","PSIVOPT",89,0)
 N DFN,ON,P,PSIVAC S PSIVAC="C" I PSJORD["P" S (P("PON"),ON)=+PSJORD_"P",DFN=PSGP D SHOW1^PSIVORC Q
"RTN","PSIVOPT",90,0)
 S (P("PON"),ON,ON55)=+PSJORD_"V",DFN=PSGP D GT55^PSIVORFB,EN^PSIVORV2,PSIVOPT:'$D(PSJPRF)
"RTN","PSIVOPT",91,0)
 L -^PS(55,DFN,"IV",+PSJORD)
"RTN","PSIVOPT",92,0)
 Q
"RTN","PSIVOPT",93,0)
 ;
"RTN","PSIVOPT",94,0)
ENARI(DFN,ON,PSGUOW,PSIVAL) ; Auto-reinstate IV orders if movement is deleted.
"RTN","PSIVOPT",95,0)
 ;Create a list of recipients beyond normal mail group
"RTN","PSIVOPT",96,0)
 S PSGORNUM=$S($G(PSGORD):PSGORD,$G(PSJORD):PSJORD,$G(OR55):OR55,1:"")
"RTN","PSIVOPT",97,0)
 I $G(PSGORNUM) D
"RTN","PSIVOPT",98,0)
 .I $D(^PS(55,PSGP,"IV",+PSGORNUM,0)),$P(^PS(55,PSGP,"IV",+PSGORNUM,0),U,6)'="" S PSJSENTO($J,$P(^PS(55,PSGP,"IV",+PSGORNUM,0),U,6))="" ; Provider
"RTN","PSIVOPT",99,0)
 .I $D(^PS(55,PSGP,"IV",+PSGORNUM,2)),$P(^PS(55,PSGP,"IV",+PSGORNUM,2),U,11)'="" S PSJSENTO($J,$P(^PS(55,PSGP,"IV",+PSGORNUM,2),U,11))="" ; Entered by
"RTN","PSIVOPT",100,0)
 .I $D(^PS(55,PSGP,"IV",+PSGORNUM,4)),$P(^PS(55,PSGP,"IV",+PSGORNUM,4),U,1)'="" S PSJSENTO($J,$P(^PS(55,PSGP,"IV",+PSGORNUM,4),U,1))="" ; Verifying Nurse
"RTN","PSIVOPT",101,0)
 ; find pharmacist that finished the IV order
"RTN","PSIVOPT",102,0)
 N PSJX,ENTBY S PSJX=$G(^PS(55,PSGP,"IV",+ON,"A",1,0))
"RTN","PSIVOPT",103,0)
 I $P(PSJX,U,2)="F" S ENTBY=$$VA200($P(PSJX,U,3)) I ENTBY'="" S PSJSENTO($J,ENTBY)=""
"RTN","PSIVOPT",104,0)
 ;
"RTN","PSIVOPT",105,0)
 I $G(PSGALO)'=18530,$G(PSGORNUM),$$IVDUPADD^PSIVOPT(PSGP,+PSGORNUM) S ^TMP("PSJNOTUNDC",$J,PSGP,+PSGORNUM_"V")="" Q
"RTN","PSIVOPT",106,0)
 N DA,DR,DIE,DIK,PSIVREA,PSIVALCK,PSIVOPT,PSIVALT,X,Y
"RTN","PSIVOPT",107,0)
 S X=$G(^PS(55,DFN,"IV",+ON,"ADC")) I X K ^PS(55,"ADC",X,DFN,+ON),^PS(55,DFN,"IV",+ON,"ADC")
"RTN","PSIVOPT",108,0)
 ;S PSIVACT=1,DR=$S(+$P($G(^PS(55,DFN,"IV",+ON,4)),U,18)=1:"100///H",+$P($G(^PS(55,DFN,"IV",+ON,0)),U,10)=1:"100///H",1:"100///A")_";.03////"_+$P($G(^PS(55,DFN,"IV",+ON,2)),U,7)_";109///@;116///@;121///@;157////@"
"RTN","PSIVOPT",109,0)
 S PSIVACT=1,DR=$S(+$P($G(^PS(55,DFN,"IV",+ON,0)),U,10)=1:"100///H;157///HP",+$P($G(^PS(55,DFN,"IV",+ON,4)),U,18)=1:"100///H;157///@",1:"100///A;157///@")_";.03////"_+$P($G(^PS(55,DFN,"IV",+ON,2)),U,7)_";109///@;116///@;121///@"
"RTN","PSIVOPT",110,0)
 S DIE="^PS(55,"_DFN_",""IV"",",DA=+ON,DA(1)=DFN
"RTN","PSIVOPT",111,0)
 N CHKIT S CHKIT=$G(^PS(55,DFN,"IV",+ON,2)) I $P(CHKIT,U,6)["P",($P(CHKIT,U,9)="R") S DR=DR_";114///@;123///@"
"RTN","PSIVOPT",112,0)
 D ^DIE
"RTN","PSIVOPT",113,0)
 S ^TMP("PSJUNDC",$J,DFN,ON_"V")=""
"RTN","PSIVOPT",114,0)
 S ON55=ON,P(17)="A",PSIVREA=$S($D(PSJUNDC):"AI",1:"I"),PSIVALCK="STOP",(PSIVOPT,PSIVALT)=1,PSIVAL=$P($G(^PS(53.3,+PSIVAL,0)),U) D LOG^PSIVORAL
"RTN","PSIVOPT",115,0)
 ;* S Y=^PS(55,DFN,"IV",+ON,0),P(3)=+$P(Y,U,3),ORIFN=$P(Y,U,21),P(12)="" D:'$D(PSJIVORF) ORPARM^PSIVOREN I PSJIVORF D
"RTN","PSIVOPT",116,0)
 S Y=^PS(55,DFN,"IV",+ON,0),P(3)=+$P(Y,U,3),P(12)="" D:'$D(PSJIVORF) ORPARM^PSIVOREN I PSJIVORF D
"RTN","PSIVOPT",117,0)
 .D EN1^PSJHL2(DFN,"SC",+ON55_"V","AUTO REINSTATED")
"RTN","PSIVOPT",118,0)
 S PSGTOL=$S($D(PSJUNDC):3,1:2)
"RTN","PSIVOPT",119,0)
 Q:$S('$D(PSJUNDC):0,PSGALO=18540:1,1:'$P($G(PSJSYSW0),U,15))
"RTN","PSIVOPT",120,0)
 I $D(^PS(53.41,1,1,PSGUOW,1,DFN,1,3,1,+ON)) K DIK,DA S DIK="^PS(53.41,1,1,"_PSGUOW_",1,"_DFN_",1,3,1,",DA=+ON,DA(1)=1,DA(2)=PSGP,DA(3)=PSGUOW,DA(4)=3 D ^DIK
"RTN","PSIVOPT",121,0)
 E  K DA D ENLBL^PSIVOPT(PSGTOL,PSGUOW,DFN,3,+ON,"RE")
"RTN","PSIVOPT",122,0)
 Q
"RTN","PSIVOPT",123,0)
 ;
"RTN","PSIVOPT",124,0)
ENINP(DFN,ON) ; Entry from Inpatient Profile.
"RTN","PSIVOPT",125,0)
 N PSIVAC,ON55 S PSIVAC="PRO" D @($S(ON["V":"GT55^PSIVORFB",1:"GT531^PSIVORFA("_DFN_","""_ON_""")")),ENNH^PSIVORV2(ON)
"RTN","PSIVOPT",126,0)
 Q
"RTN","PSIVOPT",127,0)
ENLBL(PSGTOL,PSGUOW,PSGP,PSGTOO,DA,RES) ;
"RTN","PSIVOPT",128,0)
 ;Queue MAR labels for IV orders.
"RTN","PSIVOPT",129,0)
 Q:'$D(^DPT(PSGP,.1))  I '$D(PSJSYSW0) N PSJACPF,PSJACNWP S PSJACPF=11 D WP^PSJAC Q:'PSJSYSL
"RTN","PSIVOPT",130,0)
 N P,X,Y
"RTN","PSIVOPT",131,0)
 S X=$P(PSJSYSW0,U,2),Y=$P($G(^PS(55,PSGP,"IV",DA,0)),U,4)
"RTN","PSIVOPT",132,0)
 S Y=$S(Y="A":4,Y="H":5,Y="C":6,1:3) I X=1!(X[Y) D NOW^%DTC S PSGDT=% D ENL^PSGVDS S ^PS(55,DFN,"IV",DA,7)=PSGDT_U_RES
"RTN","PSIVOPT",133,0)
 Q
"RTN","PSIVOPT",134,0)
 ;
"RTN","PSIVOPT",135,0)
IVDUPADD(PSGP,ORDERNUM) ;
"RTN","PSIVOPT",136,0)
 N PSJCOM
"RTN","PSIVOPT",137,0)
 S DUPLOOP=0
"RTN","PSIVOPT",138,0)
 S DUPFOUND=0
"RTN","PSIVOPT",139,0)
 ;Loop through the additives of order to reinstate
"RTN","PSIVOPT",140,0)
 S PSJCOM=+$P($G(^PS(55,+PSGP,"IV",ORDERNUM,.2)),"^",8) F  S DUPLOOP=$O(^PS(55,PSGP,"IV",ORDERNUM,"AD",DUPLOOP)) Q:((DUPLOOP="")!(DUPFOUND))  D
"RTN","PSIVOPT",141,0)
 .;Get the additive code no.
"RTN","PSIVOPT",142,0)
 .S TARGET=$P(^PS(55,PSGP,"IV",ORDERNUM,"AD",DUPLOOP,0),"^",1)
"RTN","PSIVOPT",143,0)
 .D NOW^%DTC
"RTN","PSIVOPT",144,0)
 .S DATELOOP=%
"RTN","PSIVOPT",145,0)
 .;Loop through the current orders for the patient by date
"RTN","PSIVOPT",146,0)
 .F  S DATELOOP=$O(^PS(55,PSGP,"IV","AIS",DATELOOP)) Q:((DATELOOP="")!(DUPFOUND))  D
"RTN","PSIVOPT",147,0)
 ..S EXISTORD=""
"RTN","PSIVOPT",148,0)
 ..;Loop through the orders for date by order number
"RTN","PSIVOPT",149,0)
 ..F  S EXISTORD=$O(^PS(55,PSGP,"IV","AIS",DATELOOP,EXISTORD)) Q:((EXISTORD="")!(DUPFOUND))  D
"RTN","PSIVOPT",150,0)
 ...;Loop through additives for the existing order
"RTN","PSIVOPT",151,0)
 ...I PSJCOM>0 Q:+$P($G(^PS(55,+PSGP,"IV",EXISTORD,.2)),"^",8)
"RTN","PSIVOPT",152,0)
 ...S EXISTADD=0
"RTN","PSIVOPT",153,0)
 ...F  S EXISTADD=$O(^PS(55,PSGP,"IV",EXISTORD,"AD",EXISTADD)) Q:((EXISTADD="")!(DUPFOUND))  D 
"RTN","PSIVOPT",154,0)
 ....;Extract the Additive Code number for the Order
"RTN","PSIVOPT",155,0)
 ....S MATCHADD=$P(^PS(55,PSGP,"IV",EXISTORD,"AD",EXISTADD,0),"^",1)
"RTN","PSIVOPT",156,0)
 ....;If the existing order and the order to be reinstated have the same additive code then return FOUND=TRUE
"RTN","PSIVOPT",157,0)
 ....I MATCHADD=TARGET D
"RTN","PSIVOPT",158,0)
 .....S DUPFOUND=1
"RTN","PSIVOPT",159,0)
 Q DUPFOUND
"RTN","PSIVOPT",160,0)
 ;
"RTN","PSIVOPT",161,0)
VA200(X) ;Return the IEN for the user.
"RTN","PSIVOPT",162,0)
 ; X = User name
"RTN","PSIVOPT",163,0)
 NEW DIC,Y S DIC="^VA(200,",DIC(0)="NZ" D ^DIC
"RTN","PSIVOPT",164,0)
 I +Y=-1 Q ""
"RTN","PSIVOPT",165,0)
 Q $P(Y,U)
"RTN","PSIVORC2")
0^3^B64595795^B64197207
"RTN","PSIVORC2",1,0)
PSIVORC2 ;BIR/MLM - PROCESS INCOMPLETE IV ORDER - CONT ;22 OCT 97 / 3:16 PM
"RTN","PSIVORC2",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**29,49,50,65,58,85,101,110,127,151,181,267,275,257,281,313,346**;16 DEC 97;Build 10
"RTN","PSIVORC2",3,0)
 ;
"RTN","PSIVORC2",4,0)
 ; Reference to ^PS(51.2 is supported by DBIA #2178
"RTN","PSIVORC2",5,0)
 ; Reference to ^PS(55 is supported by DBIA #2191
"RTN","PSIVORC2",6,0)
 ; Reference to ^PS(52.6 is supported by DBIA #1231
"RTN","PSIVORC2",7,0)
 ; Reference to ^PS(52.7 is supported by DBIA #2173
"RTN","PSIVORC2",8,0)
 ; Reference to EN1^ORCFLAG is supported by DBIA #3620.
"RTN","PSIVORC2",9,0)
 ; Reference to ^PSSLOCK is supported by DBIA #2789
"RTN","PSIVORC2",10,0)
 ; Reference to ^TMP("PSODAOC",$J is supported by# DBIA 6071
"RTN","PSIVORC2",11,0)
 ;
"RTN","PSIVORC2",12,0)
EDCHK ;Update or create new order in 55.
"RTN","PSIVORC2",13,0)
 D CKORD D:'$G(PSJIVORF) ORPARM^PSIVOREN I 'PSJIVORF W !,"Either the Inpatient Medications or the IV Medications package is not on, please check the Order Parameters file" Q
"RTN","PSIVORC2",14,0)
 I PSIVCHG,PSJIVORF D NATURE^PSIVOREN I '$D(P("NAT")) W $C(7),"Order unchanged" Q
"RTN","PSIVORC2",15,0)
 S:PSIVCHG P("21FLG")=""
"RTN","PSIVORC2",16,0)
 I $G(PSJCOM) D IV^PSJCOMV Q
"RTN","PSIVORC2",17,0)
 Q:$$NONVF()
"RTN","PSIVORC2",18,0)
ACTIVE ;
"RTN","PSIVORC2",19,0)
 S PSJCOM=P("PRNTON")
"RTN","PSIVORC2",20,0)
 I PSJCOM D VFYIV^PSJCOMV Q
"RTN","PSIVORC2",21,0)
 S P("RES")=$P($G(^PS(53.1,+ON,0)),U,24)
"RTN","PSIVORC2",22,0)
 I P("RES")="R" S P("NEWON")=P("OLDON") S PSJOSTOP="" D
"RTN","PSIVORC2",23,0)
 .N PSJTROPI,PSJNVO S PSJNVO=$G(P("NEWON")) I (PSJNVO["P") D FILEOPI^PSJBCMA5(DFN,PSJNVO) S PSJTROPI=$$GETOPI^PSJBCMA5(DFN,PSJNVO) Q
"RTN","PSIVORC2",24,0)
 .I ($G(P("PON"))["P"),($G(ON55)=P("PON")) S PSJNVO=P("PON") D FILEOPI^PSJBCMA5(DFN,PSJNVO) S PSJTROPI=$$GETOPI^PSJBCMA5(DFN,PSJNVO)
"RTN","PSIVORC2",25,0)
 .I $G(P("NEWON")) D FILEOPI^PSJBCMA5(DFN,P("NEWON")) S PSJTROPI=$$GETOPI^PSJBCMA5(DFN,P("NEWON"))
"RTN","PSIVORC2",26,0)
 .D RUPDATE^PSIVOREN(DFN,ON,P(2)) I $P($G(^PS(53.45,+$G(PSJSYSP),6,0)),"^",3)
"RTN","PSIVORC2",27,0)
 I P("RES")'="R" S PSJORD=ON,P(17)="A",ORSTS=6,PSJORNP=P(6) D SETNEW^PSIVORFB S P("NEWON")=ON55 D @$S(PSIVCHG:"NEWORD",1:"OLDORD")
"RTN","PSIVORC2",28,0)
 I $G(PSJIOPIV) D MVOPI^PSJBCMA5($G(DFN),$G(PSJORD),$G(ON55)),MVOPIAL^PSJBCMA5($G(DFN),$G(PSJORD),$G(ON55))
"RTN","PSIVORC2",29,0)
 S (ON55,ON)=P("NEWON"),OD=P(2) D EN^PSIVORE
"RTN","PSIVORC2",30,0)
 D CIMOI^PSJIMO1(DFN,ON55,"",$G(PSJORD))
"RTN","PSIVORC2",31,0)
 D VF1^PSJLIACT("F","ORDER VERIFIED BY ",1)
"RTN","PSIVORC2",32,0)
 D ENLBL^PSIVOPT(2,DUZ,DFN,3,+ON55,"N")
"RTN","PSIVORC2",33,0)
 I $G(^PS(55,DFN,"IV",+ON55,4)) D EN1^PSJHL2(DFN,"ZV",ON55)
"RTN","PSIVORC2",34,0)
 L -^PS(53.1,+$G(PSJORD)) L -^PS(55,DFN,"IV",+ON55)
"RTN","PSIVORC2",35,0)
 Q
"RTN","PSIVORC2",36,0)
 ;
"RTN","PSIVORC2",37,0)
CKORD ;Check if new order is to be created.
"RTN","PSIVORC2",38,0)
 I $G(PSIVCOPY) S PSIVCHG=0 Q
"RTN","PSIVORC2",39,0)
 N ND,PSJCHG S PSIVCHG=0,ND(0)=$G(^PS(53.1,+ON,0)),ND("PD")=$G(^PS(53.1,+ON,.2))_U_$P(ND(0),U,3)
"RTN","PSIVORC2",40,0)
 N X S X=$P($G(^PS(53.1,+ON,8)),U,5),X=$S(P(8)["@":$P(X,"@"),1:X)
"RTN","PSIVORC2",41,0)
 S ND=$S($E(P("OT"))="I":P(8),1:X)_U_+$P(ND(0),U,3)_U_+$P(ND("PD"),U)
"RTN","PSIVORC2",42,0)
 S ND=ND_U_$S($P(ND(0),U,2)=+P("CLRK"):+$P(ND(0),U,2),1:+P(6))
"RTN","PSIVORC2",43,0)
 I ND'=($S($E(P("OT"))="I":P(8),P(8)["@":$P(P(8),"@"),1:P(8))_U_+P("MR")_U_+P("PD")_U_+P(6)) S PSIVCHG=1
"RTN","PSIVORC2",44,0)
 I 'PSIVCHG I $P($G(^PS(53.1,+ON,2)),U)'=P(9) S:($G(P("DTYP"))'=1) PSIVDSFG=1 S PSIVCHG=1
"RTN","PSIVORC2",45,0)
 N ND,TDRG,TMPDRG
"RTN","PSIVORC2",46,0)
 Q:PSIVCHG
"RTN","PSIVORC2",47,0)
 D TMPDRG1^PSJMISC(DFN,$G(ON),.TMPDRG)
"RTN","PSIVORC2",48,0)
 I $$COMPARE^PSJMISC(.DRG,.TMPDRG,$S(P("DTYP")=1:0,1:1)) S PSIVCHG=1
"RTN","PSIVORC2",49,0)
 K TMPDRG
"RTN","PSIVORC2",50,0)
 Q:PSIVCHG
"RTN","PSIVORC2",51,0)
 Q
"RTN","PSIVORC2",52,0)
CKPC ;
"RTN","PSIVORC2",53,0)
 ;PSJ*5*181 Note - No longer use by *181
"RTN","PSIVORC2",54,0)
 ;
"RTN","PSIVORC2",55,0)
 Q:PSIVCHG  I $E(P("OT"))'="I" D
"RTN","PSIVORC2",56,0)
 .;
"RTN","PSIVORC2",57,0)
 .; Check IV drugs for changes.
"RTN","PSIVORC2",58,0)
 .S DNE=0 F DRGT="AD","SOL" I $D(DRG(DRGT)) S FIL="52."_$S(DRGT="AD":6,1:7) D
"RTN","PSIVORC2",59,0)
 ..N ND,TDRG,ON1 F DRGI=0:0 S DRGI=$O(DRG(DRGT,DRGI)) Q:'DRGI!DNE  S TDRG(+$P(DRG(DRGT,DRGI),U),DRGI)=DRGI,TDRG("CNT")=+$G(TDRG("CNT"))+1
"RTN","PSIVORC2",60,0)
 ..F ON1=0:0 S ON1=$O(^PS(53.1,+ON,DRGT,ON1)) Q:'+ON1!DNE  S ND=$G(^PS(53.1,+ON,DRGT,ON1,0)),ND("CNT")=$G(ND("CNT"))+1 D
"RTN","PSIVORC2",61,0)
 ...S DRG=+$P(ND,U) S:'$D(TDRG(+DRG)) (DNE,PSIVCHG)=1 F DRGI=0:0 S DRGI=$O(TDRG(+DRG,DRGI)) Q:'DRGI!DNE  I $P($G(DRG(DRGT,DRGI)),U)_U_$P($G(DRG(DRGT,DRGI)),U,3)'=$P(ND,U,1,2) S (DNE,PSIVCHG)=1
"RTN","PSIVORC2",62,0)
 ..S:$G(ND("CNT"))'=$G(TDRG("CNT")) (DNE,PSIVCHG)=1 K ND,TDRG
"RTN","PSIVORC2",63,0)
 Q
"RTN","PSIVORC2",64,0)
 ;
"RTN","PSIVORC2",65,0)
OLDORD ; Update old order, update order links.
"RTN","PSIVORC2",66,0)
 Q:P("RES")="R"
"RTN","PSIVORC2",67,0)
 S P("OLDON")=$P($G(^PS(53.1,+ON,0)),U,25) I P("OLDON")'=ON55 S $P(^PS(55,DFN,"IV",+ON55,2),U,8)=P("RES"),$P(^(2),U,5)=P("OLDON") I P("OLDON") D
"RTN","PSIVORC2",68,0)
 .I P("OLDON")["V",$D(^PS(55,DFN,"IV",+P("OLDON"),0)) S $P(^(2),U,6)=ON55,$P(^(2),U,9)=P("RES")
"RTN","PSIVORC2",69,0)
 .I P("OLDON")["A",$D(^PS(55,DFN,5,+P("OLDON"),0)) S $P(^(0),U,26,27)=ON55_U_P("RES")
"RTN","PSIVORC2",70,0)
 .I $S(P("OLDON")["P":1,P("OLDON")["N":1,1:0),$D(^PS(53.1,+P("OLDON"),0)) S $P(^(0),U,26,27)=ON55_U_P("RES")
"RTN","PSIVORC2",71,0)
 D PUT531^PSIVORFA S $P(^PS(53.1,+ON,0),U,25,26)="^",ON=ON55 D UPD100^PSIVORFA
"RTN","PSIVORC2",72,0)
 Q
"RTN","PSIVORC2",73,0)
 ;
"RTN","PSIVORC2",74,0)
NEWORD ; Create new order, update order links.
"RTN","PSIVORC2",75,0)
 Q:P("RES")="R"
"RTN","PSIVORC2",76,0)
 S $P(^PS(53.1,+ON,0),U,26,27)=P("NEWON")_U_"E",PSIVAC="CE",PSJORNAT=P("NAT") D DC^PSIVORA
"RTN","PSIVORC2",77,0)
 S P("NEWON")=$P($G(^PS(53.1,+PSJORD,0)),U,26),$P(^PS(55,DFN,"IV",+P("NEWON"),2),U,5)=PSJORD,$P(^(2),U,8)="E",ON=ON55
"RTN","PSIVORC2",78,0)
 I PSJIVORF D EN1^PSJHL2(DFN,"SN",+ON55_"V","NEW ORDER CREATED")
"RTN","PSIVORC2",79,0)
 Q
"RTN","PSIVORC2",80,0)
 ;
"RTN","PSIVORC2",81,0)
GTIVDRG ; Try to find an IV drug from the Orderable Item.
"RTN","PSIVORC2",82,0)
 ; If there is only 1 match to OI then stuff in DRG otherwise prompt user to select which
"RTN","PSIVORC2",83,0)
 ; ad/sol matched to OI
"RTN","PSIVORC2",84,0)
 K PSIVOI N FIL,ND,SCR,PSJNOW
"RTN","PSIVORC2",85,0)
 D NOW^%DTC S PSJNOW=%
"RTN","PSIVORC2",86,0)
 S SCR("S")="S ND=$P($G(^(""I"")),U) I ND=""""!(ND>PSJNOW)"
"RTN","PSIVORC2",87,0)
 F FIL=52.6,52.7 D FIND^DIC(FIL,,"@;.01;2"_$S(FIL=52.6:";19",1:""),"QXP",+P("PD"),,"AOI",SCR("S"),,"PSIVOI") I +PSIVOI("DILIST",0)>0 D  Q
"RTN","PSIVORC2",88,0)
 . S DRGT=$S(FIL=52.6:"AD",1:"SOL"),PSIVOI=DRGT
"RTN","PSIVORC2",89,0)
 . I PSIVOI="AD" D
"RTN","PSIVORC2",90,0)
 .. N XX,XXX,QC S XX=0 F  S XX=$O(PSIVOI("DILIST",XX)) Q:XX=""  S XXX=+PSIVOI("DILIST",XX,0) D LIST^DIC(52.61,","_XXX_",","@;.01","PQ",,,,,,,"PSIVQC") D
"RTN","PSIVORC2",91,0)
 ... I +$G(PSIVQC("DILIST",0))>0 S QC=0 F  S QC=$O(PSIVQC("DILIST",QC)) Q:QC=""  S PSIVOI("DILIST",XX,QC,0)=PSIVQC("DILIST",QC,0)
"RTN","PSIVORC2",92,0)
 ... K PSIVQC("DILIST",0),PSIVQC("DILIST",0,"MAP")
"RTN","PSIVORC2",93,0)
 .. D RESET
"RTN","PSIVORC2",94,0)
 . I +PSIVOI("DILIST",0)=1 D
"RTN","PSIVORC2",95,0)
 .. S DRG=+PSIVOI("DILIST",1,0)
"RTN","PSIVORC2",96,0)
 .. S DNE=1,DRG(DRGT,0)=1,ND=$G(^PS(FIL,+DRG,0)),DRG(DRGT,1)=+DRG_U_$P(ND,U)_U_$S(FIL=52.7:$P(ND,U,3),1:"")_U_U_$P(ND,U,13)_U_$P(ND,U,11)
"RTN","PSIVORC2",97,0)
 K:+PSIVOI("DILIST",0)<2 PSIVOI
"RTN","PSIVORC2",98,0)
 Q
"RTN","PSIVORC2",99,0)
 ;
"RTN","PSIVORC2",100,0)
EDIT ; Edit incomplete order
"RTN","PSIVORC2",101,0)
 K PSIVENO
"RTN","PSIVORC2",102,0)
 S PSIVAC="CE"
"RTN","PSIVORC2",103,0)
 I $E(P("OT"))="I",'$D(DRG("AD")),('$D(DRG("SOL"))) D GTIVDRG
"RTN","PSIVORC2",104,0)
 I P(4)="" D 53^PSIVORC1 Q:P(4)=""  D ^PSIVORV2
"RTN","PSIVORC2",105,0)
 D GSTRING^PSIVORE1,GTFLDS^PSIVORFE ;S (PSIVOK,EDIT)="57^58^59^3"_$S(P("DTYP")=1:"^26^39",1:"")_"^63^64^"_$S($E(P("OT"))="I":"101^109^",1:"")_"10^25"_$S(+P(6)'=+P("CLRK"):"^1",1:"") D GTFLDS^PSIVORFE
"RTN","PSIVORC2",106,0)
 Q:$G(DONE)
"RTN","PSIVORC2",107,0)
 I '$G(PSIVENO) S PSIVENO=1 D EN^VALM("PSJ LM IV AC/EDIT") S VALMBCK="Q"
"RTN","PSIVORC2",108,0)
 Q
"RTN","PSIVORC2",109,0)
 ;
"RTN","PSIVORC2",110,0)
FINISH ; Ask only for missing data in incomplete IV order.
"RTN","PSIVORC2",111,0)
 D GTDRG^PSIVORFA  ; Re-setting DRG array
"RTN","PSIVORC2",112,0)
 S P("OPI")=$$ENPC^PSJUTL("V",+PSIVUP,60,P("OPI")) I $E(P("OT"))="I",'$D(DRG("AD")),('$D(DRG("SOL"))) S DNE=0 D GTIVDRG
"RTN","PSIVORC2",113,0)
 D:P(4)="" 53^PSIVORC1 Q:P(4)=""  S P("DTYP")=$S(P(4)="":0,P(4)="P"!(P(23)="P")!(P(5)):1,P(4)="H":2,1:3)
"RTN","PSIVORC2",114,0)
 I 'P(2) D ENT^PSIVCAL K %DT S X=P(2),%DT="RTX" D ^%DT S P(2)=+Y
"RTN","PSIVORC2",115,0)
 I 'P(3) D ENSTOP^PSIVCAL K %DT S X=P(3),%DT="RTX" D ^%DT S P(3)=+Y
"RTN","PSIVORC2",116,0)
 I 'P("MR") S P("MR")=$O(^PS(51.2,"B","INTRAVENOUS",0))_"^IV"
"RTN","PSIVORC2",117,0)
 ;
"RTN","PSIVORC2",118,0)
 ;Will prompt users to choose Dispense IV Additive when more than one are available for the Orderable Item
"RTN","PSIVORC2",119,0)
 ;
"RTN","PSIVORC2",120,0)
 N PSJQUIT S PSJQUIT=0 D MULTADDS^PSJLIFN I $G(PSJQUIT) S VALMBCK="R" Q
"RTN","PSIVORC2",121,0)
 ;
"RTN","PSIVORC2",122,0)
 S PSIVOK="1^3^10^25^26^39^57^58^59^63^64"
"RTN","PSIVORC2",123,0)
 D CKFLDS^PSIVORC1 D:EDIT]"" EDIT^PSIVEDT G COMPLTE^PSIVORC1
"RTN","PSIVORC2",124,0)
 Q
"RTN","PSIVORC2",125,0)
NONVF() ; Updated 53.1 status to non-verified after finish.
"RTN","PSIVORC2",126,0)
 NEW PSGOEAV S PSGOEAV=+$P(PSJSYSP0,U,9)
"RTN","PSIVORC2",127,0)
 S ^TMP("PSODAOC",$J,"IP NEW IEN")=ON
"RTN","PSIVORC2",128,0)
 I +PSJSYSU=3,PSGOEAV Q 0
"RTN","PSIVORC2",129,0)
 I +PSJSYSU=1,PSGOEAV Q 0
"RTN","PSIVORC2",130,0)
 I PSIVCHG D NWNONVF Q 1
"RTN","PSIVORC2",131,0)
 S P(17)="N",P("REN")=0
"RTN","PSIVORC2",132,0)
 D GTPD^PSIVORE2
"RTN","PSIVORC2",133,0)
 W !,"...transcribing this non-verified order...."
"RTN","PSIVORC2",134,0)
 S $P(^PS(53.1,+ON,.2),U)=""
"RTN","PSIVORC2",135,0)
 D PUT531^PSIVORFA
"RTN","PSIVORC2",136,0)
 D NEWNVAL^PSGAL5(ON,$S(+PSJSYSU=1:22000,+PSJSYSU=3:22005,1:22006),"","")
"RTN","PSIVORC2",137,0)
 I ($G(PSJINFIN)=2) D NEWNVAL^PSGAL5(ON,6000,"OTHER PRINT INFO")
"RTN","PSIVORC2",138,0)
 NEW PSIVORFA S PSIVORFA=1 D:ON["V" DEL55^PSIVORE2
"RTN","PSIVORC2",139,0)
 D VF
"RTN","PSIVORC2",140,0)
 Q 1
"RTN","PSIVORC2",141,0)
NWNONVF ;Create non-verified due to edit
"RTN","PSIVORC2",142,0)
 K DA D ENGNN^PSGOETO S P("NEWON")=DA_"P",P(17)="N",P("REN")=0
"RTN","PSIVORC2",143,0)
 I $D(^PS(53.45,PSJSYSP,6,1)) D FILEOPI^PSJBCMA5(DFN,P("NEWON"))
"RTN","PSIVORC2",144,0)
 S PSJORD=ON,$P(^PS(53.1,+ON,0),U,26,27)=P("NEWON")_U_"E",PSIVAC="CE",PSJORNAT=P("NAT") D DC^PSIVORA
"RTN","PSIVORC2",145,0)
 S P("OLDON")=ON,ON=P("NEWON")
"RTN","PSIVORC2",146,0)
 I $D(^PS(53.1,+P("OLDON"),12)) M ^PS(53.1,+P("NEWON"),12)=^PS(53.1,+P("OLDON"),12)
"RTN","PSIVORC2",147,0)
 S P("RES")="E"
"RTN","PSIVORC2",148,0)
 S P("DO")="" D GTPD^PSIVORE2 ;Get dosage order if not defined for IPM IV
"RTN","PSIVORC2",149,0)
 D PUT531^PSIVORFA
"RTN","PSIVORC2",150,0)
 S $P(^PS(53.1,+ON,0),U,25,26)=P("OLDON")_U_""
"RTN","PSIVORC2",151,0)
 D NEWNVAL^PSGAL5(ON,$S(+PSJSYSU=1:22000,+PSJSYSU=3:22005,1:22006),"","")
"RTN","PSIVORC2",152,0)
 D EN1^PSJHL2(DFN,"SN",ON,"SEND ORDER NUMBER")
"RTN","PSIVORC2",153,0)
 S ^TMP("PSODAOC",$J,"IP NEW IEN")=ON
"RTN","PSIVORC2",154,0)
 S:$D(PSGP)#10 PSJNOL=$$LS^PSSLOCK(PSGP,ON)
"RTN","PSIVORC2",155,0)
 D VF
"RTN","PSIVORC2",156,0)
 Q
"RTN","PSIVORC2",157,0)
VF ; Display Verify screen
"RTN","PSIVORC2",158,0)
 Q:ON'["P"
"RTN","PSIVORC2",159,0)
 K PSJIVBD
"RTN","PSIVORC2",160,0)
 D GT531^PSIVORFA(DFN,ON)
"RTN","PSIVORC2",161,0)
 S:$G(ON)]"" (ON55,PSJORD)=ON ;* CCR 6700
"RTN","PSIVORC2",162,0)
 S PSGACT="EL"
"RTN","PSIVORC2",163,0)
 I P(17)="N",(P("OLDON")=""),(+P("CLRK")=DUZ) S PSGACT="ELD"
"RTN","PSIVORC2",164,0)
 I +PSJSYSU=3!(+PSJSYSU=1) S PSGACT="DELV"
"RTN","PSIVORC2",165,0)
 I +PSJSYSU=3,$L($T(EN1^ORCFLAG)) S PSGACT=PSGACT_"G"
"RTN","PSIVORC2",166,0)
 I P("OT")="I" S PSJSTAR="(1)^(5)^(7)^(9)^(10)"
"RTN","PSIVORC2",167,0)
 I P("OT")'="I" S PSJSTAR="(1)^(2)^(3)^(5)^(7)^(9)"
"RTN","PSIVORC2",168,0)
 I '$G(PSJEDFLG) D
"RTN","PSIVORC2",169,0)
 .D EN^VALM("PSJ LM IV INPT ACTIVE")
"RTN","PSIVORC2",170,0)
 K PSJEDFLG
"RTN","PSIVORC2",171,0)
 ; Only store allergy if not verified after entering the order
"RTN","PSIVORC2",172,0)
 I ($G(ON)["P"),($S(($G(PSJOCFG)="NEW OE IV"):1,($G(PSJOCFG)="FN IV"):1,$G(PSIVENO):1,1:0)) D SETOC^PSJNEWOC(ON)
"RTN","PSIVORC2",173,0)
 Q
"RTN","PSIVORC2",174,0)
 ;
"RTN","PSIVORC2",175,0)
RESET ;Reset PSIVOI("DILIST") for additives with quick codes
"RTN","PSIVORC2",176,0)
 N XX,XXX,CNT S CNT=0
"RTN","PSIVORC2",177,0)
 S XX=0 F  S XX=$O(PSIVOI("DILIST",XX)) Q:XX=""  S CNT=CNT+1,LYN(CNT)=PSIVOI("DILIST",XX,0) D
"RTN","PSIVORC2",178,0)
 . S XXX=0 F  S XXX=$O(PSIVOI("DILIST",XX,XXX)) Q:XXX=""  S CNT=CNT+1,LYN(CNT)=$P(PSIVOI("DILIST",XX,0),"^")_"^"_$P(PSIVOI("DILIST",XX,XXX,0),"^",2)_"^"_$P(PSIVOI("DILIST",XX,XXX,0),"^")_"^"_"QC"
"RTN","PSIVORC2",179,0)
 K PSIVOI("DILIST")
"RTN","PSIVORC2",180,0)
 S PSIVOI("DILIST",0)=CNT_"^*^0^"
"RTN","PSIVORC2",181,0)
 S XX=0 F  S XX=$O(LYN(XX)) Q:'XX  S PSIVOI("DILIST",XX,0)=LYN(XX)
"RTN","PSIVORC2",182,0)
 K LYN
"RTN","PSIVORC2",183,0)
 Q
"RTN","PSJLIACT")
0^2^B54174893^B53210467
"RTN","PSJLIACT",1,0)
PSJLIACT ;BIR/MV - IV ACTION ;28 Jul 98  8:50 AM
"RTN","PSJLIACT",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**15,47,62,58,82,97,80,110,111,134,181,247,260,275,257,299,281,346**;16 DEC 97;Build 10
"RTN","PSJLIACT",3,0)
 ;
"RTN","PSJLIACT",4,0)
 ; Reference to ^PS(55 is supported by DBIA 2191.
"RTN","PSJLIACT",5,0)
 ; Reference to MAIN^TIUEDIT is supported by DBIA 2410.
"RTN","PSJLIACT",6,0)
 ; Reference to ^TMP("PSODAOC",$J supported by DBIA 6071.
"RTN","PSJLIACT",7,0)
 ;
"RTN","PSJLIACT",8,0)
DC ; Discontinue order
"RTN","PSJLIACT",9,0)
 K PSGORQF
"RTN","PSJLIACT",10,0)
 D HOLDHDR^PSJOE
"RTN","PSJLIACT",11,0)
 S PSJCOM=+$S(PSJORD["V":$P($G(^PS(55,DFN,"IV",+PSJORD,.2)),"^",8),1:$P($G(^PS(53.1,+PSJORD,.2)),"^",8))
"RTN","PSJLIACT",12,0)
 I PSJCOM W !!,"This order is part of a complex order. If you discontinue this order the",!,"following orders will be discontinued too (unless the stop date has already",!,"been reached)." D CMPLX^PSJCOM1(PSGP,PSJCOM,PSJORD)
"RTN","PSJLIACT",13,0)
 I PSJCOM F  W !!,"Do you want to discontinue this order" S %=1 D YN^DICN Q:%  D ENCOM^PSGOEM
"RTN","PSJLIACT",14,0)
 I PSJCOM,%'=1 S VALMBK="" Q
"RTN","PSJLIACT",15,0)
 I $G(ON55)["P",$G(PSIVOORD) S PSJORD=ON55 ;*247 - Correct DCing newly copied orders
"RTN","PSJLIACT",16,0)
 I PSJORD["V" D DC^PSIVORA D:'$G(PSJOCFLG) EN^PSJLIORD(DFN,ON) Q
"RTN","PSJLIACT",17,0)
 I PSJORD["P" N ON S ON=PSJORD D DISCONT^PSIVORC
"RTN","PSJLIACT",18,0)
 S VALMBCK="Q"
"RTN","PSJLIACT",19,0)
 Q
"RTN","PSJLIACT",20,0)
ACEDIT ; Display LM screen and AC and EDit actions
"RTN","PSJLIACT",21,0)
 D EN^PSJLIVMD
"RTN","PSJLIACT",22,0)
 S VALMBCK=$S($G(PSIVACEP):"Q",1:"R")
"RTN","PSJLIACT",23,0)
 Q
"RTN","PSJLIACT",24,0)
AEEXIT ; Call for EXIT CODE in PSJ LM IV AC/EDIT
"RTN","PSJLIACT",25,0)
 K PSGORQF
"RTN","PSJLIACT",26,0)
 D:ON["V" GT55^PSIVORFB
"RTN","PSJLIACT",27,0)
 I ON["P" D GT531^PSIVORFA(DFN,ON) D:P("OT")'="I" GTDATA^PSJLIFN
"RTN","PSJLIACT",28,0)
 D EN^PSJLIVMD
"RTN","PSJLIACT",29,0)
 K PSIVENO
"RTN","PSJLIACT",30,0)
 Q
"RTN","PSJLIACT",31,0)
EDIT ; Edit order
"RTN","PSJLIACT",32,0)
 K PSIVFN1
"RTN","PSJLIACT",33,0)
 I $D(PSGACT),PSGACT'["E" W !,"This order may not be edited." D PAUSE^VALM1 Q
"RTN","PSJLIACT",34,0)
 D EDIT1
"RTN","PSJLIACT",35,0)
 Q:$D(PSIVNBD)!($G(PSIVCOPY)&'$G(PSIVENO))
"RTN","PSJLIACT",36,0)
 D EN^PSJLIVMD
"RTN","PSJLIACT",37,0)
 S VALMBCK=$S($G(PSIVFN1):"Q",1:"R")
"RTN","PSJLIACT",38,0)
 S PSJEDFLG=1 ;PSJ*346  Prevent double order display
"RTN","PSJLIACT",39,0)
 Q
"RTN","PSJLIACT",40,0)
EDIT1 ;
"RTN","PSJLIACT",41,0)
 K PSGORQF,PSJOCCHK ;,PSIVENO   PSJ*346 Removed PSIVENO from kill statement
"RTN","PSJLIACT",42,0)
 ;Ensure P() is defined
"RTN","PSJLIACT",43,0)
 I $D(P)<10 S XQORQUIT=1,P("PON")="",PSIVNBD=1 D  Q
"RTN","PSJLIACT",44,0)
 .W !,"WARNING: An error has occurred. Changes will not be saved"
"RTN","PSJLIACT",45,0)
 .D PAUSE^VALM1
"RTN","PSJLIACT",46,0)
 .S VALMBCK="Q"
"RTN","PSJLIACT",47,0)
 I "ANP"'[P(17) W !,"You cannot edit an inactive order" D PAUSE^VALM1 Q
"RTN","PSJLIACT",48,0)
 S:$G(ON55)="" ON55=$G(PSJORD)
"RTN","PSJLIACT",49,0)
 D HOLDHDR^PSJOE
"RTN","PSJLIACT",50,0)
 N PSIEDITO S PSIEDITO=1
"RTN","PSJLIACT",51,0)
 ;* Edit a new back door order
"RTN","PSJLIACT",52,0)
 I ($G(ON55)["V"&($G(P("21FLG"))="")) D  Q
"RTN","PSJLIACT",53,0)
 . D GSTRING^PSIVORE1,GTFLDS^PSIVORFE
"RTN","PSJLIACT",54,0)
 . I $G(ON55)["V",'$G(DONE) D OK^PSIVORE
"RTN","PSJLIACT",55,0)
 . S VALMBCK="Q",PSIVNBD=1
"RTN","PSJLIACT",56,0)
 ;* Edit an active order
"RTN","PSJLIACT",57,0)
 I $G(ON55)["V" NEW PSJEDIT1 D E^PSIVOPT1 D  Q
"RTN","PSJLIACT",58,0)
 . I $G(PSJIVBD) K PSJIVBD D EN^PSJLIORD(DFN,ON)
"RTN","PSJLIACT",59,0)
 I $G(ON55)["P" D EDIT^PSIVORC ;Edit incomplete order.
"RTN","PSJLIACT",60,0)
 K P("OVRIDE")
"RTN","PSJLIACT",61,0)
 Q
"RTN","PSJLIACT",62,0)
ACCEPT ; Accept order
"RTN","PSJLIACT",63,0)
 D HOLDHDR^PSJOE
"RTN","PSJLIACT",64,0)
 ;Accept IV from back door.
"RTN","PSJLIACT",65,0)
 I $G(PSJIVBD) K PSJIVBD D OK^PSIVORE S VALMBCK="Q" Q
"RTN","PSJLIACT",66,0)
 ;D:'$G(PSGORQF) IN^PSJOCDS($G(ON),"IV","") Q:$G(PSGORQF)
"RTN","PSJLIACT",67,0)
 I ON["V" D ACCEPT^PSIVOPT1 S:'$G(PSGORQF) PSJDSVFY=1 Q
"RTN","PSJLIACT",68,0)
 S PSIVFN1=1
"RTN","PSJLIACT",69,0)
 D COMPLTE^PSIVORC1
"RTN","PSJLIACT",70,0)
 K ^TMP("PSODAOC",$J)
"RTN","PSJLIACT",71,0)
 S VALMBCK="Q"
"RTN","PSJLIACT",72,0)
 Q
"RTN","PSJLIACT",73,0)
R ; Renewal
"RTN","PSJLIACT",74,0)
 K PSGORQF,PSJOCCHK,PSIVENO
"RTN","PSJLIACT",75,0)
 S PSJREN=1
"RTN","PSJLIACT",76,0)
 D HOLDHDR^PSJOE
"RTN","PSJLIACT",77,0)
 NEW PSIVAC S PSIVAC="PR" K PSGFDX
"RTN","PSJLIACT",78,0)
 D R^PSIVOPT
"RTN","PSJLIACT",79,0)
 D EN^PSJLIORD(DFN,ON)
"RTN","PSJLIACT",80,0)
 K PSJREN,^TMP("PSODAOC",$J)
"RTN","PSJLIACT",81,0)
 Q
"RTN","PSJLIACT",82,0)
H ; Hold
"RTN","PSJLIACT",83,0)
 K PSGORQF
"RTN","PSJLIACT",84,0)
 NEW TEX S TEX="Active order ***"
"RTN","PSJLIACT",85,0)
 D HOLDHDR^PSJOE
"RTN","PSJLIACT",86,0)
 D H^PSIVOPT(DFN,ON,P(17),P(3))
"RTN","PSJLIACT",87,0)
 D:P(17)="A" PAUSE^VALM1
"RTN","PSJLIACT",88,0)
 D EN^PSJLIORD(DFN,ON)
"RTN","PSJLIACT",89,0)
 Q
"RTN","PSJLIACT",90,0)
L ; Activity Log
"RTN","PSJLIACT",91,0)
 NEW PSIVLAB,PSIVLOG,PSJHIS S (PSIVLAB,PSIVLOG)=1
"RTN","PSJLIACT",92,0)
 D EN^PSIVVW1
"RTN","PSJLIACT",93,0)
 D EN^PSJLIVMD
"RTN","PSJLIACT",94,0)
 S VALMBCK="R"
"RTN","PSJLIACT",95,0)
 Q
"RTN","PSJLIACT",96,0)
O ; On Call
"RTN","PSJLIACT",97,0)
 K PSGORQF
"RTN","PSJLIACT",98,0)
 NEW TEX S TEX="Active order ***"
"RTN","PSJLIACT",99,0)
 D HOLDHDR^PSJOE
"RTN","PSJLIACT",100,0)
 D O^PSIVOPT(DFN,ON,P(17),P(3))
"RTN","PSJLIACT",101,0)
 D:P(17)="A" PAUSE^VALM1
"RTN","PSJLIACT",102,0)
 D EN^PSJLIORD(DFN,ON)
"RTN","PSJLIACT",103,0)
 Q
"RTN","PSJLIACT",104,0)
VF ; Make the order active **ENHANCEMENTS MADE IN PSJ*5.0*260
"RTN","PSJLIACT",105,0)
 NEW PSIVCHG,PSGORQF,PSJVFF S PSIVCHG=0
"RTN","PSJLIACT",106,0)
 ;IF VALM("TITLE")="ACTIVE IV " W !!,">>>  Verify may not be selected at this point." D PAUSE^VALM1 S VALMBCK="R" Q  ;PSJ*5*281 CCR 6995 Remedy ticket 861870
"RTN","PSJLIACT",107,0)
 ;ELSE  IF $G(PSGSTAT)="NON-VERIFIED",$G(PSJNEWOE)=0 S PSJVFF=1 D EN^PSJGMRA($G(DFN),$G(PSGPD)),IN^PSJOCDS($G(PSGORD),"IV",""),OC^PSIVOC K PSJVFF Q:$G(PSGORQF)
"RTN","PSJLIACT",108,0)
 ;PSGSTAT may not set for IV orders. Checking PSJOCFG so DI,DT is not displayed again for FN, CO, RN...
"RTN","PSJLIACT",109,0)
 IF (($G(PSGSTAT)="NON-VERIFIED")!($G(P(17))="N")&($G(PSJOCFG)="")),'+$G(PSJNEWOE) D
"RTN","PSJLIACT",110,0)
 .S PSJVFF=1 D:'$G(PSJENHOC)&'$G(PSGORQF) OC^PSIVOC D:('$G(PSGORQF)&'$G(PSJDSVFY)) IN^PSJOCDS($G(PSGORD),"IV","") K PSJVFF Q:$G(PSGORQF)
"RTN","PSJLIACT",111,0)
 Q:$G(PSGORQF)
"RTN","PSJLIACT",112,0)
 ELSE  IF '$G(PSGORQF),(ON["V") S ON55=ON D VF1("V","ORDER VERIFIED BY ",1) Q
"RTN","PSJLIACT",113,0)
 ELSE  IF $G(PSIVFN1),(ON["V") S ON55=ON D VF1("V","ORDER VERIFIED BY ",1) Q
"RTN","PSJLIACT",114,0)
 ELSE  IF $G(PSGDEF),(ON["V") S ON55=ON D VF1("V","ORDER VERIFIED BY ",1) Q
"RTN","PSJLIACT",115,0)
 ELSE  IF $G(PSIVCOPY),(ON["V") S ON55=ON D VF1("V","ORDER VERIFIED BY ",1) Q
"RTN","PSJLIACT",116,0)
 D ACTIVE^PSIVORC2
"RTN","PSJLIACT",117,0)
 Q
"RTN","PSJLIACT",118,0)
VF1(PSIVREA,PSIVAL,PSIVLOG) ;
"RTN","PSJLIACT",119,0)
 ;Update 4 node and set activity log.
"RTN","PSJLIACT",120,0)
 ;PSIVREA: the reason use by LOG^PSIVORAL
"RTN","PSJLIACT",121,0)
 ;PSIVAL : the description reason
"RTN","PSJLIACT",122,0)
 ;PSIVLOG: Log an activity if = 1
"RTN","PSJLIACT",123,0)
 K PSGORQF
"RTN","PSJLIACT",124,0)
 I '+$G(OD)!($L($G(OD))>16) K OD
"RTN","PSJLIACT",125,0)
 D:+PSJSYSU=3 ^PSIVORE1
"RTN","PSJLIACT",126,0)
 NEW DIE,DA,DR,PSJX,XX,PSIVACT,PSJRQND
"RTN","PSJLIACT",127,0)
 S PSIVACT=1
"RTN","PSJLIACT",128,0)
 S PSJX=$G(^PS(55,DFN,"IV",+ON55,4)),XX=""
"RTN","PSJLIACT",129,0)
 I $P(PSJX,U)="" S XX=";143////0"
"RTN","PSJLIACT",130,0)
 I $P(PSJX,U,4)="" S XX=XX_U_";142////0"
"RTN","PSJLIACT",131,0)
 D NOW^%DTC
"RTN","PSJLIACT",132,0)
 S DIE="^PS(55,"_DFN_",""IV"",",DA=+ON55,DA(1)=DFN
"RTN","PSJLIACT",133,0)
 I +PSJSYSU=3 S DR="140////"_DUZ_";141////"_$E(%,1,12)_";142////1"_$P(XX,U)
"RTN","PSJLIACT",134,0)
 I +PSJSYSU=1 S DR="16////"_DUZ_";17////"_$E(%,1,12)_";143////1"_$P(XX,U,2)
"RTN","PSJLIACT",135,0)
 I $G(P("PRY"))="D" S DR=DR_";.22////"_+P("IVRM")
"RTN","PSJLIACT",136,0)
 D ^DIE
"RTN","PSJLIACT",137,0)
 ; If pending IV renew is edited during finish, go back and DE the original active order left in RENEWED status
"RTN","PSJLIACT",138,0)
 S PREREN=$S(ON55["V":$G(@(DIE_"+ON55,2)")),1:""),PREREN=$P(PREREN,"^",5) I PREREN D  K PREREN
"RTN","PSJLIACT",139,0)
 . I PREREN["P" S PREREN=$G(@("^PS(53.1,+PREREN,0)")),PREREN=$P(PREREN,"^",25)
"RTN","PSJLIACT",140,0)
 . I PREREN["V" N PRERENOD S PRERENOD=$G(@("^PS(55,DFN,""IV"",+PREREN,0)")) I $P(PRERENOD,"^",17)="R",($G(P("RES"))="E") D
"RTN","PSJLIACT",141,0)
 ..  S DIE="^PS(55,"_DFN_",""IV"",",DA=+PREREN,DA(1)=DFN
"RTN","PSJLIACT",142,0)
 ..  S DR="100////D;.03////"_PSGDT S ORIGSTOP=$P($G(@("^PS(55,DFN,""IV"",+PREREN,2)")),"^",3) I ORIGSTOP S DR=DR_";116////"_ORIGSTOP
"RTN","PSJLIACT",143,0)
 ..  D ^DIE D EN1^PSJHL2(DFN,"SC",PREREN)
"RTN","PSJLIACT",144,0)
 K DR,DIE,DA
"RTN","PSJLIACT",145,0)
 I (+PSJSYSU=3)&($G(P("PRY"))="D") D
"RTN","PSJLIACT",146,0)
 .N DIR W ! S DIR(0)="S^Y:Yes;N:No",DIR("A")="Do you want to enter a Progress Note",DIR("B")="No" D ^DIR
"RTN","PSJLIACT",147,0)
 .Q:Y="N"
"RTN","PSJLIACT",148,0)
 .D MAIN^TIUEDIT(3,.TIUDA,DFN,"","","","",1)
"RTN","PSJLIACT",149,0)
 Q:'$G(PSIVLOG)
"RTN","PSJLIACT",150,0)
 I $G(P("PACT"))]"",+$P(P("PACT"),U,2),+$P(P("PACT"),U,3) D
"RTN","PSJLIACT",151,0)
 . NEW DIC,DA,X,Y,XX,DO D NAME^PSJBCMA1($P(P("PACT"),U,2),.XX)
"RTN","PSJLIACT",152,0)
 . S DIC(0)="L",DA(1)=DFN,DA(2)=+ON55,X=1
"RTN","PSJLIACT",153,0)
 . S DIC="^PS(55,"_DA(1)_",""IV"","_DA(2)_",""A"","
"RTN","PSJLIACT",154,0)
 . S DIC("DR")=".02////F;.03////"_XX_";.04////"_$P($G(^PS(53.3,+$P(P("PACT"),U,3),0)),U)_";.05////"_$P(P("PACT"),U)_";.06////"_$P(P("PACT"),U,2)
"RTN","PSJLIACT",155,0)
 . D FILE^DICN
"RTN","PSJLIACT",156,0)
 NEW PSIVALCK
"RTN","PSJLIACT",157,0)
 S PSIVREA="V",PSIVALT=""
"RTN","PSJLIACT",158,0)
 S PSIVAL=PSIVAL_$S(+PSJSYSU=3:"PHARMACIST",1:"NURSE")
"RTN","PSJLIACT",159,0)
 D LOG^PSIVORAL K PSIVAL,PSIVREA,PSIVLN
"RTN","PSJLIACT",160,0)
 I $G(PSJORD)["P" S PSIVREA="V",PSIVALT="",PSGRDTX=$G(^PS(53.1,+PSJORD,2.5)) D
"RTN","PSJLIACT",161,0)
 . I $G(PSGRDTX) S PSIVAL="Requested Start Date: "_$$ENDTC^PSGMI($$DATE2^PSJUTL2($P(PSGRDTX,U))) D LOG^PSIVORAL
"RTN","PSJLIACT",162,0)
 . I $P(PSGRDTX,U,3) S PSIVREA="V",PSIVALT="" S PSIVAL="Requested Stop Date: "_$$ENDTC^PSGMI($$DATE2^PSJUTL2($P(PSGRDTX,U,3))) D LOG^PSIVORAL
"RTN","PSJLIACT",163,0)
 N DUR I $G(PSJORD) S DUR=$$GETDUR^PSJLIVMD(DFN,+PSJORD,$S(PSJORD["P":"P",1:"IV"),1) I DUR]""  D
"RTN","PSJLIACT",164,0)
 . K DR S DIE="^PS(55,"_DFN_",""IV"",",DA=+ON55,DA(1)=DFN
"RTN","PSJLIACT",165,0)
 . S DR=$S($G(IVLIMIT):"152////"_DUR,1:"151////"_DUR) K IVLIMIT
"RTN","PSJLIACT",166,0)
 . D ^DIE
"RTN","PSJLIACT",167,0)
 S ^TMP("PSODAOC",$J,"IP NEW IEN")=ON55
"RTN","PSJLIACT",168,0)
 D EN1^PSJHL2(DFN,"SC",ON55),SETOC^PSJNEWOC(ON55)
"RTN","PSJLIACT",169,0)
 D:+PSJSYSU=1 EN1^PSJHL2(DFN,"ZV",ON55)
"RTN","PSJLIACT",170,0)
 I '$D(^PS(55,DFN,"IV","CIMOI",+ON55)) D CIMOI^PSJIMO1(DFN,ON55,"",$G(PSJORD))
"RTN","PSJLIACT",171,0)
 E  I +$G(PSJORD) D KILL531^PSJIMO1(DFN,"",PSJORD)
"RTN","PSJLIACT",172,0)
 D GT55^PSIVORFB S OLDON=$P($G(^PS(55,DFN,"IV",+ON55,2)),"^",5),P("OLDON")=OLDON
"RTN","PSJLIACT",173,0)
 N PSJPRIO,PSJSCH,NODE0,NODEP2 S NODE0=$G(^PS(55,DFN,"IV",+ON55,0)),NODEP2=$G(^PS(55,DFN,"IV",+ON55,.2))
"RTN","PSJLIACT",174,0)
 S PSJPRIO=$P(NODEP2,"^",4),PSJSCH=$P(NODE0,"^",9)
"RTN","PSJLIACT",175,0)
 I (",S,A,")[(","_$G(PSJPRIO)_",")!($G(PSJSCH)="NOW")!($G(PSJSCH)["STAT") D NOTIFY^PSJHL4(ON55,DFN,$G(PSJPRIO),$G(PSJSCH))
"RTN","PSJLIACT",176,0)
 Q
"VER")
8.0^22.2
"BLD",10683,6)
^298
**END**
**END**

