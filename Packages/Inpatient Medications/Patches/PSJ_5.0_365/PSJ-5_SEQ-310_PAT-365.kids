Released PSJ*5*365 SEQ #310
Extracted from mail message
**KIDS**:PSJ*5.0*365^

**INSTALL NAME**
PSJ*5.0*365
"BLD",11023,0)
PSJ*5.0*365^INPATIENT MEDICATIONS^0^3180323^y
"BLD",11023,1,0)
^^2^2^3180322^^
"BLD",11023,1,1,0)
UNDEFINED error when running the PADE On-Hand Amounts or the PADE 
"BLD",11023,1,2,0)
Transaction Reports
"BLD",11023,4,0)
^9.64PA^^
"BLD",11023,6.3)
2
"BLD",11023,"ABPKG")
n
"BLD",11023,"KRN",0)
^9.67PA^779.2^20
"BLD",11023,"KRN",.4,0)
.4
"BLD",11023,"KRN",.401,0)
.401
"BLD",11023,"KRN",.402,0)
.402
"BLD",11023,"KRN",.403,0)
.403
"BLD",11023,"KRN",.5,0)
.5
"BLD",11023,"KRN",.84,0)
.84
"BLD",11023,"KRN",3.6,0)
3.6
"BLD",11023,"KRN",3.8,0)
3.8
"BLD",11023,"KRN",9.2,0)
9.2
"BLD",11023,"KRN",9.8,0)
9.8
"BLD",11023,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",11023,"KRN",9.8,"NM",1,0)
PSJPDRUT^^0^B233235334
"BLD",11023,"KRN",9.8,"NM","B","PSJPDRUT",1)

"BLD",11023,"KRN",19,0)
19
"BLD",11023,"KRN",19.1,0)
19.1
"BLD",11023,"KRN",101,0)
101
"BLD",11023,"KRN",409.61,0)
409.61
"BLD",11023,"KRN",771,0)
771
"BLD",11023,"KRN",779.2,0)
779.2
"BLD",11023,"KRN",870,0)
870
"BLD",11023,"KRN",8989.51,0)
8989.51
"BLD",11023,"KRN",8989.52,0)
8989.52
"BLD",11023,"KRN",8994,0)
8994
"BLD",11023,"KRN","B",.4,.4)

"BLD",11023,"KRN","B",.401,.401)

"BLD",11023,"KRN","B",.402,.402)

"BLD",11023,"KRN","B",.403,.403)

"BLD",11023,"KRN","B",.5,.5)

"BLD",11023,"KRN","B",.84,.84)

"BLD",11023,"KRN","B",3.6,3.6)

"BLD",11023,"KRN","B",3.8,3.8)

"BLD",11023,"KRN","B",9.2,9.2)

"BLD",11023,"KRN","B",9.8,9.8)

"BLD",11023,"KRN","B",19,19)

"BLD",11023,"KRN","B",19.1,19.1)

"BLD",11023,"KRN","B",101,101)

"BLD",11023,"KRN","B",409.61,409.61)

"BLD",11023,"KRN","B",771,771)

"BLD",11023,"KRN","B",779.2,779.2)

"BLD",11023,"KRN","B",870,870)

"BLD",11023,"KRN","B",8989.51,8989.51)

"BLD",11023,"KRN","B",8989.52,8989.52)

"BLD",11023,"KRN","B",8994,8994)

"BLD",11023,"QDEF")
^^^^NO^^^^NO^^NO
"BLD",11023,"QUES",0)
^9.62^^
"BLD",11023,"REQB",0)
^9.611^1^1
"BLD",11023,"REQB",1,0)
PSJ*5.0*317^2
"BLD",11023,"REQB","B","PSJ*5.0*317",1)

"MBREQ")
0
"PKG",471,-1)
1^1
"PKG",471,0)
INPATIENT MEDICATIONS^PSJ^UNIT DOSE AND IVS
"PKG",471,20,0)
^9.402P^^
"PKG",471,22,0)
^9.49I^1^1
"PKG",471,22,1,0)
5.0^2971215^2990325^66481
"PKG",471,22,1,"PAH",1,0)
365^3180323
"PKG",471,22,1,"PAH",1,1,0)
^^2^2^3180323
"PKG",471,22,1,"PAH",1,1,1,0)
UNDEFINED error when running the PADE On-Hand Amounts or the PADE 
"PKG",471,22,1,"PAH",1,1,2,0)
Transaction Reports
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","PSJPDRUT")
0^1^B233235334^B233123274
"RTN","PSJPDRUT",1,0)
PSJPDRUT ;BIR/MV-PADE REPORT UTILITIES ; 3/22/18 9:36am
"RTN","PSJPDRUT",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**317,365**;16 DEC 97;Build 2
"RTN","PSJPDRUT",3,0)
 ;
"RTN","PSJPDRUT",4,0)
 ; Reference to ^%DT is supported by DBIA 10003.
"RTN","PSJPDRUT",5,0)
 ; Reference to CLEAR^VALM1 is supported by DBIA 10116.
"RTN","PSJPDRUT",6,0)
 ; Reference to ^XLFDT is supported by DBIA 10103.
"RTN","PSJPDRUT",7,0)
 ; Reference to ^DPT supported by DBIA 10035
"RTN","PSJPDRUT",8,0)
 ; Reference to ^PSDRUG supported by DBIA 2192
"RTN","PSJPDRUT",9,0)
 Q
"RTN","PSJPDRUT",10,0)
 ;
"RTN","PSJPDRUT",11,0)
DATE(BEGEND,PSJSTOP,PSJINP) ; Prompt for Start Date
"RTN","PSJPDRUT",12,0)
 N DIR,X,Y,DATE,PSJNOW,PSJDONE,TMPY,DUOUT,DTOUT
"RTN","PSJPDRUT",13,0)
 S PSJNOW=$$NOW^XLFDT
"RTN","PSJPDRUT",14,0)
 K %DT S %DT("A")="Enter"_$S($G(BEGEND)="B":" Start ",$G(BEGEND)="E":" End ",1:" ")_"Date: ",%DT="TAE"
"RTN","PSJPDRUT",15,0)
 F  Q:$G(PSJSTOP)!$G(PSJDONE)  D
"RTN","PSJPDRUT",16,0)
 .D ^%DT S TMPY=Y I ($D(DTOUT))!$G(DUOUT) S PSJSTOP=1 Q
"RTN","PSJPDRUT",17,0)
 .I ($G(BEGEND)="E"),($G(X)="T") S TMPY=$P(TMPY,".")_".24"
"RTN","PSJPDRUT",18,0)
 .I $G(TMPY)<1 D  Q
"RTN","PSJPDRUT",19,0)
 ..I $E(X)="^" S PSJSTOP=1 Q
"RTN","PSJPDRUT",20,0)
 ..W !,?3,$S(BEGEND="B":"Start ",1:"End ")_"Date is required"
"RTN","PSJPDRUT",21,0)
 .I $G(BEGEND)="B" I TMPY>($$FMADD^XLFDT(PSJNOW)) D  Q
"RTN","PSJPDRUT",22,0)
 ..W $C(7),!?3,"Start Date cannot be in the future. Re-enter Start Date."
"RTN","PSJPDRUT",23,0)
 .I $G(BEGEND)="E",$G(PSJINP("PSJBDT")) I TMPY<PSJINP("PSJBDT") D  Q
"RTN","PSJPDRUT",24,0)
 ..W $C(7),!?3,"End Date cannot be before Start Date. Re-enter End Date."
"RTN","PSJPDRUT",25,0)
 .S PSJDONE=1
"RTN","PSJPDRUT",26,0)
 S:$G(PSJSTOP) TMPY=""
"RTN","PSJPDRUT",27,0)
 S DATE=TMPY
"RTN","PSJPDRUT",28,0)
 I $G(BEGEND)="E",($P(DATE,".",2)="") S DATE=$$FMADD^XLFDT($P(DATE,"."),1)
"RTN","PSJPDRUT",29,0)
 Q DATE
"RTN","PSJPDRUT",30,0)
 ;
"RTN","PSJPDRUT",31,0)
SELUSER(PSJINP,USER,SELUSER,USERX,PSJSTOP) ; Prompt for one user (or ALL)
"RTN","PSJPDRUT",32,0)
 N DIR,X,Y,USRNAME,DUOUT,DTOUT,PSFOUND,PSALLPC
"RTN","PSJPDRUT",33,0)
 N PSJPART,II,PSELMSG,PLSTMSG
"RTN","PSJPDRUT",34,0)
 W ! D EN^DDIOL("  Enter '^ALL' to select all Users associated with selected PADE transactions.") W !
"RTN","PSJPDRUT",35,0)
 S PLSTMSG(1)="Transactions matching the entered Date Range and Division "
"RTN","PSJPDRUT",36,0)
 S PLSTMSG(2)="exist for the Users listed below."
"RTN","PSJPDRUT",37,0)
 S DIR(0)="FAO^1:30",DIR("?")="^D LIST^PSJPDRTR(.USER,.PLSTMSG,15)"
"RTN","PSJPDRUT",38,0)
 S DIR("A")="Select User: "_$S($D(SELUSER)>1:"",1:"^ALL//")
"RTN","PSJPDRUT",39,0)
 D ^DIR I X="" S Y=$S($D(SELUSER)<10:"ALL",1:"")
"RTN","PSJPDRUT",40,0)
 I $E(X)="^" S Y=$$XALL^PSJPDRIP(X)
"RTN","PSJPDRUT",41,0)
 I $G(DUOUT)!$G(DTOUT) S PSJSTOP=1 Q
"RTN","PSJPDRUT",42,0)
 I Y="ALL" M SELUSER=USER S SELUSER="ALL",PSJDONE=1 Q
"RTN","PSJPDRUT",43,0)
 I Y="" D  Q
"RTN","PSJPDRUT",44,0)
 .I $D(SELUSER)>1 S PSJDONE=1 Q
"RTN","PSJPDRUT",45,0)
 .W !!?2,"Select a single User, several Items or enter ^ALL to select all Items."
"RTN","PSJPDRUT",46,0)
 S PSJY=Y
"RTN","PSJPDRUT",47,0)
 I $D(USER(PSJY)) D  Q
"RTN","PSJPDRUT",48,0)
 .W "  ",USER(PSJY) S SELUSER(PSJY)=""
"RTN","PSJPDRUT",49,0)
 I $D(USERX(PSJY)) D  Q
"RTN","PSJPDRUT",50,0)
 .W "  ",USERX(PSJY) S SELUSER(USERX(PSJY))=""
"RTN","PSJPDRUT",51,0)
 S PSELMSG="Select a User"
"RTN","PSJPDRUT",52,0)
 S PSALLPC=1  ; return all data pieces from partial lookup
"RTN","PSJPDRUT",53,0)
 D PARTIAL^PSJPADPT(PSJY,.USER,.SELUSER,1,PSELMSG,,.PSFOUND,,PSALLPC)
"RTN","PSJPDRUT",54,0)
 Q:$G(PSFOUND)
"RTN","PSJPDRUT",55,0)
 W "  ?? (No match found)"
"RTN","PSJPDRUT",56,0)
 ;
"RTN","PSJPDRUT",57,0)
 Q
"RTN","PSJPDRUT",58,0)
 ;
"RTN","PSJPDRUT",59,0)
LIST(LIST,MSG) ; Write list in LIST(ID1)=ID1
"RTN","PSJPDRUT",60,0)
 N II,DRGNAME,NUMBER,TAB,NAME,ID1,ID2
"RTN","PSJPDRUT",61,0)
 S $P(TAB," ",80)=""
"RTN","PSJPDRUT",62,0)
 Q:$D(LIST)<10
"RTN","PSJPDRUT",63,0)
 I $L($G(MSG)) W !,MSG,!
"RTN","PSJPDRUT",64,0)
 I $D(MSG)>1 D  W !
"RTN","PSJPDRUT",65,0)
 .S II=0 F  S II=$O(MSG(II)) Q:'II  W !,MSG(II)
"RTN","PSJPDRUT",66,0)
 S ID1="" F  S ID1=$O(LIST(ID1)) Q:ID1=""  D
"RTN","PSJPDRUT",67,0)
 .I LIST(ID1)="" W !,$E(TAB,1,10)_ID1 Q
"RTN","PSJPDRUT",68,0)
 .W !,$E(TAB,1,14-$L(ID1))_ID1_"    "_$P(LIST(ID1),"^")_" "_$P(LIST(ID1),"^",2)
"RTN","PSJPDRUT",69,0)
 Q
"RTN","PSJPDRUT",70,0)
 ;
"RTN","PSJPDRUT",71,0)
USERLIST(PSJINP,USER,USERX) ; Get list of selectable users in transactions matching date range, PADE device, and drug item criteria
"RTN","PSJPDRUT",72,0)
 ;  INPUT: PSJINP("
"RTN","PSJPDRUT",73,0)
 ; OUTPUT: USER
"RTN","PSJPDRUT",74,0)
 ;
"RTN","PSJPDRUT",75,0)
 N PSJDEV,PADEV,PSDRG,PSJBDT,PSJEDT,PSJTRDT,TRANS,PSJDONE,PSUNAME,PSJII,PSJHTM,PSJDOTS
"RTN","PSJPDRUT",76,0)
 S PSJHTM=$P($H,",",2),PSJDOTS=""
"RTN","PSJPDRUT",77,0)
 K USER S PSJII=1
"RTN","PSJPDRUT",78,0)
 M PSJDEV=PSJINP("PADEV")
"RTN","PSJPDRUT",79,0)
 M PSDRG=PSJINP("PSDRG")
"RTN","PSJPDRUT",80,0)
 S PSJBDT=$G(PSJINP("PSJBDT"))
"RTN","PSJPDRUT",81,0)
 S PSJEDT=$G(PSJINP("PSJEDT"))
"RTN","PSJPDRUT",82,0)
 S USER="" F  S USER=$O(^PS(58.6,"USR",USER)) Q:USER=""  D
"RTN","PSJPDRUT",83,0)
 .S PSJTRDT=$$FMADD^XLFDT(PSJEDT,,,,1),PSJDONE=0
"RTN","PSJPDRUT",84,0)
 .D DISPDOTS^PSJPDRUT(.PSJHTM,.PSJDOTS,1)
"RTN","PSJPDRUT",85,0)
 .F  S PSJTRDT=$O(^PS(58.6,"USR",USER,PSJTRDT),-1) Q:(PSJTRDT<PSJBDT)!$G(PSJDONE)!(PSJTRDT="")  D
"RTN","PSJPDRUT",86,0)
 ..D DISPDOTS^PSJPDRUT(.PSJHTM,.PSJDOTS,1)
"RTN","PSJPDRUT",87,0)
 ..S TRANS=0 F  S TRANS=$O(^PS(58.6,"USR",USER,PSJTRDT,TRANS)) Q:'TRANS!$G(PSJDONE)  D
"RTN","PSJPDRUT",88,0)
 ...N CAB,SYS
"RTN","PSJPDRUT",89,0)
 ...S CAB=$P($G(^PS(58.6,+TRANS,0)),"^",2) I CAB]"" Q:'$D(PSJINP("PADEV",CAB))
"RTN","PSJPDRUT",90,0)
 ...S SYS=$P($G(^PS(58.6,+TRANS,1)),"^",3) I SYS]"" Q:SYS'=$G(PSJINP("PSJPSYSE"))
"RTN","PSJPDRUT",91,0)
 ...S PSUNAME=$P($G(^PS(58.6,+TRANS,5)),"^",2)
"RTN","PSJPDRUT",92,0)
 ...S:$TR(PSUNAME,",")="" PSUNAME="PADE,USER"
"RTN","PSJPDRUT",93,0)
 ...S USER(USER)=PSUNAME,USERX(PSUNAME)=USER
"RTN","PSJPDRUT",94,0)
 ...S PSJDONE=1,PSJII=PSJII+1
"RTN","PSJPDRUT",95,0)
 Q
"RTN","PSJPDRUT",96,0)
 ;
"RTN","PSJPDRUT",97,0)
DRUGSEL(PSJINP,INDRUG,OUTDRUG,DRWPCK,PSJSTOP) ; Select drug(s) via screened ^PSDRUG lookup
"RTN","PSJPDRUT",98,0)
 N COUNT,PSJCNT,DIR,X,Y,PSJDONE,DRGLIST,DRGNAME,PSJY,DRGN,PSJTMP,DUOUT,DTOUT
"RTN","PSJPDRUT",99,0)
 K DRWPCK
"RTN","PSJPDRUT",100,0)
 M DRGLIST=INDRUG
"RTN","PSJPDRUT",101,0)
 S COUNT=0,PSJDONE=0
"RTN","PSJPDRUT",102,0)
 D DRUGLIST^PSJPDRIN(.PSJINP,.DRGLIST)
"RTN","PSJPDRUT",103,0)
 I $D(DRGLIST)<10 D  Q
"RTN","PSJPDRUT",104,0)
 .S PSJSTOP=1
"RTN","PSJPDRUT",105,0)
 .W !!,"Drug Item: "
"RTN","PSJPDRUT",106,0)
 .W !," No Drug Items available for selection.."
"RTN","PSJPDRUT",107,0)
 .S DIR(0)="E" D ^DIR
"RTN","PSJPDRUT",108,0)
 W ! D EN^DDIOL("  Enter '^ALL' to select all available drug items ") W !
"RTN","PSJPDRUT",109,0)
 F  Q:$G(DUOUT)!$G(DTOUT)!$G(PSJDONE)  D
"RTN","PSJPDRUT",110,0)
 .N PSJPART,II
"RTN","PSJPDRUT",111,0)
 .N DIC,X,Y,PSJX
"RTN","PSJPDRUT",112,0)
 .S DIC="^PSDRUG(",DIC(0)="QEAZ",DIC("A")="Select Drug Item: "_$S($D(OUTDRUG)>1:"",1:"^ALL// ")
"RTN","PSJPDRUT",113,0)
 .S DIC("S")="I $D(DRGLIST(""IEN"",+Y))"
"RTN","PSJPDRUT",114,0)
 .D ^DIC S PSJX=X
"RTN","PSJPDRUT",115,0)
 .I $E(PSJX)="^" S Y=$$XALL^PSJPDRIP(PSJX)
"RTN","PSJPDRUT",116,0)
 .I $G(DUOUT)!$G(DTOUT) S PSJSTOP=1 Q
"RTN","PSJPDRUT",117,0)
 .I Y=-1 S Y=$S($D(OUTDRUG)>1:"",1:"ALL")
"RTN","PSJPDRUT",118,0)
 .I Y="" D  Q
"RTN","PSJPDRUT",119,0)
 ..I $D(OUTDRUG)>1 S PSJDONE=1 Q
"RTN","PSJPDRUT",120,0)
 ..W !!?2,"Select a single Item, several Items or enter ^ALL to select all Items."
"RTN","PSJPDRUT",121,0)
 .S PSJY=Y
"RTN","PSJPDRUT",122,0)
 .I PSJY,$D(DRGLIST("IEN",+PSJY)) D  Q
"RTN","PSJPDRUT",123,0)
 ..W "  ",DRGLIST("IEN",+PSJY)
"RTN","PSJPDRUT",124,0)
 ..S OUTDRUG(+PSJY)=$P($G(^PSDRUG(+PSJY,0)),"^")
"RTN","PSJPDRUT",125,0)
 ..I $G(PSJINP("MANUNLOD")) D POCKET^PSJPDRIN(.PSJINP,+PSJY,.DRWPCK) S PSJDONE=1
"RTN","PSJPDRUT",126,0)
 .I PSJX="",($D(OUTDRUG)<10) S Y="ALL"
"RTN","PSJPDRUT",127,0)
 .I PSJX="",($D(OUTDRUG)>1) S PSJDONE=1
"RTN","PSJPDRUT",128,0)
 .I PSJY="ALL" S OUTDRUG="ALL",PSJDONE=1 D  Q
"RTN","PSJPDRUT",129,0)
 ..I $G(PSJINP("MANUNLOD")) S DRWPCK="ALL" Q
"RTN","PSJPDRUT",130,0)
 ..N DRGIEN S DRGIEN=0 F  S DRGIEN=$O(INDRUG(DRGIEN)) Q:'DRGIEN  S OUTDRUG(DRGIEN)=$P($G(^PSDRUG(+DRGIEN,0)),"^")
"RTN","PSJPDRUT",131,0)
 Q
"RTN","PSJPDRUT",132,0)
 ;
"RTN","PSJPDRUT",133,0)
PSYS(PSLAYGO) ; Get PADE Inventory System
"RTN","PSJPDRUT",134,0)
 N PSYSIEN,PSYSCNT,PSYS,DIR,X,Y,PSYSLST,LISTDIR
"RTN","PSJPDRUT",135,0)
 S PSYSIEN=0 F PSYSCNT=0:1 S PSYSIEN=$O(^PS(58.601,PSYSIEN)) Q:'PSYSIEN  D
"RTN","PSJPDRUT",136,0)
 .S PSYS=PSYSIEN
"RTN","PSJPDRUT",137,0)
 .S PSYSLST(PSYSIEN)=$$UPPER^HLFNC($P($G(^PS(58.601,PSYSIEN,0)),"^"))_"      "_$P($G(^PS(58.601,+PSYS,4)),"^")
"RTN","PSJPDRUT",138,0)
 .S PSYSLSTX(PSYSCNT+1)=PSYSLST(PSYSIEN)_"^"_PSYSIEN
"RTN","PSJPDRUT",139,0)
 .S LISTDIR=$G(LISTDIR)_$S($G(PSYSCNT):";",1:"")_(PSYSCNT+1)_":"_PSYSLST(PSYSIEN)
"RTN","PSJPDRUT",140,0)
 I 'PSYSCNT D  Q ""
"RTN","PSJPDRUT",141,0)
 .S PSJSTOP=-1
"RTN","PSJPDRUT",142,0)
 .D EN^DDIOL("No PADE Inventory data on file")
"RTN","PSJPDRUT",143,0)
 .N DIR S DIR(0)="EA",DIR("A")="Press Return to Continue... " D ^DIR
"RTN","PSJPDRUT",144,0)
 I PSYSCNT=1 S DIR("B")=$P($G(^PS(58.601,+PSYS,0)),"^")
"RTN","PSJPDRUT",145,0)
 S DIR(0)="SAO^"_LISTDIR
"RTN","PSJPDRUT",146,0)
 S DIR("A")="Select PADE Inventory System: "
"RTN","PSJPDRUT",147,0)
 D ^DIR
"RTN","PSJPDRUT",148,0)
 S PSYS=$S(Y>0:+Y,1:"") S:PSYS="" PSJSTOP=-1
"RTN","PSJPDRUT",149,0)
 I +$G(PSYS) S PSYS=$P(PSYSLSTX(PSYS),"^",2) S:PSYS="" PSJSTOP=-1
"RTN","PSJPDRUT",150,0)
 Q PSYS
"RTN","PSJPDRUT",151,0)
 ;
"RTN","PSJPDRUT",152,0)
ENSYS() ; Get PADE Inventory System
"RTN","PSJPDRUT",153,0)
 N PSYSIEN,PSYSCNT,PSYS,DIR,X,Y,PSYSLST,LISTDIR,PSYSNAM,PSYSALT
"RTN","PSJPDRUT",154,0)
 K PSJSTOP
"RTN","PSJPDRUT",155,0)
 F  Q:$G(PSYS)!$G(PSJSTOP)  D
"RTN","PSJPDRUT",156,0)
 .D GETSYS(.PSYSLST,.PSYSLSTX,.PSYSNAM,.PSYSALT)
"RTN","PSJPDRUT",157,0)
 .D SELSYS(.PSYSLST,.PSYSLSTX,.PSYSNAM,.PSYS)
"RTN","PSJPDRUT",158,0)
 Q PSYS
"RTN","PSJPDRUT",159,0)
 ;
"RTN","PSJPDRUT",160,0)
PTIX(PS586IEN,PSJOMS)  ; Computed PATIENT to handle blank patients in "P" x-ref in Transaction file 586
"RTN","PSJPDRUT",161,0)
 N PATIENT
"RTN","PSJPDRUT",162,0)
 S PATIENT=$P($G(^PS(58.6,+$G(PS586IEN),0)),"^",15)
"RTN","PSJPDRUT",163,0)
 I '$G(PATIENT) S PATIENT=$G(FDA(58.6,"+1,",14))
"RTN","PSJPDRUT",164,0)
 I '$G(PATIENT) S PATIENT=$G(PSJOMS("DFN"))
"RTN","PSJPDRUT",165,0)
 Q:$G(PATIENT) PATIENT
"RTN","PSJPDRUT",166,0)
 Q "zz"
"RTN","PSJPDRUT",167,0)
 ;
"RTN","PSJPDRUT",168,0)
DRGIX(PS586IEN,PSJOMS)  ; Computed DRUG ID to handle unknown drugs in "P" x-ref in Transaction file 58.6
"RTN","PSJPDRUT",169,0)
 I $P($G(^PS(58.6,+$G(PS586IEN),0)),"^",3) Q $P(^(0),"^",3)
"RTN","PSJPDRUT",170,0)
 I $P($G(^PS(58.6,+$G(PS586IEN),1)),"^",6)]"" Q "zz~"_$P(^(0),"^",6)
"RTN","PSJPDRUT",171,0)
 I $G(FDA(58.6,"+1,",2)) Q +$G(FDA(58.6,"+1,",2))
"RTN","PSJPDRUT",172,0)
 I $G(PSJOMS("DRGTXT"))]"" Q "zz~"_$G(PSJOMS("DRGTXT"))
"RTN","PSJPDRUT",173,0)
 Q "zz~UNKNOWN"
"RTN","PSJPDRUT",174,0)
 ;
"RTN","PSJPDRUT",175,0)
DISPDOTS(PSJHTM,PSJDOTS,SECONDS) ; Check to see if more than SECONDS seconds has elapsed in $H, since PSJHTM. 
"RTN","PSJPDRUT",176,0)
 ; INPUT - PSJHTM = the 2nd comma piece of $H (seconds)
"RTN","PSJPDRUT",177,0)
 ;         PSJDOTS = flag indicating whether initial message "Searching for matching transactions.." has (1) or has not 0 or "" already been displayed
"RTN","PSJPDRUT",178,0)
 I '$G(PSJHTM) S PSJHTM=$P($H,",",2)
"RTN","PSJPDRUT",179,0)
 I ($P($H,",",2)-PSJHTM)>1 D
"RTN","PSJPDRUT",180,0)
 .I '$G(PSJDOTS) W !?2,"Searching for matching transactions.." S PSJDOTS=1,PSJHTM=$P($H,",",2)
"RTN","PSJPDRUT",181,0)
 .W "." S PSJHTM=$P($H,",",2)
"RTN","PSJPDRUT",182,0)
 Q
"RTN","PSJPDRUT",183,0)
 ;
"RTN","PSJPDRUT",184,0)
PADEUP(PADEV,PADEVUP)  ; Return PADEVUP array, containing subscripts converted to upper case from incoming PADEV array
"RTN","PSJPDRUT",185,0)
 N PADE
"RTN","PSJPDRUT",186,0)
 S PADE="" F  S PADE=$O(PADEV(PADE)) Q:PADE=""  S PADEVUP($$UPPER^HLFNC(PADE))=PADEV(PADE)
"RTN","PSJPDRUT",187,0)
 Q
"RTN","PSJPDRUT",188,0)
 ;
"RTN","PSJPDRUT",189,0)
DIV(PSJDIV,PSJSTOP)  ; Perform manual entry and validation of DIVISION (40.8)
"RTN","PSJPDRUT",190,0)
 N PSJDONE,DIR,X,Y,DIVAR,DIVARX,PSJY,PSALLPC
"RTN","PSJPDRUT",191,0)
 K PSJDIV
"RTN","PSJPDRUT",192,0)
 D DIVLIST(.DIVAR,.DIVARX)
"RTN","PSJPDRUT",193,0)
 S PSJDIV=""
"RTN","PSJPDRUT",194,0)
 F  Q:$G(PSJSTOP)!$G(PSJDONE)  D
"RTN","PSJPDRUT",195,0)
 .N PSJTMP
"RTN","PSJPDRUT",196,0)
 .S DIR(0)="FAO^1:30",DIR("?")="^D DIVLKUP^PSJPDRUT(.DIVAR)"
"RTN","PSJPDRUT",197,0)
 .S DIR("A")="Select Division: "_$S($D(PSJDIV)>1:"",1:" ^ALL// ")
"RTN","PSJPDRUT",198,0)
 .D ^DIR I $E(X)="^" S Y=$$XALL^PSJPDRIP(X)
"RTN","PSJPDRUT",199,0)
 .I X="",($D(PSJDIV)<10) S Y="ALL"
"RTN","PSJPDRUT",200,0)
 .I Y="ALL" M PSJDIV=DIVAR S PSJDIV="ALL",PSJINP("PSJDIV")="ALL",PSJDONE=1 Q
"RTN","PSJPDRUT",201,0)
 .I $G(DUOUT)!$G(DTOUT) S PSJSTOP=1 Q
"RTN","PSJPDRUT",202,0)
 .I Y="" D  Q
"RTN","PSJPDRUT",203,0)
 ..I $D(PSJDIV)>1 S PSJDONE=1 Q
"RTN","PSJPDRUT",204,0)
 ..W !!?2,"Select a single Division, several Divisions or enter ^ALL to select all Divisions."
"RTN","PSJPDRUT",205,0)
 .S PSJY=Y
"RTN","PSJPDRUT",206,0)
 .I $D(DIVAR(PSJY)) D  Q
"RTN","PSJPDRUT",207,0)
 ..N DIVIEN,PSALLPC
"RTN","PSJPDRUT",208,0)
 ..S PSALLPC=1   ; return all data pieces from partial lookup
"RTN","PSJPDRUT",209,0)
 ..S DIVIEN=$P(DIVAR(PSJY),"^",2)
"RTN","PSJPDRUT",210,0)
 ..Q:'DIVIEN  S PSJDIV(DIVIEN)=DIVAR(PSJY)
"RTN","PSJPDRUT",211,0)
 ..W "  ",PSJY,"  ",$P(DIVAR(PSJY),"^")
"RTN","PSJPDRUT",212,0)
 .I $D(DIVARX(PSJY)) D  Q
"RTN","PSJPDRUT",213,0)
 ..N DIVIEN S DIVIEN=$P(DIVAR(DIVARX(PSJY)),"^",2)
"RTN","PSJPDRUT",214,0)
 ..Q:'DIVIEN  S PSJDIV(DIVIEN)=PSJY
"RTN","PSJPDRUT",215,0)
 ..W "  ",PSJY,"  ",DIVARX(PSJY) ;p365
"RTN","PSJPDRUT",216,0)
 .S PSELMSG="Select a Division"
"RTN","PSJPDRUT",217,0)
 .S PSALLPC=1  ; Return all data pieces from partial lookup
"RTN","PSJPDRUT",218,0)
 .D PARTIAL^PSJPADPT(PSJY,.DIVARX,.PSJTMP,,PSELMSG,.DIVAR,.PSFOUND,,PSALLPC)
"RTN","PSJPDRUT",219,0)
 .I $G(PSFOUND) N PSDIV,DIVIEN S PSDIV=$O(PSJTMP("")) I PSDIV]"" S DIVIEN=$P($G(PSJTMP(PSDIV)),"^",2) I DIVIEN S PSJDIV(DIVIEN)=PSDIV_"^"_DIVIEN
"RTN","PSJPDRUT",220,0)
 .Q:$G(PSFOUND)
"RTN","PSJPDRUT",221,0)
 .W "  ?? (No match found)"
"RTN","PSJPDRUT",222,0)
 Q
"RTN","PSJPDRUT",223,0)
 ;
"RTN","PSJPDRUT",224,0)
DIVLKUP(DIVAR)  ; Lookup Division
"RTN","PSJPDRUT",225,0)
 D LIST^PSJPDRTR(.DIVAR,,15)
"RTN","PSJPDRUT",226,0)
 Q
"RTN","PSJPDRUT",227,0)
 ;
"RTN","PSJPDRUT",228,0)
DIVLIST(DIVAR,DIVARX)  ; Get list of Divisions
"RTN","PSJPDRUT",229,0)
 N DIVNAM,DIVIEN,DIVCNT
"RTN","PSJPDRUT",230,0)
 S DIVNAM="" F DIVCNT=1:1 S DIVNAM=$O(^DG(40.8,"B",DIVNAM)) Q:DIVNAM=""  D
"RTN","PSJPDRUT",231,0)
 .S DIVIEN=$O(^DG(40.8,"B",DIVNAM,0))
"RTN","PSJPDRUT",232,0)
 .S DIVAR(DIVIEN)=DIVNAM_"^"_DIVIEN,DIVARX(DIVNAM)=DIVIEN
"RTN","PSJPDRUT",233,0)
 Q
"RTN","PSJPDRUT",234,0)
 ;
"RTN","PSJPDRUT",235,0)
UPPER(PSTEXT)  ; Convert X to upper case
"RTN","PSJPDRUT",236,0)
 N X,Y
"RTN","PSJPDRUT",237,0)
 S PSTEXT=$$UPPER^HLFNC(PSTEXT)
"RTN","PSJPDRUT",238,0)
 Q PSTEXT
"RTN","PSJPDRUT",239,0)
 ;
"RTN","PSJPDRUT",240,0)
GETSYS(PSYSLST,PSYSLSTX,PSYSNAM,PSYSALT)  ; Get list of PADE Inventory Systems from file 58.601
"RTN","PSJPDRUT",241,0)
 ;
"RTN","PSJPDRUT",242,0)
 N PSYSIEN,PSYSCNT
"RTN","PSJPDRUT",243,0)
 K PSYSLST,PSYSLSTX,PSYSNAM,PSYSALT,PSUPPER
"RTN","PSJPDRUT",244,0)
 S PSYSIEN=0 F PSYSCNT=0:1 S PSYSIEN=$O(^PS(58.601,PSYSIEN)) Q:'PSYSIEN  D
"RTN","PSJPDRUT",245,0)
 .S PSYS=PSYSIEN
"RTN","PSJPDRUT",246,0)
 .S PSYSLST("IEN",PSYSIEN)=$P($G(^PS(58.601,PSYSIEN,0)),"^")
"RTN","PSJPDRUT",247,0)
 .S PSYSLST("NAME",PSYSLST("IEN",PSYSIEN))=PSYSIEN
"RTN","PSJPDRUT",248,0)
 .S PSYSLSTX(PSYSCNT+1)=PSYSLST("IEN",PSYSIEN)_"    "_$P($G(^PS(58.601,+PSYSIEN,4)),"^")_"^"_PSYSIEN
"RTN","PSJPDRUT",249,0)
 .S PSYSNAM(PSYSLST("IEN",PSYSIEN))=PSYSIEN
"RTN","PSJPDRUT",250,0)
 .S PSYSALT=$P($G(^PS(58.601,+PSYSIEN,4)),"^") I PSYSALT]"" S PSYSNAM($$UPPER^PSJPDRUT(PSYSALT))=PSYSIEN
"RTN","PSJPDRUT",251,0)
 Q
"RTN","PSJPDRUT",252,0)
 ;
"RTN","PSJPDRUT",253,0)
SELSYS(PSYSLST,PSYSLTX,PSYSNAM,PSYS)  ; Select dispensing system for editing
"RTN","PSJPDRUT",254,0)
 ; Input:   PSYSLST   - list of dispensing systems, PSYSLST("IEN",IEN)=name, PSYSLST("NAME",name)=IEN
"RTN","PSJPDRUT",255,0)
 ;          PSYSLSTX  - list of dispensing systems, PSYSLSTX(list#)=name
"RTN","PSJPDRUT",256,0)
 ;          PSYSNAM   - list of dispensing systems, PSYSNAM(name)=list#
"RTN","PSJPDRUT",257,0)
 ; Output:  PSYS  - IEN of dispensing system in file 58.601
"RTN","PSJPDRUT",258,0)
 N PSJY,PSFOUND,PSALLPC
"RTN","PSJPDRUT",259,0)
 K PSYS S PSYS=""
"RTN","PSJPDRUT",260,0)
 S DIR(0)="FAO",DIR("?")="^D LIST^PSJPDRTR(.PSYSLSTX,,15)"
"RTN","PSJPDRUT",261,0)
 S DIR("A")="Select PADE Inventory System: "
"RTN","PSJPDRUT",262,0)
 D ^DIR
"RTN","PSJPDRUT",263,0)
 ;
"RTN","PSJPDRUT",264,0)
 I $G(DUOUT)!$G(DTOUT) S PSJSTOP=1 Q
"RTN","PSJPDRUT",265,0)
 I Y=""!($TR(Y," ")="")!(Y["^") D  Q
"RTN","PSJPDRUT",266,0)
 .W !!?2,"Select a PADE Dispensing Inventory system or '^' to exit."
"RTN","PSJPDRUT",267,0)
 S PSJY=Y
"RTN","PSJPDRUT",268,0)
 I $D(PSYSLSTX(+PSJY)) D  Q
"RTN","PSJPDRUT",269,0)
 .W "  ",$P(PSYSLSTX(+PSJY),"^")
"RTN","PSJPDRUT",270,0)
 .S PSYS=$P(PSYSLSTX(+PSJY),"^",2)
"RTN","PSJPDRUT",271,0)
 I $D(PSYSNAM(PSJY)) D  Q
"RTN","PSJPDRUT",272,0)
 .W "  ",PSYSNAM(PSJY)
"RTN","PSJPDRUT",273,0)
 .S PSYS=PSYSNAM(PSJY)
"RTN","PSJPDRUT",274,0)
 I $D(PSYSALT(PSJY)) D  Q
"RTN","PSJPDRUT",275,0)
 .W "  ",PSYSLST(PSYSALT(PSJY))
"RTN","PSJPDRUT",276,0)
 .S PSYS=PSYSALT(PSJY)
"RTN","PSJPDRUT",277,0)
 S PSALLPC=1  ; return all data pieces from partial lookup
"RTN","PSJPDRUT",278,0)
 D PARTIAL^PSJPADPT(.PSJY,.PSYSNAM,.PSJY,1,,.PSYSLSTX,.PSFOUND,,PSALLPC)
"RTN","PSJPDRUT",279,0)
 I '$G(PSFOUND),($G(PSJY)]"") D  Q
"RTN","PSJPDRUT",280,0)
 .N DIR,X,Y,FDA
"RTN","PSJPDRUT",281,0)
 .S DIR("A")="  Are you adding '"_PSJY_"' as a new PADE INVENTORY SYSTEM? "
"RTN","PSJPDRUT",282,0)
 .S DIR(0)="YAO",DIR("B")="N" D ^DIR Q:'Y
"RTN","PSJPDRUT",283,0)
 .S FDA(58.601,"?+1,",.01)=PSJY
"RTN","PSJPDRUT",284,0)
 .D UPDATE^DIE("E","FDA","PSYS","ERR")
"RTN","PSJPDRUT",285,0)
 .S PSYS=$S($G(PSYS(1)):+$G(PSYS(1)),1:"")
"RTN","PSJPDRUT",286,0)
 I $G(PSFOUND) S PSYS=$O(PSJY(0)),PSYS=+$G(PSYSNAM(PSYS)) I 'PSYS S PSYS=+$G(PSYSLST("NAME",PSYS))
"RTN","PSJPDRUT",287,0)
 Q
"RTN","PSJPDRUT",288,0)
 ;
"RTN","PSJPDRUT",289,0)
PADEUSR(PSJPSYS,PSJPDUSR) ; Return Vista user ID for PADE user PSJPDUSER, if it exists
"RTN","PSJPDRUT",290,0)
 N PSJSYSE,PSJVUSR,PSJVAL,PSJRSLT,PADUIEN
"RTN","PSJPDRUT",291,0)
 Q:$G(PSJPSYS)="" ""
"RTN","PSJPDRUT",292,0)
 Q:$G(PSJPDUSR)="" ""
"RTN","PSJPDRUT",293,0)
 S PSJSYSE=$P($G(^PS(58.601,+PSJPSYS,0)),"^")
"RTN","PSJPDRUT",294,0)
 Q:PSJSYSE="" ""
"RTN","PSJPDRUT",295,0)
 S PSJVAL(1)=PSJSYSE
"RTN","PSJPDRUT",296,0)
 S PSJVAL(2)=PSJPDUSR
"RTN","PSJPDRUT",297,0)
 S PSJVUSR=$$FIND1^DIC(58.64,,"K",.PSJVAL)
"RTN","PSJPDRUT",298,0)
 Q:'PSJVUSR ""
"RTN","PSJPDRUT",299,0)
 S PADUIEN=+$G(PSJVUSR)
"RTN","PSJPDRUT",300,0)
 D GETS^DIQ(58.64,+PSJVUSR,"2","IE","PSJRSLT")
"RTN","PSJPDRUT",301,0)
 S PSJVUSR=+$G(PSJRSLT(58.64,PSJVUSR_",",2,"I"))_"^"_$G(PSJRSLT(58.64,PSJVUSR_",",2,"E"))_"^"_PADUIEN
"RTN","PSJPDRUT",302,0)
 Q PSJVUSR
"RTN","PSJPDRUT",303,0)
 ;
"RTN","PSJPDRUT",304,0)
DEVSCRN(PSJINP,PSPDIEN)  ; Screen PADE cabinet PSPDIEN (file 58.63) 
"RTN","PSJPDRUT",305,0)
 ; Compare PSJINP("PSJPSYS") to System Field (#1)(#58.63)
"RTN","PSJPDRUT",306,0)
 ; and     PSJINP("PSJDIV") to Division Field (#2) (58.63)
"RTN","PSJPDRUT",307,0)
 ; Manually coded version of screen S PSJSCR="I $D(PSJINP(""PSJDIV"",+$G(^(2))))&($P($G(^(0)),""^"",2)=PSJPSYS)&'$$EMPTY^PSJPADPT(+Y)"
"RTN","PSJPDRUT",308,0)
 N PADEOK,DIVIEN,DIVNAME,SYSIEN,DIVTMP,DIVOK
"RTN","PSJPDRUT",309,0)
 S PADEOK=1
"RTN","PSJPDRUT",310,0)
 S DIVIEN=$P($G(^PS(58.63,+$G(PSPDIEN),2)),"^")
"RTN","PSJPDRUT",311,0)
 S DIVNAME=$P($G(^DG(40.8,+DIVIEN,0)),"^")
"RTN","PSJPDRUT",312,0)
 I DIVNAME="" Q 0  ; No division on file for cabinet, quit
"RTN","PSJPDRUT",313,0)
 ; Division doesn't match any in PSJINP("PSJDIV"), quit
"RTN","PSJPDRUT",314,0)
 S DIVOK=0 S DIVTMP="" F  S DIVTMP=$O(PSJINP("PSJDIV",DIVTMP)) Q:DIVTMP=""!$G(DIVOK)  I $P($G(PSJINP("PSJDIV",DIVTMP)),"^",2)=DIVIEN S DIVOK=1
"RTN","PSJPDRUT",315,0)
 Q:'DIVOK 0
"RTN","PSJPDRUT",316,0)
 ; System doesn't match PSJINP("PSJPSYS"), quit
"RTN","PSJPDRUT",317,0)
 S SYSIEN=$P($G(^PS(58.63,+$G(PSPDIEN),0)),"^",2)
"RTN","PSJPDRUT",318,0)
 I SYSIEN'=+$G(PSJINP("PSJPSYS")) Q 0
"RTN","PSJPDRUT",319,0)
 ; Cabinet is empty, quit
"RTN","PSJPDRUT",320,0)
 Q:$$EMPTY^PSJPADPT(+PSPDIEN) 0
"RTN","PSJPDRUT",321,0)
 Q PADEOK
"RTN","PSJPDRUT",322,0)
 ;
"RTN","PSJPDRUT",323,0)
UNIQUE(PSJY,PADE)   ; Is PSJY unique subscript in PADE(), or are there other partial matches (PADE(PSJY), PADE(PSJYnn), PADE(PSJYxx), etc)?
"RTN","PSJPDRUT",324,0)
 N NEXTSUB,PSJYLEN
"RTN","PSJPDRUT",325,0)
 I $G(PSJY)="" Q 1
"RTN","PSJPDRUT",326,0)
 I $D(PADE)<10 Q 1
"RTN","PSJPDRUT",327,0)
 S NEXTSUB=$O(PADE(PSJY))
"RTN","PSJPDRUT",328,0)
 S PSJYLEN=$L(PSJY)
"RTN","PSJPDRUT",329,0)
 I $E(NEXTSUB,1,PSJYLEN)=PSJY Q 0
"RTN","PSJPDRUT",330,0)
 Q 1
"RTN","PSJPDRUT",331,0)
 ;
"RTN","PSJPDRUT",332,0)
PSB(PSJOMS)  ; Get Patient Specific Bin info
"RTN","PSJPDRUT",333,0)
 ;
"RTN","PSJPDRUT",334,0)
 N PSPADFN,PSPADNM,PSPADPK
"RTN","PSJPDRUT",335,0)
 I (PSJOMS("COMMENT")'["PATIENT SPECIFIC BIN") Q
"RTN","PSJPDRUT",336,0)
 N PSSN S PSSN=$P(PSJOMS("COMMENT"),"-",2)
"RTN","PSJPDRUT",337,0)
 I $G(PSSN) S PSPADFN=$$PATSSN(PSSN) I $G(PSPADFN) S PSJOMS("SSN")=PSSN,PSJOMS("DFN")=PSPADFN
"RTN","PSJPDRUT",338,0)
 I $G(PSPADFN) S PSPADNM=$P($G(^DPT(+PSPADFN,0)),"^")
"RTN","PSJPDRUT",339,0)
 I ($G(PSPADNM)'="") S (PSJOMS("DFN"),PSJOMS("PTID"))=PSPADFN D
"RTN","PSJPDRUT",340,0)
 .S PSJOMS("PTNAMA")=$P(PSPADNM,",")
"RTN","PSJPDRUT",341,0)
 .S PSJOMS("PTNAMB")=$P(PSPADNM,",",2)
"RTN","PSJPDRUT",342,0)
 S PSPADPK=$G(PSJOMS("PKT"))
"RTN","PSJPDRUT",343,0)
 S PSJOMS("PKT")=PSJOMS("PKT")_"PSB"
"RTN","PSJPDRUT",344,0)
 Q
"RTN","PSJPDRUT",345,0)
 ;
"RTN","PSJPDRUT",346,0)
PATSSN(PSSN)  ; If valid PSSN patient SSN, return patient PDFN pointer to ^DPT
"RTN","PSJPDRUT",347,0)
 N PSVAL,PSINDEX,PSJDFN
"RTN","PSJPDRUT",348,0)
 S PSJDFN=""
"RTN","PSJPDRUT",349,0)
 I $G(PSSN) S (X,PSVAL)=PSSN,PSINDEX="SSN" S PSJDFN=$$FIND1^DIC(2,,"X",PSVAL,PSINDEX,,"PSERR")
"RTN","PSJPDRUT",350,0)
 I '$G(PSJDFN),$G(PSSN) S PSJDFN=$O(^DPT("SSN",PSSN,""))
"RTN","PSJPDRUT",351,0)
 I '$G(PSJDFN),$G(PSSN) N TMPSSN S TMPSSN=$TR($J(+PSSN,9)," ",0) S PSJDFN=$O(^DPT("SSN",TMPSSN,""))
"RTN","PSJPDRUT",352,0)
 I 'PSJDFN S PSJDFN=""
"RTN","PSJPDRUT",353,0)
 I PSJDFN I '$D(^DPT(PSJDFN)) S PSJDFN=""
"RTN","PSJPDRUT",354,0)
 Q PSJDFN
"RTN","PSJPDRUT",355,0)
 ;
"RTN","PSJPDRUT",356,0)
TTYPDIR(PSJPSYS,BDT,EDT)  ; build DIR(0) string of selectable transaction types
"RTN","PSJPDRUT",357,0)
 N TTYPDIR,TTARRAY,TT,II
"RTN","PSJPDRUT",358,0)
 Q:'$G(PSJPSYS) ""
"RTN","PSJPDRUT",359,0)
 Q:'$D(^PS(58.601,+PSJPSYS,0)) ""
"RTN","PSJPDRUT",360,0)
 D TTYPES(PSJPSYS,BDT,EDT,.TTARRAY)
"RTN","PSJPDRUT",361,0)
 S TTYPDIR=""
"RTN","PSJPDRUT",362,0)
 S TT="" F II=1:1 S TT=$O(TTARRAY(TT)) Q:TT=""  D
"RTN","PSJPDRUT",363,0)
 .N TTYPNAM
"RTN","PSJPDRUT",364,0)
 .S TTYPNAM=TT
"RTN","PSJPDRUT",365,0)
 .I II=1 S TTYPDIR="1:"_TTYPNAM
"RTN","PSJPDRUT",366,0)
 .I II>1 S TTYPDIR=TTYPDIR_";"_II_":"_TTYPNAM
"RTN","PSJPDRUT",367,0)
 Q TTYPDIR
"RTN","PSJPDRUT",368,0)
 ;
"RTN","PSJPDRUT",369,0)
TTYPES(PSJPSYS,BDT,EDT,OUTTYP)  ; Get list of all transaction Types for system PSJPSYS between begin date BDT and end date EDT
"RTN","PSJPDRUT",370,0)
 N TDT,SYSNAM,TDEV,TXIEN
"RTN","PSJPDRUT",371,0)
 K OUTTYP
"RTN","PSJPDRUT",372,0)
 S SYSNAM=$P($G(^PS(58.601,+$G(PSJPSYS),0)),"^")
"RTN","PSJPDRUT",373,0)
 S TDT=$$FMADD^XLFDT(BDT,,,-.1)
"RTN","PSJPDRUT",374,0)
 F  S TDT=$O(^PS(58.6,"B",TDT)) Q:(TDT="")!(TDT>EDT)  S TXIEN=0 F  S TXIEN=$O(^PS(58.6,"B",TDT,TXIEN)) Q:'TXIEN  D
"RTN","PSJPDRUT",375,0)
 .N TT
"RTN","PSJPDRUT",376,0)
 .Q:($P($G(^PS(58.6,TXIEN,1)),"^",3)'=SYSNAM)
"RTN","PSJPDRUT",377,0)
 .S TT=$P($G(^PS(58.6,TXIEN,0)),"^",5) Q:TT=""
"RTN","PSJPDRUT",378,0)
 .S TTYPNAM=$$TTEX(TT)
"RTN","PSJPDRUT",379,0)
 .Q:$D(OUTTYP(TTYPNAM))
"RTN","PSJPDRUT",380,0)
 .Q:'(",D,L,R,F,U,E,C,R,W,B,V,")[(","_TT_",")
"RTN","PSJPDRUT",381,0)
 .S OUTTYP(TTYPNAM)=""
"RTN","PSJPDRUT",382,0)
 Q
"RTN","PSJPDRUT",383,0)
 ;
"RTN","PSJPDRUT",384,0)
DEFTRAN(DEFTRAN)  ; Get default list of ALL transaction types if none were found in transaction file
"RTN","PSJPDRUT",385,0)
 N II,TTYPNAM,TRANLIST,TTYPCOD
"RTN","PSJPDRUT",386,0)
 S TRANLIST="V:Dispense,L:Load,U:Unload,F:Fill/Refill,B:Empty Bin,C:Count,R:Return,W:Waste,E:Expired,A:Discrepancy"
"RTN","PSJPDRUT",387,0)
 N II F II=1:1:$L(TRANLIST,",") S II=$P(TRANLIST,",",II) Q:II=""  D
"RTN","PSJPDRUT",388,0)
 .S TTYPCOD=$P(II,":"),TTYPNAM=$P(II,":",2)
"RTN","PSJPDRUT",389,0)
 .S DEFTRAN(TTYPNAM)=TTYPCOD
"RTN","PSJPDRUT",390,0)
 Q
"RTN","PSJPDRUT",391,0)
 ;
"RTN","PSJPDRUT",392,0)
TTEX(TTCODE)  ; Convert Transaction Type code to Type Name
"RTN","PSJPDRUT",393,0)
 N TTNAME,TT
"RTN","PSJPDRUT",394,0)
 S TT=$$UPPER^PSJPDRUT($G(TTCODE))
"RTN","PSJPDRUT",395,0)
 S TTNAME=$S(TT="V":"Dispense",TT="L":"Load",TT="U":"Unload",TT="F":"Refill",TT="B":"Empty Bin",TT="C":"Count",TT="R":"Return",TT="W":"Waste",TT="E":"Expired",TT="D":"Destock",TT="A":"Discrepancy",TT="N":"Cancel",1:"Other")
"RTN","PSJPDRUT",396,0)
 Q TTNAME
"RTN","PSJPDRUT",397,0)
 ;
"RTN","PSJPDRUT",398,0)
EXTT(TTNAME)  ; Convert Transaction Type Name to Type Code
"RTN","PSJPDRUT",399,0)
 N TTCODE,TT
"RTN","PSJPDRUT",400,0)
 S TT=$$UPPER^PSJPDRUT($G(TTNAME))
"RTN","PSJPDRUT",401,0)
 S:TT="" TT="OTHER"
"RTN","PSJPDRUT",402,0)
 S TTCODE=$P($T(@($E($P(TT," "),1,8)_"^PSJPDRUT")),";;",2)
"RTN","PSJPDRUT",403,0)
 S:TTCODE="" TTCODE="O"
"RTN","PSJPDRUT",404,0)
 Q TTCODE
"RTN","PSJPDRUT",405,0)
 ;
"RTN","PSJPDRUT",406,0)
DISPENSE ;;V
"RTN","PSJPDRUT",407,0)
VEND ;;V
"RTN","PSJPDRUT",408,0)
LOAD ;;L
"RTN","PSJPDRUT",409,0)
UNLOAD ;;U
"RTN","PSJPDRUT",410,0)
REFILL ;;F
"RTN","PSJPDRUT",411,0)
EMPTY ;;B
"RTN","PSJPDRUT",412,0)
COUNT ;;C
"RTN","PSJPDRUT",413,0)
RETURN ;;R
"RTN","PSJPDRUT",414,0)
WASTE ;;W
"RTN","PSJPDRUT",415,0)
EXPIRED ;;E
"RTN","PSJPDRUT",416,0)
DESTOCK ;;D
"RTN","PSJPDRUT",417,0)
DISCREPA ;;A
"RTN","PSJPDRUT",418,0)
CANCEL ;;N
"RTN","PSJPDRUT",419,0)
UNKNOWN ;;O
"RTN","PSJPDRUT",420,0)
OTHER ;;O
"RTN","PSJPDRUT",421,0)
 Q
"VER")
8.0^22.2
"BLD",11023,6)
^310
**END**
**END**

