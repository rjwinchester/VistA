Released PSJ*5*361 SEQ #305
Extracted from mail message
**KIDS**:PSJ*5.0*361^

**INSTALL NAME**
PSJ*5.0*361
"BLD",11005,0)
PSJ*5.0*361^INPATIENT MEDICATIONS^0^3180307^y
"BLD",11005,1,0)
^^2^2^3180302^
"BLD",11005,1,1,0)
1) Special Instructions on edit not copying correctly
"BLD",11005,1,2,0)
2) Next Dose Due not displaying correctly
"BLD",11005,4,0)
^9.64PA^^
"BLD",11005,6.3)
7
"BLD",11005,"KRN",0)
^9.67PA^779.2^20
"BLD",11005,"KRN",.4,0)
.4
"BLD",11005,"KRN",.401,0)
.401
"BLD",11005,"KRN",.402,0)
.402
"BLD",11005,"KRN",.403,0)
.403
"BLD",11005,"KRN",.5,0)
.5
"BLD",11005,"KRN",.84,0)
.84
"BLD",11005,"KRN",3.6,0)
3.6
"BLD",11005,"KRN",3.8,0)
3.8
"BLD",11005,"KRN",9.2,0)
9.2
"BLD",11005,"KRN",9.8,0)
9.8
"BLD",11005,"KRN",9.8,"NM",0)
^9.68A^2^2
"BLD",11005,"KRN",9.8,"NM",1,0)
PSJBCMA5^^0^B80575447
"BLD",11005,"KRN",9.8,"NM",2,0)
PSJUTL^^0^B135053726
"BLD",11005,"KRN",9.8,"NM","B","PSJBCMA5",1)

"BLD",11005,"KRN",9.8,"NM","B","PSJUTL",2)

"BLD",11005,"KRN",19,0)
19
"BLD",11005,"KRN",19.1,0)
19.1
"BLD",11005,"KRN",101,0)
101
"BLD",11005,"KRN",409.61,0)
409.61
"BLD",11005,"KRN",771,0)
771
"BLD",11005,"KRN",779.2,0)
779.2
"BLD",11005,"KRN",870,0)
870
"BLD",11005,"KRN",8989.51,0)
8989.51
"BLD",11005,"KRN",8989.52,0)
8989.52
"BLD",11005,"KRN",8994,0)
8994
"BLD",11005,"KRN","B",.4,.4)

"BLD",11005,"KRN","B",.401,.401)

"BLD",11005,"KRN","B",.402,.402)

"BLD",11005,"KRN","B",.403,.403)

"BLD",11005,"KRN","B",.5,.5)

"BLD",11005,"KRN","B",.84,.84)

"BLD",11005,"KRN","B",3.6,3.6)

"BLD",11005,"KRN","B",3.8,3.8)

"BLD",11005,"KRN","B",9.2,9.2)

"BLD",11005,"KRN","B",9.8,9.8)

"BLD",11005,"KRN","B",19,19)

"BLD",11005,"KRN","B",19.1,19.1)

"BLD",11005,"KRN","B",101,101)

"BLD",11005,"KRN","B",409.61,409.61)

"BLD",11005,"KRN","B",771,771)

"BLD",11005,"KRN","B",779.2,779.2)

"BLD",11005,"KRN","B",870,870)

"BLD",11005,"KRN","B",8989.51,8989.51)

"BLD",11005,"KRN","B",8989.52,8989.52)

"BLD",11005,"KRN","B",8994,8994)

"BLD",11005,"QDEF")
^^^^NO^^^^^^NO
"BLD",11005,"QUES",0)
^9.62^^
"BLD",11005,"REQB",0)
^9.611^2^2
"BLD",11005,"REQB",1,0)
PSJ*5.0*275^2
"BLD",11005,"REQB",2,0)
PSJ*5.0*349^2
"BLD",11005,"REQB","B","PSJ*5.0*275",1)

"BLD",11005,"REQB","B","PSJ*5.0*349",2)

"MBREQ")
0
"PKG",471,-1)
1^1
"PKG",471,0)
INPATIENT MEDICATIONS^PSJ^UNIT DOSE AND IVS
"PKG",471,20,0)
^9.402P^^
"PKG",471,22,0)
^9.49I^1^1
"PKG",471,22,1,0)
5.0^2971215^2990325^66481
"PKG",471,22,1,"PAH",1,0)
361^3180307
"PKG",471,22,1,"PAH",1,1,0)
^^2^2^3180307
"PKG",471,22,1,"PAH",1,1,1,0)
1) Special Instructions on edit not copying correctly
"PKG",471,22,1,"PAH",1,1,2,0)
2) Next Dose Due not displaying correctly
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
2
"RTN","PSJBCMA5")
0^1^B80575447^B80438277
"RTN","PSJBCMA5",1,0)
PSJBCMA5 ;BIR/JCH - RETRIEVE SPECIAL INSTRUCTIONS/OTHER PRINT INFO ; 1/9/12 11:12am
"RTN","PSJBCMA5",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**267,275,361**;16 DEC 97;Build 7
"RTN","PSJBCMA5",3,0)
 ;
"RTN","PSJBCMA5",4,0)
 ;Reference to ^DPT is supported by DBIA 10035
"RTN","PSJBCMA5",5,0)
 ;Reference to ^PS(55 is supported by DBIA 2191
"RTN","PSJBCMA5",6,0)
 ;Reference to ^%DTC is supported by DBIA 10000
"RTN","PSJBCMA5",7,0)
 ;Reference to ^DIE is supported by DBIA 10018
"RTN","PSJBCMA5",8,0)
 ;Reference to ^DIQ is supported by DBIA 2056
"RTN","PSJBCMA5",9,0)
 ;
"RTN","PSJBCMA5",10,0)
GETSIOPI(DFN,ON,BCMA) ; Get appropriate field depending on order type
"RTN","PSJBCMA5",11,0)
 ; DFN - Patient IEN
"RTN","PSJBCMA5",12,0)
 ; ON - Inpatient Order number
"RTN","PSJBCMA5",13,0)
 ; BCMA - Flag indicating called from BCMA - return data in ^TMP("PSJBCMA",$J
"RTN","PSJBCMA5",14,0)
 ;
"RTN","PSJBCMA5",15,0)
 I 'ON!'DFN Q 0
"RTN","PSJBCMA5",16,0)
 K ^TMP("PSJBCMA5",$J,DFN,ON)
"RTN","PSJBCMA5",17,0)
 I '$G(PSJSYSP),'$G(BCMA) N PSJSYSP S PSJSYSP=$J
"RTN","PSJBCMA5",18,0)
 I $G(BCMA) D  Q +$G(^TMP("PSJBCMA5",$J,DFN,ON))
"RTN","PSJBCMA5",19,0)
 .N PSJSYSP S PSJSYSP=$J
"RTN","PSJBCMA5",20,0)
 .I ON["V"!((ON["P")&($D(^PS(53.1,+ON,"AD"))!$D(^PS(53.1,+ON,"SOL")))) D  Q
"RTN","PSJBCMA5",21,0)
 ..I $$GETOPI(DFN,ON,1) D MOVETMP(DFN,ON,"IV")
"RTN","PSJBCMA5",22,0)
 .I $$GETSI(DFN,ON,1) D MOVETMP(DFN,ON,"UD")
"RTN","PSJBCMA5",23,0)
 I ON["V"!((ON["P")&($D(^PS(53.1,+ON,"AD"))!$D(^PS(53.1,+ON,"SOL")))) Q $$GETOPI(DFN,ON)
"RTN","PSJBCMA5",24,0)
 Q $$GETSI(DFN,ON)
"RTN","PSJBCMA5",25,0)
 ;
"RTN","PSJBCMA5",26,0)
MOVETMP(DFN,ON,OTYP) ; Move text from PS(53.45 to ^TMP for BCMA
"RTN","PSJBCMA5",27,0)
 N LN,ND S ND=$S(OTYP="IV":6,1:5)
"RTN","PSJBCMA5",28,0)
 I $O(^PS(53.45,PSJSYSP,ND," "),-1)=1,$TR(^PS(53.45,PSJSYSP,ND,1,0)," ")="" K ^TMP("PSJBCMA5",$J) Q
"RTN","PSJBCMA5",29,0)
 S ^TMP("PSJBCMA5",$J,DFN,ON)=+$P(^PS(53.45,PSJSYSP,ND,0),"^",3) S LN=0 F  S LN=$O(^PS(53.45,PSJSYSP,ND,LN)) Q:'LN  D
"RTN","PSJBCMA5",30,0)
 .S ^TMP("PSJBCMA5",$J,DFN,ON,LN)=^PS(53.45,PSJSYSP,ND,LN,0)
"RTN","PSJBCMA5",31,0)
 K ^PS(53.45,PSJSYSP,ND)
"RTN","PSJBCMA5",32,0)
 Q
"RTN","PSJBCMA5",33,0)
 ;
"RTN","PSJBCMA5",34,0)
GETSI(DFN,ON,BC) ; Get Special Instructions for Unit Dose orders
"RTN","PSJBCMA5",35,0)
 N PSJTXT,TXTLN
"RTN","PSJBCMA5",36,0)
 I $G(DFN)=""!($G(ON)="") Q 0
"RTN","PSJBCMA5",37,0)
 I '$G(PSJSYSP) N PSJSYSP S PSJSYSP=$J
"RTN","PSJBCMA5",38,0)
 I ON["P" D  Q +$P($G(^PS(53.45,+PSJSYSP,5,0)),"^",3)
"RTN","PSJBCMA5",39,0)
 .Q:($G(^PS(53.45,+PSJSYSP,5,0))="^^0^0")
"RTN","PSJBCMA5",40,0)
 .I $P($G(^PS(53.1,+ON,15,0)),"^",3) D  Q
"RTN","PSJBCMA5",41,0)
 ..S ^PS(53.45,+PSJSYSP,5,0)=^PS(53.1,+ON,15,0)
"RTN","PSJBCMA5",42,0)
 ..S LN=0 F  S LN=$O(^PS(53.1,+ON,15,LN)) Q:'LN  S ^PS(53.45,+PSJSYSP,5,LN,0)=^PS(53.1,+ON,15,LN,0)
"RTN","PSJBCMA5",43,0)
 .N OLDSI,MARX,TXTCNT S OLDSI=$P($G(^PS(53.1,+ON,6)),"^") I $L(OLDSI)>0 D  Q
"RTN","PSJBCMA5",44,0)
 ..I $G(BC),$L(OLDSI)>74 D TXT^PSGMUTL(OLDSI,74) S TXTCNT=$O(MARX(" "),-1) S ^PS(53.45,+PSJSYSP,5,0)="^^"_TXTCNT_"^"_TXTCNT D  Q
"RTN","PSJBCMA5",45,0)
 ...S TXTLN=0 F  S TXTLN=$O(MARX(TXTLN)) Q:'TXTLN  S ^PS(53.45,+PSJSYSP,5,TXTLN,0)=MARX(TXTLN)
"RTN","PSJBCMA5",46,0)
 ..S ^PS(53.45,+PSJSYSP,5,1,0)=$P(^PS(53.1,+ON,6),"^"),^PS(53.45,+PSJSYSP,5,0)="^^1^1"
"RTN","PSJBCMA5",47,0)
 I ON["U" D  Q $P($G(^PS(53.45,+PSJSYSP,5,0)),"^",3)
"RTN","PSJBCMA5",48,0)
 .Q:($G(^PS(53.45,+PSJSYSP,5,0))="^^0^0")
"RTN","PSJBCMA5",49,0)
 .I $P($G(^PS(55,+DFN,5,+ON,15,0)),"^",3) D  Q
"RTN","PSJBCMA5",50,0)
 ..S ^PS(53.45,+PSJSYSP,5,0)=$G(^PS(55,DFN,5,+ON,15,0))
"RTN","PSJBCMA5",51,0)
 ..S LN=0 F  S LN=$O(^PS(55,DFN,5,+ON,15,LN)) Q:'LN  S ^PS(53.45,+PSJSYSP,5,LN,0)=^PS(55,DFN,5,+ON,15,LN,0)
"RTN","PSJBCMA5",52,0)
 .N OLDSI,MARX,TXTCNT S OLDSI=$P($G(^PS(55,DFN,5,+ON,6)),"^") I $L(OLDSI)>0 D  Q
"RTN","PSJBCMA5",53,0)
 ..I $G(BC),$L(OLDSI)>74 D TXT^PSGMUTL(OLDSI,74) S TXTCNT=$O(MARX(" "),-1) S ^PS(53.45,+PSJSYSP,5,0)="^^"_TXTCNT_"^"_TXTCNT D  Q
"RTN","PSJBCMA5",54,0)
 ...S TXTLN=0 F  S TXTLN=$O(MARX(TXTLN)) Q:'TXTLN  S ^PS(53.45,+PSJSYSP,5,TXTLN,0)=MARX(TXTLN)
"RTN","PSJBCMA5",55,0)
 ..S ^PS(53.45,+PSJSYSP,5,1,0)=$P(^PS(55,DFN,5,+ON,6),"^"),^PS(53.45,+PSJSYSP,5,0)="^^1^1"
"RTN","PSJBCMA5",56,0)
 Q 0
"RTN","PSJBCMA5",57,0)
 ;
"RTN","PSJBCMA5",58,0)
GETOPI(DFN,ON,BC) ; Get Other Print Info for IV orders
"RTN","PSJBCMA5",59,0)
 N PSJTXT,LN
"RTN","PSJBCMA5",60,0)
 I $G(DFN)=""!($G(ON)="") Q 0
"RTN","PSJBCMA5",61,0)
 I '$G(PSJSYSP) N PSJSYSP S PSJSYSP=$J
"RTN","PSJBCMA5",62,0)
 I ON["P" D  Q +$P($G(^PS(53.45,+PSJSYSP,6,0)),"^",3)
"RTN","PSJBCMA5",63,0)
 .Q:$P($G(^PS(53.45,+PSJSYSP,6,0)),"^",3)
"RTN","PSJBCMA5",64,0)
 .I $P($G(^PS(53.1,+ON,16,0)),"^",3) D  Q
"RTN","PSJBCMA5",65,0)
 ..S ^PS(53.45,+PSJSYSP,6,0)=^PS(53.1,+ON,16,0)
"RTN","PSJBCMA5",66,0)
 ..S LN=0 F  S LN=$O(^PS(53.1,+ON,16,LN)) Q:'LN  S ^PS(53.45,+PSJSYSP,6,LN,0)=^PS(53.1,+ON,16,LN,0)
"RTN","PSJBCMA5",67,0)
 .N OLDOPI,MARX,TXTCNT S OLDOPI=$P($G(^PS(53.1,+ON,9)),"^",2) I $L(OLDOPI)>0 D  Q
"RTN","PSJBCMA5",68,0)
 ..I $G(BC),$L(OLDOPI)>74 D TXT^PSGMUTL(OLDOPI,74) S TXTCNT=$O(MARX(" "),-1) S ^PS(53.45,+PSJSYSP,6,0)="^^"_TXTCNT_"^"_TXTCNT D  Q
"RTN","PSJBCMA5",69,0)
 ...S TXTLN=0 F  S TXTLN=$O(MARX(TXTLN)) Q:'TXTLN  S ^PS(53.45,+PSJSYSP,6,TXTLN,0)=MARX(TXTLN)
"RTN","PSJBCMA5",70,0)
 ..S ^PS(53.45,+PSJSYSP,6,1,0)=$P(^PS(53.1,+ON,9),"^",2),^PS(53.45,+PSJSYSP,6,0)="^^1^1"
"RTN","PSJBCMA5",71,0)
 I ON["V" D
"RTN","PSJBCMA5",72,0)
 .Q:$P($G(^PS(53.45,+PSJSYSP,6,0)),"^",3)
"RTN","PSJBCMA5",73,0)
 .I $P($G(^PS(55,+DFN,"IV",+ON,10,0)),"^",3) D  Q
"RTN","PSJBCMA5",74,0)
 ..S ^PS(53.45,+PSJSYSP,6,0)=$G(^PS(55,DFN,"IV",+ON,10,0))
"RTN","PSJBCMA5",75,0)
 ..S LN=0 F  S LN=$O(^PS(55,DFN,"IV",+ON,10,LN)) Q:'LN  S ^PS(53.45,+PSJSYSP,6,LN,0)=^PS(55,DFN,"IV",+ON,10,LN,0)
"RTN","PSJBCMA5",76,0)
 .N OLDOPI,MARX,TXTCNT S OLDOPI=$P($G(^PS(55,DFN,"IV",+ON,3)),"^") I $L(OLDOPI)>0 D  Q
"RTN","PSJBCMA5",77,0)
 ..I $G(BC),$L(OLDOPI)>74 D TXT^PSGMUTL(OLDOPI,74) S TXTCNT=$O(MARX(" "),-1) S ^PS(53.45,+PSJSYSP,6,0)="^^"_TXTCNT_"^"_TXTCNT D  Q
"RTN","PSJBCMA5",78,0)
 ...S TXTLN=0 F  S TXTLN=$O(MARX(TXTLN)) Q:'TXTLN  S ^PS(53.45,+PSJSYSP,6,TXTLN,0)=MARX(TXTLN)
"RTN","PSJBCMA5",79,0)
 ..S ^PS(53.45,+PSJSYSP,6,1,0)=$P(^PS(55,DFN,"IV",+ON,3),"^"),^PS(53.45,+PSJSYSP,6,0)="^^1^1"
"RTN","PSJBCMA5",80,0)
 I $O(^PS(53.45,+PSJSYSP,6," "),-1)=1,($TR($G(^PS(53.45,+PSJSYSP,6,1,0))," ")="") K ^PS(53.45,+PSJSYSP,6)
"RTN","PSJBCMA5",81,0)
 Q +$P($G(^PS(53.45,+PSJSYSP,6,0)),"^",3)
"RTN","PSJBCMA5",82,0)
 ;
"RTN","PSJBCMA5",83,0)
EDITSI(DFN,PSJORD) ; Edit Special Instructions in ^PS(53.45 via Word Processing
"RTN","PSJBCMA5",84,0)
 N PSJII,DIC,I,PSJVALID,DIWESUB,PSJTXTLN S PSJVALID=0,DIC="^PS(53.45,"_+$G(PSJSYSP)_",5,",DIWESUB="SPECIAL INSTRUCTIONS"
"RTN","PSJBCMA5",85,0)
 I $G(PSJORD) I '$P($G(^PS(53.45,+$G(PSJSYSP),5,0)),"^",5) S L=$$GETSI(DFN,PSJORD)
"RTN","PSJBCMA5",86,0)
 K ^TMP("PSJTMPSI",$J) M ^TMP("PSJTMPSI",$J)=^PS(53.45,+$G(PSJSYSP),5)
"RTN","PSJBCMA5",87,0)
 F PSJII=1:1 Q:$G(PSJVALID)  D
"RTN","PSJBCMA5",88,0)
 .N II,L,DIR,DIE,DA,TMPLN,DR S PSJTXTLN="",PSJVALID=1,DIWESUB="SPECIAL INSTRUCTIONS"
"RTN","PSJBCMA5",89,0)
 .I PSJII=1 S DA=PSJSYSP,DR=5,DIE="^PS(53.45," D ^DIE
"RTN","PSJBCMA5",90,0)
 .I PSJII>1 S DA=PSJSYSP,DR=5,DIC="^PS(53.45,"_+$G(PSJSYSP)_",5," D EN^DIWE
"RTN","PSJBCMA5",91,0)
 .S PSJTXTLN=+$P($G(^PS(53.45,+PSJSYSP,5,0)),"^",3)
"RTN","PSJBCMA5",92,0)
 .S II=0 F  S II=$O(^PS(53.45,+PSJSYSP,5,II)) Q:'II!'$G(PSJVALID)  S TMPLN=$G(^(II,0)) I (TMPLN["^") S PSJVALID=0
"RTN","PSJBCMA5",93,0)
 .I 'PSJVALID W !!!,$C(7),"SPECIAL INSTRUCTIONS must not contain embedded uparrow ""^"". " I PSJII=1 D PAUSE("SPECIAL INSTRUCTIONS")
"RTN","PSJBCMA5",94,0)
 .I 'PSJVALID I PSJII>1 W ! I $$DONE("SPECIAL INSTRUCTIONS") K ^PS(53.45,+PSJSYSP,5) M ^PS(53.45,+$G(PSJSYSP),5)=^TMP("PSJTMPSI",$J) S PSJVALID=1 Q
"RTN","PSJBCMA5",95,0)
 .I PSJVALID I 'PSJTXTLN K ^PS(53.45,+PSJSYSP,5,0) S ^PS(53.45,+PSJSYSP,5,0)="-1^^0^0",^PS(53.45,+PSJSYSP,5,1,0)=""
"RTN","PSJBCMA5",96,0)
 I $P($G(^PS(53.45,+$G(PSJSYSP),5,0)),"^",3) D ENSI^PSJUTL("^PS(53.45,+$G(PSJSYSP),5,") S PSJTXTLN=$O(^PS(53.45,+$G(PSJSYSP),5,""),-1)
"RTN","PSJBCMA5",97,0)
 K ^TMP("PSJTMPSI",$J)
"RTN","PSJBCMA5",98,0)
 Q PSJTXTLN
"RTN","PSJBCMA5",99,0)
 ;
"RTN","PSJBCMA5",100,0)
EDITOPI(PSJDPT,PSJORD) ; Edit Other Print Info in ^PS(53.45 via Word Processing
"RTN","PSJBCMA5",101,0)
 N DIC,I,PSJVALID,DIWESUB,PSJTXTLN S PSJVALID=0,DIC="^PS(53.45,"_+$G(PSJSYSP)_",6,",DIWESUB="OTHER PRINT INFO"
"RTN","PSJBCMA5",102,0)
 K ^TMP("PSJTMPSI",$J) M ^TMP("PSJTMPSI",$J)=^PS(53.45,+$G(PSJSYSP),6)
"RTN","PSJBCMA5",103,0)
 F PSJII=1:1 Q:$G(PSJVALID)  D
"RTN","PSJBCMA5",104,0)
 .N II,L,DIR,DA,DIE,TMPLN S DIR="",PSJTXTLN="",PSJVALID=1,DIWESUB="OTHER PRINT INFO"
"RTN","PSJBCMA5",105,0)
 .I PSJII=1 D OPIWARN(0)
"RTN","PSJBCMA5",106,0)
 .S PSJTXTLN=""
"RTN","PSJBCMA5",107,0)
 .I PSJII=1 S DA=PSJSYSP,DR=6,DIE="^PS(53.45," D ^DIE
"RTN","PSJBCMA5",108,0)
 .I PSJII>1 S DA=PSJSYSP,DR=6,DIC="^PS(53.45,"_+$G(PSJSYSP)_",6," D EN^DIWE
"RTN","PSJBCMA5",109,0)
 .S PSJTXTLN=$O(^PS(53.45,+PSJSYSP,6,""),-1)
"RTN","PSJBCMA5",110,0)
 .I PSJTXTLN="" K ^PS(53.45,+PSJSYSP,6) S ^PS(53.45,+PSJSYSP,6,0)="-1^^1^1",^PS(53.45,+PSJSYSP,6,1,0)=""
"RTN","PSJBCMA5",111,0)
 .S II=0 F  S II=$O(^PS(53.45,+PSJSYSP,6,II)) Q:'II!'$G(PSJVALID)  S TMPLN=$G(^(II,0)) I (TMPLN["^") S PSJVALID=0
"RTN","PSJBCMA5",112,0)
 .I 'PSJVALID W !!!,$C(7),"OTHER PRINT INFO must not contain embedded uparrow ""^""." I PSJII=1 D PAUSE("OTHER PRINT INFO")
"RTN","PSJBCMA5",113,0)
 .I 'PSJVALID I PSJII>1 W ! I $$DONE("OTHER PRINT INFO") K ^PS(53.45,+PSJSYSP,6) M ^PS(53.45,+$G(PSJSYSP),6)=^TMP("PSJTMPSI",$J) S PSJVALID=1 Q
"RTN","PSJBCMA5",114,0)
 .I PSJVALID D
"RTN","PSJBCMA5",115,0)
 ..I ($L($G(^PS(53.45,+PSJSYSP,6,1,0)))>60) D OPIWARN(1) S P("OPI")="Instructions too long. See Order View or BCMA for full text^"_$P(P("OPI"),"^",2) Q
"RTN","PSJBCMA5",116,0)
 ..I PSJTXTLN=1,($L($G(^PS(53.45,+PSJSYSP,6,1,0)))<61) S P("OPI")=^PS(53.45,+PSJSYSP,6,1,0)_"^"_$P(P("OPI"),"^",2) Q
"RTN","PSJBCMA5",117,0)
 ..N TXT,OPIMSG,PSJTMPTX,PSJOVRMX S OPIMSG="Instructions too long. See Order View or BCMA for full text."
"RTN","PSJBCMA5",118,0)
 ..S PSJTMPTX="",PSJOVRMX=0 S TMPLIN=0 F  S TMPLIN=$O(^PS(53.45,+PSJSYSP,6,TMPLIN)) Q:'TMPLIN!(PSJOVRMX)  D
"RTN","PSJBCMA5",119,0)
 ...S:($L(PSJTMPTX)+$L($G(^PS(53.45,+PSJSYSP,6,TMPLIN,0))))>60 PSJOVRMX=1 Q:$G(PSJOVRMX)  S PSJTMPTX=$G(PSJTMPTX)_$S($G(PSJTMPTX)]"":" ",1:"")_$G(^PS(53.45,+PSJSYSP,6,TMPLIN,0))
"RTN","PSJBCMA5",120,0)
 ..I '$G(PSJOVRMX),(PSJTMPTX]"") S P("OPI")=PSJTMPTX_"^"_$P(P("OPI"),"^",2)
"RTN","PSJBCMA5",121,0)
 K ^TMP("PSJTMPSI",$J)
"RTN","PSJBCMA5",122,0)
 Q PSJTXTLN
"RTN","PSJBCMA5",123,0)
 ;
"RTN","PSJBCMA5",124,0)
OPIWARN(AFTER) ; Warn user about OPI not printing on IV labels
"RTN","PSJBCMA5",125,0)
 D OPIWARN^PSJBCMA1(AFTER)
"RTN","PSJBCMA5",126,0)
 Q
"RTN","PSJBCMA5",127,0)
 ;
"RTN","PSJBCMA5",128,0)
FILESI(DFN,PSJORD) ; File Special instructions from ^PS(53.45 to UD order
"RTN","PSJBCMA5",129,0)
 N LN,LNCNT,DA,DIE,X,Y,PSJTMPTX,TMPLIN,PSJOVRMX
"RTN","PSJBCMA5",130,0)
 I $G(PSGOEENO)'=1 D FILESI^PSJBCMA2(DFN,PSJORD) K ^PS(53.45,+$G(PSJSYSP),5)
"RTN","PSJBCMA5",131,0)
 Q
"RTN","PSJBCMA5",132,0)
 ;
"RTN","PSJBCMA5",133,0)
FILEOPI(DFN,ORDER) ; File Other Print Info from ^PS(53.45 to IV order
"RTN","PSJBCMA5",134,0)
 N LN,LNCNT,PSJORD S PSJORD=ORDER
"RTN","PSJBCMA5",135,0)
 D FILEOPI^PSJBCMA2(DFN,ORDER)
"RTN","PSJBCMA5",136,0)
 K ^PS(53.45,+PSJSYSP,6)
"RTN","PSJBCMA5",137,0)
 Q
"RTN","PSJBCMA5",138,0)
 ;
"RTN","PSJBCMA5",139,0)
DIFFSI(DFN,PSJORD) ; Compare Special Instructions, pre and post edit
"RTN","PSJBCMA5",140,0)
 N LN,DIFF S DIFF=0
"RTN","PSJBCMA5",141,0)
 S LN=0 F  S LN=$O(^PS(53.45,PSJSYSP,5,LN)) Q:'LN!DIFF  D
"RTN","PSJBCMA5",142,0)
 .I PSJORD["U" D
"RTN","PSJBCMA5",143,0)
 ..I LN=1 N OTOT,NTOT S OTOT=+$O(^PS(55,DFN,5,+PSJORD,15,""),-1),NTOT=+$O(^PS(53.45,PSJSYSP,5,""),-1) I NTOT'=OTOT S DIFF=1 Q
"RTN","PSJBCMA5",144,0)
 ..I $G(^PS(53.45,PSJSYSP,5,LN,0))'=$G(^PS(55,DFN,5,+PSJORD,15,LN,0)) S DIFF=1
"RTN","PSJBCMA5",145,0)
 .I PSJORD["P" D
"RTN","PSJBCMA5",146,0)
 ..I LN=1 N OTOT,NTNT S OTOT=+$O(^PS(53.1,+PSJORD,15,""),-1),NTOT=+$O(^PS(53.45,PSJSYSP,5,""),-1) I NTOT'=OTOT S DIFF=1 Q
"RTN","PSJBCMA5",147,0)
 ..I $G(^PS(53.45,PSJSYSP,5,LN,0))'=$G(^PS(53.1,+PSJORD,15,LN,0)) S DIFF=1
"RTN","PSJBCMA5",148,0)
 Q $S(DIFF:1,1:0)
"RTN","PSJBCMA5",149,0)
 ;
"RTN","PSJBCMA5",150,0)
DIFFOPI(DFN,PSJORD) ; Compare Other Print Info, pre and post edit
"RTN","PSJBCMA5",151,0)
 N LN,DIFF S DIFF=0
"RTN","PSJBCMA5",152,0)
 S LN=0 F  S LN=$O(^PS(53.45,PSJSYSP,6,LN)) Q:'LN!DIFF  D
"RTN","PSJBCMA5",153,0)
 .I PSJORD["V" D
"RTN","PSJBCMA5",154,0)
 ..I LN=1 N OTOT,NTOT S OTOT=+$O(^PS(55,DFN,"IV",+PSJORD,10,""),-1),NTOT=+$O(^PS(53.45,PSJSYSP,6,""),-1) I NTOT'=OTOT S DIFF=1 Q
"RTN","PSJBCMA5",155,0)
 ..I $G(^PS(53.45,PSJSYSP,6,LN,0))'=$G(^PS(55,DFN,"IV",+PSJORD,10,LN,0)) S DIFF=1
"RTN","PSJBCMA5",156,0)
 .I PSJORD["P" D
"RTN","PSJBCMA5",157,0)
 ..I LN=1 N OTOT,NTOT S OTOT=+$O(^PS(53.1,+PSJORD,16,""),-1),NTOT=+$O(^PS(53.45,PSJSYSP,6,""),-1) I NTOT'=OTOT S DIFF=1 Q
"RTN","PSJBCMA5",158,0)
 ..I $G(^PS(53.45,PSJSYSP,6,LN,0))'=$G(^PS(53.1,+PSJORD,16,LN,0)) S DIFF=1
"RTN","PSJBCMA5",159,0)
 Q $S(DIFF:1,1:0)
"RTN","PSJBCMA5",160,0)
 ;
"RTN","PSJBCMA5",161,0)
DIFFAR(ARRAY1,ARRAY2) ; Compare two text arrays
"RTN","PSJBCMA5",162,0)
 N LN,DIFF,OTOT,NTOT S DIFF=0,OTOT=0,NTOT=0
"RTN","PSJBCMA5",163,0)
 S LN=0 F  S LN=$O(ARRAY1(LN)) Q:'LN!DIFF  I ARRAY1(LN,0)'=$G(ARRAY2(LN,0)) S DIFF=1
"RTN","PSJBCMA5",164,0)
 Q $S(DIFF:1,1:0)
"RTN","PSJBCMA5",165,0)
 ;
"RTN","PSJBCMA5",166,0)
MVOPI(DFN,PSJI1,PSJI2) ; Move OPI from Non-Verified order to Active order during Verify
"RTN","PSJBCMA5",167,0)
 Q:'$G(DFN)!'$G(PSJI1)!'$G(PSJI2)
"RTN","PSJBCMA5",168,0)
 I PSJI1["P",PSJI2["V" D GETOPI(DFN,PSJI1),FILEOPI(DFN,PSJI2)
"RTN","PSJBCMA5",169,0)
 Q
"RTN","PSJBCMA5",170,0)
 ;
"RTN","PSJBCMA5",171,0)
MVOPIAL(DFN,PSJI1,PSJI2) ; Move Other Print Info Activity log entries from NV order to Active order, during Verification
"RTN","PSJBCMA5",172,0)
 D MVOPIAL^PSJBCMA1(DFN,PSJI1,PSJI2)
"RTN","PSJBCMA5",173,0)
 Q
"RTN","PSJBCMA5",174,0)
 ;
"RTN","PSJBCMA5",175,0)
KILL(USR) ; Clean up ^PS(53.45
"RTN","PSJBCMA5",176,0)
 K ^PS(53.45,+$G(USR),5),^PS(53.45,+$G(USR),6)
"RTN","PSJBCMA5",177,0)
 Q
"RTN","PSJBCMA5",178,0)
 ;
"RTN","PSJBCMA5",179,0)
PAUSE(DEF) ;
"RTN","PSJBCMA5",180,0)
 K DIR W ! S DIR(0)="EA",DIR("A")="Press Return to continue editing "_$G(DEF)_"...",DIR("?")="Press Return to continue..." D ^DIR W !
"RTN","PSJBCMA5",181,0)
 Q
"RTN","PSJBCMA5",182,0)
 ;
"RTN","PSJBCMA5",183,0)
DONE(DEF) ; -- Done editing?
"RTN","PSJBCMA5",184,0)
 N DIR,X,Y
"RTN","PSJBCMA5",185,0)
 S DIR(0)="YA",DIR("A")="Do you want to quit and discard changes"_$S(($G(DEF)]""):" to "_DEF,1:"")_"? ",DIR("B")="NO"
"RTN","PSJBCMA5",186,0)
 S DIR("?",1)="    Enter YES to exit without saving changes, or ",DIR("?")="    enter NO to continue editing "_$S(($G(DEF)]""):DEF,1:"")_"."
"RTN","PSJBCMA5",187,0)
 D ^DIR
"RTN","PSJBCMA5",188,0)
 Q $S($E(Y)="^":1,1:+Y)
"RTN","PSJUTL")
0^2^B135053726^B137966319
"RTN","PSJUTL",1,0)
PSJUTL ;BIR/MLM - MISC. INPATIENT UTILITIES ; 10/7/08 1:22pm
"RTN","PSJUTL",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**9,47,58,80,110,136,157,177,134,179,267,349,361**;16 DEC 97;Build 7
"RTN","PSJUTL",3,0)
 ;
"RTN","PSJUTL",4,0)
 ; Reference to ^DIC(42 is supported by DBIA 10039.
"RTN","PSJUTL",5,0)
 ; Reference to ^PS(50.7 is supported by DBIA 2180.
"RTN","PSJUTL",6,0)
 ; Reference to ^PSDRUG( is supported by DBIA 2192.
"RTN","PSJUTL",7,0)
 ; Reference to ^DIC is supported by DBIA 10006.
"RTN","PSJUTL",8,0)
 ; Reference to ^DIC1 is supported by DBIA 10007.
"RTN","PSJUTL",9,0)
 ; Reference to ^DIR is supported by DBIA 10026.
"RTN","PSJUTL",10,0)
 ; Reference to ^VALM1 is supported by DBIA 10116.
"RTN","PSJUTL",11,0)
 ;
"RTN","PSJUTL",12,0)
ENDL ; device look-up
"RTN","PSJUTL",13,0)
 N DA,DIC,DIE,DIX,DO,DR
"RTN","PSJUTL",14,0)
 S DIC="^%ZIS(1,",DIC(0)="EIMZ" D DO^DIC1,^DIC I Y'>0 K X Q
"RTN","PSJUTL",15,0)
 S X=Y(0,0)
"RTN","PSJUTL",16,0)
 Q
"RTN","PSJUTL",17,0)
 ;
"RTN","PSJUTL",18,0)
ENDH(X) ; device help
"RTN","PSJUTL",19,0)
 N D,XQH,DA,DIC,DIE,DO,DR,DZ
"RTN","PSJUTL",20,0)
 S DIC="^%ZIS(1,",DIC(0)="EIM" D DO^DIC1,^DIC
"RTN","PSJUTL",21,0)
 Q
"RTN","PSJUTL",22,0)
 ;
"RTN","PSJUTL",23,0)
READ ; hold screen
"RTN","PSJUTL",24,0)
 I $D(IOST) Q:$E(IOST)'="C"
"RTN","PSJUTL",25,0)
 W ! I $D(IOSL),$Y<(IOSL-4) G READ
"RTN","PSJUTL",26,0)
 W !?5,"Press return to continue  " R X:$S($D(DTIME):DTIME,1:300)
"RTN","PSJUTL",27,0)
 Q
"RTN","PSJUTL",28,0)
 ;
"RTN","PSJUTL",29,0)
ENOISC(PSJOI,USAGE)          ;Set DIC("S") so that only Orderable Items with at 
"RTN","PSJUTL",30,0)
 ;least 1 active dispense drug for the specified usage.
"RTN","PSJUTL",31,0)
 ;Input:  PSJOI IEN of Orderable Item selected
"RTN","PSJUTL",32,0)
 ;        USAGE - Type of drugs (UD,IV,etc) to be selected
"RTN","PSJUTL",33,0)
 ;Output: 1-At least one dispense drug found
"RTN","PSJUTL",34,0)
 ;        0-None found
"RTN","PSJUTL",35,0)
 N FOUND,PSJ
"RTN","PSJUTL",36,0)
 S PSJ=$P($G(^PS(50.7,+PSJOI,0)),U,4),FOUND=$S('PSJ:1,PSJ>DT:1,1:0)
"RTN","PSJUTL",37,0)
 I FOUND S FOUND=0 F PSJ=0:0 S PSJ=$O(^PSDRUG("ASP",PSJOI,PSJ)) Q:FOUND!'PSJ  I $P($G(^PSDRUG(PSJ,2)),U,3)[USAGE,'$G(^("I"))!($G(^("I"))'<DT) S FOUND=1
"RTN","PSJUTL",38,0)
 Q FOUND
"RTN","PSJUTL",39,0)
 ;
"RTN","PSJUTL",40,0)
AADR ; display allergies and adverse reactions
"RTN","PSJUTL",41,0)
 D ATS^PSJMUTL(60,50,1) N A,B
"RTN","PSJUTL",42,0)
 I (PSGALG=0)&(PSGADR=0) W !!,"No allergies or ADRs on file."
"RTN","PSJUTL",43,0)
 I PSGALG'=0 W !!,"Allergies: " S B="PSGALG" F  S A=$Q(@B) Q:A=""  W ?12,$G(@A),! S B=A
"RTN","PSJUTL",44,0)
 I PSGADR'=0 W !,"      ADR: " S B="PSGADR" F  S A=$Q(@B) Q:A=""  W ?12,$G(@A),! S B=A
"RTN","PSJUTL",45,0)
 D READ K PSGALG,PSGADR Q
"RTN","PSJUTL",46,0)
 ;
"RTN","PSJUTL",47,0)
ENALU ; application look-up
"RTN","PSJUTL",48,0)
 N PSJ S PSJ=DA(1) N DA,DIC,DIE,DIX,DO,DR S DIC="^PS(50.35,",DIC(0)="EIMZ" D DO^DIC1,^DIC I Y'>0 K X Q
"RTN","PSJUTL",49,0)
 S X=$P(Y(0),"^",2) K:$S(X="":1,1:$D(^PS(50.3,PSJ,1,"B",X))) X
"RTN","PSJUTL",50,0)
 Q
"RTN","PSJUTL",51,0)
 ;
"RTN","PSJUTL",52,0)
ENAQ ; application query
"RTN","PSJUTL",53,0)
 S X=DZ N D,DA,DIC,DIE,DO,DR,DZ,XQH S DIC="^PS(50.35,",DIC(0)="EIMQ" D DO^DIC1,^DIC
"RTN","PSJUTL",54,0)
 Q
"RTN","PSJUTL",55,0)
 ;
"RTN","PSJUTL",56,0)
ENPCL(PSJTYP,PSGP,PSJORD) ; Copy Provider Comments -> Special Instructions.
"RTN","PSJUTL",57,0)
 Q:'$G(PSJORD) ""
"RTN","PSJUTL",58,0)
 Q:'$D(^PS(53.1,+$G(PSJORD),12,1,0)) ""
"RTN","PSJUTL",59,0)
 ; Count number of lines minus blank trailing lines
"RTN","PSJUTL",60,0)
 N LN,LNCNT S LNCNT=0,LN=9999 F  S LN=$O(^PS(53.1,+$G(PSJORD),12,LN),-1) Q:'LN  D
"RTN","PSJUTL",61,0)
 .I 'LNCNT,($G(^PS(53.1,+$G(PSJORD),12,LN,0))="") Q
"RTN","PSJUTL",62,0)
 .S LNCNT=LNCNT+1
"RTN","PSJUTL",63,0)
 I 'LNCNT Q ""
"RTN","PSJUTL",64,0)
 K ^PS(53.45,+$G(PSJSYSP),5),^PS(53.45,+$G(PSJSYSP),6)
"RTN","PSJUTL",65,0)
 N DIR,X,Y,PSJSAVY S (X,Y)="" F  S X=$O(^PS(53.1,+$G(PSJORD),12,X)) Q:'X  S Y=$G(^PS(53.1,+$G(PSJORD),12,X)) S:($G(PSJTYP)'="V") Y=$$ENSET^PSGSICHK(Y) S ^PS(53.45,+$G(PSJSYSP),5,X,0)=Y
"RTN","PSJUTL",66,0)
 W !,"PROVIDER COMMENTS: "
"RTN","PSJUTL",67,0)
 ;Display Provider Comments Prior to Asking the Copy Provider Comments Question;BHW;PSJ*5*136
"RTN","PSJUTL",68,0)
 N PSJTMP S PSJTMP=0
"RTN","PSJUTL",69,0)
 F  S PSJTMP=$O(^PS(53.1,+$G(PSJORD),12,PSJTMP)) Q:'PSJTMP  W !,^PS(53.1,+$G(PSJORD),12,PSJTMP,0)
"RTN","PSJUTL",70,0)
 S PSGSI=Y W ! S DIR(0)="S^Y:Yes (copy);N:No (don't copy);!:Copy and flag for display in a BCMA Message Box;E:Copy and Edit;"
"RTN","PSJUTL",71,0)
 S DIR("A")="Copy the Provider Comments into "_$$ENFIELD(PSJTYP)_" (Yes/No/!/E)",DIR("??")="^D ENPCHLP1^PSJUTL(PSJTYP)" D ^DIR S PSJSAVY=Y
"RTN","PSJUTL",72,0)
 S PSGSI=$S(PSJSAVY="Y":$P(PSGSI,"^"),PSJSAVY="!":$P(PSGSI,"^")_"^1",PSJSAVY="E":$P(PSGSI,"^"),1:"")
"RTN","PSJUTL",73,0)
 I PSJSAVY="Y"!(PSJSAVY="E")!(PSJSAVY="!") D
"RTN","PSJUTL",74,0)
 .I ($G(PSJTYP)="V") N OPILN S OPILN=$O(^PS(53.1,+$G(PSJORD),12," "),-1) N TXT,OPIMSG,PSJTMPTX,PSJOVRMX S OPIMSG="Instructions too long. See Order View or BCMA for full text." D
"RTN","PSJUTL",75,0)
 ..S PSJTMPTX="",PSJOVRMX=0 S TMPLIN=0 F  S TMPLIN=$O(^PS(53.1,+PSJORD,12,TMPLIN)) Q:'TMPLIN!(PSJOVRMX)  D
"RTN","PSJUTL",76,0)
 ...S:($L(PSJTMPTX)+$L($G(^PS(53.1,+PSJORD,12,TMPLIN,0))))>60 PSJOVRMX=1 Q:$G(PSJOVRMX)  S PSJTMPTX=$G(PSJTMPTX)_$S($G(PSJTMPTX)]"":" ",1:"")_$G(^PS(53.1,+PSJORD,12,TMPLIN,0))
"RTN","PSJUTL",77,0)
 ..S PSGSI=$S(PSJTMPTX]"":PSJTMPTX,1:OPIMSG) I $G(PSJOVRMX),(PSJSAVY'="E") D OPIWARN^PSJBCMA5(1)
"RTN","PSJUTL",78,0)
 .S PSGSI=$S(PSJSAVY="!":$P($$PUT5345(PSGORD),"^")_"^1",1:$P($$PUT5345(PSGORD),"^"))
"RTN","PSJUTL",79,0)
 I PSJSAVY="E"  K ^PS(53.45,+$G(PSJSYSP),5),^PS(53.45,+$G(PSJSYSP),6) D
"RTN","PSJUTL",80,0)
 .N PRVCLN,X S PRVCLN=$O(^PS(53.1,+$G(PSJORD),12,""),-1)
"RTN","PSJUTL",81,0)
 .S:($G(PSJTYP)["V") ^PS(53.45,+$G(PSJSYSP),6,0)="^53.1136^"_+$G(PRVCLN)_"^"_+$G(PRVCLN)_"^"_1
"RTN","PSJUTL",82,0)
 .S:($G(PSJTYP)'["V") ^PS(53.45,+$G(PSJSYSP),5,0)="^53.1135^"_+$G(PRVCLN)_"^"_+$G(PRVCLN)_"^"_1
"RTN","PSJUTL",83,0)
 .S X=0 F  S X=$O(^PS(53.1,+$G(PSJORD),12,X)) Q:'X  S Y=$G(^PS(53.1,+$G(PSJORD),12,X,0)) S:($G(PSJTYP)'="V") Y=$$ENSET^PSGSICHK(Y) S ^PS(53.45,+$G(PSJSYSP),$S($G(PSJTYP)="V":6,1:5),X,0)=Y
"RTN","PSJUTL",84,0)
 .D:PSJTYP="V" EDITOPI^PSJBCMA5(PSGP,PSJORD) D:PSJTYP'="V" EDITSI^PSJBCMA5(PSGP,PSJORD)
"RTN","PSJUTL",85,0)
 I PSJSAVY="E" S PSGSI=$$ENBCMA(PSJTYP)
"RTN","PSJUTL",86,0)
 Q PSGSI
"RTN","PSJUTL",87,0)
 ;
"RTN","PSJUTL",88,0)
ENPC(PSJTYP,PSJSYSP,LEN,TEXT) ; Copy Provider Comments -> Special Instructions.
"RTN","PSJUTL",89,0)
 S PSGSI=$$ENPCL(PSJTYP,$G(PSGP),$G(PSGORD))
"RTN","PSJUTL",90,0)
 Q PSGSI
"RTN","PSJUTL",91,0)
 ;
"RTN","PSJUTL",92,0)
REDISP ; Redisplay Provider Comments and allow entry of Spec. Instructions.
"RTN","PSJUTL",93,0)
 D CLEAR^VALM1 F X=0:0 S X=$O(^PS(53.1,+$G(PSJORD),12,X)) Q:'X  W ^(X,0),!
"RTN","PSJUTL",94,0)
 W !! S PSGSI=""
"RTN","PSJUTL",95,0)
 D:PSJTYP'="V" 8^PSGOE81
"RTN","PSJUTL",96,0)
 I PSJTYP="V" D 64^PSIVEDT1 S PSGSI=P("OPI")
"RTN","PSJUTL",97,0)
 Q
"RTN","PSJUTL",98,0)
 ;
"RTN","PSJUTL",99,0)
ENPCHLP1(Y) ; Display help messages for Provider Comment copy.
"RTN","PSJUTL",100,0)
 W !,"Enter ""YES"" to copy Provider Comments into the ",$$ENFIELD(Y)," field",!,"or ""NO"" to bypass",!,"or ""!"" to copy the Provider Comments into the ",$$ENFIELD(PSJTYP)," field",!,"and flag them for display in a BCMA Message Box"
"RTN","PSJUTL",101,0)
 W !,"or type ""E"" to copy the Provider Comments into the ",$$ENFIELD(PSJTYP)," field and open a word processing window for editing."
"RTN","PSJUTL",102,0)
 Q
"RTN","PSJUTL",103,0)
ENPCHLP2(Y,X) ;
"RTN","PSJUTL",104,0)
 W !,"The Provider Comments entered for this order are longer than the space available",!,"in the ",$$ENFIELD(Y)," field.",!!,"Enter ""YES"" to copy the first ",X-3," characters into the ",$$ENFIELD(Y),!,"field, or ""NO"" to continue.",!!
"RTN","PSJUTL",105,0)
 Q
"RTN","PSJUTL",106,0)
ENBCMA(PSJTYP)  ;
"RTN","PSJUTL",107,0)
 N DIR,X,Y
"RTN","PSJUTL",108,0)
 I $G(PSJTYP)="V" Q:'$L($G(^PS(53.45,+$G(PSJSYSP),6,0))) ""
"RTN","PSJUTL",109,0)
 I $G(PSJTYP)="V" Q:($G(^PS(53.45,+$G(PSJSYSP),6,0))<0) ""
"RTN","PSJUTL",110,0)
 I $G(PSJTYP)="U" Q:'$L($G(^PS(53.45,+$G(PSJSYSP),5,0))) ""
"RTN","PSJUTL",111,0)
 W !!,"Would you like to flag the ",$$ENFIELD(PSJTYP)," field for display in a BCMA",!,"Message box?"
"RTN","PSJUTL",112,0)
 W ! S DIR(0)="S^Y:Yes;N:No",DIR("A")="Flag the "_$$ENFIELD(PSJTYP)_" (Yes/No)" D ^DIR
"RTN","PSJUTL",113,0)
 K PSJCOMSI I $G(PSJCOM),$G(PSJORD)'["P" N TEXT S TEXT=$S(PSJTYP="U":$G(PSGSI),1:$G(P("OPI"))) S PSJCOMSI=$$COMSI(PSJCOM,TEXT)
"RTN","PSJUTL",114,0)
 Q:Y="Y" $S($G(PSJTYP)="U":$P(PSGSI,"^")_"^1",1:$P(P("OPI"),"^")_"^1")
"RTN","PSJUTL",115,0)
 Q $S(PSJTYP="U":PSGSI,1:P("OPI"))
"RTN","PSJUTL",116,0)
ENFIELD(Y) ;
"RTN","PSJUTL",117,0)
 Q $S(Y="V":"Other Print Info",1:"Special Instructions")
"RTN","PSJUTL",118,0)
 ;
"RTN","PSJUTL",119,0)
COMSI(PARENT,INSTR) ;
"RTN","PSJUTL",120,0)
 N DIR,X,Y
"RTN","PSJUTL",121,0)
 W !!!!?15,"** WARNING **",!?5,"This order is part of a complex order."
"RTN","PSJUTL",122,0)
 W !!,"Would you like to copy the ",$$ENFIELD(PSJTYP)
"RTN","PSJUTL",123,0)
 W !,"to the other orders in the complex order?"
"RTN","PSJUTL",124,0)
 S DIR(0)="S^Y:Yes;N:No",DIR("A")="     Copy the "_$$ENFIELD(PSJTYP)_" (Yes/No)" D ^DIR
"RTN","PSJUTL",125,0)
 Q:Y="Y" 1
"RTN","PSJUTL",126,0)
 Q 0
"RTN","PSJUTL",127,0)
 ;
"RTN","PSJUTL",128,0)
ENORL(X) ; Return patient's location as variable ptr.
"RTN","PSJUTL",129,0)
 Q $S(+$G(^DIC(42,+X,44)):+$G(^(44))_";SC(",$D(^DIC(42,+X,0)):+X_";DIC(42,",1:"")
"RTN","PSJUTL",130,0)
 ;
"RTN","PSJUTL",131,0)
ENMARD() ; validate MAR SELECTION DEFAULT string in WARD PARMS file.
"RTN","PSJUTL",132,0)
 N PSJANS,PSJX1,PSJX2,RANGE,Q
"RTN","PSJUTL",133,0)
 S RANGE="1:6" F PSJX1=1:1:6 S RANGE(PSJX1)=""
"RTN","PSJUTL",134,0)
 S:$E(X)="-" X=+RANGE_X S:$E($L(X))="-" X=X_$P(RANGE,":",2)
"RTN","PSJUTL",135,0)
 S PSJANS="" F Q=1:1:$L(X,",") S PSJX1=$P(X,",",Q) D FS Q:'$D(PSJANS)
"RTN","PSJUTL",136,0)
 Q:'$G(PSJANS) 0
"RTN","PSJUTL",137,0)
 S PSJANS=$E(PSJANS,1,$L(PSJANS)-1) F Q=1:1:$L(PSJANS,",") D  Q:'$D(PSJANS)
"RTN","PSJUTL",138,0)
 .I $P(PSJANS,",",Q)=1,$L(PSJANS,",")>1 W !!,"All Medications (1) may not be selected in combination with other types." K PSJANS Q
"RTN","PSJUTL",139,0)
 .W ?47,$P(PSJANS,",",Q)," - ",$P($T(@$P(PSJANS,",",Q)),";;",2),!
"RTN","PSJUTL",140,0)
 S:$G(PSJANS) X=PSJANS Q $G(PSJANS)
"RTN","PSJUTL",141,0)
 ;
"RTN","PSJUTL",142,0)
FS ;
"RTN","PSJUTL",143,0)
 I $S(PSJX1?1.N1"-"1.N:0,PSJX1'?1.N:1,'$D(RANGE(PSJX1)):1,1:","_PSJANS[PSJX1) K PSJANS Q
"RTN","PSJUTL",144,0)
 I PSJX1'["-" S PSJANS=PSJANS_PSJX1_"," Q
"RTN","PSJUTL",145,0)
 S PSJX2=+PSJX1,PSJANS=PSJANS_PSJX2_","
"RTN","PSJUTL",146,0)
 F  S PSJX2=$O(RANGE(PSJX2)) K:$S(X="":1,","_PSJANS[PSJX2:1,1:PSJX2>$P(PSJX1,"-",2)) PSJANS Q:'$D(PSJANS)  S PSJANS=PSJANS_PSJX2_"," Q:PSJX2=$P(PSJX1,"-",2)
"RTN","PSJUTL",147,0)
 Q
"RTN","PSJUTL",148,0)
 ;
"RTN","PSJUTL",149,0)
ENMARDH ;Help text for MAR default answer.
"RTN","PSJUTL",150,0)
 W !!?2,"Enter the number corresponding to the type of orders to be included on MARs",!,"printed for this ward. Multiple types (except 1) may be selected using ""-""",!,"or "","" as delimiters.",!!,"Choose from: ",!
"RTN","PSJUTL",151,0)
 N X F X=1:1:6 W !?13,X," - ",$P($T(@X),";;",2)
"RTN","PSJUTL",152,0)
 W !
"RTN","PSJUTL",153,0)
 Q
"RTN","PSJUTL",154,0)
1 ;;All Medications
"RTN","PSJUTL",155,0)
2 ;;Non-IV Medications only
"RTN","PSJUTL",156,0)
3 ;;IV Piggybacks
"RTN","PSJUTL",157,0)
4 ;;LVPs
"RTN","PSJUTL",158,0)
5 ;;TPNs
"RTN","PSJUTL",159,0)
6 ;;Chemotherapy Medications (IV)
"RTN","PSJUTL",160,0)
 ;
"RTN","PSJUTL",161,0)
EFD ;The following EFD Tags are used to Calculate the Expected First Dose for backdoor
"RTN","PSJUTL",162,0)
 ;orders.  The call to $$ENQ^PSJORP2 is used to actually perform the calculation.
"RTN","PSJUTL",163,0)
 ;The program $$ENQ^PSJORP2 requires the variable INFO to equal the following:
"RTN","PSJUTL",164,0)
 ;BHW;PSJ*5*136
"RTN","PSJUTL",165,0)
 ; INFO (piece 1) = START DATE/TIME      ;PSGNESD (NEW ORDER)
"RTN","PSJUTL",166,0)
 ; INFO (piece 2) = STOP DATE/TIME       ;PSGNEFD (NEW ORDER)
"RTN","PSJUTL",167,0)
 ; INFO (piece 3) = SCHEDULE             ;PSGSCH  (NEW ORDER)
"RTN","PSJUTL",168,0)
 ; INFO (piece 4) = SCHEDULE TYPE        ;PSGST   (NEW ORDER)
"RTN","PSJUTL",169,0)
 ; INFO (piece 5) = ORDERABLE ITEM       ;PSGDRG  (NEW ORDER)
"RTN","PSJUTL",170,0)
 ; INFO (piece 6) = ADMIN TIMES          ;PSGS0Y  (NEW ORDER)
"RTN","PSJUTL",171,0)
 ; 
"RTN","PSJUTL",172,0)
EFDNEW ;Call Here if NEW or RENEWED Order
"RTN","PSJUTL",173,0)
 N INFO
"RTN","PSJUTL",174,0)
 S INFO=($G(PSGNESD))_U_($G(PSGNEFD))_U_($G(PSGSCH))_U_($G(PSGST))_U_($G(PSGDRG))_U_($G(PSGS0Y))
"RTN","PSJUTL",175,0)
 D EFDDISP
"RTN","PSJUTL",176,0)
 QUIT
"RTN","PSJUTL",177,0)
EFDACT ;Call here if Editing Fields for an ACTIVE order
"RTN","PSJUTL",178,0)
 ; Field 10 = Start Date
"RTN","PSJUTL",179,0)
 ; Field 34 = Stop Date
"RTN","PSJUTL",180,0)
 ; Field 41 = Admin Times
"RTN","PSJUTL",181,0)
 N INFO,KEY,ORDER,LAST
"RTN","PSJUTL",182,0)
 ;Loop Fields to be edited, in order, and determine when to Display expected first dose message
"RTN","PSJUTL",183,0)
 F KEY=1:1 S ORDER=$P(PSGOEER,";",KEY) Q:'$L(ORDER)  I "10^34^41"[$P(ORDER,U,1) S ORDER(KEY)=$P(ORDER,U,1)
"RTN","PSJUTL",184,0)
 ;If there are no entries in ORDER, then were Not Editing Start/Stop or Admin Times
"RTN","PSJUTL",185,0)
 S LAST=$O(ORDER(99),-1) Q:'LAST
"RTN","PSJUTL",186,0)
 ;BHW;PSJ*5*179;Remove "Display Once" logic.
"RTN","PSJUTL",187,0)
 ;S LAST=ORDER(LAST)
"RTN","PSJUTL",188,0)
 ;I LAST'=PSGF2 Q
"RTN","PSJUTL",189,0)
 S INFO=($G(PSGSD))_U_($G(PSGFD))_U_($G(PSGSCH))_U_($G(PSGST))_U_($G(PSGPDRG))_U_($G(PSGS0Y))
"RTN","PSJUTL",190,0)
 S PSGEFDMG="Next Dose Due"
"RTN","PSJUTL",191,0)
 D EFDDISP
"RTN","PSJUTL",192,0)
 QUIT
"RTN","PSJUTL",193,0)
EFDNV ;Call here if Editing Fields for a NON-VERIFIED order
"RTN","PSJUTL",194,0)
 ; Field 10 = Start Date
"RTN","PSJUTL",195,0)
 ; Field 25 = Stop Date
"RTN","PSJUTL",196,0)
 ; Field 39 = Admin Times
"RTN","PSJUTL",197,0)
 N INFO,KEY,ORDER,LAST
"RTN","PSJUTL",198,0)
 ;Check if called during finish process
"RTN","PSJUTL",199,0)
 I '$D(PSGOEER) D  D EFDDISP Q
"RTN","PSJUTL",200,0)
 . S INFO=($G(PSGNESD))_U_($G(PSGNEFD))_U_($G(PSGSCH))_U_($G(PSGST))_U_($G(PSGPDRG))_U_($G(PSGS0Y))
"RTN","PSJUTL",201,0)
 . Q
"RTN","PSJUTL",202,0)
 ;Loop Fields to be edited, in order, and determine when to Display expected first dose message
"RTN","PSJUTL",203,0)
 F KEY=1:1 S ORDER=$P(PSGOEER,";",KEY) Q:'$L(ORDER)  I "10^25^39"[$P(ORDER,U,1) S ORDER(KEY)=$P(ORDER,U,1)
"RTN","PSJUTL",204,0)
 ;If there are no entries in ORDER, then were Not Editing Start/Stop or Admin Times
"RTN","PSJUTL",205,0)
 S LAST=$O(ORDER(99),-1) Q:'LAST
"RTN","PSJUTL",206,0)
 ;Only display EFD once, so Quit if this call is not for the Last field in the Edit
"RTN","PSJUTL",207,0)
 S LAST=ORDER(LAST)
"RTN","PSJUTL",208,0)
 I LAST'=PSGF2 Q
"RTN","PSJUTL",209,0)
 S INFO=($G(PSGSD))_U_($G(PSGFD))_U_($G(PSGSCH))_U_($G(PSGST))_U_($G(PSGPDRG))_U_($G(PSGS0Y))
"RTN","PSJUTL",210,0)
 D EFDDISP
"RTN","PSJUTL",211,0)
 QUIT
"RTN","PSJUTL",212,0)
EFDIV(PSGZZND) ;Set variables for EFD on IV orders.
"RTN","PSJUTL",213,0)
 I $G(PSGZZND)="" D
"RTN","PSJUTL",214,0)
 .N X,ZZND,LYN,PSGS0XT,PSGS0Y,PSGOES S PSGOES=1 S X=P(9) D EN^PSGS0 S:$G(ZZND)'="" PSGZZND=ZZND
"RTN","PSJUTL",215,0)
 S PSGNESD=P(2),PSGNEFD=P(3),PSGSCH=P(9),PSGST=$P($G(PSGZZND),"^",5),PSGDRG=$P($G(P("PD")),"^"),PSGS0Y=P(11)
"RTN","PSJUTL",216,0)
 ;BHW - PSJ*5*177 Add call to check stop date.  If it's in the past, Display Message
"RTN","PSJUTL",217,0)
 D CHKSTOP
"RTN","PSJUTL",218,0)
 D EFDNEW
"RTN","PSJUTL",219,0)
 W !
"RTN","PSJUTL",220,0)
 Q
"RTN","PSJUTL",221,0)
EFDDISP ;Display Expected First Dose
"RTN","PSJUTL",222,0)
 N Y,Z
"RTN","PSJUTL",223,0)
 Q:$G(PSGST)="OC"!($G(PSGST)="P")!($G(PSGST)="O")
"RTN","PSJUTL",224,0)
 Q:$G(PSGSCH)["ON CALL"!($G(PSGSCH)["ON-CALL")!($G(PSGSCH)["ONCALL")
"RTN","PSJUTL",225,0)
 Q:$G(PSGSCH)["PRN"
"RTN","PSJUTL",226,0)
 I '$L($G(PSGP)) N PSGP S PSGP=""
"RTN","PSJUTL",227,0)
 S Y=$$ENQ^PSJORP2(PSGP,INFO)
"RTN","PSJUTL",228,0)
 I 'Y S Y="Unable to Calculate"
"RTN","PSJUTL",229,0)
 X ^DD("DD")
"RTN","PSJUTL",230,0)
 ;BHW;PSJ*5*179;Add Variable Message. "Next Dose Due".  Default to "Expected First Dose"
"RTN","PSJUTL",231,0)
 I '$D(PSGEFDMG) S PSGEFDMG="Expected First Dose"
"RTN","PSJUTL",232,0)
 W !,PSGEFDMG,": ",Y H 3
"RTN","PSJUTL",233,0)
 K PSGEFDMG
"RTN","PSJUTL",234,0)
 Q
"RTN","PSJUTL",235,0)
CHKSTOP ;BHW - PSJ*5*177 Warn user if the Stop Date is < now.
"RTN","PSJUTL",236,0)
 I '+$G(P(3)) Q
"RTN","PSJUTL",237,0)
 N PSNOW,%,%H,%I,X D NOW^%DTC S PSNOW=%
"RTN","PSJUTL",238,0)
 I +P(3)<PSNOW D  Q
"RTN","PSJUTL",239,0)
 . W !,$C(7),"The Stop Date/Time is in the Past!!!  This order will",!,"automatically EXPIRE upon Verification!!",!
"RTN","PSJUTL",240,0)
 . Q
"RTN","PSJUTL",241,0)
 Q
"RTN","PSJUTL",242,0)
 ;
"RTN","PSJUTL",243,0)
PUT5345(PSGORD) ; Get text from provider comments, place into temp storage
"RTN","PSJUTL",244,0)
 Q:'$D(^PS(53.1,+PSGORD,12)) ""
"RTN","PSJUTL",245,0)
 N PSJTMPTX,PSJOVRMX,TMPLIN,SIMSG
"RTN","PSJUTL",246,0)
 N LN,TXT,LNCNT S TXT="",LN=0 F LNCNT=0:1 S LN=$O(^PS(53.1,+PSGORD,12,LN)) Q:'LN  D
"RTN","PSJUTL",247,0)
 .S TXT=$G(^PS(53.1,+PSGORD,12,LN,0)) S ^PS(53.45,+PSJSYSP,$S($G(PSJTYP)="U":5,$G(PSJTYP)="V":6,1:5),LN,0)=TXT
"RTN","PSJUTL",248,0)
 I $G(LNCNT) N PSJFIREF S PSJFIREF="^PS(53.45,"_+PSJSYSP_","_$S($G(PSJTYP)="U":5,$G(PSJTYP)="V":6,1:5)_"," D ENSI(PSJFIREF)
"RTN","PSJUTL",249,0)
 I $G(LNCNT) S ^PS(53.45,+PSJSYSP,$S(($G(PSJTYP)="V"):6,1:5),0)="^^"_LNCNT_"^"_LNCNT
"RTN","PSJUTL",250,0)
 N DIE,DA
"RTN","PSJUTL",251,0)
 S SIMSG="Instructions too long. See Order View or BCMA for full text."
"RTN","PSJUTL",252,0)
 S PSJTMPTX="",PSJOVRMX=0 S TMPLIN=0 F  S TMPLIN=$O(^PS(53.45,+PSJSYSP,$S($G(PSJTYP)="V":6,1:5),TMPLIN)) Q:'TMPLIN!(PSJOVRMX)  D
"RTN","PSJUTL",253,0)
 .S:($L(PSJTMPTX)+$L($G(^PS(53.45,+PSJSYSP,$S($G(PSJTYP)="V":6,1:5),TMPLIN,0))))>$S($G(PSJTYP)["V":60,1:180) PSJOVRMX=1
"RTN","PSJUTL",254,0)
 .Q:$G(PSJOVRMX)  S PSJTMPTX=$G(PSJTMPTX)_$S($G(PSJTMPTX)]"":" ",1:"")_$G(^PS(53.45,+PSJSYSP,$S($G(PSJTYP)="V":6,1:5),TMPLIN,0))
"RTN","PSJUTL",255,0)
 S TXT=$S(PSJOVRMX:SIMSG,1:PSJTMPTX)
"RTN","PSJUTL",256,0)
 Q TXT
"RTN","PSJUTL",257,0)
 ;
"RTN","PSJUTL",258,0)
ENSI(PSJSIFIL) ; Expand comments using MEDICATIONS INSTRUCTIONS file (#51)
"RTN","PSJUTL",259,0)
 N X,PSJTMPFI,PSJTMPLI,DONE,PSJNWTXT,TOLIN,II,PSJSITXT,FULL,OLD,I S PSJTMPFI=PSJSIFIL_"1)" Q:'$D(@PSJTMPFI)
"RTN","PSJUTL",260,0)
 K ^TMP("PSGSIL",$J)
"RTN","PSJUTL",261,0)
 F I=1:1 Q:$G(DONE)  S PSJTMPFI=PSJSIFIL_I_",0)" S DONE=$D(@PSJTMPFI) S DONE=$S(DONE:0,1:1) D
"RTN","PSJUTL",262,0)
 .S PSJTMPLI=$G(@PSJTMPFI) I ($TR(PSJTMPLI," ")'="") D TXT^PSGMUTL($$ENSISET(PSJTMPLI),74)
"RTN","PSJUTL",263,0)
 .I ($TR(PSJTMPLI," ")="") S MARX(1)=PSJTMPLI
"RTN","PSJUTL",264,0)
 .S II="" F  S II=$O(MARX(II)) Q:'II  S TOLIN=+$O(^TMP("PSGSIL",$J,+$G(PSJSYSP),""),-1) D
"RTN","PSJUTL",265,0)
 ..S ^TMP("PSGSIL",$J,+$G(PSJSYSP),TOLIN+1)=MARX(II) Q
"RTN","PSJUTL",266,0)
 S I="" I $O(^TMP("PSGSIL",$J,+$G(PSJSYSP),0)) K ^PS(53.45,+$G(PSJSYSP),5) S TOLIN="" F I=0:1 S TOLIN=$O(^TMP("PSGSIL",$J,+$G(PSJSYSP),TOLIN)) Q:TOLIN=""  D
"RTN","PSJUTL",267,0)
 .S ^PS(53.45,+$G(PSJSYSP),5,TOLIN,0)=^TMP("PSGSIL",$J,+$G(PSJSYSP),TOLIN)
"RTN","PSJUTL",268,0)
 S I=$O(^PS(53.45,+$G(PSJSYSP),5,""),-1),^PS(53.45,+$G(PSJSYSP),5,0)="^55.6135^"_I_"^"_I_"^"_$P($G(PSGDT),".")
"RTN","PSJUTL",269,0)
 K ^TMP("PSGSIL",$J)
"RTN","PSJUTL",270,0)
 Q
"RTN","PSJUTL",271,0)
 ;
"RTN","PSJUTL",272,0)
ENSISET(X) ; expands the SPECIAL INSTRUCTIONS field contained in X into Y
"RTN","PSJUTL",273,0)
 N X1,X2,Y S Y=""
"RTN","PSJUTL",274,0)
 ;BHW;PSJ*5*185;Modified Logic below to NOT strip spaces and allow existing logic to flow.
"RTN","PSJUTL",275,0)
 ;             ;Removed code I X2]"" Before Set of Y and created argumentless DO structure.
"RTN","PSJUTL",276,0)
 F X1=1:1:$L(X," ") S X2=$P(X," ",X1) D
"RTN","PSJUTL",277,0)
 . I X2']"" S Y=Y_" " Q  ;if multiple spaces in text and were $P'ing through text, X2 will="" so just add space and continue
"RTN","PSJUTL",278,0)
 . S Y=Y_$S($L(X2)>30:X2,'$D(^PS(51,+$O(^PS(51,"B",X2,0)),0)):X2,$P(^(0),"^",2)]""&$P(^(0),"^",4):$P(^(0),"^",2),1:X2)_" "
"RTN","PSJUTL",279,0)
 . Q
"RTN","PSJUTL",280,0)
 ;BHW;Modified stripping of spaces at end of string
"RTN","PSJUTL",281,0)
 F X1=$L(Y):-1:0 Q:$E(Y,X1,X1)'=" "  S Y=$E(Y,1,X1-1)
"RTN","PSJUTL",282,0)
 Q Y
"VER")
8.0^22.2
"BLD",11005,6)
^305
**END**
**END**

