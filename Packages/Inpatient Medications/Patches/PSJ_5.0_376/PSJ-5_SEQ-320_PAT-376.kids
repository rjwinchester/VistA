Released PSJ*5*376 SEQ #320
Extracted from mail message
**KIDS**:PSJ*5.0*376^

**INSTALL NAME**
PSJ*5.0*376
"BLD",11220,0)
PSJ*5.0*376^INPATIENT MEDICATIONS^0^3180927^y
"BLD",11220,1,0)
^^3^3^3180927^
"BLD",11220,1,1,0)
This patch addresses one issue:
"BLD",11220,1,2,0)
 
"BLD",11220,1,3,0)
PADE Dispense Without Order VistA Mailman messages not being received
"BLD",11220,4,0)
^9.64PA^^
"BLD",11220,6.3)
4
"BLD",11220,"KRN",0)
^9.67PA^779.2^20
"BLD",11220,"KRN",.4,0)
.4
"BLD",11220,"KRN",.401,0)
.401
"BLD",11220,"KRN",.402,0)
.402
"BLD",11220,"KRN",.403,0)
.403
"BLD",11220,"KRN",.5,0)
.5
"BLD",11220,"KRN",.84,0)
.84
"BLD",11220,"KRN",3.6,0)
3.6
"BLD",11220,"KRN",3.8,0)
3.8
"BLD",11220,"KRN",9.2,0)
9.2
"BLD",11220,"KRN",9.8,0)
9.8
"BLD",11220,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",11220,"KRN",9.8,"NM",1,0)
PSJPAD70^^0^B196324037
"BLD",11220,"KRN",9.8,"NM","B","PSJPAD70",1)

"BLD",11220,"KRN",19,0)
19
"BLD",11220,"KRN",19.1,0)
19.1
"BLD",11220,"KRN",101,0)
101
"BLD",11220,"KRN",409.61,0)
409.61
"BLD",11220,"KRN",771,0)
771
"BLD",11220,"KRN",779.2,0)
779.2
"BLD",11220,"KRN",870,0)
870
"BLD",11220,"KRN",8989.51,0)
8989.51
"BLD",11220,"KRN",8989.52,0)
8989.52
"BLD",11220,"KRN",8994,0)
8994
"BLD",11220,"KRN","B",.4,.4)

"BLD",11220,"KRN","B",.401,.401)

"BLD",11220,"KRN","B",.402,.402)

"BLD",11220,"KRN","B",.403,.403)

"BLD",11220,"KRN","B",.5,.5)

"BLD",11220,"KRN","B",.84,.84)

"BLD",11220,"KRN","B",3.6,3.6)

"BLD",11220,"KRN","B",3.8,3.8)

"BLD",11220,"KRN","B",9.2,9.2)

"BLD",11220,"KRN","B",9.8,9.8)

"BLD",11220,"KRN","B",19,19)

"BLD",11220,"KRN","B",19.1,19.1)

"BLD",11220,"KRN","B",101,101)

"BLD",11220,"KRN","B",409.61,409.61)

"BLD",11220,"KRN","B",771,771)

"BLD",11220,"KRN","B",779.2,779.2)

"BLD",11220,"KRN","B",870,870)

"BLD",11220,"KRN","B",8989.51,8989.51)

"BLD",11220,"KRN","B",8989.52,8989.52)

"BLD",11220,"KRN","B",8994,8994)

"BLD",11220,"QDEF")
^^^^NO^^^^^^NO
"BLD",11220,"QUES",0)
^9.62^^
"BLD",11220,"REQB",0)
^9.611^1^1
"BLD",11220,"REQB",1,0)
PSJ*5.0*356^2
"BLD",11220,"REQB","B","PSJ*5.0*356",1)

"MBREQ")
0
"PKG",471,-1)
1^1
"PKG",471,0)
INPATIENT MEDICATIONS^PSJ^UNIT DOSE AND IVS
"PKG",471,20,0)
^9.402P^^
"PKG",471,22,0)
^9.49I^1^1
"PKG",471,22,1,0)
5.0^2971215^2990325^66481
"PKG",471,22,1,"PAH",1,0)
376^3180927
"PKG",471,22,1,"PAH",1,1,0)
^^3^3^3180927
"PKG",471,22,1,"PAH",1,1,1,0)
This patch addresses one issue:
"PKG",471,22,1,"PAH",1,1,2,0)
 
"PKG",471,22,1,"PAH",1,1,3,0)
PADE Dispense Without Order VistA Mailman messages not being received
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","PSJPAD70")
0^1^B196324037^B196235756
"RTN","PSJPAD70",1,0)
PSJPAD70 ;BIR/JCH - HL7 UTILITY FOR PADE INBOUND POCKET ACTIVITY ;01/06/16 1:34  PM
"RTN","PSJPAD70",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**317,356,376**;16 DEC 97;Build 4
"RTN","PSJPAD70",3,0)
 ;
"RTN","PSJPAD70",4,0)
 ; Reference to $$HLDATE^HLFNC is supported by DBIA 10106
"RTN","PSJPAD70",5,0)
 ; Reference to ^XMD is supported by DBIA 10070
"RTN","PSJPAD70",6,0)
 ; Reference to ^XLFDT is supported by DBIA# 10103.
"RTN","PSJPAD70",7,0)
 ;
"RTN","PSJPAD70",8,0)
 Q
"RTN","PSJPAD70",9,0)
 ;
"RTN","PSJPAD70",10,0)
DWO(PSJOMS) ; Send Dispensed Without Order (DWO) Alert
"RTN","PSJPAD70",11,0)
 N GROUPS
"RTN","PSJPAD70",12,0)
 S GROUPS=""
"RTN","PSJPAD70",13,0)
 Q:'$$ACTDWO(.PSJOMS)
"RTN","PSJPAD70",14,0)
 D GETGRPS(.PSJOMS,.GROUPS)
"RTN","PSJPAD70",15,0)
 D DWOSEND(.PSJOMS,.GROUPS)
"RTN","PSJPAD70",16,0)
 Q
"RTN","PSJPAD70",17,0)
 ;
"RTN","PSJPAD70",18,0)
ACTDWO(PSJOMS)  ; Check if dispensing device (cabinet) is active for DWO messages
"RTN","PSJPAD70",19,0)
 N CABNAME,CABIEN,RESULT,ERROR,PSJPSYS
"RTN","PSJPAD70",20,0)
 ; Get PADE Inbound System name
"RTN","PSJPAD70",21,0)
 S PSJPSYS=$G(PSJOMS("DISPSYS")) Q:(PSJPSYS="") 0
"RTN","PSJPAD70",22,0)
 S PSJPSYS=$$FIND1^DIC(58.601,"","",PSJPSYS) K DIERR Q:'PSJPSYS ""  ;*356
"RTN","PSJPAD70",23,0)
 ; Get Cabinet name
"RTN","PSJPAD70",24,0)
 S CABNAME=$G(PSJOMS("CABID")) Q:(CABNAME="") 0
"RTN","PSJPAD70",25,0)
 K DIERR S CABIEN=$$FIND1^DIC(58.63,"","",CABNAME) K DIERR Q:'CABIEN ""  ;*356
"RTN","PSJPAD70",26,0)
 ; Get value in SEND DWO MESSAGES field (#3) in PADE DISPENSING DEVICE file (#58.63)
"RTN","PSJPAD70",27,0)
 K DIERR D GETS^DIQ(58.63,CABIEN_",",3,"I","RESULT","ERROR") K DIERR  ;*356
"RTN","PSJPAD70",28,0)
 Q +$G(RESULT(58.63,CABIEN_",",3,"I"))
"RTN","PSJPAD70",29,0)
 ;
"RTN","PSJPAD70",30,0)
GETGRPS(PSJOMS,GROUPS)  ; Find Entity mail group in mail group variable pointer field
"RTN","PSJPAD70",31,0)
 ;                       DWO MAIL GROUP (#3) in the PADE INVENTORY SYSTEM file (58.601)
"RTN","PSJPAD70",32,0)
 ;
"RTN","PSJPAD70",33,0)
 ;  Input: PSJOMS("DISPSYS") = Inbound Dispensing System name.
"RTN","PSJPAD70",34,0)
 ;         PSJOMS("CABID")    = PADE cabinet name.
"RTN","PSJPAD70",35,0)
 ;
"RTN","PSJPAD70",36,0)
 ; Output: GROUPS(EntityPointer,Count)=MailGroupName
"RTN","PSJPAD70",37,0)
 ;
"RTN","PSJPAD70",38,0)
 ;  Dispensed Without Orders (DWO) mail groups may be associated with up to seven entities. 
"RTN","PSJPAD70",39,0)
 ;  Each entity is associated with a precedence level, creating a hierarchy such that only mail groups
"RTN","PSJPAD70",40,0)
 ;  associated with the entity(ies) with the highest precedence will receive a DWO message.
"RTN","PSJPAD70",41,0)
 ;  
"RTN","PSJPAD70",42,0)
 ;  If two entities have the same precedence, and both have DWO mail groups defined, both will receive
"RTN","PSJPAD70",43,0)
 ;  a DWO message. For example, if an incoming PADE inventory HL7 message is associated with a cabinet
"RTN","PSJPAD70",44,0)
 ;  that does not have a DWO mail group defined, but the cabinet is associated with a ward and a clinic,
"RTN","PSJPAD70",45,0)
 ;  each of which DOES have a DWO mail group defined, the DWO message will go the both the ward mail
"RTN","PSJPAD70",46,0)
 ;  group and the clinic mail group, because the ward and the clinic have the same precedence.
"RTN","PSJPAD70",47,0)
 ;
"RTN","PSJPAD70",48,0)
 ;  If none of the entities associated with an incoming PADE inventory HL7 message is associated with
"RTN","PSJPAD70",49,0)
 ;  a DWO mail group, no DWO message is sent.
"RTN","PSJPAD70",50,0)
 ;
"RTN","PSJPAD70",51,0)
 ; PADE DWO message entities, in  order of precedence
"RTN","PSJPAD70",52,0)
 ;   1)PADE CABINET : PADE DISPENSING DEVICE file (#58.63)
"RTN","PSJPAD70",53,0)
 ;   2)........WARD : WARD LOCATION file (#42)
"RTN","PSJPAD70",54,0)
 ;   ........CLINIC : HOSPITAL LOCATION file (#44)
"RTN","PSJPAD70",55,0)
 ;   3)..WARD GROUP : WARD GROUP file (#57.5)
"RTN","PSJPAD70",56,0)
 ;   ..CLINIC GROUP : CLINIC GROUP file (#57.8)
"RTN","PSJPAD70",57,0)
 ;   4).PADE SYSTEM : PADE INVENTORY SYSTEM file (#58.601)
"RTN","PSJPAD70",58,0)
 ;   ......DIVISION : DIVISION file (#40.8)
"RTN","PSJPAD70",59,0)
 ;    
"RTN","PSJPAD70",60,0)
 N PSJPSYS,PSJECNT,PSJMCT,PSJDWINS,PSJDWMG,PSJRSLT,PSJRSLT1,PSJDWENT,PRIO,TEMPGRP,PSJHI,NEXT
"RTN","PSJPAD70",61,0)
 K GROUPS N PSJCL,PSJCLGRP,PSJWRD,PSJWGRP,PSJCAB,PSJDIV,PSJFICHK,PSJENTYP
"RTN","PSJPAD70",62,0)
 ; Get PADE Inbound System pointer to file 58.601, store in "FICHK" node
"RTN","PSJPAD70",63,0)
 S PSJPSYS=$G(PSJOMS("DISPSYS")) Q:(PSJPSYS="") 0
"RTN","PSJPAD70",64,0)
 K DIERR S PSJPSYS=$$FIND1^DIC(58.601,"","",PSJPSYS) K DIERR Q:'PSJPSYS 0  ;*356
"RTN","PSJPAD70",65,0)
 S PSJPSYS("FICHK",PSJPSYS)=PSJOMS("DISPSYS")
"RTN","PSJPAD70",66,0)
 ; Get PADE Cabinet pointer to file 58.63, store in "FICHK" node
"RTN","PSJPAD70",67,0)
 K DIERR S PSJCAB=+$$FIND1^DIC(58.63,,,PSJOMS("CABID")),PSJCAB("FICHK",PSJCAB)=PSJOMS("CABID") K DIERR  ;*356
"RTN","PSJPAD70",68,0)
 K DIERR D GETS^DIQ(58.63,PSJCAB,2,"IE","PSJDIV") K DIERR  ;*356
"RTN","PSJPAD70",69,0)
 ; Get PADE device Division pointer to file 40.8, store in "FICHK" node
"RTN","PSJPAD70",70,0)
 S PSJDIV("FICHK",+$G(PSJDIV(58.63,PSJCAB_",",2,"I")))=$G(PSJDIV(58.63,PSJCAB_",",2,"E"))
"RTN","PSJPAD70",71,0)
 ; Get PADE device Clinic pointer to file 44, store in "FICHK" node
"RTN","PSJPAD70",72,0)
 D LIST^DIC(58.638,","_PSJCAB_",",".01IE","P",,,,,,,"PSJCL") N CL,CC S CC=0 F  S CC=$O(PSJCL("DILIST",CC)) Q:'CC  D
"RTN","PSJPAD70",73,0)
 .S CL=$P($G(PSJCL("DILIST",CC,0)),"^",3) I CL S PSJCL("FICHK",+CL)=$P(PSJCL("DILIST",CC,0),"^",2)
"RTN","PSJPAD70",74,0)
 K PSJCL("DILIST")
"RTN","PSJPAD70",75,0)
 ; Get PADE device Clinic Group pointer to file 57.8, store in "FICHK" node
"RTN","PSJPAD70",76,0)
 D LIST^DIC(58.637,","_PSJCAB_",",".01IE","P",,,,,,,"PSJCLGRP") N CG,CC S CC=0 F  S CC=$O(PSJCLGRP("DILIST",CC)) Q:'CC  D
"RTN","PSJPAD70",77,0)
 .S CG=$P($G(PSJCLGRP("DILIST",CC,0)),"^",3) I CG S PSJCLGRP("FICHK",+CG)=$P(PSJCLGRP("DILIST",CC,0),"^",2)
"RTN","PSJPAD70",78,0)
 K PSJCLGRP("DILIST")
"RTN","PSJPAD70",79,0)
 ; Get PADE device Ward pointer to file 42, store in "FICHK" node
"RTN","PSJPAD70",80,0)
 D LIST^DIC(58.636,","_PSJCAB_",",".01IE","P",,,,,,,"PSJWRD") N WD,WC S WC=0 F  S WC=$O(PSJWRD("DILIST",WC)) Q:'WC  D
"RTN","PSJPAD70",81,0)
 .S WD=$P($G(PSJWRD("DILIST",WC,0)),"^",3) I WD S PSJWRD("FICHK",+WD)=$P(PSJWRD("DILIST",WC,0),"^",2)
"RTN","PSJPAD70",82,0)
 K PSJWRD("DILIST")
"RTN","PSJPAD70",83,0)
 ; Get PADE Ward Group pointer to file 57.5, store in "FICHK" node
"RTN","PSJPAD70",84,0)
 D LIST^DIC(58.635,","_PSJCAB_",",".01IE","P",,,,,,,"PSJWGRP") N WG,WC S WC=0 F  S WC=$O(PSJWGRP("DILIST",WC)) Q:'WC  D
"RTN","PSJPAD70",85,0)
 .S WG=$P($G(PSJWGRP("DILIST",WC,0)),"^",3) I WG S PSJWGRP("FICHK",+WG)=$P(PSJWGRP("DILIST",WC,0),"^",2)
"RTN","PSJPAD70",86,0)
 K PSJWGRP("DILIST")
"RTN","PSJPAD70",87,0)
 ; Get list of DWO MESSAGE ENTITY values for PADE system in PSJRSLT
"RTN","PSJPAD70",88,0)
 D LIST^DIC(58.6014,","_+PSJPSYS_",",.01,"P",,,,,,,"PSJRSLT","PSJROOT")
"RTN","PSJPAD70",89,0)
 ;
"RTN","PSJPAD70",90,0)
 ; Go through each DWO MESSAGE ENTITY, determine if the entity applies to this cabinet/device
"RTN","PSJPAD70",91,0)
 ; by comparing each DWO MESSAGE ENTITY to the list of entities defined for the cabinet. 
"RTN","PSJPAD70",92,0)
 ;
"RTN","PSJPAD70",93,0)
 S PSJECNT=0 F  S PSJECNT=$O(PSJRSLT("DILIST",PSJECNT)) Q:'PSJECNT  D
"RTN","PSJPAD70",94,0)
 .; Find the source file pointed to by the variable pointer DWO MESSAGE ENTITY field (#4) in the PADE INVENTORY SYSTEM file (#58.601)
"RTN","PSJPAD70",95,0)
 .S PSJDWINS=+$G(PSJRSLT("DILIST",PSJECNT,0))
"RTN","PSJPAD70",96,0)
 .; Get list of mail groups associated with this entity
"RTN","PSJPAD70",97,0)
 .D LIST^DIC(58.60141,","_+PSJDWINS_","_+PSJPSYS_",",.01,"P",,,,,,,"PSJRSLT1")
"RTN","PSJPAD70",98,0)
 .S PSJDWENT=$G(^PS(58.601,PSJPSYS,2,PSJDWINS,0))
"RTN","PSJPAD70",99,0)
 .; Define priority for this entity
"RTN","PSJPAD70",100,0)
 .S PSJENTYP=$S(PSJDWENT["PS(58.63":"1^PSJCAB",PSJDWENT["DG(40.8":"4^PSJDIV",PSJDWENT["PS(58.601":"4^PSJPSYS",PSJDWENT["DIC(42":"2^PSJWRD",PSJDWENT["PS(57.8":"3^PSJCLGRP",PSJDWENT["PS(57.5":"3^PSJWGRP",PSJDWENT["SC(":"2^PSJCL",1:99)
"RTN","PSJPAD70",101,0)
 .S PRIO=+PSJENTYP ;S PRIO=$S((PSJDWENT[58.63):1,(PSJDWENT["DIC(42,")!(PSJDWENT["SC("):2,(PSJDWENT[57.5)!(PSJDWENT[57.8):3,(PSJDWENT[58.601)!(PSJDWENT[40.8):4,1:99)
"RTN","PSJPAD70",102,0)
 .; Quit if this DWO MESSAGE ENTITY from PADE INVENTORY SYSTEM (#58.601) is not applicable to this PADE DISPENSING DEVICE (#58.63)
"RTN","PSJPAD70",103,0)
 .S PSJFICHK=$P(PSJENTYP,"^",2)_"(""FICHK"","_+PSJDWENT_")" Q:'$D(@PSJFICHK)
"RTN","PSJPAD70",104,0)
 .; Go through mail groups, set into TMPGRP by priority
"RTN","PSJPAD70",105,0)
 .S PSJMCT=0 F  S PSJMCT=$O(PSJRSLT1("DILIST",PSJMCT)) Q:'PSJMCT  D
"RTN","PSJPAD70",106,0)
 ..S PSJDWMG=$G(PSJRSLT1("DILIST",PSJMCT,0)) Q:'PSJDWMG
"RTN","PSJPAD70",107,0)
 ..S NEXT=+$O(TEMPGRP(PRIO,PSJDWENT,999),-1)+1
"RTN","PSJPAD70",108,0)
 ..S TEMPGRP(PRIO,PSJDWENT,NEXT)=$P(PSJDWMG,"^",2)
"RTN","PSJPAD70",109,0)
 ;
"RTN","PSJPAD70",110,0)
 ; Move highest priority entity mail groups into GROUPS
"RTN","PSJPAD70",111,0)
 S PSJHI=$O(TEMPGRP("")) I PSJHI]"" M GROUPS=TEMPGRP(PSJHI)
"RTN","PSJPAD70",112,0)
 Q
"RTN","PSJPAD70",113,0)
 ;
"RTN","PSJPAD70",114,0)
DWOSEND(PSJOMS,GROUPS) ;This routine will generate a mailman message when an order is dispensed without an order, and a DWO mail group is defined
"RTN","PSJPAD70",115,0)
 ;
"RTN","PSJPAD70",116,0)
 ;Input:  PSJOMS - Array generated from incoming OMS^O05 HL7 PADE pocket activity message
"RTN","PSJPAD70",117,0)
 ;        GROUPS - VistA Mail Groups to send the DWO message
"RTN","PSJPAD70",118,0)
 ;
"RTN","PSJPAD70",119,0)
 N MSGTEXT,XMTEXT,XMSUB,XMY,XMZ,XMDUZ,MSGTYPE,MSHREC,ENTITY,MAILGRP
"RTN","PSJPAD70",120,0)
 N HLFS,HLCS,MTXTLN,MGCNT,DRGFILNM
"RTN","PSJPAD70",121,0)
 S DRGFILNM="" I $G(PSJOMS("DRGITM")) S:PSJOMS("DRGITM")=+PSJOMS("DRGITM") DRGFILNM=$P($G(^PSDRUG(PSJOMS("DRGITM"),0)),"^")
"RTN","PSJPAD70",122,0)
 I DRGFILNM="" S DRGFILNM=$G(PSJOMS("DRGTXT"))
"RTN","PSJPAD70",123,0)
 S:'$G(PSJOMS("PSJDT")) PSJOMS("PSJDT")=$P($$FMTHL7^XLFDT($$NOW^XLFDT()),"-")
"RTN","PSJPAD70",124,0)
 Q:'($G(PSJOMS("TTYPE"))["V")
"RTN","PSJPAD70",125,0)
 S MTXTLN=0
"RTN","PSJPAD70",126,0)
 S MSGTEXT(MTXTLN)=" ",MTXTLN=MTXTLN+1
"RTN","PSJPAD70",127,0)
 S MSGTEXT(MTXTLN)="A medication was dispensed from a PADE device without an order",MTXTLN=MTXTLN+1
"RTN","PSJPAD70",128,0)
 S MSGTEXT(MTXTLN)=" ",MTXTLN=MTXTLN+1
"RTN","PSJPAD70",129,0)
 S MSGTEXT(MTXTLN)="PADE Device:    "_$G(PSJOMS("CABID")),MTXTLN=MTXTLN+1
"RTN","PSJPAD70",130,0)
 S MSGTEXT(MTXTLN)="",MTXTLN=MTXTLN+1
"RTN","PSJPAD70",131,0)
 S MSGTEXT(MTXTLN)="Date:           "_$$FMTE^XLFDT($$FMDATE^HLFNC(PSJOMS("PSJDT"))),MTXTLN=MTXTLN+1
"RTN","PSJPAD70",132,0)
 S MSGTEXT(MTXTLN)="",MTXTLN=MTXTLN+1
"RTN","PSJPAD70",133,0)
 S MSGTEXT(MTXTLN)="Drug:           "_DRGFILNM,MTXTLN=MTXTLN+1
"RTN","PSJPAD70",134,0)
 S MSGTEXT(MTXTLN)="",MTXTLN=MTXTLN+1
"RTN","PSJPAD70",135,0)
 S MSGTEXT(MTXTLN)="Patient:        "_$G(PSJOMS("PTNAMA"))_","_$G(PSJOMS("PTNAMB"))_" "_$G(PSJOMS("PTNAMC")) D
"RTN","PSJPAD70",136,0)
 .S MSGTEXT(MTXTLN)=MSGTEXT(MTXTLN)_"  "_$S($G(PSJOMS("SSN")):" ("_$G(PSJOMS("SSN"))_")",$G(PSJOMS("PTID"))]"":"(Unknown ID: "_$G(PSJOMS("PTID"))_")",1:" ()"),MTXTLN=MTXTLN+1
"RTN","PSJPAD70",137,0)
 S MSGTEXT(MTXTLN)="",MTXTLN=MTXTLN+1
"RTN","PSJPAD70",138,0)
 S MSGTEXT(MTXTLN)="User:           "_$G(PSJOMS("NUR1B"))_$S($G(PSJOMS("NUR1C"))]"":","_PSJOMS("NUR1C"),1:"")_"  - ID: "_$G(PSJOMS("NUR1A")),MTXTLN=MTXTLN+1
"RTN","PSJPAD70",139,0)
 ; Send message to mail groups
"RTN","PSJPAD70",140,0)
 S XMSUB="PADE DWO:"_$G(PSJOMS("CABID"))_"-"_DRGFILNM
"RTN","PSJPAD70",141,0)
 S XMTEXT="MSGTEXT("
"RTN","PSJPAD70",142,0)
 I $D(GROUPS)>1 S ENTITY="" F  S ENTITY=$O(GROUPS(ENTITY)) Q:ENTITY=""  D
"RTN","PSJPAD70",143,0)
 .S MGCNT=0 F  S MGCNT=$O(GROUPS(ENTITY,MGCNT)) Q:'MGCNT  D
"RTN","PSJPAD70",144,0)
 ..S MAILGRP=GROUPS(ENTITY,MGCNT) Q:MAILGRP=""
"RTN","PSJPAD70",145,0)
 ..S XMY("G."_MAILGRP)=""
"RTN","PSJPAD70",146,0)
 I $D(XMY)<10 D GETPDMGR^PSJPAD7I(.XMY)
"RTN","PSJPAD70",147,0)
 Q:$D(XMY)<10
"RTN","PSJPAD70",148,0)
 S XMDUZ="PADE-SYSTEM"
"RTN","PSJPAD70",149,0)
 D ^XMD
"RTN","PSJPAD70",150,0)
 Q
"RTN","PSJPAD70",151,0)
 ;
"RTN","PSJPAD70",152,0)
UNLOAD(PSJPSYS,PADIEN,DRWIEN,DRGIEN,DRGDEV,PCKIEN) ; Unload (delete) a drug from pocket and drawer for device DEV and system SYS
"RTN","PSJPAD70",153,0)
 ; INPUT
"RTN","PSJPAD70",154,0)
 ;    PSJPSYS - Inventory System entry from file 58.601
"RTN","PSJPAD70",155,0)
 ;    PADIEN - Dispensing Device (#1) field (subfile 58.6011) from file 58.601
"RTN","PSJPAD70",156,0)
 ;    DRWIEN - Drawer (#2) field (subfile 58.60112) from dispensing device subfile (#58.60111) in file 58.601
"RTN","PSJPAD70",157,0)
 ;    DRGIEN - Drug (Drawer) (#1) field (subfile 58.601121) from drawer subfile (#58.60112) in file 58.61
"RTN","PSJPAD70",158,0)
 ;    DRGDEV - Drug (Device) (#2) field (subfile 58.60111) from dispensing device subfile (#58.6011) in file 58.601
"RTN","PSJPAD70",159,0)
 ;    PCKIEN - Pocket/Subdrawer (#2) field (subfile 58.601122) from drawer subfile (58.60112) in file 58.601
"RTN","PSJPAD70",160,0)
 ;
"RTN","PSJPAD70",161,0)
 N DIK,DA,PSERR
"RTN","PSJPAD70",162,0)
 ; If the unique location in the device, 
"RTN","PSJPAD70",163,0)
 I $G(PSJPSYS)&$G(PADIEN)&$G(DRWIEN) I $D(^PS(58.601,+PSJPSYS,"DEVICE",+PADIEN,"DRAWER",+DRWIEN)) D
"RTN","PSJPAD70",164,0)
 .S DIK="^PS(58.601,"_+PSJPSYS_",""DEVICE"","_+PADIEN_",""DRAWER"","_+DRWIEN_",""SUB"","
"RTN","PSJPAD70",165,0)
 .S DA(3)=+PSJPSYS,DA(2)=+PADIEN,DA(1)=DRWIEN,DA=PCKIEN D ^DIK
"RTN","PSJPAD70",166,0)
 .S DIK="^PS(58.601,"_+PSJPSYS_",""DEVICE"","_+PADIEN_",""DRAWER"","_+DRWIEN_",""DRUG"","
"RTN","PSJPAD70",167,0)
 .S DA(3)=+PSJPSYS,DA(2)=+PADIEN,DA(1)=DRWIEN,DA=DRGIEN D ^DIK
"RTN","PSJPAD70",168,0)
 ;
"RTN","PSJPAD70",169,0)
 ; Kill Drug (DEVICE) only if balance is less than 1
"RTN","PSJPAD70",170,0)
 N DA,DIK,DEVBAL
"RTN","PSJPAD70",171,0)
 S DEVBAL=$P($G(^PS(58.601,+$G(PSJPSYS),"DEVICE",+$G(PADIEN),"DRUG",+$G(DRGDEV),0)),"^",3)
"RTN","PSJPAD70",172,0)
 Q:DEVBAL>0                     ; Don't delete drug from device/cabinet/station if there it's stocked somewhere else
"RTN","PSJPAD70",173,0)
 S DIK="^PS(58.601,"_+PSJPSYS_",""DEVICE"","_+PADIEN_",""DRUG"","
"RTN","PSJPAD70",174,0)
 S DA(2)=+PSJPSYS,DA(1)=+PADIEN,DA=DRGDEV D ^DIK
"RTN","PSJPAD70",175,0)
 Q
"RTN","PSJPAD70",176,0)
 ;
"RTN","PSJPAD70",177,0)
MANUN(PADEV) ; Manually unload one drug at a time from PADE INVENTORY SYSTEM (#58.601) file for device PADEV pointer to DISPENSING DEVICE (#58.63) file
"RTN","PSJPAD70",178,0)
 ; Input : PADEV - Pointer to PADE DISPENSING DEVICE (#58.63) file
"RTN","PSJPAD70",179,0)
 ;
"RTN","PSJPAD70",180,0)
 N DIR,X,Y
"RTN","PSJPAD70",181,0)
 S DIR(0)="Y",DIR("A")="DELETE SINGLE DRUG FROM PADE CABINET"
"RTN","PSJPAD70",182,0)
 S DIR("?")="^D UNLHLP^PSJPAD70"
"RTN","PSJPAD70",183,0)
 S DIR("B")="N" D ^DIR
"RTN","PSJPAD70",184,0)
 Q:'Y
"RTN","PSJPAD70",185,0)
 ; User wants to go through with removing drug from device
"RTN","PSJPAD70",186,0)
 N PSJSTOP S PSJSTOP=0
"RTN","PSJPAD70",187,0)
 F  Q:$G(PSJSTOP)  D UNLDONE(PADEV)
"RTN","PSJPAD70",188,0)
 Q
"RTN","PSJPAD70",189,0)
 ;
"RTN","PSJPAD70",190,0)
UNLDONE(PADEV) ; Manually unload a drug from a pocket
"RTN","PSJPAD70",191,0)
 ; Input :  PADIEN = PADE Dispensing Device IEN (required)
"RTN","PSJPAD70",192,0)
 ;
"RTN","PSJPAD70",193,0)
 N PSJINP,PSDRG,PSJCSUB,SCHLST,PADIEN,DRWIEN,DRGIEN,DRGDEV,PCKIEN,DRWPCK,DRGDEV,PSJDRC,DRUG
"RTN","PSJPAD70",194,0)
 S PSJSTOP=0,DRWPCK="",DRWIEN="",DRGIEN="",PCKIEN=""
"RTN","PSJPAD70",195,0)
 Q:'$G(PADEV)  ; Quit if device IEN not passed in
"RTN","PSJPAD70",196,0)
 S PSJPSYS=$P($G(^PS(58.63,+PADEV,0)),"^",2)
"RTN","PSJPAD70",197,0)
 Q:'$G(PSJPSYS)  ; Quit if device not in inventory file 
"RTN","PSJPAD70",198,0)
 ; Get internal pointer to device from inventory file
"RTN","PSJPAD70",199,0)
 S PADIEN=$O(^PS(58.601,+PSJPSYS,"DEVICE","B",+PADEV,""))
"RTN","PSJPAD70",200,0)
 S PSJINP("PADEV",PADEV)="",PSJINP("PADEV")=PADEV
"RTN","PSJPAD70",201,0)
 S PSJINP("PSJPSYS")=PSJPSYS
"RTN","PSJPAD70",202,0)
 ; Find drugs stocked in device, all CS schedules
"RTN","PSJPAD70",203,0)
 S SCHLST="1:Schedule I;2:Schedule II;2n:Schedule II Non-Narcotics;3:Schedule III;3n:Schedule III Non-Narcotics;4:Schedule IV;5:Schedule V"
"RTN","PSJPAD70",204,0)
 S PSJCSUB="ALL" D ALLSCHED^PSJPDRIP(.PSJCSUB,SCHLST) S PSJCSUB="ALL" M PSJINP("PSJCSUB")=PSJCSUB
"RTN","PSJPAD70",205,0)
 S PSJINP("PSJCSUB",0)="Unscheduled"
"RTN","PSJPAD70",206,0)
 S PSJINP("MANUNLOD")=1
"RTN","PSJPAD70",207,0)
 D DRCAB^PSJPDRIN(.PSJINP,.PSJDRC)
"RTN","PSJPAD70",208,0)
 ; Prompt user to select drug
"RTN","PSJPAD70",209,0)
 D DRUGSEL^PSJPDRTR(.PSJINP,.PSJDRC,.DRUG,.DRWPCK,.PSJSTOP) ; Prompt for drug items
"RTN","PSJPAD70",210,0)
 I $G(DRWPCK)="" S PSJSTOP=1
"RTN","PSJPAD70",211,0)
 Q:$G(PSJSTOP)  ; nothing selected
"RTN","PSJPAD70",212,0)
 ; If ALL drugs selected, reset device and quit
"RTN","PSJPAD70",213,0)
 I DRWPCK="ALL" S PSJINP("PSDRG")="ALL" D ASKRESET^PSJPADPT(PADEV) Q
"RTN","PSJPAD70",214,0)
 N PCKSTR,SELCNT,PCKCNT,PSJSELY,PCKSEL,DIR
"RTN","PSJPAD70",215,0)
 S PCKSTR="",PCKCNT=0
"RTN","PSJPAD70",216,0)
 ; If specific drugs selected, find pockets containing drug, display for selection
"RTN","PSJPAD70",217,0)
 I DRWPCK'="ALL" S PSJINP("PSDRG")=DRWPCK D
"RTN","PSJPAD70",218,0)
 .N POCKET
"RTN","PSJPAD70",219,0)
 .S DRWIEN=0 F  S DRWIEN=$O(DRWPCK(DRWPCK,DRWIEN)) Q:'DRWIEN  D
"RTN","PSJPAD70",220,0)
 ..S POCKET=0 F  S POCKET=$O(DRWPCK(DRWPCK,DRWIEN,POCKET)) Q:'POCKET  D
"RTN","PSJPAD70",221,0)
 ...N PCKNAME,DRGDRW,SUBID
"RTN","PSJPAD70",222,0)
 ...S PCKNAME=$P($G(DRWPCK(DRWPCK,DRWIEN,POCKET)),"^")
"RTN","PSJPAD70",223,0)
 ...S DRGDRW=$P($G(DRWPCK(DRWPCK,DRWIEN,POCKET)),"^",2)
"RTN","PSJPAD70",224,0)
 ...S SUBID=$P($P($G(DRWPCK(DRWPCK,DRWIEN,POCKET)),"^",4),"~~") S:SUBID="" SUBID="-"
"RTN","PSJPAD70",225,0)
 ...S PCKSEL=PCKCNT+1_":"_PCKNAME
"RTN","PSJPAD70",226,0)
 ...S PCKSEL(PCKCNT+1)=DRWPCK_"^"_DRWIEN_"^"_POCKET_"^"_PCKNAME_"^"_DRGDRW_$S($L(SUBID):"^"_SUBID,1:"")
"RTN","PSJPAD70",227,0)
 ...I PCKCNT=0 S PCKSTR=PCKSEL,PCKCNT=PCKCNT+1 Q
"RTN","PSJPAD70",228,0)
 ...S PCKSTR=$G(PCKSTR)_";"_PCKSEL
"RTN","PSJPAD70",229,0)
 ...S PCKCNT=PCKCNT+1
"RTN","PSJPAD70",230,0)
 .Q:'PCKCNT
"RTN","PSJPAD70",231,0)
 .S DIR(0)="SA^"_PCKSTR,DIR("A")="Select Pocket: "
"RTN","PSJPAD70",232,0)
 .F SELCNT=1:1:$L(PCKSTR,";") Q:$P(PCKSTR,";",SELCNT)=""  D
"RTN","PSJPAD70",233,0)
 ..N SUBID S SUBID=$P($G(PCKSEL(SELCNT)),"^",6)
"RTN","PSJPAD70",234,0)
 ..S DIR("A",SELCNT)="   "_$P($P(PCKSTR,";",SELCNT),":")_"   - Drawer "_$P($P($P(PCKSTR,";",SELCNT),":",2),"_")_"  Pocket "_$P($P($P(PCKSTR,";",SELCNT),":",2),"_",2)_$S($L(SUBID):"  Subdrawer: "_SUBID,1:"")
"RTN","PSJPAD70",235,0)
 .D ^DIR I Y'>0 S PSJSTOP=1 Q
"RTN","PSJPAD70",236,0)
 .S PSJSELY=$G(PCKSEL(+Y))
"RTN","PSJPAD70",237,0)
 ; Get sub-file pointers to drawer and pocket selected by user
"RTN","PSJPAD70",238,0)
 Q:$G(PSJSTOP)
"RTN","PSJPAD70",239,0)
 S DRWIEN=$P($G(PSJSELY),"^",2)
"RTN","PSJPAD70",240,0)
 S PCKIEN=$P($G(PSJSELY),"^",3)
"RTN","PSJPAD70",241,0)
 S DRGDRW=$P($G(PSJSELY),"^",5)
"RTN","PSJPAD70",242,0)
 S DRGDEV=$G(DRWPCK(DRWPCK,"DRGDEV"))
"RTN","PSJPAD70",243,0)
 ; If the drug is not stocked in more than one pocket, set the device balance to zero so the UNLOAD removes it completely from device
"RTN","PSJPAD70",244,0)
 I '(PCKCNT>1) D
"RTN","PSJPAD70",245,0)
 .S DEVBAL=$P($G(^PS(58.601,+$G(PSJPSYS),"DEVICE",+$G(PADIEN),"DRUG",+$G(DRGDEV),0)),"^",3)
"RTN","PSJPAD70",246,0)
 .I DEVBAL S $P(^PS(58.601,+$G(PSJPSYS),"DEVICE",+$G(PADIEN),"DRUG",+$G(DRGDEV),0),"^",3)=0
"RTN","PSJPAD70",247,0)
 D UNLOAD(PSJPSYS,PADIEN,DRWIEN,DRGDRW,DRGDEV,PCKIEN)
"RTN","PSJPAD70",248,0)
 W "    ...Done."
"RTN","PSJPAD70",249,0)
 N DIR,X,Y S DIR(0)="Y"
"RTN","PSJPAD70",250,0)
 S DIR("A")="Delete another drug"
"RTN","PSJPAD70",251,0)
 D ^DIR
"RTN","PSJPAD70",252,0)
 I '$G(Y) S PSJSTOP=1
"RTN","PSJPAD70",253,0)
 Q
"RTN","PSJPAD70",254,0)
 ;
"RTN","PSJPAD70",255,0)
UNLHLP  ; Display help text explaining PADE manual unload
"RTN","PSJPAD70",256,0)
 N HELPAR
"RTN","PSJPAD70",257,0)
 S HELPAR(1)="This action removes one drug item from a specific pocket from this"
"RTN","PSJPAD70",258,0)
 S HELPAR(2)="PADE dispensing device in VistA. Manually deleting a drug item does"
"RTN","PSJPAD70",259,0)
 S HELPAR(3)="not affect the PADE vendor, and does not trigger any HL7 messages to"
"RTN","PSJPAD70",260,0)
 S HELPAR(4)="the PADE vendor system. Manually deleting a drug item reduces the"
"RTN","PSJPAD70",261,0)
 S HELPAR(5)="quantity of the drug that displays as available in VistA when running"
"RTN","PSJPAD70",262,0)
 S HELPAR(6)="the PADE INVENTORY REPORT, and also removes the drug from balances"
"RTN","PSJPAD70",263,0)
 S HELPAR(7)="displayed in Inpatient Order Entry."
"RTN","PSJPAD70",264,0)
 S HELPAR(8)="After a drug is deleted, the drug may be added back to the cabinet's"
"RTN","PSJPAD70",265,0)
 S HELPAR(9)="inventory as new HL7 messages are received from the vendor."
"RTN","PSJPAD70",266,0)
 D EN^DDIOL(.HELPAR)
"RTN","PSJPAD70",267,0)
 Q
"RTN","PSJPAD70",268,0)
 ;
"RTN","PSJPAD70",269,0)
OLDPKUP(TMPADATA,ERRMSG,PS586IEN)  ; Return 1 if data in TMPADATA indicates this pocket was updated more recently than the current transaction's date/time
"RTN","PSJPAD70",270,0)
 N POCKSUB  ;   POCKET_SUBDRAWER concatenated
"RTN","PSJPAD70",271,0)
 N PSPRVDT  ;   The last transaction date/time (date/time of the activity at the cabinet) this pocket was updated
"RTN","PSJPAD70",272,0)
 N PSPRVDIE  ;  The IEN of the last transaction date/time in the "PKUPDT" multiple
"RTN","PSJPAD70",273,0)
 N FDA,PSJPSYS,PSJSCR,PSJSCR
"RTN","PSJPAD70",274,0)
 ;
"RTN","PSJPAD70",275,0)
 K DIERR,ERR S TMPADATA("SYS IEN")=$$FIND1^DIC(58.601,"","MX",$G(TMPADATA(1)),,,"ERR") K DIERR  ;*356
"RTN","PSJPAD70",276,0)
 I '$G(TMPADATA("SYS IEN")) Q 0
"RTN","PSJPAD70",277,0)
 ; 
"RTN","PSJPAD70",278,0)
 I '($G(TMPADATA(2))]"") Q 0
"RTN","PSJPAD70",279,0)
 I $G(PSJPSYS),$G(^PS(58.601,+PSJPSYS,0))]"" S TMPADATA("SYS IEN")=PSJPSYS
"RTN","PSJPAD70",280,0)
 S PSJPSYS=TMPADATA("SYS IEN"),PSJSCR="I $S('$G(PSJPSYS):1,1:PSJPSYS=$P(^(0),U,2))"
"RTN","PSJPAD70",281,0)
 I ($G(TMPADATA(1))=""&$G(PSJPSYS)) S TMPADATA(1)=$P(^PS(58.601,PSJPSYS,0),"^")
"RTN","PSJPAD70",282,0)
 K ERR,DIERR S TMPADATA("DEVICE IEN")=$$FIND1^DIC(58.63,,"BX",TMPADATA(2),,PSJSCR,"ERR") K DIERR ;*356
"RTN","PSJPAD70",283,0)
 Q:'$G(TMPADATA("DEVICE IEN")) 0
"RTN","PSJPAD70",284,0)
 S TMPADATA("DEVICE IEN")=$O(^PS(58.601,+$G(TMPADATA("SYS IEN")),"DEVICE","B",TMPADATA("DEVICE IEN"),0))
"RTN","PSJPAD70",285,0)
 Q:'$G(TMPADATA("DEVICE IEN")) 0
"RTN","PSJPAD70",286,0)
 ;
"RTN","PSJPAD70",287,0)
 I $G(TMPADATA(3))="" S TMPADATA(3)="zz"
"RTN","PSJPAD70",288,0)
 S TMPADATA("DRAWER IEN")=$O(^PS(58.601,+$G(TMPADATA("SYS IEN")),"DEVICE",+$G(TMPADATA("DEVICE IEN")),"DRAWER","B",$G(TMPADATA(3)),0))
"RTN","PSJPAD70",289,0)
 I '$G(TMPADATA("DRAWER IEN")) Q 0
"RTN","PSJPAD70",290,0)
 ;
"RTN","PSJPAD70",291,0)
 N DRUG,DEVIEN,SYSIEN
"RTN","PSJPAD70",292,0)
 S DRUG=$G(TMPADATA(4))                          ; Drug
"RTN","PSJPAD70",293,0)
 S DEVIEN=$G(TMPADATA("DEVICE IEN"))             ; Dispensing Device IEN
"RTN","PSJPAD70",294,0)
 S SYSIEN=$G(TMPADATA("SYS IEN"))                ; PADE System IEN
"RTN","PSJPAD70",295,0)
 I '(DRUG]"") Q 0                                ; No drug, no go
"RTN","PSJPAD70",296,0)
 I '$D(^PSDRUG(DRUG,0)) Q 0                      ; No valid drug
"RTN","PSJPAD70",297,0)
 ; Must have PADE system and Dispensing Device
"RTN","PSJPAD70",298,0)
 I '$G(DEVIEN) Q 0
"RTN","PSJPAD70",299,0)
 I '$G(SYSIEN) Q 0
"RTN","PSJPAD70",300,0)
 ;
"RTN","PSJPAD70",301,0)
 N DA,FDA,X,Y,DIC,DIE,DR,D0,ERR,D,DD,DICR,DICRS,DO
"RTN","PSJPAD70",302,0)
 S TMPADATA("DRUG DEV IEN")=$$FIND1^DIC(58.60111,","_DEVIEN_","_SYSIEN_",","MXQ",DRUG,,,"ERR") K DIERR ;*356
"RTN","PSJPAD70",303,0)
 ;
"RTN","PSJPAD70",304,0)
 S TMPADATA(10)=$TR(TMPADATA(10),"~~")_"~~"_+$G(TMPADATA(4))   ; Append subdrawer unique drug IEN suffix to handle different drugs in same subdr-pocket combo
"RTN","PSJPAD70",305,0)
 S:$G(TMPADATA(10))="" TMPADATA(10)=$P($G(^PS(58.6,+$G(PS586IEN),0)),"^",12) S:TMPADATA(10)="" TMPADATA(10)="~~"_+$G(TMPADATA(4))
"RTN","PSJPAD70",306,0)
 S POCKSUB=$G(TMPADATA(7))_"_"_$G(TMPADATA(10))  ;  "POCKET_SUBDRAWER" storage location
"RTN","PSJPAD70",307,0)
 K ERR,DIERR S TMPADATA("POCK/SUB IEN")=$$FIND1^DIC(58.601122,","_TMPADATA("DRAWER IEN")_","_TMPADATA("DEVICE IEN")_","_TMPADATA("SYS IEN")_",","MX",POCKSUB,,,"ERR") K DIERR  ;*356
"RTN","PSJPAD70",308,0)
 ; Get the last date/time this drawer/subdrawer~drug/pocket was updated
"RTN","PSJPAD70",309,0)
 S PSPRVDIE=$O(^PS(58.601,+$G(TMPADATA("SYS IEN")),"DEVICE",+$G(TMPADATA("DEVICE IEN")),"DRAWER",+$G(TMPADATA("DRAWER IEN")),"PKUPDT","B",POCKSUB,""))
"RTN","PSJPAD70",310,0)
 ;
"RTN","PSJPAD70",311,0)
 S PSPRVDT=$P($G(^PS(58.601,+$G(TMPADATA("SYS IEN")),"DEVICE",+$G(TMPADATA("DEVICE IEN")),"DRAWER",+$G(TMPADATA("DRAWER IEN")),"PKUPDT",+$G(PSPRVDIE),0)),"^",2)
"RTN","PSJPAD70",312,0)
 ; If this current update contains a transaction date/time (i.e., activity date/time) older than the last update, don't update inventory
"RTN","PSJPAD70",313,0)
 I $G(PSPRVDT)&$G(TMPADATA(9)) I TMPADATA(9)<PSPRVDT D  Q 1
"RTN","PSJPAD70",314,0)
 .S ERRMSG="- OUTDATED TRANSACTION - "_$G(TMPADATA(1))_"."_$G(TMPADATA(2))_".DRUG="_$P($G(^PSDRUG(+$G(TMPADATA(4)),0)),"^")_"("_$G(TMPADATA(4))_").POCKET="_$G(TMPADATA(7))
"RTN","PSJPAD70",315,0)
 .S ERRMSG=ERRMSG_".LAST UPDATED="_PSPRVDT_".TRANS DT="_TMPADATA(9)
"RTN","PSJPAD70",316,0)
 Q 0
"VER")
8.0^22.2
"BLD",11220,6)
^320
**END**
**END**

