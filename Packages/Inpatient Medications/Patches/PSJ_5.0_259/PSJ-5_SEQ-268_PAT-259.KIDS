Released PSJ*5*259 SEQ #268
Extracted from mail message
**KIDS**:PSJ*5.0*259^

**INSTALL NAME**
PSJ*5.0*259
"BLD",9611,0)
PSJ*5.0*259^INPATIENT MEDICATIONS^0^3150108^y
"BLD",9611,1,0)
^^5^5^3140514^
"BLD",9611,1,1,0)
1)  When placing an IV order, under some circumstances the 
"BLD",9611,1,2,0)
    "Instructions" field will show the wrong dosage for additive, 
"BLD",9611,1,3,0)
    even though the "Additive" field shows the correct dosage.
"BLD",9611,1,4,0)
2)  A Pharmacist non-verified order was verified in CPRS by a Nurse
"BLD",9611,1,5,0)
    which caused the order to become active.
"BLD",9611,4,0)
^9.64PA^^
"BLD",9611,6.3)
21
"BLD",9611,"KRN",0)
^9.67PA^779.2^20
"BLD",9611,"KRN",.4,0)
.4
"BLD",9611,"KRN",.401,0)
.401
"BLD",9611,"KRN",.402,0)
.402
"BLD",9611,"KRN",.403,0)
.403
"BLD",9611,"KRN",.5,0)
.5
"BLD",9611,"KRN",.84,0)
.84
"BLD",9611,"KRN",3.6,0)
3.6
"BLD",9611,"KRN",3.8,0)
3.8
"BLD",9611,"KRN",9.2,0)
9.2
"BLD",9611,"KRN",9.8,0)
9.8
"BLD",9611,"KRN",9.8,"NM",0)
^9.68A^4^2
"BLD",9611,"KRN",9.8,"NM",3,0)
PSIVORFA^^0^B31628558
"BLD",9611,"KRN",9.8,"NM",4,0)
PSJHL5^^0^B31854476
"BLD",9611,"KRN",9.8,"NM","B","PSIVORFA",3)

"BLD",9611,"KRN",9.8,"NM","B","PSJHL5",4)

"BLD",9611,"KRN",19,0)
19
"BLD",9611,"KRN",19.1,0)
19.1
"BLD",9611,"KRN",101,0)
101
"BLD",9611,"KRN",409.61,0)
409.61
"BLD",9611,"KRN",771,0)
771
"BLD",9611,"KRN",779.2,0)
779.2
"BLD",9611,"KRN",870,0)
870
"BLD",9611,"KRN",8989.51,0)
8989.51
"BLD",9611,"KRN",8989.52,0)
8989.52
"BLD",9611,"KRN",8994,0)
8994
"BLD",9611,"KRN","B",.4,.4)

"BLD",9611,"KRN","B",.401,.401)

"BLD",9611,"KRN","B",.402,.402)

"BLD",9611,"KRN","B",.403,.403)

"BLD",9611,"KRN","B",.5,.5)

"BLD",9611,"KRN","B",.84,.84)

"BLD",9611,"KRN","B",3.6,3.6)

"BLD",9611,"KRN","B",3.8,3.8)

"BLD",9611,"KRN","B",9.2,9.2)

"BLD",9611,"KRN","B",9.8,9.8)

"BLD",9611,"KRN","B",19,19)

"BLD",9611,"KRN","B",19.1,19.1)

"BLD",9611,"KRN","B",101,101)

"BLD",9611,"KRN","B",409.61,409.61)

"BLD",9611,"KRN","B",771,771)

"BLD",9611,"KRN","B",779.2,779.2)

"BLD",9611,"KRN","B",870,870)

"BLD",9611,"KRN","B",8989.51,8989.51)

"BLD",9611,"KRN","B",8989.52,8989.52)

"BLD",9611,"KRN","B",8994,8994)

"BLD",9611,"QDEF")
^^^^NO^^^^^^NO
"BLD",9611,"QUES",0)
^9.62^^
"BLD",9611,"REQB",0)
^9.611^4^2
"BLD",9611,"REQB",3,0)
PSJ*5.0*181^2
"BLD",9611,"REQB",4,0)
PSJ*5.0*279^2
"BLD",9611,"REQB","B","PSJ*5.0*181",3)

"BLD",9611,"REQB","B","PSJ*5.0*279",4)

"MBREQ")
0
"PKG",471,-1)
1^1
"PKG",471,0)
INPATIENT MEDICATIONS^PSJ^UNIT DOSE AND IVS
"PKG",471,20,0)
^9.402P^^
"PKG",471,22,0)
^9.49I^1^1
"PKG",471,22,1,0)
5.0^2971215^2990325^66481
"PKG",471,22,1,"PAH",1,0)
259^3150108
"PKG",471,22,1,"PAH",1,1,0)
^^5^5^3150108
"PKG",471,22,1,"PAH",1,1,1,0)
1)  When placing an IV order, under some circumstances the 
"PKG",471,22,1,"PAH",1,1,2,0)
    "Instructions" field will show the wrong dosage for additive, 
"PKG",471,22,1,"PAH",1,1,3,0)
    even though the "Additive" field shows the correct dosage.
"PKG",471,22,1,"PAH",1,1,4,0)
2)  A Pharmacist non-verified order was verified in CPRS by a Nurse
"PKG",471,22,1,"PAH",1,1,5,0)
    which caused the order to become active.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
2
"RTN","PSIVORFA")
0^3^B31628558^B30883518
"RTN","PSIVORFA",1,0)
PSIVORFA ;BIR/MLM-FILE/RETRIEVE ORDERS IN 53.1 ; 8/17/09 9:23am
"RTN","PSIVORFA",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**4,7,18,28,50,71,58,91,80,110,111,134,225,267,275,279,259**;16 DEC 97;Build 21
"RTN","PSIVORFA",3,0)
 ;
"RTN","PSIVORFA",4,0)
 ; Reference to ^PS(51.1 supported by DBIA 2177.
"RTN","PSIVORFA",5,0)
 ; Reference to ^PS(51.2 supported by DBIA 2178.
"RTN","PSIVORFA",6,0)
 ; Reference to ^PS(52.7 supported by DBIA 2173.
"RTN","PSIVORFA",7,0)
 ; Reference to ^PS(52.6 supported by DBIA 1231.
"RTN","PSIVORFA",8,0)
 ;
"RTN","PSIVORFA",9,0)
GT531(DFN,ON,PSJAPI) ; Retrieve order data from 53.1 and place into local array
"RTN","PSIVORFA",10,0)
 ;
"RTN","PSIVORFA",11,0)
 ; PSJAPI - If being called from background job, PSJAPI=1.
"RTN","PSIVORFA",12,0)
 NEW PSGOES S PSGOES=1
"RTN","PSIVORFA",13,0)
 F X="CUM","LF","LFA","LF","PRNTON" S P(X)=""
"RTN","PSIVORFA",14,0)
 S Y=$G(^PS(53.1,+ON,0)),P(17)=$P(Y,U,9),P("LOG")=$P(Y,U,16),(P(21),P("21FLG"),PSJORIFN)=$P(Y,U,21)
"RTN","PSIVORFA",15,0)
 S P("RES")=$P(Y,U,24),P("OLDON")=$P(Y,U,25),P("NEWON")=$P(Y,U,26),P("FRES")=$P(Y,U,27)
"RTN","PSIVORFA",16,0)
 S P("MR")=$P(Y,U,3),P(6)=+$P(Y,U,2),Y=$G(^VA(200,+P(6),0)),$P(P(6),U,2)=$P(Y,U),Y=$G(^PS(51.2,+P("MR"),0)),$P(P("MR"),U,2)=$S($P(Y,U,3)]"":$P(Y,U,3),1:$P(Y,U))
"RTN","PSIVORFA",17,0)
 S Y=$G(^PS(53.1,+ON,.2)),P("PD")=$S(+Y:$P(Y,U)_U_$$OIDF^PSJLMUT1(+Y),1:""),P("DO")=$P(Y,U,2),P("NAT")=$P(Y,U,3),P("PRY")=$P(Y,U,4),(PSJCOM,P("PRNTON"))=$P(Y,U,8)
"RTN","PSIVORFA",18,0)
 S P("INS")=$G(^PS(53.1,+ON,.3))
"RTN","PSIVORFA",19,0)
 I $G(^PS(53.1,+ON,4))]"" S P("NINIT")=$P(^(4),U),P("NINITDT")=$P(^(4),U,2)
"RTN","PSIVORFA",20,0)
 NEW NAME S NAME=""
"RTN","PSIVORFA",21,0)
 I $D(^PS(53.1,+ON,1,1)) D DD^PSJLMUT1("^PS(53.1,+ON,",.NAME)
"RTN","PSIVORFA",22,0)
 S:$P(^PS(53.1,+ON,0),U,4)="U" P("INS")=P("INS")_$S(P("INS")]"":" of ",1:"")_NAME  ;Only display instructions for unit dose orders
"RTN","PSIVORFA",23,0)
 S P("APPT")=$G(^PS(53.1,+ON,"DSS")),P("CLIN")=$P(P("APPT"),"^"),P("APPT")=$P(P("APPT"),"^",2)
"RTN","PSIVORFA",24,0)
 S Y=$G(^PS(53.1,+ON,2)),P(9)=$P(Y,U),P(11)=$P(Y,U,5),P(15)=$S($P(Y,U,6)'="":$P(Y,U,6),$G(PSGS0XT)'="":PSGS0XT,$P($G(ZZND),"^",3)'="":$P(ZZND,"^",3),1:""),P(2)=$P(Y,U,2),P(3)=$P(Y,U,4)
"RTN","PSIVORFA",25,0)
 S Y=$G(^PS(53.1,+ON,4)),P("CLRK")=$P(Y,U,7)_U_$P($G(^VA(200,+$P(Y,U,7),0)),U),P("REN")=$P(Y,U,9),X=P(9)
"RTN","PSIVORFA",26,0)
 I $P($G(^PS(53.1,+ON,0)),U,7)="P",(P(9)'["PRN") S P(9)=P(9)_" PRN"
"RTN","PSIVORFA",27,0)
 K PSGST,XT
"RTN","PSIVORFA",28,0)
 ;PSJ*5*225 remove 1440 default
"RTN","PSIVORFA",29,0)
 I P(9)]"",P(9)'["PRN",(P(11)="") D  S P(15)=$S($G(XT)]""&'+$G(XT):XT,+$G(XT)>0:XT,$G(PSGS0XT):PSGS0XT,1:1440),P(11)=Y
"RTN","PSIVORFA",30,0)
 . I $O(^PS(51.1,"APPSJ",P(9),0)) D DIC^PSGORS0 Q
"RTN","PSIVORFA",31,0)
 . I '$O(^PS(51.1,"APPSJ",P(9),0)) N NOECH,PSGSCH S NOECH=1 D EN^PSIVSP
"RTN","PSIVORFA",32,0)
 S Y=$G(^PS(53.1,+ON,8)),P(4)=$P(Y,U),P(23)=$P(Y,U,2),P("SYRS")=$P(Y,U,3),P(5)=$P(Y,U,4),P(8)=$P(Y,U,5),P(7)=$P(Y,U,7),P("IVRM")=$P(Y,U,8)
"RTN","PSIVORFA",33,0)
 I ($G(^PS(53.1,+ON,17))?1.N) S P("NUMLBL")=$G(^(17))
"RTN","PSIVORFA",34,0)
 I '$G(P("NUMLBL")) S P("NUMLBL")=$P($G(P(8)),"@",2)
"RTN","PSIVORFA",35,0)
 N PSJABBIN S PSJABBIN=$P(P(8),"@") I PSJABBIN]"" D
"RTN","PSIVORFA",36,0)
 .Q:(P(8)?1"INFUSE OVER "1.N1" MINUTES")
"RTN","PSIVORFA",37,0)
 .D EXPINF^PSIVEDT1(.PSJABBIN,1) S P(8)=PSJABBIN_$S($G(P("NUMLBL"))?1.N:"@"_P("NUMLBL"),1:"")
"RTN","PSIVORFA",38,0)
 S P(4)=$S(P(4)'="":P(4),$G(PSIVTYPE):PSIVTYPE,1:"")
"RTN","PSIVORFA",39,0)
 S:'P("IVRM")&($D(PSIVSN)) P("IVRM")=+PSIVSN S Y=$G(^PS(59.5,+P("IVRM"),0)),$P(P("IVRM"),U,2)=$P(Y,U),Y=$G(^PS(53.1,+ON,9)),P("REM")=$P(Y,U),P("OPI")=$P(Y,U,2,3)
"RTN","PSIVORFA",40,0)
 S P("DTYP")=$S(P(4)="":0,P(4)="P"!(P(23)="P")!(P(5)):1,P(4)="H":2,1:3)
"RTN","PSIVORFA",41,0)
 S P("PACT")=$G(^PS(53.1,+ON,"A",1,0))
"RTN","PSIVORFA",42,0)
 D GTDRG,GTOT^PSIVUTL(P(4)) D:'$D(PSJLABEL) GTPC(ON)
"RTN","PSIVORFA",43,0)
 N ND2P5 S ND2P5=$G(^PS(53.1,+ON,2.5)) D
"RTN","PSIVORFA",44,0)
 .S P("DUR")=$P(ND2P5,"^",2)
"RTN","PSIVORFA",45,0)
 .S P("LIMIT")=$P(ND2P5,"^",4)
"RTN","PSIVORFA",46,0)
 .S P("IVCAT")=$P(ND2P5,"^",5)
"RTN","PSIVORFA",47,0)
 N LONGOPI S LONGOPI=$$GETOPI^PSJBCMA5(DFN,ON,$S($G(PSJAPI):1,1:""))
"RTN","PSIVORFA",48,0)
 Q
"RTN","PSIVORFA",49,0)
GTDRG ;
"RTN","PSIVORFA",50,0)
 K DRG F X="AD","SOL" S FIL=$S(X="AD":52.6,1:52.7) F Y=0:0 S Y=$O(^PS(53.1,+ON,X,Y)) Q:'Y  D
"RTN","PSIVORFA",51,0)
 .S (DRGI,DRG(X,0))=$G(DRG(X,0))+1,DRG=$G(^PS(53.1,+ON,X,Y,0)),ND=$G(^PS(FIL,+DRG,0)),DRGN=$P(ND,U),DRG(X,+DRGI)=+DRG_U_$P(ND,U)_U_$P(DRG,U,2)_U_$P(DRG,U,3)_U_$P(ND,U,13)_U_$P(ND,U,11)
"RTN","PSIVORFA",52,0)
 Q
"RTN","PSIVORFA",53,0)
 ;
"RTN","PSIVORFA",54,0)
GTPC(ON) ; Retrieve Provider Comments and create "scratch" fields to edit
"RTN","PSIVORFA",55,0)
 Q
"RTN","PSIVORFA",56,0)
 ;
"RTN","PSIVORFA",57,0)
PUT531 ; Move data in local variables to 53.1
"RTN","PSIVORFA",58,0)
 S:'$D(P(9)) P(9)=$G(PSGSCH)
"RTN","PSIVORFA",59,0)
 S ND(0)=+ON_U_+P(6)_U_$S(+P("MR"):+P("MR"),1:"")_U_$P(P("OT"),U)_U_U_U_"C",$P(ND(0),U,9)=P(17),$P(ND(0),U,21)=$G(P(21))
"RTN","PSIVORFA",60,0)
 S $P(ND(0),U,14,16)=P("LOG")_U_DFN_U_P("LOG"),$P(ND(0),U,24,26)=$G(P("RES"))_U_$G(P("OLDON"))_U_$G(P("NEWON"))
"RTN","PSIVORFA",61,0)
 S ND(2)=P(9)_U_P(2)_U_U_P(3)_U_P(11)_U_$S($G(P(15))'="":P(15),$G(PSGS0XT)'="":PSGS0XT,$P($G(ZZND),"^",3)'="":$P(ZZND,"^",3),1:""),$P(ND(4),U,7,9)=+P("CLRK")_U_U_P("REN")
"RTN","PSIVORFA",62,0)
 S ND(8)=P(4)_U_P(23)_U_P("SYRS")_U_P(5)_U_P(8)_"^^"_P(7)_"^"_+P("IVRM"),ND(9)=$S($L(P("REM")_P("OPI")):P("REM")_U_P("OPI"),1:"") S $P(ND(4),U,1,2)=$G(P("NINIT"))_U_$G(P("NINITDT"))
"RTN","PSIVORFA",63,0)
 S:+$G(P("CLIN")) $P(^PS(53.1,+ON,"DSS"),"^")=P("CLIN")
"RTN","PSIVORFA",64,0)
 S:+$G(P("APPT")) $P(^PS(53.1,+ON,"DSS"),"^",2)=P("APPT")
"RTN","PSIVORFA",65,0)
 S:$G(P("LIMIT"))]"" $P(^PS(53.1,+ON,2.5),"^",4)=P("LIMIT")
"RTN","PSIVORFA",66,0)
 I $G(PSJORD)["V"!($G(PSJORD)["P") I $G(^PS(53.1,+ON,2.5))="" N DUR S DUR=$$GETDUR^PSJLIVMD(DFN,+PSJORD,$S((PSJORD["P"):"P",1:"IV"),1) I DUR]"" D
"RTN","PSIVORFA",67,0)
 .I $G(IVLIMIT) S $P(^PS(53.1,+ON,2.5),"^",4)=DUR K IVLIMIT Q
"RTN","PSIVORFA",68,0)
 .S $P(^PS(53.1,+ON,2.5),"^",2)=DUR
"RTN","PSIVORFA",69,0)
 F X=0,2,4,8,9 S ^PS(53.1,+ON,X)=ND(X)
"RTN","PSIVORFA",70,0)
 I $G(P("NUMLBL"))?1.N!($G(P("NUMLBL"))="") S $P(^PS(53.1,+ON,17),"^")=$G(P("NUMLBL"))
"RTN","PSIVORFA",71,0)
 S PSIVCAT=$$IVCAT^PSJHLU(DFN,ON,.P) S:PSIVCAT]"" $P(^PS(53.1,+ON,2.5),"^",5)=PSIVCAT K PSIVCAT
"RTN","PSIVORFA",72,0)
 S:'+$G(^PS(53.1,+ON,.2)) $P(^(.2),U,1,3)=+P("PD")_U_P("DO")_U_$G(P("NAT"))
"RTN","PSIVORFA",73,0)
 F DRGT="AD","SOL" D:$D(DRG(DRGT)) PTD531
"RTN","PSIVORFA",74,0)
 K DA,DIK S PSGS0Y=P(11),PSGS0XT=P(15),DA=+ON,DIK="^PS(53.1," D IX^DIK K DA,DIK,PSGS0Y,PSGS0XT,ND,^PS(53.1,"AS","P",DFN,+ON)
"RTN","PSIVORFA",75,0)
 K:P(17)="A" ^PS(53.1,"AS","N",DFN,+ON)
"RTN","PSIVORFA",76,0)
 S:P(15)="D" $P(^PS(53.1,+ON,2),U,6)="D"
"RTN","PSIVORFA",77,0)
 I $G(PSJINFIN) K PSJINFIN I $D(^PS(53.45,+$G(PSJSYSP),6)),'$D(^PS(53.1,+ON,"A")),'$D(^PS(53.1,+ON,16)) S PSJINFIN=2
"RTN","PSIVORFA",78,0)
 I $G(PSJSYSP) D
"RTN","PSIVORFA",79,0)
 .I '$D(^PS(53.45,+PSJSYSP,6)) I $G(PSJORD)["V"!($G(PSJORD)["P") I '$D(^PS(53.1,+ON,16)) N I S I=$$GETOPI^PSJBCMA5(DFN,PSJORD)
"RTN","PSIVORFA",80,0)
 .I $D(^PS(53.45,+PSJSYSP,6)) D FILEOPI^PSJBCMA5(DFN,ON)
"RTN","PSIVORFA",81,0)
 Q
"RTN","PSIVORFA",82,0)
 ;
"RTN","PSIVORFA",83,0)
UPD100 ; Update order data in file 100
"RTN","PSIVORFA",84,0)
 D:'$D(PSJIVORF) ORPARM^PSIVOREN Q:'PSJIVORF
"RTN","PSIVORFA",85,0)
 S PSJORL=$$ENORL^PSJUTL($G(VAIN(4))) D SET^PSIVORFE
"RTN","PSIVORFA",86,0)
 Q
"RTN","PSIVORFA",87,0)
 ;
"RTN","PSIVORFA",88,0)
PTD531 ; Move drug data from local array into 53.1
"RTN","PSIVORFA",89,0)
 K ^PS(53.1,+ON,DRGT) S ^PS(53.1,+ON,DRGT,0)=$S(DRGT="AD":"^53.157^0^0",1:"^53.158^0^0")
"RTN","PSIVORFA",90,0)
 F X=0:0 S X=$O(DRG(DRGT,X)) Q:'X  D
"RTN","PSIVORFA",91,0)
 .S X1=$P(DRG(DRGT,X),U),Y=^PS(53.1,+ON,DRGT,0),$P(Y,U,3)=$P(Y,U,3)+1,DRG=$P(Y,U,3),$P(Y,U,4)=$P(Y,U,4)+1
"RTN","PSIVORFA",92,0)
 .S ^PS(53.1,+ON,DRGT,0)=Y,Y=+X1_U_$P(DRG(DRGT,X),U,3) S:DRGT="AD" $P(Y,U,3)=$P(DRG(DRGT,X),U,4) S ^PS(53.1,+ON,DRGT,+DRG,0)=Y
"RTN","PSIVORFA",93,0)
 Q
"RTN","PSJHL5")
0^4^B31854476^B32301721
"RTN","PSJHL5",1,0)
PSJHL5 ;BIR/LDT-ACTIONS ON HL7 MESSAGES FROM OE/RR ;28 Jan 98 / 3:34 PM
"RTN","PSJHL5",2,0)
 ;;5.0;INPATIENT MEDICATIONS ;**1,28,39,40,42,84,85,95,80,173,134,181,259**;16 DEC 97;Build 21
"RTN","PSJHL5",3,0)
 ;
"RTN","PSJHL5",4,0)
 ; Reference to ^PS(55 is supported by DBIA# 2191.
"RTN","PSJHL5",5,0)
 ; Reference to EN^ORERR is supported by DBIA# 2187.
"RTN","PSJHL5",6,0)
 ; Reference to NURV^ALPBCBU is supported by DBIA# 4120.
"RTN","PSJHL5",7,0)
 ; Reference to UNESC^ORHLESC is supported by DBIA# 4922
"RTN","PSJHL5",8,0)
 ;
"RTN","PSJHL5",9,0)
ASSIGN ; number assigned, update ORDERS FILE ENTRY
"RTN","PSJHL5",10,0)
 S RXORDER=RXORDER_"0)"
"RTN","PSJHL5",11,0)
 I '$P($G(@RXORDER),U) S ORDCON="Invalid Pharmacy order number/Number Assign Msg" S X="ORERR" X ^%ZOSF("TEST") I  D EN^ORERR(ORDCON,.PSJMSG) Q
"RTN","PSJHL5",12,0)
 Q:'$P($G(@RXORDER),U)
"RTN","PSJHL5",13,0)
 I RXON["P",PSJHLDFN'=$P($G(@(RXORDER)),U,15) S ORDCON="Patient does not match/Number Assign Msg" S X="ORERR" X ^%ZOSF("TEST") I  D EN^ORERR(ORDCON,.PSJMSG) Q
"RTN","PSJHL5",14,0)
 I RXON["P",PSJHLDFN'=$P($G(@(RXORDER)),U,15) Q
"RTN","PSJHL5",15,0)
 S $P(@RXORDER,"^",21)=PSJORDER
"RTN","PSJHL5",16,0)
 Q
"RTN","PSJHL5",17,0)
 ;
"RTN","PSJHL5",18,0)
NURSEACK ;Nurse Acknowledgement of Pending Orders
"RTN","PSJHL5",19,0)
 I '$P($G(@(RXORDER_"0)")),U) S ORDCON="Invalid Pharmacy order number/Nurse Acknowledgement Msg" S X="ORERR" X ^%ZOSF("TEST") I  D EN^ORERR(ORDCON,.PSJMSG) Q
"RTN","PSJHL5",20,0)
 Q:'$P($G(@(RXORDER_"0)")),U)
"RTN","PSJHL5",21,0)
 I RXON["P",PSJHLDFN'=$P($G(@(RXORDER_"0)")),U,15) S ORDCON="Patient does not match/Nurse Acknowledgement Msg" S X="ORERR" X ^%ZOSF("TEST") I  D EN^ORERR(ORDCON,.PSJMSG) Q
"RTN","PSJHL5",22,0)
 I RXON["P",PSJHLDFN'=$P($G(@(RXORDER_"0)")),U,15) Q
"RTN","PSJHL5",23,0)
 ;I RXON["P" N STATUS S STATUS=$P($G(@(RXORDER_"0)")),U,9) D:STATUS="N" EN^PSJHLV(PSJHLDFN,RXON)
"RTN","PSJHL5",24,0)
 I RXON["P" N STATUS S STATUS=$P($G(@(RXORDER_"0)")),U,9) Q:STATUS="A"
"RTN","PSJHL5",25,0)
 N DIE,DA
"RTN","PSJHL5",26,0)
 S DIE=$S(RXON["N"!(RXON["P"):"^PS(53.1,",RXON["V":"^PS(55,"_PSJHLDFN_",""IV"",",1:"^PS(55,"_PSJHLDFN_",5,"),DA=+RXON,DA(1)=PSJHLDFN
"RTN","PSJHL5",27,0)
 S DR="16////"_NURSEACK_";17////"_ACKDATE S:RXON["U" DR=DR_";51////1" S:RXON["V" DR=DR_";143////1",PSIVACT=""
"RTN","PSJHL5",28,0)
 I RXON["U" D NEWUDAL^PSGAL5(PSJHLDFN,RXON,22010)
"RTN","PSJHL5",29,0)
 I RXON["P" D NEWNVAL^PSGAL5(RXON,22010)
"RTN","PSJHL5",30,0)
 S PSGNVF=1 D ^DIE
"RTN","PSJHL5",31,0)
 I RXON["V" NEW ON55,DFN,PSIVAL,PSIVREA,PSIVLN K PSIVACT D
"RTN","PSJHL5",32,0)
 . S ON55=RXON,DFN=PSJHLDFN,PSIVAL="ORDER VERIFIED BY NURSE",PSIVALT="",PSIVREA="V"
"RTN","PSJHL5",33,0)
 . D LOG^PSIVORAL
"RTN","PSJHL5",34,0)
 D:RXON["P" EN^PSJLOI(PSJHLDFN,RXON) D:RXON["U" EN2^PSJLOI(PSJHLDFN,RXON)
"RTN","PSJHL5",35,0)
 K:RXON["U" ^PS(55,"ANV",PSJHLDFN,+RXON)
"RTN","PSJHL5",36,0)
 I $T(NURV^ALPBCBU)'="" D NURV^ALPBCBU(PSJHLDFN,RXON)
"RTN","PSJHL5",37,0)
 Q
"RTN","PSJHL5",38,0)
 ;
"RTN","PSJHL5",39,0)
EDIT ;Edit orders thru OE/RR
"RTN","PSJHL5",40,0)
 N DA,DR,DIE,PREORDER,STPDT,PSIVACT,PSIVALT,ON55,PSIVREA,PSIVALCK,P,PSJFLD1,PSJFLD2,PSJFLD3
"RTN","PSJHL5",41,0)
 S PREORDER=$S((PREON["N")!(PREON["P"):"^PS(53.1,"_+PREON_",2)",PREON["V":"^PS(55,"_PSJHLDFN_",""IV"","_+PREON_",0)",1:"^PS(55,"_PSJHLDFN_",5,"_+PREON_",2)")
"RTN","PSJHL5",42,0)
 S STPDT=$S(PREON["V":$P($G(@PREORDER),"^",3),1:$P($G(@PREORDER),"^",4))
"RTN","PSJHL5",43,0)
 D NOW^%DTC
"RTN","PSJHL5",44,0)
 S DIE=$S(PREON["N"!(PREON["P"):"^PS(53.1,",PREON["V":"^PS(55,"_PSJHLDFN_",""IV"",",1:"^PS(55,"_PSJHLDFN_",5,"),DA=+PREON,DA(1)=+PSJHLDFN
"RTN","PSJHL5",45,0)
 S PSJFLD1="100////D;157////DF;116////^S X=STPDT;123////E;114////"_PSJORDER_";.03////"_%
"RTN","PSJHL5",46,0)
 S PSJFLD2="25////"_%_";28////DE;107////E;105////"_PSJORDER_";32////"_STPDT
"RTN","PSJHL5",47,0)
 S PSJFLD3="25////"_STPDT_";28////DE;136////DF;107////E;105////"_PSJORDER_";34////"_%
"RTN","PSJHL5",48,0)
 S DR=$S(PREON["V":PSJFLD1,((PREON["P")!(PREON["N")):PSJFLD2,1:PSJFLD3)
"RTN","PSJHL5",49,0)
 I PREON["U"!(PREON["A") S PSGAL("C")=4100 D ^PSGAL5
"RTN","PSJHL5",50,0)
 I PREON["V" S PSIVACT=1,PSIVALT=2,ON55=PREON,PSIVREA="D",PSIVALCK="STOP",P(3)=STPDT
"RTN","PSJHL5",51,0)
 D ^DIE,AUE^PSJHL6(PSJHLDFN,PREON)
"RTN","PSJHL5",52,0)
 I PREON["V" N DFN S DFN=PSJHLDFN D LOG^PSIVORAL
"RTN","PSJHL5",53,0)
 S PSJHLMTN="ORM",PSOC=$S((PREON["N")!(PREON["P"):"OC",1:"OD") D EN1^PSJHL2(PSJHLDFN,PSOC,PREON) S PSJHLMTN="ORR",PSOC="XO"
"RTN","PSJHL5",54,0)
 Q
"RTN","PSJHL5",55,0)
 ;
"RTN","PSJHL5",56,0)
EDITCK ;Check to see if PSJHLDFN passed matches PSJHLDFN in pending order.
"RTN","PSJHL5",57,0)
 I (PREON["N")!(PREON["P"),PSJHLDFN'=$P($G(^PS(53.1,+PREON,0)),U,15) D
"RTN","PSJHL5",58,0)
 . S ORDCON="Patient does not match/Edit Msg" S X="ORERR" X ^%ZOSF("TEST") I  D EN^ORERR(ORDCON,.PSJMSG)
"RTN","PSJHL5",59,0)
 . D EN1^PSJHLERR(PSJHLDFN,"UX",$P(ORDER,"^"),ORDCON) S QFLG=1
"RTN","PSJHL5",60,0)
 Q
"RTN","PSJHL5",61,0)
 ;        
"RTN","PSJHL5",62,0)
STATUS ;Check status of an order in response to a send order status request from CPRS.
"RTN","PSJHL5",63,0)
 N STATUS,STPDT,NODE,NODE2
"RTN","PSJHL5",64,0)
 S NODE=$G(@(RXORDER_"0)")),NODE2=$G(@(RXORDER_"2)"))
"RTN","PSJHL5",65,0)
 I 'NODE S PSREASON="Invalid Pharmacy order number" D  Q
"RTN","PSJHL5",66,0)
 .S X="ORERR" X ^%ZOSF("TEST") I  D EN^ORERR(PSREASON_"/Status Check",.PSJMSG)
"RTN","PSJHL5",67,0)
 .D EN1^PSJHLERR(PSJHLDFN,"DE",$P(ORDER,U),PSREASON)
"RTN","PSJHL5",68,0)
 S $P(@(RXORDER_"0)"),"^",21)=$P(ORDER,"^")
"RTN","PSJHL5",69,0)
 S STATUS=$S(RXON["V":$P(NODE,"^",17),1:$P(NODE,"^",9))
"RTN","PSJHL5",70,0)
 S STPDT=$S(RXON["V":$P(NODE,"^",3),1:$P(NODE2,"^",4))
"RTN","PSJHL5",71,0)
 D NOW^%DTC I RXON'["P" I "DEH"'[STATUS I STPDT<% D EXPIR^PSJHL6 Q
"RTN","PSJHL5",72,0)
 D EN1^PSJHL2(PSJHLDFN,"SC",RXON)
"RTN","PSJHL5",73,0)
 Q
"RTN","PSJHL5",74,0)
 ;
"RTN","PSJHL5",75,0)
FLAG ;Flag/Unflag orders
"RTN","PSJHL5",76,0)
 I '$P($G(@(RXORDER_"0)")),U) S ORDCON="Invalid Pharmacy order number/Flag Msg" S X="ORERR" X ^%ZOSF("TEST") I  D EN^ORERR(ORDCON,.PSJMSG) Q
"RTN","PSJHL5",77,0)
 Q:'$P($G(@(RXORDER_"0)")),U)
"RTN","PSJHL5",78,0)
 S DIE=$S(RXON["N"!(RXON["P"):"^PS(53.1,",RXON["V":"^PS(55,"_PSJHLDFN_",""IV"",",1:"^PS(55,"_PSJHLDFN_",5,"),DA=+RXON,DA(1)=PSJHLDFN
"RTN","PSJHL5",79,0)
 S DR=$S(PSJFLAG="FL":$S(RXON["V":"148////1",1:"124////1"),1:$S(RXON["V":"148////@",1:"124////@"))
"RTN","PSJHL5",80,0)
 D ^DIE
"RTN","PSJHL5",81,0)
 I $G(FLCMNT)]"" S FLCMNT=$$UNESC^ORHLESC(FLCMNT)
"RTN","PSJHL5",82,0)
 I RXON["U" S FLCMNT="COMMENTS: "_FLCMNT S:$L(FLCMNT)>52 FLCMNT=$E(FLCMNT,1,49)_"..." D NEWUDAL^PSGAL5(PSJHLDFN,+RXON,$S((PSJFLAG="FL")&(PSJYN="PHR"):7000,(PSJFLAG="UF")&(PSJYN="PHR"):7010,(PSJFLAG="FL")&(PSJYN=""):7020,1:7030),FLCMNT)
"RTN","PSJHL5",83,0)
 I RXON["V" N DFN,ON55,PSIVREA,PSIVAL S DFN=PSJHLDFN S PSIVALT="",ON55=RXON,PSIVREA=$S(PSJFLAG="FL":"G",1:"UG"),PSIVAL=$S(PSJYN="PHR":"FLAGGED BY PHARMACIST ",1:"FLAGGED BY CPRS ")_FLCMNT D LOG^PSIVORAL
"RTN","PSJHL5",84,0)
 I RXON["P" S FLCMNT="COMMENTS: "_FLCMNT S:$L(FLCMNT)>52 FLCMNT=$E(FLCMNT,1,49)_"..." D NEWNVAL^PSGAL5(+RXON,$S((PSJFLAG="FL")&(PSJYN="PHR"):7000,(PSJFLAG="UF")&(PSJYN="PHR"):7010,(PSJFLAG="FL")&(PSJYN=""):7020,1:7030),FLCMNT)
"RTN","PSJHL5",85,0)
 ;The ... on Unit Dose and Pending orders is because of the limitations in the DD of 53.1.
"RTN","PSJHL5",86,0)
 Q
"VER")
8.0^22.0
"BLD",9611,6)
^268
**END**
**END**

