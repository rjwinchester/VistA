Released PSJ*5*359 SEQ #309
Extracted from mail message
**KIDS**:PSJ*5.0*359^

**INSTALL NAME**
PSJ*5.0*359
"BLD",10819,0)
PSJ*5.0*359^INPATIENT MEDICATIONS^0^3180411^y
"BLD",10819,1,0)
^^3^3^3180213^^
"BLD",10819,1,1,0)
This patch will address 2 Inpatient Medications issues:
"BLD",10819,1,2,0)
1) <UNDEFINED> error when purging PRE-EXCHANGE NEEDS file.
"BLD",10819,1,3,0)
2) Ward field set to zero in Patient Pharmacy file for IV orders.    
"BLD",10819,4,0)
^9.64PA^^
"BLD",10819,6.3)
7
"BLD",10819,"ABPKG")
n
"BLD",10819,"KRN",0)
^9.67PA^779.2^20
"BLD",10819,"KRN",.4,0)
.4
"BLD",10819,"KRN",.401,0)
.401
"BLD",10819,"KRN",.402,0)
.402
"BLD",10819,"KRN",.403,0)
.403
"BLD",10819,"KRN",.5,0)
.5
"BLD",10819,"KRN",.84,0)
.84
"BLD",10819,"KRN",3.6,0)
3.6
"BLD",10819,"KRN",3.8,0)
3.8
"BLD",10819,"KRN",9.2,0)
9.2
"BLD",10819,"KRN",9.8,0)
9.8
"BLD",10819,"KRN",9.8,"NM",0)
^9.68A^2^2
"BLD",10819,"KRN",9.8,"NM",1,0)
PSGPER1^^0^B19888718
"BLD",10819,"KRN",9.8,"NM",2,0)
PSJADT1^^0^B6170299
"BLD",10819,"KRN",9.8,"NM","B","PSGPER1",1)

"BLD",10819,"KRN",9.8,"NM","B","PSJADT1",2)

"BLD",10819,"KRN",19,0)
19
"BLD",10819,"KRN",19,"NM",0)
^9.68A^^
"BLD",10819,"KRN",19.1,0)
19.1
"BLD",10819,"KRN",101,0)
101
"BLD",10819,"KRN",409.61,0)
409.61
"BLD",10819,"KRN",771,0)
771
"BLD",10819,"KRN",779.2,0)
779.2
"BLD",10819,"KRN",870,0)
870
"BLD",10819,"KRN",8989.51,0)
8989.51
"BLD",10819,"KRN",8989.52,0)
8989.52
"BLD",10819,"KRN",8994,0)
8994
"BLD",10819,"KRN","B",.4,.4)

"BLD",10819,"KRN","B",.401,.401)

"BLD",10819,"KRN","B",.402,.402)

"BLD",10819,"KRN","B",.403,.403)

"BLD",10819,"KRN","B",.5,.5)

"BLD",10819,"KRN","B",.84,.84)

"BLD",10819,"KRN","B",3.6,3.6)

"BLD",10819,"KRN","B",3.8,3.8)

"BLD",10819,"KRN","B",9.2,9.2)

"BLD",10819,"KRN","B",9.8,9.8)

"BLD",10819,"KRN","B",19,19)

"BLD",10819,"KRN","B",19.1,19.1)

"BLD",10819,"KRN","B",101,101)

"BLD",10819,"KRN","B",409.61,409.61)

"BLD",10819,"KRN","B",771,771)

"BLD",10819,"KRN","B",779.2,779.2)

"BLD",10819,"KRN","B",870,870)

"BLD",10819,"KRN","B",8989.51,8989.51)

"BLD",10819,"KRN","B",8989.52,8989.52)

"BLD",10819,"KRN","B",8994,8994)

"BLD",10819,"QUES",0)
^9.62^^
"BLD",10819,"REQB",0)
^9.611^2^2
"BLD",10819,"REQB",1,0)
PSJ*5.0*279^1
"BLD",10819,"REQB",2,0)
PSJ*5.0*350^1
"BLD",10819,"REQB","B","PSJ*5.0*279",1)

"BLD",10819,"REQB","B","PSJ*5.0*350",2)

"MBREQ")
0
"PKG",471,-1)
1^1
"PKG",471,0)
INPATIENT MEDICATIONS^PSJ^UNIT DOSE AND IVS
"PKG",471,20,0)
^9.402P^^
"PKG",471,22,0)
^9.49I^1^1
"PKG",471,22,1,0)
5.0^2971215^2990325^66481
"PKG",471,22,1,"PAH",1,0)
359^3180411
"PKG",471,22,1,"PAH",1,1,0)
^^3^3^3180411
"PKG",471,22,1,"PAH",1,1,1,0)
This patch will address 2 Inpatient Medications issues:
"PKG",471,22,1,"PAH",1,1,2,0)
1) <UNDEFINED> error when purging PRE-EXCHANGE NEEDS file.
"PKG",471,22,1,"PAH",1,1,3,0)
2) Ward field set to zero in Patient Pharmacy file for IV orders.    
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
2
"RTN","PSGPER1")
0^1^B19888718^B18498632
"RTN","PSGPER1",1,0)
PSGPER1 ;BIR/CML3-PRINTS PRE-EXCHANGE NEEDS REPORT ; 2/8/18 11:56am
"RTN","PSGPER1",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**80,127,279,359**;16 DEC 97;Build 7
"RTN","PSGPER1",3,0)
 ;
"RTN","PSGPER1",4,0)
EN ; Entry point
"RTN","PSGPER1",5,0)
 S PSGPERRF=0,POP=0 N PSGPRCLD,PSGCURCL S PSGPRCLD="" D DEFCL(PSGPXN,.PSGPRCLD)
"RTN","PSGPER1",6,0)
 N PSGPRTYP,PSGPRCL
"RTN","PSGPER1",7,0)
 I $G(PSGPRCLD("WARD")) S PSGPRTYP="PSGPERP" D DEV K PSGPRCLD("WARD")
"RTN","PSGPER1",8,0)
 I POP D POP G:%=1 EN G DONE
"RTN","PSGPER1",9,0)
 I $D(PSGPRCLD)>1 S PSGPRTYP="PSGPERPC" S PSGCURCL="" F  S PSGCURCL=$O(PSGPRCLD("DEV",PSGCURCL)) Q:PSGCURCL=""  D DEV
"RTN","PSGPER1",10,0)
 D DONE
"RTN","PSGPER1",11,0)
 Q
"RTN","PSGPER1",12,0)
DEV ; Select Device
"RTN","PSGPER1",13,0)
 S PSGION=ION
"RTN","PSGPER1",14,0)
 D DEV1
"RTN","PSGPER1",15,0)
 Q
"RTN","PSGPER1",16,0)
DEV0 ; Validate Device
"RTN","PSGPER1",17,0)
 S PSGION=ION
"RTN","PSGPER1",18,0)
DEV1 ; Device validation loop
"RTN","PSGPER1",19,0)
 W !!,"PRE-EXCHANGE UNITS REPORT"
"RTN","PSGPER1",20,0)
 K IOP,%ZIS,IO("Q") S %ZIS="Q",%ZIS("A")="Select DEVICE for "_$S($G(PSGPRCLD("WARD")):"Ward "_$G(^DPT(DFN,.1)),$G(PSGCURCL)]"":"Clinic "_PSGCURCL,1:"")_": ",%ZIS("B")=$S(($G(PSGCURCL)]""):$G(PSGPRCLD("DEV",PSGCURCL)),1:"")
"RTN","PSGPER1",21,0)
 D ^%ZIS K %ZIS
"RTN","PSGPER1",22,0)
 I POP D POP G:%=1 DEV1
"RTN","PSGPER1",23,0)
 I $D(IO("Q")) K ZTSAVE S PSGTIR="^PSGPER2",ZTDESC="PRE-EXCHANGE UNITS REPORT",ZTDTH=$H,ZTSAVE("PSGPXN")="",ZTSAVE("DFN")="",ZTSAVE("PSGPRTYP")="",ZTSAVE("PSGCURCL")="" D ENTSK^PSGTI G:'$D(ZTSK) DEV0 K ZTSK
"RTN","PSGPER1",24,0)
 D ENP^PSGPER2,AG I %=1 S PSGPERRF=1 G DEV0
"RTN","PSGPER1",25,0)
 Q
"RTN","PSGPER1",26,0)
 ;
"RTN","PSGPER1",27,0)
DONE ;
"RTN","PSGPER1",28,0)
OUT ;
"RTN","PSGPER1",29,0)
 D TASKPRGE^PSGPER1(PSGPXN) ;
"RTN","PSGPER1",30,0)
 K PSGPERRF,PSGPXN
"RTN","PSGPER1",31,0)
 Q:$G(PSJCOM)!$G(PSJPREX)
"RTN","PSGPER1",32,0)
 D ENIVKV^PSGSETU,ENCV^PSGSETU
"RTN","PSGPER1",33,0)
 Q
"RTN","PSGPER1",34,0)
 ;
"RTN","PSGPER1",35,0)
POP ;
"RTN","PSGPER1",36,0)
 S %=2 W:'PSGPERRF !!,"IF A DEVICE IS NOT CHOSEN, NO REPORT WILL BE RUN AND THE DATA WILL NO LONGER BE RETRIEVABLE THROUGH THIS REPORT."
"RTN","PSGPER1",37,0)
 I 'PSGPERRF F  W !,"Do you want another chance to choose a device" S %=1 D YN^DICN Q:%  W !?3,"Enter 'YES' to choose a device to print.  Enter 'NO' to quit now."
"RTN","PSGPER1",38,0)
 I %'=1 S IOP=PSGION D ^%ZIS S %=2
"RTN","PSGPER1",39,0)
 Q
"RTN","PSGPER1",40,0)
 ;
"RTN","PSGPER1",41,0)
AG ;
"RTN","PSGPER1",42,0)
 F  W !!,"DO YOU NEED TO PRINT THIS REPORT AGAIN" S %=0 D YN^DICN Q:%  D AGMSG
"RTN","PSGPER1",43,0)
 Q
"RTN","PSGPER1",44,0)
 ;
"RTN","PSGPER1",45,0)
AGMSG ;
"RTN","PSGPER1",46,0)
 I %Y'?1."?" W $C(7),"  ANSWER 'YES' OR 'NO' (Entry required)" Q
"RTN","PSGPER1",47,0)
 W !,"  Enter 'YES' to print this report again.  Enter 'NO' (or an '^') to quit",!,"now.  PLEASE NOTE that you will NOT be able to retrieve this data at a later",!,"date.  You should print this information now." Q
"RTN","PSGPER1",48,0)
 ;
"RTN","PSGPER1",49,0)
DEFON() ; All Pre-Exchange Devices have been removed from Ward Parameters - restore previous functionality
"RTN","PSGPER1",50,0)
 N ON,W S ON=0,W=0 F  S W=$O(^PS(59.6,W)) Q:'W!ON  I $P(^(W,0),U,29)]"" S ON=1
"RTN","PSGPER1",51,0)
 I $G(PSJPXDOF) S ON=0 K PSJPXDOF
"RTN","PSGPER1",52,0)
 Q ON
"RTN","PSGPER1",53,0)
 ;
"RTN","PSGPER1",54,0)
DEFCL(PSGPXN,CLINICS) ; Default devices for Clinics
"RTN","PSGPER1",55,0)
 K CLINICS N CLINIC,CLINM,CLINX,CLINDEV
"RTN","PSGPER1",56,0)
 N CLINAM,DFN S DFN=0 F  S DFN=$O(^PS(53.4,PSGPXN,1,DFN)) Q:'DFN  S ON=0 F  S ON=$O(^PS(53.4,PSGPXN,1,DFN,1,ON)) Q:'ON  D
"RTN","PSGPER1",57,0)
 .S CLINIC=$$CLINIC^PSJO1(DFN,+ON_"U")
"RTN","PSGPER1",58,0)
 .I CLINIC]"" N CLINUM,DIC,X,Y S DIC="^SC(",DIC(0)="NSUXZ",X=CLINIC D ^DIC I $G(Y)>0 S CLINUM=+Y D
"RTN","PSGPER1",59,0)
 ..S CLINAM=CLINIC N LCLCL S LCLCL=$P($G(PSJSYSW0("CLINIC",+CLINUM,1)),"^")
"RTN","PSGPER1",60,0)
 ..I $G(PSJSYSW0("CLINIC",+CLINUM,0)) S CLINICS("DEV",CLINAM)=$$GET1^DIQ(3.5,+LCLCL,".01"),CLINICS("DEVX",+CLINIC)=CLINAM
"RTN","PSGPER1",61,0)
 .I CLINIC="" S CLINICS("WARD")=1
"RTN","PSGPER1",62,0)
 Q
"RTN","PSGPER1",63,0)
TASKPRGE(PXN) ; Task purge of entry from file 53.4
"RTN","PSGPER1",64,0)
 Q:$D(^XTMP("PSGPER1:"_$G(PXN),0))  ;p359
"RTN","PSGPER1",65,0)
 K ZTIO,ZTDTH,ZTSK S ZTIO="",ZTRTN="PURGE^PSGPER1",ZTDESC="PURGE PRE-EXCHANGE NEEDS" S ZTSAVE("PXN")="" S ZTDTH=$$HADD^XLFDT($H,1,0,0,0)
"RTN","PSGPER1",66,0)
 D ^%ZTLOAD
"RTN","PSGPER1",67,0)
 S:$G(PXN) ^XTMP("PSGPER1:"_PXN,0)=$$FMADD^XLFDT($$DT^XLFDT,7,0,0,0)_"^"_$$DT^XLFDT_"^File 53.4 purge log" ;p359
"RTN","PSGPER1",68,0)
 K %ZIS,IOP,PSGTID,PSGTIR,ZTDESC,ZTDTH,ZTRTN,ZTDESC,ZTSAVE
"RTN","PSGPER1",69,0)
 Q
"RTN","PSGPER1",70,0)
PURGE ; Purge entry from file 53.4
"RTN","PSGPER1",71,0)
 Q:'$G(PXN)
"RTN","PSGPER1",72,0)
 K ^XTMP("PSGPER1:"_PXN) ;p359
"RTN","PSGPER1",73,0)
 N PSGPXINF,PSGNOWFM S PSGPXINF=$G(^PS(53.4,+$G(PXN),0)),PSGPXINF=$P($P(PSGPXINF,"^",2),".") Q:'$G(PSGPXINF)
"RTN","PSGPER1",74,0)
 S PSGNOWFM=$P($$NOW^XLFDT,".") Q:'(PSGNOWFM>PSGPXINF)
"RTN","PSGPER1",75,0)
 S DIK="^PS(53.4,",DA=PXN D ^DIK
"RTN","PSGPER1",76,0)
 Q
"RTN","PSJADT1")
0^2^B6170299^B5915914
"RTN","PSJADT1",1,0)
PSJADT1 ;BIR/CML3 - AUTO CANCEL/HOLD UTILITIES ;17 JAN 96 / 10:11 AM
"RTN","PSJADT1",2,0)
 ;;5.0;INPATIENT MEDICATIONS ;**30,37,51,83,350,359**;16 DEC 97;Build 7
"RTN","PSJADT1",3,0)
 ;
"RTN","PSJADT1",4,0)
 ; Reference to ^PS(55 is supported by DBIA# 2191.
"RTN","PSJADT1",5,0)
 ; Reference to ^PS(59.7 is supported by DBIA# 2181.
"RTN","PSJADT1",6,0)
 ;
"RTN","PSJADT1",7,0)
ENUW ; update ward and treating specialty
"RTN","PSJADT1",8,0)
 S VAINDT=$P($G(PSJPIND),U,4) D INP^VADPT,NOW^%DTC F Q1=%:0 S Q1=$O(^PS(55,PSGP,5,"AUS",Q1)) Q:'Q1  F Q2=0:0 S Q2=$O(^PS(55,PSGP,5,"AUS",Q1,Q2)) Q:'Q2  D
"RTN","PSJADT1",9,0)
 .I $D(^PS(55,PSGP,5,Q2,0)) S $P(^(0),"^",23)=+VAIN(4),^PS(55,"AUE",PSGP,Q2)=""
"RTN","PSJADT1",10,0)
 F ON=0:0 S ON=$O(^PS(55,PSGP,"IV",ON)) Q:'ON  I $D(^(ON,0)) S $P(^(0),"^",22)=+VAIN(4)
"RTN","PSJADT1",11,0)
 Q
"RTN","PSJADT1",12,0)
 ;
"RTN","PSJADT1",13,0)
ENHOLD(PSGOEHA,PSJDEL,PSJPAD,PSGALO) ;
"RTN","PSJADT1",14,0)
 ; place orders on/off hold
"RTN","PSJADT1",15,0)
 S X=PSGOEHA W:'$D(DGQUIET) !,"...",$S(X:"plac",1:"tak"),"ing Inpatient Medication orders o",$S(X:"n",1:"ff")," of hold..."
"RTN","PSJADT1",16,0)
 D NOW^%DTC S PSGDT=+$E(%,1,12),PSGOEHA='PSGOEHA D ENACH^PSGOEHA
"RTN","PSJADT1",17,0)
 S DFN=PSGP,PSIVNST="H" I 'PSGOEHA D ^PSIVHLD
"RTN","PSJADT1",18,0)
 I PSGOEHA D START^PSIVHLD
"RTN","PSJADT1",19,0)
 I 'PSGOEHA S X=PSJDEL,X=$S(X=3:2,X=22:2,X=26:2,1:1),$P(PSJPIND,"^",7)=2,$P(PSJPIND,"^",10)="Transferred "_$P("A^Una",U,X)_"uthorized Absence" Q
"RTN","PSJADT1",20,0)
 S $P(PSJPIND,"^",7)="",$P(PSJPIND,"^",10)="" G ENUW
"RTN","PSJADT1",21,0)
 ;
"RTN","PSJADT1",22,0)
ENDEL(DFN,DGPMP,PSJTMT,PSJDEL) ;
"RTN","PSJADT1",23,0)
 ;Undo mvmt action if movement is deleted.
"RTN","PSJADT1",24,0)
 N VAIP S VAIP("D")=+DGPMP D IN5^VADPT Q:VAIP(16)
"RTN","PSJADT1",25,0)
 ; Add call to PSJADT0 to dc active/non-verified orders for cancelled admissions.
"RTN","PSJADT1",26,0)
 I PSJDEL=1 D  Q
"RTN","PSJADT1",27,0)
 . S PSJPAD=+VAIP(13,1),PSGALO=1035
"RTN","PSJADT1",28,0)
 . N VAIP D IN5^VADPT Q:+VAIP(13,1)>PSJPAD
"RTN","PSJADT1",29,0)
 . D ENDC^PSJADT0
"RTN","PSJADT1",30,0)
 I PSJDEL=3 D ENUNDC^PSJADT0(+DGPMP,DFN,VAIP(5),18540) Q
"RTN","PSJADT1",31,0)
 I PSJDEL=6 D ENUNDC^PSJADT0(+DGPMP,DFN,VAIP(5),18550) Q
"RTN","PSJADT1",32,0)
 I PSJTMT=4 D ENUNDC^PSJADT0(+DGPMP,DFN,VAIP(5),18550) Q
"RTN","PSJADT1",33,0)
 I PSJTMT<4 D
"RTN","PSJADT1",34,0)
 .I $P($G(^PS(55,DFN,5.1)),U,7),$P(^(5.1),U,10)["Transferred" D ENHOLD(0,PSJDEL,+DGPMP,8090)
"RTN","PSJADT1",35,0)
 .S:'$D(VAIP(5)) VAIP(5)=DGPMVI(5)
"RTN","PSJADT1",36,0)
 .D ENUNDC^PSJADT0(+DGPMP,DFN,VAIP(5),18550)
"RTN","PSJADT1",37,0)
 I PSJTMT>21,(PSJTMT<27) S X=PSJTMT I $P($G(^PS(59.7,1,22,+VAIP(5),0)),U,$S(X=22!(X=26):4,X=23:2,1:3)) D ENHOLD(1,X,+DGPMP,8590)
"RTN","PSJADT1",38,0)
 Q
"RTN","PSJADT1",39,0)
  
"VER")
8.0^22.2
"BLD",10819,6)
^309
**END**
**END**

