Released PSJ*5*328 SEQ #285
Extracted from mail message
**KIDS**:PSJ*5.0*328^

**INSTALL NAME**
PSJ*5.0*328
"BLD",10085,0)
PSJ*5.0*328^INPATIENT MEDICATIONS^0^3160502^y
"BLD",10085,1,0)
^^4^4^3160113^
"BLD",10085,1,1,0)
This patch will resolve the following issues:
"BLD",10085,1,2,0)
1)      One time order appears as active after discharge
"BLD",10085,1,3,0)
2)      Option PSJ EXP gets an error with clinic orders
"BLD",10085,1,4,0)
3)      Mismatch Dosage Warning inconsistent
"BLD",10085,4,0)
^9.64PA^^
"BLD",10085,6.3)
6
"BLD",10085,"KRN",0)
^9.67PA^779.2^20
"BLD",10085,"KRN",.4,0)
.4
"BLD",10085,"KRN",.401,0)
.401
"BLD",10085,"KRN",.402,0)
.402
"BLD",10085,"KRN",.403,0)
.403
"BLD",10085,"KRN",.5,0)
.5
"BLD",10085,"KRN",.84,0)
.84
"BLD",10085,"KRN",3.6,0)
3.6
"BLD",10085,"KRN",3.8,0)
3.8
"BLD",10085,"KRN",9.2,0)
9.2
"BLD",10085,"KRN",9.8,0)
9.8
"BLD",10085,"KRN",9.8,"NM",0)
^9.68A^4^4
"BLD",10085,"KRN",9.8,"NM",1,0)
PSJBCMA4^^0^B17522751
"BLD",10085,"KRN",9.8,"NM",2,0)
PSJDOSE^^0^B62450032
"BLD",10085,"KRN",9.8,"NM",3,0)
PSJEXP^^0^B46163170
"BLD",10085,"KRN",9.8,"NM",4,0)
PSJEXP0^^0^B28342698
"BLD",10085,"KRN",9.8,"NM","B","PSJBCMA4",1)

"BLD",10085,"KRN",9.8,"NM","B","PSJDOSE",2)

"BLD",10085,"KRN",9.8,"NM","B","PSJEXP",3)

"BLD",10085,"KRN",9.8,"NM","B","PSJEXP0",4)

"BLD",10085,"KRN",19,0)
19
"BLD",10085,"KRN",19.1,0)
19.1
"BLD",10085,"KRN",101,0)
101
"BLD",10085,"KRN",409.61,0)
409.61
"BLD",10085,"KRN",771,0)
771
"BLD",10085,"KRN",779.2,0)
779.2
"BLD",10085,"KRN",870,0)
870
"BLD",10085,"KRN",8989.51,0)
8989.51
"BLD",10085,"KRN",8989.52,0)
8989.52
"BLD",10085,"KRN",8994,0)
8994
"BLD",10085,"KRN","B",.4,.4)

"BLD",10085,"KRN","B",.401,.401)

"BLD",10085,"KRN","B",.402,.402)

"BLD",10085,"KRN","B",.403,.403)

"BLD",10085,"KRN","B",.5,.5)

"BLD",10085,"KRN","B",.84,.84)

"BLD",10085,"KRN","B",3.6,3.6)

"BLD",10085,"KRN","B",3.8,3.8)

"BLD",10085,"KRN","B",9.2,9.2)

"BLD",10085,"KRN","B",9.8,9.8)

"BLD",10085,"KRN","B",19,19)

"BLD",10085,"KRN","B",19.1,19.1)

"BLD",10085,"KRN","B",101,101)

"BLD",10085,"KRN","B",409.61,409.61)

"BLD",10085,"KRN","B",771,771)

"BLD",10085,"KRN","B",779.2,779.2)

"BLD",10085,"KRN","B",870,870)

"BLD",10085,"KRN","B",8989.51,8989.51)

"BLD",10085,"KRN","B",8989.52,8989.52)

"BLD",10085,"KRN","B",8994,8994)

"BLD",10085,"QDEF")
^^^^NO^^^^^^NO
"BLD",10085,"QUES",0)
^9.62^^
"BLD",10085,"REQB",0)
^9.611^2^2
"BLD",10085,"REQB",1,0)
PSJ*5.0*104^2
"BLD",10085,"REQB",2,0)
PSJ*5.0*264^2
"BLD",10085,"REQB","B","PSJ*5.0*104",1)

"BLD",10085,"REQB","B","PSJ*5.0*264",2)

"MBREQ")
0
"PKG",471,-1)
1^1
"PKG",471,0)
INPATIENT MEDICATIONS^PSJ^UNIT DOSE AND IVS
"PKG",471,20,0)
^9.402P^^
"PKG",471,22,0)
^9.49I^1^1
"PKG",471,22,1,0)
5.0^2971215^2990325^66481
"PKG",471,22,1,"PAH",1,0)
328^3160502
"PKG",471,22,1,"PAH",1,1,0)
^^4^4^3160502
"PKG",471,22,1,"PAH",1,1,1,0)
This patch will resolve the following issues:
"PKG",471,22,1,"PAH",1,1,2,0)
1)      One time order appears as active after discharge
"PKG",471,22,1,"PAH",1,1,3,0)
2)      Option PSJ EXP gets an error with clinic orders
"PKG",471,22,1,"PAH",1,1,4,0)
3)      Mismatch Dosage Warning inconsistent
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
4
"RTN","PSJBCMA4")
0^1^B17522751^B16569271
"RTN","PSJBCMA4",1,0)
PSJBCMA4 ;BIR/JLC - BCMA ORDER UPDATE FOR INPATIENT MEDS ;18 JUN 01
"RTN","PSJBCMA4",2,0)
 ;;5.0;INPATIENT MEDICATIONS ;**63,66,58,104,328**;16 DEC 97;Build 6
"RTN","PSJBCMA4",3,0)
 ;
"RTN","PSJBCMA4",4,0)
 ;Reference to ^DPT is supported by DBIA 10035
"RTN","PSJBCMA4",5,0)
 ;Reference to ^PS(55 is supported by DBIA 2191
"RTN","PSJBCMA4",6,0)
 ;Reference to ^XMB is supported by DBIA 1131
"RTN","PSJBCMA4",7,0)
 ;Reference to ^%DTC is supported by DBIA 10000
"RTN","PSJBCMA4",8,0)
 ;Reference to ^DIE is supported by DBIA 10018
"RTN","PSJBCMA4",9,0)
 ;Reference to ^DIQ is supported by DBIA 2056
"RTN","PSJBCMA4",10,0)
 ;Reference to ^XMD is supported by DBIA 10070
"RTN","PSJBCMA4",11,0)
 ;
"RTN","PSJBCMA4",12,0)
ENE(DFN,ON) ;
"RTN","PSJBCMA4",13,0)
 N PSJIEN,PSJSTOP,PSJSTAT,PSJSTOP,PSJNOW,DA,DR,DIE,PSIVACT,ON55,PSIVREA,PSIVAL,PSIVALT,PSJSCH,X
"RTN","PSJBCMA4",14,0)
 I $G(DFN)=""!($G(ON)="") Q
"RTN","PSJBCMA4",15,0)
 D NOW^%DTC S PSJNOW=%
"RTN","PSJBCMA4",16,0)
 I ON["V" D  Q
"RTN","PSJBCMA4",17,0)
 . I '$D(^PS(55,DFN,"IV",+ON)) Q
"RTN","PSJBCMA4",18,0)
 . S X=$G(^PS(55,DFN,"IV",+ON,0))
"RTN","PSJBCMA4",19,0)
 . S PSJSTART=$P(X,"^",2),PSJSTOP=$P(X,"^",3),PSJSCH=$P(X,"^",9),PSJSTAT=$P(X,"^",17)
"RTN","PSJBCMA4",20,0)
 . I $P($G(^PS(55,DFN,"IV",+ON,.2)),"^",4)="D" Q
"RTN","PSJBCMA4",21,0)
 . S DIE="^PS(55,"_DFN_",""IV"",",DA=+ON,DA(1)=DFN
"RTN","PSJBCMA4",22,0)
 . I PSJSTAT'="A" D IEA(0) Q
"RTN","PSJBCMA4",23,0)
 . I PSJSTOP'>PSJNOW D IEA(0) Q
"RTN","PSJBCMA4",24,0)
 . I $$ONE^PSJBCMA(DFN,ON,PSJSCH,PSJSTART,PSJSTOP)'="O" D IEA(0) Q
"RTN","PSJBCMA4",25,0)
 . S PSIVACT=1,DR="116////"_PSJSTOP_";.03////"_PSJNOW_";100////E;147////1" D ^DIE
"RTN","PSJBCMA4",26,0)
 . D IEA(1),EN1^PSJHL2(DFN,"SC",ON,"BCMA EXPIRED")
"RTN","PSJBCMA4",27,0)
 I ON["U" D  Q
"RTN","PSJBCMA4",28,0)
 . I '$D(^PS(55,DFN,5,+ON)) Q
"RTN","PSJBCMA4",29,0)
 . S X=$G(^PS(55,DFN,5,+ON,2)),PSJSCH=$P(X,"^"),PSJSTART=$P(X,"^",2),PSJSTOP=$P(X,"^",4)
"RTN","PSJBCMA4",30,0)
 . S PSJIEN=+ON_","_DFN_",",PSJSTAT=$$GET1^DIQ(55.06,PSJIEN,28,"I")
"RTN","PSJBCMA4",31,0)
 . I $P($G(^PS(55,DFN,5,+ON,.2)),"^",4)="D" Q
"RTN","PSJBCMA4",32,0)
 . S DIE="^PS(55,"_DFN_",5,",DA=+ON,DA(1)=DFN
"RTN","PSJBCMA4",33,0)
 . I PSJSTAT'="A" D UEA(0) Q
"RTN","PSJBCMA4",34,0)
 . I PSJSTOP'>PSJNOW D UEA(0) Q
"RTN","PSJBCMA4",35,0)
 . I $$ONE^PSJBCMA(DFN,ON,PSJSCH,PSJSTART,PSJSTOP)'="O" D UEA(0) Q
"RTN","PSJBCMA4",36,0)
 . S DR="25////"_PSJSTOP_";34////"_PSJNOW_";28////E;123////1" D ^DIE
"RTN","PSJBCMA4",37,0)
 . D UEA(1),EN1^PSJHL2(DFN,"SC",ON,"BCMA EXPIRED")
"RTN","PSJBCMA4",38,0)
 Q
"RTN","PSJBCMA4",39,0)
ENR(DFN,ON) ;
"RTN","PSJBCMA4",40,0)
 N PSJIEN,PSJORIG,PSJSTAT,PSJSTOP,PSJNOW,DA,DR,DIE,PSIVACT,PSJF,X,PSJ,XMY,XMDUZ,XMSUB,XMTEXT
"RTN","PSJBCMA4",41,0)
 I $G(DFN)=""!($G(ON)="") Q
"RTN","PSJBCMA4",42,0)
 D NOW^%DTC S PSJNOW=%
"RTN","PSJBCMA4",43,0)
 I ON["V" D  Q
"RTN","PSJBCMA4",44,0)
 . I '$D(^PS(55,DFN,"IV",+ON)) Q
"RTN","PSJBCMA4",45,0)
 . I '$P($G(^PS(55,DFN,"IV",+ON,"DSS")),U,2) N VAIP D IN5^VADPT Q:'$G(VAIP(1))
"RTN","PSJBCMA4",46,0)
 . S PSJIEN=+ON_","_DFN_",",PSJBCMA=$$GET1^DIQ(55.01,PSJIEN,147,"I"),PSJORIG=$$GET1^DIQ(55.01,PSJIEN,116,"I")
"RTN","PSJBCMA4",47,0)
 . S DIE="^PS(55,"_DFN_",""IV"",",DA=+ON,DA(1)=DFN
"RTN","PSJBCMA4",48,0)
 . I PSJBCMA'=1!(PSJORIG'>PSJNOW) D IRA(0) Q
"RTN","PSJBCMA4",49,0)
 . S PSIVACT=1,DR="116////;.03////"_PSJORIG_";100////A;147////0" D ^DIE
"RTN","PSJBCMA4",50,0)
 . D IRA(1),EN1^PSJHL2(DFN,"SC",ON,"BCMA REINSTATED")
"RTN","PSJBCMA4",51,0)
 I ON["U" D  Q
"RTN","PSJBCMA4",52,0)
 . I '$D(^PS(55,DFN,5,+ON)) Q
"RTN","PSJBCMA4",53,0)
 . I '$P($G(^PS(55,DFN,5,+ON,8)),U,2) N VAIP D IN5^VADPT Q:'$G(VAIP(1))
"RTN","PSJBCMA4",54,0)
 . S PSJIEN=+ON_","_DFN_",",PSJBCMA=$$GET1^DIQ(55.06,PSJIEN,123,"I"),PSJORIG=$$GET1^DIQ(55.06,PSJIEN,25,"I")
"RTN","PSJBCMA4",55,0)
 . S DIE="^PS(55,"_DFN_",5,",DA=+ON,DA(1)=DFN
"RTN","PSJBCMA4",56,0)
 . I PSJBCMA'=1!(PSJORIG'>PSJNOW) D URA(0) Q
"RTN","PSJBCMA4",57,0)
 . S DR="25////;34////"_PSJORIG_";28////A;123////0" D ^DIE
"RTN","PSJBCMA4",58,0)
 . D URA(1),EN1^PSJHL2(DFN,"SC",ON,"BCMA REINSTATED")
"RTN","PSJBCMA4",59,0)
 Q
"RTN","PSJBCMA4",60,0)
IEA(STAT) ;
"RTN","PSJBCMA4",61,0)
 S ON55=ON,PSIVREA="E",PSIVAL=$S(STAT:"BCMA EXPIRED",1:"BCMA EXPIRE DENIED")
"RTN","PSJBCMA4",62,0)
 D LOG^PSIVORAL Q
"RTN","PSJBCMA4",63,0)
UEA(STAT) ;
"RTN","PSJBCMA4",64,0)
 S PSGAL("C")=$S(STAT:25000,1:25100) D ^PSGAL5 Q
"RTN","PSJBCMA4",65,0)
IRA(STAT) ;
"RTN","PSJBCMA4",66,0)
 S ON55=ON,PSIVREA="E",PSIVAL=$S(STAT:"BCMA REINSTATED",1:"BCMA REINSTATE DENIED")
"RTN","PSJBCMA4",67,0)
 D LOG^PSIVORAL
"RTN","PSJBCMA4",68,0)
 F PSJF=.06,135,16 S X=$$GET1^DIQ(55.01,PSJIEN,PSJF,"I") I X]"" S XMY(X)=""
"RTN","PSJBCMA4",69,0)
 D MSG(STAT)
"RTN","PSJBCMA4",70,0)
 Q
"RTN","PSJBCMA4",71,0)
URA(STAT) ;
"RTN","PSJBCMA4",72,0)
 S PSGAL("C")=$S(STAT:25200,1:25300) D ^PSGAL5
"RTN","PSJBCMA4",73,0)
 F PSJF=16,18,20 S X=$$GET1^DIQ(55.06,PSJIEN,PSJF,"I") I X]"" S XMY(X)=""
"RTN","PSJBCMA4",74,0)
 D MSG(STAT)
"RTN","PSJBCMA4",75,0)
 Q
"RTN","PSJBCMA4",76,0)
MSG(STAT) ;
"RTN","PSJBCMA4",77,0)
 S XMDUZ="Inpatient Medications",XMSUB="Medication Order"_$S(STAT:"",1:" not")_" reinstated.",XMTEXT="PSJ(",XMY(DUZ)="",XMY("G.PSJ-ORDERS REINSTATED@"_$G(^XMB("NETNAME")))=""
"RTN","PSJBCMA4",78,0)
 S PSJ(1,0)="Patient: "_$P(^DPT(DFN,0),"^"),PSJ(2,0)="The following order was"_$S(STAT:"",1:" not")_" reinstated after a status change in BCMA."
"RTN","PSJBCMA4",79,0)
 S PSJLINE=0 I ON["U" D DSPLORDU^PSJLMUT1(DFN,ON)
"RTN","PSJBCMA4",80,0)
 I ON["V" D DSPLORDV^PSJLMUT1(DFN,ON)
"RTN","PSJBCMA4",81,0)
 S CNT=2,X="" F  S X=$O(PSJOC(ON,X)) Q:X=""  S CNT=CNT+1,PSJ(CNT,0)=PSJOC(ON,X)
"RTN","PSJBCMA4",82,0)
 D ^XMD I $D(XMZ) S DA=XMZ,DIE=3.9,DR="1.7///P;" D ^DIE
"RTN","PSJBCMA4",83,0)
 Q
"RTN","PSJDOSE")
0^2^B62450032^B62380893
"RTN","PSJDOSE",1,0)
PSJDOSE ;BIR/MV - POSSIBLE DOSES UTILITY ; 1/28/10 8:21am
"RTN","PSJDOSE",2,0)
 ;;5.0;INPATIENT MEDICATIONS ;**50,65,106,111,216,264,328**;16 DEC 97;Build 6
"RTN","PSJDOSE",3,0)
 ;
"RTN","PSJDOSE",4,0)
 ; Reference to ^PSSORPH is supported by DBIA #3234.
"RTN","PSJDOSE",5,0)
 ;
"RTN","PSJDOSE",6,0)
 ;PSJDSFLG: Set to 1 if Dose and DD are not compatible
"RTN","PSJDOSE",7,0)
 ;PSJDSSEL: The selected dose in format:
"RTN","PSJDOSE",8,0)
 ;          Dosage Order^DD IEN^DUPD/BCMA DUPD^1(if BCMA DUPD exist
"RTN","PSJDOSE",9,0)
 ;PSJDSUPD: Set to 1 if need to prompt for the Units Per Dose
"RTN","PSJDOSE",10,0)
 ;
"RTN","PSJDOSE",11,0)
EDITDOSE ;Editing Dosage Ordered for active order
"RTN","PSJDOSE",12,0)
 ;*Need to set PSJDSFLG to null when call EDITDOSE.
"RTN","PSJDOSE",13,0)
 NEW PSGOER1,PSJDD,PSJDSUPD,PSJDSSEL,PSJX,Y
"RTN","PSJDOSE",14,0)
 ;Offer the possible doses from the only one or 1st DD
"RTN","PSJDOSE",15,0)
 S PSJX=$O(^PS(53.45,PSJSYSP,2,0)) S PSJDD=+$G(^(+PSJX,0))
"RTN","PSJDOSE",16,0)
 D DOSE(PSJDD)
"RTN","PSJDOSE",17,0)
 D DOSECHK
"RTN","PSJDOSE",18,0)
 I +PSJDSFLG D
"RTN","PSJDOSE",19,0)
 . W !!,PSJDOSE("WARN"),!,PSJDOSE("WARN1"),!
"RTN","PSJDOSE",20,0)
 . D PAUSE^VALM1
"RTN","PSJDOSE",21,0)
 S PSGOEE=2
"RTN","PSJDOSE",22,0)
 Q
"RTN","PSJDOSE",23,0)
GETDOSE(PSJDD) ;Dosage Order
"RTN","PSJDOSE",24,0)
 NEW PSJDSSEL,PSJDSUPD
"RTN","PSJDOSE",25,0)
 D DOSE(PSJDD)
"RTN","PSJDOSE",26,0)
 Q:'$D(PSJDSSEL)
"RTN","PSJDOSE",27,0)
 D:+$G(PSJDSUPD) DUPD
"RTN","PSJDOSE",28,0)
 D:'+$G(PSJDSUPD) SETDUPD($P(PSJDSSEL,U,3))
"RTN","PSJDOSE",29,0)
 D DOSECHK
"RTN","PSJDOSE",30,0)
 I +$G(PSJDSFLG) D
"RTN","PSJDOSE",31,0)
 . W !!,PSJDOSE("WARN"),!,PSJDOSE("WARN1"),!
"RTN","PSJDOSE",32,0)
 Q
"RTN","PSJDOSE",33,0)
 ;
"RTN","PSJDOSE",34,0)
SETVAR ;
"RTN","PSJDOSE",35,0)
 S PSJDOSE("WARN")="WARNING: Dosage Ordered and Dispense Units do not match."
"RTN","PSJDOSE",36,0)
 S PSJDOSE("WARN1")="         Please verify Dosage."
"RTN","PSJDOSE",37,0)
 Q
"RTN","PSJDOSE",38,0)
 ;
"RTN","PSJDOSE",39,0)
DOSE(PSJDD) ;Prompt for Dosage Ordered
"RTN","PSJDOSE",40,0)
 ;PSJDD: Dispense drug IEN
"RTN","PSJDOSE",41,0)
 ;
"RTN","PSJDOSE",42,0)
 NEW DA,DR,DIR,DTOUT,DUOUT,DIRUT,PSJDL,PSJX,PSJPIECE,PSJCONT
"RTN","PSJDOSE",43,0)
 D SETVAR
"RTN","PSJDOSE",44,0)
 D DOSE^PSSORPH(.PSJDOX,+PSJDD,"U")
"RTN","PSJDOSE",45,0)
 I '$D(PSJDOX) S PSJDOX(1)=-1
"RTN","PSJDOSE",46,0)
 S PSJPIECE=$S($P(PSJDOX(1),U,11)]"":11,1:3)
"RTN","PSJDOSE",47,0)
 I PSJPIECE=3 S:$S($P(PSJDOX(1),U,3)="":1,1:$P(PSJDOX(1),U)=-1) $P(PSJDOX(1),U)=-1
"RTN","PSJDOSE",48,0)
AGAIN ;Prompt for dosage order again
"RTN","PSJDOSE",49,0)
 S PSJX=0
"RTN","PSJDOSE",50,0)
 NEW DIR
"RTN","PSJDOSE",51,0)
 W:($P(PSJDOX(1),U)'=-1) !!,"Available Dosage(s)"
"RTN","PSJDOSE",52,0)
 F PSJDL=0:0 S PSJDL=$O(PSJDOX(PSJDL)) Q:$S('PSJDL:1,$G(DUOUT):1,1:+PSJDOX(PSJDL)=-1)  D
"RTN","PSJDOSE",53,0)
 . S PSJX=PSJX+1
"RTN","PSJDOSE",54,0)
 . W !?4,$J(PSJX,3),".    ",$P(PSJDOX(PSJDL),U,PSJPIECE)
"RTN","PSJDOSE",55,0)
 . I '(PSJX#16) S DIR(0)="E" D ^DIR
"RTN","PSJDOSE",56,0)
 W !
"RTN","PSJDOSE",57,0)
 K DIR S DIR(0)="F^1:60"  ;*216 - No null dosage
"RTN","PSJDOSE",58,0)
 S DIR("A")=$S(+PSJX:"Select from list of Available Dosages or Enter Free Text Dose",1:"DOSAGE ORDERED")
"RTN","PSJDOSE",59,0)
 S:$G(PSGDO)]"" DIR("B")=PSGDO
"RTN","PSJDOSE",60,0)
 S DIR("?")="^D ENHLP^PSGOEM(53.1,109)" D ^DIR
"RTN","PSJDOSE",61,0)
 S PSJY=$$UP^XLFSTR(Y)
"RTN","PSJDOSE",62,0)
 ;
"RTN","PSJDOSE",63,0)
 I $S($D(DTOUT):1,$D(DUOUT):1,$D(DIRUT):1,1:0) S PSGOROE1=1 Q
"RTN","PSJDOSE",64,0)
 ;
"RTN","PSJDOSE",65,0)
 ;* If select for the presented list (possible and local doses)
"RTN","PSJDOSE",66,0)
 I $D(PSJDOX(PSJY)) D  G:'PSJCONT AGAIN Q
"RTN","PSJDOSE",67,0)
 . NEW X S X=$P(PSJDOX(PSJY),U,PSJPIECE)
"RTN","PSJDOSE",68,0)
 . W "  ",X
"RTN","PSJDOSE",69,0)
 . S PSJCONT=$$CONT(X)
"RTN","PSJDOSE",70,0)
 . Q:'PSJCONT
"RTN","PSJDOSE",71,0)
 . D SELDOSE(PSJY,PSJDD)
"RTN","PSJDOSE",72,0)
 ;
"RTN","PSJDOSE",73,0)
 ;* Entered a numeric and choices are not local pos dose
"RTN","PSJDOSE",74,0)
 I PSJY?.N!(PSJY?.N1".".N),(PSJPIECE'=3) D  G:'PSJCONT AGAIN  Q
"RTN","PSJDOSE",75,0)
 . Q:$L(PSJY)>15
"RTN","PSJDOSE",76,0)
 . D DOSE^PSSORPH(.PSJDOX,+PSJDD,"U",,PSJY/+$P(PSJDOX(1),U,5))
"RTN","PSJDOSE",77,0)
 . S PSJCONT=$$CONT($P(PSJDOX(1),U,11))
"RTN","PSJDOSE",78,0)
 . I 'PSJCONT D DOSE^PSSORPH(.PSJDOX,+PSJDD,"U") Q
"RTN","PSJDOSE",79,0)
 . D SELDOSE(1,PSJDD)
"RTN","PSJDOSE",80,0)
 ;
"RTN","PSJDOSE",81,0)
 ;* Can't accept just a numeric value
"RTN","PSJDOSE",82,0)
 I PSJY?.N!(PSJY?.N1".".N) D ENHLP^PSGOEM(53.1,109) G AGAIN
"RTN","PSJDOSE",83,0)
 ;
"RTN","PSJDOSE",84,0)
 ;* Free text
"RTN","PSJDOSE",85,0)
 G:'$$CONT(PSJY) AGAIN
"RTN","PSJDOSE",86,0)
 K PSJDSSEL
"RTN","PSJDOSE",87,0)
 F X=0:0 S X=$O(PSJDOX(X)) Q:'X  S PSJXDOSE=$P(PSJDOX(X),U,PSJPIECE) I PSJY=PSJXDOSE D SELDOSE(X,PSJDD) Q
"RTN","PSJDOSE",88,0)
 I '$D(PSJDSSEL),($G(PSJY)]"") S PSJDSSEL=PSJY_U_+PSJDD_U_1,PSGDO=PSJY,PSJDSUPD=1
"RTN","PSJDOSE",89,0)
 Q
"RTN","PSJDOSE",90,0)
 ;
"RTN","PSJDOSE",91,0)
SELDOSE(X,PSJDD) ;
"RTN","PSJDOSE",92,0)
 S X=PSJDOX(X)
"RTN","PSJDOSE",93,0)
 S PSGDO=$P(X,U,PSJPIECE)
"RTN","PSJDOSE",94,0)
 S:$P(X,U)'=-1 PSJDOSE("DO")=$P(X,U,1,2)
"RTN","PSJDOSE",95,0)
 S PSJDSSEL=$P(X,U,PSJPIECE)_U_PSJDD
"RTN","PSJDOSE",96,0)
 I +$P(X,U,12) S $P(PSJDSSEL,U,3)=$P(X,U,12)_U_1 Q
"RTN","PSJDOSE",97,0)
 S $P(PSJDSSEL,U,3)=$S(PSJPIECE=11:$P(X,U,3),1:1)
"RTN","PSJDOSE",98,0)
 Q
"RTN","PSJDOSE",99,0)
CONT(X) ;Ask if user accepting the dose
"RTN","PSJDOSE",100,0)
 NEW DIR,DIRUT,Y
"RTN","PSJDOSE",101,0)
 W ! K DIR,DIRUT,DUOUT
"RTN","PSJDOSE",102,0)
 S DIR(0)="Y",DIR("A")="You entered "_X_" is this correct",DIR("B")="Yes"
"RTN","PSJDOSE",103,0)
 D ^DIR
"RTN","PSJDOSE",104,0)
 K DUOUT
"RTN","PSJDOSE",105,0)
 Q +Y
"RTN","PSJDOSE",106,0)
 ;
"RTN","PSJDOSE",107,0)
DUPD ;
"RTN","PSJDOSE",108,0)
 NEW PSJX,X
"RTN","PSJDOSE",109,0)
 S PSGUD=1
"RTN","PSJDOSE",110,0)
 W !,"UNITS PER DOSE: "_PSGUD_"// " R X:DTIME W "  ",X I X="^"!'$T S PSGOROE1=1 Q
"RTN","PSJDOSE",111,0)
 S:X="" X=1
"RTN","PSJDOSE",112,0)
 I X="@",'PSGUD W $C(7),"  ??" S X="?" D ENHLP^PSGOEM(53.11,.02) G DUPD
"RTN","PSJDOSE",113,0)
 I X?1."?" D ENHLP^PSGOEM(53.11,.02) G DUPD
"RTN","PSJDOSE",114,0)
 I X?1.2N1"/"1.2N S X=+$J(+X/$P(X,"/",2),0,2) W "  ("_$E("0",X<1)_X_")"
"RTN","PSJDOSE",115,0)
 I $S($L(X)>12:1,X'=+X:1,X>50:1,X<0:1,1:X?.N1"."5.N) W $C(7),"  ??" S X="?" D ENHLP^PSGOEM(53.11,.02) G DUPD
"RTN","PSJDOSE",116,0)
 S $P(PSJDSSEL,U,3)=X
"RTN","PSJDOSE",117,0)
 D SETDUPD(X)
"RTN","PSJDOSE",118,0)
 Q
"RTN","PSJDOSE",119,0)
SETDUPD(X) ;
"RTN","PSJDOSE",120,0)
 S PSGUD=X,X=$S(PSJDSSEL]"":$P(PSJDSSEL,U,2),1:0)
"RTN","PSJDOSE",121,0)
 S PSJX=$O(^PS(53.45,PSJSYSP,2,"B",X,0))
"RTN","PSJDOSE",122,0)
 S PSGUD=+$FN(PSGUD,"",4) S:$E(PSGUD)="." PSGUD="0"_PSGUD
"RTN","PSJDOSE",123,0)
 S $P(^PS(53.45,PSJSYSP,2,+PSJX,0),U,2)=PSGUD
"RTN","PSJDOSE",124,0)
 Q
"RTN","PSJDOSE",125,0)
EDITDD ;Editing DDs
"RTN","PSJDOSE",126,0)
 NEW DA,DR,DIE
"RTN","PSJDOSE",127,0)
 S DIE="^PS(53.45,",DA=PSJSYSP,DR=2,DR(2,53.4502)=".02//1" D ^DIE
"RTN","PSJDOSE",128,0)
 I '$O(^PS(53.45,PSJSYSP,2,0)) W $C(7),!!,"WARNING:      This order must have at least one dispense drug before pharmacy can",!?9,"verify it!"
"RTN","PSJDOSE",129,0)
 Q
"RTN","PSJDOSE",130,0)
DOSECHK ;
"RTN","PSJDOSE",131,0)
 K PSJDSFLG S PSJDSFLG=0
"RTN","PSJDOSE",132,0)
 Q:'$P(PSJSYSU,";",4)
"RTN","PSJDOSE",133,0)
 Q:$G(PSGDO)=""
"RTN","PSJDOSE",134,0)
 NEW PSJX,PSJXDD,PSJCNT S PSJCNT=0
"RTN","PSJDOSE",135,0)
 ;*216 Be sure PSJDT is set
"RTN","PSJDOSE",136,0)
 I '$G(PSJDT) N X,% D NOW^%DTC S PSJDT=X
"RTN","PSJDOSE",137,0)
 F PSJX=0:0 S PSJX=$O(^PS(53.45,PSJSYSP,2,PSJX)) Q:'PSJX  D
"RTN","PSJDOSE",138,0)
 . S PSJXDD=$G(^PS(53.45,PSJSYSP,2,PSJX,0)) Q:PSJXDD=""
"RTN","PSJDOSE",139,0)
 . S:$P(PSJXDD,U,2)="" $P(^PS(53.45,PSJSYSP,2,PSJX,0),U,2)=1
"RTN","PSJDOSE",140,0)
 . ;*216 Don't count inactive Disp. Drug
"RTN","PSJDOSE",141,0)
 . I $P(PSJXDD,U,3)'="",$P(PSJXDD,U,3)'>PSJDT Q
"RTN","PSJDOSE",142,0)
 . S PSJCNT=PSJCNT+1
"RTN","PSJDOSE",143,0)
 D DOSECHK1
"RTN","PSJDOSE",144,0)
 Q
"RTN","PSJDOSE",145,0)
DOSECHK1 ;
"RTN","PSJDOSE",146,0)
 NEW PSJX,PSJXDD,PSJXUNIT,PSJUNIT,PSJXFLG,PSJTOT,PSJDRGDOSE,PSJUNITNM,PSJDRGUD,CNT
"RTN","PSJDOSE",147,0)
 S CNT=0
"RTN","PSJDOSE",148,0)
 ;*216 Be sure PSJDT is set
"RTN","PSJDOSE",149,0)
 I '$G(PSJDT) N X,% D NOW^%DTC S PSJDT=X
"RTN","PSJDOSE",150,0)
 S PSJUNIT=$P(PSGDO,+PSGDO,2,$L(PSGDO,+PSGDO))
"RTN","PSJDOSE",151,0)
 S (PSJDSFLG,PSJXFLG,PSJTOT)=0
"RTN","PSJDOSE",152,0)
 S PSJX=0 F  S PSJX=$O(^PS(53.45,PSJSYSP,2,PSJX)) Q:'PSJX!PSJDSFLG!PSJXFLG  D
"RTN","PSJDOSE",153,0)
 . S PSJXDD=$G(^PS(53.45,PSJSYSP,2,PSJX,0))
"RTN","PSJDOSE",154,0)
 . S PSJXDUP=$S(+$P(PSJXDD,U,2):$P(PSJXDD,U,2),1:1)
"RTN","PSJDOSE",155,0)
 . ;*216 Don't count inactive Disp. Drug
"RTN","PSJDOSE",156,0)
 . I $P(PSJXDD,U,3)'="",$P(PSJXDD,U,3)'>PSJDT Q
"RTN","PSJDOSE",157,0)
 . D DOSE^PSSORPH(.PSJXDOX,+PSJXDD,"U")
"RTN","PSJDOSE",158,0)
 . I $S('$D(PSJXDOX):1,$P(PSJXDOX(1),U)="":1,1:+PSJXDOX(1)=-1) S PSJXFLG=1 Q
"RTN","PSJDOSE",159,0)
 . S PSJXUNIT=""
"RTN","PSJDOSE",160,0)
 . S:PSJUNIT["/" PSJXUNIT=PSJUNIT
"RTN","PSJDOSE",161,0)
 . I PSJUNIT'["/" F X=1:1:$L(PSJUNIT)  I $E(PSJUNIT,X)'?.N&($E(PSJUNIT,X)'?1" ") S PSJXUNIT=PSJXUNIT_$E(PSJUNIT,X)
"RTN","PSJDOSE",162,0)
 . I PSJCNT=1 D ONEDD Q:'PSJDSFLG
"RTN","PSJDOSE",163,0)
 . D BCMAUPD(PSJXDD),DOSE^PSSORPH(.PSJXDOX,+PSJXDD,"U",,PSJXDUP)
"RTN","PSJDOSE",164,0)
 . I PSJCNT=1 D ONEDD Q
"RTN","PSJDOSE",165,0)
 . S PSJTOT=+PSJXDOX(1)+$G(PSJTOT)
"RTN","PSJDOSE",166,0)
 . ;*PSJ*5*264 - Data for POINTTOSURFACE calculation
"RTN","PSJDOSE",167,0)
 . S CNT=CNT+1,PSJDRGDOSE(CNT)=+$P(PSJXDOX(1),U,5),PSJUNITNM(CNT)=$P(PSJXDOX(1),U,2),PSJDRGUD(CNT)=+$P(PSJXDOX(1),U,3)
"RTN","PSJDOSE",168,0)
 I PSJCNT>1,(PSJTOT'=+PSGDO) D
"RTN","PSJDOSE",169,0)
 . N UNITCNT,UNITERR
"RTN","PSJDOSE",170,0)
 . S PSJDSFLG=1
"RTN","PSJDOSE",171,0)
 . F UNITCNT=2:1:CNT I PSJUNITNM(UNITCNT)'=PSJUNITNM(1) S UNITERR=1 Q
"RTN","PSJDOSE",172,0)
 . I '$G(UNITERR),$$PTPLANE(.PSJDRGUD,.PSJDRGDOSE,+PSGDO)'=-1,$$PTPLANE(.PSJDRGUD,.PSJDRGDOSE,+PSGDO)<($$SQRT^XLFMTH(CNT)/100) S PSJDSFLG=0
"RTN","PSJDOSE",173,0)
 Q
"RTN","PSJDOSE",174,0)
ONEDD ;
"RTN","PSJDOSE",175,0)
 NEW X S PSJDSFLG=1
"RTN","PSJDOSE",176,0)
 F X=0:0 S X=$O(PSJXDOX(X)) Q:'X!'PSJDSFLG  D
"RTN","PSJDOSE",177,0)
 . I +PSJXDOX(X)'=+PSGDO,(PSJXUNIT=$P(PSJXDOX(X),U,2)),$S(+PSJXDUP=+$P(PSJXDOX(X),U,3):1,1:PSJXDUP=$P(PSJXDOX(X),U,12)) D  Q:PSJDSFLG
"RTN","PSJDOSE",178,0)
 .. N CHK,DGTS S CHK=+PSGDO/$P(PSJXDOX(X),U,5) S DGTS=$L($P(PSJXDUP,".",2)) S CHK=+$FN(CHK,"",DGTS) I +CHK=+PSJXDUP S PSJDSFLG=0
"RTN","PSJDOSE",179,0)
 . I +PSJXDOX(X)=+PSGDO,$TR($P(PSJXDOX(X),U,11)," ")=$TR(PSGDO," "),$S(+PSJXDUP=+$P(PSJXDOX(X),U,3):1,1:PSJXDUP=$P(PSJXDOX(X),U,12)) S PSJDSFLG=0
"RTN","PSJDOSE",180,0)
 Q
"RTN","PSJDOSE",181,0)
PTPLANE(P,X,C) ;Find the distance from a point to a line/plane
"RTN","PSJDOSE",182,0)
                ;P - array containing coordinates of point
"RTN","PSJDOSE",183,0)
                ;X - array representing normal vector defining the line/plane
"RTN","PSJDOSE",184,0)
                ;C - constant representing point defining the line/plane
"RTN","PSJDOSE",185,0)
 ;*PSJ*5*264 - PTPLANE added
"RTN","PSJDOSE",186,0)
 ;
"RTN","PSJDOSE",187,0)
 N N,CNT,NUM,DEN
"RTN","PSJDOSE",188,0)
 Q:'$D(P)!'$D(X)!'$D(C) -1
"RTN","PSJDOSE",189,0)
 S N=0,CNT=0,NUM=0,DEN=0
"RTN","PSJDOSE",190,0)
 F  S CNT=$O(P(CNT)) Q:'CNT  S N=N+1
"RTN","PSJDOSE",191,0)
 F CNT=1:1:N S NUM=P(CNT)*X(CNT)+NUM
"RTN","PSJDOSE",192,0)
 S NUM=$$ABS^XLFMTH(NUM-C)
"RTN","PSJDOSE",193,0)
 F CNT=1:1:N S DEN=X(CNT)**2+DEN
"RTN","PSJDOSE",194,0)
 S DEN=$$SQRT^XLFMTH(DEN)
"RTN","PSJDOSE",195,0)
 Q $S(DEN=0:-1,1:NUM/DEN)
"RTN","PSJDOSE",196,0)
BCMAUPD(PSJDD) ;
"RTN","PSJDOSE",197,0)
 NEW PSJCNT
"RTN","PSJDOSE",198,0)
 K PSJBCMA
"RTN","PSJDOSE",199,0)
 F X=0:0 S X=$O(PSJXDOX(X)) Q:'X  D
"RTN","PSJDOSE",200,0)
 . Q:'+$P(PSJXDOX(X),U,12)
"RTN","PSJDOSE",201,0)
 . S PSJCNT=+$G(PSJCNT)+1
"RTN","PSJDOSE",202,0)
 . S PSJBCMA(+PSJDD,$P(PSJXDOX(X),U,12),PSJCNT)=$P(PSJXDOX(X),U,1,2)
"RTN","PSJDOSE",203,0)
 Q
"RTN","PSJDOSE",204,0)
DSPWARN ;
"RTN","PSJDOSE",205,0)
 NEW PSJDOSE
"RTN","PSJDOSE",206,0)
 D SETVAR
"RTN","PSJDOSE",207,0)
 W !!,PSJDOSE("WARN"),!,PSJDOSE("WARN1"),!
"RTN","PSJDOSE",208,0)
 D PAUSE^VALM1
"RTN","PSJDOSE",209,0)
 Q
"RTN","PSJEXP")
0^3^B46163170^B44592127
"RTN","PSJEXP",1,0)
PSJEXP ;BIR/CML3,KKA - MEDICATION EXPIRATION NOTICES ;13 FEB 96 / 10:04 AM
"RTN","PSJEXP",2,0)
 ;;5.0;INPATIENT MEDICATIONS ;**111,328**;16 DEC 97;Build 6
"RTN","PSJEXP",3,0)
 ;
"RTN","PSJEXP",4,0)
 ;Reference to ^PS(55 supported by DBIA #2191.
"RTN","PSJEXP",5,0)
 ;
"RTN","PSJEXP",6,0)
 N OUT,PSJNEW,PSGPTMP,PPAGE S PSJNEW=1
"RTN","PSJEXP",7,0)
 D ENCV^PSGSETU I $D(XQUIT) Q
"RTN","PSJEXP",8,0)
 K %DT,DIC S (PSGP,WD,WG)=0,PSGSSH="EXP" S PSGPTMP=0,PPAGE=1 D ^PSGSEL G:"^"[PSGSS DONE D @PSGSS G:+Y'>0 DONE
"RTN","PSJEXP",9,0)
 I PSGSS="W" S PSJSEL("W")=WD D ADMTM^PSJPDIR
"RTN","PSJEXP",10,0)
 I PSGSS="C" S PSJSEL("C")="C"
"RTN","PSJEXP",11,0)
 S %DT="ETX",D="start" D DT G:Y'>0 DONE S (%DT(0),PSGEXPS)=+Y,D="stop" D DT K %DT G:Y'>0 DONE S:'$P(PSGEXPS,".",2) PSGEXPS=PSGEXPS+.0001 S PSGEXPF=Y+$S($P(Y,".",2):0,1:.24)
"RTN","PSJEXP",12,0)
 D LIST^PSJEXP0 G:$D(OUT) DONE
"RTN","PSJEXP",13,0)
 K ZTDTH,ZTSAVE S PSGTIR="ENQ^PSJEXP",ZTDESC="INPATIENT STOP ORDER NOTICES" F X="PSJMSG","WG","WD","PSGP","PSGOP","PSGDT","PSGEXPS","PSGEXPF","PSGSS","CHOICE","PSGPTMP","PPAGE","PSJSEL(" S ZTSAVE(X)=""
"RTN","PSJEXP",14,0)
 D ENDEV^PSGTI I POP!$D(ZTSK) W:POP !?3,"No device selected for report run." G DONE
"RTN","PSJEXP",15,0)
 W:$E(IOST)'="P" !,"...this may take a few minutes...",!?25,"...you really should QUEUE this report, if possible..."
"RTN","PSJEXP",16,0)
ENQ D NOW^%DTC S PSGDT=%,SD=$$EN^PSGCT(PSGEXPS,-1),FD=PSGEXPF F X="PSGEXPS","PSGEXPF" S @X=$$ENDTC^PSGMI(@X)
"RTN","PSJEXP",17,0)
 K ^TMP("PSG",$J) D @("L"_PSGSS),^PSJEXP0
"RTN","PSJEXP",18,0)
DONE D ^%ZISC D ENKV^PSGSETU K %,^TMP("PSG",$J),ADCNT,AM,CHOICE,CNT,D,DFN,DO,DOB,DRG,DRGI,DRGN,DRGT,DTOUT,DUOUT,FD,FSTFLG,GMRAREC,IR,JJ,LNCNT,MR,PSJMSG,ND,ND3,ND4,NF,ON,OPI,PRIMD,P,PSIVUP,PSJORIFN
"RTN","PSJEXP",19,0)
 K PSJACNWP,PSJAD,PSJJORD,PSJPAD,PSJPAGE,PSJPDOB,PSJPDX,PSJPRB,PSJPSEX,PSJPTD,PSJPWD,PSJPWDN,PSJPWT,PSJSEL,PSJSOL,SLS,Y1
"RTN","PSJEXP",20,0)
 K POP,PPN,PR,PSGDT,PSGEXPF,PSGEXPS,PSGOD,PSGP,PSGSS,PSGSSH,PSGTIR,PSEX,PSJOPC,PST,Q,RF,SCH,SD,SD1,SD1IV,SEX,SI,SM,SNDFLG,SOLCNT,SSN,ST,STD,TEAM,TEMPTM,TM,VA,WCNT,WD,WDN,WG,WRD,WS,WT,X,XQUIT,Y
"RTN","PSJEXP",21,0)
 Q
"RTN","PSJEXP",22,0)
LC ;
"RTN","PSJEXP",23,0)
 S STDTE=0 F  S STDTE=$O(^PS(55,"AIVC",STDTE)) Q:'STDTE  S CLINIC=0 F  S CLINIC=$O(^PS(55,"AIVC",STDTE,CLINIC)) Q:'CLINIC  D
"RTN","PSJEXP",24,0)
 . S JDFN=0 F  S JDFN=$O(^PS(55,"AIVC",STDTE,CLINIC,JDFN)) Q:'JDFN  S PSGP=JDFN D LP
"RTN","PSJEXP",25,0)
 S STDTE=0 F  S STDTE=$O(^PS(55,"AUDC",STDTE)) Q:'STDTE  S CLINIC=0 F  S CLINIC=$O(^PS(55,"AUDC",STDTE,CLINIC)) Q:'CLINIC  D
"RTN","PSJEXP",26,0)
 . S JDFN=0 F  S JDFN=$O(^PS(55,"AUDC",STDTE,CLINIC,JDFN)) Q:'JDFN  S PSGP=JDFN D LP
"RTN","PSJEXP",27,0)
 Q
"RTN","PSJEXP",28,0)
 ;
"RTN","PSJEXP",29,0)
LG F WD=0:0 S WD=$O(^PS(57.5,"AC",WG,WD)) Q:'WD  D LW
"RTN","PSJEXP",30,0)
 Q
"RTN","PSJEXP",31,0)
LW I $D(^DIC(42,WD,0)),$P(^(0),"^")]"" S WDN=$P(^(0),"^")
"RTN","PSJEXP",32,0)
 E  Q
"RTN","PSJEXP",33,0)
 F PSGP=0:0 S PSGP=$O(^DPT("CN",WDN,PSGP)) Q:'PSGP  D LP
"RTN","PSJEXP",34,0)
 Q
"RTN","PSJEXP",35,0)
LL S CL="" F  S CL=$O(^PS(57.8,"AD",CG,CL)) Q:CL=""  D LC
"RTN","PSJEXP",36,0)
 Q
"RTN","PSJEXP",37,0)
C ;
"RTN","PSJEXP",38,0)
 K DIR S DIR(0)="FAO",DIR("A")="Select CLINIC: "
"RTN","PSJEXP",39,0)
 S DIR("?")="^D CDIC^PSGVBW" W ! D ^DIR
"RTN","PSJEXP",40,0)
CDIC ;
"RTN","PSJEXP",41,0)
 K DIC S DIC="^SC(",DIC(0)="QEMIZ" D ^DIC K DIC S:+Y>0 PSJMSG=Y(0,0),CL=+Y
"RTN","PSJEXP",42,0)
 W:X["?" !!,"Enter the clinic you want to use to select patients for processing.",!
"RTN","PSJEXP",43,0)
 Q
"RTN","PSJEXP",44,0)
L ;
"RTN","PSJEXP",45,0)
 K DIR S DIR(0)="FAO",DIR("A")="Select CLINIC GROUP: "
"RTN","PSJEXP",46,0)
 S DIR("?")="^D LDIC^PSGVBW" W ! D ^DIR
"RTN","PSJEXP",47,0)
LDIC ;
"RTN","PSJEXP",48,0)
 K DIC S DIC="^PS(57.8,",DIC(0)="QEMI" D ^DIC K DIC S:+Y>0 CG=+Y,PSJMSG=$P(Y,"^",2)
"RTN","PSJEXP",49,0)
 W:X["?" !!,"Enter the name of the clinic group you want to use to select patients for processing."
"RTN","PSJEXP",50,0)
 Q
"RTN","PSJEXP",51,0)
LP N PSJACNWP S PSJACNWP=1 D ^PSJAC,ENUNM^PSGOU Q:'$O(^PS(55,PSGP,5,"AUS",SD))
"RTN","PSJEXP",52,0)
 S PPN=$E($P(PSGP(0),"^"),1,12)_"^"_PSGP S:PSJPRB="" PSJPRB="zz"
"RTN","PSJEXP",53,0)
 S TM=$O(PSJSEL("TM","")),TM=$S(TM="":"ZZ",PSJPRB="":"zz",$D(^PS(57.7,+PSJPWD,1,+$O(^PS(57.7,"AWRT",+PSJPWD,PSJPRB,0)),0)):$P(^(0),"^"),1:"zz")
"RTN","PSJEXP",54,0)
 S TEMPTM=$O(^PS(57.7,+PSJPWD,1,"B",TM,0))
"RTN","PSJEXP",55,0)
 Q:$D(PSJSEL("TM"))&('$D(PSJSEL("TM","ALL")))&('$D(PSJSEL("TM",+TEMPTM)))
"RTN","PSJEXP",56,0)
 D:CHOICE'="IV" GS D:CHOICE'="UD" GSIV
"RTN","PSJEXP",57,0)
 Q
"RTN","PSJEXP",58,0)
GS F PST="C","P","R" F SD1=SD:0 S SD1=$O(^PS(55,PSGP,5,"AU",PST,SD1)) Q:'SD1!(SD1>FD)  F PSJJORD=0:0 S PSJJORD=$O(^PS(55,PSGP,5,"AU",PST,SD1,PSJJORD)) Q:'PSJJORD  D
"RTN","PSJEXP",59,0)
 .I $D(^PS(55,PSGP,5,PSJJORD,0)),$P(^(0),U,9)'["D",$P(^(0),U,27)'["R" D
"RTN","PSJEXP",60,0)
 ..I '$D(CL) D ARSET Q
"RTN","PSJEXP",61,0)
 ..I $D(CL),($P($G(^PS(55,PSGP,5,PSJJORD,8)),"^",2)'="") D ARSET Q
"RTN","PSJEXP",62,0)
 I $G(PSJPWDN)="" S PSJPWDN="UNKNOWN"
"RTN","PSJEXP",63,0)
 I $D(^TMP("PSG",$J,$E(TM,1,10),$E(PSJPWDN,1,10),$E(PSJPRB,1,12),PPN)) S ^(PPN)=TM_"^"_PSJPWDN_"^"_PSJPRB_"^"_$P(PSGP(0),"^")_"^"_$P(PSJPSEX,"^",2)_"^"_$P(PSJPDOB,"^",2)_";"_PSJPAGE_"^"_VA("PID")_"^"_PSJPDX_"^"_PSJPWT
"RTN","PSJEXP",64,0)
 ;naked reference below refers to the full global references to ^TMP on the line above
"RTN","PSJEXP",65,0)
 I  S ^(PPN)=^(PPN)_"^"_$P(PSJPAD,"^",2)_"^"_$P(PSJPTD,"^",2)
"RTN","PSJEXP",66,0)
 Q
"RTN","PSJEXP",67,0)
GSIV S PST="C"
"RTN","PSJEXP",68,0)
 S SD1IV=SD F  S SD1IV=$O(^PS(55,PSGP,"IV","AIS",SD1IV)) Q:'SD1IV!(SD1IV>FD)  F PSJJORD=0:0 S PSJJORD=$O(^PS(55,PSGP,"IV","AIS",SD1IV,PSJJORD)) Q:'PSJJORD  D
"RTN","PSJEXP",69,0)
 .I $D(^PS(55,PSGP,"IV",PSJJORD,0)),$P(^(0),U,17)'["D",$P(^PS(55,PSGP,"IV",PSJJORD,2),U,9)'["R" D
"RTN","PSJEXP",70,0)
 ..I '$D(CL) D ARSETIV Q
"RTN","PSJEXP",71,0)
 ..I $D(CL),($P($G(^PS(55,PSGP,"IV",PSJJORD,"DSS")),"^",2)'="") D ARSETIV Q
"RTN","PSJEXP",72,0)
  I $D(^TMP("PSG",$J,$E(TM,1,10),$E(PSJPWDN,1,10),$E(PSJPRB,1,12),PPN)) S ^(PPN)=TM_"^"_PSJPWDN_"^"_PSJPRB_"^"_$P(PSGP(0),"^")_"^"_$P(PSJPSEX,"^",2)_"^"_$P(PSJPDOB,"^",2)_";"_PSJPAGE_"^"_VA("PID")_"^"_PSJPDX_"^"_PSJPWT
"RTN","PSJEXP",73,0)
 ;naked reference below refers to the full global references to ^TMP on the line above
"RTN","PSJEXP",74,0)
 I  S ^(PPN)=^(PPN)_"^"_$P(PSJPAD,"^",2)_"^"_$P(PSJPTD,"^",2)
"RTN","PSJEXP",75,0)
 Q
"RTN","PSJEXP",76,0)
ARSET S ND=$G(^PS(55,PSGP,5,PSJJORD,0)),PR=$P(ND,"^",2),ST=$P(ND,"^",9),MR=$P(ND,"^",3),PR=$$ENNPN^PSGMI(PR)
"RTN","PSJEXP",77,0)
 S MR=$$ENMRN^PSGMI(MR) S X=$$NFWS^PSJUTL1(PSGP,PSJJORD_"U",PSJPWD),SM=$S('$P(X,U,3):0,$P(X,U,4):1,1:2)
"RTN","PSJEXP",78,0)
 S ND=$G(^PS(55,PSGP,5,PSJJORD,2)),DRG=$G(^(.2)),SCH=$P(ND,"^"),STD=$P(ND,"^",2)\1,DO=$P(DRG,"^",2) I DO]"",$E(DO,$L(DO))'=" " S DO=DO_" "
"RTN","PSJEXP",79,0)
 N X,PSG
"RTN","PSJEXP",80,0)
 D DRGDISP^PSJLMUT1(PSGP,PSJJORD_"U",15,0,.PSG,1)
"RTN","PSJEXP",81,0)
 S DRG=PSG(1) I $G(PSJPWDN)="" S PSJPWDN="UNKNOWN"
"RTN","PSJEXP",82,0)
 S ^TMP("PSG",$J,$E(TM,1,10),$E(PSJPWDN,1,10),$E(PSJPRB,1,12),PPN,SD1,PST,$S(DRG'="NOT FOUND":$E(DRG,1,15),1:"zz")_"^"_PSJJORD)=DRG_"^"_STD_"^"_DO_MR_" "_SCH_"^"_ST_"^"_PR_"^^^"_SM Q
"RTN","PSJEXP",83,0)
 ;
"RTN","PSJEXP",84,0)
ARSETIV N X,ON55 S DFN=PSGP,ON=PSJJORD D GT55^PSIVORFB
"RTN","PSJEXP",85,0)
 S DRG=$S($G(DRG("AD",1))]"":$P(DRG("AD",1),U,2),1:$P($G(DRG("SOL",1)),U,2)),STD=P(2)\1,MR=$P(P("MR"),U,2),SCH=P(9),IR=P(8),ST=P(17),PR=$P(P(6),U,2)
"RTN","PSJEXP",86,0)
 I $G(PSJPWDN)="" S PSJPWDN="UNKNOWN"
"RTN","PSJEXP",87,0)
 S ^TMP("PSG",$J,$E(TM,1,10),$E(PSJPWDN,1,10),$E(PSJPRB,1,12),PPN,SD1IV,PST,$S(DRG'="NOT FOUND":$E(DRG,1,15),1:"zz")_"^"_PSJJORD_"V")=DRG_"^"_STD_"^"_MR_" "_SCH_" "_IR_"^"_ST_"^"_PR Q
"RTN","PSJEXP",88,0)
 ;
"RTN","PSJEXP",89,0)
G S DIC="^PS(57.5,",DIC(0)="AEIMQZ" W ! D ^DIC K DIC W ! S:X="^OTHER" PSJMSG="^OTHER",PSGSS="C",Y(0,0)=2,Y=2 S WG=+Y S:+Y>0 PSJMSG=Y(0,0) Q
"RTN","PSJEXP",90,0)
W S DIC="^DIC(42,",DIC(0)="AEIMQZ",DIC("A")="Select WARD: " W ! D ^DIC K DIC S WD=+Y S:+Y>0 PSJMSG=Y(0,0) Q
"RTN","PSJEXP",91,0)
P D ENP^PSGGAO S Y=PSGP S:PSGP>0 PSJMSG=$P(PSGP(0),"^") Q
"RTN","PSJEXP",92,0)
DT S Y=-1 F  W !!,"Enter ",D," date: " R X:DTIME W:'$T $C(7) S:'$T X="^" D DTM:X?1."?",^%DT:"^"'[X I Y>0!("^"[X) W:Y<0 !,"No ",D," date chosen for notices run." Q
"RTN","PSJEXP",93,0)
 Q
"RTN","PSJEXP",94,0)
DTM W !!?2,"Enter the ",D," date of the range of dates to find orders about to expire.",!,"The start date and stop date may be the  same." W:D="stop" "  The stop date may not come before the start date." W ! Q
"RTN","PSJEXP0")
0^4^B28342698^B27798195
"RTN","PSJEXP0",1,0)
PSJEXP0 ;BIR/CML3,KKA - PRINTS MEDICATION EXPIRATION NOTICES ;13 FEB 96 / 10:04 AM
"RTN","PSJEXP0",2,0)
 ;;5.0;INPATIENT MEDICATIONS ;**50,58,328**;16 DEC 97;Build 6
"RTN","PSJEXP0",3,0)
 ;
"RTN","PSJEXP0",4,0)
 ; Reference to ^PS(55 is supported by DBIA# 2191.
"RTN","PSJEXP0",5,0)
 ;
"RTN","PSJEXP0",6,0)
 D NOW^%DTC S PSGDT=%,PSGOD=$$ENDTC^PSGMI(PSGDT) U IO
"RTN","PSJEXP0",7,0)
 I '$D(^TMP("PSG",$J)) D  G DONE
"RTN","PSJEXP0",8,0)
 .W:IO'=(IO(0)!(IOST'["C-"))&($Y) @IOF W !!," AS OF ",PSGOD,!,"NO EXPIRED ORDERS FROM ",PSGEXPS," THROUGH ",PSGEXPF,!,"FOR ",$S(PSGSS="P":"PATIENT",PSGSS="W":"WARD",PSGSS="C":"CLINIC",PSGSS="L":"CLINIC GROUP",1:"WARD GROUP"),": ",PSJMSG,"."
"RTN","PSJEXP0",9,0)
 S PSGPDT=PSGOD,(BLF,LINE,PSSN,Q,TM,WDN,RB,PN)="",PG=0,$P(LINE,"-",81)="" K PSJDLW
"RTN","PSJEXP0",10,0)
 F  S TM=$O(^TMP("PSG",$J,TM)) Q:TM=""!$G(PSJDLW)  F  S WDN=$O(^TMP("PSG",$J,TM,WDN)) Q:WDN=""!$G(PSJDLW)  F  S RB=$O(^TMP("PSG",$J,TM,WDN,RB)) Q:RB=""!$G(PSJDLW)  D STRT1
"RTN","PSJEXP0",11,0)
 S Q=1 D:'$G(PSJDLW) NP
"RTN","PSJEXP0",12,0)
 ;
"RTN","PSJEXP0",13,0)
DONE ;
"RTN","PSJEXP0",14,0)
 W:(IO'=IO(0)!(IOST'["C-"))&($Y) @IOF K AD,BLF,DX,LINE,OPN,PSJORB,OSSN,OTM,OWDN,PAGE,PDOB,PG,PN,PRB,PSD,PSGPDT,PSSN,PST,PTM,PWDN,RCT,Q1,RB,TD,WDRG
"RTN","PSJEXP0",15,0)
 Q
"RTN","PSJEXP0",16,0)
 ;
"RTN","PSJEXP0",17,0)
STRT1 ;
"RTN","PSJEXP0",18,0)
 F  S PN=$O(^TMP("PSG",$J,TM,WDN,RB,PN)) Q:PN=""!$G(PSJDLW)  S ND=^(PN) D INFO F SD=0:0 S SD=$O(^TMP("PSG",$J,TM,WDN,RB,PN,SD)) Q:'SD!$G(PSJDLW)  D PRT
"RTN","PSJEXP0",19,0)
 Q
"RTN","PSJEXP0",20,0)
 ;
"RTN","PSJEXP0",21,0)
PRT ;
"RTN","PSJEXP0",22,0)
 S PSD=$$ENDTC^PSGMI(SD)
"RTN","PSJEXP0",23,0)
 F PST="C","O","OC","P","R" S DRG="" F  S DRG=$O(^TMP("PSG",$J,TM,WDN,RB,PN,SD,PST,DRG)) Q:DRG=""!$G(PSJDLW)  S ND=^(DRG),PSJJORD=$P(DRG,"^",2) D:$Y+6>IOSL NP I '$G(PSJDLW) D:PSJJORD'["V" WREC I PSJJORD["V" S PSJJORD=$P(PSJJORD,"V") D WRECIV
"RTN","PSJEXP0",24,0)
 Q
"RTN","PSJEXP0",25,0)
 ;
"RTN","PSJEXP0",26,0)
INFO ;
"RTN","PSJEXP0",27,0)
 S PSGP=$P(PN,"^",2),PTM=$P(ND,"^"),PWDN=$P(ND,"^",2),PRB=$P(ND,"^",3),PPN=$P(ND,"^",4) S:PPN=PSGP PPN=PPN_";DPT(" F X="PTM","PWDN","PRB" I @X="zz" S @X="*NF*"
"RTN","PSJEXP0",28,0)
 S PSEX=$P(ND,"^",5),PDOB=$P(ND,"^",6),PSSN=$P(ND,"^",7),DX=$P(ND,"^",8),WT=$P(ND,"^",9),AD=$P(ND,"^",10),TD=$P(ND,"^",11),PAGE=$S($P(PDOB,";",2):$P(PDOB,";",2),1:"?"),PDOB=$P(PDOB,";") S:PSEX="" PSEX="*NF*"
"RTN","PSJEXP0",29,0)
 F X="PDOB","AD","TD" S @X=$E(@X,1,8)
"RTN","PSJEXP0",30,0)
 ;
"RTN","PSJEXP0",31,0)
NP ; last line and heading for next page
"RTN","PSJEXP0",32,0)
 G:'BLF HEADER F Q1=$Y:1:(IOSL-4) W !
"RTN","PSJEXP0",33,0)
 W !?5,OPN,?37,OSSN,?51,OWDN,?68,PSJORB Q:Q
"RTN","PSJEXP0",34,0)
 ;
"RTN","PSJEXP0",35,0)
HEADER ;
"RTN","PSJEXP0",36,0)
 I IOST["C-" K DIR S DIR(0)="E" D ^DIR K DIR I $D(DTOUT)!$D(DUOUT) S PSJDLW=1 Q
"RTN","PSJEXP0",37,0)
 S PG=PG+1 W:$Y @IOF W !,"   AS OF: ",PSGPDT,?73-$L(PG),"Page: ",PG,!!!,?20,"THE FOLLOWING MEDICATIONS WILL EXPIRE",!?17,"FROM ",PSGEXPS," THROUGH ",PSGEXPF,!?10,"TO CONTINUE MEDICATIONS, PLEASE REORDER ON VA FORM 10-1158.",!!
"RTN","PSJEXP0",38,0)
 S:$D(PSJSEL("TM")) TEAM=TM D ENTRY^PSJHEAD(PSGP,"",PG,"","")
"RTN","PSJEXP0",39,0)
 ;W !!?1,PPN,?36,"Ward: "_PWDN
"RTN","PSJEXP0",40,0)
 ;W !?7,"PID: "_PSSN,?30,"Weight(kg): "_WT,?61,"Admitted: ",AD
"RTN","PSJEXP0",41,0)
 ;W !?7,"DOB: "_PDOB_"  ("_PAGE_")",?37,"Sex: "_PSEX W:TD ?53,"Last transferred: ",TD
"RTN","PSJEXP0",42,0)
 ;W !?8,"Dx: "_$S(DX]"":DX,1:"*NF*"),?$S($L(PRB)<9:61,1:69-$L(PRB)),"Room-Bed: ",PRB,!?1,"Reactions:" D ENRCT^PSGAPP
"RTN","PSJEXP0",43,0)
 W !!?1,"Medication",?42,"ST",?45,"Start",?52,"Stop",?67,"Status/Info",!?3,"Dosage",?67,"Provider",!,LINE S BLF=1,OPN=PPN,PSJORB=PRB,OSSN=PSSN,OTM=PTM,OWDN=$E(PWDN,1,16) Q
"RTN","PSJEXP0",44,0)
 ;
"RTN","PSJEXP0",45,0)
WREC ; write Unit Dose record here
"RTN","PSJEXP0",46,0)
 N X,PSG
"RTN","PSJEXP0",47,0)
 D DRGDISP^PSJLMUT1(+PSGP,+PSJJORD_"U",39,39,.PSG,0)
"RTN","PSJEXP0",48,0)
 S PSGOD=$$ENDTC^PSGMI($P(ND,"^",2)) W !!?1,PSG(1),?42,PST,?45,$E(PSGOD,1,5)_" "_PSD,?67,$P(ND,"^",4) I $P(ND,"^",8) W ?70,$E("HSM",$P(ND,"^",8),3)
"RTN","PSJEXP0",49,0)
 ;W !?1,PSG(2),?79-$L($P(ND,"^",5)),$P(ND,"^",5)
"RTN","PSJEXP0",50,0)
 N MARX D TXT^PSGMUTL($P(ND,"^",5),24)
"RTN","PSJEXP0",51,0)
 N DLINS,LN S DLINS=$O(PSG(""),-1)
"RTN","PSJEXP0",52,0)
 F LN=2:1:$S(MARX-1>DLINS:MARX,1:DLINS+1)  D
"RTN","PSJEXP0",53,0)
 .W !,$G(PSG(LN)),?55,$G(MARX(LN-1))
"RTN","PSJEXP0",54,0)
 ;N X F X=2:0 S X=$O(PSG(X)) Q:'X  W !?1,PSG(X)
"RTN","PSJEXP0",55,0)
 ;S WCNT=1,SI=$G(^PS(55,PSGP,5,PSJJORD,6)) I SI]"" W ! F  S WRD=$P(SI," ",WCNT) Q:$L(WRD)=0  S WCNT=WCNT+1 W:$X+$L(WRD)>80 ! W " ",WRD
"RTN","PSJEXP0",56,0)
 S SI=$P($G(^PS(55,PSGP,5,PSJJORD,6)),"^") I SI]"" W !?5,"Special Instructions: " F X=1:1:$L(SI," ") S Y=$P(SI," ",X) W:$X+$L(Y)>78 !?28 W Y," "
"RTN","PSJEXP0",57,0)
 Q
"RTN","PSJEXP0",58,0)
WRECIV ; write IV record here
"RTN","PSJEXP0",59,0)
 N DRG,P,ON55,PSG
"RTN","PSJEXP0",60,0)
 S (FSTFLG,SNDFLG,LNCNT)=0
"RTN","PSJEXP0",61,0)
 S PSGOD=$$ENDTC^PSGMI($P(ND,"^",2))
"RTN","PSJEXP0",62,0)
 S DFN=PSGP,ON=+PSJJORD D GT55^PSIVORFB W !
"RTN","PSJEXP0",63,0)
 N X F X=0:0 S X=$O(DRG("AD",X)) Q:'X  D NAME^PSIVUTL(DRG("AD",X),39,.PSG,1) F JJ=0:0 S JJ=$O(PSG(JJ)) Q:'JJ  W !?1,PSG(JJ) S LNCNT=LNCNT+1 D:LNCNT=1 FST D:LNCNT=2 SND
"RTN","PSJEXP0",64,0)
 N X,PSG,JJ F X=0:0 S X=$O(DRG("SOL",X)) Q:'X  D NAME^PSIVUTL(DRG("SOL",X),33,.PSG,0) F JJ=0:0 S JJ=$O(PSG(JJ)) Q:'JJ  W ! W:JJ=1 ?3,"in" W ?6,PSG(JJ) S LNCNT=LNCNT+1 D:LNCNT=1 FST D:LNCNT=2 SND
"RTN","PSJEXP0",65,0)
 W !?1,$P(P("MR"),U,2)_" "_P(9)_" "_P(8) D:'FSTFLG FST I FSTFLG&('SNDFLG) W ! D SND
"RTN","PSJEXP0",66,0)
 S OPI=$P(P("OPI"),"^") I OPI]"" W !?5,"Other Print Info: " F X=1:1:$L(OPI," ") S Y=$P(OPI," ",X) W:$X+$L(Y)>78 !?28 W Y," "
"RTN","PSJEXP0",67,0)
 Q
"RTN","PSJEXP0",68,0)
FST S FSTFLG=1 W ?42,PST,?45,$E(PSGOD,1,5)_" "_PSD,?67,P(17)
"RTN","PSJEXP0",69,0)
 Q
"RTN","PSJEXP0",70,0)
SND S SNDFLG=1 W ?79-$L($P(P(6),U,2)),$P(P(6),U,2) Q
"RTN","PSJEXP0",71,0)
LIST ;**list IV orders, UD orders, or ALL
"RTN","PSJEXP0",72,0)
 K DTOUT,DUOUT,DIR W ! S DIR(0)="SOAM^IV:IV;UD:Unit Dose;A:ALL",DIR("A")="List IV orders, Unit Dose orders, or All orders: ",DIR("B")="ALL",DIR("?")="Please enter a code."
"RTN","PSJEXP0",73,0)
 S DIR("?",1)="Enter ""IV"" to see only IV orders, ""UD"" to see only Unit",DIR("?",2)="Dose orders, or ""A"" to see both IV and Unit Dose orders." D ^DIR K DIR S:$D(DTOUT)!($D(DUOUT)) OUT=1 S CHOICE=Y
"RTN","PSJEXP0",74,0)
 Q
"VER")
8.0^22.0
"BLD",10085,6)
^285
**END**
**END**

