Released PSJ*5*374 SEQ #313
Extracted from mail message
**KIDS**:PSJ*5.0*374^

**INSTALL NAME**
PSJ*5.0*374
"BLD",10745,0)
PSJ*5.0*374^INPATIENT MEDICATIONS^0^3180709^y
"BLD",10745,1,0)
^^2^2^3180709^
"BLD",10745,1,1,0)
Patch reference and additional information may be found on Forum for 
"BLD",10745,1,2,0)
PSJ*5*374.
"BLD",10745,4,0)
^9.64PA^^
"BLD",10745,6.3)
2
"BLD",10745,"KRN",0)
^9.67PA^779.2^20
"BLD",10745,"KRN",.4,0)
.4
"BLD",10745,"KRN",.401,0)
.401
"BLD",10745,"KRN",.402,0)
.402
"BLD",10745,"KRN",.403,0)
.403
"BLD",10745,"KRN",.5,0)
.5
"BLD",10745,"KRN",.84,0)
.84
"BLD",10745,"KRN",3.6,0)
3.6
"BLD",10745,"KRN",3.8,0)
3.8
"BLD",10745,"KRN",9.2,0)
9.2
"BLD",10745,"KRN",9.8,0)
9.8
"BLD",10745,"KRN",9.8,"NM",0)
^9.68A^2^2
"BLD",10745,"KRN",9.8,"NM",1,0)
PSIVORA^^0^B29596441
"BLD",10745,"KRN",9.8,"NM",2,0)
PSIVOPT2^^0^B38512890
"BLD",10745,"KRN",9.8,"NM","B","PSIVOPT2",2)

"BLD",10745,"KRN",9.8,"NM","B","PSIVORA",1)

"BLD",10745,"KRN",19,0)
19
"BLD",10745,"KRN",19.1,0)
19.1
"BLD",10745,"KRN",101,0)
101
"BLD",10745,"KRN",409.61,0)
409.61
"BLD",10745,"KRN",771,0)
771
"BLD",10745,"KRN",779.2,0)
779.2
"BLD",10745,"KRN",870,0)
870
"BLD",10745,"KRN",8989.51,0)
8989.51
"BLD",10745,"KRN",8989.52,0)
8989.52
"BLD",10745,"KRN",8994,0)
8994
"BLD",10745,"KRN","B",.4,.4)

"BLD",10745,"KRN","B",.401,.401)

"BLD",10745,"KRN","B",.402,.402)

"BLD",10745,"KRN","B",.403,.403)

"BLD",10745,"KRN","B",.5,.5)

"BLD",10745,"KRN","B",.84,.84)

"BLD",10745,"KRN","B",3.6,3.6)

"BLD",10745,"KRN","B",3.8,3.8)

"BLD",10745,"KRN","B",9.2,9.2)

"BLD",10745,"KRN","B",9.8,9.8)

"BLD",10745,"KRN","B",19,19)

"BLD",10745,"KRN","B",19.1,19.1)

"BLD",10745,"KRN","B",101,101)

"BLD",10745,"KRN","B",409.61,409.61)

"BLD",10745,"KRN","B",771,771)

"BLD",10745,"KRN","B",779.2,779.2)

"BLD",10745,"KRN","B",870,870)

"BLD",10745,"KRN","B",8989.51,8989.51)

"BLD",10745,"KRN","B",8989.52,8989.52)

"BLD",10745,"KRN","B",8994,8994)

"BLD",10745,"QDEF")
^^^^NO^^^^NO^^NO
"BLD",10745,"QUES",0)
^9.62^^
"BLD",10745,"REQB",0)
^9.611^2^2
"BLD",10745,"REQB",1,0)
PSJ*5.0*287^2
"BLD",10745,"REQB",2,0)
PSJ*5.0*299^2
"BLD",10745,"REQB","B","PSJ*5.0*287",1)

"BLD",10745,"REQB","B","PSJ*5.0*299",2)

"MBREQ")
0
"PKG",221,-1)
1^1
"PKG",221,0)
INPATIENT MEDICATIONS^PSJ^UNIT DOSE AND IVS
"PKG",221,22,0)
^9.49I^1^1
"PKG",221,22,1,0)
5.0^2971215^2981113^1
"PKG",221,22,1,"PAH",1,0)
374^3180709
"PKG",221,22,1,"PAH",1,1,0)
^^2^2^3180709
"PKG",221,22,1,"PAH",1,1,1,0)
Patch reference and additional information may be found on Forum for 
"PKG",221,22,1,"PAH",1,1,2,0)
PSJ*5*374.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
2
"RTN","PSIVOPT2")
0^2^B38512890^B38451894
"RTN","PSIVOPT2",1,0)
PSIVOPT2 ;BIR/PR,MLM-OPTION DRIVER (CONT) ;02 Mar 99 / 9:27 AM
"RTN","PSIVOPT2",2,0)
 ;;5.0;INPATIENT MEDICATIONS ;**23,29,58,110,127,133,135,157,181,258,287,374**;16 DEC 97;Build 2
"RTN","PSIVOPT2",3,0)
 ;
"RTN","PSIVOPT2",4,0)
 ; Reference to ^PS(55 is supported by DBIA# 2191.
"RTN","PSIVOPT2",5,0)
 ; Reference to ^PSSLOCK is supported by DBIA #2789
"RTN","PSIVOPT2",6,0)
 ;
"RTN","PSIVOPT2",7,0)
D ; Discontinue order.
"RTN","PSIVOPT2",8,0)
 D NATURE^PSIVOREN I '$D(P("NAT")) W !,$C(7),"Order Unchanged." S COMQUIT=1 Q
"RTN","PSIVOPT2",9,0)
 ;* 8/2* D EN1^PSJHL2(DFN,"OD",+ON55_"V","ORDER DISCONTINUED"),D1
"RTN","PSIVOPT2",10,0)
 I '$$REQPROV^PSGOEC W !,$C(7),"Order Unchanged." S (COMQUIT,PROVQUIT)=1 Q
"RTN","PSIVOPT2",11,0)
 I 'PSJCOM D
"RTN","PSIVOPT2",12,0)
 .D D1
"RTN","PSIVOPT2",13,0)
 .S PSIVALT=1,PSIVALCK="STOP",PSIVREA="D",ON=ON55 D LOG^PSIVORAL S P(3)=$P($G(^PS(55,DFN,"IV",+ON55,0)),U,3)
"RTN","PSIVOPT2",14,0)
 I PSJCOM N COMFLG S COMFLG=0 D
"RTN","PSIVOPT2",15,0)
 .I ON55'["P" N COMFLG,O,OO S (COMFLG,O)=0,OO="" F  S O=$O(^PS(55,"ACX",PSJCOM,O)) Q:'O  F  S OO=$O(^PS(55,"ACX",PSJCOM,O,OO)) Q:OO=""  Q:COMFLG  D
"RTN","PSIVOPT2",16,0)
 .. Q:OO=ON55  I '$$LS^PSSLOCK(DFN,OO) S COMFLG=1 Q
"RTN","PSIVOPT2",17,0)
 I PSJCOM Q:COMFLG  N O,OO S O=0,OO="" F  S O=$O(^PS(55,"ACX",PSJCOM,O)) Q:'O  F  S OO=$O(^PS(55,"ACX",PSJCOM,O,OO)) Q:OO=""  D
"RTN","PSIVOPT2",18,0)
 .I OO["V" S ON55=OO D D1 S PSIVALT=1,PSIVALCK="STOP",PSIVREA="D",ON=ON55 D LOG^PSIVORAL N PSJORD S P(3)=$P($G(^PS(55,DFN,"IV",+ON55,0)),U,3),PSJORD=ON55 D HL^PSIVORA Q
"RTN","PSIVOPT2",19,0)
 .I OO["U" N PSGORD,PSJORD,PSJNOO K DA D NOW^%DTC S PSGDT=%,T=$E("T",'PSJSYSU),PSGALR=20,PSGP=DFN,DA=+OO,DA(1)=PSGP,(PSGORD,PSJORD)=OO,PSJNOO=P("NAT") D
"RTN","PSIVOPT2",20,0)
 ..S CF=$S($P(PSJSYSP0,U,5):1,PSGORD["U":0,1:($P($G(^PS(53.1,+PSGORD,0)),U,25)=""&($P($G(^(4)),U,7)=DUZ)))  D ASET^PSGOEC,AC^PSGOEC
"RTN","PSIVOPT2",21,0)
 Q
"RTN","PSIVOPT2",22,0)
D1 N %,DA,DIE,DIU,STP,NSTOP
"RTN","PSIVOPT2",23,0)
 S NSTOP=$$DATE^PSJUTL2(),STP=$P($G(^PS(55,DFN,"IV",+ON55,0)),U,3),NSTOP=+$S(STP>NSTOP:NSTOP,1:STP),P(17)="D"
"RTN","PSIVOPT2",24,0)
 K TMP
"RTN","PSIVOPT2",25,0)
 S TMP(55.01,""_+ON55_","_DFN_","_"",109)=NSTOP
"RTN","PSIVOPT2",26,0)
 S:'$P($G(^PS(55,DFN,"IV",+ON55,2)),U,7) TMP(55.01,""_+ON55_","_DFN_","_"",116)=STP
"RTN","PSIVOPT2",27,0)
 S TMP(55.01,""_+ON55_","_DFN_","_"",100)="D"
"RTN","PSIVOPT2",28,0)
 S TMP(55.01,""_+ON55_","_DFN_","_"",157)=""
"RTN","PSIVOPT2",29,0)
 S TMP(55.01,""_+ON55_","_DFN_","_"",.03)=NSTOP
"RTN","PSIVOPT2",30,0)
 S PSIVACT=1
"RTN","PSIVOPT2",31,0)
 D FILE^DIE("","TMP")
"RTN","PSIVOPT2",32,0)
 K TMP
"RTN","PSIVOPT2",33,0)
 I $S($G(PSIVAC)="OD":0,$G(PSIVAC)'="AD":1,$G(PSGALO)<1060:0,1:$P($G(PSJSYSW0),U,15)) S X=$S($G(PSIVAC)="AD":1,1:2) D ENLBL^PSIVOPT(X,$S(X=1:+$G(PSGUOW),1:DUZ),DFN,3,+ON55,$E("AD",1,3-X))
"RTN","PSIVOPT2",34,0)
 D:'$D(PSJIVORF) ORPARM^PSIVOREN Q:'PSJIVORF  ;* S ORIFN=$P($G(^PS(55,DFN,"IV",+ON55,0)),U,21) Q:'ORIFN
"RTN","PSIVOPT2",35,0)
 Q
"RTN","PSIVOPT2",36,0)
 ;
"RTN","PSIVOPT2",37,0)
R ; Renew order.
"RTN","PSIVOPT2",38,0)
 ;I PSJCOM D RIV^PSJCOMR Q
"RTN","PSIVOPT2",39,0)
 I PSJCOM D ^PSJCOMR Q
"RTN","PSIVOPT2",40,0)
 I P(17)="D",P(12) N ERR D RI W:$G(ERR)=1 $C(7),"  Order unchanged." I $G(ERR)<2 S COMQUIT=1 Q
"RTN","PSIVOPT2",41,0)
 I $G(PSGORQF) S COMQUIT=1 Q
"RTN","PSIVOPT2",42,0)
 ;PSJOCFLG is killed of after the OC is performed.  The Dosing is still need to trigger(again) if the 
"RTN","PSIVOPT2",43,0)
 ;  user said "no" at OK prompt and a new stop date is entered.
"RTN","PSIVOPT2",44,0)
 NEW PSJOCFLG S PSJOCFLG=1
"RTN","PSIVOPT2",45,0)
 ;
"RTN","PSIVOPT2",46,0)
R1 ;
"RTN","PSIVOPT2",47,0)
 I $$EXPIRED^PSGOER(DFN,ON55) D  Q
"RTN","PSIVOPT2",48,0)
 .W !?3,"  THIS ORDER HAS BEEN INACTIVE FOR ONE OR MORE SCHEDULED ADMINISTRATIONS"
"RTN","PSIVOPT2",49,0)
 .W !?20,"  AND CANNOT BE RENEWED!"
"RTN","PSIVOPT2",50,0)
 ;*287 - Prevent renewal if schedule invalid
"RTN","PSIVOPT2",51,0)
 I $G(P(9))]"",'$$DOW^PSIVUTL(P(9)),'$$PRNOK^PSGS0(P(9)) I '$D(^PS(51.1,"AC","PSJ",P(9))) D  Q
"RTN","PSIVOPT2",52,0)
 . W !!?3,"This order contains an invalid schedule and CANNOT be renewed!" D PAUSE^VALM1
"RTN","PSIVOPT2",53,0)
 I '$G(PSGDT) D NOW^%DTC S PSGDT=+$E(%,1,12)  ;*258 - Set PSGDT
"RTN","PSIVOPT2",54,0)
 N PSJRNWDT,PSJOSTOP,OREASON S PSJRNWDT=$$DATE2^PSJUTL2(PSGDT) S:$G(ON55) PSJOSTOP=$P($G(^PS(55,DFN,"IV",+ON55,0)),U,3) I '(PSJOSTOP>P(2)),$G(PSGDT) S PSJOSTOP=PSGDT
"RTN","PSIVOPT2",55,0)
 S (PSIVOK,EDIT)="25^1" S P2=P(2),P(2)=PSJRNWDT D EDIT^PSIVEDT S P(2)=P2 K P2 I X="^" Q
"RTN","PSIVOPT2",56,0)
 NEW PSGORQF K PSGORQF S PSIVRNFG=1 D:$G(PSJOCFLG) OC^PSIVOC K PSJOCFLG D:'$G(PSGORQF) IN^PSJOCDS($G(ON55),"IV","") K PSIVRNFG W ! Q:$G(PSGORQF)
"RTN","PSIVOPT2",57,0)
 S P(11)=$$ENRNAT^PSGOU($P($G(^PS(55,DFN,"IV",+ON55,2)),U,10),+VAIN(4),P(9),P(11))
"RTN","PSIVOPT2",58,0)
 D OK G:X["N" R1 I X=U D RD Q
"RTN","PSIVOPT2",59,0)
 S PSIVCHG=2
"RTN","PSIVOPT2",60,0)
 S P(17)="A",OREASON=P("RES"),P("RES")="R",P("FRES")="" D:'$D(PSJIVORF) ORPARM^PSIVOREN I PSJIVORF D  Q:'$D(P("NAT"))
"RTN","PSIVOPT2",61,0)
 .D NATURE^PSIVOREN I '$D(P("NAT")) D RD Q
"RTN","PSIVOPT2",62,0)
 .S ON=ON55
"RTN","PSIVOPT2",63,0)
 S P(16)="",PSJORIFN="",PSIVACT=1,P("21FLG")="",P("RES")=OREASON D SET55^PSIVORFB
"RTN","PSIVOPT2",64,0)
 D:$P(^PS(55,DFN,"IV",+ON55,0),U,17)="A" RUPDATE^PSIVOREN(DFN,ON55,P(2))
"RTN","PSIVOPT2",65,0)
 I PSJIVORF,$P(^PS(55,DFN,"IV",+ON55,0),U,17)'="A" S X=$$LS^PSSLOCK(DFN,+ON55_"V") D
"RTN","PSIVOPT2",66,0)
 .D EXPOE^PSGOER(DFN,ON55)
"RTN","PSIVOPT2",67,0)
 .S P("RES")="R",PSJREN=1
"RTN","PSIVOPT2",68,0)
 .D ENUDTX^PSJOREN(DFN,ON55,"NR"),EN1^PSJHL2(DFN,"SN",+ON55_"V","ORDER RENEWED"),UPDREN(DFN,ON55,PSJRNWDT,P(6),PSJOSTOP,P("NAT"))
"RTN","PSIVOPT2",69,0)
 S OD=P(2)
"RTN","PSIVOPT2",70,0)
 D VF1^PSJLIACT("","",1),UNL^PSSLOCK(DFN,+ON55_"V")
"RTN","PSIVOPT2",71,0)
 D ENLBL^PSIVOPT(2,DUZ,DFN,3,+ON55,"R")
"RTN","PSIVOPT2",72,0)
 I $G(PSJOSTOP),$G(ON55),$G(DFN) D STIX^PSIVOREN(PSJOSTOP,ON55,DFN)
"RTN","PSIVOPT2",73,0)
 Q
"RTN","PSIVOPT2",74,0)
 ;
"RTN","PSIVOPT2",75,0)
RD ; Delete for renew.
"RTN","PSIVOPT2",76,0)
 ;Q:'$G(PSJVFY)
"RTN","PSIVOPT2",77,0)
 ;D DEL55^PSIVORE2 S (ON55,P("OLDON"))=P("PON") D GT55^PSIVORFB
"RTN","PSIVOPT2",78,0)
 Q
"RTN","PSIVOPT2",79,0)
 ;
"RTN","PSIVOPT2",80,0)
OK ;Print example label, run order through checker, ask if it is ok.
"RTN","PSIVOPT2",81,0)
 S P16=0,PSIVEXAM=1,(PSIVNOL,PSIVCT)=1 D GTOT^PSIVUTL(P(4)) I ($G(P("PD"))="") D GTPD^PSIVORE2
"RTN","PSIVOPT2",82,0)
 D ^PSIVCHK I $D(DUOUT) S X="^",COMQUIT=1 Q
"RTN","PSIVOPT2",83,0)
 I ERR=1 S X="N",COMQUIT=1 Q
"RTN","PSIVOPT2",84,0)
 W ! D ^PSIVORLB K PSIVEXAM S Y=P(2) W !,"Start date: " X ^DD("DD") W $P(Y,"@")," ",$P(Y,"@",2),?30," Stop date: " S Y=P(3) X ^DD("DD") W $P(Y,"@")," ",$P(Y,"@",2),!
"RTN","PSIVOPT2",85,0)
 ;PSJ*5*157 EFD FOR IV
"RTN","PSIVOPT2",86,0)
 D EFDIV^PSJUTL($G(ZZND))
"RTN","PSIVOPT2",87,0)
 I $G(PSIVCHG),($G(PSIVREA)'="R") W !,"*** This change will cause a new order to be created. ***"
"RTN","PSIVOPT2",88,0)
 S X="Is this O.K.: ^"_$S(ERR:"N",1:"Y")_"^^NO"_$S(ERR'=1:",YES",1:"") D ENQ^PSIV I X["?" S HELP="OK" D ^PSIVHLP G OK
"RTN","PSIVOPT2",89,0)
 Q
"RTN","PSIVOPT2",90,0)
 ;
"RTN","PSIVOPT2",91,0)
RI ; Reinstate Auto-DC'ed order.
"RTN","PSIVOPT2",92,0)
 N DA,DIE,DIR,DIU,DR,PSIVACT,PSIVALT,PSIVALCK,PSIVREA W !!,$C(7),"This order has been Auto-DC'ed."
"RTN","PSIVOPT2",93,0)
 S DIR(0)="Y",DIR("A")="Reinstate this order" D ^DIR K DIR I 'Y S ERR=1 Q
"RTN","PSIVOPT2",94,0)
 D NOW^%DTC I %>$P($G(^PS(55,DFN,"IV",+ON55,2)),U,7) D
"RTN","PSIVOPT2",95,0)
 .K DIR S ERR=1,DIR(0)="Y",DIR("A",1)="The original stop date of this order has past.",DIR("A")="Do you wish to renew this order" D ^DIR K DIR S ERR=$S(Y:2,1:1)
"RTN","PSIVOPT2",96,0)
 Q:$G(ERR)  S X=$G(^VA(200,+P(6),"PS")) I $S('X:1,'$P(X,U,4):0,DT<$P(X,U,4):0,1:1) S ERR=1
"RTN","PSIVOPT2",97,0)
 I $G(ERR) W !!,$C(7),"This order's provider is no longer valid. Please enter a valid provider." S (EDIT,PSIVOK)=1 D EDIT^PSIVEDT I $G(DONE) W $C(7),"Order unchanged." S ERR=1 Q
"RTN","PSIVOPT2",98,0)
 N PSGALO S PSGALO=18530 D ENARI^PSIVOPT(DFN,ON,DUZ,PSGALO)
"RTN","PSIVOPT2",99,0)
 Q
"RTN","PSIVOPT2",100,0)
 ;
"RTN","PSIVOPT2",101,0)
UPDREN(DFN,ORD,RNWDT,PROV,OSTOPDT,PSJNOO) ;
"RTN","PSIVOPT2",102,0)
 Q:'DFN!'ORD!'RNWDT!'PROV!'OSTOPDT!(PSJNOO="")
"RTN","PSIVOPT2",103,0)
 ;*PSJ*5*258
"RTN","PSIVOPT2",104,0)
 N DR,DA,DIC,DIE,DD,DO,ND0,PSGOEORD,DINUM
"RTN","PSIVOPT2",105,0)
 S DIC="^PS(55,"_DFN_",""IV"","_+ORD S ND0=$G(@(DIC_",0)")),PSGOEORD=$P(ND0,"^",21) I $G(ON)["P",$G(PSGOLDOE) S PSGOEORD=PSGOLDOE
"RTN","PSIVOPT2",106,0)
 S DIC=DIC_",14,",DIC(0)="L",DIC("P")="55.1138DA",ND14=$G(@(DIC_"0)")),DINUM=$P(ND14,"^",3)+1,DA(2)=DFN,DA(1)=+ORD D
"RTN","PSIVOPT2",107,0)
 .S DIC("DR")=".01////"_$G(RNWDT)_";1////"_$G(DUZ)_";2////"_$G(PROV)_";3////"_$G(OSTOPDT)_";4////"_+PSGOEORD,X=$G(RNWDT) D FILE^DICN
"RTN","PSIVOPT2",108,0)
 Q
"RTN","PSIVORA")
0^1^B29596441^B29175721
"RTN","PSIVORA",1,0)
PSIVORA ;BIR/MLM-MAIN DRIVER FOR IV FLUIDS - OE/RR INTERFACE ;08 JAN 97 / 2:47 PM
"RTN","PSIVORA",2,0)
 ;;5.0;INPATIENT MEDICATIONS ;**29,41,110,134,299,374**;16 DEC 97;Build 2
"RTN","PSIVORA",3,0)
 ;
"RTN","PSIVORA",4,0)
 ; Reference to ^PS(55 is supported by DBIA 2191
"RTN","PSIVORA",5,0)
 ;
"RTN","PSIVORA",6,0)
EN ; Entry point called by IV Fluid protocol.
"RTN","PSIVORA",7,0)
 S X=ORACTION,PSIVAC="O"_$S(X=0:"N",X=1:"E",X=2:"R",X=4:"H",X=6:"D",X="8":"S",1:"") S:X'=5&(X'=7) PSIVUP=+$$GTPCI^PSIVUTL
"RTN","PSIVORA",8,0)
 S (PSGP,DFN)=+ORVP,PSJACNWP=1 D ^PSJAC I "578"[ORACTION D @ORACTION,DONE^PSIVORA1 Q
"RTN","PSIVORA",9,0)
 D ENCPP^PSIVOREN Q:'PSJIVORF!('PSJORF)  D EN1,DONE^PSIVORA1
"RTN","PSIVORA",10,0)
 Q
"RTN","PSIVORA",11,0)
 ;
"RTN","PSIVORA",12,0)
EN1 ; Take action on existing order.
"RTN","PSIVORA",13,0)
 S PSJORD=$G(ORPK) I ORGY>8 D @ORGY Q
"RTN","PSIVORA",14,0)
 I 'ORACTION D ^PSIVORFE Q
"RTN","PSIVORA",15,0)
 I '$G(ORPK) W !,"INSUFFICIENT INFORMATION, CANNOT CONTINUE." S OREND=1 Q
"RTN","PSIVORA",16,0)
 I ORPK["V",($P($G(^PS(55,DFN,"IV",+ORPK,0)),U,17)="O") D ONCALL^PSIVORV1 Q
"RTN","PSIVORA",17,0)
 I ORACTION<3 S P("FRES")=$S(ORPK["V":$P($G(^PS(55,DFN,"IV",+ORPK,2)),U,9),1:$P($G(^PS(53.1,+ORPK,0)),U,27)) I P("FRES")]"" D @$S(P("FRES")="R":"ALLREN^PSIVORV1",1:"ALLED^PSIVORV1") Q
"RTN","PSIVORA",18,0)
 S PSJORSTS=ORSTS,PSJORIFN=ORIFN L +@$S(PSJORD["V":"^PS(55,DFN,""IV"",+PSJORD)",1:"^PS(53.1,+PSJORD)"):1 E  D LOCKERR^PSIVORA1 Q
"RTN","PSIVORA",19,0)
 D @ORACTION L -@$S(PSJORD["V":"^PS(55,DFN,""IV"",+PSJORD)",1:"^PS(53.1,+PSJORD)")
"RTN","PSIVORA",20,0)
 Q
"RTN","PSIVORA",21,0)
 ;
"RTN","PSIVORA",22,0)
1 ; Edit an existing order.
"RTN","PSIVORA",23,0)
 D EDIT^PSIVORA1
"RTN","PSIVORA",24,0)
 Q
"RTN","PSIVORA",25,0)
 ;
"RTN","PSIVORA",26,0)
2 ; Renew
"RTN","PSIVORA",27,0)
 D RENEW^PSIVORA1
"RTN","PSIVORA",28,0)
 Q
"RTN","PSIVORA",29,0)
 ;
"RTN","PSIVORA",30,0)
3 ; Flag
"RTN","PSIVORA",31,0)
 Q
"RTN","PSIVORA",32,0)
 ;
"RTN","PSIVORA",33,0)
4 ; Hold
"RTN","PSIVORA",34,0)
 I ORSTS'=3,ORSTS'=6 W !,$C(7),"Only ACTIVE orders may be placed on HOLD." S OREND=1 Q
"RTN","PSIVORA",35,0)
 S PSIVREA=$S(ORSTS=6:"H",1:"U"),ON55=PSJORD,$P(^PS(55,DFN,"IV",+ON55,0),U,10)=$S(PSIVREA="H":1,1:""),Y=$G(^PS(55,DFN,"IV",+ON55,0)),P(3)=$P(Y,U,3),P(17)=$P(Y,U,17)
"RTN","PSIVORA",36,0)
 D NOW^%DTC I ORSTS=3,P(3)<% S P(17)="E" D UPSTAT^PSIVOPT S ORSTS=7 W $C(7),"  This order has expired." Q
"RTN","PSIVORA",37,0)
 S XED=0,PSIVALT=2,P(17)=$S(PSIVREA="H":"H",1:"A") D UPSTAT^PSIVOPT,LOG^PSIVORAL S ORSTS=$S(PSIVREA="H":3,1:6)
"RTN","PSIVORA",38,0)
 Q
"RTN","PSIVORA",39,0)
 ;
"RTN","PSIVORA",40,0)
5 ; Event
"RTN","PSIVORA",41,0)
 N DA,DIE,DR,ON,P,PSIVACT,X
"RTN","PSIVORA",42,0)
 S ON=ORPK I ON["V" S X=$G(^PS(55,+ORVP,"IV",+ON,0)),P(3)=$P(X,U,3),P(17)=$P(X,U,17)
"RTN","PSIVORA",43,0)
 I ON'["V" S P(3)=$P($G(^PS(53.1,+ON,2)),U,4),P(17)=$P($G(^PS(53.1,+ON,0)),U,9)
"RTN","PSIVORA",44,0)
 Q:"AR"'[P(17)  D NOW^%DTC Q:P(3)>%
"RTN","PSIVORA",45,0)
 I ON["V" S DR="100///E",DIE="^PS(55,"_+ORVP_",""IV"",",DA(1)=+ORVP
"RTN","PSIVORA",46,0)
 I ON'["V" S DR="28///E",DIE="^PS(53.1,"
"RTN","PSIVORA",47,0)
 S PSIVACT=1,DA=+ON D ^DIE S ORSTS=7
"RTN","PSIVORA",48,0)
 Q
"RTN","PSIVORA",49,0)
 ;
"RTN","PSIVORA",50,0)
6 ; Cancel - Delete pending or unreleased orders from Nonverified orders
"RTN","PSIVORA",51,0)
 ; (53.1) and Orders (100) files.
"RTN","PSIVORA",52,0)
 I ORSTS=1 W $C(7),!,"This order has already been DISCONTINUED." Q
"RTN","PSIVORA",53,0)
 I ORSTS=7 W $C(7),!,"Expired orders cannot be DISCONTINUED." Q
"RTN","PSIVORA",54,0)
 I PSJORD'["V",ORSTS=11 D  Q
"RTN","PSIVORA",55,0)
 .S P("OLDON")=$P($G(^PS(53.1,+PSJORD,0)),U,25) I P("OLDON")  D
"RTN","PSIVORA",56,0)
 ..I P("OLDON")["V",$D(^PS(55,DFN,"IV",+P("OLDON"),2)) S PSJRES=$P(^(2),U,9) S:PSJRES'="R" $P(^(2),U,6)="",$P(^(2),U,9)="" ;; D:PSJRES="R" ENBKOUT^PSJOREN(DFN,PSJORD)
"RTN","PSIVORA",57,0)
 ..I P("OLDON")'["V",$D(^PS(53.1,+P("OLDON"),0)) S PSJRES=$P(^(0),U,27) S:PSJRES'="R" $P(^(0),U,26,27)="^" I PSJRES="R" ;; D ENBKOUT^PSJOREN(DFN,PSJORD)
"RTN","PSIVORA",58,0)
 .K DA,DIK S DIK="^PS(53.1,",DA=+PSJORD D ^DIK S PSGP=DFN,X="P" D ENSK^PSGAXR K DA,DIK S ORIFN=PSJORIFN,ORSTS="K" Q
"RTN","PSIVORA",59,0)
 ;
"RTN","PSIVORA",60,0)
DC ; DC order from Pharmacy complete function.
"RTN","PSIVORA",61,0)
 N PROVQUIT S PROVQUIT=0
"RTN","PSIVORA",62,0)
 I PSJORD["V",'PSJCOM N PSIVREA S ON55=PSJORD,X=$G(^PS(55,DFN,"IV",+ON55,0)),P(3)=$P(X,U,3),P(17)=$P(X,U,17),PSIVREA="D",PSIVALT=2,PSIVALCK="STOP" D D^PSIVOPT2 D:'PROVQUIT HL Q
"RTN","PSIVORA",63,0)
 I PSJORD["V",PSJCOM N PSIVREA S ON55=PSJORD,X=$G(^PS(55,DFN,"IV",+ON55,0)),P(3)=$P(X,U,3),P(17)=$P(X,U,17),PSIVREA="D",PSIVALT=2,PSIVALCK="STOP" D D^PSIVOPT2 Q
"RTN","PSIVORA",64,0)
 N DA,DR,DIE,PSJND S DA=+PSJORD,PSJND=$G(^PS(53.1,DA,0)),P("OLDON")=$P(PSJND,U,25),DIE="^PS(53.1,",DR="28///"_$S($P(PSJND,U,27)="E":"DE",1:"D") D ^DIE
"RTN","PSIVORA",65,0)
 D KILL531^PSJIMO1(DFN,"",+PSJORD)
"RTN","PSIVORA",66,0)
 D HL
"RTN","PSIVORA",67,0)
 Q
"RTN","PSIVORA",68,0)
HL ;
"RTN","PSIVORA",69,0)
 Q:'$D(P("NAT"))
"RTN","PSIVORA",70,0)
 NEW PSJCD,PSJTX,PSJOTMP
"RTN","PSIVORA",71,0)
 I PSJORD["P" N PSJNOO S PSJCD="OC",PSJTX="ORDER CANCELED",PSJNOO=$G(P("NAT"))
"RTN","PSIVORA",72,0)
 E  S PSJCD="OD",PSJTX="ORDER DISCONTINUED"
"RTN","PSIVORA",73,0)
 S PSJOTMP=$G(P("OT")) S P("OT")="F" D EN1^PSJHL2(DFN,PSJCD,PSJORD,PSJTX)
"RTN","PSIVORA",74,0)
 Q
"RTN","PSIVORA",75,0)
 ;
"RTN","PSIVORA",76,0)
7 ; Purge
"RTN","PSIVORA",77,0)
 N ND S ND=$S(ORPK["V":$P($G(^PS(55,+ORVP,"IV",+ORPK,0)),U,17)_U_$P($G(^(0)),U,3),1:$P($G(^PS(53.1,+ORPK,0)),U,9)_U_$P($G(^(2)),U,4))
"RTN","PSIVORA",78,0)
 Q:"DE"'[$P(ND,U)  S X1=+$P(ND,U,2),X2=30 D C^%DTC S ND=X D NOW^%DTC Q:ND>%
"RTN","PSIVORA",79,0)
 I ORPK["V",$D(^PS(55,+ORVP,"IV",+ORPK,0)) S $P(^(0),U,21)=""
"RTN","PSIVORA",80,0)
 I ORPK'["V",$D(^PS(53.1,+ORPK,0)) S $P(^(0),U,21)=""
"RTN","PSIVORA",81,0)
 S ORSTS="K"
"RTN","PSIVORA",82,0)
 Q
"RTN","PSIVORA",83,0)
 ;
"RTN","PSIVORA",84,0)
8 ; Print
"RTN","PSIVORA",85,0)
 K DIR S DIR(0)="E" D ^DIR K DIR I $D(DUOUT)!'($D(ORPK)) S OREND=1 Q
"RTN","PSIVORA",86,0)
 S:'$G(PSIVUP) PSIVUP=+$$GTPCI^PSIVUTL S:'$D(PSIVAC) PSIVAC="OS" S (ON,ON55)=ORPK,DFN=+ORVP D @$S(ON["V":"GT55^PSIVORFB",1:"GT531^PSIVORFA("_DFN_","""_ON_""")"),ENDT^PSIVORV1
"RTN","PSIVORA",87,0)
 Q
"RTN","PSIVORA",88,0)
 ;
"RTN","PSIVORA",89,0)
9 ; Release order (status=incomplete in 53.1, pending in 100)
"RTN","PSIVORA",90,0)
 S X=ORACTION I X=4!(X=6) D @ORACTION Q
"RTN","PSIVORA",91,0)
 Q:"36"[ORSTS  N ON,PSJORIFN S PSJORIFN=ORIFN,ON=ORPK L +^PS(53.1,+ON):1 E  D LOCKERR^PSIVORA1 Q
"RTN","PSIVORA",92,0)
 S Y=$G(^PS(53.1,+ON,0)),P("RES")=$P(Y,U,24),P("OLDON")=$P(Y,U,25)
"RTN","PSIVORA",93,0)
 N DA,DIE,DR,OREND S DR="28////P",DIE="^PS(53.1,",DA=+ON D ^DIE
"RTN","PSIVORA",94,0)
 I P("OLDON")]"" K DA,DIE,DR S DA=P("OLDON") D
"RTN","PSIVORA",95,0)
 .I DA["V" S DA(1)=+ORPV,DIE="^PS(55,"_DA(1)_",""IV"",",DR="114////"_+ON_"P"_";123////"_P("RES")
"RTN","PSIVORA",96,0)
 .E  S DIE="^PS(53.1,",DR="105////"_ON_"P"_";107////"_P("RES") I P("RES")="E",$P($G(^PS(53.1,+P("OLDON"),0)),U,9)="D" S DR=DR_";28////DE"
"RTN","PSIVORA",97,0)
 .S DA=+DA L +@(DIE_DA_")"):1 E  D LOCKERR^PSIVORA1 Q
"RTN","PSIVORA",98,0)
 .D ^DIE L -@(DIE_DA_")")
"RTN","PSIVORA",99,0)
 L -^PS(53.1,+ON) D DONE^PSIVORA1
"RTN","PSIVORA",100,0)
 Q
"RTN","PSIVORA",101,0)
 ;
"RTN","PSIVORA",102,0)
10 ; Verify
"RTN","PSIVORA",103,0)
 Q
"VER")
8.0^22.2
"BLD",10745,6)
^313
**END**
**END**

