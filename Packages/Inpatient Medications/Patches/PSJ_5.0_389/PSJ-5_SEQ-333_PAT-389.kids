Released PSJ*5*389 SEQ #333
Extracted from mail message
**KIDS**:PSJ*5.0*389^

**INSTALL NAME**
PSJ*5.0*389
"BLD",11145,0)
PSJ*5.0*389^INPATIENT MEDICATIONS^0^3190517^y
"BLD",11145,1,0)
^^2^2^3190513^^
"BLD",11145,1,1,0)
The description of this build can be found in the National Patch Module
"BLD",11145,1,2,0)
under PSJ*5*389.
"BLD",11145,4,0)
^9.64PA^^
"BLD",11145,6.3)
4
"BLD",11145,"ABPKG")
n
"BLD",11145,"KRN",0)
^9.67PA^1.5^24
"BLD",11145,"KRN",.4,0)
.4
"BLD",11145,"KRN",.401,0)
.401
"BLD",11145,"KRN",.402,0)
.402
"BLD",11145,"KRN",.403,0)
.403
"BLD",11145,"KRN",.5,0)
.5
"BLD",11145,"KRN",.84,0)
.84
"BLD",11145,"KRN",1.5,0)
1.5
"BLD",11145,"KRN",1.6,0)
1.6
"BLD",11145,"KRN",1.61,0)
1.61
"BLD",11145,"KRN",1.62,0)
1.62
"BLD",11145,"KRN",3.6,0)
3.6
"BLD",11145,"KRN",3.8,0)
3.8
"BLD",11145,"KRN",9.2,0)
9.2
"BLD",11145,"KRN",9.8,0)
9.8
"BLD",11145,"KRN",9.8,"NM",0)
^9.68A^3^3
"BLD",11145,"KRN",9.8,"NM",1,0)
PSJDDUT^^0^B79591153
"BLD",11145,"KRN",9.8,"NM",2,0)
PSJPDAPP^^0^B26733972
"BLD",11145,"KRN",9.8,"NM",3,0)
PSJPDCL^^0^B62778627
"BLD",11145,"KRN",9.8,"NM","B","PSJDDUT",1)

"BLD",11145,"KRN",9.8,"NM","B","PSJPDAPP",2)

"BLD",11145,"KRN",9.8,"NM","B","PSJPDCL",3)

"BLD",11145,"KRN",19,0)
19
"BLD",11145,"KRN",19.1,0)
19.1
"BLD",11145,"KRN",101,0)
101
"BLD",11145,"KRN",409.61,0)
409.61
"BLD",11145,"KRN",771,0)
771
"BLD",11145,"KRN",779.2,0)
779.2
"BLD",11145,"KRN",870,0)
870
"BLD",11145,"KRN",8989.51,0)
8989.51
"BLD",11145,"KRN",8989.52,0)
8989.52
"BLD",11145,"KRN",8994,0)
8994
"BLD",11145,"KRN","B",.4,.4)

"BLD",11145,"KRN","B",.401,.401)

"BLD",11145,"KRN","B",.402,.402)

"BLD",11145,"KRN","B",.403,.403)

"BLD",11145,"KRN","B",.5,.5)

"BLD",11145,"KRN","B",.84,.84)

"BLD",11145,"KRN","B",1.5,1.5)

"BLD",11145,"KRN","B",1.6,1.6)

"BLD",11145,"KRN","B",1.61,1.61)

"BLD",11145,"KRN","B",1.62,1.62)

"BLD",11145,"KRN","B",3.6,3.6)

"BLD",11145,"KRN","B",3.8,3.8)

"BLD",11145,"KRN","B",9.2,9.2)

"BLD",11145,"KRN","B",9.8,9.8)

"BLD",11145,"KRN","B",19,19)

"BLD",11145,"KRN","B",19.1,19.1)

"BLD",11145,"KRN","B",101,101)

"BLD",11145,"KRN","B",409.61,409.61)

"BLD",11145,"KRN","B",771,771)

"BLD",11145,"KRN","B",779.2,779.2)

"BLD",11145,"KRN","B",870,870)

"BLD",11145,"KRN","B",8989.51,8989.51)

"BLD",11145,"KRN","B",8989.52,8989.52)

"BLD",11145,"KRN","B",8994,8994)

"BLD",11145,"QDEF")
^^^^NO^^^^NO^^NO
"BLD",11145,"QUES",0)
^9.62^^
"BLD",11145,"REQB",0)
^9.611^2^2
"BLD",11145,"REQB",1,0)
PSJ*5.0*353^1
"BLD",11145,"REQB",2,0)
PSJ*5.0*379^1
"BLD",11145,"REQB","B","PSJ*5.0*353",1)

"BLD",11145,"REQB","B","PSJ*5.0*379",2)

"MBREQ")
0
"PKG",221,-1)
1^1
"PKG",221,0)
INPATIENT MEDICATIONS^PSJ^UNIT DOSE AND IVS
"PKG",221,22,0)
^9.49I^1^1
"PKG",221,22,1,0)
5.0^2971215^2981113^1
"PKG",221,22,1,"PAH",1,0)
389^3190517
"PKG",221,22,1,"PAH",1,1,0)
^^2^2^3190517
"PKG",221,22,1,"PAH",1,1,1,0)
The description of this build can be found in the National Patch Module
"PKG",221,22,1,"PAH",1,1,2,0)
under PSJ*5*389.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
3
"RTN","PSJDDUT")
0^1^B79591153^B79498515
"RTN","PSJDDUT",1,0)
PSJDDUT ;BIR/LDT-INPATIENT MEDICATIONS DD UTILITY ; 3/23/11 7:55am
"RTN","PSJDDUT",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**40,44,50,83,116,111,113,194,353,389**;16 DEC 97;Build 4
"RTN","PSJDDUT",3,0)
 ;
"RTN","PSJDDUT",4,0)
 ; Reference to ^PS(51 is supported by DBIA# 2176.
"RTN","PSJDDUT",5,0)
 ; Reference to ^PS(51.1 is supported by DBIA# 2177.
"RTN","PSJDDUT",6,0)
 ; Reference to ^PS(55 is supported by DBIA# 2191.
"RTN","PSJDDUT",7,0)
 ; 
"RTN","PSJDDUT",8,0)
SPCIN ;Called from Non-Verified Orders File (53.1), Special Instructions
"RTN","PSJDDUT",9,0)
 ;field 8
"RTN","PSJDDUT",10,0)
 S PSJHLP(1)="IF ABBREVIATIONS ARE USED, THE TOTAL LENGTH OF THE EXPANDED"
"RTN","PSJDDUT",11,0)
 S PSJHLP(2)="INSTRUCTIONS ALSO MAY NOT BE LONGER THAN 180 CHARACTERS."
"RTN","PSJDDUT",12,0)
 D WRITE
"RTN","PSJDDUT",13,0)
 Q
"RTN","PSJDDUT",14,0)
CHKSI ;Called from Non-Verified Orders File (53.1), Special Instructions
"RTN","PSJDDUT",15,0)
 ;field 8 (Replaces ^PSGSICHK)
"RTN","PSJDDUT",16,0)
 I $S(X'?.ANP:1,X["^":1,1:$L(X)>180) K X Q
"RTN","PSJDDUT",17,0)
 N Y S Y="" F Y(1)=1:1:$L(X," ") S Y(2)=$P(X," ",Y(1)) I Y(2)]"" D CHK1 Q:'$D(X)
"RTN","PSJDDUT",18,0)
 I $D(X),Y]"",X'=$E(Y,1,$L(Y)-1) D EN^DDIOL("EXPANDS TO:","","!?3") F Y(1)=1:1 S Y(2)=$P(Y," ",Y(1)) Q:Y(2)=""  D:$L(Y(2))+$X>78 EN^DDIOL("","","!") D EN^DDIOL(Y(2)_" ","","?0")
"RTN","PSJDDUT",19,0)
 K Y Q
"RTN","PSJDDUT",20,0)
CHK1 ;
"RTN","PSJDDUT",21,0)
 I $L(Y(2))<31,$D(^PS(51,+$O(^PS(51,"B",Y(2),0)),0)),$P(^(0),"^",2)]"",$P(^(0),"^",4) S Y(2)=$P(^(0),"^",2)
"RTN","PSJDDUT",22,0)
 I $L(Y)+$L(Y(2))>180 K X Q
"RTN","PSJDDUT",23,0)
 S Y=Y_Y(2)_" " Q
"RTN","PSJDDUT",24,0)
 ;
"RTN","PSJDDUT",25,0)
CHK F QQ=1:1:$L(SCH,"-") S WKD=$P(SCH,"-",QQ) I WKD=$E(X,1,$L(WKD)) D TS Q
"RTN","PSJDDUT",26,0)
 Q
"RTN","PSJDDUT",27,0)
TS F Q1=1:1:$L(TS,"-") S C=C+1 I C=PSGDL S X=X1_"."_$P(TS,"-",Q1) Q
"RTN","PSJDDUT",28,0)
 Q
"RTN","PSJDDUT",29,0)
STRDT ;Called from Non-Verified Orders File (53.1),Start Date/Time field 10
"RTN","PSJDDUT",30,0)
 ;(Replaces ENPREV^PSGDL)
"RTN","PSJDDUT",31,0)
 D EN^DDIOL("REVIOUS","","?0") S (X,Y)=0 I '$D(PSGP)!'$D(PSGPDRG) G:$D(DA)[0 POUT S PSGP=$P($G(^PS(53.1,DA,0)),"^",15),PSGPDRG=+$G(^(.2)),Y=1 I 'PSGP!'PSGPDRG D:'PSGPDRG EN^DDIOL("Must have drug from formulary list.","","!?17") G POUT
"RTN","PSJDDUT",32,0)
 F Q=0:0 S Q=$O(^PS(53.1,"AC",PSGP,Q)) Q:'Q  I +$G(^PS(53.1,Q,.2))=PSGPDRG,$D(^PS(53.1,Q,2)),$P(^(2),"^",4)>X S X=$P(^(2),"^",4)
"RTN","PSJDDUT",33,0)
 F Q=0:0 S Q=$O(^PS(55,PSGP,5,"C",PSGPDRG,Q)) Q:'Q  I $D(^PS(55,PSGP,5,Q,2)),$P(^(2),"^",4)>X S X=$P(^(2),"^",4)
"RTN","PSJDDUT",34,0)
 D:'X EN^DDIOL("No other order found with this drug.","","!?17")
"RTN","PSJDDUT",35,0)
 ;
"RTN","PSJDDUT",36,0)
POUT ;
"RTN","PSJDDUT",37,0)
 K:'X X K:Y PSGPDRG,PSGP,Q Q
"RTN","PSJDDUT",38,0)
 ;
"RTN","PSJDDUT",39,0)
UNPD ;Called from Non-Verified Orders File (53.1), Units Per Dose field 13
"RTN","PSJDDUT",40,0)
 S PSJHLP(1)="ONE (1) UNIT PER DOSE WILL BE ASSUMED IF THERE IS NO ENTRY (OR"
"RTN","PSJDDUT",41,0)
 S PSJHLP(2)="AN ENTRY OF ZERO (0)) INTO THIS FIELD."
"RTN","PSJDDUT",42,0)
 D WRITE
"RTN","PSJDDUT",43,0)
 Q
"RTN","PSJDDUT",44,0)
 ;
"RTN","PSJDDUT",45,0)
SCH ;Called from Non-Verified Orders File (53.1), Schedule field 26
"RTN","PSJDDUT",46,0)
 ;(Replaces EN^PSGS0)
"RTN","PSJDDUT",47,0)
 ;/I X[""""!($A(X)=45)!(X?.E1C.E)!($L(X," ")>2)!($L(X)>70)!($L(X)<1)!(X["P RN")!(X["PR N") K X Q
"RTN","PSJDDUT",48,0)
 ;*194 Allow multi-word schedules
"RTN","PSJDDUT",49,0)
 I X[""""!($A(X)=45)!(X?.E1C.E)!($L(X," ")>$S(X["PRN":4,1:3))!($L(X)>70)!($L(X)<1)!(X["P RN")!(X["PR N") K X Q
"RTN","PSJDDUT",50,0)
 I X?.E1L.E S X=$$ENLU^PSGMI(X) I '$D(PSGOES) D EN^DDIOL("  ("_X_")","","?0")
"RTN","PSJDDUT",51,0)
 I X["Q0" K X Q
"RTN","PSJDDUT",52,0)
 ;
"RTN","PSJDDUT",53,0)
ENOS ; order set entry
"RTN","PSJDDUT",54,0)
 S (PSGS0XT,PSGS0Y,XT,Y)="" I X["PRN"!(X="ON CALL")!(X="ONCALL")!(X="ON-CALL") G Q
"RTN","PSJDDUT",55,0)
 S X0=X I X,X'["X",(X?2.4N1"-".E!(X?2.4N)) D ENCHK^PSGS0 S:$D(X) Y=X G Q
"RTN","PSJDDUT",56,0)
 I $S($D(^PS(51.1,"AC","PSJ",X)):1,1:$E($O(^(X)),1,$L(X))=X) D DIC^PSGS0 I XT]"" G Q
"RTN","PSJDDUT",57,0)
 I X["@" D DW^PSGS0 S:$D(X) Y=$P(X,"@",2) G Q
"RTN","PSJDDUT",58,0)
 I Y'>0,$S(X="NOW":1,X="ONCE":1,X="STAT":1,X="ONE TIME":1,X="ONETIME":1,X="1TIME":1,X="1 TIME":1,X="T-TIME":1,1:X="ONE-TIME") D:'$D(PSGOES) EN^DDIOL("  (ONCE ONLY)","","?0") S Y="",XT="O" G Q
"RTN","PSJDDUT",59,0)
 I $G(PSGSCH)=X S PSGS0Y=$G(PSGAT) Q
"RTN","PSJDDUT",60,0)
 ;
"RTN","PSJDDUT",61,0)
NS K PSJNSS I Y'>0 D:'$D(PSGOES) EN^DDIOL("  (Nonstandard schedule)","","?0") S X=X0,Y="",PSJNSS=1
"RTN","PSJDDUT",62,0)
 I $E(X,1,2)="AD" K X Q
"RTN","PSJDDUT",63,0)
 I $E(X,1,3)="BID"!($E(X,1,3)="TID")!($E(X,1,3)="QID") S XT=1440/$F("BTQ",$E(X)) G Q
"RTN","PSJDDUT",64,0)
 S:$E(X)="Q" X=$E(X,2,99) S:'X X="1"_X S X1=+X,X=$P(X,+X,2),X2=0 S:X1<0 X1=-X1 S:$E(X)="X" X2=1,X=$E(X,2,99)
"RTN","PSJDDUT",65,0)
 S XT=$S(X["'":1,(X["D"&(X'["AD"))!(X["AM")!(X["PM")!(X["HS"&(X'["THS")):1440,X["H"&(X'["TH"):60,X["AC"!(X["PC"):480,X["W":10080,X["M":40320,1:-1) I XT<0,Y'>0 K X G Q
"RTN","PSJDDUT",66,0)
 S X=X0 I XT S:X2 XT=XT\X1 I 'X2 S:$E(X,1,2)="QO" XT=XT*2 S XT=XT*X1
"RTN","PSJDDUT",67,0)
 ;
"RTN","PSJDDUT",68,0)
Q ;
"RTN","PSJDDUT",69,0)
 S PSGS0XT=$S(XT]"":XT,1:""),PSGS0Y=$S(Y:Y,1:"") K QX,SDW,SWD,X0,XT,Z Q
"RTN","PSJDDUT",70,0)
 ;
"RTN","PSJDDUT",71,0)
SCH3 ;Called from Non-Verified Orders File (53.1), Schedule field 26
"RTN","PSJDDUT",72,0)
 ;(Replaces ENSH3^PSGSH)
"RTN","PSJDDUT",73,0)
 S:'$D(PSGST) PSGST=$P($G(^PS(53.1,DA,0)),"^",7),PSGDDFLG=1
"RTN","PSJDDUT",74,0)
 N D,DA,DIC,DIE,DZ,Y
"RTN","PSJDDUT",75,0)
 D EN^DDIOL("'STAT', 'ONCE', 'NOW', and 'DAILY' are acceptable schedules.") I X?1"???".E F Q=1:1 Q:$P($T(HT+Q),";",3)=""  S PSJHLP(Q)=$P($T(HT+Q),";",3)
"RTN","PSJDDUT",76,0)
 I X?1"???".E D EN^DDIOL(.PSJHLP) K PSJHLP
"RTN","PSJDDUT",77,0)
 I X?1"???".E R !,"(Press RETURN to continue.) ",Q:DTIME D:'$T EN^DDIOL("","","$C(7)") S:'$T Q="^" I Q="^" K:$D(PSGDDFLG) PSGDDFLG,PSGST Q
"RTN","PSJDDUT",78,0)
 K DIC S DIC="^PS(51.1,",DIC(0)="E",D="APPSJ",DIC("W")="W ""  """ I $D(PSJPWD),PSJPWD S DIC("W")=DIC("W")_",$S($D(^PS(51.1,+Y,1,PSJPWD,0)):$P(^(0),""^"",2),1:$P(^PS(51.1,+Y,0),""^"",2))"
"RTN","PSJDDUT",79,0)
 S DIC("W")=DIC("W")_",$S($P(^PS(51.1,+Y,0),U,12):"" **INACTIVE**"",1:"""")"   ;*353
"RTN","PSJDDUT",80,0)
 ; Naked references on the following two lines refer to the full reference on the line above
"RTN","PSJDDUT",81,0)
 E  S DIC("W")=DIC("W")_",$P(^(0),""^"",2)"
"RTN","PSJDDUT",82,0)
 I $D(PSGST) S DIC("S")="I $P(^(0),""^"",5)"_$E("'",PSGST'="O")_"=""O"""
"RTN","PSJDDUT",83,0)
 S DIC("?N",51.1)=12
"RTN","PSJDDUT",84,0)
 D IX^DIC K DIC K:$D(PSGDDFLG) PSGDDFLG,PSGST Q
"RTN","PSJDDUT",85,0)
 ;
"RTN","PSJDDUT",86,0)
HT ;
"RTN","PSJDDUT",87,0)
 ;;  This is the frequency (ONLY) with which the doses are to be
"RTN","PSJDDUT",88,0)
 ;;administered.  Several forms of entry are acceptable, such as
"RTN","PSJDDUT",89,0)
 ;;Q6H, 09-12-15, STAT, QOD, and MO-WE-FR@AD (where MO-WE-FR are
"RTN","PSJDDUT",90,0)
 ;;days of the week, and AD is the admin times).  The schedule
"RTN","PSJDDUT",91,0)
 ;;will show on the MAR, labels, etc.  No more than ONE space
"RTN","PSJDDUT",92,0)
 ;;(Q3H 4 or Q4H PRN) in the schedule is acceptable.  If the
"RTN","PSJDDUT",93,0)
 ;;letters PRN ;;are found as part of the schedule, no admin
"RTN","PSJDDUT",94,0)
 ;;times will print on the MAR or labels, and the PICK LIST will
"RTN","PSJDDUT",95,0)
 ;;always show a count of zero (0).
"RTN","PSJDDUT",96,0)
 ;;Avoid using notation such as W/F (with food) or WM (with meals)
"RTN","PSJDDUT",97,0)
 ;;in the schedule as it may cause erroneous calculations.  That
"RTN","PSJDDUT",98,0)
 ;;information should be entered into the SPECIAL INSTRUCTIONS.
"RTN","PSJDDUT",99,0)
 ;;  When using the MO-WE-FR@AD schedule, please remember that
"RTN","PSJDDUT",100,0)
 ;;this type of schedule will not work properly without the "@"
"RTN","PSJDDUT",101,0)
 ;;character and at least one admin time, and that at least the
"RTN","PSJDDUT",102,0)
 ;;first two letters of each weekday entered is needed.
"RTN","PSJDDUT",103,0)
 ;
"RTN","PSJDDUT",104,0)
ADTM2 ;Called from Non-Verified Orders File (53.1), Admin Times field 39    
"RTN","PSJDDUT",105,0)
 S PSJHLP(1)="All times must be the same length (2 or 4 characters), must be"
"RTN","PSJDDUT",106,0)
 S PSJHLP(2)="separated by dashes ( - ), and be in ascending order"
"RTN","PSJDDUT",107,0)
 S PSJHLP(3)=" "
"RTN","PSJDDUT",108,0)
 S PSJHLP(4)="This is the set of administration times for this order."
"RTN","PSJDDUT",109,0)
 S PSJHLP(5)="If the Schedule Type is CONTINUOUS the number of administration"
"RTN","PSJDDUT",110,0)
 S PSJHLP(6)="times cannot exceed that indicated by the schedule.  There can"
"RTN","PSJDDUT",111,0)
 S PSJHLP(7)="be less administration times then indicated by the schedule."
"RTN","PSJDDUT",112,0)
 S PSJHLP(8)="There must be at least one administration time entered."
"RTN","PSJDDUT",113,0)
 S PSJHLP(9)=" "
"RTN","PSJDDUT",114,0)
 S PSJHLP(10)="If the Schedule Type is CONTINUOUS and is an Odd Schedule"
"RTN","PSJDDUT",115,0)
 S PSJHLP(11)="(A schedule whose frequency is not evenly divisible by or"
"RTN","PSJDDUT",116,0)
 S PSJHLP(12)="into 1440 minutes or 1 day), Administration Times are not allowed."
"RTN","PSJDDUT",117,0)
 S PSJHLP(13)="For example Q5H, Q17H - these are not evenly divisible by 1440."
"RTN","PSJDDUT",118,0)
 S PSJHLP(14)=" "
"RTN","PSJDDUT",119,0)
 S PSJHLP(15)="If the Schedule Type is CONTINUOUS with a non-odd frequency of"
"RTN","PSJDDUT",120,0)
 S PSJHLP(16)="greater than 1 day (1440 minutes) then more than one"
"RTN","PSJDDUT",121,0)
 S PSJHLP(17)="administration time is not allowed.  For example schedules of"
"RTN","PSJDDUT",122,0)
 S PSJHLP(18)="Q72H, Q3Day, Q5Day."
"RTN","PSJDDUT",123,0)
 S PSJHLP(19)=" "
"RTN","PSJDDUT",124,0)
 S PSJHLP(20)="If the Schedule Type is ONE TIME it cannot have more than one"
"RTN","PSJDDUT",125,0)
 S PSJHLP(21)="administration time."
"RTN","PSJDDUT",126,0)
 D WRITE
"RTN","PSJDDUT",127,0)
 Q
"RTN","PSJDDUT",128,0)
 ;
"RTN","PSJDDUT",129,0)
WRDGP ;Called from Ward Group File (57.5), Ward Group field .01   
"RTN","PSJDDUT",130,0)
 S PSJHLP(1)="There is at least one PICK LIST for this WARD GROUP.  This WARD"
"RTN","PSJDDUT",131,0)
 S PSJHLP(1,"F")="$C(7),!!?2"
"RTN","PSJDDUT",132,0)
 S PSJHLP(2)="GROUP cannot be deleted until the PICK LIST(s) is purged or deleted."
"RTN","PSJDDUT",133,0)
 D WRITE
"RTN","PSJDDUT",134,0)
 Q
"RTN","PSJDDUT",135,0)
 ;
"RTN","PSJDDUT",136,0)
LBLS ;Called from Inpatient Ward Parameters file (59.6), field .11
"RTN","PSJDDUT",137,0)
 S PSJHLP(1)="ANY NEW LABELS OLDER THAN THE NUMBER OF DAYS SPECIFIED HERE WILL"
"RTN","PSJDDUT",138,0)
 S PSJHLP(2)="AUTOMATICALLY BE PURGED."
"RTN","PSJDDUT",139,0)
 D WRITE
"RTN","PSJDDUT",140,0)
 Q
"RTN","PSJDDUT",141,0)
 ;
"RTN","PSJDDUT",142,0)
SCHTP ;Called from the Unit Dose Multiple of file 55, Schedule Type field 7
"RTN","PSJDDUT",143,0)
 S PSJHLP(1)="CHOOSE FROM:"
"RTN","PSJDDUT",144,0)
 S PSJHLP(1,"F")="!!"
"RTN","PSJDDUT",145,0)
 S PSJHLP(2)="C - CONTINUOUS"
"RTN","PSJDDUT",146,0)
 S PSJHLP(2,"F")="!?3"
"RTN","PSJDDUT",147,0)
 S PSJHLP(3)="O - ONE-TIME"
"RTN","PSJDDUT",148,0)
 S PSJHLP(3,"F")="!?3"
"RTN","PSJDDUT",149,0)
 S PSJHLP(4)="OC - ON CALL"
"RTN","PSJDDUT",150,0)
 S PSJHLP(4,"F")="!?3"
"RTN","PSJDDUT",151,0)
 S PSJHLP(5)="P - PRN"
"RTN","PSJDDUT",152,0)
 S PSJHLP(5,"F")="!?3"
"RTN","PSJDDUT",153,0)
 S PSJHLP(6)="R - FILL ON REQUEST"
"RTN","PSJDDUT",154,0)
 S PSJHLP(6,"F")="!?3"
"RTN","PSJDDUT",155,0)
 D WRITE
"RTN","PSJDDUT",156,0)
 Q
"RTN","PSJDDUT",157,0)
 ;
"RTN","PSJDDUT",158,0)
EN ;Called from Non-Verified Orders file 53.1, Start/Date Time field 10
"RTN","PSJDDUT",159,0)
 ;and Stop Date/Time field 25 (Replaces EN^PSGDL)
"RTN","PSJDDUT",160,0)
 K PSGDLS S ND2=^PS(53.1,DA,2) I $P(ND2,"^",5)!$P(ND2,"^",6) D EN^DDIOL(" ...Dose Limit... ","","?0") G ENGO
"RTN","PSJDDUT",161,0)
 G DONE
"RTN","PSJDDUT",162,0)
 ;
"RTN","PSJDDUT",163,0)
ENGO ;
"RTN","PSJDDUT",164,0)
 N FD
"RTN","PSJDDUT",165,0)
 S SCH=$P(ND2,"^")
"RTN","PSJDDUT",166,0)
 S ST=$S($D(PSGDLS):PSGDLS,1:$P(ND2,"^",2))
"RTN","PSJDDUT",167,0)
 S TS=$P(ND2,"^",5),MN=$P(ND2,"^",6)
"RTN","PSJDDUT",168,0)
 I $P(PSJSYSW0,U,5)=2 D
"RTN","PSJDDUT",169,0)
 . Q:'TS  S:TS'[$P(ST,".",2) $P(PSJSYSW0,U,5)=1 D
"RTN","PSJDDUT",170,0)
 .. N STRING,ND2,SCH,TS,MN S STRING=$G(PSGSD)_"^"_$G(PSGFD)_"^"_$G(PSGSCH)_"^"_$G(PSGST)_"^"_$G(PSGPDRG)_"^"_$G(PSGAT)
"RTN","PSJDDUT",171,0)
 .. S (FD,ST)=$$ENQ^PSJORP2(PSGP,STRING) S:'ST ST=$S($D(PSGDLS):PSGDLS,1:$P(ND2,"^",2))
"RTN","PSJDDUT",172,0)
 . S $P(PSJSYSW0,U,5)=2
"RTN","PSJDDUT",173,0)
 I $G(FD),$P(ND2,"^",4),FD>$P(ND2,"^",4) D  G DONE
"RTN","PSJDDUT",174,0)
 . W !,"There is no schedule and/or administration time that falls between the Start Date/Time"
"RTN","PSJDDUT",175,0)
 . W !,"and Stop Date/Time.  For the order to be valid the schedule and/or administration time"
"RTN","PSJDDUT",176,0)
 . W !,"must fall between the order's Start Date/Time and Stop Date/Time.",!
"RTN","PSJDDUT",177,0)
 S TS=$P(ND2,"^",5),MN=$P(ND2,"^",6)
"RTN","PSJDDUT",178,0)
 G MWF:SCH["@",DONE:'TS&'MN
"RTN","PSJDDUT",179,0)
 I 'TS S AM=MN*PSGDL,X=$$EN^PSGCT(ST,AM) G DONE
"RTN","PSJDDUT",180,0)
 S TM=$E(ST_"00000",9,8+$L($P(TS,"-")))
"RTN","PSJDDUT",181,0)
 F Q=1:1 Q:$P(TS,"-",Q)=""!(TM<$P(TS,"-",Q))
"RTN","PSJDDUT",182,0)
 S X=ST\1,C=0 F Q=Q:1 D:$P(TS,"-",Q)="" ADD S C=C+1 I C=PSGDL S X=X_"."_$P(TS,"-",Q) G DONE
"RTN","PSJDDUT",183,0)
 ;
"RTN","PSJDDUT",184,0)
MWF ; if schedule is similar to monday-wednesday-friday
"RTN","PSJDDUT",185,0)
 S TS=$P(SCH,"@",2),SCH=$P(SCH,"@"),X=$P(ST,"."),C=0 D SCHK G:C=PSGDL DONE F Q=1:1 S X1=$P(ST,"."),X2=Q D C^%DTC S X1=X D DW^%DTC D CHK G:C=PSGDL DONE
"RTN","PSJDDUT",186,0)
SCHK S X1=X D DW^%DTC F Q=1:1:$L(SCH,"-") S WKD=$P(SCH,"-",Q) I WKD=$E(X,1,$L(WKD)) Q
"RTN","PSJDDUT",187,0)
 E  Q
"RTN","PSJDDUT",188,0)
 S TM=$E(ST_"00000",9,8+$L($P(TS,"-"))) F Q=1:1:$L(TS,"-") I TM<$P(TS,"-",Q) S C=C+1 I C=PSGDL S X=X1_"."_$P(TS,"-",Q) Q
"RTN","PSJDDUT",189,0)
 Q
"RTN","PSJDDUT",190,0)
 ;
"RTN","PSJDDUT",191,0)
DONE ;
"RTN","PSJDDUT",192,0)
 K %H,%T,%Y,MN,ND2,ND4,PSGDLS,PSGDL,Q1,QQ,SCH,TM,WKD,TS,X1,X2 Q
"RTN","PSJDDUT",193,0)
 ;
"RTN","PSJDDUT",194,0)
ADD ;
"RTN","PSJDDUT",195,0)
 S X1=$P(X,"."),X2=$S(MN&'(MN#1440):MN\1440,1:1) D C^%DTC S Q=1 Q
"RTN","PSJDDUT",196,0)
 ;
"RTN","PSJDDUT",197,0)
WRITE ;Calls EN^DDIOL to write text
"RTN","PSJDDUT",198,0)
 D EN^DDIOL(.PSJHLP) K PSJHLP Q
"RTN","PSJPDAPP")
0^2^B26733972^B26391444
"RTN","PSJPDAPP",1,0)
PSJPDAPP ;BIR/MHA - SEND APPOINTMENTS TO PADE ;11/27/15
"RTN","PSJPDAPP",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**317,389**;16 DEC 97;Build 4
"RTN","PSJPDAPP",3,0)
 ;Reference to ^PS(55 is supported by DBIA 2191
"RTN","PSJPDAPP",4,0)
 ;Reference to ^ORD(101 supported by DBIA 872
"RTN","PSJPDAPP",5,0)
 ;Reference to GETPLIST^SDAMA202 supported by DBIA 3869
"RTN","PSJPDAPP",6,0)
 ;Reference to ^SC supported by DBIA 10040
"RTN","PSJPDAPP",7,0)
 ;Reference to ^DPT supported by DBIA 10035
"RTN","PSJPDAPP",8,0)
 Q
"RTN","PSJPDAPP",9,0)
 ;
"RTN","PSJPDAPP",10,0)
EN ;
"RTN","PSJPDAPP",11,0)
 N PDA,PDCL,PDCLA,PDI,PDJ,PDK,PSJAP,PSJCLPD,PSJPDNM,PSJDIV,DTP,SA,SEQ,I,J,K,L,P,X,Y,Z,PSJNIP,X1,X2
"RTN","PSJPDAPP",12,0)
 S (DTP,PSJAP,I)=0
"RTN","PSJPDAPP",13,0)
 F  S I=$O(^PS(58.7,I)) Q:'I  S J=$$PDACT^PSJPDCLA(I)
"RTN","PSJPDAPP",14,0)
 Q:'PSJAP
"RTN","PSJPDAPP",15,0)
 S I=0 F  S I=$O(PSJAP(I)) Q:'I  D
"RTN","PSJPDAPP",16,0)
 . S DTP=+$G(^PS(58.7,I,1))
"RTN","PSJPDAPP",17,0)
 . S J=0 F  S J=$O(^PS(58.7,I,"DIV",J)) Q:'J  D
"RTN","PSJPDAPP",18,0)
 .. S Y=$G(^PS(58.7,I,"DIV",J,0)) I Y=""!($P(Y,"^",2)&($P(Y,"^",2)<DT)) Q
"RTN","PSJPDAPP",19,0)
 .. S SA=""
"RTN","PSJPDAPP",20,0)
 .. I $P(Y,"^",9)="Y" S:$P(Y,"^",4) SA=$P($G(^PS(58.71,$P(Y,"^",4),0)),"^") D ALLCLN   ;send appt for all clinics
"RTN","PSJPDAPP",21,0)
 .. D CLARR
"RTN","PSJPDAPP",22,0)
 M PDCL=PDCLA
"RTN","PSJPDAPP",23,0)
 Q:'$D(PDCL)
"RTN","PSJPDAPP",24,0)
 N SNM,CNM S SNM="PSJ SIU-S12 SERVER",CNM="PSJ SIU-S12 CLIENT"
"RTN","PSJPDAPP",25,0)
 I '$O(^ORD(101,"B",SNM,0))!('$O(^ORD(101,"B",CNM,0))) Q
"RTN","PSJPDAPP",26,0)
 N NHL D INIT^HLFNC2(SNM,.NHL) Q:$D(NHL)=1
"RTN","PSJPDAPP",27,0)
 N NFS,NECH,HL,HLFS,NSEG,EDT,APT,DFN,PSJDTM,PSJND,PSJVP,PSJVNM,PSJDNS,PSJDNM,PSJOR,PSJORN
"RTN","PSJPDAPP",28,0)
 M HL=NHL S (NFS,HLFS)=HL("FS"),NECH=$E(HL("ECH"),1)
"RTN","PSJPDAPP",29,0)
 S PDI=0 F  S PDI=$O(PDCL(PDI)) Q:'PDI  D
"RTN","PSJPDAPP",30,0)
 . S PSJND=$G(^PS(58.7,PDI,0))
"RTN","PSJPDAPP",31,0)
 . S PSJVNM=$P(PSJND,"^"),PSJDNS=$P(PSJND,"^",2),PSJVP=$P(PSJND,"^",3)
"RTN","PSJPDAPP",32,0)
 . S PDJ=0 F  S PDJ=$O(PDCL(PDI,PDJ)) Q:'PDJ  D
"RTN","PSJPDAPP",33,0)
 .. S PSJDNM=$P($$SITE^VASITE(,PDJ),"^",3)
"RTN","PSJPDAPP",34,0)
 .. S PDK=0 F  S PDK=$O(PDCL(PDI,PDJ,PDK)) Q:'PDK  D APPT
"RTN","PSJPDAPP",35,0)
 Q
"RTN","PSJPDAPP",36,0)
 ;
"RTN","PSJPDAPP",37,0)
APPT ;
"RTN","PSJPDAPP",38,0)
 K ^TMP($J,"SDAMA202")
"RTN","PSJPDAPP",39,0)
 S PSJOR=PDK,PSJORN=$P(^SC(PDK,0),"^")
"RTN","PSJPDAPP",40,0)
 S DTP=PDCL(PDI,PDJ,PDK)
"RTN","PSJPDAPP",41,0)
 S EDT=DT
"RTN","PSJPDAPP",42,0)
 I DTP S X1=DT,X2=+DTP D C^%DTC S EDT=X
"RTN","PSJPDAPP",43,0)
 D GETPLIST^SDAMA202(PDK,"1;4","",DT,EDT)
"RTN","PSJPDAPP",44,0)
 Q:'$D(^TMP($J,"SDAMA202"))
"RTN","PSJPDAPP",45,0)
 K APDTM,CLNM,PSJXCL
"RTN","PSJPDAPP",46,0)
 S PDA=0 F  S PDA=$O(^TMP($J,"SDAMA202","GETPLIST",PDA)) Q:'PDA  D
"RTN","PSJPDAPP",47,0)
 . S PSJDTM=+^TMP($J,"SDAMA202","GETPLIST",PDA,1)
"RTN","PSJPDAPP",48,0)
 . S DFN=+^TMP($J,"SDAMA202","GETPLIST",PDA,4)
"RTN","PSJPDAPP",49,0)
 . Q:$P($G(^DPT(DFN,.1)),"^")]""&($P(^PS(58.7,PDI,0),"^",6)'="Y")
"RTN","PSJPDAPP",50,0)
 . K NSEG N ZZ1,XX,FTS S (ZZ1,FTS)="",PSJNIP=0
"RTN","PSJPDAPP",51,0)
 . I $P($G(^DPT(DFN,.1)),"^")]"" D
"RTN","PSJPDAPP",52,0)
 .. D IN5^VADPT
"RTN","PSJPDAPP",53,0)
 .. N PSJQ,PSJWD,PSJRBD
"RTN","PSJPDAPP",54,0)
 .. S PSJWD=$P(VAIP(5),"^",2),PSJRBD=$P(VAIP(6),"^",2)
"RTN","PSJPDAPP",55,0)
 .. S PSJQ=$$CHKPD^PSJPDCL(PSJWD,PSJRBD)
"RTN","PSJPDAPP",56,0)
 .. I 'PSJQ S PSJNIP=1 Q
"RTN","PSJPDAPP",57,0)
 .. S FTS=$P(VAIP(8),"^")_NECH_$P(VAIP(8),"^",2)
"RTN","PSJPDAPP",58,0)
 .. S XX=0 F  S XX=$O(PSJQ(XX)) Q:'XX  D
"RTN","PSJPDAPP",59,0)
 ... I XX=PDI,$P(PSJQ(XX),"^",2)'="" S ZZ1=$P(PSJQ(XX),"^",2)
"RTN","PSJPDAPP",60,0)
 ... I XX'=PDI S PSJNIP=1
"RTN","PSJPDAPP",61,0)
 ... I $G(PSJXCL(PDI)) S PSJNIP=0
"RTN","PSJPDAPP",62,0)
 . S SEQ=0 D SRBLD^PSJPDCLA M HL=NHL N ZZ2 S ZZ2=$S($P(DTP,"^",2)'="":$P(DTP,"^",2),1:"")
"RTN","PSJPDAPP",63,0)
 . S SEQ=SEQ+1,NSEG(SEQ)="ZZZ"_HL("FS")_$S(ZZ1'="":ZZ1,1:"")_HL("FS")_ZZ2_HL("FS")_FTS
"RTN","PSJPDAPP",64,0)
 . K HLP,HLA,PSJSND S HLP="",HLP("SUBSCRIBER")="^^^^~"_PSJDNS_":"_PSJVP_"~DNS"
"RTN","PSJPDAPP",65,0)
 . N XX S XX=PDI D PV19 M HLA("HLS")=NSEG
"RTN","PSJPDAPP",66,0)
 . D GENERATE^HLMA(SNM,"LM",1,.PSJSND,"",.HLP)
"RTN","PSJPDAPP",67,0)
 . D LOG^PSJPADE
"RTN","PSJPDAPP",68,0)
 Q
"RTN","PSJPDAPP",69,0)
 ;
"RTN","PSJPDAPP",70,0)
ALLCLN ;
"RTN","PSJPDAPP",71,0)
 N ND S Z=0 F  S Z=$O(^SC(Z)) Q:'Z  D
"RTN","PSJPDAPP",72,0)
 .S ND=^SC(Z,0) Q:$P(ND,"^",3)'="C"  Q:$P(ND,"^",15)'=J
"RTN","PSJPDAPP",73,0)
 .I $D(^SC(Z,"I")) S X=$G(^SC(Z,"I")) I $P(X,"^"),$P(X,"^",2)'>$P(X,"^") Q
"RTN","PSJPDAPP",74,0)
 .S PDCL(I,J,Z)=DTP_$S(SA]"":"^"_SA,1:"")
"RTN","PSJPDAPP",75,0)
 Q
"RTN","PSJPDAPP",76,0)
 ;
"RTN","PSJPDAPP",77,0)
CLARR ;
"RTN","PSJPDAPP",78,0)
 S Z=0,SA=""
"RTN","PSJPDAPP",79,0)
 F  S Z=$O(^PS(58.7,I,"DIV",J,"CL",Z)) Q:'Z  S K=^PS(58.7,I,"DIV",J,"CL",Z,0) D:$P(K,"^",3)="Y"
"RTN","PSJPDAPP",80,0)
 . S SA=$P(K,"^",2)
"RTN","PSJPDAPP",81,0)
 . S:SA SA=$P($G(^PS(58.71,SA,0)),"^")
"RTN","PSJPDAPP",82,0)
 . S PDCLA(I,J,+K)=DTP_$S(SA]"":"^"_SA,1:"")
"RTN","PSJPDAPP",83,0)
 S Z=0
"RTN","PSJPDAPP",84,0)
 F  S Z=$O(^PS(58.7,I,"DIV",J,"PCG",Z)) Q:'Z  D:$P($G(^PS(58.7,I,"DIV",J,"PCG",Z,2)),"^")="Y"
"RTN","PSJPDAPP",85,0)
 . S SA=$P($G(^PS(58.7,I,"DIV",J,"PCG",Z,0)),"^",2)
"RTN","PSJPDAPP",86,0)
 . S:SA SA=$P($G(^PS(58.71,SA,0)),"^")
"RTN","PSJPDAPP",87,0)
 . S X=0 F  S X=$O(^PS(58.7,I,"DIV",J,"PCG",Z,1,X)) Q:'X  D
"RTN","PSJPDAPP",88,0)
 .. S K=+$G(^PS(58.7,I,"DIV",J,"PCG",Z,1,X,0))
"RTN","PSJPDAPP",89,0)
 .. I '$D(PDCLA(I,J,K)) S PDCLA(I,J,K)=DTP_$S(SA]"":"^"_SA,1:"")
"RTN","PSJPDAPP",90,0)
 S Z=0
"RTN","PSJPDAPP",91,0)
 F  S Z=$O(^PS(58.7,I,"DIV",J,"VCG",Z)) Q:'Z  S X=^PS(58.7,I,"DIV",J,"VCG",Z,0) D:$P(X,"^",3)="Y"
"RTN","PSJPDAPP",92,0)
 . S SA=$P(X,"^",2) S:SA SA=$P($G(^PS(58.71,SA,0)),"^")
"RTN","PSJPDAPP",93,0)
 . S Y=0 F  S Y=$O(^PS(57.8,+X,1,Y)) Q:'Y  D
"RTN","PSJPDAPP",94,0)
 .. S K=+^(Y,0) S:'$D(PDCLA(I,J,K)) PDCLA(I,J,K)=DTP_$S(SA]"":"^"_SA,1:"")
"RTN","PSJPDAPP",95,0)
 S Z=0,L=""
"RTN","PSJPDAPP",96,0)
 F  S Z=$O(^PS(58.7,I,"DIV",J,"WCN",Z)) Q:'Z  S X=^PS(58.7,I,"DIV",J,"WCN",Z,0) D:$P(X,"^",3)="Y"
"RTN","PSJPDAPP",97,0)
 . S SA=$P(X,"^",2) S:SA SA=$P($G(^PS(58.71,SA,0)),"^")
"RTN","PSJPDAPP",98,0)
 . S (Y,P)=$P(X,"^") F  S P=$O(^SC("B",P)) Q:P=""!($E(P,1,$L(Y))'=Y)  D
"RTN","PSJPDAPP",99,0)
 .. S K=$O(^SC("B",P,0)),L=$G(^SC(K,0)) Q:$P(L,"^",3)'="C"  Q:$P(L,"^",15)'=J
"RTN","PSJPDAPP",100,0)
 .. S:'$D(PDCLA(I,J,K)) PDCLA(I,J,K)=DTP_$S(SA]"":"^"_SA,1:"")
"RTN","PSJPDAPP",101,0)
 Q
"RTN","PSJPDAPP",102,0)
 ;
"RTN","PSJPDAPP",103,0)
PV19 ;
"RTN","PSJPDAPP",104,0)
 N NC,NDFN,NCLI,N19,NSA,NS,NWDI,NQ
"RTN","PSJPDAPP",105,0)
 S (NSA,N19)="",(NQ,NC)=0,NS=$E(HL("ECH"),1),PDL(10)=XX,PDL(4)=HL("ETN")
"RTN","PSJPDAPP",106,0)
 S:ZZ2]"" (NSA,PDL(12))=$O(^PS(58.71,"B",ZZ2,0))
"RTN","PSJPDAPP",107,0)
 S:ZZ1]"" PDL(11)=$O(^PS(58.71,"B",ZZ1,""))
"RTN","PSJPDAPP",108,0)
 F  S NC=$O(NSEG(NC)) Q:'NC  D  Q:NQ
"RTN","PSJPDAPP",109,0)
 . I $E(NSEG(NC),1,3)="PID" S (NDFN,PDL(1))=+$P(NSEG(NC),HL("FS"),4) Q
"RTN","PSJPDAPP",110,0)
 . I $E(NSEG(NC),1,3)="PV1" D  S NQ=1 Q
"RTN","PSJPDAPP",111,0)
 .. I $P(NSEG(NC),HL("FS"),12)]"" D
"RTN","PSJPDAPP",112,0)
 ... S NCLI=$P($P(NSEG(NC),HL("FS"),12),NS,2)
"RTN","PSJPDAPP",113,0)
 ... S:'NCLI NCLI=$O(^SC("B",$P($P(NSEG(NC),HL("FS"),12),NS),0))
"RTN","PSJPDAPP",114,0)
 ... S:NCLI PDL(5)=+$P($G(^SC(NCLI,0)),"^",15)
"RTN","PSJPDAPP",115,0)
 ... S N19=NDFN_"-"_$S(NSA]"":NSA_"S",1:NCLI),PDL(9)=N19 S:NCLI PDL(8)=NCLI
"RTN","PSJPDAPP",116,0)
 ... S $P(NSEG(NC),HL("FS"),20)=N19
"RTN","PSJPDAPP",117,0)
 .. I $P(NSEG(NC),HL("FS"),4)]"" D
"RTN","PSJPDAPP",118,0)
 ... S NWDI=$O(^DIC(42,"B",$P($P(NSEG(NC),HL("FS"),4),NS),0))
"RTN","PSJPDAPP",119,0)
 ... I NWDI S PDL(7)=NWDI S:'$G(PDL(5)) PDL(5)=+$P($G(^DIC(42,NWDI,0)),"^",11)
"RTN","PSJPDAPP",120,0)
 .. S:$P(NSEG(NC),HL("FS"),51)]"" PDL(6)=$P(NSEG(NC),HL("FS"),51)
"RTN","PSJPDAPP",121,0)
 Q
"RTN","PSJPDAPP",122,0)
 ;
"RTN","PSJPDCL")
0^3^B62778627^B62118639
"RTN","PSJPDCL",1,0)
PSJPDCL ;BIR/MHA - PADE HL7 ADT MESSAGE CLIENT TO VAFC ADT SERVER ;07/08/15
"RTN","PSJPDCL",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**317,337,347,379,389**;16 DEC 97;Build 4
"RTN","PSJPDCL",3,0)
 ;Reference to ^SC supported by DBIA 10040
"RTN","PSJPDCL",4,0)
 ;Reference to ^DIC(42 supported by DBIA 10039
"RTN","PSJPDCL",5,0)
 ;Reference to ^ORD(101 supported by DBIA 872
"RTN","PSJPDCL",6,0)
 ;Reference to ^DG(405.4 supported by DBIA 1380
"RTN","PSJPDCL",7,0)
 ;Reference to ^GMRADPT supported by DBIA 10099
"RTN","PSJPDCL",8,0)
 ;Reference to ^GMRVUTL supported by DBIA 1120
"RTN","PSJPDCL",9,0)
 ;Reference to ^GMRAOR2 supported by DBIA 2422
"RTN","PSJPDCL",10,0)
 ;
"RTN","PSJPDCL",11,0)
 Q
"RTN","PSJPDCL",12,0)
 ;
"RTN","PSJPDCL",13,0)
EN ; Get ADT Message and send to PADE.
"RTN","PSJPDCL",14,0)
 Q:$O(^PS(58.7,"B",""))=""
"RTN","PSJPDCL",15,0)
 Q:'$G(HLEID)
"RTN","PSJPDCL",16,0)
 N PSJAP
"RTN","PSJPDCL",17,0)
 S PSJAP=0
"RTN","PSJPDCL",18,0)
 N I,J S I=0
"RTN","PSJPDCL",19,0)
 F  S I=$O(^PS(58.7,I)) Q:'I  S J=$$PDACT^PSJPDCLA(I)
"RTN","PSJPDCL",20,0)
 Q:'PSJAP
"RTN","PSJPDCL",21,0)
 I $G(HL("ETN"))="" D INIT^HLFNC2(HLEID,.HL) Q:$D(HL)=1
"RTN","PSJPDCL",22,0)
 N FS,ECH S FS=HL("FS"),ECH=$E(HL("ECH"),1)
"RTN","PSJPDCL",23,0)
 N SNM,SID,NHL S SNM="PSJ ADT-"_HL("ETN")_" SERVER"
"RTN","PSJPDCL",24,0)
 S SID=$O(^ORD(101,"B",SNM,0))
"RTN","PSJPDCL",25,0)
 Q:'SID
"RTN","PSJPDCL",26,0)
 D INIT^HLFNC2(SID,.NHL) Q:$D(NHL)=1
"RTN","PSJPDCL",27,0)
 N NFS,NECH S NFS=NHL("FS"),NECH=$E(NHL("ECH"),1)
"RTN","PSJPDCL",28,0)
 N NSEG,PSJQ,PSJLOC,PSJWARD,PSJRBD,SEQ,PSJX,VAIP,X,FTS
"RTN","PSJPDCL",29,0)
 S VAIP("D")="L" D IN5^VADPT S PSJRBD=$P(VAIP(6),"^",2),FTS=$S($P(VAIP(8),"^")]"":$P(VAIP(8),"^")_NECH_$P(VAIP(8),"^",2),1:"")
"RTN","PSJPDCL",30,0)
 S SEQ=0,PSJQ=0,PSJX=1 S:HL("ETN")="A11" FTS=""
"RTN","PSJPDCL",31,0)
 F I=1:1 X HLNEXT Q:HLQUIT'>0!('PSJX)  D
"RTN","PSJPDCL",32,0)
 . Q:$E(HLNODE,1,3)="MSH"
"RTN","PSJPDCL",33,0)
 . Q:$E(HLNODE,1,3)="OBX"
"RTN","PSJPDCL",34,0)
 . Q:$E(HLNODE,1,3)="ROL"
"RTN","PSJPDCL",35,0)
 . Q:$E(HLNODE,1)="Z"
"RTN","PSJPDCL",36,0)
 . S SEQ=SEQ+1
"RTN","PSJPDCL",37,0)
 . S NSEG(SEQ)=$$TR(HLNODE)
"RTN","PSJPDCL",38,0)
 . S J=0 F  S J=$O(HLNODE(J)) Q:'J  S NSEG(SEQ,J)=$$TR(HLNODE(J))
"RTN","PSJPDCL",39,0)
 . I $E(HLNODE,1,3)="PV1" D
"RTN","PSJPDCL",40,0)
 .. S PSJLOC=$P(HLNODE,FS,4)
"RTN","PSJPDCL",41,0)
 .. S PSJWARD=$P(PSJLOC,ECH) Q:PSJWARD=""
"RTN","PSJPDCL",42,0)
 .. S PSJQ=$$CHKPD(PSJWARD,PSJRBD)
"RTN","PSJPDCL",43,0)
 .. I 'PSJQ S PSJX=0 Q
"RTN","PSJPDCL",44,0)
 .. D AGY
"RTN","PSJPDCL",45,0)
 Q:'PSJQ
"RTN","PSJPDCL",46,0)
 N XX,HL,HLFS,HLECH M HL=NHL
"RTN","PSJPDCL",47,0)
 S HLFS=NHL("FS")
"RTN","PSJPDCL",48,0)
 S HLECH=NHL("ECH")
"RTN","PSJPDCL",49,0)
 N ZTIO,ZTRTN,ZTSAVE,ZTDESC,ZTDTH
"RTN","PSJPDCL",50,0)
 S ZTIO=""
"RTN","PSJPDCL",51,0)
 S ZTRTN="SEND^PSJPDCL"
"RTN","PSJPDCL",52,0)
 F XX="PSJQ(","NSEG(","HLFS","HLECH","HL(","SNM","SID","FTS" S ZTSAVE(XX)=""
"RTN","PSJPDCL",53,0)
 S ZTDESC="PADE HL7 ADT Message Router"
"RTN","PSJPDCL",54,0)
 S ZTDTH=$H
"RTN","PSJPDCL",55,0)
 D ^%ZTLOAD
"RTN","PSJPDCL",56,0)
 Q
"RTN","PSJPDCL",57,0)
 ;
"RTN","PSJPDCL",58,0)
SEND ;
"RTN","PSJPDCL",59,0)
 N XX,CT,PSJND,PSJVNM,PSJDNS,PSJVP,VR,HLA,CNM,PSJSND
"RTN","PSJPDCL",60,0)
 M HLA("HLS")=NSEG
"RTN","PSJPDCL",61,0)
 Q:$G(SNM)=""
"RTN","PSJPDCL",62,0)
 I $G(HL("ETN"))="" D INIT^HLFNC2(SNM,.HL) Q:$D(HL)=1
"RTN","PSJPDCL",63,0)
 S CNM="PSJ ADT-"_HL("ETN")_" CLIENT"
"RTN","PSJPDCL",64,0)
 S XX=0,CT=0 F  S XX=$O(PSJQ(XX)) Q:'XX  D   ;sends HL7 message for each PADE SERVER
"RTN","PSJPDCL",65,0)
 .S PSJND=$G(^PS(58.7,XX,0))
"RTN","PSJPDCL",66,0)
 .Q:PSJND=""
"RTN","PSJPDCL",67,0)
 .S PSJVNM=$P(PSJND,"^"),PSJDNS=$P(PSJND,"^",2),PSJVP=$P(PSJND,"^",3)
"RTN","PSJPDCL",68,0)
 .Q:PSJVNM=""!(PSJDNS="")!('PSJVP)
"RTN","PSJPDCL",69,0)
 .N HLP,PSJSND,ZZ1,ZZ2 S (HLP,ZZ1,ZZ2)=""
"RTN","PSJPDCL",70,0)
 .I $G(HL("ETN"))="" D INIT^HLFNC2(SNM,.HL) Q:$D(HL)=1
"RTN","PSJPDCL",71,0)
 .K HLA,HLL M HLA("HLS")=NSEG
"RTN","PSJPDCL",72,0)
 .S HLP("SUBSCRIBER")="^^^^~"_PSJDNS_":"_PSJVP_"~DNS"
"RTN","PSJPDCL",73,0)
 .S HLL("LINKS",1)=CNM_"^"_"PSJ PADE",ZZ1=$P(PSJQ(XX),"^",2)
"RTN","PSJPDCL",74,0)
 .S CT=$O(HLA("HLS",9999),-1)+1 S:CT>1 HLA("HLS",CT)="ZZZ"_HL("FS")_ZZ1_HL("FS")_HL("FS")_FTS
"RTN","PSJPDCL",75,0)
 .D PV19^PSJPDAPP
"RTN","PSJPDCL",76,0)
 .D GENERATE^HLMA(SNM,"LM",1,.PSJSND,"",.HLP)
"RTN","PSJPDCL",77,0)
 .S:$G(PSJSND(1)) PSJSND=PSJSND(1)
"RTN","PSJPDCL",78,0)
 .D LOG^PSJPADE
"RTN","PSJPDCL",79,0)
 Q
"RTN","PSJPDCL",80,0)
 ;
"RTN","PSJPDCL",81,0)
TR(SEG) ; Translate the VAFC message delimiters to HL7 delimiters for PADE
"RTN","PSJPDCL",82,0)
 N CSEG
"RTN","PSJPDCL",83,0)
 S CSEG=$TR(SEG,HL("FS")_HL("ECH"),NHL("FS")_NHL("ECH"))
"RTN","PSJPDCL",84,0)
 S CSEG=$TR(CSEG,"""","")
"RTN","PSJPDCL",85,0)
 Q CSEG
"RTN","PSJPDCL",86,0)
 ;
"RTN","PSJPDCL",87,0)
CHKPD(PSJWD,PSJRB) ;
"RTN","PSJPDCL",88,0)
 N PSJWDI S PSJWDI=$O(^DIC(42,"B",PSJWD,"")) K PSJQ
"RTN","PSJPDCL",89,0)
 Q:'PSJWDI 0
"RTN","PSJPDCL",90,0)
 N PSJDIV,PSJDIVI S PSJDIV=+$P($G(^DIC(42,PSJWDI,0)),"^",11)
"RTN","PSJPDCL",91,0)
 Q:'PSJDIV 0
"RTN","PSJPDCL",92,0)
 N PSJPD,PSJSAR,PSJX S (PSJQ,PSJPD)=0
"RTN","PSJPDCL",93,0)
 F  S PSJPD=$O(^PS(58.7,"AD",PSJDIV,PSJPD)) Q:'PSJPD  D
"RTN","PSJPDCL",94,0)
 . Q:'$D(PSJAP(PSJPD)) 
"RTN","PSJPDCL",95,0)
 . S PSJDIVI=$O(^PS(58.7,PSJPD,"DIV","B",PSJDIV,0))
"RTN","PSJPDCL",96,0)
 . Q:'PSJDIVI
"RTN","PSJPDCL",97,0)
 . N DN S DN=$G(^PS(58.7,PSJPD,"DIV",PSJDIVI,0))
"RTN","PSJPDCL",98,0)
 . S PSJACT=$P(DN,"^",2)
"RTN","PSJPDCL",99,0)
 . I PSJACT,PSJACT<DT Q
"RTN","PSJPDCL",100,0)
 . I $G(PSJPDO)=1 N I S I=0 D  Q:I 
"RTN","PSJPDCL",101,0)
 .. I ($P($G(^PS(58.7,PSJPD,"DIV",PSJDIVI,2)),"^"))'="Y" S I=1 Q  ;DON'T SEND ORDER MESSAGES
"RTN","PSJPDCL",102,0)
 .. I $G(RXO)["V",$P(DN,"^",5)'="Y" S I=1 Q  ;DON'T SEND IP IV
"RTN","PSJPDCL",103,0)
 .. I "UV"[$E(RXO,$L(RXO)),($P($G(^(3)),"^")="Y"),'($S(RXO["V":$$CSIV^PSJPDCLA,1:$$CSUD^PSJPDCLA)) S I=1 Q  ;CS ONLY
"RTN","PSJPDCL",104,0)
 . S PSJX=0
"RTN","PSJPDCL",105,0)
 . I $G(PSJRB)]"" D
"RTN","PSJPDCL",106,0)
 .. N PSJRBI S PSJRBI=$$ROOMBED(PSJRB,PSJWDI) I 'PSJRBI Q
"RTN","PSJPDCL",107,0)
 .. S PSJSAR=$O(^PS(58.7,PSJPD,"DIV",PSJDIVI,"BG","C",PSJRBI,0))
"RTN","PSJPDCL",108,0)
 .. I PSJSAR D
"RTN","PSJPDCL",109,0)
 ... S PSJSAR=$G(^PS(58.7,PSJPD,"DIV",PSJDIVI,"BG",PSJSAR,2))
"RTN","PSJPDCL",110,0)
 ... I PSJSAR S PSJSAR=$P($G(^PS(58.71,PSJSAR,0)),"^") S:PSJSAR]"" PSJQ(PSJPD)="1^"_PSJSAR,(PSJX,PSJQ)=1,PSJXCL(PSJPD)=1
"RTN","PSJPDCL",111,0)
 . Q:PSJX 
"RTN","PSJPDCL",112,0)
 . S PSJSAR=$O(^PS(58.7,PSJPD,"DIV",PSJDIVI,"WD","B",PSJWDI,0))
"RTN","PSJPDCL",113,0)
 . I PSJSAR D
"RTN","PSJPDCL",114,0)
 .. S PSJSAR=$P($G(^PS(58.7,PSJPD,"DIV",PSJDIVI,"WD",PSJSAR,0)),"^",2)
"RTN","PSJPDCL",115,0)
 .. S:PSJSAR PSJSAR=$P($G(^PS(58.71,PSJSAR,0)),"^")
"RTN","PSJPDCL",116,0)
 .. S PSJQ(PSJPD)=1_$S(PSJSAR]"":"^"_PSJSAR,1:""),(PSJX,PSJQ)=1,PSJXCL(PSJPD)=1
"RTN","PSJPDCL",117,0)
 . Q:PSJX
"RTN","PSJPDCL",118,0)
 . I $O(^PS(57.5,"AB",PSJWDI,0)) D
"RTN","PSJPDCL",119,0)
 .. S PSJSAR=$O(^PS(57.5,"AB",PSJWDI,0)) Q:'PSJSAR
"RTN","PSJPDCL",120,0)
 .. S PSJSAR=$O(^PS(58.7,PSJPD,"DIV",PSJDIVI,"WG","B",PSJSAR,0))
"RTN","PSJPDCL",121,0)
 .. I PSJSAR S PSJSAR=$P($G(^PS(58.7,PSJPD,"DIV",PSJDIVI,"WG",PSJSAR,0)),"^",2) D
"RTN","PSJPDCL",122,0)
 ... S:PSJSAR PSJSAR=$P($G(^PS(58.71,PSJSAR,0)),"^")
"RTN","PSJPDCL",123,0)
 ... S PSJQ(PSJPD)="1"_$S(PSJSAR]"":"^"_PSJSAR,1:""),(PSJQ,PSJX)=1,PSJXCL(PSJPD)=1
"RTN","PSJPDCL",124,0)
 . K:'PSJX PSJAP(PSJPD)
"RTN","PSJPDCL",125,0)
 Q PSJQ
"RTN","PSJPDCL",126,0)
 ;
"RTN","PSJPDCL",127,0)
REACT ;
"RTN","PSJPDCL",128,0)
 N REAC S REAC="",IDX=0
"RTN","PSJPDCL",129,0)
 F  S IDX=$O(ADTL("S",IDX)) Q:IDX=""  D
"RTN","PSJPDCL",130,0)
 . I IDX>1 S REAC=REAC_NECH_$G(ADTL("S",IDX))
"RTN","PSJPDCL",131,0)
 . E  S REAC=$G(ADTL("S",IDX))
"RTN","PSJPDCL",132,0)
 S:REAC]"" $P(SEG,NFS,6)=REAC
"RTN","PSJPDCL",133,0)
 Q
"RTN","PSJPDCL",134,0)
 ;
"RTN","PSJPDCL",135,0)
AGY ;
"RTN","PSJPDCL",136,0)
 N SEG,GMRA,GMRAL
"RTN","PSJPDCL",137,0)
 S GMRA="0^0^111" D ^GMRADPT
"RTN","PSJPDCL",138,0)
 I GMRAL="" G OBX
"RTN","PSJPDCL",139,0)
 ;No known
"RTN","PSJPDCL",140,0)
 I GMRAL=0 D
"RTN","PSJPDCL",141,0)
 .S $P(SEG,NFS,1)="AL1"
"RTN","PSJPDCL",142,0)
 .S $P(SEG,NFS,2)=1
"RTN","PSJPDCL",143,0)
 .S $P(SEG,NFS,3)="OA"
"RTN","PSJPDCL",144,0)
 .S $P(SEG,NFS,4)="0;GMRD(120.82,"_NECH_"NO KNOWN ALLERGIES"
"RTN","PSJPDCL",145,0)
 .S $P(SEG,NFS,6)=""
"RTN","PSJPDCL",146,0)
 .S $P(SEG,NFS,7)=$$FMTHL7^XLFDT($$GET1^DIQ(120.86,DFN,3,"I"))
"RTN","PSJPDCL",147,0)
 .S SEQ=SEQ+1
"RTN","PSJPDCL",148,0)
 .S NSEG(SEQ)=SEG
"RTN","PSJPDCL",149,0)
 ;
"RTN","PSJPDCL",150,0)
 ;Yes, allergies
"RTN","PSJPDCL",151,0)
 I GMRAL=1 N KK,ACT,AEXT,ND D
"RTN","PSJPDCL",152,0)
 .S KK=0,ACT=0
"RTN","PSJPDCL",153,0)
 .F  S KK=$O(GMRAL(KK)) Q:'KK  D
"RTN","PSJPDCL",154,0)
 ..S ND=GMRAL(KK)
"RTN","PSJPDCL",155,0)
 ..S AEXT=$P(ND,U,2)
"RTN","PSJPDCL",156,0)
 ..S ACT=ACT+1
"RTN","PSJPDCL",157,0)
 ..S $P(SEG,NFS,1)="AL1"
"RTN","PSJPDCL",158,0)
 ..S $P(SEG,NFS,2)=ACT
"RTN","PSJPDCL",159,0)
 ..S $P(SEG,NFS,3)=$S($P(ND,U,3)="D":"DA",$P(ND,U,3)="F":"FA",1:"OA")
"RTN","PSJPDCL",160,0)
 ..S $P(SEG,NFS,4)=$P(ND,U,9)_NECH_AEXT
"RTN","PSJPDCL",161,0)
 ..N ADTL D EN1^GMRAOR2(KK,"ADTL") D:$O(ADTL("O",""))
"RTN","PSJPDCL",162,0)
 ... N IDX,SEV
"RTN","PSJPDCL",163,0)
 ... S IDX=$O(ADTL("O","")),SEV=$P($G(ADTL("O",IDX)),"^",2)
"RTN","PSJPDCL",164,0)
 ... S SEV=$S(SEV="MILD":"MI",SEV="MODERATE":"MO",SEV="SEVERE":"SV",1:"U")
"RTN","PSJPDCL",165,0)
 ... S $P(SEG,NFS,5)=SEV
"RTN","PSJPDCL",166,0)
 ..D:$O(ADTL("S","")) REACT
"RTN","PSJPDCL",167,0)
 ..S $P(SEG,NFS,7)=$$FMTHL7^XLFDT($$GET1^DIQ(120.8,KK,4,"I"))
"RTN","PSJPDCL",168,0)
 ..S SEQ=SEQ+1
"RTN","PSJPDCL",169,0)
 ..S NSEG(SEQ)=SEG,SEG=""
"RTN","PSJPDCL",170,0)
OBX ;HT,WT
"RTN","PSJPDCL",171,0)
 N GMRVSTR
"RTN","PSJPDCL",172,0)
 S GMRVSTR="HT" D EN6^GMRVUTL
"RTN","PSJPDCL",173,0)
 I X]"" S $P(SEG,NFS,1)="OBX",$P(SEG,NFS,2)=1,$P(SEG,NFS,3)="CE",$P(SEG,NFS,4)="1010.3"_NECH_"HEIGHT" D
"RTN","PSJPDCL",174,0)
 .S $P(SEG,NFS,6)=$J($P(X,U,8)*2.54,0,2),$P(SEG,NFS,7)="cm"
"RTN","PSJPDCL",175,0)
 .S $P(SEG,NFS,15)=$$HLDATE^HLFNC($P(X,U))
"RTN","PSJPDCL",176,0)
 .S SEQ=SEQ+1
"RTN","PSJPDCL",177,0)
 .S NSEG(SEQ)=SEG,SEG=""
"RTN","PSJPDCL",178,0)
 S GMRVSTR="WT" D EN6^GMRVUTL
"RTN","PSJPDCL",179,0)
 I X]"" S $P(SEG,NFS,1)="OBX",$P(SEG,NFS,2)=2,$P(SEG,NFS,3)="CE",$P(SEG,NFS,4)="1010.1"_NECH_"WEIGHT" D
"RTN","PSJPDCL",180,0)
 .S $P(SEG,NFS,6)=$J($P(X,U,8)/2.2046226,0,2),$P(SEG,NFS,7)="kg"
"RTN","PSJPDCL",181,0)
 .S $P(SEG,NFS,15)=$$HLDATE^HLFNC($P(X,"^"))
"RTN","PSJPDCL",182,0)
 .S SEQ=SEQ+1
"RTN","PSJPDCL",183,0)
 .S NSEG(SEQ)=SEG,SEG=""
"RTN","PSJPDCL",184,0)
 Q
"RTN","PSJPDCL",185,0)
 ;
"RTN","PSJPDCL",186,0)
A08 ;
"RTN","PSJPDCL",187,0)
 K ^TMP("A08")
"RTN","PSJPDCL",188,0)
 M ^TMP("A08","HLS")=^TMP("HLS",$J)
"RTN","PSJPDCL",189,0)
 M ^TMP("A08","HL")=HL
"RTN","PSJPDCL",190,0)
 Q:$O(^PS(58.7,"B",""))=""
"RTN","PSJPDCL",191,0)
 Q:$D(HL)=1
"RTN","PSJPDCL",192,0)
 Q:'$D(^TMP("HLS",$J))
"RTN","PSJPDCL",193,0)
 N XX,HLN,PSJND,PSJCLN,PSJCLNI,PSJDIV,PSJX S (PSJX,XX)=0
"RTN","PSJPDCL",194,0)
 F  S XX=$O(^TMP("HLS",$J,XX)) Q:'XX!(PSJX)  D
"RTN","PSJPDCL",195,0)
 . S HLN=^TMP("HLS",$J,XX)
"RTN","PSJPDCL",196,0)
 . I $E(HLN,1,3)="PV1" D
"RTN","PSJPDCL",197,0)
 .. S PSJCLN=$P(HLN,FS,4)
"RTN","PSJPDCL",198,0)
 .. S PSJCLNI=$O(^SC("B",PSJCLN,0))
"RTN","PSJPDCL",199,0)
 .. I 'PSJCLNI S PSJX=1 Q
"RTN","PSJPDCL",200,0)
 .. S PSJDIV=$P($G(^SC(PSJCLNI,0)),"^",15)
"RTN","PSJPDCL",201,0)
 .. I 'PSJDIV S PSJX=1 Q
"RTN","PSJPDCL",202,0)
 .. N PSJPD,PSJSAR,PSJQ S (PSJQ,PSJPD)=0
"RTN","PSJPDCL",203,0)
 .. F  S PSJPD=$O(^PS(58.7,"AD",PSJDIV,PSJPD)) Q:'PSJPD  D
"RTN","PSJPDCL",204,0)
 ... I '$D(^PS(58.7,PSJPD,0)) Q
"RTN","PSJPDCL",205,0)
 ... N PSJVNM,PSJDNS,PSJVP,PSJACT S PSJND=$G(^PS(58.7,PSJPD,0))
"RTN","PSJPDCL",206,0)
 ... S PSJVNM=$P(PSJND,"^"),PSJDNS=$P(PSJND,"^",2),PSJVP=$P(PSJND,"^",3)
"RTN","PSJPDCL",207,0)
 ... I PSJVNM=""!(PSJDNS="")!('PSJVP) Q
"RTN","PSJPDCL",208,0)
 ... S PSJACT=$P(PSJND,"^",4)
"RTN","PSJPDCL",209,0)
 ... I PSJACT&(PSJACT<DT) Q
"RTN","PSJPDCL",210,0)
 ... S PSJDIVI=$O(^PS(58.7,PSJPD,"DIV","B",PSJDIV,0))
"RTN","PSJPDCL",211,0)
 ... S PSJACT=$G(^PS(58.7,PSJPD,"DIV",PSJDIVI,0))
"RTN","PSJPDCL",212,0)
 ... S PSJACT=$P(PSJACT,"^",2)
"RTN","PSJPDCL",213,0)
 ... I PSJACT,PSJACT<DT Q
"RTN","PSJPDCL",214,0)
 ... S PSJQ=1,PSJQ(PSJPD)=1
"RTN","PSJPDCL",215,0)
 Q:'PSJQ 
"RTN","PSJPDCL",216,0)
 N SNM,SID S SNM="PSJ ADT-A08 SERVER"
"RTN","PSJPDCL",217,0)
 S SID=$O(^ORD(101,"B",SNM,0))
"RTN","PSJPDCL",218,0)
 Q:'SID
"RTN","PSJPDCL",219,0)
 D INIT^HLFNC2(SID,.NHL) Q:$D(NHL)=1
"RTN","PSJPDCL",220,0)
 N NFS,NECH S NFS=NHL("FS"),NECH=$E(NHL("ECH"),1)
"RTN","PSJPDCL",221,0)
 Q
"RTN","PSJPDCL",222,0)
 ;
"RTN","PSJPDCL",223,0)
ROOMBED(RMBDNAM,WARDIEN) ; Return the Room-Bed IEN - 379
"RTN","PSJPDCL",224,0)
 N ROOMBED,RMBD
"RTN","PSJPDCL",225,0)
 S (RMBD,ROOMBED)=0
"RTN","PSJPDCL",226,0)
 F  S RMBD=$O(^DG(405.4,"B",RMBDNAM,RMBD)) Q:'RMBD  D  I ROOMBED Q
"RTN","PSJPDCL",227,0)
 . I $D(^DG(405.4,RMBD,"W","B",WARDIEN)) S ROOMBED=RMBD
"RTN","PSJPDCL",228,0)
 Q ROOMBED
"RTN","PSJPDCL",229,0)
 ;
"VER")
8.0^22.2
"BLD",11145,6)
^333
**END**
**END**

