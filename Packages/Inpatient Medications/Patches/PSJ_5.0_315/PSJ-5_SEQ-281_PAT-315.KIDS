Released PSJ*5*315 SEQ #281
Extracted from mail message
**KIDS**:PSJ*5.0*315^

**INSTALL NAME**
PSJ*5.0*315
"BLD",9241,0)
PSJ*5.0*315^INPATIENT MEDICATIONS^0^3160727^y
"BLD",9241,1,0)
^^162^162^3160510^
"BLD",9241,1,1,0)
******************************* ATTENTION ********************************
"BLD",9241,1,2,0)
  
"BLD",9241,1,3,0)
Clinical Ancillary Services (CAS) Development-Delivery of Pharmacy 
"BLD",9241,1,4,0)
Enhancements (DDPE) VA Inpatient Medication Administration - Transdermal
"BLD",9241,1,5,0)
enhancement includes 5 patches that must be installed in the following
"BLD",9241,1,6,0)
order:
"BLD",9241,1,7,0)
 
"BLD",9241,1,8,0)
1.      PSS*1*191
"BLD",9241,1,9,0)
2.      PSJ*5*315
"BLD",9241,1,10,0)
3.      PSB*3*83
"BLD",9241,1,11,0)
4.      PSB*3*87
"BLD",9241,1,12,0)
5.      OR*3*417
"BLD",9241,1,13,0)
 
"BLD",9241,1,14,0)
ATTENTION: This enhancement also includes a new Graphical User Interface
"BLD",9241,1,15,0)
(GUI) executable, BCMA GUI PSB3_P083.EXE. Installation of this GUI is
"BLD",9241,1,16,0)
required immediately after the KIDS install for the Patch to function.
"BLD",9241,1,17,0)
 
"BLD",9241,1,18,0)
For retrieval and installation instructions, please see the Client 
"BLD",9241,1,19,0)
Installation Instructions section.
"BLD",9241,1,20,0)
**************************************************************************
"BLD",9241,1,21,0)
 
"BLD",9241,1,22,0)
Patch PSJ*5.0*315 provides enhancements to the Inpatient Medications 
"BLD",9241,1,23,0)
application and to support enhancements for the Bar Code Medications 
"BLD",9241,1,24,0)
Administrations (BCMA) application for Transdermal Administrations. These 
"BLD",9241,1,25,0)
enhancements include:
"BLD",9241,1,26,0)
 
"BLD",9241,1,27,0)
     1. Currently Sites have to create fake removal orders to allow for 
"BLD",9241,1,28,0)
appropriate removal of medications in BCMA.  This patch will alleviate 
"BLD",9241,1,29,0)
that issue by prompting the user for DURATION OF ADMINISTRATION based on
"BLD",9241,1,30,0)
the value stored in the PROMPT FOR REMOVAL IN BCMA field (#12) contained
"BLD",9241,1,31,0)
in the ORDERABLE ITEM file (#50.7).  This field implements changes that
"BLD",9241,1,32,0)
will support enhancements to the BCMA and Inpatient Medication
"BLD",9241,1,33,0)
applications to display the removal times in Inpatient Medication orders
"BLD",9241,1,34,0)
using rules determined by the value of this field. The PROMPT FOR REMOVAL
"BLD",9241,1,35,0)
IN BCMA field (#12) can be set for Orderable Items that require removal to
"BLD",9241,1,36,0)
the following values:
"BLD",9241,1,37,0)
 
"BLD",9241,1,38,0)
     NULL/0=No Removal Required 
"BLD",9241,1,39,0)
     1 = Removal at Next Administration 
"BLD",9241,1,40,0)
     2 = Removal Period Optional Prior to Next Administration  
"BLD",9241,1,41,0)
     3 = Removal Period Required Prior to Next Administration
"BLD",9241,1,42,0)
 
"BLD",9241,1,43,0)
 
"BLD",9241,1,44,0)
     2. Routines added for this patch will add the new DURATION OF 
"BLD",9241,1,45,0)
ADMINISTRATION prompt to the option Inpatient Order Entry [PSJ OE] then 
"BLD",9241,1,46,0)
calculate the appropriate removal times and display them for verification.
"BLD",9241,1,47,0)
The NON-VERIFIED ORDERS file (#53.1) and UNIT DOSE sub-file(#62) of the 
"BLD",9241,1,48,0)
PHARMACY PATIENT file (#55) will be updated to include new fields that 
"BLD",9241,1,49,0)
will control the removal process.  These two files will have these 4
"BLD",9241,1,50,0)
fields added: DURATION OF ADMINISTRATION field (#137), REMOVE TIMES
"BLD",9241,1,51,0)
field(#138), REMOVE PERIOD field(#139) and BCMA PROMPT FOR REMOVAL FLAG
"BLD",9241,1,52,0)
field(#140).  A new field called PROMPT FOR REMOVAL IN BCMA field(#12)
"BLD",9241,1,53,0)
created in the ORDERABLE ITEMS file (#50.7) by patch PSS*1.0*191 will be
"BLD",9241,1,54,0)
used for information to be stored in the BCMA PROMPT FOR REMOVAL FLAG
"BLD",9241,1,55,0)
field(#140) in the NON-VERIFIED ORDERS file(#53.1) and the UNIT DOSE
"BLD",9241,1,56,0)
sub-file(#62) of the PHARMACY PATIENT file (#55).
"BLD",9241,1,57,0)
 
"BLD",9241,1,58,0)
     3. The Edit Clinic Med Orders Start Date/Time [PSJ ECO] option will 
"BLD",9241,1,59,0)
have changes to anticipate these new fields and request additional user 
"BLD",9241,1,60,0)
activity when the orders require specific information that can 
"BLD",9241,1,61,0)
only be entered via the Inpatient Order Entry [PSJ OE] option.
"BLD",9241,1,62,0)
 
"BLD",9241,1,63,0)
     4. This patch contains a post-install routine PSJ5P315 that sends a 
"BLD",9241,1,64,0)
report listing all legacy orders for Medications that require removal.  
"BLD",9241,1,65,0)
In order to prevent confusion by users of the BCMA GUI application these 
"BLD",9241,1,66,0)
orders will need to be discontinued and reordered to include the
"BLD",9241,1,67,0)
removal information.  This same report can be recalled from the Pharmacy
"BLD",9241,1,68,0)
Data Management [PSS MGR] menu using the Orders for MRRs With Removal
"BLD",9241,1,69,0)
Properties [PSS MRR ORDERS DIAGNOSTIC RPT] option.
"BLD",9241,1,70,0)
 
"BLD",9241,1,71,0)
     5. The Order View Hidden Actions Menu [PSJ LM ORDER VIEW HIDDEN
"BLD",9241,1,72,0)
ACTIONS] protocol has been modified to include a hidden action for calling
"BLD",9241,1,73,0)
the Administration History report. A new protocol, Admin History for OI
"BLD",9241,1,74,0)
[PSJ LM ADM HIST], was added for the new hidden action.  This report 
"BLD",9241,1,75,0)
allows viewing of other orders for the Orderable Item listed in the Order
"BLD",9241,1,76,0)
Detail for the selected Order. The menu item Other Pharmacy Options [PSJ
"BLD",9241,1,77,0)
LM OTHER PHARMACY OPTIONS] has been shortened to read Other Pharm Options
"BLD",9241,1,78,0)
in order to allow the columns to align correctly.  The AH menu option 
"BLD",9241,1,79,0)
will not be available during the period in which PSJ*5.0*315 is installed,
"BLD",9241,1,80,0)
but PSB*3.0*83 is not.  If the user attempts to run this option during 
"BLD",9241,1,81,0)
this time they will get the following message: Report not available until
"BLD",9241,1,82,0)
install of patch PSB*3.0*83.
"BLD",9241,1,83,0)
 
"BLD",9241,1,84,0)
       This patch requires patch PSS*1.0*191.
"BLD",9241,1,85,0)
       
"BLD",9241,1,86,0)
       The full functionality introduced in this patch will not be
"BLD",9241,1,87,0)
       available until patches PSB*3.0*83 and possibly PSB*3.0*87 
"BLD",9241,1,88,0)
       for Bar Code Back Up (BCBU) are installed.
"BLD",9241,1,89,0)
 
"BLD",9241,1,90,0)
       Pre-existing orders will remain unaffected with installation.
"BLD",9241,1,91,0)
 
"BLD",9241,1,92,0)
 
"BLD",9241,1,93,0)
********** SPECIAL NOTE on Times Per Day (TPD) orders**********:
"BLD",9241,1,94,0)
 
"BLD",9241,1,95,0)
     To avoid confusion it is strongly recommended that  MRR medications
"BLD",9241,1,96,0)
needing to use a TPD schedule with asynchronous administrations and
"BLD",9241,1,97,0)
removals, be set to have the PROMPT FOR REMOVAL IN BCMA (#12) set to a
"BLD",9241,1,98,0)
value of 3.  The Pharmacist will then always be prompted for the Duration
"BLD",9241,1,99,0)
of Administration and a proper removal time can be entered in the
"BLD",9241,1,100,0)
Inpatient Order Entry [PSJ OE] option. 
"BLD",9241,1,101,0)
     
"BLD",9241,1,102,0)
     In order to maintain adequate flexibility for Times per Day (TPD)
"BLD",9241,1,103,0)
     schedules such as BID, TID and QID for MRR medication orders; these 
"BLD",9241,1,104,0)
     schedules are not validated to the extent that other continuous
"BLD",9241,1,105,0)
     schedule types are validated.  The intent was to allow a variety of
"BLD",9241,1,106,0)
     administrations and removals that may be asynchronous in order to
"BLD",9241,1,107,0)
     process correctly; for instance this will allow having two
"BLD",9241,1,108,0)
     administrations 6 hours apart followed by a 12 hour medication-free
"BLD",9241,1,109,0)
     period.  
"BLD",9241,1,110,0)
 
"BLD",9241,1,111,0)
        Normally the frequency used by the existing ADMINISTRATION 
"BLD",9241,1,112,0)
SCHEDULE file (#51.1) setup would expect a 12 hour frequency for 
"BLD",9241,1,113,0)
continuous schedule types ( 24 hours divided by 2 administrations equals
"BLD",9241,1,114,0)
12 ) and this is what is standard practice.
"BLD",9241,1,115,0)
        
"BLD",9241,1,116,0)
        Existing MRRs set to have the medication removed at the next 
"BLD",9241,1,117,0)
Duration of Administration would need to have a Duration of Administration
"BLD",9241,1,118,0)
value entered for TPD schedules, otherwise the stored frequency in the
"BLD",9241,1,119,0)
ADMINISTRATION SCHEDULE file (#51.1) would be used and this could result 
"BLD",9241,1,120,0)
in an incorrect removal period.  Therefore we recommend setting the MRR
"BLD",9241,1,121,0)
value to a 3 (Duration of Administration Required). If the MRR is set to a
"BLD",9241,1,122,0)
value of 1 in the PROMPT FOR REMOVAL IN BCMA field (#12), the Pharmacist
"BLD",9241,1,123,0)
would not receive the verification screen that appears for  Duration of
"BLD",9241,1,124,0)
Administration entries and may not be aware of this issue.
"BLD",9241,1,125,0)
        
"BLD",9241,1,126,0)
The following is an example of using a type 1 Prompt for Removal in BCMA
"BLD",9241,1,127,0)
for TPD's (Not recommended Condition):
"BLD",9241,1,128,0)
 
"BLD",9241,1,129,0)
     The MRR medication needs to be administered at 0900 and removed 
"BLD",9241,1,130,0)
at 1500, with a new administration added at 1500 then removed at 2100.  
"BLD",9241,1,131,0)
       
"BLD",9241,1,132,0)
     The BID  schedule is used with the PROMPT FOR REMOVAL IN BCMAPrompt 
"BLD",9241,1,133,0)
for Removal in BCMA 
"BLD",9241,1,134,0)
field (#12)  value set to a 1 and the Frequency for BID schedule set to 
"BLD",9241,1,135,0)
12 hours.
"BLD",9241,1,136,0)
     
"BLD",9241,1,137,0)
     The Pharmacist would only see the administration times of 0900 
"BLD",9241,1,138,0)
and 1500.
"BLD",9241,1,139,0)
       
"BLD",9241,1,140,0)
     The system would then use the frequency stored in the 
"BLD",9241,1,141,0)
ADMINISTRATION SCHEDULE file (#51.1) Administration schedule file of 12 
"BLD",9241,1,142,0)
hours, so that Removal Times on the
"BLD",9241,1,143,0)
enhanced BCMA would then calculate as removal at 2100 and 0300, which 
"BLD",9241,1,144,0)
would be in conflict with the administration times.
"BLD",9241,1,145,0)
 
"BLD",9241,1,146,0)
The following is an example of using a type 3 Prompt for Removal in BCMA
"BLD",9241,1,147,0)
for TPD's (Recommended condition):
"BLD",9241,1,148,0)
 
"BLD",9241,1,149,0)
     The MRR medication needs to be administered at 0900 and removed 
"BLD",9241,1,150,0)
at 1500, with a new administration added at 1500 then removed at 2100.  
"BLD",9241,1,151,0)
       
"BLD",9241,1,152,0)
     The BID  schedule is used with the PROMPT FOR REMOVAL IN BCMA 
"BLD",9241,1,153,0)
field (#12)  value set to a 3.  In this case the Frequency is no longer 
"BLD",9241,1,154,0)
used. 
"BLD",9241,1,155,0)
       
"BLD",9241,1,156,0)
     The Pharmacist would see the administration times of 0900 and 
"BLD",9241,1,157,0)
1500 and enter the appropriate Duration of Administration  which would be 
"BLD",9241,1,158,0)
6 hours.
"BLD",9241,1,159,0)
       
"BLD",9241,1,160,0)
     The system would create a verification display showing 
"BLD",9241,1,161,0)
administration at 0900 followed by and Administration and Removal at 1500 
"BLD",9241,1,162,0)
then a Removal at 2100 as ordered by the Physician.
"BLD",9241,4,0)
^9.64PA^55^2
"BLD",9241,4,53.1,0)
53.1
"BLD",9241,4,53.1,2,0)
^9.641^53.1^1
"BLD",9241,4,53.1,2,53.1,0)
NON-VERIFIED ORDERS  (File-top level)
"BLD",9241,4,53.1,2,53.1,1,0)
^9.6411^140^4
"BLD",9241,4,53.1,2,53.1,1,137,0)
DURATION OF ADMINISTRATION (minutes)
"BLD",9241,4,53.1,2,53.1,1,138,0)
REMOVE TIMES
"BLD",9241,4,53.1,2,53.1,1,139,0)
REMOVE PERIOD (in minutes)
"BLD",9241,4,53.1,2,53.1,1,140,0)
BCMA PROMPT FOR REMOVAL FLAG
"BLD",9241,4,53.1,222)
y^n^p^^^^n^^n
"BLD",9241,4,53.1,224)
 
"BLD",9241,4,55,0)
55
"BLD",9241,4,55,2,0)
^9.641^55.06^1
"BLD",9241,4,55,2,55.06,0)
UNIT DOSE  (sub-file)
"BLD",9241,4,55,2,55.06,1,0)
^9.6411^140^4
"BLD",9241,4,55,2,55.06,1,137,0)
DURATION OF ADMINISTRATION
"BLD",9241,4,55,2,55.06,1,138,0)
REMOVE TIMES
"BLD",9241,4,55,2,55.06,1,139,0)
REMOVE PERIOD (in minutes)
"BLD",9241,4,55,2,55.06,1,140,0)
BCMA PROMPT FOR REMOVAL FLAG
"BLD",9241,4,55,222)
y^n^p^^^^n^^n
"BLD",9241,4,55,224)
 
"BLD",9241,4,"APDD",53.1,53.1)
 
"BLD",9241,4,"APDD",53.1,53.1,137)
 
"BLD",9241,4,"APDD",53.1,53.1,138)
 
"BLD",9241,4,"APDD",53.1,53.1,139)
 
"BLD",9241,4,"APDD",53.1,53.1,140)
 
"BLD",9241,4,"APDD",55,55.06)
 
"BLD",9241,4,"APDD",55,55.06,137)
 
"BLD",9241,4,"APDD",55,55.06,138)
 
"BLD",9241,4,"APDD",55,55.06,139)
 
"BLD",9241,4,"APDD",55,55.06,140)
 
"BLD",9241,4,"B",53.1,53.1)
 
"BLD",9241,4,"B",55,55)
 
"BLD",9241,6.3)
73
"BLD",9241,"ABPKG")
n
"BLD",9241,"INI")
 
"BLD",9241,"INID")
^n^
"BLD",9241,"INIT")
QUE^PSJ5P315
"BLD",9241,"KRN",0)
^9.67PA^9002226^21
"BLD",9241,"KRN",.4,0)
.4
"BLD",9241,"KRN",.401,0)
.401
"BLD",9241,"KRN",.402,0)
.402
"BLD",9241,"KRN",.403,0)
.403
"BLD",9241,"KRN",.5,0)
.5
"BLD",9241,"KRN",.84,0)
.84
"BLD",9241,"KRN",3.6,0)
3.6
"BLD",9241,"KRN",3.8,0)
3.8
"BLD",9241,"KRN",9.2,0)
9.2
"BLD",9241,"KRN",9.8,0)
9.8
"BLD",9241,"KRN",9.8,"NM",0)
^9.68A^53^38
"BLD",9241,"KRN",9.8,"NM",1,0)
PSGOE41^^0^B97415312
"BLD",9241,"KRN",9.8,"NM",2,0)
PSGOE8^^0^B52703048
"BLD",9241,"KRN",9.8,"NM",3,0)
PSGOE9^^0^B45686408
"BLD",9241,"KRN",9.8,"NM",4,0)
PSGOETO^^0^B39634920
"BLD",9241,"KRN",9.8,"NM",5,0)
PSGOD^^0^B25616562
"BLD",9241,"KRN",9.8,"NM",6,0)
PSGOEF^^0^B119034802
"BLD",9241,"KRN",9.8,"NM",7,0)
PSGOEF1^^0^B30874451
"BLD",9241,"KRN",9.8,"NM",12,0)
PSJLMUDE^^0^B69470677
"BLD",9241,"KRN",9.8,"NM",14,0)
PSJOE1^^0^B31281544
"BLD",9241,"KRN",9.8,"NM",15,0)
PSGOE0^^0^B13276254
"BLD",9241,"KRN",9.8,"NM",16,0)
PSGOE1^^0^B29572227
"BLD",9241,"KRN",9.8,"NM",17,0)
PSGOE3^^0^B25305463
"BLD",9241,"KRN",9.8,"NM",18,0)
PSGOEM^^0^B46502031
"BLD",9241,"KRN",9.8,"NM",19,0)
PSJLMGUD^^0^B31031159
"BLD",9241,"KRN",9.8,"NM",22,0)
PSGOEE^^0^B103314834
"BLD",9241,"KRN",9.8,"NM",23,0)
PSGOEE0^^0^B31021765
"BLD",9241,"KRN",9.8,"NM",24,0)
PSGOEEW^^0^B28844185
"BLD",9241,"KRN",9.8,"NM",26,0)
PSGOER^^0^B87272469
"BLD",9241,"KRN",9.8,"NM",28,0)
PSGOT^^0^B23271906
"BLD",9241,"KRN",9.8,"NM",29,0)
PSGOTR^^0^B22276864
"BLD",9241,"KRN",9.8,"NM",31,0)
PSGVW^^0^B32841979
"BLD",9241,"KRN",9.8,"NM",32,0)
PSJCLOR2^^0^B116946050
"BLD",9241,"KRN",9.8,"NM",34,0)
PSJCLOR5^^0^B94059685
"BLD",9241,"KRN",9.8,"NM",36,0)
PSJHL7^^0^B55553130
"BLD",9241,"KRN",9.8,"NM",39,0)
PSJORRE^^0^B37472856
"BLD",9241,"KRN",9.8,"NM",40,0)
PSJBCMA^^0^B138494525
"BLD",9241,"KRN",9.8,"NM",41,0)
PSJOE^^0^B105816972
"BLD",9241,"KRN",9.8,"NM",42,0)
PSGOE^^0^B26260388
"BLD",9241,"KRN",9.8,"NM",43,0)
PSJBCMA1^^0^B132466379
"BLD",9241,"KRN",9.8,"NM",44,0)
PSJCOM^^0^B42503350
"BLD",9241,"KRN",9.8,"NM",45,0)
PSJOEA^^0^B31606537
"BLD",9241,"KRN",9.8,"NM",46,0)
PSJORRE1^^0^B42580655
"BLD",9241,"KRN",9.8,"NM",47,0)
PSJCOM1^^0^B49883276
"BLD",9241,"KRN",9.8,"NM",49,0)
PSGVW0^^0^B11075567
"BLD",9241,"KRN",9.8,"NM",50,0)
PSGOE81^^0^B107835999
"BLD",9241,"KRN",9.8,"NM",51,0)
PSGOE91^^0^B114506960
"BLD",9241,"KRN",9.8,"NM",52,0)
PSJHL3^^0^B118359131
"BLD",9241,"KRN",9.8,"NM",53,0)
PSGAH^^0^B25445995
"BLD",9241,"KRN",9.8,"NM","B","PSGAH",53)
 
"BLD",9241,"KRN",9.8,"NM","B","PSGOD",5)
 
"BLD",9241,"KRN",9.8,"NM","B","PSGOE",42)
 
"BLD",9241,"KRN",9.8,"NM","B","PSGOE0",15)
 
"BLD",9241,"KRN",9.8,"NM","B","PSGOE1",16)
 
"BLD",9241,"KRN",9.8,"NM","B","PSGOE3",17)
 
"BLD",9241,"KRN",9.8,"NM","B","PSGOE41",1)
 
"BLD",9241,"KRN",9.8,"NM","B","PSGOE8",2)
 
"BLD",9241,"KRN",9.8,"NM","B","PSGOE81",50)
 
"BLD",9241,"KRN",9.8,"NM","B","PSGOE9",3)
 
"BLD",9241,"KRN",9.8,"NM","B","PSGOE91",51)
 
"BLD",9241,"KRN",9.8,"NM","B","PSGOEE",22)
 
"BLD",9241,"KRN",9.8,"NM","B","PSGOEE0",23)
 
"BLD",9241,"KRN",9.8,"NM","B","PSGOEEW",24)
 
"BLD",9241,"KRN",9.8,"NM","B","PSGOEF",6)
 
"BLD",9241,"KRN",9.8,"NM","B","PSGOEF1",7)
 
"BLD",9241,"KRN",9.8,"NM","B","PSGOEM",18)
 
"BLD",9241,"KRN",9.8,"NM","B","PSGOER",26)
 
"BLD",9241,"KRN",9.8,"NM","B","PSGOETO",4)
 
"BLD",9241,"KRN",9.8,"NM","B","PSGOT",28)
 
"BLD",9241,"KRN",9.8,"NM","B","PSGOTR",29)
 
"BLD",9241,"KRN",9.8,"NM","B","PSGVW",31)
 
"BLD",9241,"KRN",9.8,"NM","B","PSGVW0",49)
 
"BLD",9241,"KRN",9.8,"NM","B","PSJBCMA",40)
 
"BLD",9241,"KRN",9.8,"NM","B","PSJBCMA1",43)
 
"BLD",9241,"KRN",9.8,"NM","B","PSJCLOR2",32)
 
"BLD",9241,"KRN",9.8,"NM","B","PSJCLOR5",34)
 
"BLD",9241,"KRN",9.8,"NM","B","PSJCOM",44)
 
"BLD",9241,"KRN",9.8,"NM","B","PSJCOM1",47)
 
"BLD",9241,"KRN",9.8,"NM","B","PSJHL3",52)
 
"BLD",9241,"KRN",9.8,"NM","B","PSJHL7",36)
 
"BLD",9241,"KRN",9.8,"NM","B","PSJLMGUD",19)
 
"BLD",9241,"KRN",9.8,"NM","B","PSJLMUDE",12)
 
"BLD",9241,"KRN",9.8,"NM","B","PSJOE",41)
 
"BLD",9241,"KRN",9.8,"NM","B","PSJOE1",14)
 
"BLD",9241,"KRN",9.8,"NM","B","PSJOEA",45)
 
"BLD",9241,"KRN",9.8,"NM","B","PSJORRE",39)
 
"BLD",9241,"KRN",9.8,"NM","B","PSJORRE1",46)
 
"BLD",9241,"KRN",19,0)
19
"BLD",9241,"KRN",19,"NM",0)
^9.68A^^
"BLD",9241,"KRN",19.1,0)
19.1
"BLD",9241,"KRN",101,0)
101
"BLD",9241,"KRN",101,"NM",0)
^9.68A^2^2
"BLD",9241,"KRN",101,"NM",1,0)
PSJ LM ADM HIST^^0
"BLD",9241,"KRN",101,"NM",2,0)
PSJ LM ORDER VIEW HIDDEN ACTIONS^^2
"BLD",9241,"KRN",101,"NM","B","PSJ LM ADM HIST",1)
 
"BLD",9241,"KRN",101,"NM","B","PSJ LM ORDER VIEW HIDDEN ACTIONS",2)
 
"BLD",9241,"KRN",409.61,0)
409.61
"BLD",9241,"KRN",771,0)
771
"BLD",9241,"KRN",779.2,0)
779.2
"BLD",9241,"KRN",870,0)
870
"BLD",9241,"KRN",8989.51,0)
8989.51
"BLD",9241,"KRN",8989.52,0)
8989.52
"BLD",9241,"KRN",8994,0)
8994
"BLD",9241,"KRN",8994,"NM",0)
^9.68A^^
"BLD",9241,"KRN",9002226,0)
9002226
"BLD",9241,"KRN","B",.4,.4)
 
"BLD",9241,"KRN","B",.401,.401)
 
"BLD",9241,"KRN","B",.402,.402)
 
"BLD",9241,"KRN","B",.403,.403)
 
"BLD",9241,"KRN","B",.5,.5)
 
"BLD",9241,"KRN","B",.84,.84)
 
"BLD",9241,"KRN","B",3.6,3.6)
 
"BLD",9241,"KRN","B",3.8,3.8)
 
"BLD",9241,"KRN","B",9.2,9.2)
 
"BLD",9241,"KRN","B",9.8,9.8)
 
"BLD",9241,"KRN","B",19,19)
 
"BLD",9241,"KRN","B",19.1,19.1)
 
"BLD",9241,"KRN","B",101,101)
 
"BLD",9241,"KRN","B",409.61,409.61)
 
"BLD",9241,"KRN","B",771,771)
 
"BLD",9241,"KRN","B",779.2,779.2)
 
"BLD",9241,"KRN","B",870,870)
 
"BLD",9241,"KRN","B",8989.51,8989.51)
 
"BLD",9241,"KRN","B",8989.52,8989.52)
 
"BLD",9241,"KRN","B",8994,8994)
 
"BLD",9241,"KRN","B",9002226,9002226)
 
"BLD",9241,"QDEF")
^^^^NO^^^^NO^^NO
"BLD",9241,"QUES",0)
^9.62^^
"BLD",9241,"REQB",0)
^9.611^11^10
"BLD",9241,"REQB",1,0)
PSS*1.0*191^2
"BLD",9241,"REQB",2,0)
PSJ*5.0*255^2
"BLD",9241,"REQB",4,0)
PSJ*5.0*318^2
"BLD",9241,"REQB",5,0)
PSJ*5.0*281^2
"BLD",9241,"REQB",6,0)
PSJ*5.0*216^2
"BLD",9241,"REQB",7,0)
PSJ*5.0*252^2
"BLD",9241,"REQB",8,0)
PSJ*5.0*268^2
"BLD",9241,"REQB",9,0)
PSJ*5.0*278^2
"BLD",9241,"REQB",10,0)
PSJ*5.0*285^2
"BLD",9241,"REQB",11,0)
PSJ*5.0*287^2
"BLD",9241,"REQB","B","PSJ*5.0*216",6)
 
"BLD",9241,"REQB","B","PSJ*5.0*252",7)
 
"BLD",9241,"REQB","B","PSJ*5.0*255",2)
 
"BLD",9241,"REQB","B","PSJ*5.0*268",8)
 
"BLD",9241,"REQB","B","PSJ*5.0*278",9)
 
"BLD",9241,"REQB","B","PSJ*5.0*281",5)
 
"BLD",9241,"REQB","B","PSJ*5.0*285",10)
 
"BLD",9241,"REQB","B","PSJ*5.0*287",11)
 
"BLD",9241,"REQB","B","PSJ*5.0*318",4)
 
"BLD",9241,"REQB","B","PSS*1.0*191",1)
 
"FIA",53.1)
NON-VERIFIED ORDERS
"FIA",53.1,0)
^PS(53.1,
"FIA",53.1,0,0)
53.1I
"FIA",53.1,0,1)
y^n^p^^^^n^^n
"FIA",53.1,0,10)
 
"FIA",53.1,0,11)
 
"FIA",53.1,0,"RLRO")
 
"FIA",53.1,0,"VR")
5.0^PSJ
"FIA",53.1,53.1)
1
"FIA",53.1,53.1,137)
 
"FIA",53.1,53.1,138)
 
"FIA",53.1,53.1,139)
 
"FIA",53.1,53.1,140)
 
"FIA",55)
PHARMACY PATIENT
"FIA",55,0)
^PS(55,
"FIA",55,0,0)
55P
"FIA",55,0,1)
y^n^p^^^^n^^n
"FIA",55,0,10)
 
"FIA",55,0,11)
 
"FIA",55,0,"RLRO")
 
"FIA",55,0,"VR")
5.0^PSJ
"FIA",55,55)
1
"FIA",55,55.06)
1
"FIA",55,55.06,137)
 
"FIA",55,55.06,138)
 
"FIA",55,55.06,139)
 
"FIA",55,55.06,140)
 
"INIT")
QUE^PSJ5P315
"IX",55,55.06,"AL56DOA",0)
55.06^AL56DOA^Used by Unit Dose to log any changes made to this field.^MU^^R^IR^I^55.06^^^^^A
"IX",55,55.06,"AL56DOA",.1,0)
^^1^1^3150828^
"IX",55,55.06,"AL56DOA",.1,1,0)
Updates Actvity log node when DOA fields are edited.
"IX",55,55.06,"AL56DOA",1)
I '$D(DIU(0)) D:$D(PSGAL(56))#2 KILL^PSGAL5:PSGAL(56)=X S:(X1(2)=-1) (PSGAL(56),X)=0,PSGAL("C")=6000,PSGALFF=137 D:(X1(2)=-1) ^PSGAL5 K PSGAL
"IX",55,55.06,"AL56DOA",2)
I '$D(DIU(0)),'$D(PSGPO) S PSGAL(56)=X,PSGAL("C")=6000,PSGALFF=137 D ^PSGAL5
"IX",55,55.06,"AL56DOA",2.4)
 
"IX",55,55.06,"AL56DOA",11.1,0)
^.114IA^2^2
"IX",55,55.06,"AL56DOA",11.1,1,0)
1^F^55.06^137^30^1^F
"IX",55,55.06,"AL56DOA",11.1,2,0)
2^F^55.06^139^6^2^F
"KRN",101,3939,-1)
2^2
"KRN",101,3939,0)
PSJ LM ORDER VIEW HIDDEN ACTIONS^Order View Hidden Actions Menu^^M^12004^^^^^^^197
"KRN",101,3939,10,0)
^101.01PA^31^31
"KRN",101,3939,10,31,0)
6448^AH^43^
"KRN",101,3939,10,31,"^")
PSJ LM ADM HIST
"KRN",101,6448,-1)
0^1
"KRN",101,6448,0)
PSJ LM ADM HIST^Admin History for OI^^A^^^^^^^^
"KRN",101,6448,1,0)
^^2^2^3151029^
"KRN",101,6448,1,1,0)
This will display the last five actions on the Orderable Items for active 
"KRN",101,6448,1,2,0)
orders for the patient chosen in PSJ OE.
"KRN",101,6448,15)
D RESTORE^PSJHVARS S VALMBCK="R"
"KRN",101,6448,20)
D INIT^PSGAH
"KRN",101,6448,24)
I ($G(PSGMRN)'["V")!($G(ON)'["V")
"KRN",101,6448,99)
63957,47821
"MBREQ")
0
"ORD",15,101)
101;15;;;PRO^XPDTA;PROF1^XPDIA;PROE1^XPDIA;PROF2^XPDIA;;PRODEL^XPDIA
"ORD",15,101,0)
PROTOCOL
"PKG",197,-1)
1^1
"PKG",197,0)
INPATIENT MEDICATIONS^PSJ^UNIT DOSE AND IVS
"PKG",197,20,0)
^9.402P^^
"PKG",197,22,0)
^9.49I^1^1
"PKG",197,22,1,0)
5.0^2971215^2980917^11712
"PKG",197,22,1,"PAH",1,0)
315^3160727
"PKG",197,22,1,"PAH",1,1,0)
^^162^162^3160727
"PKG",197,22,1,"PAH",1,1,1,0)
******************************* ATTENTION ********************************
"PKG",197,22,1,"PAH",1,1,2,0)
  
"PKG",197,22,1,"PAH",1,1,3,0)
Clinical Ancillary Services (CAS) Development-Delivery of Pharmacy 
"PKG",197,22,1,"PAH",1,1,4,0)
Enhancements (DDPE) VA Inpatient Medication Administration - Transdermal
"PKG",197,22,1,"PAH",1,1,5,0)
enhancement includes 5 patches that must be installed in the following
"PKG",197,22,1,"PAH",1,1,6,0)
order:
"PKG",197,22,1,"PAH",1,1,7,0)
 
"PKG",197,22,1,"PAH",1,1,8,0)
1.      PSS*1*191
"PKG",197,22,1,"PAH",1,1,9,0)
2.      PSJ*5*315
"PKG",197,22,1,"PAH",1,1,10,0)
3.      PSB*3*83
"PKG",197,22,1,"PAH",1,1,11,0)
4.      PSB*3*87
"PKG",197,22,1,"PAH",1,1,12,0)
5.      OR*3*417
"PKG",197,22,1,"PAH",1,1,13,0)
 
"PKG",197,22,1,"PAH",1,1,14,0)
ATTENTION: This enhancement also includes a new Graphical User Interface
"PKG",197,22,1,"PAH",1,1,15,0)
(GUI) executable, BCMA GUI PSB3_P083.EXE. Installation of this GUI is
"PKG",197,22,1,"PAH",1,1,16,0)
required immediately after the KIDS install for the Patch to function.
"PKG",197,22,1,"PAH",1,1,17,0)
 
"PKG",197,22,1,"PAH",1,1,18,0)
For retrieval and installation instructions, please see the Client 
"PKG",197,22,1,"PAH",1,1,19,0)
Installation Instructions section.
"PKG",197,22,1,"PAH",1,1,20,0)
**************************************************************************
"PKG",197,22,1,"PAH",1,1,21,0)
 
"PKG",197,22,1,"PAH",1,1,22,0)
Patch PSJ*5.0*315 provides enhancements to the Inpatient Medications 
"PKG",197,22,1,"PAH",1,1,23,0)
application and to support enhancements for the Bar Code Medications 
"PKG",197,22,1,"PAH",1,1,24,0)
Administrations (BCMA) application for Transdermal Administrations. These 
"PKG",197,22,1,"PAH",1,1,25,0)
enhancements include:
"PKG",197,22,1,"PAH",1,1,26,0)
 
"PKG",197,22,1,"PAH",1,1,27,0)
     1. Currently Sites have to create fake removal orders to allow for 
"PKG",197,22,1,"PAH",1,1,28,0)
appropriate removal of medications in BCMA.  This patch will alleviate 
"PKG",197,22,1,"PAH",1,1,29,0)
that issue by prompting the user for DURATION OF ADMINISTRATION based on
"PKG",197,22,1,"PAH",1,1,30,0)
the value stored in the PROMPT FOR REMOVAL IN BCMA field (#12) contained
"PKG",197,22,1,"PAH",1,1,31,0)
in the ORDERABLE ITEM file (#50.7).  This field implements changes that
"PKG",197,22,1,"PAH",1,1,32,0)
will support enhancements to the BCMA and Inpatient Medication
"PKG",197,22,1,"PAH",1,1,33,0)
applications to display the removal times in Inpatient Medication orders
"PKG",197,22,1,"PAH",1,1,34,0)
using rules determined by the value of this field. The PROMPT FOR REMOVAL
"PKG",197,22,1,"PAH",1,1,35,0)
IN BCMA field (#12) can be set for Orderable Items that require removal to
"PKG",197,22,1,"PAH",1,1,36,0)
the following values:
"PKG",197,22,1,"PAH",1,1,37,0)
 
"PKG",197,22,1,"PAH",1,1,38,0)
     NULL/0=No Removal Required 
"PKG",197,22,1,"PAH",1,1,39,0)
     1 = Removal at Next Administration 
"PKG",197,22,1,"PAH",1,1,40,0)
     2 = Removal Period Optional Prior to Next Administration  
"PKG",197,22,1,"PAH",1,1,41,0)
     3 = Removal Period Required Prior to Next Administration
"PKG",197,22,1,"PAH",1,1,42,0)
 
"PKG",197,22,1,"PAH",1,1,43,0)
 
"PKG",197,22,1,"PAH",1,1,44,0)
     2. Routines added for this patch will add the new DURATION OF 
"PKG",197,22,1,"PAH",1,1,45,0)
ADMINISTRATION prompt to the option Inpatient Order Entry [PSJ OE] then 
"PKG",197,22,1,"PAH",1,1,46,0)
calculate the appropriate removal times and display them for verification.
"PKG",197,22,1,"PAH",1,1,47,0)
The NON-VERIFIED ORDERS file (#53.1) and UNIT DOSE sub-file(#62) of the 
"PKG",197,22,1,"PAH",1,1,48,0)
PHARMACY PATIENT file (#55) will be updated to include new fields that 
"PKG",197,22,1,"PAH",1,1,49,0)
will control the removal process.  These two files will have these 4
"PKG",197,22,1,"PAH",1,1,50,0)
fields added: DURATION OF ADMINISTRATION field (#137), REMOVE TIMES
"PKG",197,22,1,"PAH",1,1,51,0)
field(#138), REMOVE PERIOD field(#139) and BCMA PROMPT FOR REMOVAL FLAG
"PKG",197,22,1,"PAH",1,1,52,0)
field(#140).  A new field called PROMPT FOR REMOVAL IN BCMA field(#12)
"PKG",197,22,1,"PAH",1,1,53,0)
created in the ORDERABLE ITEMS file (#50.7) by patch PSS*1.0*191 will be
"PKG",197,22,1,"PAH",1,1,54,0)
used for information to be stored in the BCMA PROMPT FOR REMOVAL FLAG
"PKG",197,22,1,"PAH",1,1,55,0)
field(#140) in the NON-VERIFIED ORDERS file(#53.1) and the UNIT DOSE
"PKG",197,22,1,"PAH",1,1,56,0)
sub-file(#62) of the PHARMACY PATIENT file (#55).
"PKG",197,22,1,"PAH",1,1,57,0)
 
"PKG",197,22,1,"PAH",1,1,58,0)
     3. The Edit Clinic Med Orders Start Date/Time [PSJ ECO] option will 
"PKG",197,22,1,"PAH",1,1,59,0)
have changes to anticipate these new fields and request additional user 
"PKG",197,22,1,"PAH",1,1,60,0)
activity when the orders require specific information that can 
"PKG",197,22,1,"PAH",1,1,61,0)
only be entered via the Inpatient Order Entry [PSJ OE] option.
"PKG",197,22,1,"PAH",1,1,62,0)
 
"PKG",197,22,1,"PAH",1,1,63,0)
     4. This patch contains a post-install routine PSJ5P315 that sends a 
"PKG",197,22,1,"PAH",1,1,64,0)
report listing all legacy orders for Medications that require removal.  
"PKG",197,22,1,"PAH",1,1,65,0)
In order to prevent confusion by users of the BCMA GUI application these 
"PKG",197,22,1,"PAH",1,1,66,0)
orders will need to be discontinued and reordered to include the
"PKG",197,22,1,"PAH",1,1,67,0)
removal information.  This same report can be recalled from the Pharmacy
"PKG",197,22,1,"PAH",1,1,68,0)
Data Management [PSS MGR] menu using the Orders for MRRs With Removal
"PKG",197,22,1,"PAH",1,1,69,0)
Properties [PSS MRR ORDERS DIAGNOSTIC RPT] option.
"PKG",197,22,1,"PAH",1,1,70,0)
 
"PKG",197,22,1,"PAH",1,1,71,0)
     5. The Order View Hidden Actions Menu [PSJ LM ORDER VIEW HIDDEN
"PKG",197,22,1,"PAH",1,1,72,0)
ACTIONS] protocol has been modified to include a hidden action for calling
"PKG",197,22,1,"PAH",1,1,73,0)
the Administration History report. A new protocol, Admin History for OI
"PKG",197,22,1,"PAH",1,1,74,0)
[PSJ LM ADM HIST], was added for the new hidden action.  This report 
"PKG",197,22,1,"PAH",1,1,75,0)
allows viewing of other orders for the Orderable Item listed in the Order
"PKG",197,22,1,"PAH",1,1,76,0)
Detail for the selected Order. The menu item Other Pharmacy Options [PSJ
"PKG",197,22,1,"PAH",1,1,77,0)
LM OTHER PHARMACY OPTIONS] has been shortened to read Other Pharm Options
"PKG",197,22,1,"PAH",1,1,78,0)
in order to allow the columns to align correctly.  The AH menu option 
"PKG",197,22,1,"PAH",1,1,79,0)
will not be available during the period in which PSJ*5.0*315 is installed,
"PKG",197,22,1,"PAH",1,1,80,0)
but PSB*3.0*83 is not.  If the user attempts to run this option during 
"PKG",197,22,1,"PAH",1,1,81,0)
this time they will get the following message: Report not available until
"PKG",197,22,1,"PAH",1,1,82,0)
install of patch PSB*3.0*83.
"PKG",197,22,1,"PAH",1,1,83,0)
 
"PKG",197,22,1,"PAH",1,1,84,0)
       This patch requires patch PSS*1.0*191.
"PKG",197,22,1,"PAH",1,1,85,0)
       
"PKG",197,22,1,"PAH",1,1,86,0)
       The full functionality introduced in this patch will not be
"PKG",197,22,1,"PAH",1,1,87,0)
       available until patches PSB*3.0*83 and possibly PSB*3.0*87 
"PKG",197,22,1,"PAH",1,1,88,0)
       for Bar Code Back Up (BCBU) are installed.
"PKG",197,22,1,"PAH",1,1,89,0)
 
"PKG",197,22,1,"PAH",1,1,90,0)
       Pre-existing orders will remain unaffected with installation.
"PKG",197,22,1,"PAH",1,1,91,0)
 
"PKG",197,22,1,"PAH",1,1,92,0)
 
"PKG",197,22,1,"PAH",1,1,93,0)
********** SPECIAL NOTE on Times Per Day (TPD) orders**********:
"PKG",197,22,1,"PAH",1,1,94,0)
 
"PKG",197,22,1,"PAH",1,1,95,0)
     To avoid confusion it is strongly recommended that  MRR medications
"PKG",197,22,1,"PAH",1,1,96,0)
needing to use a TPD schedule with asynchronous administrations and
"PKG",197,22,1,"PAH",1,1,97,0)
removals, be set to have the PROMPT FOR REMOVAL IN BCMA (#12) set to a
"PKG",197,22,1,"PAH",1,1,98,0)
value of 3.  The Pharmacist will then always be prompted for the Duration
"PKG",197,22,1,"PAH",1,1,99,0)
of Administration and a proper removal time can be entered in the
"PKG",197,22,1,"PAH",1,1,100,0)
Inpatient Order Entry [PSJ OE] option. 
"PKG",197,22,1,"PAH",1,1,101,0)
     
"PKG",197,22,1,"PAH",1,1,102,0)
     In order to maintain adequate flexibility for Times per Day (TPD)
"PKG",197,22,1,"PAH",1,1,103,0)
     schedules such as BID, TID and QID for MRR medication orders; these 
"PKG",197,22,1,"PAH",1,1,104,0)
     schedules are not validated to the extent that other continuous
"PKG",197,22,1,"PAH",1,1,105,0)
     schedule types are validated.  The intent was to allow a variety of
"PKG",197,22,1,"PAH",1,1,106,0)
     administrations and removals that may be asynchronous in order to
"PKG",197,22,1,"PAH",1,1,107,0)
     process correctly; for instance this will allow having two
"PKG",197,22,1,"PAH",1,1,108,0)
     administrations 6 hours apart followed by a 12 hour medication-free
"PKG",197,22,1,"PAH",1,1,109,0)
     period.  
"PKG",197,22,1,"PAH",1,1,110,0)
 
"PKG",197,22,1,"PAH",1,1,111,0)
        Normally the frequency used by the existing ADMINISTRATION 
"PKG",197,22,1,"PAH",1,1,112,0)
SCHEDULE file (#51.1) setup would expect a 12 hour frequency for 
"PKG",197,22,1,"PAH",1,1,113,0)
continuous schedule types ( 24 hours divided by 2 administrations equals
"PKG",197,22,1,"PAH",1,1,114,0)
12 ) and this is what is standard practice.
"PKG",197,22,1,"PAH",1,1,115,0)
        
"PKG",197,22,1,"PAH",1,1,116,0)
        Existing MRRs set to have the medication removed at the next 
"PKG",197,22,1,"PAH",1,1,117,0)
Duration of Administration would need to have a Duration of Administration
"PKG",197,22,1,"PAH",1,1,118,0)
value entered for TPD schedules, otherwise the stored frequency in the
"PKG",197,22,1,"PAH",1,1,119,0)
ADMINISTRATION SCHEDULE file (#51.1) would be used and this could result 
"PKG",197,22,1,"PAH",1,1,120,0)
in an incorrect removal period.  Therefore we recommend setting the MRR
"PKG",197,22,1,"PAH",1,1,121,0)
value to a 3 (Duration of Administration Required). If the MRR is set to a
"PKG",197,22,1,"PAH",1,1,122,0)
value of 1 in the PROMPT FOR REMOVAL IN BCMA field (#12), the Pharmacist
"PKG",197,22,1,"PAH",1,1,123,0)
would not receive the verification screen that appears for  Duration of
"PKG",197,22,1,"PAH",1,1,124,0)
Administration entries and may not be aware of this issue.
"PKG",197,22,1,"PAH",1,1,125,0)
        
"PKG",197,22,1,"PAH",1,1,126,0)
The following is an example of using a type 1 Prompt for Removal in BCMA
"PKG",197,22,1,"PAH",1,1,127,0)
for TPD's (Not recommended Condition):
"PKG",197,22,1,"PAH",1,1,128,0)
 
"PKG",197,22,1,"PAH",1,1,129,0)
     The MRR medication needs to be administered at 0900 and removed 
"PKG",197,22,1,"PAH",1,1,130,0)
at 1500, with a new administration added at 1500 then removed at 2100.  
"PKG",197,22,1,"PAH",1,1,131,0)
       
"PKG",197,22,1,"PAH",1,1,132,0)
     The BID  schedule is used with the PROMPT FOR REMOVAL IN BCMAPrompt 
"PKG",197,22,1,"PAH",1,1,133,0)
for Removal in BCMA 
"PKG",197,22,1,"PAH",1,1,134,0)
field (#12)  value set to a 1 and the Frequency for BID schedule set to 
"PKG",197,22,1,"PAH",1,1,135,0)
12 hours.
"PKG",197,22,1,"PAH",1,1,136,0)
     
"PKG",197,22,1,"PAH",1,1,137,0)
     The Pharmacist would only see the administration times of 0900 
"PKG",197,22,1,"PAH",1,1,138,0)
and 1500.
"PKG",197,22,1,"PAH",1,1,139,0)
       
"PKG",197,22,1,"PAH",1,1,140,0)
     The system would then use the frequency stored in the 
"PKG",197,22,1,"PAH",1,1,141,0)
ADMINISTRATION SCHEDULE file (#51.1) Administration schedule file of 12 
"PKG",197,22,1,"PAH",1,1,142,0)
hours, so that Removal Times on the
"PKG",197,22,1,"PAH",1,1,143,0)
enhanced BCMA would then calculate as removal at 2100 and 0300, which 
"PKG",197,22,1,"PAH",1,1,144,0)
would be in conflict with the administration times.
"PKG",197,22,1,"PAH",1,1,145,0)
 
"PKG",197,22,1,"PAH",1,1,146,0)
The following is an example of using a type 3 Prompt for Removal in BCMA
"PKG",197,22,1,"PAH",1,1,147,0)
for TPD's (Recommended condition):
"PKG",197,22,1,"PAH",1,1,148,0)
 
"PKG",197,22,1,"PAH",1,1,149,0)
     The MRR medication needs to be administered at 0900 and removed 
"PKG",197,22,1,"PAH",1,1,150,0)
at 1500, with a new administration added at 1500 then removed at 2100.  
"PKG",197,22,1,"PAH",1,1,151,0)
       
"PKG",197,22,1,"PAH",1,1,152,0)
     The BID  schedule is used with the PROMPT FOR REMOVAL IN BCMA 
"PKG",197,22,1,"PAH",1,1,153,0)
field (#12)  value set to a 3.  In this case the Frequency is no longer 
"PKG",197,22,1,"PAH",1,1,154,0)
used. 
"PKG",197,22,1,"PAH",1,1,155,0)
       
"PKG",197,22,1,"PAH",1,1,156,0)
     The Pharmacist would see the administration times of 0900 and 
"PKG",197,22,1,"PAH",1,1,157,0)
1500 and enter the appropriate Duration of Administration  which would be 
"PKG",197,22,1,"PAH",1,1,158,0)
6 hours.
"PKG",197,22,1,"PAH",1,1,159,0)
       
"PKG",197,22,1,"PAH",1,1,160,0)
     The system would create a verification display showing 
"PKG",197,22,1,"PAH",1,1,161,0)
administration at 0900 followed by and Administration and Removal at 1500 
"PKG",197,22,1,"PAH",1,1,162,0)
then a Removal at 2100 as ordered by the Physician.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")
 
"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
39
"RTN","PSGAH")
0^53^B25445995^n/a
"RTN","PSGAH",1,0)
PSGAH ;ALB/DRP-ADMINISTRATION HISTORY RPT ;29 Oct 2015 12:44 PM
"RTN","PSGAH",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**315**;16 DEC 97;Build 73
"RTN","PSGAH",3,0)
 ;Per VHA Directive 2004-038 (or future revisions regarding same), this routine should not be modified.
"RTN","PSGAH",4,0)
 ;
"RTN","PSGAH",5,0)
 ;Call to MEDHIST^PSBUTL controlled by IA 6271
"RTN","PSGAH",6,0)
 ;
"RTN","PSGAH",7,0)
 Q
"RTN","PSGAH",8,0)
 ;Routine is called by Hidden Actions Menu so DFN variable will be passed in from the Menu
"RTN","PSGAH",9,0)
INIT ; Initialize Variables
"RTN","PSGAH",10,0)
 I '$$PATCH^XPDUTL("PSB*3.0*83") W !,"Report not available until install of patch PSB*3.0*83" S TERM=1 D PAUSE Q
"RTN","PSGAH",11,0)
 I ($G(ON)["V") W !,"AH Report cannot be run for this order. Use CPRS or BCMA to find Admin history." S TERM=1 D PAUSE Q
"RTN","PSGAH",12,0)
 I ($G(ON)["P"),$P($G(^PS(53.1,+ON,0)),U,4)'["U" W !,"AH Report cannot be run for this order. Use CPRS or BCMA to find Admin history." S TERM=1 D PAUSE Q
"RTN","PSGAH",13,0)
 Q:$G(DFN)=""
"RTN","PSGAH",14,0)
 N PSGACAR,PSGQ,PSGORD,PSGOIEN,PSGSPCE,PSGMRT,PSGSCH,PSGDRNG,PSGLOC
"RTN","PSGAH",15,0)
 N TERM,PSGACT,COUNT,PAGNO,PSGDSG,PSGIN
"RTN","PSGAH",16,0)
 N $ESTACK,$ETRAP S $ETRAP="D ERRTRP^PSGAH" ;
"RTN","PSGAH",17,0)
 S PSGOIEN=$G(PSGOPD) Q:'PSGOIEN
"RTN","PSGAH",18,0)
 S $P(PSGSPCE," ",30)="",COUNT=0
"RTN","PSGAH",19,0)
 D ENCV^PSGSETU Q:$D(XQUIT)
"RTN","PSGAH",20,0)
 D FULL^VALM1,PRMTRNG,MAIN
"RTN","PSGAH",21,0)
 K ^XTMP("PSGAH",$J)
"RTN","PSGAH",22,0)
 Q
"RTN","PSGAH",23,0)
 ;
"RTN","PSGAH",24,0)
MAIN ; Main control
"RTN","PSGAH",25,0)
 Q:$G(PSGQ)
"RTN","PSGAH",26,0)
 D OPEN^%ZISUTL("PSGAH",,) I $G(POP) W !!,"Nothing queued to print.",! Q
"RTN","PSGAH",27,0)
 S:$E(IOSL,1)'["9" TERM=$S($E($G(IOST),1,2)="C-":1,1:0)
"RTN","PSGAH",28,0)
 U IO S PAGNO=0
"RTN","PSGAH",29,0)
 ;Get OI then get all orders for OI within time frame determined by ?
"RTN","PSGAH",30,0)
 D GETHIST D:$D(PSGACAR) GETORD
"RTN","PSGAH",31,0)
 D PRNHDR,WRITE
"RTN","PSGAH",32,0)
 W !!,"Press RETURN to continue....." R X:$G(DTIME) ;pause before returning to Detail screen
"RTN","PSGAH",33,0)
 D CLOSE^%ZISUTL("PSGAH")
"RTN","PSGAH",34,0)
 K POP
"RTN","PSGAH",35,0)
 Q
"RTN","PSGAH",36,0)
 ;
"RTN","PSGAH",37,0)
GETORD ; Get order information
"RTN","PSGAH",38,0)
 N I,STR,PSGCUR S I=0
"RTN","PSGAH",39,0)
 F  S I=$O(PSGACAR(I)) Q:'I  D
"RTN","PSGAH",40,0)
 . S STR=PSGACAR(I),PSGCUR=0,PSGIN=$P(STR,U,6),PSGLOC=$P(STR,U,5)
"RTN","PSGAH",41,0)
 . S PSGORD=+$P(STR,U,3),PSGACT=$P(STR,U,2) S:PSGORD=+$G(ON) PSGCUR=1 ;ON passed in from Menu
"RTN","PSGAH",42,0)
 . S PSGMRT=$P($G(^PS(55,DFN,5,PSGORD,0)),U,3),PSGMRT=$P(^PS(51.2,PSGMRT,0),U,1)
"RTN","PSGAH",43,0)
 . S PSGSCH=$P($G(^PS(55,DFN,5,PSGORD,2)),U,1)
"RTN","PSGAH",44,0)
 . S PSGDSG=$P($G(^PS(55,DFN,5,PSGORD,.2)),U,2)
"RTN","PSGAH",45,0)
 . D SETTMP(I)        ;check and then set ^XTMP for sort
"RTN","PSGAH",46,0)
 .Q
"RTN","PSGAH",47,0)
 Q
"RTN","PSGAH",48,0)
 ;
"RTN","PSGAH",49,0)
GETHIST ; Get last 99 actions for each OI Dosage
"RTN","PSGAH",50,0)
 ;MEDHIST(LIST,DFN,OI,MAX) ;Last nn admin actions per a patients Orderable Item
"RTN","PSGAH",51,0)
 ; Input:
"RTN","PSGAH",52,0)
 ;   DFN - Patient num
"RTN","PSGAH",53,0)
 ;   OI  - Inpatient Meds Orderable Item ien
"RTN","PSGAH",54,0)
 ;   MAX - Max days back to search
"RTN","PSGAH",55,0)
 ; Output:
"RTN","PSGAH",56,0)
 ;   LIST - Array of actions formatted as :
"RTN","PSGAH",57,0)
 ;     DATE^ACTION^ORDNO^LSTSITE^LOCATION^NURSINITL
"RTN","PSGAH",58,0)
 D MEDHIST^PSBUTL(.PSGACAR,DFN,PSGOIEN,PSGDRNG) ;ZW PSGACAR
"RTN","PSGAH",59,0)
 Q
"RTN","PSGAH",60,0)
 ;
"RTN","PSGAH",61,0)
 ;The following items were requested for this new report:  
"RTN","PSGAH",62,0)
 ;Dose. 
"RTN","PSGAH",63,0)
 ;All administrations for the Orderable Item
"RTN","PSGAH",64,0)
 ;Sorted by time. 
"RTN","PSGAH",65,0)
 ;Grouped by all administrations by orderable item for that patient.
"RTN","PSGAH",66,0)
SETTMP(ORDDT) ; Builds ^XTMP for sort
"RTN","PSGAH",67,0)
 S ^XTMP("PSGAH",$J,ORDDT,PSGORD)=PSGDSG_U_PSGMRT_U_PSGSCH_$S(PSGCUR:"-Current",1:"")_U_PSGACT_U_PSGIN_U_PSGLOC
"RTN","PSGAH",68,0)
 Q
"RTN","PSGAH",69,0)
 ;
"RTN","PSGAH",70,0)
WRITE ; WRITE records to output
"RTN","PSGAH",71,0)
 ;        "DOSAGE ORDERD"_" "_MED ROUTE (INTERNAL)_" "_SCHEDULE(INTERNAL)_$S(CURRENT ORDER:"(*)",1:"")
"RTN","PSGAH",72,0)
 N DATE,ORDER,STR S DATE=9999999
"RTN","PSGAH",73,0)
 F  S DATE=$O(^XTMP("PSGAH",$J,DATE),-1) Q:DATE=""!$G(PSGQ)  D
"RTN","PSGAH",74,0)
 . S ORDER=0
"RTN","PSGAH",75,0)
 . F  S ORDER=$O(^XTMP("PSGAH",$J,DATE,ORDER)) Q:ORDER=""!$G(PSGQ)  D
"RTN","PSGAH",76,0)
 ..S STR=^XTMP("PSGAH",$J,DATE,ORDER),PSGDSG=$P(STR,U,1),PSGMRT=$P(STR,U,2),PSGSCH=$P(STR,U,3),PSGACT=$P(STR,U,4)
"RTN","PSGAH",77,0)
 ..S PSGIN=$P(STR,U,5),PSGLOC=$P(STR,U,6)
"RTN","PSGAH",78,0)
 ..D PRNLN
"RTN","PSGAH",79,0)
 ..Q
"RTN","PSGAH",80,0)
 .Q
"RTN","PSGAH",81,0)
 Q
"RTN","PSGAH",82,0)
 ;
"RTN","PSGAH",83,0)
PRNHDR ; Heading
"RTN","PSGAH",84,0)
 Q:$G(PSGQ)
"RTN","PSGAH",85,0)
 S PAGNO=PAGNO+1
"RTN","PSGAH",86,0)
 W @IOF
"RTN","PSGAH",87,0)
 W ! W:'$G(TERM) ?5 W $E($$FMTE^XLFDT($$NOW^XLFDT),1,18)
"RTN","PSGAH",88,0)
 W ! W:'$G(TERM) ?5 W "Administration History for Orderable Item ",?73,"Page ",PAGNO
"RTN","PSGAH",89,0)
 W ! W:'$G(TERM) ?10 W $G(PSGOPDN)
"RTN","PSGAH",90,0)
 W ! W:'$G(TERM) ?5 W "Date             Action  Initials Location"
"RTN","PSGAH",91,0)
 W ! W:'$G(TERM) ?8 W "Dosage Ordered                  Med Route     Schedule"
"RTN","PSGAH",92,0)
 W ! W:'$G(TERM) ?5 W "---------------------------------------------------------------------------"
"RTN","PSGAH",93,0)
 Q
"RTN","PSGAH",94,0)
 ;
"RTN","PSGAH",95,0)
PRNLN ;Write line on report
"RTN","PSGAH",96,0)
 ;N ACTLBL S ACTLBL=$S(COUNT:"PREVIOUS ACTION "_COUNT_" ",1:"LAST ACTION: ")
"RTN","PSGAH",97,0)
 W ! W:'$G(TERM) ?5 W $E($P($$FMTE^XLFDT(DATE,5),":",1,2)_PSGSPCE,1,16)_" "_$E(PSGACT_PSGSPCE,1,6)_"  "_$E(PSGIN_PSGSPCE,1,8)_" "_$G(PSGLOC,"UNKNOWN")
"RTN","PSGAH",98,0)
 W ! W:'$G(TERM) ?8 W $E(PSGDSG_PSGSPCE,1,30)_"  "_$E(PSGMRT_PSGSPCE,1,12)_"  "_$E(PSGSCH_PSGSPCE,1,30),!
"RTN","PSGAH",99,0)
 S COUNT=COUNT+1
"RTN","PSGAH",100,0)
 I $Y>(IOSL-2) D:$G(TERM) PAUSE D PRNHDR
"RTN","PSGAH",101,0)
 Q
"RTN","PSGAH",102,0)
 ;
"RTN","PSGAH",103,0)
PAUSE Q:'($G(TERM))
"RTN","PSGAH",104,0)
 N X
"RTN","PSGAH",105,0)
 U IO(0) W !!,"Press RETURN to continue, '^' to exit"
"RTN","PSGAH",106,0)
 R X:$G(DTIME) I (X="^")!('$T) S PSGQ=1 Q
"RTN","PSGAH",107,0)
 U IO
"RTN","PSGAH",108,0)
 Q
"RTN","PSGAH",109,0)
PRMTRNG ; prompt for number of Days back to return
"RTN","PSGAH",110,0)
 K DIR,DTOUT,DUOUT,DIRUT,DIROUT
"RTN","PSGAH",111,0)
 S DIR(0)="N^1:99999:0"
"RTN","PSGAH",112,0)
 S DIR("A")="Enter Number of days back to search",DIR("B")="14"
"RTN","PSGAH",113,0)
 S DIR("?")="Enter an  '^' to exit this option now."
"RTN","PSGAH",114,0)
 S DIR("?",1)="Enter the number days prior to today to search the BCMA MEDICATION LOG"
"RTN","PSGAH",115,0)
 S DIR("?",2)="All BCMA orders within indicated range will be included"
"RTN","PSGAH",116,0)
 S DIR("?",3)=""
"RTN","PSGAH",117,0)
 S DIR("?",4)=""
"RTN","PSGAH",118,0)
 D ^DIR S PSGDRNG=$S($D(DIRUT):0,1:Y) S:$D(DIRUT) PSGQ=1
"RTN","PSGAH",119,0)
 K DIR,DIRUT,Y
"RTN","PSGAH",120,0)
 Q
"RTN","PSGAH",121,0)
 ;
"RTN","PSGAH",122,0)
ERRTRP ; Error trap processing
"RTN","PSGAH",123,0)
 N Z,PROBLEM
"RTN","PSGAH",124,0)
 S Z(1,1)=$$EC^%ZOSV ; mumps error location and description
"RTN","PSGAH",125,0)
 S Z="A SYSTEM ERROR HAS BEEN DETECTED AT THE FOLLOWING LOCATION"
"RTN","PSGAH",126,0)
 S PROBLEM=7
"RTN","PSGAH",127,0)
 D ^%ZTER ; record the error in the trap
"RTN","PSGAH",128,0)
 G UNWIND^%ZTER ; unwind stack levels
"RTN","PSGAH",129,0)
 Q
"RTN","PSGOD")
0^5^B25616562^B24552546
"RTN","PSGOD",1,0)
PSGOD ;BIR/CML3-CREATES NEW ORDER FROM OLD ONE ;22 SEP 97 / 2:56 PM 
"RTN","PSGOD",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**67,58,111,133,181,286,281,315**;16 DEC 97;Build 73
"RTN","PSGOD",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PSGOD",4,0)
 ; Reference to ^PS(55 is supported by DBIA 2191.
"RTN","PSGOD",5,0)
 ;
"RTN","PSGOD",6,0)
 ;*286 - Do not allow copied Unit Dose orders for outpatients
"RTN","PSGOD",7,0)
 D INP^VADPT I 'VAIN(4) W !,"You cannot copy Unit Dose orders for this patient!" H 2 Q
"RTN","PSGOD",8,0)
 I $P($G(^PS(55,PSGP,5,+PSJORD,0)),"^",22) D  Q
"RTN","PSGOD",9,0)
 .W !,"This order is marked 'Not To Be Given' and can't be copied!" H 2
"RTN","PSGOD",10,0)
 F  W !!,"Do you want to copy this order" S %=2 D YN^DICN Q:%  D CH
"RTN","PSGOD",11,0)
 G:%'=1 DONE
"RTN","PSGOD",12,0)
 ;
"RTN","PSGOD",13,0)
 W !!,"...copying..." N OLDON
"RTN","PSGOD",14,0)
 K PSGORQF
"RTN","PSGOD",15,0)
 N PSGPDRG,Q
"RTN","PSGOD",16,0)
 S PSGOEPR=$P($G(^PS(55,PSGP,5.1)),"^",2),OLDON=PSGORD,Q=""
"RTN","PSGOD",17,0)
 K PSGODN S F=$S(PSGORD["P":"^PS(53.1,"_+PSGORD_",",1:"^PS(55,"_PSGP_",5,"_+PSGORD_",") F N=0,.2,2,2.1,6 S PSGODN(N)=$G(@(F_N_")"))
"RTN","PSGOD",18,0)
 S PSGPR=$P(PSGODN(0),"^",2),PSGMR=$P(PSGODN(0),"^",3),PSGSM=$P(PSGODN(0),"^",5),PSGHSM=$P(PSGODN(0),"^",6),PSGST=$P(PSGODN(0),"^",7)
"RTN","PSGOD",19,0)
 S PSGPDRG=+PSGODN(.2),PSGDO=$P(PSGODN(.2),"^",2)
"RTN","PSGOD",20,0)
 ;*315
"RTN","PSGOD",21,0)
 S:$G(PSGODN(2.1))]"" PSGDUR=+PSGODN(2.1),PSGRMVT=$P(PSGODN(2.1),U,2),PSGRMV=$P(PSGODN(2.1),U,3),PSGRF=$P(PSGODN(2.1),U,4)
"RTN","PSGOD",22,0)
 S PSGSI=PSGODN(6)
"RTN","PSGOD",23,0)
 ; The naked reference below refers to the full reference inside indirection to ^PS(55,PSGP,5,+PSGORD, or ^PS(55,PSGP,"IV",+PSGORD, or ^PS(53.1,+PSGORD
"RTN","PSGOD",24,0)
 S PSGODN(3)=0 F Q=0:0 S Q=$O(@(F_"3,"_Q_")")) Q:'Q  I $D(^(Q,0)) S PSGODN(3,Q)=^(0),PSGODN(3)=PSGODN(3)+1 S ^PS(53.45,PSJSYSP,1,Q,0)=^(0)
"RTN","PSGOD",25,0)
 ;S:PSGODN(12)>0 ^PS(53.45,PSJSYSP,4,0)="^53.4504" S:PSGODN(3)>0 ^PS(53.45,PSJSYSP,1,0)="^53.4501"
"RTN","PSGOD",26,0)
 S:PSGODN(3)>0 ^PS(53.45,PSJSYSP,1,0)="^53.4501"
"RTN","PSGOD",27,0)
 ; The naked reference below refers to the full reference inside indirection to ^PS(55,PSGP,5,+PSGORD, or ^PS(55,PSGP,"IV",+PSGORD, or ^PS(53.1,+PSGORD  
"RTN","PSGOD",28,0)
 S (PSGODN(1),Q)=0 F  S Q=$O(@(F_"1,"_Q_")")) Q:'Q  S ND=$G(^(Q,0)) I ND,'$P(ND,"^",3) S PSGODN(1)=PSGODN(1)+1,PSGODN(1,PSGODN(1))=$P(ND,"^",1,2) S ^PS(53.45,PSJSYSP,2,PSGODN(1),0)=^(0)
"RTN","PSGOD",29,0)
 S PSGS0Y=$P(PSGODN(2),"^",5),PSGS0XT=$P(PSGODN(2),"^",6),PSGNESD="",PSGSCH=$P(PSGODN(2),U)
"RTN","PSGOD",30,0)
 S PSGODF=1,PSGNEDFD=$P($$GTNEDFD^PSGOE7("U",+PSGPDRG),U)_"^^"_PSGST_"^"_PSGSCH
"RTN","PSGOD",31,0)
 W "." D ^PSGNE3
"RTN","PSGOD",32,0)
 K PSGEFN,PSGOEEF,PSGOEE,PSGOEOS S PSGEFN="1:13" F X=1:1:13 S PSGEFN(X)=""
"RTN","PSGOD",33,0)
 S PSGPDN=$$OINAME^PSJLMUTL(PSGPDRG),PSGOINST="",PSGSDN=$$ENDD^PSGMI(PSGNESD)_U_$$ENDTC^PSGMI(PSGNESD),PSGFDN=$$ENDD^PSGMI(PSGNEFD)_U_$$ENDTC^PSGMI(PSGNEFD)
"RTN","PSGOD",34,0)
 S PSGAT=PSGS0Y,PSGEBN=DUZ,PSGLIN=$$ENDD^PSGMI(PSGDT)_U_$$ENDTC^PSGMI(PSGDT),PSGEBN=$$ENNPN^PSGMI(DUZ),PSGSTAT=$S(PSGOEAV:"ACTIVE",1:"NON-VERIFIED")
"RTN","PSGOD",35,0)
 W "." D CHK^PSGOEV("^^"_PSGMR_"^^^^"_PSGST,PSGPDRG_U_PSGDO,PSGSCH_U_PSGNESD_"^^"_PSGNEFD)
"RTN","PSGOD",36,0)
 I $G(PSGSCH)]"" D
"RTN","PSGOD",37,0)
 .N X S X=PSGSCH N SWD,SDW,XABB,QX D ENOS^PSGS0 I $G(X)=""!$G(PSJNSS) S CHK=1 K PSJNSS Q
"RTN","PSGOD",38,0)
 .I $G(PSGAT)="",$G(PSGS0Y) S PSGAT=PSGS0Y
"RTN","PSGOD",39,0)
 .I $G(PSGAT),($G(PSGS0Y)="") S PSGS0Y=PSGAT
"RTN","PSGOD",40,0)
 .I $G(PSGS0XT)="D",$G(PSGS0Y)="" S CHK=1 D  K PSJNSS
"RTN","PSGOD",41,0)
 ..W ! K DIR S DIR(0)="FOA",DIR("A")="   WARNING - Admin times are required for DAY OF WEEK schedules    " D ^DIR K DIR
"RTN","PSGOD",42,0)
 S PSGSD=PSGNESD,PSGFD=PSGNEFD
"RTN","PSGOD",43,0)
 K PSJACEPT S VALMBCK="Q" D:$D(Y) EN^VALM("PSJU LM ACCEPT")
"RTN","PSGOD",44,0)
 I $G(PSJACEPT)=1 D OC S:$D(PSGORQF) PSJACEPT=0 S:$G(PSJACEPT)=1 VALMBCK="",PSJNOO=$$ENNOO^PSJUTL5("N")
"RTN","PSGOD",45,0)
 I '$G(PSJACEPT)!($G(PSJNOO)<0) W:'$G(PSJCOFLG) !!,"Order not copied." D PAUSE^VALM1:'$G(PSJCOFLG) G ORIG    ;PSJCOFLG set in PSODGAL1 for allergies
"RTN","PSGOD",46,0)
 S PSGNESD=PSGSD,PSGNEFD=PSGFD
"RTN","PSGOD",47,0)
 K PSGOEE D ^PSGOETO S PSJORD=PSGORD I PSGOEAV D
"RTN","PSGOD",48,0)
 .I '$D(PSGOEE),+PSJSYSU=3 D EN^PSGPEN(PSGORD)
"RTN","PSGOD",49,0)
 .D SETOC^PSJNEWOC(PSGORD) ;RTC 178789 Store allergy if auto vf is on
"RTN","PSGOD",50,0)
 D GETUD^PSJLMGUD(PSGP,PSGORD),ENSFE^PSGOEE0(PSGP,PSGORD),^PSGOE1,EN^VALM("PSJ LM UD ACTION")
"RTN","PSGOD",51,0)
 ;RTC 178789 - store allery if not verified the newly copied order
"RTN","PSGOD",52,0)
 I ($G(PSGORD)["P"),($P($G(^PS(53.1,+PSGORD,0)),U,9)="N"),($G(PSJOCFG)="COPY UD") D SETOC^PSJNEWOC(PSGORD)
"RTN","PSGOD",53,0)
 ;
"RTN","PSGOD",54,0)
 S PSGCANFL=0,(PSGORD,PSJORD)=OLDON W !!,"You are finished with the new order.",!,"The following ACTION prompt is for the original order."
"RTN","PSGOD",55,0)
 K DIR S DIR(0)="E" D ^DIR K DIR
"RTN","PSGOD",56,0)
ORIG ;Redisplay original order
"RTN","PSGOD",57,0)
 D GETUD^PSJLMGUD(PSGP,OLDON),INIT^PSJLMUDE(PSGP,OLDON)
"RTN","PSGOD",58,0)
DONE ;
"RTN","PSGOD",59,0)
 K %,%H,%I,DA,F,N,PSGODN,PSGODF,PSGS0XT,PSGS0Y,PSGNESD,PSGTOL,PSGTOO,PSGUOW,X,Y,^PS(53.45,PSJSYSP,1),^PS(53.45,PSJSYSP,2)
"RTN","PSGOD",60,0)
 K PSGPR,PSGMR,PSGSM,PSGHSM,PSGST,PSGPDRG,PSGDO,PSGNEDFD,PSGSCH,PSGNEFD
"RTN","PSGOD",61,0)
 Q
"RTN","PSGOD",62,0)
 ;
"RTN","PSGOD",63,0)
CH ;
"RTN","PSGOD",64,0)
 W !!?2,"Answer 'YES' to have a new, non-verified order created for this patient,",!,"using the information from this order.  (The START and STOP dates will be",!,"recalculated.)  Enter 'NO' (or '^') to stop now." Q
"RTN","PSGOD",65,0)
 ;
"RTN","PSGOD",66,0)
WH ;
"RTN","PSGOD",67,0)
 W !!?2,"Answer 'YES' to take action on this new order.  Enter 'NO' (or '^') to return",!,"to the original order now." Q
"RTN","PSGOD",68,0)
 ;
"RTN","PSGOD",69,0)
OC ;Perform order checks
"RTN","PSGOD",70,0)
 NEW PSJDD,X,PSJALLGY
"RTN","PSGOD",71,0)
 ;*286 - Order checks on current dispense drugs
"RTN","PSGOD",72,0)
 F X=0:0 S X=$O(^PS(53.45,PSJSYSP,2,X)) Q:'X  D
"RTN","PSGOD",73,0)
 . S PSJDD=$G(^PS(53.45,PSJSYSP,2,X,0))
"RTN","PSGOD",74,0)
 . I +PSJDD S PSJALLGY(+PSJDD)=""
"RTN","PSGOD",75,0)
 ;S X=+$O(PSGODN(1,0)) Q:'X  S PSJDD=+$G(PSGODN(1,X)) Q:'PSJDD
"RTN","PSGOD",76,0)
 S PSJDD=+$O(PSJALLGY(0)) Q:'PSJDD
"RTN","PSGOD",77,0)
 D FULL^VALM1
"RTN","PSGOD",78,0)
 D ENDDC^PSGSICHK($G(PSGP),PSJDD) Q:$D(PSGORQF)
"RTN","PSGOD",79,0)
 D IN^PSJOCDS($G(PSGORD),"UD",PSJDD)
"RTN","PSGOD",80,0)
 Q
"RTN","PSGOE")
0^42^B26260388^B26201410
"RTN","PSGOE",1,0)
PSGOE ;BIR/CML3-PROFILE AND ORDER ENTRY (MAIN DRIVER) ;24 Feb 99 / 10:40 AM
"RTN","PSGOE",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**22,29,56,72,95,80,133,181,275,315**;16 DEC 97;Build 73
"RTN","PSGOE",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PSGOE",4,0)
 ; Reference to ^PS(55 is supported by DBIA 2191
"RTN","PSGOE",5,0)
 ; Reference to ^PSSLOCK is supported by DBIA #2789
"RTN","PSGOE",6,0)
 ;
"RTN","PSGOE",7,0)
 ;N PSJNEW,PSGPTMP,PPAGE S PSJNEW=1
"RTN","PSGOE",8,0)
 ;
"RTN","PSGOE",9,0)
EN ;
"RTN","PSGOE",10,0)
 N PSJLK,PSJPROT,XQORS,VALMEVL,PSJSYSO D ENCV^PSGSETU Q:$D(XQUIT)
"RTN","PSGOE",11,0)
 S (PSGOL,PSGOP,PSGNEF,PSGOEAV,PSGPXN)="" I $P(PSJSYSU,";",2)&($P(PSJSYSU,";")'=3) S PSGION=ION D DDEV D ^%ZISC I DDEV="^" G DONE
"RTN","PSGOE",12,0)
 K PSGVBY L +^PS(53.45,PSJSYSP):1 E  D LOCKERR^PSJOE G DONE
"RTN","PSGOE",13,0)
 F  S (PSJLMCON,PSGPTMP)=0 D ENDPT^PSGP,HK Q:PSGP'>0  D   I PSJLK D UL^PSSLOCK(PSGP)
"RTN","PSGOE",14,0)
 .K ^TMP("PSJ",$J)
"RTN","PSGOE",15,0)
 .S PSJLK=$$L^PSSLOCK(PSGP,1) I 'PSJLK W !,$C(7),$P(PSJLK,U,2) Q
"RTN","PSGOE",16,0)
 .N NXTPT S NXTPT=0  ;NXTPT=1 indicates OE is complete for this patient
"RTN","PSGOE",17,0)
 .K PSJLMPRO S PSJLMCON=0
"RTN","PSGOE",18,0)
 .S PSJPROT=1,DFN=PSGP D EN^VALM("PSJ LM BRIEF PATIENT INFO")
"RTN","PSGOE",19,0)
 .F  Q:$G(NXTPT)  D
"RTN","PSGOE",20,0)
 ..K PSGRDTX
"RTN","PSGOE",21,0)
 ..I $G(PSJLMCON)!$G(PSJNEWOE) D
"RTN","PSGOE",22,0)
 ...S PSJOL=$S(",S,L,"[(","_$G(PSJOL)_","):PSJOL,1:"S")
"RTN","PSGOE",23,0)
 ...S PSJLMPRO=1,PSJLMCON=1,PSJNEWOE=0 D EN^VALM("PSJU LM OE")
"RTN","PSGOE",24,0)
 ..I $G(PSJNEWOE)!($G(VALMBCK)="Q") S PSJNEWOE=0 Q
"RTN","PSGOE",25,0)
 ..I $G(PSJLMCON)&$G(PSJLMPRO)&'$D(^TMP("PSJ",$J)) D  Q
"RTN","PSGOE",26,0)
 ...S PSJLMCON=0,PSJLMPRO=0 D EN^VALM("PSJ LM BRIEF PATIENT INFO")
"RTN","PSGOE",27,0)
 ...I $G(PSJNEWOE) S NXTPT=0 Q
"RTN","PSGOE",28,0)
 ...S NXTPT=1
"RTN","PSGOE",29,0)
 ..S NXTPT=1,PSJNEWOE=0 ; Go on to next patient
"RTN","PSGOE",30,0)
 .I $G(PSGPXN),$P(PSJSYSW0,U,29)]"" S PSGPXPT=PSGP D  K PSGPXPT S PSGPXN=0
"RTN","PSGOE",31,0)
 ..N DFN,PSGP S (PSGP,DFN)=PSGPXPT D ^PSGPER
"RTN","PSGOE",32,0)
 .D ENCV^PSGSETU
"RTN","PSGOE",33,0)
 K PSJLMPRO,^TMP("PSJPRO",$J),^TMP("PSJ",$J),^TMP("PSJON",$J)
"RTN","PSGOE",34,0)
 ;
"RTN","PSGOE",35,0)
DONE ;
"RTN","PSGOE",36,0)
 I PSGOP,$P(PSJSYSL,"^",2)]"" D ENQL^PSGLW
"RTN","PSGOE",37,0)
 I $D(PSJSYSO),PSGOP,$O(^PS(53.44,DUZ,1,PSGOP,1,0)) S PSGOEPOF="" D ^PSGOEPO
"RTN","PSGOE",38,0)
 K PSJEXCPT,PSJOCER,^TMP($J,"PSJPRE")
"RTN","PSGOE",39,0)
 K D0,DDEV,FQC,J,MRN,ND,ND2,PSGNEF,PSGNEFDO,PSGNESDO,PSGOE,PSGOEA,PSGOEAV,PSGOEDMR,PSGOENOF,PSGOEPOF,PSGOL,PSGOP,PSGPX,PSGTOL,PSGTOO,PSGUOW,PSJOPC,PSJORTOU,PSJORVP,PRI,PX,XX L -^PS(53.45,PSJSYSP)
"RTN","PSGOE",40,0)
 K PSGOEORF,ORIFN,ORETURN,PSJORL,PSJORPCL,PSJORPV,PSJNOO,DDH,DDN,DRGI,FQ,HF,I1,ND1,NF,PDRG,PSGACTO,PSGAL,PSGCANFL,PSGDA,PSGPEN,PSGPENWS,PSGY,ND2P1 ;*315
"RTN","PSGOE",41,0)
 G:$G(PSGPXN) ^PSGPER1 D ENKV^PSGSETU K ND1,PSG25,PSG26,PSGEB,PSBEBN,PSGNODE,PSGOAT,PSGSTAT,DDN,I2 Q
"RTN","PSGOE",42,0)
 Q
"RTN","PSGOE",43,0)
 ;
"RTN","PSGOE",44,0)
HK ; Housekeeping (a nice COBOL term)
"RTN","PSGOE",45,0)
 S PSGOENOF=0 I +PSJSYSU=1 D NOW^%DTC F Q=%:0 Q:PSGOENOF  S Q=$O(^PS(55,PSGP,5,"AUS",Q)) Q:'Q  F QQ=0:0 S QQ=$O(^PS(55,PSGP,5,"AUS",Q,QQ)) Q:'QQ  I $D(^PS(55,PSGP,5,QQ,4)),$P(^(4),"^",10) S PSGOENOF=1 Q
"RTN","PSGOE",46,0)
 I PSGOP,PSGOP'=PSGP D
"RTN","PSGOE",47,0)
 .N PSJACPF,PSJACNWP,PSJPWD,PSJSYSL,PSJSYSW,PSJSYSW0,DFN,VAIN,VAERR S DFN=PSGOP
"RTN","PSGOE",48,0)
 .D INP^VADPT S PSJPWD=+VAIN(4) I PSJPWD S PSJACPF=10 D WP^PSJAC D:$P(PSJSYSL,"^",2)]"" ENQL^PSGLW
"RTN","PSGOE",49,0)
 I $D(PSJSYSO),PSGOP,PSGOP'=PSGP S PSGOEPOF="" D ^PSGOEPO
"RTN","PSGOE",50,0)
 S:PSGP>0 PSJORVP=PSGP_";DPT(",PSJORL=$$ENORL^PSJUTL(PSJPWD),PSGOP=PSGP,X=""
"RTN","PSGOE",51,0)
 Q
"RTN","PSGOE",52,0)
 ;
"RTN","PSGOE",53,0)
ORSU ; Oe/Rr Set-Up ;Not used anymore
"RTN","PSGOE",54,0)
 Q
"RTN","PSGOE",55,0)
 ;
"RTN","PSGOE",56,0)
DDEV ;
"RTN","PSGOE",57,0)
 F  S POP=1 R !!,"Select Device to print ORDERS (10-1158): ",DDEV:DTIME W:'$T $C(7) S:'$T DDEV="^" Q:DDEV="^"!(DDEV=".")  D:DDEV?1."?" DDH K %ZIS,IO("Q") S %ZIS="NQ",IOP=DDEV D ^%ZIS Q:'POP
"RTN","PSGOE",58,0)
 S:DDEV="^" %=-1 Q:POP  I $E(IOST)'="P"!(PSGION=ION) W $C(7),!!?2,"The device you have selected is not a printer.  You must select a printer." W:PSGION=ION !,"You cannot print the orders to your terminal." G DDEV
"RTN","PSGOE",59,0)
 S PSJSYSO=ION_"^"_IO W:$S(DDEV=" ":1,$L(DDEV)'<$L(ION):0,1:DDEV=$E(ION,1,$L(DDEV))) $S(DDEV=" ":"  "_ION,1:$E(ION,$L(DDEV)+1,$L(ION)))
"RTN","PSGOE",60,0)
 F Q=0:0 S Q=$O(^PS(53.44,DUZ,1,Q)) Q:'Q  I $O(^(Q,1,0)) Q
"RTN","PSGOE",61,0)
 Q:'Q  W !!?2,"You have unprinted orders.  If you do not print them now, you will not be",!,"able to print them from here later."
"RTN","PSGOE",62,0)
 F  W !!,"Do you want to print them now" S %=1 D YN^DICN Q:%  W !!?2,"Enter 'YES' to print the orders now.  If you enter 'NO', you will not be",!,"able to print them from here later.  (Enter '^' to exit this option.)"
"RTN","PSGOE",63,0)
 Q:%<0  I %=1 S PSGOEPOF="A" D ^PSGOEPO S %=0 Q
"RTN","PSGOE",64,0)
 S DA=DUZ,DIK="^PS(53.44," D ^DIK S %=0 Q
"RTN","PSGOE",65,0)
 ;
"RTN","PSGOE",66,0)
DDH ;
"RTN","PSGOE",67,0)
 W !!?2,"Select a device to print each patient's orders (VA Form 10-1158) after you",!,"have entered them.  If you do not select a device, no orders will print." Q
"RTN","PSGOE",68,0)
 ;
"RTN","PSGOE",69,0)
CHUCK ; This appears to be an ancient test tag - not called from any file or other routine.
"RTN","PSGOE",70,0)
 D ENCV^PSGSETU Q:$D(XQUIT)  R !!,"PSJSYSU: ",PSJSYSU:DTIME S:'$T PSJSYSU="^" I "^"'[PSJSYSU G EN
"RTN","PSGOE",71,0)
 Q
"RTN","PSGOE0")
0^15^B13276254^B12881111
"RTN","PSGOE0",1,0)
PSGOE0 ;BIR/CML3-PROFILE AND ORDER ENTRY ;25 SEP 97 / 7:42 AM
"RTN","PSGOE0",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**110,315**;16 DEC 97;Build 73
"RTN","PSGOE0",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PSGOE0",4,0)
 ; Reference to ^PS(55 is supported by DBIA #2191.
"RTN","PSGOE0",5,0)
 ; Reference to ^PS(51.2 is supported by DBIA# 2178.
"RTN","PSGOE0",6,0)
 ; 
"RTN","PSGOE0",7,0)
START ; print orders
"RTN","PSGOE0",8,0)
 W:X]"" $P("^PROFILE",X,2) D ENL^PSGOU G:PSGOL="^" DONE G:PSGOL="N" ASK K PSGPR S PSGOEAV=0,PSJNARC=1,PSJOPC="UD" D ^PSGO I 'PSGON G ASK
"RTN","PSGOE0",9,0)
 ;
"RTN","PSGOE0",10,0)
ENVO ; view/act on orders
"RTN","PSGOE0",11,0)
 S PSGLMT=PSGON D ENASR^PSGON G:"^"[X ASK G:X["^^" DONE
"RTN","PSGOE0",12,0)
 I X="D" D EN^PSGOECS G:'$D(X) ENVO S X="^PROFILE" G START
"RTN","PSGOE0",13,0)
 I X="R" D EN^PSGOERS G:'$D(X) ENVO S X="^PROFILE" G START
"RTN","PSGOE0",14,0)
 I X="V" D EN^PSGOEVS G:'$D(X) ENVO S X="^PROFILE" G START
"RTN","PSGOE0",15,0)
 I X="F" D EN^PSGOESF G:'$D(X) ENVO S X="^PROFILE" G START
"RTN","PSGOE0",16,0)
 I PSGODDD S PSGOEA=""
"RTN","PSGOE0",17,0)
 I  F PSGOE=1:1:PSGODDD F PSGOE1=1:1:$L(PSGODDD(PSGOE),",")-1 S PSGOE2=$P(PSGODDD(PSGOE),",",PSGOE1) D EN1^PSGVW K CONT D  Q:'$D(PSGODDD)!($G(PSGOEA)["^")
"RTN","PSGOE0",18,0)
 .Q:$G(PSGOEA)["^"  I $D(PSGPRF) W !!,"Press RETURN to continue: " R CONT:DTIME W @IOF S:CONT["^" PSGOEA="^"
"RTN","PSGOE0",19,0)
 .D ^PSGOE1:'$D(PSGPRF) Q:$G(PSGOEA)["^"  I $D(PSGPRF),PSGORD["N",'$D(CONT) K DIR S DIR(0)="E" W ! D ^DIR Q:X["^"!$D(DIRUT)
"RTN","PSGOE0",20,0)
 ;
"RTN","PSGOE0",21,0)
 ;
"RTN","PSGOE0",22,0)
ASK ; new orders entered here
"RTN","PSGOE0",23,0)
 K ^TMP("PSJON",$J),DIR,DIROUT,DIRUT,DRGI,DTOUT,DUOUT,PRI,PSGLMT,PSGODDD,PSGOE1,PSGOE2,PSGOEA,PSGOEE,PSGON,PSGONC,PSGONF,PSGONR,PSGONV Q:$D(PSGPRF)  K PSGCANFL,PSGOL Q:'PSJPCAF
"RTN","PSGOE0",24,0)
 F  W !!,"New order(s) for ",$P(PSGP(0),"^"),"?  Y// " R X:DTIME W:'$T $C(7) S:'$T X="^" S:X="" X="Y" G:$P("^PROFILE",X)=""&(X'="^") START Q:"^YyNn"[X  D:X?1."?" AM W:X'?1."?" $C(7),"  ??"
"RTN","PSGOE0",25,0)
 W:"Nn"[X "  (NO)" G:"^Nn"[X DONE W "  (YES)"
"RTN","PSGOE0",26,0)
 I '$P(PSJSYSU,";",2) S PR=$P($G(^PS(55,PSGP,5.1)),"^",2) I PR D
"RTN","PSGOE0",27,0)
 .S X=$G(^VA(200,PR,"PS")) I $S('X:1,'$P(X,"^",4):0,1:DT'>$P(X,"^",4)) D:'$D(^PS(55,PSGP,0)) ENSET0^PSGNE3(PSGP) S $P(^PS(55,PSGP,5.1),"^",2)="",PR=""
"RTN","PSGOE0",28,0)
 S PSGOEAV=$P(PSJSYSP0,"^",9)&PSJSYSU,PSGOEDMR=$O(^PS(51.2,"B","ORAL",0)),PSGOEPR=$S($P(PSJSYSU,";",2):DUZ,1:PR) S:'PSGOEPR PSGOEPR=PSJPTSP
"RTN","PSGOE0",29,0)
 ;
"RTN","PSGOE0",30,0)
DRG ;
"RTN","PSGOE0",31,0)
 D ^PSGOE7 G:Y<0 DONE G:$P("^PROFILE",X)="" START I X?1"S."1.E D ^PSGOES G DRG
"RTN","PSGOE0",32,0)
 W ! D ^PSGOE3:$P(PSJSYSP0,"^",12),^PSGOE4:'$P(PSJSYSP0,"^",12) K PSGOEE,PSGOEOS D:$D(Y) ^PSGOETO G DRG
"RTN","PSGOE0",33,0)
 ;
"RTN","PSGOE0",34,0)
DONE ;
"RTN","PSGOE0",35,0)
 K DIR,DIROUT,DIRUT,DTOUT,DUOUT,PSG,PSGDL,PSGDLS,PSGDO,PSGDRG,PSGDRGN,PSGFD,PSGHSM,PSGMR,PSGMRN,PSGNEDFD,PSGNEFD,PSGNESD,PSGNEWDT
"RTN","PSGOE0",36,0)
 K PSGOEPR,PSGOES,PSGOPR,PSGORD,PSGOROE1,PSGPR,PSGPRN,PSGS0XT,PSGS0Y,PSGSCH,PSGSD,PSGSI,PSGSM,PSGST,PSGSTN,PSGUD,PSGX,PSJNARC,PSJOPC
"RTN","PSGOE0",37,0)
 K PSGRF,PSGRMV,PSGRMVT,PSGDUR,ND2P1 ;*315
"RTN","PSGOE0",38,0)
 Q
"RTN","PSGOE0",39,0)
 ;
"RTN","PSGOE0",40,0)
AM ;
"RTN","PSGOE0",41,0)
 W !!?2,"Answer 'YES' (or press the RETURN key) to enter new UNIT DOSE orders for this",!,"patient.  Answer 'NO' (or '^') if there are no new orders for this patient." Q
"RTN","PSGOE1")
0^16^B29572227^B29072557
"RTN","PSGOE1",1,0)
PSGOE1 ;BIR/CML3-ACTION ON INPATIENT ORDERS ;10 Mar 99 / 10:54 AM
"RTN","PSGOE1",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**7,19,26,39,58,85,80,110,127,133,134,315**;16 DEC 97;Build 73
"RTN","PSGOE1",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PSGOE1",4,0)
 ; Reference to ^PS(55 is supported by DBIA #2191.
"RTN","PSGOE1",5,0)
 ; Reference to ^PSDRUG( is supported by DBIA #2192.
"RTN","PSGOE1",6,0)
 ; Reference to EN1^ORCFLAG is supported by DBIA #3620.
"RTN","PSGOE1",7,0)
 ; Reference to AND^ORX8 is supported by DBIA #3632.
"RTN","PSGOE1",8,0)
EN ;       
"RTN","PSGOE1",9,0)
 K PSGDFLG,PSGPFLG S PSGOEA="^",PSGACT="",(PSGDI,PSGOENG,PSGPI,PSGRRF)=0
"RTN","PSGOE1",10,0)
 Q:'$G(DUZ)
"RTN","PSGOE1",11,0)
 D @$S(PSGORD["P":"NON",1:"ACT")
"RTN","PSGOE1",12,0)
GO ;
"RTN","PSGOE1",13,0)
 K A,ND,PSGE,PSGR,ST,X,X1,X2,Y I $D(ORACTION) K PSGDI,PSGOENG,PSGPI Q
"RTN","PSGOE1",14,0)
 Q
"RTN","PSGOE1",15,0)
ENACTION(PSGP,PSGORD)        ;
"RTN","PSGOE1",16,0)
 ;Returns string identifying the actions allowed on this order.
"RTN","PSGOE1",17,0)
 D EN
"RTN","PSGOE1",18,0)
 Q PSGACT
"RTN","PSGOE1",19,0)
DONE ;
"RTN","PSGOE1",20,0)
 I PSGORD["U"!(PSGORD["O") L -^PS(55,PSGP,5,+PSGORD)
"RTN","PSGOE1",21,0)
 E  L -^PS(53.1,+PSGORD)
"RTN","PSGOE1",22,0)
 K C,PSGACT,PSGDFLG,PSGPFLG,PSGDI,PSGOENG,PSGPI,PSGRRF Q
"RTN","PSGOE1",23,0)
B ; bypass
"RTN","PSGOE1",24,0)
 S PSGCANFL=1
"RTN","PSGOE1",25,0)
 Q
"RTN","PSGOE1",26,0)
C ; copy an order (does NOT discontinue original order)
"RTN","PSGOE1",27,0)
 D ^PSGOD Q
"RTN","PSGOE1",28,0)
D ; discontinue (or delete) an order
"RTN","PSGOE1",29,0)
 I PSGOEAV,'$D(PSGODF) D ENDS^PSGPO Q
"RTN","PSGOE1",30,0)
 D ENO^PSGOEC(PSGP,PSGORD) Q
"RTN","PSGOE1",31,0)
E ; edit orders
"RTN","PSGOE1",32,0)
 D ^PSGOEE Q
"RTN","PSGOE1",33,0)
F ; finish released orders
"RTN","PSGOE1",34,0)
 D ^PSGOEF Q
"RTN","PSGOE1",35,0)
H(PSGP,PSGORD) ; hold
"RTN","PSGOE1",36,0)
 S X=$G(^PS(55,PSGP,5,+PSGORD,4)) I $P(X,U,12),$P(X,U,13) W $C(7),!!,"WARNING!  THIS ORDER HAS BEEN MARKED FOR CANCELLATION."
"RTN","PSGOE1",37,0)
 I $P($G(^PS(55,PSGP,5,+PSGORD,0)),"^",9)="H" D ^PSGOEH0 Q
"RTN","PSGOE1",38,0)
 D ^PSGOEH1 Q
"RTN","PSGOE1",39,0)
I ; mark (or unmark) a non-verified order as 'incomplete'
"RTN","PSGOE1",40,0)
 D ^PSGOEI Q
"RTN","PSGOE1",41,0)
L ; display logs
"RTN","PSGOE1",42,0)
 D ^PSGOEL Q
"RTN","PSGOE1",43,0)
N ; mark order as 'not to be given'
"RTN","PSGOE1",44,0)
 D ^PSGOENG Q
"RTN","PSGOE1",45,0)
O ; Outpatient (discharge) med
"RTN","PSGOE1",46,0)
 W !!,"UNDER DEVELOPMENT, NOT CURRENTLY AVAILABLE."
"RTN","PSGOE1",47,0)
 Q
"RTN","PSGOE1",48,0)
P ; print expanded view
"RTN","PSGOE1",49,0)
 D ^PSGVWP Q
"RTN","PSGOE1",50,0)
R ; renew an order
"RTN","PSGOE1",51,0)
 I 'PSJSYSU,$D(^PS(55,PSGP,5,+PSGORD,4)),$P(^(4),"^",15),$P(^(4),"^",16) W !!,"THIS ORDER IS ALREADY MARKED FOR RENEWAL!" Q
"RTN","PSGOE1",52,0)
 I 'PSGRRF D ^PSGOER Q
"RTN","PSGOE1",53,0)
 D ^PSGOERI Q
"RTN","PSGOE1",54,0)
S ; show the order again
"RTN","PSGOE1",55,0)
 D EN2^PSGVW Q
"RTN","PSGOE1",56,0)
V ; verify an order
"RTN","PSGOE1",57,0)
 D EN^PSGOEV Q
"RTN","PSGOE1",58,0)
ACT ;
"RTN","PSGOE1",59,0)
 S X=$G(^PS(55,PSGP,5,+PSGORD,0)),ND0=X,ND=$G(^(4)),ND2=$G(^(2)),ND2P1=$G(^(2.1)),PSGOENG=$P(X,"^",22),PSGR=$E("R",'PSGOENG),PSJCOM=$P($G(^PS(55,PSGP,5,+PSGORD,.2)),U,8) ;*315
"RTN","PSGOE1",60,0)
 I 'PSGOENG,PSJCOM S PSGR=$E("R",$$AND^ORX8(PSJCOM)) S:PSGR="R" PSGR=$E("R",$$RNEWOK^PSJUTL2(PSJCOM,PSGP))
"RTN","PSGOE1",61,0)
 S PSGR=$E("R",'$$EXPIRED^PSGOER(PSGP,PSGORD)) S PSGR=$E("R",$P(ND0,"^",7)'="O")
"RTN","PSGOE1",62,0)
 I $P(ND2,U,4)'>PSGDT D OLD Q
"RTN","PSGOE1",63,0)
 S PSGE="E" I '$D(PSGOETOF) S (PSGDFLG,PSGDI)='$$DDOK^PSGOE2("^PS(55,"_PSGP_",5,"_+PSGORD_",1,",+$G(^PS(55,PSGP,5,+PSGORD,.2))),PSGPFLG='$$OIOK^PSGOE2(+$G(^PS(55,PSGP,5,+PSGORD,.2)))
"RTN","PSGOE1",64,0)
 S:$P(X,"^",26) (PSGE,PSGR)=""
"RTN","PSGOE1",65,0)
 I '$D(PSGOETOF) S PSGPI=$P(X,"^",2) I PSGPI S PSGPI=$P($G(^VA(200,PSGPI,"PS")),"^",4) S:PSGPI PSGPI=PSGPI'>DT
"RTN","PSGOE1",66,0)
 S ST=$P(X,"^",9)="H"*4 S:ST (PSGE,PSGR)=""
"RTN","PSGOE1",67,0)
 N CMPOK S CMPOK=1 I $$COMPLEX^PSJOE(PSGP,PSGORD) S CMPOK=+$P(^PS(55,PSGP,5,+PSGORD,.2),"^",8)
"RTN","PSGOE1",68,0)
 S PSGACT="D"_$S('$G(CMPOK):"",1:PSGE)_$S($P(ND,"^",18+ST)&'$P(ND,"^",19+ST)&'$P(ND,"^",PSJSYSU):"",1:"H")_"L"_$S(ST:"",1:PSGR)
"RTN","PSGOE1",69,0)
 I PSJSYSU,'$P(ND,"^",+PSJSYSU) S PSGACT=PSGACT_"V"
"RTN","PSGOE1",70,0)
 I +PSJSYSU=3,$L($T(EN1^ORCFLAG)) S PSGACT=PSGACT_"G"
"RTN","PSGOE1",71,0)
 Q
"RTN","PSGOE1",72,0)
OLD ;
"RTN","PSGOE1",73,0)
 S A=$P(ND0,"^",9),PSGACT=$E("H",A="H")_"L" I A'["D",A'["E" Q
"RTN","PSGOE1",74,0)
 I 'PSGOENG,($D(^XUSEC("PSJU MGR",DUZ))!$D(^XUSEC("PSJ RPHARM",DUZ))) S PSGACT="LN"
"RTN","PSGOE1",75,0)
 I PSJSYSU,'$P(ND,"^",+PSJSYSU) S:(A'["D")&($G(PSGPRIO)'="DONE") PSGACT="D"_PSGACT S PSGACT=PSGACT_"V" Q
"RTN","PSGOE1",76,0)
 Q:PSGR=""!'PSJPCAF  D NOW^%DTC S (PSGDT,X1)=+$E(%,1,12),X2=-4 D C^%DTC I $S('$P(ND2,"^",4):1,1:$P(ND2,"^",4)'>X) Q
"RTN","PSGOE1",77,0)
 I A="E",$G(PSJPRI)'="D" S PSGACT=PSGACT_PSGR Q
"RTN","PSGOE1",78,0)
 I PSJSYSU,$P(ND,"^",11) S PSGACT=PSGACT_PSGR,PSGRRF=1
"RTN","PSGOE1",79,0)
 Q
"RTN","PSGOE1",80,0)
NON ;
"RTN","PSGOE1",81,0)
 N XND,DRGPT,XND2
"RTN","PSGOE1",82,0)
 S (X,XND)=$G(^PS(53.1,+PSGORD,0)) I $P(X,"^",19),$D(^PS(55,PSGP,5,$P(X,"^",19))) L -^PS(53.1,+PSGORD) S PSGORD=$P(X,"^",19)_"U" G ACT
"RTN","PSGOE1",83,0)
 I $S($P(X,"^",26):1,$P(X,"^",9)["D":1,1:$P(X,"^",9)["E") S:$P(X,U,9)="P"&($P(X,U,26)) PSGACT="D" S:(+PSJSYSU=3)&($L($T(EN1^ORCFLAG))) PSGACT=PSGACT_"G" Q
"RTN","PSGOE1",84,0)
 I PSGORD["U" S PSGACT="DE" S:(+PSJSYSU=3)&($L($T(EN1^ORCFLAG))) PSGACT=PSGACT_"G" Q
"RTN","PSGOE1",85,0)
 I '$D(PSGOETOF) S (PSGDFLG,PSGDI)='$$DDOK^PSGOE2("^PS(53.1,"_+PSGORD_",1,",+$G(^PS(53.1,+PSGORD,.2))),PSGPFLG='$$OIOK^PSGOE2(+$G(^PS(53.1,+PSGORD,.2)))
"RTN","PSGOE1",86,0)
 S DRG=$$STUFFDD^PSGOE2 S:DRG ^PS(53.1,+PSGORD,1,0)="^53.11P^1^1",^PS(53.1,+PSGORD,1,1,0)=DRG,^PS(53.1,+PSGORD,1,"B",DRG,1)=""
"RTN","PSGOE1",87,0)
 F DRG=0:0 S DRG=$O(^PS(53.1,+PSGORD,1,DRG)) Q:'DRG  S DRGPT=^(DRG,0) S INACTDT=$G(^PSDRUG(+DRGPT,"I")) I INACTDT,(INACTDT'>DT) S PSGDFLG=1
"RTN","PSGOE1",88,0)
 I $P(XND,U,9)="P" S PSGACT=$S(+PSJSYSU=3:"BDEF",$G(PSJRNF):"BDEF",1:"") S:(+PSJSYSU=3)&($L($T(EN1^ORCFLAG))) PSGACT=PSGACT_"G" Q
"RTN","PSGOE1",89,0)
 I '$D(PSGOETOF) S PSGPI=$P(XND,"^",2) I PSGPI S PSGPI=$P($G(^VA(200,PSGPI,"PS")),"^",4) S:PSGPI PSGPI=PSGPI'>DT
"RTN","PSGOE1",90,0)
 S PSGACT="DEI" I PSJSYSU,'PSGPI,$P(XND,"^",9)'="I" S PSGACT=PSGACT_"V"
"RTN","PSGOE1",91,0)
 S XND2=$G(^PS(53.1,+PSGORD,.2)) I $P(XND2,"^",8),$P(XND,"^",9)="P" S PSGACT=$TR(PSGACT,"V")
"RTN","PSGOE1",92,0)
 I +PSJSYSU=3,$L($T(EN1^ORCFLAG)) S PSGACT=PSGACT_"G"
"RTN","PSGOE1",93,0)
 I $P($G(PSGRDTX),U,2)]"",'$P($G(^PS(53.1,+PSGORD,2.5)),"^",2) S $P(^PS(53.1,+PSGORD,2.5),U,2)=$P(PSGRDTX,U,2)
"RTN","PSGOE1",94,0)
 Q
"RTN","PSGOE1",95,0)
ACTO ;
"RTN","PSGOE1",96,0)
 S PSGACTO="" I $G(PSGACT)]"" F X=1:1:$L(PSGACT) S PSGACTO=PSGACTO_$S($E(PSGACT,X)="D":"DC",1:$E(PSGACT,X))_" "
"RTN","PSGOE1",97,0)
 S:PSGACTO]"" PSGACTO=$E(PSGACTO,1,$L(PSGACTO)-1) Q
"RTN","PSGOE3")
0^17^B25305463^B24652954
"RTN","PSGOE3",1,0)
PSGOE3 ;BIR/CML3-ABBREV/WARD ORDER ENTRY ;09 JAN 97 / 10:42 AM
"RTN","PSGOE3",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**58,81,315**;16 DEC 97;Build 73
"RTN","PSGOE3",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PSGOE3",4,0)
 ; Reference to ^DD(53.1 is supported by DBIA 2256.
"RTN","PSGOE3",5,0)
 ; Reference to ^PS(51.2 is supported by DBIA 2178.
"RTN","PSGOE3",6,0)
 ;
"RTN","PSGOE3",7,0)
 K PSGFOK S F1=53.1,PSGPR=$S($D(PSGOERR):PSJORPV,1:PSGOEPR),PSGMR=$S($P(PSGNEDFD,"^",2):$P(PSGNEDFD,"^",2),1:PSGOEDMR),PSGSCH=$P(PSGNEDFD,"^",4),(PSGOROE1,PSGSI,SDT,PSGMRN,PSGSM,PSGHSM,PSGUD)=""
"RTN","PSGOE3",8,0)
 S:PSGMR PSGMRN=$S('$P(PSGNEDFD,"^",2):"ORAL",'$D(^PS(51.2,PSGMR,0)):PSGMR,$P(^(0),"^")]"":$P(^(0),"^"),1:PSGMR) I PSGPR S PSGPRN=$P($G(^VA(200,PSGPR,0)),"^") S:PSGPRN="" PSGPRN=PSGPR
"RTN","PSGOE3",9,0)
 S PSGST=$S($P(PSGNEDFD,"^",3)]"":$P(PSGNEDFD,"^",3),1:"C"),PSGSTN=$$ENSTN^PSGMI(PSGST),F1=53.1 K PSGFOK S PSGFOK(2)=""
"RTN","PSGOE3",10,0)
 S:$P(PSJSYSU,";",4) PSGFOK(2)="" K ^PS(53.45,PSJSYSP,1),^(2) I PSGDRG S ^(2,0)="^53.4502P^"_PSGDRG_"^1",^(1,0)=PSGDRG,^PS(53.45,PSJSYSP,2,"B",PSGDRG,1)=""
"RTN","PSGOE3",11,0)
 ;
"RTN","PSGOE3",12,0)
GTFIELD ; Call ^PSGOE4 for the rest of the data to complete order entry
"RTN","PSGOE3",13,0)
 ; PSGOE3 is set only if user is using the ABBREV/WARD ORDER ENTRY.
"RTN","PSGOE3",14,0)
 NEW PSGOE3 S PSGOE3=1
"RTN","PSGOE3",15,0)
 D 109^PSGOE4 Q:PSGOROE1
"RTN","PSGOE3",16,0)
 D 3^PSGOE4 Q:PSGOROE1
"RTN","PSGOE3",17,0)
 D 26^PSGOE4 Q:PSGOROE1
"RTN","PSGOE3",18,0)
 D 8^PSGOE41 Q:PSGOROE1
"RTN","PSGOE3",19,0)
 D 10^PSGOE41 Q:PSGOROE1
"RTN","PSGOE3",20,0)
 ; Setup stop date.
"RTN","PSGOE3",21,0)
 S PSGOES=1 D ENFD^PSGNE3(PSGDT) K PSGOES
"RTN","PSGOE3",22,0)
 ;*315 drp ask for Duration of Administration
"RTN","PSGOE3",23,0)
 K PSGDUR,PSGRMV,PSGRMVT,PSGRF
"RTN","PSGOE3",24,0)
 D PSGDUR^PSGOE41 Q:PSGOROE1
"RTN","PSGOE3",25,0)
 D ^PSGOE42
"RTN","PSGOE3",26,0)
 ;I $S($P(PSJSYSW0,"^",24):1,+PSJSYSU=3:1,$P(PSJSYSU,";",2):0,$D(PSJOERR):0,1:PSGOEORF) G ^PSGOE31
"RTN","PSGOE3",27,0)
 Q 
"RTN","PSGOE3",28,0)
 ;
"RTN","PSGOE3",29,0)
109 ; dosage ordered
"RTN","PSGOE3",30,0)
 W !,"THIS IS THE OLD DOSAGE ORDERED PROMPT!!",!
"RTN","PSGOE3",31,0)
 Q
"RTN","PSGOE3",32,0)
 W !,"DOSAGE ORDERED: ",$S(PSGDO]"":PSGDO_"// ",1:"") R X:DTIME I X="^"!'$T W:'$T $C(7) S PSGOROE1=1 G DONE
"RTN","PSGOE3",33,0)
 I X="" S X=PSGDO I X="" W $C(7),"  (Required)" G 109
"RTN","PSGOE3",34,0)
 I X="@" W $C(7),"  (Required)" G 109
"RTN","PSGOE3",35,0)
 ; I X="@" D DEL G:%'=1 109 S PSGDO="" S PSGFOK(109)="" G 3
"RTN","PSGOE3",36,0)
 S PSGF2=109 I X?1."?" D ENHLP^PSGOEM(53.1,109) G 109
"RTN","PSGOE3",37,0)
 I $E(X)="^" D FF G:Y>0 @Y G 109
"RTN","PSGOE3",38,0)
 I $E(X,$L(X))=" " F  S X=$E(X,1,$L(X)-1) Q:$E(X,$L(X))'=" "
"RTN","PSGOE3",39,0)
 I $S(X?.E1C.E:1,$L(X)>20:1,X="":1,X["^":1,X?1.P:1,1:X=+X) W $C(7),"  ",$S(X?1.P!(X=""):"(Required)",1:"??") S X="?" D ENHLP^PSGOEM G 109
"RTN","PSGOE3",40,0)
 S PSGDO=X,PSGFOK(109)=""
"RTN","PSGOE3",41,0)
 ;
"RTN","PSGOE3",42,0)
3 ; med route
"RTN","PSGOE3",43,0)
 W !,"MED ROUTE: ",$S(PSGMR:PSGMRN_"// ",1:"") R X:DTIME I X="^"!'$T W:'$T $C(7) S PSGOROE1=1 G DONE
"RTN","PSGOE3",44,0)
 I X="",PSGMR S X=PSGMRN I PSGMR'=PSGMRN,$D(^PS(51.2,PSGMR,0)) W "  "_$P(^(0),"^",3) S PSGFOK(3)="" G 26
"RTN","PSGOE3",45,0)
 S PSGF2=3 I $S(X="@":1,X]"":0,1:'PSGMR) W $C(7),"  (Required)" S X="?" D ENHLP^PSGOEM(53.1,3) G 3
"RTN","PSGOE3",46,0)
 I X?1."?" D ENHLP^PSGOEM(53.1,3)
"RTN","PSGOE3",47,0)
 I $E(X)="^" D FF G:Y>0 @Y G 3
"RTN","PSGOE3",48,0)
 K DIC S DIC="^PS(51.2,",DIC(0)="EMQZ",DIC("S")="I $P(^(0),""^"",4)" D ^DIC K DIC I Y'>0 G 3
"RTN","PSGOE3",49,0)
 S PSGMR=+Y,PSGMRN=$P(Y(0),"^"),PSGFOK(3)=""
"RTN","PSGOE3",50,0)
 ;
"RTN","PSGOE3",51,0)
26 ; schedule
"RTN","PSGOE3",52,0)
 W !,"SCHEDULE: ",$S(PSGSCH]"":PSGSCH_"// ",1:"") R X:DTIME I X="^"!'$T W:'$T $C(7) S PSGOROE1=1 G DONE
"RTN","PSGOE3",53,0)
 S PSGF2=26 S:X="" X=PSGSCH I "@"[X W $C(7),"  (Required)" S X="?" D ENHLP^PSGOEM(53.1,26) G 26
"RTN","PSGOE3",54,0)
 I X?1."?" D ENHLP^PSGOEM(53.1,26) G 26
"RTN","PSGOE3",55,0)
 I $E(X)="^" D FF G:Y>0 @Y G 26
"RTN","PSGOE3",56,0)
 D EN^PSGS0 I '$D(X) W $C(7),"  ??" S X="?" D ENHLP^PSGOEM(53.1,26) G 26
"RTN","PSGOE3",57,0)
 S PSGSCH=X,PSGST=$S(PSGS0XT="O":"O",PSGST="R":"R",X["PRN":"P",X="ON CALL":"OC",PSGST]"":PSGST,1:"C"),PSGFOK(26)=""
"RTN","PSGOE3",58,0)
 S $P(PSGNEDFD,"^",3)=PSGST S:PSGSCH=""!(X?1." ") PSGSCH="PRN"
"RTN","PSGOE3",59,0)
 ;
"RTN","PSGOE3",60,0)
8 ; special instructions
"RTN","PSGOE3",61,0)
 W !,"SPECIAL INSTRUCTIONS: "_$S(PSGSI]"":$P(PSGSI,"^")_"// ",1:"") R X:DTIME I X="^"!'$T W:'$T $C(7) S PSGOROE1=1 G DONE
"RTN","PSGOE3",62,0)
 I X="" S X=PSGSI I X="" S PSGFOK(8)="" G 10
"RTN","PSGOE3",63,0)
 S PSGF2=8 I $E(X)="^" D FF G:Y>0 @Y G 8
"RTN","PSGOE3",64,0)
 I X="@",PSGSI="" W $C(7),"  ??" S X="?" D ENHLP^PSGOEM(53.1,8) G 8
"RTN","PSGOE3",65,0)
 I X="@" D DEL G:%'=1 8 S PSGSI="",PSGFOK(8)="" G 10
"RTN","PSGOE3",66,0)
 I X?1."?" D ENHLP^PSGOEM(53.1,8) G 8
"RTN","PSGOE3",67,0)
 D ^PSGSICHK I '$D(X) W $C(7)," ??" S X="?" D ENHLP^PSGOEM(53.1,8) G 8
"RTN","PSGOE3",68,0)
 S PSGSI=X I PSGSI]"" S PSGSI=$$ENBCMA^PSJUTL("U"),PSGFOK(8)=""
"RTN","PSGOE3",69,0)
 ;
"RTN","PSGOE3",70,0)
10 ; start date
"RTN","PSGOE3",71,0)
 D ^PSGNE3 S PSGSD=PSGNESDO
"RTN","PSGOE3",72,0)
A10 W !,"START DATE/TIME: "_PSGSD_"// " R X:DTIME I X="^"!'$T W:'$T $C(7) S PSGOROE1=1 G DONE
"RTN","PSGOE3",73,0)
 I X="@"!(X?1."?") W:X="@" $C(7),"  (Required)" S:X="@" X="?" D ENHLP^PSGOEM(53.1,10) G A10
"RTN","PSGOE3",74,0)
 S PSGF2=10 I $E(X)="^" D FF G:Y>0 @Y G A10
"RTN","PSGOE3",75,0)
 I X="",PSGNESD S X=PSGNESD,PSGFOK(10)="" W "  "_PSGSD G SD
"RTN","PSGOE3",76,0)
 I X="P" D ENPREV^PSGDL W:'$D(X) $C(7) G:'$D(X) A10 S PSGNESD=+X,PSGSD=$$ENDD^PSGMI(+X),PSGFOK(10)="" W "  ",PSGSD G SD
"RTN","PSGOE3",77,0)
 NEW TMPX S TMPX=X,X1=PSGDT,X2=-7 D C^%DTC K %DT S %DT="ERTX",%DT(0)=X,X=TMPX D ^%DT K %DT I Y'>0 D ENHLP^PSGOEM G A10
"RTN","PSGOE3",78,0)
 S PSGNESD=+Y,PSGSD=$$ENDD^PSGMI(PSGNESD),PSGFOK(10)=""
"RTN","PSGOE3",79,0)
 ;
"RTN","PSGOE3",80,0)
SD ; stop date
"RTN","PSGOE3",81,0)
 S PSGOES=1 D ENFD^PSGNE3(PSGDT) K PSGOES
"RTN","PSGOE3",82,0)
 ;
"RTN","PSGOE3",83,0)
 I $S($P(PSJSYSW0,"^",24):1,+PSJSYSU=3:1,$P(PSJSYSU,";",2):0,$D(PSJOERR):0,1:PSGOEORF) G ^PSGOE31
"RTN","PSGOE3",84,0)
 ;
"RTN","PSGOE3",85,0)
 ;
"RTN","PSGOE3",86,0)
DONE ;
"RTN","PSGOE3",87,0)
 I PSGOROE1 K Y W $C(7),"  ...order not entered..."
"RTN","PSGOE3",88,0)
 K F,F0,F1,PSGF2,F3,PSGFOK,PSGOROE1,PSGSD,SDT Q
"RTN","PSGOE3",89,0)
 ;
"RTN","PSGOE3",90,0)
FF ; up-arrow to another field
"RTN","PSGOE3",91,0)
 S Y=-1 I '$D(PSGFOK) W $C(7),"  ??" Q
"RTN","PSGOE3",92,0)
 S X=$E(X,2,99) I X=+X S Y=$S($D(PSGFOK(X)):X,1:-1) W "  " W:Y>0 $$CODES2^PSIVUTL(53.1,X) W:Y'>0 $C(7),"??" Q
"RTN","PSGOE3",93,0)
 K DIC S DIC="^DD(53.1,",DIC(0)="QEM",DIC("S")="I $D(PSGFOK(+Y))" D ^DIC K DIC S Y=+Y I Y>0,Y=1!(Y=2)!(Y=5)!(Y=6) S:Y=2 FB=PSGF2_"^PSGOE3" S Y=Y_"^PSGOE31"
"RTN","PSGOE3",94,0)
 Q
"RTN","PSGOE3",95,0)
 ;
"RTN","PSGOE3",96,0)
DEL ;
"RTN","PSGOE3",97,0)
 W !?3,"SURE YOU WANT TO DELETE" S %=0 D YN^DICN I %'=1 W "  <NOTHING DELETED>"
"RTN","PSGOE3",98,0)
 Q
"RTN","PSGOE41")
0^1^B97415312^B27985656
"RTN","PSGOE41",1,0)
PSGOE41 ;BIR/CML3-REGULAR ORDER ENTRY (CONT.) ;09 JAN 97 / 9:13 AM 
"RTN","PSGOE41",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**50,63,64,69,58,111,136,113,267,315**;16 DEC 97;Build 73
"RTN","PSGOE41",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PSGOE41",4,0)
 ; Reference to ^DICN is supported by DBIA 10009.
"RTN","PSGOE41",5,0)
 ; Reference to %DT is supported by DBIA 10003.
"RTN","PSGOE41",6,0)
 ; Reference to %DTC is supported by DBIA 10000.
"RTN","PSGOE41",7,0)
 ; Reference to ^PS(51.1 is supported by DBIA 2177.
"RTN","PSGOE41",8,0)
 ; Reference to ^PS(50.7 is supported by DBIA# 2180
"RTN","PSGOE41",9,0)
 ;
"RTN","PSGOE41",10,0)
39 ; admin times
"RTN","PSGOE41",11,0)
 G:$P(PSGNEDFD,"^",3)="P"!($P(PSGNEDFD,"^",3)="OC") 8
"RTN","PSGOE41",12,0)
 I $$ODD^PSGS0(PSGS0XT) D PSGDUR G 8
"RTN","PSGOE41",13,0)
 W !,"ADMIN TIMES: "_$S(PSGS0Y:PSGS0Y_"// ",1:"") R X:DTIME I X="^"!'$T W:'$T $C(7) S PSGOROE1=1,PSGDUR="" G DONE
"RTN","PSGOE41",14,0)
 I X="",PSGS0Y]"" S PSGNOHI=1,X=PSGS0Y ;*315 If admin time default was taken then don't highlight admin time.
"RTN","PSGOE41",15,0)
 I X="",$G(PSGS0XT)="D" I $L(PSGSCH,"@")=2,$P(PSGSCH,"@",2) S (PSGAT,PSGS0Y)=$P(PSGSCH,"@",2) G 8
"RTN","PSGOE41",16,0)
 I X?1."?" D ENHLP^PSGOEM(53.1,39) G 39
"RTN","PSGOE41",17,0)
 I X="@" D DEL G:%'=1 39 S (PSGFOK(39),PSGS0Y)="" G 39
"RTN","PSGOE41",18,0)
 S PSGF2=39 I $E(X)="^" D FF G:Y>0 @Y G 39
"RTN","PSGOE41",19,0)
 I (PSGS0XT="D")&('$G(X)!(X["@"&($P($G(X),"@",2)))) I ((",P,R,")'[(","_$G(PSGST)_",")) D  G 39
"RTN","PSGOE41",20,0)
 . W $C(7),"  ??" S X="?" W !,"This is a 'DAY OF THE WEEK' schedule and MUST have admin times." D ENHLP^PSGOEM(53.1,39)
"RTN","PSGOE41",21,0)
 .Q
"RTN","PSGOE41",22,0)
 I $G(PSGS0XT)'="D",$G(PSGS0XT)'="P",$G(PSGS0XT)'="OC" D TIMES G:'$D(X) 39 D PSGDUR G:'$D(X) 39 G:$G(X)="^" DONE ;*315
"RTN","PSGOE41",23,0)
 I $G(PSGS0XT)="O",X="" S (PSGAT,PSGS0Y)=X,PSGFOK(39)="" G 8
"RTN","PSGOE41",24,0)
 D ENCHK^PSGS0 I '$D(X) W $C(7),"  ??" G 39
"RTN","PSGOE41",25,0)
 S (PSGAT,PSGS0Y)=X,PSGFOK(39)=""
"RTN","PSGOE41",26,0)
 ;
"RTN","PSGOE41",27,0)
8 ; special instructions
"RTN","PSGOE41",28,0)
 S PSGSI=$$EDITSI^PSJBCMA5($G(PSGP),$G(PSGORD))
"RTN","PSGOE41",29,0)
 S PSGF2=8 I $E(X)="^" D FF G:Y>0 @Y G 8
"RTN","PSGOE41",30,0)
 I X="@",PSGSI="" W $C(7),"  ??" S X="?" D ENHLP^PSGOEM(53.1,8) G 8
"RTN","PSGOE41",31,0)
 I X="@" D DEL G:%'=1 8 S (PSGFOK(8),PSGSI)="" G:'$G(PSGOE3) 10
"RTN","PSGOE41",32,0)
 I X?1."?" D ENHLP^PSGOEM(53.1,8) G 8
"RTN","PSGOE41",33,0)
 S PSGSI=$S((PSGSI>0&(PSGSI<3)):$G(^PS(53.45,+PSJSYSP,5,1,0))_" "_$G(^PS(53.45,+PSJSYSP,5,2,0)),PSGSI>2:"Instructions too long. See Order View or BCMA for full text",1:"")
"RTN","PSGOE41",34,0)
 S:PSGSI=" " PSGSI="" I PSGSI]"" S PSGSI=$$ENBCMA^PSJUTL("U"),PSGFOK(8)=""
"RTN","PSGOE41",35,0)
 Q:$G(PSGOE3)
"RTN","PSGOE41",36,0)
10 ; start date/time
"RTN","PSGOE41",37,0)
 D ^PSGNE3
"RTN","PSGOE41",38,0)
 S:'$D(PSGNESDO) PSGNESDO=$$ENDD^PSGMI(PSGNESD) S PSGSD=PSGNESDO
"RTN","PSGOE41",39,0)
A10 W !,"START DATE/TIME: "_PSGSD_"// " R X:DTIME I X="^"!'$T W:'$T $C(7) S PSGOROE1=1 G DONE
"RTN","PSGOE41",40,0)
 I X="",PSGNESD W "  "_PSGSD G O25
"RTN","PSGOE41",41,0)
 I X="P" D ENPREV^PSGDL W:'$D(X) $C(7) G:'$D(X) A10 S PSGNESD=+X,PSGSD=$$ENDD^PSGMI(+X) W "  ",PSGSD G O25
"RTN","PSGOE41",42,0)
 S PSGF2=10 I X="@"!(X?1."?") W:X="@" $C(7),"  (Required)" S:X="@" X="?" D ENHLP^PSGOEM(53.1,10)
"RTN","PSGOE41",43,0)
 I $E(X)="^" D FF G:Y>0 @Y G A10
"RTN","PSGOE41",44,0)
 NEW TMPX S TMPX=X,X1=PSGDT,X2=-7 D C^%DTC K %DT S %DT="ERTX",%DT(0)=X,X=TMPX D ^%DT K %DT I Y'>0 D ENHLP^PSGOEM(53.1,10) G A10
"RTN","PSGOE41",45,0)
 S PSGNESD=+Y,PSGSD=$$ENDD^PSGMI(+Y),(PSGNEFD,PSGFD)=""
"RTN","PSGOE41",46,0)
 ;
"RTN","PSGOE41",47,0)
O25 ;
"RTN","PSGOE41",48,0)
 S PSGFOK(10)="" I $P(PSGNEDFD,"^",3)="O" S PSGNEFD=$$ENOSD^PSJDCU(PSJSYSW0,PSGNESD,PSGP) I PSGNEFD]"" S PSGFD=$$ENDD^PSGMI(PSGNEFD)
"RTN","PSGOE41",49,0)
 ;
"RTN","PSGOE41",50,0)
25 ; stop date
"RTN","PSGOE41",51,0)
 Q:$G(PSGOE3)
"RTN","PSGOE41",52,0)
 I 'PSGNEFD D ENFD^PSGNE3(PSGDT) S PSGFD=PSGNEFDO
"RTN","PSGOE41",53,0)
 N MSG,PSGTMPST S PSGTMPST=$G(PSGST) S:'+$G(PSGRF) PSGRF=$P($G(^PS(50.7,$G(PSGPDRG),4),0),U,1) ;*315 One time orders for MRR's require message to instruct pharmacists
"RTN","PSGOE41",54,0)
 I +$G(PSGRF),$D(^PS(51.1,"AC","PSJ",$G(PSGSCH))) D
"RTN","PSGOE41",55,0)
 . S:PSGTMPST=($G(PSGST)="R") PSGST=$P($G(^PS(51.1,$O(^PS(51.1,"AC","PSJ",$G(PSGSCH),"")),0)),"^",5) ;Handle "Fill on Request"
"RTN","PSGOE41",56,0)
 .Q
"RTN","PSGOE41",57,0)
 I $G(PSGTMPST)="O",+$G(PSGRF) S (PSGNEFD,PSGFD)="" D
"RTN","PSGOE41",58,0)
 . I +$G(PSGRF)=1 S MSG(1)="This NOW order has an Orderable Item for which a removal is required" D
"RTN","PSGOE41",59,0)
 .. S MSG(2)=" at the next administration."
"RTN","PSGOE41",60,0)
 .. S MSG(3)="The Stop DATE/TIME entered should be the next anticipated administration for the medication.",MSG(3,"F")="!"
"RTN","PSGOE41",61,0)
 ..Q
"RTN","PSGOE41",62,0)
 . I +$G(PSGRF)=2 S MSG(1)="This NOW order has an Orderable Item for which a removal period is optional",MSG(1,"F")="!!" D
"RTN","PSGOE41",63,0)
 .. S MSG(2)="prior to the next administration.",MSG(2,"F")="!"
"RTN","PSGOE41",64,0)
 .. S MSG(3)="If Early Removal is needed, enter Removal Time in Stop DATE/TIME field.",MSG(3,"F")="!"
"RTN","PSGOE41",65,0)
 .. S MSG(4)="If an Early Removal is not required, the Stop DATE/TIME entered"
"RTN","PSGOE41",66,0)
 .. S MSG(5)="should be the next anticipated administration for the medication.",MSG(5,"F")="!"
"RTN","PSGOE41",67,0)
 ..Q
"RTN","PSGOE41",68,0)
 . I +$G(PSGRF)=3 S MSG(1)="This NOW order has an Orderable Item that requires a removal period prior",MSG(1,"F")="!!" D
"RTN","PSGOE41",69,0)
 .. S MSG(2)=" to the next administration.",MSG(2,"F")="!"
"RTN","PSGOE41",70,0)
 .. S MSG(3)="Please Enter the Stop DATE/TIME to reflect the Removal Time for this medication.",MSG(3,"F")="!"
"RTN","PSGOE41",71,0)
 ..Q
"RTN","PSGOE41",72,0)
 . D EN^DDIOL(.MSG)
"RTN","PSGOE41",73,0)
 .Q
"RTN","PSGOE41",74,0)
A25 W !,"STOP DATE/TIME: "_$S(PSGFD]"":PSGFD_"// ",1:"") R X:DTIME I X="^"!'$T W:'$T $C(7) S PSGOROE1=1 G DONE
"RTN","PSGOE41",75,0)
 I X="",PSGNEFD W "   "_PSGFD S PSGFOK(25)=""  G W25
"RTN","PSGOE41",76,0)
 S PSGF2=25 I $E(X)="^" D FF G:Y>0 @Y G A25
"RTN","PSGOE41",77,0)
 I X="@"!(X?1."?") W:X="@" $C(7),"  (Required)" S:X="@" X="?" D ENHLP^PSGOEM(53.1,25)
"RTN","PSGOE41",78,0)
 I X=+X,(X>0),(X'>2000000) G A25:'$$ENDL^PSGDL(PSGSCH,X) K PSGDLS S PSGDL=X W " ...dose limit..." D EN1^PSGDL
"RTN","PSGOE41",79,0)
 K %DT S %DT="ERTX",%DT(0)=PSGNESD D ^%DT K %DT I Y'>0 W $C(7),!!?13,"*** WARNING! INVALID STOP DATE OR PRIOR TO START DATE! ***",! G A25
"RTN","PSGOE41",80,0)
 S PSGNEFD=+Y,PSGFD=$$ENDD^PSGMI(+Y),PSGFOK(25)=""
"RTN","PSGOE41",81,0)
W25 ;
"RTN","PSGOE41",82,0)
 N Z
"RTN","PSGOE41",83,0)
 D DOSE I $G(Z)]"",Z>PSGNEFD D  G A25
"RTN","PSGOE41",84,0)
 . W !,"There must be an admin time that falls between the Start Date/Time"
"RTN","PSGOE41",85,0)
 . W !,"and the Stop Date/Time."
"RTN","PSGOE41",86,0)
 I PSGNEFD<PSGDT W $C(7),!!?13,"*** WARNING! THE STOP DATE ENTERED IS IN THE PAST! ***",!
"RTN","PSGOE41",87,0)
 D EFDNEW^PSJUTL  ;Display Expected First Dose;BHW;PSJ*5*136
"RTN","PSGOE41",88,0)
 I $G(PSGDUR),'$G(PSGOROE1) D VERTIMES ;*315
"RTN","PSGOE41",89,0)
NEXT ;
"RTN","PSGOE41",90,0)
 S:'+$G(PSGRF) PSGRF=$P($G(^PS(50.7,$G(PSGPDRG),4),0),U,1)
"RTN","PSGOE41",91,0)
 G:'$D(PSGAARR) 1^PSGOE42
"RTN","PSGOE41",92,0)
 ;
"RTN","PSGOE41",93,0)
DONE ;
"RTN","PSGOE41",94,0)
 I PSGOROE1 K Y W $C(7),"  ...order not entered..."
"RTN","PSGOE41",95,0)
 K F,F0,F1,PSGF2,F3,PSG,SDT Q
"RTN","PSGOE41",96,0)
 ;
"RTN","PSGOE41",97,0)
FF ; up-arrow to another field
"RTN","PSGOE41",98,0)
 D ENFF^PSGOEM I Y>0,Y'=39,Y'=8,Y'=10,Y'=25 S Y=Y_"^PSGOE4"_$S("^109^13^3^7^26^"[("^"_Y_"^"):"",1:2) S:$P(Y,U)=2 FB=PSGF2_"^PSGOE41"
"RTN","PSGOE41",99,0)
 Q
"RTN","PSGOE41",100,0)
 ;
"RTN","PSGOE41",101,0)
DEL ; delete entry
"RTN","PSGOE41",102,0)
 W !?3,"SURE YOU WANT TO DELETE" S %=0 D YN^DICN I %'=1 W $C(7),"  <NOTHING DELETED>"
"RTN","PSGOE41",103,0)
 Q
"RTN","PSGOE41",104,0)
TIMES    ;At least one admin time, not more than interval allows.
"RTN","PSGOE41",105,0)
 I $G(PSGS0XT)'="O",X="" W !,"This order requires at least one administration time." K X Q  ;No times
"RTN","PSGOE41",106,0)
 N H,I,MAX
"RTN","PSGOE41",107,0)
 I PSGSCH]"" I $D(^PS(51.1,"AC","PSJ",PSGSCH)) S H=+$O(^PS(51.1,"AC","PSJ",PSGSCH,0)) S I=$P($G(^PS(51.1,H,0)),"^",3)
"RTN","PSGOE41",108,0)
 I $G(PSGST)="O",$L(X,"-")>1 W !,"This is a One Time Order - only one admin time is permitted." K X Q
"RTN","PSGOE41",109,0)
 I $G(PSGST)="O" Q  ;Done validating One Time
"RTN","PSGOE41",110,0)
 I +$G(I)=0 Q  ;No frequency - can not check frequency related items
"RTN","PSGOE41",111,0)
 S MAX=1440/I
"RTN","PSGOE41",112,0)
 I MAX<1 D  Q
"RTN","PSGOE41",113,0)
 . I $L(X,"-")'=1 W !,"This order requires one admin time." K X Q
"RTN","PSGOE41",114,0)
 I MAX'<1,$L(X,"-")>MAX W !,"The number of admin times entered is greater than indicated by the schedule." K X Q  ;Too many times
"RTN","PSGOE41",115,0)
 I MAX'<1,$L(X,"-")<MAX W !,"The number of admin times entered is fewer than indicated by the schedule."  ;Too few times
"RTN","PSGOE41",116,0)
 Q
"RTN","PSGOE41",117,0)
DOSE ;Make certain at least one dose is given.
"RTN","PSGOE41",118,0)
 Q:$G(PSGST)="OC"!($G(PSGST)="P")
"RTN","PSGOE41",119,0)
 N INFO,X
"RTN","PSGOE41",120,0)
 S Z="",INFO=($G(PSGNESD))_U_($G(PSGNEFD))_U_($G(PSGSCH))_U_($G(PSGST))_U_($G(PSGDRG))_U_($G(PSGS0Y))
"RTN","PSGOE41",121,0)
 I '$L($G(PSGP)) N PSGP S PSGP=""
"RTN","PSGOE41",122,0)
 S Z=$$ENQ^PSJORP2(PSGP,INFO)  ;Expected first dose.
"RTN","PSGOE41",123,0)
 Q
"RTN","PSGOE41",124,0)
 ;
"RTN","PSGOE41",125,0)
 ;*315 new tags
"RTN","PSGOE41",126,0)
PSGDUR ; Prompt for Removal times if admin times are on 24hr rotations and Site Params are enabled.
"RTN","PSGOE41",127,0)
 ; check parameter files for removal criteria quit if removal rotation not enabled (<2)
"RTN","PSGOE41",128,0)
 ; if enabled determine type (hard vers soft stop)
"RTN","PSGOE41",129,0)
 ;0 = no removal (current cap/tab functionality)
"RTN","PSGOE41",130,0)
 ;1 = removal at next admin (current patch functionality)
"RTN","PSGOE41",131,0)
 ;2 = removal prior to next admin; soft stop (pharmacist optional prompt to designate duration of administration
"RTN","PSGOE41",132,0)
 ;3 = removal prior to next admin; hard stop (pharmacist required prompt to designate duration of administration)
"RTN","PSGOE41",133,0)
 ; prompt for removal if = 2 then allow skip, if = 3 then force entry
"RTN","PSGOE41",134,0)
 ;
"RTN","PSGOE41",135,0)
 S PSGRF=$P($G(^PS(50.7,$G(PSGPDRG),4),0),U,1) Q:((PSGRF<2)!($G(PSGST)="O")!($G(PSGST)="P")!($G(PSGST)="OC"))  ; no removal flag or no removal rotation
"RTN","PSGOE41",136,0)
 Q:$G(PSGS0XT)>1440  ; Duration of Administration valid only for 24 hours - subject to change in future.
"RTN","PSGOE41",137,0)
 N RP,PSGIDF,WMSG,PSGDERR S (PSGIDF,PSGDERR)=0 S:$G(PSGDUR)>0 RP=PSGDUR/60 S:"BID,TID,QID"[$G(PSGSCH) PSGIDF=1 ; Use separate validation for Times Per Day type orders
"RTN","PSGOE41",138,0)
 S PSGF2=39
"RTN","PSGOE41",139,0)
 W !,"DURATION OF ADMINISTRATION (HRS): "_$S($G(RP):RP_"// ",1:"") R RP:DTIME I RP="^"!'$T W:'$T $C(7) S PSGOROE1=1,X="^" K PSGFOK(39) Q
"RTN","PSGOE41",140,0)
 I RP="",$G(PSGS0XT)="D" I $L(PSGSCH,"@")=2,$P(PSGSCH,"@",2) S (PSGAT,PSGRMV)=$P(PSGSCH,"@",2) G 8
"RTN","PSGOE41",141,0)
 I RP="@",PSGRF'=3 D DEL G:%'=1 PSGDUR S (PSGFOK(39),PSGS0Y,PSGDUR,PSGRMVT)="",PSGRMV=-1 S:+$G(^PS(53.1,+$G(PSGORD),2.1)) (PSGDUR,PSGRMVT)="@" Q
"RTN","PSGOE41",142,0)
 S:(RP'="")&(RP'="@")&(+(RP)<1)&(($E(RP,1))'="?")&(RP'?1N.2N) RP="?" I RP?1."?" D DURHLP^PSGOEM(RP,PSGRF) G PSGDUR
"RTN","PSGOE41",143,0)
 I $E(RP)="^" D FF G:Y>0 @Y G PSGDUR
"RTN","PSGOE41",144,0)
 I (+RP>0),'PSGIDF D  ; exclude TPD schedules
"RTN","PSGOE41",145,0)
 . S PSGDUR=(RP*60),PSGRMV=$G(PSGS0XT)-PSGDUR
"RTN","PSGOE41",146,0)
 . I PSGRMV<1 W !,"DURATION OF ADMINISTRATION MATCHES OR EXCEEDS ORDER FREQUENCY" S RP="",PSGDERR=1 K PSGDUR,PSGRMV G PSGDUR
"RTN","PSGOE41",147,0)
 .Q
"RTN","PSGOE41",148,0)
 Q:$G(PSGDERR)=1
"RTN","PSGOE41",149,0)
 I PSGRF=3,(+RP<1) W !,"ENTRY IS REQUIRED" S RP="" G PSGDUR
"RTN","PSGOE41",150,0)
 I PSGRF=2,(+RP<1) D
"RTN","PSGOE41",151,0)
 . W !,"You have not entered Duration of Administration for this medication order, "
"RTN","PSGOE41",152,0)
 . W !,"therefore the BCMA user will not be prompted to remove the medication prior "
"RTN","PSGOE41",153,0)
 . W !,"to the next Admin Time."
"RTN","PSGOE41",154,0)
 . S PSGRMV=-1,RP=0
"RTN","PSGOE41",155,0)
 .Q
"RTN","PSGOE41",156,0)
 I PSGIDF,(+RP>0) D  ;Only for TPD schedules
"RTN","PSGOE41",157,0)
 . N F,P,PSGARR
"RTN","PSGOE41",158,0)
 . S PSGADT=$S($G(PSGDUR)=-1:X,$G(PSGS0Y):PSGS0Y,$G(PSGAT):PSGAT,1:""),PSGAT=PSGADT
"RTN","PSGOE41",159,0)
 . S PSGARR=$L($G(PSGADT),"-")
"RTN","PSGOE41",160,0)
 . F P=1:1:PSGARR D
"RTN","PSGOE41",161,0)
 .. S PSGARR(P)=($P(PSGADT,"-",P)/100) S:(P>1) F(P)=PSGARR(P)-PSGARR(P-1)
"RTN","PSGOE41",162,0)
 .. I $G(F(P)),($G(F(P))'=RP) S WMSG=1_U_"Duration of Administration does not correspond to one or more",WMSG(1)="of this order's scheduled Administration Times!"
"RTN","PSGOE41",163,0)
 ..Q
"RTN","PSGOE41",164,0)
 .Q
"RTN","PSGOE41",165,0)
 S:(+RP>0) PSGDUR=(RP*60)
"RTN","PSGOE41",166,0)
 W:(+RP>0) ?60,RP," HOURS"
"RTN","PSGOE41",167,0)
 D:$G(WMSG) EN^DDIOL($P(WMSG,U,2)),EN^DDIOL(WMSG(1))
"RTN","PSGOE41",168,0)
 Q:'$G(PSGOE3)!'+$G(PSGDUR)
"RTN","PSGOE41",169,0)
 ;
"RTN","PSGOE41",170,0)
VERTIMES ; Redisplay Admin and Removal times
"RTN","PSGOE41",171,0)
 S PSGRF=$P($G(^PS(50.7,$G(PSGPDRG),4),0),U,1) Q:(PSGRF<2)!($G(PSGST)="O")
"RTN","PSGOE41",172,0)
 N PSGADT,PSGRARR,PSGAARR
"RTN","PSGOE41",173,0)
 ;If we have a frequency and this is odd type order then we need to start calculations with order start time.
"RTN","PSGOE41",174,0)
 I $G(PSGS0XT),$G(PSGNESD),+$G(PSGDUR),$G(PSGAT)="",$G(PSGS0Y)="" D  Q
"RTN","PSGOE41",175,0)
 . N L
"RTN","PSGOE41",176,0)
 . S (PSGAARR,PSGRARR)=1,PSGADT=$P($P(PSGNESD,U,1),".",2),L=$L(PSGADT)
"RTN","PSGOE41",177,0)
 . S PSGRARR(1)=(((((PSGADT*60)+PSGDUR)/60)#24)*100) S:PSGRARR(1)=0 PSGRARR(1)=2400 S:$L(PSGRARR(1))=3 PSGRARR(1)="0"_PSGRARR(1)
"RTN","PSGOE41",178,0)
 . S PSGRARR(1)=$E(PSGRARR(1),1,L)_"(R)"
"RTN","PSGOE41",179,0)
 . S PSGAARR(1)=PSGADT,PSGAARR(1)=$E(PSGAARR(1),1,L)_"(A)"
"RTN","PSGOE41",180,0)
 . D WRITE
"RTN","PSGOE41",181,0)
 .Q
"RTN","PSGOE41",182,0)
 ;
"RTN","PSGOE41",183,0)
 S (PSGRARR,PSGAARR)=$S($G(PSGAT):$L(PSGAT,"-"),1:$L(PSGS0Y,"-"))
"RTN","PSGOE41",184,0)
 N P,L
"RTN","PSGOE41",185,0)
 F P=1:1:PSGRARR D
"RTN","PSGOE41",186,0)
 . S PSGADT=$S($G(PSGAT):$P(PSGAT,"-",P),1:$P(PSGS0Y,"-",P)),L=$L(PSGADT)
"RTN","PSGOE41",187,0)
 . S PSGADT=$S($L(PSGADT)=4:PSGADT/100,1:PSGADT*1)
"RTN","PSGOE41",188,0)
 . S PSGRARR(P)=(((((PSGADT*60)+PSGDUR)/60)#24)*100) S:PSGRARR(P)=0 PSGRARR(P)=2400 S:$L(PSGRARR(P))=3 PSGRARR(P)="0"_PSGRARR(P)
"RTN","PSGOE41",189,0)
 . S PSGRARR(P)=$E(PSGRARR(P),1,L)_"(R)"
"RTN","PSGOE41",190,0)
 . S PSGAARR(P)=(PSGADT*100) S:$L(PSGAARR(P))=3 PSGAARR(P)="0"_PSGAARR(P)
"RTN","PSGOE41",191,0)
 . S PSGAARR(P)=$E(PSGAARR(P),1,L)_"(A)"
"RTN","PSGOE41",192,0)
 .Q
"RTN","PSGOE41",193,0)
 D WRITE
"RTN","PSGOE41",194,0)
 Q
"RTN","PSGOE41",195,0)
 ;
"RTN","PSGOE41",196,0)
WRITE ;
"RTN","PSGOE41",197,0)
 W !!,"Verify Admin and removal times",!
"RTN","PSGOE41",198,0)
 W !,"(A)DMINISTRATION -(R)EMOVAL TIMES"
"RTN","PSGOE41",199,0)
 W !,"___________________________________________________________________________",!
"RTN","PSGOE41",200,0)
 F P=1:1:PSGAARR W PSGAARR(P)_"-"_PSGRARR(P)  W:P'=PSGAARR " , "
"RTN","PSGOE41",201,0)
 D ASK
"RTN","PSGOE41",202,0)
 Q
"RTN","PSGOE41",203,0)
 ;
"RTN","PSGOE41",204,0)
ASK ;
"RTN","PSGOE41",205,0)
 N Y
"RTN","PSGOE41",206,0)
 S DIR("A")="Is this correct",DIR(0)="Y" D ^DIR I $D(DUOUT)!$D(DTOUT) W:'$T $C(7) S PSGOEE=0 K PSGDUR G DONE
"RTN","PSGOE41",207,0)
 I 'Y K X S PSGDUR=-1 G 39
"RTN","PSGOE41",208,0)
 N P S P=1,PSGRMVT=$P(PSGRARR(P),"(",1)
"RTN","PSGOE41",209,0)
 F  S P=$O(PSGRARR(P)) Q:P=""  D
"RTN","PSGOE41",210,0)
 . S PSGRMVT=PSGRMVT_"-"_$P(PSGRARR(P),"(",1)
"RTN","PSGOE41",211,0)
 .Q
"RTN","PSGOE41",212,0)
 Q
"RTN","PSGOE41",213,0)
 ;
"RTN","PSGOE8")
0^2^B52703048^B48942874
"RTN","PSGOE8",1,0)
PSGOE8 ;BIR/CML3-EDIT ORDERS IN 53.1 ; 7/6/11 9:44am
"RTN","PSGOE8",2,0)
 ;;5.0;INPATIENT MEDICATIONS ;**47,50,65,72,110,111,188,192,113,223,269,287,315**;16 DEC 97;Build 73
"RTN","PSGOE8",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PSGOE8",4,0)
 ; Reference to ^PS(50.7 is supported by DBIA# 2180
"RTN","PSGOE8",5,0)
 ; Reference to ^PS(51.1 is supported by DBIA 2177
"RTN","PSGOE8",6,0)
 ; Reference to ^PS(51.2 is supported by DBIA# 2178
"RTN","PSGOE8",7,0)
 ; Reference to ^PSDRUG is supported by DBIA# 2192
"RTN","PSGOE8",8,0)
 ;
"RTN","PSGOE8",9,0)
101 ;Orderable Item
"RTN","PSGOE8",10,0)
 S MSG=0,F2=101,PSGOOPD=PSGPD,PSGOOPDN=PSGPDN S:PSGOEEF(F2) BACK="101^PSGOE8"
"RTN","PSGOE8",11,0)
 S %=1 I $P(PSJSYSU,";",3)>1 W !!,$C(7),"WARNING!  If you change the drug of an order, the Dosage Ordered and Dispense",!,"Drug(s) are deleted." F  W !,"Do you wish to continue" S %=2 D YN^DICN Q:%
"RTN","PSGOE8",12,0)
 I %'=1 G DONE
"RTN","PSGOE8",13,0)
A101 ;
"RTN","PSGOE8",14,0)
 I $$PNDREN($G(PSGORD)) D  Q
"RTN","PSGOE8",15,0)
 . W !!?5,"Orderable Item may not be edited at this point." D PAUSE^VALM1
"RTN","PSGOE8",16,0)
 W !,"ORDERABLE ITEM: ",$S(PSGPD:PSGPDN_"// ",1:"") R X:DTIME I X="^"!'$T W:'$T $C(7) S PSGOEE=0 G DONE
"RTN","PSGOE8",17,0)
 I X="",PSGPD S X=PSGPDN I PSGPD'=PSGPDN,$D(^PS(50.7,PSGPD,0)) G DONE
"RTN","PSGOE8",18,0)
 I $S(X="@":1,X]"":0,1:'PSGPD) W $C(7),"  (Required)" S X="?" D ENHLP^PSGOEM(53.1,101) G A101
"RTN","PSGOE8",19,0)
 I X?1."?" D ENHLP^PSGOEM(53.1,101)
"RTN","PSGOE8",20,0)
 I $E(X)="^" D ENFF^PSGOE82 G:Y>0 @Y G A101
"RTN","PSGOE8",21,0)
 ;BHW;PSJ*5.0*192;Modify ^DIC call to use MIX^DIC and only B/C cross-references
"RTN","PSGOE8",22,0)
 K DIC,D S DIC="^PS(50.7,",DIC(0)="EMQZ",DIC("S")="I $$ENOISC^PSJUTL(Y,""U"")",D="B^C" D MIX^DIC1 K DIC,D I Y'>0 G A101
"RTN","PSGOE8",23,0)
 F  S %=2 D DH,YN^DICN Q:%
"RTN","PSGOE8",24,0)
 I %'=1 G A101
"RTN","PSGOE8",25,0)
 S (PSGPDRG,PSGPD)=+Y,(PSGPDN,PSGPDRGN)=$$OINAME^PSJLMUTL(PSGPDRG)
"RTN","PSGOE8",26,0)
 S PSGNEDFD=$$GTNEDFD^PSGOE7("U",PSGPDRG)
"RTN","PSGOE8",27,0)
 S PSGPDNX=1,PSGDO="",(PSGPDRG,PSGPD)=+Y,(PSGPDN,PSGPDRGN)=$$OINAME^PSJLMUTL(PSGPDRG) K ^PS(53.45,PSJSYSP,2) S X=$O(^PSDRUG("ASP",PSGPD,0)) I X,'$O(^(X)) D
"RTN","PSGOE8",28,0)
 .S ^PS(53.45,PSJSYSP,2,0)="^53.4502P^1^1",^(1,0)=X,^PS(53.45,PSJSYSP,2,"B",X,1)=""
"RTN","PSGOE8",29,0)
 D ENDRG^PSGOEF1(PSGPD,0)
"RTN","PSGOE8",30,0)
 G DONE
"RTN","PSGOE8",31,0)
 ;
"RTN","PSGOE8",32,0)
109 ; dosage ordered
"RTN","PSGOE8",33,0)
 S MSG=0,F2=109 S:PSGOEEF(F2) BACK="109^PSGOE8"
"RTN","PSGOE8",34,0)
A109 ;
"RTN","PSGOE8",35,0)
 I $$PNDREN($G(PSGORD)) D  Q
"RTN","PSGOE8",36,0)
 . W !!?5,"Dosage may not be edited at this point." D PAUSE^VALM1
"RTN","PSGOE8",37,0)
 S PSGOEEF(F2)=PSGOEE
"RTN","PSGOE8",38,0)
 D EDITDOSE^PSJDOSE S X=PSGDO G DONE
"RTN","PSGOE8",39,0)
 W !,"DOSAGE ORDERED: ",$S(PSGDO]"":PSGDO_"// ",1:"") R X:DTIME I X="^"!'$T W:'$T $C(7) S PSGOEE=0 G DONE
"RTN","PSGOE8",40,0)
 I X=""&(PSGDO]"") S X=PSGDO
"RTN","PSGOE8",41,0)
 I $$CHECK(PSJSYSP)&(X="")&(PSGDO']"") W $C(7),"    (Required) " G A109
"RTN","PSGOE8",42,0)
 I $$CHECK(PSJSYSP)&(X="@") W $C(7),"      (Required) " G A109
"RTN","PSGOE8",43,0)
 I '$$CHECK(PSJSYSP)&(X="@") S PSGDO="" G DONE
"RTN","PSGOE8",44,0)
 I X?1."?" D ENHLP^PSGOEM(53.1,109) G A109
"RTN","PSGOE8",45,0)
 I $E(X)="^" D ENFF^PSGOE82 G:Y>0 @Y G A109
"RTN","PSGOE8",46,0)
 I $E(X,$L(X))=" " F  S X=$E(X,1,$L(X)-1) Q:$E(X,$L(X))'=" "
"RTN","PSGOE8",47,0)
 I $S(X?.E1C.E:1,$L(X)>20:1,X="":0,X["^":1,X?1.P:1,1:X=+X) W $C(7),"  ",$S(X?1.P!(X=""):"(Required)",1:"??") D ENHLP^PSGOEM(53.1,109) G A109
"RTN","PSGOE8",48,0)
 S PSGDO=X G DONE
"RTN","PSGOE8",49,0)
 ;
"RTN","PSGOE8",50,0)
3 ; med route
"RTN","PSGOE8",51,0)
 S MSG=0,F2=3 S:PSGOEEF(F2) BACK="3^PSGOE8"
"RTN","PSGOE8",52,0)
A3 I $$PNDREN($G(PSGORD)) D  Q
"RTN","PSGOE8",53,0)
 . W !!?5,"Med Route may not be edited at this point." D PAUSE^VALM1
"RTN","PSGOE8",54,0)
 W !,"MED ROUTE: ",$S(PSGMR:PSGMRN_"// ",1:"") R X:DTIME I X="^"!'$T W:'$T $C(7) S PSGOEE=0 G DONE
"RTN","PSGOE8",55,0)
 I X="",PSGMR S X=PSGMRN I PSGMR'=PSGMRN,$D(^PS(51.2,PSGMR,0)) W "  "_$P(^(0),"^",3) G DONE
"RTN","PSGOE8",56,0)
 I $S(X="@":1,X]"":0,1:'PSGMR) W $C(7),"  (Required)" S X="?" D ENHLP^PSGOEM(53.1,3) G A3
"RTN","PSGOE8",57,0)
 I X?1."?" D ENHLP^PSGOEM(53.1,3)
"RTN","PSGOE8",58,0)
 I $E(X)="^" D ENFF^PSGOE82 G:Y>0 @Y G A3
"RTN","PSGOE8",59,0)
 K DIC S DIC="^PS(51.2,",DIC(0)="EMQZ",DIC("S")="I $P(^(0),""^"",4)" D ^DIC K DIC I Y'>0 G A3
"RTN","PSGOE8",60,0)
 S PSGMR=+Y,PSGMRN=Y(0,0) G DONE
"RTN","PSGOE8",61,0)
 ;
"RTN","PSGOE8",62,0)
26 ; schedule
"RTN","PSGOE8",63,0)
 S MSG=0,F2=26 S:PSGOEEF(F2) BACK="26^PSGOE8"
"RTN","PSGOE8",64,0)
A26 I $$PNDREN($G(PSGORD)) D  Q
"RTN","PSGOE8",65,0)
 . W !!?5,"Schedule may not be edited at this point." D PAUSE^VALM1
"RTN","PSGOE8",66,0)
 W !,"SCHEDULE: ",$S(PSGSCH]"":PSGSCH_"// ",1:"") R X:DTIME I X="^"!'$T W:'$T $C(7) S PSGOEE=0 G DONE
"RTN","PSGOE8",67,0)
 S:X="" X=PSGSCH,PSGSCH="" I "@"[X W $C(7),"  (Required)" S X="?" D ENHLP^PSGOEM(53.1,26) G A26
"RTN","PSGOE8",68,0)
 S DOW=0 I $$DOW^PSIVUTL($$ENLU^PSGMI(X)) S DOW=1
"RTN","PSGOE8",69,0)
 I X?1."?" D ENHLP^PSGOEM(53.1,26) G A26
"RTN","PSGOE8",70,0)
 I $E(X)="^" D ENFF^PSGOE82 G:Y>0 @Y G A26
"RTN","PSGOE8",71,0)
 ;BHW;PSJ*5*188;Add flag and IEN return variable for PSGS0 (PSJ*5*134), Highlight Admin Times if they changed.
"RTN","PSGOE8",72,0)
 N PSGOES,PSJSLUP,PSGSFLG S PSJSLUP=1,PSGSFLG=1 D EN^PSGS0 I '$D(X) W $C(7),"  ??" S X="?" D ENHLP^PSGOEM(53.1,26) G A26
"RTN","PSGOE8",73,0)
 I X'=PSGSCH D
"RTN","PSGOE8",74,0)
 . K PSGDUR,PSGRMVT,PSGRMV,ND2P1 ;*315 Removal times are tied to ADMIN times.
"RTN","PSGOE8",75,0)
 . N XX
"RTN","PSGOE8",76,0)
 . S PSGSCH=X
"RTN","PSGOE8",77,0)
 . I PSGS0Y'=PSGAT S PSGAT=PSGS0Y  ;Change so that any schedule change will adjust the type and default the admin times - DRF
"RTN","PSGOE8",78,0)
 . D  ;Change schedule type to agree with schedule
"RTN","PSGOE8",79,0)
 .. I $G(DOW) S PSGST="C",PSGSTN=$$ENSTN^PSGMI(PSGST) Q
"RTN","PSGOE8",80,0)
 .. I (PSGSCH[" PRN")!(PSGSCH="PRN") I $$PRNOK^PSGS0(PSGSCH) S PSGOST=PSGST,PSGST="P",PSGSTN=$$ENSTN^PSGMI(PSGST) Q
"RTN","PSGOE8",81,0)
 .. I '$G(PSGSCIEN),PSGSCH]"" S XX=+$O(^PS(51.1,"AC","PSJ",PSGSCH,0)),PSGSCIEN=XX
"RTN","PSGOE8",82,0)
 .. S PSGOST=$G(PSGST),PSGST=$P($G(^PS(51.1,PSGSCIEN,0)),"^",5) I PSGST="D" S PSGST="C"  ;DOW schedules are converted to Continuous
"RTN","PSGOE8",83,0)
 .. S PSGSTN=$$ENSTN^PSGMI(PSGST)
"RTN","PSGOE8",84,0)
 . I $G(PSJSYSW0),($P(PSJSYSW0,U,5)'=2),'$G(PSGEFN(8)) W !!,"NOTE: This may cause the Admin Times and the Start Time to be out of sync."
"RTN","PSGOE8",85,0)
 . W !!,"NOTE: This change in schedule also changes the ADMIN TIMES and SCHEDULE TYPE.",!
"RTN","PSGOE8",86,0)
 . S MSG=1 S:'$G(PSGOEEF(39)) PSGOEEF(39)=1 ;*287 - Prevent infinite loop editing admin times
"RTN","PSGOE8",87,0)
 . I ($G(PSGRF)>1),PSGST="C" D
"RTN","PSGOE8",88,0)
 ..S PSGF2=39,BACK="39^PSGOE81" D 39^PSGOE81 S BACK="26^PSGOE8",PSGF2=26,PSGOAT=PSGAT ;*315 Prompt for Admin to get DOA
"RTN","PSGOE8",89,0)
 ..Q
"RTN","PSGOE8",90,0)
 . I $G(PSJNEWOE) D PAUSE^VALM1
"RTN","PSGOE8",91,0)
 I PSGST="O" S PSGOEEF(7)=1 I +$G(PSGRF) S PSGOEEF(25)=1 D 25^PSGOE81 S PSGF2=26
"RTN","PSGOE8",92,0)
 G DONE
"RTN","PSGOE8",93,0)
 ;
"RTN","PSGOE8",94,0)
7 ; schedule type
"RTN","PSGOE8",95,0)
 S MSG=0,F2=7 S:PSGOEEF(F2) BACK="7^PSGOE8"
"RTN","PSGOE8",96,0)
A7 W !,"SCHEDULE TYPE: "_$S(PSGSTN]"":PSGSTN_"// ",1:"") R X:DTIME S X=$TR(X,"coprocf","COPROCF") I X="^"!'$T S PSGOEE=0 W $C(7) G DONE
"RTN","PSGOE8",97,0)
 I X="" S X=PSGST,PSGSTN=$$ENSTN^PSGMI(X) W:PSGSTN]"" "  ",PSGSTN G DONE
"RTN","PSGOE8",98,0)
 S:X="F" X="R"
"RTN","PSGOE8",99,0)
 I ",?,??,C,O,OC,P,R,"'[(","_X_",") W " ??" G A7
"RTN","PSGOE8",100,0)
 I $$PRNOK^PSGS0($G(PSGSCH)),X="C" W "  ??" G A7
"RTN","PSGOE8",101,0)
 I X="@"!(X?1."?") W:X="@" $C(7),"  (Required)" S:X="@" X="?" D ENHLP^PSGOEM(53.1,7) G A7
"RTN","PSGOE8",102,0)
 I $E(X)="^" D ENFF^PSGOE82 G:Y>0 @Y G A7
"RTN","PSGOE8",103,0)
 ;*223 Don't allow O sched type on C orders
"RTN","PSGOE8",104,0)
 I X="O",$$SCHTP(PSGSCH)'="O" W !,"  SCHEDULE ("_PSGSCH_") is not a ONE TIME Schedule." G A7
"RTN","PSGOE8",105,0)
 ;*269 Don't allow C sched type on O orders
"RTN","PSGOE8",106,0)
 I X="C",$$SCHTP(PSGSCH)="O" W !,"  SCHEDULE ("_PSGSCH_") is not a CONTINUOUS Schedule." G A7
"RTN","PSGOE8",107,0)
 S PSGOST=PSGST
"RTN","PSGOE8",108,0)
 S PSGST=X,PSGSTN=$$ENSTN^PSGMI(X) W:PSGSTN]"" "  ",PSGSTN
"RTN","PSGOE8",109,0)
 I X="P",$G(PSGAT)]"" S PSGOAT=PSGAT S PSGAT="" D
"RTN","PSGOE8",110,0)
 .W !!,"NOTE: This change in schedule type also changes the ADMIN TIMES.",!
"RTN","PSGOE8",111,0)
 .S MSG=1,PSGOEEF(39)=1
"RTN","PSGOE8",112,0)
 .I $G(PSJNEWOE) D PAUSE^VALM1
"RTN","PSGOE8",113,0)
 ;
"RTN","PSGOE8",114,0)
DONE ;
"RTN","PSGOE8",115,0)
 I PSGOEE G:'PSGOEEF(F2) @BACK S PSGOEE=PSGOEEF(F2)
"RTN","PSGOE8",116,0)
 K F,F0,F2 Q
"RTN","PSGOE8",117,0)
 ;
"RTN","PSGOE8",118,0)
DEL ; delete entry
"RTN","PSGOE8",119,0)
 W !?3,"SURE YOU WANT TO DELETE" S %=0 D YN^DICN I %'=1 W $C(7),"  <NOTHING DELETED>"
"RTN","PSGOE8",120,0)
 Q
"RTN","PSGOE8",121,0)
 ;
"RTN","PSGOE8",122,0)
DH ;
"RTN","PSGOE8",123,0)
 W !!?2,"When the drug of an order is changed, the Dosage Ordered and Dispense Drug(s)",!,"for the order are no longer valid, and therefore deleted from the order.",!,"If possible, a new corresponding dispense drug will be added to the order."
"RTN","PSGOE8",124,0)
 W !!?2,"Answer 'YES' to continue with this change.  Answer 'NO' to select another",!,"drug or to accept the drug as it was.  Enter an '^' the exit this edit." Q
"RTN","PSGOE8",125,0)
 ;
"RTN","PSGOE8",126,0)
CHECK(PSJSYSP) ; Check to see if multiple dispense drugs
"RTN","PSGOE8",127,0)
 ; Input  -     PSJSYSP
"RTN","PSGOE8",128,0)
 ; Returns  0 = only one.
"RTN","PSGOE8",129,0)
 ;          1 = more than one
"RTN","PSGOE8",130,0)
 ; Checks Inactive Date and doesn't count if < or = today.
"RTN","PSGOE8",131,0)
 N PSJRSB,PSJINACT,PSJRBCNT S PSJRBCNT=0
"RTN","PSGOE8",132,0)
 F PSJRSB=0:0 S PSJRSB=$O(^PS(53.45,PSJSYSP,2,PSJRSB)) Q:'PSJRSB  D
"RTN","PSGOE8",133,0)
 .S PSJINACT=$P(^PS(53.45,PSJSYSP,2,PSJRSB,0),"^",3)
"RTN","PSGOE8",134,0)
 .I (PSJINACT="")!((PSJINACT>0)&(PSJINACT>DT)) D
"RTN","PSGOE8",135,0)
 ..S PSJRBCNT=$S('$D(PSJRBCNT):1,1:PSJRBCNT+1)
"RTN","PSGOE8",136,0)
 Q $S(PSJRBCNT>1:1,1:0)
"RTN","PSGOE8",137,0)
 ;
"RTN","PSGOE8",138,0)
PNDREN(PNDON) ;
"RTN","PSGOE8",139,0)
 I PNDON'["P" Q 0
"RTN","PSGOE8",140,0)
 S RNWL="^PS(53.1,"_+PNDON_",0)" S RNWL=$G(@(RNWL)) S RNWL=$S($P(RNWL,"^",24)="R":1,1:0)
"RTN","PSGOE8",141,0)
 Q RNWL
"RTN","PSGOE8",142,0)
 ;
"RTN","PSGOE8",143,0)
SCHTP(SCH) ; *223 Return SCHedule type
"RTN","PSGOE8",144,0)
 N X I SCH="" Q ""
"RTN","PSGOE8",145,0)
 S X=$O(^PS(51.1,"APPSJ",SCH,0))
"RTN","PSGOE8",146,0)
 Q:'$G(X) ""
"RTN","PSGOE8",147,0)
 Q $P(^PS(51.1,X,0),"^",5)
"RTN","PSGOE8",148,0)
 ;
"RTN","PSGOE81")
0^50^B107835999^B32608596
"RTN","PSGOE81",1,0)
PSGOE81 ;BIR/CML3-NON-VERIFIED ORDER EDIT (CONT.) ; 7/20/12 12:43am
"RTN","PSGOE81",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**26,50,64,58,82,110,111,136,113,267,315**;16 DEC 97;Build 73
"RTN","PSGOE81",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PSGOE81",4,0)
 ; Reference to ^PS(50.7 is supported by DBIA# 2180
"RTN","PSGOE81",5,0)
 ; Reference to ^PS(51.1 is supported by DBIA 2177.
"RTN","PSGOE81",6,0)
 ;
"RTN","PSGOE81",7,0)
39 ; admin times
"RTN","PSGOE81",8,0)
 N PSGDOA
"RTN","PSGOE81",9,0)
 S MSG=0,PSGF2=39 S:PSGOEEF(PSGF2) BACK="39^PSGOE81",ORIG=$G(PSGAT),PSGDOA=$G(PSGDUR)
"RTN","PSGOE81",10,0)
A39 ;*315 next 2 lines
"RTN","PSGOE81",11,0)
 I (PSGST="P")!$$PRNOK^PSGS0($G(PSGSCH)) G DONE
"RTN","PSGOE81",12,0)
 I $$ODD^PSGS0(PSGS0XT) D PSGDUR G DONE
"RTN","PSGOE81",13,0)
 W !,"ADMIN TIMES: "_$S(PSGAT:PSGAT_"// ",1:"") R X:DTIME I X="^"!('$T) W:'$T $C(7) S PSGOEE=0 S:X="^" (X,PSGAT)=$G(ORIG),PSGDUR="" G DONE ;*315
"RTN","PSGOE81",14,0)
 I X="" S:(($G(PSGS0XT)="D")&'$G(PSGS0Y)) PSGOEE=0 S:$G(PSGAT) X=PSGAT,PSGNOHI=1 ;*315 If admin time default was taken then don't highlight admin time.
"RTN","PSGOE81",15,0)
 I $E(X)="^" D ENFF^PSGOE82 G:Y>0 @Y G A39
"RTN","PSGOE81",16,0)
 I X=" "!(X?1."?") D ENHLP^PSGOEM(53.1,39) G A39
"RTN","PSGOE81",17,0)
 I PSGS0XT="D"&'$G(X) I ((",P,R,")'[(","_$G(PSGST)_",")) D  G A39
"RTN","PSGOE81",18,0)
 .W $C(7),"  ??" S X="?" W !,"This is a 'DAY OF THE WEEK' schedule and MUST have admin times." D ENHLP^PSGOEM(53.1,39)
"RTN","PSGOE81",19,0)
 I X="@" D DEL G:%'=1 A39 S PSGAT="",X=""
"RTN","PSGOE81",20,0)
 I $G(PSGS0XT),'$$ODD^PSGS0(PSGS0XT),$G(PSGS0XT)'="P",$G(PSGS0XT)'="OC",'$$PRNOK^PSGS0(PSGSCH),($G(PSGST)'="O") D TIMES G:'$D(X) A39 D PSGDUR G:'$D(X) A39 G:$G(X)="^" DONE ;*315
"RTN","PSGOE81",21,0)
 I (($G(PSGST)="O")!($G(PSGST)="OC")),X="" D  G DONE
"RTN","PSGOE81",22,0)
 . S (PSGS0Y,PSGAT)=X
"RTN","PSGOE81",23,0)
 . I (($G(PSGRF))&($G(PSGST)="O")) N PSGRO S (PSGRO,PSGOEEF(25))=1,PSGOEEF(39)=1 D 25
"RTN","PSGOE81",24,0)
 .Q
"RTN","PSGOE81",25,0)
 D ENCHK^PSGS0 I '$D(X) W $C(7) G A39
"RTN","PSGOE81",26,0)
 S PSGOAT=PSGAT
"RTN","PSGOE81",27,0)
 S (PSGS0Y,PSGAT)=X G DONE
"RTN","PSGOE81",28,0)
 ;
"RTN","PSGOE81",29,0)
8 ; special instructions
"RTN","PSGOE81",30,0)
 S MSG=0,PSGF2=8 S:PSGOEEF(PSGF2) BACK="8^PSGOE81"
"RTN","PSGOE81",31,0)
A8 ; special instructions
"RTN","PSGOE81",32,0)
 S PSGSI=$$EDITSI^PSJBCMA5($G(PSGP),$G(PSGORD)) I $G(PSGP),$G(PSGORD) I '$$DIFFSI^PSJBCMA5(PSGP,PSGORD) S PSGOEE=0 G DONE
"RTN","PSGOE81",33,0)
 S PSGSI=$S((PSGSI>0&(PSGSI<4)):$G(^PS(53.45,+PSJSYSP,5,1,0))_" "_$G(^PS(53.45,+PSJSYSP,5,2,0)),PSGSI>3:"Instructions too long. See Order View or BCMA for full text",1:"")
"RTN","PSGOE81",34,0)
 S:PSGSI=" " PSGSI="" I PSGSI]"" S PSGSI=$$ENBCMA^PSJUTL("U") G DONE
"RTN","PSGOE81",35,0)
 Q
"RTN","PSGOE81",36,0)
 ;
"RTN","PSGOE81",37,0)
10 ; start date/time
"RTN","PSGOE81",38,0)
 S MSG=0,PSGF2=10 S:PSGOEEF(PSGF2) BACK="10^PSGOE81"
"RTN","PSGOE81",39,0)
A10 ; start date/time
"RTN","PSGOE81",40,0)
 K PSGSDX N DUR,DURMIN,TMPFD
"RTN","PSGOE81",41,0)
 I $G(PSGORD)["P",$G(PSGP) I $$LASTREN^PSJLMPRI(PSGP,PSGORD) D  Q
"RTN","PSGOE81",42,0)
 . W !?5,"Start Date may not be edited at this point. " D PAUSE^VALM1
"RTN","PSGOE81",43,0)
 W !,"START DATE/TIME: "_$S($P(PSGSDN,"^")]"":$P(PSGSDN,"^")_"// ",1:"") R X:DTIME I X="^"!'$T W:'$T $C(7) S PSGOEE=0 G DONE
"RTN","PSGOE81",44,0)
 I X="",PSGSD W "  "_$P(PSGSDN,"^") G DONE
"RTN","PSGOE81",45,0)
 I X="P" D ENPREV^PSGDL W:'$D(X) $C(7) G:'$D(X) A10 S PSGSD=+X,PSGSDN=$$ENDD^PSGMI(PSGSD)_"^"_$$ENDTC^PSGMI(PSGSD) W "  ",$P(PSGSDN,"^") G DONE
"RTN","PSGOE81",46,0)
 I X="@"!(X?1."?") W:X="@" $C(7),"  (Required)" S:X="@" X="?" D ENHLP^PSGOEM(53.1,10)
"RTN","PSGOE81",47,0)
 I $E(X)="^" D ENFF^PSGOE82 G:Y>0 @Y G A10
"RTN","PSGOE81",48,0)
 NEW TMPX S TMPX=X,X1=+$G(PSGLI),X2=-7 D C^%DTC K %DT S %DT="ERTX",%DT(0)=X,X=TMPX D ^%DT K %DT I Y'>0 D ENHLP^PSGOEM(53.1,10) G A10
"RTN","PSGOE81",49,0)
 I PSGFD<Y W $C(7),!?5,"*** THE START DATE CANNOT BE AFTER THE STOP DATE! ***",! S MSG=1 G A10
"RTN","PSGOE81",50,0)
 S (PSGSDX,PSGSD,PSGNESD)=+Y,PSGSDN=$$ENDD^PSGMI(PSGSD)_"^"_$$ENDTC^PSGMI(PSGSD)
"RTN","PSGOE81",51,0)
 I $G(PSGORD)["P",$G(PSGP) S DUR=$$GETDUR^PSJLIVMD(PSGP,+PSGORD,"P",1) I DUR]"" S DURMIN=$$DURMIN^PSJLIVMD(DUR) I DURMIN D
"RTN","PSGOE81",52,0)
 . S TMPFD=$$FMADD^XLFDT(PSGSD,,,DURMIN) K:(TMPFD<PSGSD) TMPFD I $G(TMPFD) S PSGFD=TMPFD,PSGFDN=$$ENDD^PSGMI(PSGFD)_"^"_$$ENDTC^PSGMI(PSGFD)
"RTN","PSGOE81",53,0)
 G DONE
"RTN","PSGOE81",54,0)
 ;
"RTN","PSGOE81",55,0)
25 ; stop date
"RTN","PSGOE81",56,0)
 S MSG=0,PSGF2=25 S:PSGOEEF(PSGF2) BACK="25^PSGOE81"
"RTN","PSGOE81",57,0)
A25 ;
"RTN","PSGOE81",58,0)
 N MSG,PSGTMPST S PSGTMPST=$G(PSGST) S:'+$G(PSGRF) PSGRF=$P($G(^PS(50.7,$G(PSGPDRG),4),0),U,1) ;*315 One time orders for MRR's require message to instruct pharmacists
"RTN","PSGOE81",59,0)
 I +$G(PSGRF),$D(^PS(51.1,"AC","PSJ",$G(PSGSCH))) D
"RTN","PSGOE81",60,0)
 . S:PSGTMPST=($G(PSGST)="R") PSGST=$P($G(^PS(51.1,$O(^PS(51.1,"AC","PSJ",$G(PSGSCH),"")),0)),"^",5) ;Handle "Fill on Request"
"RTN","PSGOE81",61,0)
 .Q
"RTN","PSGOE81",62,0)
 I $G(PSGTMPST)="O",+$G(PSGRF) S (PSGFDN,PSGFD)="" D 
"RTN","PSGOE81",63,0)
 . I +$G(PSGRF)=1 S MSG(1)="This NOW order has an Orderable Item for which a removal is required" D
"RTN","PSGOE81",64,0)
 .. S MSG(2)=" at the next administration."
"RTN","PSGOE81",65,0)
 .. S MSG(3)="The Stop DATE/TIME entered should be the next anticipated administration for the medication.",MSG(3,"F")="!"
"RTN","PSGOE81",66,0)
 ..Q
"RTN","PSGOE81",67,0)
 . I +$G(PSGRF)=2 S MSG(1)="This NOW order has an Orderable Item for which a removal period is optional",MSG(1,"F")="!!" D
"RTN","PSGOE81",68,0)
 .. S MSG(2)="prior to the next administration.",MSG(2,"F")="!"
"RTN","PSGOE81",69,0)
 .. S MSG(3)="If Early Removal is needed, enter Removal Time in Stop DATE/TIME field.",MSG(3,"F")="!"
"RTN","PSGOE81",70,0)
 .. S MSG(4)="If an Early Removal is not required, the Stop DATE/TIME entered"
"RTN","PSGOE81",71,0)
 .. S MSG(5)="should be the next anticipated administration for the medication.",MSG(5,"F")="!"
"RTN","PSGOE81",72,0)
 ..Q
"RTN","PSGOE81",73,0)
 . I +$G(PSGRF)=3 S MSG(1)="This NOW order has an Orderable Item that requires a removal period prior",MSG(1,"F")="!!" D
"RTN","PSGOE81",74,0)
 .. S MSG(2)=" to the next administration.",MSG(2,"F")="!"
"RTN","PSGOE81",75,0)
 .. S MSG(3)="Please Enter the Stop DATE/TIME to reflect the Removal Time for this medication.",MSG(3,"F")="!"
"RTN","PSGOE81",76,0)
 ..Q
"RTN","PSGOE81",77,0)
 . D EN^DDIOL(.MSG)
"RTN","PSGOE81",78,0)
 .Q
"RTN","PSGOE81",79,0)
 K PSGFDX
"RTN","PSGOE81",80,0)
 W !,"STOP DATE/TIME: "_$S($P(PSGFDN,"^")]"":$P(PSGFDN,"^")_"// ",1:"") R X:DTIME I X="^"!'$T W:'$T $C(7) S PSGOEE=0 G DONE
"RTN","PSGOE81",81,0)
 I X="",PSGFD S X=$P(PSGFDN,"^")
"RTN","PSGOE81",82,0)
 I $E(X)="^" D ENFF^PSGOE82 G:Y>0 @Y G A25
"RTN","PSGOE81",83,0)
 I X="@"!(X?1."?") W:X="@" $C(7),"  (Required)" S:X="@" X="?" D ENHLP^PSGOEM(53.1,25)
"RTN","PSGOE81",84,0)
 I X=+X,(X>0),(X'>2000000) G A25:'$$ENDL^PSGDL(PSGSCH,X) K PSGDLS S PSGDL=X W " ...dose limit..." D ENE^PSGDL
"RTN","PSGOE81",85,0)
 K %DT S %DT="ERTX",%DT(0)=PSGSD D ^%DT K %DT I Y'>0 W $C(7),!!?13,"*** WARNING! INVALID STOP DATE OR PRIOR TO START DATE! ***",! G A25
"RTN","PSGOE81",86,0)
 S (PSGFDX,PSGFD,PSGNEFD)=+Y,PSGFDN=$$ENDD^PSGMI(PSGFD)_"^"_$$ENDTC^PSGMI(PSGFD)
"RTN","PSGOE81",87,0)
W25 ;
"RTN","PSGOE81",88,0)
 N Z,MSG
"RTN","PSGOE81",89,0)
 D DOSE I $G(Z)]"",Z>PSGNEFD D  G A25
"RTN","PSGOE81",90,0)
 . S MSG(1)="There is no administration time that falls between the Start Date/Time"
"RTN","PSGOE81",91,0)
 . S MSG(2)="and the Stop Date/Time."
"RTN","PSGOE81",92,0)
 . D EN^DDIOL(.MSG)
"RTN","PSGOE81",93,0)
 I PSGFD<PSGDT W $C(7),!!?13,"*** WARNING! THE STOP DATE ENTERED IS IN THE PAST! ***",! S MSG=1
"RTN","PSGOE81",94,0)
 Q:+$G(PSGRO)
"RTN","PSGOE81",95,0)
 ;
"RTN","PSGOE81",96,0)
DONE ;
"RTN","PSGOE81",97,0)
 ;Display Expected First Dose;BHW;PSJ*5*136
"RTN","PSGOE81",98,0)
 D EFDNV^PSJUTL
"RTN","PSGOE81",99,0)
 I PSGOEE G:'PSGOEEF(PSGF2) @BACK S PSGOEE=PSGOEEF(PSGF2)
"RTN","PSGOE81",100,0)
 D:+$G(PSGDUR) VERTIMES ;*315
"RTN","PSGOE81",101,0)
 K ORIG
"RTN","PSGOE81",102,0)
 S:'+$G(PSGRF) PSGRF=$P($G(^PS(50.7,$G(PSGPDRG),4),0),U,1)
"RTN","PSGOE81",103,0)
 Q
"RTN","PSGOE81",104,0)
 ;
"RTN","PSGOE81",105,0)
FF ; up-arrow to another field
"RTN","PSGOE81",106,0)
 D ENFF^PSGOEM I Y>0,Y'=39,Y'=8,Y'=10,Y'=25 S Y=Y_"^PSGOE8"_$S("^109^13^3^7^26^"[("^"_Y_"^"):"",1:2) S:Y=2 FB=PSGF2_"^PSGOE81"
"RTN","PSGOE81",107,0)
 Q
"RTN","PSGOE81",108,0)
 ;
"RTN","PSGOE81",109,0)
DEL ; delete entry
"RTN","PSGOE81",110,0)
 W !?3,"SURE YOU WANT TO DELETE" S %=0 D YN^DICN I %'=1 W $C(7),"  <NOTHING DELETED>"
"RTN","PSGOE81",111,0)
 Q
"RTN","PSGOE81",112,0)
 ;
"RTN","PSGOE81",113,0)
TIMES ;At least one admin time, not more than interval allows.
"RTN","PSGOE81",114,0)
 I ($G(PSGS0XT)'="O"),($G(PSGST)'="OC"),'$$PRNOK^PSGS0(PSGSCH) I X="" D EN^DDIOL("This order requires at least one administration time.") K X Q  ;No times
"RTN","PSGOE81",115,0)
 N H,I,MAX
"RTN","PSGOE81",116,0)
 I PSGSCH]"" I $D(^PS(51.1,"AC","PSJ",PSGSCH)) S H=+$O(^PS(51.1,"AC","PSJ",PSGSCH,0)) S I=$P($G(^PS(51.1,H,0)),"^",3)
"RTN","PSGOE81",117,0)
 I $G(PSGST)="O",$L(X,"-")>1 D EN^DDIOL("This is a One Time Order. Only one administration time is permitted.") K X Q
"RTN","PSGOE81",118,0)
 I $G(PSGST)="O" Q  ;Done validating One Time
"RTN","PSGOE81",119,0)
 I +$G(I)=0 Q  ;No frequency - can not check frequency related items
"RTN","PSGOE81",120,0)
 S MAX=1440/I
"RTN","PSGOE81",121,0)
 I MAX<1,$L(X,"-")>1 D EN^DDIOL("This order requires one administration time.") K X Q
"RTN","PSGOE81",122,0)
 I MAX'<1,$L(X,"-")>MAX D EN^DDIOL("The number of admin times entered is greater than indicated by the schedule.") K X Q  ;Too many times
"RTN","PSGOE81",123,0)
 I MAX'<1,$L(X,"-")<MAX D EN^DDIOL("The number of admin times entered is fewer than indicated by the schedule.")  ;Too few times
"RTN","PSGOE81",124,0)
 Q
"RTN","PSGOE81",125,0)
 ;
"RTN","PSGOE81",126,0)
DOSE ;Make certain at least one dose is given.
"RTN","PSGOE81",127,0)
 N INFO,X
"RTN","PSGOE81",128,0)
 S Z="",INFO=$S($G(PSGNESD):PSGNESD,1:$G(PSGSD))_U_($G(PSGNEFD))_U_($G(PSGSCH))_U_($G(PSGST))_U_($G(PSGDRG))_U_($G(PSGS0Y))
"RTN","PSGOE81",129,0)
 Q:$G(PSGST)="OC"!($G(PSGST)="P")
"RTN","PSGOE81",130,0)
 I '$L($G(PSGP)) N PSGP S PSGP=""
"RTN","PSGOE81",131,0)
 S Z=$$ENQ^PSJORP2(PSGP,INFO)  ;Expected first dose.
"RTN","PSGOE81",132,0)
 Q
"RTN","PSGOE81",133,0)
 ;
"RTN","PSGOE81",134,0)
 ;*315 new tags
"RTN","PSGOE81",135,0)
PSGDUR ; Prompt for Removal times if admin times are on 24hr rotations and Site Params are enabled.
"RTN","PSGOE81",136,0)
 ; check parameter files for removal criteria quit if removal rotation not enabled (<2)
"RTN","PSGOE81",137,0)
 ; if enabled determine type (hard vers soft stop)
"RTN","PSGOE81",138,0)
 ;0 = no removal (current cap/tab functionality)
"RTN","PSGOE81",139,0)
 ;1 = removal at next admin (current patch functionality)
"RTN","PSGOE81",140,0)
 ;2 = removal prior to next admin; soft stop (pharmacist optional prompt to designate duration of administration
"RTN","PSGOE81",141,0)
 ;3 = removal prior to next admin; hard stop (pharmacist required prompt to designate duration of administration)
"RTN","PSGOE81",142,0)
 ; prompt for removal if = 2 then allow skip, if = 3 then force entry
"RTN","PSGOE81",143,0)
 ;
"RTN","PSGOE81",144,0)
 S PSGRF=$P($G(^PS(50.7,$G(PSGPDRG),4),0),U,1) Q:((PSGRF<2)!($G(PSGST)="O")!($G(PSGST)="P")!($G(PSGST)="OC"))  ; no removal flag or no removal rotation
"RTN","PSGOE81",145,0)
 Q:$G(PSGS0XT)>1440  ; Duration of Administration valid only for 24 hours - subject to change in future.
"RTN","PSGOE81",146,0)
 N RP,PSGIDF,WMSG,PSGDERR S (PSGIDF,PSGDERR)=0 S:$G(PSGDUR)>0 RP=(PSGDUR/60) S:"BID,TID,QID"[$G(PSGSCH) PSGIDF=1  ; Use separate validation for Times per day type orders
"RTN","PSGOE81",147,0)
 S PSGF2=39
"RTN","PSGOE81",148,0)
 W !,"DURATION OF ADMINISTRATION (HRS): "_$S($G(RP):RP_"// ",1:"") R RP:DTIME I RP="^"!'$T W:'$T $C(7) S PSGDUR=$G(PSGDOA),X="^",PSGOEE=0 Q
"RTN","PSGOE81",149,0)
 I RP="" S:$G(PSGDUR)>0 RP=($G(PSGDUR)/60)
"RTN","PSGOE81",150,0)
 I RP="",$G(PSGS0XT)="D",$L(PSGSCH,"@")=2,$P(PSGSCH,"@",2) S (PSGAT,PSGRMVT)=$P(PSGSCH,"@",2) G 8
"RTN","PSGOE81",151,0)
 I RP="@",PSGRF'=3 D DEL G:%'=1 PSGDUR S (PSGS0Y,PSGDUR,PSGRMVT)="",PSGRMV=-1 S:+$G(^PS(53.1,+$G(PSGORD),2.1)) (PSGDUR,PSGRMV,PSGRMVT)="@" Q
"RTN","PSGOE81",152,0)
 S:(RP'="")&(RP'="@")&(+(RP)<1)&(($E(RP,1))'="?")&(RP'?1N.2N) RP="?" I RP?1."?" D DURHLP^PSGOEM(RP,PSGRF) G PSGDUR
"RTN","PSGOE81",153,0)
 I $E(RP)="^" D FF G:Y>0 @Y G PSGDUR
"RTN","PSGOE81",154,0)
 I (+RP>0),'PSGIDF D  ; exclude BID,TID or QID schedules
"RTN","PSGOE81",155,0)
 . S PSGDUR=(RP*60),PSGRMV=$G(PSGS0XT)-PSGDUR
"RTN","PSGOE81",156,0)
 . I PSGRMV<1 W !,"DURATION OF ADMINISTRATION MATCHES OR EXCEEDS ORDER FREQUENCY" S RP="",PSGDERR=1 K PSGDUR,PSGRMV G PSGDUR
"RTN","PSGOE81",157,0)
 .Q
"RTN","PSGOE81",158,0)
 Q:$G(PSGDERR)=1
"RTN","PSGOE81",159,0)
 I PSGRF=3,(+RP<1) W $C(7),!,"ENTRY IS REQUIRED" S RP="" G PSGDUR
"RTN","PSGOE81",160,0)
 I PSGRF=2,(+RP<1) D
"RTN","PSGOE81",161,0)
 . W !,"You have not entered Duration of Administration for this medication order, "
"RTN","PSGOE81",162,0)
 . W !,"therefore the BCMA user will not be prompted to remove the medication prior "
"RTN","PSGOE81",163,0)
 . W !,"to the next Admin Time."
"RTN","PSGOE81",164,0)
 . S PSGRMV=-1,RP=0
"RTN","PSGOE81",165,0)
 .Q
"RTN","PSGOE81",166,0)
 I PSGIDF,(+RP>0) D  ;Only for TPD schedules
"RTN","PSGOE81",167,0)
 . N F,P,PSGARR
"RTN","PSGOE81",168,0)
 . S PSGADT=$S($G(PSGDUR)=-1:X,$G(PSGAT):PSGAT,$G(PSGS0Y):PSGS0Y,1:""),PSGS0Y=PSGADT
"RTN","PSGOE81",169,0)
 . S PSGARR=$L($G(PSGADT),"-")
"RTN","PSGOE81",170,0)
 . F P=1:1:PSGARR D
"RTN","PSGOE81",171,0)
 .. S PSGARR(P)=($P(PSGADT,"-",P)/100) S:(P>1) F(P)=PSGARR(P)-PSGARR(P-1)
"RTN","PSGOE81",172,0)
 .. I $G(F(P)),($G(F(P))'=RP) S WMSG=1_U_"Duration of Administration does not correspond to one or more",WMSG(1)="of this order's scheduled Administration Times!"
"RTN","PSGOE81",173,0)
 ..Q
"RTN","PSGOE81",174,0)
 .Q
"RTN","PSGOE81",175,0)
 S:(+RP>0) PSGDUR=(RP*60)
"RTN","PSGOE81",176,0)
 W:(+RP>0) ?60,RP," HOURS"
"RTN","PSGOE81",177,0)
 D:$G(WMSG) EN^DDIOL($P(WMSG,U,2)),EN^DDIOL(WMSG(1))
"RTN","PSGOE81",178,0)
 Q
"RTN","PSGOE81",179,0)
 ;
"RTN","PSGOE81",180,0)
VERTIMES ; Redisplay Admin and Removal times
"RTN","PSGOE81",181,0)
 S PSGRF=$P($G(^PS(50.7,$G(PSGPDRG),4),0),U,1) Q:(PSGRF<2)!($G(PSGST)="O")
"RTN","PSGOE81",182,0)
 N PSGADT,PSGRARR,PSGAARR
"RTN","PSGOE81",183,0)
 ;If we have a frequency and this is odd type order then we need to start calculations with order start time.
"RTN","PSGOE81",184,0)
 I $G(PSGS0XT),$G(PSGNESD),+$G(PSGDUR),$G(PSGAT)="" D  Q
"RTN","PSGOE81",185,0)
 . N L
"RTN","PSGOE81",186,0)
 . S (PSGAARR,PSGRARR)=1,PSGADT=$P($P(PSGNESD,U,1),".",2),L=$L(PSGADT)
"RTN","PSGOE81",187,0)
 . S PSGRARR(1)=(((((PSGADT*60)+PSGDUR)/60)#24)*100) S:PSGRARR(1)=0 PSGRARR(1)=2400 S:$L(PSGRARR(1))=3 PSGRARR(1)="0"_PSGRARR(1)
"RTN","PSGOE81",188,0)
 . S PSGRARR(1)=$E(PSGRARR(1),1,L)_"(R)"
"RTN","PSGOE81",189,0)
 . S PSGAARR(1)=PSGADT,PSGAARR(1)=$E(PSGAARR(1),1,L)_"(A)"
"RTN","PSGOE81",190,0)
  . D WRITE
"RTN","PSGOE81",191,0)
 .Q
"RTN","PSGOE81",192,0)
 ;
"RTN","PSGOE81",193,0)
 S (PSGRARR,PSGAARR)=$S($G(PSGAT):$L(PSGAT,"-"),1:$L(PSGS0Y,"-"))
"RTN","PSGOE81",194,0)
 N P,L
"RTN","PSGOE81",195,0)
 F P=1:1:PSGRARR D
"RTN","PSGOE81",196,0)
 . S PSGADT=$S($G(PSGAT):$P(PSGAT,"-",P),1:$P(PSGS0Y,"-",P)),L=$L(PSGADT)
"RTN","PSGOE81",197,0)
 . S PSGADT=$S($L(PSGADT)=4:PSGADT/100,1:PSGADT*1)
"RTN","PSGOE81",198,0)
 . S PSGRARR(P)=(((((PSGADT*60)+PSGDUR)/60)#24)*100) S:PSGRARR(P)=0 PSGRARR(P)=2400 S:$L(PSGRARR(P))=3 PSGRARR(P)="0"_PSGRARR(P)
"RTN","PSGOE81",199,0)
 . S PSGRARR(P)=$E(PSGRARR(P),1,L)_"(R)"
"RTN","PSGOE81",200,0)
 . S PSGAARR(P)=(PSGADT*100) S:$L(PSGAARR(P))=3 PSGAARR(P)="0"_PSGAARR(P)
"RTN","PSGOE81",201,0)
 . S PSGAARR(P)=$E(PSGAARR(P),1,L)_"(A)"
"RTN","PSGOE81",202,0)
 .Q
"RTN","PSGOE81",203,0)
 D WRITE
"RTN","PSGOE81",204,0)
 Q
"RTN","PSGOE81",205,0)
 ;
"RTN","PSGOE81",206,0)
WRITE ;
"RTN","PSGOE81",207,0)
 W !!,"Verify Admin and removal times",!
"RTN","PSGOE81",208,0)
 W !,"(A)DMINISTRATION -(R)EMOVAL TIMES"
"RTN","PSGOE81",209,0)
 W !,"___________________________________________________________________________",!
"RTN","PSGOE81",210,0)
 F P=1:1:PSGAARR W PSGAARR(P)_"-"_PSGRARR(P)  W:P'=PSGAARR " , "
"RTN","PSGOE81",211,0)
 D ASK
"RTN","PSGOE81",212,0)
 Q
"RTN","PSGOE81",213,0)
 ;
"RTN","PSGOE81",214,0)
ASK ;
"RTN","PSGOE81",215,0)
 N Y
"RTN","PSGOE81",216,0)
 S DIR("A")="Is this correct",DIR(0)="Y" D ^DIR I $D(DUOUT)!$D(DTOUT) W:'$T $C(7) S PSGOEE=0 K PSGDUR G DONE
"RTN","PSGOE81",217,0)
 I 'Y K X S PSGDUR=-1 G A39
"RTN","PSGOE81",218,0)
 N P S P=1,PSGRMVT=$P(PSGRARR(P),"(",1)
"RTN","PSGOE81",219,0)
 F  S P=$O(PSGRARR(P)) Q:P=""  D
"RTN","PSGOE81",220,0)
 . S PSGRMVT=PSGRMVT_"-"_$P(PSGRARR(P),"(",1)
"RTN","PSGOE81",221,0)
 .Q
"RTN","PSGOE81",222,0)
 Q
"RTN","PSGOE81",223,0)
 ;
"RTN","PSGOE9")
0^3^B45686408^B40776926
"RTN","PSGOE9",1,0)
PSGOE9 ;BIR/CML3-EDIT ORDERS IN 55 ; 7/6/11 9:45am
"RTN","PSGOE9",2,0)
 ;;5.0;INPATIENT MEDICATIONS ;**11,47,50,72,110,111,188,192,207,113,223,269,315**;16 DEC 97;Build 73
"RTN","PSGOE9",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PSGOE9",4,0)
 ; Reference to ^PS(50.7 is supported by DBIA# 2180
"RTN","PSGOE9",5,0)
 ; Reference to ^PS(51.1 is supported by DBIA 2177
"RTN","PSGOE9",6,0)
 ; Reference to ^PS(51.2 is supported by DBIA# 2178
"RTN","PSGOE9",7,0)
 ; Reference to ^PS(55 is supported by DBIA #2191
"RTN","PSGOE9",8,0)
 ; Reference to ^PSDRUG is supported by DBIA# 2192
"RTN","PSGOE9",9,0)
 ;
"RTN","PSGOE9",10,0)
101 ; Orderable Item (AKA primary drug)
"RTN","PSGOE9",11,0)
 S MSG=0,PSGF2=101,PSGOOPD=PSGPD,PSGOOPDN=PSGPDN S:PSGOEEF(PSGF2) BACK="101^PSGOE9"
"RTN","PSGOE9",12,0)
 S %=1 W !!,$C(7),"WARNING!  If you change the drug of an order, the Dosage Ordered and Dispense",!,"Drug(s) are deleted." F  W !,"Do you wish to continue" S %=2 D YN^DICN Q:%  D DH^PSGOE8
"RTN","PSGOE9",13,0)
 I %'=1 G DONE
"RTN","PSGOE9",14,0)
A101 ;
"RTN","PSGOE9",15,0)
 I $G(PSJORD),$G(PSGP) I $$COMPLEX^PSJOE(PSGP,PSJORD) S PSGOEE=0 D  G DONE
"RTN","PSGOE9",16,0)
 . W !!?5,"Orderable Item may not be edited for active complex orders." D PAUSE^VALM1
"RTN","PSGOE9",17,0)
 W !,"ORDERABLE ITEM: ",$S(PSGPD:PSGPDN_"// ",1:"") R X:DTIME I X="^"!'$T W:'$T $C(7) S PSGOEE=0 G DONE
"RTN","PSGOE9",18,0)
 I X="",PSGPD S X=PSGPDN I PSGPD'=PSGPDN,$D(^PS(50.7,PSGPD,0)) G DONE
"RTN","PSGOE9",19,0)
 I $S(X="@":1,X]"":0,1:'PSGPD) W $C(7),"  (Required)" S X="?" D ENHLP^PSGOEM(55.06,101) G A101
"RTN","PSGOE9",20,0)
 I X?1."?" D ENHLP^PSGOEM(55.06,101)
"RTN","PSGOE9",21,0)
 I $E(X)="^" D ENFF^PSGOE92 G:Y>0 @Y G A101
"RTN","PSGOE9",22,0)
 ;BHW;PSJ*5.0*192;Modify ^DIC call to use MIX^DIC and only B/C cross-references
"RTN","PSGOE9",23,0)
 K DIC,D S DIC="^PS(50.7,",DIC(0)="EMQZ",DIC("S")="I $$ENOISC^PSJUTL(Y,""U"")",D="B^C" D MIX^DIC1 K DIC,D I Y'>0 G A101
"RTN","PSGOE9",24,0)
 I +Y=PSGPD G DONE  ;PSJ*5*269 - No change to Orderable Item
"RTN","PSGOE9",25,0)
 F  S %=2 D DH^PSGOE8,YN^DICN Q:%
"RTN","PSGOE9",26,0)
 I %'=1 G A101
"RTN","PSGOE9",27,0)
 S (PSGPDRG,PSGPD)=+Y,(PSGPDN,PSGPDRGN)=$$OINAME^PSJLMUTL(PSGPDRG)
"RTN","PSGOE9",28,0)
 S PSGNEDFD=$$GTNEDFD^PSGOE7("U",PSGPDRG)
"RTN","PSGOE9",29,0)
 S PSGPDNX=1,PSGPD=+Y,PSGPDN=$$OINAME^PSJLMUTL(PSGPD),PSGDO="" K ^PS(53.45,PSJSYSP,2) S X=$O(^PSDRUG("ASP",PSGPD,0)) I X,'$O(^(X)) S ^PS(53.45,PSJSYSP,2,0)="^53.4502P^1^1",^(1,0)=X,^PS(53.45,PSJSYSP,2,"B",X,1)="" G DONE
"RTN","PSGOE9",30,0)
 D ENDRG^PSGOEF1(PSGPD,0)
"RTN","PSGOE9",31,0)
 G DONE
"RTN","PSGOE9",32,0)
 ;
"RTN","PSGOE9",33,0)
109 ; dosage ordered
"RTN","PSGOE9",34,0)
 S MSG=0,PSGF2=109 S:PSGOEEF(PSGF2) BACK="109^PSGOE9"
"RTN","PSGOE9",35,0)
A109 ;
"RTN","PSGOE9",36,0)
 I $G(PSJORD),$G(PSGP) I $$COMPLEX^PSJOE(PSGP,PSJORD) S PSGOEE=0 D  G DONE
"RTN","PSGOE9",37,0)
 . W !!?5,"Dosage may not be edited for active complex orders." D PAUSE^VALM1
"RTN","PSGOE9",38,0)
 D EDITDOSE^PSJDOSE S X=PSGDO G DONE
"RTN","PSGOE9",39,0)
 W !,"DOSAGE ORDERED: ",$S(PSGDO]"":PSGDO_"// ",1:"") R X:DTIME I X="^"!'$T W:'$T $C(7) S PSGOEE=0 G DONE
"RTN","PSGOE9",40,0)
 I X=""&(PSGDO]"") S X=PSGDO
"RTN","PSGOE9",41,0)
 I $$CHECK^PSGOE8(PSJSYSP)&(X="")&(PSGDO']"") W $C(7),"    (Required) " G A109
"RTN","PSGOE9",42,0)
 I $$CHECK^PSGOE8(PSJSYSP)&(X="@") W $C(7),"  (Required)" G A109
"RTN","PSGOE9",43,0)
 I '$$CHECK^PSGOE8(PSJSYSP)&(X="@") S PSGDO="" G DONE
"RTN","PSGOE9",44,0)
 I X?1."?" D ENHLP^PSGOEM(55.06,109) G A109
"RTN","PSGOE9",45,0)
 I $E(X)="^" D ENFF^PSGOE92 G:Y>0 @Y G A109
"RTN","PSGOE9",46,0)
 I $E(X,$L(X))=" " F  S X=$E(X,1,$L(X)-1) Q:$E(X,$L(X))'=" "
"RTN","PSGOE9",47,0)
 I $S(X?.E1C.E:1,$L(X)>20:1,X="":0,X["^":1,X?1.P:1,1:X=+X) W $C(7),"  ",$S(X?1.P!(X=""):"(Required)",1:"??") D ENHLP^PSGOEM(55.06,109) G A109
"RTN","PSGOE9",48,0)
 S PSGDO=X G DONE
"RTN","PSGOE9",49,0)
 ;
"RTN","PSGOE9",50,0)
3 ; med route
"RTN","PSGOE9",51,0)
 S MSG=0,PSGF2=3 S:PSGOEEF(PSGF2) BACK="3^PSGOE9"
"RTN","PSGOE9",52,0)
A3 I $G(PSJORD),$G(PSGP) I $$COMPLEX^PSJOE(PSGP,PSJORD) S PSGOEE=0 D  G DONE
"RTN","PSGOE9",53,0)
 . W !!?5,"Med Route may not be edited for active complex orders." D PAUSE^VALM1
"RTN","PSGOE9",54,0)
 W !,"MED ROUTE: ",$S(PSGMR:PSGMRN_"// ",1:"") R X:DTIME I X="^"!'$T W:'$T $C(7) S PSGOEE=0 G DONE
"RTN","PSGOE9",55,0)
 I X="",PSGMR S X=PSGMRN I PSGMR'=PSGMRN,$D(^PS(51.2,PSGMR,0)) W "  "_$P(^(0),"^",3) G DONE
"RTN","PSGOE9",56,0)
 I $S(X="@":1,X]"":0,1:'PSGMR) W $C(7),"  (Required)" S X="?" D ENHLP^PSGOEM(55.06,3) G A3
"RTN","PSGOE9",57,0)
 I X?1."?" D ENHLP^PSGOEM(55.06,3)
"RTN","PSGOE9",58,0)
 I $E(X)="^" D ENFF^PSGOE92 G:Y>0 @Y G A3
"RTN","PSGOE9",59,0)
 K DIC S DIC="^PS(51.2,",DIC(0)="EMQZ",DIC("S")="I $P(^(0),""^"",4)" D ^DIC K DIC I Y'>0 G A3
"RTN","PSGOE9",60,0)
 S PSGMR=+Y,PSGMRN=Y(0,0) G DONE
"RTN","PSGOE9",61,0)
 ;
"RTN","PSGOE9",62,0)
7 ; schedule type
"RTN","PSGOE9",63,0)
 S MSG=0,PSGF2=7 S:PSGOEEF(PSGF2) BACK="7^PSGOE9"
"RTN","PSGOE9",64,0)
A7 I $G(PSGP),$G(PSGORD) I $$COMPLEX^PSJOE(PSGP,PSGORD) D
"RTN","PSGOE9",65,0)
 . N X,Y,PARENT,P2ND S P2ND=$S(PSGORD["U":$G(^PS(55,PSGP,5,+PSGORD,.2)),1:$G(^PS(53.1,+PSGORD,.2))),PARENT=$P(P2ND,"^",8)
"RTN","PSGOE9",66,0)
 . I PARENT D FULL^VALM1 W !!?5,"This order is part of a complex order. Please review the following ",!?5,"associated orders before changing this order." D CMPLX^PSJCOM1(PSGP,PARENT,PSGORD)
"RTN","PSGOE9",67,0)
 W !,"SCHEDULE TYPE: "_$S(PSGSTN]"":PSGSTN_"// ",1:"") R X:DTIME S X=$TR(X,"coprocf","COPROCF") I X="^"!'$T S PSGOEE=0 W $C(7) G DONE
"RTN","PSGOE9",68,0)
 I X="" S X=PSGST,PSGSTN=$$ENSTN^PSGMI(X) W:PSGSTN]"" "  ",PSGSTN G DONE
"RTN","PSGOE9",69,0)
 S:X="F" X="R"
"RTN","PSGOE9",70,0)
 I ",?,??,C,O,OC,P,R,"'[(","_X_",") W " ??" G A7
"RTN","PSGOE9",71,0)
 I $$PRNOK^PSGS0($G(PSGSCH)),X="C" W "  ??" G A7
"RTN","PSGOE9",72,0)
 I X="@"!(X?1."?") W:X="@" $C(7),"  (Required)" S:X="@" X="?" D ENHLP^PSGOEM(55.06,7) G A7
"RTN","PSGOE9",73,0)
 I $E(X)="^" D ENFF^PSGOE92 G:Y>0 @Y G A7
"RTN","PSGOE9",74,0)
 ;*223 Don't allow O sched type on C orders
"RTN","PSGOE9",75,0)
 I X="O",$$SCHTP^PSGOE8(PSGSCH)'="O" W !,"  SCHEDULE ("_PSGSCH_") is not a ONE TIME Schedule." G A7
"RTN","PSGOE9",76,0)
 ;*269 Don't allow C sched type on O orders
"RTN","PSGOE9",77,0)
 I X="C",$$SCHTP^PSGOE8(PSGSCH)="O" W !,"  SCHEDULE ("_PSGSCH_") is not a CONTINUOUS Schedule." G A7
"RTN","PSGOE9",78,0)
 S PSGOST=PSGST
"RTN","PSGOE9",79,0)
 S PSGST=X,PSGSTN=$$ENSTN^PSGMI(X) W:PSGSTN]"" "  ",PSGSTN
"RTN","PSGOE9",80,0)
 I X="P",$G(PSGAT)]"" S PSGOAT=PSGAT S PSGAT="" D
"RTN","PSGOE9",81,0)
 .W !!,"NOTE: This change in schedule type also changes the ADMIN TIMES.",!
"RTN","PSGOE9",82,0)
 .S MSG=1,PSGOEEF(39)=1
"RTN","PSGOE9",83,0)
 .I $G(PSJNEWOE) D PAUSE^VALM1
"RTN","PSGOE9",84,0)
 G DONE
"RTN","PSGOE9",85,0)
 ;
"RTN","PSGOE9",86,0)
26 ; schedule
"RTN","PSGOE9",87,0)
 S MSG=0,PSGF2=26 S:PSGOEEF(PSGF2) BACK="26^PSGOE9"
"RTN","PSGOE9",88,0)
A26 I $G(PSJORD),$G(PSGP) I $$COMPLEX^PSJOE(PSGP,PSJORD) S PSGOEE=0 D  G DONE
"RTN","PSGOE9",89,0)
 . W !!?5,"Schedule may not be edited for active complex orders." D PAUSE^VALM1
"RTN","PSGOE9",90,0)
 W !,"SCHEDULE: ",$S(PSGSCH]"":PSGSCH_"// ",1:"") R X:DTIME I X="^"!'$T W:'$T $C(7) S PSGOEE=0 G DONE
"RTN","PSGOE9",91,0)
 S:X="" X=PSGSCH,PSGSCH="" I "@"[X W $C(7),"  (Required)" S X="?" D ENHLP^PSGOEM(55.06,26) G A26
"RTN","PSGOE9",92,0)
 S DOW=0 I $$DOW^PSIVUTL($$ENLU^PSGMI(X)) S DOW=1
"RTN","PSGOE9",93,0)
 I X?1."?" D ENHLP^PSGOEM(55.06,26) G A26
"RTN","PSGOE9",94,0)
 I $E(X)="^" D ENFF^PSGOE92 G:Y>0 @Y G A26
"RTN","PSGOE9",95,0)
 ;BHW;PSJ*5*188;Add flag and IEN return variable for PSGS0 (PSJ*5*134), Highlight Admin Times if they changed.
"RTN","PSGOE9",96,0)
 N PSJSLUP,PSGSFLG S PSJSLUP=1,PSGSFLG=1 D EN^PSGS0 I '$D(X) W $C(7),"  ??" S X="?" D ENHLP^PSGOEM(55.06,26) G A26
"RTN","PSGOE9",97,0)
 I X'=PSGSCH D
"RTN","PSGOE9",98,0)
 . N XX
"RTN","PSGOE9",99,0)
 . K PSGDUR,PSGRMVT,PSGRMV,ND2P1 ;*315 Removal times are tied to ADMIN times.
"RTN","PSGOE9",100,0)
 . S PSGSCH=X
"RTN","PSGOE9",101,0)
 . I PSGS0Y'=PSGAT S PSGAT=PSGS0Y  ;Change so that any schedule change will adjust the type and default the admin times - DRF
"RTN","PSGOE9",102,0)
 . D  ;Change schedule type to agree with schedule
"RTN","PSGOE9",103,0)
 .. I $G(DOW) S PSGST="C",PSGSTN=$$ENSTN^PSGMI(PSGST) Q
"RTN","PSGOE9",104,0)
 .. I (PSGSCH[" PRN")!(PSGSCH="PRN") I $$PRNOK^PSGS0(PSGSCH) S PSGOST=PSGST,PSGST="P",PSGSTN=$$ENSTN^PSGMI(PSGST) Q
"RTN","PSGOE9",105,0)
 .. I '$G(PSGSCIEN),PSGSCH]"" S XX=+$O(^PS(51.1,"AC","PSJ",PSGSCH,0)),PSGSCIEN=XX ;PSGSCIEN should be set by call to EN^PSGS0
"RTN","PSGOE9",106,0)
 .. S PSGST=$P($G(^PS(51.1,PSGSCIEN,0)),"^",5) I PSGST="D" S PSGST="C"  ;DOW schedules are converted to Continuous
"RTN","PSGOE9",107,0)
 .. S PSGSTN=$$ENSTN^PSGMI(PSGST)
"RTN","PSGOE9",108,0)
 . W !!,"NOTE: This change in schedule also changes the ADMIN TIMES and SCHEDULE TYPE.",!
"RTN","PSGOE9",109,0)
 . S MSG=1,PSGOEEF(39)=1
"RTN","PSGOE9",110,0)
 . I ($G(PSGRF)>1),PSGST="C" D
"RTN","PSGOE9",111,0)
 .. S PSGF2=41,BACK="41^PSGOE91",PSGOEEF(PSGF2)=1 D 41^PSGOE91 S BACK="26^PSGOE9",PSGF2=26,PSGOAT=PSGAT ;*315 Prompt for Admin to get DOA
"RTN","PSGOE9",112,0)
 ..Q
"RTN","PSGOE9",113,0)
 . I $G(PSJNEWOE) D PAUSE^VALM1
"RTN","PSGOE9",114,0)
 I PSGST="O" S PSGOEEF(7)=1 I +$G(PSGRF) S PSGOEEF(34)=1 D 34^PSGOE91 S PSGF2=26
"RTN","PSGOE9",115,0)
 ;
"RTN","PSGOE9",116,0)
DONE ;
"RTN","PSGOE9",117,0)
 I PSGOEE G:'PSGOEEF(PSGF2) @BACK S PSGOEE=PSGOEEF(PSGF2)
"RTN","PSGOE9",118,0)
 K F,F0,PSGF2 Q
"RTN","PSGOE9",119,0)
 ;
"RTN","PSGOE9",120,0)
DEL ; delete entry
"RTN","PSGOE9",121,0)
 W !?3,"SURE YOU WANT TO DELETE" S %=0 D YN^DICN I %'=1 W $C(7),"  <NOTHING DELETED>"
"RTN","PSGOE9",122,0)
 Q
"RTN","PSGOE91")
0^51^B114506960^B37734191
"RTN","PSGOE91",1,0)
PSGOE91 ;BIR/CML3-ACTIVE ORDER EDIT (CONT.) ; 8/4/10 7:07am
"RTN","PSGOE91",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**50,64,58,110,111,136,113,179,265,267,285,315**;16 DEC 97;Build 73
"RTN","PSGOE91",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PSGOE91",4,0)
 ; Reference to ^PS(55 is supported by DBIA #2191.
"RTN","PSGOE91",5,0)
 ; Reference to ^PS(50.7 is supported by DBIA# 2180
"RTN","PSGOE91",6,0)
 ; Reference to ^PS(51.1 is supported by DBIA 2177.
"RTN","PSGOE91",7,0)
 ;
"RTN","PSGOE91",8,0)
41 ; admin times
"RTN","PSGOE91",9,0)
 ;S MSG=0,PSGF2=41,ORIG=$G(PSGAT) S:PSGOEEF(PSGF2) BACK="41^PSGOE91"
"RTN","PSGOE91",10,0)
 ;*315 next 5 lines
"RTN","PSGOE91",11,0)
 N PSGDOA
"RTN","PSGOE91",12,0)
 S MSG=0,PSGF2=41,ORIG=$G(PSGAT),PSGDOA=$G(PSGDUR) S:PSGOEEF(PSGF2) BACK="41^PSGOE91"
"RTN","PSGOE91",13,0)
 I (PSGST="P")!$$PRNOK^PSGS0($G(PSGSCH)) G DONE
"RTN","PSGOE91",14,0)
 I $$ODD^PSGS0(PSGS0XT) D PSGDUR G DONE
"RTN","PSGOE91",15,0)
A41 I $G(PSJORD),$G(PSGP) I $$COMPLEX^PSJOE(PSGP,PSJORD) S PSGOEE=0 D  G DONE
"RTN","PSGOE91",16,0)
 . W !!?5,"ADMIN TIMES may not be edited for active complex orders." D PAUSE^VALM1
"RTN","PSGOE91",17,0)
 W !,"ADMIN TIMES: "_$S(PSGAT:PSGAT_"// ",1:"") R X:DTIME I X="^"!('$T) W:'$T $C(7) S PSGOEE=0 S:X="^" (X,PSGAT)=$G(ORIG),PSGDUR="" G DONE
"RTN","PSGOE91",18,0)
 I X="" S:$G(PSGAT) X=PSGAT,PSGNOHI=1 ;*315 If admin time default was taken then don't highlight admin time.
"RTN","PSGOE91",19,0)
 I $E(X)="^" D ENFF^PSGOE92 G:Y>0 @Y G A41
"RTN","PSGOE91",20,0)
 I X="@" I (PSGS0XT="D")!(PSGSCH["@") I ((",P,R,OC,O,")'[(","_$G(PSGST)_",")) D  G A41
"RTN","PSGOE91",21,0)
 .W $C(7),"  ??" S X="?" W:PSGS0XT="D"!(PSGSCH["@") !,"This is a 'DAY OF THE WEEK' schedule and MUST have admin times." D ENHLP^PSGOEM(55.06,41)
"RTN","PSGOE91",22,0)
 I X="@" D DEL G:%'=1 A41 S PSGAT="",X=""
"RTN","PSGOE91",23,0)
 I ((PSGST="O")!($G(PSGST)="OC")!($G(PSGST)="P")!$$ODD^PSGS0($P($G(ZZND),"^",3))!($P($G(ZZND),"^",5)="O")),X="" D  G DONE
"RTN","PSGOE91",24,0)
 . S (PSGS0Y,PSGAT)=X
"RTN","PSGOE91",25,0)
 . I (($G(PSGRF))&($G(PSGST)="O")) N PSGRO S PSGOEEF(34)=1,PSGOEEF(41)=1,PSGRO=1 D 34
"RTN","PSGOE91",26,0)
 .Q
"RTN","PSGOE91",27,0)
 I $G(PSGS0XT) I '$$ODD^PSGS0(PSGS0XT),$G(PSGST)'="P",$G(PSGST)'="OC",'$$PRNOK^PSGS0(PSGSCH) I ($G(PSGST)'="O") D TIMES G:'$D(X) A41 D PSGDUR G:'$D(X) A41 G:$G(X)="^" DONE ;*315
"RTN","PSGOE91",28,0)
 I X?1."?" D ENHLP^PSGOEM(55.06,41) G A41
"RTN","PSGOE91",29,0)
 D ENCHK^PSGS0 I '$D(X) W $C(7),"  ??" S X="?" D ENHLP^PSGOEM(55.06,41) G A41
"RTN","PSGOE91",30,0)
 S PSGOAT=PSGAT
"RTN","PSGOE91",31,0)
 S (PSGS0Y,PSGAT)=X G DONE
"RTN","PSGOE91",32,0)
 ;
"RTN","PSGOE91",33,0)
8 ; special instructions
"RTN","PSGOE91",34,0)
 S MSG=0,PSGF2=8 S:PSGOEEF(PSGF2) BACK="8^PSGOE91"
"RTN","PSGOE91",35,0)
A8 I $G(PSGP),$G(PSGORD) I $$COMPLEX^PSJOE(PSGP,PSGORD) D
"RTN","PSGOE91",36,0)
 . N X,Y,PARENT,P2ND S P2ND=$S(PSGORD["U":$G(^PS(55,PSGP,5,+PSGORD,.2)),1:$G(^PS(53.1,+PSGORD,.2))),PARENT=$P(P2ND,"^",8)
"RTN","PSGOE91",37,0)
 . I PARENT D FULL^VALM1 W !!?5,"This order is part of a complex order. Please review the following ",!?5,"associated orders before changing this order." D CMPLX^PSJCOM1(PSGP,PARENT,PSGORD)
"RTN","PSGOE91",38,0)
 I $E(X)=U D ENFF^PSGOE92 G:Y>0 @Y G A8
"RTN","PSGOE91",39,0)
 S PSGSI=$$EDITSI^PSJBCMA5($G(PSGP),$G(PSGORD)) I $G(PSGP),$G(PSGORD) I '$$DIFFSI^PSJBCMA5(PSGP,PSGORD) S PSGOEE=0 G DONE
"RTN","PSGOE91",40,0)
 S PSGSI=$S((PSGSI>0&(PSGSI<4)):$G(^PS(53.45,+PSJSYSP,5,1,0))_" "_$G(^PS(53.45,+PSJSYSP,5,2,0)),PSGSI>3:"Instructions too long. See Order View or BCMA for full text.",1:"")
"RTN","PSGOE91",41,0)
 S:PSGSI=" " PSGSI="" I PSGSI]"" S PSGSI=$$ENBCMA^PSJUTL("U") G DONE
"RTN","PSGOE91",42,0)
 Q
"RTN","PSGOE91",43,0)
 ;
"RTN","PSGOE91",44,0)
10 ; start date/time
"RTN","PSGOE91",45,0)
 S MSG=0,PSGF2=10 S:PSGOEEF(PSGF2) BACK="10^PSGOE91"
"RTN","PSGOE91",46,0)
A10 ;
"RTN","PSGOE91",47,0)
 I $G(PSJORD),$G(PSGP) I $$COMPLEX^PSJOE(PSGP,PSJORD) S PSGOEE=0 D  G DONE
"RTN","PSGOE91",48,0)
 . W !!?5,"Start Date/Time may not be edited for active complex orders." D PAUSE^VALM1
"RTN","PSGOE91",49,0)
 K PSGSDX
"RTN","PSGOE91",50,0)
 W !,"START DATE/TIME: "_$S($P(PSGSDN,"^")]"":$P(PSGSDN,"^")_"// ",1:"") R X:DTIME I X="^"!'$T W:'$T $C(7) S PSGOEE=0 G DONE
"RTN","PSGOE91",51,0)
 I X="",PSGSD W "  "_PSGSDN G DONE
"RTN","PSGOE91",52,0)
 I X="P" D ENPREV^PSGDL W:'$D(X) $C(7) G:'$D(X) A10 S PSGSD=+X,PSGSDN=$$ENDD^PSGMI(PSGSD)_"^"_$$ENDTC^PSGMI(PSGSD) W "  ",$P(PSGSDN,"^") G DONE
"RTN","PSGOE91",53,0)
 I X="@"!(X?1."?") W:X="@" $C(7),"  (Required)" S:X="@" X="?" D ENHLP^PSGOEM(55.06,10)
"RTN","PSGOE91",54,0)
 I $E(X)="^" D ENFF^PSGOE92 G:Y>0 @Y G A10
"RTN","PSGOE91",55,0)
 NEW TMPX S TMPX=X,X1=PSGDT,X2=-7 D C^%DTC K %DT S %DT="ERTX",%DT(0)=X,X=TMPX D ^%DT K %DT I Y'>0 D ENHLP^PSGOEM(55.06,10) G A10
"RTN","PSGOE91",56,0)
 I PSGFD<Y W $C(7),!?5,"*** THE START DATE CANNOT BE AFTER THE STOP DATE! ***",! S MSG=1 G A10
"RTN","PSGOE91",57,0)
 S (PSGSDX,PSGSD)=+Y,PSGSDN=$$ENDD^PSGMI(PSGSD)_"^"_$$ENDTC^PSGMI(PSGSD) G DONE
"RTN","PSGOE91",58,0)
 ;
"RTN","PSGOE91",59,0)
34 ; stop date
"RTN","PSGOE91",60,0)
 S MSG=0,PSGF2=34 S:PSGOEEF(PSGF2) BACK="34^PSGOE91"
"RTN","PSGOE91",61,0)
A34 ;
"RTN","PSGOE91",62,0)
 K PSGFDX
"RTN","PSGOE91",63,0)
 I $G(PSJORD),$G(PSGP) I $$COMPLEX^PSJOE(PSGP,PSJORD) S PSGOEE=0 D  G DONE
"RTN","PSGOE91",64,0)
 . W !!?5,"Stop Date/Time may not be edited for active complex orders." D PAUSE^VALM1
"RTN","PSGOE91",65,0)
 N MSG,PSGTMPST S PSGTMPST=$G(PSGST) S:'+$G(PSGRF) PSGRF=$P($G(^PS(50.7,$G(PSGPDRG),4),0),U,1) ;*315 One time orders for MRR's require message to instruct pharmacists
"RTN","PSGOE91",66,0)
 I +$G(PSGRF),$D(^PS(51.1,"AC","PSJ",$G(PSGSCH))) D
"RTN","PSGOE91",67,0)
 . S:PSGTMPST=($G(PSGST)="R") PSGST=$P($G(^PS(51.1,$O(^PS(51.1,"AC","PSJ",$G(PSGSCH),"")),0)),"^",5) ;Handle "Fill on Request"
"RTN","PSGOE91",68,0)
 .Q
"RTN","PSGOE91",69,0)
 I $G(PSGTMPST)="O",+$G(PSGRF) S (PSGFDN,PSGFD)="" D 
"RTN","PSGOE91",70,0)
 . I +$G(PSGRF)=1 S MSG(1)="This NOW order has an Orderable Item for which a removal is required" D
"RTN","PSGOE91",71,0)
 .. S MSG(2)=" at the next administration."
"RTN","PSGOE91",72,0)
 .. S MSG(3)="The Stop DATE/TIME entered should be the next anticipated administration for the medication.",MSG(3,"F")="!"
"RTN","PSGOE91",73,0)
 ..Q
"RTN","PSGOE91",74,0)
 . I +$G(PSGRF)=2 S MSG(1)="This NOW order has an Orderable Item for which a removal period is optional",MSG(1,"F")="!!" D
"RTN","PSGOE91",75,0)
 .. S MSG(2)="prior to the next administration.",MSG(2,"F")="!"
"RTN","PSGOE91",76,0)
 .. S MSG(3)="If Early Removal is needed, enter Removal Time in Stop DATE/TIME field.",MSG(3,"F")="!"
"RTN","PSGOE91",77,0)
 .. S MSG(4)="If an Early Removal is not required, the Stop DATE/TIME entered"
"RTN","PSGOE91",78,0)
 .. S MSG(5)="should be the next anticipated administration for the medication.",MSG(5,"F")="!"
"RTN","PSGOE91",79,0)
 ..Q
"RTN","PSGOE91",80,0)
 . I +$G(PSGRF)=3 S MSG(1)="This NOW order has an Orderable Item that requires a removal period prior",MSG(1,"F")="!!" D
"RTN","PSGOE91",81,0)
 .. S MSG(2)=" to the next administration.",MSG(2,"F")="!"
"RTN","PSGOE91",82,0)
 .. S MSG(3)="Please Enter the Stop DATE/TIME to reflect the Removal Time for this medication.",MSG(3,"F")="!"
"RTN","PSGOE91",83,0)
 ..Q
"RTN","PSGOE91",84,0)
 . D EN^DDIOL(.MSG)
"RTN","PSGOE91",85,0)
 .Q
"RTN","PSGOE91",86,0)
 W !,"STOP DATE/TIME: "_$S($P(PSGFDN,"^")]"":$P(PSGFDN,"^")_"// ",1:"") R X:DTIME I X="^"!'$T W:'$T $C(7) S PSGOEE=0 G DONE
"RTN","PSGOE91",87,0)
 I X="",PSGFD W "   "_$P(PSGFDN,"^") G W34
"RTN","PSGOE91",88,0)
 I $E(X)="^" D ENFF^PSGOE92 G:Y>0 @Y G A34
"RTN","PSGOE91",89,0)
 I X="@"!(X?1."?") W:X="@" $C(7),"  (Required)" S:X="@" X="?" D ENHLP^PSGOEM(55.06,34)
"RTN","PSGOE91",90,0)
 I X=+X,(X>0),(X'>2000000) G A34:'$$ENDL^PSGDL(PSGSCH,X) K PSGDLS S PSGDL=X W " ...dose limit..." D ENE^PSGDL
"RTN","PSGOE91",91,0)
 K %DT S %DT="ERTX",%DT(0)=PSGSD D ^%DT K %DT I Y'>0 W $C(7),!!?13,"*** WARNING! INVALID STOP DATE OR PRIOR TO START DATE! ***",! G A34
"RTN","PSGOE91",92,0)
 S (PSGFDX,PSGFD)=+Y,PSGFDN=$$ENDD^PSGMI(PSGFD)_"^"_$$ENDTC^PSGMI(PSGFD)
"RTN","PSGOE91",93,0)
W34 ;Compare to Start Date
"RTN","PSGOE91",94,0)
 N Z,MSG
"RTN","PSGOE91",95,0)
 D DOSE I $G(Z)]"",Z>$S($G(PSGFD):PSGFD,1:$G(PSGNEFD)) D  G A34
"RTN","PSGOE91",96,0)
 . S MSG(1)="There is no administration time that falls between the Start Date/Time"
"RTN","PSGOE91",97,0)
 . S MSG(2)="and the Stop Date/Time."
"RTN","PSGOE91",98,0)
 . D EN^DDIOL(.MSG)
"RTN","PSGOE91",99,0)
 I PSGFD<PSGDT W $C(7),!!?13,"*** WARNING! THE STOP DATE ENTERED IS IN THE PAST! ***",! S MSG=1
"RTN","PSGOE91",100,0)
 Q:+$G(PSGRO)
"RTN","PSGOE91",101,0)
 ;
"RTN","PSGOE91",102,0)
DONE ;
"RTN","PSGOE91",103,0)
 ;Display Expected First Dose;BHW;PSJ*5*136
"RTN","PSGOE91",104,0)
 ;BHW;PSJ*5*179; - Remove EFD call.  Added to PSGOEE.
"RTN","PSGOE91",105,0)
 I PSGOEE G:'PSGOEEF(PSGF2) @BACK S PSGOEE=PSGOEEF(PSGF2)
"RTN","PSGOE91",106,0)
 D:+$G(PSGDUR) VERTIMES ;*315
"RTN","PSGOE91",107,0)
 S:'+$G(PSGRF) PSGRF=$P($G(^PS(50.7,$G(PSGPDRG),4),0),U,1)
"RTN","PSGOE91",108,0)
 K F,F0,F1,PSGF2,F3,PSG,SDT,ORIG Q
"RTN","PSGOE91",109,0)
 ;
"RTN","PSGOE91",110,0)
FF ; up-arrow to another field
"RTN","PSGOE91",111,0)
 D ENFF^PSGOEM I Y>0,Y'=41,Y'=8,Y'=10,Y'=34 S Y=Y_"^PSGOE9"_$S("^109^13^3^7^26^"[("^"_Y_"^"):"",1:2) S:Y=2 FB=PSGF2_"^PSGOE91"
"RTN","PSGOE91",112,0)
 Q
"RTN","PSGOE91",113,0)
 ;
"RTN","PSGOE91",114,0)
DEL ; delete entry
"RTN","PSGOE91",115,0)
 W !?3,"SURE YOU WANT TO DELETE" S %=0 D YN^DICN I %'=1 W $C(7),"  <NOTHING DELETED>"
"RTN","PSGOE91",116,0)
 Q
"RTN","PSGOE91",117,0)
 ;
"RTN","PSGOE91",118,0)
TIMES ;At least one admin time, not more than interval allows.
"RTN","PSGOE91",119,0)
 I $G(PSGST)'="O",($G(PSGST)'="OC"),($G(PSGST)'="R") I X="" D EN^DDIOL("This order requires at least one administration time.") K X Q  ;No times
"RTN","PSGOE91",120,0)
 N H,I,MAX
"RTN","PSGOE91",121,0)
 I PSGSCH]"" I $D(^PS(51.1,"AC","PSJ",PSGSCH)) S H=+$O(^PS(51.1,"AC","PSJ",PSGSCH,0)) S I=$P($G(^PS(51.1,H,0)),"^",3)
"RTN","PSGOE91",122,0)
 I $G(PSGST)="O",$L(X,"-")>1 D EN^DDIOL("This is a One Time Order. Only one administration time is permitted.") K X Q
"RTN","PSGOE91",123,0)
 I $G(PSGST)="O" Q  ;Done validating One Time
"RTN","PSGOE91",124,0)
 I +$G(I)=0 Q  ;No frequency - can not check frequency related items
"RTN","PSGOE91",125,0)
 S MAX=1440/I
"RTN","PSGOE91",126,0)
 I MAX<1,$L(X,"-")>1 D EN^DDIOL("This order requires one administration time.") K X Q
"RTN","PSGOE91",127,0)
 I MAX'<1,$L(X,"-")>MAX D EN^DDIOL("The number of admin times entered is greater than indicated by the schedule.") K X Q  ;Too many times
"RTN","PSGOE91",128,0)
 I MAX'<1,$L(X,"-")<MAX D EN^DDIOL("The number of admin times entered is fewer than indicated by the schedule.")  ;Too few times
"RTN","PSGOE91",129,0)
 Q
"RTN","PSGOE91",130,0)
 ;
"RTN","PSGOE91",131,0)
DOSE ;Make certain at least one dose is given.
"RTN","PSGOE91",132,0)
 N INFO,X
"RTN","PSGOE91",133,0)
 S Z="",INFO=($S($G(PSGSD):PSGSD,1:$G(PSGNESD)))_U_($S($G(PSGFD):PSGFD,1:$G(PSGNEFD)))_U_($G(PSGSCH))_U_($G(PSGST))_U_($G(PSGDRG))_U_($G(PSGS0Y))
"RTN","PSGOE91",134,0)
 Q:$G(PSGST)="OC"!($G(PSGST)="P")
"RTN","PSGOE91",135,0)
 I '$L($G(PSGP)) N PSGP S PSGP=""
"RTN","PSGOE91",136,0)
 S Z=$$ENQ^PSJORP2(PSGP,INFO)  ;Expected first dose.
"RTN","PSGOE91",137,0)
 Q
"RTN","PSGOE91",138,0)
 ;*315 New tags
"RTN","PSGOE91",139,0)
PSGDUR ; Prompt for Removal times if admin times are on 24hr rotations and Site Params are enabled.
"RTN","PSGOE91",140,0)
 ; check parameter files for removal criteria quit if removal rotation not enabled (<2)
"RTN","PSGOE91",141,0)
 ; if enabled determine type (hard vers soft stop)
"RTN","PSGOE91",142,0)
 ;0 = no removal (current cap/tab functionality)
"RTN","PSGOE91",143,0)
 ;1 = removal at next admin (current patch functionality)
"RTN","PSGOE91",144,0)
 ;2 = removal prior to next admin; soft stop (pharmacist optional prompt to designate duration of administration
"RTN","PSGOE91",145,0)
 ;3 = removal prior to next admin; hard stop (pharmacist required prompt to designate duration of administration)
"RTN","PSGOE91",146,0)
 ; prompt for removal if = 2 then allow skip, if = 3 then force entry
"RTN","PSGOE91",147,0)
 ;
"RTN","PSGOE91",148,0)
 S PSGRF=$P($G(^PS(50.7,$G(PSGPDRG),4),0),U,1) Q:((PSGRF<2)!($G(PSGST)="O")!($G(PSGST)="P")!($G(PSGST)="OC"))  ; no removal flag or no removal rotation
"RTN","PSGOE91",149,0)
 Q:$G(PSGS0XT)>1440  ; Duration of Administration valid only for 24 hours - subject to change in future.
"RTN","PSGOE91",150,0)
 N RP,PSGIDF,WMSG,PSGDERR S (PSGIDF,PSGDERR)=0 S:$G(PSGDUR)>0 RP=(PSGDUR/60) S:"BID,TID,QID"[$G(PSGSCH) PSGIDF=1  ; Use separate validation for Times per day type orders
"RTN","PSGOE91",151,0)
 S PSGF2=41
"RTN","PSGOE91",152,0)
 W !,"DURATION OF ADMINISTRATION (HRS): "_$S($G(RP):RP_"// ",1:"") R RP:DTIME I RP="^"!'$T W:'$T $C(7) S PSGDUR=$G(PSGDOA),X="^",PSGOEE=0 Q
"RTN","PSGOE91",153,0)
 I RP="" S:$G(PSGDUR)>0 RP=($G(PSGDUR)/60)
"RTN","PSGOE91",154,0)
 I RP="",$G(PSGS0XT)="D",$L(PSGSCH,"@")=2,$P(PSGSCH,"@",2) S (PSGAT,PSGRMVT)=$P(PSGSCH,"@",2) G 8
"RTN","PSGOE91",155,0)
 I RP="@",PSGRF'=3 D DEL G:%'=1 PSGDUR S PSGS0Y="",(PSGDUR,PSGRMVT)="@",PSGRMV=-1 Q
"RTN","PSGOE91",156,0)
 S:(RP'="")&(RP'="@")&(+(RP)<1)&(($E(RP,1))'="?")&(RP'?1N.2N) RP="?" I RP?1."?" D DURHLP^PSGOEM(RP,PSGRF) G PSGDUR
"RTN","PSGOE91",157,0)
 I $E(RP)="^" D FF G:Y>0 @Y G PSGDUR
"RTN","PSGOE91",158,0)
 I (+RP>0),'PSGIDF D  ; exclude BID,TID or QID schedules
"RTN","PSGOE91",159,0)
 . S PSGDUR=(RP*60),PSGRMV=$G(PSGS0XT)-PSGDUR
"RTN","PSGOE91",160,0)
 . I PSGRMV<1 W !,"DURATION OF ADMINISTRATION MATCHES OR EXCEEDS ORDER FREQUENCY" S RP="",PSGDERR=1 K PSGDUR,PSGRMV G PSGDUR Q
"RTN","PSGOE91",161,0)
 .Q
"RTN","PSGOE91",162,0)
 Q:$G(PSGDERR)=1
"RTN","PSGOE91",163,0)
 I PSGRF=3,(+RP<1) W $C(7),!,"ENTRY IS REQUIRED" S RP="" G PSGDUR
"RTN","PSGOE91",164,0)
 I PSGRF=2,(+RP<1) D
"RTN","PSGOE91",165,0)
 . W !,"You have not entered Duration of Administration for this medication order, "
"RTN","PSGOE91",166,0)
 . W !,"therefore the BCMA user will not be prompted to remove the medication prior "
"RTN","PSGOE91",167,0)
 . W !,"to the next Admin Time."
"RTN","PSGOE91",168,0)
 . S PSGRMV=-1,RP=0
"RTN","PSGOE91",169,0)
 .Q
"RTN","PSGOE91",170,0)
 I PSGIDF,(+RP>0) D  ;Only for TPD schedules
"RTN","PSGOE91",171,0)
 . N F,P,PSGARR
"RTN","PSGOE91",172,0)
 . S PSGADT=$S($G(PSGDUR)=-1:X,$G(PSGS0Y):PSGS0Y,$G(PSGAT):PSGAT,1:""),PSGS0Y=PSGADT
"RTN","PSGOE91",173,0)
 . S PSGARR=$L($G(PSGADT),"-")
"RTN","PSGOE91",174,0)
 . F P=1:1:PSGARR D
"RTN","PSGOE91",175,0)
 .. S PSGARR(P)=($P(PSGADT,"-",P)/100) S:(P>1) F(P)=PSGARR(P)-PSGARR(P-1)
"RTN","PSGOE91",176,0)
 .. I $G(F(P)),($G(F(P))'=RP) S WMSG=1_U_"Duration of Administration does not correspond to one or more",WMSG(1)="of this order's scheduled Administration Times!"
"RTN","PSGOE91",177,0)
 ..Q
"RTN","PSGOE91",178,0)
 .Q
"RTN","PSGOE91",179,0)
 S:(+RP>0) PSGDUR=(RP*60)
"RTN","PSGOE91",180,0)
 W:(+RP>0) ?60,RP," HOURS"
"RTN","PSGOE91",181,0)
 D:$G(WMSG) EN^DDIOL($P(WMSG,U,2)),EN^DDIOL(WMSG(1))
"RTN","PSGOE91",182,0)
 Q
"RTN","PSGOE91",183,0)
 ;
"RTN","PSGOE91",184,0)
VERTIMES ; Redisplay Admin and Removal times *315
"RTN","PSGOE91",185,0)
 S PSGRF=$P($G(^PS(50.7,$G(PSGPDRG),4),0),U,1) Q:(PSGRF<2)!($G(PSGST)="O")
"RTN","PSGOE91",186,0)
 N PSGADT,PSGRARR,PSGAARR
"RTN","PSGOE91",187,0)
 ;If we have a frequency and this is odd type order then we need to start calculations with order start time.
"RTN","PSGOE91",188,0)
 I $G(PSGS0XT),$G(PSGNESD),+$G(PSGDUR),$G(PSGAT)="" D  Q
"RTN","PSGOE91",189,0)
 . N L
"RTN","PSGOE91",190,0)
 . S (PSGAARR,PSGRARR)=1,PSGADT=$P($P(PSGNESD,U,1),".",2),L=$L(PSGADT)
"RTN","PSGOE91",191,0)
 . S PSGRARR(1)=(((((PSGADT*60)+PSGDUR)/60)#24)*100) S:PSGRARR(1)=0 PSGRARR(1)=2400 S:$L(PSGRARR(1))=3 PSGRARR(1)="0"_PSGRARR(1)
"RTN","PSGOE91",192,0)
 . S PSGRARR(1)=$E(PSGRARR(1),1,L)_"(R)"
"RTN","PSGOE91",193,0)
 . S PSGAARR(1)=PSGADT,PSGAARR(1)=$E(PSGAARR(1),1,L)_"(A)"
"RTN","PSGOE91",194,0)
  . D WRITE
"RTN","PSGOE91",195,0)
 .Q
"RTN","PSGOE91",196,0)
 ;
"RTN","PSGOE91",197,0)
 S (PSGRARR,PSGAARR)=$S($G(PSGAT):$L(PSGAT,"-"),1:$L(PSGS0Y,"-"))
"RTN","PSGOE91",198,0)
 N P,L
"RTN","PSGOE91",199,0)
 F P=1:1:PSGRARR D
"RTN","PSGOE91",200,0)
 . S PSGADT=$S($G(PSGAT):$P(PSGAT,"-",P),1:$P(PSGS0Y,"-",P)),L=$L(PSGADT)
"RTN","PSGOE91",201,0)
 . S PSGADT=$S($L(PSGADT)=4:PSGADT/100,1:PSGADT*1)
"RTN","PSGOE91",202,0)
 . S PSGRARR(P)=(((((PSGADT*60)+PSGDUR)/60)#24)*100) S:PSGRARR(P)=0 PSGRARR(P)=2400 S:$L(PSGRARR(P))=3 PSGRARR(P)="0"_PSGRARR(P)
"RTN","PSGOE91",203,0)
 . S PSGRARR(P)=$E(PSGRARR(P),1,L)_"(R)"
"RTN","PSGOE91",204,0)
 . S PSGAARR(P)=(PSGADT*100) S:$L(PSGAARR(P))=3 PSGAARR(P)="0"_PSGAARR(P)
"RTN","PSGOE91",205,0)
 . S PSGAARR(P)=$E(PSGAARR(P),1,L)_"(A)"
"RTN","PSGOE91",206,0)
 .Q
"RTN","PSGOE91",207,0)
 D WRITE
"RTN","PSGOE91",208,0)
 Q
"RTN","PSGOE91",209,0)
 ;
"RTN","PSGOE91",210,0)
WRITE ;
"RTN","PSGOE91",211,0)
 W !!,"Verify Admin and removal times",!
"RTN","PSGOE91",212,0)
 W !,"(A)DMINISTRATION -(R)EMOVAL TIMES"
"RTN","PSGOE91",213,0)
 W !,"___________________________________________________________________________",!
"RTN","PSGOE91",214,0)
 F P=1:1:PSGAARR W PSGAARR(P)_"-"_PSGRARR(P)  W:P'=PSGAARR " , "
"RTN","PSGOE91",215,0)
 D ASK
"RTN","PSGOE91",216,0)
 Q
"RTN","PSGOE91",217,0)
 ;
"RTN","PSGOE91",218,0)
ASK ;
"RTN","PSGOE91",219,0)
 N Y
"RTN","PSGOE91",220,0)
 S DIR("A")="Is this correct",DIR(0)="Y" D ^DIR I $D(DUOUT)!$D(DTOUT) W:'$T $C(7) S PSGOEE=0 K PSGDUR G DONE
"RTN","PSGOE91",221,0)
 I 'Y K X S PSGDUR=-1,PSGFOK(8)="" G A41
"RTN","PSGOE91",222,0)
 N P S P=1,PSGRMVT=$P(PSGRARR(P),"(",1)
"RTN","PSGOE91",223,0)
 F  S P=$O(PSGRARR(P)) Q:P=""  D
"RTN","PSGOE91",224,0)
 . S PSGRMVT=PSGRMVT_"-"_$P(PSGRARR(P),"(",1)
"RTN","PSGOE91",225,0)
 .Q
"RTN","PSGOE91",226,0)
 Q
"RTN","PSGOE91",227,0)
 ;
"RTN","PSGOEE")
0^22^B103314834^B101870372
"RTN","PSGOEE",1,0)
PSGOEE ;BIR/CML3 - EDIT ACTIVE OR NON-VERIFIED ORDERS ;8/12/10 5:59pm
"RTN","PSGOEE",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**4,7,29,47,64,58,82,91,110,111,112,142,179,181,254,267,268,281,315**;16 DEC 97;Build 73
"RTN","PSGOEE",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PSGOEE",4,0)
 ;
"RTN","PSGOEE",5,0)
 ; Reference to ^PS(55 is supported by DBIA# 2191.
"RTN","PSGOEE",6,0)
 ; Reference to ^PSSLOCK is supported by DBIA# 2789.
"RTN","PSGOEE",7,0)
 ; Reference to ^TMP("PSODAOC",$J is supported by DBIA# 6071.
"RTN","PSGOEE",8,0)
 ;
"RTN","PSGOEE",9,0)
 D NOW^%DTC S PSGDT=% K PSGEFN,PSGOEEF S PSGOEEF=0 I PSGORD["A"!(PSGORD["O") G ACT
"RTN","PSGOEE",10,0)
531 ; edit orders in 53.1
"RTN","PSGOEE",11,0)
ENF ; Entry point
"RTN","PSGOEE",12,0)
 D EN2^PSGOEEW
"RTN","PSGOEE",13,0)
 K PSJACEPT D EDLOOP G:'$G(PSJACEPT) OUT
"RTN","PSGOEE",14,0)
 I $G(PSGOEENO) D
"RTN","PSGOEE",15,0)
 . N PSGOEENO S PSGOEENO=1 D NEW
"RTN","PSGOEE",16,0)
 E  D
"RTN","PSGOEE",17,0)
 . N PSGOEENO S PSGOEENO=0 D UPD
"RTN","PSGOEE",18,0)
 I $G(PSGOEAV) D ACT1 Q
"RTN","PSGOEE",19,0)
 D DONE1
"RTN","PSGOEE",20,0)
 S PSGOEEF=0,PSJORD=PSGORD D GETUD^PSJLMGUD(PSGP,PSGORD),ENSFE^PSGOEE0(PSGP,PSGORD)
"RTN","PSGOEE",21,0)
 Q
"RTN","PSGOEE",22,0)
ACT ; Perform Edit
"RTN","PSGOEE",23,0)
 NEW PSJALGY1
"RTN","PSGOEE",24,0)
 K PSGOEER
"RTN","PSGOEE",25,0)
 D EN2^PSGOEEW,EDLOOP G:'$G(PSJACEPT) OUT
"RTN","PSGOEE",26,0)
 I $G(PSGOEENO) D
"RTN","PSGOEE",27,0)
 . N PSGOEENO S PSGOEENO=1 D NEW
"RTN","PSGOEE",28,0)
 E  D
"RTN","PSGOEE",29,0)
 . N PSGOEENO S PSGOEENO=0 D UPD
"RTN","PSGOEE",30,0)
 S:$D(PSGOEF)!$G(PSGOEENO) PSGCANFL=-1
"RTN","PSGOEE",31,0)
ACT1 ; Continue editing
"RTN","PSGOEE",32,0)
 D DONE1
"RTN","PSGOEE",33,0)
 S PSGOEEF=0 D GETUD^PSJLMGUD(PSGP,PSGORD),ENSFE^PSGOEE0(PSGP,PSGORD) D:PSGOEAV UNL^PSSLOCK(PSGP,PSGORD)
"RTN","PSGOEE",34,0)
 Q
"RTN","PSGOEE",35,0)
EDIT ; Edit
"RTN","PSGOEE",36,0)
 I $G(Y) D ASKOVR(Y,$G(PSGORD),.PSJSTARI)
"RTN","PSGOEE",37,0)
 D FULL^VALM1
"RTN","PSGOEE",38,0)
 W ! S PSGOEER="" F Q=1:1 S Q1=$P(Y,",",Q) Q:'Q1  S X=$P($T(@(PSGOEEG_Q1)),";",3),PSGOEER=PSGOEER_X_";",PSGOEEF(+X)=Q S:Q1=1 PSJALGY1=1
"RTN","PSGOEE",39,0)
 S LIMIT=$L(PSGOEER,";")-1,(PSGDEF,PSGOEE)=0 F  S PSGOEE=PSGOEE+1 Q:PSGOEE>LIMIT  I +$P(PSGOEER,";",PSGOEE)=101 S PSGDEF=1
"RTN","PSGOEE",40,0)
 S PSGOEER=$E(PSGOEER,1,$L(PSGOEER)-1),(MSG,PSGOEE)=0 F  S PSGOEE=PSGOEE+1 Q:PSGOEE>$L(PSGOEER,";")  S F1=$S(PSGOEEG=3:53.1,1:55.06) I 'PSGDEF!((PSGDEF)&(+$P(PSGOEER,";",PSGOEE)'=2)) D @$P(PSGOEER,";",PSGOEE) Q:'PSGOEE
"RTN","PSGOEE",41,0)
 Q
"RTN","PSGOEE",42,0)
EDLOOP ; Continue prompting for fields to edit.
"RTN","PSGOEE",43,0)
 K PSJNOO
"RTN","PSGOEE",44,0)
 D:$G(Y) EDIT
"RTN","PSGOEE",45,0)
 D ENNOU^PSGOEE0 I '$G(PSGOEENO),DR="" S VALMBCK="R" Q
"RTN","PSGOEE",46,0)
 K VALMSG
"RTN","PSGOEE",47,0)
 I '$G(PSGOEENO),$G(PSGPDNX) D CKDT
"RTN","PSGOEE",48,0)
 I $G(PSGOEENO) D
"RTN","PSGOEE",49,0)
 .S VALMSG="This change will cause a new order to be created." D GTSTATUS,CHKDD,CKDT
"RTN","PSGOEE",50,0)
 .S PSGEBN=$$ENNPN^PSGMI(DUZ),PSGLIN=$$ENDD^PSGMI(PSGDT)_U_$$ENDTC^PSGMI(PSGDT)
"RTN","PSGOEE",51,0)
 D CHK^PSGOEV("^^"_PSGMR_"^^^^"_PSGST,PSGPDRG_U_PSGDO,PSGSCH_U_PSGSD_"^^"_PSGFD)
"RTN","PSGOEE",52,0)
 K VALMBCK,PSJACEPT,PSGPDNX D EN^VALM("PSJU LM ACCEPT") Q:'$G(PSJACEPT)
"RTN","PSGOEE",53,0)
 I $G(PSGS0XT)="D",'$G(PSGS0Y) I ((",P,R,")'[(","_$G(PSGST)_",")) D  Q
"RTN","PSGOEE",54,0)
 .S PSJACEPT=0 W !!,"This is a 'DAY OF THE WEEK' schedule and MUST have admin times." D PAUSE^VALM1
"RTN","PSGOEE",55,0)
 I ($G(PSGOEER)["26^PSGOE9")!($G(PSGOEER)["26^PSGOE8")!($G(PSGOEER)["109^PSGOE9")!($G(PSGOEER)["109^PSGOE8")!($G(PSGOEER)["3^PSGOE9")!($G(PSGOEER)["3^PSGOE8")!($G(PSGOEER)["101^PSGOE9")!($G(PSGOEER)["101^PSGOE8") S PSGOEENO=1
"RTN","PSGOEE",56,0)
 I $G(PSGOEENO)!($G(PSGOEER)["2^PSGOE92")!($G(PSGOEER)["2^PSGOE82") D OC S:($G(PSGOEER)["2^PSGOE82") PSJDSVFY=1
"RTN","PSGOEE",57,0)
 I $G(PSGORQF) S PSJNOO=-1
"RTN","PSGOEE",58,0)
 I '$G(PSJNOO),$G(PSGOEENO) S PSJNOO=$$ENNOO^PSJUTL5("E")
"RTN","PSGOEE",59,0)
 D K1 S PSJACEPT=$S($G(PSJNOO)<0:0,1:1)
"RTN","PSGOEE",60,0)
 S VALMBCK=$S('PSJACEPT:"R",'PSGOEAV:"R",1:"Q")
"RTN","PSGOEE",61,0)
 Q
"RTN","PSGOEE",62,0)
OC ;Perform OC (only when OI or Dosage was edited) & dosing check
"RTN","PSGOEE",63,0)
 NEW PSJDD,PSJALLGY
"RTN","PSGOEE",64,0)
 K PSGORQF
"RTN","PSGOEE",65,0)
 D FULL^VALM1
"RTN","PSGOEE",66,0)
 S PSJDD=+$$DD53P45^PSJMISC() I 'PSJDD S PSGORQF=1 Q
"RTN","PSGOEE",67,0)
 I $G(PSJALGY1)!$G(PSGOEENO) D
"RTN","PSGOEE",68,0)
 . D ENDDC^PSGSICHK(PSGP,PSJDD)
"RTN","PSGOEE",69,0)
 D:'$G(PSGORQF) IN^PSJOCDS($G(PSGORD),"UD",PSJDD)
"RTN","PSGOEE",70,0)
 Q
"RTN","PSGOEE",71,0)
CHKDD ;*** Check inactive Dispense drug within the order.
"RTN","PSGOEE",72,0)
 D CHKDRG^PSGOE2
"RTN","PSGOEE",73,0)
 Q
"RTN","PSGOEE",74,0)
CKDT ; Check if new start/stop dates should be calculated.
"RTN","PSGOEE",75,0)
 S PSGS0Y=$S($D(PSGS0Y):PSGS0Y,1:$G(PSGAT))
"RTN","PSGOEE",76,0)
 ;PSJ*5*179 Recalc start date if Before last given
"RTN","PSGOEE",77,0)
 I ($P($G(PSBSTR),"^")>PSGSD)!('$G(PSGNEWDT)&(PSGSD=$G(PSGOSD))&(PSGFD=$G(PSGOFD)))!($G(PSGOST)'=PSGST)!(PSGSCH'=$G(PSGOSCH))!($G(PSGPDNX)) D
"RTN","PSGOEE",78,0)
 .N PSGOES S PSGOES=1,PSGOFD=PSGFD D ^PSGNE3 I $G(PSGOFD) S PSGNEFD=PSGFD
"RTN","PSGOEE",79,0)
 .S PSGSD=PSGNESD,PSGSDN=$$ENDD^PSGMI(PSGNESD)_U_$$ENDTC^PSGMI(PSGNESD),PSGFD=PSGNEFD,PSGFDN=$$ENDD^PSGMI(PSGNEFD)_U_$$ENDTC^PSGMI(PSGNEFD),PSGNEWDT=1
"RTN","PSGOEE",80,0)
 .I $D(PSGOFD),PSGOFD]"",PSGFD'=PSGOFD S PSGOEEF(25)=1
"RTN","PSGOEE",81,0)
 .I $D(PSGOSD),PSGOSD]"",PSGSD'=PSGOSD S PSGOEEF(10)=1
"RTN","PSGOEE",82,0)
 ;BHW;PSJ*5*179;Add EFD call here, removed from PSGOE91
"RTN","PSGOEE",83,0)
 D EFDACT^PSJUTL
"RTN","PSGOEE",84,0)
 Q
"RTN","PSGOEE",85,0)
NEW3 ;
"RTN","PSGOEE",86,0)
 ;S:PSGOEAV PSGOEAV="0^1"
"RTN","PSGOEE",87,0)
NEW ;
"RTN","PSGOEE",88,0)
 I $D(^PS(53.45,+$G(PSJSYSP),5)) N PSJFSI S PSJFSI=1 D FILESI^PSJBCMA5(DFN,PSGORD) N SIARRAY S SIARRAY="" D
"RTN","PSGOEE",89,0)
 .I PSGORD["P" M SIARRAY=^PS(53.1,+PSGORD,15) D NEWNVAL^PSGAL5(PSGORD,6000,"SPECIAL INSTRUCTIONS",,.SIARRAY)
"RTN","PSGOEE",90,0)
 .I PSGORD["U" M SIARRAY=^PS(55,DFN,5,+PSGORD,15) D NEWUDAL^PSGAL5(PSGORD,6000,"SPECIAL INSTRUCTIONS",,.SIARRAY)
"RTN","PSGOEE",91,0)
 W !,"...discontinuing original order..."
"RTN","PSGOEE",92,0)
 I PSGORD["P" S PSJCOM=+$P($G(^PS(53.1,+PSGORD,.2)),"^",8) I PSJCOM D NEW^PSJCOM1 Q
"RTN","PSGOEE",93,0)
 ;DC and Unlock order.
"RTN","PSGOEE",94,0)
 S PSGEDIT="DE" D ENOR^PSGOECS,UNL^PSSLOCK(PSGP,PSGORD) K PSGEDIT
"RTN","PSGOEE",95,0)
 W !!," ...creating new order..." W:'PSGOEAV "(you will now work on this new order)"
"RTN","PSGOEE",96,0)
 S PSGS0Y=PSGAT,PSGNESD=PSGSD,PSGNEFD=PSGFD,PSGOEPR=PSGPR,PSGPDRG=PSGPD,PSGPDRGN=PSGPDN,PSGOEE="E"
"RTN","PSGOEE",97,0)
 S PSGOORD=PSGORD D ^PSGOETO K PSGOEOS
"RTN","PSGOEE",98,0)
 I PSGOORD["U" S $P(^PS(55,PSGP,5,+PSGOORD,0),"^",26,27)=PSGORD_"^E"
"RTN","PSGOEE",99,0)
 E  S $P(^PS(53.1,+PSGOORD,0),"^",26,27)=PSGORD_"^E"
"RTN","PSGOEE",100,0)
 I $G(PSJFSI) I $$GETSI^PSJBCMA5(DFN,PSGOORD) D FILESI^PSJBCMA5(DFN,PSGORD)
"RTN","PSGOEE",101,0)
 I 'PSGOEAV,($G(PSGORD)["P"),'$G(^PS(53.1,+PSGORD,2.5)),$G(^PS(53.1,+PSGORD,0)) D
"RTN","PSGOEE",102,0)
 . N DUR S DUR=$$GETDUR^PSJLIVMD(PSGP,PSGORD,$S(PSGORD["P":"P",1:5),1) I DUR]"" K DA,DR,DIE S DIE="^PS(53.1,",DA=+PSGORD,DR="116////"_DUR D ^DIE
"RTN","PSGOEE",103,0)
 I PSGOEAV D
"RTN","PSGOEE",104,0)
 . S ^TMP("PSODAOC",$J,"IP IEN")=PSGORD
"RTN","PSGOEE",105,0)
 . D SETOC^PSJNEWOC(PSGORD) ;PSJ*5*281 stores order checks
"RTN","PSGOEE",106,0)
 I PSGOEAV,+PSJSYSU=3,'$D(PSGOES) D EN^PSGPEN(PSGORD),UNL^PSSLOCK(PSGP,PSGORD) Q
"RTN","PSGOEE",107,0)
 S PSJORD=PSGORD,PSGACT=$$ENACTION^PSGOE1(PSGP,PSGORD)
"RTN","PSGOEE",108,0)
 ;K ^TMP("PSODAOC",$J),^TMP("PSJDAOC",$J)
"RTN","PSGOEE",109,0)
 Q
"RTN","PSGOEE",110,0)
UPD ;
"RTN","PSGOEE",111,0)
 K DA W !!,"...updating order..."
"RTN","PSGOEE",112,0)
 I PSGORD["P" S PSJCOM=+$P($G(^PS(53.1,+PSGORD,.2)),"^",8) I PSJCOM D UPD^PSJCOM Q
"RTN","PSGOEE",113,0)
 I $$DIFFSI^PSJBCMA5(DFN,PSGORD) D
"RTN","PSGOEE",114,0)
 .N SIARRAY M:PSGORD["P" SIARRAY=^PS(53.1,+PSGORD,15) M:PSGORD["U" SIARRAY=^PS(55,DFN,5,+PSGORD,15)
"RTN","PSGOEE",115,0)
 .Q:'$D(SIARRAY)
"RTN","PSGOEE",116,0)
 .I PSGORD["P" D NEWNVAL^PSGAL5(PSGORD,6000,"SPECIAL INSTRUCTIONS",,.SIARRAY)
"RTN","PSGOEE",117,0)
 .I PSGORD["U" D NEWUDAL^PSGAL5(DFN,PSGORD,6000,"SPECIAL INSTRUCTIONS",,.SIARRAY)
"RTN","PSGOEE",118,0)
 ; Set trigger for FIELD (12) Dispense Drug to print a updated pick list.
"RTN","PSGOEE",119,0)
 I PSGORD["U",$D(^PS(53.45,PSJSYSP,2,1,0)),$D(^PS(55,PSGP,5,+PSGORD,1,1,0)) D
"RTN","PSGOEE",120,0)
 .N PSJX12,PSJF12 S PSJF12=0
"RTN","PSGOEE",121,0)
 .F PSJX12=0:1 S PSJX12=$O(^PS(53.45,PSJSYSP,2,PSJX12)) Q:+PSJX12=0  S:$G(^PS(53.45,PSJSYSP,2,PSJX12,0))'=$G(^PS(55,PSGP,5,+PSGORD,1,PSJX12,0)) PSJF12=1
"RTN","PSGOEE",122,0)
 .S:PSJF12 ^PS(55,"AUE",PSGP,+PSGORD)=""
"RTN","PSGOEE",123,0)
 N TMP,PSGSIF S TMP=PSGOEENO N PSGOEENO S PSGOEENO=TMP
"RTN","PSGOEE",124,0)
 N II F II=1:1:$L($G(DR),";") I $E($P($G(DR),";",II),1,7)="122////" S PSGSIF=$P(PSGSI,"^",2),PSGSI=$P(PSGSI,"^") Q
"RTN","PSGOEE",125,0)
 I $G(PSJCOM),$G(PSJCOMSI) K PSJCOMSI,^TMP("PSGSI",$J) M ^TMP("PSGSI",$J,5)=^PS(53.45,PSJSYSP,5) D
"RTN","PSGOEE",126,0)
 .D FILESI^PSJBCMA5(DFN,PSGORD)
"RTN","PSGOEE",127,0)
 .N PSJCHILD,PSJOEORD S PSJOEORD=0 F  S PSJOEORD=$O(^PS(55,"ACX",PSJCOM,PSJOEORD)) Q:'PSJOEORD  D
"RTN","PSGOEE",128,0)
 .. S PSJCHILD=0 F  S PSJCHILD=$O(^PS(55,"ACX",PSJCOM,PSJOEORD,PSJCHILD)) Q:'PSJCHILD  D
"RTN","PSGOEE",129,0)
 ... Q:PSJCHILD=PSGORD  N DR,DA,DIE,ORD S DR=$S(PSJCHILD["V":"31////"_$G(P("OPI")),1:"8////"_$G(PSGSI)) S DR=DR_";"_$S(PSJCHILD["V":146,1:122)_"////"_+$G(PSGSIF)
"RTN","PSGOEE",130,0)
 ... I '$D(^PS(53.45,+$G(PSJSYSP),5)) M ^PS(53.45,+$G(PSJSYSP),5)=^TMP("PSGSI",$J,5)
"RTN","PSGOEE",131,0)
 ... D FILESI^PSJBCMA5(DFN,PSJCHILD)
"RTN","PSGOEE",132,0)
 ... ;PSJ*5*179 Comment edits
"RTN","PSGOEE",133,0)
 ... S DR=$TR(DR,"*") I DR'="" S DA=+PSJCHILD,DIE=$S(PSJCHILD["U":"^PS(55,"_PSGP_",5,",1:"^PS(53.1,") S:DIE["^PS(55," DA(1)=PSGP D ^DIE W "." D EN1^PSJHL2(PSGP,"XX",+PSJCHILD_"U")
"RTN","PSGOEE",134,0)
 . K ^TMP("PSGSI",$J)
"RTN","PSGOEE",135,0)
 S DR=$TR(DR,"*") I DR'="" S DA=+PSGORD,DIE=$S(PSGORD["U":"^PS(55,"_PSGP_",5,",1:"^PS(53.1,") S:DIE["^PS(55," DA(1)=PSGP D ^DIE W "."
"RTN","PSGOEE",136,0)
 F Q=1,3 K @(PSGOEEWF_Q_")") S %X="^PS(53.45,"_PSJSYSP_","_$S(Q=1:2,1:1)_",",%Y=PSGOEEWF_Q_"," K @(PSGOEEWF_Q_")") D %XY^%RCR W "."
"RTN","PSGOEE",137,0)
 S $P(@(PSGOEEWF_"1,0)"),"^",2)=$S(PSGORD["U":55.07,1:53.11)_"P"
"RTN","PSGOEE",138,0)
 I $D(^PS(53.45,+$G(PSJSYSP),5)) D FILESI^PSJBCMA5(DFN,PSJORD)
"RTN","PSGOEE",139,0)
 ; Naked reference on the line below refers to full reference using indirection to either ^PS(55 or ^PS(53.1,
"RTN","PSGOEE",140,0)
 S ND=$G(@($S(PSGORD["U":"^PS(55,"_PSGP_",5,",1:"^PS(53.1,")_+PSGORD_",0)")) I $P(ND,"^",21) S ORIFN=$P(ND,"^",21),ND1=$G(^(.2)),ND2=$G(^(2)),ND2P1=$G(^(2.1)) W !,"...updating OE/RR..." D EN1^PSJHL2(PSGP,"XX",PSGORD) ;*315
"RTN","PSGOEE",141,0)
 I $$ENACTION^PSGOE1(PSGP,PSGORD)["V" S VALMBCK="R"
"RTN","PSGOEE",142,0)
 I PSJSYSL,PSJSYSL<3 S $P(@($S(PSGORD["U":"^PS(55,"_PSGP_",5,",1:"^PS(53.1,")_+PSGORD_",7)"),"^",1,2)=PSGDT_"^"_$E("D",PSGOEENO)_"E",PSGTOL=2,PSGUOW=DUZ,PSGTOO=PSGORD'["U"+1,DA=+PSGORD D ENL^PSGVDS
"RTN","PSGOEE",143,0)
 ; **This is where the Automated Dispensing Machine hook is called. Do NOT DELETE or change this location **
"RTN","PSGOEE",144,0)
 D EDIT^PSJADM
"RTN","PSGOEE",145,0)
 ; **END of Interface Hook **
"RTN","PSGOEE",146,0)
 Q
"RTN","PSGOEE",147,0)
OUT ;
"RTN","PSGOEE",148,0)
 D ABORT K PSGNEWDT S PSGCANFL=1 D GETUD^PSJLMGUD(PSGP,PSGORD),ENSFE^PSGOEE0(PSGP,PSGORD),INIT^PSJLMUDE(PSGP,PSGORD)
"RTN","PSGOEE",149,0)
 Q
"RTN","PSGOEE",150,0)
DONE ;
"RTN","PSGOEE",151,0)
 I PSGORD["P",'$D(PSGOEF),PSGSCH]"",$O(^PS(53.1,+PSGORD,1,0)) D ENF^PSGOEE0
"RTN","PSGOEE",152,0)
DONE1 ;
"RTN","PSGOEE",153,0)
 I PSGORD["U" S X=+PSGORD L -^PS(55,PSGP,5,X)
"RTN","PSGOEE",154,0)
 E  L -^PS(53.1,+PSGORD)
"RTN","PSGOEE",155,0)
 K ^PS(53.45,+PSJSYSP,1),^(2),^(5),^(6)
"RTN","PSGOEE",156,0)
 I '$D(PSGOEF) K PSGSD,PSGSCH,PSGST,PSGFD
"RTN","PSGOEE",157,0)
 K DA,DIE,DIR,DP,DR,DRG,ND,ND0,ND1,ND2,ND2P1,ORIFN,PSGAL,PSGALEF,PSGAT,PSGOEE,PSGOEEF,PSGOEEG,PSGOEEWF,PSGEFN,PSGTOL,PSGTOO,PSGUOW,XREF,PSGEFN,PSGMR,PSGMRN,PSGOROE1,PSGPD,PSGPDN,PSGSI,PSGPR,PSGSM,PSGHSM,PSGSTN,PSGSDN,PSGFDN,PSGPRN
"RTN","PSGOEE",158,0)
 K PSGDO,PSGOEENO Q
"RTN","PSGOEE",159,0)
K1 ;
"RTN","PSGOEE",160,0)
 K BACK,F1,F2,PSGF2,MSG,PSGEFN,PSGNEWDT,PSGOEEND,PSGOPD,PSGOPDN,PSGOMR,PSGOMRN,PSGOSCH,PSGOSI,PSGOPR,PSGOSM,PSGOHSM,PSGOSD,PSGOFD,PSGOST,PSGOPRN,PSGOSTN,PSGOSDN,PSGOFDN,PSGODO,PSGPDRG,PSGPDRGN,PSGOEER
"RTN","PSGOEE",161,0)
 Q
"RTN","PSGOEE",162,0)
 ;
"RTN","PSGOEE",163,0)
ABORT ; Display no change message and pause.
"RTN","PSGOEE",164,0)
 D FULL^VALM1
"RTN","PSGOEE",165,0)
 S (PSGDI,PSGDFLG)='$$DDOK^PSGOE2(PSGOEEWF_"1,",+$G(@(PSGOEEWF_".2)")))
"RTN","PSGOEE",166,0)
 S PSGPFLG='$$OIOK^PSGOE2(+$G(@(PSGOEEWF_".2)")))
"RTN","PSGOEE",167,0)
 I '$G(PSJRNFLG) W !!,$C(7),"No changes made to this order." D PAUSE^VALM1  ;if flag set in PSODGAL1, no repeat message
"RTN","PSGOEE",168,0)
 K PSGOEEF S PSGOEEF=0
"RTN","PSGOEE",169,0)
 Q
"RTN","PSGOEE",170,0)
 ;
"RTN","PSGOEE",171,0)
GTSTATUS ; Determine status of new order and set LM title.
"RTN","PSGOEE",172,0)
 S PSGSTAT=$S($P($G(PSJSYSP0),U,9):"ACTIVE",1:"NON-VERIFIED")
"RTN","PSGOEE",173,0)
 S VALM("TITLE")=PSGSTAT_" UNIT DOSE "_$S(PSGSTAT="PENDING":"("_PSGPRIO_")",1:"")
"RTN","PSGOEE",174,0)
 Q
"RTN","PSGOEE",175,0)
 ;
"RTN","PSGOEE",176,0)
ASKOVR(Y,PSJOVRON,PSJSTARI)  ; Check to see if any starred fields are being edited. If so, ask if they wish to view overrides/interventions if they exist
"RTN","PSGOEE",177,0)
 Q:'$D(Y)!$D(PSJSTARI)  N II,I3,YY S YY=$S(Y:Y,1:$TR($P(Y,"^",4),"="))
"RTN","PSGOEE",178,0)
 Q:'YY  S PSJOVRON=$S($G(PSJOVRON):PSJOVRON,1:$G(PSJORD)) Q:'$G(PSJOVRON)
"RTN","PSGOEE",179,0)
 N PSJORD S PSJORD=PSJOVRON
"RTN","PSGOEE",180,0)
 I '$G(PSJSTARI) F II=1:1:$L(YY,",") Q:$G(PSJSTARI)  S I3=$P(YY,",",II) I I3 S:$G(PSGEFN(I3))!($G(PSJSTAR)[("("_I3_")")) PSJSTARI=1
"RTN","PSGOEE",181,0)
 I $G(PSJSTARI) I ($G(PSJORD)&$G(PSGP)) I $$ASKDISP^PSGSICH1 D FULL^VALM1 D OVRDISP^PSGSICH2(PSGP,PSJORD,3)
"RTN","PSGOEE",182,0)
 Q
"RTN","PSGOEE",183,0)
 ;
"RTN","PSGOEE",184,0)
FIELDS ;
"RTN","PSGOEE",185,0)
31 ;;101^PSGOE8;PSGOPD;PSGPD;101;1
"RTN","PSGOEE",186,0)
32 ;;109^PSGOE8;PSGODO;PSGDO;109;PSGODO]""
"RTN","PSGOEE",187,0)
33 ;;10^PSGOE81;PSGOSD;PSGSD;10;0
"RTN","PSGOEE",188,0)
34 ;;3^PSGOE8;PSGOMR;PSGMR;3;1
"RTN","PSGOEE",189,0)
35 ;;25^PSGOE81;PSGOFD;PSGFD;25;0
"RTN","PSGOEE",190,0)
36 ;;7^PSGOE8;PSGOST;PSGST;7;0
"RTN","PSGOEE",191,0)
37 ;;5^PSGOE82;PSGOSM;PSGSM;5;0
"RTN","PSGOEE",192,0)
38 ;;26^PSGOE8;PSGOSCH;PSGSCH;26;1
"RTN","PSGOEE",193,0)
39 ;;39^PSGOE81;PSGOAT;PSGAT;39;0
"RTN","PSGOEE",194,0)
310 ;;1^PSGOE82;PSGOPR;PSGPR;1;1
"RTN","PSGOEE",195,0)
311 ;;8^PSGOE81;PSGOSI;PSGSI;8;0
"RTN","PSGOEE",196,0)
312 ;;2^PSGOE82;;;2;0
"RTN","PSGOEE",197,0)
313 ;;40^PSGOE82;;;40;0
"RTN","PSGOEE",198,0)
51 ;;101^PSGOE9;PSGOPD;PSGPD;101;1
"RTN","PSGOEE",199,0)
52 ;;109^PSGOE9;PSGODO;PSGDO;109;PSGODO]""
"RTN","PSGOEE",200,0)
53 ;;10^PSGOE91;PSGOSD;PSGSD;10;1
"RTN","PSGOEE",201,0)
54 ;;3^PSGOE9;PSGOMR;PSGMR;3;1
"RTN","PSGOEE",202,0)
55 ;;34^PSGOE91;PSGOFD;PSGFD;34;1 
"RTN","PSGOEE",203,0)
56 ;;7^PSGOE9;PSGOST;PSGST;7;0
"RTN","PSGOEE",204,0)
57 ;;5^PSGOE92;PSGOSM;PSGSM;5;0
"RTN","PSGOEE",205,0)
58 ;;26^PSGOE9;PSGOSCH;PSGSCH;26;1
"RTN","PSGOEE",206,0)
59 ;;41^PSGOE91;PSGOAT;PSGAT;41;0
"RTN","PSGOEE",207,0)
510 ;;1^PSGOE92;PSGOPR;PSGPR;1;1
"RTN","PSGOEE",208,0)
511 ;;8^PSGOE91;PSGOSI;PSGSI;8;0
"RTN","PSGOEE",209,0)
512 ;;2^PSGOE92;;;2;0
"RTN","PSGOEE",210,0)
513 ;;15^PSGOE92;;;15;0
"RTN","PSGOEE0")
0^23^B31021765^B28840533
"RTN","PSGOEE0",1,0)
PSGOEE0 ;BIR/CML3-ORDER EDIT UTILITIES ; 10/7/08 11:08am
"RTN","PSGOEE0",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**58,95,179,216,315**;16 DEC 97;Build 73
"RTN","PSGOEE0",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PSGOEE0",4,0)
 ; Reference to ^DICN is supported by DBIA 10009.
"RTN","PSGOEE0",5,0)
 ; Reference to ^DIR is supported by DBIA 10026.
"RTN","PSGOEE0",6,0)
 ;
"RTN","PSGOEE0",7,0)
ENSFE(PSGP,PSGORD) ; Determine editable fields, and fields that cause new order.
"RTN","PSGOEE0",8,0)
 D @$S(PSGORD["P":"ENSFE3^PSGOEE0",1:"ENSFE5^PSGOEE0")
"RTN","PSGOEE0",9,0)
 Q
"RTN","PSGOEE0",10,0)
ENSFE3 ; set-up fields to edit for 53.1
"RTN","PSGOEE0",11,0)
 I PSGSTAT="PENDING" S PSGEFN="1:13" F X=1:1:13 S PSGEFN(+X)=$P($T(@(3_X)),";",7),PSGOEEF(+$P($T(@(3_X)),";",3))="",PSGOEEF=PSGOEEF+1
"RTN","PSGOEE0",12,0)
 E  S PSGEFN="1:13" F X=1,2,3,4,5,6,7,8,9,10,11,12 S Y=$T(@(3_X)),@("PSGEFN("_+X_")="_$S($D(PSGOETOF):0,1:$P(Y,";",7))),PSGOEEF(+$P(Y,";",3))="",PSGOEEF=PSGOEEF+1
"RTN","PSGOEE0",13,0)
 E  S:$P(PSJSYSU,";",3)>1 PSGEFN(9)=0,PSGOEEF(+$P($T(39),";",3))="",PSGOEEF=PSGOEEF+1
"RTN","PSGOEE0",14,0)
 E  I PSGEB'=PSGOPR F X=10,13 S Y=$T(@(3_X)),@("PSGEFN("_X_")="_$S($D(PSGOETOF):0,1:$P(Y,";",7))),PSGOEEF(+$P(Y,";",3))="",PSGOEEF=PSGOEEF+1
"RTN","PSGOEE0",15,0)
 ;*216 highlight if DOSECHK fails
"RTN","PSGOEE0",16,0)
 N PSJDOSE D DOSECHK^PSJDOSE I +$G(PSJDSFLG),'$G(PSGOEEF(109)) S PSGOEEF(109)=1
"RTN","PSGOEE0",17,0)
 K PSGOEEND S PSGOEEG=3,PSGPDRG=PSGOPD,PSGPDRGN=PSGOPDN Q
"RTN","PSGOEE0",18,0)
 ;
"RTN","PSGOEE0",19,0)
ENSFE5 ; set-up fields to edit for 55
"RTN","PSGOEE0",20,0)
 S PSGEFN="1:13"
"RTN","PSGOEE0",21,0)
 F X=1:1:13 S Y=$T(@(5_X)),@("PSGEFN("_+X_")="_$S($D(PSGOETO):0,1:$P(Y,";",7))),PSGOEEF(+$P(Y,";",3))="",PSGOEEF=PSGOEEF+1
"RTN","PSGOEE0",22,0)
 I $P(PSJSYSU,";",3)>1 S PSGEFN(9)=0,PSGOEEF(+$P($T(59),";",3))="",PSGOEEF=PSGOEEF+1
"RTN","PSGOEE0",23,0)
 S PSGPDRG=PSGPD,PSGPDRGN=PSGPDN,PSGOEEND=1,PSGOEEG=5
"RTN","PSGOEE0",24,0)
 ;*216 highlight if DOSECHK fails
"RTN","PSGOEE0",25,0)
 N PSJDOSE D DOSECHK^PSJDOSE I +$G(PSJDSFLG),'$G(PSGOEEF(109)) S PSGOEEF(109)=1
"RTN","PSGOEE0",26,0)
 Q
"RTN","PSGOEE0",27,0)
 ;
"RTN","PSGOEE0",28,0)
ENOK ;
"RTN","PSGOEE0",29,0)
 I $P($G(PSJSYSP0),U,2),'$O(^PS(53.45,+PSJSYSP,2,0)) D
"RTN","PSGOEE0",30,0)
 .W !!,"No dispense drugs found for this order." D ENDRG^PSGOEF1(PSGPD,0) I '$O(^PS(53.45,+PSJSYSP,2,0)) S PSGOEENO=0,DR=""
"RTN","PSGOEE0",31,0)
 W ! I DR="",'PSGOEENO D ABORT^PSGOEE S %=1 Q
"RTN","PSGOEE0",32,0)
 W:PSGOEENO !,"(Accepting these changes will cause a new order to be created.)"
"RTN","PSGOEE0",33,0)
 F  W !!,"ACCEPT THESE CHANGES" S %=1 D YN^DICN Q:%  D  ;
"RTN","PSGOEE0",34,0)
 .W !!?2,"Answer 'YES' (or press RETURN) if you have completed editing this order." W:PSGOEENO !,"Accepting this changes will cause a new order to be created, and this order",!,"will be discontinued."
"RTN","PSGOEE0",35,0)
 .W:$D(PSGOEF) !,"Accepting these changes will convert this order to a non-verifed, Unit Dose",!,"order."
"RTN","PSGOEE0",36,0)
 .W !!,"Answer 'NO' to re-edit this order.  Enter an '^' to abort this edit."
"RTN","PSGOEE0",37,0)
 S PSJNOO=$$ENNOO^PSJUTL5("E")
"RTN","PSGOEE0",38,0)
 K F,F0,F1,F3,PSGDL,PSGDLS,PSGF2,PSGFOK,ND2,PSGOROE1,PSGRO,SDT
"RTN","PSGOEE0",39,0)
 S:PSJNOO<0 (PSGOROE1,PSGOEENO)=0
"RTN","PSGOEE0",40,0)
 Q
"RTN","PSGOEE0",41,0)
 ;
"RTN","PSGOEE0",42,0)
ENNOU ; create new order or update old order
"RTN","PSGOEE0",43,0)
 I $G(MSG) K DIR S DIR(0)="E" W !! D ^DIR
"RTN","PSGOEE0",44,0)
 K DR S DR="",(PSGOEENO,Q)=0
"RTN","PSGOEE0",45,0)
 F  S Q=$O(PSGEFN(Q)) Q:'Q  S Y=$T(@(PSGOEEG_Q)) I $P(Y,";",4)]"",@$P(Y,";",4)'=@$P(Y,";",5) S:PSGEFN(Q) PSGOEENO=1 Q:PSGOEENO  S DR=DR_$P(Y,";",6)_$S(@$P(Y,";",5)]"":"////^S X="_$P(Y,";",5),1:"////@")_";W ""."";"
"RTN","PSGOEE0",46,0)
 I PSGSI="",PSGOSI]"" S DR=DR_"122////@;W ""."";"
"RTN","PSGOEE0",47,0)
 I '$P(PSGSI,"^",2),$P(PSGOSI,"^",2)=1 S DR=DR_"122////@;W ""."";"
"RTN","PSGOEE0",48,0)
 ; PSJ*5*95 quick fix to prevent long string error; true fix in PSJ*5*91 (upd^psgoee)
"RTN","PSGOEE0",49,0)
 I PSGSI]"" S DR=DR_122_"////^S X="_+$P(PSGSI,"^",2)_";" I '$G(PSJLMFIN),'$G(PSGOEENO),$L($G(PSGOSI),"^")>20 S PSGSI=$P(PSGSI,"^")
"RTN","PSGOEE0",50,0)
 I PSGSM,PSGOHSM'=PSGHSM S DR=DR_"6////"_PSGHSM_";W ""."";"
"RTN","PSGOEE0",51,0)
 I +$G(PSGRF)]"" D 
"RTN","PSGOEE0",52,0)
 . S DR=DR_"137////"_$G(PSGDUR)_";138////"_$G(PSGRMVT)_";139////"_$G(PSGRMV)_";140////"_$G(PSGRF) ;*315
"RTN","PSGOEE0",53,0)
 . I $G(PSGAT) N FLD S FLD=$S(PSGORD["P":39,1:41),DR=DR_";"_FLD_"////"_$G(PSGAT) ;If DOA was edited then update the admin time.
"RTN","PSGOEE0",54,0)
 .Q
"RTN","PSGOEE0",55,0)
 ;PSJ*5.0*179
"RTN","PSGOEE0",56,0)
 N P I 'PSGOEENO F P="1^3^10" I $D(PSGEFN($P(P,U,3))) S (Q,QQ)=0 F  S Q=$O(@("^PS(53.45,"_PSJSYSP_","_+P_","_Q_")")) Q:'Q  S QQ=Q,X=$G(^(Q,0)),Y=$G(@(PSGOEEWF_$P(P,U,2)_","_Q_",0)")) I X'=Y S:+P=1 DR=DR_"*" Q
"RTN","PSGOEE0",57,0)
 I 'PSGOEENO F P="1^3^10" I $D(PSGEFN($P(P,U,3))) S (Q,QQ)=0 F  S Q=$O(@(PSGOEEWF_$P(P,U,2)_","_Q_")")) Q:'Q  S QQ=Q,X=$G(^(Q,0)),Y=$G(^PS(53.45,PSJSYSP,+P,Q,0)) I X'=Y S:+P=1 DR=DR_"*" Q
"RTN","PSGOEE0",58,0)
 Q:$S(DR]"":1,1:PSGOEENO)  S (Q,QQ)=0 F  S Q=$O(^PS(53.45,PSJSYSP,2,Q)) Q:'Q  S QQ=Q,X=$G(^(Q,0)),Y=$G(@(PSGOEEWF_"1,"_Q_",0)")) I X'=Y S DR=DR_"*" Q
"RTN","PSGOEE0",59,0)
 Q:$S(DR]"":1,1:PSGOEENO)  S (Q,QQ)=0 F  S Q=$O(@(PSGOEEWF_"1,"_Q_")")) Q:'Q  S QQ=Q,X=$G(^(Q,0)),Y=$G(^PS(53.45,PSJSYSP,2,Q,0)) I X'=Y S DR=DR_"*" Q
"RTN","PSGOEE0",60,0)
 Q
"RTN","PSGOEE0",61,0)
 ;
"RTN","PSGOEE0",62,0)
ENF ; finish order from edit
"RTN","PSGOEE0",63,0)
 F  S %=1 W !!,"Finish this order now" D YN^DICN Q:%  D  ;
"RTN","PSGOEE0",64,0)
 .W !!,"Answer 'YES' to finish this order now.  Finishing the order converts it to a",!,"non-verified Unit Dose order.  Enter 'NO' (or an '^') if you do not want to",!,"finish this order now."
"RTN","PSGOEE0",65,0)
 I %=1 S PSGOEFF=0 D UPD^PSGOEF1 K PSGOEFF,PSGND,PSGSD
"RTN","PSGOEE0",66,0)
 Q
"RTN","PSGOEE0",67,0)
 ;
"RTN","PSGOEE0",68,0)
FIELDS ;
"RTN","PSGOEE0",69,0)
31 ;;108^PSGOE8;PSGOPD;PSGPD;108;1
"RTN","PSGOEE0",70,0)
32 ;;109^PSGOE8;PSGODO;PSGDO;109;1
"RTN","PSGOEE0",71,0)
33 ;;10^PSGOE81;PSGOSD;PSGSD;10;0
"RTN","PSGOEE0",72,0)
34 ;;3^PSGOE8;PSGOMR;PSGMR;3;1
"RTN","PSGOEE0",73,0)
35 ;;25^PSGOE81;PSGOFD;PSGFD;25;0
"RTN","PSGOEE0",74,0)
36 ;;7^PSGOE8;PSGOST;PSGST;7;0
"RTN","PSGOEE0",75,0)
37 ;;5^PSGOE82;PSGOSM;PSGSM;5;0
"RTN","PSGOEE0",76,0)
38 ;;26^PSGOE8;PSGOSCH;PSGSCH;26;1
"RTN","PSGOEE0",77,0)
39 ;;39^PSGOE81;PSGOAT;PSGAT;39;0
"RTN","PSGOEE0",78,0)
310 ;;1^PSGOE82;PSGOPR;PSGPR;1;1
"RTN","PSGOEE0",79,0)
311 ;;8^PSGOE81;PSGOSI;PSGSI;8;0
"RTN","PSGOEE0",80,0)
312 ;;2^PSGOE82;;;2;0
"RTN","PSGOEE0",81,0)
313 ;;66^PSGOE82;;;66;0
"RTN","PSGOEE0",82,0)
314 ;;40^PSGOE82;;;40;0
"RTN","PSGOEE0",83,0)
51 ;;108^PSGOE9;PSGOPD;PSGPD;108;1
"RTN","PSGOEE0",84,0)
52 ;;109^PSGOE9;PSGODO;PSGDO;109;1
"RTN","PSGOEE0",85,0)
53 ;;10^PSGOE91;PSGOSD;PSGSD;10;1
"RTN","PSGOEE0",86,0)
54 ;;3^PSGOE9;PSGOMR;PSGMR;3;1
"RTN","PSGOEE0",87,0)
55 ;;34^PSGOE91;PSGOFD;PSGFD;34;1
"RTN","PSGOEE0",88,0)
56 ;;7^PSGOE9;PSGOST;PSGST;7;0
"RTN","PSGOEE0",89,0)
57 ;;5^PSGOE82;PSGOSM;PSGSM;5;0
"RTN","PSGOEE0",90,0)
58 ;;26^PSGOE9;PSGOSCH;PSGSCH;26;1
"RTN","PSGOEE0",91,0)
59 ;;41^PSGOE91;PSGOAT;PSGAT;41;0
"RTN","PSGOEE0",92,0)
510 ;;1^PSGOE92;PSGOPR;PSGPR;1;1
"RTN","PSGOEE0",93,0)
511 ;;8^PSGOE92;PSGOSI;PSGSI;8;0
"RTN","PSGOEE0",94,0)
512 ;;2^PSGOE92;;;2;0
"RTN","PSGOEE0",95,0)
513 ;;15^PSGOE92;;;15;0
"RTN","PSGOEE0",96,0)
514 ;;72^PSGOE92;;;72;1
"RTN","PSGOEEW")
0^24^B28844185^B28923213
"RTN","PSGOEEW",1,0)
PSGOEEW ;BIR/CML3-SHOW FIELDS FOR EDIT ;15 DEC 97 / 1:29 PM 
"RTN","PSGOEEW",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**7,58,111,315**;16 DEC 97;Build 73
"RTN","PSGOEEW",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PSGOEEW",4,0)
 ; Reference to ^PS(51.2 is supported by DBIA 2178.
"RTN","PSGOEEW",5,0)
 ; Reference to ^PSDRUG( is supported by DBIA 2192.
"RTN","PSGOEEW",6,0)
 ;
"RTN","PSGOEEW",7,0)
EN1 ;
"RTN","PSGOEEW",8,0)
 S PSGORD=^TMP("PSJON",$J,PSGOE2)
"RTN","PSGOEEW",9,0)
 ;
"RTN","PSGOEEW",10,0)
EN2 ;
"RTN","PSGOEEW",11,0)
 N %X,%Y,AT,RT,DO,DRGI,FD,FL,FQC,NF,PRI,SD,SIG,ST,STD,STT,X,Y ;*315
"RTN","PSGOEEW",12,0)
 ;naked references below refer to the full reference in the indirection @(PSGOEEWF_"0")
"RTN","PSGOEEW",13,0)
 S OD=$G(@(PSGOEEWF_"0)")),AT=$G(^(2)),RT=$G(^(2.1)),PSGEB=$P($G(^(4)),"^",7),PSGOSI=$G(^(6)),DO=$G(^(.2)),PSGOINST=$G(^(.3)),PSGOPD=$P(DO,"^"),PSGODO=$P(DO,"^",2) ;*315
"RTN","PSGOEEW",14,0)
 S PSGOPR=$P(OD,"^",2),PSGOMR=$P(OD,"^",3),PSGOSM=$P(OD,"^",5),PSGOHSM=$P(OD,"^",6),(PSGOST,ST)=$P(OD,"^",7),(PSGSTAT,STT)=$P(OD,"^",9),PSGOMRN=$S('PSGOMR:"",1:$P($G(^PS(51.2,PSGOMR,0)),"^")) S:PSGOMRN="" PSGOMRN=PSGOMR
"RTN","PSGOEEW",15,0)
 S PSGLI=$P(OD,U,16),PSGNEDFD=$P($$GTNEDFD^PSGOE7("U",PSGOPD),U),PSGOSCH=$P(AT,"^"),(PSGOSD,SD)=$P(AT,"^",2),(FD,PSGOFD)=$P(AT,"^",4),(FQC,PSGS0XT)=$P(AT,"^",6),(PSGOAT,PSGS0Y)=$P(AT,"^",5)
"RTN","PSGOEEW",16,0)
 S PRI=$S('PSGOPR:0,1:$P($G(^VA(200,PSGOPR,"PS")),"^",4)),DRGI=$S(PSGOPD'=+PSGOPD:0,1:+$G(^PSDRUG(+PSGOPD,"I"))) S:PRI PRI=DT'<PRI S:DRGI DRGI=DT'<DRGI
"RTN","PSGOEEW",17,0)
 S PDRG=PSGOPD,PSGOPDN=$S('PSGOPD:"",1:$$OINAME^PSJLMUTL(+PSGOPD)) S:PSGOPDN="" PSGOPDN=PSGOPD S PSGOPRN=$S('PSGOPR:"",1:$P($G(^VA(200,PSGOPR,0)),"^")) S:PSGOPRN="" PSGOPRN=PSGOPR ; I PSGOSI]"" S PSGOSI=$$ENSET^PSGSICHK(PSGOSI)
"RTN","PSGOEEW",18,0)
 S PSGEBN=$$ENNPN^PSGMI(PSGEB)
"RTN","PSGOEEW",19,0)
 S PSGSTAT=$S(STT="":"NOT FOUND",STT="RE":"REINSTATED",1:$P(STT_"^ACTIVE^DISCONTINUED^EXPIRED^HOLD^INCOMPLETE^NON-VERIFIED^PENDING^RENEWED^UNRELEASED","^",$F("ADEHINPRU",STT)))
"RTN","PSGOEEW",20,0)
 ;
"RTN","PSGOEEW",21,0)
SET ;
"RTN","PSGOEEW",22,0)
 S PSGOSTN=$$ENSTN^PSGMI(ST),(PSGOFDN,PSGOSDN)="" I SD S PSGOSDN=$$ENDD^PSGMI(SD)_"^"_$$ENDTC^PSGMI(SD)
"RTN","PSGOEEW",23,0)
 I FD S PSGOFDN=$$ENDD^PSGMI(FD)_"^"_$$ENDTC^PSGMI(FD)
"RTN","PSGOEEW",24,0)
 F X="PD","PDN","MR","MRN","ST","STN","SCH","SI","SD","SDN","FD","FDN","SM","HSM","PR","PRN","DO","AT" S @("PSG"_X)=@("PSGO"_X)
"RTN","PSGOEEW",25,0)
 K ^PS(53.45,PSJSYSP,1),^(2) S %X=PSGOEEWF_"3,",%Y="^PS(53.45,"_PSJSYSP_",1," D %XY^%RCR S %X=PSGOEEWF_"1,",%Y="^PS(53.45,"_PSJSYSP_",2," D %XY^%RCR
"RTN","PSGOEEW",26,0)
 S $P(^PS(53.45,PSJSYSP,2,0),"^",2)="53.4502P"
"RTN","PSGOEEW",27,0)
 Q
"RTN","PSGOEEW",28,0)
 ;
"RTN","PSGOEEW",29,0)
ENW ;
"RTN","PSGOEEW",30,0)
 N D,ND,Q,QQ
"RTN","PSGOEEW",31,0)
 W:$Y @IOF,! W " Patient: ",$P(PSGP(0),"^")," (",PSJPPID,")",?55,"Ht(cm): " W:PSJPHT["_" PSJPHT W:PSJPHT'["_" $J(PSJPHT,6,2)
"RTN","PSGOEEW",32,0)
 W " ",PSJPHTD,!?4,"Ward: ",PSJPWDN,?55,"Wt(kg): " W:PSJPWT["_" PSJPWT W:PSJPWT'["_" $J(PSJPWT,6,2) W " ",PSJPWTD,!,"Room-Bed: ",PSJPRB
"RTN","PSGOEEW",33,0)
 W !,"Order Status: ",PSGSTAT,?37,"Entered By: ",PSGEBN,!,"--------------------------------------------------------------------------------"
"RTN","PSGOEEW",34,0)
 W !?1,$S($D(PSGEFN(1)):$E(" *",PSGEFN(1)+1)_"(1)",1:"    "),?16,"Drug: ",PSGPDN
"RTN","PSGOEEW",35,0)
 W !?1,$S($D(PSGEFN(2)):$E(" *",PSGEFN(2)+1)_"(2)",1:"    "),?6,"Dosage Ordered: ",PSGDO,?46,$S($D(PSGEFN(12)):$E(" *",PSGEFN(12)+1)_"(12)",1:"     "),"     Start: ",$P(PSGSDN,"^",2)
"RTN","PSGOEEW",36,0)
 W !?1,$S($D(PSGEFN(3)):$E(" *",PSGEFN(3)+1)_"(3)",1:"    "),?11,"Med Route: ",PSGMRN,?46,$S($D(PSGEFN(13)):$E(" *",PSGEFN(13)+1)_"(13)",1:"     "),"      Stop: ",$P(PSGFDN,"^",2)
"RTN","PSGOEEW",37,0)
 W !?1,$S($D(PSGEFN(4)):$E(" *",PSGEFN(4)+1)_"(4)",1:"    "),?7,"Schedule Type: ",PSGSTN,?46,$S($D(PSGEFN(14)):$E(" *",PSGEFN(14)+1)_"(14)",1:"     "),"  Self Med: ",$P("NO^YES","^",PSGSM+1) I PSGSM,PSGHSM W "  (HS)"
"RTN","PSGOEEW",38,0)
 W !?1,$S($D(PSGEFN(5)):$E(" *",PSGEFN(5)+1)_"(5)",1:"    "),?12,"Schedule: ",PSGSCH
"RTN","PSGOEEW",39,0)
 W !?1,$S($D(PSGEFN(6)):$E(" *",PSGEFN(6)+1)_"(6)",1:"    "),?9,"Admin Times: ",PSGAT
"RTN","PSGOEEW",40,0)
 W !?1,$S($D(PSGEFN(7)):$E(" *",PSGEFN(7)+1)_"(7)",1:"    "),?12,"Provider: ",PSGPRN
"RTN","PSGOEEW",41,0)
 W !?1,$S($D(PSGEFN(8)):$E(" *",PSGEFN(8)+1)_"(8)",1:"    ")," Special Instructions: " I PSGSI]"" F Q=1:1:$L(PSGSI," ") S QQ=$P(PSGSI," ",Q) W:$L(QQ)+$X>79 !?28 W QQ," "
"RTN","PSGOEEW",42,0)
 W !!?1,$S($D(PSGEFN(9)):$E(" *",PSGEFN(9)+1)_"(9)",1:"    ")," Dispense Drug",?48,"U/D",?60,"Inactive Date",!,"-------------------------------------------------------------------------------"
"RTN","PSGOEEW",43,0)
 F Q=0:0 S Q=$O(^PS(53.45,PSJSYSP,2,Q)) Q:'Q  S ND=$G(^(Q,0)) D
"RTN","PSGOEEW",44,0)
 .S D=$P(ND,"^"),PSGID=$P(ND,"^",3) I PSGID S PSGID=$$ENDTC^PSGMI(PSGID)
"RTN","PSGOEEW",45,0)
 .S D=$S(D="":"NOT FOUND",'$D(^PSDRUG(D,0)):D,$P(^(0),"^")]"":$P(^(0),"^"),1:D_";PSDRUG(") W !?6,D,?48,$S($P(ND,"^",2):$P(ND,"^",2),1:1) W:PSGID ?60,PSGID
"RTN","PSGOEEW",46,0)
 W !!,$S($D(PSGEFN(10)):$E(" *",PSGEFN(10)+1)_"(10)",1:"     ")," Comments:" F Q=0:0 S Q=$O(^PS(53.45,PSJSYSP,1,Q)) Q:'Q  S Y=" "_$G(^(Q,0)) F Y1=2:1 S Y2=$P(Y," ",Y1) Q:Y2=""  W:$L(Y2)+$X>79 !?2 W " ",Y2
"RTN","PSGOEEW",47,0)
 W !!,$S($D(PSGEFN(11)):$E(" *",PSGEFN(11)+1)_"(11)",1:"     ")," Provider Comments:"
"RTN","PSGOEEW",48,0)
 I $G(PSGORD) D
"RTN","PSGOEEW",49,0)
 .I $D(^PS(53.1,+PSGORD,12,1)) F Q=0:0 S Q=$O(^PS(53.1,+PSGORD,12,Q)) Q:'Q  W !?2,$G(^(Q,0)) Q
"RTN","PSGOEEW",50,0)
 .I $D(^PS(53.1,+PSGORD,6)) W !?2,$G(^(6))
"RTN","PSGOEEW",51,0)
 K Q,Y,Y1,Y2
"RTN","PSGOEEW",52,0)
 Q
"RTN","PSGOEEW",53,0)
 ;
"RTN","PSGOEEW",54,0)
ENKILL ;
"RTN","PSGOEEW",55,0)
 K PSGAT,PSGEB,PSGFD,PSGHSM,PSGNEFD,PSGNESD,PSGOEEF,PSGOEER,PSGOFD,PSGOHSM,PSGOMR,PSGOMRN,PSGOPD,PSGOPDN,PSGOPR,PSGOSCH,PSGOSD,PSGOSM,PSGOST,PSGPD,PSGPDN,PSGPR,PSGSD,PSGSM Q
"RTN","PSGOEEW",56,0)
HILIGHT ; 
"RTN","PSGOEEW",57,0)
 ;         
"RTN","PSGOEEW",58,0)
5 ;;3,46,34
"RTN","PSGOEEW",59,0)
7 ;;4,7,45
"RTN","PSGOEEW",60,0)
8 ;;8,5,80
"RTN","PSGOEEW",61,0)
10 ;;2,46,34
"RTN","PSGOEEW",62,0)
25 ;;3,46,34
"RTN","PSGOEEW",63,0)
26 ;;6,12,56
"RTN","PSGOEEW",64,0)
39 ;;6,9,71
"RTN","PSGOEEW",65,0)
40 ;;
"RTN","PSGOEEW",66,0)
66 ;;9,5,80
"RTN","PSGOEEW",67,0)
101 ;;1,6,74
"RTN","PSGOEEW",68,0)
109 ;;2,6,40
"RTN","PSGOEF")
0^6^B119034802^B103709466
"RTN","PSGOEF",1,0)
PSGOEF ;BIR/CML3 - FINISH ORDERS ENTERED THROUGH OE/RR ;14 May 98  2:17 PM
"RTN","PSGOEF",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**7,30,29,35,39,47,50,56,80,116,110,111,133,153,134,222,113,181,260,199,281,315**;16 DEC 97;Build 73
"RTN","PSGOEF",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PSGOEF",4,0)
 ; Reference to ^PS(55 is supported by DBIA 2191
"RTN","PSGOEF",5,0)
 ; Reference to ^PSDRUG( is supported by DBIA 2192
"RTN","PSGOEF",6,0)
 ; Reference to DOSE^PSSORPH is supported by DBIA 3234.
"RTN","PSGOEF",7,0)
 ; Reference to ^TMP("PSODAOC",$J is supported by DBIA 6071.
"RTN","PSGOEF",8,0)
 ; Reference to FULL^VALM1 is supported by DBIA 10116.
"RTN","PSGOEF",9,0)
 ; Reference to ^PS(50.7 is supported by DBIA# 2180
"RTN","PSGOEF",10,0)
 ;
"RTN","PSGOEF",11,0)
START ;
"RTN","PSGOEF",12,0)
 I '$D(^PS(53.1,+PSGORD)) W $C(7),!?3,"Cannot find this pending order (#",+PSGORD,")." Q
"RTN","PSGOEF",13,0)
 D NOW^%DTC S PSGDT=+$E(%,1,12) K PSGFDX,PSGEFN,PSGOEEF,PSGOES,PSGONF,PSGRDTX S PSGOES=1,(PSGOEF,PSGOEEF)=0,PSGOEEG=3
"RTN","PSGOEF",14,0)
 I $D(PSJTUD) S PSGDO=$P($G(^PS(53.1,+PSGORD,.3)),U),(PSGPDRG,PSGPD)=PSJCOI,(PSGPDRGN,PSGPDN)=$$OINAME^PSJLMUTL(PSGPD)
"RTN","PSGOEF",15,0)
 I $P($G(^PS(53.1,+PSGORD,0)),U,24)'="R" S X=PSGSCH D EN^PSGORS0 D
"RTN","PSGOEF",16,0)
 . S:($D(X)&($P($G(^PS(53.1,+PSGORD,2)),"^",5)="")&($P($G(^PS(53.1,+PSGORD,0)),"^",24)="N")) PSGAT=PSGS0Y
"RTN","PSGOEF",17,0)
 . NEW PSJDOX,PSJDOSE,PSJPIECE,PSJUNIT,PSJX,X
"RTN","PSGOEF",18,0)
 . S X=$G(^PS(53.1,+PSGORD,1,1,0)) Q:'+X
"RTN","PSGOEF",19,0)
 . D DOSE^PSSORPH(.PSJDOX,+X,"U")
"RTN","PSGOEF",20,0)
 . I $S('$D(PSJDOX):1,1:+PSJDOX(1)=-1) Q
"RTN","PSGOEF",21,0)
 . S PSJPIECE=$S($P(PSJDOX(1),U)="":3,1:1)
"RTN","PSGOEF",22,0)
 . S X=^PS(53.1,+PSGORD,.2)
"RTN","PSGOEF",23,0)
 . S:PSJPIECE=3 PSJDOSE=$P(X,U,2)
"RTN","PSGOEF",24,0)
 . S:PSJPIECE=1 PSJDOSE=$P(X,U,5),PSJUNIT=$P(X,U,6)
"RTN","PSGOEF",25,0)
 . F X=0:0 S X=$O(PSJDOX(X)) Q:+$G(PSJX)!'X  D
"RTN","PSGOEF",26,0)
 .. I PSJPIECE=3,($P(PSJDOX(X),U,3)'=PSJDOSE) Q
"RTN","PSGOEF",27,0)
 .. I PSJPIECE=1,($P(PSJDOX(X),U,1)_$P(PSJDOX(X),U,2)'=(PSJDOSE_PSJUNIT)) Q
"RTN","PSGOEF",28,0)
 .. S:+$P(PSJDOX(X),U,12) $P(^PS(53.45,PSJSYSP,2,1,0),U,2)=+$P(PSJDOX(X),U,12),PSJX=1
"RTN","PSGOEF",29,0)
 I PSGEB'=PSGOPR F X=7,11 S Y=$T(@(3_X)),@("PSGEFN("_X_")="_$P(Y,";",7)),PSGOEEF(+$P(Y,";",3))="",PSGOEEF=PSGOEEF+1
"RTN","PSGOEF",30,0)
 D GTST^PSGOE6(+PSGORD)
"RTN","PSGOEF",31,0)
 I $P($G(^PS(53.1,+PSGORD,0)),U,24)'="R" S PSGSD="" D:PSGS0Y]""
"RTN","PSGOEF",32,0)
 .N PSJX S PSJX=$P($G(^PS(53.1,+PSGORD,0)),U,25) I PSJX="" Q
"RTN","PSGOEF",33,0)
 .I PSJX["U" S PSGSD=$P($G(^PS(55,DFN,5,+PSJX,2)),U,2) Q
"RTN","PSGOEF",34,0)
 .I PSJX["V" S PSGSD=$P($G(^PS(55,DFN,"IV",+PSJX,0)),U,2) Q
"RTN","PSGOEF",35,0)
 .I PSJX["P" S PSGSD=$P($G(^PS(53.1,+PSJX,2)),U,2)
"RTN","PSGOEF",36,0)
 S:PSGSD="" PSGSD=PSGLI
"RTN","PSGOEF",37,0)
 S PSGNEDFD=$$GTNEDFD^PSGOE7("U",+PSGPD)
"RTN","PSGOEF",38,0)
 S:$P($G(PSGNEDFD),U,3)="" $P(PSGNEDFD,U,3)=PSGST  ; N PSGOEA S PSGOEA="R"
"RTN","PSGOEF",39,0)
 S (PSGNESD,PSGSD)=$$ENSD^PSGNE3(PSGSCH,PSGS0Y,PSGLI,PSGSD)
"RTN","PSGOEF",40,0)
 ;if this is a renewal order, ignore any 'requested start date' received.  Use the system calculated start date.
"RTN","PSGOEF",41,0)
 I $P($G(^PS(53.1,+PSGORD,0)),U,24)'="R" D
"RTN","PSGOEF",42,0)
 . D REQDT^PSJLIVMD(PSGORD)
"RTN","PSGOEF",43,0)
 E  D
"RTN","PSGOEF",44,0)
 . S X=$$DSTART^PSJDCU(DFN,$P(^PS(53.1,+PSGORD,0),U,25)) I X]"" S (PSGNESD,PSGSD)=X K PSGRSD
"RTN","PSGOEF",45,0)
 D   ; Extend the Default Stop Date if needed for the first renewed order.
"RTN","PSGOEF",46,0)
 .N PSGOEAO,PSGWALLO
"RTN","PSGOEF",47,0)
 .I $P($G(^PS(53.1,+PSGORD,0)),U,24)="R" S PSGOEAO=PSGOEA,PSGOEA="R",PSGWALLO=$P(^PS(55,DFN,5.1),U)
"RTN","PSGOEF",48,0)
 .D ENFD^PSGNE3(PSGLI) S PSGFD=$S($G(PSGRDTX(+PSGORD,"PSGFD")):PSGRDTX(+PSGORD,"PSGFD"),1:PSGNEFD)
"RTN","PSGOEF",49,0)
 .I $P($G(^PS(53.1,+PSGORD,0)),U,24)="R" S PSGOEA=PSGOEAO,$P(^PS(55,DFN,5.1),U)=PSGWALLO
"RTN","PSGOEF",50,0)
 N DUR,PSGRNSD S PSGRNSD=+$$LASTREN^PSJLMPRI(DFN,PSGORD) I PSGRNSD S DUR=$$GETDUR^PSJLIVMD(DFN,PSGORD,"P",1) I DUR]"" D
"RTN","PSGOEF",51,0)
 . N DURMIN S DURMIN=$$DURMIN^PSJLIVMD(DUR) I DURMIN S PSGFD=$$FMADD^XLFDT(PSGRNSD,,,DURMIN)
"RTN","PSGOEF",52,0)
 S PSGOFD="",PSGSDN=$$ENDD^PSGMI(PSGSD)_U_$$ENDTC^PSGMI(PSGSD),PSGFDN=$$ENDD^PSGMI(PSGFD)_U_$$ENDTC^PSGMI(PSGFD)
"RTN","PSGOEF",53,0)
 S PSGLIN=$$ENDD^PSGMI(PSGLI)_U_$$ENDTC^PSGMI(PSGLI)
"RTN","PSGOEF",54,0)
 I '$O(^PS(53.45,PSJSYSP,2,0)) N DRG,DRGCNT S DRGCNT=0 D
"RTN","PSGOEF",55,0)
 .F X=0:0 S X=$O(^PSDRUG("ASP",+PSGPD,X)) Q:'X!(DRGCNT>1)  S:$P($G(^PSDRUG(+X,2)),U,3)["U" DRGCNT=DRGCNT+1,DRG=+X
"RTN","PSGOEF",56,0)
 .I DRGCNT=1 K ^PS(53.45,PSJSYSP,2) S ^PS(53.45,PSJSYSP,2,1,0)=DRG_U_1,^PS(53.45,PSJSYSP,2,0)="^53.4502^1^1",PS(53.45,PSJSYSP,2,"B",+DRG,1)=""
"RTN","PSGOEF",57,0)
 Q
"RTN","PSGOEF",58,0)
FINISH ;
"RTN","PSGOEF",59,0)
 ; force display of second screen if CPRS order checks exist
"RTN","PSGOEF",60,0)
 N NSFF,PSGOEF39,PSGEDTOI S NSFF=1 K PSJNSS,PSGEDTOI,PSGOEER,ZZND
"RTN","PSGOEF",61,0)
 N PSJRMABT
"RTN","PSGOEF",62,0)
 I $G(PSGORD),$D(PSGRDTX(+PSGORD)) D  K PSGRDTX
"RTN","PSGOEF",63,0)
 . ;PSJOCDSC stores the default start & stop date ^ cal start & stop date (use in dosing calculation for duration)
"RTN","PSGOEF",64,0)
 . ;for some reasons PSGSD & PSGFD are reset to the cal dates if order has duration defined
"RTN","PSGOEF",65,0)
 . S PSJOCDSC("CX","PSGSD",+PSGORD)=$G(PSGSD)_U_$G(PSGRDTX(+PSGORD,"PSGRSD"))
"RTN","PSGOEF",66,0)
 . S PSJOCDSC("CX","PSGFD",+PSGORD)=$G(PSGFD)_U_$G(PSGRDTX(+PSGORD,"PSGRFD"))
"RTN","PSGOEF",67,0)
 . S:$G(PSGRDTX(+PSGORD,"PSGRSD")) PSGSD=PSGRDTX(+PSGORD,"PSGRSD")
"RTN","PSGOEF",68,0)
 . S:$G(PSGRDTX(+PSGORD,"PSGRFD")) PSGFD=$S($G(PSGRDTX(+PSGORD,"PSGRFD")):PSGRDTX(+PSGORD,"PSGRFD"),1:$G(PSGNEFD))
"RTN","PSGOEF",69,0)
 N PSJCOM S PSJCOM=+$P($G(^PS(53.1,+PSGORD,.2)),"^",8)
"RTN","PSGOEF",70,0)
 ; 
"RTN","PSGOEF",71,0)
 ; PSJ*5*222
"RTN","PSGOEF",72,0)
 ; PSJCT1 is a counter variable.  Every piece of a complex order calls PSGOEF.
"RTN","PSGOEF",73,0)
 ; The only time this code is to look for overlapping admin times is when the
"RTN","PSGOEF",74,0)
 ; first part of a complex order is being finished.  This variable will keep track
"RTN","PSGOEF",75,0)
 ; of how many "parts" of the complex order have been checked.
"RTN","PSGOEF",76,0)
 ; 
"RTN","PSGOEF",77,0)
 ; Also, since the user can select multiple complex orders to finish, like selecting
"RTN","PSGOEF",78,0)
 ; orders 1-2 or 1-3 from the profile, PSJCT1A will keep track of whether the parent
"RTN","PSGOEF",79,0)
 ; order number is the same as the first parent order number selected for finishing.
"RTN","PSGOEF",80,0)
 ; Since the PSJCT1 counter variable will still be set if multiple complex orders
"RTN","PSGOEF",81,0)
 ; are selected, PSJCT1 will be re-set to 1 if the parent complex order number (PSJCT1A) is
"RTN","PSGOEF",82,0)
 ; not equal to the original parent order number (PSJCOM).
"RTN","PSGOEF",83,0)
 ; 
"RTN","PSGOEF",84,0)
 S PSJCT1=$G(PSJCT1)+1
"RTN","PSGOEF",85,0)
 I PSJCT1=1 S PSJCT1A=PSJCOM
"RTN","PSGOEF",86,0)
 I $G(PSJCT1A)'=PSJCOM S PSJCT1=1,PSJCT1A=PSJCOM
"RTN","PSGOEF",87,0)
 ; End of flag setting for PSJ*5*222
"RTN","PSGOEF",88,0)
 D FULL^VALM1
"RTN","PSGOEF",89,0)
 I '$D(IOINORM)!('$D(IOINHI)) S X="IORVOFF;IORVON;IOINHI;IOINORM" D ENDR^%ZISS
"RTN","PSGOEF",90,0)
 I $G(PSJCOM)'="",$G(PSJCT1)=1 D
"RTN","PSGOEF",91,0)
 . D OVERLAP^PSGOEF2 I $G(PSJOVRLP)=1 D
"RTN","PSGOEF",92,0)
 . . N X,X1,DIR
"RTN","PSGOEF",93,0)
 . . W !!,"**WARNING**"
"RTN","PSGOEF",94,0)
 . . W !,"The highlighted admin times for these portions of this complex order overlap.",!!
"RTN","PSGOEF",95,0)
 . . S (X,X1)="" F  S X=$O(^TMP("PSJATOVR",$J,X)) Q:X=""  D
"RTN","PSGOEF",96,0)
 . . . S X1=$G(^TMP("PSJATOVR",$J,X))
"RTN","PSGOEF",97,0)
 . . . W $S($P(X1,"^",4)=1:IORVON,1:""),"Part "_X,IORVOFF," has a schedule of "_$P(X1,"^",2)_" and admin time(s) of "
"RTN","PSGOEF",98,0)
 . . . W $S($P(X1,"^",4)=1:IORVON,1:""),$P(X1,"^",3),IORVOFF
"RTN","PSGOEF",99,0)
 . . . W !
"RTN","PSGOEF",100,0)
 . . . W $S($G(PSJOVR("CONJ",X))="A":"AND",$G(PSJOVR("CONJ",X))="T":"THEN",1:""),!
"RTN","PSGOEF",101,0)
 . . W !,"Please ensure the schedules and administration times are appropriate.",!
"RTN","PSGOEF",102,0)
 . . S DIR(0)="EA",DIR("A")="Press Return to continue..." D ^DIR W !
"RTN","PSGOEF",103,0)
 K ^TMP("PSJATOVR",$J)
"RTN","PSGOEF",104,0)
 I $G(PSJPROT)=3,'$D(PSJTUD),'$$ENIVUD^PSGOEF1(PSGORD) Q
"RTN","PSGOEF",105,0)
 I $G(PSGOSCH)]"" D  S:$G(PSGS0XT)'="" $P(^PS(53.1,+PSGORD,2),"^",6)=PSGS0XT
"RTN","PSGOEF",106,0)
 .N PSGOES,PSGS0Y,PSGSCH S X=PSGOSCH K:$G(PSJTUD) NSFF D ENOS^PSGS0
"RTN","PSGOEF",107,0)
 .I '($G(PSGORD)["P"&($P($G(^PS(53.1,+PSGORD,0)),"^",24)="R")) I $G(X)]""&$G(PSGS0Y) S:$G(PSGAT)="" PSGAT=PSGS0Y
"RTN","PSGOEF",108,0)
 .I $G(PSJNSS) S PSGOSCH="" K PSJNSS
"RTN","PSGOEF",109,0)
 .I $G(PSGORD)["P",$G(PSGAT),$G(PSGS0Y),($G(PSGOSCH)]"") I PSGAT'=PSGS0Y D
"RTN","PSGOEF",110,0)
 ..S PSGNSTAT=1 W $C(7),!!,"PLEASE NOTE:  This order's admin times (",PSGAT,")"
"RTN","PSGOEF",111,0)
 ..W !?13," do not match the ward times (",PSGS0Y,")"
"RTN","PSGOEF",112,0)
 ..W !?13," for this administration schedule (",PSGOSCH,")",!
"RTN","PSGOEF",113,0)
 ..S DIR(0)="EA",DIR("A")="Press Return to continue..." D ^DIR K DIR  W !
"RTN","PSGOEF",114,0)
 I $G(PSGS0XT)="" S $P(^PS(53.1,+PSGORD,2),"^",6)=$S($P($G(ZZND),"^",3)'="":$P(ZZND,"^",3),1:"")
"RTN","PSGOEF",115,0)
 S CHK=0 S:$P($G(^PS(53.1,+PSGORD,0)),U,24)'="R" PSGSI=$$ENPC^PSJUTL("U",+PSJSYSP,180,PSGSI)
"RTN","PSGOEF",116,0)
 I '$G(PSJTUD),$G(PSJNSS),($G(PSGOSCH)]"") D NSSCONT^PSGS0(PSGOSCH,PSGS0XT) K PSJNSS S PSGOSCH=""
"RTN","PSGOEF",117,0)
 S PSGOEFF=PSGOSCH=""+('$O(^PS(53.45,PSJSYSP,2,0))*10)
"RTN","PSGOEF",118,0)
 I PSGOEFF S X=$S(PSGOEFF#2:" a SCHEDULE",1:"")_$S(PSGOEFF=11:" and",1:"")_$S(PSGOEFF>9:" at least one DISPENSE DRUG",1:"")
"RTN","PSGOEF",119,0)
 I 'PSGOEFF I (($G(PSGS0XT)="D")&($G(PSGAT)="")) S X=" Admin Times",PSGOEFF=1,PSGOEF39=1
"RTN","PSGOEF",120,0)
 ; *315 DRP If removal flag in 50.7 is a 2 or a 3 then order must be reviewed and removal times entered if required.
"RTN","PSGOEF",121,0)
 S PSGRF=$P($G(^PS(50.7,$G(PSGPDRG),4),0),U,1)
"RTN","PSGOEF",122,0)
 I +$G(PSGRF),$G(PSGDUR)="",'$G(PSGRMV),$D(^PS(51.1,"AC","PSJ",$G(PSGOSCH))) S PSJRMABT=0 D  I $G(PSJRMABT) D ABORTACC Q  ; Abort Finish process if no Stop Date entered ($G(PSJRMABT)) 
"RTN","PSGOEF",123,0)
 . N PSGTMPST S PSGTMPST=$S($G(PSGST)="R":$P($G(^PS(51.1,$O(^PS(51.1,"AC","PSJ",PSGOSCH,"")),0)),"^",5),1:$G(PSGST)) ;Handle "Fill on Request"
"RTN","PSGOEF",124,0)
 . I ($G(PSGTMPST)'="O"),($G(PSGTMPST)'="P"),($G(PSGTMPST)'="OC"),+$G(PSGRF)>1 S X="",PSGOEFF=1,PSGOEF39=1
"RTN","PSGOEF",125,0)
 . I $G(PSGTMPST)="O" S (PSGFDN,PSGFD)="" D 
"RTN","PSGOEF",126,0)
 .. S F1=53.1,MSG=0,Y=$T(35),@("PSGFN(35)="_$P(Y,";",7)),PSGOEEF(+$P(Y,";",3))=1,(PSGOEE,PSGOEEF)=1 W ! D @$P($T(35),";",3) S CHK=0 I 'PSGOEE S PSJRMABT=1
"RTN","PSGOEF",127,0)
 .. W:PSJRMABT $C(7),!!,"INVALID STOP DATE"  S DIR(0)="EA",DIR("A")="Press Return to continue..." D ^DIR K DIR  W !
"RTN","PSGOEF",128,0)
 ..Q
"RTN","PSGOEF",129,0)
 .Q
"RTN","PSGOEF",130,0)
 ;
"RTN","PSGOEF",131,0)
 I PSGOEFF,X]"" S X=X_" before it can be finished."
"RTN","PSGOEF",132,0)
 I PSGOEFF,X]"" S CHK=1 W $C(7),!!,"PLEASE NOTE: This order must have" F Q=1:1:$L(X," ") S Y=$P(X," ",Q) W:$L(Y)+$X>78 ! W Y," "
"RTN","PSGOEF",133,0)
 I $G(PSGOEF39) S PSGOEE=0,PSGOEFF=0 D  I 'PSGOEE D REFRESH^VALM G DONE
"RTN","PSGOEF",134,0)
 .S F1=53.1,MSG=0,Y=$T(39),@("PSGFN(39)="_$P(Y,";",7)),PSGOEEF(+$P(Y,";",3))=1,(PSGOEEF,PSGOEE)=1 W ! D @$P($T(39),";",3) S CHK=0
"RTN","PSGOEF",135,0)
 .I $G(PSGRMVT),'PSGOEE D INIT^PSJLMUDE($G(PSGP),$G(PSGORD)) ;*315 IF REMOVE TIME SET THEN REDISPLAY DETAIL
"RTN","PSGOEF",136,0)
 .Q
"RTN","PSGOEF",137,0)
 I PSGOEFF=1 S F1=53.1,MSG=0,Y=$T(38),@("PSGFN(38)="_$P(Y,";",7)),PSGOEEF(+$P(Y,";",3))=1,(PSGOEE,PSGOEEF)=1 W ! D @$P($T(38),";",3) S CHK=0 G:'PSGOEE DONE
"RTN","PSGOEF",138,0)
 I PSGOEFF=11 S F1=53.1,MSG=0,Y=$T(32),@("PSGFN(32)="_$P(Y,";",7)),PSGOEEF(+$P(Y,";",3))=1,(PSGOEE,PSGOEEF)=1 W ! D @$P($T(32),";",3) D  G:'PSGOEE DONE
"RTN","PSGOEF",139,0)
 .S F1=53.1,MSG=0,Y=$T(38),@("PSGFN(38)="_$P(Y,";",7)),PSGOEEF(+$P(Y,";",3))=1,(PSGOEE,PSGOEEF)=1 W ! D @$P($T(38),";",3) S CHK=0
"RTN","PSGOEF",140,0)
 I PSGOEFF>9 S CHK=7 D ENDRG^PSGOEF1(+PSGPD,0) I CHK D ABORTACC Q
"RTN","PSGOEF",141,0)
 I 'PSGOEFF D OC531^PSGOESF ; check every dispense drug from CPRS
"RTN","PSGOEF",142,0)
 S VALMBG=1
"RTN","PSGOEF",143,0)
 I 'PSGOEFF&($D(PSGORQF)) D RE^VALM4 Q
"RTN","PSGOEF",144,0)
 I $G(MSG) K DIR S DIR(0)="E" W !! D ^DIR
"RTN","PSGOEF",145,0)
 I PSGOEFF D:PSGST="" GTST^PSGOE6(+PSGORD)
"RTN","PSGOEF",146,0)
 S PSJLMFIN=1
"RTN","PSGOEF",147,0)
 K PSJACEPT I $O(^PS(53.1,+PSGORD,12,0)) S PSJLMP2=1
"RTN","PSGOEF",148,0)
 S PSGOEENO=0,PSGSTAT=$S($P(PSJSYSP0,U,9):"ACTIVE",1:"NON-VERIFIED")
"RTN","PSGOEF",149,0)
 NEW PSJDOSE,PSJDOX,PSJDSFLG
"RTN","PSGOEF",150,0)
 D DOSECHK^PSJDOSE
"RTN","PSGOEF",151,0)
 S:+$G(PSJDSFLG) VALMSG="Dosage Ordered & Dispense Drug are not compatible"
"RTN","PSGOEF",152,0)
 I PSGODO=PSGDO S PSGOEEF(109)=""
"RTN","PSGOEF",153,0)
 I PSGODO'=PSGDO S PSGOEENO=1,VALMSG="This change will cause a new order to be created  "
"RTN","PSGOEF",154,0)
 D EN^VALM("PSJU LM ACCEPT")
"RTN","PSGOEF",155,0)
 I $G(PSJNSS) D  S PSGOEEF(26)="" K PSJACEPT,PSJNSS
"RTN","PSGOEF",156,0)
 .K DIR S DIR(0)="FOA",DIR("A")="Invalid Schedule" D ^DIR K DIR
"RTN","PSGOEF",157,0)
 I $G(PSGS0XT)="D",'$G(PSGS0Y),'$G(PSGAT),((",P,R,")'[(","_$G(PSGST)_",")) D  S PSGOEEF(39)="" K PSJACEPT
"RTN","PSGOEF",158,0)
 .K DIR S DIR(0)="FOA",DIR("A")="   WARNING - Admin times are required for DAY OF WEEK schedules  " D ^DIR K DIR
"RTN","PSGOEF",159,0)
 ;***PSJ*5*113
"RTN","PSGOEF",160,0)
 I $G(PSGAT)="",(PSGST="C"!(PSGST="R")) D
"RTN","PSGOEF",161,0)
 .I $G(PSGS0XT) Q:$$ODD^PSGS0(PSGS0XT)
"RTN","PSGOEF",162,0)
 .Q:$$PRNOK^PSGS0($G(PSGSCH))
"RTN","PSGOEF",163,0)
 .Q:($P($G(ZZND),"^",5)'="C")
"RTN","PSGOEF",164,0)
 .K PSJACEPT
"RTN","PSGOEF",165,0)
 .K DIR S DIR(0)="FOA",DIR("A")="  WARNING - Admin times are required for CONTINUOUS orders " D ^DIR K DIR
"RTN","PSGOEF",166,0)
 ;***
"RTN","PSGOEF",167,0)
 I '$G(PSJACEPT) D ABORTACC Q
"RTN","PSGOEF",168,0)
 I $G(PSJRNF),$G(^PS(53.1,+PSGORD,4)) D
"RTN","PSGOEF",169,0)
 . W $C(7),!!,"ACCEPTING THIS ORDER WILL CHANGE THE STATUS TO ACTIVE."
"RTN","PSGOEF",170,0)
 . S DIR(0)="Y",DIR("A")="Do you wish to make this order Active",DIR("?",1)="Enter ""N"" if you wish to exit without Activating this order,"
"RTN","PSGOEF",171,0)
 . S DIR("?")="or ""Y"" to continue with the Activation process." D ^DIR S:'Y Y=-1 K DIR
"RTN","PSGOEF",172,0)
 I $G(PSJRNF),$G(Y)=-1 S PSJACEPT=0 D ABORTACC Q
"RTN","PSGOEF",173,0)
 I $G(PSJRNF),$G(Y)=1 S PSGOEAV=1
"RTN","PSGOEF",174,0)
 I $G(PSGEDTOI) D OC^PSJOE1
"RTN","PSGOEF",175,0)
 I $S($G(PSGORQF):0,$G(PSGEDTOI):0,$G(PSGOEER)["109^PSGOE8":1,$G(PSGOEER)["3^PSGOE8":1,$G(PSGOEER)["26^PSGOE8":1,$G(PSGOEER)["10^PSGOE81":1,$G(PSGOEER)["25^PSGOE81":1,1:0) D
"RTN","PSGOEF",176,0)
 . NEW PSJDD S PSJDD=+$$DD53P45^PSJMISC()
"RTN","PSGOEF",177,0)
 . D:$G(PSJDD) IN^PSJOCDS($G(PSGORD),"UD",PSJDD)
"RTN","PSGOEF",178,0)
 I $G(PSGORQF) S PSGOEENO=0,PSJACEPT=0
"RTN","PSGOEF",179,0)
 I PSGOEENO S PSJNOO=$$ENNOO^PSJUTL5("E"),PSJACEPT=$S(PSJNOO<0:0,1:1)
"RTN","PSGOEF",180,0)
ACCEPT ;
"RTN","PSGOEF",181,0)
 N PSGUDFIN S PSGUDFIN=1
"RTN","PSGOEF",182,0)
 S VALMBCK=$S($G(PSJACEPT):"Q",1:"R")
"RTN","PSGOEF",183,0)
 I '$G(PSJACEPT) D ABORTACC Q
"RTN","PSGOEF",184,0)
 K PSGOES,PSGRSD,PSGRSDN D:PSGOEENO NEW3^PSGOEE D:'PSGOEENO UPD^PSGOEF1 I $D(PSGOEF)!PSGOEENO S PSGCANFL=-1
"RTN","PSGOEF",185,0)
 ;saves drug allergy signs/symptoms PSJ*5*260
"RTN","PSGOEF",186,0)
 I $D(^TMP("PSODAOC",$J,"ALLERGY")) D
"RTN","PSGOEF",187,0)
 .N DA,OCCDT,ORN,ORL,Z,RET,PSJDAOC
"RTN","PSGOEF",188,0)
 .S PSJDAOC="IP "_$S($G(PSGORD)["P":"Pending/Non-Verified",$G(PSGORD)["U":"Unit Dose",$G(PSGORD)["V":"IV",1:"")_" Allergy",OCCDT=$$NOW^XLFDT
"RTN","PSGOEF",189,0)
 .I PSGORD["P" S ORN=$P(^PS(53.1,+PSGORD,0),U,21)
"RTN","PSGOEF",190,0)
 .I PSGORD["U" S ORN=$P(^PS(55,DFN,5,+PSGORD,0),U,21)
"RTN","PSGOEF",191,0)
 .I PSGORD["V" S ORN=$P(^PS(55,DFN,"IV",+PSGORD,0),U,21)
"RTN","PSGOEF",192,0)
 .Q:'$G(ORN)
"RTN","PSGOEF",193,0)
 . S PSJAGYSV=1 ;use in ^PSJOE to store allergy (also clean up this var)
"RTN","PSGOEF",194,0)
 .;D SETOC^PSJNEWOC(PSGORD) ;set order checks in 100.05
"RTN","PSGOEF",195,0)
 .;K ^TMP("PSODAOC",$J),^TMP("PSJDAOC",$J)
"RTN","PSGOEF",196,0)
 D DONE1^PSGOEE
"RTN","PSGOEF",197,0)
 D DONE
"RTN","PSGOEF",198,0)
 Q
"RTN","PSGOEF",199,0)
BYPASS ;
"RTN","PSGOEF",200,0)
 S PSGCANFL=1
"RTN","PSGOEF",201,0)
 ;
"RTN","PSGOEF",202,0)
DONE ;
"RTN","PSGOEF",203,0)
 K CHK,DA,DIE,DR,DRG,MSG,Q1,Q2,PSGNSTAT,PSGEDTOI,PSGOEER,ZZND
"RTN","PSGOEF",204,0)
 K PSJOVR
"RTN","PSGOEF",205,0)
 Q
"RTN","PSGOEF",206,0)
ABORTACC ; Abort Accept process.
"RTN","PSGOEF",207,0)
 ;*315
"RTN","PSGOEF",208,0)
 K PSGDUR,PSGRMVT,PSGRMV,PSGRF
"RTN","PSGOEF",209,0)
 K PSJCT1,PSJOVR,PSJOVRLP,PSJCT1A K ^TMP("PSODAOC",$J)
"RTN","PSGOEF",210,0)
 D ABORT^PSGOEE K PSGOEEF D GETUD^PSJLMGUD(PSGP,PSGORD),^PSGOEF,ENSFE^PSGOEE0(PSGP,PSGORD),INIT^PSJLMUDE(PSGP,PSGORD) S VALMBCK="R",PSGSD=PSGNESD,PSGFD=PSGNEFD Q
"RTN","PSGOEF",211,0)
 ;
"RTN","PSGOEF",212,0)
 ;
"RTN","PSGOEF",213,0)
31 ;;101^PSGOE8;PSGOPD;PSGPD;101;1
"RTN","PSGOEF",214,0)
32 ;;109^PSGOE8;PSGODO;PSGDO;109;PSGODO]""
"RTN","PSGOEF",215,0)
33 ;;10^PSGOE81;PSGOSD;PSGSD;10;0
"RTN","PSGOEF",216,0)
34 ;;3^PSGOE8;PSGOMR;PSGMR;3;1
"RTN","PSGOEF",217,0)
35 ;;25^PSGOE81;PSGOFD;PSGFD;25;0
"RTN","PSGOEF",218,0)
36 ;;7^PSGOE8;PSGOST;PSGST;7;0
"RTN","PSGOEF",219,0)
37 ;;5^PSGOE82;PSGOSM;PSGSM;5;0
"RTN","PSGOEF",220,0)
38 ;;26^PSGOE8;PSGOSCH;PSGSCH;26;1      
"RTN","PSGOEF",221,0)
39 ;;39^PSGOE81;PSGOAT;PSGAT;39;0
"RTN","PSGOEF",222,0)
310 ;;1^PSGOE82;PSGOPR;PSGPR;1;1
"RTN","PSGOEF",223,0)
311 ;;8^PSGOE81;PSGOSI;PSGSI;8;0
"RTN","PSGOEF",224,0)
312 ;;2^PSGOE82;;;2;0
"RTN","PSGOEF",225,0)
313 ;;40^PSGOE82;;;40;0
"RTN","PSGOEF",226,0)
 ;
"RTN","PSGOEF",227,0)
AH ;
"RTN","PSGOEF",228,0)
 W !!?2,"Answer 'YES' to accept this order as a NON-VERIFIED UNIT DOSE order.  Answer",!,"'NO' to edit this order now.  Enter '^' to BYPASS this order, leaving it as",!,"a PENDING INPATIENT order."
"RTN","PSGOEF",229,0)
 Q
"RTN","PSGOEF1")
0^7^B30874451^B28843982
"RTN","PSGOEF1",1,0)
PSGOEF1 ;BIR/CML3-FINISH ORDERS ENTERED THROUGH OE/RR (CONT) ;02 Feb 2001  12:20 PM
"RTN","PSGOEF1",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**2,7,35,39,45,47,50,63,67,58,95,110,186,181,267,315**;16 DEC 97;Build 73
"RTN","PSGOEF1",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PSGOEF1",4,0)
 ; Reference to ^VALM1 is supported by DBIA# 10116.
"RTN","PSGOEF1",5,0)
 ; Reference to ^PS(55 is supported by DBIA 2191.
"RTN","PSGOEF1",6,0)
 ; Reference to ^PSDRUG( is supported by DBIA 2192.
"RTN","PSGOEF1",7,0)
 ; Reference to ^%DTC is supported by DBIA 10000.
"RTN","PSGOEF1",8,0)
 ; Reference to ^%RCR is supported by DBIA 10022.
"RTN","PSGOEF1",9,0)
 ; Reference to ^DIE is supported by DBIA 10018.
"RTN","PSGOEF1",10,0)
 ; Reference to ^DIR is supported by DBIA 10026.
"RTN","PSGOEF1",11,0)
 ;
"RTN","PSGOEF1",12,0)
UPD ;
"RTN","PSGOEF1",13,0)
 W !!,"...accepting order..."
"RTN","PSGOEF1",14,0)
 I PSGST="",(PSGSCH="NOW"!(PSGSCH="ONCE")) S PSGST="O"
"RTN","PSGOEF1",15,0)
 I PSJCOM D UPD^PSJCOM Q
"RTN","PSGOEF1",16,0)
 K DA,DR S DA=+PSGORD,DIE="^PS(53.1,",DR="28////N;4////U"_";7////"_PSGST_";10////"_PSGSD_";25////"_PSGFD
"RTN","PSGOEF1",17,0)
 I $D(PSGSI),$P($G(^PS(53.1,+PSGORD,0)),U,24)'="R" S ^PS(53.1,DA,6)=PSGSI
"RTN","PSGOEF1",18,0)
 I $D(PSGSI),$P($G(^PS(53.1,+PSGORD,0)),U,24)="R" S $P(^PS(53.1,DA,6),U)=$P(PSGSI,U) I $P(^PS(53.1,DA,6),U)="" S $P(^PS(53.1,DA,6),U,2)=""
"RTN","PSGOEF1",19,0)
 S:PSGOEFF#2 DR=DR_";26////"_PSGSCH
"RTN","PSGOEF1",20,0)
 ;*315 DRP Add removal fields if flag set.
"RTN","PSGOEF1",21,0)
 S:+$G(PSGRF) DR=DR_";137////"_$G(PSGDUR)_";138////"_$G(PSGRMVT)_";139////"_$G(PSGRMV)_";140////"_$G(PSGRF)
"RTN","PSGOEF1",22,0)
 I PSGSM,PSGOHSM'=PSGHSM S DR=DR_";5////"_PSGSM_";6////"_PSGHSM
"RTN","PSGOEF1",23,0)
 D ^DIE W "."
"RTN","PSGOEF1",24,0)
 F Q=1,3 K @(PSGOEEWF_Q_")") S %X="^PS(53.45,"_PSJSYSP_","_$S(Q=1:2,1:1)_",",%Y=PSGOEEWF_Q_"," K @(PSGOEEWF_Q_")") D %XY^%RCR W "."  ;MOU-0100-30945
"RTN","PSGOEF1",25,0)
 S PSGND=$G(^PS(53.1,+PSGORD,0)),X=$P(PSGND,U,24)
"RTN","PSGOEF1",26,0)
 I $S(X="R":1,+$G(^PS(55,PSGP,5.1))>PSGDT:0,1:X'="E") S X=$G(^PS(53.1,DA,2)) D ENWALL^PSGNE3(+$P(X,U,2),+$P(X,U,4),PSGP)
"RTN","PSGOEF1",27,0)
 I $P(PSGND,U,24)="R",$P(PSGND,U,25),PSGSD<$P($G(^PS(55,PSGP,5,+$P(PSGND,U,25),2)),U,4) D
"RTN","PSGOEF1",28,0)
 .K DA,DR S DA(1)=PSGP,DA=+$P(PSGND,U,25),DIE="^PS(55,"_PSGP_",5,",DR="34////"_PSGFD_";25////"_$P($G(^PS(55,PSGP,5,+$P(PSGND,U,25),2)),U,4)
"RTN","PSGOEF1",29,0)
 . S:+$G(PSGRF) DR=DR_";137////"_$G(PSGDUR)_";138////"_$G(PSGRMVT)_";139////"_$G(PSGRMV)_";140////"_$G(PSGRF) ;*315
"RTN","PSGOEF1",30,0)
 .D ^DIE,EN1^PSJHL2(PSGP,"XX",$P(PSGND,U,25))
"RTN","PSGOEF1",31,0)
 S $P(^PS(53.1,+PSGORD,.2),U,2)=PSGDO,$P(^PS(53.1,+PSGORD,2),U,5)=PSGAT S:$G(PSGS0XT) $P(^(2),U,6)=PSGS0XT
"RTN","PSGOEF1",32,0)
 I 'PSGOEAV D NEWNVAL^PSGAL5(PSGORD,$S(+PSJSYSU=3:22005,1:22000))
"RTN","PSGOEF1",33,0)
 I $D(^PS(53.45,+$G(DUZ),5,1,0)) D FILESI^PSJBCMA5(PSGP,PSGORD) N SIARRAY S SIARRAY="" D NEWNVAL^PSGAL5(PSGORD,6000,"SPECIAL INSTRUCTIONS",,.SIARRAY)
"RTN","PSGOEF1",34,0)
 I $D(^PS(53.45,+$G(DUZ),6,1,0)) D FILEOPI^PSJBCMA5(PSGP,PSGORD) N SIARRAY S SIARRAY="" D NEWNVAL^PSGAL5(PSGORD,6000,"OTHER PRINT INFO",,.SIARRAY)
"RTN","PSGOEF1",35,0)
 I PSGOEAV,+$G(PSJSYSU)=3 D VFY^PSGOEV Q
"RTN","PSGOEF1",36,0)
 I PSGOEAV,$G(PSJRNF) D VFY^PSGOEV
"RTN","PSGOEF1",37,0)
 Q
"RTN","PSGOEF1",38,0)
 ;
"RTN","PSGOEF1",39,0)
ENDRG(PSGPDRG,DRGDA) ; enter dispense drug for order w/o one
"RTN","PSGOEF1",40,0)
 NEW PSJALLGY
"RTN","PSGOEF1",41,0)
 K PSGORQF
"RTN","PSGOEF1",42,0)
 D NOW^%DTC K DRG S (DRG,Q)=0 F  S Q=$O(^PSDRUG("ASP",+PSGPDRG,Q)) Q:'Q  I $D(^PSDRUG(Q,0)),$P($G(^(2)),U,3)["U" S X=+$G(^("I")) I 'X!(X>%) S DRG=DRG+1,DRG(DRG)=Q_"^"_^(0)
"RTN","PSGOEF1",43,0)
 I 'DRG W $C(7),!!,"No dispense drugs were found for this order's Orderable Item." K DIR S DIR(0)="E" D ^DIR K DIR S CHK=-1 Q
"RTN","PSGOEF1",44,0)
 S:DRG=1 Y(0)=1
"RTN","PSGOEF1",45,0)
 I DRG>1 D  I 'Y S DRG=0,CHK=-1 Q
"RTN","PSGOEF1",46,0)
 .W !!,"CHOOSE FROM:" F Q=1:1:DRG W !?3,$J(Q,3),". ",$P(DRG(Q),"^",2)
"RTN","PSGOEF1",47,0)
 .N DIR S DIR(0)="LAO^1:"_DRG_U_"I X#1!(X[""."") K X",DIR("A")="Select DISPENSE DRUG(S) for this order: " S:DRG=1 DIR("B")=1 S DIR("?")="^D DRGH^PSGOEF1" W ! D ^DIR
"RTN","PSGOEF1",48,0)
 ;
"RTN","PSGOEF1",49,0)
 S DRG=Y(0) F Q1=1:1 S Q2=$P(DRG,",",Q1) Q:'Q2  D
"RTN","PSGOEF1",50,0)
 . S PSJALLGY(+DRG(Q2))=""
"RTN","PSGOEF1",51,0)
 I 'DRGDA S ^PS(53.45,PSJSYSP,2,0)="^53.4502P"
"RTN","PSGOEF1",52,0)
 F Q1=1:1 S Q2=$P(DRG,",",Q1) Q:'Q2  D
"RTN","PSGOEF1",53,0)
 . S DRGDA=DRGDA+1,^PS(53.45,PSJSYSP,2,DRGDA,0)=+DRG(Q2),^PS(53.45,PSJSYSP,2,"B",+DRG(Q2),DRGDA)=""
"RTN","PSGOEF1",54,0)
 . S DA(1)=PSJSYSP,DA=DRGDA,DIE="^PS(53.45,"_PSJSYSP_",2,",DR=".02//1" W !!,$P(DRG(Q2),U,2) D ^DIE
"RTN","PSGOEF1",55,0)
 D ENCKDD(PSGP,+$O(PSJALLGY(0))) Q:$G(PSGORQF)
"RTN","PSGOEF1",56,0)
 S PSGDI=0
"RTN","PSGOEF1",57,0)
 S:DRGDA>0 $P(^PS(53.45,PSJSYSP,2,0),"^",3,4)=DRGDA_"^"_DRGDA,CHK=0 Q
"RTN","PSGOEF1",58,0)
 Q
"RTN","PSGOEF1",59,0)
 ;
"RTN","PSGOEF1",60,0)
DRGH ;
"RTN","PSGOEF1",61,0)
 W !!?2,"This order must have at least one dispense drug before it can be completed.",!,"Select one or more items listed.  For each item selected, you will be",!,"prompted for the UNITS PER DOSE for the item."
"RTN","PSGOEF1",62,0)
 Q
"RTN","PSGOEF1",63,0)
ENIVUD(PSJORD)     ;
"RTN","PSGOEF1",64,0)
 ;Determine if user should be prompted to transfer the order to IV.
"RTN","PSGOEF1",65,0)
 ;  INPUT: PSJORD - IEN in 53.1_order location code.
"RTN","PSGOEF1",66,0)
 ; OUTPUT: 1 - Order not transferred, process as always.
"RTN","PSGOEF1",67,0)
 ;         0 - User selected to transfer order and quit upon return.
"RTN","PSGOEF1",68,0)
 ;
"RTN","PSGOEF1",69,0)
 NEW DIR,DIRUT,PSJCOI,PSJND0,Y
"RTN","PSGOEF1",70,0)
 S PSJND0=$G(^PS(53.1,+PSJORD,0)),PSJCOI=+$G(^PS(53.1,+PSJORD,.2))
"RTN","PSGOEF1",71,0)
 I $P(PSJND0,U,4)="F" Q 1
"RTN","PSGOEF1",72,0)
 D FULL^VALM1
"RTN","PSGOEF1",73,0)
 I $S($P(PSJND0,U,24)="R":1,1:'$P(PSJND0,U,13)) Q 1
"RTN","PSGOEF1",74,0)
 S DIR(0)="SAB^I:IV;U:UNIT DOSE",DIR("A")="COMPLETE THIS ORDER AS IV OR UNIT DOSE? ",DIR("B")=$S($P(PSJND0,U,4)="I":"IV",1:"UNIT DOSE")
"RTN","PSGOEF1",75,0)
 S DIR("??")="^D THELP^PSGOEF1("""_$S(DIR("B")="IV":"UNIT DOSE",1:"IV")_""","_PSJCOI_")"
"RTN","PSGOEF1",76,0)
 D ^DIR K DIR
"RTN","PSGOEF1",77,0)
 I $D(DTOUT)!$D(DUOUT) Q 0
"RTN","PSGOEF1",78,0)
 I Y="I" D  Q 0
"RTN","PSGOEF1",79,0)
 . I +PSJSYSU=1,'$G(PSJIRNF) W !!!!,"You need the PSJI RNFINISH key to finish this order as IV!" D PAUSE^VALM1 S VALMBCK="R" Q
"RTN","PSGOEF1",80,0)
 . D IV^PSJLIFNI(PSJORD,PSJCOI)
"RTN","PSGOEF1",81,0)
 I Y="U" D  Q 0
"RTN","PSGOEF1",82,0)
 . I +PSJSYSU=1,'$G(PSJRNF) W !!!!,"You need the PSJ RNFINISH key to finish this order as Unit Dose!" D PAUSE^VALM1 S VALMBCK="R" Q
"RTN","PSGOEF1",83,0)
 . I $G(PSJITECH),($P(PSJSYSU,";",3)'=3) W !!!!,"You may not finish this order as Unit Dose!" D PAUSE^VALM1 S VALMBCK="R" Q
"RTN","PSGOEF1",84,0)
 . D ENUD^PSGOEF1(PSJORD,PSJCOI)
"RTN","PSGOEF1",85,0)
 Q 1
"RTN","PSGOEF1",86,0)
 ;
"RTN","PSGOEF1",87,0)
ENUD(PSJORD,PSGPD)       ;
"RTN","PSGOEF1",88,0)
 N PSJTUD S PSJTUD=1,DFN=$P($G(^PS(53.1,+PSJORD,0)),U,15)
"RTN","PSGOEF1",89,0)
 K DRG,DRGOC,DRGT,DRGTMP,ERR,ON,ON55,P,PSJSTAR,PSJTIM,UL80
"RTN","PSGOEF1",90,0)
 D DISACTIO^PSJOE(DFN,PSJORD,$G(PSJPNV)) S VALMBCK="Q"
"RTN","PSGOEF1",91,0)
 I +$G(PSGORQF) S VALMBCK="R"
"RTN","PSGOEF1",92,0)
 Q
"RTN","PSGOEF1",93,0)
THELP(PKG,COI) ;
"RTN","PSGOEF1",94,0)
 W !,"Choose the package this order should be completed as a IV or Unit Dose order",!
"RTN","PSGOEF1",95,0)
 Q
"RTN","PSGOEF1",96,0)
 ;
"RTN","PSGOEF1",97,0)
ENCKDD(PSGP,PSJDRG) ;
"RTN","PSGOEF1",98,0)
 ;If the OI is edited, the OC is done in ^PSGOEE (PSGOE8 - Non-VFY; PSGOE9 - Active)
"RTN","PSGOEF1",99,0)
 Q:$G(PSGOEER)["101^PSGOE8"
"RTN","PSGOEF1",100,0)
 Q:$G(PSGOEER)["101^PSGOE9"
"RTN","PSGOEF1",101,0)
 N DRG
"RTN","PSGOEF1",102,0)
 S PSGORQF=0
"RTN","PSGOEF1",103,0)
 D ENDDC^PSGSICHK(PSGP,PSJDRG) Q:$G(PSGORQF)
"RTN","PSGOEF1",104,0)
 D IN^PSJOCDS($G(PSGORD),"UD",+PSJDRG)
"RTN","PSGOEF1",105,0)
 Q
"RTN","PSGOEM")
0^18^B46502031^B32911590
"RTN","PSGOEM",1,0)
PSGOEM ;BIR/CML3-PSGOE MESSAGES ;26 NOV 97 / 8:28 AM 
"RTN","PSGOEM",2,0)
 ;;5.0;INPATIENT MEDICATIONS ;**81,260,315**;16 DEC 97;Build 73
"RTN","PSGOEM",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PSGOEM",4,0)
 ; Reference to ^DD(53.1 is supported by DBIA# 2256.
"RTN","PSGOEM",5,0)
 ; Reference to ^PS(55 is supported by DBIA# 2191.
"RTN","PSGOEM",6,0)
 ;
"RTN","PSGOEM",7,0)
ENVM ;
"RTN","PSGOEM",8,0)
 W !!,"  Enter ORDER",$S(PSJON>1:"S (1-"_PSJON,1:" (1"),") you wish to ",$S('$D(PSJPRF):"select.",1:"view.") Q
"RTN","PSGOEM",9,0)
 ;
"RTN","PSGOEM",10,0)
ENCAM ;
"RTN","PSGOEM",11,0)
 W !!,"Enter a 'Y' (or press the RETURN key) to ",$S(PSJSYSU:"",1:"mark for "),"discontinu",$S(PSJSYSU:"e",1:"ation")," all of this"
"RTN","PSGOEM",12,0)
 W:'PSJSYSU ! W:PSJSYSU " " W "patient's" W:PSJSYSU ! W:'PSJSYSU " " W "orders.  Enter an 'N' (or '^') to leave this option now." Q
"RTN","PSGOEM",13,0)
 ;
"RTN","PSGOEM",14,0)
ENCOM ;
"RTN","PSGOEM",15,0)
 W !!,"Enter a 'Y' to ",$S(CF:"discontinue this order",1:"mark this order for discontinuation"),".  Press the RETURN key (or" W:'CF ! W:CF " " W "enter an 'N'" W:CF ! W:'CF " " W "or '^') to leave this option now." Q
"RTN","PSGOEM",16,0)
 ;
"RTN","PSGOEM",17,0)
ENDC ;
"RTN","PSGOEM",18,0)
 W !!,"You must enter 'DC' to discontinue the order or leave blank and press return to continue without discontinuing the order." Q
"RTN","PSGOEM",19,0)
 ;
"RTN","PSGOEM",20,0)
ENUMK ;
"RTN","PSGOEM",21,0)
 W " BEEN 'MARKED FOR DISCONTINUATION'."
"RTN","PSGOEM",22,0)
 F  W !,"DO YOU WANT TO 'UNMARK' ",$S($D(PSGORD):"IT",1:"THEM") S %=2 D YN^DICN Q:%  W !!?2,"Enter 'Y' to UNMARK "_$S($D(PSGORD):"this order",1:"these orders")_".  Enter 'N' to leave the order"_$E("s",$D(PSGORD)[0)_" MARKED AS IS.",!
"RTN","PSGOEM",23,0)
 Q
"RTN","PSGOEM",24,0)
 ;
"RTN","PSGOEM",25,0)
ENHLP(F1,F2) ; order entry fields' help
"RTN","PSGOEM",26,0)
 ; Input: F1 - File #
"RTN","PSGOEM",27,0)
 ;        F2 - Field #
"RTN","PSGOEM",28,0)
 N F,F0,F3,PSJD,PSJHP,PSJX
"RTN","PSGOEM",29,0)
 ;I X="?",$D(^DD(F1,F2,3)) S F=^(3) W !?5 F F0=1:1:$L(F," ") S F3=$P(F," ",F0) W:$L(F3)+$X>78 !?5 W F3_" "
"RTN","PSGOEM",30,0)
 ;
"RTN","PSGOEM",31,0)
 D FIELD^DID(F1,F2,"","HELP-PROMPT","PSJHP")
"RTN","PSGOEM",32,0)
 I X="?",$D(PSJHP("HELP-PROMPT")) S F=$G(PSJHP("HELP-PROMPT")) W !?5 F F0=1:1:$L(F," ") S F3=$P(F," ",F0) W:$L(F3)+$X>78 !?5 W F3_" "
"RTN","PSGOEM",33,0)
 ;
"RTN","PSGOEM",34,0)
 ;W:$D(^DD(F1,F2,12)) !,"("_^(12)_")" I $D(^(4)) X ^(4)
"RTN","PSGOEM",35,0)
 W:$D(^DD(F1,F2,12)) !,"("_^(12)_")" D FIELD^DID(F1,F2,"","XECUTABLE HELP","PSJX") I $D(PSJX("XECUTABLE HELP")) X PSJX("XECUTABLE HELP")
"RTN","PSGOEM",36,0)
 ;
"RTN","PSGOEM",37,0)
 ;  new code
"RTN","PSGOEM",38,0)
 D FIELD^DID(F1,F2,"","DESCRIPTION","PSJD")
"RTN","PSGOEM",39,0)
 G:$S(X="?":1,1:'$O(PSJD("DESCRIPTION",0))) SC F F=0:0 S F=$O(PSJD("DESCRIPTION",F)) Q:'F  I $D(PSJD("DESCRIPTION",F)) W !?2,PSJD("DESCRIPTION",F)
"RTN","PSGOEM",40,0)
 ;I F W:X="??" !?2,"..." I X?3."?" F F=F-1:0 S F=$O(^DD(F1,F2,21,F)) Q:'F  I $D(^(F,0)) W !?2,^(0)
"RTN","PSGOEM",41,0)
 I F2=106 W !?5,"CHOOSE FROM:",!?7,"W",?16,"WRITTEN",!?7,"P",?16,"TELEPHONE",!?7,"V",?16,"VERBAL",!
"RTN","PSGOEM",42,0)
 ; old code
"RTN","PSGOEM",43,0)
 ;G:$S(X="?":1,1:'$O(^DD(F1,F2,21,0))) SC F F=0:0 S F=$O(^DD(F1,F2,21,F)) Q:'F  I $D(^(F,0)) W !?2,^(0)
"RTN","PSGOEM",44,0)
 ;I F W:X="??" !?2,"..." I X?3."?" F F=F-1:0 S F=$O(^DD(F1,F2,21,F)) Q:'F  I $D(^(F,0)) W !?2,^(0),"RB.."
"RTN","PSGOEM",45,0)
 ;I F2=106 W !?5,"CHOOSE FROM:",!?7,"W",?16,"WRITTEN",!?7,"P",?16,"TELEPHONE",!?7,"V",?16,"VERBAL",!
"RTN","PSGOEM",46,0)
 ;
"RTN","PSGOEM",47,0)
SC ;
"RTN","PSGOEM",48,0)
 I F2=5!(F2=6) W !,"CHOOSE FROM:",!?8,0,?16,"NO",!?8,1,?16,"YES" Q
"RTN","PSGOEM",49,0)
 Q
"RTN","PSGOEM",50,0)
 ;
"RTN","PSGOEM",51,0)
ENFF ; up-arrow to another field
"RTN","PSGOEM",52,0)
 S Y=-1 I '$D(PSGFOK) W $C(7),"  ??" Q
"RTN","PSGOEM",53,0)
 ;I X="^301"!($P("^DOSAGE ORDERED",X)="") W:X="^301" "  " S:X="^301" X="^" W $P("^DOSAGE ORDERED",X,2) S Y=301 Q
"RTN","PSGOEM",54,0)
 S X=$E(X,2,99) I X=+X S Y=$S($D(PSGFOK(X)):X,1:-1) W "  " W:Y>0 $$CODES2^PSIVUTL(53.1,X) W:Y'>0 $C(7),"??" Q
"RTN","PSGOEM",55,0)
 K DIC S DIC="^DD(53.1,",DIC(0)="QEM",DIC("S")="I $D(PSGFOK(+Y))" D ^DIC K DIC S Y=+Y Q
"RTN","PSGOEM",56,0)
 ;
"RTN","PSGOEM",57,0)
ENAH ; help text for "ACTION" prompt
"RTN","PSGOEM",58,0)
 W !!,"YOU MAY SELECT:"
"RTN","PSGOEM",59,0)
 W:PSGACT["B" !?5,"B to bypass (take no action on) a pending order."
"RTN","PSGOEM",60,0)
 W:PSGACT["D" !?5,"D (or DC) to discontinue an order.  *WARNING* If you discontinue a",!?7,"non-verified order it is deleted from the system."
"RTN","PSGOEM",61,0)
 W:PSGACT["E" !?5,"E to edit an active or non-verified order.  NOTE: Nursing must be notified",!?7,"of all changes."
"RTN","PSGOEM",62,0)
 W:PSGACT["F" !?5,"F to finish a pending order."
"RTN","PSGOEM",63,0)
 I PSGACT["H" S HF=$S('$D(^PS(55,PSGP,5,+PSGORD,0)):1,1:$P(^(0),"^",9)'="H") W !?5,"H to ",$S(HF:"place this order on",1:"take this order off of")," hold."
"RTN","PSGOEM",64,0)
 W:PSGACT["I" !?5,"I to mark a non-verified order as incomplete, or to unmark a non-verified",!?7,"order so marked.  An order marked as incomplete may not be verified."
"RTN","PSGOEM",65,0)
 W:PSGACT["L" !?5,"L to display either the activity log or the dispense log associated with",!,?7,"this order."
"RTN","PSGOEM",66,0)
 W:PSGACT["N" !?5,"N to mark this order as 'NOT TO BE GIVEN'.  Orders so marked may not be",!?7,"renewed,"_$S(PSJSYSU:"",1:" or")_" reinstated"_$S(PSJSYSU:", or copied.",1:".")
"RTN","PSGOEM",67,0)
 W:PSGACT["R" !?5,"R to ",$S(PSGRRF:"reinstate",1:"renew")," this order."
"RTN","PSGOEM",68,0)
 W:PSGACT["V" !?5,"V to verify (make active) a non-verified order.  NOTE: You cannot verify",!?7,"an order that has been marked as incomplete."
"RTN","PSGOEM",69,0)
 I $D(PSGOEA),PSGOEA?2."?" W !!,"You may also select:" I 'PSGOENG,'$D(PSGODF),PSJPCAF,'PSGDI,'PSGPI W !?5,"C to copy (duplicate) this order into a new, non-verified order."
"RTN","PSGOEM",70,0)
 I $D(PSGOEA),PSGOEA?2."?" W !?5,"P to print this order to a device.",!?5,"S to show this order again."
"RTN","PSGOEM",71,0)
 I PSGOEAV W !!,"PLEASE NOTE: This order is automatically verified, and unless discontinued",!?13,"now, will show as active."
"RTN","PSGOEM",72,0)
 W !!?2,"You may also press the RETURN key if you are finished with this order or wish",!,"to take no action on it." W:'$D(PSGOETOF) "  Enter an '^' if you do not wish to take any action on any other orders."
"RTN","PSGOEM",73,0)
 Q
"RTN","PSGOEM",74,0)
DURHLP(PSGSTR,PSGRF) ; Help text for Duration of Administration *315 drp
"RTN","PSGOEM",75,0)
 Q:($G(PSGRF,0)<2)!($E(PSGSTR,1)'="?")
"RTN","PSGOEM",76,0)
 D @PSGRF
"RTN","PSGOEM",77,0)
 I $E(PSGSTR,1,2)="??" D
"RTN","PSGOEM",78,0)
 . W !!,"Enter the number of hours the medication will remain on the patient in the"
"RTN","PSGOEM",79,0)
 . W !,"Duration of Administration field. The BCMA user will be prompted to remove the"
"RTN","PSGOEM",80,0)
 . W !,"medication after the Duration of Administration period."
"RTN","PSGOEM",81,0)
 . W !!,"The Duration of Administration cannot match or exceed the order frequency"
"RTN","PSGOEM",82,0)
 . W !,"(the period of time between two Admin Times) except for BID, TID and QID schedules."
"RTN","PSGOEM",83,0)
 .Q
"RTN","PSGOEM",84,0)
 Q
"RTN","PSGOEM",85,0)
 ;
"RTN","PSGOEM",86,0)
2 ;TYPE 2 OI
"RTN","PSGOEM",87,0)
 W !,"The Duration of Administration is the period of time the medication remains on"
"RTN","PSGOEM",88,0)
 W !,"the patient before removal. If this medication order requires a drug-free period"
"RTN","PSGOEM",89,0)
 W !,"prior to the next administration, enter a Duration of Administration here."
"RTN","PSGOEM",90,0)
 W !!,"If this medication order does not require a drug-free period prior to the next"
"RTN","PSGOEM",91,0)
 W !,"administration, this field should be left blank."
"RTN","PSGOEM",92,0)
 Q
"RTN","PSGOEM",93,0)
 ;
"RTN","PSGOEM",94,0)
3 ;TYPE 3 OI
"RTN","PSGOEM",95,0)
 I $E(PSGSTR,1)="?" D
"RTN","PSGOEM",96,0)
 .W !,"The Duration of Administration is the period of time the medication remains on"
"RTN","PSGOEM",97,0)
 .W !,"the patient before removal. The Duration of Administration is required for this"
"RTN","PSGOEM",98,0)
 .W !,"medication order because this medication requires a drug-free period prior to"
"RTN","PSGOEM",99,0)
 .W !,"the next administration."
"RTN","PSGOEM",100,0)
 .Q
"RTN","PSGOEM",101,0)
 Q
"RTN","PSGOER")
0^26^B87272469^B85734604
"RTN","PSGOER",1,0)
PSGOER ;BIR/CML3 - RENEW A SINGLE ORDER ;4/27/11 9:54am
"RTN","PSGOER",2,0)
 ;;5.0;INPATIENT MEDICATIONS ;**11,30,29,35,70,58,95,110,111,133,141,198,181,246,278,281,315**;16 DEC 97;Build 73
"RTN","PSGOER",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PSGOER",4,0)
 ;
"RTN","PSGOER",5,0)
 ; Reference to ^PS(51.1 supported by DBIA 2177.
"RTN","PSGOER",6,0)
 ; Reference to ^PS(55 supported by DBIA 2191.
"RTN","PSGOER",7,0)
 ; Reference to ^PSSLOCK is supported by DBIA 2789.
"RTN","PSGOER",8,0)
 ; Reference to ^PSBAPIPM is supported by DBIA 3564.
"RTN","PSGOER",9,0)
 ; Reference to ^PS(59.7 is supported by DBIA 2181.
"RTN","PSGOER",10,0)
 ; Reference to ^PSDRUG( is supported by DBIA 2192.
"RTN","PSGOER",11,0)
 ; Reference to ^TMP("PSODAOC",$J is supported by DBIA 6071.
"RTN","PSGOER",12,0)
 ;
"RTN","PSGOER",13,0)
 ; renew a single order
"RTN","PSGOER",14,0)
 I $G(PSJCOM) D ^PSJCOMR Q
"RTN","PSGOER",15,0)
 N PSJEXPIR S PSJEXPIR=$$EXPIRED(PSGP,PSGORD) I PSJEXPIR D  Q
"RTN","PSGOER",16,0)
 .W !!?3,"  THIS ORDER" W:PSJEXPIR'=2 " HAS BEEN INACTIVE FOR ONE OR MORE SCHEDULED",!?8," ADMINISTRATIONS AND"
"RTN","PSGOER",17,0)
 .W " CANNOT BE RENEWED!" D PAUSE^VALM1
"RTN","PSGOER",18,0)
 I $G(PSGSCH)]"",($G(PSGS0XT)="D"),($G(PSGAT)="") D  Q
"RTN","PSGOER",19,0)
 .N SWD,SDW,XABB,X,QX S X=$G(PSGSCH) D DW^PSGS0 Q:($G(X)="")  I $G(PSGS0XT)="" S PSGS0XT="D"
"RTN","PSGOER",20,0)
 .Q:((",P,R,")[(","_$G(PSGST)_","))
"RTN","PSGOER",21,0)
 .I $G(PSGS0XT)="D",$G(PSGAT)="" S CHK=1 W !!?3,"This order contains a 'DAY OF THE WEEK' schedule without admin times"
"RTN","PSGOER",22,0)
 .W !?11," and CANNOT be renewed!" D PAUSE^VALM1
"RTN","PSGOER",23,0)
 I $G(PSGSCH)]"",'$$DOW^PSIVUTL(PSGSCH),'$$PRNOK^PSGS0(PSGSCH) I '$D(^PS(51.1,"AC","PSJ",PSGSCH)) D  Q
"RTN","PSGOER",24,0)
 .W !!?3,"This order contains an invalid schedule and CANNOT be renewed!" D PAUSE^VALM1
"RTN","PSGOER",25,0)
 W !! K DIR S DIR(0)="Y",DIR("A")=$S($P(PSJSYSP0,"^",3):"RENEW THIS ORDER",1:"MARK THIS ORDER FOR RENEWAL"),DIR("B")="YES"
"RTN","PSGOER",26,0)
 S DIR("?")="Answer 'YES' to "_$S($P(PSJSYSP0,"^",3):"renew this order",1:"mark this order for renewal")_".  Answer 'NO' (or '^') to stop now." D ^DIR
"RTN","PSGOER",27,0)
 I '$D(DIRUT),Y D NEW S PSGCANFL=1 D DONE Q
"RTN","PSGOER",28,0)
 I '$D(DIRUT),PSJSYSU S PSGND4=$G(^PS(55,PSGP,5,+PSGORD,4)) I $P(PSGND4,"^",15),$P(PSGND4,"^",16) D UNMARK,DONE Q
"RTN","PSGOER",29,0)
 D DONE,ABORT^PSGOEE
"RTN","PSGOER",30,0)
 Q
"RTN","PSGOER",31,0)
 ;
"RTN","PSGOER",32,0)
UNMARK ;  
"RTN","PSGOER",33,0)
 W !!,"THIS ORDER HAS BEEN 'MARKED FOR RENEWAL'.",! K DIR S DIR(0)="Y",DIR("A")="DO YOU WANT TO 'UNMARK IT'",DIR("B")="NO"
"RTN","PSGOER",34,0)
 S DIR("?",1)="  Answer 'YES' to unmark this order.  Answer 'NO' (or '^') to leave the order",DIR("?")="marked.  (An answer is required.)" D ^DIR
"RTN","PSGOER",35,0)
 I 'Y D ABORT^PSGOEE G DONE
"RTN","PSGOER",36,0)
 S DA(1)=PSGP,DA=+PSGORD,PSGAL("C")=21180+PSJSYSU D ^PSGAL5 S $P(PSGND4,"^",15,17)="^^",^PS(55,PSGP,5,DA,4)=PSGND4 W "...DONE!"
"RTN","PSGOER",37,0)
 ;
"RTN","PSGOER",38,0)
DONE ;
"RTN","PSGOER",39,0)
 K %DT,DA,DIE,DIR,DR,FDSD,PSGAL,PSGALR,PSGDL,PSGDLS,PSGFD,PSGFOK,PSGND4,PSGOEE,PSGOER0,PSGOER1,PSGOER2,PSGOERDP,PSGPOSA,PSGPOSD,PSGPR,PSGPX,PSGRD,PSGSD,PSGTOL,PSGTOO,PSGUOW,PSGWLL,RF Q
"RTN","PSGOER",40,0)
 ;
"RTN","PSGOER",41,0)
NEW ; get info, write record
"RTN","PSGOER",42,0)
EXTEND ; extend stop date on renewal order
"RTN","PSGOER",43,0)
 N DUOUT,PSJABT,PSGDRG,PSJREN,PSGOREAS S PSGDRG=$P($G(^PS(55,PSGP,5,+PSGORD,1,1,0)),"^"),PSJREN=1
"RTN","PSGOER",44,0)
 I $G(PSGST)="O" N ACT S ACT=$$EN^PSBAPIPM(PSGP,PSGORD) I $P(ACT,"^",2),($P(ACT,"^",3)="G") I $P(ACT,"^",2)>$P($G(^PS(55,PSGP,5,+PSGORD,2)),"^",2) D  Q
"RTN","PSGOER",45,0)
 . W !!?5,"THIS ONE-TIME ORDER HAS ALREADY BEEN GIVEN AND CANNOT BE RENEWED",! S (DIRUT,PSGORQF)=1 D READ
"RTN","PSGOER",46,0)
 ;D OC55
"RTN","PSGOER",47,0)
 ;Q:$D(PSGORQF)  ; quit if not to continue
"RTN","PSGOER",48,0)
 D NOW^%DTC S PSGDT=%,PSGND4=$G(^PS(55,PSGP,5,+PSGORD,4)) I '$P(PSJSYSP0,"^",3) D MARK Q
"RTN","PSGOER",49,0)
 S PSGWLL=$S('$P(PSJSYSW0,"^",4):0,1:+$G(^PS(55,PSGP,5.1))),PSGOEE="R" K PSGOEOS
"RTN","PSGOER",50,0)
 K ^PS(53.45,PSJSYSP,1),^(2) D MOVE(3,1),MOVE(1,2)
"RTN","PSGOER",51,0)
 D DATE^PSGOER0(PSGP,PSGORD,PSGDT) I ($G(X)="^")!'$D(PSGFOK(106))!$G(DUOUT) D DONE,ABORT^PSGOEE S VALMBCK="R",COMQUIT=1 Q
"RTN","PSGOER",52,0)
 ;D OC55
"RTN","PSGOER",53,0)
 ;I $G(PSGORQF) D DONE,ABORT^PSGOEE S VALMBCK="R",COMQUIT=1 Q
"RTN","PSGOER",54,0)
SPEED ;
"RTN","PSGOER",55,0)
 I +$G(PSJSYSU)=3 D EN^PSGPEN(PSGORD)
"RTN","PSGOER",56,0)
 Q:$G(DUOUT)
"RTN","PSGOER",57,0)
 N PSGOEAV S PSGOEAV=+PSJSYSU
"RTN","PSGOER",58,0)
 W !!,"...updating order..." K DA S DA(1)=PSGP,DA=+PSGORD,PSGAL("C")=PSJSYSU*10+18000 D ^PSGAL5 W "."
"RTN","PSGOER",59,0)
 I $$LS^PSSLOCK(PSGP,PSGORD) D UPDREN(PSGORD,PSGDT,PSGOEPR,PSGOFD,PSJNOO),UPDRENOE(PSGP,PSGORD,PSGDT) D UNL^PSSLOCK(PSGP,PSGORD)
"RTN","PSGOER",60,0)
 S ^TMP("PSODAOC",$J,"IP IEN")=PSGORD   ;set up which IEN will be used to store order checks
"RTN","PSGOER",61,0)
 D SETOC^PSJNEWOC(PSGORD) ;PSJ*5*281 stores order checks
"RTN","PSGOER",62,0)
 K ^TMP("PSODAOC",$J),^TMP("PSJDAOC",$J)
"RTN","PSGOER",63,0)
 ;
"RTN","PSGOER",64,0)
 I 'PSGOERDP,$P(PSJSYSW0,"^",4),PSGFD'<PSGWLL S $P(^PS(55,PSGP,5.1),"^")=+PSGFD
"RTN","PSGOER",65,0)
 W ".DONE!" S VALMBCK="Q" Q
"RTN","PSGOER",66,0)
 ;
"RTN","PSGOER",67,0)
MARK ;
"RTN","PSGOER",68,0)
 I $P(PSGND4,"^",15),$P(PSGND4,"^",16) W $C(7),!!?3,"...THIS ORDER IS ALREADY MARKED FOR RENEWAL!..." Q
"RTN","PSGOER",69,0)
 K DA S $P(PSGND4,"^",15,17)="1^"_DUZ_"^"_PSGDT,^PS(55,PSGP,5,+PSGORD,4)=PSGND4,PSGAL("C")=13180,DA(1)=PSGP,DA=+PSGORD W "." D ^PSGAL5
"RTN","PSGOER",70,0)
 I $D(PSJSYSO) S PSGORD=+PSGORD_"A",PSGPOSA="R",PSGPOSD=PSGDT D ENPOS^PSGVDS
"RTN","PSGOER",71,0)
 Q
"RTN","PSGOER",72,0)
MOVE(X,Y) ; Move comments/dispense drugs from 55 to 53.45.
"RTN","PSGOER",73,0)
 S Q=0 F  S Q=$O(^PS(55,PSGP,5,+PSGORD,X,Q)) Q:'Q  S ^PS(53.45,PSJSYSP,Y,Q,0)=$G(^(Q,0))
"RTN","PSGOER",74,0)
 S:Q ^PS(53.45,Y,0)="^53.450"_Y_"P^"_Q_U_Q
"RTN","PSGOER",75,0)
 Q
"RTN","PSGOER",76,0)
OC55 ;* Order checks for Speed finish and regular finish
"RTN","PSGOER",77,0)
 ;PSJ*5*181 - no longer use (OC will be triggered from OC^PSGOER0)
"RTN","PSGOER",78,0)
 Q
"RTN","PSGOER",79,0)
NEWOC55 ;
"RTN","PSGOER",80,0)
 N INTERVEN,PSJDDI,PSJIREQ,PSJRXREQ,PSJPDRG,PSJDD,PSJDD0,PSJALLGY
"RTN","PSGOER",81,0)
 S Y=1,(PSJIREQ,PSJRXREQ,INTERVEN,X)=""
"RTN","PSGOER",82,0)
 F PSGDDI=0:0 S PSGDDI=$O(^PS(55,PSGP,5,+PSGORD,1,PSGDDI)) Q:'+PSGDDI  D
"RTN","PSGOER",83,0)
 . S PSJDD0=$G(^PS(55,PSGP,5,+PSGORD,1,PSGDDI,0))
"RTN","PSGOER",84,0)
 . S PSJX=$P(PSJDD0,U,3) I PSJX]"",(PSJX'>$G(PSGDT)) Q
"RTN","PSGOER",85,0)
 . S PSJDD=+PSJDD0
"RTN","PSGOER",86,0)
 . S PSJX=$S('$D(^PSDRUG(+PSJDD,0)):1,$P($G(^(2)),U,3)'["U":1,$G(^("I"))="":0,1:^("I")'>$G(PSGDT))
"RTN","PSGOER",87,0)
 . Q:PSJX
"RTN","PSGOER",88,0)
 . S PSJALLGY(PSJDD)=""
"RTN","PSGOER",89,0)
 S PSJDD=$O(PSJALLGY(0))
"RTN","PSGOER",90,0)
 I '+PSJDD W !!,"No active dispense drug was found" D PAUSE^PSJLMUT1 Q
"RTN","PSGOER",91,0)
 K PSGORQF D ENDDC^PSGSICHK(PSGP,PSJDD)
"RTN","PSGOER",92,0)
 D:'$G(PSGORQF) IN^PSJOCDS(PSGORD,"UD",PSJDD) Q:$G(PSGORQF)
"RTN","PSGOER",93,0)
 Q
"RTN","PSGOER",94,0)
UPDREN(PSGORD,RNWDT,PSGOEPR,PSGOFD,PSJNOO,RDUZ) ; update renewed order
"RTN","PSGOER",95,0)
 N DR,DA,DIC,DIE,DD,DO,PSGRZERO,PSGRFOUR,PSGOORD
"RTN","PSGOER",96,0)
 S DR="",PSGOEENO=0,PSGOORD=PSGORD,PSGNESD=PSGSD Q:'PSGORD!'RNWDT!'PSGOEPR!'PSGOFD  S PSJNOO=$S($G(PSJNOO)]"":$G(PSJNOO),1:"E")
"RTN","PSGOER",97,0)
 S PSGRZERO="^PS(55,"_PSGP_",5,"_+PSGORD_",0)",PSGOEORD=$P(@PSGRZERO,"^",21)
"RTN","PSGOER",98,0)
 ; PSJ*5*141 - changed PSGOEPR to PSGPR for field 1 of the DR string below.
"RTN","PSGOER",99,0)
 S DA(1)=PSGP,DA=+PSGORD,DIE="^PS(55,"_PSGP_",5," S DR="34////^S X=PSGFD" S:$G(PSGPR) DR=DR_";1////"_PSGPR_";110////"_PSJNOO D ^DIE
"RTN","PSGOER",100,0)
 K DR,DA,DIC,DIE,DD,DO S DIC="^PS(55,"_PSGP_",5,"_+PSGORD_",14,",DIC(0)="L",DIC("P")="55.6114DA",ND14=$G(@(DIC_"0)")),DINUM=$P(ND14,"^",3)+1,DA(2)=PSGP,DA(1)=+PSGORD D
"RTN","PSGOER",101,0)
 . S DIC("DR")=".01////"_$G(RNWDT)_";1////"_$S($G(RDUZ):RDUZ,1:$G(DUZ))_";2////"_$G(PSGOEPR)_";3////"_$G(PSGOFD)_";4////"_+PSGOEORD,X=$G(RNWDT) D FILE^DICN
"RTN","PSGOER",102,0)
 K DR,DA,DIC,DIE,DD,DO S DA(1)=PSGP,DA=+PSGORD,DIE="^PS(55,"_PSGP_",5,",DR="28////A;105////@;107////@"
"RTN","PSGOER",103,0)
 ;PSJ*5*198
"RTN","PSGOER",104,0)
 S PSGRFOUR="^PS(55,"_PSGP_",5,"_+PSGORD_",4)",PSGRFOUR=@PSGRFOUR I $P(PSGRFOUR,"^",2)<RNWDT S DR=DR_";16////@;17////@" I $G(PSJORD)["P",+PSJSYSU=1 S DR=DR_";18////@;19////@"
"RTN","PSGOER",105,0)
 I '$G(PSJSPEED) I $G(PSGAT)]"",$G(PSGAT)'=$P($G(@(DIE_+PSGORD_",2)")),"^",5) S DR=DR_";41////"_PSGAT
"RTN","PSGOER",106,0)
 D ^DIE
"RTN","PSGOER",107,0)
 ; PSJ*5*278 - Check to re-assign orderable item
"RTN","PSGOER",108,0)
 N PSGPOI S PSGPOI=$$ACTIVE^PSJORREN(PSGP,PSGORD) Q:+PSGPOI=1  ;Quit if no change to OI
"RTN","PSGOER",109,0)
 I +PSGPOI>1,$P(PSGPOI,U,2) D  ;replace OI
"RTN","PSGOER",110,0)
 . N DR,DA,DIE S DA(1)=PSGP,DA=+PSGORD,DIE="^PS(55,"_PSGP_",5,",DR="108///^S X=$P(PSGPOI,U,2)" D ^DIE
"RTN","PSGOER",111,0)
 Q
"RTN","PSGOER",112,0)
UPDRENOE(PSGP,PSGORD,RDATE) ;
"RTN","PSGOER",113,0)
 D EXPOE(PSGP,PSGORD,$G(RDATE)) ; expire original Orders File order
"RTN","PSGOER",114,0)
 I PSGORD'["P" K DA,DR,DIE S DA(1)=DFN,DA=+PSGORD,DIE="^PS(55,"_DFN_$S(PSGORD="U":",5,",1:",""IV"","),DR=$S(DIE["IV":110,1:66)_"////@" D ^DIE
"RTN","PSGOER",115,0)
 D ENUDTX^PSJOREN(PSGP,PSGORD,"NR")
"RTN","PSGOER",116,0)
 D EN1^PSJHL2(PSGP,"SN",PSGORD,"ORDER RENEWED")
"RTN","PSGOER",117,0)
 Q
"RTN","PSGOER",118,0)
READ ; hold screen
"RTN","PSGOER",119,0)
 I $D(IOST) Q:$E(IOST)'="C"
"RTN","PSGOER",120,0)
 W !?5,"Press return to continue  " R X:$S($D(DTIME):DTIME,1:300)
"RTN","PSGOER",121,0)
 Q
"RTN","PSGOER",122,0)
EXPOE(DFN,PSJORDER,EXPDT) ; expire old Orders File entry
"RTN","PSGOER",123,0)
 I PSJORDER["P" S FILE="^PS(53.1,"_+PSJORDER_",0)",PSJORDER=$P(@FILE,"^",25)
"RTN","PSGOER",124,0)
 I (PSJORDER'["U"),(PSJORDER'["V") Q
"RTN","PSGOER",125,0)
 N CURDAT D NOW^%DTC S CURDAT=$$DATE2^PSJUTL2(%)
"RTN","PSGOER",126,0)
 S PSJEXPOE=$S($G(EXPDT):EXPDT,1:CURDAT) D EN1^PSJHL2(DFN,"SC",PSJORDER) K PSJEXPOE
"RTN","PSGOER",127,0)
 Q
"RTN","PSGOER",128,0)
EXPIRED(PSJX,PSJY) ;
"RTN","PSGOER",129,0)
 ; INPUT 
"RTN","PSGOER",130,0)
 ;       PSJX - Pharmacy Patient, pointer to ^PS(55
"RTN","PSGOER",131,0)
 ;       PSJY - Inpatient Order Number(appended with "V" or "U")
"RTN","PSGOER",132,0)
 ; OUTPUT
"RTN","PSGOER",133,0)
 ;   0  -  Order has not exceeded the Expired Time Limit 
"RTN","PSGOER",134,0)
 ;   1  -  Order has exceeded the Expired Time Limit
"RTN","PSGOER",135,0)
 N STOP,STATUS,NOW,CUTOFF,FREQ,LAST,ST,X,DFN,U,PSGDT,SD,WD,PSJPSTO,PSGDW,PSGOC,ZZND,LASTAT,LSTSTR,PSBCNT S DFN=PSJX,U="^",CUTOFF=0
"RTN","PSGOER",136,0)
 S STATUS=$S(PSJY["U":$P($G(^PS(55,PSJX,5,+PSJY,0)),"^",9),PSJY["V":$P($G(^PS(55,PSJX,"IV",+PSJY,0)),"^",17),1:"")
"RTN","PSGOER",137,0)
 S NOW=$S($G(PSGDT):PSGDT,1:$$DATE^PSJUTL2())
"RTN","PSGOER",138,0)
 S STOP=$S(PSJY["U":$P($G(^PS(55,PSJX,5,+PSJY,2)),U,4),1:$P($G(^PS(55,PSJX,"IV",+PSJY,0)),"^",3))
"RTN","PSGOER",139,0)
 I NOW<STOP Q 0
"RTN","PSGOER",140,0)
 ;*315 ND2P1 ON NEXT LINE
"RTN","PSGOER",141,0)
 I PSJY["U" N ND2,ND0 S ND0=$G(^PS(55,PSJX,5,+PSJY,0)),ND2=$G(^PS(55,PSJX,5,+PSJY,2)),ND2P1=$G(^PS(55,PSJX,5,+PSJY,2.1)),FREQ=$P(ND2,"^",6) D
"RTN","PSGOER",142,0)
 .N SCHED S SCHED=$P($G(^PS(55,PSJX,5,+PSJY,2)),"^") I SCHED["PRN" S FREQ=$$PRNFREQ(SCHED)
"RTN","PSGOER",143,0)
 .S LSTSTR=$P(ND2,"^",2)_"^"_$P(ND2,"^",4)_"^"_SCHED_"^"_$P(ND0,"^",7)_"^^"_$P(ND2,"^",5)
"RTN","PSGOER",144,0)
 .S LAST=$$EN^PSBAPIPM(PSJX,PSJY) I LAST,($P(ND0,"^",7)="O"),($P(LAST,"^",3)="G") I LAST>$P(ND2,"^",2) S CUTOFF=$$FMADD^XLFDT(NOW,,-1) Q
"RTN","PSGOER",145,0)
 .I 'LAST!(LAST>$P(ND2,"^",4)) S LAST=$$LASTAT^PSJORP2(DFN,LSTSTR) S:LAST CUTOFF=$$FMADD^XLFDT(LAST,,,FREQ) Q
"RTN","PSGOER",146,0)
 .I SCHED["PRN",($P(LSTSTR,"^",6)="") S CUTOFF=$$FMADD^XLFDT(LAST,,,FREQ) Q
"RTN","PSGOER",147,0)
 .I $$DOW^PSIVUTL(SCHED) S CUTOFF=$$NXTDOW(DFN,$P(LSTSTR,"^"),$P(LSTSTR,"^",2),$P(LSTSTR,"^",3),$P(LSTSTR,"^",6)) Q
"RTN","PSGOER",148,0)
 .S LAST=$$EN^PSBAPIPM(PSJX,PSJY) I 'LAST!(LAST>$P(ND2,"^",4)) S CUTOFF=$$FMADD^XLFDT(NOW,,-1) Q
"RTN","PSGOER",149,0)
 .S $P(LSTSTR,"^")=$$FMADD^XLFDT(LAST,,,,1),$P(LSTSTR,"^",2)=$$FMADD^XLFDT(PSGDT,,,FREQ) S CUTOFF=$$ENQ^PSJORP2(PSJX,LSTSTR)
"RTN","PSGOER",150,0)
 I PSJY["V" N LIMIT S LIMIT=$P($G(^PS(59.7,1,31)),"^",4) S LIMIT=$S((LIMIT]""):+LIMIT,1:24) S CUTOFF=$$FMADD^XLFDT(STOP,,LIMIT) D
"RTN","PSGOER",151,0)
 .I '($G(P(4))]"") N P,YP,XP S YP=$G(^PS(55,DFN,"IV",+PSJY,0)) F XP=1:1:23 S P(XP)=$P(YP,U,XP)
"RTN","PSGOER",152,0)
 .Q:'($G(P(4))]"")
"RTN","PSGOER",153,0)
 .Q:'$$SCHREQ^PSJLIVFD(.P)
"RTN","PSGOER",154,0)
 .N INTERVAL,LSTSTR,ND0,SCHED,IVSTYP S ND0=$G(^PS(55,PSJX,"IV",+PSJY,0)),INTERVAL=$P(ND0,"^",15),SCHED=$P(ND0,"^",9) Q:SCHED=""
"RTN","PSGOER",155,0)
 .S IVSTYP=$S($$DOW^PSIVUTL(SCHED):"D",INTERVAL="O":"O",1:"C"),LSTSTR=$P(ND0,"^",2)_"^"_$P(ND0,"^",3)_"^"_SCHED_"^"_IVSTYP_"^^"_$P(ND0,"^",11)
"RTN","PSGOER",156,0)
 .S LAST=$$EN^PSBAPIPM(PSJX,PSJY) I LAST,IVSTYP="O",LAST>$P(ND0,"^",2),($P(LAST,"^",3)="G") S CUTOFF=$$FMADD^XLFDT(NOW,,-1) Q
"RTN","PSGOER",157,0)
 .I 'LAST!(LAST>$P(ND0,"^",3))!(LAST&(IVSTYP="O")) S CUTOFF=$$FMADD^XLFDT(NOW,,-1) Q
"RTN","PSGOER",158,0)
 .I IVSTYP="D" S CUTOFF=$$NXTDOW(LAST,SCHED,$G(P(2)),$P($G(P(9)),"@"),$G(P(11))) Q
"RTN","PSGOER",159,0)
 .I SCHED["PRN" S FREQ=$$PRNFREQ(SCHED) S CUTOFF=$$FMADD^XLFDT(LAST,,,FREQ) Q
"RTN","PSGOER",160,0)
 .S LAST=$$EN^PSBAPIPM(PSJX,PSJY) I 'LAST!(LAST>$P(ND0,"^",3)) S CUTOFF=$$FMADD^XLFDT(NOW,,-1) Q
"RTN","PSGOER",161,0)
 .S $P(LSTSTR,"^")=$$FMADD^XLFDT(LAST,,,,1),$P(LSTSTR,"^",2)=$$FMADD^XLFDT(PSGDT,31) S CUTOFF=$$ENQ^PSJORP2(PSJX,LSTSTR)
"RTN","PSGOER",162,0)
 K LYN,PSBDT,PSBFLAG,PSBSTR
"RTN","PSGOER",163,0)
 Q $S(CUTOFF<NOW:1,1:0)
"RTN","PSGOER",164,0)
 ;
"RTN","PSGOER",165,0)
NXTDOW(DOWDFN,DOWSD,DOWFD,DOWSCH,DOWAT) ;
"RTN","PSGOER",166,0)
 N NXTADM,DOWSTR S DOWSTR=$$FMADD^XLFDT(DOWFD,,,,1)_"^"_$$FMADD^XLFDT(DOWFD,7)_"^"_DOWSCH_"^D^^"_DOWAT S NXTADM=$$ENQ^PSJORP2(DOWDFN,DOWSTR)
"RTN","PSGOER",167,0)
 Q $S(NXTADM:NXTADM,1:DOWSD)
"RTN","PSGOER",168,0)
 ;
"RTN","PSGOER",169,0)
PRNFREQ(SCHED) ;
"RTN","PSGOER",170,0)
 N ZZND,D,DA,X,PSGAT,PSGOES,PSGST,PSJNSS,PSJPWD,TEST,VALMBCK,PSGS0XT,PSGS0Y,PSGDT
"RTN","PSGOER",171,0)
 F X=$P(SCHED,"PRN"),$P(SCHED,"PRN",2),$P(SCHED," PRN"),$P(SCHED,"PRN ",2) Q:$P($G(ZZND),"^",4)  D ADMIN^PSJORPOE
"RTN","PSGOER",172,0)
 Q $S($G(PSGS0XT):PSGS0XT,1:1440)
"RTN","PSGOETO")
0^4^B39634920^B38155409
"RTN","PSGOETO",1,0)
PSGOETO ;BIR/CML3-TRANSCRIBE ORDERS ;25 Feb 99 / 1:17 PM
"RTN","PSGOETO",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**3,13,25,31,33,50,68,58,85,105,90,117,110,111,112,161,254,267,268,315**;16 DEC 97;Build 73
"RTN","PSGOETO",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PSGOETO",4,0)
 ; Reference to ^PS(51.2 is supported by DBIA #2178.
"RTN","PSGOETO",5,0)
 ; Reference to ^PS(55 is supported by DBIA #2191.
"RTN","PSGOETO",6,0)
 ; Reference to ^PS(59.7 is supported by DBIA #2181.
"RTN","PSGOETO",7,0)
 ; Reference to ^PSUHL is supported by DBIA 4803.
"RTN","PSGOETO",8,0)
 ;
"RTN","PSGOETO",9,0)
 W:'$D(PSGOEE)&'$D(PSGOES) !!,"...transcribing this ",$S($D(PSGOES):"",'PSGOEAV:"non-verified ",1:"active "),"order..." S PSGOETOF=1 S:PSGSM="" PSGSM=0
"RTN","PSGOETO",10,0)
 I PSGPR'=PSGOEPR D:'$D(^PS(55,PSGP,0)) ENSET0^PSGNE3(PSGP) S $P(^PS(55,PSGP,5.1),U,2)=PSGPR,PSGOEPR=PSGPR
"RTN","PSGOETO",11,0)
 K ND4,DA D ENGNN:'PSGOEAV,ENGNA:PSGOEAV S PSGDT=$$DATE^PSJUTL2() I $S($D(ORACTION):0,$G(PSGOEE)="R":1,+$G(^PS(55,PSGP,5.1))>PSGDT:0,1:$G(PSGOEE)'="E") D ENWALL^PSGNE3(PSGNESD,PSGNEFD,PSGP)
"RTN","PSGOETO",12,0)
 I $D(^PS(51.2,+PSGMR,0)),$P(^(0),U,3)]"" S PSGMRN=$P(^(0),U,3)
"RTN","PSGOETO",13,0)
 S ND=DA_U_PSGPR_U_PSGMR_"^U^"_PSGSM_U_PSGHSM_U_PSGST_"^^"_$S(PSGOEAV:"A",1:"N")_"^^^^^"_PSGDT_U_PSGP_U_PSGDT S:PSGNEDFD $P(ND,U,$P(PSGNEDFD,U)["L"+10)=+PSGNEDFD
"RTN","PSGOETO",14,0)
 S:$D(PSGOEE) $P(ND,U,24,25)=PSGOEE_U_PSGOORD S:'PSGOEAV $P(ND,U,18)=DA S ND2=PSGSCH_U_$S(+PSGNESD=PSGNESD:+PSGNESD,1:"")_"^^"_+PSGNEFD_U_PSGS0Y_U_PSGS0XT_"^^^^"_+PSJPWD
"RTN","PSGOETO",15,0)
 S:$G(PSGRF)]"" ND2P1=$G(PSGDUR)_U_$G(PSGRMVT)_U_$G(PSGRMV)_U_$G(PSGRF) ;*315 drp
"RTN","PSGOETO",16,0)
 ; naked reference below refers to ^PS(55,PSGP,0)
"RTN","PSGOETO",17,0)
 I PSGOEAV S F=^PS(55,PSGP,0) I $P(F,"^",7)="" S $P(F,"^",7)=$P($P(ND,"^",16),"."),$P(F,"^",8)="A",^(0)=F D LOGDFN^PSUHL(PSGP)
"RTN","PSGOETO",18,0)
 S $P(ND4,U,7)=DUZ I PSGOEAV,PSJSYSU D
"RTN","PSGOETO",19,0)
 .S $P(ND4,U,PSJSYSU,PSJSYSU+1)=DUZ_U_PSGDT,$P(ND4,U,+PSJSYSU=1+9)=1,$P(ND4,U,+PSJSYSU=3+9)=0
"RTN","PSGOETO",20,0)
 .S $P(ND4,U,9,10)=+$P(ND4,U,9)_U_+$P(ND4,U,10)
"RTN","PSGOETO",21,0)
 .I '$P(ND4,U,9) S ^PS(55,"APV",PSGP,DA)=""
"RTN","PSGOETO",22,0)
 .I '$P(ND4,U,10) S ^PS(55,"NPV",PSGP,DA)=""
"RTN","PSGOETO",23,0)
 .I $P(ND4,U,9) K ^PS(55,"APV",PSGP,DA)
"RTN","PSGOETO",24,0)
 .I $P(ND4,U,10) K ^PS(55,"NPV",PSGP,DA)
"RTN","PSGOETO",25,0)
 S F="^PS("_$S(PSGOEAV:"55,"_PSGP_",5",1:53.1)_","_DA_",",@(F_"0)")=ND
"RTN","PSGOETO",26,0)
 ;naked reference below refers to full reference inside indirection @(F_".2)") for either file 53.1 or 55
"RTN","PSGOETO",27,0)
 S @(F_".2)")=PSGPDRG_U_PSGDO_U_PSJNOO S:$G(PSJDOSE("DO"))]"" $P(^(.2),U,5,6)=$P(PSJDOSE("DO"),U,1,2)
"RTN","PSGOETO",28,0)
 I '$D(PSJDOSE("DO")),$D(PSGORD),PSGPDRG=$P(@("^PS("_$S(PSGORD["U":"55,"_PSGP_",5",1:53.1)_","_+PSGORD_",.2)"),U) S $P(@(F_".2)"),U,5,6)=$P(@("^PS("_$S(PSGORD["U":"55,"_PSGP_",5",1:53.1)_","_+PSGORD_",.2)"),U,5,6)
"RTN","PSGOETO",29,0)
 ;naked reference below refers to full reference inside indirection @(F_"2)") for either file 53.1 or 55
"RTN","PSGOETO",30,0)
 S @(F_"2)")=$S(PSGOEAV:ND2,1:$P(ND2,"^",1,6)),^(4)=ND4 S:PSGSI]"" ^(6)=PSGSI
"RTN","PSGOETO",31,0)
 ;*315 DRP INSERT UPDATE FOR REMOVAL FIELDS HERE
"RTN","PSGOETO",32,0)
 S:$G(ND2P1)]"" @(F_"2.1)")=ND2P1
"RTN","PSGOETO",33,0)
 S X=-1 S:'$D(^PS(53.45,+$G(DUZ),5,1,0)) X=$S($G(PSGORD):$$GETSIOPI^PSJBCMA5(DFN,PSGORD),1:"") I X D FILESI^PSJBCMA5(PSGP,DA_$S(F["PS(55":"U",1:"P"))
"RTN","PSGOETO",34,0)
 S (C,X)=0 F  S X=$O(^PS(53.45,PSJSYSP,2,X)) Q:'X  S D=$G(^(X,0)) I D,$S('$P(D,U,3):1,1:$P(D,U,3)>DT) S C=C+1,@(F_"1,"_C_",0)")=$P(D,U,1,2),@(F_"1,""B"","_+D_","_C_")")=""
"RTN","PSGOETO",35,0)
 S:C @(F_"1,0)")=U_$S(PSGOEAV:55.07,1:53.11)_"P^"_C_U_C
"RTN","PSGOETO",36,0)
 S (C,Q)=0 F  S Q=$O(^PS(53.45,PSJSYSP,1,Q)) Q:'Q  S X=$G(^(Q,0)) S:X]"" C=C+1,@(F_"3,"_C_",0)")=X
"RTN","PSGOETO",37,0)
 S:C @(F_"3,0)")=U_$S(PSGOEAV:55.08,1:53.12)_U_C_U_C
"RTN","PSGOETO",38,0)
 I $P(ND,U,24)="R" S %X="^PS(55,"_PSGP_",5,"_+PSGORD_",12,",%Y=F_"12," D %XY^%RCR
"RTN","PSGOETO",39,0)
 W "." D CRN:'PSGOEAV,CRA:PSGOEAV
"RTN","PSGOETO",40,0)
 ; don't send message to CPRS if from Order Set and autoverify turned off
"RTN","PSGOETO",41,0)
 S PSGORD=DA_$S(PSGOEAV:"U",1:"P")
"RTN","PSGOETO",42,0)
 I $G(PSGOORD),$D(PSGOEE) N CLINAPPT S CLINAPPT=$S(PSGOORD["U":$G(^PS(55,PSGP,5,+PSGOORD,8)),PSGOORD["P":$G(^PS(53.1,+PSGOORD,"DSS")),1:"") I CLINAPPT D
"RTN","PSGOETO",43,0)
 .N DIE,DA,DR
"RTN","PSGOETO",44,0)
 .I PSGORD["U" S DIE="^PS(55,"_PSGP_",5,",DA=+PSGORD,DA(1)=PSGP,DR="130////"_+CLINAPPT_";" S:$P(CLINAPPT,"^",2) DR=DR_"131////"_$P(CLINAPPT,"^",2)_";"
"RTN","PSGOETO",45,0)
 .I PSGORD["P" S DIE="^PS(53.1,",DA=+PSGORD,DR="113////"_+CLINAPPT_";" S:$P(CLINAPPT,"^",2) DR=DR_"126////"_$P(CLINAPPT,"^",2)_";"
"RTN","PSGOETO",46,0)
 .I $G(DR) D ^DIE
"RTN","PSGOETO",47,0)
 D:('$D(PSGOES))!(($D(PSGOES)&(PSGOEAV))) ORSET^PSGOETO1
"RTN","PSGOETO",48,0)
 I $D(PSGOES),'$D(PSGOESON) N PSGOESON S PSGOESON=PSGORD D DISACTIO^PSJOE(DFN,PSGORD,0) D:PSGORD["U"&(PSGOESON=PSGORD)&($P(@(PSGOEEWF_"0)"),"^",9)'="D") EN^PSGPEN(PSGORD) G OUT
"RTN","PSGOETO",49,0)
 D DONE S PSGCANFL="" I '$D(PSGOEE) S PSJLM=1,PSGOEEF=0 D GETUD^PSJLMGUD(PSGP,PSGORD),ENSFE^PSGOEE0(PSGP,PSGORD),EN^VALM("PSJ LM ACCEPT") I PSGCANFL=1 G OUT
"RTN","PSGOETO",50,0)
 I $D(PSJSYSO) S PSGPOSA="W",PSGPOSD=PSGDT D ENPOS^PSGVDS
"RTN","PSGOETO",51,0)
 S DA=+PSGORD,X=$P(PSGORD,DA,2) I PSJSYSL,$S(PSGOEAV:1,1:PSJSYSL<3),$S("AOU"[X:'$D(^PS(55,PSGP,5,+PSGORD,7)),1:'$D(^PS(53.1,+PSGORD,7))) D
"RTN","PSGOETO",52,0)
 .; naked ref below is from line above, ^PS(53.1,+PSGORD,7)
"RTN","PSGOETO",53,0)
 .S $P(^(7),U,1,2)=PSGDT_"^N"_$G(PSGOEE),PSGUOW=DUZ,PSGTOL=2,PSGTOO=$S("AOU"[X:1,1:2) D ENL^PSGVDS
"RTN","PSGOETO",54,0)
 D STOREINT^PSGSICH1
"RTN","PSGOETO",55,0)
OUT ;
"RTN","PSGOETO",56,0)
 K PSGOETOF
"RTN","PSGOETO",57,0)
  ; ** This is where the Automated Dispensing Machine hook is called. Do NOT DELETE or change location **
"RTN","PSGOETO",58,0)
 D NEWG^PSJADM
"RTN","PSGOETO",59,0)
  ; ** END of Interface hook **
"RTN","PSGOETO",60,0)
DONE ;
"RTN","PSGOETO",61,0)
 I PSGOEAV L -^PS(55,PSGP,5,+PSGORD)
"RTN","PSGOETO",62,0)
 I 'PSGOEAV L -^PS(53.1,+PSGORD)
"RTN","PSGOETO",63,0)
 K C,D,ND,ND2,ND4,PSGDO,PSGDRG,PSGDRGN,PSGFOK,PSGHSM,PSGMR,PSGMRN,PSGNEDFD,PSGNEFD,PSGNESD,PSGPDRG,PSGPDRGN,PSGSI,PSGSTN,PSJDOSE,ND0,ND2P1
"RTN","PSGOETO",64,0)
 K ^PS(53.45,+$G(DUZ),5)
"RTN","PSGOETO",65,0)
 Q
"RTN","PSGOETO",66,0)
CRA ;
"RTN","PSGOETO",67,0)
 S:PSGPDRG ^PS(55,PSGP,5,"C",PSGPDRG,DA)="" S (^PS(55,"AUE",PSGP,DA),^PS(55,PSGP,5,"AU",PSGST,+PSGNEFD,DA),^PS(55,PSGP,5,"AUS",+PSGNEFD,DA))="",^PS(55,"AUD",+$P(ND2,"^",4),PSGP,DA)="",^PS(55,"AUDS",+$P(ND2,"^",2),PSGP,DA)=""
"RTN","PSGOETO",68,0)
 I $$PATCH^XPDUTL("PXRM*1.5*12") S X(1)=+PSGNESD,X(2)=+PSGNEFD,DA(1)=PSGP D SPSPA^PSJXRFS(.X,.DA,"UD")
"RTN","PSGOETO",69,0)
 S DA(1)=PSGP K DIK S DIK="^PS(55,"_DA(1)_",5,",DIK(1)=125 D EN1^DIK K DIK
"RTN","PSGOETO",70,0)
 K PSGALO,PSGALR S DA(1)=PSGP,PSGAL("C")=PSJSYSU*10+$S('$D(PSGOEE):22500,PSGOEE="E":22600,1:22700) D ^PSGAL5 Q
"RTN","PSGOETO",71,0)
CRN ;
"RTN","PSGOETO",72,0)
 S (^PS(53.1,"AC",PSGP,DA),^PS(53.1,"AS","N",PSGP,DA),^PS(53.1,"B",DA,DA),^PS(53.1,"C",PSGP,DA))="" S:PSGPDRG (^PS(53.1,"AOD",PSGP,PSGPDRG,DA),^PS(53.1,"D",PSGPDRG,DA))="" Q
"RTN","PSGOETO",73,0)
ENGNA ; Verified
"RTN","PSGOETO",74,0)
 F  L +^PS(55,PSGP,5,0):$S($G(DILOCKTM)>0:DILOCKTM,1:3) S:'$D(^PS(55,PSGP,0)) ^(0)=PSGP,^PS(55,"B",PSGP,PSGP)="" S ND=$S($D(^PS(55,PSGP,5,0)):^(0),1:"^55.06IA") Q
"RTN","PSGOETO",75,0)
 N PSGLCK S PSGLCK=0
"RTN","PSGOETO",76,0)
 F DA=$P(ND,U,3)+1:1 W "." I '$D(^PS(55,PSGP,5,DA)),'$D(^PS(55,PSGP,5,"B",DA)) D  I PSGLCK S ^PS(55,PSGP,5,DA,0)=DA,^PS(55,PSGP,5,"B",DA,DA)="",$P(ND,U,3)=DA,$P(ND,U,4)=$P(ND,U,4)+1,^PS(55,PSGP,5,0)=ND Q
"RTN","PSGOETO",77,0)
 . L +^PS(55,PSGP,5,DA):$S($G(DILOCKTM)>0:DILOCKTM,1:3) I  S PSGLCK=1
"RTN","PSGOETO",78,0)
 L -^PS(55,PSGP,5,0) Q
"RTN","PSGOETO",79,0)
ENGNN ; Not Verified
"RTN","PSGOETO",80,0)
 N ND F  L +^PS(59.7,1,25):$S($G(DILOCKTM)>0:DILOCKTM,1:3) I  S DA=+$G(^PS(59.7,1,25)) Q
"RTN","PSGOETO",81,0)
 F DA=DA+1:1 I '$D(^PS(53.1,DA)),'$D(^PS(53.1,"B",DA)) L +^PS(53.1,DA):$S($G(DILOCKTM)>0:DILOCKTM,1:3) I  S ^PS(59.7,1,25)=DA,^PS(53.1,DA,0)=DA,^PS(53.1,"B",DA,DA)="" Q
"RTN","PSGOETO",82,0)
 F  L +^PS(53.1,0):$S($G(DILOCKTM)>0:DILOCKTM,1:3) I  S ND=$G(^PS(53.1,0)),$P(ND,U,3)=DA,$P(ND,U,4)=$P(ND,U,4)+1,^(0)=ND Q
"RTN","PSGOETO",83,0)
 L -^PS(59.7,1,25),-^PS(53.1,0)
"RTN","PSGOETO",84,0)
 I $G(PSIVCHG) D
"RTN","PSGOETO",85,0)
 .N PSGORD,ON S ON=DA_"P" D SETIVINT^PSGSICH1
"RTN","PSGOETO",86,0)
 Q
"RTN","PSGOT")
0^28^B23271906^B23046911
"RTN","PSGOT",1,0)
PSGOT ;BIR/CML3-TRANSFERS DATA FROM 53.1 TO 55 ;24 SEP 97 / 7:54 AM
"RTN","PSGOT",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**13,68,90,110,173,134,161,254,267,257,315**;16 DEC 97;Build 73
"RTN","PSGOT",3,0)
 ;
"RTN","PSGOT",4,0)
 ; Reference to ^PS(55 supported by DBIA 2191.
"RTN","PSGOT",5,0)
 ; Reference to ^PSUHL supported by DBIA 4803.
"RTN","PSGOT",6,0)
 ;
"RTN","PSGOT",7,0)
START ; get internal record number, lock record, and write
"RTN","PSGOT",8,0)
 S ODA=+PSGORD S:$D(^PS(55,PSGP,0))[0 ^(0)=PSGP,^PS(55,"B",PSGP,PSGP)="",$P(^PS(55,0),U,3,4)=PSGP_U_($P($G(^PS(55,0)),U,4)+1) F  L +^PS(55,PSGP,5,0):$S($G(DILOCKTM)>0:DILOCKTM,1:3) I  Q
"RTN","PSGOT",9,0)
 S ZND=$G(^PS(55,PSGP,5,0)) S:ZND="" ZND="^55.06IA" F DA=$P(ZND,"^",3)+1:1 I '$D(^PS(55,PSGP,5,DA)),'$D(^("B",DA)) L +^PS(55,PSGP,5,DA):$S($G(DILOCKTM)>0:DILOCKTM,1:3) I  S $P(ZND,"^",3)=DA,$P(ZND,"^",4)=$P(ZND,"^",4)+1,^PS(55,PSGP,5,0)=ZND Q
"RTN","PSGOT",10,0)
 L -^PS(55,PSGP,5,0) S ND0=^PS(53.1,ODA,0),$P(ND0,"^",23)=PSJPWD,^PS(55,PSGP,5,DA,0)=ND0
"RTN","PSGOT",11,0)
 S (ND1,^PS(55,PSGP,5,DA,.2))=$G(^PS(53.1,ODA,.2)),^PS(55,PSGP,5,DA,.3)=$G(^PS(53.1,ODA,.3)),(ND2,^PS(55,PSGP,5,DA,2))=^PS(53.1,ODA,2),(ND2P1,^PS(55,PSGP,5,DA,2.1))=$G(^PS(53.1,ODA,2.1)) ;*315 DRP
"RTN","PSGOT",12,0)
 S ^PS(55,PSGP,5,DA,4)=$G(^PS(53.1,ODA,4)),^PS(55,"AUD",+$P(ND2,"^",4),PSGP,DA)=""
"RTN","PSGOT",13,0)
 S X=^PS(55,PSGP,0) I $P(X,"^",7)="" S $P(X,"^",7)=$P($P(ND0,"^",16),"."),$P(X,"^",8)="A",^(0)=X D LOGDFN^PSUHL(PSGP)
"RTN","PSGOT",14,0)
 I $P($G(^PS(55,PSGP,5,DA,2)),"^",6)="" S $P(^PS(55,PSGP,5,DA,2),"^",6)=$S($G(PSGS0XT)'="":PSGS0XT,$P($G(ZZND),"^",3)'="":$P(ZZND,"^",3),1:""),$P(^PS(53.1,ODA,2),"^",6)=$P(^PS(55,PSGP,5,DA,2),"^",6)
"RTN","PSGOT",15,0)
 F X=6,7,13 I $D(^PS(53.1,ODA,X)) S ^PS(55,PSGP,5,DA,X)=^(X)
"RTN","PSGOT",16,0)
 I $D(^PS(53.1,ODA,"DSS")) S ^PS(55,PSGP,5,DA,8)=^("DSS") D CIMOU^PSJIMO1(PSGP,DA,"",ODA)
"RTN","PSGOT",17,0)
 I $O(^PS(53.1,ODA,1,0)) S (C,X)=0 F  S X=$O(^PS(53.1,ODA,1,X)) Q:'X  S:$D(^(X,0)) C=C+1,^PS(55,PSGP,5,DA,1,C,0)=^(0),^PS(55,PSGP,5,DA,1,"B",+$P($G(^(0)),U),C)=""
"RTN","PSGOT",18,0)
 I $O(^PS(53.1,ODA,1,0)) S ^PS(55,PSGP,5,DA,1,0)="^55.07P^"_C_"^"_C
"RTN","PSGOT",19,0)
 F X=3,12 D  S ^PS(55,PSGP,5,DA,X,0)="^55.0"_$S(X=3:8,1:612)_U_CNT_U_CNT
"RTN","PSGOT",20,0)
 .S CNT=0 F C=0:0 S C=$O(^PS(53.1,ODA,X,C)) Q:'C  I $D(^(C,0)) S ^PS(55,PSGP,5,DA,X,C,0)=^(0),CNT=CNT+1
"RTN","PSGOT",21,0)
 S $P(^PS(53.1,ODA,0),"^",19)=DA
"RTN","PSGOT",22,0)
 D SETUDINT^PSGSICH1(ODA_"P",DA_"U")
"RTN","PSGOT",23,0)
CR ; set x-refs
"RTN","PSGOT",24,0)
 N A
"RTN","PSGOT",25,0)
 I $D(^PS(55,PSGP,5.1)),$P(^(5.1),"^",6) S X=$P(^(5.1),"^",6) I $P(ND2,"^",3),$P(ND2,"^",6)'>X S $P(^(5.1),"^",6)=$P(ND2,"^",3)
"RTN","PSGOT",26,0)
 S ^PS(55,PSGP,5,"B",+ODA,DA)="",^PS(55,PSGP,5,"AU",$P(ND0,"^",7),+$P(ND2,"^",4),DA)=""
"RTN","PSGOT",27,0)
 S ^PS(55,PSGP,5,"AUS",+$P(ND2,"^",4),DA)=""
"RTN","PSGOT",28,0)
 S ^PS(55,PSGP,5,"C",+ND1,DA)="",^PS(55,"AUE",PSGP,DA)=""
"RTN","PSGOT",29,0)
 S ^PS(55,"AUDS",+$P(ND2,"^",2),PSGP,DA)=""
"RTN","PSGOT",30,0)
 I $D(^PS(55,PSGP,5,DA,8)) S A=^(8),^PS(55,"AUDC",+$P(ND2,"^",4),+A,PSGP,DA)=""
"RTN","PSGOT",31,0)
 I $$PATCH^XPDUTL("PXRM*1.5*12") S X(1)=+$P(ND2,"^",2),X(2)=+$P(ND2,"^",4),DA(1)=PSGP D SPSPA^PSJXRFS(.X,.DA,"UD")
"RTN","PSGOT",32,0)
 K DIK S DA(1)=PSGP S DIK="^PS(55,"_DA(1)_",5,",DIK(1)=125 D EN1^DIK K DIK
"RTN","PSGOT",33,0)
 S PSGTOL=2,PSGTOO=1 F PSGUOW=0:0 S PSGUOW=$O(^PS(53.41,2,1,PSGUOW)) Q:'PSGUOW  I $D(^(PSGUOW,1,PSGP,1,2,1,+ODA)) K ^(+ODA) D ENL^PSGVDS
"RTN","PSGOT",34,0)
DONE I $D(PSGOE2),PSGOE2]"",$D(^TMP("PSJON",$J,PSGOE2)) S ^(PSGOE2)=DA_"U"
"RTN","PSGOT",35,0)
 N PSJTMPTX,PSJOVRMX,PSJTMPLIN
"RTN","PSGOT",36,0)
 S PSGODA=ODA,PSGORD=DA_"U"
"RTN","PSGOT",37,0)
 S PSGNODE=$G(^PS(55,PSGP,5,DA,0)),PSG25=$P(PSGNODE,"^",25),PSG26=$P(PSGNODE,"^",26)
"RTN","PSGOT",38,0)
 I PSG25 S X=$S(PSG25["V":"^PS(55,"_PSGP_",""IV"",",PSG25["U"!(PSG25["A"):"^PS(55,"_PSGP_",5,",1:"^PS(53.1,")_+PSG25_","_$E("02",PSG25["V"+1)_")" I $D(@X) S $P(@X,"^",$S(PSG25["V":6,1:26))=DA_"U"
"RTN","PSGOT",39,0)
 I $P(PSGNODE,"^",26),$P(PSGNODE,"^",26)'["V",$D(^PS(55,PSGP,5,+$P(PSGNODE,"^",26),0)) S $P(^(0),"^",25)=DA_"U"
"RTN","PSGOT",40,0)
 F Q=0:0 S Q=$O(^PS(53.44,Q)) Q:'Q  I $D(^(Q,1,PSGP,+ODA,0)) S $P(^(0),"^",2)=DA
"RTN","PSGOT",41,0)
 I $D(^PS(53.1,+ODA,15,0)) S ^PS(55,PSGP,5,DA,15,0)="^55.6135^"_$P($G(^PS(53.1,+ODA,15,0)),"^",3)_"^"_$P($G(^PS(53.1,+ODA,15,0)),"^",4) D
"RTN","PSGOT",42,0)
 .N LN,LNCNT,SIMSG S SIMSG="Instructions too long. See Order View or BCMA for full text."
"RTN","PSGOT",43,0)
 .S LNCNT=0,LN=9999 F  S LN=$O(^PS(53.1,+ODA,15,LN),-1) Q:'LN  D
"RTN","PSGOT",44,0)
 ..I 'LNCNT,($G(^PS(53.1,+ODA,15,LN,0))="") Q
"RTN","PSGOT",45,0)
 ..S ^PS(55,PSGP,5,DA,15,LN,0)=^PS(53.1,+ODA,15,LN,0) S LNCNT=LNCNT+1
"RTN","PSGOT",46,0)
 .I LNCNT S $P(^PS(55,PSGP,5,DA,15,0),"^",3,4)=LNCNT_"^"_LNCNT
"RTN","PSGOT",47,0)
 .S PSJTMPTX="",PSJOVRMX=0 S TMPLIN=0 F  S TMPLIN=$O(^PS(55,+DFN,5,DA,15,TMPLIN)) Q:'TMPLIN!(PSJOVRMX)  D
"RTN","PSGOT",48,0)
 ..S:($L(PSJTMPTX)+$L($G(^PS(55,+DFN,5,DA,15,TMPLIN,0))))>180 PSJOVRMX=1 Q:$G(PSJOVRMX)  S PSJTMPTX=$G(PSJTMPTX)_$S($G(PSJTMPTX)]"":" ",1:"")_$G(^PS(55,+DFN,5,DA,15,TMPLIN,0))
"RTN","PSGOT",49,0)
 .S TXT=$S(PSJOVRMX:SIMSG,1:PSJTMPTX)
"RTN","PSGOT",50,0)
 .S:($TR(TXT,"^ ")="")!'($D(^PS(55,PSGP,5,DA,15,1))) TXT="" S ^PS(55,PSGP,5,DA,6)=TXT S $P(^PS(55,PSGP,5,DA,6),"^",2)=$P(^PS(53.1,+ODA,6),"^",2)
"RTN","PSGOT",51,0)
 .N LSTLNUM,LSTLNTXT S LSTLNUM=$O(^PS(55,+PSGP,5,+DA,15,""),-1) I LSTLNUM>1 S LSTLNTXT=$G(^PS(55,+PSGP,5,+DA,15,LSTLNUM,0)) I $TR(LSTLNTXT," ")="" D
"RTN","PSGOT",52,0)
 ..K ^PS(55,+PSGP,5,+DA,15,LSTLNUM,0)
"RTN","PSGOT",53,0)
 L -^PS(53.1,+ODA) L -^PS(55,PSGP,5,+DA) K CNT,ND,ODA,XX,ZND
"RTN","PSGOT",54,0)
 Q
"RTN","PSGOT",55,0)
 ;
"RTN","PSGOTR")
0^29^B22276864^B21776310
"RTN","PSGOTR",1,0)
PSGOTR ;BIR/CML3-TRANSFERS RENEW DATA FROM 53.1 TO 55 ;23 SEP 03 / 7:54 AM
"RTN","PSGOTR",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**110,127,133,129,267,257,255,315**;16 DEC 97;Build 73
"RTN","PSGOTR",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PSGOTR",4,0)
 ; Reference to ^PS(55 supported by DBIA 2191.
"RTN","PSGOTR",5,0)
 ;
"RTN","PSGOTR",6,0)
START(ODA,DA) ; lock record, and write
"RTN","PSGOTR",7,0)
 N OFD,PVND4,PSGPV S OFD=""
"RTN","PSGOTR",8,0)
 S OFD=$P($G(^PS(55,PSGP,5,DA,2)),"^",4) K:OFD ^PS(55,"AUD",+OFD,PSGP,+DA)
"RTN","PSGOTR",9,0)
 S ND2=^PS(53.1,+ODA,2) S ^PS(55,"AUD",+$P(ND2,"^",4),PSGP,DA)=""
"RTN","PSGOTR",10,0)
 S ND2P1=^PS(53.1,+ODA,2.1) ;*315
"RTN","PSGOTR",11,0)
 ;PSJ*5*255 - Record renewing provider
"RTN","PSGOTR",12,0)
 I $P(^PS(53.1,+ODA,0),U,2)]"" S PSGPV=$P(^PS(53.1,+ODA,0),U,2) D
"RTN","PSGOTR",13,0)
 . N DR,DIE
"RTN","PSGOTR",14,0)
 . S DR="1////^S X=PSGPV",DIE="^PS(55,"_PSGP_",5,",DA(1)=PSGP D ^DIE
"RTN","PSGOTR",15,0)
 ;End PSJ*5*255
"RTN","PSGOTR",16,0)
 F X=6,7 I $D(^PS(53.1,+ODA,X)) S ^PS(55,PSGP,5,DA,X)=^(X)
"RTN","PSGOTR",17,0)
 I $O(^PS(53.1,+ODA,1,0)) D
"RTN","PSGOTR",18,0)
 .K ^PS(55,PSGP,5,DA,1)
"RTN","PSGOTR",19,0)
 .S (C,X)=0 F  S X=$O(^PS(53.1,+ODA,1,X)) Q:'X  S:$D(^(X,0)) C=C+1,^PS(55,PSGP,5,DA,1,C,0)=^(0),^PS(55,PSGP,5,DA,1,"B",+$P($G(^(0)),U),C)=""
"RTN","PSGOTR",20,0)
 .S ^PS(55,PSGP,5,DA,1,0)="^55.07P^"_C_"^"_C
"RTN","PSGOTR",21,0)
 F X=3,12 D  S ^PS(55,PSGP,5,DA,X,0)="^55.0"_$S(X=3:8,1:612)_U_CNT_U_CNT
"RTN","PSGOTR",22,0)
 .S CNT=0 F C=0:0 S C=$O(^PS(53.1,+ODA,X,C)) Q:'C  I $D(^(C,0)) S ^PS(55,PSGP,5,DA,X,C,0)=^(0),CNT=CNT+1
"RTN","PSGOTR",23,0)
 S $P(^PS(53.1,+ODA,0),"^",19)=DA
"RTN","PSGOTR",24,0)
 S $P(^PS(55,PSGP,5,DA,0),"^",7)=$P(^PS(53.1,+ODA,0),"^",7)
"RTN","PSGOTR",25,0)
 N PSGPND0,PSGPND2,RDUZ,OND14 S PSGPND0=^PS(53.1,+ODA,0),PSGPND2=^(2) S RNWDT=$P(PSGPND0,"^",16),PSGOEPR=$P(PSGPND0,"^",2)
"RTN","PSGOTR",26,0)
 S PSGFD=$P(PSGPND2,"^",4),PSJNOO=$P(^PS(53.1,+ODA,.2),"^",3) S OND14=$$LASTREN^PSJLMPRI(PSGP,+ODA_"P") S RDUZ=$P(OND14,"^",2) S:$P(OND14,"^",3) PSGOEPR=$P(OND14,"^",3)
"RTN","PSGOTR",27,0)
 I '$G(DUOUT) D
"RTN","PSGOTR",28,0)
 .I $G(PSJORD)["P" N PSGFDO S PSGFDO=$$LASTREN^PSJLMPRI(PSGP,PSJORD),PSGFDO=$P(PSGFDO,"^",4)
"RTN","PSGOTR",29,0)
 .D UPDREN^PSGOER(DA_"U",RNWDT,PSGOEPR,$S($G(PSGFDO):PSGFDO,1:PSGFD),PSJNOO,RDUZ)
"RTN","PSGOTR",30,0)
 S PVND4=$G(^PS(53.1,+ODA,4)) I $P(PVND4,"^"),$P(PVND4,"^",2) D
"RTN","PSGOTR",31,0)
 .N RNDT S RNDT=$$LASTREN^PSJLMPRI(DFN,+ODA_"P") Q:RNDT>$P(PVND4,"^",2)
"RTN","PSGOTR",32,0)
 .S $P(^PS(55,DFN,5,DA,4),"^")=$P(PVND4,"^"),$P(^PS(55,DFN,5,DA,4),"^",2)=$P(PVND4,"^",2)
"RTN","PSGOTR",33,0)
CR ; set x-refs
"RTN","PSGOTR",34,0)
 I $D(^PS(55,PSGP,5.1)),$P(^(5.1),"^",6) S X=$P(^(5.1),"^",6) I $P(ND2,"^",3),$P(ND2,"^",6)'>X S $P(^(5.1),"^",6)=$P(ND2,"^",3)
"RTN","PSGOTR",35,0)
 S ^PS(55,PSGP,5,"B",+ODA,DA)="",^PS(55,"AUE",PSGP,DA)=""
"RTN","PSGOTR",36,0)
 F S="C","O","P","R","OC" K ^PS(55,PSGP,5,"AU",S,+$P(PSGPND2,"^",4),DA)
"RTN","PSGOTR",37,0)
 ; PSJ*5.0*255/kill old "AU" x-ref of the last stop date
"RTN","PSGOTR",38,0)
 I $P(OND14,"^",4) F S="C","O","P","R","OC" K ^PS(55,PSGP,5,"AU",S,+$P(OND14,"^",4),DA)
"RTN","PSGOTR",39,0)
 S ^PS(55,PSGP,5,"AU",$P(PSGPND0,"^",7),+$P(PSGPND2,"^",4),DA)=""
"RTN","PSGOTR",40,0)
 S ^PS(55,PSGP,5,"AUS",+$P(ND2,"^",4),DA)="" I OFD,OFD'=$P(ND2,"^",4) K ^PS(55,PSGP,5,"AUS",+OFD,DA)
"RTN","PSGOTR",41,0)
 D CIMOU^PSJIMO1(PSGP,DA,"",ODA)
"RTN","PSGOTR",42,0)
 I $$PATCH^XPDUTL("PXRM*1.5*12") S X(1)=+$P(ND2,"^",2),X(2)=+$P(ND2,"^",4),DA(1)=PSGP D SPSPA^PSJXRFS(.X,.DA,"UD")
"RTN","PSGOTR",43,0)
 K DIK S DA(1)=PSGP S DIK="^PS(55,"_DA(1)_",5,",DIK(1)=125 D EN1^DIK K DIK
"RTN","PSGOTR",44,0)
 S PSGTOL=2,PSGTOO=1 F PSGUOW=0:0 S PSGUOW=$O(^PS(53.41,2,1,PSGUOW)) Q:'PSGUOW  I $D(^(PSGUOW,1,PSGP,1,2,1,+ODA)) K ^(+ODA) D ENL^PSGVDS
"RTN","PSGOTR",45,0)
DONE I $D(PSGOE2),PSGOE2]"",$D(^TMP("PSJON",$J,PSGOE2)) S ^(PSGOE2)=DA_"U"
"RTN","PSGOTR",46,0)
 S PSGODA=ODA,PSGORD=DA_"U"
"RTN","PSGOTR",47,0)
 F Q=0:0 S Q=$O(^PS(53.44,Q)) Q:'Q  I $D(^(Q,1,PSGP,+ODA,0)) S $P(^(0),"^",2)=DA
"RTN","PSGOTR",48,0)
 I $D(^PS(53.1,+ODA,15,0)) N SIARRAY D
"RTN","PSGOTR",49,0)
 .M SIARRAY=^PS(55,PSGP,5,+DA,15) I $$DIFFSI^PSJBCMA5(PSGP,+DA_"U") D NEWUDAL^PSGAL5(PSGP,+DA_"U",6000,"SPECIAL INSTRUCTIONS",,.SIARRAY)
"RTN","PSGOTR",50,0)
 .K ^PS(55,PSGP,5,DA,15) S ^PS(55,PSGP,5,DA,6)=$G(^PS(53.1,+ODA,6)) S ^PS(55,PSGP,5,DA,15,0)="^55.6135^"_$P($G(^PS(53.1,+ODA,15,0)),"^",3)_"^"_$P($G(^PS(53.1,+ODA,15,0)),"^",4)
"RTN","PSGOTR",51,0)
 .N LN,LNCNT S LNCNT=0,LN=9999 F  S LN=$O(^PS(53.1,+ODA,15,LN),-1) Q:'LN  D
"RTN","PSGOTR",52,0)
 ..I 'LNCNT,($G(^PS(53.1,+ODA,15,LN,0))="") Q
"RTN","PSGOTR",53,0)
 ..S ^PS(55,PSGP,5,DA,15,LN,0)=^PS(53.1,+ODA,15,LN,0) S LNCNT=LNCNT+1
"RTN","PSGOTR",54,0)
 .I LNCNT S $P(^PS(55,PSGP,5,DA,15,0),"^",3,4)=LNCNT_"^"_LNCNT
"RTN","PSGOTR",55,0)
 .N TXT,LNCNT,SIMSG S LNCNT=$O(^PS(53.1,+ODA,15,""),-1) S SIMSG="Instructions too long. See Order View or BCMA for full text."
"RTN","PSGOTR",56,0)
 .S PSJTMPTX="",PSJOVRMX=0 S TMPLIN=0 F  S TMPLIN=$O(^PS(55,+DFN,5,DA,15,TMPLIN)) Q:'TMPLIN!(PSJOVRMX)  D
"RTN","PSGOTR",57,0)
 ..S:($L(PSJTMPTX)+$L($G(^PS(55,+DFN,5,DA,15,TMPLIN,0))))>180 PSJOVRMX=1 Q:$G(PSJOVRMX)  S PSJTMPTX=$G(PSJTMPTX)_$S($G(PSJTMPTX)]"":" ",1:"")_$G(^PS(55,+DFN,5,DA,15,TMPLIN,0))
"RTN","PSGOTR",58,0)
 .S TXT=$S(PSJOVRMX:SIMSG,1:PSJTMPTX)
"RTN","PSGOTR",59,0)
 .S:($TR(TXT,"^ ")="")!'($D(^PS(55,PSGP,5,DA,15,1))) TXT="" S ^PS(55,PSGP,5,DA,6)=TXT S $P(^PS(55,PSGP,5,DA,6),"^",2)=$P(^PS(53.1,+ODA,6),"^",2)
"RTN","PSGOTR",60,0)
 .N LSTLNUM,LSTLNTXT S LSTLNUM=$O(^PS(55,+PSGP,5,+DA,15,""),-1) I LSTLNUM>1 S LSTLNTXT=$G(^PS(55,+PSGP,5,+DA,15,LSTLNUM,0)) I $TR(LSTLNTXT," ")="" D
"RTN","PSGOTR",61,0)
 ..K ^PS(55,+PSGP,5,+DA,15,LSTLNUM,0)
"RTN","PSGOTR",62,0)
 L -^PS(53.1,+ODA) L -^PS(55,PSGP,5,+DA) K CNT,ND,ODA,XX,ZND Q
"RTN","PSGVW")
0^31^B32841979^B31699559
"RTN","PSGVW",1,0)
PSGVW ;BIR/CML3-EXPANDED VIEW OF AN ORDER ;17 SEP 97 /  1:41 PM
"RTN","PSGVW",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**50,58,85,80,104,110,267,315**;16 DEC 97;Build 73
"RTN","PSGVW",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PSGVW",4,0)
 ; Reference to ^PS(50.7 is supported by DBIA# 2180.
"RTN","PSGVW",5,0)
 ; Reference to ^PS(51.2 is supported by DBIA# 2178.
"RTN","PSGVW",6,0)
 ; Reference to ^PS(55 is supported by DBIA# 2191.
"RTN","PSGVW",7,0)
 ; Reference to ES^ORX8 is supported by DBIA# 3632.
"RTN","PSGVW",8,0)
 ;
"RTN","PSGVW",9,0)
EN1 ;
"RTN","PSGVW",10,0)
 S PSGORD=^TMP("PSJON",$J,PSGOE2)
"RTN","PSGVW",11,0)
 ;
"RTN","PSGVW",12,0)
EN2 ;
"RTN","PSGVW",13,0)
 I PSGORD=+PSGORD N PSGO,PSGO1 S PSGO=PSGORD,PSGO1=0 F  S PSGO1=$O(^PS(53.1,"ACX",PSGO,PSGO1)) Q:'PSGO1  Q:$G(PSGOEA)["^"  S PSGORD=PSGO1_"P" D  S PSGORD=""
"RTN","PSGVW",14,0)
 . D EN21 K CONT D  Q:$G(PSGOEA)["^"
"RTN","PSGVW",15,0)
 .. W !!,"Press RETURN to continue or '^' to exit: " R CONT:DTIME W @IOF S:CONT["^" PSGOEA="^",PSGPR=1,PSJPR=1
"RTN","PSGVW",16,0)
 I PSGORD="" S PSGOEA="^" Q
"RTN","PSGVW",17,0)
EN21 ;
"RTN","PSGVW",18,0)
 K ^PS(53.45,PSJSYSP,2),^TMP("PSJBCMA5",$J)
"RTN","PSGVW",19,0)
 N ESIG,PSJ21
"RTN","PSGVW",20,0)
 S NF=$S(PSGORD["P":1,PSGORD["N":1,1:0)
"RTN","PSGVW",21,0)
 S (FL,Y)="",$P(FL,"-",71)="",F="^PS("_$S(NF:"53.1,",1:"55,"_PSGP_",5,")_+PSGORD_","
"RTN","PSGVW",22,0)
 S PN=$G(PSGP(0)) S:PN="" PN=$P($G(^DPT(PSGP,0)),"^")
"RTN","PSGVW",23,0)
 ; the naked reference on the line below refers to the full reference created by indirect reference to F_ON, where F may refer to ^PS(53.1 or the IV or UD multiple ^PS(55
"RTN","PSGVW",24,0)
 S OD=$G(@(F_"0)")),STAT=$P(OD,U,9),PSJ21=$P(OD,U,21),PDRG=$G(^(.2)),INS=$G(^(.3)),AT=$G(^(2)),RT=$G(^(2.1)),ND4=$G(^(4)),EB=$P(ND4,"^",7) S:'NF XU=$G(^(5)) S X=$P($G(^(6)),"^"),SIG=$G(^(6.5)),DO=$G(^(1,1,0)) ;*315
"RTN","PSGVW",25,0)
 S PR=$P(OD,"^",2),MR=$P(OD,"^",3),SM=$P(OD,"^",5),HSM=$P(OD,"^",6),SCT=$S(PSGORD'["P":$P(OD,"^",7),1:""),ST=$P(OD,"^",9),(PSGLI,LID)=$P(OD,"^",16),OD=$P(OD,"^",14),DO=$P(PDRG,"^",2),ESIG=$P(PDRG,"^",3),PDRG=+PDRG
"RTN","PSGVW",26,0)
L S SCH=$P(AT,"^"),STD=$S(STAT'["P":$P(AT,"^",2),1:""),FD=$S(STAT'["P":$P(AT,"^",4),1:""),FQC=$P(AT,"^",6),AT=$P(AT,"^",5),RT=$P(RT,U,2) I FQC="D",AT="" S AT=$E($P(STD,".",2)_"0000",1,4) ;*315
"RTN","PSGVW",27,0)
 S PRI=$S('PR:0,1:$P($G(^VA(200,PR,"PS")),"^",4)),DRGI=$S('PDRG:0,1:$P($G(^PS(50.7,PDRG,0)),"^",4)),PR=$$ENNPN^PSGMI(PR) S:PRI PRI=PRI'>DT S:DRGI DRGI=DRGI'>DT
"RTN","PSGVW",28,0)
 I PSJ21]"",$L($T(ES^ORX8)) N ESIG1 S ESIG1=$$ES^ORX8(+PSJ21_";1") S:ESIG1=1 ESIG="ES"
"RTN","PSGVW",29,0)
 S PR=PR_$S(ESIG]"":" ["_$$LOW^XLFSTR(ESIG)_"]",1:"")
"RTN","PSGVW",30,0)
 S DRG=$$OIDF^PSJLMUT1(+PDRG) S SI=$S(X]"":$$ENSET^PSGSICHK(X),1:"")
"RTN","PSGVW",31,0)
 F Q="FD","LID","OD","STD" S @Q=$$ENDTC^PSGMI(@Q)
"RTN","PSGVW",32,0)
 Q:$D(PSJLM)
"RTN","PSGVW",33,0)
 ;
"RTN","PSGVW",34,0)
WRT ;
"RTN","PSGVW",35,0)
 Q:($G(@(F_"0)"))="")
"RTN","PSGVW",36,0)
 W !! W:'$D(PSGVWA) ?5,FL,! W "Patient: ",PN
"RTN","PSGVW",37,0)
 W ?47,"Status: " I ST["D" W "DISCONTINUED",$S(ST["E":" (EDIT)",ST["R":" (RENEWAL)",1:"")
"RTN","PSGVW",38,0)
 E  W $S(ST="E":"EXPIRED",$P($G(@(F_"0)")),U,27)="R":"RENEWED",ST="":"NOT FOUND",ST="RE":"REINSTATED",1:$P(ST_"^ACTIVE^HOLD^INCOMPLETE^NON-VERIFIED^PENDING^UNRELEASED","^",$F("AHINPU",ST)))
"RTN","PSGVW",39,0)
 W !,"Orderable Item: ",DRG
"RTN","PSGVW",40,0)
 W !?2,"Instructions: ",INS
"RTN","PSGVW",41,0)
 W !,"Dosage Ordered: ",DO
"RTN","PSGVW",42,0)
 S PSJDUR="" I $G(PSGRDTX) S PSJDUR=$$FMTDUR^PSJLIVMD($P($G(PSGRDTX),U,2))
"RTN","PSGVW",43,0)
 I $G(PSGORD),($G(PSJDUR)="") S P=$S(PSGORD["U":5,1:-1) S PSJDUR=$$GETDUR^PSJLIVMD(PSGP,+PSGORD,P)
"RTN","PSGVW",44,0)
 W !?6,"Duration: ",PSJDUR
"RTN","PSGVW",45,0)
 W ?48,"Start: ",STD
"RTN","PSGVW",46,0)
 W !?5,"Med Route: ",$S(MR:$S($D(^PS(51.2,+MR,0)):$P(^(0),"^")_$S($P(^(0),"^",3)]"":" ("_$P(^(0),"^",3)_")",1:""),1:MR),1:"NOT FOUND")
"RTN","PSGVW",47,0)
 N RNDT,PSGLRN S PSGLRN=$$LASTREN^PSJLMPRI(PSGP,PSGORD) I PSGLRN S RNDT=$$ENDTC^PSGMI(+PSGLRN) W ?46,"Renewed: ",RNDT
"RTN","PSGVW",48,0)
 W !,$$BCMALG^PSJUTL2(PSGP,PSGORD)
"RTN","PSGVW",49,0)
 W ?49,"Stop: ",FD
"RTN","PSGVW",50,0)
 I $G(PSGORD),($G(PSJDUR)="") S P=$S(PSGORD["U":5,1:-1) S PSJDUR=$$GETDUR^PSJLIVMD(PSGP,+PSGORD,P)
"RTN","PSGVW",51,0)
 W !?1,"Schedule Type: ",$$ENSTN^PSGMI(SCT)
"RTN","PSGVW",52,0)
 W !?6,"Schedule: ",$S(SCH="":"NOT FOUND",$L(SCH)>27:$E(SCH,1,24)_"...",1:SCH)
"RTN","PSGVW",53,0)
 W !?3,$S(AT&("P"'[SCT):"Admin Times: "_AT,1:"(No Admin Times)") ;*315
"RTN","PSGVW",54,0)
 W !?1,$S(RT&("P"'[SCT):"Removal Times: "_RT,1:""),!?6,"Provider: ",PR
"RTN","PSGVW",55,0)
 N SIL S SIL=$$GETSIOPI^PSJBCMA5(PSGP,PSGORD,1) I SIL!(SI]"") D
"RTN","PSGVW",56,0)
 .I SI]"",'SIL W !,"Special Instructions: (see below) " D  Q
"RTN","PSGVW",57,0)
 ..F Q=1:1:$L(SI," ") S QQ=$P(SI," ",Q) W !?2,QQ," "
"RTN","PSGVW",58,0)
 .Q:'$G(PSJSYSP)  N LNTXT S LNTXT=0 F  S LNTXT=$O(^TMP("PSJBCMA5",$J,PSGP,PSGORD,LNTXT)) Q:'LNTXT  D
"RTN","PSGVW",59,0)
 ..I LNTXT=1 W !,"Special Instructions: (see below)"
"RTN","PSGVW",60,0)
 ..W !,$G(^TMP("PSJBCMA5",$J,PSGP,PSGORD,LNTXT))
"RTN","PSGVW",61,0)
 W !?48,"Units",?56,"Units",?64,"Inactive",!," Dispense Drugs",?43,"U/D",?48,"Disp'd",?56,"Ret'd",?64,"Date",!,FL,$E(FL,1,10)
"RTN","PSGVW",62,0)
 ; the naked reference on the line below refers to the full reference created by indirect reference to F_ON, where F may refer to ^PS(53.1 or the IV or UD multiple ^PS(55
"RTN","PSGVW",63,0)
 F X=0:0 S X=$O(@(F_"1,"_X_")")) Q:'X  S DRG=$G(^(X,0)) I DRG]"" D  ;
"RTN","PSGVW",64,0)
 .S UD=$P(DRG,"^",2),D=$P(DRG,"^",6)+$P(DRG,"^",10)+$P(DRG,"^",12),R=+$P(DRG,"^",7),Y=$P(DRG,"^",3),DRG=$P(DRG,"^") I Y S Y=$E($$ENDTC^PSGMI(Y),1,8)
"RTN","PSGVW",65,0)
 .W !?1,$$ENDDN^PSGMI(DRG),?43,$S(UD:UD,1:1),?48,D,?56,R W:Y ?64,Y Q
"RTN","PSGVW",66,0)
 ; the naked reference on the two lines below refers to the full reference created by indirect reference to F_ON, where F may refer to ^PS(53.1 or the IV or UD multiple ^PS(55
"RTN","PSGVW",67,0)
 I $O(@(F_"12,0)")) W !!,"Provider Comments:" F Q=0:0 S Q=$O(@(F_"12,"_Q_")")) Q:'Q  N Y S Y=^(Q,0) W !,Y
"RTN","PSGVW",68,0)
 I $O(@(F_"3,0)")) W !!,"Comments:" F Q=0:0 S Q=$O(@(F_"3,"_Q_")")) Q:'Q  W !,^(Q,0)
"RTN","PSGVW",69,0)
ACTFLG W ! S AT="",Y="12,13,D,18,19,H1,22,23,H0,15,16,R" F X=1:3:12 I $P(ND4,"^",$P(Y,",",X)),$P(ND4,"^",$P(Y,",",X+1)) S AT=$P(Y,",",X+2) Q
"RTN","PSGVW",70,0)
 I AT="",'$P(ND4,"^",$S($P(PSJSYSU,";",3)>1:3,1:1)) S AT="V"_$S($P(ND4,"^",18):"H1",$P(ND4,"^",22):"H0",$P(ND4,"^",15):"R",1:"")
"RTN","PSGVW",71,0)
 W:AT]"" !,"ORDER ",$S(AT["V":"NOT VERIFIED"_$S($P(AT,"V",2)="":"",1:" ("_$S(AT["H1":"ON HOLD",AT["H0":"OFF HOLD",1:"RENEWAL")_")"),1:"MARKED TO BE "_$S(AT["D":"CANCELLED",AT["H1":"PLACED ON HOLD",AT["H0":"TAKEN OFF OF HOLD",1:"RENEWED"))
"RTN","PSGVW",72,0)
 I AT'["V",AT["H1",$D(^PS(55,PSGP,5.1)) S AT=^(5.1) I $P(AT,"^",7),$P(AT,"^",10)]"" W "  (",$P(AT,"^",10),")"
"RTN","PSGVW",73,0)
 W !,"Self Med: " I SM W "SELF MED" W:HSM "  (HOSPITAL SUPPLIED)"
"RTN","PSGVW",74,0)
 I 'SM&('HSM) W "NO"
"RTN","PSGVW",75,0)
 W !!,"Entry By: ",$$ENNPN^PSGMI(EB),?52,"Entry Date: ",LID
"RTN","PSGVW",76,0)
 I $G(PSGLRN) W !,"Renewed By: "_$$ENNPN^PSGMI($P(PSGLRN,"^",2))
"RTN","PSGVW",77,0)
 W:DRGI !!?3,"(THE ORDERABLE ITEM IS CURRENTLY LISTED AS INACTIVE.)" I PRI W:'DRGI ! W !?3,"(PROVIDER IS CURRENTLY LISTED AS INACTIVE.)"
"RTN","PSGVW",78,0)
 ;
"RTN","PSGVW",79,0)
DONE ;
"RTN","PSGVW",80,0)
 K ^TMP("PSJBCMA5",$J)
"RTN","PSGVW",81,0)
 K AND,D,DRG1,DRG2,AT,DO,DRG,EB,F,FD,FL,HSM,INS,LID,MR,ND4,OD,PN,PR,PSGID,PSGOD,R,SCH,SCT,SI,SIG,SM,ST,STD,UD,X,XU,Y,RT Q
"RTN","PSGVW",82,0)
 Q
"RTN","PSGVW0")
0^49^B11075567^B10085740
"RTN","PSGVW0",1,0)
PSGVW0 ;BIR/CML3-SHOWS ACTIVITY LOG ;16 DEC 97 / 1:38 PM 
"RTN","PSGVW0",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**49,54,85,267,315**;16 DEC 97;Build 73
"RTN","PSGVW0",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PSGVW0",4,0)
 ; Reference to ^PS(55 is supported by DBIA 2191
"RTN","PSGVW0",5,0)
 ;
"RTN","PSGVW0",6,0)
 F  R !!,"Show LONG, SHORT, or NO activity log?  N// ",AT:DTIME D ALC Q:Q
"RTN","PSGVW0",7,0)
 Q:"^N"[AT  S PN=1,PX="" F Q=0:0 S Q=$O(@(F_"9,"_Q_")")) Q:'Q  I $D(^(Q,0)) S AND=^(0) D:'(PN#6) NPAGE Q:PX["^"  D AL1
"RTN","PSGVW0",8,0)
 Q
"RTN","PSGVW0",9,0)
AL1 S PN=PN+1,UD=$P(AND,"^",3) I AT="S",UD?4N,$E(UD)=6,UD#6000 Q
"RTN","PSGVW0",10,0)
 W !!?4,"Date: ",$$ENDTC^PSGMI(+AND) W:$S(UD'?4N:1,1:$E(UD,1,2)'=10) ?30,"User: ",$$ENNPN^PSGMI($P(AND,"^",2))
"RTN","PSGVW0",11,0)
 W !,"Activity: ORDER ",$S(UD="":"****",'$D(^PS(53.3,UD,0)):UD,$P(^(0),"^")]"":$P(^(0),"^"),1:UD)
"RTN","PSGVW0",12,0)
AL2 I UD?4N,$E(UD)=6 W !?3,"Field: ",$P(AND,"^",4) S OD=$P(AND,"^",5) I OD>2000000,$P(OD,".",2) S OD=$$ENDTC^PSGMI(OD)
"RTN","PSGVW0",13,0)
 I AND'["SPECIAL INSTRUCTIONS"&(AND'["OTHER PRINT INFO")&(AND'["DURATION OF ADMINISTRATION") I UD?4N,$E(UD)=6 W !,"Old Data: ",OD ;*315
"RTN","PSGVW0",14,0)
 I AND["DURATION OF ADMINISTRATION",UD?4N,$E(UD)=6 W !,"Old Data: ",(OD/60)_" hours" ;*315
"RTN","PSGVW0",15,0)
 I AND["SPECIAL INSTRUCTIONS" W !,"Old Data: " D
"RTN","PSGVW0",16,0)
 .I ($G(PSJORD)["U") D
"RTN","PSGVW0",17,0)
 ..N Q2 S Q2=0 F  S Q2=$O(^PS(55,DFN,5,+PSJORD,9,Q,1,Q2)) Q:'Q2  W !?3,^(Q2,0)
"RTN","PSGVW0",18,0)
 ..S Q2=0 F  S Q2=$O(^PS(55,DFN,5,+PSJORD,9,Q,2,Q2)) Q:'Q2  W:(Q2=1) !,"New Data: " W !?3,^(Q2,0)
"RTN","PSGVW0",19,0)
 .I ($G(PSJORD)["P") N Q2 S Q2=0 F  S Q2=$O(^PS(53.1,+PSJORD,"A",Q,1,Q2)) Q:'Q2  W !?3,^(Q2,0)
"RTN","PSGVW0",20,0)
 I AND["OTHER PRINT INFO" W !,"Old Data: " D
"RTN","PSGVW0",21,0)
 .I ($G(PSJORD)["U") N Q2 S Q2=0 F  S Q2=$O(^PS(55,DFN,"IV",+PSJORD,"A",Q,1,1,Q2)) Q:'Q2  W !?3,^(Q2,0)
"RTN","PSGVW0",22,0)
 .I ($G(PSJORD)["P") N Q2 S Q2=0 F  S Q2=$O(^PS(53.1,+PSJORD,"A",Q,1,Q2)) Q:'Q2  W !?3,^(Q2,0)
"RTN","PSGVW0",23,0)
 I UD?4N,$E(UD)=7,$P(AND,"^",4)]"" W !?3,"Field: ",$P(AND,"^",4)
"RTN","PSGVW0",24,0)
 Q
"RTN","PSGVW0",25,0)
NPAGE I $E(IOST)="C" R !!,"Enter '^' to stop, or press RETURN to continue.",PX:DTIME
"RTN","PSGVW0",26,0)
 Q
"RTN","PSGVW0",27,0)
ALC ;
"RTN","PSGVW0",28,0)
 S Q=1 W:'$T $C(7) I AT["^"!'$T S AT="^" Q
"RTN","PSGVW0",29,0)
 I AT="" W "  (NO)" S AT="N" Q
"RTN","PSGVW0",30,0)
 F PX="SHORT","LONG","NO" I $P(PX,AT)="" W $P(PX,AT,2) S AT=$E(AT) Q
"RTN","PSGVW0",31,0)
 Q:$T  S Q=0 I AT'["?" W $C(7),"  ??" Q
"RTN","PSGVW0",32,0)
 W !!,"Enter 'LONG' (or 'L') to see ALL of the entries of this activity log.  Enter    'SHORT' (or 'S') to NOT see the fields edited because of the order being",!,"renewed, discontinued, etc.  Simply press the RETURN key "
"RTN","PSGVW0",33,0)
 W "(or enter 'NO', 'N',",!,"or '^') to NOT see the activity log." Q
"RTN","PSGVW0",34,0)
 ;
"RTN","PSGVW0",35,0)
ENA ;
"RTN","PSGVW0",36,0)
 I PSGORD["U" S PN=1,PX="" F Q=0:0 S Q=$O(^PS(55,PSGP,5,+PSGORD,9,Q)) Q:'Q  I $D(^(Q,0)) S AND=^(0) D:'(PN#6) NPAGE Q:PX["^"  D AL1
"RTN","PSGVW0",37,0)
 I PSGORD["P" S PN=1,PX="" F Q=0:0 S Q=$O(^PS(53.1,+PSGORD,"A",Q)) Q:'Q  I $D(^(Q,0)) S AND=^(0) D:'(PN#6) NPAGE Q:PX["^"  D AL1
"RTN","PSGVW0",38,0)
 Q
"RTN","PSJ5P315")
0^^B42106508^n/a
"RTN","PSJ5P315",1,0)
PSJ5P315 ;BIRMINGHAM/GN/DRP-Diagnostic Report only, does not update ;9/25/15 10:03am
"RTN","PSJ5P315",2,0)
 ;;5.0;INPATIENT MEDICATIONS ;**315**;16 DEC 97;Build 73
"RTN","PSJ5P315",3,0)
 ;
"RTN","PSJ5P315",4,0)
 ; Reference to ^PS(50.7 is supported by DBIA# 2180
"RTN","PSJ5P315",5,0)
 ; Reference to ^PS(55 is supported by DBIA 2191.
"RTN","PSJ5P315",6,0)
 ; Reference to ^PSDRUG is supported by DBIA 2192.
"RTN","PSJ5P315",7,0)
 ; Routine should be deleted after install
"RTN","PSJ5P315",8,0)
 ;
"RTN","PSJ5P315",9,0)
 Q
"RTN","PSJ5P315",10,0)
QUE ; Que the job in the background
"RTN","PSJ5P315",11,0)
 N NAMSP,PATCH,JOBN,ZTSK,ZTRTN,ZTIO,ZTDTH,ZTDESC,Y,ZTQUEUED,ZTREQ,ZTSAVE,CNT,SBJM
"RTN","PSJ5P315",12,0)
 S NAMSP="PSJ5P315"
"RTN","PSJ5P315",13,0)
 S JOBN="PSJ*5*315 Pre Install Diagnostic Report"
"RTN","PSJ5P315",14,0)
 S PATCH="PSJ*5*315"
"RTN","PSJ5P315",15,0)
 S Y=$$NOW^XLFDT S ZTDTH=$$FMTH^XLFDT(Y)
"RTN","PSJ5P315",16,0)
 ;
"RTN","PSJ5P315",17,0)
 D BMES^XPDUTL("=============================================================")
"RTN","PSJ5P315",18,0)
 D MES^XPDUTL("Queuing background job for "_JOBN_"...")
"RTN","PSJ5P315",19,0)
 D MES^XPDUTL("Start time: "_$$HTE^XLFDT(ZTDTH))
"RTN","PSJ5P315",20,0)
 D MES^XPDUTL("A MailMan message will be sent to the installer upon Post")
"RTN","PSJ5P315",21,0)
 D MES^XPDUTL("Install Completion.  This may take an hour.")
"RTN","PSJ5P315",22,0)
 D MES^XPDUTL("==============================================================")
"RTN","PSJ5P315",23,0)
 ;
"RTN","PSJ5P315",24,0)
 S ZTRTN="EN^"_NAMSP,ZTIO=""
"RTN","PSJ5P315",25,0)
 S (SBJM,ZTDESC)="Background job for "_JOBN
"RTN","PSJ5P315",26,0)
 S ZTSAVE("JOBN")="",ZTSAVE("ZTDTH")="",ZTSAVE("DUZ")="",ZTSAVE("SBJM")=""
"RTN","PSJ5P315",27,0)
 D ^%ZTLOAD
"RTN","PSJ5P315",28,0)
 D:$D(ZTSK)
"RTN","PSJ5P315",29,0)
 . D MES^XPDUTL("*** Task #"_ZTSK_" Queued! ***")
"RTN","PSJ5P315",30,0)
 . D BMES^XPDUTL("")
"RTN","PSJ5P315",31,0)
 . S ZTSAVE("ZTSK")=""
"RTN","PSJ5P315",32,0)
 D BMES^XPDUTL("")
"RTN","PSJ5P315",33,0)
 K XPDQUES
"RTN","PSJ5P315",34,0)
 D FIXITEM
"RTN","PSJ5P315",35,0)
 Q
"RTN","PSJ5P315",36,0)
 ;
"RTN","PSJ5P315",37,0)
FIXITEM ; SET PROTOCOL SEQUENCES TO MATCH REQUIREMENTS
"RTN","PSJ5P315",38,0)
 N PSJMNUI,PSJITEM,PSJPIEN,PSJPNM,PSJITXT,QT S QT=""""
"RTN","PSJ5P315",39,0)
 S PSJPIEN=$O(^ORD(101,"B","PSJ LM ORDER VIEW HIDDEN ACTIONS",0)) Q:'PSJPIEN
"RTN","PSJ5P315",40,0)
 S PSJITEM=$O(^ORD(101,"B","PSJ LM PHARMACY INTERVENTION MENU",0))
"RTN","PSJ5P315",41,0)
 S:PSJITEM PSJMNUI=$O(^ORD(101,PSJPIEN,10,"B",PSJITEM,0))
"RTN","PSJ5P315",42,0)
 S:$G(PSJMNUI) $P(^ORD(101,PSJPIEN,10,PSJMNUI,0),U,3)=42
"RTN","PSJ5P315",43,0)
 ; Change display name of Other Pharmacy Options
"RTN","PSJ5P315",44,0)
 S PSJPIEN=$O(^ORD(101,"B","PSJ LM OTHER PHARMACY OPTIONS",0))
"RTN","PSJ5P315",45,0)
 S:$G(PSJPIEN) $P(^ORD(101,PSJPIEN,0),U,2)="Other Pharm Options"
"RTN","PSJ5P315",46,0)
 ; Recompile menus that contain new item
"RTN","PSJ5P315",47,0)
 N I,STR S STR="PSJU LM HIDDEN UD ACTIONS,PSJ LM BPI HIDDEN ACTIONS,PSJ LM PROFILE HIDDEN ACTIONS,PSJ LM ORDER VIEW HIDDEN ACTIONS"
"RTN","PSJ5P315",48,0)
 F I=1:1:$L(STR,",") S PSJITXT=$P(STR,",",I) D
"RTN","PSJ5P315",49,0)
 . S PSJPIEN=$O(^ORD(101,"B",PSJITXT,0))
"RTN","PSJ5P315",50,0)
 . S XQORM=PSJPIEN_";ORD(101," D XREF^XQORM K XQORM
"RTN","PSJ5P315",51,0)
 .Q
"RTN","PSJ5P315",52,0)
 ;
"RTN","PSJ5P315",53,0)
 S PSJITEM=$O(^ORD(101,"B","PSJ LM ADM HIST",0)) Q:'PSJITEM
"RTN","PSJ5P315",54,0)
 S PSJMNUI=$O(^ORD(101,PSJPIEN,10,"B",PSJITEM,0)) Q:'PSJMNUI
"RTN","PSJ5P315",55,0)
 S:$G(PSJMNUI) $P(^ORD(101,PSJPIEN,10,PSJMNUI,0),U,3)=43
"RTN","PSJ5P315",56,0)
 Q
"RTN","PSJ5P315",57,0)
 ;
"RTN","PSJ5P315",58,0)
EN(P1) ;Check for MRR meds missing the 2.1 node which is new and would be
"RTN","PSJ5P315",59,0)
 ;there if an order was created and finished after patch PSJ*3*315
"RTN","PSJ5P315",60,0)
 ; Input param: P1 = default is null and checks for 2.1 node (used for testing)
"RTN","PSJ5P315",61,0)
 ;                  = if pass in a value, then it will not check 2.1
"RTN","PSJ5P315",62,0)
 ;
"RTN","PSJ5P315",63,0)
 N PSJDFN,PSJMRR,PSJMRRAR,PSJORD,ORDTOT,PSJDDOI,PSJOI,PSJMRRFL,PSJSPCE,PSJDUZ,PSJLN
"RTN","PSJ5P315",64,0)
 N QQ,YY,STS,ID,LOC,CLNODE,STP,DDTXT,PAGNO,ORDSDT
"RTN","PSJ5P315",65,0)
 N XMDUZ,XMSUB,XMTEXT,XMY,X,DIFROM
"RTN","PSJ5P315",66,0)
 S PSJDUZ=DUZ,ORDSDT=$$NOW^XLFDT
"RTN","PSJ5P315",67,0)
 K ^TMP($J,"PSJ5P315"),^XTMP("PSJ5P315")
"RTN","PSJ5P315",68,0)
 ;build array of OI's that are mrr and their flag value
"RTN","PSJ5P315",69,0)
 F QQ=0:0 S QQ=$O(^PSDRUG("ASP",QQ)) Q:QQ=""  D
"RTN","PSJ5P315",70,0)
 . F YY=0:0 S YY=$O(^PSDRUG("ASP",QQ,YY)) Q:'YY  D
"RTN","PSJ5P315",71,0)
 .. S PSJOI=$P(^PSDRUG(YY,2),U)
"RTN","PSJ5P315",72,0)
 .. S PSJMRRFL=$P($G(^PS(50.7,PSJOI,4)),U,1)
"RTN","PSJ5P315",73,0)
 .. S:PSJMRRFL PSJMRRAR(PSJOI)=PSJMRRFL
"RTN","PSJ5P315",74,0)
 ;
"RTN","PSJ5P315",75,0)
 S P1=$G(P1)   ;define P1 to null if not passed
"RTN","PSJ5P315",76,0)
 S PAGNO=0,ORDTOT=0
"RTN","PSJ5P315",77,0)
 ; Use Ord Stop Date XREF to look for current orders
"RTN","PSJ5P315",78,0)
 F  S ORDSDT=$O(^PS(55,"AUD",ORDSDT)) Q:ORDSDT=""  D
"RTN","PSJ5P315",79,0)
 . S PSJDFN=0
"RTN","PSJ5P315",80,0)
 . F  S PSJDFN=$O(^PS(55,"AUD",ORDSDT,PSJDFN)) Q:PSJDFN=""  D
"RTN","PSJ5P315",81,0)
 .. S PSJORD=0
"RTN","PSJ5P315",82,0)
 .. F  S PSJORD=$O(^PS(55,"AUD",ORDSDT,PSJDFN,PSJORD)) Q:PSJORD=""  D
"RTN","PSJ5P315",83,0)
 ... S STS=$P($G(^PS(55,PSJDFN,5,PSJORD,0)),U,9)
"RTN","PSJ5P315",84,0)
 ... S CLNODE=$G(^PS(55,PSJDFN,5,PSJORD,8))
"RTN","PSJ5P315",85,0)
 ... ;non Active type order, quit dont include
"RTN","PSJ5P315",86,0)
 ... I (STS="D")!(STS="E")!(STS="DE")!(STS="DR") Q
"RTN","PSJ5P315",87,0)
 ... S ID=$S('$D(^DPT(PSJDFN,0)):"NONE",1:$E($P($G(^DPT(PSJDFN,0)),U,1),1)_$E($P($G(^DPT(PSJDFN,0)),U,9),6,9))
"RTN","PSJ5P315",88,0)
 ... D CHKORD        ;check and then print line on report
"RTN","PSJ5P315",89,0)
 ..Q
"RTN","PSJ5P315",90,0)
 .Q
"RTN","PSJ5P315",91,0)
 D MAKERPT,SENDRPT
"RTN","PSJ5P315",92,0)
 Q
"RTN","PSJ5P315",93,0)
 ;
"RTN","PSJ5P315",94,0)
CHKORD ;check if Order qualifies and then print on report
"RTN","PSJ5P315",95,0)
 ; return mrrfl which is positive or true  (1,2,3)
"RTN","PSJ5P315",96,0)
 F QQ=0:0 S QQ=$O(^PS(55,PSJDFN,5,PSJORD,1,QQ)) Q:'QQ  D
"RTN","PSJ5P315",97,0)
 . S PSJDDOI=+$P($G(^PS(55,PSJDFN,5,PSJORD,.2)),U)
"RTN","PSJ5P315",98,0)
 . S PSJMRR=$G(PSJMRRAR(PSJDDOI))
"RTN","PSJ5P315",99,0)
 . Q:'PSJMRR      ;don't report not a MRR med
"RTN","PSJ5P315",100,0)
 . ;   don't report if has a 2.1 node, unless P1 overrides
"RTN","PSJ5P315",101,0)
 . I $G(P1)="",$D(^PS(55,PSJDFN,5,PSJORD,2.1)) Q
"RTN","PSJ5P315",102,0)
 . S LOC=$S($$CLINIC(CLNODE):$P(^SC(+^PS(55,PSJDFN,5,PSJORD,8),0),U,1),$G(^DPT(PSJDFN,.1))]"":^DPT(PSJDFN,.1),1:"UNKNOWN")
"RTN","PSJ5P315",103,0)
 . S DDTXT=$$GET1^DIQ(55.07,QQ_","_PSJORD_","_PSJDFN,"DISPENSE DRUG")
"RTN","PSJ5P315",104,0)
 . S ^XTMP("PSJ5P315",$J,LOC,ID)=DDTXT_U_STS_U_PSJMRR
"RTN","PSJ5P315",105,0)
 .Q
"RTN","PSJ5P315",106,0)
 Q
"RTN","PSJ5P315",107,0)
MAKERPT ;
"RTN","PSJ5P315",108,0)
 S ^TMP($J,"PSJ5P315")=""
"RTN","PSJ5P315",109,0)
 S ^TMP($J,"PSJ5P315",0)=" "
"RTN","PSJ5P315",110,0)
 S ^TMP($J,"PSJ5P315",1)=" "
"RTN","PSJ5P315",111,0)
 S ^TMP($J,"PSJ5P315",2)="Orders for Medications Requiring Removal (MRR) ACTIVE PRIOR to"
"RTN","PSJ5P315",112,0)
 S ^TMP($J,"PSJ5P315",3)="Installation of PSJ*5*315. These orders will need to be Discontinued"
"RTN","PSJ5P315",113,0)
 S ^TMP($J,"PSJ5P315",6)=" and re-entered after coordinating with your Pharmacy ADPAC."
"RTN","PSJ5P315",114,0)
 S ^TMP($J,"PSJ5P315",7)=" This report can be recalled from the PSS MGR Menu."
"RTN","PSJ5P315",115,0)
 S ^TMP($J,"PSJ5P315",8)=" "
"RTN","PSJ5P315",116,0)
 S ^TMP($J,"PSJ5P315",9)="             Sorted by Patient within Ward"
"RTN","PSJ5P315",117,0)
 S ^TMP($J,"PSJ5P315",10)="Pat    Patient               Orderable             Ordr  MRR"
"RTN","PSJ5P315",118,0)
 S ^TMP($J,"PSJ5P315",11)="ID     Loc                   Item Name             Sts   Val"
"RTN","PSJ5P315",119,0)
 S ^TMP($J,"PSJ5P315",12)="-----  --------------------  --------------------  ----  ---"
"RTN","PSJ5P315",120,0)
 S ^TMP($J,"PSJ5P315",13)=" "
"RTN","PSJ5P315",121,0)
 S PSJLN=14,$P(PSJSPCE," ",20)=""
"RTN","PSJ5P315",122,0)
 N STR S LOC=""
"RTN","PSJ5P315",123,0)
  F  S LOC=$O(^XTMP("PSJ5P315",$J,LOC)) Q:LOC=""  D
"RTN","PSJ5P315",124,0)
 . S ID=""
"RTN","PSJ5P315",125,0)
 . F  S ID=$O(^XTMP("PSJ5P315",$J,LOC,ID)) Q:ID=""  D
"RTN","PSJ5P315",126,0)
 .. S STR=^XTMP("PSJ5P315",$J,LOC,ID),DDTXT=$P(STR,U),STS=$P(STR,U,2),PSJMRR=$P(STR,U,3)
"RTN","PSJ5P315",127,0)
 .. S ^TMP($J,"PSJ5P315",PSJLN)=$E(ID_PSJSPCE,1,5)_"  "_$E($$FMTE^XLFDT(LOC,5)_PSJSPCE,1,20)_"  "_$E(DDTXT_PSJSPCE,1,20)_"  "_$E(STS_PSJSPCE,1,4)_"  "_$E(PSJMRR_PSJSPCE,1,3)
"RTN","PSJ5P315",128,0)
 .. S ORDTOT=ORDTOT+1,PSJLN=PSJLN+1
"RTN","PSJ5P315",129,0)
 ..Q
"RTN","PSJ5P315",130,0)
 .Q
"RTN","PSJ5P315",131,0)
 S PSJLN=PSJLN+1,^TMP($J,"PSJ5P315",PSJLN)="Total Orders found: "_ORDTOT
"RTN","PSJ5P315",132,0)
 Q
"RTN","PSJ5P315",133,0)
 ;
"RTN","PSJ5P315",134,0)
CLINIC(CL) ;Is this a Clinic order that would show on the VDL in CO mode also?
"RTN","PSJ5P315",135,0)
 Q:'($P(CL,"^",2)?7N!($P(CL,"^",2)?7N1".".N)) 0  ;no appt date, IM ord
"RTN","PSJ5P315",136,0)
 Q:'$D(^PS(53.46,"B",+CL)) 0                     ;no PTR to 44, IM ord
"RTN","PSJ5P315",137,0)
 N A S A=$O(^PS(53.46,"B",+CL,"")) Q:'A 0        ;no 53.46 ien, IM ord
"RTN","PSJ5P315",138,0)
 Q $P(^PS(53.46,A,0),"^",4)                      ;Send to BCMA? flag
"RTN","PSJ5P315",139,0)
 ;
"RTN","PSJ5P315",140,0)
SENDRPT ;Send report to user
"RTN","PSJ5P315",141,0)
 S XMY(PSJDUZ)=""
"RTN","PSJ5P315",142,0)
 S X="" F  S X=$O(^XUSEC("PSJI MGR",X)) Q:'X  S XMY(X)=""
"RTN","PSJ5P315",143,0)
 S X="" F  S X=$O(^XUSEC("PSJU MGR",X)) Q:'X  S XMY(X)=""
"RTN","PSJ5P315",144,0)
 S X="" F  S X=$O(^XUSEC("PSJU RPH",X)) Q:'X  S XMY(X)=""
"RTN","PSJ5P315",145,0)
 S X="" F  S X=$O(^XUSEC("PSJ RPHARM",X)) Q:'X  S XMY(X)=""
"RTN","PSJ5P315",146,0)
 S XMSUB="Pharmacy Data Management",XMTEXT="^TMP("_$J_","_"""PSJ5P315"""_",",XMDUZ=.5,XMY(PSJDUZ)=""
"RTN","PSJ5P315",147,0)
 D ^XMD
"RTN","PSJ5P315",148,0)
 K ^TMP($J,"PSJ5P315"),^XTMP("PSJ5P315")
"RTN","PSJ5P315",149,0)
 Q
"RTN","PSJ5P315",150,0)
 ;
"RTN","PSJ5P315",151,0)
TST ;
"RTN","PSJ5P315",152,0)
 N P1 S P1=1
"RTN","PSJ5P315",153,0)
 D EN(P1)
"RTN","PSJ5P315",154,0)
 Q
"RTN","PSJ5P315",155,0)
 ;
"RTN","PSJBCMA")
0^40^B138494525^B124935631
"RTN","PSJBCMA",1,0)
PSJBCMA ;BIR/MV-RETURN INPATIENT ACTIVE MEDS (CONDENSED) ; 5/4/16 10:51am
"RTN","PSJBCMA",2,0)
 ;;5.0;INPATIENT MEDICATIONS ;**32,41,46,57,63,66,56,69,58,81,91,104,111,112,186,159,173,190,113,225,253,267,279,308,318,315**;16 DEC 97;Build 73
"RTN","PSJBCMA",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PSJBCMA",4,0)
 ; Reference to ^PS(50.7 is supported by DBIA 2180.
"RTN","PSJBCMA",5,0)
 ; Reference to ^PS(51 is supported by DBIA 2176.
"RTN","PSJBCMA",6,0)
 ; Reference to ^PS(51.1 is supported by DBIA 2177.
"RTN","PSJBCMA",7,0)
 ; Reference to ^PS(51.2 is supported by DBIA 2178.
"RTN","PSJBCMA",8,0)
 ; Reference to ^PS(52.6 is supported by DBIA 1231.
"RTN","PSJBCMA",9,0)
 ; Reference to ^PS(52.7 is supported by DBIA 2173.
"RTN","PSJBCMA",10,0)
 ; Reference to ^PS(55 is supported by DBIA 2191.
"RTN","PSJBCMA",11,0)
 ; Reference to ^PSDRUG is supported by DBIA 2192.
"RTN","PSJBCMA",12,0)
 ; Reference to ^VADPT is supported by DBIA 10061.
"RTN","PSJBCMA",13,0)
 ; Reference to ^XLFDT is supported by DBIA 10103
"RTN","PSJBCMA",14,0)
 ; Usage of this routine by BCMA is supported by DBIA 2828.
"RTN","PSJBCMA",15,0)
 ;
"RTN","PSJBCMA",16,0)
 ;*267 - add new piece of info to return TMP global. Need the Med 
"RTN","PSJBCMA",17,0)
 ;       route IEN per each order.
"RTN","PSJBCMA",18,0)
 ;*279 - add Clinic name, IEN to pieces 11, 12 of TMP("PSJ",$J,0)
"RTN","PSJBCMA",19,0)
 ;     - add High Risk drug Witness indicator to Results 7th piece
"RTN","PSJBCMA",20,0)
 ;*315 - add BCMA removal flag to 7th piece of 700 node
"RTN","PSJBCMA",21,0)
 ;
"RTN","PSJBCMA",22,0)
EN(DFN,BDT,OTDATE)         ; return condensed list of inpatient meds
"RTN","PSJBCMA",23,0)
 NEW CNT,DN,F,FON,ON,PST,WBDT,X,X1,X2,Y,%
"RTN","PSJBCMA",24,0)
 D:+$G(DFN) ORDER
"RTN","PSJBCMA",25,0)
 I '$D(^TMP("PSJ",$J,1,0)) S ^(0)=-1
"RTN","PSJBCMA",26,0)
 K PSJINX
"RTN","PSJBCMA",27,0)
 Q
"RTN","PSJBCMA",28,0)
ORDER ;Loop thru orders.
"RTN","PSJBCMA",29,0)
 I '+$G(BDT) D NOW^%DTC S BDT=%
"RTN","PSJBCMA",30,0)
 I BDT'["." S BDT=BDT_".0001"
"RTN","PSJBCMA",31,0)
 S PSJINX=0
"RTN","PSJBCMA",32,0)
 ;U/D orders
"RTN","PSJBCMA",33,0)
 S F="^PS(55,DFN,5,",WBDT=BDT
"RTN","PSJBCMA",34,0)
 F  S WBDT=$O(^PS(55,DFN,5,"AUS",WBDT)) Q:'WBDT  D
"RTN","PSJBCMA",35,0)
 . F ON=0:0 S ON=$O(^PS(55,DFN,5,"AUS",WBDT,ON)) Q:'ON  S FON=ON_"U",PSJON(FON)="" D UDVAR
"RTN","PSJBCMA",36,0)
 ;IV orders
"RTN","PSJBCMA",37,0)
 S F="^PS(55,DFN,""IV"",",WBDT=BDT
"RTN","PSJBCMA",38,0)
 F  S WBDT=$O(^PS(55,DFN,"IV","AIS",WBDT)) Q:'WBDT  D
"RTN","PSJBCMA",39,0)
 . F ON=0:0 S ON=$O(^PS(55,DFN,"IV","AIS",WBDT,ON)) Q:'ON  S FON=ON_"V",PSJON(FON)="" D IVVAR
"RTN","PSJBCMA",40,0)
 ;Pending orders
"RTN","PSJBCMA",41,0)
 S F="^PS(53.1,"
"RTN","PSJBCMA",42,0)
 F PST="P","N" F ON=0:0 S ON=$O(^PS(53.1,"AS",PST,DFN,ON)) Q:'ON  D
"RTN","PSJBCMA",43,0)
 . S FON=ON_"P"
"RTN","PSJBCMA",44,0)
 . S X=$P($G(^PS(53.1,+ON,0)),U,4) D @$S(X="F":"IVVAR",1:"UDVAR")
"RTN","PSJBCMA",45,0)
 ;When a one-time order is found, check against PSJON(FON) array to
"RTN","PSJBCMA",46,0)
 ;make sure no duplicates return on ^TMP.
"RTN","PSJBCMA",47,0)
 I '+$G(OTDATE) D NOW^%DTC S X1=$E(%,1,12),X2=-30 D C^%DTC S OTDATE=X
"RTN","PSJBCMA",48,0)
 I OTDATE'["." S OTDATE=OTDATE_".0001"
"RTN","PSJBCMA",49,0)
 Q:BDT'>OTDATE
"RTN","PSJBCMA",50,0)
 S F="^PS(55,DFN,5,",WBDT=OTDATE
"RTN","PSJBCMA",51,0)
 F  S WBDT=$O(^PS(55,DFN,5,"AU","O",WBDT)) Q:'WBDT  D
"RTN","PSJBCMA",52,0)
 .  F ON=0:0 S ON=$O(^PS(55,DFN,5,"AU","O",WBDT,ON)) Q:'ON  D
"RTN","PSJBCMA",53,0)
 .. S FON=ON_"U" D:'$D(PSJON(FON)) UDVAR
"RTN","PSJBCMA",54,0)
 S F="^PS(55,DFN,""IV"",",WBDT=OTDATE
"RTN","PSJBCMA",55,0)
 F  S WBDT=$O(^PS(55,DFN,"IV","AIS",WBDT)) Q:'WBDT  D
"RTN","PSJBCMA",56,0)
 . F ON=0:0 S ON=$O(^PS(55,DFN,"IV","AIS",WBDT,ON)) Q:'ON  D
"RTN","PSJBCMA",57,0)
 .. S X=$P($G(^PS(55,DFN,"IV",ON,0)),U,9)
"RTN","PSJBCMA",58,0)
 .. I X]"",$$ONE(DFN,ON_"V",X,$P(X,"^",2),$P(X,"^",3))="O" D
"RTN","PSJBCMA",59,0)
 ... S FON=ON_"V" D:'$D(PSJON(FON)) IVVAR
"RTN","PSJBCMA",60,0)
 K PSJON,PSJBCID
"RTN","PSJBCMA",61,0)
 Q
"RTN","PSJBCMA",62,0)
UDVAR ;Set ^TMP for Unit dose & Pending orders
"RTN","PSJBCMA",63,0)
 N CLINIC
"RTN","PSJBCMA",64,0)
 D UDPEND I '$$CLINICS($G(CLINIC)) Q
"RTN","PSJBCMA",65,0)
 D TMP
"RTN","PSJBCMA",66,0)
 ;Setup Dispense drug for ^TMP
"RTN","PSJBCMA",67,0)
 S CNT=0 D NOW^%DTC
"RTN","PSJBCMA",68,0)
 F X=0:0 S X=$O(@(F_ON_",1,"_X_")")) Q:'X  D
"RTN","PSJBCMA",69,0)
 . S PSJDD=@(F_ON_",1,"_X_",0)") I $P(PSJDD,"^",3)]"",$P(PSJDD,"^",3)'>% Q
"RTN","PSJBCMA",70,0)
 .;*225 Don't allow 0
"RTN","PSJBCMA",71,0)
 . I +$P(PSJDD,"^",2)=0 S $P(PSJDD,"^",2)=1
"RTN","PSJBCMA",72,0)
 . S CNT=CNT+1
"RTN","PSJBCMA",73,0)
 . S ^TMP("PSJ",$J,PSJINX,700,CNT,0)=+PSJDD_U_$P($G(^PSDRUG(+PSJDD,0)),U)_U_$S((FON["U")&($P(PSJDD,U,2)=""):1,(FON["U")&($E($P(PSJDD,U,2))="."):"0"_$P(PSJDD,U,2),1:$P(PSJDD,U,2))_U_$P(PSJDD,U,3)
"RTN","PSJBCMA",74,0)
 . ;add High Risk field to 6th piece of 700 (disp drug)          ;*279
"RTN","PSJBCMA",75,0)
 . S $P(^TMP("PSJ",$J,PSJINX,700,CNT,0),U,6)=$$GET1^DIQ(50.7,PSJ("OI"),1,"I")
"RTN","PSJBCMA",76,0)
 . ;add Prompt For Removal In BCMA fld to 7th                    ;*315
"RTN","PSJBCMA",77,0)
 . S $P(^TMP("PSJ",$J,PSJINX,700,CNT,0),U,7)=+PSJ("MRRFL")
"RTN","PSJBCMA",78,0)
 S:CNT ^TMP("PSJ",$J,PSJINX,700,0)=CNT
"RTN","PSJBCMA",79,0)
 K PSJ,PSJDD
"RTN","PSJBCMA",80,0)
 Q
"RTN","PSJBCMA",81,0)
IVVAR ;Set variables for IV and pending orders
"RTN","PSJBCMA",82,0)
 NEW ND,X,Y,CLINIC
"RTN","PSJBCMA",83,0)
 I FON["P" D UDPEND Q:'$$CLINICS(CLINIC)  S PSJ("INFRATE")=$P($P($G(^PS(53.1,ON,8)),U,5),"@")
"RTN","PSJBCMA",84,0)
 I FON["V" D  Q:'$$CLINICS(CLINIC)
"RTN","PSJBCMA",85,0)
 . S X=$G(^PS(55,DFN,"IV",ON,0)),CLINIC=$G(^("DSS")) Q:'$$CLINICS(CLINIC)
"RTN","PSJBCMA",86,0)
 . S PSJ("STARTDT")=$P(X,U,2),PSJ("STOPDT")=$P(X,U,3)
"RTN","PSJBCMA",87,0)
 . S PSJ("INFRATE")=$P($P(X,U,8),"@"),PSJ("SCHD")=$P(X,U,9)
"RTN","PSJBCMA",88,0)
 . S PSJ("ADM")=$P(X,U,11),PSJ("AUTO")=$P(X,U,12),PSJ("STATUS")=$P(X,U,17)
"RTN","PSJBCMA",89,0)
 . S PSJ("IVTYPE")=$P(X,U,4),PSJ("INSYR")=$P(X,U,5)
"RTN","PSJBCMA",90,0)
 . S PSJ("CPRS")=$P(X,U,21),PSJ("CHEMO")=$P(X,U,23)
"RTN","PSJBCMA",91,0)
 . S X=$G(^PS(55,DFN,"IV",ON,.2))
"RTN","PSJBCMA",92,0)
 . S PSJ("DO")="",PSJ("MR")=$P(X,U,3),PSJ("PRI")=$P(X,U,4),PSJ("FLG")=$P(X,U,7),PSJ("COM")="",PSJ("SRC")=""
"RTN","PSJBCMA",93,0)
 . I PSJ("FLG") D
"RTN","PSJBCMA",94,0)
 .. N S1,A,B,C
"RTN","PSJBCMA",95,0)
 .. S S1="" F  S S1=$O(^PS(55,DFN,"IV",ON,"A",S1),-1) Q:'S1  S C=$G(^(S1,0)) S A=$P(C,U,2),B=$P(C,U,4) Q:A="UG"  D  I PSJ("SRC")]"" Q
"RTN","PSJBCMA",96,0)
 ... Q:A'="G"
"RTN","PSJBCMA",97,0)
 ... S PSJ("SRC")=$S(B["FLAGGED BY PHARM":"PHARMACIST",B["FLAGGED BY CPRS":"CPRS",1:"")
"RTN","PSJBCMA",98,0)
 ... S PSJ("COM")=$P(B," ",4,99)
"RTN","PSJBCMA",99,0)
 . S PSJ("OI")=+X
"RTN","PSJBCMA",100,0)
 . S X=$G(^PS(55,DFN,"IV",ON,2))
"RTN","PSJBCMA",101,0)
 . S PSJ("PREV")=$P(X,U,5) I PSJ("PREV")["V",(+PSJ("PREV")=+ON) S PSJ("PREV")=""
"RTN","PSJBCMA",102,0)
 . S PSJ("FOLLOW")=$P(X,U,6),PSJ("RFO")=$P(X,U,9) I PSJ("FOLLOW")["V",(+PSJ("FOLLOW")=+ON) S (PSJ("FOLLOW"),PSJ("RFO"))=""
"RTN","PSJBCMA",103,0)
 . S PSJ("SIOPI")=$S($P($G(^PS(55,DFN,"IV",+ON,3)),"^",2)&($P($G(^PS(55,DFN,"IV",+ON,3)),"^")'=""):"!",1:"")_$P($G(^(3)),"^")
"RTN","PSJBCMA",104,0)
 . N SCHD S SCHD=PSJ("SCHD")
"RTN","PSJBCMA",105,0)
 . S PSJ("STC")=$$ONE(DFN,ON_"V",SCHD,PSJ("STARTDT"),PSJ("STOPDT"))
"RTN","PSJBCMA",106,0)
 . I PSJ("STC")=""!(PSJ("STC")="C") S PSJ("STC")=$S(SCHD["PRN":"P",1:"C")
"RTN","PSJBCMA",107,0)
 . I PSJ("STC")="C" S PSJ("STC")=$S($$ONCALL(SCHD):"OC",1:"C")
"RTN","PSJBCMA",108,0)
 D TMP
"RTN","PSJBCMA",109,0)
 S CNT=0
"RTN","PSJBCMA",110,0)
 F X=0:0 S X=$O(@(F_ON_",""AD"","_X_")")) Q:'X  D
"RTN","PSJBCMA",111,0)
 . S ND=$G(@(F_ON_",""AD"","_X_",0)")),DN=$G(^PS(52.6,+ND,0))
"RTN","PSJBCMA",112,0)
 . S CNT=CNT+1,^TMP("PSJ",$J,PSJINX,850,CNT,0)=+ND_U_$P(DN,U)_U_$P(ND,U,2)_U_$P(ND,U,3)
"RTN","PSJBCMA",113,0)
 . ;add High Risk field to 6th piece of 850 (additv)             ;*279
"RTN","PSJBCMA",114,0)
 . S $P(^TMP("PSJ",$J,PSJINX,850,CNT,0),U,6)=$$HRFLG(+ND,"A")
"RTN","PSJBCMA",115,0)
 S:CNT ^TMP("PSJ",$J,PSJINX,850,0)=CNT,CNT=0
"RTN","PSJBCMA",116,0)
 F X=0:0 S X=$O(@(F_ON_",""SOL"","_X_")")) Q:'X  D
"RTN","PSJBCMA",117,0)
 . S ND=$G(@(F_ON_",""SOL"","_X_",0)")),DN=$G(^PS(52.7,+ND,0))
"RTN","PSJBCMA",118,0)
 . S CNT=CNT+1,^TMP("PSJ",$J,PSJINX,950,CNT,0)=+ND_U_$P(DN,U)_U_$P(ND,U,2)_U_$P(DN,U,4)
"RTN","PSJBCMA",119,0)
 . ;add High Risk field to 6th piece of 950 (sol)                ;*279
"RTN","PSJBCMA",120,0)
 . S $P(^TMP("PSJ",$J,PSJINX,950,CNT,0),U,6)=$$HRFLG(+ND,"S")
"RTN","PSJBCMA",121,0)
 S:CNT ^TMP("PSJ",$J,PSJINX,950,0)=CNT
"RTN","PSJBCMA",122,0)
 K PSJ
"RTN","PSJBCMA",123,0)
 S X1=0
"RTN","PSJBCMA",124,0)
 F  S X1=$O(^PS(55,DFN,"IVBCMA",X1)) Q:'X1  D
"RTN","PSJBCMA",125,0)
 . S XX=$G(^PS(55,DFN,"IVBCMA",X1,0)) Q:ON'=$P(XX,"^",2)  S PSJBCID=$P(XX,"^"),X2=0
"RTN","PSJBCMA",126,0)
 . F I=1:1 S X2=$O(^PS(55,DFN,"IVBCMA",X1,"AD",X2)) Q:'X2  D
"RTN","PSJBCMA",127,0)
 .. S X=^(X2,0),^TMP("PSJ",$J,PSJINX,800,PSJBCID,I)=+X_"^"_$S($D(^PS(52.6,+X,0)):$P(^(0),"^"),1:"*****")_"^"_$P(X,"^",2,99)
"RTN","PSJBCMA",128,0)
 .. ;add High Risk field to 6th piece of 800 (additv)            ;*279
"RTN","PSJBCMA",129,0)
 .. S $P(^TMP("PSJ",$J,PSJINX,800,PSJBCID,I),U,6)=$$HRFLG(+ND,"A")
"RTN","PSJBCMA",130,0)
 . I I>1 S ^TMP("PSJ",$J,PSJINX,800,PSJBCID,0)=I-1
"RTN","PSJBCMA",131,0)
 . S X2=0
"RTN","PSJBCMA",132,0)
 . F I=1:1 S X2=$O(^PS(55,DFN,"IVBCMA",X1,"SOL",X2)) Q:'X2  D
"RTN","PSJBCMA",133,0)
 .. S X=^(X2,0),^TMP("PSJ",$J,PSJINX,900,PSJBCID,I)=$P(X,"^")_"^"_$S($D(^PS(52.7,$P(X,"^"),0)):$P(^(0),"^"),1:"*****")_"^"_$P(X,"^",2,99)
"RTN","PSJBCMA",134,0)
 .. ;add High Risk field to 6th piece of 900 (sol)               ;*279
"RTN","PSJBCMA",135,0)
 .. S $P(^TMP("PSJ",$J,PSJINX,900,PSJBCID,I),U,6)=$$HRFLG(+X,"S")
"RTN","PSJBCMA",136,0)
 . I I>1 S ^TMP("PSJ",$J,PSJINX,900,PSJBCID,0)=I-1
"RTN","PSJBCMA",137,0)
 Q
"RTN","PSJBCMA",138,0)
UDPEND ;
"RTN","PSJBCMA",139,0)
 S X=$G(@(F_ON_",0)")) I $P(F,",")[53.1 S CLINIC=$G(@(F_ON_",""DSS"")")) Q:'$$CLINICS(CLINIC)
"RTN","PSJBCMA",140,0)
 I $P(F,",")[55 S CLINIC=$G(@(F_ON_",8)")) Q:'$$CLINICS(CLINIC)
"RTN","PSJBCMA",141,0)
 S PSJ("MR")=$P(X,U,3),PSJ("SM")=$P(X,U,5),PSJ("HSM")=$P(X,U,6)
"RTN","PSJBCMA",142,0)
 S PSJ("ST")=$P(X,U,7),PSJ("STATUS")=$P(X,U,9)
"RTN","PSJBCMA",143,0)
 S PSJ("CPRS")=$P(X,U,21),PSJ("PREV")=$P(X,U,25),PSJ("FOLLOW")=$P(X,U,26),PSJ("RFO")=$P(X,U,27)
"RTN","PSJBCMA",144,0)
 S:FON["U" PSJ("NGIVEN")=$P(X,U,22)
"RTN","PSJBCMA",145,0)
 S X=$G(@(F_ON_",.2)"))
"RTN","PSJBCMA",146,0)
 S PSJ("DO")=$P(X,U,2),PSJ("PRI")=$P(X,U,4),PSJ("FLG")=$P(X,U,7),PSJ("COM")="",PSJ("SRC")=""
"RTN","PSJBCMA",147,0)
 I PSJ("FLG") D
"RTN","PSJBCMA",148,0)
 . N S1,A,B,C
"RTN","PSJBCMA",149,0)
 . S S1="" F  S S1=$O(^PS(55,DFN,5,ON,9,S1),-1) Q:'S1  S C=$G(^(S1,0)) S A=$P(C,U,3),B=$P(C,U,4) Q:A=7010!(A=7030)  D  I PSJ("SRC")]"" Q
"RTN","PSJBCMA",150,0)
 .. Q:A'=7000&(A'=7020)
"RTN","PSJBCMA",151,0)
 .. S PSJ("SRC")=$S(A=7000:"PHARMACIST",A=7020:"CPRS",1:"")
"RTN","PSJBCMA",152,0)
 .. S PSJ("COM")=$G(@(F_ON_",13)"))
"RTN","PSJBCMA",153,0)
 S PSJ("OI")=+X
"RTN","PSJBCMA",154,0)
 S X=$G(@(F_ON_",2)"))
"RTN","PSJBCMA",155,0)
 S PSJ("SCHD")=$P(X,U),PSJ("STARTDT")=$P(X,U,2)
"RTN","PSJBCMA",156,0)
 S PSJ("PRSTOPDT")=$P(X,U,3)        ;*315 prev stop date for one times
"RTN","PSJBCMA",157,0)
 S PSJ("STOPDT")=$P(X,U,4),PSJ("ADM")=$P(X,U,5)
"RTN","PSJBCMA",158,0)
 S PSJ("FREQ")=$P(X,U,6)                                         ;*315
"RTN","PSJBCMA",159,0)
 ;save Duration & MRR code from 2.1 / convert code 2 = 1 or 3    ;*315
"RTN","PSJBCMA",160,0)
 S X=$G(@(F_ON_",2.1)"))
"RTN","PSJBCMA",161,0)
 S PSJ("DOA")=$P(X,U),PSJ("RMTM")=$P(X,U,2),PSJ("MRRFL")=+$P(X,U,4)
"RTN","PSJBCMA",162,0)
 I PSJ("MRRFL")=2 S PSJ("MRRFL")=$S(PSJ("DOA")>0:3,1:1)
"RTN","PSJBCMA",163,0)
 ;if DOA is null, but FREQ exists, then use FREQ as DOA when...
"RTN","PSJBCMA",164,0)
 S PSJ("DOA")=$S(PSJ("DOA")<1:$G(PSJ("FREQ")),1:PSJ("DOA"))
"RTN","PSJBCMA",165,0)
 ;
"RTN","PSJBCMA",166,0)
 S X=$G(@(F_ON_",4)"))
"RTN","PSJBCMA",167,0)
 S PSJ("AUTO")=$P(X,U,11)
"RTN","PSJBCMA",168,0)
 ;naked reference on line below refers to  full reference created by indirect reference to F_ON, where F may refer to ^PS(53.1 or the IV or UD multiple ^PS(55
"RTN","PSJBCMA",169,0)
 S PSJ("SIOPI")=$S($P($G(@(F_ON_",6)")),"^",2)&($P($G(@(F_ON_",6)")),"^")'=""):"!",1:"")_$$ENSET($P($G(^(6)),"^"))
"RTN","PSJBCMA",170,0)
 D SIOPI
"RTN","PSJBCMA",171,0)
 S PSJ("STC")=PSJ("ST")
"RTN","PSJBCMA",172,0)
 I PSJ("ST")="R"!(PSJ("ST")="C") S PSJ("STC")=$S(PSJ("SCHD")["PRN":"P",$$ONCALL(PSJ("SCHD")):"OC",$$ONE(DFN,FON,PSJ("SCHD"))="O":"O",1:"C")
"RTN","PSJBCMA",173,0)
 Q
"RTN","PSJBCMA",174,0)
TMP ;Setup ^TMP that have common fields between IV and U/D
"RTN","PSJBCMA",175,0)
 N A,CLNAME,CLNAMPTR                                             ;*279
"RTN","PSJBCMA",176,0)
 S PSJINX=PSJINX+1
"RTN","PSJBCMA",177,0)
 S PSJ("OINAME")=$$OIDF^PSJLMUT1(+PSJ("OI")) I PSJ("OINAME")["NOT FOUND" S PSJ("OINAME")=""
"RTN","PSJBCMA",178,0)
 S PSJ("OIDF")=$$GET1^DIQ(50.7,+PSJ("OI"),.02)
"RTN","PSJBCMA",179,0)
 I PSJ("OINAME")="" S PSJ("OIDF")=""
"RTN","PSJBCMA",180,0)
 S A=$G(^PS(51.2,+PSJ("MR"),0)),PSJ("MRABB")=$P(A,U,3),PSJ("MRNM")=$P(A,U)
"RTN","PSJBCMA",181,0)
 S ^TMP("PSJ",$J,PSJINX,0)=DFN_U_+ON_U_FON_U_PSJ("PREV")_U_PSJ("FOLLOW")_U_$G(PSJ("IVTYPE"))_U_$G(PSJ("INSYR"))_U_$G(PSJ("CHEMO"))_U_PSJ("CPRS")_U_$G(PSJ("RFO"))
"RTN","PSJBCMA",182,0)
 ;add Clinic name & IEN ptr to TMP 0 node (pieces 11,12)          *279
"RTN","PSJBCMA",183,0)
 ;piece 11 determines if order is a CO or IM for BCMA VDL's       *279
"RTN","PSJBCMA",184,0)
 I +CLINIC,$$CLINIC(CLINIC) D           ;CL IEN & valid appt date *279
"RTN","PSJBCMA",185,0)
 . S CLNAMPTR=$O(^PS(53.46,"B",+CLINIC,""))
"RTN","PSJBCMA",186,0)
 . S CLNAME=$$GET1^DIQ(53.46,CLNAMPTR_",",.01)
"RTN","PSJBCMA",187,0)
 . S $P(^TMP("PSJ",$J,PSJINX,0),U,11)=CLNAME      ;CO ind, CO NAME
"RTN","PSJBCMA",188,0)
 . S $P(^TMP("PSJ",$J,PSJINX,0),U,12)=+CLINIC     ;IEN ptr to file 44
"RTN","PSJBCMA",189,0)
 ;
"RTN","PSJBCMA",190,0)
 S ^TMP("PSJ",$J,PSJINX,1)=PSJ("MRABB")_U_PSJ("STC")_U_$G(PSJ("SCHD"))_U_PSJ("STARTDT")_U_PSJ("STOPDT")_U_PSJ("ADM")_U_PSJ("STATUS")_U_$G(PSJ("NGIVEN"))_U_$G(PSJ("ST"))_U_$G(PSJ("AUTO"))
"RTN","PSJBCMA",191,0)
 ;add DOA, Remove Times, MRR code, & prev stop DT to pieces 12-15 *315
"RTN","PSJBCMA",192,0)
 S $P(^TMP("PSJ",$J,PSJINX,1),U,12)=$G(PSJ("DOA"))
"RTN","PSJBCMA",193,0)
 S $P(^TMP("PSJ",$J,PSJINX,1),U,13)=$G(PSJ("RMTM"))
"RTN","PSJBCMA",194,0)
 S $P(^TMP("PSJ",$J,PSJINX,1),U,14)=$G(PSJ("MRRFL"))
"RTN","PSJBCMA",195,0)
 S $P(^TMP("PSJ",$J,PSJINX,1),U,15)=$G(PSJ("PRSTOPDT"))
"RTN","PSJBCMA",196,0)
 ;
"RTN","PSJBCMA",197,0)
 S ^TMP("PSJ",$J,PSJINX,1,0)=$P(A,U,8)_U_PSJ("MRNM")_U_$P(A,U,9)_U_+PSJ("MR")   ;*267 append file 51.2 ien 
"RTN","PSJBCMA",198,0)
 S ^TMP("PSJ",$J,PSJINX,2)=PSJ("DO")_U_$P($G(PSJ("INFRATE")),"@")_U_$G(PSJ("SM"))_U_$G(PSJ("HSM"))
"RTN","PSJBCMA",199,0)
 S ^TMP("PSJ",$J,PSJINX,3)=PSJ("OI")_U_PSJ("OINAME")_U_PSJ("OIDF")
"RTN","PSJBCMA",200,0)
 S ^TMP("PSJ",$J,PSJINX,4)=PSJ("SIOPI")
"RTN","PSJBCMA",201,0)
 S A=$$SNDTSTA^PSJHL4A(PSJ("PRI"),PSJ("SCHD"))
"RTN","PSJBCMA",202,0)
 S ^TMP("PSJ",$J,PSJINX,5)=$S(A=1:0,1:1)_U_PSJ("FLG")_U_PSJ("SRC")_U_PSJ("COM")
"RTN","PSJBCMA",203,0)
 Q
"RTN","PSJBCMA",204,0)
SIOPI ; Use provider comments if order is pending and there is no SI
"RTN","PSJBCMA",205,0)
 NEW X,Y,Z
"RTN","PSJBCMA",206,0)
 I FON["P",(PSJ("SIOPI")=""),$O(^PS(53.1,+ON,12,0)) D
"RTN","PSJBCMA",207,0)
 . F X=0:0 S X=$O(^PS(53.1,+ON,12,X)) Q:'X  S Z=$G(^(X,0)) D
"RTN","PSJBCMA",208,0)
 .. S Y=$L(PSJ("SIOPI"))
"RTN","PSJBCMA",209,0)
 .. S:Y+$L(Z)'>179 PSJ("SIOPI")=PSJ("SIOPI")_Z_""
"RTN","PSJBCMA",210,0)
 . I Y+$L(Z)>179 S PSJ("SIOPI")="SEE PROVIDER COMMENTS"
"RTN","PSJBCMA",211,0)
 Q
"RTN","PSJBCMA",212,0)
ENSET(X) ; expands SPECIAL INSTRUCTIONS field contained in X into Y
"RTN","PSJBCMA",213,0)
 N X1,X2,Y S Y=""
"RTN","PSJBCMA",214,0)
 F X1=1:1:$L(X," ") S X2=$P(X," ",X1) I X2]"" S Y=Y_$S($L(X2)>30:X2,'$D(^PS(51,+$O(^PS(51,"B",X2,0)),0)):X2,$P(^(0),"^",2)]""&$P(^(0),"^",4):$P(^(0),"^",2),1:X2)_" "
"RTN","PSJBCMA",215,0)
 S Y=$E(Y,1,$L(Y)-1)
"RTN","PSJBCMA",216,0)
 Q Y
"RTN","PSJBCMA",217,0)
ONE(DFN,ORD,SCH,START,STOP) ;Determine if order is one-time, and return schedule type
"RTN","PSJBCMA",218,0)
 ; Input:  DFN - patient's IEN
"RTN","PSJBCMA",219,0)
 ;         ORD - order number
"RTN","PSJBCMA",220,0)
 ;         SCH - schedule text (required)
"RTN","PSJBCMA",221,0)
 ;         START - order start date (optional)
"RTN","PSJBCMA",222,0)
 ;         STOP - order stop date (optional)
"RTN","PSJBCMA",223,0)
 N X,ONEFRQ,TYP,T
"RTN","PSJBCMA",224,0)
 I $G(PSJ("PREV")),$G(PSJ("FOLLOW")) I +PSJ("PREV")=+PSJ("FOLLOW") S (PSJ("PREV"),PSJ("FOLLOW"))=""
"RTN","PSJBCMA",225,0)
 ; PSJ*5*190 One-Time PRN
"RTN","PSJBCMA",226,0)
 I $G(SCH)="",$G(DFN),$G(ORD) D
"RTN","PSJBCMA",227,0)
 .I ORD["U" S SCH=$P($G(^PS(55,DFN,5,+ORD,2)),"^")
"RTN","PSJBCMA",228,0)
 .I ORD["V" S SCH=$P($G(^PS(55,DFN,"IV",+ORD,0)),"^",9)
"RTN","PSJBCMA",229,0)
 I $G(SCH)]"",$$OTPRN^PSJBCMA3(SCH)="O" Q "O"
"RTN","PSJBCMA",230,0)
 I $G(DFN)]"",$G(ORD)]"",ORD["U",$P(^PS(55,DFN,5,+ORD,0),"^",7)'="R" Q $P(^PS(55,DFN,5,+ORD,0),"^",7)
"RTN","PSJBCMA",231,0)
 I $G(SCH)="" Q ""
"RTN","PSJBCMA",232,0)
 ; PSJ*5*113 Determine schedule type from ^PS(51.1, not from schedule name.
"RTN","PSJBCMA",233,0)
 I $D(^PS(51.1,"AC","PSJ",SCH)) S X=$O(^(SCH,"")) S X=$P(^PS(51.1,X,0),"^",5) Q $S(X="D":"C",1:X)
"RTN","PSJBCMA",234,0)
 I $G(START)]"",$G(STOP)]"",START=STOP Q "O"
"RTN","PSJBCMA",235,0)
 I $$DAY(SCH) Q "C"
"RTN","PSJBCMA",236,0)
 Q ""
"RTN","PSJBCMA",237,0)
 ;
"RTN","PSJBCMA",238,0)
CLINIC(CL) ; is a valid appointment date present?  1=yes 0 =no
"RTN","PSJBCMA",239,0)
 I $P(CL,"^",2)?7N!($P(CL,"^",2)?7N1".".N) Q 1
"RTN","PSJBCMA",240,0)
 Q 0
"RTN","PSJBCMA",241,0)
 ;
"RTN","PSJBCMA",242,0)
CLINICS(CL,IGNOSND) ;IM & CO order tests                                          *70
"RTN","PSJBCMA",243,0)
 ; Send IM orders always.  Send Clinic orders as CO order, if it
"RTN","PSJBCMA",244,0)
 ; meets below conditions, else send the order over as a IM order.
"RTN","PSJBCMA",245,0)
 ;
"RTN","PSJBCMA",246,0)
 ;   If CPRS sends the Clinic IEN and the appointment date when the
"RTN","PSJBCMA",247,0)
 ;   order is signed in CPRS, then this is a Clinic order and can be
"RTN","PSJBCMA",248,0)
 ;   sent to BCMA as a CO order, if it passes the 53.46 test as well.
"RTN","PSJBCMA",249,0)
 ;
"RTN","PSJBCMA",250,0)
 ; IGNOSND = Flag indicating the SEND TO BCMA parameter should be ignored.
"RTN","PSJBCMA",251,0)
 ; PSJHYBR = Hybrid order - contains reference to CLINIC, but no appointment date time
"RTN","PSJBCMA",252,0)
 ; Function Return values:   1 = Send order to BCMA
"RTN","PSJBCMA",253,0)
 ;                           0 = Do Not send order to BCMA
"RTN","PSJBCMA",254,0)
 ; * Orders with Clinic but no Appt should only be sent if patient is admitted or SEND TO BCMA flag set
"RTN","PSJBCMA",255,0)
 I '$G(CL)!$G(IGNOSND) Q 1
"RTN","PSJBCMA",256,0)
 N PSJVAIN4,X,PSJCNT,PSJSTRT,PSJSTOP,VAIP S PSJVAIN4=1 I $G(DFN) D
"RTN","PSJBCMA",257,0)
 .N VAIN,PSGP S PSGP=DFN D INP^VADPT I '$G(VAIN(4)) S PSJVAIN4=0 I $G(PSBRPT(".1"))'="" D  ;add code check for historical data when running BCMA
"RTN","PSJBCMA",258,0)
 ..S PSJSTOP=$P(PSBRPT(".1"),U,8),PSJSTRT=$P(PSBRPT(".1"),U,6) Q:'PSJSTOP!'(PSJSTRT)
"RTN","PSJBCMA",259,0)
 ..S PSJCNT=PSJSTRT F  Q:PSJCNT>PSJSTOP  S VAIP("D")=PSJCNT D IN5^VADPT S:+VAIP("3") PSJVAIN4=1 S PSJCNT=$$FMADD^XLFDT(PSJCNT,1) Q:$G(PSJVAIN4)  ;check to see if patient was admitted during time frame of report
"RTN","PSJBCMA",260,0)
 .I 'PSJVAIN4,$G(PSBREC(2)),$G(PSBREC(0))="ADMLKUP" S VAIP("D")=PSBREC(2) D IN5^VADPT S:+VAIP("3") PSJVAIN4=1 ;return patient data for Edit med log option if patient was admitted when med log entry was recorded
"RTN","PSJBCMA",261,0)
 .I 'PSJVAIN4,$G(PSBPRNDT) S VAIP("D")=$P(PSBSTRT,".") D IN5^VADPT S:+VAIP("3") PSJVAIN4=1 ;*318
"RTN","PSJBCMA",262,0)
 .I 'PSJVAIN4,($G(PSBTYPE)="PM"),$G(PSJ("STARTDT")) S VAIP("D")=$P(PSJ("STARTDT"),".") D IN5^VADPT S:+VAIP("3") PSJVAIN4=1 ;*318
"RTN","PSJBCMA",263,0)
 I $G(PSJVAIN4) Q:'$$CLINIC(CL) 1                          ;no valid appt date
"RTN","PSJBCMA",264,0)
 N A
"RTN","PSJBCMA",265,0)
 S A=$O(^PS(53.46,"B",+CL,"")) Q:'A 0
"RTN","PSJBCMA",266,0)
 Q:'$D(^PS(53.46,"B",+CL)) 0
"RTN","PSJBCMA",267,0)
 Q $P(^PS(53.46,A,0),"^",4)                 ;send to bcma? flag
"RTN","PSJBCMA",268,0)
 ;
"RTN","PSJBCMA",269,0)
DAY(SCH) ;determine if this is a 'day of the week' schedule
"RTN","PSJBCMA",270,0)
 I $G(SCH)="" Q 0
"RTN","PSJBCMA",271,0)
 N D,DAY,DAYS,I,X
"RTN","PSJBCMA",272,0)
 S DAYS="SUNDAY,MONDAY,TUESDAY,WEDNESDAY,THURSDAY,FRIDAY,SATURDAY"
"RTN","PSJBCMA",273,0)
 F I=1:1 S D=$P(SCH,"-",I) Q:D=""  D  Q:X=0
"RTN","PSJBCMA",274,0)
 . S X=0 F J=1:1:7 S DAY=$P(DAYS,",",J) D  Q:X=1
"RTN","PSJBCMA",275,0)
 .. I D=$E(DAY,1,$L(D)) S X=1
"RTN","PSJBCMA",276,0)
 Q X
"RTN","PSJBCMA",277,0)
 ;
"RTN","PSJBCMA",278,0)
ONCALL(SCHD) ; Check if a schedule is type On Call (all "APPSJ" schedules with a given name must have the same schedule type)
"RTN","PSJBCMA",279,0)
 N NXT,SCHARR,OCCHK
"RTN","PSJBCMA",280,0)
 S OCCHK=0
"RTN","PSJBCMA",281,0)
 Q:$G(SCHD)="" OCCHK
"RTN","PSJBCMA",282,0)
 Q:'$D(^PS(51.1,"APPSJ",SCHD)) OCCHK
"RTN","PSJBCMA",283,0)
 S NXT=0 F  S NXT=$O(^PS(51.1,"APPSJ",SCHD,NXT)) Q:'NXT  S TYP=$P($G(^PS(51.1,+NXT,0)),"^",5) S:TYP]"" SCHARR(TYP)=""
"RTN","PSJBCMA",284,0)
 I '$D(SCHARR("OC")) S OCCHK=0 Q OCCHK
"RTN","PSJBCMA",285,0)
 I $O(SCHARR("OC"))]""!($O(SCHARR("OC"),-1)]"") S OCCHK=0 Q OCCHK
"RTN","PSJBCMA",286,0)
 I $D(SCHARR("OC")) S OCCHK=1
"RTN","PSJBCMA",287,0)
 Q OCCHK
"RTN","PSJBCMA",288,0)
 ;
"RTN","PSJBCMA",289,0)
HRFLG(IEN,ADDSOL) ;Get High Risk flag for this Orderable Item
"RTN","PSJBCMA",290,0)
 N OIIEN
"RTN","PSJBCMA",291,0)
 S:ADDSOL="A" OIIEN=+$$GET1^DIQ(52.6,IEN,15,"I")
"RTN","PSJBCMA",292,0)
 S:ADDSOL="S" OIIEN=+$$GET1^DIQ(52.7,IEN,9,"I")
"RTN","PSJBCMA",293,0)
 Q +$$GET1^DIQ(50.7,OIIEN,1,"I")
"RTN","PSJBCMA",294,0)
 ;
"RTN","PSJBCMA1")
0^43^B132466379^B120598961
"RTN","PSJBCMA1",1,0)
PSJBCMA1 ;BIR/MV-RETURN INFORMATION FOR AN ORDER ; 5/4/16 1:09pm
"RTN","PSJBCMA1",2,0)
 ;;5.0;INPATIENT MEDICATIONS ;**32,41,46,57,63,66,56,58,81,91,104,186,159,173,253,267,279,315**;16 DEC 97;Build 73
"RTN","PSJBCMA1",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PSJBCMA1",4,0)
 ; Reference to ^PS(50.7 is supported by DBIA 2180.
"RTN","PSJBCMA1",5,0)
 ; Reference to ^PS(51.2 is supported by DBIA 2178.
"RTN","PSJBCMA1",6,0)
 ; Reference to ^PS(52.6 is supported by DBIA 1231.
"RTN","PSJBCMA1",7,0)
 ; Reference to ^PS(52.7 is supported by DBIA 2173.
"RTN","PSJBCMA1",8,0)
 ; Reference to ^PS(55 is supported by DBIA 2191.
"RTN","PSJBCMA1",9,0)
 ; Reference to ^PSDRUG is supported by DBIA 2192.
"RTN","PSJBCMA1",10,0)
 ; Reference to ^DIC is supported by DBIA 10006.
"RTN","PSJBCMA1",11,0)
 ; Reference to ^DIQ is supported by DBIA 2056.
"RTN","PSJBCMA1",12,0)
 ; Usage of this routine by BCMA is supported by DBIA 289.
"RTN","PSJBCMA1",13,0)
 ;
"RTN","PSJBCMA1",14,0)
 ;*267 add Standard Routine Name from file 51.2 field 10
"RTN","PSJBCMA1",15,0)
 ;*279 - return High Risk field form file #50 for Unit dose and IV's
"RTN","PSJBCMA1",16,0)
 ;        for the dispensed drug/additive/solution
"RTN","PSJBCMA1",17,0)
 ;     - add Clinic name, IEN to pieces 11, 12 of TMP("PSJ1",$J,0)
"RTN","PSJBCMA1",18,0)
 ;*315 - add Duration of Administration time for MRR (on/off) meds to 4 node
"RTN","PSJBCMA1",19,0)
 ;       also add BCMA removal flag to 7th piece of 700 node
"RTN","PSJBCMA1",20,0)
 ;
"RTN","PSJBCMA1",21,0)
EN(DFN,ON,PSJTMP,PSJIGS2B,PSJEXIST)         ; return detail data for Inpatient Meds.
"RTN","PSJBCMA1",22,0)
 NEW F,A
"RTN","PSJBCMA1",23,0)
 S PSJTMP=$S($G(PSJTMP)=1:"PSJ1",1:"PSJ")
"RTN","PSJBCMA1",24,0)
 I $G(ON)["U" S F="^PS(55,+$G(DFN),5,+ON" D:$D(@(F_")")) UDVAR
"RTN","PSJBCMA1",25,0)
 I $G(ON)["V" S F="^PS(55,+$G(DFN),""IV"",+ON" D:$D(@(F_")")) IVVAR
"RTN","PSJBCMA1",26,0)
 I $G(ON)["P" S F="^PS(53.1,+ON",X=$P($G(^PS(53.1,+ON,0)),U,4) D:$D(@(F_")")) @$S(X="F":"IVVAR",1:"UDVAR")
"RTN","PSJBCMA1",27,0)
 I '$D(^TMP(PSJTMP,$J,0)) S ^(0)=-1
"RTN","PSJBCMA1",28,0)
 Q
"RTN","PSJBCMA1",29,0)
 ;
"RTN","PSJBCMA1",30,0)
UDVAR ;* Set ^TMP for Unit dose & Pending orders
"RTN","PSJBCMA1",31,0)
 N CNT,CLINIC
"RTN","PSJBCMA1",32,0)
 D UDPEND I '$$CLINICS^PSJBCMA($G(CLINIC),$G(PSJIGS2B)) Q              ;*279
"RTN","PSJBCMA1",33,0)
 D TMP
"RTN","PSJBCMA1",34,0)
 ;* Setup Dispense drug for ^TMP
"RTN","PSJBCMA1",35,0)
 S CNT=0 D NOW^%DTC
"RTN","PSJBCMA1",36,0)
 F X=0:0 S X=$O(@(F_",1,"_X_")")) Q:'X  D
"RTN","PSJBCMA1",37,0)
 . S PSJDD=@(F_",1,"_X_",0)") I $P(PSJDD,"^",3)]"",$P(PSJDD,"^",3)'>% Q
"RTN","PSJBCMA1",38,0)
 . S CNT=CNT+1
"RTN","PSJBCMA1",39,0)
 . S ^TMP(PSJTMP,$J,700,CNT,0)=+PSJDD_U_$P($G(^PSDRUG(+PSJDD,0)),U)_U_$S((ON["U")&($P(PSJDD,U,2)=""):1,(ON["U")&($E($P(PSJDD,U,2))="."):"0"_$P(PSJDD,U,2),1:$P(PSJDD,U,2))_U_$P(PSJDD,U,3)
"RTN","PSJBCMA1",40,0)
 . ;add High Risk field to 6th piece of 700 (disp drug)          ;*279
"RTN","PSJBCMA1",41,0)
 . S $P(^TMP(PSJTMP,$J,700,CNT,0),U,6)=+$$GET1^DIQ(50.7,PSJ("OI"),1,"I")
"RTN","PSJBCMA1",42,0)
 . ;add Prompt For Removal In BCMA fld to 7th                    ;*315
"RTN","PSJBCMA1",43,0)
 . S $P(^TMP(PSJTMP,$J,700,CNT,0),U,7)=+PSJ("MRRFL")
"RTN","PSJBCMA1",44,0)
 S:CNT ^TMP(PSJTMP,$J,700,0)=CNT
"RTN","PSJBCMA1",45,0)
 K PSJ,PSJDD,PSJDN
"RTN","PSJBCMA1",46,0)
 Q
"RTN","PSJBCMA1",47,0)
IVVAR ;* Set variables for IV and pending orders
"RTN","PSJBCMA1",48,0)
 N CNT,DN,ND,X,Y,CLINIC,OIIEN
"RTN","PSJBCMA1",49,0)
 ;don't send orders to BCMA that fail the Clinic test            ;*279
"RTN","PSJBCMA1",50,0)
 ;     Pending's
"RTN","PSJBCMA1",51,0)
 I ON["P" D  I '$$CLINICS^PSJBCMA($G(CLINIC),$G(PSJIGS2B)) Q           ;*279
"RTN","PSJBCMA1",52,0)
 . D UDPEND                                                      ;*279
"RTN","PSJBCMA1",53,0)
 . S PSJ("INFRATE")=$P($P($G(^PS(53.1,ON,8)),U,5),"@")           ;*279
"RTN","PSJBCMA1",54,0)
 ;     IV's
"RTN","PSJBCMA1",55,0)
 I ON["V" D  I '$$CLINICS^PSJBCMA($G(CLINIC),$G(PSJIGS2B)) Q           ;*279
"RTN","PSJBCMA1",56,0)
 . S X=$G(^PS(55,DFN,"IV",+ON,0))
"RTN","PSJBCMA1",57,0)
 . S PSJ("STARTDT")=$P(X,U,2),PSJ("STOPDT")=$P(X,U,3)
"RTN","PSJBCMA1",58,0)
 . S PSJ("PROVIDER")=$P(X,U,6)
"RTN","PSJBCMA1",59,0)
 . S PSJEXIST=$S((PSJ("PROVIDER")'=""):1,1:0)
"RTN","PSJBCMA1",60,0)
 . S PSJ("INFRATE")=$P($P(X,U,8),"@"),PSJ("SCHD")=$P(X,U,9)
"RTN","PSJBCMA1",61,0)
 . S PSJ("ADM")=$P(X,U,11),PSJ("AUTO")=$P(X,U,12),PSJ("STATUS")=$P(X,U,17)
"RTN","PSJBCMA1",62,0)
 . S PSJ("FREQ")=$P(X,U,15),PSJ("IVTYPE")=$P(X,U,4)
"RTN","PSJBCMA1",63,0)
 . S PSJ("INSYR")=$P(X,U,5),PSJ("CPRS")=$P(X,U,21),PSJ("CHEMO")=$P(X,U,23)
"RTN","PSJBCMA1",64,0)
 . S X=$G(^PS(55,DFN,"IV",+ON,.2))
"RTN","PSJBCMA1",65,0)
 . S PSJ("OI")=$P(X,U),PSJ("DO")="",PSJ("PRI")=$P(X,U,4),PSJ("FLG")=$P(X,U,7),PSJ("COM")="",PSJ("SRC")=""
"RTN","PSJBCMA1",66,0)
 . I PSJ("FLG") D
"RTN","PSJBCMA1",67,0)
 .. N S1,A,B,C
"RTN","PSJBCMA1",68,0)
 .. S S1="" F  S S1=$O(^PS(55,DFN,"IV",+ON,"A",S1),-1) Q:'S1  S C=$G(^(S1,0)) S A=$P(C,U,2),B=$P(C,U,4) Q:A="UG"  D  I PSJ("SRC")]"" Q
"RTN","PSJBCMA1",69,0)
 ... Q:A'="G"
"RTN","PSJBCMA1",70,0)
 ... S PSJ("SRC")=$S(B["FLAGGED BY PHARM":"PHARMACIST",B["FLAGGED BY CPRS":"CPRS",1:"")
"RTN","PSJBCMA1",71,0)
 ... S PSJ("COM")=$P(B," ",4,99)
"RTN","PSJBCMA1",72,0)
 . S PSJ("MR")=$P(X,U,3)
"RTN","PSJBCMA1",73,0)
 . S X=$G(^PS(55,DFN,"IV",+ON,4))
"RTN","PSJBCMA1",74,0)
 . S PSJ("NURSE")=$P(X,U)
"RTN","PSJBCMA1",75,0)
 . S PSJ("PHARM")=$P(X,U,4)
"RTN","PSJBCMA1",76,0)
 . S X=$G(^PS(55,DFN,"IV",+ON,2))
"RTN","PSJBCMA1",77,0)
 . S PSJ("LDT")=$P(X,U)
"RTN","PSJBCMA1",78,0)
 . S PSJ("PREV")=$P(X,U,5),PSJ("FOLLOW")=$P(X,U,6)
"RTN","PSJBCMA1",79,0)
 . S PSJ("SIOPI")=$S($P($G(^PS(55,DFN,"IV",+ON,3)),"^",2)&($P($G(^PS(55,DFN,"IV",+ON,3)),"^")'=""):"!",1:"")_$P($G(^(3)),"^")
"RTN","PSJBCMA1",80,0)
 . N SCHD S SCHD=PSJ("SCHD")  ; SCHD var required to shorten $Select
"RTN","PSJBCMA1",81,0)
 . S PSJ("STC")=$$ONE^PSJBCMA(DFN,ON,SCHD,PSJ("STARTDT"),PSJ("STOPDT"))
"RTN","PSJBCMA1",82,0)
 . I PSJ("STC")=""!(PSJ("STC")="C") S PSJ("STC")=$S(SCHD["PRN":"P",1:"C")
"RTN","PSJBCMA1",83,0)
 . I PSJ("STC")="C" S PSJ("STC")=$S($$ONCALL^PSJBCMA(PSJ("SCHD")):"OC",1:"C")
"RTN","PSJBCMA1",84,0)
 . S PSJ("NURSE")=$P($G(^PS(55,DFN,"IV",+ON,4)),U)
"RTN","PSJBCMA1",85,0)
 . S CLINIC=$G(^PS(55,DFN,"IV",+ON,"DSS"))                       ;*279
"RTN","PSJBCMA1",86,0)
 ;
"RTN","PSJBCMA1",87,0)
 D TMP
"RTN","PSJBCMA1",88,0)
 S X=$P($G(^PS(55,DFN,"IV",+ON,1)),U) S:X]"" ^TMP(PSJTMP,$J,6)=X
"RTN","PSJBCMA1",89,0)
 S CNT=0
"RTN","PSJBCMA1",90,0)
 F X=0:0 S X=$O(@(F_",""AD"","_X_")")) Q:'X  D
"RTN","PSJBCMA1",91,0)
 . S ND=$G(@(F_",""AD"","_X_",0)")),DN=$G(^PS(52.6,+ND,0)) ;,AOINAME=$$OIDF^PSJLMUT1(+$P(DN,U,11)) I AOINAME["NOTFOUND" S AOINAME=""
"RTN","PSJBCMA1",92,0)
 . S CNT=CNT+1,^TMP(PSJTMP,$J,850,CNT,0)=+ND_U_$P(DN,U)_U_$P(ND,U,2)_U_$P(ND,U,3)        ;_U_U_$P(DN,U,11)_U_AOINAME_U_AOIDF
"RTN","PSJBCMA1",93,0)
 . ;add High Risk field to 6th piece of 800 (additv)             ;*279
"RTN","PSJBCMA1",94,0)
 . S $P(^TMP(PSJTMP,$J,850,CNT,0),U,6)=$$HRFLG^PSJBCMA(+ND,"A")
"RTN","PSJBCMA1",95,0)
 ;
"RTN","PSJBCMA1",96,0)
 S:CNT ^TMP(PSJTMP,$J,850,0)=CNT,CNT=0
"RTN","PSJBCMA1",97,0)
 F X=0:0 S X=$O(@(F_",""SOL"","_X_")")) Q:'X  D
"RTN","PSJBCMA1",98,0)
 . S ND=$G(@(F_",""SOL"","_X_",0)")),DN=$G(^PS(52.7,+ND,0)) ;,SOINAME=$$OIDF^PSJLMUT1(+$P(DN,U,11)) I SOINAME["NOTFOUND" S SOINAME=""
"RTN","PSJBCMA1",99,0)
 . S CNT=CNT+1,^TMP(PSJTMP,$J,950,CNT,0)=+ND_U_$P(DN,U)_U_$P(ND,U,2)_U_$P(DN,U,4)        ;_U_U_$P(DN,U,11)_U_SOINAME_U_SOIDF
"RTN","PSJBCMA1",100,0)
 . ;add High Risk field to 6th piece of 800 (additv)             ;*279
"RTN","PSJBCMA1",101,0)
 . S $P(^TMP(PSJTMP,$J,950,CNT,0),U,6)=$$HRFLG^PSJBCMA(+ND,"S")
"RTN","PSJBCMA1",102,0)
 S:CNT ^TMP(PSJTMP,$J,950,0)=CNT
"RTN","PSJBCMA1",103,0)
 K PSJ
"RTN","PSJBCMA1",104,0)
 S X1=0
"RTN","PSJBCMA1",105,0)
 F  S X1=$O(^PS(55,DFN,"IVBCMA",X1)) Q:'X1  D
"RTN","PSJBCMA1",106,0)
 . S XX=$G(^PS(55,DFN,"IVBCMA",X1,0)) Q:$P(XX,"^",2)'=+ON  S PSJBCID=$P(XX,"^"),X2=0
"RTN","PSJBCMA1",107,0)
 . F I=1:1 S X2=$O(^PS(55,DFN,"IVBCMA",X1,"AD",X2)) Q:'X2  D
"RTN","PSJBCMA1",108,0)
 .. S X=^(X2,0),^TMP(PSJTMP,$J,800,PSJBCID,I)=+X_"^"_$S($D(^PS(52.6,+X,0)):$P(^(0),"^"),1:"*****")_"^"_$P(X,"^",2,99)
"RTN","PSJBCMA1",109,0)
 .. ;add High Risk field to 6th piece of 800 (additv)            ;*279
"RTN","PSJBCMA1",110,0)
 .. S $P(^TMP(PSJTMP,$J,800,PSJBCID,I),U,6)=$$HRFLG^PSJBCMA(+X,"A")
"RTN","PSJBCMA1",111,0)
 . I I>1 S ^TMP(PSJTMP,$J,800,PSJBCID,0)=I-1
"RTN","PSJBCMA1",112,0)
 . S X2=0
"RTN","PSJBCMA1",113,0)
 . F I=1:1 S X2=$O(^PS(55,DFN,"IVBCMA",X1,"SOL",X2)) Q:'X2  D
"RTN","PSJBCMA1",114,0)
 .. S X=^(X2,0),^TMP(PSJTMP,$J,900,PSJBCID,I)=$P(X,"^")_"^"_$S($D(^PS(52.7,$P(X,"^"),0)):$P(^(0),"^"),1:"*****")_"^"_$P(X,"^",2,99)
"RTN","PSJBCMA1",115,0)
 .. ;add High Risk field to 6th piece of 900  (sol)              ;*279
"RTN","PSJBCMA1",116,0)
 .. S $P(^TMP(PSJTMP,$J,900,PSJBCID,I),U,6)=$$HRFLG^PSJBCMA(+X,"S")
"RTN","PSJBCMA1",117,0)
 . I I>1 S ^TMP(PSJTMP,$J,900,PSJBCID,0)=I-1
"RTN","PSJBCMA1",118,0)
 . S ^TMP(PSJTMP,$J,1000,PSJBCID)=$P(XX,"^",6)_"^"_$P(XX,"^",8)_"^"_$P(XX,"^",7)
"RTN","PSJBCMA1",119,0)
 Q
"RTN","PSJBCMA1",120,0)
UDPEND ;
"RTN","PSJBCMA1",121,0)
 S X=$G(@(F_",0)"))
"RTN","PSJBCMA1",122,0)
 ;get clinic node per F = global file                            ;*279
"RTN","PSJBCMA1",123,0)
 I $P(F,",")[53.1 S CLINIC=$G(@(F_",""DSS"")"))
"RTN","PSJBCMA1",124,0)
 I $P(F,",")[55 S CLINIC=$G(@(F_",8)"))
"RTN","PSJBCMA1",125,0)
 ;
"RTN","PSJBCMA1",126,0)
 S PSJ("PROVIDER")=$P(X,U,2)
"RTN","PSJBCMA1",127,0)
 S PSJEXIST=$S((PSJ("PROVIDER")'=""):1,1:0)
"RTN","PSJBCMA1",128,0)
 S PSJ("MR")=$P(X,U,3),PSJ("SM")=$P(X,U,5),PSJ("HSM")=$P(X,U,6)
"RTN","PSJBCMA1",129,0)
 S PSJ("ST")=$P(X,U,7),PSJ("STATUS")=$P(X,U,9)
"RTN","PSJBCMA1",130,0)
 S PSJ("LDT")=$P(X,U,16)
"RTN","PSJBCMA1",131,0)
 S:ON["U" PSJ("NGIVEN")=$P(X,U,22)
"RTN","PSJBCMA1",132,0)
 S PSJ("SMYN")=$S(+PSJ("SM"):"YES",1:"NO")
"RTN","PSJBCMA1",133,0)
 S PSJ("HSMYN")=$S(+PSJ("HSM"):"YES",1:"NO")
"RTN","PSJBCMA1",134,0)
 S PSJ("CPRS")=$P(X,U,21),PSJ("PREV")=$P(X,U,25),PSJ("FOLLOW")=$P(X,U,26)
"RTN","PSJBCMA1",135,0)
 S X=$G(@(F_",.2)"))
"RTN","PSJBCMA1",136,0)
 S PSJ("OI")=$P(X,U),PSJ("DO")=$P(X,U,2),PSJ("PRI")=$P(X,U,4),PSJ("FLG")=$P(X,U,7),PSJ("COM")="",PSJ("SRC")=""
"RTN","PSJBCMA1",137,0)
 I PSJ("FLG") D
"RTN","PSJBCMA1",138,0)
 . N S1,A,B,C
"RTN","PSJBCMA1",139,0)
 . S S1="" F  S S1=$O(^PS(55,DFN,5,+ON,9,S1),-1) Q:'S1  S C=$G(^(S1,0)) S A=$P(C,U,3),B=$P(C,U,4) Q:A=7010!(A=7030)  D  I PSJ("SRC")]"" Q
"RTN","PSJBCMA1",140,0)
 .. Q:A'=7000&(A'=7020)
"RTN","PSJBCMA1",141,0)
 .. S PSJ("SRC")=$S(A=7000:"PHARMACIST",A=7020:"CPRS",1:"")
"RTN","PSJBCMA1",142,0)
 .. S PSJ("COM")=$G(@(F_",13)"))
"RTN","PSJBCMA1",143,0)
 S X=$G(@(F_",2)"))
"RTN","PSJBCMA1",144,0)
 S PSJ("SCHD")=$P(X,U),PSJ("STARTDT")=$P(X,U,2)
"RTN","PSJBCMA1",145,0)
 S PSJ("STC")=PSJ("ST")
"RTN","PSJBCMA1",146,0)
 I PSJ("ST")="R"!(PSJ("ST")="C") S PSJ("STC")=$S(PSJ("SCHD")["PRN":"P",$$ONCALL^PSJBCMA(PSJ("SCHD")):"OC",$$ONE^PSJBCMA(DFN,ON,PSJ("SCHD"))="O":"O",1:"C")
"RTN","PSJBCMA1",147,0)
 I PSJ("STC")="O" S PSJ("ST")="O"
"RTN","PSJBCMA1",148,0)
 S PSJ("PRSTOPDT")=$P(X,U,3)        ;*315 prev stop date for one times
"RTN","PSJBCMA1",149,0)
 S PSJ("STOPDT")=$P(X,U,4),PSJ("ADM")=$P(X,U,5)
"RTN","PSJBCMA1",150,0)
 S PSJ("FREQ")=$P(X,U,6)
"RTN","PSJBCMA1",151,0)
 ;save Duration, remove times, & MRR code / convert code 2 = 1 or 3    ;*315
"RTN","PSJBCMA1",152,0)
 S X=$G(@(F_",2.1)")),PSJ("DOA")=$P(X,U),PSJ("RMTM")=$P(X,U,2),PSJ("MRRFL")=+$P(X,U,4)
"RTN","PSJBCMA1",153,0)
 I PSJ("MRRFL")=2 S PSJ("MRRFL")=$S(PSJ("DOA")>0:3,1:1)
"RTN","PSJBCMA1",154,0)
 ;if DOA is null, then use FREQ for DOA If below true:
"RTN","PSJBCMA1",155,0)
 S PSJ("DOA")=$S(PSJ("DOA")<1:$G(PSJ("FREQ")),1:PSJ("DOA"))
"RTN","PSJBCMA1",156,0)
 ;
"RTN","PSJBCMA1",157,0)
 S X=$G(@(F_",4)"))
"RTN","PSJBCMA1",158,0)
 S PSJ("NURSE")=$P(X,U),PSJ("AUTO")=$P(X,U,11)
"RTN","PSJBCMA1",159,0)
 S:ON["U" PSJ("PHARM")=+$P(X,U,3)
"RTN","PSJBCMA1",160,0)
 ; the naked reference on the line below refers to the full reference created by indirect reference to F, where F may refer to ^PS(53.1 or the IV or UD multiple ^PS(55
"RTN","PSJBCMA1",161,0)
 S PSJ("SIOPI")=$S($P($G(@(F_",6)")),"^",2)&($P($G(@(F_",6)")),"^")'=""):"!",1:"")_$$ENSET^PSJBCMA($P($G(^(6)),"^"))
"RTN","PSJBCMA1",162,0)
 NEW FON S FON=ON D SIOPI^PSJBCMA
"RTN","PSJBCMA1",163,0)
 Q 
"RTN","PSJBCMA1",164,0)
 ;
"RTN","PSJBCMA1",165,0)
TMP ;* Setup ^TMP that have common fields between IV and U/D
"RTN","PSJBCMA1",166,0)
 N CLNAME,CLNAMPTR
"RTN","PSJBCMA1",167,0)
 D NAME(PSJ("PROVIDER"),.PSJNAME,"","")
"RTN","PSJBCMA1",168,0)
 S PSJ("PRONAME")=PSJNAME K PSJNAME
"RTN","PSJBCMA1",169,0)
 I $D(PSJ("PHARM")) D
"RTN","PSJBCMA1",170,0)
 . D NAME(PSJ("PHARM"),.PSJNAME,.PSJINIT,.PSJPIEN)
"RTN","PSJBCMA1",171,0)
 . S PSJ("PHARM")=PSJPIEN,PSJ("PNAME")=PSJNAME,PSJ("PINIT")=PSJINIT K PSJNAME,PSJINIT,PSJPIEN
"RTN","PSJBCMA1",172,0)
 I +PSJ("NURSE") D
"RTN","PSJBCMA1",173,0)
 . D NAME(PSJ("NURSE"),.PSJNAME,.PSJINIT,"")
"RTN","PSJBCMA1",174,0)
 . S PSJ("NNAME")=PSJNAME,PSJ("NINIT")=PSJINIT K PSJNAME,PSJINIT
"RTN","PSJBCMA1",175,0)
 S A=$G(^PS(51.2,+PSJ("MR"),0)),PSJ("MRNM")=$P(A,U),PSJ("MRABB")=$P(A,U,3),PSJ("MRPIJ")=$P(A,U,8),PSJ("MRIVP")=$P(A,U,9)
"RTN","PSJBCMA1",176,0)
 S PSJ("MRSTDRNM")=$$GET1^DIQ(51.2,+PSJ("MR"),10)  ;*267 Std Rte name
"RTN","PSJBCMA1",177,0)
 S PSJ("OINAME")=$$OIDF^PSJLMUT1(+PSJ("OI")) I PSJ("OINAME")["NOT FOUND" S PSJ("OINAME")=""
"RTN","PSJBCMA1",178,0)
 S PSJ("OIDF")=$$GET1^DIQ(50.7,+PSJ("OI"),.02)
"RTN","PSJBCMA1",179,0)
 I PSJ("OINAME")="" S PSJ("OIDF")=""
"RTN","PSJBCMA1",180,0)
 S PSJ("LDTN")=$$DATE(PSJ("LDT"))
"RTN","PSJBCMA1",181,0)
 S PSJ("STARTDTN")=$$DATE(PSJ("STARTDT"))
"RTN","PSJBCMA1",182,0)
 S PSJ("STOPDTN")=$$DATE(PSJ("STOPDT"))
"RTN","PSJBCMA1",183,0)
 S X=$S(ON["V":PSJ("STC"),1:PSJ("ST"))
"RTN","PSJBCMA1",184,0)
 S PSJ("STNAME")=$S(X="C":"CONTINUOUS",X="O":"ONE TIME",X="P":"PRN",X="R":"FILL ON REQUEST",X="OC":"ON CALL",1:"NOT FOUND")
"RTN","PSJBCMA1",185,0)
 ;
"RTN","PSJBCMA1",186,0)
 S ^TMP(PSJTMP,$J,0)=DFN_U_+ON_U_ON_U_PSJ("PREV")_U_PSJ("FOLLOW")_U_$G(PSJ("IVTYPE"))_U_$G(PSJ("INSYR"))_U_$G(PSJ("CHEMO"))_U_PSJ("CPRS")
"RTN","PSJBCMA1",187,0)
 ;add Clinic name & IEN ptr to TMP 0 node (pieces 11,12)          *279
"RTN","PSJBCMA1",188,0)
 ;piece 11 determines if order is a CO or IM for BCMA VDL's       *279
"RTN","PSJBCMA1",189,0)
 I +CLINIC,$$CLINIC^PSJBCMA(CLINIC) D   ;CL IEN & valid appt date *279
"RTN","PSJBCMA1",190,0)
 . S CLNAMPTR=$O(^PS(53.46,"B",+CLINIC,""))
"RTN","PSJBCMA1",191,0)
 . S CLNAME=$$GET1^DIQ(53.46,CLNAMPTR_",",.01)
"RTN","PSJBCMA1",192,0)
 . S $P(^TMP(PSJTMP,$J,0),U,11)=CLNAME      ;CO ind, CO NAME
"RTN","PSJBCMA1",193,0)
 . S $P(^TMP(PSJTMP,$J,0),U,12)=+CLINIC     ;IEN ptr to file 44
"RTN","PSJBCMA1",194,0)
 ;
"RTN","PSJBCMA1",195,0)
 S ^TMP(PSJTMP,$J,1)=PSJ("PROVIDER")_U_PSJ("PRONAME")_U_PSJ("MR")_U_PSJ("MRABB")_U_$G(PSJ("SM"))_U_$G(PSJ("SMYN"))_U_$G(PSJ("HSM"))_U_$G(PSJ("HSMYN"))_U_$G(PSJ("NGIVEN"))_U_PSJ("STATUS")
"RTN","PSJBCMA1",196,0)
 S ^TMP(PSJTMP,$J,1)=^TMP(PSJTMP,$J,1)_U_$$STATUS(ON,PSJ("STATUS"))_U_$G(PSJ("AUTO"))_U_$G(PSJ("MRNM"))_U_PSJ("MRSTDRNM") ;*267 Std Rte nam
"RTN","PSJBCMA1",197,0)
 S ^TMP(PSJTMP,$J,1,0)=PSJ("MRPIJ")_U_$G(PSJ("MRIVP"))
"RTN","PSJBCMA1",198,0)
 S ^TMP(PSJTMP,$J,2)=PSJ("OI")_U_PSJ("OINAME")_U_PSJ("DO")_U_$P($G(PSJ("INFRATE")),"@")_U_$G(PSJ("SCHD"))_U_PSJ("OIDF")
"RTN","PSJBCMA1",199,0)
 S ^TMP(PSJTMP,$J,3)=PSJ("SIOPI")
"RTN","PSJBCMA1",200,0)
 S ^TMP(PSJTMP,$J,4)=PSJ("STC")_U_$G(PSJ("STNAME"))_U_PSJ("LDT")_U_PSJ("LDTN")_U_PSJ("STARTDT")_U_PSJ("STARTDTN")_U_PSJ("STOPDT")_U_PSJ("STOPDTN")_U_$$ADMIN(PSJ("ADM"))_U_$G(PSJ("ST"))_U_$G(PSJ("FREQ"))
"RTN","PSJBCMA1",201,0)
 ;add DOA, Remove Times, MRR code, & prev stop DT to pieces 12-15 *315
"RTN","PSJBCMA1",202,0)
 S $P(^TMP(PSJTMP,$J,4),U,12)=$G(PSJ("DOA"))
"RTN","PSJBCMA1",203,0)
 S $P(^TMP(PSJTMP,$J,4),U,13)=$G(PSJ("RMTM"))
"RTN","PSJBCMA1",204,0)
 S $P(^TMP(PSJTMP,$J,4),U,14)=$G(PSJ("MRRFL"))
"RTN","PSJBCMA1",205,0)
 S $P(^TMP(PSJTMP,$J,4),U,15)=$G(PSJ("PRSTOPDT"))
"RTN","PSJBCMA1",206,0)
 S ^TMP(PSJTMP,$J,5)=$G(PSJ("NURSE"))_U_$G(PSJ("NNAME"))_U_$G(PSJ("NINIT"))_U_$G(PSJ("PHARM"))_U_$G(PSJ("PNAME"))_U_$G(PSJ("PINIT"))
"RTN","PSJBCMA1",207,0)
 S A=$$SNDTSTA^PSJHL4A(PSJ("PRI"),PSJ("SCHD"))
"RTN","PSJBCMA1",208,0)
 S ^TMP(PSJTMP,$J,7)=$S(A=1:0,1:1)_U_PSJ("FLG")_U_PSJ("SRC")_U_PSJ("COM")
"RTN","PSJBCMA1",209,0)
 Q
"RTN","PSJBCMA1",210,0)
 ;
"RTN","PSJBCMA1",211,0)
NAME(X,NAME,INIT,IEN)  ;Lookup in ^VA(200.
"RTN","PSJBCMA1",212,0)
 ;X = IEN or Name in ^VA(200
"RTN","PSJBCMA1",213,0)
 ;IEN = Return IEN in ^VA(200
"RTN","PSJBCMA1",214,0)
 ;NAME = Return the name in 200
"RTN","PSJBCMA1",215,0)
 ;INIT = Return the initial
"RTN","PSJBCMA1",216,0)
 NEW DIC,Y
"RTN","PSJBCMA1",217,0)
 S DIC="^VA(200,",DIC(0)="NZ" D ^DIC
"RTN","PSJBCMA1",218,0)
 S IEN=+Y
"RTN","PSJBCMA1",219,0)
 S NAME=$G(Y(0,0))
"RTN","PSJBCMA1",220,0)
 S INIT=$P($G(Y(0)),U,2)
"RTN","PSJBCMA1",221,0)
 Q
"RTN","PSJBCMA1",222,0)
 ;
"RTN","PSJBCMA1",223,0)
DATE(Y) ; FM internal date/time to user readable, 4 digit year
"RTN","PSJBCMA1",224,0)
 ; Y - date in FileMan internal format
"RTN","PSJBCMA1",225,0)
 I $G(Y) S Y=Y_$E(".",Y'[".")_"0000" Q $E(Y,4,5)_"/"_$E(Y,6,7)_"/"_($E(Y,1,3)+1700)_"  "_$E(Y,9,10)_":"_$E(Y,11,12)
"RTN","PSJBCMA1",226,0)
 Q "********"
"RTN","PSJBCMA1",227,0)
 ;
"RTN","PSJBCMA1",228,0)
STATUS(ON,X)          ;
"RTN","PSJBCMA1",229,0)
 ; ON = IEN_"I/U/P"
"RTN","PSJBCMA1",230,0)
 ; X  = STATUS
"RTN","PSJBCMA1",231,0)
 I X="P" Q $S(ON["P":"PENDING",ON["V":"PURGE",1:"NOT FOUND")
"RTN","PSJBCMA1",232,0)
 Q $S(X="A":"ACTIVE",X="D":"DISCONTINUED",X="E":"EXPIRED",X="H":"HOLD",X="R":"RENEWED",X="RE":"REINSTATED",X="N":"NON-VERFIED",X="DE":"DISCONTINUED (EDIT)",X="O":"ON CALL",1:"NOT FOUND")
"RTN","PSJBCMA1",233,0)
 ;
"RTN","PSJBCMA1",234,0)
ADMIN(X) ;                 N
"RTN","PSJBCMA1",235,0)
 NEW Y,PSJADM,PSJX S PSJADM=""
"RTN","PSJBCMA1",236,0)
 I X="" Q ""
"RTN","PSJBCMA1",237,0)
 F Y=1:1:$L(X,"-") S PSJX=$E($P(X,"-",Y)_"0000",1,4) D
"RTN","PSJBCMA1",238,0)
 . S PSJADM=PSJADM_$S(PSJADM]"":"-",1:"")_PSJX
"RTN","PSJBCMA1",239,0)
 Q PSJADM
"RTN","PSJBCMA1",240,0)
 ;
"RTN","PSJBCMA1",241,0)
MVOPIAL(DFN,PSJI1,PSJI2) ; Move Other Print Info Activity log entries from NV order to Active order, during Verification
"RTN","PSJBCMA1",242,0)
 Q:'$G(DFN)!'$G(PSJI1)!'$G(PSJI2)  Q:'$D(^PS(55,DFN,"IV",+PSJI2,0))
"RTN","PSJBCMA1",243,0)
 I PSJI1["P",PSJI2["V" N AL,ALND,PNDND0,TXTLN,TXTCNT S AL=0,ALND=0 F  S AL=$O(^PS(53.1,+PSJI1,"A",AL)) Q:'AL  I ^(AL,0)["OTHER PRINT INFO" D
"RTN","PSJBCMA1",244,0)
 .Q:'$D(^PS(53.1,+PSJI1,"A",AL,1,0))  ; Don't retain activity log entry if no text
"RTN","PSJBCMA1",245,0)
 .S PNDND0=$G(^PS(53.1,+PSJI1,"A",AL,0)) N USER,NAME S USER=$P(PNDND0,"^",2) D NAME^PSGSICH(USER,.NAME)
"RTN","PSJBCMA1",246,0)
 .N AL2 S AL2=$O(^PS(55,DFN,"IV",+PSJI2,"A"," "),-1)+1 N OPILIN S OPILIN=+$O(^PS(53.1,+PSJI1,"A",AL,1,""),-1)
"RTN","PSJBCMA1",247,0)
 .S ^PS(55,DFN,"IV",+PSJI2,"A",AL2,0)=AL_"^E^"_NAME_"^^"_$P(PNDND0,"^")_"^"_USER,^PS(55,DFN,"IV",+PSJI2,"A",AL2,1,0)="^55.151^1^1"
"RTN","PSJBCMA1",248,0)
 .S ^PS(55,DFN,"IV",+PSJI2,"A",AL2,1,1,0)="OTHER PRINT INFO"
"RTN","PSJBCMA1",249,0)
 .S TXTLN=0 F TXTCNT=0:1 S TXTLN=$O(^PS(53.1,+PSJI1,"A",AL,1,TXTLN)) Q:'TXTLN  D
"RTN","PSJBCMA1",250,0)
 ..S ^PS(55,DFN,"IV",+PSJI2,"A",AL2,2,TXTLN,0)=^PS(53.1,+PSJI1,"A",AL,1,TXTLN,0)
"RTN","PSJBCMA1",251,0)
 .I $G(TXTCNT) S ^PS(55,DFN,"IV",+PSJI2,"A",AL2,2,0)="^^"_+$G(TXTCNT)_"^"_$G(TXTCNT)_"^"_+$G(^PS(53.1,+PSJI1,"A",AL,0)) D
"RTN","PSJBCMA1",252,0)
 ..S ^PS(55,DFN,"IV",+PSJI2,"A",AL2,1,1,0)="OTHER PRINT INFO"
"RTN","PSJBCMA1",253,0)
 Q
"RTN","PSJBCMA1",254,0)
 ;
"RTN","PSJBCMA1",255,0)
OPIWARN(AFTER) ; Warn user about OPI not printing on IV labels
"RTN","PSJBCMA1",256,0)
 N DIR S DIR=""
"RTN","PSJBCMA1",257,0)
 N PSJSTARZ S $P(PSJSTARZ,"*",69)="*" W !!?5,$E(PSJSTARZ,1,29)," WARNING ",$E(PSJSTARZ,1,31)
"RTN","PSJBCMA1",258,0)
 W !?5,"**",$S(AFTER:"             ",1:"            If "),"OTHER PRINT INFO exceeds 60 characters"_$S(AFTER:"!             **",1:",           **")
"RTN","PSJBCMA1",259,0)
 W !?5,"**  'Instructions too long. See Order View or BCMA for full text.' **"
"RTN","PSJBCMA1",260,0)
 W !?5,"**      will print on the IV label instead of the full text.       **",!?5,PSJSTARZ
"RTN","PSJBCMA1",261,0)
 W !! D PAUSE^VALM1
"RTN","PSJBCMA1",262,0)
 Q
"RTN","PSJCLOR2")
0^32^B116946050^B116286849
"RTN","PSJCLOR2",1,0)
PSJCLOR2 ;BIR/JCH - BUILD CLINIC ORDER LM HEADERS ; 2/28/12 9:11am
"RTN","PSJCLOR2",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**275,279,315**;16 DEC 97;Build 73
"RTN","PSJCLOR2",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PSJCLOR2",4,0)
 ; Reference to ^PS(55 is supported by DBIA 2191.
"RTN","PSJCLOR2",5,0)
 ; Reference to CWAD^ORQPT2 is supported by DBIA 2831.
"RTN","PSJCLOR2",6,0)
 ; Reference to ^SC is supported by DBIA 10040.
"RTN","PSJCLOR2",7,0)
 ;
"RTN","PSJCLOR2",8,0)
HDR(DFN) ; -- list screen header
"RTN","PSJCLOR2",9,0)
 ;   input:       DFN := ifn of pat
"RTN","PSJCLOR2",10,0)
 ;  output:  VALMHDR() := hdr array
"RTN","PSJCLOR2",11,0)
 ;
"RTN","PSJCLOR2",12,0)
 K VAIN,VADM,GMRA,PSJACNWP,PSJ,VAERR,VA,X
"RTN","PSJCLOR2",13,0)
 S PSJACNWP=1 D ENBOTH^PSJAC
"RTN","PSJCLOR2",14,0)
 D HDRO(DFN)
"RTN","PSJCLOR2",15,0)
 S PSJ="   Sex: "_$P(PSJPSEX,U,2),VALMHDR(4)=$$SETSTR^VALM1($S(PSJPDD:"Last ",1:"     ")_"Admitted: "_$P($G(PSJPAD),U,2),PSJ,45,23)
"RTN","PSJCLOR2",16,0)
 S PSJ="    Dx: "_$G(PSJPDX)
"RTN","PSJCLOR2",17,0)
 S:PSJPDD VALMHDR(5)=$$SETSTR^VALM1("Discharged: "_$E($P(PSJPDD,U,2),1,8),PSJ,48,26)
"RTN","PSJCLOR2",18,0)
 S:'PSJPDD VALMHDR(5)=$$SETSTR^VALM1("Last transferred: "_$$ENDTC^PSGMI(PSJPTD),PSJ,42,26)
"RTN","PSJCLOR2",19,0)
 Q
"RTN","PSJCLOR2",20,0)
 ;
"RTN","PSJCLOR2",21,0)
HDRO(DFN) ; Standardized part of profile header.
"RTN","PSJCLOR2",22,0)
 N PSJCLIN,PSJAPPT,PSJCLINN,RMORDT S (PSJCLIN,PSJAPPT)=0,(RMORDT,PSJCLINN)="" I $G(PSJORD) D
"RTN","PSJCLOR2",23,0)
 . S PSJCLIN=$S($G(PSJORD)["V":$G(^PS(55,DFN,"IV",+PSJORD,"DSS")),$G(PSJORD)["U":$G(^PS(55,DFN,5,+PSJORD,8)),$G(PSJORD)["P":$G(^PS(53.1,+PSJORD,"DSS")),1:"")
"RTN","PSJCLOR2",24,0)
 . S:PSJCLIN PSJAPPT=$P($G(PSJCLIN),U,2) I PSJCLIN,PSJAPPT S PSJCLINN=$P($G(^SC(+PSJCLIN,0)),U)
"RTN","PSJCLOR2",25,0)
 K VALMHDR I PSJCLINN]"" S PSJ=VADM(1),PSJ=$$SETSTR^VALM1("   Clinic: "_PSJCLINN,PSJ,28,26)
"RTN","PSJCLOR2",26,0)
 I PSJCLINN="" S PSJ=VADM(1),PSJ=$$SETSTR^VALM1($S('PSJPDD:"     ",1:"Last ")_"Ward: "_PSJPWDN,PSJ,30,18)
"RTN","PSJCLOR2",27,0)
 S X=$$CWAD^ORQPT2(DFN)
"RTN","PSJCLOR2",28,0)
 S:X]"" X=$G(IORVON)_X_$G(IORVOFF),PSJ=$$SETSTR^VALM1(X,PSJ,80-$L(X),80) S VALMHDR(1)=PSJ
"RTN","PSJCLOR2",29,0)
 S PSJ="   PID: "_$P(PSJPSSN,U,2)
"RTN","PSJCLOR2",30,0)
 S RMORDT=$S($G(PSJPDD):"Last ",1:"     ")_"Room-Bed: "_$G(PSJPRB)
"RTN","PSJCLOR2",31,0)
 I PSJCLINN]"",PSJAPPT S RMORDT="Clinic Date: "_$$ENDTC^PSGMI(PSJAPPT),RMORDT=$P(RMORDT,"  ")_" "_$P(RMORDT,"  ",2)
"RTN","PSJCLOR2",32,0)
 S PSJ=$$SETSTR^VALM1(RMORDT,PSJ,26,28),VALMHDR(2)=$$SETSTR^VALM1("Ht(cm): "_PSJPHT_" "_PSJPHTD,PSJ,55,25)
"RTN","PSJCLOR2",33,0)
 S PSJ="   DOB: "_$P($P(PSJPDOB,U,2)," ")_" ("_PSJPAGE_")",VALMHDR(3)=$$SETSTR^VALM1("Wt(kg): "_PSJPWT_" "_PSJPWTD,PSJ,55,25)
"RTN","PSJCLOR2",34,0)
 Q
"RTN","PSJCLOR2",35,0)
 ;
"RTN","PSJCLOR2",36,0)
INIT(PSJPROT) ; -- init bld vars
"RTN","PSJCLOR2",37,0)
 ; PSJPROT=1:UD ONLY; 2:IV ONLY; 3:BOTH
"RTN","PSJCLOR2",38,0)
 K PSJUDPRF,^TMP("PSJ",$J),^TMP("PSJON",$J),^TMP("PSJPRO",$J),^TMP("PSJCLOR",$J) D FULL^VALM1
"RTN","PSJCLOR2",39,0)
 N TMPCLIN,DFN,UDU S PSJVALQ=0,TMPCLIN="",DFN=PSGP,PSGSSAV=PSGSS,UDU=$S($P(PSJSYSU,";",3)>1:3,1:1)
"RTN","PSJCLOR2",40,0)
 S:PSJPROT=1 PSJUDPRF=1
"RTN","PSJCLOR2",41,0)
 D KILL^VALM10(),EN^PSJCLOR3(PSJPROT)
"RTN","PSJCLOR2",42,0)
 I '$D(^TMP("PSJ",$J)) W !!,?22,"NO CLINIC ORDERS FOUND." S VALMQUIT=1,PSJVALQ=1 D PAUSE^PSJLMUTL Q
"RTN","PSJCLOR2",43,0)
 S PSJLN=1,PSJEN=1 S PSJCLIN="" F  S PSJCLIN=$O(^TMP("PSJ",$J,PSJCLIN)) Q:PSJCLIN=""  S PSJTF=0,PSJC="" F  S PSJC=$O(^TMP("PSJ",$J,PSJCLIN,PSJC)) Q:PSJC=""  D
"RTN","PSJCLOR2",44,0)
 .N PSJF S PSJF="^PS("_$S("AO"[PSJC:"55,"_PSGP_",5,",PSJC="DF":"55,"_PSGP_",5,",1:"53.1,")
"RTN","PSJCLOR2",45,0)
 .I TMPCLIN'=PSJCLIN D TF S PSJTF=$E(PSJC,1),TMPCLIN=PSJCLIN    ;DAM 8-29-07 Added Q:PSJC="CB"  Q:PSJC="O"
"RTN","PSJCLOR2",46,0)
 .S PSJST="" F  S PSJST=$O(^TMP("PSJ",$J,PSJCLIN,PSJC,PSJST)) Q:PSJST=""  D
"RTN","PSJCLOR2",47,0)
 ..S PSJS="" F  S PSJS=$O(^TMP("PSJ",$J,PSJCLIN,PSJC,PSJST,PSJS)) Q:PSJS=""  Q:PSJC="CB"  Q:PSJC="O"  Q:PSJC="DF"  D ON      ;DAM 8-29-07  Added Q:PSJC="CB"  Q:PSJC="O"
"RTN","PSJCLOR2",48,0)
 .;
"RTN","PSJCLOR2",49,0)
 .;DAM 8-29-07   New code to place Pending Orders after Pending Renewal Orders on the roll and scroll display.  Non-Active Orders appear last.
"RTN","PSJCLOR2",50,0)
 S PSJCLIN="" F  S PSJCLIN=$O(^TMP("PSJ",$J,PSJCLIN)) Q:PSJCLIN=""  S PSJTF=0,PSJC="" F  S PSJC=$O(^TMP("PSJ",$J,PSJCLIN,PSJC)) Q:PSJC=""  D
"RTN","PSJCLOR2",51,0)
 . N PSJF S PSJF="^PS("_$S("AO"[PSJC:"55,"_PSGP_",5,",PSJC="DF":"55,"_PSGP_",5,",1:"53.1,")
"RTN","PSJCLOR2",52,0)
 . I PSJC="CB" I TMPCLIN'=PSJCLIN D TF S PSJTF=$E(PSJC,1),TMPCLIN=PSJCLIN                            ;These are Pending Orders
"RTN","PSJCLOR2",53,0)
 . I PSJC="CB" S PSJST="" F  S PSJST=$O(^TMP("PSJ",$J,PSJCLIN,PSJC,PSJST)) Q:PSJST=""  D
"RTN","PSJCLOR2",54,0)
 . . S PSJS="" F  S PSJS=$O(^TMP("PSJ",$J,PSJCLIN,PSJC,PSJST,PSJS)) Q:PSJS=""   D ON
"RTN","PSJCLOR2",55,0)
 . I PSJC="DF" I TMPCLIN'=PSJCLIN D TF S PSJTF=$E(PSJC,1),TMPCLIN=PSJCLIN                              ;These are recently DC Orders (mv)
"RTN","PSJCLOR2",56,0)
 . I PSJC="DF" S PSJST="" F  S PSJST=$O(^TMP("PSJ",$J,PSJCLIN,PSJC,PSJST)) Q:PSJST=""  D
"RTN","PSJCLOR2",57,0)
 . . S PSJS="" F  S PSJS=$O(^TMP("PSJ",$J,PSJCLIN,PSJC,PSJST,PSJS)) Q:PSJS=""   D ON
"RTN","PSJCLOR2",58,0)
 . I PSJC="O" I TMPCLIN'=PSJCLIN D TF S PSJTF=$E(PSJC,1),TMPCLIN=PSJCLIN                              ;These are Non-Active Orders
"RTN","PSJCLOR2",59,0)
 . I PSJC="O" S PSJST="" F  S PSJST=$O(^TMP("PSJ",$J,PSJCLIN,PSJC,PSJST)) Q:PSJST=""  D
"RTN","PSJCLOR2",60,0)
 . . S PSJS="" F  S PSJS=$O(^TMP("PSJ",$J,PSJCLIN,PSJC,PSJST,PSJS)) Q:PSJS=""   D ON
"RTN","PSJCLOR2",61,0)
 .; END DAM changes
"RTN","PSJCLOR2",62,0)
 .;
"RTN","PSJCLOR2",63,0)
 S VALMCNT=PSJLN-1
"RTN","PSJCLOR2",64,0)
DONE ;
"RTN","PSJCLOR2",65,0)
 K ^TMP("PSJCLOR",$J) M ^TMP("PSJCLOR",$J)=^TMP("PSJON",$J)
"RTN","PSJCLOR2",66,0)
 K PSJC,PSJEN,PSJLN,PSJST,PSJS,CNT,PSJPRI,^TMP("PSJ",$J),PSGSSAV,PSJDCEXP,PSJL,PSJON,PSJOS,PSJTF
"RTN","PSJCLOR2",67,0)
 Q
"RTN","PSJCLOR2",68,0)
ON ; Set order number into ^TMP
"RTN","PSJCLOR2",69,0)
 N PSJCLORD S PSJCLORD=1
"RTN","PSJCLOR2",70,0)
 S PSJSCHT=$S(PSJOS:PSJS,1:PSJST)
"RTN","PSJCLOR2",71,0)
 S PSJO="" F FQ=0:0 S PSJO=$O(^TMP("PSJ",$J,PSJCLIN,PSJC,PSJST,PSJS,PSJO)) Q:PSJO=""  S DN=^(PSJO) D
"RTN","PSJCLOR2",72,0)
 .N PRJPRI S PSJPRI=$S(PSJO["V":$P($G(^PS(55,PSGP,"IV",+PSJO,.2)),"^",4),PSJO["U":$P($G(^PS(55,PSGP,5,+PSJO,.2)),"^",4),1:$P($G(^PS(53.1,+PSJO,.2)),"^",4))
"RTN","PSJCLOR2",73,0)
 .S ^TMP("PSJON",$J,PSJEN)=PSJO,PSJL=$J(PSJEN,4) D @$S(PSJO["V":"PIV^PSJLMPRI(PSGP,PSJO,PSJF,DN)",PSJO["U":"PUD^PSJLMPRU(PSGP,PSJO,PSJF,DN)",1:"PIV^PSJLMPRI(PSGP,PSJO,PSJF,DN)") S ^TMP("PSJPRO",$J,0)=PSJEN,PSJEN=PSJEN+1
"RTN","PSJCLOR2",74,0)
 .S ^TMP("PSJON",$J)=+$O(^TMP("PSJON",$J,""),-1)
"RTN","PSJCLOR2",75,0)
 K DN,FQ,PSJSCHT
"RTN","PSJCLOR2",76,0)
 Q
"RTN","PSJCLOR2",77,0)
TF ; Set up order type header
"RTN","PSJCLOR2",78,0)
 NEW PSJDFHDR
"RTN","PSJCLOR2",79,0)
 I $D(^TMP("PSJ",$J,PSJCLIN)) D
"RTN","PSJCLOR2",80,0)
 .S PSJDCEXP=$$RECDCEXP^PSJP()
"RTN","PSJCLOR2",81,0)
 .S PSJDFHDR="RECENTLY DISCONTINUED/EXPIRED (LAST "_+$G(PSJDCEXP)_" HOURS)"
"RTN","PSJCLOR2",82,0)
 .N C,X,Y S C=PSJC,Y="",$P(Y," -",40)=""
"RTN","PSJCLOR2",83,0)
 .S X=PSJCLIN
"RTN","PSJCLOR2",84,0)
 .I $G(PSJCLIN)]"" S X=PSJCLIN
"RTN","PSJCLOR2",85,0)
 .S ^TMP("PSJPRO",$J,PSJLN,0)=$E($E(Y,1,(80-$L(X))/2)_" "_X_$E(Y,1,(80-$L(X))/2),1,80),PSJLN=PSJLN+1
"RTN","PSJCLOR2",86,0)
 Q
"RTN","PSJCLOR2",87,0)
TEST ; Headers
"RTN","PSJCLOR2",88,0)
 N X,Y S Y="",$P(Y," -",40)=""
"RTN","PSJCLOR2",89,0)
 F X="A C T I V E","P E N D I N G   R E N E W A L S","P E N D I N G ","N O N - V E R I F I E D","N O N - A C T I V E" W !,$E($E(Y,1,(80-$L(X))/2)_" "_X_$E(Y,1,(80-$L(X))/2),1,80)
"RTN","PSJCLOR2",90,0)
 Q
"RTN","PSJCLOR2",91,0)
VWDETAIL(PSGP) ;
"RTN","PSJCLOR2",92,0)
 N VAIN,VADM,PSJLM,PSGPRF,PSJPRP,PSJSYSL,DFN D ENCV^PSGSETU
"RTN","PSJCLOR2",93,0)
 S DFN=PSGP D ^PSJAC D INIT^PSJCLOR2(3)
"RTN","PSJCLOR2",94,0)
 S PSGPRF="",PSJPRP="P",PSJPR=0,PSJON=+$G(^TMP("PSJON",$J)) D FULL^VALM1,ENVW
"RTN","PSJCLOR2",95,0)
 D DONEVD
"RTN","PSJCLOR2",96,0)
 Q
"RTN","PSJCLOR2",97,0)
ENVW ; ask user to select or view any of the orders shown
"RTN","PSJCLOR2",98,0)
 S (PSGONC,PSGONR,PSGONV)=0,PSGLMT=PSJON S:$D(PSJPRF) PSGPRF=1
"RTN","PSJCLOR2",99,0)
 N PSJXDIR S PSJXDIR=$P($G(XQORNOD(0)),"=",2) I PSJXDIR S X=$E(PSJXDIR,1,$L(PSJXDIR)-1) D ENCHK^PSGON
"RTN","PSJCLOR2",100,0)
 I '$G(PSJXDIR) D ENASR^PSGON
"RTN","PSJCLOR2",101,0)
 K PSGPRF
"RTN","PSJCLOR2",102,0)
 G:X["^" DONEVD I X]"" S PSGOEA=""
"RTN","PSJCLOR2",103,0)
 K PSJDLW
"RTN","PSJCLOR2",104,0)
 I  F PSJOE=1:1:PSGODDD S PSGOE=PSJOE F PSJOE1=1:1:$L(PSGODDD(PSJOE),",")-1 S PSJOE2=$P(PSGODDD(PSJOE),",",PSJOE1),(PSGORD,PSJORD)=^TMP("PSJON",$J,PSJOE2) G:$D(PSJDLW) DONEVD D
"RTN","PSJCLOR2",105,0)
 .I PSJORD=+PSJORD N PSJO,PSJO1 S PSJO=PSJORD,PSJO1=0 F  S PSJO1=$O(^PS(53.1,"ACX",PSJO,PSJO1)) Q:'PSJO1  Q:$D(PSJDLW)  S PSJORD=PSJO1_"P",PSGOEA="" D GODO(PSJORD) S PSJORD=""
"RTN","PSJCLOR2",106,0)
 .Q:PSJORD=""  S PSGOEA="" D GODO(PSJORD)
"RTN","PSJCLOR2",107,0)
 Q
"RTN","PSJCLOR2",108,0)
 ;
"RTN","PSJCLOR2",109,0)
GODO(PSJORD) ; 
"RTN","PSJCLOR2",110,0)
 D GODO^PSJOE0
"RTN","PSJCLOR2",111,0)
 Q
"RTN","PSJCLOR2",112,0)
DONEVD ; Kill variables
"RTN","PSJCLOR2",113,0)
 K DTOUT,PSGONC,PSGONR,PSGONV,PSGODDD,PSGOE,PSGOEA,PSJL,PSJOE,PSJOE1,PSJOE2,PSJON,PSJPR,PSJPRF
"RTN","PSJCLOR2",114,0)
 Q
"RTN","PSJCLOR2",115,0)
 ;
"RTN","PSJCLOR2",116,0)
NEWORDER(PSGP,PSGORD,PSGNWSD,PSGOEAV) ;
"RTN","PSJCLOR2",117,0)
 N PSGSD,PSGOEEF,PSGOFD,PSGNEFD,PSGOSD,PSGFD,PSGAT,PSGFDN S PSGOEEF(10)=1,PSJNOLOK=0
"RTN","PSJCLOR2",118,0)
 K DIR I '$$LS^PSSLOCK(DFN,PSGORD) W !,"NO ACTION TAKEN ON ORDER",! D CONT^PSJOE0 S PSJNOLOK=1 Q
"RTN","PSJCLOR2",119,0)
 I $D(^PS(53.45,+$G(PSJSYSP),5)) N PSJFSI S PSJFSI=1 D FILESI^PSJBCMA5(DFN,PSGORD) N SIARRAY S SIARRAY="" D
"RTN","PSJCLOR2",120,0)
 .I PSGORD["P" M SIARRAY=^PS(53.1,+PSGORD,15) D NEWNVAL^PSGAL5(PSGORD,6000,"SPECIAL INSTRUCTIONS",,.SIARRAY)
"RTN","PSJCLOR2",121,0)
 .I PSGORD["U" M SIARRAY=^PS(55,DFN,5,+PSGORD,15) D NEWUDAL^PSGAL5(DFN,PSGORD,6000,"SPECIAL INSTRUCTIONS",,.SIARRAY)
"RTN","PSJCLOR2",122,0)
 I PSGORD["P" S PSJCOM=+$P($G(^PS(53.1,+PSGORD,.2)),"^",8) I PSJCOM D NEW^PSJCOM1 Q
"RTN","PSJCLOR2",123,0)
 ;
"RTN","PSJCLOR2",124,0)
 I PSGORD["P"!(PSGORD["U") D
"RTN","PSJCLOR2",125,0)
 .N PSGST,PSGSCH,PSGNESD,ND,ND2,ND2P1,PSJEDFLD,I ;*315
"RTN","PSJCLOR2",126,0)
 .F I=0,2 S ND(I)=$S($G(PSGORD)["P":$G(^PS(53.1,+PSGORD,I)),$G(PSGORD)["U":$G(^PS(55,+$G(PSGP),5,+PSGORD,I)),$G(PSJTMPON)["V":$G(^PS(55,+$G(PSGP),"IV",+PSGORD,I)),1:"")
"RTN","PSJCLOR2",127,0)
 .S PSGNESD=PSGNWSD,PSGSCH=$S(PSGORD["P"!(PSGORD["U"):$P(ND(2),"^"),PSGORD["V":$P(ND(0),"^",9),1:"")
"RTN","PSJCLOR2",128,0)
 .S PSGST=$S(PSGORD["P"!(PSGORD["U"):$P(ND(0),"^",7),1:""),(PSGFD,PSGOFD)=$S(PSGORD["V":$P(ND(0),"^",3),1:$P(ND(2),"^",4)),(PSGSD,PSGOSD)=$S(PSGORD["V":$P(ND(0),"^",2),1:$P(ND(2),"^",2))
"RTN","PSJCLOR2",129,0)
 .S PSGNEFD="" D ENFD^PSGNE3(PSGNWSD) S PSGFD=$S($G(PSGRDTX(+PSGORD,"PSGFD")):PSGRDTX(+PSGORD,"PSGFD"),1:PSGNEFD)
"RTN","PSJCLOR2",130,0)
 .I $G(PSGNEFD),(PSGNEFD<PSGNWSD) W $C(7),!?5,"*** THE START DATE CANNOT BE AFTER THE STOP DATE! ***" S PSJQMSG=1 Q
"RTN","PSJCLOR2",131,0)
 .S PSJEDFLD=$S(PSGORD["P":25,1:34) S PSGOEEF(PSJEDFLD)=1
"RTN","PSJCLOR2",132,0)
 ;
"RTN","PSJCLOR2",133,0)
 I PSGORD["U" D  Q
"RTN","PSJCLOR2",134,0)
 .N TMPNEFD S TMPNEFD=$G(PSGNEFD) S PSGOEEWF="^PS(55,"_PSGP_",5,"_+PSGORD_"," S (ND,ND0)=$G(@(PSGOEEWF_"0)")),ND2=$G(^(2)),ND2P1=$G(^(2.1)) ;*315
"RTN","PSJCLOR2",135,0)
 .D EN2^PSGOEEW
"RTN","PSJCLOR2",136,0)
 .S PSGOORD=PSGORD S (PSGNESD,SD,PSGSD)=PSGNWSD I ($G(TMPNEFD)'="") S (PSGNEFD,PSGFD)=TMPNEFD,PSGFDN=$$ENDD^PSGMI(PSGNEFD)_U_$$ENDTC^PSGMI(PSGNEFD)
"RTN","PSJCLOR2",137,0)
 .S PSGOFD=$P(^PS(55,PSGP,5,+PSGORD,2),"^",4),PSGOEENO=1,PSJOCL=+$G(^PS(55,PSGP,5,+PSGORD,8))
"RTN","PSJCLOR2",138,0)
 .W !,"START DATE/TIME: ",$$ENDD^PSGMI(PSGSD) D A34^PSJCLOR4
"RTN","PSJCLOR2",139,0)
 .S PSJNOO=$$ENNOO^PSJUTL5("E") I PSJNOO<0 W "    No changes made to this order!" D CONT^PSJOE0 Q
"RTN","PSJCLOR2",140,0)
 .N PSJOCL,PSGOEENO S PSGOEENO=1,PSJOCL=+$G(^PS(55,PSGP,5,+PSGORD,8))
"RTN","PSJCLOR2",141,0)
 .D NEW^PSGOEE
"RTN","PSJCLOR2",142,0)
 .Q
"RTN","PSJCLOR2",143,0)
 ;
"RTN","PSJCLOR2",144,0)
 I PSGORD["P"  D
"RTN","PSJCLOR2",145,0)
 .N DR,PSJTMPFD,P S DR="10////^S X=PSGSD;" S:$G(PSGOEEF(25)) DR=DR_"25////^S X=PSGFD;" S DR=DR_"W ""."";"
"RTN","PSJCLOR2",146,0)
 .S PSJTMPFD=PSGFD
"RTN","PSJCLOR2",147,0)
 .D GETUD^PSJLMGUD(PSGP,PSGORD) N PSGNESD,PSGPDRG,PSJOCL S PSGPDRG=PSGPD,PSJOCL=+$G(^PS(53.1,+PSGORD,"DSS")) S:$G(PSGOEEF(25)) (PSGNEFD,PSGFD)=PSJTMPFD,PSGFDN=$$ENDD^PSGMI(PSGNEFD)_U_$$ENDTC^PSGMI(PSGNEFD)
"RTN","PSJCLOR2",148,0)
 .Q:'$G(PSJOCL)  S PSGS0Y=PSGAT,(PSGNESD,PSGSD)=PSGNWSD,PSGPDRG=PSGPD,PSGPDRGN=PSGPDN,PSGOEE="E"
"RTN","PSJCLOR2",149,0)
 .W !,"START DATE/TIME: ",$$ENDD^PSGMI(PSGSD) D A25NV^PSJCLOR4
"RTN","PSJCLOR2",150,0)
 .N PSGOEENO S PSGOEENO=0 D UPD^PSGOEE
"RTN","PSJCLOR2",151,0)
 .D EN1^PSJHL2(PSGP,"XX",PSGORD)
"RTN","PSJCLOR2",152,0)
 ;
"RTN","PSJCLOR2",153,0)
 I PSGORD["V" D
"RTN","PSJCLOR2",154,0)
 .N ON55,ND,ND2,ND0,PSIVCHG,PSIVSYSP,P,PSJSTRDF,PSJSTPDF,PSJINIV S PSGOEEWF="^PS(55,"_PSGP_",""IV"","_+PSGORD_",",PSIVCHG=1
"RTN","PSJCLOR2",155,0)
 .I '$G(XQORNOD),$G(PSJTMPXQ) N XQORNOD S XQORNOD=PSJTMPXQ
"RTN","PSJCLOR2",156,0)
 .S XQORNOD(0)="^^E"
"RTN","PSJCLOR2",157,0)
 .S PSJSYSW0=$G(PSJSYSW0) ; Initialize/restore PSJSYSW0 ward parameters. Killed at exit in ENKV^PSGSETU.
"RTN","PSJCLOR2",158,0)
 .I $G(PSGOEAV),'$P(PSJSYSP0,U,9) S PSIVSYSP=PSJSYSP0 N PSJSYSP0 S PSJSYSP0=PSIVSYSP,$P(PSJSYSP0,"^",9)=1
"RTN","PSJCLOR2",159,0)
 .S (ND,ND0)=$G(@(PSGOEEWF_"0)")),ND2=$G(^(2)),ON55=PSGORD
"RTN","PSJCLOR2",160,0)
 .D GT55^PSIVORFB S P(2)=PSGNWSD D ENSTOP^PSIVCAL
"RTN","PSJCLOR2",161,0)
 .W !,"START DATE/TIME: ",$$ENDD^PSGMI(P(2))
"RTN","PSJCLOR2",162,0)
 .D A25V^PSJCLOR4(PSGP,PSGORD)
"RTN","PSJCLOR2",163,0)
 .D NEWORD^PSIVOPT1
"RTN","PSJCLOR2",164,0)
 .S PSJORL=$$ENORL^PSJUTL($G(VAIN(4))) S ON=ON55,OD=P(2) D:ON["V" EN^PSIVORE D EN1^PSJHL2(DFN,"SN",ON55,"NEW ORDER")
"RTN","PSJCLOR2",165,0)
 .N TMPOLD S TMPOLD=$S(ON55["P":$P($G(^PS(53.1,+ON55,0)),"^",25),ON55["V":$P($G(^PS(55,PSGP,"IV",+ON55,2)),"^",5),1:"") I TMPOLD D
"RTN","PSJCLOR2",166,0)
 ..I TMPOLD["V",$D(^PS(55,PSGP,"IV",+TMPOLD,10,1)) N LN S LN=+$O(^PS(55,PSGP,"IV",+TMPOLD,10,""),-1) D
"RTN","PSJCLOR2",167,0)
 ...S:ON55["P" ^PS(53.1,+ON55,16,0)="^53.1136^"_LN_"^"_LN S:ON55["V" ^PS(55,PSGP,"IV",+ON55,10,0)="^55.1154^"_LN_"^"_LN
"RTN","PSJCLOR2",168,0)
 ...S LN=0 F  S LN=$O(^PS(55,PSGP,"IV",+TMPOLD,10,LN)) Q:'LN  S:ON55["P" ^PS(53.1,+ON55,16,LN,0)=^PS(55,PSGP,"IV",+TMPOLD,10,LN,0) S:ON55["V" ^PS(55,PSGP,"IV",+ON55,10,LN,0)=^PS(55,PSGP,"IV",+TMPOLD,10,LN,0)
"RTN","PSJCLOR2",169,0)
 .;
"RTN","PSJCLOR2",170,0)
 I $G(PSJFSI)=1 I $$GETSI^PSJBCMA5(DFN,PSGORD) D FILESI^PSJBCMA5(DFN,$S($G(PSGOORD):PSGOORD,1:PSGORD))
"RTN","PSJCLOR2",171,0)
 I 'PSGOEAV,($G(PSGORD)["P"),'$G(^PS(53.1,+PSGORD,2.5)),$G(^PS(53.1,+PSGORD,0)) D
"RTN","PSJCLOR2",172,0)
 . N DUR S DUR=$$GETDUR^PSJLIVMD(PSGP,PSGORD,$S(PSGORD["P":"P",1:5),1) I DUR]"" K DA,DR,DIE S DIE="^PS(53.1,",DA=+PSGORD,DR="116////"_DUR D ^DIE
"RTN","PSJCLOR2",173,0)
 D NEWCLN^PSJCLOR5
"RTN","PSJCLOR2",174,0)
 D UNL^PSSLOCK(PSGP,PSGORD) I $G(PSGOORD) D UNL^PSSLOCK(PSGP,PSGOORD)
"RTN","PSJCLOR2",175,0)
 Q
"RTN","PSJCLOR2",176,0)
 ;
"RTN","PSJCLOR2",177,0)
DSPORD(PSGP,TMPORDER,PSJORDAR) ; Display order summary
"RTN","PSJCLOR2",178,0)
 D DSPORD^PSJCLOR5(PSGP,TMPORDER,.PSJORDAR)
"RTN","PSJCLOR2",179,0)
 Q
"RTN","PSJCLOR2",180,0)
 ;
"RTN","PSJCLOR2",181,0)
HDRDT ; Header Date Range
"RTN","PSJCLOR2",182,0)
 Q:'$G(PSJBEG)!'($G(PSJEND))  I $G(PSJTMPED),$P(PSJTMPED,"^",2) S PSJEND=$S($P(PSJTMPED,"^",2)'=$G(PSGP):+PSJTMPED,1:+PSJEND)
"RTN","PSJCLOR2",183,0)
 S VALMHDR(6)="          CLINIC ORDERS: "_$$FMTE^XLFDT(+$G(PSJBEG))_" to "_$$FMTE^XLFDT(+$G(PSJEND))
"RTN","PSJCLOR2",184,0)
 Q
"RTN","PSJCLOR2",185,0)
 ;
"RTN","PSJCLOR2",186,0)
CHGDT ; Change date range
"RTN","PSJCLOR2",187,0)
 N TMPBEG,TMPEND S TMPBEG=+PSJBEG,TMPEND=+PSJEND
"RTN","PSJCLOR2",188,0)
 D BEGDT I '$G(PSJBEG) S PSJBEG=+TMPBEG
"RTN","PSJCLOR2",189,0)
 D ENDDT(PSJBEG) I '$G(PSJEND) S PSJEND=+TMPEND
"RTN","PSJCLOR2",190,0)
 D INIT^PSJCLOR2(3) S VALMBCK="R" D HDR^PSJLMHED($S($G(DFN):DFN,1:$G(PSGP))) D HDRDT^PSJCLOR2
"RTN","PSJCLOR2",191,0)
 Q
"RTN","PSJCLOR2",192,0)
BEGDT ; begin date
"RTN","PSJCLOR2",193,0)
 I '$G(PSJTMPBG) S PSJTMPBG=+PSJBEG_"^"_PSGP
"RTN","PSJCLOR2",194,0)
 W !!?5,"Search for CLINIC Medication Orders with a Start Date/Time"
"RTN","PSJCLOR2",195,0)
 W !?5,"within the date range selected below: "
"RTN","PSJCLOR2",196,0)
 W ! K %DT S %DT("A")="Begin Search Date: ",%DT="TAE",%DT("B")=$P($$FMTE^XLFDT(PSJBEG,1),"@")
"RTN","PSJCLOR2",197,0)
 D ^%DT Q:Y<0!($D(DTOUT))  S (%DT(0),PSJBEG)=Y
"RTN","PSJCLOR2",198,0)
 Q
"RTN","PSJCLOR2",199,0)
ENDDT(BEG) ; end date
"RTN","PSJCLOR2",200,0)
 I $G(BEG) S $P(BEG,".",2)=24
"RTN","PSJCLOR2",201,0)
 I '$G(PSJTMPED) S PSJTMPED=+PSJEND_"^"_PSGP
"RTN","PSJCLOR2",202,0)
 W ! K DIR S DIR(0)="DA^"_BEG_"::TAE",DIR("A")="End Search Date: ",DIR("B")=$$FMTE^XLFDT(BEG) D ^DIR
"RTN","PSJCLOR2",203,0)
 S PSJEND=$S($G(Y):Y,1:BEG) I '$P(PSJEND,".",2) S PSJEND=Y_".24"
"RTN","PSJCLOR2",204,0)
 Q
"RTN","PSJCLOR5")
0^34^B94059685^B68088373
"RTN","PSJCLOR5",1,0)
PSJCLOR5 ;BIR/JCH - INPATIENT MEDICATIONS UTILITIES FOR CLINIC ORDERS ;25 SEP 97 / 7:43 AM
"RTN","PSJCLOR5",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**275,315**;16 DEC 97;Build 73
"RTN","PSJCLOR5",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PSJCLOR5",4,0)
 ; Reference to ^PS(55 is supported by DBIA# 2191
"RTN","PSJCLOR5",5,0)
 ; Reference to ^PS(50.7 is supported by DBIA 2180.
"RTN","PSJCLOR5",6,0)
 ; Reference to ^PS(51.2 is supported by DBIA 2178.
"RTN","PSJCLOR5",7,0)
 ; Reference to ^PS(52.6 is supported by DBIA 1231.
"RTN","PSJCLOR5",8,0)
 ; Reference to ^PS(52.7 is supported by DBIA 2173.
"RTN","PSJCLOR5",9,0)
 ;
"RTN","PSJCLOR5",10,0)
DSPORD(PSGP,TMPORDER,PSJORDAR) ; Display order summary
"RTN","PSJCLOR5",11,0)
 N NDP2,PSJOINM,TMPSTOP,ND0,ND2,ND2P1,NDP1,TMPSTARE,TMPSOL1,PSJBLANK S ND0=$S(TMPORDER["U":$G(^PS(55,PSGP,5,+TMPORDER,0)),TMPORDER["P":$G(^PS(53.1,+TMPORDER,0)),TMPORDER["V":$G(^PS(55,PSGP,"IV",+TMPORDER,0)),1:"") ;*315
"RTN","PSJCLOR5",12,0)
 S ND2=$S(TMPORDER["U":$G(^PS(55,PSGP,5,+TMPORDER,2)),TMPORDER["P":$G(^PS(53.1,+TMPORDER,2)),TMPORDER["V":$G(^PS(55,PSGP,"IV",+TMPORDER,2)),1:""),TMPSTOP=$P(ND2,"^",4)
"RTN","PSJCLOR5",13,0)
 S NDP2=$S(TMPORDER["U":$G(^PS(55,PSGP,5,+TMPORDER,.2)),TMPORDER["P":$G(^PS(53.1,+TMPORDER,.2)),TMPORDER["V":$G(^PS(55,PSGP,"IV",+TMPORDER,.2)),1:"")
"RTN","PSJCLOR5",14,0)
 S ND2P1=$S(TMPORDER["U":$G(^PS(55,PSGP,5,+TMPORDER,2.1)),TMPORDER["P":$G(^PS(53.1,+TMPORDER,2.1)),1:"") ;*315 DRP
"RTN","PSJCLOR5",15,0)
 I TMPORDER["V" S TMPSOL1=$G(^PS(55,PSGP,"IV",+TMPORDER,"SOL",1,0)),TMPSTOP=$P(ND0,"^",3)
"RTN","PSJCLOR5",16,0)
 S TMPSTARE=$S(TMPORDER["P"!(TMPORDER["U"):$$FMTE^XLFDT($P(ND2,"^",2),2),TMPORDER["V":$$FMTE^XLFDT($P(ND0,"^",2),2),1:"") I TMPSTARE D
"RTN","PSJCLOR5",17,0)
 .S TMPSTARE=$P(TMPSTARE,"@"),TMPSTOP=$P($$FMTE^XLFDT(TMPSTOP,2),"@") F TMPDT="TMPSTARE","TMPSTOP" N PSJPCNT,PSJPCV S PSJPCNT=0 F PSJPCNT=1:1 S PSJPCV=$P(@(TMPDT),"/",PSJPCNT) Q:(PSJPCV="")  I PSJPCV,(PSJPCV<10) D
"RTN","PSJCLOR5",18,0)
 ..S $P(@(TMPDT),"/",PSJPCNT)=0_+PSJPCV
"RTN","PSJCLOR5",19,0)
 .S TMPSTARE=TMPSTARE_"    "_TMPSTOP
"RTN","PSJCLOR5",20,0)
 I '$G(PSJORDAR) D
"RTN","PSJCLOR5",21,0)
 .I TMPORDER'["V" S PSJOINM=$P($G(^PS(50.7,+$P(NDP2,"^"),0)),"^") W !?5,$S(PSJOINM]"":PSJOINM,1:"DRUG NAME NOT FOUND") W ?50,TMPSTARE D
"RTN","PSJCLOR5",22,0)
 ..W !?8," Give: ",$P(NDP2,"^",2)," ",$P($G(^PS(51.2,+$P(ND0,"^",3),0)),"^",3)," ",$P(ND2,"^")
"RTN","PSJCLOR5",23,0)
 .I TMPORDER["V" D
"RTN","PSJCLOR5",24,0)
 ..N PSIVACNT,PSJINDNT,AD,ADINT,ADEXT S AD=0 F PSIVACNT=1:1  S AD=$O(^PS(55,PSGP,"IV",+TMPORDER,"AD",AD)) Q:AD=""  S ADINT=$G(^(AD,0)),AD(0)=$G(AD(0))+1 I ADINT W !?5,$P($G(^PS(52.6,+ADINT,0)),"^") I (PSIVACNT=1) W ?50,TMPSTARE
"RTN","PSJCLOR5",25,0)
 ..S PSJINDNT=$S($G(ADINT):8,1:4)
"RTN","PSJCLOR5",26,0)
 ..W !?PSJINDNT W " in ",$P($G(^PS(52.7,+$G(TMPSOL1),0)),"^")," ",$P(TMPSOL1,"^",2)," ",$P(ND0,"^",8),?50,$S('$G(ADINT):TMPSTARE,1:"")
"RTN","PSJCLOR5",27,0)
 I $G(PSJORDAR) S $P(PSJBLANK," ",75)=" " D
"RTN","PSJCLOR5",28,0)
 .I TMPORDER'["V" S PSJORDAR(1)="     "_$P($G(^PS(50.7,+$P(NDP2,"^"),0)),"^") D
"RTN","PSJCLOR5",29,0)
 ..S PSJORDAR(1)=PSJORDAR(1)_$E(PSJBLANK,1,49-$L(PSJORDAR(1)))_TMPSTARE
"RTN","PSJCLOR5",30,0)
 ..S PSJORDAR(2)=$E(PSJBLANK,1,8)_"Give: "_$P(NDP2,"^",2)_" "_$P($G(^PS(51.2,+$P(ND0,"^",3),0)),"^",3)_" "_$P(ND2,"^")
"RTN","PSJCLOR5",31,0)
 .I TMPORDER["V" N AD,ADINT,ADEXT,PSJINDNT,PAD1,PAD2 S $P(PAD1," ",75)=" " D
"RTN","PSJCLOR5",32,0)
 ..N II S II=1,AD=0 F  S AD=$O(^PS(55,PSGP,"IV",+TMPORDER,"AD",AD)) Q:AD=""  D
"RTN","PSJCLOR5",33,0)
 ...S ADINT=$G(^(AD,0)) I ADINT S ADEXT=$P($G(^PS(52.6,+ADINT,0)),"^") S AD(0)=$G(AD(0))+1,PSJORDAR(AD(0))="     "_ADEXT S PSJORDAR(AD(0))=PSJORDAR(AD(0))_$E(PSJBLANK,1,49-$L(PSJORDAR(AD(0))))_$S(II=1:TMPSTARE,1:""),II=II+1
"RTN","PSJCLOR5",34,0)
 ..S PSJINDNT=$S($G(ADINT):8,1:4)
"RTN","PSJCLOR5",35,0)
 ..S AD(0)=$G(AD(0))+1 S PSJORDAR(AD(0))=$E(PSJBLANK,1,PSJINDNT)_" in "_$P($G(^PS(52.7,+$G(TMPSOL1),0)),"^")_" "_$P(TMPSOL1,"^",2)_" "_$P(ND0,"^",8) D
"RTN","PSJCLOR5",36,0)
 ...S PSJORDAR(AD(0))=$E(PSJORDAR(AD(0)),1,49) S PAD2=49-$L(PSJORDAR(AD(0))),PAD2=$E(PAD1,1,PAD2) S PSJORDAR(AD(0))=PSJORDAR(AD(0))_$S('$G(ADINT):PAD2_TMPSTARE,1:"")
"RTN","PSJCLOR5",37,0)
 Q
"RTN","PSJCLOR5",38,0)
ORDCHK ; Check for conflicts among selected orders
"RTN","PSJCLOR5",39,0)
 N PSJHOLD,PSJSELOR,PSJREVDN,PSJOROR,PSJOROR2,PSJCOMFL,TMPSELX,TMPSELX2,TMPSELCO,TMPSELCO1,TMPSELCO2,PSJONCAL,PSJMRR
"RTN","PSJCLOR5",40,0)
 S PSJSELOR=$S($G(TMPSELOR):TMPSELOR,1:$P($G(Y(1)),"=",2)) Q:'PSJSELOR  I $E(PSJSELOR,$L(PSJSELOR))'="," S PSJSELOR=PSJSELOR_","
"RTN","PSJCLOR5",41,0)
 D NOW^%DTC S PSGDT=+$E(%,1,12),PSJCOMFL="",PSJONCAL=""
"RTN","PSJCLOR5",42,0)
 S TMPCNT=0,TMPSEL=0,PSJTMPON="" F TMPCNT=1:1:($L(PSJSELOR,",")) Q:'TMPCNT  D
"RTN","PSJCLOR5",43,0)
 .S TMPSEL=$P(PSJSELOR,",",TMPCNT) Q:'TMPSEL  S PSJTMPON=$G(^TMP("PSJON",$J,TMPSEL)) Q:'PSJTMPON
"RTN","PSJCLOR5",44,0)
 .N STAT S STAT=$S(PSJTMPON["U":$P($G(^PS(55,PSGP,5,+PSJTMPON,0)),"^",9),PSJTMPON["V":$P($G(^PS(55,PSGP,"IV",+PSJTMPON,0)),"^",17),1:"")
"RTN","PSJCLOR5",45,0)
 .I STAT="H" S PSJHOLD(PSJTMPON)=TMPSEL
"RTN","PSJCLOR5",46,0)
 .;*315 Begin changes
"RTN","PSJCLOR5",47,0)
 .I PSJTMPON["U",$P($G(^PS(55,PSGP,5,+PSJTMPON,2.1)),U,4)>1 S PSJMRR(TMPSEL)=PSJTMPON
"RTN","PSJCLOR5",48,0)
 .Q
"RTN","PSJCLOR5",49,0)
 S TMPSELCO=PSJSELOR
"RTN","PSJCLOR5",50,0)
 ;
"RTN","PSJCLOR5",51,0)
 I $D(PSJMRR)>1 D FULL^VALM1 D
"RTN","PSJCLOR5",52,0)
 .N PSJMRRCNT,PSJDASH1,TMPARRAY S $P(PSJDASH1,"-",75)="-"
"RTN","PSJCLOR5",53,0)
 .W !!,"The following orders you have selected may have a specified removal event and",!," cannot be edited via this option."
"RTN","PSJCLOR5",54,0)
 .W !,"Use the Inpatient Order entry option to modify these orders"
"RTN","PSJCLOR5",55,0)
 .W !!,"Orders for Medications that require removal:",?45,"Current Start / Stop Dates",!,PSJDASH1
"RTN","PSJCLOR5",56,0)
 .S TMPSEL=0 ;Display disallowed orders
"RTN","PSJCLOR5",57,0)
 .F PSJMRRCNT=1:1 S TMPSEL=$O(PSJMRR(TMPSEL)) Q:'TMPSEL  D
"RTN","PSJCLOR5",58,0)
 ..I '(PSJMRRCNT#8) N DIR W ! D CONT^PSJOE0,CLEAR^VALM1,FULL^VALM1 W !!,"Orders for Medications that require removal (CONTINUED):",?45,"Current Start / Stop Dates",!,PSJDASH1
"RTN","PSJCLOR5",59,0)
 ..D DSPORD^PSJCLOR2(PSGP,PSJMRR(TMPSEL))
"RTN","PSJCLOR5",60,0)
 ..Q  ;Build selection array
"RTN","PSJCLOR5",61,0)
 .F TMPCNT=1:1:$L(TMPSELCO,",") D
"RTN","PSJCLOR5",62,0)
 ..S TMPARRAY(TMPCNT)=$P(TMPSELCO,",",TMPCNT)
"RTN","PSJCLOR5",63,0)
 ..S TMPSEL=0
"RTN","PSJCLOR5",64,0)
 ..F  S TMPSEL=$O(PSJMRR(TMPSEL)) Q:'TMPSEL  D
"RTN","PSJCLOR5",65,0)
 ...I $G(TMPARRAY(TMPCNT))=TMPSEL K TMPARRAY(TMPCNT) ; If the selection is in disallowed array kill it.
"RTN","PSJCLOR5",66,0)
 ...Q
"RTN","PSJCLOR5",67,0)
 ..Q
"RTN","PSJCLOR5",68,0)
 .S TMPSEL="" K TMPSELCO
"RTN","PSJCLOR5",69,0)
 .S TMPSEL=$NA(TMPARRAY) F TMPCNT=1:1 S TMPSEL=$Q(@TMPSEL) Q:TMPSEL=""  S $P(TMPSELCO,",",TMPCNT)=@TMPSEL ; rebuild selection string
"RTN","PSJCLOR5",70,0)
 .N DIR W ! D CONT^PSJOE0 W !
"RTN","PSJCLOR5",71,0)
 .Q
"RTN","PSJCLOR5",72,0)
 ;
"RTN","PSJCLOR5",73,0)
 S (PSJSELOR,TMPSELOR)=TMPSELCO
"RTN","PSJCLOR5",74,0)
 ;end *315 changes
"RTN","PSJCLOR5",75,0)
 ;
"RTN","PSJCLOR5",76,0)
 I $D(PSJHOLD)>1 D FULL^VALM1 D
"RTN","PSJCLOR5",77,0)
 .N PSJDASH1 S $P(PSJDASH1,"-",75)="-"
"RTN","PSJCLOR5",78,0)
 .W !!,"  ON HOLD orders cannot be edited - no changes will be applied",!,"  to any of the following ON HOLD orders:"
"RTN","PSJCLOR5",79,0)
 .W !,"ON HOLD orders:",?45,"Current Start / Stop Dates",!,PSJDASH1
"RTN","PSJCLOR5",80,0)
 .N PSJOHCT S PSJOROR2="" F PSJOHCT=1:1 S PSJOROR2=$O(PSJHOLD(PSJOROR2)) Q:'PSJOROR2  D
"RTN","PSJCLOR5",81,0)
 ..I '(PSJOHCT#8) N DIR W ! D CONT^PSJOE0,CLEAR^VALM1,FULL^VALM1 W !!,"ON HOLD orders (CONTINUED):",?45,"Current Start / Stop Dates",!,PSJDASH1
"RTN","PSJCLOR5",82,0)
 ..D DSPORD^PSJCLOR2(PSGP,PSJOROR2)
"RTN","PSJCLOR5",83,0)
 ..I PSJHOLD(PSJOROR2)=$P(TMPSELCO,",") S TMPSELCO=$P(TMPSELCO,PSJHOLD(PSJOROR2)_",",2) Q
"RTN","PSJCLOR5",84,0)
 ..S TMPSELCO1=$P(TMPSELCO,","_PSJHOLD(PSJOROR2)_","),TMPSELCO2=$P(TMPSELCO,","_PSJHOLD(PSJOROR2)_",",2) S TMPSELCO=TMPSELCO1_$S(TMPSELCO2]"":","_TMPSELCO2,1:"")
"RTN","PSJCLOR5",85,0)
 .N DIR W ! D CONT^PSJOE0 W !
"RTN","PSJCLOR5",86,0)
 S (PSJSELOR,TMPSELOR)=TMPSELCO
"RTN","PSJCLOR5",87,0)
 S TMPCNT=0,TMPSEL=0,PSJTMPON="" F TMPCNT=1:1:($L(PSJSELOR,",")) Q:'TMPCNT  D
"RTN","PSJCLOR5",88,0)
 .S TMPSEL=$P(PSJSELOR,",",TMPCNT) Q:'TMPSEL  S PSJTMPON=$G(^TMP("PSJON",$J,TMPSEL)) Q:'PSJTMPON
"RTN","PSJCLOR5",89,0)
 .N STAT S STAT=$S(PSJTMPON["U":$P($G(^PS(55,PSGP,5,+PSJTMPON,0)),"^",9),PSJTMPON["V":$P($G(^PS(55,PSGP,"IV",+PSJTMPON,0)),"^",17),1:"")
"RTN","PSJCLOR5",90,0)
 .I STAT="O" S PSJONCAL(PSJTMPON)=TMPSEL
"RTN","PSJCLOR5",91,0)
 S TMPSELCO=PSJSELOR
"RTN","PSJCLOR5",92,0)
 I $D(PSJONCAL)>1 D FULL^VALM1 D
"RTN","PSJCLOR5",93,0)
 .N PSJOCCNT,PSJDASH1 S $P(PSJDASH1,"-",75)="-"
"RTN","PSJCLOR5",94,0)
 .W !!,"  Orders with ON CALL Status cannot be edited - no changes will be applied",!,"  to any of the following orders with ON CALL status:"
"RTN","PSJCLOR5",95,0)
 .W !,"ON CALL Status orders:",?45,"Current Start / Stop Dates",!,PSJDASH1
"RTN","PSJCLOR5",96,0)
 .S PSJOROR2="" F PSJOCCNT=1:1 S PSJOROR2=$O(PSJONCAL(PSJOROR2)) Q:'PSJOROR2  D
"RTN","PSJCLOR5",97,0)
 ..I '(PSJOCCNT#8) N DIR W ! D CONT^PSJOE0,CLEAR^VALM1,FULL^VALM1 W !!,"ON CALL Status orders (CONTINUED):",?45,"Current Start / Stop Dates",!,PSJDASH1
"RTN","PSJCLOR5",98,0)
 ..D DSPORD^PSJCLOR2(PSGP,PSJOROR2)
"RTN","PSJCLOR5",99,0)
 ..I PSJONCAL(PSJOROR2)=$P(TMPSELCO,",") S TMPSELCO=$P(TMPSELCO,PSJONCAL(PSJOROR2)_",",2) Q
"RTN","PSJCLOR5",100,0)
 ..S TMPSELCO1=$P(TMPSELCO,","_PSJONCAL(PSJOROR2)_","),TMPSELCO2=$P(TMPSELCO,","_PSJONCAL(PSJOROR2)_",",2) S TMPSELCO=TMPSELCO1_$S(TMPSELCO2]"":","_TMPSELCO2,1:"")
"RTN","PSJCLOR5",101,0)
 .N DIR W ! D CONT^PSJOE0 W !
"RTN","PSJCLOR5",102,0)
 S (PSJSELOR,TMPSELOR)=TMPSELCO
"RTN","PSJCLOR5",103,0)
 S TMPCNT=0,TMPSEL=0,PSJTMPON="" F TMPCNT=1:1:($L(PSJSELOR,",")) Q:'TMPCNT  D
"RTN","PSJCLOR5",104,0)
 .S TMPSEL=$P(PSJSELOR,",",TMPCNT) Q:'TMPSEL  S PSJTMPON=$G(^TMP("PSJON",$J,TMPSEL)) Q:'PSJTMPON
"RTN","PSJCLOR5",105,0)
 .I (PSJTMPON=+PSJTMPON),$D(^PS(53.1,"ACX",PSJTMPON)) S PSJCOMFL="P",PSJOROR="" F  S PSJOROR=$O(^PS(53.1,"ACX",PSJTMPON,PSJOROR)) Q:'PSJOROR  S PSJCOMFL(PSJOROR_"P")=TMPSEL
"RTN","PSJCLOR5",106,0)
 .I PSJCOMFL="" S PSJOROR=$S(PSJTMPON["U":$P($G(^PS(55,PSGP,5,+PSJTMPON,.2)),"^",8),PSJTMPON["V":$P($G(^PS(55,PSGP,"IV",+PSJTMPON,.2)),"^",8),1:"") Q:'PSJOROR  D
"RTN","PSJCLOR5",107,0)
 ..S PSJCOMFL(PSJTMPON)=TMPSEL
"RTN","PSJCLOR5",108,0)
 S TMPSELCO=PSJSELOR
"RTN","PSJCLOR5",109,0)
 I $D(PSJCOMFL)>1 D FULL^VALM1 D
"RTN","PSJCLOR5",110,0)
 .N PSJDASH1 S $P(PSJDASH1,"-",75)="-"
"RTN","PSJCLOR5",111,0)
 .W !!,"  Complex Orders cannot be edited - no changes will be applied",!,"   to any of the following Complex order components:"
"RTN","PSJCLOR5",112,0)
 .W !,"Complex Component (Child) Orders:",?45,"Current Start / Stop Dates",!,PSJDASH1
"RTN","PSJCLOR5",113,0)
 .N PSJCOMCT S PSJOROR2="" F PSJCOMCT=1:1 S PSJOROR2=$O(PSJCOMFL(PSJOROR2)) Q:'PSJOROR2  D
"RTN","PSJCLOR5",114,0)
 ..I '(PSJCOMCT#8) N DIR W ! D CONT^PSJOE0,CLEAR^VALM1,FULL^VALM1 W !!,"Complex orders (CONTINUED):",?45,"Current Start / Stop Dates",!,PSJDASH1
"RTN","PSJCLOR5",115,0)
 ..D DSPORD^PSJCLOR2(PSGP,PSJOROR2)
"RTN","PSJCLOR5",116,0)
 ..I PSJCOMFL(PSJOROR2)=$P(TMPSELCO,",") S TMPSELCO=$P(TMPSELCO,PSJCOMFL(PSJOROR2)_",",2) Q
"RTN","PSJCLOR5",117,0)
 ..S TMPSELCO1=$P(TMPSELCO,","_PSJCOMFL(PSJOROR2)_","),TMPSELCO2=$P(TMPSELCO,","_PSJCOMFL(PSJOROR2)_",",2) S TMPSELCO=TMPSELCO1_$S(TMPSELCO2]"":","_TMPSELCO2,1:"")
"RTN","PSJCLOR5",118,0)
 .W ! N DIR D CONT^PSJOE0 W !
"RTN","PSJCLOR5",119,0)
 S (PSJSELOR,TMPSELOR)=TMPSELCO
"RTN","PSJCLOR5",120,0)
 N TMPNEWSD,TMPSEL,TMPCLN,TMPCLNAR,PSJSTPDT,PSJTMPON,TMPCNT S PSJSTPDT="" S PSJQMSG=0,PSJABORT=0
"RTN","PSJCLOR5",121,0)
 I ('$G(PSGOEAV)&(+$G(PSJSYSU)=3))!(+$G(PSJSYSU)'=3) S TMPCNT=0,TMPSEL=0,PSJTMPON="" F TMPCNT=1:1:($L(PSJSELOR,",")) Q:'TMPCNT!$G(PSJREVFY)!$G(PSJREVDN)  D
"RTN","PSJCLOR5",122,0)
 .S TMPSEL=$P(PSJSELOR,",",TMPCNT) Q:'TMPSEL  S PSJTMPON=$G(^TMP("PSJON",$J,TMPSEL)) Q:'PSJTMPON
"RTN","PSJCLOR5",123,0)
 .I PSJTMPON["V"!(PSJTMPON["U") S PSJREVFY=$S(+PSJSYSU=3:$$PSJREVFY^PSJCLOR1(),1:$$SURE^PSJCLOR1()),PSJREVDN=1
"RTN","PSJCLOR5",124,0)
 I $G(DUOUT)!($G(PSJREVFY)<0) S PSJABORT=2 Q
"RTN","PSJCLOR5",125,0)
 ;
"RTN","PSJCLOR5",126,0)
 S TMPCNT=0,TMPSEL=0,PSJTMPON="" F TMPCNT=1:1:($L(PSJSELOR,",")) Q:'TMPCNT  S TMPSEL=$P(PSJSELOR,",",TMPCNT) Q:'TMPSEL  S PSJTMPON=$G(^TMP("PSJON",$J,TMPSEL)) Q:'PSJTMPON  D
"RTN","PSJCLOR5",127,0)
 .N ND0,ND2,NDP1 S ND0=$S(PSJTMPON["U":$G(^PS(55,PSGP,5,+PSJTMPON,0)),PSJTMPON["P":$G(^PS(53.1,+PSJTMPON,0)),PSJTMPON["V":$G(^PS(55,PSGP,"IV",+PSJTMPON,0)),1:"")
"RTN","PSJCLOR5",128,0)
 .S ND2=$S(PSJTMPON["U":$G(^PS(55,PSGP,5,+PSJTMPON,2)),PSJTMPON["P":$G(^PS(53.1,+PSJTMPON,2)),PSJTMPON["V":$G(^PS(55,PSGP,"IV",+PSJTMPON,2)),1:"")
"RTN","PSJCLOR5",129,0)
 .S ND2P1=$S(PSJTMPON["U":$G(^PS(55,PSGP,5,+PSJTMPON,2.1)),PSJTMPON["P":$G(^PS(53.1,+PSJTMPON,2.1)),1:"") ;*315
"RTN","PSJCLOR5",130,0)
 .S TMPSTR=$S(PSJTMPON["P"!(PSJTMPON["U"):$P(ND2,"^",2),PSJTMPON["V":$P(ND0,"^",2),1:"") S TMPSTR($P(TMPSTR,"."))=""
"RTN","PSJCLOR5",131,0)
 .S TMPCLN=$S(PSJTMPON["P":+$G(^PS(53.1,+PSJTMPON,"DSS")),PSJTMPON["U":+$G(^PS(55,+$G(PSGP),5,+PSJTMPON,8)),PSJTMPON["V":+$G(^PS(55,$G(PSGP),"IV",+PSJTMPON,"DSS")),1:"")
"RTN","PSJCLOR5",132,0)
 .Q:'TMPCLN  I $O(TMPCLNAR("")),$O(TMPCLNAR(""))'=TMPCLN S PSJABORT=1
"RTN","PSJCLOR5",133,0)
 .S TMPCLNAR(+TMPCLN)=""
"RTN","PSJCLOR5",134,0)
 S TMPSTR="" F  S TMPSTR=$O(TMPSTR(TMPSTR)) Q:'TMPSTR  S TMPSTR(0)=$G(TMPSTR(0))+1
"RTN","PSJCLOR5",135,0)
 I $G(PSJABORT)!($G(TMPSTR(0))>1) D
"RTN","PSJCLOR5",136,0)
 .K DIR S DIR("A",1)="     You have selected orders"_$S($G(PSJABORT):" from different clinics",1:" with different Start Date/Times")_"  "
"RTN","PSJCLOR5",137,0)
 .I $G(PSJABORT)&($G(TMPSTR(0))>1) S DIR("A",2)="          and with different Start Date/Times."
"RTN","PSJCLOR5",138,0)
 .S DIR("A",3)="",DIR("A",4)=""
"RTN","PSJCLOR5",139,0)
 .W ! N X,Y S DIR("A")="Do you want to continue",DIR(0)="Y" D ^DIR S PSJABORT=$S(Y>0:1,1:2)
"RTN","PSJCLOR5",140,0)
 Q
"RTN","PSJCLOR5",141,0)
 ; 
"RTN","PSJCLOR5",142,0)
NEWCLN ; Clean up Order variables
"RTN","PSJCLOR5",143,0)
 K PSGNEDFD,PSGOEE,PSGOEEWF,PSGOORD,PSGPD,PSGPDN,PSGPDRGN,PSGRDTX,PSGS0Y,PSJCOM,PSJL,PSJNOO,PSJQMSG
"RTN","PSJCLOR5",144,0)
 K PSJTMPON,VALMBCK,VALMCNT,VALMQUIT
"RTN","PSJCLOR5",145,0)
 Q
"RTN","PSJCOM")
0^44^B42503350^B41203922
"RTN","PSJCOM",1,0)
PSJCOM ;BIR/CML3-FINISH COMPLEX UNIT DOSE ORDERS ENTERED THROUGH OE/RR ;02 Feb 2001  12:20 PM
"RTN","PSJCOM",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**110,186,267,281,315**;16 DEC 97;Build 73
"RTN","PSJCOM",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PSJCOM",4,0)
 ; Reference to ^VALM1 is supported by DBIA 10116.
"RTN","PSJCOM",5,0)
 ; Reference to ^PS(55 is supported by DBIA 2191.
"RTN","PSJCOM",6,0)
 ; Reference to ^%DTC is supported by DBIA 10000.
"RTN","PSJCOM",7,0)
 ; Reference to ^%RCR is supported by DBIA 10022.
"RTN","PSJCOM",8,0)
 ; Reference to ^DIR is supported by DBIA 10026.
"RTN","PSJCOM",9,0)
 ; Reference to ^TIUEDIT is supported by DBIA 2410.
"RTN","PSJCOM",10,0)
 ; Reference to ^TMP("PSODAOC",$J supported by DBIA 6071.
"RTN","PSJCOM",11,0)
 ;
"RTN","PSJCOM",12,0)
UPD ;
"RTN","PSJCOM",13,0)
 Q:'PSJCOM
"RTN","PSJCOM",14,0)
 M ^TMP("PSJCOM",$J,+PSGORD)=^PS(53.1,+PSGORD)
"RTN","PSJCOM",15,0)
 I PSGST="",(PSGSCH="NOW"!(PSGSCH="ONCE")) S PSGST="O"
"RTN","PSJCOM",16,0)
 S $P(^TMP("PSJCOM",$J,+PSGORD,0),"^",9)="N",$P(^(0),"^",4)="U",$P(^(0),"^",7)=PSGST,$P(^TMP("PSJCOM",$J,+PSGORD,2),"^",2)=PSGSD,$P(^(2),"^",4)=PSGFD
"RTN","PSJCOM",17,0)
 I $D(PSGSI),$P($G(^PS(53.1,+PSGORD,0)),U,24)'="R" S ^TMP("PSJCOM",$J,+PSGORD,6)=PSGSI
"RTN","PSJCOM",18,0)
 I $D(PSGSI),$P($G(^PS(53.1,+PSGORD,0)),U,24)="R" S $P(^TMP("PSJCOM",$J,+PSGORD,6),U)=$P(PSGSI,U) I $P(PSGSI,U)="" S $P(^TMP("PSJCOM",$J,+PSGORD,6),U,2)=""
"RTN","PSJCOM",19,0)
 S:$D(PSGSCH) $P(^TMP("PSJCOM",$J,+PSGORD,2),"^")=PSGSCH
"RTN","PSJCOM",20,0)
 I PSGSM,PSGOHSM'=PSGHSM S $P(^TMP("PSJCOM",$J,+PSGORD,0),"^",5)=PSGSM,$P(^TMP("PSJCOM",$J,+PSGORD,0),"^",6)=PSGHSM
"RTN","PSJCOM",21,0)
 W "."
"RTN","PSJCOM",22,0)
 S PSGOEEWF="^TMP(""PSJCOM"",$J,+PSGORD,"
"RTN","PSJCOM",23,0)
 F Q=1,3 K @(PSGOEEWF_Q_")") S %X="^PS(53.45,"_PSJSYSP_","_$S(Q=1:2,1:1)_",",%Y=PSGOEEWF_Q_"," K @(PSGOEEWF_Q_")") D %XY^%RCR W "."  ;MOU-0100-30945
"RTN","PSJCOM",24,0)
 S PSGND=$G(^TMP("PSJCOM",$J,+PSGORD,0)),X=$P(PSGND,U,24)
"RTN","PSJCOM",25,0)
 S PSJOWALL=+$G(^PS(55,PSGP,5.1))
"RTN","PSJCOM",26,0)
 I $S(X="R":1,+$G(^PS(55,PSGP,5.1))>PSGDT:0,1:X'="E") S X=$G(^TMP("PSJCOM",$J,+PSGORD,2)) D ENWALL^PSGNE3(+$P(X,U,2),+$P(X,U,4),PSGP)
"RTN","PSJCOM",27,0)
 S $P(^TMP("PSJCOM",$J,+PSGORD,.2),U,2)=PSGDO,$P(^TMP("PSJCOM",$J,+PSGORD,2),U,5)=PSGAT S:$G(PSGS0XT) $P(^(2),U,6)=PSGS0XT
"RTN","PSJCOM",28,0)
 S:PSGRF]"" ^TMP("PSJCOM",$J,+PSGORD,2.1)=$G(PSGDUR)_U_$G(PSGRMVT)_U_$G(PSGRMV)_U_$G(PSGRF) K PSGDUR,PSGRMVT,PSGRMV,PSGRF ;315
"RTN","PSJCOM",29,0)
 I 'PSGOEAV D NEWNVAL(PSGORD,$S(+PSJSYSU=3:22005,1:22000))
"RTN","PSJCOM",30,0)
 I $D(^PS(53.45,DUZ,5,1,0)) D FILESI^PSJBCMA5(PSGP,PSGORD) N SIARRAY S SIARRAY="" D NEWNVAL^PSGAL5(PSGORD,6000,"SPECIAL INSTRUCTIONS",,.SIARRAY)
"RTN","PSJCOM",31,0)
 I PSGOEAV,+PSJSYSU=3 D VFY Q
"RTN","PSJCOM",32,0)
 I PSGOEAV,$G(PSJRNF) D VFY
"RTN","PSJCOM",33,0)
 Q
"RTN","PSJCOM",34,0)
VFY ; change status, move to 55, and change label record
"RTN","PSJCOM",35,0)
 Q:'PSJCOM
"RTN","PSJCOM",36,0)
 S ^TMP("PSODAOC",$J,"IP IEN")=PSGORD
"RTN","PSJCOM",37,0)
 D SETOC^PSJNEWOC(PSGORD)
"RTN","PSJCOM",38,0)
 I '$D(^TMP("PSJCOM",$J,+PSGORD)) M ^TMP("PSJCOM",$J,+PSGORD)=^PS(53.1,+PSGORD)
"RTN","PSJCOM",39,0)
 NEW PSJDOSE,PSJDSFLG
"RTN","PSJCOM",40,0)
 D DOSECHK^PSJDOSE
"RTN","PSJCOM",41,0)
 I +$G(PSJDSFLG) D SETVAR^PSJDOSE W !!,PSJDOSE("WARN"),!,PSJDOSE("WARN1") I '$$CONT() W !,"...order was not verified..." D PAUSE^VALM1 D  Q:'$G(PSJACEPT)
"RTN","PSJCOM",42,0)
 . S PSGOEEF(109)=1
"RTN","PSJCOM",43,0)
 . S PSJACEPT=0
"RTN","PSJCOM",44,0)
 D DDCHK G:CHK DONE
"RTN","PSJCOM",45,0)
 W !,"...a few moments, please..."
"RTN","PSJCOM",46,0)
 I PSGORD["P" D
"RTN","PSJCOM",47,0)
 . S PSGORDP=PSGORD ;Used in ACTLOG to update activity log in ^TMP
"RTN","PSJCOM",48,0)
 . I '$D(^TMP("PSJCOM2",$J,+PSGORD)) D  Q
"RTN","PSJCOM",49,0)
 .. NEW PSGX S PSGX=$G(^TMP("PSJCOM",$J,+PSGORD,2.5)),PSGRSD=$P(PSGX,U),PSGRFD=$P(PSGX,U,3)
"RTN","PSJCOM",50,0)
 .. S $P(^TMP("PSJCOM",$J,+PSGORD,0),"^",9)="A" W "." ;D ^PSGOT
"RTN","PSJCOM",51,0)
 .  NEW PSGX S PSGX=$G(^TMP("PSJCOM2",$J,+PSGORD,2.5)),PSGRSD=$P(PSGX,U),PSGRFD=$P(PSGX,U,3)
"RTN","PSJCOM",52,0)
 .  S $P(^TMP("PSJCOM2",$J,+PSGORD,0),"^",9)="A" W "." ;D ^PSGOT
"RTN","PSJCOM",53,0)
 D NEWNVAL(+PSGORD,(PSJSYSU*10+22000)) W "."
"RTN","PSJCOM",54,0)
 S VND4=$S('$D(^TMP("PSJCOM2",$J,+PSGORD)):$G(^TMP("PSJCOM",$J,+PSGORD,4)),1:$G(^TMP("PSJCOM2",$J,+PSGORD,4)))
"RTN","PSJCOM",55,0)
 I $G(PSGRSD) D
"RTN","PSJCOM",56,0)
 . S PSGRSD=$$ENDTC^PSGMI(PSGRSD) D NEWNVAL(PSGORD,6090,"Requested Start Date",PSGRSD)
"RTN","PSJCOM",57,0)
 . S PSGRFD=$$ENDTC^PSGMI(PSGRFD) D NEWNVAL(PSGORD,6090,"Requested Stop Date",PSGRFD)
"RTN","PSJCOM",58,0)
 N DUR,DURORD S DURON=$S($G(ON)&($G(PSGORD)["U"):ON,$G(PSGORD):PSGORD,1:"") Q:'DURON  D
"RTN","PSJCOM",59,0)
 . S DUR=$S($P($G(PSGRDTX),U,2)]"":$P($G(PSGRDTX),U,2),1:$$GETDUR^PSJLIVMD(PSGP,+DURON,$S($G(DURON)["P":"P",$G(DURON)["V":"IV",1:5),1),1:"")
"RTN","PSJCOM",60,0)
 I DUR]"" S $P(^TMP("PSJCOM2",$J,+PSGORD,2.5),"^",2)=DUR
"RTN","PSJCOM",61,0)
 ;D:$D(PSGORDP) ACTLOG(PSGORDP,PSGP,PSGORD)
"RTN","PSJCOM",62,0)
 K PSGRSD,PSGRFD,PSGALFN
"RTN","PSJCOM",63,0)
 NEW X S X=0 I $G(PSGONF),(+$G(PSGODDD(1))'<+$G(PSGONF)) S X=1
"RTN","PSJCOM",64,0)
 I +PSJSYSU=3,PSGORD'["O",$S(X:0,'$P(VND4,"^",16):1,1:$P(VND4,"^",15)) ;D EN^PSGPEN(+PSGORD)
"RTN","PSJCOM",65,0)
 S:'$P(VND4,U,+PSJSYSU=3+9) $P(VND4,U,+PSJSYSU=3+9)=+$P(VND4,U,+PSJSYSU=3+9)
"RTN","PSJCOM",66,0)
 S:$P(VND4,"^",15)&'$P(VND4,"^",16) $P(VND4,"^",15)="" S:$P(VND4,"^",18)&'$P(VND4,"^",19) $P(VND4,"^",18)="" S:$P(VND4,"^",22)&'$P(VND4,"^",23) $P(VND4,"^",22)=""
"RTN","PSJCOM",67,0)
 S $P(VND4,"^",PSJSYSU,PSJSYSU+1)=DUZ_"^"_PSGDT
"RTN","PSJCOM",68,0)
 S:'$D(^TMP("PSJCOM2",$J,+PSGORD)) ^TMP("PSJCOM",$J,+PSGORD,4)=VND4 S:$D(^TMP("PSJCOM2",$J,+PSGORD)) ^TMP("PSJCOM2",$J,+PSGORD,4)=VND4
"RTN","PSJCOM",69,0)
 W:'$D(PSJSPEED) ! W !,"ORDER VERIFIED.",!
"RTN","PSJCOM",70,0)
 I '$D(PSJSPEED) K DIR S DIR(0)="E" D ^DIR K DIR
"RTN","PSJCOM",71,0)
 S VALMBCK="Q"
"RTN","PSJCOM",72,0)
 S ^TMP("PSJCOM",$J)="A" S:$D(^TMP("PSJCOM2",$J,+PSGORD)) ^TMP("PSJCOM2",$J)="A"
"RTN","PSJCOM",73,0)
 ;
"RTN","PSJCOM",74,0)
DONE ;
"RTN","PSJCOM",75,0)
 W:CHK !!,"...order NOT verified..."
"RTN","PSJCOM",76,0)
 I '$D(PSJSPEED),'CHK,+PSJSYSU=3,$G(PSJPRI)="D" D
"RTN","PSJCOM",77,0)
 .N DIR W ! S DIR(0)="S^Y:Yes;N:No",DIR("A")="Do you want to enter a Progress Note",DIR("B")="No" D ^DIR
"RTN","PSJCOM",78,0)
 .Q:Y="N"
"RTN","PSJCOM",79,0)
 .D MAIN^TIUEDIT(3,.TIUDA,PSGP,"","","","",1)
"RTN","PSJCOM",80,0)
 S VALMBCK="Q" K CHK,DA,DIE,F,DP,DR,ND,PSGAL,PSGODA,PSJDOSE,PSJVAR,VND4,X,%X,%Y,Q,QQ Q
"RTN","PSJCOM",81,0)
 ;
"RTN","PSJCOM",82,0)
DDCHK ; dispense drug check
"RTN","PSJCOM",83,0)
 S DRGF=$S('$D(^TMP("PSJCOM2",$J,+PSGORD)):"^TMP(""PSJCOM"","_$J_","_+PSGORD_",",1:"^TMP(""PSJCOM2"","_$J_","_+PSGORD_","),CHK=$S('$O(@(DRGF_"1,0)")):7,1:0)
"RTN","PSJCOM",84,0)
 S PSGPD=$G(@(DRGF_".2)"))
"RTN","PSJCOM",85,0)
 S CHK=$S('$$DDOK^PSGOE2(DRGF_"1,",PSGPD):7,1:0)
"RTN","PSJCOM",86,0)
 Q:CHK=0
"RTN","PSJCOM",87,0)
 W $C(7),!!,"This order must have at least one valid, active dispense drug to be verified."
"RTN","PSJCOM",88,0)
 ;
"RTN","PSJCOM",89,0)
CONT() ;
"RTN","PSJCOM",90,0)
 NEW DIR,DIRUT,Y
"RTN","PSJCOM",91,0)
 W ! K DIR,DIRUT
"RTN","PSJCOM",92,0)
 S DIR(0)="Y",DIR("A")="Would you like to continue verifying the order",DIR("B")="No"
"RTN","PSJCOM",93,0)
 D ^DIR
"RTN","PSJCOM",94,0)
 Q Y
"RTN","PSJCOM",95,0)
 ;
"RTN","PSJCOM",96,0)
NEWNVAL(PSGALORD,PSGALC,PSGFLD,PSGOLD)  ;
"RTN","PSJCOM",97,0)
 ;
"RTN","PSJCOM",98,0)
 ;Where  PSGALORD = PSGORD (Required)
"RTN","PSJCOM",99,0)
 ;       PSGALC   = ACTIVITY CODE FROM #53.3 (Required)
"RTN","PSJCOM",100,0)
 ;       PSGFLD   = FIELD THAT CHANGED (Free text, optional)
"RTN","PSJCOM",101,0)
 ;       PSGOLD   = THE FIELDS OLD DATA VALUE (Free text, optional)
"RTN","PSJCOM",102,0)
 ;
"RTN","PSJCOM",103,0)
 ;N PSGALORD,PSGALC,PSGFLD,PSGOLD
"RTN","PSJCOM",104,0)
 ;
"RTN","PSJCOM",105,0)
 ; Create 0 node activity log for order if none exists, and get next entry number
"RTN","PSJCOM",106,0)
 I '$D(^TMP("PSJCOM2",$J,+PSGALORD)) D  Q
"RTN","PSJCOM",107,0)
 . S QQ=$G(^TMP("PSJCOM",$J,+PSGALORD,"A",0)) S:QQ="" QQ="^53.1119D" F Q=$P(QQ,"^",3)+1:1 I '$D(^(Q)) S $P(QQ,"^",3,4)=Q_"^"_Q,^(0)=QQ,PSGAL("N")=Q Q
"RTN","PSJCOM",108,0)
 . ;Set up data to be held in activity log record
"RTN","PSJCOM",109,0)
 . D NOW^%DTC S PSGDT=+$E(%,1,12)
"RTN","PSJCOM",110,0)
 . I $L($G(PSGOLD))>170 S PSGOLD=$E(PSGOLD,1,167)_"..." ; Use of ... indicates old data field was greater than 170 characters
"RTN","PSJCOM",111,0)
 . S Q=%_"^"_$S(PSGALC=6010:"AUTO CANCEL",$D(DUZ)[0:"UNKNOWN",DUZ]"":DUZ,1:"UNKNOWN")_"^"_PSGALC_"^"_$S($D(PSGFLD):PSGFLD,1:"")_"^"_$S($D(PSGOLD):PSGOLD,1:"")
"RTN","PSJCOM",112,0)
 . ; Create activity log entry
"RTN","PSJCOM",113,0)
 . S ^TMP("PSJCOM",$J,+PSGALORD,"A",PSGAL("N"),0)=Q
"RTN","PSJCOM",114,0)
 S QQ=$G(^TMP("PSJCOM2",$J,+PSGALORD,"A",0)) S:QQ="" QQ="^53.1119D" F Q=$P(QQ,"^",3)+1:1 I '$D(^(Q)) S $P(QQ,"^",3,4)=Q_"^"_Q,^(0)=QQ,PSGAL("N")=Q Q
"RTN","PSJCOM",115,0)
 ;Set up data to be held in activity log record
"RTN","PSJCOM",116,0)
 D NOW^%DTC S PSGDT=+$E(%,1,12)
"RTN","PSJCOM",117,0)
 I $L($G(PSGOLD))>170 S PSGOLD=$E(PSGOLD,1,167)_"..." ; Use of ... indicates old data field was greater than 170 characters
"RTN","PSJCOM",118,0)
 S Q=%_"^"_$S(PSGALC=6010:"AUTO CANCEL",$D(DUZ)[0:"UNKNOWN",DUZ]"":DUZ,1:"UNKNOWN")_"^"_PSGALC_"^"_$S($D(PSGFLD):PSGFLD,1:"")_"^"_$S($D(PSGOLD):PSGOLD,1:"")
"RTN","PSJCOM",119,0)
 ; Create activity log entry
"RTN","PSJCOM",120,0)
 S ^TMP("PSJCOM2",$J,+PSGALORD,"A",PSGAL("N"),0)=Q
"RTN","PSJCOM",121,0)
 Q
"RTN","PSJCOM1")
0^47^B49883276^B48577144
"RTN","PSJCOM1",1,0)
PSJCOM1 ;BIR/CML3-DISPLAY COMPLEX ORDERS FOR DISCONTINUE ;02 Feb 2001  12:20 PM
"RTN","PSJCOM1",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**110,127,281,315**;16 DEC 97;Build 73
"RTN","PSJCOM1",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PSJCOM1",4,0)
 ; Reference to ^VALM1 is supported by DBIA 10116.
"RTN","PSJCOM1",5,0)
 ; Reference to ^PS(55 is supported by DBIA 2191.
"RTN","PSJCOM1",6,0)
 ; Reference to ^%DTC is supported by DBIA 10000.
"RTN","PSJCOM1",7,0)
 ; Reference to ^PS(51.2 is supported by DBIA 2178.
"RTN","PSJCOM1",8,0)
 ; Reference to ^DIE is supported by DBIA 10018.
"RTN","PSJCOM1",9,0)
 ; Reference to ^DIR is supported by DBIA 10026.
"RTN","PSJCOM1",10,0)
 ; Reference to ^TMP("PSODAOC",$J supported by DBIA 6071
"RTN","PSJCOM1",11,0)
 ;
"RTN","PSJCOM1",12,0)
CMPLX(PSGP,ON,PSGORD) ;
"RTN","PSJCOM1",13,0)
 D PAUSE K PSJCM
"RTN","PSJCOM1",14,0)
 N PSJLINE,PSX,PSCM
"RTN","PSJCOM1",15,0)
 S PSJLINE=1
"RTN","PSJCOM1",16,0)
 I PSGORD["P" N PSJO S PSJO=0 F  S PSJO=$O(^PS(53.1,"ACX",ON,PSJO)) Q:'PSJO  D
"RTN","PSJCOM1",17,0)
 .Q:PSJO=+PSGORD  S PSJOO=PSGORD D DSPLORDU(PSGP,PSJO_"P") S PSJCM(PSJO_"P",PSJLINE)="",PSJLINE=PSJLINE+1
"RTN","PSJCOM1",18,0)
 I PSGORD'["P" N PSJO,PSJOO S PSJOO="",PSJO=0 F  S PSJO=$O(^PS(55,"ACX",ON,PSJO)) Q:'PSJO  F  S PSJOO=$O(^PS(55,"ACX",ON,PSJO,PSJOO)) Q:PSJOO=""  D
"RTN","PSJCOM1",19,0)
 .Q:PSJOO=PSGORD  D:PSJOO["U" DSPLORDU(PSGP,PSJOO) D:PSJOO["V" DSPLORDV(PSGP,PSJOO) S PSJCM(PSJOO,PSJLINE)="",PSJLINE=PSJLINE+1
"RTN","PSJCOM1",20,0)
 N ON S ON="" F  S ON=$O(PSJCM(ON)) Q:ON=""  D
"RTN","PSJCOM1",21,0)
 .W ! F PSX=0:0 S PSX=$O(PSJCM(ON,PSX)) Q:'PSX  D
"RTN","PSJCOM1",22,0)
 ..W !,PSJCM(ON,PSX) D:'(PSX#6) PAUSE
"RTN","PSJCOM1",23,0)
 W !
"RTN","PSJCOM1",24,0)
 Q
"RTN","PSJCOM1",25,0)
 ;
"RTN","PSJCOM1",26,0)
CMPLX2(PSGP,ON,PSGORD) ;
"RTN","PSJCOM1",27,0)
 Q:$G(PSGORD)'["U"
"RTN","PSJCOM1",28,0)
 N PSJLINE S PSJLINE=0
"RTN","PSJCOM1",29,0)
 D FULL^VALM1
"RTN","PSJCOM1",30,0)
 D DSPLORDU(PSGP,PSGORD)
"RTN","PSJCOM1",31,0)
 W ! S PSJLINE="" F  S PSJLINE=$O(PSJCM(PSGORD,PSJLINE)) Q:PSJLINE=""  W !,PSJCM(PSGORD,PSJLINE) D:'((PSJLINE+1)#6) PAUSE
"RTN","PSJCOM1",32,0)
 D EN^PSGPEN(PSGORD)
"RTN","PSJCOM1",33,0)
 S ^TMP("PSODAOC",$J,"IP IEN")=PSJO_"P",^TMP("PSODAOC",$J,"IP NEW IEN")=PSGORD
"RTN","PSJCOM1",34,0)
 D SETOC^PSJNEWOC(PSGORD)
"RTN","PSJCOM1",35,0)
 W !
"RTN","PSJCOM1",36,0)
 Q
"RTN","PSJCOM1",37,0)
 ;
"RTN","PSJCOM1",38,0)
UPDATE ; Refresh array, actions, & display.
"RTN","PSJCOM1",39,0)
 D GETUD^PSJLMGUD(DFN,ON),INIT^PSJLMUDE(DFN,ON) S VALMBCK="R"
"RTN","PSJCOM1",40,0)
 Q
"RTN","PSJCOM1",41,0)
HOLDHDR ; Freeze header text while processing order actions
"RTN","PSJCOM1",42,0)
 I $D(VALM("TM")) S IOTM=VALM("TM"),IOBM=IOSL W IOSC W @IOSTBM W IORC
"RTN","PSJCOM1",43,0)
 Q
"RTN","PSJCOM1",44,0)
 ;
"RTN","PSJCOM1",45,0)
DSPLORDU(PSGP,ON)   ; Display UD order for order check as in the Inpat Profile.
"RTN","PSJCOM1",46,0)
 NEW DRUGNAME,F,NODE0,NODE2,PSJID,PSJX,SCH,SD,STAT,X,Y K PSJCM
"RTN","PSJCOM1",47,0)
 S F=$S(ON["U":"^PS(55,PSGP,5,"_+ON_",",1:"^PS(53.1,"_+ON_",")
"RTN","PSJCOM1",48,0)
 S NODE0=$G(@(F_"0)")),NODE2=$G(@(F_"2)"))
"RTN","PSJCOM1",49,0)
 D DRGDISP^PSJLMUT1(PSGP,ON,39,54,.DRUGNAME,0)
"RTN","PSJCOM1",50,0)
 I ON["P",$P(NODE0,U,4)="F" D DSPLORDV(PSGP,ON) Q
"RTN","PSJCOM1",51,0)
 S SCH=$P(NODE0,U,7)
"RTN","PSJCOM1",52,0)
 S STAT=$P(NODE0,U,9)
"RTN","PSJCOM1",53,0)
 D NOW^%DTC I "A"[STAT I $P(NODE2,U,4)<% D EXPIRE S STAT="E"
"RTN","PSJCOM1",54,0)
 I STAT="A",$P(NODE0,U,27)="R" S STAT="R"
"RTN","PSJCOM1",55,0)
 I STAT'="P" S PSJID=$E($$ENDTC^PSGMI($P(NODE2,U,2)),1,5),SD=$E($$ENDTC^PSGMI($P(NODE2,U,4)),1,5)
"RTN","PSJCOM1",56,0)
 I STAT="P" S (PSJID,SD)="*****",SCH="?"
"RTN","PSJCOM1",57,0)
 F PSJX=0:0 S PSJX=$O(DRUGNAME(PSJX)) Q:'PSJX  D
"RTN","PSJCOM1",58,0)
 . S:PSJX=1 X=SCH_"  "_PSJID_"  "_SD_"  "_$E(STAT,1)
"RTN","PSJCOM1",59,0)
 . S:PSJX=1 DRUGNAME(1)=$$SETSTR^VALM1(X,$E(DRUGNAME(1),1,40),42,20)
"RTN","PSJCOM1",60,0)
 . S PSJCM(ON,PSJLINE)="        "_DRUGNAME(PSJX)
"RTN","PSJCOM1",61,0)
 . S PSJLINE=PSJLINE+1
"RTN","PSJCOM1",62,0)
 Q
"RTN","PSJCOM1",63,0)
DSPLORDV(DFN,ON)   ; Display IV order for order check as in the Inpat Profile.
"RTN","PSJCOM1",64,0)
 N DRG,DRGI,DRGT,DRGX,FIL,ND,ON55,P,PSJIVFLG,PSJORIFN,TYP,X,Y
"RTN","PSJCOM1",65,0)
 S TYP="?" I ON["V" D
"RTN","PSJCOM1",66,0)
 .S Y=$G(^PS(55,DFN,"IV",+ON,0)) F X=2,3,4,5,8,9,17,23 S P(X)=$P(Y,U,X)
"RTN","PSJCOM1",67,0)
 .D NOW^%DTC I "A"[P(17) I P(3)<% D EXPIRE S P(17)="E"
"RTN","PSJCOM1",68,0)
 .S TYP=$$ONE^PSJBCMA(DFN,ON,P(9),P(2),P(3)) I TYP'="O" S TYP="C"
"RTN","PSJCOM1",69,0)
 .S ON55=ON,P("OT")=$S(P(4)="A":"F",P(4)="H":"H",1:"I") D GTDRG^PSIVORFB,GTOT^PSIVUTL(P(4))
"RTN","PSJCOM1",70,0)
 S PSJCT=0,PSJL=""
"RTN","PSJCOM1",71,0)
 I ON'["V" S (P(2),P(3))="",P(17)=$P($G(^PS(53.1,+ON,0)),U,9),Y=$G(^(8)),P(4)=$P(Y,U),P(8)=$P(Y,U,5),P(9)=$P($G(^(2)),U) D GTDRG^PSIVORFA,GTOT^PSIVUTL(P(4))
"RTN","PSJCOM1",72,0)
 S PSJIVFLG=1 D PIVAD,SOL
"RTN","PSJCOM1",73,0)
 Q
"RTN","PSJCOM1",74,0)
SOL ;
"RTN","PSJCOM1",75,0)
 S PSJL=$S($G(PSJIVFLG):PSJL,1:"")_"        in"
"RTN","PSJCOM1",76,0)
 S DRG=0 F  S DRG=+$O(DRG("SOL",DRG)) Q:'DRG  D NAME^PSIVUTL(DRG("SOL",DRG),39,.NAME,0) S DRGX=0 F  S DRGX=$O(NAME(DRGX)) Q:'DRGX  S PSJL=$$SETSTR^VALM1(NAME(DRGX),PSJL,12,60) D:$G(PSJIVFLG) PIV1 D SETTMP S PSJL="      "
"RTN","PSJCOM1",77,0)
 Q
"RTN","PSJCOM1",78,0)
PIVAD ; Print IV Additives.
"RTN","PSJCOM1",79,0)
 F DRG=0:0 S DRG=$O(DRG("AD",DRG)) Q:'DRG  D NAME^PSIVUTL(DRG("AD",DRG),39,.NAME,1) F DRGX=0:0 S DRGX=$O(NAME(DRGX)) Q:'DRGX  S PSJL=$$SETSTR^VALM1(NAME(DRGX),PSJL,9,60) D:$G(PSJIVFLG) PIV1 D SETTMP
"RTN","PSJCOM1",80,0)
 Q
"RTN","PSJCOM1",81,0)
 ;
"RTN","PSJCOM1",82,0)
PIV1 ; Print Sched type, start/stop dates, and status.
"RTN","PSJCOM1",83,0)
 K PSJIVFLG
"RTN","PSJCOM1",84,0)
 F X=2,3 S P(X)=$E($$ENDTC^PSGMI(P(X)),1,$S($D(PSJEXTP):8,1:5))
"RTN","PSJCOM1",85,0)
 I '$D(PSJEXTP) S PSJL=$$SETSTR^VALM1(TYP,PSJL,50,1),PSJL=$$SETSTR^VALM1(P(2),PSJL,53,7),PSJL=$$SETSTR^VALM1(P(3),PSJL,60,7),PSJL=$$SETSTR^VALM1(P(17),PSJL,67,1)
"RTN","PSJCOM1",86,0)
 E  S PSJL=$$SETSTR^VALM1(TYP,PSJL,50,1),PSJL=$$SETSTR^VALM1(P(2),53,7),PSJL=$$SETSTR^VALM1(P(3),PSJL,63,7),PSJL=$$SETSTR^VALM1(P(17),PSJL,73,1)
"RTN","PSJCOM1",87,0)
 Q
"RTN","PSJCOM1",88,0)
SETTMP ;
"RTN","PSJCOM1",89,0)
 S PSJCM(ON,PSJLINE)=PSJL,PSJLINE=PSJLINE+1
"RTN","PSJCOM1",90,0)
 Q
"RTN","PSJCOM1",91,0)
PAUSE ;
"RTN","PSJCOM1",92,0)
 K DIR W ! S DIR(0)="EA",DIR("A")="Press Return to continue..." D ^DIR W !
"RTN","PSJCOM1",93,0)
 Q
"RTN","PSJCOM1",94,0)
NEW ;
"RTN","PSJCOM1",95,0)
 Q:'PSJCOM
"RTN","PSJCOM1",96,0)
 Q:PSGORD'["P"
"RTN","PSJCOM1",97,0)
 M ^TMP("PSJCOM",$J,+PSGORD)=^PS(53.1,+PSGORD)
"RTN","PSJCOM1",98,0)
 S PSGS0Y=PSGAT,PSGNESD=PSGSD,PSGNEFD=PSGFD,PSGOEPR=PSGPR,PSGPDRG=PSGPD,PSGPDRGN=PSGPDN,PSGOEE="E"
"RTN","PSJCOM1",99,0)
 S $P(^TMP("PSJCOM",$J,+PSGORD,0),"^",27)="E",$P(^(0),"^",9)="DE"
"RTN","PSJCOM1",100,0)
 W:'$D(PSGOEE)&'$D(PSGOES) !!,"...transcribing this ",$S($D(PSGOES):"",'PSGOEAV:"non-verified ",1:"active "),"order..." S PSGOETOF=1 S:PSGSM="" PSGSM=0
"RTN","PSJCOM1",101,0)
 ;I PSGPR'=PSGOEPR D:'$D(^PS(55,PSGP,0)) ENSET0^PSGNE3(PSGP) S $P(^PS(55,PSGP,5.1),U,2)=PSGPR,PSGOEPR=PSGPR
"RTN","PSJCOM1",102,0)
 K ND4,DA D NOW^%DTC S PSGDT=+$E(%,1,12),DA=+PSGORD
"RTN","PSJCOM1",103,0)
 S PSJOWALL=+$G(^PS(55,PSGP,5.1))
"RTN","PSJCOM1",104,0)
 I $D(^PS(51.2,+PSGMR,0)),$P(^(0),U,3)]"" S PSGMRN=$P(^(0),U,3)
"RTN","PSJCOM1",105,0)
 I PSGS0XT="D",'PSGS0Y S PSGS0Y=$E(PSGNESD_"00011",9,12)
"RTN","PSJCOM1",106,0)
 S ND=DA_U_PSGPR_U_PSGMR_"^U^"_PSGSM_U_PSGHSM_U_PSGST_"^^"_$S(PSGOEAV:"A",1:"N")_"^^^^^"_PSGDT_U_PSGP_U_PSGDT S:PSGNEDFD $P(ND,U,$P(PSGNEDFD,U)["L"+10)=+PSGNEDFD
"RTN","PSJCOM1",107,0)
 S:$D(PSGOEE) $P(ND,U,24,25)=PSGOEE_U_PSGORD S:'PSGOEAV $P(ND,U,18)=DA S ND2=PSGSCH_U_$S(+PSGNESD=PSGNESD:+PSGNESD,1:"")_"^^"_+PSGNEFD_U_PSGS0Y_U_PSGS0XT_"^^^^"_+PSJPWD
"RTN","PSJCOM1",108,0)
 S:$G(PSGRF)]"" ND2P1=$G(PSGDUR)_U_$G(PSGRMVT)_U_$G(PSGRMV)_U_$G(PSGRF) ;*315
"RTN","PSJCOM1",109,0)
 S $P(ND4,U,7)=DUZ I PSGOEAV,PSJSYSU D
"RTN","PSJCOM1",110,0)
 .S $P(ND4,U,PSJSYSU,PSJSYSU+1)=DUZ_U_PSGDT,$P(ND4,U,+PSJSYSU=1+9)=1,$P(ND4,U,+PSJSYSU=3+9)=0
"RTN","PSJCOM1",111,0)
 .S $P(ND4,U,9,10)=+$P(ND4,U,9)_U_+$P(ND4,U,10)
"RTN","PSJCOM1",112,0)
 S F="^TMP(""PSJCOM2"","_$J_","_DA_",",@(F_"0)")=ND
"RTN","PSJCOM1",113,0)
 ; Naked references below refers to full reference in F which is ^TMP("PSJCOM2",$J,DA,
"RTN","PSJCOM1",114,0)
 S @(F_".2)")=PSGPDRG_U_PSGDO_U_PSJNOO S:$G(PSJDOSE("DO"))]"" $P(^(.2),U,5,6)=$P(PSJDOSE("DO"),U,1,2) S:PSJCOM]"" $P(^(.2),"^",8)=PSJCOM
"RTN","PSJCOM1",115,0)
 I '$D(PSJDOSE("DO")),$D(PSGORD) S $P(@(F_".2)"),U,5,6)=$P(@("^PS("_$S(PSGORD["U":"55,"_PSGP_",5",1:53.1)_","_+PSGORD_",.2)"),U,5,6)
"RTN","PSJCOM1",116,0)
 ; Naked references below refers to full reference in F which is ^TMP("PSJCOM2",$J,DA,
"RTN","PSJCOM1",117,0)
 S @(F_"2)")=$P(ND2,"^",1,6),^(4)=ND4 S:PSGSI]"" ^(6)=PSGSI
"RTN","PSJCOM1",118,0)
 S @(F_"2.1)")=ND2P1 ;*315
"RTN","PSJCOM1",119,0)
 ; Naked references below refers to full reference in F which is ^TMP("PSJCOM2",$J,DA,
"RTN","PSJCOM1",120,0)
 S (C,X)=0 F  S X=$O(^PS(53.45,PSJSYSP,2,X)) Q:'X  S D=$G(^(X,0)) I D,$S('$P(D,U,3):1,1:$P(D,U,3)>DT) S C=C+1,@(F_"1,"_C_",0)")=$P(D,U,1,2),@(F_"1,""B"","_+D_","_C_")")=""
"RTN","PSJCOM1",121,0)
 S:C @(F_"1,0)")=U_$S(PSGOEAV:55.07,1:53.11)_"P^"_C_U_C
"RTN","PSJCOM1",122,0)
 ; Naked references below refers to full reference in F which is ^TMP("PSJCOM2",$J,DA,
"RTN","PSJCOM1",123,0)
 S (C,Q)=0 F  S Q=$O(^PS(53.45,PSJSYSP,1,Q)) Q:'Q  S X=$G(^(Q,0)) S:X]"" C=C+1,@(F_"3,"_C_",0)")=X
"RTN","PSJCOM1",124,0)
 S:C @(F_"3,0)")=U_$S(PSGOEAV:55.08,1:53.12)_U_C_U_C
"RTN","PSJCOM1",125,0)
 S:C @(F_"12,0)")=U_$S(PSGOEAV:55.0612,1:53.1012)_U_C_U_C
"RTN","PSJCOM1",126,0)
 W "."
"RTN","PSJCOM1",127,0)
OUT ;
"RTN","PSJCOM1",128,0)
 K PSGOETOF
"RTN","PSJCOM1",129,0)
DONE ;
"RTN","PSJCOM1",130,0)
 K C,D,ND,ND2,ND2P1,ND4,PSGDO,PSGDRG,PSGDRGN,PSGFOK,PSGHSM,PSGMR,PSGMRN,PSGNEDFD,PSGNEFD,PSGNESD,PSGPDRG,PSGPDRGN,PSGSI,PSGSTN,PSJDOSE,%,Q
"RTN","PSJCOM1",131,0)
 Q
"RTN","PSJCOM1",132,0)
EXPIRE ;Change status of order to expired and send notice to OE/RR
"RTN","PSJCOM1",133,0)
 N DA,DIE,DR,PSGPO,PSIVACT
"RTN","PSJCOM1",134,0)
 Q:'$G(PSJOO)!($G(PSJOO)["P")
"RTN","PSJCOM1",135,0)
 S STATUS="E",(PSGPO,PSIVACT)=1,DA=+PSJOO,DA(1)=PSGP,DIE=$S(PSJOO["V":"^PS(55,"_PSGP_",""IV"",",1:"^PS(55,"_PSGP_",5,"),DR=$S(PSJOO["V":"100////E",1:"28////E") D ^DIE
"RTN","PSJCOM1",136,0)
 D EN1^PSJHL2(PSGP,"SC",PSJOO)
"RTN","PSJCOM1",137,0)
 Q
"RTN","PSJHL3")
0^52^B118359131^B97470088
"RTN","PSJHL3",1,0)
PSJHL3 ;BIR/RLW - PHARMACY ORDER SEGMENTS ; 8/19/14 2:08pm
"RTN","PSJHL3",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**1,11,14,40,42,47,50,56,58,92,101,102,123,110,111,152,134,226,267,260,281,315**;16 DEC 97;Build 73
"RTN","PSJHL3",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PSJHL3",4,0)
 ;
"RTN","PSJHL3",5,0)
 ; Reference to ^PS(50.606 is supported by DBIA# 2174.
"RTN","PSJHL3",6,0)
 ; Reference to ^PS(50.607 is supported by DBIA# 2221.        
"RTN","PSJHL3",7,0)
 ; Reference to ^PS(50.7 is supported by DBIA# 2180.
"RTN","PSJHL3",8,0)
 ; Reference to ^PS(51.2 is supported by DBIA# 2178.
"RTN","PSJHL3",9,0)
 ; Reference to ^PS(52.6 is supported by DBIA# 1231.
"RTN","PSJHL3",10,0)
 ; Reference to ^PS(52.7 is supported by DBIA# 2173.
"RTN","PSJHL3",11,0)
 ; Reference to ^PS(55 is supported by DBIA# 2191.
"RTN","PSJHL3",12,0)
 ; Reference to ^PSDRUG( is supported by DBIA# 2192.
"RTN","PSJHL3",13,0)
 ; Reference to ^PSNDF( is supported by DBIA# 2195.
"RTN","PSJHL3",14,0)
 ; Reference to ^VA(200 is supported by DBIA# 10060.
"RTN","PSJHL3",15,0)
 ; Reference to ^PSNAPIS is supported by DBIA# 2531.
"RTN","PSJHL3",16,0)
 ; Reference to ^XLFDT is supported by DBIA# 10103.
"RTN","PSJHL3",17,0)
 ; Reference to ^PSSUTIL1 is supported by DBIA# 3179.
"RTN","PSJHL3",18,0)
 ; Reference to ^ORHLESC is supported by DBIA# 4922.
"RTN","PSJHL3",19,0)
 ;
"RTN","PSJHL3",20,0)
 ;*267 Change NTE|21 so it can send over the Long Wp Special Inst/
"RTN","PSJHL3",21,0)
 ;     Other Prt Info fields if populated.
"RTN","PSJHL3",22,0)
 ;*315 For PSJBCBU send Remove string & DOA in RXE.1.2.(3-4)
"RTN","PSJHL3",23,0)
 ;
"RTN","PSJHL3",24,0)
EN1(PSJHLDFN,PSOC,PSJORDER) ; start here
"RTN","PSJHL3",25,0)
 ; passed in are PSJHLDFN (patient ien)
"RTN","PSJHL3",26,0)
 ;               PSJORDER (file root of order)
"RTN","PSJHL3",27,0)
 ;               OC (order control code - NW for new order, OK for finished order, OC for order canceled)
"RTN","PSJHL3",28,0)
 I $G(PSJHLDFN)']""!$G(PSOC)']""!$G(PSJORDER)']"" W !,"INSUFFICIENT DATA FOR ^PSJHL3" Q
"RTN","PSJHL3",29,0)
 N COMMENTS,DDIEA,DDNUM,DOSE,DOSEFORM,DOSEOR,NAME,DURATION,IVTYPE,NODE1,NODE2,NDNODE,OINODE,PSGPLS,PSGPLF,PRODNAME,SPDIEN,UNIT,UNITS,CNT,DDIEN,SCHEDULE,PSGST
"RTN","PSJHL3",30,0)
 D INIT
"RTN","PSJHL3",31,0)
 S IVTYPE=$S(RXORDER["U":"",1:$$IVTYPE^PSJHLU(PSJORDER))
"RTN","PSJHL3",32,0)
 D RXO,RXE,RXR D ZRX
"RTN","PSJHL3",33,0)
 D CALL^PSJHLU(PSJI)
"RTN","PSJHL3",34,0)
 ;PSJ*5*260 ADDED ALLERGY SETS HERE AND PSJ*5*281 MOVED ALLERGY SETS TO SETOC^PSJNEWOC
"RTN","PSJHL3",35,0)
 Q
"RTN","PSJHL3",36,0)
INIT ; initialize HL7 variables
"RTN","PSJHL3",37,0)
 D INIT^PSJHLU
"RTN","PSJHL3",38,0)
 Q
"RTN","PSJHL3",39,0)
RXO ; pharmacy prescription order segment (used to send Orderable Item to OE/RR)
"RTN","PSJHL3",40,0)
 S LIMIT=17 X PSJCLEAR
"RTN","PSJHL3",41,0)
 S FIELD(0)="RXO"
"RTN","PSJHL3",42,0)
 S OINODE=$G(@(PSJORDER_".2)"))
"RTN","PSJHL3",43,0)
 S SPDIEN=+$P(OINODE,"^"),DOSEOR=$$UP^XLFSTR($$ESC^ORHLESC($P(OINODE,"^",2))),DOSE=$P(OINODE,"^",5),UNIT=$P(OINODE,"^",6) S:'$G(PSJBCBU) UNIT=$$ESC^ORHLESC(UNIT)
"RTN","PSJHL3",44,0)
 S FIELD(1)=$S(SPDIEN=0:"^^^^",1:"^^^"_SPDIEN_"^")
"RTN","PSJHL3",45,0)
 I SPDIEN S DOSEFORM=$P($G(^PS(50.7,SPDIEN,0)),"^",2),NAME=$P($G(^PS(50.606,+DOSEFORM,0)),"^") S:'$G(PSJBCBU) NAME=$$ESC^ORHLESC(NAME) S FIELD(1)=FIELD(1)_$$ESC^ORHLESC($P($G(^PS(50.7,SPDIEN,0)),"^"))_" "_NAME
"RTN","PSJHL3",46,0)
 S FIELD(1)=FIELD(1)_"^99PSP"
"RTN","PSJHL3",47,0)
 N IVLNOD S IVLNOD=$G(@(PSJORDER_"2.5)")) D
"RTN","PSJHL3",48,0)
 .S IVLIM=$P(IVLNOD,"^",4) I IVLIM?1"a".N S IVLIM="doses"_$P(IVLIM,"a",2)
"RTN","PSJHL3",49,0)
 .S $P(FIELD(1),"^",3)=IVLIM
"RTN","PSJHL3",50,0)
 D SEGMENT^PSJHLU(LIMIT),DISPLAY^PSJHL2
"RTN","PSJHL3",51,0)
 Q
"RTN","PSJHL3",52,0)
RXE ; pharmacy encoded order segment
"RTN","PSJHL3",53,0)
 N PSJF1P1,NODE2P2
"RTN","PSJHL3",54,0)
 S (UNITS,NDNODE,SPDIEN,PRODNAME,DDNUM,DDIEN,CNT)="",LIMIT=26 X PSJCLEAR
"RTN","PSJHL3",55,0)
 S FIELD(0)="RXE"
"RTN","PSJHL3",56,0)
 S NODE1=$G(@(PSJORDER_"0)")),NODE2=$G(@(PSJORDER_"2)")),NODEPT2=$G(@(PSJORDER_".2)"))
"RTN","PSJHL3",57,0)
 S NODE2P2=$G(@(PSJORDER_"2.1)"))    ;*315
"RTN","PSJHL3",58,0)
 I $G(PSGST)="" N PSGST D
"RTN","PSJHL3",59,0)
 .I $G(RXORDER)["V" N X,ZZND,LYN,PSGS0XT,PSGS0Y,PSGOES S PSGOES=1 S X=$G(P(9)) I X]"" D EN^PSGS0 S:$G(ZZND)'="" PSGST=$P(ZZND,"^",5) Q
"RTN","PSJHL3",60,0)
 .S PSGST=$P($G(NODE1),"^",7)
"RTN","PSJHL3",61,0)
 I RXORDER["V" D IVRXE Q
"RTN","PSJHL3",62,0)
 I RXORDER["P",IVTYPE="F" D IVRXE Q
"RTN","PSJHL3",63,0)
 I RXORDER["P",$P(NODE1,"^",4)="H" D IVRXE Q
"RTN","PSJHL3",64,0)
 N RENEW S RENEW=$$LASTREN^PSJLMPRI(PSJHLDFN,RXORDER)
"RTN","PSJHL3",65,0)
 S PSGPLS=$S($G(PSJEXPOE):$P(NODE2,"^",2),RENEW>$P(NODE2,"^",2):RENEW,1:$P(NODE2,"^",2))
"RTN","PSJHL3",66,0)
 S PSGPLF=$S($G(PSJEXPOE):PSJEXPOE,1:$P(NODE2,"^",4))
"RTN","PSJHL3",67,0)
 ;
"RTN","PSJHL3",68,0)
 ;BCBU only, send Remove info for MRR meds via RXE.1.2            *315
"RTN","PSJHL3",69,0)
 N QQ,QADM,QDT,NUMADM,RMSTR,FREQ,RMTM,DOA,MRR,JORD
"RTN","PSJHL3",70,0)
 D:$G(PSJBCBU)
"RTN","PSJHL3",71,0)
 .S MRR=$P(NODE2P2,U,4)
"RTN","PSJHL3",72,0)
 .Q:'MRR                             ;not a MRR med
"RTN","PSJHL3",73,0)
 .S QADM=$P(NODE2,"^",5),NUMADM=$L(QADM,"-")
"RTN","PSJHL3",74,0)
 .S DOA=$P(NODE2P2,U,1),RMTM=$P(NODE2P2,U,2)
"RTN","PSJHL3",75,0)
 .S FREQ=$P(NODE2,U,6)
"RTN","PSJHL3",76,0)
 .S DOA=$S(DOA<1:+FREQ,1:DOA)
"RTN","PSJHL3",77,0)
 .;  Special One Time Schedule, Ord stop is RMTM
"RTN","PSJHL3",78,0)
 .I FREQ="O" D
"RTN","PSJHL3",79,0)
 ..S PREVSTOP="",JORD=$S($G(ON)["U":+ON,$G(PSGORD)["U":+PSGORD,1:"")
"RTN","PSJHL3",80,0)
 ..S:JORD PREVSTOP=$P(^PS(55,DFN,5,JORD,2),U,3)
"RTN","PSJHL3",81,0)
 ..S RMTM=$S(PREVSTOP:$E($P(PREVSTOP,".",2)_"0000",1,4),1:$E($P(PSGPLF,".",2)_"0000",1,4))
"RTN","PSJHL3",82,0)
 .;  All other schedules, calculate RMTM from freq and doa
"RTN","PSJHL3",83,0)
 .I FREQ'="O",FREQ>0,'RMTM,DOA>0,QADM D
"RTN","PSJHL3",84,0)
 ..F QQ=1:1:NUMADM D                 ;calc RM for all admin times
"RTN","PSJHL3",85,0)
 ...S QDT=DT_"."_$P(QADM,"-",QQ)
"RTN","PSJHL3",86,0)
 ...S QDT=$$FMADD^XLFDT(QDT,,,DOA)
"RTN","PSJHL3",87,0)
 ...S $P(RMTM,"-",QQ)=$E($P(QDT,".",2)_"0000",1,4)
"RTN","PSJHL3",88,0)
 .S:RMTM RMSTR="&"_RMTM_"&"_DOA      ;RM time string for RXE seg
"RTN","PSJHL3",89,0)
 ;end BCBU only
"RTN","PSJHL3",90,0)
 ;
"RTN","PSJHL3",91,0)
 S FIELD(1)="^"_$S($G(PSJBCBU):$P(NODE2,"^"),1:$$ESC^ORHLESC($P(NODE2,"^")))_"&"_$P(NODE2,"^",5)_$S($G(PSJBCBU):$G(RMSTR),1:"")_"^^"_$$FMTHL7^XLFDT(PSGPLS)_"^"_$$FMTHL7^XLFDT(PSGPLF)_"^"_$P($G(NODEPT2),"^",4)_"^"_$G(PSGST)  ;*315
"RTN","PSJHL3",92,0)
 S FIELD(21)="^"_$P(NODE2,"^",5)_"^99PSA^^^"
"RTN","PSJHL3",93,0)
 I ($G(DOSEOR)']"")!($O(@(PSJORDER_"1,"" "")"),-1)=1) D
"RTN","PSJHL3",94,0)
 .S (CNT,DDNUM)=0 F  S DDNUM=$O(@(PSJORDER_"1,"_DDNUM_")")) Q:'DDNUM  Q:CNT=1  S DDIEN=+$G(@(PSJORDER_"1,"_DDNUM_",0)")) D
"RTN","PSJHL3",95,0)
 ..S PSJF1P1=$S($P(@(PSJORDER_"1,"_DDNUM_",0)"),"^",2)="":"1",1:$P(@(PSJORDER_"1,"_DDNUM_",0)"),"^",2))
"RTN","PSJHL3",96,0)
 ..S:DOSE]"" FIELD(1)=DOSE_"&"_UNIT_"&"_PSJF1P1_"&"_FIELD(1)
"RTN","PSJHL3",97,0)
 ..S:DOSE="" FIELD(1)=$$FINDDOSE(DDIEN,PSJF1P1,DOSEOR)_FIELD(1)
"RTN","PSJHL3",98,0)
 ..S $P(FIELD(1),"^",8)=$S($G(DOSEOR)]"":$G(DOSEOR),1:"DOSAGE NOT FOUND")
"RTN","PSJHL3",99,0)
 ..S:$P(FIELD(1),"^",8)="" $P(FIELD(1),"^",8)=$$ESC^ORHLESC($G(@(PSJORDER_".3)")))
"RTN","PSJHL3",100,0)
 ..S NDNODE=$G(^PSDRUG(DDIEN,"ND"))
"RTN","PSJHL3",101,0)
 ..;  CHANGE FOR NEW NDF CALL
"RTN","PSJHL3",102,0)
 ..S PRODNAME=$S($T(^PSNAPIS)]"":$$PROD0^PSNAPIS(+NDNODE,$P(NDNODE,"^",3)),$G(^PSNDF(+NDNODE,5,+$P(NDNODE,"^",3),0))]"":^(0),1:"N/A")
"RTN","PSJHL3",103,0)
 ..S:PRODNAME="" PRODNAME="N/A"
"RTN","PSJHL3",104,0)
 ..S FIELD(2)=$S(PRODNAME="N/A":"^^",1:+NDNODE_"."_+$P(NDNODE,"^",3)_"^"_$P(NDNODE,"^",2)_"^"_"99NDF")_"^"_DDIEN_"^"_$S($G(PSJBCBU):$P($G(^PSDRUG(DDIEN,0)),"^"),1:$$ESC^ORHLESC($P($G(^PSDRUG(DDIEN,0)),"^")))_"^"_"99PSD"
"RTN","PSJHL3",105,0)
 ..S UNITS=$S(PRODNAME="N/A":"N/A",1:$S($T(^PSNAPIS)]"":$P($$DFSU^PSNAPIS(+NDNODE,$P(NDNODE,"^",3)),"^",5),1:$P($G(^PSNDF(+NDNODE,2,+$P(PRODNAME,"^",2),3,+$P(PRODNAME,"^",3),4,+$P(PRODNAME,"^",4),0)),"^")))
"RTN","PSJHL3",106,0)
 ..S FIELD(5)="^^^"_$$ESC^ORHLESC(UNITS)_"^"_$$ESC^ORHLESC($P($G(^PS(50.607,UNITS,0)),"^"))_"^99PSU"
"RTN","PSJHL3",107,0)
 ..S FIELD(6)="^^^"_$$ESC^ORHLESC($G(DOSEFORM))_"^"_$$ESC^ORHLESC($P($G(^PS(50.606,+$G(DOSEFORM),0)),"^"))_"^99PSF"
"RTN","PSJHL3",108,0)
 ..S FIELD(25)=$$EN^PSSUTIL1(DDIEN),FIELD(26)=$P(FIELD(25),"|",2),FIELD(25)=$P(FIELD(25),"|")
"RTN","PSJHL3",109,0)
 ..I $P(FIELD(25),"^",5)]"" S $P(FIELD(25),"^",5)=$$ESC^ORHLESC($P(FIELD(25),"^",5))
"RTN","PSJHL3",110,0)
 ..S CNT=CNT+1
"RTN","PSJHL3",111,0)
 E  S $P(FIELD(1),"^",8)=$$ESC^ORHLESC(DOSEOR)
"RTN","PSJHL3",112,0)
 S NAME=$P($G(^VA(200,DUZ,0)),"^") S:'$G(PSJBCBU) NAME=$$ESC^ORHLESC(NAME) S FIELD(14)=DUZ_"^"_NAME_"^"_"99NP"
"RTN","PSJHL3",113,0)
 D SEGMENT^PSJHLU(LIMIT),DISPLAY^PSJHL2
"RTN","PSJHL3",114,0)
 D SEGMENT2^PSJHLU
"RTN","PSJHL3",115,0)
 Q
"RTN","PSJHL3",116,0)
IVRXE ; RXE segment for IV orders
"RTN","PSJHL3",117,0)
 ; If an Inpatient Med IV order, send RXE w/dispense drug info.  
"RTN","PSJHL3",118,0)
 ; If an IV FLUID order, send start/stop date and duration in the RXE
"RTN","PSJHL3",119,0)
 ; and send an RXC for each additive and solution.
"RTN","PSJHL3",120,0)
 N ADSNODE,PSJRENEW S PSJRENEW=$$LASTREN^PSJLMPRI(PSJHLDFN,RXORDER)
"RTN","PSJHL3",121,0)
 I RXORDER["V" S PSGPLS=$S($G(PSJEXPOE):$P(NODE1,"^",2),PSJRENEW>$P(NODE1,"^",2):PSJRENEW,1:$P(NODE1,"^",2)),PSGPLF=$S($G(PSJEXPOE):PSJEXPOE,1:$P(NODE1,"^",3))
"RTN","PSJHL3",122,0)
 E  S PSGPLS=$P(NODE2,"^",2),PSGPLF=$P(NODE2,"^",4)
"RTN","PSJHL3",123,0)
 S FIELD(1)="^"_$S(PSJORDER["IV":($P(NODE1,"^",9)_"&"_$P(NODE1,"^",11)),1:$P(NODE2,"^"))_"^^"_$$FMTHL7^XLFDT(PSGPLS)_"^"_$$FMTHL7^XLFDT(PSGPLF)_"^"_$G(P("PRY"))
"RTN","PSJHL3",124,0)
 S FIELD(21)="^"_$S(PSJORDER["IV":$P(NODE1,"^",11),1:$P(NODE2,"^",5))_"^99PSA^^^"
"RTN","PSJHL3",125,0)
 S NAME=$P($G(^VA(200,DUZ,0)),"^") S:'$G(PSJBCBU) NAME=$$ESC^ORHLESC(NAME)
"RTN","PSJHL3",126,0)
 S FIELD(14)=DUZ_"^"_NAME_"^"_"99NP"
"RTN","PSJHL3",127,0)
 N X,Y
"RTN","PSJHL3",128,0)
 I RXORDER["V" S INFUSE=$P(NODE1,"^",8)
"RTN","PSJHL3",129,0)
 E  S INFUSE=$P($G(@(PSJORDER_"8)")),"^",5)
"RTN","PSJHL3",130,0)
 I INFUSE?1N.N1" ml/hr" S FIELD(23)=+INFUSE,Y=$P(INFUSE,+INFUSE,2),Y=$$TRIM^XLFSTR(Y,"LR"," "),FIELD(24)="^^^^"_Y_"^PSU"
"RTN","PSJHL3",131,0)
 I FIELD(23)="",FIELD(24)="" S FIELD(23)=INFUSE
"RTN","PSJHL3",132,0)
 D SEGMENT^PSJHLU(LIMIT),DISPLAY^PSJHL2
"RTN","PSJHL3",133,0)
 K SEGMENT I RXORDER["V" S JJ=0 F  S JJ=$O(@(PSJORDER_"5,"_JJ_")")) Q:'JJ  S SEGMENT(JJ-1)=$S($G(PSJBCBU):$G(@(PSJORDER_"5,"_JJ_",0)")),1:$$ESC^ORHLESC($G(@(PSJORDER_"5,"_JJ_",0)"))))
"RTN","PSJHL3",134,0)
 E  S JJ=0 F  S JJ=$O(@(PSJORDER_"12,"_JJ_")")) Q:'JJ  S SEGMENT(JJ-1)=$S($G(PSJBCBU):$G(@(PSJORDER_"12,"_JJ_",0)")),1:$G(@(PSJORDER_"12,"_JJ_",0)")))
"RTN","PSJHL3",135,0)
 I $D(SEGMENT(0)) S SEGMENT(0)="NTE|6|L|"_SEGMENT(0) D
"RTN","PSJHL3",136,0)
 .D SET^PSJHLU K SEGMENT,JJ
"RTN","PSJHL3",137,0)
 ;build NTE 21 with Special Inst/Other Prt Info Wp fields     *267
"RTN","PSJHL3",138,0)
 N QQ K ^TMP("PSJBCMA5",$J)
"RTN","PSJHL3",139,0)
 D GETSIOPI^PSJBCMA5(PSJHLDFN,RXORDER,1) I ($G(^TMP("PSJBCMA5",$J,PSJHLDFN,RXORDER,1))["Instructions too long. See Order View or BCMA for full text"),($G(PSJORD)["P"),($G(RXORDER)["V") D
"RTN","PSJHL3",140,0)
 .N OPIAL,OPIALFLG S OPIAL=0,OPIALFLG=0 F  S OPIAL=$O(^PS(55,PSJHLDFN,"IV",+RXORDER,"A",OPIAL)) Q:'OPIAL  I ($G(^PS(55,PSJHLDFN,"IV",+RXORDER,"A",OPIAL,1,1,0))["OTHER PRINT INFO") S OPIALFLG=1
"RTN","PSJHL3",141,0)
 .Q:$P($G(^PS(55,PSJHLDFN,"IV",+RXORDER,2)),"^",8)'="N"!$G(OPIALFLG)  D GETSIOPI^PSJBCMA5(PSJHLDFN,PSJORD,1)
"RTN","PSJHL3",142,0)
 .N LINES,TEXT1 S LINES=($G(^TMP("PSJBCMA5",$J,PSJHLDFN,PSJORD))),TEXT1=$G(^TMP("PSJBCMA5",$J,PSJHLDFN,PSJORD,1))
"RTN","PSJHL3",143,0)
 .Q:LINES<1!(LINES=1&(TEXT1'["Instructions too long. See Order View or BCMA for full text"))
"RTN","PSJHL3",144,0)
 .K ^TMP("PSJBCMA5",$J,PSJHLDFN,RXORDER) M ^TMP("PSJBCMA5",$J,PSJHLDFN,RXORDER)=^TMP("PSJBCMA5",$J,PSJHLDFN,PSJORD) K ^TMP("PSJBCMA5",$J,PSJHLDFN,PSJORD)
"RTN","PSJHL3",145,0)
 I RXORDER["V"!(RXORDER["U") I ($G(PSJORD)["P"),($P($G(^PS(53.1,+PSJORD,0)),"^",25)=RXORDER) D
"RTN","PSJHL3",146,0)
 .D GETSIOPI^PSJBCMA5(PSJHLDFN,PSJORD,1)
"RTN","PSJHL3",147,0)
 .N LINES,TEXT1 S LINES=($G(^TMP("PSJBCMA5",$J,PSJHLDFN,PSJORD))),TEXT1=$G(^TMP("PSJBCMA5",$J,PSJHLDFN,PSJORD,1))
"RTN","PSJHL3",148,0)
 .Q:LINES<1!(LINES=1&(TEXT1["Instructions too long. See Order View or BCMA for full text"))
"RTN","PSJHL3",149,0)
 .K ^TMP("PSJBCMA5",$J,PSJHLDFN,RXORDER) M ^TMP("PSJBCMA5",$J,PSJHLDFN,RXORDER)=^TMP("PSJBCMA5",$J,PSJHLDFN,PSJORD) K ^TMP("PSJBCMA5",$J,PSJHLDFN,PSJORD)
"RTN","PSJHL3",150,0)
 F QQ=0:0 S QQ=$O(^TMP("PSJBCMA5",$J,PSJHLDFN,RXORDER,QQ)) Q:'QQ  D
"RTN","PSJHL3",151,0)
 .I QQ=1 S SEGMENT(0)="NTE|21|L|"_$$ESC^ORHLESC(^TMP("PSJBCMA5",$J,PSJHLDFN,RXORDER,QQ)) S:$G(PSJBCBU) SEGMENT(0)=SEGMENT(0)_"\.br\" Q
"RTN","PSJHL3",152,0)
 .S SEGMENT(QQ-1)=$$ESC^ORHLESC(^TMP("PSJBCMA5",$J,PSJHLDFN,RXORDER,QQ))
"RTN","PSJHL3",153,0)
 .I $G(PSJBCBU) S SEGMENT(QQ-1)=SEGMENT(QQ-1)_"\.br\"
"RTN","PSJHL3",154,0)
 I RXORDER["V",'$D(SEGMENT(0)) N OPIHDR S OPIHDR=$D(^PS(55,PSJHLDFN,"IV",+RXORDER,10,0)) I $P(OPIHDR,"^",2),'$P(OPIHDR,"^",3) S SEGMENT(0)="NTE|21|L|"
"RTN","PSJHL3",155,0)
 I $D(SEGMENT(0)) D SET^PSJHLU K SEGMENT,^TMP("PSJBCMA5",$J)
"RTN","PSJHL3",156,0)
 ;end   *267
"RTN","PSJHL3",157,0)
RXC ;component segments
"RTN","PSJHL3",158,0)
 N ADDITIVE,SOLUTION,SUB,TYPE,AD,SOL,PTR,NUM,UTMP,XTMP
"RTN","PSJHL3",159,0)
 S LIMIT=24 X PSJCLEAR
"RTN","PSJHL3",160,0)
 S FIELD(0)="RXC"
"RTN","PSJHL3",161,0)
 ; In the line below, the naked reference refers to the full global reference represented in PSJORDER_TYPE...
"RTN","PSJHL3",162,0)
 ; This could be a reference to either ^PS(53.1 or ^PS(55
"RTN","PSJHL3",163,0)
 S AD="AD",SOL="SOL" F TYPE="AD","SOL" S SUB=0 F  S SUB=$O(@(PSJORDER_TYPE_","_SUB_")")) Q:SUB=""  S NODE1=$G(^(SUB,0)) Q:NODE1=""  D
"RTN","PSJHL3",164,0)
 .S FIELD(1)=$S(TYPE="AD":"A",1:"B")
"RTN","PSJHL3",165,0)
 .I FIELD(1)="A",($P(NODE1,U,3)="") S $P(NODE1,U,3)="A"
"RTN","PSJHL3",166,0)
 .S PTR=+$S(TYPE="AD":+$P($G(^PS(52.6,$P(NODE1,"^"),0)),"^",11),1:+$P($G(^PS(52.7,$P(NODE1,"^"),0)),"^",11))
"RTN","PSJHL3",167,0)
 .S FIELD(2)="^^^"_$S($G(PSJBCBU):+$P(NODE1,"^"),1:PTR)_"^"_$S($G(PSJBCBU):$S(TYPE="AD":$P($G(^PS(52.6,+$P(NODE1,"^"),0)),"^"),1:$P($G(^PS(52.7,+$P(NODE1,"^"),0)),"^")_" "_$P($G(^(0)),U,4)),1:$P($G(^PS(50.7,PTR,0)),"^"))
"RTN","PSJHL3",168,0)
 .S:(TYPE="AD"&$G(PSJBCBU)) FIELD(2)=FIELD(2)_$S($P(NODE1,"^",3)]"":" BOTTLE: "_$P(NODE1,"^",3),1:"")
"RTN","PSJHL3",169,0)
 .S FIELD(2)=FIELD(2)_"^99PSP"
"RTN","PSJHL3",170,0)
 .S FIELD(3)=$P($P(NODE1,"^",2)," ")
"RTN","PSJHL3",171,0)
 .S FIELD(4)=$P($P(NODE1,"^",2)," ",2)
"RTN","PSJHL3",172,0)
 .S FIELD(5)=$P(NODE1,"^",3)
"RTN","PSJHL3",173,0)
 .F XTMP=1:1:14 S UTMP($P("ML^LITER^MCG^MG^GM^UNITS^IU^MEQ^MM^MU^THOUU^MG-PE^NANOGRAM^MMOL","^",XTMP))="PSIV-"_XTMP
"RTN","PSJHL3",174,0)
 .S NUM="" S:FIELD(4)'="" NUM=$G(UTMP(FIELD(4)))
"RTN","PSJHL3",175,0)
 .S FIELD(4)="^^^"_NUM_"^"_FIELD(4)_"^99OTH"
"RTN","PSJHL3",176,0)
 .D SEGMENT^PSJHLU(LIMIT),DISPLAY^PSJHL2
"RTN","PSJHL3",177,0)
 Q
"RTN","PSJHL3",178,0)
RXR ; med route segment
"RTN","PSJHL3",179,0)
 S LIMIT=4 X PSJCLEAR
"RTN","PSJHL3",180,0)
 S FIELD(0)="RXR"
"RTN","PSJHL3",181,0)
 I PSJORDER["IV" S FIELD(1)="^^^"_$P($G(@(PSJORDER_".2)")),"^",3) Q:$P(FIELD(1),U,4)=""  D
"RTN","PSJHL3",182,0)
 .N PSJUNITS S PSJUNITS=$S($G(PSJBCBU):$P($G(^PS(51.2,+$P(FIELD(1),"^",4),0)),"^"),1:$$ESC^ORHLESC($P($G(^PS(51.2,+$P(FIELD(1),"^",4),0)),"^")))
"RTN","PSJHL3",183,0)
 .S FIELD(1)=FIELD(1)_"^"_PSJUNITS_"^99PSR"
"RTN","PSJHL3",184,0)
 .S:$G(PSJBCBU) FIELD(4)="^^^"_$P($G(@(PSJORDER_"0)")),"^",4)_"^"_$$CODES^PSIVUTL($P($G(@(PSJORDER_"0)")),"^",4),55.01,.04)_"^99PSR"
"RTN","PSJHL3",185,0)
 I PSJORDER[53.1 S FIELD(1)="^^^"_$P($G(@(PSJORDER_"0)")),"^",3) Q:$P(FIELD(1),U,4)=""  D
"RTN","PSJHL3",186,0)
 .N PSJUNITS S PSJUNITS=$S($G(PSJBCBU):$P($G(^PS(51.2,+$P(FIELD(1),"^",4),0)),"^"),1:$$ESC^ORHLESC($P($G(^PS(51.2,+$P(FIELD(1),"^",4),0)),"^")))
"RTN","PSJHL3",187,0)
 .S FIELD(1)=FIELD(1)_"^"_PSJUNITS_"^99PSR"
"RTN","PSJHL3",188,0)
 .S:$G(PSJBCBU) FIELD(4)="^^^"_$P($G(@(PSJORDER_"0)")),"^",4)_"^"_$$CODES^PSIVUTL($P($G(@(PSJORDER_"0)")),"^",4),53.1,4)_"^99PSR"
"RTN","PSJHL3",189,0)
 S:FIELD(1)="" FIELD(1)="^^^"_$P(NODE1,"^",3)_"^"_$S($G(PSJBCBU):$P($G(^PS(51.2,+$P(NODE1,"^",3),0)),"^"),1:$$ESC^ORHLESC($P($G(^PS(51.2,+$P(NODE1,"^",3),0)),"^")))_"^99PSR"
"RTN","PSJHL3",190,0)
 D SEGMENT^PSJHLU(LIMIT),DISPLAY^PSJHL2
"RTN","PSJHL3",191,0)
 Q
"RTN","PSJHL3",192,0)
ZRX ; pharmacy Z-segment
"RTN","PSJHL3",193,0)
 D ZRX^PSJHLU
"RTN","PSJHL3",194,0)
 Q
"RTN","PSJHL3",195,0)
CNT ;Count dispense drugs for an order
"RTN","PSJHL3",196,0)
 S (CNT,DDNUM)=0 F  S DDNUM=$O(@(PSJORDER_"1,"_DDNUM_")")) Q:'DDNUM  S CNT=CNT+1
"RTN","PSJHL3",197,0)
 Q
"RTN","PSJHL3",198,0)
FINDDOSE(PSJDD,PSJF1P1,PSJDO) ;
"RTN","PSJHL3",199,0)
 ;PSJDD - IEN file #50
"RTN","PSJHL3",200,0)
 ;PSJF1P1 - Unit Per Dose
"RTN","PSJHL3",201,0)
 ;PSJDO - Dosage Ordered
"RTN","PSJHL3",202,0)
 ;PSJOUT - Dose&Unit&UPD& 
"RTN","PSJHL3",203,0)
 ;PSJOUT="" - for freetext (not calculated dose or multi ingredient drug)
"RTN","PSJHL3",204,0)
 NEW PSJDO1,PSJDO2,PSJDOSE,PSJOUT
"RTN","PSJHL3",205,0)
 I '+$G(PSJDD)!'+$G(PSJF1P1)!($G(PSJDO)="") Q ""
"RTN","PSJHL3",206,0)
 S PSJOUT=""
"RTN","PSJHL3",207,0)
 S PSJDOSE=$$DOSE1^PSJOCDS(PSJF1P1)
"RTN","PSJHL3",208,0)
 I +PSJDOSE D
"RTN","PSJHL3",209,0)
 . I $TR(PSJDO," ")=$P(PSJDOSE,U,3) S PSJOUT=$P(PSJDOSE,U)_"&"_$P(PSJDOSE,U,2)_"&"_PSJF1P1_"&" Q
"RTN","PSJHL3",210,0)
 . I $P(PSJDOSE,U,2)["/" S PSJOUT="" Q
"RTN","PSJHL3",211,0)
 . I $TR(PSJDO," ")'=$P(PSJDOSE,U,3) S PSJOUT="&&"_PSJF1P1_"&"
"RTN","PSJHL3",212,0)
 Q PSJOUT
"RTN","PSJHL7")
0^36^B55553130^B54843805
"RTN","PSJHL7",1,0)
PSJHL7 ;BIR/LDT-ACTIONS ON HL7 MESSAGES FROM OE/RR (CONT) ;29 AUG 96 / 11:18 AM
"RTN","PSJHL7",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**42,47,50,70,82,110,127,133,275,279,315**;16 DEC 97;Build 73
"RTN","PSJHL7",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PSJHL7",4,0)
 ; Reference to ^PS(50.7 is supported by DBIA# 2180.
"RTN","PSJHL7",5,0)
 ; Reference to ^PS(51.1 is supported by DBIA# 2177.
"RTN","PSJHL7",6,0)
 ; Reference to ^PS(51.2 is supported by DBIA# 2178.
"RTN","PSJHL7",7,0)
 ; Reference to ^PS(52.6 is supported by DBIA# 1231.
"RTN","PSJHL7",8,0)
 ; Reference to ^PS(52.7 is supported by DBIA# 2173.
"RTN","PSJHL7",9,0)
 ; Reference to ^PS(55 is supported by DBIA# 2191.
"RTN","PSJHL7",10,0)
 ; Reference to ^SC( is supported by DBIA# 10040.
"RTN","PSJHL7",11,0)
 ; Reference to ^TMP("PSB" is supported by DBIA# 3564.
"RTN","PSJHL7",12,0)
 ; 
"RTN","PSJHL7",13,0)
RENEW ;Renew orders from OE/RR
"RTN","PSJHL7",14,0)
 N PSJSYSW0,PSJSYSW,WRDPTR,PSJOSTOP,Q1,Q2
"RTN","PSJHL7",15,0)
 S PSJSYSW0="",PSJSYSW=0 I $G(LOC) S WRDPTR=$G(^SC(+LOC,42)) S:WRDPTR]"" PSJSYSW=+$O(^PS(59.6,"B",WRDPTR,0)) I PSJSYSW S PSJSYSW0=$G(^PS(59.6,PSJSYSW,0))
"RTN","PSJHL7",16,0)
 I PREON["V" D IVSET G DONE
"RTN","PSJHL7",17,0)
 N ND,ND1,ND2,ND2P1,PSGSI,PSGMR,PSGSM,PSGHSM,PSGST,OIDRG,PSGDO,PSGSCH,PSGSOY,PSGOXT,PSGNEDFD,DRUGS,WAT ;*315
"RTN","PSJHL7",18,0)
 S ND=$G(^PS(55,PSJHLDFN,5,+PREON,0)),ND1=$G(^(.2)),ND2=$G(^(2)),ND2P1=$G(^(2.1)),PSGSI=$G(^(6)),PSGWLL=$S($P(PSJSYSW0,"^",4):+$G(^PS(55,PSJHLDFN,5.1)),1:0) ;*315
"RTN","PSJHL7",19,0)
 I +PSITEM>0,PSITEM'=+$P(ND1,"^") S $P(ND1,"^")=PSITEM
"RTN","PSJHL7",20,0)
 S PSGMR=$P(ND,"^",3),PSGSM=$P(ND,"^",5),PSGHSM=$P(ND,"^",6),PSGST=$P(ND,"^",7),OIDRG=$P(ND1,"^"),PSGDO=$P(ND1,"^",2),DOSE=$P(ND1,"^",5),UNIT=$P(ND1,"^",6),PSGSCH=$P(ND2,"^")
"RTN","PSJHL7",21,0)
 S PSGSOY=$P(ND2,"^",5),PSGOXT=$P(ND2,"^",6),PSGNEDFD=$P($$GTNEDFD^PSGOE7("UI",OIDRG),"^")
"RTN","PSJHL7",22,0)
 S:$P(LOC,"^")'=$P(ND2,"^",10) PSGSOY=$$ENRNAT^PSJHL7($P(ND2,"^",10),+LOC,PSGSCH,PSGSOY)
"RTN","PSJHL7",23,0)
 S X=$O(^PS(55,PSJHLDFN,5,+PREON,1,0)) I X S (Q,Q1)=0 F  S Q=$O(^PS(55,PSJHLDFN,5,+PREON,1,Q)) Q:'Q  S ND=$G(^(Q,0)) I ND,$S('$P(ND,"^",3):1,1:$P(ND,"^",3)>DT) S Q1=Q1+1,DRUGS(Q1)=$P(ND,"^",1,3)
"RTN","PSJHL7",24,0)
 S (PSGNESD,PSGNEFD)="" D ENWALL^PSGNE3(PSGNESD,PSGNEFD,PSJHLDFN)
"RTN","PSJHL7",25,0)
 I PSGOXT="D",'PSGSOY S PSGSOY=+$E(PSGNESD_"00011",9,12)
"RTN","PSJHL7",26,0)
 S ND=NEWORDER_U_PROVIDER_U_PSGMR_U_"U"_U_PSGSM_U_PSGHSM_U_PSGST_"^^P^^^^^"_LOGIN_U_PSJHLDFN_U_LOGIN S:PSGNEDFD $P(ND,U,$P(PSGNEDFD,U)["L"+10)=+PSGNEDFD
"RTN","PSJHL7",27,0)
 S $P(ND,U,21)=$P(ORDER,U),$P(ND,U,24,25)=ROC_U_PREON
"RTN","PSJHL7",28,0)
 F X="PSGNESD","PSGNEFD" S:@X]"" @X=+@X
"RTN","PSJHL7",29,0)
 S ND2=PSGSCH_U_PSGNESD_"^^"_PSGNEFD_U_PSGSOY_U_PSGOXT
"RTN","PSJHL7",30,0)
 S F="^PS(53.1,"_NEWORDER_",",@(F_"0)")=ND,^(.2)=OIDRG_U_PSGDO_U_ORDCON_U_PRIORITY_U_DOSE_U_UNIT_U_U_$G(PRNTON),^(2)=ND2,^(2.1)=ND2P1 S:$G(PSGSI)]"" ^(6)=PSGSI ;*315
"RTN","PSJHL7",31,0)
 I $D(DRUGS) D
"RTN","PSJHL7",32,0)
 .I $D(@(F_"1,0)")) K @(F_"1)")
"RTN","PSJHL7",33,0)
 .; Naked reference below refers to full reference to ^PS(53.1,+NEWORDER in variable F created using indirection.
"RTN","PSJHL7",34,0)
 .I '$D(@(F_"1,0)")) S ^(0)="^53.11P^0^0"
"RTN","PSJHL7",35,0)
 .S JJ=0 F  S JJ=$O(DRUGS(JJ)) Q:'JJ  I $S('$P(DRUGS(JJ),U,3):1,1:$P(DRUGS(JJ),U,3)>DT) S $P(@(F_"1,0)"),"^",3,4)=JJ_"^"_JJ,@(F_"1,"_JJ_",0)")=$P(DRUGS(JJ),U,1,2),@(F_"1,""B"","_+DRUGS(JJ)_","_JJ_")")=""
"RTN","PSJHL7",36,0)
 S PSJOSTOP=$G(@("^PS(55,"_PSJHLDFN_",5,"_+$G(PREON)_",2)")),PSJOSTOP=$P(PSJOSTOP,"^",4)
"RTN","PSJHL7",37,0)
 D REN531(NEWORDER,$P(ND,"^",14),$S($G(PREON)["U":$P(ND,"^",2),1:$P(ND,"^",6)),PSJOSTOP,PSJHLDFN)
"RTN","PSJHL7",38,0)
 ;
"RTN","PSJHL7",39,0)
DONE ;
"RTN","PSJHL7",40,0)
 N DA,DR,DIE,PSIVACT,PSIVALT,ON55,PSIVREA
"RTN","PSJHL7",41,0)
 S DIE=$S(PREON["V":"^PS(55,"_PSJHLDFN_",""IV"",",1:"^PS(55,"_PSJHLDFN_",5,"),DA=+PREON,DA(1)=PSJHLDFN,DR=$S(PREON["V":"100////R;123////R;114////"_PSJORDER,1:"28////R;107////R;105////"_PSJORDER)
"RTN","PSJHL7",42,0)
 I PREON["A"!(PREON["U") S PSGAL("C")=18000 D ^PSGAL5
"RTN","PSJHL7",43,0)
 I PREON["V" S PSIVACT=1,PSIVALT=2,ON55=PREON,PSIVREA="R"
"RTN","PSJHL7",44,0)
 D ^DIE
"RTN","PSJHL7",45,0)
 I PREON["V" N DFN S DFN=PSJHLDFN D LOG^PSIVORAL
"RTN","PSJHL7",46,0)
 S PSJHLMTN="ORM" D EN1^PSJHL2(PSJHLDFN,"SC",PREON) S PSJHLMTN="ORR",PSOC="NW"
"RTN","PSJHL7",47,0)
 Q
"RTN","PSJHL7",48,0)
IVSET ;
"RTN","PSJHL7",49,0)
 N DRG,DRGN,P
"RTN","PSJHL7",50,0)
 S P("RES")="R",P("REN")="",Y=$G(^PS(55,PSJHLDFN,"IV",+PREON,0)) F X=1:1:23 S P(X)=$P(Y,U,X)
"RTN","PSJHL7",51,0)
 S P("PON")=PREON,P(21)=$P(ORDER,U),P(6)=PROVIDER_U_$P($G(^VA(200,+PROVIDER,0)),U),(DRG,DRGN)="",P("REM")=$G(^PS(55,PSJHLDFN,"IV",+PREON,1))
"RTN","PSJHL7",52,0)
 S Y=$G(^PS(55,PSJHLDFN,"IV",+PREON,2)),P("LOG")=LOGIN
"RTN","PSJHL7",53,0)
 S P("CLRK")=CLERK_U_$P($G(^VA(200,+CLERK,0)),U),P("RES")=ROC,P("FRES")=$P(Y,U,9),P("SYRS")=$P(Y,U,4),P("OPI")=$G(^PS(55,PSJHLDFN,"IV",+PREON,3))
"RTN","PSJHL7",54,0)
 S ND=$G(^PS(55,PSJHLDFN,"IV",+PREON,.2)),P("PD")=$S($P(ND,U):$P(ND,U)_U_$P($G(^PS(50.7,+ND,0)),U),1:""),P("DO")=$P(ND,U,2)
"RTN","PSJHL7",55,0)
 S P("MR")=$P(ND,U,3),ND=$G(^PS(51.2,+P("MR"),0)),P("MR")=P("MR")_U_$S($P(ND,U,3)]"":$P(ND,U,3),1:$P(ND,U))
"RTN","PSJHL7",56,0)
 D GTDRG
"RTN","PSJHL7",57,0)
 S P("OT")=$S(P(4)="A":"F",P(4)="H":"I",1:"I")
"RTN","PSJHL7",58,0)
 I P("OT")="F" F DRGT="AD","SOL" F DRGI=0:0 S DRGI=$O(DRG(DRGT,DRGI)) Q:'DRGI  I '$P(DRG(DRGT,DRGI),U,5) S P("OT")="I"
"RTN","PSJHL7",59,0)
PUT531 ; Move data in local variables to 53.1
"RTN","PSJHL7",60,0)
 N IVLIM,IVLIMIT S IVLIM=$$GETDUR^PSJLIVMD(PSJHLDFN,+PREON,$E(PREON,$L(PREON)),1) I IVLIM]"",$G(IVLIMIT) S $P(^PS(53.1,+NEWORDER,2.5),U,4)=IVLIM
"RTN","PSJHL7",61,0)
 S ND(0)=+NEWORDER_U_+P(6)_U_$S(+P("MR"):+P("MR"),1:"")_U_P("OT")_U_U_U_"C",$P(ND(0),U,9)="P"
"RTN","PSJHL7",62,0)
 S $P(ND(0),U,14,16)=P("LOG")_U_PSJHLDFN_U_P("LOG"),$P(ND(0),U,21)=P(21),$P(ND(0),U,24,26)=$G(P("RES"))_U_P("PON")
"RTN","PSJHL7",63,0)
 S ND(2)=P(9)_U_U_U_U_P(11)_U_P(15),$P(ND(4),U,7,9)=+P("CLRK")_U_U_P("REN")
"RTN","PSJHL7",64,0)
 S ND(8)=P(4)_U_P(23)_U_P("SYRS")_U_P(5)_U_P(8)_"^^"_P(7),ND(9)=$S($L(P("REM")_P("OPI")):P("REM")_U_P("OPI"),1:"")
"RTN","PSJHL7",65,0)
 S ND(17)="" I $G(P(8))["@",($P($G(P(8)),"@",2)?1.N) S ND(17)=$P(P(8),"@",2)
"RTN","PSJHL7",66,0)
 F X=0,2,4,8,9,17 S ^PS(53.1,+NEWORDER,X)=ND(X)
"RTN","PSJHL7",67,0)
 S:+P("PD") ^PS(53.1,+NEWORDER,.2)=+P("PD")_U_P("DO")
"RTN","PSJHL7",68,0)
 S $P(^PS(53.1,+NEWORDER,.2),"^",3,4)=ORDCON_U_PRIORITY
"RTN","PSJHL7",69,0)
 ;I $G(PRNTON) I $$UP^XLFSTR($G(PSGSCH))="NOW" S PRNTON=""
"RTN","PSJHL7",70,0)
 I $G(PRNTON) S $P(^PS(53.1,+NEWORDER,.2),"^",8)=PRNTON
"RTN","PSJHL7",71,0)
 F DRGT="AD","SOL" D:$D(DRG(DRGT)) PTD531
"RTN","PSJHL7",72,0)
 S PSJOSTOP=$G(@("^PS(55,"_PSJHLDFN_",""IV"","_+PREON_",0)")),PSJOSTOP=$P(PSJOSTOP,"^",3) D
"RTN","PSJHL7",73,0)
 .N IVND S IVND=$G(^PS(53.1,+NEWORDER,0)) D REN531(NEWORDER,$P(IVND,"^",14),$P(ND,"^",2),PSJOSTOP,PSJHLDFN)
"RTN","PSJHL7",74,0)
 Q
"RTN","PSJHL7",75,0)
PTD531 ; Move drug data from local array into 53.1
"RTN","PSJHL7",76,0)
 K ^PS(53.1,+NEWORDER,DRGT) S ^PS(53.1,+NEWORDER,DRGT,0)=$S(DRGT="AD":"^53.157PA^0^0",1:"^53.158PA^0^0")
"RTN","PSJHL7",77,0)
 F X=0:0 S X=$O(DRG(DRGT,X)) Q:'X  D
"RTN","PSJHL7",78,0)
 .S X1=$P(DRG(DRGT,X),U),Y=^PS(53.1,+NEWORDER,DRGT,0),$P(Y,U,3)=$P(Y,U,3)+1,DRG=$P(Y,U,3),$P(Y,U,4)=$P(Y,U,4)+1
"RTN","PSJHL7",79,0)
 .S ^PS(53.1,+NEWORDER,DRGT,0)=Y,Y=+X1_U_$P(DRG(DRGT,X),U,3) S:DRGT="AD" $P(Y,U,3)=$P(DRG(DRGT,X),U,4) S ^PS(53.1,+NEWORDER,DRGT,+DRG,0)=Y,^PS(53.1,+NEWORDER,DRGT,"B",+X1,+DRG)=""
"RTN","PSJHL7",80,0)
 I $G(P("RES"))="R",($G(ND(0))]"") D REN531(+NEWORDER,$P(ND(0),"^",14),$P(ND(0),"^",2),$G(P(3)),$G(DFN))
"RTN","PSJHL7",81,0)
 Q
"RTN","PSJHL7",82,0)
 ;
"RTN","PSJHL7",83,0)
ENRNAT(OWD,NWD,SC,OAT) ;Determine admin times for renewal orders.
"RTN","PSJHL7",84,0)
 ;OWD=ORIGINAL W,NWD=NEW WD LOCATION, SC=SCHEDULE, OAT=ORDER ADMIN TIMES
"RTN","PSJHL7",85,0)
 N OWAT,SCP,X,Y,OOAT
"RTN","PSJHL7",86,0)
 S OOAT=OAT,SCP=+$O(^PS(51.1,"APPSJ",+SC,0)),WAT=$P($G(^PS(51.1,SCP,1,+$G(OWD),0)),U,2)
"RTN","PSJHL7",87,0)
 F X="WAT","OAT" F Y=1:1 Q:$L(@X)>240!($P(@X,"-",Y)="")  S $P(@X,"-",Y)=$P(@X,"-",Y)_$E("0000",1,4-$L($P(@X,"-",Y)))
"RTN","PSJHL7",88,0)
 I OAT'=WAT Q OOAT
"RTN","PSJHL7",89,0)
 S X=$P($G(^PS(51.1,+SCP,1,NWD,0)),U,2) I X Q X
"RTN","PSJHL7",90,0)
 Q OOAT
"RTN","PSJHL7",91,0)
 ;
"RTN","PSJHL7",92,0)
GTDRG ; Get drug info and place in DRG(. 
"RTN","PSJHL7",93,0)
 F DRGT="AD","SOL" S FIL=$S(DRGT="AD":52.6,1:52.7) F Y=0:0 S Y=$O(^PS(55,PSJHLDFN,"IV",+PREON,DRGT,Y)) Q:'Y  D
"RTN","PSJHL7",94,0)
 .;Naked reference ^(Y,0) below refers to full global reference ^PS(55,PSJHLDFN,"IV",+PREON,DRGT,Y)) above at GTDRG+1
"RTN","PSJHL7",95,0)
 .S DRG=$G(^(Y,0)),ND=$G(^PS(FIL,+DRG,0)),(DRGI,DRG(DRGT,0))=$G(DRG(DRGT,0))+1,DRG(DRGT,+DRGI)=+DRG_U_$P(ND,U)_U_$P(DRG,U,2)_U_$P(DRG,U,3)_U_$P(ND,U,13)_U_$P(ND,U,11)
"RTN","PSJHL7",96,0)
 Q
"RTN","PSJHL7",97,0)
 ;
"RTN","PSJHL7",98,0)
REN531(PSGORD,PSGDT,PSGOEPR,PSGOFD,PSGP) ;
"RTN","PSJHL7",99,0)
 Q:'PSGORD!'PSGDT!'PSGOEPR!'PSGOFD!'PSGP
"RTN","PSJHL7",100,0)
 N DUP,PSGOLDPR I $G(PREON) D  Q:$G(DUP)
"RTN","PSJHL7",101,0)
 .S:$D(^PS(53.1,+PSGORD,14,"B",+PSGDT)) DUP=1 Q
"RTN","PSJHL7",102,0)
 S:$G(PREON)["U" PSGOLDPR=$P($G(^PS(55,PSGP,5,+PREON,0)),"^",2)
"RTN","PSJHL7",103,0)
 S:$G(PREON)["V" PSGOLDPR=$P($G(^PS(55,PSGP,"IV",+PREON,0)),"^",6)
"RTN","PSJHL7",104,0)
 K DR,DA,DIC,DIE,DD,DO S DIC="^PS(53.1,"_+PSGORD_",14,",DIC(0)="L",DIC("P")="53.1114DA",ND14=$G(@(DIC_"0)")),DINUM=$P(ND14,"^",3)+1,DA(2)=PSGP,DA(1)=+PSGORD D
"RTN","PSJHL7",105,0)
 . S DIC("DR")=".01////"_$G(PSGDT)_";1////"_$G(DUZ)_";2////"_$S($G(PSGOLDPR):$G(PSGOLDPR),1:$G(PSGOEPR))_";3////"_$G(PSGOFD),X=$G(PSGDT) D FILE^DICN
"RTN","PSJHL7",106,0)
 K DO,DINUM
"RTN","PSJHL7",107,0)
 I $G(PREON)["U",$D(^PS(55,PSGP,5,+PREON,15,1)) D
"RTN","PSJHL7",108,0)
 .N PSJSYSP S PSJSYSP=$J D GETSI^PSJBCMA5(PSGP,PREON) I $D(^PS(53.45,$J,5)) D FILESI^PSJBCMA5(PSGP,$S(PSGORD=+PSGORD:+PSGORD_"P",1:PSGORD))
"RTN","PSJHL7",109,0)
 I $G(PREON)["V",$D(^PS(55,PSGP,"IV",+PREON,10,1)) D
"RTN","PSJHL7",110,0)
 .N PSJSYSP S PSJSYSP=$J D GETOPI^PSJBCMA5(PSGP,PREON) I $D(^PS(53.45,$J,6)) D FILEOPI^PSJBCMA5(PSGP,$S(PSGORD=+PSGORD:+PSGORD_"P",1:PSGORD))
"RTN","PSJHL7",111,0)
 Q
"RTN","PSJHL7",112,0)
 ;
"RTN","PSJHL7",113,0)
CHK(X,Y,Z) ;Check for required fields
"RTN","PSJHL7",114,0)
 ; Input: X="^^"_MED ROUTE_"^^^^"_SCH TYPE
"RTN","PSJHL7",115,0)
 ;        Y=ORDERABLE ITEM_"^"_DOSAGE ORDERED
"RTN","PSJHL7",116,0)
 ;        Z=SCHEDULE_"^"_START DATE/TIME_"^^"_STOP DATE/TIME
"RTN","PSJHL7",117,0)
 S:'$D(^PS(50.7,+Y,0)) CHK=1
"RTN","PSJHL7",118,0)
 I ND="" S CHK=CHK_23
"RTN","PSJHL7",119,0)
 E  S CHK=CHK_$S($P(X,"^",3):"",1:2)_$S($P(X,"^",7)]"":"",1:3)
"RTN","PSJHL7",120,0)
 K PSGDFLG,PSGPFLG S PSGDI=0
"RTN","PSJHL7",121,0)
 S:'$$DDOK^PSJHL10("^TMP(""PSB"","_$J_",700,",+Y) CHK=CHK_7
"RTN","PSJHL7",122,0)
 ;
"RTN","PSJHL7",123,0)
CHKM ;
"RTN","PSJHL7",124,0)
 Q:'CHK
"RTN","PSJHL7",125,0)
 N MSG2
"RTN","PSJHL7",126,0)
 S MSG="THE FOLLOWING "_$S($L(CHK)>1:"ARE",1:"IS")_" EITHER INVALID OR MISSING FROM THIS ORDER:" F X=1:1:7 S:CHK[X MSG2=$P("ORDERABLE ITEM^MED ROUTE^SCHEDULE TYPE^SCHEDULE^START DATE/TIME^STOP DATE/TIME^DISPENSE DRUG","^",X)
"RTN","PSJHL7",127,0)
 S PSREASON=MSG_MSG2
"RTN","PSJHL7",128,0)
 Q
"RTN","PSJLMGUD")
0^19^B31031159^B30490889
"RTN","PSJLMGUD",1,0)
PSJLMGUD ;BIR/MLM-INITIALIZE UNIT DOSE ORDER FIELDS FOR DISPLAY ;05 Feb 99 / 9:46 AM
"RTN","PSJLMGUD",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**25,58,85,116,110,111,267,275,315**;16 DEC 97;Build 73
"RTN","PSJLMGUD",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PSJLMGUD",4,0)
 ; Reference to ^PS(51.2 is supported by DBIA 2178
"RTN","PSJLMGUD",5,0)
 ; Reference to ^PSDRUG( is supported by DBIA 2192 
"RTN","PSJLMGUD",6,0)
 ; Reference to ^PS(55   is supported by DBIA 2191
"RTN","PSJLMGUD",7,0)
 ; Reference to ES^ORX8 is supported by DBIA 3632
"RTN","PSJLMGUD",8,0)
 ;
"RTN","PSJLMGUD",9,0)
GETUD(DFN,PSGORD) ;
"RTN","PSJLMGUD",10,0)
 ;
"RTN","PSJLMGUD",11,0)
EN2 ;
"RTN","PSJLMGUD",12,0)
 N %X,%Y,ND2,ND2P1,DO,DRGI,FD,FL,FQC,NF,ND,PRI,SD,SIG,ST,STD,X,Y,ESIG ;*315
"RTN","PSJLMGUD",13,0)
 K GMRAL,P
"RTN","PSJLMGUD",14,0)
 S NF=$S(PSGORD["U":0,PSGORD["A":0,PSGORD["O":0,1:1) I NF,$D(^PS(53.1,+PSGORD,0)),$P(^(0),"^",19),$D(^PS(55,DFN,5,$P(^(0),"^",19))),(+$P(^(0),"^",19)'=+$P(^(0),"^",25)) S PSGORD=+$P(^PS(53.1,+PSGORD,0),"^",19)_"U",NF=0
"RTN","PSJLMGUD",15,0)
 S (FL,Y)="",$P(FL,"-",71)="",PSGOEEWF="^PS("_$S(NF:"53.1,",1:"55,"_DFN_",5,")_+PSGORD_","
"RTN","PSJLMGUD",16,0)
 ; The naked reference on the line below refers to the full reference created by indirect reference to F, where F may refer to ^PS(53.1 or the IV or UD multiple ^PS(55
"RTN","PSJLMGUD",17,0)
 S ND=$G(@(PSGOEEWF_"0)")),ND2=$G(^(2)),ND2P1=$G(^(2.1)),PSGEB=$P($G(^(4)),"^",7),PSGOSI=$G(^(6)),SIG=$G(^(6.5)),DO=$G(^(.2)),PSGOINST=$G(^(.3)),ESIG=$P(DO,U,3),PSG14=$P($G(^(14,0)),"^",3) ;*315
"RTN","PSJLMGUD",18,0)
 I PSG14 S PSGLRN=$G(@(PSGOEEWF_"14,"_PSG14_",0)"))
"RTN","PSJLMGUD",19,0)
 S PSGOPD=+DO,PSGODO=$P(DO,U,2),PSGOPDN=$$OINAME^PSJLMUTL(+DO),X=$P(DO,U,4),PSGPRIO=$P("STAT^ASAP^ROUTINE^PREOP^TIME CRITICAL^DONE",U,$F("SARPTD",X)-1),PSJPRI=X
"RTN","PSJLMGUD",20,0)
 S PSGOPR=$P(ND,"^",2),PSGOMR=$P(ND,"^",3),PSGOSM=$P(ND,"^",5),PSGOHSM=$P(ND,"^",6),(PSGOST,ST)=$P(ND,"^",7),STT=$P(ND,"^",9),PSGOMRN=$S('PSGOMR:"",1:$P($G(^PS(51.2,PSGOMR,0)),"^")) S:PSGOMRN="" PSGOMRN=PSGOMR
"RTN","PSJLMGUD",21,0)
 S PSGLI=$P(ND,U,16),PSGOSCH=$P(ND2,"^"),(PSGOSD,SD)=$P(ND2,"^",2),(FD,PSGOFD)=$P(ND2,"^",4),(FQC,PSGS0XT)=$P(ND2,"^",6),(PSGOAT,PSGS0Y)=$P(ND2,"^",5)
"RTN","PSJLMGUD",22,0)
 S:ND2P1]"" PSGDUR=$P(ND2P1,U,1),PSGRMVT=$P(ND2P1,U,2),PSGRMV=$P(ND2P1,U,3),PSGRF=$P(ND2P1,U,4) ;*315
"RTN","PSJLMGUD",23,0)
 S PSGLIN=$$ENDD^PSGMI(PSGLI)_U_$$ENDTC^PSGMI(PSGLI)
"RTN","PSJLMGUD",24,0)
 S PRI=$S('PSGOPR:0,1:$P($G(^VA(200,PSGOPR,"PS")),"^",4)),DRGI=$S(PSGOPD'=+PSGOPD:0,1:+$G(^PSDRUG(+PSGOPD,"I"))) S:PRI PRI=DT'<PRI S:DRGI DRGI=DT'<DRGI
"RTN","PSJLMGUD",25,0)
 S PSGOPRN=$S('PSGOPR:"",1:$P($G(^VA(200,PSGOPR,0)),"^")) S:PSGOPRN="" PSGOPRN=PSGOPR I PSGOSI]"" S PSGOSI=$$ENSET^PSGSICHK(PSGOSI)
"RTN","PSJLMGUD",26,0)
 I $L($T(ES^ORX8)) N ESIG1 S ESIG1=$$ES^ORX8(+$P(ND,U,21)_";1") S:ESIG1=1 ESIG="ES"
"RTN","PSJLMGUD",27,0)
 S PSGOPRN=PSGOPRN_$S(ESIG]"":" ["_$$LOW^XLFSTR(ESIG)_"]",1:"")
"RTN","PSJLMGUD",28,0)
 S PSGEBN=$$ENNPN^PSGMI(PSGEB) S:$P(ND,U,27)="R" STT="R"
"RTN","PSJLMGUD",29,0)
 S X=STT,PSGSTAT=$S(X="":"NOT FOUND",X="DE":"DISCONTINUED (EDIT)",X="DR":"DISCONTINUED (RENEWAL)",X="RE":"REINSTATED",1:$P(X_"^ACTIVE^DISCONTINUED^EXPIRED^HOLD^INCOMPLETE^NON-VERIFIED^PENDING^RENEWED^UNRELEASED","^",$F("ADEHINPRU",X)))
"RTN","PSJLMGUD",30,0)
 ;
"RTN","PSJLMGUD",31,0)
SET ;
"RTN","PSJLMGUD",32,0)
 I STT="P" S (FD,SD,ST)=""
"RTN","PSJLMGUD",33,0)
 S PSGOSTN=$$ENSTN^PSGMI(ST),(PSGOFDN,PSGOSDN)="" I SD S PSGOSDN=$$ENDD^PSGMI(SD)_"^"_$$ENDTC^PSGMI(SD)
"RTN","PSJLMGUD",34,0)
 I FD S PSGOFDN=$$ENDD^PSGMI(FD)_"^"_$$ENDTC^PSGMI(FD)
"RTN","PSJLMGUD",35,0)
 F X="PD","PDN","MR","MRN","ST","STN","SCH","SI","SD","SDN","FD","FDN","SM","HSM","PR","PRN","DO","AT" S @("PSG"_X)=@("PSGO"_X)
"RTN","PSJLMGUD",36,0)
 K ^PS(53.45,PSJSYSP,1),^(2),^(5),^(6) S %X=PSGOEEWF_"3,",%Y="^PS(53.45,"_PSJSYSP_",1," D %XY^%RCR S %X=PSGOEEWF_"1,",%Y="^PS(53.45,"_PSJSYSP_",2," D %XY^%RCR
"RTN","PSJLMGUD",37,0)
 S $P(^PS(53.45,PSJSYSP,2,0),"^",2)="53.4502P"
"RTN","PSJLMGUD",38,0)
 K PSJNSS I $G(PSGSCH)'="" D  K PSJNSS
"RTN","PSJLMGUD",39,0)
 . N PSGS0XTO,Y,PSGOES S X=PSGSCH S PSGS0XTO=PSGS0XT N PSGOSCH S PSGOSCH=PSGSCH S PSGSCH="",PSGOES=1
"RTN","PSJLMGUD",40,0)
 . D ENOS^PSGS0 S:$G(X)="" PSGS0XT=PSGS0XTO S PSGSCH=$S($G(X)]""&($G(PSGS0XT)="D"):X,1:PSGOSCH)
"RTN","PSJLMGUD",41,0)
 Q
"RTN","PSJLMGUD",42,0)
 ;
"RTN","PSJLMGUD",43,0)
FINISH ;
"RTN","PSJLMGUD",44,0)
 I '$G(PSGS0XT),PSGOSCH]"" D  S $P(^PS(53.1,+PSGORD,2),"^",6)=PSGS0XT
"RTN","PSJLMGUD",45,0)
 .N PSGOES,PSGS0Y S X=PSGOSCH,PSGOES=1 D ENOS^PSGS0
"RTN","PSJLMGUD",46,0)
 S PSGOEFF=PSGOSCH=""+('$O(^PS(53.45,PSJSYSP,2,0))*10) I PSGOEFF S X=$S(PSGOEFF#2:" a SCHEDULE",1:"")_$S(PSGOEFF=11:" and",1:"")_$S(PSGOEFF>9:" at least one DISPENSE DRUG",1:"")_" before it can be finished."
"RTN","PSJLMGUD",47,0)
 I PSGOEFF W $C(7),!!,"PLEASE NOTE: This order must have" F Q=1:1:$L(X," ") S Y=$P(X," ",Q) W:$L(Y)+$X>78 ! W Y," "
"RTN","PSJLMGUD",48,0)
 I PSGOEFF#2 S F1=53.1,MSG=0,Y=$T(35),@("PSGFN(35)="_$P(Y,";",7)),PSGOEEF(+$P(Y,";",3))=1,(PSGOEE,PSGOEEF)=1 W ! D @$P($T(35),";",3) G:'PSGOEE DONE
"RTN","PSJLMGUD",49,0)
 I PSGOEFF>9 S CHK=7 D ENDRG^PSGOEF1(PSGOPD,0) G:CHK DONE
"RTN","PSJLMGUD",50,0)
 I $G(MSG) K DIR S DIR(0)="E" W !! D ^DIR
"RTN","PSJLMGUD",51,0)
 I PSGOEFF D:PSGST="" GTST^PSGOE6(+PSGORD) N XQORM D EN^VALM("PSJ LM OE DISPLAY") G DONE ;D ENW^PSGOEEW
"RTN","PSJLMGUD",52,0)
 ;
"RTN","PSJLMGUD",53,0)
ACCEPT ;
"RTN","PSJLMGUD",54,0)
 D UPD^PSGOEF1 G DONE
"RTN","PSJLMGUD",55,0)
BYPASS ;
"RTN","PSJLMGUD",56,0)
 S PSGCANFL=1 G DONE
"RTN","PSJLMGUD",57,0)
 ;
"RTN","PSJLMGUD",58,0)
EDIT ;    
"RTN","PSJLMGUD",59,0)
 S PSGPDRG=PSGOPD,PSGPDRGN=PSGOPDN K PSGOEEND D ENF^PSGOEE I PSGCANFL=-1 D UPD^PSGOEF1
"RTN","PSJLMGUD",60,0)
 ;
"RTN","PSJLMGUD",61,0)
DONE ;
"RTN","PSJLMGUD",62,0)
 K CHK,DA,DIE,DR,DRG,MSG,ORETURN,ORIFN,PSGEB,PSGEFN,PSGND,PSGOEE,PSGOEEF,PSGOEEND,PSGOEEG,PSGOEF,PSGOEFF,PSGOES,PSGOPD,PSGOPDN,PSGOPR,PSGOSCH,PSGPDRG,PSGDRGN,PSG0XT,PSGS0Y,OSGSD,Q1,Q2
"RTN","PSJLMGUD",63,0)
 K PSGDUR,PSGRMV,PSGRMVT ;*315
"RTN","PSJLMGUD",64,0)
 Q
"RTN","PSJLMGUD",65,0)
 ;
"RTN","PSJLMGUD",66,0)
 ;
"RTN","PSJLMGUD",67,0)
31 ;;101^PSGOE8;PSGOPD;PSGPD;101;1
"RTN","PSJLMGUD",68,0)
32 ;;109^PSGOE8;PSGODO;PSGDO;102;PSGODO]""
"RTN","PSJLMGUD",69,0)
33 ;;3^PSGOE8;PSGOMR;PSGMR;3;1
"RTN","PSJLMGUD",70,0)
34 ;;7^PSGOE8;PSGOST;PSGST;7;0
"RTN","PSJLMGUD",71,0)
35 ;;26^PSGOE8;PSGOSCH;PSGSCH;26;1
"RTN","PSJLMGUD",72,0)
36 ;;39^PSGOE81;PSGOAT;PSGAT;39;0
"RTN","PSJLMGUD",73,0)
37 ;;1^PSGOE82;PSGOPR;PSGPR;1;1
"RTN","PSJLMGUD",74,0)
38 ;;8^PSGOE81;PSGOSI;PSGSI;8;0
"RTN","PSJLMGUD",75,0)
39 ;;2^PSGOE82;;;2;0
"RTN","PSJLMGUD",76,0)
310 ;;40^PSGOE82;;;40;0
"RTN","PSJLMGUD",77,0)
311 ;;66^PSGOE82;;;66;1
"RTN","PSJLMGUD",78,0)
312 ;;10^PSGOE81;PSGOSD;PSGSD;10;0
"RTN","PSJLMGUD",79,0)
313 ;;25^PSGOE81;PSGOFD;PSGFD;25;0
"RTN","PSJLMGUD",80,0)
314 ;;5^PSGOE82;PSGOSM;PSGSM;5;0
"RTN","PSJLMGUD",81,0)
 ;
"RTN","PSJLMGUD",82,0)
AH ;
"RTN","PSJLMGUD",83,0)
 W !!?2,"Answer 'YES' to accept this order as a NON-VERIFIED UNIT DOSE order.  Answer",!,"'NO' to edit this order now.  Enter '^' to BYPASS this order, leaving it as",!,"a PENDING INPATIENT order."
"RTN","PSJLMGUD",84,0)
 Q
"RTN","PSJLMUDE")
0^12^B69470677^B66391198
"RTN","PSJLMUDE",1,0)
PSJLMUDE ;BIR/MLM-SHOW FIELDS FOR EDIT (LISTMAN STYLE) ;01 JUNE 00 / 2:40 PM
"RTN","PSJLMUDE",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**7,47,50,63,64,58,80,116,110,111,164,175,201,181,254,267,228,315**;16 DEC 97;Build 73
"RTN","PSJLMUDE",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PSJLMUDE",4,0)
 ;NFI-UD Fr#:2 chgs@init+4 to display non-formulary (N/F)
"RTN","PSJLMUDE",5,0)
 ;also chgs @init+23
"RTN","PSJLMUDE",6,0)
 ;
"RTN","PSJLMUDE",7,0)
 ; Reference to ^PS(55 is supported by DBIA# 2191
"RTN","PSJLMUDE",8,0)
 ; Reference to ^PSDRUG is supported by DBIA 2192
"RTN","PSJLMUDE",9,0)
 ;
"RTN","PSJLMUDE",10,0)
INIT(PSGP,PSGORD) ;
"RTN","PSJLMUDE",11,0)
 N D,ND,PSJBCMA,PSJL,PSJLM,PSJLN,Q,QQ,PSJDUR,J K ^TMP("PSJUDE",$J),^TMP($J,"GMRAING")
"RTN","PSJLMUDE",12,0)
 K:$G(PSJNORD) PSGOEEF S PSJLN=1
"RTN","PSJLMUDE",13,0)
 D CLEAN^VALM10
"RTN","PSJLMUDE",14,0)
 S PSJL=$S($D(PSGEFN(1)):$E(" *",PSGEFN(1)+1)_"(1)",1:"   "),PSJL=$$SETSTR^VALM1("Orderable Item: "_PSGPDN_$$OINF^PSJDIN(PSGPD),PSJL,5,74) D  D SETTMP D:$G(PSGOEEF(108))!($G(PSGOEEF(101))) HILITE(1)
"RTN","PSJLMUDE",15,0)
 . NEW Q,PSJDDA,PSJVD F Q=0:0 S Q=$O(^PS(53.45,PSJSYSP,2,Q)) Q:'Q  S PSJDDA(+$G(^(Q,0)))=""
"RTN","PSJLMUDE",16,0)
 . S PSJVD=$$DINFLUD^PSJDIN(PSGPD,.PSJDDA)
"RTN","PSJLMUDE",17,0)
 . I $$OVRCHK^PSGSICH1(PSGP,PSGORD) S PSJVD="<OCI>"_PSJVD
"RTN","PSJLMUDE",18,0)
 . S PSJL=$$SETSTR^VALM1(PSJVD,PSJL,(80-$L(PSJVD)),80)
"RTN","PSJLMUDE",19,0)
 . D:PSJVD]"" CNTRL^VALM10(1,80-$L(PSJVD),$L(PSJVD),IORVON,IORVOFF,0)
"RTN","PSJLMUDE",20,0)
 I $G(PSJORD)["P" D REQDT^PSJLIVMD(PSJORD)
"RTN","PSJLMUDE",21,0)
 S PSJL="Instructions: "_PSGOINST D PTXT^PSJLMPRU(PSJL,"PSJUDE",6,80)
"RTN","PSJLMUDE",22,0)
 S PSJL=$S($D(PSGEFN(2)):$E(" *",PSGEFN(2)+1)_"(2)",1:"    "),PSJL=$$SETSTR^VALM1("Dosage Ordered: "_PSGDO,PSJL,5,76) D SETTMP D:$G(PSGOEEF(109)) HILITE(2)
"RTN","PSJLMUDE",23,0)
 I $G(PSGRDTX) S PSJDUR=$$FMTDUR^PSJLIVMD($P($G(PSGRDTX),U,2))
"RTN","PSJLMUDE",24,0)
 I $G(PSJORD),($G(PSJDUR)="") S P=$S(PSJORD["U":5,PSJORD["V":"IV",PSJORD["P":"P",1:-1) S PSJDUR=$$GETDUR^PSJLIVMD(PSGP,+PSJORD,P)
"RTN","PSJLMUDE",25,0)
 S PSJL=$$SETSTR^VALM1("Duration: "_$G(PSJDUR),PSJL,11,25)
"RTN","PSJLMUDE",26,0)
 S PSJL=$$SETSTR^VALM1($S($D(PSGEFN(3)):$E(" *",PSGEFN(3)+1)_"(3)",1:"    ")_"Start: "_$P(PSGSDN,U,2),PSJL,54,26) D:$G(PSGOEEF(10)) HILITE(3)
"RTN","PSJLMUDE",27,0)
 I $G(PSGORD)["P" N ND0,OLDO S ND0=@(PSGOEEWF_"0)") I $P(ND0,"^",24)="R" S OLDO=$P(ND0,"^",25) I OLDO,(OLDO["U") D
"RTN","PSJLMUDE",28,0)
 . N OSTRT,OSTRTN S OSTRT=$G(@("^PS(55,"_PSGP_",5,"_+OLDO_",2)")),OSTRT=$P(OSTRT,"^",2) Q:'OSTRT  S OSTRTN=$$ENDTC^PSGMI(+OSTRT)
"RTN","PSJLMUDE",29,0)
 . S PSJL=$$SETSTR^VALM1($S($D(PSGEFN(3)):$E(" *",PSGEFN(3)+1)_"(3)",1:"    ")_"Start: "_OSTRTN,PSJL,54,26)
"RTN","PSJLMUDE",30,0)
 D SETTMP
"RTN","PSJLMUDE",31,0)
 S PSJL=$S($D(PSGEFN(4)):$E(" *",PSGEFN(4)+1)_"(4)",1:"    "),PSJL=$$SETSTR^VALM1("Med Route: "_PSGMRN,PSJL,10,35) D:$G(PSGOEEF(3)) HILITE(4)
"RTN","PSJLMUDE",32,0)
 I $G(PSJORD)["P" N PSGRNDT S PSGRNDT=$$LASTREN^PSJLMPRI(DFN,PSGORD) S:PSGRNDT PSGRNDT=$$ENDTC^PSGMI(+PSGRNDT),PSJL=$$SETSTR^VALM1("Renewed: "_PSGRNDT,PSJL,56,32)
"RTN","PSJLMUDE",33,0)
 I '$G(PSGRNDT),$G(PSGRDTX) D
"RTN","PSJLMUDE",34,0)
 . I $D(PSGRDTX)<10 S PSGRSDN=$$ENDTC^PSGMI(+PSGRDTX),PSJL=$$SETSTR^VALM1("REQUESTED START: "_PSGRSDN,PSJL,48,32) Q
"RTN","PSJLMUDE",35,0)
 . I $G(PSGRDTX(+$G(PSJORD),"PSGRSD")),$P($G(PSGSDN),U,2) S PSGRSDN=$$ENDTC^PSGMI(PSGRDTX(+PSJORD,"PSGRSD")),PSJL=$$SETSTR^VALM1("Calc Start: "_PSGRSDN,PSJL,53,32) D
"RTN","PSJLMUDE",36,0)
 .. I PSGSD'=PSGRDTX(+PSJORD,"PSGRSD") D CNTRL^VALM10(5,53,80,IORVON,IORVOFF)
"RTN","PSJLMUDE",37,0)
 ; Indirect reference in PSGOEEWF below refers to either ^PS(53.1 or ^PS(55,DFN,5,. Naked reference refers to full indirect reference
"RTN","PSJLMUDE",38,0)
 I $G(PSJORD)["U" N ND14 S ND14=$G(@(PSGOEEWF_"14,0)")) I ND14]"" S ND14=$G(^($P(ND14,"^",3),0)),RNDT=$P(ND14,"^") I RNDT D
"RTN","PSJLMUDE",39,0)
 . N PSGRNDT S PSGRNDT=$$ENDTC^PSGMI(+RNDT),PSJL=$$SETSTR^VALM1("Renewed: "_PSGRNDT,PSJL,56,32)
"RTN","PSJLMUDE",40,0)
 D SETTMP
"RTN","PSJLMUDE",41,0)
 I PSGORD]"" S PSJBCMA=$$BCMALG^PSJUTL2(PSGP,PSGORD)
"RTN","PSJLMUDE",42,0)
 I $G(PSJBCMA)]"" S PSJL=$$SETSTR^VALM1(PSJBCMA,PSJL,1,52)
"RTN","PSJLMUDE",43,0)
 S PSJL=$$SETSTR^VALM1($S($D(PSGEFN(5)):$E(" *",PSGEFN(5)+1)_"(5)",1:"     ")_" Stop: "_$P(PSGFDN,U,2),PSJL,54,26) D SETTMP D:$G(PSGOEEF(25))!($G(PSGOEEF(34))) HILITE(5)
"RTN","PSJLMUDE",44,0)
 S PSJL=$S($D(PSGEFN(6)):$E(" *",PSGEFN(6)+1)_"(6)",1:"   "),PSJL=$$SETSTR^VALM1("Schedule Type: "_PSGSTN,PSJL,6,45) D:$G(PSGOEEF(7)) HILITE(6)
"RTN","PSJLMUDE",45,0)
 I $G(PSJORD)["P",$G(PSGRDTX(+$G(PSJORD),"PSGRFD")),$P($G(PSGFDN),U,2) S PSGRFDN=$$ENDTC^PSGMI(PSGRDTX(+PSJORD,"PSGRFD")),PSJL=$$SETSTR^VALM1("Calc Stop: "_PSGRFDN,PSJL,54,26) D
"RTN","PSJLMUDE",46,0)
 . I PSGFD'=PSGRDTX(+PSJORD,"PSGRFD") D CNTRL^VALM10(7,54,80,IORVON,IORVOFF)
"RTN","PSJLMUDE",47,0)
 D SETTMP
"RTN","PSJLMUDE",48,0)
 S PSGSMN=$P("NO^YES",U,PSGSM+1)
"RTN","PSJLMUDE",49,0)
 S PSJL=$S($D(PSGEFN(8)):$E(" *",PSGEFN(8)+1)_"(8)",1:"   "),PSJL=$$SETSTR^VALM1("Schedule: "_PSGSCH_$G(SCHMSG),PSJL,11,68) D SETTMP D:$G(PSGOEEF(26)) HILITE(8)
"RTN","PSJLMUDE",50,0)
 S PSJL=$S($D(PSGEFN(9)):$E(" *",PSGEFN(9)+1)_"(9)",1:"   "),PSJL=$$SETSTR^VALM1("Admin Times: "_PSGAT,PSJL,8,71) D SETTMP D:'$G(PSGNOHI)&($G(PSGOEEF(39))!($G(PSGOEEF(41)))) HILITE(9) ;*315
"RTN","PSJLMUDE",51,0)
 I +$G(PSGRF)>1 N PSGRMVD S PSGRMVD=$S(+$G(PSGRMVT):PSGRMVT,1:"") S PSJL=$$SETSTR^VALM1("Removal Times: "_PSGRMVD,PSJL,6,71) D SETTMP ;*315
"RTN","PSJLMUDE",52,0)
 ;
"RTN","PSJLMUDE",53,0)
 S PSJL=$S($D(PSGEFN(10)):$E(" *",PSGEFN(10)+1)_"(10)",1:"   "),PSJL=$$SETSTR^VALM1("Provider: "_PSGPRN,PSJL,11,68) D:$G(PSGOEEF(1)) HILITE(10) D SETTMP
"RTN","PSJLMUDE",54,0)
 S PSJL=$S($D(PSGEFN(11)):$E(" *",PSGEFN(11))_" (11)",1:"   ")_" Special Instructions"_$S($P(PSGSI,"^",2)=1:"!: ",1:": ") D
"RTN","PSJLMUDE",55,0)
 .I '$D(^PS(53.45,DUZ,5,1)),$G(PSGORD) D GETSI^PSJBCMA5(PSGP,PSGORD)
"RTN","PSJLMUDE",56,0)
 .I '$P($G(^PS(53.45,DUZ,5,0)),"^",3) S PSJL=PSJL_$P($G(PSGSI),"^") D PTXT^PSJLMPRU(PSJL,"PSJUDE",1,80) Q
"RTN","PSJLMUDE",57,0)
 .S PSJL=PSJL_" (see below)" D SETTMP N I S I=0 F J=1:1 S I=$O(^PS(53.45,DUZ,5,I)) Q:'I  S PSJL="      "_^PS(53.45,DUZ,5,I,0) D SETTMP
"RTN","PSJLMUDE",58,0)
 S PSJL="" D SETTMP D:$G(PSGOEEF(8)) HILITE(11)
"RTN","PSJLMUDE",59,0)
 ; E3R 16130
"RTN","PSJLMUDE",60,0)
 I $O(^PS(53.45,PSJSYSP,2,1)) F  S PSJL="" D SETTMP Q:PSJLN>15
"RTN","PSJLMUDE",61,0)
 S PSJL=$S($D(PSGEFN(12)):$E(" *",PSGEFN(12))_" (12)",1:"   ")_" Dispense Drug",PSJL=$$SETSTR^VALM1("U/D",PSJL,54,60),PSJL=$$SETSTR^VALM1("Inactive Date",PSJL,65,16) D SETTMP,CNTRL^VALM10(PSJLN-1,1,80,IOUON,IOUOFF,0)
"RTN","PSJLMUDE",62,0)
 NEW PSJX,PSJDLINE
"RTN","PSJLMUDE",63,0)
 F Q=0:0 S Q=$O(^PS(53.45,PSJSYSP,2,Q)) Q:'Q  S ND=$G(^(Q,0)) D
"RTN","PSJLMUDE",64,0)
 .S D=$P(ND,"^"),PSGID=$P(ND,"^",3) I PSGID S PSGID=$$ENDTC^PSGMI(PSGID)
"RTN","PSJLMUDE",65,0)
 .S D=$S(D="":"NOT FOUND",'$D(^PSDRUG(D,0)):D,$P(^(0),"^")]"":$P(^(0),"^"),1:D_";PSDRUG(")
"RTN","PSJLMUDE",66,0)
 .S PSJL="      "_D_$$DDNF^PSJDIN(+ND),PSJL=$$SETSTR^VALM1($S($P(ND,"^",2):$S($P(ND,"^",2)=.5:"1/2",$P(ND,"^",2)=.25:"1/4",1:$P(ND,"^",2)),$P(ND,"^",2)=0:0,1:1),PSJL,54,63) S:PSGID PSJL=$$SETSTR^VALM1(PSGID,PSJL,65,16) D  D SETTMP
"RTN","PSJLMUDE",67,0)
 ..S PSJX=$G(PSJX)+1
"RTN","PSJLMUDE",68,0)
 ..S PSJDLINE=$S($P(^PS(53.45,PSJSYSP,2,0),U,3)>1:16,1:13) ;*228 - Highlight multiple dispense drugs
"RTN","PSJLMUDE",69,0)
 ..I $G(PSGOEEF(109)) D CNTRL^VALM10(PSJDLINE+PSJX,7,73,IORVON_IOBON,IORVOFF_IOBOFF,0)
"RTN","PSJLMUDE",70,0)
 I $S(PSGORD["P":$O(^PS(53.1,+$G(PSGORD),12,0)),1:$O(^PS(55,PSGP,5,+PSGORD,12,0))) S PSJL="Provider Comments:" D SETTMP S PSJL="" D
"RTN","PSJLMUDE",71,0)
 .F Q=0:0 S Q=$S(PSGORD["P":$O(^PS(53.1,+$G(PSGORD),12,Q)),1:$O(^PS(55,PSGP,5,+PSGORD,12,Q))) Q:'Q  S PSJL=$G(^(Q,0)) D SETTMP
"RTN","PSJLMUDE",72,0)
 D SETTMP S PSJL=$$SETSTR^VALM1($S($D(PSGEFN(7)):$E(" *",PSGEFN(7)+1)_"(7)",1:"   ")_"Self Med: "_PSGSMN,PSJL,1,24)
"RTN","PSJLMUDE",73,0)
 S:PSGSM&PSGHSM PSJL=$$SETSTR^VALM1("  (HS)",PSJL,16,7) D SETTMP D:$G(PSGOEEF(5)) HILITE(7)
"RTN","PSJLMUDE",74,0)
 D SETTMP S PSJL="Entry By: "_PSGEBN,PSJL=$$SETSTR^VALM1("Entry Date: "_$P(PSGLIN,U,2),PSJL,51,39) D SETTMP
"RTN","PSJLMUDE",75,0)
 I $G(PSGLRN) D SETTMP S PSJL="Renewed By: "_$$ENNPN^PSGMI($P(PSGLRN,"^",2)) D SETTMP
"RTN","PSJLMUDE",76,0)
 D SETTMP S PSJL="(13)"_" Comments:"
"RTN","PSJLMUDE",77,0)
 D:'$O(^PS(53.45,PSJSYSP,1,0)) SETTMP
"RTN","PSJLMUDE",78,0)
 D SETTMP F Q=0:0 S Q=$O(^PS(53.45,PSJSYSP,1,Q)) Q:'Q  S PSJWPL=PSJL_$S($E(PSJL)=" ":"",1:" ")_$G(^(Q,0)),PSJL="" D DISPLAY
"RTN","PSJLMUDE",79,0)
 D SETTMP
"RTN","PSJLMUDE",80,0)
 I PSGORD["P",($P($G(^PS(53.1,+PSGORD,0)),U,9)="P"),$O(^PS(53.1,+PSGORD,10,0)) D
"RTN","PSJLMUDE",81,0)
 .D SETTMP S PSJL="CPRS Order Checks:" D SETTMP
"RTN","PSJLMUDE",82,0)
 .F Q=0:0 S Q=$O(^PS(53.1,+PSGORD,10,Q)) Q:'Q  D
"RTN","PSJLMUDE",83,0)
 ..;S PSJL="" D SETTMP S PSJL=$G(^PS(53.1,+PSGORD,10,Q,0)) D SETTMP
"RTN","PSJLMUDE",84,0)
 ..S PSJL="" D SETTMP
"RTN","PSJLMUDE",85,0)
 ..D FORMATTX($G(^PS(53.1,+PSGORD,10,Q,0)))
"RTN","PSJLMUDE",86,0)
 ..S PSJL="Overriding Provider: "_$P($G(^PS(53.1,+PSGORD,10,Q,1)),U) D SETTMP
"RTN","PSJLMUDE",87,0)
 ..S PSJL="Overriding Reason: " F X=0:0 S X=$O(^PS(53.1,+PSGORD,10,Q,2,X)) Q:'X   D
"RTN","PSJLMUDE",88,0)
 ...S PSJL=PSJL_$G(^PS(53.1,+PSGORD,10,Q,2,X,0)) D SETTMP S PSJL="                   "
"RTN","PSJLMUDE",89,0)
ACTFLG ;
"RTN","PSJLMUDE",90,0)
 S ND4=$S(PSGORD["P":$G(^PS(53.1,+PSGORD,4)),1:$G(^PS(55,PSGP,5,+PSGORD,4)))
"RTN","PSJLMUDE",91,0)
 S AT="",Y="12,13,D,18,19,H1,22,23,H0,15,16,R" F X=1:3:12 I $P(ND4,"^",$P(Y,",",X)),$P(ND4,"^",$P(Y,",",X+1)) S AT=$P(Y,",",X+2) Q
"RTN","PSJLMUDE",92,0)
 I AT="",'$P(ND4,"^",$S($P(PSJSYSU,";",3)>1:3,1:1)) S AT="V"_$S($P(ND4,"^",18):"H1",$P(ND4,"^",22):"H0",$P(ND4,"^",15):"R",1:"")
"RTN","PSJLMUDE",93,0)
 I AT]"" D
"RTN","PSJLMUDE",94,0)
 .S PSJL="" D SETTMP
"RTN","PSJLMUDE",95,0)
 .S PSJL="ORDER "_$S(AT["V":"NOT VERIFIED"_$S($P(AT,"V",2)="":"",1:" ("_$S(AT["H1":"ON HOLD",AT["H0":"OFF HOLD",1:"RENEWAL")_")"),1:"MARKED TO BE "_$S(AT["D":"CANCELLED",AT["H1":"PLACED ON HOLD",AT["H0":"TAKEN OFF OF HOLD",1:"RENEWED"))
"RTN","PSJLMUDE",96,0)
 I AT'["V",AT["H1",$D(^PS(55,PSGP,5.1)) S AT=^(5.1) I $P(AT,"^",7),$P(AT,"^",10)]"" S PSJL=PSJL_"  ("_$P(AT,"^",10)_")"
"RTN","PSJLMUDE",97,0)
 D SETTMP
"RTN","PSJLMUDE",98,0)
 S VALMCNT=PSJLN-1
"RTN","PSJLMUDE",99,0)
 K PSGSMN,Q,Y,Y1,Y2,PSGLRN
"RTN","PSJLMUDE",100,0)
 S VALM("TITLE")=PSGSTAT_" UNIT DOSE "_$S((PSGSTAT="PENDING")&($G(PSGPRIO)]""):"("_PSGPRIO_")",$G(PSGPRIO)="DONE":"("_PSGPRIO_")",1:"") I $D(PSJLMP2) S VALMBG=16 K PSJLMP2
"RTN","PSJLMUDE",101,0)
TEST ;
"RTN","PSJLMUDE",102,0)
 I $G(PSGPFLG) S VALMSG="INVALID ORDERABLE ITEM"
"RTN","PSJLMUDE",103,0)
 I $G(PSGDI) S VALMSG=$S($G(VALMSG)="":"INVALID",1:VALMSG_",")_" DISPENSE DRUG"
"RTN","PSJLMUDE",104,0)
 I $G(PSGPI) S VALMSG=$S($G(VALMSG)="":"INVALID",1:VALMSG_",")_" PROVIDER"
"RTN","PSJLMUDE",105,0)
 Q
"RTN","PSJLMUDE",106,0)
DISPLAY ;
"RTN","PSJLMUDE",107,0)
 S PSJL=PSJWPL D SETTMP
"RTN","PSJLMUDE",108,0)
 Q
"RTN","PSJLMUDE",109,0)
 ;
"RTN","PSJLMUDE",110,0)
SETTMP ;
"RTN","PSJLMUDE",111,0)
 S ^TMP("PSJUDE",$J,PSJLN,0)=PSJL,PSJLN=PSJLN+1,PSJL=""
"RTN","PSJLMUDE",112,0)
 Q
"RTN","PSJLMUDE",113,0)
 ;
"RTN","PSJLMUDE",114,0)
HILITE(FLD) ; 
"RTN","PSJLMUDE",115,0)
 N COL,LIN,WID,X
"RTN","PSJLMUDE",116,0)
 S X="$T("_FLD_"^PSJLMUDE)",@("X="_X),X=$P(X,";;",2),LIN=+X,COL=$P(X,",",2),LAB=$P(X,",",3),X=$P(X,",",4),WID=(LAB+$L(@X))
"RTN","PSJLMUDE",117,0)
 I $G(PSGRF),FLD>9 S LIN=LIN+1 ;COMPENSATE FOR REMOVAL TIMES
"RTN","PSJLMUDE",118,0)
 I FLD=7 S LIN=+$G(PSJLN)-1 Q:LIN<13
"RTN","PSJLMUDE",119,0)
 D CNTRL^VALM10(LIN,COL,WID,IORVON_IOBON,IORVOFF_IOBOFF,0)
"RTN","PSJLMUDE",120,0)
 Q
"RTN","PSJLMUDE",121,0)
 ;
"RTN","PSJLMUDE",122,0)
FORMATTX(PSJX) ;
"RTN","PSJLMUDE",123,0)
 NEW PSJX1,Y,Y1
"RTN","PSJLMUDE",124,0)
 S PSJX1=""
"RTN","PSJLMUDE",125,0)
 F Y=1:1:$L(PSJX," ") S Y1=$P(PSJX," ",Y) D
"RTN","PSJLMUDE",126,0)
 . I ($L(PSJX1)+$L(Y1)+1)>79 S:$E(PSJX1,1,1)=" " PSJX1=$E(PSJX1,2,$L(PSJX1)) S PSJL=PSJX1,PSJX1="" D SETTMP
"RTN","PSJLMUDE",127,0)
 . S PSJX1=PSJX1_Y1_" "
"RTN","PSJLMUDE",128,0)
 I PSJX1]"" S PSJL=PSJX1 D SETTMP
"RTN","PSJLMUDE",129,0)
 K PSJX1
"RTN","PSJLMUDE",130,0)
 Q
"RTN","PSJLMUDE",131,0)
 ;
"RTN","PSJLMUDE",132,0)
1 ;;1,5,16,PSGPDN
"RTN","PSJLMUDE",133,0)
2 ;;3,5,16,PSGDO
"RTN","PSJLMUDE",134,0)
3 ;;4,58,7,PSGSDN
"RTN","PSJLMUDE",135,0)
4 ;;5,10,11,PSGMRN
"RTN","PSJLMUDE",136,0)
5 ;;6,59,6,PSGFDN
"RTN","PSJLMUDE",137,0)
6 ;;7,6,15,PSGSTN
"RTN","PSJLMUDE",138,0)
7 ;;18,5,14,PSGSMN
"RTN","PSJLMUDE",139,0)
8 ;;8,11,12,PSGSCH
"RTN","PSJLMUDE",140,0)
9 ;;9,8,13,PSGAT
"RTN","PSJLMUDE",141,0)
10 ;;10,11,10,PSGPRN
"RTN","PSJLMUDE",142,0)
11 ;;11,7,22,PSGSI
"RTN","PSJLMUDE",143,0)
ENKILL ;
"RTN","PSJLMUDE",144,0)
 K PSGNOHI,PSGAT,PSGEB,PSGEFN,PSGFD,PSGHSM,PSGNEFD,PSGNESD,PSGOEEF,PSGOEER,PSGOFD,PSGOHSM,PSGOMR,PSGOMRN,PSGOPD,PSGOPDN,PSGOPR,PSGOSCH,PSGOSD,PSGOSM,PSGOST,PSGPD,PSGPDN,PSGPR,PSGSD,PSGSM Q
"RTN","PSJOE")
0^41^B105816972^B103230773
"RTN","PSJOE",1,0)
PSJOE ;BIR/MLM - INPATIENT ORDER ENTRY ;23 Jun 98  1:46 PM
"RTN","PSJOE",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**7,26,29,33,42,50,56,72,58,85,95,80,110,111,133,140,151,149,181,252,281,315**;16 DEC 97;Build 73
"RTN","PSJOE",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PSJOE",4,0)
 ; Reference to ^PS(55 is supported by DBIA #2191.
"RTN","PSJOE",5,0)
 ; Reference to EN^VALM is supported by DBIA #10118.
"RTN","PSJOE",6,0)
 ; Reference to FULL^VALM1 is supported by DBIA #10116.
"RTN","PSJOE",7,0)
 ; Reference to PAUSE^VALM1 is supported by DBIA #10116.
"RTN","PSJOE",8,0)
 ; Reference to ^PSSLOCK is supported by DBIA #2789
"RTN","PSJOE",9,0)
 ; Reference to ^DPT( is supported by DBIA #10035.
"RTN","PSJOE",10,0)
 ; Reference to ^ORCFLAG is supported by DBIA #3620.
"RTN","PSJOE",11,0)
 ; Reference to ^SDAMA203 is supported by DBIA #4133.
"RTN","PSJOE",12,0)
 ; Reference to ^TMP("PSODAOC" is supported by DBIA #6071.
"RTN","PSJOE",13,0)
 ;
"RTN","PSJOE",14,0)
EN ; Start Inpatient LM OE
"RTN","PSJOE",15,0)
 N PSJLK,PSJNEWOE,PSJLMCON,PSJPROT,XQORS,VALMEVL D ENCV^PSGSETU,^PSIVXU
"RTN","PSJOE",16,0)
 I $D(XQUIT) K XQUIT G DONE
"RTN","PSJOE",17,0)
 K PSGVBY,PSJPR S (PSJOL,PSJACOK,PSGOP,PSGNEF,PSGOEAV,PSGPXN)="" L +^PS(53.45,PSJSYSP):1 E  D LOCKERR^PSJOE G DONE^PSJOE
"RTN","PSJOE",18,0)
 F  S (PSJLMCON,PSGPTMP)=0 D ^PSJP,HK Q:PSGP'>0  S PSJPROT=3,DFN=PSGP D ^PSJAC D  I PSJLK D UL^PSSLOCK(PSGP)
"RTN","PSJOE",19,0)
 .K ^TMP("PSJ",$J)
"RTN","PSJOE",20,0)
 .S PSJLK=$$L^PSSLOCK(PSGP,1) I 'PSJLK W !,$C(7),$P(PSJLK,U,2) Q
"RTN","PSJOE",21,0)
 .K PSJLMPRO D EN^VALM("PSJ LM BRIEF PATIENT INFO")
"RTN","PSJOE",22,0)
 .N NXTPT S NXTPT=0 F  Q:$G(NXTPT)  D
"RTN","PSJOE",23,0)
 ..K PSGRDTX
"RTN","PSJOE",24,0)
 ..I $G(PSJLMCON)!$G(PSJNEWOE) D
"RTN","PSJOE",25,0)
 ...S PSJOL=$S(",S,L,"[(","_$G(PSJOL)_","):PSJOL,1:"S")
"RTN","PSJOE",26,0)
 ...S PSJLMPRO=1,PSJLMCON=1,PSJNEWOE=0 D EN^VALM("PSJ LM OE")
"RTN","PSJOE",27,0)
 ..I $G(PSJNEWOE)!($G(VALMBCK)="Q") S PSJNEWOE=0 Q
"RTN","PSJOE",28,0)
 ..I $G(PSJLMCON)&$G(PSJLMPRO)&'$D(^TMP("PSJ",$J)) D  Q
"RTN","PSJOE",29,0)
 ...S PSJLMCON=0,PSJLMPRO=0 D EN^VALM("PSJ LM BRIEF PATIENT INFO")
"RTN","PSJOE",30,0)
 ...I $G(PSJNEWOE) S NXTPT=0 Q
"RTN","PSJOE",31,0)
 ...S NXTPT=1
"RTN","PSJOE",32,0)
 ..S NXTPT=1,PSJNEWOE=0
"RTN","PSJOE",33,0)
 .S PSJOL="S"
"RTN","PSJOE",34,0)
 .I $G(PSGPXN) I $P(PSJSYSW0,U,29)]""!($G(PSJCOM)) S PSGPXPT=PSGP D  K PSGPXPT S PSGPXN=0
"RTN","PSJOE",35,0)
 ..N DFN,PSGP,PSJPXDP
"RTN","PSJOE",36,0)
 ..I $P(PSJSYSW0,U,29)="" S PSJPDXP=1 D
"RTN","PSJOE",37,0)
 ...;N IO,ION,IOS D HOME^%ZIS S $P(PSJSYSW0,U,29)=+$G(IOS)
"RTN","PSJOE",38,0)
 ...D HOME^%ZIS S $P(PSJSYSW0,U,29)=+$G(IOS)
"RTN","PSJOE",39,0)
 ..S (PSGP,DFN)=PSGPXPT D ^PSGPER S:$G(PSJPDXP) $P(PSJSYSW0,U,29)="" K PSJPDXP
"RTN","PSJOE",40,0)
 .D ENCV^PSGSETU,^PSIVXU
"RTN","PSJOE",41,0)
 K PSJLMPRO,^TMP("PSJPRO",$J),^TMP("PSJ",$J),^TMP("PSJON",$J)
"RTN","PSJOE",42,0)
DONE ;
"RTN","PSJOE",43,0)
 ; -- RTC 198753 - correct typo - r PSJALGSV w PSJAGYSV
"RTN","PSJOE",44,0)
 K PSJAGYSV,PSJEXCPT,PSJOCER,^TMP($J,"PSJPRE"),^TMP("PSODAOC",$J),^TMP("PSJDAOC",$J)
"RTN","PSJOE",45,0)
 K AC,ACTION,D1,D2,MI,N,ON,P3,PNOW,PSIVAT,PSIVLN,PSIVSTR L -^PS(53.45,PSJSYSP)
"RTN","PSJOE",46,0)
 K DA,DRG,NE,PSGCF,PSGCANFL,PSGNEDFD,PSGNEF,PSGNEFD,PSGNEPR,PSGNESD,PSJACOK,PSJOE,PSJOECNT,PSJOEPF,PSJORD,PSGOEA,PSGOEAV,PSGOL,PSGOS,PSGON,PSGOP,PSGORD,PSGS0XT,PSGS0Y,RCT,ST,WD,XREF,Z,PSJIVORF,PSJIVPCL
"RTN","PSJOE",47,0)
 K PSGOEORF,PSIVREA,PSJOPC,PSJORL,PSJORPCL,PSJORTOI,RF,WSCHADM,PSJLM,PSJCT
"RTN","PSJOE",48,0)
 K DIU,DRGI,FLAG,FQC,ND2,PRI,PSGOE,PSGPRI,PSGSDN,PSGOEDMR,PSGOEPR,PSGPTS,PSGTOL,PSGTOO,PSGUOW,PSJIVOF,PSJOCNT,PSJON,PSJORQF,PSJORTOU,PSJORVP
"RTN","PSJOE",49,0)
 K PSIVENO,PSGRMV,PSGRMVT,PSGDUR,PSGRF,ND2P1 ;*315
"RTN","PSJOE",50,0)
 G:$G(PSGPXN) ^PSGPER1 D ENIVKV^PSGSETU
"RTN","PSJOE",51,0)
 Q
"RTN","PSJOE",52,0)
HK ; Housekeeping (a nice COBOL term)
"RTN","PSJOE",53,0)
 I PSGOP,PSGOP'=PSGP D
"RTN","PSJOE",54,0)
 .N PSJACPF,PSJACNWP,PSJPWD,PSJSYSL,PSJSYSW,PSJSYSW0,DFN,VAIN,VAERR S DFN=PSGOP
"RTN","PSJOE",55,0)
 .D INP^VADPT S PSJPWD=+VAIN(4) I PSJPWD S PSJACPF=10 D WP^PSJAC D:$P(PSJSYSL,"^",2)]"" ENQL^PSGLW
"RTN","PSJOE",56,0)
 Q:PSGP<0
"RTN","PSJOE",57,0)
 S (DFN,PSGOP)=PSGP,X=""
"RTN","PSJOE",58,0)
 Q
"RTN","PSJOE",59,0)
SELECT ; Select order from list
"RTN","PSJOE",60,0)
 ;Variable PSJOCDSC is used in Complex order dosing checks
"RTN","PSJOE",61,0)
 N PSGLMT,PSGODDD,PSJLMQT,PSJLMFIN,PSJUDPRF,PSGRDTX,PSJOCDSC,PSJAGYSV K ^TMP("PSJCOM",$J),^TMP("PSJCOM2",$J),PSJSTARI,^TMP("PSODAOC",$J),^TMP("PSJDAOC",$J)
"RTN","PSJOE",62,0)
 K PSGDUR,PSGRMVT,PSGRMV,PSGRF,ND2P1 ;*315
"RTN","PSJOE",63,0)
 S PSGONC=1,PSGLMT=^TMP("PSJPRO",$J,0) D ENASR^PSGON
"RTN","PSJOE",64,0)
 I "^"[X S VALMQUIT=1 Q
"RTN","PSJOE",65,0)
 S PSJLM=1,PSJSEL=0 F  S PSJSEL=$O(PSGODDD(PSJSEL)) Q:'PSJSEL!($G(Y)<0)  F PSJSEL1=1:1:$L(PSGODDD(PSJSEL),",")-1 D
"RTN","PSJOE",66,0)
 .K PSJOCDSC
"RTN","PSJOE",67,0)
 .S PSJORD=$G(^TMP("PSJON",$J,+$P(PSGODDD(PSJSEL),",",PSJSEL1))) D:PSJORD=+PSJORD SELECT^PSJOEA Q:PSJORD=""!($G(Y)<0)  Q:PSJORD=+PSJORD  D
"RTN","PSJOE",68,0)
 ..Q:('$$LS^PSSLOCK(PSGP,PSJORD))
"RTN","PSJOE",69,0)
 ..Q:PSJORD=+PSJORD
"RTN","PSJOE",70,0)
 ..S PSGORD=""
"RTN","PSJOE",71,0)
 ..D DISACTIO(PSGP,PSJORD,"") S:PSJORD["V" PSJORD=ON
"RTN","PSJOE",72,0)
 ..D UNL^PSSLOCK(PSGP,PSJORD) Q:$G(Y)<0
"RTN","PSJOE",73,0)
 S VALMBCK="Q"
"RTN","PSJOE",74,0)
 K PSJLM,PSJOCDSC
"RTN","PSJOE",75,0)
 Q
"RTN","PSJOE",76,0)
DISACTIO(DFN,PSJORD,PSJPNV)       ; Display UD order and allow actions.
"RTN","PSJOE",77,0)
 ; PSJORD - Order #_location Code (P:53.1,V:55.01,U:55.06)
"RTN","PSJOE",78,0)
 ; PSJPNV - Invoked from Pending/NV option; (gets different hidden menu)
"RTN","PSJOE",79,0)
 ; PSJDSVFY - Flag if non-vf order was edited
"RTN","PSJOE",80,0)
 ; PSJENHOC=1 if DI,DT were display. This will be used by dosing OC to check if error messages should display or not
"RTN","PSJOE",81,0)
 ; PSJAGYSV=1 If UD was edited
"RTN","PSJOE",82,0)
 ;N PSGP,PSJIVFLG,PSGSDX,PSGFDX,PSJXX1,ON55,PSJDSVFY,PSJENHOC,PSJAGYSV
"RTN","PSJOE",83,0)
 N PSGP,PSJIVFLG,PSGSDX,PSGFDX,PSJXX1,ON55,PSJDSVFY,PSJENHOC,PSIVENO
"RTN","PSJOE",84,0)
 K PSGDUR,PSGRMVT,PSGRMV,PSGRF,ND2P1 ;*315
"RTN","PSJOE",85,0)
 D OLDCOM^PSJOE0(DFN,PSJORD)
"RTN","PSJOE",86,0)
 S PSGP=DFN D ENIV^PSJAC I PSJORD["V" D EN^PSJLIORD(DFN,PSJORD) Q
"RTN","PSJOE",87,0)
 D GETUD^PSJLMGUD(DFN,PSJORD)
"RTN","PSJOE",88,0)
 S PSGOEAV=$P(PSJSYSP0,"^",9)&PSJSYSU
"RTN","PSJOE",89,0)
 S:$G(PSJTUD) PSGPD=$G(PSJCOI),PSGPDN=$$OINAME^PSJLMUTL(+PSGPD)
"RTN","PSJOE",90,0)
 K PSGOENG I '$D(PSGPRF) D  Q:$G(PSGOENG)
"RTN","PSJOE",91,0)
 . I PSJORD["U" L +^PS(55,PSGP,5,+PSJORD):1 E  S PSGOENG=1
"RTN","PSJOE",92,0)
 . I PSJORD["P" L +^PS(53.1,+PSJORD):1 E  S PSGOENG=1
"RTN","PSJOE",93,0)
 . I $G(PSGOENG) W !,"This order is being edited by another terminal.",! S PSGOENG=1 K DIR S DIR(0)="E" D ^DIR K DIR Q
"RTN","PSJOE",94,0)
 S PSGACT=$$ENACTION^PSGOE1(PSGP,PSJORD)
"RTN","PSJOE",95,0)
 I PSJORD["P" S PSJXX1=$G(^PS(53.1,+PSJORD,0)) I PSGP'=$P(PSJXX1,U,15)!(DFN'=$P(PSJXX1,U,15)) L -^PS(53.1,+PSJORD) Q
"RTN","PSJOE",96,0)
 I PSJORD["P" D  S PSJXX1=$P($G(^PS(53.1,+PSJORD,0)),U,9) I $S($G(PSJIVFLG):1,$G(Y)<0:1,"PADE"[PSJXX1:1,1:0) L -^PS(53.1,+PSJORD) Q
"RTN","PSJOE",97,0)
 .I $P(PSJXX1,U,9)="N",($P(PSJXX1,U,4)'="U") D  Q
"RTN","PSJOE",98,0)
 .. S P("PON")=PSJORD,PSIVFLG=1
"RTN","PSJOE",99,0)
 .. N ON S ON=PSJORD D VF^PSIVORC2
"RTN","PSJOE",100,0)
 .I $P(PSJXX1,U,9)="P" D  Q
"RTN","PSJOE",101,0)
 ..S:$G(PSJTUD) $P(PSJXX1,U,4)="U"
"RTN","PSJOE",102,0)
 ..I $P(PSJXX1,U,4)="U" D  Q:$G(PSJIVFLG)
"RTN","PSJOE",103,0)
 ... N VAIP S CLINIC=$G(^PS(53.1,+PSJORD,"DSS")),APPT=$P(CLINIC,"^",2),CLINIC=$P(CLINIC,"^") I $$PATCH^XPDUTL("SD*5.3*285"),$$SDIMO^SDAMA203(CLINIC,DFN)>-1 Q
"RTN","PSJOE",104,0)
 ... Q:'PSJPDD  W !!,"Cannot process an Out-patient Unit Dose order for ",$P($G(^DPT(+PSGP,0)),U) D PAUSE^VALM1 S PSJIVFLG=1
"RTN","PSJOE",105,0)
 ..NEW PSGRSD,PSGRSDN,PSGRFD,PSGRFDN
"RTN","PSJOE",106,0)
 ..D REQDT^PSJLIVMD(PSJORD)
"RTN","PSJOE",107,0)
 ..I $P(PSJXX1,U,4)="U",($G(PSGSCH)="") W !!,"Invalid schedule, can't finish this order" D PAUSE^VALM1 Q
"RTN","PSJOE",108,0)
 ..I $P(PSJXX1,U,4)="U" N PSJLM,PSJOCFG S PSJLM=1,PSGORD=PSJORD,PSJOCFG="FN UD" D START^PSGOEF,ENSFE^PSGOEE0(PSGP,PSGORD) S:$G(PSJTUD) PSJOCFG="FN UD" D @$S($G(PSJTUD):"FINISH^PSGOEF",1:"EN^VALM(""PSJ LM PENDING EDIT"")") K PSJOCFG Q
"RTN","PSJOE",109,0)
 ..I $P(PSJXX1,U,4)'="U",PSGP=$P(PSJXX1,U,15),DFN=$P(PSJXX1,U,15) S PSJLYN=PSJORD,PSJOCFG="FN IV" D EN^PSJLIFN S PSJIVFLG=1 K PSJLYN,PSJMAI,PSJOCFG
"RTN","PSJOE",110,0)
 I $G(PSIVFLG) K PSIVFLG Q
"RTN","PSJOE",111,0)
 S PSGACT=$$ENACTION^PSGOE1(PSGP,PSJORD),PSGOEEF=0 D GETUD^PSJLMGUD(PSGP,PSJORD),ENSFE^PSGOEE0(PSGP,PSJORD),EN^VALM("PSJ LM UD ACTION")
"RTN","PSJOE",112,0)
 I PSJORD["P" L -^PS(53.1,+PSJORD)
"RTN","PSJOE",113,0)
 I PSJORD["U" L -^PS(55,PSGP,5,+PSJORD)
"RTN","PSJOE",114,0)
 ;Send SN to CPRS if auto-verify OFF and Order Set Entry and no 21st piece
"RTN","PSJOE",115,0)
 S PSGOEAV=$P(PSJSYSP0,"^",9)&PSJSYSU
"RTN","PSJOE",116,0)
 I $D(PSGOES),'PSGOEAV,$D(PSGORD),PSGORD["P",$P($G(^PS(53.1,+PSGORD,0)),"^",21)']"" D ORSET^PSGOETO1
"RTN","PSJOE",117,0)
 I $G(PSGOEAV),($G(PSGOES)=1) D SETOC ;Store allergy for order set /w auto vf 
"RTN","PSJOE",118,0)
 I '$G(PSGOEAV),($G(PSJORD)["P"),$S($G(PSJAGYSV):1,($G(PSJOCFG)="NEW UD"):1,1:0) D SETOC
"RTN","PSJOE",119,0)
 D UNL^PSSLOCK(PSGP,PSJORD)
"RTN","PSJOE",120,0)
 Q
"RTN","PSJOE",121,0)
SETOC ;
"RTN","PSJOE",122,0)
 ;RTC 178789 
"RTN","PSJOE",123,0)
 S ^TMP("PSODAOC",$J,"IP IEN")=PSJORD
"RTN","PSJOE",124,0)
 D SETOC^PSJNEWOC(PSJORD)
"RTN","PSJOE",125,0)
 K ^TMP("PSODAOC",$J),^TMP("PSJDAOC",$J),PSJAGYSV,PSJOCFG
"RTN","PSJOE",126,0)
 Q
"RTN","PSJOE",127,0)
EDIT(PSGP,PSGORD,PROMPT) ;
"RTN","PSJOE",128,0)
 I "DE"[$$GTSTATUS(PSGP,PSGORD) W !,"This order may not be edited." D PAUSE^VALM1 Q
"RTN","PSJOE",129,0)
 I PSGACT'["E" W !,"This order may not be edited." D PAUSE^VALM1 Q
"RTN","PSJOE",130,0)
 N PSJEDITO S PSJEDITO=1
"RTN","PSJOE",131,0)
 S PSJAGYSV=1 ;Flag to store allergy data in 100.05.
"RTN","PSJOE",132,0)
 S PSGNEDFD="" D HOLDHDR,@$S('PROMPT:"ENEFA2^PSGON",1:"ENEFA^PSGON") I 'Y D ABORT^PSGOEE Q
"RTN","PSJOE",133,0)
 I PSGORD["P" D ENF^PSGOEE Q
"RTN","PSJOE",134,0)
 D ACT^PSGOEE
"RTN","PSJOE",135,0)
 Q
"RTN","PSJOE",136,0)
RENEW(PSGP,PSGORD) ;
"RTN","PSJOE",137,0)
 ;PSJOCFG - If defined, it's for new order, renew or copy. ^PSJOCDSD using this flag to not display drug error.
"RTN","PSJOE",138,0)
 NEW PSJOCFG
"RTN","PSJOE",139,0)
 S PSJOCFG="RENEW UD"
"RTN","PSJOE",140,0)
 D HOLDHDR
"RTN","PSJOE",141,0)
 I 'PSJSYSU,$P($G(^PS(55,PSGP,5,+PSGORD,4)),U,15),$P($G(^(4)),U,16) W !!,"This order is already marked for renewal!" D PAUSE^VALM1 S VALMBCK="R" Q
"RTN","PSJOE",142,0)
 I 'PSGRRF D ^PSGOER K PSJOCFG Q
"RTN","PSJOE",143,0)
 D ^PSGOERI
"RTN","PSJOE",144,0)
 K PSJOCFG
"RTN","PSJOE",145,0)
 Q
"RTN","PSJOE",146,0)
GTSTATUS(DFN,ON)   ;
"RTN","PSJOE",147,0)
 I ON["P" Q $P($G(^PS(53.1,+ON,0)),U,9)
"RTN","PSJOE",148,0)
 I ON["U" Q $P($G(^PS(55,DFN,5,+ON,0)),U,9)
"RTN","PSJOE",149,0)
 Q $P($G(^PS(55,DFN,"IV",+ON,0)),U,17)
"RTN","PSJOE",150,0)
DC(DFN,PSJORD) ; DC IV, UD, or pending orders.
"RTN","PSJOE",151,0)
 D HOLDHDR
"RTN","PSJOE",152,0)
 S X=$$GTSTATUS(DFN,PSJORD) I X="D"!(X="DE")!(X="R") W !,$S(X="R":"This order has a pending renewal and cannot be DISCONTINUED.",1:"This order has already been DISCONTINUED.") D PAUSE^VALM1 Q
"RTN","PSJOE",153,0)
 D ENO^PSGOEC(DFN,PSJORD) ;,GETUD^PSJLMGUD(DFN,PSJORD),INIT^PSJLMUDE(DFN,PSJORD) S VALMBCK="Q"
"RTN","PSJOE",154,0)
 S VALMBCK="Q"
"RTN","PSJOE",155,0)
 Q
"RTN","PSJOE",156,0)
HOLD(DFN,PSJORD) ; Change order's status from ACTIVE<->HOLD
"RTN","PSJOE",157,0)
 D HOLDHDR
"RTN","PSJOE",158,0)
 I PSJORD["V" D H^PSIVOPT(DFN,PSJORD,P(17),P(3))
"RTN","PSJOE",159,0)
 I PSJORD'["V" D H^PSGOE1(DFN,PSJORD)
"RTN","PSJOE",160,0)
 D GETUD^PSJLMGUD(DFN,PSJORD),INIT^PSJLMUDE(DFN,PSJORD) S PSGACT=$$ENACTION^PSGOE1(DFN,PSJORD),VALMBCK="R"
"RTN","PSJOE",161,0)
 Q
"RTN","PSJOE",162,0)
COPY(PSGP,PSGORD)  ; Copy an order (does not discontinue original order)
"RTN","PSJOE",163,0)
 NEW PSJOCFG
"RTN","PSJOE",164,0)
 I $D(PSGCOPY) W !!,"You cannot copy the order at this time" D PAUSE^VALM1 Q
"RTN","PSJOE",165,0)
 I PSGORD["P" W !!,"You cannot copy this "_$S($G(PSGSTAT)]"":PSGSTAT,1:"PENDING IV")_" order." D PAUSE^VALM1 Q
"RTN","PSJOE",166,0)
 I PSGORD["V" D  Q
"RTN","PSJOE",167,0)
 .I $G(PSIVCOPY) W !!,"You cannot copy the order at this time" D PAUSE^VALM1 Q
"RTN","PSJOE",168,0)
 .S PSJOCFG="COPY IV"
"RTN","PSJOE",169,0)
 .D COPY^PSIVOD(PSGP,PSGORD) K PSJOCFG Q
"RTN","PSJOE",170,0)
 Q:'$$HIDDEN^PSJLMUTL("COPY")
"RTN","PSJOE",171,0)
 D ^PSJHVARS
"RTN","PSJOE",172,0)
 I $P($G(^PS(55,PSGP,5,+PSGORD,.2)),U,4)="D",'$P($G(^(4)),"^",3) W !!,"Nurse verified orders with a priority of DONE may not be Copied." D PAUSE^VALM1 Q
"RTN","PSJOE",173,0)
 S PSJOCFG="COPY UD"
"RTN","PSJOE",174,0)
 S PSGOEAV=$P(PSJSYSP0,U,9)&PSJSYSU
"RTN","PSJOE",175,0)
 S PSGCOPY=1
"RTN","PSJOE",176,0)
 D FULL^VALM1,^PSGOD
"RTN","PSJOE",177,0)
 S VALMBCK="R"
"RTN","PSJOE",178,0)
 K PSGCOPY,PSJOCFG
"RTN","PSJOE",179,0)
 S PSGACT=$$ENACTION^PSGOE1(PSGP,PSGORD) ; resets PSGACT after copy
"RTN","PSJOE",180,0)
 I $G(PSGPXN) N PSGTMPXN S PSGTMPXN=PSGPXN
"RTN","PSJOE",181,0)
 D RESTORE^PSJHVARS I $G(PSGTMPXN) S PSGPXN=PSGTMPXN
"RTN","PSJOE",182,0)
 Q
"RTN","PSJOE",183,0)
UPDATE ; Refresh array, actions, & display.
"RTN","PSJOE",184,0)
 D GETUD^PSJLMGUD(DFN,ON),INIT^PSJLMUDE(DFN,ON) S VALMBCK="R"
"RTN","PSJOE",185,0)
 Q
"RTN","PSJOE",186,0)
FINISH ;
"RTN","PSJOE",187,0)
 D FINISH^PSGOEF,PAUSE^VALM1
"RTN","PSJOE",188,0)
 Q
"RTN","PSJOE",189,0)
LOG(DFN,PSGORD)        ;
"RTN","PSJOE",190,0)
 D FULL^VALM1,ENLM^PSGOEL(DFN,PSGORD),PAUSE^VALM1 S VALMBCK="R"
"RTN","PSJOE",191,0)
 Q
"RTN","PSJOE",192,0)
NEWSEL ;
"RTN","PSJOE",193,0)
 N PSGLMT,PSGODDD,PSJLMQT,PSJLMFIN,PSJUDPRF,PSGRDTX,PSJOCDSC,PSJAGYSV K ^TMP("PSJCOM",$J),^TMP("PSJCOM2",$J),^TMP("PSODAOC",$J),^TMP("PSJDAOC",$J)
"RTN","PSJOE",194,0)
 K PSGRMVT,PSGRMV,PSGDUR,PSGRF,ND2P1 ;*315
"RTN","PSJOE",195,0)
 S X=$P(XQORNOD(0),"=",2)
"RTN","PSJOE",196,0)
 S PSGONC=1,PSGLMT=^TMP("PSJPRO",$J,0)
"RTN","PSJOE",197,0)
 D ENCHK^PSGON I '$O(PSGODDD(0)) S VALMQUIT=1 Q
"RTN","PSJOE",198,0)
 S PSJLM=1,PSJSEL=0 F  S PSJSEL=$O(PSGODDD(PSJSEL)) Q:'PSJSEL  F PSJSEL1=1:1:$L(PSGODDD(PSJSEL),",")-1 D
"RTN","PSJOE",199,0)
 .K PSJOCDSC
"RTN","PSJOE",200,0)
 .S PSJORD=$G(^TMP("PSJON",$J,+$P(PSGODDD(PSJSEL),",",PSJSEL1))) D:PSJORD=+PSJORD SELECT^PSJOEA
"RTN","PSJOE",201,0)
 .Q:PSJORD=+PSJORD 
"RTN","PSJOE",202,0)
 .Q:PSJORD=""!($G(Y)<0)  Q:('$$LS^PSSLOCK(PSGP,PSJORD))  D
"RTN","PSJOE",203,0)
 ..S PSGORD=""
"RTN","PSJOE",204,0)
 ..S ON=PSJORD
"RTN","PSJOE",205,0)
 ..D DISACTIO(PSGP,PSJORD,$G(PSJPNV)) S:PSJORD["V" PSJORD=ON
"RTN","PSJOE",206,0)
 ..D UNL^PSSLOCK(PSGP,PSJORD)
"RTN","PSJOE",207,0)
 ..I $G(PSJNOL) K PSJNOL I $D(ON),ON'=PSJORD D UNL^PSSLOCK(PSGP,ON)
"RTN","PSJOE",208,0)
 ..Q:$G(Y)<0
"RTN","PSJOE",209,0)
 I '$G(PSGOEAV),($G(PSJORD)["P"),$G(PSJAGYSV) D
"RTN","PSJOE",210,0)
 .;RTC 178789 
"RTN","PSJOE",211,0)
 .S ^TMP("PSODAOC",$J,"IP IEN")=PSJORD
"RTN","PSJOE",212,0)
 .D SETOC^PSJNEWOC(PSJORD)
"RTN","PSJOE",213,0)
 .K ^TMP("PSODAOC",$J),^TMP("PSJDAOC",$J),PSJAGYSV
"RTN","PSJOE",214,0)
 S VALMBCK="Q"
"RTN","PSJOE",215,0)
 K PSJLM,PSJOCDSC
"RTN","PSJOE",216,0)
 Q
"RTN","PSJOE",217,0)
HOLDHDR ; Freeze header text while processing order actions
"RTN","PSJOE",218,0)
 I $D(VALM("TM")) S IOTM=VALM("TM"),IOBM=IOSL W IOSC W @IOSTBM W IORC
"RTN","PSJOE",219,0)
 Q
"RTN","PSJOE",220,0)
LOCKERR ;
"RTN","PSJOE",221,0)
 W !!,$C(7),"You are entering or editing an Inpatient Medication order in another session.",!,"Only one order entry/edit session is allowed for a user at a time.",!! N DIR S DIR(0)="E" D ^DIR
"RTN","PSJOE",222,0)
 Q
"RTN","PSJOE",223,0)
FLAG(DFN,PSJORD) ;Flag order through CPRS entry point.
"RTN","PSJOE",224,0)
 N ORIFN,NODE0
"RTN","PSJOE",225,0)
 S NODE0=$S(PSJORD["V":$G(^PS(55,DFN,"IV",+PSJORD,0)),PSJORD["U":$G(^PS(55,DFN,5,+PSJORD,0)),1:^PS(53.1,+PSJORD,0))
"RTN","PSJOE",226,0)
 S ORIFN=$P(NODE0,"^",21)
"RTN","PSJOE",227,0)
 D EN1^ORCFLAG(ORIFN)
"RTN","PSJOE",228,0)
 D PAUSE^VALM1
"RTN","PSJOE",229,0)
 Q
"RTN","PSJOE",230,0)
COMPLEX(DFN,ON) ;
"RTN","PSJOE",231,0)
 N NDP2,COM
"RTN","PSJOE",232,0)
 S NDP2=$S(ON["P":$G(^PS(53.1,+ON,.2)),ON["U":$G(^PS(55,DFN,5,+ON,.2)),ON["V":$G(^PS(55,DFN,"IV",+ON,.2)),1:"")
"RTN","PSJOE",233,0)
 S COM=$P(NDP2,"^",8) I COM Q 1
"RTN","PSJOE",234,0)
 Q 0
"RTN","PSJOE1")
0^14^B31281544^B30534447
"RTN","PSJOE1",1,0)
PSJOE1 ;BIR/CML3-UD OE FOR COMBINED OE ;29 JAN 99 / 9:44 AM
"RTN","PSJOE1",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**2,7,25,30,47,56,64,179,181,252,281,315**;16 DEC 97;Build 73
"RTN","PSJOE1",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PSJOE1",4,0)
 ; Reference to ^DICN is supported by DBIA# 10009
"RTN","PSJOE1",5,0)
 ; Reference to ^VALM is supported by DBIA# 10118
"RTN","PSJOE1",6,0)
 ; Reference to ^TMP("PSODAOC",$J supported by DBIA 6071
"RTN","PSJOE1",7,0)
 ;
"RTN","PSJOE1",8,0)
 S PC=0 G AD
"RTN","PSJOE1",9,0)
 ;
"RTN","PSJOE1",10,0)
EN ;
"RTN","PSJOE1",11,0)
 S PC=0
"RTN","PSJOE1",12,0)
 ;
"RTN","PSJOE1",13,0)
AD ; Ask Drug
"RTN","PSJOE1",14,0)
 ;PSJOCFG - If defined, it's for new order, renew or copy. ^PSJOCDSD using this flag to not display drug error.
"RTN","PSJOE1",15,0)
 K PSJOCFG,PSGDUR,PSGRMVT,PSGRMV,PSGRF,ND2P1 ;*315
"RTN","PSJOE1",16,0)
 N PSJNORD,PSGORQF,PSGSDX,PSGFDX,PSGNEFDO,PSGEDTOI,PSJOCFG S PSJOCFG="NEW UD" S PSJNORD=1 I $D(VALM("TM")) S IOTM=VALM("TM"),IOBM=IOSL W IOSC,@IOSTBM,IORC
"RTN","PSJOE1",17,0)
 K PSGORQF
"RTN","PSJOE1",18,0)
 D ^PSGOE7
"RTN","PSJOE1",19,0)
 I $G(PSGORQF) S PSJORQF=1 G DONE
"RTN","PSJOE1",20,0)
 S PC=1,PSJORQF=0 I X?1"S."1.E D ^PSGOES G AD
"RTN","PSJOE1",21,0)
 D ^PSGOE4:'$P(PSJSYSP0,"^",12),^PSGOE3:$P(PSJSYSP0,"^",12)
"RTN","PSJOE1",22,0)
 G:$G(PSGOROE1)=1 AD
"RTN","PSJOE1",23,0)
 K PSGEFN,PSGOEEF,PSGOEE,PSGOEOS S PSGEFN="1:13" F X=1:1:13 S PSGEFN(X)=""
"RTN","PSJOE1",24,0)
 S PSGPDN=$$OINAME^PSJLMUTL(PSGPDRG),PSGPD=PSGPDRG,PSGOINST="",PSGSDN=$$ENDD^PSGMI(PSGNESD)_U_$$ENDTC^PSGMI(PSGNESD),PSGFDN=$$ENDD^PSGMI(PSGNEFD)_U_$$ENDTC^PSGMI(PSGNEFD)
"RTN","PSJOE1",25,0)
 S PSGAT=PSGS0Y,PSGLIN=$$ENDD^PSGMI(PSGDT)_U_$$ENDTC^PSGMI(PSGDT),PSGLI=PSGDT,PSGEBN=$$ENNPN^PSGMI(DUZ),PSGSTAT=$S(PSGOEAV:"ACTIVE",1:"NON-VERIFIED")
"RTN","PSJOE1",26,0)
 D CHK^PSGOEV("^^"_PSGMR_"^^^^"_PSGST,PSGPDRG_U_PSGDO,PSGSCH_U_PSGNESD_"^^"_PSGNEFD)
"RTN","PSJOE1",27,0)
 S PSGSD=PSGNESD,PSGFD=PSGNEFD
"RTN","PSJOE1",28,0)
 K PSJACEPT S VALMBCK="Q" D:$D(Y) EN^VALM("PSJU LM ACCEPT")
"RTN","PSJOE1",29,0)
 I $G(PSJACEPT)=1 D
"RTN","PSJOE1",30,0)
 . D OC
"RTN","PSJOE1",31,0)
 . ;D:'$G(PSGORQF) IN^PSJOCDS($G(PSGORD),"UD",+$G(PSGDRG))
"RTN","PSJOE1",32,0)
 ;If intervention is not log then quit
"RTN","PSJOE1",33,0)
 I $G(PSGORQF)=1 S PSJACEPT=0
"RTN","PSJOE1",34,0)
 S PSJNOO=-1 I $G(PSJACEPT)=1 S PSJNOO=$$ENNOO^PSJUTL5("N")
"RTN","PSJOE1",35,0)
 I $G(PSJNOO)<0 K PSJACEPT W !,"No order created." G AD
"RTN","PSJOE1",36,0)
 K PSGOEE D ^PSGOETO S PSJORD=PSGORD
"RTN","PSJOE1",37,0)
 S ^TMP("PSODAOC",$J,"IP IEN")=PSGORD
"RTN","PSJOE1",38,0)
 ;RTC 178746 - Don't store allergy here.
"RTN","PSJOE1",39,0)
 ;D SETOC^PSJNEWOC(PSGORD)
"RTN","PSJOE1",40,0)
 I PSGOEAV D  G AD
"RTN","PSJOE1",41,0)
 . D SETOC^PSJNEWOC(PSGORD) ;RTC 17874
"RTN","PSJOE1",42,0)
 .I '$D(PSGOEE),+PSJSYSU=3 D EN^PSGPEN(PSGORD)
"RTN","PSJOE1",43,0)
 S PSGOEEF=0 D GETUD^PSJLMGUD(PSGP,PSGORD),ENSFE^PSGOEE0(PSGP,PSGORD),^PSGOE1,EN^VALM("PSJ LM UD ACTION")
"RTN","PSJOE1",44,0)
 ;RTC 178746 - store allergy if not verify the newly created order.
"RTN","PSJOE1",45,0)
 I ($G(PSGORD)["P"),($P($G(^PS(53.1,+PSGORD,0)),U,9)="N"),($G(PSJOCFG)="NEW UD") D SETOC^PSJNEWOC(PSGORD)
"RTN","PSJOE1",46,0)
 G AD
"RTN","PSJOE1",47,0)
 Q
"RTN","PSJOE1",48,0)
OC ;
"RTN","PSJOE1",49,0)
 NEW PSJDD,PSJALLGY,PSJALGY1
"RTN","PSJOE1",50,0)
 K PSGORQF
"RTN","PSJOE1",51,0)
 D FULL^VALM1
"RTN","PSJOE1",52,0)
 S PSJDD=+$$DD53P45^PSJMISC() I 'PSJDD S PSGORQF=1 Q
"RTN","PSJOE1",53,0)
 I +$G(PSGEDTOI) D
"RTN","PSJOE1",54,0)
 . S PSJALGY1=1
"RTN","PSJOE1",55,0)
 . D ENDDC^PSGSICHK($G(PSGP),PSJDD)
"RTN","PSJOE1",56,0)
 D:'$G(PSGORQF) IN^PSJOCDS($G(PSGORD),"UD",PSJDD)
"RTN","PSJOE1",57,0)
 Q
"RTN","PSJOE1",58,0)
EDIT(PROMPT) ;
"RTN","PSJOE1",59,0)
 ; Edit fields in a UD order.
"RTN","PSJOE1",60,0)
 ; PROMPT=0 - Select fields to edit by number.
"RTN","PSJOE1",61,0)
 ; PROMPT=1 - Prompt to select fields for editing.
"RTN","PSJOE1",62,0)
 ;
"RTN","PSJOE1",63,0)
 ;* D @$S('PROMPT:"ENEFA2^PSGON",1:"ENEFA^PSGON") Q:'Y  S PSGOEEG=3 D EDIT^PSGOEE ;$S(PSGOEEWF[53.1:3,1:5) D:Y EDIT^PSGOEE
"RTN","PSJOE1",64,0)
 D @$S('PROMPT:"ENEFA2^PSGON",1:"ENEFA^PSGON") Q:'Y  S:$G(PSJNEWOE) PSGOEEWF="^PS(53.1," S PSGOEEG=$S('$D(PSGOEEWF):3,PSGOEEWF[53.1:3,1:5) D EDIT^PSGOEE
"RTN","PSJOE1",65,0)
 I $G(PSJNEWOE) S PSGOEENO=0,DR="",VALMBCK="R"
"RTN","PSJOE1",66,0)
 I '$G(PSJNEWOE) D ENNOU^PSGOEE0 I 'PSGOEENO,DR="" S VALMBCK="R" Q
"RTN","PSJOE1",67,0)
 I 'PSGOEENO,$D(PSGOES) D ENNOU^PSGOEE0  ; only update on order sets
"RTN","PSJOE1",68,0)
 ;*179 No longer call CKDT^PSGOEE from here.
"RTN","PSJOE1",69,0)
 ;I 'PSGOEENO,$G(PSGPDNX)=1 D CKDT^PSGOEE
"RTN","PSJOE1",70,0)
 I $G(PSGOEER)["101^PSGOE8" S PSGEDTOI=1
"RTN","PSJOE1",71,0)
 K VALMSG I PSGOEENO D
"RTN","PSJOE1",72,0)
 .S VALMSG="This change will cause a new order to be created." D GTSTATUS^PSGOEE,CHKDD^PSGOEE
"RTN","PSJOE1",73,0)
 .S PSGEBN=$$ENNPN^PSGMI(DUZ),PSGLIN=$$ENDD^PSGMI(PSGDT)_U_$$ENDTC^PSGMI(PSGDT),PSGLI=PSGDT
"RTN","PSJOE1",74,0)
 D CHK^PSGOEV("^^"_PSGMR_"^^^^"_PSGST,PSGPDRG_U_PSGDO,PSGSCH_U_PSGSD_"^^"_PSGFD)
"RTN","PSJOE1",75,0)
 D INIT^PSJLMUDE(PSGP,$G(PSGORD))
"RTN","PSJOE1",76,0)
 Q
"RTN","PSJOE1",77,0)
DONE ;
"RTN","PSJOE1",78,0)
 K %,DA,DIC,DIE,DR,DRG,DRGN,DRGO,ND,OC,ORIFN,ORIT,ORPK,ORSTOP,ORSTRT,ORSTS,ORTX,PC,PSGDO,PSGMR,PSGMRN,PSGNEDFD,PSGNEFD,PSGNESD,PSGOES,PSGOROE1,PSGORD,PSGS0XT,PSGS0Y,PSGSCH,PSGSI,PSGX,Y,Z
"RTN","PSJOE1",79,0)
 K PSGEDTOI,PSJOCFG,PSGDUR,PSGRMVT,PSGRMV,PSGRF,ND2,ND2P1 ;*315
"RTN","PSJOE1",80,0)
 Q
"RTN","PSJOE1",81,0)
 ;
"RTN","PSJOE1",82,0)
GDO ;
"RTN","PSJOE1",83,0)
 W !!,"Drug is not found in Formulary List." F  S %=1 W !,"Would you like to try to search the list again" D YN^DICN Q:%  D TAM
"RTN","PSJOE1",84,0)
 Q:%<2
"RTN","PSJOE1",85,0)
FTD ;
"RTN","PSJOE1",86,0)
 R !!,"Enter FREE TEXT DRUG: ",PSGDRGN:DTIME E  W $C(7) S PSGDRGN="^" Q
"RTN","PSJOE1",87,0)
 Q:"^"[PSGDRGN  S X=$S(PSGDRGN'?.ANP:"Control character(s)",PSGDRGN["^":"Up-arrow ('^') in text",$L(PSGDRGN)>39:"Response longer than 39 characters",1:"") I X]"" W $C(7),"  ??",!?2,"(",X," not allowed.)" G FTD
"RTN","PSJOE1",88,0)
 Q:PSGDRGN'?1."?"
"RTN","PSJOE1",89,0)
 W !!?2,"ENTER DRUG ORDERED (1-39 CHARACTERS).",!?2,"Since the drug cannot be found in the DRUG file, enter the drug name here",!,"exactly as ordered.  Press the RETURN key (or enter an '^') to skip over this",!,"drug, or to again search the"
"RTN","PSJOE1",90,0)
 W " DRUG file for this one." G FTD
"RTN","PSJOE1",91,0)
 ;
"RTN","PSJOE1",92,0)
TAM ; Try Again Message
"RTN","PSJOE1",93,0)
 W !!,"  Enter a 'Y' to try again to find the drug ordered from the Formulary.  (The",!,"order cannot become active until a Formulary drug has been entered.)  Enter 'N'",!,"to enter the drug ordered as free text for later reference."
"RTN","PSJOE1",94,0)
 W "  Enter '^' to exit.",! Q
"RTN","PSJOEA")
0^45^B31606537^B31162928
"RTN","PSJOEA",1,0)
PSJOEA ;BIR/MLM-INPATIENT ORDER ENTRY ;23 Jun 98 / 1:46 PM
"RTN","PSJOEA",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**110,127,133,167,171,254,315**;16 DEC 97;Build 73
"RTN","PSJOEA",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PSJOEA",4,0)
 ; Reference to ^PS(55 is supported by DBIA #2191.
"RTN","PSJOEA",5,0)
 ; Reference to EN^VALM is supported by DBIA #10118.
"RTN","PSJOEA",6,0)
 ; Reference to ^PSSLOCK is supported by DBIA #2789
"RTN","PSJOEA",7,0)
 ; Reference to ^DPT is supported by DBIA #10035.
"RTN","PSJOEA",8,0)
 ; Reference to SDIMO^SDAMA203 is supported by DBIA #4133.
"RTN","PSJOEA",9,0)
 ;
"RTN","PSJOEA",10,0)
LOCK(DFN,PSJORD) ; Check to see if the order is already locked
"RTN","PSJOEA",11,0)
 N Q S Q=0
"RTN","PSJOEA",12,0)
 I PSJORD=+PSJORD N PSJO S PSJO=0 F  S PSJO=$O(^PS(53.1,"ACX",PSJORD,PSJO)) Q:'PSJO  S Q=$$LS^PSSLOCK(DFN,PSJO_"P") I 'Q Q
"RTN","PSJOEA",13,0)
 I Q Q 1
"RTN","PSJOEA",14,0)
 Q 0
"RTN","PSJOEA",15,0)
 ;
"RTN","PSJOEA",16,0)
SELECT ;
"RTN","PSJOEA",17,0)
 N PSJCLIN,O
"RTN","PSJOEA",18,0)
 Q:PSJORD=""!($G(Y)<0)  Q:('$$LOCK^PSJOEA(PSGP,PSJORD))
"RTN","PSJOEA",19,0)
 N PSJO S PSJO=0 F  S PSJO=$O(^PS(53.1,"ACX",PSJORD,PSJO)) Q:'PSJO  D
"RTN","PSJOEA",20,0)
 .S PSGORD="" S ON=PSJO_"P"
"RTN","PSJOEA",21,0)
 .D DISACTIO(PSGP,PSJO_"P",$G(PSJPNV)) S:$G(PSJO)["V" O=ON
"RTN","PSJOEA",22,0)
 I $D(^TMP("PSJCOM",$J)) D CHK^PSJOEA1
"RTN","PSJOEA",23,0)
 S:'$G(PSGP) PSGP=$G(DFN)
"RTN","PSJOEA",24,0)
 N PSJO S PSJO=0 F  S PSJO=$O(^PS(53.1,"ACX",PSJORD,PSJO)) Q:'PSJO  D
"RTN","PSJOEA",25,0)
 .D UNL^PSSLOCK(PSGP,PSJO_"P") Q:$G(Y)<0
"RTN","PSJOEA",26,0)
 D DONE
"RTN","PSJOEA",27,0)
 Q
"RTN","PSJOEA",28,0)
 ;
"RTN","PSJOEA",29,0)
DISACTIO(DFN,PSJORD,PSJPNV)       ; Display UD order and allow actions.
"RTN","PSJOEA",30,0)
 ; DFN    - Patient IEN
"RTN","PSJOEA",31,0)
 ; PSJORD - Order #_location Code (P:53.1,V:55.01,U:55.06)
"RTN","PSJOEA",32,0)
 ; PSJPNV - Invoked from Pending/NV option; (gets different hidden menu)
"RTN","PSJOEA",33,0)
 N PSGP,PSJIVFLG,PSGSDX,PSGFDX,PSJXX1,ON55,PSJAPPT
"RTN","PSJOEA",34,0)
 Q:PSJORD'["P"
"RTN","PSJOEA",35,0)
 Q:$G(PSJCLIN)=-2
"RTN","PSJOEA",36,0)
 S PSGP=DFN D ENIV^PSJAC
"RTN","PSJOEA",37,0)
 D GETUD^PSJLMGUD(DFN,PSJORD)
"RTN","PSJOEA",38,0)
 S PSGOEAV=$P(PSJSYSP0,"^",9)&PSJSYSU
"RTN","PSJOEA",39,0)
 S:$G(PSJTUD) PSGPD=$G(PSJCOI),PSGPDN=$$OINAME^PSJLMUTL(+PSGPD)
"RTN","PSJOEA",40,0)
 K PSGOENG I '$D(PSGPRF) D  Q:$G(PSGOENG)
"RTN","PSJOEA",41,0)
 . I PSJORD["P" L +^PS(53.1,+PSJORD):1 E  S PSGOENG=1
"RTN","PSJOEA",42,0)
 . I $G(PSGOENG) W !,"This order is being edited by another terminal.",! S PSGOENG=1 K DIR S DIR(0)="E" D ^DIR K DIR Q
"RTN","PSJOEA",43,0)
 S PSGACT=$$ENACTION^PSGOE1(PSGP,PSJORD)
"RTN","PSJOEA",44,0)
 I PSJORD["P" S PSJXX1=$G(^PS(53.1,+PSJORD,0)) I PSGP'=$P(PSJXX1,U,15)!(DFN'=$P(PSJXX1,U,15)) Q  ;L -^PS(53.1,+PSJORD) Q
"RTN","PSJOEA",45,0)
 I PSJORD["P" D  S PSJXX1=$P($G(^PS(53.1,+PSJORD,0)),U,9) I $S($G(PSJIVFLG):1,$G(Y)<0:1,"PADE"[PSJXX1:1,1:0) Q  ;L -^PS(53.1,+PSJORD) Q
"RTN","PSJOEA",46,0)
 .I $P(PSJXX1,U,9)="N",($P(PSJXX1,U,4)'="U") D  Q
"RTN","PSJOEA",47,0)
 .. S P("PON")=PSJORD,PSIVFLG=1
"RTN","PSJOEA",48,0)
 .. D GT531^PSIVORFA(+PSGP,PSJORD),VF^PSIVORC2
"RTN","PSJOEA",49,0)
 .I $P(PSJXX1,U,9)="P" D  Q
"RTN","PSJOEA",50,0)
 ..S:$G(PSJTUD) $P(PSJXX1,U,4)="U"
"RTN","PSJOEA",51,0)
 ..N VAIP S PSJCLIN=$G(^PS(53.1,+PSJORD,"DSS")),PSJAPPT=$P(PSJCLIN,"^",2),PSJCLIN=$P(PSJCLIN,"^")
"RTN","PSJOEA",52,0)
 ..I $P(PSJXX1,U,4)="U",(+PSJPDD) D  Q:(PSJCLIN=-2)
"RTN","PSJOEA",53,0)
 ...I $$PATCH^XPDUTL("SD*5.3*285"),($$SDIMO^SDAMA203(PSJCLIN,DFN)>-1) Q
"RTN","PSJOEA",54,0)
 ...W !!,"Cannot process an Out-patient Unit Dose order for ",$P($G(^DPT(+PSGP,0)),U) D PAUSE^VALM1 S PSJIVFLG=1,PSJCLIN=-2
"RTN","PSJOEA",55,0)
 ..NEW PSGRSD,PSGRSDN,PSGRFD,PSGRFDN
"RTN","PSJOEA",56,0)
 ..D REQDT^PSJLIVMD(PSJORD)
"RTN","PSJOEA",57,0)
 ..I $P(PSJXX1,U,4)="U",($G(PSGSCH)="") W !!,"Invalid schedule, can't finish this order" D PAUSE^VALM1 Q
"RTN","PSJOEA",58,0)
 ..I $P(PSJXX1,U,4)="U" N PSJLM S PSJLM=1,PSGORD=PSJORD D START^PSGOEF,ENSFE^PSGOEE0(PSGP,PSGORD),@$S($G(PSJTUD):"FINISH^PSGOEF",1:"EN^VALM(""PSJ LM PENDING EDIT"")") D  Q
"RTN","PSJOEA",59,0)
 ...K ^TMP("PSJINTER",$J),PSJOVR
"RTN","PSJOEA",60,0)
 ..I $P(PSJXX1,U,4)'="U",PSGP=$P(PSJXX1,U,15),DFN=$P(PSJXX1,U,15) S PSJLYN=PSJORD D EN^PSJLIFN S PSJIVFLG=1 K PSJLYN,PSJMAI
"RTN","PSJOEA",61,0)
 I $G(PSIVFLG) K PSIVFLG Q
"RTN","PSJOEA",62,0)
 S PSGACT=$$ENACTION^PSGOE1(PSGP,PSJORD),PSGOEEF=0 D GETUD^PSJLMGUD(PSGP,PSJORD),ENSFE^PSGOEE0(PSGP,PSJORD),EN^VALM("PSJ LM UD ACTION")
"RTN","PSJOEA",63,0)
 ;Send SN to CPRS if autoverify OFF and Order Set Entry and no 21st piece
"RTN","PSJOEA",64,0)
 I $D(PSGOES),'PSGOEAV,$D(PSGORD),PSGORD["P",$P($G(^PS(53.1,+PSGORD,0)),"^",21)']"" D ORSET^PSGOETO1
"RTN","PSJOEA",65,0)
 Q
"RTN","PSJOEA",66,0)
 ;
"RTN","PSJOEA",67,0)
ACTLOG(PSGORDP,DFN,PSGORD)  ;Store 53.1 activity log in local array to be moved to 55
"RTN","PSJOEA",68,0)
 ;PSGORDP: IEN from 53.1
"RTN","PSJOEA",69,0)
 ;PSGORD : IEN from 55
"RTN","PSJOEA",70,0)
 NEW PSGX,PSGXDA,PSGAL531,Q,QQ
"RTN","PSJOEA",71,0)
 F PSGX=0:0 S PSGX=$O(^PS(53.1,+PSGORDP,"A",PSGX)) Q:'PSGX  D
"RTN","PSJOEA",72,0)
 . S PSGAL531=$G(^PS(53.1,+PSGORDP,"A",PSGX,0))
"RTN","PSJOEA",73,0)
 . S QQ=$G(^PS(55,DFN,5,+PSGORD,9,0)) S:QQ="" QQ="^55.09D" F Q=$P(QQ,U,3)+1:1 I '$D(^(Q)) S $P(QQ,U,3,4)=Q_U_Q,^(0)=QQ,PSGXDA=Q Q
"RTN","PSJOEA",74,0)
 . S ^PS(55,DFN,5,+PSGORD,9,PSGXDA,0)=PSGAL531
"RTN","PSJOEA",75,0)
 Q
"RTN","PSJOEA",76,0)
 ;
"RTN","PSJOEA",77,0)
UD ;
"RTN","PSJOEA",78,0)
 N DA,DR,DIE,PSJCMPDA D ENGNA^PSGOETO S $P(^TMP("PSJCOM",$J,PSJO,0),"^",26)=DA_"U",$P(^TMP("PSJCOM2",$J,PSJO,0),"^")=DA,$P(^(0),"^",18)=DA S PSJCMPDA=DA
"RTN","PSJOEA",79,0)
 M ^PS(55,PSGP,5,DA)=^TMP("PSJCOM2",$J,+PSJO) M ^PS(53.1,+PSJO)=^TMP("PSJCOM",$J,+PSJO) D EN1^PSJHL2(PSGP,"OD",+PSJO_"P") S PSJNOO=$P(^TMP("PSJCOM2",$J,+PSJO,.2),U,3) D EN1^PSJHL2(PSGP,"SN",+PSJCMPDA_"U")
"RTN","PSJOEA",80,0)
 N PSGPDRG,PSGST,PSGNESD,PSGNEFD,ND2,ND2P1
"RTN","PSJOEA",81,0)
 S PSGPDRG=$P($G(^PS(55,PSGP,5,PSJCMPDA,.2)),"^"),PSGST=$P($G(^PS(55,PSGP,5,PSJCMPDA,0)),"^",7)
"RTN","PSJOEA",82,0)
 S ND2=$G(^PS(55,PSGP,5,PSJCMPDA,2)),PSGNESD=$P(ND2,"^",2),PSGNEFD=$P(ND2,"^",4) D CRA^PSGOETO
"RTN","PSJOEA",83,0)
 S ND2P1=$G(^PS(55,PSGP,5,PSJCMPDA,2)),PSGRMVT=$P(ND2P1,"^",2) ;*315
"RTN","PSJOEA",84,0)
 K ^PS(53.1,"ACX",PSJORD,PSJO) K PSJPREX
"RTN","PSJOEA",85,0)
 I $G(PSJCMPDA) D CMPLX2^PSJCOM1(PSGP,PSJORD,+PSJCMPDA_"U") I $G(PSGPXN) S PSJPREX=1
"RTN","PSJOEA",86,0)
 Q
"RTN","PSJOEA",87,0)
IV ; 
"RTN","PSJOEA",88,0)
 K ON55 I $P($G(^PS(53.1,+PSJO,0)),"^",24)="R",$P($G(^PS(53.1,+PSJO,0)),"^",25) S ON55=$P(^PS(53.1,+PSJO,0),"^",25)
"RTN","PSJOEA",89,0)
 I '$G(ON55) D NEW55^PSIVORFB
"RTN","PSJOEA",90,0)
 S $P(^TMP("PSJCOM",$J,PSJO,0),"^",26)=ON55,$P(^TMP("PSJCOM2",$J,PSJO,0),"^")=+ON55
"RTN","PSJOEA",91,0)
 S $P(^TMP("PSJCOM2",$J,PSJO,2),U,5)=PSJO_"P",$P(^TMP("PSJCOM",$J,PSJO,0),U,26)=ON55
"RTN","PSJOEA",92,0)
 M ^PS(55,DFN,"IV",+ON55)=^TMP("PSJCOM2",$J,+PSJO) M ^PS(53.1,+PSJO)=^TMP("PSJCOM",$J,+PSJO) D EN1^PSJHL2(PSGP,"OD",+PSJO_"P") S P("NAT")=$P(^TMP("PSJCOM2",$J,+PSJO,.2),U,5) D EN1^PSJHL2(PSGP,"SN",ON55)
"RTN","PSJOEA",93,0)
 K DA,DIK S DA(1)=DFN,DA=+ON55,DIK="^PS(55,"_DA(1)_",""IV"",",PSIVACT=1 D IX^DIK K DA,DIK
"RTN","PSJOEA",94,0)
 K ^PS(53.1,"ACX",PSJORD,PSJO)
"RTN","PSJOEA",95,0)
 Q
"RTN","PSJOEA",96,0)
 ;
"RTN","PSJOEA",97,0)
DONE ; Clean up
"RTN","PSJOEA",98,0)
 K PSGPD,PSGPDN,PSGSCH,PSIVACT,PSJNOO
"RTN","PSJOEA",99,0)
 Q
"RTN","PSJORRE")
0^39^B37472856^B35461891
"RTN","PSJORRE",1,0)
PSJORRE ;BIR/MV-RETURN INPATIENT ACTIVE MEDS (CONDENSED) ; 2/28/11 3:11pm
"RTN","PSJORRE",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**22,51,50,58,81,110,111,112,134,225,275,315**;16 DEC 97;Build 73
"RTN","PSJORRE",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PSJORRE",4,0)
 ;Reference to ^PS(52.6 is supported by DBIA 1231.
"RTN","PSJORRE",5,0)
 ;Reference to ^PS(52.7 is supported by DBIA 2173.
"RTN","PSJORRE",6,0)
 ;Reference to ^PS(55 is supported by DBIA 2191.
"RTN","PSJORRE",7,0)
 ;Reference to ^TMP("PS" is documented in DBIA #2383.
"RTN","PSJORRE",8,0)
 ;
"RTN","PSJORRE",9,0)
OCL(DFN,BDT,EDT,TFN,MVIEW)         ; return condensed list of inpat meds
"RTN","PSJORRE",10,0)
 ; MVIEW=0   -  This returns the 'unsorted' list as it was returned prior to GUI 27 
"RTN","PSJORRE",11,0)
 ; MVIEW=1   -  This returns the old sort view of the list, pre-sorted for GUI 27
"RTN","PSJORRE",12,0)
 ; MVIEW=2   -  This returns new sort view #1 of the order profile for GUI 27 
"RTN","PSJORRE",13,0)
 ; MVIEW=3   -  This returns new sort view #2 of the order profile for GUI 27
"RTN","PSJORRE",14,0)
 D @$S($G(MVIEW)=3:"OCL^PSJORRN1(DFN,BDT,EDT,.TFN)",$G(MVIEW)=2:"OCL^PSJORRN(DFN,BDT,EDT,.TFN)",$G(MVIEW)=1:"OCL^PSJORRO(DFN,BDT,EDT,.TFN)",1:"OCL1(DFN,BDT,EDT,TFN)")
"RTN","PSJORRE",15,0)
 Q
"RTN","PSJORRE",16,0)
OCL1(DFN,BDT,EDT,TFN,MVIEW) ; Execute this section if MVIEW=0
"RTN","PSJORRE",17,0)
 N ADM,CNT,DN,DO,F,FON,INFUS,INST,MR,ND,ND0,ND2,ND2P1,ND6,ON,PON,PST,SCH,SIO,STAT,TYPE,UNITS,WBDT,X,Y,PSJCLIN,A ;*315
"RTN","PSJORRE",18,0)
 ; PON=placer order number (oerr), FON=filler order number
"RTN","PSJORRE",19,0)
 S:BDT="" BDT=DT S WBDT=BDT_".000001"
"RTN","PSJORRE",20,0)
 S:EDT="" EDT=9999999
"RTN","PSJORRE",21,0)
 S:EDT'["." EDT=EDT_".999999"
"RTN","PSJORRE",22,0)
 S F="^PS(55,DFN,5," F  S WBDT=$O(^PS(55,DFN,5,"AUS",WBDT)) Q:'WBDT  F ON=0:0 S ON=$O(^PS(55,DFN,5,"AUS",WBDT,ON)) Q:'ON  D UDTMP
"RTN","PSJORRE",23,0)
 S F="^PS(53.1," F PST="P","N" F ON=0:0 S ON=$O(^PS(53.1,"AS",PST,DFN,ON)) Q:'ON  S X=$P($G(^PS(53.1,+ON,0)),U,4) D @$S(X="U":"UDTMP",1:"IVTMP")
"RTN","PSJORRE",24,0)
 S F="^PS(55,"_DFN_",""IV"",",WBDT=BDT F  S WBDT=$O(^PS(55,DFN,"IV","AIS",WBDT)) Q:'WBDT  F ON=0:0 S ON=$O(^PS(55,DFN,"IV","AIS",WBDT,ON)) Q:'ON  D IVTMP
"RTN","PSJORRE",25,0)
 Q
"RTN","PSJORRE",26,0)
 ;
"RTN","PSJORRE",27,0)
UDTMP ;*** Set ^TMP for Unit dose orders.
"RTN","PSJORRE",28,0)
 N PROVIDER,RNWDT,EDTCMPLX,NDP2 S (MR,SCH,INST,PON)="",FON=+ON_$S(F["53.1":"P",1:"U")
"RTN","PSJORRE",29,0)
 D TYPE
"RTN","PSJORRE",30,0)
 S RNWDT=$$LASTREN^PSJLMPRI(DFN,FON) I RNWDT S RNWDT=+RNWDT
"RTN","PSJORRE",31,0)
 S NDP2=$G(@(F_ON_",.2)")) S EDTCMPLX=$P(NDP2,"^",8)
"RTN","PSJORRE",32,0)
 S ND2=$G(@(F_ON_",2)")) I 'EDTCMPLX I F'["53.1",($P(ND2,U,2)>EDT) Q
"RTN","PSJORRE",33,0)
 ;*315 drp
"RTN","PSJORRE",34,0)
 S ND2P1=$G(@(F_ON_",2.1)")) I 'EDTCMPLX I F'["53.1",($P(ND2P1,U,2.1)>EDT) Q
"RTN","PSJORRE",35,0)
 S ND0=$G(@(F_ON_",0)")) I 'EDTCMPLX I F["53.1",($P(ND0,U,16)>EDT) Q
"RTN","PSJORRE",36,0)
 S STAT=$$CODES^PSIVUTL($P(ND0,U,9),$S(FON["P":53.1,1:55.06),28)
"RTN","PSJORRE",37,0)
 S ND6=$P($G(@(F_ON_",6)")),"^"),INST=$G(@(F_+ON_",.3)"))
"RTN","PSJORRE",38,0)
 S:ND6["Instructions too long. See Order View or BCMA for full text" ND6="Instructions too long. See order details for full text."
"RTN","PSJORRE",39,0)
 S FON=+ON_$S(F["53.1":"P",1:"U"),DO=$P($G(@(F_ON_",.2)")),"^",2)
"RTN","PSJORRE",40,0)
 D DRGDISP^PSJLMUT1(DFN,FON,40,0,.DN,1)
"RTN","PSJORRE",41,0)
 ;*225 Don't allow 0 Units
"RTN","PSJORRE",42,0)
 S UNITS="" I '$O(@(F_+ON_",1,1)")) S UNITS=$P($G(@(F_+ON_",1,1,0)")),U,2) S:(FON["U")&(+UNITS=0) UNITS=1
"RTN","PSJORRE",43,0)
 S:+$P(ND0,U,3) MR=$$MR^PSJORRE1(+$P(ND0,U,3))
"RTN","PSJORRE",44,0)
 N NOTGIVEN S NOTGIVEN=$S(FON["U":$P($G(^PS(55,DFN,5,+ON,0)),"^",22),1:"")
"RTN","PSJORRE",45,0)
 S TFN=TFN+1
"RTN","PSJORRE",46,0)
 S ^TMP("PS",$J,TFN,0)=FON_";I"_U_DN(1)_"^^"_$P(ND2,U,4)_"^^"_DO_U_UNITS_U_$P(ND0,U,21)_U_STAT_U_U_U_U_NOTGIVEN_U_($P(ND0,U,9)="P"&($P(ND0,U,24)="R"))_U_$P(ND2,U,2)_U_$G(RNWDT)
"RTN","PSJORRE",47,0)
 K ^TMP("PS",$J,TFN,"CLINIC",0) I PSJCLIN]"" S ^TMP("PS",$J,TFN,"CLINIC",0)=PSJCLIN
"RTN","PSJORRE",48,0)
 S PROVIDER=$P($G(@(F_+ON_",0)")),"^",2)
"RTN","PSJORRE",49,0)
 I PROVIDER S ^TMP("PS",$J,TFN,"P",0)=PROVIDER_"^"_$P($G(^VA(200,PROVIDER,0)),"^")
"RTN","PSJORRE",50,0)
 S ^TMP("PS",$J,TFN,"MDR",0)=MR]"" S:MR]"" ^TMP("PS",$J,TFN,"MDR",1,0)=MR
"RTN","PSJORRE",51,0)
 S ^TMP("PS",$J,TFN,"SCH",0)=$P(ND2,U)]"" S:$P(ND2,U)]"" ^TMP("PS",$J,TFN,"SCH",1,0)=$P(ND2,U)
"RTN","PSJORRE",52,0)
 S ^TMP("PS",$J,TFN,"SIG",0)=INST]"" S:INST]"" ^TMP("PS",$J,TFN,"SIG",1,0)=INST
"RTN","PSJORRE",53,0)
 S ^TMP("PS",$J,TFN,"ADM",0)=$P(ND2,U,5)]"" S:$P(ND2,U,5)]"" ^TMP("PS",$J,TFN,"ADM",1,0)=$P(ND2,U,5)
"RTN","PSJORRE",54,0)
 S ^TMP("PS",$J,TFN,"RMV",0)=$P(ND2P1,U,2)]"" S:$P(ND2P1,U,2)]"" ^TMP("PS",$J,TFN,"RMV",1,0)=$P(ND2P1,U,2) ;*315
"RTN","PSJORRE",55,0)
 S ^TMP("PS",$J,TFN,"SIO",0)=ND6]"" S:ND6]"" ^TMP("PS",$J,TFN,"SIO",1,0)=ND6
"RTN","PSJORRE",56,0)
 Q
"RTN","PSJORRE",57,0)
 ;
"RTN","PSJORRE",58,0)
IVTMP ;*** Set ^TMP for IV orders.
"RTN","PSJORRE",59,0)
 N PROVIDER,START,STOP,EDTCMPLX,NDP2,IVLIM
"RTN","PSJORRE",60,0)
 S NDP2=$G(@(F_ON_",.2)")) S EDTCMPLX=$P(NDP2,"^",8)
"RTN","PSJORRE",61,0)
 S ND0=$G(@(F_ON_",0)")) I 'EDTCMPLX I F'["53.1",($P(ND0,U,2)>EDT) Q
"RTN","PSJORRE",62,0)
 D TYPE
"RTN","PSJORRE",63,0)
 S FON=+ON_$S(F["53.1":"P",1:"V"),TFN=TFN+1,CNT=0
"RTN","PSJORRE",64,0)
 S RNWDT=$$LASTREN^PSJLMPRI(DFN,FON) I RNWDT S RNWDT=+RNWDT
"RTN","PSJORRE",65,0)
 F X=0:0 S X=$O(@(F_ON_",""AD"","_X_")")) Q:'X  S ND=$G(@(F_ON_",""AD"","_X_",0)")),DN=$P($G(^PS(52.6,+ND,0)),U),Y=DN_U_$P(ND,U,2) S:$P(ND,U,3) Y=Y_U_$P(ND,U,3) S CNT=CNT+1,^TMP("PS",$J,TFN,"A",CNT,0)=Y
"RTN","PSJORRE",66,0)
 S ^TMP("PS",$J,TFN,"A",0)=CNT,CNT=0
"RTN","PSJORRE",67,0)
 F X=0:0 S X=$O(@(F_ON_",""SOL"","_X_")")) Q:'X  S ND=$G(@(F_ON_",""SOL"","_X_",0)")),DN=$G(^PS(52.7,+ND,0)),CNT=CNT+1,^TMP("PS",$J,TFN,"B",CNT,0)=$P(DN,U)_U_$P(ND,U,2)_U_$P(DN,U,4)
"RTN","PSJORRE",68,0)
 S ^TMP("PS",$J,TFN,"B",0)=CNT
"RTN","PSJORRE",69,0)
 S TYPE=$P(ND0,U,4),(MR,SCH,INST,INFUS)=""
"RTN","PSJORRE",70,0)
 I FON["P" S ND2=$G(^PS(53.1,+ON,2)),SCH=$P(ND2,U),START=$P(ND2,U,2),STOP=$P(ND2,U,4),MR=$P(ND0,U,3),INFUS=$P($G(^PS(53.1,+ON,8)),U,5),STAT=$$CODES^PSIVUTL($P(ND0,U,9),53.1,28),ADM=$P(ND2,U,5),SIO=$P($G(@(F_+ON_",6)")),"^")
"RTN","PSJORRE",71,0)
 I FON'["P" S START=$P(ND0,U,2),STOP=$P(ND0,U,3),SCH=$P(ND0,U,9),INFUS=$P(ND0,U,8),MR=$P($G(^PS(55,DFN,"IV",+ON,.2)),U,3),STAT=$$CODES^PSIVUTL($P(ND0,U,17),55.01,100),ADM=$P(ND0,U,11),SIO=$P($G(@(F_+ON_",3)")),"^")
"RTN","PSJORRE",72,0)
 S:($G(SIO)["Instructions too long. See Order View or BCMA for full text") SIO="Instructions too long. See order details for full text."
"RTN","PSJORRE",73,0)
 S DN=$G(@(F_+ON_",.2)")),DO=$P(DN,U,2)
"RTN","PSJORRE",74,0)
 S DN=$S(+$P(DN,U):$$OIDF^PSJLMUT1($P(DN,U)),1:"")
"RTN","PSJORRE",75,0)
 S:MR MR=$$MR^PSJORRE1(+MR),INST=$G(@(F_+ON_",.3)"))
"RTN","PSJORRE",76,0)
 S ^TMP("PS",$J,TFN,0)=FON_";I"_U_DN_U_INFUS_U_STOP_"^^"_DO_"^^"_$P(ND0,"^",21)_U_STAT_U_U_U_U_U_($P(ND0,U,9)="P"&($P(ND0,U,24)="R"))_U_START_U_$G(RNWDT)
"RTN","PSJORRE",77,0)
 K ^TMP("PS",$J,TFN,"CLINIC",0) I PSJCLIN]"" S ^TMP("PS",$J,TFN,"CLINIC",0)=PSJCLIN
"RTN","PSJORRE",78,0)
 S PROVIDER=$P($G(@(F_+ON_",0)")),"^",6)
"RTN","PSJORRE",79,0)
 I PROVIDER S ^TMP("PS",$J,TFN,"P",0)=PROVIDER_"^"_$P($G(^VA(200,PROVIDER,0)),"^")
"RTN","PSJORRE",80,0)
 S ND2P5=$G(@(F_+ON_",2.5)")) S IVLIM=$P(ND2P5,U,4) I $E(IVLIM)="a" S IVLIM="doses"_$P(IVLIM,"a",2)
"RTN","PSJORRE",81,0)
 I IVLIM="" S IVLIM=$P(ND2P5,U,2) S:(IVLIM'["d")&(IVLIM'["h") IVLIM=""
"RTN","PSJORRE",82,0)
 S ^TMP("PS",$J,TFN,"MDR",0)=MR]"" S:MR]"" ^TMP("PS",$J,TFN,"MDR",1,0)=MR
"RTN","PSJORRE",83,0)
 S ^TMP("PS",$J,TFN,"SIG",0)=INST]"" S:INST]"" ^TMP("PS",$J,TFN,"SIG",1,0)=INST
"RTN","PSJORRE",84,0)
 S ^TMP("PS",$J,TFN,"SCH",0)=SCH]"" S:SCH]"" ^TMP("PS",$J,TFN,"SCH",1,0)=SCH
"RTN","PSJORRE",85,0)
 S ^TMP("PS",$J,TFN,"ADM",0)=ADM]"" S:ADM]"" ^TMP("PS",$J,TFN,"ADM",1,0)=ADM
"RTN","PSJORRE",86,0)
 S ^TMP("PS",$J,TFN,"SIO",0)=SIO]"" S:SIO]"" ^TMP("PS",$J,TFN,"SIO",1,0)=SIO
"RTN","PSJORRE",87,0)
 I $G(IVLIM)]"" S ^TMP("PS",$J,TFN,"IVLIM",0)=IVLIM
"RTN","PSJORRE",88,0)
 Q
"RTN","PSJORRE",89,0)
STAT(Y,X) ;* Return the full status instead of just the code for U/D.
"RTN","PSJORRE",90,0)
 S X=$P($P(";"_$P(Y,U,3),";"_X_":",2),";")
"RTN","PSJORRE",91,0)
 Q X
"RTN","PSJORRE",92,0)
TYPE ;determine if this is an IMO order or not
"RTN","PSJORRE",93,0)
 S (A,PSJCLIN)="" I F["PS(53.1" S A=$G(^PS(53.1,ON,"DSS"))
"RTN","PSJORRE",94,0)
 I F["PS(55" S A=$S(F["IV":$G(^PS(55,DFN,"IV",ON,"DSS")),1:$G(^PS(55,DFN,5,ON,8)))
"RTN","PSJORRE",95,0)
 I $P(A,"^",2)'="" S PSJCLIN=+A
"RTN","PSJORRE",96,0)
 Q
"RTN","PSJORRE1")
0^46^B42580655^B41040676
"RTN","PSJORRE1",1,0)
PSJORRE1 ;BIR/MV-RETURN INPATIENT ACTIVE MEDS (EXPANDED) ; 2/28/11 3:11pm
"RTN","PSJORRE1",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**22,51,50,58,81,91,110,111,134,225,275,315**;16 DEC 97;Build 73
"RTN","PSJORRE1",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PSJORRE1",4,0)
 ; Reference to ^PS(51.2 is supported by DBIA 2178.
"RTN","PSJORRE1",5,0)
 ; Reference to ^PS(52.6 is supported by DBIA 1231.
"RTN","PSJORRE1",6,0)
 ; Reference to ^PS(52.7 is supported by DBIA 2173.
"RTN","PSJORRE1",7,0)
 ; Reference to ^PS(55 is supported by DBIA 2191.
"RTN","PSJORRE1",8,0)
 ; Reference to ^PSDRUG is supported by DBIA 2192.
"RTN","PSJORRE1",9,0)
 ; Reference to ^TMP("PS" is documented in DBIA #2384.
"RTN","PSJORRE1",10,0)
 ;
"RTN","PSJORRE1",11,0)
OEL(DFN,ON)         ; return list of expanded inpat meds
"RTN","PSJORRE1",12,0)
 K ^TMP("PS",$J)
"RTN","PSJORRE1",13,0)
 N ADM,CNT,DN,DO,F,INFUS,INST,MR,ND,ND0,ND2,ND2P1,ND2P5,ND6,NDOI,SCH,SIO,START,STAT,STOP,TYP,UNITS,X,Y ;*315
"RTN","PSJORRE1",14,0)
 S F=$S(ON["P":"^PS(53.1,",ON["U":"^PS(55,DFN,5,",1:"^PS(55,"_DFN_",""IV"",")
"RTN","PSJORRE1",15,0)
 I ON'["P",'$D(@(F_+ON_")")) Q
"RTN","PSJORRE1",16,0)
 I ON["P" S X=$G(^PS(53.1,+ON,0)) Q:$P(X,U,15)'=DFN  S TYP=$P(X,U,4) D @$S(TYP="U":"UDTMP",1:"IVTMP")
"RTN","PSJORRE1",17,0)
 D:ON'["P" @$S(ON["U":"UDTMP",1:"IVTMP")
"RTN","PSJORRE1",18,0)
 S Y=$S(ON["V":5,1:12),CNT=0
"RTN","PSJORRE1",19,0)
 I $O(@(F_+ON_","_Y_",0)")) D
"RTN","PSJORRE1",20,0)
 . F X=0:0 S X=$O(@(F_+ON_","_Y_","_X_")")) Q:'X  D
"RTN","PSJORRE1",21,0)
 ..S CNT=CNT+1,ND=$G(@(F_+ON_","_Y_","_X_",0)")),^TMP("PS",$J,"PC",CNT,0)=ND
"RTN","PSJORRE1",22,0)
 S ^TMP("PS",$J,"PC",0)=CNT
"RTN","PSJORRE1",23,0)
 Q
"RTN","PSJORRE1",24,0)
 ;
"RTN","PSJORRE1",25,0)
UDTMP ;*** Set ^TMP for Unit dose orders.
"RTN","PSJORRE1",26,0)
 N DO,DN,INST,X,Y,PROVIDER,NOTGIVEN,RNWDT
"RTN","PSJORRE1",27,0)
 S (MR,SCH,INST)=""
"RTN","PSJORRE1",28,0)
 S ND2=$G(@(F_+ON_",2)")),ND0=$G(@(F_+ON_",0)"))
"RTN","PSJORRE1",29,0)
 S ND2P1=$G(@(F_+ON_",2.1)")) ;*315
"RTN","PSJORRE1",30,0)
 S ND6=$P($G(@(F_+ON_",6)")),"^") S:ND6["Instructions too long. See Order View or BCMA for full text." ND6="Instructions too long. See order details for full text."
"RTN","PSJORRE1",31,0)
 S RNWDT=$$LASTREN^PSJLMPRI(DFN,ON) I RNWDT S RNWDT=+RNWDT
"RTN","PSJORRE1",32,0)
 S STAT=$$CODES^PSIVUTL($P(ND0,U,9),$S(ON["P":53.1,1:55.06),28)
"RTN","PSJORRE1",33,0)
 S NDOI=$G(@(F_+ON_",.2)")),DO=$P(NDOI,U,2)
"RTN","PSJORRE1",34,0)
 S DN(1)=$$OIDF^PSJLMUT1(NDOI) I DN(1)=""  K DN D DRGDISP^PSJLMUT1(DFN,ON,40,0,.DN,1)
"RTN","PSJORRE1",35,0)
 ;*225 Don't allow 0 units
"RTN","PSJORRE1",36,0)
 S UNITS="" I '$O(@(F_+ON_",1,1)")) S UNITS=$P($G(@(F_+ON_",1,1,0)")),U,2) S:(ON["U")&(+UNITS=0) UNITS=1
"RTN","PSJORRE1",37,0)
 S MR=$$MR(+$P(ND0,U,3)),INST=$G(@(F_+ON_",.3)"))
"RTN","PSJORRE1",38,0)
 S NOTGIVEN=$S(ON["U":$P($G(^PS(55,DFN,5,+ON,0)),"^",22),1:"")
"RTN","PSJORRE1",39,0)
 S ^TMP("PS",$J,0)=DN(1)_"^^"_$P(ND2,U,4)_"^^"_$P(ND2,U,2)_U_STAT_"^^^"_DO_U_UNITS_U_$P(ND0,U,21)_U_U_NOTGIVEN_U_($P(ND0,U,9)="P"&($P(ND0,U,24)="R"))_U_U_$G(RNWDT)
"RTN","PSJORRE1",40,0)
 S PROVIDER=$P($G(@(F_+ON_",0)")),"^",2)
"RTN","PSJORRE1",41,0)
 I PROVIDER S ^TMP("PS",$J,"P",0)=PROVIDER_"^"_$P($G(^VA(200,PROVIDER,0)),"^")
"RTN","PSJORRE1",42,0)
 S ^TMP("PS",$J,"MDR",0)=MR]"" S:MR]"" ^TMP("PS",$J,"MDR",1,0)=MR
"RTN","PSJORRE1",43,0)
 S ^TMP("PS",$J,"SCH",0)=$P(ND2,U)]"" S:$P(ND2,U)]"" ^TMP("PS",$J,"SCH",1,0)=$P(ND2,U)
"RTN","PSJORRE1",44,0)
 S:$P(ND0,U,7)]"" ^TMP("PS",$J,"SCH",0)=1,$P(^TMP("PS",$J,"SCH",1,0),U,2)=$$GTSCHT($P(ND0,U,7))_"^"_$P(ND0,U,7)
"RTN","PSJORRE1",45,0)
 S ^TMP("PS",$J,"SIG",0)=INST]"" S:INST]"" ^TMP("PS",$J,"SIG",1,0)=INST
"RTN","PSJORRE1",46,0)
 S ^TMP("PS",$J,"ADM",0)=$P(ND2,U,5)]"" S:$P(ND2,U,5)]"" ^TMP("PS",$J,"ADM",1,0)=$P(ND2,U,5)
"RTN","PSJORRE1",47,0)
 S ^TMP("PS",$J,"RMV",0)=$P(ND2P1,U,2)]"" S:$P(ND2P1,U,2)]"" ^TMP("PS",$J,"RMV",1,0)=$P(ND2P1,U,2) ;*315
"RTN","PSJORRE1",48,0)
 S ^TMP("PS",$J,"SIO",0)=ND6]"" S:ND6]"" ^TMP("PS",$J,"SIO",1,0)=ND6
"RTN","PSJORRE1",49,0)
 NEW VERPHARM S:ON["U" VERPHARM=$P($G(@(F_+ON_",4)")),U,3)
"RTN","PSJORRE1",50,0)
 S:+$G(VERPHARM) $P(^TMP("PS",$J,"RXN",0),U,5)=VERPHARM
"RTN","PSJORRE1",51,0)
 NEW PSJDD,INACTDT,NDDD,OUTOI,PSJOUT S CNT=0
"RTN","PSJORRE1",52,0)
 F PSJDD=0:0 S PSJDD=$O(@(F_+ON_",1,PSJDD)")) Q:'PSJDD  D
"RTN","PSJORRE1",53,0)
 . S NDDD=@(F_+ON_",1,PSJDD,0)")
"RTN","PSJORRE1",54,0)
 . I $P(NDDD,U,3)]"",($P(NDDD,U,3)'>DT) Q
"RTN","PSJORRE1",55,0)
 . S PSJOUT=$P($G(^PSDRUG(+NDDD,8)),U,5)
"RTN","PSJORRE1",56,0)
 . I +PSJOUT D
"RTN","PSJORRE1",57,0)
 .. S INACTDT=$G(^PSDRUG(+PSJOUT,"I")),OUTOI=+$G(^PSDRUG(+PSJOUT,2))
"RTN","PSJORRE1",58,0)
 .. I INACTDT]"",(INACTDT'>DT) S (PSJOUT,OUTOI)=""
"RTN","PSJORRE1",59,0)
 . I '+PSJOUT,($P($G(^PSDRUG(+NDDD,2)),U,3)["O") D
"RTN","PSJORRE1",60,0)
 .. S PSJOUT=+NDDD,OUTOI=+NDOI
"RTN","PSJORRE1",61,0)
 .. S INACTDT=$G(^PSDRUG(+NDDD,"I"))
"RTN","PSJORRE1",62,0)
 .. I INACTDT]"",(INACTDT'>DT) S (PSJOUT,OUTOI)=""
"RTN","PSJORRE1",63,0)
 . S UNITS=$P(NDDD,U,2) S:(ON["U")&(UNITS="") UNITS=1
"RTN","PSJORRE1",64,0)
 . S CNT=CNT+1,^TMP("PS",$J,"DD",CNT,0)=+NDDD_U_UNITS_U_PSJOUT_U_$G(OUTOI)
"RTN","PSJORRE1",65,0)
 S ^TMP("PS",$J,"DD",0)=CNT
"RTN","PSJORRE1",66,0)
 Q
"RTN","PSJORRE1",67,0)
 ;
"RTN","PSJORRE1",68,0)
IVTMP ;*** Set ^TMP for IV orders.
"RTN","PSJORRE1",69,0)
 N PROVIDER,RNWDT,IVLIM S ND0=$G(@(F_+ON_",0)")),CNT=0
"RTN","PSJORRE1",70,0)
 F X=0:0 S X=$O(@(F_+ON_",""AD"","_X_")")) Q:'X  S ND=$G(@(F_+ON_",""AD"","_X_",0)")),DN=$P($G(^PS(52.6,+ND,0)),U),Y=DN_U_$P(ND,U,2) S:$P(ND,U,3) Y=Y_U_$P(ND,U,3) S CNT=CNT+1,^TMP("PS",$J,"A",CNT,0)=Y
"RTN","PSJORRE1",71,0)
 S RNWDT=$$LASTREN^PSJLMPRI(DFN,ON) I RNWDT S RNWDT=+RNWDT
"RTN","PSJORRE1",72,0)
 S ^TMP("PS",$J,"A",0)=CNT,CNT=0
"RTN","PSJORRE1",73,0)
 F X=0:0 S X=$O(@(F_+ON_",""SOL"","_X_")")) Q:'X  S ND=$G(@(F_+ON_",""SOL"","_X_",0)")),DN=$G(^PS(52.7,+ND,0)),CNT=CNT+1,^TMP("PS",$J,"B",CNT,0)=$P(DN,U)_U_$P(ND,U,2)_U_$P(DN,U,4)
"RTN","PSJORRE1",74,0)
 S ^TMP("PS",$J,"B",0)=CNT
"RTN","PSJORRE1",75,0)
 S INST=$G(@(F_+ON_",.3)"))
"RTN","PSJORRE1",76,0)
 I ON["P" D
"RTN","PSJORRE1",77,0)
 . S SCH=$P($G(^PS(53.1,+ON,2)),U)
"RTN","PSJORRE1",78,0)
 . S PROVIDER=$P(ND0,U,2)
"RTN","PSJORRE1",79,0)
 . S MR=$$MR(+$P(ND0,U,3)),STAT=$$CODES^PSIVUTL($P(ND0,U,9),53.1,28)
"RTN","PSJORRE1",80,0)
 . S INFUS=$P($G(^PS(53.1,+ON,8)),U,5)
"RTN","PSJORRE1",81,0)
 . S ND2=$G(@(F_+ON_",2)")),START=$P(ND2,U,2),STOP=$P(ND2,U,4)
"RTN","PSJORRE1",82,0)
 . S ADM=$P(ND2,U,5),SIO=$P($G(@(F_+ON_",6)")),"^")
"RTN","PSJORRE1",83,0)
 . S:($G(SIO)["Instructions too long. See Order View or BCMA for full text") SIO="Instructions too long. See order details for full text."
"RTN","PSJORRE1",84,0)
 . S ND2P5=$G(@(F_+ON_",2.5)")) S IVLIM=$P(ND2P5,U,4) I $E(IVLIM)="a" S IVLIM="doses"_$P(IVLIM,"a",2)
"RTN","PSJORRE1",85,0)
 . I IVLIM="" S IVLIM=$P(ND2P5,U,2) S:(IVLIM'["d")&(IVLIM'["h") IVLIM=""
"RTN","PSJORRE1",86,0)
 I ON'["P"  D
"RTN","PSJORRE1",87,0)
 . S PROVIDER=$P(ND0,U,6)
"RTN","PSJORRE1",88,0)
 . S SCH=$P(ND0,U,9),INFUS=$P(ND0,U,8),STAT=$$CODES^PSIVUTL($P(ND0,U,17),55.01,100)
"RTN","PSJORRE1",89,0)
 . S MR=$$MR(+$P($G(^PS(55,DFN,"IV",+ON,.2)),U,3))
"RTN","PSJORRE1",90,0)
 . S START=$P(ND0,U,2),STOP=$P(ND0,U,3)
"RTN","PSJORRE1",91,0)
 . S ADM=$P(ND0,U,11),SIO=$P($G(@(F_+ON_",3)")),"^")
"RTN","PSJORRE1",92,0)
 . S:($G(SIO)["Instructions too long. See Order View or BCMA for full text") SIO="Instructions too long. See order details for full text."
"RTN","PSJORRE1",93,0)
 . NEW VERPHARM S VERPHARM=$P($G(^PS(55,DFN,"IV",+ON,4)),U,4)
"RTN","PSJORRE1",94,0)
 . S:+VERPHARM $P(^TMP("PS",$J,"RXN",0),U,5)=VERPHARM
"RTN","PSJORRE1",95,0)
 . S ND2P5=$G(@(F_+ON_",2.5)")) S IVLIM=$P(ND2P5,U,4) I IVLIM="" S IVLIM=$P(ND2P5,U,2) S:(IVLIM'["d")&(IVLIM'["h") IVLIM=""
"RTN","PSJORRE1",96,0)
 S DN=$G(@(F_+ON_",.2)")),DO=$P(DN,U,2)
"RTN","PSJORRE1",97,0)
 S DN=$S(+$P(DN,U):$$OIDF^PSJLMUT1($P(DN,U)),1:"")
"RTN","PSJORRE1",98,0)
 S ^TMP("PS",$J,0)=DN_U_INFUS_U_STOP_"^^"_START_U_STAT_"^^^"_DO_"^^"_$P(ND0,U,21)_U_U_U_($P(ND0,U,9)="P"&($P(ND0,U,24)="R"))_U_U_$G(RNWDT)
"RTN","PSJORRE1",99,0)
 I PROVIDER S ^TMP("PS",$J,"P",0)=PROVIDER_"^"_$P($G(^VA(200,PROVIDER,0)),"^")
"RTN","PSJORRE1",100,0)
 S ^TMP("PS",$J,"MDR",0)=MR]"" S:MR]"" ^TMP("PS",$J,"MDR",1,0)=MR
"RTN","PSJORRE1",101,0)
 S ^TMP("PS",$J,"SCH",0)=SCH]"" S:SCH]"" ^TMP("PS",$J,"SCH",1,0)=SCH
"RTN","PSJORRE1",102,0)
 I ON["P" S:$P(ND0,U,7)]"" ^TMP("PS",$J,"SCH",0)=1,$P(^TMP("PS",$J,"SCH",1,0),U,2)=$$GTSCHT($P(ND0,U,7))_"^"_$P(ND0,U,7)
"RTN","PSJORRE1",103,0)
 S ^TMP("PS",$J,"SIG",0)=INST]"" S:INST]"" ^TMP("PS",$J,"SIG",1,0)=INST
"RTN","PSJORRE1",104,0)
 S ^TMP("PS",$J,"ADM",0)=ADM]"" S:ADM]"" ^TMP("PS",$J,"ADM",1,0)=ADM
"RTN","PSJORRE1",105,0)
 S ^TMP("PS",$J,"SIO",0)=SIO]"" S:SIO]"" ^TMP("PS",$J,"SIO",1,0)=SIO
"RTN","PSJORRE1",106,0)
 I $G(IVLIM)]"" S ^TMP("PS",$J,"IVLIM",0)=$G(IVLIM)
"RTN","PSJORRE1",107,0)
 Q
"RTN","PSJORRE1",108,0)
 ;
"RTN","PSJORRE1",109,0)
MR(X) ;RETURN MED ROUTE ABBR. IF THE ABBR="" RETURN MED ROUTE'S NAME.
"RTN","PSJORRE1",110,0)
 S X=$G(^PS(51.2,X,0))
"RTN","PSJORRE1",111,0)
 Q $S($P(X,U,3)]"":$P(X,U,3),1:$P(X,U))
"RTN","PSJORRE1",112,0)
 ;
"RTN","PSJORRE1",113,0)
GTSTAT(X) ;
"RTN","PSJORRE1",114,0)
 Q $S(X="A":"ACTIVE",X="D":"DISCONTINUED",X="I":"INCOMPLETE",X="N":"NON-VERFIED",X="U":"UNRELEASED",X="P":"PENDING",X="DE":"DISCONTINUED (EDIT)",X="O":"ON CALL",1:"NOT FOUND")
"RTN","PSJORRE1",115,0)
 ;
"RTN","PSJORRE1",116,0)
VA200(X) ;Return the IEN for the user.
"RTN","PSJORRE1",117,0)
 ; X = User name
"RTN","PSJORRE1",118,0)
 NEW DIC,Y S DIC="^VA(200,",DIC(0)="NZ" D ^DIC
"RTN","PSJORRE1",119,0)
 I +Y=-1 Q ""
"RTN","PSJORRE1",120,0)
 Q $P(Y,U)
"RTN","PSJORRE1",121,0)
GTSCHT(X)       ;
"RTN","PSJORRE1",122,0)
 Q $S(X="C":"CONTINUOUS",X="O":"ONE TIME",X="P":"PRN",X="R":"FILL ON REQUEST",X="OC":"ON CALL",1:"NOT FOUND")
"UP",55,55.06,-1)
55^5
"UP",55,55.06,0)
55.06
"VER")
8.0^22.0
"^DD",53.1,53.1,137,0)
DURATION OF ADMINISTRATION^FX^^2.1;1^K:$L(X)>6!($L(X)<1) X
"^DD",53.1,53.1,137,3)
Answer must be 1-6 characters in length. Expressed in Minutes. DO NOT EDIT!
"^DD",53.1,53.1,137,10)
PSJ
"^DD",53.1,53.1,137,21,0)
^.001^2^2^3150820^^^
"^DD",53.1,53.1,137,21,1,0)
This is the period of time that a Medication Requiring Removal must remain
"^DD",53.1,53.1,137,21,2,0)
on the patient prior to removal.
"^DD",53.1,53.1,137,23,0)
^.001^3^3^3150820^^^^
"^DD",53.1,53.1,137,23,1,0)
This is the period of time in minutes.  The user enters the time in hours 
"^DD",53.1,53.1,137,23,2,0)
then they are converted to minutes to remain consistent with schedule 
"^DD",53.1,53.1,137,23,3,0)
Frequency. Only entered via Inpatient Meds
"^DD",53.1,53.1,137,"DT")
3150622
"^DD",53.1,53.1,138,0)
REMOVE TIMES^FX^^2.1;2^K:$L(X)>60!($L(X)<1) X
"^DD",53.1,53.1,138,3)
Answer must be 1-60 characters in length. DO NOT EDIT!
"^DD",53.1,53.1,138,4)
 
"^DD",53.1,53.1,138,21,0)
^.001^1^1^3150820^^^^
"^DD",53.1,53.1,138,21,1,0)
This is the set of removal times for this order.
"^DD",53.1,53.1,138,23,0)
^.001^2^2^3150820^^
"^DD",53.1,53.1,138,23,1,0)
Actual calculated Removal times based on user input.
"^DD",53.1,53.1,138,23,2,0)
Admin Time + Duration of Admin = Removal
"^DD",53.1,53.1,138,"DT")
3150623
"^DD",53.1,53.1,139,0)
REMOVE PERIOD (in minutes)^FX^^2.1;3^K:$L(X)>6!($L(X)<1) X
"^DD",53.1,53.1,139,.1)
MEDICATION FREE PERIOD
"^DD",53.1,53.1,139,3)
Answer must be 1-6 characters in length. DO NOT EDIT!
"^DD",53.1,53.1,139,10)
PSJ
"^DD",53.1,53.1,139,21,0)
^.001^3^3^3150820^^
"^DD",53.1,53.1,139,21,1,0)
Period of time in minutes calculated using the Duration of 
"^DD",53.1,53.1,139,21,2,0)
Administration and the Administration times.  
"^DD",53.1,53.1,139,21,3,0)
Only entered via PSJ OE.
"^DD",53.1,53.1,139,23,0)
^.001^3^3^3150820^^
"^DD",53.1,53.1,139,23,1,0)
Calculated field in PSJ OE.  
"^DD",53.1,53.1,139,23,2,0)
Frequency - Duration of Admin = Remove Period. Value of -1 indicates
"^DD",53.1,53.1,139,23,3,0)
optional entry for Orderable Item was declined by user.
"^DD",53.1,53.1,139,"DT")
3150818
"^DD",53.1,53.1,140,0)
BCMA PROMPT FOR REMOVAL FLAG^SX^0:No Removal Required;1:Removal at Next Administration;2:Removal Period Optional Prior to Next Administration;3:Removal Period Required Prior to Next Administration;^2.1;4^Q
"^DD",53.1,53.1,140,3)
Enter values 0 through 3 as flags. DO NOT EDIT!
"^DD",53.1,53.1,140,10)
PSJ
"^DD",53.1,53.1,140,21,0)
^.001^2^2^3150818^^
"^DD",53.1,53.1,140,21,1,0)
Orderable Item Prompt for Removal flag captured at order time.
"^DD",53.1,53.1,140,21,2,0)
DO NOT EDIT!
"^DD",53.1,53.1,140,23,0)
^.001^2^2^3150818^^^^
"^DD",53.1,53.1,140,23,1,0)
Orderable Item Prompt for Removal Flag used by BCMA. Controls method 
"^DD",53.1,53.1,140,23,2,0)
of prompting for VDL users.
"^DD",53.1,53.1,140,"DT")
3150820
"^DD",55,55.06,137,0)
DURATION OF ADMINISTRATION^FX^^2.1;1^K:$L(X)>6!($L(X)<1) X
"^DD",55,55.06,137,1,0)
^.1^^0
"^DD",55,55.06,137,3)
Answer must be 1-6 characters in length. DO NOT EDIT!
"^DD",55,55.06,137,10)
PSJ
"^DD",55,55.06,137,21,0)
^^2^2^3150813^
"^DD",55,55.06,137,21,1,0)
This is the period of time that a Medication Requiring Removal must remain
"^DD",55,55.06,137,21,2,0)
on the patient prior to removal.
"^DD",55,55.06,137,23,0)
^.001^3^3^3150813^^
"^DD",55,55.06,137,23,1,0)
This is the period of time in minutes.  The user enters the time in hours 
"^DD",55,55.06,137,23,2,0)
then they are converted to minutes to remain consistent with schedule 
"^DD",55,55.06,137,23,3,0)
Frequency. Only entered via Inpatient Meds
"^DD",55,55.06,137,"DT")
3150901
"^DD",55,55.06,138,0)
REMOVE TIMES^FX^^2.1;2^K:$L(X)>60!($L(X)<1) X
"^DD",55,55.06,138,3)
Answer must be 1-60 characters in length. DO NOT EDIT!
"^DD",55,55.06,138,10)
PSJ
"^DD",55,55.06,138,21,0)
^.001^1^1^3150623^^
"^DD",55,55.06,138,21,1,0)
This is the set of removal times for this order.
"^DD",55,55.06,138,23,0)
^.001^2^2^3150623^^
"^DD",55,55.06,138,23,1,0)
Actual calculated Removal times based on user input.
"^DD",55,55.06,138,23,2,0)
Admin Time + Duration of Admin = Removal
"^DD",55,55.06,138,"DT")
3150820
"^DD",55,55.06,139,0)
REMOVE PERIOD (in minutes)^FX^^2.1;3^K:$L(X)>6!($L(X)<1) X
"^DD",55,55.06,139,.1)
MEDICATION FREE PERIOD
"^DD",55,55.06,139,3)
Answer must be 1-6 characters in length. DO NOT EDIT!
"^DD",55,55.06,139,10)
PSJ
"^DD",55,55.06,139,21,0)
^^3^3^3150818^
"^DD",55,55.06,139,21,1,0)
Period of time in minutes calculated using the Duration of 
"^DD",55,55.06,139,21,2,0)
Administration and the Administration times.  
"^DD",55,55.06,139,21,3,0)
Only entered via PSJ OE.
"^DD",55,55.06,139,23,0)
^^3^3^3150818^^
"^DD",55,55.06,139,23,1,0)
Calculated field in PSJ OE.  
"^DD",55,55.06,139,23,2,0)
Frequency - Duration of Admin = Remove Period.  Value of -1 indicates
"^DD",55,55.06,139,23,3,0)
optional entry for Orderable Item was declined by user.
"^DD",55,55.06,139,"DT")
3150901
"^DD",55,55.06,140,0)
BCMA PROMPT FOR REMOVAL FLAG^SX^0:No Removal Required;1:Removal at Next Administration;2:Removal Period Optional Prior to Next Administration;3:Removal Period Required Prior to Next Administration;^2.1;4^Q
"^DD",55,55.06,140,3)
Enter values 0 through 3 as flags. DO NOT EDIT!
"^DD",55,55.06,140,10)
PSJ
"^DD",55,55.06,140,11,0)
^.2LAP
"^DD",55,55.06,140,21,0)
^^2^2^3150818^
"^DD",55,55.06,140,21,1,0)
Orderable Item Prompt for Removal flag captured at order time.
"^DD",55,55.06,140,21,2,0)
DO NOT EDIT!
"^DD",55,55.06,140,23,0)
^.001^2^2^3150818^^
"^DD",55,55.06,140,23,1,0)
Orderable Item Prompt for Removal Flag used by BCMA. Controls method 
"^DD",55,55.06,140,23,2,0)
of prompting for VDL users.
"^DD",55,55.06,140,"DT")
3150820
"BLD",9241,6)
^281
**END**
**END**

