Released PSJ*5*350 SEQ #296
Extracted from mail message
**KIDS**:PSJ*5.0*350^

**INSTALL NAME**
PSJ*5.0*350
"BLD",10739,0)
PSJ*5.0*350^INPATIENT MEDICATIONS^0^3171128^y
"BLD",10739,1,0)
^^4^4^3171128^
"BLD",10739,1,1,0)
1)     Admin History report has wrong data (New opton AH)
"BLD",10739,1,2,0)
2)     Hard error when deleting AUTH ABS transfer
"BLD",10739,1,3,0)
3)     Scheduled IV labels sometimes do not print
"BLD",10739,1,4,0)
4)     Scheduled IV labels are printing past the WL Stop date/time
"BLD",10739,4,0)
^9.64PA^^
"BLD",10739,6.3)
3
"BLD",10739,"KRN",0)
^9.67PA^779.2^20
"BLD",10739,"KRN",.4,0)
.4
"BLD",10739,"KRN",.401,0)
.401
"BLD",10739,"KRN",.402,0)
.402
"BLD",10739,"KRN",.403,0)
.403
"BLD",10739,"KRN",.5,0)
.5
"BLD",10739,"KRN",.84,0)
.84
"BLD",10739,"KRN",3.6,0)
3.6
"BLD",10739,"KRN",3.8,0)
3.8
"BLD",10739,"KRN",9.2,0)
9.2
"BLD",10739,"KRN",9.8,0)
9.8
"BLD",10739,"KRN",9.8,"NM",0)
^9.68A^3^3
"BLD",10739,"KRN",9.8,"NM",1,0)
PSJADT1^^0^B5915914
"BLD",10739,"KRN",9.8,"NM",2,0)
PSGAH^^0^B25669479
"BLD",10739,"KRN",9.8,"NM",3,0)
PSIVWL^^0^B33435702
"BLD",10739,"KRN",9.8,"NM","B","PSGAH",2)

"BLD",10739,"KRN",9.8,"NM","B","PSIVWL",3)

"BLD",10739,"KRN",9.8,"NM","B","PSJADT1",1)

"BLD",10739,"KRN",19,0)
19
"BLD",10739,"KRN",19.1,0)
19.1
"BLD",10739,"KRN",101,0)
101
"BLD",10739,"KRN",409.61,0)
409.61
"BLD",10739,"KRN",771,0)
771
"BLD",10739,"KRN",779.2,0)
779.2
"BLD",10739,"KRN",870,0)
870
"BLD",10739,"KRN",8989.51,0)
8989.51
"BLD",10739,"KRN",8989.52,0)
8989.52
"BLD",10739,"KRN",8994,0)
8994
"BLD",10739,"KRN","B",.4,.4)

"BLD",10739,"KRN","B",.401,.401)

"BLD",10739,"KRN","B",.402,.402)

"BLD",10739,"KRN","B",.403,.403)

"BLD",10739,"KRN","B",.5,.5)

"BLD",10739,"KRN","B",.84,.84)

"BLD",10739,"KRN","B",3.6,3.6)

"BLD",10739,"KRN","B",3.8,3.8)

"BLD",10739,"KRN","B",9.2,9.2)

"BLD",10739,"KRN","B",9.8,9.8)

"BLD",10739,"KRN","B",19,19)

"BLD",10739,"KRN","B",19.1,19.1)

"BLD",10739,"KRN","B",101,101)

"BLD",10739,"KRN","B",409.61,409.61)

"BLD",10739,"KRN","B",771,771)

"BLD",10739,"KRN","B",779.2,779.2)

"BLD",10739,"KRN","B",870,870)

"BLD",10739,"KRN","B",8989.51,8989.51)

"BLD",10739,"KRN","B",8989.52,8989.52)

"BLD",10739,"KRN","B",8994,8994)

"BLD",10739,"QDEF")
^^^^NO^^^^^^NO
"BLD",10739,"QUES",0)
^9.62^^
"BLD",10739,"REQB",0)
^9.611^3^3
"BLD",10739,"REQB",1,0)
PSJ*5.0*83^2
"BLD",10739,"REQB",2,0)
PSJ*5.0*305^2
"BLD",10739,"REQB",3,0)
PSJ*5.0*315^2
"BLD",10739,"REQB","B","PSJ*5.0*305",2)

"BLD",10739,"REQB","B","PSJ*5.0*315",3)

"BLD",10739,"REQB","B","PSJ*5.0*83",1)

"MBREQ")
0
"PKG",471,-1)
1^1
"PKG",471,0)
INPATIENT MEDICATIONS^PSJ^UNIT DOSE AND IVS
"PKG",471,20,0)
^9.402P^^
"PKG",471,22,0)
^9.49I^1^1
"PKG",471,22,1,0)
5.0^2971215^2990325^66481
"PKG",471,22,1,"PAH",1,0)
350^3171128
"PKG",471,22,1,"PAH",1,1,0)
^^4^4^3171128
"PKG",471,22,1,"PAH",1,1,1,0)
1)     Admin History report has wrong data (New opton AH)
"PKG",471,22,1,"PAH",1,1,2,0)
2)     Hard error when deleting AUTH ABS transfer
"PKG",471,22,1,"PAH",1,1,3,0)
3)     Scheduled IV labels sometimes do not print
"PKG",471,22,1,"PAH",1,1,4,0)
4)     Scheduled IV labels are printing past the WL Stop date/time
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
3
"RTN","PSGAH")
0^2^B25669479^B25445995
"RTN","PSGAH",1,0)
PSGAH ;ALB/DRP - ADMINISTRATION HISTORY RPT ;29 Oct 2015 12:44 PM
"RTN","PSGAH",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**315,350**;16 DEC 97;Build 3
"RTN","PSGAH",3,0)
 ;Per VHA Directive 2004-038 (or future revisions regarding same), this routine should not be modified.
"RTN","PSGAH",4,0)
 ;
"RTN","PSGAH",5,0)
 ;Call to MEDHIST^PSBUTL controlled by IA 6271
"RTN","PSGAH",6,0)
 ;
"RTN","PSGAH",7,0)
 Q
"RTN","PSGAH",8,0)
 ;Routine is called by Hidden Actions Menu so DFN variable will be passed in from the Menu
"RTN","PSGAH",9,0)
INIT ; Initialize Variables
"RTN","PSGAH",10,0)
 I '$$PATCH^XPDUTL("PSB*3.0*83") W !,"Report not available until install of patch PSB*3.0*83" S TERM=1 D PAUSE Q
"RTN","PSGAH",11,0)
 I ($G(ON)["V") W !,"AH Report cannot be run for this order. Use CPRS or BCMA to find Admin history." S TERM=1 D PAUSE Q
"RTN","PSGAH",12,0)
 I ($G(ON)["P"),$P($G(^PS(53.1,+ON,0)),U,4)'["U" W !,"AH Report cannot be run for this order. Use CPRS or BCMA to find Admin history." S TERM=1 D PAUSE Q
"RTN","PSGAH",13,0)
 Q:$G(DFN)=""
"RTN","PSGAH",14,0)
 N PSGACAR,PSGQ,PSGORD,PSGOIEN,PSGSPCE,PSGMRT,PSGSCH,PSGDRNG,PSGLOC
"RTN","PSGAH",15,0)
 N TERM,PSGACT,COUNT,PAGNO,PSGDSG,PSGIN
"RTN","PSGAH",16,0)
 N $ESTACK,$ETRAP S $ETRAP="D ERRTRP^PSGAH" ;
"RTN","PSGAH",17,0)
 S PSGOIEN=$G(PSGOPD) Q:'PSGOIEN
"RTN","PSGAH",18,0)
 S $P(PSGSPCE," ",30)="",COUNT=0
"RTN","PSGAH",19,0)
 D ENCV^PSGSETU Q:$D(XQUIT)
"RTN","PSGAH",20,0)
 D FULL^VALM1,PRMTRNG,MAIN
"RTN","PSGAH",21,0)
 K ^XTMP("PSGAH",$J)
"RTN","PSGAH",22,0)
 Q
"RTN","PSGAH",23,0)
 ;
"RTN","PSGAH",24,0)
MAIN ; Main control
"RTN","PSGAH",25,0)
 Q:$G(PSGQ)
"RTN","PSGAH",26,0)
 D OPEN^%ZISUTL("PSGAH",,) I $G(POP) W !!,"Nothing queued to print.",! Q
"RTN","PSGAH",27,0)
 S:$E(IOSL,1)'["9" TERM=$S($E($G(IOST),1,2)="C-":1,1:0)
"RTN","PSGAH",28,0)
 U IO S PAGNO=0
"RTN","PSGAH",29,0)
 ;Get OI then get all orders for OI within time frame determined by ?
"RTN","PSGAH",30,0)
 D GETHIST D:$D(PSGACAR) GETORD
"RTN","PSGAH",31,0)
 D PRNHDR,WRITE
"RTN","PSGAH",32,0)
 W !!,"Press RETURN to continue....." R X:$G(DTIME) ;pause before returning to Detail screen
"RTN","PSGAH",33,0)
 D CLOSE^%ZISUTL("PSGAH")
"RTN","PSGAH",34,0)
 K POP
"RTN","PSGAH",35,0)
 Q
"RTN","PSGAH",36,0)
 ;
"RTN","PSGAH",37,0)
GETORD ; Get order information
"RTN","PSGAH",38,0)
 N I,STR,PSGCUR S I=0
"RTN","PSGAH",39,0)
 F  S I=$O(PSGACAR(I)) Q:'I  D
"RTN","PSGAH",40,0)
 . S STR=PSGACAR(I),PSGCUR=0,PSGIN=$P(STR,U,6),PSGLOC=$P(STR,U,5)
"RTN","PSGAH",41,0)
 . Q:$P(STR,U,3)["V"
"RTN","PSGAH",42,0)
 . S PSGORD=+$P(STR,U,3),PSGACT=$P(STR,U,2) S:PSGORD=+$G(ON) PSGCUR=1 ;ON passed in from Menu
"RTN","PSGAH",43,0)
 . S PSGMRT=$P($G(^PS(55,DFN,5,PSGORD,0)),U,3),PSGMRT=$P(^PS(51.2,PSGMRT,0),U,1)
"RTN","PSGAH",44,0)
 . S PSGSCH=$P($G(^PS(55,DFN,5,PSGORD,2)),U,1)
"RTN","PSGAH",45,0)
 . S PSGDSG=$P($G(^PS(55,DFN,5,PSGORD,.2)),U,2)
"RTN","PSGAH",46,0)
 . D SETTMP(I)        ;check and then set ^XTMP for sort
"RTN","PSGAH",47,0)
 .Q
"RTN","PSGAH",48,0)
 Q
"RTN","PSGAH",49,0)
 ;
"RTN","PSGAH",50,0)
GETHIST ; Get last 99 actions for each OI Dosage
"RTN","PSGAH",51,0)
 ;MEDHIST(LIST,DFN,OI,MAX) ;Last nn admin actions per a patients Orderable Item
"RTN","PSGAH",52,0)
 ; Input:
"RTN","PSGAH",53,0)
 ;   DFN - Patient num
"RTN","PSGAH",54,0)
 ;   OI  - Inpatient Meds Orderable Item ien
"RTN","PSGAH",55,0)
 ;   MAX - Max days back to search
"RTN","PSGAH",56,0)
 ; Output:
"RTN","PSGAH",57,0)
 ;   LIST - Array of actions formatted as :
"RTN","PSGAH",58,0)
 ;     DATE^ACTION^ORDNO^LSTSITE^LOCATION^NURSINITL
"RTN","PSGAH",59,0)
 D MEDHIST^PSBUTL(.PSGACAR,DFN,PSGOIEN,PSGDRNG) ;ZW PSGACAR
"RTN","PSGAH",60,0)
 Q
"RTN","PSGAH",61,0)
 ;
"RTN","PSGAH",62,0)
 ;The following items were requested for this new report:  
"RTN","PSGAH",63,0)
 ;Dose. 
"RTN","PSGAH",64,0)
 ;All administrations for the Orderable Item
"RTN","PSGAH",65,0)
 ;Sorted by time. 
"RTN","PSGAH",66,0)
 ;Grouped by all administrations by orderable item for that patient.
"RTN","PSGAH",67,0)
SETTMP(ORDDT) ; Builds ^XTMP for sort
"RTN","PSGAH",68,0)
 S ^XTMP("PSGAH",$J,ORDDT,PSGORD)=PSGDSG_U_PSGMRT_U_PSGSCH_$S(PSGCUR:"-Current",1:"")_U_PSGACT_U_PSGIN_U_PSGLOC
"RTN","PSGAH",69,0)
 Q
"RTN","PSGAH",70,0)
 ;
"RTN","PSGAH",71,0)
WRITE ; WRITE records to output
"RTN","PSGAH",72,0)
 ;        "DOSAGE ORDERD"_" "_MED ROUTE (INTERNAL)_" "_SCHEDULE(INTERNAL)_$S(CURRENT ORDER:"(*)",1:"")
"RTN","PSGAH",73,0)
 N DATE,ORDER,STR S DATE=9999999
"RTN","PSGAH",74,0)
 F  S DATE=$O(^XTMP("PSGAH",$J,DATE),-1) Q:DATE=""!$G(PSGQ)  D
"RTN","PSGAH",75,0)
 . S ORDER=0
"RTN","PSGAH",76,0)
 . F  S ORDER=$O(^XTMP("PSGAH",$J,DATE,ORDER)) Q:ORDER=""!$G(PSGQ)  D
"RTN","PSGAH",77,0)
 ..S STR=^XTMP("PSGAH",$J,DATE,ORDER),PSGDSG=$P(STR,U,1),PSGMRT=$P(STR,U,2),PSGSCH=$P(STR,U,3),PSGACT=$P(STR,U,4)
"RTN","PSGAH",78,0)
 ..S PSGIN=$P(STR,U,5),PSGLOC=$P(STR,U,6)
"RTN","PSGAH",79,0)
 ..D PRNLN
"RTN","PSGAH",80,0)
 ..Q
"RTN","PSGAH",81,0)
 .Q
"RTN","PSGAH",82,0)
 Q
"RTN","PSGAH",83,0)
 ;
"RTN","PSGAH",84,0)
PRNHDR ; Heading
"RTN","PSGAH",85,0)
 Q:$G(PSGQ)
"RTN","PSGAH",86,0)
 S PAGNO=PAGNO+1
"RTN","PSGAH",87,0)
 W @IOF
"RTN","PSGAH",88,0)
 W ! W:'$G(TERM) ?5 W $E($$FMTE^XLFDT($$NOW^XLFDT),1,18)
"RTN","PSGAH",89,0)
 W ! W:'$G(TERM) ?5 W "Administration History for Orderable Item ",?73,"Page ",PAGNO
"RTN","PSGAH",90,0)
 W ! W:'$G(TERM) ?10 W $G(PSGOPDN)
"RTN","PSGAH",91,0)
 W ! W:'$G(TERM) ?5 W "Date             Action  Initials Location"
"RTN","PSGAH",92,0)
 W ! W:'$G(TERM) ?8 W "Dosage Ordered                  Med Route     Schedule"
"RTN","PSGAH",93,0)
 W ! W:'$G(TERM) ?5 W "---------------------------------------------------------------------------"
"RTN","PSGAH",94,0)
 Q
"RTN","PSGAH",95,0)
 ;
"RTN","PSGAH",96,0)
PRNLN ;Write line on report
"RTN","PSGAH",97,0)
 ;N ACTLBL S ACTLBL=$S(COUNT:"PREVIOUS ACTION "_COUNT_" ",1:"LAST ACTION: ")
"RTN","PSGAH",98,0)
 W ! W:'$G(TERM) ?5 W $E($P($$FMTE^XLFDT(DATE,5),":",1,2)_PSGSPCE,1,16)_" "_$E(PSGACT_PSGSPCE,1,6)_"  "_$E(PSGIN_PSGSPCE,1,8)_" "_$G(PSGLOC,"UNKNOWN")
"RTN","PSGAH",99,0)
 W ! W:'$G(TERM) ?8 W $E(PSGDSG_PSGSPCE,1,30)_"  "_$E(PSGMRT_PSGSPCE,1,12)_"  "_$E(PSGSCH_PSGSPCE,1,30),!
"RTN","PSGAH",100,0)
 S COUNT=COUNT+1
"RTN","PSGAH",101,0)
 I $Y>(IOSL-2) D:$G(TERM) PAUSE D PRNHDR
"RTN","PSGAH",102,0)
 Q
"RTN","PSGAH",103,0)
 ;
"RTN","PSGAH",104,0)
PAUSE Q:'($G(TERM))
"RTN","PSGAH",105,0)
 N X
"RTN","PSGAH",106,0)
 U IO(0) W !!,"Press RETURN to continue, '^' to exit"
"RTN","PSGAH",107,0)
 R X:$G(DTIME) I (X="^")!('$T) S PSGQ=1 Q
"RTN","PSGAH",108,0)
 U IO
"RTN","PSGAH",109,0)
 Q
"RTN","PSGAH",110,0)
PRMTRNG ; prompt for number of Days back to return
"RTN","PSGAH",111,0)
 K DIR,DTOUT,DUOUT,DIRUT,DIROUT
"RTN","PSGAH",112,0)
 S DIR(0)="N^1:99999:0"
"RTN","PSGAH",113,0)
 S DIR("A")="Enter Number of days back to search",DIR("B")="14"
"RTN","PSGAH",114,0)
 S DIR("?")="Enter an  '^' to exit this option now."
"RTN","PSGAH",115,0)
 S DIR("?",1)="Enter the number days prior to today to search the BCMA MEDICATION LOG"
"RTN","PSGAH",116,0)
 S DIR("?",2)="All BCMA orders within indicated range will be included"
"RTN","PSGAH",117,0)
 S DIR("?",3)=""
"RTN","PSGAH",118,0)
 S DIR("?",4)=""
"RTN","PSGAH",119,0)
 D ^DIR S PSGDRNG=$S($D(DIRUT):0,1:Y) S:$D(DIRUT) PSGQ=1
"RTN","PSGAH",120,0)
 K DIR,DIRUT,Y
"RTN","PSGAH",121,0)
 Q
"RTN","PSGAH",122,0)
 ;
"RTN","PSGAH",123,0)
ERRTRP ; Error trap processing
"RTN","PSGAH",124,0)
 N Z,PROBLEM
"RTN","PSGAH",125,0)
 S Z(1,1)=$$EC^%ZOSV ; mumps error location and description
"RTN","PSGAH",126,0)
 S Z="A SYSTEM ERROR HAS BEEN DETECTED AT THE FOLLOWING LOCATION"
"RTN","PSGAH",127,0)
 S PROBLEM=7
"RTN","PSGAH",128,0)
 D ^%ZTER ; record the error in the trap
"RTN","PSGAH",129,0)
 G UNWIND^%ZTER ; unwind stack levels
"RTN","PSGAH",130,0)
 Q
"RTN","PSIVWL")
0^3^B33435702^B33431217
"RTN","PSIVWL",1,0)
PSIVWL ;BIR/RGY,PR - COMPILE AND PRT WARD LIST ;13 MAR 97 / 10:18 AM
"RTN","PSIVWL",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**41,54,74,84,93,110,111,141,305,350**;16 DEC 97;Build 3
"RTN","PSIVWL",3,0)
 ;
"RTN","PSIVWL",4,0)
 ; Reference to ^PS(51.1 is supported by DBIA 2177
"RTN","PSIVWL",5,0)
 ; Reference to ^PS(55 is supported by DBIA 2191
"RTN","PSIVWL",6,0)
 ;
"RTN","PSIVWL",7,0)
 K WRD W !!,"Run ward list for DATE: TODAY//" R X:DTIME S:'$T X="^" S:X="" X="T" G Q:X["^" K %DT S %DT="XE" D ^%DT G:Y<0 PSIVWL
"RTN","PSIVWL",8,0)
 S PSIVDT=Y\1 I Y<DT D ENRSET^PSIVWL1 G PSIVWL
"RTN","PSIVWL",9,0)
 D ^PSIVWL1 I '$D(PSIVOD)!('$D(PSIVCD)) G Q
"RTN","PSIVWL",10,0)
 I PSIVPR'=ION D QUE G Q
"RTN","PSIVWL",11,0)
DEQ ;
"RTN","PSIVWL",12,0)
 N PSJOK
"RTN","PSIVWL",13,0)
 D NOW^%DTC S Y=% L +^PS(55,"PSIVWL",PSIVSN):1 E  W:$Y @IOF W !!,"**** WARNING --- WARD LIST NOT RUN, LABEL RUN IN PROGRESS ****" G Q
"RTN","PSIVWL",14,0)
 D:$D(XRTL) T0^%ZOSV S NOFLG=0
"RTN","PSIVWL",15,0)
 S PSIVT="" D ENINIT^PSIVWL1 F PSIV1=0:0 S PSIVT=$O(PSIVOD(PSIVT)) Q:PSIVT=""  S PSIVDT1=PSIVOD(PSIVT)-.0001 F PSIV1=0:0 S PSIVDT1=$O(^PS(55,"AIV",PSIVDT1)) Q:'PSIVDT1  D MAN1
"RTN","PSIVWL",16,0)
 I $D(XRTL) S XRTN="PSIVWL" D T1^%ZOSV
"RTN","PSIVWL",17,0)
 D ENT^PSIVWL1
"RTN","PSIVWL",18,0)
Q L -^PS(55,"PSIVWL",PSIVSN) W:'$D(PSIVPR)&($Y) @IOF K MI,ON,NOFLG,PSCT,PSGCNT,PSGSA,PSIVMT,DIC,PSIVRUN,%DT,PSIVDT1,PSIVDT,PSIV,PSIVOD
"RTN","PSIVWL",19,0)
 K PSIVCD,PSM,%T,D,DFN,I,P,PSIV1,VAERR,X,Y,Z,Z1,Z2,ZTSK S:$D(ZTQUEUED) ZTREQ="@"
"RTN","PSIVWL",20,0)
 Q
"RTN","PSIVWL",21,0)
SETP S Y=^PS(55,DFN,"IV",ON,0) F X=1:1:23 S P(X)=$P(Y,"^",X)
"RTN","PSIVWL",22,0)
 N A,PSJST
"RTN","PSIVWL",23,0)
 S PSJST=$$ONE^PSJBCMA(DFN,ON,P(9))
"RTN","PSIVWL",24,0)
 S PSJOK=1 I PSJST="O" S A=0 F  S A=$O(^PS(55,DFN,"IV",+ON,"LAB",A)) Q:A=""  I $P($G(^(A,0)),"^",3)=1 S PSJOK=0 Q
"RTN","PSIVWL",25,0)
 Q
"RTN","PSIVWL",26,0)
MAN1 F DFN=0:0 S DFN=$O(^PS(55,"AIV",PSIVDT1,DFN)) Q:'DFN  S PSIV("NME")=$P($G(^DPT(DFN,0)),U) D INP^VADPT F ON=0:0 S ON=$O(^PS(55,"AIV",PSIVDT1,DFN,ON)) Q:'ON  Q:NOFLG=1  D SETP I PSJOK D MAN3
"RTN","PSIVWL",27,0)
 Q
"RTN","PSIVWL",28,0)
MAN2 S ^PS(55,"PSIVWL",PSIVSN,$S($P(VAIN(4),U,2)]"":$P(VAIN(4),U,2),1:"Outpatient IV"),P(4)_PSIVOD(P(4)),DFN,ON)=$S($P(P(8),"@",2)'=0:PSGCNT,1:0)_"^"_PSGSA_"^"_$P(^PS(55,DFN,"IV",ON,0),"^",16)
"RTN","PSIVWL",29,0)
 ;naked reference on line below refers to full global reference to right of = sign
"RTN","PSIVWL",30,0)
 S $P(^(0),"^",16)=$P(^PS(55,DFN,"IV",ON,0),"^",16)+PSGCNT Q
"RTN","PSIVWL",31,0)
 Q
"RTN","PSIVWL",32,0)
MAN3 ;I P(4)=""!(P(4)'=PSIVT) S NOFLG=1 D NOW^%DTC S PSIVRUN=$E(%,1,12) K %,%I,%H D HDR^PSIVWL1 W !!,"****NO DATA FOUND FOR THIS REPORT!***" Q
"RTN","PSIVWL",33,0)
 Q:P(4)=""!(P(4)'=PSIVT)
"RTN","PSIVWL",34,0)
 Q:'$D(PSIVOD(P(4)))!("DPN"[P(17))!($S($D(^PS(55,DFN,"IV",ON,2)):PSIVSN'=$P(^(2),"^",2),1:0))
"RTN","PSIVWL",35,0)
 I "OH"[P(17) S PSGSA="",PSGCNT=0 D MAN2 Q
"RTN","PSIVWL",36,0)
 S CD=$S(PSIVCD(PSIVT)<P(3):PSIVCD(PSIVT),1:P(3)),OD=$S(P(2)>PSIVOD(PSIVT):P(2),1:PSIVOD(PSIVT)) D ENP3,MAN2 Q
"RTN","PSIVWL",37,0)
QUE S ZTIO=PSIVPR,ZTDESC="IV WARD LIST",ZTRTN="DEQ^PSIVWL",PSIVT="" F I=0:0 S PSIVT=$O(PSIVMT(PSIVT)) Q:PSIVT=""  S (ZTSAVE("PSIVCD("""_PSIVT_""")"),ZTSAVE("PSIVMT("""_PSIVT_""")"),ZTSAVE("PSIVOD("""_PSIVT_""")"))=""
"RTN","PSIVWL",38,0)
 F X="PSIVSN","PSIVDT","PSIVSITE","PSJSYSW0","PSJSYSP0","PSJSYSU" S ZTSAVE(X)=""
"RTN","PSIVWL",39,0)
 D ^%ZTLOAD W:$D(ZTSK) !,"Queued." Q
"RTN","PSIVWL",40,0)
ENP3 ;
"RTN","PSIVWL",41,0)
 ;Needs DFN,ON P-array, OD and CD
"RTN","PSIVWL",42,0)
 Q:'P(2)!'P(3)  S PSIVMI=P(15),PSIVSD=P(2),PSGSA="",PSGCNT=0 S:PSIVMI>1440 P(11)=""
"RTN","PSIVWL",43,0)
 I P(11) G:"AH"[P(4) QSP F X="STAT","ONCE","NOW","ONE-TIME","ONE TIME","ONETIME","1-TIME","1 TIME","1-TIME" I $S(X=P(9):1,1:(P(9)[X)),PSIVSD'<OD,PSIVSD'>CD S PSGSA=PSIVSD_" " G QSP
"RTN","PSIVWL",44,0)
 I P(4)="P"!(P(5))!(P(23)="P"),P(11) D CHK,ENP4 G QSP
"RTN","PSIVWL",45,0)
 G:P(11) QSP I PSIVMI,OD\1>(PSIVSD\1) S X1=OD,X2=PSIVSD D ^%DTC I X>1 S X=X-1,PSIVMIN=X*1440\PSIVMI*PSIVMI D ENT S PSIVSD=Y
"RTN","PSIVWL",46,0)
 I PSIVSD'<OD,PSIVSD'>CD S Y=PSIVSD,PSGSA=Y_" "
"RTN","PSIVWL",47,0)
 I PSIVMI F X=0:0 S PSIVMIN=PSIVMI D ENT Q:Y>CD!(Y=CD&(CD=P(3)))  S PSIVSD=Y I Y'<OD,Y'>CD S:$L(PSGSA)+$L(Y)'>240 PSGSA=PSGSA_$S(PSGSA'="":"."_$P(Y,".",2),1:Y)_" "
"RTN","PSIVWL",48,0)
QSP S PSGCNT=$L(PSGSA," ")-1 K PSIVMI,OD,CD,PSIVSD S:P(7)=1!($G(P("NUMLBL"))=0) PSGCNT=0 Q  ;PSJ*5*141 Add P(7) check, *305
"RTN","PSIVWL",49,0)
CHK F Y=1:1 Q:$L(P(11))>240!($P(P(11),"-",Y)="")  S $P(P(11),"-",Y)=$P(P(11),"-",Y)_$E("0000",1,4-$L($P(P(11),"-",Y)))
"RTN","PSIVWL",50,0)
 Q
"RTN","PSIVWL",51,0)
ENP4 Q:PSIVSD>CD  S PSIVSD=OD\1 I $G(P(2)),PSIVSD<P(2) S PSIVSD=P(2)\1
"RTN","PSIVWL",52,0)
 NEW ODCDWD,ADM,ADMSD,ADMTM,PSIVX,P9
"RTN","PSIVWL",53,0)
 F X=OD,CD D DW^%DTC S ODCDWD=$G(ODCDWD)_$E(X,1,3)_U
"RTN","PSIVWL",54,0)
 I +$O(^PS(51.1,"APPSJ",P(9),0)) S PSIVX=1 S P9=$P(P(9),"@") F X=1:1:$L(P9,"-") D  Q:'$G(PSIVX)
"RTN","PSIVWL",55,0)
 . I '("MON,TUE,WED,THU,FRI,SAT,SUN,"[$P(P9,"-",X)) S PSIVX=0 Q
"RTN","PSIVWL",56,0)
 . I ODCDWD[$E($P(P9,"-",X),1,2) D
"RTN","PSIVWL",57,0)
 .. S ADMSD=$S($P(ODCDWD,"^")[$P(P9,"-",X):OD,1:CD)\1
"RTN","PSIVWL",58,0)
 .. F ADM=1:1:$L(P(11),"-") S ADMTM=$P(P(11),"-",ADM) I OD'>(ADMSD_"."_ADMTM),(CD'<(ADMSD_"."_ADMTM)) S PSGSA=PSGSA_$S(PSGSA'="":"",1:ADMSD)_"."_ADMTM_" "
"RTN","PSIVWL",59,0)
 .. ;F ADM=1:1:$L(P(11),"-") S ADMTM=$P(P(11),"-",ADM) I OD'>(ADMSD_"."_ADMTM),(CD'<(ADMSD_"."_ADMTM)) S PSGSA=PSGSA_$S(PSGSA'="":"",1:PSIVSD)_"."_ADMTM_" "
"RTN","PSIVWL",60,0)
 Q:+$G(PSIVX)
"RTN","PSIVWL",61,0)
 I '$D(^PS(51.1,"APPSJ",P(9))) S PSIVX=1,P9=$P(P(9),"@") F X=1:1:$L(P9,"-") D  Q:'$G(PSIVX)
"RTN","PSIVWL",62,0)
 . I '(",MO,TU,WE,TH,FR,SA,SU,"[(","_$P(P9,"-",X)_",")) S PSIVX=0 Q
"RTN","PSIVWL",63,0)
 . I ODCDWD[$E($P(P9,"-",X),1,2) D
"RTN","PSIVWL",64,0)
 .. S ADMSD=$S($P(ODCDWD,"^")[$P(P9,"-",X):OD,1:CD)\1
"RTN","PSIVWL",65,0)
 .. F ADM=1:1:$L(P(11),"-") S ADMTM=$P(P(11),"-",ADM) I OD'>(ADMSD_"."_ADMTM),(CD'<(ADMSD_"."_ADMTM)) S PSGSA=PSGSA_$S(PSGSA'="":"",1:ADMSD)_"."_ADMTM_" "
"RTN","PSIVWL",66,0)
 .. ;F ADM=1:1:$L(P(11),"-") S ADMTM=$P(P(11),"-",ADM) I OD'>(ADMSD_"."_ADMTM),(CD'<(ADMSD_"."_ADMTM)) S PSGSA=PSGSA_$S(PSGSA'="":"",1:PSIVSD)_"."_ADMTM_" "
"RTN","PSIVWL",67,0)
 Q:+$G(PSIVX)
"RTN","PSIVWL",68,0)
 F Y=1:1 S (PSIVMI,MI)=$P(P(11),"-",Y),PSIVSD=+(PSIVSD\1_"."_MI) Q:PSIVSD>CD  X:MI="" "S X1=PSIVSD,X2=1 D C^%DTC S PSIVSD=X,Y=0" I MI,PSIVSD'<OD,PSIVSD'>CD,PSIVSD'=P(3),'P(7) S PSGSA=PSGSA_$S(PSGSA'="":"."_$P(PSIVSD,".",2),1:PSIVSD)_" "
"RTN","PSIVWL",69,0)
 ; INSTALL PRECEEDING LINE WITH VERSION 17.3 OF FILEMAN
"RTN","PSIVWL",70,0)
 Q
"RTN","PSIVWL",71,0)
ENT ;PSIVMIN=# of min. to add or sub, PSIVSD=date to add or sub from in FM format -- Answer ret. in 'Y'
"RTN","PSIVWL",72,0)
 S X2=PSIVMIN\1440,HOUR=(PSIVMIN-(1440*X2))\60,MIN=(PSIVMIN-(1440*X2)-(60*HOUR))#$S(PSIVMIN<0:-60,1:60),X1=PSIVSD\1,HR=$E(PSIVSD,9,10),MI=$E(PSIVSD,11,12)
"RTN","PSIVWL",73,0)
 S:$L(HR)=1 HR=HR_0 S:$L(MI)=1 MI=MI_0 S MI=MI+MIN S:MI>59 MI=MI-60,HR=HR+1
"RTN","PSIVWL",74,0)
 S:MI<0 MI=MI+60,HR=HR-1 S HR=HR+HOUR S:HR>23 HR=HR-24,X2=X2+1 S:HR<0 HR=HR+24,X2=X2-1 S:HR+MI=0 X2=X2-1,HR=24,MI=0 S:HR<10 HR=0_HR S:MI<10 MI=0_MI S X=X1 D:X2 C^%DTC S X=$P(X,".") S Y=+(X_"."_HR_MI)
"RTN","PSIVWL",75,0)
 ; install with version 17.3 of fm
"RTN","PSIVWL",76,0)
 K HR,MI,X1,X2,HOUR,MIN,PSIVMIN,O,MI Q
"RTN","PSJADT1")
0^1^B5915914^B5799392
"RTN","PSJADT1",1,0)
PSJADT1 ;BIR/CML3 - AUTO CANCEL/HOLD UTILITIES ;17 JAN 96 / 10:11 AM
"RTN","PSJADT1",2,0)
 ;;5.0;INPATIENT MEDICATIONS ;**30,37,51,83,350**;16 DEC 97;Build 3
"RTN","PSJADT1",3,0)
 ;
"RTN","PSJADT1",4,0)
 ; Reference to ^PS(55 is supported by DBIA# 2191.
"RTN","PSJADT1",5,0)
 ; Reference to ^PS(59.7 is supported by DBIA# 2181.
"RTN","PSJADT1",6,0)
 ;
"RTN","PSJADT1",7,0)
ENUW ; update ward and treating specialty
"RTN","PSJADT1",8,0)
 D INP^VADPT,NOW^%DTC F Q1=%:0 S Q1=$O(^PS(55,PSGP,5,"AUS",Q1)) Q:'Q1  F Q2=0:0 S Q2=$O(^PS(55,PSGP,5,"AUS",Q1,Q2)) Q:'Q2  D
"RTN","PSJADT1",9,0)
 .I $D(^PS(55,PSGP,5,Q2,0)) S $P(^(0),"^",23)=+VAIN(4),^PS(55,"AUE",PSGP,Q2)=""
"RTN","PSJADT1",10,0)
 F ON=0:0 S ON=$O(^PS(55,PSGP,"IV",ON)) Q:'ON  I $D(^(ON,0)) S $P(^(0),"^",22)=+VAIN(4)
"RTN","PSJADT1",11,0)
 Q
"RTN","PSJADT1",12,0)
 ;
"RTN","PSJADT1",13,0)
ENHOLD(PSGOEHA,PSJDEL,PSJPAD,PSGALO) ;
"RTN","PSJADT1",14,0)
 ; place orders on/off hold
"RTN","PSJADT1",15,0)
 S X=PSGOEHA W:'$D(DGQUIET) !,"...",$S(X:"plac",1:"tak"),"ing Inpatient Medication orders o",$S(X:"n",1:"ff")," of hold..."
"RTN","PSJADT1",16,0)
 D NOW^%DTC S PSGDT=+$E(%,1,12),PSGOEHA='PSGOEHA D ENACH^PSGOEHA
"RTN","PSJADT1",17,0)
 S DFN=PSGP,PSIVNST="H" I 'PSGOEHA D ^PSIVHLD
"RTN","PSJADT1",18,0)
 I PSGOEHA D START^PSIVHLD
"RTN","PSJADT1",19,0)
 I 'PSGOEHA S X=PSJDEL,X=$S(X=3:2,X=22:2,X=26:2,1:1),$P(PSJPIND,"^",7)=2,$P(PSJPIND,"^",10)="Transferred "_$P("A^Una",U,X)_"uthorized Absence" Q
"RTN","PSJADT1",20,0)
 S $P(PSJPIND,"^",7)="",$P(PSJPIND,"^",10)="" G ENUW
"RTN","PSJADT1",21,0)
 ;
"RTN","PSJADT1",22,0)
ENDEL(DFN,DGPMP,PSJTMT,PSJDEL) ;
"RTN","PSJADT1",23,0)
 ;Undo mvmt action if movement is deleted.
"RTN","PSJADT1",24,0)
 N VAIP S VAIP("D")=+DGPMP D IN5^VADPT Q:VAIP(16)
"RTN","PSJADT1",25,0)
 ; Add call to PSJADT0 to dc active/non-verified orders for cancelled admissions.
"RTN","PSJADT1",26,0)
 I PSJDEL=1 D  Q
"RTN","PSJADT1",27,0)
 . S PSJPAD=+VAIP(13,1),PSGALO=1035
"RTN","PSJADT1",28,0)
 . N VAIP D IN5^VADPT Q:+VAIP(13,1)>PSJPAD
"RTN","PSJADT1",29,0)
 . D ENDC^PSJADT0
"RTN","PSJADT1",30,0)
 I PSJDEL=3 D ENUNDC^PSJADT0(+DGPMP,DFN,VAIP(5),18540) Q
"RTN","PSJADT1",31,0)
 I PSJDEL=6 D ENUNDC^PSJADT0(+DGPMP,DFN,VAIP(5),18550) Q
"RTN","PSJADT1",32,0)
 I PSJTMT=4 D ENUNDC^PSJADT0(+DGPMP,DFN,VAIP(5),18550) Q
"RTN","PSJADT1",33,0)
 I PSJTMT<4 D
"RTN","PSJADT1",34,0)
 .I $P($G(^PS(55,DFN,5.1)),U,7),$P(^(5.1),U,10)["Transferred" D ENHOLD(0,PSJDEL,+DGPMP,8090)
"RTN","PSJADT1",35,0)
 .S:'$D(VAIP(5)) VAIP(5)=DGPMVI(5)
"RTN","PSJADT1",36,0)
 .D ENUNDC^PSJADT0(+DGPMP,DFN,VAIP(5),18550)
"RTN","PSJADT1",37,0)
 I PSJTMT>21,(PSJTMT<27) S X=PSJTMT I $P($G(^PS(59.7,1,22,+VAIP(5),0)),U,$S(X=22!(X=26):4,X=23:2,1:3)) D ENHOLD(1,X,+DGPMP,8590)
"RTN","PSJADT1",38,0)
 Q
"RTN","PSJADT1",39,0)
  
"VER")
8.0^22.2
"BLD",10739,6)
^296
**END**
**END**

