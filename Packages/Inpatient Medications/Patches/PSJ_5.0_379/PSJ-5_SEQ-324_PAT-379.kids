Released PSJ*5*379 SEQ #324
Extracted from mail message
**KIDS**:PSJ*5.0*379^

**INSTALL NAME**
PSJ*5.0*379
"BLD",11272,0)
PSJ*5.0*379^INPATIENT MEDICATIONS^0^3181107^y
"BLD",11272,1,0)
^^1^1^3181107^
"BLD",11272,1,1,0)
This patch addresses a PADE ROOM-BED/WARD issue.
"BLD",11272,4,0)
^9.64PA^^
"BLD",11272,6.3)
1
"BLD",11272,"INID")
n^n^n
"BLD",11272,"KRN",0)
^9.67PA^1.61^23
"BLD",11272,"KRN",.4,0)
.4
"BLD",11272,"KRN",.401,0)
.401
"BLD",11272,"KRN",.402,0)
.402
"BLD",11272,"KRN",.403,0)
.403
"BLD",11272,"KRN",.5,0)
.5
"BLD",11272,"KRN",.84,0)
.84
"BLD",11272,"KRN",1.6,0)
1.6
"BLD",11272,"KRN",1.61,0)
1.61
"BLD",11272,"KRN",1.62,0)
1.62
"BLD",11272,"KRN",3.6,0)
3.6
"BLD",11272,"KRN",3.8,0)
3.8
"BLD",11272,"KRN",9.2,0)
9.2
"BLD",11272,"KRN",9.8,0)
9.8
"BLD",11272,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",11272,"KRN",9.8,"NM",1,0)
PSJPDCL^^0^B62118639
"BLD",11272,"KRN",9.8,"NM","B","PSJPDCL",1)

"BLD",11272,"KRN",19,0)
19
"BLD",11272,"KRN",19.1,0)
19.1
"BLD",11272,"KRN",101,0)
101
"BLD",11272,"KRN",409.61,0)
409.61
"BLD",11272,"KRN",771,0)
771
"BLD",11272,"KRN",779.2,0)
779.2
"BLD",11272,"KRN",870,0)
870
"BLD",11272,"KRN",8989.51,0)
8989.51
"BLD",11272,"KRN",8989.52,0)
8989.52
"BLD",11272,"KRN",8994,0)
8994
"BLD",11272,"KRN","B",.4,.4)

"BLD",11272,"KRN","B",.401,.401)

"BLD",11272,"KRN","B",.402,.402)

"BLD",11272,"KRN","B",.403,.403)

"BLD",11272,"KRN","B",.5,.5)

"BLD",11272,"KRN","B",.84,.84)

"BLD",11272,"KRN","B",1.6,1.6)

"BLD",11272,"KRN","B",1.61,1.61)

"BLD",11272,"KRN","B",1.62,1.62)

"BLD",11272,"KRN","B",3.6,3.6)

"BLD",11272,"KRN","B",3.8,3.8)

"BLD",11272,"KRN","B",9.2,9.2)

"BLD",11272,"KRN","B",9.8,9.8)

"BLD",11272,"KRN","B",19,19)

"BLD",11272,"KRN","B",19.1,19.1)

"BLD",11272,"KRN","B",101,101)

"BLD",11272,"KRN","B",409.61,409.61)

"BLD",11272,"KRN","B",771,771)

"BLD",11272,"KRN","B",779.2,779.2)

"BLD",11272,"KRN","B",870,870)

"BLD",11272,"KRN","B",8989.51,8989.51)

"BLD",11272,"KRN","B",8989.52,8989.52)

"BLD",11272,"KRN","B",8994,8994)

"BLD",11272,"QDEF")
^^^^NO^^^^^^NO
"BLD",11272,"QUES",0)
^9.62^^
"BLD",11272,"REQB",0)
^9.611^1^1
"BLD",11272,"REQB",1,0)
PSJ*5.0*347^2
"BLD",11272,"REQB","B","PSJ*5.0*347",1)

"MBREQ")
0
"PKG",471,-1)
1^1
"PKG",471,0)
INPATIENT MEDICATIONS^PSJ^UNIT DOSE AND IVS
"PKG",471,22,0)
^9.49I^1^1
"PKG",471,22,1,0)
5.0^2971215^2990325^66481
"PKG",471,22,1,"PAH",1,0)
379^3181107
"PKG",471,22,1,"PAH",1,1,0)
^^1^1^3181107
"PKG",471,22,1,"PAH",1,1,1,0)
This patch addresses a PADE ROOM-BED/WARD issue.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","PSJPDCL")
0^1^B62118639^B59283748
"RTN","PSJPDCL",1,0)
PSJPDCL ;BIR/MHA - PADE HL7 ADT MESSAGE CLIENT TO VAFC ADT SERVER ;07/08/15
"RTN","PSJPDCL",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**317,337,347,379**;16 DEC 97;Build 1
"RTN","PSJPDCL",3,0)
 ;Reference to ^SC supported by DBIA 10040
"RTN","PSJPDCL",4,0)
 ;Reference to ^DIC(42 supported by DBIA 10039
"RTN","PSJPDCL",5,0)
 ;Reference to ^ORD(101 supported by DBIA 872
"RTN","PSJPDCL",6,0)
 ;Reference to ^DG(405.4 supported by DBIA 1380
"RTN","PSJPDCL",7,0)
 ;Reference to ^GMRADPT supported by DBIA 10099
"RTN","PSJPDCL",8,0)
 ;Reference to ^GMRVUTL supported by DBIA 1120
"RTN","PSJPDCL",9,0)
 ;Reference to ^GMRAOR2 supported by DBIA 2422
"RTN","PSJPDCL",10,0)
 ;
"RTN","PSJPDCL",11,0)
 Q
"RTN","PSJPDCL",12,0)
 ;
"RTN","PSJPDCL",13,0)
EN ; Get ADT Message and send to PADE.
"RTN","PSJPDCL",14,0)
 Q:$O(^PS(58.7,"B",""))=""
"RTN","PSJPDCL",15,0)
 Q:'$G(HLEID)
"RTN","PSJPDCL",16,0)
 N PSJAP
"RTN","PSJPDCL",17,0)
 S PSJAP=0
"RTN","PSJPDCL",18,0)
 N I,J S I=0
"RTN","PSJPDCL",19,0)
 F  S I=$O(^PS(58.7,I)) Q:'I  S J=$$PDACT^PSJPDCLA(I)
"RTN","PSJPDCL",20,0)
 Q:'PSJAP
"RTN","PSJPDCL",21,0)
 I $G(HL("ETN"))="" D INIT^HLFNC2(HLEID,.HL) Q:$D(HL)=1
"RTN","PSJPDCL",22,0)
 N FS,ECH S FS=HL("FS"),ECH=$E(HL("ECH"),1)
"RTN","PSJPDCL",23,0)
 N SNM,SID,NHL S SNM="PSJ ADT-"_HL("ETN")_" SERVER"
"RTN","PSJPDCL",24,0)
 S SID=$O(^ORD(101,"B",SNM,0))
"RTN","PSJPDCL",25,0)
 Q:'SID
"RTN","PSJPDCL",26,0)
 D INIT^HLFNC2(SID,.NHL) Q:$D(NHL)=1
"RTN","PSJPDCL",27,0)
 N NFS,NECH S NFS=NHL("FS"),NECH=$E(NHL("ECH"),1)
"RTN","PSJPDCL",28,0)
 N NSEG,PSJQ,PSJLOC,PSJWARD,PSJRBD,SEQ,PSJX,VAIP,X,FTS
"RTN","PSJPDCL",29,0)
 S VAIP("D")="L" D IN5^VADPT S PSJRBD=$P(VAIP(6),"^",2),FTS=$S($P(VAIP(8),"^")]"":$P(VAIP(8),"^")_NECH_$P(VAIP(8),"^",2),1:"")
"RTN","PSJPDCL",30,0)
 S SEQ=0,PSJQ=0,PSJX=1 S:HL("ETN")="A11" FTS=""
"RTN","PSJPDCL",31,0)
 F I=1:1 X HLNEXT Q:HLQUIT'>0!('PSJX)  D
"RTN","PSJPDCL",32,0)
 . Q:$E(HLNODE,1,3)="MSH"
"RTN","PSJPDCL",33,0)
 . Q:$E(HLNODE,1,3)="OBX"
"RTN","PSJPDCL",34,0)
 . Q:$E(HLNODE,1,3)="ROL"
"RTN","PSJPDCL",35,0)
 . Q:$E(HLNODE,1)="Z"
"RTN","PSJPDCL",36,0)
 . S SEQ=SEQ+1
"RTN","PSJPDCL",37,0)
 . S NSEG(SEQ)=$$TR(HLNODE)
"RTN","PSJPDCL",38,0)
 . S J=0 F  S J=$O(HLNODE(J)) Q:'J  S NSEG(SEQ,J)=$$TR(HLNODE(J))
"RTN","PSJPDCL",39,0)
 . I $E(HLNODE,1,3)="PV1" D
"RTN","PSJPDCL",40,0)
 .. S PSJLOC=$P(HLNODE,FS,4)
"RTN","PSJPDCL",41,0)
 .. S PSJWARD=$P(PSJLOC,ECH) Q:PSJWARD=""
"RTN","PSJPDCL",42,0)
 .. S PSJQ=$$CHKPD(PSJWARD,PSJRBD)
"RTN","PSJPDCL",43,0)
 .. I 'PSJQ S PSJX=0 Q
"RTN","PSJPDCL",44,0)
 .. D AGY
"RTN","PSJPDCL",45,0)
 Q:'PSJQ
"RTN","PSJPDCL",46,0)
 N XX,HL,HLFS,HLECH M HL=NHL
"RTN","PSJPDCL",47,0)
 S HLFS=NHL("FS")
"RTN","PSJPDCL",48,0)
 S HLECH=NHL("ECH")
"RTN","PSJPDCL",49,0)
 N ZTIO,ZTRTN,ZTSAVE,ZTDESC,ZTDTH
"RTN","PSJPDCL",50,0)
 S ZTIO=""
"RTN","PSJPDCL",51,0)
 S ZTRTN="SEND^PSJPDCL"
"RTN","PSJPDCL",52,0)
 F XX="PSJQ(","NSEG(","HLFS","HLECH","HL(","SNM","SID","FTS" S ZTSAVE(XX)=""
"RTN","PSJPDCL",53,0)
 S ZTDESC="PADE HL7 ADT Message Router"
"RTN","PSJPDCL",54,0)
 S ZTDTH=$H
"RTN","PSJPDCL",55,0)
 D ^%ZTLOAD
"RTN","PSJPDCL",56,0)
 Q
"RTN","PSJPDCL",57,0)
 ;
"RTN","PSJPDCL",58,0)
SEND ;
"RTN","PSJPDCL",59,0)
 N XX,CT,PSJND,PSJVNM,PSJDNS,PSJVP,VR,HLA,CNM,PSJSND
"RTN","PSJPDCL",60,0)
 M HLA("HLS")=NSEG
"RTN","PSJPDCL",61,0)
 Q:$G(SNM)=""
"RTN","PSJPDCL",62,0)
 I $G(HL("ETN"))="" D INIT^HLFNC2(SNM,.HL) Q:$D(HL)=1
"RTN","PSJPDCL",63,0)
 S CNM="PSJ ADT-"_HL("ETN")_" CLIENT"
"RTN","PSJPDCL",64,0)
 S XX=0,CT=0 F  S XX=$O(PSJQ(XX)) Q:'XX  D   ;sends HL7 message for each PADE SERVER
"RTN","PSJPDCL",65,0)
 .S PSJND=$G(^PS(58.7,XX,0))
"RTN","PSJPDCL",66,0)
 .Q:PSJND=""
"RTN","PSJPDCL",67,0)
 .S PSJVNM=$P(PSJND,"^"),PSJDNS=$P(PSJND,"^",2),PSJVP=$P(PSJND,"^",3)
"RTN","PSJPDCL",68,0)
 .Q:PSJVNM=""!(PSJDNS="")!('PSJVP)
"RTN","PSJPDCL",69,0)
 .N HLP,PSJSND,ZZ1,ZZ2 S (HLP,ZZ1,ZZ2)=""
"RTN","PSJPDCL",70,0)
 .I $G(HL("ETN"))="" D INIT^HLFNC2(SNM,.HL) Q:$D(HL)=1
"RTN","PSJPDCL",71,0)
 .K HLA,HLL M HLA("HLS")=NSEG
"RTN","PSJPDCL",72,0)
 .S HLP("SUBSCRIBER")="^^^^~"_PSJDNS_":"_PSJVP_"~DNS"
"RTN","PSJPDCL",73,0)
 .S HLL("LINKS",1)=CNM_"^"_"PSJ PADE",ZZ1=$P(PSJQ(XX),"^",2)
"RTN","PSJPDCL",74,0)
 .S CT=$O(HLA("HLS",9999),-1)+1 S:CT>1 HLA("HLS",CT)="ZZZ"_HL("FS")_ZZ1_HL("FS")_HL("FS")_FTS
"RTN","PSJPDCL",75,0)
 .D PV19^PSJPDAPP
"RTN","PSJPDCL",76,0)
 .D GENERATE^HLMA(SNM,"LM",1,.PSJSND,"",.HLP)
"RTN","PSJPDCL",77,0)
 .S:$G(PSJSND(1)) PSJSND=PSJSND(1)
"RTN","PSJPDCL",78,0)
 .D LOG^PSJPADE
"RTN","PSJPDCL",79,0)
 Q
"RTN","PSJPDCL",80,0)
 ;
"RTN","PSJPDCL",81,0)
TR(SEG) ; Translate the VAFC message delimiters to HL7 delimiters for PADE
"RTN","PSJPDCL",82,0)
 N CSEG
"RTN","PSJPDCL",83,0)
 S CSEG=$TR(SEG,HL("FS")_HL("ECH"),NHL("FS")_NHL("ECH"))
"RTN","PSJPDCL",84,0)
 S CSEG=$TR(CSEG,"""","")
"RTN","PSJPDCL",85,0)
 Q CSEG
"RTN","PSJPDCL",86,0)
 ;
"RTN","PSJPDCL",87,0)
CHKPD(PSJWD,PSJRB) ;
"RTN","PSJPDCL",88,0)
 N PSJWDI S PSJWDI=$O(^DIC(42,"B",PSJWD,"")) K PSJQ
"RTN","PSJPDCL",89,0)
 Q:'PSJWDI 0
"RTN","PSJPDCL",90,0)
 N PSJDIV,PSJDIVI S PSJDIV=+$P($G(^DIC(42,PSJWDI,0)),"^",11)
"RTN","PSJPDCL",91,0)
 Q:'PSJDIV 0
"RTN","PSJPDCL",92,0)
 N PSJPD,PSJSAR,PSJX S (PSJQ,PSJPD)=0
"RTN","PSJPDCL",93,0)
 F  S PSJPD=$O(^PS(58.7,"AD",PSJDIV,PSJPD)) Q:'PSJPD  D
"RTN","PSJPDCL",94,0)
 . Q:'$D(PSJAP(PSJPD)) 
"RTN","PSJPDCL",95,0)
 . S PSJDIVI=$O(^PS(58.7,PSJPD,"DIV","B",PSJDIV,0))
"RTN","PSJPDCL",96,0)
 . Q:'PSJDIVI
"RTN","PSJPDCL",97,0)
 . N DN S DN=$G(^PS(58.7,PSJPD,"DIV",PSJDIVI,0))
"RTN","PSJPDCL",98,0)
 . S PSJACT=$P(DN,"^",2)
"RTN","PSJPDCL",99,0)
 . I PSJACT,PSJACT<DT Q
"RTN","PSJPDCL",100,0)
 . I $G(PSJPDO)=1 N I S I=0 D  Q:I 
"RTN","PSJPDCL",101,0)
 .. I ($P($G(^PS(58.7,PSJPD,"DIV",PSJDIVI,2)),"^"))'="Y" S I=1 Q  ;DON'T SEND ORDER MESSAGES
"RTN","PSJPDCL",102,0)
 .. I $G(RXO)["V",$P(DN,"^",5)'="Y" S I=1 Q  ;DON'T SEND IP IV
"RTN","PSJPDCL",103,0)
 .. I "UV"[$E(RXO,$L(RXO)),($P($G(^(3)),"^")="Y"),'($S(RXO["V":$$CSIV^PSJPDCLA,1:$$CSUD^PSJPDCLA)) S I=1 Q  ;CS ONLY
"RTN","PSJPDCL",104,0)
 . S PSJX=0
"RTN","PSJPDCL",105,0)
 . I $G(PSJRB)]"" D
"RTN","PSJPDCL",106,0)
 .. N PSJRBI S PSJRBI=$$ROOMBED(PSJRB,PSJWDI) I 'PSJRBI Q
"RTN","PSJPDCL",107,0)
 .. S PSJSAR=$O(^PS(58.7,PSJPD,"DIV",PSJDIVI,"BG","C",PSJRBI,0))
"RTN","PSJPDCL",108,0)
 .. I PSJSAR D
"RTN","PSJPDCL",109,0)
 ... S PSJSAR=$G(^PS(58.7,PSJPD,"DIV",PSJDIVI,"BG",PSJSAR,2))
"RTN","PSJPDCL",110,0)
 ... I PSJSAR S PSJSAR=$P($G(^PS(58.71,PSJSAR,0)),"^") S:PSJSAR]"" PSJQ(PSJPD)="1^"_PSJSAR,(PSJX,PSJQ)=1
"RTN","PSJPDCL",111,0)
 . Q:PSJX 
"RTN","PSJPDCL",112,0)
 . S PSJSAR=$O(^PS(58.7,PSJPD,"DIV",PSJDIVI,"WD","B",PSJWDI,0))
"RTN","PSJPDCL",113,0)
 . I PSJSAR D
"RTN","PSJPDCL",114,0)
 .. S PSJSAR=$P($G(^PS(58.7,PSJPD,"DIV",PSJDIVI,"WD",PSJSAR,0)),"^",2)
"RTN","PSJPDCL",115,0)
 .. S:PSJSAR PSJSAR=$P($G(^PS(58.71,PSJSAR,0)),"^")
"RTN","PSJPDCL",116,0)
 .. S PSJQ(PSJPD)=1_$S(PSJSAR]"":"^"_PSJSAR,1:""),(PSJX,PSJQ)=1
"RTN","PSJPDCL",117,0)
 . Q:PSJX
"RTN","PSJPDCL",118,0)
 . I $O(^PS(57.5,"AB",PSJWDI,0)) D
"RTN","PSJPDCL",119,0)
 .. S PSJSAR=$O(^PS(57.5,"AB",PSJWDI,0)) Q:'PSJSAR
"RTN","PSJPDCL",120,0)
 .. S PSJSAR=$O(^PS(58.7,PSJPD,"DIV",PSJDIVI,"WG","B",PSJSAR,0))
"RTN","PSJPDCL",121,0)
 .. I PSJSAR S PSJSAR=$P($G(^PS(58.7,PSJPD,"DIV",PSJDIVI,"WG",PSJSAR,0)),"^",2) D
"RTN","PSJPDCL",122,0)
 ... S:PSJSAR PSJSAR=$P($G(^PS(58.71,PSJSAR,0)),"^")
"RTN","PSJPDCL",123,0)
 ... S PSJQ(PSJPD)="1"_$S(PSJSAR]"":"^"_PSJSAR,1:""),(PSJQ,PSJX)=1
"RTN","PSJPDCL",124,0)
 . K:'PSJX PSJAP(PSJPD)
"RTN","PSJPDCL",125,0)
 Q PSJQ
"RTN","PSJPDCL",126,0)
 ;
"RTN","PSJPDCL",127,0)
REACT ;
"RTN","PSJPDCL",128,0)
 N REAC S REAC="",IDX=0
"RTN","PSJPDCL",129,0)
 F  S IDX=$O(ADTL("S",IDX)) Q:IDX=""  D
"RTN","PSJPDCL",130,0)
 . I IDX>1 S REAC=REAC_NECH_$G(ADTL("S",IDX))
"RTN","PSJPDCL",131,0)
 . E  S REAC=$G(ADTL("S",IDX))
"RTN","PSJPDCL",132,0)
 S:REAC]"" $P(SEG,NFS,6)=REAC
"RTN","PSJPDCL",133,0)
 Q
"RTN","PSJPDCL",134,0)
 ;
"RTN","PSJPDCL",135,0)
AGY ;
"RTN","PSJPDCL",136,0)
 N SEG,GMRA,GMRAL
"RTN","PSJPDCL",137,0)
 S GMRA="0^0^111" D ^GMRADPT
"RTN","PSJPDCL",138,0)
 I GMRAL="" G OBX
"RTN","PSJPDCL",139,0)
 ;No known
"RTN","PSJPDCL",140,0)
 I GMRAL=0 D
"RTN","PSJPDCL",141,0)
 .S $P(SEG,NFS,1)="AL1"
"RTN","PSJPDCL",142,0)
 .S $P(SEG,NFS,2)=1
"RTN","PSJPDCL",143,0)
 .S $P(SEG,NFS,3)="OA"
"RTN","PSJPDCL",144,0)
 .S $P(SEG,NFS,4)="0;GMRD(120.82,"_NECH_"NO KNOWN ALLERGIES"
"RTN","PSJPDCL",145,0)
 .S $P(SEG,NFS,6)=""
"RTN","PSJPDCL",146,0)
 .S $P(SEG,NFS,7)=$$FMTHL7^XLFDT($$GET1^DIQ(120.86,DFN,3,"I"))
"RTN","PSJPDCL",147,0)
 .S SEQ=SEQ+1
"RTN","PSJPDCL",148,0)
 .S NSEG(SEQ)=SEG
"RTN","PSJPDCL",149,0)
 ;
"RTN","PSJPDCL",150,0)
 ;Yes, allergies
"RTN","PSJPDCL",151,0)
 I GMRAL=1 N KK,ACT,AEXT,ND D
"RTN","PSJPDCL",152,0)
 .S KK=0,ACT=0
"RTN","PSJPDCL",153,0)
 .F  S KK=$O(GMRAL(KK)) Q:'KK  D
"RTN","PSJPDCL",154,0)
 ..S ND=GMRAL(KK)
"RTN","PSJPDCL",155,0)
 ..S AEXT=$P(ND,U,2)
"RTN","PSJPDCL",156,0)
 ..S ACT=ACT+1
"RTN","PSJPDCL",157,0)
 ..S $P(SEG,NFS,1)="AL1"
"RTN","PSJPDCL",158,0)
 ..S $P(SEG,NFS,2)=ACT
"RTN","PSJPDCL",159,0)
 ..S $P(SEG,NFS,3)=$S($P(ND,U,3)="D":"DA",$P(ND,U,3)="F":"FA",1:"OA")
"RTN","PSJPDCL",160,0)
 ..S $P(SEG,NFS,4)=$P(ND,U,9)_NECH_AEXT
"RTN","PSJPDCL",161,0)
 ..N ADTL D EN1^GMRAOR2(KK,"ADTL") D:$O(ADTL("O",""))
"RTN","PSJPDCL",162,0)
 ... N IDX,SEV
"RTN","PSJPDCL",163,0)
 ... S IDX=$O(ADTL("O","")),SEV=$P($G(ADTL("O",IDX)),"^",2)
"RTN","PSJPDCL",164,0)
 ... S SEV=$S(SEV="MILD":"MI",SEV="MODERATE":"MO",SEV="SEVERE":"SV",1:"U")
"RTN","PSJPDCL",165,0)
 ... S $P(SEG,NFS,5)=SEV
"RTN","PSJPDCL",166,0)
 ..D:$O(ADTL("S","")) REACT
"RTN","PSJPDCL",167,0)
 ..S $P(SEG,NFS,7)=$$FMTHL7^XLFDT($$GET1^DIQ(120.8,KK,4,"I"))
"RTN","PSJPDCL",168,0)
 ..S SEQ=SEQ+1
"RTN","PSJPDCL",169,0)
 ..S NSEG(SEQ)=SEG,SEG=""
"RTN","PSJPDCL",170,0)
OBX ;HT,WT
"RTN","PSJPDCL",171,0)
 N GMRVSTR
"RTN","PSJPDCL",172,0)
 S GMRVSTR="HT" D EN6^GMRVUTL
"RTN","PSJPDCL",173,0)
 I X]"" S $P(SEG,NFS,1)="OBX",$P(SEG,NFS,2)=1,$P(SEG,NFS,3)="CE",$P(SEG,NFS,4)="1010.3"_NECH_"HEIGHT" D
"RTN","PSJPDCL",174,0)
 .S $P(SEG,NFS,6)=$J($P(X,U,8)*2.54,0,2),$P(SEG,NFS,7)="cm"
"RTN","PSJPDCL",175,0)
 .S $P(SEG,NFS,15)=$$HLDATE^HLFNC($P(X,U))
"RTN","PSJPDCL",176,0)
 .S SEQ=SEQ+1
"RTN","PSJPDCL",177,0)
 .S NSEG(SEQ)=SEG,SEG=""
"RTN","PSJPDCL",178,0)
 S GMRVSTR="WT" D EN6^GMRVUTL
"RTN","PSJPDCL",179,0)
 I X]"" S $P(SEG,NFS,1)="OBX",$P(SEG,NFS,2)=2,$P(SEG,NFS,3)="CE",$P(SEG,NFS,4)="1010.1"_NECH_"WEIGHT" D
"RTN","PSJPDCL",180,0)
 .S $P(SEG,NFS,6)=$J($P(X,U,8)/2.2046226,0,2),$P(SEG,NFS,7)="kg"
"RTN","PSJPDCL",181,0)
 .S $P(SEG,NFS,15)=$$HLDATE^HLFNC($P(X,"^"))
"RTN","PSJPDCL",182,0)
 .S SEQ=SEQ+1
"RTN","PSJPDCL",183,0)
 .S NSEG(SEQ)=SEG,SEG=""
"RTN","PSJPDCL",184,0)
 Q
"RTN","PSJPDCL",185,0)
 ;
"RTN","PSJPDCL",186,0)
A08 ;
"RTN","PSJPDCL",187,0)
 K ^TMP("A08")
"RTN","PSJPDCL",188,0)
 M ^TMP("A08","HLS")=^TMP("HLS",$J)
"RTN","PSJPDCL",189,0)
 M ^TMP("A08","HL")=HL
"RTN","PSJPDCL",190,0)
 Q:$O(^PS(58.7,"B",""))=""
"RTN","PSJPDCL",191,0)
 Q:$D(HL)=1
"RTN","PSJPDCL",192,0)
 Q:'$D(^TMP("HLS",$J))
"RTN","PSJPDCL",193,0)
 N XX,HLN,PSJND,PSJCLN,PSJCLNI,PSJDIV,PSJX S (PSJX,XX)=0
"RTN","PSJPDCL",194,0)
 F  S XX=$O(^TMP("HLS",$J,XX)) Q:'XX!(PSJX)  D
"RTN","PSJPDCL",195,0)
 . S HLN=^TMP("HLS",$J,XX)
"RTN","PSJPDCL",196,0)
 . I $E(HLN,1,3)="PV1" D
"RTN","PSJPDCL",197,0)
 .. S PSJCLN=$P(HLN,FS,4)
"RTN","PSJPDCL",198,0)
 .. S PSJCLNI=$O(^SC("B",PSJCLN,0))
"RTN","PSJPDCL",199,0)
 .. I 'PSJCLNI S PSJX=1 Q
"RTN","PSJPDCL",200,0)
 .. S PSJDIV=$P($G(^SC(PSJCLNI,0)),"^",15)
"RTN","PSJPDCL",201,0)
 .. I 'PSJDIV S PSJX=1 Q
"RTN","PSJPDCL",202,0)
 .. N PSJPD,PSJSAR,PSJQ S (PSJQ,PSJPD)=0
"RTN","PSJPDCL",203,0)
 .. F  S PSJPD=$O(^PS(58.7,"AD",PSJDIV,PSJPD)) Q:'PSJPD  D
"RTN","PSJPDCL",204,0)
 ... I '$D(^PS(58.7,PSJPD,0)) Q
"RTN","PSJPDCL",205,0)
 ... N PSJVNM,PSJDNS,PSJVP,PSJACT S PSJND=$G(^PS(58.7,PSJPD,0))
"RTN","PSJPDCL",206,0)
 ... S PSJVNM=$P(PSJND,"^"),PSJDNS=$P(PSJND,"^",2),PSJVP=$P(PSJND,"^",3)
"RTN","PSJPDCL",207,0)
 ... I PSJVNM=""!(PSJDNS="")!('PSJVP) Q
"RTN","PSJPDCL",208,0)
 ... S PSJACT=$P(PSJND,"^",4)
"RTN","PSJPDCL",209,0)
 ... I PSJACT&(PSJACT<DT) Q
"RTN","PSJPDCL",210,0)
 ... S PSJDIVI=$O(^PS(58.7,PSJPD,"DIV","B",PSJDIV,0))
"RTN","PSJPDCL",211,0)
 ... S PSJACT=$G(^PS(58.7,PSJPD,"DIV",PSJDIVI,0))
"RTN","PSJPDCL",212,0)
 ... S PSJACT=$P(PSJACT,"^",2)
"RTN","PSJPDCL",213,0)
 ... I PSJACT,PSJACT<DT Q
"RTN","PSJPDCL",214,0)
 ... S PSJQ=1,PSJQ(PSJPD)=1
"RTN","PSJPDCL",215,0)
 Q:'PSJQ 
"RTN","PSJPDCL",216,0)
 N SNM,SID S SNM="PSJ ADT-A08 SERVER"
"RTN","PSJPDCL",217,0)
 S SID=$O(^ORD(101,"B",SNM,0))
"RTN","PSJPDCL",218,0)
 Q:'SID
"RTN","PSJPDCL",219,0)
 D INIT^HLFNC2(SID,.NHL) Q:$D(NHL)=1
"RTN","PSJPDCL",220,0)
 N NFS,NECH S NFS=NHL("FS"),NECH=$E(NHL("ECH"),1)
"RTN","PSJPDCL",221,0)
 Q
"RTN","PSJPDCL",222,0)
 ;
"RTN","PSJPDCL",223,0)
ROOMBED(RMBDNAM,WARDIEN) ; Return the Room-Bed IEN - 379
"RTN","PSJPDCL",224,0)
 N ROOMBED,RMBD
"RTN","PSJPDCL",225,0)
 S (RMBD,ROOMBED)=0
"RTN","PSJPDCL",226,0)
 F  S RMBD=$O(^DG(405.4,"B",RMBDNAM,RMBD)) Q:'RMBD  D  I ROOMBED Q
"RTN","PSJPDCL",227,0)
 . I $D(^DG(405.4,RMBD,"W","B",WARDIEN)) S ROOMBED=RMBD
"RTN","PSJPDCL",228,0)
 Q ROOMBED
"RTN","PSJPDCL",229,0)
 ;
"VER")
8.0^22.2
"BLD",11272,6)
^324
**END**
**END**

