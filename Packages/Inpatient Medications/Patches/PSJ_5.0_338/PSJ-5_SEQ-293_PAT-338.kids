Released PSJ*5*338 SEQ #293
Extracted from mail message
**KIDS**:PSJ*5.0*338^

**INSTALL NAME**
PSJ*5.0*338
"BLD",10570,0)
PSJ*5.0*338^INPATIENT MEDICATIONS^0^3170801^y
"BLD",10570,1,0)
^^155^155^3170714^
"BLD",10570,1,1,0)
This patch will resolve the following issues:
"BLD",10570,1,2,0)
1)     UNDEFINED error when renew is changed to copy of an order
"BLD",10570,1,3,0)
2)     Unit Dose order has zero for dosage
"BLD",10570,1,4,0)
3)     Copied UD order with >1 dispense drug, one inactive, 
"BLD",10570,1,5,0)
       copies incorrectly
"BLD",10570,1,6,0)
4)     "^" at Duration of Admin still allows order to continue
"BLD",10570,1,7,0)
5)     UNDEFINED AGAIN+26^PSJDOSE *PSJCONT
"BLD",10570,1,8,0)
6)     Dispense drug not deleting correctly while finishing complex orders
"BLD",10570,1,9,0)
 
"BLD",10570,1,10,0)
 Associated Ticket(s):
"BLD",10570,1,11,0)
============================
"BLD",10570,1,12,0)
I9190964FY16        UNDEFINED error when renew is changed to copy an order
"BLD",10570,1,13,0)
R11878202FY17       Unit dose order has zero for dosage.
"BLD",10570,1,14,0)
I8405721FY16        Copied UD order with >1 dispense drug, one inactive,
"BLD",10570,1,15,0)
                     copies incorrectly
"BLD",10570,1,16,0)
I12228956FY17       "^" at Duration of Administration still allows
"BLD",10570,1,17,0)
                     order to continue.
"BLD",10570,1,18,0)
I15018816FY17       UNDEFINED error in PSJDOSE when modifying Dosage.
"BLD",10570,1,19,0)
I13103401FY17       Dispense drug not deleting correctly while finishing
"BLD",10570,1,20,0)
                     complex orders.
"BLD",10570,1,21,0)
                    
"BLD",10570,1,22,0)
Associated NSR(s):
"BLD",10570,1,23,0)
==================
"BLD",10570,1,24,0)
N/A
"BLD",10570,1,25,0)
 
"BLD",10570,1,26,0)
PSPO(s):
"BLD",10570,1,27,0)
========
"BLD",10570,1,28,0)
PSPO3491 - I13103401FY17
"BLD",10570,1,29,0)
Test Sites:
"BLD",10570,1,30,0)
===========
"BLD",10570,1,31,0)
TBD
"BLD",10570,1,32,0)
 
"BLD",10570,1,33,0)
Overview:
"BLD",10570,1,34,0)
================
"BLD",10570,1,35,0)
Issue 1
"BLD",10570,1,36,0)
--------
"BLD",10570,1,37,0)
I9190964FY16       UNDEFINED error when renew is changed to copy an order
"BLD",10570,1,38,0)
  
"BLD",10570,1,39,0)
Problem: 
"BLD",10570,1,40,0)
========
"BLD",10570,1,41,0)
A unit dose inpatient order in Vista was selected to be renewed (RN).  At the
"BLD",10570,1,42,0)
STOP DATE/TIME display the user realized they didn't want to renew the order
"BLD",10570,1,43,0)
but to copy it.  Entering an up-carat (^) at this point will take the user back
"BLD",10570,1,44,0)
to the originally selected order with no changes made.  The user then enters CO
"BLD",10570,1,45,0)
(copy) and attempts to copy the order.  During the copying process the user
"BLD",10570,1,46,0)
receives the <UNDEFINED>INIT+58^PSJLMUDE error and is taken out of Vista. 
"BLD",10570,1,47,0)
 
"BLD",10570,1,48,0)
During the RENEW process some of the values in the INPATIENT USER PARAMETERS
"BLD",10570,1,49,0)
FILE (#53.45), which contain information about the displayed order, are killed
"BLD",10570,1,50,0)
off.  When the user decided/realized they wanted the order copied and not
"BLD",10570,1,51,0)
renewed, some of the pertinent information that was removed was not getting set
"BLD",10570,1,52,0)
back into this file.  This is the reason the user received the UNDEFINED error.
"BLD",10570,1,53,0)
 
"BLD",10570,1,54,0)
Resolution:
"BLD",10570,1,55,0)
===========
"BLD",10570,1,56,0)
A modification was made to MOVE^PSGOER to ensure that the INPATIENT USER
"BLD",10570,1,57,0)
PARAMETERS FILE (#53.45) is populated with all the correct information for
"BLD",10570,1,58,0)
processing.
"BLD",10570,1,59,0)
 
"BLD",10570,1,60,0)
Issue 2
"BLD",10570,1,61,0)
--------
"BLD",10570,1,62,0)
R11878202FY17       Unit dose order has zero for dosage.
"BLD",10570,1,63,0)
  
"BLD",10570,1,64,0)
Problem: 
"BLD",10570,1,65,0)
========
"BLD",10570,1,66,0)
An active unit dose order in Vista was modified by changing the Orderable
"BLD",10570,1,67,0)
Item. When this is done, both the Orderable Item and Dosage Ordered are 
"BLD",10570,1,68,0)
deleted. When entering the new Orderable Item, the user is not prompted 
"BLD",10570,1,69,0)
for the Dosage Ordered and is able to accept the order.  This results in
"BLD",10570,1,70,0)
the new order being created without a Dosage Ordered.
"BLD",10570,1,71,0)
 
"BLD",10570,1,72,0)
Resolution:
"BLD",10570,1,73,0)
===========
"BLD",10570,1,74,0)
Modifications were made to 4 routines, PSGOE8, PSGOE9, PSJDOSE & PSGOEE.
"BLD",10570,1,75,0)
These modifications will prompt the user to enter a Dosage Ordered when
"BLD",10570,1,76,0)
they change the Orderable Item.
"BLD",10570,1,77,0)
 
"BLD",10570,1,78,0)
 
"BLD",10570,1,79,0)
Issue 3
"BLD",10570,1,80,0)
--------
"BLD",10570,1,81,0)
I8405721FY16        Copied UD order with >1 dispense drug, one
"BLD",10570,1,82,0)
                    inactive, copies incorrectly.
"BLD",10570,1,83,0)
 
"BLD",10570,1,84,0)
Problem:
"BLD",10570,1,85,0)
========
"BLD",10570,1,86,0)
A Unit Dose order that has more than one Dispense Drug associated
"BLD",10570,1,87,0)
with it, one being inactive, will not copy correctly.  
"BLD",10570,1,88,0)
 
"BLD",10570,1,89,0)
When the order is copies, the inactive Dispense Drug(s) are not
"BLD",10570,1,90,0)
supposed to be copied to the new order.  If the inactive Dispense
"BLD",10570,1,91,0)
Drug is the first one then the second Dispense Drug will show
"BLD",10570,1,92,0)
on the new copied order twice.  If the inactive Dispense Drug is
"BLD",10570,1,93,0)
last it will show on the copied order.
"BLD",10570,1,94,0)
 
"BLD",10570,1,95,0)
Resolution:
"BLD",10570,1,96,0)
===========
"BLD",10570,1,97,0)
A modification was made to routine PSGOD to remove the inactive
"BLD",10570,1,98,0)
Dispense Drug from the INPATIENT USER PARAMETERS FILE (#53.45).
"BLD",10570,1,99,0)
 
"BLD",10570,1,100,0)
 
"BLD",10570,1,101,0)
Issue 4:
"BLD",10570,1,102,0)
--------
"BLD",10570,1,103,0)
I12228956FY17     "^" at Duration of Admin still allows order to 
"BLD",10570,1,104,0)
                    continue
"BLD",10570,1,105,0)
 
"BLD",10570,1,106,0)
Problem:
"BLD",10570,1,107,0)
========
"BLD",10570,1,108,0)
A user went to edit an active Transdermal Inpatient order, and the 
"BLD",10570,1,109,0)
Pharmacy Orderable Item is marked for PROMPT FOR REMOVAL IN BCMA (value 
"BLD",10570,1,110,0)
2 or 3) and the Dosage form is Patch.  During the edit of the verified 
"BLD",10570,1,111,0)
order the user aborts ("^") at the Duration of Administration prompt 
"BLD",10570,1,112,0)
after entering the admin times. The system will allow the creation of 
"BLD",10570,1,113,0)
the new order without the Duration of Administration being entered.
"BLD",10570,1,114,0)
 
"BLD",10570,1,115,0)
Resolution:
"BLD",10570,1,116,0)
===========
"BLD",10570,1,117,0)
A modification to PSGOEE to prevent the user from continuing to create
"BLD",10570,1,118,0)
a new order without the required Duration of Administration value.
"BLD",10570,1,119,0)
 
"BLD",10570,1,120,0)
 
"BLD",10570,1,121,0)
Issue 5:
"BLD",10570,1,122,0)
---------
"BLD",10570,1,123,0)
I15018816FY17     UNDEFINED error in PSJDOSE when modifying Dosage.
"BLD",10570,1,124,0)
 
"BLD",10570,1,125,0)
Problem:
"BLD",10570,1,126,0)
========
"BLD",10570,1,127,0)
An active unit dose order in VistA was modified by changing the Dosage
"BLD",10570,1,128,0)
Ordered field.  When the dosage options/selections appeared, the user
"BLD",10570,1,129,0)
opted to enter a free text dosage that exceeded 15 characters.  This
"BLD",10570,1,130,0)
resulted in the UNDEFINED error.
"BLD",10570,1,131,0)
 
"BLD",10570,1,132,0)
Resolution:
"BLD",10570,1,133,0)
===========
"BLD",10570,1,134,0)
A modification was made to routine PSJDOSE to ensure that the user will
"BLD",10570,1,135,0)
no longer receive the UNDEFINED error.  
"BLD",10570,1,136,0)
 
"BLD",10570,1,137,0)
This modification will send the user back to the dosage prompt if the value
"BLD",10570,1,138,0)
exceeds 15 characters.
"BLD",10570,1,139,0)
 
"BLD",10570,1,140,0)
Issue 6:
"BLD",10570,1,141,0)
---------
"BLD",10570,1,142,0)
I13103401FY17     Dispense drug not deleting correctly while finishing
"BLD",10570,1,143,0)
                   complex orders
"BLD",10570,1,144,0)
 
"BLD",10570,1,145,0)
Problem: 
"BLD",10570,1,146,0)
========
"BLD",10570,1,147,0)
An Inpatient Med complex order was created in CPRS.  While fiishing the order
"BLD",10570,1,148,0)
in Vista, the Pharmacist adds a new Dispense Drug (12) to the order then
"BLD",10570,1,149,0)
deletes the original Dispense Drug.  Once the order is completed and you 
"BLD",10570,1,150,0)
go back into the order, both the new and deleted Dispense Drugs are displayed.
"BLD",10570,1,151,0)
 
"BLD",10570,1,152,0)
Resolution:
"BLD",10570,1,153,0)
===========
"BLD",10570,1,154,0)
A modification is needed in routine PSJCOM to update the NON-VERIFIED ORDERS
"BLD",10570,1,155,0)
FILE (53.1) with the new Dispense Drug information.
"BLD",10570,4,0)
^9.64PA^^
"BLD",10570,6.3)
8
"BLD",10570,"ABPKG")
n
"BLD",10570,"KRN",0)
^9.67PA^779.2^20
"BLD",10570,"KRN",.4,0)
.4
"BLD",10570,"KRN",.4,"NM",0)
^9.68A^^0
"BLD",10570,"KRN",.401,0)
.401
"BLD",10570,"KRN",.402,0)
.402
"BLD",10570,"KRN",.402,"NM",0)
^9.68A^^0
"BLD",10570,"KRN",.403,0)
.403
"BLD",10570,"KRN",.5,0)
.5
"BLD",10570,"KRN",.84,0)
.84
"BLD",10570,"KRN",3.6,0)
3.6
"BLD",10570,"KRN",3.8,0)
3.8
"BLD",10570,"KRN",3.8,"NM",0)
^9.68A^^0
"BLD",10570,"KRN",9.2,0)
9.2
"BLD",10570,"KRN",9.8,0)
9.8
"BLD",10570,"KRN",9.8,"NM",0)
^9.68A^9^9
"BLD",10570,"KRN",9.8,"NM",1,0)
PSGOE8^^0^B53298336
"BLD",10570,"KRN",9.8,"NM",2,0)
PSGOE9^^0^B46523279
"BLD",10570,"KRN",9.8,"NM",3,0)
PSJDOSE^^0^B64879386
"BLD",10570,"KRN",9.8,"NM",4,0)
PSGOEE^^0^B103788427
"BLD",10570,"KRN",9.8,"NM",5,0)
PSGOER^^0^B87602402
"BLD",10570,"KRN",9.8,"NM",6,0)
PSGOD^^0^B28187977
"BLD",10570,"KRN",9.8,"NM",7,0)
PSJCOM^^0^B43877303
"BLD",10570,"KRN",9.8,"NM",8,0)
PSJOE1^^0^B31376376
"BLD",10570,"KRN",9.8,"NM",9,0)
PSJLMUDE^^0^B87296083
"BLD",10570,"KRN",9.8,"NM","B","PSGOD",6)

"BLD",10570,"KRN",9.8,"NM","B","PSGOE8",1)

"BLD",10570,"KRN",9.8,"NM","B","PSGOE9",2)

"BLD",10570,"KRN",9.8,"NM","B","PSGOEE",4)

"BLD",10570,"KRN",9.8,"NM","B","PSGOER",5)

"BLD",10570,"KRN",9.8,"NM","B","PSJCOM",7)

"BLD",10570,"KRN",9.8,"NM","B","PSJDOSE",3)

"BLD",10570,"KRN",9.8,"NM","B","PSJLMUDE",9)

"BLD",10570,"KRN",9.8,"NM","B","PSJOE1",8)

"BLD",10570,"KRN",19,0)
19
"BLD",10570,"KRN",19,"NM",0)
^9.68A^^0
"BLD",10570,"KRN",19.1,0)
19.1
"BLD",10570,"KRN",19.1,"NM",0)
^9.68A^^0
"BLD",10570,"KRN",101,0)
101
"BLD",10570,"KRN",101,"NM",0)
^9.68A^^0
"BLD",10570,"KRN",409.61,0)
409.61
"BLD",10570,"KRN",409.61,"NM",0)
^9.68A^^0
"BLD",10570,"KRN",771,0)
771
"BLD",10570,"KRN",771,"NM",0)
^9.68A^^0
"BLD",10570,"KRN",779.2,0)
779.2
"BLD",10570,"KRN",870,0)
870
"BLD",10570,"KRN",870,"NM",0)
^9.68A^^0
"BLD",10570,"KRN",8989.51,0)
8989.51
"BLD",10570,"KRN",8989.51,"NM",0)
^9.68A^^0
"BLD",10570,"KRN",8989.52,0)
8989.52
"BLD",10570,"KRN",8994,0)
8994
"BLD",10570,"KRN","B",.4,.4)

"BLD",10570,"KRN","B",.401,.401)

"BLD",10570,"KRN","B",.402,.402)

"BLD",10570,"KRN","B",.403,.403)

"BLD",10570,"KRN","B",.5,.5)

"BLD",10570,"KRN","B",.84,.84)

"BLD",10570,"KRN","B",3.6,3.6)

"BLD",10570,"KRN","B",3.8,3.8)

"BLD",10570,"KRN","B",9.2,9.2)

"BLD",10570,"KRN","B",9.8,9.8)

"BLD",10570,"KRN","B",19,19)

"BLD",10570,"KRN","B",19.1,19.1)

"BLD",10570,"KRN","B",101,101)

"BLD",10570,"KRN","B",409.61,409.61)

"BLD",10570,"KRN","B",771,771)

"BLD",10570,"KRN","B",779.2,779.2)

"BLD",10570,"KRN","B",870,870)

"BLD",10570,"KRN","B",8989.51,8989.51)

"BLD",10570,"KRN","B",8989.52,8989.52)

"BLD",10570,"KRN","B",8994,8994)

"BLD",10570,"QDEF")
^^^^NO^^^^NO^^NO
"BLD",10570,"QUES",0)
^9.62^^
"BLD",10570,"REQB",0)
^9.611^2^2
"BLD",10570,"REQB",1,0)
PSJ*5.0*315^2
"BLD",10570,"REQB",2,0)
PSJ*5.0*328^2
"BLD",10570,"REQB","B","PSJ*5.0*315",1)

"BLD",10570,"REQB","B","PSJ*5.0*328",2)

"MBREQ")
0
"PKG",471,-1)
1^1
"PKG",471,0)
INPATIENT MEDICATIONS^PSJ^UNIT DOSE AND IVS
"PKG",471,20,0)
^9.402P^^
"PKG",471,22,0)
^9.49I^1^1
"PKG",471,22,1,0)
5.0^2971215^2990325^66481
"PKG",471,22,1,"PAH",1,0)
338^3170801
"PKG",471,22,1,"PAH",1,1,0)
^^155^155^3170801
"PKG",471,22,1,"PAH",1,1,1,0)
This patch will resolve the following issues:
"PKG",471,22,1,"PAH",1,1,2,0)
1)     UNDEFINED error when renew is changed to copy of an order
"PKG",471,22,1,"PAH",1,1,3,0)
2)     Unit Dose order has zero for dosage
"PKG",471,22,1,"PAH",1,1,4,0)
3)     Copied UD order with >1 dispense drug, one inactive, 
"PKG",471,22,1,"PAH",1,1,5,0)
       copies incorrectly
"PKG",471,22,1,"PAH",1,1,6,0)
4)     "^" at Duration of Admin still allows order to continue
"PKG",471,22,1,"PAH",1,1,7,0)
5)     UNDEFINED AGAIN+26^PSJDOSE *PSJCONT
"PKG",471,22,1,"PAH",1,1,8,0)
6)     Dispense drug not deleting correctly while finishing complex orders
"PKG",471,22,1,"PAH",1,1,9,0)
 
"PKG",471,22,1,"PAH",1,1,10,0)
 Associated Ticket(s):
"PKG",471,22,1,"PAH",1,1,11,0)
============================
"PKG",471,22,1,"PAH",1,1,12,0)
I9190964FY16        UNDEFINED error when renew is changed to copy an order
"PKG",471,22,1,"PAH",1,1,13,0)
R11878202FY17       Unit dose order has zero for dosage.
"PKG",471,22,1,"PAH",1,1,14,0)
I8405721FY16        Copied UD order with >1 dispense drug, one inactive,
"PKG",471,22,1,"PAH",1,1,15,0)
                     copies incorrectly
"PKG",471,22,1,"PAH",1,1,16,0)
I12228956FY17       "^" at Duration of Administration still allows
"PKG",471,22,1,"PAH",1,1,17,0)
                     order to continue.
"PKG",471,22,1,"PAH",1,1,18,0)
I15018816FY17       UNDEFINED error in PSJDOSE when modifying Dosage.
"PKG",471,22,1,"PAH",1,1,19,0)
I13103401FY17       Dispense drug not deleting correctly while finishing
"PKG",471,22,1,"PAH",1,1,20,0)
                     complex orders.
"PKG",471,22,1,"PAH",1,1,21,0)
                    
"PKG",471,22,1,"PAH",1,1,22,0)
Associated NSR(s):
"PKG",471,22,1,"PAH",1,1,23,0)
==================
"PKG",471,22,1,"PAH",1,1,24,0)
N/A
"PKG",471,22,1,"PAH",1,1,25,0)
 
"PKG",471,22,1,"PAH",1,1,26,0)
PSPO(s):
"PKG",471,22,1,"PAH",1,1,27,0)
========
"PKG",471,22,1,"PAH",1,1,28,0)
PSPO3491 - I13103401FY17
"PKG",471,22,1,"PAH",1,1,29,0)
Test Sites:
"PKG",471,22,1,"PAH",1,1,30,0)
===========
"PKG",471,22,1,"PAH",1,1,31,0)
TBD
"PKG",471,22,1,"PAH",1,1,32,0)
 
"PKG",471,22,1,"PAH",1,1,33,0)
Overview:
"PKG",471,22,1,"PAH",1,1,34,0)
================
"PKG",471,22,1,"PAH",1,1,35,0)
Issue 1
"PKG",471,22,1,"PAH",1,1,36,0)
--------
"PKG",471,22,1,"PAH",1,1,37,0)
I9190964FY16       UNDEFINED error when renew is changed to copy an order
"PKG",471,22,1,"PAH",1,1,38,0)
  
"PKG",471,22,1,"PAH",1,1,39,0)
Problem: 
"PKG",471,22,1,"PAH",1,1,40,0)
========
"PKG",471,22,1,"PAH",1,1,41,0)
A unit dose inpatient order in Vista was selected to be renewed (RN).  At the
"PKG",471,22,1,"PAH",1,1,42,0)
STOP DATE/TIME display the user realized they didn't want to renew the order
"PKG",471,22,1,"PAH",1,1,43,0)
but to copy it.  Entering an up-carat (^) at this point will take the user back
"PKG",471,22,1,"PAH",1,1,44,0)
to the originally selected order with no changes made.  The user then enters CO
"PKG",471,22,1,"PAH",1,1,45,0)
(copy) and attempts to copy the order.  During the copying process the user
"PKG",471,22,1,"PAH",1,1,46,0)
receives the <UNDEFINED>INIT+58^PSJLMUDE error and is taken out of Vista. 
"PKG",471,22,1,"PAH",1,1,47,0)
 
"PKG",471,22,1,"PAH",1,1,48,0)
During the RENEW process some of the values in the INPATIENT USER PARAMETERS
"PKG",471,22,1,"PAH",1,1,49,0)
FILE (#53.45), which contain information about the displayed order, are killed
"PKG",471,22,1,"PAH",1,1,50,0)
off.  When the user decided/realized they wanted the order copied and not
"PKG",471,22,1,"PAH",1,1,51,0)
renewed, some of the pertinent information that was removed was not getting set
"PKG",471,22,1,"PAH",1,1,52,0)
back into this file.  This is the reason the user received the UNDEFINED error.
"PKG",471,22,1,"PAH",1,1,53,0)
 
"PKG",471,22,1,"PAH",1,1,54,0)
Resolution:
"PKG",471,22,1,"PAH",1,1,55,0)
===========
"PKG",471,22,1,"PAH",1,1,56,0)
A modification was made to MOVE^PSGOER to ensure that the INPATIENT USER
"PKG",471,22,1,"PAH",1,1,57,0)
PARAMETERS FILE (#53.45) is populated with all the correct information for
"PKG",471,22,1,"PAH",1,1,58,0)
processing.
"PKG",471,22,1,"PAH",1,1,59,0)
 
"PKG",471,22,1,"PAH",1,1,60,0)
Issue 2
"PKG",471,22,1,"PAH",1,1,61,0)
--------
"PKG",471,22,1,"PAH",1,1,62,0)
R11878202FY17       Unit dose order has zero for dosage.
"PKG",471,22,1,"PAH",1,1,63,0)
  
"PKG",471,22,1,"PAH",1,1,64,0)
Problem: 
"PKG",471,22,1,"PAH",1,1,65,0)
========
"PKG",471,22,1,"PAH",1,1,66,0)
An active unit dose order in Vista was modified by changing the Orderable
"PKG",471,22,1,"PAH",1,1,67,0)
Item. When this is done, both the Orderable Item and Dosage Ordered are 
"PKG",471,22,1,"PAH",1,1,68,0)
deleted. When entering the new Orderable Item, the user is not prompted 
"PKG",471,22,1,"PAH",1,1,69,0)
for the Dosage Ordered and is able to accept the order.  This results in
"PKG",471,22,1,"PAH",1,1,70,0)
the new order being created without a Dosage Ordered.
"PKG",471,22,1,"PAH",1,1,71,0)
 
"PKG",471,22,1,"PAH",1,1,72,0)
Resolution:
"PKG",471,22,1,"PAH",1,1,73,0)
===========
"PKG",471,22,1,"PAH",1,1,74,0)
Modifications were made to 4 routines, PSGOE8, PSGOE9, PSJDOSE & PSGOEE.
"PKG",471,22,1,"PAH",1,1,75,0)
These modifications will prompt the user to enter a Dosage Ordered when
"PKG",471,22,1,"PAH",1,1,76,0)
they change the Orderable Item.
"PKG",471,22,1,"PAH",1,1,77,0)
 
"PKG",471,22,1,"PAH",1,1,78,0)
 
"PKG",471,22,1,"PAH",1,1,79,0)
Issue 3
"PKG",471,22,1,"PAH",1,1,80,0)
--------
"PKG",471,22,1,"PAH",1,1,81,0)
I8405721FY16        Copied UD order with >1 dispense drug, one
"PKG",471,22,1,"PAH",1,1,82,0)
                    inactive, copies incorrectly.
"PKG",471,22,1,"PAH",1,1,83,0)
 
"PKG",471,22,1,"PAH",1,1,84,0)
Problem:
"PKG",471,22,1,"PAH",1,1,85,0)
========
"PKG",471,22,1,"PAH",1,1,86,0)
A Unit Dose order that has more than one Dispense Drug associated
"PKG",471,22,1,"PAH",1,1,87,0)
with it, one being inactive, will not copy correctly.  
"PKG",471,22,1,"PAH",1,1,88,0)
 
"PKG",471,22,1,"PAH",1,1,89,0)
When the order is copies, the inactive Dispense Drug(s) are not
"PKG",471,22,1,"PAH",1,1,90,0)
supposed to be copied to the new order.  If the inactive Dispense
"PKG",471,22,1,"PAH",1,1,91,0)
Drug is the first one then the second Dispense Drug will show
"PKG",471,22,1,"PAH",1,1,92,0)
on the new copied order twice.  If the inactive Dispense Drug is
"PKG",471,22,1,"PAH",1,1,93,0)
last it will show on the copied order.
"PKG",471,22,1,"PAH",1,1,94,0)
 
"PKG",471,22,1,"PAH",1,1,95,0)
Resolution:
"PKG",471,22,1,"PAH",1,1,96,0)
===========
"PKG",471,22,1,"PAH",1,1,97,0)
A modification was made to routine PSGOD to remove the inactive
"PKG",471,22,1,"PAH",1,1,98,0)
Dispense Drug from the INPATIENT USER PARAMETERS FILE (#53.45).
"PKG",471,22,1,"PAH",1,1,99,0)
 
"PKG",471,22,1,"PAH",1,1,100,0)
 
"PKG",471,22,1,"PAH",1,1,101,0)
Issue 4:
"PKG",471,22,1,"PAH",1,1,102,0)
--------
"PKG",471,22,1,"PAH",1,1,103,0)
I12228956FY17     "^" at Duration of Admin still allows order to 
"PKG",471,22,1,"PAH",1,1,104,0)
                    continue
"PKG",471,22,1,"PAH",1,1,105,0)
 
"PKG",471,22,1,"PAH",1,1,106,0)
Problem:
"PKG",471,22,1,"PAH",1,1,107,0)
========
"PKG",471,22,1,"PAH",1,1,108,0)
A user went to edit an active Transdermal Inpatient order, and the 
"PKG",471,22,1,"PAH",1,1,109,0)
Pharmacy Orderable Item is marked for PROMPT FOR REMOVAL IN BCMA (value 
"PKG",471,22,1,"PAH",1,1,110,0)
2 or 3) and the Dosage form is Patch.  During the edit of the verified 
"PKG",471,22,1,"PAH",1,1,111,0)
order the user aborts ("^") at the Duration of Administration prompt 
"PKG",471,22,1,"PAH",1,1,112,0)
after entering the admin times. The system will allow the creation of 
"PKG",471,22,1,"PAH",1,1,113,0)
the new order without the Duration of Administration being entered.
"PKG",471,22,1,"PAH",1,1,114,0)
 
"PKG",471,22,1,"PAH",1,1,115,0)
Resolution:
"PKG",471,22,1,"PAH",1,1,116,0)
===========
"PKG",471,22,1,"PAH",1,1,117,0)
A modification to PSGOEE to prevent the user from continuing to create
"PKG",471,22,1,"PAH",1,1,118,0)
a new order without the required Duration of Administration value.
"PKG",471,22,1,"PAH",1,1,119,0)
 
"PKG",471,22,1,"PAH",1,1,120,0)
 
"PKG",471,22,1,"PAH",1,1,121,0)
Issue 5:
"PKG",471,22,1,"PAH",1,1,122,0)
---------
"PKG",471,22,1,"PAH",1,1,123,0)
I15018816FY17     UNDEFINED error in PSJDOSE when modifying Dosage.
"PKG",471,22,1,"PAH",1,1,124,0)
 
"PKG",471,22,1,"PAH",1,1,125,0)
Problem:
"PKG",471,22,1,"PAH",1,1,126,0)
========
"PKG",471,22,1,"PAH",1,1,127,0)
An active unit dose order in VistA was modified by changing the Dosage
"PKG",471,22,1,"PAH",1,1,128,0)
Ordered field.  When the dosage options/selections appeared, the user
"PKG",471,22,1,"PAH",1,1,129,0)
opted to enter a free text dosage that exceeded 15 characters.  This
"PKG",471,22,1,"PAH",1,1,130,0)
resulted in the UNDEFINED error.
"PKG",471,22,1,"PAH",1,1,131,0)
 
"PKG",471,22,1,"PAH",1,1,132,0)
Resolution:
"PKG",471,22,1,"PAH",1,1,133,0)
===========
"PKG",471,22,1,"PAH",1,1,134,0)
A modification was made to routine PSJDOSE to ensure that the user will
"PKG",471,22,1,"PAH",1,1,135,0)
no longer receive the UNDEFINED error.  
"PKG",471,22,1,"PAH",1,1,136,0)
 
"PKG",471,22,1,"PAH",1,1,137,0)
This modification will send the user back to the dosage prompt if the value
"PKG",471,22,1,"PAH",1,1,138,0)
exceeds 15 characters.
"PKG",471,22,1,"PAH",1,1,139,0)
 
"PKG",471,22,1,"PAH",1,1,140,0)
Issue 6:
"PKG",471,22,1,"PAH",1,1,141,0)
---------
"PKG",471,22,1,"PAH",1,1,142,0)
I13103401FY17     Dispense drug not deleting correctly while finishing
"PKG",471,22,1,"PAH",1,1,143,0)
                   complex orders
"PKG",471,22,1,"PAH",1,1,144,0)
 
"PKG",471,22,1,"PAH",1,1,145,0)
Problem: 
"PKG",471,22,1,"PAH",1,1,146,0)
========
"PKG",471,22,1,"PAH",1,1,147,0)
An Inpatient Med complex order was created in CPRS.  While fiishing the order
"PKG",471,22,1,"PAH",1,1,148,0)
in Vista, the Pharmacist adds a new Dispense Drug (12) to the order then
"PKG",471,22,1,"PAH",1,1,149,0)
deletes the original Dispense Drug.  Once the order is completed and you 
"PKG",471,22,1,"PAH",1,1,150,0)
go back into the order, both the new and deleted Dispense Drugs are displayed.
"PKG",471,22,1,"PAH",1,1,151,0)
 
"PKG",471,22,1,"PAH",1,1,152,0)
Resolution:
"PKG",471,22,1,"PAH",1,1,153,0)
===========
"PKG",471,22,1,"PAH",1,1,154,0)
A modification is needed in routine PSJCOM to update the NON-VERIFIED ORDERS
"PKG",471,22,1,"PAH",1,1,155,0)
FILE (53.1) with the new Dispense Drug information.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
9
"RTN","PSGOD")
0^6^B28187977^B25616562
"RTN","PSGOD",1,0)
PSGOD ;BIR/CML3 - CREATES NEW ORDER FROM OLD ONE ;22 SEP 97 / 2:56 PM 
"RTN","PSGOD",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**67,58,111,133,181,286,281,315,338**;16 DEC 97;Build 8
"RTN","PSGOD",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PSGOD",4,0)
 ; Reference to ^PS(55 is supported by DBIA 2191.
"RTN","PSGOD",5,0)
 ;
"RTN","PSGOD",6,0)
 ;*286 - Do not allow copied Unit Dose orders for outpatients
"RTN","PSGOD",7,0)
 D INP^VADPT I 'VAIN(4) W !,"You cannot copy Unit Dose orders for this patient!" H 2 Q
"RTN","PSGOD",8,0)
 I $P($G(^PS(55,PSGP,5,+PSJORD,0)),"^",22) D  Q
"RTN","PSGOD",9,0)
 .W !,"This order is marked 'Not To Be Given' and can't be copied!" H 2
"RTN","PSGOD",10,0)
 F  W !!,"Do you want to copy this order" S %=2 D YN^DICN Q:%  D CH
"RTN","PSGOD",11,0)
 G:%'=1 DONE
"RTN","PSGOD",12,0)
 ;
"RTN","PSGOD",13,0)
 W !!,"...copying..." N OLDON
"RTN","PSGOD",14,0)
 K PSGORQF
"RTN","PSGOD",15,0)
 N PSGPDRG,Q
"RTN","PSGOD",16,0)
 S PSGOEPR=$P($G(^PS(55,PSGP,5.1)),"^",2),OLDON=PSGORD,Q=""
"RTN","PSGOD",17,0)
 K PSGODN S F=$S(PSGORD["P":"^PS(53.1,"_+PSGORD_",",1:"^PS(55,"_PSGP_",5,"_+PSGORD_",") F N=0,.2,2,2.1,6 S PSGODN(N)=$G(@(F_N_")"))
"RTN","PSGOD",18,0)
 S PSGPR=$P(PSGODN(0),"^",2),PSGMR=$P(PSGODN(0),"^",3),PSGSM=$P(PSGODN(0),"^",5),PSGHSM=$P(PSGODN(0),"^",6),PSGST=$P(PSGODN(0),"^",7)
"RTN","PSGOD",19,0)
 S PSGPDRG=+PSGODN(.2),PSGDO=$P(PSGODN(.2),"^",2)
"RTN","PSGOD",20,0)
 ;*315
"RTN","PSGOD",21,0)
 S:$G(PSGODN(2.1))]"" PSGDUR=+PSGODN(2.1),PSGRMVT=$P(PSGODN(2.1),U,2),PSGRMV=$P(PSGODN(2.1),U,3),PSGRF=$P(PSGODN(2.1),U,4)
"RTN","PSGOD",22,0)
 S PSGSI=PSGODN(6)
"RTN","PSGOD",23,0)
 ; The naked reference below refers to the full reference inside indirection to ^PS(55,PSGP,5,+PSGORD, or ^PS(55,PSGP,"IV",+PSGORD, or ^PS(53.1,+PSGORD
"RTN","PSGOD",24,0)
 S PSGODN(3)=0 F Q=0:0 S Q=$O(@(F_"3,"_Q_")")) Q:'Q  I $D(^(Q,0)) S PSGODN(3,Q)=^(0),PSGODN(3)=PSGODN(3)+1 S ^PS(53.45,PSJSYSP,1,Q,0)=^(0)
"RTN","PSGOD",25,0)
 ;S:PSGODN(12)>0 ^PS(53.45,PSJSYSP,4,0)="^53.4504" S:PSGODN(3)>0 ^PS(53.45,PSJSYSP,1,0)="^53.4501"
"RTN","PSGOD",26,0)
 S:PSGODN(3)>0 ^PS(53.45,PSJSYSP,1,0)="^53.4501"
"RTN","PSGOD",27,0)
 ; The naked reference below refers to the full reference inside indirection to ^PS(55,PSGP,5,+PSGORD, or ^PS(55,PSGP,"IV",+PSGORD, or ^PS(53.1,+PSGORD  
"RTN","PSGOD",28,0)
 ;338
"RTN","PSGOD",29,0)
 N PSGK5345 S PSGK5345=0
"RTN","PSGOD",30,0)
 S (PSGODN(1),Q)=0 F  S Q=$O(@(F_"1,"_Q_")")) Q:'Q  S ND=$G(^(Q,0)) I ND D
"RTN","PSGOD",31,0)
 .I '$P(ND,"^",3),'PSGK5345 S PSGODN(1)=PSGODN(1)+1,PSGODN(1,PSGODN(1))=$P(ND,"^",1,2) S ^PS(53.45,PSJSYSP,2,PSGODN(1),0)=^(0)
"RTN","PSGOD",32,0)
 .I '$P(ND,"^",3),PSGK5345 S PSGODN(1,PSGODN(1))=$P(ND,"^",1,2) S ^PS(53.45,PSJSYSP,2,PSGODN(1),0)=^(0) S PSGODN(1)=PSGODN(1)+1,PSGK5345=0 K ^PS(53.45,PSJSYSP,2,PSGODN(1),0)
"RTN","PSGOD",33,0)
 .I $P(ND,"^",3) S PSGODN(1)=PSGODN(1)+1 K ^PS(53.45,PSJSYSP,2,PSGODN(1),0) S PSGK5345=1
"RTN","PSGOD",34,0)
 K PSGK5345
"RTN","PSGOD",35,0)
 S PSGS0Y=$P(PSGODN(2),"^",5),PSGS0XT=$P(PSGODN(2),"^",6),PSGNESD="",PSGSCH=$P(PSGODN(2),U)
"RTN","PSGOD",36,0)
 S PSGODF=1,PSGNEDFD=$P($$GTNEDFD^PSGOE7("U",+PSGPDRG),U)_"^^"_PSGST_"^"_PSGSCH
"RTN","PSGOD",37,0)
 W "." D ^PSGNE3
"RTN","PSGOD",38,0)
 K PSGEFN,PSGOEEF,PSGOEE,PSGOEOS S PSGEFN="1:13" F X=1:1:13 S PSGEFN(X)=""
"RTN","PSGOD",39,0)
 S PSGPDN=$$OINAME^PSJLMUTL(PSGPDRG),PSGOINST="",PSGSDN=$$ENDD^PSGMI(PSGNESD)_U_$$ENDTC^PSGMI(PSGNESD),PSGFDN=$$ENDD^PSGMI(PSGNEFD)_U_$$ENDTC^PSGMI(PSGNEFD)
"RTN","PSGOD",40,0)
 S PSGAT=PSGS0Y,PSGEBN=DUZ,PSGLIN=$$ENDD^PSGMI(PSGDT)_U_$$ENDTC^PSGMI(PSGDT),PSGEBN=$$ENNPN^PSGMI(DUZ),PSGSTAT=$S(PSGOEAV:"ACTIVE",1:"NON-VERIFIED")
"RTN","PSGOD",41,0)
 W "." D CHK^PSGOEV("^^"_PSGMR_"^^^^"_PSGST,PSGPDRG_U_PSGDO,PSGSCH_U_PSGNESD_"^^"_PSGNEFD)
"RTN","PSGOD",42,0)
 I $G(PSGSCH)]"" D
"RTN","PSGOD",43,0)
 .N X S X=PSGSCH N SWD,SDW,XABB,QX D ENOS^PSGS0 I $G(X)=""!$G(PSJNSS) S CHK=1 K PSJNSS Q
"RTN","PSGOD",44,0)
 .I $G(PSGAT)="",$G(PSGS0Y) S PSGAT=PSGS0Y
"RTN","PSGOD",45,0)
 .I $G(PSGAT),($G(PSGS0Y)="") S PSGS0Y=PSGAT
"RTN","PSGOD",46,0)
 .I $G(PSGS0XT)="D",$G(PSGS0Y)="" S CHK=1 D  K PSJNSS
"RTN","PSGOD",47,0)
 ..W ! K DIR S DIR(0)="FOA",DIR("A")="   WARNING - Admin times are required for DAY OF WEEK schedules    " D ^DIR K DIR
"RTN","PSGOD",48,0)
 S PSGSD=PSGNESD,PSGFD=PSGNEFD
"RTN","PSGOD",49,0)
 K PSJACEPT S VALMBCK="Q" D:$D(Y) EN^VALM("PSJU LM ACCEPT")
"RTN","PSGOD",50,0)
 I $G(PSJACEPT)=1 D OC S:$D(PSGORQF) PSJACEPT=0 S:$G(PSJACEPT)=1 VALMBCK="",PSJNOO=$$ENNOO^PSJUTL5("N")
"RTN","PSGOD",51,0)
 I '$G(PSJACEPT)!($G(PSJNOO)<0) W:'$G(PSJCOFLG) !!,"Order not copied." D PAUSE^VALM1:'$G(PSJCOFLG) G ORIG    ;PSJCOFLG set in PSODGAL1 for allergies
"RTN","PSGOD",52,0)
 S PSGNESD=PSGSD,PSGNEFD=PSGFD
"RTN","PSGOD",53,0)
 K PSGOEE D ^PSGOETO S PSJORD=PSGORD I PSGOEAV D
"RTN","PSGOD",54,0)
 .I '$D(PSGOEE),+PSJSYSU=3 D EN^PSGPEN(PSGORD)
"RTN","PSGOD",55,0)
 .D SETOC^PSJNEWOC(PSGORD) ;RTC 178789 Store allergy if auto vf is on
"RTN","PSGOD",56,0)
 D GETUD^PSJLMGUD(PSGP,PSGORD),ENSFE^PSGOEE0(PSGP,PSGORD),^PSGOE1,EN^VALM("PSJ LM UD ACTION")
"RTN","PSGOD",57,0)
 ;RTC 178789 - store allery if not verified the newly copied order
"RTN","PSGOD",58,0)
 I ($G(PSGORD)["P"),($P($G(^PS(53.1,+PSGORD,0)),U,9)="N"),($G(PSJOCFG)="COPY UD") D SETOC^PSJNEWOC(PSGORD)
"RTN","PSGOD",59,0)
 ;
"RTN","PSGOD",60,0)
 S PSGCANFL=0,(PSGORD,PSJORD)=OLDON W !!,"You are finished with the new order.",!,"The following ACTION prompt is for the original order."
"RTN","PSGOD",61,0)
 K DIR S DIR(0)="E" D ^DIR K DIR
"RTN","PSGOD",62,0)
ORIG ;Redisplay original order
"RTN","PSGOD",63,0)
 D GETUD^PSJLMGUD(PSGP,OLDON),INIT^PSJLMUDE(PSGP,OLDON)
"RTN","PSGOD",64,0)
DONE ;
"RTN","PSGOD",65,0)
 K %,%H,%I,DA,F,N,PSGODN,PSGODF,PSGS0XT,PSGS0Y,PSGNESD,PSGTOL,PSGTOO,PSGUOW,X,Y,^PS(53.45,PSJSYSP,1),^PS(53.45,PSJSYSP,2)
"RTN","PSGOD",66,0)
 K PSGPR,PSGMR,PSGSM,PSGHSM,PSGST,PSGPDRG,PSGDO,PSGNEDFD,PSGSCH,PSGNEFD
"RTN","PSGOD",67,0)
 Q
"RTN","PSGOD",68,0)
 ;
"RTN","PSGOD",69,0)
CH ;
"RTN","PSGOD",70,0)
 W !!?2,"Answer 'YES' to have a new, non-verified order created for this patient,",!,"using the information from this order.  (The START and STOP dates will be",!,"recalculated.)  Enter 'NO' (or '^') to stop now." Q
"RTN","PSGOD",71,0)
 ;
"RTN","PSGOD",72,0)
WH ;
"RTN","PSGOD",73,0)
 W !!?2,"Answer 'YES' to take action on this new order.  Enter 'NO' (or '^') to return",!,"to the original order now." Q
"RTN","PSGOD",74,0)
 ;
"RTN","PSGOD",75,0)
OC ;Perform order checks
"RTN","PSGOD",76,0)
 NEW PSJDD,X,PSJALLGY
"RTN","PSGOD",77,0)
 ;*286 - Order checks on current dispense drugs
"RTN","PSGOD",78,0)
 F X=0:0 S X=$O(^PS(53.45,PSJSYSP,2,X)) Q:'X  D
"RTN","PSGOD",79,0)
 . S PSJDD=$G(^PS(53.45,PSJSYSP,2,X,0))
"RTN","PSGOD",80,0)
 . I +PSJDD S PSJALLGY(+PSJDD)=""
"RTN","PSGOD",81,0)
 ;S X=+$O(PSGODN(1,0)) Q:'X  S PSJDD=+$G(PSGODN(1,X)) Q:'PSJDD
"RTN","PSGOD",82,0)
 S PSJDD=+$O(PSJALLGY(0)) Q:'PSJDD
"RTN","PSGOD",83,0)
 D FULL^VALM1
"RTN","PSGOD",84,0)
 D ENDDC^PSGSICHK($G(PSGP),PSJDD) Q:$D(PSGORQF)
"RTN","PSGOD",85,0)
 D IN^PSJOCDS($G(PSGORD),"UD",PSJDD)
"RTN","PSGOD",86,0)
 Q
"RTN","PSGOE8")
0^1^B53298336^B52703048
"RTN","PSGOE8",1,0)
PSGOE8 ;BIR/CML3 - EDIT ORDERS IN 53.1 ; 7/6/11 9:44am
"RTN","PSGOE8",2,0)
 ;;5.0;INPATIENT MEDICATIONS ;**47,50,65,72,110,111,188,192,113,223,269,287,315,338**;16 DEC 97;Build 8
"RTN","PSGOE8",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PSGOE8",4,0)
 ; Reference to ^PS(50.7 is supported by DBIA# 2180
"RTN","PSGOE8",5,0)
 ; Reference to ^PS(51.1 is supported by DBIA 2177
"RTN","PSGOE8",6,0)
 ; Reference to ^PS(51.2 is supported by DBIA# 2178
"RTN","PSGOE8",7,0)
 ; Reference to ^PSDRUG is supported by DBIA# 2192
"RTN","PSGOE8",8,0)
 ;
"RTN","PSGOE8",9,0)
101 ;Orderable Item
"RTN","PSGOE8",10,0)
 S MSG=0,F2=101,PSGOOPD=PSGPD,PSGOOPDN=PSGPDN S:PSGOEEF(F2) BACK="101^PSGOE8"
"RTN","PSGOE8",11,0)
 S %=1 I $P(PSJSYSU,";",3)>1 W !!,$C(7),"WARNING!  If you change the drug of an order, the Dosage Ordered and Dispense",!,"Drug(s) are deleted." F  W !,"Do you wish to continue" S %=2 D YN^DICN Q:%
"RTN","PSGOE8",12,0)
 I %'=1 G DONE
"RTN","PSGOE8",13,0)
A101 ;
"RTN","PSGOE8",14,0)
 I $$PNDREN($G(PSGORD)) D  Q
"RTN","PSGOE8",15,0)
 . W !!?5,"Orderable Item may not be edited at this point." D PAUSE^VALM1
"RTN","PSGOE8",16,0)
 W !,"ORDERABLE ITEM: ",$S(PSGPD:PSGPDN_"// ",1:"") R X:DTIME I X="^"!'$T W:'$T $C(7) S PSGOEE=0 G DONE
"RTN","PSGOE8",17,0)
 I X="",PSGPD S X=PSGPDN I PSGPD'=PSGPDN,$D(^PS(50.7,PSGPD,0)) G DONE
"RTN","PSGOE8",18,0)
 I $S(X="@":1,X]"":0,1:'PSGPD) W $C(7),"  (Required)" S X="?" D ENHLP^PSGOEM(53.1,101) G A101
"RTN","PSGOE8",19,0)
 I X?1."?" D ENHLP^PSGOEM(53.1,101)
"RTN","PSGOE8",20,0)
 I $E(X)="^" D ENFF^PSGOE82 G:Y>0 @Y G A101
"RTN","PSGOE8",21,0)
 ;BHW;PSJ*5.0*192;Modify ^DIC call to use MIX^DIC and only B/C cross-references
"RTN","PSGOE8",22,0)
 K DIC,D S DIC="^PS(50.7,",DIC(0)="EMQZ",DIC("S")="I $$ENOISC^PSJUTL(Y,""U"")",D="B^C" D MIX^DIC1 K DIC,D I Y'>0 G A101
"RTN","PSGOE8",23,0)
 F  S %=2 D DH,YN^DICN Q:%
"RTN","PSGOE8",24,0)
 I %'=1 G A101
"RTN","PSGOE8",25,0)
 S (PSGPDRG,PSGPD)=+Y,(PSGPDN,PSGPDRGN)=$$OINAME^PSJLMUTL(PSGPDRG)
"RTN","PSGOE8",26,0)
 S PSGNEDFD=$$GTNEDFD^PSGOE7("U",PSGPDRG)
"RTN","PSGOE8",27,0)
 S PSGPDNX=1,PSGDO="",(PSGPDRG,PSGPD)=+Y,(PSGPDN,PSGPDRGN)=$$OINAME^PSJLMUTL(PSGPDRG) K ^PS(53.45,PSJSYSP,2) S X=$O(^PSDRUG("ASP",PSGPD,0)) I X,'$O(^(X)) D
"RTN","PSGOE8",28,0)
 .S ^PS(53.45,PSJSYSP,2,0)="^53.4502P^1^1",^(1,0)=X,^PS(53.45,PSJSYSP,2,"B",X,1)=""
"RTN","PSGOE8",29,0)
 D ENDRG^PSGOEF1(PSGPD,0)
"RTN","PSGOE8",30,0)
 I $S($D(DTOUT):1,$D(DUOUT):1,$D(DIRUT):1,1:0) G DONE
"RTN","PSGOE8",31,0)
 ;G DONE
"RTN","PSGOE8",32,0)
 ;
"RTN","PSGOE8",33,0)
109 ; dosage ordered
"RTN","PSGOE8",34,0)
 S MSG=0,F2=109 S:$G(PSGOEEF(F2)) BACK="109^PSGOE8"
"RTN","PSGOE8",35,0)
A109 ;
"RTN","PSGOE8",36,0)
 I $$PNDREN($G(PSGORD)) D  Q
"RTN","PSGOE8",37,0)
 . W !!?5,"Dosage may not be edited at this point." D PAUSE^VALM1
"RTN","PSGOE8",38,0)
 S PSGOEEF(F2)=PSGOEE
"RTN","PSGOE8",39,0)
 D EDITDOSE^PSJDOSE S X=PSGDO S:X="" PSGDREQ=1 G DONE
"RTN","PSGOE8",40,0)
 W !,"DOSAGE ORDERED: ",$S(PSGDO]"":PSGDO_"// ",1:"") R X:DTIME I X="^"!'$T W:'$T $C(7) S PSGOEE=0 G DONE
"RTN","PSGOE8",41,0)
 I X=""&(PSGDO]"") S X=PSGDO
"RTN","PSGOE8",42,0)
 I $$CHECK(PSJSYSP)&(X="")&(PSGDO']"") W $C(7),"    (Required) " G A109
"RTN","PSGOE8",43,0)
 I $$CHECK(PSJSYSP)&(X="@") W $C(7),"      (Required) " G A109
"RTN","PSGOE8",44,0)
 I '$$CHECK(PSJSYSP)&(X="@") S PSGDO="" G DONE
"RTN","PSGOE8",45,0)
 I X?1."?" D ENHLP^PSGOEM(53.1,109) G A109
"RTN","PSGOE8",46,0)
 I $E(X)="^" D ENFF^PSGOE82 G:Y>0 @Y G A109
"RTN","PSGOE8",47,0)
 I $E(X,$L(X))=" " F  S X=$E(X,1,$L(X)-1) Q:$E(X,$L(X))'=" "
"RTN","PSGOE8",48,0)
 I $S(X?.E1C.E:1,$L(X)>20:1,X="":0,X["^":1,X?1.P:1,1:X=+X) W $C(7),"  ",$S(X?1.P!(X=""):"(Required)",1:"??") D ENHLP^PSGOEM(53.1,109) G A109
"RTN","PSGOE8",49,0)
 S PSGDO=X G DONE
"RTN","PSGOE8",50,0)
 ;
"RTN","PSGOE8",51,0)
3 ; med route
"RTN","PSGOE8",52,0)
 S MSG=0,F2=3 S:PSGOEEF(F2) BACK="3^PSGOE8"
"RTN","PSGOE8",53,0)
A3 I $$PNDREN($G(PSGORD)) D  Q
"RTN","PSGOE8",54,0)
 . W !!?5,"Med Route may not be edited at this point." D PAUSE^VALM1
"RTN","PSGOE8",55,0)
 W !,"MED ROUTE: ",$S(PSGMR:PSGMRN_"// ",1:"") R X:DTIME I X="^"!'$T W:'$T $C(7) S PSGOEE=0 G DONE
"RTN","PSGOE8",56,0)
 I X="",PSGMR S X=PSGMRN I PSGMR'=PSGMRN,$D(^PS(51.2,PSGMR,0)) W "  "_$P(^(0),"^",3) G DONE
"RTN","PSGOE8",57,0)
 I $S(X="@":1,X]"":0,1:'PSGMR) W $C(7),"  (Required)" S X="?" D ENHLP^PSGOEM(53.1,3) G A3
"RTN","PSGOE8",58,0)
 I X?1."?" D ENHLP^PSGOEM(53.1,3)
"RTN","PSGOE8",59,0)
 I $E(X)="^" D ENFF^PSGOE82 G:Y>0 @Y G A3
"RTN","PSGOE8",60,0)
 K DIC S DIC="^PS(51.2,",DIC(0)="EMQZ",DIC("S")="I $P(^(0),""^"",4)" D ^DIC K DIC I Y'>0 G A3
"RTN","PSGOE8",61,0)
 S PSGMR=+Y,PSGMRN=Y(0,0) G DONE
"RTN","PSGOE8",62,0)
 ;
"RTN","PSGOE8",63,0)
26 ; schedule
"RTN","PSGOE8",64,0)
 S MSG=0,F2=26 S:PSGOEEF(F2) BACK="26^PSGOE8"
"RTN","PSGOE8",65,0)
A26 I $$PNDREN($G(PSGORD)) D  Q
"RTN","PSGOE8",66,0)
 . W !!?5,"Schedule may not be edited at this point." D PAUSE^VALM1
"RTN","PSGOE8",67,0)
 W !,"SCHEDULE: ",$S(PSGSCH]"":PSGSCH_"// ",1:"") R X:DTIME I X="^"!'$T W:'$T $C(7) S PSGOEE=0 G DONE
"RTN","PSGOE8",68,0)
 S:X="" X=PSGSCH,PSGSCH="" I "@"[X W $C(7),"  (Required)" S X="?" D ENHLP^PSGOEM(53.1,26) G A26
"RTN","PSGOE8",69,0)
 S DOW=0 I $$DOW^PSIVUTL($$ENLU^PSGMI(X)) S DOW=1
"RTN","PSGOE8",70,0)
 I X?1."?" D ENHLP^PSGOEM(53.1,26) G A26
"RTN","PSGOE8",71,0)
 I $E(X)="^" D ENFF^PSGOE82 G:Y>0 @Y G A26
"RTN","PSGOE8",72,0)
 ;BHW;PSJ*5*188;Add flag and IEN return variable for PSGS0 (PSJ*5*134), Highlight Admin Times if they changed.
"RTN","PSGOE8",73,0)
 N PSGOES,PSJSLUP,PSGSFLG S PSJSLUP=1,PSGSFLG=1 D EN^PSGS0 I '$D(X) W $C(7),"  ??" S X="?" D ENHLP^PSGOEM(53.1,26) G A26
"RTN","PSGOE8",74,0)
 I X'=PSGSCH D
"RTN","PSGOE8",75,0)
 . K PSGDUR,PSGRMVT,PSGRMV,ND2P1 ;*315 Removal times are tied to ADMIN times.
"RTN","PSGOE8",76,0)
 . N XX
"RTN","PSGOE8",77,0)
 . S PSGSCH=X
"RTN","PSGOE8",78,0)
 . I PSGS0Y'=PSGAT S PSGAT=PSGS0Y  ;Change so that any schedule change will adjust the type and default the admin times - DRF
"RTN","PSGOE8",79,0)
 . D  ;Change schedule type to agree with schedule
"RTN","PSGOE8",80,0)
 .. I $G(DOW) S PSGST="C",PSGSTN=$$ENSTN^PSGMI(PSGST) Q
"RTN","PSGOE8",81,0)
 .. I (PSGSCH[" PRN")!(PSGSCH="PRN") I $$PRNOK^PSGS0(PSGSCH) S PSGOST=PSGST,PSGST="P",PSGSTN=$$ENSTN^PSGMI(PSGST) Q
"RTN","PSGOE8",82,0)
 .. I '$G(PSGSCIEN),PSGSCH]"" S XX=+$O(^PS(51.1,"AC","PSJ",PSGSCH,0)),PSGSCIEN=XX
"RTN","PSGOE8",83,0)
 .. S PSGOST=$G(PSGST),PSGST=$P($G(^PS(51.1,PSGSCIEN,0)),"^",5) I PSGST="D" S PSGST="C"  ;DOW schedules are converted to Continuous
"RTN","PSGOE8",84,0)
 .. S PSGSTN=$$ENSTN^PSGMI(PSGST)
"RTN","PSGOE8",85,0)
 . I $G(PSJSYSW0),($P(PSJSYSW0,U,5)'=2),'$G(PSGEFN(8)) W !!,"NOTE: This may cause the Admin Times and the Start Time to be out of sync."
"RTN","PSGOE8",86,0)
 . W !!,"NOTE: This change in schedule also changes the ADMIN TIMES and SCHEDULE TYPE.",!
"RTN","PSGOE8",87,0)
 . S MSG=1 S:'$G(PSGOEEF(39)) PSGOEEF(39)=1 ;*287 - Prevent infinite loop editing admin times
"RTN","PSGOE8",88,0)
 . I ($G(PSGRF)>1),PSGST="C" D
"RTN","PSGOE8",89,0)
 ..S PSGF2=39,BACK="39^PSGOE81" D 39^PSGOE81 S BACK="26^PSGOE8",PSGF2=26,PSGOAT=PSGAT ;*315 Prompt for Admin to get DOA
"RTN","PSGOE8",90,0)
 ..Q
"RTN","PSGOE8",91,0)
 . I $G(PSJNEWOE) D PAUSE^VALM1
"RTN","PSGOE8",92,0)
 I PSGST="O" S PSGOEEF(7)=1 I +$G(PSGRF) S PSGOEEF(25)=1 D 25^PSGOE81 S PSGF2=26
"RTN","PSGOE8",93,0)
 G DONE
"RTN","PSGOE8",94,0)
 ;
"RTN","PSGOE8",95,0)
7 ; schedule type
"RTN","PSGOE8",96,0)
 S MSG=0,F2=7 S:PSGOEEF(F2) BACK="7^PSGOE8"
"RTN","PSGOE8",97,0)
A7 W !,"SCHEDULE TYPE: "_$S(PSGSTN]"":PSGSTN_"// ",1:"") R X:DTIME S X=$TR(X,"coprocf","COPROCF") I X="^"!'$T S PSGOEE=0 W $C(7) G DONE
"RTN","PSGOE8",98,0)
 I X="" S X=PSGST,PSGSTN=$$ENSTN^PSGMI(X) W:PSGSTN]"" "  ",PSGSTN G DONE
"RTN","PSGOE8",99,0)
 S:X="F" X="R"
"RTN","PSGOE8",100,0)
 I ",?,??,C,O,OC,P,R,"'[(","_X_",") W " ??" G A7
"RTN","PSGOE8",101,0)
 I $$PRNOK^PSGS0($G(PSGSCH)),X="C" W "  ??" G A7
"RTN","PSGOE8",102,0)
 I X="@"!(X?1."?") W:X="@" $C(7),"  (Required)" S:X="@" X="?" D ENHLP^PSGOEM(53.1,7) G A7
"RTN","PSGOE8",103,0)
 I $E(X)="^" D ENFF^PSGOE82 G:Y>0 @Y G A7
"RTN","PSGOE8",104,0)
 ;*223 Don't allow O sched type on C orders
"RTN","PSGOE8",105,0)
 I X="O",$$SCHTP(PSGSCH)'="O" W !,"  SCHEDULE ("_PSGSCH_") is not a ONE TIME Schedule." G A7
"RTN","PSGOE8",106,0)
 ;*269 Don't allow C sched type on O orders
"RTN","PSGOE8",107,0)
 I X="C",$$SCHTP(PSGSCH)="O" W !,"  SCHEDULE ("_PSGSCH_") is not a CONTINUOUS Schedule." G A7
"RTN","PSGOE8",108,0)
 S PSGOST=PSGST
"RTN","PSGOE8",109,0)
 S PSGST=X,PSGSTN=$$ENSTN^PSGMI(X) W:PSGSTN]"" "  ",PSGSTN
"RTN","PSGOE8",110,0)
 I X="P",$G(PSGAT)]"" S PSGOAT=PSGAT S PSGAT="" D
"RTN","PSGOE8",111,0)
 .W !!,"NOTE: This change in schedule type also changes the ADMIN TIMES.",!
"RTN","PSGOE8",112,0)
 .S MSG=1,PSGOEEF(39)=1
"RTN","PSGOE8",113,0)
 .I $G(PSJNEWOE) D PAUSE^VALM1
"RTN","PSGOE8",114,0)
 ;
"RTN","PSGOE8",115,0)
DONE ;
"RTN","PSGOE8",116,0)
 I PSGOEE G:'PSGOEEF(F2) @BACK S PSGOEE=PSGOEEF(F2)
"RTN","PSGOE8",117,0)
 K F,F0,F2 Q
"RTN","PSGOE8",118,0)
 ;
"RTN","PSGOE8",119,0)
DEL ; delete entry
"RTN","PSGOE8",120,0)
 W !?3,"SURE YOU WANT TO DELETE" S %=0 D YN^DICN I %'=1 W $C(7),"  <NOTHING DELETED>"
"RTN","PSGOE8",121,0)
 Q
"RTN","PSGOE8",122,0)
 ;
"RTN","PSGOE8",123,0)
DH ;
"RTN","PSGOE8",124,0)
 W !!?2,"When the drug of an order is changed, the Dosage Ordered and Dispense Drug(s)",!,"for the order are no longer valid, and therefore deleted from the order.",!,"If possible, a new corresponding dispense drug will be added to the order."
"RTN","PSGOE8",125,0)
 W !!?2,"Answer 'YES' to continue with this change.  Answer 'NO' to select another",!,"drug or to accept the drug as it was.  Enter an '^' to exit this edit." Q
"RTN","PSGOE8",126,0)
 ;
"RTN","PSGOE8",127,0)
CHECK(PSJSYSP) ; Check to see if multiple dispense drugs
"RTN","PSGOE8",128,0)
 ; Input  -     PSJSYSP
"RTN","PSGOE8",129,0)
 ; Returns  0 = only one.
"RTN","PSGOE8",130,0)
 ;          1 = more than one
"RTN","PSGOE8",131,0)
 ; Checks Inactive Date and doesn't count if < or = today.
"RTN","PSGOE8",132,0)
 N PSJRSB,PSJINACT,PSJRBCNT S PSJRBCNT=0
"RTN","PSGOE8",133,0)
 F PSJRSB=0:0 S PSJRSB=$O(^PS(53.45,PSJSYSP,2,PSJRSB)) Q:'PSJRSB  D
"RTN","PSGOE8",134,0)
 .S PSJINACT=$P(^PS(53.45,PSJSYSP,2,PSJRSB,0),"^",3)
"RTN","PSGOE8",135,0)
 .I (PSJINACT="")!((PSJINACT>0)&(PSJINACT>DT)) D
"RTN","PSGOE8",136,0)
 ..S PSJRBCNT=$S('$D(PSJRBCNT):1,1:PSJRBCNT+1)
"RTN","PSGOE8",137,0)
 Q $S(PSJRBCNT>1:1,1:0)
"RTN","PSGOE8",138,0)
 ;
"RTN","PSGOE8",139,0)
PNDREN(PNDON) ;
"RTN","PSGOE8",140,0)
 I PNDON'["P" Q 0
"RTN","PSGOE8",141,0)
 S RNWL="^PS(53.1,"_+PNDON_",0)" S RNWL=$G(@(RNWL)) S RNWL=$S($P(RNWL,"^",24)="R":1,1:0)
"RTN","PSGOE8",142,0)
 Q RNWL
"RTN","PSGOE8",143,0)
 ;
"RTN","PSGOE8",144,0)
SCHTP(SCH) ; *223 Return SCHedule type
"RTN","PSGOE8",145,0)
 N X I SCH="" Q ""
"RTN","PSGOE8",146,0)
 S X=$O(^PS(51.1,"APPSJ",SCH,0))
"RTN","PSGOE8",147,0)
 Q:'$G(X) ""
"RTN","PSGOE8",148,0)
 Q $P(^PS(51.1,X,0),"^",5)
"RTN","PSGOE8",149,0)
 ;
"RTN","PSGOE9")
0^2^B46523279^B45686408
"RTN","PSGOE9",1,0)
PSGOE9 ;BIR/CML3 - EDIT ORDERS IN 55 ; 7/6/11 9:45am
"RTN","PSGOE9",2,0)
 ;;5.0;INPATIENT MEDICATIONS ;**11,47,50,72,110,111,188,192,207,113,223,269,315,338**;16 DEC 97;Build 8
"RTN","PSGOE9",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PSGOE9",4,0)
 ; Reference to ^PS(50.7 is supported by DBIA# 2180
"RTN","PSGOE9",5,0)
 ; Reference to ^PS(51.1 is supported by DBIA 2177
"RTN","PSGOE9",6,0)
 ; Reference to ^PS(51.2 is supported by DBIA# 2178
"RTN","PSGOE9",7,0)
 ; Reference to ^PS(55 is supported by DBIA #2191
"RTN","PSGOE9",8,0)
 ; Reference to ^PSDRUG is supported by DBIA# 2192
"RTN","PSGOE9",9,0)
 ;
"RTN","PSGOE9",10,0)
101 ; Orderable Item (AKA primary drug)
"RTN","PSGOE9",11,0)
 S MSG=0,PSGF2=101,PSGOOPD=PSGPD,PSGOOPDN=PSGPDN S:PSGOEEF(PSGF2) BACK="101^PSGOE9"
"RTN","PSGOE9",12,0)
 I $G(PSGOROE1)'=1 S %=1 W !!,$C(7),"WARNING!  If you change the drug of an order, the Dosage Ordered and Dispense",!,"Drug(s) are deleted." F  W !,"Do you wish to continue" S %=2 D YN^DICN Q:%  D DH^PSGOE8
"RTN","PSGOE9",13,0)
 I %'=1 G DONE
"RTN","PSGOE9",14,0)
A101 ;
"RTN","PSGOE9",15,0)
 I $G(PSJORD),$G(PSGP) I $$COMPLEX^PSJOE(PSGP,PSJORD) S PSGOEE=0 D  G DONE
"RTN","PSGOE9",16,0)
 . W !!?5,"Orderable Item may not be edited for active complex orders." D PAUSE^VALM1
"RTN","PSGOE9",17,0)
 W !,"ORDERABLE ITEM: ",$S(PSGPD:PSGPDN_"// ",1:"") R X:DTIME I X="^"!'$T W:'$T $C(7) S PSGOEE=0 G DONE
"RTN","PSGOE9",18,0)
 I X="",PSGPD S X=PSGPDN I PSGPD'=PSGPDN,$D(^PS(50.7,PSGPD,0)) G DONE
"RTN","PSGOE9",19,0)
 I $S(X="@":1,X]"":0,1:'PSGPD) W $C(7),"  (Required)" S X="?" D ENHLP^PSGOEM(55.06,101) G A101
"RTN","PSGOE9",20,0)
 I X?1."?" D ENHLP^PSGOEM(55.06,101)
"RTN","PSGOE9",21,0)
 I $E(X)="^" D ENFF^PSGOE92 G:Y>0 @Y G A101
"RTN","PSGOE9",22,0)
 ;BHW;PSJ*5.0*192;Modify ^DIC call to use MIX^DIC and only B/C cross-references
"RTN","PSGOE9",23,0)
 K DIC,D S DIC="^PS(50.7,",DIC(0)="EMQZ",DIC("S")="I $$ENOISC^PSJUTL(Y,""U"")",D="B^C" D MIX^DIC1 K DIC,D I Y'>0 G A101
"RTN","PSGOE9",24,0)
 I +Y=PSGPD G DONE  ;PSJ*5*269 - No change to Orderable Item
"RTN","PSGOE9",25,0)
 F  S %=2 D DH^PSGOE8,YN^DICN Q:%
"RTN","PSGOE9",26,0)
 I %'=1 G A101
"RTN","PSGOE9",27,0)
 S (PSGPDRG,PSGPD)=+Y,(PSGPDN,PSGPDRGN)=$$OINAME^PSJLMUTL(PSGPDRG)
"RTN","PSGOE9",28,0)
 S PSGNEDFD=$$GTNEDFD^PSGOE7("U",PSGPDRG)
"RTN","PSGOE9",29,0)
 S PSGPDNX=1,PSGPD=+Y,PSGPDN=$$OINAME^PSJLMUTL(PSGPD),PSGDO="" K ^PS(53.45,PSJSYSP,2) S X=$O(^PSDRUG("ASP",PSGPD,0)) I X,'$O(^(X)) S ^PS(53.45,PSJSYSP,2,0)="^53.4502P^1^1",^(1,0)=X,^PS(53.45,PSJSYSP,2,"B",X,1)="" G DONE
"RTN","PSGOE9",30,0)
 D ENDRG^PSGOEF1(PSGPD,0)
"RTN","PSGOE9",31,0)
 I $S($D(DTOUT):1,$D(DUOUT):1,$D(DIRUT):1,1:0) S PSGOROE1=1 G DONE
"RTN","PSGOE9",32,0)
 ;G DONE
"RTN","PSGOE9",33,0)
 ;
"RTN","PSGOE9",34,0)
109 ; dosage ordered
"RTN","PSGOE9",35,0)
 S MSG=0,PSGF2=109 S:PSGOEEF(PSGF2) BACK="109^PSGOE9"
"RTN","PSGOE9",36,0)
A109 ;
"RTN","PSGOE9",37,0)
 I $G(PSJORD),$G(PSGP) I $$COMPLEX^PSJOE(PSGP,PSJORD) S PSGOEE=0 D  G DONE
"RTN","PSGOE9",38,0)
 . W !!?5,"Dosage may not be edited for active complex orders." D PAUSE^VALM1
"RTN","PSGOE9",39,0)
 D EDITDOSE^PSJDOSE S X=PSGDO G DONE
"RTN","PSGOE9",40,0)
 W !,"DOSAGE ORDERED: ",$S(PSGDO]"":PSGDO_"// ",1:"") R X:DTIME I X="^"!'$T W:'$T $C(7) S PSGOEE=0 G DONE
"RTN","PSGOE9",41,0)
 I X=""&(PSGDO]"") S X=PSGDO
"RTN","PSGOE9",42,0)
 I $$CHECK^PSGOE8(PSJSYSP)&(X="")&(PSGDO']"") W $C(7),"    (Required) " G A109
"RTN","PSGOE9",43,0)
 I $$CHECK^PSGOE8(PSJSYSP)&(X="@") W $C(7),"  (Required)" G A109
"RTN","PSGOE9",44,0)
 I '$$CHECK^PSGOE8(PSJSYSP)&(X="@") S PSGDO="" G DONE
"RTN","PSGOE9",45,0)
 I X?1."?" D ENHLP^PSGOEM(55.06,109) G A109
"RTN","PSGOE9",46,0)
 I $E(X)="^" D ENFF^PSGOE92 G:Y>0 @Y G A109
"RTN","PSGOE9",47,0)
 I $E(X,$L(X))=" " F  S X=$E(X,1,$L(X)-1) Q:$E(X,$L(X))'=" "
"RTN","PSGOE9",48,0)
 I $S(X?.E1C.E:1,$L(X)>20:1,X="":0,X["^":1,X?1.P:1,1:X=+X) W $C(7),"  ",$S(X?1.P!(X=""):"(Required)",1:"??") D ENHLP^PSGOEM(55.06,109) G A109
"RTN","PSGOE9",49,0)
 S PSGDO=X G DONE
"RTN","PSGOE9",50,0)
 ;
"RTN","PSGOE9",51,0)
3 ; med route
"RTN","PSGOE9",52,0)
 S MSG=0,PSGF2=3 S:PSGOEEF(PSGF2) BACK="3^PSGOE9"
"RTN","PSGOE9",53,0)
A3 I $G(PSJORD),$G(PSGP) I $$COMPLEX^PSJOE(PSGP,PSJORD) S PSGOEE=0 D  G DONE
"RTN","PSGOE9",54,0)
 . W !!?5,"Med Route may not be edited for active complex orders." D PAUSE^VALM1
"RTN","PSGOE9",55,0)
 W !,"MED ROUTE: ",$S(PSGMR:PSGMRN_"// ",1:"") R X:DTIME I X="^"!'$T W:'$T $C(7) S PSGOEE=0 G DONE
"RTN","PSGOE9",56,0)
 I X="",PSGMR S X=PSGMRN I PSGMR'=PSGMRN,$D(^PS(51.2,PSGMR,0)) W "  "_$P(^(0),"^",3) G DONE
"RTN","PSGOE9",57,0)
 I $S(X="@":1,X]"":0,1:'PSGMR) W $C(7),"  (Required)" S X="?" D ENHLP^PSGOEM(55.06,3) G A3
"RTN","PSGOE9",58,0)
 I X?1."?" D ENHLP^PSGOEM(55.06,3)
"RTN","PSGOE9",59,0)
 I $E(X)="^" D ENFF^PSGOE92 G:Y>0 @Y G A3
"RTN","PSGOE9",60,0)
 K DIC S DIC="^PS(51.2,",DIC(0)="EMQZ",DIC("S")="I $P(^(0),""^"",4)" D ^DIC K DIC I Y'>0 G A3
"RTN","PSGOE9",61,0)
 S PSGMR=+Y,PSGMRN=Y(0,0) G DONE
"RTN","PSGOE9",62,0)
 ;
"RTN","PSGOE9",63,0)
7 ; schedule type
"RTN","PSGOE9",64,0)
 S MSG=0,PSGF2=7 S:PSGOEEF(PSGF2) BACK="7^PSGOE9"
"RTN","PSGOE9",65,0)
A7 I $G(PSGP),$G(PSGORD) I $$COMPLEX^PSJOE(PSGP,PSGORD) D
"RTN","PSGOE9",66,0)
 . N X,Y,PARENT,P2ND S P2ND=$S(PSGORD["U":$G(^PS(55,PSGP,5,+PSGORD,.2)),1:$G(^PS(53.1,+PSGORD,.2))),PARENT=$P(P2ND,"^",8)
"RTN","PSGOE9",67,0)
 . I PARENT D FULL^VALM1 W !!?5,"This order is part of a complex order. Please review the following ",!?5,"associated orders before changing this order." D CMPLX^PSJCOM1(PSGP,PARENT,PSGORD)
"RTN","PSGOE9",68,0)
 W !,"SCHEDULE TYPE: "_$S(PSGSTN]"":PSGSTN_"// ",1:"") R X:DTIME S X=$TR(X,"coprocf","COPROCF") I X="^"!'$T S PSGOEE=0 W $C(7) G DONE
"RTN","PSGOE9",69,0)
 I X="" S X=PSGST,PSGSTN=$$ENSTN^PSGMI(X) W:PSGSTN]"" "  ",PSGSTN G DONE
"RTN","PSGOE9",70,0)
 S:X="F" X="R"
"RTN","PSGOE9",71,0)
 I ",?,??,C,O,OC,P,R,"'[(","_X_",") W " ??" G A7
"RTN","PSGOE9",72,0)
 I $$PRNOK^PSGS0($G(PSGSCH)),X="C" W "  ??" G A7
"RTN","PSGOE9",73,0)
 I X="@"!(X?1."?") W:X="@" $C(7),"  (Required)" S:X="@" X="?" D ENHLP^PSGOEM(55.06,7) G A7
"RTN","PSGOE9",74,0)
 I $E(X)="^" D ENFF^PSGOE92 G:Y>0 @Y G A7
"RTN","PSGOE9",75,0)
 ;*223 Don't allow O sched type on C orders
"RTN","PSGOE9",76,0)
 I X="O",$$SCHTP^PSGOE8(PSGSCH)'="O" W !,"  SCHEDULE ("_PSGSCH_") is not a ONE TIME Schedule." G A7
"RTN","PSGOE9",77,0)
 ;*269 Don't allow C sched type on O orders
"RTN","PSGOE9",78,0)
 I X="C",$$SCHTP^PSGOE8(PSGSCH)="O" W !,"  SCHEDULE ("_PSGSCH_") is not a CONTINUOUS Schedule." G A7
"RTN","PSGOE9",79,0)
 S PSGOST=PSGST
"RTN","PSGOE9",80,0)
 S PSGST=X,PSGSTN=$$ENSTN^PSGMI(X) W:PSGSTN]"" "  ",PSGSTN
"RTN","PSGOE9",81,0)
 I X="P",$G(PSGAT)]"" S PSGOAT=PSGAT S PSGAT="" D
"RTN","PSGOE9",82,0)
 .W !!,"NOTE: This change in schedule type also changes the ADMIN TIMES.",!
"RTN","PSGOE9",83,0)
 .S MSG=1,PSGOEEF(39)=1
"RTN","PSGOE9",84,0)
 .I $G(PSJNEWOE) D PAUSE^VALM1
"RTN","PSGOE9",85,0)
 G DONE
"RTN","PSGOE9",86,0)
 ;
"RTN","PSGOE9",87,0)
26 ; schedule
"RTN","PSGOE9",88,0)
 S MSG=0,PSGF2=26 S:PSGOEEF(PSGF2) BACK="26^PSGOE9"
"RTN","PSGOE9",89,0)
A26 I $G(PSJORD),$G(PSGP) I $$COMPLEX^PSJOE(PSGP,PSJORD) S PSGOEE=0 D  G DONE
"RTN","PSGOE9",90,0)
 . W !!?5,"Schedule may not be edited for active complex orders." D PAUSE^VALM1
"RTN","PSGOE9",91,0)
 W !,"SCHEDULE: ",$S(PSGSCH]"":PSGSCH_"// ",1:"") R X:DTIME I X="^"!'$T W:'$T $C(7) S PSGOEE=0 G DONE
"RTN","PSGOE9",92,0)
 S:X="" X=PSGSCH,PSGSCH="" I "@"[X W $C(7),"  (Required)" S X="?" D ENHLP^PSGOEM(55.06,26) G A26
"RTN","PSGOE9",93,0)
 S DOW=0 I $$DOW^PSIVUTL($$ENLU^PSGMI(X)) S DOW=1
"RTN","PSGOE9",94,0)
 I X?1."?" D ENHLP^PSGOEM(55.06,26) G A26
"RTN","PSGOE9",95,0)
 I $E(X)="^" D ENFF^PSGOE92 G:Y>0 @Y G A26
"RTN","PSGOE9",96,0)
 ;BHW;PSJ*5*188;Add flag and IEN return variable for PSGS0 (PSJ*5*134), Highlight Admin Times if they changed.
"RTN","PSGOE9",97,0)
 N PSJSLUP,PSGSFLG S PSJSLUP=1,PSGSFLG=1 D EN^PSGS0 I '$D(X) W $C(7),"  ??" S X="?" D ENHLP^PSGOEM(55.06,26) G A26
"RTN","PSGOE9",98,0)
 I X'=PSGSCH D
"RTN","PSGOE9",99,0)
 . N XX
"RTN","PSGOE9",100,0)
 . K PSGDUR,PSGRMVT,PSGRMV,ND2P1 ;*315 Removal times are tied to ADMIN times.
"RTN","PSGOE9",101,0)
 . S PSGSCH=X
"RTN","PSGOE9",102,0)
 . I PSGS0Y'=PSGAT S PSGAT=PSGS0Y  ;Change so that any schedule change will adjust the type and default the admin times - DRF
"RTN","PSGOE9",103,0)
 . D  ;Change schedule type to agree with schedule
"RTN","PSGOE9",104,0)
 .. I $G(DOW) S PSGST="C",PSGSTN=$$ENSTN^PSGMI(PSGST) Q
"RTN","PSGOE9",105,0)
 .. I (PSGSCH[" PRN")!(PSGSCH="PRN") I $$PRNOK^PSGS0(PSGSCH) S PSGOST=PSGST,PSGST="P",PSGSTN=$$ENSTN^PSGMI(PSGST) Q
"RTN","PSGOE9",106,0)
 .. I '$G(PSGSCIEN),PSGSCH]"" S XX=+$O(^PS(51.1,"AC","PSJ",PSGSCH,0)),PSGSCIEN=XX ;PSGSCIEN should be set by call to EN^PSGS0
"RTN","PSGOE9",107,0)
 .. S PSGST=$P($G(^PS(51.1,PSGSCIEN,0)),"^",5) I PSGST="D" S PSGST="C"  ;DOW schedules are converted to Continuous
"RTN","PSGOE9",108,0)
 .. S PSGSTN=$$ENSTN^PSGMI(PSGST)
"RTN","PSGOE9",109,0)
 . W !!,"NOTE: This change in schedule also changes the ADMIN TIMES and SCHEDULE TYPE.",!
"RTN","PSGOE9",110,0)
 . S MSG=1,PSGOEEF(39)=1
"RTN","PSGOE9",111,0)
 . I ($G(PSGRF)>1),PSGST="C" D
"RTN","PSGOE9",112,0)
 .. S PSGF2=41,BACK="41^PSGOE91",PSGOEEF(PSGF2)=1 D 41^PSGOE91 S BACK="26^PSGOE9",PSGF2=26,PSGOAT=PSGAT ;*315 Prompt for Admin to get DOA
"RTN","PSGOE9",113,0)
 ..Q
"RTN","PSGOE9",114,0)
 . I $G(PSJNEWOE) D PAUSE^VALM1
"RTN","PSGOE9",115,0)
 I PSGST="O" S PSGOEEF(7)=1 I +$G(PSGRF) S PSGOEEF(34)=1 D 34^PSGOE91 S PSGF2=26
"RTN","PSGOE9",116,0)
 ;
"RTN","PSGOE9",117,0)
DONE ;
"RTN","PSGOE9",118,0)
 I PSGOEE G:'PSGOEEF(PSGF2) @BACK S PSGOEE=PSGOEEF(PSGF2)
"RTN","PSGOE9",119,0)
 K F,F0,PSGF2 Q
"RTN","PSGOE9",120,0)
 ;
"RTN","PSGOE9",121,0)
DEL ; delete entry
"RTN","PSGOE9",122,0)
 W !?3,"SURE YOU WANT TO DELETE" S %=0 D YN^DICN I %'=1 W $C(7),"  <NOTHING DELETED>"
"RTN","PSGOE9",123,0)
 Q
"RTN","PSGOEE")
0^4^B103788427^B103314834
"RTN","PSGOEE",1,0)
PSGOEE ;BIR/CML3 - EDIT ACTIVE OR NON-VERIFIED ORDERS ;8/12/10 5:59pm
"RTN","PSGOEE",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**4,7,29,47,64,58,82,91,110,111,112,142,179,181,254,267,268,281,315,338**;16 DEC 97;Build 8
"RTN","PSGOEE",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PSGOEE",4,0)
 ;
"RTN","PSGOEE",5,0)
 ; Reference to ^PS(55 is supported by DBIA# 2191.
"RTN","PSGOEE",6,0)
 ; Reference to ^PSSLOCK is supported by DBIA# 2789.
"RTN","PSGOEE",7,0)
 ; Reference to ^TMP("PSODAOC",$J is supported by DBIA# 6071.
"RTN","PSGOEE",8,0)
 ;
"RTN","PSGOEE",9,0)
 D NOW^%DTC S PSGDT=% K PSGEFN,PSGOEEF S PSGOEEF=0 I PSGORD["A"!(PSGORD["O") G ACT
"RTN","PSGOEE",10,0)
531 ; edit orders in 53.1
"RTN","PSGOEE",11,0)
ENF ; Entry point
"RTN","PSGOEE",12,0)
 D EN2^PSGOEEW
"RTN","PSGOEE",13,0)
 K PSJACEPT D EDLOOP G:'$G(PSJACEPT) OUT
"RTN","PSGOEE",14,0)
 I $G(PSGOEENO) D
"RTN","PSGOEE",15,0)
 . N PSGOEENO S PSGOEENO=1 D NEW
"RTN","PSGOEE",16,0)
 E  D
"RTN","PSGOEE",17,0)
 . N PSGOEENO S PSGOEENO=0 D UPD
"RTN","PSGOEE",18,0)
 I $G(PSGOEAV) D ACT1 Q
"RTN","PSGOEE",19,0)
 D DONE1
"RTN","PSGOEE",20,0)
 S PSGOEEF=0,PSJORD=PSGORD D GETUD^PSJLMGUD(PSGP,PSGORD),ENSFE^PSGOEE0(PSGP,PSGORD)
"RTN","PSGOEE",21,0)
 Q
"RTN","PSGOEE",22,0)
ACT ; Perform Edit
"RTN","PSGOEE",23,0)
 NEW PSJALGY1
"RTN","PSGOEE",24,0)
 K PSGOEER
"RTN","PSGOEE",25,0)
 D EN2^PSGOEEW,EDLOOP G:'$G(PSJACEPT) OUT
"RTN","PSGOEE",26,0)
 I $G(PSGOEENO) D
"RTN","PSGOEE",27,0)
 . N PSGOEENO S PSGOEENO=1 D NEW
"RTN","PSGOEE",28,0)
 E  D
"RTN","PSGOEE",29,0)
 . N PSGOEENO S PSGOEENO=0 D UPD
"RTN","PSGOEE",30,0)
 S:$D(PSGOEF)!$G(PSGOEENO) PSGCANFL=-1
"RTN","PSGOEE",31,0)
ACT1 ; Continue editing
"RTN","PSGOEE",32,0)
 D DONE1
"RTN","PSGOEE",33,0)
 S PSGOEEF=0 D GETUD^PSJLMGUD(PSGP,PSGORD),ENSFE^PSGOEE0(PSGP,PSGORD) D:PSGOEAV UNL^PSSLOCK(PSGP,PSGORD)
"RTN","PSGOEE",34,0)
 Q
"RTN","PSGOEE",35,0)
EDIT ; Edit
"RTN","PSGOEE",36,0)
 I $G(Y) D ASKOVR(Y,$G(PSGORD),.PSJSTARI)
"RTN","PSGOEE",37,0)
 D FULL^VALM1
"RTN","PSGOEE",38,0)
 W ! S PSGOEER="" F Q=1:1 S Q1=$P(Y,",",Q) Q:'Q1  S X=$P($T(@(PSGOEEG_Q1)),";",3),PSGOEER=PSGOEER_X_";",PSGOEEF(+X)=Q S:Q1=1 PSJALGY1=1
"RTN","PSGOEE",39,0)
 S LIMIT=$L(PSGOEER,";")-1,(PSGDEF,PSGOEE)=0 F  S PSGOEE=PSGOEE+1 Q:PSGOEE>LIMIT  I +$P(PSGOEER,";",PSGOEE)=101 S PSGDEF=1
"RTN","PSGOEE",40,0)
 S PSGOEER=$E(PSGOEER,1,$L(PSGOEER)-1),(MSG,PSGOEE)=0 F  S PSGOEE=PSGOEE+1 Q:PSGOEE>$L(PSGOEER,";")  S F1=$S(PSGOEEG=3:53.1,1:55.06) I 'PSGDEF!((PSGDEF)&(+$P(PSGOEER,";",PSGOEE)'=2)) D @$P(PSGOEER,";",PSGOEE) Q:'PSGOEE
"RTN","PSGOEE",41,0)
 Q
"RTN","PSGOEE",42,0)
EDLOOP ; Continue prompting for fields to edit.
"RTN","PSGOEE",43,0)
 K PSJNOO
"RTN","PSGOEE",44,0)
 D:$G(Y) EDIT I $G(PSGOROE1)=1!($G(PSGOEE)=0) S VALMBCK="R",(PSGOROE1,PSJACEPT)=0 Q
"RTN","PSGOEE",45,0)
 D ENNOU^PSGOEE0 I '$G(PSGOEENO),DR="" S VALMBCK="R" Q
"RTN","PSGOEE",46,0)
 K VALMSG
"RTN","PSGOEE",47,0)
 I '$G(PSGOEENO),$G(PSGPDNX) D CKDT
"RTN","PSGOEE",48,0)
 I $G(PSGOEENO) D
"RTN","PSGOEE",49,0)
 .S VALMSG="This change will cause a new order to be created." D GTSTATUS,CHKDD,CKDT
"RTN","PSGOEE",50,0)
 .S PSGEBN=$$ENNPN^PSGMI(DUZ),PSGLIN=$$ENDD^PSGMI(PSGDT)_U_$$ENDTC^PSGMI(PSGDT)
"RTN","PSGOEE",51,0)
 D CHK^PSGOEV("^^"_PSGMR_"^^^^"_PSGST,PSGPDRG_U_PSGDO,PSGSCH_U_PSGSD_"^^"_PSGFD)
"RTN","PSGOEE",52,0)
 K VALMBCK,PSJACEPT,PSGPDNX D EN^VALM("PSJU LM ACCEPT") Q:'$G(PSJACEPT)
"RTN","PSGOEE",53,0)
 I $G(PSGS0XT)="D",'$G(PSGS0Y) I ((",P,R,")'[(","_$G(PSGST)_",")) D  Q
"RTN","PSGOEE",54,0)
 .S PSJACEPT=0 W !!,"This is a 'DAY OF THE WEEK' schedule and MUST have admin times." D PAUSE^VALM1
"RTN","PSGOEE",55,0)
 I ($G(PSGOEER)["26^PSGOE9")!($G(PSGOEER)["26^PSGOE8")!($G(PSGOEER)["109^PSGOE9")!($G(PSGOEER)["109^PSGOE8")!($G(PSGOEER)["3^PSGOE9")!($G(PSGOEER)["3^PSGOE8")!($G(PSGOEER)["101^PSGOE9")!($G(PSGOEER)["101^PSGOE8") S PSGOEENO=1
"RTN","PSGOEE",56,0)
 I $G(PSGOEENO)!($G(PSGOEER)["2^PSGOE92")!($G(PSGOEER)["2^PSGOE82") D OC S:($G(PSGOEER)["2^PSGOE82") PSJDSVFY=1
"RTN","PSGOEE",57,0)
 I $G(PSGORQF) S PSJNOO=-1
"RTN","PSGOEE",58,0)
 I '$G(PSJNOO),$G(PSGOEENO) S PSJNOO=$$ENNOO^PSJUTL5("E")
"RTN","PSGOEE",59,0)
 D K1 S PSJACEPT=$S($G(PSJNOO)<0:0,1:1)
"RTN","PSGOEE",60,0)
 S VALMBCK=$S('PSJACEPT:"R",'PSGOEAV:"R",1:"Q")
"RTN","PSGOEE",61,0)
 Q
"RTN","PSGOEE",62,0)
OC ;Perform OC (only when OI or Dosage was edited) & dosing check
"RTN","PSGOEE",63,0)
 NEW PSJDD,PSJALLGY
"RTN","PSGOEE",64,0)
 K PSGORQF
"RTN","PSGOEE",65,0)
 D FULL^VALM1
"RTN","PSGOEE",66,0)
 S PSJDD=+$$DD53P45^PSJMISC() I 'PSJDD S PSGORQF=1 Q
"RTN","PSGOEE",67,0)
 I $G(PSJALGY1)!$G(PSGOEENO) D
"RTN","PSGOEE",68,0)
 . D ENDDC^PSGSICHK(PSGP,PSJDD)
"RTN","PSGOEE",69,0)
 D:'$G(PSGORQF) IN^PSJOCDS($G(PSGORD),"UD",PSJDD)
"RTN","PSGOEE",70,0)
 Q
"RTN","PSGOEE",71,0)
CHKDD ;*** Check inactive Dispense drug within the order.
"RTN","PSGOEE",72,0)
 D CHKDRG^PSGOE2
"RTN","PSGOEE",73,0)
 Q
"RTN","PSGOEE",74,0)
CKDT ; Check if new start/stop dates should be calculated.
"RTN","PSGOEE",75,0)
 S PSGS0Y=$S($D(PSGS0Y):PSGS0Y,1:$G(PSGAT))
"RTN","PSGOEE",76,0)
 ;PSJ*5*179 Recalc start date if Before last given
"RTN","PSGOEE",77,0)
 I ($P($G(PSBSTR),"^")>PSGSD)!('$G(PSGNEWDT)&(PSGSD=$G(PSGOSD))&(PSGFD=$G(PSGOFD)))!($G(PSGOST)'=PSGST)!(PSGSCH'=$G(PSGOSCH))!($G(PSGPDNX)) D
"RTN","PSGOEE",78,0)
 .N PSGOES S PSGOES=1,PSGOFD=PSGFD D ^PSGNE3 I $G(PSGOFD) S PSGNEFD=PSGFD
"RTN","PSGOEE",79,0)
 .S PSGSD=PSGNESD,PSGSDN=$$ENDD^PSGMI(PSGNESD)_U_$$ENDTC^PSGMI(PSGNESD),PSGFD=PSGNEFD,PSGFDN=$$ENDD^PSGMI(PSGNEFD)_U_$$ENDTC^PSGMI(PSGNEFD),PSGNEWDT=1
"RTN","PSGOEE",80,0)
 .I $D(PSGOFD),PSGOFD]"",PSGFD'=PSGOFD S PSGOEEF(25)=1
"RTN","PSGOEE",81,0)
 .I $D(PSGOSD),PSGOSD]"",PSGSD'=PSGOSD S PSGOEEF(10)=1
"RTN","PSGOEE",82,0)
 ;BHW;PSJ*5*179;Add EFD call here, removed from PSGOE91
"RTN","PSGOEE",83,0)
 D EFDACT^PSJUTL
"RTN","PSGOEE",84,0)
 Q
"RTN","PSGOEE",85,0)
NEW3 ;
"RTN","PSGOEE",86,0)
 ;S:PSGOEAV PSGOEAV="0^1"
"RTN","PSGOEE",87,0)
NEW ;
"RTN","PSGOEE",88,0)
 I $D(^PS(53.45,+$G(PSJSYSP),5)) N PSJFSI S PSJFSI=1 D FILESI^PSJBCMA5(DFN,PSGORD) N SIARRAY S SIARRAY="" D
"RTN","PSGOEE",89,0)
 .I PSGORD["P" M SIARRAY=^PS(53.1,+PSGORD,15) D NEWNVAL^PSGAL5(PSGORD,6000,"SPECIAL INSTRUCTIONS",,.SIARRAY)
"RTN","PSGOEE",90,0)
 .I PSGORD["U" M SIARRAY=^PS(55,DFN,5,+PSGORD,15) D NEWUDAL^PSGAL5(PSGORD,6000,"SPECIAL INSTRUCTIONS",,.SIARRAY)
"RTN","PSGOEE",91,0)
 W !,"...discontinuing original order..."
"RTN","PSGOEE",92,0)
 I PSGORD["P" S PSJCOM=+$P($G(^PS(53.1,+PSGORD,.2)),"^",8) I PSJCOM D NEW^PSJCOM1 Q
"RTN","PSGOEE",93,0)
 ;DC and Unlock order.
"RTN","PSGOEE",94,0)
 S PSGEDIT="DE" D ENOR^PSGOECS,UNL^PSSLOCK(PSGP,PSGORD) K PSGEDIT
"RTN","PSGOEE",95,0)
 W !!," ...creating new order..." W:'PSGOEAV "(you will now work on this new order)"
"RTN","PSGOEE",96,0)
 S PSGS0Y=PSGAT,PSGNESD=PSGSD,PSGNEFD=PSGFD,PSGOEPR=PSGPR,PSGPDRG=PSGPD,PSGPDRGN=PSGPDN,PSGOEE="E"
"RTN","PSGOEE",97,0)
 S PSGOORD=PSGORD D ^PSGOETO K PSGOEOS
"RTN","PSGOEE",98,0)
 I PSGOORD["U" S $P(^PS(55,PSGP,5,+PSGOORD,0),"^",26,27)=PSGORD_"^E"
"RTN","PSGOEE",99,0)
 E  S $P(^PS(53.1,+PSGOORD,0),"^",26,27)=PSGORD_"^E"
"RTN","PSGOEE",100,0)
 I $G(PSJFSI) I $$GETSI^PSJBCMA5(DFN,PSGOORD) D FILESI^PSJBCMA5(DFN,PSGORD)
"RTN","PSGOEE",101,0)
 I 'PSGOEAV,($G(PSGORD)["P"),'$G(^PS(53.1,+PSGORD,2.5)),$G(^PS(53.1,+PSGORD,0)) D
"RTN","PSGOEE",102,0)
 . N DUR S DUR=$$GETDUR^PSJLIVMD(PSGP,PSGORD,$S(PSGORD["P":"P",1:5),1) I DUR]"" K DA,DR,DIE S DIE="^PS(53.1,",DA=+PSGORD,DR="116////"_DUR D ^DIE
"RTN","PSGOEE",103,0)
 I PSGOEAV D
"RTN","PSGOEE",104,0)
 . S ^TMP("PSODAOC",$J,"IP IEN")=PSGORD
"RTN","PSGOEE",105,0)
 . D SETOC^PSJNEWOC(PSGORD) ;PSJ*5*281 stores order checks
"RTN","PSGOEE",106,0)
 I PSGOEAV,+PSJSYSU=3,'$D(PSGOES) D EN^PSGPEN(PSGORD),UNL^PSSLOCK(PSGP,PSGORD) Q
"RTN","PSGOEE",107,0)
 S PSJORD=PSGORD,PSGACT=$$ENACTION^PSGOE1(PSGP,PSGORD)
"RTN","PSGOEE",108,0)
 ;K ^TMP("PSODAOC",$J),^TMP("PSJDAOC",$J)
"RTN","PSGOEE",109,0)
 Q
"RTN","PSGOEE",110,0)
UPD ;
"RTN","PSGOEE",111,0)
 K DA W !!,"...updating order..."
"RTN","PSGOEE",112,0)
 I PSGORD["P" S PSJCOM=+$P($G(^PS(53.1,+PSGORD,.2)),"^",8) I PSJCOM D UPD^PSJCOM Q
"RTN","PSGOEE",113,0)
 I $$DIFFSI^PSJBCMA5(DFN,PSGORD) D
"RTN","PSGOEE",114,0)
 .N SIARRAY M:PSGORD["P" SIARRAY=^PS(53.1,+PSGORD,15) M:PSGORD["U" SIARRAY=^PS(55,DFN,5,+PSGORD,15)
"RTN","PSGOEE",115,0)
 .Q:'$D(SIARRAY)
"RTN","PSGOEE",116,0)
 .I PSGORD["P" D NEWNVAL^PSGAL5(PSGORD,6000,"SPECIAL INSTRUCTIONS",,.SIARRAY)
"RTN","PSGOEE",117,0)
 .I PSGORD["U" D NEWUDAL^PSGAL5(DFN,PSGORD,6000,"SPECIAL INSTRUCTIONS",,.SIARRAY)
"RTN","PSGOEE",118,0)
 ; Set trigger for FIELD (12) Dispense Drug to print a updated pick list.
"RTN","PSGOEE",119,0)
 I PSGORD["U",$D(^PS(53.45,PSJSYSP,2,1,0)),$D(^PS(55,PSGP,5,+PSGORD,1,1,0)) D
"RTN","PSGOEE",120,0)
 .N PSJX12,PSJF12 S PSJF12=0
"RTN","PSGOEE",121,0)
 .F PSJX12=0:1 S PSJX12=$O(^PS(53.45,PSJSYSP,2,PSJX12)) Q:+PSJX12=0  S:$G(^PS(53.45,PSJSYSP,2,PSJX12,0))'=$G(^PS(55,PSGP,5,+PSGORD,1,PSJX12,0)) PSJF12=1
"RTN","PSGOEE",122,0)
 .S:PSJF12 ^PS(55,"AUE",PSGP,+PSGORD)=""
"RTN","PSGOEE",123,0)
 N TMP,PSGSIF S TMP=PSGOEENO N PSGOEENO S PSGOEENO=TMP
"RTN","PSGOEE",124,0)
 N II F II=1:1:$L($G(DR),";") I $E($P($G(DR),";",II),1,7)="122////" S PSGSIF=$P(PSGSI,"^",2),PSGSI=$P(PSGSI,"^") Q
"RTN","PSGOEE",125,0)
 I $G(PSJCOM),$G(PSJCOMSI) K PSJCOMSI,^TMP("PSGSI",$J) M ^TMP("PSGSI",$J,5)=^PS(53.45,PSJSYSP,5) D
"RTN","PSGOEE",126,0)
 .D FILESI^PSJBCMA5(DFN,PSGORD)
"RTN","PSGOEE",127,0)
 .N PSJCHILD,PSJOEORD S PSJOEORD=0 F  S PSJOEORD=$O(^PS(55,"ACX",PSJCOM,PSJOEORD)) Q:'PSJOEORD  D
"RTN","PSGOEE",128,0)
 .. S PSJCHILD=0 F  S PSJCHILD=$O(^PS(55,"ACX",PSJCOM,PSJOEORD,PSJCHILD)) Q:'PSJCHILD  D
"RTN","PSGOEE",129,0)
 ... Q:PSJCHILD=PSGORD  N DR,DA,DIE,ORD S DR=$S(PSJCHILD["V":"31////"_$G(P("OPI")),1:"8////"_$G(PSGSI)) S DR=DR_";"_$S(PSJCHILD["V":146,1:122)_"////"_+$G(PSGSIF)
"RTN","PSGOEE",130,0)
 ... I '$D(^PS(53.45,+$G(PSJSYSP),5)) M ^PS(53.45,+$G(PSJSYSP),5)=^TMP("PSGSI",$J,5)
"RTN","PSGOEE",131,0)
 ... D FILESI^PSJBCMA5(DFN,PSJCHILD)
"RTN","PSGOEE",132,0)
 ... ;PSJ*5*179 Comment edits
"RTN","PSGOEE",133,0)
 ... S DR=$TR($G(DR),"*") I DR'="" S DA=+PSJCHILD,DIE=$S(PSJCHILD["U":"^PS(55,"_PSGP_",5,",1:"^PS(53.1,") S:DIE["^PS(55," DA(1)=PSGP D ^DIE W "." D EN1^PSJHL2(PSGP,"XX",+PSJCHILD_"U")
"RTN","PSGOEE",134,0)
 . K ^TMP("PSGSI",$J)
"RTN","PSGOEE",135,0)
 S DR=$TR(DR,"*") I DR'="" S DA=+PSGORD,DIE=$S(PSGORD["U":"^PS(55,"_PSGP_",5,",1:"^PS(53.1,") S:DIE["^PS(55," DA(1)=PSGP D ^DIE W "."
"RTN","PSGOEE",136,0)
 F Q=1,3 K @(PSGOEEWF_Q_")") S %X="^PS(53.45,"_PSJSYSP_","_$S(Q=1:2,1:1)_",",%Y=PSGOEEWF_Q_"," K @(PSGOEEWF_Q_")") D %XY^%RCR W "."
"RTN","PSGOEE",137,0)
 S $P(@(PSGOEEWF_"1,0)"),"^",2)=$S(PSGORD["U":55.07,1:53.11)_"P"
"RTN","PSGOEE",138,0)
 I $D(^PS(53.45,+$G(PSJSYSP),5)) D FILESI^PSJBCMA5(DFN,PSJORD)
"RTN","PSGOEE",139,0)
 ; Naked reference on the line below refers to full reference using indirection to either ^PS(55 or ^PS(53.1,
"RTN","PSGOEE",140,0)
 S ND=$G(@($S(PSGORD["U":"^PS(55,"_PSGP_",5,",1:"^PS(53.1,")_+PSGORD_",0)")) I $P(ND,"^",21) S ORIFN=$P(ND,"^",21),ND1=$G(^(.2)),ND2=$G(^(2)),ND2P1=$G(^(2.1)) W !,"...updating OE/RR..." D EN1^PSJHL2(PSGP,"XX",PSGORD) ;*315
"RTN","PSGOEE",141,0)
 I $$ENACTION^PSGOE1(PSGP,PSGORD)["V" S VALMBCK="R"
"RTN","PSGOEE",142,0)
 I PSJSYSL,PSJSYSL<3 S $P(@($S(PSGORD["U":"^PS(55,"_PSGP_",5,",1:"^PS(53.1,")_+PSGORD_",7)"),"^",1,2)=PSGDT_"^"_$E("D",PSGOEENO)_"E",PSGTOL=2,PSGUOW=DUZ,PSGTOO=PSGORD'["U"+1,DA=+PSGORD D ENL^PSGVDS
"RTN","PSGOEE",143,0)
 ; **This is where the Automated Dispensing Machine hook is called. Do NOT DELETE or change this location **
"RTN","PSGOEE",144,0)
 D EDIT^PSJADM
"RTN","PSGOEE",145,0)
 ; **END of Interface Hook **
"RTN","PSGOEE",146,0)
 Q
"RTN","PSGOEE",147,0)
OUT ;
"RTN","PSGOEE",148,0)
 D ABORT K PSGNEWDT S PSGCANFL=1 D GETUD^PSJLMGUD(PSGP,PSGORD),ENSFE^PSGOEE0(PSGP,PSGORD),INIT^PSJLMUDE(PSGP,PSGORD)
"RTN","PSGOEE",149,0)
 Q
"RTN","PSGOEE",150,0)
DONE ;
"RTN","PSGOEE",151,0)
 I PSGORD["P",'$D(PSGOEF),PSGSCH]"",$O(^PS(53.1,+PSGORD,1,0)) D ENF^PSGOEE0
"RTN","PSGOEE",152,0)
DONE1 ;
"RTN","PSGOEE",153,0)
 I PSGORD["U" S X=+PSGORD L -^PS(55,PSGP,5,X)
"RTN","PSGOEE",154,0)
 E  L -^PS(53.1,+PSGORD)
"RTN","PSGOEE",155,0)
 K ^PS(53.45,+PSJSYSP,1),^(2),^(5),^(6)
"RTN","PSGOEE",156,0)
 I '$D(PSGOEF) K PSGSD,PSGSCH,PSGST,PSGFD
"RTN","PSGOEE",157,0)
 K DA,DIE,DIR,DP,DR,DRG,ND,ND0,ND1,ND2,ND2P1,ORIFN,PSGAL,PSGALEF,PSGAT,PSGOEE,PSGOEEF,PSGOEEG,PSGOEEWF,PSGEFN,PSGTOL,PSGTOO,PSGUOW,XREF,PSGEFN,PSGMR,PSGMRN,PSGOROE1,PSGPD,PSGPDN,PSGSI,PSGPR,PSGSM,PSGHSM,PSGSTN,PSGSDN,PSGFDN,PSGPRN
"RTN","PSGOEE",158,0)
 K PSGDO,PSGOEENO Q
"RTN","PSGOEE",159,0)
K1 ;
"RTN","PSGOEE",160,0)
 K BACK,F1,F2,PSGF2,MSG,PSGEFN,PSGNEWDT,PSGOEEND,PSGOPD,PSGOPDN,PSGOMR,PSGOMRN,PSGOSCH,PSGOSI,PSGOPR,PSGOSM,PSGOHSM,PSGOSD,PSGOFD,PSGOST,PSGOPRN,PSGOSTN,PSGOSDN,PSGOFDN,PSGODO,PSGPDRG,PSGPDRGN,PSGOEER
"RTN","PSGOEE",161,0)
 Q
"RTN","PSGOEE",162,0)
 ;
"RTN","PSGOEE",163,0)
ABORT ; Display no change message and pause.
"RTN","PSGOEE",164,0)
 D FULL^VALM1
"RTN","PSGOEE",165,0)
 S (PSGDI,PSGDFLG)='$$DDOK^PSGOE2(PSGOEEWF_"1,",+$G(@(PSGOEEWF_".2)")))
"RTN","PSGOEE",166,0)
 S PSGPFLG='$$OIOK^PSGOE2(+$G(@(PSGOEEWF_".2)")))
"RTN","PSGOEE",167,0)
 I '$G(PSJRNFLG) W !!,$C(7),"No changes made to this order." D PAUSE^VALM1  ;if flag set in PSODGAL1, no repeat message
"RTN","PSGOEE",168,0)
 K PSGOEEF S PSGOEEF=0
"RTN","PSGOEE",169,0)
 Q
"RTN","PSGOEE",170,0)
 ;
"RTN","PSGOEE",171,0)
GTSTATUS ; Determine status of new order and set LM title.
"RTN","PSGOEE",172,0)
 S PSGSTAT=$S($P($G(PSJSYSP0),U,9):"ACTIVE",1:"NON-VERIFIED")
"RTN","PSGOEE",173,0)
 S VALM("TITLE")=PSGSTAT_" UNIT DOSE "_$S(PSGSTAT="PENDING":"("_PSGPRIO_")",1:"")
"RTN","PSGOEE",174,0)
 Q
"RTN","PSGOEE",175,0)
 ;
"RTN","PSGOEE",176,0)
ASKOVR(Y,PSJOVRON,PSJSTARI)  ; Check to see if any starred fields are being edited. If so, ask if they wish to view overrides/interventions if they exist
"RTN","PSGOEE",177,0)
 Q:'$D(Y)!$D(PSJSTARI)  N II,I3,YY S YY=$S(Y:Y,1:$TR($P(Y,"^",4),"="))
"RTN","PSGOEE",178,0)
 Q:'YY  S PSJOVRON=$S($G(PSJOVRON):PSJOVRON,1:$G(PSJORD)) Q:'$G(PSJOVRON)
"RTN","PSGOEE",179,0)
 N PSJORD S PSJORD=PSJOVRON
"RTN","PSGOEE",180,0)
 I '$G(PSJSTARI) F II=1:1:$L(YY,",") Q:$G(PSJSTARI)  S I3=$P(YY,",",II) I I3 S:$G(PSGEFN(I3))!($G(PSJSTAR)[("("_I3_")")) PSJSTARI=1
"RTN","PSGOEE",181,0)
 I $G(PSJSTARI) I ($G(PSJORD)&$G(PSGP)) I $$ASKDISP^PSGSICH1 D FULL^VALM1 D OVRDISP^PSGSICH2(PSGP,PSJORD,3)
"RTN","PSGOEE",182,0)
 Q
"RTN","PSGOEE",183,0)
 ;
"RTN","PSGOEE",184,0)
FIELDS ;
"RTN","PSGOEE",185,0)
31 ;;101^PSGOE8;PSGOPD;PSGPD;101;1
"RTN","PSGOEE",186,0)
32 ;;109^PSGOE8;PSGODO;PSGDO;109;PSGODO]""
"RTN","PSGOEE",187,0)
33 ;;10^PSGOE81;PSGOSD;PSGSD;10;0
"RTN","PSGOEE",188,0)
34 ;;3^PSGOE8;PSGOMR;PSGMR;3;1
"RTN","PSGOEE",189,0)
35 ;;25^PSGOE81;PSGOFD;PSGFD;25;0
"RTN","PSGOEE",190,0)
36 ;;7^PSGOE8;PSGOST;PSGST;7;0
"RTN","PSGOEE",191,0)
37 ;;5^PSGOE82;PSGOSM;PSGSM;5;0
"RTN","PSGOEE",192,0)
38 ;;26^PSGOE8;PSGOSCH;PSGSCH;26;1
"RTN","PSGOEE",193,0)
39 ;;39^PSGOE81;PSGOAT;PSGAT;39;0
"RTN","PSGOEE",194,0)
310 ;;1^PSGOE82;PSGOPR;PSGPR;1;1
"RTN","PSGOEE",195,0)
311 ;;8^PSGOE81;PSGOSI;PSGSI;8;0
"RTN","PSGOEE",196,0)
312 ;;2^PSGOE82;;;2;0
"RTN","PSGOEE",197,0)
313 ;;40^PSGOE82;;;40;0
"RTN","PSGOEE",198,0)
51 ;;101^PSGOE9;PSGOPD;PSGPD;101;1
"RTN","PSGOEE",199,0)
52 ;;109^PSGOE9;PSGODO;PSGDO;109;PSGODO]""
"RTN","PSGOEE",200,0)
53 ;;10^PSGOE91;PSGOSD;PSGSD;10;1
"RTN","PSGOEE",201,0)
54 ;;3^PSGOE9;PSGOMR;PSGMR;3;1
"RTN","PSGOEE",202,0)
55 ;;34^PSGOE91;PSGOFD;PSGFD;34;1 
"RTN","PSGOEE",203,0)
56 ;;7^PSGOE9;PSGOST;PSGST;7;0
"RTN","PSGOEE",204,0)
57 ;;5^PSGOE92;PSGOSM;PSGSM;5;0
"RTN","PSGOEE",205,0)
58 ;;26^PSGOE9;PSGOSCH;PSGSCH;26;1
"RTN","PSGOEE",206,0)
59 ;;41^PSGOE91;PSGOAT;PSGAT;41;0
"RTN","PSGOEE",207,0)
510 ;;1^PSGOE92;PSGOPR;PSGPR;1;1
"RTN","PSGOEE",208,0)
511 ;;8^PSGOE91;PSGOSI;PSGSI;8;0
"RTN","PSGOEE",209,0)
512 ;;2^PSGOE92;;;2;0
"RTN","PSGOEE",210,0)
513 ;;15^PSGOE92;;;15;0
"RTN","PSGOER")
0^5^B87602402^B87272469
"RTN","PSGOER",1,0)
PSGOER ;BIR/CML3 - RENEW A SINGLE ORDER ;4/27/11 9:54am
"RTN","PSGOER",2,0)
 ;;5.0;INPATIENT MEDICATIONS ;**11,30,29,35,70,58,95,110,111,133,141,198,181,246,278,281,315,338**;16 DEC 97;Build 8
"RTN","PSGOER",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PSGOER",4,0)
 ;
"RTN","PSGOER",5,0)
 ; Reference to ^PS(51.1 supported by DBIA 2177.
"RTN","PSGOER",6,0)
 ; Reference to ^PS(55 supported by DBIA 2191.
"RTN","PSGOER",7,0)
 ; Reference to ^PSSLOCK is supported by DBIA 2789.
"RTN","PSGOER",8,0)
 ; Reference to ^PSBAPIPM is supported by DBIA 3564.
"RTN","PSGOER",9,0)
 ; Reference to ^PS(59.7 is supported by DBIA 2181.
"RTN","PSGOER",10,0)
 ; Reference to ^PSDRUG( is supported by DBIA 2192.
"RTN","PSGOER",11,0)
 ; Reference to ^TMP("PSODAOC",$J is supported by DBIA 6071.
"RTN","PSGOER",12,0)
 ;
"RTN","PSGOER",13,0)
 ; renew a single order
"RTN","PSGOER",14,0)
 I $G(PSJCOM) D ^PSJCOMR Q
"RTN","PSGOER",15,0)
 N PSJEXPIR S PSJEXPIR=$$EXPIRED(PSGP,PSGORD) I PSJEXPIR D  Q
"RTN","PSGOER",16,0)
 .W !!?3,"  THIS ORDER" W:PSJEXPIR'=2 " HAS BEEN INACTIVE FOR ONE OR MORE SCHEDULED",!?8," ADMINISTRATIONS AND"
"RTN","PSGOER",17,0)
 .W " CANNOT BE RENEWED!" D PAUSE^VALM1
"RTN","PSGOER",18,0)
 I $G(PSGSCH)]"",($G(PSGS0XT)="D"),($G(PSGAT)="") D  Q
"RTN","PSGOER",19,0)
 .N SWD,SDW,XABB,X,QX S X=$G(PSGSCH) D DW^PSGS0 Q:($G(X)="")  I $G(PSGS0XT)="" S PSGS0XT="D"
"RTN","PSGOER",20,0)
 .Q:((",P,R,")[(","_$G(PSGST)_","))
"RTN","PSGOER",21,0)
 .I $G(PSGS0XT)="D",$G(PSGAT)="" S CHK=1 W !!?3,"This order contains a 'DAY OF THE WEEK' schedule without admin times"
"RTN","PSGOER",22,0)
 .W !?11," and CANNOT be renewed!" D PAUSE^VALM1
"RTN","PSGOER",23,0)
 I $G(PSGSCH)]"",'$$DOW^PSIVUTL(PSGSCH),'$$PRNOK^PSGS0(PSGSCH) I '$D(^PS(51.1,"AC","PSJ",PSGSCH)) D  Q
"RTN","PSGOER",24,0)
 .W !!?3,"This order contains an invalid schedule and CANNOT be renewed!" D PAUSE^VALM1
"RTN","PSGOER",25,0)
 W !! K DIR S DIR(0)="Y",DIR("A")=$S($P(PSJSYSP0,"^",3):"RENEW THIS ORDER",1:"MARK THIS ORDER FOR RENEWAL"),DIR("B")="YES"
"RTN","PSGOER",26,0)
 S DIR("?")="Answer 'YES' to "_$S($P(PSJSYSP0,"^",3):"renew this order",1:"mark this order for renewal")_".  Answer 'NO' (or '^') to stop now." D ^DIR
"RTN","PSGOER",27,0)
 I '$D(DIRUT),Y D NEW S PSGCANFL=1 D DONE Q
"RTN","PSGOER",28,0)
 I '$D(DIRUT),PSJSYSU S PSGND4=$G(^PS(55,PSGP,5,+PSGORD,4)) I $P(PSGND4,"^",15),$P(PSGND4,"^",16) D UNMARK,DONE Q
"RTN","PSGOER",29,0)
 D DONE,ABORT^PSGOEE
"RTN","PSGOER",30,0)
 Q
"RTN","PSGOER",31,0)
 ;
"RTN","PSGOER",32,0)
UNMARK ;  
"RTN","PSGOER",33,0)
 W !!,"THIS ORDER HAS BEEN 'MARKED FOR RENEWAL'.",! K DIR S DIR(0)="Y",DIR("A")="DO YOU WANT TO 'UNMARK IT'",DIR("B")="NO"
"RTN","PSGOER",34,0)
 S DIR("?",1)="  Answer 'YES' to unmark this order.  Answer 'NO' (or '^') to leave the order",DIR("?")="marked.  (An answer is required.)" D ^DIR
"RTN","PSGOER",35,0)
 I 'Y D ABORT^PSGOEE G DONE
"RTN","PSGOER",36,0)
 S DA(1)=PSGP,DA=+PSGORD,PSGAL("C")=21180+PSJSYSU D ^PSGAL5 S $P(PSGND4,"^",15,17)="^^",^PS(55,PSGP,5,DA,4)=PSGND4 W "...DONE!"
"RTN","PSGOER",37,0)
 ;
"RTN","PSGOER",38,0)
DONE ;
"RTN","PSGOER",39,0)
 K %DT,DA,DIE,DIR,DR,FDSD,PSGAL,PSGALR,PSGDL,PSGDLS,PSGFD,PSGFOK,PSGND4,PSGOEE,PSGOER0,PSGOER1,PSGOER2,PSGOERDP,PSGPOSA,PSGPOSD,PSGPR,PSGPX,PSGRD,PSGSD,PSGTOL,PSGTOO,PSGUOW,PSGWLL,RF Q
"RTN","PSGOER",40,0)
 ;
"RTN","PSGOER",41,0)
NEW ; get info, write record
"RTN","PSGOER",42,0)
EXTEND ; extend stop date on renewal order
"RTN","PSGOER",43,0)
 N DUOUT,PSJABT,PSGDRG,PSJREN,PSGOREAS S PSGDRG=$P($G(^PS(55,PSGP,5,+PSGORD,1,1,0)),"^"),PSJREN=1
"RTN","PSGOER",44,0)
 I $G(PSGST)="O" N ACT S ACT=$$EN^PSBAPIPM(PSGP,PSGORD) I $P(ACT,"^",2),($P(ACT,"^",3)="G") I $P(ACT,"^",2)>$P($G(^PS(55,PSGP,5,+PSGORD,2)),"^",2) D  Q
"RTN","PSGOER",45,0)
 . W !!?5,"THIS ONE-TIME ORDER HAS ALREADY BEEN GIVEN AND CANNOT BE RENEWED",! S (DIRUT,PSGORQF)=1 D READ
"RTN","PSGOER",46,0)
 ;D OC55
"RTN","PSGOER",47,0)
 ;Q:$D(PSGORQF)  ; quit if not to continue
"RTN","PSGOER",48,0)
 D NOW^%DTC S PSGDT=%,PSGND4=$G(^PS(55,PSGP,5,+PSGORD,4)) I '$P(PSJSYSP0,"^",3) D MARK Q
"RTN","PSGOER",49,0)
 S PSGWLL=$S('$P(PSJSYSW0,"^",4):0,1:+$G(^PS(55,PSGP,5.1))),PSGOEE="R" K PSGOEOS
"RTN","PSGOER",50,0)
 K ^PS(53.45,PSJSYSP,1),^(2) D MOVE(3,1),MOVE(1,2)
"RTN","PSGOER",51,0)
 D DATE^PSGOER0(PSGP,PSGORD,PSGDT) I ($G(X)="^")!'$D(PSGFOK(106))!$G(DUOUT) D DONE,ABORT^PSGOEE S VALMBCK="R",COMQUIT=1 Q
"RTN","PSGOER",52,0)
 ;D OC55
"RTN","PSGOER",53,0)
 ;I $G(PSGORQF) D DONE,ABORT^PSGOEE S VALMBCK="R",COMQUIT=1 Q
"RTN","PSGOER",54,0)
SPEED ;
"RTN","PSGOER",55,0)
 I +$G(PSJSYSU)=3 D EN^PSGPEN(PSGORD)
"RTN","PSGOER",56,0)
 Q:$G(DUOUT)
"RTN","PSGOER",57,0)
 N PSGOEAV S PSGOEAV=+PSJSYSU
"RTN","PSGOER",58,0)
 W !!,"...updating order..." K DA S DA(1)=PSGP,DA=+PSGORD,PSGAL("C")=PSJSYSU*10+18000 D ^PSGAL5 W "."
"RTN","PSGOER",59,0)
 I $$LS^PSSLOCK(PSGP,PSGORD) D UPDREN(PSGORD,PSGDT,PSGOEPR,PSGOFD,PSJNOO),UPDRENOE(PSGP,PSGORD,PSGDT) D UNL^PSSLOCK(PSGP,PSGORD)
"RTN","PSGOER",60,0)
 S ^TMP("PSODAOC",$J,"IP IEN")=PSGORD   ;set up which IEN will be used to store order checks
"RTN","PSGOER",61,0)
 D SETOC^PSJNEWOC(PSGORD) ;PSJ*5*281 stores order checks
"RTN","PSGOER",62,0)
 K ^TMP("PSODAOC",$J),^TMP("PSJDAOC",$J)
"RTN","PSGOER",63,0)
 ;
"RTN","PSGOER",64,0)
 I 'PSGOERDP,$P(PSJSYSW0,"^",4),PSGFD'<PSGWLL S $P(^PS(55,PSGP,5.1),"^")=+PSGFD
"RTN","PSGOER",65,0)
 W ".DONE!" S VALMBCK="Q" Q
"RTN","PSGOER",66,0)
 ;
"RTN","PSGOER",67,0)
MARK ;
"RTN","PSGOER",68,0)
 I $P(PSGND4,"^",15),$P(PSGND4,"^",16) W $C(7),!!?3,"...THIS ORDER IS ALREADY MARKED FOR RENEWAL!..." Q
"RTN","PSGOER",69,0)
 K DA S $P(PSGND4,"^",15,17)="1^"_DUZ_"^"_PSGDT,^PS(55,PSGP,5,+PSGORD,4)=PSGND4,PSGAL("C")=13180,DA(1)=PSGP,DA=+PSGORD W "." D ^PSGAL5
"RTN","PSGOER",70,0)
 I $D(PSJSYSO) S PSGORD=+PSGORD_"A",PSGPOSA="R",PSGPOSD=PSGDT D ENPOS^PSGVDS
"RTN","PSGOER",71,0)
 Q
"RTN","PSGOER",72,0)
MOVE(X,Y) ; Move comments/dispense drugs from 55 to 53.45.
"RTN","PSGOER",73,0)
 S Q=0 F  S Q=$O(^PS(55,PSGP,5,+PSGORD,X,Q)) Q:'Q  S ^PS(53.45,PSJSYSP,Y,Q,0)=$G(^(Q,0)) S ^PS(53.45,PSJSYSP,Y,0)="^53.450"_Y_"P^"_Q_U_Q
"RTN","PSGOER",74,0)
 ;S:Q ^PS(53.45,Y,0)="^53.450"_Y_"P^"_Q_U_Q
"RTN","PSGOER",75,0)
 Q
"RTN","PSGOER",76,0)
OC55 ;* Order checks for Speed finish and regular finish
"RTN","PSGOER",77,0)
 ;PSJ*5*181 - no longer use (OC will be triggered from OC^PSGOER0)
"RTN","PSGOER",78,0)
 Q
"RTN","PSGOER",79,0)
NEWOC55 ;
"RTN","PSGOER",80,0)
 N INTERVEN,PSJDDI,PSJIREQ,PSJRXREQ,PSJPDRG,PSJDD,PSJDD0,PSJALLGY
"RTN","PSGOER",81,0)
 S Y=1,(PSJIREQ,PSJRXREQ,INTERVEN,X)=""
"RTN","PSGOER",82,0)
 F PSGDDI=0:0 S PSGDDI=$O(^PS(55,PSGP,5,+PSGORD,1,PSGDDI)) Q:'+PSGDDI  D
"RTN","PSGOER",83,0)
 . S PSJDD0=$G(^PS(55,PSGP,5,+PSGORD,1,PSGDDI,0))
"RTN","PSGOER",84,0)
 . S PSJX=$P(PSJDD0,U,3) I PSJX]"",(PSJX'>$G(PSGDT)) Q
"RTN","PSGOER",85,0)
 . S PSJDD=+PSJDD0
"RTN","PSGOER",86,0)
 . S PSJX=$S('$D(^PSDRUG(+PSJDD,0)):1,$P($G(^(2)),U,3)'["U":1,$G(^("I"))="":0,1:^("I")'>$G(PSGDT))
"RTN","PSGOER",87,0)
 . Q:PSJX
"RTN","PSGOER",88,0)
 . S PSJALLGY(PSJDD)=""
"RTN","PSGOER",89,0)
 S PSJDD=$O(PSJALLGY(0))
"RTN","PSGOER",90,0)
 I '+PSJDD W !!,"No active dispense drug was found" D PAUSE^PSJLMUT1 Q
"RTN","PSGOER",91,0)
 K PSGORQF D ENDDC^PSGSICHK(PSGP,PSJDD)
"RTN","PSGOER",92,0)
 D:'$G(PSGORQF) IN^PSJOCDS(PSGORD,"UD",PSJDD) Q:$G(PSGORQF)
"RTN","PSGOER",93,0)
 Q
"RTN","PSGOER",94,0)
UPDREN(PSGORD,RNWDT,PSGOEPR,PSGOFD,PSJNOO,RDUZ) ; update renewed order
"RTN","PSGOER",95,0)
 N DR,DA,DIC,DIE,DD,DO,PSGRZERO,PSGRFOUR,PSGOORD
"RTN","PSGOER",96,0)
 S DR="",PSGOEENO=0,PSGOORD=PSGORD,PSGNESD=PSGSD Q:'PSGORD!'RNWDT!'PSGOEPR!'PSGOFD  S PSJNOO=$S($G(PSJNOO)]"":$G(PSJNOO),1:"E")
"RTN","PSGOER",97,0)
 S PSGRZERO="^PS(55,"_PSGP_",5,"_+PSGORD_",0)",PSGOEORD=$P(@PSGRZERO,"^",21)
"RTN","PSGOER",98,0)
 ; PSJ*5*141 - changed PSGOEPR to PSGPR for field 1 of the DR string below.
"RTN","PSGOER",99,0)
 S DA(1)=PSGP,DA=+PSGORD,DIE="^PS(55,"_PSGP_",5," S DR="34////^S X=PSGFD" S:$G(PSGPR) DR=DR_";1////"_PSGPR_";110////"_PSJNOO D ^DIE
"RTN","PSGOER",100,0)
 K DR,DA,DIC,DIE,DD,DO S DIC="^PS(55,"_PSGP_",5,"_+PSGORD_",14,",DIC(0)="L",DIC("P")="55.6114DA",ND14=$G(@(DIC_"0)")),DINUM=$P(ND14,"^",3)+1,DA(2)=PSGP,DA(1)=+PSGORD D
"RTN","PSGOER",101,0)
 . S DIC("DR")=".01////"_$G(RNWDT)_";1////"_$S($G(RDUZ):RDUZ,1:$G(DUZ))_";2////"_$G(PSGOEPR)_";3////"_$G(PSGOFD)_";4////"_+PSGOEORD,X=$G(RNWDT) D FILE^DICN
"RTN","PSGOER",102,0)
 K DR,DA,DIC,DIE,DD,DO S DA(1)=PSGP,DA=+PSGORD,DIE="^PS(55,"_PSGP_",5,",DR="28////A;105////@;107////@"
"RTN","PSGOER",103,0)
 ;PSJ*5*198
"RTN","PSGOER",104,0)
 S PSGRFOUR="^PS(55,"_PSGP_",5,"_+PSGORD_",4)",PSGRFOUR=@PSGRFOUR I $P(PSGRFOUR,"^",2)<RNWDT S DR=DR_";16////@;17////@" I $G(PSJORD)["P",+PSJSYSU=1 S DR=DR_";18////@;19////@"
"RTN","PSGOER",105,0)
 I '$G(PSJSPEED) I $G(PSGAT)]"",$G(PSGAT)'=$P($G(@(DIE_+PSGORD_",2)")),"^",5) S DR=DR_";41////"_PSGAT
"RTN","PSGOER",106,0)
 D ^DIE
"RTN","PSGOER",107,0)
 ; PSJ*5*278 - Check to re-assign orderable item
"RTN","PSGOER",108,0)
 N PSGPOI S PSGPOI=$$ACTIVE^PSJORREN(PSGP,PSGORD) Q:+PSGPOI=1  ;Quit if no change to OI
"RTN","PSGOER",109,0)
 I +PSGPOI>1,$P(PSGPOI,U,2) D  ;replace OI
"RTN","PSGOER",110,0)
 . N DR,DA,DIE S DA(1)=PSGP,DA=+PSGORD,DIE="^PS(55,"_PSGP_",5,",DR="108///^S X=$P(PSGPOI,U,2)" D ^DIE
"RTN","PSGOER",111,0)
 Q
"RTN","PSGOER",112,0)
UPDRENOE(PSGP,PSGORD,RDATE) ;
"RTN","PSGOER",113,0)
 D EXPOE(PSGP,PSGORD,$G(RDATE)) ; expire original Orders File order
"RTN","PSGOER",114,0)
 I PSGORD'["P" K DA,DR,DIE S DA(1)=DFN,DA=+PSGORD,DIE="^PS(55,"_DFN_$S(PSGORD="U":",5,",1:",""IV"","),DR=$S(DIE["IV":110,1:66)_"////@" D ^DIE
"RTN","PSGOER",115,0)
 D ENUDTX^PSJOREN(PSGP,PSGORD,"NR")
"RTN","PSGOER",116,0)
 D EN1^PSJHL2(PSGP,"SN",PSGORD,"ORDER RENEWED")
"RTN","PSGOER",117,0)
 Q
"RTN","PSGOER",118,0)
READ ; hold screen
"RTN","PSGOER",119,0)
 I $D(IOST) Q:$E(IOST)'="C"
"RTN","PSGOER",120,0)
 W !?5,"Press return to continue  " R X:$S($D(DTIME):DTIME,1:300)
"RTN","PSGOER",121,0)
 Q
"RTN","PSGOER",122,0)
EXPOE(DFN,PSJORDER,EXPDT) ; expire old Orders File entry
"RTN","PSGOER",123,0)
 I PSJORDER["P" S FILE="^PS(53.1,"_+PSJORDER_",0)",PSJORDER=$P(@FILE,"^",25)
"RTN","PSGOER",124,0)
 I (PSJORDER'["U"),(PSJORDER'["V") Q
"RTN","PSGOER",125,0)
 N CURDAT D NOW^%DTC S CURDAT=$$DATE2^PSJUTL2(%)
"RTN","PSGOER",126,0)
 S PSJEXPOE=$S($G(EXPDT):EXPDT,1:CURDAT) D EN1^PSJHL2(DFN,"SC",PSJORDER) K PSJEXPOE
"RTN","PSGOER",127,0)
 Q
"RTN","PSGOER",128,0)
EXPIRED(PSJX,PSJY) ;
"RTN","PSGOER",129,0)
 ; INPUT 
"RTN","PSGOER",130,0)
 ;       PSJX - Pharmacy Patient, pointer to ^PS(55
"RTN","PSGOER",131,0)
 ;       PSJY - Inpatient Order Number(appended with "V" or "U")
"RTN","PSGOER",132,0)
 ; OUTPUT
"RTN","PSGOER",133,0)
 ;   0  -  Order has not exceeded the Expired Time Limit 
"RTN","PSGOER",134,0)
 ;   1  -  Order has exceeded the Expired Time Limit
"RTN","PSGOER",135,0)
 N STOP,STATUS,NOW,CUTOFF,FREQ,LAST,ST,X,DFN,U,PSGDT,SD,WD,PSJPSTO,PSGDW,PSGOC,ZZND,LASTAT,LSTSTR,PSBCNT S DFN=PSJX,U="^",CUTOFF=0
"RTN","PSGOER",136,0)
 S STATUS=$S(PSJY["U":$P($G(^PS(55,PSJX,5,+PSJY,0)),"^",9),PSJY["V":$P($G(^PS(55,PSJX,"IV",+PSJY,0)),"^",17),1:"")
"RTN","PSGOER",137,0)
 S NOW=$S($G(PSGDT):PSGDT,1:$$DATE^PSJUTL2())
"RTN","PSGOER",138,0)
 S STOP=$S(PSJY["U":$P($G(^PS(55,PSJX,5,+PSJY,2)),U,4),1:$P($G(^PS(55,PSJX,"IV",+PSJY,0)),"^",3))
"RTN","PSGOER",139,0)
 I NOW<STOP Q 0
"RTN","PSGOER",140,0)
 ;*315 ND2P1 ON NEXT LINE
"RTN","PSGOER",141,0)
 I PSJY["U" N ND2,ND0 S ND0=$G(^PS(55,PSJX,5,+PSJY,0)),ND2=$G(^PS(55,PSJX,5,+PSJY,2)),ND2P1=$G(^PS(55,PSJX,5,+PSJY,2.1)),FREQ=$P(ND2,"^",6) D
"RTN","PSGOER",142,0)
 .N SCHED S SCHED=$P($G(^PS(55,PSJX,5,+PSJY,2)),"^") I SCHED["PRN" S FREQ=$$PRNFREQ(SCHED)
"RTN","PSGOER",143,0)
 .S LSTSTR=$P(ND2,"^",2)_"^"_$P(ND2,"^",4)_"^"_SCHED_"^"_$P(ND0,"^",7)_"^^"_$P(ND2,"^",5)
"RTN","PSGOER",144,0)
 .S LAST=$$EN^PSBAPIPM(PSJX,PSJY) I LAST,($P(ND0,"^",7)="O"),($P(LAST,"^",3)="G") I LAST>$P(ND2,"^",2) S CUTOFF=$$FMADD^XLFDT(NOW,,-1) Q
"RTN","PSGOER",145,0)
 .I 'LAST!(LAST>$P(ND2,"^",4)) S LAST=$$LASTAT^PSJORP2(DFN,LSTSTR) S:LAST CUTOFF=$$FMADD^XLFDT(LAST,,,FREQ) Q
"RTN","PSGOER",146,0)
 .I SCHED["PRN",($P(LSTSTR,"^",6)="") S CUTOFF=$$FMADD^XLFDT(LAST,,,FREQ) Q
"RTN","PSGOER",147,0)
 .I $$DOW^PSIVUTL(SCHED) S CUTOFF=$$NXTDOW(DFN,$P(LSTSTR,"^"),$P(LSTSTR,"^",2),$P(LSTSTR,"^",3),$P(LSTSTR,"^",6)) Q
"RTN","PSGOER",148,0)
 .S LAST=$$EN^PSBAPIPM(PSJX,PSJY) I 'LAST!(LAST>$P(ND2,"^",4)) S CUTOFF=$$FMADD^XLFDT(NOW,,-1) Q
"RTN","PSGOER",149,0)
 .S $P(LSTSTR,"^")=$$FMADD^XLFDT(LAST,,,,1),$P(LSTSTR,"^",2)=$$FMADD^XLFDT(PSGDT,,,FREQ) S CUTOFF=$$ENQ^PSJORP2(PSJX,LSTSTR)
"RTN","PSGOER",150,0)
 I PSJY["V" N LIMIT S LIMIT=$P($G(^PS(59.7,1,31)),"^",4) S LIMIT=$S((LIMIT]""):+LIMIT,1:24) S CUTOFF=$$FMADD^XLFDT(STOP,,LIMIT) D
"RTN","PSGOER",151,0)
 .I '($G(P(4))]"") N P,YP,XP S YP=$G(^PS(55,DFN,"IV",+PSJY,0)) F XP=1:1:23 S P(XP)=$P(YP,U,XP)
"RTN","PSGOER",152,0)
 .Q:'($G(P(4))]"")
"RTN","PSGOER",153,0)
 .Q:'$$SCHREQ^PSJLIVFD(.P)
"RTN","PSGOER",154,0)
 .N INTERVAL,LSTSTR,ND0,SCHED,IVSTYP S ND0=$G(^PS(55,PSJX,"IV",+PSJY,0)),INTERVAL=$P(ND0,"^",15),SCHED=$P(ND0,"^",9) Q:SCHED=""
"RTN","PSGOER",155,0)
 .S IVSTYP=$S($$DOW^PSIVUTL(SCHED):"D",INTERVAL="O":"O",1:"C"),LSTSTR=$P(ND0,"^",2)_"^"_$P(ND0,"^",3)_"^"_SCHED_"^"_IVSTYP_"^^"_$P(ND0,"^",11)
"RTN","PSGOER",156,0)
 .S LAST=$$EN^PSBAPIPM(PSJX,PSJY) I LAST,IVSTYP="O",LAST>$P(ND0,"^",2),($P(LAST,"^",3)="G") S CUTOFF=$$FMADD^XLFDT(NOW,,-1) Q
"RTN","PSGOER",157,0)
 .I 'LAST!(LAST>$P(ND0,"^",3))!(LAST&(IVSTYP="O")) S CUTOFF=$$FMADD^XLFDT(NOW,,-1) Q
"RTN","PSGOER",158,0)
 .I IVSTYP="D" S CUTOFF=$$NXTDOW(LAST,SCHED,$G(P(2)),$P($G(P(9)),"@"),$G(P(11))) Q
"RTN","PSGOER",159,0)
 .I SCHED["PRN" S FREQ=$$PRNFREQ(SCHED) S CUTOFF=$$FMADD^XLFDT(LAST,,,FREQ) Q
"RTN","PSGOER",160,0)
 .S LAST=$$EN^PSBAPIPM(PSJX,PSJY) I 'LAST!(LAST>$P(ND0,"^",3)) S CUTOFF=$$FMADD^XLFDT(NOW,,-1) Q
"RTN","PSGOER",161,0)
 .S $P(LSTSTR,"^")=$$FMADD^XLFDT(LAST,,,,1),$P(LSTSTR,"^",2)=$$FMADD^XLFDT(PSGDT,31) S CUTOFF=$$ENQ^PSJORP2(PSJX,LSTSTR)
"RTN","PSGOER",162,0)
 K LYN,PSBDT,PSBFLAG,PSBSTR
"RTN","PSGOER",163,0)
 Q $S(CUTOFF<NOW:1,1:0)
"RTN","PSGOER",164,0)
 ;
"RTN","PSGOER",165,0)
NXTDOW(DOWDFN,DOWSD,DOWFD,DOWSCH,DOWAT) ;
"RTN","PSGOER",166,0)
 N NXTADM,DOWSTR S DOWSTR=$$FMADD^XLFDT(DOWFD,,,,1)_"^"_$$FMADD^XLFDT(DOWFD,7)_"^"_DOWSCH_"^D^^"_DOWAT S NXTADM=$$ENQ^PSJORP2(DOWDFN,DOWSTR)
"RTN","PSGOER",167,0)
 Q $S(NXTADM:NXTADM,1:DOWSD)
"RTN","PSGOER",168,0)
 ;
"RTN","PSGOER",169,0)
PRNFREQ(SCHED) ;
"RTN","PSGOER",170,0)
 N ZZND,D,DA,X,PSGAT,PSGOES,PSGST,PSJNSS,PSJPWD,TEST,VALMBCK,PSGS0XT,PSGS0Y,PSGDT
"RTN","PSGOER",171,0)
 F X=$P(SCHED,"PRN"),$P(SCHED,"PRN",2),$P(SCHED," PRN"),$P(SCHED,"PRN ",2) Q:$P($G(ZZND),"^",4)  D ADMIN^PSJORPOE
"RTN","PSGOER",172,0)
 Q $S($G(PSGS0XT):PSGS0XT,1:1440)
"RTN","PSJCOM")
0^7^B43877303^B42503350
"RTN","PSJCOM",1,0)
PSJCOM ;BIR/CML3-FINISH COMPLEX UNIT DOSE ORDERS ENTERED THROUGH OE/RR ;02 Feb 2001  12:20 PM
"RTN","PSJCOM",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**110,186,267,281,315,338**;16 DEC 97;Build 8
"RTN","PSJCOM",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PSJCOM",4,0)
 ; Reference to ^VALM1 is supported by DBIA 10116.
"RTN","PSJCOM",5,0)
 ; Reference to ^PS(55 is supported by DBIA 2191.
"RTN","PSJCOM",6,0)
 ; Reference to ^%DTC is supported by DBIA 10000.
"RTN","PSJCOM",7,0)
 ; Reference to ^%RCR is supported by DBIA 10022.
"RTN","PSJCOM",8,0)
 ; Reference to ^DIR is supported by DBIA 10026.
"RTN","PSJCOM",9,0)
 ; Reference to ^TIUEDIT is supported by DBIA 2410.
"RTN","PSJCOM",10,0)
 ; Reference to ^TMP("PSODAOC",$J supported by DBIA 6071.
"RTN","PSJCOM",11,0)
 ;
"RTN","PSJCOM",12,0)
UPD ;
"RTN","PSJCOM",13,0)
 Q:'PSJCOM
"RTN","PSJCOM",14,0)
 M ^TMP("PSJCOM",$J,+PSGORD)=^PS(53.1,+PSGORD)
"RTN","PSJCOM",15,0)
 I PSGST="",(PSGSCH="NOW"!(PSGSCH="ONCE")) S PSGST="O"
"RTN","PSJCOM",16,0)
 S $P(^TMP("PSJCOM",$J,+PSGORD,0),"^",9)="N",$P(^(0),"^",4)="U",$P(^(0),"^",7)=PSGST,$P(^TMP("PSJCOM",$J,+PSGORD,2),"^",2)=PSGSD,$P(^(2),"^",4)=PSGFD
"RTN","PSJCOM",17,0)
 I $D(PSGSI),$P($G(^PS(53.1,+PSGORD,0)),U,24)'="R" S ^TMP("PSJCOM",$J,+PSGORD,6)=PSGSI
"RTN","PSJCOM",18,0)
 I $D(PSGSI),$P($G(^PS(53.1,+PSGORD,0)),U,24)="R" S $P(^TMP("PSJCOM",$J,+PSGORD,6),U)=$P(PSGSI,U) I $P(PSGSI,U)="" S $P(^TMP("PSJCOM",$J,+PSGORD,6),U,2)=""
"RTN","PSJCOM",19,0)
 S:$D(PSGSCH) $P(^TMP("PSJCOM",$J,+PSGORD,2),"^")=PSGSCH
"RTN","PSJCOM",20,0)
 I PSGSM,PSGOHSM'=PSGHSM S $P(^TMP("PSJCOM",$J,+PSGORD,0),"^",5)=PSGSM,$P(^TMP("PSJCOM",$J,+PSGORD,0),"^",6)=PSGHSM
"RTN","PSJCOM",21,0)
 W "."
"RTN","PSJCOM",22,0)
 F Q=1,3 K @(PSGOEEWF_Q_")") S %X="^PS(53.45,"_PSJSYSP_","_$S(Q=1:2,1:1)_",",%Y=PSGOEEWF_Q_"," K @(PSGOEEWF_Q_")") D %XY^%RCR W "."
"RTN","PSJCOM",23,0)
 ; Above code added to update file 53.1.
"RTN","PSJCOM",24,0)
 S PSGOEEWF="^TMP(""PSJCOM"",$J,+PSGORD,"
"RTN","PSJCOM",25,0)
 F Q=1,3 K @(PSGOEEWF_Q_")") S %X="^PS(53.45,"_PSJSYSP_","_$S(Q=1:2,1:1)_",",%Y=PSGOEEWF_Q_"," K @(PSGOEEWF_Q_")") D %XY^%RCR W "."  ;MOU-0100-30945
"RTN","PSJCOM",26,0)
 S PSGND=$G(^TMP("PSJCOM",$J,+PSGORD,0)),X=$P(PSGND,U,24)
"RTN","PSJCOM",27,0)
 S PSJOWALL=+$G(^PS(55,PSGP,5.1))
"RTN","PSJCOM",28,0)
 I $S(X="R":1,+$G(^PS(55,PSGP,5.1))>PSGDT:0,1:X'="E") S X=$G(^TMP("PSJCOM",$J,+PSGORD,2)) D ENWALL^PSGNE3(+$P(X,U,2),+$P(X,U,4),PSGP)
"RTN","PSJCOM",29,0)
 S $P(^TMP("PSJCOM",$J,+PSGORD,.2),U,2)=PSGDO,$P(^TMP("PSJCOM",$J,+PSGORD,2),U,5)=PSGAT S:$G(PSGS0XT) $P(^(2),U,6)=PSGS0XT
"RTN","PSJCOM",30,0)
 S:PSGRF]"" ^TMP("PSJCOM",$J,+PSGORD,2.1)=$G(PSGDUR)_U_$G(PSGRMVT)_U_$G(PSGRMV)_U_$G(PSGRF) K PSGDUR,PSGRMVT,PSGRMV,PSGRF ;315
"RTN","PSJCOM",31,0)
 I 'PSGOEAV D NEWNVAL(PSGORD,$S(+PSJSYSU=3:22005,1:22000))
"RTN","PSJCOM",32,0)
 I $D(^PS(53.45,DUZ,5,1,0)) D FILESI^PSJBCMA5(PSGP,PSGORD) N SIARRAY S SIARRAY="" D NEWNVAL^PSGAL5(PSGORD,6000,"SPECIAL INSTRUCTIONS",,.SIARRAY)
"RTN","PSJCOM",33,0)
 I PSGOEAV,+PSJSYSU=3 D VFY Q
"RTN","PSJCOM",34,0)
 I PSGOEAV,$G(PSJRNF) D VFY
"RTN","PSJCOM",35,0)
 Q
"RTN","PSJCOM",36,0)
VFY ; change status, move to 55, and change label record
"RTN","PSJCOM",37,0)
 Q:'PSJCOM
"RTN","PSJCOM",38,0)
 S ^TMP("PSODAOC",$J,"IP IEN")=PSGORD
"RTN","PSJCOM",39,0)
 D SETOC^PSJNEWOC(PSGORD)
"RTN","PSJCOM",40,0)
 I '$D(^TMP("PSJCOM",$J,+PSGORD)) M ^TMP("PSJCOM",$J,+PSGORD)=^PS(53.1,+PSGORD)
"RTN","PSJCOM",41,0)
 NEW PSJDOSE,PSJDSFLG
"RTN","PSJCOM",42,0)
 D DOSECHK^PSJDOSE
"RTN","PSJCOM",43,0)
 I +$G(PSJDSFLG) D SETVAR^PSJDOSE W !!,PSJDOSE("WARN"),!,PSJDOSE("WARN1") I '$$CONT() W !,"...order was not verified..." D PAUSE^VALM1 D  Q:'$G(PSJACEPT)
"RTN","PSJCOM",44,0)
 . S PSGOEEF(109)=1
"RTN","PSJCOM",45,0)
 . S PSJACEPT=0
"RTN","PSJCOM",46,0)
 D DDCHK G:CHK DONE
"RTN","PSJCOM",47,0)
 W !,"...a few moments, please..."
"RTN","PSJCOM",48,0)
 I PSGORD["P" D
"RTN","PSJCOM",49,0)
 . S PSGORDP=PSGORD ;Used in ACTLOG to update activity log in ^TMP
"RTN","PSJCOM",50,0)
 . I '$D(^TMP("PSJCOM2",$J,+PSGORD)) D  Q
"RTN","PSJCOM",51,0)
 .. NEW PSGX S PSGX=$G(^TMP("PSJCOM",$J,+PSGORD,2.5)),PSGRSD=$P(PSGX,U),PSGRFD=$P(PSGX,U,3)
"RTN","PSJCOM",52,0)
 .. S $P(^TMP("PSJCOM",$J,+PSGORD,0),"^",9)="A" W "." ;D ^PSGOT
"RTN","PSJCOM",53,0)
 .  NEW PSGX S PSGX=$G(^TMP("PSJCOM2",$J,+PSGORD,2.5)),PSGRSD=$P(PSGX,U),PSGRFD=$P(PSGX,U,3)
"RTN","PSJCOM",54,0)
 .  S $P(^TMP("PSJCOM2",$J,+PSGORD,0),"^",9)="A" W "." ;D ^PSGOT
"RTN","PSJCOM",55,0)
 D NEWNVAL(+PSGORD,(PSJSYSU*10+22000)) W "."
"RTN","PSJCOM",56,0)
 S VND4=$S('$D(^TMP("PSJCOM2",$J,+PSGORD)):$G(^TMP("PSJCOM",$J,+PSGORD,4)),1:$G(^TMP("PSJCOM2",$J,+PSGORD,4)))
"RTN","PSJCOM",57,0)
 I $G(PSGRSD) D
"RTN","PSJCOM",58,0)
 . S PSGRSD=$$ENDTC^PSGMI(PSGRSD) D NEWNVAL(PSGORD,6090,"Requested Start Date",PSGRSD)
"RTN","PSJCOM",59,0)
 . S PSGRFD=$$ENDTC^PSGMI(PSGRFD) D NEWNVAL(PSGORD,6090,"Requested Stop Date",PSGRFD)
"RTN","PSJCOM",60,0)
 N DUR,DURORD S DURON=$S($G(ON)&($G(PSGORD)["U"):ON,$G(PSGORD):PSGORD,1:"") Q:'DURON  D
"RTN","PSJCOM",61,0)
 . S DUR=$S($P($G(PSGRDTX),U,2)]"":$P($G(PSGRDTX),U,2),1:$$GETDUR^PSJLIVMD(PSGP,+DURON,$S($G(DURON)["P":"P",$G(DURON)["V":"IV",1:5),1),1:"")
"RTN","PSJCOM",62,0)
 I DUR]"" S $P(^TMP("PSJCOM2",$J,+PSGORD,2.5),"^",2)=DUR
"RTN","PSJCOM",63,0)
 ;D:$D(PSGORDP) ACTLOG(PSGORDP,PSGP,PSGORD)
"RTN","PSJCOM",64,0)
 K PSGRSD,PSGRFD,PSGALFN
"RTN","PSJCOM",65,0)
 NEW X S X=0 I $G(PSGONF),(+$G(PSGODDD(1))'<+$G(PSGONF)) S X=1
"RTN","PSJCOM",66,0)
 I +PSJSYSU=3,PSGORD'["O",$S(X:0,'$P(VND4,"^",16):1,1:$P(VND4,"^",15)) ;D EN^PSGPEN(+PSGORD)
"RTN","PSJCOM",67,0)
 S:'$P(VND4,U,+PSJSYSU=3+9) $P(VND4,U,+PSJSYSU=3+9)=+$P(VND4,U,+PSJSYSU=3+9)
"RTN","PSJCOM",68,0)
 S:$P(VND4,"^",15)&'$P(VND4,"^",16) $P(VND4,"^",15)="" S:$P(VND4,"^",18)&'$P(VND4,"^",19) $P(VND4,"^",18)="" S:$P(VND4,"^",22)&'$P(VND4,"^",23) $P(VND4,"^",22)=""
"RTN","PSJCOM",69,0)
 S $P(VND4,"^",PSJSYSU,PSJSYSU+1)=DUZ_"^"_PSGDT
"RTN","PSJCOM",70,0)
 S:'$D(^TMP("PSJCOM2",$J,+PSGORD)) ^TMP("PSJCOM",$J,+PSGORD,4)=VND4 S:$D(^TMP("PSJCOM2",$J,+PSGORD)) ^TMP("PSJCOM2",$J,+PSGORD,4)=VND4
"RTN","PSJCOM",71,0)
 W:'$D(PSJSPEED) ! W !,"ORDER VERIFIED.",!
"RTN","PSJCOM",72,0)
 I '$D(PSJSPEED) K DIR S DIR(0)="E" D ^DIR K DIR
"RTN","PSJCOM",73,0)
 S VALMBCK="Q"
"RTN","PSJCOM",74,0)
 S ^TMP("PSJCOM",$J)="A" S:$D(^TMP("PSJCOM2",$J,+PSGORD)) ^TMP("PSJCOM2",$J)="A"
"RTN","PSJCOM",75,0)
 ;
"RTN","PSJCOM",76,0)
DONE ;
"RTN","PSJCOM",77,0)
 W:CHK !!,"...order NOT verified..."
"RTN","PSJCOM",78,0)
 I '$D(PSJSPEED),'CHK,+PSJSYSU=3,$G(PSJPRI)="D" D
"RTN","PSJCOM",79,0)
 .N DIR W ! S DIR(0)="S^Y:Yes;N:No",DIR("A")="Do you want to enter a Progress Note",DIR("B")="No" D ^DIR
"RTN","PSJCOM",80,0)
 .Q:Y="N"
"RTN","PSJCOM",81,0)
 .D MAIN^TIUEDIT(3,.TIUDA,PSGP,"","","","",1)
"RTN","PSJCOM",82,0)
 S VALMBCK="Q" K CHK,DA,DIE,F,DP,DR,ND,PSGAL,PSGODA,PSJDOSE,PSJVAR,VND4,X,%X,%Y,Q,QQ Q
"RTN","PSJCOM",83,0)
 ;
"RTN","PSJCOM",84,0)
DDCHK ; dispense drug check
"RTN","PSJCOM",85,0)
 S DRGF=$S('$D(^TMP("PSJCOM2",$J,+PSGORD)):"^TMP(""PSJCOM"","_$J_","_+PSGORD_",",1:"^TMP(""PSJCOM2"","_$J_","_+PSGORD_","),CHK=$S('$O(@(DRGF_"1,0)")):7,1:0)
"RTN","PSJCOM",86,0)
 S PSGPD=$G(@(DRGF_".2)"))
"RTN","PSJCOM",87,0)
 S CHK=$S('$$DDOK^PSGOE2(DRGF_"1,",PSGPD):7,1:0)
"RTN","PSJCOM",88,0)
 Q:CHK=0
"RTN","PSJCOM",89,0)
 W $C(7),!!,"This order must have at least one valid, active dispense drug to be verified."
"RTN","PSJCOM",90,0)
 ;
"RTN","PSJCOM",91,0)
CONT() ;
"RTN","PSJCOM",92,0)
 NEW DIR,DIRUT,Y
"RTN","PSJCOM",93,0)
 W ! K DIR,DIRUT
"RTN","PSJCOM",94,0)
 S DIR(0)="Y",DIR("A")="Would you like to continue verifying the order",DIR("B")="No"
"RTN","PSJCOM",95,0)
 D ^DIR
"RTN","PSJCOM",96,0)
 Q Y
"RTN","PSJCOM",97,0)
 ;
"RTN","PSJCOM",98,0)
NEWNVAL(PSGALORD,PSGALC,PSGFLD,PSGOLD)  ;
"RTN","PSJCOM",99,0)
 ;
"RTN","PSJCOM",100,0)
 ;Where  PSGALORD = PSGORD (Required)
"RTN","PSJCOM",101,0)
 ;       PSGALC   = ACTIVITY CODE FROM #53.3 (Required)
"RTN","PSJCOM",102,0)
 ;       PSGFLD   = FIELD THAT CHANGED (Free text, optional)
"RTN","PSJCOM",103,0)
 ;       PSGOLD   = THE FIELDS OLD DATA VALUE (Free text, optional)
"RTN","PSJCOM",104,0)
 ;
"RTN","PSJCOM",105,0)
 ;N PSGALORD,PSGALC,PSGFLD,PSGOLD
"RTN","PSJCOM",106,0)
 ;
"RTN","PSJCOM",107,0)
 ; Create 0 node activity log for order if none exists, and get next entry number
"RTN","PSJCOM",108,0)
 I '$D(^TMP("PSJCOM2",$J,+PSGALORD)) D  Q
"RTN","PSJCOM",109,0)
 . S QQ=$G(^TMP("PSJCOM",$J,+PSGALORD,"A",0)) S:QQ="" QQ="^53.1119D" F Q=$P(QQ,"^",3)+1:1 I '$D(^(Q)) S $P(QQ,"^",3,4)=Q_"^"_Q,^(0)=QQ,PSGAL("N")=Q Q
"RTN","PSJCOM",110,0)
 . ;Set up data to be held in activity log record
"RTN","PSJCOM",111,0)
 . D NOW^%DTC S PSGDT=+$E(%,1,12)
"RTN","PSJCOM",112,0)
 . I $L($G(PSGOLD))>170 S PSGOLD=$E(PSGOLD,1,167)_"..." ; Use of ... indicates old data field was greater than 170 characters
"RTN","PSJCOM",113,0)
 . S Q=%_"^"_$S(PSGALC=6010:"AUTO CANCEL",$D(DUZ)[0:"UNKNOWN",DUZ]"":DUZ,1:"UNKNOWN")_"^"_PSGALC_"^"_$S($D(PSGFLD):PSGFLD,1:"")_"^"_$S($D(PSGOLD):PSGOLD,1:"")
"RTN","PSJCOM",114,0)
 . ; Create activity log entry
"RTN","PSJCOM",115,0)
 . S ^TMP("PSJCOM",$J,+PSGALORD,"A",PSGAL("N"),0)=Q
"RTN","PSJCOM",116,0)
 S QQ=$G(^TMP("PSJCOM2",$J,+PSGALORD,"A",0)) S:QQ="" QQ="^53.1119D" F Q=$P(QQ,"^",3)+1:1 I '$D(^(Q)) S $P(QQ,"^",3,4)=Q_"^"_Q,^(0)=QQ,PSGAL("N")=Q Q
"RTN","PSJCOM",117,0)
 ;Set up data to be held in activity log record
"RTN","PSJCOM",118,0)
 D NOW^%DTC S PSGDT=+$E(%,1,12)
"RTN","PSJCOM",119,0)
 I $L($G(PSGOLD))>170 S PSGOLD=$E(PSGOLD,1,167)_"..." ; Use of ... indicates old data field was greater than 170 characters
"RTN","PSJCOM",120,0)
 S Q=%_"^"_$S(PSGALC=6010:"AUTO CANCEL",$D(DUZ)[0:"UNKNOWN",DUZ]"":DUZ,1:"UNKNOWN")_"^"_PSGALC_"^"_$S($D(PSGFLD):PSGFLD,1:"")_"^"_$S($D(PSGOLD):PSGOLD,1:"")
"RTN","PSJCOM",121,0)
 ; Create activity log entry
"RTN","PSJCOM",122,0)
 S ^TMP("PSJCOM2",$J,+PSGALORD,"A",PSGAL("N"),0)=Q
"RTN","PSJCOM",123,0)
 Q
"RTN","PSJDOSE")
0^3^B64879386^B62450032
"RTN","PSJDOSE",1,0)
PSJDOSE ;BIR/MV - POSSIBLE DOSES UTILITY ; 1/28/10 8:21am
"RTN","PSJDOSE",2,0)
 ;;5.0;INPATIENT MEDICATIONS ;**50,65,106,111,216,264,328,338**;16 DEC 97;Build 8
"RTN","PSJDOSE",3,0)
 ;
"RTN","PSJDOSE",4,0)
 ; Reference to ^PSSORPH is supported by DBIA #3234.
"RTN","PSJDOSE",5,0)
 ;
"RTN","PSJDOSE",6,0)
 ;PSJDSFLG: Set to 1 if Dose and DD are not compatible
"RTN","PSJDOSE",7,0)
 ;PSJDSSEL: The selected dose in format:
"RTN","PSJDOSE",8,0)
 ;          Dosage Order^DD IEN^DUPD/BCMA DUPD^1(if BCMA DUPD exist
"RTN","PSJDOSE",9,0)
 ;PSJDSUPD: Set to 1 if need to prompt for the Units Per Dose
"RTN","PSJDOSE",10,0)
 ;
"RTN","PSJDOSE",11,0)
EDITDOSE ;Editing Dosage Ordered for active order
"RTN","PSJDOSE",12,0)
 ;*Need to set PSJDSFLG to null when call EDITDOSE.
"RTN","PSJDOSE",13,0)
 NEW PSGOER1,PSJDD,PSJDSUPD,PSJDSSEL,PSJX,Y
"RTN","PSJDOSE",14,0)
 ;Offer the possible doses from the only one or 1st DD
"RTN","PSJDOSE",15,0)
 S PSJX=$O(^PS(53.45,PSJSYSP,2,0)) S PSJDD=+$G(^(+PSJX,0))
"RTN","PSJDOSE",16,0)
 D DOSE(PSJDD)
"RTN","PSJDOSE",17,0)
 D DOSECHK
"RTN","PSJDOSE",18,0)
 I +PSJDSFLG D
"RTN","PSJDOSE",19,0)
 . W !!,PSJDOSE("WARN"),!,PSJDOSE("WARN1"),!
"RTN","PSJDOSE",20,0)
 . D PAUSE^VALM1
"RTN","PSJDOSE",21,0)
 S PSGOEE=2
"RTN","PSJDOSE",22,0)
 Q
"RTN","PSJDOSE",23,0)
GETDOSE(PSJDD) ;Dosage Order
"RTN","PSJDOSE",24,0)
 NEW PSJDSSEL,PSJDSUPD
"RTN","PSJDOSE",25,0)
 D DOSE(PSJDD)
"RTN","PSJDOSE",26,0)
 Q:'$D(PSJDSSEL)
"RTN","PSJDOSE",27,0)
 D:+$G(PSJDSUPD) DUPD
"RTN","PSJDOSE",28,0)
 D:'+$G(PSJDSUPD) SETDUPD($P(PSJDSSEL,U,3))
"RTN","PSJDOSE",29,0)
 D DOSECHK
"RTN","PSJDOSE",30,0)
 I +$G(PSJDSFLG) D
"RTN","PSJDOSE",31,0)
 . W !!,PSJDOSE("WARN"),!,PSJDOSE("WARN1"),!
"RTN","PSJDOSE",32,0)
 Q
"RTN","PSJDOSE",33,0)
 ;
"RTN","PSJDOSE",34,0)
SETVAR ;
"RTN","PSJDOSE",35,0)
 S PSJDOSE("WARN")="WARNING: Dosage Ordered and Dispense Units do not match."
"RTN","PSJDOSE",36,0)
 S PSJDOSE("WARN1")="         Please verify Dosage."
"RTN","PSJDOSE",37,0)
 Q
"RTN","PSJDOSE",38,0)
 ;
"RTN","PSJDOSE",39,0)
DOSE(PSJDD) ;Prompt for Dosage Ordered
"RTN","PSJDOSE",40,0)
 ;PSJDD: Dispense drug IEN
"RTN","PSJDOSE",41,0)
 ;
"RTN","PSJDOSE",42,0)
 NEW DA,DR,DIR,DTOUT,DUOUT,DIRUT,PSJDL,PSJX,PSJPIECE,PSJCONT
"RTN","PSJDOSE",43,0)
 D SETVAR
"RTN","PSJDOSE",44,0)
 D DOSE^PSSORPH(.PSJDOX,+PSJDD,"U")
"RTN","PSJDOSE",45,0)
 I '$D(PSJDOX) S PSJDOX(1)=-1
"RTN","PSJDOSE",46,0)
 S PSJPIECE=$S($P(PSJDOX(1),U,11)]"":11,1:3)
"RTN","PSJDOSE",47,0)
 I PSJPIECE=3 S:$S($P(PSJDOX(1),U,3)="":1,1:$P(PSJDOX(1),U)=-1) $P(PSJDOX(1),U)=-1
"RTN","PSJDOSE",48,0)
AGAIN ;Prompt for dosage order again
"RTN","PSJDOSE",49,0)
 S PSJX=0
"RTN","PSJDOSE",50,0)
 NEW DIR
"RTN","PSJDOSE",51,0)
 W:($P(PSJDOX(1),U)'=-1) !!,"Available Dosage(s)"
"RTN","PSJDOSE",52,0)
 F PSJDL=0:0 S PSJDL=$O(PSJDOX(PSJDL)) Q:$S('PSJDL:1,$G(DUOUT):1,1:+PSJDOX(PSJDL)=-1)  D
"RTN","PSJDOSE",53,0)
 . S PSJX=PSJX+1
"RTN","PSJDOSE",54,0)
 . W !?4,$J(PSJX,3),".    ",$P(PSJDOX(PSJDL),U,PSJPIECE)
"RTN","PSJDOSE",55,0)
 . I '(PSJX#16) S DIR(0)="E" D ^DIR
"RTN","PSJDOSE",56,0)
 W !
"RTN","PSJDOSE",57,0)
 K DIR S DIR(0)="F^1:60"  ;*216 - No null dosage
"RTN","PSJDOSE",58,0)
 S DIR("A")=$S(+PSJX:"Select from list of Available Dosages or Enter Free Text Dose",1:"DOSAGE ORDERED")
"RTN","PSJDOSE",59,0)
 S:$G(PSGDO)]"" DIR("B")=PSGDO
"RTN","PSJDOSE",60,0)
 S DIR("?")="^D ENHLP^PSGOEM(53.1,109)" D ^DIR
"RTN","PSJDOSE",61,0)
 S PSJY=$$UP^XLFSTR(Y)
"RTN","PSJDOSE",62,0)
 ;
"RTN","PSJDOSE",63,0)
 I $S($D(DTOUT):1,$D(DUOUT):1,$D(DIRUT):1,1:0) S PSGOROE1=1 Q
"RTN","PSJDOSE",64,0)
 ;
"RTN","PSJDOSE",65,0)
 ;* If select for the presented list (possible and local doses)
"RTN","PSJDOSE",66,0)
 I $D(PSJDOX(PSJY)) D  G:PSJCONT=0 AGAIN S:PSJCONT="^" PSGOROE1=1 Q
"RTN","PSJDOSE",67,0)
 . NEW X S X=$P(PSJDOX(PSJY),U,PSJPIECE)
"RTN","PSJDOSE",68,0)
 . W "  ",X
"RTN","PSJDOSE",69,0)
 . S PSJCONT=$$CONT(X)
"RTN","PSJDOSE",70,0)
 . I PSJCONT=0!(PSJCONT="^") Q
"RTN","PSJDOSE",71,0)
 . D SELDOSE(PSJY,PSJDD)
"RTN","PSJDOSE",72,0)
 ;
"RTN","PSJDOSE",73,0)
 ;* Entered a numeric and choices are not local pos dose
"RTN","PSJDOSE",74,0)
 I PSJY?.N!(PSJY?.N1".".N),(PSJPIECE'=3) D  G:PSJCONT=0 AGAIN S:PSJCONT="^" PSGOROE1=1 Q
"RTN","PSJDOSE",75,0)
 . S PSJCONT=0
"RTN","PSJDOSE",76,0)
 . Q:$L(PSJY)>15
"RTN","PSJDOSE",77,0)
 . D DOSE^PSSORPH(.PSJDOX,+PSJDD,"U",,PSJY/+$P(PSJDOX(1),U,5))
"RTN","PSJDOSE",78,0)
 . S PSJCONT=$$CONT($P(PSJDOX(1),U,11)) I PSJCONT="^" Q
"RTN","PSJDOSE",79,0)
 . I 'PSJCONT D DOSE^PSSORPH(.PSJDOX,+PSJDD,"U") Q
"RTN","PSJDOSE",80,0)
 . D SELDOSE(1,PSJDD)
"RTN","PSJDOSE",81,0)
 ;
"RTN","PSJDOSE",82,0)
 ;* Can't accept just a numeric value
"RTN","PSJDOSE",83,0)
 I PSJY?.N!(PSJY?.N1".".N) D ENHLP^PSGOEM(53.1,109) G AGAIN
"RTN","PSJDOSE",84,0)
 ;
"RTN","PSJDOSE",85,0)
 ;* Free text
"RTN","PSJDOSE",86,0)
 I $E(PSJY)=" " G AGAIN
"RTN","PSJDOSE",87,0)
 S PSJCONT=$$CONT(PSJY) I PSJCONT="^" S PSGOROE1=1 Q
"RTN","PSJDOSE",88,0)
 I PSJCONT=0 G AGAIN
"RTN","PSJDOSE",89,0)
 K PSJDSSEL
"RTN","PSJDOSE",90,0)
 F X=0:0 S X=$O(PSJDOX(X)) Q:'X  S PSJXDOSE=$P(PSJDOX(X),U,PSJPIECE) I PSJY=PSJXDOSE D SELDOSE(X,PSJDD) Q
"RTN","PSJDOSE",91,0)
 I '$D(PSJDSSEL),($G(PSJY)]"") S PSJDSSEL=PSJY_U_+PSJDD_U_1,PSGDO=PSJY,PSJDSUPD=1
"RTN","PSJDOSE",92,0)
 Q
"RTN","PSJDOSE",93,0)
 ;
"RTN","PSJDOSE",94,0)
SELDOSE(X,PSJDD) ;
"RTN","PSJDOSE",95,0)
 S X=PSJDOX(X)
"RTN","PSJDOSE",96,0)
 S PSGDO=$P(X,U,PSJPIECE)
"RTN","PSJDOSE",97,0)
 S:$P(X,U)'=-1 PSJDOSE("DO")=$P(X,U,1,2)
"RTN","PSJDOSE",98,0)
 S PSJDSSEL=$P(X,U,PSJPIECE)_U_PSJDD
"RTN","PSJDOSE",99,0)
 I +$P(X,U,12) S $P(PSJDSSEL,U,3)=$P(X,U,12)_U_1 Q
"RTN","PSJDOSE",100,0)
 S $P(PSJDSSEL,U,3)=$S(PSJPIECE=11:$P(X,U,3),1:1)
"RTN","PSJDOSE",101,0)
 Q
"RTN","PSJDOSE",102,0)
CONT(X) ;Ask if user accepting the dose
"RTN","PSJDOSE",103,0)
 NEW DIR,DIRUT,DIROUT,Y
"RTN","PSJDOSE",104,0)
 W ! K DIR,DIRUT,DUOUT
"RTN","PSJDOSE",105,0)
 S DIR(0)="Y",DIR("A")="You entered "_X_" is this correct",DIR("B")="Yes"
"RTN","PSJDOSE",106,0)
 D ^DIR I $D(DIRUT)!$D(DIROUT) Q "^"
"RTN","PSJDOSE",107,0)
 K DUOUT
"RTN","PSJDOSE",108,0)
 Q +Y
"RTN","PSJDOSE",109,0)
 ;
"RTN","PSJDOSE",110,0)
DUPD ;
"RTN","PSJDOSE",111,0)
 NEW PSJX,X
"RTN","PSJDOSE",112,0)
 S PSGUD=1
"RTN","PSJDOSE",113,0)
 W !,"UNITS PER DOSE: "_PSGUD_"// " R X:DTIME W "  ",X I X="^"!'$T S PSGOROE1=1 Q
"RTN","PSJDOSE",114,0)
 S:X="" X=1
"RTN","PSJDOSE",115,0)
 I X="@",'PSGUD W $C(7),"  ??" S X="?" D ENHLP^PSGOEM(53.11,.02) G DUPD
"RTN","PSJDOSE",116,0)
 I X?1."?" D ENHLP^PSGOEM(53.11,.02) G DUPD
"RTN","PSJDOSE",117,0)
 I X?1.2N1"/"1.2N S X=+$J(+X/$P(X,"/",2),0,2) W "  ("_$E("0",X<1)_X_")"
"RTN","PSJDOSE",118,0)
 I $S($L(X)>12:1,X'=+X:1,X>50:1,X<0:1,1:X?.N1"."5.N) W $C(7),"  ??" S X="?" D ENHLP^PSGOEM(53.11,.02) G DUPD
"RTN","PSJDOSE",119,0)
 S $P(PSJDSSEL,U,3)=X
"RTN","PSJDOSE",120,0)
 D SETDUPD(X)
"RTN","PSJDOSE",121,0)
 Q
"RTN","PSJDOSE",122,0)
SETDUPD(X) ;
"RTN","PSJDOSE",123,0)
 S PSGUD=X,X=$S(PSJDSSEL]"":$P(PSJDSSEL,U,2),1:0)
"RTN","PSJDOSE",124,0)
 S PSJX=$O(^PS(53.45,PSJSYSP,2,"B",X,0))
"RTN","PSJDOSE",125,0)
 S PSGUD=+$FN(PSGUD,"",4) S:$E(PSGUD)="." PSGUD="0"_PSGUD
"RTN","PSJDOSE",126,0)
 S $P(^PS(53.45,PSJSYSP,2,+PSJX,0),U,2)=PSGUD
"RTN","PSJDOSE",127,0)
 Q
"RTN","PSJDOSE",128,0)
EDITDD ;Editing DDs
"RTN","PSJDOSE",129,0)
 NEW DA,DR,DIE
"RTN","PSJDOSE",130,0)
 S DIE="^PS(53.45,",DA=PSJSYSP,DR=2,DR(2,53.4502)=".02//1" D ^DIE
"RTN","PSJDOSE",131,0)
 I '$O(^PS(53.45,PSJSYSP,2,0)) W $C(7),!!,"WARNING:      This order must have at least one dispense drug before pharmacy can",!?9,"verify it!"
"RTN","PSJDOSE",132,0)
 Q
"RTN","PSJDOSE",133,0)
DOSECHK ;
"RTN","PSJDOSE",134,0)
 K PSJDSFLG S PSJDSFLG=0
"RTN","PSJDOSE",135,0)
 Q:'$P(PSJSYSU,";",4)
"RTN","PSJDOSE",136,0)
 Q:$G(PSGDO)=""
"RTN","PSJDOSE",137,0)
 NEW PSJX,PSJXDD,PSJCNT S PSJCNT=0
"RTN","PSJDOSE",138,0)
 ;*216 Be sure PSJDT is set
"RTN","PSJDOSE",139,0)
 I '$G(PSJDT) N X,% D NOW^%DTC S PSJDT=X
"RTN","PSJDOSE",140,0)
 F PSJX=0:0 S PSJX=$O(^PS(53.45,PSJSYSP,2,PSJX)) Q:'PSJX  D
"RTN","PSJDOSE",141,0)
 . S PSJXDD=$G(^PS(53.45,PSJSYSP,2,PSJX,0)) Q:PSJXDD=""
"RTN","PSJDOSE",142,0)
 . S:$P(PSJXDD,U,2)="" $P(^PS(53.45,PSJSYSP,2,PSJX,0),U,2)=1
"RTN","PSJDOSE",143,0)
 . ;*216 Don't count inactive Disp. Drug
"RTN","PSJDOSE",144,0)
 . I $P(PSJXDD,U,3)'="",$P(PSJXDD,U,3)'>PSJDT Q
"RTN","PSJDOSE",145,0)
 . S PSJCNT=PSJCNT+1
"RTN","PSJDOSE",146,0)
 D DOSECHK1
"RTN","PSJDOSE",147,0)
 Q
"RTN","PSJDOSE",148,0)
DOSECHK1 ;
"RTN","PSJDOSE",149,0)
 NEW PSJX,PSJXDD,PSJXUNIT,PSJUNIT,PSJXFLG,PSJTOT,PSJDRGDOSE,PSJUNITNM,PSJDRGUD,CNT
"RTN","PSJDOSE",150,0)
 S CNT=0
"RTN","PSJDOSE",151,0)
 ;*216 Be sure PSJDT is set
"RTN","PSJDOSE",152,0)
 I '$G(PSJDT) N X,% D NOW^%DTC S PSJDT=X
"RTN","PSJDOSE",153,0)
 S PSJUNIT=$P(PSGDO,+PSGDO,2,$L(PSGDO,+PSGDO))
"RTN","PSJDOSE",154,0)
 S (PSJDSFLG,PSJXFLG,PSJTOT)=0
"RTN","PSJDOSE",155,0)
 S PSJX=0 F  S PSJX=$O(^PS(53.45,PSJSYSP,2,PSJX)) Q:'PSJX!PSJDSFLG!PSJXFLG  D
"RTN","PSJDOSE",156,0)
 . S PSJXDD=$G(^PS(53.45,PSJSYSP,2,PSJX,0))
"RTN","PSJDOSE",157,0)
 . S PSJXDUP=$S(+$P(PSJXDD,U,2):$P(PSJXDD,U,2),1:1)
"RTN","PSJDOSE",158,0)
 . ;*216 Don't count inactive Disp. Drug
"RTN","PSJDOSE",159,0)
 . I $P(PSJXDD,U,3)'="",$P(PSJXDD,U,3)'>PSJDT Q
"RTN","PSJDOSE",160,0)
 . D DOSE^PSSORPH(.PSJXDOX,+PSJXDD,"U")
"RTN","PSJDOSE",161,0)
 . I $S('$D(PSJXDOX):1,$P(PSJXDOX(1),U)="":1,1:+PSJXDOX(1)=-1) S PSJXFLG=1 Q
"RTN","PSJDOSE",162,0)
 . S PSJXUNIT=""
"RTN","PSJDOSE",163,0)
 . S:PSJUNIT["/" PSJXUNIT=PSJUNIT
"RTN","PSJDOSE",164,0)
 . I PSJUNIT'["/" F X=1:1:$L(PSJUNIT)  I $E(PSJUNIT,X)'?.N&($E(PSJUNIT,X)'?1" ") S PSJXUNIT=PSJXUNIT_$E(PSJUNIT,X)
"RTN","PSJDOSE",165,0)
 . I PSJCNT=1 D ONEDD Q:'PSJDSFLG
"RTN","PSJDOSE",166,0)
 . D BCMAUPD(PSJXDD),DOSE^PSSORPH(.PSJXDOX,+PSJXDD,"U",,PSJXDUP)
"RTN","PSJDOSE",167,0)
 . I PSJCNT=1 D ONEDD Q
"RTN","PSJDOSE",168,0)
 . S PSJTOT=+PSJXDOX(1)+$G(PSJTOT)
"RTN","PSJDOSE",169,0)
 . ;*PSJ*5*264 - Data for POINTTOSURFACE calculation
"RTN","PSJDOSE",170,0)
 . S CNT=CNT+1,PSJDRGDOSE(CNT)=+$P(PSJXDOX(1),U,5),PSJUNITNM(CNT)=$P(PSJXDOX(1),U,2),PSJDRGUD(CNT)=+$P(PSJXDOX(1),U,3)
"RTN","PSJDOSE",171,0)
 I PSJCNT>1,(PSJTOT'=+PSGDO) D
"RTN","PSJDOSE",172,0)
 . N UNITCNT,UNITERR
"RTN","PSJDOSE",173,0)
 . S PSJDSFLG=1
"RTN","PSJDOSE",174,0)
 . F UNITCNT=2:1:CNT I PSJUNITNM(UNITCNT)'=PSJUNITNM(1) S UNITERR=1 Q
"RTN","PSJDOSE",175,0)
 . I '$G(UNITERR),$$PTPLANE(.PSJDRGUD,.PSJDRGDOSE,+PSGDO)'=-1,$$PTPLANE(.PSJDRGUD,.PSJDRGDOSE,+PSGDO)<($$SQRT^XLFMTH(CNT)/100) S PSJDSFLG=0
"RTN","PSJDOSE",176,0)
 Q
"RTN","PSJDOSE",177,0)
ONEDD ;
"RTN","PSJDOSE",178,0)
 NEW X S PSJDSFLG=1
"RTN","PSJDOSE",179,0)
 F X=0:0 S X=$O(PSJXDOX(X)) Q:'X!'PSJDSFLG  D
"RTN","PSJDOSE",180,0)
 . I +PSJXDOX(X)'=+PSGDO,(PSJXUNIT=$P(PSJXDOX(X),U,2)),$S(+PSJXDUP=+$P(PSJXDOX(X),U,3):1,1:PSJXDUP=$P(PSJXDOX(X),U,12)) D  Q:PSJDSFLG
"RTN","PSJDOSE",181,0)
 .. N CHK,DGTS S CHK=+PSGDO/$P(PSJXDOX(X),U,5) S DGTS=$L($P(PSJXDUP,".",2)) S CHK=+$FN(CHK,"",DGTS) I +CHK=+PSJXDUP S PSJDSFLG=0
"RTN","PSJDOSE",182,0)
 . I +PSJXDOX(X)=+PSGDO,$TR($P(PSJXDOX(X),U,11)," ")=$TR(PSGDO," "),$S(+PSJXDUP=+$P(PSJXDOX(X),U,3):1,1:PSJXDUP=$P(PSJXDOX(X),U,12)) S PSJDSFLG=0
"RTN","PSJDOSE",183,0)
 Q
"RTN","PSJDOSE",184,0)
PTPLANE(P,X,C) ;Find the distance from a point to a line/plane
"RTN","PSJDOSE",185,0)
                ;P - array containing coordinates of point
"RTN","PSJDOSE",186,0)
                ;X - array representing normal vector defining the line/plane
"RTN","PSJDOSE",187,0)
                ;C - constant representing point defining the line/plane
"RTN","PSJDOSE",188,0)
 ;*PSJ*5*264 - PTPLANE added
"RTN","PSJDOSE",189,0)
 ;
"RTN","PSJDOSE",190,0)
 N N,CNT,NUM,DEN
"RTN","PSJDOSE",191,0)
 Q:'$D(P)!'$D(X)!'$D(C) -1
"RTN","PSJDOSE",192,0)
 S N=0,CNT=0,NUM=0,DEN=0
"RTN","PSJDOSE",193,0)
 F  S CNT=$O(P(CNT)) Q:'CNT  S N=N+1
"RTN","PSJDOSE",194,0)
 F CNT=1:1:N S NUM=P(CNT)*X(CNT)+NUM
"RTN","PSJDOSE",195,0)
 S NUM=$$ABS^XLFMTH(NUM-C)
"RTN","PSJDOSE",196,0)
 F CNT=1:1:N S DEN=X(CNT)**2+DEN
"RTN","PSJDOSE",197,0)
 S DEN=$$SQRT^XLFMTH(DEN)
"RTN","PSJDOSE",198,0)
 Q $S(DEN=0:-1,1:NUM/DEN)
"RTN","PSJDOSE",199,0)
BCMAUPD(PSJDD) ;
"RTN","PSJDOSE",200,0)
 NEW PSJCNT
"RTN","PSJDOSE",201,0)
 K PSJBCMA
"RTN","PSJDOSE",202,0)
 F X=0:0 S X=$O(PSJXDOX(X)) Q:'X  D
"RTN","PSJDOSE",203,0)
 . Q:'+$P(PSJXDOX(X),U,12)
"RTN","PSJDOSE",204,0)
 . S PSJCNT=+$G(PSJCNT)+1
"RTN","PSJDOSE",205,0)
 . S PSJBCMA(+PSJDD,$P(PSJXDOX(X),U,12),PSJCNT)=$P(PSJXDOX(X),U,1,2)
"RTN","PSJDOSE",206,0)
 Q
"RTN","PSJDOSE",207,0)
DSPWARN ;
"RTN","PSJDOSE",208,0)
 NEW PSJDOSE
"RTN","PSJDOSE",209,0)
 D SETVAR
"RTN","PSJDOSE",210,0)
 W !!,PSJDOSE("WARN"),!,PSJDOSE("WARN1"),!
"RTN","PSJDOSE",211,0)
 D PAUSE^VALM1
"RTN","PSJDOSE",212,0)
 Q
"RTN","PSJLMUDE")
0^9^B87296083^B86619867
"RTN","PSJLMUDE",1,0)
PSJLMUDE ;BIR/MLM-SHOW FIELDS FOR EDIT (LISTMAN STYLE) ;01 JUNE 00 / 2:40 PM
"RTN","PSJLMUDE",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**7,47,50,63,64,58,80,116,110,111,164,175,201,181,254,267,228,315,317,338**;16 DEC 97;Build 8
"RTN","PSJLMUDE",3,0)
 ;
"RTN","PSJLMUDE",4,0)
 ;NFI-UD Fr#:2 chgs@init+4 to display non-formulary (N/F)
"RTN","PSJLMUDE",5,0)
 ;also chgs @init+23
"RTN","PSJLMUDE",6,0)
 ;
"RTN","PSJLMUDE",7,0)
 ; Reference to ^PS(55 is supported by DBIA# 2191
"RTN","PSJLMUDE",8,0)
 ; Reference to ^PSDRUG is supported by DBIA 2192
"RTN","PSJLMUDE",9,0)
 ; Reference to $$GET^XPAR is supported by DBIA #2263
"RTN","PSJLMUDE",10,0)
 ;
"RTN","PSJLMUDE",11,0)
INIT(PSGP,PSGORD) ;
"RTN","PSJLMUDE",12,0)
 N D,ND,PSJBCMA,PSJL,PSJLM,PSJLN,Q,QQ,PSJDUR,J K ^TMP("PSJUDE",$J),^TMP($J,"GMRAING")
"RTN","PSJLMUDE",13,0)
 K:$G(PSJNORD) PSGOEEF S PSJLN=1
"RTN","PSJLMUDE",14,0)
 D CLEAN^VALM10
"RTN","PSJLMUDE",15,0)
 S PSJL=$S($D(PSGEFN(1)):$E(" *",PSGEFN(1)+1)_"(1)",1:"   "),PSJL=$$SETSTR^VALM1("Orderable Item: "_PSGPDN_$$OINF^PSJDIN(PSGPD),PSJL,5,74) D  D SETTMP D:$G(PSGOEEF(108))!($G(PSGOEEF(101))) HILITE(1)
"RTN","PSJLMUDE",16,0)
 . NEW Q,PSJDDA,PSJVD F Q=0:0 S Q=$O(^PS(53.45,PSJSYSP,2,Q)) Q:'Q  S PSJDDA(+$G(^(Q,0)))=""
"RTN","PSJLMUDE",17,0)
 . S PSJVD=$$DINFLUD^PSJDIN(PSGPD,.PSJDDA)
"RTN","PSJLMUDE",18,0)
 . I $$OVRCHK^PSGSICH1(PSGP,PSGORD) S PSJVD="<OCI>"_PSJVD
"RTN","PSJLMUDE",19,0)
 . S PSJL=$$SETSTR^VALM1(PSJVD,PSJL,(80-$L(PSJVD)),80)
"RTN","PSJLMUDE",20,0)
 . D:PSJVD]"" CNTRL^VALM10(1,80-$L(PSJVD),$L(PSJVD),IORVON,IORVOFF,0)
"RTN","PSJLMUDE",21,0)
 I $G(PSJORD)["P" D REQDT^PSJLIVMD(PSJORD)
"RTN","PSJLMUDE",22,0)
 S PSJL="Instructions: "_PSGOINST D PTXT^PSJLMPRU(PSJL,"PSJUDE",6,80)
"RTN","PSJLMUDE",23,0)
 S PSJL=$S($D(PSGEFN(2)):$E(" *",PSGEFN(2)+1)_"(2)",1:"    "),PSJL=$$SETSTR^VALM1("Dosage Ordered: "_PSGDO,PSJL,5,76) D SETTMP D:$G(PSGOEEF(109)) HILITE(2)
"RTN","PSJLMUDE",24,0)
 I $G(PSGRDTX) S PSJDUR=$$FMTDUR^PSJLIVMD($P($G(PSGRDTX),U,2))
"RTN","PSJLMUDE",25,0)
 I $G(PSJORD),($G(PSJDUR)="") S P=$S(PSJORD["U":5,PSJORD["V":"IV",PSJORD["P":"P",1:-1) S PSJDUR=$$GETDUR^PSJLIVMD(PSGP,+PSJORD,P)
"RTN","PSJLMUDE",26,0)
 S PSJL=$$SETSTR^VALM1("Duration: "_$G(PSJDUR),PSJL,11,25)
"RTN","PSJLMUDE",27,0)
 S PSJL=$$SETSTR^VALM1($S($D(PSGEFN(3)):$E(" *",PSGEFN(3)+1)_"(3)",1:"    ")_"Start: "_$P(PSGSDN,U,2),PSJL,54,26) D:$G(PSGOEEF(10)) HILITE(3)
"RTN","PSJLMUDE",28,0)
 I $G(PSGORD)["P" N ND0,OLDO S ND0=@(PSGOEEWF_"0)") I $P(ND0,"^",24)="R" S OLDO=$P(ND0,"^",25) I OLDO,(OLDO["U") D
"RTN","PSJLMUDE",29,0)
 . N OSTRT,OSTRTN S OSTRT=$G(@("^PS(55,"_PSGP_",5,"_+OLDO_",2)")),OSTRT=$P(OSTRT,"^",2) Q:'OSTRT  S OSTRTN=$$ENDTC^PSGMI(+OSTRT)
"RTN","PSJLMUDE",30,0)
 . S PSJL=$$SETSTR^VALM1($S($D(PSGEFN(3)):$E(" *",PSGEFN(3)+1)_"(3)",1:"    ")_"Start: "_OSTRTN,PSJL,54,26)
"RTN","PSJLMUDE",31,0)
 D SETTMP
"RTN","PSJLMUDE",32,0)
 S PSJL=$S($D(PSGEFN(4)):$E(" *",PSGEFN(4)+1)_"(4)",1:"    "),PSJL=$$SETSTR^VALM1("Med Route: "_PSGMRN,PSJL,10,35) D:$G(PSGOEEF(3)) HILITE(4)
"RTN","PSJLMUDE",33,0)
 I $G(PSJORD)["P" N PSGRNDT S PSGRNDT=$$LASTREN^PSJLMPRI(DFN,PSGORD) S:PSGRNDT PSGRNDT=$$ENDTC^PSGMI(+PSGRNDT),PSJL=$$SETSTR^VALM1("Renewed: "_PSGRNDT,PSJL,56,32)
"RTN","PSJLMUDE",34,0)
 I '$G(PSGRNDT),$G(PSGRDTX) D
"RTN","PSJLMUDE",35,0)
 . I $D(PSGRDTX)<10 S PSGRSDN=$$ENDTC^PSGMI(+PSGRDTX),PSJL=$$SETSTR^VALM1("REQUESTED START: "_PSGRSDN,PSJL,48,32) Q
"RTN","PSJLMUDE",36,0)
 . I $G(PSGRDTX(+$G(PSJORD),"PSGRSD")),$P($G(PSGSDN),U,2) S PSGRSDN=$$ENDTC^PSGMI(PSGRDTX(+PSJORD,"PSGRSD")),PSJL=$$SETSTR^VALM1("Calc Start: "_PSGRSDN,PSJL,53,32) D
"RTN","PSJLMUDE",37,0)
 .. I PSGSD'=PSGRDTX(+PSJORD,"PSGRSD") D CNTRL^VALM10(5,53,80,IORVON,IORVOFF)
"RTN","PSJLMUDE",38,0)
 ; Indirect reference in PSGOEEWF below refers to either ^PS(53.1 or ^PS(55,DFN,5,. Naked reference refers to full indirect reference
"RTN","PSJLMUDE",39,0)
 I $G(PSJORD)["U" N ND14 S ND14=$G(@(PSGOEEWF_"14,0)")) I ND14]"" S ND14=$G(^($P(ND14,"^",3),0)),RNDT=$P(ND14,"^") I RNDT D
"RTN","PSJLMUDE",40,0)
 . N PSGRNDT S PSGRNDT=$$ENDTC^PSGMI(+RNDT),PSJL=$$SETSTR^VALM1("Renewed: "_PSGRNDT,PSJL,56,32)
"RTN","PSJLMUDE",41,0)
 D SETTMP
"RTN","PSJLMUDE",42,0)
 I PSGORD]"" S PSJBCMA=$$BCMALG^PSJUTL2(PSGP,PSGORD)
"RTN","PSJLMUDE",43,0)
 I $G(PSJBCMA)]"" S PSJL=$$SETSTR^VALM1(PSJBCMA,PSJL,1,52)
"RTN","PSJLMUDE",44,0)
 S PSJL=$$SETSTR^VALM1($S($D(PSGEFN(5)):$E(" *",PSGEFN(5)+1)_"(5)",1:"     ")_" Stop: "_$P(PSGFDN,U,2),PSJL,54,26) D SETTMP D:$G(PSGOEEF(25))!($G(PSGOEEF(34))) HILITE(5)
"RTN","PSJLMUDE",45,0)
 S PSJL=$S($D(PSGEFN(6)):$E(" *",PSGEFN(6)+1)_"(6)",1:"   "),PSJL=$$SETSTR^VALM1("Schedule Type: "_PSGSTN,PSJL,6,45) D:$G(PSGOEEF(7)) HILITE(6)
"RTN","PSJLMUDE",46,0)
 I $G(PSJORD)["P",$G(PSGRDTX(+$G(PSJORD),"PSGRFD")),$P($G(PSGFDN),U,2) S PSGRFDN=$$ENDTC^PSGMI(PSGRDTX(+PSJORD,"PSGRFD")),PSJL=$$SETSTR^VALM1("Calc Stop: "_PSGRFDN,PSJL,54,26) D
"RTN","PSJLMUDE",47,0)
 . I PSGFD'=PSGRDTX(+PSJORD,"PSGRFD") D CNTRL^VALM10(7,54,80,IORVON,IORVOFF)
"RTN","PSJLMUDE",48,0)
 D SETTMP
"RTN","PSJLMUDE",49,0)
 S PSGSMN=$P("NO^YES",U,PSGSM+1)
"RTN","PSJLMUDE",50,0)
 S PSJL=$S($D(PSGEFN(8)):$E(" *",PSGEFN(8)+1)_"(8)",1:"   "),PSJL=$$SETSTR^VALM1("Schedule: "_PSGSCH_$G(SCHMSG),PSJL,11,68) D SETTMP D:$G(PSGOEEF(26)) HILITE(8)
"RTN","PSJLMUDE",51,0)
 S PSJL=$S($D(PSGEFN(9)):$E(" *",PSGEFN(9)+1)_"(9)",1:"   "),PSJL=$$SETSTR^VALM1("Admin Times: "_PSGAT,PSJL,8,71) D SETTMP D:'$G(PSGNOHI)&($G(PSGOEEF(39))!($G(PSGOEEF(41)))) HILITE(9) ;*315
"RTN","PSJLMUDE",52,0)
 I +$G(PSGRF)>1 N PSGRMVD S PSGRMVD=$S(+$G(PSGRMVT):PSGRMVT,1:"") S PSJL=$$SETSTR^VALM1("Removal Times: "_PSGRMVD,PSJL,6,71) D SETTMP ;*315
"RTN","PSJLMUDE",53,0)
 S PSJL=$S($D(PSGEFN(10)):$E(" *",PSGEFN(10)+1)_"(10)",1:"   "),PSJL=$$SETSTR^VALM1("Provider: "_PSGPRN,PSJL,11,68) D:$G(PSGOEEF(1)) HILITE(10) D SETTMP
"RTN","PSJLMUDE",54,0)
 S PSJL=$S($D(PSGEFN(11)):$E(" *",PSGEFN(11))_" (11)",1:"   ")_" Special Instructions"_$S($P(PSGSI,"^",2)=1:"!: ",1:": ") D
"RTN","PSJLMUDE",55,0)
 .I '$D(^PS(53.45,DUZ,5,1)),$G(PSGORD) D GETSI^PSJBCMA5(PSGP,PSGORD)
"RTN","PSJLMUDE",56,0)
 .I '$P($G(^PS(53.45,DUZ,5,0)),"^",3) S PSJL=PSJL_$P($G(PSGSI),"^") D PTXT^PSJLMPRU(PSJL,"PSJUDE",1,80) Q
"RTN","PSJLMUDE",57,0)
 .S PSJL=PSJL_" (see below)" D SETTMP N I S I=0 F J=1:1 S I=$O(^PS(53.45,DUZ,5,I)) Q:'I  S PSJL="      "_^PS(53.45,DUZ,5,I,0) D SETTMP
"RTN","PSJLMUDE",58,0)
 S PSJL="" D SETTMP D:$G(PSGOEEF(8)) HILITE(11)
"RTN","PSJLMUDE",59,0)
 ; E3R 16130
"RTN","PSJLMUDE",60,0)
 I $O(^PS(53.45,PSJSYSP,2,1)) F  S PSJL="" D SETTMP Q:PSJLN>15
"RTN","PSJLMUDE",61,0)
 S PSJL=$S($D(PSGEFN(12)):$E(" *",PSGEFN(12))_" (12)",1:"   ")_" Dispense Drug",PSJL=$$SETSTR^VALM1("U/D",PSJL,52,60),PSJL=$$SETSTR^VALM1("Inactive Date",PSJL,59,16) D  D SETTMP,CNTRL^VALM10(PSJLN-1,1,80,IOUON,IOUOFF,0)
"RTN","PSJLMUDE",62,0)
 .I $$GET^XPAR("SYS","PSJ PADE OE BALANCES") D
"RTN","PSJLMUDE",63,0)
 ..I '$G(VAIN(4)) N VAIN,DFN S DFN=$G(PSGP) D INP^VADPT
"RTN","PSJLMUDE",64,0)
 ..N PSJORCL,PSJCLNK
"RTN","PSJLMUDE",65,0)
 ..; If clinic order, quit if clinic location is not linked to PADE
"RTN","PSJLMUDE",66,0)
 ..S PSJORCL=$S($G(PSGORD)["P":$G(^PS(53.1,+$G(PSGORD),"DSS")),$G(PSGORD)["U":$G(^PS(55,+$G(PSGP),5,+$G(PSGORD),8)),$G(PSGORD)["V":$G(^PS(55,+$G(PSGP),"IV",+$G(PSGORD),"DSS")),1:"")
"RTN","PSJLMUDE",67,0)
 ..I PSJORCL,$P(PSJORCL,"^",2) S PSJCLNK=$$PADECL^PSJPAD50(+$G(PSJORCL)) Q:'PSJCLNK
"RTN","PSJLMUDE",68,0)
 ..I '$G(PSJCLNK) Q:'$$PADEWD^PSJPAD50(+$G(VAIN(4)))   ; PADE device Inactive?
"RTN","PSJLMUDE",69,0)
 ..S PSJL=$$SETSTR^VALM1("PADE",PSJL,75,5)
"RTN","PSJLMUDE",70,0)
 NEW PSJX,PSJDLINE
"RTN","PSJLMUDE",71,0)
 F Q=0:0 S Q=$O(^PS(53.45,PSJSYSP,2,Q)) Q:'Q  S ND=$G(^(Q,0)) D
"RTN","PSJLMUDE",72,0)
 .S D=$P(ND,"^"),PSGID=$P(ND,"^",3) I PSGID S PSGID=$$ENDTC^PSGMI(PSGID)
"RTN","PSJLMUDE",73,0)
 .S D=$S(D="":"NOT FOUND",'$D(^PSDRUG(D,0)):D,$P(^(0),"^")]"":$P(^(0),"^"),1:D_";PSDRUG(")
"RTN","PSJLMUDE",74,0)
 .S PSJL="      "_D_$$DDNF^PSJDIN(+ND),PSJL=$$SETSTR^VALM1($S($P(ND,"^",2):$S($P(ND,"^",2)=.5:"1/2",$P(ND,"^",2)=.25:"1/4",1:$P(ND,"^",2)),$P(ND,"^",2)=0:0,1:1),PSJL,52,63) S:PSGID PSJL=$$SETSTR^VALM1(PSGID,PSJL,59,16) D  D SETTMP
"RTN","PSJLMUDE",75,0)
 ..; PSJ*5*317 - If PSJ PADE OE BALANCES parameter is YES, PADE balances should display as identifier.
"RTN","PSJLMUDE",76,0)
 ..I $$GET^XPAR("SYS","PSJ PADE OE BALANCES") D
"RTN","PSJLMUDE",77,0)
 ...N PSJPDLOC,VAIN,PSJORCL,PSJCLNK,PSJCLND D INP^VADPT
"RTN","PSJLMUDE",78,0)
 ...; If clinic order, quit if clinic location is not linked to PADE
"RTN","PSJLMUDE",79,0)
 ...S PSJCLND=$S($G(PSGORD)["P":$G(^PS(53.1,+$G(PSGORD),"DSS")),$G(PSGORD)["U":$G(^PS(55,+$G(PSGP),5,+$G(PSGORD),8)),$G(PSGORD)["V":$G(^PS(55,+$G(PSGP),"IV",+$G(PSGORD),"DSS")),1:"")
"RTN","PSJLMUDE",80,0)
 ...S PSJORCL=$S(+PSJCLND&$P(PSJCLND,"^",2):+PSJCLND,1:"")
"RTN","PSJLMUDE",81,0)
 ...I PSJORCL,$P(PSJCLND,"^",2) S PSJCLNK=$$PADECL^PSJPAD50(+$G(PSJORCL)) Q:'PSJCLNK
"RTN","PSJLMUDE",82,0)
 ...I '$G(PSJCLNK) Q:'$$PADEWD^PSJPAD50(+$G(VAIN(4)))   ; Quit if patient location not linked to PADE
"RTN","PSJLMUDE",83,0)
 ...S PSJPDLOC=$S($G(PSJCLNK):PSJORCL_"C",1:"")
"RTN","PSJLMUDE",84,0)
 ...S:'PSJPDLOC PSJPDLOC=+$G(VAIN(4))
"RTN","PSJLMUDE",85,0)
 ...N PADE S PADE=$J($$DRGQTY^PSJPADSI(+ND,$S(PSJPDLOC["C":"CL",1:"WD"),+PSJPDLOC),5)
"RTN","PSJLMUDE",86,0)
 ...S PSJL=$$SETSTR^VALM1(PADE,PSJL,74,5)
"RTN","PSJLMUDE",87,0)
 ..S PSJX=$G(PSJX)+1
"RTN","PSJLMUDE",88,0)
 ..S PSJDLINE=$S($P(^PS(53.45,PSJSYSP,2,0),U,3)>1:16,1:13) ;*228 - Highlight multiple dispense drugs
"RTN","PSJLMUDE",89,0)
 ..I $G(PSGOEEF(109)) D CNTRL^VALM10(PSJDLINE+PSJX,7,73,IORVON_IOBON,IORVOFF_IOBOFF,0)
"RTN","PSJLMUDE",90,0)
 I $S(PSGORD["P":$O(^PS(53.1,+$G(PSGORD),12,0)),1:$O(^PS(55,PSGP,5,+PSGORD,12,0))) S PSJL="Provider Comments:" D SETTMP S PSJL="" D
"RTN","PSJLMUDE",91,0)
 .F Q=0:0 S Q=$S(PSGORD["P":$O(^PS(53.1,+$G(PSGORD),12,Q)),1:$O(^PS(55,PSGP,5,+PSGORD,12,Q))) Q:'Q  S PSJL=$G(^(Q,0)) D SETTMP
"RTN","PSJLMUDE",92,0)
 D SETTMP S PSJL=$$SETSTR^VALM1($S($D(PSGEFN(7)):$E(" *",PSGEFN(7)+1)_"(7)",1:"   ")_"Self Med: "_PSGSMN,PSJL,1,24)
"RTN","PSJLMUDE",93,0)
 S:PSGSM&PSGHSM PSJL=$$SETSTR^VALM1("  (HS)",PSJL,16,7) D SETTMP D:$G(PSGOEEF(5)) HILITE(7)
"RTN","PSJLMUDE",94,0)
 D SETTMP S PSJL="Entry By: "_PSGEBN,PSJL=$$SETSTR^VALM1("Entry Date: "_$P(PSGLIN,U,2),PSJL,51,39) D SETTMP
"RTN","PSJLMUDE",95,0)
 I $G(PSGLRN) D SETTMP S PSJL="Renewed By: "_$$ENNPN^PSGMI($P(PSGLRN,"^",2)) D SETTMP
"RTN","PSJLMUDE",96,0)
 D SETTMP S PSJL="(13)"_" Comments:"
"RTN","PSJLMUDE",97,0)
 D:'$O(^PS(53.45,PSJSYSP,1,0)) SETTMP
"RTN","PSJLMUDE",98,0)
 D SETTMP F Q=0:0 S Q=$O(^PS(53.45,PSJSYSP,1,Q)) Q:'Q  S PSJWPL=PSJL_$S($E(PSJL)=" ":"",1:" ")_$G(^(Q,0)),PSJL="" D DISPLAY
"RTN","PSJLMUDE",99,0)
 D SETTMP
"RTN","PSJLMUDE",100,0)
 I PSGORD["P",($P($G(^PS(53.1,+PSGORD,0)),U,9)="P"),$O(^PS(53.1,+PSGORD,10,0)) D
"RTN","PSJLMUDE",101,0)
 .D SETTMP S PSJL="CPRS Order Checks:" D SETTMP
"RTN","PSJLMUDE",102,0)
 .F Q=0:0 S Q=$O(^PS(53.1,+PSGORD,10,Q)) Q:'Q  D
"RTN","PSJLMUDE",103,0)
 ..;S PSJL="" D SETTMP S PSJL=$G(^PS(53.1,+PSGORD,10,Q,0)) D SETTMP
"RTN","PSJLMUDE",104,0)
 ..S PSJL="" D SETTMP
"RTN","PSJLMUDE",105,0)
 ..D FORMATTX($G(^PS(53.1,+PSGORD,10,Q,0)))
"RTN","PSJLMUDE",106,0)
 ..S PSJL="Overriding Provider: "_$P($G(^PS(53.1,+PSGORD,10,Q,1)),U) D SETTMP
"RTN","PSJLMUDE",107,0)
 ..S PSJL="Overriding Reason: " F X=0:0 S X=$O(^PS(53.1,+PSGORD,10,Q,2,X)) Q:'X   D
"RTN","PSJLMUDE",108,0)
 ...S PSJL=PSJL_$G(^PS(53.1,+PSGORD,10,Q,2,X,0)) D SETTMP S PSJL="                   "
"RTN","PSJLMUDE",109,0)
ACTFLG ;
"RTN","PSJLMUDE",110,0)
 S ND4=$S(PSGORD["P":$G(^PS(53.1,+PSGORD,4)),1:$G(^PS(55,PSGP,5,+PSGORD,4)))
"RTN","PSJLMUDE",111,0)
 S AT="",Y="12,13,D,18,19,H1,22,23,H0,15,16,R" F X=1:3:12 I $P(ND4,"^",$P(Y,",",X)),$P(ND4,"^",$P(Y,",",X+1)) S AT=$P(Y,",",X+2) Q
"RTN","PSJLMUDE",112,0)
 I AT="",'$P(ND4,"^",$S($P(PSJSYSU,";",3)>1:3,1:1)) S AT="V"_$S($P(ND4,"^",18):"H1",$P(ND4,"^",22):"H0",$P(ND4,"^",15):"R",1:"")
"RTN","PSJLMUDE",113,0)
 I AT]"" D
"RTN","PSJLMUDE",114,0)
 .S PSJL="" D SETTMP
"RTN","PSJLMUDE",115,0)
 .S PSJL="ORDER "_$S(AT["V":"NOT VERIFIED"_$S($P(AT,"V",2)="":"",1:" ("_$S(AT["H1":"ON HOLD",AT["H0":"OFF HOLD",1:"RENEWAL")_")"),1:"MARKED TO BE "_$S(AT["D":"CANCELLED",AT["H1":"PLACED ON HOLD",AT["H0":"TAKEN OFF OF HOLD",1:"RENEWED"))
"RTN","PSJLMUDE",116,0)
 I AT'["V",AT["H1",$D(^PS(55,PSGP,5.1)) S AT=^(5.1) I $P(AT,"^",7),$P(AT,"^",10)]"" S PSJL=PSJL_"  ("_$P(AT,"^",10)_")"
"RTN","PSJLMUDE",117,0)
 D SETTMP
"RTN","PSJLMUDE",118,0)
 S VALMCNT=PSJLN-1
"RTN","PSJLMUDE",119,0)
 K PSGSMN,Q,Y,Y1,Y2,PSGLRN
"RTN","PSJLMUDE",120,0)
 S VALM("TITLE")=PSGSTAT_" UNIT DOSE "_$S((PSGSTAT="PENDING")&($G(PSGPRIO)]""):"("_PSGPRIO_")",$G(PSGPRIO)="DONE":"("_PSGPRIO_")",1:"") I $D(PSJLMP2) S VALMBG=16 K PSJLMP2
"RTN","PSJLMUDE",121,0)
TEST ;
"RTN","PSJLMUDE",122,0)
 I $G(PSGPFLG) S VALMSG="INVALID ORDERABLE ITEM"
"RTN","PSJLMUDE",123,0)
 I $G(PSGDI) S VALMSG=$S($G(VALMSG)="":"INVALID",1:VALMSG_",")_" DISPENSE DRUG"
"RTN","PSJLMUDE",124,0)
 I $G(PSGPI) S VALMSG=$S($G(VALMSG)="":"INVALID",1:VALMSG_",")_" PROVIDER"
"RTN","PSJLMUDE",125,0)
 I $G(PSGDREQ) S CHK=1,VALMSG="DOSAGE IS REQUIRED" K PSGDREQ
"RTN","PSJLMUDE",126,0)
 Q
"RTN","PSJLMUDE",127,0)
DISPLAY ;
"RTN","PSJLMUDE",128,0)
 S PSJL=PSJWPL D SETTMP
"RTN","PSJLMUDE",129,0)
 Q
"RTN","PSJLMUDE",130,0)
 ;
"RTN","PSJLMUDE",131,0)
SETTMP ;
"RTN","PSJLMUDE",132,0)
 S ^TMP("PSJUDE",$J,PSJLN,0)=PSJL,PSJLN=PSJLN+1,PSJL=""
"RTN","PSJLMUDE",133,0)
 Q
"RTN","PSJLMUDE",134,0)
 ;
"RTN","PSJLMUDE",135,0)
HILITE(FLD) ; 
"RTN","PSJLMUDE",136,0)
 N COL,LIN,WID,X
"RTN","PSJLMUDE",137,0)
 S X="$T("_FLD_"^PSJLMUDE)",@("X="_X),X=$P(X,";;",2),LIN=+X,COL=$P(X,",",2),LAB=$P(X,",",3),X=$P(X,",",4),WID=(LAB+$L(@X))
"RTN","PSJLMUDE",138,0)
 I $G(PSGRF),FLD>9 S LIN=LIN+1 ;COMPENSATE FOR REMOVAL TIMES
"RTN","PSJLMUDE",139,0)
 I FLD=7 S LIN=+$G(PSJLN)-1 Q:LIN<13
"RTN","PSJLMUDE",140,0)
 D CNTRL^VALM10(LIN,COL,WID,IORVON_IOBON,IORVOFF_IOBOFF,0)
"RTN","PSJLMUDE",141,0)
 Q
"RTN","PSJLMUDE",142,0)
 ;
"RTN","PSJLMUDE",143,0)
FORMATTX(PSJX) ;
"RTN","PSJLMUDE",144,0)
 NEW PSJX1,Y,Y1
"RTN","PSJLMUDE",145,0)
 S PSJX1=""
"RTN","PSJLMUDE",146,0)
 F Y=1:1:$L(PSJX," ") S Y1=$P(PSJX," ",Y) D
"RTN","PSJLMUDE",147,0)
 . I ($L(PSJX1)+$L(Y1)+1)>79 S:$E(PSJX1,1,1)=" " PSJX1=$E(PSJX1,2,$L(PSJX1)) S PSJL=PSJX1,PSJX1="" D SETTMP
"RTN","PSJLMUDE",148,0)
 . S PSJX1=PSJX1_Y1_" "
"RTN","PSJLMUDE",149,0)
 I PSJX1]"" S PSJL=PSJX1 D SETTMP
"RTN","PSJLMUDE",150,0)
 K PSJX1
"RTN","PSJLMUDE",151,0)
 Q
"RTN","PSJLMUDE",152,0)
 ;
"RTN","PSJLMUDE",153,0)
1 ;;1,5,16,PSGPDN
"RTN","PSJLMUDE",154,0)
2 ;;3,5,16,PSGDO
"RTN","PSJLMUDE",155,0)
3 ;;4,58,7,PSGSDN
"RTN","PSJLMUDE",156,0)
4 ;;5,10,11,PSGMRN
"RTN","PSJLMUDE",157,0)
5 ;;6,59,6,PSGFDN
"RTN","PSJLMUDE",158,0)
6 ;;7,6,15,PSGSTN
"RTN","PSJLMUDE",159,0)
7 ;;18,5,14,PSGSMN
"RTN","PSJLMUDE",160,0)
8 ;;8,11,12,PSGSCH
"RTN","PSJLMUDE",161,0)
9 ;;9,8,13,PSGAT
"RTN","PSJLMUDE",162,0)
10 ;;10,11,10,PSGPRN
"RTN","PSJLMUDE",163,0)
11 ;;11,7,22,PSGSI
"RTN","PSJLMUDE",164,0)
ENKILL ;
"RTN","PSJLMUDE",165,0)
 K PSGNOHI,PSGAT,PSGEB,PSGEFN,PSGFD,PSGHSM,PSGNEFD,PSGNESD,PSGOEEF,PSGOEER,PSGOFD,PSGOHSM,PSGOMR,PSGOMRN,PSGOPD,PSGOPDN,PSGOPR,PSGOSCH,PSGOSD,PSGOSM,PSGOST,PSGPD,PSGPDN,PSGPR,PSGSD,PSGSM Q
"RTN","PSJOE1")
0^8^B31376376^B31281544
"RTN","PSJOE1",1,0)
PSJOE1 ;BIR/CML3-UD OE FOR COMBINED OE ;29 JAN 99 / 9:44 AM
"RTN","PSJOE1",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**2,7,25,30,47,56,64,179,181,252,281,315,338**;16 DEC 97;Build 8
"RTN","PSJOE1",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PSJOE1",4,0)
 ; Reference to ^DICN is supported by DBIA# 10009
"RTN","PSJOE1",5,0)
 ; Reference to ^VALM is supported by DBIA# 10118
"RTN","PSJOE1",6,0)
 ; Reference to ^TMP("PSODAOC",$J supported by DBIA 6071
"RTN","PSJOE1",7,0)
 ;
"RTN","PSJOE1",8,0)
 S PC=0 G AD
"RTN","PSJOE1",9,0)
 ;
"RTN","PSJOE1",10,0)
EN ;
"RTN","PSJOE1",11,0)
 S PC=0
"RTN","PSJOE1",12,0)
 ;
"RTN","PSJOE1",13,0)
AD ; Ask Drug
"RTN","PSJOE1",14,0)
 ;PSJOCFG - If defined, it's for new order, renew or copy. ^PSJOCDSD using this flag to not display drug error.
"RTN","PSJOE1",15,0)
 K PSJOCFG,PSGDUR,PSGRMVT,PSGRMV,PSGRF,ND2P1 ;*315
"RTN","PSJOE1",16,0)
 N PSJNORD,PSGORQF,PSGSDX,PSGFDX,PSGNEFDO,PSGEDTOI,PSJOCFG,PSGDREQ S PSJOCFG="NEW UD" S PSJNORD=1 I $D(VALM("TM")) S IOTM=VALM("TM"),IOBM=IOSL W IOSC,@IOSTBM,IORC
"RTN","PSJOE1",17,0)
 K PSGORQF
"RTN","PSJOE1",18,0)
 D ^PSGOE7
"RTN","PSJOE1",19,0)
 I $G(PSGORQF) S PSJORQF=1 G DONE
"RTN","PSJOE1",20,0)
 S PC=1,PSJORQF=0 I X?1"S."1.E D ^PSGOES G AD
"RTN","PSJOE1",21,0)
 D ^PSGOE4:'$P(PSJSYSP0,"^",12),^PSGOE3:$P(PSJSYSP0,"^",12)
"RTN","PSJOE1",22,0)
 G:$G(PSGOROE1)=1 AD
"RTN","PSJOE1",23,0)
 K PSGEFN,PSGOEEF,PSGOEE,PSGOEOS S PSGEFN="1:13" F X=1:1:13 S PSGEFN(X)=""
"RTN","PSJOE1",24,0)
 S PSGPDN=$$OINAME^PSJLMUTL(PSGPDRG),PSGPD=PSGPDRG,PSGOINST="",PSGSDN=$$ENDD^PSGMI(PSGNESD)_U_$$ENDTC^PSGMI(PSGNESD),PSGFDN=$$ENDD^PSGMI(PSGNEFD)_U_$$ENDTC^PSGMI(PSGNEFD)
"RTN","PSJOE1",25,0)
 S PSGAT=PSGS0Y,PSGLIN=$$ENDD^PSGMI(PSGDT)_U_$$ENDTC^PSGMI(PSGDT),PSGLI=PSGDT,PSGEBN=$$ENNPN^PSGMI(DUZ),PSGSTAT=$S(PSGOEAV:"ACTIVE",1:"NON-VERIFIED")
"RTN","PSJOE1",26,0)
 D CHK^PSGOEV("^^"_PSGMR_"^^^^"_PSGST,PSGPDRG_U_PSGDO,PSGSCH_U_PSGNESD_"^^"_PSGNEFD)
"RTN","PSJOE1",27,0)
 S PSGSD=PSGNESD,PSGFD=PSGNEFD
"RTN","PSJOE1",28,0)
 K PSJACEPT S VALMBCK="Q" D:$D(Y) EN^VALM("PSJU LM ACCEPT")
"RTN","PSJOE1",29,0)
 I $G(PSJACEPT)=1 D
"RTN","PSJOE1",30,0)
 . D OC
"RTN","PSJOE1",31,0)
 . ;D:'$G(PSGORQF) IN^PSJOCDS($G(PSGORD),"UD",+$G(PSGDRG))
"RTN","PSJOE1",32,0)
 ;If intervention is not log then quit
"RTN","PSJOE1",33,0)
 I $G(PSGORQF)=1 S PSJACEPT=0
"RTN","PSJOE1",34,0)
 S PSJNOO=-1 I $G(PSJACEPT)=1 S PSJNOO=$$ENNOO^PSJUTL5("N")
"RTN","PSJOE1",35,0)
 I $G(PSJNOO)<0 K PSJACEPT W !,"No order created." G AD
"RTN","PSJOE1",36,0)
 K PSGOEE D ^PSGOETO S PSJORD=PSGORD
"RTN","PSJOE1",37,0)
 S ^TMP("PSODAOC",$J,"IP IEN")=PSGORD
"RTN","PSJOE1",38,0)
 ;RTC 178746 - Don't store allergy here.
"RTN","PSJOE1",39,0)
 ;D SETOC^PSJNEWOC(PSGORD)
"RTN","PSJOE1",40,0)
 I PSGOEAV D  G AD
"RTN","PSJOE1",41,0)
 . D SETOC^PSJNEWOC(PSGORD) ;RTC 17874
"RTN","PSJOE1",42,0)
 .I '$D(PSGOEE),+PSJSYSU=3 D EN^PSGPEN(PSGORD)
"RTN","PSJOE1",43,0)
 S PSGOEEF=0 D GETUD^PSJLMGUD(PSGP,PSGORD),ENSFE^PSGOEE0(PSGP,PSGORD),^PSGOE1,EN^VALM("PSJ LM UD ACTION")
"RTN","PSJOE1",44,0)
 ;RTC 178746 - store allergy if not verify the newly created order.
"RTN","PSJOE1",45,0)
 I ($G(PSGORD)["P"),($P($G(^PS(53.1,+PSGORD,0)),U,9)="N"),($G(PSJOCFG)="NEW UD") D SETOC^PSJNEWOC(PSGORD)
"RTN","PSJOE1",46,0)
 G AD
"RTN","PSJOE1",47,0)
 Q
"RTN","PSJOE1",48,0)
OC ;
"RTN","PSJOE1",49,0)
 NEW PSJDD,PSJALLGY,PSJALGY1
"RTN","PSJOE1",50,0)
 K PSGORQF
"RTN","PSJOE1",51,0)
 D FULL^VALM1
"RTN","PSJOE1",52,0)
 S PSJDD=+$$DD53P45^PSJMISC() I 'PSJDD S PSGORQF=1 Q
"RTN","PSJOE1",53,0)
 I +$G(PSGEDTOI) D
"RTN","PSJOE1",54,0)
 . S PSJALGY1=1
"RTN","PSJOE1",55,0)
 . D ENDDC^PSGSICHK($G(PSGP),PSJDD)
"RTN","PSJOE1",56,0)
 D:'$G(PSGORQF) IN^PSJOCDS($G(PSGORD),"UD",PSJDD)
"RTN","PSJOE1",57,0)
 Q
"RTN","PSJOE1",58,0)
EDIT(PROMPT) ;
"RTN","PSJOE1",59,0)
 ; Edit fields in a UD order.
"RTN","PSJOE1",60,0)
 ; PROMPT=0 - Select fields to edit by number.
"RTN","PSJOE1",61,0)
 ; PROMPT=1 - Prompt to select fields for editing.
"RTN","PSJOE1",62,0)
 ;
"RTN","PSJOE1",63,0)
 ;* D @$S('PROMPT:"ENEFA2^PSGON",1:"ENEFA^PSGON") Q:'Y  S PSGOEEG=3 D EDIT^PSGOEE ;$S(PSGOEEWF[53.1:3,1:5) D:Y EDIT^PSGOEE
"RTN","PSJOE1",64,0)
 D @$S('PROMPT:"ENEFA2^PSGON",1:"ENEFA^PSGON") Q:'Y  S:$G(PSJNEWOE) PSGOEEWF="^PS(53.1," S PSGOEEG=$S('$D(PSGOEEWF):3,PSGOEEWF[53.1:3,1:5) D EDIT^PSGOEE
"RTN","PSJOE1",65,0)
 I $G(PSJNEWOE) S PSGOEENO=0,DR="",VALMBCK="R"
"RTN","PSJOE1",66,0)
 I '$G(PSJNEWOE) D ENNOU^PSGOEE0 I 'PSGOEENO,DR="" S VALMBCK="R" Q
"RTN","PSJOE1",67,0)
 I 'PSGOEENO,$D(PSGOES) D ENNOU^PSGOEE0  ; only update on order sets
"RTN","PSJOE1",68,0)
 ;*179 No longer call CKDT^PSGOEE from here.
"RTN","PSJOE1",69,0)
 ;I 'PSGOEENO,$G(PSGPDNX)=1 D CKDT^PSGOEE
"RTN","PSJOE1",70,0)
 I $G(PSGOEER)["101^PSGOE8" S PSGEDTOI=1
"RTN","PSJOE1",71,0)
 K VALMSG I PSGOEENO D
"RTN","PSJOE1",72,0)
 .S VALMSG="This change will cause a new order to be created." D GTSTATUS^PSGOEE,CHKDD^PSGOEE
"RTN","PSJOE1",73,0)
 .S PSGEBN=$$ENNPN^PSGMI(DUZ),PSGLIN=$$ENDD^PSGMI(PSGDT)_U_$$ENDTC^PSGMI(PSGDT),PSGLI=PSGDT
"RTN","PSJOE1",74,0)
 D CHK^PSGOEV("^^"_PSGMR_"^^^^"_PSGST,PSGPDRG_U_PSGDO,PSGSCH_U_PSGSD_"^^"_PSGFD)
"RTN","PSJOE1",75,0)
 D INIT^PSJLMUDE(PSGP,$G(PSGORD))
"RTN","PSJOE1",76,0)
 Q
"RTN","PSJOE1",77,0)
DONE ;
"RTN","PSJOE1",78,0)
 K %,DA,DIC,DIE,DR,DRG,DRGN,DRGO,ND,OC,ORIFN,ORIT,ORPK,ORSTOP,ORSTRT,ORSTS,ORTX,PC,PSGDO,PSGMR,PSGMRN,PSGNEDFD,PSGNEFD,PSGNESD,PSGOES,PSGOROE1,PSGORD,PSGS0XT,PSGS0Y,PSGSCH,PSGSI,PSGX,Y,Z
"RTN","PSJOE1",79,0)
 K PSGEDTOI,PSJOCFG,PSGDUR,PSGRMVT,PSGRMV,PSGRF,ND2,ND2P1 ;*315
"RTN","PSJOE1",80,0)
 Q
"RTN","PSJOE1",81,0)
 ;
"RTN","PSJOE1",82,0)
GDO ;
"RTN","PSJOE1",83,0)
 W !!,"Drug is not found in Formulary List." F  S %=1 W !,"Would you like to try to search the list again" D YN^DICN Q:%  D TAM
"RTN","PSJOE1",84,0)
 Q:%<2
"RTN","PSJOE1",85,0)
FTD ;
"RTN","PSJOE1",86,0)
 R !!,"Enter FREE TEXT DRUG: ",PSGDRGN:DTIME E  W $C(7) S PSGDRGN="^" Q
"RTN","PSJOE1",87,0)
 Q:"^"[PSGDRGN  S X=$S(PSGDRGN'?.ANP:"Control character(s)",PSGDRGN["^":"Up-arrow ('^') in text",$L(PSGDRGN)>39:"Response longer than 39 characters",1:"") I X]"" W $C(7),"  ??",!?2,"(",X," not allowed.)" G FTD
"RTN","PSJOE1",88,0)
 Q:PSGDRGN'?1."?"
"RTN","PSJOE1",89,0)
 W !!?2,"ENTER DRUG ORDERED (1-39 CHARACTERS).",!?2,"Since the drug cannot be found in the DRUG file, enter the drug name here",!,"exactly as ordered.  Press the RETURN key (or enter an '^') to skip over this",!,"drug, or to again search the"
"RTN","PSJOE1",90,0)
 W " DRUG file for this one." G FTD
"RTN","PSJOE1",91,0)
 ;
"RTN","PSJOE1",92,0)
TAM ; Try Again Message
"RTN","PSJOE1",93,0)
 W !!,"  Enter a 'Y' to try again to find the drug ordered from the Formulary.  (The",!,"order cannot become active until a Formulary drug has been entered.)  Enter 'N'",!,"to enter the drug ordered as free text for later reference."
"RTN","PSJOE1",94,0)
 W "  Enter '^' to exit.",! Q
"VER")
8.0^22.2
"BLD",10570,6)
^293
**END**
**END**

