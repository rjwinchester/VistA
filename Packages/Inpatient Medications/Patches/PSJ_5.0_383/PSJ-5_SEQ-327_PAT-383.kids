Released PSJ*5*383 SEQ #327
Extracted from mail message
**KIDS**:PSJ*5.0*383^

**INSTALL NAME**
PSJ*5.0*383
"BLD",11363,0)
PSJ*5.0*383^INPATIENT MEDICATIONS^0^3190104^y
"BLD",11363,1,0)
^^2^2^3190103^
"BLD",11363,1,1,0)
Copied provider comments no longer display on the orders tab in CPRS when 
"BLD",11363,1,2,0)
pharmacist edits starred (*) field with Auto-Verify ON
"BLD",11363,4,0)
^9.64PA^^
"BLD",11363,6.3)
2
"BLD",11363,"KRN",0)
^9.67PA^1.61^23
"BLD",11363,"KRN",.4,0)
.4
"BLD",11363,"KRN",.401,0)
.401
"BLD",11363,"KRN",.402,0)
.402
"BLD",11363,"KRN",.403,0)
.403
"BLD",11363,"KRN",.5,0)
.5
"BLD",11363,"KRN",.84,0)
.84
"BLD",11363,"KRN",1.6,0)
1.6
"BLD",11363,"KRN",1.61,0)
1.61
"BLD",11363,"KRN",1.62,0)
1.62
"BLD",11363,"KRN",3.6,0)
3.6
"BLD",11363,"KRN",3.8,0)
3.8
"BLD",11363,"KRN",9.2,0)
9.2
"BLD",11363,"KRN",9.8,0)
9.8
"BLD",11363,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",11363,"KRN",9.8,"NM",1,0)
PSJBCMA5^^0^B82156820
"BLD",11363,"KRN",9.8,"NM","B","PSJBCMA5",1)

"BLD",11363,"KRN",19,0)
19
"BLD",11363,"KRN",19.1,0)
19.1
"BLD",11363,"KRN",101,0)
101
"BLD",11363,"KRN",409.61,0)
409.61
"BLD",11363,"KRN",771,0)
771
"BLD",11363,"KRN",779.2,0)
779.2
"BLD",11363,"KRN",870,0)
870
"BLD",11363,"KRN",8989.51,0)
8989.51
"BLD",11363,"KRN",8989.52,0)
8989.52
"BLD",11363,"KRN",8994,0)
8994
"BLD",11363,"KRN","B",.4,.4)

"BLD",11363,"KRN","B",.401,.401)

"BLD",11363,"KRN","B",.402,.402)

"BLD",11363,"KRN","B",.403,.403)

"BLD",11363,"KRN","B",.5,.5)

"BLD",11363,"KRN","B",.84,.84)

"BLD",11363,"KRN","B",1.6,1.6)

"BLD",11363,"KRN","B",1.61,1.61)

"BLD",11363,"KRN","B",1.62,1.62)

"BLD",11363,"KRN","B",3.6,3.6)

"BLD",11363,"KRN","B",3.8,3.8)

"BLD",11363,"KRN","B",9.2,9.2)

"BLD",11363,"KRN","B",9.8,9.8)

"BLD",11363,"KRN","B",19,19)

"BLD",11363,"KRN","B",19.1,19.1)

"BLD",11363,"KRN","B",101,101)

"BLD",11363,"KRN","B",409.61,409.61)

"BLD",11363,"KRN","B",771,771)

"BLD",11363,"KRN","B",779.2,779.2)

"BLD",11363,"KRN","B",870,870)

"BLD",11363,"KRN","B",8989.51,8989.51)

"BLD",11363,"KRN","B",8989.52,8989.52)

"BLD",11363,"KRN","B",8994,8994)

"BLD",11363,"QDEF")
^^^^NO^^^^^^NO
"BLD",11363,"QUES",0)
^9.62^^
"BLD",11363,"REQB",0)
^9.611^1^1
"BLD",11363,"REQB",1,0)
PSJ*5.0*370^2
"BLD",11363,"REQB","B","PSJ*5.0*370",1)

"MBREQ")
0
"PKG",471,-1)
1^1
"PKG",471,0)
INPATIENT MEDICATIONS^PSJ^UNIT DOSE AND IVS
"PKG",471,22,0)
^9.49I^1^1
"PKG",471,22,1,0)
5.0^2971215^2990325^66481
"PKG",471,22,1,"PAH",1,0)
383^3190104
"PKG",471,22,1,"PAH",1,1,0)
^^2^2^3190104
"PKG",471,22,1,"PAH",1,1,1,0)
Copied provider comments no longer display on the orders tab in CPRS when 
"PKG",471,22,1,"PAH",1,1,2,0)
pharmacist edits starred (*) field with Auto-Verify ON
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","PSJBCMA5")
0^1^B82156820^B81407826
"RTN","PSJBCMA5",1,0)
PSJBCMA5 ;BIR/JCH - RETRIEVE SPECIAL INSTRUCTIONS/OTHER PRINT INFO ; 1/9/12 11:12am
"RTN","PSJBCMA5",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**267,275,361,371,370,383**;16 DEC 97;Build 2
"RTN","PSJBCMA5",3,0)
 ;
"RTN","PSJBCMA5",4,0)
 ;Reference to ^DPT is supported by DBIA 10035
"RTN","PSJBCMA5",5,0)
 ;Reference to ^PS(55 is supported by DBIA 2191
"RTN","PSJBCMA5",6,0)
 ;Reference to ^%DTC is supported by DBIA 10000
"RTN","PSJBCMA5",7,0)
 ;Reference to ^DIE is supported by DBIA 10018
"RTN","PSJBCMA5",8,0)
 ;Reference to ^DIQ is supported by DBIA 2056
"RTN","PSJBCMA5",9,0)
 ;
"RTN","PSJBCMA5",10,0)
GETSIOPI(DFN,ON,BCMA) ; Get appropriate field depending on order type
"RTN","PSJBCMA5",11,0)
 ; DFN - Patient IEN
"RTN","PSJBCMA5",12,0)
 ; ON - Inpatient Order number
"RTN","PSJBCMA5",13,0)
 ; BCMA - Flag indicating called from BCMA - return data in ^TMP("PSJBCMA",$J
"RTN","PSJBCMA5",14,0)
 ;
"RTN","PSJBCMA5",15,0)
 I 'ON!'DFN Q 0
"RTN","PSJBCMA5",16,0)
 K ^TMP("PSJBCMA5",$J,DFN,ON)
"RTN","PSJBCMA5",17,0)
 I '$G(PSJSYSP),'$G(BCMA) N PSJSYSP S PSJSYSP=$J
"RTN","PSJBCMA5",18,0)
 I $G(BCMA) D  Q +$G(^TMP("PSJBCMA5",$J,DFN,ON))
"RTN","PSJBCMA5",19,0)
 .N PSJSYSP S PSJSYSP=$J
"RTN","PSJBCMA5",20,0)
 .I ON["V"!((ON["P")&($D(^PS(53.1,+ON,"AD"))!$D(^PS(53.1,+ON,"SOL")))) D  Q
"RTN","PSJBCMA5",21,0)
 ..I $$GETOPI(DFN,ON,1) D MOVETMP(DFN,ON,"IV")
"RTN","PSJBCMA5",22,0)
 .I $$GETSI(DFN,ON,1) D MOVETMP(DFN,ON,"UD")
"RTN","PSJBCMA5",23,0)
 I ON["V"!((ON["P")&($D(^PS(53.1,+ON,"AD"))!$D(^PS(53.1,+ON,"SOL")))) Q $$GETOPI(DFN,ON)
"RTN","PSJBCMA5",24,0)
 Q $$GETSI(DFN,ON)
"RTN","PSJBCMA5",25,0)
 ;
"RTN","PSJBCMA5",26,0)
MOVETMP(DFN,ON,OTYP) ; Move text from PS(53.45 to ^TMP for BCMA
"RTN","PSJBCMA5",27,0)
 N LN,ND S ND=$S(OTYP="IV":6,1:5)
"RTN","PSJBCMA5",28,0)
 I $O(^PS(53.45,PSJSYSP,ND," "),-1)=1,$TR(^PS(53.45,PSJSYSP,ND,1,0)," ")="" K ^TMP("PSJBCMA5",$J) Q
"RTN","PSJBCMA5",29,0)
 S ^TMP("PSJBCMA5",$J,DFN,ON)=+$P(^PS(53.45,PSJSYSP,ND,0),"^",3) S LN=0 F  S LN=$O(^PS(53.45,PSJSYSP,ND,LN)) Q:'LN  D
"RTN","PSJBCMA5",30,0)
 .S ^TMP("PSJBCMA5",$J,DFN,ON,LN)=^PS(53.45,PSJSYSP,ND,LN,0)
"RTN","PSJBCMA5",31,0)
 K ^PS(53.45,PSJSYSP,ND)
"RTN","PSJBCMA5",32,0)
 Q
"RTN","PSJBCMA5",33,0)
 ;
"RTN","PSJBCMA5",34,0)
GETSI(DFN,ON,BC) ; Get Special Instructions for Unit Dose orders
"RTN","PSJBCMA5",35,0)
 N PSJTXT,TXTLN
"RTN","PSJBCMA5",36,0)
 I $G(DFN)=""!($G(ON)="") Q 0
"RTN","PSJBCMA5",37,0)
 I '$G(PSJSYSP) N PSJSYSP S PSJSYSP=$J
"RTN","PSJBCMA5",38,0)
 I ON["P" D  Q +$P($G(^PS(53.45,+PSJSYSP,5,0)),"^",3)
"RTN","PSJBCMA5",39,0)
 .Q:($G(^PS(53.45,+PSJSYSP,5,0))="^^0^0")
"RTN","PSJBCMA5",40,0)
 .I $G(PSGOEENO)&($G(PSGOORD)=$G(PSJORD)) Q
"RTN","PSJBCMA5",41,0)
 .I $P($G(^PS(53.1,+ON,15,0)),"^",3) D  Q
"RTN","PSJBCMA5",42,0)
 ..S ^PS(53.45,+PSJSYSP,5,0)=^PS(53.1,+ON,15,0)
"RTN","PSJBCMA5",43,0)
 ..S LN=0 F  S LN=$O(^PS(53.1,+ON,15,LN)) Q:'LN  S ^PS(53.45,+PSJSYSP,5,LN,0)=^PS(53.1,+ON,15,LN,0)
"RTN","PSJBCMA5",44,0)
 .N OLDSI,MARX,TXTCNT S OLDSI=$P($G(^PS(53.1,+ON,6)),"^") I $L(OLDSI)>0 D  Q
"RTN","PSJBCMA5",45,0)
 ..I $G(BC),$L(OLDSI)>74 D TXT^PSGMUTL(OLDSI,74) S TXTCNT=$O(MARX(" "),-1) S ^PS(53.45,+PSJSYSP,5,0)="^^"_TXTCNT_"^"_TXTCNT D  Q
"RTN","PSJBCMA5",46,0)
 ...S TXTLN=0 F  S TXTLN=$O(MARX(TXTLN)) Q:'TXTLN  S ^PS(53.45,+PSJSYSP,5,TXTLN,0)=MARX(TXTLN)
"RTN","PSJBCMA5",47,0)
 ..S ^PS(53.45,+PSJSYSP,5,1,0)=$P(^PS(53.1,+ON,6),"^"),^PS(53.45,+PSJSYSP,5,0)="^^1^1"
"RTN","PSJBCMA5",48,0)
 I ON["U" D  Q $P($G(^PS(53.45,+PSJSYSP,5,0)),"^",3)
"RTN","PSJBCMA5",49,0)
 .Q:($G(^PS(53.45,+PSJSYSP,5,0))="^^0^0")
"RTN","PSJBCMA5",50,0)
 .N PSJVERI S PSJVERI=($P($G(PSJSYSP0),"^",9))
"RTN","PSJBCMA5",51,0)
 .Q:($G(PSGOEENO)=1)&((PSJVERI)'=1)
"RTN","PSJBCMA5",52,0)
 .I $P($G(^PS(55,+DFN,5,+ON,15,0)),"^",3) D  Q
"RTN","PSJBCMA5",53,0)
 ..S ^PS(53.45,+PSJSYSP,5,0)=$G(^PS(55,DFN,5,+ON,15,0))
"RTN","PSJBCMA5",54,0)
 ..S LN=0 F  S LN=$O(^PS(55,DFN,5,+ON,15,LN)) Q:'LN  S ^PS(53.45,+PSJSYSP,5,LN,0)=^PS(55,DFN,5,+ON,15,LN,0)
"RTN","PSJBCMA5",55,0)
 .N OLDSI,MARX,TXTCNT S OLDSI=$P($G(^PS(55,DFN,5,+ON,6)),"^") I $L(OLDSI)>0 D  Q
"RTN","PSJBCMA5",56,0)
 ..I $G(BC),$L(OLDSI)>74 D TXT^PSGMUTL(OLDSI,74) S TXTCNT=$O(MARX(" "),-1) S ^PS(53.45,+PSJSYSP,5,0)="^^"_TXTCNT_"^"_TXTCNT D  Q
"RTN","PSJBCMA5",57,0)
 ...S TXTLN=0 F  S TXTLN=$O(MARX(TXTLN)) Q:'TXTLN  S ^PS(53.45,+PSJSYSP,5,TXTLN,0)=MARX(TXTLN)
"RTN","PSJBCMA5",58,0)
 ..S ^PS(53.45,+PSJSYSP,5,1,0)=$P(^PS(55,DFN,5,+ON,6),"^"),^PS(53.45,+PSJSYSP,5,0)="^^1^1"
"RTN","PSJBCMA5",59,0)
 Q 0
"RTN","PSJBCMA5",60,0)
 ;
"RTN","PSJBCMA5",61,0)
GETOPI(DFN,ON,BC) ; Get Other Print Info for IV orders
"RTN","PSJBCMA5",62,0)
 N PSJTXT,LN
"RTN","PSJBCMA5",63,0)
 I $G(DFN)=""!($G(ON)="") Q 0
"RTN","PSJBCMA5",64,0)
 I '$G(PSJSYSP) N PSJSYSP S PSJSYSP=$J
"RTN","PSJBCMA5",65,0)
 I ON["P" D  Q +$P($G(^PS(53.45,+PSJSYSP,6,0)),"^",3)
"RTN","PSJBCMA5",66,0)
 .Q:$P($G(^PS(53.45,+PSJSYSP,6,0)),"^",3)
"RTN","PSJBCMA5",67,0)
 .I $P($G(^PS(53.1,+ON,16,0)),"^",3) D  Q
"RTN","PSJBCMA5",68,0)
 ..S ^PS(53.45,+PSJSYSP,6,0)=^PS(53.1,+ON,16,0)
"RTN","PSJBCMA5",69,0)
 ..S LN=0 F  S LN=$O(^PS(53.1,+ON,16,LN)) Q:'LN  S ^PS(53.45,+PSJSYSP,6,LN,0)=^PS(53.1,+ON,16,LN,0)
"RTN","PSJBCMA5",70,0)
 .N OLDOPI,MARX,TXTCNT S OLDOPI=$P($G(^PS(53.1,+ON,9)),"^",2) I $L(OLDOPI)>0 D  Q
"RTN","PSJBCMA5",71,0)
 ..I $G(BC),$L(OLDOPI)>74 D TXT^PSGMUTL(OLDOPI,74) S TXTCNT=$O(MARX(" "),-1) S ^PS(53.45,+PSJSYSP,6,0)="^^"_TXTCNT_"^"_TXTCNT D  Q
"RTN","PSJBCMA5",72,0)
 ...S TXTLN=0 F  S TXTLN=$O(MARX(TXTLN)) Q:'TXTLN  S ^PS(53.45,+PSJSYSP,6,TXTLN,0)=MARX(TXTLN)
"RTN","PSJBCMA5",73,0)
 ..S ^PS(53.45,+PSJSYSP,6,1,0)=$P(^PS(53.1,+ON,9),"^",2),^PS(53.45,+PSJSYSP,6,0)="^^1^1"
"RTN","PSJBCMA5",74,0)
 I ON["V" D
"RTN","PSJBCMA5",75,0)
 .Q:$P($G(^PS(53.45,+PSJSYSP,6,0)),"^",3)
"RTN","PSJBCMA5",76,0)
 .I $P($G(^PS(55,+DFN,"IV",+ON,10,0)),"^",3) D  Q
"RTN","PSJBCMA5",77,0)
 ..S ^PS(53.45,+PSJSYSP,6,0)=$G(^PS(55,DFN,"IV",+ON,10,0))
"RTN","PSJBCMA5",78,0)
 ..S LN=0 F  S LN=$O(^PS(55,DFN,"IV",+ON,10,LN)) Q:'LN  S ^PS(53.45,+PSJSYSP,6,LN,0)=^PS(55,DFN,"IV",+ON,10,LN,0)
"RTN","PSJBCMA5",79,0)
 .N OLDOPI,MARX,TXTCNT S OLDOPI=$P($G(^PS(55,DFN,"IV",+ON,3)),"^") I $L(OLDOPI)>0 D  Q
"RTN","PSJBCMA5",80,0)
 ..I $G(BC),$L(OLDOPI)>74 D TXT^PSGMUTL(OLDOPI,74) S TXTCNT=$O(MARX(" "),-1) S ^PS(53.45,+PSJSYSP,6,0)="^^"_TXTCNT_"^"_TXTCNT D  Q
"RTN","PSJBCMA5",81,0)
 ...S TXTLN=0 F  S TXTLN=$O(MARX(TXTLN)) Q:'TXTLN  S ^PS(53.45,+PSJSYSP,6,TXTLN,0)=MARX(TXTLN)
"RTN","PSJBCMA5",82,0)
 ..S ^PS(53.45,+PSJSYSP,6,1,0)=$P(^PS(55,DFN,"IV",+ON,3),"^"),^PS(53.45,+PSJSYSP,6,0)="^^1^1"
"RTN","PSJBCMA5",83,0)
 I $O(^PS(53.45,+PSJSYSP,6," "),-1)=1,($TR($G(^PS(53.45,+PSJSYSP,6,1,0))," ")="") K ^PS(53.45,+PSJSYSP,6)
"RTN","PSJBCMA5",84,0)
 Q +$P($G(^PS(53.45,+PSJSYSP,6,0)),"^",3)
"RTN","PSJBCMA5",85,0)
 ;
"RTN","PSJBCMA5",86,0)
EDITSI(DFN,PSJORD) ; Edit Special Instructions in ^PS(53.45 via Word Processing
"RTN","PSJBCMA5",87,0)
 N PSJII,DIC,I,PSJVALID,DIWESUB,PSJTXTLN S PSJVALID=0,DIC="^PS(53.45,"_+$G(PSJSYSP)_",5,",DIWESUB="SPECIAL INSTRUCTIONS"
"RTN","PSJBCMA5",88,0)
 I $G(PSJORD) I '$P($G(^PS(53.45,+$G(PSJSYSP),5,0)),"^",5) S L=$$GETSI(DFN,PSJORD)
"RTN","PSJBCMA5",89,0)
 K ^TMP("PSJTMPSI",$J) M ^TMP("PSJTMPSI",$J)=^PS(53.45,+$G(PSJSYSP),5)
"RTN","PSJBCMA5",90,0)
 F PSJII=1:1 Q:$G(PSJVALID)  D
"RTN","PSJBCMA5",91,0)
 .N II,L,DIR,DIE,DA,TMPLN,DR S PSJTXTLN="",PSJVALID=1,DIWESUB="SPECIAL INSTRUCTIONS"
"RTN","PSJBCMA5",92,0)
 .I PSJII=1 S DA=PSJSYSP,DR=5,DIE="^PS(53.45," D ^DIE
"RTN","PSJBCMA5",93,0)
 .I PSJII>1 S DA=PSJSYSP,DR=5,DIC="^PS(53.45,"_+$G(PSJSYSP)_",5," D EN^DIWE
"RTN","PSJBCMA5",94,0)
 .S PSJTXTLN=+$P($G(^PS(53.45,+PSJSYSP,5,0)),"^",3)
"RTN","PSJBCMA5",95,0)
 .S II=0 F  S II=$O(^PS(53.45,+PSJSYSP,5,II)) Q:'II!'$G(PSJVALID)  S TMPLN=$G(^(II,0)) I (TMPLN["^") S PSJVALID=0
"RTN","PSJBCMA5",96,0)
 .I 'PSJVALID W !!!,$C(7),"SPECIAL INSTRUCTIONS must not contain embedded uparrow ""^"". " I PSJII=1 D PAUSE("SPECIAL INSTRUCTIONS")
"RTN","PSJBCMA5",97,0)
 .I 'PSJVALID I PSJII>1 W ! I $$DONE("SPECIAL INSTRUCTIONS") K ^PS(53.45,+PSJSYSP,5) M ^PS(53.45,+$G(PSJSYSP),5)=^TMP("PSJTMPSI",$J) S PSJVALID=1 Q
"RTN","PSJBCMA5",98,0)
 .I PSJVALID I 'PSJTXTLN K ^PS(53.45,+PSJSYSP,5,0) S ^PS(53.45,+PSJSYSP,5,0)="-1^^0^0",^PS(53.45,+PSJSYSP,5,1,0)=""
"RTN","PSJBCMA5",99,0)
 I $P($G(^PS(53.45,+$G(PSJSYSP),5,0)),"^",3) D ENSI^PSJUTL("^PS(53.45,+$G(PSJSYSP),5,") S PSJTXTLN=$O(^PS(53.45,+$G(PSJSYSP),5,""),-1)
"RTN","PSJBCMA5",100,0)
 K ^TMP("PSJTMPSI",$J)
"RTN","PSJBCMA5",101,0)
 Q PSJTXTLN
"RTN","PSJBCMA5",102,0)
 ;
"RTN","PSJBCMA5",103,0)
EDITOPI(PSJDPT,PSJORD) ; Edit Other Print Info in ^PS(53.45 via Word Processing
"RTN","PSJBCMA5",104,0)
 N DIC,I,PSJVALID,DIWESUB,PSJTXTLN S PSJVALID=0,DIC="^PS(53.45,"_+$G(PSJSYSP)_",6,",DIWESUB="OTHER PRINT INFO"
"RTN","PSJBCMA5",105,0)
 K ^TMP("PSJTMPSI",$J) M ^TMP("PSJTMPSI",$J)=^PS(53.45,+$G(PSJSYSP),6)
"RTN","PSJBCMA5",106,0)
 F PSJII=1:1 Q:$G(PSJVALID)  D
"RTN","PSJBCMA5",107,0)
 .N II,L,DIR,DA,DIE,TMPLN S DIR="",PSJTXTLN="",PSJVALID=1,DIWESUB="OTHER PRINT INFO"
"RTN","PSJBCMA5",108,0)
 .I PSJII=1 D OPIWARN(0)
"RTN","PSJBCMA5",109,0)
 .S PSJTXTLN=""
"RTN","PSJBCMA5",110,0)
 .I PSJII=1 S DA=PSJSYSP,DR=6,DIE="^PS(53.45," D ^DIE
"RTN","PSJBCMA5",111,0)
 .I PSJII>1 S DA=PSJSYSP,DR=6,DIC="^PS(53.45,"_+$G(PSJSYSP)_",6," D EN^DIWE
"RTN","PSJBCMA5",112,0)
 .S PSJTXTLN=$O(^PS(53.45,+PSJSYSP,6,""),-1)
"RTN","PSJBCMA5",113,0)
 .I PSJTXTLN="" K ^PS(53.45,+PSJSYSP,6) S ^PS(53.45,+PSJSYSP,6,0)="-1^^1^1",^PS(53.45,+PSJSYSP,6,1,0)=""
"RTN","PSJBCMA5",114,0)
 .S II=0 F  S II=$O(^PS(53.45,+PSJSYSP,6,II)) Q:'II!'$G(PSJVALID)  S TMPLN=$G(^(II,0)) I (TMPLN["^") S PSJVALID=0
"RTN","PSJBCMA5",115,0)
 .I 'PSJVALID W !!!,$C(7),"OTHER PRINT INFO must not contain embedded uparrow ""^""." I PSJII=1 D PAUSE("OTHER PRINT INFO")
"RTN","PSJBCMA5",116,0)
 .I 'PSJVALID I PSJII>1 W ! I $$DONE("OTHER PRINT INFO") K ^PS(53.45,+PSJSYSP,6) M ^PS(53.45,+$G(PSJSYSP),6)=^TMP("PSJTMPSI",$J) S PSJVALID=1 Q
"RTN","PSJBCMA5",117,0)
 .I PSJVALID D
"RTN","PSJBCMA5",118,0)
 ..I ($L($G(^PS(53.45,+PSJSYSP,6,1,0)))>60) D OPIWARN(1) S P("OPI")="Instructions too long. See Order View or BCMA for full text^"_$P(P("OPI"),"^",2) Q
"RTN","PSJBCMA5",119,0)
 ..I PSJTXTLN=1,($L($G(^PS(53.45,+PSJSYSP,6,1,0)))<61) S P("OPI")=^PS(53.45,+PSJSYSP,6,1,0)_"^"_$P(P("OPI"),"^",2) Q
"RTN","PSJBCMA5",120,0)
 ..N TXT,OPIMSG,PSJTMPTX,PSJOVRMX S OPIMSG="Instructions too long. See Order View or BCMA for full text."
"RTN","PSJBCMA5",121,0)
 ..S PSJTMPTX="",PSJOVRMX=0 S TMPLIN=0 F  S TMPLIN=$O(^PS(53.45,+PSJSYSP,6,TMPLIN)) Q:'TMPLIN!(PSJOVRMX)  D
"RTN","PSJBCMA5",122,0)
 ...S:($L(PSJTMPTX)+$L($G(^PS(53.45,+PSJSYSP,6,TMPLIN,0))))>60 PSJOVRMX=1 Q:$G(PSJOVRMX)  S PSJTMPTX=$G(PSJTMPTX)_$S($G(PSJTMPTX)]"":" ",1:"")_$G(^PS(53.45,+PSJSYSP,6,TMPLIN,0))
"RTN","PSJBCMA5",123,0)
 ..I '$G(PSJOVRMX),(PSJTMPTX]"") S P("OPI")=PSJTMPTX_"^"_$P(P("OPI"),"^",2)
"RTN","PSJBCMA5",124,0)
 K ^TMP("PSJTMPSI",$J)
"RTN","PSJBCMA5",125,0)
 Q PSJTXTLN
"RTN","PSJBCMA5",126,0)
 ;
"RTN","PSJBCMA5",127,0)
OPIWARN(AFTER) ; Warn user about OPI not printing on IV labels
"RTN","PSJBCMA5",128,0)
 D OPIWARN^PSJBCMA1(AFTER)
"RTN","PSJBCMA5",129,0)
 Q
"RTN","PSJBCMA5",130,0)
 ;
"RTN","PSJBCMA5",131,0)
FILESI(DFN,PSJORD) ; File Special instructions from ^PS(53.45 to UD order
"RTN","PSJBCMA5",132,0)
 N LN,LNCNT,DA,DIE,X,Y,PSJTMPTX,TMPLIN,PSJOVRMX
"RTN","PSJBCMA5",133,0)
 D FILESI^PSJBCMA2(DFN,PSJORD)
"RTN","PSJBCMA5",134,0)
 ;K ^PS(53.45,+$G(PSJSYSP),5)
"RTN","PSJBCMA5",135,0)
 Q
"RTN","PSJBCMA5",136,0)
 ;
"RTN","PSJBCMA5",137,0)
FILEOPI(DFN,ORDER) ; File Other Print Info from ^PS(53.45 to IV order
"RTN","PSJBCMA5",138,0)
 N LN,LNCNT,PSJORD S PSJORD=ORDER
"RTN","PSJBCMA5",139,0)
 D FILEOPI^PSJBCMA2(DFN,ORDER)
"RTN","PSJBCMA5",140,0)
 K ^PS(53.45,+PSJSYSP,6)
"RTN","PSJBCMA5",141,0)
 Q
"RTN","PSJBCMA5",142,0)
 ;
"RTN","PSJBCMA5",143,0)
DIFFSI(DFN,PSJORD) ; Compare Special Instructions, pre and post edit
"RTN","PSJBCMA5",144,0)
 N LN,DIFF S DIFF=0
"RTN","PSJBCMA5",145,0)
 S LN=0 F  S LN=$O(^PS(53.45,PSJSYSP,5,LN)) Q:'LN!DIFF  D
"RTN","PSJBCMA5",146,0)
 .I PSJORD["U" D
"RTN","PSJBCMA5",147,0)
 ..I LN=1 N OTOT,NTOT S OTOT=+$O(^PS(55,DFN,5,+PSJORD,15,""),-1),NTOT=+$O(^PS(53.45,PSJSYSP,5,""),-1) I NTOT'=OTOT S DIFF=1 Q
"RTN","PSJBCMA5",148,0)
 ..I $G(^PS(53.45,PSJSYSP,5,LN,0))'=$G(^PS(55,DFN,5,+PSJORD,15,LN,0)) S DIFF=1
"RTN","PSJBCMA5",149,0)
 .I PSJORD["P" D
"RTN","PSJBCMA5",150,0)
 ..I LN=1 N OTOT,NTNT S OTOT=+$O(^PS(53.1,+PSJORD,15,""),-1),NTOT=+$O(^PS(53.45,PSJSYSP,5,""),-1) I NTOT'=OTOT S DIFF=1 Q
"RTN","PSJBCMA5",151,0)
 ..I $G(^PS(53.45,PSJSYSP,5,LN,0))'=$G(^PS(53.1,+PSJORD,15,LN,0)) S DIFF=1
"RTN","PSJBCMA5",152,0)
 Q $S(DIFF:1,1:0)
"RTN","PSJBCMA5",153,0)
 ;
"RTN","PSJBCMA5",154,0)
DIFFOPI(DFN,PSJORD) ; Compare Other Print Info, pre and post edit
"RTN","PSJBCMA5",155,0)
 N LN,DIFF S DIFF=0
"RTN","PSJBCMA5",156,0)
 S LN=0 F  S LN=$O(^PS(53.45,PSJSYSP,6,LN)) Q:'LN!DIFF  D
"RTN","PSJBCMA5",157,0)
 .I PSJORD["V" D
"RTN","PSJBCMA5",158,0)
 ..I LN=1 N OTOT,NTOT S OTOT=+$O(^PS(55,DFN,"IV",+PSJORD,10,""),-1),NTOT=+$O(^PS(53.45,PSJSYSP,6,""),-1) I NTOT'=OTOT S DIFF=1 Q
"RTN","PSJBCMA5",159,0)
 ..I $G(^PS(53.45,PSJSYSP,6,LN,0))'=$G(^PS(55,DFN,"IV",+PSJORD,10,LN,0)) S DIFF=1
"RTN","PSJBCMA5",160,0)
 .I PSJORD["P" D
"RTN","PSJBCMA5",161,0)
 ..I LN=1 N OTOT,NTOT S OTOT=+$O(^PS(53.1,+PSJORD,16,""),-1),NTOT=+$O(^PS(53.45,PSJSYSP,6,""),-1) I NTOT'=OTOT S DIFF=1 Q
"RTN","PSJBCMA5",162,0)
 ..I $G(^PS(53.45,PSJSYSP,6,LN,0))'=$G(^PS(53.1,+PSJORD,16,LN,0)) S DIFF=1
"RTN","PSJBCMA5",163,0)
 Q $S(DIFF:1,1:0)
"RTN","PSJBCMA5",164,0)
 ;
"RTN","PSJBCMA5",165,0)
DIFFAR(ARRAY1,ARRAY2) ; Compare two text arrays
"RTN","PSJBCMA5",166,0)
 N LN,DIFF,OTOT,NTOT S DIFF=0,OTOT=0,NTOT=0
"RTN","PSJBCMA5",167,0)
 S LN=0 F  S LN=$O(ARRAY1(LN)) Q:'LN!DIFF  I ARRAY1(LN,0)'=$G(ARRAY2(LN,0)) S DIFF=1
"RTN","PSJBCMA5",168,0)
 Q $S(DIFF:1,1:0)
"RTN","PSJBCMA5",169,0)
 ;
"RTN","PSJBCMA5",170,0)
MVOPI(DFN,PSJI1,PSJI2) ; Move OPI from Non-Verified order to Active order during Verify
"RTN","PSJBCMA5",171,0)
 Q:'$G(DFN)!'$G(PSJI1)!'$G(PSJI2)
"RTN","PSJBCMA5",172,0)
 I PSJI1["P",PSJI2["V" D GETOPI(DFN,PSJI1),FILEOPI(DFN,PSJI2)
"RTN","PSJBCMA5",173,0)
 Q
"RTN","PSJBCMA5",174,0)
 ;
"RTN","PSJBCMA5",175,0)
MVOPIAL(DFN,PSJI1,PSJI2) ; Move Other Print Info Activity log entries from NV order to Active order, during Verification
"RTN","PSJBCMA5",176,0)
 D MVOPIAL^PSJBCMA1(DFN,PSJI1,PSJI2)
"RTN","PSJBCMA5",177,0)
 Q
"RTN","PSJBCMA5",178,0)
 ;
"RTN","PSJBCMA5",179,0)
KILL(USR) ; Clean up ^PS(53.45
"RTN","PSJBCMA5",180,0)
 K ^PS(53.45,+$G(USR),5),^PS(53.45,+$G(USR),6)
"RTN","PSJBCMA5",181,0)
 Q
"RTN","PSJBCMA5",182,0)
 ;
"RTN","PSJBCMA5",183,0)
PAUSE(DEF) ;
"RTN","PSJBCMA5",184,0)
 K DIR W ! S DIR(0)="EA",DIR("A")="Press Return to continue editing "_$G(DEF)_"...",DIR("?")="Press Return to continue..." D ^DIR W !
"RTN","PSJBCMA5",185,0)
 Q
"RTN","PSJBCMA5",186,0)
 ;
"RTN","PSJBCMA5",187,0)
DONE(DEF) ; -- Done editing?
"RTN","PSJBCMA5",188,0)
 N DIR,X,Y
"RTN","PSJBCMA5",189,0)
 S DIR(0)="YA",DIR("A")="Do you want to quit and discard changes"_$S(($G(DEF)]""):" to "_DEF,1:"")_"? ",DIR("B")="NO"
"RTN","PSJBCMA5",190,0)
 S DIR("?",1)="    Enter YES to exit without saving changes, or ",DIR("?")="    enter NO to continue editing "_$S(($G(DEF)]""):DEF,1:"")_"."
"RTN","PSJBCMA5",191,0)
 D ^DIR
"RTN","PSJBCMA5",192,0)
 Q $S($E(Y)="^":1,1:+Y)
"VER")
8.0^22.2
"BLD",11363,6)
^327
**END**
**END**

