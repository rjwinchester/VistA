Released PSJ*5*377 SEQ #322
Extracted from mail message
**KIDS**:PSJ*5.0*377^

**INSTALL NAME**
PSJ*5.0*377
"BLD",11243,0)
PSJ*5.0*377^INPATIENT MEDICATIONS^0^3181008^y
"BLD",11243,1,0)
^^3^3^3181004^
"BLD",11243,1,1,0)
This patch addresses one issue:
"BLD",11243,1,2,0)
 
"BLD",11243,1,3,0)
VistA IV Quick Code schedule issue
"BLD",11243,4,0)
^9.64PA^^
"BLD",11243,6.3)
2
"BLD",11243,"KRN",0)
^9.67PA^779.2^20
"BLD",11243,"KRN",.4,0)
.4
"BLD",11243,"KRN",.401,0)
.401
"BLD",11243,"KRN",.402,0)
.402
"BLD",11243,"KRN",.403,0)
.403
"BLD",11243,"KRN",.5,0)
.5
"BLD",11243,"KRN",.84,0)
.84
"BLD",11243,"KRN",3.6,0)
3.6
"BLD",11243,"KRN",3.8,0)
3.8
"BLD",11243,"KRN",9.2,0)
9.2
"BLD",11243,"KRN",9.8,0)
9.8
"BLD",11243,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",11243,"KRN",9.8,"NM",1,0)
PSIVQUI^^0^B22141976
"BLD",11243,"KRN",9.8,"NM","B","PSIVQUI",1)

"BLD",11243,"KRN",19,0)
19
"BLD",11243,"KRN",19.1,0)
19.1
"BLD",11243,"KRN",101,0)
101
"BLD",11243,"KRN",409.61,0)
409.61
"BLD",11243,"KRN",771,0)
771
"BLD",11243,"KRN",779.2,0)
779.2
"BLD",11243,"KRN",870,0)
870
"BLD",11243,"KRN",8989.51,0)
8989.51
"BLD",11243,"KRN",8989.52,0)
8989.52
"BLD",11243,"KRN",8994,0)
8994
"BLD",11243,"KRN","B",.4,.4)

"BLD",11243,"KRN","B",.401,.401)

"BLD",11243,"KRN","B",.402,.402)

"BLD",11243,"KRN","B",.403,.403)

"BLD",11243,"KRN","B",.5,.5)

"BLD",11243,"KRN","B",.84,.84)

"BLD",11243,"KRN","B",3.6,3.6)

"BLD",11243,"KRN","B",3.8,3.8)

"BLD",11243,"KRN","B",9.2,9.2)

"BLD",11243,"KRN","B",9.8,9.8)

"BLD",11243,"KRN","B",19,19)

"BLD",11243,"KRN","B",19.1,19.1)

"BLD",11243,"KRN","B",101,101)

"BLD",11243,"KRN","B",409.61,409.61)

"BLD",11243,"KRN","B",771,771)

"BLD",11243,"KRN","B",779.2,779.2)

"BLD",11243,"KRN","B",870,870)

"BLD",11243,"KRN","B",8989.51,8989.51)

"BLD",11243,"KRN","B",8989.52,8989.52)

"BLD",11243,"KRN","B",8994,8994)

"BLD",11243,"QDEF")
^^^^NO^^^^^^NO
"BLD",11243,"QUES",0)
^9.62^^
"BLD",11243,"REQB",0)
^9.611^1^1
"BLD",11243,"REQB",1,0)
PSJ*5.0*256^2
"BLD",11243,"REQB","B","PSJ*5.0*256",1)

"MBREQ")
0
"PKG",471,-1)
1^1
"PKG",471,0)
INPATIENT MEDICATIONS^PSJ^UNIT DOSE AND IVS
"PKG",471,20,0)
^9.402P^^
"PKG",471,22,0)
^9.49I^1^1
"PKG",471,22,1,0)
5.0^2971215^2990325^66481
"PKG",471,22,1,"PAH",1,0)
377^3181008
"PKG",471,22,1,"PAH",1,1,0)
^^3^3^3181008
"PKG",471,22,1,"PAH",1,1,1,0)
This patch addresses one issue:
"PKG",471,22,1,"PAH",1,1,2,0)
 
"PKG",471,22,1,"PAH",1,1,3,0)
VistA IV Quick Code schedule issue
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","PSIVQUI")
0^1^B22141976^B21879458
"RTN","PSIVQUI",1,0)
PSIVQUI ;BIR/RGY,MLM - HANDLE QUICK CODE ENTRIES ;15 Dec 98 / 8:29 AM
"RTN","PSIVQUI",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**21,50,65,73,76,93,104,110,275,256,377**;16 DEC 97;Build 2
"RTN","PSIVQUI",3,0)
 ;
"RTN","PSIVQUI",4,0)
 ;Reference to ^PS(51.1 is supported by DBIA 2177
"RTN","PSIVQUI",5,0)
 ;Reference to ^PS(51.2 is supported by DBIA 2178
"RTN","PSIVQUI",6,0)
 ;Reference to ^PS(52.6 is supported by DBIA 1231
"RTN","PSIVQUI",7,0)
 ;Reference to ^PS(52.7 is supported by DBIA 2173
"RTN","PSIVQUI",8,0)
 ;
"RTN","PSIVQUI",9,0)
 N X,PSIVSC1 S (PSIVAT,PSIVAAT,PSIVWAT)="",PSIVQUIY=Y,(X,PSIVQUIX)=PSIVX
"RTN","PSIVQUI",10,0)
 Q:'Y!(PSIVQUIX="")  S PSIVX0=$O(^PS(52.6,"C",X,+Y,0)),PSIVX0=$G(^PS(52.6,+Y,1,PSIVX0,0))
"RTN","PSIVQUI",11,0)
 I $P(PSIVX0,"^",5)]""!$P(PSIVX0,"^",6)!(P(5)) S PSIVAAT=$P(PSIVX0,"^",6)
"RTN","PSIVQUI",12,0)
 K PSIVX0 S Y=PSIVQUIY,Y(0)=$G(^PS(52.6,+Y,0)),X=PSIVQUIX
"RTN","PSIVQUI",13,0)
 Q:$S('$D(X):1,'$D(^PS(52.6,"C",X)):1,1:0)!'$D(P(4))
"RTN","PSIVQUI",14,0)
SET K DRG S PSIVX0=$S($D(^PS(52.6,+Y,1,+$O(^PS(52.6,"C",X,+Y,0)),0)):^(0),1:""),(DRGI,DRG("AD",0))=1,TDRG("AD",+Y,DRGI)="",DRG("AD",DRGI)=+Y_U_$P(Y(0),U)_U_$P(PSIVX0,"^",2)_U_U_$P(Y(0),U,13)_U_$P(Y(0),U,11)
"RTN","PSIVQUI",15,0)
 N PSIVQZ,PSIVADD0,PSIVSZ,PSIVAZ,PSIVXAT,PSIVSIEN,PSIVXW S PSIVSIEN=0
"RTN","PSIVQUI",16,0)
 ;*** PSJ*5*256
"RTN","PSIVQUI",17,0)
 I $P(PSIVX0,"^",5)]"" D  Q:$G(PSGORQF)
"RTN","PSIVQUI",18,0)
 . NEW PSJOLDNM
"RTN","PSIVQUI",19,0)
 . S PSJOLDNM("ORD_SCHD")=$P(PSIVX0,"^",5)
"RTN","PSIVQUI",20,0)
 . I $$CHKSCHD^PSJMISC2(.PSJOLDNM) S PSGORQF=1,DONE=1 Q
"RTN","PSIVQUI",21,0)
 . S:$G(PSJOLDNM("NEW_SCHD"))]"" $P(PSIVX0,"^",5)=PSJOLDNM("NEW_SCHD"),$P(PSIVX0,"^",6)=""
"RTN","PSIVQUI",22,0)
 . S P(9)=$P(PSIVX0,"^",5)  ;377
"RTN","PSIVQUI",23,0)
 I $P(PSIVX0,U,4)]"" S P("OPI")=$P(PSIVX0,U,4) K ^PS(53.45,+$G(PSJSYSP),6) S ^PS(53.45,+$G(PSJSYSP),6,0)="^^1^1^",^(1,0)=P("OPI")
"RTN","PSIVQUI",24,0)
 I $P(PSIVX0,U,7)?1N.N D  Q:$G(PSGORQF)
"RTN","PSIVQUI",25,0)
 . S ND=$G(^PS(52.7,$P(PSIVX0,U,7),0))
"RTN","PSIVQUI",26,0)
 . W !!,"SOLUTION: ",$P(ND,U),!
"RTN","PSIVQUI",27,0)
 . N FIL S FIL="52.7",DRGTMP=$P(PSIVX0,U,7) D ORDERCHK^PSIVEDRG(DFN,ON55,1)
"RTN","PSIVQUI",28,0)
 . I $G(PSGORQF) S X="^",DONE=1 Q
"RTN","PSIVQUI",29,0)
 . S DRG("SOL",0)=1,DRG("SOL",1)=$P(PSIVX0,U,7)_U_$P(ND,U)_U_$P(ND,U,3)_U_U_$P(ND,U,13)_U_$P(ND,U,11),TDRG("SOL",$P(PSIVX0,U,7),1)=""
"RTN","PSIVQUI",30,0)
 I $P(PSIVX0,U,5)]""!P(5) S X=$P(PSIVX0,U,5)
"RTN","PSIVQUI",31,0)
 S PSIVQZ=$P(PSIVX0,U,5),PSIVQAZ=$P(PSIVX0,U,6),PSIVADD0=$G(^PS(52.6,+PSIVQUIY,0)),X=PSIVQZ
"RTN","PSIVQUI",32,0)
 S PSIVSZ=$P(PSIVADD0,"^",5),PSIVAZ=$P(PSIVADD0,"^",6)
"RTN","PSIVQUI",33,0)
 S PSIVAAT=$S(PSIVQZ]""&(PSIVQAZ]""):PSIVQAZ,PSIVQZ=""&(PSIVSZ]""):PSIVAZ,PSIVQZ=PSIVSZ:PSIVAZ,1:"")
"RTN","PSIVQUI",34,0)
 I $P(PSIVX0,U,5)']""!P(5) S X=$S(X]"":X,1:$P($G(^PS(52.6,+PSIVQUIY,0)),"^",5))
"RTN","PSIVQUI",35,0)
 ;
"RTN","PSIVQUI",36,0)
 ; If a sched was found, check all matching schedules 
"RTN","PSIVQUI",37,0)
 ; in 51.1 against $P(PSIVX0,"^",5), PSIVAAT, PSIVWAT
"RTN","PSIVQUI",38,0)
 I PSIVQZ]"",$G(X)'="" S ZZ=0 D
"RTN","PSIVQUI",39,0)
 .;if ZZ sched/times matches quick code sched/times, use the schedule
"RTN","PSIVQUI",40,0)
 .F  S ZZ=$O(^PS(51.1,"AC","PSJ",X,ZZ)) Q:'ZZ!PSIVSIEN  D  Q:PSIVSIEN
"RTN","PSIVQUI",41,0)
 ..N PSIVXAT S PSIVXAT=$P(^PS(51.1,ZZ,0),"^",2) Q:PSIVXAT=""
"RTN","PSIVQUI",42,0)
 ..I PSIVXAT=$P(PSIVX0,"^",6) S PSIVAT=$P(PSIVX0,"^",6),PSIVSIEN=ZZ
"RTN","PSIVQUI",43,0)
 ;
"RTN","PSIVQUI",44,0)
 ; If quick code has no schedule, check IV additive
"RTN","PSIVQUI",45,0)
 I PSIVAT="",$P(PSIVX0,"^",5)="",$G(X)'="" S ZZ=0 D 
"RTN","PSIVQUI",46,0)
 .F  S ZZ=$O(^PS(51.1,"AC","PSJ",X,ZZ)) Q:'ZZ!PSIVSIEN  D  Q:PSIVSIEN
"RTN","PSIVQUI",47,0)
 ..N PSIVXAT S PSIVXAT=$P(^PS(51.1,ZZ,0),"^",2) Q:PSIVXAT=""
"RTN","PSIVQUI",48,0)
 ..I PSIVAAT=PSIVXAT,(X=PSIVSZ) S PSIVAT=PSIVAAT,PSIVSIEN=ZZ
"RTN","PSIVQUI",49,0)
 .I PSIVAT="",PSIVAAT]"" S PSIVAT=PSIVAAT,$P(PSIVX0,"^",6)=PSIVAAT,$P(PSIVX0,"^",5)=PSIVSZ,PSIVSIEN=-1
"RTN","PSIVQUI",50,0)
 ;
"RTN","PSIVQUI",51,0)
 ; If quick code has schedule, no admin times, use ward times
"RTN","PSIVQUI",52,0)
 I PSIVAT="",PSIVQZ]"",$G(X)'="" D
"RTN","PSIVQUI",53,0)
 .S PSIVXW=$S($G(WSCHADM):WSCHADM,$G(VAIN(4)):+VAIN(4),1:"") Q:'PSIVXW
"RTN","PSIVQUI",54,0)
 .S ZZ=0 F  S ZZ=$O(^PS(51.1,"AC","PSJ",X,ZZ)) Q:'ZZ!PSIVSIEN  D  Q:PSIVSIEN
"RTN","PSIVQUI",55,0)
 ..N PSIVXAT S PSIVXAT=$P(^PS(51.1,ZZ,0),"^",2) Q:PSIVXAT=""
"RTN","PSIVQUI",56,0)
 ..S PSIVWAT=$P($G(^PS(51.1,ZZ,1,+PSIVXW,0)),"^",2)
"RTN","PSIVQUI",57,0)
 ..I PSIVWAT]"" S PSIVAT=PSIVWAT,PSIVSIEN=ZZ
"RTN","PSIVQUI",58,0)
 ;
"RTN","PSIVQUI",59,0)
 ; No ward times; go back to IV additive. If quick code has schedule,
"RTN","PSIVQUI",60,0)
 ; make sure it matches IV additive
"RTN","PSIVQUI",61,0)
 I PSIVAT="",PSIVAAT]"",PSIVWAT="",$G(X) D
"RTN","PSIVQUI",62,0)
 .S ZZ=0 F  S ZZ=$O(^PS(51.1,"AC","PSJ",X,ZZ)) Q:'ZZ!PSIVSIEN  D  Q:PSIVSIEN
"RTN","PSIVQUI",63,0)
 ..N PSIVXAT S PSIVXAT=$P(^PS(51.1,ZZ,0),"^",2) Q:PSIVXAT=""
"RTN","PSIVQUI",64,0)
 ..I (PSIVQZ=X&(PSIVQZ=PSIVSZ))!(PSIVQZ=""&(PSIVSZ]"")) I PSIVXAT=PSIVAAT D  Q
"RTN","PSIVQUI",65,0)
 ...S PSIVAT=PSIVAAT,PSIVSIEN=ZZ
"RTN","PSIVQUI",66,0)
 .I PSIVAT="" S PSIVAT=PSIVAAT,$P(PSIVX0,"^",6)=PSIVAAT,$P(PSIVX0,"^",5)=X,PSIVSIEN=-1
"RTN","PSIVQUI",67,0)
 I $G(PSIVSIEN) S Y=$S(PSIVSIEN>0:PSIVSIEN,1:"") N PSGOES S PSGOES=1
"RTN","PSIVQUI",68,0)
 I X="" S (Y,PSIVQUIY)=""
"RTN","PSIVQUI",69,0)
 S PSIVSPQF=1 D EN^PSIVSP K PSIVSPQF
"RTN","PSIVQUI",70,0)
 S P(11)=$S($G(PSGS0Y)]"":PSGS0Y,$P(PSIVX0,"^",6)]"":$P(PSIVX0,"^",6),(PSIVQZ]""&(PSIVWAT]"")):PSIVWAT,PSIVAAT]"":PSIVAAT,$G(P(11))]"":$G(P(11)),1:PSIVAT)
"RTN","PSIVQUI",71,0)
 S X=$P(PSIVX0,"^",3)
"RTN","PSIVQUI",72,0)
 I $P(PSIVX0,U,8) D
"RTN","PSIVQUI",73,0)
 .S P("MR")=+$P(PSIVX0,U,8)_U_$S($P($G(^PS(51.2,+$P(PSIVX0,U,8),0)),U,3):$P($G(^PS(51.2,+$P(PSIVX0,U,8),0)),U,3),1:$E($P($G(^PS(51.2,+$P(PSIVX0,U,8),0)),U),1,5))
"RTN","PSIVQUI",74,0)
 W " ",X D ENI^PSIVSP I '$D(X) W $C(7),"  --> Invalid infusion rate !!" I '$$SCHREQ^PSJLIVFD(.P) S P(15)=0
"RTN","PSIVQUI",75,0)
 I $$SCHREQ^PSJLIVFD(.P),'$$DOW^PSIVUTL($G(P(9))),'(P(15)>0) S P(15)=$$INTERVAL^PSIVUTL(.P)
"RTN","PSIVQUI",76,0)
 S PSIVOK="57^58^59^3^26^39^63^64^"_$S($E(P("OT"))="I":"101^109^",1:"")_"10^25^1"
"RTN","PSIVQUI",77,0)
 S P(17)="A",P(8)=$S($D(X):X,1:""),PSIVE=0,PSIVSTR="QUICK CODE",(DRG(2),Y)="",EDIT=$S(+P("MR"):"",1:"3^")_$P(EDIT,"64^",2) K ND,PSIVX0,PSIVSC,PSIVX
"RTN","PSIVQUI",78,0)
 Q
"VER")
8.0^22.2
"BLD",11243,6)
^322
**END**
**END**

