Released PSJ*5*290 SEQ #265
Extracted from mail message
**KIDS**:PSJ*5.0*290^

**INSTALL NAME**
PSJ*5.0*290
"BLD",9226,0)
PSJ*5.0*290^INPATIENT MEDICATIONS^0^3150106^y
"BLD",9226,1,0)
^^7^7^3140924^
"BLD",9226,1,1,0)
This patch will correct the following issues:
"BLD",9226,1,2,0)
  
"BLD",9226,1,3,0)
'...Order deleted' was display in the ListMan order view for a 
"BLD",9226,1,4,0)
non-verified IV when entering a new order, but no order was or should be 
"BLD",9226,1,5,0)
deleted.
"BLD",9226,1,6,0)
 
"BLD",9226,1,7,0)
Last Transferred field not updating when last movement is deleted.
"BLD",9226,4,0)
^9.64PA^^
"BLD",9226,6.3)
16
"BLD",9226,"ABPKG")
n
"BLD",9226,"KRN",0)
^9.67PA^779.2^20
"BLD",9226,"KRN",.4,0)
.4
"BLD",9226,"KRN",.401,0)
.401
"BLD",9226,"KRN",.402,0)
.402
"BLD",9226,"KRN",.403,0)
.403
"BLD",9226,"KRN",.5,0)
.5
"BLD",9226,"KRN",.84,0)
.84
"BLD",9226,"KRN",3.6,0)
3.6
"BLD",9226,"KRN",3.8,0)
3.8
"BLD",9226,"KRN",9.2,0)
9.2
"BLD",9226,"KRN",9.8,0)
9.8
"BLD",9226,"KRN",9.8,"NM",0)
^9.68A^4^2
"BLD",9226,"KRN",9.8,"NM",3,0)
PSIVORE2^^0^B15145270
"BLD",9226,"KRN",9.8,"NM",4,0)
PSJADT^^0^B24019355
"BLD",9226,"KRN",9.8,"NM","B","PSIVORE2",3)

"BLD",9226,"KRN",9.8,"NM","B","PSJADT",4)

"BLD",9226,"KRN",19,0)
19
"BLD",9226,"KRN",19.1,0)
19.1
"BLD",9226,"KRN",101,0)
101
"BLD",9226,"KRN",409.61,0)
409.61
"BLD",9226,"KRN",771,0)
771
"BLD",9226,"KRN",779.2,0)
779.2
"BLD",9226,"KRN",870,0)
870
"BLD",9226,"KRN",8989.51,0)
8989.51
"BLD",9226,"KRN",8989.52,0)
8989.52
"BLD",9226,"KRN",8994,0)
8994
"BLD",9226,"KRN","B",.4,.4)

"BLD",9226,"KRN","B",.401,.401)

"BLD",9226,"KRN","B",.402,.402)

"BLD",9226,"KRN","B",.403,.403)

"BLD",9226,"KRN","B",.5,.5)

"BLD",9226,"KRN","B",.84,.84)

"BLD",9226,"KRN","B",3.6,3.6)

"BLD",9226,"KRN","B",3.8,3.8)

"BLD",9226,"KRN","B",9.2,9.2)

"BLD",9226,"KRN","B",9.8,9.8)

"BLD",9226,"KRN","B",19,19)

"BLD",9226,"KRN","B",19.1,19.1)

"BLD",9226,"KRN","B",101,101)

"BLD",9226,"KRN","B",409.61,409.61)

"BLD",9226,"KRN","B",771,771)

"BLD",9226,"KRN","B",779.2,779.2)

"BLD",9226,"KRN","B",870,870)

"BLD",9226,"KRN","B",8989.51,8989.51)

"BLD",9226,"KRN","B",8989.52,8989.52)

"BLD",9226,"KRN","B",8994,8994)

"BLD",9226,"QDEF")
^^^^NO^^^^NO^^NO
"BLD",9226,"QUES",0)
^9.62^^
"BLD",9226,"REQB",0)
^9.611^3^2
"BLD",9226,"REQB",1,0)
PSJ*5.0*244^2
"BLD",9226,"REQB",3,0)
PSJ*5.0*83^2
"BLD",9226,"REQB","B","PSJ*5.0*244",1)

"BLD",9226,"REQB","B","PSJ*5.0*83",3)

"MBREQ")
0
"PKG",471,-1)
1^1
"PKG",471,0)
INPATIENT MEDICATIONS^PSJ^UNIT DOSE AND IVS
"PKG",471,20,0)
^9.402P^^
"PKG",471,22,0)
^9.49I^1^1
"PKG",471,22,1,0)
5.0^2971215^2990325^66481
"PKG",471,22,1,"PAH",1,0)
290^3150106
"PKG",471,22,1,"PAH",1,1,0)
^^7^7^3150106
"PKG",471,22,1,"PAH",1,1,1,0)
This patch will correct the following issues:
"PKG",471,22,1,"PAH",1,1,2,0)
  
"PKG",471,22,1,"PAH",1,1,3,0)
'...Order deleted' was display in the ListMan order view for a 
"PKG",471,22,1,"PAH",1,1,4,0)
non-verified IV when entering a new order, but no order was or should be 
"PKG",471,22,1,"PAH",1,1,5,0)
deleted.
"PKG",471,22,1,"PAH",1,1,6,0)
 
"PKG",471,22,1,"PAH",1,1,7,0)
Last Transferred field not updating when last movement is deleted.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
2
"RTN","PSIVORE2")
0^3^B15145270^B13789762
"RTN","PSIVORE2",1,0)
PSIVORE2 ;BIR/RGY,PR,MLM-ACT, NEW ORDER (CONT. OF PSIVORE1) ; 8/8/08 10:57am
"RTN","PSIVORE2",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**21,58,101,244,290**;16 DEC 97;Build 16
"RTN","PSIVORE2",3,0)
 ;
"RTN","PSIVORE2",4,0)
 ; References to ^PS(55 supported by DBIA #2191.
"RTN","PSIVORE2",5,0)
 ;
"RTN","PSIVORE2",6,0)
DEQ ;
"RTN","PSIVORE2",7,0)
 S P(4)=$P(^PS(55,DFN,"IV",+ON,0),U,4),ACTION=1,TRACK=4 D ^PSIVLTR D ^PSIVHYPL:P(4)="H",^PSIVLABL:P(4)'="H"
"RTN","PSIVORE2",8,0)
K ;
"RTN","PSIVORE2",9,0)
 S:$D(ZTQUEUED) ZTREQ="@" K PSIVMI,PSI,OD,PSIVEC,PSIVSC,I,PSIVNOL,PSIV1,PSIVA,PSIVDOSE,PSGCNT,PSGSA,PSCT,PDOSE,PDATE,PSIVLABN,UP1,PLAST Q
"RTN","PSIVORE2",10,0)
TL ;
"RTN","PSIVORE2",11,0)
 W ! F X=3:3:24 W "       ",$S($L(X)=1:" ",1:""),X
"RTN","PSIVORE2",12,0)
 W ! F X=1:1:24 W "..:"
"RTN","PSIVORE2",13,0)
 K PSI F X=0:0 S X=$O(^PS(59.5,PSIVSN,2,"AC",P(4),X)) Q:'X  S PSI(+("."_$P(^PS(59.5,PSIVSN,2,X,0),U)))=$S($P($P(^(0),U,6),".")=DT:"*",1:"")
"RTN","PSIVORE2",14,0)
 S PSI=P(4) D TL1
"RTN","PSIVORE2",15,0)
 K PSI S:'$D(PSGSA) PSGSA="" F PSI=1:1 S X=$P(PSGSA," ",PSI) Q:X=""  I X S PSI(X#1)=""
"RTN","PSIVORE2",16,0)
 S PSI="^" D TL1
"RTN","PSIVORE2",17,0)
 D NOW^%DTC S Y=% S PSI(Y#1)="",PSI="N" D TL1 Q
"RTN","PSIVORE2",18,0)
TL1 ;
"RTN","PSIVORE2",19,0)
 W ! S Y="" F X=0:0 S Y=$O(PSI(Y)) Q:'Y  W ?3*$E(Y_"000",2,3)-1+$S($E(Y_"000",4,5)>40:2,$E(Y_"000",4,5)>20:1,1:0),PSI,PSI(Y)
"RTN","PSIVORE2",20,0)
 K PSI Q
"RTN","PSIVORE2",21,0)
C ;
"RTN","PSIVORE2",22,0)
 S SNM=0 F DAT=0:0 S DAT=$O(^PS(55,"PSIVSUS",PSIVSN,DFN,+ON,DAT)) Q:'DAT  S SNM=SNM+$P(^(DAT),U)
"RTN","PSIVORE2",23,0)
 Q
"RTN","PSIVORE2",24,0)
 ;
"RTN","PSIVORE2",25,0)
CONVER(X,Y) ;
"RTN","PSIVORE2",26,0)
 ;***$$FMADD^XLFDT(DT.HH,D,H,M,S) returns the DT.HH+(D,H,M,S)
"RTN","PSIVORE2",27,0)
 ;*I +P(15)>1440 S X=$$FMADD^XLFDT($P(PSGSA," "),"","",(P(15)*(Y-1))) Q X
"RTN","PSIVORE2",28,0)
 I +P(15)>1440 S X=$$CONVER1($P(PSGSA," "),P(15),(Y-1)) Q X
"RTN","PSIVORE2",29,0)
 S PDOSE=X S:Y=2 PDATE=$E($P(PSGSA," "),1,7)
"RTN","PSIVORE2",30,0)
 I $P(PSGSA," ",Y-1)#1'<PDOSE!(P(15)>1440) S X1=PDATE,X2=1 D C^%DTC S PDATE=X,X=X_PDOSE Q X
"RTN","PSIVORE2",31,0)
 S X=PDATE_PDOSE
"RTN","PSIVORE2",32,0)
 Q X
"RTN","PSIVORE2",33,0)
 ;
"RTN","PSIVORE2",34,0)
CONVER1(ORDDT,X,Y)       ;
"RTN","PSIVORE2",35,0)
 ;* This sub-routine is necessary when a schedule such as q36h was
"RTN","PSIVORE2",36,0)
 ;* entered and the Start date is such as T-3@1200.  Without these codes
"RTN","PSIVORE2",37,0)
 ;* instead of schedule due for T@2400 it will display as T+1@0000.
"RTN","PSIVORE2",38,0)
 NEW DAYS,MINS S (DAYS,MINS)=0
"RTN","PSIVORE2",39,0)
 S DAYS=(X*Y)\1440,MINS=(X*Y)#1440
"RTN","PSIVORE2",40,0)
 S X=$$FMADD^XLFDT(ORDDT,DAYS,"",MINS)
"RTN","PSIVORE2",41,0)
 Q X
"RTN","PSIVORE2",42,0)
 ;
"RTN","PSIVORE2",43,0)
INCOMP ; Delete order missing critical information.
"RTN","PSIVORE2",44,0)
 N DIR,PSIVAC W !!,$C(7),"THIS ORDER IS NOT USABLE!",!,"Enter ""D"" to Delete, or ""B"" to Bypass",!
"RTN","PSIVORE2",45,0)
 S DIR(0)="SOA^D:DELETE;B:BYPASS",DIR("A")="ACTION (B/D): ",DIR("??")="^S HELP=""INCOMP"" D ^PSIVHLP2" D ^DIR K DIR Q:Y="B"!$D(DIRUT)  S PSIVAC="N"
"RTN","PSIVORE2",46,0)
 ;
"RTN","PSIVORE2",47,0)
DEL55 ; Delete order from 55.
"RTN","PSIVORE2",48,0)
 I ON55'["V"!($G(P(21))]"") Q
"RTN","PSIVORE2",49,0)
 I $G(^PS(55,DFN,"IV",+ON55,0))=+ON55 NEW PSIVORFA S PSIVORFA=1 ; P290 If only operating on a stub, do not display status message below
"RTN","PSIVORE2",50,0)
 S DIK="^PS(55,"_DFN_",""IV"",",DA(1)=DFN,DA=+ON55 D ^DIK W:'$G(PSIVORFA) $C(7),"...Order ",$S($E($G(PSIVAC),2)="N":"deleted.",1:"unchanged.")
"RTN","PSIVORE2",51,0)
 N DA,DIK,ORIFN S ORIFN=$P($G(^PS(55,DFN,"IV",+ON55,0)),U,21) I ORIFN,$E($G(PSIVAC),2)="N" D EN1^PSJHL2(DFN,"OD",+ON55_"V","ORDER DELETED")
"RTN","PSIVORE2",52,0)
 L -^PS(55,DFN,"IV",+ON55)
"RTN","PSIVORE2",53,0)
 Q
"RTN","PSIVORE2",54,0)
 ;
"RTN","PSIVORE2",55,0)
NEW ; New order entry
"RTN","PSIVORE2",56,0)
 N ON D NEWENT^PSIVORFE S DRGN="",P("IVRM")=+PSIVSN_U_$P($G(^PS(59.5,+PSIVSN,0)),U) ;*PSJ*5*244 - NEW ON
"RTN","PSIVORE2",57,0)
 K DRG,PSGFDX F X="AD","DRG","LF","LFA","CUM","MR","SOL","OPI","OT","SYRS","REM","SI",2,3,4,5,7,8,9,11,12,15,17,23 S:'$D(P(X)) P(X)=""
"RTN","PSIVORE2",58,0)
 S P(17)="A",P(4)=$E($G(PSIVTYPE)) S:"CS"[P(4) P(23)=$P($G(PSIVTYPE),U,2)
"RTN","PSIVORE2",59,0)
 D:P(4)="" 53^PSIVORC1 Q:$G(P(4))=""  S Y=$P($G(^PS(55,DFN,5.1)),U,2),P(6)=Y_U_$P($G(^VA(200,+Y,0)),U)
"RTN","PSIVORE2",60,0)
 D OTYP^PSIVORC1 S PSIVOK="",EDIT="57^58^59^3"_$S(P("DTYP")=1:"^26^39",1:"")_"^63^64^10^25^1"
"RTN","PSIVORE2",61,0)
 D EDIT^PSIVEDT Q:'$G(P(2))  D GTOT^PSIVUTL(P(4)) D:$G(P("PD"))="" GTPD
"RTN","PSIVORE2",62,0)
 Q
"RTN","PSIVORE2",63,0)
 ;
"RTN","PSIVORE2",64,0)
GTPD ; Find Orderable Item/dosage ordered for IM.
"RTN","PSIVORE2",65,0)
 S P("PD")="" F DRGT="AD","SOL" Q:P("PD")  F DRGI=0:0 S DRGI=$O(DRG(DRGT,DRGI)) Q:'DRGI!P("PD")  D
"RTN","PSIVORE2",66,0)
 . S X=DRG(DRGT,DRGI) S:$P(X,U,6) P("PD")=$P(X,U,6)_U_$$OIDF^PSJLMUT1(+$P(X,U,6))
"RTN","PSIVORE2",67,0)
 . S P("DO")=$P(X,U,3)
"RTN","PSIVORE2",68,0)
 . ;S:$G(P("DO"))="" P("DO")=$P(X,U,3)
"RTN","PSIVORE2",69,0)
 Q
"RTN","PSJADT")
0^4^B24019355^B23121742
"RTN","PSJADT",1,0)
PSJADT ;BIR/CML3,MLM-AUTO DC/HOLD ON PATIENT ADT ;24 Aug 98 / 2:01 PM
"RTN","PSJADT",2,0)
 ;;5.0;INPATIENT MEDICATIONS ;**3,30,51,50,83,290**;16 DEC 97;Build 16
"RTN","PSJADT",3,0)
 ;
"RTN","PSJADT",4,0)
 ; Reference to ^PS(55 is supported by DBIA# 2191.
"RTN","PSJADT",5,0)
 ; Reference to ^PS(59.7 is supported by DBIA# 2181.
"RTN","PSJADT",6,0)
 ; Reference to ^DIC(42 is supported by DBIA# 1377.
"RTN","PSJADT",7,0)
 ; Reference to ^UTILITY("DGPM" is supported by DBIA# 1181.
"RTN","PSJADT",8,0)
 ;
"RTN","PSJADT",9,0)
 W:'$D(PSJQUIET)&'$D(DGQUIET) !!,"...Inpatient Medications check..."
"RTN","PSJADT",10,0)
 N PSJDEL,PSJSYSU,PSJSYSL,PSJSYSP,PSJSYSP0,PSJSYSW,PSJSYSW0,VA200,VAIN,VAIP,X D ENCV^PSGSETU
"RTN","PSJADT",11,0)
 K PSJADTWD S PSGP=DFN,(PSJCF,PSJAM,PSJDM,PSJTM,PSJTMT,PSJFW)=0,PSJPIND=$G(^PS(55,PSGP,5.1)),VA200=1,(PSJNOO,P("NAT"))="A"
"RTN","PSJADT",12,0)
 ;Added 1 for Admissions that are deleted to the loop in PSJDEL
"RTN","PSJADT",13,0)
 ;Q:$D(PSJQUIET)  F PSJDEL=2,3 I $G(^UTILITY("DGPM",$J,PSJDEL,DGPMDA,"P")),'$G(^("A")) D ENDEL^PSJADT1(DFN,DGPMP,$P($G(^UTILITY("DGPM",$J,+PSJDEL,"P")),U,18),PSJDEL) S PSJCF=1 Q
"RTN","PSJADT",14,0)
 Q:$D(PSJQUIET)
"RTN","PSJADT",15,0)
 F PSJDEL=1,2,3,6 D
"RTN","PSJADT",16,0)
 .I $G(^UTILITY("DGPM",$J,PSJDEL,DGPMDA,"P")),'$G(^UTILITY("DGPM",$J,PSJDEL,DGPMDA,"A")) D  Q
"RTN","PSJADT",17,0)
 ..D ENDEL^PSJADT1(DFN,DGPMP,$P($G(^UTILITY("DGPM",$J,+PSJDEL,DGPMDA,"P")),U,18),PSJDEL) S PSJCF=1,PSJPIND4=$P(PSJPIND,"^",4) I $G(DGX) D  Q
"RTN","PSJADT",18,0)
 ...S:DGX=PSJPIND4 $P(PSJPIND,"^",4)=+DGPM0
"RTN","PSJADT",19,0)
 D:$G(PSJDEL)=2!$G(PSJDEL)=6 ENUW^PSJADT1 G:PSJCF DONE Q:$D(PSJQUIET)
"RTN","PSJADT",20,0)
 S Y=3 F Q=0:0 S Q=$O(^UTILITY("DGPM",$J,3,Q)) Q:'Q  I $G(^(Q,"A")),$D(^("P")) S PSJDD=^("A") S X=+PSJDD D LC I X S PSJDM=Q,PSJDCA=$P(PSJDD,"^",14),PSJDD=+PSJDD Q
"RTN","PSJADT",21,0)
 S Y=1 F Q=0:0 S Q=$O(^UTILITY("DGPM",$J,1,Q)) Q:'Q  I $G(^(Q,"A")),$D(^("P")),'^("P") S X=+^("A") D LC I X S PSJAM=Q Q
"RTN","PSJADT",22,0)
 I PSJDM S PSJDF=0 D DIS
"RTN","PSJADT",23,0)
 I PSJAM D ADM
"RTN","PSJADT",24,0)
 I PSJCF G DONE
"RTN","PSJADT",25,0)
 ;
"RTN","PSJADT",26,0)
TRN ;
"RTN","PSJADT",27,0)
 S Y=2,Q=0
"RTN","PSJADT",28,0)
 F  S Q=$O(^UTILITY("DGPM",$J,2,Q)) Q:'Q  I $G(^(Q,"A")),$D(^("P")),'^("P") S X=+^("A") D LC I X S PSJTM=Q,$P(PSJPIND,"^",4)=+^UTILITY("DGPM",$J,2,Q,"A"),PSJTMT=$P(^UTILITY("DGPM",$J,2,Q,"A"),"^",18) Q
"RTN","PSJADT",29,0)
 G:'PSJTM DONE I $S('PSJTMT:1,PSJTMT<5:0,PSJTMT>26:1,1:PSJTMT<22) G DONE
"RTN","PSJADT",30,0)
 K VAIP S VAIP("D")="L" D IN5^VADPT S PSJFW=+VAIP(15,4),PSJPAD=+VAIP(13,1)
"RTN","PSJADT",31,0)
 ;Transfer to authorized or unauthorized absence.
"RTN","PSJADT",32,0)
 I PSJTMT<4 S PSGOEHA=$P($G(^PS(59.7,1,22,PSJFW,0)),U,PSJTMT+1) G:PSGOEHA'=1&(PSGOEHA'=2) DONE D  G DONE
"RTN","PSJADT",33,0)
 .I PSGOEHA=1 D ENHOLD^PSJADT1(1,PSJTMT,PSJPAD,$S(PSJTMT=3:8580,1:8570)) Q
"RTN","PSJADT",34,0)
 .S PSGALO=$S(PSJTMT=3:1090,1:1060) D ^PSJADT0
"RTN","PSJADT",35,0)
 ;Return from UA or AA
"RTN","PSJADT",36,0)
 I PSJTMT>21 G:$P(PSJPIND,"^",7)'=2 DONE D  G DONE
"RTN","PSJADT",37,0)
 .S $P(PSJPIND,"^",7)="",$P(PSJPIND,"^",10)="",PSGALO=$S(PSJTMT=22!(PSJTMT=26):8080,1:8070),PSGOEHA=0 D ENHOLD^PSJADT1(0,$S(PSGALO=8080:3,1:2),PSJPAD,PSGALO)
"RTN","PSJADT",38,0)
 G:PSJTMT'=4 DONE S PSJADTWD=PSJFW D INP^VADPT I $D(^PS(59.7,1,22,"AFT",PSJFW,+VAIN(4))) S PSGALO=1080 D ENDC^PSJADT0 G DONE
"RTN","PSJADT",39,0)
 S FS=$S($D(^DIC(42,PSJFW,0)):$P(^(0),"^",3),1:""),TS=$S($D(^DIC(42,+VAIN(4),0)):$P(^(0),"^",3),1:"") I FS]"",TS]"",$D(^PS(59.7,1,23,"AFT",FS,TS)) S PSGALO=1070 D ENDC^PSJADT0 G DONE
"RTN","PSJADT",40,0)
 D ENUW^PSJADT1
"RTN","PSJADT",41,0)
 ;
"RTN","PSJADT",42,0)
DONE ;
"RTN","PSJADT",43,0)
 I '$D(^PS(55,PSGP,0)) D ENSET0^PSGNE3(PSGP) S $P(^PS(55,PSGP,5.1),"^",11)=2 ; Mark as converted for POE
"RTN","PSJADT",44,0)
 S ^PS(55,PSGP,5.1)=PSJPIND,PSJNKF=1
"RTN","PSJADT",45,0)
 K AM,DA,DIE,DIS,DR,FS,ON,ORIFN,PSGAL,PSGALO,PSGALR,PSGOEHA,PSGTOL,PSGTOO,PSGUOW,PSIVLN,PSIVNST,PSIVREA,PSIVRES,PSJADTWD,PSJAM,PSJCF,PSJDA,PSJDD,PSJDCA,PSJDF,PSJDM,PSJFW,PSJIVDCF,PSJIVON,PSJPAD,PSJPDD,PSJPIND,PSJPWD,PSJPWDN
"RTN","PSJADT",46,0)
 K PSJNOO,P("NAT"),PSJS,PSJTM,PSJTMT,N,P,PS,Q1,Q2,RZ,ST,TS,TSCN,Z D ENKV^PSGSETU W:'$D(PSJQUIET)&'$D(DGQUIET) ".done..." Q
"RTN","PSJADT",47,0)
 ;
"RTN","PSJADT",48,0)
DIS ; discharge
"RTN","PSJADT",49,0)
 K VAIP S VAIP("E")=PSJDCA D IN5^VADPT S PSJPAD=+VAIP(13,1),(PSJADTWD,PSJFW)=+VAIP(17,4),PSGALO=$S(PSJDF:1010,1:1030) D ENDC^PSJADT0 S $P(PSJPIND,"^",8)=1,PSJCF=1
"RTN","PSJADT",50,0)
 Q
"RTN","PSJADT",51,0)
 ;
"RTN","PSJADT",52,0)
ADM ; admit
"RTN","PSJADT",53,0)
 ;   ************  old way  **************************
"RTN","PSJADT",54,0)
 ;S $P(PSJPIND,"^",3)=+^UTILITY("DGPM",$J,1,PSJAM,"A"),$P(PSJPIND,"^",4)="",$P(PSJPIND,"^",8)="" Q:PSJCF
"RTN","PSJADT",55,0)
 ;S Q=$O(^DGPM("ATID3",DFN,0)) S:Q Q=$O(^(Q,0)) K VAIP S:Q VAIP("E")=Q S:'Q VAIP("D")="LAST" D IN5^VADPT S PSJPAD=+VAIP(13,1),PSJFW=+VAIP(17,4),PSJADTWD=.5 S PSGALO=1050 D ENDC^PSJADT0 S PSJCF=1
"RTN","PSJADT",56,0)
 ;   ************  new way  **************************
"RTN","PSJADT",57,0)
 S $P(PSJPIND,"^",3)=+^UTILITY("DGPM",$J,1,PSJAM,"A"),$P(PSJPIND,"^",4)="",$P(PSJPIND,"^",8)="" Q:PSJCF
"RTN","PSJADT",58,0)
 D IN5^VADPT S VAIP("E")=VAIP(14) S VAIP("D")="LAST" D IN5^VADPT S PSJPAD=+VAIP(13,1),PSJFW=+VAIP(17,4),PSJADTWD=.5 S PSGALO=1050 D ENDC^PSJADT0 S PSJCF=1
"RTN","PSJADT",59,0)
 Q
"RTN","PSJADT",60,0)
 ;
"RTN","PSJADT",61,0)
LC ; is movement the latest one of its type?
"RTN","PSJADT",62,0)
 ;S X=$E(9999999.9999999-X,1,14),Z=$E($O(^DGPM("ATID"_Y,PSGP,0)),1,14) I Z,X>Z S X=0
"RTN","PSJADT",63,0)
 ; *****************************************************************
"RTN","PSJADT",64,0)
 ; ** NEW WAY **
"RTN","PSJADT",65,0)
 N PSJRSB S PSJRSB("Y")=Y,PSJRSB("X")=X
"RTN","PSJADT",66,0)
 N VAIP S:Y=3 VAIP("D")="L" D IN5^VADPT S Z=+VAIP(3)
"RTN","PSJADT",67,0)
 S X=PSJRSB("X") ; set X again, may have changed during ^VADPT
"RTN","PSJADT",68,0)
 I Z,X<Z S X=0 ; change to x<z because dates are not inverted now
"RTN","PSJADT",69,0)
 S Y=PSJRSB("Y") ; set Y again, may have changed during ^VADPT
"RTN","PSJADT",70,0)
 ; *****************************************************************
"RTN","PSJADT",71,0)
 ; begin PAL-0402-61286
"RTN","PSJADT",72,0)
 I Y=3,$S('^UTILITY("DGPM",$J,3,Q,"P"):0,X>($G(PSGDT)):1,$P(PSJDD,"^",18)=$P(^("P"),"^",18):0,$P(PSJDD,"^",18)=12:0,1:$P(PSJDD,"^",18)'=38) S X=0
"RTN","PSJADT",73,0)
 ;I Y=3,$S('^UTILITY("DGPM",$J,3,Q,"P"):0,$P(PSJDD,"^",18)=$P(^("P"),"^",18):0,$P(PSJDD,"^",18)=12:0,1:$P(PSJDD,"^",18)'=38) S X=0
"RTN","PSJADT",74,0)
 ; end PAL-0402-61286
"RTN","PSJADT",75,0)
 Q
"RTN","PSJADT",76,0)
 ;
"RTN","PSJADT",77,0)
END ; he be dead
"RTN","PSJADT",78,0)
 S DFN=DA N D,DA,DB,DC,DE,DG,DH,DI,DIC,DIE,DIG,DIH,DIK,DIR,DIQ,DIU,DIV,DIW,DK,DL,DM,DP,DR,DQ,DU,DV,DW,D0,D1,D2,MR,NX,VAIN,VAIP
"RTN","PSJADT",79,0)
 ;Naked reference below refers to ^DGPM("ATID1",PSGP,9999999.9999999-X)
"RTN","PSJADT",80,0)
 ; changed to remove ref to ^DGPM
"RTN","PSJADT",81,0)
 ; ** OLD WAY **
"RTN","PSJADT",82,0)
 ;S PSJQUIET=1 D PSJADT S PSJDD=X,PSJDCA=$O(^(+$O(^DGPM("ATID1",PSGP,9999999.9999999-X)),0)),PSJDF=1
"RTN","PSJADT",83,0)
 ; ******************************************************************
"RTN","PSJADT",84,0)
 ; ** NEW WAY **
"RTN","PSJADT",85,0)
 S PSJQUIET=1 D PSJADT S PSJDD=X N VAIP S VAIP("D")=$P(X,".") D IN5^VADPT
"RTN","PSJADT",86,0)
 S PSJDCA=$G(VAIP(13)),PSJDF=1
"RTN","PSJADT",87,0)
 ; ******************************************************************
"RTN","PSJADT",88,0)
 D INP^VADPT,DIS,DONE K PSJQUIET Q
"VER")
8.0^22.0
"BLD",9226,6)
^265
**END**
**END**

