Released PSJ*5*199 SEQ #258
Extracted from mail message
**KIDS**:PSJ*5.0*199^

**INSTALL NAME**
PSJ*5.0*199
"BLD",8736,0)
PSJ*5.0*199^INPATIENT MEDICATIONS^0^3140220^y
"BLD",8736,1,0)
^^9^9^3140220^
"BLD",8736,1,1,0)
This patch will resolve the following 2 issues in the Inpatient 
"BLD",8736,1,2,0)
Medications package:
"BLD",8736,1,3,0)
 
"BLD",8736,1,4,0)
1. On the Pharmacy Unusual Volume Report, when multiple labels are 
"BLD",8736,1,5,0)
   printed, cancelled, returned, or destroyed, the correct data is not
"BLD",8736,1,6,0)
   sent or stored.
"BLD",8736,1,7,0)
 
"BLD",8736,1,8,0)
2. When finishing two unit dose orders together, the frequency of the
"BLD",8736,1,9,0)
   first order is copied to the second order's frequency.
"BLD",8736,4,0)
^9.64PA^^0
"BLD",8736,6)
9^
"BLD",8736,6.3)
25
"BLD",8736,"ABPKG")
n
"BLD",8736,"KRN",0)
^9.67PA^779.2^20
"BLD",8736,"KRN",.4,0)
.4
"BLD",8736,"KRN",.401,0)
.401
"BLD",8736,"KRN",.402,0)
.402
"BLD",8736,"KRN",.403,0)
.403
"BLD",8736,"KRN",.5,0)
.5
"BLD",8736,"KRN",.84,0)
.84
"BLD",8736,"KRN",3.6,0)
3.6
"BLD",8736,"KRN",3.8,0)
3.8
"BLD",8736,"KRN",9.2,0)
9.2
"BLD",8736,"KRN",9.8,0)
9.8
"BLD",8736,"KRN",9.8,"NM",0)
^9.68A^5^3
"BLD",8736,"KRN",9.8,"NM",3,0)
PSGOEF^^0^B99911141
"BLD",8736,"KRN",9.8,"NM",4,0)
PSIVSTAT^^0^B21471707
"BLD",8736,"KRN",9.8,"NM",5,0)
PSGOEV^^0^B81429110
"BLD",8736,"KRN",9.8,"NM","B","PSGOEF",3)

"BLD",8736,"KRN",9.8,"NM","B","PSGOEV",5)

"BLD",8736,"KRN",9.8,"NM","B","PSIVSTAT",4)

"BLD",8736,"KRN",19,0)
19
"BLD",8736,"KRN",19.1,0)
19.1
"BLD",8736,"KRN",101,0)
101
"BLD",8736,"KRN",409.61,0)
409.61
"BLD",8736,"KRN",771,0)
771
"BLD",8736,"KRN",779.2,0)
779.2
"BLD",8736,"KRN",870,0)
870
"BLD",8736,"KRN",8989.51,0)
8989.51
"BLD",8736,"KRN",8989.52,0)
8989.52
"BLD",8736,"KRN",8994,0)
8994
"BLD",8736,"KRN","B",.4,.4)

"BLD",8736,"KRN","B",.401,.401)

"BLD",8736,"KRN","B",.402,.402)

"BLD",8736,"KRN","B",.403,.403)

"BLD",8736,"KRN","B",.5,.5)

"BLD",8736,"KRN","B",.84,.84)

"BLD",8736,"KRN","B",3.6,3.6)

"BLD",8736,"KRN","B",3.8,3.8)

"BLD",8736,"KRN","B",9.2,9.2)

"BLD",8736,"KRN","B",9.8,9.8)

"BLD",8736,"KRN","B",19,19)

"BLD",8736,"KRN","B",19.1,19.1)

"BLD",8736,"KRN","B",101,101)

"BLD",8736,"KRN","B",409.61,409.61)

"BLD",8736,"KRN","B",771,771)

"BLD",8736,"KRN","B",779.2,779.2)

"BLD",8736,"KRN","B",870,870)

"BLD",8736,"KRN","B",8989.51,8989.51)

"BLD",8736,"KRN","B",8989.52,8989.52)

"BLD",8736,"KRN","B",8994,8994)

"BLD",8736,"QDEF")
^^^^NO^^^^^^NO
"BLD",8736,"QUES",0)
^9.62^^
"BLD",8736,"REQB",0)
^9.611^4^2
"BLD",8736,"REQB",3,0)
PSJ*5.0*130^2
"BLD",8736,"REQB",4,0)
PSJ*5.0*288^2
"BLD",8736,"REQB","B","PSJ*5.0*130",3)

"BLD",8736,"REQB","B","PSJ*5.0*288",4)

"MBREQ")
0
"PKG",471,-1)
1^1
"PKG",471,0)
INPATIENT MEDICATIONS^PSJ^UNIT DOSE AND IVS
"PKG",471,20,0)
^9.402P^^
"PKG",471,22,0)
^9.49I^1^1
"PKG",471,22,1,0)
5.0^2971215^2990325^66481
"PKG",471,22,1,"PAH",1,0)
199^3140220^1155
"PKG",471,22,1,"PAH",1,1,0)
^^9^9^3140220
"PKG",471,22,1,"PAH",1,1,1,0)
This patch will resolve the following 2 issues in the Inpatient 
"PKG",471,22,1,"PAH",1,1,2,0)
Medications package:
"PKG",471,22,1,"PAH",1,1,3,0)
 
"PKG",471,22,1,"PAH",1,1,4,0)
1. On the Pharmacy Unusual Volume Report, when multiple labels are 
"PKG",471,22,1,"PAH",1,1,5,0)
   printed, cancelled, returned, or destroyed, the correct data is not
"PKG",471,22,1,"PAH",1,1,6,0)
   sent or stored.
"PKG",471,22,1,"PAH",1,1,7,0)
 
"PKG",471,22,1,"PAH",1,1,8,0)
2. When finishing two unit dose orders together, the frequency of the
"PKG",471,22,1,"PAH",1,1,9,0)
   first order is copied to the second order's frequency.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
3
"RTN","PSGOEF")
0^3^B99911141^B99775279
"RTN","PSGOEF",1,0)
PSGOEF ;BIR/CML3-FINISH ORDERS ENTERED THROUGH OE/RR ;14 May 98 / 2:17 PM
"RTN","PSGOEF",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**7,30,29,35,39,47,50,56,80,116,110,111,133,153,134,222,113,181,260,199**;16 DEC 97;Build 25
"RTN","PSGOEF",3,0)
 ;
"RTN","PSGOEF",4,0)
 ; Reference to ^PS(55 is supported by DBIA 2191
"RTN","PSGOEF",5,0)
 ; Reference to ^PSDRUG( is supported by DBIA 2192
"RTN","PSGOEF",6,0)
 ; Reference to DOSE^PSSORPH is supported by DBIA 3234.
"RTN","PSGOEF",7,0)
 ;
"RTN","PSGOEF",8,0)
START ;
"RTN","PSGOEF",9,0)
 I '$D(^PS(53.1,+PSGORD)) W $C(7),!?3,"Cannot find this pending order (#",+PSGORD,")." Q
"RTN","PSGOEF",10,0)
 D NOW^%DTC S PSGDT=+$E(%,1,12) K PSGFDX,PSGEFN,PSGOEEF,PSGOES,PSGONF,PSGRDTX S PSGOES=1,(PSGOEF,PSGOEEF)=0,PSGOEEG=3
"RTN","PSGOEF",11,0)
 I $D(PSJTUD) S PSGDO=$P($G(^PS(53.1,+PSGORD,.3)),U),(PSGPDRG,PSGPD)=PSJCOI,(PSGPDRGN,PSGPDN)=$$OINAME^PSJLMUTL(PSGPD)
"RTN","PSGOEF",12,0)
 I $P($G(^PS(53.1,+PSGORD,0)),U,24)'="R" S X=PSGSCH D EN^PSGORS0 D
"RTN","PSGOEF",13,0)
 . S:($D(X)&($P($G(^PS(53.1,+PSGORD,2)),"^",5)="")&($P($G(^PS(53.1,+PSGORD,0)),"^",24)="N")) PSGAT=PSGS0Y
"RTN","PSGOEF",14,0)
 . NEW PSJDOX,PSJDOSE,PSJPIECE,PSJUNIT,PSJX,X
"RTN","PSGOEF",15,0)
 . S X=$G(^PS(53.1,+PSGORD,1,1,0)) Q:'+X
"RTN","PSGOEF",16,0)
 . D DOSE^PSSORPH(.PSJDOX,+X,"U")
"RTN","PSGOEF",17,0)
 . I $S('$D(PSJDOX):1,1:+PSJDOX(1)=-1) Q
"RTN","PSGOEF",18,0)
 . S PSJPIECE=$S($P(PSJDOX(1),U)="":3,1:1)
"RTN","PSGOEF",19,0)
 . S X=^PS(53.1,+PSGORD,.2)
"RTN","PSGOEF",20,0)
 . S:PSJPIECE=3 PSJDOSE=$P(X,U,2)
"RTN","PSGOEF",21,0)
 . S:PSJPIECE=1 PSJDOSE=$P(X,U,5),PSJUNIT=$P(X,U,6)
"RTN","PSGOEF",22,0)
 . F X=0:0 S X=$O(PSJDOX(X)) Q:+$G(PSJX)!'X  D
"RTN","PSGOEF",23,0)
 .. I PSJPIECE=3,($P(PSJDOX(X),U,3)'=PSJDOSE) Q
"RTN","PSGOEF",24,0)
 .. I PSJPIECE=1,($P(PSJDOX(X),U,1)_$P(PSJDOX(X),U,2)'=(PSJDOSE_PSJUNIT)) Q
"RTN","PSGOEF",25,0)
 .. S:+$P(PSJDOX(X),U,12) $P(^PS(53.45,PSJSYSP,2,1,0),U,2)=+$P(PSJDOX(X),U,12),PSJX=1
"RTN","PSGOEF",26,0)
 I PSGEB'=PSGOPR F X=7,11 S Y=$T(@(3_X)),@("PSGEFN("_X_")="_$P(Y,";",7)),PSGOEEF(+$P(Y,";",3))="",PSGOEEF=PSGOEEF+1
"RTN","PSGOEF",27,0)
 D GTST^PSGOE6(+PSGORD)
"RTN","PSGOEF",28,0)
 I $P($G(^PS(53.1,+PSGORD,0)),U,24)'="R" S PSGSD="" D:PSGS0Y]""
"RTN","PSGOEF",29,0)
 .N PSJX S PSJX=$P($G(^PS(53.1,+PSGORD,0)),U,25) I PSJX="" Q
"RTN","PSGOEF",30,0)
 .I PSJX["U" S PSGSD=$P($G(^PS(55,DFN,5,+PSJX,2)),U,2) Q
"RTN","PSGOEF",31,0)
 .I PSJX["V" S PSGSD=$P($G(^PS(55,DFN,"IV",+PSJX,0)),U,2) Q
"RTN","PSGOEF",32,0)
 .I PSJX["P" S PSGSD=$P($G(^PS(53.1,+PSJX,2)),U,2)
"RTN","PSGOEF",33,0)
 S:PSGSD="" PSGSD=PSGLI
"RTN","PSGOEF",34,0)
 S PSGNEDFD=$$GTNEDFD^PSGOE7("U",+PSGPD)
"RTN","PSGOEF",35,0)
 S:$P($G(PSGNEDFD),U,3)="" $P(PSGNEDFD,U,3)=PSGST  ; N PSGOEA S PSGOEA="R"
"RTN","PSGOEF",36,0)
 S (PSGNESD,PSGSD)=$$ENSD^PSGNE3(PSGSCH,PSGS0Y,PSGLI,PSGSD)
"RTN","PSGOEF",37,0)
 ;if this is a renewal order, ignore any 'requested start date' received.  Use the system calculated start date.
"RTN","PSGOEF",38,0)
 I $P($G(^PS(53.1,+PSGORD,0)),U,24)'="R" D
"RTN","PSGOEF",39,0)
 . D REQDT^PSJLIVMD(PSGORD)
"RTN","PSGOEF",40,0)
 E  D
"RTN","PSGOEF",41,0)
 . S X=$$DSTART^PSJDCU(DFN,$P(^PS(53.1,+PSGORD,0),U,25)) I X]"" S (PSGNESD,PSGSD)=X K PSGRSD
"RTN","PSGOEF",42,0)
 D   ; Extend the Default Stop Date if needed for the first renewed order.
"RTN","PSGOEF",43,0)
 .N PSGOEAO,PSGWALLO
"RTN","PSGOEF",44,0)
 .I $P($G(^PS(53.1,+PSGORD,0)),U,24)="R" S PSGOEAO=PSGOEA,PSGOEA="R",PSGWALLO=$P(^PS(55,DFN,5.1),U)
"RTN","PSGOEF",45,0)
 .D ENFD^PSGNE3(PSGLI) S PSGFD=$S($G(PSGRDTX(+PSGORD,"PSGFD")):PSGRDTX(+PSGORD,"PSGFD"),1:PSGNEFD)
"RTN","PSGOEF",46,0)
 .I $P($G(^PS(53.1,+PSGORD,0)),U,24)="R" S PSGOEA=PSGOEAO,$P(^PS(55,DFN,5.1),U)=PSGWALLO
"RTN","PSGOEF",47,0)
 N DUR,PSGRNSD S PSGRNSD=+$$LASTREN^PSJLMPRI(DFN,PSGORD) I PSGRNSD S DUR=$$GETDUR^PSJLIVMD(DFN,PSGORD,"P",1) I DUR]"" D
"RTN","PSGOEF",48,0)
 . N DURMIN S DURMIN=$$DURMIN^PSJLIVMD(DUR) I DURMIN S PSGFD=$$FMADD^XLFDT(PSGRNSD,,,DURMIN)
"RTN","PSGOEF",49,0)
 S PSGOFD="",PSGSDN=$$ENDD^PSGMI(PSGSD)_U_$$ENDTC^PSGMI(PSGSD),PSGFDN=$$ENDD^PSGMI(PSGFD)_U_$$ENDTC^PSGMI(PSGFD)
"RTN","PSGOEF",50,0)
 S PSGLIN=$$ENDD^PSGMI(PSGLI)_U_$$ENDTC^PSGMI(PSGLI)
"RTN","PSGOEF",51,0)
 I '$O(^PS(53.45,PSJSYSP,2,0)) N DRG,DRGCNT S DRGCNT=0 D
"RTN","PSGOEF",52,0)
 .F X=0:0 S X=$O(^PSDRUG("ASP",+PSGPD,X)) Q:'X!(DRGCNT>1)  S:$P($G(^PSDRUG(+X,2)),U,3)["U" DRGCNT=DRGCNT+1,DRG=+X
"RTN","PSGOEF",53,0)
 .I DRGCNT=1 K ^PS(53.45,PSJSYSP,2) S ^PS(53.45,PSJSYSP,2,1,0)=DRG_U_1,^PS(53.45,PSJSYSP,2,0)="^53.4502^1^1",PS(53.45,PSJSYSP,2,"B",+DRG,1)=""
"RTN","PSGOEF",54,0)
 Q
"RTN","PSGOEF",55,0)
FINISH ;
"RTN","PSGOEF",56,0)
 ; force display of second screen if CPRS order checks exist
"RTN","PSGOEF",57,0)
 N NSFF,PSGOEF39,PSGEDTOI S NSFF=1 K PSJNSS,PSGEDTOI,PSGOEER,ZZND
"RTN","PSGOEF",58,0)
 I $G(PSGORD),$D(PSGRDTX(+PSGORD)) D  K PSGRDTX
"RTN","PSGOEF",59,0)
 . ;PSJOCDSC stores the default start & stop date ^ cal start & stop date (use in dosing calculation for duration)
"RTN","PSGOEF",60,0)
 . ;for some reasons PSGSD & PSGFD are reset to the cal dates if order has duration defined
"RTN","PSGOEF",61,0)
 . S PSJOCDSC("CX","PSGSD",+PSGORD)=$G(PSGSD)_U_$G(PSGRDTX(+PSGORD,"PSGRSD"))
"RTN","PSGOEF",62,0)
 . S PSJOCDSC("CX","PSGFD",+PSGORD)=$G(PSGFD)_U_$G(PSGRDTX(+PSGORD,"PSGRFD"))
"RTN","PSGOEF",63,0)
 . S:$G(PSGRDTX(+PSGORD,"PSGRSD")) PSGSD=PSGRDTX(+PSGORD,"PSGRSD")
"RTN","PSGOEF",64,0)
 . S:$G(PSGRDTX(+PSGORD,"PSGRFD")) PSGFD=$S($G(PSGRDTX(+PSGORD,"PSGRFD")):PSGRDTX(+PSGORD,"PSGRFD"),1:$G(PSGNEFD))
"RTN","PSGOEF",65,0)
 N PSJCOM S PSJCOM=+$P($G(^PS(53.1,+PSGORD,.2)),"^",8)
"RTN","PSGOEF",66,0)
 ; 
"RTN","PSGOEF",67,0)
 ; PSJ*5*222
"RTN","PSGOEF",68,0)
 ; PSJCT1 is a counter variable.  Every piece of a complex order calls PSGOEF.
"RTN","PSGOEF",69,0)
 ; The only time this code is to look for overlapping admin times is when the
"RTN","PSGOEF",70,0)
 ; first part of a complex order is being finished.  This variable will keep track
"RTN","PSGOEF",71,0)
 ; of how many "parts" of the complex order have been checked.
"RTN","PSGOEF",72,0)
 ; 
"RTN","PSGOEF",73,0)
 ; Also, since the user can select multiple complex orders to finish, like selecting
"RTN","PSGOEF",74,0)
 ; orders 1-2 or 1-3 from the profile, PSJCT1A will keep track of whether the parent
"RTN","PSGOEF",75,0)
 ; order number is the same as the first parent order number selected for finishing.
"RTN","PSGOEF",76,0)
 ; Since the PSJCT1 counter variable will still be set if multiple complex orders
"RTN","PSGOEF",77,0)
 ; are selected, PSJCT1 will be re-set to 1 if the parent complex order number (PSJCT1A) is
"RTN","PSGOEF",78,0)
 ; not equal to the original parent order number (PSJCOM).
"RTN","PSGOEF",79,0)
 ; 
"RTN","PSGOEF",80,0)
 S PSJCT1=$G(PSJCT1)+1
"RTN","PSGOEF",81,0)
 I PSJCT1=1 S PSJCT1A=PSJCOM
"RTN","PSGOEF",82,0)
 I $G(PSJCT1A)'=PSJCOM S PSJCT1=1,PSJCT1A=PSJCOM
"RTN","PSGOEF",83,0)
 ; End of flag setting for PSJ*5*222
"RTN","PSGOEF",84,0)
 ;PRE UAT group requested to not show the second screen since FDB OC has more text and provider override reason appears after 2nd screen 
"RTN","PSGOEF",85,0)
 ;I $O(^PS(53.1,+PSGORD,12,0))!$O(^PS(53.1,+PSGORD,10,0)) D
"RTN","PSGOEF",86,0)
 ;.Q:$G(PSJLMX)=1  ; there's no second screen to display
"RTN","PSGOEF",87,0)
 ;.S VALMBG=16 D RE^VALM4,PAUSE^VALM1
"RTN","PSGOEF",88,0)
 D FULL^VALM1
"RTN","PSGOEF",89,0)
 I '$D(IOINORM)!('$D(IOINHI)) S X="IORVOFF;IORVON;IOINHI;IOINORM" D ENDR^%ZISS
"RTN","PSGOEF",90,0)
 I $G(PSJCOM)'="",$G(PSJCT1)=1 D
"RTN","PSGOEF",91,0)
 . D OVERLAP^PSGOEF2 I $G(PSJOVRLP)=1 D
"RTN","PSGOEF",92,0)
 . . N X,X1,DIR
"RTN","PSGOEF",93,0)
 . . W !!,"**WARNING**"
"RTN","PSGOEF",94,0)
 . . W !,"The highlighted admin times for these portions of this complex order overlap.",!!
"RTN","PSGOEF",95,0)
 . . S (X,X1)="" F  S X=$O(^TMP("PSJATOVR",$J,X)) Q:X=""  D
"RTN","PSGOEF",96,0)
 . . . S X1=$G(^TMP("PSJATOVR",$J,X))
"RTN","PSGOEF",97,0)
 . . . W $S($P(X1,"^",4)=1:IORVON,1:""),"Part "_X,IORVOFF," has a schedule of "_$P(X1,"^",2)_" and admin time(s) of "
"RTN","PSGOEF",98,0)
 . . . W $S($P(X1,"^",4)=1:IORVON,1:""),$P(X1,"^",3),IORVOFF
"RTN","PSGOEF",99,0)
 . . . W !
"RTN","PSGOEF",100,0)
 . . . W $S($G(PSJOVR("CONJ",X))="A":"AND",$G(PSJOVR("CONJ",X))="T":"THEN",1:""),!
"RTN","PSGOEF",101,0)
 . . W !,"Please ensure the schedules and administration times are appropriate.",!
"RTN","PSGOEF",102,0)
 . . S DIR(0)="EA",DIR("A")="Press Return to continue..." D ^DIR W !
"RTN","PSGOEF",103,0)
 K ^TMP("PSJATOVR",$J)
"RTN","PSGOEF",104,0)
 I $G(PSJPROT)=3,'$D(PSJTUD),'$$ENIVUD^PSGOEF1(PSGORD) Q
"RTN","PSGOEF",105,0)
 I $G(PSGOSCH)]"" D  S:$G(PSGS0XT)'="" $P(^PS(53.1,+PSGORD,2),"^",6)=PSGS0XT
"RTN","PSGOEF",106,0)
 .N PSGOES,PSGS0Y,PSGSCH S X=PSGOSCH K:$G(PSJTUD) NSFF D ENOS^PSGS0
"RTN","PSGOEF",107,0)
 .I '($G(PSGORD)["P"&($P($G(^PS(53.1,+PSGORD,0)),"^",24)="R")) I $G(X)]""&$G(PSGS0Y) S:$G(PSGAT)="" PSGAT=PSGS0Y
"RTN","PSGOEF",108,0)
 .I $G(PSJNSS) S PSGOSCH="" K PSJNSS
"RTN","PSGOEF",109,0)
 .I $G(PSGORD)["P",$G(PSGAT),$G(PSGS0Y),($G(PSGOSCH)]"") I PSGAT'=PSGS0Y D
"RTN","PSGOEF",110,0)
 ..S PSGNSTAT=1 W $C(7),!!,"PLEASE NOTE:  This order's admin times (",PSGAT,")"
"RTN","PSGOEF",111,0)
 ..W !?13," do not match the ward times (",PSGS0Y,")"
"RTN","PSGOEF",112,0)
 ..W !?13," for this administration schedule (",PSGOSCH,")",!
"RTN","PSGOEF",113,0)
 ..S DIR(0)="EA",DIR("A")="Press Return to continue..." D ^DIR K DIR  W !
"RTN","PSGOEF",114,0)
 I $G(PSGS0XT)="" S $P(^PS(53.1,+PSGORD,2),"^",6)=$S($P($G(ZZND),"^",3)'="":$P(ZZND,"^",3),1:"")
"RTN","PSGOEF",115,0)
 S CHK=0 S:$P($G(^PS(53.1,+PSGORD,0)),U,24)'="R" PSGSI=$$ENPC^PSJUTL("U",+PSJSYSP,180,PSGSI)
"RTN","PSGOEF",116,0)
 I '$G(PSJTUD),$G(PSJNSS),($G(PSGOSCH)]"") D NSSCONT^PSGS0(PSGOSCH,PSGS0XT) K PSJNSS S PSGOSCH=""
"RTN","PSGOEF",117,0)
 S PSGOEFF=PSGOSCH=""+('$O(^PS(53.45,PSJSYSP,2,0))*10)
"RTN","PSGOEF",118,0)
 I PSGOEFF S X=$S(PSGOEFF#2:" a SCHEDULE",1:"")_$S(PSGOEFF=11:" and",1:"")_$S(PSGOEFF>9:" at least one DISPENSE DRUG",1:"")
"RTN","PSGOEF",119,0)
 I 'PSGOEFF I (($G(PSGS0XT)="D")&($G(PSGAT)="")) S X=" Admin Times",PSGOEFF=1,PSGOEF39=1
"RTN","PSGOEF",120,0)
 I PSGOEFF,X]"" S X=X_" before it can be finished."
"RTN","PSGOEF",121,0)
 I PSGOEFF S CHK=1 W $C(7),!!,"PLEASE NOTE: This order must have" F Q=1:1:$L(X," ") S Y=$P(X," ",Q) W:$L(Y)+$X>78 ! W Y," "
"RTN","PSGOEF",122,0)
 I $G(PSGOEF39) S PSGOEE=0,PSGOEFF=0 D  I 'PSGOEE D REFRESH^VALM G DONE
"RTN","PSGOEF",123,0)
 .S F1=53.1,MSG=0,Y=$T(39),@("PSGFN(39)="_$P(Y,";",7)),PSGOEEF(+$P(Y,";",3))=1,(PSGOEEF,PSGOEE)=1 W ! D @$P($T(39),";",3) S CHK=0
"RTN","PSGOEF",124,0)
 I PSGOEFF=1 S F1=53.1,MSG=0,Y=$T(38),@("PSGFN(38)="_$P(Y,";",7)),PSGOEEF(+$P(Y,";",3))=1,(PSGOEE,PSGOEEF)=1 W ! D @$P($T(38),";",3) S CHK=0 G:'PSGOEE DONE
"RTN","PSGOEF",125,0)
 I PSGOEFF=11 S F1=53.1,MSG=0,Y=$T(32),@("PSGFN(32)="_$P(Y,";",7)),PSGOEEF(+$P(Y,";",3))=1,(PSGOEE,PSGOEEF)=1 W ! D @$P($T(32),";",3) D  G:'PSGOEE DONE
"RTN","PSGOEF",126,0)
 .S F1=53.1,MSG=0,Y=$T(38),@("PSGFN(38)="_$P(Y,";",7)),PSGOEEF(+$P(Y,";",3))=1,(PSGOEE,PSGOEEF)=1 W ! D @$P($T(38),";",3) S CHK=0
"RTN","PSGOEF",127,0)
 I PSGOEFF>9 S CHK=7 D ENDRG^PSGOEF1(+PSGPD,0) I CHK D ABORTACC Q
"RTN","PSGOEF",128,0)
 I 'PSGOEFF D OC531^PSGOESF ; check every dispense drug from CPRS
"RTN","PSGOEF",129,0)
 S VALMBG=1
"RTN","PSGOEF",130,0)
 I 'PSGOEFF&($D(PSGORQF)) D RE^VALM4 Q
"RTN","PSGOEF",131,0)
 I $G(MSG) K DIR S DIR(0)="E" W !! D ^DIR
"RTN","PSGOEF",132,0)
 I PSGOEFF D:PSGST="" GTST^PSGOE6(+PSGORD)
"RTN","PSGOEF",133,0)
 S PSJLMFIN=1
"RTN","PSGOEF",134,0)
 K PSJACEPT I $O(^PS(53.1,+PSGORD,12,0)) S PSJLMP2=1
"RTN","PSGOEF",135,0)
 S PSGOEENO=0,PSGSTAT=$S($P(PSJSYSP0,U,9):"ACTIVE",1:"NON-VERIFIED")
"RTN","PSGOEF",136,0)
 NEW PSJDOSE,PSJDOX,PSJDSFLG
"RTN","PSGOEF",137,0)
 D DOSECHK^PSJDOSE
"RTN","PSGOEF",138,0)
 S:+$G(PSJDSFLG) VALMSG="Dosage Ordered & Dispense Drug are not compatible"
"RTN","PSGOEF",139,0)
 I PSGODO=PSGDO S PSGOEEF(109)=""
"RTN","PSGOEF",140,0)
 I PSGODO'=PSGDO S PSGOEENO=1,VALMSG="This change will cause a new order to be created  "
"RTN","PSGOEF",141,0)
 D EN^VALM("PSJU LM ACCEPT")
"RTN","PSGOEF",142,0)
 I $G(PSJNSS) D  S PSGOEEF(26)="" K PSJACEPT,PSJNSS
"RTN","PSGOEF",143,0)
 .K DIR S DIR(0)="FOA",DIR("A")="Invalid Schedule" D ^DIR K DIR
"RTN","PSGOEF",144,0)
 I $G(PSGS0XT)="D",'$G(PSGS0Y),'$G(PSGAT),((",P,R,")'[(","_$G(PSGST)_",")) D  S PSGOEEF(39)="" K PSJACEPT
"RTN","PSGOEF",145,0)
 .K DIR S DIR(0)="FOA",DIR("A")="   WARNING - Admin times are required for DAY OF WEEK schedules  " D ^DIR K DIR
"RTN","PSGOEF",146,0)
 ;***PSJ*5*113
"RTN","PSGOEF",147,0)
 I $G(PSGAT)="",(PSGST="C"!(PSGST="R")) D
"RTN","PSGOEF",148,0)
 .I $G(PSGS0XT) Q:$$ODD^PSGS0(PSGS0XT)
"RTN","PSGOEF",149,0)
 .Q:$$PRNOK^PSGS0($G(PSGSCH))
"RTN","PSGOEF",150,0)
 .Q:($P($G(ZZND),"^",5)'="C")
"RTN","PSGOEF",151,0)
 .K PSJACEPT
"RTN","PSGOEF",152,0)
 .K DIR S DIR(0)="FOA",DIR("A")="  WARNING - Admin times are required for CONTINUOUS orders " D ^DIR K DIR
"RTN","PSGOEF",153,0)
 ;***
"RTN","PSGOEF",154,0)
 I '$G(PSJACEPT) D ABORTACC Q
"RTN","PSGOEF",155,0)
 I $G(PSJRNF),$G(^PS(53.1,+PSGORD,4)) D
"RTN","PSGOEF",156,0)
 . W $C(7),!!,"ACCEPTING THIS ORDER WILL CHANGE THE STATUS TO ACTIVE."
"RTN","PSGOEF",157,0)
 . S DIR(0)="Y",DIR("A")="Do you wish to make this order Active",DIR("?",1)="Enter ""N"" if you wish to exit without Activating this order,"
"RTN","PSGOEF",158,0)
 . S DIR("?")="or ""Y"" to continue with the Activation process." D ^DIR S:'Y Y=-1 K DIR
"RTN","PSGOEF",159,0)
 I $G(PSJRNF),$G(Y)=-1 S PSJACEPT=0 D ABORTACC Q
"RTN","PSGOEF",160,0)
 I $G(PSJRNF),$G(Y)=1 S PSGOEAV=1
"RTN","PSGOEF",161,0)
 I $G(PSGEDTOI) D OC^PSJOE1
"RTN","PSGOEF",162,0)
 I $S($G(PSGORQF):0,$G(PSGEDTOI):0,$G(PSGOEER)["109^PSGOE8":1,$G(PSGOEER)["3^PSGOE8":1,$G(PSGOEER)["26^PSGOE8":1,$G(PSGOEER)["10^PSGOE81":1,$G(PSGOEER)["25^PSGOE81":1,1:0) D
"RTN","PSGOEF",163,0)
 . NEW PSJDD S PSJDD=+$$DD53P45^PSJMISC()
"RTN","PSGOEF",164,0)
 . D:$G(PSJDD) IN^PSJOCDS($G(PSGORD),"UD",PSJDD)
"RTN","PSGOEF",165,0)
 I $G(PSGORQF) S PSGOEENO=0,PSJACEPT=0
"RTN","PSGOEF",166,0)
 I PSGOEENO S PSJNOO=$$ENNOO^PSJUTL5("E"),PSJACEPT=$S(PSJNOO<0:0,1:1)
"RTN","PSGOEF",167,0)
ACCEPT ;
"RTN","PSGOEF",168,0)
 S VALMBCK=$S($G(PSJACEPT):"Q",1:"R")
"RTN","PSGOEF",169,0)
 I '$G(PSJACEPT) D ABORTACC Q
"RTN","PSGOEF",170,0)
 K PSGOES,PSGRSD,PSGRSDN D:PSGOEENO NEW3^PSGOEE D:'PSGOEENO UPD^PSGOEF1 I $D(PSGOEF)!PSGOEENO S PSGCANFL=-1
"RTN","PSGOEF",171,0)
 ;saves drug allergy signs/symptoms PSJ*5*260
"RTN","PSGOEF",172,0)
 I +$G(^TMP("PSODAOC",$J,1,0)) D
"RTN","PSGOEF",173,0)
 .N DA,OCCDT,ORN,ORL,Z,RET,PSJDAOC
"RTN","PSGOEF",174,0)
 .S PSJDAOC="IP MEDS "_$S($G(PSGORD)["P":"Pending/Non-Verified",$G(PSGORD)["U":"Unit Dose",$G(PSGORD)["V":"IV",1:"")_" Order Acceptance",OCCDT=$$NOW^XLFDT
"RTN","PSGOEF",175,0)
 .I PSGORD["P" S ORN=$P(^PS(53.1,+PSGORD,0),U,21)
"RTN","PSGOEF",176,0)
 .I PSGORD["U" S ORN=$P(^PS(55,DFN,5,+PSGORD,0),U,21)
"RTN","PSGOEF",177,0)
 .I PSGORD["V" S ORN=$P(^PS(55,DFN,"IV",+PSGORD,0),U,21)
"RTN","PSGOEF",178,0)
 .Q:'$G(ORN)
"RTN","PSGOEF",179,0)
 .D DAOC^PSJHL3
"RTN","PSGOEF",180,0)
 K ^TMP("PSODAOC",$J)
"RTN","PSGOEF",181,0)
 D DONE1^PSGOEE
"RTN","PSGOEF",182,0)
 D DONE
"RTN","PSGOEF",183,0)
 Q
"RTN","PSGOEF",184,0)
BYPASS ;
"RTN","PSGOEF",185,0)
 S PSGCANFL=1
"RTN","PSGOEF",186,0)
 ;
"RTN","PSGOEF",187,0)
DONE ;
"RTN","PSGOEF",188,0)
 K CHK,DA,DIE,DR,DRG,MSG,Q1,Q2,PSGNSTAT,PSGEDTOI,PSGOEER,ZZND
"RTN","PSGOEF",189,0)
 K PSJOVR
"RTN","PSGOEF",190,0)
 Q
"RTN","PSGOEF",191,0)
ABORTACC ; Abort Accept process.
"RTN","PSGOEF",192,0)
 K PSJCT1,PSJOVR,PSJOVRLP,PSJCT1A K ^TMP("PSODAOC",$J)
"RTN","PSGOEF",193,0)
 D ABORT^PSGOEE K PSGOEEF D GETUD^PSJLMGUD(PSGP,PSGORD),^PSGOEF,ENSFE^PSGOEE0(PSGP,PSGORD),INIT^PSJLMUDE(PSGP,PSGORD) S VALMBCK="R",PSGSD=PSGNESD,PSGFD=PSGNEFD Q
"RTN","PSGOEF",194,0)
 ;
"RTN","PSGOEF",195,0)
 ;
"RTN","PSGOEF",196,0)
31 ;;101^PSGOE8;PSGOPD;PSGPD;101;1
"RTN","PSGOEF",197,0)
32 ;;109^PSGOE8;PSGODO;PSGDO;109;PSGODO]""
"RTN","PSGOEF",198,0)
33 ;;10^PSGOE81;PSGOSD;PSGSD;10;0
"RTN","PSGOEF",199,0)
34 ;;3^PSGOE8;PSGOMR;PSGMR;3;1
"RTN","PSGOEF",200,0)
35 ;;25^PSGOE81;PSGOFD;PSGFD;25;0
"RTN","PSGOEF",201,0)
36 ;;7^PSGOE8;PSGOST;PSGST;7;0
"RTN","PSGOEF",202,0)
37 ;;5^PSGOE82;PSGOSM;PSGSM;5;0
"RTN","PSGOEF",203,0)
38 ;;26^PSGOE8;PSGOSCH;PSGSCH;26;1      
"RTN","PSGOEF",204,0)
39 ;;39^PSGOE81;PSGOAT;PSGAT;39;0
"RTN","PSGOEF",205,0)
310 ;;1^PSGOE82;PSGOPR;PSGPR;1;1
"RTN","PSGOEF",206,0)
311 ;;8^PSGOE81;PSGOSI;PSGSI;8;0
"RTN","PSGOEF",207,0)
312 ;;2^PSGOE82;;;2;0
"RTN","PSGOEF",208,0)
313 ;;40^PSGOE82;;;40;0
"RTN","PSGOEF",209,0)
 ;
"RTN","PSGOEF",210,0)
AH ;
"RTN","PSGOEF",211,0)
 W !!?2,"Answer 'YES' to accept this order as a NON-VERIFIED UNIT DOSE order.  Answer",!,"'NO' to edit this order now.  Enter '^' to BYPASS this order, leaving it as",!,"a PENDING INPATIENT order."
"RTN","PSGOEF",212,0)
 Q
"RTN","PSGOEV")
0^5^B81429110^B81363759
"RTN","PSGOEV",1,0)
PSGOEV ;BIR/CML3-VERIFY (MAKE ACTIVE) ORDERS ; 4/16/10 9:18am
"RTN","PSGOEV",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**5,7,15,28,33,50,64,58,77,78,80,110,111,133,171,207,241,267,268,260,288,199**;16 DEC 97;Build 25
"RTN","PSGOEV",3,0)
 ;
"RTN","PSGOEV",4,0)
 ; Reference to ^ORD(101 supported by DBIA #872.
"RTN","PSGOEV",5,0)
 ; Reference to ^PS(50.7 supported by DBIA #2180.
"RTN","PSGOEV",6,0)
 ; Reference to ^PS(55 supported by DBIA #2191.
"RTN","PSGOEV",7,0)
 ; Reference to ^PSSLOCK supported by DBIA #2789.
"RTN","PSGOEV",8,0)
 ; Reference to MAIN^TIUEDIT is supported by DBIA #2410.
"RTN","PSGOEV",9,0)
 ;
"RTN","PSGOEV",10,0)
EN(PSGORD) ;
"RTN","PSGOEV",11,0)
ENSF ; This entry point is used by Speed finish only.
"RTN","PSGOEV",12,0)
 ; Send SN update to CPRS if auto-verify off and from Order Set entry
"RTN","PSGOEV",13,0)
 S:'$D(PSGOEAV) PSGOEAV=$P($G(PSJSYSP0),"^",9)&$G(PSJSYSU)
"RTN","PSGOEV",14,0)
 I $D(PSGOES),'PSGOEAV,PSGORD["P",$P($G(^PS(53.1,+PSGORD,0)),"^",21)']"" D ORSET^PSGOETO1
"RTN","PSGOEV",15,0)
 D FULL^VALM1 I 'PSJSYSU W $C(7),$C(7),!!," THIS FUNCTION NOT AVAILABLE TO WARD STAFF." Q
"RTN","PSGOEV",16,0)
 S CHK=0 I PSGORD["P" S X=$P($G(^PS(53.1,+PSGORD,0)),"^",19) I X,$D(^PS(55,PSGP,5,$P(^(0),"^",19))) S CHK=+PSGORD,PSGORD=X_"U" L -^PS(53.1,CHK) L +^PS(55,PSGP,5,+PSGORD):1 E  W !!,"Another terminal is editing this order." G DONE
"RTN","PSGOEV",17,0)
 I +PSJSYSU=3 D DDCHK G:CHK DONE
"RTN","PSGOEV",18,0)
 I PSGORD["P" D CHK($G(^PS(53.1,+PSGORD,0)),$G(^(.2)),$G(^(2)))
"RTN","PSGOEV",19,0)
 I $G(PSGSCH)]"" D
"RTN","PSGOEV",20,0)
 .N X,Y,PSGS0Y,PSGS0XT,PSGOES S PSGOES=1 S X=PSGSCH D ENOS^PSGS0 I $G(X)="" S CHK=4
"RTN","PSGOEV",21,0)
 I $G(CHK) Q:$D(PSJSPEED)  D EN^VALM("PSJU LM ACCEPT") G:'$G(PSJACEPT) DONE ;G VFY
"RTN","PSGOEV",22,0)
 I PSGORD["U" G:'$D(^PS(55,PSGP,5,+PSGORD,4)) VFY I +PSJSYSU=3,$P(^(4),"^",3) W $C(7),!!,"THIS ORDER HAS ALREADY BEEN VERIFIED BY A PHARMACIST." S PSGACT=$P(PSGACT,"V")_$P(PSGACT,"V",2) G DONE
"RTN","PSGOEV",23,0)
 I PSGORD["U" I +PSJSYSU=1,+^PS(55,PSGP,5,+PSGORD,4) W $C(7),!!,"THIS ORDER HAS ALREADY BEEN VERIFIED BY A NURSE." S PSGACT=$P(PSGACT,"V")_$P(PSGACT,"V",2) G DONE
"RTN","PSGOEV",24,0)
 ;
"RTN","PSGOEV",25,0)
VFY ; change status, move to 55, and change label record **ENHANCEMENTS MADE IN PSJ*5.0*260 **CCR 6214 **CCR 6244
"RTN","PSGOEV",26,0)
 I PSGORD["P" S PSJCOM=+$P($G(^PS(53.1,+PSGORD,.2)),"^",8) I PSJCOM D VFY^PSJCOM Q
"RTN","PSGOEV",27,0)
 NEW PSJDOSE,PSJDSFLG,PSJDIS,PSGORQF,PSJCNT,PSJCNT1,PSJCNT2,LIST,PSJFLG,PSGDN SET PSJDIS="",PSJCNT=0,PSJCNT1="",PSJCNT2="",LIST="PSGPRE",PSJFLG="",PSGDN=""
"RTN","PSGOEV",28,0)
 D DOSECHK^PSJDOSE
"RTN","PSGOEV",29,0)
 SET PSJFLG=+$G(PSGORD)
"RTN","PSGOEV",30,0)
 FOR  SET PSJCNT=$O(^PS(53.1,PSJFLG,1,PSJCNT)) Q:'+PSJCNT  D
"RTN","PSGOEV",31,0)
 .IF $D(^PS(53.1,PSJFLG,1,PSJCNT,0)) SET PSGDN=$P($G(^PS(53.1,PSJFLG,1,PSJCNT,0)),U,1)
"RTN","PSGOEV",32,0)
 .IF ($P($G(^PSDRUG(PSGDN,0)),U,3)'["S")&($E($P($G(^PSDRUG(PSGDN,0)),U,2),1,2)'="XA")  D
"RTN","PSGOEV",33,0)
 ..D PROFILE^PSJBLDOC($G(DFN),LIST,"I;"_$G(PSGORD))
"RTN","PSGOEV",34,0)
 ..FOR  SET PSJCNT1=$O(^TMP($J,LIST,"IN","PROFILE",PSJCNT1)) Q:(PSJCNT1="")!(PSJDIS'="")  D
"RTN","PSGOEV",35,0)
 ...SET PSJCNT2=$P(PSJCNT1,";",2)
"RTN","PSGOEV",36,0)
 ...IF PSJCNT2=$G(PSGORD) SET PSJDIS=$P(^TMP($J,LIST,"IN","PROFILE",PSJCNT1),U,3)
"RTN","PSGOEV",37,0)
 ..;**Do order checks if PSJDIS (Dispense drug IEN) has a value
"RTN","PSGOEV",38,0)
 ..IF $G(PSJNEWOE)=0,'$G(PSJLMFIN),'$G(PSJSTARI),'$G(PSGCOPY),$G(PSJDIS)  D 
"RTN","PSGOEV",39,0)
 ...D EN^PSJGMRA($G(DFN),PSJDIS),IN^PSJOCDS($G(PSGORD),"UD",PSJDIS),ENDDC^PSGSICHK($G(PSGP),PSJDIS) IF $G(PSGORQF) K ^TMP($J,LIST) D EN^VALM("PSJ LM UD ACTION") QUIT
"RTN","PSGOEV",40,0)
 IF $G(PSGORQF) QUIT
"RTN","PSGOEV",41,0)
 D FULL^VALM1 ;PSJ*5*241
"RTN","PSGOEV",42,0)
 I +$G(PSJDSFLG) D SETVAR^PSJDOSE W !!,PSJDOSE("WARN"),!,PSJDOSE("WARN1") I '$$CONT() W !,"...order was not verified..." D PAUSE^VALM1 D  Q:'$G(PSJACEPT)
"RTN","PSGOEV",43,0)
 . S PSGOEEF(109)=1
"RTN","PSGOEV",44,0)
 . S PSJACEPT=0
"RTN","PSGOEV",45,0)
 . ;D EN^VALM("PSJU LM ACCEPT")
"RTN","PSGOEV",46,0)
 D DDCHK G:CHK DONE
"RTN","PSGOEV",47,0)
 I $G(PSGSCH)]"",((",P,R,")'[(","_PSGST_",")) D  I CHK G DONE
"RTN","PSGOEV",48,0)
 .N SWD,SDW,XABB,X,QX S X=$G(PSGSCH) D DW^PSGS0 Q:($G(X)="")  I $G(PSGS0XT)="" S PSGS0XT="D"
"RTN","PSGOEV",49,0)
 .I $G(PSGS0XT)="D",$G(PSGAT)="" S CHK=1 W !!,"This is a 'DAY OF WEEK' schedule and MUST have admin times.",! D PAUSE^VALM1
"RTN","PSGOEV",50,0)
 I $G(PSGSCH)]"" D  I CHK G DONE
"RTN","PSGOEV",51,0)
 .N X,Y,PSGS0XT,PSGS0Y,PSGOES S PSGOES=2,X=PSGSCH D ENOS^PSGS0 I $G(X)="" S CHK=4
"RTN","PSGOEV",52,0)
 W !,"...a few moments, please..."
"RTN","PSGOEV",53,0)
 I PSGORD["P" D
"RTN","PSGOEV",54,0)
 . N PND0,PSGORDR,PSJPRIO,PSJSCHED S PND0=^PS(53.1,+PSGORD,0) I $P(PND0,U,24)="R" S PSGORDR=$P(PND0,U,25) D  Q
"RTN","PSGOEV",55,0)
 .. N OEORD,OOEORD,FILE55,FILE55N0 S FILE55="^PS(55,"_DFN_$S($P(PND0,U,4)="U":",5,",1:",""IV"","),FILE55N0=FILE55_+PSGORDR_",0)"
"RTN","PSGOEV",56,0)
 .. S OEORD=$P(PND0,U,21) I PSGORDR S OOEORD=$P(@FILE55N0,"^",21) I OEORD'=OOEORD D EXPOE^PSGOER(DFN,PSGORD,+$$LASTREN^PSJLMPRI(DFN,PSGORD))
"RTN","PSGOEV",57,0)
 .. S PSGORDP=PSGORD,DIE="^PS(53.1,",DA=+PSGORD,DR="28////A;104////@" W "." D ^DIE
"RTN","PSGOEV",58,0)
 .. D START^PSGOTR(PSGORD,+PSGORDR) I OEORD D
"RTN","PSGOEV",59,0)
 ... K DA,DR,DIE S DA(1)=DFN,DA=+PSGORDR,DIE=FILE55,DR=$S(DIE["IV":110,1:66)_"////"_+OEORD D ^DIE S DIE=FILE55_+PSGORDR_",0)",$P(@DIE,U,21)=OEORD
"RTN","PSGOEV",60,0)
 ... D EN1^PSJHL2(DFN,"SC",PSGORDR),EN^PSGPEN(PSGORDR),UNL^PSSLOCK(PSGP,PSGORDR)
"RTN","PSGOEV",61,0)
 . S PSGORDP=PSGORD ;Used in ACTLOG to update activity log in 55
"RTN","PSGOEV",62,0)
 . D REQDT^PSJLIVMD(PSGORD)
"RTN","PSGOEV",63,0)
 . S DIE="^PS(53.1,",DA=+PSGORD,DR="28////A" W "." D ^DIE,^PSGOT
"RTN","PSGOEV",64,0)
 . S PSJPRIO=$S(PSGORD["P":$P($G(^PS(53.1,+PSGORD,.2)),"^",4),PSGORD["U":$P($G(^PS(55,DFN,5,+PSGORD,.2)),"^",4),1:$P($G(^PS(55,PSJHLDFN,"IV",+PSGORD,.2)),"^",4))
"RTN","PSGOEV",65,0)
 . S PSJSCHED=$S(PSGORD["P":$P($G(^PS(53.1,+PSGORD,2)),"^"),PSGORD["U":$P($G(^PS(55,DFN,5,+PSGORD,2)),"^"),1:$P($G(^PS(55,PSJHLDFN,"IV",+PSGORD,0)),"^",15))
"RTN","PSGOEV",66,0)
 . I (",S,A,")[(","_$G(PSJPRIO)_",")!($G(PSJSCHED)="NOW")!($G(PSJSCHED)["STAT") D NOTIFY^PSJHL4(PSGORD,DFN,$G(PSJPRIO),$G(PSJSCHED))
"RTN","PSGOEV",67,0)
 . I $G(PSGRDTX)="" S PSGRDTX=$G(^PS(53.1,+PSGORDP,2.5))
"RTN","PSGOEV",68,0)
 S DA=+PSGORD,DA(1)=PSGP,PSGAL("C")=PSJSYSU*10+22000 D ^PSGAL5 W "." S VND4=$G(^PS(55,PSGP,5,DA,4))
"RTN","PSGOEV",69,0)
 I $G(PSGRDTX) D NEWUDAL^PSGAL5(PSGP,PSGORD,6090,"Requested Start Date",+$G(PSGRDTX))
"RTN","PSGOEV",70,0)
 I $P($G(PSGRDTX),U,3) D NEWUDAL^PSGAL5(PSGP,PSGORD,6090,"Requested Stop Date",+$P($G(PSGRDTX),U,3))
"RTN","PSGOEV",71,0)
 N DUR,DURON S DURON=$S($G(PSGORD):$G(PSGORD),1:"") I DURON D
"RTN","PSGOEV",72,0)
 . S DUR=$S($P($G(PSGRDTX),U,2)]"":$P($G(PSGRDTX),U,2),1:$$GETDUR^PSJLIVMD(PSGP,+DURON,$S($G(DURON)["P":"P",1:5),1),1:"")
"RTN","PSGOEV",73,0)
 I $G(DUR)]"" S $P(^PS(55,PSGP,5,+PSGORD,2.5),"^",2)=DUR
"RTN","PSGOEV",74,0)
 D:$D(PSGORDP) ACTLOG(PSGORDP,PSGP,PSGORD)
"RTN","PSGOEV",75,0)
 K PSGRSD,PSGRFD,PSGALFN
"RTN","PSGOEV",76,0)
 NEW X S X=0 I $G(PSGONF),(+$G(PSGODDD(1))'<+$G(PSGONF)) S X=1
"RTN","PSGOEV",77,0)
 I +PSJSYSU=3,PSGORD'["O",$S(X:0,'$P(VND4,"^",9):1,1:$P(VND4,"^",15)) D EN^PSGPEN(+PSGORD)
"RTN","PSGOEV",78,0)
 S $P(VND4,"^",+PSJSYSU=1+9)=1 S:'$P(VND4,U,+PSJSYSU=3+9) $P(VND4,U,+PSJSYSU=3+9)=+$P(VND4,U,+PSJSYSU=3+9)
"RTN","PSGOEV",79,0)
 I PSJSYSL>1 S $P(^PS(55,PSGP,5,+PSGORD,7),U)=PSGDT S:$P(^(7),U,2)="" $P(^(7),U,2)="N"_$S($P(^PS(55,PSGP,5,+PSGORD,0),"^",24)="E":"E",1:"") S PSGTOL=2,PSGUOW=DUZ,PSGTOO=1,DA=+PSGORD D ENL^PSGVDS
"RTN","PSGOEV",80,0)
 S:$P(VND4,"^",15)&'$P(VND4,"^",16) $P(VND4,"^",15)="" S:$P(VND4,"^",18)&'$P(VND4,"^",19) $P(VND4,"^",18)="" S:$P(VND4,"^",22)&'$P(VND4,"^",23) $P(VND4,"^",22)="" S $P(VND4,"^",PSJSYSU,PSJSYSU+1)=DUZ_"^"_PSGDT,^PS(55,PSGP,5,+PSGORD,4)=VND4
"RTN","PSGOEV",81,0)
 I '$P(VND4,U,9) S ^PS(55,"APV",PSGP,+PSGORD)=""
"RTN","PSGOEV",82,0)
 I '$P(VND4,U,10) S ^PS(55,"ANV",PSGP,+PSGORD)=""
"RTN","PSGOEV",83,0)
 I $P(VND4,U,9) K ^PS(55,"APV",PSGP,+PSGORD)
"RTN","PSGOEV",84,0)
 I $P(VND4,U,10) K ^PS(55,"ANV",PSGP,+PSGORD)
"RTN","PSGOEV",85,0)
 W:'$D(PSJSPEED) ! W !,"ORDER VERIFIED.",!
"RTN","PSGOEV",86,0)
 I '$D(PSJSPEED) K DIR S DIR(0)="E" D ^DIR K DIR
"RTN","PSGOEV",87,0)
 S:+PSJSYSU=3 ^PS(55,"AUE",PSGP,+PSGORD)="" S PSGACT="C"_$S('$D(^PS(55,PSGP,5,+PSGORD,4)):"E",$P(^(4),"^",16):"",1:"E")_"RS",PSGCANFL=2
"RTN","PSGOEV",88,0)
 S VALMBCK="Q" D EN1^PSJHL2(PSGP,$S(+PSJSYSU=3:"SC",+PSJSYSU=1:"SC",1:"XX"),+PSGORD_"U")     ; allow status change to be sent for pharmacists & nurses
"RTN","PSGOEV",89,0)
  ; **This is where the Automated Dispensing Machine hook is called. Do NOT DELETE or change this location **
"RTN","PSGOEV",90,0)
 D NEWJ^PSJADM
"RTN","PSGOEV",91,0)
  ; **END of Interface hook **
"RTN","PSGOEV",92,0)
 D:+PSJSYSU=1 EN1^PSJHL2(PSGP,"ZV",+PSGORD_"U")
"RTN","PSGOEV",93,0)
DONE ;
"RTN","PSGOEV",94,0)
 W:CHK !!,"...order NOT verified..."
"RTN","PSGOEV",95,0)
 I '$D(PSJSPEED),'CHK,+PSJSYSU=3,$G(PSJPRI)="D" D
"RTN","PSGOEV",96,0)
 .N DIR W ! S DIR(0)="S^Y:Yes;N:No",DIR("A")="Do you want to enter a Progress Note",DIR("B")="No" D ^DIR
"RTN","PSGOEV",97,0)
 .Q:Y="N"
"RTN","PSGOEV",98,0)
 .D MAIN^TIUEDIT(3,.TIUDA,PSGP,"","","","",1)
"RTN","PSGOEV",99,0)
 S VALMBCK="Q" K CHK,DA,DIE,F,DP,DR,ND,PSGAL,PSGODA,PSJDOSE,PSJVAR,VND4,X,ZZND Q
"RTN","PSGOEV",100,0)
 ;
"RTN","PSGOEV",101,0)
LBL ;
"RTN","PSGOEV",102,0)
 Q
"RTN","PSGOEV",103,0)
 ;
"RTN","PSGOEV",104,0)
CHK(ND,DRG,ND2) ; checks for data in required fields
"RTN","PSGOEV",105,0)
 ; Input: ND  - ^(PS(53.1,PSGORD,0)
"RTN","PSGOEV",106,0)
 ;        DRG - ^(.2)
"RTN","PSGOEV",107,0)
 ;        ND2 - ^(2)
"RTN","PSGOEV",108,0)
 S Y=$G(Y)
"RTN","PSGOEV",109,0)
 S CHK="" I DRG,$D(^PS(50.7,+DRG,0))
"RTN","PSGOEV",110,0)
 E  S CHK=1
"RTN","PSGOEV",111,0)
 I ND="" S CHK=CHK_23
"RTN","PSGOEV",112,0)
 E  S CHK=CHK_$S($P(ND,"^",3):"",1:2)_$S($P(ND,"^",7)]"":"",1:3)
"RTN","PSGOEV",113,0)
 ;The naked reference on the line below refers to the variable ND which is ^PS(53.1,PSGORD,0).
"RTN","PSGOEV",114,0)
 I ND2="" S CHK=CHK_$S('$D(^(0)):4,$P(^(0),"^",7)="OC":"",1:4)_56
"RTN","PSGOEV",115,0)
 E  S CHK=CHK_$S($P(ND2,"^")]"":"",ND="":4,$P(ND,"^",7)="OC":"",1:4)_$S($P(ND2,"^",2):"",1:5)_$S($P(ND2,"^",4):"",1:6)
"RTN","PSGOEV",116,0)
 I $$CHECK^PSGOE8(PSJSYSP),$P(DRG,U,2)="" S CHK=CHK_8
"RTN","PSGOEV",117,0)
 K PSGDFLG,PSGPFLG S PSGDI=0
"RTN","PSGOEV",118,0)
 S:'$$DDOK^PSGOE2("^PS(53.45,"_PSJSYSP_",2,",+DRG) CHK=CHK_7,(PSGDFLG,PSGDI)=1
"RTN","PSGOEV",119,0)
 S:'$$OIOK^PSGOE2(+DRG) PSGPFLG=1
"RTN","PSGOEV",120,0)
 I 'CHK,$G(PSGSCH)]"" D
"RTN","PSGOEV",121,0)
 .N X,Y,PSGS0Y,PSGS0XT,PSGOES S PSGOES=2,X=PSGSCH D ENOS^PSGS0 I $G(X)="" S CHK=4
"RTN","PSGOEV",122,0)
 Q:'CHK
"RTN","PSGOEV",123,0)
 W $C(7)
"RTN","PSGOEV",124,0)
 ;
"RTN","PSGOEV",125,0)
CHKM ;
"RTN","PSGOEV",126,0)
 D FULL^VALM1 K:CHK Y
"RTN","PSGOEV",127,0)
 ; changed to remove ^DD ref
"RTN","PSGOEV",128,0)
 ; PSJ*5*267 VMP Add the 8th condition
"RTN","PSGOEV",129,0)
 W !!,"THE FOLLOWING ",$S($L(CHK)>1:"ARE",1:"IS")," EITHER INVALID OR MISSING FROM THIS ORDER:" F X=1:1:8 W:CHK[X !?5,$P("ORDERABLE ITEM^MED ROUTE^SCHEDULE TYPE^SCHEDULE^START DATE/TIME^STOP DATE/TIME^DISPENSE DRUG^DOSAGE ORDERED","^",X)
"RTN","PSGOEV",130,0)
 I CHK=7 W !,"Orders with no dispense drugs or multiple dispense drugs",!,"require dosage ordered"
"RTN","PSGOEV",131,0)
 W:CHK]"" !!,$S($L(CHK)>1:"THESE FIELDS ARE",1:"THIS FIELD IS")," NECESSARY FOR VERIFICATION."
"RTN","PSGOEV",132,0)
 N DIR S DIR(0)="E" D ^DIR I $D(DUOUT)!$D(DTOUT) S CHK=1 Q
"RTN","PSGOEV",133,0)
 Q
"RTN","PSGOEV",134,0)
 ;
"RTN","PSGOEV",135,0)
CONT() ;
"RTN","PSGOEV",136,0)
 NEW DIR,DIRUT,Y
"RTN","PSGOEV",137,0)
 W ! K DIR,DIRUT
"RTN","PSGOEV",138,0)
 S DIR(0)="Y",DIR("A")="Would you like to continue verifying the order",DIR("B")="No"
"RTN","PSGOEV",139,0)
 D ^DIR
"RTN","PSGOEV",140,0)
 Q Y
"RTN","PSGOEV",141,0)
 ;
"RTN","PSGOEV",142,0)
DDCHK ; dispense drug check
"RTN","PSGOEV",143,0)
 S DRGF="^PS("_$S(PSGORD["P":"53.1,"_+PSGORD,1:"55,"_PSGP_",5,"_+PSGORD)_",",CHK=$S('$O(@(DRGF_"1,0)")):7,1:0)
"RTN","PSGOEV",144,0)
 S PSGPD=$G(@(DRGF_".2)"))
"RTN","PSGOEV",145,0)
 S CHK=$S('$$DDOK^PSGOE2(DRGF_"1,",PSGPD):7,1:0)
"RTN","PSGOEV",146,0)
 Q:CHK=0
"RTN","PSGOEV",147,0)
 W $C(7),!!,"This order must have at least one valid, active dispense drug to be verified."
"RTN","PSGOEV",148,0)
 ;
"RTN","PSGOEV",149,0)
DDEDIT ;
"RTN","PSGOEV",150,0)
 ;*** Remove all dispense drug for this order
"RTN","PSGOEV",151,0)
 K @(DRGF_"1)")
"RTN","PSGOEV",152,0)
 ; The naked reference below refers to the indirect full reference in DRGF_"1,"_Q_")", which is either ^PS(53.1,+PSGORD,Q) or ^PS(55,DFN,5,+PSGORD,Q)
"RTN","PSGOEV",153,0)
 K ^PS(53.45,PSJSYSP,2) S (X,Q)=0 F  S Q=$O(@(DRGF_"1,"_Q_")")) Q:'Q  S Y=$G(^(Q,0)),X=Q S ^PS(53.45,PSJSYSP,2,Q,0)=Y I Y S ^PS(53.45,PSJSYSP,2,"B",+Y,Q)=""
"RTN","PSGOEV",154,0)
 I X S ^PS(53.45,PSJSYSP,2,0)="^53.4502P^"_X_"^"_X
"RTN","PSGOEV",155,0)
 D ENDRG^PSGOEF1(PSGPD,X)
"RTN","PSGOEV",156,0)
 I 'CHK S %X="^PS(53.45,"_PSJSYSP_",2,",%Y=DRGF_"1," D %XY^%RCR S $P(@(DRGF_"1,0)"),"^",2)=$S(DRGF[53.1:"53.11P",1:"55.07P")
"RTN","PSGOEV",157,0)
 K DRG,DRGF Q
"RTN","PSGOEV",158,0)
 ;
"RTN","PSGOEV",159,0)
AESCREEN() ;
"RTN","PSGOEV",160,0)
 ; Output: 0 - Required fields missing and DON'T allow accept
"RTN","PSGOEV",161,0)
 ;         1 - Required fields found.
"RTN","PSGOEV",162,0)
 Q:'$G(CHK) 1
"RTN","PSGOEV",163,0)
 S Y=$P($G(^ORD(101,+$G(^ORD(101,DA(1),10,DA,0)),0)),U) I Y="" Q 0
"RTN","PSGOEV",164,0)
 I Y="PSJU LM ACCEPT EDIT" Q 1
"RTN","PSGOEV",165,0)
 Q 0
"RTN","PSGOEV",166,0)
ACTLOG(PSGORDP,DFN,PSGORD)  ;Store 53.1 activity log in local array to be moved to 55
"RTN","PSGOEV",167,0)
 ;PSGORDP: IEN from 53.1
"RTN","PSGOEV",168,0)
 ;PSGORD : IEN from 55
"RTN","PSGOEV",169,0)
 NEW PSGX,PSGXDA,PSGAL531,Q,QQ
"RTN","PSGOEV",170,0)
 F PSGX=0:0 S PSGX=$O(^PS(53.1,+PSGORDP,"A",PSGX)) Q:'PSGX  D
"RTN","PSGOEV",171,0)
 . S PSGAL531=$G(^PS(53.1,+PSGORDP,"A",PSGX,0))
"RTN","PSGOEV",172,0)
 . S QQ=$G(^PS(55,DFN,5,+PSGORD,9,0)) S:QQ="" QQ="^55.09D" F Q=$P(QQ,U,3)+1:1 I '$D(^(Q)) S $P(QQ,U,3,4)=Q_U_Q,^(0)=QQ,PSGXDA=Q Q
"RTN","PSGOEV",173,0)
 . S ^PS(55,DFN,5,+PSGORD,9,PSGXDA,0)=PSGAL531
"RTN","PSGOEV",174,0)
 . N TXTLN S TXTLN="" F  S TXTLN=$O(^PS(53.1,+PSGORDP,"A",PSGX,1,TXTLN)) Q:TXTLN=""  D
"RTN","PSGOEV",175,0)
 .. I TXTLN=0 S ^PS(55,DFN,5,+PSGORD,9,PSGXDA,1,TXTLN)=^PS(53.1,+PSGORDP,"A",PSGX,1,TXTLN) Q
"RTN","PSGOEV",176,0)
 .. S ^PS(55,DFN,5,+PSGORD,9,PSGXDA,1,TXTLN,0)=^PS(53.1,+PSGORDP,"A",PSGX,1,TXTLN,0)
"RTN","PSGOEV",177,0)
 Q
"RTN","PSIVSTAT")
0^4^B21471707^B21167755
"RTN","PSIVSTAT",1,0)
PSIVSTAT ;BIR/PR-BUILD COST TRANS NODE, ENTER COMPILE ;6 Nov 98 / 4:45 PM
"RTN","PSIVSTAT",2,0)
 ;;5.0;INPATIENT MEDICATIONS ;**3,18,84,81,104,111,130,199**;16 DEC 97;Build 25
"RTN","PSIVSTAT",3,0)
 ;
"RTN","PSIVSTAT",4,0)
 ; Reference to ^ECXPIV1 is supported by DBIA# 1882.
"RTN","PSIVSTAT",5,0)
 ; Reference to ^PS(52.6 is supported by DBIA# 1231.
"RTN","PSIVSTAT",6,0)
 ; Reference to ^PS(52.7 is supported by DBIA# 2173.
"RTN","PSIVSTAT",7,0)
 ; Reference to ^PS(55 is supported by DBIA# 2191.
"RTN","PSIVSTAT",8,0)
 ; 
"RTN","PSIVSTAT",9,0)
 ;Needs dfn,on,psivnol,psivc (optional:dis/ret/des).
"RTN","PSIVSTAT",10,0)
 ;
"RTN","PSIVSTAT",11,0)
 S PSIVV=1 L +^PS(50.8,PSIVSN):5000
"RTN","PSIVSTAT",12,0)
 I '$G(PSIVC) S PSIVC=$S(($G(PSJRDC)="R"):2,($G(PSJRDC)="D"):3,($G(PSJRDC)]""):4,1:1)
"RTN","PSIVSTAT",13,0)
 ;D NOW^%DTC S (Y,PSIVNOW)=% I '$D(^PS(50.8,PSIVSN,0)) L +^PS(50.8,0) S ^PS(50.8,PSIVSN,0)=PSIVSN,$P(^(0),U,3,4)=PSIVSN_U_($P(^PS(50.8,0),U,4)+1) L -^PS(50.8,0)
"RTN","PSIVSTAT",14,0)
 D NOW^%DTC S (Y,PSIVNOW)=% I '$D(^PS(50.8,PSIVSN,0)) D  S ^PS(50.8,PSIVSN,0)=PSIVSN,$P(^(0),U,3,4)=PSIVSN_U_($P(^PS(50.8,0),U,4)+1) L -^PS(50.8,0)
"RTN","PSIVSTAT",15,0)
 .F  L +^PS(50.8,0):1 Q:$T
"RTN","PSIVSTAT",16,0)
 S $P(^PS(50.8,PSIVSN,1,0),U,1,3)="^50.801P^"_DFN S:'$D(^(DFN,0)) ^(0)=DFN,$P(^(0),U,3,4)=DFN_U_($P(^PS(50.8,PSIVSN,1,0),U,4)+1)
"RTN","PSIVSTAT",17,0)
 S PSIVTN=1 I $D(^PS(50.8,PSIVSN,1,DFN,1,0)) F PSIVTN=$P(^(0),U,3)+1:1 Q:'$D(^PS(50.8,PSIVSN,1,DFN,1,PSIVTN,0))
"RTN","PSIVSTAT",18,0)
 ;
"RTN","PSIVSTAT",19,0)
RETDET ;Get the ward that returns or destroyed need to be associated with.
"RTN","PSIVSTAT",20,0)
 ;RDFLAG & RDWARD ARE set in routine PSIVRD.
"RTN","PSIVSTAT",21,0)
 I $D(RDFLAG) S PSIVWD=RDWARD S:'$D(^PS(55,DFN,"IV",+ON,9)) $P(^(9),U,1,2)="" S $P(^(9),U,3)=$P(^(9),U,3)-PSIVNOL G SKIP
"RTN","PSIVSTAT",22,0)
 ;
"RTN","PSIVSTAT",23,0)
LBWD ;Get the ward we that we are printing labels on.
"RTN","PSIVSTAT",24,0)
 S PSIVWD=$P(^PS(55,DFN,"IV",+ON,0),U,22) G:PSIVWD SKIP
"RTN","PSIVSTAT",25,0)
 S PSIVWD=$S($D(^DPT(DFN,.1)):$O(^DIC(42,"B",^DPT(DFN,.1),0)),1:.5)
"RTN","PSIVSTAT",26,0)
 ;
"RTN","PSIVSTAT",27,0)
SKIP ;
"RTN","PSIVSTAT",28,0)
 ;Set up the transaction node here.
"RTN","PSIVSTAT",29,0)
 S ^PS(50.8,PSIVSN,1,DFN,1,0)="^50.802^"_PSIVTN_U_PSIVTN,^(PSIVTN,0)=PSIVTN_U_+ON_U_PSIVC_U_PSIVNOW_U_PSIVNOL_U_PSIVWD
"RTN","PSIVSTAT",30,0)
 ;
"RTN","PSIVSTAT",31,0)
DSS ; Update DSS for IV extract
"RTN","PSIVSTAT",32,0)
 ;
"RTN","PSIVSTAT",33,0)
 S X="ECXPIV1" X ^%ZOSF("TEST") Q:'$T
"RTN","PSIVSTAT",34,0)
 N ADSTR,ADUNITS,DCST,DDRG,DRG,PROV,SOLSTR,TYP,START,IVROOM,DSDATE,A,B
"RTN","PSIVSTAT",35,0)
 K ^TMP($J)
"RTN","PSIVSTAT",36,0)
 S X=$G(^PS(55,DFN,"IV",+ON,0)),PROV=$P(X,U,6),TYP=$P(X,U,4),START=$P(X,U,2)
"RTN","PSIVSTAT",37,0)
 S A=$G(^PS(55,DFN,"IV",+ON,2)),IVROOM=$P(A,"^",2),B=$G(^PS(55,DFN,"IV",+ON,4)),DSDATE=$S($P(B,"^",2)]"":$P(B,"^",2),1:$P(A,"^"))
"RTN","PSIVSTAT",38,0)
 F DRGTYP="AD","SOL" F DRG=0:0 S DRG=$O(^PS(55,DFN,"IV",+ON,DRGTYP,DRG)) Q:'DRG  D
"RTN","PSIVSTAT",39,0)
 .S ND=$G(^PS(55,DFN,"IV",+ON,DRGTYP,DRG,0)),(ADSTR,ADUNITS,SOLSTR)=""
"RTN","PSIVSTAT",40,0)
 .S @(DRGTYP_"STR")=$P(ND,U,2),ND=$G(^PS($S(DRGTYP="AD":52.6,1:52.7),+ND,0)),DDRG=$P(ND,U,2),DCST=$P(ND,U,7)
"RTN","PSIVSTAT",41,0)
 .I DRGTYP="AD" S Y=$P(ND,U,3) I Y S Y=$$CODES^PSIVUTL(Y,52.6,2) S ADUNITS=Y
"RTN","PSIVSTAT",42,0)
 .S ECUD=DFN_U_+ON_U_DDRG_U_PSIVNOW_U_PSIVC_U_ADSTR_U_ADUNITS_U_+SOLSTR_U_PROV_U_TYP_U_DCST
"RTN","PSIVSTAT",43,0)
 .S ECUD=ECUD_U_$P($G(^PS(55,DFN,"IV",+ON,"DSS")),"^")_U_START_U_IVROOM_U_DSDATE S ^TMP($J,DFN,ON,DDRG)=ECUD N PSII F PSII=1:1:PSIVNOL D ^ECXPIV1
"RTN","PSIVSTAT",44,0)
Q1 L -^PS(50.8,PSIVSN) K PSIVD,PSIVTN,PSIVV,PSIVWD,PSIVLP Q
"RTN","PSIVSTAT",45,0)
 ;
"RTN","PSIVSTAT",46,0)
EN ;Compile IV stats hold file here.
"RTN","PSIVSTAT",47,0)
 I $D(PSIVSITE),$D(PSIVSN) K ZTSAVE S ZTDTH=$H,ZTDESC="COMPILE IV STATS (FROM MENU)",ZTRTN="EN^PSIVSTAT",ZTIO="" D ^%ZTLOAD W:$D(ZTSK) !,"Queued." G Q
"RTN","PSIVSTAT",48,0)
 ;K ^TMP("PSIVNC",$J) S PSIVV=1,X="T-"_$S(+$G(^PS(59.7,1,31)):+^(31),1:100),%DT="" D ^%DT
"RTN","PSIVSTAT",49,0)
 ;F X=0:0 S X=$O(^PS(50.8,X)) Q:'X  F I=0:0 S I=$O(^PS(50.8,X,2,I)) Q:'I  I I<Y K ^PS(50.8,X,2,I) S $P(^(0),U,4)=$P(^(0),U,4)-1
"RTN","PSIVSTAT",50,0)
 K ^TMP("PSIVNC",$J) F Q=0:0 S Q=$O(^PS(50.8,Q)) Q:'Q  D
"RTN","PSIVSTAT",51,0)
 .S X="T-"_$S($P($G(^PS(59.5,Q,1)),U,19):$P(^(1),U,19),1:100) D ^%DT
"RTN","PSIVSTAT",52,0)
 .F I=0:0 S I=$O(^PS(50.8,Q,2,I)) Q:'I  I I<Y K ^PS(50.8,Q,2,I) S $P(^(0),U,4)=$P(^(0),U,4)-1
"RTN","PSIVSTAT",53,0)
 ;F PSIVS=0:0 S PSIVS=$O(^PS(50.8,PSIVS)) Q:'PSIVS  L +^PS(50.8,PSIVS,0) D CNT L -^PS(50.8,PSIVS,0)
"RTN","PSIVSTAT",54,0)
 F PSIVS=0:0 S PSIVS=$O(^PS(50.8,PSIVS)) Q:'PSIVS  D  D CNT L -^PS(50.8,PSIVS,0)
"RTN","PSIVSTAT",55,0)
 .F  L +^PS(50.8,PSIVS,0):1 Q:$T
"RTN","PSIVSTAT",56,0)
Q K D,PSGDT,PSIVNOL,PSIVD,PSIVC,PSIVS,PSIVV,%DT,Z,ZTSK,DFN,PSIV,PNL,POP,LO,IV,PSIVDG,PSIVDRG D ENIVKV^PSGSETU Q
"RTN","PSIVSTAT",57,0)
CNT F DFN=0:0 S DFN=$O(^PS(50.8,PSIVS,1,DFN)) Q:'DFN  F TN=0:0 S TN=$O(^PS(50.8,PSIVS,1,DFN,1,TN)) Q:'TN  D SET
"RTN","PSIVSTAT",58,0)
 S:$D(ZTQUEUED) ZTREQ="@" I $D(^TMP("PSIVNC",$J)) D MSG K TN,ZTIO,ZTRTN,X,Y Q
"RTN","PSIVSTAT",59,0)
 K ^PS(50.8,PSIVS,1),TN,ZTIO,ZTRTN,X,Y Q
"RTN","PSIVSTAT",60,0)
SET S TN=^PS(50.8,PSIVS,1,DFN,1,TN,0),ON=$P(TN,U,2),PSIVC=$P(TN,U,3),PSIVNOL=$P(TN,U,5),W42=$P(TN,U,6),PSIVD=$P(TN,U,4)\1
"RTN","PSIVSTAT",61,0)
 F PSIVDG=52.6,52.7 F I=0:0 S I=$O(^PS(55,DFN,"IV",+ON,$S(PSIVDG=52.6:"AD",1:"SOL"),I)) Q:'I!($D(NON))  S PSIVDRG=+^(I,0) I $P(^PS(PSIVDG,PSIVDRG,0),U,7)="" S NON=1 D NOCOST
"RTN","PSIVSTAT",62,0)
 I $D(NON) K PSIVDG,PSIVDRG,NON Q
"RTN","PSIVSTAT",63,0)
 D ^PSIVST2 K ^PS(50.8,PSIVS,1,DFN,1,+TN) Q
"RTN","PSIVSTAT",64,0)
NOCOST ;Send message if the drug is missing a unit cost.
"RTN","PSIVSTAT",65,0)
 ;
"RTN","PSIVSTAT",66,0)
 S $P(^PS(50.8,PSIVS,1,DFN,1,+TN,0),U,7)=PSIVDG_";"_PSIVDRG,NUM=$S('$D(NUM):1,1:NUM+1),^TMP($J,"PSIVNC",NUM,0)=$P(^PS(PSIVDG,PSIVDRG,0),U)_" IN THE "_$S(PSIVDG=52.6:"ADDITIVES",1:"SOLUTIONS")_" FILE." Q
"RTN","PSIVSTAT",67,0)
MSG S XMDUZ="IV PHARMACY PACKAGE",XMSUB="MISSING COST INFORMATION",XMTEXT="^TMP(""PSIVNC"",$J,"
"RTN","PSIVSTAT",68,0)
 F PSIVDUZ=0:0 S PSIVDUZ=$O(^XUSEC("PSJI MGR",PSIVDUZ)) Q:'PSIVDUZ  S XMY(PSIVDUZ)=""
"RTN","PSIVSTAT",69,0)
 D ^XMD K TMP("PSIVNC",$J),XMY,XMDUZ,NUM,XMTEXT,PSIVDUZ,XMSUB
"RTN","PSIVSTAT",70,0)
 Q
"VER")
8.0^22.0
"BLD",8736,6)
^258
**END**
**END**

