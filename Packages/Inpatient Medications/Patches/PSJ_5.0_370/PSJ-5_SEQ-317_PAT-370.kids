Released PSJ*5*370 SEQ #317
Extracted from mail message
**KIDS**:PSJ*5.0*370^

**INSTALL NAME**
PSJ*5.0*370
"BLD",11116,0)
PSJ*5.0*370^INPATIENT MEDICATIONS^0^3180712^y
"BLD",11116,1,0)
^^2^2^3180712^
"BLD",11116,1,1,0)
1)  Incomplete Medication Order Information
"BLD",11116,1,2,0)
2)  Special Instructions lost when new order is created due to edit
"BLD",11116,4,0)
^9.64PA^^
"BLD",11116,6.3)
6
"BLD",11116,"KRN",0)
^9.67PA^779.2^20
"BLD",11116,"KRN",.4,0)
.4
"BLD",11116,"KRN",.401,0)
.401
"BLD",11116,"KRN",.402,0)
.402
"BLD",11116,"KRN",.403,0)
.403
"BLD",11116,"KRN",.5,0)
.5
"BLD",11116,"KRN",.84,0)
.84
"BLD",11116,"KRN",3.6,0)
3.6
"BLD",11116,"KRN",3.8,0)
3.8
"BLD",11116,"KRN",9.2,0)
9.2
"BLD",11116,"KRN",9.8,0)
9.8
"BLD",11116,"KRN",9.8,"NM",0)
^9.68A^2^2
"BLD",11116,"KRN",9.8,"NM",1,0)
PSJBCMA2^^0^B58323287
"BLD",11116,"KRN",9.8,"NM",2,0)
PSJBCMA5^^0^B81407826
"BLD",11116,"KRN",9.8,"NM","B","PSJBCMA2",1)

"BLD",11116,"KRN",9.8,"NM","B","PSJBCMA5",2)

"BLD",11116,"KRN",19,0)
19
"BLD",11116,"KRN",19.1,0)
19.1
"BLD",11116,"KRN",101,0)
101
"BLD",11116,"KRN",409.61,0)
409.61
"BLD",11116,"KRN",771,0)
771
"BLD",11116,"KRN",779.2,0)
779.2
"BLD",11116,"KRN",870,0)
870
"BLD",11116,"KRN",8989.51,0)
8989.51
"BLD",11116,"KRN",8989.52,0)
8989.52
"BLD",11116,"KRN",8994,0)
8994
"BLD",11116,"KRN","B",.4,.4)

"BLD",11116,"KRN","B",.401,.401)

"BLD",11116,"KRN","B",.402,.402)

"BLD",11116,"KRN","B",.403,.403)

"BLD",11116,"KRN","B",.5,.5)

"BLD",11116,"KRN","B",.84,.84)

"BLD",11116,"KRN","B",3.6,3.6)

"BLD",11116,"KRN","B",3.8,3.8)

"BLD",11116,"KRN","B",9.2,9.2)

"BLD",11116,"KRN","B",9.8,9.8)

"BLD",11116,"KRN","B",19,19)

"BLD",11116,"KRN","B",19.1,19.1)

"BLD",11116,"KRN","B",101,101)

"BLD",11116,"KRN","B",409.61,409.61)

"BLD",11116,"KRN","B",771,771)

"BLD",11116,"KRN","B",779.2,779.2)

"BLD",11116,"KRN","B",870,870)

"BLD",11116,"KRN","B",8989.51,8989.51)

"BLD",11116,"KRN","B",8989.52,8989.52)

"BLD",11116,"KRN","B",8994,8994)

"BLD",11116,"QDEF")
^^^^NO^^^^^^NO
"BLD",11116,"QUES",0)
^9.62^^
"BLD",11116,"REQB",0)
^9.611^1^1
"BLD",11116,"REQB",1,0)
PSJ*5.0*371^2
"BLD",11116,"REQB","B","PSJ*5.0*371",1)

"MBREQ")
0
"PKG",471,-1)
1^1
"PKG",471,0)
INPATIENT MEDICATIONS^PSJ^UNIT DOSE AND IVS
"PKG",471,20,0)
^9.402P^^
"PKG",471,22,0)
^9.49I^1^1
"PKG",471,22,1,0)
5.0^2971215^2990325^66481
"PKG",471,22,1,"PAH",1,0)
370^3180712
"PKG",471,22,1,"PAH",1,1,0)
^^2^2^3180712
"PKG",471,22,1,"PAH",1,1,1,0)
1)  Incomplete Medication Order Information
"PKG",471,22,1,"PAH",1,1,2,0)
2)  Special Instructions lost when new order is created due to edit
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
2
"RTN","PSJBCMA2")
0^1^B58323287^B57484334
"RTN","PSJBCMA2",1,0)
PSJBCMA2 ;BIR/MV - RETURN INPATIENT ACTIVITY LOG ;16 Mar 99 / 11:43 AM
"RTN","PSJBCMA2",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**32,41,54,56,81,267,370**;16 DEC 97;Build 6
"RTN","PSJBCMA2",3,0)
 ;
"RTN","PSJBCMA2",4,0)
 ;Reference to ^PS(55 is supported by DBIA 2191
"RTN","PSJBCMA2",5,0)
 ;
"RTN","PSJBCMA2",6,0)
EN(DFN,ON,PSJTMP)         ;
"RTN","PSJBCMA2",7,0)
 NEW X,Y
"RTN","PSJBCMA2",8,0)
 S PSJINX=0
"RTN","PSJBCMA2",9,0)
 S PSJTMP=$S($G(PSJTMP)=1:"PSJ2",1:"PSJ")
"RTN","PSJBCMA2",10,0)
 I $G(ON)["U",$D(^PS(55,+$G(DFN),5,+ON)) D UD
"RTN","PSJBCMA2",11,0)
 I $G(ON)["V",$D(^PS(55,+$G(DFN),"IV",+ON)) D IV
"RTN","PSJBCMA2",12,0)
 I '$D(^TMP(PSJTMP,$J,0)) S ^(0)=-1
"RTN","PSJBCMA2",13,0)
 K PSJINX
"RTN","PSJBCMA2",14,0)
 Q
"RTN","PSJBCMA2",15,0)
UD ;Get Activity Log for Unit Dose order.
"RTN","PSJBCMA2",16,0)
 N PSJVFDTM
"RTN","PSJBCMA2",17,0)
 F PSJAL=0:0 S PSJAL=$O(^PS(55,DFN,5,+ON,9,PSJAL)) Q:'PSJAL  D
"RTN","PSJBCMA2",18,0)
 . S X=$G(^PS(55,DFN,5,+ON,9,PSJAL,0))
"RTN","PSJBCMA2",19,0)
 . S PSJ("DATE")=$P(X,U)
"RTN","PSJBCMA2",20,0)
 . S (PSJ("USER"),PSJ("UIEN"))=$P(X,U,2),PSJ("FIELD")=$P(X,U,4)
"RTN","PSJBCMA2",21,0)
 . S PSJ("OLD DATA")=$P(X,U,5)
"RTN","PSJBCMA2",22,0)
 . S PSJ("ACTION")=$P($G(^PS(53.3,+$P(X,U,3),0)),U)
"RTN","PSJBCMA2",23,0)
 . I PSJ("ACTION")="VERIFIED BY PHARMACIST" S PSJVFDTM=PSJ("DATE")
"RTN","PSJBCMA2",24,0)
 . I PSJ("FIELD")="SPECIAL INSTRUCTIONS",PSJ("ACTION")="EDITED" Q:PSJ("DATE")=$G(PSJVFDTM)
"RTN","PSJBCMA2",25,0)
 . D TMP K PSJ
"RTN","PSJBCMA2",26,0)
 K PSJAL
"RTN","PSJBCMA2",27,0)
 Q
"RTN","PSJBCMA2",28,0)
IV ;Get Activity Log for IV order.
"RTN","PSJBCMA2",29,0)
 F PSJAL=0:0 S PSJAL=$O(^PS(55,DFN,"IV",+ON,"A",PSJAL)) Q:'PSJAL  D
"RTN","PSJBCMA2",30,0)
 . K PSJ,PSJDD
"RTN","PSJBCMA2",31,0)
 . S X=$G(^PS(55,DFN,"IV",+ON,"A",PSJAL,0))
"RTN","PSJBCMA2",32,0)
 . S PSJ("DATE")=$P(X,U,5)
"RTN","PSJBCMA2",33,0)
 . S PSJ("ACTION")=$P(X,U,2) Q:PSJ("ACTION")="F"
"RTN","PSJBCMA2",34,0)
 . S PSJ("USER")=$P(X,U,3)
"RTN","PSJBCMA2",35,0)
 . S PSJ("REASON")=$P(X,U,4)
"RTN","PSJBCMA2",36,0)
 . S PSJ("ACTION")=$$CODES^PSIVUTL(PSJ("ACTION"),55.04,.02)
"RTN","PSJBCMA2",37,0)
 . S PSJ("UIEN")=$P(X,U,6)
"RTN","PSJBCMA2",38,0)
 . I PSJAL=1,($G(^PS(55,DFN,"IV",+ON,"A",PSJAL,1,1,0))["OTHER PRINT INFO") Q
"RTN","PSJBCMA2",39,0)
 . I $O(^PS(55,DFN,"IV",+ON,"A",PSJAL,1,0))="" D TMP
"RTN","PSJBCMA2",40,0)
 . F PSJFC=0:0 S PSJFC=$O(^PS(55,DFN,"IV",+ON,"A",PSJAL,1,PSJFC)) Q:'PSJFC  D
"RTN","PSJBCMA2",41,0)
 .. S X=$G(^PS(55,DFN,"IV",+ON,"A",PSJAL,1,PSJFC,0))
"RTN","PSJBCMA2",42,0)
 .. K PSJ("FIELD"),PSJ("OLD DATA")
"RTN","PSJBCMA2",43,0)
 .. S PSJ("FIELD")=$P(X,U)
"RTN","PSJBCMA2",44,0)
 .. S PSJ("OLD DATA")=$P(X,U,2)
"RTN","PSJBCMA2",45,0)
 .. D TMP
"RTN","PSJBCMA2",46,0)
 K PSJ,PSJAL,PSJFC
"RTN","PSJBCMA2",47,0)
 Q
"RTN","PSJBCMA2",48,0)
TMP ;Setup ^TMP
"RTN","PSJBCMA2",49,0)
 S PSJINX=PSJINX+1
"RTN","PSJBCMA2",50,0)
 I +PSJ("USER") D NAME^PSJBCMA1(+PSJ("USER"),.X,"") S PSJ("USER")=X
"RTN","PSJBCMA2",51,0)
 S ^TMP(PSJTMP,$J,0)=DFN_U_+ON_U_ON_U_PSJINX
"RTN","PSJBCMA2",52,0)
 S ^TMP(PSJTMP,$J,PSJINX,1)=PSJ("DATE")_U_PSJ("USER")_U_$G(PSJ("FIELD"))_U_PSJ("ACTION")_U_$G(PSJ("UIEN"))
"RTN","PSJBCMA2",53,0)
 S:$G(PSJ("OLD DATA"))]"" ^TMP(PSJTMP,$J,PSJINX,2)=PSJ("OLD DATA")
"RTN","PSJBCMA2",54,0)
 S:$G(PSJ("REASON"))]"" ^TMP(PSJTMP,$J,PSJINX,3)=PSJ("REASON")
"RTN","PSJBCMA2",55,0)
 Q
"RTN","PSJBCMA2",56,0)
GETFLD  ;
"RTN","PSJBCMA2",57,0)
 N X D FIELD^DID(55.04,.02,"","POINTER","PSJDD") Q
"RTN","PSJBCMA2",58,0)
 Q
"RTN","PSJBCMA2",59,0)
 ;
"RTN","PSJBCMA2",60,0)
FILESI(DFN,PSJORD) ; File special instructions
"RTN","PSJBCMA2",61,0)
 I PSJORD["U" S LN=0 D
"RTN","PSJBCMA2",62,0)
 .I $G(PSGOEENO)&($G(PSGORD)=$G(PSJORD)) Q
"RTN","PSJBCMA2",63,0)
 .K ^PS(55,DFN,5,+PSJORD,15) I ($G(^PS(53.45,+$G(PSJSYSP),5,0))<0) S ^PS(55,DFN,5,+PSJORD,6)="" Q
"RTN","PSJBCMA2",64,0)
 .I '$D(^PS(55,DFN,5,+PSJORD,15,1,0)),($O(^PS(53.45,+$G(PSJSYSP),5," "),-1)=1) Q:($TR(^PS(53.45,PSJSYSP,5,1,0)," ")="")
"RTN","PSJBCMA2",65,0)
 .S LNCNT=0,LN=9999 F  S LN=$O(^PS(53.45,+$G(PSJSYSP),5,LN),-1) Q:'LN  D
"RTN","PSJBCMA2",66,0)
 ..I 'LNCNT,($G(^PS(53.45,+$G(PSJSYSP),5,LN,0))="") Q
"RTN","PSJBCMA2",67,0)
 ..I $D(^PS(53.45,+$G(PSJSYSP),5,LN,0)) S ^PS(55,+DFN,5,+PSJORD,15,LN,0)=^PS(53.45,+$G(PSJSYSP),5,LN,0) S LNCNT=LNCNT+1
"RTN","PSJBCMA2",68,0)
 .I $G(LNCNT) S ^PS(55,+DFN,5,+PSJORD,15,0)="^55.6135^"_+LNCNT_"^"_+LNCNT D
"RTN","PSJBCMA2",69,0)
 ..N TXT,SIMSG S SIMSG="Instructions too long. See Order View or BCMA for full text."
"RTN","PSJBCMA2",70,0)
 ..S PSJTMPTX="",PSJOVRMX=0 S TMPLIN=0 F  S TMPLIN=$O(^PS(55,+DFN,5,+PSJORD,15,TMPLIN)) Q:'TMPLIN!(PSJOVRMX)  D
"RTN","PSJBCMA2",71,0)
 ...S:($L(PSJTMPTX)+$L($G(^PS(55,+DFN,5,+PSJORD,15,TMPLIN,0))))>180 PSJOVRMX=1 Q:$G(PSJOVRMX)  S PSJTMPTX=$G(PSJTMPTX)_$S($G(PSJTMPTX)]"":" ",1:"")_$G(^PS(55,+DFN,5,+PSJORD,15,TMPLIN,0))
"RTN","PSJBCMA2",72,0)
 ..S TXT=$S($G(PSJOVRMX):SIMSG,1:PSJTMPTX)
"RTN","PSJBCMA2",73,0)
 ..I $G(DFN) I $D(^PS(55,DFN,5,+PSJORD,0)) S ^PS(55,DFN,5,+PSJORD,6)=TXT_"^"_$S($G(PSGSIF):1,1:"")
"RTN","PSJBCMA2",74,0)
 .N LSTLNUM,LSTLNTXT S LSTLNUM=$O(^PS(55,+DFN,5,+PSJORD,15,""),-1) I LSTLNUM>1 S LSTLNTXT=$G(^PS(55,+DFN,5,+PSJORD,15,LSTLNUM,0)) I $TR(LSTLNTXT," ")="" D
"RTN","PSJBCMA2",75,0)
 ..K ^PS(55,+DFN,5,+PSJORD,15,LSTLNUM,0)
"RTN","PSJBCMA2",76,0)
 I PSJORD["P" S LN=0 D
"RTN","PSJBCMA2",77,0)
 .N PSGSIF S PSGSIF=+$P($G(^PS(53.1,+PSJORD,6)),"^",2)
"RTN","PSJBCMA2",78,0)
 .I $G(PSGOEENO)'=1 K ^PS(53.1,+PSJORD,15)
"RTN","PSJBCMA2",79,0)
 .I ($G(^PS(53.45,+$G(PSJSYSP),5,0))<0) S ^PS(53.1,+PSJORD,6)="",^PS(53.1,+PSJORD,15,0)="^53.1135^0^0" Q
"RTN","PSJBCMA2",80,0)
 .I '$D(^PS(53.1,+PSJORD,15,1,0)),($O(^PS(53.45,+$G(PSJSYSP),5," "),-1)=1) Q:($TR(^PS(53.45,PSJSYSP,5,1,0)," ")="")
"RTN","PSJBCMA2",81,0)
 .S LNCNT=0,LN=9999 F  S LN=$O(^PS(53.45,+$G(PSJSYSP),5,LN),-1) Q:'LN  D
"RTN","PSJBCMA2",82,0)
 ..I 'LNCNT,($G(^PS(53.45,+$G(PSJSYSP),5,LN,0))="") Q
"RTN","PSJBCMA2",83,0)
 ..I $D(^PS(53.45,+$G(PSJSYSP),5,LN,0)) S ^PS(53.1,+PSJORD,15,LN,0)=^PS(53.45,+$G(PSJSYSP),5,LN,0) S LNCNT=LNCNT+1
"RTN","PSJBCMA2",84,0)
 .I $G(LNCNT) S ^PS(53.1,+PSJORD,15,0)="^53.1135^"_+LNCNT_"^"_+LNCNT D
"RTN","PSJBCMA2",85,0)
 ..N TXT,SIMSG S SIMSG="Instructions too long. See Order View or BCMA for full text."
"RTN","PSJBCMA2",86,0)
 ..S PSJTMPTX="",PSJOVRMX=0 S TMPLIN=0 F  S TMPLIN=$O(^PS(53.1,+PSJORD,15,TMPLIN)) Q:'TMPLIN!(PSJOVRMX)  D
"RTN","PSJBCMA2",87,0)
 ...S:($L(PSJTMPTX)+$L($G(^PS(53.1,+PSJORD,15,TMPLIN,0))))>180 PSJOVRMX=1 Q:$G(PSJOVRMX)  S PSJTMPTX=$G(PSJTMPTX)_$S($G(PSJTMPTX)]"":" ",1:"")_$G(^PS(53.1,+PSJORD,15,TMPLIN,0))
"RTN","PSJBCMA2",88,0)
 ..S TXT=$S($G(PSJOVRMX):SIMSG,1:PSJTMPTX)
"RTN","PSJBCMA2",89,0)
 ..I $D(^PS(53.1,+$G(PSJORD),0)) S ^PS(53.1,+PSJORD,6)=TXT_"^"_$S($G(PSGSIF):1,1:"")
"RTN","PSJBCMA2",90,0)
 .N LSTLNUM,LSTLNTXT S LSTLNUM=$O(^PS(53.1,+PSJORD,15,""),-1) I LSTLNUM>1 S LSTLNTXT=$G(^PS(53.1,+PSJORD,15,LSTLNUM,0)) I $TR(LSTLNTXT," ")="" D
"RTN","PSJBCMA2",91,0)
 ..K ^PS(53.1,+PSJORD,15,LSTLNUM,0)
"RTN","PSJBCMA2",92,0)
 Q
"RTN","PSJBCMA2",93,0)
FILEOPI(DFN,ORDER) ; File other print info
"RTN","PSJBCMA2",94,0)
 I PSJORD["V" S LN=0 D
"RTN","PSJBCMA2",95,0)
 .D LOGOPI^PSIVORFB(DFN,ORDER)
"RTN","PSJBCMA2",96,0)
 .K ^PS(55,+DFN,"IV",+PSJORD,10) S ^PS(55,+DFN,"IV",+PSJORD,3)="" I '$D(^PS(53.45,+$G(PSJSYSP),6,2,0))&(($G(^PS(53.45,+$G(PSJSYSP),6,1,0))=-1)!($G(^PS(53.45,+$G(PSJSYSP),6,0))=-1)) D  Q
"RTN","PSJBCMA2",97,0)
 ..S ^PS(55,+DFN,"IV",+PSJORD,10,0)="^55.1154^1^1",^PS(55,+DFN,"IV",PSJORD,10,1,0)=""
"RTN","PSJBCMA2",98,0)
 .I '$D(^PS(55,DFN,"IV",+PSJORD,10,1,0)),($O(^PS(53.45,+$G(PSJSYSP),6," "),-1)=1) I ($TR(^PS(53.45,PSJSYSP,6,1,0)," ")="") D  Q
"RTN","PSJBCMA2",99,0)
 ..S ^PS(55,+DFN,"IV",+PSJORD,10,0)="^55.1154^1^1",^PS(55,+DFN,"IV",+PSJORD,10,1,0)=""
"RTN","PSJBCMA2",100,0)
 .S LNCNT=0,LN=9999 F  S LN=$O(^PS(53.45,+$G(PSJSYSP),6,LN),-1) Q:'LN  D
"RTN","PSJBCMA2",101,0)
 ..I 'LNCNT,($G(^PS(53.45,+$G(PSJSYSP),6,LN,0))="") Q
"RTN","PSJBCMA2",102,0)
 ..I $D(^PS(53.45,+$G(PSJSYSP),6,LN,0)) S ^PS(55,+DFN,"IV",+PSJORD,10,LN,0)=^PS(53.45,+$G(PSJSYSP),6,LN,0) S LNCNT=LNCNT+1
"RTN","PSJBCMA2",103,0)
 .I LNCNT S ^PS(55,+DFN,"IV",+PSJORD,10,0)="^55.1154^"_+LNCNT_"^"_+LNCNT D
"RTN","PSJBCMA2",104,0)
 ..N TXT,DIE,DA,OPIMSG S OPIMSG="Instructions too long. See Order View or BCMA for full text."
"RTN","PSJBCMA2",105,0)
 ..S PSJTMPTX="",PSJOVRMX=0 S TMPLIN=0 F  S TMPLIN=$O(^PS(55,+DFN,"IV",+PSJORD,10,TMPLIN)) Q:'TMPLIN!(PSJOVRMX)  D
"RTN","PSJBCMA2",106,0)
 ...S:($L(PSJTMPTX)+$L($G(^PS(55,DFN,"IV",+PSJORD,10,TMPLIN,0))))>60 PSJOVRMX=1 Q:$G(PSJOVRMX)  S PSJTMPTX=$G(PSJTMPTX)_$S($G(PSJTMPTX)]"":" ",1:"")_$G(^PS(55,DFN,"IV",+PSJORD,10,TMPLIN,0))
"RTN","PSJBCMA2",107,0)
 ..S TXT=$S($G(PSJOVRMX):OPIMSG,1:$G(PSJTMPTX))
"RTN","PSJBCMA2",108,0)
 ..I $TR(TXT,"^ ")="" S ^PS(55,DFN,"IV",+PSJORD,3)="" Q
"RTN","PSJBCMA2",109,0)
 ..S ^PS(55,DFN,"IV",+PSJORD,3)=TXT_"^"_$P($G(P("OPI")),"^",2)
"RTN","PSJBCMA2",110,0)
 I PSJORD["P" D
"RTN","PSJBCMA2",111,0)
 .I $D(^PS(53.1,+PSJORD,16)),$$DIFFOPI^PSJBCMA5(DFN,PSJORD) D
"RTN","PSJBCMA2",112,0)
 ..N SIARRAY,PSJALORD M SIARRAY=^PS(53.1,+PSJORD,16),PSJALORD=PSJORD I '$D(SIARRAY) S SIARRAY(0)="^^1^1",SIARRAY(1,0)=" "
"RTN","PSJBCMA2",113,0)
 ..D NEWNVAL^PSGAL5(PSJORD,6000,"OTHER PRINT INFO",,.SIARRAY)
"RTN","PSJBCMA2",114,0)
 .K ^PS(53.1,+PSJORD,16) I ('$D(^PS(53.45,+$G(PSJSYSP),6,2,0))&($TR($G(^PS(53.45,+$G(PSJSYSP),6,1,0)),"^ ")=""))!+($G(^PS(53.45,+$G(PSJSYSP),6,0))=-1) D  Q
"RTN","PSJBCMA2",115,0)
 ..S ^PS(53.1,+PSJORD,9)="",^PS(53.1,+PSJORD,16,0)="^53.1136^1^1",^PS(53.1,+PSJORD,16,1,0)=""
"RTN","PSJBCMA2",116,0)
 .I '$D(^PS(53.1,+PSJORD,16,1,0)),($O(^PS(53.45,+$G(PSJSYSP),6," "),-1)=1) I ($TR(^PS(53.45,PSJSYSP,6,1,0)," ")="") D  Q
"RTN","PSJBCMA2",117,0)
 ..S ^PS(53.1,+PSJORD,9)="",^PS(53.1,+PSJORD,16,0)="^53.1136^1^1",^PS(53.1,+PSJORD,16,1,0)=""
"RTN","PSJBCMA2",118,0)
 .S LNCNT=0,LN=9999 F  S LN=$O(^PS(53.45,+PSJSYSP,6,LN),-1) Q:'LN  D
"RTN","PSJBCMA2",119,0)
 ..I 'LNCNT,($G(^PS(53.45,+PSJSYSP,6,LN,0))="") Q
"RTN","PSJBCMA2",120,0)
 ..I $D(^PS(53.45,+PSJSYSP,6,LN,0)) S ^PS(53.1,+PSJORD,16,LN,0)=^PS(53.45,+PSJSYSP,6,LN,0) S LNCNT=LNCNT+1
"RTN","PSJBCMA2",121,0)
 .I $G(LNCNT) S ^PS(53.1,+PSJORD,16,0)="^53.1136^"_+LNCNT_"^"_+LNCNT D
"RTN","PSJBCMA2",122,0)
 ..N TXT,DIE,DA,OPIMSG S OPIMSG="Instructions too long. See Order View or BCMA for full text."
"RTN","PSJBCMA2",123,0)
 ..S PSJTMPTX="",PSJOVRMX=0 S TMPLIN=0 F  S TMPLIN=$O(^PS(53.1,+PSJORD,16,TMPLIN)) Q:'TMPLIN!(PSJOVRMX)  D
"RTN","PSJBCMA2",124,0)
 ...S:($L(PSJTMPTX)+$L($G(^PS(53.1,+PSJORD,16,TMPLIN,0))))>60 PSJOVRMX=1 Q:$G(PSJOVRMX)  S PSJTMPTX=$G(PSJTMPTX)_$S($G(PSJTMPTX)]"":" ",1:"")_$G(^PS(53.1,+PSJORD,16,TMPLIN,0))
"RTN","PSJBCMA2",125,0)
 ..S TXT=$S($G(PSJOVRMX):OPIMSG,1:$G(PSJTMPTX))
"RTN","PSJBCMA2",126,0)
 ..S $P(^PS(53.1,+PSJORD,9),"^",2)=TXT,$P(^PS(53.1,+PSJORD,9),"^",3)=$P($G(P("OPI")),"^",2)
"RTN","PSJBCMA2",127,0)
 Q
"RTN","PSJBCMA5")
0^2^B81407826^B80438277
"RTN","PSJBCMA5",1,0)
PSJBCMA5 ;BIR/JCH - RETRIEVE SPECIAL INSTRUCTIONS/OTHER PRINT INFO ; 1/9/12 11:12am
"RTN","PSJBCMA5",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**267,275,361,371,370**;16 DEC 97;Build 6
"RTN","PSJBCMA5",3,0)
 ;
"RTN","PSJBCMA5",4,0)
 ;Reference to ^DPT is supported by DBIA 10035
"RTN","PSJBCMA5",5,0)
 ;Reference to ^PS(55 is supported by DBIA 2191
"RTN","PSJBCMA5",6,0)
 ;Reference to ^%DTC is supported by DBIA 10000
"RTN","PSJBCMA5",7,0)
 ;Reference to ^DIE is supported by DBIA 10018
"RTN","PSJBCMA5",8,0)
 ;Reference to ^DIQ is supported by DBIA 2056
"RTN","PSJBCMA5",9,0)
 ;
"RTN","PSJBCMA5",10,0)
GETSIOPI(DFN,ON,BCMA) ; Get appropriate field depending on order type
"RTN","PSJBCMA5",11,0)
 ; DFN - Patient IEN
"RTN","PSJBCMA5",12,0)
 ; ON - Inpatient Order number
"RTN","PSJBCMA5",13,0)
 ; BCMA - Flag indicating called from BCMA - return data in ^TMP("PSJBCMA",$J
"RTN","PSJBCMA5",14,0)
 ;
"RTN","PSJBCMA5",15,0)
 I 'ON!'DFN Q 0
"RTN","PSJBCMA5",16,0)
 K ^TMP("PSJBCMA5",$J,DFN,ON)
"RTN","PSJBCMA5",17,0)
 I '$G(PSJSYSP),'$G(BCMA) N PSJSYSP S PSJSYSP=$J
"RTN","PSJBCMA5",18,0)
 I $G(BCMA) D  Q +$G(^TMP("PSJBCMA5",$J,DFN,ON))
"RTN","PSJBCMA5",19,0)
 .N PSJSYSP S PSJSYSP=$J
"RTN","PSJBCMA5",20,0)
 .I ON["V"!((ON["P")&($D(^PS(53.1,+ON,"AD"))!$D(^PS(53.1,+ON,"SOL")))) D  Q
"RTN","PSJBCMA5",21,0)
 ..I $$GETOPI(DFN,ON,1) D MOVETMP(DFN,ON,"IV")
"RTN","PSJBCMA5",22,0)
 .I $$GETSI(DFN,ON,1) D MOVETMP(DFN,ON,"UD")
"RTN","PSJBCMA5",23,0)
 I ON["V"!((ON["P")&($D(^PS(53.1,+ON,"AD"))!$D(^PS(53.1,+ON,"SOL")))) Q $$GETOPI(DFN,ON)
"RTN","PSJBCMA5",24,0)
 Q $$GETSI(DFN,ON)
"RTN","PSJBCMA5",25,0)
 ;
"RTN","PSJBCMA5",26,0)
MOVETMP(DFN,ON,OTYP) ; Move text from PS(53.45 to ^TMP for BCMA
"RTN","PSJBCMA5",27,0)
 N LN,ND S ND=$S(OTYP="IV":6,1:5)
"RTN","PSJBCMA5",28,0)
 I $O(^PS(53.45,PSJSYSP,ND," "),-1)=1,$TR(^PS(53.45,PSJSYSP,ND,1,0)," ")="" K ^TMP("PSJBCMA5",$J) Q
"RTN","PSJBCMA5",29,0)
 S ^TMP("PSJBCMA5",$J,DFN,ON)=+$P(^PS(53.45,PSJSYSP,ND,0),"^",3) S LN=0 F  S LN=$O(^PS(53.45,PSJSYSP,ND,LN)) Q:'LN  D
"RTN","PSJBCMA5",30,0)
 .S ^TMP("PSJBCMA5",$J,DFN,ON,LN)=^PS(53.45,PSJSYSP,ND,LN,0)
"RTN","PSJBCMA5",31,0)
 K ^PS(53.45,PSJSYSP,ND)
"RTN","PSJBCMA5",32,0)
 Q
"RTN","PSJBCMA5",33,0)
 ;
"RTN","PSJBCMA5",34,0)
GETSI(DFN,ON,BC) ; Get Special Instructions for Unit Dose orders
"RTN","PSJBCMA5",35,0)
 N PSJTXT,TXTLN
"RTN","PSJBCMA5",36,0)
 I $G(DFN)=""!($G(ON)="") Q 0
"RTN","PSJBCMA5",37,0)
 I '$G(PSJSYSP) N PSJSYSP S PSJSYSP=$J
"RTN","PSJBCMA5",38,0)
 I ON["P" D  Q +$P($G(^PS(53.45,+PSJSYSP,5,0)),"^",3)
"RTN","PSJBCMA5",39,0)
 .Q:($G(^PS(53.45,+PSJSYSP,5,0))="^^0^0")
"RTN","PSJBCMA5",40,0)
 .I $G(PSGOEENO)&($G(PSGOORD)=$G(PSJORD)) Q
"RTN","PSJBCMA5",41,0)
 .I $P($G(^PS(53.1,+ON,15,0)),"^",3) D  Q
"RTN","PSJBCMA5",42,0)
 ..S ^PS(53.45,+PSJSYSP,5,0)=^PS(53.1,+ON,15,0)
"RTN","PSJBCMA5",43,0)
 ..S LN=0 F  S LN=$O(^PS(53.1,+ON,15,LN)) Q:'LN  S ^PS(53.45,+PSJSYSP,5,LN,0)=^PS(53.1,+ON,15,LN,0)
"RTN","PSJBCMA5",44,0)
 .N OLDSI,MARX,TXTCNT S OLDSI=$P($G(^PS(53.1,+ON,6)),"^") I $L(OLDSI)>0 D  Q
"RTN","PSJBCMA5",45,0)
 ..I $G(BC),$L(OLDSI)>74 D TXT^PSGMUTL(OLDSI,74) S TXTCNT=$O(MARX(" "),-1) S ^PS(53.45,+PSJSYSP,5,0)="^^"_TXTCNT_"^"_TXTCNT D  Q
"RTN","PSJBCMA5",46,0)
 ...S TXTLN=0 F  S TXTLN=$O(MARX(TXTLN)) Q:'TXTLN  S ^PS(53.45,+PSJSYSP,5,TXTLN,0)=MARX(TXTLN)
"RTN","PSJBCMA5",47,0)
 ..S ^PS(53.45,+PSJSYSP,5,1,0)=$P(^PS(53.1,+ON,6),"^"),^PS(53.45,+PSJSYSP,5,0)="^^1^1"
"RTN","PSJBCMA5",48,0)
 I ON["U" D  Q $P($G(^PS(53.45,+PSJSYSP,5,0)),"^",3)
"RTN","PSJBCMA5",49,0)
 .Q:($G(^PS(53.45,+PSJSYSP,5,0))="^^0^0")
"RTN","PSJBCMA5",50,0)
 .Q:($G(PSGOEENO)=1)
"RTN","PSJBCMA5",51,0)
 .I $P($G(^PS(55,+DFN,5,+ON,15,0)),"^",3) D  Q
"RTN","PSJBCMA5",52,0)
 ..S ^PS(53.45,+PSJSYSP,5,0)=$G(^PS(55,DFN,5,+ON,15,0))
"RTN","PSJBCMA5",53,0)
 ..S LN=0 F  S LN=$O(^PS(55,DFN,5,+ON,15,LN)) Q:'LN  S ^PS(53.45,+PSJSYSP,5,LN,0)=^PS(55,DFN,5,+ON,15,LN,0)
"RTN","PSJBCMA5",54,0)
 .N OLDSI,MARX,TXTCNT S OLDSI=$P($G(^PS(55,DFN,5,+ON,6)),"^") I $L(OLDSI)>0 D  Q
"RTN","PSJBCMA5",55,0)
 ..I $G(BC),$L(OLDSI)>74 D TXT^PSGMUTL(OLDSI,74) S TXTCNT=$O(MARX(" "),-1) S ^PS(53.45,+PSJSYSP,5,0)="^^"_TXTCNT_"^"_TXTCNT D  Q
"RTN","PSJBCMA5",56,0)
 ...S TXTLN=0 F  S TXTLN=$O(MARX(TXTLN)) Q:'TXTLN  S ^PS(53.45,+PSJSYSP,5,TXTLN,0)=MARX(TXTLN)
"RTN","PSJBCMA5",57,0)
 ..S ^PS(53.45,+PSJSYSP,5,1,0)=$P(^PS(55,DFN,5,+ON,6),"^"),^PS(53.45,+PSJSYSP,5,0)="^^1^1"
"RTN","PSJBCMA5",58,0)
 Q 0
"RTN","PSJBCMA5",59,0)
 ;
"RTN","PSJBCMA5",60,0)
GETOPI(DFN,ON,BC) ; Get Other Print Info for IV orders
"RTN","PSJBCMA5",61,0)
 N PSJTXT,LN
"RTN","PSJBCMA5",62,0)
 I $G(DFN)=""!($G(ON)="") Q 0
"RTN","PSJBCMA5",63,0)
 I '$G(PSJSYSP) N PSJSYSP S PSJSYSP=$J
"RTN","PSJBCMA5",64,0)
 I ON["P" D  Q +$P($G(^PS(53.45,+PSJSYSP,6,0)),"^",3)
"RTN","PSJBCMA5",65,0)
 .Q:$P($G(^PS(53.45,+PSJSYSP,6,0)),"^",3)
"RTN","PSJBCMA5",66,0)
 .I $P($G(^PS(53.1,+ON,16,0)),"^",3) D  Q
"RTN","PSJBCMA5",67,0)
 ..S ^PS(53.45,+PSJSYSP,6,0)=^PS(53.1,+ON,16,0)
"RTN","PSJBCMA5",68,0)
 ..S LN=0 F  S LN=$O(^PS(53.1,+ON,16,LN)) Q:'LN  S ^PS(53.45,+PSJSYSP,6,LN,0)=^PS(53.1,+ON,16,LN,0)
"RTN","PSJBCMA5",69,0)
 .N OLDOPI,MARX,TXTCNT S OLDOPI=$P($G(^PS(53.1,+ON,9)),"^",2) I $L(OLDOPI)>0 D  Q
"RTN","PSJBCMA5",70,0)
 ..I $G(BC),$L(OLDOPI)>74 D TXT^PSGMUTL(OLDOPI,74) S TXTCNT=$O(MARX(" "),-1) S ^PS(53.45,+PSJSYSP,6,0)="^^"_TXTCNT_"^"_TXTCNT D  Q
"RTN","PSJBCMA5",71,0)
 ...S TXTLN=0 F  S TXTLN=$O(MARX(TXTLN)) Q:'TXTLN  S ^PS(53.45,+PSJSYSP,6,TXTLN,0)=MARX(TXTLN)
"RTN","PSJBCMA5",72,0)
 ..S ^PS(53.45,+PSJSYSP,6,1,0)=$P(^PS(53.1,+ON,9),"^",2),^PS(53.45,+PSJSYSP,6,0)="^^1^1"
"RTN","PSJBCMA5",73,0)
 I ON["V" D
"RTN","PSJBCMA5",74,0)
 .Q:$P($G(^PS(53.45,+PSJSYSP,6,0)),"^",3)
"RTN","PSJBCMA5",75,0)
 .I $P($G(^PS(55,+DFN,"IV",+ON,10,0)),"^",3) D  Q
"RTN","PSJBCMA5",76,0)
 ..S ^PS(53.45,+PSJSYSP,6,0)=$G(^PS(55,DFN,"IV",+ON,10,0))
"RTN","PSJBCMA5",77,0)
 ..S LN=0 F  S LN=$O(^PS(55,DFN,"IV",+ON,10,LN)) Q:'LN  S ^PS(53.45,+PSJSYSP,6,LN,0)=^PS(55,DFN,"IV",+ON,10,LN,0)
"RTN","PSJBCMA5",78,0)
 .N OLDOPI,MARX,TXTCNT S OLDOPI=$P($G(^PS(55,DFN,"IV",+ON,3)),"^") I $L(OLDOPI)>0 D  Q
"RTN","PSJBCMA5",79,0)
 ..I $G(BC),$L(OLDOPI)>74 D TXT^PSGMUTL(OLDOPI,74) S TXTCNT=$O(MARX(" "),-1) S ^PS(53.45,+PSJSYSP,6,0)="^^"_TXTCNT_"^"_TXTCNT D  Q
"RTN","PSJBCMA5",80,0)
 ...S TXTLN=0 F  S TXTLN=$O(MARX(TXTLN)) Q:'TXTLN  S ^PS(53.45,+PSJSYSP,6,TXTLN,0)=MARX(TXTLN)
"RTN","PSJBCMA5",81,0)
 ..S ^PS(53.45,+PSJSYSP,6,1,0)=$P(^PS(55,DFN,"IV",+ON,3),"^"),^PS(53.45,+PSJSYSP,6,0)="^^1^1"
"RTN","PSJBCMA5",82,0)
 I $O(^PS(53.45,+PSJSYSP,6," "),-1)=1,($TR($G(^PS(53.45,+PSJSYSP,6,1,0))," ")="") K ^PS(53.45,+PSJSYSP,6)
"RTN","PSJBCMA5",83,0)
 Q +$P($G(^PS(53.45,+PSJSYSP,6,0)),"^",3)
"RTN","PSJBCMA5",84,0)
 ;
"RTN","PSJBCMA5",85,0)
EDITSI(DFN,PSJORD) ; Edit Special Instructions in ^PS(53.45 via Word Processing
"RTN","PSJBCMA5",86,0)
 N PSJII,DIC,I,PSJVALID,DIWESUB,PSJTXTLN S PSJVALID=0,DIC="^PS(53.45,"_+$G(PSJSYSP)_",5,",DIWESUB="SPECIAL INSTRUCTIONS"
"RTN","PSJBCMA5",87,0)
 I $G(PSJORD) I '$P($G(^PS(53.45,+$G(PSJSYSP),5,0)),"^",5) S L=$$GETSI(DFN,PSJORD)
"RTN","PSJBCMA5",88,0)
 K ^TMP("PSJTMPSI",$J) M ^TMP("PSJTMPSI",$J)=^PS(53.45,+$G(PSJSYSP),5)
"RTN","PSJBCMA5",89,0)
 F PSJII=1:1 Q:$G(PSJVALID)  D
"RTN","PSJBCMA5",90,0)
 .N II,L,DIR,DIE,DA,TMPLN,DR S PSJTXTLN="",PSJVALID=1,DIWESUB="SPECIAL INSTRUCTIONS"
"RTN","PSJBCMA5",91,0)
 .I PSJII=1 S DA=PSJSYSP,DR=5,DIE="^PS(53.45," D ^DIE
"RTN","PSJBCMA5",92,0)
 .I PSJII>1 S DA=PSJSYSP,DR=5,DIC="^PS(53.45,"_+$G(PSJSYSP)_",5," D EN^DIWE
"RTN","PSJBCMA5",93,0)
 .S PSJTXTLN=+$P($G(^PS(53.45,+PSJSYSP,5,0)),"^",3)
"RTN","PSJBCMA5",94,0)
 .S II=0 F  S II=$O(^PS(53.45,+PSJSYSP,5,II)) Q:'II!'$G(PSJVALID)  S TMPLN=$G(^(II,0)) I (TMPLN["^") S PSJVALID=0
"RTN","PSJBCMA5",95,0)
 .I 'PSJVALID W !!!,$C(7),"SPECIAL INSTRUCTIONS must not contain embedded uparrow ""^"". " I PSJII=1 D PAUSE("SPECIAL INSTRUCTIONS")
"RTN","PSJBCMA5",96,0)
 .I 'PSJVALID I PSJII>1 W ! I $$DONE("SPECIAL INSTRUCTIONS") K ^PS(53.45,+PSJSYSP,5) M ^PS(53.45,+$G(PSJSYSP),5)=^TMP("PSJTMPSI",$J) S PSJVALID=1 Q
"RTN","PSJBCMA5",97,0)
 .I PSJVALID I 'PSJTXTLN K ^PS(53.45,+PSJSYSP,5,0) S ^PS(53.45,+PSJSYSP,5,0)="-1^^0^0",^PS(53.45,+PSJSYSP,5,1,0)=""
"RTN","PSJBCMA5",98,0)
 I $P($G(^PS(53.45,+$G(PSJSYSP),5,0)),"^",3) D ENSI^PSJUTL("^PS(53.45,+$G(PSJSYSP),5,") S PSJTXTLN=$O(^PS(53.45,+$G(PSJSYSP),5,""),-1)
"RTN","PSJBCMA5",99,0)
 K ^TMP("PSJTMPSI",$J)
"RTN","PSJBCMA5",100,0)
 Q PSJTXTLN
"RTN","PSJBCMA5",101,0)
 ;
"RTN","PSJBCMA5",102,0)
EDITOPI(PSJDPT,PSJORD) ; Edit Other Print Info in ^PS(53.45 via Word Processing
"RTN","PSJBCMA5",103,0)
 N DIC,I,PSJVALID,DIWESUB,PSJTXTLN S PSJVALID=0,DIC="^PS(53.45,"_+$G(PSJSYSP)_",6,",DIWESUB="OTHER PRINT INFO"
"RTN","PSJBCMA5",104,0)
 K ^TMP("PSJTMPSI",$J) M ^TMP("PSJTMPSI",$J)=^PS(53.45,+$G(PSJSYSP),6)
"RTN","PSJBCMA5",105,0)
 F PSJII=1:1 Q:$G(PSJVALID)  D
"RTN","PSJBCMA5",106,0)
 .N II,L,DIR,DA,DIE,TMPLN S DIR="",PSJTXTLN="",PSJVALID=1,DIWESUB="OTHER PRINT INFO"
"RTN","PSJBCMA5",107,0)
 .I PSJII=1 D OPIWARN(0)
"RTN","PSJBCMA5",108,0)
 .S PSJTXTLN=""
"RTN","PSJBCMA5",109,0)
 .I PSJII=1 S DA=PSJSYSP,DR=6,DIE="^PS(53.45," D ^DIE
"RTN","PSJBCMA5",110,0)
 .I PSJII>1 S DA=PSJSYSP,DR=6,DIC="^PS(53.45,"_+$G(PSJSYSP)_",6," D EN^DIWE
"RTN","PSJBCMA5",111,0)
 .S PSJTXTLN=$O(^PS(53.45,+PSJSYSP,6,""),-1)
"RTN","PSJBCMA5",112,0)
 .I PSJTXTLN="" K ^PS(53.45,+PSJSYSP,6) S ^PS(53.45,+PSJSYSP,6,0)="-1^^1^1",^PS(53.45,+PSJSYSP,6,1,0)=""
"RTN","PSJBCMA5",113,0)
 .S II=0 F  S II=$O(^PS(53.45,+PSJSYSP,6,II)) Q:'II!'$G(PSJVALID)  S TMPLN=$G(^(II,0)) I (TMPLN["^") S PSJVALID=0
"RTN","PSJBCMA5",114,0)
 .I 'PSJVALID W !!!,$C(7),"OTHER PRINT INFO must not contain embedded uparrow ""^""." I PSJII=1 D PAUSE("OTHER PRINT INFO")
"RTN","PSJBCMA5",115,0)
 .I 'PSJVALID I PSJII>1 W ! I $$DONE("OTHER PRINT INFO") K ^PS(53.45,+PSJSYSP,6) M ^PS(53.45,+$G(PSJSYSP),6)=^TMP("PSJTMPSI",$J) S PSJVALID=1 Q
"RTN","PSJBCMA5",116,0)
 .I PSJVALID D
"RTN","PSJBCMA5",117,0)
 ..I ($L($G(^PS(53.45,+PSJSYSP,6,1,0)))>60) D OPIWARN(1) S P("OPI")="Instructions too long. See Order View or BCMA for full text^"_$P(P("OPI"),"^",2) Q
"RTN","PSJBCMA5",118,0)
 ..I PSJTXTLN=1,($L($G(^PS(53.45,+PSJSYSP,6,1,0)))<61) S P("OPI")=^PS(53.45,+PSJSYSP,6,1,0)_"^"_$P(P("OPI"),"^",2) Q
"RTN","PSJBCMA5",119,0)
 ..N TXT,OPIMSG,PSJTMPTX,PSJOVRMX S OPIMSG="Instructions too long. See Order View or BCMA for full text."
"RTN","PSJBCMA5",120,0)
 ..S PSJTMPTX="",PSJOVRMX=0 S TMPLIN=0 F  S TMPLIN=$O(^PS(53.45,+PSJSYSP,6,TMPLIN)) Q:'TMPLIN!(PSJOVRMX)  D
"RTN","PSJBCMA5",121,0)
 ...S:($L(PSJTMPTX)+$L($G(^PS(53.45,+PSJSYSP,6,TMPLIN,0))))>60 PSJOVRMX=1 Q:$G(PSJOVRMX)  S PSJTMPTX=$G(PSJTMPTX)_$S($G(PSJTMPTX)]"":" ",1:"")_$G(^PS(53.45,+PSJSYSP,6,TMPLIN,0))
"RTN","PSJBCMA5",122,0)
 ..I '$G(PSJOVRMX),(PSJTMPTX]"") S P("OPI")=PSJTMPTX_"^"_$P(P("OPI"),"^",2)
"RTN","PSJBCMA5",123,0)
 K ^TMP("PSJTMPSI",$J)
"RTN","PSJBCMA5",124,0)
 Q PSJTXTLN
"RTN","PSJBCMA5",125,0)
 ;
"RTN","PSJBCMA5",126,0)
OPIWARN(AFTER) ; Warn user about OPI not printing on IV labels
"RTN","PSJBCMA5",127,0)
 D OPIWARN^PSJBCMA1(AFTER)
"RTN","PSJBCMA5",128,0)
 Q
"RTN","PSJBCMA5",129,0)
 ;
"RTN","PSJBCMA5",130,0)
FILESI(DFN,PSJORD) ; File Special instructions from ^PS(53.45 to UD order
"RTN","PSJBCMA5",131,0)
 N LN,LNCNT,DA,DIE,X,Y,PSJTMPTX,TMPLIN,PSJOVRMX
"RTN","PSJBCMA5",132,0)
 D FILESI^PSJBCMA2(DFN,PSJORD)
"RTN","PSJBCMA5",133,0)
 ;K ^PS(53.45,+$G(PSJSYSP),5)
"RTN","PSJBCMA5",134,0)
 Q
"RTN","PSJBCMA5",135,0)
 ;
"RTN","PSJBCMA5",136,0)
FILEOPI(DFN,ORDER) ; File Other Print Info from ^PS(53.45 to IV order
"RTN","PSJBCMA5",137,0)
 N LN,LNCNT,PSJORD S PSJORD=ORDER
"RTN","PSJBCMA5",138,0)
 D FILEOPI^PSJBCMA2(DFN,ORDER)
"RTN","PSJBCMA5",139,0)
 K ^PS(53.45,+PSJSYSP,6)
"RTN","PSJBCMA5",140,0)
 Q
"RTN","PSJBCMA5",141,0)
 ;
"RTN","PSJBCMA5",142,0)
DIFFSI(DFN,PSJORD) ; Compare Special Instructions, pre and post edit
"RTN","PSJBCMA5",143,0)
 N LN,DIFF S DIFF=0
"RTN","PSJBCMA5",144,0)
 S LN=0 F  S LN=$O(^PS(53.45,PSJSYSP,5,LN)) Q:'LN!DIFF  D
"RTN","PSJBCMA5",145,0)
 .I PSJORD["U" D
"RTN","PSJBCMA5",146,0)
 ..I LN=1 N OTOT,NTOT S OTOT=+$O(^PS(55,DFN,5,+PSJORD,15,""),-1),NTOT=+$O(^PS(53.45,PSJSYSP,5,""),-1) I NTOT'=OTOT S DIFF=1 Q
"RTN","PSJBCMA5",147,0)
 ..I $G(^PS(53.45,PSJSYSP,5,LN,0))'=$G(^PS(55,DFN,5,+PSJORD,15,LN,0)) S DIFF=1
"RTN","PSJBCMA5",148,0)
 .I PSJORD["P" D
"RTN","PSJBCMA5",149,0)
 ..I LN=1 N OTOT,NTNT S OTOT=+$O(^PS(53.1,+PSJORD,15,""),-1),NTOT=+$O(^PS(53.45,PSJSYSP,5,""),-1) I NTOT'=OTOT S DIFF=1 Q
"RTN","PSJBCMA5",150,0)
 ..I $G(^PS(53.45,PSJSYSP,5,LN,0))'=$G(^PS(53.1,+PSJORD,15,LN,0)) S DIFF=1
"RTN","PSJBCMA5",151,0)
 Q $S(DIFF:1,1:0)
"RTN","PSJBCMA5",152,0)
 ;
"RTN","PSJBCMA5",153,0)
DIFFOPI(DFN,PSJORD) ; Compare Other Print Info, pre and post edit
"RTN","PSJBCMA5",154,0)
 N LN,DIFF S DIFF=0
"RTN","PSJBCMA5",155,0)
 S LN=0 F  S LN=$O(^PS(53.45,PSJSYSP,6,LN)) Q:'LN!DIFF  D
"RTN","PSJBCMA5",156,0)
 .I PSJORD["V" D
"RTN","PSJBCMA5",157,0)
 ..I LN=1 N OTOT,NTOT S OTOT=+$O(^PS(55,DFN,"IV",+PSJORD,10,""),-1),NTOT=+$O(^PS(53.45,PSJSYSP,6,""),-1) I NTOT'=OTOT S DIFF=1 Q
"RTN","PSJBCMA5",158,0)
 ..I $G(^PS(53.45,PSJSYSP,6,LN,0))'=$G(^PS(55,DFN,"IV",+PSJORD,10,LN,0)) S DIFF=1
"RTN","PSJBCMA5",159,0)
 .I PSJORD["P" D
"RTN","PSJBCMA5",160,0)
 ..I LN=1 N OTOT,NTOT S OTOT=+$O(^PS(53.1,+PSJORD,16,""),-1),NTOT=+$O(^PS(53.45,PSJSYSP,6,""),-1) I NTOT'=OTOT S DIFF=1 Q
"RTN","PSJBCMA5",161,0)
 ..I $G(^PS(53.45,PSJSYSP,6,LN,0))'=$G(^PS(53.1,+PSJORD,16,LN,0)) S DIFF=1
"RTN","PSJBCMA5",162,0)
 Q $S(DIFF:1,1:0)
"RTN","PSJBCMA5",163,0)
 ;
"RTN","PSJBCMA5",164,0)
DIFFAR(ARRAY1,ARRAY2) ; Compare two text arrays
"RTN","PSJBCMA5",165,0)
 N LN,DIFF,OTOT,NTOT S DIFF=0,OTOT=0,NTOT=0
"RTN","PSJBCMA5",166,0)
 S LN=0 F  S LN=$O(ARRAY1(LN)) Q:'LN!DIFF  I ARRAY1(LN,0)'=$G(ARRAY2(LN,0)) S DIFF=1
"RTN","PSJBCMA5",167,0)
 Q $S(DIFF:1,1:0)
"RTN","PSJBCMA5",168,0)
 ;
"RTN","PSJBCMA5",169,0)
MVOPI(DFN,PSJI1,PSJI2) ; Move OPI from Non-Verified order to Active order during Verify
"RTN","PSJBCMA5",170,0)
 Q:'$G(DFN)!'$G(PSJI1)!'$G(PSJI2)
"RTN","PSJBCMA5",171,0)
 I PSJI1["P",PSJI2["V" D GETOPI(DFN,PSJI1),FILEOPI(DFN,PSJI2)
"RTN","PSJBCMA5",172,0)
 Q
"RTN","PSJBCMA5",173,0)
 ;
"RTN","PSJBCMA5",174,0)
MVOPIAL(DFN,PSJI1,PSJI2) ; Move Other Print Info Activity log entries from NV order to Active order, during Verification
"RTN","PSJBCMA5",175,0)
 D MVOPIAL^PSJBCMA1(DFN,PSJI1,PSJI2)
"RTN","PSJBCMA5",176,0)
 Q
"RTN","PSJBCMA5",177,0)
 ;
"RTN","PSJBCMA5",178,0)
KILL(USR) ; Clean up ^PS(53.45
"RTN","PSJBCMA5",179,0)
 K ^PS(53.45,+$G(USR),5),^PS(53.45,+$G(USR),6)
"RTN","PSJBCMA5",180,0)
 Q
"RTN","PSJBCMA5",181,0)
 ;
"RTN","PSJBCMA5",182,0)
PAUSE(DEF) ;
"RTN","PSJBCMA5",183,0)
 K DIR W ! S DIR(0)="EA",DIR("A")="Press Return to continue editing "_$G(DEF)_"...",DIR("?")="Press Return to continue..." D ^DIR W !
"RTN","PSJBCMA5",184,0)
 Q
"RTN","PSJBCMA5",185,0)
 ;
"RTN","PSJBCMA5",186,0)
DONE(DEF) ; -- Done editing?
"RTN","PSJBCMA5",187,0)
 N DIR,X,Y
"RTN","PSJBCMA5",188,0)
 S DIR(0)="YA",DIR("A")="Do you want to quit and discard changes"_$S(($G(DEF)]""):" to "_DEF,1:"")_"? ",DIR("B")="NO"
"RTN","PSJBCMA5",189,0)
 S DIR("?",1)="    Enter YES to exit without saving changes, or ",DIR("?")="    enter NO to continue editing "_$S(($G(DEF)]""):DEF,1:"")_"."
"RTN","PSJBCMA5",190,0)
 D ^DIR
"RTN","PSJBCMA5",191,0)
 Q $S($E(Y)="^":1,1:+Y)
"VER")
8.0^22.2
"BLD",11116,6)
^317
**END**
**END**

