Released PSJ*5*309 SEQ #259
Extracted from mail message
**KIDS**:PSJ*5.0*309^

**INSTALL NAME**
PSJ*5.0*309
"BLD",9656,0)
PSJ*5.0*309^INPATIENT MEDICATIONS^0^3140422^y
"BLD",9656,1,0)
^^5^5^3140422^
"BLD",9656,1,1,0)
This patch will address the following 2 issues with the Inpatient
"BLD",9656,1,2,0)
Medications package:
"BLD",9656,1,3,0)
 
"BLD",9656,1,4,0)
-Warning message displayed twice for order sets
"BLD",9656,1,5,0)
-Change to medication order renewal error
"BLD",9656,4,0)
^9.64PA^^
"BLD",9656,6.3)
3
"BLD",9656,"KRN",0)
^9.67PA^779.2^20
"BLD",9656,"KRN",.4,0)
.4
"BLD",9656,"KRN",.401,0)
.401
"BLD",9656,"KRN",.402,0)
.402
"BLD",9656,"KRN",.403,0)
.403
"BLD",9656,"KRN",.5,0)
.5
"BLD",9656,"KRN",.84,0)
.84
"BLD",9656,"KRN",3.6,0)
3.6
"BLD",9656,"KRN",3.8,0)
3.8
"BLD",9656,"KRN",9.2,0)
9.2
"BLD",9656,"KRN",9.8,0)
9.8
"BLD",9656,"KRN",9.8,"NM",0)
^9.68A^2^2
"BLD",9656,"KRN",9.8,"NM",1,0)
PSGOES^^0^B22304258
"BLD",9656,"KRN",9.8,"NM",2,0)
PSJORREN^^0^B21870443
"BLD",9656,"KRN",9.8,"NM","B","PSGOES",1)

"BLD",9656,"KRN",9.8,"NM","B","PSJORREN",2)

"BLD",9656,"KRN",19,0)
19
"BLD",9656,"KRN",19.1,0)
19.1
"BLD",9656,"KRN",101,0)
101
"BLD",9656,"KRN",409.61,0)
409.61
"BLD",9656,"KRN",771,0)
771
"BLD",9656,"KRN",779.2,0)
779.2
"BLD",9656,"KRN",870,0)
870
"BLD",9656,"KRN",8989.51,0)
8989.51
"BLD",9656,"KRN",8989.52,0)
8989.52
"BLD",9656,"KRN",8994,0)
8994
"BLD",9656,"KRN","B",.4,.4)

"BLD",9656,"KRN","B",.401,.401)

"BLD",9656,"KRN","B",.402,.402)

"BLD",9656,"KRN","B",.403,.403)

"BLD",9656,"KRN","B",.5,.5)

"BLD",9656,"KRN","B",.84,.84)

"BLD",9656,"KRN","B",3.6,3.6)

"BLD",9656,"KRN","B",3.8,3.8)

"BLD",9656,"KRN","B",9.2,9.2)

"BLD",9656,"KRN","B",9.8,9.8)

"BLD",9656,"KRN","B",19,19)

"BLD",9656,"KRN","B",19.1,19.1)

"BLD",9656,"KRN","B",101,101)

"BLD",9656,"KRN","B",409.61,409.61)

"BLD",9656,"KRN","B",771,771)

"BLD",9656,"KRN","B",779.2,779.2)

"BLD",9656,"KRN","B",870,870)

"BLD",9656,"KRN","B",8989.51,8989.51)

"BLD",9656,"KRN","B",8989.52,8989.52)

"BLD",9656,"KRN","B",8994,8994)

"BLD",9656,"QUES",0)
^9.62^^
"BLD",9656,"REQB",0)
^9.611^2^2
"BLD",9656,"REQB",1,0)
PSJ*5.0*134^2
"BLD",9656,"REQB",2,0)
PSJ*5.0*263^2
"BLD",9656,"REQB","B","PSJ*5.0*134",1)

"BLD",9656,"REQB","B","PSJ*5.0*263",2)

"MBREQ")
0
"PKG",471,-1)
1^1
"PKG",471,0)
INPATIENT MEDICATIONS^PSJ^UNIT DOSE AND IVS
"PKG",471,20,0)
^9.402P^^
"PKG",471,22,0)
^9.49I^1^1
"PKG",471,22,1,0)
5.0^2971215^2990325^66481
"PKG",471,22,1,"PAH",1,0)
309^3140422
"PKG",471,22,1,"PAH",1,1,0)
^^5^5^3140422
"PKG",471,22,1,"PAH",1,1,1,0)
This patch will address the following 2 issues with the Inpatient
"PKG",471,22,1,"PAH",1,1,2,0)
Medications package:
"PKG",471,22,1,"PAH",1,1,3,0)
 
"PKG",471,22,1,"PAH",1,1,4,0)
-Warning message displayed twice for order sets
"PKG",471,22,1,"PAH",1,1,5,0)
-Change to medication order renewal error
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
2
"RTN","PSGOES")
0^1^B22304258^B22369472
"RTN","PSGOES",1,0)
PSGOES ;BIR/CML3-CREATE ORDERS USING ORDER SET ;19 Feb 99 / 12:53 PM
"RTN","PSGOES",2,0)
 ;;5.0;INPATIENT MEDICATIONS ;**12,22,30,34,50,58,111,181,263,309**;16 DEC 97;Build 3
"RTN","PSGOES",3,0)
 ;
"RTN","PSGOES",4,0)
 ; Reference to ^PS(50.7 is supported by DBIA 2180.
"RTN","PSGOES",5,0)
 ; Reference to ^PS(55 is supported by DBIA 2191.
"RTN","PSGOES",6,0)
 ; Reference to ^PSDRUG is supported by DBIA 2192.
"RTN","PSGOES",7,0)
 ;
"RTN","PSGOES",8,0)
 NEW PSJNOOSV
"RTN","PSGOES",9,0)
 K DIC,PSGOEOS S X=$P(X,"S.",2),DIC="^PS(53.2,",DIC(0)="QEM" D ^DIC K DIC G:Y'>0 DONE W "  (ORDER SET)" S PSGOESDA=+Y,PSGOES=1
"RTN","PSGOES",10,0)
 I '$D(^PS(53.2,+Y,2)) W "    Invalid Order Set" Q
"RTN","PSGOES",11,0)
 I $P(PSJSYSU,";",2) S PSGOESPR=DUZ
"RTN","PSGOES",12,0)
 E  D  G:Y'>0 DONE
"RTN","PSGOES",13,0)
 .S DIC="^VA(200,",DIC(0)="QEAM",DIC("A")="Select PROVIDER: ",X=$P($G(^PS(55,PSGP,5.1)),"^",2) I X S X=$P($G(^VA(200,X,0)),"^") I X]"" S Y=^("PS") I Y,$S('$P(Y,"^",4):1,1:$P(Y,"^",4)>DT) S DIC("B")=X
"RTN","PSGOES",14,0)
 .S DIC("S")="S X(1)=$G(^(""PS"")) I X(1),$S('$P(X(1),""^"",4):1,1:$P(X(1),""^"",4)>DT)" W ! D ^DIC K DIC I Y'>0 W $C(7),!!,"Provider is required for order sets." Q
"RTN","PSGOES",15,0)
 .S PSGOESPR=+Y S:$P($G(^PS(55,PSGP,5.1)),"^",2)'=+Y $P(^(5.1),"^",2)=+Y
"RTN","PSGOES",16,0)
 S (PSJNOO,PSJNOOSV)=$$ENNOO^PSJUTL5("N")
"RTN","PSGOES",17,0)
 I $G(PSJNOO)<0 W !,$C(7),"...order set not entered..." G DONE
"RTN","PSGOES",18,0)
 F PSGOESN=0:0 S PSGOESN=$O(^PS(53.2,PSGOESDA,2,PSGOESN)) Q:'PSGOESN  I $D(^(PSGOESN,0)) S OSND=^(0) I $S($P(OSND,"^",3)="":0,$P(OSND,"^",4)="":0,$P(OSND,"^",4)="OC":1,1:$P(OSND,"^",5)]"") S PSGSI=$P($G(^(1)),"^") D GND Q:PSGQUIT
"RTN","PSGOES",19,0)
 ;
"RTN","PSGOES",20,0)
DONE ;
"RTN","PSGOES",21,0)
 K PSJNOON,PSJNOO,PSJNOOSV
"RTN","PSGOES",22,0)
 S X="S.X" K %DT,N,OSND,PSGOESDA,PSGDDRG,PSGOESI,PSGOES,PSGOEOS,PSGOESN,PSGOESPR,PSGQUIT,PSGX,SDT,STDAY,X1,X2 Q
"RTN","PSGOES",23,0)
 ;
"RTN","PSGOES",24,0)
GND ;
"RTN","PSGOES",25,0)
 NEW PSJOCDS,PSJALLGY,PSJMULDD
"RTN","PSGOES",26,0)
 K PSGOEE,PSGSCH,PSGORD
"RTN","PSGOES",27,0)
 S:'$D(PSJNOO) PSJNOO=$G(PSJNOOSV)
"RTN","PSGOES",28,0)
 S (PSGPDRG,PSGX)=+OSND,PSGPDRGN=$P($G(^PS(50.7,PSGPDRG,0)),"^") S:PSGPDRGN="" PSGPDRGN=PSGPDRG W !!,"...entering ",$S(PSGPDRGN'=PSGPDRG:PSGPDRGN,1:"** UNKNOWN **"),"..." K Y,DIRUT D END^PSGSICHK S PSGQUIT=$D(DIRUT) Q:$G(Y)<0
"RTN","PSGOES",29,0)
 S PSGNEDFD=$P(OSND,"^",2,5),PSGMR=$P(OSND,"^",3),PSGST=$P(OSND,"^",4),PSGDO=$P(OSND,"^",9),PSGMRN=$$ENMRN^PSGMI(PSGMR)
"RTN","PSGOES",30,0)
 S:PSGMRN="" PSGMRN=PSGMR D NOW^%DTC S PSGDT=+$E(%,1,12) I PSGST="OC" S PSGSCH="ON CALL",(PSGS0XT,PSGS0Y)=""
"RTN","PSGOES",31,0)
 E  S X=$P(OSND,"^",5) W "." S:X X="`"_X D ENOS^PSGS0 S:$D(X) PSGSCH=X I '$D(X) S (PSGSCH,PSGS0XT,PSGS0Y)=""
"RTN","PSGOES",32,0)
 S (PSGNESD,PSGNEFD)="" W "." I $P(OSND,"^",11)]"" S %DT="T",X=$P(OSND,"^",11) D ^%DT S PSGNESD=Y D ENFD^PSGNE3(PSGDT)
"RTN","PSGOES",33,0)
 D:$P(OSND,"^",11)="" ^PSGNE3 K PSGDRG,PSGORQF,^PS(53.45,PSJSYSP,1),^(2) S (N,Q)=0
"RTN","PSGOES",34,0)
 K PSJALLGY
"RTN","PSGOES",35,0)
 ;If PSJMULDD >1 then the order has mutliple DD and it will flag ENDDC^PSGSICHK to display the OI name instead of DD name
"RTN","PSGOES",36,0)
 S PSJMULDD=0
"RTN","PSGOES",37,0)
 F  S Q=$O(^PS(53.2,PSGOESDA,2,PSGOESN,2,Q)) Q:'Q!$D(PSGORQF)  S PSGDRG=$G(^(Q,0)) I PSGDRG D
"RTN","PSGOES",38,0)
 .S PSJALLGY(+PSGDRG)="",PSJMULDD=PSJMULDD+1
"RTN","PSGOES",39,0)
 .;D ENDDC^PSGSICHK(PSGP,+PSGDRG) Q:$D(PSGORQF)
"RTN","PSGOES",40,0)
 .;D IN^PSJOCDS($G(PSGORD),"UD",+PSGDRG) Q:$D(PSGORQF)
"RTN","PSGOES",41,0)
 .;D CONT^PSJOCDT Q:$D(PSGORQF)
"RTN","PSGOES",42,0)
 .S:$P(PSGDRG,U,2)="" $P(PSGDRG,U,2)=1
"RTN","PSGOES",43,0)
 .S N=N+1,^PS(53.45,PSJSYSP,2,N,0)=PSGDRG,^PS(53.45,PSJSYSP,2,"B",+PSGDRG,N)="" W "."
"RTN","PSGOES",44,0)
 .I $P(^PSDRUG(+PSGDRG,2),U,3)'["U"!($S('+$G(^PSDRUG(+PSGDRG,"I")):0,^("I")'>DT:1,1:0)) S PSGOEAV="0^1" W:PSJSYSU $C(7),!?5,"...AS NON-VERIFIED - DATA INCOMPLETE..."
"RTN","PSGOES",45,0)
 S PSGDRG=$O(PSJALLGY(0)) Q:'+PSGDRG
"RTN","PSGOES",46,0)
 D FULL^VALM1
"RTN","PSGOES",47,0)
 D ENDDC^PSGSICHK(PSGP,+PSGDRG) Q:$D(PSGORQF)
"RTN","PSGOES",48,0)
 D IN^PSJOCDS($G(PSGORD),"UD",+PSGDRG) Q:$D(PSGORQF)
"RTN","PSGOES",49,0)
 ;*309 - Remove second continue prompt
"RTN","PSGOES",50,0)
 ;D CONT^PSJOCDT Q:$D(PSGORQF)
"RTN","PSGOES",51,0)
 I N S ^PS(53.45,PSJSYSP,2,0)="^53.4502P^"_N_"^"_N
"RTN","PSGOES",52,0)
 I $G(PSGORQF) W !,?5,"...ORDER FOR ",PSGPDRGN," NOT ENTERED...",! Q
"RTN","PSGOES",53,0)
 ;I PSGOEAV,$S($D(PSGOEOS):1,'PSGPDRG:1,PSGPDRG=PSGPDRGN:1,'PSGMR:1,PSGMR=PSGMRN:1,PSGSCH="":1,PSGST="":1,'PSGNESD:1,'PSGNEFD:1,+PSJSYSU=3:'N,1:0) S PSGOEAV="0^1" W:('$D(PSGOEOS)&PSJSYSU) $C(7),!?5,"...AS NON-VERIFIED - DATA INCOMPLETE..."
"RTN","PSGOES",54,0)
 I PSGOEAV,$S('PSGPDRG:1,PSGPDRG=PSGPDRGN:1,'PSGMR:1,PSGMR=PSGMRN:1,PSGSCH="":1,PSGST="":1,'PSGNESD:1,'PSGNEFD:1,+PSJSYSU=3:'N,1:0) S PSGOEAV="0^1" W:('$D(PSGOES)&PSJSYSU) $C(7),!?5,"...AS NON-VERIFIED - DATA INCOMPLETE..."
"RTN","PSGOES",55,0)
 S (PSGHSM,PSGSM)="",PSGPR=PSGOESPR D ^PSGOETO S PSGOEAV=$P(PSJSYSP0,"^",9)&PSJSYSU
"RTN","PSGOES",56,0)
 ; pharmacist label check, build label for order set only if auto verify turned on
"RTN","PSGOES",57,0)
 I PSJSYSL>0,(PSGOEAV),($P($G(^PS(55,PSGP,5,$S($D(DA):DA,1:+PSGORD),0)),U,9)="A") D
"RTN","PSGOES",58,0)
 .S $P(^PS(55,PSGP,5,$S($D(DA):DA,1:+PSGORD),7),U)=PSGDT S:$P(^(7),U,2)="" $P(^(7),U,2)="N" S PSGTOL=2,PSGUOW=DUZ,PSGTOO=1,DA=+PSGORD D ENL^PSGVDS
"RTN","PSGOES",59,0)
 ; ward clerk label check 
"RTN","PSGOES",60,0)
 I PSJSYSL>0,$P(PSJSYSU,";",3)<3,"12"[$P(PSJSYSW0,"^",12),'(PSGOEAV) D
"RTN","PSGOES",61,0)
 .I PSGORD["P" S $P(^PS(53.1,$S($D(DA):DA,1:+PSGORD),7),U)=PSGDT S:$P(^(7),U,2)="" $P(^(7),U,2)="N"
"RTN","PSGOES",62,0)
 .I PSGORD'["P" S $P(^PS(55,PSGP,5,$S($D(DA):DA,1:+PSGORD),7),U)=PSGDT S:$P(^(7),U,2)="" $P(^(7),U,2)="N"
"RTN","PSGOES",63,0)
 .S PSGTOL=2,PSGUOW=DUZ,PSGTOO=2,DA=+PSGORD D ENL^PSGVDS
"RTN","PSGOES",64,0)
 Q
"RTN","PSJORREN")
0^2^B21870443^B20851674
"RTN","PSJORREN",1,0)
PSJORREN ;BIR/MV-RENEWAL FLAG ;6 DEC 00 / 3:11 PM 
"RTN","PSJORREN",2,0)
 ;;5.0;INPATIENT MEDICATIONS ;**50,70,58,89,91,110,127,134,309**;16 DEC 97;Build 3
"RTN","PSJORREN",3,0)
 ;
"RTN","PSJORREN",4,0)
 ; Reference to ^PS(50.7 supported by DBIA #2180
"RTN","PSJORREN",5,0)
 ; References to ^PS(52.6 supported by DBIA #1231
"RTN","PSJORREN",6,0)
 ; References to ^PS(52.7 supported by DBIA #2173
"RTN","PSJORREN",7,0)
 ; References to ^PS(55 supported by DBIA #2191
"RTN","PSJORREN",8,0)
 ; Reference to ^PSDRUG( is supported by DBIA 2192
"RTN","PSJORREN",9,0)
 ;
"RTN","PSJORREN",10,0)
ACTIVE(DFN,ON) ;
"RTN","PSJORREN",11,0)
 ;DFN: Patient IEN
"RTN","PSJORREN",12,0)
 ;ON : Order number_"U/V/P"
"RTN","PSJORREN",13,0)
 ;Output: 0^reason not renewable (Can't renew)
"RTN","PSJORREN",14,0)
 ;        2^New OI (Need to create a new order as in edit)
"RTN","PSJORREN",15,0)
 ;          note: with PSJ*5*70 - instead of 2, IV order will return 0
"RTN","PSJORREN",16,0)
 ;        1 (OK to renew)
"RTN","PSJORREN",17,0)
 NEW PSJRT,PSJEXP
"RTN","PSJORREN",18,0)
 I '$D(^PS(53.1,+ON))&'$D(^PS(55,+DFN,5,+ON,0))&'$D(^PS(55,+DFN,"IV",+ON,0)) S PSJRT="0^Invalid Package Reference" Q $G(PSJRT)
"RTN","PSJORREN",19,0)
 D:ON["U" UD
"RTN","PSJORREN",20,0)
 D:ON["V" IV
"RTN","PSJORREN",21,0)
 ;*309 - Changed error message
"RTN","PSJORREN",22,0)
 I (+$G(PSJRT)=1) S PSJEXP=$$EXPIRED^PSGOER(DFN,ON) I PSJEXP S PSJRT="0^Expired - Order Renewal Time Limit Exceeded.  New order required to continue therapy."
"RTN","PSJORREN",23,0)
 Q $G(PSJRT)
"RTN","PSJORREN",24,0)
UD ;
"RTN","PSJORREN",25,0)
 ;If both PSJRT(2) & (3) existed it meant order has multiple DDs and one
"RTN","PSJORREN",26,0)
 ;is tied to a different OI. It's best to not allow renewal of the order.
"RTN","PSJORREN",27,0)
 ;
"RTN","PSJORREN",28,0)
 NEW PSJDD,PSJDDOI,PSJDDX,PSJACT,PSJOI,PSJOIACT,PSJUSE,PSJPRI,X,ND2
"RTN","PSJORREN",29,0)
 K PSJRT
"RTN","PSJORREN",30,0)
 S PSJOI=+^PS(55,DFN,5,+ON,.2)
"RTN","PSJORREN",31,0)
 S PSJPRI=$P(^PS(55,DFN,5,+ON,.2),"^",4)
"RTN","PSJORREN",32,0)
 I PSJPRI="D" S PSJRT="0^Orders with a Done priority may not be renewed" Q
"RTN","PSJORREN",33,0)
 S ND0=$G(^PS(55,DFN,5,+ON,0)) I $P(ND0,"^",7)="O" S PSJRT="0^One Time orders may not be renewed" Q
"RTN","PSJORREN",34,0)
 N PSJCANT,PSJDAD,NDP2,PSJORKID,PSJKID S NDP2=$G(^PS(55,DFN,5,+ON,.2)),PSJDAD=$P(NDP2,"^",8) I PSJDAD D
"RTN","PSJORREN",35,0)
 .S PSJORKID="" F  S PSJORKID=$O(^PS(55,"ACX",PSJDAD,PSJORKID)) Q:'PSJORKID!$G(PSJCANT)  S PSJKID="" F  S PSJKID=$O(^PS(55,"ACX",PSJDAD,PSJORKID,PSJKID)) Q:'PSJKID!$G(PSJCANT)  D
"RTN","PSJORREN",36,0)
 ..S ND0=$G(^PS(55,DFN,5,+PSJKID,2)) I $P(ND0,"^",7)="O" S PSJRT="0^Complex Orders with One-Time doses may not be renewed",PSJCANT=1
"RTN","PSJORREN",37,0)
 Q:$G(PSJCANT)
"RTN","PSJORREN",38,0)
 F PSJDD=0:0 S PSJDD=$O(^PS(55,DFN,5,+ON,1,PSJDD)) Q:('PSJDD!$D(PSJRT(1)))  D
"RTN","PSJORREN",39,0)
 . S (PSJACT,PSJOIACT)=0 S PSJDDX=^PS(55,DFN,5,+ON,1,PSJDD,0)
"RTN","PSJORREN",40,0)
 . S X=$P(PSJDDX,U,3) I X]"",(X'>DT) S PSJACT=1
"RTN","PSJORREN",41,0)
 . S X=$G(^PSDRUG(+PSJDDX,"I")) I X]"",(X'>DT) S PSJACT=1
"RTN","PSJORREN",42,0)
 . S X=$G(^PSDRUG(+PSJDDX,2)),PSJUSE=$P(X,U,3)["U",PSJDDOI=+X I '+PSJDDOI S PSJRT(3)="0^Dispense drug is not matched to an Orderable Item" Q
"RTN","PSJORREN",43,0)
 . S X=$P($G(^PS(50.7,+PSJDDOI,0)),U,4) I X]"",(X'>DT) S PSJOIACT=1
"RTN","PSJORREN",44,0)
 . I 'PSJACT,PSJUSE D  Q
"RTN","PSJORREN",45,0)
 .. I PSJOI=PSJDDOI D  Q
"RTN","PSJORREN",46,0)
 ... I 'PSJOIACT S PSJRT(1)=1 Q
"RTN","PSJORREN",47,0)
 ... S:PSJOIACT PSJRT(3)="0^Inactive Orderable Item"
"RTN","PSJORREN",48,0)
 .. I +PSJDDOI,(PSJOI'=PSJDDOI) D
"RTN","PSJORREN",49,0)
 ... S:'PSJOIACT PSJRT(2)="2"_U_PSJDDOI
"RTN","PSJORREN",50,0)
 ... S:PSJOIACT PSJRT(3)="0^Dispense drug ties to an inactive Orderable Item"
"RTN","PSJORREN",51,0)
 . I PSJACT S PSJRT(3)="0^This drug has been Inactivated"
"RTN","PSJORREN",52,0)
 . I 'PSJUSE S PSJRT(3)="0^Drug is No longer used in Inpatient Meds"
"RTN","PSJORREN",53,0)
 I $D(PSJRT(1)) S PSJRT=1 Q
"RTN","PSJORREN",54,0)
 I $D(PSJRT(2)),$D(PSJRT(3)) S PSJRT=PSJRT(3) Q
"RTN","PSJORREN",55,0)
 I '$D(PSJRT) S PSJRT="0^Order has no Dispense drug" Q
"RTN","PSJORREN",56,0)
 S X=$O(PSJRT(0)),PSJRT=$G(PSJRT(X))
"RTN","PSJORREN",57,0)
 Q
"RTN","PSJORREN",58,0)
IV ;
"RTN","PSJORREN",59,0)
 NEW FIL,PSJACT,PSJAS,PSJASNO,PSJASOI,PSJCNT,PSJIEN,PSJOI,PSJOIACT,PSJPRI,X
"RTN","PSJORREN",60,0)
 K PSJRT
"RTN","PSJORREN",61,0)
 S PSJCNT=0
"RTN","PSJORREN",62,0)
 S PSJOI=+$G(^PS(55,DFN,"IV",+ON,.2))
"RTN","PSJORREN",63,0)
 S PSJPRI=$P(^PS(55,DFN,"IV",+ON,.2),"^",4)
"RTN","PSJORREN",64,0)
 I PSJPRI="D" S PSJRT="0^Orders with a Done priority may not be renewed" Q
"RTN","PSJORREN",65,0)
 N ND2,PSBACT,IVSCHED
"RTN","PSJORREN",66,0)
 S ND0=$G(^PS(55,DFN,"IV",+ON,0)) I ($P(ND0,"^",4)="P")!($P(ND0,"^",23)="P")!$P(ND0,"^",5) D  Q:$G(PSJRT)]""
"RTN","PSJORREN",67,0)
 .N X,PSGOES,ZZND S PSGOES=2,X=$P(ND0,"^",9) D ENOS^PSGS0 Q:($G(X)="")!($P($G(ZZND),"^",5)'="O")
"RTN","PSJORREN",68,0)
 .S PSJRT="0^This One-Time order may not be renewed"
"RTN","PSJORREN",69,0)
 F FIL="AD","SOL"  F PSJAS=0:0 S PSJAS=$O(^PS(55,DFN,"IV",+ON,FIL,PSJAS)) Q:'PSJAS  D
"RTN","PSJORREN",70,0)
 . S (PSJACT,PSJOIACT)=0
"RTN","PSJORREN",71,0)
 . S PSJASNO=$S(FIL="AD":52.6,1:52.7)
"RTN","PSJORREN",72,0)
 . S PSJIEN=+^PS(55,DFN,"IV",+ON,FIL,PSJAS,0)
"RTN","PSJORREN",73,0)
 . S X=$G(^PS(PSJASNO,+PSJIEN,"I")) I X]"",(X'>DT) S PSJACT=1
"RTN","PSJORREN",74,0)
 . S PSJASOI=$P(^PS(PSJASNO,PSJIEN,0),U,11)
"RTN","PSJORREN",75,0)
 . S X=$P($G(^PS(50.7,+PSJASOI,0)),U,4) I X]"",(X'>DT) S PSJOIACT=1
"RTN","PSJORREN",76,0)
 . I PSJACT S PSJCNT=PSJCNT+1,PSJRT(3)="0^Inactive "_$S(FIL="AD":"Additive",1:"Solution") Q
"RTN","PSJORREN",77,0)
 . I PSJOI=PSJASOI D  Q
"RTN","PSJORREN",78,0)
 .. I 'PSJOIACT S PSJRT(1)="" Q
"RTN","PSJORREN",79,0)
 .. I PSJOIACT S PSJRT(3)="0^Inactive Orderable Item"
"RTN","PSJORREN",80,0)
 . I PSJOI'=PSJASOI D
"RTN","PSJORREN",81,0)
 .. I 'PSJOIACT S PSJCNT=PSJCNT+1,PSJRT(2)=2_U_PSJASOI
"RTN","PSJORREN",82,0)
 .. I PSJOIACT S PSJRT(3)="0^Inactive Orderable Item"
"RTN","PSJORREN",83,0)
 I $D(PSJRT(1)) S PSJRT=1 Q
"RTN","PSJORREN",84,0)
 I $D(PSJRT(3)) S PSJRT=PSJRT(3) Q
"RTN","PSJORREN",85,0)
 I $D(PSJRT(2)),PSJCNT=1 S PSJRT="0^New Orderable Item" Q
"RTN","PSJORREN",86,0)
 S PSJRT="0^Inactive drug"
"RTN","PSJORREN",87,0)
 Q
"VER")
8.0^22.0
"BLD",9656,6)
^259
**END**
**END**

