Released PSJ*5*366 SEQ #323
Extracted from mail message
**KIDS**:PSJ*5.0*366^

**INSTALL NAME**
PSJ*5.0*366
"BLD",9978,0)
PSJ*5.0*366^INPATIENT MEDICATIONS^0^3181031^y
"BLD",9978,1,0)
^^12^12^3181031^^
"BLD",9978,1,1,0)
As part of the Clinical Ancillary Services project (CAS) - Medication 
"BLD",9978,1,2,0)
Permission/Dispensing Updates (MPDU), the Inpatient Medications package
"BLD",9978,1,3,0)
has been modified to address the following:
"BLD",9978,1,4,0)
 
"BLD",9978,1,5,0)
This patch will address the following issues.
"BLD",9978,1,6,0)
 
"BLD",9978,1,7,0)
1. Limit the Display of Medication Routes for Infusion Order Dialogs
"BLD",9978,1,8,0)
2. Limit the Display of Medication Routes for Inpatient Unit Dose Order
"BLD",9978,1,9,0)
   Dialogs
"BLD",9978,1,10,0)
3. Check dosage form to determine appropriate default route
"BLD",9978,1,11,0)
4. Validate Termination of a Provider 
"BLD",9978,1,12,0)
5. Addresses the defect reported in INC2806789 
"BLD",9978,4,0)
^9.64PA^^
"BLD",9978,6.3)
7
"BLD",9978,"KRN",0)
^9.67PA^779.2^20
"BLD",9978,"KRN",.4,0)
.4
"BLD",9978,"KRN",.401,0)
.401
"BLD",9978,"KRN",.402,0)
.402
"BLD",9978,"KRN",.403,0)
.403
"BLD",9978,"KRN",.5,0)
.5
"BLD",9978,"KRN",.84,0)
.84
"BLD",9978,"KRN",3.6,0)
3.6
"BLD",9978,"KRN",3.8,0)
3.8
"BLD",9978,"KRN",9.2,0)
9.2
"BLD",9978,"KRN",9.8,0)
9.8
"BLD",9978,"KRN",9.8,"NM",0)
^9.68A^26^17
"BLD",9978,"KRN",9.8,"NM",1,0)
PSGOE4^^0^B42442364
"BLD",9978,"KRN",9.8,"NM",2,0)
PSGOE8^^0^B54413557
"BLD",9978,"KRN",9.8,"NM",3,0)
PSGOE9^^0^B47270955
"BLD",9978,"KRN",9.8,"NM",4,0)
PSIVEDT^^0^B69412559
"BLD",9978,"KRN",9.8,"NM",5,0)
PSGOE1^^0^B32244396
"BLD",9978,"KRN",9.8,"NM",6,0)
PSGOE42^^0^B10268792
"BLD",9978,"KRN",9.8,"NM",7,0)
PSGOE82^^0^B34233969
"BLD",9978,"KRN",9.8,"NM",8,0)
PSGOE92^^0^B43075516
"BLD",9978,"KRN",9.8,"NM",9,0)
PSIVCHK^^0^B27420606
"BLD",9978,"KRN",9.8,"NM",10,0)
PSJLMGUD^^0^B30941132
"BLD",9978,"KRN",9.8,"NM",18,0)
PSJOE0^^0^B26150423
"BLD",9978,"KRN",9.8,"NM",21,0)
PSGOEEW^^0^B28146717
"BLD",9978,"KRN",9.8,"NM",22,0)
PSGOEE^^0^B108119491
"BLD",9978,"KRN",9.8,"NM",23,0)
PSGOE91^^0^B122701385
"BLD",9978,"KRN",9.8,"NM",24,0)
PSGOE3^^0^B26173269
"BLD",9978,"KRN",9.8,"NM",25,0)
PSGOE41^^0^B104146997
"BLD",9978,"KRN",9.8,"NM",26,0)
PSGOE81^^0^B117103092
"BLD",9978,"KRN",9.8,"NM","B","PSGOE1",5)

"BLD",9978,"KRN",9.8,"NM","B","PSGOE3",24)

"BLD",9978,"KRN",9.8,"NM","B","PSGOE4",1)

"BLD",9978,"KRN",9.8,"NM","B","PSGOE41",25)

"BLD",9978,"KRN",9.8,"NM","B","PSGOE42",6)

"BLD",9978,"KRN",9.8,"NM","B","PSGOE8",2)

"BLD",9978,"KRN",9.8,"NM","B","PSGOE81",26)

"BLD",9978,"KRN",9.8,"NM","B","PSGOE82",7)

"BLD",9978,"KRN",9.8,"NM","B","PSGOE9",3)

"BLD",9978,"KRN",9.8,"NM","B","PSGOE91",23)

"BLD",9978,"KRN",9.8,"NM","B","PSGOE92",8)

"BLD",9978,"KRN",9.8,"NM","B","PSGOEE",22)

"BLD",9978,"KRN",9.8,"NM","B","PSGOEEW",21)

"BLD",9978,"KRN",9.8,"NM","B","PSIVCHK",9)

"BLD",9978,"KRN",9.8,"NM","B","PSIVEDT",4)

"BLD",9978,"KRN",9.8,"NM","B","PSJLMGUD",10)

"BLD",9978,"KRN",9.8,"NM","B","PSJOE0",18)

"BLD",9978,"KRN",19,0)
19
"BLD",9978,"KRN",19.1,0)
19.1
"BLD",9978,"KRN",101,0)
101
"BLD",9978,"KRN",409.61,0)
409.61
"BLD",9978,"KRN",771,0)
771
"BLD",9978,"KRN",779.2,0)
779.2
"BLD",9978,"KRN",870,0)
870
"BLD",9978,"KRN",8989.51,0)
8989.51
"BLD",9978,"KRN",8989.52,0)
8989.52
"BLD",9978,"KRN",8994,0)
8994
"BLD",9978,"KRN","B",.4,.4)

"BLD",9978,"KRN","B",.401,.401)

"BLD",9978,"KRN","B",.402,.402)

"BLD",9978,"KRN","B",.403,.403)

"BLD",9978,"KRN","B",.5,.5)

"BLD",9978,"KRN","B",.84,.84)

"BLD",9978,"KRN","B",3.6,3.6)

"BLD",9978,"KRN","B",3.8,3.8)

"BLD",9978,"KRN","B",9.2,9.2)

"BLD",9978,"KRN","B",9.8,9.8)

"BLD",9978,"KRN","B",19,19)

"BLD",9978,"KRN","B",19.1,19.1)

"BLD",9978,"KRN","B",101,101)

"BLD",9978,"KRN","B",409.61,409.61)

"BLD",9978,"KRN","B",771,771)

"BLD",9978,"KRN","B",779.2,779.2)

"BLD",9978,"KRN","B",870,870)

"BLD",9978,"KRN","B",8989.51,8989.51)

"BLD",9978,"KRN","B",8989.52,8989.52)

"BLD",9978,"KRN","B",8994,8994)

"BLD",9978,"QDEF")
^^^^NO^^^^NO^^NO
"BLD",9978,"QUES",0)
^9.62^^
"BLD",9978,"REQB",0)
^9.611^10^7
"BLD",9978,"REQB",1,0)
PSJ*5.0*253^2
"BLD",9978,"REQB",3,0)
PSJ*5.0*352^2
"BLD",9978,"REQB",6,0)
PSJ*5.0*302^2
"BLD",9978,"REQB",7,0)
PSJ*5.0*317^2
"BLD",9978,"REQB",8,0)
PSJ*5.0*248^2
"BLD",9978,"REQB",9,0)
PSJ*5.0*281^2
"BLD",9978,"REQB",10,0)
PSJ*5.0*373^2
"BLD",9978,"REQB","B","PSJ*5.0*248",8)

"BLD",9978,"REQB","B","PSJ*5.0*253",1)

"BLD",9978,"REQB","B","PSJ*5.0*281",9)

"BLD",9978,"REQB","B","PSJ*5.0*302",6)

"BLD",9978,"REQB","B","PSJ*5.0*317",7)

"BLD",9978,"REQB","B","PSJ*5.0*352",3)

"BLD",9978,"REQB","B","PSJ*5.0*373",10)

"MBREQ")
0
"PKG",221,-1)
1^1
"PKG",221,0)
INPATIENT MEDICATIONS^PSJ^UNIT DOSE AND IVS
"PKG",221,22,0)
^9.49I^1^1
"PKG",221,22,1,0)
5.0^2971215^2981113^1
"PKG",221,22,1,"PAH",1,0)
366^3181031
"PKG",221,22,1,"PAH",1,1,0)
^^12^12^3181031
"PKG",221,22,1,"PAH",1,1,1,0)
As part of the Clinical Ancillary Services project (CAS) - Medication 
"PKG",221,22,1,"PAH",1,1,2,0)
Permission/Dispensing Updates (MPDU), the Inpatient Medications package
"PKG",221,22,1,"PAH",1,1,3,0)
has been modified to address the following:
"PKG",221,22,1,"PAH",1,1,4,0)
 
"PKG",221,22,1,"PAH",1,1,5,0)
This patch will address the following issues.
"PKG",221,22,1,"PAH",1,1,6,0)
 
"PKG",221,22,1,"PAH",1,1,7,0)
1. Limit the Display of Medication Routes for Infusion Order Dialogs
"PKG",221,22,1,"PAH",1,1,8,0)
2. Limit the Display of Medication Routes for Inpatient Unit Dose Order
"PKG",221,22,1,"PAH",1,1,9,0)
   Dialogs
"PKG",221,22,1,"PAH",1,1,10,0)
3. Check dosage form to determine appropriate default route
"PKG",221,22,1,"PAH",1,1,11,0)
4. Validate Termination of a Provider 
"PKG",221,22,1,"PAH",1,1,12,0)
5. Addresses the defect reported in INC2806789 
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
17
"RTN","PSGOE1")
0^5^B32244396^B29572227
"RTN","PSGOE1",1,0)
PSGOE1 ;BIR/CML3-ACTION ON INPATIENT ORDERS ;10 Mar 99 10:54 AM
"RTN","PSGOE1",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**7,19,26,39,58,85,80,110,127,133,134,315,366**;16 DEC 97;Build 7
"RTN","PSGOE1",3,0)
 ;
"RTN","PSGOE1",4,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PSGOE1",5,0)
 ; Reference to ^PS(55 is supported by DBIA #2191.
"RTN","PSGOE1",6,0)
 ; Reference to ^PSDRUG( is supported by DBIA #2192.
"RTN","PSGOE1",7,0)
 ; Reference to EN1^ORCFLAG is supported by DBIA #3620.
"RTN","PSGOE1",8,0)
 ; Reference to AND^ORX8 is supported by DBIA #3632.
"RTN","PSGOE1",9,0)
EN ;       
"RTN","PSGOE1",10,0)
 K PSGDFLG,PSGPFLG S PSGOEA="^",PSGACT="",(PSGDI,PSGOENG,PSGPI,PSGRRF)=0
"RTN","PSGOE1",11,0)
 Q:'$G(DUZ)
"RTN","PSGOE1",12,0)
 D @$S(PSGORD["P":"NON",1:"ACT")
"RTN","PSGOE1",13,0)
GO ;
"RTN","PSGOE1",14,0)
 K A,ND,PSGE,PSGR,ST,X,X1,X2,Y I $D(ORACTION) K PSGDI,PSGOENG,PSGPI Q
"RTN","PSGOE1",15,0)
 Q
"RTN","PSGOE1",16,0)
ENACTION(PSGP,PSGORD)        ;
"RTN","PSGOE1",17,0)
 ;Returns string identifying the actions allowed on this order.
"RTN","PSGOE1",18,0)
 D EN
"RTN","PSGOE1",19,0)
 Q PSGACT
"RTN","PSGOE1",20,0)
DONE ;
"RTN","PSGOE1",21,0)
 I PSGORD["U"!(PSGORD["O") L -^PS(55,PSGP,5,+PSGORD)
"RTN","PSGOE1",22,0)
 E  L -^PS(53.1,+PSGORD)
"RTN","PSGOE1",23,0)
 K C,PSGACT,PSGDFLG,PSGPFLG,PSGDI,PSGOENG,PSGPI,PSGRRF Q
"RTN","PSGOE1",24,0)
B ; bypass
"RTN","PSGOE1",25,0)
 S PSGCANFL=1
"RTN","PSGOE1",26,0)
 Q
"RTN","PSGOE1",27,0)
C ; copy an order (does NOT discontinue original order)
"RTN","PSGOE1",28,0)
 D ^PSGOD Q
"RTN","PSGOE1",29,0)
D ; discontinue (or delete) an order
"RTN","PSGOE1",30,0)
 I PSGOEAV,'$D(PSGODF) D ENDS^PSGPO Q
"RTN","PSGOE1",31,0)
 D ENO^PSGOEC(PSGP,PSGORD) Q
"RTN","PSGOE1",32,0)
E ; edit orders
"RTN","PSGOE1",33,0)
 D ^PSGOEE Q
"RTN","PSGOE1",34,0)
F ; finish released orders
"RTN","PSGOE1",35,0)
 D ^PSGOEF Q
"RTN","PSGOE1",36,0)
H(PSGP,PSGORD) ; hold
"RTN","PSGOE1",37,0)
 S X=$G(^PS(55,PSGP,5,+PSGORD,4)) I $P(X,U,12),$P(X,U,13) W $C(7),!!,"WARNING!  THIS ORDER HAS BEEN MARKED FOR CANCELLATION."
"RTN","PSGOE1",38,0)
 I $P($G(^PS(55,PSGP,5,+PSGORD,0)),"^",9)="H" D ^PSGOEH0 Q
"RTN","PSGOE1",39,0)
 D ^PSGOEH1 Q
"RTN","PSGOE1",40,0)
I ; mark (or unmark) a non-verified order as 'incomplete'
"RTN","PSGOE1",41,0)
 D ^PSGOEI Q
"RTN","PSGOE1",42,0)
L ; display logs
"RTN","PSGOE1",43,0)
 D ^PSGOEL Q
"RTN","PSGOE1",44,0)
N ; mark order as 'not to be given'
"RTN","PSGOE1",45,0)
 D ^PSGOENG Q
"RTN","PSGOE1",46,0)
O ; Outpatient (discharge) med
"RTN","PSGOE1",47,0)
 W !!,"UNDER DEVELOPMENT, NOT CURRENTLY AVAILABLE."
"RTN","PSGOE1",48,0)
 Q
"RTN","PSGOE1",49,0)
P ; print expanded view
"RTN","PSGOE1",50,0)
 D ^PSGVWP Q
"RTN","PSGOE1",51,0)
R ; renew an order
"RTN","PSGOE1",52,0)
 I 'PSJSYSU,$D(^PS(55,PSGP,5,+PSGORD,4)),$P(^(4),"^",15),$P(^(4),"^",16) W !!,"THIS ORDER IS ALREADY MARKED FOR RENEWAL!" Q
"RTN","PSGOE1",53,0)
 I 'PSGRRF D ^PSGOER Q
"RTN","PSGOE1",54,0)
 D ^PSGOERI Q
"RTN","PSGOE1",55,0)
S ; show the order again
"RTN","PSGOE1",56,0)
 D EN2^PSGVW Q
"RTN","PSGOE1",57,0)
V ; verify an order
"RTN","PSGOE1",58,0)
 D EN^PSGOEV Q
"RTN","PSGOE1",59,0)
ACT ;
"RTN","PSGOE1",60,0)
 S X=$G(^PS(55,PSGP,5,+PSGORD,0)),ND0=X,ND=$G(^(4)),ND2=$G(^(2)),ND2P1=$G(^(2.1)),PSGOENG=$P(X,"^",22),PSGR=$E("R",'PSGOENG),PSJCOM=$P($G(^PS(55,PSGP,5,+PSGORD,.2)),U,8) ;*315
"RTN","PSGOE1",61,0)
 I 'PSGOENG,PSJCOM S PSGR=$E("R",$$AND^ORX8(PSJCOM)) S:PSGR="R" PSGR=$E("R",$$RNEWOK^PSJUTL2(PSJCOM,PSGP))
"RTN","PSGOE1",62,0)
 S PSGR=$E("R",'$$EXPIRED^PSGOER(PSGP,PSGORD)) S PSGR=$E("R",$P(ND0,"^",7)'="O")
"RTN","PSGOE1",63,0)
 I $P(ND2,U,4)'>PSGDT D OLD Q
"RTN","PSGOE1",64,0)
 S PSGE="E" I '$D(PSGOETOF) S (PSGDFLG,PSGDI)='$$DDOK^PSGOE2("^PS(55,"_PSGP_",5,"_+PSGORD_",1,",+$G(^PS(55,PSGP,5,+PSGORD,.2))),PSGPFLG='$$OIOK^PSGOE2(+$G(^PS(55,PSGP,5,+PSGORD,.2)))
"RTN","PSGOE1",65,0)
 S:$P(X,"^",26) (PSGE,PSGR)=""
"RTN","PSGOE1",66,0)
 ;*366 - check provider credentials
"RTN","PSGOE1",67,0)
 I '$D(PSGOETOF) S PSGPI=$P(X,"^",2) I PSGPI S PSGPI='$$ACTPRO^PSGOE1(PSGPI)
"RTN","PSGOE1",68,0)
 S ST=$P(X,"^",9)="H"*4 S:ST (PSGE,PSGR)=""
"RTN","PSGOE1",69,0)
 N CMPOK S CMPOK=1 I $$COMPLEX^PSJOE(PSGP,PSGORD) S CMPOK=+$P(^PS(55,PSGP,5,+PSGORD,.2),"^",8)
"RTN","PSGOE1",70,0)
 S PSGACT="D"_$S('$G(CMPOK):"",1:PSGE)_$S($P(ND,"^",18+ST)&'$P(ND,"^",19+ST)&'$P(ND,"^",PSJSYSU):"",1:"H")_"L"_$S(ST:"",1:PSGR)
"RTN","PSGOE1",71,0)
 I PSJSYSU,'$P(ND,"^",+PSJSYSU) S PSGACT=PSGACT_"V"
"RTN","PSGOE1",72,0)
 I +PSJSYSU=3,$L($T(EN1^ORCFLAG)) S PSGACT=PSGACT_"G"
"RTN","PSGOE1",73,0)
 Q
"RTN","PSGOE1",74,0)
OLD ;
"RTN","PSGOE1",75,0)
 S A=$P(ND0,"^",9),PSGACT=$E("H",A="H")_"L" I A'["D",A'["E" Q
"RTN","PSGOE1",76,0)
 I 'PSGOENG,($D(^XUSEC("PSJU MGR",DUZ))!$D(^XUSEC("PSJ RPHARM",DUZ))) S PSGACT="LN"
"RTN","PSGOE1",77,0)
 I PSJSYSU,'$P(ND,"^",+PSJSYSU) S:(A'["D")&($G(PSGPRIO)'="DONE") PSGACT="D"_PSGACT S PSGACT=PSGACT_"V" Q
"RTN","PSGOE1",78,0)
 Q:PSGR=""!'PSJPCAF  D NOW^%DTC S (PSGDT,X1)=+$E(%,1,12),X2=-4 D C^%DTC I $S('$P(ND2,"^",4):1,1:$P(ND2,"^",4)'>X) Q
"RTN","PSGOE1",79,0)
 I A="E",$G(PSJPRI)'="D" S PSGACT=PSGACT_PSGR Q
"RTN","PSGOE1",80,0)
 I PSJSYSU,$P(ND,"^",11) S PSGACT=PSGACT_PSGR,PSGRRF=1
"RTN","PSGOE1",81,0)
 Q
"RTN","PSGOE1",82,0)
NON ;
"RTN","PSGOE1",83,0)
 N XND,DRGPT,XND2
"RTN","PSGOE1",84,0)
 S (X,XND)=$G(^PS(53.1,+PSGORD,0)) I $P(X,"^",19),$D(^PS(55,PSGP,5,$P(X,"^",19))) L -^PS(53.1,+PSGORD) S PSGORD=$P(X,"^",19)_"U" G ACT
"RTN","PSGOE1",85,0)
 I $S($P(X,"^",26):1,$P(X,"^",9)["D":1,1:$P(X,"^",9)["E") S:$P(X,U,9)="P"&($P(X,U,26)) PSGACT="D" S:(+PSJSYSU=3)&($L($T(EN1^ORCFLAG))) PSGACT=PSGACT_"G" Q
"RTN","PSGOE1",86,0)
 I PSGORD["U" S PSGACT="DE" S:(+PSJSYSU=3)&($L($T(EN1^ORCFLAG))) PSGACT=PSGACT_"G" Q
"RTN","PSGOE1",87,0)
 I '$D(PSGOETOF) S (PSGDFLG,PSGDI)='$$DDOK^PSGOE2("^PS(53.1,"_+PSGORD_",1,",+$G(^PS(53.1,+PSGORD,.2))),PSGPFLG='$$OIOK^PSGOE2(+$G(^PS(53.1,+PSGORD,.2)))
"RTN","PSGOE1",88,0)
 S DRG=$$STUFFDD^PSGOE2 S:DRG ^PS(53.1,+PSGORD,1,0)="^53.11P^1^1",^PS(53.1,+PSGORD,1,1,0)=DRG,^PS(53.1,+PSGORD,1,"B",DRG,1)=""
"RTN","PSGOE1",89,0)
 F DRG=0:0 S DRG=$O(^PS(53.1,+PSGORD,1,DRG)) Q:'DRG  S DRGPT=^(DRG,0) S INACTDT=$G(^PSDRUG(+DRGPT,"I")) I INACTDT,(INACTDT'>DT) S PSGDFLG=1
"RTN","PSGOE1",90,0)
 I $P(XND,U,9)="P" S PSGACT=$S(+PSJSYSU=3:"BDEF",$G(PSJRNF):"BDEF",1:"") S:(+PSJSYSU=3)&($L($T(EN1^ORCFLAG))) PSGACT=PSGACT_"G" Q
"RTN","PSGOE1",91,0)
 ;*366 - check provider credentials
"RTN","PSGOE1",92,0)
 I '$D(PSGOETOF) S PSGPI=$P(XND,"^",2) I PSGPI S PSGPI='$$ACTPRO^PSGOE1(PSGPI)
"RTN","PSGOE1",93,0)
 S PSGACT="DEI" I PSJSYSU,'PSGPI,$P(XND,"^",9)'="I" S PSGACT=PSGACT_"V"
"RTN","PSGOE1",94,0)
 S XND2=$G(^PS(53.1,+PSGORD,.2)) I $P(XND2,"^",8),$P(XND,"^",9)="P" S PSGACT=$TR(PSGACT,"V")
"RTN","PSGOE1",95,0)
 I +PSJSYSU=3,$L($T(EN1^ORCFLAG)) S PSGACT=PSGACT_"G"
"RTN","PSGOE1",96,0)
 I $P($G(PSGRDTX),U,2)]"",'$P($G(^PS(53.1,+PSGORD,2.5)),"^",2) S $P(^PS(53.1,+PSGORD,2.5),U,2)=$P(PSGRDTX,U,2)
"RTN","PSGOE1",97,0)
 Q
"RTN","PSGOE1",98,0)
ACTO ;
"RTN","PSGOE1",99,0)
 S PSGACTO="" I $G(PSGACT)]"" F X=1:1:$L(PSGACT) S PSGACTO=PSGACTO_$S($E(PSGACT,X)="D":"DC",1:$E(PSGACT,X))_" "
"RTN","PSGOE1",100,0)
 S:PSGACTO]"" PSGACTO=$E(PSGACTO,1,$L(PSGACTO)-1) Q
"RTN","PSGOE1",101,0)
 ;
"RTN","PSGOE1",102,0)
ACTPRO(PSJDA) ;*366 - check provider credentials
"RTN","PSGOE1",103,0)
 N %,X1,X2
"RTN","PSGOE1",104,0)
 Q:'$D(PSJDA) ""
"RTN","PSGOE1",105,0)
 S PSJDA=+PSJDA
"RTN","PSGOE1",106,0)
 Q:'$G(PSJDA) ""
"RTN","PSGOE1",107,0)
 ;check for zero node
"RTN","PSGOE1",108,0)
 Q:'$D(^VA(200,PSJDA,0)) ""
"RTN","PSGOE1",109,0)
 S X1=$G(^VA(200,PSJDA,0))
"RTN","PSGOE1",110,0)
 ;check for DISUSER
"RTN","PSGOE1",111,0)
 Q:$P(X1,U,7)=1 "0^DISUSER"
"RTN","PSGOE1",112,0)
 ;check for provider key
"RTN","PSGOE1",113,0)
 Q:'$D(^XUSEC("PROVIDER",PSJDA)) "0^NO PROVIDER KEY"
"RTN","PSGOE1",114,0)
 ;check termination date is <today's date
"RTN","PSGOE1",115,0)
 S %=+$P(X1,U,11) I %>0,%<DT Q "0^TERMINATED^"_%
"RTN","PSGOE1",116,0)
 ;check inactivation date is <today's date
"RTN","PSGOE1",117,0)
 S X2=$G(^VA(200,PSJDA,"PS"))
"RTN","PSGOE1",118,0)
 Q:X2=""!('X2) "0^NOT AUTHORIZED TO WRITE"
"RTN","PSGOE1",119,0)
 S %=+$P(X2,U,4) I %>0,%<DT Q "0^INACTIVATED^"_%
"RTN","PSGOE1",120,0)
 ;Default:
"RTN","PSGOE1",121,0)
 Q 1
"RTN","PSGOE1",122,0)
 ;
"RTN","PSGOE3")
0^24^B26173269^B25305463
"RTN","PSGOE3",1,0)
PSGOE3 ;BIR/CML3-ABBREV/WARD ORDER ENTRY ;09 JAN 97 / 10:42 AM
"RTN","PSGOE3",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**58,81,315,366**;16 DEC 97;Build 7
"RTN","PSGOE3",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PSGOE3",4,0)
 ; Reference to ^DD(53.1 is supported by DBIA 2256.
"RTN","PSGOE3",5,0)
 ; Reference to ^PS(51.2 is supported by DBIA 2178.
"RTN","PSGOE3",6,0)
 ;
"RTN","PSGOE3",7,0)
 K PSGFOK S F1=53.1,PSGPR=$S($D(PSGOERR):PSJORPV,1:PSGOEPR),PSGMR=$S($P(PSGNEDFD,"^",2):$P(PSGNEDFD,"^",2),1:PSGOEDMR),PSGSCH=$P(PSGNEDFD,"^",4),(PSGOROE1,PSGSI,SDT,PSGMRN,PSGSM,PSGHSM,PSGUD)=""
"RTN","PSGOE3",8,0)
 S:PSGMR PSGMRN=$S('$P(PSGNEDFD,"^",2):"ORAL",'$D(^PS(51.2,PSGMR,0)):PSGMR,$P(^(0),"^")]"":$P(^(0),"^"),1:PSGMR) I PSGPR S PSGPRN=$P($G(^VA(200,PSGPR,0)),"^") S:PSGPRN="" PSGPRN=PSGPR
"RTN","PSGOE3",9,0)
 S PSGST=$S($P(PSGNEDFD,"^",3)]"":$P(PSGNEDFD,"^",3),1:"C"),PSGSTN=$$ENSTN^PSGMI(PSGST),F1=53.1 K PSGFOK S PSGFOK(2)=""
"RTN","PSGOE3",10,0)
 S:$P(PSJSYSU,";",4) PSGFOK(2)="" K ^PS(53.45,PSJSYSP,1),^(2) I PSGDRG S ^(2,0)="^53.4502P^"_PSGDRG_"^1",^(1,0)=PSGDRG,^PS(53.45,PSJSYSP,2,"B",PSGDRG,1)=""
"RTN","PSGOE3",11,0)
 ;
"RTN","PSGOE3",12,0)
GTFIELD ; Call ^PSGOE4 for the rest of the data to complete order entry
"RTN","PSGOE3",13,0)
 ; PSGOE3 is set only if user is using the ABBREV/WARD ORDER ENTRY.
"RTN","PSGOE3",14,0)
 NEW PSGOE3 S PSGOE3=1
"RTN","PSGOE3",15,0)
 D 109^PSGOE4 Q:PSGOROE1
"RTN","PSGOE3",16,0)
 D 3^PSGOE4 Q:PSGOROE1
"RTN","PSGOE3",17,0)
 D 26^PSGOE4 Q:PSGOROE1
"RTN","PSGOE3",18,0)
 D 8^PSGOE41 Q:PSGOROE1
"RTN","PSGOE3",19,0)
 D 10^PSGOE41 Q:PSGOROE1
"RTN","PSGOE3",20,0)
 ; Setup stop date.
"RTN","PSGOE3",21,0)
 S PSGOES=1 D ENFD^PSGNE3(PSGDT) K PSGOES
"RTN","PSGOE3",22,0)
 ;*315 drp ask for Duration of Administration
"RTN","PSGOE3",23,0)
 K PSGDUR,PSGRMV,PSGRMVT,PSGRF
"RTN","PSGOE3",24,0)
 D PSGDUR^PSGOE41 Q:PSGOROE1
"RTN","PSGOE3",25,0)
 D ^PSGOE42
"RTN","PSGOE3",26,0)
 ;I $S($P(PSJSYSW0,"^",24):1,+PSJSYSU=3:1,$P(PSJSYSU,";",2):0,$D(PSJOERR):0,1:PSGOEORF) G ^PSGOE31
"RTN","PSGOE3",27,0)
 Q 
"RTN","PSGOE3",28,0)
 ;
"RTN","PSGOE3",29,0)
109 ; dosage ordered
"RTN","PSGOE3",30,0)
 W !,"THIS IS THE OLD DOSAGE ORDERED PROMPT!!",!
"RTN","PSGOE3",31,0)
 Q
"RTN","PSGOE3",32,0)
 W !,"DOSAGE ORDERED: ",$S(PSGDO]"":PSGDO_"// ",1:"") R X:DTIME I X="^"!'$T W:'$T $C(7) S PSGOROE1=1 G DONE
"RTN","PSGOE3",33,0)
 I X="" S X=PSGDO I X="" W $C(7),"  (Required)" G 109
"RTN","PSGOE3",34,0)
 I X="@" W $C(7),"  (Required)" G 109
"RTN","PSGOE3",35,0)
 ; I X="@" D DEL G:%'=1 109 S PSGDO="" S PSGFOK(109)="" G 3
"RTN","PSGOE3",36,0)
 S PSGF2=109 I X?1."?" D ENHLP^PSGOEM(53.1,109) G 109
"RTN","PSGOE3",37,0)
 I $E(X)="^" D FF G:Y>0 @Y G 109
"RTN","PSGOE3",38,0)
 I $E(X,$L(X))=" " F  S X=$E(X,1,$L(X)-1) Q:$E(X,$L(X))'=" "
"RTN","PSGOE3",39,0)
 I $S(X?.E1C.E:1,$L(X)>20:1,X="":1,X["^":1,X?1.P:1,1:X=+X) W $C(7),"  ",$S(X?1.P!(X=""):"(Required)",1:"??") S X="?" D ENHLP^PSGOEM G 109
"RTN","PSGOE3",40,0)
 S PSGDO=X,PSGFOK(109)=""
"RTN","PSGOE3",41,0)
 ;
"RTN","PSGOE3",42,0)
3 ; med route
"RTN","PSGOE3",43,0)
 W !,"MED ROUTE: ",$S(PSGMR:PSGMRN_"// ",1:"") R X:DTIME I X="^"!'$T W:'$T $C(7) S PSGOROE1=1 G DONE
"RTN","PSGOE3",44,0)
 I X="",PSGMR S X=PSGMRN I PSGMR'=PSGMRN,$D(^PS(51.2,PSGMR,0)) W "  "_$P(^(0),"^",3) S PSGFOK(3)="" G 26
"RTN","PSGOE3",45,0)
 S PSGF2=3 I $S(X="@":1,X]"":0,1:'PSGMR) W $C(7),"  (Required)" S X="?" D ENHLP^PSGOEM(53.1,3) G 3
"RTN","PSGOE3",46,0)
 I X?1."?" D ENHLP^PSGOEM(53.1,3)
"RTN","PSGOE3",47,0)
 I $E(X)="^" D FF G:Y>0 @Y G 3
"RTN","PSGOE3",48,0)
 K DIC S DIC="^PS(51.2,",DIC(0)="EMQZ",DIC("S")="I $P(^(0),""^"",4)" D ^DIC K DIC I Y'>0 G 3
"RTN","PSGOE3",49,0)
 S PSGMR=+Y,PSGMRN=$P(Y(0),"^"),PSGFOK(3)=""
"RTN","PSGOE3",50,0)
 ;
"RTN","PSGOE3",51,0)
26 ; schedule
"RTN","PSGOE3",52,0)
 W !,"SCHEDULE: ",$S(PSGSCH]"":PSGSCH_"// ",1:"") R X:DTIME I X="^"!'$T W:'$T $C(7) S PSGOROE1=1 G DONE
"RTN","PSGOE3",53,0)
 S PSGF2=26 S:X="" X=PSGSCH I "@"[X W $C(7),"  (Required)" S X="?" D ENHLP^PSGOEM(53.1,26) G 26
"RTN","PSGOE3",54,0)
 I X?1."?" D ENHLP^PSGOEM(53.1,26) G 26
"RTN","PSGOE3",55,0)
 I $E(X)="^" D FF G:Y>0 @Y G 26
"RTN","PSGOE3",56,0)
 D EN^PSGS0 I '$D(X) W $C(7),"  ??" S X="?" D ENHLP^PSGOEM(53.1,26) G 26
"RTN","PSGOE3",57,0)
 S PSGSCH=X,PSGST=$S(PSGS0XT="O":"O",PSGST="R":"R",X["PRN":"P",X="ON CALL":"OC",PSGST]"":PSGST,1:"C"),PSGFOK(26)=""
"RTN","PSGOE3",58,0)
 S $P(PSGNEDFD,"^",3)=PSGST S:PSGSCH=""!(X?1." ") PSGSCH="PRN"
"RTN","PSGOE3",59,0)
 ;
"RTN","PSGOE3",60,0)
8 ; special instructions
"RTN","PSGOE3",61,0)
 W !,"SPECIAL INSTRUCTIONS: "_$S(PSGSI]"":$P(PSGSI,"^")_"// ",1:"") R X:DTIME I X="^"!'$T W:'$T $C(7) S PSGOROE1=1 G DONE
"RTN","PSGOE3",62,0)
 I X="" S X=PSGSI I X="" S PSGFOK(8)="" G 10
"RTN","PSGOE3",63,0)
 S PSGF2=8 I $E(X)="^" D FF G:Y>0 @Y G 8
"RTN","PSGOE3",64,0)
 I X="@",PSGSI="" W $C(7),"  ??" S X="?" D ENHLP^PSGOEM(53.1,8) G 8
"RTN","PSGOE3",65,0)
 I X="@" D DEL G:%'=1 8 S PSGSI="",PSGFOK(8)="" G 10
"RTN","PSGOE3",66,0)
 I X?1."?" D ENHLP^PSGOEM(53.1,8) G 8
"RTN","PSGOE3",67,0)
 D ^PSGSICHK I '$D(X) W $C(7)," ??" S X="?" D ENHLP^PSGOEM(53.1,8) G 8
"RTN","PSGOE3",68,0)
 S PSGSI=X I PSGSI]"" S PSGSI=$$ENBCMA^PSJUTL("U"),PSGFOK(8)=""
"RTN","PSGOE3",69,0)
 ;
"RTN","PSGOE3",70,0)
10 ; start date edit
"RTN","PSGOE3",71,0)
 D ^PSGNE3 S PSGSD=PSGNESDO
"RTN","PSGOE3",72,0)
A10 ; start date/time edit
"RTN","PSGOE3",73,0)
 S PSGSDEDT=1 ; This variable indicates a Manual Edit of the Start/Date Time.
"RTN","PSGOE3",74,0)
 W !,"START DATE/TIME: "_PSGSD_"// " R X:DTIME I X="^"!'$T W:'$T $C(7) S PSGOROE1=1 G DONE
"RTN","PSGOE3",75,0)
 I X="@"!(X?1."?") W:X="@" $C(7),"  (Required)" S:X="@" X="?" D ENHLP^PSGOEM(53.1,10) G A10
"RTN","PSGOE3",76,0)
 S PSGF2=10 I $E(X)="^" D FF G:Y>0 @Y G A10
"RTN","PSGOE3",77,0)
 I X="",PSGNESD S X=PSGNESD,PSGFOK(10)="" W "  "_PSGSD G SD
"RTN","PSGOE3",78,0)
 I X="P" D ENPREV^PSGDL W:'$D(X) $C(7) G:'$D(X) A10 S PSGNESD=+X,PSGSD=$$ENDD^PSGMI(+X),PSGFOK(10)="" W "  ",PSGSD G SD
"RTN","PSGOE3",79,0)
 NEW TMPX S TMPX=X,X1=PSGDT,X2=-7 D C^%DTC K %DT S %DT="ERTX",%DT(0)=X,X=TMPX D ^%DT K %DT I Y'>0 D ENHLP^PSGOEM G A10
"RTN","PSGOE3",80,0)
 S PSGNESD=+Y,PSGSD=$$ENDD^PSGMI(PSGNESD),PSGFOK(10)=""
"RTN","PSGOE3",81,0)
 ;
"RTN","PSGOE3",82,0)
SD ; stop date
"RTN","PSGOE3",83,0)
 S PSGOES=1 D ENFD^PSGNE3(PSGDT) K PSGOES
"RTN","PSGOE3",84,0)
 ;
"RTN","PSGOE3",85,0)
 I $S($P(PSJSYSW0,"^",24):1,+PSJSYSU=3:1,$P(PSJSYSU,";",2):0,$D(PSJOERR):0,1:PSGOEORF) G ^PSGOE31
"RTN","PSGOE3",86,0)
 ;
"RTN","PSGOE3",87,0)
 ;
"RTN","PSGOE3",88,0)
DONE ;
"RTN","PSGOE3",89,0)
 I PSGOROE1 K Y W $C(7),"  ...order not entered..."
"RTN","PSGOE3",90,0)
 K F,F0,F1,PSGF2,F3,PSGFOK,PSGOROE1,PSGSD,SDT Q
"RTN","PSGOE3",91,0)
 ;
"RTN","PSGOE3",92,0)
FF ; up-arrow to another field
"RTN","PSGOE3",93,0)
 S Y=-1 I '$D(PSGFOK) W $C(7),"  ??" Q
"RTN","PSGOE3",94,0)
 S X=$E(X,2,99) I X=+X S Y=$S($D(PSGFOK(X)):X,1:-1) W "  " W:Y>0 $$CODES2^PSIVUTL(53.1,X) W:Y'>0 $C(7),"??" Q
"RTN","PSGOE3",95,0)
 K DIC S DIC="^DD(53.1,",DIC(0)="QEM",DIC("S")="I $D(PSGFOK(+Y))" D ^DIC K DIC S Y=+Y I Y>0,Y=1!(Y=2)!(Y=5)!(Y=6) S:Y=2 FB=PSGF2_"^PSGOE3" S Y=Y_"^PSGOE31"
"RTN","PSGOE3",96,0)
 Q
"RTN","PSGOE3",97,0)
 ;
"RTN","PSGOE3",98,0)
DEL ;
"RTN","PSGOE3",99,0)
 W !?3,"SURE YOU WANT TO DELETE" S %=0 D YN^DICN I %'=1 W "  <NOTHING DELETED>"
"RTN","PSGOE3",100,0)
 Q
"RTN","PSGOE4")
0^1^B42442364^B31371280
"RTN","PSGOE4",1,0)
PSGOE4 ;BIR/CML3 - REGULAR ORDER ENTRY ;06 Feb 01 / 4:31 PM
"RTN","PSGOE4",2,0)
 ;;5.0;INPATIENT MEDICATIONS ;**2,50,64,58,111,113,245,253,366**;16 DEC, 1997;Build 7
"RTN","PSGOE4",3,0)
 ;
"RTN","PSGOE4",4,0)
 ; Reference to ^PS(51.2 is supported by DBIA 2178.
"RTN","PSGOE4",5,0)
 ; Reference to ^PS(51.1 is supported by DBIA 2177.
"RTN","PSGOE4",6,0)
 ;
"RTN","PSGOE4",7,0)
 K PSGOES S PSGMR=$S($P(PSGNEDFD,"^",2):$P(PSGNEDFD,"^",2),1:PSGOEDMR),PSGSCH=$P(PSGNEDFD,"^",4),PSGPR=PSGOEPR,(PSGSD,PSGFD,PSGSM,PSGHSM,PSGUD,PSGSI,PSGOROE1,PSGNEFD,PSGMRN)=""
"RTN","PSGOE4",8,0)
 S:PSGMR PSGMRN=$S('$P(PSGNEDFD,"^",2):"",'$D(^PS(51.2,PSGMR,0)):PSGMR,$P(^(0),"^")]"":$P(^(0),"^"),1:PSGMR) I PSGPR S PSGPRN=$P($G(^VA(200,PSGPR,0)),"^") S:PSGPRN="" PSGPRN=PSGPR
"RTN","PSGOE4",9,0)
 S PSGST=$S($P(PSGNEDFD,"^",3)]"":$P(PSGNEDFD,"^",3),1:"C"),PSGSTN=$$ENSTN^PSGMI(PSGST),F1=53.1 K PSGFOK S PSGFOK(2)=""
"RTN","PSGOE4",10,0)
 S:$P(PSJSYSU,";",4) PSGFOK(2)="" K ^PS(53.45,PSJSYSP,1),^(2) I PSGDRG S ^(2,0)="^53.4502P^"_PSGDRG_"^1",^(1,0)=PSGDRG,^PS(53.45,PSJSYSP,2,"B",PSGDRG,1)=""
"RTN","PSGOE4",11,0)
 ;
"RTN","PSGOE4",12,0)
109 ; dosage ordered
"RTN","PSGOE4",13,0)
 I $P(PSJSYSU,";",4) D GETDOSE^PSJDOSE(PSGDRG) G:PSGOROE1 DONE G:'$G(PSGOE3) 3
"RTN","PSGOE4",14,0)
 W !,"DOSAGE ORDERED: ",$S(PSGDO]"":PSGDO_"// ",1:"") R X:DTIME I X="^"!'$T W:'$T $C(7) S PSGOROE1=1 G DONE
"RTN","PSGOE4",15,0)
 I X="" S X=PSGDO ;I X="" W $C(7),"  (Required)" G 109
"RTN","PSGOE4",16,0)
 S PSGF2=109 I X="@" S PSGDO="" ;W $C(7),"  (Required)" G 109
"RTN","PSGOE4",17,0)
 I X="@" D DEL G:%'=1 109 S (PSGDO,PSGFOK(109),PSGUD)="" G 3
"RTN","PSGOE4",18,0)
 I X?1."?" D ENHLP^PSGOEM(53.1,109) G 109
"RTN","PSGOE4",19,0)
 I $E(X)="^" D FF G:Y>0 @Y G 109
"RTN","PSGOE4",20,0)
 I $E(X,$L(X))=" " F  S X=$E(X,1,$L(X)-1) Q:$E(X,$L(X))'=" "
"RTN","PSGOE4",21,0)
 I $S(X="":0,X?.E1C.E:1,$L(X)>20:1,X="":1,X["^":1,X?1.P:1,1:X=+X) W $C(7),"  ",$S(X?1.P!(X=""):"(Required)",1:"??") D ENHLP^PSGOEM(53.1,109) G 109
"RTN","PSGOE4",22,0)
 S PSGDO=X,PSGFOK(109)=""
"RTN","PSGOE4",23,0)
 ;
"RTN","PSGOE4",24,0)
13 ; units per dose
"RTN","PSGOE4",25,0)
 ;/** NO LONGER USE WITH POE
"RTN","PSGOE4",26,0)
 Q:$G(PSGOE3)
"RTN","PSGOE4",27,0)
 G:'$P(PSJSYSU,";",4) 3 I $D(PSGFOK(13)) S PSGFOK(13)=1 D 2^PSGOE42 S PSGFOK(13)="" G 3
"RTN","PSGOE4",28,0)
 ;
"RTN","PSGOE4",29,0)
A13 ;
"RTN","PSGOE4",30,0)
 W !,"UNITS PER DOSE: ",$S(PSGUD:PSGUD_"// ",1:"") R X:DTIME I X="^"!'$T S PSGOROE1=1 G DONE
"RTN","PSGOE4",31,0)
 I X="" W:'PSGUD "  (1)" G S13
"RTN","PSGOE4",32,0)
 S PSGF2=13 I X="@",'PSGUD W $C(7),"  ??" S X="?" D ENHLP^PSGOEM(53.1,13) G A13
"RTN","PSGOE4",33,0)
 I X="@" D DEL G:%'=1 13 S PSGUD="" G S13
"RTN","PSGOE4",34,0)
 I X?1."?" D ENHLP^PSGOEM(53.1,13) G A13
"RTN","PSGOE4",35,0)
 I $E(X)="^" D FF G:Y>0 @Y G A13
"RTN","PSGOE4",36,0)
 I X?1.2N1"/"1.2N S X=+$J(+X/$P(X,"/",2),0,2) W "  ("_$E("0",X<1)_X_")"
"RTN","PSGOE4",37,0)
 I $S($L(X)>12:1,X'=+X:1,X>50:1,X<0:1,1:X?.N1"."3.N) W $C(7),"  ??" S X="?" D ENHLP^PSGOEM(53.1,13) G 13
"RTN","PSGOE4",38,0)
 S PSGUD=X W:'X "  (1)"
"RTN","PSGOE4",39,0)
 ;
"RTN","PSGOE4",40,0)
S13 ;
"RTN","PSGOE4",41,0)
 S PSGFOK(13)="" I PSGDRG S $P(^PS(53.45,PSJSYSP,2,1,0),"^",2)=PSGUD
"RTN","PSGOE4",42,0)
 ;
"RTN","PSGOE4",43,0)
3 ; med route
"RTN","PSGOE4",44,0)
 W !,"MED ROUTE: ",$S(PSGMR:PSGMRN,1:"")_"// " R X:DTIME I X="^"!'$T W:'$T $C(7) S PSGOROE1=1 G DONE
"RTN","PSGOE4",45,0)
 I X="",PSGMR S X=PSGMRN I PSGMR'=PSGMRN,$D(^PS(51.2,PSGMR,0)) W "  "_$P(^(0),"^",3) S PSGFOK(3)=""
"RTN","PSGOE4",46,0)
 S PSGF2=3 I $S(X="@":1,X]"":0,1:'PSGMR) W $C(7),"  (Required)" S X="?" D ENHLP^PSGOEM(53.1,2) G 3
"RTN","PSGOE4",47,0)
 I X="?" D MRSL ;*366
"RTN","PSGOE4",48,0)
 I X?1."??" D ENHLP^PSGOEM(53.1,3)
"RTN","PSGOE4",49,0)
 I $E(X)="^" D FF G:Y>0 @Y G 3
"RTN","PSGOE4",50,0)
 D CKMRSL ;*366
"RTN","PSGOE4",51,0)
 K DIC S DIC="^PS(51.2,",DIC(0)="EMQZX",DIC("S")="I $P(^(0),""^"",4)" D ^DIC K DIC I Y'>0 G 3  ;366
"RTN","PSGOE4",52,0)
 S PSGMR=+Y,PSGMRN=$P(Y(0),"^") S PSGFOK(3)=""
"RTN","PSGOE4",53,0)
 Q:$G(PSGOE3)
"RTN","PSGOE4",54,0)
 ;
"RTN","PSGOE4",55,0)
26 ; schedule
"RTN","PSGOE4",56,0)
 W !,"SCHEDULE: ",$S(PSGSCH]"":PSGSCH_"// ",1:"") R X:DTIME I X="^"!'$T W:'$T $C(7) S PSGOROE1=1 G DONE
"RTN","PSGOE4",57,0)
 S PSGF2=26 S:X="" X=PSGSCH,PSGSCH="" I "@"[X W $C(7),"  (Required)" S X="?" D ENHLP^PSGOEM(53.1,26) G 26
"RTN","PSGOE4",58,0)
 I X?1."?" D ENHLP^PSGOEM(53.1,26) G 26
"RTN","PSGOE4",59,0)
 I $E(X)="^" D FF G:Y>0 @Y G 26
"RTN","PSGOE4",60,0)
 S DOW=0 I $$DOW^PSIVUTL(X) S DOW=1,PSGST="C",PSGSTN=$$ENSTN^PSGMI(PSGST),PSGS0Y=$P(X,"@",2)
"RTN","PSGOE4",61,0)
 N PSJSLUP S PSJSLUP=1 D EN^PSGS0 I '$D(X) W $C(7),"  ??" S X="?" D ENHLP^PSGOEM(53.1,26) G 26
"RTN","PSGOE4",62,0)
 I PSGSCH[" PRN",$$PRNOK^PSGS0(PSGSCH) S PSGST="P",PSGSTN=$$ENSTN^PSGMI(PSGST)
"RTN","PSGOE4",63,0)
 S PSGSCH=X,$P(PSGNEDFD,"^",4)=X,PSGFOK(26)="" I PSGS0XT="O" S $P(PSGNEDFD,"^",3)="O",PSGST="O",PSGSTN=$$ENSTN^PSGMI(PSGST)
"RTN","PSGOE4",64,0)
 I $G(PSGOE3) D  Q
"RTN","PSGOE4",65,0)
 . S PSGSCH=X,PSGST=$S($G(DOW):"C",PSGS0XT="O":"O",PSGST="R":"R",X["PRN":"P",X="ON CALL":"OC",PSGST]"":PSGST,1:"C"),PSGFOK(26)=""
"RTN","PSGOE4",66,0)
 . S $P(PSGNEDFD,"^",3)=PSGST S:PSGSCH=""!(X?1." ") PSGSCH="PRN"
"RTN","PSGOE4",67,0)
 . S PSGSTN=$$ENSTN^PSGMI(PSGST)
"RTN","PSGOE4",68,0)
 K DOW
"RTN","PSGOE4",69,0)
 ;
"RTN","PSGOE4",70,0)
7 ; schedule type
"RTN","PSGOE4",71,0)
 Q:$G(PSGOE3)
"RTN","PSGOE4",72,0)
 D  ;Default Schedule Type from Schedule file - PSJ*5*113 - DRF
"RTN","PSGOE4",73,0)
 . N XX
"RTN","PSGOE4",74,0)
 . I $$DOW^PSIVUTL(PSGSCH) S PSGST="C",PSGSTN=$$ENSTN^PSGMI(PSGST) Q
"RTN","PSGOE4",75,0)
 . I PSGSCH[" PRN",$$PRNOK^PSGS0(PSGSCH) S PSGST="P",PSGSTN=$$ENSTN^PSGMI(PSGST) Q
"RTN","PSGOE4",76,0)
 . I PSGSCH]"" D
"RTN","PSGOE4",77,0)
 .. S XX=+$O(^PS(51.1,"AC","PSJ",PSGSCH,0))
"RTN","PSGOE4",78,0)
 .. S PSGST=$P($G(^PS(51.1,XX,0)),"^",5) I PSGST="D" S PSGST="C"
"RTN","PSGOE4",79,0)
 .. S PSGSTN=$$ENSTN^PSGMI(PSGST)
"RTN","PSGOE4",80,0)
 W !,"SCHEDULE TYPE: "_$S(PSGSTN]"":PSGSTN_"// ",1:"") R X:DTIME S X=$TR(X,"coprocf","COPROCF") I X="^"!'$T S PSGOROE1=1 W $C(7) G DONE
"RTN","PSGOE4",81,0)
 I X="" S:PSGST="OC" PSGSCH=PSGSTN,(PSGS0Y,PSGS0XT)="" W "  "_PSGSTN S PSGFOK(7)="" S $P(PSGNEDFD,"^",3)=PSGST G ^PSGOE41
"RTN","PSGOE4",82,0)
 S PSGF2=7 I X="@"!(X?1."?") W:X="@" $C(7),"  ??  (Required)" S:X="@" X="?" D ENHLP^PSGOEM(53.1,7) G 7
"RTN","PSGOE4",83,0)
 I $E(X)="^" D FF G:Y>0 @Y G 7
"RTN","PSGOE4",84,0)
 S:X="F" X="R" S X=$S(X="PRN":"P",X="ON CALL":"OC",X="FILL on REQUEST":"R",1:X)
"RTN","PSGOE4",85,0)
 I ",OC,P,R,"[(","_X_",") S PSGST=X,$P(PSGNEDFD,"^",3)=X,PSGSTN=$S(X="P":"PRN",X="R":"FILL ON REQUEST",1:"ON CALL") W "  "_PSGSTN S PSGFOK(7)="" G:X="R" 8^PSGOE41 S (PSGS0Y,PSGS0XT)="" G 8^PSGOE41
"RTN","PSGOE4",86,0)
 F Y="C^CONTINUOUS","O^ONE TIME","OC^ON CALL","P^PRN","R^FILL on REQUEST" I $P($P(Y,"^",2),X)="" W $P($P(Y,"^",2),X,2) S PSGST=$P(Y,"^"),PSGSTN=$P(Y,"^",2),$P(PSGNEDFD,"^",3)=PSGST Q
"RTN","PSGOE4",87,0)
 E  W $C(7),"  ??" S X="?" D ENHLP^PSGOEM(53.1,7) G 7
"RTN","PSGOE4",88,0)
 I PSGST="R" S PSGFOK(7)="" G 8^PSGOE41
"RTN","PSGOE4",89,0)
 S PSGFOK(7)=""
"RTN","PSGOE4",90,0)
 ;
"RTN","PSGOE4",91,0)
 G ^PSGOE41
"RTN","PSGOE4",92,0)
 ;
"RTN","PSGOE4",93,0)
DONE ;
"RTN","PSGOE4",94,0)
 I PSGOROE1 K Y W $C(7),"  ...order not entered..."
"RTN","PSGOE4",95,0)
 K F,F0,F1,PSGF2,F3,PSG,PSGSD,SDT Q
"RTN","PSGOE4",96,0)
 ;
"RTN","PSGOE4",97,0)
FF ; up-arrow to another field
"RTN","PSGOE4",98,0)
 D ENFF^PSGOEM I Y>0,Y'=109,Y'=13,Y'=3,Y'=7,Y'=26 S:Y=2 FB=PSGF2_"^PSGOE4" S Y=Y_"^PSGOE4"_$S("^39^8^10^25^"[("^"_Y_"^"):1,1:2)
"RTN","PSGOE4",99,0)
 Q
"RTN","PSGOE4",100,0)
 ;
"RTN","PSGOE4",101,0)
DEL ; delete entry
"RTN","PSGOE4",102,0)
 W !?3,"SURE YOU WANT TO DELETE" S %=0 D YN^DICN I %'=1 W $C(7),"  <NOTHING DELETED>"
"RTN","PSGOE4",103,0)
 Q
"RTN","PSGOE4",104,0)
 ;
"RTN","PSGOE4",105,0)
MRSL ;check for OI med route short list;
"RTN","PSGOE4",106,0)
 I $G(PSGPDRG) D START^PSSJORDF(PSGPDRG,"U") N MRCNT S MRCNT=$O(^TMP("PSJMR",$J,"A"),-1) I MRCNT D
"RTN","PSGOE4",107,0)
 . N MRTP S MRTP="PSJTP" K ^TMP(MRTP,$J) S ^TMP(MRTP,$J,0)=U_U_MRCNT_U_MRCNT
"RTN","PSGOE4",108,0)
 . N I S I=0 F  S I=$O(^TMP("PSJMR",$J,I)) Q:'I  D
"RTN","PSGOE4",109,0)
 . . S ^TMP(MRTP,$J,I,0)=^TMP("PSJMR",$J,I),^TMP(MRTP,$J,"B",$P(^TMP("PSJMR",$J,I),U),I)="" W !,?10,I_"  "_$P(^TMP("PSJMR",$J,I),U)_"  "_$P(^TMP("PSJMR",$J,I),U,2)
"RTN","PSGOE4",110,0)
 . N DIC S DIC("A")="Select MED ROUTE: ",DIC="^TMP(MRTP,$J,",DIC(0)="AEQZ" D ^DIC K ^TMP(MRTP,$J),^TMP("PSJMR",$J) Q:Y=-1
"RTN","PSGOE4",111,0)
 . I X=" " S X="^" Q
"RTN","PSGOE4",112,0)
 . S X=$P(Y,"^",2)
"RTN","PSGOE4",113,0)
 Q
"RTN","PSGOE4",114,0)
 ;
"RTN","PSGOE4",115,0)
CKMRSL ;;check for med route short list leading letters ;*525
"RTN","PSGOE4",116,0)
 I $G(PSGPDRG) D START^PSSJORDF(PSGPDRG,"U") N MRCNT S MRCNT=$O(^TMP("PSJMR",$J,"A"),-1) I MRCNT D
"RTN","PSGOE4",117,0)
 . N MRTP S MRTP="PSJTP" K ^TMP(MRTP,$J) S ^TMP(MRTP,$J,0)=U_U_MRCNT_U_MRCNT
"RTN","PSGOE4",118,0)
 . N I S I=0 F  S I=$O(^TMP("PSJMR",$J,I)) Q:'I  D
"RTN","PSGOE4",119,0)
 . . S ^TMP(MRTP,$J,I,0)=^TMP("PSJMR",$J,I),^TMP(MRTP,$J,"B",$P(^TMP("PSJMR",$J,I),U),I)=""
"RTN","PSGOE4",120,0)
 . N DIC S DIC("T")="",DIC="^TMP(MRTP,$J,",DIC(0)="EM" D ^DIC K ^TMP(MRTP,$J),^TMP("PSJMR",$J)
"RTN","PSGOE4",121,0)
 . I Y=-1 Q
"RTN","PSGOE4",122,0)
 . S X=$P(Y,"^",2)
"RTN","PSGOE4",123,0)
 Q
"RTN","PSGOE4",124,0)
 ;
"RTN","PSGOE41")
0^25^B104146997^B102492308
"RTN","PSGOE41",1,0)
PSGOE41 ;BIR/CML3 - REGULAR ORDER ENTRY (CONT.) ;Jul 02, 2018@09:07
"RTN","PSGOE41",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**50,63,64,69,58,111,136,113,267,315,334,373,366**;16 DEC 97;Build 7
"RTN","PSGOE41",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PSGOE41",4,0)
 ; Reference to ^DICN is supported by DBIA 10009.
"RTN","PSGOE41",5,0)
 ; Reference to %DT is supported by DBIA 10003.
"RTN","PSGOE41",6,0)
 ; Reference to %DTC is supported by DBIA 10000.
"RTN","PSGOE41",7,0)
 ; Reference to ^PS(51.1 is supported by DBIA 2177.
"RTN","PSGOE41",8,0)
 ; Reference to ^PS(50.7 is supported by DBIA# 2180
"RTN","PSGOE41",9,0)
 ;
"RTN","PSGOE41",10,0)
39 ; admin times
"RTN","PSGOE41",11,0)
 G:$P(PSGNEDFD,"^",3)="P"!($P(PSGNEDFD,"^",3)="OC") 8
"RTN","PSGOE41",12,0)
 I $$ODD^PSGS0(PSGS0XT) D PSGDUR G 8
"RTN","PSGOE41",13,0)
 W !,"ADMIN TIMES: "_$S(PSGS0Y:PSGS0Y_"// ",1:"") R X:DTIME I X="^"!'$T W:'$T $C(7) S PSGOROE1=1,PSGDUR="" G DONE
"RTN","PSGOE41",14,0)
 I X="",PSGS0Y]"" S PSGNOHI=1,X=PSGS0Y ;*315 If admin time default was taken then don't highlight admin time.
"RTN","PSGOE41",15,0)
 I X="",$G(PSGS0XT)="D" I $L(PSGSCH,"@")=2,$P(PSGSCH,"@",2) S (PSGAT,PSGS0Y)=$P(PSGSCH,"@",2) G 8
"RTN","PSGOE41",16,0)
 I X?1."?" D ENHLP^PSGOEM(53.1,39) G 39
"RTN","PSGOE41",17,0)
 I X="@" D DEL G:%'=1 39 S (PSGFOK(39),PSGS0Y)="" G 39
"RTN","PSGOE41",18,0)
 S PSGF2=39 I $E(X)="^" D FF G:Y>0 @Y G 39
"RTN","PSGOE41",19,0)
 I (PSGS0XT="D")&('$G(X)!(X["@"&($P($G(X),"@",2)))) I ((",P,R,")'[(","_$G(PSGST)_",")) D  G 39
"RTN","PSGOE41",20,0)
 . W $C(7),"  ??" S X="?" W !,"This is a 'DAY OF THE WEEK' schedule and MUST have admin times." D ENHLP^PSGOEM(53.1,39)
"RTN","PSGOE41",21,0)
 .Q
"RTN","PSGOE41",22,0)
 I $G(PSGS0XT)'="D",$G(PSGS0XT)'="P",$G(PSGS0XT)'="OC" D TIMES G:'$D(X) 39 D PSGDUR G:'$D(X) 39 G:$G(X)="^" DONE ;*315
"RTN","PSGOE41",23,0)
 I $G(PSGS0XT)="O",X="" S (PSGAT,PSGS0Y)=X,PSGFOK(39)="" G 8
"RTN","PSGOE41",24,0)
 D ENCHK^PSGS0 I '$D(X) W $C(7),"  ??" G 39
"RTN","PSGOE41",25,0)
 S (PSGAT,PSGS0Y)=X,PSGFOK(39)=""
"RTN","PSGOE41",26,0)
 ;
"RTN","PSGOE41",27,0)
8 ; special instructions
"RTN","PSGOE41",28,0)
 S PSGSI=$$EDITSI^PSJBCMA5($G(PSGP),$G(PSGORD))
"RTN","PSGOE41",29,0)
 S PSGF2=8 I $E(X)="^" D FF G:Y>0 @Y G 8
"RTN","PSGOE41",30,0)
 I X="@",PSGSI="" W $C(7),"  ??" S X="?" D ENHLP^PSGOEM(53.1,8) G 8
"RTN","PSGOE41",31,0)
 I X="@" D DEL G:%'=1 8 S (PSGFOK(8),PSGSI)="" G:'$G(PSGOE3) 10
"RTN","PSGOE41",32,0)
 I X?1."?" D ENHLP^PSGOEM(53.1,8) G 8
"RTN","PSGOE41",33,0)
 S PSGSI=$S((PSGSI>0&(PSGSI<3)):$G(^PS(53.45,+PSJSYSP,5,1,0))_" "_$G(^PS(53.45,+PSJSYSP,5,2,0)),PSGSI>2:"Instructions too long. See Order View or BCMA for full text",1:"")
"RTN","PSGOE41",34,0)
 S:PSGSI=" " PSGSI="" I PSGSI]"" S PSGSI=$$ENBCMA^PSJUTL("U"),PSGFOK(8)=""
"RTN","PSGOE41",35,0)
 Q:$G(PSGOE3)
"RTN","PSGOE41",36,0)
10 ; start date/time
"RTN","PSGOE41",37,0)
 D ^PSGNE3
"RTN","PSGOE41",38,0)
 S:'$D(PSGNESDO) PSGNESDO=$$ENDD^PSGMI(PSGNESD) S PSGSD=PSGNESDO
"RTN","PSGOE41",39,0)
A10 ; start date/time edit
"RTN","PSGOE41",40,0)
 S PSGSDEDT=1 ; This variable indicates a Manual Edit of the Start/Date Time.
"RTN","PSGOE41",41,0)
 W !,"START DATE/TIME: "_PSGSD_"// " R X:DTIME I X="^"!'$T W:'$T $C(7) S PSGOROE1=1 G DONE
"RTN","PSGOE41",42,0)
 I X="",PSGNESD W "  "_PSGSD G O25
"RTN","PSGOE41",43,0)
 I X="P" D ENPREV^PSGDL W:'$D(X) $C(7) G:'$D(X) A10 S PSGNESD=+X,PSGSD=$$ENDD^PSGMI(+X) W "  ",PSGSD G O25
"RTN","PSGOE41",44,0)
 S PSGF2=10 I X="@"!(X?1."?") W:X="@" $C(7),"  (Required)" S:X="@" X="?" D ENHLP^PSGOEM(53.1,10)
"RTN","PSGOE41",45,0)
 I $E(X)="^" D FF G:Y>0 @Y G A10
"RTN","PSGOE41",46,0)
 NEW TMPX S TMPX=X,X1=PSGDT,X2=-7 D C^%DTC K %DT S %DT="ERTX",%DT(0)=X,X=TMPX D ^%DT K %DT I Y'>0 D ENHLP^PSGOEM(53.1,10) G A10
"RTN","PSGOE41",47,0)
 ; RBD PSJ*5*373 Soft stop when Start Date more than 7 days after Order's LOGIN DATE
"RTN","PSGOE41",48,0)
 S X1=PSGDT,X2=+7 D C^%DTC
"RTN","PSGOE41",49,0)
 I +Y>X W !!,$C(7),"Start date/time should not be entered for more than 7 days after the",!,"order's LOGIN DATE.",! K DIR D WAIT^VALM1
"RTN","PSGOE41",50,0)
 S PSGNESD=+Y,PSGSD=$$ENDD^PSGMI(+Y),(PSGNEFD,PSGFD)=""
"RTN","PSGOE41",51,0)
 ;
"RTN","PSGOE41",52,0)
O25 ;
"RTN","PSGOE41",53,0)
 S PSGFOK(10)="" I $P(PSGNEDFD,"^",3)="O" S PSGNEFD=$$ENOSD^PSJDCU(PSJSYSW0,PSGNESD,PSGP) I PSGNEFD]"" S PSGFD=$$ENDD^PSGMI(PSGNEFD)
"RTN","PSGOE41",54,0)
 ;
"RTN","PSGOE41",55,0)
25 ; stop date
"RTN","PSGOE41",56,0)
 Q:$G(PSGOE3)
"RTN","PSGOE41",57,0)
 I 'PSGNEFD D ENFD^PSGNE3(PSGDT) S PSGFD=PSGNEFDO
"RTN","PSGOE41",58,0)
 N MSG,PSGTMPST S PSGTMPST=$G(PSGST) S:'+$G(PSGRF) PSGRF=$P($G(^PS(50.7,$G(PSGPDRG),4),0),U,1) ;*315 One time orders for MRR's require message to instruct pharmacists
"RTN","PSGOE41",59,0)
 I +$G(PSGRF),$D(^PS(51.1,"AC","PSJ",$G(PSGSCH))) D
"RTN","PSGOE41",60,0)
 . S:PSGTMPST=($G(PSGST)="R") PSGST=$P($G(^PS(51.1,$O(^PS(51.1,"AC","PSJ",$G(PSGSCH),"")),0)),"^",5) ;Handle "Fill on Request"
"RTN","PSGOE41",61,0)
 .Q
"RTN","PSGOE41",62,0)
 I $G(PSGTMPST)="O",+$G(PSGRF) S (PSGNEFD,PSGFD)="" D
"RTN","PSGOE41",63,0)
 . I +$G(PSGRF)=1 S MSG(1)="This NOW order has an Orderable Item for which a removal is required" D
"RTN","PSGOE41",64,0)
 .. S MSG(2)=" at the next administration."
"RTN","PSGOE41",65,0)
 .. S MSG(3)="The Stop DATE/TIME entered should be the next anticipated administration for the medication.",MSG(3,"F")="!"
"RTN","PSGOE41",66,0)
 ..Q
"RTN","PSGOE41",67,0)
 . I +$G(PSGRF)=2 S MSG(1)="This NOW order has an Orderable Item for which a removal period is optional",MSG(1,"F")="!!" D
"RTN","PSGOE41",68,0)
 .. S MSG(2)="prior to the next administration.",MSG(2,"F")="!"
"RTN","PSGOE41",69,0)
 .. S MSG(3)="If Early Removal is needed, enter Removal Time in Stop DATE/TIME field.",MSG(3,"F")="!"
"RTN","PSGOE41",70,0)
 .. S MSG(4)="If an Early Removal is not required, the Stop DATE/TIME entered"
"RTN","PSGOE41",71,0)
 .. S MSG(5)="should be the next anticipated administration for the medication.",MSG(5,"F")="!"
"RTN","PSGOE41",72,0)
 ..Q
"RTN","PSGOE41",73,0)
 . I +$G(PSGRF)=3 S MSG(1)="This NOW order has an Orderable Item that requires a removal period prior",MSG(1,"F")="!!" D
"RTN","PSGOE41",74,0)
 .. S MSG(2)=" to the next administration.",MSG(2,"F")="!"
"RTN","PSGOE41",75,0)
 .. S MSG(3)="Please Enter the Stop DATE/TIME to reflect the Removal Time for this medication.",MSG(3,"F")="!"
"RTN","PSGOE41",76,0)
 ..Q
"RTN","PSGOE41",77,0)
 . D EN^DDIOL(.MSG)
"RTN","PSGOE41",78,0)
 .Q
"RTN","PSGOE41",79,0)
A25 W !,"STOP DATE/TIME: "_$S(PSGFD]"":PSGFD_"// ",1:"") R X:DTIME I X="^"!'$T W:'$T $C(7) S PSGOROE1=1 G DONE
"RTN","PSGOE41",80,0)
 I X="",PSGNEFD W "   "_PSGFD S PSGFOK(25)=""  G W25
"RTN","PSGOE41",81,0)
 S PSGF2=25 I $E(X)="^" D FF G:Y>0 @Y G A25
"RTN","PSGOE41",82,0)
 I X="@"!(X?1."?") W:X="@" $C(7),"  (Required)" S:X="@" X="?" D ENHLP^PSGOEM(53.1,25)
"RTN","PSGOE41",83,0)
 I X=+X,(X>0),(X'>2000000) G A25:'$$ENDL^PSGDL(PSGSCH,X) K PSGDLS S PSGDL=X W " ...dose limit..." D EN1^PSGDL
"RTN","PSGOE41",84,0)
 K %DT S %DT="ERTX",%DT(0)=PSGNESD D ^%DT K %DT I Y'>0 W $C(7),!!?13,"*** WARNING! INVALID STOP DATE OR PRIOR TO START DATE! ***",! G A25
"RTN","PSGOE41",85,0)
 ; RBD PSJ*5*373 Hard stop when Stop Date more than 367 days after Start Date
"RTN","PSGOE41",86,0)
 S X1=+Y,X2=PSGNESD D ^%DTC
"RTN","PSGOE41",87,0)
 I X>367 W $C(7),!!?13,"*** STOP DATE cannot be more than 367 days from START DATE ***",! G A25
"RTN","PSGOE41",88,0)
 S PSGNEFD=+Y,PSGFD=$$ENDD^PSGMI(+Y),PSGFOK(25)=""
"RTN","PSGOE41",89,0)
W25 ;
"RTN","PSGOE41",90,0)
 N Z
"RTN","PSGOE41",91,0)
 D DOSE I $G(Z)]"",Z>PSGNEFD D  G A25
"RTN","PSGOE41",92,0)
 . W !,"There must be an admin time that falls between the Start Date/Time"
"RTN","PSGOE41",93,0)
 . W !,"and the Stop Date/Time."
"RTN","PSGOE41",94,0)
 I PSGNEFD<PSGDT W $C(7),!!?13,"*** WARNING! THE STOP DATE ENTERED IS IN THE PAST! ***",!
"RTN","PSGOE41",95,0)
 D EFDNEW^PSJUTL  ;Display Expected First Dose;BHW;PSJ*5*136
"RTN","PSGOE41",96,0)
 I $G(PSGDUR),'$G(PSGOROE1) D VERTIMES ;*315
"RTN","PSGOE41",97,0)
NEXT ;
"RTN","PSGOE41",98,0)
 S:'+$G(PSGRF) PSGRF=$P($G(^PS(50.7,$G(PSGPDRG),4),0),U,1)
"RTN","PSGOE41",99,0)
 G:'$D(PSGAARR) 1^PSGOE42
"RTN","PSGOE41",100,0)
 ;
"RTN","PSGOE41",101,0)
DONE ;
"RTN","PSGOE41",102,0)
 I PSGOROE1 K Y W $C(7),"  ...order not entered..."
"RTN","PSGOE41",103,0)
 K F,F0,F1,PSGF2,F3,PSG,SDT Q
"RTN","PSGOE41",104,0)
 ;
"RTN","PSGOE41",105,0)
FF ; up-arrow to another field
"RTN","PSGOE41",106,0)
 D ENFF^PSGOEM I Y>0,Y'=39,Y'=8,Y'=10,Y'=25 S Y=Y_"^PSGOE4"_$S("^109^13^3^7^26^"[("^"_Y_"^"):"",1:2) S:$P(Y,U)=2 FB=PSGF2_"^PSGOE41"
"RTN","PSGOE41",107,0)
 Q
"RTN","PSGOE41",108,0)
 ;
"RTN","PSGOE41",109,0)
DEL ; delete entry
"RTN","PSGOE41",110,0)
 W !?3,"SURE YOU WANT TO DELETE" S %=0 D YN^DICN I %'=1 W $C(7),"  <NOTHING DELETED>"
"RTN","PSGOE41",111,0)
 Q
"RTN","PSGOE41",112,0)
TIMES    ;At least one admin time, not more than interval allows.
"RTN","PSGOE41",113,0)
 I $G(PSGS0XT)'="O",X="" W !,"This order requires at least one administration time." K X Q  ;No times
"RTN","PSGOE41",114,0)
 N H,I,MAX
"RTN","PSGOE41",115,0)
 I PSGSCH]"" I $D(^PS(51.1,"AC","PSJ",PSGSCH)) S H=+$O(^PS(51.1,"AC","PSJ",PSGSCH,0)) S I=$P($G(^PS(51.1,H,0)),"^",3)
"RTN","PSGOE41",116,0)
 I $G(PSGST)="O",$L(X,"-")>1 W !,"This is a One Time Order - only one admin time is permitted." K X Q
"RTN","PSGOE41",117,0)
 I $G(PSGST)="O" Q  ;Done validating One Time
"RTN","PSGOE41",118,0)
 I +$G(I)=0 Q  ;No frequency - can not check frequency related items
"RTN","PSGOE41",119,0)
 S MAX=1440/I
"RTN","PSGOE41",120,0)
 I MAX<1 D  Q
"RTN","PSGOE41",121,0)
 . I $L(X,"-")'=1 W !,"This order requires one admin time." K X Q
"RTN","PSGOE41",122,0)
 I MAX'<1,$L(X,"-")>MAX W !,"The number of admin times entered is greater than indicated by the schedule." K X Q  ;Too many times
"RTN","PSGOE41",123,0)
 I MAX'<1,$L(X,"-")<MAX W !,"The number of admin times entered is fewer than indicated by the schedule."  ;Too few times
"RTN","PSGOE41",124,0)
 Q
"RTN","PSGOE41",125,0)
DOSE ;Make certain at least one dose is given.
"RTN","PSGOE41",126,0)
 Q:$G(PSGST)="OC"!($G(PSGST)="P")
"RTN","PSGOE41",127,0)
 N INFO,X
"RTN","PSGOE41",128,0)
 S Z="",INFO=($G(PSGNESD))_U_($G(PSGNEFD))_U_($G(PSGSCH))_U_($G(PSGST))_U_($G(PSGDRG))_U_($G(PSGS0Y))
"RTN","PSGOE41",129,0)
 I '$L($G(PSGP)) N PSGP S PSGP=""
"RTN","PSGOE41",130,0)
 S Z=$$ENQ^PSJORP2(PSGP,INFO)  ;Expected first dose.
"RTN","PSGOE41",131,0)
 Q
"RTN","PSGOE41",132,0)
 ;
"RTN","PSGOE41",133,0)
 ;*315 new tags
"RTN","PSGOE41",134,0)
PSGDUR ; Prompt for Removal times if admin times are on 24hr rotations and Site Params are enabled.
"RTN","PSGOE41",135,0)
 ; check parameter files for removal criteria quit if removal rotation not enabled (<2)
"RTN","PSGOE41",136,0)
 ; if enabled determine type (hard vers soft stop)
"RTN","PSGOE41",137,0)
 ;0 = no removal (current cap/tab functionality)
"RTN","PSGOE41",138,0)
 ;1 = removal at next admin (current patch functionality)
"RTN","PSGOE41",139,0)
 ;2 = removal prior to next admin; soft stop (pharmacist optional prompt to designate duration of administration
"RTN","PSGOE41",140,0)
 ;3 = removal prior to next admin; hard stop (pharmacist required prompt to designate duration of administration)
"RTN","PSGOE41",141,0)
 ; prompt for removal if = 2 then allow skip, if = 3 then force entry
"RTN","PSGOE41",142,0)
 ;
"RTN","PSGOE41",143,0)
 S PSGRF=$P($G(^PS(50.7,$G(PSGPDRG),4),0),U,1) Q:((PSGRF<2)!($G(PSGST)="O")!($G(PSGST)="P")!($G(PSGST)="OC"))  ; no removal flag or no removal rotation
"RTN","PSGOE41",144,0)
 Q:$G(PSGS0XT)>1440  ; Duration of Administration valid only for 24 hours - subject to change in future.
"RTN","PSGOE41",145,0)
 N RP,PSGIDF,WMSG,PSGDERR S (PSGIDF,PSGDERR)=0 S:$G(PSGDUR)>0 RP=PSGDUR/60 S:"BID,TID,QID"[$G(PSGSCH) PSGIDF=1 ; Use separate validation for Times Per Day type orders
"RTN","PSGOE41",146,0)
 S PSGF2=39
"RTN","PSGOE41",147,0)
 W !,"DURATION OF ADMINISTRATION (HRS): "_$S($G(RP):RP_"// ",1:"") R RP:DTIME I RP="^"!'$T W:'$T $C(7) S PSGOROE1=1,X="^" K PSGFOK(39) Q
"RTN","PSGOE41",148,0)
 I RP="",$G(PSGS0XT)="D" I $L(PSGSCH,"@")=2,$P(PSGSCH,"@",2) S (PSGAT,PSGRMV)=$P(PSGSCH,"@",2) G 8
"RTN","PSGOE41",149,0)
 I RP="@",PSGRF'=3 D DEL G:%'=1 PSGDUR S (PSGFOK(39),PSGS0Y,PSGDUR,PSGRMVT)="",PSGRMV=-1 S:+$G(^PS(53.1,+$G(PSGORD),2.1)) (PSGDUR,PSGRMVT)="@" Q
"RTN","PSGOE41",150,0)
 I (RP'=""),(RP'="@"),($E(RP)'="^"),($E(RP)'="?") S:(RP'?1N.2N)!(+(RP)<1) RP="?"
"RTN","PSGOE41",151,0)
 I RP?1."?" D DURHLP^PSGOEM(RP,PSGRF) G PSGDUR
"RTN","PSGOE41",152,0)
 I $E(RP)="^" D FF G:Y>0 @Y G PSGDUR
"RTN","PSGOE41",153,0)
 I (+RP>0),'PSGIDF D  ; exclude TPD schedules
"RTN","PSGOE41",154,0)
 . S PSGDUR=(RP*60),PSGRMV=$G(PSGS0XT)-PSGDUR
"RTN","PSGOE41",155,0)
 . I PSGRMV<1 W !,"DURATION OF ADMINISTRATION MATCHES OR EXCEEDS ORDER FREQUENCY" S RP="",PSGDERR=1 K PSGDUR,PSGRMV G PSGDUR
"RTN","PSGOE41",156,0)
 .Q
"RTN","PSGOE41",157,0)
 Q:$G(PSGDERR)=1
"RTN","PSGOE41",158,0)
 I PSGRF=3,(+RP<1) W !,"ENTRY IS REQUIRED" S RP="" G PSGDUR
"RTN","PSGOE41",159,0)
 I PSGRF=2,(+RP<1) D
"RTN","PSGOE41",160,0)
 . W !,"You have not entered Duration of Administration for this medication order, "
"RTN","PSGOE41",161,0)
 . W !,"therefore the BCMA user will not be prompted to remove the medication prior "
"RTN","PSGOE41",162,0)
 . W !,"to the next Admin Time."
"RTN","PSGOE41",163,0)
 . S PSGRMV=-1,RP=0
"RTN","PSGOE41",164,0)
 .Q
"RTN","PSGOE41",165,0)
 I PSGIDF,(+RP>0) D  ;Only for TPD schedules
"RTN","PSGOE41",166,0)
 . N F,P,PSGARR
"RTN","PSGOE41",167,0)
 . S PSGADT=$S($G(PSGDUR)=-1:X,$G(PSGS0Y):PSGS0Y,$G(PSGAT):PSGAT,1:""),PSGAT=PSGADT
"RTN","PSGOE41",168,0)
 . S PSGARR=$L($G(PSGADT),"-")
"RTN","PSGOE41",169,0)
 . F P=1:1:PSGARR D
"RTN","PSGOE41",170,0)
 .. S PSGARR(P)=($P(PSGADT,"-",P)/100) S:(P>1) F(P)=PSGARR(P)-PSGARR(P-1)
"RTN","PSGOE41",171,0)
 .. I $G(F(P)),($G(F(P))'=RP) S WMSG=1_U_"Duration of Administration does not correspond to one or more",WMSG(1)="of this order's scheduled Administration Times!"
"RTN","PSGOE41",172,0)
 ..Q
"RTN","PSGOE41",173,0)
 .Q
"RTN","PSGOE41",174,0)
 S:(+RP>0) PSGDUR=(RP*60)
"RTN","PSGOE41",175,0)
 W:(+RP>0) ?60,RP," HOURS"
"RTN","PSGOE41",176,0)
 D:$G(WMSG) EN^DDIOL($P(WMSG,U,2)),EN^DDIOL(WMSG(1))
"RTN","PSGOE41",177,0)
 Q:'$G(PSGOE3)!'+$G(PSGDUR)
"RTN","PSGOE41",178,0)
 ;
"RTN","PSGOE41",179,0)
VERTIMES ; Redisplay Admin and Removal times
"RTN","PSGOE41",180,0)
 S PSGRF=$P($G(^PS(50.7,$G(PSGPDRG),4),0),U,1) Q:(PSGRF<2)!($G(PSGST)="O")
"RTN","PSGOE41",181,0)
 N PSGADT,PSGRARR,PSGAARR
"RTN","PSGOE41",182,0)
 ;If we have a frequency and this is odd type order then we need to start calculations with order start time.
"RTN","PSGOE41",183,0)
 I $G(PSGS0XT),$G(PSGNESD),+$G(PSGDUR),$G(PSGAT)="",$G(PSGS0Y)="" D  Q
"RTN","PSGOE41",184,0)
 . N L
"RTN","PSGOE41",185,0)
 . S (PSGAARR,PSGRARR)=1,PSGADT=$P($P(PSGNESD,U,1),".",2),L=$L(PSGADT)
"RTN","PSGOE41",186,0)
 . S PSGRARR(1)=(((((PSGADT*60)+PSGDUR)/60)#24)*100) S:PSGRARR(1)=0 PSGRARR(1)=2400 S:$L(PSGRARR(1))=3 PSGRARR(1)="0"_PSGRARR(1)
"RTN","PSGOE41",187,0)
 . S PSGRARR(1)=$E(PSGRARR(1),1,L)_"(R)"
"RTN","PSGOE41",188,0)
 . S PSGAARR(1)=PSGADT,PSGAARR(1)=$E(PSGAARR(1),1,L)_"(A)"
"RTN","PSGOE41",189,0)
 . D WRITE
"RTN","PSGOE41",190,0)
 .Q
"RTN","PSGOE41",191,0)
 ;
"RTN","PSGOE41",192,0)
 S (PSGRARR,PSGAARR)=$S($G(PSGAT):$L(PSGAT,"-"),1:$L(PSGS0Y,"-"))
"RTN","PSGOE41",193,0)
 N P,L
"RTN","PSGOE41",194,0)
 F P=1:1:PSGRARR D
"RTN","PSGOE41",195,0)
 . S PSGADT=$S($G(PSGAT):$P(PSGAT,"-",P),1:$P(PSGS0Y,"-",P)),L=$L(PSGADT)
"RTN","PSGOE41",196,0)
 . S PSGADT=$S($L(PSGADT)=4:PSGADT/100,1:PSGADT*1)
"RTN","PSGOE41",197,0)
 . S PSGRARR(P)=(((((PSGADT*60)+PSGDUR)/60)#24)*100) S:PSGRARR(P)=0 PSGRARR(P)=2400 S:$L(PSGRARR(P))=3 PSGRARR(P)="0"_PSGRARR(P)
"RTN","PSGOE41",198,0)
 . S PSGRARR(P)=$E(PSGRARR(P),1,L)_"(R)"
"RTN","PSGOE41",199,0)
 . S PSGAARR(P)=(PSGADT*100) S:$L(PSGAARR(P))=3 PSGAARR(P)="0"_PSGAARR(P)
"RTN","PSGOE41",200,0)
 . S PSGAARR(P)=$E(PSGAARR(P),1,L)_"(A)"
"RTN","PSGOE41",201,0)
 .Q
"RTN","PSGOE41",202,0)
 D WRITE
"RTN","PSGOE41",203,0)
 Q
"RTN","PSGOE41",204,0)
 ;
"RTN","PSGOE41",205,0)
WRITE ;
"RTN","PSGOE41",206,0)
 W !!,"Verify Admin and removal times",!
"RTN","PSGOE41",207,0)
 W !,"(A)DMINISTRATION -(R)EMOVAL TIMES"
"RTN","PSGOE41",208,0)
 W !,"___________________________________________________________________________",!
"RTN","PSGOE41",209,0)
 F P=1:1:PSGAARR W PSGAARR(P)_"-"_PSGRARR(P)  W:P'=PSGAARR " , "
"RTN","PSGOE41",210,0)
 D ASK
"RTN","PSGOE41",211,0)
 Q
"RTN","PSGOE41",212,0)
 ;
"RTN","PSGOE41",213,0)
ASK ;
"RTN","PSGOE41",214,0)
 N Y
"RTN","PSGOE41",215,0)
 S DIR("A")="Is this correct",DIR(0)="Y" D ^DIR I $D(DUOUT)!$D(DTOUT) W:'$T $C(7) S PSGOEE=0 K PSGDUR G DONE
"RTN","PSGOE41",216,0)
 I 'Y K X S PSGDUR=-1 G 39
"RTN","PSGOE41",217,0)
 N P S P=1,PSGRMVT=$P(PSGRARR(P),"(",1)
"RTN","PSGOE41",218,0)
 F  S P=$O(PSGRARR(P)) Q:P=""  D
"RTN","PSGOE41",219,0)
 . S PSGRMVT=PSGRMVT_"-"_$P(PSGRARR(P),"(",1)
"RTN","PSGOE41",220,0)
 .Q
"RTN","PSGOE41",221,0)
 Q
"RTN","PSGOE41",222,0)
 ;
"RTN","PSGOE42")
0^6^B10268792^B10177522
"RTN","PSGOE42",1,0)
PSGOE42 ;BIR/CML3-REGULAR ORDER ENTRY (CONT.) ;09 JAN 97 9:25 AM
"RTN","PSGOE42",2,0)
 ;;5.0;INPATIENT MEDICATIONS ;**366**;16 DEC 97;Build 7
"RTN","PSGOE42",3,0)
 ;
"RTN","PSGOE42",4,0)
1 ; provider
"RTN","PSGOE42",5,0)
 I $S(+PSJSYSU=3:0,1:$P(PSJSYSU,";",2)) G:$P(PSJSYSW0,"^",24) 5 G DONE
"RTN","PSGOE42",6,0)
A1 ;
"RTN","PSGOE42",7,0)
 ;*366 - check provider credentials
"RTN","PSGOE42",8,0)
 I PSGPR N PSJACT S PSJACT=$$ACTPRO^PSGOE1(PSGPR) S:'PSJACT PSGPR=0,PSGPRN=""
"RTN","PSGOE42",9,0)
 W !,"PROVIDER: ",$S(PSGPR:PSGPRN_"// ",1:"") R X:DTIME I X="^"!'$T W:'$T $C(7) S PSGOROE1=1 G DONE
"RTN","PSGOE42",10,0)
 I $S(X="":'PSGPR,1:X="@") W $C(7),"  (Required)" S X="?",PSGF2=1 D ENHLP^PSGOEM(53.1,1) G 1
"RTN","PSGOE42",11,0)
 I X="",PSGPR S X=PSGPRN I PSGPR'=PSGPRN,$D(^VA(200,PSGPR,"PS")) W "    "_$P(^("PS"),"^",2)_"    "_$P(^("PS"),"^",3) S PSGFOK(1)="" G 5
"RTN","PSGOE42",12,0)
 S PSGF2=1 I X?1."?" D ENHLP^PSGOEM(53.1,1)
"RTN","PSGOE42",13,0)
 I $E(X)="^" D FF G:Y>0 @Y G 1
"RTN","PSGOE42",14,0)
 K DIC S DIC="^VA(200,",DIC(0)="EMQZ",DIC("S")="I $$ACTPRO^PSGOE1(+Y)" D ^DIC K DIC I Y'>0 G 1
"RTN","PSGOE42",15,0)
 S PSGPR=+Y,PSGPRN=$P(Y(0,0),"^"),PSGFOK(1)=""
"RTN","PSGOE42",16,0)
 ;
"RTN","PSGOE42",17,0)
5 ; self med
"RTN","PSGOE42",18,0)
 I '$P(PSJSYSW0,"^",24) G DONE
"RTN","PSGOE42",19,0)
A5 W !,"SELF MED: " W:PSGSM]"" $P("NO^YES","^",PSGSM+1),"// " R X:DTIME I X="^"!'$T W:'$T $C(7) S PSGOROE1=1 G DONE
"RTN","PSGOE42",20,0)
 I "01"[X,$L(X)<2 S:PSGSM=""&(X]"") PSGSM=X W:PSGSM]"" "  (",$P("NO^YES","^",PSGSM+1),")" G DONE
"RTN","PSGOE42",21,0)
 I X="@" W:PSGSM="" $C(7),"  ??" G:PSGSM="" A5 D DEL G:%'=1 A5 S (PSGSM,PSGHSM)="" G DONE
"RTN","PSGOE42",22,0)
 S PSGF2=5 I X?1"^".E D FF G:Y>0 @Y G A5
"RTN","PSGOE42",23,0)
 I X?1."?" S PSGF2=5 D ENHLP^PSGOEM(53.1,5) G A5
"RTN","PSGOE42",24,0)
 D YN I  S PSGSM=$E(X)="Y",PSGFOK(5)="" G 6:PSGSM,DONE
"RTN","PSGOE42",25,0)
 W $C(7) D ENHLP^PSGOEM(53.1,5) G A5
"RTN","PSGOE42",26,0)
 ;
"RTN","PSGOE42",27,0)
6 ; hospital supplied self med
"RTN","PSGOE42",28,0)
 W !,"HOSPITAL SUPPLIED SELF MED: " W:PSGHSM]"" $P("NO^YES","^",PSGHSM+1),"// " R X:DTIME I X="^"!'$T W:'$T $C(7) S PSGOROE1=1 G DONE
"RTN","PSGOE42",29,0)
 I "01"[X,$L(X)<2 S:PSGHSM=""&(X]"") PSGHSM=X W:PSGHSM]"" "  (",$P("NO^YES","^",PSGHSM+1),")" G DONE
"RTN","PSGOE42",30,0)
 I X="@" W:PSGHSM="" $C(7),"  ??" G:PSGHSM="" 6 D DEL G:%'=1 6 S PSGHSM="" G DONE
"RTN","PSGOE42",31,0)
 S PSGF2=6 I X?1"^".E D FF G:Y>0 @Y G 6
"RTN","PSGOE42",32,0)
 I X?1."?" D ENHLP^PSGOEM(53.1,6) G 6
"RTN","PSGOE42",33,0)
 D YN I  S PSGHSM=$E(X)="Y" G DONE
"RTN","PSGOE42",34,0)
 W $C(7) S PSGF2=6 D ENHLP^PSGOEM(53.1,6) G 6
"RTN","PSGOE42",35,0)
 Q
"RTN","PSGOE42",36,0)
 ;
"RTN","PSGOE42",37,0)
DONE ;
"RTN","PSGOE42",38,0)
 K F,F0,F1,PSGF2,F3,PSG,SDT Q
"RTN","PSGOE42",39,0)
 ;
"RTN","PSGOE42",40,0)
FF ; up-arrow to another field
"RTN","PSGOE42",41,0)
 D ENFF^PSGOEM I Y>0,Y'=1,Y'=5 S Y=Y_"^PSGOE4"_$S("^109^13^3^7^26^"[("^"_Y_"^"):"",1:1)
"RTN","PSGOE42",42,0)
 Q
"RTN","PSGOE42",43,0)
 ;
"RTN","PSGOE42",44,0)
DEL ; delete entry
"RTN","PSGOE42",45,0)
 W !?3,"SURE YOU WANT TO DELETE" S %=0 D YN^DICN I %'=1 W $C(7),"  <NOTHING DELETED>"
"RTN","PSGOE42",46,0)
 Q
"RTN","PSGOE42",47,0)
 ;
"RTN","PSGOE42",48,0)
YN ; yes/no as a set of codes
"RTN","PSGOE42",49,0)
 I X'?.U F Y=1:1:$L(X) I $E(X,Y)?1L S X=$E(X,1,Y-1)_$C($A(X,Y)-32)_$E(X,Y+1,$L(X))
"RTN","PSGOE42",50,0)
 F Y="NO","YES" I $P(Y,X)="" W $P(Y,X,2) Q
"RTN","PSGOE42",51,0)
 Q
"RTN","PSGOE42",52,0)
 ;
"RTN","PSGOE42",53,0)
2 ; dispense drug multiple
"RTN","PSGOE42",54,0)
 I PSGDRG,'$D(^PS(53.45,PSJSYSP,2)) S ^(2,0)="^53.4502P^1^1",^(1,0)=PSGDRG_"^"_PSGUD
"RTN","PSGOE42",55,0)
 K DA,DR S DIE="^PS(53.45,",DA=PSJSYSP,DR=2,DR(2,53.4502)=$S($G(PSGFOK(13)):.02,1:".01;.02") D ^DIE
"RTN","PSGOE42",56,0)
 I '$O(^PS(53.45,PSJSYSP,2,0)) W $C(7),!!,"WARNING: This order must have at least one dispense drug before pharmacy can",!?9,"verify it!"
"RTN","PSGOE42",57,0)
 I $G(PSGFOK(13)) Q
"RTN","PSGOE42",58,0)
 G @FB
"RTN","PSGOE42",59,0)
 ;
"RTN","PSGOE8")
0^2^B54413557^B53298336
"RTN","PSGOE8",1,0)
PSGOE8 ;BIR/CML3 - EDIT ORDERS IN 53.1 ; 7/6/11 9:44am
"RTN","PSGOE8",2,0)
 ;;5.0;INPATIENT MEDICATIONS ;**47,50,65,72,110,111,188,192,113,223,269,287,315,338,366**;16 DEC 97;Build 7
"RTN","PSGOE8",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PSGOE8",4,0)
 ; Reference to ^PS(50.7 is supported by DBIA# 2180
"RTN","PSGOE8",5,0)
 ; Reference to ^PS(51.1 is supported by DBIA 2177
"RTN","PSGOE8",6,0)
 ; Reference to ^PS(51.2 is supported by DBIA# 2178
"RTN","PSGOE8",7,0)
 ; Reference to ^PSDRUG is supported by DBIA# 2192
"RTN","PSGOE8",8,0)
 ;
"RTN","PSGOE8",9,0)
101 ;Orderable Item
"RTN","PSGOE8",10,0)
 S MSG=0,F2=101,PSGOOPD=PSGPD,PSGOOPDN=PSGPDN S:PSGOEEF(F2) BACK="101^PSGOE8"
"RTN","PSGOE8",11,0)
 S %=1 I $P(PSJSYSU,";",3)>1 W !!,$C(7),"WARNING!  If you change the drug of an order, the Dosage Ordered and Dispense",!,"Drug(s) are deleted." F  W !,"Do you wish to continue" S %=2 D YN^DICN Q:%
"RTN","PSGOE8",12,0)
 I %'=1 G DONE
"RTN","PSGOE8",13,0)
A101 ;
"RTN","PSGOE8",14,0)
 I $$PNDREN($G(PSGORD)) D  Q
"RTN","PSGOE8",15,0)
 . W !!?5,"Orderable Item may not be edited at this point." D PAUSE^VALM1
"RTN","PSGOE8",16,0)
 W !,"ORDERABLE ITEM: ",$S(PSGPD:PSGPDN_"// ",1:"") R X:DTIME I X="^"!'$T W:'$T $C(7) S PSGOEE=0 G DONE
"RTN","PSGOE8",17,0)
 I X="",PSGPD S X=PSGPDN I PSGPD'=PSGPDN,$D(^PS(50.7,PSGPD,0)) G DONE
"RTN","PSGOE8",18,0)
 I $S(X="@":1,X]"":0,1:'PSGPD) W $C(7),"  (Required)" S X="?" D ENHLP^PSGOEM(53.1,101) G A101
"RTN","PSGOE8",19,0)
 I X?1."?" D ENHLP^PSGOEM(53.1,101)
"RTN","PSGOE8",20,0)
 I $E(X)="^" D ENFF^PSGOE82 G:Y>0 @Y G A101
"RTN","PSGOE8",21,0)
 ;BHW;PSJ*5.0*192;Modify ^DIC call to use MIX^DIC and only B/C cross-references
"RTN","PSGOE8",22,0)
 K DIC,D S DIC="^PS(50.7,",DIC(0)="EMQZ",DIC("S")="I $$ENOISC^PSJUTL(Y,""U"")",D="B^C" D MIX^DIC1 K DIC,D I Y'>0 G A101
"RTN","PSGOE8",23,0)
 F  S %=2 D DH,YN^DICN Q:%
"RTN","PSGOE8",24,0)
 I %'=1 G A101
"RTN","PSGOE8",25,0)
 S (PSGPDRG,PSGPD)=+Y,(PSGPDN,PSGPDRGN)=$$OINAME^PSJLMUTL(PSGPDRG)
"RTN","PSGOE8",26,0)
 S PSGNEDFD=$$GTNEDFD^PSGOE7("U",PSGPDRG)
"RTN","PSGOE8",27,0)
 S PSGPDNX=1,PSGDO="",(PSGPDRG,PSGPD)=+Y,(PSGPDN,PSGPDRGN)=$$OINAME^PSJLMUTL(PSGPDRG) K ^PS(53.45,PSJSYSP,2) S X=$O(^PSDRUG("ASP",PSGPD,0)) I X,'$O(^(X)) D
"RTN","PSGOE8",28,0)
 .S ^PS(53.45,PSJSYSP,2,0)="^53.4502P^1^1",^(1,0)=X,^PS(53.45,PSJSYSP,2,"B",X,1)=""
"RTN","PSGOE8",29,0)
 D ENDRG^PSGOEF1(PSGPD,0)
"RTN","PSGOE8",30,0)
 I $S($D(DTOUT):1,$D(DUOUT):1,$D(DIRUT):1,1:0) G DONE
"RTN","PSGOE8",31,0)
 ;G DONE
"RTN","PSGOE8",32,0)
 ;
"RTN","PSGOE8",33,0)
109 ; dosage ordered
"RTN","PSGOE8",34,0)
 S MSG=0,F2=109 S:$G(PSGOEEF(F2)) BACK="109^PSGOE8"
"RTN","PSGOE8",35,0)
A109 ;
"RTN","PSGOE8",36,0)
 I $$PNDREN($G(PSGORD)) D  Q
"RTN","PSGOE8",37,0)
 . W !!?5,"Dosage may not be edited at this point." D PAUSE^VALM1
"RTN","PSGOE8",38,0)
 S PSGOEEF(F2)=PSGOEE
"RTN","PSGOE8",39,0)
 D EDITDOSE^PSJDOSE S X=PSGDO S:X="" PSGDREQ=1 G DONE
"RTN","PSGOE8",40,0)
 W !,"DOSAGE ORDERED: ",$S(PSGDO]"":PSGDO_"// ",1:"") R X:DTIME I X="^"!'$T W:'$T $C(7) S PSGOEE=0 G DONE
"RTN","PSGOE8",41,0)
 I X=""&(PSGDO]"") S X=PSGDO
"RTN","PSGOE8",42,0)
 I $$CHECK(PSJSYSP)&(X="")&(PSGDO']"") W $C(7),"    (Required) " G A109
"RTN","PSGOE8",43,0)
 I $$CHECK(PSJSYSP)&(X="@") W $C(7),"      (Required) " G A109
"RTN","PSGOE8",44,0)
 I '$$CHECK(PSJSYSP)&(X="@") S PSGDO="" G DONE
"RTN","PSGOE8",45,0)
 I X?1."?" D ENHLP^PSGOEM(53.1,109) G A109
"RTN","PSGOE8",46,0)
 I $E(X)="^" D ENFF^PSGOE82 G:Y>0 @Y G A109
"RTN","PSGOE8",47,0)
 I $E(X,$L(X))=" " F  S X=$E(X,1,$L(X)-1) Q:$E(X,$L(X))'=" "
"RTN","PSGOE8",48,0)
 I $S(X?.E1C.E:1,$L(X)>20:1,X="":0,X["^":1,X?1.P:1,1:X=+X) W $C(7),"  ",$S(X?1.P!(X=""):"(Required)",1:"??") D ENHLP^PSGOEM(53.1,109) G A109
"RTN","PSGOE8",49,0)
 S PSGDO=X G DONE
"RTN","PSGOE8",50,0)
 ;
"RTN","PSGOE8",51,0)
3 ; med route
"RTN","PSGOE8",52,0)
 S MSG=0,F2=3 S:PSGOEEF(F2) BACK="3^PSGOE8"
"RTN","PSGOE8",53,0)
A3 I $$PNDREN($G(PSGORD)) D  Q
"RTN","PSGOE8",54,0)
 . W !!?5,"Med Route may not be edited at this point." D PAUSE^VALM1
"RTN","PSGOE8",55,0)
 W !,"MED ROUTE: ",$S(PSGMR:PSGMRN_"// ",1:"") R X:DTIME I X="^"!'$T W:'$T $C(7) S PSGOEE=0 G DONE
"RTN","PSGOE8",56,0)
 I X="",PSGMR S X=PSGMRN I PSGMR'=PSGMRN,$D(^PS(51.2,PSGMR,0)) W "  "_$P(^(0),"^",3) G DONE
"RTN","PSGOE8",57,0)
 I $S(X="@":1,X]"":0,1:'PSGMR) W $C(7),"  (Required)" S X="?" D ENHLP^PSGOEM(53.1,3) G A3
"RTN","PSGOE8",58,0)
 I X="?" D MRSL^PSGOE4 ;*366
"RTN","PSGOE8",59,0)
 I X?1."??" D ENHLP^PSGOEM(53.1,3)
"RTN","PSGOE8",60,0)
 ;I X?1."?" D ENHLP^PSGOEM(53.1,3)
"RTN","PSGOE8",61,0)
 I $E(X)="^" D ENFF^PSGOE82 G:Y>0 @Y G A3
"RTN","PSGOE8",62,0)
 D CKMRSL^PSGOE4 ;*366
"RTN","PSGOE8",63,0)
 K DIC S DIC="^PS(51.2,",DIC(0)="EMQZX",DIC("S")="I $P(^(0),""^"",4)" D ^DIC K DIC I Y'>0 G A3  ;*366
"RTN","PSGOE8",64,0)
 S PSGMR=+Y,PSGMRN=Y(0,0) G DONE
"RTN","PSGOE8",65,0)
 ;
"RTN","PSGOE8",66,0)
26 ; schedule
"RTN","PSGOE8",67,0)
 S MSG=0,F2=26 S:PSGOEEF(F2) BACK="26^PSGOE8"
"RTN","PSGOE8",68,0)
A26 I $$PNDREN($G(PSGORD)) D  Q
"RTN","PSGOE8",69,0)
 . W !!?5,"Schedule may not be edited at this point." D PAUSE^VALM1
"RTN","PSGOE8",70,0)
 W !,"SCHEDULE: ",$S(PSGSCH]"":PSGSCH_"// ",1:"") R X:DTIME I X="^"!'$T W:'$T $C(7) S PSGOEE=0 G DONE
"RTN","PSGOE8",71,0)
 S:X="" X=PSGSCH,PSGSCH="" I "@"[X W $C(7),"  (Required)" S X="?" D ENHLP^PSGOEM(53.1,26) G A26
"RTN","PSGOE8",72,0)
 S DOW=0 I $$DOW^PSIVUTL($$ENLU^PSGMI(X)) S DOW=1
"RTN","PSGOE8",73,0)
 I X?1."?" D ENHLP^PSGOEM(53.1,26) G A26
"RTN","PSGOE8",74,0)
 I $E(X)="^" D ENFF^PSGOE82 G:Y>0 @Y G A26
"RTN","PSGOE8",75,0)
 ;BHW;PSJ*5*188;Add flag and IEN return variable for PSGS0 (PSJ*5*134), Highlight Admin Times if they changed.
"RTN","PSGOE8",76,0)
 N PSGOES,PSJSLUP,PSGSFLG S PSJSLUP=1,PSGSFLG=1 D EN^PSGS0 I '$D(X) W $C(7),"  ??" S X="?" D ENHLP^PSGOEM(53.1,26) G A26
"RTN","PSGOE8",77,0)
 I X'=PSGSCH D
"RTN","PSGOE8",78,0)
 . K PSGDUR,PSGRMVT,PSGRMV,ND2P1 ;*315 Removal times are tied to ADMIN times.
"RTN","PSGOE8",79,0)
 . N XX
"RTN","PSGOE8",80,0)
 . S PSGSCH=X
"RTN","PSGOE8",81,0)
 . I PSGS0Y'=PSGAT S PSGAT=PSGS0Y  ;Change so that any schedule change will adjust the type and default the admin times - DRF
"RTN","PSGOE8",82,0)
 . D  ;Change schedule type to agree with schedule
"RTN","PSGOE8",83,0)
 .. I $G(DOW) S PSGST="C",PSGSTN=$$ENSTN^PSGMI(PSGST) Q
"RTN","PSGOE8",84,0)
 .. I (PSGSCH[" PRN")!(PSGSCH="PRN") I $$PRNOK^PSGS0(PSGSCH) S PSGOST=PSGST,PSGST="P",PSGSTN=$$ENSTN^PSGMI(PSGST) Q
"RTN","PSGOE8",85,0)
 .. I '$G(PSGSCIEN),PSGSCH]"" S XX=+$O(^PS(51.1,"AC","PSJ",PSGSCH,0)),PSGSCIEN=XX
"RTN","PSGOE8",86,0)
 .. S PSGOST=$G(PSGST),PSGST=$P($G(^PS(51.1,PSGSCIEN,0)),"^",5) I PSGST="D" S PSGST="C"  ;DOW schedules are converted to Continuous
"RTN","PSGOE8",87,0)
 .. S PSGSTN=$$ENSTN^PSGMI(PSGST)
"RTN","PSGOE8",88,0)
 . I $G(PSJSYSW0),($P(PSJSYSW0,U,5)'=2),'$G(PSGEFN(8)) W !!,"NOTE: This may cause the Admin Times and the Start Time to be out of sync."
"RTN","PSGOE8",89,0)
 . W !!,"NOTE: This change in schedule also changes the ADMIN TIMES and SCHEDULE TYPE.",!
"RTN","PSGOE8",90,0)
 . S MSG=1 S:'$G(PSGOEEF(39)) PSGOEEF(39)=1 ;*287 - Prevent infinite loop editing admin times
"RTN","PSGOE8",91,0)
 . I ($G(PSGRF)>1),PSGST="C" D
"RTN","PSGOE8",92,0)
 ..S PSGF2=39,BACK="39^PSGOE81" D 39^PSGOE81 S BACK="26^PSGOE8",PSGF2=26,PSGOAT=PSGAT ;*315 Prompt for Admin to get DOA
"RTN","PSGOE8",93,0)
 ..Q
"RTN","PSGOE8",94,0)
 . I $G(PSJNEWOE) D PAUSE^VALM1
"RTN","PSGOE8",95,0)
 I PSGST="O" S PSGOEEF(7)=1 I +$G(PSGRF) S PSGOEEF(25)=1 D 25^PSGOE81 S PSGF2=26
"RTN","PSGOE8",96,0)
 G DONE
"RTN","PSGOE8",97,0)
 ;
"RTN","PSGOE8",98,0)
7 ; schedule type
"RTN","PSGOE8",99,0)
 S MSG=0,F2=7 S:PSGOEEF(F2) BACK="7^PSGOE8"
"RTN","PSGOE8",100,0)
A7 W !,"SCHEDULE TYPE: "_$S(PSGSTN]"":PSGSTN_"// ",1:"") R X:DTIME S X=$TR(X,"coprocf","COPROCF") I X="^"!'$T S PSGOEE=0 W $C(7) G DONE
"RTN","PSGOE8",101,0)
 I X="" S X=PSGST,PSGSTN=$$ENSTN^PSGMI(X) W:PSGSTN]"" "  ",PSGSTN G DONE
"RTN","PSGOE8",102,0)
 S:X="F" X="R"
"RTN","PSGOE8",103,0)
 I ",?,??,C,O,OC,P,R,"'[(","_X_",") W " ??" G A7
"RTN","PSGOE8",104,0)
 I $$PRNOK^PSGS0($G(PSGSCH)),X="C" W "  ??" G A7
"RTN","PSGOE8",105,0)
 I X="@"!(X?1."?") W:X="@" $C(7),"  (Required)" S:X="@" X="?" D ENHLP^PSGOEM(53.1,7) G A7
"RTN","PSGOE8",106,0)
 I $E(X)="^" D ENFF^PSGOE82 G:Y>0 @Y G A7
"RTN","PSGOE8",107,0)
 ;*223 Don't allow O sched type on C orders
"RTN","PSGOE8",108,0)
 I X="O",$$SCHTP(PSGSCH)'="O" W !,"  SCHEDULE ("_PSGSCH_") is not a ONE TIME Schedule." G A7
"RTN","PSGOE8",109,0)
 ;*269 Don't allow C sched type on O orders
"RTN","PSGOE8",110,0)
 I X="C",$$SCHTP(PSGSCH)="O" W !,"  SCHEDULE ("_PSGSCH_") is not a CONTINUOUS Schedule." G A7
"RTN","PSGOE8",111,0)
 S PSGOST=PSGST
"RTN","PSGOE8",112,0)
 S PSGST=X,PSGSTN=$$ENSTN^PSGMI(X) W:PSGSTN]"" "  ",PSGSTN
"RTN","PSGOE8",113,0)
 I X="P",$G(PSGAT)]"" S PSGOAT=PSGAT S PSGAT="" D
"RTN","PSGOE8",114,0)
 .W !!,"NOTE: This change in schedule type also changes the ADMIN TIMES.",!
"RTN","PSGOE8",115,0)
 .S MSG=1,PSGOEEF(39)=1
"RTN","PSGOE8",116,0)
 .I $G(PSJNEWOE) D PAUSE^VALM1
"RTN","PSGOE8",117,0)
 ;
"RTN","PSGOE8",118,0)
DONE ;
"RTN","PSGOE8",119,0)
 I PSGOEE G:'PSGOEEF(F2) @BACK S PSGOEE=PSGOEEF(F2)
"RTN","PSGOE8",120,0)
 K F,F0,F2 Q
"RTN","PSGOE8",121,0)
 ;
"RTN","PSGOE8",122,0)
DEL ; delete entry
"RTN","PSGOE8",123,0)
 W !?3,"SURE YOU WANT TO DELETE" S %=0 D YN^DICN I %'=1 W $C(7),"  <NOTHING DELETED>"
"RTN","PSGOE8",124,0)
 Q
"RTN","PSGOE8",125,0)
 ;
"RTN","PSGOE8",126,0)
DH ;
"RTN","PSGOE8",127,0)
 W !!?2,"When the drug of an order is changed, the Dosage Ordered and Dispense Drug(s)",!,"for the order are no longer valid, and therefore deleted from the order.",!,"If possible, a new corresponding dispense drug will be added to the order."
"RTN","PSGOE8",128,0)
 W !!?2,"Answer 'YES' to continue with this change.  Answer 'NO' to select another",!,"drug or to accept the drug as it was.  Enter an '^' to exit this edit." Q
"RTN","PSGOE8",129,0)
 ;
"RTN","PSGOE8",130,0)
CHECK(PSJSYSP) ; Check to see if multiple dispense drugs
"RTN","PSGOE8",131,0)
 ; Input  -     PSJSYSP
"RTN","PSGOE8",132,0)
 ; Returns  0 = only one.
"RTN","PSGOE8",133,0)
 ;          1 = more than one
"RTN","PSGOE8",134,0)
 ; Checks Inactive Date and doesn't count if < or = today.
"RTN","PSGOE8",135,0)
 N PSJRSB,PSJINACT,PSJRBCNT S PSJRBCNT=0
"RTN","PSGOE8",136,0)
 F PSJRSB=0:0 S PSJRSB=$O(^PS(53.45,PSJSYSP,2,PSJRSB)) Q:'PSJRSB  D
"RTN","PSGOE8",137,0)
 .S PSJINACT=$P(^PS(53.45,PSJSYSP,2,PSJRSB,0),"^",3)
"RTN","PSGOE8",138,0)
 .I (PSJINACT="")!((PSJINACT>0)&(PSJINACT>DT)) D
"RTN","PSGOE8",139,0)
 ..S PSJRBCNT=$S('$D(PSJRBCNT):1,1:PSJRBCNT+1)
"RTN","PSGOE8",140,0)
 Q $S(PSJRBCNT>1:1,1:0)
"RTN","PSGOE8",141,0)
 ;
"RTN","PSGOE8",142,0)
PNDREN(PNDON) ;
"RTN","PSGOE8",143,0)
 I PNDON'["P" Q 0
"RTN","PSGOE8",144,0)
 S RNWL="^PS(53.1,"_+PNDON_",0)" S RNWL=$G(@(RNWL)) S RNWL=$S($P(RNWL,"^",24)="R":1,1:0)
"RTN","PSGOE8",145,0)
 Q RNWL
"RTN","PSGOE8",146,0)
 ;
"RTN","PSGOE8",147,0)
SCHTP(SCH) ; *223 Return SCHedule type
"RTN","PSGOE8",148,0)
 N X I SCH="" Q ""
"RTN","PSGOE8",149,0)
 S X=$O(^PS(51.1,"APPSJ",SCH,0))
"RTN","PSGOE8",150,0)
 Q:'$G(X) ""
"RTN","PSGOE8",151,0)
 Q $P(^PS(51.1,X,0),"^",5)
"RTN","PSGOE8",152,0)
 ;
"RTN","PSGOE81")
0^26^B117103092^B115959656
"RTN","PSGOE81",1,0)
PSGOE81 ;BIR/CML3 - NON-VERIFIED ORDER EDIT (CONT.) ;Jul 02, 2018@09:10
"RTN","PSGOE81",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**26,50,64,58,82,110,111,136,113,267,315,334,373,366**;16 DEC 97;Build 7
"RTN","PSGOE81",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PSGOE81",4,0)
 ; Reference to ^PS(50.7 is supported by DBIA# 2180
"RTN","PSGOE81",5,0)
 ; Reference to ^PS(51.1 is supported by DBIA 2177.
"RTN","PSGOE81",6,0)
 ;
"RTN","PSGOE81",7,0)
39 ; admin times
"RTN","PSGOE81",8,0)
 N PSGDOA
"RTN","PSGOE81",9,0)
 S MSG=0,PSGF2=39 S:PSGOEEF(PSGF2) BACK="39^PSGOE81",ORIG=$G(PSGAT),PSGDOA=$G(PSGDUR)
"RTN","PSGOE81",10,0)
A39 ;*315 next 2 lines
"RTN","PSGOE81",11,0)
 I (PSGST="P")!$$PRNOK^PSGS0($G(PSGSCH)) G DONE
"RTN","PSGOE81",12,0)
 I $$ODD^PSGS0(PSGS0XT) D PSGDUR G DONE
"RTN","PSGOE81",13,0)
 W !,"ADMIN TIMES: "_$S(PSGAT:PSGAT_"// ",1:"") R X:DTIME I X="^"!('$T) W:'$T $C(7) S PSGOEE=0 S:X="^" (X,PSGAT)=$G(ORIG),PSGDUR="" G DONE ;*315
"RTN","PSGOE81",14,0)
 I X="" S:(($G(PSGS0XT)="D")&'$G(PSGS0Y)) PSGOEE=0 S:$G(PSGAT) X=PSGAT,PSGNOHI=1 ;*315 If admin time default was taken then don't highlight admin time.
"RTN","PSGOE81",15,0)
 I $E(X)="^" D ENFF^PSGOE82 G:Y>0 @Y G A39
"RTN","PSGOE81",16,0)
 I X=" "!(X?1."?") D ENHLP^PSGOEM(53.1,39) G A39
"RTN","PSGOE81",17,0)
 I PSGS0XT="D"&'$G(X) I ((",P,R,")'[(","_$G(PSGST)_",")) D  G A39
"RTN","PSGOE81",18,0)
 .W $C(7),"  ??" S X="?" W !,"This is a 'DAY OF THE WEEK' schedule and MUST have admin times." D ENHLP^PSGOEM(53.1,39)
"RTN","PSGOE81",19,0)
 I X="@" D DEL G:%'=1 A39 S PSGAT="",X=""
"RTN","PSGOE81",20,0)
 I $G(PSGS0XT),'$$ODD^PSGS0(PSGS0XT),$G(PSGS0XT)'="P",$G(PSGS0XT)'="OC",'$$PRNOK^PSGS0(PSGSCH),($G(PSGST)'="O") D TIMES G:'$D(X) A39 D PSGDUR G:'$D(X) A39 G:$G(X)="^" DONE ;*315
"RTN","PSGOE81",21,0)
 I (($G(PSGST)="O")!($G(PSGST)="OC")),X="" D  G DONE
"RTN","PSGOE81",22,0)
 . S (PSGS0Y,PSGAT)=X
"RTN","PSGOE81",23,0)
 . I (($G(PSGRF))&($G(PSGST)="O")) N PSGRO S (PSGRO,PSGOEEF(25))=1,PSGOEEF(39)=1 D 25
"RTN","PSGOE81",24,0)
 .Q
"RTN","PSGOE81",25,0)
 D ENCHK^PSGS0 I '$D(X) W $C(7) G A39
"RTN","PSGOE81",26,0)
 S PSGOAT=PSGAT
"RTN","PSGOE81",27,0)
 S (PSGS0Y,PSGAT)=X G DONE
"RTN","PSGOE81",28,0)
 ;
"RTN","PSGOE81",29,0)
8 ; special instructions
"RTN","PSGOE81",30,0)
 S MSG=0,PSGF2=8 S:PSGOEEF(PSGF2) BACK="8^PSGOE81"
"RTN","PSGOE81",31,0)
A8 ; special instructions
"RTN","PSGOE81",32,0)
 S PSGSI=$$EDITSI^PSJBCMA5($G(PSGP),$G(PSGORD)) I $G(PSGP),$G(PSGORD) I '$$DIFFSI^PSJBCMA5(PSGP,PSGORD) S PSGOEE=0 G DONE
"RTN","PSGOE81",33,0)
 S PSGSI=$S((PSGSI>0&(PSGSI<4)):$G(^PS(53.45,+PSJSYSP,5,1,0))_" "_$G(^PS(53.45,+PSJSYSP,5,2,0)),PSGSI>3:"Instructions too long. See Order View or BCMA for full text",1:"")
"RTN","PSGOE81",34,0)
 S:PSGSI=" " PSGSI="" I PSGSI]"" S PSGSI=$$ENBCMA^PSJUTL("U") G DONE
"RTN","PSGOE81",35,0)
 Q
"RTN","PSGOE81",36,0)
 ;
"RTN","PSGOE81",37,0)
10 ; start date/time edit
"RTN","PSGOE81",38,0)
 S MSG=0,PSGF2=10 S:PSGOEEF(PSGF2) BACK="10^PSGOE81"
"RTN","PSGOE81",39,0)
A10 ; start date/time edit
"RTN","PSGOE81",40,0)
 S PSGSDEDT=1 ; This variable indicates a Manual Edit of the Start/Date Time.
"RTN","PSGOE81",41,0)
 K PSGSDX N DUR,DURMIN,TMPFD
"RTN","PSGOE81",42,0)
 I $G(PSGORD)["P",$G(PSGP) I $$LASTREN^PSJLMPRI(PSGP,PSGORD) D  Q
"RTN","PSGOE81",43,0)
 . W !?5,"Start Date may not be edited at this point. " D PAUSE^VALM1
"RTN","PSGOE81",44,0)
 W !,"START DATE/TIME: "_$S($P(PSGSDN,"^")]"":$P(PSGSDN,"^")_"// ",1:"") R X:DTIME I X="^"!'$T W:'$T $C(7) S PSGOEE=0 G DONE
"RTN","PSGOE81",45,0)
 I X="",PSGSD W "  "_$P(PSGSDN,"^") G DONE
"RTN","PSGOE81",46,0)
 I X="P" D ENPREV^PSGDL W:'$D(X) $C(7) G:'$D(X) A10 S PSGSD=+X,PSGSDN=$$ENDD^PSGMI(PSGSD)_"^"_$$ENDTC^PSGMI(PSGSD) W "  ",$P(PSGSDN,"^") G DONE
"RTN","PSGOE81",47,0)
 I X="@"!(X?1."?") W:X="@" $C(7),"  (Required)" S:X="@" X="?" D ENHLP^PSGOEM(53.1,10)
"RTN","PSGOE81",48,0)
 I $E(X)="^" D ENFF^PSGOE82 G:Y>0 @Y G A10
"RTN","PSGOE81",49,0)
 NEW TMPX S TMPX=X,X1=+$G(PSGLI),X2=-7 D C^%DTC K %DT S %DT="ERTX",%DT(0)=X,X=TMPX D ^%DT K %DT I Y'>0 D ENHLP^PSGOEM(53.1,10) G A10
"RTN","PSGOE81",50,0)
 I PSGFD<Y W $C(7),!?5,"*** THE START DATE CANNOT BE AFTER THE STOP DATE! ***",! S MSG=1 G A10
"RTN","PSGOE81",51,0)
 ; RBD PSJ*5*373 Soft stop when Start Date more than 7 days after Order's LOGIN DATE
"RTN","PSGOE81",52,0)
 S X1=+$G(PSGLI),X2=+7 D C^%DTC
"RTN","PSGOE81",53,0)
 I +Y>X W !!,$C(7),"Start date/time should not be entered for more than 7 days after the",!,"order's LOGIN DATE.",! K DIR D WAIT^VALM1
"RTN","PSGOE81",54,0)
 ;S (PSGSDX,PSGSD,PSGNESD)=+Y,PSGSDN=$$ENDD^PSGMI(PSGSD)_"^"_$$ENDTC^PSGMI(PSGSD)  ;373
"RTN","PSGOE81",55,0)
 S (PSGSDX,PSGSD,PSGNESD)=+Y,PSGSDN=$$ENDD^PSGMI(PSGSD)_"^"_$$ENDTC2^PSGMI(PSGSD)  ;373
"RTN","PSGOE81",56,0)
 I $G(PSGORD)["P",$G(PSGP) S DUR=$$GETDUR^PSJLIVMD(PSGP,+PSGORD,"P",1) I DUR]"" S DURMIN=$$DURMIN^PSJLIVMD(DUR) I DURMIN D
"RTN","PSGOE81",57,0)
 . ;S TMPFD=$$FMADD^XLFDT(PSGSD,,,DURMIN) K:(TMPFD<PSGSD) TMPFD I $G(TMPFD) S PSGFD=TMPFD,PSGFDN=$$ENDD^PSGMI(PSGFD)_"^"_$$ENDTC^PSGMI(PSGFD)  ;373
"RTN","PSGOE81",58,0)
 . S TMPFD=$$FMADD^XLFDT(PSGSD,,,DURMIN) K:(TMPFD<PSGSD) TMPFD I $G(TMPFD) S PSGFD=TMPFD,PSGFDN=$$ENDD^PSGMI(PSGFD)_"^"_$$ENDTC2^PSGMI(PSGFD)  ;373
"RTN","PSGOE81",59,0)
 G DONE
"RTN","PSGOE81",60,0)
 ;
"RTN","PSGOE81",61,0)
25 ; stop date
"RTN","PSGOE81",62,0)
 S MSG=0,PSGF2=25 S:PSGOEEF(PSGF2) BACK="25^PSGOE81"
"RTN","PSGOE81",63,0)
A25 ;
"RTN","PSGOE81",64,0)
 N MSG,PSGTMPST S PSGTMPST=$G(PSGST) S:'+$G(PSGRF) PSGRF=$P($G(^PS(50.7,$G(PSGPDRG),4),0),U,1) ;*315 One time orders for MRR's require message to instruct pharmacists
"RTN","PSGOE81",65,0)
 I +$G(PSGRF),$D(^PS(51.1,"AC","PSJ",$G(PSGSCH))) D
"RTN","PSGOE81",66,0)
 . S:PSGTMPST=($G(PSGST)="R") PSGST=$P($G(^PS(51.1,$O(^PS(51.1,"AC","PSJ",$G(PSGSCH),"")),0)),"^",5) ;Handle "Fill on Request"
"RTN","PSGOE81",67,0)
 .Q
"RTN","PSGOE81",68,0)
 I $G(PSGTMPST)="O",+$G(PSGRF) S (PSGFDN,PSGFD)="" D
"RTN","PSGOE81",69,0)
 . I +$G(PSGRF)=1 S MSG(1)="This NOW order has an Orderable Item for which a removal is required" D
"RTN","PSGOE81",70,0)
 .. S MSG(2)=" at the next administration."
"RTN","PSGOE81",71,0)
 .. S MSG(3)="The Stop DATE/TIME entered should be the next anticipated administration for the medication.",MSG(3,"F")="!"
"RTN","PSGOE81",72,0)
 ..Q
"RTN","PSGOE81",73,0)
 . I +$G(PSGRF)=2 S MSG(1)="This NOW order has an Orderable Item for which a removal period is optional",MSG(1,"F")="!!" D
"RTN","PSGOE81",74,0)
 .. S MSG(2)="prior to the next administration.",MSG(2,"F")="!"
"RTN","PSGOE81",75,0)
 .. S MSG(3)="If Early Removal is needed, enter Removal Time in Stop DATE/TIME field.",MSG(3,"F")="!"
"RTN","PSGOE81",76,0)
 .. S MSG(4)="If an Early Removal is not required, the Stop DATE/TIME entered"
"RTN","PSGOE81",77,0)
 .. S MSG(5)="should be the next anticipated administration for the medication.",MSG(5,"F")="!"
"RTN","PSGOE81",78,0)
 ..Q
"RTN","PSGOE81",79,0)
 . I +$G(PSGRF)=3 S MSG(1)="This NOW order has an Orderable Item that requires a removal period prior",MSG(1,"F")="!!" D
"RTN","PSGOE81",80,0)
 .. S MSG(2)=" to the next administration.",MSG(2,"F")="!"
"RTN","PSGOE81",81,0)
 .. S MSG(3)="Please Enter the Stop DATE/TIME to reflect the Removal Time for this medication.",MSG(3,"F")="!"
"RTN","PSGOE81",82,0)
 ..Q
"RTN","PSGOE81",83,0)
 . D EN^DDIOL(.MSG)
"RTN","PSGOE81",84,0)
 .Q
"RTN","PSGOE81",85,0)
 K PSGFDX
"RTN","PSGOE81",86,0)
 W !,"STOP DATE/TIME: "_$S($P(PSGFDN,"^")]"":$P(PSGFDN,"^")_"// ",1:"") R X:DTIME I X="^"!'$T W:'$T $C(7) S PSGOEE=0 G DONE
"RTN","PSGOE81",87,0)
 I X="",PSGFD S X=$P(PSGFDN,"^")
"RTN","PSGOE81",88,0)
 I $E(X)="^" D ENFF^PSGOE82 G:Y>0 @Y G A25
"RTN","PSGOE81",89,0)
 I X="@"!(X?1."?") W:X="@" $C(7),"  (Required)" S:X="@" X="?" D ENHLP^PSGOEM(53.1,25)
"RTN","PSGOE81",90,0)
 I X=+X,(X>0),(X'>2000000) G A25:'$$ENDL^PSGDL(PSGSCH,X) K PSGDLS S PSGDL=X W " ...dose limit..." D ENE^PSGDL
"RTN","PSGOE81",91,0)
 K %DT S %DT="ERTX",%DT(0)=PSGSD D ^%DT K %DT I Y'>0 W $C(7),!!?13,"*** WARNING! INVALID STOP DATE OR PRIOR TO START DATE! ***",! G A25
"RTN","PSGOE81",92,0)
 ; RBD PSJ*5*373 Hard stop when Stop Date more than 367 days after Start Date
"RTN","PSGOE81",93,0)
 S X1=+Y,X2=PSGSD D ^%DTC
"RTN","PSGOE81",94,0)
 I X>367 W $C(7),!!?13,"*** STOP DATE cannot be more than 367 days from START DATE ***",! G A25
"RTN","PSGOE81",95,0)
 ;S (PSGFDX,PSGFD,PSGNEFD)=+Y,PSGFDN=$$ENDD^PSGMI(PSGFD)_"^"_$$ENDTC^PSGMI(PSGFD)  ;373
"RTN","PSGOE81",96,0)
 S (PSGFDX,PSGFD,PSGNEFD)=+Y,PSGFDN=$$ENDD^PSGMI(PSGFD)_"^"_$$ENDTC2^PSGMI(PSGFD)  ;373
"RTN","PSGOE81",97,0)
W25 ;
"RTN","PSGOE81",98,0)
 N Z,MSG
"RTN","PSGOE81",99,0)
 D DOSE I $G(Z)]"",Z>PSGNEFD D  G A25
"RTN","PSGOE81",100,0)
 . S MSG(1)="There is no administration time that falls between the Start Date/Time"
"RTN","PSGOE81",101,0)
 . S MSG(2)="and the Stop Date/Time."
"RTN","PSGOE81",102,0)
 . D EN^DDIOL(.MSG)
"RTN","PSGOE81",103,0)
 I PSGFD<PSGDT W $C(7),!!?13,"*** WARNING! THE STOP DATE ENTERED IS IN THE PAST! ***",! S MSG=1
"RTN","PSGOE81",104,0)
 Q:+$G(PSGRO)
"RTN","PSGOE81",105,0)
 ;
"RTN","PSGOE81",106,0)
DONE ;
"RTN","PSGOE81",107,0)
 ;Display Expected First Dose;BHW;PSJ*5*136
"RTN","PSGOE81",108,0)
 D EFDNV^PSJUTL
"RTN","PSGOE81",109,0)
 I PSGOEE G:'PSGOEEF(PSGF2) @BACK S PSGOEE=PSGOEEF(PSGF2)
"RTN","PSGOE81",110,0)
 D:+$G(PSGDUR) VERTIMES ;*315
"RTN","PSGOE81",111,0)
 K ORIG
"RTN","PSGOE81",112,0)
 S:'+$G(PSGRF) PSGRF=$P($G(^PS(50.7,$G(PSGPDRG),4),0),U,1)
"RTN","PSGOE81",113,0)
 Q
"RTN","PSGOE81",114,0)
 ;
"RTN","PSGOE81",115,0)
FF ; up-arrow to another field
"RTN","PSGOE81",116,0)
 D ENFF^PSGOEM I Y>0,Y'=39,Y'=8,Y'=10,Y'=25 S Y=Y_"^PSGOE8"_$S("^109^13^3^7^26^"[("^"_Y_"^"):"",1:2) S:Y=2 FB=PSGF2_"^PSGOE81"
"RTN","PSGOE81",117,0)
 Q
"RTN","PSGOE81",118,0)
 ;
"RTN","PSGOE81",119,0)
DEL ; delete entry
"RTN","PSGOE81",120,0)
 W !?3,"SURE YOU WANT TO DELETE" S %=0 D YN^DICN I %'=1 W $C(7),"  <NOTHING DELETED>"
"RTN","PSGOE81",121,0)
 Q
"RTN","PSGOE81",122,0)
 ;
"RTN","PSGOE81",123,0)
TIMES ;At least one admin time, not more than interval allows.
"RTN","PSGOE81",124,0)
 I ($G(PSGS0XT)'="O"),($G(PSGST)'="OC"),'$$PRNOK^PSGS0(PSGSCH) I X="" D EN^DDIOL("This order requires at least one administration time.") K X Q  ;No times
"RTN","PSGOE81",125,0)
 N H,I,MAX
"RTN","PSGOE81",126,0)
 I PSGSCH]"" I $D(^PS(51.1,"AC","PSJ",PSGSCH)) S H=+$O(^PS(51.1,"AC","PSJ",PSGSCH,0)) S I=$P($G(^PS(51.1,H,0)),"^",3)
"RTN","PSGOE81",127,0)
 I $G(PSGST)="O",$L(X,"-")>1 D EN^DDIOL("This is a One Time Order. Only one administration time is permitted.") K X Q
"RTN","PSGOE81",128,0)
 I $G(PSGST)="O" Q  ;Done validating One Time
"RTN","PSGOE81",129,0)
 I +$G(I)=0 Q  ;No frequency - can not check frequency related items
"RTN","PSGOE81",130,0)
 S MAX=1440/I
"RTN","PSGOE81",131,0)
 I MAX<1,$L(X,"-")>1 D EN^DDIOL("This order requires one administration time.") K X Q
"RTN","PSGOE81",132,0)
 I MAX'<1,$L(X,"-")>MAX D EN^DDIOL("The number of admin times entered is greater than indicated by the schedule.") K X Q  ;Too many times
"RTN","PSGOE81",133,0)
 I MAX'<1,$L(X,"-")<MAX D EN^DDIOL("The number of admin times entered is fewer than indicated by the schedule.")  ;Too few times
"RTN","PSGOE81",134,0)
 Q
"RTN","PSGOE81",135,0)
 ;
"RTN","PSGOE81",136,0)
DOSE ;Make certain at least one dose is given.
"RTN","PSGOE81",137,0)
 N INFO,X
"RTN","PSGOE81",138,0)
 S Z="",INFO=$S($G(PSGNESD):PSGNESD,1:$G(PSGSD))_U_($G(PSGNEFD))_U_($G(PSGSCH))_U_($G(PSGST))_U_($G(PSGDRG))_U_($G(PSGS0Y))
"RTN","PSGOE81",139,0)
 Q:$G(PSGST)="OC"!($G(PSGST)="P")
"RTN","PSGOE81",140,0)
 I '$L($G(PSGP)) N PSGP S PSGP=""
"RTN","PSGOE81",141,0)
 S Z=$$ENQ^PSJORP2(PSGP,INFO)  ;Expected first dose.
"RTN","PSGOE81",142,0)
 Q
"RTN","PSGOE81",143,0)
 ;
"RTN","PSGOE81",144,0)
 ;*315 new tags
"RTN","PSGOE81",145,0)
PSGDUR ; Prompt for Removal times if admin times are on 24hr rotations and Site Params are enabled.
"RTN","PSGOE81",146,0)
 ; check parameter files for removal criteria quit if removal rotation not enabled (<2)
"RTN","PSGOE81",147,0)
 ; if enabled determine type (hard vers soft stop)
"RTN","PSGOE81",148,0)
 ;0 = no removal (current cap/tab functionality)
"RTN","PSGOE81",149,0)
 ;1 = removal at next admin (current patch functionality)
"RTN","PSGOE81",150,0)
 ;2 = removal prior to next admin; soft stop (pharmacist optional prompt to designate duration of administration
"RTN","PSGOE81",151,0)
 ;3 = removal prior to next admin; hard stop (pharmacist required prompt to designate duration of administration)
"RTN","PSGOE81",152,0)
 ; prompt for removal if = 2 then allow skip, if = 3 then force entry
"RTN","PSGOE81",153,0)
 ;
"RTN","PSGOE81",154,0)
 S PSGRF=$P($G(^PS(50.7,$G(PSGPDRG),4),0),U,1) Q:((PSGRF<2)!($G(PSGST)="O")!($G(PSGST)="P")!($G(PSGST)="OC"))  ; no removal flag or no removal rotation
"RTN","PSGOE81",155,0)
 Q:$G(PSGS0XT)>1440  ; Duration of Administration valid only for 24 hours - subject to change in future.
"RTN","PSGOE81",156,0)
 N RP,PSGIDF,WMSG,PSGDERR S (PSGIDF,PSGDERR)=0 S:$G(PSGDUR)>0 RP=(PSGDUR/60) S:"BID,TID,QID"[$G(PSGSCH) PSGIDF=1  ; Use separate validation for Times per day type orders
"RTN","PSGOE81",157,0)
 S PSGF2=39
"RTN","PSGOE81",158,0)
 W !,"DURATION OF ADMINISTRATION (HRS): "_$S($G(RP):RP_"// ",1:"") R RP:DTIME I RP="^"!'$T W:'$T $C(7) S PSGDUR=$G(PSGDOA),X="^",PSGOEE=0 Q
"RTN","PSGOE81",159,0)
 I RP="" S:$G(PSGDUR)>0 RP=($G(PSGDUR)/60)
"RTN","PSGOE81",160,0)
 I RP="",$G(PSGS0XT)="D",$L(PSGSCH,"@")=2,$P(PSGSCH,"@",2) S (PSGAT,PSGRMVT)=$P(PSGSCH,"@",2) G 8
"RTN","PSGOE81",161,0)
 I RP="@",PSGRF'=3 D DEL G:%'=1 PSGDUR S (PSGS0Y,PSGDUR,PSGRMVT)="",PSGRMV=-1 S:+$G(^PS(53.1,+$G(PSGORD),2.1)) (PSGDUR,PSGRMV,PSGRMVT)="@" Q
"RTN","PSGOE81",162,0)
 I (RP'=""),(RP'="@"),($E(RP)'="^"),($E(RP)'="?") S:(RP'?1N.2N)!(+(RP)<1) RP="?"
"RTN","PSGOE81",163,0)
 I RP?1."?" D DURHLP^PSGOEM(RP,PSGRF) G PSGDUR
"RTN","PSGOE81",164,0)
 I $E(RP)="^" D FF G:Y>0 @Y G PSGDUR
"RTN","PSGOE81",165,0)
 I (+RP>0),'PSGIDF D  ; exclude BID,TID or QID schedules
"RTN","PSGOE81",166,0)
 . S PSGDUR=(RP*60),PSGRMV=$G(PSGS0XT)-PSGDUR
"RTN","PSGOE81",167,0)
 . I PSGRMV<1 W !,"DURATION OF ADMINISTRATION MATCHES OR EXCEEDS ORDER FREQUENCY" S RP="",PSGDERR=1 K PSGDUR,PSGRMV G PSGDUR
"RTN","PSGOE81",168,0)
 .Q
"RTN","PSGOE81",169,0)
 Q:$G(PSGDERR)=1
"RTN","PSGOE81",170,0)
 I PSGRF=3,(+RP<1) W $C(7),!,"ENTRY IS REQUIRED" S RP="" G PSGDUR
"RTN","PSGOE81",171,0)
 I PSGRF=2,(+RP<1) D
"RTN","PSGOE81",172,0)
 . W !,"You have not entered Duration of Administration for this medication order, "
"RTN","PSGOE81",173,0)
 . W !,"therefore the BCMA user will not be prompted to remove the medication prior "
"RTN","PSGOE81",174,0)
 . W !,"to the next Admin Time."
"RTN","PSGOE81",175,0)
 . S PSGRMV=-1,RP=0
"RTN","PSGOE81",176,0)
 .Q
"RTN","PSGOE81",177,0)
 I PSGIDF,(+RP>0) D  ;Only for TPD schedules
"RTN","PSGOE81",178,0)
 . N F,P,PSGARR
"RTN","PSGOE81",179,0)
 . S PSGADT=$S($G(PSGDUR)=-1:X,$G(PSGAT):PSGAT,$G(PSGS0Y):PSGS0Y,1:""),PSGS0Y=PSGADT
"RTN","PSGOE81",180,0)
 . S PSGARR=$L($G(PSGADT),"-")
"RTN","PSGOE81",181,0)
 . F P=1:1:PSGARR D
"RTN","PSGOE81",182,0)
 .. S PSGARR(P)=($P(PSGADT,"-",P)/100) S:(P>1) F(P)=PSGARR(P)-PSGARR(P-1)
"RTN","PSGOE81",183,0)
 .. I $G(F(P)),($G(F(P))'=RP) S WMSG=1_U_"Duration of Administration does not correspond to one or more",WMSG(1)="of this order's scheduled Administration Times!"
"RTN","PSGOE81",184,0)
 ..Q
"RTN","PSGOE81",185,0)
 .Q
"RTN","PSGOE81",186,0)
 S:(+RP>0) PSGDUR=(RP*60)
"RTN","PSGOE81",187,0)
 W:(+RP>0) ?60,RP," HOURS"
"RTN","PSGOE81",188,0)
 D:$G(WMSG) EN^DDIOL($P(WMSG,U,2)),EN^DDIOL(WMSG(1))
"RTN","PSGOE81",189,0)
 Q
"RTN","PSGOE81",190,0)
 ;
"RTN","PSGOE81",191,0)
VERTIMES ; Redisplay Admin and Removal times
"RTN","PSGOE81",192,0)
 S PSGRF=$P($G(^PS(50.7,$G(PSGPDRG),4),0),U,1) Q:(PSGRF<2)!($G(PSGST)="O")
"RTN","PSGOE81",193,0)
 N PSGADT,PSGRARR,PSGAARR
"RTN","PSGOE81",194,0)
 ;If we have a frequency and this is odd type order then we need to start calculations with order start time.
"RTN","PSGOE81",195,0)
 I $G(PSGS0XT),$G(PSGNESD),+$G(PSGDUR),$G(PSGAT)="" D  Q
"RTN","PSGOE81",196,0)
 . N L
"RTN","PSGOE81",197,0)
 . S (PSGAARR,PSGRARR)=1,PSGADT=$P($P(PSGNESD,U,1),".",2),L=$L(PSGADT)
"RTN","PSGOE81",198,0)
 . S PSGRARR(1)=(((((PSGADT*60)+PSGDUR)/60)#24)*100) S:PSGRARR(1)=0 PSGRARR(1)=2400 S:$L(PSGRARR(1))=3 PSGRARR(1)="0"_PSGRARR(1)
"RTN","PSGOE81",199,0)
 . S PSGRARR(1)=$E(PSGRARR(1),1,L)_"(R)"
"RTN","PSGOE81",200,0)
 . S PSGAARR(1)=PSGADT,PSGAARR(1)=$E(PSGAARR(1),1,L)_"(A)"
"RTN","PSGOE81",201,0)
  . D WRITE
"RTN","PSGOE81",202,0)
 .Q
"RTN","PSGOE81",203,0)
 ;
"RTN","PSGOE81",204,0)
 S (PSGRARR,PSGAARR)=$S($G(PSGAT):$L(PSGAT,"-"),1:$L(PSGS0Y,"-"))
"RTN","PSGOE81",205,0)
 N P,L
"RTN","PSGOE81",206,0)
 F P=1:1:PSGRARR D
"RTN","PSGOE81",207,0)
 . S PSGADT=$S($G(PSGAT):$P(PSGAT,"-",P),1:$P(PSGS0Y,"-",P)),L=$L(PSGADT)
"RTN","PSGOE81",208,0)
 . S PSGADT=$S($L(PSGADT)=4:PSGADT/100,1:PSGADT*1)
"RTN","PSGOE81",209,0)
 . S PSGRARR(P)=(((((PSGADT*60)+PSGDUR)/60)#24)*100) S:PSGRARR(P)=0 PSGRARR(P)=2400 S:$L(PSGRARR(P))=3 PSGRARR(P)="0"_PSGRARR(P)
"RTN","PSGOE81",210,0)
 . S PSGRARR(P)=$E(PSGRARR(P),1,L)_"(R)"
"RTN","PSGOE81",211,0)
 . S PSGAARR(P)=(PSGADT*100) S:$L(PSGAARR(P))=3 PSGAARR(P)="0"_PSGAARR(P)
"RTN","PSGOE81",212,0)
 . S PSGAARR(P)=$E(PSGAARR(P),1,L)_"(A)"
"RTN","PSGOE81",213,0)
 .Q
"RTN","PSGOE81",214,0)
 D WRITE
"RTN","PSGOE81",215,0)
 Q
"RTN","PSGOE81",216,0)
 ;
"RTN","PSGOE81",217,0)
WRITE ;
"RTN","PSGOE81",218,0)
 W !!,"Verify Admin and removal times",!
"RTN","PSGOE81",219,0)
 W !,"(A)DMINISTRATION -(R)EMOVAL TIMES"
"RTN","PSGOE81",220,0)
 W !,"___________________________________________________________________________",!
"RTN","PSGOE81",221,0)
 F P=1:1:PSGAARR W PSGAARR(P)_"-"_PSGRARR(P)  W:P'=PSGAARR " , "
"RTN","PSGOE81",222,0)
 D ASK
"RTN","PSGOE81",223,0)
 Q
"RTN","PSGOE81",224,0)
 ;
"RTN","PSGOE81",225,0)
ASK ;
"RTN","PSGOE81",226,0)
 N Y
"RTN","PSGOE81",227,0)
 S DIR("A")="Is this correct",DIR(0)="Y" D ^DIR I $D(DUOUT)!$D(DTOUT) W:'$T $C(7) S PSGOEE=0 K PSGDUR G DONE
"RTN","PSGOE81",228,0)
 I 'Y K X S PSGDUR=-1 G A39
"RTN","PSGOE81",229,0)
 N P S P=1,PSGRMVT=$P(PSGRARR(P),"(",1)
"RTN","PSGOE81",230,0)
 F  S P=$O(PSGRARR(P)) Q:P=""  D
"RTN","PSGOE81",231,0)
 . S PSGRMVT=PSGRMVT_"-"_$P(PSGRARR(P),"(",1)
"RTN","PSGOE81",232,0)
 .Q
"RTN","PSGOE81",233,0)
 Q
"RTN","PSGOE81",234,0)
 ;
"RTN","PSGOE82")
0^7^B34233969^B33061347
"RTN","PSGOE82",1,0)
PSGOE82 ;BIR/CML3-NON-VERIFIED ORDER EDIT (CONT.) ;27 Jan 98 9:32 AM
"RTN","PSGOE82",2,0)
 ;;5.0;INPATIENT MEDICATIONS ;**2,35,50,67,58,81,127,168,181,276,317,366**;16 DEC 97;Build 7
"RTN","PSGOE82",3,0)
 ;
"RTN","PSGOE82",4,0)
 ; Reference to ^DD(53.1 is supported by DBIA #2256.
"RTN","PSGOE82",5,0)
 ; Reference to ^VA(200 is supported by DBIA #10060.
"RTN","PSGOE82",6,0)
 ; Reference to ^DIE is supported by DBIA #10018.
"RTN","PSGOE82",7,0)
 ; Reference to ^DIC is supported by DBIA #10006.
"RTN","PSGOE82",8,0)
 ; Reference to ^DICN is supported by DBIA #10009.
"RTN","PSGOE82",9,0)
 ; Reference to $$GET^XPAR is supported by DBIA #2263
"RTN","PSGOE82",10,0)
 ;
"RTN","PSGOE82",11,0)
1 ; provider
"RTN","PSGOE82",12,0)
 S MSG=0,PSGF2=1 S:PSGOEEF(PSGF2) BACK="1^PSGOE82"
"RTN","PSGOE82",13,0)
A1 I $G(PSGORD)["P",$G(PSGP) I $$LASTREN^PSJLMPRI(PSGP,PSGORD) D  Q
"RTN","PSGOE82",14,0)
 . W !?5,"This order has been renewed. Provider may not be edited at this point. " D PAUSE^VALM1
"RTN","PSGOE82",15,0)
 ;*366 - check provider credentials
"RTN","PSGOE82",16,0)
 I PSGPR N PSJACT,BKP,BKPN S PSJACT=$$ACTPRO^PSGOE1(PSGPR) S:'PSJACT BKP=PSGPR,BKPN=PSGPRN,PSGPR=0,PSGPRN="",PSJACT="Z"
"RTN","PSGOE82",17,0)
 W !,"PROVIDER: ",$S(PSGPR:PSGPRN_"// ",1:"") R X:DTIME
"RTN","PSGOE82",18,0)
 I X="^"!'$T W:'$T $C(7) S PSGOEE=0 S:PSJACT="Z" PSGPR=BKP,PSGPRN=BKPN G DONE
"RTN","PSGOE82",19,0)
 I $S(X="":'PSGPR,1:X="@") W $C(7),"  (Required)" S X="?" D ENHLP^PSGOEM(53.1,1) G A1
"RTN","PSGOE82",20,0)
 I X="",PSGPR S X=PSGPRN I PSGPR'=PSGPRN,$D(^VA(200,PSGPR,"PS")) W:0 "    "_$P(^("PS"),"^",2)_"    "_$P(^("PS"),"^",3) G DONE
"RTN","PSGOE82",21,0)
 I X?1."?" D ENHLP^PSGOEM(53.1,1)
"RTN","PSGOE82",22,0)
 I $E(X)="^" D ENFF G:Y>0 @Y G A1
"RTN","PSGOE82",23,0)
 K DIC S DIC="^VA(200,",DIC(0)="EMQZ",DIC("S")="I $$ACTPRO^PSGOE1(+Y)" D ^DIC K DIC I Y'>0 G A1
"RTN","PSGOE82",24,0)
 S PSGPR=+Y,PSGPRN=Y(0,0) G DONE
"RTN","PSGOE82",25,0)
 ;
"RTN","PSGOE82",26,0)
5 ; self med
"RTN","PSGOE82",27,0)
 S MSG=0,PSGF2=5 S:PSGOEEF(PSGF2) BACK="5^PSGOE82" K PSGOEEF(6) S:PSGSM PSGOEEF(6)=1
"RTN","PSGOE82",28,0)
A5 W !,"SELF MED: " W $P("NO^YES","^",PSGSM+1),"// " R X:DTIME I X="^"!'$T W:'$T $C(7) S PSGOEE=0 G DONE
"RTN","PSGOE82",29,0)
 ;I "01"[X,$L(X)<2 S:PSGSM=""&(X]"") PSGSM=X W:PSGSM]"" "  (",$P("NO^YES","^",PSGSM+1),")" G:'PSGSM DONE S PSGOEEF(6)=1 G 6
"RTN","PSGOE82",30,0)
 I "01"[X,$L(X)<2 S:X]"" PSGSM=+X W:PSGSM]"" "  (",$P("NO^YES","^",PSGSM+1),")" G:'PSGSM DONE S PSGOEEF(6)=1 G 6
"RTN","PSGOE82",31,0)
 I X="@" W $C(7),"  (Required)" G A5
"RTN","PSGOE82",32,0)
 I X?1"^".E D ENFF G:Y>0 @Y G A5
"RTN","PSGOE82",33,0)
 I X?1."?" D ENHLP^PSGOEM(53.1,5) G A5
"RTN","PSGOE82",34,0)
 D YN I  S PSGSM=$E(X)="Y" K PSGOEEF(6) G:'PSGSM DONE S PSGOEEF(6)=1 G 6
"RTN","PSGOE82",35,0)
 W $C(7) D ENHLP^PSGOEM(53.1,5) G A5
"RTN","PSGOE82",36,0)
 ;
"RTN","PSGOE82",37,0)
6 ; hospital supplied self med
"RTN","PSGOE82",38,0)
 S MSG=0,PSGF2=6 S:PSGOEEF(PSGF2) BACK="6^PSGOE82"
"RTN","PSGOE82",39,0)
A6 W !,"HOSPITAL SUPPLIED SELF MED: " W:PSGHSM]"" $P("NO^YES","^",PSGHSM+1),"// " R X:DTIME I X="^"!'$T W:'$T $C(7) S PSGOEE=0 G DONE
"RTN","PSGOE82",40,0)
 I "01"[X,$L(X)=1 S:X]"" PSGHSM=+X W "  (",$P("NO^YES","^",PSGHSM+1),")" S MSG=0,PSGF2=5 G DONE
"RTN","PSGOE82",41,0)
 I X="@" W $C(7),"  (Required)" G A6
"RTN","PSGOE82",42,0)
 I X?1"^".E D ENFF G:Y>0 @Y G A6
"RTN","PSGOE82",43,0)
 I X?1."?" D ENHLP^PSGOEM(53.1,6) G A6
"RTN","PSGOE82",44,0)
 D YN I  S PSGHSM=$E(X)="Y" S MSG=0,PSGF2=5 G DONE
"RTN","PSGOE82",45,0)
 W $C(7) D ENHLP^PSGOEM(53.1,6) G A6
"RTN","PSGOE82",46,0)
 ;
"RTN","PSGOE82",47,0)
2 ; dispense drug multiple
"RTN","PSGOE82",48,0)
 ;*276 - Disallow unauthorized nurses from editing Dispense Drug
"RTN","PSGOE82",49,0)
 I '$P($G(PSJSYSU),";",4) W !,"You are not authorized to edit Dispense Drugs." D PAUSE^VALM1 Q
"RTN","PSGOE82",50,0)
 S MSG=0,PSGF2=2,BACK="2^PSGOE82" K PSGOEEND
"RTN","PSGOE82",51,0)
 N PSGX,PSGXX F PSGXX=0:0 S PSGX=PSGXX,PSGXX=$O(^PS(53.45,PSJSYSP,2,PSGXX)) Q:'PSGXX
"RTN","PSGOE82",52,0)
 N PSJPNDRN I $G(PSGORD) I $E(PSGORD,$L(PSGORD))="P",$P($G(^PS(53.1,+PSGORD,0)),"^",24)="R" S PSJPNDRN=1 D
"RTN","PSGOE82",53,0)
 .S $P(PSJPNDRN,"^",2)="Dispense drugs for renewal orders cannot be deleted, but can be given an INACTIVE DATE.  "
"RTN","PSGOE82",54,0)
 ; PSJ*5*317 - If PSJ PADE OE BALANCES parameter is YES, PADE balances should display as identifier.
"RTN","PSGOE82",55,0)
 N PSJPADLK S PSJPADLK=0  ; Flag indicating PADE drug lookup was done, don't do drug lookup twice - PSJ*5*317
"RTN","PSGOE82",56,0)
 I $$GET^XPAR("SYS","PSJ PADE OE BALANCES") D
"RTN","PSGOE82",57,0)
 .N DA,DIC,DIE,DR,DIR,PSJLOC,PSJDRG,PSJDDC,DFN,PSJORD,PSJPOI,PSJORCL,PSJCLNK,PSJCLND
"RTN","PSGOE82",58,0)
 .; If clinic order, quit if clinic location is not linked to PADE
"RTN","PSGOE82",59,0)
 .S PSJORCL=$S($G(PSGORD)["P":$G(^PS(53.1,+$G(PSGORD),"DSS")),1:"")
"RTN","PSGOE82",60,0)
 .I PSJORCL,$P(PSJORCL,"^",2) S PSJCLNK=$$PADECL^PSJPAD50(+$G(PSJORCL)) Q:'PSJCLNK
"RTN","PSGOE82",61,0)
 .I '$G(PSJCLNK) Q:'$$PADEWD^PSJPAD50(+$G(VAIN(4)))
"RTN","PSGOE82",62,0)
 .I $G(PSGORD) S PSJPOI=+$G(^PS(53.1,+$G(PSGORD),.2))
"RTN","PSGOE82",63,0)
 .S DFN=$G(PSGP),PSJORD=$G(PSGORD)
"RTN","PSGOE82",64,0)
 .S PSJDDC=0 F  S PSJDDC=$O(^PS(53.45,+$G(PSJSYSP),2,PSJDDC)) Q:'PSJDDC  S PSJDRG(PSJDDC)=^(PSJDDC,0) I '$G(PSJPOI) D
"RTN","PSGOE82",65,0)
 ..S PSJPOI=+$G(^PSDRUG(+$G(PSJDRG(PSJDDC)),2))
"RTN","PSGOE82",66,0)
 ..I '$G(PSJPOI),$G(PSGPD),($G(^PS(50.7,+$G(PSGPD),0))]"") S PSJPOI=+PSGPD
"RTN","PSGOE82",67,0)
 .S PSJCLND=$S($G(PSJORD)["U":$G(^PS(55,DFN,5,+PSJORD,8)),$G(PSJORD)["P":$G(^PS(53.1,+PSJORD,"DSS")),1:"")
"RTN","PSGOE82",68,0)
 .S PSJLOC=$S(PSJCLND&$P(PSJCLND,"^",2):+PSJCLND_"C",1:"")
"RTN","PSGOE82",69,0)
 .;S PSJLOC=$S($G(PSJORD)["U":+$G(^PS(55,DFN,5,+PSJORD,8))_"C",$G(PSJORD)["P":+$G(^PS(53.1,+PSJORD,"DSS"))_"C",1:"")
"RTN","PSGOE82",70,0)
 .S:'PSJLOC PSJLOC=+$G(VAIN(4)) I '$G(PSJLOC) D
"RTN","PSGOE82",71,0)
 ..N VAIN D INP^VADPT S PSJLOC=$G(VAIN(4))
"RTN","PSGOE82",72,0)
 .S PSJPADLK=1
"RTN","PSGOE82",73,0)
 .D READDD^PSJPAD50(.PSJDRG,$S($G(PSGPD):+$G(PSGPD),1:+$G(PSJPOI)),PSJLOC,PSJORD,$G(PSGORD))
"RTN","PSGOE82",74,0)
 ; PSJ*5*317 - If PSJ PADE OE BALANCES parameter is NO, PADE balances should NOT display as identifer.
"RTN","PSGOE82",75,0)
 I '$G(PSJPADLK) N DA,DIC,DIE,DR,DIR S DIE="^PS(53.45,",DA=PSJSYSP,DR=2,DR(2,53.4502)=".01;.02"_$S($G(PSJPNDRN):";.03",1:"") D ^DIE
"RTN","PSGOE82",76,0)
 I '$O(^PS(53.45,PSJSYSP,2,0)) W $C(7),!!,"WARNING: This order must have at least one dispense drug before pharmacy can",!?9,"verify it!",! S MSG=1
"RTN","PSGOE82",77,0)
 D DDOC(PSGX)
"RTN","PSGOE82",78,0)
 NEW PSJDOSE
"RTN","PSGOE82",79,0)
 D DOSECHK^PSJDOSE
"RTN","PSGOE82",80,0)
 I +$G(PSJDSFLG) D DSPWARN^PSJDOSE S PSGOEEF(109)=1
"RTN","PSGOE82",81,0)
 G DONE
"RTN","PSGOE82",82,0)
 ;
"RTN","PSGOE82",83,0)
40 ; comments
"RTN","PSGOE82",84,0)
 S MSG=0,PSGF2=40,BACK="40^PSGOE82",DA=PSJSYSP,DR=1,DIE="^PS(53.45," D ^DIE W ! G DONE
"RTN","PSGOE82",85,0)
 ;
"RTN","PSGOE82",86,0)
66 ; provider comments
"RTN","PSGOE82",87,0)
 ;S MSG=0,PSGF2=66,BACK="66^PSGOE82",DA=PSJSYSP,DR=4,DIE="^PS(53.45," D ^DIE W ! G DONE
"RTN","PSGOE82",88,0)
 ;
"RTN","PSGOE82",89,0)
DONE ;
"RTN","PSGOE82",90,0)
 I PSGOEE G:'PSGOEEF(PSGF2) @BACK S PSGOEE=PSGOEEF(PSGF2)
"RTN","PSGOE82",91,0)
 K F,F0,PSGF2,F3,PSG,SDT Q
"RTN","PSGOE82",92,0)
 ;
"RTN","PSGOE82",93,0)
ENFF ; up-arrow to another field
"RTN","PSGOE82",94,0)
 S Y=-1 I '$D(PSGOEEF)!(X?1"^"1.9N) W $C(7),"  ??" Q
"RTN","PSGOE82",95,0)
 S X=$E(X,2,99) I X=+X S Y=$S($D(PSGOEEF(X)):X,1:-1) W "  " W:Y>0 $$CODES2^PSIVUTL(53.1,X) W:Y'>0 $C(7),"??" Q
"RTN","PSGOE82",96,0)
 K DIC S DIC="^DD(53.1,",DIC(0)="QEM",DIC("S")="I $D(PSGOEEF(+Y))" D ^DIC K DIC S Y=+Y S:Y>0 Y=$P($T(@("F"_Y)),";",3) Q
"RTN","PSGOE82",97,0)
 ;
"RTN","PSGOE82",98,0)
DEL ; delete entry
"RTN","PSGOE82",99,0)
 W !?3,"SURE YOU WANT TO DELETE" S %=0 D YN^DICN I %'=1 W $C(7),"  <NOTHING DELETED>"
"RTN","PSGOE82",100,0)
 Q
"RTN","PSGOE82",101,0)
 ;
"RTN","PSGOE82",102,0)
YN ; yes/no as a set of codes
"RTN","PSGOE82",103,0)
 I X'?.U F Y=1:1:$L(X) I $E(X,Y)?1L S X=$E(X,1,Y-1)_$C($A(X,Y)-32)_$E(X,Y+1,$L(X))
"RTN","PSGOE82",104,0)
 F Y="NO","YES" I $P(Y,X)="" W $P(Y,X,2) Q
"RTN","PSGOE82",105,0)
 Q
"RTN","PSGOE82",106,0)
DDOC(PSGX) ; Order check on additional dispense drug for allergy and adv. reactions.
"RTN","PSGOE82",107,0)
 N PSGY,PSGND1,PSGND3,PSJALLGY
"RTN","PSGOE82",108,0)
 S PSGY=0 F  S PSGX=$O(^PS(53.45,PSJSYSP,2,PSGX)) Q:'PSGX  S PSGY=$P($G(^PS(53.45,PSJSYSP,2,PSGX,0)),"^") Q:PSGY=""  D
"RTN","PSGOE82",109,0)
 . N INTERVEN,PSJDDI,PSJIREQ,PSJRXREQ,PSJDD,PSGORQF,PSJPDRG S PSJDD=PSGY
"RTN","PSGOE82",110,0)
 . S Y=1,(PSJIREQ,PSJRXREQ,INTERVEN,X)=""
"RTN","PSGOE82",111,0)
 . I '$G(PSJALGY1) S PSJALLGY(PSJDD)="" D ALLERGY^PSJOC
"RTN","PSGOE82",112,0)
 . ;D IVSOL^PSGSICHK
"RTN","PSGOE82",113,0)
 . I ($D(PSGORQF)) D
"RTN","PSGOE82",114,0)
 .. K ^PS(53.45,PSJSYSP,2,PSGX),^PS(53.45,PSJSYSP,2,"B",PSGY)
"RTN","PSGOE82",115,0)
 Q
"RTN","PSGOE82",116,0)
 ;
"RTN","PSGOE82",117,0)
F101 ;;101^PSGOE8
"RTN","PSGOE82",118,0)
F109 ;;109^PSGOE8
"RTN","PSGOE82",119,0)
F3 ;;3^PSGOE8
"RTN","PSGOE82",120,0)
F7 ;;7^PSGOE8
"RTN","PSGOE82",121,0)
PSGF26 ;;26^PSGOE8
"RTN","PSGOE82",122,0)
F39 ;;39^PSGOE81
"RTN","PSGOE82",123,0)
F8 ;;8^PSGOE81
"RTN","PSGOE82",124,0)
F10 ;;10^PSGOE81
"RTN","PSGOE82",125,0)
PSGF25 ;;25^PSGOE81
"RTN","PSGOE82",126,0)
F1 ;;1^PSGOE82
"RTN","PSGOE82",127,0)
F5 ;;5^PSGOE82
"RTN","PSGOE82",128,0)
PSGF2 ;;2^PSGOE82
"RTN","PSGOE9")
0^3^B47270955^B46578663
"RTN","PSGOE9",1,0)
PSGOE9 ;BIR/CML3 - EDIT ORDERS IN 55 ; 7/6/11 9:45am
"RTN","PSGOE9",2,0)
 ;;5.0;INPATIENT MEDICATIONS ;**11,47,50,72,110,111,188,192,207,113,223,269,315,338,352,366**;16 DEC 97;Build 7
"RTN","PSGOE9",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PSGOE9",4,0)
 ; Reference to ^PS(50.7 is supported by DBIA# 2180
"RTN","PSGOE9",5,0)
 ; Reference to ^PS(51.1 is supported by DBIA 2177
"RTN","PSGOE9",6,0)
 ; Reference to ^PS(51.2 is supported by DBIA# 2178
"RTN","PSGOE9",7,0)
 ; Reference to ^PS(55 is supported by DBIA #2191
"RTN","PSGOE9",8,0)
 ; Reference to ^PSDRUG is supported by DBIA# 2192
"RTN","PSGOE9",9,0)
 ;
"RTN","PSGOE9",10,0)
101 ; Orderable Item (AKA primary drug)
"RTN","PSGOE9",11,0)
 S MSG=0,PSGF2=101,PSGOOPD=PSGPD,PSGOOPDN=PSGPDN S:PSGOEEF(PSGF2) BACK="101^PSGOE9"
"RTN","PSGOE9",12,0)
 I $G(PSGOROE1)'=1 S %=1 W !!,$C(7),"WARNING!  If you change the drug of an order, the Dosage Ordered and Dispense",!,"Drug(s) are deleted." F  W !,"Do you wish to continue" S %=2 D YN^DICN Q:%  D DH^PSGOE8
"RTN","PSGOE9",13,0)
 I %'=1 G DONE
"RTN","PSGOE9",14,0)
A101 ;
"RTN","PSGOE9",15,0)
 I $G(PSJORD),$G(PSGP) I $$COMPLEX^PSJOE(PSGP,PSJORD) S PSGOEE=0 D  G DONE
"RTN","PSGOE9",16,0)
 . W !!?5,"Orderable Item may not be edited for active complex orders." D PAUSE^VALM1
"RTN","PSGOE9",17,0)
 W !,"ORDERABLE ITEM: ",$S(PSGPD:PSGPDN_"// ",1:"") R X:DTIME I X="^"!'$T W:'$T $C(7) S PSGOEE=0 G DONE
"RTN","PSGOE9",18,0)
 I X="",PSGPD S X=PSGPDN I PSGPD'=PSGPDN,$D(^PS(50.7,PSGPD,0)) G DONE
"RTN","PSGOE9",19,0)
 I $S(X="@":1,X]"":0,1:'PSGPD) W $C(7),"  (Required)" S X="?" D ENHLP^PSGOEM(55.06,101) G A101
"RTN","PSGOE9",20,0)
 I X?1."?" D ENHLP^PSGOEM(55.06,101)
"RTN","PSGOE9",21,0)
 I $E(X)="^" D ENFF^PSGOE92 G:Y>0 @Y G A101
"RTN","PSGOE9",22,0)
 ;BHW;PSJ*5.0*192;Modify ^DIC call to use MIX^DIC and only B/C cross-references
"RTN","PSGOE9",23,0)
 K DIC,D S DIC="^PS(50.7,",DIC(0)="EMQZ",DIC("S")="I $$ENOISC^PSJUTL(Y,""U"")",D="B^C" D MIX^DIC1 K DIC,D I Y'>0 G A101
"RTN","PSGOE9",24,0)
 I +Y=PSGPD G DONE  ;PSJ*5*269 - No change to Orderable Item
"RTN","PSGOE9",25,0)
 F  S %=2 D DH^PSGOE8,YN^DICN Q:%
"RTN","PSGOE9",26,0)
 I %'=1 G A101
"RTN","PSGOE9",27,0)
 S (PSGPDRG,PSGPD)=+Y,(PSGPDN,PSGPDRGN)=$$OINAME^PSJLMUTL(PSGPDRG)
"RTN","PSGOE9",28,0)
 S PSGNEDFD=$$GTNEDFD^PSGOE7("U",PSGPDRG)
"RTN","PSGOE9",29,0)
 S PSGPDNX=1,PSGPD=+Y,PSGPDN=$$OINAME^PSJLMUTL(PSGPD),PSGDO="" K ^PS(53.45,PSJSYSP,2) S X=$O(^PSDRUG("ASP",PSGPD,0)) I X,'$O(^(X)) S ^PS(53.45,PSJSYSP,2,0)="^53.4502P^1^1",^(1,0)=X,^PS(53.45,PSJSYSP,2,"B",X,1)="" G DONE
"RTN","PSGOE9",30,0)
 D ENDRG^PSGOEF1(PSGPD,0)
"RTN","PSGOE9",31,0)
 I $S($D(DTOUT):1,$D(DUOUT):1,$D(DIRUT):1,1:0) S PSGOROE1=1 G DONE
"RTN","PSGOE9",32,0)
 ;G DONE
"RTN","PSGOE9",33,0)
 ;
"RTN","PSGOE9",34,0)
109 ; dosage ordered
"RTN","PSGOE9",35,0)
 S MSG=0,PSGF2=109 S:$G(PSGOEEF(PSGF2)) BACK="109^PSGOE9"
"RTN","PSGOE9",36,0)
A109 ;
"RTN","PSGOE9",37,0)
 I $G(PSJORD),$G(PSGP) I $$COMPLEX^PSJOE(PSGP,PSJORD) S PSGOEE=0 D  G DONE
"RTN","PSGOE9",38,0)
 . W !!?5,"Dosage may not be edited for active complex orders." D PAUSE^VALM1
"RTN","PSGOE9",39,0)
 D EDITDOSE^PSJDOSE S X=PSGDO G DONE
"RTN","PSGOE9",40,0)
 W !,"DOSAGE ORDERED: ",$S(PSGDO]"":PSGDO_"// ",1:"") R X:DTIME I X="^"!'$T W:'$T $C(7) S PSGOEE=0 G DONE
"RTN","PSGOE9",41,0)
 I X=""&(PSGDO]"") S X=PSGDO
"RTN","PSGOE9",42,0)
 I $$CHECK^PSGOE8(PSJSYSP)&(X="")&(PSGDO']"") W $C(7),"    (Required) " G A109
"RTN","PSGOE9",43,0)
 I $$CHECK^PSGOE8(PSJSYSP)&(X="@") W $C(7),"  (Required)" G A109
"RTN","PSGOE9",44,0)
 I '$$CHECK^PSGOE8(PSJSYSP)&(X="@") S PSGDO="" G DONE
"RTN","PSGOE9",45,0)
 I X?1."?" D ENHLP^PSGOEM(55.06,109) G A109
"RTN","PSGOE9",46,0)
 I $E(X)="^" D ENFF^PSGOE92 G:Y>0 @Y G A109
"RTN","PSGOE9",47,0)
 I $E(X,$L(X))=" " F  S X=$E(X,1,$L(X)-1) Q:$E(X,$L(X))'=" "
"RTN","PSGOE9",48,0)
 I $S(X?.E1C.E:1,$L(X)>20:1,X="":0,X["^":1,X?1.P:1,1:X=+X) W $C(7),"  ",$S(X?1.P!(X=""):"(Required)",1:"??") D ENHLP^PSGOEM(55.06,109) G A109
"RTN","PSGOE9",49,0)
 S PSGDO=X G DONE
"RTN","PSGOE9",50,0)
 ;
"RTN","PSGOE9",51,0)
3 ; med route
"RTN","PSGOE9",52,0)
 S MSG=0,PSGF2=3 S:PSGOEEF(PSGF2) BACK="3^PSGOE9"
"RTN","PSGOE9",53,0)
A3 I $G(PSJORD),$G(PSGP) I $$COMPLEX^PSJOE(PSGP,PSJORD) S PSGOEE=0 D  G DONE
"RTN","PSGOE9",54,0)
 . W !!?5,"Med Route may not be edited for active complex orders." D PAUSE^VALM1
"RTN","PSGOE9",55,0)
 W !,"MED ROUTE: ",$S(PSGMR:PSGMRN_"// ",1:"") R X:DTIME I X="^"!'$T W:'$T $C(7) S PSGOEE=0 G DONE
"RTN","PSGOE9",56,0)
 I X="",PSGMR S X=PSGMRN I PSGMR'=PSGMRN,$D(^PS(51.2,PSGMR,0)) W "  "_$P(^(0),"^",3) G DONE
"RTN","PSGOE9",57,0)
 I $S(X="@":1,X]"":0,1:'PSGMR) W $C(7),"  (Required)" S X="?" D ENHLP^PSGOEM(55.06,3) G A3
"RTN","PSGOE9",58,0)
 I X="?" D MRSL^PSGOE4 ;*366
"RTN","PSGOE9",59,0)
 I X?1."?" D ENHLP^PSGOEM(55.06,3)
"RTN","PSGOE9",60,0)
 I $E(X)="^" D ENFF^PSGOE92 G:Y>0 @Y G A3
"RTN","PSGOE9",61,0)
 D CKMRSL^PSGOE4 ;*366
"RTN","PSGOE9",62,0)
 K DIC S DIC="^PS(51.2,",DIC(0)="EMQZX",DIC("S")="I $P(^(0),""^"",4)" D ^DIC K DIC I Y'>0 G A3
"RTN","PSGOE9",63,0)
 S PSGMR=+Y,PSGMRN=Y(0,0) G DONE
"RTN","PSGOE9",64,0)
 ;
"RTN","PSGOE9",65,0)
7 ; schedule type
"RTN","PSGOE9",66,0)
 S MSG=0,PSGF2=7 S:PSGOEEF(PSGF2) BACK="7^PSGOE9"
"RTN","PSGOE9",67,0)
A7 I $G(PSGP),$G(PSGORD) I $$COMPLEX^PSJOE(PSGP,PSGORD) D
"RTN","PSGOE9",68,0)
 . N X,Y,PARENT,P2ND S P2ND=$S(PSGORD["U":$G(^PS(55,PSGP,5,+PSGORD,.2)),1:$G(^PS(53.1,+PSGORD,.2))),PARENT=$P(P2ND,"^",8)
"RTN","PSGOE9",69,0)
 . I PARENT D FULL^VALM1 W !!?5,"This order is part of a complex order. Please review the following ",!?5,"associated orders before changing this order." D CMPLX^PSJCOM1(PSGP,PARENT,PSGORD)
"RTN","PSGOE9",70,0)
 W !,"SCHEDULE TYPE: "_$S(PSGSTN]"":PSGSTN_"// ",1:"") R X:DTIME S X=$TR(X,"coprocf","COPROCF") I X="^"!'$T S PSGOEE=0 W $C(7) G DONE
"RTN","PSGOE9",71,0)
 I X="" S X=PSGST,PSGSTN=$$ENSTN^PSGMI(X) W:PSGSTN]"" "  ",PSGSTN G DONE
"RTN","PSGOE9",72,0)
 S:X="F" X="R"
"RTN","PSGOE9",73,0)
 I ",?,??,C,O,OC,P,R,"'[(","_X_",") W " ??" G A7
"RTN","PSGOE9",74,0)
 I $$PRNOK^PSGS0($G(PSGSCH)),X="C" W "  ??" G A7
"RTN","PSGOE9",75,0)
 I X="@"!(X?1."?") W:X="@" $C(7),"  (Required)" S:X="@" X="?" D ENHLP^PSGOEM(55.06,7) G A7
"RTN","PSGOE9",76,0)
 I $E(X)="^" D ENFF^PSGOE92 G:Y>0 @Y G A7
"RTN","PSGOE9",77,0)
 ;*223 Don't allow O sched type on C orders
"RTN","PSGOE9",78,0)
 I X="O",$$SCHTP^PSGOE8(PSGSCH)'="O" W !,"  SCHEDULE ("_PSGSCH_") is not a ONE TIME Schedule." G A7
"RTN","PSGOE9",79,0)
 ;*269 Don't allow C sched type on O orders
"RTN","PSGOE9",80,0)
 I X="C",$$SCHTP^PSGOE8(PSGSCH)="O" W !,"  SCHEDULE ("_PSGSCH_") is not a CONTINUOUS Schedule." G A7
"RTN","PSGOE9",81,0)
 S PSGOST=PSGST
"RTN","PSGOE9",82,0)
 S PSGST=X,PSGSTN=$$ENSTN^PSGMI(X) W:PSGSTN]"" "  ",PSGSTN
"RTN","PSGOE9",83,0)
 I X="P",$G(PSGAT)]"" S PSGOAT=PSGAT S PSGAT="" D
"RTN","PSGOE9",84,0)
 .W !!,"NOTE: This change in schedule type also changes the ADMIN TIMES.",!
"RTN","PSGOE9",85,0)
 .S MSG=1,PSGOEEF(39)=1
"RTN","PSGOE9",86,0)
 .I $G(PSJNEWOE) D PAUSE^VALM1
"RTN","PSGOE9",87,0)
 G DONE
"RTN","PSGOE9",88,0)
 ;
"RTN","PSGOE9",89,0)
26 ; schedule
"RTN","PSGOE9",90,0)
 S MSG=0,PSGF2=26 S:PSGOEEF(PSGF2) BACK="26^PSGOE9"
"RTN","PSGOE9",91,0)
A26 I $G(PSJORD),$G(PSGP) I $$COMPLEX^PSJOE(PSGP,PSJORD) S PSGOEE=0 D  G DONE
"RTN","PSGOE9",92,0)
 . W !!?5,"Schedule may not be edited for active complex orders." D PAUSE^VALM1
"RTN","PSGOE9",93,0)
 W !,"SCHEDULE: ",$S(PSGSCH]"":PSGSCH_"// ",1:"") R X:DTIME I X="^"!'$T W:'$T $C(7) S PSGOEE=0 G DONE
"RTN","PSGOE9",94,0)
 S:X="" X=PSGSCH,PSGSCH="" I "@"[X W $C(7),"  (Required)" S X="?" D ENHLP^PSGOEM(55.06,26) G A26
"RTN","PSGOE9",95,0)
 S DOW=0 I $$DOW^PSIVUTL($$ENLU^PSGMI(X)) S DOW=1
"RTN","PSGOE9",96,0)
 I X?1."?" D ENHLP^PSGOEM(55.06,26) G A26
"RTN","PSGOE9",97,0)
 I $E(X)="^" D ENFF^PSGOE92 G:Y>0 @Y G A26
"RTN","PSGOE9",98,0)
 ;BHW;PSJ*5*188;Add flag and IEN return variable for PSGS0 (PSJ*5*134), Highlight Admin Times if they changed.
"RTN","PSGOE9",99,0)
 N PSJSLUP,PSGSFLG S PSJSLUP=1,PSGSFLG=1 D EN^PSGS0 I '$D(X) W $C(7),"  ??" S X="?" D ENHLP^PSGOEM(55.06,26) G A26
"RTN","PSGOE9",100,0)
 I X'=PSGSCH D
"RTN","PSGOE9",101,0)
 . N XX
"RTN","PSGOE9",102,0)
 . K PSGDUR,PSGRMVT,PSGRMV,ND2P1 ;*315 Removal times are tied to ADMIN times.
"RTN","PSGOE9",103,0)
 . S PSGSCH=X
"RTN","PSGOE9",104,0)
 . I PSGS0Y'=PSGAT S PSGAT=PSGS0Y  ;Change so that any schedule change will adjust the type and default the admin times - DRF
"RTN","PSGOE9",105,0)
 . D  ;Change schedule type to agree with schedule
"RTN","PSGOE9",106,0)
 .. I $G(DOW) S PSGST="C",PSGSTN=$$ENSTN^PSGMI(PSGST) Q
"RTN","PSGOE9",107,0)
 .. I (PSGSCH[" PRN")!(PSGSCH="PRN") I $$PRNOK^PSGS0(PSGSCH) S PSGOST=PSGST,PSGST="P",PSGSTN=$$ENSTN^PSGMI(PSGST) Q
"RTN","PSGOE9",108,0)
 .. I '$G(PSGSCIEN),PSGSCH]"" S XX=+$O(^PS(51.1,"AC","PSJ",PSGSCH,0)),PSGSCIEN=XX ;PSGSCIEN should be set by call to EN^PSGS0
"RTN","PSGOE9",109,0)
 .. S PSGST=$P($G(^PS(51.1,PSGSCIEN,0)),"^",5) I PSGST="D" S PSGST="C"  ;DOW schedules are converted to Continuous
"RTN","PSGOE9",110,0)
 .. S PSGSTN=$$ENSTN^PSGMI(PSGST)
"RTN","PSGOE9",111,0)
 . W !!,"NOTE: This change in schedule also changes the ADMIN TIMES and SCHEDULE TYPE.",!
"RTN","PSGOE9",112,0)
 . S MSG=1,PSGOEEF(39)=1
"RTN","PSGOE9",113,0)
 . I ($G(PSGRF)>1),PSGST="C" D
"RTN","PSGOE9",114,0)
 .. S PSGF2=41,BACK="41^PSGOE91",PSGOEEF(PSGF2)=1 D 41^PSGOE91 S BACK="26^PSGOE9",PSGF2=26,PSGOAT=PSGAT ;*315 Prompt for Admin to get DOA
"RTN","PSGOE9",115,0)
 ..Q
"RTN","PSGOE9",116,0)
 . I $G(PSJNEWOE) D PAUSE^VALM1
"RTN","PSGOE9",117,0)
 I PSGST="O" S PSGOEEF(7)=1 I +$G(PSGRF) S PSGOEEF(34)=1 D 34^PSGOE91 S PSGF2=26
"RTN","PSGOE9",118,0)
 ;
"RTN","PSGOE9",119,0)
DONE ;
"RTN","PSGOE9",120,0)
 I PSGOEE G:'$G(PSGOEEF(PSGF2)) @BACK S PSGOEE=PSGOEEF(PSGF2)
"RTN","PSGOE9",121,0)
 K F,F0,PSGF2 Q
"RTN","PSGOE9",122,0)
 ;
"RTN","PSGOE9",123,0)
DEL ; delete entry
"RTN","PSGOE9",124,0)
 W !?3,"SURE YOU WANT TO DELETE" S %=0 D YN^DICN I %'=1 W $C(7),"  <NOTHING DELETED>"
"RTN","PSGOE9",125,0)
 Q
"RTN","PSGOE91")
0^23^B122701385^B121528275
"RTN","PSGOE91",1,0)
PSGOE91 ;BIR/CML3 - ACTIVE ORDER EDIT (CONT.) ;Jul 02, 2018@09:13
"RTN","PSGOE91",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**50,64,58,110,111,136,113,179,265,267,285,315,334,373,366**;16 DEC 97;Build 7
"RTN","PSGOE91",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PSGOE91",4,0)
 ; Reference to ^PS(55 is supported by DBIA #2191.
"RTN","PSGOE91",5,0)
 ; Reference to ^PS(50.7 is supported by DBIA# 2180
"RTN","PSGOE91",6,0)
 ; Reference to ^PS(51.1 is supported by DBIA 2177.
"RTN","PSGOE91",7,0)
 ;
"RTN","PSGOE91",8,0)
41 ; admin times
"RTN","PSGOE91",9,0)
 ;S MSG=0,PSGF2=41,ORIG=$G(PSGAT) S:PSGOEEF(PSGF2) BACK="41^PSGOE91"
"RTN","PSGOE91",10,0)
 ;*315 next 5 lines
"RTN","PSGOE91",11,0)
 N PSGDOA
"RTN","PSGOE91",12,0)
 S MSG=0,PSGF2=41,ORIG=$G(PSGAT),PSGDOA=$G(PSGDUR) S:PSGOEEF(PSGF2) BACK="41^PSGOE91"
"RTN","PSGOE91",13,0)
 I (PSGST="P")!$$PRNOK^PSGS0($G(PSGSCH)) G DONE
"RTN","PSGOE91",14,0)
 I $$ODD^PSGS0(PSGS0XT) D PSGDUR G DONE
"RTN","PSGOE91",15,0)
A41 I $G(PSJORD),$G(PSGP) I $$COMPLEX^PSJOE(PSGP,PSJORD) S PSGOEE=0 D  G DONE
"RTN","PSGOE91",16,0)
 . W !!?5,"ADMIN TIMES may not be edited for active complex orders." D PAUSE^VALM1
"RTN","PSGOE91",17,0)
 W !,"ADMIN TIMES: "_$S(PSGAT:PSGAT_"// ",1:"") R X:DTIME I X="^"!('$T) W:'$T $C(7) S PSGOEE=0 S:X="^" (X,PSGAT)=$G(ORIG),PSGDUR="" G DONE
"RTN","PSGOE91",18,0)
 I X="" S:$G(PSGAT) X=PSGAT,PSGNOHI=1 ;*315 If admin time default was taken then don't highlight admin time.
"RTN","PSGOE91",19,0)
 I $E(X)="^" D ENFF^PSGOE92 G:Y>0 @Y G A41
"RTN","PSGOE91",20,0)
 I X="@" I (PSGS0XT="D")!(PSGSCH["@") I ((",P,R,OC,O,")'[(","_$G(PSGST)_",")) D  G A41
"RTN","PSGOE91",21,0)
 .W $C(7),"  ??" S X="?" W:PSGS0XT="D"!(PSGSCH["@") !,"This is a 'DAY OF THE WEEK' schedule and MUST have admin times." D ENHLP^PSGOEM(55.06,41)
"RTN","PSGOE91",22,0)
 I X="@" D DEL G:%'=1 A41 S PSGAT="",X=""
"RTN","PSGOE91",23,0)
 I ((PSGST="O")!($G(PSGST)="OC")!($G(PSGST)="P")!$$ODD^PSGS0($P($G(ZZND),"^",3))!($P($G(ZZND),"^",5)="O")),X="" D  G DONE
"RTN","PSGOE91",24,0)
 . S (PSGS0Y,PSGAT)=X
"RTN","PSGOE91",25,0)
 . I (($G(PSGRF))&($G(PSGST)="O")) N PSGRO S PSGOEEF(34)=1,PSGOEEF(41)=1,PSGRO=1 D 34
"RTN","PSGOE91",26,0)
 .Q
"RTN","PSGOE91",27,0)
 I $G(PSGS0XT) I '$$ODD^PSGS0(PSGS0XT),$G(PSGST)'="P",$G(PSGST)'="OC",'$$PRNOK^PSGS0(PSGSCH) I ($G(PSGST)'="O") D TIMES G:'$D(X) A41 D PSGDUR G:'$D(X) A41 G:$G(X)="^" DONE ;*315
"RTN","PSGOE91",28,0)
 I X?1."?" D ENHLP^PSGOEM(55.06,41) G A41
"RTN","PSGOE91",29,0)
 D ENCHK^PSGS0 I '$D(X) W $C(7),"  ??" S X="?" D ENHLP^PSGOEM(55.06,41) G A41
"RTN","PSGOE91",30,0)
 S PSGOAT=PSGAT
"RTN","PSGOE91",31,0)
 S (PSGS0Y,PSGAT)=X G DONE
"RTN","PSGOE91",32,0)
 ;
"RTN","PSGOE91",33,0)
8 ; special instructions
"RTN","PSGOE91",34,0)
 S MSG=0,PSGF2=8 S:PSGOEEF(PSGF2) BACK="8^PSGOE91"
"RTN","PSGOE91",35,0)
A8 I $G(PSGP),$G(PSGORD) I $$COMPLEX^PSJOE(PSGP,PSGORD) D
"RTN","PSGOE91",36,0)
 . N X,Y,PARENT,P2ND S P2ND=$S(PSGORD["U":$G(^PS(55,PSGP,5,+PSGORD,.2)),1:$G(^PS(53.1,+PSGORD,.2))),PARENT=$P(P2ND,"^",8)
"RTN","PSGOE91",37,0)
 . I PARENT D FULL^VALM1 W !!?5,"This order is part of a complex order. Please review the following ",!?5,"associated orders before changing this order." D CMPLX^PSJCOM1(PSGP,PARENT,PSGORD)
"RTN","PSGOE91",38,0)
 I $E(X)=U D ENFF^PSGOE92 G:Y>0 @Y G A8
"RTN","PSGOE91",39,0)
 S PSGSI=$$EDITSI^PSJBCMA5($G(PSGP),$G(PSGORD)) I $G(PSGP),$G(PSGORD) I '$$DIFFSI^PSJBCMA5(PSGP,PSGORD) S PSGOEE=0 G DONE
"RTN","PSGOE91",40,0)
 S PSGSI=$S((PSGSI>0&(PSGSI<4)):$G(^PS(53.45,+PSJSYSP,5,1,0))_" "_$G(^PS(53.45,+PSJSYSP,5,2,0)),PSGSI>3:"Instructions too long. See Order View or BCMA for full text.",1:"")
"RTN","PSGOE91",41,0)
 S:PSGSI=" " PSGSI="" I PSGSI]"" S PSGSI=$$ENBCMA^PSJUTL("U") G DONE
"RTN","PSGOE91",42,0)
 Q
"RTN","PSGOE91",43,0)
 ;
"RTN","PSGOE91",44,0)
10 ; start date/time edit
"RTN","PSGOE91",45,0)
 S MSG=0,PSGF2=10 S:PSGOEEF(PSGF2) BACK="10^PSGOE91"
"RTN","PSGOE91",46,0)
A10 ; start date/time edit
"RTN","PSGOE91",47,0)
 S PSGSDEDT=1 ; This variable indicates a Manual Edit of the Start/Date Time.
"RTN","PSGOE91",48,0)
 I $G(PSJORD),$G(PSGP) I $$COMPLEX^PSJOE(PSGP,PSJORD) S PSGOEE=0 D  G DONE
"RTN","PSGOE91",49,0)
 . W !!?5,"Start Date/Time may not be edited for active complex orders." D PAUSE^VALM1
"RTN","PSGOE91",50,0)
 K PSGSDX
"RTN","PSGOE91",51,0)
 W !,"START DATE/TIME: "_$S($P(PSGSDN,"^")]"":$P(PSGSDN,"^")_"// ",1:"") R X:DTIME I X="^"!'$T W:'$T $C(7) S PSGOEE=0 G DONE
"RTN","PSGOE91",52,0)
 I X="",PSGSD W "  "_PSGSDN G DONE
"RTN","PSGOE91",53,0)
 ;I X="P" D ENPREV^PSGDL W:'$D(X) $C(7) G:'$D(X) A10 S PSGSD=+X,PSGSDN=$$ENDD^PSGMI(PSGSD)_"^"_$$ENDTC^PSGMI(PSGSD) W "  ",$P(PSGSDN,"^") G DONE  ;373
"RTN","PSGOE91",54,0)
 I X="P" D ENPREV^PSGDL W:'$D(X) $C(7) G:'$D(X) A10 S PSGSD=+X,PSGSDN=$$ENDD^PSGMI(PSGSD)_"^"_$$ENDTC2^PSGMI(PSGSD) W "  ",$P(PSGSDN,"^") G DONE  ;373
"RTN","PSGOE91",55,0)
 I X="@"!(X?1."?") W:X="@" $C(7),"  (Required)" S:X="@" X="?" D ENHLP^PSGOEM(55.06,10)
"RTN","PSGOE91",56,0)
 I $E(X)="^" D ENFF^PSGOE92 G:Y>0 @Y G A10
"RTN","PSGOE91",57,0)
 NEW TMPX S TMPX=X,X1=PSGDT,X2=-7 D C^%DTC K %DT S %DT="ERTX",%DT(0)=X,X=TMPX D ^%DT K %DT I Y'>0 D ENHLP^PSGOEM(55.06,10) G A10
"RTN","PSGOE91",58,0)
 I PSGFD<Y W $C(7),!?5,"*** THE START DATE CANNOT BE AFTER THE STOP DATE! ***",! S MSG=1 G A10
"RTN","PSGOE91",59,0)
 ; RBD PSJ*5*373 Soft stop when Start Date more than 7 days after Order's LOGIN DATE
"RTN","PSGOE91",60,0)
 S X1=+$G(PSGDT),X2=+7 D C^%DTC
"RTN","PSGOE91",61,0)
 I +Y>X W !!,$C(7),"Start date/time should not be entered for more than 7 days after the",!,"order's LOGIN DATE.",! K DIR D WAIT^VALM1
"RTN","PSGOE91",62,0)
 ;S (PSGSDX,PSGSD)=+Y,PSGSDN=$$ENDD^PSGMI(PSGSD)_"^"_$$ENDTC^PSGMI(PSGSD) G DONE  ;373
"RTN","PSGOE91",63,0)
 S (PSGSDX,PSGSD)=+Y,PSGSDN=$$ENDD^PSGMI(PSGSD)_"^"_$$ENDTC2^PSGMI(PSGSD) G DONE  ;373
"RTN","PSGOE91",64,0)
 ;
"RTN","PSGOE91",65,0)
34 ; stop date
"RTN","PSGOE91",66,0)
 S MSG=0,PSGF2=34 S:PSGOEEF(PSGF2) BACK="34^PSGOE91"
"RTN","PSGOE91",67,0)
A34 ;
"RTN","PSGOE91",68,0)
 K PSGFDX
"RTN","PSGOE91",69,0)
 I $G(PSJORD),$G(PSGP) I $$COMPLEX^PSJOE(PSGP,PSJORD) S PSGOEE=0 D  G DONE
"RTN","PSGOE91",70,0)
 . W !!?5,"Stop Date/Time may not be edited for active complex orders." D PAUSE^VALM1
"RTN","PSGOE91",71,0)
 N MSG,PSGTMPST S PSGTMPST=$G(PSGST) S:'+$G(PSGRF) PSGRF=$P($G(^PS(50.7,$G(PSGPDRG),4),0),U,1) ;*315 One time orders for MRR's require message to instruct pharmacists
"RTN","PSGOE91",72,0)
 I +$G(PSGRF),$D(^PS(51.1,"AC","PSJ",$G(PSGSCH))) D
"RTN","PSGOE91",73,0)
 . S:PSGTMPST=($G(PSGST)="R") PSGST=$P($G(^PS(51.1,$O(^PS(51.1,"AC","PSJ",$G(PSGSCH),"")),0)),"^",5) ;Handle "Fill on Request"
"RTN","PSGOE91",74,0)
 .Q
"RTN","PSGOE91",75,0)
 I $G(PSGTMPST)="O",+$G(PSGRF) S (PSGFDN,PSGFD)="" D
"RTN","PSGOE91",76,0)
 . I +$G(PSGRF)=1 S MSG(1)="This NOW order has an Orderable Item for which a removal is required" D
"RTN","PSGOE91",77,0)
 .. S MSG(2)=" at the next administration."
"RTN","PSGOE91",78,0)
 .. S MSG(3)="The Stop DATE/TIME entered should be the next anticipated administration for the medication.",MSG(3,"F")="!"
"RTN","PSGOE91",79,0)
 ..Q
"RTN","PSGOE91",80,0)
 . I +$G(PSGRF)=2 S MSG(1)="This NOW order has an Orderable Item for which a removal period is optional",MSG(1,"F")="!!" D
"RTN","PSGOE91",81,0)
 .. S MSG(2)="prior to the next administration.",MSG(2,"F")="!"
"RTN","PSGOE91",82,0)
 .. S MSG(3)="If Early Removal is needed, enter Removal Time in Stop DATE/TIME field.",MSG(3,"F")="!"
"RTN","PSGOE91",83,0)
 .. S MSG(4)="If an Early Removal is not required, the Stop DATE/TIME entered"
"RTN","PSGOE91",84,0)
 .. S MSG(5)="should be the next anticipated administration for the medication.",MSG(5,"F")="!"
"RTN","PSGOE91",85,0)
 ..Q
"RTN","PSGOE91",86,0)
 . I +$G(PSGRF)=3 S MSG(1)="This NOW order has an Orderable Item that requires a removal period prior",MSG(1,"F")="!!" D
"RTN","PSGOE91",87,0)
 .. S MSG(2)=" to the next administration.",MSG(2,"F")="!"
"RTN","PSGOE91",88,0)
 .. S MSG(3)="Please Enter the Stop DATE/TIME to reflect the Removal Time for this medication.",MSG(3,"F")="!"
"RTN","PSGOE91",89,0)
 ..Q
"RTN","PSGOE91",90,0)
 . D EN^DDIOL(.MSG)
"RTN","PSGOE91",91,0)
 .Q
"RTN","PSGOE91",92,0)
 W !,"STOP DATE/TIME: "_$S($P(PSGFDN,"^")]"":$P(PSGFDN,"^")_"// ",1:"") R X:DTIME I X="^"!'$T W:'$T $C(7) S PSGOEE=0 G DONE
"RTN","PSGOE91",93,0)
 I X="",PSGFD W "   "_$P(PSGFDN,"^") G W34
"RTN","PSGOE91",94,0)
 I $E(X)="^" D ENFF^PSGOE92 G:Y>0 @Y G A34
"RTN","PSGOE91",95,0)
 I X="@"!(X?1."?") W:X="@" $C(7),"  (Required)" S:X="@" X="?" D ENHLP^PSGOEM(55.06,34)
"RTN","PSGOE91",96,0)
 I X=+X,(X>0),(X'>2000000) G A34:'$$ENDL^PSGDL(PSGSCH,X) K PSGDLS S PSGDL=X W " ...dose limit..." D ENE^PSGDL
"RTN","PSGOE91",97,0)
 K %DT S %DT="ERTX",%DT(0)=PSGSD D ^%DT K %DT I Y'>0 W $C(7),!!?13,"*** WARNING! INVALID STOP DATE OR PRIOR TO START DATE! ***",! G A34
"RTN","PSGOE91",98,0)
 ; RBD PSJ*5*373 Hard stop when Stop Date more than 367 days after Start Date
"RTN","PSGOE91",99,0)
 S X1=+Y,X2=PSGSD D ^%DTC
"RTN","PSGOE91",100,0)
 I X>367 W $C(7),!!?13,"*** STOP DATE cannot be more than 367 days from START DATE ***",! G A34
"RTN","PSGOE91",101,0)
 ;S (PSGFDX,PSGFD)=+Y,PSGFDN=$$ENDD^PSGMI(PSGFD)_"^"_$$ENDTC^PSGMI(PSGFD)  ;373
"RTN","PSGOE91",102,0)
 S (PSGFDX,PSGFD)=+Y,PSGFDN=$$ENDD^PSGMI(PSGFD)_"^"_$$ENDTC2^PSGMI(PSGFD)  ;373
"RTN","PSGOE91",103,0)
W34 ;Compare to Start Date
"RTN","PSGOE91",104,0)
 N Z,MSG
"RTN","PSGOE91",105,0)
 D DOSE I $G(Z)]"",Z>$S($G(PSGFD):PSGFD,1:$G(PSGNEFD)) D  G A34
"RTN","PSGOE91",106,0)
 . S MSG(1)="There is no administration time that falls between the Start Date/Time"
"RTN","PSGOE91",107,0)
 . S MSG(2)="and the Stop Date/Time."
"RTN","PSGOE91",108,0)
 . D EN^DDIOL(.MSG)
"RTN","PSGOE91",109,0)
 I PSGFD<PSGDT W $C(7),!!?13,"*** WARNING! THE STOP DATE ENTERED IS IN THE PAST! ***",! S MSG=1
"RTN","PSGOE91",110,0)
 Q:+$G(PSGRO)
"RTN","PSGOE91",111,0)
 ;
"RTN","PSGOE91",112,0)
DONE ;
"RTN","PSGOE91",113,0)
 ;Display Expected First Dose;BHW;PSJ*5*136
"RTN","PSGOE91",114,0)
 ;BHW;PSJ*5*179; - Remove EFD call.  Added to PSGOEE.
"RTN","PSGOE91",115,0)
 I PSGOEE G:'PSGOEEF(PSGF2) @BACK S PSGOEE=PSGOEEF(PSGF2)
"RTN","PSGOE91",116,0)
 D:+$G(PSGDUR) VERTIMES ;*315
"RTN","PSGOE91",117,0)
 S:'+$G(PSGRF) PSGRF=$P($G(^PS(50.7,$G(PSGPDRG),4),0),U,1)
"RTN","PSGOE91",118,0)
 K F,F0,F1,PSGF2,F3,PSG,SDT,ORIG Q
"RTN","PSGOE91",119,0)
 ;
"RTN","PSGOE91",120,0)
FF ; up-arrow to another field
"RTN","PSGOE91",121,0)
 D ENFF^PSGOEM I Y>0,Y'=41,Y'=8,Y'=10,Y'=34 S Y=Y_"^PSGOE9"_$S("^109^13^3^7^26^"[("^"_Y_"^"):"",1:2) S:Y=2 FB=PSGF2_"^PSGOE91"
"RTN","PSGOE91",122,0)
 Q
"RTN","PSGOE91",123,0)
 ;
"RTN","PSGOE91",124,0)
DEL ; delete entry
"RTN","PSGOE91",125,0)
 W !?3,"SURE YOU WANT TO DELETE" S %=0 D YN^DICN I %'=1 W $C(7),"  <NOTHING DELETED>"
"RTN","PSGOE91",126,0)
 Q
"RTN","PSGOE91",127,0)
 ;
"RTN","PSGOE91",128,0)
TIMES ;At least one admin time, not more than interval allows.
"RTN","PSGOE91",129,0)
 I $G(PSGST)'="O",($G(PSGST)'="OC"),($G(PSGST)'="R") I X="" D EN^DDIOL("This order requires at least one administration time.") K X Q  ;No times
"RTN","PSGOE91",130,0)
 N H,I,MAX
"RTN","PSGOE91",131,0)
 I PSGSCH]"" I $D(^PS(51.1,"AC","PSJ",PSGSCH)) S H=+$O(^PS(51.1,"AC","PSJ",PSGSCH,0)) S I=$P($G(^PS(51.1,H,0)),"^",3)
"RTN","PSGOE91",132,0)
 I $G(PSGST)="O",$L(X,"-")>1 D EN^DDIOL("This is a One Time Order. Only one administration time is permitted.") K X Q
"RTN","PSGOE91",133,0)
 I $G(PSGST)="O" Q  ;Done validating One Time
"RTN","PSGOE91",134,0)
 I +$G(I)=0 Q  ;No frequency - can not check frequency related items
"RTN","PSGOE91",135,0)
 S MAX=1440/I
"RTN","PSGOE91",136,0)
 I MAX<1,$L(X,"-")>1 D EN^DDIOL("This order requires one administration time.") K X Q
"RTN","PSGOE91",137,0)
 I MAX'<1,$L(X,"-")>MAX D EN^DDIOL("The number of admin times entered is greater than indicated by the schedule.") K X Q  ;Too many times
"RTN","PSGOE91",138,0)
 I MAX'<1,$L(X,"-")<MAX D EN^DDIOL("The number of admin times entered is fewer than indicated by the schedule.")  ;Too few times
"RTN","PSGOE91",139,0)
 Q
"RTN","PSGOE91",140,0)
 ;
"RTN","PSGOE91",141,0)
DOSE ;Make certain at least one dose is given.
"RTN","PSGOE91",142,0)
 N INFO,X
"RTN","PSGOE91",143,0)
 S Z="",INFO=($S($G(PSGSD):PSGSD,1:$G(PSGNESD)))_U_($S($G(PSGFD):PSGFD,1:$G(PSGNEFD)))_U_($G(PSGSCH))_U_($G(PSGST))_U_($G(PSGDRG))_U_($G(PSGS0Y))
"RTN","PSGOE91",144,0)
 Q:$G(PSGST)="OC"!($G(PSGST)="P")
"RTN","PSGOE91",145,0)
 I '$L($G(PSGP)) N PSGP S PSGP=""
"RTN","PSGOE91",146,0)
 S Z=$$ENQ^PSJORP2(PSGP,INFO)  ;Expected first dose.
"RTN","PSGOE91",147,0)
 Q
"RTN","PSGOE91",148,0)
 ;*315 New tags
"RTN","PSGOE91",149,0)
PSGDUR ; Prompt for Removal times if admin times are on 24hr rotations and Site Params are enabled.
"RTN","PSGOE91",150,0)
 ; check parameter files for removal criteria quit if removal rotation not enabled (<2)
"RTN","PSGOE91",151,0)
 ; if enabled determine type (hard vers soft stop)
"RTN","PSGOE91",152,0)
 ;0 = no removal (current cap/tab functionality)
"RTN","PSGOE91",153,0)
 ;1 = removal at next admin (current patch functionality)
"RTN","PSGOE91",154,0)
 ;2 = removal prior to next admin; soft stop (pharmacist optional prompt to designate duration of administration
"RTN","PSGOE91",155,0)
 ;3 = removal prior to next admin; hard stop (pharmacist required prompt to designate duration of administration)
"RTN","PSGOE91",156,0)
 ; prompt for removal if = 2 then allow skip, if = 3 then force entry
"RTN","PSGOE91",157,0)
 ;
"RTN","PSGOE91",158,0)
 S PSGRF=$P($G(^PS(50.7,$G(PSGPDRG),4),0),U,1) Q:((PSGRF<2)!($G(PSGST)="O")!($G(PSGST)="P")!($G(PSGST)="OC"))  ; no removal flag or no removal rotation
"RTN","PSGOE91",159,0)
 Q:$G(PSGS0XT)>1440  ; Duration of Administration valid only for 24 hours - subject to change in future.
"RTN","PSGOE91",160,0)
 N RP,PSGIDF,WMSG,PSGDERR S (PSGIDF,PSGDERR)=0 S:$G(PSGDUR)>0 RP=(PSGDUR/60) S:"BID,TID,QID"[$G(PSGSCH) PSGIDF=1  ; Use separate validation for Times per day type orders
"RTN","PSGOE91",161,0)
 S PSGF2=41
"RTN","PSGOE91",162,0)
 W !,"DURATION OF ADMINISTRATION (HRS): "_$S($G(RP):RP_"// ",1:"") R RP:DTIME I RP="^"!'$T W:'$T $C(7) S PSGDUR=$G(PSGDOA),X="^",PSGOEE=0 Q
"RTN","PSGOE91",163,0)
 I RP="" S:$G(PSGDUR)>0 RP=($G(PSGDUR)/60)
"RTN","PSGOE91",164,0)
 I RP="",$G(PSGS0XT)="D",$L(PSGSCH,"@")=2,$P(PSGSCH,"@",2) S (PSGAT,PSGRMVT)=$P(PSGSCH,"@",2) G 8
"RTN","PSGOE91",165,0)
 I RP="@",PSGRF'=3 D DEL G:%'=1 PSGDUR S PSGS0Y="",(PSGDUR,PSGRMVT)="@",PSGRMV=-1 Q
"RTN","PSGOE91",166,0)
 I (RP'=""),(RP'="@"),($E(RP)'="^"),($E(RP)'="?") S:(RP'?1N.2N)!(+(RP)<1) RP="?"
"RTN","PSGOE91",167,0)
 I RP?1."?" D DURHLP^PSGOEM(RP,PSGRF) G PSGDUR
"RTN","PSGOE91",168,0)
 I $E(RP)="^" D FF G:Y>0 @Y G PSGDUR
"RTN","PSGOE91",169,0)
 I (+RP>0),'PSGIDF D  ; exclude BID,TID or QID schedules
"RTN","PSGOE91",170,0)
 . S PSGDUR=(RP*60),PSGRMV=$G(PSGS0XT)-PSGDUR
"RTN","PSGOE91",171,0)
 . I PSGRMV<1 W !,"DURATION OF ADMINISTRATION MATCHES OR EXCEEDS ORDER FREQUENCY" S RP="",PSGDERR=1 K PSGDUR,PSGRMV G PSGDUR Q
"RTN","PSGOE91",172,0)
 .Q
"RTN","PSGOE91",173,0)
 Q:$G(PSGDERR)=1
"RTN","PSGOE91",174,0)
 I PSGRF=3,(+RP<1) W $C(7),!,"ENTRY IS REQUIRED" S RP="" G PSGDUR
"RTN","PSGOE91",175,0)
 I PSGRF=2,(+RP<1) D
"RTN","PSGOE91",176,0)
 . W !,"You have not entered Duration of Administration for this medication order, "
"RTN","PSGOE91",177,0)
 . W !,"therefore the BCMA user will not be prompted to remove the medication prior "
"RTN","PSGOE91",178,0)
 . W !,"to the next Admin Time."
"RTN","PSGOE91",179,0)
 . S PSGRMV=-1,RP=0
"RTN","PSGOE91",180,0)
 .Q
"RTN","PSGOE91",181,0)
 I PSGIDF,(+RP>0) D  ;Only for TPD schedules
"RTN","PSGOE91",182,0)
 . N F,P,PSGARR
"RTN","PSGOE91",183,0)
 . S PSGADT=$S($G(PSGDUR)=-1:X,$G(PSGS0Y):PSGS0Y,$G(PSGAT):PSGAT,1:""),PSGS0Y=PSGADT
"RTN","PSGOE91",184,0)
 . S PSGARR=$L($G(PSGADT),"-")
"RTN","PSGOE91",185,0)
 . F P=1:1:PSGARR D
"RTN","PSGOE91",186,0)
 .. S PSGARR(P)=($P(PSGADT,"-",P)/100) S:(P>1) F(P)=PSGARR(P)-PSGARR(P-1)
"RTN","PSGOE91",187,0)
 .. I $G(F(P)),($G(F(P))'=RP) S WMSG=1_U_"Duration of Administration does not correspond to one or more",WMSG(1)="of this order's scheduled Administration Times!"
"RTN","PSGOE91",188,0)
 ..Q
"RTN","PSGOE91",189,0)
 .Q
"RTN","PSGOE91",190,0)
 S:(+RP>0) PSGDUR=(RP*60)
"RTN","PSGOE91",191,0)
 W:(+RP>0) ?60,RP," HOURS"
"RTN","PSGOE91",192,0)
 D:$G(WMSG) EN^DDIOL($P(WMSG,U,2)),EN^DDIOL(WMSG(1))
"RTN","PSGOE91",193,0)
 Q
"RTN","PSGOE91",194,0)
 ;
"RTN","PSGOE91",195,0)
VERTIMES ; Redisplay Admin and Removal times *315
"RTN","PSGOE91",196,0)
 S PSGRF=$P($G(^PS(50.7,$G(PSGPDRG),4),0),U,1) Q:(PSGRF<2)!($G(PSGST)="O")
"RTN","PSGOE91",197,0)
 N PSGADT,PSGRARR,PSGAARR
"RTN","PSGOE91",198,0)
 ;If we have a frequency and this is odd type order then we need to start calculations with order start time.
"RTN","PSGOE91",199,0)
 I $G(PSGS0XT),$G(PSGNESD),+$G(PSGDUR),$G(PSGAT)="" D  Q
"RTN","PSGOE91",200,0)
 . N L
"RTN","PSGOE91",201,0)
 . S (PSGAARR,PSGRARR)=1,PSGADT=$P($P(PSGNESD,U,1),".",2),L=$L(PSGADT)
"RTN","PSGOE91",202,0)
 . S PSGRARR(1)=(((((PSGADT*60)+PSGDUR)/60)#24)*100) S:PSGRARR(1)=0 PSGRARR(1)=2400 S:$L(PSGRARR(1))=3 PSGRARR(1)="0"_PSGRARR(1)
"RTN","PSGOE91",203,0)
 . S PSGRARR(1)=$E(PSGRARR(1),1,L)_"(R)"
"RTN","PSGOE91",204,0)
 . S PSGAARR(1)=PSGADT,PSGAARR(1)=$E(PSGAARR(1),1,L)_"(A)"
"RTN","PSGOE91",205,0)
  . D WRITE
"RTN","PSGOE91",206,0)
 .Q
"RTN","PSGOE91",207,0)
 ;
"RTN","PSGOE91",208,0)
 S (PSGRARR,PSGAARR)=$S($G(PSGAT):$L(PSGAT,"-"),1:$L(PSGS0Y,"-"))
"RTN","PSGOE91",209,0)
 N P,L
"RTN","PSGOE91",210,0)
 F P=1:1:PSGRARR D
"RTN","PSGOE91",211,0)
 . S PSGADT=$S($G(PSGAT):$P(PSGAT,"-",P),1:$P(PSGS0Y,"-",P)),L=$L(PSGADT)
"RTN","PSGOE91",212,0)
 . S PSGADT=$S($L(PSGADT)=4:PSGADT/100,1:PSGADT*1)
"RTN","PSGOE91",213,0)
 . S PSGRARR(P)=(((((PSGADT*60)+PSGDUR)/60)#24)*100) S:PSGRARR(P)=0 PSGRARR(P)=2400 S:$L(PSGRARR(P))=3 PSGRARR(P)="0"_PSGRARR(P)
"RTN","PSGOE91",214,0)
 . S PSGRARR(P)=$E(PSGRARR(P),1,L)_"(R)"
"RTN","PSGOE91",215,0)
 . S PSGAARR(P)=(PSGADT*100) S:$L(PSGAARR(P))=3 PSGAARR(P)="0"_PSGAARR(P)
"RTN","PSGOE91",216,0)
 . S PSGAARR(P)=$E(PSGAARR(P),1,L)_"(A)"
"RTN","PSGOE91",217,0)
 .Q
"RTN","PSGOE91",218,0)
 D WRITE
"RTN","PSGOE91",219,0)
 Q
"RTN","PSGOE91",220,0)
 ;
"RTN","PSGOE91",221,0)
WRITE ;
"RTN","PSGOE91",222,0)
 W !!,"Verify Admin and removal times",!
"RTN","PSGOE91",223,0)
 W !,"(A)DMINISTRATION -(R)EMOVAL TIMES"
"RTN","PSGOE91",224,0)
 W !,"___________________________________________________________________________",!
"RTN","PSGOE91",225,0)
 F P=1:1:PSGAARR W PSGAARR(P)_"-"_PSGRARR(P)  W:P'=PSGAARR " , "
"RTN","PSGOE91",226,0)
 D ASK
"RTN","PSGOE91",227,0)
 Q
"RTN","PSGOE91",228,0)
 ;
"RTN","PSGOE91",229,0)
ASK ;
"RTN","PSGOE91",230,0)
 N Y
"RTN","PSGOE91",231,0)
 S DIR("A")="Is this correct",DIR(0)="Y" D ^DIR I $D(DUOUT)!$D(DTOUT) W:'$T $C(7) S PSGOEE=0 K PSGDUR G DONE
"RTN","PSGOE91",232,0)
 I 'Y K X S PSGDUR=-1,PSGFOK(8)="" G A41
"RTN","PSGOE91",233,0)
 N P S P=1,PSGRMVT=$P(PSGRARR(P),"(",1)
"RTN","PSGOE91",234,0)
 F  S P=$O(PSGRARR(P)) Q:P=""  D
"RTN","PSGOE91",235,0)
 . S PSGRMVT=PSGRMVT_"-"_$P(PSGRARR(P),"(",1)
"RTN","PSGOE91",236,0)
 .Q
"RTN","PSGOE91",237,0)
 Q
"RTN","PSGOE91",238,0)
 ;
"RTN","PSGOE92")
0^8^B43075516^B43137679
"RTN","PSGOE92",1,0)
PSGOE92 ;BIR/CML3 - ACTIVE ORDER EDIT (CONT.) ;2/18/10 4:15pm
"RTN","PSGOE92",2,0)
 ;;5.0;INPATIENT MEDICATIONS ;**2,35,50,58,81,110,215,237,276,316,317,366**;16 DEC 97;Build 7
"RTN","PSGOE92",3,0)
 ;
"RTN","PSGOE92",4,0)
 ;Reference to ^DD(53.1 is supported by DBIA #2256.
"RTN","PSGOE92",5,0)
 ;Reference to ^PS(55 is supported by DBIA #2191.
"RTN","PSGOE92",6,0)
 ;Reference to ^PSDRUG is supported by DBIA #2192.
"RTN","PSGOE92",7,0)
 ;Reference to $$GET^XPAR is supported by DBIA #2263
"RTN","PSGOE92",8,0)
 ;
"RTN","PSGOE92",9,0)
1 ; provider
"RTN","PSGOE92",10,0)
 S MSG=0,PSGF2=1 S:PSGOEEF(PSGF2) BACK="1^PSGOE92"
"RTN","PSGOE92",11,0)
A1 I $G(PSJORD),$G(PSGP) I $$COMPLEX^PSJOE(PSGP,PSJORD) S PSGOEE=0 D  G DONE
"RTN","PSGOE92",12,0)
 . W !!?5,"Provider may not be edited for active complex orders." D PAUSE^VALM1
"RTN","PSGOE92",13,0)
 W !,"PROVIDER: ",$S(PSGPR:PSGPRN_"// ",1:"") R X:DTIME I X="^"!'$T W:'$T $C(7) S PSGOEE=0 G DONE
"RTN","PSGOE92",14,0)
 I $S(X="":'PSGPR,1:X="@") W $C(7),"  (Required)" S X="?" D ENHLP^PSGOEM(55.06,1) G A1
"RTN","PSGOE92",15,0)
 I X="",PSGPR S X=PSGPRN I PSGPR'=PSGPRN,$D(^VA(200,PSGPR,"PS")) W:0 "    "_$P(^("PS"),"^",2)_"    "_$P(^("PS"),"^",3) G DONE
"RTN","PSGOE92",16,0)
 I X?1."?" D ENHLP^PSGOEM(55.06,1)
"RTN","PSGOE92",17,0)
 I $E(X)="^" D ENFF G:Y>0 @Y G A1
"RTN","PSGOE92",18,0)
 ;*366 - check provider credentials
"RTN","PSGOE92",19,0)
 K DIC S DIC="^VA(200,",DIC(0)="EMQZ",DIC("S")="I $$ACTPRO^PSGOE1(+Y)" D ^DIC K DIC I Y'>0 G A1
"RTN","PSGOE92",20,0)
 S PSGPR=+Y,PSGPRN=Y(0,0) G DONE
"RTN","PSGOE92",21,0)
 ;
"RTN","PSGOE92",22,0)
5 ; self med
"RTN","PSGOE92",23,0)
 I $G(PSJORD),$G(PSGP) I $$COMPLEX^PSJOE(PSGP,PSJORD) S PSGOEE=0 D  G DONE
"RTN","PSGOE92",24,0)
 . W !!?5,"Self Med may not be edited for active complex orders." D PAUSE^VALM1
"RTN","PSGOE92",25,0)
 S MSG=0,PSGF2=5 S:PSGOEEF(PSGF2) BACK="5^PSGOE92" K PSGOEEF(6) S:PSGSM PSGOEEF(6)=""
"RTN","PSGOE92",26,0)
A5 W !,"SELF MED: " W:PSGSM]"" $P("NO^YES","^",PSGSM+1),"// " R X:DTIME I X="^"!'$T W:'$T $C(7) S PSGOEE=0 G DONE
"RTN","PSGOE92",27,0)
 I "01"[X,$L(X)<2 S:X]"" PSGSM=+X W:PSGSM]"" "  (",$P("NO^YES","^",PSGSM+1),")" G:'PSGSM DONE S PSGOEEF(6)="" G 6
"RTN","PSGOE92",28,0)
 I X="@" W $C(7),"  (Required)" G A5
"RTN","PSGOE92",29,0)
 I X?1"^".E D ENFF G:Y>0 @Y G A5
"RTN","PSGOE92",30,0)
 I X?1."?" D ENHLP^PSGOEM(55.06,5) G A5
"RTN","PSGOE92",31,0)
 D YN I  S PSGSM=$E(X)="Y" K PSGOEEF(6) G:'PSGSM DONE S PSGOEEF(6)="" G 6
"RTN","PSGOE92",32,0)
 W $C(7) D ENHLP^PSGOEM(55.06,5) G A5
"RTN","PSGOE92",33,0)
 ;
"RTN","PSGOE92",34,0)
6 ; hospital supplied self med
"RTN","PSGOE92",35,0)
 S MSG=0,PSGF2=6 S:PSGOEEF(PSGF2) BACK="6^PSGOE92"
"RTN","PSGOE92",36,0)
A6 I $G(PSJORD),$G(PSGP) I $$COMPLEX^PSJOE(PSGP,PSJORD) S PSGOEE=0 D  G DONE
"RTN","PSGOE92",37,0)
 . W !!?5,"Hospital Supplied Self Med may not be edited for active complex orders." D PAUSE^VALM1
"RTN","PSGOE92",38,0)
 W !,"HOSPITAL SUPPLIED SELF MED: " W:PSGHSM]"" $P("NO^YES","^",PSGHSM+1),"// " R X:DTIME I X="^"!'$T W:'$T $C(7) S PSGOEE=0 G DONE
"RTN","PSGOE92",39,0)
 I "01"[X,$L(X)=1 S:X]"" PSGHSM=+X W "  (",$P("NO^YES","^",PSGHSM+1),")" S MSG=0,PSGF2=5 G DONE
"RTN","PSGOE92",40,0)
 I X="@" W $C(7),"  (Required)" G A6
"RTN","PSGOE92",41,0)
 I X?1"^".E D ENFF G:Y>0 @Y G A6
"RTN","PSGOE92",42,0)
 I X?1."?" D ENHLP^PSGOEM(55.06,6) G A6
"RTN","PSGOE92",43,0)
 D YN I  S PSGHSM=$E(X)="Y" S MSG=0,PSGF2=5 G DONE
"RTN","PSGOE92",44,0)
 W $C(7) D ENHLP^PSGOEM(55.06,6) G A6
"RTN","PSGOE92",45,0)
 ;
"RTN","PSGOE92",46,0)
2 ; dispense drug multiple
"RTN","PSGOE92",47,0)
 ;*276 - Disallow unauthorized nurses from editing Dispense Drug
"RTN","PSGOE92",48,0)
 I '$P($G(PSJSYSU),";",4) W !,"You are not authorized to edit Dispense Drugs." D PAUSE^VALM1 Q
"RTN","PSGOE92",49,0)
 I $G(PSGP),$G(PSGORD) I $$COMPLEX^PSJOE(PSGP,PSGORD) D
"RTN","PSGOE92",50,0)
 . N X,Y,PARENT,P2ND S P2ND=$S(PSGORD["U":$G(^PS(55,PSGP,5,+PSGORD,.2)),1:$G(^PS(53.1,+PSGORD,.2))),PARENT=$P(P2ND,"^",8)
"RTN","PSGOE92",51,0)
 . I PARENT D FULL^VALM1 W !!?5,"This order is part of a complex order. Please review the following ",!?5,"associated orders before changing this order." D CMPLX^PSJCOM1(PSGP,PARENT,PSGORD)
"RTN","PSGOE92",52,0)
 S MSG=0,PSGF2=2,BACK="2^PSGOE92",PSGOEEND=1
"RTN","PSGOE92",53,0)
 NEW PSGX,PSGXX F PSGXX=0:0 S PSGX=PSGXX,PSGXX=$O(^PS(53.45,PSJSYSP,2,PSGXX)) Q:'PSGXX
"RTN","PSGOE92",54,0)
 K PSGXX
"RTN","PSGOE92",55,0)
 ; PSJ*5*317 - If PSJ PADE OE BALANCES parameter is YES, PADE balances should display as identifier.
"RTN","PSGOE92",56,0)
 N PSJPADLK S PSJPADLK=0  ; Flag indicating PADE drug lookup was done, don't do drug lookup twice - PSJ*5*317
"RTN","PSGOE92",57,0)
 I $$GET^XPAR("SYS","PSJ PADE OE BALANCES") D
"RTN","PSGOE92",58,0)
 .N DA,DIC,DIE,DR,DIR,PSJLOC,PSJDRG,PSJDDC,PSJORD,DFN,PSJORCL,PSJCLNK,PSJCLND
"RTN","PSGOE92",59,0)
 .; If clinic order, quit if clinic location is not linked to PADE
"RTN","PSGOE92",60,0)
 .S PSJCLND=$S($G(PSGORD)["P":$G(^PS(53.1,+$G(PSGORD),"DSS")),$G(PSGORD)["U":$G(^PS(55,+$G(PSGP),5,+$G(PSGORD),8)),$G(PSGORD)["V":$G(^PS(55,+$G(PSGP),"IV",+$G(PSGORD),"DSS")),1:"")
"RTN","PSGOE92",61,0)
 .S PSJORCL=$S(PSJCLND&$P(PSJCLND,"^",2):+PSJCLND_"C",1:"")
"RTN","PSGOE92",62,0)
 .;S PSJORCL=$S($G(PSGORD)["P":$G(^PS(53.1,+$G(PSGORD),"DSS")),$G(PSGORD)["U":$G(^PS(55,+$G(PSGP),5,+$G(PSGORD),8)),$G(PSGORD)["V":$G(^PS(55,+$G(PSGP),"IV",+$G(PSGORD),"DSS")),1:"")
"RTN","PSGOE92",63,0)
 .I PSJORCL S PSJCLNK=$$PADECL^PSJPAD50(+$G(PSJORCL)) Q:'PSJCLNK
"RTN","PSGOE92",64,0)
 .I '$G(PSJCLNK) Q:'$$PADEWD^PSJPAD50(+$G(VAIN(4)))
"RTN","PSGOE92",65,0)
 .S DFN=$G(PSGP),PSJORD=$G(PSGORD)
"RTN","PSGOE92",66,0)
 .S PSJDDC=0 F  S PSJDDC=$O(^PS(53.45,PSJSYSP,2,PSJDDC)) Q:'PSJDDC  S PSJDRG(PSJDDC)=^(PSJDDC,0)
"RTN","PSGOE92",67,0)
 .S PSJLOC=$S($G(PSJORD)["U":+$G(^PS(55,DFN,5,+PSJORD,8))_"C",$G(PSJORD)["P":+$G(^PS(53.1,+PSJORD,"DSS"))_"C",1:"")
"RTN","PSGOE92",68,0)
 .S:'PSJLOC PSJLOC=+$G(VAIN(4)) I '$G(PSJLOC) D
"RTN","PSGOE92",69,0)
 ..N VAIN D INP^VADPT S PSJLOC=$G(VAIN(4))
"RTN","PSGOE92",70,0)
 .S PSJPADLK=1
"RTN","PSGOE92",71,0)
 .D READDD^PSJPAD50(.PSJDRG,$G(PSGPDRG),PSJLOC,PSJORD,$G(PSGORD))
"RTN","PSGOE92",72,0)
 ; PSJ*5*317 - If PSJ PADE OE BALANCES parameter is NO, PADE balances should NOT display as identifer.
"RTN","PSGOE92",73,0)
 I '$G(PSJPADLK) N DA,DIE,DR S DIE="^PS(53.45,",DA=PSJSYSP,DR=2,DR(2,53.4502)=".02//1;.03" D ^DIE
"RTN","PSGOE92",74,0)
 I '$O(^PS(53.45,PSJSYSP,2,0)) W $C(7),!!,"WARNING: This order must have at least one dispense drug before pharmacy can",!?9,"verify it!",! S MSG=1
"RTN","PSGOE92",75,0)
 D DDOC^PSGOE82(PSGX) ;* Perform allergy/adv. reaction order checks
"RTN","PSGOE92",76,0)
 NEW PSJDOSE
"RTN","PSGOE92",77,0)
 D DOSECHK^PSJDOSE
"RTN","PSGOE92",78,0)
 I +$G(PSJDSFLG) D DSPWARN^PSJDOSE S:$G(PSGOEEF(109))="" PSGOEEF(109)=1 ; PSJ*5*237 - Check PSGOEEF(109) to prevent infinite loop
"RTN","PSGOE92",79,0)
 ; PSJ*5*215 - If Dispense Drug(s) changed, make entry in Activity Log.
"RTN","PSGOE92",80,0)
 ; Compare the edited dispense drug information in ^PS(53.45 to the active
"RTN","PSGOE92",81,0)
 ; order dispense drug information in ^PS(55.
"RTN","PSGOE92",82,0)
 S (PSJDDTMP,PSJDD55,PSJDTMP1,PSJDD551)=""
"RTN","PSGOE92",83,0)
 F PSJDDTMP=0:0 S PSJDDTMP=$O(^PS(53.45,PSJSYSP,2,PSJDDTMP)) Q:'PSJDDTMP  D
"RTN","PSGOE92",84,0)
 . S PSJDDTMP(PSJDDTMP)=$G(^PS(53.45,PSJSYSP,2,PSJDDTMP,0))
"RTN","PSGOE92",85,0)
 . S PSJDTMP1="Disp Drug: "_"("_$P($G(PSJDDTMP(PSJDDTMP)),"^",1)_") "_$P($G(^PSDRUG($P($G(PSJDDTMP(PSJDDTMP)),"^",1),0)),"^")_" Units: "_$P($G(PSJDDTMP(PSJDDTMP)),"^",2)_" "
"RTN","PSGOE92",86,0)
 F PSJDD55=0:0 S PSJDD55=$O(^PS(55,DFN,5,+ON,1,PSJDD55)) Q:'PSJDD55  D
"RTN","PSGOE92",87,0)
 . S PSJDD55(PSJDD55)=$G(^PS(55,DFN,5,+ON,1,PSJDD55,0))
"RTN","PSGOE92",88,0)
 . S PSJDD551="Disp Drug: "_"("_$P($G(PSJDD55(PSJDD55)),"^",1)_") "_$P($G(^PSDRUG($P($G(PSJDD55(PSJDD55)),"^",1),0)),"^")_" Units: "_$P($G(PSJDD55(PSJDD55)),"^",2)_" "
"RTN","PSGOE92",89,0)
 ; If the two temporary strings PSJDTMP1 and PSJDD551 do not match each other exactly
"RTN","PSGOE92",90,0)
 ; then an edit has been made to the Dispense Drug Field.  Make a new entry in
"RTN","PSGOE92",91,0)
 ; the Activity Log for this order.
"RTN","PSGOE92",92,0)
 I PSJDTMP1'=PSJDD551 D NEWUDAL^PSGAL5(DFN,+ON,6000,"Dispense Drug",PSJDD551)
"RTN","PSGOE92",93,0)
 K PSGOEEND,PSJDDTMP,PSJDTMP1,PSJDD55,PSJDD551 G DONE
"RTN","PSGOE92",94,0)
 ;
"RTN","PSGOE92",95,0)
15 ; comments
"RTN","PSGOE92",96,0)
 I $G(PSJORD),$G(PSGP) I $$COMPLEX^PSJOE(PSGP,PSJORD) S PSGOEE=0 D  G DONE
"RTN","PSGOE92",97,0)
 . W !!?5,"Comments may not be edited for active complex orders." D PAUSE^VALM1
"RTN","PSGOE92",98,0)
 S MSG=0,PSGF2=15,BACK="15^PSGOE92",DA=PSJSYSP,DR=1,DIE="^PS(53.45," D ^DIE W ! G DONE
"RTN","PSGOE92",99,0)
 ;
"RTN","PSGOE92",100,0)
72 ; provider comments
"RTN","PSGOE92",101,0)
 ;
"RTN","PSGOE92",102,0)
DONE ;
"RTN","PSGOE92",103,0)
 I PSGOEE G:'PSGOEEF(PSGF2) @BACK S PSGOEE=PSGOEEF(PSGF2)
"RTN","PSGOE92",104,0)
 K F,F0,PSGF2,F3,PSG,SDT Q
"RTN","PSGOE92",105,0)
 ;
"RTN","PSGOE92",106,0)
ENFF ; up-arrow to another field
"RTN","PSGOE92",107,0)
 S Y=-1 I '$D(PSGOEEF) W $C(7),"  ??" Q
"RTN","PSGOE92",108,0)
 S X=$E(X,2,99) I X=+X S Y=$S($D(PSGOEEF(X)):X,1:-1) W "  " W:Y>0 $$CODES2^PSIVUTL(53.1,X) W:Y'>0 $C(7),"??" Q
"RTN","PSGOE92",109,0)
 K DIC S DIC="^DD(53.1,",DIC(0)="QEM",DIC("S")="I $D(PSGOEEF(+Y))" D ^DIC K DIC S Y=+Y S:Y>0 Y=$P($T(@("F"_Y)),";",3) Q
"RTN","PSGOE92",110,0)
 ;
"RTN","PSGOE92",111,0)
DEL ; delete entry
"RTN","PSGOE92",112,0)
 W !?3,"SURE YOU WANT TO DELETE" S %=0 D YN^DICN I %'=1 W $C(7),"  <NOTHING DELETED>"
"RTN","PSGOE92",113,0)
 Q
"RTN","PSGOE92",114,0)
 ;
"RTN","PSGOE92",115,0)
YN ; yes/no as a set of codes
"RTN","PSGOE92",116,0)
 I X'?.U F Y=1:1:$L(X) I $E(X,Y)?1L S X=$E(X,1,Y-1)_$C($A(X,Y)-32)_$E(X,Y+1,$L(X))
"RTN","PSGOE92",117,0)
 F Y="NO","YES" I $P(Y,X)="" W $P(Y,X,2) Q
"RTN","PSGOE92",118,0)
 Q
"RTN","PSGOE92",119,0)
 ;
"RTN","PSGOE92",120,0)
F101 ;;101^PSGOE9
"RTN","PSGOE92",121,0)
F109 ;;109^PSGOE9
"RTN","PSGOE92",122,0)
F3 ;;3^PSGOE9
"RTN","PSGOE92",123,0)
F7 ;;7^PSGOE9
"RTN","PSGOE92",124,0)
PSGF26 ;;26^PSGOE9
"RTN","PSGOE92",125,0)
F41 ;;41^PSGOE91
"RTN","PSGOE92",126,0)
F8 ;;8^PSGOE91
"RTN","PSGOE92",127,0)
F10 ;;10^PSGOE91
"RTN","PSGOE92",128,0)
F34 ;;34^PSGOE91
"RTN","PSGOE92",129,0)
F1 ;;1^PSGOE92
"RTN","PSGOE92",130,0)
F5 ;;5^PSGOE92
"RTN","PSGOE92",131,0)
PSGF2 ;;2^PSGOE92
"RTN","PSGOEE")
0^22^B108119491^B107177603
"RTN","PSGOEE",1,0)
PSGOEE ;BIR/CML3 - EDIT ACTIVE OR NON-VERIFIED ORDERS ;Jul 02, 2018@09:18
"RTN","PSGOEE",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**4,7,29,47,64,58,82,91,110,111,112,142,179,181,254,267,268,281,315,338,373,366**;16 DEC 97;Build 7
"RTN","PSGOEE",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PSGOEE",4,0)
 ;
"RTN","PSGOEE",5,0)
 ; Reference to ^PS(55 is supported by DBIA# 2191.
"RTN","PSGOEE",6,0)
 ; Reference to ^PSSLOCK is supported by DBIA# 2789.
"RTN","PSGOEE",7,0)
 ; Reference to ^TMP("PSODAOC",$J is supported by DBIA# 6071.
"RTN","PSGOEE",8,0)
 ;
"RTN","PSGOEE",9,0)
 D NOW^%DTC S PSGDT=% K PSGEFN,PSGOEEF S PSGOEEF=0 I PSGORD["A"!(PSGORD["O") G ACT
"RTN","PSGOEE",10,0)
531 ; edit orders in 53.1
"RTN","PSGOEE",11,0)
ENF ; Entry point
"RTN","PSGOEE",12,0)
 D EN2^PSGOEEW
"RTN","PSGOEE",13,0)
 K PSJACEPT D EDLOOP G:'$G(PSJACEPT) OUT
"RTN","PSGOEE",14,0)
 I $G(PSGOEENO) D
"RTN","PSGOEE",15,0)
 . N PSGOEENO S PSGOEENO=1 D NEW
"RTN","PSGOEE",16,0)
 E  D
"RTN","PSGOEE",17,0)
 . N PSGOEENO S PSGOEENO=0 D UPD
"RTN","PSGOEE",18,0)
 I $G(PSGOEAV) D ACT1 Q
"RTN","PSGOEE",19,0)
 D DONE1
"RTN","PSGOEE",20,0)
 S PSGOEEF=0,PSJORD=PSGORD D GETUD^PSJLMGUD(PSGP,PSGORD),ENSFE^PSGOEE0(PSGP,PSGORD)
"RTN","PSGOEE",21,0)
 Q
"RTN","PSGOEE",22,0)
ACT ; Perform Edit
"RTN","PSGOEE",23,0)
 NEW PSJALGY1,PSGSDEDT
"RTN","PSGOEE",24,0)
 K PSGOEER
"RTN","PSGOEE",25,0)
 D EN2^PSGOEEW,EDLOOP G:'$G(PSJACEPT) OUT
"RTN","PSGOEE",26,0)
 I $G(PSGOEENO) D
"RTN","PSGOEE",27,0)
 . N PSGOEENO S PSGOEENO=1 D NEW
"RTN","PSGOEE",28,0)
 E  D
"RTN","PSGOEE",29,0)
 . N PSGOEENO S PSGOEENO=0 D UPD
"RTN","PSGOEE",30,0)
 S:$D(PSGOEF)!$G(PSGOEENO) PSGCANFL=-1
"RTN","PSGOEE",31,0)
ACT1 ; Continue editing
"RTN","PSGOEE",32,0)
 D DONE1
"RTN","PSGOEE",33,0)
 S PSGOEEF=0 D GETUD^PSJLMGUD(PSGP,PSGORD),ENSFE^PSGOEE0(PSGP,PSGORD) D:PSGOEAV UNL^PSSLOCK(PSGP,PSGORD)
"RTN","PSGOEE",34,0)
 Q
"RTN","PSGOEE",35,0)
EDIT ; Edit
"RTN","PSGOEE",36,0)
 I $G(Y) D ASKOVR(Y,$G(PSGORD),.PSJSTARI)
"RTN","PSGOEE",37,0)
 D FULL^VALM1
"RTN","PSGOEE",38,0)
 W ! S PSGOEER="" F Q=1:1 S Q1=$P(Y,",",Q) Q:'Q1  S X=$P($T(@(PSGOEEG_Q1)),";",3),PSGOEER=PSGOEER_X_";",PSGOEEF(+X)=Q S:Q1=1 PSJALGY1=1
"RTN","PSGOEE",39,0)
 S LIMIT=$L(PSGOEER,";")-1,(PSGDEF,PSGOEE)=0 F  S PSGOEE=PSGOEE+1 Q:PSGOEE>LIMIT  I +$P(PSGOEER,";",PSGOEE)=101 S PSGDEF=1
"RTN","PSGOEE",40,0)
 S PSGOEER=$E(PSGOEER,1,$L(PSGOEER)-1),(MSG,PSGOEE)=0 F  S PSGOEE=PSGOEE+1 Q:PSGOEE>$L(PSGOEER,";")  S F1=$S(PSGOEEG=3:53.1,1:55.06) I 'PSGDEF!((PSGDEF)&(+$P(PSGOEER,";",PSGOEE)'=2)) D @$P(PSGOEER,";",PSGOEE) Q:'PSGOEE
"RTN","PSGOEE",41,0)
 Q
"RTN","PSGOEE",42,0)
EDLOOP ; Continue prompting for fields to edit.
"RTN","PSGOEE",43,0)
 K PSJNOO
"RTN","PSGOEE",44,0)
 D:$G(Y) EDIT I $G(PSGOROE1)=1!($G(PSGOEE)=0) S VALMBCK="R",(PSGOROE1,PSJACEPT)=0 Q
"RTN","PSGOEE",45,0)
 D ENNOU^PSGOEE0 I '$G(PSGOEENO),DR="" S VALMBCK="R" Q
"RTN","PSGOEE",46,0)
 K VALMSG
"RTN","PSGOEE",47,0)
 I '$G(PSGOEENO),$G(PSGPDNX) D CKDT
"RTN","PSGOEE",48,0)
 I $G(PSGOEENO) D
"RTN","PSGOEE",49,0)
 .S VALMSG="This change will cause a new order to be created." D GTSTATUS,CHKDD,CKDT
"RTN","PSGOEE",50,0)
 .;S PSGEBN=$$ENNPN^PSGMI(DUZ),PSGLIN=$$ENDD^PSGMI(PSGDT)_U_$$ENDTC^PSGMI(PSGDT)  ;373
"RTN","PSGOEE",51,0)
 .S PSGEBN=$$ENNPN^PSGMI(DUZ),PSGLIN=$$ENDD^PSGMI(PSGDT)_U_$$ENDTC2^PSGMI(PSGDT)  ;373
"RTN","PSGOEE",52,0)
 D CHK^PSGOEV("^^"_PSGMR_"^^^^"_PSGST,PSGPDRG_U_PSGDO,PSGSCH_U_PSGSD_"^^"_PSGFD)
"RTN","PSGOEE",53,0)
 K VALMBCK,PSJACEPT,PSGPDNX D EN^VALM("PSJU LM ACCEPT") Q:'$G(PSJACEPT)
"RTN","PSGOEE",54,0)
 I $G(PSGS0XT)="D",'$G(PSGS0Y) I ((",P,R,")'[(","_$G(PSGST)_",")) D  Q
"RTN","PSGOEE",55,0)
 .S PSJACEPT=0 W !!,"This is a 'DAY OF THE WEEK' schedule and MUST have admin times." D PAUSE^VALM1
"RTN","PSGOEE",56,0)
 I ($G(PSGOEER)["26^PSGOE9")!($G(PSGOEER)["26^PSGOE8")!($G(PSGOEER)["109^PSGOE9")!($G(PSGOEER)["109^PSGOE8")!($G(PSGOEER)["3^PSGOE9")!($G(PSGOEER)["3^PSGOE8")!($G(PSGOEER)["101^PSGOE9")!($G(PSGOEER)["101^PSGOE8") S PSGOEENO=1
"RTN","PSGOEE",57,0)
 I $G(PSGOEENO)!($G(PSGOEER)["2^PSGOE92")!($G(PSGOEER)["2^PSGOE82") D OC S:($G(PSGOEER)["2^PSGOE82") PSJDSVFY=1
"RTN","PSGOEE",58,0)
 I $G(PSGORQF) S PSJNOO=-1
"RTN","PSGOEE",59,0)
 I '$G(PSJNOO),$G(PSGOEENO) S PSJNOO=$$ENNOO^PSJUTL5("E")
"RTN","PSGOEE",60,0)
 D K1 S PSJACEPT=$S($G(PSJNOO)<0:0,1:1)
"RTN","PSGOEE",61,0)
 S VALMBCK=$S('PSJACEPT:"R",'PSGOEAV:"R",1:"Q")
"RTN","PSGOEE",62,0)
 Q
"RTN","PSGOEE",63,0)
OC ;Perform OC (only when OI or Dosage was edited) & dosing check
"RTN","PSGOEE",64,0)
 NEW PSJDD,PSJALLGY
"RTN","PSGOEE",65,0)
 K PSGORQF
"RTN","PSGOEE",66,0)
 D FULL^VALM1
"RTN","PSGOEE",67,0)
 S PSJDD=+$$DD53P45^PSJMISC() I 'PSJDD S PSGORQF=1 Q
"RTN","PSGOEE",68,0)
 I $G(PSJALGY1)!$G(PSGOEENO) D
"RTN","PSGOEE",69,0)
 . D ENDDC^PSGSICHK(PSGP,PSJDD)
"RTN","PSGOEE",70,0)
 D:'$G(PSGORQF) IN^PSJOCDS($G(PSGORD),"UD",PSJDD)
"RTN","PSGOEE",71,0)
 Q
"RTN","PSGOEE",72,0)
CHKDD ;*** Check inactive Dispense drug within the order.
"RTN","PSGOEE",73,0)
 D CHKDRG^PSGOE2
"RTN","PSGOEE",74,0)
 Q
"RTN","PSGOEE",75,0)
CKDT ; Check if new start/stop dates should be calculated.
"RTN","PSGOEE",76,0)
 I $G(PSGSDEDT) Q  ; Start/Stop Date Manually edited
"RTN","PSGOEE",77,0)
 S PSGS0Y=$S($D(PSGS0Y):PSGS0Y,1:$G(PSGAT))
"RTN","PSGOEE",78,0)
 ;PSJ*5*179 Recalc start date if Before last given
"RTN","PSGOEE",79,0)
 I ($P($G(PSBSTR),"^")>PSGSD)!('$G(PSGNEWDT)&(PSGSD=$G(PSGOSD))&(PSGFD=$G(PSGOFD)))!($G(PSGOST)'=PSGST)!(PSGSCH'=$G(PSGOSCH))!($G(PSGPDNX)) D
"RTN","PSGOEE",80,0)
 .N PSGOES S PSGOES=1,PSGOFD=PSGFD D ^PSGNE3 I $G(PSGOFD) S PSGNEFD=PSGFD
"RTN","PSGOEE",81,0)
 .;S PSGSD=PSGNESD,PSGSDN=$$ENDD^PSGMI(PSGNESD)_U_$$ENDTC^PSGMI(PSGNESD),PSGFD=PSGNEFD,PSGFDN=$$ENDD^PSGMI(PSGNEFD)_U_$$ENDTC^PSGMI(PSGNEFD),PSGNEWDT=1  ;373
"RTN","PSGOEE",82,0)
 .S PSGSD=PSGNESD,PSGSDN=$$ENDD^PSGMI(PSGNESD)_U_$$ENDTC2^PSGMI(PSGNESD),PSGFD=PSGNEFD,PSGFDN=$$ENDD^PSGMI(PSGNEFD)_U_$$ENDTC2^PSGMI(PSGNEFD),PSGNEWDT=1  ;373
"RTN","PSGOEE",83,0)
 .I $D(PSGOFD),PSGOFD]"",PSGFD'=PSGOFD S PSGOEEF(25)=1
"RTN","PSGOEE",84,0)
 .I $D(PSGOSD),PSGOSD]"",PSGSD'=PSGOSD S PSGOEEF(10)=1
"RTN","PSGOEE",85,0)
 ;BHW;PSJ*5*179;Add EFD call here, removed from PSGOE91
"RTN","PSGOEE",86,0)
 D EFDACT^PSJUTL
"RTN","PSGOEE",87,0)
 Q
"RTN","PSGOEE",88,0)
NEW3 ;
"RTN","PSGOEE",89,0)
 ;S:PSGOEAV PSGOEAV="0^1"
"RTN","PSGOEE",90,0)
NEW ;
"RTN","PSGOEE",91,0)
 I $D(^PS(53.45,+$G(PSJSYSP),5)) N PSJFSI S PSJFSI=1 D FILESI^PSJBCMA5(DFN,PSGORD) N SIARRAY S SIARRAY="" D
"RTN","PSGOEE",92,0)
 .I PSGORD["P" M SIARRAY=^PS(53.1,+PSGORD,15) D NEWNVAL^PSGAL5(PSGORD,6000,"SPECIAL INSTRUCTIONS",,.SIARRAY)
"RTN","PSGOEE",93,0)
 .I PSGORD["U" M SIARRAY=^PS(55,DFN,5,+PSGORD,15) D NEWUDAL^PSGAL5(PSGORD,6000,"SPECIAL INSTRUCTIONS",,.SIARRAY)
"RTN","PSGOEE",94,0)
 W !,"...discontinuing original order..."
"RTN","PSGOEE",95,0)
 I PSGORD["P" S PSJCOM=+$P($G(^PS(53.1,+PSGORD,.2)),"^",8) I PSJCOM D NEW^PSJCOM1 Q
"RTN","PSGOEE",96,0)
 ;DC and Unlock order.
"RTN","PSGOEE",97,0)
 S PSGEDIT="DE" D ENOR^PSGOECS,UNL^PSSLOCK(PSGP,PSGORD) K PSGEDIT
"RTN","PSGOEE",98,0)
 W !!," ...creating new order..." W:'PSGOEAV "(you will now work on this new order)"
"RTN","PSGOEE",99,0)
 S PSGS0Y=PSGAT,PSGNESD=PSGSD,PSGNEFD=PSGFD,PSGOEPR=PSGPR,PSGPDRG=PSGPD,PSGPDRGN=PSGPDN,PSGOEE="E"
"RTN","PSGOEE",100,0)
 S PSGOORD=PSGORD D ^PSGOETO K PSGOEOS
"RTN","PSGOEE",101,0)
 I PSGOORD["U" S $P(^PS(55,PSGP,5,+PSGOORD,0),"^",26,27)=PSGORD_"^E"
"RTN","PSGOEE",102,0)
 E  S $P(^PS(53.1,+PSGOORD,0),"^",26,27)=PSGORD_"^E"
"RTN","PSGOEE",103,0)
 I $G(PSJFSI) I $$GETSI^PSJBCMA5(DFN,PSGOORD) D FILESI^PSJBCMA5(DFN,PSGORD)
"RTN","PSGOEE",104,0)
 I 'PSGOEAV,($G(PSGORD)["P"),'$G(^PS(53.1,+PSGORD,2.5)),$G(^PS(53.1,+PSGORD,0)) D
"RTN","PSGOEE",105,0)
 . N DUR S DUR=$$GETDUR^PSJLIVMD(PSGP,PSGORD,$S(PSGORD["P":"P",1:5),1) I DUR]"" K DA,DR,DIE S DIE="^PS(53.1,",DA=+PSGORD,DR="116////"_DUR D ^DIE
"RTN","PSGOEE",106,0)
 I PSGOEAV D
"RTN","PSGOEE",107,0)
 . S ^TMP("PSODAOC",$J,"IP IEN")=PSGORD
"RTN","PSGOEE",108,0)
 . D SETOC^PSJNEWOC(PSGORD) ;PSJ*5*281 stores order checks
"RTN","PSGOEE",109,0)
 I PSGOEAV,+PSJSYSU=3,'$D(PSGOES) D EN^PSGPEN(PSGORD),UNL^PSSLOCK(PSGP,PSGORD) Q
"RTN","PSGOEE",110,0)
 S PSJORD=PSGORD,PSGACT=$$ENACTION^PSGOE1(PSGP,PSGORD)
"RTN","PSGOEE",111,0)
 ;K ^TMP("PSODAOC",$J),^TMP("PSJDAOC",$J)
"RTN","PSGOEE",112,0)
 Q
"RTN","PSGOEE",113,0)
UPD ;
"RTN","PSGOEE",114,0)
 K DA W !!,"...updating order..."
"RTN","PSGOEE",115,0)
 I PSGORD["P" S PSJCOM=+$P($G(^PS(53.1,+PSGORD,.2)),"^",8) I PSJCOM D UPD^PSJCOM Q
"RTN","PSGOEE",116,0)
 I $$DIFFSI^PSJBCMA5(DFN,PSGORD) D
"RTN","PSGOEE",117,0)
 .N SIARRAY M:PSGORD["P" SIARRAY=^PS(53.1,+PSGORD,15) M:PSGORD["U" SIARRAY=^PS(55,DFN,5,+PSGORD,15)
"RTN","PSGOEE",118,0)
 .Q:'$D(SIARRAY)
"RTN","PSGOEE",119,0)
 .I PSGORD["P" D NEWNVAL^PSGAL5(PSGORD,6000,"SPECIAL INSTRUCTIONS",,.SIARRAY)
"RTN","PSGOEE",120,0)
 .I PSGORD["U" D NEWUDAL^PSGAL5(DFN,PSGORD,6000,"SPECIAL INSTRUCTIONS",,.SIARRAY)
"RTN","PSGOEE",121,0)
 ; Set trigger for FIELD (12) Dispense Drug to print a updated pick list.
"RTN","PSGOEE",122,0)
 I PSGORD["U",$D(^PS(53.45,PSJSYSP,2,1,0)),$D(^PS(55,PSGP,5,+PSGORD,1,1,0)) D
"RTN","PSGOEE",123,0)
 .N PSJX12,PSJF12 S PSJF12=0
"RTN","PSGOEE",124,0)
 .F PSJX12=0:1 S PSJX12=$O(^PS(53.45,PSJSYSP,2,PSJX12)) Q:+PSJX12=0  S:$G(^PS(53.45,PSJSYSP,2,PSJX12,0))'=$G(^PS(55,PSGP,5,+PSGORD,1,PSJX12,0)) PSJF12=1
"RTN","PSGOEE",125,0)
 .S:PSJF12 ^PS(55,"AUE",PSGP,+PSGORD)=""
"RTN","PSGOEE",126,0)
 N TMP,PSGSIF S TMP=PSGOEENO N PSGOEENO S PSGOEENO=TMP
"RTN","PSGOEE",127,0)
 N II F II=1:1:$L($G(DR),";") I $E($P($G(DR),";",II),1,7)="122////" S PSGSIF=$P(PSGSI,"^",2),PSGSI=$P(PSGSI,"^") Q
"RTN","PSGOEE",128,0)
 I $G(PSJCOM),$G(PSJCOMSI) K PSJCOMSI,^TMP("PSGSI",$J) M ^TMP("PSGSI",$J,5)=^PS(53.45,PSJSYSP,5) D
"RTN","PSGOEE",129,0)
 .D FILESI^PSJBCMA5(DFN,PSGORD)
"RTN","PSGOEE",130,0)
 .N PSJCHILD,PSJOEORD S PSJOEORD=0 F  S PSJOEORD=$O(^PS(55,"ACX",PSJCOM,PSJOEORD)) Q:'PSJOEORD  D
"RTN","PSGOEE",131,0)
 .. S PSJCHILD=0 F  S PSJCHILD=$O(^PS(55,"ACX",PSJCOM,PSJOEORD,PSJCHILD)) Q:'PSJCHILD  D
"RTN","PSGOEE",132,0)
 ... Q:PSJCHILD=PSGORD  N DR,DA,DIE,ORD S DR=$S(PSJCHILD["V":"31////"_$G(P("OPI")),1:"8////"_$G(PSGSI)) S DR=DR_";"_$S(PSJCHILD["V":146,1:122)_"////"_+$G(PSGSIF)
"RTN","PSGOEE",133,0)
 ... I '$D(^PS(53.45,+$G(PSJSYSP),5)) M ^PS(53.45,+$G(PSJSYSP),5)=^TMP("PSGSI",$J,5)
"RTN","PSGOEE",134,0)
 ... D FILESI^PSJBCMA5(DFN,PSJCHILD)
"RTN","PSGOEE",135,0)
 ... ;PSJ*5*179 Comment edits
"RTN","PSGOEE",136,0)
 ... S DR=$TR($G(DR),"*") I DR'="" S DA=+PSJCHILD,DIE=$S(PSJCHILD["U":"^PS(55,"_PSGP_",5,",1:"^PS(53.1,") S:DIE["^PS(55," DA(1)=PSGP D ^DIE W "." D EN1^PSJHL2(PSGP,"XX",+PSJCHILD_"U")
"RTN","PSGOEE",137,0)
 . K ^TMP("PSGSI",$J)
"RTN","PSGOEE",138,0)
 S DR=$TR(DR,"*") I DR'="" S DA=+PSGORD,DIE=$S(PSGORD["U":"^PS(55,"_PSGP_",5,",1:"^PS(53.1,") S:DIE["^PS(55," DA(1)=PSGP D ^DIE W "."
"RTN","PSGOEE",139,0)
 F Q=1,3 K @(PSGOEEWF_Q_")") S %X="^PS(53.45,"_PSJSYSP_","_$S(Q=1:2,1:1)_",",%Y=PSGOEEWF_Q_"," K @(PSGOEEWF_Q_")") D %XY^%RCR W "."
"RTN","PSGOEE",140,0)
 S $P(@(PSGOEEWF_"1,0)"),"^",2)=$S(PSGORD["U":55.07,1:53.11)_"P"
"RTN","PSGOEE",141,0)
 I $D(^PS(53.45,+$G(PSJSYSP),5)) D FILESI^PSJBCMA5(DFN,PSJORD)
"RTN","PSGOEE",142,0)
 ; Naked reference on the line below refers to full reference using indirection to either ^PS(55 or ^PS(53.1,
"RTN","PSGOEE",143,0)
 S ND=$G(@($S(PSGORD["U":"^PS(55,"_PSGP_",5,",1:"^PS(53.1,")_+PSGORD_",0)")) I $P(ND,"^",21) S ORIFN=$P(ND,"^",21),ND1=$G(^(.2)),ND2=$G(^(2)),ND2P1=$G(^(2.1)) W !,"...updating OE/RR..." D EN1^PSJHL2(PSGP,"XX",PSGORD) ;*315
"RTN","PSGOEE",144,0)
 I $$ENACTION^PSGOE1(PSGP,PSGORD)["V" S VALMBCK="R"
"RTN","PSGOEE",145,0)
 I PSJSYSL,PSJSYSL<3 S $P(@($S(PSGORD["U":"^PS(55,"_PSGP_",5,",1:"^PS(53.1,")_+PSGORD_",7)"),"^",1,2)=PSGDT_"^"_$E("D",PSGOEENO)_"E",PSGTOL=2,PSGUOW=DUZ,PSGTOO=PSGORD'["U"+1,DA=+PSGORD D ENL^PSGVDS
"RTN","PSGOEE",146,0)
 ; **This is where the Automated Dispensing Machine hook is called. Do NOT DELETE or change this location **
"RTN","PSGOEE",147,0)
 D EDIT^PSJADM
"RTN","PSGOEE",148,0)
 ; **END of Interface Hook **
"RTN","PSGOEE",149,0)
 Q
"RTN","PSGOEE",150,0)
OUT ;
"RTN","PSGOEE",151,0)
 D ABORT K PSGNEWDT S PSGCANFL=1 D GETUD^PSJLMGUD(PSGP,PSGORD),ENSFE^PSGOEE0(PSGP,PSGORD),INIT^PSJLMUDE(PSGP,PSGORD)
"RTN","PSGOEE",152,0)
 Q
"RTN","PSGOEE",153,0)
DONE ;
"RTN","PSGOEE",154,0)
 I PSGORD["P",'$D(PSGOEF),PSGSCH]"",$O(^PS(53.1,+PSGORD,1,0)) D ENF^PSGOEE0
"RTN","PSGOEE",155,0)
DONE1 ;
"RTN","PSGOEE",156,0)
 I PSGORD["U" S X=+PSGORD L -^PS(55,PSGP,5,X)
"RTN","PSGOEE",157,0)
 E  L -^PS(53.1,+PSGORD)
"RTN","PSGOEE",158,0)
 K ^PS(53.45,+PSJSYSP,1),^(2),^(5),^(6)
"RTN","PSGOEE",159,0)
 I '$D(PSGOEF) K PSGSD,PSGSCH,PSGST,PSGFD
"RTN","PSGOEE",160,0)
 K DA,DIE,DIR,DP,DR,DRG,ND,ND0,ND1,ND2,ND2P1,ORIFN,PSGAL,PSGALEF,PSGAT,PSGOEE,PSGOEEF,PSGOEEG,PSGOEEWF,PSGEFN,PSGTOL,PSGTOO,PSGUOW,XREF,PSGEFN,PSGMR,PSGMRN,PSGOROE1,PSGPD,PSGPDN,PSGSI,PSGPR,PSGSM,PSGHSM,PSGSTN,PSGSDN,PSGFDN,PSGPRN
"RTN","PSGOEE",161,0)
 K PSGDO,PSGOEENO Q
"RTN","PSGOEE",162,0)
K1 ;
"RTN","PSGOEE",163,0)
 K BACK,F1,F2,PSGF2,MSG,PSGEFN,PSGNEWDT,PSGOEEND,PSGOPD,PSGOPDN,PSGOMR,PSGOMRN,PSGOSCH,PSGOSI,PSGOPR,PSGOSM,PSGOHSM,PSGOSD,PSGOFD,PSGOST,PSGOPRN,PSGOSTN,PSGOSDN,PSGOFDN,PSGODO,PSGPDRG,PSGPDRGN,PSGOEER
"RTN","PSGOEE",164,0)
 Q
"RTN","PSGOEE",165,0)
 ;
"RTN","PSGOEE",166,0)
ABORT ; Display no change message and pause.
"RTN","PSGOEE",167,0)
 D FULL^VALM1
"RTN","PSGOEE",168,0)
 S (PSGDI,PSGDFLG)='$$DDOK^PSGOE2(PSGOEEWF_"1,",+$G(@(PSGOEEWF_".2)")))
"RTN","PSGOEE",169,0)
 S PSGPFLG='$$OIOK^PSGOE2(+$G(@(PSGOEEWF_".2)")))
"RTN","PSGOEE",170,0)
 I '$G(PSJRNFLG) W !!,$C(7),"No changes made to this order." D PAUSE^VALM1  ;if flag set in PSODGAL1, no repeat message
"RTN","PSGOEE",171,0)
 K PSGOEEF S PSGOEEF=0
"RTN","PSGOEE",172,0)
 Q
"RTN","PSGOEE",173,0)
 ;
"RTN","PSGOEE",174,0)
GTSTATUS ; Determine status of new order and set LM title.
"RTN","PSGOEE",175,0)
 S PSGSTAT=$S($P($G(PSJSYSP0),U,9):"ACTIVE",1:"NON-VERIFIED")
"RTN","PSGOEE",176,0)
 S VALM("TITLE")=PSGSTAT_" UNIT DOSE "_$S(PSGSTAT="PENDING":"("_PSGPRIO_")",1:"")
"RTN","PSGOEE",177,0)
 Q
"RTN","PSGOEE",178,0)
 ;
"RTN","PSGOEE",179,0)
ASKOVR(Y,PSJOVRON,PSJSTARI)  ; Check to see if any starred fields are being edited. If so, ask if they wish to view overrides/interventions if they exist
"RTN","PSGOEE",180,0)
 Q:'$D(Y)!$D(PSJSTARI)  N II,I3,YY S YY=$S(Y:Y,1:$TR($P(Y,"^",4),"="))
"RTN","PSGOEE",181,0)
 Q:'YY  S PSJOVRON=$S($G(PSJOVRON):PSJOVRON,1:$G(PSJORD)) Q:'$G(PSJOVRON)
"RTN","PSGOEE",182,0)
 N PSJORD S PSJORD=PSJOVRON
"RTN","PSGOEE",183,0)
 I '$G(PSJSTARI) F II=1:1:$L(YY,",") Q:$G(PSJSTARI)  S I3=$P(YY,",",II) I I3 S:$G(PSGEFN(I3))!($G(PSJSTAR)[("("_I3_")")) PSJSTARI=1
"RTN","PSGOEE",184,0)
 I $G(PSJSTARI) I ($G(PSJORD)&$G(PSGP)) I $$ASKDISP^PSGSICH1 D FULL^VALM1 D OVRDISP^PSGSICH2(PSGP,PSJORD,3)
"RTN","PSGOEE",185,0)
 Q
"RTN","PSGOEE",186,0)
 ;
"RTN","PSGOEE",187,0)
FIELDS ;
"RTN","PSGOEE",188,0)
31 ;;101^PSGOE8;PSGOPD;PSGPD;101;1
"RTN","PSGOEE",189,0)
32 ;;109^PSGOE8;PSGODO;PSGDO;109;PSGODO]""
"RTN","PSGOEE",190,0)
33 ;;10^PSGOE81;PSGOSD;PSGSD;10;0
"RTN","PSGOEE",191,0)
34 ;;3^PSGOE8;PSGOMR;PSGMR;3;1
"RTN","PSGOEE",192,0)
35 ;;25^PSGOE81;PSGOFD;PSGFD;25;0
"RTN","PSGOEE",193,0)
36 ;;7^PSGOE8;PSGOST;PSGST;7;0
"RTN","PSGOEE",194,0)
37 ;;5^PSGOE82;PSGOSM;PSGSM;5;0
"RTN","PSGOEE",195,0)
38 ;;26^PSGOE8;PSGOSCH;PSGSCH;26;1
"RTN","PSGOEE",196,0)
39 ;;39^PSGOE81;PSGOAT;PSGAT;39;0
"RTN","PSGOEE",197,0)
310 ;;1^PSGOE82;PSGOPR;PSGPR;1;1
"RTN","PSGOEE",198,0)
311 ;;8^PSGOE81;PSGOSI;PSGSI;8;0
"RTN","PSGOEE",199,0)
312 ;;2^PSGOE82;;;2;0
"RTN","PSGOEE",200,0)
313 ;;40^PSGOE82;;;40;0
"RTN","PSGOEE",201,0)
51 ;;101^PSGOE9;PSGOPD;PSGPD;101;1
"RTN","PSGOEE",202,0)
52 ;;109^PSGOE9;PSGODO;PSGDO;109;PSGODO]""
"RTN","PSGOEE",203,0)
53 ;;10^PSGOE91;PSGOSD;PSGSD;10;1
"RTN","PSGOEE",204,0)
54 ;;3^PSGOE9;PSGOMR;PSGMR;3;1
"RTN","PSGOEE",205,0)
55 ;;34^PSGOE91;PSGOFD;PSGFD;34;1
"RTN","PSGOEE",206,0)
56 ;;7^PSGOE9;PSGOST;PSGST;7;0
"RTN","PSGOEE",207,0)
57 ;;5^PSGOE92;PSGOSM;PSGSM;5;0
"RTN","PSGOEE",208,0)
58 ;;26^PSGOE9;PSGOSCH;PSGSCH;26;1
"RTN","PSGOEE",209,0)
59 ;;41^PSGOE91;PSGOAT;PSGAT;41;0
"RTN","PSGOEE",210,0)
510 ;;1^PSGOE92;PSGOPR;PSGPR;1;1
"RTN","PSGOEE",211,0)
511 ;;8^PSGOE91;PSGOSI;PSGSI;8;0
"RTN","PSGOEE",212,0)
512 ;;2^PSGOE92;;;2;0
"RTN","PSGOEE",213,0)
513 ;;15^PSGOE92;;;15;0
"RTN","PSGOEEW")
0^21^B28146717^B29287658
"RTN","PSGOEEW",1,0)
PSGOEEW ;BIR/CML3-SHOW FIELDS FOR EDIT ;15 DEC 97 1:29 PM 
"RTN","PSGOEEW",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**7,58,111,315,373,366**;16 DEC 97;Build 7
"RTN","PSGOEEW",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PSGOEEW",4,0)
 ; Reference to ^PS(51.2 is supported by DBIA 2178.
"RTN","PSGOEEW",5,0)
 ; Reference to ^PSDRUG( is supported by DBIA 2192.
"RTN","PSGOEEW",6,0)
 ;
"RTN","PSGOEEW",7,0)
EN1 ;
"RTN","PSGOEEW",8,0)
 S PSGORD=^TMP("PSJON",$J,PSGOE2)
"RTN","PSGOEEW",9,0)
 ;
"RTN","PSGOEEW",10,0)
EN2 ;
"RTN","PSGOEEW",11,0)
 N %X,%Y,AT,RT,DO,DRGI,FD,FL,FQC,NF,PRI,SD,SIG,ST,STD,STT,X,Y ;*315
"RTN","PSGOEEW",12,0)
 ;naked references below refer to the full reference in the indirection @(PSGOEEWF_"0")
"RTN","PSGOEEW",13,0)
 S OD=$G(@(PSGOEEWF_"0)")),AT=$G(^(2)),RT=$G(^(2.1)),PSGEB=$P($G(^(4)),"^",7),PSGOSI=$G(^(6)),DO=$G(^(.2)),PSGOINST=$G(^(.3)),PSGOPD=$P(DO,"^"),PSGODO=$P(DO,"^",2) ;*315
"RTN","PSGOEEW",14,0)
 S PSGOPR=$P(OD,"^",2),PSGOMR=$P(OD,"^",3),PSGOSM=$P(OD,"^",5),PSGOHSM=$P(OD,"^",6),(PSGOST,ST)=$P(OD,"^",7),(PSGSTAT,STT)=$P(OD,"^",9),PSGOMRN=$S('PSGOMR:"",1:$P($G(^PS(51.2,PSGOMR,0)),"^")) S:PSGOMRN="" PSGOMRN=PSGOMR
"RTN","PSGOEEW",15,0)
 S PSGLI=$P(OD,U,16),PSGNEDFD=$P($$GTNEDFD^PSGOE7("U",PSGOPD),U),PSGOSCH=$P(AT,"^"),(PSGOSD,SD)=$P(AT,"^",2),(FD,PSGOFD)=$P(AT,"^",4),(FQC,PSGS0XT)=$P(AT,"^",6),(PSGOAT,PSGS0Y)=$P(AT,"^",5)
"RTN","PSGOEEW",16,0)
 ;*366 - check provider credentials
"RTN","PSGOEEW",17,0)
 S PRI=$S('PSGOPR:0,1:'$$ACTPRO^PSGOE1(PSGOPR)),DRGI=$S(PSGOPD'=+PSGOPD:0,1:+$G(^PSDRUG(+PSGOPD,"I"))) S:DRGI DRGI=DT'<DRGI
"RTN","PSGOEEW",18,0)
 S PDRG=PSGOPD,PSGOPDN=$S('PSGOPD:"",1:$$OINAME^PSJLMUTL(+PSGOPD)) S:PSGOPDN="" PSGOPDN=PSGOPD S PSGOPRN=$S('PSGOPR:"",1:$P($G(^VA(200,PSGOPR,0)),"^")) S:PSGOPRN="" PSGOPRN=PSGOPR
"RTN","PSGOEEW",19,0)
 S PSGEBN=$$ENNPN^PSGMI(PSGEB)
"RTN","PSGOEEW",20,0)
 S PSGSTAT=$S(STT="":"NOT FOUND",STT="RE":"REINSTATED",1:$P(STT_"^ACTIVE^DISCONTINUED^EXPIRED^HOLD^INCOMPLETE^NON-VERIFIED^PENDING^RENEWED^UNRELEASED","^",$F("ADEHINPRU",STT)))
"RTN","PSGOEEW",21,0)
 ;
"RTN","PSGOEEW",22,0)
SET ;
"RTN","PSGOEEW",23,0)
 S PSGOSTN=$$ENSTN^PSGMI(ST),(PSGOFDN,PSGOSDN)="" I SD S PSGOSDN=$$ENDD^PSGMI(SD)_"^"_$$ENDTC2^PSGMI(SD) ;373
"RTN","PSGOEEW",24,0)
 I FD S PSGOFDN=$$ENDD^PSGMI(FD)_"^"_$$ENDTC2^PSGMI(FD) ;373
"RTN","PSGOEEW",25,0)
 F X="PD","PDN","MR","MRN","ST","STN","SCH","SI","SD","SDN","FD","FDN","SM","HSM","PR","PRN","DO","AT" S @("PSG"_X)=@("PSGO"_X)
"RTN","PSGOEEW",26,0)
 K ^PS(53.45,PSJSYSP,1),^(2) S %X=PSGOEEWF_"3,",%Y="^PS(53.45,"_PSJSYSP_",1," D %XY^%RCR S %X=PSGOEEWF_"1,",%Y="^PS(53.45,"_PSJSYSP_",2," D %XY^%RCR
"RTN","PSGOEEW",27,0)
 S $P(^PS(53.45,PSJSYSP,2,0),"^",2)="53.4502P"
"RTN","PSGOEEW",28,0)
 Q
"RTN","PSGOEEW",29,0)
 ;
"RTN","PSGOEEW",30,0)
ENW ;
"RTN","PSGOEEW",31,0)
 N D,ND,Q,QQ
"RTN","PSGOEEW",32,0)
 W:$Y @IOF,! W " Patient: ",$P(PSGP(0),"^")," (",PSJPPID,")",?55,"Ht(cm): " W:PSJPHT["_" PSJPHT W:PSJPHT'["_" $J(PSJPHT,6,2)
"RTN","PSGOEEW",33,0)
 W " ",PSJPHTD,!?4,"Ward: ",PSJPWDN,?55,"Wt(kg): " W:PSJPWT["_" PSJPWT W:PSJPWT'["_" $J(PSJPWT,6,2) W " ",PSJPWTD,!,"Room-Bed: ",PSJPRB
"RTN","PSGOEEW",34,0)
 W !,"Order Status: ",PSGSTAT,?37,"Entered By: ",PSGEBN,!,"--------------------------------------------------------------------------------"
"RTN","PSGOEEW",35,0)
 W !?1,$S($D(PSGEFN(1)):$E(" *",PSGEFN(1)+1)_"(1)",1:"    "),?16,"Drug: ",PSGPDN
"RTN","PSGOEEW",36,0)
 W !?1,$S($D(PSGEFN(2)):$E(" *",PSGEFN(2)+1)_"(2)",1:"    "),?6,"Dosage Ordered: ",PSGDO,?46,$S($D(PSGEFN(12)):$E(" *",PSGEFN(12)+1)_"(12)",1:"     "),"     Start: ",$P(PSGSDN,"^",2)
"RTN","PSGOEEW",37,0)
 W !?1,$S($D(PSGEFN(3)):$E(" *",PSGEFN(3)+1)_"(3)",1:"    "),?11,"Med Route: ",PSGMRN,?46,$S($D(PSGEFN(13)):$E(" *",PSGEFN(13)+1)_"(13)",1:"     "),"      Stop: ",$P(PSGFDN,"^",2)
"RTN","PSGOEEW",38,0)
 W !?1,$S($D(PSGEFN(4)):$E(" *",PSGEFN(4)+1)_"(4)",1:"    "),?7,"Schedule Type: ",PSGSTN,?46,$S($D(PSGEFN(14)):$E(" *",PSGEFN(14)+1)_"(14)",1:"     "),"  Self Med: ",$P("NO^YES","^",PSGSM+1) I PSGSM,PSGHSM W "  (HS)"
"RTN","PSGOEEW",39,0)
 W !?1,$S($D(PSGEFN(5)):$E(" *",PSGEFN(5)+1)_"(5)",1:"    "),?12,"Schedule: ",PSGSCH
"RTN","PSGOEEW",40,0)
 W !?1,$S($D(PSGEFN(6)):$E(" *",PSGEFN(6)+1)_"(6)",1:"    "),?9,"Admin Times: ",PSGAT
"RTN","PSGOEEW",41,0)
 W !?1,$S($D(PSGEFN(7)):$E(" *",PSGEFN(7)+1)_"(7)",1:"    "),?12,"Provider: ",PSGPRN
"RTN","PSGOEEW",42,0)
 W !?1,$S($D(PSGEFN(8)):$E(" *",PSGEFN(8)+1)_"(8)",1:"    ")," Special Instructions: " I PSGSI]"" F Q=1:1:$L(PSGSI," ") S QQ=$P(PSGSI," ",Q) W:$L(QQ)+$X>79 !?28 W QQ," "
"RTN","PSGOEEW",43,0)
 W !!?1,$S($D(PSGEFN(9)):$E(" *",PSGEFN(9)+1)_"(9)",1:"    ")," Dispense Drug",?48,"U/D",?60,"Inactive Date",!,"-------------------------------------------------------------------------------"
"RTN","PSGOEEW",44,0)
 F Q=0:0 S Q=$O(^PS(53.45,PSJSYSP,2,Q)) Q:'Q  S ND=$G(^(Q,0)) D
"RTN","PSGOEEW",45,0)
 .S D=$P(ND,"^"),PSGID=$P(ND,"^",3) I PSGID S PSGID=$$ENDTC^PSGMI(PSGID)
"RTN","PSGOEEW",46,0)
 .S D=$S(D="":"NOT FOUND",'$D(^PSDRUG(D,0)):D,$P(^(0),"^")]"":$P(^(0),"^"),1:D_";PSDRUG(") W !?6,D,?48,$S($P(ND,"^",2):$P(ND,"^",2),1:1) W:PSGID ?60,PSGID
"RTN","PSGOEEW",47,0)
 W !!,$S($D(PSGEFN(10)):$E(" *",PSGEFN(10)+1)_"(10)",1:"     ")," Comments:" F Q=0:0 S Q=$O(^PS(53.45,PSJSYSP,1,Q)) Q:'Q  S Y=" "_$G(^(Q,0)) F Y1=2:1 S Y2=$P(Y," ",Y1) Q:Y2=""  W:$L(Y2)+$X>79 !?2 W " ",Y2
"RTN","PSGOEEW",48,0)
 W !!,$S($D(PSGEFN(11)):$E(" *",PSGEFN(11)+1)_"(11)",1:"     ")," Provider Comments:"
"RTN","PSGOEEW",49,0)
 I $G(PSGORD) D
"RTN","PSGOEEW",50,0)
 .I $D(^PS(53.1,+PSGORD,12,1)) F Q=0:0 S Q=$O(^PS(53.1,+PSGORD,12,Q)) Q:'Q  W !?2,$G(^(Q,0)) Q
"RTN","PSGOEEW",51,0)
 .I $D(^PS(53.1,+PSGORD,6)) W !?2,$G(^(6))
"RTN","PSGOEEW",52,0)
 K Q,Y,Y1,Y2
"RTN","PSGOEEW",53,0)
 Q
"RTN","PSGOEEW",54,0)
 ;
"RTN","PSGOEEW",55,0)
ENKILL ;
"RTN","PSGOEEW",56,0)
 K PSGAT,PSGEB,PSGFD,PSGHSM,PSGNEFD,PSGNESD,PSGOEEF,PSGOEER,PSGOFD,PSGOHSM,PSGOMR,PSGOMRN,PSGOPD,PSGOPDN,PSGOPR,PSGOSCH,PSGOSD,PSGOSM,PSGOST,PSGPD,PSGPDN,PSGPR,PSGSD,PSGSM Q
"RTN","PSGOEEW",57,0)
HILIGHT ;
"RTN","PSGOEEW",58,0)
 ;
"RTN","PSGOEEW",59,0)
5 ;;3,46,34
"RTN","PSGOEEW",60,0)
7 ;;4,7,45
"RTN","PSGOEEW",61,0)
8 ;;8,5,80
"RTN","PSGOEEW",62,0)
10 ;;2,46,34
"RTN","PSGOEEW",63,0)
25 ;;3,46,34
"RTN","PSGOEEW",64,0)
26 ;;6,12,56
"RTN","PSGOEEW",65,0)
39 ;;6,9,71
"RTN","PSGOEEW",66,0)
40 ;;
"RTN","PSGOEEW",67,0)
66 ;;9,5,80
"RTN","PSGOEEW",68,0)
101 ;;1,6,74
"RTN","PSGOEEW",69,0)
109 ;;2,6,40
"RTN","PSIVCHK")
0^9^B27420606^B25232244
"RTN","PSIVCHK",1,0)
PSIVCHK ;BIR/PR,MLM-CHECK ORDER FOR INTEGRITY ;10/1/10 8:48am
"RTN","PSIVCHK",2,0)
 ;;5.0;INPATIENT MEDICATIONS ;**54,58,81,111,213,113,179,248,366**;16 DEC 97;Build 7
"RTN","PSIVCHK",3,0)
 ;
"RTN","PSIVCHK",4,0)
 ; Reference to ^PS(51.1 supported by DBIA# 2177.
"RTN","PSIVCHK",5,0)
 ; Reference to ^DIE supported by DBIA# 2053.
"RTN","PSIVCHK",6,0)
 ;
"RTN","PSIVCHK",7,0)
 ;Need DFN and ON
"RTN","PSIVCHK",8,0)
 W ! S ERR=0,P("TYP")=P(4) S:P("TYP")="C" P("TYP")=P(23) I P("TYP")="S" S P("TYP")=$S(+P(5):"P",1:"A")
"RTN","PSIVCHK",9,0)
 I '+P("MR") W !,"*** You have not specified a med route! ",! S ERR=1
"RTN","PSIVCHK",10,0)
 I P(11)]"" S X=P(11),X(2)=$G(P(15)) D
"RTN","PSIVCHK",11,0)
 .N PSGSCH S PSGSCH=$G(P(9))
"RTN","PSIVCHK",12,0)
 .D ENCHK^PSGS0 K X(2)
"RTN","PSIVCHK",13,0)
 .I $G(P(15)) I $$ODD^PSGS0(P(15)) W !,"*** Administration times not permitted for Odd Schedules ***" S P(11)="",ERR=1 Q
"RTN","PSIVCHK",14,0)
 .I $G(P(9))]"" I $$PRNOK^PSGS0(P(9)) W !,"*** Administration times not permitted for PRN Schedules ***" S P(11)="",ERR=1 Q
"RTN","PSIVCHK",15,0)
 .I '$D(X) W !,"*** Your administration time(s) are in an invalid format, ",!,"*** or there are more times than indicated by the schedule !" S ERR=1
"RTN","PSIVCHK",16,0)
 ; If schedule exists in schedule file, and order's schedule is continuous,
"RTN","PSIVCHK",17,0)
 ; OR the order's schedule type is fill on request and the order's schedule is defined as continuous in schedule file,
"RTN","PSIVCHK",18,0)
 ; AND the order's schedule is not a PRN schedule, the order must have admin times.
"RTN","PSIVCHK",19,0)
 I $G(P(9))'="" I $D(^PS(51.1,"AC","PSJ",P(9))),'$G(ERR) D
"RTN","PSIVCHK",20,0)
 .N XC,XIEN,XTYP,XAR S (XC,XIEN)="" F XC=0:1 S XIEN=$O(^PS(51.1,"AC","PSJ",P(9),XIEN)) Q:XIEN=""  S XTYP=$P(^PS(51.1,XIEN,0),"^",5) S:XTYP'="" XAR(XTYP)=""
"RTN","PSIVCHK",21,0)
 .S XTYP="" F XC=0:1 S XTYP=$O(XAR(XTYP)) Q:XTYP=""
"RTN","PSIVCHK",22,0)
 .I $$ODD^PSGS0($G(P(15)))!($$PRNOK^PSGS0($G(P(9)))) S P(11)="" Q
"RTN","PSIVCHK",23,0)
 .I $G(P(15))]"" I XC<2,'$$PRNOK^PSGS0(P(9)),'$G(P(11)),($G(P(15))'="O"),'$$ONCALL^PSIVEDT1($G(P(9))),'$$ONETIME^PSIVEDT1($G(P(9))) S ERR=1 W !,"*** There are no administration times defined for this order!"
"RTN","PSIVCHK",24,0)
M I P(15)<0 S ERR=1 W !,"*** Time interval between doses is less than zero !"
"RTN","PSIVCHK",25,0)
 NEW X,PSJLDD S X=0 S:P(9)]"" X=$O(^PS(51.1,"APPSJ",P(9),0))
"RTN","PSIVCHK",26,0)
 N XX F XX=2,3 I $P(P(XX),".",2)=""!($L(P(XX))>12) S ERR=1 W !,"*** ",$S(XX=2:"Start",1:"Stop")," date is in an invalid format or must contain time !"
"RTN","PSIVCHK",27,0)
 I P(2)>P(3) S ERR=1 W !,"*** Start date/time CANNOT be greater than the stop date/time"
"RTN","PSIVCHK",28,0)
 I $$SCHREQ^PSJLIVFD(.P),'X D
"RTN","PSIVCHK",29,0)
 .N PSJXSTMP S PSJXSTMP=P(9) I PSJXSTMP="" S ERR=1 Q
"RTN","PSIVCHK",30,0)
 .N X,Y,PSGS0XT,PSGS0Y,PSGOES S PSGOES=2,X=PSJXSTMP D ENOS^PSGS0 I $G(X)]""&($G(X)=$G(PSJXSTMP)) Q
"RTN","PSIVCHK",31,0)
 .W !," *** WARNING -- Missing or Invalid Schedule ...",! S ERR=1
"RTN","PSIVCHK",32,0)
 ;179 Add Error for before dose if given.
"RTN","PSIVCHK",33,0)
 I $G(ON)&$G(DFN)&$G(PSIVCHG) D  ;179 xtra Protection.
"RTN","PSIVCHK",34,0)
 .S PSJLDD=$P($$EN^PSBAPIPM(DFN,ON),"^")
"RTN","PSIVCHK",35,0)
 .;PSJ*5*248 - Changed warning message
"RTN","PSIVCHK",36,0)
 .I PSJLDD>P(2) S ERR=1 W !,"*** Start date/time must be set AFTER last BCMA admin time ("_$$ENDTC1^PSGMI(PSJLDD)_")",!,"of this medication ***"
"RTN","PSIVCHK",37,0)
INF I P(8)="","AH"[P("TYP") S ERR=1 W !,"*** You have no infusion rate defined !"
"RTN","PSIVCHK",38,0)
 I "AH"[P("TYP"),P(8)'?1N.N.1".".1N1" ml/hr",P(8)'?.E1"@"1N.N,P(8)'?1"0."1N1" ml/hr" S ERR=1 W !,"*** Your infusion rate is in an invalid format !"
"RTN","PSIVCHK",39,0)
 I P(8)="",P("TYP")="P" S:'ERR ERR=2 W !,"*** WARNING -- You have not specified an infusion rate. "
"RTN","PSIVCHK",40,0)
 I '$$CODES1^PSIVUTL(P("TYP"),55.01,.04)!(P("TYP")="") S ERR=1 W !,"*** Type of order is invalid !"
"RTN","PSIVCHK",41,0)
 I '$$CODES1^PSIVUTL(P(17),55.01,100)!(P(17)="") S ERR=1 W !,"*** Status of order is invalid !"
"RTN","PSIVCHK",42,0)
AH ;
"RTN","PSIVCHK",43,0)
 I "HA"[P("TYP"),(P(11)]""!(P(9)]"")) W !,$C(7),"Order type is an admixture, hyperal, or continuous syringe, and you have",!,"a schedule and/or administration times defined!"
"RTN","PSIVCHK",44,0)
 I  F Q=0:0 W !,"Ok to delete these fields" S %=1 D YN^DICN D NULSET Q:%
"RTN","PSIVCHK",45,0)
 K % I P(6)="" S ERR=1 W !,"*** You have not entered a physician!"
"RTN","PSIVCHK",46,0)
 ;*366 - check provider credentials
"RTN","PSIVCHK",47,0)
 I P(6)]"" N PDA,PND,TXT S PDA=+P(6),TXT="" D  I ERR W !,TXT
"RTN","PSIVCHK",48,0)
 . S PND=$G(^VA(200,PDA,0)) I PND="" S ERR=1 S TXT="*** Physician entered does not exist" Q
"RTN","PSIVCHK",49,0)
 . I +$P(PND,U,11),($P(PND,U,11)<DT) S ERR=1 S TXT="*** Physician entered is terminated." Q
"RTN","PSIVCHK",50,0)
 . I '$D(^XUSEC("PROVIDER",PDA)) S ERR=1 S TXT="*** Physician entered does not hold PROVIDER key." Q
"RTN","PSIVCHK",51,0)
 . N PPS S PPS=$G(^VA(200,PDA,"PS")) I PPS=""!('PPS) S ERR=1 S TXT="*** Physician entered is not authorized to write medication orders." Q
"RTN","PSIVCHK",52,0)
 . I +$P(PPS,U,4),$P(PPS,U,4)<DT S ERR=1 S TXT="*** Physician entered is no longer active."
"RTN","PSIVCHK",53,0)
 D ^PSIVCHK1
"RTN","PSIVCHK",54,0)
 Q
"RTN","PSIVCHK",55,0)
 ;
"RTN","PSIVCHK",56,0)
NULSET ;Delete admin/schedule fields for hyperals and/or admixtures
"RTN","PSIVCHK",57,0)
 I '% W !!?2,"Enter 'YES' to delete the schedule and/or administration times fields from",!,"this order.  Enter 'NO' (or '^') to leave the fields intact.",! Q
"RTN","PSIVCHK",58,0)
 S:%=1 P(9)="",P(11)=""
"RTN","PSIVCHK",59,0)
 Q
"RTN","PSIVCHK",60,0)
CKO S P16=0,PSIVEXAM=1,PSIVCT=1 D PSIVCHK S PSIVNOL=1 W ! D ^PSIVORLB K PSIVEXAM Q:'ERR
"RTN","PSIVCHK",61,0)
 I ERR=2 F J=0:0 W !!,"Since there is a warning with this order.",!,"do you wish to re-edit this order" S %=1 D YN^DICN Q:%  W !!,"Answer 'YES' to re-edit this order."
"RTN","PSIVCHK",62,0)
 I ERR=2,%=1 S PSIVOK="57^58^59^26^39^63^64^62^10^25^1" D ^PSIVORV2,GSTRING^PSIVORE1,GTFLDS^PSIVORFE K DA,DIE,DR G CKO
"RTN","PSIVCHK",63,0)
 Q
"RTN","PSIVEDT")
0^4^B69412559^B52868787
"RTN","PSIVEDT",1,0)
PSIVEDT ;BIR/MLM - EDIT IV ORDER ;2/10/98 3:23 PM
"RTN","PSIVEDT",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**4,110,127,133,134,181,252,281,366**;16 DEC 97;Build 7
"RTN","PSIVEDT",3,0)
 ;
"RTN","PSIVEDT",4,0)
 ; Reference to ^PS(53.1 is supported by DBIA 2256.
"RTN","PSIVEDT",5,0)
 ; Reference to ^PS(52.7 is supported by DBIA 2173.
"RTN","PSIVEDT",6,0)
 ; Reference to ^PS(51.2 is supported by DBIA 2178.
"RTN","PSIVEDT",7,0)
 ; Reference to ^PS(50.7 is supported by DBIA 2180.
"RTN","PSIVEDT",8,0)
 ; Reference to ^PS(55 is supported by DBIA 2191.
"RTN","PSIVEDT",9,0)
 ;
"RTN","PSIVEDT",10,0)
EDIT ;
"RTN","PSIVEDT",11,0)
 ;Store the DRG array.  If it changed then to do an OC
"RTN","PSIVEDT",12,0)
 NEW TMPDRG,PSJFLG57,PSIVE,PSIALLFL
"RTN","PSIVEDT",13,0)
 D SAVEDRG^PSIVEDRG(.TMPDRG,.DRG)
"RTN","PSIVEDT",14,0)
 I $G(DFN)&($G(PSJORD)["V") I $$COMPLEX^PSJOE(DFN,PSJORD) D
"RTN","PSIVEDT",15,0)
 . N X,Y,PARENT,P2ND S P2ND=$S($G(^PS(55,PSGP,"IV",+PSJORD,.2)):$G(^PS(55,PSGP,"IV",+PSJORD,.2)),1:$G(^PS(55,PSGP,5,+PSJORD,.2)))
"RTN","PSIVEDT",16,0)
 . S PARENT=$P(P2ND,"^",8)
"RTN","PSIVEDT",17,0)
 . I PARENT D FULL^VALM1 W !!?5,"This order is part of a complex order. Please review the following ",!?5,"associated orders before changing this order." D CMPLX^PSJCOM1(PSGP,PARENT,PSJORD)
"RTN","PSIVEDT",18,0)
 S DONE=0
"RTN","PSIVEDT",19,0)
 F PSIVE=1:1 S:DONE&$E(PSIVAC)="C" OREND=1 Q:PSIVE>$L(EDIT,U)!(DONE)  Q:'$L($P(EDIT,U,PSIVE))  D @($P(EDIT,U,PSIVE)) S:$E(PSIVAC,2)="N" PSIVOK=PSIVOK_U_$P(EDIT,U,PSIVE) I $E(X)=U,$L(X)>1 S:PSIVE>1 PSIVE=PSIVE-1 F  D FF Q:Y<0  D @Y Q:$E(X)'=U
"RTN","PSIVEDT",20,0)
 I $G(PSGORQF) K PSIVEDIT S PSJOCCHK=1,PSIVENO=1 ;RTC 151046
"RTN","PSIVEDT",21,0)
 I '$G(PSGORQF),$G(PSJOCCHK) K PSJOCCHK,PSIVENO D OC^PSIVOC
"RTN","PSIVEDT",22,0)
 K EDIT,PSIVOK,PSGDI
"RTN","PSIVEDT",23,0)
 ;If quit then restore DRG( to pre-edit state
"RTN","PSIVEDT",24,0)
 I $G(PSGORQF) D SAVEDRG^PSIVEDRG(.DRG,.TMPDRG)
"RTN","PSIVEDT",25,0)
 Q
"RTN","PSIVEDT",26,0)
 ;
"RTN","PSIVEDT",27,0)
1 ; Provider.
"RTN","PSIVEDT",28,0)
 N BKP6 S BKP6="" S:P(6) BKP6=P(6)
"RTN","PSIVEDT",29,0)
N1 ;
"RTN","PSIVEDT",30,0)
 I $G(P("RES"))="R" I $G(PSJORD)["P",$P($G(^PS(53.1,+$G(ON),0)),"^",24)="R" D  Q
"RTN","PSIVEDT",31,0)
 . W !!?5,"This is Renewal order. Provider may not be edited at this point." D PAUSE^VALM1
"RTN","PSIVEDT",32,0)
 I $G(DFN)&($G(ON)["V") I $$COMPLEX^PSJOE(DFN,ON) D  Q
"RTN","PSIVEDT",33,0)
 .Q:$G(PSJBKDR)  W !!?5,"This is a Complex Order. Provider may not be edited at this point." D PAUSE^VALM1
"RTN","PSIVEDT",34,0)
 ;*366 - check provider credentials
"RTN","PSIVEDT",35,0)
 S P(6)=$S($$ACTPRO^PSGOE1(+P(6)):P(6),1:"")
"RTN","PSIVEDT",36,0)
 W !,"PROVIDER: "_$S($P(P(6),U,2)]"":$P(P(6),U,2)_"//",1:"") R X:DTIME
"RTN","PSIVEDT",37,0)
 S:'$T X=U S:X=U DONE=1 I $E(X)=U!(X="") Q:P(6)
"RTN","PSIVEDT",38,0)
 I X=U,P(6)="",BKP6]"" S P(6)=BKP6  W $C(7),!!?5,"INVALID PROIVDER." D PAUSE^VALM1 Q
"RTN","PSIVEDT",39,0)
 Q:X="^"
"RTN","PSIVEDT",40,0)
 I X["???",($E(P("OT"))="I"),(PSIVAC["C") D ORFLDS^PSIVEDT1 G N1
"RTN","PSIVEDT",41,0)
 I X]"" K DIC S DIC=200,DIC(0)="EQMZ",DIC("S")="I $$ACTPRO^PSGOE1(+Y)" D ^DIC K DIC I Y>0 S P(6)=+Y_U_Y(0,0) Q
"RTN","PSIVEDT",42,0)
 S F1=53.1,F2=1 D ENHLP^PSIVORC1 W $C(7),!!,"A Provider must be entered.",!! G N1
"RTN","PSIVEDT",43,0)
 Q
"RTN","PSIVEDT",44,0)
 ;
"RTN","PSIVEDT",45,0)
3 ; Med Route.
"RTN","PSIVEDT",46,0)
 I $G(P("RES"))="R" I $G(PSJORD)["P",$P($G(^PS(53.1,+ON,0)),"^",24)="R" D  Q
"RTN","PSIVEDT",47,0)
 . W !!?5,"Med Route may not be edited at this point." D PAUSE^VALM1
"RTN","PSIVEDT",48,0)
 I $G(DFN)&($G(ON)["V") I $$COMPLEX^PSJOE(DFN,ON) D  Q
"RTN","PSIVEDT",49,0)
 .Q:$G(PSJBKDR)  W !!?5,"This is a Complex Order. Med Route may not be edited at this point." D PAUSE^VALM1
"RTN","PSIVEDT",50,0)
 ;S P(6)=$S('$G(^VA(200,+P(6),"PS")):"",'$P(^("PS"),U,4):P(6),$P(^("PS"),U,4)<DT:"",1:P(6))
"RTN","PSIVEDT",51,0)
 ;*366 - OIZ to collect the OIs, CT for count
"RTN","PSIVEDT",52,0)
 I P("MR")="" D
"RTN","PSIVEDT",53,0)
 .N AD,SOL,OI,RT,RTCNT
"RTN","PSIVEDT",54,0)
 .S AD=0 F  S AD=$O(DRG("AD",AD)) Q:'AD  S OI=$P(DRG("AD",AD),"^",6) I OI S OI(OI)=""
"RTN","PSIVEDT",55,0)
 .S SOL=0 F  S SOL=$O(DRG("SOL",SOL)) Q:'SOL  S OI=$P(DRG("SOL",SOL),"^",6) I OI S OI(OI)=""
"RTN","PSIVEDT",56,0)
 .S OI="" F  S OI=$O(OI(OI)) Q:'OI  S RT=$P(^PS(50.7,OI,0),"^",6) S:RT="" RT="NONE" S RT(RT)=$P($G(^PS(51.2,+RT,0)),"^",3)
"RTN","PSIVEDT",57,0)
 .S RT="" F RTCNT=0:1 S RT=$O(RT(RT)) Q:RT=""
"RTN","PSIVEDT",58,0)
 .Q:RTCNT>1
"RTN","PSIVEDT",59,0)
 .S RT=$O(RT("")) I RT]"" S P("MR")=RT_"^"_$G(RT(RT))
"RTN","PSIVEDT",60,0)
 ;*366
"RTN","PSIVEDT",61,0)
 N OIZ,MRTFN S OIZ=0,MRTFN="PSITP" K ^TMP(MRTFN,$J)
"RTN","PSIVEDT",62,0)
 D MROL ;to collect overlapping MR list
"RTN","PSIVEDT",63,0)
 W !,"MED ROUTE: "_$S($P(P("MR"),U,2)]"":$P(P("MR"),U,2),1:"")_"//" R X:DTIME S:'$T X=U S:X=U DONE=1 I X=U!(X=""&P("MR"))!($E(X)=U) Q
"RTN","PSIVEDT",64,0)
 ;*366 - to check for "?" and to select from the short list
"RTN","PSIVEDT",65,0)
 I X["???",($E(P("OT"))="I"),(PSIVAC["C") D ORFLDS^PSIVEDT1 G 3
"RTN","PSIVEDT",66,0)
 I X="?",$G(OIZ) D MRSL G:X=U 3 G CNT
"RTN","PSIVEDT",67,0)
 D:$G(OIZ) CKMRSL K ^TMP(MRTFN,$J),OIZ,MRTFN
"RTN","PSIVEDT",68,0)
CNT ; 
"RTN","PSIVEDT",69,0)
 I X]"" K DIC S DIC=51.2,DIC(0)="EQMZX",DIC("S")="I $P(^(0),U,4)" D ^DIC K DIC I Y>0 S P("MR")=+Y_U_$P(Y(0),U,3) S:$E($G(PSJOCFG),1,2)="FN" PSJFNDS=1 Q  ;366
"RTN","PSIVEDT",70,0)
 S F1=53.1,F2=3 D ENHLP^PSIVORC1 W $C(7),!!,"A Med Route must be entered." G 3
"RTN","PSIVEDT",71,0)
 Q
"RTN","PSIVEDT",72,0)
 ;
"RTN","PSIVEDT",73,0)
10 ; Start Date.
"RTN","PSIVEDT",74,0)
 D 10^PSIVEDT1
"RTN","PSIVEDT",75,0)
 I $E($G(PSJOCFG),1,2)="FN" S PSJFNDS=1
"RTN","PSIVEDT",76,0)
 Q
"RTN","PSIVEDT",77,0)
 ;
"RTN","PSIVEDT",78,0)
25 ; Stop Date.
"RTN","PSIVEDT",79,0)
 D 25^PSIVEDT1
"RTN","PSIVEDT",80,0)
 I $E($G(PSJOCFG),1,2)="FN" S PSJFNDS=1
"RTN","PSIVEDT",81,0)
 Q
"RTN","PSIVEDT",82,0)
26 ; Schedule
"RTN","PSIVEDT",83,0)
 D 26^PSIVEDT1
"RTN","PSIVEDT",84,0)
 Q
"RTN","PSIVEDT",85,0)
 ;
"RTN","PSIVEDT",86,0)
39 ; Admin Times.
"RTN","PSIVEDT",87,0)
 D 39^PSIVEDT1
"RTN","PSIVEDT",88,0)
 Q
"RTN","PSIVEDT",89,0)
 ;
"RTN","PSIVEDT",90,0)
57 ; Additive.
"RTN","PSIVEDT",91,0)
 I $G(P("RES"))="R" I $G(PSJORD)["P",$P($G(^PS(53.1,+ON,0)),"^",24)="R" D  Q
"RTN","PSIVEDT",92,0)
 . W !!?5,"Additive may not be edited at this point." D PAUSE^VALM1
"RTN","PSIVEDT",93,0)
 I $G(DFN)&($G(ON)["V") I $$COMPLEX^PSJOE(DFN,ON) D  Q
"RTN","PSIVEDT",94,0)
 .Q:$G(PSJBKDR)  W !!?5,"This is a Complex Order. Provider may not be edited at this point." D PAUSE^VALM1
"RTN","PSIVEDT",95,0)
 I $E(PSIVAC)="O" W !!,"Only additives marked for use in IV Fluid Order Entry may be selected."
"RTN","PSIVEDT",96,0)
 ; Reference to ^PS(52.6 is supported by DBIA 1231.
"RTN","PSIVEDT",97,0)
 S FIL=52.6,DRGT="AD",DRGTN="ADDITIVE" D DRG^PSIVEDRG,DKILL
"RTN","PSIVEDT",98,0)
 ;I $G(X)="^" G DKILL
"RTN","PSIVEDT",99,0)
 ;If Solution prompt is next then wait to do dose checks after all solutions are entered.
"RTN","PSIVEDT",100,0)
 ;PSJFLG57 is set so OC is triggered when the user entered ^ADDITIVE.
"RTN","PSIVEDT",101,0)
 I $$COMPARE^PSJMISC(.DRG,.TMPDRG) D
"RTN","PSIVEDT",102,0)
 . D ENSTOP^PSIVCAL
"RTN","PSIVEDT",103,0)
 . I $S($G(PSJFLG57):1,($G(EDIT)'["58"):1,1:0) K PSJFLG57,PSJOCCHK D OC^PSIVOC S:$G(EDIT)]"" PSJENHOC=1
"RTN","PSIVEDT",104,0)
 I $G(X)="^" G DKILL
"RTN","PSIVEDT",105,0)
 Q
"RTN","PSIVEDT",106,0)
 ;
"RTN","PSIVEDT",107,0)
58 ; Solution.
"RTN","PSIVEDT",108,0)
 NEW PSJCMPFG
"RTN","PSIVEDT",109,0)
 I $G(P("RES"))="R" I $G(PSJORD)["P",$P($G(^PS(53.1,+ON,0)),"^",24)="R" D  Q
"RTN","PSIVEDT",110,0)
 . W !!?5,"Solution may not be edited at this point." D PAUSE^VALM1
"RTN","PSIVEDT",111,0)
 S FIL=52.7,DRGT="SOL",DRGTN="SOLUTION" D DRG^PSIVEDRG
"RTN","PSIVEDT",112,0)
 ;I $G(X)="^" G DKILL
"RTN","PSIVEDT",113,0)
 ;I $G(X)']"^",$$COMPARE^PSJMISC(.DRG,.TMPDRG) D OC^PSIVOC
"RTN","PSIVEDT",114,0)
 S PSJCMPFG=$$COMPARE^PSJMISC(.DRG,.TMPDRG)
"RTN","PSIVEDT",115,0)
 I 'PSJCMPFG,$$COMPARE^PSJMISC(.DRG,.TMPDRG,1) D
"RTN","PSIVEDT",116,0)
 . NEW X,PSJALLGY
"RTN","PSIVEDT",117,0)
 . K PSJALLGY
"RTN","PSIVEDT",118,0)
 . D SETDD^PSIVOC(1)
"RTN","PSIVEDT",119,0)
 . D GMRAOC^PSJOC S:'$G(PSGORQF) PSIALLFL=1
"RTN","PSIVEDT",120,0)
 . K PSJALLGY
"RTN","PSIVEDT",121,0)
 Q:$G(PSGORQF)
"RTN","PSIVEDT",122,0)
 I PSJCMPFG K PSJOCCHK D ENSTOP^PSIVCAL D OC^PSIVOC S:$G(EDIT)]"" PSJENHOC=1
"RTN","PSIVEDT",123,0)
 K PSJCMPFG
"RTN","PSIVEDT",124,0)
 I $G(X)="^" G DKILL
"RTN","PSIVEDT",125,0)
 ;
"RTN","PSIVEDT",126,0)
DKILL ; Kill for drug edit.
"RTN","PSIVEDT",127,0)
 K DRGI,DRGN,DRGT,DRGTN,FIL,PSIVSTR
"RTN","PSIVEDT",128,0)
 Q
"RTN","PSIVEDT",129,0)
 ;
"RTN","PSIVEDT",130,0)
59 ; Infusion Rate.
"RTN","PSIVEDT",131,0)
 D 59^PSIVEDT1
"RTN","PSIVEDT",132,0)
 Q
"RTN","PSIVEDT",133,0)
 ;
"RTN","PSIVEDT",134,0)
62 ; IV Room.
"RTN","PSIVEDT",135,0)
 N DIR S DIR(0)="PA^59.5",DIR("A")="IV Room: ",DIR("??")="^S F1=59.5,F2=.01 D ENHLP^PSIVORC1" S:P("IVRM") DIR("B")=$P(P("IVRM"),U,2)
"RTN","PSIVEDT",136,0)
 D ^DIR Q:$D(DIRUT)  I Y>0 S P("IVRM")=Y W $P($P(Y,U,2),X,2)
"RTN","PSIVEDT",137,0)
 Q
"RTN","PSIVEDT",138,0)
 ;
"RTN","PSIVEDT",139,0)
63 ; Remarks.
"RTN","PSIVEDT",140,0)
 D 63^PSIVEDT1
"RTN","PSIVEDT",141,0)
 Q
"RTN","PSIVEDT",142,0)
 ;
"RTN","PSIVEDT",143,0)
64 ; Other Print Info.
"RTN","PSIVEDT",144,0)
 D 64^PSIVEDT1
"RTN","PSIVEDT",145,0)
 Q
"RTN","PSIVEDT",146,0)
 ;
"RTN","PSIVEDT",147,0)
66 ; Provider's comments.
"RTN","PSIVEDT",148,0)
 N DA,DIE,DIR,DR S DA=PSIVUP,DIE="^PS(53.45,",DR=4 D ^DIE S PSGSI=X,Y=1
"RTN","PSIVEDT",149,0)
 Q
"RTN","PSIVEDT",150,0)
 ;
"RTN","PSIVEDT",151,0)
101 ; Orderable Item.
"RTN","PSIVEDT",152,0)
 I $G(P("RES"))="R" I $G(PSJORD)["P",$P($G(^PS(53.1,+ON,0)),"^",24)="R" D  Q
"RTN","PSIVEDT",153,0)
 . W !!?5,"This is Renewal order. Orderable Item may not be edited at this point." D PAUSE^VALM1
"RTN","PSIVEDT",154,0)
 I $G(DFN)&($G(ON)["V") I $$COMPLEX^PSJOE(DFN,ON) D  Q
"RTN","PSIVEDT",155,0)
 .Q:$G(PSJBKDR)  W !!?5,"This is a Complex Order. Orderable Item may not be edited at this point." D PAUSE^VALM1
"RTN","PSIVEDT",156,0)
 W !,"Orderable Item: "_$S(P("PD"):$P(P("PD"),U,2)_"//",1:"") R X:DTIME S:'$T X=U S:X=U DONE=1 I $E(X)=U!(X=""&P("PD")) Q
"RTN","PSIVEDT",157,0)
 I X]"" N DIC S DIC="^PS(50.7,",DIC(0)="EMQZ",DIC("B")=$S(P("PD")]"":+$P(("PD"),U),1:""),DIC("S")="S PSJSCT=1 I $$DRGSC^PSIVUTL(Y,PSJSCT) K PSJSCT" D ^DIC K DIC I Y>0 S P("PD")=Y Q
"RTN","PSIVEDT",158,0)
 W $C(7),!!,"Orderable Item is required!",!! G 101
"RTN","PSIVEDT",159,0)
 Q
"RTN","PSIVEDT",160,0)
109 ; Dosage Ordered.
"RTN","PSIVEDT",161,0)
 W !,"DOSAGE ORDERED: "_$S(P("DO")]"":P("DO")_"//",1:"") R X:DTIME S:'$T X=U S:X=U DONE=1 I $E(X)=U!(P("DO")]""&(X="")) Q
"RTN","PSIVEDT",162,0)
 I X="???" D ORFLDS^PSIVEDT1 G 109
"RTN","PSIVEDT",163,0)
 D:X]"" CHK^DIE(53.1,109,"",X,.X) I $G(X)="^" W $C(7),!!,"Enter the dosage in which the Orderable Item entered should be dispensed.",! W "Answer must be 1-20 characters in length." G 109
"RTN","PSIVEDT",164,0)
 S P("DO")=X
"RTN","PSIVEDT",165,0)
 Q
"RTN","PSIVEDT",166,0)
 ;
"RTN","PSIVEDT",167,0)
FF ; up-arrow to another field.
"RTN","PSIVEDT",168,0)
 N DIC S X=$P(X,U,2),DIC="^DD(53.1,",DIC(0)="QEM",DIC("S")="I U_PSIVOK_U[(U_+Y_U)" D ^DIC K DIC S Y=+Y
"RTN","PSIVEDT",169,0)
 I Y=57 S PSJFLG57=1
"RTN","PSIVEDT",170,0)
 Q
"RTN","PSIVEDT",171,0)
 ;
"RTN","PSIVEDT",172,0)
NEWDRG ; Ask if adding a new drug.
"RTN","PSIVEDT",173,0)
 K DIR S DIR(0)="Y",DIR("A")="Are you adding "_$P(TDRG,U,2)_" as a new "_$S(DRGT="AD":"additive",1:"solution")_" for this order",DIR("B")="NO" D ^DIR I $D(DTOUT)!$D(DUOUT) Q
"RTN","PSIVEDT",174,0)
 I Y S (DRGI,DRG(DRGT,0))=DRG(DRGT,0)+1,DRG=TDRG,DRG(DRGT,+DRGI)=+DRG_U_$P(DRG,U,2) I DRGT="SOL" S X=$G(^PS(52.7,+DRG,0)),$P(DRG(DRGT,DRG),U,3)=$P(X,U,3)
"RTN","PSIVEDT",175,0)
 Q
"RTN","PSIVEDT",176,0)
 ;
"RTN","PSIVEDT",177,0)
MRSL ;check for OI med route short list;*366
"RTN","PSIVEDT",178,0)
 N I S I=0 F  S I=$O(^TMP(MRTFN,$J,I)) Q:'I  W !,?10,I_"  "_$P(^TMP(MRTFN,$J,I,0),U)_"  "_$P(^TMP(MRTFN,$J,I,0),U,3)
"RTN","PSIVEDT",179,0)
 N DIC S DIC("A")="Select MED ROUTE: ",DIC="^TMP(MRTFN,$J,",DIC(0)="AEQZ" D ^DIC
"RTN","PSIVEDT",180,0)
 Q:Y=-1
"RTN","PSIVEDT",181,0)
 I X=" " S X="^" Q
"RTN","PSIVEDT",182,0)
 S X=$P(Y,"^",2)
"RTN","PSIVEDT",183,0)
 Q
"RTN","PSIVEDT",184,0)
 ;
"RTN","PSIVEDT",185,0)
CKMRSL ;;check for med route short list leading letters ;*366
"RTN","PSIVEDT",186,0)
 N DIC S DIC("T")="",DIC="^TMP(MRTFN,$J,",DIC(0)="EM" D ^DIC
"RTN","PSIVEDT",187,0)
 Q:Y=-1
"RTN","PSIVEDT",188,0)
 S X=$P(Y,"^",2)
"RTN","PSIVEDT",189,0)
 Q
"RTN","PSIVEDT",190,0)
 ;
"RTN","PSIVEDT",191,0)
MROL ;
"RTN","PSIVEDT",192,0)
 N I,OI,CT
"RTN","PSIVEDT",193,0)
 S (I,CT)=0 F  S I=$O(DRG("AD",I)) Q:'I  S OI=$P(DRG("AD",I),"^",6) I OI S CT=CT+1,OIZ(CT)=OI
"RTN","PSIVEDT",194,0)
 S I=0 F  S I=$O(DRG("SOL",I)) Q:'I  S OI=$P(DRG("SOL",I),"^",6) I OI S CT=CT+1,OIZ(CT)=OI
"RTN","PSIVEDT",195,0)
 S OIZ(0)=CT
"RTN","PSIVEDT",196,0)
 D START1^PSSJORDF(.OIZ,"")
"RTN","PSIVEDT",197,0)
 S OIZ=$O(OIZ("A"),-1)
"RTN","PSIVEDT",198,0)
 I OIZ D
"RTN","PSIVEDT",199,0)
 . S ^TMP(MRTFN,$J,0)=U_U_OIZ_U_OIZ
"RTN","PSIVEDT",200,0)
 . N ZZ S I=0 F  S I=$O(OIZ(I)) Q:'I  D
"RTN","PSIVEDT",201,0)
 . . S ZZ($P(OIZ(I),U,2))=$P(OIZ(I),U,2)_U_$P(OIZ(I),U)_U_$P(OIZ(I),U,3,5)
"RTN","PSIVEDT",202,0)
 . S (I,CT)=0 F  S I=$O(ZZ(I)) Q:I=""  D
"RTN","PSIVEDT",203,0)
 . . S CT=CT+1,^TMP(MRTFN,$J,CT,0)=ZZ(I),^TMP(MRTFN,$J,"B",I,CT)=""
"RTN","PSIVEDT",204,0)
 Q
"RTN","PSIVEDT",205,0)
 ;
"RTN","PSJLMGUD")
0^10^B30941132^B31955674
"RTN","PSJLMGUD",1,0)
PSJLMGUD ;BIR/MLM-INITIALIZE UNIT DOSE ORDER FIELDS FOR DISPLAY ;05 Feb 99 9:46 AM
"RTN","PSJLMGUD",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**25,58,85,116,110,111,267,275,315,256,373,366**;16 DEC 97;Build 7
"RTN","PSJLMGUD",3,0)
 ;
"RTN","PSJLMGUD",4,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PSJLMGUD",5,0)
 ; Reference to ^PS(51.2 is supported by DBIA 2178
"RTN","PSJLMGUD",6,0)
 ; Reference to ^PSDRUG( is supported by DBIA 2192 
"RTN","PSJLMGUD",7,0)
 ; Reference to ^PS(55   is supported by DBIA 2191
"RTN","PSJLMGUD",8,0)
 ; Reference to ES^ORX8 is supported by DBIA 3632
"RTN","PSJLMGUD",9,0)
 ;
"RTN","PSJLMGUD",10,0)
GETUD(DFN,PSGORD) ;
"RTN","PSJLMGUD",11,0)
 ;
"RTN","PSJLMGUD",12,0)
EN2 ;
"RTN","PSJLMGUD",13,0)
 N %X,%Y,ND2,ND2P1,DO,DRGI,FD,FL,FQC,NF,ND,PRI,SD,SIG,ST,STD,X,Y,ESIG ;*315
"RTN","PSJLMGUD",14,0)
 K GMRAL,P
"RTN","PSJLMGUD",15,0)
 S NF=$S(PSGORD["U":0,PSGORD["A":0,PSGORD["O":0,1:1) I NF,$D(^PS(53.1,+PSGORD,0)),$P(^(0),"^",19),$D(^PS(55,DFN,5,$P(^(0),"^",19))),(+$P(^(0),"^",19)'=+$P(^(0),"^",25)) S PSGORD=+$P(^PS(53.1,+PSGORD,0),"^",19)_"U",NF=0
"RTN","PSJLMGUD",16,0)
 S (FL,Y)="",$P(FL,"-",71)="",PSGOEEWF="^PS("_$S(NF:"53.1,",1:"55,"_DFN_",5,")_+PSGORD_","
"RTN","PSJLMGUD",17,0)
 ; The naked reference on the line below refers to the full reference created by indirect reference to F, where F may refer to ^PS(53.1 or the IV or UD multiple ^PS(55
"RTN","PSJLMGUD",18,0)
 S ND=$G(@(PSGOEEWF_"0)")),ND2=$G(^(2)),ND2P1=$G(^(2.1)),PSGEB=$P($G(^(4)),"^",7),PSGOSI=$G(^(6)),SIG=$G(^(6.5)),DO=$G(^(.2)),PSGOINST=$G(^(.3)),ESIG=$P(DO,U,3),PSG14=$P($G(^(14,0)),"^",3) ;*315
"RTN","PSJLMGUD",19,0)
 I PSG14 S PSGLRN=$G(@(PSGOEEWF_"14,"_PSG14_",0)"))
"RTN","PSJLMGUD",20,0)
 S PSGOPD=+DO,PSGODO=$P(DO,U,2),PSGOPDN=$$OINAME^PSJLMUTL(+DO),X=$P(DO,U,4),PSGPRIO=$P("STAT^ASAP^ROUTINE^PREOP^TIME CRITICAL^DONE",U,$F("SARPTD",X)-1),PSJPRI=X
"RTN","PSJLMGUD",21,0)
 S PSGOPR=$P(ND,"^",2),PSGOMR=$P(ND,"^",3),PSGOSM=$P(ND,"^",5),PSGOHSM=$P(ND,"^",6),(PSGOST,ST)=$P(ND,"^",7),STT=$P(ND,"^",9),PSGOMRN=$S('PSGOMR:"",1:$P($G(^PS(51.2,PSGOMR,0)),"^")) S:PSGOMRN="" PSGOMRN=PSGOMR
"RTN","PSJLMGUD",22,0)
 S PSGLI=$P(ND,U,16),PSGOSCH=$P(ND2,"^"),(PSGOSD,SD)=$P(ND2,"^",2),(FD,PSGOFD)=$P(ND2,"^",4),(FQC,PSGS0XT)=$P(ND2,"^",6),(PSGOAT,PSGS0Y)=$P(ND2,"^",5)
"RTN","PSJLMGUD",23,0)
 S:ND2P1]"" PSGDUR=$P(ND2P1,U,1),PSGRMVT=$P(ND2P1,U,2),PSGRMV=$P(ND2P1,U,3),PSGRF=$P(ND2P1,U,4) ;*315
"RTN","PSJLMGUD",24,0)
 S PSGLIN=$$ENDD^PSGMI(PSGLI)_U_$$ENDTC^PSGMI(PSGLI)
"RTN","PSJLMGUD",25,0)
 ;*366 - check provider credentials
"RTN","PSJLMGUD",26,0)
 S PRI=$S('PSGOPR:0,1:'$$ACTPRO^PSGOE1(PSGOPR)),DRGI=$S(PSGOPD'=+PSGOPD:0,1:+$G(^PSDRUG(+PSGOPD,"I"))) S:DRGI DRGI=DT'<DRGI
"RTN","PSJLMGUD",27,0)
 S PSGOPRN=$S('PSGOPR:"",1:$P($G(^VA(200,PSGOPR,0)),"^")) S:PSGOPRN="" PSGOPRN=PSGOPR I PSGOSI]"" S PSGOSI=$$ENSET^PSGSICHK(PSGOSI)
"RTN","PSJLMGUD",28,0)
 I $L($T(ES^ORX8)) N ESIG1 S ESIG1=$$ES^ORX8(+$P(ND,U,21)_";1") S:ESIG1=1 ESIG="ES"
"RTN","PSJLMGUD",29,0)
 S PSGOPRN=PSGOPRN_$S(ESIG]"":" ["_$$LOW^XLFSTR(ESIG)_"]",1:"")
"RTN","PSJLMGUD",30,0)
 S PSGEBN=$$ENNPN^PSGMI(PSGEB) S:$P(ND,U,27)="R" STT="R"
"RTN","PSJLMGUD",31,0)
 S X=STT,PSGSTAT=$S(X="":"NOT FOUND",X="DE":"DISCONTINUED (EDIT)",X="DR":"DISCONTINUED (RENEWAL)",X="RE":"REINSTATED",1:$P(X_"^ACTIVE^DISCONTINUED^EXPIRED^HOLD^INCOMPLETE^NON-VERIFIED^PENDING^RENEWED^UNRELEASED","^",$F("ADEHINPRU",X)))
"RTN","PSJLMGUD",32,0)
 ;
"RTN","PSJLMGUD",33,0)
SET ;
"RTN","PSJLMGUD",34,0)
 I STT="P" S (FD,SD,ST)=""
"RTN","PSJLMGUD",35,0)
 S PSGOSTN=$$ENSTN^PSGMI(ST),(PSGOFDN,PSGOSDN)="" I SD S PSGOSDN=$$ENDD^PSGMI(SD)_"^"_$$ENDTC2^PSGMI(SD) ;#373
"RTN","PSJLMGUD",36,0)
 I FD S PSGOFDN=$$ENDD^PSGMI(FD)_"^"_$$ENDTC2^PSGMI(FD) ;#373
"RTN","PSJLMGUD",37,0)
 F X="PD","PDN","MR","MRN","ST","STN","SCH","SI","SD","SDN","FD","FDN","SM","HSM","PR","PRN","DO","AT" S @("PSG"_X)=@("PSGO"_X)
"RTN","PSJLMGUD",38,0)
 K ^PS(53.45,PSJSYSP,1),^(2),^(5),^(6) S %X=PSGOEEWF_"3,",%Y="^PS(53.45,"_PSJSYSP_",1," D %XY^%RCR S %X=PSGOEEWF_"1,",%Y="^PS(53.45,"_PSJSYSP_",2," D %XY^%RCR
"RTN","PSJLMGUD",39,0)
 S $P(^PS(53.45,PSJSYSP,2,0),"^",2)="53.4502P"
"RTN","PSJLMGUD",40,0)
 K PSJNSS I $G(PSGSCH)'="" D  K PSJNSS
"RTN","PSJLMGUD",41,0)
 . N PSGS0XTO,Y,PSGOES S X=PSGSCH S PSGS0XTO=PSGS0XT N PSGOSCH S PSGOSCH=PSGSCH S PSGSCH="",PSGOES=1
"RTN","PSJLMGUD",42,0)
 . D ENOS^PSGS0 S:$G(X)="" PSGS0XT=PSGS0XTO S PSGSCH=PSGOSCH
"RTN","PSJLMGUD",43,0)
 Q
"RTN","PSJLMGUD",44,0)
 ;
"RTN","PSJLMGUD",45,0)
FINISH ;
"RTN","PSJLMGUD",46,0)
 I '$G(PSGS0XT),PSGOSCH]"" D  S $P(^PS(53.1,+PSGORD,2),"^",6)=PSGS0XT
"RTN","PSJLMGUD",47,0)
 .N PSGOES,PSGS0Y S X=PSGOSCH,PSGOES=1 D ENOS^PSGS0
"RTN","PSJLMGUD",48,0)
 S PSGOEFF=PSGOSCH=""+('$O(^PS(53.45,PSJSYSP,2,0))*10) I PSGOEFF S X=$S(PSGOEFF#2:" a SCHEDULE",1:"")_$S(PSGOEFF=11:" and",1:"")_$S(PSGOEFF>9:" at least one DISPENSE DRUG",1:"")_" before it can be finished."
"RTN","PSJLMGUD",49,0)
 I PSGOEFF W $C(7),!!,"PLEASE NOTE: This order must have" F Q=1:1:$L(X," ") S Y=$P(X," ",Q) W:$L(Y)+$X>78 ! W Y," "
"RTN","PSJLMGUD",50,0)
 I PSGOEFF#2 S F1=53.1,MSG=0,Y=$T(35),@("PSGFN(35)="_$P(Y,";",7)),PSGOEEF(+$P(Y,";",3))=1,(PSGOEE,PSGOEEF)=1 W ! D @$P($T(35),";",3) G:'PSGOEE DONE
"RTN","PSJLMGUD",51,0)
 I PSGOEFF>9 S CHK=7 D ENDRG^PSGOEF1(PSGOPD,0) G:CHK DONE
"RTN","PSJLMGUD",52,0)
 I $G(MSG) K DIR S DIR(0)="E" W !! D ^DIR
"RTN","PSJLMGUD",53,0)
 I PSGOEFF D:PSGST="" GTST^PSGOE6(+PSGORD) N XQORM D EN^VALM("PSJ LM OE DISPLAY") G DONE
"RTN","PSJLMGUD",54,0)
 ;
"RTN","PSJLMGUD",55,0)
ACCEPT ;
"RTN","PSJLMGUD",56,0)
 D UPD^PSGOEF1 G DONE
"RTN","PSJLMGUD",57,0)
BYPASS ;
"RTN","PSJLMGUD",58,0)
 S PSGCANFL=1 G DONE
"RTN","PSJLMGUD",59,0)
 ;
"RTN","PSJLMGUD",60,0)
EDIT ;
"RTN","PSJLMGUD",61,0)
 S PSGPDRG=PSGOPD,PSGPDRGN=PSGOPDN K PSGOEEND D ENF^PSGOEE I PSGCANFL=-1 D UPD^PSGOEF1
"RTN","PSJLMGUD",62,0)
 ;
"RTN","PSJLMGUD",63,0)
DONE ;
"RTN","PSJLMGUD",64,0)
 K CHK,DA,DIE,DR,DRG,MSG,ORETURN,ORIFN,PSGEB,PSGEFN,PSGND,PSGOEE,PSGOEEF,PSGOEEND,PSGOEEG,PSGOEF,PSGOEFF,PSGOES,PSGOPD,PSGOPDN,PSGOPR,PSGOSCH,PSGPDRG,PSGDRGN,PSG0XT,PSGS0Y,OSGSD,Q1,Q2
"RTN","PSJLMGUD",65,0)
 K PSGDUR,PSGRMV,PSGRMVT ;*315
"RTN","PSJLMGUD",66,0)
 Q
"RTN","PSJLMGUD",67,0)
 ;
"RTN","PSJLMGUD",68,0)
 ;
"RTN","PSJLMGUD",69,0)
31 ;;101^PSGOE8;PSGOPD;PSGPD;101;1
"RTN","PSJLMGUD",70,0)
32 ;;109^PSGOE8;PSGODO;PSGDO;102;PSGODO]""
"RTN","PSJLMGUD",71,0)
33 ;;3^PSGOE8;PSGOMR;PSGMR;3;1
"RTN","PSJLMGUD",72,0)
34 ;;7^PSGOE8;PSGOST;PSGST;7;0
"RTN","PSJLMGUD",73,0)
35 ;;26^PSGOE8;PSGOSCH;PSGSCH;26;1
"RTN","PSJLMGUD",74,0)
36 ;;39^PSGOE81;PSGOAT;PSGAT;39;0
"RTN","PSJLMGUD",75,0)
37 ;;1^PSGOE82;PSGOPR;PSGPR;1;1
"RTN","PSJLMGUD",76,0)
38 ;;8^PSGOE81;PSGOSI;PSGSI;8;0
"RTN","PSJLMGUD",77,0)
39 ;;2^PSGOE82;;;2;0
"RTN","PSJLMGUD",78,0)
310 ;;40^PSGOE82;;;40;0
"RTN","PSJLMGUD",79,0)
311 ;;66^PSGOE82;;;66;1
"RTN","PSJLMGUD",80,0)
312 ;;10^PSGOE81;PSGOSD;PSGSD;10;0
"RTN","PSJLMGUD",81,0)
313 ;;25^PSGOE81;PSGOFD;PSGFD;25;0
"RTN","PSJLMGUD",82,0)
314 ;;5^PSGOE82;PSGOSM;PSGSM;5;0
"RTN","PSJLMGUD",83,0)
 ;
"RTN","PSJLMGUD",84,0)
AH ;
"RTN","PSJLMGUD",85,0)
 W !!?2,"Answer 'YES' to accept this order as a NON-VERIFIED UNIT DOSE order.  Answer",!,"'NO' to edit this order now.  Enter '^' to BYPASS this order, leaving it as",!,"a PENDING INPATIENT order."
"RTN","PSJLMGUD",86,0)
 Q
"RTN","PSJOE0")
0^18^B26150423^B26555549
"RTN","PSJOE0",1,0)
PSJOE0 ;BIR/CML3-INPATIENT PROFILE AND ORDER ENTRY ;4/15/10 2:45pm
"RTN","PSJOE0",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**47,56,110,133,162,241,267,275,302,366**;16 DEC 97;Build 7
"RTN","PSJOE0",3,0)
 ;
"RTN","PSJOE0",4,0)
 ; Reference to ^PS(51.2 is supported by DBIA 2178.
"RTN","PSJOE0",5,0)
 ; Reference to ^PS(55 is supported by DBIA 2191.
"RTN","PSJOE0",6,0)
 ; Reference to ^VA(200 is supported by DBIA 10060.
"RTN","PSJOE0",7,0)
 ; Reference to ^DIR is supported by DBIA 10026.
"RTN","PSJOE0",8,0)
 ;
"RTN","PSJOE0",9,0)
START ; print orders
"RTN","PSJOE0",10,0)
 W:X]"" $P("^PROFILE",X,2) D ENL^PSJO3 G:PSJOL="^" DONE Q:PSJOL="N"  K PSJPR S PSGOEAV=0,PSJNARC=1 D ^PSJO I 'PSJON Q
"RTN","PSJOE0",11,0)
 ;
"RTN","PSJOE0",12,0)
ENVW ; ask user to select or view any of the orders shown
"RTN","PSJOE0",13,0)
 S (PSGONC,PSGONR,PSGONV)=0,PSGLMT=PSJON S:$D(PSJPRF) PSGPRF=1 D ENASR^PSGON K PSGPRF
"RTN","PSJOE0",14,0)
 G:X["^" DONE I X]"" S PSGOEA=""
"RTN","PSJOE0",15,0)
 K PSJDLW
"RTN","PSJOE0",16,0)
 I  F PSJOE=1:1:PSGODDD S PSGOE=PSJOE F PSJOE1=1:1:$L(PSGODDD(PSJOE),",")-1 S PSJOE2=$P(PSGODDD(PSJOE),",",PSJOE1),(PSGORD,PSJORD)=^TMP("PSJON",$J,PSJOE2) G:$D(PSJDLW) DONE D 
"RTN","PSJOE0",17,0)
 .I PSJORD=+PSJORD N PSJO,PSJO1 S PSJO=PSJORD,PSJO1=0 F  S PSJO1=$O(^PS(53.1,"ACX",PSJO,PSJO1)) Q:'PSJO1  Q:PSGOEA["^"  Q:$D(PSJDLW)  S PSJORD=PSJO1_"P" D GODO S PSJORD=""
"RTN","PSJOE0",18,0)
 .Q:PSJORD=""  Q:PSGOEA["^"
"RTN","PSJOE0",19,0)
 .D GODO Q:PSGOEA["^"
"RTN","PSJOE0",20,0)
 Q
"RTN","PSJOE0",21,0)
 ;
"RTN","PSJOE0",22,0)
LMNEW(PSGP,PSJPROT) ;Entry point for new order entry from listman.
"RTN","PSJOE0",23,0)
 ; PSGP = DFN
"RTN","PSJOE0",24,0)
 ; PSJPROT=1:UD ONLY; 2:IV ONLY; 3:BOTH
"RTN","PSJOE0",25,0)
 ;
"RTN","PSJOE0",26,0)
 N PSJDEC D CKNEW Q:$G(PSJDEC)  N PSJUDPRF S PSJNEWOE=1
"RTN","PSJOE0",27,0)
 S PSGPTS=PSJPTS,PSGOEAV=$P(PSJSYSP0,U,9)&PSJSYSU,PSGOEDMR="",PSGOEPR=$S($D(^PS(55,PSGP,5.1)):$P(^(5.1),"^",2),1:0),PSJORQF=0,PSJOEPF=""
"RTN","PSJOE0",28,0)
 ;*366 - check provider credentials
"RTN","PSJOE0",29,0)
 I PSGOEPR>0 S PSGOEPR=$S($$ACTPRO^PSGOE1(PSGOEPR):PSGOEPR,1:0)
"RTN","PSJOE0",30,0)
 S:'PSGOEPR PSGOEPR=PSJPTSP
"RTN","PSJOE0",31,0)
 S PSJPCAF=$S($G(PSJPCAF):PSJPCAF,1:"1")
"RTN","PSJOE0",32,0)
 F PSJOE=0:0 Q:PSJORQF!('$P(PSJPCAF,"^",2)&(PSJPROT'>1))!('(PSJPCAF&(PSJPROT'=2))&(PSJPROT'>1))  D KILL^PSJBCMA5(+$G(PSJSYSP)) D:PSJPCAF&($P(PSJPCAF,"^",2))&(PSJPROT'=2) EN^PSJOE1 K PSGEFN,PSGOEF I PSJPROT>1 D ENIN^PSIVORE
"RTN","PSJOE0",33,0)
 Q
"RTN","PSJOE0",34,0)
 ;
"RTN","PSJOE0",35,0)
DONE ;
"RTN","PSJOE0",36,0)
 K PSG,PSGDL,PSGDLS,PSGDO,PSGDRG,PSGDRGN,PSGFD,PSGHSM,PSGMR,PSGMRN,PSGNEDFD,PSGNEFD,PSGNESD,PSGOES,PSGOPR,PSGORD,PSGOROE1,PSGPR,PSGPRN,PSGS0XT,PSGS0Y,PSGSCH,PSGSD,PSGSI,PSGSM,PSGST,PSGSTN,PSGUD,PSGX,PSJDLW,PSJLM,PSJNARC,PSIVAC
"RTN","PSJOE0",37,0)
 K P,PSGEFN,PSGOEEF
"RTN","PSJOE0",38,0)
 Q
"RTN","PSJOE0",39,0)
 ;
"RTN","PSJOE0",40,0)
CKNEW ;
"RTN","PSJOE0",41,0)
 K CF,CHK,OD,PSGLMT,PSGODDD,PSGOEA,PSGON,PSGONC,PSGONR,PSGONV,PSGORD,PSJCOM,PSJOE1,PSJOE2 Q:$D(PSJPRF)
"RTN","PSJOE0",42,0)
 D DEM^VADPT I $G(VADM(6)) W !!?2,"Patient is shown as deceased.  You may not enter orders for this patient." S PSJDEC=1 D CONT Q
"RTN","PSJOE0",43,0)
 I 'PSJPCAF W !!,"(NOTE: You cannot enter Unit Dose orders for this patient.)" D CONT
"RTN","PSJOE0",44,0)
 Q
"RTN","PSJOE0",45,0)
 ;
"RTN","PSJOE0",46,0)
CONT ;
"RTN","PSJOE0",47,0)
 K DIR S DIR(0)="EA",DIR("A")="Press Return to continue..." D ^DIR
"RTN","PSJOE0",48,0)
 Q
"RTN","PSJOE0",49,0)
 ;
"RTN","PSJOE0",50,0)
GODO ;Display selected order.
"RTN","PSJOE0",51,0)
 S PSIVAC="C" I $S(PSJORD["V":1,PSJORD["P":$P($G(^PS(53.1,+PSJORD,0)),"^",4)="F",1:0) D @$S($D(PSJPRP):"ENINP^PSIVOPT(DFN,PSJORD)",1:"ENIN^PSIVOPT") G GODO1
"RTN","PSJOE0",52,0)
 I '$D(PSJPRP),(PSJORD["P"),($P($G(^PS(53.1,+PSJORD,0)),U,4)="I") D ASKTYP Q:$D(DIRUT)  I Y="I" D ENIN^PSIVOPT G GODO1
"RTN","PSJOE0",53,0)
 S PSGORD=PSJORD D EN2^PSGVW,^PSGOE1:'$D(PSJPRF)
"RTN","PSJOE0",54,0)
GODO1 ;
"RTN","PSJOE0",55,0)
 I $D(PSJPRP),'PSJPR K DIR S DIR(0)="E" D ^DIR K DIR S:$D(DUOUT)!$D(DTOUT) PSJDLW=1 Q:$D(PSJDLW)  W:$Y @IOF
"RTN","PSJOE0",56,0)
 Q
"RTN","PSJOE0",57,0)
 ;
"RTN","PSJOE0",58,0)
ASKTYP ; Ask if completing as IV or UD.
"RTN","PSJOE0",59,0)
 Q
"RTN","PSJOE0",60,0)
 W !! D PIV^PSIVUTL(+PSJORD_"P")
"RTN","PSJOE0",61,0)
 I $G(PSJPDD) S DIR(0)="E" D ^DIR S Y="I" Q
"RTN","PSJOE0",62,0)
 W ! K DIR S DIR(0)="SOA^U:Unit Dose;I:IV Medication",DIR("A")="Do you wish to complete this as an IV or Unit Dose order (I/U)? ",DIR("?")="^D PENDIU^PSJO3" D ^DIR
"RTN","PSJOE0",63,0)
 Q
"RTN","PSJOE0",64,0)
 ;
"RTN","PSJOE0",65,0)
OLDCOM(DFN,PSJORD) ;
"RTN","PSJOE0",66,0)
 Q:$$COMPLEX^PSJOE(DFN,PSJORD)
"RTN","PSJOE0",67,0)
 N DURFLG S DURFLG=$S($G(PSJORD)["P":$G(^PS(53.1,+PSJORD,2.5)),$G(PSJORD)["V":$G(^PS(55,DFN,"IV",+PSJORD,2.5)),1:$G(^PS(55,DFN,5,+PSJORD,2.5))) I $P(DURFLG,"^",2)]"" D
"RTN","PSJOE0",68,0)
 . D CLEAR^VALM1 W !!!!!?21," * WARNING * "
"RTN","PSJOE0",69,0)
 . W !!!?5,"The following order contains a Requested Duration"
"RTN","PSJOE0",70,0)
 . W !?12,"and may be part of a complex dose!"
"RTN","PSJOE0",71,0)
 . W !!," Review the entire profile to determine appropriate action(s).",!!!!!!! D PAUSE^VALM1
"RTN","PSJOE0",72,0)
 Q
"RTN","PSJOE0",73,0)
AM ;
"RTN","PSJOE0",74,0)
 W !!?2,"Enter a 'Y' (or press the RETURN key) to enter new INPATIENT orders for this",!,"patient.  Enter an 'N' (or an '^') if there are no new orders for this patient."
"RTN","PSJOE0",75,0)
 W:'PSJPCAF !!?2,"PLEASE NOTE: The patient selected is NOT shown as currently admitted.",!,"Therefore, you cannot enter Unit Dose orders for this patient.  (You can enter",!,"IV orders.)" Q
"VER")
8.0^22.2
"BLD",9978,6)
^323
**END**
**END**

