Released RG*1*71 SEQ #70
Extracted from mail message
**KIDS**:RG*1.0*71^

**INSTALL NAME**
RG*1.0*71
"BLD",3377,0)
RG*1.0*71^CLINICAL INFO RESOURCE NETWORK^0^3190211^y
"BLD",3377,1,0)
^^3^3^3190116^
"BLD",3377,1,1,0)
MASTER VETERAN INDEX VISTA ENHANCEMENTS - SUPPORT LONG NAMES IN VA MPI
"BLD",3377,1,2,0)
Refer to patch RG*1.0*71 in the FORUM Patch Module for a complete
"BLD",3377,1,3,0)
description.
"BLD",3377,4,0)
^9.64PA^^
"BLD",3377,6.3)
2
"BLD",3377,"KRN",0)
^9.67PA^1.5^24
"BLD",3377,"KRN",.4,0)
.4
"BLD",3377,"KRN",.401,0)
.401
"BLD",3377,"KRN",.402,0)
.402
"BLD",3377,"KRN",.403,0)
.403
"BLD",3377,"KRN",.5,0)
.5
"BLD",3377,"KRN",.84,0)
.84
"BLD",3377,"KRN",1.5,0)
1.5
"BLD",3377,"KRN",1.6,0)
1.6
"BLD",3377,"KRN",1.61,0)
1.61
"BLD",3377,"KRN",1.62,0)
1.62
"BLD",3377,"KRN",3.6,0)
3.6
"BLD",3377,"KRN",3.8,0)
3.8
"BLD",3377,"KRN",9.2,0)
9.2
"BLD",3377,"KRN",9.8,0)
9.8
"BLD",3377,"KRN",9.8,"NM",0)
^9.68A^3^3
"BLD",3377,"KRN",9.8,"NM",1,0)
RGADTP1^^0^B62788084
"BLD",3377,"KRN",9.8,"NM",2,0)
RGADTP2^^0^B73923286
"BLD",3377,"KRN",9.8,"NM",3,0)
RGADTP3^^0^B42830500
"BLD",3377,"KRN",9.8,"NM","B","RGADTP1",1)

"BLD",3377,"KRN",9.8,"NM","B","RGADTP2",2)

"BLD",3377,"KRN",9.8,"NM","B","RGADTP3",3)

"BLD",3377,"KRN",19,0)
19
"BLD",3377,"KRN",19.1,0)
19.1
"BLD",3377,"KRN",101,0)
101
"BLD",3377,"KRN",409.61,0)
409.61
"BLD",3377,"KRN",771,0)
771
"BLD",3377,"KRN",779.2,0)
779.2
"BLD",3377,"KRN",870,0)
870
"BLD",3377,"KRN",8989.51,0)
8989.51
"BLD",3377,"KRN",8989.52,0)
8989.52
"BLD",3377,"KRN",8994,0)
8994
"BLD",3377,"KRN","B",.4,.4)

"BLD",3377,"KRN","B",.401,.401)

"BLD",3377,"KRN","B",.402,.402)

"BLD",3377,"KRN","B",.403,.403)

"BLD",3377,"KRN","B",.5,.5)

"BLD",3377,"KRN","B",.84,.84)

"BLD",3377,"KRN","B",1.5,1.5)

"BLD",3377,"KRN","B",1.6,1.6)

"BLD",3377,"KRN","B",1.61,1.61)

"BLD",3377,"KRN","B",1.62,1.62)

"BLD",3377,"KRN","B",3.6,3.6)

"BLD",3377,"KRN","B",3.8,3.8)

"BLD",3377,"KRN","B",9.2,9.2)

"BLD",3377,"KRN","B",9.8,9.8)

"BLD",3377,"KRN","B",19,19)

"BLD",3377,"KRN","B",19.1,19.1)

"BLD",3377,"KRN","B",101,101)

"BLD",3377,"KRN","B",409.61,409.61)

"BLD",3377,"KRN","B",771,771)

"BLD",3377,"KRN","B",779.2,779.2)

"BLD",3377,"KRN","B",870,870)

"BLD",3377,"KRN","B",8989.51,8989.51)

"BLD",3377,"KRN","B",8989.52,8989.52)

"BLD",3377,"KRN","B",8994,8994)

"BLD",3377,"QDEF")
^^^^NO^^^^NO^^YES
"BLD",3377,"QUES",0)
^9.62^^
"BLD",3377,"REQB",0)
^9.611^3^3
"BLD",3377,"REQB",1,0)
RG*1.0*67^2
"BLD",3377,"REQB",2,0)
RG*1.0*68^2
"BLD",3377,"REQB",3,0)
MPIF*1.0*69^2
"BLD",3377,"REQB","B","MPIF*1.0*69",3)

"BLD",3377,"REQB","B","RG*1.0*67",1)

"BLD",3377,"REQB","B","RG*1.0*68",2)

"MBREQ")
0
"PKG",272,-1)
1^1
"PKG",272,0)
CLINICAL INFO RESOURCE NETWORK^RG^CIRN
"PKG",272,22,0)
^9.49I^1^1
"PKG",272,22,1,0)
1.0^2990430^2990601^12555
"PKG",272,22,1,"PAH",1,0)
71^3190211
"PKG",272,22,1,"PAH",1,1,0)
^^3^3^3190211
"PKG",272,22,1,"PAH",1,1,1,0)
MASTER VETERAN INDEX VISTA ENHANCEMENTS - SUPPORT LONG NAMES IN VA MPI
"PKG",272,22,1,"PAH",1,1,2,0)
Refer to patch RG*1.0*71 in the FORUM Patch Module for a complete
"PKG",272,22,1,"PAH",1,1,3,0)
description.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
3
"RTN","RGADTP1")
0^1^B62788084^B55919988
"RTN","RGADTP1",1,0)
RGADTP1 ;BIR/DLR-ADT PROCESSOR TO RETRIGGER A08 or A04 MESSAGES WITH AL/AL (COMMIT/APPLICATION) ACKNOWLEDGEMENTS - CONTINUED ;22 Jan 2019  11:40 AM
"RTN","RGADTP1",2,0)
 ;;1.0;CLINICAL INFO RESOURCE NETWORK;**26,27,42,45,44,47,48,59,61,64,67,71**;30 Apr 99;Build 2
"RTN","RGADTP1",3,0)
PIDP(MSG,ARRAY,HL) ;process PID segment
"RTN","RGADTP1",4,0)
 N ID,IDS,PIDAA,PIDNTC
"RTN","RGADTP1",5,0)
 ;Since PID can be over 245 characters loop through setting a PID ARRAY
"RTN","RGADTP1",6,0)
 ;sequenced PID(1)="PID"... PID(4 or 5) can be over 245 characters so
"RTN","RGADTP1",7,0)
 ;it will also loop and place it in PID(4,1...
"RTN","RGADTP1",8,0)
 ;
"RTN","RGADTP1",9,0)
 ; Input variables
"RTN","RGADTP1",10,0)
 ;   assumes that MSG or MSG(I) will contain the PID segment
"RTN","RGADTP1",11,0)
 ; Output ARRAY ARRAY will contain the following subscripts
"RTN","RGADTP1",12,0)
 ;   SSN - patient SSN
"RTN","RGADTP1",13,0)
 ;   ICN - patient ICN
"RTN","RGADTP1",14,0)
 ;   DFN - sites local identifier
"RTN","RGADTP1",15,0)
 ;   MPISSITE - authoritative source (station# of sending site)
"RTN","RGADTP1",16,0)
 ;   SEX - patient's SEX
"RTN","RGADTP1",17,0)
 ;   MPIDOB - Date of Birth
"RTN","RGADTP1",18,0)
 ;   NAME,SURNAME,FIRST,MIDDLE,PREFIX,and SUFFIX - Patient Name
"RTN","RGADTP1",19,0)
 ;   MMN - Mother's maiden name
"RTN","RGADTP1",20,0)
 ;   POBCITY, POBSTATE - Place of birth city and state
"RTN","RGADTP1",21,0)
 ;
"RTN","RGADTP1",22,0)
 N PID,MPIJ,LNGTH,LNGTH1,PID1,SEQ,SEQ1,COMP,SUBCOMP,REP,HLECH,X,Y,CNT,NXT,ID,IDS,PIDAA,PIDNTC,NAME,LNGTH2,PIDSITE,PIDXDT,HLECH,HLFS
"RTN","RGADTP1",23,0)
 S HLFS=HL("FS"),HLECH=HL("ECH")
"RTN","RGADTP1",24,0)
 S ARRAY("DFN")="",ARRAY("ICN")="",ARRAY("CLAIMN")="",ARRAY("SSN")="",ARRAY("ALIAS")=""
"RTN","RGADTP1",25,0)
 S COMP=$E(HL("ECH"),1),SUBCOMP=$E(HL("ECH"),4),REP=$E(HL("ECH"),2)
"RTN","RGADTP1",26,0)
 S LNGTH=$L(MSG,HL("FS")) F SEQ=1:1:LNGTH S PID(SEQ)=$P(MSG,HL("FS"),SEQ)
"RTN","RGADTP1",27,0)
 S SEQ1=1,X=0 F  S X=$O(MSG(X)) Q:'X  S LNGTH=$L(MSG(X),HL("FS")) D
"RTN","RGADTP1",28,0)
 . F Y=1:1:LNGTH S:Y'=1 SEQ=SEQ+1,SEQ1=1 D  ;**61 MVI_2970 (dri)
"RTN","RGADTP1",29,0)
 .. S NXT=$P(MSG(X),HL("FS"),Y) D
"RTN","RGADTP1",30,0)
 ... I $L($G(PID(SEQ)))=245 D  Q
"RTN","RGADTP1",31,0)
 .... I $L(NXT_$G(PID(SEQ,SEQ1)))>245 S LNGTH1=$L(PID(SEQ,SEQ1)) S LNGTH2=245-LNGTH1,PID(SEQ,SEQ1)=$G(PID(SEQ,SEQ1))_$E(NXT,1,LNGTH2),LNGTH2=LNGTH2+1,NXT=$E(NXT,LNGTH2,$L(NXT)),SEQ1=SEQ1+1
"RTN","RGADTP1",32,0)
 .... I $L(NXT_$G(PID(SEQ,SEQ1)))'>245 S PID(SEQ,SEQ1)=$G(PID(SEQ,SEQ1))_NXT
"RTN","RGADTP1",33,0)
 ... I $L(NXT_$G(PID(SEQ)))>245 S LNGTH1=$L($G(PID(SEQ))) S LNGTH2=245-LNGTH1,PID(SEQ)=$G(PID(SEQ))_$E(NXT,1,LNGTH2),LNGTH2=LNGTH2+1,NXT=$E(NXT,LNGTH2,$L(NXT)) S PID(SEQ,SEQ1)=NXT
"RTN","RGADTP1",34,0)
 ... I $L(NXT_$G(PID(SEQ)))'>245 S PID(SEQ)=$G(PID(SEQ))_NXT Q
"RTN","RGADTP1",35,0)
 ;
"RTN","RGADTP1",36,0)
 ;get PID-3 Patient Identifier List (three ids should be returned ICN, SSN, and DFN)
"RTN","RGADTP1",37,0)
 I $G(PID(4))'="" D  ;**61 MVI_2970 (dri) problem processing volume of name ids
"RTN","RGADTP1",38,0)
 . N A,ACNT,CNT,ID,IDS,IDSWKD,LASTID,PIDAA,PIDNTC,PIDSITE,PIDXDT,X
"RTN","RGADTP1",39,0)
 . S A="",IDSWKD=0,CNT=1,ACNT=1
"RTN","RGADTP1",40,0)
 . S IDS=$G(PID(4)),LASTID=$L(IDS,REP) D IDSARR
"RTN","RGADTP1",41,0)
 . F  S A=$O(PID(4,A)) Q:A=""  S IDS=$G(PID(4,A)),LASTID=$L(IDS,REP) D IDSARR
"RTN","RGADTP1",42,0)
 ;
"RTN","RGADTP1",43,0)
 ;get PID-4 alternate ID (ICN History)
"RTN","RGADTP1",44,0)
 I $G(PID(5))'="" D
"RTN","RGADTP1",45,0)
 . S CNT=1
"RTN","RGADTP1",46,0)
 . F X=1:1:$L(PID(5),REP) S ARRAY("OID",CNT)=$P(PID(5),REP,X),CNT=CNT+1
"RTN","RGADTP1",47,0)
 . S Y=0 F  S Y=$O(PID(5,Y)) Q:'Y  D
"RTN","RGADTP1",48,0)
 .. S ARRAY("OID",CNT-1)=ARRAY("OID",CNT-1)_$P(PID(5,Y),REP)
"RTN","RGADTP1",49,0)
 .. F X=2:1:$L(PID(5,Y),REP) S ARRAY("OID",CNT)=$P(PID(5,Y),REP,X),CNT=CNT+1
"RTN","RGADTP1",50,0)
 . S X=0 F  S X=$O(ARRAY("OID",X)) Q:'X  D
"RTN","RGADTP1",51,0)
 .. N ID,AA,AL S ID=$P(ARRAY("OID",X),COMP),AA=$P($P(ARRAY("OID",X),COMP,4),SUBCOMP,1),AL=$P($P(ARRAY("OID",X),COMP,6),SUBCOMP,2) S AL=$$IEN^XUAF4(AL)
"RTN","RGADTP1",52,0)
 .. S ARRAY("OID",X)=ID_"^"_AA_"^"_AL
"RTN","RGADTP1",53,0)
 ;
"RTN","RGADTP1",54,0)
 ;get PID-5 Patient Name
"RTN","RGADTP1",55,0)
 I $G(PID(6))'="" D  ;**61 MVI_2970 (dri) problem processing volume of aliases
"RTN","RGADTP1",56,0)
 . N A,ALISWKD,IDCNT,LASTNAM,NAME,NAMES,X
"RTN","RGADTP1",57,0)
 . S A="",ALISWKD=0,IDCNT=1
"RTN","RGADTP1",58,0)
 . S NAMES=$G(PID(6)),LASTNAM=$L(NAMES,REP) D NAMARR
"RTN","RGADTP1",59,0)
 . F  S A=$O(PID(6,A)) Q:A=""  S NAMES=$G(PID(6,A)),LASTNAM=$L(NAMES,REP) D NAMARR
"RTN","RGADTP1",60,0)
 ;
"RTN","RGADTP1",61,0)
 ;N KK,JJ,TMPJ,IDCNT2 S IDCNT=1
"RTN","RGADTP1",62,0)
 ;I $G(PID(6))'="" F IDCNT2=1:1:$L(PID(6),REP) S NAME=$P(PID(6),REP,IDCNT2) D
"RTN","RGADTP1",63,0)
 ;.I $P(NAME,COMP,7)="L" S ARRAY("SURNAME")=$P(NAME,COMP),ARRAY("FIRST")=$P(NAME,COMP,2),ARRAY("MIDDLE")=$P(NAME,COMP,3),ARRAY("PREFIX")=$P(NAME,COMP,4),ARRAY("SUFFIX")=$P(NAME,COMP,5),ARRAY("NAME")=$$FMNAME^HLFNC($P(NAME,COMP,1,6)) Q
"RTN","RGADTP1",64,0)
 ;.I $P(NAME,COMP,7)="A" S $P(ARRAY("ALIAS",IDCNT),"^")=$$FMNAME^HLFNC($P(NAME,COMP,1,6)),IDCNT=IDCNT+1 Q  ;**48 ALIAS NAMES?
"RTN","RGADTP1",65,0)
 ;.;**48 alias could send PID(6) to second subscript level
"RTN","RGADTP1",66,0)
 ;.S KK=$O(PID(6,"")) I KK'="" S PID(6,KK)=$P(PID(6),REP,IDCNT2)_PID(6,KK)
"RTN","RGADTP1",67,0)
 ;.S JJ=0 F  S JJ=$O(PID(6,JJ)) Q:'JJ  D
"RTN","RGADTP1",68,0)
 ;..I JJ'=KK S PID(6,JJ)=$P(PID(6,$O(PID(6,JJ),-1)),REP,TMPJ)_PID(6,JJ)
"RTN","RGADTP1",69,0)
 ;..F TMPJ=1:1:$L(PID(6,JJ),REP) S NAME=$P(PID(6,JJ),REP,TMPJ) D
"RTN","RGADTP1",70,0)
 ;...I $P(NAME,COMP,7)="A" S $P(ARRAY("ALIAS",IDCNT),"^")=$$FMNAME^HLFNC($P(NAME,COMP,1,6)),IDCNT=IDCNT+1
"RTN","RGADTP1",71,0)
 ;
"RTN","RGADTP1",72,0)
 ;get PID-6 Mother's maiden name
"RTN","RGADTP1",73,0)
 S ARRAY("MMN")=$P($G(PID(7)),COMP,1,5) D
"RTN","RGADTP1",74,0)
 . I $P(ARRAY("MMN"),COMP)'=HL("Q") S HLECH=HL("ECH") S ARRAY("MMN")=$$FREE^RGRSPARS($$FMNAME^HLFNC(ARRAY("MMN"))) Q
"RTN","RGADTP1",75,0)
 . I $P(ARRAY("MMN"),COMP)=HL("Q") S ARRAY("MMN")=$$FREE^RGRSPARS($P(ARRAY("MMN"),COMP))
"RTN","RGADTP1",76,0)
 ;
"RTN","RGADTP1",77,0)
 ;get PID-7 Date of Birth
"RTN","RGADTP1",78,0)
 ;**47 taking HL("Q") into account
"RTN","RGADTP1",79,0)
 I $G(PID(8))=HL("Q") S PID(8)="@",ARRAY("MPIDOB")="@"
"RTN","RGADTP1",80,0)
 I $G(PID(8))'="@" S ARRAY("MPIDOB")=$$FMDATE^HLFNC($G(PID(8)))
"RTN","RGADTP1",81,0)
 ;
"RTN","RGADTP1",82,0)
 ;get PID-8 Sex
"RTN","RGADTP1",83,0)
 ;**47 taking HL("Q") into account
"RTN","RGADTP1",84,0)
 I $G(PID(9))=HL("Q") S PID(9)="@"
"RTN","RGADTP1",85,0)
 S ARRAY("SEX")=$G(PID(9))
"RTN","RGADTP1",86,0)
 ;
"RTN","RGADTP1",87,0)
 ;get PID-11-3 ADDRESS BOTH "P"rimary and "N" Place of
"RTN","RGADTP1",88,0)
 S CNT=1
"RTN","RGADTP1",89,0)
 N ADRTYPE,ADDR
"RTN","RGADTP1",90,0)
 F X=1:1:$L(PID(12),REP) D
"RTN","RGADTP1",91,0)
 . S ADDR=$P(PID(12),REP,X),ADRTYPE=$P(ADDR,COMP,7)
"RTN","RGADTP1",92,0)
 . I ADRTYPE="P" D
"RTN","RGADTP1",93,0)
 .. S ADDR=$$FREE^RGRSPARS(ADDR)
"RTN","RGADTP1",94,0)
 .. S ARRAY(.111)=$$FREE^RGRSPARS($P(ADDR,COMP,1))  ;addr [1]
"RTN","RGADTP1",95,0)
 .. S ARRAY(.112)=$$FREE^RGRSPARS($P(ADDR,COMP,2))  ;addr [2]
"RTN","RGADTP1",96,0)
 .. S ARRAY(.113)=$$FREE^RGRSPARS($P(ADDR,COMP,8))  ;addr [3]
"RTN","RGADTP1",97,0)
 .. S ARRAY(.114)=$$FREE^RGRSPARS($P(ADDR,COMP,3))  ;city
"RTN","RGADTP1",98,0)
 .. S ARRAY(.115)=$$STATE^RGRSPARS($P(ADDR,COMP,4))  ;state
"RTN","RGADTP1",99,0)
 .. S ARRAY(.1112)=$$FREE^RGRSPARS($P(ADDR,COMP,5))  ;zip+4
"RTN","RGADTP1",100,0)
 .. N CNTYCODE S CNTYCODE=PID(13)  ;county code
"RTN","RGADTP1",101,0)
 .. S ARRAY(.117)=$$COUNTY^RGRSPARS(ARRAY(.115),CNTYCODE)
"RTN","RGADTP1",102,0)
 .. S ARRAY(.131)=$$FREE^RGRSPARS(PID(14))
"RTN","RGADTP1",103,0)
 .. S ARRAY(.132)=$$FREE^RGRSPARS(PID(15))
"RTN","RGADTP1",104,0)
 . I ADRTYPE="N" D
"RTN","RGADTP1",105,0)
 .. S ARRAY("POBCITY")=$$FREE^RGRSPARS($P(ADDR,COMP,3))  ;POB city
"RTN","RGADTP1",106,0)
 .. S ARRAY("POBSTATE")=$$STATE^RGRSPARS($P(ADDR,COMP,4))  ;POB state
"RTN","RGADTP1",107,0)
 ;
"RTN","RGADTP1",108,0)
 ;marital status
"RTN","RGADTP1",109,0)
 S ARRAY(.05)=$$MARITAL^RGRSPARS(PID(17))
"RTN","RGADTP1",110,0)
 ;
"RTN","RGADTP1",111,0)
 ;multiple birth indicator **47
"RTN","RGADTP1",112,0)
 S ARRAY("MBI")=$G(PID(25)) I ARRAY("MBI")=HL("Q") S ARRAY("MBI")="@" ;**47 to get MBI and setup as yes/no field change to @ if HL("Q")
"RTN","RGADTP1",113,0)
 ;
"RTN","RGADTP1",114,0)
 ;;REMOVED FROM PATCH 45 DUE TO NEEDING DG707
"RTN","RGADTP1",115,0)
 ;religious preference
"RTN","RGADTP1",116,0)
 S ARRAY(.08)=$$RELIG^RGRSPARS(PID(18))
"RTN","RGADTP1",117,0)
 ;
"RTN","RGADTP1",118,0)
 ;address
"RTN","RGADTP1",119,0)
 ;
"RTN","RGADTP1",120,0)
 ;get PID-29 Date of Death
"RTN","RGADTP1",121,0)
 S ARRAY("MPIDOD")=$$FREE^RGRSPARS($$FMDATE^HLFNC($G(PID(30)))),ARRAY(.351)=ARRAY("MPIDOD")
"RTN","RGADTP1",122,0)
 Q
"RTN","RGADTP1",123,0)
 ;
"RTN","RGADTP1",124,0)
IDSARR ;parse ids ;**61 MVI_2970 (dri)
"RTN","RGADTP1",125,0)
 F X=1:1:LASTID S ID=$P(IDS,REP,X) D
"RTN","RGADTP1",126,0)
 . I IDSWKD=1 S IDSWKD=0 Q  ;first repetition of continuation message already worked
"RTN","RGADTP1",127,0)
 . I X=LASTID,$D(PID(4,A+1)) S ID=ID_$P(PID(4,A+1),REP,1),IDSWKD=1 ;if last repetition check for an extension of message
"RTN","RGADTP1",128,0)
 . ;get id, assigning authority, and name type code
"RTN","RGADTP1",129,0)
 . S PIDAA=$P($P(ID,COMP,4),SUBCOMP),PIDNTC=$P(ID,COMP,5),PIDSITE=$P($P(ID,COMP,6),SUBCOMP,2),PIDXDT=$P(ID,COMP,8)
"RTN","RGADTP1",130,0)
 . S ID=$P(ID,COMP)
"RTN","RGADTP1",131,0)
 . ;Q:ID="" **48
"RTN","RGADTP1",132,0)
 . ;check assigning authority(0363) AND name type code(0203)
"RTN","RGADTP1",133,0)
 . I PIDAA="USVHA" D  Q
"RTN","RGADTP1",134,0)
 .. I PIDNTC="NI" D
"RTN","RGADTP1",135,0)
 ... I $G(PIDXDT)="" S ARRAY("ICN")=ID,ARRAY("MPISSITE")=PIDSITE,ARRAY(991.02)=$P(ID,"V",2)  ;National unique individual identifier
"RTN","RGADTP1",136,0)
 ... I $G(PIDXDT)'="" S ARRAY("OID",CNT)=ID_"^"_PIDAA_"^"_PIDSITE_"^"_PIDXDT,CNT=CNT+1  ;Deprecated National unique individual identifier
"RTN","RGADTP1",137,0)
 .. I PIDNTC="PI" S ARRAY("DFN")=ID,ARRAY("DFNLOC")=PIDSITE  ;Patient internal identifier
"RTN","RGADTP1",138,0)
 . I PIDAA="USSSA" D  Q
"RTN","RGADTP1",139,0)
 .. I PIDNTC="SS",PIDXDT="" S ARRAY("SSN")=ID I ID=HL("Q") S ARRAY("SSN")="@"  ;Social Security number **44 (new) look out for alias ssns
"RTN","RGADTP1",140,0)
 .. I PIDNTC="SS",PIDXDT'="" S $P(ARRAY("ALIAS",ACNT),"^",2)=ID,ACNT=ACNT+1 ;**48 store alias ssn
"RTN","RGADTP1",141,0)
 .. ;**47 includes HL("Q") check
"RTN","RGADTP1",142,0)
 . I PIDAA="USVBA" D  Q
"RTN","RGADTP1",143,0)
 .. I PIDNTC="PN" S ARRAY("CLAIMN")=ID  ;VBA CLAIM#
"RTN","RGADTP1",144,0)
 . ;**59,MVI_880: Get TIN and FIN values
"RTN","RGADTP1",145,0)
 . I PIDAA="USDOD" D  Q
"RTN","RGADTP1",146,0)
 .. I PIDNTC="TIN" S ARRAY("TIN")=$S(ID=HL("Q"):"@",1:ID)
"RTN","RGADTP1",147,0)
 .. I PIDNTC="FIN" S ARRAY("FIN")=$S(ID=HL("Q"):"@",1:ID)
"RTN","RGADTP1",148,0)
 Q
"RTN","RGADTP1",149,0)
 ;
"RTN","RGADTP1",150,0)
NAMARR ;parse legal and alias names ;**61 MVI_2970 (dri)
"RTN","RGADTP1",151,0)
 F X=1:1:LASTNAM S NAME=$P(NAMES,REP,X) D
"RTN","RGADTP1",152,0)
 . I ALISWKD=1 S ALISWKD=0 Q  ;first repetition of continuation message already worked
"RTN","RGADTP1",153,0)
 . I X=LASTNAM,$D(PID(6,A+1)) S NAME=NAME_$P($G(PID(6,A+1)),REP,1),ALISWKD=1 ;if last repetition check for an extension of message
"RTN","RGADTP1",154,0)
 . I $P(NAME,COMP,7)="L" D  Q  ;legal
"RTN","RGADTP1",155,0)
 .. ;**71,Story 841921 (mko): Take into account two quotes -- convert to null
"RTN","RGADTP1",156,0)
 .. S ARRAY("SURNAME")=$$QTON($P(NAME,COMP))
"RTN","RGADTP1",157,0)
 .. S ARRAY("FIRST")=$$QTON($P(NAME,COMP,2))
"RTN","RGADTP1",158,0)
 .. S ARRAY("MIDDLE")=$$QTON($P(NAME,COMP,3))
"RTN","RGADTP1",159,0)
 .. S ARRAY("PREFIX")=$$QTON($P(NAME,COMP,5))
"RTN","RGADTP1",160,0)
 .. S ARRAY("SUFFIX")=$$QTON($P(NAME,COMP,4))
"RTN","RGADTP1",161,0)
 .. S ARRAY("NAME")=$$FMNAME^HLFNC($P(NAME,COMP,1,4))
"RTN","RGADTP1",162,0)
 .;**67 - Story 455458 (ckn) - Parse Preferred Name
"RTN","RGADTP1",163,0)
 . I $P(NAME,COMP,7)="N" D
"RTN","RGADTP1",164,0)
 ..N PNAME
"RTN","RGADTP1",165,0)
 ..S PNAME=$P(NAME,COMP) S ARRAY("PREFERREDNAME")=$S(PNAME=HL("Q"):"@",1:PNAME)
"RTN","RGADTP1",166,0)
 .;**71,Story 841921 (mko): Put the name components into ARRAY("ALIAS",n,"NC")
"RTN","RGADTP1",167,0)
 . I $P(NAME,COMP,7)="A" D
"RTN","RGADTP1",168,0)
 .. N ALIASNC,ALIASNM
"RTN","RGADTP1",169,0)
 .. S ALIASNC=$P(NAME,COMP,1,4),ALIASNM=$$FMNAME^HLFNC(ALIASNC)
"RTN","RGADTP1",170,0)
 .. I $L(ALIASNM)>30,'$$GETFLAG^MPIFNAMC D
"RTN","RGADTP1",171,0)
 ... N ALIAS
"RTN","RGADTP1",172,0)
 ... S ALIAS("SURNAME")=$$QTON($P(ALIASNC,COMP))
"RTN","RGADTP1",173,0)
 ... S ALIAS("FIRST")=$$QTON($P(ALIASNC,COMP,2))
"RTN","RGADTP1",174,0)
 ... S ALIAS("MIDDLE")=$$QTON($P(ALIASNC,COMP,3))
"RTN","RGADTP1",175,0)
 ... S ALIAS("SUFFIX")=$$QTON($P(ALIASNC,COMP,4))
"RTN","RGADTP1",176,0)
 ... S ALIASNM=$$FMTNAME^RGADTP3(.ALIAS,30)
"RTN","RGADTP1",177,0)
 .. S $P(ARRAY("ALIAS",IDCNT),"^")=ALIASNM
"RTN","RGADTP1",178,0)
 .. S ARRAY("ALIAS",IDCNT,"NC")=$TR(ALIASNC,COMP,"^")
"RTN","RGADTP1",179,0)
 .. S IDCNT=IDCNT+1 ;**48 alias
"RTN","RGADTP1",180,0)
 Q
"RTN","RGADTP1",181,0)
 ;
"RTN","RGADTP1",182,0)
QTON(X) ;**71,Story 841921 (mko): Convert two quotes to null
"RTN","RGADTP1",183,0)
 Q $S(X="""""":"",1:X)
"RTN","RGADTP2")
0^2^B73923286^B71260442
"RTN","RGADTP2",1,0)
RGADTP2 ;BIR/DLR-ADT PROCESSOR TO RETRIGGER A08 or A04 MESSAGES WITH AL/AL (COMMIT/APPLICATION) ACKNOWLEDGEMENTS - CONTINUED ;16 Nov 2018  4:06 PM
"RTN","RGADTP2",2,0)
 ;;1.0;CLINICAL INFO RESOURCE NETWORK;**27,20,45,44,47,48,49,52,54,58,59,64,66,67,71**;30 Apr 99;Build 2
"RTN","RGADTP2",3,0)
DBIA ;
"RTN","RGADTP2",4,0)
 ;Reference to $$ADD^VAFCEHU1 supported by IA #2753
"RTN","RGADTP2",5,0)
 ;Reference to EDIT^VAFCPTED supported by IA #2784
"RTN","RGADTP2",6,0)
 ;Reference to ^DPT(DFN,.105) supported by IA #10035
"RTN","RGADTP2",7,0)
 Q
"RTN","RGADTP2",8,0)
PROCIN(ARRAY,RGLOCAL,RGER,DFN,HL) ;
"RTN","RGADTP2",9,0)
 N RGRSDFN,OTHSITE,NODE,ICN,CMORIEN,CMOR,SENSTVTY,RMTDOD,LOCDOD,VAFCA,VAFCA08,HERE,BOGUS,ARAY,REP ;**58,MPIC_2416: Remove CMORDISP from list. It is no longer used.
"RTN","RGADTP2",10,0)
 S REP=$E(HL("ECH"),2)
"RTN","RGADTP2",11,0)
 S HERE=$P($$SITE^VASITE,"^",3)
"RTN","RGADTP2",12,0)
 ;if sending site is your site quit
"RTN","RGADTP2",13,0)
 Q:$G(ARRAY("MPISSITE"))=$G(HERE)
"RTN","RGADTP2",14,0)
 S ARRAY(.097)=$P($$NOW^XLFDT,".")
"RTN","RGADTP2",15,0)
 I $G(ARRAY("ICN"))'="" D
"RTN","RGADTP2",16,0)
 .S RGRSDFN=$$GETDFN^MPIF001(+ARRAY("ICN")) I +RGRSDFN<1 S RGER=RGRSDFN_" ICN#"_$G(ARRAY("ICN")) Q  ;quit and return error msg
"RTN","RGADTP2",17,0)
 .S OTHSITE=ARRAY("SENDING SITE") ;**40 REMOVED THE PLUS TO KEEP SUFFIX ON STATION# & CHANGED THE SITE TO BE SENDING SITE INSTEAD OF AUTHORITATIVE SOURCE
"RTN","RGADTP2",18,0)
 I $G(RGRSDFN)="" S RGRSDFN=$G(DFN)
"RTN","RGADTP2",19,0)
 I $G(RGRSDFN)="" S RGER="-1^DFN not defined"
"RTN","RGADTP2",20,0)
 Q:$G(RGER)
"RTN","RGADTP2",21,0)
 I $G(OTHSITE)="" S OTHSITE=""
"RTN","RGADTP2",22,0)
 S NODE=$$MPINODE^MPIFAPI(RGRSDFN)
"RTN","RGADTP2",23,0)
 S ICN=$P(NODE,"^")
"RTN","RGADTP2",24,0)
 S CMORIEN=$P(NODE,"^",3)
"RTN","RGADTP2",25,0)
 ;
"RTN","RGADTP2",26,0)
 ;**58,MPIC_2416: If there is no CMOR for the patient, set CMOR to "".
"RTN","RGADTP2",27,0)
 ;  Prevents SUBSCRIPT error that occurs if "" is passed to $$NS^XUAF4.
"RTN","RGADTP2",28,0)
 S CMOR=$S(CMORIEN:$P($$NS^XUAF4(CMORIEN),"^",2),1:"")
"RTN","RGADTP2",29,0)
 ;
"RTN","RGADTP2",30,0)
 ;If patient is Sensitive at other site but not here send bulletin
"RTN","RGADTP2",31,0)
 I $G(ARRAY("SENSITIVITY"))'="" S SENSTVTY=$G(ARRAY("SENSITIVITY")) D
"RTN","RGADTP2",32,0)
 .N NAME S NAME=ARRAY("NAME")
"RTN","RGADTP2",33,0)
 .I '$$SENSTIVE^RGRSENS(RGRSDFN),SENSTVTY D
"RTN","RGADTP2",34,0)
 ..S ARAY("SSN")=ARRAY("SSN"),ARAY("SENDING SITE")=ARRAY("SENDING SITE")
"RTN","RGADTP2",35,0)
 ..S ARAY("SENSITIVITY USER")=ARRAY("SENSITIVITY USER"),ARAY("SENSITIVITY DATE")=ARRAY("SENSITIVITY DATE")
"RTN","RGADTP2",36,0)
 ..D SENSTIVE^RGRSBUL1(RGRSDFN,"ARAY",NAME)
"RTN","RGADTP2",37,0)
 ;
"RTN","RGADTP2",38,0)
 ;MPIC_772 - **52; Commented out Remote Date of Death Indicated section.
"RTN","RGADTP2",39,0)
 ;If patient has DATE OF DEATH (DOD) at remote site send bulletin
"RTN","RGADTP2",40,0)
 ;Ignore time if present with date.
"RTN","RGADTP2",41,0)
 ;S RMTDOD=$G(ARRAY("MPIDOD")),RMTDOD=$P(RMTDOD,".")
"RTN","RGADTP2",42,0)
 ;S DFN=RGRSDFN D DEM^VADPT
"RTN","RGADTP2",43,0)
 ;S LOCDOD=$P($P(VADM(6),"^"),".")
"RTN","RGADTP2",44,0)
 ;If there is a remote DOD but no local DOD  OR if remote DOD is different from local DOD, send bulletin
"RTN","RGADTP2",45,0)
 ;I RMTDOD D
"RTN","RGADTP2",46,0)
 ;.N NAME S NAME=ARRAY("NAME"),ARAY("SSN")=ARRAY("SSN"),ARAY("SENDING SITE")=ARRAY("SENDING SITE")
"RTN","RGADTP2",47,0)
 ;.D RMTDOD^RGRSBUL1(RGRSDFN,"ARAY",NAME,RMTDOD,LOCDOD)
"RTN","RGADTP2",48,0)
 ;K VADM
"RTN","RGADTP2",49,0)
 ;
"RTN","RGADTP2",50,0)
NOTLOC I 'RGLOCAL D
"RTN","RGADTP2",51,0)
 .;if sending site is not the CMOR AND NOT THE MPI - log update into PDR if differences exist **45 ADDED MPI
"RTN","RGADTP2",52,0)
 .I (OTHSITE)'=(CMOR)&(OTHSITE'="200M") D  Q
"RTN","RGADTP2",53,0)
 ..S VAFCA=$P($$NOW^XLFDT,".")_"^"_$$NOW^XLFDT_"^"_$G(ARRAY("SENDING SITE"))_"^"_RGRSDFN
"RTN","RGADTP2",54,0)
 ..S ARRAY(.01)=$$FREE^RGRSPARS(ARRAY("NAME")),ARRAY(.03)=$$FREE^RGRSPARS($G(ARRAY("MPIDOB")))
"RTN","RGADTP2",55,0)
 ..S ARRAY(.09)=$$FREE^RGRSPARS($G(ARRAY("SSN"))),ARRAY(.02)=$$SEX^RGRSPARS($G(ARRAY("SEX")))
"RTN","RGADTP2",56,0)
 ..S ARRAY(.2403)=$$FREE^RGRSPARS($G(ARRAY("MMN"))),ARRAY(991.01)=$P($G(ARRAY("ICN")),"V")
"RTN","RGADTP2",57,0)
 ..N ARAY M ARAY(2)=ARRAY
"RTN","RGADTP2",58,0)
 ..S VAFCA08=1  ;S BOGUS=$$ADD^VAFCEHU1(VAFCA,"ARAY") comment out by RG*1*49
"RTN","RGADTP2",59,0)
 .;if sending site is the CMOR OR MPI - synchronize data **45 ADDED MPI AND SSNV TO UPDATED FIELDS
"RTN","RGADTP2",60,0)
 .I (OTHSITE)=(CMOR)!(OTHSITE="200M") D
"RTN","RGADTP2",61,0)
 ..I HL("ETN")="A31",$G(RGRSDFN)>0 K ^XTMP("MPIF OLD RECORDS",RGRSDFN) ;**59,MVI_914: Delete the old record designation
"RTN","RGADTP2",62,0)
 ..;**66 - Story 349269 (ckn) - Moved below two lines here from below
"RTN","RGADTP2",63,0)
 ..;to check the differences in field values before checking Inpatient
"RTN","RGADTP2",64,0)
 ..;status and outstanding edit in the ADT/HL7 PIVOT file
"RTN","RGADTP2",65,0)
 ..N DR,ARAY2,INPFLG S RGER="",INPFLG=0
"RTN","RGADTP2",66,0)
 .. ; **59, MVI_881 changes the following two lines for 4th parameter to be 'ARAY'
"RTN","RGADTP2",67,0)
 .. ; D DIFF^RGADTP3(.ARRAY,RGRSDFN,.DR,.ARRAY) ;**47
"RTN","RGADTP2",68,0)
 .. D DIFF^RGADTP3(.ARRAY,RGRSDFN,.DR,.ARAY) ;**59, MVI_881
"RTN","RGADTP2",69,0)
 ..;**RG*1.0*64/Story 220139 (cml): check for inpatient status, stop update if patient is currently an inpatient
"RTN","RGADTP2",70,0)
 ..;**RG*1.0*66 - Story 349269 (ckn) - Inpatient Edits pending request
"RTN","RGADTP2",71,0)
 ..;shall only be logged in TK if ID traits-Name, DOB, Gender, SSN or
"RTN","RGADTP2",72,0)
 ..;Date of Death is changed. It should also not log unless MBI is
"RTN","RGADTP2",73,0)
 ..;getting set to "Yes". By setting RGER to error,App Ack in MPI will
"RTN","RGADTP2",74,0)
 ..;log request (request type #6230) to TK.
"RTN","RGADTP2",75,0)
 ..I $G(^DPT(RGRSDFN,.105)) D
"RTN","RGADTP2",76,0)
 ...I DR="" Q  ;No edit
"RTN","RGADTP2",77,0)
 ...N I F I=".01",".02",".03",".09",".351" I (";"_DR)[(";"_I_";") S INPFLG=1 Q
"RTN","RGADTP2",78,0)
 ...I ((";"_DR)[(";"_994_";")),($G(ARRAY("MBI"))="Y") S INPFLG=1 Q
"RTN","RGADTP2",79,0)
 ..I INPFLG S RGER="-1^DFN "_RGRSDFN_":  is currently an Inpatient, MPI update not processed." Q:+RGER<0
"RTN","RGADTP2",80,0)
 ..;**44 is there an outstanding edit in the ADT/HL7 PIVOT file for this patient for an identity element
"RTN","RGADTP2",81,0)
 ..S RGER=$$CHKPVT^RGADTP3(.ARRAY) Q:+RGER<0
"RTN","RGADTP2",82,0)
 ..S RGER="" I DR'="" D  ;**67, Story 445418 (jfw) Set RGER to "" if 0 returned so that error can be returned in AA.
"RTN","RGADTP2",83,0)
 ...S VAFCA08=1,ARAY(2,.01)=ARRAY("NAME"),ARAY(2,.03)=$G(ARRAY("MPIDOB"))
"RTN","RGADTP2",84,0)
 ...I ARRAY("SSN")'="" S ARAY(2,.09)=$G(ARRAY("SSN")) ;**45 only set SSN to update if it isn't null
"RTN","RGADTP2",85,0)
 ...S ARAY(2,.02)=$G(ARRAY("SEX")),ARAY(2,.2403)=$G(ARRAY("MMN")),ARAY(2,994)=$G(ARRAY("MBI"))
"RTN","RGADTP2",86,0)
 ...;**48 ONLY SET SSN VERIFICATION STATUS AND PSEUDO SSN REASON IF SSN UPDATE WAS SUCCESSFUL
"RTN","RGADTP2",87,0)
 ...I $D(ARRAY("ALIAS")) M ARAY(2,1)=ARRAY("ALIAS") ;**48 ADD ALIAS TO MIX
"RTN","RGADTP2",88,0)
 ...D EDIT^VAFCPTED(RGRSDFN,"ARAY(2)",DR)
"RTN","RGADTP2",89,0)
 ...;check to see if edits were successful, if not set RGER="why it failed"
"RTN","RGADTP2",90,0)
 ...N NAME,SSN,PDOB,SEX,MMN,OLDNAME,OLDHLNAM,OLDMMN,OLDHLMMN,HLNAME,HLMMN,SSNV,MBI
"RTN","RGADTP2",91,0)
 ...S NAME=$$GET1^DIQ(2,+RGRSDFN_",",.01,"I"),PDOB=$$GET1^DIQ(2,+RGRSDFN_",",.03,"I")
"RTN","RGADTP2",92,0)
 ...S SSN=$$GET1^DIQ(2,+RGRSDFN_",",.09,"I"),SEX=$$GET1^DIQ(2,+RGRSDFN_",",.02,"I")
"RTN","RGADTP2",93,0)
 ...S MMN=$$GET1^DIQ(2,+RGRSDFN_",",.2403,"I"),MBI=$$GET1^DIQ(2,+RGRSDFN_",",994,"I")
"RTN","RGADTP2",94,0)
 ...;**71,Story 841921 (mko): Use this STDNAME method of checking that the name was updated only if the new Name Components flag is not set
"RTN","RGADTP2",95,0)
 ...I '$$GETFLAG^MPIFNAMC D
"RTN","RGADTP2",96,0)
 ....D STDNAME^XLFNAME(.NAME,"F",.OLDNAME) S HLNAME=ARRAY("NAME") D STDNAME^XLFNAME(.HLNAME,"F",.OLDHLNAM)
"RTN","RGADTP2",97,0)
 ....I NAME'=$G(HLNAME) S RGER=$S($G(RGER)'="":$G(RGER)_REP,1:"-1^")_"Name field failure"
"RTN","RGADTP2",98,0)
 ...I PDOB'=$G(ARRAY("MPIDOB")) S RGER=$S($G(RGER)'="":$G(RGER)_REP,1:"-1^")_"DOB field failure"
"RTN","RGADTP2",99,0)
 ...;**48
"RTN","RGADTP2",100,0)
 ...I SSN["P" D
"RTN","RGADTP2",101,0)
 ....;if pseudo SSN reason field has been added to the DD then attempt to set it
"RTN","RGADTP2",102,0)
 ....N PS,ERROR,LABEL D FIELD^DID(2,.0906,"","LABEL","LABEL","ERROR") I '$D(ERROR("DIERR"))&$D(LABEL("LABEL")) D
"RTN","RGADTP2",103,0)
 .....S ARAY2(2,.0906)=$G(ARRAY(.0906)),DR=".0906;" D EDIT^VAFCPTED(RGRSDFN,"ARAY2(2)",DR)
"RTN","RGADTP2",104,0)
 .....S PS=$$GET1^DIQ(2,+RGRSDFN_",",.0906,"I")
"RTN","RGADTP2",105,0)
 .....I PS=""&(ARAY2(2,.0906)="@") Q
"RTN","RGADTP2",106,0)
 .....I PS'=ARAY2(2,.0906) S RGER=$S($G(RGER)'="":$G(RGER)_REP,1:"-1^")_"Pseudo SSN Reason field failure"
"RTN","RGADTP2",107,0)
 .....I PS=ARAY2(2,.0906) D
"RTN","RGADTP2",108,0)
 ......K ARAY2 N ERROR,LABEL D FIELD^DID(2,.0907,"","LABEL","LABEL","ERROR") I '$D(ERROR("DIERR"))&$D(LABEL("LABEL")) D
"RTN","RGADTP2",109,0)
 ......S ARAY2(2,.0907)=$G(ARRAY(.0907)),DR=".0907;" D EDIT^VAFCPTED(RGRSDFN,"ARAY2(2)",DR)
"RTN","RGADTP2",110,0)
 ......S SSNV=$$GET1^DIQ(2,+RGRSDFN_",",.0907,"I")
"RTN","RGADTP2",111,0)
 ......S:$G(ARRAY(.0907))="@" ARRAY(.0907)="" I SSNV'=$G(ARRAY(.0907)) S RGER=$S($G(RGER)'="":$G(RGER)_REP,1:"-1^")_"SSN VERIFICATION field failure"
"RTN","RGADTP2",112,0)
 ...I $G(ARRAY("SSN"))'="",$G(ARRAY("SSN"))'="@",SSN'=$G(ARRAY("SSN")) D
"RTN","RGADTP2",113,0)
 ....;**54 mpic_1556 added array("ssn")'="@"
"RTN","RGADTP2",114,0)
 ....I $G(ARRAY("SSN"))="P",SSN["P" Q  ;**47 NEEDED TO CREATE PSEUDO AND DID
"RTN","RGADTP2",115,0)
 ....S RGER=$S($G(RGER)'="":$G(RGER)_REP,1:"-1^")_"SSN field failure" ;**45 only check if SSN is sent isn't null
"RTN","RGADTP2",116,0)
 ...I SSN=$G(ARRAY("SSN")) D
"RTN","RGADTP2",117,0)
 ....;if SSN VERIFICATION STATUS field has been added to the DD then attempt to set it
"RTN","RGADTP2",118,0)
 ....K ARAY2 N ERROR,LABEL D FIELD^DID(2,.0907,"","LABEL","LABEL","ERROR") I '$D(ERROR("DIERR"))&$D(LABEL("LABEL")) D
"RTN","RGADTP2",119,0)
 .....S ARAY2(2,.0907)=$G(ARRAY(.0907)) S DR=".0907;" D EDIT^VAFCPTED(RGRSDFN,"ARAY2(2)",DR)
"RTN","RGADTP2",120,0)
 .....S SSNV=$$GET1^DIQ(2,+RGRSDFN_",",.0907,"I")
"RTN","RGADTP2",121,0)
 .....S:$G(ARRAY(.0907))="@" ARRAY(.0907)="" I SSNV'=$G(ARRAY(.0907)) S RGER=$S($G(RGER)'="":$G(RGER)_REP,1:"-1^")_"SSN VERIFICATION field failure"
"RTN","RGADTP2",122,0)
 .....I SSNV'="" D
"RTN","RGADTP2",123,0)
 ......N PS,ERROR,LABEL D FIELD^DID(2,.0906,"","LABEL","LABEL","ERROR") I '$D(ERROR("DIERR"))&$D(LABEL("LABEL")) D
"RTN","RGADTP2",124,0)
 ......S ARAY2(2,.0906)=$G(ARRAY(.0906)) S DR=".0906;" D EDIT^VAFCPTED(RGRSDFN,"ARAY2(2)",DR)
"RTN","RGADTP2",125,0)
 ......S PS=$$GET1^DIQ(2,+RGRSDFN_",",.0906,"I")
"RTN","RGADTP2",126,0)
 ......I PS=""&(ARAY2(2,.0906)="@") Q
"RTN","RGADTP2",127,0)
 ......S RGER=$S($G(RGER)'="":$G(RGER)_REP,1:"-1^")_"Pseudo SSN Reason field failure"
"RTN","RGADTP2",128,0)
 ...;**54 Need to see if should delete pseudo ssn reason if SSN isn't a pseudo and there is a pseudo reason, delete it.
"RTN","RGADTP2",129,0)
 ...I SSN'["P" N PS,ERROR,LABEL D FIELD^DID(2,.0906,"","LABEL","LABEL","ERROR") I '$D(ERROR("DIERR"))&$D(LABEL("LABEL")) D
"RTN","RGADTP2",130,0)
 ....S PS=$$GET1^DIQ(2,+RGRSDFN_",",.0906,"I")
"RTN","RGADTP2",131,0)
 ....I PS'=""  S ARAY2(2,.0906)="@",DR=".0906;" D EDIT^VAFCPTED(RGRSDFN,"ARAY2(2)",DR)
"RTN","RGADTP2",132,0)
 ...I SEX'=$G(ARRAY("SEX")) S RGER=$S($G(RGER)'="":$G(RGER)_REP,1:"-1^")_"SEX field failure"
"RTN","RGADTP2",133,0)
 ...D STDNAME^XLFNAME(.MMN,"F",.OLDMMN) S HLMMN=ARRAY("MMN") D STDNAME^XLFNAME(.HLMMN,"F",.OLDHLMMN)
"RTN","RGADTP2",134,0)
 ...I MMN'=$G(HLMMN) S RGER=$S($G(RGER)'="":$G(RGER)_REP,1:"-1^")_"MOTHER'S MAIDEN NAME field failure"
"RTN","RGADTP2",135,0)
 ...;**REMOVED MBI FROM PATCH 45 PUT BACK IN **47
"RTN","RGADTP2",136,0)
 ...I MBI'=$G(ARRAY("MBI")) D
"RTN","RGADTP2",137,0)
 ....Q:MBI=""&($G(ARRAY("MBI"))="@")  ;**47 "" AND @ ARE THE SAME
"RTN","RGADTP2",138,0)
 ....S RGER=$S($G(RGER)'="":$G(RGER)_REP,1:"-1^")_"MULTIPLE BIRTH INDICATOR field failure"
"RTN","RGADTP2",139,0)
 ...;send the updated fields to the MPI to synch site with MPI
"RTN","RGADTP2",140,0)
 ...I HL("ETN")'="A31" S ZTSAVE("DFN")="",ZTRTN="MPISYN^RGADTPC",ZTDESC="Sending Synchronized Patient Data to MPI...",ZTIO="RG QUEUE",ZTDTH=$H D ^%ZTLOAD
"RTN","RGADTP2",141,0)
 ...;**45 ^ don't trigger A31 sync message if A31 was being processed-- ack to a31 will sync id elements on MPI
"RTN","RGADTP2",142,0)
 Q
"RTN","RGADTP3")
0^3^B42830500^B29753601
"RTN","RGADTP3",1,0)
RGADTP3 ;BIR/CMC-RGADTP2 - CONTINUED ; 12/10/18 3:01pm
"RTN","RGADTP3",2,0)
 ;;1.0;CLINICAL INFO RESOURCE NETWORK;**48,59,63,65,67,68,71**;30 Apr 99;Build 2
"RTN","RGADTP3",3,0)
 ;
"RTN","RGADTP3",4,0)
 ;MOVED CHKPVT AND DIFF FROM RGADTP2 DUE TO ROUTINE SIZE ISSUE
"RTN","RGADTP3",5,0)
 Q
"RTN","RGADTP3",6,0)
CHKPVT(ARRAY) ;CHECKS TO SEE IF OUTSTANDING IDENTITY EDIT IS WAITING TO BE SENT IN THE ADT/HL7 PIVOT FILE
"RTN","RGADTP3",7,0)
 ;**44 CREATED - ARRAY CONTAINS THE ARRAY ELEMENTS NEEDED TO FIND THE PATIENT IN THE ADT/HL7 PIVOT FILE
"RTN","RGADTP3",8,0)
 ;RETURNED IS -1^EDIT PENDING IN PIVOT FILE OR 0 IF THERE ISN'T ONE
"RTN","RGADTP3",9,0)
 I '$D(^VAT(391.71,"C",ARRAY("DFN"))) Q 0
"RTN","RGADTP3",10,0)
 N PIV,FIELDS
"RTN","RGADTP3",11,0)
 S PIV=$O(^VAT(391.71,"C",ARRAY("DFN"),"A"),-1) ;get last entry in the pivot file for this patient
"RTN","RGADTP3",12,0)
 I '$D(^VAT(391.71,"AXMIT",4,PIV))&('$D(^VAT(391.71,"AXMIT",3,PIV))) Q 0
"RTN","RGADTP3",13,0)
 S FIELDS=$$GET1^DIQ(391.71,PIV_",",2.1,"I")
"RTN","RGADTP3",14,0)
 I FIELDS[".01;"!(FIELDS[".02;")!(FIELDS[".03;")!(FIELDS[".09;")!(FIELDS[".0906;")!(FIELDS[".2403;")!(FIELDS["994;") Q "-1^DFN "_ARRAY("DFN")_":  Edits made to identity fields waiting to come to MPI, MPI update not processed as of yet."
"RTN","RGADTP3",15,0)
 Q 0
"RTN","RGADTP3",16,0)
 ;
"RTN","RGADTP3",17,0)
DIFF(ARRAY,RGRSDFN,DR,ARAY) ; are there fields to update? **47
"RTN","RGADTP3",18,0)
 N NAME,SSN,PDOB,SEX,SID,MMN,OLDNAME,OLDHLNAM,OLDMMN,OLDHLMMN,HLNAME,HLMMN,SSNV,MBI,PSNR,PREFNAME
"RTN","RGADTP3",19,0)
 S DR="",NAME=$$GET1^DIQ(2,+RGRSDFN_",",.01,"I"),HLNAME=ARRAY("NAME")
"RTN","RGADTP3",20,0)
 ;**48 remove name standardization check
"RTN","RGADTP3",21,0)
 ;D STDNAME^XLFNAME(.NAME,"F",.OLDNAME) S HLNAME=ARRAY("NAME") D STDNAME^XLFNAME(.HLNAME,"F",.OLDHLNAM)
"RTN","RGADTP3",22,0)
 ;**71,Story 841921 (mko): If the Name Components flag is not set, and the incoming name is > 30 chars,
"RTN","RGADTP3",23,0)
 ;    use the name components to build a truncated name
"RTN","RGADTP3",24,0)
 ;  If the flag is set, then we need to update the Name Components entry rather than the Patient Name.
"RTN","RGADTP3",25,0)
 ;    Save the incoming components in ARAY(20), when different from existing values
"RTN","RGADTP3",26,0)
 I '$$GETFLAG^MPIFNAMC D
"RTN","RGADTP3",27,0)
 .S:$L(HLNAME)>30 (HLNAME,ARRAY("NAME"))=$$FMTNAME(.ARRAY,30)
"RTN","RGADTP3",28,0)
 .S:NAME'=$G(HLNAME) DR=DR_".01;",ARAY(2,.01)=ARRAY("NAME")
"RTN","RGADTP3",29,0)
 E  D
"RTN","RGADTP3",30,0)
 .N DIERR,DIMSG,DIHELP,MSG,NCIENS,TARG
"RTN","RGADTP3",31,0)
 .S NCIENS=$$GET1^DIQ(2,+RGRSDFN_",",1.01,"I","","MSG")_","
"RTN","RGADTP3",32,0)
 .D:NCIENS>0 GETS^DIQ(20,NCIENS,"1;2;3;5","I","TARG","MSG")
"RTN","RGADTP3",33,0)
 .S:$G(TARG(20,NCIENS,1,"I"))'=$G(ARRAY("SURNAME")) ARAY(2,1.01,"FAMILY")=$G(ARRAY("SURNAME"))
"RTN","RGADTP3",34,0)
 .S:$G(TARG(20,NCIENS,2,"I"))'=$G(ARRAY("FIRST")) ARAY(2,1.01,"GIVEN")=$G(ARRAY("FIRST"))
"RTN","RGADTP3",35,0)
 .S:$G(TARG(20,NCIENS,3,"I"))'=$G(ARRAY("MIDDLE")) ARAY(2,1.01,"MIDDLE")=$G(ARRAY("MIDDLE"))
"RTN","RGADTP3",36,0)
 .S:$G(TARG(20,NCIENS,5,"I"))'=$G(ARRAY("SUFFIX")) ARAY(2,1.01,"SUFFIX")=$G(ARRAY("SUFFIX"))
"RTN","RGADTP3",37,0)
 .S:$D(ARAY(2,1.01)) DR=DR_"1.01;"
"RTN","RGADTP3",38,0)
 ;**67 - Story 455460 (ckn) - Update Preferred Name
"RTN","RGADTP3",39,0)
 S PREFNAME=$$GET1^DIQ(2,+RGRSDFN_",",.2405,"I"),HLNAME=$G(ARRAY("PREFERREDNAME"))
"RTN","RGADTP3",40,0)
 I PREFNAME'=$G(HLNAME) S DR=DR_".2405;",ARAY(2,.2405)=ARRAY("PREFERREDNAME")
"RTN","RGADTP3",41,0)
 S PDOB=$$GET1^DIQ(2,+RGRSDFN_",",.03,"I") I PDOB'=ARRAY("MPIDOB") S DR=DR_".03;",ARAY(2,.03)=ARRAY("MPIDOB")
"RTN","RGADTP3",42,0)
 S SSN=$$GET1^DIQ(2,+RGRSDFN_",",.09,"I") D
"RTN","RGADTP3",43,0)
 .I SSN["P",ARRAY("SSN")=""!(ARRAY("SSN")="@") Q
"RTN","RGADTP3",44,0)
 .; ^ treat pseudos and null/@ as the same
"RTN","RGADTP3",45,0)
 .; **47 if incoming SSN value is null/@ and existing SSN isn't a pseudo create a new pseudo SSN
"RTN","RGADTP3",46,0)
 .I SSN'["P" I ARRAY("SSN")="@"!(ARRAY("SSN")="") S ARRAY("SSN")="P"
"RTN","RGADTP3",47,0)
 .I SSN'=ARRAY("SSN"),ARRAY("SSN")'="" S DR=DR_".09;",ARAY(2,.09)=ARRAY("SSN")
"RTN","RGADTP3",48,0)
 S SEX=$$GET1^DIQ(2,+RGRSDFN_",",.02,"I") D
"RTN","RGADTP3",49,0)
 .I SEX=""&(ARRAY("SEX")="@") Q
"RTN","RGADTP3",50,0)
 .; ^ treat null and @ as same
"RTN","RGADTP3",51,0)
 .I SEX'=ARRAY("SEX") S DR=DR_".02;",ARAY(2,.02)=ARRAY("SEX")
"RTN","RGADTP3",52,0)
 ;**63 Story 174247: Self-ID Gender
"RTN","RGADTP3",53,0)
 S SID=$$GET1^DIQ(2,+RGRSDFN_",",.024,"I") D
"RTN","RGADTP3",54,0)
 .I SID="",$G(ARRAY(.024))="@" Q
"RTN","RGADTP3",55,0)
 .I SID'=$G(ARRAY(.024)) S DR=DR_".024;",ARAY(2,.024)=$G(ARRAY(".024"))
"RTN","RGADTP3",56,0)
 S SSNV=$$GET1^DIQ(2,+RGRSDFN_",",.0907,"I") I SSNV="" S SSNV="@"
"RTN","RGADTP3",57,0)
 ;if SSN VERIFICATION STATUS field has been added to the DD then attempt to set it
"RTN","RGADTP3",58,0)
 N ERROR,LABEL D FIELD^DID(2,.0907,"","LABEL","LABEL","ERROR") I '$D(ERROR("DIERR"))&$D(LABEL("LABEL")) D
"RTN","RGADTP3",59,0)
 .I SSNV'=ARRAY(.0907) S ARAY(2,.0907)=$G(ARRAY(.0907)),DR=DR_".0907;"
"RTN","RGADTP3",60,0)
 S PSNR=$$GET1^DIQ(2,+RGRSDFN_",",.0906,"I") I PSNR="" S PSNR="@"
"RTN","RGADTP3",61,0)
 ;if Pseudo SSN Reason field has been added to the DD then attempt to set it
"RTN","RGADTP3",62,0)
 N ERROR,LABEL D FIELD^DID(2,.0906,"","LABEL","LABEL","ERROR") I '$D(ERROR("DIERR"))&$D(LABEL("LABEL")) D
"RTN","RGADTP3",63,0)
 .I PSNR'=ARRAY(.0906) S ARAY(2,.0906)=$G(ARRAY(.0906)),DR=DR_".0906;"
"RTN","RGADTP3",64,0)
 ; **59, MVI_881 start
"RTN","RGADTP3",65,0)
 ; S MBI=$$GET1^DIQ(2,+RGRSDFN_",",994,"I") I MBI="" S MBI="@"
"RTN","RGADTP3",66,0)
 ; I MBI="@"&(ARRAY("MBI")="") Q
"RTN","RGADTP3",67,0)
 ; ^ treat @ and null as the same
"RTN","RGADTP3",68,0)
 ; I MBI'=ARRAY("MBI") S DR=DR_"994;",ARAY(2,994)=ARRAY("MBI")
"RTN","RGADTP3",69,0)
 ; S MMN=$$GET1^DIQ(2,+RGRSDFN_",",.2403,"I") I MMN="" S MMN="@"
"RTN","RGADTP3",70,0)
 ; D STDNAME^XLFNAME(.MMN,"F",.OLDMMN) S HLMMN=ARRAY("MMN") D STDNAME^XLFNAME(.HLMMN,"F",.OLDHLMMN)
"RTN","RGADTP3",71,0)
 ; I MMN="@"&($G(HLMMN)="") Q
"RTN","RGADTP3",72,0)
 ; ^ treat @ and null as same
"RTN","RGADTP3",73,0)
 ; I MMN'=$G(HLMMN) S DR=DR_".2403;",ARAY(2,.2403)=ARRAY("MMN")
"RTN","RGADTP3",74,0)
 I $G(ARRAY("MBI"))'="" D
"RTN","RGADTP3",75,0)
 . S MBI=$$GET1^DIQ(2,+RGRSDFN_",",994,"I") S:MBI="" MBI="@"
"RTN","RGADTP3",76,0)
 . ; ^ treat @ and null as the same
"RTN","RGADTP3",77,0)
 . I MBI'=ARRAY("MBI") S DR=DR_"994;",ARAY(2,994)=ARRAY("MBI")
"RTN","RGADTP3",78,0)
 S HLMMN=$G(ARRAY("MMN"))
"RTN","RGADTP3",79,0)
 I HLMMN'="" D
"RTN","RGADTP3",80,0)
 . S MMN=$$GET1^DIQ(2,+RGRSDFN_",",.2403,"I") S:MMN="" MMN="@"
"RTN","RGADTP3",81,0)
 . I MMN'="@" D STDNAME^XLFNAME(.MMN,"F",.OLDMMN)
"RTN","RGADTP3",82,0)
 . I HLMMN'="@" D STDNAME^XLFNAME(.HLMMN,"F",.OLDHLMMN)
"RTN","RGADTP3",83,0)
 . ; ^ treat @ and null as same
"RTN","RGADTP3",84,0)
 . I MMN'=HLMMN S DR=DR_".2403;",ARAY(2,.2403)=ARRAY("MMN")
"RTN","RGADTP3",85,0)
 ; update TIN and FIN fields
"RTN","RGADTP3",86,0)
 N TIN,FIN
"RTN","RGADTP3",87,0)
 I $G(ARRAY("TIN"))'="" D
"RTN","RGADTP3",88,0)
 . S TIN=$$GET1^DIQ(2,+RGRSDFN_",",991.08,"I") S:TIN="" TIN="@"
"RTN","RGADTP3",89,0)
 . I TIN'=ARRAY("TIN") S DR=DR_"991.08;",ARAY(2,991.08)=ARRAY("TIN")
"RTN","RGADTP3",90,0)
 I $G(ARRAY("FIN"))'="" D
"RTN","RGADTP3",91,0)
 . S FIN=$$GET1^DIQ(2,+RGRSDFN_",",991.09,"I") S:FIN="" FIN="@"
"RTN","RGADTP3",92,0)
 . I FIN'=ARRAY("FIN") S DR=DR_"991.09;",ARAY(2,991.09)=ARRAY("FIN")
"RTN","RGADTP3",93,0)
 ; **59, MVI_881 end
"RTN","RGADTP3",94,0)
 I $D(ARRAY("ALIAS")) S DR=DR_"1;"
"RTN","RGADTP3",95,0)
 ;**65 - Story 323009 (ckn): Update DOD fields
"RTN","RGADTP3",96,0)
 N ODOD,ODODP,ODODLUP,ODODSRC,ODODARY,ODODD,ANSWER,DUPDFLG
"RTN","RGADTP3",97,0)
 S DUPDFLG=$$CHK^VAFCDODA() ;Date of Death update flag
"RTN","RGADTP3",98,0)
 ; check for validation of Date of Death- if imprecise date of
"RTN","RGADTP3",99,0)
 ; death - remove all Date of Death if no existin date of death
"RTN","RGADTP3",100,0)
 D VAL^DIE(2,+RGRSDFN_",",.351,"R",$G(ARRAY("MPIDOD")),.ANSWER)
"RTN","RGADTP3",101,0)
 I DUPDFLG D
"RTN","RGADTP3",102,0)
 . I $G(ARRAY("MPIDOD"))="""@"""!($G(ARRAY("MPIDOD"))="") D  Q
"RTN","RGADTP3",103,0)
 ..;**68 - Story 500735 (ckn) : Only Delete Date of Death data if
"RTN","RGADTP3",104,0)
 ..; deletion through PSIM TK OVERRIDE
"RTN","RGADTP3",105,0)
 .. I '$G(ARRAY("TKOVRDOD")) Q
"RTN","RGADTP3",106,0)
 .. I $$GET1^DIQ(2,+RGRSDFN_",",.351,"I")="" Q
"RTN","RGADTP3",107,0)
 .. S DR=DR_".354;",ARAY(2,.354)=$G(ARRAY(.354)) ;Date of death last updated date
"RTN","RGADTP3",108,0)
 .. ;Remove rest of the DOD fields
"RTN","RGADTP3",109,0)
 .. S DR=DR_".351;.352;.353;.355;.357;.358;",(ARAY(2,.351),ARAY(2,.352),ARAY(2,.353),ARAY(2,.355),ARAY(2,.357),ARAY(2,.358))="@"
"RTN","RGADTP3",110,0)
 . I ANSWER="^" S DODIMPF=1_"^"_$G(ARRAY("MPIDOD")) Q  ;Date of Death Imprecise Flag - No update on VistA
"RTN","RGADTP3",111,0)
 . I $G(ARRAY("MPIDOD"))>0 D  Q
"RTN","RGADTP3",112,0)
 .. D GETS^DIQ(2,+RGRSDFN_",",".351;.353;.354;.357","I","ODODARY")
"RTN","RGADTP3",113,0)
 .. S ODOD=ODODARY(2,+RGRSDFN_",",.351,"I")
"RTN","RGADTP3",114,0)
 ..; S ODODD=ODODARY(2,+RGRSDFN_",",.357,"I")
"RTN","RGADTP3",115,0)
 .. S ODODLUP=ODODARY(2,+RGRSDFN_",",.354,"I")
"RTN","RGADTP3",116,0)
 .. S ODODSRC=ODODARY(2,+RGRSDFN_",",.353,"I")
"RTN","RGADTP3",117,0)
 ..; I ODOD=ARRAY("MPIDOD") Q  ;No update if no change in Date of Death
"RTN","RGADTP3",118,0)
 ..;**71 - Story 841797 (ckn)
"RTN","RGADTP3",119,0)
 ..;DOD metadata update allowed if update is from PSIM TK OVERRIDE even
"RTN","RGADTP3",120,0)
 ..;if no change in Date of Death
"RTN","RGADTP3",121,0)
 .. I ODOD=ARRAY("MPIDOD"),'$G(ARRAY("TKOVRDOD")) Q
"RTN","RGADTP3",122,0)
 .. I ODOD'=ARRAY("MPIDOD") S DR=DR_".351;",ARAY(2,.351)=$G(ARRAY(.351))
"RTN","RGADTP3",123,0)
 ..; I ODODD'=$G(ARRAY("DODDocType")) S DR=DR_".357;",ARAY(2,.357)=$G(ARRAY(.357))
"RTN","RGADTP3",124,0)
 .. I ODODLUP'=$G(ARRAY("DODLastUpdated")) S DR=DR_".354;",ARAY(2,.354)=$G(ARRAY(.354))
"RTN","RGADTP3",125,0)
 ..; I ODODSRC'=$G(ARRAY("DODSource")) S DR=DR_".353;",ARAY(2,.353)=$G(ARRAY(.353))
"RTN","RGADTP3",126,0)
 .. S DR=DR_".353;",ARAY(2,.353)=$G(ARRAY(.353))
"RTN","RGADTP3",127,0)
 .. ;Remove rest of the DOD fields if Date Of Death is getting updated
"RTN","RGADTP3",128,0)
 .. S DR=DR_".352;.355;.357;.358",ARAY(2,.352)="@",ARAY(2,.355)="@",ARAY(2,.358)="@",ARAY(2,.357)="@"
"RTN","RGADTP3",129,0)
 Q
"RTN","RGADTP3",130,0)
 ;
"RTN","RGADTP3",131,0)
FMTNAME(ARRAY,LEN) ;Return a formatted name from cleaned Name Components that doesn't exceed LEN characters in length.
"RTN","RGADTP3",132,0)
 ;**71,Story 841921 (mko): New function
"RTN","RGADTP3",133,0)
 N NC
"RTN","RGADTP3",134,0)
 S:'$G(LEN) LEN=30
"RTN","RGADTP3",135,0)
 ;
"RTN","RGADTP3",136,0)
 ;If ARRAY is passed as a string and doesn't have descendants assume it equals "surname^first^middle^suffix"
"RTN","RGADTP3",137,0)
 D:$D(ARRAY)=1
"RTN","RGADTP3",138,0)
 . S ARRAY("SURNAME")=$P(ARRAY,"^")
"RTN","RGADTP3",139,0)
 . S ARRAY("FIRST")=$P(ARRAY,"^",2)
"RTN","RGADTP3",140,0)
 . S ARRAY("MIDDLE")=$P(ARRAY,"^",3)
"RTN","RGADTP3",141,0)
 . S ARRAY("SUFFIX")=$P(ARRAY,"^",4)
"RTN","RGADTP3",142,0)
 ;
"RTN","RGADTP3",143,0)
 ;Clean the components
"RTN","RGADTP3",144,0)
 S NC("FAMILY")=$$CLEANC^XLFNAME($G(ARRAY("SURNAME")))
"RTN","RGADTP3",145,0)
 S NC("GIVEN")=$$CLEANC^XLFNAME($G(ARRAY("FIRST")))
"RTN","RGADTP3",146,0)
 S NC("MIDDLE")=$$CLEANC^XLFNAME($G(ARRAY("MIDDLE")))
"RTN","RGADTP3",147,0)
 S NC("SUFFIX")=$$CLEANC^XLFNAME($G(ARRAY("SUFFIX")))
"RTN","RGADTP3",148,0)
 ;
"RTN","RGADTP3",149,0)
 ;Build a full name, maximum length LEN
"RTN","RGADTP3",150,0)
 Q $$NAMEFMT^XLFNAME(.NC,"F","CL"_LEN)
"VER")
8.0^22.2
"BLD",3377,6)
^70
**END**
**END**

