Released MD*1*29 SEQ #25
Extracted from mail message
**KIDS**:MD*1.0*29^

**INSTALL NAME**
MD*1.0*29
"BLD",8979,0)
MD*1.0*29^CLINICAL PROCEDURES^0^3140402^y
"BLD",8979,1,0)
^^2^2^3120923^
"BLD",8979,1,1,0)
Please see patch MD*1.0*29 on Forum for complete details and installation 
"BLD",8979,1,2,0)
instructions for this patch.
"BLD",8979,4,0)
^9.64PA^^
"BLD",8979,6.3)
22
"BLD",8979,"INID")
n^y^n
"BLD",8979,"INIT")
EN^MDPOST29
"BLD",8979,"KRN",0)
^9.67PA^779.2^20
"BLD",8979,"KRN",.4,0)
.4
"BLD",8979,"KRN",.401,0)
.401
"BLD",8979,"KRN",.402,0)
.402
"BLD",8979,"KRN",.403,0)
.403
"BLD",8979,"KRN",.5,0)
.5
"BLD",8979,"KRN",.84,0)
.84
"BLD",8979,"KRN",3.6,0)
3.6
"BLD",8979,"KRN",3.8,0)
3.8
"BLD",8979,"KRN",9.2,0)
9.2
"BLD",8979,"KRN",9.8,0)
9.8
"BLD",8979,"KRN",9.8,"NM",0)
^9.68A^6^6
"BLD",8979,"KRN",9.8,"NM",1,0)
MDRPCW^^0^B73223005
"BLD",8979,"KRN",9.8,"NM",2,0)
MDRPCW1^^0^B60220184
"BLD",8979,"KRN",9.8,"NM",3,0)
MDRPCWU^^0^B3093767
"BLD",8979,"KRN",9.8,"NM",4,0)
MDHL7U3^^0^B64609594
"BLD",8979,"KRN",9.8,"NM",5,0)
MDPCE2^^0^B24838118
"BLD",8979,"KRN",9.8,"NM",6,0)
MDRPCOW^^0^B28672683
"BLD",8979,"KRN",9.8,"NM","B","MDHL7U3",4)

"BLD",8979,"KRN",9.8,"NM","B","MDPCE2",5)

"BLD",8979,"KRN",9.8,"NM","B","MDRPCOW",6)

"BLD",8979,"KRN",9.8,"NM","B","MDRPCW",1)

"BLD",8979,"KRN",9.8,"NM","B","MDRPCW1",2)

"BLD",8979,"KRN",9.8,"NM","B","MDRPCWU",3)

"BLD",8979,"KRN",19,0)
19
"BLD",8979,"KRN",19.1,0)
19.1
"BLD",8979,"KRN",101,0)
101
"BLD",8979,"KRN",409.61,0)
409.61
"BLD",8979,"KRN",771,0)
771
"BLD",8979,"KRN",779.2,0)
779.2
"BLD",8979,"KRN",870,0)
870
"BLD",8979,"KRN",8989.51,0)
8989.51
"BLD",8979,"KRN",8989.51,"NM",0)
^9.68A^1^1
"BLD",8979,"KRN",8989.51,"NM",1,0)
MDK GUI VERSION^^0
"BLD",8979,"KRN",8989.51,"NM","B","MDK GUI VERSION",1)

"BLD",8979,"KRN",8989.52,0)
8989.52
"BLD",8979,"KRN",8994,0)
8994
"BLD",8979,"KRN",8994,"NM",0)
^9.68A^4^4
"BLD",8979,"KRN",8994,"NM",1,0)
MD TMDLEX^^0
"BLD",8979,"KRN",8994,"NM",2,0)
MD TMDWIDGET^^0
"BLD",8979,"KRN",8994,"NM",3,0)
MD TMDENCOUNTER^^0
"BLD",8979,"KRN",8994,"NM",4,0)
MD TMDCIDC^^0
"BLD",8979,"KRN",8994,"NM","B","MD TMDCIDC",4)

"BLD",8979,"KRN",8994,"NM","B","MD TMDENCOUNTER",3)

"BLD",8979,"KRN",8994,"NM","B","MD TMDLEX",1)

"BLD",8979,"KRN",8994,"NM","B","MD TMDWIDGET",2)

"BLD",8979,"KRN","B",.4,.4)

"BLD",8979,"KRN","B",.401,.401)

"BLD",8979,"KRN","B",.402,.402)

"BLD",8979,"KRN","B",.403,.403)

"BLD",8979,"KRN","B",.5,.5)

"BLD",8979,"KRN","B",.84,.84)

"BLD",8979,"KRN","B",3.6,3.6)

"BLD",8979,"KRN","B",3.8,3.8)

"BLD",8979,"KRN","B",9.2,9.2)

"BLD",8979,"KRN","B",9.8,9.8)

"BLD",8979,"KRN","B",19,19)

"BLD",8979,"KRN","B",19.1,19.1)

"BLD",8979,"KRN","B",101,101)

"BLD",8979,"KRN","B",409.61,409.61)

"BLD",8979,"KRN","B",771,771)

"BLD",8979,"KRN","B",779.2,779.2)

"BLD",8979,"KRN","B",870,870)

"BLD",8979,"KRN","B",8989.51,8989.51)

"BLD",8979,"KRN","B",8989.52,8989.52)

"BLD",8979,"KRN","B",8994,8994)

"BLD",8979,"QDEF")
^^^^NO^^^^NO^^NO
"BLD",8979,"QUES",0)
^9.62^^
"BLD",8979,"REQB",0)
^9.611^6^5
"BLD",8979,"REQB",1,0)
LEX*2.0*80^1
"BLD",8979,"REQB",2,0)
ICD*18.0*57^1
"BLD",8979,"REQB",3,0)
MD*1.0*20^1
"BLD",8979,"REQB",5,0)
PX*1.0*199^1
"BLD",8979,"REQB",6,0)
IBD*3.0*63^1
"BLD",8979,"REQB","B","IBD*3.0*63",6)

"BLD",8979,"REQB","B","ICD*18.0*57",2)

"BLD",8979,"REQB","B","LEX*2.0*80",1)

"BLD",8979,"REQB","B","MD*1.0*20",3)

"BLD",8979,"REQB","B","PX*1.0*199",5)

"INIT")
EN^MDPOST29
"KRN",8989.51,491,-1)
0^1
"KRN",8989.51,491,0)
MDK GUI VERSION^Hemodialysis Version Compatibility^1^Application:Version^Compatible with current server version^0
"KRN",8989.51,491,1)
Y
"KRN",8989.51,491,6)
F^1:40
"KRN",8989.51,491,20,0)
^8989.512^3^3^3070208^^^
"KRN",8989.51,491,20,1,0)
This parameter is used to store the application:versions that are compatible
"KRN",8989.51,491,20,2,0)
with the current server version of Hemodialysis.  Instance format
"KRN",8989.51,491,20,3,0)
of APPLICATION:VERSION  (example: HEMODIALYSIS.EXE:0.0.0.0).
"KRN",8989.51,491,30,0)
^8989.513I^1^1
"KRN",8989.51,491,30,1,0)
1^4.2
"KRN",8994,2366,-1)
0^2
"KRN",8994,2366,0)
MD TMDWIDGET^RPC^MDRPCOW^4^R^^^1^1
"KRN",8994,2370,-1)
0^4
"KRN",8994,2370,0)
MD TMDCIDC^RPC^MDRPCW^4^R^0^^1^1
"KRN",8994,2370,1,0)
^8994.01^11^11^3060627^^^^
"KRN",8994,2370,1,1,0)
This RPC will do the following:
"KRN",8994,2370,1,2,0)
  Input Parameter: RESULTS - (Both Input/Output) Passed in as the array to
"KRN",8994,2370,1,3,0)
                              return the results.
"KRN",8994,2370,1,4,0)
                   OPTION  - (Input) PROC - obtain a list of Procedures
"KRN",8994,2370,1,5,0)
                                            defined for a clinic.
"KRN",8994,2370,1,6,0)
                                     DIAG - obtain a list of diagnosis
"KRN",8994,2370,1,7,0)
                                            defined for a clinic.
"KRN",8994,2370,1,8,0)
                                     SCDISP - Obtain the patient's service
"KRN",8994,2370,1,9,0)
                                              connection and rated disability.
"KRN",8994,2370,1,10,0)
                   DFN     - (Input) Patient internal entry number
"KRN",8994,2370,1,11,0)
                   MDSTUD   - (Input) CP Study internal entry number
"KRN",8994,2370,3,0)
^8994.03^83^83^3060627^^
"KRN",8994,2370,3,1,0)
> D RPC^MDRPCW(.RESULTS,"PROC",162,212)
"KRN",8994,2370,3,2,0)
 
"KRN",8994,2370,3,3,0)
> ZW RESULTS
"KRN",8994,2370,3,4,0)
RESULTS=^TMP("MDRPCW",539023945)
"KRN",8994,2370,3,5,0)
 
"KRN",8994,2370,3,6,0)
 
"KRN",8994,2370,3,7,0)
   @RESULTS@(0)=count of array element (0 if nothing found) 
"KRN",8994,2370,3,8,0)
   @RESULTS@(1)=^group header 
"KRN",8994,2370,3,9,0)
   @RESULTS@(2) = P1 := cpt or icd code / ien of other items 
"KRN",8994,2370,3,10,0)
                  P2 := user defined text 
"KRN",8994,2370,3,11,0)
                  P6 := user defined expanded text to send to PCE 
"KRN",8994,2370,3,12,0)
                  P7 := second code or item defined for line item 
"KRN",8994,2370,3,13,0)
                  P8 := third code or item defined for line item 
"KRN",8994,2370,3,14,0)
                  P9 := associated clinical lexicon term 
"KRN",8994,2370,3,15,0)
                                     
"KRN",8994,2370,3,16,0)
> D ^%G
"KRN",8994,2370,3,17,0)
 
"KRN",8994,2370,3,18,0)
Global ^TMP("MDRPCW",$J
"KRN",8994,2370,3,19,0)
        TMP("MDRPCW",$J
"KRN",8994,2370,3,20,0)
 
"KRN",8994,2370,3,21,0)
^TMP("MDRPCW",539023945,0) = 7
"KRN",8994,2370,3,22,0)
^TMP("MDRPCW",539023945,1) = ^PFT PROCEDURES
"KRN",8994,2370,3,23,0)
^TMP("MDRPCW",539023945,2) = G0125^Lung image (PET)            ^^^^^^^
"KRN",8994,2370,3,24,0)
^TMP("MDRPCW",539023945,3) = S9473^Pulmonary rehabilitation pro^^^^^^^
"KRN",8994,2370,3,25,0)
^TMP("MDRPCW",539023945,4) = S2060^Lobar lung transplantation  ^^^^^^^
"KRN",8994,2370,3,26,0)
^TMP("MDRPCW",539023945,5) = S2060^Lobar lung transplantation  ^^^^^^^
"KRN",8994,2370,3,27,0)
^TMP("MDRPCW",539023945,6) = A4480^Vabra aspirator             ^^^^^^^
"KRN",8994,2370,3,28,0)
^TMP("MDRPCW",539023945,7) = 43450^DILAT ESOPH-SOUND/BOUGIE-1/M^^^^^^^
"KRN",8994,2370,3,29,0)
Global ^
"KRN",8994,2370,3,30,0)
 
"KRN",8994,2370,3,31,0)
> D RPC^MDRPCW(.RESULTS,"DIAG",162,212)
"KRN",8994,2370,3,32,0)
 
"KRN",8994,2370,3,33,0)
> D ^%G
"KRN",8994,2370,3,34,0)
 
"KRN",8994,2370,3,35,0)
Global ^TMP("MDRPCW",$J
"KRN",8994,2370,3,36,0)
        TMP("MDRPCW",$J
"KRN",8994,2370,3,37,0)
^TMP("MDRPCW",539023945,0) = 31
"KRN",8994,2370,3,38,0)
^TMP("MDRPCW",539023945,1) = ^PFT
"KRN",8994,2370,3,39,0)
^TMP("MDRPCW",539023945,2) = 397.1^RHEUM PULMON VALVE DIS^^^^^^^269587
"KRN",8994,2370,3,40,0)
^TMP("MDRPCW",539023945,3) = 417.1^PULMON ARTERY ANEURYSM^^^^^^^269688
"KRN",8994,2370,3,41,0)
^TMP("MDRPCW",539023945,4) = 417.8^PULMON CIRCULAT DIS NEC^^^^^^^269690
"KRN",8994,2370,3,42,0)
^TMP("MDRPCW",539023945,5) = 417.9^PULMON CIRCULAT DIS NOS^^^^^^^269691
"KRN",8994,2370,3,43,0)
^TMP("MDRPCW",539023945,6) = 424.3^PULMONARY VALVE DISORDER^^^^^^^101164
"KRN",8994,2370,3,44,0)
^TMP("MDRPCW",539023945,7) = 516.1^IDIO PULM HEMOSIDEROSIS^^^^^^^61083
"KRN",8994,2370,3,45,0)
^TMP("MDRPCW",539023945,8) = 746.01^CONG PULMON VALV ATRESIA^^^^^^^265805
"KRN",8994,2370,3,46,0)
^TMP("MDRPCW",539023945,9) = 673.82^PULM EMBOL NEC-DEL W P/P^^^^^^^271756
"KRN",8994,2370,3,47,0)
^TMP("MDRPCW",539023945,10) = 747.3^PULMONARY ARTERY ANOM^^^^^^^27406
"KRN",8994,2370,3,48,0)
^TMP("MDRPCW",539023945,11) = 770.3^NB PULMONARY HEMORRHAGE^^^^^^^273240
"KRN",8994,2370,3,49,0)
^TMP("MDRPCW",539023945,12) = 794.2^ABN PULMONARY FUNC STUDY^^^^^^^273442
"KRN",8994,2370,3,50,0)
^TMP("MDRPCW",539023945,13) = 901.41^INJURY PULMONARY ARTERY^^^^^901.42^^275136
"KRN",8994,2370,3,51,0)
^TMP("MDRPCW",539023945,14) = 162.3^MAL NEO UPPER LOBE LUNG^^^^^162.4^162.5^7353
"KRN",8994,2370,3,52,0)
4
"KRN",8994,2370,3,53,0)
^TMP("MDRPCW",539023945,15) = 235.7^UNC BEHAV NEO LUNG^^^^^^^267754
"KRN",8994,2370,3,54,0)
^TMP("MDRPCW",539023945,16) = 875.0^OPEN WOUND OF CHEST^^^^^^^274991
"KRN",8994,2370,3,55,0)
^TMP("MDRPCW",539023945,17) = 162.9^MAL NEO BRONCH/LUNG NOS^^^^^^^73521
"KRN",8994,2370,3,56,0)
^TMP("MDRPCW",539023945,18) = 786.6^CHEST SWELLING/MASS/LUMP^^^^^^^273380
"KRN",8994,2370,3,57,0)
^TMP("MDRPCW",539023945,19) = 518.89^OTHER DISEASE OF LUNG, NEC^^^^^^^87486
"KRN",8994,2370,3,58,0)
^TMP("MDRPCW",539023945,20) = ^BRONCHOSCOPY
"KRN",8994,2370,3,59,0)
^TMP("MDRPCW",539023945,21) = 012.20^ISOL TRACHEAL TB-UNSPEC^^^^^012.21^^266107
"KRN",8994,2370,3,60,0)
^TMP("MDRPCW",539023945,22) = 012.22^ISOL TRACH TB-EXAM UNKN^^^^^^^266109
"KRN",8994,2370,3,61,0)
^TMP("MDRPCW",539023945,23) = 012.23^ISOLAT TRACH TB-MICRO DX^^^^^^^266110
"KRN",8994,2370,3,62,0)
^TMP("MDRPCW",539023945,24) = 012.24^ISOL TRACHEAL TB-CULT DX^^^^^^^266111
"KRN",8994,2370,3,63,0)
^TMP("MDRPCW",539023945,25) = 748.61^CONGEN BRONCHIECTASIS^^^^^^^265478
"KRN",8994,2370,3,64,0)
^TMP("MDRPCW",539023945,26) = 011.50^TB BRONCHIECTASIS-UNSPEC^^^^^011.51^^266056
"KRN",8994,2370,3,65,0)
^TMP("MDRPCW",539023945,27) = 784.1^THROAT PAIN^^^^^^^276881
"KRN",8994,2370,3,66,0)
^TMP("MDRPCW",539023945,28) = 784.8^HEMORRHAGE FROM THROAT^^^^^^^273371
"KRN",8994,2370,3,67,0)
^TMP("MDRPCW",539023945,29) = 034.0^STREP SORE THROAT^^^^^^^114610
"KRN",8994,2370,3,68,0)
^TMP("MDRPCW",539023945,30) = 466.11^AC. BRONCH/RESP SYNCYT V (RSV)^^^^^466.19^^
"KRN",8994,2370,3,69,0)
304309
"KRN",8994,2370,3,70,0)
^TMP("MDRPCW",539023945,31) = 530.10^ESOPHAGITIS, UNSP.^^^^^^^295809
"KRN",8994,2370,3,71,0)
Global ^
"KRN",8994,2370,3,72,0)
 
"KRN",8994,2370,3,73,0)
> D RPC^MDRPCW(.RESULTS,"SCDISP",17,212)
"KRN",8994,2370,3,74,0)
 
"KRN",8994,2370,3,75,0)
   @RESULTS@(n)="Lines of text"
"KRN",8994,2370,3,76,0)
  
"KRN",8994,2370,3,77,0)
> D ^%G
"KRN",8994,2370,3,78,0)
 
"KRN",8994,2370,3,79,0)
Global ^TMP("MDRPCW",$J
"KRN",8994,2370,3,80,0)
        TMP("MDRPCW",$J
"KRN",8994,2370,3,81,0)
^TMP("MDRPCW",539023945,1) = Service Connected: 50%
"KRN",8994,2370,3,82,0)
^TMP("MDRPCW",539023945,2) = Rated Disabilities: NONE STATED
"KRN",8994,2370,3,83,0)
Global ^
"KRN",8994,2371,-1)
0^1
"KRN",8994,2371,0)
MD TMDLEX^LEX^MDRPCW1^4^R^^^1^1
"KRN",8994,2371,1,0)
^8994.01^1^1^3120923^^^^
"KRN",8994,2371,1,1,0)
This RPC will return a list of CPT or ICD for a search typed in.
"KRN",8994,2371,2,0)
^8994.02A^3^3
"KRN",8994,2371,2,1,0)
MDSRCH^4^^1^1
"KRN",8994,2371,2,1,1,0)
^8994.021^1^1^3050622^^
"KRN",8994,2371,2,1,1,1,0)
This is the text typed in for the look-up.
"KRN",8994,2371,2,2,0)
MDAPP^4^^1^2
"KRN",8994,2371,2,2,1,0)
^8994.021^1^1^3050714^^^
"KRN",8994,2371,2,2,1,1,0)
This is the application indicator.  It is either "CPT" or "ICD".
"KRN",8994,2371,2,3,0)
STUDY^1^^1^3
"KRN",8994,2371,2,3,1,0)
^8994.021^2^2^3120923^^
"KRN",8994,2371,2,3,1,1,0)
This is a required field to obtain the Patient Study # which will be used 
"KRN",8994,2371,2,3,1,2,0)
to check the PCE visit date.
"KRN",8994,2371,2,"B","MDAPP",2)

"KRN",8994,2371,2,"B","MDSRCH",1)

"KRN",8994,2371,2,"B","STUDY",3)

"KRN",8994,2371,2,"PARAMSEQ",1,1)

"KRN",8994,2371,2,"PARAMSEQ",2,2)

"KRN",8994,2371,2,"PARAMSEQ",3,3)

"KRN",8994,2371,3,0)
^8994.03^14^14^3120923^^^^
"KRN",8994,2371,3,1,0)
^TMP("MDLEX",$J,#)=P1 - CPT/ICD Code
"KRN",8994,2371,3,2,0)
                   P2 - Internal Entry Number
"KRN",8994,2371,3,3,0)
                   P3 - Lexicon text
"KRN",8994,2371,3,4,0)
 
"KRN",8994,2371,3,5,0)
>D LEX^MDRPCW1(.RESULTS,"BORE","CPT")
"KRN",8994,2371,3,6,0)
 
"KRN",8994,2371,3,7,0)
>ZW RESULTS
"KRN",8994,2371,3,8,0)
RESULTS="^TMP("MDLEX",539152953)"
"KRN",8994,2371,3,9,0)
 
"KRN",8994,2371,3,10,0)
>D ^%G
"KRN",8994,2371,3,11,0)
 
"KRN",8994,2371,3,12,0)
Global ^TMP("MDLEX",$J -- NOTE: translation in effect
"KRN",8994,2371,3,13,0)
^TMP("MDLEX",539152953,1)=86618^302213^Borella Burgdorferi (Lyme Disease) 
"KRN",8994,2371,3,14,0)
Antibody (CP T-4 86618)
"KRN",8994,2372,-1)
0^3
"KRN",8994,2372,0)
MD TMDENCOUNTER^GETENC^MDRPCW1^4^R^^^1^1
"KRN",8994,2372,1,0)
^8994.01^1^1^3050715^^^
"KRN",8994,2372,1,1,0)
This remote procedure will return the existing data in an encounter.
"KRN",8994,2372,2,0)
^8994.02A^1^1
"KRN",8994,2372,2,1,0)
STUDY^4^^1^1
"KRN",8994,2372,2,1,1,0)
^8994.021^1^1^3050715^^^
"KRN",8994,2372,2,1,1,1,0)
This is the CP Study internal entry number.
"KRN",8994,2372,2,"B","STUDY",1)

"KRN",8994,2372,2,"PARAMSEQ",1,1)

"KRN",8994,2372,3,0)
^8994.03^59^59^3050715^^^
"KRN",8994,2372,3,1,0)
The result is returned in ^TMP("MDENC",$J) global.
"KRN",8994,2372,3,2,0)
 
"KRN",8994,2372,3,3,0)
^TMP("MDENC",$J,1)="SC";0/1^0/1;"AO";0/1^0/1;"IR";0/1^0/1;"EC";0/1^0/
"KRN",8994,2372,3,4,0)
1;"MST";0/1^0/1;"HNC";0/1^0/1;"CV";0/1^0/1
"KRN",8994,2372,3,5,0)
     P1 = "SC" - Service Connected
"KRN",8994,2372,3,6,0)
     P2 = first "^" piece 1 if the condition can be answered
"KRN",8994,2372,3,7,0)
                      0 if the condition should be null not asked
"KRN",8994,2372,3,8,0)
          second "^" piece - If Scheduling has the answer, 1 = yes 0 = no
"KRN",8994,2372,3,9,0)
     P3 = "AO" - Agent Orange Exposure
"KRN",8994,2372,3,10,0)
     P4 = first "^" piece 1 if the condition can be answered
"KRN",8994,2372,3,11,0)
                      0 if the condition should be null not asked
"KRN",8994,2372,3,12,0)
          second "^" piece - If Scheduling has the answer, 1 = yes 0 = no
"KRN",8994,2372,3,13,0)
     P5 = "IR" - Ionizing Radiation Exposure
"KRN",8994,2372,3,14,0)
     P6 = first "^" piece 1 if the condition can be answered
"KRN",8994,2372,3,15,0)
                      0 if the condition should be null not asked
"KRN",8994,2372,3,16,0)
          second "^" piece - If Scheduling has the answer, 1 = yes 0 = no
"KRN",8994,2372,3,17,0)
     P7 = "EC" - Environmental Contaminants
"KRN",8994,2372,3,18,0)
     P8 = first "^" piece 1 if the condition can be answered
"KRN",8994,2372,3,19,0)
                      0 if the condition should be null not asked
"KRN",8994,2372,3,20,0)
          second "^" piece - If Scheduling has the answer, 1 = yes 0 = no
"KRN",8994,2372,3,21,0)
     P9 = "HNC" - Head and/or Neck Cancer
"KRN",8994,2372,3,22,0)
    P10 = first "^" piece 1 if the condition can be answered
"KRN",8994,2372,3,23,0)
                      0 if the condition should be null not asked
"KRN",8994,2372,3,24,0)
          second "^" piece - If Scheduling has the answer, 1 = yes 0 = no
"KRN",8994,2372,3,25,0)
    P11 = "MST" - Military Sexual Trauma
"KRN",8994,2372,3,26,0)
    P12 = first "^" piece 1 if the condition can be answered
"KRN",8994,2372,3,27,0)
                      0 if the condition should be null not asked
"KRN",8994,2372,3,28,0)
          second "^" piece - If Scheduling has the answer, 1 = yes 0 = no
"KRN",8994,2372,3,29,0)
    P13 = "CV" - Combat Veteran
"KRN",8994,2372,3,30,0)
    P14 = first "^" piece 1 if the condition can be answered
"KRN",8994,2372,3,31,0)
                          0 if the condition should be null not asked
"KRN",8994,2372,3,32,0)
          second "^" piece - If Scheduling has the answer, 1 = yes 0 = no
"KRN",8994,2372,3,33,0)
  
"KRN",8994,2372,3,34,0)
^TMP("MDENC",$J,n)="PRV"^CODE^^NARR^^Primary (1=Yes,0=No)
"KRN",8994,2372,3,35,0)
     P1 = "PRV"- Provider segment
"KRN",8994,2372,3,36,0)
     P2 = CODE - New Person internal Entry Number
"KRN",8994,2372,3,37,0)
     P3 = Null
"KRN",8994,2372,3,38,0)
     P4 = NARR - Provider name
"KRN",8994,2372,3,39,0)
     P5 = Null
"KRN",8994,2372,3,40,0)
     P6 = Primary - 1/0/null (1=Yes,0/Null=No)
"KRN",8994,2372,3,41,0)
 
"KRN",8994,2372,3,42,0)
                  ="POV"^ICD9 IEN^ICD9 CODE^provider narrative category^
"KRN",8994,2372,3,43,0)
provider narrative (Short Description)^Primary (1=Yes,0/Null=No)
"KRN",8994,2372,3,44,0)
     P1 = "POV" - ICD segment
"KRN",8994,2372,3,45,0)
     P2 = ICD internal entry number
"KRN",8994,2372,3,46,0)
     P3 = ICD9 Code
"KRN",8994,2372,3,47,0)
     P4 = Provider Narrative Category
"KRN",8994,2372,3,48,0)
     P5 = Short Description
"KRN",8994,2372,3,49,0)
     P6 = Primary - 1/0/null (1=Yes,0/Null=No)
"KRN",8994,2372,3,50,0)
 
"KRN",8994,2372,3,51,0)
                  ="CPT"^CPT IEN^CPT CODE^provider narrative category^
"KRN",8994,2372,3,52,0)
provider narrative (Short Description)^^Quantity
"KRN",8994,2372,3,53,0)
     P1 = "CPT" - CPT segment
"KRN",8994,2372,3,54,0)
     P2 = CPT internal entry number
"KRN",8994,2372,3,55,0)
     P3 = CPT Code
"KRN",8994,2372,3,56,0)
     P4 = Provider Narrative Category (CPT Category Grouping)
"KRN",8994,2372,3,57,0)
     P5 = Short Description
"KRN",8994,2372,3,58,0)
     P6 = null
"KRN",8994,2372,3,59,0)
     P7 = Quantity
"MBREQ")
0
"ORD",16,8994)
8994;16;1;;;;;;;RPCDEL^XPDIA1
"ORD",16,8994,0)
REMOTE PROCEDURE
"ORD",20,8989.51)
8989.51;20;;;PAR1E1^XPDTA2;PAR1F1^XPDIA3;PAR1E1^XPDIA3;PAR1F2^XPDIA3;;PAR1DEL^XPDIA3(%)
"ORD",20,8989.51,0)
PARAMETER DEFINITION
"PKG",205,-1)
1^1
"PKG",205,0)
CLINICAL PROCEDURES^MD^Clinical Procedures
"PKG",205,20,0)
^9.402P^^
"PKG",205,22,0)
^9.49I^1^1
"PKG",205,22,1,0)
1.0^3040521^3060905^66481
"PKG",205,22,1,"PAH",1,0)
29^3140402^100831
"PKG",205,22,1,"PAH",1,1,0)
^^2^2^3140402
"PKG",205,22,1,"PAH",1,1,1,0)
Please see patch MD*1.0*29 on Forum for complete details and installation 
"PKG",205,22,1,"PAH",1,1,2,0)
instructions for this patch.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
7
"RTN","MDHL7U3")
0^4^B64609594^B65415989
"RTN","MDHL7U3",1,0)
MDHL7U3 ;HOIFO/WAA - Utilities for CP to process HL7 messages ;02/17/10  15:59
"RTN","MDHL7U3",2,0)
 ;;1.0;CLINICAL PROCEDURES;**6,21,29**;Apr 01, 2004;Build 22
"RTN","MDHL7U3",3,0)
 ; Reference DBIA #2729 [Supported]  for XMXPAI
"RTN","MDHL7U3",4,0)
 ; Reference DBIA #4262 [Supported] for HLUOPT2 call.
"RTN","MDHL7U3",5,0)
 ; Reference DBIA #3244 [Subscription] for MSH node of HLMA file (#773).
"RTN","MDHL7U3",6,0)
 ; Reference DBIA #3273 [Subscription] for reference HLMA of file (#773).
"RTN","MDHL7U3",7,0)
 ; Reference DBIA #10138 [Supported] for reference of HL file (#772).
"RTN","MDHL7U3",8,0)
 ; Reference DBIA #1131 [Supported] for XMB("NETNAME") reference
"RTN","MDHL7U3",9,0)
 ; Reference DBIA #1995 [Supported] for ICPTCOD to handle CPT Codes call
"RTN","MDHL7U3",10,0)
 ; Reference DBIA #10060 [Supported] NEW PERSON FILE (#200) Lookup.
"RTN","MDHL7U3",11,0)
 ; Reference DBIA #10111 [Supported] for FILE 3.8 call
"RTN","MDHL7U3",12,0)
 ; Reference DBIA #10103 [Supported] for XLFDT call
"RTN","MDHL7U3",13,0)
 ;
"RTN","MDHL7U3",14,0)
HL7CHK(MDD702) ; Check to see of there is an entry in 703.1 for a patient.
"RTN","MDHL7U3",15,0)
 N X
"RTN","MDHL7U3",16,0)
 S X="1^"
"RTN","MDHL7U3",17,0)
 D
"RTN","MDHL7U3",18,0)
 . N Y
"RTN","MDHL7U3",19,0)
 . I $G(^MDD(702,MDD702,0))="" S X="-1^No Entry in 702." Q
"RTN","MDHL7U3",20,0)
 . I $D(^MDD(703.1,"ASTUDYID",MDD702))=0 Q
"RTN","MDHL7U3",21,0)
 . S Y=0
"RTN","MDHL7U3",22,0)
 . S Y=$O(^MDD(703.1,"ASTUDYID",MDD702,Y)) I Y>0 S X="-1^This Study has Data on file."
"RTN","MDHL7U3",23,0)
 . Q
"RTN","MDHL7U3",24,0)
 Q X
"RTN","MDHL7U3",25,0)
XVERT(MDA,MDB) ; Strip out blank Lines
"RTN","MDHL7U3",26,0)
 Q:MDA=""
"RTN","MDHL7U3",27,0)
 Q:MDB=""
"RTN","MDHL7U3",28,0)
 Q:$G(^TMP($J,MDA,1))
"RTN","MDHL7U3",29,0)
 N I,CNT,CNT2,NODE,FLG
"RTN","MDHL7U3",30,0)
 S (CNT,I,FLG)=0
"RTN","MDHL7U3",31,0)
 F  S I=$O(^TMP($J,MDA,I)) Q:I<1  D
"RTN","MDHL7U3",32,0)
 . S NODE=$TR(^TMP($J,MDA,I),$C(10),"")
"RTN","MDHL7U3",33,0)
 . I NODE=" " S NODE=""
"RTN","MDHL7U3",34,0)
 . I NODE="" S FLG=0 Q
"RTN","MDHL7U3",35,0)
 . I FLG  D  Q
"RTN","MDHL7U3",36,0)
 . . S CNT2=CNT2+1
"RTN","MDHL7U3",37,0)
 . . S ^TMP($J,MDB,CNT,CNT2)=NODE
"RTN","MDHL7U3",38,0)
 . . Q
"RTN","MDHL7U3",39,0)
 . I 'FLG D  Q
"RTN","MDHL7U3",40,0)
 . . S CNT=CNT+1
"RTN","MDHL7U3",41,0)
 . . S ^TMP($J,MDB,CNT)=NODE
"RTN","MDHL7U3",42,0)
 . . S FLG=1,CNT2=0
"RTN","MDHL7U3",43,0)
 . . Q
"RTN","MDHL7U3",44,0)
 . Q
"RTN","MDHL7U3",45,0)
 Q
"RTN","MDHL7U3",46,0)
 ;
"RTN","MDHL7U3",47,0)
PURGE(MDD7031) ;
"RTN","MDHL7U3",48,0)
 ; This sub-routine will delete HL7 772 Message text after a message
"RTN","MDHL7U3",49,0)
 ; been processed by Imaging.
"RTN","MDHL7U3",50,0)
 Q:'$D(^MDD(703.1,MDD7031,0))  ; No entry found
"RTN","MDHL7U3",51,0)
 S MDD772=$P(^MDD(703.1,MDD7031,0),U,6) Q:MDD772=""
"RTN","MDHL7U3",52,0)
 D DELBODY^HLUOPT2(MDD772,"CLINICAL PROCEDURES message purge","^TMP($J,""IN"")")
"RTN","MDHL7U3",53,0)
 S $P(^MDD(703.1,MDD7031,0),U,6)=""
"RTN","MDHL7U3",54,0)
 Q
"RTN","MDHL7U3",55,0)
 ;
"RTN","MDHL7U3",56,0)
PHY(X,MDIEN) ; Add the doc who did the exam to the report
"RTN","MDHL7U3",57,0)
 Q
"RTN","MDHL7U3",58,0)
 ; This will be implemented with the Doctor Lookup when it comes out.
"RTN","MDHL7U3",59,0)
 N LINE1,LINE
"RTN","MDHL7U3",60,0)
 S LINE1=$P(X,"|",17)
"RTN","MDHL7U3",61,0)
 S LINE=$P(LINE1,"^",2) ; Last
"RTN","MDHL7U3",62,0)
 S LINE=LINE_$S($P(LINE1,"^",3)'="":", "_$P(LINE1,"^",3),1:"") ; First
"RTN","MDHL7U3",63,0)
 S LINE=LINE_$S($P(LINE1,"^",4)'="":" "_$P(LINE1,"^",4),1:"") ; MI
"RTN","MDHL7U3",64,0)
 D ADD(MDIEN,"9",LINE)
"RTN","MDHL7U3",65,0)
 Q
"RTN","MDHL7U3",66,0)
 ;
"RTN","MDHL7U3",67,0)
CPTICD(X,MDIEN) ; Break out CPT and ICD9 codes
"RTN","MDHL7U3",68,0)
 N ICD,CPT
"RTN","MDHL7U3",69,0)
 Q:MDIEN<1
"RTN","MDHL7U3",70,0)
 S CPT=$P(X,"|",45) I CPT'="" D FILECD(MDIEN,CPT,"7")
"RTN","MDHL7U3",71,0)
 S ICD=$P(X,"|",14) I ICD'="" D FILECD(MDIEN,ICD,"8")
"RTN","MDHL7U3",72,0)
 Q
"RTN","MDHL7U3",73,0)
FILECD(MDIEN,CODE,TYPE) ; fILE THE DATA
"RTN","MDHL7U3",74,0)
 N LINE,Y,I,CNT,RESULT
"RTN","MDHL7U3",75,0)
 S CNT=$L(CODE,"~")
"RTN","MDHL7U3",76,0)
 S LINE=""
"RTN","MDHL7U3",77,0)
 F I=1:1:CNT S Y=$P(CODE,"~",I),RESULT=$P(Y,"^",1),LINE(.2,I,0)=RESULT
"RTN","MDHL7U3",78,0)
 S LINE(.2,0)="^^"_CNT_"^"_CNT_"^"_$P(%,".")
"RTN","MDHL7U3",79,0)
 Q:CNT<1  ; file the results if there is any
"RTN","MDHL7U3",80,0)
 D ADD(MDIEN,TYPE,.LINE,CNT)
"RTN","MDHL7U3",81,0)
 Q
"RTN","MDHL7U3",82,0)
 ;
"RTN","MDHL7U3",83,0)
ADD(MDIEN,TYPE,LINE,CNT) ;
"RTN","MDHL7U3",84,0)
 ; Create an entry in the .1 node
"RTN","MDHL7U3",85,0)
 N NODE,X
"RTN","MDHL7U3",86,0)
 S NODE=$G(^MDD(703.1,MDIEN,.1,0)) Q:NODE=""
"RTN","MDHL7U3",87,0)
 S NODE=$P(NODE,"^",3)
"RTN","MDHL7U3",88,0)
 S NODE=NODE+1
"RTN","MDHL7U3",89,0)
 S $P(^MDD(703.1,MDIEN,.1,0),"^",3,4)=NODE_"^"_NODE
"RTN","MDHL7U3",90,0)
 S $P(^MDD(703.1,MDIEN,.1,NODE,0),"^")=TYPE
"RTN","MDHL7U3",91,0)
 D NOW^%DTC
"RTN","MDHL7U3",92,0)
 M ^MDD(703.1,MDIEN,.1,NODE)=LINE
"RTN","MDHL7U3",93,0)
 Q
"RTN","MDHL7U3",94,0)
 ;
"RTN","MDHL7U3",95,0)
MSGIEN(MDHLIENS,MDHLREST) ; Return the message as definded in MDHLIENS  to the array in MDHLREST
"RTN","MDHL7U3",96,0)
 ; Only TCP type messages
"RTN","MDHL7U3",97,0)
 ; input: MDHLIENS= the intern entry number of the message in ^HLMA
"RTN","MDHL7U3",98,0)
 ; MDHLREST = the return array that will contain the whole HL7 message
"RTN","MDHL7U3",99,0)
 ; output: return "1^Message complete" if message was successful, "0^reason" if failed.
"RTN","MDHL7U3",100,0)
 ;
"RTN","MDHL7U3",101,0)
 N MDHLIEN,MDHLI,MDHLCNT,MDHLZ,RET
"RTN","MDHL7U3",102,0)
 S (MDHLCNT,MDHLI,RET)=0
"RTN","MDHL7U3",103,0)
 I $G(MDHLIENS)="" S RET=RET_"^No IEN defined" Q RET  ; Exit because no IEN for ^HLMA was provided
"RTN","MDHL7U3",104,0)
 I $G(MDHLREST)="" S RET=RET_"^No Return ARRAY provided" Q RET  ; Exit because no return array was provided
"RTN","MDHL7U3",105,0)
 I $G(^HLMA(MDHLIENS,0))="" S RET=RET_"^HLMA entry does not exist" Q RET  ; Exit because invalid OR non-EXISTING HLMA ENTRY
"RTN","MDHL7U3",106,0)
 S MDHLIEN=$P(^HLMA(MDHLIENS,0),U)
"RTN","MDHL7U3",107,0)
 I MDHLIEN="" S RET=RET_"^No pointer value to file 772" Q RET  ; No Pointer to 772
"RTN","MDHL7U3",108,0)
 I $G(^HL(772,MDHLIEN,0))="" S RET=RET_"^772 Entry does not exist" Q RET  ; No 772 entry exist
"RTN","MDHL7U3",109,0)
 ;get header
"RTN","MDHL7U3",110,0)
 S MDHLZ=$G(^HLMA(MDHLIENS,"MSH",1,0))
"RTN","MDHL7U3",111,0)
 I MDHLZ="" S RET=RET_"^No MSH segment found" Q RET  ; No MSH was found
"RTN","MDHL7U3",112,0)
 S MDHLCNT=MDHLCNT+1,@MDHLREST@(MDHLCNT)=MDHLZ
"RTN","MDHL7U3",113,0)
 S MDHLCNT=MDHLCNT+1,@MDHLREST@(MDHLCNT)=""
"RTN","MDHL7U3",114,0)
 ;get body
"RTN","MDHL7U3",115,0)
 S MDHLI=0
"RTN","MDHL7U3",116,0)
 F  S MDHLI=$O(^HL(772,MDHLIEN,"IN",MDHLI)) Q:'MDHLI  D
"RTN","MDHL7U3",117,0)
 . S MDHLCNT=MDHLCNT+1
"RTN","MDHL7U3",118,0)
 . S @MDHLREST@(MDHLCNT)=$G(^HL(772,MDHLIEN,"IN",MDHLI,0))
"RTN","MDHL7U3",119,0)
 . Q
"RTN","MDHL7U3",120,0)
 I MDHLCNT'>2 S RET=RET_"^No message body found" Q RET  ; There was no body
"RTN","MDHL7U3",121,0)
 S RET="1^Message complete"
"RTN","MDHL7U3",122,0)
 Q RET
"RTN","MDHL7U3",123,0)
 ;
"RTN","MDHL7U3",124,0)
CICNV(MDIEN,RETURN) ; This subroutine will read the data in 703.1 and return the results
"RTN","MDHL7U3",125,0)
 ;in the indicated global
"RTN","MDHL7U3",126,0)
 N NODE,FLG
"RTN","MDHL7U3",127,0)
 S FLG=1
"RTN","MDHL7U3",128,0)
 Q:MDIEN=""  ; The ien was null
"RTN","MDHL7U3",129,0)
 Q:RETURN=""  ; the array was null
"RTN","MDHL7U3",130,0)
 S ARRAY(0)="0^0"
"RTN","MDHL7U3",131,0)
 I $G(^MDD(703.1,MDIEN,.1,0))="" S FLG=0 Q  ; There is not data.
"RTN","MDHL7U3",132,0)
 ; Start the processing of ICD/POV codes Value is 8
"RTN","MDHL7U3",133,0)
 S NODE=0
"RTN","MDHL7U3",134,0)
 I FLG I $G(^MDD(703.1,MDIEN,.1,0))'="" D
"RTN","MDHL7U3",135,0)
 . F  S NODE=$O(^MDD(703.1,MDIEN,.1,NODE)) Q:NODE<1  D
"RTN","MDHL7U3",136,0)
 . . S TYPE=$P($G(^MDD(703.1,MDIEN,.1,NODE,0),0),"^",1)
"RTN","MDHL7U3",137,0)
 . . I TYPE=8 D PROCESS(MDIEN,NODE,TYPE,.ARRAY)
"RTN","MDHL7U3",138,0)
 . . I TYPE=7 D PROCESS(MDIEN,NODE,TYPE,.ARRAY)
"RTN","MDHL7U3",139,0)
 . . Q
"RTN","MDHL7U3",140,0)
 . Q
"RTN","MDHL7U3",141,0)
 M @RETURN=ARRAY
"RTN","MDHL7U3",142,0)
 Q
"RTN","MDHL7U3",143,0)
PROCESS(MDIEN,NODE,TYPE,ARRAY) ; This will process the data for each
"RTN","MDHL7U3",144,0)
 N CNT,X,CONT,CODE,AR,TP,LOC
"RTN","MDHL7U3",145,0)
 S CNT=0,CONT=0
"RTN","MDHL7U3",146,0)
 F  S CNT=$O(^MDD(703.1,MDIEN,.1,NODE,.2,CNT)) Q:CNT<1  D
"RTN","MDHL7U3",147,0)
 . S CODE=$G(^MDD(703.1,MDIEN,.1,NODE,.2,CNT,0),"") ; Grabbing the ICD9 AND CPT codes
"RTN","MDHL7U3",148,0)
 . I CODE="" Q
"RTN","MDHL7U3",149,0)
 . I TYPE=8 S AR=1,TP="POV",X=$$ICDDATA^ICDXCODE(80,CODE,$P($P(^MDD(703.1,MDIEN,0),"^",3),".",1)) Q:X=""
"RTN","MDHL7U3",150,0)
 . I TYPE=7 S AR=2,TP="CPT",X=$$CPT^ICPTCOD(CODE) Q:X=""  ; Reference DBIA #1995 [Supported] for ICPTCOD to handle CPT Codes call
"RTN","MDHL7U3",151,0)
 . S CONT=CONT+1
"RTN","MDHL7U3",152,0)
 . S ARRAY(AR)=CONT_"^"_CONT
"RTN","MDHL7U3",153,0)
 . I AR=1 D
"RTN","MDHL7U3",154,0)
 . . N DESC,IN,LN
"RTN","MDHL7U3",155,0)
 . . S IN=$P(X,"^",1) Q:IN<1
"RTN","MDHL7U3",156,0)
 . . S DESC=$P(X,"^",4) Q:DESC=""
"RTN","MDHL7U3",157,0)
 . . S I=CONT
"RTN","MDHL7U3",158,0)
 . . S $P(ARRAY(AR,I),"^",1)=TP
"RTN","MDHL7U3",159,0)
 . . S $P(ARRAY(AR,I),"^",2)=$P(X,"^",1)
"RTN","MDHL7U3",160,0)
 . . S $P(ARRAY(AR,I),"^",3)=$P(X,"^",2)
"RTN","MDHL7U3",161,0)
 . . S $P(ARRAY(AR,I),"^",5)=DESC
"RTN","MDHL7U3",162,0)
 . . S $P(ARRAY(AR,I),"^",6)=$S(I=1:1,1:0)
"RTN","MDHL7U3",163,0)
 . . Q
"RTN","MDHL7U3",164,0)
 . I AR=2 D
"RTN","MDHL7U3",165,0)
 . . N DESC,IN,LN,LEX,CPTCNT
"RTN","MDHL7U3",166,0)
 . . S IN=$P(X,"^",1) Q:IN<1
"RTN","MDHL7U3",167,0)
 . . D CPTLEX^MDRPCWU(.LEX,CODE,"CPT")
"RTN","MDHL7U3",168,0)
 . . Q:$D(^TMP("MDLEX",$J))<1
"RTN","MDHL7U3",169,0)
 . . S DESC="",CPTCNT=""
"RTN","MDHL7U3",170,0)
 . . F  S CPTCNT=$O(^TMP("MDLEX",$J,CPTCNT)) Q:CPTCNT<1  D  Q:$L(DESC)>200
"RTN","MDHL7U3",171,0)
 . . . N LINE
"RTN","MDHL7U3",172,0)
 . . . S LINE=$P(^TMP("MDLEX",$J,CPTCNT),"^",3)
"RTN","MDHL7U3",173,0)
 . . . Q:LINE=""
"RTN","MDHL7U3",174,0)
 . . . S DESC=DESC_LINE_" "
"RTN","MDHL7U3",175,0)
 . . . Q
"RTN","MDHL7U3",176,0)
 . . I $L(DESC)>200 S DESC=$E(DESC,1,200)
"RTN","MDHL7U3",177,0)
 . . ; S LN=$G(^ICPT(IN,0),0) Q:LN=""
"RTN","MDHL7U3",178,0)
 . . ; S DESC=$P(X,"^",3) Q:DESC=""  ; DBIA1995 $$CPT^ICPTCOD(CODE) returns X and the second piece of X is the DESC
"RTN","MDHL7U3",179,0)
 . . S I=CNT
"RTN","MDHL7U3",180,0)
 . . S $P(ARRAY(AR,I),"^",1)=TP
"RTN","MDHL7U3",181,0)
 . . S $P(ARRAY(AR,I),"^",2)=$P(X,"^",1)
"RTN","MDHL7U3",182,0)
 . . S $P(ARRAY(AR,I),"^",3)=$P(X,"^",2)
"RTN","MDHL7U3",183,0)
 . . S $P(ARRAY(AR,I),"^",5)=DESC
"RTN","MDHL7U3",184,0)
 . . ; S $P(ARRAY(AR,I),"^",5)=LEX^MDRPCW1(RESULTS,CODE,"CPT") ; 02
"RTN","MDHL7U3",185,0)
 . . S $P(ARRAY(AR,I),"^",7)=$S(I=1:1,1:0)
"RTN","MDHL7U3",186,0)
 . . Q
"RTN","MDHL7U3",187,0)
 . Q
"RTN","MDHL7U3",188,0)
 I $D(ARRAY(1))!$D(ARRAY(2)) S ARRAY(0)="1^1"
"RTN","MDHL7U3",189,0)
 Q
"RTN","MDHL7U3",190,0)
 ;
"RTN","MDHL7U3",191,0)
NOTICE(SUBJECT,TXT,DEVIEN,DUZ) ; This will fire off a mail message to the Indicated mail group saying that a study was deleted
"RTN","MDHL7U3",192,0)
 ;
"RTN","MDHL7U3",193,0)
 N INST,MG,XMTO,XMDUZ,XMSUBJ,XMBODY,N,X
"RTN","MDHL7U3",194,0)
 S MG=0
"RTN","MDHL7U3",195,0)
 S INST=DEVIEN
"RTN","MDHL7U3",196,0)
 I INST>1 S MG=$P($G(^MDS(702.09,INST,0)),"^",2)
"RTN","MDHL7U3",197,0)
 I 'MG!('$$MG^MDHL7U2(MG)) S MG=$$FIND1^DIC(3.8,"","BX","MD DEVICE ERRORS") Q:'MG
"RTN","MDHL7U3",198,0)
 S MG=$$GET1^DIQ(3.8,+MG_",",.01)
"RTN","MDHL7U3",199,0)
 S XMTO="G."_MG_"@"_^XMB("NETNAME"),XMINSTR("FROM")=.5
"RTN","MDHL7U3",200,0)
 S XMBODY="TXT"
"RTN","MDHL7U3",201,0)
 S XMSUBJ=SUBJECT
"RTN","MDHL7U3",202,0)
 D SENDMSG^XMXAPI(DUZ,XMSUBJ,XMBODY,XMTO,.XMINSTR)
"RTN","MDHL7U3",203,0)
 Q
"RTN","MDHL7U3",204,0)
 ;
"RTN","MDHL7U3",205,0)
ALERT(MDSIEN) ; This is to send an e-mail to the main device mail group that a study has been deleted
"RTN","MDHL7U3",206,0)
 D NOW^%DTC
"RTN","MDHL7U3",207,0)
 S SUBJECT="Study "_MDSIEN_" for Patient "_$$GET1^DIQ(702,MDSIEN,.01,"E")_" has been DELETED!"
"RTN","MDHL7U3",208,0)
 S BODY(1)="The following study has been deleted."
"RTN","MDHL7U3",209,0)
 S BODY(2)="         By the USER:       "_$$GET1^DIQ(200,DUZ,.01,"E")
"RTN","MDHL7U3",210,0)
 S BODY(3)="             On Date:       "_$$FMTE^XLFDT(%,1)
"RTN","MDHL7U3",211,0)
 S BODY(4)="           "
"RTN","MDHL7U3",212,0)
 S BODY(5)="                   CP Study Information"
"RTN","MDHL7U3",213,0)
 S BODY(6)="------------------------------------------------------------------------------ "
"RTN","MDHL7U3",214,0)
 S BODY(7)="CP Study ID:       "_MDSIEN
"RTN","MDHL7U3",215,0)
 S BODY(8)="CP Study Def:      "_$$GET1^DIQ(702,MDSIEN,.04,"E")
"RTN","MDHL7U3",216,0)
 S BODY(9)="Created on:        "_$$FMTE^XLFDT($$GET1^DIQ(702,MDSIEN,.02,"I"),1)
"RTN","MDHL7U3",217,0)
 S BODY(10)="Created by:        "_$$GET1^DIQ(702,MDSIEN,.03,"E")
"RTN","MDHL7U3",218,0)
 S BODY(11)="On Instrument:     "_$$GET1^DIQ(702,MDSIEN,.11,"E")
"RTN","MDHL7U3",219,0)
 S BODY(12)="For Patient:       "_$$GET1^DIQ(702,MDSIEN,.01,"E")
"RTN","MDHL7U3",220,0)
 S BODY(13)="        SSN:       "_$E($$GET1^DIQ(702,MDSIEN,.011,"E"),6,9)
"RTN","MDHL7U3",221,0)
 S BODY(14)="        DOB:       "_$$FMTE^XLFDT($$GET1^DIQ(702,MDSIEN,.012,"I"),1)
"RTN","MDHL7U3",222,0)
 S DEVIEN=$$GET1^DIQ(702,MDSIEN,.11,"I")
"RTN","MDHL7U3",223,0)
 Q
"RTN","MDPCE2")
0^5^B24838118^B24598640
"RTN","MDPCE2",1,0)
MDPCE2 ; HOIFO/NCA - Routine For Data Extract For Hemo Dialysis ;1/20/10  10:00
"RTN","MDPCE2",2,0)
 ;;1.0;CLINICAL PROCEDURES;**6,21,29**;Apr 01, 2004;Build 22
"RTN","MDPCE2",3,0)
 ; Integration Agreements:
"RTN","MDPCE2",4,0)
 ; IA# 1889 [Subscription] Create New Visit - DATA2PCE^PXAPI call
"RTN","MDPCE2",5,0)
 ;     1890 [Subscription] Delete existing visit - DELVFILE^PXAPI call
"RTN","MDPCE2",6,0)
 ;     1995 [Supported] ICPTCOD API Call
"RTN","MDPCE2",7,0)
 ;     5699 [Supported] ICDDATA^ICDXCODE calls
"RTN","MDPCE2",8,0)
 ;    10040 [Supported] Hospital Location File Access
"RTN","MDPCE2",9,0)
 ;    10048 [Supported] FILE 9.4 references
"RTN","MDPCE2",10,0)
 ;    10103 [Supported] XLFDT calls
"RTN","MDPCE2",11,0)
 ;
"RTN","MDPCE2",12,0)
EN1(MDENC,MDINST,MDPDTE,MDPR,MDTYP,MDETYP,MDCLOC) ; [Function] PCE Visit Creation
"RTN","MDPCE2",13,0)
 ; Input parameters
"RTN","MDPCE2",14,0)
 ;  1. MDENC [Literal/Required] Billing data array
"RTN","MDPCE2",15,0)
 ;  2. MDINST [Literal/Required] Transaction IEN
"RTN","MDPCE2",16,0)
 ;  3. MDPDTE [Literal/Optional] Procedure Date/Time
"RTN","MDPCE2",17,0)
 ;  4. MDPR [Literal/Required] CP Definition
"RTN","MDPCE2",18,0)
 ;  5. MDTYP [Literal/Required] Type of Visit (Ambulatory or Hospitalization)
"RTN","MDPCE2",19,0)
 ;  6. MDETYP [Literal/Required] Encounter Type (Primary or Ancillary)
"RTN","MDPCE2",20,0)
 ;  7. MDCLOC [Literal/Required] Workload Reporting hospital location
"RTN","MDPCE2",21,0)
 ;
"RTN","MDPCE2",22,0)
 N DATA,DIAG,MDCCOD,MDICDINFO,MDCLIN,MDCLL,MDDESC,MDPERR,MDJ,MDK,MDL,MDLST,MDM,MDNOD,MDOK,MDOK1,MDOK2,MDPKG,MDPROV,MDRES,MDSC,MDSTR,MDV1,MDVISIT,MDDRES K ^TMP("MDPXAPI",$J)
"RTN","MDPCE2",23,0)
 S MDOUT="",(MDOK,MDOK1,MDOK2,MDSC)=0
"RTN","MDPCE2",24,0)
 S MDPKG=$$FIND1^DIC(9.4,"","MX","CLINICAL PROCEDURES")
"RTN","MDPCE2",25,0)
 I 'MDPKG Q "-1^CLINICAL PROCEDURES does not exist in Package File."
"RTN","MDPCE2",26,0)
 I '$D(^MDD(702,MDINST,0)) Q "-1^No Study Record."
"RTN","MDPCE2",27,0)
 S MDSTR=$G(^MDD(702,MDINST,0))
"RTN","MDPCE2",28,0)
 S MDCLIN=$G(^MDD(702,MDINST,1))
"RTN","MDPCE2",29,0)
 S MDRES=""
"RTN","MDPCE2",30,0)
 I +$P(MDCLIN,U) S MDRES=$$DELVFILE^PXAPI("PRV^POV^CPT",+$P(MDCLIN,U),"","CLINICAL PROCEDURES") S MDVISIT=+MDCLIN
"RTN","MDPCE2",31,0)
 ;I +MDRES<0 Q $P(MDRES,"^")_"^Cannot purge existing visit during PCE data set."
"RTN","MDPCE2",32,0)
 S (MDJ,MDK,MDL,MDM)=0,MDJ=MDJ+1,MDPROV=""
"RTN","MDPCE2",33,0)
 I '$G(MDCLOC) S MDCLOC=$$GET1^DIQ(702.01,+MDPR_",",.05,"I") I 'MDCLOC Q "-1^No Hospital Location for CP Definition."
"RTN","MDPCE2",34,0)
 S ^TMP("MDPXAPI",$J,"ENCOUNTER",MDJ,"ENC D/T")=MDPDTE
"RTN","MDPCE2",35,0)
 S ^TMP("MDPXAPI",$J,"ENCOUNTER",MDJ,"PATIENT")=$P(MDSTR,"^",1)
"RTN","MDPCE2",36,0)
 S ^TMP("MDPXAPI",$J,"ENCOUNTER",MDJ,"HOS LOC")=MDCLOC
"RTN","MDPCE2",37,0)
 S ^TMP("MDPXAPI",$J,"ENCOUNTER",MDJ,"SERVICE CATEGORY")=$S(MDTYP="V":"A",1:MDTYP)
"RTN","MDPCE2",38,0)
 S ^TMP("MDPXAPI",$J,"ENCOUNTER",MDJ,"ENCOUNTER TYPE")=MDETYP
"RTN","MDPCE2",39,0)
 I $$GET1^DIQ(44,MDCLOC_",",3,"I") S ^TMP("MDPXAPI",$J,"ENCOUNTER",MDJ,"INSTITUTION")=$$GET1^DIQ(44,MDCLOC_",",3,"I")
"RTN","MDPCE2",40,0)
 S MDLST="" F  S MDLST=$O(MDENC(MDLST)) Q:MDLST=""  S MDNOD=$G(MDENC(MDLST)) D
"RTN","MDPCE2",41,0)
 .I $P(MDNOD,"^")["SC" D  Q
"RTN","MDPCE2",42,0)
 ..S:+$P(MDNOD,";",2) ^TMP("MDPXAPI",$J,"ENCOUNTER",MDJ,"SC")=+$P($P(MDNOD,";",2),U,2) S:+$P($P(MDNOD,";",2),U,2)>0 MDSC=1
"RTN","MDPCE2",43,0)
 ..I $P(MDNOD,";",3)="AO" Q:+MDSC>0  S:+$P(MDNOD,";",4) ^TMP("MDPXAPI",$J,"ENCOUNTER",MDJ,"AO")=+$P($P(MDNOD,";",4),"^",2)
"RTN","MDPCE2",44,0)
 ..I $P(MDNOD,";",5)="IR" Q:+MDSC>0  S:+$P(MDNOD,";",6) ^TMP("MDPXAPI",$J,"ENCOUNTER",MDJ,"IR")=+$P($P(MDNOD,";",6),"^",2)
"RTN","MDPCE2",45,0)
 ..I $P(MDNOD,";",7)="EC" Q:+MDSC>0  S:+$P(MDNOD,";",8) ^TMP("MDPXAPI",$J,"ENCOUNTER",MDJ,"EC")=+$P($P(MDNOD,";",8),"^",2)
"RTN","MDPCE2",46,0)
 ..I $P(MDNOD,";",9)="MST" Q:+MDSC>0  S:+$P(MDNOD,";",10) ^TMP("MDPXAPI",$J,"ENCOUNTER",MDJ,"MST")=+$P($P(MDNOD,";",10),"^",2)
"RTN","MDPCE2",47,0)
 ..I $P(MDNOD,";",11)="HNC" Q:+MDSC>0  S:+$P(MDNOD,";",12) ^TMP("MDPXAPI",$J,"ENCOUNTER",MDJ,"HNC")=+$P($P(MDNOD,";",12),"^",2)
"RTN","MDPCE2",48,0)
 ..I $P(MDNOD,";",13)="CV" Q:+MDSC>0  S:+$P(MDNOD,";",14) ^TMP("MDPXAPI",$J,"ENCOUNTER",MDJ,"CV")=+$P($P(MDNOD,";",14),"^",2)
"RTN","MDPCE2",49,0)
 .I $P(MDNOD,"^")="PRV" I $P(MDNOD,"^",2)'="" D  Q
"RTN","MDPCE2",50,0)
 ..S MDK=MDK+1,^TMP("MDPXAPI",$J,"PROVIDER",MDK,"NAME")=$P(MDNOD,"^",2) S:'MDOK MDOK=1
"RTN","MDPCE2",51,0)
 ..S ^TMP("MDPXAPI",$J,"PROVIDER",MDK,"PRIMARY")=$P(MDNOD,"^",6)
"RTN","MDPCE2",52,0)
 ..S:MDPROV="" MDPROV=$P(MDNOD,"^",2)
"RTN","MDPCE2",53,0)
 ..Q
"RTN","MDPCE2",54,0)
 .I $P(MDNOD,"^")="POV" D  Q
"RTN","MDPCE2",55,0)
 ..Q:$P(MDNOD,"^",3)=""
"RTN","MDPCE2",56,0)
 ..S MDICDINFO=$$ICDDATA^ICDXCODE(80,$P(MDNOD,"^",3),MDPDTE)
"RTN","MDPCE2",57,0)
 ..S MDCCOD=MDICDINFO S MDCCOD=+$P(MDCCOD,"^") Q:+MDCCOD<1
"RTN","MDPCE2",58,0)
 ..S MDL=MDL+1,^TMP("MDPXAPI",$J,"DX/PL",MDL,"DIAGNOSIS")=MDCCOD
"RTN","MDPCE2",59,0)
 ..S ^TMP("MDPXAPI",$J,"DX/PL",MDL,"PRIMARY")=$P(MDNOD,"^",6)
"RTN","MDPCE2",60,0)
 ..S ^TMP("MDPXAPI",$J,"DX/PL",MDL,"ORD/RES")="R"
"RTN","MDPCE2",61,0)
 ..S ^TMP("MDPXAPI",$J,"DX/PL",MDL,"CATEGORY")=$P(MDNOD,"^",4)
"RTN","MDPCE2",62,0)
 ..S DIAG=MDICDINFO
"RTN","MDPCE2",63,0)
 ..S ^TMP("MDPXAPI",$J,"DX/PL",MDL,"NARRATIVE")=$P(DIAG,"^",4)
"RTN","MDPCE2",64,0)
 ..S:MDPROV ^TMP("MDPXAPI",$J,"DX/PL",MDL,"ENC PROVIDER")=MDPROV
"RTN","MDPCE2",65,0)
 ..S:'MDOK1 MDOK1=1
"RTN","MDPCE2",66,0)
 .I $P(MDNOD,"^")="CPT" D  Q
"RTN","MDPCE2",67,0)
 ..Q:$P(MDNOD,U,3)=""
"RTN","MDPCE2",68,0)
 ..S MDCCOD=$$CPT^ICPTCOD($P(MDNOD,U,3)) Q:+MDCCOD<1
"RTN","MDPCE2",69,0)
 ..S MDM=MDM+1 S:'MDOK2 MDOK2=1
"RTN","MDPCE2",70,0)
 ..S MDDESC="",MDDESC=$P(MDNOD,"^",5)
"RTN","MDPCE2",71,0)
 ..S:$L(MDDESC)>230 MDDESC=$E(MDDESC,1,230)
"RTN","MDPCE2",72,0)
 ..S:MDDESC="" MDDESC=$P(MDCCOD,"^",3)
"RTN","MDPCE2",73,0)
 ..S ^TMP("MDPXAPI",$J,"PROCEDURE",MDM,"PROCEDURE")=$P(MDCCOD,"^")
"RTN","MDPCE2",74,0)
 ..S ^TMP("MDPXAPI",$J,"PROCEDURE",MDM,"NARRATIVE")=MDDESC
"RTN","MDPCE2",75,0)
 ..S ^TMP("MDPXAPI",$J,"PROCEDURE",MDM,"CATEGORY")=$P(MDNOD,"^",4)
"RTN","MDPCE2",76,0)
 ..S ^TMP("MDPXAPI",$J,"PROCEDURE",MDM,"QTY")=$P(MDNOD,"^",7)
"RTN","MDPCE2",77,0)
 ..S:MDPROV ^TMP("MDPXAPI",$J,"PROCEDURE",MDM,"ENC PROVIDER")=MDPROV
"RTN","MDPCE2",78,0)
 I (MDOK+MDOK1+MDOK2)=3 S ^TMP("MDPXAPI",$J,"ENCOUNTER",1,"CHECKOUT D/T")=$$NOW^XLFDT
"RTN","MDPCE2",79,0)
 S MDRES=$$DATA2PCE^PXAPI("^TMP(""MDPXAPI"",$J)",MDPKG,"CLINICAL PROCEDURES",.MDVISIT,"","",1,"",.MDPERR)
"RTN","MDPCE2",80,0)
 I MDRES<1 D  Q MDOUT
"RTN","MDPCE2",81,0)
 .S MDOUT=1
"RTN","MDPCE2",82,0)
 .I MDVISIT>0 S MDFDA(702,MDINST_",",.13)=MDVISIT,MDOUT=MDVISIT_"^"_MDCLOC_";"_MDPDTE_";"_MDTYP,MDFDA(702,MDINST_",",.07)=MDTYP_";"_MDPDTE_";"_MDCLOC D FILE^DIE("K","MDFDA")
"RTN","MDPCE2",83,0)
 .K ^TMP("MDPXAPI",$J) Q
"RTN","MDPCE2",84,0)
 S:MDVISIT>0 MDFDA(702,MDINST_",",.13)=MDVISIT
"RTN","MDPCE2",85,0)
 S MDOUT=MDVISIT_"^"_MDCLOC_";"_MDPDTE_";"_MDTYP
"RTN","MDPCE2",86,0)
 S MDFDA(702,MDINST_",",.07)=MDTYP_";"_MDPDTE_";"_MDCLOC
"RTN","MDPCE2",87,0)
 D FILE^DIE("K","MDFDA") K ^TMP("MDPXAPI",$J)
"RTN","MDPCE2",88,0)
 Q MDOUT
"RTN","MDPOST29")
0^^B829545^n/a
"RTN","MDPOST29",1,0)
MDPOST29 ;HOIFO/NCA - Post Init ;2/7/07  16:15
"RTN","MDPOST29",2,0)
 ;;1.0;CLINICAL PROCEDURES;**29**;Apr 01, 2004;Build 22
"RTN","MDPOST29",3,0)
 ; Integration Agreements:
"RTN","MDPOST29",4,0)
 ; IA# 2263 [Supported] XPAR Utilities
"RTN","MDPOST29",5,0)
 ;
"RTN","MDPOST29",6,0)
EN       ; [Procedure] Setup preliminary parameters
"RTN","MDPOST29",7,0)
 ; This submodule is called during the KIDS installation
"RTN","MDPOST29",8,0)
 ; process.
"RTN","MDPOST29",9,0)
 ;
"RTN","MDPOST29",10,0)
 ; New private variables
"RTN","MDPOST29",11,0)
 N MDK,MDKGUI,MDKLST
"RTN","MDPOST29",12,0)
 ; Set current client version
"RTN","MDPOST29",13,0)
 S MDKGUI="1.0.29.22"
"RTN","MDPOST29",14,0)
 ; Deactivate all previous versions from XPAR
"RTN","MDPOST29",15,0)
 D GETLST^XPAR(.MDKLST,"SYS","MDK GUI VERSION")
"RTN","MDPOST29",16,0)
 F MDK=0:0 S MDK=$O(MDKLST(MDK)) Q:'MDK  D
"RTN","MDPOST29",17,0)
 .D EN^XPAR("SYS","MDK GUI VERSION",$P(MDKLST(MDK),"^",1),0)
"RTN","MDPOST29",18,0)
 ; Add and/or activate current client versions
"RTN","MDPOST29",19,0)
 D EN^XPAR("SYS","MDK GUI VERSION","HEMODIALYSIS.EXE:"_MDKGUI,1)
"RTN","MDPOST29",20,0)
 Q
"RTN","MDRPCOW")
0^6^B28672683^B27925312
"RTN","MDRPCOW",1,0)
MDRPCOW ; HOIFO/DP/NCA - Billing Widget ;10/3/05  12:17
"RTN","MDRPCOW",2,0)
 ;;1.0;CLINICAL PROCEDURES;**6,29**;Apr 01, 2004;Build 22
"RTN","MDRPCOW",3,0)
 ; Reference IA# 2240 [Supported] ENCRYP^XUSRB1 call
"RTN","MDRPCOW",4,0)
 ;               2241 [Supported] DECRYP^XUSRB1 call
"RTN","MDRPCOW",5,0)
 ;               5679 [Supported] IMPDATE^LEXU call
"RTN","MDRPCOW",6,0)
 ;               10017 [Supported] ^DD("DD") reference
"RTN","MDRPCOW",7,0)
 ;               10040 [Supported] Hospital Location File Access
"RTN","MDRPCOW",8,0)
 ;               10045 [Supported] XUSHSHP call
"RTN","MDRPCOW",9,0)
 ;               10060 [Supported] FILE 200 references
"RTN","MDRPCOW",10,0)
 ;
"RTN","MDRPCOW",11,0)
RPC(RESULTS,OPTION,P1,P2,P3,P4,P5,P6,P7) ; [Procedure] Main RPC call
"RTN","MDRPCOW",12,0)
 ; RPC: [MD TMDWIDGET]
"RTN","MDRPCOW",13,0)
 ;
"RTN","MDRPCOW",14,0)
 D CLEAN^DILF
"RTN","MDRPCOW",15,0)
 S RESULTS=$NA(^TMP("MDKUTL",$J)) K @RESULTS
"RTN","MDRPCOW",16,0)
 I $T(@OPTION)="" D  Q
"RTN","MDRPCOW",17,0)
 .S @RESULTS@(0)="-1^Error in RPC: MD TMDWIDGET at "_OPTION_U_$T(+0)
"RTN","MDRPCOW",18,0)
 D @OPTION S:'$D(@RESULTS) @RESULTS@(0)="-1^No return"
"RTN","MDRPCOW",19,0)
 D CLEAN^DILF
"RTN","MDRPCOW",20,0)
 Q
"RTN","MDRPCOW",21,0)
 ;
"RTN","MDRPCOW",22,0)
SUBMIT ; Submit a final report to close out an entry in 702
"RTN","MDRPCOW",23,0)
 ;
"RTN","MDRPCOW",24,0)
 ; P1=702 IEN
"RTN","MDRPCOW",25,0)
 ; P2=Encoded E-Sig
"RTN","MDRPCOW",26,0)
 ; P3=Array containing the text for the note
"RTN","MDRPCOW",27,0)
 ;
"RTN","MDRPCOW",28,0)
 I '$D(^MDD(702,+P1,0)) S @RESULTS@(0)="-1^No such study" Q
"RTN","MDRPCOW",29,0)
 I $P(^MDD(702,+P1,0),U,9)=2 S @RESULTS@(0)="-1^Study is in Error status, cannot use study until the error is fixed." Q
"RTN","MDRPCOW",30,0)
 I "016"[$P(^MDD(702,+P1,0),U,9) S @RESULTS@(0)="-1^Cannot submit - not a Dialysis study." Q
"RTN","MDRPCOW",31,0)
 I $D(P3)<1 S @RESULTS@(0)="-1^No note text" Q
"RTN","MDRPCOW",32,0)
 I P2="" D PCE Q
"RTN","MDRPCOW",33,0)
 K ^TMP("MDTXT",$J)
"RTN","MDRPCOW",34,0)
 S X="",Y=1
"RTN","MDRPCOW",35,0)
 F  S X=$O(P3(X)) Q:X=""  S ^TMP("MDTXT",$J,Y)=P3(X),Y=Y+1
"RTN","MDRPCOW",36,0)
 ; a "1^Note Filed" if everything is ok otherwise an error msg
"RTN","MDRPCOW",37,0)
 I P2'="" S P2=$$DECRYP^XUSRB1(P2),P2=$$ENCRYP^XUSRB1(P2)
"RTN","MDRPCOW",38,0)
 ;S @RESULTS@(0)=$$SUBMIT^MDRPCOT2(+P1,P2,$NA(^TMP("MDTXT",$J)),.P7)
"RTN","MDRPCOW",39,0)
 S @RESULTS@(0)=$$SUBMIT^MDRPCOT2(+P1,P2,$NA(^TMP("MDTXT",$J)))
"RTN","MDRPCOW",40,0)
 I +@RESULTS@(0)>0 S @RESULTS@(0)="1^Approval Message"
"RTN","MDRPCOW",41,0)
 N XX S XX="",XX=$$UPDCONS^MDRPCOT1(+$P($G(^MDD(702,+P1,0)),U,5),+$P($G(^MDD(702,+P1,0)),U,6))
"RTN","MDRPCOW",42,0)
 ;
"RTN","MDRPCOW",43,0)
 K ^TMP("MDTXT",$J) Q
"RTN","MDRPCOW",44,0)
 Q
"RTN","MDRPCOW",45,0)
 ;
"RTN","MDRPCOW",46,0)
ESIG ; [Procedure] Verify users electronic signature
"RTN","MDRPCOW",47,0)
 I $G(P1)="" D  Q
"RTN","MDRPCOW",48,0)
 .S @RESULTS@(0)="-1^Must supply electronic signature code"
"RTN","MDRPCOW",49,0)
 S X=$$DECRYP^XUSRB1(P1)
"RTN","MDRPCOW",50,0)
 D HASH^XUSHSHP
"RTN","MDRPCOW",51,0)
 I X'=$$GET1^DIQ(200,DUZ_",",20.4,"I") S @RESULTS@(0)="-1^E-Sig Invalid^"
"RTN","MDRPCOW",52,0)
 E  S @RESULTS@(0)="1^E-Sig Verifed^"_X
"RTN","MDRPCOW",53,0)
 Q
"RTN","MDRPCOW",54,0)
 ;
"RTN","MDRPCOW",55,0)
GETBILL ; Get Billing Data
"RTN","MDRPCOW",56,0)
 Q
"RTN","MDRPCOW",57,0)
 N MDFLD
"RTN","MDRPCOW",58,0)
 ;D BLDFLD^MDXMLFM(.MDFLD,702,".001;;STUDY_ID^.01;;PATIENT_ID")
"RTN","MDRPCOW",59,0)
 ;D BLDFLD^MDXMLFM(.MDFLD,702,".14;;ICD_01^.15;;ICD_02^.16;;ICD_03^.17;;ICD_04^.18;;CPT_01")
"RTN","MDRPCOW",60,0)
 ;D BLDFLD^MDXMLFM(.MDFLD,702,".19;;SC_CONDITION^.2;;MST^.21;;AO_EXPOSURE^.22;;IR_EXPOSURE^.23;;EV_CONTAMINENTS^.24;;HEAD_NECK_CANCER^.25;;COMBAT_VETERAN")
"RTN","MDRPCOW",61,0)
 ;D BLDFLD^MDXMLFM(.MDFLD,702,".26;;PRIMARY_PROVIDER_ID")
"RTN","MDRPCOW",62,0)
 ;D BLDFLD^MDXMLFM(.MDFLD,702,".26:.01;;PRIMARY_PROVIDER_NAME")
"RTN","MDRPCOW",63,0)
 ;D BLDFLD^MDXMLFM(.MDFLD,702,".27;;ATTENDING_PROVIDER_ID")
"RTN","MDRPCOW",64,0)
 ;D BLDFLD^MDXMLFM(.MDFLD,702,".27:.01;;ATTENDING_PROVIDER_NAME")
"RTN","MDRPCOW",65,0)
 ;D LOADONE^MDXMLFM(P1,702,.MDFLD)
"RTN","MDRPCOW",66,0)
 Q
"RTN","MDRPCOW",67,0)
 ;
"RTN","MDRPCOW",68,0)
SETBILL ; Set Billing Data
"RTN","MDRPCOW",69,0)
 N MDFDA,MDERR
"RTN","MDRPCOW",70,0)
 ;F X=0:1:13 S P2(X)=$G(P2(X)) D
"RTN","MDRPCOW",71,0)
 ;.D VAL^DIE(702,+P1_",",.14+(X*.01),"F",P2(X),.MDERR,"MDFDA")
"RTN","MDRPCOW",72,0)
 ;.Q:MDERR'="^"  ; Validated
"RTN","MDRPCOW",73,0)
 ;.S Y="Bad value: "_$$GET1^DID(702,.14+(X*.01),,"LABEL")_" '"_P2(X)_"'"
"RTN","MDRPCOW",74,0)
 ;.S @RESULTS@($O(@RESULTS@(""),-1)+1)=Y
"RTN","MDRPCOW",75,0)
 ;I $D(@RESULTS) S @RESULTS@(0)="-1^Errors filing data" Q
"RTN","MDRPCOW",76,0)
 ;D FILE^DIE("","MDFDA")
"RTN","MDRPCOW",77,0)
 S @RESULTS@(0)="1^Ok"
"RTN","MDRPCOW",78,0)
 Q
"RTN","MDRPCOW",79,0)
 ;
"RTN","MDRPCOW",80,0)
PCE ; Set PCE Data
"RTN","MDRPCOW",81,0)
 ;
"RTN","MDRPCOW",82,0)
 ; P1=702 IEN
"RTN","MDRPCOW",83,0)
 ; P2=Encoded E-Sig
"RTN","MDRPCOW",84,0)
 ; P3=Array containing the text for the note
"RTN","MDRPCOW",85,0)
 ; P7=Array of Billing information
"RTN","MDRPCOW",86,0)
 ;
"RTN","MDRPCOW",87,0)
 N CTR,DFN,MDCON,MDFDA,MDGST,MDL,MDLOC,MDNOTE,MDPDT,MDPROC,MDRESU,MDTITL,MDTSTR,MDVST,MDVSTR,MDWP S CTR=0,MDGST=+P1,MDRESU=""
"RTN","MDRPCOW",88,0)
 I '$D(^MDD(702,+P1,0)) S @RESULTS@(0)="-1^No such study" Q
"RTN","MDRPCOW",89,0)
 ;
"RTN","MDRPCOW",90,0)
 ; Get data to set PCE data
"RTN","MDRPCOW",91,0)
 S (MDTSTR,MDRESU)=$$GETDATA^MDRPCOT2(MDGST)
"RTN","MDRPCOW",92,0)
 ; File Error message
"RTN","MDRPCOW",93,0)
 I +MDRESU<0 S @RESULTS@(0)=MDRESU Q
"RTN","MDRPCOW",94,0)
 I $G(MDTSTR)="" S @RESULTS@(0)="-1^No Data in study to set PCE data." Q
"RTN","MDRPCOW",95,0)
 F MDL="DFN","MDTITL","MDLOC","MDNOTE","MDCON","MDPROC","MDVSTR","MDNVST" D
"RTN","MDRPCOW",96,0)
 .S CTR=CTR+1,@MDL=$P(MDTSTR,"^",CTR)
"RTN","MDRPCOW",97,0)
 S (MDVST,MDRESU)=""
"RTN","MDRPCOW",98,0)
 I 'MDLOC S @RESULTS@(0)="-1^No Hospital Location." Q
"RTN","MDRPCOW",99,0)
 ; Create new visit, if no vstring
"RTN","MDRPCOW",100,0)
 S MDPDT=$$PDT^MDRPCOT1(MDGST)
"RTN","MDRPCOW",101,0)
 S:'MDPDT MDPDT=$P(MDVSTR,";",2) ; If No D/T Performed grab visit D/T
"RTN","MDRPCOW",102,0)
 ; File PCE Error message
"RTN","MDRPCOW",103,0)
 I MDNVST S MDRESU=$$EN1^MDPCE2(.P7,MDGST,$P(MDVSTR,";",2),MDPROC,$P(MDVSTR,";",3),"P",MDLOC) I +MDRESU S MDVST=+MDRESU
"RTN","MDRPCOW",104,0)
 I 'MDNVST S MDVST=$P($G(^MDD(702,+MDGST,1)),U) S MDRESU=$$EN1^MDPCE2(.P7,MDGST,$P(MDVSTR,";",2),MDPROC,$P(MDVSTR,";",3),"P",MDLOC) I +MDRESU S MDVST=+MDRESU
"RTN","MDRPCOW",105,0)
 I +MDRESU<0 S @RESULTS@(0)=MDRESU Q
"RTN","MDRPCOW",106,0)
 ;
"RTN","MDRPCOW",107,0)
 S @RESULTS@(0)="Approval Message"
"RTN","MDRPCOW",108,0)
 Q
"RTN","MDRPCOW",109,0)
GETLOC ; Get the existing hospital location
"RTN","MDRPCOW",110,0)
 N MDCL,MDPR,MDVV
"RTN","MDRPCOW",111,0)
 S MDPR=$P($G(^MDD(702,+P1,0)),U,4)
"RTN","MDRPCOW",112,0)
 S MDVV=$P($G(^MDD(702,+P1,0)),U,7)
"RTN","MDRPCOW",113,0)
 ;S MDCL=$$GET1^DIQ(702.01,+MDPR_",",.05,"I")
"RTN","MDRPCOW",114,0)
 S MDCL=$P(MDVV,";",3)
"RTN","MDRPCOW",115,0)
 I 'MDCL S MDCL=$$GET1^DIQ(702.01,+MDPR_",",.05,"I")
"RTN","MDRPCOW",116,0)
 I 'MDCL S @RESULTS@(0)="-1^No Hospital Location." Q
"RTN","MDRPCOW",117,0)
 S Y=$P(MDVV,";",2) I Y'="" X ^DD("DD")
"RTN","MDRPCOW",118,0)
 S @RESULTS@(0)=MDCL_U_$$GET1^DIQ(44,MDCL_",",.01,"I")_U_Y
"RTN","MDRPCOW",119,0)
 Q
"RTN","MDRPCOW",120,0)
SETLOC ; Set a new clinic location from GUI if non is found.
"RTN","MDRPCOW",121,0)
 N MDVV
"RTN","MDRPCOW",122,0)
 S MDVV=$P($G(^MDD(702,+P1,0)),U,7)
"RTN","MDRPCOW",123,0)
 I P2="" S @RESULTS@(0)="-1^No Location Selected."
"RTN","MDRPCOW",124,0)
 I $L(MDVV,";")=1 S MDVV=";"_MDVV
"RTN","MDRPCOW",125,0)
 S $P(MDVV,";",3)=P2
"RTN","MDRPCOW",126,0)
 S $P(^MDD(702,P1,0),U,7)=MDVV
"RTN","MDRPCOW",127,0)
 S @RESULTS@(0)="1^Okay Location Updated."
"RTN","MDRPCOW",128,0)
 Q
"RTN","MDRPCOW",129,0)
CHECK ; return TRUE if PCE data filled
"RTN","MDRPCOW",130,0)
 N MDIL,MDOKAY,MDCK,MDECTR
"RTN","MDRPCOW",131,0)
 S (MDECTR,MDIL)=0,MDCK="",MDOKAY("POV")="",MDOKAY("CPT")="",MDOKAY("PRV")=""
"RTN","MDRPCOW",132,0)
 F  S MDIL=$O(@P2@(MDIL)) Q:MDIL=""  S MDCK=$G(@P2@(MDIL)) D
"RTN","MDRPCOW",133,0)
 . I $P(MDCK,U,1)="POV" S:$G(MDOKAY("POV"))="" MDOKAY("POV")=1
"RTN","MDRPCOW",134,0)
 . I $P(MDCK,U,1)="CPT" S:$G(MDOKAY("CPT"))="" MDOKAY("CPT")=1
"RTN","MDRPCOW",135,0)
 . I $P(MDCK,U,1)="PRV" S:$G(MDOKAY("PRV"))="" MDOKAY("PRV")=1
"RTN","MDRPCOW",136,0)
 F MDIL="POV","PRV","CPT" S MDECTR=MDECTR+$G(MDOKAY(MDIL))
"RTN","MDRPCOW",137,0)
 I MDECTR<3 S @RESULTS@(0)="-1^Missing PCE data--Review Data Again." Q
"RTN","MDRPCOW",138,0)
 S @RESULTS@(0)=1
"RTN","MDRPCOW",139,0)
 Q
"RTN","MDRPCOW",140,0)
NAME ; Get the person name
"RTN","MDRPCOW",141,0)
 S @RESULTS@(0)="1^"_$$GET1^DIQ(200,+P2_",",.01,"E")
"RTN","MDRPCOW",142,0)
 Q
"RTN","MDRPCOW",143,0)
STAT ; Get the okay status of the CP study
"RTN","MDRPCOW",144,0)
 N MDST,MDGN S MDGN=""
"RTN","MDRPCOW",145,0)
 S MDST=$$GET1^DIQ(702,+P1,.09,"E") S MDGN=MDST
"RTN","MDRPCOW",146,0)
 I $$GET1^DIQ(702,+P1,.09,"I")=2 S MDGN=MDGN_"^"_$$GET1^DIQ(702,+P1,.08,"E")
"RTN","MDRPCOW",147,0)
 S @RESULTS@(0)=MDGN
"RTN","MDRPCOW",148,0)
 Q
"RTN","MDRPCOW",149,0)
STATUS ; [Procedure] Update transaction status
"RTN","MDRPCOW",150,0)
 N MDFDA
"RTN","MDRPCOW",151,0)
 S MDFDA(702,+P1_",",.09)=P2
"RTN","MDRPCOW",152,0)
 D FILE^DIE("","MDFDA")
"RTN","MDRPCOW",153,0)
 S @RESULTS@(0)="1^Done"
"RTN","MDRPCOW",154,0)
 Q
"RTN","MDRPCOW",155,0)
 ;
"RTN","MDRPCOW",156,0)
MDICDDT ; ICD 10 IMPLEMENTATION DATE FOR CP
"RTN","MDRPCOW",157,0)
 ; Call to retrieve ICD-10 Implementation Date
"RTN","MDRPCOW",158,0)
 S @RESULTS@(0)=$$IMPDATE^LEXU("10D")
"RTN","MDRPCOW",159,0)
 Q
"RTN","MDRPCW")
0^1^B73223005^B70357475
"RTN","MDRPCW",1,0)
MDRPCW ; HOIFO/NCA - Calls to AICS ;01/21/10  11:51
"RTN","MDRPCW",2,0)
 ;;1.0;CLINICAL PROCEDURES;**6,21,20,29**;Apr 01, 2004;Build 22
"RTN","MDRPCW",3,0)
 ; Reference Integration Agreement:
"RTN","MDRPCW",4,0)
 ; IA #142 [Subscription] Access ^DIC(31 NAME field (#.01) with FM
"RTN","MDRPCW",5,0)
 ; IA #174 [Subscription] Access DPT(DFN,.372) node.
"RTN","MDRPCW",6,0)
 ; IA #649 [Subscription] Access DG(391 with FM for
"RTN","MDRPCW",7,0)
 ;                        IGNORE VETERAN CHECK field (#.02).
"RTN","MDRPCW",8,0)
 ; IA #1296 [Subscription] IBDF18A call
"RTN","MDRPCW",9,0)
 ; IA #1593 [Subscription] Access to Provider Narrative file
"RTN","MDRPCW",10,0)
 ;                         (#9999999.27)
"RTN","MDRPCW",11,0)
 ; IA #1894 [Subscription] PXAPI call
"RTN","MDRPCW",12,0)
 ; IA #1995 [Supported] ICPTCOD calls
"RTN","MDRPCW",13,0)
 ; IA #2054 [Supported] Call to DILF
"RTN","MDRPCW",14,0)
 ; IA #2056 [Supported] Call to DIQ
"RTN","MDRPCW",15,0)
 ; IA #5699 [Supported] ICDDATA^ICDXCODE calls
"RTN","MDRPCW",16,0)
 ; IA #10060 [Supported] Access File 200
"RTN","MDRPCW",17,0)
 ; IA #10061 [Supported] VADPT calls
"RTN","MDRPCW",18,0)
 ; IA #5747 [Subscription] Access to $$SINFO^ICDEX
"RTN","MDRPCW",19,0)
 ;
"RTN","MDRPCW",20,0)
 Q
"RTN","MDRPCW",21,0)
RPC(RESULTS,OPTION,DFN,MDSTUD) ; [Procedure] Main RPC call
"RTN","MDRPCW",22,0)
 ; RPC: [MD TMDCIDC]
"RTN","MDRPCW",23,0)
 ;
"RTN","MDRPCW",24,0)
 ; DFN=Patient internal entry number in Patient file (#2)
"RTN","MDRPCW",25,0)
 ; MDSTUD=CP study internal entry number
"RTN","MDRPCW",26,0)
 ;
"RTN","MDRPCW",27,0)
 D CLEAN^DILF
"RTN","MDRPCW",28,0)
 S RESULTS=$NA(^TMP("MDRPCW",$J)) K @RESULTS
"RTN","MDRPCW",29,0)
 I $G(MDSTUD)="" S @RESULTS@(0)="-1^No Study." Q
"RTN","MDRPCW",30,0)
 I $T(@OPTION)="" D  Q
"RTN","MDRPCW",31,0)
 .S @RESULTS@(0)="-1^Error in RPC: MD TMDCIDC at "_OPTION_U_$T(+0)
"RTN","MDRPCW",32,0)
 D @OPTION S:'$D(@RESULTS) @RESULTS@(0)="-1^No return"
"RTN","MDRPCW",33,0)
 D CLEAN^DILF
"RTN","MDRPCW",34,0)
 Q
"RTN","MDRPCW",35,0)
PROC ; get list of procedures for clinic
"RTN","MDRPCW",36,0)
 N CLIN,MDARR,MDPR,MDV
"RTN","MDRPCW",37,0)
 S MDV=$$GET1^DIQ(702,+MDSTUD_",",.07,"I")
"RTN","MDRPCW",38,0)
 I $G(MDV)="" S @RESULTS@(0)="-1^No Visit." Q
"RTN","MDRPCW",39,0)
 S MDPR=$$GET1^DIQ(702,+MDSTUD_",",.04,"I")
"RTN","MDRPCW",40,0)
 I '$G(MDPR) S @RESULTS@(0)="-1^No CP Definition." Q
"RTN","MDRPCW",41,0)
 S CLIN=$$GET1^DIQ(702.01,+MDPR_",",.05,"I")
"RTN","MDRPCW",42,0)
 I 'CLIN S CLIN=+$P(MDV,";",3) I 'CLIN S @RESULTS@(0)="-1^No Hospital Location." Q
"RTN","MDRPCW",43,0)
 D GETLST^IBDF18A(CLIN,"DG SELECT CPT PROCEDURE CODES","MDARR",,,1,DT)
"RTN","MDRPCW",44,0)
 N MDIDX,MDMOD,CODES,MDFST S MDIDX=0 M @RESULTS=MDARR
"RTN","MDRPCW",45,0)
 F  S MDIDX=$O(@RESULTS@(MDIDX)) Q:'+MDIDX  D
"RTN","MDRPCW",46,0)
 . I @RESULTS@(MDIDX)="" K @RESULTS@(MDIDX) Q
"RTN","MDRPCW",47,0)
 . S MDMOD=0,CODES="",MDFST=1
"RTN","MDRPCW",48,0)
 . F  S MDMOD=$O(@RESULTS@(MDIDX,"MODIFIER",MDMOD)) Q:(MDMOD="")  D
"RTN","MDRPCW",49,0)
 . . I MDFST S MDFST=0
"RTN","MDRPCW",50,0)
 . . E  S CODES=CODES_";"
"RTN","MDRPCW",51,0)
 . . S CODES=CODES_@RESULTS@(MDIDX,"MODIFIER",MDMOD)
"RTN","MDRPCW",52,0)
 . K @RESULTS@(MDIDX,"MODIFIER")
"RTN","MDRPCW",53,0)
 . I 'MDFST S $P(@RESULTS@(MDIDX),U,12)=CODES
"RTN","MDRPCW",54,0)
 Q
"RTN","MDRPCW",55,0)
DIAG ; get list of diagnoses for clinic
"RTN","MDRPCW",56,0)
 N CLIN,MDARR,MDPR,MDV,MDENCDT,MDCS,MDNAME
"RTN","MDRPCW",57,0)
 S MDV=$$GET1^DIQ(702,+MDSTUD_",",.07,"I")
"RTN","MDRPCW",58,0)
 I $G(MDV)="" S @RESULTS@(0)="-1^No Visit." Q
"RTN","MDRPCW",59,0)
 S MDENCDT=$P($P(MDV,";",2),".",1)
"RTN","MDRPCW",60,0)
 S MDPR=$$GET1^DIQ(702,+MDSTUD_",",.04,"I")
"RTN","MDRPCW",61,0)
 I '$G(MDPR) S @RESULTS@(0)="-1^No CP Definition." Q
"RTN","MDRPCW",62,0)
 S CLIN=$$GET1^DIQ(702.01,+MDPR_",",.05,"I")
"RTN","MDRPCW",63,0)
 I 'CLIN S CLIN=+$P(MDV,";",3) I 'CLIN S @RESULTS@(0)="-1^No Hospital Location." Q
"RTN","MDRPCW",64,0)
 S MDCS=+$$SINFO^ICDEX("DIAG",MDENCDT)
"RTN","MDRPCW",65,0)
 S MDNAME="DG SELECT "_$S(MDCS=1:"ICD-9",MDCS=30:"ICD-10",1:"ICD")_" DIAGNOSIS CODES"
"RTN","MDRPCW",66,0)
 D GETLST^IBDF18A(CLIN,MDNAME,"MDARR",,,,MDENCDT)
"RTN","MDRPCW",67,0)
 M @RESULTS=MDARR
"RTN","MDRPCW",68,0)
 Q
"RTN","MDRPCW",69,0)
SCDISP ; Return Service Connected % and Rated Disabilities
"RTN","MDRPCW",70,0)
 N VAEL,VAERR,I,MDLST,DIS,MDSC,X2
"RTN","MDRPCW",71,0)
 D ELIG^VADPT
"RTN","MDRPCW",72,0)
 S:'+VAEL(3) @RESULTS@(1)="Service Connected: NO"
"RTN","MDRPCW",73,0)
 S:+VAEL(3) @RESULTS@(1)="SC Percent: "_$P(VAEL(3),U,2)_"%"
"RTN","MDRPCW",74,0)
 I 'VAEL(4),'$$GET1^DIQ(391,+VAEL(6)_",",.02,"I") S @RESULTS@(2)="Rated Disabilities: NOT A VETERAN." D KVAR^VADPT Q
"RTN","MDRPCW",75,0)
 S @RESULTS@(2)="Rated Disabilities: "
"RTN","MDRPCW",76,0)
 S I=0,MDLST=0 F  S I=$O(^DPT(DFN,.372,I)) Q:'I  S X2=^(I,0) D
"RTN","MDRPCW",77,0)
 . S DIS=$$GET1^DIQ(31,+X2_",",.01,"E") Q:DIS=""
"RTN","MDRPCW",78,0)
 . S MDSC=$S($P(X2,U,3):"SC",$P(X2,U,3)']"":"not specified",1:"NSC")
"RTN","MDRPCW",79,0)
 . S MDLST=MDLST+1,@RESULTS@(MDLST+2)="                    "_DIS_" ("_$P(X2,U,2)_"%-"_MDSC_")"
"RTN","MDRPCW",80,0)
 I 'MDLST S @RESULTS@(2)=@RESULTS@(2)_"NONE STATED"
"RTN","MDRPCW",81,0)
 D KVAR^VADPT
"RTN","MDRPCW",82,0)
 Q
"RTN","MDRPCW",83,0)
PCEDISP ; Return print text to display PCE data
"RTN","MDRPCW",84,0)
 ;S RESULTS=$NA(^TMP("MDENC",$J)) K @RESULTS
"RTN","MDRPCW",85,0)
 S STUDY=+MDSTUD
"RTN","MDRPCW",86,0)
 N MDDAR,MDDAR2,CAT,CODE,DIAG,GLOARR,MDCCON,MDX802,MDARR,MDCPT,MDCTR,MDDFN,MDENCDT,MDFLST,MDICD,MDLC,MDLL,MDLOCN,MDPROV,MDRP,MDRST,MDVST,MDVSTR,QTY,MDX,MDX0,MDX1,S S S=";"
"RTN","MDRPCW",87,0)
 N DESC,GDIAG,LLB,MDDDN,MDDDV,MDCK,MDNCTR,MDPFLG,MDCLL,MDDESC S (MDCK,MDPFLG)=0
"RTN","MDRPCW",88,0)
 Q:'$G(STUDY)
"RTN","MDRPCW",89,0)
 Q:'$G(^MDD(702,+STUDY,0))
"RTN","MDRPCW",90,0)
 D NOW^%DTC S MDDEF=% K % S MDCTR=0
"RTN","MDRPCW",91,0)
 K ^TMP("MDDAR",$J),^TMP("MDLEX",$J),GLOARR,MDFLST
"RTN","MDRPCW",92,0)
 S MDX=$G(^MDD(702,+STUDY,0)),MDX1=$G(^(1)),MDCCON=$P(MDX,U,5)
"RTN","MDRPCW",93,0)
 S MDVST=$P(MDX1,U),MDDFN=$P(MDX,U) Q:'MDDFN
"RTN","MDRPCW",94,0)
 S:+MDVST MDPFLG=1
"RTN","MDRPCW",95,0)
 S MDVSTR=$P(MDX,U,7),MDDAR=$NA(^TMP("MDDAR",$J)),MDDAR2=$NA(GLOARR),@MDDAR2@("POV",0)=0,@MDDAR2@("CPT",0)=0,MDLC=0
"RTN","MDRPCW",96,0)
 I 'MDVST S MDRP=0 F  S MDRP=$O(^MDD(702,STUDY,.1,MDRP)) Q:'MDRP  D
"RTN","MDRPCW",97,0)
 .S MDRST=$P($G(^MDD(702,STUDY,.1,+MDRP,0)),"^",3)
"RTN","MDRPCW",98,0)
 .I +MDRST D CICNV^MDHL7U3(+MDRST,.MDDAR) D SETGLO^MDRPCW1(.MDDAR,.MDDAR2)
"RTN","MDRPCW",99,0)
 .K ^TMP("MDDAR",$J) Q
"RTN","MDRPCW",100,0)
 I 'MDVST&(+$G(@MDDAR2@("POV",0))>0) F MDLL=1:1:+$G(@MDDAR2@("POV",0)) S MDLC=MDLC+1,MDFLST(MDLC)=$G(@MDDAR2@("POV",MDLL))
"RTN","MDRPCW",101,0)
 I 'MDVST&(+$G(@MDDAR2@("CPT",0))>0) F MDLL=1:1:+$G(@MDDAR2@("CPT",0)) S MDLC=MDLC+1,MDFLST(MDLC)=$G(@MDDAR2@("CPT",MDLL))
"RTN","MDRPCW",102,0)
 I MDVST>0 S MDENCDT=$P(MDVSTR,";",2),MDLOCN=$P(MDVSTR,";",3)
"RTN","MDRPCW",103,0)
 ;E  S MDENCDT=$$PDT^MDRPCOT1(STUDY)
"RTN","MDRPCW",104,0)
 E  S MDENCDT=$P(MDVSTR,";",2)
"RTN","MDRPCW",105,0)
 S:$L(MDVSTR,";")=1 MDVSTR=";"_MDVSTR
"RTN","MDRPCW",106,0)
 S MDVSTR=$$GETVSTR^MDRPCOT1(MDDFN,MDVSTR,+$P(MDX,U,4),$P(MDX,U,2)),MDLOCN=$P(MDVSTR,";",1)
"RTN","MDRPCW",107,0)
 S:'MDENCDT MDENCDT=$P(MDVSTR,";",2)
"RTN","MDRPCW",108,0)
 S:'MDENCDT MDENCDT=MDDEF
"RTN","MDRPCW",109,0)
 S:'MDLOCN MDLOCN=$P(MDVSTR,";")
"RTN","MDRPCW",110,0)
 S MDCTR=MDCTR+1,@RESULTS@(MDCTR)="Visit #: "_$S(MDVST>0:MDVST,1:"")
"RTN","MDRPCW",111,0)
 I '+MDVST S MDCTR=MDCTR+1,@RESULTS@(MDCTR)="Encounter Date/Time: "_$E(MDENCDT,4,5)_"/"_$E(MDENCDT,6,7)_"/"_$E(MDENCDT,2,3)
"RTN","MDRPCW",112,0)
 I '+MDVST S MDVST=$$GETENC^PXAPI(MDDFN,MDENCDT,MDLOCN),MDVST=$S(+MDVST<1:0,1:+MDVST),MDCTR=MDCTR+1,@RESULTS@(MDCTR)="Visit # For Encounter Date: "_$S(MDVST>0:MDVST,1:"")
"RTN","MDRPCW",113,0)
 I +MDVST>0 D ENCEVENT^PXAPI(MDVST)
"RTN","MDRPCW",114,0)
 I +MDVST>0 S MDPROV=0 F  S MDPROV=$O(^TMP("PXKENC",$J,MDVST,"PRV",MDPROV)) Q:'MDPROV  D
"RTN","MDRPCW",115,0)
 .Q:'MDPFLG
"RTN","MDRPCW",116,0)
 .S MDX0=$G(^TMP("PXKENC",$J,MDVST,"PRV",MDPROV,0))
"RTN","MDRPCW",117,0)
 .S CODE=+$P(MDX0,U)
"RTN","MDRPCW",118,0)
 .I +CODE S MDCTR=MDCTR+1,@RESULTS@(MDCTR)="Provider: "_$$GET1^DIQ(200,+CODE_",",.01,"E")_" "_$S($P(MDX0,U,4)="P":"Primary",1:"")
"RTN","MDRPCW",119,0)
 I +MDVST>0 S MDICD=0 F  S MDICD=$O(^TMP("PXKENC",$J,MDVST,"POV",MDICD)) Q:'MDICD  D
"RTN","MDRPCW",120,0)
 .S MDX0=$G(^TMP("PXKENC",$J,MDVST,"POV",MDICD,0)),MDX802=$G(^(802))
"RTN","MDRPCW",121,0)
 .S CODE=+$G(MDX0,U),GDIAG=$$ICDDATA^ICDXCODE(80,CODE,MDENCDT)
"RTN","MDRPCW",122,0)
 .S:CODE DIAG=$P(GDIAG,U,2)_U_$P(GDIAG,U,4)
"RTN","MDRPCW",123,0)
 .S CAT=$P(MDX802,U)
"RTN","MDRPCW",124,0)
 .S:CAT CAT=$P($G(^AUTNPOV(CAT,0)),U)
"RTN","MDRPCW",125,0)
 .S MDCTR=MDCTR+1,@RESULTS@(MDCTR)="Diagnosis: "_$P(DIAG,U,2)_" "_$S($P(MDX0,U,12)="P":"Primary",1:""),MDCK=MDCK+1
"RTN","MDRPCW",126,0)
 I +MDVST>0 S MDCPT=0 F  S MDCPT=$O(^TMP("PXKENC",$J,MDVST,"CPT",MDCPT)) Q:'MDCPT  D
"RTN","MDRPCW",127,0)
 .S MDX0=$G(^TMP("PXKENC",$J,MDVST,"CPT",MDCPT,0)),MDX802=$G(^(802))
"RTN","MDRPCW",128,0)
 .S CODE=+$G(MDX0,U)
"RTN","MDRPCW",129,0)
 .S:CODE CODE=$$CPT^ICPTCOD(CODE,MDVST)
"RTN","MDRPCW",130,0)
 .S:CODE DIAG=$P(CODE,U,2,3)
"RTN","MDRPCW",131,0)
 .S CAT=$P(MDX802,U)
"RTN","MDRPCW",132,0)
 .S:CAT CAT=$P($G(^AUTNPOV(CAT,0)),U)
"RTN","MDRPCW",133,0)
 .S QTY=$P(MDX0,U,16)
"RTN","MDRPCW",134,0)
 .S MDDESC="" D CPTLEX^MDRPCWU(.RESLT,$P(DIAG,U),"CPT")
"RTN","MDRPCW",135,0)
 .S MDCLL="" F  S MDCLL=$O(^TMP("MDLEX",$J,MDCLL)) Q:MDCLL<1  S MDDESC=$P(^(MDCLL),"^",3)
"RTN","MDRPCW",136,0)
 .S:$L(MDDESC)>230 MDDESC=$E(MDDESC,1,230) K ^TMP("MDLEX",$J),RESLT
"RTN","MDRPCW",137,0)
 .S:MDDESC="" MDDESC=$P(DIAG,U,2)
"RTN","MDRPCW",138,0)
 .S MDCTR=MDCTR+1,@RESULTS@(MDCTR)="CPT: "_MDDESC_"-"_QTY,MDCK=MDCK+1
"RTN","MDRPCW",139,0)
 K ^TMP("PXKENC",$J)
"RTN","MDRPCW",140,0)
 I 'MDVST!(+MDCK<1) D
"RTN","MDRPCW",141,0)
 .S MDDDN=$O(^MDD(702,"ACON",MDCCON,+STUDY),-1),MDVST=0
"RTN","MDRPCW",142,0)
 .I MDDDN D
"RTN","MDRPCW",143,0)
 ..S MDDDV=$P($G(^MDD(702,+MDDDN,0)),U,7)
"RTN","MDRPCW",144,0)
 ..S:$L(MDDDV,";")>1 MDENCDT=$P(MDDDV,";",2),MDVST=+$G(^MDD(702,+MDDDN,1)),MDVST=$S(+MDVST<1:0,1:+MDVST)
"RTN","MDRPCW",145,0)
 ..I +MDVST>0 S MDNCTR=0
"RTN","MDRPCW",146,0)
 ..S MDCTR=MDCTR+1,@RESULTS@(MDCTR)="Previous Study # Used: "_+MDDDN
"RTN","MDRPCW",147,0)
 ..S MDCTR=MDCTR+1,@RESULTS@(MDCTR)="Previous Visit #: "_MDVST_" "_$E(MDENCDT,4,5)_"/"_$E(MDENCDT,6,7)_"/"_$E(MDENCDT,2,3)
"RTN","MDRPCW",148,0)
 I $G(MDFLST(1))'="" S MDLL=0 F  S MDLL=$O(MDFLST(MDLL)) Q:MDLL<1  S:$G(MDFLST(MDLL))'="" MDCTR=MDCTR+1,@RESULTS@(MDCTR)=$G(MDFLST(MDLL))
"RTN","MDRPCW",149,0)
 Q:MDCK>0
"RTN","MDRPCW",150,0)
 Q:'MDVST
"RTN","MDRPCW",151,0)
 D ENCEVENT^PXAPI(MDVST) S:$G(MDNCTR)>0 MDCTR=MDNCTR
"RTN","MDRPCW",152,0)
 S MDPROV=0 F  S MDPROV=$O(^TMP("PXKENC",$J,MDVST,"PRV",MDPROV)) Q:'MDPROV  D
"RTN","MDRPCW",153,0)
 .Q
"RTN","MDRPCW",154,0)
 .S MDX0=$G(^TMP("PXKENC",$J,MDVST,"PRV",MDPROV,0))
"RTN","MDRPCW",155,0)
 .S CODE=+$P(MDX0,U)
"RTN","MDRPCW",156,0)
 .I +CODE S MDCTR=MDCTR+1,@RESULTS@(MDCTR)="PRV"_U_CODE_U_U_$$GET1^DIQ(200,+CODE_",",.01,"E")_U_U_($P(MDX0,U,4)="P")
"RTN","MDRPCW",157,0)
 ;^TMP("MDENC",$J,n)="POV"^ICD9 IEN^ICD9 CODE^provider narrative category^provider narrative (Short Description)^Primary (1=Yes,0=No)
"RTN","MDRPCW",158,0)
 S MDICD=0 F  S MDICD=$O(^TMP("PXKENC",$J,MDVST,"POV",MDICD)) Q:'MDICD  D
"RTN","MDRPCW",159,0)
 .S MDX0=$G(^TMP("PXKENC",$J,MDVST,"POV",MDICD,0)),MDX802=$G(^(802))
"RTN","MDRPCW",160,0)
 .S CODE=+$G(MDX0,U),GDIAG=$$ICDDATA^ICDXCODE(80,CODE,MDENCDT)
"RTN","MDRPCW",161,0)
 .S:CODE DIAG=$P(GDIAG,U,2)_U_$P(GDIAG,U,4)
"RTN","MDRPCW",162,0)
 .S CAT=$P(MDX802,U)
"RTN","MDRPCW",163,0)
 .S:CAT CAT=$P($G(^AUTNPOV(CAT,0)),U)
"RTN","MDRPCW",164,0)
 .S MDCTR=MDCTR+1,@RESULTS@(MDCTR)="Diagnosis: "_$P(DIAG,U,2)_" "_$S($P(MDX0,U,12)="P":"Primary",1:"")
"RTN","MDRPCW",165,0)
 S MDCPT=0 F  S MDCPT=$O(^TMP("PXKENC",$J,MDVST,"CPT",MDCPT)) Q:'MDCPT  D
"RTN","MDRPCW",166,0)
 .S MDX0=$G(^TMP("PXKENC",$J,MDVST,"CPT",MDCPT,0)),MDX802=$G(^(802))
"RTN","MDRPCW",167,0)
 .S CODE=+$G(MDX0,U)
"RTN","MDRPCW",168,0)
 .S:CODE CODE=$$CPT^ICPTCOD(CODE,MDVST)
"RTN","MDRPCW",169,0)
 .S:CODE DIAG=$P(CODE,U,2,3)
"RTN","MDRPCW",170,0)
 .S CAT=$P(MDX802,U)
"RTN","MDRPCW",171,0)
 .S:CAT CAT=$P($G(^AUTNPOV(CAT,0)),U)
"RTN","MDRPCW",172,0)
 .S QTY=$P(MDX0,U,16)
"RTN","MDRPCW",173,0)
 .S MDDESC="" D CPTLEX^MDRPCWU(.RESLT,$P(DIAG,U),"CPT")
"RTN","MDRPCW",174,0)
 .S MDCLL="" F  S MDCLL=$O(^TMP("MDLEX",$J,MDCLL)) Q:MDCLL<1  S MDDESC=$P(^(MDCLL),"^",3)
"RTN","MDRPCW",175,0)
 .S:$L(MDDESC)>230 MDDESC=$E(MDDESC,1,230) K ^TMP("MDLEX",$J),RESLT
"RTN","MDRPCW",176,0)
 .S:MDDESC="" MDDESC=$P(DIAG,U,2)
"RTN","MDRPCW",177,0)
 .S MDCTR=MDCTR+1,@RESULTS@(MDCTR)="CPT: "_MDDESC_"-"_QTY
"RTN","MDRPCW",178,0)
 K ^TMP("PXKENC",$J)
"RTN","MDRPCW",179,0)
 Q
"RTN","MDRPCW",180,0)
TIMEMET ; Check if appointment time is met
"RTN","MDRPCW",181,0)
 N MDNOW,MDTIM,MDV
"RTN","MDRPCW",182,0)
 S MDV=$$GET1^DIQ(702,+MDSTUD_",",.07,"I")
"RTN","MDRPCW",183,0)
 I $G(MDV)="" S @RESULTS@(0)="-1^No Visit." Q
"RTN","MDRPCW",184,0)
 I $L(MDV,";")=1 S MDTIM=MDV
"RTN","MDRPCW",185,0)
 E  S MDTIM=$P(MDV,";",2)
"RTN","MDRPCW",186,0)
 I 'MDTIM S @RESULTS@(0)="-1^No Visit Date/Time." Q
"RTN","MDRPCW",187,0)
 D NOW^%DTC S MDNOW=% K %
"RTN","MDRPCW",188,0)
 I MDNOW<MDTIM S @RESULTS@(0)="0^Appointment/Visit Date/Time not met." Q
"RTN","MDRPCW",189,0)
 S @RESULTS@(0)="1^Appointment/Visit Date/Time have met."
"RTN","MDRPCW",190,0)
 Q
"RTN","MDRPCW1")
0^2^B60220184^B57093327
"RTN","MDRPCW1",1,0)
MDRPCW1 ; HOIFO/NCA - MD TMDENCOUNTER Object ;2/16/10  16:17
"RTN","MDRPCW1",2,0)
 ;;1.0;CLINICAL PROCEDURES;**6,21,20,29**;Apr 01, 2004;Build 22
"RTN","MDRPCW1",3,0)
 ; Reference Integration Agreement:
"RTN","MDRPCW1",4,0)
 ; IA #1573 [Supported] ICDONE^LEXU call
"RTN","MDRPCW1",5,0)
 ; IA #1593 [Subscription] Access to Provider Narrative file
"RTN","MDRPCW1",6,0)
 ;                         (#9999999.27)
"RTN","MDRPCW1",7,0)
 ; IA #1609 [Supported] CONFIG^LEXSET call
"RTN","MDRPCW1",8,0)
 ; IA #1894 [Subscription] PXAPI calls
"RTN","MDRPCW1",9,0)
 ; IA #1995 [Supported] ICPTCOD calls
"RTN","MDRPCW1",10,0)
 ; IA #2056 [Supported] Call to DIQ
"RTN","MDRPCW1",11,0)
 ; IA #2263 [Supported] XPAR calls
"RTN","MDRPCW1",12,0)
 ; IA #2348 [Subscription] SCCOND^PXUTLSCC call
"RTN","MDRPCW1",13,0)
 ; IA #2950 [Supported] LOOK^LEXA call
"RTN","MDRPCW1",14,0)
 ; IA #5699 [Supported] ICDDATA^ICDXCODE calls
"RTN","MDRPCW1",15,0)
 ; IA #10060 [Supported] FILE 200 references
"RTN","MDRPCW1",16,0)
 ; IA #5747 [Supported] $$SINFO^ICDEX
"RTN","MDRPCW1",17,0)
 ;
"RTN","MDRPCW1",18,0)
CPTMODS(RESULTS,MDCPT) ;Return CPT Modifiers for a CPT Code
"RTN","MDRPCW1",19,0)
 N MDARR,MDIDX,MDI,MDNAME
"RTN","MDRPCW1",20,0)
 S RESULTS=$NA(^TMP("MDMODS",$J)) K @RESULTS
"RTN","MDRPCW1",21,0)
 S MDDATE=DT
"RTN","MDRPCW1",22,0)
 I +($$CODM^ICPTCOD(MDCPT,$NA(MDARR),0,MDDATE)),+$D(MDARR) D
"RTN","MDRPCW1",23,0)
 . S MDIDX="",MDI=0
"RTN","MDRPCW1",24,0)
 . F  S MDIDX=$O(MDARR(MDIDX)) Q:(MDIDX="")  D
"RTN","MDRPCW1",25,0)
 . . S MDI=MDI+1,MDNAME=$P(MDARR(MDIDX),U,1)
"RTN","MDRPCW1",26,0)
 . . S @RESULTS@(MDNAME_MDI)=$P(MDARR(MDIDX),U,2)_U_MDNAME_U_MDIDX
"RTN","MDRPCW1",27,0)
 Q
"RTN","MDRPCW1",28,0)
LEX(RESULTS,MDSRCH,MDAPP,STUDY)   ; return list after lexicon lookup
"RTN","MDRPCW1",29,0)
 N CODE,LEX,MDLST,MDI,LEXIEN,MDVAL
"RTN","MDRPCW1",30,0)
 S RESULTS=$NA(^TMP("MDLEX",$J)) K @RESULTS
"RTN","MDRPCW1",31,0)
 Q:'$G(STUDY)
"RTN","MDRPCW1",32,0)
 Q:'$G(^MDD(702,+STUDY,0))
"RTN","MDRPCW1",33,0)
 S MDDATE=$P($P($P(^MDD(702,STUDY,0),"^",7),";",2),".",1)
"RTN","MDRPCW1",34,0)
 S:MDAPP="CPT" MDAPP="CHP" ; LEX PATCH 10
"RTN","MDRPCW1",35,0)
 K ^TMP("LEXSCH",$J)
"RTN","MDRPCW1",36,0)
 I MDAPP="ICD" S MDAPP=$P($$SINFO^ICDEX("DIAG",MDDATE),"^",3)
"RTN","MDRPCW1",37,0)
 D CONFIG^LEXSET(MDAPP,MDAPP,MDDATE)
"RTN","MDRPCW1",38,0)
 D LOOK^LEXA(MDSRCH,MDAPP,1,"",MDDATE)
"RTN","MDRPCW1",39,0)
 I '$D(LEX("LIST",1)) S @RESULTS@(1)="-1^No matches found." Q
"RTN","MDRPCW1",40,0)
 S @RESULTS@(1)=LEX("LIST",1),MDLST=1
"RTN","MDRPCW1",41,0)
 S MDI="" F  S MDI=$O(^TMP("LEXFND",$J,MDI)) Q:MDI'<0  D
"RTN","MDRPCW1",42,0)
 . S LEXIEN=$O(^TMP("LEXFND",$J,MDI,0))
"RTN","MDRPCW1",43,0)
 . S MDLST=MDLST+1,@RESULTS@(MDLST)=LEXIEN_U_^TMP("LEXFND",$J,MDI,LEXIEN)
"RTN","MDRPCW1",44,0)
 K ^TMP("LEXFND",$J),^TMP("LEXHIT",$J)
"RTN","MDRPCW1",45,0)
 S MDI="" F  S MDI=$O(@RESULTS@(MDI)) Q:'MDI  S MDVAL=$G(@RESULTS@(MDI)) D
"RTN","MDRPCW1",46,0)
 . I MDAPP="ICD"!(MDAPP="10D") S CODE=$$ONE^LEXU(+MDVAL,MDDATE,MDAPP),@RESULTS@(MDI)=CODE_U_MDVAL
"RTN","MDRPCW1",47,0)
 . I MDAPP="CPT"!(MDAPP="CHP") S CODE=$$CPTONE^LEXU(+MDVAL,MDDATE),@RESULTS@(MDI)=CODE_U_MDVAL
"RTN","MDRPCW1",48,0)
 . I CODE="",(MDAPP="CHP") S CODE=$$CPCONE^LEXU(+MDVAL,MDDATE),@RESULTS@(MDI)=CODE_U_MDVAL
"RTN","MDRPCW1",49,0)
 Q
"RTN","MDRPCW1",50,0)
GETENC(RESULTS,STUDY) ; Return the current encounter data entered
"RTN","MDRPCW1",51,0)
 S RESULTS=$NA(^TMP("MDENC",$J)) K @RESULTS
"RTN","MDRPCW1",52,0)
 N MDDAR,MDDAR2,CAT,CODE,DIAG,GLOARR,MDCCON,MDX802,MDARR,MDCPT,MDCTR,MDDFN,MDENCDT,MDFLST,MDICD,MDLC,MDLL,MDLOCN,MDPROV,MDRP,MDRST,MDVST,MDVSTR,QTY,MDX,MDX0,MDX1,S S S=";"
"RTN","MDRPCW1",53,0)
 N GDIAG,LLB,MDDDN,MDDDV,MDCK,RESLT,MDNCTR,MDPFLG,MDCLL,MDDESC S (MDCK,MDPFLG)=0
"RTN","MDRPCW1",54,0)
 Q:'$G(STUDY)
"RTN","MDRPCW1",55,0)
 Q:'$G(^MDD(702,+STUDY,0))
"RTN","MDRPCW1",56,0)
 D NOW^%DTC S MDDEF=% K % S MDCTR=0
"RTN","MDRPCW1",57,0)
 K ^TMP("MDDAR",$J),^TMP("MDLEX",$J),GLOARR,MDFLST
"RTN","MDRPCW1",58,0)
 S MDX=$G(^MDD(702,+STUDY,0)),MDX1=$G(^(1)),MDCCON=$P(MDX,U,5)
"RTN","MDRPCW1",59,0)
 S MDVST=$P(MDX1,U),MDDFN=$P(MDX,U) Q:'MDDFN
"RTN","MDRPCW1",60,0)
 S:+MDVST MDPFLG=1
"RTN","MDRPCW1",61,0)
 S MDVSTR=$P(MDX,U,7),MDDAR=$NA(^TMP("MDDAR",$J)),MDDAR2=$NA(GLOARR),@MDDAR2@("POV",0)=0,@MDDAR2@("CPT",0)=0,MDLC=0
"RTN","MDRPCW1",62,0)
 I 'MDVST S MDRP=0 F  S MDRP=$O(^MDD(702,STUDY,.1,MDRP)) Q:'MDRP  D
"RTN","MDRPCW1",63,0)
 .S MDRST=$P($G(^MDD(702,STUDY,.1,+MDRP,0)),"^",3)
"RTN","MDRPCW1",64,0)
 .I +MDRST D CICNV^MDHL7U3(+MDRST,.MDDAR) D SETGLO(.MDDAR,.MDDAR2)
"RTN","MDRPCW1",65,0)
 .K ^TMP("MDDAR",$J) Q
"RTN","MDRPCW1",66,0)
 I 'MDVST&(+$G(@MDDAR2@("POV",0))>0) F MDLL=1:1:+$G(@MDDAR2@("POV",0)) S MDLC=MDLC+1,MDFLST(MDLC)=$G(@MDDAR2@("POV",MDLL))
"RTN","MDRPCW1",67,0)
 I 'MDVST&(+$G(@MDDAR2@("CPT",0))>0) F MDLL=1:1:+$G(@MDDAR2@("CPT",0)) S MDLC=MDLC+1,MDFLST(MDLC)=$G(@MDDAR2@("CPT",MDLL))
"RTN","MDRPCW1",68,0)
 I MDVST>0 S MDENCDT=$P(MDVSTR,";",2),MDLOCN=$P(MDVSTR,";",3)
"RTN","MDRPCW1",69,0)
 ;E  S MDENCDT=$$PDT^MDRPCOT1(STUDY)
"RTN","MDRPCW1",70,0)
 E  S MDENCDT=$P(MDVSTR,";",2)
"RTN","MDRPCW1",71,0)
 S:$L(MDVSTR,";")=1 MDVSTR=";"_MDVSTR
"RTN","MDRPCW1",72,0)
 S MDVSTR=$$GETVSTR^MDRPCOT1(MDDFN,MDVSTR,+$P(MDX,U,4),$P(MDX,U,2)),MDLOCN=$P(MDVSTR,";",1)
"RTN","MDRPCW1",73,0)
 S:'MDENCDT MDENCDT=$P(MDVSTR,";",2)
"RTN","MDRPCW1",74,0)
 S:'MDENCDT MDENCDT=MDDEF
"RTN","MDRPCW1",75,0)
 S:'MDLOCN MDLOCN=$P(MDVSTR,";")
"RTN","MDRPCW1",76,0)
 D SCCOND^PXUTLSCC(MDDFN,MDENCDT,MDLOCN,MDVST,.MDARR)
"RTN","MDRPCW1",77,0)
 S MDCTR=MDCTR+1
"RTN","MDRPCW1",78,0)
 ; ^TMP("MDENC",$J,n)="SC";0/1^0/1;"AO";0/1^0/1;"IR";0/1^0/1;"EC";0/1^0/1;"MST";0/1^0/1;"HNC";0/1^0/1;"CV";0/1^0/1
"RTN","MDRPCW1",79,0)
 ;first piece 1 if the condition can be answered
"RTN","MDRPCW1",80,0)
 ;            0 if the condition should be null not asked
"RTN","MDRPCW1",81,0)
 ;second piece - If Scheduling has the answer, 1 = yes 0 = no
"RTN","MDRPCW1",82,0)
 S @RESULTS@(MDCTR)="SC"_S_$G(MDARR("SC"))_S_"AO"_S_$G(MDARR("AO"))_S_"IR"_S_$G(MDARR("IR"))_S_"EC"_S_$G(MDARR("EC"))_S_"MST"_S_$G(MDARR("MST"))_S_"HNC"_S_$G(MDARR("HNC"))_S_"CV"_S_$G(MDARR("CV"))
"RTN","MDRPCW1",83,0)
 I 'MDVST S MDVST=$$GETENC^PXAPI(MDDFN,MDENCDT,MDLOCN),MDVST=$S(+MDVST<1:0,1:+MDVST)
"RTN","MDRPCW1",84,0)
 I +MDVST>0 D ENCEVENT^PXAPI(MDVST)
"RTN","MDRPCW1",85,0)
 ;^TMP("MDENC",$J,n)="PRV"^CODE^^NARR^^Primary (1=Yes,0=No)
"RTN","MDRPCW1",86,0)
 I +MDVST>0 S MDPROV=0 F  S MDPROV=$O(^TMP("PXKENC",$J,MDVST,"PRV",MDPROV)) Q:'MDPROV  D
"RTN","MDRPCW1",87,0)
 .S MDX0=$G(^TMP("PXKENC",$J,MDVST,"PRV",MDPROV,0))
"RTN","MDRPCW1",88,0)
 .S CODE=+$P(MDX0,U)
"RTN","MDRPCW1",89,0)
 .I +CODE S MDCTR=MDCTR+1,@RESULTS@(MDCTR)="PRV"_U_CODE_U_U_$$GET1^DIQ(200,+CODE_",",.01,"E")_U_U_($P(MDX0,U,4)="P")
"RTN","MDRPCW1",90,0)
 ;^TMP("MDENC",$J,n)="POV"^ICD9 IEN^ICD9 CODE^provider narrative category^provider narrative (Short Description)^Primary (1=Yes,0=No)
"RTN","MDRPCW1",91,0)
 I +MDVST>0 S MDICD=0 F  S MDICD=$O(^TMP("PXKENC",$J,MDVST,"POV",MDICD)) Q:'MDICD  D
"RTN","MDRPCW1",92,0)
 .S MDX0=$G(^TMP("PXKENC",$J,MDVST,"POV",MDICD,0)),MDX802=$G(^(802))
"RTN","MDRPCW1",93,0)
 .S CODE=+$G(MDX0,U),GDIAG=$$ICDDATA^ICDXCODE(80,CODE,MDENCDT)
"RTN","MDRPCW1",94,0)
 .S:CODE DIAG=$P(GDIAG,U,2)_U_$P(GDIAG,U,4)
"RTN","MDRPCW1",95,0)
 .S CAT=$P(MDX802,U)
"RTN","MDRPCW1",96,0)
 .S:CAT CAT=$P($G(^AUTNPOV(CAT,0)),U)
"RTN","MDRPCW1",97,0)
 .S MDCTR=MDCTR+1,@RESULTS@(MDCTR)="POV"_U_+$G(MDX0,U)_U_$P(DIAG,U)_U_CAT_U_$P(DIAG,U,2)_U_($P(MDX0,U,12)="P"),MDCK=MDCK+1
"RTN","MDRPCW1",98,0)
 ;^TMP("MDENC",$J,n)="CPT"^CPT IEN^CPT CODE^provider narrative category^provider narrative (Description)^^Quantity
"RTN","MDRPCW1",99,0)
 I +MDVST>0 S MDCPT=0 F  S MDCPT=$O(^TMP("PXKENC",$J,MDVST,"CPT",MDCPT)) Q:'MDCPT  D
"RTN","MDRPCW1",100,0)
 .S MDX0=$G(^TMP("PXKENC",$J,MDVST,"CPT",MDCPT,0)),MDX802=$G(^(802))
"RTN","MDRPCW1",101,0)
 .S CODE=+$G(MDX0,U)
"RTN","MDRPCW1",102,0)
 .S:CODE CODE=$$CPT^ICPTCOD(CODE,MDVST)
"RTN","MDRPCW1",103,0)
 .S:CODE DIAG=$P(CODE,U,2,3)
"RTN","MDRPCW1",104,0)
 .S CAT=$P(MDX802,U)
"RTN","MDRPCW1",105,0)
 .S:CAT CAT=$P($G(^AUTNPOV(CAT,0)),U)
"RTN","MDRPCW1",106,0)
 .S QTY=$P(MDX0,U,16)
"RTN","MDRPCW1",107,0)
 .S MDDESC="" D CPTLEX^MDRPCWU(.RESLT,$P(DIAG,U),"CPT")
"RTN","MDRPCW1",108,0)
 .S MDCLL="" F  S MDCLL=$O(^TMP("MDLEX",$J,MDCLL)) Q:MDCLL<1  S MDDESC=$P(^(MDCLL),"^",3)
"RTN","MDRPCW1",109,0)
 .S:$L(MDDESC)>230 MDDESC=$E(MDDESC,1,230) K ^TMP("MDLEX",$J),RESLT
"RTN","MDRPCW1",110,0)
 .S:MDDESC="" MDDESC=$P(DIAG,U,2)
"RTN","MDRPCW1",111,0)
 .S MDCTR=MDCTR+1,@RESULTS@(MDCTR)="CPT"_U_+$G(MDX0,U)_U_$P(DIAG,U)_U_CAT_U_MDDESC_U_U_QTY,MDCK=MDCK+1
"RTN","MDRPCW1",112,0)
 K ^TMP("PXKENC",$J)
"RTN","MDRPCW1",113,0)
 I 'MDVST!(+MDCK<1) D
"RTN","MDRPCW1",114,0)
 .S MDDDN=$O(^MDD(702,"ACON",MDCCON,+STUDY),-1),MDVST=0
"RTN","MDRPCW1",115,0)
 .I MDDDN D
"RTN","MDRPCW1",116,0)
 ..S MDDDV=$P($G(^MDD(702,+MDDDN,0)),U,7)
"RTN","MDRPCW1",117,0)
 ..S:$L(MDDDV,";")>1 MDENCDT=$P(MDDDV,";",2),MDVST=+$G(^MDD(702,+MDDDN,1)),MDVST=$S(+MDVST<1:0,1:+MDVST)
"RTN","MDRPCW1",118,0)
 ..I +MDVST>0 S MDNCTR=MDCTR F LLB=2:1:MDCTR K @RESULTS@(MDCTR) S MDNCTR=MDNCTR-1
"RTN","MDRPCW1",119,0)
 I $G(MDFLST(1))'="" S MDLL=0 F  S MDLL=$O(MDFLST(MDLL)) Q:MDLL<1  S:$G(MDFLST(MDLL))'="" MDCTR=MDCTR+1,@RESULTS@(MDCTR)=$G(MDFLST(MDLL))
"RTN","MDRPCW1",120,0)
 Q:MDCK>0
"RTN","MDRPCW1",121,0)
 Q:'MDVST
"RTN","MDRPCW1",122,0)
 D ENCEVENT^PXAPI(MDVST) S:$G(MDNCTR)>0 MDCTR=MDNCTR
"RTN","MDRPCW1",123,0)
 ;^TMP("MDENC",$J,n)="PRV"^CODE^^NARR^^Primary (1=Yes,0=No)
"RTN","MDRPCW1",124,0)
 S MDPROV=0 F  S MDPROV=$O(^TMP("PXKENC",$J,MDVST,"PRV",MDPROV)) Q:'MDPROV  D
"RTN","MDRPCW1",125,0)
 .Q
"RTN","MDRPCW1",126,0)
 .S MDX0=$G(^TMP("PXKENC",$J,MDVST,"PRV",MDPROV,0))
"RTN","MDRPCW1",127,0)
 .S CODE=+$P(MDX0,U)
"RTN","MDRPCW1",128,0)
 .I +CODE S MDCTR=MDCTR+1,@RESULTS@(MDCTR)="PRV"_U_CODE_U_U_$$GET1^DIQ(200,+CODE_",",.01,"E")_U_U_($P(MDX0,U,4)="P")
"RTN","MDRPCW1",129,0)
 ;^TMP("MDENC",$J,n)="POV"^ICD9 IEN^ICD9 CODE^provider narrative category^provider narrative (Short Description)^Primary (1=Yes,0=No)
"RTN","MDRPCW1",130,0)
 S MDICD=0 F  S MDICD=$O(^TMP("PXKENC",$J,MDVST,"POV",MDICD)) Q:'MDICD  D
"RTN","MDRPCW1",131,0)
 .S MDX0=$G(^TMP("PXKENC",$J,MDVST,"POV",MDICD,0)),MDX802=$G(^(802))
"RTN","MDRPCW1",132,0)
 .S CODE=+$G(MDX0,U),GDIAG=$$ICDDATA^ICDXCODE(80,CODE,MDENCDT)
"RTN","MDRPCW1",133,0)
 .S:CODE DIAG=$P(GDIAG,U,2)_U_$P(GDIAG,U,4)
"RTN","MDRPCW1",134,0)
 .S CAT=$P(MDX802,U)
"RTN","MDRPCW1",135,0)
 .S:CAT CAT=$P($G(^AUTNPOV(CAT,0)),U)
"RTN","MDRPCW1",136,0)
 .S MDCTR=MDCTR+1,@RESULTS@(MDCTR)="POV"_U_+$G(MDX0,U)_U_$P(DIAG,U)_U_CAT_U_$P(DIAG,U,2)_U_($P(MDX0,U,12)="P")
"RTN","MDRPCW1",137,0)
 ;^TMP("MDENC",$J,n)="CPT"^CPT IEN^CPT CODE^provider narrative category^provider narrative (Short Description)^^Quantity
"RTN","MDRPCW1",138,0)
 S MDCPT=0 F  S MDCPT=$O(^TMP("PXKENC",$J,MDVST,"CPT",MDCPT)) Q:'MDCPT  D
"RTN","MDRPCW1",139,0)
 .S MDX0=$G(^TMP("PXKENC",$J,MDVST,"CPT",MDCPT,0)),MDX802=$G(^(802))
"RTN","MDRPCW1",140,0)
 .S CODE=+$G(MDX0,U)
"RTN","MDRPCW1",141,0)
 .S:CODE CODE=$$CPT^ICPTCOD(CODE,MDVST)
"RTN","MDRPCW1",142,0)
 .S:CODE DIAG=$P(CODE,U,2,3)
"RTN","MDRPCW1",143,0)
 .S CAT=$P(MDX802,U)
"RTN","MDRPCW1",144,0)
 .S:CAT CAT=$P($G(^AUTNPOV(CAT,0)),U)
"RTN","MDRPCW1",145,0)
 .S QTY=$P(MDX0,U,16)
"RTN","MDRPCW1",146,0)
 .S MDDESC="" D CPTLEX^MDRPCWU(.RESLT,$P(DIAG,U),"CPT")
"RTN","MDRPCW1",147,0)
 .S MDCLL="" F  S MDCLL=$O(^TMP("MDLEX",$J,MDCLL)) Q:MDCLL<1  S MDDESC=$P(^(MDCLL),"^",3)
"RTN","MDRPCW1",148,0)
 .S:$L(MDDESC)>230 MDDESC=$E(MDDESC,1,230) K ^TMP("MDLEX",$J),RESLT
"RTN","MDRPCW1",149,0)
 .S:MDDESC="" MDDESC=$P(DIAG,U,2)
"RTN","MDRPCW1",150,0)
 .S MDCTR=MDCTR+1,@RESULTS@(MDCTR)="CPT"_U_+$G(MDX0,U)_U_$P(DIAG,U)_U_CAT_U_MDDESC_U_U_QTY
"RTN","MDRPCW1",151,0)
 K ^TMP("PXKENC",$J)
"RTN","MDRPCW1",152,0)
 Q
"RTN","MDRPCW1",153,0)
SETGLO(MDGLO1,MDGLO2) ; Set the ICD and CPT from device into a global array
"RTN","MDRPCW1",154,0)
 N MDA,MDB,MDC
"RTN","MDRPCW1",155,0)
 I +$G(@MDGLO1@(1))<1&(+$G(@MDGLO1@(2))<1) Q
"RTN","MDRPCW1",156,0)
 S MDA=$O(@MDGLO2@("POV",""),-1)
"RTN","MDRPCW1",157,0)
 S MDB=$O(@MDGLO2@("CPT",""),-1)
"RTN","MDRPCW1",158,0)
 F MDC=1:1:+$G(@MDGLO1@(1)) S MDA=MDA+1,@MDGLO2@("POV",MDA)=$G(@MDGLO1@(1,MDC))
"RTN","MDRPCW1",159,0)
 F MDC=1:1:+$G(@MDGLO1@(2)) S MDB=MDB+1,@MDGLO2@("CPT",MDB)=$G(@MDGLO1@(2,MDC))
"RTN","MDRPCW1",160,0)
 S @MDGLO2@("POV",0)=MDA,@MDGLO2@("CPT",0)=MDB
"RTN","MDRPCW1",161,0)
 Q
"RTN","MDRPCW1",162,0)
NTIU(P1,RECID) ; Create New TIU note for Result
"RTN","MDRPCW1",163,0)
 I $G(^MDD(702,+P1,0))="" Q 0
"RTN","MDRPCW1",164,0)
 N MDNEWN,MDFG,MDHVL,MDKK S MDFG=0
"RTN","MDRPCW1",165,0)
 D GETLST^XPAR(.MDHVL,"SYS","MD GET HIGH VOLUME")
"RTN","MDRPCW1",166,0)
 F MDKK=0:0 S MDKK=$O(MDHVL(MDKK)) Q:MDKK<1  I $P($G(MDHVL(MDKK)),"^")=+$P(^MDD(702,+P1,0),U,4) S MDFG=1 Q
"RTN","MDRPCW1",167,0)
 I $P($G(^MDS(702.01,+$P(^MDD(702,+P1,0),U,4),0)),U,6)=2 S MDNEWN=$$NEWTIUN^MDRPCOT2(+P1)
"RTN","MDRPCW1",168,0)
 I +$P($G(^MDS(702.01,+$P(^MDD(702,+P1,0),U,4),0)),U,10)!(+MDFG) S MDNEWN=$$NEWTIUN^MDRPCOTH(+P1,RECID)
"RTN","MDRPCW1",169,0)
 Q 1
"RTN","MDRPCWU")
0^3^B3093767^B2706250
"RTN","MDRPCWU",1,0)
MDRPCWU ;HOIFO/NCA - CPT Code Query ;2/16/10  16:17
"RTN","MDRPCWU",2,0)
 ;;1.0;CLINICAL PROCEDURES;**21,29**;Apr 01, 2004;Build 22
"RTN","MDRPCWU",3,0)
 ; Reference Integration Agreement:
"RTN","MDRPCWU",4,0)
 ; IA #1573 [Supported] LEXU calls
"RTN","MDRPCWU",5,0)
 ; IA #1609 [Supported] CONFIG^LEXSET call
"RTN","MDRPCWU",6,0)
 ; IA #2950 [Supported] LOOK^LEXA call
"RTN","MDRPCWU",7,0)
 ; IA #5747 [Supported] $$SINFO^ICDEX
"RTN","MDRPCWU",8,0)
 ;
"RTN","MDRPCWU",9,0)
CPTLEX(RESLT,MDSRCH,MDAPP) ; CPT Code Query
"RTN","MDRPCWU",10,0)
 N CODE,LEX,MDLST,MDI,LEXIEN,MDVAL
"RTN","MDRPCWU",11,0)
 S RESLT=$NA(^TMP("MDLEX",$J)) K @RESLT
"RTN","MDRPCWU",12,0)
 S MDDATE=DT
"RTN","MDRPCWU",13,0)
 S:MDAPP="CPT" MDAPP="CHP" ; LEX PATCH 10
"RTN","MDRPCWU",14,0)
 I MDAPP="ICD" S MDAPP=$P($$SINFO^ICDEX("DIAG",MDDATE),"^",3)
"RTN","MDRPCWU",15,0)
 D CONFIG^LEXSET(MDAPP,MDAPP,MDDATE)
"RTN","MDRPCWU",16,0)
 D LOOK^LEXA(MDSRCH,MDAPP,1,"",MDDATE)
"RTN","MDRPCWU",17,0)
 I '$D(LEX("LIST",1)) S @RESLT@(1)="-1^No matches found." Q
"RTN","MDRPCWU",18,0)
 S @RESLT@(1)=LEX("LIST",1),MDLST=1
"RTN","MDRPCWU",19,0)
 S MDI="" F  S MDI=$O(^TMP("LEXFND",$J,MDI)) Q:MDI'<0  D
"RTN","MDRPCWU",20,0)
 . S LEXIEN=$O(^TMP("LEXFND",$J,MDI,0))
"RTN","MDRPCWU",21,0)
 . S MDLST=MDLST+1,@RESLT@(MDLST)=LEXIEN_U_^TMP("LEXFND",$J,MDI,LEXIEN)
"RTN","MDRPCWU",22,0)
 K ^TMP("LEXFND",$J),^TMP("LEXHIT",$J)
"RTN","MDRPCWU",23,0)
 S MDI="" F  S MDI=$O(@RESLT@(MDI)) Q:'MDI  S MDVAL=$G(@RESLT@(MDI)) D
"RTN","MDRPCWU",24,0)
 . I MDAPP="ICD"!(MDAPP="10D") S CODE=$$ONE^LEXU(+MDVAL,MDDATE,MDAPP),@RESLT@(MDI)=CODE_U_MDVAL
"RTN","MDRPCWU",25,0)
 . I MDAPP="CPT"!(MDAPP="CHP") S CODE=$$CPTONE^LEXU(+MDVAL,MDDATE),@RESLT@(MDI)=CODE_U_MDVAL
"RTN","MDRPCWU",26,0)
 . I CODE="",(MDAPP="CHP") S CODE=$$CPCONE^LEXU(+MDVAL,MDDATE),@RESLT@(MDI)=CODE_U_MDVAL
"RTN","MDRPCWU",27,0)
 Q
"VER")
8.0^22.0
"BLD",8979,6)
^25
**END**
**END**

