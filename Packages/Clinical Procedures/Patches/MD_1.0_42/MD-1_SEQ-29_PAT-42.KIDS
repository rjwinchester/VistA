Released MD*1*42 SEQ #29
Extracted from mail message
**KIDS**:MD*1.0*42^

**INSTALL NAME**
MD*1.0*42
"BLD",9642,0)
MD*1.0*42^CLINICAL PROCEDURES^0^3150820^y
"BLD",9642,4,0)
^9.64PA^702.09^1
"BLD",9642,4,702.09,0)
702.09
"BLD",9642,4,702.09,2,0)
^9.641^702.09^1
"BLD",9642,4,702.09,2,702.09,0)
CP INSTRUMENT  (File-top level)
"BLD",9642,4,702.09,2,702.09,1,0)
^9.6411^.401^1
"BLD",9642,4,702.09,2,702.09,1,.401,0)
CONSULT KEEP OPEN
"BLD",9642,4,702.09,222)
y^y^p^^^^n^^n
"BLD",9642,4,702.09,224)

"BLD",9642,4,"APDD",702.09,702.09)

"BLD",9642,4,"APDD",702.09,702.09,.401)

"BLD",9642,4,"B",702.09,702.09)

"BLD",9642,6.3)
12
"BLD",9642,"ABNS",0)
^9.66A^^
"BLD",9642,"ABPKG")
y^n
"BLD",9642,"KRN",0)
^9.67PA^779.2^20
"BLD",9642,"KRN",.4,0)
.4
"BLD",9642,"KRN",.401,0)
.401
"BLD",9642,"KRN",.402,0)
.402
"BLD",9642,"KRN",.403,0)
.403
"BLD",9642,"KRN",.5,0)
.5
"BLD",9642,"KRN",.84,0)
.84
"BLD",9642,"KRN",3.6,0)
3.6
"BLD",9642,"KRN",3.8,0)
3.8
"BLD",9642,"KRN",9.2,0)
9.2
"BLD",9642,"KRN",9.8,0)
9.8
"BLD",9642,"KRN",9.8,"NM",0)
^9.68A^2^2
"BLD",9642,"KRN",9.8,"NM",1,0)
MDRPCOP^^0^B83622221
"BLD",9642,"KRN",9.8,"NM",2,0)
MDWOR^^0^B47515185
"BLD",9642,"KRN",9.8,"NM","B","MDRPCOP",1)

"BLD",9642,"KRN",9.8,"NM","B","MDWOR",2)

"BLD",9642,"KRN",19,0)
19
"BLD",9642,"KRN",19.1,0)
19.1
"BLD",9642,"KRN",101,0)
101
"BLD",9642,"KRN",409.61,0)
409.61
"BLD",9642,"KRN",771,0)
771
"BLD",9642,"KRN",779.2,0)
779.2
"BLD",9642,"KRN",870,0)
870
"BLD",9642,"KRN",8989.51,0)
8989.51
"BLD",9642,"KRN",8989.52,0)
8989.52
"BLD",9642,"KRN",8994,0)
8994
"BLD",9642,"KRN","B",.4,.4)

"BLD",9642,"KRN","B",.401,.401)

"BLD",9642,"KRN","B",.402,.402)

"BLD",9642,"KRN","B",.403,.403)

"BLD",9642,"KRN","B",.5,.5)

"BLD",9642,"KRN","B",.84,.84)

"BLD",9642,"KRN","B",3.6,3.6)

"BLD",9642,"KRN","B",3.8,3.8)

"BLD",9642,"KRN","B",9.2,9.2)

"BLD",9642,"KRN","B",9.8,9.8)

"BLD",9642,"KRN","B",19,19)

"BLD",9642,"KRN","B",19.1,19.1)

"BLD",9642,"KRN","B",101,101)

"BLD",9642,"KRN","B",409.61,409.61)

"BLD",9642,"KRN","B",771,771)

"BLD",9642,"KRN","B",779.2,779.2)

"BLD",9642,"KRN","B",870,870)

"BLD",9642,"KRN","B",8989.51,8989.51)

"BLD",9642,"KRN","B",8989.52,8989.52)

"BLD",9642,"KRN","B",8994,8994)

"BLD",9642,"QUES",0)
^9.62^^
"BLD",9642,"REQB",0)
^9.611^2^2
"BLD",9642,"REQB",1,0)
MD*1.0*20^2
"BLD",9642,"REQB",2,0)
MD*1.0*37^2
"BLD",9642,"REQB","B","MD*1.0*20",1)

"BLD",9642,"REQB","B","MD*1.0*37",2)

"FIA",702.09)
CP INSTRUMENT
"FIA",702.09,0)
^MDS(702.09,
"FIA",702.09,0,0)
702.09I
"FIA",702.09,0,1)
y^y^p^^^^n^^n
"FIA",702.09,0,10)

"FIA",702.09,0,11)

"FIA",702.09,0,"RLRO")

"FIA",702.09,0,"VR")
1.0^MD
"FIA",702.09,702.09)
1
"FIA",702.09,702.09,.401)

"MBREQ")
0
"PKG",635,-1)
1^1
"PKG",635,0)
CLINICAL PROCEDURES^MD^Clinical Procedures
"PKG",635,20,0)
^9.402P^^
"PKG",635,22,0)
^9.49I^1^1
"PKG",635,22,1,0)
1.0^3040521^3061024^568
"PKG",635,22,1,"PAH",1,0)
42^3150820^520736446
"PKG",635,22,1,"PAH",1,1,0)
^^196^196^3150819
"PKG",635,22,1,"PAH",1,1,1,0)
Test patch MD*1.0*42 v2   August 18, 2015
"PKG",635,22,1,"PAH",1,1,2,0)
 
"PKG",635,22,1,"PAH",1,1,3,0)
======================================================
"PKG",635,22,1,"PAH",1,1,4,0)
 
"PKG",635,22,1,"PAH",1,1,5,0)
Description:
"PKG",635,22,1,"PAH",1,1,6,0)
===========
"PKG",635,22,1,"PAH",1,1,7,0)
 
"PKG",635,22,1,"PAH",1,1,8,0)
The NSR20131203 Clinical Procedures Uni-directional Configuration Option 
"PKG",635,22,1,"PAH",1,1,9,0)
enhancement entails changing the current VistA functionality to add a 
"PKG",635,22,1,"PAH",1,1,10,0)
flag to the Clinical Procedures (CP) Instrument File so that CP will send 
"PKG",635,22,1,"PAH",1,1,11,0)
only an "outbound" Health Level 7 (HL7) message containing Computerized 
"PKG",635,22,1,"PAH",1,1,12,0)
Patient Record System (CPRS) patient information to the medical 
"PKG",635,22,1,"PAH",1,1,13,0)
instrument. The CP procedure is automatically placed in Completed status 
"PKG",635,22,1,"PAH",1,1,14,0)
after the HL7 message is sent, thus preventing an "inbound" HL7 message 
"PKG",635,22,1,"PAH",1,1,15,0)
containing the test results from being sent back to the CPRS Consult 
"PKG",635,22,1,"PAH",1,1,16,0)
Note.   
"PKG",635,22,1,"PAH",1,1,17,0)
 
"PKG",635,22,1,"PAH",1,1,18,0)
The physician can then edit the Consult Note by manually pasting in data 
"PKG",635,22,1,"PAH",1,1,19,0)
from a test result reporting system to complete the Consult.  
"PKG",635,22,1,"PAH",1,1,20,0)
This modification is beneficial for users of reporting systems-such as 
"PKG",635,22,1,"PAH",1,1,21,0)
the Clinical Assessment, Reporting, and Tracking System for Cardiac 
"PKG",635,22,1,"PAH",1,1,22,0)
Catheterization Laboratories (CART-CL) application-who do not want the 
"PKG",635,22,1,"PAH",1,1,23,0)
test results from the medical instrument to populate the CPRS Consult 
"PKG",635,22,1,"PAH",1,1,24,0)
Note, but prefer to manually paste the test results from the reporting 
"PKG",635,22,1,"PAH",1,1,25,0)
system into the Consult Note.  
"PKG",635,22,1,"PAH",1,1,26,0)
 
"PKG",635,22,1,"PAH",1,1,27,0)
The CONSULT KEEP OPEN field in the CP INSTRUMENT File (#702.09) must be 
"PKG",635,22,1,"PAH",1,1,28,0)
set to Yes for this functionality to work.  This triggers the routines 
"PKG",635,22,1,"PAH",1,1,29,0)
that put the CP procedure in Completed status to interrupt the 
"PKG",635,22,1,"PAH",1,1,30,0)
bi-directional flow.
"PKG",635,22,1,"PAH",1,1,31,0)
 
"PKG",635,22,1,"PAH",1,1,32,0)
 
"PKG",635,22,1,"PAH",1,1,33,0)
Patch Components
"PKG",635,22,1,"PAH",1,1,34,0)
================
"PKG",635,22,1,"PAH",1,1,35,0)
 
"PKG",635,22,1,"PAH",1,1,36,0)
Files & Fields Associated:
"PKG",635,22,1,"PAH",1,1,37,0)
 
"PKG",635,22,1,"PAH",1,1,38,0)
File Name (Number)       Field Name (Number)       New/Modified/Deleted
"PKG",635,22,1,"PAH",1,1,39,0)
-----------------------  ------------------------  --------------------
"PKG",635,22,1,"PAH",1,1,40,0)
CP INSTRUMENT (#702.09)  CONSULT KEEP OPEN (.401)  New
"PKG",635,22,1,"PAH",1,1,41,0)
 
"PKG",635,22,1,"PAH",1,1,42,0)
 
"PKG",635,22,1,"PAH",1,1,43,0)
Forms Associated:
"PKG",635,22,1,"PAH",1,1,44,0)
 
"PKG",635,22,1,"PAH",1,1,45,0)
Form Name                File #       New/Modified/Deleted
"PKG",635,22,1,"PAH",1,1,46,0)
---------                ------       --------------------
"PKG",635,22,1,"PAH",1,1,47,0)
N/A
"PKG",635,22,1,"PAH",1,1,48,0)
 
"PKG",635,22,1,"PAH",1,1,49,0)
 
"PKG",635,22,1,"PAH",1,1,50,0)
Mail Groups Associated:
"PKG",635,22,1,"PAH",1,1,51,0)
 
"PKG",635,22,1,"PAH",1,1,52,0)
Mail Group Name          New/Modified/Deleted
"PKG",635,22,1,"PAH",1,1,53,0)
---------------          --------------------
"PKG",635,22,1,"PAH",1,1,54,0)
N/A
"PKG",635,22,1,"PAH",1,1,55,0)
 
"PKG",635,22,1,"PAH",1,1,56,0)
 
"PKG",635,22,1,"PAH",1,1,57,0)
Options Associated:
"PKG",635,22,1,"PAH",1,1,58,0)
 
"PKG",635,22,1,"PAH",1,1,59,0)
Option Name            Type               New/Modified/Deleted
"PKG",635,22,1,"PAH",1,1,60,0)
-----------            ----               --------------------
"PKG",635,22,1,"PAH",1,1,61,0)
N/A
"PKG",635,22,1,"PAH",1,1,62,0)
 
"PKG",635,22,1,"PAH",1,1,63,0)
 
"PKG",635,22,1,"PAH",1,1,64,0)
Protocols Associated:
"PKG",635,22,1,"PAH",1,1,65,0)
 
"PKG",635,22,1,"PAH",1,1,66,0)
Protocol Name       New/Modified/Deleted
"PKG",635,22,1,"PAH",1,1,67,0)
-------------       --------------------
"PKG",635,22,1,"PAH",1,1,68,0)
N/A
"PKG",635,22,1,"PAH",1,1,69,0)
 
"PKG",635,22,1,"PAH",1,1,70,0)
 
"PKG",635,22,1,"PAH",1,1,71,0)
Security Keys Associated:
"PKG",635,22,1,"PAH",1,1,72,0)
 
"PKG",635,22,1,"PAH",1,1,73,0)
Security Key Name
"PKG",635,22,1,"PAH",1,1,74,0)
-----------------
"PKG",635,22,1,"PAH",1,1,75,0)
N/A
"PKG",635,22,1,"PAH",1,1,76,0)
 
"PKG",635,22,1,"PAH",1,1,77,0)
 
"PKG",635,22,1,"PAH",1,1,78,0)
Templates Associated:
"PKG",635,22,1,"PAH",1,1,79,0)
 
"PKG",635,22,1,"PAH",1,1,80,0)
Template Name      Type      File Name (Number)  New/Modified/Deleted 
"PKG",635,22,1,"PAH",1,1,81,0)
-------------      ----      ------------------  --------------------
"PKG",635,22,1,"PAH",1,1,82,0)
N/A
"PKG",635,22,1,"PAH",1,1,83,0)
 
"PKG",635,22,1,"PAH",1,1,84,0)
 
"PKG",635,22,1,"PAH",1,1,85,0)
Additional Information:
"PKG",635,22,1,"PAH",1,1,86,0)
N/A
"PKG",635,22,1,"PAH",1,1,87,0)
 
"PKG",635,22,1,"PAH",1,1,88,0)
 
"PKG",635,22,1,"PAH",1,1,89,0)
New Service Requests (NSRs)
"PKG",635,22,1,"PAH",1,1,90,0)
----------------------------
"PKG",635,22,1,"PAH",1,1,91,0)
20131203   CP UNI-DIRECTIONAL CONFIGURATION OPTION
"PKG",635,22,1,"PAH",1,1,92,0)
 
"PKG",635,22,1,"PAH",1,1,93,0)
 
"PKG",635,22,1,"PAH",1,1,94,0)
Patient Safety Issues (PSIs)
"PKG",635,22,1,"PAH",1,1,95,0)
-----------------------------
"PKG",635,22,1,"PAH",1,1,96,0)
N/A
"PKG",635,22,1,"PAH",1,1,97,0)
 
"PKG",635,22,1,"PAH",1,1,98,0)
 
"PKG",635,22,1,"PAH",1,1,99,0)
Remedy Ticket(s) & Overview
"PKG",635,22,1,"PAH",1,1,100,0)
---------------------------
"PKG",635,22,1,"PAH",1,1,101,0)
N/A
"PKG",635,22,1,"PAH",1,1,102,0)
 
"PKG",635,22,1,"PAH",1,1,103,0)
Problem:
"PKG",635,22,1,"PAH",1,1,104,0)
--------
"PKG",635,22,1,"PAH",1,1,105,0)
 
"PKG",635,22,1,"PAH",1,1,106,0)
Resolution:
"PKG",635,22,1,"PAH",1,1,107,0)
-----------
"PKG",635,22,1,"PAH",1,1,108,0)
 
"PKG",635,22,1,"PAH",1,1,109,0)
 
"PKG",635,22,1,"PAH",1,1,110,0)
Test Sites:
"PKG",635,22,1,"PAH",1,1,111,0)
----------
"PKG",635,22,1,"PAH",1,1,112,0)
Portland VA Medical Center, Portland, Oregon (VAMC)
"PKG",635,22,1,"PAH",1,1,113,0)
VA Boston Health Care System, West Roxbury, MA (VAHCS)
"PKG",635,22,1,"PAH",1,1,114,0)
VA Connecticut Health Care System West Haven Campus, West Haven, CT 
"PKG",635,22,1,"PAH",1,1,115,0)
(VAHCS)
"PKG",635,22,1,"PAH",1,1,116,0)
James A. Haley Veterans Hospital, Tampa, Florida (VAHCS)
"PKG",635,22,1,"PAH",1,1,117,0)
 
"PKG",635,22,1,"PAH",1,1,118,0)
 
"PKG",635,22,1,"PAH",1,1,119,0)
Documentation Retrieval Instructions
"PKG",635,22,1,"PAH",1,1,120,0)
------------------------------------ 
"PKG",635,22,1,"PAH",1,1,121,0)
The functionality introduced by this patch is described herein.
"PKG",635,22,1,"PAH",1,1,122,0)
 
"PKG",635,22,1,"PAH",1,1,123,0)
 
"PKG",635,22,1,"PAH",1,1,124,0)
Pre/Post Installation Overview
"PKG",635,22,1,"PAH",1,1,125,0)
------------------------------
"PKG",635,22,1,"PAH",1,1,126,0)
There are no Pre/Post installation routines associated with this patch.
"PKG",635,22,1,"PAH",1,1,127,0)
 
"PKG",635,22,1,"PAH",1,1,128,0)
 
"PKG",635,22,1,"PAH",1,1,129,0)
Pre-Installation Instructions
"PKG",635,22,1,"PAH",1,1,130,0)
-------------------------
"PKG",635,22,1,"PAH",1,1,131,0)
This patch may be installed with users on the system although it is
"PKG",635,22,1,"PAH",1,1,132,0)
recommended that it be installed during non-peak hours to minimize 
"PKG",635,22,1,"PAH",1,1,133,0)
potential disruption to users.  This patch should take less than 5 
"PKG",635,22,1,"PAH",1,1,134,0)
minutes to install.
"PKG",635,22,1,"PAH",1,1,135,0)
 
"PKG",635,22,1,"PAH",1,1,136,0)
 
"PKG",635,22,1,"PAH",1,1,137,0)
Installation Instructions
"PKG",635,22,1,"PAH",1,1,138,0)
-----------------------------
"PKG",635,22,1,"PAH",1,1,139,0)
1.      Choose the PackMan message containing this patch.
"PKG",635,22,1,"PAH",1,1,140,0)
 
"PKG",635,22,1,"PAH",1,1,141,0)
2.      Choose the INSTALL/CHECK MESSAGE PackMan option.  
"PKG",635,22,1,"PAH",1,1,142,0)
 
"PKG",635,22,1,"PAH",1,1,143,0)
3.      From the Kernel Installation and Distribution System Menu, select 
"PKG",635,22,1,"PAH",1,1,144,0)
        the Installation Menu.  From this menu, you may elect to use the 
"PKG",635,22,1,"PAH",1,1,145,0)
        following options. When prompted for the INSTALL NAME enter
"PKG",635,22,1,"PAH",1,1,146,0)
        MD*1.0*42.
"PKG",635,22,1,"PAH",1,1,147,0)
 
"PKG",635,22,1,"PAH",1,1,148,0)
        a.  Verify Checksums in Transport Global - This option will 
"PKG",635,22,1,"PAH",1,1,149,0)
            allow you to ensure the integrity of the routines that are in
"PKG",635,22,1,"PAH",1,1,150,0)
            the transport global.
"PKG",635,22,1,"PAH",1,1,151,0)
        b.  Print Transport Global - This option will allow you to view
"PKG",635,22,1,"PAH",1,1,152,0)
            the components of the KIDS build.
"PKG",635,22,1,"PAH",1,1,153,0)
        c.  Compare Transport Global to Current System - This option will
"PKG",635,22,1,"PAH",1,1,154,0)
            allow you to view all changes that will be made when this 
"PKG",635,22,1,"PAH",1,1,155,0)
            patch is installed.  It compares all components of this patch
"PKG",635,22,1,"PAH",1,1,156,0)
            (routines, DD's, templates, etc.).
"PKG",635,22,1,"PAH",1,1,157,0)
        d.  Backup a Transport Global - This option will create a backup
"PKG",635,22,1,"PAH",1,1,158,0)
            message of any routines exported with this patch. It will not
"PKG",635,22,1,"PAH",1,1,159,0)
            backup any other changes such as DD's or templates.
"PKG",635,22,1,"PAH",1,1,160,0)
 
"PKG",635,22,1,"PAH",1,1,161,0)
4.      From the Installation Menu, select the Install Package(s) option 
"PKG",635,22,1,"PAH",1,1,162,0)
        and choose the patch to install.
"PKG",635,22,1,"PAH",1,1,163,0)
 
"PKG",635,22,1,"PAH",1,1,164,0)
5.      When prompted 'Want KIDS to Rebuild Menu Trees Upon Completion of
"PKG",635,22,1,"PAH",1,1,165,0)
        Install? NO// Press <Enter>
"PKG",635,22,1,"PAH",1,1,166,0)
 
"PKG",635,22,1,"PAH",1,1,167,0)
6.      When prompted 'Want KIDS to INHIBIT LOGONs during the install? 
"PKG",635,22,1,"PAH",1,1,168,0)
        NO// Press <Enter>
"PKG",635,22,1,"PAH",1,1,169,0)
 
"PKG",635,22,1,"PAH",1,1,170,0)
7.      When prompted 'Want to DISABLE Scheduled Options, Menu Options, 
"PKG",635,22,1,"PAH",1,1,171,0)
        and Protocols? NO// Press <Enter>
"PKG",635,22,1,"PAH",1,1,172,0)
 
"PKG",635,22,1,"PAH",1,1,173,0)
8.      If prompted "Delay Install (Minutes):  (0 - 60): 0// respond 0.
"PKG",635,22,1,"PAH",1,1,174,0)
 
"PKG",635,22,1,"PAH",1,1,175,0)
 
"PKG",635,22,1,"PAH",1,1,176,0)
Post-Installation Instructions
"PKG",635,22,1,"PAH",1,1,177,0)
------------------------------
"PKG",635,22,1,"PAH",1,1,178,0)
N/A
"PKG",635,22,1,"PAH",1,1,179,0)
 
"PKG",635,22,1,"PAH",1,1,180,0)
 
"PKG",635,22,1,"PAH",1,1,181,0)
Routine Information:
"PKG",635,22,1,"PAH",1,1,182,0)
====================
"PKG",635,22,1,"PAH",1,1,183,0)
 
"PKG",635,22,1,"PAH",1,1,184,0)
 
"PKG",635,22,1,"PAH",1,1,185,0)
The second line of each of these routines now looks like:
"PKG",635,22,1,"PAH",1,1,186,0)
 ;;1.0;CLINICAL PROCEDURES;**[Patch List]**;Apr 01, 2004;Build 7
"PKG",635,22,1,"PAH",1,1,187,0)
 
"PKG",635,22,1,"PAH",1,1,188,0)
The checksums below are new checksums, and
"PKG",635,22,1,"PAH",1,1,189,0)
 can be checked with CHECK1^XTSUMBLD.
"PKG",635,22,1,"PAH",1,1,190,0)
 
"PKG",635,22,1,"PAH",1,1,191,0)
Routine Name: MDRPCOP
"PKG",635,22,1,"PAH",1,1,192,0)
    Before: B79065771   After: B83622221  **4,6,11,20,42**
"PKG",635,22,1,"PAH",1,1,193,0)
Routine Name: MDWOR
"PKG",635,22,1,"PAH",1,1,194,0)
    Before: B43803580   After: B47515185  **14,11,21,20,37,42**
"PKG",635,22,1,"PAH",1,1,195,0)
 
"PKG",635,22,1,"PAH",1,1,196,0)
Routine list of preceding patches: 20,37
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
2
"RTN","MDRPCOP")
0^1^B83622221^B79065771
"RTN","MDRPCOP",1,0)
MDRPCOP ; HOIFO/DP - Object RPCs (TMDPatient) ;8/3/09  10:39
"RTN","MDRPCOP",2,0)
 ;;1.0;CLINICAL PROCEDURES;**4,6,11,20,42**;Apr 01, 2004;Build 12
"RTN","MDRPCOP",3,0)
 ; Integration Agreements:
"RTN","MDRPCOP",4,0)
 ; IA# 2054 [Supported] DILF call
"RTN","MDRPCOP",5,0)
 ; IA# 2056 [Supported] DIQ calls
"RTN","MDRPCOP",6,0)
 ; IA# 2263 [Supported] XPAR calls
"RTN","MDRPCOP",7,0)
 ; IA# 3027 [Supported] Calls to DGSEC4
"RTN","MDRPCOP",8,0)
 ; IA# 2981 [Subscription] Calls to GUI~GMRCP5
"RTN","MDRPCOP",9,0)
 ; IA# 2548 [Supported] ACRP Interface Toolkit APIs.
"RTN","MDRPCOP",10,0)
 ; IA# 2552 [Supported] AIT API to provide outpatient encounter data.
"RTN","MDRPCOP",11,0)
 ; IA# 10061 [Supported] VADPT calls.
"RTN","MDRPCOP",12,0)
 ; IA# 3468 [Subscription] Use GMRCCP APIs.
"RTN","MDRPCOP",13,0)
 ; IA# 10103 [Supported] Call to XLFDT
"RTN","MDRPCOP",14,0)
 ; IA# 10039 [Supported] Ward Location File (#42) Access.
"RTN","MDRPCOP",15,0)
 ; IA# 10035 [Supported] DPT references
"RTN","MDRPCOP",16,0)
 ; IA# 3613 [Private] GETVST^MDRPCOP API call
"RTN","MDRPCOP",17,0)
 ; IA# 10099 [Supported] GMRADPT call
"RTN","MDRPCOP",18,0)
 ; IA# 1096 [Controlled Subscription] ^DGPM("ATID1" x-ref loop
"RTN","MDRPCOP",19,0)
 ; IA# 358 [Controlled Subscription] FILE 405 references
"RTN","MDRPCOP",20,0)
 ;
"RTN","MDRPCOP",21,0)
ADD(X) ; [Procedure] Add line to @RESULTS@(...
"RTN","MDRPCOP",22,0)
 S @RESULTS@(+$O(@RESULTS@(""),-1)+1)=X
"RTN","MDRPCOP",23,0)
 Q
"RTN","MDRPCOP",24,0)
 ;
"RTN","MDRPCOP",25,0)
ALLERGY ; [Procedure] Return Allergies
"RTN","MDRPCOP",26,0)
 D EN1^GMRADPT I '$O(GMRAL(0)) D  Q
"RTN","MDRPCOP",27,0)
 .I $G(GMRAL)="" S @RESULTS@(0)="No Allergy Assessment"
"RTN","MDRPCOP",28,0)
 .I $G(GMRAL)=0 S @RESULTS@(0)="No Known Allergies"
"RTN","MDRPCOP",29,0)
 S @RESULTS@(0)="This patient has the following allergy(ies): "
"RTN","MDRPCOP",30,0)
 F X=0:0 S X=$O(GMRAL(X)) Q:'X  D
"RTN","MDRPCOP",31,0)
 .S @RESULTS@(X)=$P($G(GMRAL(X)),U,2)
"RTN","MDRPCOP",32,0)
 Q
"RTN","MDRPCOP",33,0)
 ;
"RTN","MDRPCOP",34,0)
CHKIN ; [Procedure] Check In Study
"RTN","MDRPCOP",35,0)
 N MDCART,MDREZ S MDCART=0
"RTN","MDRPCOP",36,0)
 I +$P(DATA,U,4),+$G(^MDS(702.09,+$P(DATA,U,4),"CS")) S MDCART=1
"RTN","MDRPCOP",37,0)
 F X=2:1:5 D
"RTN","MDRPCOP",38,0)
 .I $P(DATA,U,X)]"" S MDFDA(702,$P(DATA,U,1),$P("^.04^.05^.11^.07",U,X))=$P(DATA,U,X)
"RTN","MDRPCOP",39,0)
 S MDFDA(702,$P(DATA,U,1),.09)=4  ; Status = Checked-In
"RTN","MDRPCOP",40,0)
 I $P(DATA,U,1)="+1," D
"RTN","MDRPCOP",41,0)
 .S MDFDA(702,"+1,",.01)=DFN
"RTN","MDRPCOP",42,0)
 .S MDFDA(702,"+1,",.02)=$$NOW^XLFDT()
"RTN","MDRPCOP",43,0)
 .S MDFDA(702,"+1,",.03)=DUZ
"RTN","MDRPCOP",44,0)
 .S MDPC=$P(DATA,"^",5),MDPC=$S($L(MDPC,";")=1:MDPC,1:$P(MDPC,";",2))
"RTN","MDRPCOP",45,0)
 .S MDFDA(702,"+1,",.14)=MDPC
"RTN","MDRPCOP",46,0)
 .D UPDATE^DIE("","MDFDA","MDIEN","MDERR") Q:$D(MDERR)
"RTN","MDRPCOP",47,0)
 .S MDIENS=MDIEN(1)_",",MDHL7=$$SUB^MDHL7B(MDIEN(1))
"RTN","MDRPCOP",48,0)
 .I +MDHL7=-1 S MDFDA(702,MDIENS,.09)=2,MDFDA(702,MDIENS,.08)=$P(MDHL7,U,2)
"RTN","MDRPCOP",49,0)
 .I +MDHL7=1 S MDFDA(702,MDIENS,.09)=5,MDFDA(702,MDIENS,.08)=""
"RTN","MDRPCOP",50,0)
 .D:$D(MDFDA) FILE^DIE("","MDFDA","MDERR")
"RTN","MDRPCOP",51,0)
 I $P(DATA,U,1)'="+1," D
"RTN","MDRPCOP",52,0)
 .D FILE^DIE("","MDFDA","MDERR") Q:$D(MDERR)
"RTN","MDRPCOP",53,0)
 .S MDIENS=+DATA_","
"RTN","MDRPCOP",54,0)
 .S MDHL7=$$SUB^MDHL7B(+MDIENS)
"RTN","MDRPCOP",55,0)
 .I +MDHL7=-1 S MDFDA(702,MDIENS,.09)=2,MDFDA(702,MDIENS,.08)=$P(MDHL7,U,2)
"RTN","MDRPCOP",56,0)
 .I +MDHL7=1 S MDFDA(702,MDIENS,.09)=5,MDFDA(702,MDIENS,.08)=""
"RTN","MDRPCOP",57,0)
 .D:$D(MDFDA) FILE^DIE("","MDFDA","MDERR")
"RTN","MDRPCOP",58,0)
 ; Patch 6 - Renal Check-In
"RTN","MDRPCOP",59,0)
 D:+$G(MDIENS)
"RTN","MDRPCOP",60,0)
 .S X=+$P(^MDD(702,+MDIENS,0),U,4) Q:'X
"RTN","MDRPCOP",61,0)
 .I $P(^MDS(702.01,X,0),U,6)=2 D  Q  ; Renal Check-In
"RTN","MDRPCOP",62,0)
 ..D CP^MDKUTLR(+MDIENS)
"RTN","MDRPCOP",63,0)
 ..S MDFDA(702,+MDIENS_",",.09)=5
"RTN","MDRPCOP",64,0)
 ..D FILE^DIE("","MDFDA","MDERR")
"RTN","MDRPCOP",65,0)
 ; Patch 6 - Renal Check-In
"RTN","MDRPCOP",66,0)
 I +MDCART>0 D
"RTN","MDRPCOP",67,0)
 .S MDREZ=$$NEWTIUN^MDRPCOT(+MDIEN(1))
"RTN","MDRPCOP",68,0)
 .I +MDREZ<0 D FILEMSG^MDRPCOT(+MDIEN(1),"TIU",2,MDREZ)
"RTN","MDRPCOP",69,0)
 .S MDREZ=$$SUBMIT^MDRPCOT1(MDIEN(1))
"RTN","MDRPCOP",70,0)
 .D FILEMSG^MDRPCOT(+MDIEN(1),"IMAGING",$S(+MDREZ>0:+MDREZ,1:2),MDREZ)
"RTN","MDRPCOP",71,0)
 I '$D(MDERR) S @RESULTS@(0)="1^OK" Q
"RTN","MDRPCOP",72,0)
 D ERROR^MDRPCU(RESULTS,.MDERR)
"RTN","MDRPCOP",73,0)
 Q
"RTN","MDRPCOP",74,0)
 ;
"RTN","MDRPCOP",75,0)
DISPCON ; [Procedure] Display a consult
"RTN","MDRPCOP",76,0)
 K ^TMP("GMRC",$J)
"RTN","MDRPCOP",77,0)
 D GUI^GMRCP5(.RESULTS,DATA)
"RTN","MDRPCOP",78,0)
 Q
"RTN","MDRPCOP",79,0)
 ;
"RTN","MDRPCOP",80,0)
GETCONS ; [Procedure] Get available consults for patient
"RTN","MDRPCOP",81,0)
 K ^TMP("MDTMP",$J) N MDCDT,MDDY,X1,X2,X
"RTN","MDRPCOP",82,0)
 S MDDY=$$GET^XPAR("SYS","MD COMPL PROC DISPLAY DAYS",1)
"RTN","MDRPCOP",83,0)
 S X1=DT,X2=-$S(MDDY>0:+MDDY,1:365) D C^%DTC S MDCDT=X
"RTN","MDRPCOP",84,0)
 D CPLIST^GMRCCP(DFN,,$NA(^TMP("MDTMP",$J)))
"RTN","MDRPCOP",85,0)
 S MDX=0
"RTN","MDRPCOP",86,0)
 F  S MDX=$O(^TMP("MDTMP",$J,MDX)) Q:'MDX  D:"saprc"[$P(^(MDX),U,4)
"RTN","MDRPCOP",87,0)
 .S Y="123;"_$P(^TMP("MDTMP",$J,MDX),U,5)
"RTN","MDRPCOP",88,0)
 .I $P($G(^TMP("MDTMP",$J,MDX)),U,4)="c" Q:$P($G(^TMP("MDTMP",$J,MDX)),U,1)<MDCDT
"RTN","MDRPCOP",89,0)
 .F X=2,3,4,1,6,5 S Y=Y_U_$P(^TMP("MDTMP",$J,MDX),U,X)
"RTN","MDRPCOP",90,0)
 .S Y=Y_U_+$O(^MDD(702,"ACON",+$P(^TMP("MDTMP",$J,MDX),U,5)))
"RTN","MDRPCOP",91,0)
 .;
"RTN","MDRPCOP",92,0)
 .; Patch MD*1.0*4 - Return number of times checked in at piece 9
"RTN","MDRPCOP",93,0)
 .;
"RTN","MDRPCOP",94,0)
 .S (X,Z)=0,MDY=+$P(^TMP("MDTMP",$J,MDX),U,5)
"RTN","MDRPCOP",95,0)
 .F  S X=$O(^MDD(702,"ACON",MDY,X)) Q:'X  S Z=Z+1
"RTN","MDRPCOP",96,0)
 .S $P(Y,U,9)=Z
"RTN","MDRPCOP",97,0)
 .;
"RTN","MDRPCOP",98,0)
 .; End Patch MD*1.0*4
"RTN","MDRPCOP",99,0)
 .;
"RTN","MDRPCOP",100,0)
 .D ADD(Y)
"RTN","MDRPCOP",101,0)
 S @RESULTS@(0)=+$O(@RESULTS@(""),-1)
"RTN","MDRPCOP",102,0)
 K ^TMP("MDTMP",$J)
"RTN","MDRPCOP",103,0)
 Q
"RTN","MDRPCOP",104,0)
 ;
"RTN","MDRPCOP",105,0)
GETHDR ; [Procedure] Get Pt Header
"RTN","MDRPCOP",106,0)
 S DFNIENS=DFN_","
"RTN","MDRPCOP",107,0)
 S @RESULTS@(0)=$$GET1^DIQ(2,DFNIENS,.01)_"  "_$$GET1^DIQ(2,DFNIENS,.1)_" "_$$GET1^DIQ(2,DFNIENS,.101)
"RTN","MDRPCOP",108,0)
 S @RESULTS@(1)=$$GET1^DIQ(2,DFNIENS,.09)_"  "_$$GET1^DIQ(2,DFNIENS,.02)_"  "_$$GET1^DIQ(2,DFNIENS,.03)_" ("_$$GET1^DIQ(2,DFNIENS,.033)_")"
"RTN","MDRPCOP",109,0)
 Q
"RTN","MDRPCOP",110,0)
 ;
"RTN","MDRPCOP",111,0)
GETOBJ ; [Procedure] Get information for TMDPATIENT object
"RTN","MDRPCOP",112,0)
 D DEM^VADPT,INP^VADPT Q:'$D(VADM)
"RTN","MDRPCOP",113,0)
 S @RESULTS@(0)=DFN
"RTN","MDRPCOP",114,0)
 S @RESULTS@(1)=VADM(1)
"RTN","MDRPCOP",115,0)
 S @RESULTS@(2)=$P(VADM(2),U,2)
"RTN","MDRPCOP",116,0)
 S @RESULTS@(3)=$P(VADM(3),U,2)
"RTN","MDRPCOP",117,0)
 S @RESULTS@(4)=VADM(4)
"RTN","MDRPCOP",118,0)
 S @RESULTS@(5)=$P(VADM(5),U,2)
"RTN","MDRPCOP",119,0)
 I VAIN(4)]"" S @RESULTS@(6)="Ward: "_$P(VAIN(4),U,2)_" Rm: "_VAIN(5)
"RTN","MDRPCOP",120,0)
 E  S @RESULTS@(6)=""
"RTN","MDRPCOP",121,0)
 Q
"RTN","MDRPCOP",122,0)
 ;
"RTN","MDRPCOP",123,0)
GETRES ; [Procedure] Get results report
"RTN","MDRPCOP",124,0)
 F MDX=0:0 S MDX=$O(^MDD(703.1,"ADFN",DFN,MDX)) Q:'MDX  D
"RTN","MDRPCOP",125,0)
 .S MDINST=+$P($G(^MDD(703.1,MDX,0)),U,4)
"RTN","MDRPCOP",126,0)
 .I $G(DATA) Q:'$D(^MDS(702.01,DATA,.1,"B",MDINST))
"RTN","MDRPCOP",127,0)
 .S MDY=$O(@RESULTS@(""),-1)+1
"RTN","MDRPCOP",128,0)
 .S @RESULTS@(MDY)="703.1;"_MDX_U_^MDD(703.1,MDX,0)
"RTN","MDRPCOP",129,0)
 .S Y=$P(^MDD(703.1,MDX,0),U,3) D D^DIQ
"RTN","MDRPCOP",130,0)
 .S $P(@RESULTS@(MDY),U,11)=Y
"RTN","MDRPCOP",131,0)
 .S Y=$P($G(^MDS(702.09,+$P(^MDD(703.1,MDX,0),U,4),0)),U)
"RTN","MDRPCOP",132,0)
 .S $P(@RESULTS@(MDY),U,12)=Y
"RTN","MDRPCOP",133,0)
 S @RESULTS@(0)=+$O(@RESULTS@(""),-1)
"RTN","MDRPCOP",134,0)
 Q
"RTN","MDRPCOP",135,0)
 ;
"RTN","MDRPCOP",136,0)
GETTRAN ; [Procedure] Get a patients transactions
"RTN","MDRPCOP",137,0)
 K ^TMP("MDTMP",$J),^TMP("MDCONL",$J) N MDCDT,MDCDY,MDCOM,MDMULT,MDMULN,MDNUM,MDREQ,MDREQDT,MDYR,X1,X2,X
"RTN","MDRPCOP",138,0)
 S MDNUM=$$GET^XPAR("SYS","MD DAYS TO RETAIN COM STUDY",1) S (MDCDY,MDCOM)=0
"RTN","MDRPCOP",139,0)
 S MDMULN=$$GET^XPAR("SYS","MD DAYS TO RET COM MULT",1)
"RTN","MDRPCOP",140,0)
 I +MDNUM>0 S X1=DT,X2=-MDNUM D C^%DTC S MDCOM=X
"RTN","MDRPCOP",141,0)
 I +MDMULN>0 S X1=DT,X2=-MDMULN D C^%DTC S MDCDY=X
"RTN","MDRPCOP",142,0)
 D CPLIST^GMRCCP(DFN,,$NA(^TMP("MDTMP",$J)))
"RTN","MDRPCOP",143,0)
 S X1=DT,X2=-365 D C^%DTC S MDCDT=X
"RTN","MDRPCOP",144,0)
 S MDX=0 F  S MDX=$O(^TMP("MDTMP",$J,MDX)) Q:'MDX  D:"saprc"[$P(^(MDX),U,4)
"RTN","MDRPCOP",145,0)
 .I $P($G(^TMP("MDTMP",$J,MDX)),U,4)="c" Q:$P($G(^TMP("MDTMP",$J,MDX)),U,1)<MDCDT
"RTN","MDRPCOP",146,0)
 .S ^TMP("MDCONL",$J,$P($G(^TMP("MDTMP",$J,MDX)),U,5))=$P($G(^TMP("MDTMP",$J,MDX)),U,1)
"RTN","MDRPCOP",147,0)
 K ^TMP("MDTMP",$J)
"RTN","MDRPCOP",148,0)
 F MDX=0:0 S MDX=$O(^MDD(702,"B",DFN,+MDX))_"," Q:'MDX  D
"RTN","MDRPCOP",149,0)
 .Q:'$$GET1^DIQ(702,MDX,.05,"I")
"RTN","MDRPCOP",150,0)
 .Q:$G(^TMP("MDCONL",$J,+$$GET1^DIQ(702,MDX,.05,"I")))=""
"RTN","MDRPCOP",151,0)
 .S MDMULT=+$$GET1^DIQ(702,MDX,".04:.12","I")
"RTN","MDRPCOP",152,0)
 .S MDYR=$S(MDMULT<1:MDCOM,1:MDCDT)
"RTN","MDRPCOP",153,0)
 .I MDNUM Q:$$GET1^DIQ(702,MDX,.09,"I")=3&($$GET1^DIQ(702,MDX,.02,"I")<MDYR)
"RTN","MDRPCOP",154,0)
 .I MDMULT=1&(+MDMULN>0) Q:$$GET1^DIQ(702,MDX,.09,"I")=3&($$GET1^DIQ(702,MDX,.02,"I")<MDCDY)
"RTN","MDRPCOP",155,0)
 .S MDREQDT="" I +$$GET1^DIQ(702,MDX,.05,"I") S MDREQDT=$G(^TMP("MDCONL",$J,+$$GET1^DIQ(702,MDX,.05,"I")))
"RTN","MDRPCOP",156,0)
 .I MDREQDT'="" S MDREQDT=$$FMTE^XLFDT(MDREQDT,"1P")
"RTN","MDRPCOP",157,0)
 .S MDREQ=$$GET1^DIQ(702,MDX,.04)_"  "_+MDX_"  (Consult #:"_$$GET1^DIQ(702,MDX,.05,"I")_$S(MDREQDT'="":" Requested: "_MDREQDT,1:"")_")"
"RTN","MDRPCOP",158,0)
 .S Z=$$GET1^DIQ(702,MDX,".04:.02","I")_U_MDREQ_U_$$GET1^DIQ(702,MDX,.02,"I")_U_$$GET1^DIQ(702,MDX,.09)_U_$$GET1^DIQ(702,MDX,.11)_U_$$GET1^DIQ(702,MDX,.991)
"RTN","MDRPCOP",159,0)
 .S Y=$O(@RESULTS@(""),-1)+1
"RTN","MDRPCOP",160,0)
 .S @RESULTS@(Y)="702;"_+MDX_U_Z
"RTN","MDRPCOP",161,0)
 S @RESULTS@(0)=+$O(@RESULTS@(""),-1)
"RTN","MDRPCOP",162,0)
 K ^TMP("MDCONL",$J)
"RTN","MDRPCOP",163,0)
 Q
"RTN","MDRPCOP",164,0)
 ;
"RTN","MDRPCOP",165,0)
GETVST ; [Procedure] Return list of visits
"RTN","MDRPCOP",166,0)
 N BEG,END,VAERR,VASD,BDT,DTM,EDT,LOC,NOW,MDQUERY,MDLST,MDTDF,STI,STS,TODAY,I,J,K,XI,XE,X
"RTN","MDRPCOP",167,0)
 S NOW=$$NOW^XLFDT(),TODAY=$P(NOW,".",1),MDTDF=DFN
"RTN","MDRPCOP",168,0)
 S BEG=$$X2FM($$GETBEG),END=$$X2FM($$GETEND)+0.2359
"RTN","MDRPCOP",169,0)
 S MDLST="",MDSTOP=""
"RTN","MDRPCOP",170,0)
 I END>NOW D   ; get future encounters, past cancels/no-shows from VADPT
"RTN","MDRPCOP",171,0)
 .S VASD("F")=BEG
"RTN","MDRPCOP",172,0)
 .S VASD("T")=END
"RTN","MDRPCOP",173,0)
 .S VASD("W")="129"
"RTN","MDRPCOP",174,0)
 .D SDA^VADPT
"RTN","MDRPCOP",175,0)
 .S I=0 F  S I=$O(^UTILITY("VASD",$J,I)) Q:'I  D
"RTN","MDRPCOP",176,0)
 ..S XI=^UTILITY("VASD",$J,I,"I"),XE=^("E")
"RTN","MDRPCOP",177,0)
 ..S DTM=$P(XI,U),IEN=$P(XI,U,2),STI=$P(XI,U,3)
"RTN","MDRPCOP",178,0)
 ..S LOC=$P(XE,U,2),STS=$P(XE,U,3)
"RTN","MDRPCOP",179,0)
 ..I DTM<TODAY,(STI=""!(STI["I")!(STI="NT")) Q  ; no prior kept appts
"RTN","MDRPCOP",180,0)
 ..S MDLST(DTM,"A",1)="A;"_DTM_";"_IEN_U_DTM_U_LOC_U_STS
"RTN","MDRPCOP",181,0)
 .K ^UTILITY("VASD",$J)
"RTN","MDRPCOP",182,0)
 I BEG'>NOW D  ;past encounters from ACRP Toolkit - set in CALLBACK
"RTN","MDRPCOP",183,0)
 .S BDT=BEG
"RTN","MDRPCOP",184,0)
 .S EDT=$S(END<NOW:END,1:NOW)
"RTN","MDRPCOP",185,0)
 .D OPEN^SDQ(.MDQUERY)
"RTN","MDRPCOP",186,0)
 .I '$$ERRCHK^SDQUT() D INDEX^SDQ(.MDQUERY,"PATIENT/DATE","SET")
"RTN","MDRPCOP",187,0)
 .I '$$ERRCHK^SDQUT() D PAT^SDQ(.MDQUERY,DFN,"SET")
"RTN","MDRPCOP",188,0)
 .I '$$ERRCHK^SDQUT() D DATE^SDQ(.MDQUERY,BDT,EDT,"SET")
"RTN","MDRPCOP",189,0)
 .I '$$ERRCHK^SDQUT() D
"RTN","MDRPCOP",190,0)
 ..D SCANCB^SDQ(.MDQUERY,"D CALLBACK^ORWCV(Y,Y0,$NA(MDLST),.MDSTOP)","SET")
"RTN","MDRPCOP",191,0)
 .I '$$ERRCHK^SDQUT() D ACTIVE^SDQ(.MDQUERY,"TRUE","SET")
"RTN","MDRPCOP",192,0)
 .I '$$ERRCHK^SDQUT() D SCAN^SDQ(.MDQUERY,"FORWARD")
"RTN","MDRPCOP",193,0)
 .D CLOSE^SDQ(.MDQUERY)
"RTN","MDRPCOP",194,0)
 N TIM,MOV,MDX0,Y,MTIM,XTYP,XLOC,XLOCI,HLOC,EARLY,DONE ; admits
"RTN","MDRPCOP",195,0)
 S EARLY=BEG,DONE=0 S:$G(DFN)="" DFN=MDTDF
"RTN","MDRPCOP",196,0)
 S TIM="" F  S TIM=$O(^DGPM("ATID1",DFN,TIM)) Q:TIM'>0  D  Q:DONE
"RTN","MDRPCOP",197,0)
 .S MOV=0  F  S MOV=$O(^DGPM("ATID1",DFN,TIM,MOV)) Q:MOV'>0  D  Q:DONE
"RTN","MDRPCOP",198,0)
 ..D GETS^DIQ(405,+MOV_",",".01;.04;.06","IE","MDX0") S MTIM=$G(MDX0(405,MOV_",",".01","I"))
"RTN","MDRPCOP",199,0)
 ..S XTYP=$G(MDX0(405,+MOV_",",".04","E"))
"RTN","MDRPCOP",200,0)
 ..S XLOC=$G(MDX0(405,+MOV_",",".06","E"))
"RTN","MDRPCOP",201,0)
 ..S XLOCI=+$G(MDX0(405,+MOV_",",".06","I")),HLOC=+$G(^DIC(42,+XLOCI,44))
"RTN","MDRPCOP",202,0)
 ..S MDLST(MTIM,"I",1)="I;"_MTIM_";"_HLOC_U_MTIM_U_"Inpatient Stay"_U_XLOC_U_XTYP
"RTN","MDRPCOP",203,0)
 ..S DONE=1  ; Not sure if I should include all stays <DRP@Hines>
"RTN","MDRPCOP",204,0)
 S I=0 F  S I=$O(MDLST(I)) Q:'I  D
"RTN","MDRPCOP",205,0)
 .S J="" F  S J=$O(MDLST(I,J)) Q:J=""  D
"RTN","MDRPCOP",206,0)
 ..S K=0 F  S K=$O(MDLST(I,J,K)) Q:'K  D
"RTN","MDRPCOP",207,0)
 ...S @RESULTS@($O(@RESULTS@(""),-1)+1)=MDLST(I,J,K)
"RTN","MDRPCOP",208,0)
 S:$G(DFN)="" DFN=MDTDF S @RESULTS@(0)=+$O(@RESULTS@(""),-1)_U_($$GET1^DIQ(2,DFN_",",.1)]"")
"RTN","MDRPCOP",209,0)
 Q
"RTN","MDRPCOP",210,0)
 ;
"RTN","MDRPCOP",211,0)
GETBEG() ; Get Beginning Date Range
"RTN","MDRPCOP",212,0)
 I $$GET^XPAR("SYS","MD APPOINT START DATE",1)>1 Q "T-"_$$GET^XPAR("SYS","MD APPOINT START DATE",1)
"RTN","MDRPCOP",213,0)
 Q "T-200"
"RTN","MDRPCOP",214,0)
GETEND() ; Get Ending Date Range
"RTN","MDRPCOP",215,0)
 I $$GET^XPAR("SYS","MD APPOINT END DATE",1)>1 Q "T+"_$$GET^XPAR("SYS","MD APPOINT END DATE",1)
"RTN","MDRPCOP",216,0)
 Q "T"
"RTN","MDRPCOP",217,0)
LOGSEC ; [Procedure] Log Security
"RTN","MDRPCOP",218,0)
 N RES
"RTN","MDRPCOP",219,0)
 D NOTICE^DGSEC4(.RES,DFN,DATA,1)
"RTN","MDRPCOP",220,0)
 S @RESULTS@(0)=$S(+RES:"1^Logged",1:"-1^Unable to log")
"RTN","MDRPCOP",221,0)
 Q
"RTN","MDRPCOP",222,0)
 ;
"RTN","MDRPCOP",223,0)
RPC(RESULTS,OPTION,DFN,DATA) ; [Procedure] Main RPC call tag
"RTN","MDRPCOP",224,0)
 NEW DFNIENS,GMRAL,GMVALG,GN,IENS,MDDFN,MDERR,MDFDA,MDFLD,MDHL7,MDID,MDIDS,MDIEN,MDIENS,MDRET,MDX,MDY,VA,VADM,VAERR,VAIN,Z
"RTN","MDRPCOP",225,0)
 S RESULTS=$NA(^TMP($J)) K @RESULTS
"RTN","MDRPCOP",226,0)
 D:$T(@OPTION)]"" @OPTION
"RTN","MDRPCOP",227,0)
 D:'$D(@RESULTS) BADRPC^MDRPCU("MD TMDPATIENT","MDRPCOP",OPTION)
"RTN","MDRPCOP",228,0)
 D CLEAN^DILF
"RTN","MDRPCOP",229,0)
 Q
"RTN","MDRPCOP",230,0)
 ;
"RTN","MDRPCOP",231,0)
SELECT ; [Procedure] Select patient
"RTN","MDRPCOP",232,0)
 ; Moved to continuation routine at MD*1.0*6 due to routine size
"RTN","MDRPCOP",233,0)
 D SELECT^MDRPCOP1
"RTN","MDRPCOP",234,0)
 Q
"RTN","MDRPCOP",235,0)
 ;
"RTN","MDRPCOP",236,0)
X2FM(X) ; [Function] return FM date given relative date
"RTN","MDRPCOP",237,0)
 N %DT S %DT="TS" D ^%DT
"RTN","MDRPCOP",238,0)
 Q Y
"RTN","MDRPCOP",239,0)
 ;
"RTN","MDWOR")
0^2^B47515185^B43803580
"RTN","MDWOR",1,0)
MDWOR ; HOIFO/NCA - Main Routine to Decode HL7 ;9/8/08  15:20
"RTN","MDWOR",2,0)
 ;;1.0;CLINICAL PROCEDURES;**14,11,21,20,37,42**;Apr 01,2004;Build 12
"RTN","MDWOR",3,0)
 ; Reference IA# 2263 [Supported] XPAR calls
"RTN","MDWOR",4,0)
 ;               3468 [Subscription] Call GMRCCP.
"RTN","MDWOR",5,0)
 ;               3071 [Subscription] Call $$PKGID^ORX8.
"RTN","MDWOR",6,0)
 ;              10035 [Supported] Access DPT("B"
"RTN","MDWOR",7,0)
 ;              10040 [Supported] Access SC(
"RTN","MDWOR",8,0)
 ;              10061 [Supported] VADPT call
"RTN","MDWOR",9,0)
 ;              10103 [Supported] XLFDT calls
"RTN","MDWOR",10,0)
 ; 03/18/2014 KAM MD*1*37 Rem Ticket 451758 Auto Check-in issue
"RTN","MDWOR",11,0)
EN(MDMSG) ; Entry Point for CPRS and pass MSG in MDMSG
"RTN","MDWOR",12,0)
 N DFN,MDCON,MDCPROC,MDCANC,MDCANR,MDFN,MDIFN,MDINST,MDFLG,MDINT,MDL,MDIN,MDINP,MDINST,MDLOC,MDNAM,MDOBC,MDOBX,MDOPRO,MDPROC,MDPAT
"RTN","MDWOR",13,0)
 N MDLL,MDK1,MDPROV,MDREQ,MDQTIM,MDROOT,MDRR,MDSINP,MDVSTD,MDX S MDVSTD=""
"RTN","MDWOR",14,0)
 S (MDFLG,MDINP,MDINST,MDCANC,MDOBC)=0 F MDL=0:0 S MDL=$O(MDMSG(MDL)) Q:MDL<1!(+MDFLG>0)  S MDX=$G(MDMSG(MDL)) D
"RTN","MDWOR",15,0)
 .I $E(MDX,1,3)="MSH" D MSH Q
"RTN","MDWOR",16,0)
 .I $E(MDX,1,3)="PID" D PID Q
"RTN","MDWOR",17,0)
 .I $E(MDX,1,3)="PV1" D PV1 Q
"RTN","MDWOR",18,0)
 .I $E(MDX,1,3)="ORC" D ORC Q
"RTN","MDWOR",19,0)
 .I $E(MDX,1,3)="OBR" D OBR Q
"RTN","MDWOR",20,0)
 .I $E(MDX,1,3)="OBX" D:MDOBC<1 OBX Q
"RTN","MDWOR",21,0)
 .Q
"RTN","MDWOR",22,0)
 D GETLST^XPAR(.MDLL,"SYS","MD CLINIC ASSOCIATION")
"RTN","MDWOR",23,0)
 I +MDFLG<1&(+MDCANC<1)&(MDVSTD="") F MDK1=0:0 S MDK1=$O(MDLL(MDK1)) Q:MDK1<1  S MDROOT=$G(MDLL(MDK1)) I +$P(MDROOT,";",2)=MDPROC D  Q:+MDRR
"RTN","MDWOR",24,0)
 .S MDRR=0,MDIFN=MDFN,MDRR=$$GETAPPT(MDIFN,+$P(MDROOT,"^",2))
"RTN","MDWOR",25,0)
 .S:+MDRR MDVSTD="A"_";"_$P(MDRR,"^",1)_";"_+$P(MDROOT,"^",2)
"RTN","MDWOR",26,0)
 I +MDFLG<1&(MDVSTD'="") F MDK1=0:0 S MDK1=$O(MDLL(MDK1)) Q:MDK1<1  S MDROOT=$P($G(MDLL(MDK1)),"^",2) I +$P(MDROOT,";",2)=MDPROC D
"RTN","MDWOR",27,0)
 .I +$P(MDVSTD,";",3)>0&(+MDROOT=$P(MDVSTD,";",3)) S MDFLG=0 Q
"RTN","MDWOR",28,0)
 ;
"RTN","MDWOR",29,0)
 ; 03/18/2014 KAM MD*1*37 Rem Ticket 451758
"RTN","MDWOR",30,0)
 ; Commented out the next line - setting the MDFLG to 1 on a clinic 
"RTN","MDWOR",31,0)
 ; change is not needed
"RTN","MDWOR",32,0)
 ;.I +$P(MDVSTD,";",3)>0&(+MDROOT'=$P(MDVSTD,";",3)) S MDFLG=1 Q
"RTN","MDWOR",33,0)
 ;
"RTN","MDWOR",34,0)
 I +MDFLG<1&(+MDCANC<1) S MDATA="+1,^"_MDPROC_"^"_+MDCON_"^"_MDINST_"^"_MDVSTD D CHKIN(MDFN,MDREQ,MDPROV,MDATA,MDVSTD)
"RTN","MDWOR",35,0)
 Q
"RTN","MDWOR",36,0)
MSH ; Decode MSH
"RTN","MDWOR",37,0)
 I $P(MDX,"|",2)'="^~\&" S MDFLG=1 Q
"RTN","MDWOR",38,0)
 I $P(MDX,"|",3)'="ORDER ENTRY" S MDFLG=1 Q
"RTN","MDWOR",39,0)
 I $P(MDX,"|",9)'="ORM" S MDFLG=1 Q
"RTN","MDWOR",40,0)
 Q
"RTN","MDWOR",41,0)
PID ; Check PID
"RTN","MDWOR",42,0)
 S MDNAM=$P(MDX,"|",6),DFN=$P(MDX,"|",4)
"RTN","MDWOR",43,0)
 I '$D(^DPT("B",$E(MDNAM,1,30),DFN)) S MDFLG=1
"RTN","MDWOR",44,0)
 S MDFN=DFN
"RTN","MDWOR",45,0)
 Q
"RTN","MDWOR",46,0)
PV1 ; Check PV1
"RTN","MDWOR",47,0)
 S MDPAT=$P(MDX,"|",3) I MDPAT'?1U!("IO"'[MDPAT) S MDFLG=1 Q
"RTN","MDWOR",48,0)
 I MDPAT="I" S MDINP=1
"RTN","MDWOR",49,0)
 S MDLOC=+$P(MDX,"|",4) I $G(^SC(MDLOC,0))="" S MDFLG=1 Q
"RTN","MDWOR",50,0)
 S:MDINP>0 MDLOC=""
"RTN","MDWOR",51,0)
 Q
"RTN","MDWOR",52,0)
ORC ; Check ORC
"RTN","MDWOR",53,0)
 I $P(MDX,"|",2)="NW" D NEW Q
"RTN","MDWOR",54,0)
 I $P(MDX,"|",2)="DC" D CANCEL Q
"RTN","MDWOR",55,0)
 S MDFLG=1
"RTN","MDWOR",56,0)
 Q
"RTN","MDWOR",57,0)
OBX ; Check OBX
"RTN","MDWOR",58,0)
 N %,ANSWER,MDCV,MDOBX
"RTN","MDWOR",59,0)
 S MDOBX=$P(MDX,"|",6)
"RTN","MDWOR",60,0)
 I '+$$GET^XPAR("SYS","MD USE APPT WITH PROCEDURE",1) S MDOBC=MDOBC+1 Q
"RTN","MDWOR",61,0)
 S MDVSTD=$P(MDOBX,"Visit Date: ",2)
"RTN","MDWOR",62,0)
 S MDCV=$P(MDVSTD," ",1,2)
"RTN","MDWOR",63,0)
 I MDCV=""!(MDCV["UNKNOWN") S MDFLG=1 Q
"RTN","MDWOR",64,0)
 S MDVSTD=$P(MDCV," ")_"@"_$P(MDCV," ",2)
"RTN","MDWOR",65,0)
 D DT^DILF("T",MDVSTD,.ANSWER)
"RTN","MDWOR",66,0)
 S:ANSWER<0 ANSWER=""
"RTN","MDWOR",67,0)
 S MDVSTD=ANSWER I MDVSTD="" S MDFLG=1 Q
"RTN","MDWOR",68,0)
 I +MDLOC>0 S MDVSTD="A;"_MDVSTD_";"_MDLOC
"RTN","MDWOR",69,0)
 E  D NOW^%DTC S MDVSTD=%
"RTN","MDWOR",70,0)
 S MDOBC=MDOBC+1
"RTN","MDWOR",71,0)
 Q
"RTN","MDWOR",72,0)
NEW ; New Order Segment
"RTN","MDWOR",73,0)
 S MDIFN=+$P(MDX,"|",3) I 'MDIFN S MDFLG=1 Q
"RTN","MDWOR",74,0)
 S MDPROV=+$P(MDX,"|",11) I 'MDPROV S MDFLG=1 Q
"RTN","MDWOR",75,0)
 S MDQTIM=$P(MDX,"|",8),MDQTIM=$P(MDQTIM,"^",6)
"RTN","MDWOR",76,0)
 S MDREQ=$P(MDX,"|",16) S MDREQ=$$FMDTE(MDREQ) I 'MDREQ S MDFLG=1 Q
"RTN","MDWOR",77,0)
 S MDREQ=$S(MDQTIM="Z24":$$FMADD^XLFDT(MDREQ,0,24),MDQTIM="Z48":$$FMADD^XLFDT(MDREQ,0,48),MDQTIM="Z72":$$FMADD^XLFDT(MDREQ,0,72),MDQTIM="ZW":$$FMADD^XLFDT(MDREQ,7),MDQTIM="ZM":$$FMADD^XLFDT(MDREQ,30),1:MDREQ)
"RTN","MDWOR",78,0)
 ; Retrieve Consult Number
"RTN","MDWOR",79,0)
 N MDFDA
"RTN","MDWOR",80,0)
 S MDCON=$$PKGID^ORX8(MDIFN) I 'MDCON S MDFLG=1 Q
"RTN","MDWOR",81,0)
 Q
"RTN","MDWOR",82,0)
OBR ; Check OBR
"RTN","MDWOR",83,0)
 S MDPROC=$P(MDX,"|",5)
"RTN","MDWOR",84,0)
 I $E($P(MDPROC,"^",6),3,5)'["PRC" S MDFLG=1 Q
"RTN","MDWOR",85,0)
 S MDCPROC=$P(MDPROC,"^",4) I 'MDCPROC S MDFLG=1 Q
"RTN","MDWOR",86,0)
 ; Get Procedure for CP IEN
"RTN","MDWOR",87,0)
 S MDPROC=$$CPROC^GMRCCP(MDCPROC) I 'MDPROC S MDFLG=1 Q
"RTN","MDWOR",88,0)
 S MDSINP=$$HIGHV(MDPROC) I +MDSINP'>0 S MDFLG=1 Q
"RTN","MDWOR",89,0)
 S (MDINST,MDINT)=0 F MDIN=0:0 S MDIN=$O(^MDS(702.01,MDPROC,.1,MDIN)) Q:MDIN<1!(+MDINST)  S MDINT=+$G(^(MDIN,0)) D
"RTN","MDWOR",90,0)
 .I +$$GET1^DIQ(702.09,+MDINT,".13","I") S MDINST=MDINT Q
"RTN","MDWOR",91,0)
 I +$P(MDSINP,"^",2)=2 D  Q
"RTN","MDWOR",92,0)
 .I +MDINP S MDVSTD="",MDOBC=MDOBC+1 Q
"RTN","MDWOR",93,0)
 .S MDVSTD=MDREQ,MDOBC=MDOBC+1 Q
"RTN","MDWOR",94,0)
 I +$P(MDSINP,"^",2)=3 D  Q
"RTN","MDWOR",95,0)
 .I +MDINP S MDVSTD="",MDOBC=MDOBC+1 Q
"RTN","MDWOR",96,0)
 I +$P(MDSINP,"^",2)=1 D  Q
"RTN","MDWOR",97,0)
 .I '+MDINP S MDVSTD="" Q
"RTN","MDWOR",98,0)
 .S MDVSTD=MDREQ,MDOBC=MDOBC+1 Q
"RTN","MDWOR",99,0)
 ;I +MDINP&('$P(^MDS(702.01,MDPROC,0),"^",5)) S MDFLG=1 Q
"RTN","MDWOR",100,0)
 I +MDINP S MDVSTD=MDREQ,MDOBC=MDOBC+1 Q
"RTN","MDWOR",101,0)
 S MDVSTD=MDREQ,MDOBC=MDOBC+1 Q
"RTN","MDWOR",102,0)
 Q
"RTN","MDWOR",103,0)
CANCEL ; Cancel/Discontinue
"RTN","MDWOR",104,0)
 K MDR S MDIFN=+$P(MDX,"|",3),MDCON=+$P(MDX,"|",4),MDCANC=1
"RTN","MDWOR",105,0)
 I 'MDIFN S MDFLG=1 Q
"RTN","MDWOR",106,0)
 I 'MDCON S MDFLG=1 Q
"RTN","MDWOR",107,0)
 S MDPROV=+$P(MDX,"|",13) I 'MDPROV S MDFLG=1 Q
"RTN","MDWOR",108,0)
 S MDREQ=$P(MDX,"|",16) I 'MDREQ S MDFLG=1 Q
"RTN","MDWOR",109,0)
 S MDINST=$O(^MDD(702,"ACON",MDCON,0)) Q:'MDINST
"RTN","MDWOR",110,0)
 Q:$G(^MDD(702,+MDINST,0))=""
"RTN","MDWOR",111,0)
 I "5"[$P(^MDD(702,+MDINST,0),U,9) S MDCANR=$$CANCEL^MDHL7B(+MDINST)
"RTN","MDWOR",112,0)
 N MDFDA S MDFDA(702,MDINST_",",.09)=6
"RTN","MDWOR",113,0)
 D FILE^DIE("K","MDFDA") K MDFDA
"RTN","MDWOR",114,0)
 N MDHEMO S MDHEMO=+$$GET1^DIQ(702,+MDINST,".04:.06","I")
"RTN","MDWOR",115,0)
 Q:MDHEMO<2
"RTN","MDWOR",116,0)
 Q:$G(^MDK(704.202,+MDINST,0))=""
"RTN","MDWOR",117,0)
 S MDFDA(704.202,+MDINST_",",.09)=0
"RTN","MDWOR",118,0)
 D FILE^DIE("","MDFDA")
"RTN","MDWOR",119,0)
 K ^MDK(704.202,"AS",1,+MDINST)
"RTN","MDWOR",120,0)
 S ^MDK(704.202,"AS",0,+MDINST)=""
"RTN","MDWOR",121,0)
 Q
"RTN","MDWOR",122,0)
CHKIN(MDFN,MDREQ,MDPROV,MDATA,MDVSTD) ; [Procedure] Check In Study
"RTN","MDWOR",123,0)
 N MDCART,MDREZ,MDX1,MDFDA,MDIEN,MDIENS,MDERR,MDHL7,MDHOLD,MDSCHD,MDMAXD,MDXY,MDNOW S MDCART=0
"RTN","MDWOR",124,0)
 F MDX1=2:1:5 D
"RTN","MDWOR",125,0)
 .I $P(MDATA,U,MDX1)]"" S MDFDA(702,$P(MDATA,U,1),$P("^.04^.05^.11^.07",U,MDX1))=$P(MDATA,U,MDX1)
"RTN","MDWOR",126,0)
 ; Remove code after instrument testing available
"RTN","MDWOR",127,0)
 ; End of code removal after instrument available for testin
"RTN","MDWOR",128,0)
 S MDSCHD=$S($L(MDVSTD,";")=1:MDVSTD,1:$P(MDVSTD,";",2)),MDMAXD=DT+.24
"RTN","MDWOR",129,0)
 S MDFDA(702,$P(MDATA,U,1),.09)=$S(MDSCHD="":0,MDSCHD>MDMAXD:0,1:5)  ; Status = Checked-In
"RTN","MDWOR",130,0)
 I +$P(MDATA,U,4),+$G(^MDS(702.09,+$P(MDATA,U,4),"CS")) S MDCART=1
"RTN","MDWOR",131,0)
 I $P(MDATA,U,1)="+1," D
"RTN","MDWOR",132,0)
 .S MDFDA(702,"+1,",.01)=MDFN
"RTN","MDWOR",133,0)
 .S MDFDA(702,"+1,",.02)=$$NOW^XLFDT()
"RTN","MDWOR",134,0)
 .S MDFDA(702,"+1,",.03)=MDPROV
"RTN","MDWOR",135,0)
 .S:+MDSCHD MDFDA(702,"+1,",.14)=MDSCHD
"RTN","MDWOR",136,0)
 .D UPDATE^DIE("","MDFDA","MDIEN","MDERR") Q:$D(MDERR)
"RTN","MDWOR",137,0)
 .Q:MDSCHD>MDMAXD!(MDSCHD="")
"RTN","MDWOR",138,0)
 .S MDIENS=MDIEN(1)_",",MDXY=+$P(MDATA,U,2),MDHOLD="" I +MDXY D
"RTN","MDWOR",139,0)
 ..Q:$P(^MDS(702.01,MDXY,0),U,6)'=2
"RTN","MDWOR",140,0)
 ..S MDHOLD=$P($G(^MDD(702,MDIEN(1),0)),"^",7),MDNOW=$$NOW^XLFDT()
"RTN","MDWOR",141,0)
 ..S $P(^MDD(702,MDIEN(1),0),"^",7)=MDSCHD
"RTN","MDWOR",142,0)
 .S MDHL7=$$SUB^MDHL7B(MDIEN(1))
"RTN","MDWOR",143,0)
 .I +MDHL7=-1 S MDFDA(702,MDIENS,.09)=2,MDFDA(702,MDIENS,.08)=$P(MDHL7,U,2)
"RTN","MDWOR",144,0)
 .I +MDHL7=1 S MDFDA(702,MDIENS,.09)=5,MDFDA(702,MDIENS,.08)=""
"RTN","MDWOR",145,0)
 .D:$D(MDFDA) FILE^DIE("","MDFDA","MDERR")
"RTN","MDWOR",146,0)
 I +MDCART>0 D
"RTN","MDWOR",147,0)
 .S MDREZ=$$NEWTIUN^MDRPCOT(+MDIEN(1))
"RTN","MDWOR",148,0)
 .I +MDREZ<0 D FILEMSG^MDRPCOT(+MDIEN(1),"TIU",2,MDREZ)
"RTN","MDWOR",149,0)
 .S MDREZ=$$SUBMIT^MDRPCOT1(MDIEN(1))
"RTN","MDWOR",150,0)
 .D FILEMSG^MDRPCOT(+MDIEN(1),"IMAGING",$S(+MDREZ>0:+MDREZ,1:2),MDREZ)
"RTN","MDWOR",151,0)
 Q:MDSCHD>MDMAXD!(MDSCHD="")
"RTN","MDWOR",152,0)
 D:+$G(MDIENS)
"RTN","MDWOR",153,0)
 .S MDXY=+$P(MDATA,U,2) Q:'MDXY
"RTN","MDWOR",154,0)
 .I $P(^MDS(702.01,MDXY,0),U,6)=2 D  Q  ; Renal Check-In
"RTN","MDWOR",155,0)
 ..D CP^MDKUTL(+MDIENS)
"RTN","MDWOR",156,0)
 ..S:$G(MDHOLD)'="" MDFDA(702,+MDIENS_",",.07)=MDHOLD
"RTN","MDWOR",157,0)
 ..S MDFDA(702,+MDIENS_",",.09)=5
"RTN","MDWOR",158,0)
 ..D FILE^DIE("","MDFDA","MDERR")
"RTN","MDWOR",159,0)
 Q
"RTN","MDWOR",160,0)
FMDTE(DATE) ; Convert HL-7 formatted date to a Fileman formatted date
"RTN","MDWOR",161,0)
 N X
"RTN","MDWOR",162,0)
 S X="" I DATE D
"RTN","MDWOR",163,0)
 .S X=$$HL7TFM^XLFDT(DATE,"L")
"RTN","MDWOR",164,0)
 Q X
"RTN","MDWOR",165,0)
HIGHV(MDHV) ; Return flag indicator whether procedure is use for auto check-in
"RTN","MDWOR",166,0)
 N MDANS,MDK,MDKY,MDLST S MDANS=0
"RTN","MDWOR",167,0)
 D GETLST^XPAR(.MDLST,"SYS","MD CHECK-IN PROCEDURE LIST")
"RTN","MDWOR",168,0)
 F MDK=0:0 S MDK=$O(MDLST(MDK)) Q:MDK<1  S MDKY=$G(MDLST(MDK)) D
"RTN","MDWOR",169,0)
 .I MDHV=+$P(MDKY,"^") S MDANS=MDKY
"RTN","MDWOR",170,0)
 Q MDANS
"RTN","MDWOR",171,0)
GETAPPT(MDDPAT,MDDA) ; Get appointment
"RTN","MDWOR",172,0)
 N DFN,MDALP,MDARES K ^UTILITY("VASD",$J) S DFN=MDDPAT
"RTN","MDWOR",173,0)
 S X1=DT,X2=365 D C^%DTC S VASD("T")=X+.24,VASD("F")=DT,VASD("W")="129",VASD("C",+MDDA)=+MDDA D SDA^VADPT
"RTN","MDWOR",174,0)
 S MDARES=0 F MDALP=0:0 S MDALP=$O(^UTILITY("VASD",$J,MDALP)) Q:MDALP<1  S MDARES=$G(^(MDALP,"I")) Q
"RTN","MDWOR",175,0)
 K ^UTILITY("VASD",$J),VASD,X1,X2,X
"RTN","MDWOR",176,0)
 Q MDARES
"VER")
8.0^22.0
"^DD",702.09,702.09,.401,0)
CONSULT KEEP OPEN^S^0:No;1:Yes;^CS;1^Q
"^DD",702.09,702.09,.401,3)
Enter Yes to keep consult note open or No to close consult note.
"^DD",702.09,702.09,.401,"DT")
3150619
"BLD",9642,6)
^29
**END**
**END**

