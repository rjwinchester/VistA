Released MD*1*47 SEQ #38
Extracted from mail message
**KIDS**:MD*1.0*47^

**INSTALL NAME**
MD*1.0*47
"BLD",10321,0)
MD*1.0*47^CLINICAL PROCEDURES^0^3170222^y
"BLD",10321,1,0)
^^1^1^3160815^^
"BLD",10321,1,1,0)
MODIFICATIONS TO UTILIZE IMMUN FILE GROUP DATA
"BLD",10321,4,0)
^9.64PA^^
"BLD",10321,6.3)
3
"BLD",10321,"ABPKG")
n
"BLD",10321,"KRN",0)
^9.67PA^779.2^20
"BLD",10321,"KRN",.4,0)
.4
"BLD",10321,"KRN",.4,"NM",0)
^9.68A^^0
"BLD",10321,"KRN",.401,0)
.401
"BLD",10321,"KRN",.401,"NM",0)
^9.68A^^0
"BLD",10321,"KRN",.402,0)
.402
"BLD",10321,"KRN",.403,0)
.403
"BLD",10321,"KRN",.403,"NM",0)
^9.68A^^0
"BLD",10321,"KRN",.5,0)
.5
"BLD",10321,"KRN",.84,0)
.84
"BLD",10321,"KRN",3.6,0)
3.6
"BLD",10321,"KRN",3.8,0)
3.8
"BLD",10321,"KRN",3.8,"NM",0)
^9.68A^^0
"BLD",10321,"KRN",9.2,0)
9.2
"BLD",10321,"KRN",9.8,0)
9.8
"BLD",10321,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",10321,"KRN",9.8,"NM",1,0)
MDKRPC1^^0^B98792793
"BLD",10321,"KRN",9.8,"NM","B","MDKRPC1",1)

"BLD",10321,"KRN",19,0)
19
"BLD",10321,"KRN",19,"NM",0)
^9.68A^^0
"BLD",10321,"KRN",19.1,0)
19.1
"BLD",10321,"KRN",19.1,"NM",0)
^9.68A^^0
"BLD",10321,"KRN",101,0)
101
"BLD",10321,"KRN",101,"NM",0)
^9.68A^^0
"BLD",10321,"KRN",409.61,0)
409.61
"BLD",10321,"KRN",771,0)
771
"BLD",10321,"KRN",771,"NM",0)
^9.68A^^0
"BLD",10321,"KRN",779.2,0)
779.2
"BLD",10321,"KRN",870,0)
870
"BLD",10321,"KRN",870,"NM",0)
^9.68A^^0
"BLD",10321,"KRN",8989.51,0)
8989.51
"BLD",10321,"KRN",8989.51,"NM",0)
^9.68A^^0
"BLD",10321,"KRN",8989.52,0)
8989.52
"BLD",10321,"KRN",8994,0)
8994
"BLD",10321,"KRN",8994,"NM",0)
^9.68A^^0
"BLD",10321,"KRN","B",.4,.4)

"BLD",10321,"KRN","B",.401,.401)

"BLD",10321,"KRN","B",.402,.402)

"BLD",10321,"KRN","B",.403,.403)

"BLD",10321,"KRN","B",.5,.5)

"BLD",10321,"KRN","B",.84,.84)

"BLD",10321,"KRN","B",3.6,3.6)

"BLD",10321,"KRN","B",3.8,3.8)

"BLD",10321,"KRN","B",9.2,9.2)

"BLD",10321,"KRN","B",9.8,9.8)

"BLD",10321,"KRN","B",19,19)

"BLD",10321,"KRN","B",19.1,19.1)

"BLD",10321,"KRN","B",101,101)

"BLD",10321,"KRN","B",409.61,409.61)

"BLD",10321,"KRN","B",771,771)

"BLD",10321,"KRN","B",779.2,779.2)

"BLD",10321,"KRN","B",870,870)

"BLD",10321,"KRN","B",8989.51,8989.51)

"BLD",10321,"KRN","B",8989.52,8989.52)

"BLD",10321,"KRN","B",8994,8994)

"BLD",10321,"QUES",0)
^9.62^^
"BLD",10321,"REQB",0)
^9.611^3^3
"BLD",10321,"REQB",1,0)
MD*1.0*6^2
"BLD",10321,"REQB",2,0)
PX*1.0*201^2
"BLD",10321,"REQB",3,0)
PX*1.0*210^2
"BLD",10321,"REQB","B","MD*1.0*6",1)

"BLD",10321,"REQB","B","PX*1.0*201",2)

"BLD",10321,"REQB","B","PX*1.0*210",3)

"MBREQ")
0
"PKG",572,-1)
1^1
"PKG",572,0)
CLINICAL PROCEDURES^MD^Clinical Procedures
"PKG",572,20,0)
^9.402P^^
"PKG",572,22,0)
^9.49I^1^1
"PKG",572,22,1,0)
1.0^3040521^3150407^66481
"PKG",572,22,1,"PAH",1,0)
47^3170222
"PKG",572,22,1,"PAH",1,1,0)
^^1^1^3170222
"PKG",572,22,1,"PAH",1,1,1,0)
MODIFICATIONS TO UTILIZE IMMUN FILE GROUP DATA
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","MDKRPC1")
0^1^B98792793^B71764954
"RTN","MDKRPC1",1,0)
MDKRPC1 ;HIOFO/FT-RPC to return patient data ;8/12/16 10:45am
"RTN","MDKRPC1",2,0)
 ;;1.0;CLINICAL PROCEDURES;**6,47**;Apr 01, 2004;Build 3
"RTN","MDKRPC1",3,0)
 ;
"RTN","MDKRPC1",4,0)
 ; 08/12/2016 KAM/BAY CA/SDM - I9088043FY16/MD*1*47 Modifications to
"RTN","MDKRPC1",5,0)
 ;                             utilize the new Group Name field in
"RTN","MDKRPC1",6,0)
 ;                             the Immunization File (9999999.14) for
"RTN","MDKRPC1",7,0)
 ;                             Hemodialysis
"RTN","MDKRPC1",8,0)
 ;
"RTN","MDKRPC1",9,0)
 ; This routine uses the following IAs:
"RTN","MDKRPC1",10,0)
 ; #1239  - ^PXRHS03               (controlled)
"RTN","MDKRPC1",11,0)
 ; #1240  - ^PXRHS04               (private)
"RTN","MDKRPC1",12,0)
 ; #1625  - ^XUA4A72               (supported)
"RTN","MDKRPC1",13,0)
 ; #2263  - ^XPAR                  (supported)
"RTN","MDKRPC1",14,0)
 ; #2864  - ^TIUPP3 calls          (controlled)
"RTN","MDKRPC1",15,0)
 ; #3065  - ^XLFNAME               (supported)
"RTN","MDKRPC1",16,0)
 ; #3556  - ^LA7QRY                (controlled)
"RTN","MDKRPC1",17,0)
 ; #10035 - ^DPT global refs       (supported)
"RTN","MDKRPC1",18,0)
 ; #10060 - ^FILE 200 refs         (supported)
"RTN","MDKRPC1",19,0)
 ; #10099 - ^GMRADPT calls         (supported)
"RTN","MDKRPC1",20,0)
 ; #10103 - ^XLFDT calls           (supported)
"RTN","MDKRPC1",21,0)
 ; #4868  - VA(200,"AUSER"         (Private)
"RTN","MDKRPC1",22,0)
 ;
"RTN","MDKRPC1",23,0)
RPC(RESULT,OPTION,DATA) ; RPC to return existing VistA patient data for
"RTN","MDKRPC1",24,0)
 ; renal dialysis data entry.
"RTN","MDKRPC1",25,0)
 ; RPC: [MDK GET VISTA DATA]
"RTN","MDKRPC1",26,0)
 ;
"RTN","MDKRPC1",27,0)
 ; Input parameters
"RTN","MDKRPC1",28,0)
 ;  1. RESULT [Reference/Required] RPC Return array
"RTN","MDKRPC1",29,0)
 ;  2. OPTION [Literal/Required] RPC Option to execute
"RTN","MDKRPC1",30,0)
 ;  3. DATA [Literal/Required] Other data as required for call
"RTN","MDKRPC1",31,0)
 ;
"RTN","MDKRPC1",32,0)
 K RESULT
"RTN","MDKRPC1",33,0)
 D:$T(@OPTION)]"" @OPTION
"RTN","MDKRPC1",34,0)
 S:'$D(RESULT) RESULT(0)="-1^No results returned"
"RTN","MDKRPC1",35,0)
 Q
"RTN","MDKRPC1",36,0)
DEMO ; demographic
"RTN","MDKRPC1",37,0)
 N DFN,MDKNODE0,MDKSSN
"RTN","MDKRPC1",38,0)
 S DFN=$G(DATA)
"RTN","MDKRPC1",39,0)
 I '$G(DFN) D  Q
"RTN","MDKRPC1",40,0)
 .S RESULT(0)="-1^DFN is not defined"
"RTN","MDKRPC1",41,0)
 .Q
"RTN","MDKRPC1",42,0)
 I '$D(^DPT(DFN,0)) D  Q
"RTN","MDKRPC1",43,0)
 .S RESULT(0)="-1^Patient not found"
"RTN","MDKRPC1",44,0)
 .Q
"RTN","MDKRPC1",45,0)
 S MDKNODE0=$G(^DPT(DFN,0))
"RTN","MDKRPC1",46,0)
 S RESULT(1)=$P(MDKNODE0,U,1) ;name
"RTN","MDKRPC1",47,0)
 S RESULT(2)=$P(MDKNODE0,U,9) ;ssn
"RTN","MDKRPC1",48,0)
 S RESULT(3)=$P(MDKNODE0,U,3) ;date of birth
"RTN","MDKRPC1",49,0)
 S RESULT(0)=3
"RTN","MDKRPC1",50,0)
 Q
"RTN","MDKRPC1",51,0)
ALLERGY ; get allergy data
"RTN","MDKRPC1",52,0)
 ; DATA = DFN
"RTN","MDKRPC1",53,0)
 S DFN=$G(DATA)
"RTN","MDKRPC1",54,0)
 N GMRAL
"RTN","MDKRPC1",55,0)
 N MDKCNT,MDLOOP
"RTN","MDKRPC1",56,0)
 S (MDKCNT,MDKLOOP)=0
"RTN","MDKRPC1",57,0)
 D EN1^GMRADPT
"RTN","MDKRPC1",58,0)
 I $O(GMRAL(0))'>0 D  Q
"RTN","MDKRPC1",59,0)
 .S:$G(GMRAL)="" RESULT(1)="No Allergy Assessment"
"RTN","MDKRPC1",60,0)
 .S:$G(GMRAL)=0 RESULT(1)="No Known Allergies"
"RTN","MDKRPC1",61,0)
 .S RESULT(0)=1
"RTN","MDKRPC1",62,0)
 .Q
"RTN","MDKRPC1",63,0)
 I $O(GMRAL(0))>0 D
"RTN","MDKRPC1",64,0)
 .F  S MDKLOOP=$O(GMRAL(MDKLOOP)) Q:MDKLOOP'>0  D
"RTN","MDKRPC1",65,0)
 ..S MDKCNT=MDKCNT+1
"RTN","MDKRPC1",66,0)
 ..S RESULT(MDKCNT)=$P($G(GMRAL(MDKLOOP)),U,2)
"RTN","MDKRPC1",67,0)
 ..Q
"RTN","MDKRPC1",68,0)
 .S RESULT(0)=MDKCNT
"RTN","MDKRPC1",69,0)
 .Q
"RTN","MDKRPC1",70,0)
 Q
"RTN","MDKRPC1",71,0)
SHOTS ; get latest vaccination data
"RTN","MDKRPC1",72,0)
 ;
"RTN","MDKRPC1",73,0)
 ; KAM/BP MD*1*47 Added code to handle Immun (9999999.14) File
"RTN","MDKRPC1",74,0)
 ; Standardization by the VIMM group in patch PX*1*201
"RTN","MDKRPC1",75,0)
 ; Original Code left in for backward compatibility
"RTN","MDKRPC1",76,0)
 ;
"RTN","MDKRPC1",77,0)
 N MDKCNT,MDKDATE,MDKIEN,MDKIMMUM,MDKNAME,MDKNODE,MDKGRPNAME
"RTN","MDKRPC1",78,0)
 S DFN=$G(DATA)
"RTN","MDKRPC1",79,0)
 S (MDKCNT,RESULT(0))=0
"RTN","MDKRPC1",80,0)
 S MDKIMMUM("HEP A")="HEPATITIS A"
"RTN","MDKRPC1",81,0)
 S MDKIMMUM("HEP B")="HEPATITIS B"
"RTN","MDKRPC1",82,0)
 S MDKIMMUM("INFLUENZA")="FLU"
"RTN","MDKRPC1",83,0)
 S MDKIMMUM("PNEUMO-VAC")="PNEUMOCOCCAL"
"RTN","MDKRPC1",84,0)
 ;S MDKIMMUM("PNEUMOCOCCAL")="PNEUMONIA"
"RTN","MDKRPC1",85,0)
 S MDKIMMUM("PPD")="PPD"
"RTN","MDKRPC1",86,0)
 D IMMUN^PXRHS03(DFN)
"RTN","MDKRPC1",87,0)
 F MDKNAME="HEP A","HEP B","INFLUENZA","PNEUMO-VAC" D
"RTN","MDKRPC1",88,0)
 .Q:'$D(^TMP("PXI",$J,MDKNAME))
"RTN","MDKRPC1",89,0)
 .S MDKDATE=0
"RTN","MDKRPC1",90,0)
 .F  S MDKDATE=$O(^TMP("PXI",$J,MDKNAME,MDKDATE)) Q:'MDKDATE  D
"RTN","MDKRPC1",91,0)
 ..S MDKIEN=0
"RTN","MDKRPC1",92,0)
 ..F  S MDKIEN=$O(^TMP("PXI",$J,MDKNAME,MDKDATE,MDKIEN)) Q:'MDKIEN  D
"RTN","MDKRPC1",93,0)
 ...S MDKNODE=$G(^TMP("PXI",$J,MDKNAME,MDKDATE,MDKIEN,0))
"RTN","MDKRPC1",94,0)
 ...Q:MDKNODE=""
"RTN","MDKRPC1",95,0)
 ...;
"RTN","MDKRPC1",96,0)
 ...; 08/12/2016 KAM/BP CA/SDM - I9088043FY16/MD*1*47
"RTN","MDKRPC1",97,0)
 ...; Check to see if there is a Group Name in the Immun Rec
"RTN","MDKRPC1",98,0)
 ...; If so do not add this record to the RESULT array
"RTN","MDKRPC1",99,0)
 ...; It will be included later with the Group data
"RTN","MDKRPC1",100,0)
 ...;
"RTN","MDKRPC1",101,0)
 ... N MDKIIEN
"RTN","MDKRPC1",102,0)
 ... S MDKIIEN=$P(^AUPNVIMM(MDKIEN,0),"^")
"RTN","MDKRPC1",103,0)
 ... Q:$D(^AUTTIMM(MDKIIEN,7,1,0))
"RTN","MDKRPC1",104,0)
 ... ;
"RTN","MDKRPC1",105,0)
 ...S MDKCNT=MDKCNT+1
"RTN","MDKRPC1",106,0)
 ...;RESULT(N)=shot name^date^reaction^contraindicated
"RTN","MDKRPC1",107,0)
 ...S RESULT(MDKCNT)=MDKIMMUM(MDKNAME)_U_$P(MDKNODE,U,3)_U_$P(MDKNODE,U,6)_U_$P(MDKNODE,U,7)
"RTN","MDKRPC1",108,0)
 ...Q
"RTN","MDKRPC1",109,0)
 ..Q
"RTN","MDKRPC1",110,0)
 .Q
"RTN","MDKRPC1",111,0)
 ;
"RTN","MDKRPC1",112,0)
 ; 08/12/2016 KAM/BP CA/SDM - I9088043FY16/MD*1*47
"RTN","MDKRPC1",113,0)
 ; Get vaccination data using the Group Field
"RTN","MDKRPC1",114,0)
 ;
"RTN","MDKRPC1",115,0)
 S MDKIMMUM("HepA")="HEPATITIS A"
"RTN","MDKRPC1",116,0)
 S MDKIMMUM("HepB")="HEPATITIS B"
"RTN","MDKRPC1",117,0)
 S MDKIMMUM("FLU")="FLU"
"RTN","MDKRPC1",118,0)
 S MDKIMMUM("PneumoPPV")="PNEUMOCOCCAL"
"RTN","MDKRPC1",119,0)
 S MDKIMMUM("PneumoPCV")="PNEUMOCOCCAL"
"RTN","MDKRPC1",120,0)
 S MDKIMMUM("PPD")="PPD"
"RTN","MDKRPC1",121,0)
 F MDKGRPNAME="HepA","HepB","FLU","PneumoPPV","PneumoPCV" D
"RTN","MDKRPC1",122,0)
 .K ^TMP("PXI",$J)
"RTN","MDKRPC1",123,0)
 .D IMMUN^PXRHS03(DFN,"A","G:"_MDKGRPNAME)
"RTN","MDKRPC1",124,0)
 .Q:'$D(^TMP("PXI",$J))
"RTN","MDKRPC1",125,0)
 .S MDKNAME=""
"RTN","MDKRPC1",126,0)
 .F  S MDKNAME=$O(^TMP("PXI",$J,MDKNAME)) Q:MDKNAME=""  D
"RTN","MDKRPC1",127,0)
 ..S MDKDATE=0
"RTN","MDKRPC1",128,0)
 ..F  S MDKDATE=$O(^TMP("PXI",$J,MDKNAME,MDKDATE)) Q:'MDKDATE  D
"RTN","MDKRPC1",129,0)
 ...S MDKIEN=0
"RTN","MDKRPC1",130,0)
 ...F  S MDKIEN=$O(^TMP("PXI",$J,MDKNAME,MDKDATE,MDKIEN)) Q:'MDKIEN  D
"RTN","MDKRPC1",131,0)
 ....S MDKNODE=$G(^TMP("PXI",$J,MDKNAME,MDKDATE,MDKIEN,0))
"RTN","MDKRPC1",132,0)
 ....Q:MDKNODE=""
"RTN","MDKRPC1",133,0)
 ....S MDKCNT=MDKCNT+1
"RTN","MDKRPC1",134,0)
 ....;RESULT(N)=shot name^date^reaction^contraindicated
"RTN","MDKRPC1",135,0)
 ....S RESULT(MDKCNT)=MDKIMMUM(MDKGRPNAME)_U_$P(MDKNODE,U,3)_U_$P(MDKNODE,U,6)_U_$P(MDKNODE,U,7)
"RTN","MDKRPC1",136,0)
 ;End of changes for CA/SDM - I9088043FY16/MD*1*47
"RTN","MDKRPC1",137,0)
 ;
"RTN","MDKRPC1",138,0)
 S RESULT(0)=MDKCNT
"RTN","MDKRPC1",139,0)
 K ^TMP("PXI",$J)
"RTN","MDKRPC1",140,0)
 ; get PPD (skin) result
"RTN","MDKRPC1",141,0)
 D SKIN^PXRHS04(DFN)
"RTN","MDKRPC1",142,0)
 I $D(^TMP("PXS",$J)) D
"RTN","MDKRPC1",143,0)
 .S MDKDATE=0
"RTN","MDKRPC1",144,0)
 .F  S MDKDATE=$O(^TMP("PXS",$J,"PPD",MDKDATE)) Q:'MDKDATE  D
"RTN","MDKRPC1",145,0)
 ..S MDKIEN=0
"RTN","MDKRPC1",146,0)
 ..F  S MDKIEN=$O(^TMP("PXS",$J,"PPD",MDKDATE,MDKIEN)) Q:'MDKIEN  D
"RTN","MDKRPC1",147,0)
 ...S MDKNODE=$G(^TMP("PXS",$J,"PPD",MDKDATE,MDKIEN,0))
"RTN","MDKRPC1",148,0)
 ...Q:MDKNODE=""
"RTN","MDKRPC1",149,0)
 ...S MDKCNT=MDKCNT+1
"RTN","MDKRPC1",150,0)
 ...;RESULT(N)=skin test^date
"RTN","MDKRPC1",151,0)
 ...S RESULT(MDKCNT)=$P(MDKNODE,U,1)_U_$P(MDKNODE,U,2)
"RTN","MDKRPC1",152,0)
 ...S RESULT(0)=MDKCNT
"RTN","MDKRPC1",153,0)
 ...Q
"RTN","MDKRPC1",154,0)
 ..Q
"RTN","MDKRPC1",155,0)
 .Q
"RTN","MDKRPC1",156,0)
 K ^TMP("PXS",$J)
"RTN","MDKRPC1",157,0)
 Q
"RTN","MDKRPC1",158,0)
LAB ; get lab results
"RTN","MDKRPC1",159,0)
 ; data = dfn^start date^end date^max # of entires to return
"RTN","MDKRPC1",160,0)
 N LA7PTID,LA7SDT,LA7EDT,LA7SC,LA7SPEC
"RTN","MDKRPC1",161,0)
 N MDK64PTR,MDKARRAY,MDKCNT,MDKCODE,MDKDATE,MDKEDT,MDKFLAG,MDKLOOP,MDKMAX,MDKNLT,MDKNODE,MDKODT,MDKRSULT
"RTN","MDKRPC1",162,0)
 N MDKSC,MDKSDT,MDKSSN,MDKTEST,MDKTOT,MDKUNIT
"RTN","MDKRPC1",163,0)
 S DATA=$G(DATA)
"RTN","MDKRPC1",164,0)
 S DFN=$P(DATA,U,1)
"RTN","MDKRPC1",165,0)
 Q:'DFN
"RTN","MDKRPC1",166,0)
 S MDKSDT=$P(DATA,U,2) ;start date
"RTN","MDKRPC1",167,0)
 S MDKEDT=$P(DATA,U,3) ;end date
"RTN","MDKRPC1",168,0)
 S MDKMAX=+$P(DATA,U,4) ;# of entries per test
"RTN","MDKRPC1",169,0)
 S MDKSSN=$P($G(^DPT(DFN,0)),U,9) ;patient ssn
"RTN","MDKRPC1",170,0)
 I MDKEDT="" S MDKEDT=$$NOW^XLFDT()
"RTN","MDKRPC1",171,0)
 ;I MDKSDT="" S MDKSDT=$$FMADD^XLFDT(DT,-90) ;go back 90 days
"RTN","MDKRPC1",172,0)
 I MDKSDT="" S MDKSDT=$$FMADD^XLFDT(DT,-365) ;<-- TESTING ONLY
"RTN","MDKRPC1",173,0)
 I 'MDKMAX S MDKMAX=3
"RTN","MDKRPC1",174,0)
 ; array(nlt code)=test name
"RTN","MDKRPC1",175,0)
 S MDKSC("84520.")="BUN"
"RTN","MDKRPC1",176,0)
 S MDKSC("82565.")="CREATININE"
"RTN","MDKRPC1",177,0)
 S MDKSC("84295.")="SODIUM"
"RTN","MDKRPC1",178,0)
 S MDKSC("84140.")="POTASSIUM"
"RTN","MDKRPC1",179,0)
 S MDKSC("82435.")="CHLORIDE"
"RTN","MDKRPC1",180,0)
 S MDKSC("82830.")="CARBON DIOXIDE"
"RTN","MDKRPC1",181,0)
 S MDKSC("82310.")="CALCIUM"
"RTN","MDKRPC1",182,0)
 S MDKSC("84100.")="PHOSPHORUS"
"RTN","MDKRPC1",183,0)
 S MDKSC("82040.")="ALBUMIN"
"RTN","MDKRPC1",184,0)
 S MDKSC("84455.")="AST"
"RTN","MDKRPC1",185,0)
 S MDKSC("84465.")="ALT"
"RTN","MDKRPC1",186,0)
 S MDKSC("84075.")="ALKALINE PHOSPHATASE"
"RTN","MDKRPC1",187,0)
 S MDKSC("82250.")="BILIRUBIN"
"RTN","MDKRPC1",188,0)
 S MDKSC("83020.")="HEMOGLOBIN"
"RTN","MDKRPC1",189,0)
 S MDKSC("85055.")="HEMATOCRIT"
"RTN","MDKRPC1",190,0)
 S MDKSC("85569.")="WBC"
"RTN","MDKRPC1",191,0)
 S MDKSC("86806.")="PLATELETS"
"RTN","MDKRPC1",192,0)
 S MDKSC("83057.")="HEMOGLOBIN A1C"
"RTN","MDKRPC1",193,0)
 S MDKSC("82466.")="CHOLESTEROL"
"RTN","MDKRPC1",194,0)
 S MDKSC("84480.")="TRIGLYCERIDES"
"RTN","MDKRPC1",195,0)
 S MDKSC("82370.")="FERRITIN"
"RTN","MDKRPC1",196,0)
 S MDKSC("83540.")="IRON"
"RTN","MDKRPC1",197,0)
 S MDKSC("82060.")="TRANSFERRIN"
"RTN","MDKRPC1",198,0)
 S MDKSC("84012.")="PARATHRYROID HORMONE"
"RTN","MDKRPC1",199,0)
 S MDKSC("81512.")="ALUMINUM"
"RTN","MDKRPC1",200,0)
 S MDKSC("89068.")="HEPATITIS B SURFACE ANTIGEN"
"RTN","MDKRPC1",201,0)
 S MDKSC("89065.")="HEPATITIS B SURFACE ANTIBODY"
"RTN","MDKRPC1",202,0)
 S MDKSC("89067.")="HEPATITIS B SURFACE ANTIBODY"
"RTN","MDKRPC1",203,0)
 S MDKSC("82013.")="HEPATITIS B SURFACE ANTIBODY"
"RTN","MDKRPC1",204,0)
 S MDKSC("89095.")="HEPATITIS B SURFACE ANTIBODY"
"RTN","MDKRPC1",205,0)
 S MDKSC("89127.")="HEPATITIS B SURFACE ANTIBODY"
"RTN","MDKRPC1",206,0)
 S MDKSC("89128.")="HEPATITIS B SURFACE ANTIBODY"
"RTN","MDKRPC1",207,0)
 S MDKSC("87398.")="HEPATITIS B SURFACE ANTIBODY"
"RTN","MDKRPC1",208,0)
 S MDKSC("89699.")="HEPATITIS B SURFACE ANTIBODY"
"RTN","MDKRPC1",209,0)
 S MDKSC("89070.")="HEPATITIS C ANTIBODY"
"RTN","MDKRPC1",210,0)
 S MDKSC("87261.")="FLU"
"RTN","MDKRPC1",211,0)
 K ^TMP("HLS",$J)
"RTN","MDKRPC1",212,0)
 S LA7SDT=MDKSDT_"^RAD" ;start date
"RTN","MDKRPC1",213,0)
 S LA7EDT=MDKEDT_"^RAD" ;end date
"RTN","MDKRPC1",214,0)
 S LA7SC="CH" ;all chemistry tests
"RTN","MDKRPC1",215,0)
 S LA7SPEC="*" ;all specimens
"RTN","MDKRPC1",216,0)
 S LA7PTID=MDKSSN ;patient's ssn
"RTN","MDKRPC1",217,0)
 S MDKARRAY=$$GCPR^LA7QRY(LA7PTID,LA7SDT,LA7EDT,.LA7SC,LA7SPEC,"","","")
"RTN","MDKRPC1",218,0)
 S (MDKCNT,MDKTOT)=0
"RTN","MDKRPC1",219,0)
 F  S MDKCNT=$O(^TMP("HLS",$J,MDKCNT)) Q:'MDKCNT  D
"RTN","MDKRPC1",220,0)
 .S MDKNODE=$G(^TMP("HLS",$J,MDKCNT))
"RTN","MDKRPC1",221,0)
 .Q:$E(MDKNODE,1,3)'="OBX"
"RTN","MDKRPC1",222,0)
 .S MDKFLAG=0
"RTN","MDKRPC1",223,0)
 .S MDKTEST=$P(MDKNODE,"|",4) ;test ids
"RTN","MDKRPC1",224,0)
 .S MDKCODE=""
"RTN","MDKRPC1",225,0)
 .F  S MDKCODE=$O(MDKSC(MDKCODE)) Q:MDKCODE=""!(MDKFLAG=1)  D
"RTN","MDKRPC1",226,0)
 ..I MDKTEST[MDKCODE S MDKFLAG=1,MDKNLT=MDKCODE
"RTN","MDKRPC1",227,0)
 ..Q
"RTN","MDKRPC1",228,0)
 .Q:'MDKFLAG  ;nlt code doesn't match
"RTN","MDKRPC1",229,0)
 .S MDKDATE=$P(MDKNODE,"|",15) ;date
"RTN","MDKRPC1",230,0)
 .S MDKDATE=$P(MDKDATE,"-",1) ;strip off time zone offset
"RTN","MDKRPC1",231,0)
 .S MDKRSULT=$P(MDKNODE,"|",6) ;result
"RTN","MDKRPC1",232,0)
 .S MDKUNIT=$P(MDKNODE,"|",7) ;unit
"RTN","MDKRPC1",233,0)
 .S MDKTOT=MDKTOT+1
"RTN","MDKRPC1",234,0)
 .S RESULT(MDKTOT)=$G(MDKSC(MDKNLT))_U_MDKDATE_U_MDKRSULT_U_MDKUNIT
"RTN","MDKRPC1",235,0)
 .S RESULT(0)=$G(RESULT(0))+1
"RTN","MDKRPC1",236,0)
 .Q
"RTN","MDKRPC1",237,0)
 K ^TMP("HLS",$J)
"RTN","MDKRPC1",238,0)
 Q
"RTN","MDKRPC1",239,0)
AD ; get advance directives
"RTN","MDKRPC1",240,0)
 ; DATA = DFN
"RTN","MDKRPC1",241,0)
 S DFN=$G(DATA)
"RTN","MDKRPC1",242,0)
 N MDKLOOP
"RTN","MDKRPC1",243,0)
 K ^TMP("TIUPPCV",$J)
"RTN","MDKRPC1",244,0)
 D ENCOVER^TIUPP3(DFN)
"RTN","MDKRPC1",245,0)
 I '$D(^TMP("TIUPPCV",$J)) Q
"RTN","MDKRPC1",246,0)
 S RESULT(1)="No",RESULT(0)=1
"RTN","MDKRPC1",247,0)
 S MDKLOOP=0
"RTN","MDKRPC1",248,0)
 F  S MDKLOOP=$O(^TMP("TIUPPCV",$J,MDKLOOP)) Q:'MDKLOOP  D
"RTN","MDKRPC1",249,0)
 .I $P(^TMP("TIUPPCV",$J,MDKLOOP),U,2)'="D" Q
"RTN","MDKRPC1",250,0)
 .S RESULT(1)="Yes"
"RTN","MDKRPC1",251,0)
 .S RESULT(0)=1
"RTN","MDKRPC1",252,0)
 .Q
"RTN","MDKRPC1",253,0)
 K ^TMP("TIUPPCV",$J)
"RTN","MDKRPC1",254,0)
 Q
"RTN","MDKRPC1",255,0)
 ;
"RTN","MDKRPC1",256,0)
CW ; get clinical warnings
"RTN","MDKRPC1",257,0)
 ; DATA = DFN
"RTN","MDKRPC1",258,0)
 S DFN=$G(DATA)
"RTN","MDKRPC1",259,0)
 N MDKCNT,MDKLOOP
"RTN","MDKRPC1",260,0)
 K ^TMP("TIUPPCV",$J)
"RTN","MDKRPC1",261,0)
 D ENCOVER^TIUPP3(DFN)
"RTN","MDKRPC1",262,0)
 S RESULT(1)="None",RESULT(0)=1
"RTN","MDKRPC1",263,0)
 I '$D(^TMP("TIUPPCV",$J)) Q
"RTN","MDKRPC1",264,0)
 S (MDKCNT,MDKLOOP)=0
"RTN","MDKRPC1",265,0)
 F  S MDKLOOP=$O(^TMP("TIUPPCV",$J,MDKLOOP)) Q:'MDKLOOP  D
"RTN","MDKRPC1",266,0)
 .I $P(^TMP("TIUPPCV",$J,MDKLOOP),U,2)'="W" Q
"RTN","MDKRPC1",267,0)
 .S MDKCNT=MDKCNT+1
"RTN","MDKRPC1",268,0)
 .S RESULT(MDKCNT)=^TMP("TIUPPCV",$J,MDKLOOP)
"RTN","MDKRPC1",269,0)
 .Q
"RTN","MDKRPC1",270,0)
 S RESULT(0)=MDKCNT
"RTN","MDKRPC1",271,0)
 K ^TMP("TIUPPCV",$J)
"RTN","MDKRPC1",272,0)
 Q
"RTN","MDKRPC1",273,0)
 ;
"RTN","MDKRPC1",274,0)
GETPROV ; Get list of available providers with name starting with P1
"RTN","MDKRPC1",275,0)
 N MDDATE,MDDUP,MDRI,MDI1,MDI2,MDLAST,MDMAX,MDPREV,MDTTL
"RTN","MDKRPC1",276,0)
 S MDRI=0,MDMAX=44,(MDLAST,MDPREV)="",X1=DT,MDFROM=DATA,MDDATE=DT
"RTN","MDKRPC1",277,0)
 F  Q:MDRI'<MDMAX  S MDFROM=$O(^VA(200,"AUSER",MDFROM),1) Q:MDFROM=""  D
"RTN","MDKRPC1",278,0)
 .S MDI1=""
"RTN","MDKRPC1",279,0)
 .F  S MDI1=$O(^VA(200,"AUSER",MDFROM,MDI1),1) Q:'MDI1  D
"RTN","MDKRPC1",280,0)
 ..I MDDATE>0,$$GET^XUA4A72(MDI1,MDDATE)<1 Q    ; Check date?
"RTN","MDKRPC1",281,0)
 ..S MDRI=MDRI+1,RESULT(MDRI)=MDI1_U_$$NAMEFMT^XLFNAME(MDFROM,"F","DcMPC")
"RTN","MDKRPC1",282,0)
 I MDRI<1 S RESULT(0)="-1^No matches found." Q
"RTN","MDKRPC1",283,0)
 S RESULT(0)=MDRI
"RTN","MDKRPC1",284,0)
 Q
"RTN","MDKRPC1",285,0)
 ;
"RTN","MDKRPC1",286,0)
TIME ; Get time
"RTN","MDKRPC1",287,0)
 S RESULT(0)=$$NOW^XLFDT()
"RTN","MDKRPC1",288,0)
 Q
"RTN","MDKRPC1",289,0)
GETLD ; Get MDK Application Install Info
"RTN","MDKRPC1",290,0)
 N MDS
"RTN","MDKRPC1",291,0)
 S MDS=$$GET^XPAR("SYS","MDK APPLICATION INSTALL","DATE_TIME_OF_LAUNCH")
"RTN","MDKRPC1",292,0)
 S MDS=MDS_"^"_$$GET^XPAR("SYS","MDK APPLICATION INSTALL","USER")
"RTN","MDKRPC1",293,0)
 S MDS=MDS_"^"_$$GET^XPAR("SYS","MDK APPLICATION INSTALL","OPTION_LOADED")
"RTN","MDKRPC1",294,0)
 S MDS=MDS_"^"_$$GET^XPAR("SYS","MDK APPLICATION INSTALL","WORKSTATION")
"RTN","MDKRPC1",295,0)
 S RESULT(0)=MDS
"RTN","MDKRPC1",296,0)
 Q
"RTN","MDKRPC1",297,0)
SETLD ; Set MDK Application Install Info
"RTN","MDKRPC1",298,0)
 D EN^XPAR("SYS","MDK APPLICATION INSTALL","DATE_TIME_OF_LAUNCH",$P(DATA,"^"))
"RTN","MDKRPC1",299,0)
 D EN^XPAR("SYS","MDK APPLICATION INSTALL","USER",$P(DATA,"^",2))
"RTN","MDKRPC1",300,0)
 D EN^XPAR("SYS","MDK APPLICATION INSTALL","OPTION_LOADED",$P(DATA,"^",3))
"RTN","MDKRPC1",301,0)
 D EN^XPAR("SYS","MDK APPLICATION INSTALL","WORKSTATION",$P(DATA,"^",4))
"RTN","MDKRPC1",302,0)
 Q
"VER")
8.0^22.0
"BLD",10321,6)
^38
**END**
**END**

