Released HBH*1*25 SEQ #23
Extracted from mail message
**KIDS**:HBH*1.0*25^

**INSTALL NAME**
HBH*1.0*25
"BLD",8840,0)
HBH*1.0*25^HOSPITAL BASED HOME CARE^0^3140513^y
"BLD",8840,1,0)
^^1^1^3120404^^
"BLD",8840,1,1,0)
Build for ICD-10 Class 1 Remediation
"BLD",8840,4,0)
^9.64PA^632^2
"BLD",8840,4,631,0)
631
"BLD",8840,4,631,2,0)
^9.641^631^1
"BLD",8840,4,631,2,631,0)
HBHC PATIENT  (File-top level)
"BLD",8840,4,631,2,631,1,0)
^9.6411^46^2
"BLD",8840,4,631,2,631,1,18,0)
PRIMARY DIAGNOSIS @ ADMISSION
"BLD",8840,4,631,2,631,1,46,0)
PRIMARY DIAGNOSIS @ DISCHARGE
"BLD",8840,4,631,222)
y^y^p^^^^n^^n
"BLD",8840,4,631,224)

"BLD",8840,4,632,0)
632
"BLD",8840,4,632,2,0)
^9.641^632.033^1
"BLD",8840,4,632,2,632.033,0)
DX  (sub-file)
"BLD",8840,4,632,2,632.033,1,0)
^9.6411^.01^1
"BLD",8840,4,632,2,632.033,1,.01,0)
DX
"BLD",8840,4,632,222)
y^y^p^^^^n^^n
"BLD",8840,4,632,224)

"BLD",8840,4,"APDD",631,631)

"BLD",8840,4,"APDD",631,631,18)

"BLD",8840,4,"APDD",631,631,46)

"BLD",8840,4,"APDD",632,632.033)

"BLD",8840,4,"APDD",632,632.033,.01)

"BLD",8840,4,"B",631,631)

"BLD",8840,4,"B",632,632)

"BLD",8840,6.3)
45
"BLD",8840,"INI")
PRE^HBHCP25
"BLD",8840,"KRN",0)
^9.67PA^779.2^20
"BLD",8840,"KRN",.4,0)
.4
"BLD",8840,"KRN",.401,0)
.401
"BLD",8840,"KRN",.402,0)
.402
"BLD",8840,"KRN",.402,"NM",0)
^9.68A^2^2
"BLD",8840,"KRN",.402,"NM",1,0)
HBHC DISCHARGE    FILE #631^631^0
"BLD",8840,"KRN",.402,"NM",2,0)
HBHC UPDATE DISCHARGE    FILE #631^631^0
"BLD",8840,"KRN",.402,"NM","B","HBHC DISCHARGE    FILE #631",1)

"BLD",8840,"KRN",.402,"NM","B","HBHC UPDATE DISCHARGE    FILE #631",2)

"BLD",8840,"KRN",.403,0)
.403
"BLD",8840,"KRN",.5,0)
.5
"BLD",8840,"KRN",.84,0)
.84
"BLD",8840,"KRN",3.6,0)
3.6
"BLD",8840,"KRN",3.8,0)
3.8
"BLD",8840,"KRN",9.2,0)
9.2
"BLD",8840,"KRN",9.8,0)
9.8
"BLD",8840,"KRN",9.8,"NM",0)
^9.68A^23^22
"BLD",8840,"KRN",9.8,"NM",1,0)
HBHCRP1B^^0^B18895349
"BLD",8840,"KRN",9.8,"NM",2,0)
HBHCRP1A^^0^B21729816
"BLD",8840,"KRN",9.8,"NM",3,0)
HBHCRP18^^0^B12246188
"BLD",8840,"KRN",9.8,"NM",4,0)
HBHCRP2^^0^B30714112
"BLD",8840,"KRN",9.8,"NM",6,0)
HBHCRP5^^0^B25295403
"BLD",8840,"KRN",9.8,"NM",7,0)
HBHCRP7^^0^B24145034
"BLD",8840,"KRN",9.8,"NM",8,0)
HBHCR19A^^0^B18946773
"BLD",8840,"KRN",9.8,"NM",9,0)
HBHCR19B^^0^B8115301
"BLD",8840,"KRN",9.8,"NM",10,0)
HBHCXMA^^0^B42800884
"BLD",8840,"KRN",9.8,"NM",11,0)
HBHCXMD^^0^B26724390
"BLD",8840,"KRN",9.8,"NM",12,0)
HBHCXMD1^^0^B17012648
"BLD",8840,"KRN",9.8,"NM",13,0)
HBHCXMV^^0^B20835749
"BLD",8840,"KRN",9.8,"NM",14,0)
HBHCUTL^^0^B31187675
"BLD",8840,"KRN",9.8,"NM",15,0)
HBHCUTL3^^0^B26981634
"BLD",8840,"KRN",9.8,"NM",16,0)
HBHCLKU1^^0^B243116135
"BLD",8840,"KRN",9.8,"NM",17,0)
HBHCLKU2^^0^B48982344
"BLD",8840,"KRN",9.8,"NM",18,0)
HBHCXMA1^^0^B13785119
"BLD",8840,"KRN",9.8,"NM",19,0)
HBHCXMV1^^0^B6370071
"BLD",8840,"KRN",9.8,"NM",20,0)
HBHCADM^^0^B27070975
"BLD",8840,"KRN",9.8,"NM",21,0)
HBHCP25^^0^B328229
"BLD",8840,"KRN",9.8,"NM",22,0)
HBHCDIS^^0^B3891939
"BLD",8840,"KRN",9.8,"NM",23,0)
HBHCUPD^^0^B46222725
"BLD",8840,"KRN",9.8,"NM","B","HBHCADM",20)

"BLD",8840,"KRN",9.8,"NM","B","HBHCDIS",22)

"BLD",8840,"KRN",9.8,"NM","B","HBHCLKU1",16)

"BLD",8840,"KRN",9.8,"NM","B","HBHCLKU2",17)

"BLD",8840,"KRN",9.8,"NM","B","HBHCP25",21)

"BLD",8840,"KRN",9.8,"NM","B","HBHCR19A",8)

"BLD",8840,"KRN",9.8,"NM","B","HBHCR19B",9)

"BLD",8840,"KRN",9.8,"NM","B","HBHCRP18",3)

"BLD",8840,"KRN",9.8,"NM","B","HBHCRP1A",2)

"BLD",8840,"KRN",9.8,"NM","B","HBHCRP1B",1)

"BLD",8840,"KRN",9.8,"NM","B","HBHCRP2",4)

"BLD",8840,"KRN",9.8,"NM","B","HBHCRP5",6)

"BLD",8840,"KRN",9.8,"NM","B","HBHCRP7",7)

"BLD",8840,"KRN",9.8,"NM","B","HBHCUPD",23)

"BLD",8840,"KRN",9.8,"NM","B","HBHCUTL",14)

"BLD",8840,"KRN",9.8,"NM","B","HBHCUTL3",15)

"BLD",8840,"KRN",9.8,"NM","B","HBHCXMA",10)

"BLD",8840,"KRN",9.8,"NM","B","HBHCXMA1",18)

"BLD",8840,"KRN",9.8,"NM","B","HBHCXMD",11)

"BLD",8840,"KRN",9.8,"NM","B","HBHCXMD1",12)

"BLD",8840,"KRN",9.8,"NM","B","HBHCXMV",13)

"BLD",8840,"KRN",9.8,"NM","B","HBHCXMV1",19)

"BLD",8840,"KRN",19,0)
19
"BLD",8840,"KRN",19,"NM",0)
^9.68A^6^6
"BLD",8840,"KRN",19,"NM",1,0)
HBHC CENSUS REPORTS MENU^^3
"BLD",8840,"KRN",19,"NM",2,0)
HBHC REPORTS MENU^^3
"BLD",8840,"KRN",19,"NM",3,0)
HBHCR19A^^0
"BLD",8840,"KRN",19,"NM",4,0)
HBHCRP1^^0
"BLD",8840,"KRN",19,"NM",5,0)
HBHCRP18^^0
"BLD",8840,"KRN",19,"NM",6,0)
HBHCRP7^^0
"BLD",8840,"KRN",19,"NM","B","HBHC CENSUS REPORTS MENU",1)

"BLD",8840,"KRN",19,"NM","B","HBHC REPORTS MENU",2)

"BLD",8840,"KRN",19,"NM","B","HBHCR19A",3)

"BLD",8840,"KRN",19,"NM","B","HBHCRP1",4)

"BLD",8840,"KRN",19,"NM","B","HBHCRP18",5)

"BLD",8840,"KRN",19,"NM","B","HBHCRP7",6)

"BLD",8840,"KRN",19.1,0)
19.1
"BLD",8840,"KRN",101,0)
101
"BLD",8840,"KRN",409.61,0)
409.61
"BLD",8840,"KRN",771,0)
771
"BLD",8840,"KRN",779.2,0)
779.2
"BLD",8840,"KRN",870,0)
870
"BLD",8840,"KRN",8989.51,0)
8989.51
"BLD",8840,"KRN",8989.52,0)
8989.52
"BLD",8840,"KRN",8994,0)
8994
"BLD",8840,"KRN","B",.4,.4)

"BLD",8840,"KRN","B",.401,.401)

"BLD",8840,"KRN","B",.402,.402)

"BLD",8840,"KRN","B",.403,.403)

"BLD",8840,"KRN","B",.5,.5)

"BLD",8840,"KRN","B",.84,.84)

"BLD",8840,"KRN","B",3.6,3.6)

"BLD",8840,"KRN","B",3.8,3.8)

"BLD",8840,"KRN","B",9.2,9.2)

"BLD",8840,"KRN","B",9.8,9.8)

"BLD",8840,"KRN","B",19,19)

"BLD",8840,"KRN","B",19.1,19.1)

"BLD",8840,"KRN","B",101,101)

"BLD",8840,"KRN","B",409.61,409.61)

"BLD",8840,"KRN","B",771,771)

"BLD",8840,"KRN","B",779.2,779.2)

"BLD",8840,"KRN","B",870,870)

"BLD",8840,"KRN","B",8989.51,8989.51)

"BLD",8840,"KRN","B",8989.52,8989.52)

"BLD",8840,"KRN","B",8994,8994)

"BLD",8840,"QDEF")
^^^^NO^^^^YES^^YES
"BLD",8840,"QUES",0)
^9.62^^
"BLD",8840,"REQB",0)
^9.611^4^3
"BLD",8840,"REQB",1,0)
ICD*18.0*57^1
"BLD",8840,"REQB",2,0)
LEX*2.0*80^1
"BLD",8840,"REQB",4,0)
HBH*1.0*24^1
"BLD",8840,"REQB","B","HBH*1.0*24",4)

"BLD",8840,"REQB","B","ICD*18.0*57",1)

"BLD",8840,"REQB","B","LEX*2.0*80",2)

"FIA",631)
HBHC PATIENT
"FIA",631,0)
^HBHC(631,
"FIA",631,0,0)
631IP
"FIA",631,0,1)
y^y^p^^^^n^^n
"FIA",631,0,10)

"FIA",631,0,11)

"FIA",631,0,"RLRO")

"FIA",631,0,"VR")
1.0^HBH
"FIA",631,631)
1
"FIA",631,631,18)

"FIA",631,631,46)

"FIA",632)
HBHC VISIT
"FIA",632,0)
^HBHC(632,
"FIA",632,0,0)
632IP
"FIA",632,0,1)
y^y^p^^^^n^^n
"FIA",632,0,10)

"FIA",632,0,11)

"FIA",632,0,"RLRO")

"FIA",632,0,"VR")
1.0^HBH
"FIA",632,632)
1
"FIA",632,632,33)

"FIA",632,632.033)
1
"FIA",632,632.033,.01)

"INI")
PRE^HBHCP25
"KRN",.402,1341,-1)
0^1
"KRN",.402,1341,0)
HBHC DISCHARGE^3140509.1034^^631^^^3140509^
"KRN",.402,1341,"DIAB",1,0,631,2)
40//ELIGIBILITY @ EVALUATION
"KRN",.402,1341,"DIAB",1,0,631,3)
41//MARITAL STATUS @ EVALUATION
"KRN",.402,1341,"DIAB",1,0,631,4)
42//LIVING ARRANGEMENTS @ EVAL
"KRN",.402,1341,"DIAB",1,0,631,6)
70//SECONDARY DIAGNOSES @ ADM
"KRN",.402,1341,"DIAB",1,0,631,7)
48//HEARING @ ADMISSION
"KRN",.402,1341,"DIAB",1,0,631,8)
49//EXPRESSIVE COMMUNICATION @ ADM
"KRN",.402,1341,"DIAB",1,0,631,9)
51//BATHING @ ADMISSION
"KRN",.402,1341,"DIAB",1,0,631,10)
52//DRESSING @ ADMISSION
"KRN",.402,1341,"DIAB",1,0,631,11)
53//TOILET USAGE @ ADMISSION
"KRN",.402,1341,"DIAB",1,0,631,12)
54//TRANSFERRING @ ADMISSION
"KRN",.402,1341,"DIAB",1,0,631,13)
55//EATING @ ADMISSION
"KRN",.402,1341,"DIAB",1,0,631,14)
56//WALKING @ ADMISSION
"KRN",.402,1341,"DIAB",1,0,631,15)
57//BOWEL CONTINENCE @ ADMISSION
"KRN",.402,1341,"DIAB",1,0,631,16)
58//BLADDER CONTINENCE @ ADMISSION
"KRN",.402,1341,"DIAB",1,0,631,17)
59//MOBILITY @ ADMISSION
"KRN",.402,1341,"DIAB",1,0,631,18)
60//ADAPTIVE TASKS @ ADMISSION
"KRN",.402,1341,"DIAB",1,0,631,19)
61//BEHAVIOR PROBLEMS @ ADMISSION
"KRN",.402,1341,"DIAB",1,0,631,20)
62//DISORIENTATION @ ADMISSION
"KRN",.402,1341,"DIAB",1,0,631,21)
63//MOOD DISTURBANCE @ ADMISSION
"KRN",.402,1341,"DIAB",1,0,631,22)
64//CAREGIVER LIMITATIONS @ ADM
"KRN",.402,1341,"DIAB",3,0,631,6)
47//VISION @ ADMISSION
"KRN",.402,1341,"DIAB",3,0,631,8)
50//RECEPTIVE COMMUNICATION @ ADM
"KRN",.402,1341,"DR",1,631)
K HBHCQ,HBHCQ1;S DIE("NO^")="OUTOK";39;S HBHCDSDT=X;I HBHCDSDT="" S $P(^HBHC(631,DA,1),U,18)="" K ^HBHC(631,"AF","N",DA) I HBHCXMT5]"" K ^HBHC(631,"AF",HBHCXMT5,DA);
"KRN",.402,1341,"DR",1,631,1)
S:HBHCDSDT]"" $P(^HBHC(631,DA,1),U,18)="N",^HBHC(631,"AF","N",DA)="";K HBHCDSDT;D DCDXVLD^HBHCLKU1(DA);Q;
"KRN",.402,1341,"DR",1,631,2)
40//^S X(2)=$C(59)_$P($G(^DD(631,5,0)),U,3),X(1)=$S($D(^HBHC(631,D0,0)):^(0),1:"") S X=$P($P(X(2),$C(59)_$P(X(1),U,6)_":",2),$C(59));Q;
"KRN",.402,1341,"DR",1,631,3)
41//^S X(2)=$C(59)_$P($G(^DD(631,10,0)),U,3),X(1)=$S($D(^HBHC(631,D0,0)):^(0),1:"") S X=$P($P(X(2),$C(59)_$P(X(1),U,11)_":",2),$C(59));Q;
"KRN",.402,1341,"DR",1,631,4)
42//^S X(2)=$C(59)_$P($G(^DD(631,11,0)),U,3),X(1)=$S($D(^HBHC(631,D0,0)):^(0),1:"") S X=$P($P(X(2),$C(59)_$P(X(1),U,12)_":",2),$C(59));43;D STATUS^HBHCUTL;44;45;I $D(HBHCQ1) K HBHCQ1 S Y="@1";69;I $D(HBHCQ) K HBHCQ S Y=65;@1;
"KRN",.402,1341,"DR",1,631,5)
46////^S X=$$DFLTDCDX^HBHCLKU1(DA);S ICDVDT=$P($G(^HBHC(631,DA,0)),U,40),ICDSYS=+$$SINFO^ICDEX("DIAG",ICDVDT);I ICDSYS=1 S ICDFMT=1,Y="@2";D DCDX^HBHCLKU1(DA) S Y="@3";@2;46;K ICDVDT,ICDSYS,ICDFMT;@3;K ICDVDT,ICDSYS,ICDFMT;Q;
"KRN",.402,1341,"DR",1,631,6)
70//^S X(1)=$S($D(^HBHC(631,D0,1)):^(1),1:"") S X=$P(X(1),U,14);Q;47//^S X(2)=$C(59)_$P($G(^DD(631,19,0)),U,3),X(1)=$S($D(^HBHC(631,D0,0)):^(0),1:"") S X=$P($P(X(2),$C(59)_$P(X(1),U,20)_":",2),$C(59));Q;
"KRN",.402,1341,"DR",1,631,7)
48//^S X(2)=$C(59)_$P($G(^DD(631,20,0)),U,3),X(1)=$S($D(^HBHC(631,D0,0)):^(0),1:"") S X=$P($P(X(2),$C(59)_$P(X(1),U,21)_":",2),$C(59));Q;
"KRN",.402,1341,"DR",1,631,8)
49//^N DIERR S X(1)=$S($D(^HBHC(631,D0,0)):^(0),1:"") S X=$$EXTERNAL^DIDU(631,21,"",$P(X(1),U,22));Q;50//^N DIERR S X(1)=$S($D(^HBHC(631,D0,0)):^(0),1:"") S X=$$EXTERNAL^DIDU(631,22,"",$P(X(1),U,23));Q;
"KRN",.402,1341,"DR",1,631,9)
51//^S X(2)=$C(59)_$P($G(^DD(631,23,0)),U,3),X(1)=$S($D(^HBHC(631,D0,0)):^(0),1:"") S X=$P($P(X(2),$C(59)_$P(X(1),U,24)_":",2),$C(59));Q;
"KRN",.402,1341,"DR",1,631,10)
52//^S X(2)=$C(59)_$P($G(^DD(631,24,0)),U,3),X(1)=$S($D(^HBHC(631,D0,0)):^(0),1:"") S X=$P($P(X(2),$C(59)_$P(X(1),U,25)_":",2),$C(59));Q;
"KRN",.402,1341,"DR",1,631,11)
53//^S X(2)=$C(59)_$P($G(^DD(631,25,0)),U,3),X(1)=$S($D(^HBHC(631,D0,0)):^(0),1:"") S X=$P($P(X(2),$C(59)_$P(X(1),U,26)_":",2),$C(59));Q;
"KRN",.402,1341,"DR",1,631,12)
54//^S X(2)=$C(59)_$P($G(^DD(631,26,0)),U,3),X(1)=$S($D(^HBHC(631,D0,0)):^(0),1:"") S X=$P($P(X(2),$C(59)_$P(X(1),U,27)_":",2),$C(59));Q;
"KRN",.402,1341,"DR",1,631,13)
55//^S X(2)=$C(59)_$P($G(^DD(631,27,0)),U,3),X(1)=$S($D(^HBHC(631,D0,0)):^(0),1:"") S X=$P($P(X(2),$C(59)_$P(X(1),U,28)_":",2),$C(59));Q;
"KRN",.402,1341,"DR",1,631,14)
56//^S X(2)=$C(59)_$P($G(^DD(631,28,0)),U,3),X(1)=$S($D(^HBHC(631,D0,0)):^(0),1:"") S X=$P($P(X(2),$C(59)_$P(X(1),U,29)_":",2),$C(59));Q;
"KRN",.402,1341,"DR",1,631,15)
57//^S X(2)=$C(59)_$P($G(^DD(631,29,0)),U,3),X(1)=$S($D(^HBHC(631,D0,0)):^(0),1:"") S X=$P($P(X(2),$C(59)_$P(X(1),U,30)_":",2),$C(59));Q;
"KRN",.402,1341,"DR",1,631,16)
58//^S X(2)=$C(59)_$P($G(^DD(631,30,0)),U,3),X(1)=$S($D(^HBHC(631,D0,0)):^(0),1:"") S X=$P($P(X(2),$C(59)_$P(X(1),U,31)_":",2),$C(59));Q;
"KRN",.402,1341,"DR",1,631,17)
59//^S X(2)=$C(59)_$P($G(^DD(631,31,0)),U,3),X(1)=$S($D(^HBHC(631,D0,0)):^(0),1:"") S X=$P($P(X(2),$C(59)_$P(X(1),U,32)_":",2),$C(59));Q;
"KRN",.402,1341,"DR",1,631,18)
60//^S X(2)=$C(59)_$P($G(^DD(631,32,0)),U,3),X(1)=$S($D(^HBHC(631,D0,0)):^(0),1:"") S X=$P($P(X(2),$C(59)_$P(X(1),U,33)_":",2),$C(59));Q;
"KRN",.402,1341,"DR",1,631,19)
61//^S X(2)=$C(59)_$P($G(^DD(631,33,0)),U,3),X(1)=$S($D(^HBHC(631,D0,0)):^(0),1:"") S X=$P($P(X(2),$C(59)_$P(X(1),U,34)_":",2),$C(59));Q;
"KRN",.402,1341,"DR",1,631,20)
62//^S X(2)=$C(59)_$P($G(^DD(631,34,0)),U,3),X(1)=$S($D(^HBHC(631,D0,0)):^(0),1:"") S X=$P($P(X(2),$C(59)_$P(X(1),U,35)_":",2),$C(59));Q;
"KRN",.402,1341,"DR",1,631,21)
63//^S X(2)=$C(59)_$P($G(^DD(631,35,0)),U,3),X(1)=$S($D(^HBHC(631,D0,0)):^(0),1:"") S X=$P($P(X(2),$C(59)_$P(X(1),U,36)_":",2),$C(59));Q;
"KRN",.402,1341,"DR",1,631,22)
64//^S X(2)=$C(59)_$P($G(^DD(631,36,0)),U,3),X(1)=$S($D(^HBHC(631,D0,0)):^(0),1:"") S X=$P($P(X(2),$C(59)_$P(X(1),U,37)_":",2),$C(59));65;66;
"KRN",.402,1343,-1)
0^2
"KRN",.402,1343,0)
HBHC UPDATE DISCHARGE^3140313.162^^631^^^3140512
"KRN",.402,1343,"DIAB",1,0,631,2)
48//HEARING @ ADMISSION
"KRN",.402,1343,"DIAB",1,0,631,3)
49//EXPRESSIVE COMMUNICATION @ ADM
"KRN",.402,1343,"DIAB",1,0,631,4)
51//BATHING @ ADMISSION
"KRN",.402,1343,"DIAB",1,0,631,5)
52//DRESSING @ ADMISSION
"KRN",.402,1343,"DIAB",1,0,631,6)
53//TOILET USAGE @ ADMISSION
"KRN",.402,1343,"DIAB",1,0,631,7)
54//TRANSFERRING @ ADMISSION
"KRN",.402,1343,"DIAB",1,0,631,8)
55//EATING @ ADMISSION
"KRN",.402,1343,"DIAB",1,0,631,9)
56//WALKING @ ADMISSION
"KRN",.402,1343,"DIAB",1,0,631,10)
57//BOWEL CONTINENCE @ ADMISSION
"KRN",.402,1343,"DIAB",1,0,631,11)
58//BLADDER CONTINENCE @ ADMISSION
"KRN",.402,1343,"DIAB",1,0,631,12)
59//MOBILITY @ ADMISSION
"KRN",.402,1343,"DIAB",1,0,631,13)
60//ADAPTIVE TASKS @ ADMISSION
"KRN",.402,1343,"DIAB",1,0,631,14)
61//BEHAVIOR PROBLEMS @ ADMISSION
"KRN",.402,1343,"DIAB",1,0,631,15)
62//DISORIENTATION @ ADMISSION
"KRN",.402,1343,"DIAB",1,0,631,16)
63//MOOD DISTURBANCE @ ADMISSION
"KRN",.402,1343,"DIAB",1,0,631,17)
64//CAREGIVER LIMITATIONS @ ADM
"KRN",.402,1343,"DIAB",3,0,631,3)
50//RECEPTIVE COMMUNICATION @ ADM
"KRN",.402,1343,"DIAB",6,0,631,1)
47//VISION @ ADMISSION
"KRN",.402,1343,"DR",1,631)
S X=$P(^HBHC(631,HBHCDFN,0),U,44);D STATUS^HBHCUTL;44;45;@1;46////^S X=$$DFLTDCDX^HBHCLKU1(DA);S ICDVDT=$P($G(^HBHC(631,DA,0)),U,40),ICDSYS=+$$SINFO^ICDEX("DIAG",ICDVDT);I ICDSYS=1 S ICDFMT=1,Y="@2";D DCDX^HBHCLKU1(DA) S Y="@3";@2;
"KRN",.402,1343,"DR",1,631,1)
46;K ICDVDT,ICDSYS,ICDFMT;@3;K ICDVDT,ICDSYS,ICDFMT;Q;47//^S X(2)=$C(59)_$P($G(^DD(631,19,0)),U,3),X(1)=$S($D(^HBHC(631,D0,0)):^(0),1:"") S X=$P($P(X(2),$C(59)_$P(X(1),U,20)_":",2),$C(59));Q;
"KRN",.402,1343,"DR",1,631,2)
48//^S X(2)=$C(59)_$P($G(^DD(631,20,0)),U,3),X(1)=$S($D(^HBHC(631,D0,0)):^(0),1:"") S X=$P($P(X(2),$C(59)_$P(X(1),U,21)_":",2),$C(59));Q;
"KRN",.402,1343,"DR",1,631,3)
49//^N DIERR S X(1)=$S($D(^HBHC(631,D0,0)):^(0),1:"") S X=$$EXTERNAL^DIDU(631,21,"",$P(X(1),U,22));Q;50//^N DIERR S X(1)=$S($D(^HBHC(631,D0,0)):^(0),1:"") S X=$$EXTERNAL^DIDU(631,22,"",$P(X(1),U,23));Q;
"KRN",.402,1343,"DR",1,631,4)
51//^S X(2)=$C(59)_$P($G(^DD(631,23,0)),U,3),X(1)=$S($D(^HBHC(631,D0,0)):^(0),1:"") S X=$P($P(X(2),$C(59)_$P(X(1),U,24)_":",2),$C(59));Q;
"KRN",.402,1343,"DR",1,631,5)
52//^S X(2)=$C(59)_$P($G(^DD(631,24,0)),U,3),X(1)=$S($D(^HBHC(631,D0,0)):^(0),1:"") S X=$P($P(X(2),$C(59)_$P(X(1),U,25)_":",2),$C(59));Q;
"KRN",.402,1343,"DR",1,631,6)
53//^S X(2)=$C(59)_$P($G(^DD(631,25,0)),U,3),X(1)=$S($D(^HBHC(631,D0,0)):^(0),1:"") S X=$P($P(X(2),$C(59)_$P(X(1),U,26)_":",2),$C(59));Q;
"KRN",.402,1343,"DR",1,631,7)
54//^S X(2)=$C(59)_$P($G(^DD(631,26,0)),U,3),X(1)=$S($D(^HBHC(631,D0,0)):^(0),1:"") S X=$P($P(X(2),$C(59)_$P(X(1),U,27)_":",2),$C(59));Q;
"KRN",.402,1343,"DR",1,631,8)
55//^S X(2)=$C(59)_$P($G(^DD(631,27,0)),U,3),X(1)=$S($D(^HBHC(631,D0,0)):^(0),1:"") S X=$P($P(X(2),$C(59)_$P(X(1),U,28)_":",2),$C(59));Q;
"KRN",.402,1343,"DR",1,631,9)
56//^S X(2)=$C(59)_$P($G(^DD(631,28,0)),U,3),X(1)=$S($D(^HBHC(631,D0,0)):^(0),1:"") S X=$P($P(X(2),$C(59)_$P(X(1),U,29)_":",2),$C(59));Q;
"KRN",.402,1343,"DR",1,631,10)
57//^S X(2)=$C(59)_$P($G(^DD(631,29,0)),U,3),X(1)=$S($D(^HBHC(631,D0,0)):^(0),1:"") S X=$P($P(X(2),$C(59)_$P(X(1),U,30)_":",2),$C(59));Q;
"KRN",.402,1343,"DR",1,631,11)
58//^S X(2)=$C(59)_$P($G(^DD(631,30,0)),U,3),X(1)=$S($D(^HBHC(631,D0,0)):^(0),1:"") S X=$P($P(X(2),$C(59)_$P(X(1),U,31)_":",2),$C(59));Q;
"KRN",.402,1343,"DR",1,631,12)
59//^S X(2)=$C(59)_$P($G(^DD(631,31,0)),U,3),X(1)=$S($D(^HBHC(631,D0,0)):^(0),1:"") S X=$P($P(X(2),$C(59)_$P(X(1),U,32)_":",2),$C(59));Q;
"KRN",.402,1343,"DR",1,631,13)
60//^S X(2)=$C(59)_$P($G(^DD(631,32,0)),U,3),X(1)=$S($D(^HBHC(631,D0,0)):^(0),1:"") S X=$P($P(X(2),$C(59)_$P(X(1),U,33)_":",2),$C(59));Q;
"KRN",.402,1343,"DR",1,631,14)
61//^S X(2)=$C(59)_$P($G(^DD(631,33,0)),U,3),X(1)=$S($D(^HBHC(631,D0,0)):^(0),1:"") S X=$P($P(X(2),$C(59)_$P(X(1),U,34)_":",2),$C(59));Q;
"KRN",.402,1343,"DR",1,631,15)
62//^S X(2)=$C(59)_$P($G(^DD(631,34,0)),U,3),X(1)=$S($D(^HBHC(631,D0,0)):^(0),1:"") S X=$P($P(X(2),$C(59)_$P(X(1),U,35)_":",2),$C(59));Q;
"KRN",.402,1343,"DR",1,631,16)
63//^S X(2)=$C(59)_$P($G(^DD(631,35,0)),U,3),X(1)=$S($D(^HBHC(631,D0,0)):^(0),1:"") S X=$P($P(X(2),$C(59)_$P(X(1),U,36)_":",2),$C(59));Q;
"KRN",.402,1343,"DR",1,631,17)
64//^S X(2)=$C(59)_$P($G(^DD(631,36,0)),U,3),X(1)=$S($D(^HBHC(631,D0,0)):^(0),1:"") S X=$P($P(X(2),$C(59)_$P(X(1),U,37)_":",2),$C(59));
"KRN",19,7132,-1)
0^6
"KRN",19,7132,0)
HBHCRP7^Admissions/Discharges by Date Range Report  (132)^^R^^^^^^^^
"KRN",19,7132,1,0)
^^5^5^3120302^
"KRN",19,7132,1,1,0)
This option prints the HBPC Admissions or Discharges by Date Range Report.
"KRN",19,7132,1,2,0)
The  report is sorted Alphabetically by Patient or by Admission/Discharge
"KRN",19,7132,1,3,0)
Date and  includes:  Admission/Discharge Date, Patient Name, Last Four,
"KRN",19,7132,1,4,0)
and ICD Code and  Diagnosis Text  (Primary Diagnosis @
"KRN",19,7132,1,5,0)
Admission/Discharge), with Totals.  Report prints in 132 column format.
"KRN",19,7132,25)
HBHCRP7
"KRN",19,7132,598000)
3
"KRN",19,7132,"U")
ADMISSIONS/DISCHARGES BY DATE 
"KRN",19,7136,-1)
0^4
"KRN",19,7136,0)
HBHCRP1^Form Errors Report  (80)^^R^^^^^^^^
"KRN",19,7136,1,0)
^^6^6^3120302^
"KRN",19,7136,1,1,0)
This option prints the HBPC Form Errors Report.  The errors were found when
"KRN",19,7136,1,2,0)
the Build/Verify Transmission File [HBHCFILE] option was run.  The report
"KRN",19,7136,1,3,0)
is sorted by Form, then by Patient Name and includes: Patient File IEN
"KRN",19,7136,1,4,0)
(internal entry number), Patient Name, Last Four, and corresponding Date. 
"KRN",19,7136,1,5,0)
Visits also contain:  Clinic Name, Error, Provider, ICD Diagnosis, and CPT
"KRN",19,7136,1,6,0)
Code fields.  Report prints in 80 column format. 
"KRN",19,7136,25)
HBHCRP1A
"KRN",19,7136,99)
55493,57972
"KRN",19,7136,598000)
3
"KRN",19,7136,"U")
FORM ERRORS REPORT  (80)
"KRN",19,7148,-1)
3^2
"KRN",19,7148,0)
HBHC REPORTS MENU^Reports Menu^^M^^^^^^^^
"KRN",19,7148,1,0)
^^16^16^3120302^
"KRN",19,7148,1,1,0)
This option is the HBPC Reports Menu.  The option includes:
"KRN",19,7148,1,2,0)
 
"KRN",19,7148,1,3,0)
  Evaluation/Admission Data Report by Patient  (80) [HBHCRP2]
"KRN",19,7148,1,4,0)
  Patient Visit Data Report  (80) [HBHCRP3]
"KRN",19,7148,1,5,0)
  Discharge Data Report by Patient  (80) [HBHCRP5]
"KRN",19,7148,1,6,0)
  Episode of Care/Length of Stay Report  (80) [HBHCRP12]
"KRN",19,7148,1,7,0)
  Admissions/Discharges by Date Range Report  (132) [HBHCRP7]
"KRN",19,7148,1,8,0)
  Rejections from HBPC Program Report  (80) [HBHCRP16]
"KRN",19,7148,1,9,0)
  Visit Data by Date Range Report  (80) [HBHCRP4]
"KRN",19,7148,1,10,0)
  CPT Code Summary Report  (80) [HBHCRP17]
"KRN",19,7148,1,11,0)
  Provider CPT Code Summary Report  (80) [HBHCRP22]
"KRN",19,7148,1,12,0)
  ICD Code/Dx Text by Date Range Report  (80) [HBHCR19A]
"KRN",19,7148,1,13,0)
  Unique Patients by Date Range Summary Report  (80) [HBHCRP20]
"KRN",19,7148,1,14,0)
  Total Visits by Date Range Report  (80) [HBHCRP21]
"KRN",19,7148,1,15,0)
  Patient Days of Care by Date Range Report  (80) [HBHCRP23]
"KRN",19,7148,1,16,0)
  Census Reports Menu ... [HBHC CENSUS REPORTS MENU]
"KRN",19,7148,10,0)
^19.01IP^14^14
"KRN",19,7148,10,5,0)
7132^^5
"KRN",19,7148,10,5,"^")
HBHCRP7
"KRN",19,7148,10,10,0)
7995^^10
"KRN",19,7148,10,10,"^")
HBHCR19A
"KRN",19,7148,10,14,0)
7697^^14
"KRN",19,7148,10,14,"^")
HBHC CENSUS REPORTS MENU
"KRN",19,7148,99)
62524,35821
"KRN",19,7148,99.1)
61564,1956
"KRN",19,7148,"U")
REPORTS MENU
"KRN",19,7693,-1)
0^5
"KRN",19,7693,0)
HBHCRP18^Active Census with ICD Code/Text Report  (132)^^R^^^^^^^^
"KRN",19,7693,1,0)
^^5^5^3120302^
"KRN",19,7693,1,1,0)
This option prints the HBPC Active Census with ICD Codes/Text Report.
"KRN",19,7693,1,2,0)
The user is prompted to enter the date range for inclusion on the
"KRN",19,7693,1,3,0)
report.  The report is sorted by patient name, then by admission date,
"KRN",19,7693,1,4,0)
and includes:  Patient Name, Last Four, Admission Date, ICD Code, and
"KRN",19,7693,1,5,0)
ICD Text.  Report prints in 132 column format.
"KRN",19,7693,25)
HBHCRP18
"KRN",19,7693,598000)
2
"KRN",19,7693,"U")
ACTIVE CENSUS WITH ICD CODE/TE
"KRN",19,7697,-1)
3^1
"KRN",19,7697,0)
HBHC CENSUS REPORTS MENU^Census Reports Menu^^M^^^^^^^^HOSPITAL BASED HOME CARE
"KRN",19,7697,1,0)
^^11^11^3120302^
"KRN",19,7697,1,1,0)
This option is the HBPC Census Reports Menu.  The menu includes:
"KRN",19,7697,1,2,0)
 
"KRN",19,7697,1,3,0)
  Program Census Report  (80) [HBHCRP10]
"KRN",19,7697,1,4,0)
  Address Included Program Census  (132) [HBHCRP25]
"KRN",19,7697,1,5,0)
  Expanded Program Census Report  (80) [HBHCRP24]
"KRN",19,7697,1,6,0)
  Active Census with ICD Code/Text Report  (132) [HBHCRP18]
"KRN",19,7697,1,7,0)
  Team Census Report  (80) [HBHCRP11]
"KRN",19,7697,1,8,0)
  Case Manager Census Report  (132) [HBHCRP6]
"KRN",19,7697,1,9,0)
  Provider Census Report  (132) [HBHCRP9]
"KRN",19,7697,1,10,0)
 
"KRN",19,7697,1,11,0)
This option is accessible from the HBHC REPORTS MENU option.
"KRN",19,7697,10,0)
^19.01IP^7^7
"KRN",19,7697,10,4,0)
7693^^4
"KRN",19,7697,10,4,"^")
HBHCRP18
"KRN",19,7697,99)
62524,35853
"KRN",19,7697,"U")
CENSUS REPORTS MENU
"KRN",19,7995,-1)
0^3
"KRN",19,7995,0)
HBHCR19A^ICD Code/Dx Text by Date Range Report  (80)^^R^^^^^^^^HOSPITAL BASED HOME CARE
"KRN",19,7995,1,0)
^^10^10^3120302^
"KRN",19,7995,1,1,0)
This option prints the HBPC ICD Code/Diagnosis Text by Date Range Report.
"KRN",19,7995,1,2,0)
The user is prompted to enter the date range, and the ICD Code(s), or 
"KRN",19,7995,1,3,0)
category of codes, for inclusion on the report.  If the user responds 'yes'
"KRN",19,7995,1,4,0)
to the 'include All codes within category xxx' prompt, simply selecting ANY
"KRN",19,7995,1,5,0)
code from the category will be category inclusive.  (e.g.  selecting 250.00
"KRN",19,7995,1,6,0)
or 250.60 will produce the same report results) 
"KRN",19,7995,1,7,0)
 
"KRN",19,7995,1,8,0)
The report is sorted by ICD Code category, then alphabetically by patient
"KRN",19,7995,1,9,0)
within category, with totals for each ICD Code category plus a grand
"KRN",19,7995,1,10,0)
total.  Report prints in 80 column format. 
"KRN",19,7995,25)
HBHCR19A
"KRN",19,7995,598000)
2
"KRN",19,7995,"U")
ICD CODE/DX TEXT BY DATE RANGE
"MBREQ")
0
"ORD",7,.402)
.402;7;;;EDEOUT^DIFROMSO(.402,DA,"",XPDA);FPRE^DIFROMSI(.402,"",XPDA);EPRE^DIFROMSI(.402,DA,$E("N",$G(XPDNEW)),XPDA,"",OLDA);;EPOST^DIFROMSI(.402,DA,"",XPDA);DEL^DIFROMSK(.402,"",%)
"ORD",7,.402,0)
INPUT TEMPLATE
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"PKG",152,-1)
1^1
"PKG",152,0)
HOSPITAL BASED HOME CARE^HBH^HBH v1.0 Patch 4 w/Inits
"PKG",152,22,0)
^9.49I^1^1
"PKG",152,22,1,0)
1.0^2931101^2960926
"PKG",152,22,1,"PAH",1,0)
25^3140513
"PKG",152,22,1,"PAH",1,1,0)
^^1^1^3140513
"PKG",152,22,1,"PAH",1,1,1,0)
Build for ICD-10 Class 1 Remediation
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
22
"RTN","HBHCADM")
0^20^B27070975^B21342885
"RTN","HBHCADM",1,0)
HBHCADM ;LR VAMC(IRMS)/MJT - HBHC eval/adm data entry, obtain demographic info from ^DPT, verify patient D/C from last episode/care before creating episode, calls ACTION^HBHCUTL, BIRTHYR^HBHCUTL1, SEXRACE^HBHCUTL1, MFHS^HBHCUTL3 ;May 2000
"RTN","HBHCADM",2,0)
 ;;1.0;HOSPITAL BASED HOME CARE;**2,6,8,16,24,25**;NOV 01, 1993;Build 45
"RTN","HBHCADM",3,0)
 ;
"RTN","HBHCADM",4,0)
 ; Reference to $$SINFO^ICDEX supported by ICR #5747
"RTN","HBHCADM",5,0)
 ;******************************************************************************
"RTN","HBHCADM",6,0)
 ;******************************************************************************
"RTN","HBHCADM",7,0)
 ;                       --- ROUTINE MODIFICATION LOG ---
"RTN","HBHCADM",8,0)
 ;        
"RTN","HBHCADM",9,0)
 ;PKG/PATCH    DATE        DEVELOPER    MODIFICATION
"RTN","HBHCADM",10,0)
 ;-----------  ----------  -----------  ----------------------------------------
"RTN","HBHCADM",11,0)
 ;HBH*1.0*25   FEB  2012   K GUPTA      Support for ICD-10 Coding System
"RTN","HBHCADM",12,0)
 ;******************************************************************************
"RTN","HBHCADM",13,0)
 ;******************************************************************************
"RTN","HBHCADM",14,0)
 ;
"RTN","HBHCADM",15,0)
START ; Initialization
"RTN","HBHCADM",16,0)
 S HBHCFORM=3
"RTN","HBHCADM",17,0)
 D MFHS^HBHCUTL3
"RTN","HBHCADM",18,0)
PROMPT ; Prompt user for patient name
"RTN","HBHCADM",19,0)
 K DIC,HBHCFLG,HBHCPRCT S DIC="^HBHC(631,",DIC(0)="AELMQZ" D ^DIC
"RTN","HBHCADM",20,0)
 G:Y=-1 EXIT
"RTN","HBHCADM",21,0)
 S HBHCDFN=+Y,HBHCDPT=$P(Y,U,2),HBHCDPT0=^DPT(HBHCDPT,0),HBHCNOD0=Y(0)
"RTN","HBHCADM",22,0)
 I $P(HBHCDPT0,U,9)'?9N W !!,"Patient has 'pseudo' social security number (SSN) on file.  If patient was",!,"not chosen in error, contact MAS to correct the invalid SSN.  Patient must",!,"have a valid SSN to be selected.",! H 3 G PROMPT
"RTN","HBHCADM",23,0)
 S HBHCXMT3=$P($G(^HBHC(631,HBHCDFN,1)),U,17)
"RTN","HBHCADM",24,0)
 I $P(^HBHC(631,HBHCDFN,0),U,40)]"" W $C(7),!!!,"***  Record contains Discharge data indicating a Complete Episode of Care  ***",!! H 3
"RTN","HBHCADM",25,0)
 I (HBHCXMT3]"")&(HBHCXMT3'="N") D FORMMSG^HBHCUTL1 G:$D(HBHCNHSP) EXIT G:HBHCPRCT'=1 PROMPT
"RTN","HBHCADM",26,0)
 I $P(Y,U,3) S $P(^HBHC(631,HBHCDFN,1),U,17)="N",^HBHC(631,"AE","N",HBHCDFN)="" S HBHCBXRF="" F  S HBHCBXRF=$O(^HBHC(631,"B",HBHCDPT,HBHCBXRF)) Q:(HBHCBXRF="")!(HBHCBXRF=HBHCDFN)  D CHECK
"RTN","HBHCADM",27,0)
 G:$D(HBHCFLG) PROMPT
"RTN","HBHCADM",28,0)
 D DEMO
"RTN","HBHCADM",29,0)
 K DIE S DIE="^HBHC(631,",DA=HBHCDFN,DIE("NO^")="OUTOK"
"RTN","HBHCADM",30,0)
 ;added M code for Dx validation based on admission date
"RTN","HBHCADM",31,0)
 ;added M code for Dx lookup instead of field 18
"RTN","HBHCADM",32,0)
 I '$D(HBHCMFHS) D
"RTN","HBHCADM",33,0)
 .S DR="K HBHCQ;17;2:5;D BIRTHYR^HBHCUTL1;7;D SEXRACE^HBHCUTL1;10:13;14;D ACTION^HBHCUTL;15;16"
"RTN","HBHCADM",34,0)
 I $D(HBHCMFHS) D
"RTN","HBHCADM",35,0)
 .S DR(2,631.01)=1,DR="K HBHCQ;88;S:X'=""Y"" Y=""@1"";89;90;@1;17;2:5;D BIRTHYR^HBHCUTL1;7;D SEXRACE^HBHCUTL1;10:13;14;D ACTION^HBHCUTL;15;16"
"RTN","HBHCADM",36,0)
 L +^HBHC(631,HBHCDFN):0 I $T D ^DIE
"RTN","HBHCADM",37,0)
 I $D(Y)>0 G PROMPT
"RTN","HBHCADM",38,0)
 ; For ICD-9 lookups, set key variables used by special lookup routine
"RTN","HBHCADM",39,0)
 S ICDVDT=$P(^HBHC(631,DA,0),U,18)
"RTN","HBHCADM",40,0)
 S ICDSYS=+$$SINFO^ICDEX("DIAG",ICDVDT)
"RTN","HBHCADM",41,0)
 I ICDSYS=1 S ICDFMT=1
"RTN","HBHCADM",42,0)
 I '$D(HBHCMFHS) D
"RTN","HBHCADM",43,0)
 .S DR=$S(ICDSYS=1:"I $D(HBHCQ) K HBHCQ S Y=37;18;68;19:36;37:38;67",1:"I $D(HBHCQ) K HBHCQ S Y=37;D ADMDX^HBHCLKU1;68;19:36;37:38;67")
"RTN","HBHCADM",44,0)
 I $D(HBHCMFHS) D
"RTN","HBHCADM",45,0)
 .S DR=$S(ICDSYS=1:"I $D(HBHCQ) K HBHCQ S Y=37;18;68;19:36;37:38;67",1:"I $D(HBHCQ) K HBHCQ S Y=37;D ADMDX^HBHCLKU1;68;19:36;37:38;67")
"RTN","HBHCADM",46,0)
 D ^DIE
"RTN","HBHCADM",47,0)
 L -^HBHC(631,HBHCDFN) K ICDVDT,ICDSYS,ICDFMT G PROMPT
"RTN","HBHCADM",48,0)
 W $C(7),!!,"Another user is editing this entry.",!! G PROMPT
"RTN","HBHCADM",49,0)
EXIT ; Exit module
"RTN","HBHCADM",50,0)
 K DA,DIC,DIE,DIK,DR,HBHCAFLG,HBHCBXRF,HBHCCNTY,HBHCDFN,HBHCDPT,HBHCDPT0,HBHCEL,HBHCELGE,HBHCFLG,HBHCFORM,HBHCI,HBHCIEN,HBHCINFO,HBHCJ,HBHCMARE,HBHCMFHS,HBHCMS,HBHCNHSP,HBHCNOD0,HBHCPRCT,HBHCPS,HBHCPSRV,HBHCQ,HBHCRFLG,HBHCST
"RTN","HBHCADM",51,0)
 K HBHCXMT3,HBHCWRD1,HBHCWRD2,HBHCWRD3,HBHCY0,HBHCZIP,VAEL,X,Y
"RTN","HBHCADM",52,0)
 Q
"RTN","HBHCADM",53,0)
CHECK ; Check previous episode(s) of care for 'Reject' in Admit/Reject Action or Discharge Date to ensure completed episode of care before allowing another episode of care to be created
"RTN","HBHCADM",54,0)
 Q:($P(^HBHC(631,HBHCBXRF,0),U,15)=2)!($P(^HBHC(631,HBHCBXRF,0),U,40)]"")
"RTN","HBHCADM",55,0)
 W $C(7),!!,"Patient must be discharged from last episode of care before new episode",!,"can be entered.  Current episode not created.",! H 3
"RTN","HBHCADM",56,0)
 K DIK S DIK="^HBHC(631,",DA=HBHCDFN D ^DIK
"RTN","HBHCADM",57,0)
 S HBHCFLG=1
"RTN","HBHCADM",58,0)
 Q
"RTN","HBHCADM",59,0)
DEMO ; Obtain patient demographic info
"RTN","HBHCADM",60,0)
 S (HBHCST,HBHCCNTY,HBHCZIP,HBHCEL,HBHCELGE,HBHCPS,HBHCPSRV,HBHCMS,HBHCMARE)=""
"RTN","HBHCADM",61,0)
 I $D(^DPT(HBHCDPT,.11)) S HBHCINFO=^DPT(HBHCDPT,.11),HBHCCNTY=$P(HBHCINFO,U,7),HBHCZIP=$P(HBHCINFO,U,12),HBHCST=$P(HBHCINFO,U,5) I HBHCST]"" S HBHCIEN="" F  S HBHCIEN=$O(^HBHC(631.8,"B",HBHCST,HBHCIEN)) Q:HBHCIEN=""  S HBHCST=HBHCIEN
"RTN","HBHCADM",62,0)
 I $D(^DPT(HBHCDPT,.36)) S DFN=HBHCDPT D ELIG^VADPT S HBHCEL=+VAEL(1),HBHCELGE=$S(HBHCEL=1:"01",HBHCEL=2:"02",HBHCEL=16:"02",HBHCEL=11:"03",HBHCEL=4:"04",1:"05") K DFN
"RTN","HBHCADM",63,0)
 I $D(^DPT(HBHCDPT,.32)) S HBHCINFO=^DPT(HBHCDPT,.32),HBHCPS=$P(HBHCINFO,U,3),HBHCPSRV=$S(((HBHCPS>0)&(HBHCPS<9)):HBHCPS,HBHCPS=9:10,HBHCPS=121:11,1:"")
"RTN","HBHCADM",64,0)
 S HBHCINFO=^DPT(HBHCDPT,0),HBHCMS=$P(HBHCINFO,U,5),HBHCMARE=$S(HBHCMS=1:4,HBHCMS=2:1,HBHCMS=4:2,HBHCMS=5:3,HBHCMS=6:5,1:"")
"RTN","HBHCADM",65,0)
 I HBHCST]"" S:($P(HBHCNOD0,U,3)="")&($D(^HBHC(631.8,HBHCST,0))) $P(^HBHC(631,HBHCDFN,0),U,3)=HBHCST I (HBHCCNTY]"")&($P(HBHCNOD0,U,4)="") S:$D(^HBHC(631.8,HBHCST,0)) $P(^HBHC(631,HBHCDFN,0),U,4)=HBHCCNTY
"RTN","HBHCADM",66,0)
 S:(HBHCZIP]"")&(($P(HBHCNOD0,U,5)="")!($P(HBHCNOD0,U,5)'?9N)) $P(^HBHC(631,HBHCDFN,0),U,5)=HBHCZIP
"RTN","HBHCADM",67,0)
 S:(HBHCELGE]"")&($P(HBHCNOD0,U,6)="") $P(^HBHC(631,HBHCDFN,0),U,6)=HBHCELGE
"RTN","HBHCADM",68,0)
 S:(HBHCPSRV]"")&($P(HBHCNOD0,U,8)="") $P(^HBHC(631,HBHCDFN,0),U,8)=HBHCPSRV
"RTN","HBHCADM",69,0)
 S:(HBHCMARE]"")&($P(HBHCNOD0,U,11)="") $P(^HBHC(631,HBHCDFN,0),U,11)=HBHCMARE
"RTN","HBHCADM",70,0)
 Q
"RTN","HBHCDIS")
0^22^B3891939^B3678339
"RTN","HBHCDIS",1,0)
HBHCDIS ;LR VAMC(IRMS)/MJT - HBHC Discharge data entry, calls STATUS^HBHCUTL from [HBHC DISCHARGE] template ;3/18/14
"RTN","HBHCDIS",2,0)
 ;;1.0;HOSPITAL BASED HOME CARE;**2,25**;NOV 01, 1993;Build 45
"RTN","HBHCDIS",3,0)
 ;
"RTN","HBHCDIS",4,0)
 ; Reference to $$SINFO^ICDEX supported by ICR #5747
"RTN","HBHCDIS",5,0)
 ; $$SINFO^ICDEX is called from the [HBHC DISCHARGE] input template
"RTN","HBHCDIS",6,0)
 ;
"RTN","HBHCDIS",7,0)
START ; Initialization
"RTN","HBHCDIS",8,0)
 S HBHCFORM=5
"RTN","HBHCDIS",9,0)
PROMPT ; Prompt user for patient name
"RTN","HBHCDIS",10,0)
 K DIC,HBHCPRCT S DIC="^HBHC(631,",DIC(0)="AEMQZ" D ^DIC
"RTN","HBHCDIS",11,0)
 G:Y=-1 EXIT
"RTN","HBHCDIS",12,0)
 I $P(Y(0),U,15)'=1 W *7,!!,"Record indicates patient has not been admitted to HBHC.  Discharge not allowed",!,"without admission.",! H 3 G PROMPT
"RTN","HBHCDIS",13,0)
 S HBHCDFN=+Y,HBHCDPT=$P(Y,U,2),HBHCXMT5=$P($G(^HBHC(631,HBHCDFN,1)),U,18)
"RTN","HBHCDIS",14,0)
 I (HBHCXMT5]"")&(HBHCXMT5'="N") D FORMMSG^HBHCUTL1 G:$D(HBHCNHSP) EXIT G:HBHCPRCT'=1 PROMPT
"RTN","HBHCDIS",15,0)
 K DIE S DIE="^HBHC(631,",DA=HBHCDFN,DR="[HBHC DISCHARGE]"
"RTN","HBHCDIS",16,0)
 L +^HBHC(631,HBHCDFN):0 I $T D ^DIE L -^HBHC(631,HBHCDFN) G PROMPT
"RTN","HBHCDIS",17,0)
 W *7,!!,"Another user is editing this entry.",!! G PROMPT
"RTN","HBHCDIS",18,0)
EXIT ; Exit module
"RTN","HBHCDIS",19,0)
 K DA,DIC,DIE,DR,HBHC12,HBHC359,HBHCDFLG,HBHCDFN,HBHCDIED,HBHCDPT,HBHCFORM,HBHCI,HBHCJ,HBHCL,HBHCM,HBHCNHSP,HBHCNOD1,HBHCPRCT,HBHCQ,HBHCQ1,HBHCTFLG,HBHCXMT5,HBHCWRD1,HBHCWRD2,HBHCWRD3,HBHCY0,X,Y
"RTN","HBHCDIS",20,0)
 Q
"RTN","HBHCLKU1")
0^16^B243116135^n/a
"RTN","HBHCLKU1",1,0)
HBHCLKU1 ;ALB/KG - DIAGNOSIS VALIDATION AND LOOK UP ;5/15/12
"RTN","HBHCLKU1",2,0)
 ;;1.0;HOSPITAL BASED HOME CARE;**25**;NOV 01, 1993;Build 45
"RTN","HBHCLKU1",3,0)
 ;
"RTN","HBHCLKU1",4,0)
 ; This routine references the following supported ICRs:
"RTN","HBHCLKU1",5,0)
 ; 5747    $$CODEC^ICDEX
"RTN","HBHCLKU1",6,0)
 ; 5747    $$VSTD^ICDEX
"RTN","HBHCLKU1",7,0)
 ; 5747    $$CSI^ICDEX
"RTN","HBHCLKU1",8,0)
 ; 5747    $$SYS^ICDEX
"RTN","HBHCLKU1",9,0)
 ; 5747    $$SAI^ICDEX
"RTN","HBHCLKU1",10,0)
 ; 5681    $$DIAGSRCH^LEX10CS
"RTN","HBHCLKU1",11,0)
 ; 5679    $$FREQ^LEXU
"RTN","HBHCLKU1",12,0)
 ; 5679    $$MAX^LEXU
"RTN","HBHCLKU1",13,0)
 ; 5773    FileMan lookup for file #80
"RTN","HBHCLKU1",14,0)
 ;
"RTN","HBHCLKU1",15,0)
 ;******************************************************************************
"RTN","HBHCLKU1",16,0)
 ;******************************************************************************
"RTN","HBHCLKU1",17,0)
 ;                       --- ROUTINE MODIFICATION LOG ---
"RTN","HBHCLKU1",18,0)
 ;        
"RTN","HBHCLKU1",19,0)
 ;PKG/PATCH    DATE        DEVELOPER    MODIFICATION
"RTN","HBHCLKU1",20,0)
 ;-----------  ----------  -----------  ----------------------------------------
"RTN","HBHCLKU1",21,0)
 ;HBH*1.0*25   APR  2012   K GUPTA      Support for ICD-10 Coding System
"RTN","HBHCLKU1",22,0)
 ;******************************************************************************
"RTN","HBHCLKU1",23,0)
 ;******************************************************************************
"RTN","HBHCLKU1",24,0)
 ;
"RTN","HBHCLKU1",25,0)
 ;---------
"RTN","HBHCLKU1",26,0)
 ;Diagnosis validation based on Evaluation/Admission date
"RTN","HBHCLKU1",27,0)
 ;Called by:
"RTN","HBHCLKU1",28,0)
 ; - PROMPT^HBHCADM
"RTN","HBHCLKU1",29,0)
ADMDXVLD ;
"RTN","HBHCLKU1",30,0)
 D DXVLD(1,HBHCDFN)
"RTN","HBHCLKU1",31,0)
 Q
"RTN","HBHCLKU1",32,0)
 ;
"RTN","HBHCLKU1",33,0)
 ;---------
"RTN","HBHCLKU1",34,0)
 ;Diagnosis validation based on Discharge date
"RTN","HBHCLKU1",35,0)
 ;Called by:
"RTN","HBHCLKU1",36,0)
 ; - HBHC DISCHARGE Input Template
"RTN","HBHCLKU1",37,0)
 ; - HBHC UPDATE DISCHARGE Input Template
"RTN","HBHCLKU1",38,0)
 ;Input parameters:
"RTN","HBHCLKU1",39,0)
 ; HBHCDFN1  - ^HBHC(631 IEN
"RTN","HBHCLKU1",40,0)
DCDXVLD(HBHCDFN1) ;
"RTN","HBHCLKU1",41,0)
 D DXVLD(2,HBHCDFN1)
"RTN","HBHCLKU1",42,0)
 Q
"RTN","HBHCLKU1",43,0)
 ;
"RTN","HBHCLKU1",44,0)
 ;---------
"RTN","HBHCLKU1",45,0)
 ;Diagnosis validation based on date entry
"RTN","HBHCLKU1",46,0)
 ;Input parameters:
"RTN","HBHCLKU1",47,0)
 ; HBHCMODE - Admission or Discharge
"RTN","HBHCLKU1",48,0)
 ; HBHCDFN1  - ^HBHC(631 IEN
"RTN","HBHCLKU1",49,0)
DXVLD(HBHCMODE,HBHCDFN1) ;
"RTN","HBHCLKU1",50,0)
 N HBHCDT,HBHCCURDXIEN
"RTN","HBHCLKU1",51,0)
 ;date of interest
"RTN","HBHCLKU1",52,0)
 I HBHCMODE=1 S HBHCDT=$P($G(^HBHC(631,HBHCDFN1,0)),U,18) I 1  ;admission date
"RTN","HBHCLKU1",53,0)
 E  I HBHCMODE=2 S HBHCDT=$P($G(^HBHC(631,HBHCDFN1,0)),U,40)  ;discharge date
"RTN","HBHCLKU1",54,0)
 S HBHCCURDXIEN=$$GETDX(HBHCMODE,HBHCDFN1)
"RTN","HBHCLKU1",55,0)
 ;check if dx's coding system is still valid based on date of interest
"RTN","HBHCLKU1",56,0)
 ;if not valid then clear out old value
"RTN","HBHCLKU1",57,0)
 I HBHCCURDXIEN>0,'$$CHECKDX(HBHCCURDXIEN,HBHCDT) D SAVEDX(HBHCMODE,HBHCDFN1,"","")
"RTN","HBHCLKU1",58,0)
 Q
"RTN","HBHCLKU1",59,0)
 ;
"RTN","HBHCLKU1",60,0)
 ;Diagnosis defaulting for Discharge
"RTN","HBHCLKU1",61,0)
 ;Called by:
"RTN","HBHCLKU1",62,0)
 ; - HBHC DISCHARGE Input Template
"RTN","HBHCLKU1",63,0)
 ; - HBHC UPDATE DISCHARGE Input Template
"RTN","HBHCLKU1",64,0)
 ;Input parameters:
"RTN","HBHCLKU1",65,0)
 ; HBHCDFN1 - File #631 - patient identifier
"RTN","HBHCLKU1",66,0)
 ;Output value:
"RTN","HBHCLKU1",67,0)
 ; Admission dx if coding system matches with coding system of discharge date
"RTN","HBHCLKU1",68,0)
 ;
"RTN","HBHCLKU1",69,0)
DFLTDCDX(HBHCDFN1) ;
"RTN","HBHCLKU1",70,0)
 N HBHCDCDX,HBHCADMDX,HBHCDCDT
"RTN","HBHCLKU1",71,0)
 S HBHCDCDX=$P($G(^HBHC(631,HBHCDFN1,0)),U,47) ; PRIMARY DIAGNOSIS @ DISCHARGE
"RTN","HBHCLKU1",72,0)
 I HBHCDCDX="" D
"RTN","HBHCLKU1",73,0)
 . S HBHCADMDX=$P($G(^HBHC(631,HBHCDFN1,0)),U,19)  ;admission dx
"RTN","HBHCLKU1",74,0)
 . Q:HBHCADMDX=""
"RTN","HBHCLKU1",75,0)
 . S HBHCDCDT=$P($G(^HBHC(631,HBHCDFN1,0)),U,40)  ;discharge date
"RTN","HBHCLKU1",76,0)
 . ;default adm dx only if dx coding system matches with discharge date's coding system
"RTN","HBHCLKU1",77,0)
 . S:$$CHECKDX(HBHCADMDX,HBHCDCDT) HBHCDCDX=HBHCADMDX
"RTN","HBHCLKU1",78,0)
 Q HBHCDCDX
"RTN","HBHCLKU1",79,0)
 ;
"RTN","HBHCLKU1",80,0)
 ;Diagnosis validation based on date of interest
"RTN","HBHCLKU1",81,0)
 ;Input parameters:
"RTN","HBHCLKU1",82,0)
 ; HBHCDX - Diagnosis IEN
"RTN","HBHCLKU1",83,0)
 ; HBHCDT - Date of interest
"RTN","HBHCLKU1",84,0)
 ;Output value:
"RTN","HBHCLKU1",85,0)
 ; "1" - if coding system matches
"RTN","HBHCLKU1",86,0)
 ; ""  - error or if coding system don't match
"RTN","HBHCLKU1",87,0)
 ;
"RTN","HBHCLKU1",88,0)
CHECKDX(HBHCDX,HBHCDT) ;
"RTN","HBHCLKU1",89,0)
 N HBHCDXCS,HBHCDTCS
"RTN","HBHCLKU1",90,0)
 Q:(HBHCDX="")!(HBHCDT="") ""
"RTN","HBHCLKU1",91,0)
 S HBHCDXCS=$$CSI^ICDEX("80",HBHCDX)  ;determine coding system for dx
"RTN","HBHCLKU1",92,0)
 Q:HBHCDXCS="" ""
"RTN","HBHCLKU1",93,0)
 S HBHCDTCS=$$SYS^ICDEX("80",HBHCDT,"I")  ;determine coding system for date
"RTN","HBHCLKU1",94,0)
 Q:HBHCDTCS=-1 ""
"RTN","HBHCLKU1",95,0)
 Q:HBHCDXCS=HBHCDTCS "1"  ;if two coding system matches
"RTN","HBHCLKU1",96,0)
 Q ""
"RTN","HBHCLKU1",97,0)
 ;
"RTN","HBHCLKU1",98,0)
 ;---------
"RTN","HBHCLKU1",99,0)
 ;Diagnosis entry for Evaluation/Admission
"RTN","HBHCLKU1",100,0)
 ;Called by:
"RTN","HBHCLKU1",101,0)
 ; - PROMPT^HBHCADM
"RTN","HBHCLKU1",102,0)
ADMDX ;
"RTN","HBHCLKU1",103,0)
 D ICD(1,HBHCDFN)
"RTN","HBHCLKU1",104,0)
 Q
"RTN","HBHCLKU1",105,0)
 ;
"RTN","HBHCLKU1",106,0)
 ;---------
"RTN","HBHCLKU1",107,0)
 ;Diagnosis entry for Discharge
"RTN","HBHCLKU1",108,0)
 ;Called by:
"RTN","HBHCLKU1",109,0)
 ; - HBHC DISCHARGE Input Template
"RTN","HBHCLKU1",110,0)
 ; - HBHC UPDATE DISCHARGE Input Template
"RTN","HBHCLKU1",111,0)
 ;Input parameters:
"RTN","HBHCLKU1",112,0)
 ; HBHCDFN1  - ^HBHC(631 IEN
"RTN","HBHCLKU1",113,0)
DCDX(HBHCDFN1) ;
"RTN","HBHCLKU1",114,0)
 D ICD(2,HBHCDFN1)
"RTN","HBHCLKU1",115,0)
 Q
"RTN","HBHCLKU1",116,0)
 ;
"RTN","HBHCLKU1",117,0)
 ;---------
"RTN","HBHCLKU1",118,0)
 ;Diagnosis entry
"RTN","HBHCLKU1",119,0)
 ;Input parameters
"RTN","HBHCLKU1",120,0)
 ; HBHCMODE - Admission or Discharge
"RTN","HBHCLKU1",121,0)
 ; HBHCDFN1  - ^HBHC(631 IEN
"RTN","HBHCLKU1",122,0)
ICD(HBHCMODE,HBHCDFN1) ;
"RTN","HBHCLKU1",123,0)
 D INITVARS ;set standards variables, you might not need this if it was already done in your application  
"RTN","HBHCLKU1",124,0)
 N HBHCRETV,HBHCPARAM,HBHCDT,HBHCSYS,HBHCDFLT,HBHCCURDXIEN,HBHCQUIT,HBHCNEWDXIEN
"RTN","HBHCLKU1",125,0)
 ;date of interest
"RTN","HBHCLKU1",126,0)
 I HBHCMODE=1 S HBHCDT=$P($G(^HBHC(631,HBHCDFN1,0)),U,18) I 1  ;admission date
"RTN","HBHCLKU1",127,0)
 E  I HBHCMODE=2 S HBHCDT=$P($G(^HBHC(631,HBHCDFN1,0)),U,40)   ;discharge date
"RTN","HBHCLKU1",128,0)
 S HBHCSYS=$$SYS^ICDEX("80",HBHCDT,"I")  ;determine coding system based on the date of interest
"RTN","HBHCLKU1",129,0)
 ;settings
"RTN","HBHCLKU1",130,0)
 D SETPARAM(.HBHCPARAM,HBHCMODE,HBHCSYS)
"RTN","HBHCLKU1",131,0)
 ;default response for the prompt
"RTN","HBHCLKU1",132,0)
 S HBHCDFLT=""
"RTN","HBHCLKU1",133,0)
 S HBHCCURDXIEN=+$$GETDX(HBHCMODE,HBHCDFN1)
"RTN","HBHCLKU1",134,0)
 S:HBHCCURDXIEN>0 HBHCDFLT=$$CODEC^ICDEX(80,HBHCCURDXIEN)_"  "_$$VSTD^ICDEX(HBHCCURDXIEN,HBHCDT)
"RTN","HBHCLKU1",135,0)
 S HBHCQUIT=0 F  Q:HBHCQUIT=1  D
"RTN","HBHCLKU1",136,0)
 . S HBHCRETV=0
"RTN","HBHCLKU1",137,0)
 . ;run either ICD9 or ICD10 prompt/search/select logic
"RTN","HBHCLKU1",138,0)
 . ;ICD9 (1 is a pointer to the ICD-9 diagnosis system entry in the new file #80.4 )
"RTN","HBHCLKU1",139,0)
 . I HBHCSYS=1 S HBHCRETV=$$DIAG9(HBHCDT,HBHCDFLT,.HBHCPARAM) I 1
"RTN","HBHCLKU1",140,0)
 . ;ICD10 (30 is a pointer to the ICD-10 diagnosis system entry in the new file #80.4 )
"RTN","HBHCLKU1",141,0)
 . E  I HBHCSYS=30 S HBHCRETV=$$DIAG10(HBHCDT,HBHCDFLT,.HBHCPARAM)
"RTN","HBHCLKU1",142,0)
 . D CLEANUP
"RTN","HBHCLKU1",143,0)
 . S HBHCNEWDXIEN=$P(HBHCRETV,";",1)
"RTN","HBHCLKU1",144,0)
 . I HBHCNEWDXIEN>0 D SAVEDX(HBHCMODE,HBHCDFN1,HBHCNEWDXIEN,HBHCDT) S HBHCQUIT=1 Q   ;if a new dx is selected
"RTN","HBHCLKU1",145,0)
 . I HBHCNEWDXIEN=-1 S HBHCQUIT=1 Q      ;Dx entry prompt: user pressed "enter" with no default, so quit dx entry and go to next prompt
"RTN","HBHCLKU1",146,0)
 . I HBHCNEWDXIEN=-2 S Y=0,HBHCQUIT=1 Q  ;Dx entry prompt: timed out, so quit dx entry and quit entire admission entry
"RTN","HBHCLKU1",147,0)
 . I HBHCNEWDXIEN=-3 S Y=0,HBHCQUIT=1 Q  ;Dx entry prompt: user entered "^", so quit entry and quit entire admission entry
"RTN","HBHCLKU1",148,0)
 . I HBHCNEWDXIEN=-4 S HBHCQUIT=1 Q      ;Dx entry prompt: user pressed "enter" with default value
"RTN","HBHCLKU1",149,0)
 . I HBHCNEWDXIEN=-5 D  Q                ;Dx entry prompt: user entered "@", so ask Y/N question to user
"RTN","HBHCLKU1",150,0)
 . . I HBHCCURDXIEN'>0 S HBHCQUIT=0 Q
"RTN","HBHCLKU1",151,0)
 . . I $$QUESTION("",HBHCPARAM("DELETE?"))=1 D  I 1
"RTN","HBHCLKU1",152,0)
 . . . D SAVEDX(HBHCMODE,HBHCDFN1,"",HBHCDT)
"RTN","HBHCLKU1",153,0)
 . . . S HBHCQUIT=1
"RTN","HBHCLKU1",154,0)
 . . E  S HBHCQUIT=0
"RTN","HBHCLKU1",155,0)
 . I HBHCNEWDXIEN=-6 S Y=0,HBHCQUIT=1 Q  ;Dx search prompt: timed out, so quit dx entry and quit entire admission entry
"RTN","HBHCLKU1",156,0)
 . I HBHCNEWDXIEN=-7 S HBHCQUIT=0 Q      ;Dx search prompt: user entered "^" or "^^", so quit search, ask dx entry again
"RTN","HBHCLKU1",157,0)
 . I HBHCNEWDXIEN=-8 S HBHCQUIT=0 Q      ;Dx search prompt: user selected nothing, so ask dx entry again
"RTN","HBHCLKU1",158,0)
 . I HBHCNEWDXIEN=-9 S HBHCQUIT=0 Q      ;Dx search prompt: in ICD10 if the user answered NO when warned about lot of result found
"RTN","HBHCLKU1",159,0)
 . I HBHCNEWDXIEN="" W "  No data found",! S HBHCQUIT=0 Q  ;Dx search prompt: no data found when user searched, so ask dx entry again
"RTN","HBHCLKU1",160,0)
 Q
"RTN","HBHCLKU1",161,0)
 ;
"RTN","HBHCLKU1",162,0)
 ;---------
"RTN","HBHCLKU1",163,0)
 ;Save Admission or Discharge diagnosis
"RTN","HBHCLKU1",164,0)
 ;Input parameters
"RTN","HBHCLKU1",165,0)
 ; HBHCMODE  - Admission or Discharge
"RTN","HBHCLKU1",166,0)
 ; HBHCDFN1   - ^HBHC(631 IEN
"RTN","HBHCLKU1",167,0)
 ; HBHCDXIEN - Diagnosis IEN
"RTN","HBHCLKU1",168,0)
 ; HBHCDT    - Date of interest
"RTN","HBHCLKU1",169,0)
SAVEDX(HBHCMODE,HBHCDFN1,HBHCDXIEN,HBHCDT) ;
"RTN","HBHCLKU1",170,0)
 N HBHCPC
"RTN","HBHCLKU1",171,0)
 I HBHCMODE=1 S HBHCPC=19 I 1
"RTN","HBHCLKU1",172,0)
 E  I HBHCMODE=2 S HBHCPC=47
"RTN","HBHCLKU1",173,0)
 S $P(^HBHC(631,HBHCDFN1,0),U,HBHCPC)=HBHCDXIEN
"RTN","HBHCLKU1",174,0)
 W:HBHCDXIEN>0 "  "_$$CODEC^ICDEX(80,HBHCDXIEN)_"  "_$$VSTD^ICDEX(HBHCDXIEN,HBHCDT)
"RTN","HBHCLKU1",175,0)
 Q
"RTN","HBHCLKU1",176,0)
 ;
"RTN","HBHCLKU1",177,0)
 ;---------
"RTN","HBHCLKU1",178,0)
 ;Get Admission or Discharge diagnosis
"RTN","HBHCLKU1",179,0)
 ;Input parameters
"RTN","HBHCLKU1",180,0)
 ; HBHCMODE  - Admission or Discharge
"RTN","HBHCLKU1",181,0)
 ; HBHCDFN1   - ^HBHC(631 IEN
"RTN","HBHCLKU1",182,0)
GETDX(HBHCMODE,HBHCDFN1) ;
"RTN","HBHCLKU1",183,0)
 N HBHCPC
"RTN","HBHCLKU1",184,0)
 I HBHCMODE=1 S HBHCPC=19 I 1
"RTN","HBHCLKU1",185,0)
 E  I HBHCMODE=2 S HBHCPC=47
"RTN","HBHCLKU1",186,0)
 Q $P($G(^HBHC(631,HBHCDFN1,0)),U,HBHCPC)
"RTN","HBHCLKU1",187,0)
 ;
"RTN","HBHCLKU1",188,0)
 ;---------
"RTN","HBHCLKU1",189,0)
 ;The entry point for ICD-10 diagnosis search functionality
"RTN","HBHCLKU1",190,0)
 ;can be called from applications directly
"RTN","HBHCLKU1",191,0)
 ;input parameters :
"RTN","HBHCLKU1",192,0)
 ; HBHCDT - date of interest (Fileman format)
"RTN","HBHCLKU1",193,0)
 ; HBHCDFLT - default values for the search string (can be a code by default)
"RTN","HBHCLKU1",194,0)
 ; HBHCPARAM - parameters/string constants (see SETPARAM for details)
"RTN","HBHCLKU1",195,0)
 ;returns ICD-10 code selected by the user:
"RTN","HBHCLKU1",196,0)
 ; IEN file #80;ICD code value;IEN file #757.01^description
"RTN","HBHCLKU1",197,0)
 ; results
"RTN","HBHCLKU1",198,0)
 ; or -1 Dx entry prompt: if invalid data(press enter)
"RTN","HBHCLKU1",199,0)
 ; or -2 Dx entry prompt: if time out
"RTN","HBHCLKU1",200,0)
 ; or -3 Dx entry prompt: if ^ or ^^
"RTN","HBHCLKU1",201,0)
 ; or -4 Dx entry prompt: if no changes to the default value
"RTN","HBHCLKU1",202,0)
 ; or -5 Dx entry prompt: if user enters "@"
"RTN","HBHCLKU1",203,0)
 ; or -6 Dx search prompt: if timed out
"RTN","HBHCLKU1",204,0)
 ; or -7 Dx search prompt: search was aborted by user by entering "^" or "^^"
"RTN","HBHCLKU1",205,0)
 ; or -8 Dx search prompt: user selected nothing
"RTN","HBHCLKU1",206,0)
 ; or -9 Dx search prompt: if the user answered NO for the question "Do you wish to continue(Y/N)?"
"RTN","HBHCLKU1",207,0)
 ; or "" Dx search prompt: if not found
"RTN","HBHCLKU1",208,0)
 ; 
"RTN","HBHCLKU1",209,0)
DIAG10(HBHCDT,HBHCDFLT,HBHCPARAM) ;
"RTN","HBHCLKU1",210,0)
 N HBHCINP,HBHCRETV
"RTN","HBHCLKU1",211,0)
 F  D  Q:HBHCINP<0!($L($P(HBHCINP,U,2))>1)
"RTN","HBHCLKU1",212,0)
 . S HBHCINP=$$SRCHSTR(HBHCPARAM("SEARCH_PROMPT"),HBHCPARAM("HELP ?"),HBHCPARAM("HELP ??"),HBHCDFLT)
"RTN","HBHCLKU1",213,0)
 . I HBHCINP'<0 I $L($P(HBHCINP,U,2))'>1 W !!,HBHCPARAM("ENTER MORE") W:$L(HBHCPARAM("ENTER MORE2"))>0 !,HBHCPARAM("ENTER MORE2") W ! ;user should enter at least 2 characters
"RTN","HBHCLKU1",214,0)
 I HBHCINP<0 Q +HBHCINP
"RTN","HBHCLKU1",215,0)
 S HBHCRETV=$$LEXICD10($P(HBHCINP,U,2),HBHCDT,.HBHCPARAM)
"RTN","HBHCLKU1",216,0)
 I HBHCRETV=-1 Q -8   ;non selection
"RTN","HBHCLKU1",217,0)
 I HBHCRETV=-2 Q -6   ;search timed out
"RTN","HBHCLKU1",218,0)
 I HBHCRETV=-3 Q -7   ;search was aborted by user by entering "^" or "^^"
"RTN","HBHCLKU1",219,0)
 I HBHCRETV=-4 Q -9   ;user answered NO for the question "Do you wish to continue(Y/N)?" when search returned lot of values
"RTN","HBHCLKU1",220,0)
 Q HBHCRETV
"RTN","HBHCLKU1",221,0)
 ;
"RTN","HBHCLKU1",222,0)
 ;---------
"RTN","HBHCLKU1",223,0)
 ;The entry point for ICD-9 FileMan type (^DIC) diagnosis search functionality
"RTN","HBHCLKU1",224,0)
 ;can be called from applications directly
"RTN","HBHCLKU1",225,0)
 ;input parameters :
"RTN","HBHCLKU1",226,0)
 ; HBHCDT - date of interest
"RTN","HBHCLKU1",227,0)
 ; HBHCDFLT - default values for the search string (can be a code by default)
"RTN","HBHCLKU1",228,0)
 ; HBHCPARAM - parameters/string constants (see SETPARAM for details)
"RTN","HBHCLKU1",229,0)
 ;returns ICD-9 code selected by the user:
"RTN","HBHCLKU1",230,0)
 ;  IEN file #80;ICD code value^description
"RTN","HBHCLKU1",231,0)
 ; or -1 Dx entry prompt: if invalid data(press enter)
"RTN","HBHCLKU1",232,0)
 ; or -2 Dx entry prompt: if time out
"RTN","HBHCLKU1",233,0)
 ; or -3 Dx entry prompt: if ^ or ^^
"RTN","HBHCLKU1",234,0)
 ; or -4 Dx entry prompt: if no changes to the default value
"RTN","HBHCLKU1",235,0)
 ; or -5 Dx entry prompt: if user enters "@"
"RTN","HBHCLKU1",236,0)
 ; or -6 Dx search prompt: if time out
"RTN","HBHCLKU1",237,0)
 ; or -7 Dx search prompt: search was aborted by user by entering "^" or "^^"
"RTN","HBHCLKU1",238,0)
 ; or -8 Dx search prompt: user selected nothing
"RTN","HBHCLKU1",239,0)
 ; or "" Dx search prompt: if not found
"RTN","HBHCLKU1",240,0)
 ;
"RTN","HBHCLKU1",241,0)
DIAG9(HBHCDT,HBHCDFLT,HBHCPARAM) ;
"RTN","HBHCLKU1",242,0)
 N HBHCINP,HBHCRETV
"RTN","HBHCLKU1",243,0)
 S HBHCINP=$$SRCHSTR(HBHCPARAM("SEARCH_PROMPT"),HBHCPARAM("HELP ?"),HBHCPARAM("HELP ??"),HBHCDFLT)
"RTN","HBHCLKU1",244,0)
 I +HBHCINP<0 Q +HBHCINP
"RTN","HBHCLKU1",245,0)
 S HBHCRETV=$$FMICD9($P(HBHCINP,U,2),HBHCDT)
"RTN","HBHCLKU1",246,0)
 S HBHCRETV=$P(HBHCRETV,U,1)
"RTN","HBHCLKU1",247,0)
 I HBHCRETV=-3 Q -6  ;search timed-out
"RTN","HBHCLKU1",248,0)
 I HBHCRETV=-2 Q -7  ;search was aborted by user by entering "^" or "^^"
"RTN","HBHCLKU1",249,0)
 I HBHCRETV=-1 Q -8  ;user selected nothing or no values found
"RTN","HBHCLKU1",250,0)
 Q HBHCRETV
"RTN","HBHCLKU1",251,0)
 ;
"RTN","HBHCLKU1",252,0)
 ;---------
"RTN","HBHCLKU1",253,0)
 ;The entry point for ICD-10 diagnosis search functionality
"RTN","HBHCLKU1",254,0)
 ;input parameters :
"RTN","HBHCLKU1",255,0)
 ; HBHCTXT - search string
"RTN","HBHCLKU1",256,0)
 ; HBHCDATE - date of interest
"RTN","HBHCLKU1",257,0)
 ; HBHCPAR - array with text messages and other string constants
"RTN","HBHCLKU1",258,0)
 ;returns ICD-10 code selected by the user:
"RTN","HBHCLKU1",259,0)
 ;  IEN file #80;ICD code value^description
"RTN","HBHCLKU1",260,0)
 ; or 
"RTN","HBHCLKU1",261,0)
 ; "" if not found 
"RTN","HBHCLKU1",262,0)
 ; -1 if non selection
"RTN","HBHCLKU1",263,0)
 ; -2 if search timed out
"RTN","HBHCLKU1",264,0)
 ; -3 if search was aborted by user by entering "^" or "^^"
"RTN","HBHCLKU1",265,0)
 ; -4 if user answered NO for the question "Do you wish to continue(Y/N)?" when search returned lot of values
"RTN","HBHCLKU1",266,0)
 ;
"RTN","HBHCLKU1",267,0)
LEXICD10(HBHCTXT,HBHCDATE,HBHCPAR) ; ICD-10 Search
"RTN","HBHCLKU1",268,0)
 N HBHCLVTXT
"RTN","HBHCLKU1",269,0)
 ;parameters check
"RTN","HBHCLKU1",270,0)
 S HBHCDATE=+$G(HBHCDATE)
"RTN","HBHCLKU1",271,0)
 I HBHCDATE'?7N Q -1
"RTN","HBHCLKU1",272,0)
 S HBHCTXT=$G(HBHCTXT)
"RTN","HBHCLKU1",273,0)
 Q:'$L(HBHCTXT) -1
"RTN","HBHCLKU1",274,0)
 N HBHCNUMB
"RTN","HBHCLKU1",275,0)
 S HBHCNUMB=$$FREQ^LEXU(HBHCTXT)
"RTN","HBHCLKU1",276,0)
 I HBHCNUMB>$$MAX^LEXU(30) D  I $$QUESTION("N",HBHCPARAM("WISH CONTINUE"))'=1 Q -4
"RTN","HBHCLKU1",277,0)
 . D FORMWRIT(HBHCPAR("EXCEEDS MESSAGE1")_HBHCTXT_HBHCPAR("EXCEEDS MESSAGE2")_HBHCNUMB_HBHCPAR("EXCEEDS MESSAGE3")_HBHCTXT_""".",0)
"RTN","HBHCLKU1",278,0)
 . D FORMWRIT("",2)
"RTN","HBHCLKU1",279,0)
 ;new and set variables
"RTN","HBHCLKU1",280,0)
 N DIROUT,DUOUT,DTOUT,HBHCEXIT,HBHCICDNT
"RTN","HBHCLKU1",281,0)
 N HBHCRETV,HBHCXX,HBHCLEVEL
"RTN","HBHCLKU1",282,0)
 S HBHCRETV=""
"RTN","HBHCLKU1",283,0)
 S HBHCEXIT=0
"RTN","HBHCLKU1",284,0)
 S HBHCLEVEL=1,HBHCLVTXT(HBHCLEVEL)=HBHCTXT ;level 1 stores the original search string
"RTN","HBHCLKU1",285,0)
 ; main loop
"RTN","HBHCLKU1",286,0)
 F  Q:HBHCEXIT>0  D
"RTN","HBHCLKU1",287,0)
 . K HBHCICDY
"RTN","HBHCLKU1",288,0)
 . ;get the search string from the current level and call LEX API
"RTN","HBHCLKU1",289,0)
 . S HBHCICDY=$$DIAGSRCH^LEX10CS(HBHCLVTXT(HBHCLEVEL),.HBHCICDY,HBHCDATE,30)
"RTN","HBHCLKU1",290,0)
 . S:$O(HBHCICDY(" "),-1)>0 HBHCICDY=+HBHCICDY
"RTN","HBHCLKU1",291,0)
 . ; Nothing found
"RTN","HBHCLKU1",292,0)
 . I +HBHCICDY'>0 S HBHCEXIT=1 S HBHCXX=-1 Q
"RTN","HBHCLKU1",293,0)
 . ; display the list of items and ask the user to select the item from the list
"RTN","HBHCLKU1",294,0)
 . S HBHCXX=$$SEL^HBHCLKU2(.HBHCICDY,8)
"RTN","HBHCLKU1",295,0)
 . ; if ^ was entered 
"RTN","HBHCLKU1",296,0)
 . ;   if this is on the top level then quit 
"RTN","HBHCLKU1",297,0)
 . I HBHCXX=-2,HBHCLEVEL'>1 S HBHCRETV=-3 S HBHCEXIT=1 Q
"RTN","HBHCLKU1",298,0)
 . ;   if lower level then go one level up
"RTN","HBHCLKU1",299,0)
 . I HBHCXX=-2,HBHCLEVEL>1 S HBHCLEVEL=HBHCLEVEL-1 Q
"RTN","HBHCLKU1",300,0)
 . ; If timeout then quit
"RTN","HBHCLKU1",301,0)
 . I HBHCXX=-3 S HBHCRETV=-2 S HBHCEXIT=1 Q
"RTN","HBHCLKU1",302,0)
 . ; If not selected then quit
"RTN","HBHCLKU1",303,0)
 . I HBHCXX=-1 S HBHCRETV=-1 S HBHCEXIT=1 Q
"RTN","HBHCLKU1",304,0)
 . ; If ^^ then quit
"RTN","HBHCLKU1",305,0)
 . I HBHCXX=-5 S HBHCRETV=-3 S HBHCEXIT=1 Q
"RTN","HBHCLKU1",306,0)
 . ; if Code Found and Selected by the user save selection in HBHCRETV and quit
"RTN","HBHCLKU1",307,0)
 . I $P(HBHCXX,";")'="99:CAT" S HBHCRETV=HBHCXX S HBHCEXIT=1 Q
"RTN","HBHCLKU1",308,0)
 . ; If Category Found and Selected by the user:  
"RTN","HBHCLKU1",309,0)
 . ;  go to the next inner level
"RTN","HBHCLKU1",310,0)
 . ;  change level number 
"RTN","HBHCLKU1",311,0)
 . S HBHCLEVEL=HBHCLEVEL+1
"RTN","HBHCLKU1",312,0)
 . ;  set the new level with the new search string
"RTN","HBHCLKU1",313,0)
 . ;  and repeat 
"RTN","HBHCLKU1",314,0)
 . S HBHCLVTXT(HBHCLEVEL)=$P($P($G(HBHCXX),"^"),";",2)
"RTN","HBHCLKU1",315,0)
 Q HBHCRETV
"RTN","HBHCLKU1",316,0)
 ;
"RTN","HBHCLKU1",317,0)
 ;---------
"RTN","HBHCLKU1",318,0)
 ;ICD-9 lookup (FileMan lookup)
"RTN","HBHCLKU1",319,0)
 ;Input parameters :
"RTN","HBHCLKU1",320,0)
 ; HBHCSRCH - search string 
"RTN","HBHCLKU1",321,0)
 ; HBHCICDT - date of interest  
"RTN","HBHCLKU1",322,0)
 ;returns ICD-9 code selected by the user:
"RTN","HBHCLKU1",323,0)
 ;  IEN file #80;ICD code value^description
"RTN","HBHCLKU1",324,0)
 ; or 
"RTN","HBHCLKU1",325,0)
 ; -1 if error like no selection made or search found nothing
"RTN","HBHCLKU1",326,0)
 ; -2 if exit : ^ or ^^
"RTN","HBHCLKU1",327,0)
 ; -3 if timed out
"RTN","HBHCLKU1",328,0)
 ;Note: this API is not silent because the ICD lookup is not silent
"RTN","HBHCLKU1",329,0)
FMICD9(HBHCSRCH,HBHCICDT) ;
"RTN","HBHCLKU1",330,0)
 N KEY,X,Y,DIC,HBHCCDS
"RTN","HBHCLKU1",331,0)
 ;KEY must be newed as ICD lookup code doesn't kill it
"RTN","HBHCLKU1",332,0)
 S DIC="^ICD9(",DIC(0)="EQZ"
"RTN","HBHCLKU1",333,0)
 ; Set screening of inactive codes!!
"RTN","HBHCLKU1",334,0)
 S HBHCCDS="ICD9"
"RTN","HBHCLKU1",335,0)
 S DIC("S")="I $$CSI^ICDEX(80,Y)=1"
"RTN","HBHCLKU1",336,0)
 ; both X and Y should be set to the search string
"RTN","HBHCLKU1",337,0)
 S (X,Y)=HBHCSRCH
"RTN","HBHCLKU1",338,0)
 D ^DIC
"RTN","HBHCLKU1",339,0)
 I $G(Y) D  Q Y
"RTN","HBHCLKU1",340,0)
 . I $P(Y,U,1)<0 D
"RTN","HBHCLKU1",341,0)
 . . S:$D(DUOUT) Y=-2  ;search aborted
"RTN","HBHCLKU1",342,0)
 . . S:$D(DTOUT) Y=-3  ;timed out
"RTN","HBHCLKU1",343,0)
 Q X
"RTN","HBHCLKU1",344,0)
 ;
"RTN","HBHCLKU1",345,0)
 ;---------
"RTN","HBHCLKU1",346,0)
 ; Clean up environment and quit
"RTN","HBHCLKU1",347,0)
CLEANUP ;
"RTN","HBHCLKU1",348,0)
 K %,DIC,DIR,DIROUT,DIRUT,DTOUT,DUOUT,X,Y,%Y,DIWL,DIWR
"RTN","HBHCLKU1",349,0)
 Q
"RTN","HBHCLKU1",350,0)
 ;
"RTN","HBHCLKU1",351,0)
 ;---------
"RTN","HBHCLKU1",352,0)
 ;ask YES/NO questions
"RTN","HBHCLKU1",353,0)
 ;input parameters :
"RTN","HBHCLKU1",354,0)
 ; HBHCDFLT- 0/null- not default, 1- yes, 2 -no
"RTN","HBHCLKU1",355,0)
 ; HBHCPROM - prompt string
"RTN","HBHCLKU1",356,0)
 ;returns 
"RTN","HBHCLKU1",357,0)
 ; 2 - no,
"RTN","HBHCLKU1",358,0)
 ; 1 -yes,
"RTN","HBHCLKU1",359,0)
 ; 0 - no answer
"RTN","HBHCLKU1",360,0)
QUESTION(HBHCDFLT,HBHCPROM) ;
"RTN","HBHCLKU1",361,0)
 W:$L($G(HBHCPROM)) !,HBHCPROM
"RTN","HBHCLKU1",362,0)
 S %=$G(HBHCDFLT,2)
"RTN","HBHCLKU1",363,0)
 D YN^DICN
"RTN","HBHCLKU1",364,0)
 Q:%Y["^" -3
"RTN","HBHCLKU1",365,0)
 I %=2!(%=1) Q %
"RTN","HBHCLKU1",366,0)
 Q -2
"RTN","HBHCLKU1",367,0)
 ;
"RTN","HBHCLKU1",368,0)
 ;---------
"RTN","HBHCLKU1",369,0)
 ;get search string
"RTN","HBHCLKU1",370,0)
 ;input parameters :
"RTN","HBHCLKU1",371,0)
 ; HBHCPRMT prompt text
"RTN","HBHCLKU1",372,0)
 ; HBHCHLP1 "?" help text
"RTN","HBHCLKU1",373,0)
 ; HBHCHLP2 "??" help text
"RTN","HBHCLKU1",374,0)
 ; HBHCDFLT- default response
"RTN","HBHCLKU1",375,0)
 ;returns piece1 ^ piece 2
"RTN","HBHCLKU1",376,0)
 ; piece1:
"RTN","HBHCLKU1",377,0)
 ; 0 if normal input
"RTN","HBHCLKU1",378,0)
 ; or -1 if invalid data
"RTN","HBHCLKU1",379,0)
 ; or -2 if time out
"RTN","HBHCLKU1",380,0)
 ; or -3 if ^
"RTN","HBHCLKU1",381,0)
 ; or -4 if user accepts default value
"RTN","HBHCLKU1",382,0)
 ; or -5 if user enters "@"
"RTN","HBHCLKU1",383,0)
 ; piece2: string entered by the user
"RTN","HBHCLKU1",384,0)
SRCHSTR(HBHCPRMT,HBHCHLP1,HBHCHLP2,HBHCDFLT) ;
"RTN","HBHCLKU1",385,0)
 N DIR
"RTN","HBHCLKU1",386,0)
 S DIR("A")=HBHCPRMT
"RTN","HBHCLKU1",387,0)
 S DIR("?")=HBHCHLP1
"RTN","HBHCLKU1",388,0)
 S DIR("??")=HBHCHLP2
"RTN","HBHCLKU1",389,0)
 I $L($G(HBHCDFLT)) S DIR("B")=HBHCDFLT
"RTN","HBHCLKU1",390,0)
 S DIR(0)="FAOr^0:245"
"RTN","HBHCLKU1",391,0)
 D ^DIR
"RTN","HBHCLKU1",392,0)
 Q:$D(DTOUT) -2
"RTN","HBHCLKU1",393,0)
 Q:$D(DUOUT) -3
"RTN","HBHCLKU1",394,0)
 Q:X="@" -5
"RTN","HBHCLKU1",395,0)
 Q:Y["^" -3
"RTN","HBHCLKU1",396,0)
 Q:Y="" -1
"RTN","HBHCLKU1",397,0)
 Q:(($L($G(HBHCDFLT)))&(Y=HBHCDFLT)) -4  ;if user accepts default value then no need to validate it
"RTN","HBHCLKU1",398,0)
 Q 0_U_Y
"RTN","HBHCLKU1",399,0)
 ;
"RTN","HBHCLKU1",400,0)
 ;---------
"RTN","HBHCLKU1",401,0)
 ;set parameters
"RTN","HBHCLKU1",402,0)
 ;edit these hardcoded strings that are used for prompts, messages and so on to adjust them to your application's needs
"RTN","HBHCLKU1",403,0)
 ;input parameters 
"RTN","HBHCLKU1",404,0)
 ; HBHCPAR  - local array to sets and store string constants for your messages and prompts 
"RTN","HBHCLKU1",405,0)
 ; HBHCMODE - Admission or Discharge entry
"RTN","HBHCLKU1",406,0)
 ; HBHCCS   - Search coding system
"RTN","HBHCLKU1",407,0)
SETPARAM(HBHCPAR,HBHCMODE,HBHCCS) ;
"RTN","HBHCLKU1",408,0)
 I HBHCMODE=1 S HBHCPAR("SEARCH_PROMPT")="PRIMARY DIAGNOSIS @ ADMISSION: " I 1
"RTN","HBHCLKU1",409,0)
 E  I HBHCMODE=2 S HBHCPAR("SEARCH_PROMPT")="PRIMARY DIAGNOSIS @ DISCHARGE: " I 1
"RTN","HBHCLKU1",410,0)
 E  S HBHCPAR("SEARCH_PROMPT")="Enter Diagnosis, a Code or a Code Fragment: "
"RTN","HBHCLKU1",411,0)
 I HBHCCS=1 D  I 1
"RTN","HBHCLKU1",412,0)
 . S HBHCPAR("HELP ?")="^D HLPICD9^HBHCLKU1"
"RTN","HBHCLKU1",413,0)
 . S HBHCPAR("HELP ??")="^D HLPICD9^HBHCLKU1"
"RTN","HBHCLKU1",414,0)
 E  I HBHCCS=30 D  I 1
"RTN","HBHCLKU1",415,0)
 . S HBHCPAR("HELP ?")="^D HLPICD10^HBHCLKU1"
"RTN","HBHCLKU1",416,0)
 . S HBHCPAR("HELP ??")="^D HLPICD10^HBHCLKU1"
"RTN","HBHCLKU1",417,0)
 S HBHCPAR("WISH CONTINUE")="Do you wish to continue(Y/N)"
"RTN","HBHCLKU1",418,0)
 S HBHCPAR("EXCEEDS MESSAGE1")="Searching for """
"RTN","HBHCLKU1",419,0)
 S HBHCPAR("EXCEEDS MESSAGE2")=""" requires inspecting "
"RTN","HBHCLKU1",420,0)
 S HBHCPAR("EXCEEDS MESSAGE3")=" records to determine if they match the search criteria.  This could take quite some time.  Suggest refining the search by further specifying """
"RTN","HBHCLKU1",421,0)
 S HBHCPAR("DELETE?")="   SURE YOU WANT TO DELETE"
"RTN","HBHCLKU1",422,0)
 S HBHCPAR("ENTER MORE")=" Please enter at least the first two characters of the ICD-10 code or code"
"RTN","HBHCLKU1",423,0)
 S HBHCPAR("ENTER MORE2")=" description to start the search."
"RTN","HBHCLKU1",424,0)
 Q
"RTN","HBHCLKU1",425,0)
 ;
"RTN","HBHCLKU1",426,0)
 ;---------
"RTN","HBHCLKU1",427,0)
 ; Look-up help for ICD-10
"RTN","HBHCLKU1",428,0)
HLPICD10 ;
"RTN","HBHCLKU1",429,0)
 I $G(X)["???" D INPHLP3 Q
"RTN","HBHCLKU1",430,0)
 I $G(X)["??" D INPHLP2 Q
"RTN","HBHCLKU1",431,0)
 W !," Enter code or ""text"" for more information." Q
"RTN","HBHCLKU1",432,0)
 Q
"RTN","HBHCLKU1",433,0)
 ;-----------
"RTN","HBHCLKU1",434,0)
 ; Look-up help for ??
"RTN","HBHCLKU1",435,0)
INPHLP2 ;
"RTN","HBHCLKU1",436,0)
 W !," Enter a ""free text"" term or part of a term such as ""femur fracture""."
"RTN","HBHCLKU1",437,0)
 W !!," or "
"RTN","HBHCLKU1",438,0)
 W !!," Enter a ""classification code"" (ICD/CPT etc) to find the single term"
"RTN","HBHCLKU1",439,0)
 W !," associated with the code."
"RTN","HBHCLKU1",440,0)
 W !!," or "
"RTN","HBHCLKU1",441,0)
 W !!," Enter a ""partial code"". Include the decimal when a search criterion"
"RTN","HBHCLKU1",442,0)
 W !," includes 3 characters or more for code searches."
"RTN","HBHCLKU1",443,0)
 Q
"RTN","HBHCLKU1",444,0)
 ;--------
"RTN","HBHCLKU1",445,0)
 ; Look-up help for ???
"RTN","HBHCLKU1",446,0)
INPHLP3 ;
"RTN","HBHCLKU1",447,0)
 W !," Number of Code Matches"
"RTN","HBHCLKU1",448,0)
 W !," ----------------------"
"RTN","HBHCLKU1",449,0)
 W !!," The ICD-10 Diagnosis Code search will show the user the number of matches"
"RTN","HBHCLKU1",450,0)
 W !," found, indicate if additional characters in ICD code exist, and the number"
"RTN","HBHCLKU1",451,0)
 W !," of codes within the category or subcategory that are available for selection."
"RTN","HBHCLKU1",452,0)
 W !," For example:"
"RTN","HBHCLKU1",453,0)
 W !!," 14 matches found"
"RTN","HBHCLKU1",454,0)
 W !!," M91. - Juvenile osteochondrosis of hip and pelvis (19)"
"RTN","HBHCLKU1",455,0)
 W !!," This indicates that 14 unique matches or matching groups have been found"
"RTN","HBHCLKU1",456,0)
 W !," and will be displayed."
"RTN","HBHCLKU1",457,0)
 W !!," M91. - the ""-"" indicates that there are additional characters that specify"
"RTN","HBHCLKU1",458,0)
 W !," unique ICD-10 codes available."
"RTN","HBHCLKU1",459,0)
 W !!," (19) Indicates that there are 19 additional ICD-10 codes in the M91 ""family"""
"RTN","HBHCLKU1",460,0)
 W !," that are possible selections."
"RTN","HBHCLKU1",461,0)
 Q
"RTN","HBHCLKU1",462,0)
 ;
"RTN","HBHCLKU1",463,0)
 ;---------
"RTN","HBHCLKU1",464,0)
 ; Look-up help for ICD-9
"RTN","HBHCLKU1",465,0)
HLPICD9 ;
"RTN","HBHCLKU1",466,0)
 N DIC,D,DIFORMAT,DZ
"RTN","HBHCLKU1",467,0)
 I $G(X)["??" D  I 1
"RTN","HBHCLKU1",468,0)
 . W "        This field represents patient's primary diagnosis at time of admission,"
"RTN","HBHCLKU1",469,0)
 . W !,"        referencing ICD Diagnosis (80) file entries."
"RTN","HBHCLKU1",470,0)
 . S DZ="??"
"RTN","HBHCLKU1",471,0)
 E  D
"RTN","HBHCLKU1",472,0)
 . W "     Answer with ICD diagnosis code, or diagnosis description, of patient's"
"RTN","HBHCLKU1",473,0)
 . W !,"     primary diagnosis at time of admission."
"RTN","HBHCLKU1",474,0)
 S D="B"
"RTN","HBHCLKU1",475,0)
 S DIC="^ICD9(",DIC(0)="IMEQXZ"
"RTN","HBHCLKU1",476,0)
 S DIC("S")="I $$CSI^ICDEX(80,Y)=1"
"RTN","HBHCLKU1",477,0)
 D DQ^DICQ
"RTN","HBHCLKU1",478,0)
 Q
"RTN","HBHCLKU1",479,0)
 ;
"RTN","HBHCLKU1",480,0)
 ;---------
"RTN","HBHCLKU1",481,0)
 ;a wrapper for ^DIWP
"RTN","HBHCLKU1",482,0)
 ;accumulates a text and then writes it to the device
"RTN","HBHCLKU1",483,0)
 ;input parameters :
"RTN","HBHCLKU1",484,0)
 ; X - text
"RTN","HBHCLKU1",485,0)
 ; HBHCMODE:
"RTN","HBHCLKU1",486,0)
 ;  0 - start
"RTN","HBHCLKU1",487,0)
 ;  1 - accumulate 
"RTN","HBHCLKU1",488,0)
 ;  2 - write
"RTN","HBHCLKU1",489,0)
 ;example:
"RTN","HBHCLKU1",490,0)
 ;D FORMWRIT^HBHCLKU1("this API is a wrapper for ^DIWP, it accumulates a text and then writes it to the device, you can use it in your application code",0)
"RTN","HBHCLKU1",491,0)
 ;D FORMWRIT^HBHCLKU1("some more text ",1)
"RTN","HBHCLKU1",492,0)
 ;D FORMWRIT^HBHCLKU1("",2)
"RTN","HBHCLKU1",493,0)
FORMWRIT(X,HBHCMODE) ;
"RTN","HBHCLKU1",494,0)
 N HBHCLI1
"RTN","HBHCLKU1",495,0)
 ;if "start" mode
"RTN","HBHCLKU1",496,0)
 I HBHCMODE=0 K ^UTILITY($J,"W")
"RTN","HBHCLKU1",497,0)
 S DIWL=1,DIWR=79
"RTN","HBHCLKU1",498,0)
 I $L(X)>0 D ^DIWP
"RTN","HBHCLKU1",499,0)
 ;if "write" mode
"RTN","HBHCLKU1",500,0)
 I HBHCMODE=2 D
"RTN","HBHCLKU1",501,0)
 . S HBHCLI1=0 F  S HBHCLI1=$O(^UTILITY($J,"W",1,HBHCLI1)) Q:+HBHCLI1=0  W !,$G(^UTILITY($J,"W",1,HBHCLI1,0))
"RTN","HBHCLKU1",502,0)
 . K ^UTILITY($J,"W")
"RTN","HBHCLKU1",503,0)
 Q
"RTN","HBHCLKU1",504,0)
 ;
"RTN","HBHCLKU1",505,0)
 ;---------
"RTN","HBHCLKU1",506,0)
 ;Initialize variables if you need , your application most likely already has this
"RTN","HBHCLKU1",507,0)
INITVARS ;
"RTN","HBHCLKU1",508,0)
 D HOME^%ZIS
"RTN","HBHCLKU1",509,0)
 S:$G(DT)=0 DT=$$DT^XLFDT
"RTN","HBHCLKU1",510,0)
 Q
"RTN","HBHCLKU1",511,0)
 ;
"RTN","HBHCLKU2")
0^17^B48982344^n/a
"RTN","HBHCLKU2",1,0)
HBHCLKU2 ;ALB/KG - DIAGNOSIS LOOK UP ;5/15/12
"RTN","HBHCLKU2",2,0)
 ;;1.0;HOSPITAL BASED HOME CARE;**25**;NOV 01, 1993;Build 45
"RTN","HBHCLKU2",3,0)
 ;******************************************************************************
"RTN","HBHCLKU2",4,0)
 ;******************************************************************************
"RTN","HBHCLKU2",5,0)
 ;                       --- ROUTINE MODIFICATION LOG ---
"RTN","HBHCLKU2",6,0)
 ;        
"RTN","HBHCLKU2",7,0)
 ;PKG/PATCH    DATE        DEVELOPER    MODIFICATION
"RTN","HBHCLKU2",8,0)
 ;-----------  ----------  -----------  ----------------------------------------
"RTN","HBHCLKU2",9,0)
 ;HBH*1.0*25   FEB  2012   K GUPTA      Support for ICD-10 Coding System
"RTN","HBHCLKU2",10,0)
 ;******************************************************************************
"RTN","HBHCLKU2",11,0)
 ;******************************************************************************
"RTN","HBHCLKU2",12,0)
 ;
"RTN","HBHCLKU2",13,0)
 ; Input   
"RTN","HBHCLKU2",14,0)
 ; 
"RTN","HBHCLKU2",15,0)
 ;     X     Length of list to display (default 5)
"RTN","HBHCLKU2",16,0)
 ;    .HBHCSRL   Local array passed by reference
"RTN","HBHCLKU2",17,0)
 ;               
"RTN","HBHCLKU2",18,0)
 ;             HBHCSRL()   Input Array from ICDSRCH^LEX10CS
"RTN","HBHCLKU2",19,0)
 ;               
"RTN","HBHCLKU2",20,0)
 ;             HBHCSRL(0)=# found ^ Pruning Indicator
"RTN","HBHCLKU2",21,0)
 ;             HBHCSRL(1,0)=Code ^ Code IEN ^ date
"RTN","HBHCLKU2",22,0)
 ;             HBHCSRL(1,"IDL")=ICD-9/10 Description, Long
"RTN","HBHCLKU2",23,0)
 ;             HBHCSRL(1,"IDL",1)=ICD-9/10 IEN ^ date
"RTN","HBHCLKU2",24,0)
 ;             HBHCSRL(1,"IDS")=ICD-9/10 Description, Short
"RTN","HBHCLKU2",25,0)
 ;             HBHCSRL(1,"IDS",1)=ICD-9/10 IEN ^ date
"RTN","HBHCLKU2",26,0)
 ;             HBHCSRL(1,"LEX")=Lexicon Description
"RTN","HBHCLKU2",27,0)
 ;             HBHCSRL(1,"LEX",1)=Expression IEN ^ date
"RTN","HBHCLKU2",28,0)
 ;             HBHCSRL(1,"SYN",1)=Synonym #1
"RTN","HBHCLKU2",29,0)
 ;             HBHCSRL(1,"SYN",m)=Synonym #m
"RTN","HBHCLKU2",30,0)
 ;             ...
"RTN","HBHCLKU2",31,0)
 ;               
"RTN","HBHCLKU2",32,0)
 ; Output
"RTN","HBHCLKU2",33,0)
 ;               
"RTN","HBHCLKU2",34,0)
 ;    $$SEL  Two Piece "^" delimited string same as
"RTN","HBHCLKU2",35,0)
 ;           Fileman's Y output variable
"RTN","HBHCLKU2",36,0)
 ;               
"RTN","HBHCLKU2",37,0)
 ;             1  Lexicon IEN
"RTN","HBHCLKU2",38,0)
 ;             2  Lexicon Term
"RTN","HBHCLKU2",39,0)
 ;               
"RTN","HBHCLKU2",40,0)
 ;    HBHCSRL    Local array passed by reference
"RTN","HBHCLKU2",41,0)
 ;               
"RTN","HBHCLKU2",42,0)
 ;             HBHCSRL(0)=Code ^ Code IEN ^ date
"RTN","HBHCLKU2",43,0)
 ;             HBHCSRL("IDL")=ICD-9/10 Description, Long
"RTN","HBHCLKU2",44,0)
 ;             HBHCSRL("IDL",1)=ICD-9/10 IEN ^ date
"RTN","HBHCLKU2",45,0)
 ;             HBHCSRL("IDS")=ICD-9/10 Description, Short
"RTN","HBHCLKU2",46,0)
 ;             HBHCSRL("IDS",1)=ICD-9/10 IEN ^ date
"RTN","HBHCLKU2",47,0)
 ;             HBHCSRL("LEX")=Lexicon Description
"RTN","HBHCLKU2",48,0)
 ;             HBHCSRL("LEX",1)=Expression IEN ^ date
"RTN","HBHCLKU2",49,0)
 ;               
"RTN","HBHCLKU2",50,0)
 ;    or ^ on error 
"RTN","HBHCLKU2",51,0)
 ;    or -1 for non-selection
"RTN","HBHCLKU2",52,0)
 ;    or -2 if "^" was entered
"RTN","HBHCLKU2",53,0)
 ;    or -3 if time out
"RTN","HBHCLKU2",54,0)
 ;               
"RTN","HBHCLKU2",55,0)
SEL(HBHCSRL,X) ; Select from List
"RTN","HBHCLKU2",56,0)
 N HBHCGOUP S HBHCGOUP=0
"RTN","HBHCLKU2",57,0)
 S X=+($G(X))
"RTN","HBHCLKU2",58,0)
 S:X'>0 X=5
"RTN","HBHCLKU2",59,0)
 S X=$$ASK(.HBHCSRL,X)
"RTN","HBHCLKU2",60,0)
 I HBHCGOUP=1 Q -2
"RTN","HBHCLKU2",61,0)
 Q X
"RTN","HBHCLKU2",62,0)
 ;
"RTN","HBHCLKU2",63,0)
ASK(HBHCSRL,X) ; Ask for Selection
"RTN","HBHCLKU2",64,0)
 N DTOUT,DUOUT,DIROUT
"RTN","HBHCLKU2",65,0)
 N HBHCLIT,HBHCLL,HBHCLTOT
"RTN","HBHCLKU2",66,0)
 S HBHCLL=+($G(X))
"RTN","HBHCLKU2",67,0)
 S:HBHCLL'>0 HBHCLL=5
"RTN","HBHCLKU2",68,0)
 S HBHCLIT=0,HBHCLTOT=$O(HBHCSRL(" "),-1)
"RTN","HBHCLKU2",69,0)
 Q:+HBHCLTOT'>0 "^"
"RTN","HBHCLKU2",70,0)
 K X
"RTN","HBHCLKU2",71,0)
 S:+HBHCLTOT=1 X=$$ONE(HBHCLL,.HBHCSRL)
"RTN","HBHCLKU2",72,0)
 S:+HBHCLTOT>1 X=$$MUL(.HBHCSRL,HBHCLL)
"RTN","HBHCLKU2",73,0)
 Q:$D(DTOUT) -3    ;time out
"RTN","HBHCLKU2",74,0)
 Q:$D(DIROUT) -5   ;^^
"RTN","HBHCLKU2",75,0)
 Q:$D(DUOUT) -2    ;^
"RTN","HBHCLKU2",76,0)
 Q:+($G(X))'>0 -1  ;non-selection
"RTN","HBHCLKU2",77,0)
 Q X
"RTN","HBHCLKU2",78,0)
ONE(X,HBHCSRL) ; One Entry Found
"RTN","HBHCLKU2",79,0)
 Q:+($G(HBHCLIT))>0 "^^"
"RTN","HBHCLKU2",80,0)
 N DIR,HBHCLC,HBHCLEX,HBHCLFI,HBHCLIT,HBHCLSO,HBHCLNC
"RTN","HBHCLKU2",81,0)
 N HBHCLSP,HBHCLTX,HBHCLC,Y
"RTN","HBHCLKU2",82,0)
 S HBHCLFI=$O(HBHCSRL(0)) Q:+HBHCLFI'>0 "^"  S HBHCLSP=$J(" ",25)
"RTN","HBHCLKU2",83,0)
 S HBHCLSO=$P(HBHCSRL(1,0),"^",1),HBHCLNC=$P(HBHCSRL(1,0),"^",3)
"RTN","HBHCLKU2",84,0)
 S:+HBHCLNC>0 HBHCLNC=" ("_HBHCLNC_")" S HBHCLEX=$G(HBHCSRL(1,"MENU"))
"RTN","HBHCLKU2",85,0)
 S HBHCLC=$S($D(HBHCSRL(1,"CAT")):"-",1:"")
"RTN","HBHCLKU2",86,0)
 S HBHCLTX(1)=HBHCLSO_HBHCLC_$J(" ",(9-$L(HBHCLSO)))_" "_HBHCLEX_HBHCLNC
"RTN","HBHCLKU2",87,0)
 D PR(.HBHCLTX,64) S DIR("A",1)=" One match found",DIR("A",2)=" "
"RTN","HBHCLKU2",88,0)
 S DIR("A",3)=" "_$G(HBHCLTX(1)),HBHCLC=3 I $L($G(HBHCLTX(2))) D
"RTN","HBHCLKU2",89,0)
 . S HBHCLC=HBHCLC+1,DIR("A",HBHCLC)=HBHCLSP_$G(HBHCLTX(2))
"RTN","HBHCLKU2",90,0)
 S HBHCLC=HBHCLC+1,DIR("A",HBHCLC)=" ",HBHCLC=HBHCLC+1
"RTN","HBHCLKU2",91,0)
 S DIR("A")=" OK? (Yes/No) ",DIR("B")="Yes",DIR(0)="YAO" W !
"RTN","HBHCLKU2",92,0)
 D ^DIR Q:'$D(DTOUT)&('$D(DUOUT))&('$D(DIROUT))&(+($G(Y))'>0) -1
"RTN","HBHCLKU2",93,0)
 S:X["^^"!($D(DTOUT)) HBHCLIT=1
"RTN","HBHCLKU2",94,0)
 I X["^^"!(+($G(HBHCLIT))>0) K HBHCSRL Q "^^"
"RTN","HBHCLKU2",95,0)
 S X=$S(+Y>0:$$X(1,.HBHCSRL),1:-1)
"RTN","HBHCLKU2",96,0)
 Q X
"RTN","HBHCLKU2",97,0)
MUL(HBHCSRL,Y) ; Multiple Entries Found
"RTN","HBHCLKU2",98,0)
 Q:+($G(HBHCLIT))>0 "^^"
"RTN","HBHCLKU2",99,0)
 N HBHCSRLE,HBHCLL,HBHCLMAX,HBHCLSS,HBHCLX,X
"RTN","HBHCLKU2",100,0)
 S (HBHCLMAX,HBHCLSS,HBHCLIT)=0,HBHCLL=+($G(Y)),U="^" S:+($G(HBHCLL))'>0 HBHCLL=5
"RTN","HBHCLKU2",101,0)
 S HBHCLX=$O(HBHCSRL(" "),-1),HBHCLSS=0
"RTN","HBHCLKU2",102,0)
 G:+HBHCLX=0 MULQ W ! W:+HBHCLX>1 !," ",HBHCLX," matches found"
"RTN","HBHCLKU2",103,0)
 F HBHCSRLE=1:1:HBHCLX Q:((HBHCLSS>0)&(HBHCLSS<(HBHCSRLE+1)))  Q:HBHCLIT  D  Q:HBHCLIT
"RTN","HBHCLKU2",104,0)
 . W:HBHCSRLE#HBHCLL=1 ! D MULW
"RTN","HBHCLKU2",105,0)
 . S HBHCLMAX=HBHCSRLE W:HBHCSRLE#HBHCLL=0 !
"RTN","HBHCLKU2",106,0)
 . S:HBHCSRLE#HBHCLL=0 HBHCLSS=$$MULS(HBHCLMAX,HBHCSRLE,.HBHCSRL) S:HBHCLSS["^" HBHCLIT=1
"RTN","HBHCLKU2",107,0)
 I HBHCSRLE#HBHCLL'=0,+HBHCLSS<=0 D
"RTN","HBHCLKU2",108,0)
 . W ! S HBHCLSS=$$MULS(HBHCLMAX,HBHCSRLE,.HBHCSRL) S:HBHCLSS["^" HBHCLIT=1
"RTN","HBHCLKU2",109,0)
 G MULQ
"RTN","HBHCLKU2",110,0)
 Q X
"RTN","HBHCLKU2",111,0)
MULW ; Write Multiple
"RTN","HBHCLKU2",112,0)
 N HBHCLEX,HBHCLI1,HBHCLSO,HBHCLNC,HBHCLT2,HBHCLTX S HBHCLSO=$P(HBHCSRL(+HBHCSRLE,0),"^",1)
"RTN","HBHCLKU2",113,0)
 S HBHCLNC=$P(HBHCSRL(+HBHCSRLE,0),"^",3) S:+HBHCLNC>0 HBHCLNC=" ("_HBHCLNC_")"
"RTN","HBHCLKU2",114,0)
 S HBHCLEX=$G(HBHCSRL(+HBHCSRLE,"MENU")),HBHCLTX(1)=HBHCLSO
"RTN","HBHCLKU2",115,0)
 S HBHCLTX(1)=HBHCLTX(1)_$S($D(HBHCSRL(+HBHCSRLE,"CAT")):"-",1:" ")_$J(" ",(9-$L(HBHCLSO)))_" "_HBHCLEX_HBHCLNC
"RTN","HBHCLKU2",116,0)
 D PR(.HBHCLTX,60) W !,$J(HBHCSRLE,5),".  ",$G(HBHCLTX(1))
"RTN","HBHCLKU2",117,0)
 F HBHCLI1=2:1:5 S HBHCLT2=$G(HBHCLTX(HBHCLI1)) W:$L(HBHCLT2) !,$J(" ",19),HBHCLT2
"RTN","HBHCLKU2",118,0)
 Q
"RTN","HBHCLKU2",119,0)
MULS(X,Y,HBHCSRL) ; Select from Multiple Entries
"RTN","HBHCLKU2",120,0)
 N DIR,DIRB,HBHCLFI,HBHCLHLP,HBHCLLST,HBHCLMAX,HBHCLS1 ;@#$ not sure HBHCLS1 is  neede here
"RTN","HBHCLKU2",121,0)
 Q:+($G(HBHCLIT))>0 "^^"  S HBHCLMAX=+($G(X)),HBHCLLST=+($G(Y))
"RTN","HBHCLKU2",122,0)
 Q:HBHCLMAX=0 -1 S HBHCLFI=$O(HBHCSRL(0)) Q:+HBHCLFI'>0 -1
"RTN","HBHCLKU2",123,0)
 I +($O(HBHCSRL(+HBHCLLST)))>0 D
"RTN","HBHCLKU2",124,0)
 . S DIR("A")=" Press <RETURN> for more, ""^"" to exit, or Select 1-"
"RTN","HBHCLKU2",125,0)
 . S DIR("A")=DIR("A")_HBHCLMAX_": "
"RTN","HBHCLKU2",126,0)
 I +($O(HBHCSRL(+HBHCLLST)))'>0 D
"RTN","HBHCLKU2",127,0)
 . S DIR("A")=" Select 1-"_HBHCLMAX_": "
"RTN","HBHCLKU2",128,0)
 S HBHCLHLP=" Answer must be from 1 to "
"RTN","HBHCLKU2",129,0)
 S HBHCLHLP=HBHCLHLP_HBHCLMAX_", or <Return> to continue"
"RTN","HBHCLKU2",130,0)
 S DIR("PRE")="S:X[""?"" X=""??"""
"RTN","HBHCLKU2",131,0)
 S (DIR("?"),DIR("??"))="^D MULSH^HBHCLKU2"
"RTN","HBHCLKU2",132,0)
 S DIR(0)="NAO^1:"_HBHCLMAX_":0" D ^DIR
"RTN","HBHCLKU2",133,0)
 S:X="^" HBHCGOUP=1
"RTN","HBHCLKU2",134,0)
 Q:'$D(DTOUT)&('$D(DUOUT))&('$D(DIROUT))&(+($G(Y))'>0) -1
"RTN","HBHCLKU2",135,0)
 S:X["^^"!($D(DTOUT)) HBHCLIT=1,X="^^" I X["^^"!(+($G(HBHCLIT))>0) Q "^^"
"RTN","HBHCLKU2",136,0)
 K DIR Q:$D(DTOUT)!(X[U) "^^"
"RTN","HBHCLKU2",137,0)
 Q $S(+Y>0:+Y,1:"-1")
"RTN","HBHCLKU2",138,0)
MULSH ; Select from Multiple Entries Help
"RTN","HBHCLKU2",139,0)
 I $L($G(HBHCLHLP)) W !,$G(HBHCLHLP) Q
"RTN","HBHCLKU2",140,0)
 Q
"RTN","HBHCLKU2",141,0)
MULQ ; Quit Multiple
"RTN","HBHCLKU2",142,0)
 I +HBHCLSS'>0,$G(HBHCLSS)="^" Q "^"
"RTN","HBHCLKU2",143,0)
 S X=-1 S:+($G(HBHCLIT))'>0 X=$$X(+HBHCLSS,.HBHCSRL)
"RTN","HBHCLKU2",144,0)
 Q X
"RTN","HBHCLKU2",145,0)
X(X,HBHCSRL) ; Set X and Output Array
"RTN","HBHCLKU2",146,0)
 N HBHCLEX,HBHCSRFI,HBHCLIEN,HBHCLN1,HBHCLNC,HBHCLNN,HBHCLRN,HBHCLS1,HBHCLSO
"RTN","HBHCLKU2",147,0)
 S HBHCLS1=+($G(X))
"RTN","HBHCLKU2",148,0)
 S HBHCSRFI=$O(HBHCSRL(0)) ;@#$ not used?
"RTN","HBHCLKU2",149,0)
 S HBHCLSO=$P($G(HBHCSRL(HBHCLS1,0)),"^",1),HBHCLEX=$G(HBHCSRL(HBHCLS1,"MENU"))
"RTN","HBHCLKU2",150,0)
 S HBHCLIEN=$S($D(HBHCSRL(HBHCLS1,"CAT")):"99:CAT;"_$P($G(HBHCSRL(HBHCLS1,0)),"^"),1:$P($G(HBHCSRL(HBHCLS1,"IDS",1)),"^")_";"_$P($G(HBHCSRL(HBHCLS1,0)),"^")_";"_$P($G(HBHCSRL(HBHCLS1,"LEX",1)),"^")) Q:'$L(HBHCLSO) "^"
"RTN","HBHCLKU2",151,0)
 Q:'$L(HBHCLEX) "^"  Q:+HBHCLIEN'>0 "^" S X=HBHCLIEN_"^"_HBHCLEX
"RTN","HBHCLKU2",152,0)
 S HBHCLNN="HBHCSRL("_+HBHCLS1_")",HBHCLNC="HBHCSRL("_+HBHCLS1_","
"RTN","HBHCLKU2",153,0)
 F  S HBHCLNN=$Q(@HBHCLNN) Q:'$L(HBHCLNN)!(HBHCLNN'[HBHCLNC)  D
"RTN","HBHCLKU2",154,0)
 . S HBHCLRN="HBHCLN1("_$P(HBHCLNN,"(",2,299) S @HBHCLRN=@HBHCLNN
"RTN","HBHCLKU2",155,0)
 K HBHCSRL S HBHCLNN="HBHCLN1("_+HBHCLS1_")",HBHCLNC="HBHCLN1("_+HBHCLS1_","
"RTN","HBHCLKU2",156,0)
 F  S HBHCLNN=$Q(@HBHCLNN) Q:'$L(HBHCLNN)!(HBHCLNN'[HBHCLNC)  D
"RTN","HBHCLKU2",157,0)
 . S HBHCLRN="HBHCSRL("_$P(HBHCLNN,"(",2,299),@HBHCLRN=@HBHCLNN
"RTN","HBHCLKU2",158,0)
 Q X
"RTN","HBHCLKU2",159,0)
 ; 
"RTN","HBHCLKU2",160,0)
 ; Miscellaneous
"RTN","HBHCLKU2",161,0)
CL ; Clear
"RTN","HBHCLKU2",162,0)
 K HBHCLIT
"RTN","HBHCLKU2",163,0)
 Q
"RTN","HBHCLKU2",164,0)
PR(HBHCSRL,X) ; Parse Array
"RTN","HBHCLKU2",165,0)
 N DIW,DIWF,DIWI,DIWL,DIWR,DIWT,DIWTC,DIWX,DN,I,Z,%,%D,HBHCLC,HBHCLI1,HBHCLL
"RTN","HBHCLKU2",166,0)
 K ^UTILITY($J,"W")
"RTN","HBHCLKU2",167,0)
 Q:'$D(HBHCSRL)
"RTN","HBHCLKU2",168,0)
 S HBHCLL=+($G(X))
"RTN","HBHCLKU2",169,0)
 S:+HBHCLL'>0 HBHCLL=79
"RTN","HBHCLKU2",170,0)
 S HBHCLC=+($G(HBHCSRL))
"RTN","HBHCLKU2",171,0)
 S:+($G(HBHCLC))'>0 HBHCLC=$O(HBHCSRL(" "),-1)
"RTN","HBHCLKU2",172,0)
 Q:+HBHCLC'>0
"RTN","HBHCLKU2",173,0)
 S DIWL=1,DIWF="C"_+HBHCLL
"RTN","HBHCLKU2",174,0)
 S HBHCLI1=0
"RTN","HBHCLKU2",175,0)
 F  S HBHCLI1=$O(HBHCSRL(HBHCLI1)) Q:+HBHCLI1=0  S X=$G(HBHCSRL(HBHCLI1)) D ^DIWP
"RTN","HBHCLKU2",176,0)
 K HBHCSRL
"RTN","HBHCLKU2",177,0)
 S (HBHCLC,HBHCLI1)=0
"RTN","HBHCLKU2",178,0)
 F  S HBHCLI1=$O(^UTILITY($J,"W",1,HBHCLI1)) Q:+HBHCLI1=0  D
"RTN","HBHCLKU2",179,0)
 . S HBHCSRL(HBHCLI1)=$$TM($G(^UTILITY($J,"W",1,HBHCLI1,0))," "),HBHCLC=HBHCLC+1
"RTN","HBHCLKU2",180,0)
 S:$L(HBHCLC) HBHCSRL=HBHCLC
"RTN","HBHCLKU2",181,0)
 K ^UTILITY($J,"W")
"RTN","HBHCLKU2",182,0)
 Q
"RTN","HBHCLKU2",183,0)
TM(X,Y) ; Trim Character Y - Default " "
"RTN","HBHCLKU2",184,0)
 S X=$G(X) Q:X="" X S Y=$G(Y) S:'$L(Y) Y=" "
"RTN","HBHCLKU2",185,0)
 F  Q:$E(X,1)'=Y  S X=$E(X,2,$L(X))
"RTN","HBHCLKU2",186,0)
 F  Q:$E(X,$L(X))'=Y  S X=$E(X,1,($L(X)-1))
"RTN","HBHCLKU2",187,0)
 Q X
"RTN","HBHCP25")
0^21^B328229^n/a
"RTN","HBHCP25",1,0)
HBHCP25 ;ALB/KG - HBHC ICD10 CLASS I REMEDIATION PRE/POST-INSTALL ;6/1/2012
"RTN","HBHCP25",2,0)
 ;;1.0;HOSPITAL BASED HOME CARE;**25**;NOV 01, 1993;Build 45
"RTN","HBHCP25",3,0)
 ;
"RTN","HBHCP25",4,0)
 Q
"RTN","HBHCP25",5,0)
 ;
"RTN","HBHCP25",6,0)
PRE ;
"RTN","HBHCP25",7,0)
 ;Delete Output Transform from HBHC PATIENT file (#631)
"RTN","HBHCP25",8,0)
 D BMES^XPDUTL("Deleting Output Transform from HBHC PATIENT file (#631).")
"RTN","HBHCP25",9,0)
 K ^DD(631,18,2)
"RTN","HBHCP25",10,0)
 K ^DD(631,18,2.1)
"RTN","HBHCP25",11,0)
 K ^DD(631,46,2)
"RTN","HBHCP25",12,0)
 K ^DD(631,46,2.1)
"RTN","HBHCP25",13,0)
 Q
"RTN","HBHCR19A")
0^8^B18946773^B14539231
"RTN","HBHCR19A",1,0)
HBHCR19A ;LR VAMC(IRMS)/MJT - HBHC file 632 rpt, DX info by date range, sorted by DX category, then pt name, includes: name, last four, DX (code & text), w/category subtotals & grand total, calls HBHCR19B & DX^HBHCUTL3 ;12/21/05 3:39pm
"RTN","HBHCR19A",2,0)
 ;;1.0;HOSPITAL BASED HOME CARE;**8,14,22,25**;NOV 01, 1993;Build 45
"RTN","HBHCR19A",3,0)
 ;
"RTN","HBHCR19A",4,0)
 ; This routine references the following supported ICRs:
"RTN","HBHCR19A",5,0)
 ; 5747    $$CODEC^ICDEX
"RTN","HBHCR19A",6,0)
 ; 5747    $$CSI^ICDEX
"RTN","HBHCR19A",7,0)
 ; 5681    $$CODELIST^LEX10CS
"RTN","HBHCR19A",8,0)
 ; 5679    $$IMPDATE^LEXU
"RTN","HBHCR19A",9,0)
 ;
"RTN","HBHCR19A",10,0)
 ;******************************************************************************
"RTN","HBHCR19A",11,0)
 ;******************************************************************************
"RTN","HBHCR19A",12,0)
 ;                       --- ROUTINE MODIFICATION LOG ---
"RTN","HBHCR19A",13,0)
 ;        
"RTN","HBHCR19A",14,0)
 ;PKG/PATCH    DATE        DEVELOPER    MODIFICATION
"RTN","HBHCR19A",15,0)
 ;-----------  ----------  -----------  ----------------------------------------
"RTN","HBHCR19A",16,0)
 ;HBH*1.0*25   FEB  2012   K GUPTA      Support for ICD-10 Coding System
"RTN","HBHCR19A",17,0)
 ;******************************************************************************
"RTN","HBHCR19A",18,0)
 ;******************************************************************************
"RTN","HBHCR19A",19,0)
 ;
"RTN","HBHCR19A",20,0)
 D START^HBHCUTL
"RTN","HBHCR19A",21,0)
 G:(HBHCBEG1=-1)!(HBHCEND1=-1) EXIT
"RTN","HBHCR19A",22,0)
 K ^TMP($J)
"RTN","HBHCR19A",23,0)
PROMPT1 ; Prompt user for whether to include all ICD Diagnosis Codes
"RTN","HBHCR19A",24,0)
 K DD,D0 W !!,"Do you wish to include ALL ICD Diagnosis Codes on the report" S %=2 D YN^DICN
"RTN","HBHCR19A",25,0)
 G:(%=-1) EXIT
"RTN","HBHCR19A",26,0)
 I %=1 S HBHCFLAG=1 G START2
"RTN","HBHCR19A",27,0)
 I %=0 W !!,"A 'Yes' response will include ALL ICD Diagnosis Codes.  A 'No' response will",!,"prompt for an individual ICD Diagnosis Code." G PROMPT1
"RTN","HBHCR19A",28,0)
PROMPT2 ; Prompt user for individual ICD9 Diagnosis Code
"RTN","HBHCR19A",29,0)
 W !
"RTN","HBHCR19A",30,0)
 K DIR S DIR(0)="PO^80:AEMQ"
"RTN","HBHCR19A",31,0)
 ;filter dx codes belonging to a particular coding system based on report date range
"RTN","HBHCR19A",32,0)
 S DIR("S")="I ("""_$$ICDCSYS^HBHCUTL3(HBHCBEG1,HBHCEND1)_""")[("",""_$$CSI^ICDEX(80,Y)_"","")"
"RTN","HBHCR19A",33,0)
 D ^DIR
"RTN","HBHCR19A",34,0)
 G:($D(DTOUT))!($D(DUOUT)) EXIT
"RTN","HBHCR19A",35,0)
 G:(Y=-1) START1
"RTN","HBHCR19A",36,0)
 S HBHCTMP=Y
"RTN","HBHCR19A",37,0)
PROMPT3 ; Prompt user for whether ICD9 category is to be considered a range (e.g.  Diabetes ICD9 codes range from 250 to 250.93 (as of 8/97))
"RTN","HBHCR19A",38,0)
 W !!,"Do you wish to include ALL codes within category "_$P($P(HBHCTMP,U,2),".") S %=1 D YN^DICN
"RTN","HBHCR19A",39,0)
 G:(%=-1) START1
"RTN","HBHCR19A",40,0)
 I %=0 W !!,"A 'Yes' response will include ALL ICD Diagnosis Codes withing the category.",!,"A 'No' response selects the specific ICD9 Diagnosis Code." G PROMPT3
"RTN","HBHCR19A",41,0)
 S HBHCCAT=$P($P(HBHCTMP,U,2),".")
"RTN","HBHCR19A",42,0)
 N HBHCDXIEN,HBHCDXCODE,HBHCDXCSYS
"RTN","HBHCR19A",43,0)
 S HBHCDXIEN=$P(HBHCTMP,U,1)
"RTN","HBHCR19A",44,0)
 S HBHCDXCSYS=$$CSI^ICDEX("80",HBHCDXIEN)
"RTN","HBHCR19A",45,0)
 I %=2 D  I 1
"RTN","HBHCR19A",46,0)
 . S ^TMP($J,HBHCCAT,$P(HBHCTMP,U,2))=""
"RTN","HBHCR19A",47,0)
 . S HBHCDXCODE=$$CODEC^ICDEX(80,HBHCDXIEN)
"RTN","HBHCR19A",48,0)
 . Q:+HBHCDXCODE<0
"RTN","HBHCR19A",49,0)
 . S ^TMP($J,"B",HBHCDXCODE)=""
"RTN","HBHCR19A",50,0)
 E  I %=1 D  I 1  ; Setup ^TMP($J array with range of Dx
"RTN","HBHCR19A",51,0)
 . K ^TMP("HBHCLEXDATA",$J)
"RTN","HBHCR19A",52,0)
 . I +$$CODELIST^LEX10CS2(HBHCDXCSYS,HBHCCAT_".*","HBHCLEXDATA",$$IMPDATE^LEXU(HBHCDXCSYS))>0 D
"RTN","HBHCR19A",53,0)
 . . F I=1:1:+$G(^TMP("HBHCLEXDATA",$J,0)) D
"RTN","HBHCR19A",54,0)
 . . . S HBHCCATB=$G(^TMP("HBHCLEXDATA",$J,I))
"RTN","HBHCR19A",55,0)
 . . . Q:HBHCCATB=""
"RTN","HBHCR19A",56,0)
 . . . S ^TMP($J,HBHCCAT,HBHCCATB)=""
"RTN","HBHCR19A",57,0)
 . . . S ^TMP($J,"B",HBHCCATB)=""
"RTN","HBHCR19A",58,0)
 G PROMPT2
"RTN","HBHCR19A",59,0)
START1 ; Initialization 1
"RTN","HBHCR19A",60,0)
 G:'$D(^TMP($J)) EXIT
"RTN","HBHCR19A",61,0)
START2 ; Initialization 2
"RTN","HBHCR19A",62,0)
 S %ZIS="Q",HBHCCC=0 K IOP,ZTIO,ZTSAVE D ^%ZIS G:POP EXIT
"RTN","HBHCR19A",63,0)
 I $D(IO("Q")) S ZTRTN="DQ^HBHCR19A",ZTDESC="HBPC ICD Code/Text Report",ZTSAVE("HBHC*")="",ZTSAVE("^TMP($J,")="" D ^%ZTLOAD G EXIT
"RTN","HBHCR19A",64,0)
DQ ; De-queue
"RTN","HBHCR19A",65,0)
 U IO
"RTN","HBHCR19A",66,0)
 D INITIAL^HBHCR19B,TODAY^HBHCUTL D:IO'=IO(0)!($D(IO("S"))) HDRRANGE^HBHCUTL
"RTN","HBHCR19A",67,0)
 I '$D(IO("S")),(IO=IO(0)) S HBHCCC=HBHCCC+1 W @IOF D HDRRANGE^HBHCUTL
"RTN","HBHCR19A",68,0)
LOOP ; Loop thru ^HBHC(632,"C" (appointment date) cross-ref to build report
"RTN","HBHCR19A",69,0)
 S X1=HBHCBEG1,X2=-1 D C^%DTC S HBHCAPDT=X_.9999
"RTN","HBHCR19A",70,0)
 F  S HBHCAPDT=$O(^HBHC(632,"C",HBHCAPDT)) Q:(HBHCAPDT="")!($P(HBHCAPDT,".")>HBHCEND1)  S HBHCDFN="" F  S HBHCDFN=$O(^HBHC(632,"C",HBHCAPDT,HBHCDFN)) Q:HBHCDFN=""  S HBHCNOD0=^HBHC(632,HBHCDFN,0) D:$P(HBHCNOD0,U,7)="" PROCESS
"RTN","HBHCR19A",71,0)
 W:'$D(^TMP("HBHC",$J)) !!,"No data found for Date Range selected."
"RTN","HBHCR19A",72,0)
 I $D(^TMP("HBHC",$J)) D PRTLOOP^HBHCR19B W !!,HBHCZ,!,$$ICDTEXT^HBHCUTL3(HBHCBEG1,HBHCEND1)_" Diagnosis Categories Total:  ",HBHCTOT,!,HBHCZ
"RTN","HBHCR19A",73,0)
 D ENDRPT^HBHCUTL1
"RTN","HBHCR19A",74,0)
EXIT ; Exit module
"RTN","HBHCR19A",75,0)
 D EXIT^HBHCR19B
"RTN","HBHCR19A",76,0)
 Q
"RTN","HBHCR19A",77,0)
 ;SETTMP ; Set ^TMP($J
"RTN","HBHCR19A",78,0)
 ;S ^TMP($J,HBHCCAT,HBHCCATB)="",^TMP($J,"B",$P(^ICD9(HBHCICDP,0),U))=""
"RTN","HBHCR19A",79,0)
 ;Q
"RTN","HBHCR19A",80,0)
PROCESS ; Process record & build ^TMP("HBHC",$J) global
"RTN","HBHCR19A",81,0)
 S HBHCDPT0=^DPT($P(HBHCNOD0,U),0)
"RTN","HBHCR19A",82,0)
DX ; Process Diagnosis (DX), HBHCDFN must be defined prior to call, returns code plus text in local array HBHCDX
"RTN","HBHCR19A",83,0)
 D DX^HBHCUTL3
"RTN","HBHCR19A",84,0)
 S HBHCI=0 F  S HBHCI=$O(HBHCDX(HBHCI)) Q:HBHCI'>0  S HBHCDX="HBHCDX("_HBHCI_")" D:$D(HBHCFLAG) SET I '$D(HBHCFLAG) D:$D(^TMP($J,"B",$P(@HBHCDX,HBHCSP2))) SET
"RTN","HBHCR19A",85,0)
 Q
"RTN","HBHCR19A",86,0)
SET ; Set ^TMP node
"RTN","HBHCR19A",87,0)
 ; HBH*1*22 shortens SSN to Last 4 only for display; following full SSN left intact since used as subscript
"RTN","HBHCR19A",88,0)
 S ^TMP("HBHC",$J,$P(@HBHCDX,"."),$E($P(HBHCDPT0,U),1,24),$E($P(HBHCDPT0,U,9),1,3)_"-"_$E($P(HBHCDPT0,U,9),4,5)_"-"_$E($P(HBHCDPT0,U,9),6,9),@HBHCDX)=""
"RTN","HBHCR19A",89,0)
 Q
"RTN","HBHCR19B")
0^9^B8115301^B7557416
"RTN","HBHCR19B",1,0)
HBHCR19B ;LR VAMC(IRMS)/MJT - HBHC rpt, called by HBHCR19A, entry points:  INITIAL, PRTLOOP, EXIT ;Aug 2000
"RTN","HBHCR19B",2,0)
 ;;1.0;HOSPITAL BASED HOME CARE;**8,14,22,25**;NOV 01, 1993;Build 45
"RTN","HBHCR19B",3,0)
 ;******************************************************************************
"RTN","HBHCR19B",4,0)
 ;******************************************************************************
"RTN","HBHCR19B",5,0)
 ;                       --- ROUTINE MODIFICATION LOG ---
"RTN","HBHCR19B",6,0)
 ;        
"RTN","HBHCR19B",7,0)
 ;PKG/PATCH    DATE        DEVELOPER    MODIFICATION
"RTN","HBHCR19B",8,0)
 ;-----------  ----------  -----------  ----------------------------------------
"RTN","HBHCR19B",9,0)
 ;HBH*1.0*25   FEB  2012   K GUPTA      Support for ICD-10 Coding System
"RTN","HBHCR19B",10,0)
 ;******************************************************************************
"RTN","HBHCR19B",11,0)
 ;******************************************************************************
"RTN","HBHCR19B",12,0)
 ;
"RTN","HBHCR19B",13,0)
INITIAL ; Initialize variables
"RTN","HBHCR19B",14,0)
 K ^TMP("HBHC",$J)
"RTN","HBHCR19B",15,0)
 S $P(HBHCSP2," ",3)="",(HBHCCNT,HBHCTOT)=0,$P(HBHCY,"-",81)="",HBHCHEAD="ICD Code/Diagnosis Text by Date Range"
"RTN","HBHCR19B",16,0)
 S HBHCHDR="W !,""Patient Name"",?27,""Last Four"",?41,"""_$$ICDTEXT^HBHCUTL3(HBHCBEG1,HBHCEND1)_" Code/Diagnosis Text"""
"RTN","HBHCR19B",17,0)
 S HBHCCOLM=(80-(20+$L(HBHCHEAD))\2) S:HBHCCOLM'>0 HBHCCOLM=1
"RTN","HBHCR19B",18,0)
 Q
"RTN","HBHCR19B",19,0)
PRTLOOP ; Print loop
"RTN","HBHCR19B",20,0)
 S HBHCCAT=""
"RTN","HBHCR19B",21,0)
 F  S HBHCCAT=$O(^TMP("HBHC",$J,HBHCCAT)) Q:HBHCCAT=""  D SUBTOT S HBHCNAME="" F  S HBHCNAME=$O(^TMP("HBHC",$J,HBHCCAT,HBHCNAME)) Q:HBHCNAME=""  S HBHCLST4="" F  S HBHCLST4=$O(^TMP("HBHC",$J,HBHCCAT,HBHCNAME,HBHCLST4)) Q:HBHCLST4=""  D PRTLOOP2
"RTN","HBHCR19B",22,0)
 D SUBTOT
"RTN","HBHCR19B",23,0)
 Q
"RTN","HBHCR19B",24,0)
SUBTOT ; Print subtotal from previous category
"RTN","HBHCR19B",25,0)
 I HBHCCNT>0 W !!,"Category:  "_HBHC_"  Count:  ",HBHCCNT,!,HBHCY S HBHCTOT=HBHCTOT+HBHCCNT
"RTN","HBHCR19B",26,0)
 S HBHC=HBHCCAT,HBHCCNT=0
"RTN","HBHCR19B",27,0)
 Q
"RTN","HBHCR19B",28,0)
PRTLOOP2 ; Print loop 2, PRTLOOP continued
"RTN","HBHCR19B",29,0)
 S HBHCDX="" F  S HBHCDX=$O(^TMP("HBHC",$J,HBHCCAT,HBHCNAME,HBHCLST4,HBHCDX)) Q:HBHCDX=""  D PRINT
"RTN","HBHCR19B",30,0)
 Q
"RTN","HBHCR19B",31,0)
PRINT ; Print report
"RTN","HBHCR19B",32,0)
 I ($D(ZTRTN)!(HBHCCC=0))&((IOSL-$Y)<8) W @IOF D HDRRANGE^HBHCUTL
"RTN","HBHCR19B",33,0)
 S HBHCTMP=^TMP("HBHC",$J,HBHCCAT,HBHCNAME,HBHCLST4,HBHCDX)
"RTN","HBHCR19B",34,0)
 W !,HBHCNAME,?27,$E(HBHCLST4,8,11),?41,HBHCDX
"RTN","HBHCR19B",35,0)
 S HBHCCNT=HBHCCNT+1
"RTN","HBHCR19B",36,0)
 Q
"RTN","HBHCR19B",37,0)
EXIT ; Exit module
"RTN","HBHCR19B",38,0)
 D ^%ZISC
"RTN","HBHCR19B",39,0)
 K HBHC,HBHCAPDT,HBHCBEG1,HBHCBEG2,HBHCCAT,HBHCCATB,HBHCCATE,HBHCCC,HBHCCNT,HBHCCOLM,HBHCDFN,HBHCDPT0,HBHCDX,HBHCEND1,HBHCEND2,HBHCFLAG,HBHCHDR,HBHCHEAD,HBHCI,HBHCICDP,HBHCLST4,HBHCNAME,HBHCNOD0,HBHCPAGE,HBHCSP2,HBHCTDY,HBHCTMP
"RTN","HBHCR19B",40,0)
 K HBHCTOT,HBHCY,HBHCZ,X,X1,X2,Y,^TMP("HBHC",$J),^TMP($J)
"RTN","HBHCR19B",41,0)
 Q
"RTN","HBHCRP18")
0^3^B12246188^B10520126
"RTN","HBHCRP18",1,0)
HBHCRP18 ;LR VAMC(IRMS)/MJT - HBHC rpt, file 631, All active (admitted but not D/C) cases by date range, sorted by patient name, includes: name, Last Four, adm date, primary diagnosis @ adm (code & text), & total ;12/21/05 3:31pm
"RTN","HBHCRP18",2,0)
 ;;1.0;HOSPITAL BASED HOME CARE;**6,22,24,25**;NOV 01, 1993;Build 45
"RTN","HBHCRP18",3,0)
 ;
"RTN","HBHCRP18",4,0)
 ; This routine references the following supported ICRs:
"RTN","HBHCRP18",5,0)
 ; 5747    $$CODEC^ICDEX
"RTN","HBHCRP18",6,0)
 ; 5747    $$VSTD^ICDEX
"RTN","HBHCRP18",7,0)
 ;
"RTN","HBHCRP18",8,0)
 ;******************************************************************************
"RTN","HBHCRP18",9,0)
 ;******************************************************************************
"RTN","HBHCRP18",10,0)
 ;                       --- ROUTINE MODIFICATION LOG ---
"RTN","HBHCRP18",11,0)
 ;        
"RTN","HBHCRP18",12,0)
 ;PKG/PATCH    DATE        DEVELOPER    MODIFICATION
"RTN","HBHCRP18",13,0)
 ;-----------  ----------  -----------  ----------------------------------------
"RTN","HBHCRP18",14,0)
 ;HBH*1.0*25   FEB  2012   K GUPTA      Support for ICD-10 Coding System
"RTN","HBHCRP18",15,0)
 ;******************************************************************************
"RTN","HBHCRP18",16,0)
 ;******************************************************************************
"RTN","HBHCRP18",17,0)
 ;
"RTN","HBHCRP18",18,0)
 D START^HBHCUTL
"RTN","HBHCRP18",19,0)
 G:(HBHCBEG1=-1)!(HBHCEND1=-1) EXIT
"RTN","HBHCRP18",20,0)
 S %ZIS="Q",HBHCCC=0 K IOP,ZTIO,ZTSAVE D ^%ZIS G:POP EXIT
"RTN","HBHCRP18",21,0)
 I $D(IO("Q")) S ZTRTN="DQ^HBHCRP18",ZTDESC="HBPC Active Census with ICD Code/Text Report",ZTSAVE("HBHC*")="" D ^%ZTLOAD G EXIT
"RTN","HBHCRP18",22,0)
DQ ; De-queue
"RTN","HBHCRP18",23,0)
 U IO
"RTN","HBHCRP18",24,0)
 K ^TMP("HBHC",$J)
"RTN","HBHCRP18",25,0)
 S HBHCTOT=0,$P(HBHCY,"-",133)="",$P(HBHCZ,"=",133)="",HBHCHEAD="Active Census with ICD Code/Text"
"RTN","HBHCRP18",26,0)
 S HBHCHDR="W !,""Patient Name"",?40,""Last Four"",?61,""Date"",?82,"""_$$ICDTEXT^HBHCUTL3(HBHCBEG1,HBHCEND1)_" Code"",?102,""Diagnosis Text"""
"RTN","HBHCRP18",27,0)
 S HBHCCOLM=(132-(30+$L(HBHCHEAD))\2) S:HBHCCOLM'>0 HBHCCOLM=1
"RTN","HBHCRP18",28,0)
 D TODAY^HBHCUTL D:IO'=IO(0)!($D(IO("S"))) HDR132^HBHCUTL
"RTN","HBHCRP18",29,0)
 I '$D(IO("S")),(IO=IO(0)) S HBHCCC=HBHCCC+1 W @IOF D HDR132^HBHCUTL
"RTN","HBHCRP18",30,0)
LOOP ; Loop thru ^HBHC(631) "AD" (admission date) cross-ref to build report
"RTN","HBHCRP18",31,0)
 S X1=HBHCBEG1,X2=-1 D C^%DTC S HBHCADDT=X
"RTN","HBHCRP18",32,0)
 F  S HBHCADDT=$O(^HBHC(631,"AD",HBHCADDT)) Q:(HBHCADDT="")!(HBHCADDT>HBHCEND1)  S HBHCDFN="" F  S HBHCDFN=$O(^HBHC(631,"AD",HBHCADDT,HBHCDFN)) Q:HBHCDFN=""  S HBHCNOD0=^HBHC(631,HBHCDFN,0) D:$P(HBHCNOD0,U,15)=1 PROCESS
"RTN","HBHCRP18",33,0)
 W:'$D(^TMP("HBHC",$J)) !!,"No data found for Date Range selected."
"RTN","HBHCRP18",34,0)
 I $D(^TMP("HBHC",$J)) D PRTLOOP W !!,HBHCZ,!,"Active Census Total: ",HBHCTOT,!,HBHCZ
"RTN","HBHCRP18",35,0)
 D END132^HBHCUTL1
"RTN","HBHCRP18",36,0)
EXIT ; Exit module
"RTN","HBHCRP18",37,0)
 D ^%ZISC
"RTN","HBHCRP18",38,0)
 K HBHCADDT,HBHCBEG1,HBHCBEG2,HBHCCC,HBHCCOLM,HBHCDFN,HBHCDPT0,HBHCEND1,HBHCEND2,HBHCHDR,HBHCHEAD,HBHCICDP,HBHCNAME,HBHCNOD0,HBHCPAGE,HBHCTDY,HBHCTMP,HBHCTOT,HBHCY,HBHCZ,X,X1,X2,Y,^TMP("HBHC",$J)
"RTN","HBHCRP18",39,0)
 Q
"RTN","HBHCRP18",40,0)
PROCESS ; Process record & build ^TMP("HBHC",$J) global
"RTN","HBHCRP18",41,0)
 Q:($P(HBHCNOD0,U,40)]"")&($P(HBHCNOD0,U,40)<HBHCEND1)
"RTN","HBHCRP18",42,0)
 N HBHCDXCODE,HBHCDXDESC
"RTN","HBHCRP18",43,0)
 S HBHCDPT0=^DPT($P(HBHCNOD0,U),0),HBHCICDP=$P(HBHCNOD0,U,19)
"RTN","HBHCRP18",44,0)
 I HBHCICDP]"" D  I 1
"RTN","HBHCRP18",45,0)
 . S HBHCDXCODE=$$CODEC^ICDEX(80,HBHCICDP)
"RTN","HBHCRP18",46,0)
 . S HBHCDXDESC=$$VSTD^ICDEX(HBHCICDP)
"RTN","HBHCRP18",47,0)
 S ^TMP("HBHC",$J,$P(HBHCDPT0,U),HBHCADDT)=$E($P(HBHCDPT0,U,9),6,9)_U_$G(HBHCDXCODE)_U_$G(HBHCDXDESC)
"RTN","HBHCRP18",48,0)
 Q
"RTN","HBHCRP18",49,0)
PRTLOOP ; Print loop
"RTN","HBHCRP18",50,0)
 S HBHCNAME="" F  S HBHCNAME=$O(^TMP("HBHC",$J,HBHCNAME)) Q:HBHCNAME=""  S HBHCADDT="" F  S HBHCADDT=$O(^TMP("HBHC",$J,HBHCNAME,HBHCADDT)) Q:HBHCADDT=""  D PRINT
"RTN","HBHCRP18",51,0)
 Q
"RTN","HBHCRP18",52,0)
PRINT ; Print report
"RTN","HBHCRP18",53,0)
 I ($D(ZTRTN)!(HBHCCC=0))&((IOSL-$Y)<5) W @IOF D HDR132^HBHCUTL
"RTN","HBHCRP18",54,0)
 S Y=HBHCADDT D DD^%DT
"RTN","HBHCRP18",55,0)
 S HBHCTMP=^TMP("HBHC",$J,HBHCNAME,HBHCADDT)
"RTN","HBHCRP18",56,0)
 W !,HBHCNAME,?40,$P(HBHCTMP,U),?61,Y,?82,$P(HBHCTMP,U,2),?102,$P(HBHCTMP,U,3),!,HBHCY
"RTN","HBHCRP18",57,0)
 S HBHCTOT=HBHCTOT+1
"RTN","HBHCRP18",58,0)
 Q
"RTN","HBHCRP1A")
0^2^B21729816^B19487017
"RTN","HBHCRP1A",1,0)
HBHCRP1A ;LR VAMC(IRMS)/MJT - HBHC report on files 634.1, 634.2, & 634.3, (Form 3/4/5 (A/V/D respectively) Error(s)), sorted by form, then by: clinic, date, patient & includes: pt name, last 4, form, & date, calls DQ^HBHCRP31 ;Apr 2000
"RTN","HBHCRP1A",2,0)
 ;;1.0;HOSPITAL BASED HOME CARE;**6,8,10,13,16,24,25**;NOV 01, 1993;Build 45
"RTN","HBHCRP1A",3,0)
 ;
"RTN","HBHCRP1A",4,0)
 ; This routine references the following supported ICRs:
"RTN","HBHCRP1A",5,0)
 ; 5747    $$CODEC^ICDEX
"RTN","HBHCRP1A",6,0)
 ; 5747    $$VSTD^ICDEX
"RTN","HBHCRP1A",7,0)
 ;
"RTN","HBHCRP1A",8,0)
 ;******************************************************************************
"RTN","HBHCRP1A",9,0)
 ;******************************************************************************
"RTN","HBHCRP1A",10,0)
 ;                       --- ROUTINE MODIFICATION LOG ---
"RTN","HBHCRP1A",11,0)
 ;        
"RTN","HBHCRP1A",12,0)
 ;PKG/PATCH    DATE        DEVELOPER    MODIFICATION
"RTN","HBHCRP1A",13,0)
 ;-----------  ----------  -----------  ----------------------------------------
"RTN","HBHCRP1A",14,0)
 ;HBH*1.0*25   FEB  2012   K GUPTA      Support for ICD-10 Coding System
"RTN","HBHCRP1A",15,0)
 ;******************************************************************************
"RTN","HBHCRP1A",16,0)
 ;******************************************************************************
"RTN","HBHCRP1A",17,0)
 ;
"RTN","HBHCRP1A",18,0)
 ; visits display current outpatient encounter file data, allowing easier re-entry when cleaning up errors, includes: Pt file IEN, error, provider, Dx, CPT code with Modifiers & clinic name, calls HBHCRP1B & PSEUDO^HBHCUTL3
"RTN","HBHCRP1A",19,0)
 I $P(^HBHC(631.9,1,0),U,8)]"" W $C(7),!,"File Update in progress.  Please try again later." H 3 Q
"RTN","HBHCRP1A",20,0)
 S %ZIS="Q",HBHCCC=0 K IOP,ZTIO,ZTSAVE D ^%ZIS Q:POP
"RTN","HBHCRP1A",21,0)
 I $D(IO("Q")) S ZTRTN="DQ^HBHCRP1A",ZTSAVE("HBHC*")="",ZTDESC="HBPC Form Errors Report" D ^%ZTLOAD G EXIT
"RTN","HBHCRP1A",22,0)
DQ ; De-queue
"RTN","HBHCRP1A",23,0)
 U IO
"RTN","HBHCRP1A",24,0)
 D START^HBHCRP1B
"RTN","HBHCRP1A",25,0)
LOOP ; Loop thru files 634.1, 634.2 & 634.3 "B" cross-ref
"RTN","HBHCRP1A",26,0)
 F HBHCFILE=634.1,634.2,634.3 S HBHCDPT="" F  S HBHCDPT=$O(^HBHC(HBHCFILE,"B",HBHCDPT)) Q:HBHCDPT=""  D SETUP^HBHCRP1B S HBHCIEN="" F  S HBHCIEN=$O(^HBHC(HBHCFILE,"B",HBHCDPT,HBHCIEN)) Q:HBHCIEN=""  D PROCESS
"RTN","HBHCRP1A",27,0)
 D PRTLOOP^HBHCRP1B D:$D(^HBHC(634.5,"B")) PSEUDO^HBHCUTL3
"RTN","HBHCRP1A",28,0)
 I ($D(ZTRTN)!(HBHCCC=0))&((IOSL-$Y)<12) W @IOF D HDRPAGE^HBHCUTL
"RTN","HBHCRP1A",29,0)
 D:$D(^HBHC(634.2,"B")) PCEMSG^HBHCUTL3 D ENDRPT^HBHCUTL1
"RTN","HBHCRP1A",30,0)
 ; Print Medical Foster Home (MFH) Form Errors if exist
"RTN","HBHCRP1A",31,0)
 I $D(^HBHC(634.7,"B")) W @IOF D DQ^HBHCRP31
"RTN","HBHCRP1A",32,0)
EXIT ; Exit module
"RTN","HBHCRP1A",33,0)
 D EXIT^HBHCRP1B
"RTN","HBHCRP1A",34,0)
 Q
"RTN","HBHCRP1A",35,0)
PROCESS ; Process report data
"RTN","HBHCRP1A",36,0)
 S HBHCDPT0=^DPT(HBHCDPT,0),HBHCNOD0=$S(HBHCFORM="V":$G(^HBHC(HBHCFL,HBHCIEN,0)),1:$G(^HBHC(HBHCFL,$P(^HBHC(HBHCFILE,HBHCIEN,0),U,2),0)))
"RTN","HBHCRP1A",37,0)
 ; Form 3: use Evaluation Date (field 1) if Date (field 17) null, 'reject' episodes prior to PCE patch will only have eval date
"RTN","HBHCRP1A",38,0)
 S (HBHCDAT,Y)=$P(HBHCNOD0,U,HBHCPC) S:(HBHCFORM="A")&(Y="") (HBHCDAT,Y)=$P(HBHCNOD0,U,2) D DD^%DT S HBHCDATE=$E(Y,1,18) S:HBHCDAT="" (HBHCDAT,HBHCDATE)="Missing"
"RTN","HBHCRP1A",39,0)
 S HBHCNAME=$E($P(HBHCDPT0,U),1,14),HBHCSSN=$E($P(HBHCDPT0,U,9),6,9)
"RTN","HBHCRP1A",40,0)
 S HBHCCLN="n/a" S:HBHCFORM="V" HBHCCLN=$S($P(HBHCNOD0,U,6)]"":$E($P(^SC($P(HBHCNOD0,U,6),0),U),1,18),1:"Unknown")
"RTN","HBHCRP1A",41,0)
 S HBHCMSG="" S:HBHCFORM="V" HBHCMSG=$S($P(HBHCNOD0,U,3)]"":$P(^HBHC(633.1,$P(HBHCNOD0,U,3),0),U),1:"")
"RTN","HBHCRP1A",42,0)
 I HBHCFORM="V" S HBHCOEP=$P(HBHCNOD0,U,4) D:HBHCOEP]"" OE
"RTN","HBHCRP1A",43,0)
 S ^TMP("HBHC",$J,HBHCFORM,HBHCCLN,HBHCDAT,HBHCNAME,HBHCSSN,1)="`"_HBHCDPT_U_HBHCDATE_U_HBHCMSG
"RTN","HBHCRP1A",44,0)
 Q
"RTN","HBHCRP1A",45,0)
OE ; Process Outpatient Encounter data
"RTN","HBHCRP1A",46,0)
 ; Provider, 2 pieces of info delimited by $ (Provider name & V PROVIDER  ^AUPNVPRV(9000010.06) DFN)
"RTN","HBHCRP1A",47,0)
 K HBHCPRV1,HBHCPRVL
"RTN","HBHCRP1A",48,0)
 D GETPRV^SDOE(HBHCOEP,"HBHCPRVL")
"RTN","HBHCRP1A",49,0)
 S HBHCDFN=0 F HBHCI=1:1 S HBHCDFN=$O(HBHCPRVL(HBHCDFN)) Q:HBHCDFN'>0  S HBHCPRVP=$P(HBHCPRVL(HBHCDFN),U),^TMP("HBHC",$J,HBHCFORM,HBHCCLN,HBHCDAT,HBHCNAME,HBHCSSN,2,HBHCI)=$S(HBHCPRVP]"":$P(^VA(200,HBHCPRVP,0),U)_"$"_HBHCPRVP,1:"")
"RTN","HBHCRP1A",50,0)
 ; Dx
"RTN","HBHCRP1A",51,0)
 K HBHCDXL
"RTN","HBHCRP1A",52,0)
 D GETDX^SDOE(HBHCOEP,"HBHCDXL")
"RTN","HBHCRP1A",53,0)
 S HBHCDFN=0 F HBHCI=1:1 S HBHCDFN=$O(HBHCDXL(HBHCDFN)) Q:HBHCDFN'>0  S HBHCINFO=HBHCDXL(HBHCDFN),HBHCICDP=$P(HBHCINFO,U),HBHCDX1=$S($P(HBHCINFO,U,12)="P":"* ",1:HBHCSP2) D ICD
"RTN","HBHCRP1A",54,0)
 ; CPT Code, 3 pieces of info delimited by $ (CPT Code w/Text, Quantity of CPT code & New Person file (200) DFN), must match V PROVIDER ^AUPNVPRV(9000010.06) DFN to ensure same provider
"RTN","HBHCRP1A",55,0)
 K HBHCCPTL,HBHCPRV
"RTN","HBHCRP1A",56,0)
 D GETCPT^SDOE(HBHCOEP,"HBHCCPTL")
"RTN","HBHCRP1A",57,0)
 S HBHCDFN=0 F HBHCI=1:1  S HBHCDFN=$O(HBHCCPTL(HBHCDFN)) Q:HBHCDFN'>0  S HBHCJ=0 F  S HBHCJ=$O(HBHCCPTL(HBHCDFN,HBHCJ)) Q:HBHCJ'>0  S HBHCINFO=HBHCCPTL(HBHCDFN,0),HBHCCPT=$$CPT^ICPTCOD($P(HBHCINFO,U)) D SETCPT,MOD
"RTN","HBHCRP1A",58,0)
 Q
"RTN","HBHCRP1A",59,0)
ICD ; Dx info
"RTN","HBHCRP1A",60,0)
 N DXINFO
"RTN","HBHCRP1A",61,0)
 S:HBHCICDP]"" DXINFO=$$CODEC^ICDEX(80,HBHCICDP)_"  "_$$VSTD^ICDEX(HBHCICDP)
"RTN","HBHCRP1A",62,0)
 S ^TMP("HBHC",$J,HBHCFORM,HBHCCLN,HBHCDAT,HBHCNAME,HBHCSSN,3,HBHCI)=HBHCDX1_$G(DXINFO)_$S(HBHCDX1["*":"  *  Primary Dx",1:"")
"RTN","HBHCRP1A",63,0)
 Q
"RTN","HBHCRP1A",64,0)
SETCPT ; Set TMP global with CPT info
"RTN","HBHCRP1A",65,0)
 S ^TMP("HBHC",$J,HBHCFORM,HBHCCLN,HBHCDAT,HBHCNAME,HBHCSSN,4,HBHCI)=$P(HBHCCPT,U,2)_HBHCSP3_$P(HBHCCPT,U,3)_"$"_$P(HBHCINFO,U,16)_"$"_$S($D(HBHCCPTL(HBHCDFN,12)):$P(HBHCCPTL(HBHCDFN,12),U,4),1:"")
"RTN","HBHCRP1A",66,0)
 Q
"RTN","HBHCRP1A",67,0)
MOD ; CPT Modifier loop & set
"RTN","HBHCRP1A",68,0)
 S HBHCK=0
"RTN","HBHCRP1A",69,0)
 F  S HBHCK=$O(HBHCCPTL(HBHCDFN,HBHCJ,HBHCK)) Q:HBHCK'>0  S HBHCMOD=$$MOD^ICPTMOD(HBHCCPTL(HBHCDFN,HBHCJ,HBHCK,0),"I"),^TMP("HBHC",$J,HBHCFORM,HBHCCLN,HBHCDAT,HBHCNAME,HBHCSSN,4,HBHCI,HBHCJ)=$P(HBHCMOD,U,2)_HBHCSP3_$P(HBHCMOD,U,3)
"RTN","HBHCRP1A",70,0)
 Q
"RTN","HBHCRP1B")
0^1^B18895349^B17259643
"RTN","HBHCRP1B",1,0)
HBHCRP1B ;LR VAMC(IRMS)/MJT - HBHC report on files 634.1, 634.2, & 634.3, (Form 3/4/5 (A/V/D respectively) Error(s)), called by HBHCRP1A, entry points:  START, SETUP, PRTLOOP, EXIT ;April 2000
"RTN","HBHCRP1B",2,0)
 ;;1.0;HOSPITAL BASED HOME CARE;**6,8,10,16,25**;NOV 01, 1993;Build 45
"RTN","HBHCRP1B",3,0)
 ;******************************************************************************
"RTN","HBHCRP1B",4,0)
 ;******************************************************************************
"RTN","HBHCRP1B",5,0)
 ;                       --- ROUTINE MODIFICATION LOG ---
"RTN","HBHCRP1B",6,0)
 ;        
"RTN","HBHCRP1B",7,0)
 ;PKG/PATCH    DATE        DEVELOPER    MODIFICATION
"RTN","HBHCRP1B",8,0)
 ;-----------  ----------  -----------  ----------------------------------------
"RTN","HBHCRP1B",9,0)
 ;HBH*1.0*25   FEB  2012   K GUPTA      Support for ICD-10 Coding System
"RTN","HBHCRP1B",10,0)
 ;******************************************************************************
"RTN","HBHCRP1B",11,0)
 ;******************************************************************************
"RTN","HBHCRP1B",12,0)
 ;
"RTN","HBHCRP1B",13,0)
START ; Entry point
"RTN","HBHCRP1B",14,0)
 K ^TMP("HBHC",$J)
"RTN","HBHCRP1B",15,0)
 ; Max length for HBHCHEAD = 50
"RTN","HBHCRP1B",16,0)
 S $P(HBHCSP2," ",3)="",$P(HBHCSP3," ",4)="",HBHCTEXT="   Modifier:   - ",$P(HBHCY,"-",81)="",HBHCPAGE=0,HBHCHEAD="Form Errors"
"RTN","HBHCRP1B",17,0)
 S HBHCHDR="W ""Patient"",?27,""Last"",!,""File IEN"",?10,""Patient Name"",?27,""Four"",?34,""Visit Clinic Name"",?55,""Date"",?75,""Form"""
"RTN","HBHCRP1B",18,0)
 S HBHCCOLM=(80-(30+$L(HBHCHEAD))\2) S:HBHCCOLM'>0 HBHCCOLM=1 D TODAY^HBHCUTL
"RTN","HBHCRP1B",19,0)
 Q
"RTN","HBHCRP1B",20,0)
SETUP ; Setup variables
"RTN","HBHCRP1B",21,0)
 S HBHCFORM=$S(HBHCFILE=634.1:"A",HBHCFILE=634.2:"V",1:"D"),HBHCFL=$S(HBHCFORM="V":634.2,1:631),HBHCPC=$S(HBHCFORM="D":40,HBHCFORM="V":5,1:18)
"RTN","HBHCRP1B",22,0)
 Q
"RTN","HBHCRP1B",23,0)
PRTLOOP ; Print loop
"RTN","HBHCRP1B",24,0)
 D:IO'=IO(0)!($D(IO("S"))) HDRPAGE^HBHCUTL
"RTN","HBHCRP1B",25,0)
 I '$D(IO("S")),(IO=IO(0)) S HBHCCC=HBHCCC+1 D HDRPAGE^HBHCUTL
"RTN","HBHCRP1B",26,0)
 S HBHCFORM=""
"RTN","HBHCRP1B",27,0)
 F  S HBHCFORM=$O(^TMP("HBHC",$J,HBHCFORM)) Q:HBHCFORM=""  D SETTXT S HBHCCLN="" F  S HBHCCLN=$O(^TMP("HBHC",$J,HBHCFORM,HBHCCLN)) Q:HBHCCLN=""  S HBHCDAT="" F  S HBHCDAT=$O(^TMP("HBHC",$J,HBHCFORM,HBHCCLN,HBHCDAT)) Q:HBHCDAT=""  D LOOP2
"RTN","HBHCRP1B",28,0)
 Q
"RTN","HBHCRP1B",29,0)
SETTXT ; Set text
"RTN","HBHCRP1B",30,0)
 S HBHCTXT=$S(HBHCFORM="A":"E/Adm",HBHCFORM="V":"Visit",1:"D/C")
"RTN","HBHCRP1B",31,0)
 Q
"RTN","HBHCRP1B",32,0)
LOOP2 ; Continuation of PRTLOOP
"RTN","HBHCRP1B",33,0)
 S HBHCNAME="" F  S HBHCNAME=$O(^TMP("HBHC",$J,HBHCFORM,HBHCCLN,HBHCDAT,HBHCNAME)) Q:HBHCNAME=""  S HBHCSSN="" F  S HBHCSSN=$O(^TMP("HBHC",$J,HBHCFORM,HBHCCLN,HBHCDAT,HBHCNAME,HBHCSSN)) Q:HBHCSSN=""  D PRINT
"RTN","HBHCRP1B",34,0)
 Q
"RTN","HBHCRP1B",35,0)
PRINT ; Print report
"RTN","HBHCRP1B",36,0)
 S HBHCINFO=^TMP("HBHC",$J,HBHCFORM,HBHCCLN,HBHCDAT,HBHCNAME,HBHCSSN,1)
"RTN","HBHCRP1B",37,0)
 I ($D(ZTRTN)!(HBHCCC=0))&((IOSL-$Y)<12) W @IOF D HDRPAGE^HBHCUTL
"RTN","HBHCRP1B",38,0)
 W !,$J($P(HBHCINFO,U),8),?10,HBHCNAME,?27,HBHCSSN,?34,HBHCCLN,?55,$P(HBHCINFO,U,2),"  ",?75,HBHCTXT W:$P(HBHCINFO,U,3)]"" !,"Error:  ",$P(HBHCINFO,U,3)
"RTN","HBHCRP1B",39,0)
 I HBHCFORM'="V" W !,HBHCY Q
"RTN","HBHCRP1B",40,0)
 ; provider
"RTN","HBHCRP1B",41,0)
 F HBHCI=1:1 S HBHCINFO=$G(^TMP("HBHC",$J,HBHCFORM,HBHCCLN,HBHCDAT,HBHCNAME,HBHCSSN,2,HBHCI)) Q:HBHCINFO=""  W !,"Provider:  ",$P(HBHCINFO,"$"),?54,"Encounter Prov #:",?72,$J($P(HBHCINFO,"$",2),8)
"RTN","HBHCRP1B",42,0)
 ; Dx
"RTN","HBHCRP1B",43,0)
 F HBHCI=1:1 S HBHCINFO=$G(^TMP("HBHC",$J,HBHCFORM,HBHCCLN,HBHCDAT,HBHCNAME,HBHCSSN,3,HBHCI)) Q:HBHCINFO=""  W !,"ICD:  ",HBHCINFO
"RTN","HBHCRP1B",44,0)
 ; CPT code
"RTN","HBHCRP1B",45,0)
 F HBHCI=1:1 S HBHCINFO=$G(^TMP("HBHC",$J,HBHCFORM,HBHCCLN,HBHCDAT,HBHCNAME,HBHCSSN,4,HBHCI)) Q:HBHCINFO=""  D CPT F HBHCJ=1:1 S HBHCINFO=$G(^TMP("HBHC",$J,HBHCFORM,HBHCCLN,HBHCDAT,HBHCNAME,HBHCSSN,4,HBHCI,HBHCJ)) Q:HBHCINFO=""   D MOD
"RTN","HBHCRP1B",46,0)
 W !,HBHCY
"RTN","HBHCRP1B",47,0)
 Q
"RTN","HBHCRP1B",48,0)
CPT ; Write CPT info
"RTN","HBHCRP1B",49,0)
 W !?1,"CPT:  ",$P(HBHCINFO,"$"),?45,"QTY: ",$J($P(HBHCINFO,"$",2),3),?55,"CPT Code Prov #:",?72,$J($P(HBHCINFO,"$",3),8)
"RTN","HBHCRP1B",50,0)
 Q
"RTN","HBHCRP1B",51,0)
MOD ; Write Modifier info
"RTN","HBHCRP1B",52,0)
 W !,HBHCTEXT,HBHCINFO
"RTN","HBHCRP1B",53,0)
 Q
"RTN","HBHCRP1B",54,0)
EXIT ; Exit module
"RTN","HBHCRP1B",55,0)
 D ^%ZISC
"RTN","HBHCRP1B",56,0)
 K DA,DIK,HBHCCC,HBHCCLN,HBHCCOLM,HBHCCPT,HBHCCPTL,HBHCDAT,HBHCDATE,HBHCDFN,HBHCDPT,HBHCDPT0,HBHCDX1,HBHCDXL,HBHCFILE,HBHCFL,HBHCFORM,HBHCHDR,HBHCHEAD,HBHCI,HBHCICDP,HBHCIEN,HBHCINFO,HBHCJ,HBHCK,HBHCMOD,HBHCMSG,HBHCNAME,HBHCNOD0
"RTN","HBHCRP1B",57,0)
 K HBHCOEP,HBHCPAGE,HBHCPC,HBHCPRV,HBHCPRV1,HBHCPRVL,HBHCPRVP,HBHCSP2,HBHCSP3,HBHCSSN,HBHCTDY,HBHCTEXT,HBHCTXT,HBHCY,HBHCZ,X,Y,^TMP("HBHC",$J)
"RTN","HBHCRP1B",58,0)
 Q
"RTN","HBHCRP2")
0^4^B30714112^B26747023
"RTN","HBHCRP2",1,0)
HBHCRP2 ;LR VAMC(IRMS)/MJT - HBHC report on file 631, individual patient evaluation/admission data, includes all fields, plus Case Manager ;2/5/98  15:18
"RTN","HBHCRP2",2,0)
 ;;1.0;HOSPITAL BASED HOME CARE;**1,2,5,6,9,19,22,25**;NOV 01, 1993;Build 45
"RTN","HBHCRP2",3,0)
 ;
"RTN","HBHCRP2",4,0)
 ; This routine references the following supported ICRs:
"RTN","HBHCRP2",5,0)
 ; 5747    $$CODEC^ICDEX
"RTN","HBHCRP2",6,0)
 ;
"RTN","HBHCRP2",7,0)
 ;******************************************************************************
"RTN","HBHCRP2",8,0)
 ;******************************************************************************
"RTN","HBHCRP2",9,0)
 ;                       --- ROUTINE MODIFICATION LOG ---
"RTN","HBHCRP2",10,0)
 ;        
"RTN","HBHCRP2",11,0)
 ;PKG/PATCH    DATE        DEVELOPER    MODIFICATION
"RTN","HBHCRP2",12,0)
 ;-----------  ----------  -----------  ----------------------------------------
"RTN","HBHCRP2",13,0)
 ;HBH*1.0*25   FEB  2012   K GUPTA      Support for ICD-10 Coding System
"RTN","HBHCRP2",14,0)
 ;******************************************************************************
"RTN","HBHCRP2",15,0)
 ;******************************************************************************
"RTN","HBHCRP2",16,0)
 ;
"RTN","HBHCRP2",17,0)
PROMPT ; Prompt user for patient name
"RTN","HBHCRP2",18,0)
 K DIC S DIC="^HBHC(631,",DIC(0)="AEMQZ" D ^DIC
"RTN","HBHCRP2",19,0)
 G:Y=-1 EXIT
"RTN","HBHCRP2",20,0)
 S HBHCDFN=+Y,HBHCY0=Y(0),%ZIS="Q" K IOP,ZTIO,ZTSAVE D ^%ZIS G:POP EXIT
"RTN","HBHCRP2",21,0)
 I $D(IO("Q")) S ZTRTN="DQ^HBHCRP2",ZTDESC="HBPC Patient Evaluation/Admission Data Report",ZTSAVE("HBHC*")="" D ^%ZTLOAD G EXIT
"RTN","HBHCRP2",22,0)
DQ ; De-queue
"RTN","HBHCRP2",23,0)
 U IO
"RTN","HBHCRP2",24,0)
 S $P(HBHCY,"-",81)="",HBHCHEAD="Patient Evaluation/Admission Data",HBHCCOLM=(80-(20+$L(HBHCHEAD))\2) S:HBHCCOLM'>0 HBHCCOLM=1
"RTN","HBHCRP2",25,0)
 D TODAY^HBHCUTL
"RTN","HBHCRP2",26,0)
 W ?HBHCCOLM,">>> HBPC ",HBHCHEAD," Report <<<" W !!,"Run Date: ",HBHCTDY,!!,HBHCZ
"RTN","HBHCRP2",27,0)
PROCESS ; Process record
"RTN","HBHCRP2",28,0)
 S HBHCDPT0=^DPT(+(HBHCY0),0),HBHCNOD1=$G(^HBHC(631,HBHCDFN,1))
"RTN","HBHCRP2",29,0)
 W !,"Patient Name:  ",$P(HBHCDPT0,U),?46,"Last Four:",?58,$E($P(HBHCDPT0,U,9),6,9),!,HBHCZ
"RTN","HBHCRP2",30,0)
 W !," 1.  Hospital Number:",?29,$J($S($P(^HBHC(631.9,1,0),U,5)]"":$E($P($G(^DIC(4,$P(^HBHC(631.9,1,0),U,5),99)),U),1,7),1:""),7)
"RTN","HBHCRP2",31,0)
 W ?38,"|",?41,"20.  Primary Diagnosis @ Adm:",?72,$J($S($P(HBHCY0,U,19)]"":$$CODEC^ICDEX(80,$P(HBHCY0,U,19)),1:""),8),!,HBHCY
"RTN","HBHCRP2",32,0)
 W !," 2.  Date:",?28,$S($P(HBHCY0,U,18)]"":$E($P(HBHCY0,U,18),4,5)_"-"_$E($P(HBHCY0,U,18),6,7)_"-"_$E($P(HBHCY0,U,18),2,3),$P(HBHCY0,U,2)]"":$E($P(HBHCY0,U,2),4,5)_"-"_$E($P(HBHCY0,U,2),6,7)_"-"_$E($P(HBHCY0,U,2),2,3),1:"")
"RTN","HBHCRP2",33,0)
 W ?38,"|",?41,"21.  Secondary Diagnoses @ Adm:" I HBHCNOD1]"" W:$P(HBHCNOD1,U,14)]"" !?38,"|",?46,$P(HBHCNOD1,U,14)
"RTN","HBHCRP2",34,0)
 W !,HBHCY
"RTN","HBHCRP2",35,0)
 W !," 3.  State Code:",?34,$S($P(HBHCY0,U,3)]"":$P(^DIC(5,(+^HBHC(631.8,($P(HBHCY0,U,3)),0)),0),U,3),1:""),?38,"|",?41,"22.  Vision @ Admission:",?79,$P(HBHCY0,U,20),!,HBHCY
"RTN","HBHCRP2",36,0)
 S HBHCCNTY="" S:(($P(HBHCY0,U,3)]"")&($P(HBHCY0,U,4)]"")) HBHCCNTY=$P($G(^DIC(5,(+^HBHC(631.8,($P(HBHCY0,U,3)),0)),1,$P(HBHCY0,U,4),0)),U,3)
"RTN","HBHCRP2",37,0)
 W !," 4.  County Code:",?33,HBHCCNTY,?38,"|",?46,"Hearing @ Admission:",?79,$P(HBHCY0,U,21),!,HBHCY
"RTN","HBHCRP2",38,0)
 W !," 5.  ZIP Code:",?26,$J($E($P(HBHCY0,U,5),1,5)_$S($E($P(HBHCY0,U,5),6,9)]"":"-"_$E($P(HBHCY0,U,5),6,9),1:""),10),?38,"|",?41,"23.  Expressive Communication @ Adm:",?79,$P(HBHCY0,U,22),!,HBHCY
"RTN","HBHCRP2",39,0)
 W !," 6.  Eligibility @ Evaluation:",?34,$P(HBHCY0,U,6),?38,"|",?41,"24.  Receptive Communication @ Adm:",?79,$P(HBHCY0,U,23),!,HBHCY
"RTN","HBHCRP2",40,0)
 W !," 7.  Birth Year:",?32,$S($P(HBHCDPT0,U,3):1700+$E($P(HBHCDPT0,U,3),1,3),1:""),?38,"|",?41,"25.  Bathing @ Admission:",?79,$P(HBHCY0,U,24),!,HBHCY
"RTN","HBHCRP2",41,0)
 W !," 8.  Period of Service:",?34,$S($P(HBHCY0,U,8)]"":$P($G(^HBHC(631.7,$P(HBHCY0,U,8),0)),U),1:""),?38,"|",?46,"Dressing @ Admission:",?79,$P(HBHCY0,U,25),!,HBHCY
"RTN","HBHCRP2",42,0)
 W !," 9.  Sex:",?35,$S($P(HBHCDPT0,U,2)="M":1,1:2),?38,"|",?46,"Toilet Usage @ Admission:",?79,$P(HBHCY0,U,26),!,HBHCY
"RTN","HBHCRP2",43,0)
 ; Obsolete with Race/Ethnicity Info Jan 2003 mandate; commented out historical reference  mjt
"RTN","HBHCRP2",44,0)
 ;S HBHCRC=$S($P(HBHCDPT0,U,6)]"":$P(^DIC(10,$P(HBHCDPT0,U,6),0),U,2),1:"")
"RTN","HBHCRP2",45,0)
 ;W !,"10.  Race:",?35,$S(HBHCRC=6:1,HBHCRC=4:2,(HBHCRC=1)!(HBHCRC=2):3,HBHCRC=3:4,HBHCRC=5:5,1:9),?38,"|",?46,"Transferring @ Admission:",?79,$P(HBHCY0,U,27),!,HBHCY
"RTN","HBHCRP2",46,0)
 ; Field retained until VA Form 10-0014 modified to remove field  mjt
"RTN","HBHCRP2",47,0)
 W !,"10.  Race:  Obsolete Field  Jan 2003",?38,"|",?46,"Transferring @ Admission:",?79,$P(HBHCY0,U,27),!,HBHCY
"RTN","HBHCRP2",48,0)
 W !,"11.  Marital Status @ Evaluation:",?35,$P(HBHCY0,U,11),?38,"|",?46,"Eating @ Admission:",?79,$P(HBHCY0,U,28),!,HBHCY
"RTN","HBHCRP2",49,0)
 W !,"12.  Living Arrangements @ Eval:",?35,$P(HBHCY0,U,12),?38,"|",?46,"Walking @ Admission:",?79,$P(HBHCY0,U,29),!,HBHCY
"RTN","HBHCRP2",50,0)
 W !,"13.  Last Agency Providing Care:",?35,$P(HBHCY0,U,13),?38,"|",?41,"26.  Bowel Continence @ Admission:",?79,$P(HBHCY0,U,30),!,HBHCY
"RTN","HBHCRP2",51,0)
 W !,"14.  Type of Last Care Agency:",?35,$P(HBHCY0,U,14),?38,"|",?46,"Bladder Continence @ Admission:",?79,$P(HBHCY0,U,31),!,HBHCY
"RTN","HBHCRP2",52,0)
 W !,"15.  Referred While Inpatient:",?35,$P(HBHCNOD1,U,29),?38,"|",?41,"27.  Mobility @ Admission:",?79,$P(HBHCY0,U,32),!,HBHCY
"RTN","HBHCRP2",53,0)
 W !,"16.  Admit/Reject Action:",?35,$P(HBHCY0,U,15),?38,"|",?41,"28.  Adaptive Tasks @ Admission:",?79,$P(HBHCY0,U,33),!,HBHCY
"RTN","HBHCRP2",54,0)
 W !,"17.  Reject/Withdraw Reason:",?34,$S($P(HBHCY0,U,16)]"":$P(^HBHC(631.1,$P(HBHCY0,U,16),0),U),1:""),?38,"|",?41,"29.  Behavior Problems @ Admission:",?79,$P(HBHCY0,U,34),!,HBHCY
"RTN","HBHCRP2",55,0)
 W !,"18.  Reject/Withdraw Disposition:",?35,$P(HBHCY0,U,17),?38,"|",?41,"30.  Disorientation @ Admission:",?79,$P(HBHCY0,U,35),!,HBHCY
"RTN","HBHCRP2",56,0)
 W !,"19.  Last Four:",?25,$E($P(HBHCDPT0,U,9),6,9),?38,"|",?41,"31.  Mood Disturbance @ Admission:",?79,$P(HBHCY0,U,36),!,HBHCY
"RTN","HBHCRP2",57,0)
 W !?38,"|",?41,"32.  Caregiver Limitations @ Adm:",?79,$P(HBHCY0,U,37),!,HBHCY
"RTN","HBHCRP2",58,0)
 W !?38,"|",?41,"33.  Person Completing Eval/Adm:",?76,$J($S($P(HBHCY0,U,38)]"":$P(^HBHC(631.4,$P(HBHCY0,U,38),0),U),1:""),4),!,HBHCY
"RTN","HBHCRP2",59,0)
 W !?38,"|",?46,"Date Eval/Adm Completed:",?72,$S($P(HBHCY0,U,39)]"":$E($P(HBHCY0,U,39),4,5)_"-"_$E($P(HBHCY0,U,39),6,7)_"-"_$E($P(HBHCY0,U,39),2,3),1:""),!,HBHCY
"RTN","HBHCRP2",60,0)
 W !?38,"|",?46,"Case Manager:",?76,$J($S($P(HBHCNOD1,U,13)]"":$P(^HBHC(631.4,$P(HBHCNOD1,U,13),0),U),1:""),4),!,HBHCY
"RTN","HBHCRP2",61,0)
EXIT ; Exit module
"RTN","HBHCRP2",62,0)
 D ^%ZISC
"RTN","HBHCRP2",63,0)
 K DIC,HBHCCNTY,HBHCCOLM,HBHCDFN,HBHCDPT0,HBHCHEAD,HBHCNOD1,HBHCRC,HBHCTDY,HBHCY,HBHCY0,HBHCZ,Y
"RTN","HBHCRP2",64,0)
 Q
"RTN","HBHCRP5")
0^6^B25295403^B21827854
"RTN","HBHCRP5",1,0)
HBHCRP5 ;LR VAMC(IRMS)/MJT - HBHC report on file 631, individual patient discharge data, includes all fields ;2/5/07
"RTN","HBHCRP5",2,0)
 ;;1.0;HOSPITAL BASED HOME CARE;**2,5,6,22,25**;NOV 01, 1993;Build 45
"RTN","HBHCRP5",3,0)
 ;
"RTN","HBHCRP5",4,0)
 ; This routine references the following supported ICRs:
"RTN","HBHCRP5",5,0)
 ; 5747    $$CODEC^ICDEX
"RTN","HBHCRP5",6,0)
 ;
"RTN","HBHCRP5",7,0)
 ;******************************************************************************
"RTN","HBHCRP5",8,0)
 ;******************************************************************************
"RTN","HBHCRP5",9,0)
 ;                       --- ROUTINE MODIFICATION LOG ---
"RTN","HBHCRP5",10,0)
 ;        
"RTN","HBHCRP5",11,0)
 ;PKG/PATCH    DATE        DEVELOPER    MODIFICATION
"RTN","HBHCRP5",12,0)
 ;-----------  ----------  -----------  ----------------------------------------
"RTN","HBHCRP5",13,0)
 ;HBH*1.0*25   FEB  2012   K GUPTA      Support for ICD-10 Coding System
"RTN","HBHCRP5",14,0)
 ;******************************************************************************
"RTN","HBHCRP5",15,0)
 ;******************************************************************************
"RTN","HBHCRP5",16,0)
 ;
"RTN","HBHCRP5",17,0)
PROMPT ; Prompt user for patient name
"RTN","HBHCRP5",18,0)
 K DIC S DIC="^HBHC(631,",DIC(0)="AEMQZ" D ^DIC
"RTN","HBHCRP5",19,0)
 G:Y=-1 EXIT
"RTN","HBHCRP5",20,0)
 S HBHCDFN=+Y,HBHCY0=Y(0),%ZIS="Q" K IOP,ZTIO,ZTSAVE D ^%ZIS G:POP EXIT
"RTN","HBHCRP5",21,0)
 I $D(IO("Q")) S ZTRTN="DQ^HBHCRP5",ZTDESC="HBPC Patient Discharge Data Report",ZTSAVE("HBHC*")="" D ^%ZTLOAD G EXIT
"RTN","HBHCRP5",22,0)
DQ ; De-queue
"RTN","HBHCRP5",23,0)
 U IO
"RTN","HBHCRP5",24,0)
 S $P(HBHCY,"-",81)="",HBHCHOSP=$S($P(^HBHC(631.9,1,0),U,5)]"":$E($P($G(^DIC(4,$P(^HBHC(631.9,1,0),U,5),99)),U),1,7),1:""),HBHCHEAD="Patient Discharge Data",HBHCCOLM=(80-(20+$L(HBHCHEAD))\2) S:HBHCCOLM'>0 HBHCCOLM=1
"RTN","HBHCRP5",25,0)
 D TODAY^HBHCUTL
"RTN","HBHCRP5",26,0)
 W ?HBHCCOLM,">>> HBPC ",HBHCHEAD," Report <<<" W !!,"Run Date: ",HBHCTDY,!!,HBHCZ
"RTN","HBHCRP5",27,0)
PROCESS ; Process record
"RTN","HBHCRP5",28,0)
 S HBHCDPT0=^DPT(+(HBHCY0),0),HBHCNOD1=$G(^HBHC(631,HBHCDFN,1))
"RTN","HBHCRP5",29,0)
 W !,"Patient Name:  ",$P(HBHCDPT0,U),?46,"Last Four:",?58,$E($P(HBHCDPT0,U,9),6,9),!,HBHCZ
"RTN","HBHCRP5",30,0)
 W !," 1.  Hospital Number:",?29,$J(HBHCHOSP,7),?38,"|",?41,"20.  Primary Diagnosis @ D/C:",?72,$J($S($P(HBHCY0,U,47)]"":$$CODEC^ICDEX(80,$P(HBHCY0,U,47)),1:""),8),!,HBHCY
"RTN","HBHCRP5",31,0)
 W !," 2.  Discharge Date:",?28,$S($P(HBHCY0,U,40)]"":$E($P(HBHCY0,U,40),4,5)_"-"_$E($P(HBHCY0,U,40),6,7)_"-"_$E($P(HBHCY0,U,40),2,3),1:""),?38,"|",?41,"21.  Secondary Diagnoses @ D/C:"
"RTN","HBHCRP5",32,0)
 I HBHCNOD1]"" W:$P(HBHCNOD1,U,16)]"" !?38,"|",?46,$P(HBHCNOD1,U,16)
"RTN","HBHCRP5",33,0)
 W !,HBHCY
"RTN","HBHCRP5",34,0)
 W !," 3.  Eligibility @ Discharge:",?34,$P(HBHCY0,U,41),?38,"|",?41,"22.  Vision @ Discharge:",?79,$P(HBHCY0,U,48),!,HBHCY
"RTN","HBHCRP5",35,0)
 W !," 4.  Marital Status @ Discharge:",?35,$P(HBHCY0,U,42),?38,"|",?46,"Hearing @ Discharge:",?79,$P(HBHCY0,U,49),!,HBHCY
"RTN","HBHCRP5",36,0)
 W !," 5.  Living Arrangements @ D/C:",?35,$P(HBHCY0,U,43),?38,"|",?41,"23.  Expressive Communication @ D/C:",?79,$P(HBHCY0,U,50),!,HBHCY
"RTN","HBHCRP5",37,0)
 W !," 6.  Discharge Status:",?35,$P(HBHCY0,U,44),?38,"|",?41,"24.  Receptive Communication @ D/C:",?79,$P(HBHCY0,U,51),!,HBHCY
"RTN","HBHCRP5",38,0)
 W !," 7.  Transfer Destination:",?35,$P(HBHCY0,U,45),?38,"|",?41,"25.  Bathing @ Discharge:",?79,$P(HBHCY0,U,52),!,HBHCY
"RTN","HBHCRP5",39,0)
 W !," 8.  Type of Destination Agency:",?35,$P(HBHCY0,U,46),?38,"|",?46,"Dressing @ Discharge:",?79,$P(HBHCY0,U,53),!,HBHCY
"RTN","HBHCRP5",40,0)
 W !," 9.  Cause of Death:",?38,"|",?46,"Toilet Usage @ Discharge:",?79,$P(HBHCY0,U,54) I HBHCNOD1]"" W:$P(HBHCNOD1,U,15)]"" !?5,$P(HBHCNOD1,U,15),?38,"|"
"RTN","HBHCRP5",41,0)
 W !,HBHCY
"RTN","HBHCRP5",42,0)
 W !?5,"Name:",?25,$S($P(HBHCY0,U,18)]"":$E($P(HBHCY0,U,18),4,5)_$E($P(HBHCY0,U,18),6,7)_$E($P(HBHCY0,U,18),2,3),1:"")_$E($P(HBHCDPT0,U),1,5),?38,"|",?46,"Transferring @ Discharge:",?79,$P(HBHCY0,U,55),!,HBHCY
"RTN","HBHCRP5",43,0)
 W !?5,"Last Four:",?25,$E($P(HBHCDPT0,U,9),6,9),?38,"|",?46,"Eating @ Discharge:",?79,$S($P(HBHCNOD1,U)]"":$P(HBHCNOD1,U),1:""),!,HBHCY
"RTN","HBHCRP5",44,0)
 W !?38,"|",?46,"Walking @ Discharge:",?79,$S($P(HBHCNOD1,U,2)]"":$P(HBHCNOD1,U,2),1:""),!,HBHCY
"RTN","HBHCRP5",45,0)
 W !?38,"|",?41,"26.  Bowel Continence @ Discharge:",?79,$S($P(HBHCNOD1,U,3)]"":$P(HBHCNOD1,U,3),1:""),!,HBHCY
"RTN","HBHCRP5",46,0)
 W !?38,"|",?46,"Bladder Continence @ Discharge:",?79,$S($P(HBHCNOD1,U,4)]"":$P(HBHCNOD1,U,4),1:""),!,HBHCY
"RTN","HBHCRP5",47,0)
 W !?38,"|",?41,"27.  Mobility @ Discharge:",?79,$S($P(HBHCNOD1,U,5)]"":$P(HBHCNOD1,U,5),1:""),!,HBHCY
"RTN","HBHCRP5",48,0)
 W !?38,"|",?41,"28.  Adaptive Tasks @ Discharge:",?79,$S($P(HBHCNOD1,U,6)]"":$P(HBHCNOD1,U,6),1:""),!,HBHCY
"RTN","HBHCRP5",49,0)
 W !?38,"|",?41,"29.  Behavior Problems @ Discharge:",?79,$S($P(HBHCNOD1,U,7)]"":$P(HBHCNOD1,U,7),1:""),!,HBHCY
"RTN","HBHCRP5",50,0)
 W !?38,"|",?41,"30.  Disorientation @ Discharge:",?79,$S($P(HBHCNOD1,U,8)]"":$P(HBHCNOD1,U,8),1:""),!,HBHCY
"RTN","HBHCRP5",51,0)
 W !?38,"|",?41,"31.  Mood Disturbance @ Discharge:",?79,$S($P(HBHCNOD1,U,9)]"":$P(HBHCNOD1,U,9),1:""),!,HBHCY
"RTN","HBHCRP5",52,0)
 W !?38,"|",?41,"32.  Caregiver Limitations @ D/C:",?79,$S($P(HBHCNOD1,U,10)]"":$P(HBHCNOD1,U,10),1:""),!,HBHCY
"RTN","HBHCRP5",53,0)
 W !?38,"|",?41,"33.  Person Completing Discharge:",?76,$J($S($P(HBHCNOD1,U,11)]"":$P(^HBHC(631.4,$P(HBHCNOD1,U,11),0),U),1:""),4),!,HBHCY
"RTN","HBHCRP5",54,0)
 W !?38,"|",?46,"Date Discharge Completed:",?72,$S($P(HBHCNOD1,U,12)]"":$E($P(HBHCNOD1,U,12),4,5)_"-"_$E($P(HBHCNOD1,U,12),6,7)_"-"_$E($P(HBHCNOD1,U,12),2,3),1:""),!,HBHCY
"RTN","HBHCRP5",55,0)
EXIT ; Exit module
"RTN","HBHCRP5",56,0)
 D ^%ZISC
"RTN","HBHCRP5",57,0)
 K DIC,HBHCCOLM,HBHCDFN,HBHCDPT0,HBHCHEAD,HBHCHOSP,HBHCNOD1,HBHCTDY,HBHCY,HBHCY0,HBHCZ,Y
"RTN","HBHCRP5",58,0)
 Q
"RTN","HBHCRP7")
0^7^B24145034^B20915954
"RTN","HBHCRP7",1,0)
HBHCRP7 ;LR VAMC(IRMS)/MJT - HBHC file 631 rpt, user selects: adm or D/C by date range, & sort alphabetic by pt or date of adm or D/C; includes adm/D/C date, pt name, last four, & primary DX @ adm/D/C (code & text) ;12/21/05 3:43pm
"RTN","HBHCRP7",2,0)
 ;;1.0;HOSPITAL BASED HOME CARE;**5,6,21,22,24,25**;NOV 01, 1993;Build 45
"RTN","HBHCRP7",3,0)
 ;
"RTN","HBHCRP7",4,0)
 ; This routine references the following supported ICRs:
"RTN","HBHCRP7",5,0)
 ; 5747    $$CODEC^ICDEX
"RTN","HBHCRP7",6,0)
 ; 5747    $$VSTD^ICDEX
"RTN","HBHCRP7",7,0)
 ;
"RTN","HBHCRP7",8,0)
 ;******************************************************************************
"RTN","HBHCRP7",9,0)
 ;******************************************************************************
"RTN","HBHCRP7",10,0)
 ;                       --- ROUTINE MODIFICATION LOG ---
"RTN","HBHCRP7",11,0)
 ;        
"RTN","HBHCRP7",12,0)
 ;PKG/PATCH    DATE        DEVELOPER    MODIFICATION
"RTN","HBHCRP7",13,0)
 ;-----------  ----------  -----------  ----------------------------------------
"RTN","HBHCRP7",14,0)
 ;HBH*1.0*25   FEB  2012   K GUPTA      Support for ICD-10 Coding System
"RTN","HBHCRP7",15,0)
 ;******************************************************************************
"RTN","HBHCRP7",16,0)
 ;******************************************************************************
"RTN","HBHCRP7",17,0)
 ;
"RTN","HBHCRP7",18,0)
 S DIR(0)="SB^A:Admissions;D:Discharges;",DIR("A")="Select Admissions or Discharges",DIR("?")="Enter 'A' to include Admissions on the report, 'D' to choose Discharges." D ^DIR
"RTN","HBHCRP7",19,0)
 G:$D(DIRUT) EXIT
"RTN","HBHCRP7",20,0)
 S HBHCTYPS=Y(0),HBHCTYP=$E(Y(0),1,9),HBHCXREF=$S(Y="A":"AD",1:"AC"),HBHCDXPC=$S(Y="A":19,1:47),HBHCCC=0
"RTN","HBHCRP7",21,0)
 ; Prompt user for sort preference: alphabetical by patient or date of admission or D/C
"RTN","HBHCRP7",22,0)
 K DIR S DIR(0)="SB^A:Alphabetical;D:Date of Admission or D/C",DIR("A")="Sort Alphabetically by Patient or by Date",DIR("?")="Sort report alphabetically by patient (A), or by date of admission or D/C (D)." D ^DIR
"RTN","HBHCRP7",23,0)
 G:$D(DIRUT) EXIT
"RTN","HBHCRP7",24,0)
 ; HBHCFLG exists if alphabetic sort selected
"RTN","HBHCRP7",25,0)
 S:Y="A" HBHCFLG=1
"RTN","HBHCRP7",26,0)
 D START^HBHCUTL
"RTN","HBHCRP7",27,0)
 G:(HBHCBEG1=-1)!(HBHCEND1=-1) EXIT
"RTN","HBHCRP7",28,0)
 S %ZIS="Q" K IOP,ZTIO,ZTSAVE D ^%ZIS G:POP EXIT
"RTN","HBHCRP7",29,0)
 I $D(IO("Q")) S ZTRTN="DQ^HBHCRP7",ZTDESC="HBPC "_HBHCTYP_"Alphabetic Date Range Report",ZTSAVE("HBHC*")="" D ^%ZTLOAD G EXIT
"RTN","HBHCRP7",30,0)
DQ ; De-queue
"RTN","HBHCRP7",31,0)
 U IO
"RTN","HBHCRP7",32,0)
 K ^TMP("HBHC",$J)
"RTN","HBHCRP7",33,0)
 S $P(HBHCY,"-",133)="",$P(HBHCZ,"=",133)=""
"RTN","HBHCRP7",34,0)
 S:'$D(HBHCFLG) HBHCHEAD=HBHCTYPS_" by Date Range, Date Range Sort"
"RTN","HBHCRP7",35,0)
 S:$D(HBHCFLG) HBHCHEAD=HBHCTYPS_" by Date Range, Alphabetic Sort"
"RTN","HBHCRP7",36,0)
 I $D(HBHCFLG) S HBHCHDR="W ""Patient Name"",?38,HBHCTYP_"" Date"",?60" I 1
"RTN","HBHCRP7",37,0)
 E  S HBHCHDR="W HBHCTYP_"" Date"",?19,""Patient Name"",?60"
"RTN","HBHCRP7",38,0)
 S HBHCHDR=HBHCHDR_",""Last Four"",?82,"""_$$ICDTEXT^HBHCUTL3(HBHCBEG1,HBHCEND1)_" Code"",?100,""Diagnosis Text"""
"RTN","HBHCRP7",39,0)
 S HBHCCOLM=(132-(30+$L(HBHCHEAD))\2) S:HBHCCOLM'>0 HBHCCOLM=1
"RTN","HBHCRP7",40,0)
 D TODAY^HBHCUTL
"RTN","HBHCRP7",41,0)
LOOP ; Loop thru ^HBHC(631) "AD" (admission date) or "AC" (discharge date) cross-ref to build report
"RTN","HBHCRP7",42,0)
 S X1=HBHCBEG1,X2=-1 D C^%DTC S HBHCDATE=X
"RTN","HBHCRP7",43,0)
 F  S HBHCDATE=$O(^HBHC(631,HBHCXREF,HBHCDATE)) Q:(HBHCDATE="")!(HBHCDATE>HBHCEND1)  S HBHCDFN="" F  S HBHCDFN=$O(^HBHC(631,HBHCXREF,HBHCDATE,HBHCDFN)) Q:HBHCDFN=""  S HBHCNOD0=^HBHC(631,HBHCDFN,0) D:$P(HBHCNOD0,U,15)=1 PROCESS
"RTN","HBHCRP7",44,0)
 D:IO'=IO(0)!($D(IO("S"))) HDR132^HBHCUTL
"RTN","HBHCRP7",45,0)
 I '$D(IO("S")),(IO=IO(0)) S HBHCCC=HBHCCC+1 D HDR132^HBHCUTL
"RTN","HBHCRP7",46,0)
 W:'$D(^TMP("HBHC",$J)) !!,"No "_HBHCTYPS_" found for Date Range selected."
"RTN","HBHCRP7",47,0)
 I $D(^TMP("HBHC",$J)) D PRTLOOP W !!,HBHCZ,!,"Total "_HBHCTYPS_": ",HBHCTOT,!,HBHCZ
"RTN","HBHCRP7",48,0)
 D END132^HBHCUTL1
"RTN","HBHCRP7",49,0)
EXIT ; Exit module
"RTN","HBHCRP7",50,0)
 D ^%ZISC
"RTN","HBHCRP7",51,0)
 K DIR,DIRUT,HBHCBEG1,HBHCBEG2,HBHCCOLM,HBHCCC,HBHCDATE,HBHCDFN,HBHCDPT0,HBHCDT,HBHCDXPC,HBHCEND1,HBHCEND2,HBHCFLG,HBHCHDR,HBHCHEAD,HBHCICDP,HBHCNAME,HBHCNOD0,HBHCPAGE,HBHCTDY,HBHCTMP,HBHCTOT,HBHCTYP,HBHCTYPS,HBHCXREF
"RTN","HBHCRP7",52,0)
 K HBHCY,HBHCZ,X,X1,X2,Y,^TMP("HBHC",$J)
"RTN","HBHCRP7",53,0)
 Q
"RTN","HBHCRP7",54,0)
PROCESS ; Process record & create ^TMP("HBHC",$J global
"RTN","HBHCRP7",55,0)
 S HBHCDPT0=^DPT($P(HBHCNOD0,U),0),HBHCICDP=$P(HBHCNOD0,U,HBHCDXPC)
"RTN","HBHCRP7",56,0)
 N HBHCDXCODE,HBHCDXDESC
"RTN","HBHCRP7",57,0)
 I HBHCICDP]"" D  I 1
"RTN","HBHCRP7",58,0)
 . S HBHCDXCODE=$$CODEC^ICDEX(80,HBHCICDP)
"RTN","HBHCRP7",59,0)
 . S HBHCDXDESC=$$VSTD^ICDEX(HBHCICDP)
"RTN","HBHCRP7",60,0)
 S:'$D(HBHCFLG) ^TMP("HBHC",$J,HBHCDATE,$P(HBHCDPT0,U))=$E($P(HBHCDPT0,U,9),6,9)_U_$G(HBHCDXCODE)_U_$G(HBHCDXDESC)
"RTN","HBHCRP7",61,0)
 S:$D(HBHCFLG) ^TMP("HBHC",$J,$P(HBHCDPT0,U),HBHCDATE)=$E($P(HBHCDPT0,U,9),6,9)_U_$G(HBHCDXCODE)_U_$G(HBHCDXDESC)
"RTN","HBHCRP7",62,0)
 Q
"RTN","HBHCRP7",63,0)
PRTLOOP ; Print loop
"RTN","HBHCRP7",64,0)
 S HBHCTOT=0
"RTN","HBHCRP7",65,0)
 I '$D(HBHCFLG) S HBHCDT="" F  S HBHCDT=$O(^TMP("HBHC",$J,HBHCDT)) Q:HBHCDT=""  S HBHCNAME="" F  S HBHCNAME=$O(^TMP("HBHC",$J,HBHCDT,HBHCNAME)) Q:HBHCNAME=""  D PRT
"RTN","HBHCRP7",66,0)
 I $D(HBHCFLG) S HBHCNAME="" F  S HBHCNAME=$O(^TMP("HBHC",$J,HBHCNAME)) Q:HBHCNAME=""  S HBHCDT="" F  S HBHCDT=$O(^TMP("HBHC",$J,HBHCNAME,HBHCDT)) Q:HBHCDT=""  D PRT
"RTN","HBHCRP7",67,0)
 Q
"RTN","HBHCRP7",68,0)
PRT ; Print report
"RTN","HBHCRP7",69,0)
 I ($D(ZTRTN)!(HBHCCC=0))&((IOSL-$Y)<5) W @IOF D HDR132^HBHCUTL
"RTN","HBHCRP7",70,0)
 S HBHCTOT=HBHCTOT+1
"RTN","HBHCRP7",71,0)
 S:'$D(HBHCFLG) HBHCTMP=^TMP("HBHC",$J,HBHCDT,HBHCNAME)
"RTN","HBHCRP7",72,0)
 S:$D(HBHCFLG) HBHCTMP=^TMP("HBHC",$J,HBHCNAME,HBHCDT)
"RTN","HBHCRP7",73,0)
 W:'$D(HBHCFLG) !,$E(HBHCDT,4,5)_"-"_$E(HBHCDT,6,7)_"-"_$E(HBHCDT,2,3),?19,HBHCNAME,?60,$P(HBHCTMP,U),?82,$P(HBHCTMP,U,2),?100,$P(HBHCTMP,U,3),!,HBHCY
"RTN","HBHCRP7",74,0)
 W:$D(HBHCFLG) !,HBHCNAME,?38,$E(HBHCDT,4,5)_"-"_$E(HBHCDT,6,7)_"-"_$E(HBHCDT,2,3),?60,$P(HBHCTMP,U),?82,$P(HBHCTMP,U,2),?100,$P(HBHCTMP,U,3),!,HBHCY
"RTN","HBHCRP7",75,0)
 Q
"RTN","HBHCUPD")
0^23^B46222725^B13872578
"RTN","HBHCUPD",1,0)
HBHCUPD ;LR VAMC(IRMS)/MJT - HBHC update missing data in ^HBHC(631) using ^HBHC(634.1) & ^HBHC(634.3) as input for which records/fields to update, HBHC(634.2 errors must be corrected using PCE, 634.2 data killed @ end of processing ;3/18/14
"RTN","HBHCUPD",2,0)
 ;;1.0;HOSPITAL BASED HOME CARE;**2,6,8,10,24,25**;NOV 01, 1993;Build 45
"RTN","HBHCUPD",3,0)
 ; HBHC(634.7 MFH errors must be corrected using MFH option, 634.7 killed here so validity processing can occur again
"RTN","HBHCUPD",4,0)
 ;
"RTN","HBHCUPD",5,0)
 ; Reference to $$SINFO^ICDEX supported by ICR #5747
"RTN","HBHCUPD",6,0)
 ; $$SINFO^ICDEX is also called from the [HBHC UPDATE DISCHARGE] input template
"RTN","HBHCUPD",7,0)
 ; 
"RTN","HBHCUPD",8,0)
 I $P($G(^HBHC(631.9,1,0)),U,9)]"" K ^HBHC(634.7) S ^HBHC(634.7,0)="HBHC MEDICAL FOSTER HOME ERROR(S)^634.7P"
"RTN","HBHCUPD",9,0)
 I ('$D(^HBHC(634.1,"B")))&($D(^HBHC(634.2,"B")))&('$D(^HBHC(634.3,"B")))&('$D(^HBHC(634.5,"B"))) D PCEMSG^HBHCUTL3 S HBHCFLAG=1 G PSEUDO
"RTN","HBHCUPD",10,0)
PROMPT ; Prompt user for patient name
"RTN","HBHCUPD",11,0)
 W ! K DIC S DIC="^DPT(",DIC(0)="AEMQ" D ^DIC
"RTN","HBHCUPD",12,0)
 G:Y=-1 PSEUDO
"RTN","HBHCUPD",13,0)
 S HBHCDPT=+Y
"RTN","HBHCUPD",14,0)
 I ('$D(^HBHC(634.1,"B",HBHCDPT)))&('$D(^HBHC(634.2,"B",HBHCDPT)))&('$D(^HBHC(634.3,"B",HBHCDPT)))&('$D(^HBHC(634.5,"B",HBHCDPT))) W $C(7),!!,"This patient has no records containing errors on file.",! H 3 G PROMPT
"RTN","HBHCUPD",15,0)
 F HBHCFILE=634.1,634.3 I $D(^HBHC(HBHCFILE,"B",HBHCDPT)) K DR S HBHCFORM=$S(HBHCFILE=634.1:3,1:5) S:HBHCFORM=5 HBHCCNT=1 S HBHCIEN="" F  S HBHCIEN=$O(^HBHC(HBHCFILE,"B",HBHCDPT,HBHCIEN)) Q:HBHCIEN=""  D PROCESS
"RTN","HBHCUPD",16,0)
 G PROMPT
"RTN","HBHCUPD",17,0)
PSEUDO ; Process pseudo SSN message
"RTN","HBHCUPD",18,0)
 I '$D(HBHCFLAG) D:$D(^HBHC(634.2,"B")) PCEMSG^HBHCUTL3
"RTN","HBHCUPD",19,0)
 I $D(^HBHC(634.5,"B")) D PSEUDO^HBHCUTL3 K ^HBHC(634.5) S ^HBHC(634.5,0)="HBHC PSEUDO SSN ERROR(S)^634.5P^"
"RTN","HBHCUPD",20,0)
EXIT ; Exit module
"RTN","HBHCUPD",21,0)
 ; HBHC(634.2 visit errors must be corrected using PCE software, 634.2 killed here so validity processing can occur again
"RTN","HBHCUPD",22,0)
 K ^HBHC(634.2) S ^HBHC(634.2,0)="HBHC VISIT ERROR(S)^634.2P^"
"RTN","HBHCUPD",23,0)
 K DA,DIC,DIE,DIK,DR,HBHC,HBHC12,HBHC359,HBHCAFLG,HBHCCNT,HBHCCOLM,HBHCDATE,HBHCDFLG,HBHCDFN,HBHCDIED,HBHCDPT,HBHCDR,HBHCDT,HBHCFILE,HBHCFLAG,HBHCFLG,HBHCFORM,HBHCI,HBHCIEN,HBHCJ,HBHCKEEP,HBHCL,HBHCM,HBHCMSG,HBHCNOD1,HBHCPC,HBHCQ
"RTN","HBHCUPD",24,0)
 K HBHCQ1,HBHCRFLG,HBHCSUB,HBHCTFLG,HBHCTXT,HBHCUPD,HBHCWRD1,HBHCWRD2,HBHCWRD3,HBHCY0,Y
"RTN","HBHCUPD",25,0)
 Q
"RTN","HBHCUPD",26,0)
PROCESS ; Process errors via DIE
"RTN","HBHCUPD",27,0)
 N HBHCDRA,HBHCDRD,HBHC39,HBHC46
"RTN","HBHCUPD",28,0)
 S HBHCDRA="" ;Test for ICD-9 second ^DIE call
"RTN","HBHCUPD",29,0)
 S DA=$P(^HBHC(HBHCFILE,HBHCIEN,0),U,2),HBHCTXT=$S(HBHCFORM=3:"Evaluation/Admission",1:"Discharge")
"RTN","HBHCUPD",30,0)
 L +^HBHC(631,DA):0 I '$T W $C(7),!!,"Another user is editing this "_HBHCTXT_" entry.",! H 3 Q
"RTN","HBHCUPD",31,0)
 ; If Pri DX @ Admission (#18) call DXCHKA to adjust for ICD-9/ICD-10
"RTN","HBHCUPD",32,0)
 I HBHCFORM=3 D
"RTN","HBHCUPD",33,0)
 .S (DR,HBHCDR)=^HBHC(HBHCFILE,HBHCIEN,1)
"RTN","HBHCUPD",34,0)
 .I DR["18;" D DXCHKA1(DA)
"RTN","HBHCUPD",35,0)
 ; For Discharges check for #39 and/or #46
"RTN","HBHCUPD",36,0)
 I HBHCFORM=5 D
"RTN","HBHCUPD",37,0)
 .; Call DXCHKD1 now to update the necessary fields in the Global which is indexed sequentially
"RTN","HBHCUPD",38,0)
 .; and adjust DR string;
"RTN","HBHCUPD",39,0)
 .; If DISCHARGE DATE #39 AND PRI DX @ DISCHARGE #46 are being edited, #46 and all remaining fields
"RTN","HBHCUPD",40,0)
 .; will be saved off in HBHCDRD and prompted for in second ^DIE call after #39 was edited in first ^DIE call
"RTN","HBHCUPD",41,0)
 .D DXCHKD1(DA,HBHCIEN)
"RTN","HBHCUPD",42,0)
 .S HBHCSUB=0
"RTN","HBHCUPD",43,0)
 .; Load fields to be edited from #634.3 into DR array
"RTN","HBHCUPD",44,0)
 .F  S HBHCSUB=$O(^HBHC(HBHCFILE,HBHCIEN,HBHCSUB)) Q:HBHCSUB'>0  D SET
"RTN","HBHCUPD",45,0)
 K DIE S DIE="^HBHC(631,",DIE("NO^")="OUTOK"
"RTN","HBHCUPD",46,0)
 S HBHC=HBHCIEN,HBHCPC=$S(HBHCFORM=5:40,1:18),HBHCCOLM=$S(HBHCFORM=3:14,1:19)
"RTN","HBHCUPD",47,0)
 S HBHCDT=$P($G(^HBHC(631,DA,0)),U,HBHCPC) S:HBHCDT="" HBHCDT=$P($G(^HBHC(631,DA,0)),U,2) S HBHCDATE=$S(HBHCDT]"":$E(HBHCDT,4,5)_"-"_$E(HBHCDT,6,7)_"-"_$E(HBHCDT,2,3),1:"")
"RTN","HBHCUPD",48,0)
 W !!!?HBHCCOLM,"===  Editing "_$S(HBHCDATE]"":HBHCDATE_" "_HBHCTXT,1:HBHCTXT)_" data  ===",!
"RTN","HBHCUPD",49,0)
 D ^DIE K DR,ICDVDT,ICDSYS,ICDFMT,HBHCDFN
"RTN","HBHCUPD",50,0)
 ; Admissions - Check for second ^DIE call to process #18
"RTN","HBHCUPD",51,0)
 I HBHCFORM=3,HBHCDRA'="" D
"RTN","HBHCUPD",52,0)
 .; Load remaining Admissions fields into DR
"RTN","HBHCUPD",53,0)
 .D DXCHKA2(DA)
"RTN","HBHCUPD",54,0)
 .K DIE S DIE="^HBHC(631,",DIE("NO^")="OUTOK"
"RTN","HBHCUPD",55,0)
 .D ^DIE
"RTN","HBHCUPD",56,0)
 .K DR,ICDVDT,ICDSYS,ICDFMT,HBHCDFN
"RTN","HBHCUPD",57,0)
 ; Discharges - Check for second ^DIE call to process #46
"RTN","HBHCUPD",58,0)
 I HBHCFORM=5,$D(HBHCDRD)=10 D
"RTN","HBHCUPD",59,0)
 .; Load remaining Discharge fields into DR
"RTN","HBHCUPD",60,0)
 .D DXCHKD2(DA)
"RTN","HBHCUPD",61,0)
 .K DIE S DIE="^HBHC(631,",DIE("NO^")="OUTOK"
"RTN","HBHCUPD",62,0)
 .D ^DIE
"RTN","HBHCUPD",63,0)
 .K DR,ICDVDT,ICDSYS,ICDFMT
"RTN","HBHCUPD",64,0)
 ; Admit/Reject Action branch
"RTN","HBHCUPD",65,0)
 S:HBHCDR["14;" DR="K HBHCQ;S X=$P(^HBHC(631,DA,0),U,15);D ACTION^HBHCUTL;15;16;I $D(HBHCQ) K HBHCQ S Y=17;"_$S($$ICD^HBHCUPD:"18:36",1:"D ADMDX^HBHCLKU1;19:36")
"RTN","HBHCUPD",66,0)
 ; Discharge Status branch
"RTN","HBHCUPD",67,0)
 S:HBHCDR["43;" DR="[HBHC UPDATE DISCHARGE]"
"RTN","HBHCUPD",68,0)
 I $D(DR) I '$D(Y) I (DR["D ACTION")!(DR["[HBHC UPDATE") S HBHCDFN=DA,HBHCUPD=1 D ^DIE K HBHCUPD
"RTN","HBHCUPD",69,0)
 L -^HBHC(631,DA) I '$D(HBHCKEEP) I '$D(Y) K DIK S DIK="^HBHC(HBHCFILE,",DA=HBHC D ^DIK K HBHCKEEP
"RTN","HBHCUPD",70,0)
 Q
"RTN","HBHCUPD",71,0)
SET ; Set DR string(s) for Discharge data
"RTN","HBHCUPD",72,0)
 S:$D(DR) DR(1,631,HBHCCNT)=^HBHC(HBHCFILE,HBHCIEN,HBHCSUB),HBHCCNT=HBHCCNT+1
"RTN","HBHCUPD",73,0)
 S:'$D(DR) (DR,HBHCDR)=^HBHC(HBHCFILE,HBHCIEN,HBHCSUB)
"RTN","HBHCUPD",74,0)
 Q
"RTN","HBHCUPD",75,0)
ICD() ;
"RTN","HBHCUPD",76,0)
 ; Set ICDVDT based on whether process Admission or Discharge
"RTN","HBHCUPD",77,0)
 S ICDVDT=$S(HBHCDR["14;":$P(^HBHC(631,DA,0),U,18),1:$P(^HBHC(631,DA,0),U,40))
"RTN","HBHCUPD",78,0)
 S ICDSYS=+$$SINFO^ICDEX("DIAG",ICDVDT)
"RTN","HBHCUPD",79,0)
 I ICDSYS=1 S ICDFMT=1
"RTN","HBHCUPD",80,0)
 Q $S(ICDSYS=1:1,1:0)
"RTN","HBHCUPD",81,0)
 ;
"RTN","HBHCUPD",82,0)
DXCHKA1(DA) ; Admissions - Check for DX codes and adjust DR as needed for first ^DIE call
"RTN","HBHCUPD",83,0)
 N HBHCFND,HBHCIDX
"RTN","HBHCUPD",84,0)
 S HBHCFND=0
"RTN","HBHCUPD",85,0)
 ; If no DATE field, Determine if 9 or 10 lookup needed based on current value in DATE
"RTN","HBHCUPD",86,0)
 I DR'["17;" D  Q 
"RTN","HBHCUPD",87,0)
 .D GETDT(DA)
"RTN","HBHCUPD",88,0)
 .I ICDSYS=1 Q
"RTN","HBHCUPD",89,0)
 .F HBHCIDX=1:1 Q:$P(DR,";",HBHCIDX)=""  D  Q:HBHCFND
"RTN","HBHCUPD",90,0)
 ..Q:$P(DR,";",HBHCIDX)'=18
"RTN","HBHCUPD",91,0)
 ..S $P(DR,";",HBHCIDX)="D ADMDX^HBHCLKU1",HBHCDFN=DA,HBHCFND=1
"RTN","HBHCUPD",92,0)
 ; If DATE field included, break DR into 2 separate calls
"RTN","HBHCUPD",93,0)
 S HBHCDRA=$P(DR,"17;",2)_";"
"RTN","HBHCUPD",94,0)
 S DR=$P(DR,"17;",1)_"17;"
"RTN","HBHCUPD",95,0)
 Q
"RTN","HBHCUPD",96,0)
 ;
"RTN","HBHCUPD",97,0)
DXCHKA2(DA) ; Admissions - adjust DR as needed for second ^DIE call
"RTN","HBHCUPD",98,0)
 N HBHCFND,HBHCIDX
"RTN","HBHCUPD",99,0)
 ; Get current DATE to use for Date of Interest
"RTN","HBHCUPD",100,0)
 D GETDT(DA)
"RTN","HBHCUPD",101,0)
 ; For ICD-9 era records use FileMan
"RTN","HBHCUPD",102,0)
 I ICDSYS=1 S DR=HBHCDRA Q
"RTN","HBHCUPD",103,0)
 ; For ICD-10 era records use ADMDX^HBHCLKU1
"RTN","HBHCUPD",104,0)
 F HBHCIDX=1:1 Q:$P(HBHCDRA,";",HBHCIDX)=""  D  Q:HBHCFND
"RTN","HBHCUPD",105,0)
 .Q:$P(HBHCDRA,";",HBHCIDX)'="18"
"RTN","HBHCUPD",106,0)
 .S $P(HBHCDRA,";",HBHCIDX)="D ADMDX^HBHCLKU1",HBHCDFN=DA,HBHCFND=1,DR=HBHCDRA
"RTN","HBHCUPD",107,0)
 Q
"RTN","HBHCUPD",108,0)
 ;
"RTN","HBHCUPD",109,0)
DXCHKD1(DA,HBHCIEN) ; Discharges - Check for DX codes as adjust as needed for first ^DIE call
"RTN","HBHCUPD",110,0)
 ; DA = #631 IEN
"RTN","HBHCUPD",111,0)
 ; HBHCIEN = #634.3 IEN
"RTN","HBHCUPD",112,0)
 ; Loop through DR looking for DISCHARGE DATE #39 & PRI DX @ DISCHARGE (#46).
"RTN","HBHCUPD",113,0)
 ; Fields are stored in numerical sequence so if DISCHARGE DATE (#39) is defined, it will be processed first
"RTN","HBHCUPD",114,0)
 N HBHCCNT,HBHCDATA,HBHCIDX1,HBHCIDX2
"RTN","HBHCUPD",115,0)
 S HBHCCNT=0,(HBHC39,HBHC46)=""
"RTN","HBHCUPD",116,0)
 F  S HBHCCNT=$O(^HBHC(634.3,HBHCIEN,HBHCCNT)) Q:'HBHCCNT!((HBHC39'="")&(HBHC46'=""))  D
"RTN","HBHCUPD",117,0)
 .S HBHCDATA=^HBHC(634.3,HBHCIEN,HBHCCNT)
"RTN","HBHCUPD",118,0)
 .I HBHCDATA["39;" S HBHC39=$$FNDIT(39,HBHCCNT,HBHCDATA) ; Line^Piece
"RTN","HBHCUPD",119,0)
 .; Since the DX @ Discharge can be defaulted, we can't check for 46;
"RTN","HBHCUPD",120,0)
 .; Since the DX @ Discharge can be the first field we can't check for ;46 so just check for 46
"RTN","HBHCUPD",121,0)
 .I HBHCDATA["46" S HBHC46=$$FNDIT(46,HBHCCNT,HBHCDATA) ; Line^Piece
"RTN","HBHCUPD",122,0)
 ; QUIT If neither #39 or #46 are being edited 
"RTN","HBHCUPD",123,0)
 Q:HBHC39=""&(HBHC46="")
"RTN","HBHCUPD",124,0)
 ; QUIT If #39 edited but #46 not edited
"RTN","HBHCUPD",125,0)
 Q:HBHC39'=""&(HBHC46="")
"RTN","HBHCUPD",126,0)
 ; If no #39 but #46 check date in #39 as adjust as needed
"RTN","HBHCUPD",127,0)
 I HBHC39="",HBHC46'="" D  Q
"RTN","HBHCUPD",128,0)
 .D GETDT(DA)
"RTN","HBHCUPD",129,0)
 .; If ICD-9 era data, special lookup vars are now set
"RTN","HBHCUPD",130,0)
 .Q:ICDSYS=1
"RTN","HBHCUPD",131,0)
 .; If ICD-10 era date update DR to call DCDX^HBHCLKU1
"RTN","HBHCUPD",132,0)
 .S $P(^HBHC(634.3,HBHCIEN,$P(HBHC46,U,1)),";",$P(HBHC46,U,2))="D DCDX^HBHCLKU1(DA)"
"RTN","HBHCUPD",133,0)
 .Q
"RTN","HBHCUPD",134,0)
 ; If #39 & #46 are in the same Node, OR in different Nodes, take everything from #46 to 
"RTN","HBHCUPD",135,0)
 ; end of Node(s) and store it in HBHCDRD until after #39 is set in first ^DIE call
"RTN","HBHCUPD",136,0)
 S HBHCDRD(1,631,$P(HBHC46,U,1))=$P(^HBHC(634.3,HBHCIEN,$P(HBHC46,U,1)),";",$P(HBHC46,U,2),999)
"RTN","HBHCUPD",137,0)
 ; Delete everything from #46 to end of ^HBHC node
"RTN","HBHCUPD",138,0)
 S ^HBHC(634.3,HBHCIEN,$P(HBHC46,U,1))=$P(^HBHC(634.3,HBHCIEN,$P(HBHC46,U,1)),";",1,$P(HBHC46,U,2)-1)
"RTN","HBHCUPD",139,0)
 ; Save off any other Nodes after Node containing #46
"RTN","HBHCUPD",140,0)
 F HBHCIDX=$P(HBHC46,U,1)+1:1 Q:'$D(^HBHC(634.3,HBHCIEN,HBHCIDX))  D
"RTN","HBHCUPD",141,0)
 .S HBHCDRD(1,631,HBHCIDX)=^HBHC(634.3,HBHCIEN,HBHCIDX)
"RTN","HBHCUPD",142,0)
 .; Delete Node in #634.3 prior to first ^DIE call
"RTN","HBHCUPD",143,0)
 .K ^HBHC(634.3,HBHCIEN,HBHCIDX)
"RTN","HBHCUPD",144,0)
 Q
"RTN","HBHCUPD",145,0)
 ;
"RTN","HBHCUPD",146,0)
DXCHKD2(DA) ; Discharges - Load fields in HBHCDRD into DR for second ^DIE call
"RTN","HBHCUPD",147,0)
 ; Determine Date of Interest based on current value in #39
"RTN","HBHCUPD",148,0)
 D GETDT(DA)
"RTN","HBHCUPD",149,0)
 ; For ICD-9 era dates, key DX lookup variables are now set so we just need to reload DR
"RTN","HBHCUPD",150,0)
 ; For ICD-10 era dates, update HBHCDRD to call DCDX^HBHCLKU1
"RTN","HBHCUPD",151,0)
 I ICDSYS=30 S $P(HBHCDRD(1,631,$P(HBHC46,U,1)),";",1)="D DCDX^HBHCLKU1(DA)"
"RTN","HBHCUPD",152,0)
 ; Restore DR from HBHCDRD and re-index to start at 1
"RTN","HBHCUPD",153,0)
 S HBHCIDX2=1
"RTN","HBHCUPD",154,0)
 F HBHCIDX1=$P(HBHC46,U,1):1 Q:'$D(HBHCDRD(1,631,HBHCIDX1))  D
"RTN","HBHCUPD",155,0)
 .S:$D(DR) DR(1,631,HBHCIDX2)=HBHCDRD(1,631,HBHCIDX1),HBHCIDX2=HBHCIDX2+1
"RTN","HBHCUPD",156,0)
 .S:'$D(DR) DR=HBHCDRD(1,631,HBHCIDX1)
"RTN","HBHCUPD",157,0)
 Q
"RTN","HBHCUPD",158,0)
FNDIT(HBHCFLD,HBHCCNT,HBHCDATA) ; 
"RTN","HBHCUPD",159,0)
 ; Find target HBHCFLD in string HBHBDATA
"RTN","HBHCUPD",160,0)
 ; Return either HBHC39 or HBHC46 = Line^Piece
"RTN","HBHCUPD",161,0)
 N HBHCI,HBHCFND
"RTN","HBHCUPD",162,0)
 S HBHCFND=""
"RTN","HBHCUPD",163,0)
 F HBHCI=1:1 Q:($P(HBHCDATA,";",HBHCI)="")!HBHCFND  D
"RTN","HBHCUPD",164,0)
 .Q:$P(HBHCDATA,";",HBHCI)'[HBHCFLD
"RTN","HBHCUPD",165,0)
 .S @$S(HBHCFLD=39:"HBHC39",1:"HBHC46")=HBHCCNT_U_HBHCI,HBHCFND=1
"RTN","HBHCUPD",166,0)
 Q $S(HBHCFLD=39:HBHC39,1:HBHC46)
"RTN","HBHCUPD",167,0)
 ;
"RTN","HBHCUPD",168,0)
GETDT(DA) ;
"RTN","HBHCUPD",169,0)
 S ICDVDT=$P(^HBHC(631,DA,0),U,18)
"RTN","HBHCUPD",170,0)
 S ICDSYS=+$$SINFO^ICDEX("DIAG",ICDVDT)
"RTN","HBHCUPD",171,0)
 I ICDSYS=1 S ICDFMT=1
"RTN","HBHCUPD",172,0)
 Q
"RTN","HBHCUTL")
0^14^B31187675^B28029686
"RTN","HBHCUTL",1,0)
HBHCUTL ;LR VAMC(IRMS)/MJT - HBHC Utility module, Entry points:  ACTION, STATUS, START, TODAY, HDRPAGE, HDRRANGE, HDR132, HDR132NR, HDRXPAGE ;Mar 2000
"RTN","HBHCUTL",2,0)
 ;;1.0;HOSPITAL BASED HOME CARE;**2,6,8,16,24,25**;NOV 01, 1993;Build 45
"RTN","HBHCUTL",3,0)
 ;******************************************************************************
"RTN","HBHCUTL",4,0)
 ;******************************************************************************
"RTN","HBHCUTL",5,0)
 ;                       --- ROUTINE MODIFICATION LOG ---
"RTN","HBHCUTL",6,0)
 ;        
"RTN","HBHCUTL",7,0)
 ;PKG/PATCH    DATE        DEVELOPER    MODIFICATION
"RTN","HBHCUTL",8,0)
 ;-----------  ----------  -----------  ----------------------------------------
"RTN","HBHCUTL",9,0)
 ;HBH*1.0*25   APR  2012   K GUPTA      Support for ICD-10 Coding System
"RTN","HBHCUTL",10,0)
 ;******************************************************************************
"RTN","HBHCUTL",11,0)
 ;******************************************************************************
"RTN","HBHCUTL",12,0)
 ;
"RTN","HBHCUTL",13,0)
ACTION ; Set appropriate fields/variables for Admit/Reject Action
"RTN","HBHCUTL",14,0)
 K HBHCQ,HBHCKEEP
"RTN","HBHCUTL",15,0)
 S HBHCY0=^HBHC(631,HBHCDFN,0)
"RTN","HBHCUTL",16,0)
 S:X="" Y=$S($D(HBHCUPD):0,1:87) S:X=1 Y="@2" S:X=2 HBHCQ=1  ;changed to placeholder @2 from field 18
"RTN","HBHCUTL",17,0)
 S HBHCAFLG=0 F HBHCI=19:1:37 Q:HBHCAFLG  S:$P(HBHCY0,U,HBHCI)]"" HBHCAFLG=1
"RTN","HBHCUTL",18,0)
 S HBHCRFLG=0 I ($P(HBHCY0,U,16)]"")!($P(HBHCY0,U,17)]"") S HBHCRFLG=1
"RTN","HBHCUTL",19,0)
 Q:(HBHCAFLG=0)&(HBHCRFLG=0)
"RTN","HBHCUTL",20,0)
 Q:(HBHCRFLG=0)&(X=1)
"RTN","HBHCUTL",21,0)
 Q:(HBHCAFLG=0)&(X=2)
"RTN","HBHCUTL",22,0)
 S HBHCWRD1=$S(HBHCAFLG=1:"admission",1:"rejection")
"RTN","HBHCUTL",23,0)
 S HBHCWRD2=$S(X="":"to 'Delete'",X=2:"'Reject' in",1:"'Admit' in")
"RTN","HBHCUTL",24,0)
 S HBHCWRD3=$S(HBHCAFLG=1:"1 for Admit",1:"2 for Reject")
"RTN","HBHCUTL",25,0)
 D PROCADM I %=1 D:HBHCAFLG ADMIT S:HBHCRFLG $P(^HBHC(631,HBHCDFN,0),U,16)="",$P(^HBHC(631,HBHCDFN,0),U,17)=""
"RTN","HBHCUTL",26,0)
 Q
"RTN","HBHCUTL",27,0)
PROCADM ; Process 'Delete' & 'Reject' responses
"RTN","HBHCUTL",28,0)
 W $C(7),!!,"This record contains ",HBHCWRD1," data.  Are you sure you want ",HBHCWRD2," the",!,"Admit/Reject Action field  ('Yes' will delete the ",HBHCWRD1," data)" S %=2 D YN^DICN
"RTN","HBHCUTL",29,0)
 W ! W:%=0 !!,"Admit/Reject Action field must either contain ",HBHCWRD3," or the ",HBHCWRD1,!,"data MUST be deleted by responding 'Yes'.",!!
"RTN","HBHCUTL",30,0)
 I %'=1 S Y=$S($D(HBHCUPD):0,1:14) S:$D(HBHCUPD) HBHCKEEP=1
"RTN","HBHCUTL",31,0)
 Q
"RTN","HBHCUTL",32,0)
ADMIT ; Set appropriate fields = null
"RTN","HBHCUTL",33,0)
 F HBHCJ=19:1:37 S $P(^HBHC(631,HBHCDFN,0),U,HBHCJ)=""
"RTN","HBHCUTL",34,0)
 S $P(^HBHC(631,HBHCDFN,1),U,14)=""
"RTN","HBHCUTL",35,0)
 Q
"RTN","HBHCUTL",36,0)
STATUS ; Set appropriate fields/variables for Discharge Status
"RTN","HBHCUTL",37,0)
 K HBHCQ,HBHCQ1,HBHCKEEP
"RTN","HBHCUTL",38,0)
 S HBHC12="^1^2^",HBHC359="^3^5^9^",HBHCNOD1=$G(^HBHC(631,HBHCDFN,1)),HBHCY0=^HBHC(631,HBHCDFN,0)
"RTN","HBHCUTL",39,0)
 S:X="" Y=$S($D(HBHCUPD):0,1:65) S:HBHC12[(U_X_U) HBHCQ1=1,Y=44 S:HBHC359[(U_X_U) Y="@1" S:X=4 HBHCQ=1,Y=$S($D(HBHCUPD):0,1:69)
"RTN","HBHCUTL",40,0)
 S HBHCTFLG=0 S:($P(HBHCY0,U,45)]"")!($P(HBHCY0,U,46)]"") HBHCTFLG=1
"RTN","HBHCUTL",41,0)
 S HBHCDIED=0 S:$P($G(^HBHC(631,HBHCDFN,1)),U,15)]"" HBHCDIED=1
"RTN","HBHCUTL",42,0)
 S HBHCDFLG=0 F HBHCL=47:1:55 Q:HBHCDFLG  S:$P(HBHCY0,U,HBHCL)]"" HBHCDFLG=1
"RTN","HBHCUTL",43,0)
 I HBHCNOD1]"" F HBHCM=1:1:10 Q:HBHCDFLG  S:$P(HBHCNOD1,U,HBHCM)]"" HBHCDFLG=1
"RTN","HBHCUTL",44,0)
 Q:(HBHCTFLG=0)&(HBHCDIED=0)&(HBHCDFLG=0)
"RTN","HBHCUTL",45,0)
 Q:(HBHC12[(U_X_U))&(HBHCDIED=0)
"RTN","HBHCUTL",46,0)
 Q:(X=4)&(HBHCTFLG=0)&(HBHCDFLG=0)
"RTN","HBHCUTL",47,0)
 Q:(HBHC359[(U_X_U))&(HBHCTFLG=0)&(HBHCDIED=0)
"RTN","HBHCUTL",48,0)
 S HBHCWRD1=$S(HBHCTFLG:"transfer",HBHCDIED:"deceased",1:"discharge")
"RTN","HBHCUTL",49,0)
 S HBHCWRD2=$S(X="":"to 'Delete'",HBHC12[(U_X_U):"'Transfer' in",X=4:"'Died' in",1:"'Discharge' in")
"RTN","HBHCUTL",50,0)
 S HBHCWRD3=$S(HBHCTFLG:"1 or 2 for Transfer",HBHCDIED:"4 for Died on HBHC",1:"3, 5 or 9 for Discharge")
"RTN","HBHCUTL",51,0)
 D PROCDIS Q:%'=1
"RTN","HBHCUTL",52,0)
 S:HBHCTFLG $P(^HBHC(631,HBHCDFN,0),U,45)="",$P(^HBHC(631,HBHCDFN,0),U,46)=""
"RTN","HBHCUTL",53,0)
 D:(HBHCDFLG)&((X=4)!(X="")) DISCHRG
"RTN","HBHCUTL",54,0)
 S:HBHCDIED $P(^HBHC(631,HBHCDFN,1),U,15)=""
"RTN","HBHCUTL",55,0)
 Q
"RTN","HBHCUTL",56,0)
PROCDIS ; Process 'Delete', '1 or 2', '4', & '3 or 5 or 9' responses
"RTN","HBHCUTL",57,0)
 W $C(7),!!,"This record contains ",HBHCWRD1," data.  Are you sure you want ",HBHCWRD2," the",!,"Discharge Status field  ('Yes' will delete the ",HBHCWRD1," data)" S %=2 D YN^DICN
"RTN","HBHCUTL",58,0)
 W ! W:%=0 !!,"Discharge Status field must contain ",HBHCWRD3," or the ",HBHCWRD1,!,"data MUST be deleted by responding 'Yes'.",!!
"RTN","HBHCUTL",59,0)
 I %'=1 S Y=$S($D(HBHCUPD):0,1:43) S:$D(HBHCUPD) HBHCKEEP=1
"RTN","HBHCUTL",60,0)
 Q
"RTN","HBHCUTL",61,0)
DISCHRG ; Delete discharge data 
"RTN","HBHCUTL",62,0)
 F HBHCI=47:1:55 S $P(^HBHC(631,HBHCDFN,0),U,HBHCI)=""
"RTN","HBHCUTL",63,0)
 F HBHCJ=1:1:10 S $P(^HBHC(631,HBHCDFN,1),U,HBHCJ)=""
"RTN","HBHCUTL",64,0)
 S $P(^HBHC(631,HBHCDFN,1),U,16)=""
"RTN","HBHCUTL",65,0)
 Q
"RTN","HBHCUTL",66,0)
START ; Prompt for beginning/ending report dates
"RTN","HBHCUTL",67,0)
 W ! K %DT S (HBHCBEG1,HBHCEND1,HBHCPAGE)=0,%DT("A")="Beginning Report Date: ",%DT="AEX" D ^%DT S HBHCBEG1=Y Q:HBHCBEG1=-1  D DD^%DT S HBHCBEG2=Y
"RTN","HBHCUTL",68,0)
END ; Ending date prompt
"RTN","HBHCUTL",69,0)
 S %DT("A")="Ending Report Date: " D ^%DT I (Y>0)&(Y<HBHCBEG1) W $C(7),!!,"Ending Report Date must be closer to today than the Beginning Report Date",! G END
"RTN","HBHCUTL",70,0)
 S HBHCEND1=Y_.9999 Q:HBHCEND1=-1  D DD^%DT S HBHCEND2=Y
"RTN","HBHCUTL",71,0)
TODAY ; Obtain current date
"RTN","HBHCUTL",72,0)
 S $P(HBHCZ,"=",81)=""
"RTN","HBHCUTL",73,0)
 K %DT S X="T" D ^%DT,DD^%DT S HBHCTDY=Y K %DT
"RTN","HBHCUTL",74,0)
 Q
"RTN","HBHCUTL",75,0)
HDRPAGE ; Print header with Page
"RTN","HBHCUTL",76,0)
 S HBHCPAGE=HBHCPAGE+1
"RTN","HBHCUTL",77,0)
 W !?HBHCCOLM,">>> HBPC ",HBHCHEAD," Report <<<",?71,"Page: ",HBHCPAGE,!!,"Run Date: ",HBHCTDY,!! I $D(HBHCHDR) X HBHCHDR W !
"RTN","HBHCUTL",78,0)
 W HBHCZ
"RTN","HBHCUTL",79,0)
 Q
"RTN","HBHCUTL",80,0)
HDRRANGE ; Print header with Date Range
"RTN","HBHCUTL",81,0)
 S HBHCPAGE=HBHCPAGE+1
"RTN","HBHCUTL",82,0)
 W !?HBHCCOLM,">>> HBPC ",HBHCHEAD," Report <<<",?71,"Page: ",HBHCPAGE,! W:$D(HBHCNAM) ?HBHCCLM1,$S($D(HBHCONE):"Provider:  ",1:"HBPC Team: "),HBHCNAM,! W !,"Run Date: ",HBHCTDY,?53,"Date Range: ",HBHCBEG2," to",!?65,HBHCEND2,!
"RTN","HBHCUTL",83,0)
 I $D(HBHCHDR) X HBHCHDR W !
"RTN","HBHCUTL",84,0)
 W HBHCZ
"RTN","HBHCUTL",85,0)
 Q
"RTN","HBHCUTL",86,0)
HDR132 ; Print 132 column header with Date Range 
"RTN","HBHCUTL",87,0)
 S HBHCPAGE=HBHCPAGE+1
"RTN","HBHCUTL",88,0)
 W !?HBHCCOLM,">>> HBPC ",HBHCHEAD," Report <<<",?123,"Page: ",HBHCPAGE,! W:$D(HBHCNAM) ?HBHCCLM1,HBHCWHOC_": ",HBHCNAM,! W !,"Run Date: ",HBHCTDY,?105,"Date Range: ",HBHCBEG2," to",!?117,HBHCEND2,! I $D(HBHCHDR) X HBHCHDR W !
"RTN","HBHCUTL",89,0)
 W HBHCZ
"RTN","HBHCUTL",90,0)
 Q
"RTN","HBHCUTL",91,0)
HDR132NR ; Print 132 column header with No Date Range 
"RTN","HBHCUTL",92,0)
 S HBHCPAGE=HBHCPAGE+1
"RTN","HBHCUTL",93,0)
 W !?HBHCCOLM,">>> HBPC ",HBHCHEAD," Report <<<",?123,"Page: ",HBHCPAGE,! W !,"Run Date: ",HBHCTDY I $D(HBHCHDR) X HBHCHDR W !
"RTN","HBHCUTL",94,0)
 W HBHCZ
"RTN","HBHCUTL",95,0)
 Q
"RTN","HBHCUTL",96,0)
HDRXPAGE ; Print header with Page & xtra info
"RTN","HBHCUTL",97,0)
 S HBHCPAGE=HBHCPAGE+1
"RTN","HBHCUTL",98,0)
 W !?HBHCCOLM,">>> HBPC ",HBHCHEAD," Report <<<",?71,"Page: ",HBHCPAGE,!! I $D(HBHCHDRX) X HBHCHDRX W !!,"Run Date: ",HBHCTDY,! I $D(HBHCHDR) X HBHCHDR W !
"RTN","HBHCUTL",99,0)
 W HBHCZ
"RTN","HBHCUTL",100,0)
 Q
"RTN","HBHCUTL3")
0^15^B26981634^B20865262
"RTN","HBHCUTL3",1,0)
HBHCUTL3 ;LR VAMC(IRMS)/MJT - HBHC Utility module, Entry points:  PSEUDO, PCEMSG, DX, DX80, CPT, MFHS, MFH, DATE3, DATE6, DATE3L, & DATE6L ;Jan 2000
"RTN","HBHCUTL3",2,0)
 ;;1.0;HOSPITAL BASED HOME CARE;**6,8,10,15,16,14,24,25**;NOV 01, 1993;Build 45
"RTN","HBHCUTL3",3,0)
 ;
"RTN","HBHCUTL3",4,0)
 ; This routine references the following supported ICRs:
"RTN","HBHCUTL3",5,0)
 ; 5747    $$CODEC^ICDEX
"RTN","HBHCUTL3",6,0)
 ; 5747    $$VSTD^ICDEX
"RTN","HBHCUTL3",7,0)
 ; 5679    $$IMPDATE^LEXU
"RTN","HBHCUTL3",8,0)
 ;
"RTN","HBHCUTL3",9,0)
 ;******************************************************************************
"RTN","HBHCUTL3",10,0)
 ;******************************************************************************
"RTN","HBHCUTL3",11,0)
 ;                       --- ROUTINE MODIFICATION LOG ---
"RTN","HBHCUTL3",12,0)
 ;        
"RTN","HBHCUTL3",13,0)
 ;PKG/PATCH    DATE        DEVELOPER    MODIFICATION
"RTN","HBHCUTL3",14,0)
 ;-----------  ----------  -----------  ----------------------------------------
"RTN","HBHCUTL3",15,0)
 ;HBH*1.0*25   APR  2012   K GUPTA      Support for ICD-10 Coding System
"RTN","HBHCUTL3",16,0)
 ;******************************************************************************
"RTN","HBHCUTL3",17,0)
 ;******************************************************************************
"RTN","HBHCUTL3",18,0)
 ;
"RTN","HBHCUTL3",19,0)
PSEUDO ; Print pseudo SSN message
"RTN","HBHCUTL3",20,0)
 W $C(7),!!,"Patient visit records with pseudo social security numbers (SSNs) exist.",!,"Print the 'Pseudo Social Security Number Report' located on the HBHC Reports"
"RTN","HBHCUTL3",21,0)
 W !,"Menu to obtain a list of patients with invalid SSNs.  HBHC must determine",!,"what corrective action is appropriate to eliminate these records from the",!,"HBHC Information System.",!! H 5
"RTN","HBHCUTL3",22,0)
 Q
"RTN","HBHCUTL3",23,0)
PCEMSG ; Print PCE correction of errors message
"RTN","HBHCUTL3",24,0)
 W !!,"Note:  Please use Appointment Management to Correct Visit Errors.  Run",!?7,"Edit Form Errors Data option when corrections are complete."
"RTN","HBHCUTL3",25,0)
 Q
"RTN","HBHCUTL3",26,0)
DX ; Diagnosis (DX) info, HBHCDFN must be defined prior to call, returns code plus text in local array HBHCDX
"RTN","HBHCUTL3",27,0)
 N HBHCDXCODE,HBHCDXDESC
"RTN","HBHCUTL3",28,0)
 K HBHCDX S $P(HBHCSP8," ",9)="",HBHCI=0
"RTN","HBHCUTL3",29,0)
 F  S HBHCI=$O(^HBHC(632,HBHCDFN,3,HBHCI)) Q:HBHCI'>0  D
"RTN","HBHCUTL3",30,0)
 . S HBHCICDP=$P(^HBHC(632,HBHCDFN,3,HBHCI,0),U)
"RTN","HBHCUTL3",31,0)
 . S HBHCDXCODE=$$CODEC^ICDEX(80,HBHCICDP)
"RTN","HBHCUTL3",32,0)
 . S HBHCDXDESC=$$VSTD^ICDEX(HBHCICDP)
"RTN","HBHCUTL3",33,0)
 . S HBHCDX(HBHCI)=HBHCDXCODE_$E(HBHCSP8,1,(10-$L(HBHCDXCODE)))_HBHCDXDESC  ;add minimum of 2 spaces between code and desc
"RTN","HBHCUTL3",34,0)
 K HBHCI,HBHCICDP
"RTN","HBHCUTL3",35,0)
 Q
"RTN","HBHCUTL3",36,0)
DX80 ; Print DX info in 80 column format, HBHCDX( array must be defined prior to call
"RTN","HBHCUTL3",37,0)
 S (HBHCFLG,HBHCI)=0 F  S HBHCI=$O(HBHCDX(HBHCI)) Q:HBHCI'>0  W ! W:HBHCFLG=0 "Diagnosis:   " W:HBHCFLG=1 ?13  W HBHCDX(HBHCI) S HBHCFLG=1
"RTN","HBHCUTL3",38,0)
 K HBHCDX,HBHCFLG,HBHCI
"RTN","HBHCUTL3",39,0)
 Q
"RTN","HBHCUTL3",40,0)
CPT ; CPT code info, HBHCDFN must be defined prior to call, returns code plus text in local array HBHCCPTA
"RTN","HBHCUTL3",41,0)
 K HBHCCPTA S $P(HBHCSP3," ",4)="",HBHCI=0 F  S HBHCI=$O(^HBHC(632,HBHCDFN,2,HBHCI)) Q:HBHCI'>0  S HBHCCPT=$$CPT^ICPTCOD(^HBHC(632,HBHCDFN,2,HBHCI,0)),HBHCCPTA(HBHCI)=$P(HBHCCPT,U,2)_HBHCSP3_$P(HBHCCPT,U,3) D CPTMOD
"RTN","HBHCUTL3",42,0)
 K HBHCCPT,HBHCI,HBHCJ,HBHCMOD,HBHCSP3
"RTN","HBHCUTL3",43,0)
 Q
"RTN","HBHCUTL3",44,0)
CPTMOD ; Process CPT Modifier code plus text into local array HBHCCPTA(HBHCCPT,HBHCJ)
"RTN","HBHCUTL3",45,0)
 S HBHCJ=0 F  S HBHCJ=$O(^HBHC(632,HBHCDFN,2,HBHCI,1,HBHCJ)) Q:HBHCJ'>0  S HBHCMOD=$$MOD^ICPTMOD($P(^HBHC(632,HBHCDFN,2,HBHCI,1,HBHCJ,0),U),"I"),HBHCCPTA(HBHCI,HBHCJ)=$P(HBHCMOD,U,2)_HBHCSP3_$P(HBHCMOD,U,3)
"RTN","HBHCUTL3",46,0)
 Q
"RTN","HBHCUTL3",47,0)
MFHS ; Set Medical Foster Home (MFH) Site variable if Sanctioned site
"RTN","HBHCUTL3",48,0)
 S:$P($G(^HBHC(631.9,1,0)),U,9)]"" HBHCMFHS=1
"RTN","HBHCUTL3",49,0)
 Q
"RTN","HBHCUTL3",50,0)
MFH ; Prompt for HBPC or MFH population inclusion on report; set Medical Foster Home Report variable: HBHCMFHR
"RTN","HBHCUTL3",51,0)
 K DIR S DIR(0)="SB^H:Home Based Primary Care (HBPC);M:Medical Foster Home (MFH)",DIR("A")="Include HBPC or MFH census",DIR("?")="Include HBPC (H), or MFH (M) population on report" D ^DIR
"RTN","HBHCUTL3",52,0)
 S:Y="M" HBHCMFHR=1
"RTN","HBHCUTL3",53,0)
 Q
"RTN","HBHCUTL3",54,0)
DATE3 ; Calc 3 mo date based on month only for use by MFH Inspection or Training e-mail processing
"RTN","HBHCUTL3",55,0)
 S HBHCMO=+$E(DT,4,5),HBHCDATE=3_$S(HBHCMO>9:$E(DT,2,3),1:($E(DT,2,3)-1))_$S(HBHCMO=10:"01",HBHCMO=11:"02",HBHCMO=12:"03",HBHCMO=1:"04",HBHCMO=2:"05",HBHCMO=3:"06",HBHCMO=4:"07",HBHCMO=5:"08",HBHCMO=6:"09",1:HBHCMO+3)_"01" D CHECK
"RTN","HBHCUTL3",56,0)
 ; Following line produces the correct date; keep for testing purposes
"RTN","HBHCUTL3",57,0)
 ;F HBHCMO=1:1:12 S HBHCDATE=3_$S(HBHCMO>9:$E(DT,2,3),1:($E(DT,2,3)-1))_$S(HBHCMO=10:"01",HBHCMO=11:"02",HBHCMO=12:"03",HBHCMO=1:"04",HBHCMO=2:"05",HBHCMO=3:"06",HBHCMO=4:"07",HBHCMO=5:"08",HBHCMO=6:"09",1:HBHCMO+3)_"01" D CHECK
"RTN","HBHCUTL3",58,0)
 Q
"RTN","HBHCUTL3",59,0)
DATE6 ; Calc 6 mo date based on month only for use by MFH Inspection or Training report processing
"RTN","HBHCUTL3",60,0)
 S HBHCMO=+$E(DT,4,5),HBHCDATE=3_$S(HBHCMO>6:$E(DT,2,3),1:($E(DT,2,3)-1))_$S(HBHCMO=7:"01",HBHCMO=8:"02",HBHCMO=9:"03",HBHCMO=10:"04",HBHCMO=11:"05",HBHCMO=12:"06",HBHCMO=1:"07",HBHCMO=2:"08",HBHCMO=3:"09",1:HBHCMO+6)_"01" D CHECK
"RTN","HBHCUTL3",61,0)
 Q
"RTN","HBHCUTL3",62,0)
DATE3L ; Calc 3 mo date based on month only for use by MFH License Expiration e-mail processing
"RTN","HBHCUTL3",63,0)
 S HBHCMO=+$E(DT,4,5),HBHCDATE=3_$S(HBHCMO>9:($E(DT,2,3)+1),1:($E(DT,2,3)))_$S(HBHCMO=10:"01",HBHCMO=11:"02",HBHCMO=12:"03",HBHCMO=1:"04",HBHCMO=2:"05",HBHCMO=3:"06",HBHCMO=4:"07",HBHCMO=5:"08",HBHCMO=6:"09",1:HBHCMO+3)_"01" D CHECK
"RTN","HBHCUTL3",64,0)
 Q
"RTN","HBHCUTL3",65,0)
DATE6L ; Calc 6 mo date based on month only for use by MFH License Expiration report processing
"RTN","HBHCUTL3",66,0)
 S HBHCMO=+$E(DT,4,5),HBHCDATE=3_$S(HBHCMO>6:($E(DT,2,3)+1),1:($E(DT,2,3)))_$S(HBHCMO=7:"01",HBHCMO=8:"02",HBHCMO=9:"03",HBHCMO=10:"04",HBHCMO=11:"05",HBHCMO=12:"06",HBHCMO=1:"07",HBHCMO=2:"08",HBHCMO=3:"09",1:HBHCMO+6)_"01" D CHECK
"RTN","HBHCUTL3",67,0)
 Q
"RTN","HBHCUTL3",68,0)
CHECK ; Check length of HBHCDATE
"RTN","HBHCUTL3",69,0)
 S:$L(HBHCDATE)=6 HBHCDATE=$E(HBHCDATE)_"0"_$E(HBHCDATE,2,6)
"RTN","HBHCUTL3",70,0)
 Q
"RTN","HBHCUTL3",71,0)
 ;
"RTN","HBHCUTL3",72,0)
 ;Returns the text ICD-9/ICD-10/ICD based on date range
"RTN","HBHCUTL3",73,0)
 ;Input parameters:
"RTN","HBHCUTL3",74,0)
 ; HBHCBEG - Report beginning date
"RTN","HBHCUTL3",75,0)
 ; HBHCEND - Report ending date
"RTN","HBHCUTL3",76,0)
 ;Output values:
"RTN","HBHCUTL3",77,0)
 ; "ICD-9"  - if start and end dates are before ICD-10 implementation date
"RTN","HBHCUTL3",78,0)
 ; "ICD"    - if start and end dates spans across ICD-10 implementation date
"RTN","HBHCUTL3",79,0)
 ; "ICD-10" - if start and end dates are on or after ICD-10 implementation date
"RTN","HBHCUTL3",80,0)
 ;
"RTN","HBHCUTL3",81,0)
ICDTEXT(HBHCBEG,HBHCEND) ;
"RTN","HBHCUTL3",82,0)
 N HBHCICD10DT
"RTN","HBHCUTL3",83,0)
 S HBHCICD10DT=$$IMPDATE^LEXU("10D")
"RTN","HBHCUTL3",84,0)
 Q:(HBHCEND<HBHCICD10DT) "ICD-9"
"RTN","HBHCUTL3",85,0)
 Q:(HBHCBEG>=HBHCICD10DT) "ICD-10"
"RTN","HBHCUTL3",86,0)
 Q "ICD"
"RTN","HBHCUTL3",87,0)
 ;
"RTN","HBHCUTL3",88,0)
 ;Returns the text Coding System based on data range
"RTN","HBHCUTL3",89,0)
 ;Input parameters:
"RTN","HBHCUTL3",90,0)
 ; HBHCBEG - Report beginning date
"RTN","HBHCUTL3",91,0)
 ; HBHCEND - Report ending date
"RTN","HBHCUTL3",92,0)
 ;Output values:
"RTN","HBHCUTL3",93,0)
 ; ",1,"    - ICD-9 coding system if start and end dates are before ICD-10 implementation date
"RTN","HBHCUTL3",94,0)
 ; ",1,30," - ICD-9 and ICD-10 coding systems if start and end dates spans across ICD-10 implementation date
"RTN","HBHCUTL3",95,0)
 ; ",30,"   - ICD-10 coding system if start and end dates are on or after ICD-10 implementation date
"RTN","HBHCUTL3",96,0)
 ;
"RTN","HBHCUTL3",97,0)
ICDCSYS(HBHCBEG,HBHCEND) ;
"RTN","HBHCUTL3",98,0)
 N HBHCICD10DT,HBHCRET
"RTN","HBHCUTL3",99,0)
 S HBHCRET=""
"RTN","HBHCUTL3",100,0)
 S HBHCICD10DT=$$IMPDATE^LEXU("10D")
"RTN","HBHCUTL3",101,0)
 S:(HBHCBEG<HBHCICD10DT) HBHCRET="1"  ;ICD-9
"RTN","HBHCUTL3",102,0)
 S:(HBHCEND>=HBHCICD10DT) HBHCRET=HBHCRET_$S(HBHCRET]"":",",1:"")_"30"  ;ICD-10
"RTN","HBHCUTL3",103,0)
 S:HBHCRET]"" HBHCRET=","_HBHCRET_","
"RTN","HBHCUTL3",104,0)
 Q HBHCRET
"RTN","HBHCXMA")
0^10^B42800884^B38006559
"RTN","HBHCXMA",1,0)
HBHCXMA ;LR VAMC(IRMS)/MJT - HBHC populate ^HBHC(634) with Evaluation/Admission Data or ^HBHC(634.1), file of records in ^HBHC(631) containing missing/erroneous data, called by ^HBHCFILE, calls ^HBHCXMA1 ;9/02/09
"RTN","HBHCXMA",2,0)
 ;;1.0;HOSPITAL BASED HOME CARE;**1,6,9,19,24,25**;NOV 01, 1993;Build 45
"RTN","HBHCXMA",3,0)
 ;
"RTN","HBHCXMA",4,0)
 ; This routine references the following supported ICRs:
"RTN","HBHCXMA",5,0)
 ; 5747    $$CODEC^ICDEX
"RTN","HBHCXMA",6,0)
 ;
"RTN","HBHCXMA",7,0)
 ;******************************************************************************
"RTN","HBHCXMA",8,0)
 ;******************************************************************************
"RTN","HBHCXMA",9,0)
 ;                       --- ROUTINE MODIFICATION LOG ---
"RTN","HBHCXMA",10,0)
 ;        
"RTN","HBHCXMA",11,0)
 ;PKG/PATCH    DATE        DEVELOPER    MODIFICATION
"RTN","HBHCXMA",12,0)
 ;-----------  ----------  -----------  ----------------------------------------
"RTN","HBHCXMA",13,0)
 ;HBH*1.0*25   APR  2012   K GUPTA      Support for ICD-10 Coding System
"RTN","HBHCXMA",14,0)
 ;******************************************************************************
"RTN","HBHCXMA",15,0)
 ;******************************************************************************
"RTN","HBHCXMA",16,0)
 ;
"RTN","HBHCXMA",17,0)
 D START^HBHCXMA1
"RTN","HBHCXMA",18,0)
LOOP ; Loop thru ^HBHC(631) "AE","N" cross-ref to create nodes in ^HBHC(634) => transmit or ^HBHC(634.1) => Evaluation/Admission Error(s) file
"RTN","HBHCXMA",19,0)
 S HBHCDFN="" F  S HBHCDFN=$O(^HBHC(631,"AE","N",HBHCDFN)) Q:HBHCDFN=""  S HBHCFLG=1 D SETNODE I HBHCFLG D:HBHCDR="" TRANS D:HBHCDR]"" ERROR^HBHCXMA1
"RTN","HBHCXMA",20,0)
EXIT ; Exit module
"RTN","HBHCXMA",21,0)
 D EXIT^HBHCXMA1
"RTN","HBHCXMA",22,0)
 Q
"RTN","HBHCXMA",23,0)
SETNODE ; Set node in ^HBHC(634) (Transmit) or ^HBHC(634.1) Evaluation/Admission Error(s))
"RTN","HBHCXMA",24,0)
 S HBHCINFO=^HBHC(631,HBHCDFN,0),HBHCXMT3=$P($G(^HBHC(631,HBHCDFN,1)),U,17)
"RTN","HBHCXMA",25,0)
 ; Quit if admission date is greater than HBHCLSDT (last date to include in transmit set up in ^HBHCFILE)
"RTN","HBHCXMA",26,0)
 I $P(HBHCINFO,U,18)>HBHCLSDT S HBHCFLG=0 Q
"RTN","HBHCXMA",27,0)
 S HBHCDPT0=^DPT(+HBHCINFO,0),HBHCDR=""
"RTN","HBHCXMA",28,0)
 S DFN=+HBHCINFO K VADM D DEM^VADPT D RACE,ETH
"RTN","HBHCXMA",29,0)
 S HBHCAFLG=0 F HBHCK=19:1:37 Q:HBHCAFLG  S:$P(HBHCINFO,U,HBHCK)]"" HBHCAFLG=1
"RTN","HBHCXMA",30,0)
 S HBHCRFLG=0 S:($P(HBHCINFO,U,16)]"")!($P(HBHCINFO,U,17)]"") HBHCRFLG=1
"RTN","HBHCXMA",31,0)
 S HBHCADDT=$S($P(HBHCINFO,U,18)]"":$E($P(HBHCINFO,U,18),4,5)_$E($P(HBHCINFO,U,18),6,7)_(1700+$E($P(HBHCINFO,U,18),1,3)),1:HBHCSP8)
"RTN","HBHCXMA",32,0)
 ; Use Evaluation Date for historical 'Reject' purposes 
"RTN","HBHCXMA",33,0)
 S:HBHCADDT=HBHCSP8 HBHCADDT=$S($P(HBHCINFO,U,2)]"":$E($P(HBHCINFO,U,2),4,5)_$E($P(HBHCINFO,U,2),6,7)_(1700+$E($P(HBHCINFO,U,2),1,3)),1:HBHCSP8)
"RTN","HBHCXMA",34,0)
 S:HBHCADDT=HBHCSP8 HBHCDR=HBHCDR_"17;"
"RTN","HBHCXMA",35,0)
 S HBHCST=$S($P(HBHCINFO,U,3)]"":$P(^DIC(5,(+^HBHC(631.8,($P(HBHCINFO,U,3)),0)),0),U,3),1:"") S:HBHCST="" HBHCDR=HBHCDR_"2;"
"RTN","HBHCXMA",36,0)
 S HBHCCNTY="" S:(($P(HBHCINFO,U,3)]"")&($P(HBHCINFO,U,4)]"")) HBHCCNTY=$P($G(^DIC(5,(+^HBHC(631.8,($P(HBHCINFO,U,3)),0)),1,$P(HBHCINFO,U,4),0)),U,3) S:HBHCCNTY="" HBHCDR=HBHCDR_"3;"
"RTN","HBHCXMA",37,0)
 S HBHCZIP=$S($P(HBHCINFO,U,5)]"":$P(HBHCINFO,U,5),1:"") S:HBHCZIP="" HBHCDR=HBHCDR_"4;"
"RTN","HBHCXMA",38,0)
 I $P(HBHCINFO,U,5)]"" S:$L(HBHCZIP)'=9 HBHCZIP=HBHCZIP_HBHCSP4
"RTN","HBHCXMA",39,0)
 S HBHCELGE=$S($P(HBHCINFO,U,6)]"":$P(HBHCINFO,U,6),1:"") S:HBHCELGE="" HBHCDR=HBHCDR_"5;"
"RTN","HBHCXMA",40,0)
 S HBHCBYR=$S($P(HBHCDPT0,U,3):1700+$E($P(HBHCDPT0,U,3),1,3),1:"0000")
"RTN","HBHCXMA",41,0)
 S HBHCPSRV=$S($P(HBHCINFO,U,8)]"":$P(^HBHC(631.7,$P(HBHCINFO,U,8),0),U),1:"") S:HBHCPSRV="" HBHCDR=HBHCDR_"7;"
"RTN","HBHCXMA",42,0)
 S HBHCSX=$P(HBHCDPT0,U,2),HBHCSEX=$S(HBHCSX="M":1,1:2)
"RTN","HBHCXMA",43,0)
 ; Obsolete with Race/Ethnicity Info Jan 2003 mandate; commented out historical reference; HBHCRC set to X in HBHCXMA1  mjt
"RTN","HBHCXMA",44,0)
 ;S HBHCRC=$S($P(HBHCDPT0,U,6)]"":$P(^DIC(10,$P(HBHCDPT0,U,6),0),U,2),1:""),HBHCRACE=$S(HBHCRC=6:1,HBHCRC=4:2,(HBHCRC=1)!(HBHCRC=2):3,HBHCRC=3:4,HBHCRC=5:5,1:9)
"RTN","HBHCXMA",45,0)
 F HBHCI=1:1:4 S HBHCFLD=$P(HBHCFLD1,U,HBHCI) S @HBHCFLD=$S($P(HBHCINFO,U,HBHCI+10)]"":$P(HBHCINFO,U,HBHCI+10),1:"") S:@HBHCFLD="" HBHCDR=HBHCDR_(HBHCI+9)_";"
"RTN","HBHCXMA",46,0)
 S HBHCRFIN=$S($P($G(^HBHC(631,HBHCDFN,1)),U,29)]"":$P($G(^HBHC(631,HBHCDFN,1)),U,29),1:HBHCSP1)
"RTN","HBHCXMA",47,0)
 S HBHCACTN=$S($P(HBHCINFO,U,15)]"":$P(HBHCINFO,U,15),1:"") I (HBHCACTN="")!((HBHCACTN=1)&(HBHCRFLG=1))!((HBHCACTN=2)&(HBHCAFLG=1)) S HBHCDR=HBHCDR_"14;" Q
"RTN","HBHCXMA",48,0)
 S HBHCREJ=$S($P(HBHCINFO,U,16)]"":$P(^HBHC(631.1,$P(HBHCINFO,U,16),0),U),1:HBHCSP2) S:(HBHCACTN=2)&(HBHCREJ=HBHCSP2) HBHCDR=HBHCDR_"15;"
"RTN","HBHCXMA",49,0)
 S HBHCREJD=$S($P(HBHCINFO,U,17)]"":$P(HBHCINFO,U,17),1:HBHCSP1) S:(HBHCACTN=2)&(HBHCREJD=HBHCSP1) HBHCDR=HBHCDR_"16;"
"RTN","HBHCXMA",50,0)
 ;S HBHCICDA=$S($P(HBHCINFO,U,19)]"":$P($P(^ICD9($P(HBHCINFO,U,19),0),U),".")_$P($P(^ICD9($P(HBHCINFO,U,19),0),U),".",2),1:HBHCSP6) S:$L(HBHCICDA)<6 HBHCICDA=HBHCICDA_$J("",6-$L(HBHCICDA)) S:(HBHCACTN=1)&(HBHCICDA=HBHCSP6) HBHCDR=HBHCDR_"18;"
"RTN","HBHCXMA",51,0)
 I $P(HBHCINFO,U,19)]"" D  I 1
"RTN","HBHCXMA",52,0)
 . N DXCODE
"RTN","HBHCXMA",53,0)
 . S DXCODE=$$CODEC^ICDEX(80,$P(HBHCINFO,U,19))
"RTN","HBHCXMA",54,0)
 . S HBHCICDA=$P(DXCODE,".",1)_$P(DXCODE,".",2)
"RTN","HBHCXMA",55,0)
 E  S HBHCICDA=HBHCSP8
"RTN","HBHCXMA",56,0)
 S:$L(HBHCICDA)<8 HBHCICDA=HBHCICDA_$J("",8-$L(HBHCICDA)) S:(HBHCACTN=1)&(HBHCICDA=HBHCSP8) HBHCDR=HBHCDR_"18;"
"RTN","HBHCXMA",57,0)
 F HBHCJ=1:1:18 S HBHCFLD=$P(HBHCFLD2,U,HBHCJ) S @HBHCFLD=$S($P(HBHCINFO,U,HBHCJ+19)]"":$P(HBHCINFO,U,HBHCJ+19),1:HBHCSP1) S:(HBHCACTN=1)&(@HBHCFLD=HBHCSP1) HBHCDR=HBHCDR_(HBHCJ+18)_";"
"RTN","HBHCXMA",58,0)
 ; Set field values = null
"RTN","HBHCXMA",59,0)
 S HBHCMPT=HBHCSP1,HBHCIEN=HBHCSP5,HBHCRTDT=HBHCSP8,HBHCRTPD=HBHCSP6
"RTN","HBHCXMA",60,0)
 ; Check whether MFH site; Only validate data if Action = Admit
"RTN","HBHCXMA",61,0)
 D MFHS^HBHCUTL3 I HBHCACTN=1 D:$D(HBHCMFHS) MFH
"RTN","HBHCXMA",62,0)
 Q:HBHCDR]""
"RTN","HBHCXMA",63,0)
 ; HBHCCDTS (HBHC Creation Date/Time/Seconds) is used as unique record identifier on Austin end, seconds must be included for likelihood of being unique
"RTN","HBHCXMA",64,0)
NOW ; Get time NOW, repeat until Hours/Minutes/Seconds = 6 digits in length
"RTN","HBHCXMA",65,0)
 D NOW^%DTC S HBHCX=$P(%,".",2) G:($L(HBHCX)'=6) NOW S HBHCCDTS=($E(%,4,5))_($E(%,6,7))_($S($E(%)=2:19,1:20))_($E(%,2,3))_HBHCX
"RTN","HBHCXMA",66,0)
 S HBHCNAME=$P(^DPT($P(HBHCINFO,U),0),U) S:$L(HBHCNAME)<HBHCLNTH HBHCNAME=HBHCNAME_$J("",HBHCLNTH-$L(HBHCNAME))
"RTN","HBHCXMA",67,0)
 S HBHCSSN=$P(^DPT($P(HBHCINFO,U),0),U,9)
"RTN","HBHCXMA",68,0)
 S HBHCREC=HBHCFORM_HBHCHOSP_HBHCSSN_HBHCADDT_HBHCST_HBHCCNTY_HBHCZIP_HBHCELGE_HBHCBYR_HBHCPSRV_HBHCSEX_HBHCRC_HBHCMARE_HBHCLIVE_HBHCCARE_HBHCTYPE_HBHCRFIN_HBHCACTN_HBHCREJ_HBHCREJD_HBHCNAME_HBHCICDA_HBHCVISA_HBHCHERA_HBHCEXCA
"RTN","HBHCXMA",69,0)
 S HBHCREC=HBHCREC_HBHCRECA_HBHCBTHA_HBHCDRSA_HBHCTLTA_HBHCTRNA_HBHCEATA_HBHCWLKA_HBHCBWLA_HBHCBLDA_HBHCMOBA_HBHCADTA_HBHCBHVA_HBHCDSOA_HBHCMODA_HBHCLMTA_HBHCRACE_HBHCETH_HBHCMPT_HBHCIEN_HBHCRTDT_HBHCRTPD_HBHCCDTS_HBHCSP14
"RTN","HBHCXMA",70,0)
 Q
"RTN","HBHCXMA",71,0)
RACE ; Race Jan 2003 mandate: 7 Race codes (w/corresponding Collection Method codes) exist, 4 additional 'slots' are for future expansion = 11 total for loop counter for data fill in transmit record
"RTN","HBHCXMA",72,0)
 S HBHCRACE="",HBHCEND=11,HBHCNODE=12,HBHCFIL=1
"RTN","HBHCXMA",73,0)
 D LOOP2
"RTN","HBHCXMA",74,0)
 S HBHCRACE=HBHCVAR
"RTN","HBHCXMA",75,0)
 Q
"RTN","HBHCXMA",76,0)
ETH ; Ethnicity Jan 2003 mandate: 4 Ethnicity codes (w/corresponding Collection Method codes) exist, 4 additional 'slots' are for future expansion = 8 total for loop counter for data fill in transmit record
"RTN","HBHCXMA",77,0)
 S HBHCETH="",HBHCEND=8,HBHCNODE=11,HBHCFIL=2
"RTN","HBHCXMA",78,0)
 D LOOP2
"RTN","HBHCXMA",79,0)
 S HBHCETH=HBHCVAR
"RTN","HBHCXMA",80,0)
 Q
"RTN","HBHCXMA",81,0)
LOOP2 ; Loop 2
"RTN","HBHCXMA",82,0)
 S HBHCVAR=""
"RTN","HBHCXMA",83,0)
 F HBHCL=1:1:HBHCEND S:'$D(VADM(HBHCNODE,HBHCL)) HBHCVAR=HBHCVAR_HBHCSP2 I $D(VADM(HBHCNODE,HBHCL)) D SET S HBHCVAR=HBHCVAR_HBHCPTFV_HBHCCM
"RTN","HBHCXMA",84,0)
 Q
"RTN","HBHCXMA",85,0)
SET ; Set PTF Value & Collection Method Variables
"RTN","HBHCXMA",86,0)
 S HBHCIENP=$P(VADM(HBHCNODE,HBHCL),U)
"RTN","HBHCXMA",87,0)
 S HBHCIEN2=$P(VADM(HBHCNODE,HBHCL,1),U)
"RTN","HBHCXMA",88,0)
 S HBHCPTFV=$$PTR2CODE^DGUTL4(HBHCIENP,HBHCFIL,HBHCPTF)
"RTN","HBHCXMA",89,0)
 S HBHCCM=$$PTR2CODE^DGUTL4(HBHCIEN2,HBHCT103,HBHCPTF)
"RTN","HBHCXMA",90,0)
 Q
"RTN","HBHCXMA",91,0)
TRANS ; Set node in ^HBHC(634) transmit file & flag record as 'F" (filed for transmit) in ^HBHC(631)
"RTN","HBHCXMA",92,0)
 L +^HBHC(634,0):$S($D(DILOCKTM):DILOCKTM,1:3) Q:'$T  S HBHCNDX1=$P(^HBHC(634,0),U,3)+1,$P(^HBHC(634,0),U,3)=HBHCNDX1,$P(^HBHC(634,0),U,4)=$P(^HBHC(634,0),U,4)+1 L -^HBHC(634,0)
"RTN","HBHCXMA",93,0)
 S $P(^HBHC(634,HBHCNDX1,0),U)=HBHCREC,^HBHC(634,"B",$E(HBHCREC,1,30),HBHCNDX1)=""
"RTN","HBHCXMA",94,0)
 L +^HBHC(631,HBHCDFN,1):$S($D(DILOCKTM):DILOCKTM,1:3) Q:'$T  K:HBHCXMT3]"" ^HBHC(631,"AE",HBHCXMT3,HBHCDFN) S $P(^HBHC(631,HBHCDFN,1),U,17)="F",^HBHC(631,"AE","F",HBHCDFN)="",$P(^HBHC(631,HBHCDFN,1),U,19)=HBHCTDY L -^HBHC(631,HBHCDFN,1)
"RTN","HBHCXMA",95,0)
 Q
"RTN","HBHCXMA",96,0)
MFH ; Medical Foster Home (MFH) processing; Check for existance of MFH fields:  89, 90 (.01 & 1), when 88 = Y signifying MFH Patient, in file 631; Set variables for HBHCREC
"RTN","HBHCXMA",97,0)
 S HBHCNOD3=$G(^HBHC(631,HBHCDFN,3))
"RTN","HBHCXMA",98,0)
 Q:$P(HBHCNOD3,U)'="Y"
"RTN","HBHCXMA",99,0)
 S:$P(HBHCNOD3,U)="Y" HBHCMPT="Y"
"RTN","HBHCXMA",100,0)
 S:$P(HBHCNOD3,U,2)="" HBHCDR=HBHCDR_"89;"
"RTN","HBHCXMA",101,0)
 S:$P(HBHCNOD3,U,2)]"" HBHCIEN=$P(HBHCNOD3,U,2) S:$L(HBHCIEN)<5 HBHCIEN=HBHCIEN_$J("",5-$L(HBHCIEN))
"RTN","HBHCXMA",102,0)
 ; Process Current Rate Only
"RTN","HBHCXMA",103,0)
 S (HBHCCURK,HBHCJ)=0 F  S HBHCJ=$O(^HBHC(631,HBHCDFN,4,"B",HBHCJ)) Q:HBHCJ'>0  S HBHCCURJ=HBHCJ,HBHCK=0 F  S HBHCK=$O(^HBHC(631,HBHCDFN,4,"B",HBHCJ,HBHCK)) Q:HBHCK'>0  S HBHCCURK=HBHCK
"RTN","HBHCXMA",104,0)
 S HBHC=$G(^HBHC(631,HBHCDFN,4,HBHCCURK,0))
"RTN","HBHCXMA",105,0)
 S:($P(HBHC,U)="")!($P(HBHC,U,2)="") HBHCDR=HBHCDR_"90;"
"RTN","HBHCXMA",106,0)
 S:$P(HBHC,U)]"" HBHCRTDT=$E($P(HBHC,U),4,7)_"20"_$E($P(HBHC,U),2,3)
"RTN","HBHCXMA",107,0)
 S:$P(HBHC,U,2)]"" HBHCRTPD=$P(HBHC,U,2)
"RTN","HBHCXMA",108,0)
 S:HBHCRTPD'=HBHCSP6 HBHCRTPD=$S($L(HBHCRTPD)=4:$E(HBHCRTPD,1,4)_"00",$L(HBHCRTPD)=5:$E(HBHCRTPD,1,4)_"00",$L(HBHCRTPD)=6:$E(HBHCRTPD,1,4)_$E(HBHCRTPD,6)_"0",1:$E(HBHCRTPD,1,4)_$E(HBHCRTPD,6,7))
"RTN","HBHCXMA",109,0)
 Q
"RTN","HBHCXMA1")
0^18^B13785119^B12692745
"RTN","HBHCXMA1",1,0)
HBHCXMA1 ;LR VAMC(IRMS)/MJT - HBHC, called by ^HBHCXMA, entry points: START, ERROR, EXIT, calls HOSP^HBHCUTL1 ;Jul 2000
"RTN","HBHCXMA1",2,0)
 ;;1.0;HOSPITAL BASED HOME CARE;**2,6,14,19,24,25**;NOV 01, 1993;Build 45
"RTN","HBHCXMA1",3,0)
 ;******************************************************************************
"RTN","HBHCXMA1",4,0)
 ;******************************************************************************
"RTN","HBHCXMA1",5,0)
 ;                       --- ROUTINE MODIFICATION LOG ---
"RTN","HBHCXMA1",6,0)
 ;        
"RTN","HBHCXMA1",7,0)
 ;PKG/PATCH    DATE        DEVELOPER    MODIFICATION
"RTN","HBHCXMA1",8,0)
 ;-----------  ----------  -----------  ----------------------------------------
"RTN","HBHCXMA1",9,0)
 ;HBH*1.0*25   APR  2012   K GUPTA      Support for ICD-10 Coding System
"RTN","HBHCXMA1",10,0)
 ;******************************************************************************
"RTN","HBHCXMA1",11,0)
 ;******************************************************************************
"RTN","HBHCXMA1",12,0)
 ;
"RTN","HBHCXMA1",13,0)
START ; Initialization
"RTN","HBHCXMA1",14,0)
 W !,"Processing Admission/Form 3 Data"
"RTN","HBHCXMA1",15,0)
 S HBHCFORM=3,$P(HBHCSP1," ",2)="",$P(HBHCSP2," ",3)="",$P(HBHCSP4," ",5)="",$P(HBHCSP5," ",6)="",$P(HBHCSP6," ",7)="",$P(HBHCSP8," ",9)="",$P(HBHCSP14," ",15)="",HBHCLNTH=30
"RTN","HBHCXMA1",16,0)
 D HOSP^HBHCUTL1
"RTN","HBHCXMA1",17,0)
 S HBHCFLD1="HBHCMARE^HBHCLIVE^HBHCCARE^HBHCTYPE"
"RTN","HBHCXMA1",18,0)
 S HBHCFLD2="HBHCVISA^HBHCHERA^HBHCEXCA^HBHCRECA^HBHCBTHA^HBHCDRSA^HBHCTLTA^HBHCTRNA^HBHCEATA^HBHCWLKA^HBHCBWLA^HBHCBLDA^HBHCMOBA^HBHCADTA^HBHCBHVA^HBHCDSOA^HBHCMODA^HBHCLMTA"
"RTN","HBHCXMA1",19,0)
 K %DT S X="T" D ^%DT S HBHCTDY=Y
"RTN","HBHCXMA1",20,0)
 ; Initialize variables passed for $$PRT2CODE^DGUTL4(VALUE,TYPE,CODE) calls
"RTN","HBHCXMA1",21,0)
 ; Following comments stolen from DGUTL4 routine:
"RTN","HBHCXMA1",22,0)
 ; Convert pointer to specified code
"RTN","HBHCXMA1",23,0)
 ; Input: VALUE - Pointer to RACE file (#10), ETHNICITY file (#10.2),
"RTN","HBHCXMA1",24,0)
 ;                or RACE AND ETHNICITY COLLECTION METHOD file (#10.3)
"RTN","HBHCXMA1",25,0)
 ;        TYPE - Flag indicating which file VALUE is for
"RTN","HBHCXMA1",26,0)
 ;               1 = Race (default)
"RTN","HBHCXMA1",27,0)
 ;               2 = Ethnicity
"RTN","HBHCXMA1",28,0)
 ;               3 = Collection Method
"RTN","HBHCXMA1",29,0)
 ;        CODE - Flag indicating which code to return
"RTN","HBHCXMA1",30,0)
 ;               1 = Abbreviation (default)
"RTN","HBHCXMA1",31,0)
 ;               2 = HL7
"RTN","HBHCXMA1",32,0)
 ;               3 = CDC (not applicable for Collection Method)
"RTN","HBHCXMA1",33,0)
 ;               4 = PTF
"RTN","HBHCXMA1",34,0)
 ; End of DGUTL4 comment theft  mjt
"RTN","HBHCXMA1",35,0)
 ; Race = 10, Ethnicity = 102, Collection Method = 103
"RTN","HBHCXMA1",36,0)
 ; Type
"RTN","HBHCXMA1",37,0)
 S HBHCT103=3
"RTN","HBHCXMA1",38,0)
 ; Code, PTF Value used for all files
"RTN","HBHCXMA1",39,0)
 S HBHCPTF=4
"RTN","HBHCXMA1",40,0)
 ; Race field set to "X" & became Historical only, beginning w/Jan 2003 new Race & Ethnicity Information fields mandate  mjt
"RTN","HBHCXMA1",41,0)
 S HBHCRC="X"
"RTN","HBHCXMA1",42,0)
 Q
"RTN","HBHCXMA1",43,0)
ERROR ; Set node in ^HBHC(634.1) if data is incomplete or proper fields invalid for 'Admit/Reject Action'
"RTN","HBHCXMA1",44,0)
 L +^HBHC(634.1,0):$S($D(DILOCKTM):DILOCKTM,1:3) Q:'$T  S HBHCNDX2=$P(^HBHC(634.1,0),U,3)+1,$P(^HBHC(634.1,0),U,3)=HBHCNDX2,$P(^HBHC(634.1,0),U,4)=$P(^HBHC(634.1,0),U,4)+1 L -^HBHC(634.1,0)
"RTN","HBHCXMA1",45,0)
 S ^HBHC(634.1,HBHCNDX2,0)=$P(HBHCINFO,U)_U_HBHCDFN,^HBHC(634.1,HBHCNDX2,1)=HBHCDR,^HBHC(634.1,"B",$P(HBHCINFO,U),HBHCNDX2)=""
"RTN","HBHCXMA1",46,0)
 Q
"RTN","HBHCXMA1",47,0)
EXIT ; Exit module => cleanup for HBHCXMA
"RTN","HBHCXMA1",48,0)
 K DILOCKTM,HBHC,HBHCACTN,HBHCADDT,HBHCADTA,HBHCAFLG,HBHCBHVA,HBHCBLDA,HBHCBTHA,HBHCBWLA,HBHCBYR,HBHCCM,HBHCCARE,HBHCCDTS,HBHCCNTY,HBHCCURJ,HBHCCURK,HBHCDATE,HBHCDFN,HBHCDPT0,HBHCDR,HBHCDRSA,HBHCDSOA,HBHCEATA,HBHCELGE,HBHCEND,HBHCETH
"RTN","HBHCXMA1",49,0)
 K HBHCEXCA,HBHCFIL,HBHCFLD,HBHCFLD1,HBHCFLD2,HBHCFLG,HBHCFORM,HBHCHERA,HBHCHOSP,HBHCI,HBHCICDA,HBHCIEN,HBHCIEN2,HBHCIENP,HBHCINFO,HBHCJ,HBHCK,HBHCL,HBHCLIVE,HBHCLMTA,HBHCLNTH,HBHCMARE,HBHCMFHP,HBHCMFHS,HBHCMOBA,HBHCMODA,HBHCMPT
"RTN","HBHCXMA1",50,0)
 K HBHCNAME,HBHCNDX1,HBHCNDX2,HBHCNOD3,HBHCNODE,HBHCPSRV,HBHCPTF,HBHCPTFV,HBHCRACE,HBHCRC,HBHCREC,HBHCRECA,HBHCREJ,HBHCREJD,HBHCRFIN,HBHCRFLG,HBHCRTDT,HBHCRTPD,HBHCSEX,HBHCSP1,HBHCSP14,HBHCSP2,HBHCSP4,HBHCSP5,HBHCSP6,HBHCSP8
"RTN","HBHCXMA1",51,0)
 K HBHCSSN,HBHCST,HBHCSX,HBHCT103,HBHCTDY,HBHCTLTA,HBHCTRNA,HBHCTYPE,HBHCVAR,HBHCVISA,HBHCWLKA,HBHCX,HBHCXMT3,HBHCZIP,X,Y,%DT
"RTN","HBHCXMA1",52,0)
 Q
"RTN","HBHCXMD")
0^11^B26724390^B23836635
"RTN","HBHCXMD",1,0)
HBHCXMD ;LR VAMC(IRMS)/MJT - HBHC populate ^HBHC(634) with Discharge Data or ^HBHC(634.3), file of records in ^HBHC(631) containing missing/erroneous data, called by ^HBHCFILE, calls ^HBHCXMD1 ;9/02/09
"RTN","HBHCXMD",2,0)
 ;;1.0;HOSPITAL BASED HOME CARE;**4,6,9,10,13,19,24,25**;NOV 01, 1993;Build 45
"RTN","HBHCXMD",3,0)
 ;
"RTN","HBHCXMD",4,0)
 ; This routine references the following supported ICRs:
"RTN","HBHCXMD",5,0)
 ; 5747    $$CODEC^ICDEX
"RTN","HBHCXMD",6,0)
 ;
"RTN","HBHCXMD",7,0)
 ;******************************************************************************
"RTN","HBHCXMD",8,0)
 ;******************************************************************************
"RTN","HBHCXMD",9,0)
 ;                       --- ROUTINE MODIFICATION LOG ---
"RTN","HBHCXMD",10,0)
 ;        
"RTN","HBHCXMD",11,0)
 ;PKG/PATCH    DATE        DEVELOPER    MODIFICATION
"RTN","HBHCXMD",12,0)
 ;-----------  ----------  -----------  ----------------------------------------
"RTN","HBHCXMD",13,0)
 ;HBH*1.0*25   APR  2012   K GUPTA      Support for ICD-10 Coding System
"RTN","HBHCXMD",14,0)
 ;******************************************************************************
"RTN","HBHCXMD",15,0)
 ;******************************************************************************
"RTN","HBHCXMD",16,0)
 ;
"RTN","HBHCXMD",17,0)
 D START^HBHCXMD1
"RTN","HBHCXMD",18,0)
LOOP ; Loop thru ^HBHC(631) "AF","N" cross-ref to create nodes in ^HBHC(634) => transmit or ^HBHC(634.3) => Discharge Error(s) file
"RTN","HBHCXMD",19,0)
 S HBHCDFN="" F  S HBHCDFN=$O(^HBHC(631,"AF","N",HBHCDFN)) Q:HBHCDFN=""  S HBHCFLG=1,HBHCCONT=0 D SETNODE I HBHCFLG D:HBHCCONT TRANS D:'HBHCCONT ERROR
"RTN","HBHCXMD",20,0)
EXIT ; Exit module
"RTN","HBHCXMD",21,0)
 D EXIT^HBHCXMD1
"RTN","HBHCXMD",22,0)
 Q
"RTN","HBHCXMD",23,0)
SETNODE ; Set node in ^HBHC(634) (Transmit) or ^HBHC(634.3) (Discharge Error(s))
"RTN","HBHCXMD",24,0)
 S HBHCNOD0=^HBHC(631,HBHCDFN,0),HBHCNOD1=$G(^HBHC(631,HBHCDFN,1)),HBHCXMT5=$P(HBHCNOD1,U,18)
"RTN","HBHCXMD",25,0)
 ; Quit if discharge date is greater than HBHCLSDT (last date to include in transmit set up in ^HBHCFILE)
"RTN","HBHCXMD",26,0)
 I $P(HBHCNOD0,U,40)>HBHCLSDT S HBHCFLG=0 Q
"RTN","HBHCXMD",27,0)
 S (HBHCDR1,HBHCDR2,HBHCDR3,HBHCDR4,HBHCDR5)=""
"RTN","HBHCXMD",28,0)
 S HBHCTFLG=0 S:($P(HBHCNOD0,U,45)]"")!($P(HBHCNOD0,U,46)]"") HBHCTFLG=1
"RTN","HBHCXMD",29,0)
 S HBHCDFLG=0 F HBHCL=47:1:55 Q:HBHCDFLG  S:$P(HBHCNOD0,U,HBHCL)]"" HBHCDFLG=1
"RTN","HBHCXMD",30,0)
 I HBHCNOD1]"" F HBHCM=1:1:10 Q:HBHCDFLG  S:$P(HBHCNOD1,U,HBHCM)]"" HBHCDFLG=1
"RTN","HBHCXMD",31,0)
 S HBHCADDT=$S($P(HBHCNOD0,U,18)]"":$E($P(HBHCNOD0,U,18),4,5)_$E($P(HBHCNOD0,U,18),6,7)_(1700+$E($P(HBHCNOD0,U,18),1,3)),$P(HBHCNOD0,U,2)]"":$E($P(HBHCNOD0,U,2),4,5)_$E($P(HBHCNOD0,U,2),6,7)_(1700+$E($P(HBHCNOD0,U,2),1,3)),1:"")
"RTN","HBHCXMD",32,0)
 S HBHCDSDT=$S($P(HBHCNOD0,U,40)]"":$E($P(HBHCNOD0,U,40),4,5)_$E($P(HBHCNOD0,U,40),6,7)_(1700+$E($P(HBHCNOD0,U,40),1,3)),1:"")
"RTN","HBHCXMD",33,0)
 K HBHCDDTA F HBHCI=1:1:4 S HBHCFLD=$P(HBHCFLD1,U,HBHCI) S:HBHCFLD]"" HBHCDDTA=1 S @HBHCFLD=$S($P(HBHCNOD0,U,HBHCI+40)]"":$P(HBHCNOD0,U,HBHCI+40),1:"") D:@HBHCFLD="" DFLT1^HBHCXMD1
"RTN","HBHCXMD",34,0)
 S:((HBHCDSDT="")&((HBHCDFLG=1)!(HBHCTFLG=1)!($D(HBHCDDTA)))) HBHCDR1="39;"_HBHCDR1
"RTN","HBHCXMD",35,0)
 Q:HBHCSTAT=""
"RTN","HBHCXMD",36,0)
 I HBHCSTAT=4 I (HBHCDFLG)!(HBHCTFLG) S HBHCDR1=HBHCDR1_"43;" Q
"RTN","HBHCXMD",37,0)
 I (HBHC359[(U_HBHCSTAT_U))&(HBHCTFLG) S HBHCDR1=HBHCDR1_"43;" Q
"RTN","HBHCXMD",38,0)
 I HBHCNOD1]"" I ($P(HBHCNOD1,U,15)]"")&(HBHCSTAT'=4) S HBHCDR1=HBHCDR1_"43;" Q
"RTN","HBHCXMD",39,0)
 S HBHCDEST=$S($P(HBHCNOD0,U,45)]"":$P(HBHCNOD0,U,45),1:HBHCSP1) S:(HBHC12[(U_HBHCSTAT_U))&(HBHCDEST=HBHCSP1) HBHCDR1=HBHCDR1_"44;"
"RTN","HBHCXMD",40,0)
 S HBHCAGCY=$S($P(HBHCNOD0,U,46)]"":$P(HBHCNOD0,U,46),1:HBHCSP1) S:(HBHC12[(U_HBHCSTAT_U))&(HBHCAGCY=HBHCSP1) HBHCDR1=HBHCDR1_"45;"
"RTN","HBHCXMD",41,0)
 I $P(HBHCNOD0,U,47)]"" D  I 1
"RTN","HBHCXMD",42,0)
 . N DXCODE
"RTN","HBHCXMD",43,0)
 . S DXCODE=$$CODEC^ICDEX(80,$P(HBHCNOD0,U,47))
"RTN","HBHCXMD",44,0)
 . S HBHCICDD=$P(DXCODE,".",1)_$P(DXCODE,".",2)
"RTN","HBHCXMD",45,0)
 E  S HBHCICDD=HBHCSP8
"RTN","HBHCXMD",46,0)
 S:$L(HBHCICDD)<8 HBHCICDD=HBHCICDD_$J("",8-$L(HBHCICDD)) D:(HBHCSTAT'=4)&(HBHCICDD=HBHCSP8) ICDDFLT^HBHCXMD1
"RTN","HBHCXMD",47,0)
 F HBHCJ=1:1:8 S HBHCFLD=$P(HBHCFLD2,U,HBHCJ) S @HBHCFLD=$S($P(HBHCNOD0,U,HBHCJ+47)]"":$P(HBHCNOD0,U,HBHCJ+47),1:HBHCSP1) D:(HBHCSTAT'=4)&(@HBHCFLD=HBHCSP1) DFLT2^HBHCXMD1
"RTN","HBHCXMD",48,0)
 F HBHCK=1:1:10 S HBHCFLD=$P(HBHCFLD3,U,HBHCK) S @HBHCFLD=$S($P(HBHCNOD1,U,HBHCK)]"":$P(HBHCNOD1,U,HBHCK),1:HBHCSP1) D:(HBHCSTAT'=4)&(@HBHCFLD=HBHCSP1) DFLT3^HBHCXMD1
"RTN","HBHCXMD",49,0)
 Q:(HBHCADDT="")!(HBHCDR1]"")!(HBHCDR2]"")!(HBHCDR3]"")!(HBHCDR4]"")!(HBHCDR5]"")
"RTN","HBHCXMD",50,0)
 S HBHCCONT=1
"RTN","HBHCXMD",51,0)
 S HBHCNAME=$E($P(^DPT($P(HBHCNOD0,U),0),U),1,5) S:$L(HBHCNAME)<HBHCLNTH HBHCNAME=HBHCNAME_$J("",HBHCLNTH-$L(HBHCNAME))
"RTN","HBHCXMD",52,0)
 S HBHCSSN=$P(^DPT($P(HBHCNOD0,U),0),U,9)
"RTN","HBHCXMD",53,0)
 S HBHCREC=HBHCFORM_HBHCHOSP_HBHCSSN_HBHCDSDT_HBHCELGD_HBHCMARD_HBHCLIVD_HBHCSTAT_HBHCDEST_HBHCAGCY_HBHCADDT_HBHCNAME_HBHCICDD_HBHCVISD_HBHCHERD_HBHCEXCD_HBHCRECD_HBHCBTHD_HBHCDRSD_HBHCTLTD_HBHCTRND_HBHCEATD_HBHCWLKD_HBHCBWLD_HBHCBLDD
"RTN","HBHCXMD",54,0)
 S HBHCREC=HBHCREC_HBHCMOBD_HBHCADTD_HBHCBHVD_HBHCDSOD_HBHCMODD_HBHCLMTD_HBHCS129
"RTN","HBHCXMD",55,0)
 Q
"RTN","HBHCXMD",56,0)
TRANS ; Set node in ^HBHC(634) transmit file & flag record as 'F" (filed for transmit) in ^HBHC(631)
"RTN","HBHCXMD",57,0)
 L +^HBHC(634,0):$S($D(DILOCKTM):DILOCKTM,1:3) Q:'$T  S HBHCNDX1=$P(^HBHC(634,0),U,3)+1,$P(^HBHC(634,0),U,3)=HBHCNDX1,$P(^HBHC(634,0),U,4)=$P(^HBHC(634,0),U,4)+1 L -^HBHC(634,0)
"RTN","HBHCXMD",58,0)
 S $P(^HBHC(634,HBHCNDX1,0),U)=HBHCREC,^HBHC(634,"B",$E(HBHCREC,1,30),HBHCNDX1)=""
"RTN","HBHCXMD",59,0)
 L +^HBHC(631,HBHCDFN,1):$S($D(DILOCKTM):DILOCKTM,1:3) Q:'$T  K:HBHCXMT5]"" ^HBHC(631,"AF",HBHCXMT5,HBHCDFN) S $P(^HBHC(631,HBHCDFN,1),U,18)="F",^HBHC(631,"AF","F",HBHCDFN)="",$P(^HBHC(631,HBHCDFN,1),U,22)=HBHCTDY L -^HBHC(631,HBHCDFN,1)
"RTN","HBHCXMD",60,0)
 Q
"RTN","HBHCXMD",61,0)
ERROR ; Set node in ^HBHC(634.3) if data is incomplete or proper fields invalid for 'Discharge Status'
"RTN","HBHCXMD",62,0)
 L +^HBHC(634.3,0):$S($D(DILOCKTM):DILOCKTM,1:3) Q:'$T  S HBHCNDX2=$P(^HBHC(634.3,0),U,3)+1,$P(^HBHC(634.3,0),U,3)=HBHCNDX2,$P(^HBHC(634.3,0),U,4)=$P(^HBHC(634.3,0),U,4)+1 L -^HBHC(634.3,0)
"RTN","HBHCXMD",63,0)
 S ^HBHC(634.3,HBHCNDX2,0)=$P(HBHCNOD0,U)_U_HBHCDFN
"RTN","HBHCXMD",64,0)
 S:HBHCDR1]"" ^HBHC(634.3,HBHCNDX2,1)=HBHCDR1
"RTN","HBHCXMD",65,0)
 S:HBHCDR2]"" ^HBHC(634.3,HBHCNDX2,2)=HBHCDR2
"RTN","HBHCXMD",66,0)
 S:HBHCDR3]"" ^HBHC(634.3,HBHCNDX2,3)=HBHCDR3
"RTN","HBHCXMD",67,0)
 S:HBHCDR4]"" ^HBHC(634.3,HBHCNDX2,4)=HBHCDR4
"RTN","HBHCXMD",68,0)
 S:HBHCDR5]"" ^HBHC(634.3,HBHCNDX2,5)=HBHCDR5
"RTN","HBHCXMD",69,0)
 S ^HBHC(634.3,"B",$P(HBHCNOD0,U),HBHCNDX2)=""
"RTN","HBHCXMD",70,0)
 Q
"RTN","HBHCXMD1")
0^12^B17012648^B14260181
"RTN","HBHCXMD1",1,0)
HBHCXMD1 ;LR VAMC(IRMS)/MJT - HBHC, called by ^HBHCXMD, calls HOSP^HBHCUTL1 ;9/2/09
"RTN","HBHCXMD1",2,0)
 ;;1.0;HOSPITAL BASED HOME CARE;**2,6,19,24,25**;NOV 01, 1993;Build 45
"RTN","HBHCXMD1",3,0)
 ;
"RTN","HBHCXMD1",4,0)
 ; This routine references the following supported ICRs:
"RTN","HBHCXMD1",5,0)
 ; 5747    $$CODEC^ICDEX
"RTN","HBHCXMD1",6,0)
 ;
"RTN","HBHCXMD1",7,0)
 ;******************************************************************************
"RTN","HBHCXMD1",8,0)
 ;******************************************************************************
"RTN","HBHCXMD1",9,0)
 ;                       --- ROUTINE MODIFICATION LOG ---
"RTN","HBHCXMD1",10,0)
 ;        
"RTN","HBHCXMD1",11,0)
 ;PKG/PATCH    DATE        DEVELOPER    MODIFICATION
"RTN","HBHCXMD1",12,0)
 ;-----------  ----------  -----------  ----------------------------------------
"RTN","HBHCXMD1",13,0)
 ;HBH*1.0*25   APR  2012   K GUPTA      Support for ICD-10 Coding System
"RTN","HBHCXMD1",14,0)
 ;******************************************************************************
"RTN","HBHCXMD1",15,0)
 ;******************************************************************************
"RTN","HBHCXMD1",16,0)
 ;
"RTN","HBHCXMD1",17,0)
START ; Initialization
"RTN","HBHCXMD1",18,0)
 W !,"Processing Discharge/Form 5 Data"
"RTN","HBHCXMD1",19,0)
 S HBHCFORM=5,HBHC12="^1^2^",HBHC359="^3^5^9^",$P(HBHCSP1," ",2)="",$P(HBHCSP4," ",5)="",$P(HBHCSP8," ",9)="",$P(HBHCS129," ",130)="",HBHCLNTH=5
"RTN","HBHCXMD1",20,0)
 D HOSP^HBHCUTL1
"RTN","HBHCXMD1",21,0)
 S HBHCFLD1="HBHCELGD^HBHCMARD^HBHCLIVD^HBHCSTAT"
"RTN","HBHCXMD1",22,0)
 S HBHCFLD2="HBHCVISD^HBHCHERD^HBHCEXCD^HBHCRECD^HBHCBTHD^HBHCDRSD^HBHCTLTD^HBHCTRND"
"RTN","HBHCXMD1",23,0)
 S HBHCFLD3="HBHCEATD^HBHCWLKD^HBHCBWLD^HBHCBLDD^HBHCMOBD^HBHCADTD^HBHCBHVD^HBHCDSOD^HBHCMODD^HBHCLMTD"
"RTN","HBHCXMD1",24,0)
 K %DT S X="T" D ^%DT S HBHCTDY=Y
"RTN","HBHCXMD1",25,0)
 Q
"RTN","HBHCXMD1",26,0)
DFLT1 ; Process fields 5, 10, & 11 as default values for fields 40, 41 & 42
"RTN","HBHCXMD1",27,0)
 S HBHCX=$S(HBHCI=1:6,HBHCI=2:11,HBHCI=3:12,1:""),HBHCDFLT=""
"RTN","HBHCXMD1",28,0)
 S:$P(HBHCNOD0,U,HBHCX)]"" HBHCDFLT=$P($P(^DD(631,(HBHCX-1),0),($P(HBHCNOD0,U,HBHCX)_":"),2),";")
"RTN","HBHCXMD1",29,0)
 S HBHCDR1=$S(HBHCDFLT]"":HBHCDR1_(HBHCI+39)_"//"_HBHCDFLT_";",1:HBHCDR1_(HBHCI+39)_";")
"RTN","HBHCXMD1",30,0)
 Q
"RTN","HBHCXMD1",31,0)
ICDDFLT ; Process field 18 as default value for field 46
"RTN","HBHCXMD1",32,0)
 S HBHCDFLT=""
"RTN","HBHCXMD1",33,0)
 S HBHCDFLT=$$DFLTDCDX^HBHCLKU1(HBHCDFN)  ;default only if same coding system
"RTN","HBHCXMD1",34,0)
 S:HBHCDFLT]"" HBHCDFLT=$$CODEC^ICDEX(80,HBHCDFLT)
"RTN","HBHCXMD1",35,0)
 S HBHCDR1=HBHCDR1_"46"_$S(HBHCDFLT]"":"//"_HBHCDFLT,1:"")_";"
"RTN","HBHCXMD1",36,0)
 Q
"RTN","HBHCXMD1",37,0)
DFLT2 ; Process fields 19 - 26 as default values for fields 47 - 54
"RTN","HBHCXMD1",38,0)
 S HBHCDFLT=""
"RTN","HBHCXMD1",39,0)
 S:(HBHCJ=3)&($P(HBHCNOD0,U,22)]"") HBHCDFLT=$P(^HBHC(631.2,$P(HBHCNOD0,U,22),0),U)
"RTN","HBHCXMD1",40,0)
 S:(HBHCJ=4)&($P(HBHCNOD0,U,23)]"") HBHCDFLT=$P(^HBHC(631.3,$P(HBHCNOD0,U,23),0),U)
"RTN","HBHCXMD1",41,0)
 S:(HBHCJ'=3)&(HBHCJ'=4)&($P(HBHCNOD0,U,HBHCJ+19)]"") HBHCDFLT=$P($P(^DD(631,(HBHCJ+18),0),($P(HBHCNOD0,U,HBHCJ+19)_":"),2),";")
"RTN","HBHCXMD1",42,0)
 S:(HBHCJ=1)!(HBHCJ=2) HBHCDR1=$S(HBHCDFLT]"":HBHCDR1_(HBHCJ+46)_"//"_HBHCDFLT_";",1:HBHCDR1_(HBHCJ+46)_";")
"RTN","HBHCXMD1",43,0)
 S:(HBHCJ=3)!(HBHCJ=4)!(HBHCJ=5) HBHCDR2=$S(HBHCDFLT]"":HBHCDR2_(HBHCJ+46)_"//"_HBHCDFLT_";",1:HBHCDR2_(HBHCJ+46)_";")
"RTN","HBHCXMD1",44,0)
 S:(HBHCJ=6)!(HBHCJ=7)!(HBHCJ=8) HBHCDR3=$S(HBHCDFLT]"":HBHCDR3_(HBHCJ+46)_"//"_HBHCDFLT_";",1:HBHCDR3_(HBHCJ+46)_";")
"RTN","HBHCXMD1",45,0)
 Q
"RTN","HBHCXMD1",46,0)
DFLT3 ; Process fields 27 - 36 as default values for fields 55 - 64
"RTN","HBHCXMD1",47,0)
 S HBHCDFLT=""
"RTN","HBHCXMD1",48,0)
 S:$P(HBHCNOD0,U,HBHCK+27)]"" HBHCDFLT=$P($P(^DD(631,(HBHCK+26),0),($P(HBHCNOD0,U,HBHCK+27)_":"),2),";")
"RTN","HBHCXMD1",49,0)
 S:HBHCK=1 HBHCDR3=$S(HBHCDFLT]"":HBHCDR3_(HBHCK+54)_"//"_HBHCDFLT_";",1:HBHCDR3_(HBHCK+54)_";")
"RTN","HBHCXMD1",50,0)
 S:(HBHCK>1)&(HBHCK<6) HBHCDR4=$S(HBHCDFLT]"":HBHCDR4_(HBHCK+54)_"//"_HBHCDFLT_";",1:HBHCDR4_(HBHCK+54)_";")
"RTN","HBHCXMD1",51,0)
 S:HBHCK>5 HBHCDR5=$S(HBHCDFLT]"":HBHCDR5_(HBHCK+54)_"//"_HBHCDFLT_";",1:HBHCDR5_(HBHCK+54)_";")
"RTN","HBHCXMD1",52,0)
 Q
"RTN","HBHCXMD1",53,0)
EXIT ; Exit module
"RTN","HBHCXMD1",54,0)
 K DILOCKTM,HBHC12,HBHC359,HBHCADDT,HBHCADTD,HBHCAGCY,HBHCBHVD,HBHCBLDD,HBHCBTHD,HBHCBWLD,HBHCCONT,HBHCDATE,HBHCDDTA,HBHCDEST,HBHCDFLG,HBHCDFLT,HBHCDFN,HBHCDR1,HBHCDR2,HBHCDR3,HBHCDR3,HBHCDR4,HBHCDR5,HBHCDRSD,HBHCDSDT,HBHCDSOD,HBHCEATD
"RTN","HBHCXMD1",55,0)
 K HBHCELGD,HBHCEXCD,HBHCFLD,HBHCFLD1,HBHCFLD2,HBHCFLD3,HBHCFLG,HBHCFORM,HBHCHERD,HBHCHOSP,HBHCI,HBHCICDD,HBHCJ,HBHCK,HBHCL,HBHCLIVD,HBHCLMTD,HBHCLNTH,HBHCM,HBHCMARD,HBHCMOBD,HBHCMODD,HBHCNAME,HBHCNDX1,HBHCNDX2,HBHCNOD0
"RTN","HBHCXMD1",56,0)
 K HBHCNOD1,HBHCREC,HBHCRECD,HBHCSP1,HBHCS129,HBHCSP4,HBHCSP8,HBHCSSN,HBHCSTAT,HBHCTDY,HBHCTFLG,HBHCTLTD,HBHCTRND,HBHCVISD,HBHCWLKD,HBHCX,HBHCXMT5,X,Y,%DT
"RTN","HBHCXMD1",57,0)
 Q
"RTN","HBHCXMV")
0^13^B20835749^B19281997
"RTN","HBHCXMV",1,0)
HBHCXMV ;LR VAMC(IRMS)/MJT - HBHC populate ^HBHC(634 with Visit Data, or ^HBHC(634.5, file of recs in ^HBHC(632 w/pseudo SSNs, called by ^HBHCFILE, calls HBHCXMV1 ;Oct 2000
"RTN","HBHCXMV",2,0)
 ;;1.0;HOSPITAL BASED HOME CARE;**2,5,6,9,12,15,17,14,19,24,25**;NOV 01, 1993;Build 45
"RTN","HBHCXMV",3,0)
 ;******************************************************************************
"RTN","HBHCXMV",4,0)
 ;******************************************************************************
"RTN","HBHCXMV",5,0)
 ;                       --- ROUTINE MODIFICATION LOG ---
"RTN","HBHCXMV",6,0)
 ;        
"RTN","HBHCXMV",7,0)
 ;PKG/PATCH    DATE        DEVELOPER    MODIFICATION
"RTN","HBHCXMV",8,0)
 ;-----------  ----------  -----------  ----------------------------------------
"RTN","HBHCXMV",9,0)
 ;HBH*1.0*25   APR  2012   K GUPTA      Support for ICD-10 Coding System
"RTN","HBHCXMV",10,0)
 ;******************************************************************************
"RTN","HBHCXMV",11,0)
 ;******************************************************************************
"RTN","HBHCXMV",12,0)
 ;
"RTN","HBHCXMV",13,0)
 D START^HBHCXMV1
"RTN","HBHCXMV",14,0)
LOOP ; Loop thru ^HBHC(632) "AC","N" cross-ref to create nodes in ^HBHC(634) => transmit
"RTN","HBHCXMV",15,0)
 S HBHCDFN="" F  S HBHCDFN=$O(^HBHC(632,"AC","N",HBHCDFN)) Q:HBHCDFN=""  D SETNODE
"RTN","HBHCXMV",16,0)
EXIT ; Exit module
"RTN","HBHCXMV",17,0)
 D EXIT^HBHCXMV1
"RTN","HBHCXMV",18,0)
 Q
"RTN","HBHCXMV",19,0)
SETNODE ; Set node in ^HBHC(634) (Transmit)
"RTN","HBHCXMV",20,0)
 S HBHCINFO=^HBHC(632,HBHCDFN,0),HBHCXMT4=$P(HBHCINFO,U,8),HBHCAPDT=$P(HBHCINFO,U,2),HBHCSSN=$P(^DPT($P(HBHCINFO,U),0),U,9)
"RTN","HBHCXMV",21,0)
 Q:$P(HBHCINFO,U,7)]""  ; cancelled/no show appointment
"RTN","HBHCXMV",22,0)
 Q:HBHCAPDT>HBHCLSDT  ; Visit appointment date > HBHCLSDT (last date to include in transmit set up in ^HBHCFILE)
"RTN","HBHCXMV",23,0)
 I HBHCAPDT<2961001 D PCE^HBHCXMV1 Q
"RTN","HBHCXMV",24,0)
 I HBHCSSN'?9N D PSSN^HBHCXMV1 Q
"RTN","HBHCXMV",25,0)
 S HBHCPRV=+^HBHC(631.4,$P(HBHCINFO,U,4),0) S:$L(HBHCPRV)'=4 HBHCPRV=HBHCPRV_HBHCSP1
"RTN","HBHCXMV",26,0)
 S HBHCTIME=$P(HBHCAPDT,".",2) S:$L(HBHCTIME)<4 HBHCTIME=HBHCTIME_$E(HBHCZRO4,1,(4-($L(HBHCTIME)))) S:$L(HBHCTIME)>4 HBHCTIME=$E(HBHCTIME,1,4)
"RTN","HBHCXMV",27,0)
 S HBHCDATE=$E(HBHCAPDT,4,5)_$E(HBHCAPDT,6,7)_(1700+$E(HBHCAPDT,1,3))_HBHCTIME
"RTN","HBHCXMV",28,0)
 S HBHCLNME=$P($P(^DPT($P(HBHCINFO,U),0),U),",") S:$L(HBHCLNME)'=11 HBHCLNME=$S($L(HBHCLNME)<11:HBHCLNME_$E(HBHCSP10,1,11-$L(HBHCLNME)),1:$E(HBHCLNME,1,11))
"RTN","HBHCXMV",29,0)
 S HBHCQAI=$S(($L($P(HBHCINFO,U,16))=1)&($E(HBHCINFO,U,16)=""):HBHCSP1_$P(HBHCINFO,U,16),($L($P(HBHCINFO,U,16))=1)&($E(HBHCINFO,U,16)]""):$P(HBHCINFO,U,16)_HBHCSP1,$L($P(HBHCINFO,U,16))=2:$P(HBHCINFO,U,16),1:HBHCSP2)
"RTN","HBHCXMV",30,0)
DX ; Dx
"RTN","HBHCXMV",31,0)
 D INIT,DX^HBHCUTL3
"RTN","HBHCXMV",32,0)
 S HBHCL=0
"RTN","HBHCXMV",33,0)
 F  S HBHCL=$O(HBHCDX(HBHCL)) Q:HBHCL'>0  D
"RTN","HBHCXMV",34,0)
 . S HBHCDX=$P(HBHCDX(HBHCL),"  ")
"RTN","HBHCXMV",35,0)
 . S HBHCDX=$P(HBHCDX,".")_$P(HBHCDX,".",2)
"RTN","HBHCXMV",36,0)
 . S HBHCDX(HBHCL)=$S($L(HBHCDX)'=8:HBHCDX_$E(HBHCSP8,1,8-$L(HBHCDX)),1:HBHCDX)
"RTN","HBHCXMV",37,0)
 ; Note:  HBHCI initialized here vs in CPT loop, since need HBHCI to continue for each 10 CPT code iteration
"RTN","HBHCXMV",38,0)
 S (HBHCFLAG,HBHCI,HBHCL)=0 F  S HBHCL=$O(HBHCDX(HBHCL)) Q:HBHCL'>0  S HBHCCNT1=HBHCCNT1+1,@("HBHCDX"_HBHCCNT1)=HBHCDX(HBHCL) D:(HBHCCNT1=5)&('HBHCFLAG) CPT D:HBHCCNT1=5 WRITE
"RTN","HBHCXMV",39,0)
 F  D:'HBHCFLAG CPT D WRITE Q:HBHCFLAG
"RTN","HBHCXMV",40,0)
 Q
"RTN","HBHCXMV",41,0)
CPT ; CPT Codes
"RTN","HBHCXMV",42,0)
 F HBHCCNT=1:1:10 S HBHCI=$O(^HBHC(632,HBHCDFN,2,HBHCI)) Q:HBHCI'>0  S HBHCNOD2=^HBHC(632,HBHCDFN,2,HBHCI,0) D SET
"RTN","HBHCXMV",43,0)
 S:HBHCI'>0 HBHCFLAG=1
"RTN","HBHCXMV",44,0)
 Q
"RTN","HBHCXMV",45,0)
SET ; Set CPT variables
"RTN","HBHCXMV",46,0)
 I HBHCCNT<10 S @("HBHCCPT"_HBHCCNT)=$S($P(HBHCNOD2,U)]"":$E($P($G(^ICPT($P(HBHCNOD2,U),0)),U),1,5),1:HBHCSP5) S:$L(@("HBHCCPT"_HBHCCNT))'=5 @("HBHCCPT"_HBHCCNT)=@("HBHCCPT"_HBHCCNT)_$E(HBHCSP5,1,5-$L(@("HBHCCPT"_HBHCCNT)))
"RTN","HBHCXMV",47,0)
 I HBHCCNT=10 S HBHCCP10=$S($P(HBHCNOD2,U)]"":$E($P($G(^ICPT($P(HBHCNOD2,U),0)),U),1,5),1:HBHCSP5) S:$L(HBHCCP10)'=5 HBHCCP10=HBHCCP10_$E(HBHCSP5,1,5-$L(HBHCCP10))
"RTN","HBHCXMV",48,0)
 Q
"RTN","HBHCXMV",49,0)
WRITE ; Write transmit record, separate records containing max 5 DX & 10 CPTs each are generated for same visit if > 5 DX or > 10 CPTs exist
"RTN","HBHCXMV",50,0)
 Q:(HBHCDX1=HBHCSP8)&(HBHCCPT1=HBHCSP5)
"RTN","HBHCXMV",51,0)
 L +^HBHC(634,0):$S($D(DILOCKTM):DILOCKTM,1:3) Q:'$T  S HBHCNDX1=$P(^HBHC(634,0),U,3)+1 F  Q:'$D(^HBHC(634,HBHCNDX1))  S HBHCNDX1=HBHCNDX1+1
"RTN","HBHCXMV",52,0)
 S $P(^HBHC(634,0),U,3)=HBHCNDX1,$P(^HBHC(634,0),U,4)=$P(^HBHC(634,0),U,4)+1 L -^HBHC(634,0)
"RTN","HBHCXMV",53,0)
 S HBHCREC=HBHCFORM_HBHCHOSP_HBHCSSN_HBHCDATE_HBHCPRV_HBHCLNME_HBHCQAI_HBHCDX1_HBHCDX2_HBHCDX3_HBHCDX4_HBHCDX5_HBHCCPT1_HBHCCPT2_HBHCCPT3_HBHCCPT4_HBHCCPT5_HBHCCPT6_HBHCCPT7_HBHCCPT8_HBHCCPT9_HBHCCP10_HBHCSP64
"RTN","HBHCXMV",54,0)
 S ^HBHC(634,HBHCNDX1,0)=HBHCREC,^HBHC(634,"B",$E(HBHCREC,1,30),HBHCNDX1)=""
"RTN","HBHCXMV",55,0)
 ; Flag record as filed
"RTN","HBHCXMV",56,0)
 L +^HBHC(632,HBHCDFN,0):$S($D(DILOCKTM):DILOCKTM,1:3) Q:'$T  K:HBHCXMT4]"" ^HBHC(632,"AC",HBHCXMT4,HBHCDFN) S $P(^HBHC(632,HBHCDFN,0),U,8)="F",^HBHC(632,"AC","F",HBHCDFN)="",$P(^HBHC(632,HBHCDFN,0),U,9)=HBHCTDY L -^HBHC(632,HBHCDFN,0)
"RTN","HBHCXMV",57,0)
 ; Initialize QAI, DX & CPT fields to spaces after 1st record written to avoid multiple count(s) of same data when > 5 DX or > 10 CPTs exist
"RTN","HBHCXMV",58,0)
 S HBHCQAI=HBHCSP2
"RTN","HBHCXMV",59,0)
INIT ; Initialize variables
"RTN","HBHCXMV",60,0)
 F HBHCK=1:1:5 S @("HBHCDX"_HBHCK)=HBHCSP8
"RTN","HBHCXMV",61,0)
 S (HBHCCNT,HBHCCNT1)=0,HBHCCP10=HBHCSP5
"RTN","HBHCXMV",62,0)
 F HBHCJ=1:1:9 S @("HBHCCPT"_HBHCJ)=HBHCSP5
"RTN","HBHCXMV",63,0)
 Q
"RTN","HBHCXMV1")
0^19^B6370071^B5766233
"RTN","HBHCXMV1",1,0)
HBHCXMV1 ;LR VAMC(IRMS)/MJT - HBHC, called by ^HBHCXMV, entry points:  START, PCE, PSSN, & EXIT, calls HOSP^HBHCUTL1 ;Aug 2000
"RTN","HBHCXMV1",2,0)
 ;;1.0;HOSPITAL BASED HOME CARE;**6,15,14,19,24,25**;NOV 01, 1993;Build 45
"RTN","HBHCXMV1",3,0)
 ;******************************************************************************
"RTN","HBHCXMV1",4,0)
 ;******************************************************************************
"RTN","HBHCXMV1",5,0)
 ;                       --- ROUTINE MODIFICATION LOG ---
"RTN","HBHCXMV1",6,0)
 ;        
"RTN","HBHCXMV1",7,0)
 ;PKG/PATCH    DATE        DEVELOPER    MODIFICATION
"RTN","HBHCXMV1",8,0)
 ;-----------  ----------  -----------  ----------------------------------------
"RTN","HBHCXMV1",9,0)
 ;HBH*1.0*25   APR  2012   K GUPTA      Support for ICD-10 Coding System
"RTN","HBHCXMV1",10,0)
 ;******************************************************************************
"RTN","HBHCXMV1",11,0)
 ;******************************************************************************
"RTN","HBHCXMV1",12,0)
 ;
"RTN","HBHCXMV1",13,0)
START ; Initialization
"RTN","HBHCXMV1",14,0)
 W !,"Processing Visit/Form 4 Data"
"RTN","HBHCXMV1",15,0)
 K ^HBHC(634.5) S ^HBHC(634.5,0)="HBHC PSEUDO SSN ERROR(S)^634.5P^"
"RTN","HBHCXMV1",16,0)
 S HBHCFORM=4,$P(HBHCSP1," ",2)="",$P(HBHCSP2," ",3)="",$P(HBHCSP4," ",5)="",$P(HBHCSP5," ",6)="",$P(HBHCSP8," ",9)="",$P(HBHCSP10," ",11)="",$P(HBHCSP64," ",65)="",$P(HBHCZRO4,"0",5)=""
"RTN","HBHCXMV1",17,0)
 D HOSP^HBHCUTL1
"RTN","HBHCXMV1",18,0)
 K %DT S X="T" D ^%DT S HBHCTDY=Y
"RTN","HBHCXMV1",19,0)
 Q
"RTN","HBHCXMV1",20,0)
PCE ; Appointment pre-dates Patient Care Encounter (PCE)
"RTN","HBHCXMV1",21,0)
 S DIE="^HBHC(632,",DA=HBHCDFN,DR="7///O" D ^DIE
"RTN","HBHCXMV1",22,0)
 Q
"RTN","HBHCXMV1",23,0)
PSSN ; Patient has pseudo SSN
"RTN","HBHCXMV1",24,0)
 K DD,DO S DIC="^HBHC(634.5,",DIC(0)="MN",(X,DINUM)=$P(HBHCINFO,U) D FILE^DICN K DO
"RTN","HBHCXMV1",25,0)
 Q
"RTN","HBHCXMV1",26,0)
EXIT ; Exit module
"RTN","HBHCXMV1",27,0)
 K DA,DIC,DIE,DILOCKTM,DINUM,DR,DTOUT,HBHCAPDT,HBHCCNT,HBHCCNT1,HBHCCPT1,HBHCCPT2,HBHCCPT3,HBHCCPT4,HBHCCPT5,HBHCCPT6,HBHCCPT7,HBHCCPT8,HBHCCPT9,HBHCCP10,HBHCDATE,HBHCDFN,HBHCDX,HBHCDX1,HBHCDX2,HBHCDX3,HBHCDX4,HBHCDX5,HBHCFLAG,HBHCFORM
"RTN","HBHCXMV1",28,0)
 K HBHCHOSP,HBHCI,HBHCINFO,HBHCJ,HBHCK,HBHCL,HBHCLNME,HBHCNDX1,HBHCNDX2,HBHCNOD2,HBHCPRV,HBHCREC,HBHCQAI,HBHCSP1,HBHCSP10,HBHCSP2,HBHCSP4,HBHCSP5,HBHCSP8,HBHCSP64,HBHCSSN,HBHCSTDT,HBHCTDY,HBHCTIME,HBHCXMT4,HBHCZRO4,X,Y,%DT
"RTN","HBHCXMV1",29,0)
 Q
"UP",632,632.033,-1)
632^3
"UP",632,632.033,0)
632.033
"VER")
8.0^22.0
"^DD",631,631,18,0)
PRIMARY DIAGNOSIS @ ADMISSION^P80'^ICD9(^0;19^Q
"^DD",631,631,18,3)
Answer with ICD diagnosis code, or diagnosis description, of patient's primary diagnosis at time of admission.
"^DD",631,631,18,21,0)
^.001^2^2^3120618^^^^
"^DD",631,631,18,21,1,0)
This field represents patient's primary diagnosis at time of admission,
"^DD",631,631,18,21,2,0)
referencing ICD Diagnosis (80) file entries.
"^DD",631,631,18,"DT")
3120503
"^DD",631,631,46,0)
PRIMARY DIAGNOSIS @ DISCHARGE^P80'^ICD9(^0;47^Q
"^DD",631,631,46,3)
Answer with ICD diagnosis code, or diagnosis description, of patient's primary diagnosis at time of discharge.
"^DD",631,631,46,21,0)
^.001^2^2^3120306^^^
"^DD",631,631,46,21,1,0)
This field represents patient's primary diagnosis at time of discharge,
"^DD",631,631,46,21,2,0)
referencing ICD Diagnosis (80) file entries.
"^DD",631,631,46,"DT")
3120503
"^DD",632,632,33,0)
DX^632.033PA^^3;0
"^DD",632,632.033,0)
DX SUB-FIELD^^.01^1
"^DD",632,632.033,0,"NM","DX")

"^DD",632,632.033,.01,0)
DX^MRP80'^ICD9(^0;1^Q
"^DD",632,632.033,.01,1,0)
^.1
"^DD",632,632.033,.01,1,1,0)
632.033^B
"^DD",632,632.033,.01,1,1,1)
S ^HBHC(632,DA(1),3,"B",$E(X,1,30),DA)=""
"^DD",632,632.033,.01,1,1,2)
K ^HBHC(632,DA(1),3,"B",$E(X,1,30),DA)
"^DD",632,632.033,.01,3)
Field updated by package only, no user input.
"^DD",632,632.033,.01,21,0)
^^3^3^3120503^
"^DD",632,632.033,.01,21,1,0)
This field represents the patient's ICD Diagnosis (DX) Code(s) for the
"^DD",632,632.033,.01,21,2,0)
encounter.  Primary DX will be contained in the first entry within the
"^DD",632,632.033,.01,21,3,0)
multiple.  Field updated by package only, no user input.
"^DD",632,632.033,.01,"DT")
3000714
"BLD",8840,6)
^23
**END**
**END**

