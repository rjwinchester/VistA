Released HBH*1*27 SEQ #24
Extracted from mail message
**KIDS**:HBH*1.0*27^

**INSTALL NAME**
HBH*1.0*27
"BLD",9009,0)
HBH*1.0*27^HOSPITAL BASED HOME CARE^0^3140617^y
"BLD",9009,1,0)
^^6^6^3140617^
"BLD",9009,1,1,0)
This patch addresses one Home Based Primary Care (HBH) issue:
"BLD",9009,1,2,0)
 
"BLD",9009,1,3,0)
1. The BUILD/VERIFY TRANSMISSION FILE option currently lacks the 
"BLD",9009,1,4,0)
functionality to prevent test patient data from being built into the HBHC 
"BLD",9009,1,5,0)
TRANSMIT (#634) file for transmission to Austin. A request was made for 
"BLD",9009,1,6,0)
this functionality to be implemented. 
"BLD",9009,4,0)
^9.64PA^^
"BLD",9009,6.3)
2
"BLD",9009,"KRN",0)
^9.67PA^779.2^20
"BLD",9009,"KRN",.4,0)
.4
"BLD",9009,"KRN",.401,0)
.401
"BLD",9009,"KRN",.402,0)
.402
"BLD",9009,"KRN",.403,0)
.403
"BLD",9009,"KRN",.5,0)
.5
"BLD",9009,"KRN",.84,0)
.84
"BLD",9009,"KRN",3.6,0)
3.6
"BLD",9009,"KRN",3.8,0)
3.8
"BLD",9009,"KRN",9.2,0)
9.2
"BLD",9009,"KRN",9.8,0)
9.8
"BLD",9009,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",9009,"KRN",9.8,"NM",1,0)
HBHCFILE^^0^B36363460
"BLD",9009,"KRN",9.8,"NM","B","HBHCFILE",1)

"BLD",9009,"KRN",19,0)
19
"BLD",9009,"KRN",19.1,0)
19.1
"BLD",9009,"KRN",101,0)
101
"BLD",9009,"KRN",409.61,0)
409.61
"BLD",9009,"KRN",771,0)
771
"BLD",9009,"KRN",779.2,0)
779.2
"BLD",9009,"KRN",870,0)
870
"BLD",9009,"KRN",8989.51,0)
8989.51
"BLD",9009,"KRN",8989.52,0)
8989.52
"BLD",9009,"KRN",8994,0)
8994
"BLD",9009,"KRN","B",.4,.4)

"BLD",9009,"KRN","B",.401,.401)

"BLD",9009,"KRN","B",.402,.402)

"BLD",9009,"KRN","B",.403,.403)

"BLD",9009,"KRN","B",.5,.5)

"BLD",9009,"KRN","B",.84,.84)

"BLD",9009,"KRN","B",3.6,3.6)

"BLD",9009,"KRN","B",3.8,3.8)

"BLD",9009,"KRN","B",9.2,9.2)

"BLD",9009,"KRN","B",9.8,9.8)

"BLD",9009,"KRN","B",19,19)

"BLD",9009,"KRN","B",19.1,19.1)

"BLD",9009,"KRN","B",101,101)

"BLD",9009,"KRN","B",409.61,409.61)

"BLD",9009,"KRN","B",771,771)

"BLD",9009,"KRN","B",779.2,779.2)

"BLD",9009,"KRN","B",870,870)

"BLD",9009,"KRN","B",8989.51,8989.51)

"BLD",9009,"KRN","B",8989.52,8989.52)

"BLD",9009,"KRN","B",8994,8994)

"BLD",9009,"QDEF")
^^^^^^^^^^YES
"BLD",9009,"QUES",0)
^9.62^^
"BLD",9009,"REQB",0)
^9.611^1^1
"BLD",9009,"REQB",1,0)
HBH*1.0*24^2
"BLD",9009,"REQB","B","HBH*1.0*24",1)

"MBREQ")
0
"PKG",152,-1)
1^1
"PKG",152,0)
HOSPITAL BASED HOME CARE^HBH^HBH v1.0 Patch 4 w/Inits
"PKG",152,22,0)
^9.49I^1^1
"PKG",152,22,1,0)
1.0^2931101^2960926
"PKG",152,22,1,"PAH",1,0)
27^3140617
"PKG",152,22,1,"PAH",1,1,0)
^^6^6^3140617
"PKG",152,22,1,"PAH",1,1,1,0)
This patch addresses one Home Based Primary Care (HBH) issue:
"PKG",152,22,1,"PAH",1,1,2,0)
 
"PKG",152,22,1,"PAH",1,1,3,0)
1. The BUILD/VERIFY TRANSMISSION FILE option currently lacks the 
"PKG",152,22,1,"PAH",1,1,4,0)
functionality to prevent test patient data from being built into the HBHC 
"PKG",152,22,1,"PAH",1,1,5,0)
TRANSMIT (#634) file for transmission to Austin. A request was made for 
"PKG",152,22,1,"PAH",1,1,6,0)
this functionality to be implemented. 
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","HBHCFILE")
0^1^B36363460^B31778098
"RTN","HBHCFILE",1,0)
HBHCFILE ; LR VAMC(IRMS)/MJT-HBHC populates ^HBHC(632) visit file, & ^HBHC(634), file for transmitting to Austin, calls ^HBHCAPPT, ^HBHCXMC, ^HBHCXMA, ^HBHCXMV, ^HBHCXMD, & HBHCXMM ; Nov 1999
"RTN","HBHCFILE",2,0)
 ;;1.0;HOSPITAL BASED HOME CARE;**2,5,6,8,9,10,16,21,24,27**;NOV 01, 1993;Build 2
"RTN","HBHCFILE",3,0)
 ;
"RTN","HBHCFILE",4,0)
 ;
"RTN","HBHCFILE",5,0)
 ; Reference/ICR
"RTN","HBHCFILE",6,0)
 ; PATIENT FILE/10035
"RTN","HBHCFILE",7,0)
 ; REGISTRATION/3744
"RTN","HBHCFILE",8,0)
 ;
"RTN","HBHCFILE",9,0)
 ;
"RTN","HBHCFILE",10,0)
 I $P(^HBHC(631.9,1,0),U,5)="" W !!,"***  NOTICE:  Hospital Number is missing from System Parameter file (#631.9).",!,"Transmission file building CANNOT proceed without this information.  Contact"
"RTN","HBHCFILE",11,0)
 I $P(^HBHC(631.9,1,0),U,5)="" W !,"IRM to enter this information using FileMan.",! H 10 Q
"RTN","HBHCFILE",12,0)
 L +^HBHC(634.5,0):0 I '$T W $C(7),!!,"Another user has the pseudo SSN file locked." H 3 G EXIT
"RTN","HBHCFILE",13,0)
 I ($D(^HBHC(634.1,"B")))!($D(^HBHC(634.2,"B")))!($D(^HBHC(634.3,"B")))!($D(^HBHC(634.5,"B")))!($D(^HBHC(634.7,"B"))) W $C(7),!!,"Records containing errors exist and must be corrected before transmit",!,"file can be created or updated.",!! H 3 Q
"RTN","HBHCFILE",14,0)
EN ; Entry point
"RTN","HBHCFILE",15,0)
 I $P(^HBHC(631.9,1,0),U,8)]"" W $C(7),!,"File Update in progress.  Please try again later." H 3 Q
"RTN","HBHCFILE",16,0)
 W !!,"This option builds the file for transmission to Austin.  Do you wish to",!,"continue" S %=2 D YN^DICN
"RTN","HBHCFILE",17,0)
 I %=0 W !!,"A 'Yes' response will add records to the file.  A 'No' response will return",!,"to the menu without updating the file." G EN
"RTN","HBHCFILE",18,0)
 G:%'=1 EXIT
"RTN","HBHCFILE",19,0)
MONTH ; Calculate default month value & last date to be included for transmission
"RTN","HBHCFILE",20,0)
 S X="T" D ^%DT S X1=$P(Y,"."),X2=-28 D C^%DTC S DIR("B")=+$E(X,4,5)
"RTN","HBHCFILE",21,0)
 S DIR(0)="SX^1:January;2:February;3:March;4:April;5:May;6:June;7:July;8:August;9:September;10:October;11:November;12:December;"
"RTN","HBHCFILE",22,0)
 S DIR("A")="Month for which data is to be transmitted"
"RTN","HBHCFILE",23,0)
 S DIR("?")="Month entered controls the ending date for data transmitted to Austin.  (e.g.  An August 5 transmission with July selected as month, will include data thru July 31.)"
"RTN","HBHCFILE",24,0)
 D ^DIR Q:$D(DIRUT)  S HBHCDIR=Y
"RTN","HBHCFILE",25,0)
 S X="T" D ^%DT S HBHCYEAR=$S(HBHCDIR>(+$E(Y,4,5)):($E(Y,1,3))-1,1:$E(Y,1,3))
"RTN","HBHCFILE",26,0)
 S Y=1700+HBHCYEAR,HBHCLEAP=$S(Y#400=0:1,Y#4=0&'(Y#100=0):1,1:0)
"RTN","HBHCFILE",27,0)
 S HBHCLSDT=HBHCYEAR_$S(HBHCDIR<10:"0"_HBHCDIR,1:HBHCDIR)_$S(((HBHCDIR=2)&('HBHCLEAP)):28,((HBHCDIR=2)&(HBHCLEAP)):29,"^1^3^5^7^8^10^12^"[HBHCDIR:31,1:30)_.9999
"RTN","HBHCFILE",28,0)
 S Y=$P(HBHCLSDT,".") D DD^%DT S HBHCCKDT=Y
"RTN","HBHCFILE",29,0)
NUMBER ; Edit Number of Visit Days to Scan system parameter
"RTN","HBHCFILE",30,0)
 W !
"RTN","HBHCFILE",31,0)
 K DIR S DIR(0)="631.9,3",DIR("A")="Number of Visit Days to Scan",DIR("B")=$P($G(^HBHC(631.9,1,0)),U,4)
"RTN","HBHCFILE",32,0)
 S DIR("?",1)="Enter number of days to be included when the system creates records in the",DIR("?",2)="HBHC Visit File from the appointment data entered via the Appointment",DIR("?")="Management  [HBHC APPOINTMENT]  option."
"RTN","HBHCFILE",33,0)
 D ^DIR
"RTN","HBHCFILE",34,0)
 G:($D(DTOUT))!($D(DUOUT)) EXIT
"RTN","HBHCFILE",35,0)
 S HBHCDIR=Y
"RTN","HBHCFILE",36,0)
 I (HBHCDIR'=DIR("B"))&(HBHCDIR?1.3N) K DIE S HBHCDAYS=Y,DIE="^HBHC(631.9,",DA=1,DR="3///^S X=HBHCDAYS" D ^DIE
"RTN","HBHCFILE",37,0)
 ; Check to ensure Number of Visit Days to Scan date < HBHCLSDT
"RTN","HBHCFILE",38,0)
 K %DT S X="T"-($S(HBHCDIR'=DIR("B"):HBHCDIR,1:DIR("B"))) D ^%DT
"RTN","HBHCFILE",39,0)
 I (Y_".9999")'<HBHCLSDT D DD^%DT W $C(7),!!,"Date Range is invalid.  Transmit Month Ending Date of:  ",HBHCCKDT,"  must",!,"be closer to today than the Number of Days to Scan Date:  ",Y,".",! G NUMBER
"RTN","HBHCFILE",40,0)
CLEANUP ; Cleanup ^HBHC(634) if new transmit cycle => all records flagged as transmitted
"RTN","HBHCFILE",41,0)
 I ('$D(^HBHC(631,"AE","F")))&('$D(^HBHC(631,"AF","F")))&('$D(^HBHC(632,"AC","F")))&('$D(^HBHC(633.2,"AC","F"))) K ^HBHC(634) S ^HBHC(634,0)="HBHC TRANSMIT^634"
"RTN","HBHCFILE",42,0)
 ; Flag used to control killing HBHCDAT, HBHCDTE, & HBHCNOW in HBHCAPPT
"RTN","HBHCFILE",43,0)
 S HBHCFLAG=1
"RTN","HBHCFILE",44,0)
QUEUE ; Queue
"RTN","HBHCFILE",45,0)
 S ZTIO="",ZTDTH=$H,ZTRTN="PLOOP^HBHCFILE",ZTSAVE("HBHC*")="",ZTDESC="HBPC Build Transmit File" D ^%ZTLOAD
"RTN","HBHCFILE",46,0)
 W $C(7),!!,"Build Transmit File processing has been queued.  Task number:  ",ZTSK H 3
"RTN","HBHCFILE",47,0)
 G EXIT
"RTN","HBHCFILE",48,0)
PLOOP ; Loop thru ^HBHC(632,"C" Appointment Date cross-ref & flag as 'P' (Record Prior to Package Startup Date) in Form 4 Transmit Status field if date < Package Startup Date
"RTN","HBHCFILE",49,0)
 S X1=$P(^HBHC(631.9,1,0),U,3),X2=-1 D C^%DTC S HBHCSTDT=X_.9999
"RTN","HBHCFILE",50,0)
 S HBHCAPDT=0,DIE="^HBHC(632,",DR="7///P"
"RTN","HBHCFILE",51,0)
 F  S HBHCAPDT=$O(^HBHC(632,"C",HBHCAPDT)) Q:(HBHCAPDT'>0)!(HBHCAPDT>HBHCSTDT)  S DA="" F  S DA=$O(^HBHC(632,"C",HBHCAPDT,DA)) Q:DA'>0  D:'$D(^HBHC(632,"AC","P",DA)) ^DIE
"RTN","HBHCFILE",52,0)
POP ; Populate ^HBHC(634) or ^HBHC(634.1/634.2/634.3/634.5/634.7 Error files
"RTN","HBHCFILE",53,0)
 D ^HBHCAPPT,^HBHCXMC,^HBHCXMA,^HBHCXMV,^HBHCXMD,TPATCHK
"RTN","HBHCFILE",54,0)
 ; MFH Sanction Date must exist for MFH data to be included in Austin transmit
"RTN","HBHCFILE",55,0)
 D:$P(^HBHC(631.9,1,0),U,9)]"" ^HBHCXMM
"RTN","HBHCFILE",56,0)
 ; Cleanup potential scrogged HBHC(632,"AC" cross-ref on Form 4 Transmit Status field (#7) as failsafe
"RTN","HBHCFILE",57,0)
 K ^HBHC(632,"AC") S DIK="^HBHC(632,",DIK(1)=7 D ENALL^DIK
"RTN","HBHCFILE",58,0)
 ; Send mail message
"RTN","HBHCFILE",59,0)
 D:('$D(^HBHC(634.1,"B")))&('$D(^HBHC(634.2,"B")))&('$D(^HBHC(634.3,"B")))&('$D(^HBHC(634.5,"B")))&('$D(^HBHC(634.7,"B"))) MAIL
"RTN","HBHCFILE",60,0)
EXIT ; Exit module
"RTN","HBHCFILE",61,0)
 L -^HBHC(634.5,0)
"RTN","HBHCFILE",62,0)
 K DA,DIE,DIR,DIRUT,DR,DTOUT,DUOUT,HBHCAPDT,HBHCCKDT,HBHCDAT,HBHCDAYS,HBHCDTE,HBHCDIR,HBHCFLAG,HBHCLEAP,HBHCLSDT,HBHCNOW,HBHCSTDT,HBHCYEAR,%,TMP,X,X1,X2,Y
"RTN","HBHCFILE",63,0)
 Q
"RTN","HBHCFILE",64,0)
TPATCHK ; HBH*1.0*27 ; Identify and remove test patients from the HBHC TRANSMIT file
"RTN","HBHCFILE",65,0)
 N HBHCSSN,HBHCTRDAT,HBHCDFN,HBHCTRIEN
"RTN","HBHCFILE",66,0)
 S HBHCTRDAT=0 F  S HBHCTRDAT=$O(^HBHC(634,"B",HBHCTRDAT)) Q:HBHCTRDAT'>0  D
"RTN","HBHCFILE",67,0)
 .S HBHCSSN=$E(HBHCTRDAT,9,17)
"RTN","HBHCFILE",68,0)
 .S HBHCDFN=$O(^DPT("SSN",HBHCSSN,0))
"RTN","HBHCFILE",69,0)
 .I $$TESTPAT^VADPT(HBHCDFN) D
"RTN","HBHCFILE",70,0)
 ..S HBHCTRIEN=$O(^HBHC(634,"B",HBHCTRDAT,0))
"RTN","HBHCFILE",71,0)
 ..N DIK,DA
"RTN","HBHCFILE",72,0)
 ..S DIK="^HBHC(634,",DA=HBHCTRIEN D ^DIK
"RTN","HBHCFILE",73,0)
 Q
"RTN","HBHCFILE",74,0)
MAIL ; Send completed mail message
"RTN","HBHCFILE",75,0)
 S TMP(1)=$P(HBHCDAT,"@")_" HBHC Build Transmit File is complete with no errors found.",TMP(2)="",TMP(3)="   Number of Visit Days to Scan system parameter:  "_$P(^HBHC(631.9,1,0),U,4),TMP(4)=""
"RTN","HBHCFILE",76,0)
 S Y=$P($P(HBHCDTE,U),"@") X ^DD("DD") S HBHCINFO=Y,Y=$P($P(HBHCDTE,U,2),"@") X ^DD("DD") S TMP(5)="   Date range:  "_$P(HBHCINFO,"@")_"  thru  "_$P(Y,"@"),TMP(6)=""
"RTN","HBHCFILE",77,0)
 D NOW^%DTC S Y=% X ^DD("DD")
"RTN","HBHCFILE",78,0)
 S TMP(7)="   Start time:  "_$P(HBHCDAT,"@",2)_"   End time:  "_$P(Y,"@",2)_"   Elapsed minutes:  "_($E(%_"000",9,10)-$E(HBHCNOW_"000",9,10)*60+$E(%_"00000",11,12)-$E(HBHCNOW_"00000",11,12)),TMP(8)=""
"RTN","HBHCFILE",79,0)
 S TMP(9)="*****   Reminder:  Please run Transmit File to Austin option.   *****"
"RTN","HBHCFILE",80,0)
 S XMDUZ="HBHC Build Transmit File Mail Group",XMSUB=$P(HBHCDAT,"@")_" HBHC Build Transmit File",XMY(DUZ)="",XMTEXT="TMP("
"RTN","HBHCFILE",81,0)
 D ^XMD
"RTN","HBHCFILE",82,0)
 Q
"VER")
8.0^22.0
"BLD",9009,6)
^24
**END**
**END**

