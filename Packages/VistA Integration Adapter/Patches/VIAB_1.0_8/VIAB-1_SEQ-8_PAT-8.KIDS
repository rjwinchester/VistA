Released VIAB*1*8 SEQ #8
Extracted from mail message
**KIDS**:VIAB*1.0*8^

**INSTALL NAME**
VIAB*1.0*8
"BLD",10008,0)
VIAB*1.0*8^VISTA INTEGRATION ADAPTER^0^3161208^y
"BLD",10008,4,0)
^9.64PA^^
"BLD",10008,6.3)
8
"BLD",10008,"ABPKG")
n
"BLD",10008,"KRN",0)
^9.67PA^779.2^20
"BLD",10008,"KRN",.4,0)
.4
"BLD",10008,"KRN",.401,0)
.401
"BLD",10008,"KRN",.402,0)
.402
"BLD",10008,"KRN",.403,0)
.403
"BLD",10008,"KRN",.5,0)
.5
"BLD",10008,"KRN",.84,0)
.84
"BLD",10008,"KRN",3.6,0)
3.6
"BLD",10008,"KRN",3.8,0)
3.8
"BLD",10008,"KRN",9.2,0)
9.2
"BLD",10008,"KRN",9.8,0)
9.8
"BLD",10008,"KRN",9.8,"NM",0)
^9.68A^10^3
"BLD",10008,"KRN",9.8,"NM",1,0)
VIABRPC^^0^B22947290
"BLD",10008,"KRN",9.8,"NM",9,0)
VIABMS^^0^B138505639
"BLD",10008,"KRN",9.8,"NM",10,0)
VIABMS1^^0^B138039577
"BLD",10008,"KRN",9.8,"NM","B","VIABMS",9)

"BLD",10008,"KRN",9.8,"NM","B","VIABMS1",10)

"BLD",10008,"KRN",9.8,"NM","B","VIABRPC",1)

"BLD",10008,"KRN",19,0)
19
"BLD",10008,"KRN",19,"NM",0)
^9.68A^1^1
"BLD",10008,"KRN",19,"NM",1,0)
VIAB WEB SERVICES OPTION^^0
"BLD",10008,"KRN",19,"NM","B","VIAB WEB SERVICES OPTION",1)

"BLD",10008,"KRN",19.1,0)
19.1
"BLD",10008,"KRN",101,0)
101
"BLD",10008,"KRN",409.61,0)
409.61
"BLD",10008,"KRN",771,0)
771
"BLD",10008,"KRN",779.2,0)
779.2
"BLD",10008,"KRN",870,0)
870
"BLD",10008,"KRN",8989.51,0)
8989.51
"BLD",10008,"KRN",8989.52,0)
8989.52
"BLD",10008,"KRN",8994,0)
8994
"BLD",10008,"KRN",8994,"NM",0)
^9.68A^17^8
"BLD",10008,"KRN",8994,"NM",2,0)
VIAB ACTPROB^^0
"BLD",10008,"KRN",8994,"NM",3,0)
VIAB CPTMODS^^0
"BLD",10008,"KRN",8994,"NM",6,0)
VIAB EDIT DEFAULT REASON^^0
"BLD",10008,"KRN",8994,"NM",7,0)
VIAB DEFAULT REQUEST REASON^^0
"BLD",10008,"KRN",8994,"NM",11,0)
VIAB NOTEVSTR^^0
"BLD",10008,"KRN",8994,"NM",14,0)
VIAB BMS^^0
"BLD",10008,"KRN",8994,"NM",16,0)
VIAB CURSPE^^0
"BLD",10008,"KRN",8994,"NM",17,0)
VIAB RADSRC^^0
"BLD",10008,"KRN",8994,"NM","B","VIAB ACTPROB",2)

"BLD",10008,"KRN",8994,"NM","B","VIAB BMS",14)

"BLD",10008,"KRN",8994,"NM","B","VIAB CPTMODS",3)

"BLD",10008,"KRN",8994,"NM","B","VIAB CURSPE",16)

"BLD",10008,"KRN",8994,"NM","B","VIAB DEFAULT REQUEST REASON",7)

"BLD",10008,"KRN",8994,"NM","B","VIAB EDIT DEFAULT REASON",6)

"BLD",10008,"KRN",8994,"NM","B","VIAB NOTEVSTR",11)

"BLD",10008,"KRN",8994,"NM","B","VIAB RADSRC",17)

"BLD",10008,"KRN","B",.4,.4)

"BLD",10008,"KRN","B",.401,.401)

"BLD",10008,"KRN","B",.402,.402)

"BLD",10008,"KRN","B",.403,.403)

"BLD",10008,"KRN","B",.5,.5)

"BLD",10008,"KRN","B",.84,.84)

"BLD",10008,"KRN","B",3.6,3.6)

"BLD",10008,"KRN","B",3.8,3.8)

"BLD",10008,"KRN","B",9.2,9.2)

"BLD",10008,"KRN","B",9.8,9.8)

"BLD",10008,"KRN","B",19,19)

"BLD",10008,"KRN","B",19.1,19.1)

"BLD",10008,"KRN","B",101,101)

"BLD",10008,"KRN","B",409.61,409.61)

"BLD",10008,"KRN","B",771,771)

"BLD",10008,"KRN","B",779.2,779.2)

"BLD",10008,"KRN","B",870,870)

"BLD",10008,"KRN","B",8989.51,8989.51)

"BLD",10008,"KRN","B",8989.52,8989.52)

"BLD",10008,"KRN","B",8994,8994)

"BLD",10008,"QDEF")
^^^^NO^^^^NO^^NO
"BLD",10008,"QUES",0)
^9.62^^
"BLD",10008,"REQB",0)
^9.611^1^1
"BLD",10008,"REQB",1,0)
VIAB*1.0*7^1
"BLD",10008,"REQB","B","VIAB*1.0*7",1)

"KRN",19,2921669,-1)
0^1
"KRN",19,2921669,0)
VIAB WEB SERVICES OPTION^VIAB Web Services Option^^B^^^^^^^^VISTA INTEGRATION ADAPTER
"KRN",19,2921669,1,0)
^19.06^3^3^3140829^^^^
"KRN",19,2921669,1,1,0)
This option is required by the Kernel Broker to give 
"KRN",19,2921669,1,2,0)
access to the RPCs used by the Vista Integration Adapter 
"KRN",19,2921669,1,3,0)
(VIA) team.
"KRN",19,2921669,99.1)
63218,50689
"KRN",19,2921669,"RPC",0)
^19.05P^192^150
"KRN",19,2921669,"RPC",1,0)
DG SENSITIVE RECORD ACCESS
"KRN",19,2921669,"RPC",2,0)
DG SENSITIVE RECORD BULLETIN
"KRN",19,2921669,"RPC",3,0)
ORPRF HASFLG
"KRN",19,2921669,"RPC",4,0)
ORQPT CLINIC PATIENTS
"KRN",19,2921669,"RPC",5,0)
ORQPT PROVIDER PATIENTS
"KRN",19,2921669,"RPC",6,0)
ORQPT SPECIALTIES
"KRN",19,2921669,"RPC",7,0)
ORQPT SPECIALTY PATIENTS
"KRN",19,2921669,"RPC",8,0)
ORQPT TEAM PATIENTS
"KRN",19,2921669,"RPC",9,0)
ORQPT TEAMS
"KRN",19,2921669,"RPC",10,0)
ORQPT WARDRMBED
"KRN",19,2921669,"RPC",11,0)
ORQPT WARDS
"KRN",19,2921669,"RPC",12,0)
ORQQCN DETAIL
"KRN",19,2921669,"RPC",13,0)
ORQQCN GET ORDER NUMBER
"KRN",19,2921669,"RPC",14,0)
ORQQCN LIST
"KRN",19,2921669,"RPC",15,0)
ORVAA VAA
"KRN",19,2921669,"RPC",16,0)
ORWCIRN FACLIST
"KRN",19,2921669,"RPC",17,0)
ORWCV DTLVST
"KRN",19,2921669,"RPC",18,0)
ORWCV VST
"KRN",19,2921669,"RPC",19,0)
ORWDX LOADRSP
"KRN",19,2921669,"RPC",20,0)
ORWDX LOCK ORDER
"KRN",19,2921669,"RPC",21,0)
ORWDX UNLOCK ORDER
"KRN",19,2921669,"RPC",22,0)
ORWDXA OFCPLX
"KRN",19,2921669,"RPC",23,0)
ORWDXC SESSION
"KRN",19,2921669,"RPC",24,0)
ORWDXM DLGNAME
"KRN",19,2921669,"RPC",25,0)
ORWDXM1 BLDQRSP
"KRN",19,2921669,"RPC",26,0)
ORWLRR ALLTESTS
"KRN",19,2921669,"RPC",27,0)
ORWLRR INFO
"KRN",19,2921669,"RPC",28,0)
ORWLRR INTERIMG
"KRN",19,2921669,"RPC",29,0)
ORWORDG MAPSEQ
"KRN",19,2921669,"RPC",30,0)
ORWORR AGET
"KRN",19,2921669,"RPC",31,0)
ORWORR GET4LST
"KRN",19,2921669,"RPC",32,0)
ORWPS ACTIVE
"KRN",19,2921669,"RPC",33,0)
ORWPS DETAIL
"KRN",19,2921669,"RPC",34,0)
ORWPT ADMITLST
"KRN",19,2921669,"RPC",35,0)
ORWPT BYWARD
"KRN",19,2921669,"RPC",36,0)
ORWPT DIEDON
"KRN",19,2921669,"RPC",37,0)
ORWPT ID INFO
"KRN",19,2921669,"RPC",38,0)
ORWPT LIST ALL
"KRN",19,2921669,"RPC",39,0)
ORWPT PTINQ
"KRN",19,2921669,"RPC",40,0)
ORWPT SELECT
"KRN",19,2921669,"RPC",41,0)
ORWPT1 PCDETAIL
"KRN",19,2921669,"RPC",42,0)
ORWPT1 PRCARE
"KRN",19,2921669,"RPC",43,0)
ORWPT16 ID INFO
"KRN",19,2921669,"RPC",44,0)
ORWRP REPORT TEXT
"KRN",19,2921669,"RPC",45,0)
ORWRP2 HS COMPONENTS
"KRN",19,2921669,"RPC",46,0)
ORWRP2 HS REPORT TEXT
"KRN",19,2921669,"RPC",47,0)
ORWSR RPTLIST
"KRN",19,2921669,"RPC",48,0)
ORWTIU CHKTXT
"KRN",19,2921669,"RPC",49,0)
ORWU CLINLOC
"KRN",19,2921669,"RPC",50,0)
ORWU DT
"KRN",19,2921669,"RPC",51,0)
ORWU NEWPERS
"KRN",19,2921669,"RPC",52,0)
ORWU USERINFO
"KRN",19,2921669,"RPC",53,0)
ORWU VALIDSIG
"KRN",19,2921669,"RPC",54,0)
ORWU1 NEWLOC
"KRN",19,2921669,"RPC",55,0)
SC GETS ENTRY DATA
"KRN",19,2921669,"RPC",56,0)
SC LISTER
"KRN",19,2921669,"RPC",57,0)
TIU AUTHORIZATION
"KRN",19,2921669,"RPC",58,0)
TIU CREATE RECORD
"KRN",19,2921669,"RPC",59,0)
TIU DOCUMENTS BY CONTEXT
"KRN",19,2921669,"RPC",60,0)
TIU GET PRF ACTIONS
"KRN",19,2921669,"RPC",61,0)
TIU GET RECORD TEXT
"KRN",19,2921669,"RPC",62,0)
TIU HAS AUTHOR SIGNED?
"KRN",19,2921669,"RPC",63,0)
TIU IS THIS A CONSULT?
"KRN",19,2921669,"RPC",64,0)
TIU IS THIS A SURGERY?
"KRN",19,2921669,"RPC",65,0)
TIU ISPRF
"KRN",19,2921669,"RPC",66,0)
TIU LOCK RECORD
"KRN",19,2921669,"RPC",67,0)
TIU LONG LIST OF TITLES
"KRN",19,2921669,"RPC",68,0)
TIU ONE VISIT NOTE?
"KRN",19,2921669,"RPC",69,0)
TIU REQUIRES COSIGNATURE
"KRN",19,2921669,"RPC",70,0)
TIU SET DOCUMENT TEXT
"KRN",19,2921669,"RPC",71,0)
TIU SIGN RECORD
"KRN",19,2921669,"RPC",72,0)
TIU UNLOCK RECORD
"KRN",19,2921669,"RPC",73,0)
TIU UPDATE RECORD
"KRN",19,2921669,"RPC",74,0)
TIU WAS THIS SAVED?
"KRN",19,2921669,"RPC",75,0)
TIU WHICH SIGNATURE ACTION
"KRN",19,2921669,"RPC",78,0)
ORQQAL LIST
"KRN",19,2921669,"RPC",79,0)
ORQQVI VITALS
"KRN",19,2921669,"RPC",80,0)
ORWDX LOCK
"KRN",19,2921669,"RPC",81,0)
ORWDX SEND
"KRN",19,2921669,"RPC",82,0)
ORWDX UNLOCK
"KRN",19,2921669,"RPC",83,0)
ORWPT FULLSSN
"KRN",19,2921669,"RPC",84,0)
ORWPT LAST5
"KRN",19,2921669,"RPC",85,0)
VAFCTFU CONVERT ICN TO DFN
"KRN",19,2921669,"RPC",86,0)
VPR GET PATIENT DATA
"KRN",19,2921669,"RPC",87,0)
ORALWORD ALLWORD
"KRN",19,2921669,"RPC",88,0)
ORCHECK GETXTRA
"KRN",19,2921669,"RPC",89,0)
ORDDPAPI CLOZMSG
"KRN",19,2921669,"RPC",90,0)
OREVNTX1 GETSTS
"KRN",19,2921669,"RPC",92,0)
ORQQCN STATUS
"KRN",19,2921669,"RPC",93,0)
ORQQCN SVC W/SYNONYMS
"KRN",19,2921669,"RPC",94,0)
ORWD1 PRINTGUI
"KRN",19,2921669,"RPC",95,0)
ORWD1 RVPRINT
"KRN",19,2921669,"RPC",96,0)
ORWD2 DEVINFO
"KRN",19,2921669,"RPC",97,0)
ORWDCN32 ORDRMSG
"KRN",19,2921669,"RPC",98,0)
ORWDPS1 FAILDEA
"KRN",19,2921669,"RPC",99,0)
ORWDPS1 ODSLCT
"KRN",19,2921669,"RPC",100,0)
ORWDPS2 DAY2QTY
"KRN",19,2921669,"RPC",101,0)
ORWDPS2 MAXREF
"KRN",19,2921669,"RPC",102,0)
ORWDPS2 QTY2DAY
"KRN",19,2921669,"RPC",103,0)
ORWDPS32 DRUGMSG
"KRN",19,2921669,"RPC",104,0)
ORWDPS32 ISSPLY
"KRN",19,2921669,"RPC",105,0)
ORWDPS32 VALQTY
"KRN",19,2921669,"RPC",106,0)
ORWDPS32 VALROUTE
"KRN",19,2921669,"RPC",107,0)
ORWDRA32 APPROVAL
"KRN",19,2921669,"RPC",108,0)
ORWDRA32 DEF
"KRN",19,2921669,"RPC",110,0)
ORWDX DGNM
"KRN",19,2921669,"RPC",111,0)
ORWDX2 DCREASON
"KRN",19,2921669,"RPC",112,0)
ORWDXA ISACTOI
"KRN",19,2921669,"RPC",113,0)
ORWDXR RNWFLDS
"KRN",19,2921669,"RPC",114,0)
ORWDXR01 CANCHG
"KRN",19,2921669,"RPC",115,0)
ORWGRPC ITEMDATA
"KRN",19,2921669,"RPC",116,0)
ORWGRPC ITEMS
"KRN",19,2921669,"RPC",117,0)
ORWOR1 GETDSCH
"KRN",19,2921669,"RPC",118,0)
ORWRP GET DEFAULT PRINTER
"KRN",19,2921669,"RPC",120,0)
ORWTPD GETDFLT
"KRN",19,2921669,"RPC",121,0)
TIU DETAILED DISPLAY
"KRN",19,2921669,"RPC",125,0)
VIABPCE2 GET HFACTORS TYPE
"KRN",19,2921669,"RPC",126,0)
VIABPCE4 LEX
"KRN",19,2921669,"RPC",127,0)
VIABU EXTNAME
"KRN",19,2921669,"RPC",128,0)
TIU SET ADMINISTRATIVE CLOSURE
"KRN",19,2921669,"RPC",129,0)
VIAB GETSURR
"KRN",19,2921669,"RPC",133,0)
ORWMC PATIENT PROCEDURES1
"KRN",19,2921669,"RPC",137,0)
ORQPT PROVIDERS
"KRN",19,2921669,"RPC",158,0)
VIAB GET USER DIVISIONS
"KRN",19,2921669,"RPC",160,0)
ORWRP REPORT LISTS
"KRN",19,2921669,"RPC",161,0)
TIU CREATE ADDENDUM RECORD
"KRN",19,2921669,"RPC",162,0)
TIU UPDATE ADDITIONAL SIGNERS
"KRN",19,2921669,"RPC",163,0)
VIAB SITENAME
"KRN",19,2921669,"RPC",164,0)
VIAB ACTPROB
"KRN",19,2921669,"RPC",165,0)
VIAB BMS
"KRN",19,2921669,"RPC",166,0)
VIAB CPTMODS
"KRN",19,2921669,"RPC",167,0)
VIAB DEFAULT REQUEST REASON
"KRN",19,2921669,"RPC",168,0)
VIAB EDIT DEFAULT REASON
"KRN",19,2921669,"RPC",173,0)
VIAB NOTEVSTR
"KRN",19,2921669,"RPC",179,0)
VIAB CURSPE
"KRN",19,2921669,"RPC",180,0)
VIAB RADSRC
"KRN",19,2921669,"RPC",181,0)
MBAA LIST CANCELLATION REASONS
"KRN",19,2921669,"RPC",182,0)
MBAA VERIFY CLINIC ACCESS
"KRN",19,2921669,"RPC",183,0)
MBAA APPOINTMENT LIST BY NAME
"KRN",19,2921669,"RPC",184,0)
MBAA APPOINTMENT MAKE
"KRN",19,2921669,"RPC",185,0)
MBAA FACILITY WAIT LIST
"KRN",19,2921669,"RPC",186,0)
MBAA CANCEL APPOINTMENT
"KRN",19,2921669,"RPC",187,0)
MBAA PATIENT PENDING APPT
"KRN",19,2921669,"RPC",188,0)
MBAA REMOVE FROM EWL
"KRN",19,2921669,"RPC",189,0)
MBAA PROVIDERS BY CLINIC
"KRN",19,2921669,"RPC",190,0)
MBAA GET CLINIC AVAILABILITY
"KRN",19,2921669,"RPC",191,0)
MBAA GET CLINIC DETAILS
"KRN",19,2921669,"RPC",192,0)
MBAA WAIT LIST BY DFN
"KRN",19,2921669,"U")
VIAB WEB SERVICES OPTION
"KRN",8994,3691,-1)
0^14
"KRN",8994,3691,0)
VIAB BMS^EN^VIABMS^2^R^^^^^^1
"KRN",8994,3691,1,0)
^^3^3^3160622^
"KRN",8994,3691,1,1,0)
This RPC supports the Bed Management System (BMS). It reads the input
"KRN",8994,3691,1,2,0)
parameter, "PATH", and determines from it what data to return.  All BMS
"KRN",8994,3691,1,3,0)
requests are handled by this RPC.
"KRN",8994,3691,2,0)
^8994.02A^1^1
"KRN",8994,3691,2,1,0)
VIA^2^^1^1
"KRN",8994,3691,2,1,1,0)
^8994.021^23^23^3160622^^
"KRN",8994,3691,2,1,1,1,0)
The "PATH" parameter dictates what additional parameters should be passed
"KRN",8994,3691,2,1,1,2,0)
in. Examples of input parameters passed to the RPC.
"KRN",8994,3691,2,1,1,3,0)
      VIA("PATH")="GETPATIENT"
"KRN",8994,3691,2,1,1,4,0)
      VIA("IENS")="7173105,"
"KRN",8994,3691,2,1,1,5,0)
 
"KRN",8994,3691,2,1,1,6,0)
      VIA("PATH")="LISTPATIENT"
"KRN",8994,3691,2,1,1,7,0)
      VIA("SDATE")=3010524
"KRN",8994,3691,2,1,1,8,0)
      VIA("EDATE")=3010524
"KRN",8994,3691,2,1,1,9,0)
 
"KRN",8994,3691,2,1,1,10,0)
      VIA("PATH")="LISTADMITTEDPATIENTS"
"KRN",8994,3691,2,1,1,11,0)
      VIA("TO")=192210
"KRN",8994,3691,2,1,1,12,0)
 
"KRN",8994,3691,2,1,1,13,0)
      VIA("PATH")="LISTHOSPITALLOCATIONS"
"KRN",8994,3691,2,1,1,14,0)
 
"KRN",8994,3691,2,1,1,15,0)
      VIA("PATH")="LISTPATIENTAPPOINTMENT"
"KRN",8994,3691,2,1,1,16,0)
      VIA("IENS")=",7208163,"
"KRN",8994,3691,2,1,1,17,0)
      VIA("CLNIEN")=1690
"KRN",8994,3691,2,1,1,18,0)
      VIA("SDATE")=3101206
"KRN",8994,3691,2,1,1,19,0)
      VIA("EDATE")=3110429.1101
"KRN",8994,3691,2,1,1,20,0)
 
"KRN",8994,3691,2,1,1,21,0)
      VIA("PATH")="LISTROOMBED"
"KRN",8994,3691,2,1,1,22,0)
      VIA("FROM")=100
"KRN",8994,3691,2,1,1,23,0)
      VIA("MAX")=44
"KRN",8994,3691,2,"B","VIA",1)

"KRN",8994,3691,2,"PARAMSEQ",1,1)

"KRN",8994,3691,3,0)
^8994.03^31^31^3160622^^
"KRN",8994,3691,3,1,0)
The RPC returns the output in a one dimensional array RESULT.
"KRN",8994,3691,3,2,0)
     RESULT(1)="[Data]"
"KRN",8994,3691,3,3,0)
     RESULT(2)="70^ACUTE PSYCHIATRY (<45 DAYS)^ACUTE PSYCHIATRY (<45
"KRN",8994,3691,3,4,0)
               DAYS)"
"KRN",8994,3691,3,5,0)
     RESULT(3)="72^ALCOHOL DEPENDENCE TRMT UNIT^ALCOHOL DEPENDENCE TRMT
"KRN",8994,3691,3,6,0)
               UNIT"
"KRN",8994,3691,3,7,0)
     RESULT(4)="1^ALLERGY^ALLERGY"
"KRN",8994,3691,3,8,0)
     RESULT(5)="78^ANESTHESIOLOGY^ANESTHESIOLOGY"
"KRN",8994,3691,3,9,0)
     RESULT(6)="21^BLIND REHAB^BLIND REHAB"
"KRN",8994,3691,3,10,0)
     RESULT(7)="36^BLIND REHAB OBSERVATION^BLIND REHAB OBSERVATION"
"KRN",8994,3691,3,11,0)
     RESULT(8)="13^CARDIAC INTENSIVE CARE UNIT^CARDIAC INTENSIVE CARE
"KRN",8994,3691,3,12,0)
               UNIT"
"KRN",8994,3691,3,13,0)
     RESULT(9)="48^CARDIAC SURGERY^CARDIAC SURGERY"
"KRN",8994,3691,3,14,0)
     RESULT(10)="16^CARDIAC-STEP DOWN UNIT^CARDIAC-STEP DOWN UNIT"
"KRN",8994,3691,3,15,0)
 
"KRN",8994,3691,3,16,0)
or;
"KRN",8994,3691,3,17,0)
     RESULT(1)="[Misc]"
"KRN",8994,3691,3,18,0)
     RESULT(2)="MORE^ZZCHY DERMATOLOGY II^"
"KRN",8994,3691,3,19,0)
     RESULT(3)="[Data]"
"KRN",8994,3691,3,20,0)
     RESULT(4)="75^A MEDICINE^A M^248^1"
"KRN",8994,3691,3,21,0)
     RESULT(5)="695^ADJUDICATION^^^"
"KRN",8994,3691,3,22,0)
     RESULT(6)="93^ADMISSION MED^ADM MED^^"
"KRN",8994,3691,3,23,0)
     RESULT(7)="212^ADMISSIONS^ADMISS^^"
"KRN",8994,3691,3,24,0)
     RESULT(8)="101^ADMIT^ADMIT^^"
"KRN",8994,3691,3,25,0)
     RESULT(9)="374^ADMITTING POD^ADMIT P^^"
"KRN",8994,3691,3,26,0)
     RESULT(10)="518^AMERICAN LEGION^AL^^"
"KRN",8994,3691,3,27,0)
     RESULT(11)="221^BASE HOSPITAL^WAFB H^^"
"KRN",8994,3691,3,28,0)
     RESULT(12)="508^BLOOD BANK^BB^^"
"KRN",8994,3691,3,29,0)
     RESULT(13)="77^C MEDICINE^C M^246^3"
"KRN",8994,3691,3,30,0)
     RESULT(14)="78^C PSYCHIATRY^A P^^8"
"KRN",8994,3691,3,31,0)
     RESULT(15)="80^C SURGERY^C S^^5"
"KRN",8994,4084,-1)
0^6
"KRN",8994,4084,0)
VIAB EDIT DEFAULT REASON^EDITDRFR^VIABRPC^1^R^^^^^^1
"KRN",8994,4084,1,0)
^8994.01^2^2^3161116^
"KRN",8994,4084,1,1,0)
Return value (see details here) determines if and when the consults
"KRN",8994,4084,1,2,0)
'reason for request' can be edited.
"KRN",8994,4084,2,0)
^8994.02A^2^1
"KRN",8994,4084,2,2,0)
VIAIEN^1^^1
"KRN",8994,4084,2,2,1,0)
^8994.021^1^1^3161116^^^
"KRN",8994,4084,2,2,1,1,0)
VIAIEN - IEN of consults service from file 123.5.
"KRN",8994,4084,2,"B","VIAIEN",2)

"KRN",8994,4084,3,0)
^8994.03^3^3^3161116^^^^
"KRN",8994,4084,3,1,0)
 0=editable anytime
"KRN",8994,4084,3,2,0)
 1=editable only on edit of order before release
"KRN",8994,4084,3,3,0)
 2=never editable
"KRN",8994,4085,-1)
0^7
"KRN",8994,4085,0)
VIAB DEFAULT REQUEST REASON^DEFRFREQ^VIABRPC^4^R^^^1^^^1
"KRN",8994,4085,2,0)
^8994.02A^4^4
"KRN",8994,4085,2,1,0)
VIAIEN^1^^^1
"KRN",8994,4085,2,1,1,0)
^^1^1^3160804^
"KRN",8994,4085,2,1,1,1,0)
Reference to file 123.5 (#;99CON) or file 123.3 (#;99PRC).
"KRN",8994,4085,2,2,0)
VIADFN^1^^^2
"KRN",8994,4085,2,2,1,0)
^^1^1^3160804^
"KRN",8994,4085,2,2,1,1,0)
Patient identifier, if to return resolved.
"KRN",8994,4085,2,3,0)
RESOLV^1^^^3
"KRN",8994,4085,2,4,0)
RESOLVE
"KRN",8994,4085,2,"B","RESOLV",3)

"KRN",8994,4085,2,"B","RESOLVE",4)

"KRN",8994,4085,2,"B","VIADFN",2)

"KRN",8994,4085,2,"B","VIAIEN",1)

"KRN",8994,4085,2,"PARAMSEQ",1,1)

"KRN",8994,4085,2,"PARAMSEQ",2,2)

"KRN",8994,4085,2,"PARAMSEQ",3,3)

"KRN",8994,4085,3,0)
^8994.03^2^2^3160804^^
"KRN",8994,4085,3,1,0)
Retrieves a default reason for request for any consult service entered in
"KRN",8994,4085,3,2,0)
the REQUEST SERVICES File #123.5.
"KRN",8994,4087,-1)
0^17
"KRN",8994,4087,0)
VIAB RADSRC^RADSRC^VIABRPC^2^R^^^^^^1
"KRN",8994,4087,2,0)
^8994.02A^1^1
"KRN",8994,4087,2,1,0)
SRCTYPE^1^^1
"KRN",8994,4087,2,1,1,0)
^8994.021^3^3^3160908^^
"KRN",8994,4087,2,1,1,1,0)
Type Of Agreement -
"KRN",8994,4087,2,1,1,2,0)
  S:SHARING
"KRN",8994,4087,2,1,1,3,0)
  C:CONTRACT
"KRN",8994,4087,2,"B","SRCTYPE",1)

"KRN",8994,4087,3,0)
^8994.03^1^1^3160908^^
"KRN",8994,4087,3,1,0)
Returns a list of active contract/sharing agreement type.
"KRN",8994,4088,-1)
0^16
"KRN",8994,4088,0)
VIAB CURSPE^CURSPE^VIABRPC^1^R^^^1^^^1
"KRN",8994,4088,2,0)
^8994.02A^1^1
"KRN",8994,4088,2,1,0)
PTDFN^1^^1
"KRN",8994,4088,2,1,1,0)
^8994.021^1^1^3160804^^
"KRN",8994,4088,2,1,1,1,0)
PTDFN = PATIENT (#2) file DFN.
"KRN",8994,4088,2,"B","PTDFN",1)

"KRN",8994,4088,3,0)
^8994.03^2^2^3160804^^
"KRN",8994,4088,3,1,0)
Returns the current observation status for a patient based on the treating
"KRN",8994,4088,3,2,0)
specialty.
"KRN",8994,4089,-1)
0^3
"KRN",8994,4089,0)
VIAB CPTMODS^CPTMODS^VIABRPC^2^R^^^1^^^1
"KRN",8994,4089,1,0)
^^1^1^3160805^
"KRN",8994,4089,1,1,0)
Returns a list of CPT Modifiers for a given CPT Code.
"KRN",8994,4089,2,0)
^8994.02A^2^2
"KRN",8994,4089,2,1,0)
VIACPTCOD^1^^1^1
"KRN",8994,4089,2,1,1,0)
^^1^1^3160805^
"KRN",8994,4089,2,1,1,1,0)
IEN from CPT File #81.
"KRN",8994,4089,2,2,0)
VIADATE^1^^^2
"KRN",8994,4089,2,"B","VIACPTCOD",1)

"KRN",8994,4089,2,"B","VIADATE",2)

"KRN",8994,4089,2,"PARAMSEQ",1,1)

"KRN",8994,4089,2,"PARAMSEQ",2,2)

"KRN",8994,4089,3,0)
^^1^1^3160805^
"KRN",8994,4089,3,1,0)
Returns an array in the format IEN^Descriptive Name^CPT Modifier Code.
"KRN",8994,4094,-1)
0^11
"KRN",8994,4094,0)
VIAB NOTEVSTR^NOTEVSTR^VIABRPC^1^R^^^^^^1
"KRN",8994,4094,1,0)
^8994.01^2^2^3160824^^
"KRN",8994,4094,1,1,0)
Returns VISIT LOCATION;EPISODE BEGIN DATE;VISIT TYPE from the TIU DOCUMENT
"KRN",8994,4094,1,2,0)
file.
"KRN",8994,4094,2,0)
^8994.02A^1^1
"KRN",8994,4094,2,1,0)
IEN^1
"KRN",8994,4094,2,1,1,0)
^8994.021^1^1^3160824^^
"KRN",8994,4094,2,1,1,1,0)
IEN of TIU DOCUMENT File #8925.
"KRN",8994,4094,2,"B","IEN",1)

"KRN",8994,4095,-1)
0^2
"KRN",8994,4095,0)
VIAB ACTPROB^ACTPROB^VIABRPC^4^R^^^1^^^1
"KRN",8994,4095,1,0)
^^1^1^3160906^
"KRN",8994,4095,1,1,0)
Build list of active problems for patient.
"KRN",8994,4095,2,0)
^8994.02A^2^2
"KRN",8994,4095,2,1,0)
DFN^1^^1^1
"KRN",8994,4095,2,2,0)
VIADATE^1^^^2
"KRN",8994,4095,2,"B","DFN",1)

"KRN",8994,4095,2,"B","VIADATE",2)

"KRN",8994,4095,2,"PARAMSEQ",1,1)

"KRN",8994,4095,2,"PARAMSEQ",2,2)

"KRN",8994,4095,3,0)
^^1^1^3160906^
"KRN",8994,4095,3,1,0)
Returns a list of patient's active problems.
"MBREQ")
0
"ORD",16,8994)
8994;16;1;;;;;;;RPCDEL^XPDIA1
"ORD",16,8994,0)
REMOTE PROCEDURE
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"PKG",656,-1)
1^1
"PKG",656,0)
VISTA INTEGRATION ADAPTER^VIAB^VIAB APP
"PKG",656,20,0)
^9.402P^^
"PKG",656,22,0)
^9.49I^1^1
"PKG",656,22,1,0)
1.0
"PKG",656,22,1,"PAH",1,0)
8^3161208
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
3
"RTN","VIABMS")
0^9^B138505639^n/a
"RTN","VIABMS",1,0)
VIABMS ;AAC/JMC - VIA BMS RPCs ;04/07/2016
"RTN","VIABMS",2,0)
 ;;1.0;VISTA INTEGRATION ADAPTER;**8**;06-FEB-2014;Build 8
"RTN","VIABMS",3,0)
 ;
"RTN","VIABMS",4,0)
 ;The routine is in support of the Bed Management System (BMS) and is linked to VIAB BMS  RPC. The RPC 
"RTN","VIABMS",5,0)
 ;determines what data is returned from what is passed in the input parameter VIA("PATH").  All BMS requests
"RTN","VIABMS",6,0)
 ;are handled by this one RPC.
"RTN","VIABMS",7,0)
 ;
"RTN","VIABMS",8,0)
 ; RPC VIAB BMS
"RTN","VIABMS",9,0)
 ; ICR 10035    PATIENT FILE
"RTN","VIABMS",10,0)
 ; ICR 10040    HOSPITAL LOCATION FILE [File #44;fields .01,1,42]
"RTN","VIABMS",11,0)
 ; ICR 10060    NEW PERSON FILE [File 200;fields .01,30] (supported)
"RTN","VIABMS",12,0)
 ; ICR 6609     WARD [Access to File #42;fields .01,.017,.2] (private)
"RTN","VIABMS",13,0)
 ; ICR 4782     CLINIC PHONE [File #44;field 99]
"RTN","VIABMS",14,0)
 ; ICR 2652     DBIA2652 [File #42.4;field .01] (controlled)
"RTN","VIABMS",15,0)
 ; ICR 4433     NAME: DBIA4433 [API SDAPI^SDAMA301] (supported)
"RTN","VIABMS",16,0)
 ; ICR 5771     ORDERS FILE DATA [File #100;field #5] (controlled)
"RTN","VIABMS",17,0)
 ; ICR 6610     FACILITY MOVEMENT File #405.1;fields .01,.04] (private)
"RTN","VIABMS",18,0)
 ; ICR 6607     SC PERCENTAGE [File #2;field .302] (private)
"RTN","VIABMS",19,0)
 Q
"RTN","VIABMS",20,0)
 ;
"RTN","VIABMS",21,0)
EN(RESULT,VIA) ; entry point for RPC
"RTN","VIABMS",22,0)
 N VIATAG,VIAER
"RTN","VIABMS",23,0)
 S VIATAG=""
"RTN","VIABMS",24,0)
 I $O(VIA(""))="" S VIAER="Missing Parameters" D ERR(VIAER) Q
"RTN","VIABMS",25,0)
 I $G(VIA("PATH"))="" S VIAER="Missing PATH Parameters" D ERR(VIAER) Q
"RTN","VIABMS",26,0)
 ; -- parse array to parameters
"RTN","VIABMS",27,0)
 D PARSE(.VIA)
"RTN","VIABMS",28,0)
 D TMP
"RTN","VIABMS",29,0)
 D PATH(.VIATAG)
"RTN","VIABMS",30,0)
 I VIATAG'="" D @VIATAG
"RTN","VIABMS",31,0)
 D KVAR
"RTN","VIABMS",32,0)
 Q
"RTN","VIABMS",33,0)
 ;
"RTN","VIABMS",34,0)
PARSE(VIA) ; -- array parsing to parameters
"RTN","VIABMS",35,0)
 S VIAIENS=$G(VIA("IENS"))
"RTN","VIABMS",36,0)
 S VIAFLAGS=$G(VIA("FLAGS"))
"RTN","VIABMS",37,0)
 S VIAMAX=$G(VIA("MAX")) I VIAMAX>1000 S VIAMAX=1000
"RTN","VIABMS",38,0)
 I $G(VIAMAX)="" S VIAMAX=1000
"RTN","VIABMS",39,0)
 S VIAFROM=$G(VIA("FROM"))
"RTN","VIABMS",40,0)
 S VIATO=$G(VIA("TO")) ;search returns data up to a certain value for IEN.
"RTN","VIABMS",41,0)
 S VIAPART=$G(VIA("PART"))
"RTN","VIABMS",42,0)
 S VIAXREF=$G(VIA("XREF"))
"RTN","VIABMS",43,0)
 S VIASCRN=$G(VIA("SCREEN"))
"RTN","VIABMS",44,0)
 S VIAID=$G(VIA("ID"))
"RTN","VIABMS",45,0)
 S VIASDT=$G(VIA("SDATE"))
"RTN","VIABMS",46,0)
 S VIAEDT=$G(VIA("EDATE"))
"RTN","VIABMS",47,0)
 S VIALEDT=$G(VIA("LASTEDT"))
"RTN","VIABMS",48,0)
 S VIAMDT=$G(VIA("MOVDATE"))
"RTN","VIABMS",49,0)
 S VIAMTYP=$G(VIA("MOVTYPE"))
"RTN","VIABMS",50,0)
 S VIAPIEN=$G(VIA("PATIEN"))
"RTN","VIABMS",51,0)
 S VIACIEN=$G(VIA("CLNIEN"))
"RTN","VIABMS",52,0)
 S VIAOIEN=$G(VIA("ORDIEN"))
"RTN","VIABMS",53,0)
 S VIASSN=$G(VIA("SSN"))
"RTN","VIABMS",54,0)
 S VIAVAL=$G(VIA("VALUE"))
"RTN","VIABMS",55,0)
 Q 
"RTN","VIABMS",56,0)
 ;
"RTN","VIABMS",57,0)
TMP ; -- temporary  environment variables set
"RTN","VIABMS",58,0)
 IF '$G(DUZ) D
"RTN","VIABMS",59,0)
 . S DUZ=.5,DUZ(0)="@",U="^",DTIME=300
"RTN","VIABMS",60,0)
 . D NOW^%DTC S DT=X
"RTN","VIABMS",61,0)
 Q
"RTN","VIABMS",62,0)
 ;
"RTN","VIABMS",63,0)
PATH(VIATAG) ;The PATH parameter determines the line tag executed and data returned by the RPC.
"RTN","VIABMS",64,0)
 N X,I
"RTN","VIABMS",65,0)
 S X=""
"RTN","VIABMS",66,0)
 F I=1:1 S X=$P($T(HNDL+I),";;",2) Q:(X="END")!(X="")  I $$UP^XLFSTR(VIA("PATH"))=$P(X,";") S VIATAG=$P(X,";",2) Q
"RTN","VIABMS",67,0)
 Q
"RTN","VIABMS",68,0)
 ;
"RTN","VIABMS",69,0)
GETPAT ;Returns patient information based on DFN from File #2;ICR-10035, ICR-6607
"RTN","VIABMS",70,0)
 ;Input - VIA("PATH")="GETPATIENT" [required]
"RTN","VIABMS",71,0)
 ;        VIA("IENS")=Patient DFN, [required]
"RTN","VIABMS",72,0)
 ;Data returned
"RTN","VIABMS",73,0)
 ; .01 Name,.02 Sex,.03 DateOfBirth,.09 SocialSecurityNumber,.097 DateEnteredIntoFile,
"RTN","VIABMS",74,0)
 ;  .103 TreatingSpecialty,.1041 AttendingPhysician,.302 ServiceConnectedPercentage,.105 CurrentAdmission,.1 Diagnosis [Short] from File #405
"RTN","VIABMS",75,0)
 N VIAFILE,VIAFIELDS,VIAFLAGS,X,VAL
"RTN","VIABMS",76,0)
 I VIAIENS="" S VIAER="Missing IENS Parameters" D ERR(VIAER) Q
"RTN","VIABMS",77,0)
 S VIAFILE=2,VIAFIELDS=".01;.02;.03;.09;.097;.103;.1041;.302;.105;",VIAFLAGS="IE"
"RTN","VIABMS",78,0)
 D GDIQ
"RTN","VIABMS",79,0)
 ; add Field .1 DIAGNOSIS [SHORT] from File #405 to result of .105 field in File #2.
"RTN","VIABMS",80,0)
 S X=1 F  S X=$O(RESULT(X)) Q:'X  I RESULT(X)["^.105^" S VAL=$P(RESULT(X),U,4) I VAL'="" S VAL=$$GET1^DIQ(405,VAL,.1,"E"),$P(RESULT(X),U,4)=$P(RESULT(X),U,4)_"~"_VAL Q
"RTN","VIABMS",81,0)
 Q
"RTN","VIABMS",82,0)
 ;
"RTN","VIABMS",83,0)
PATSSN ;Returns patient information based on SSN from File #2
"RTN","VIABMS",84,0)
 ;Input - VIA("PATH")="LISTPATIENTBYSSN" [required]
"RTN","VIABMS",85,0)
 ;        VIA("SSN")=SSN [required]
"RTN","VIABMS",86,0)
 N DFN
"RTN","VIABMS",87,0)
 S DFN=$O(^DPT("SSN",VIASSN,""))
"RTN","VIABMS",88,0)
 I DFN="" S VIAER="Invalid SSN" D ERR(VIAER) Q
"RTN","VIABMS",89,0)
 S VIAIENS=DFN_","
"RTN","VIABMS",90,0)
 D GETPAT
"RTN","VIABMS",91,0)
 Q
"RTN","VIABMS",92,0)
 ;
"RTN","VIABMS",93,0)
LADMPAT ;Returns a list of admitted patients from File #2
"RTN","VIABMS",94,0)
 ;Input - VIA("PATH")="LISTADMITTEDPATIENTSFORUPDATE" [required]
"RTN","VIABMS",95,0)
 ;        VIA("MAX")=n [optional]
"RTN","VIABMS",96,0)
 N VIAXREF,VIASCRN,X,VAL
"RTN","VIABMS",97,0)
 S VIAXREF="ACA",VIASCRN="I $D(^DPT(Y,.105))"
"RTN","VIABMS",98,0)
 D GPAT
"RTN","VIABMS",99,0)
 ; add Field .1 DIAGNOSIS [SHORT] from File #405 to result of .105 field in File #2.
"RTN","VIABMS",100,0)
 S X=1 F  S X=$O(RESULT(X)) Q:'X  S VAL=$P(RESULT(X),U,10) I VAL'="" S VAL=$$GET1^DIQ(405,VAL,.1,"E"),$P(RESULT(X),U,10)=$P(RESULT(X),U,10)_"~"_VAL
"RTN","VIABMS",101,0)
 Q
"RTN","VIABMS",102,0)
 ;
"RTN","VIABMS",103,0)
LSTPAT ;Returns a list of patients from File #2;ICR-10035, ICR-6607
"RTN","VIABMS",104,0)
 ;Input - VIA("PATH")="LISTPATIENT" [required]
"RTN","VIABMS",105,0)
 ;        VIA("IENS")=Patient DFN, (multiple IENs separated by comma) [required, optional if date range provided]
"RTN","VIABMS",106,0)
 ;        VIA("SDATE")=Start Date for search [optional if patient DFN provided]
"RTN","VIABMS",107,0)
 ;        VIA("EDATE")=End Date for search [optional if patient DFN provided]
"RTN","VIABMS",108,0)
 ;        VIA("MAX")=n [optional]
"RTN","VIABMS",109,0)
 ;
"RTN","VIABMS",110,0)
 N VIAFILE,VIAFIELDS,VIAFLAGS,TVIAIENS,TRESULT,Y,I,VALUE,FLDS,CNT,VAL,X
"RTN","VIABMS",111,0)
 I VIAIENS'="" S TVIAIENS=VIAIENS S VIAIENS=""
"RTN","VIABMS",112,0)
 I $G(TVIAIENS)'="" D  Q
"RTN","VIABMS",113,0)
 . S VIAFILE=2,VIAFIELDS=".01;.02;.03;.09;.097;.103;.1041;.302;.105;",VIAFLAGS="I"
"RTN","VIABMS",114,0)
 . S FLDS=".01-2;.02-3;.03-4;.09-5;.097-6;.103-7;.1041-8;.105-10;.302-9;"
"RTN","VIABMS",115,0)
 . S TRESULT(1)="[Data]",CNT=1,VIA("MAX")=""
"RTN","VIABMS",116,0)
 . F I=1:1:$L(TVIAIENS,",") S VIAIENS=$P(TVIAIENS,",",I) I VIAIENS'="" D  M RESULT=TRESULT
"RTN","VIABMS",117,0)
 . . S $P(VALUE,U)=VIAIENS
"RTN","VIABMS",118,0)
 . . S VIAIENS=VIAIENS_","
"RTN","VIABMS",119,0)
 . . K RESULT
"RTN","VIABMS",120,0)
 . . D GDIQ
"RTN","VIABMS",121,0)
 . . I $G(RESULT(1))'["Data" Q
"RTN","VIABMS",122,0)
 . . F Y=2:1:10 S J=$P($P(FLDS,";",Y-1),"-",2),$P(VALUE,U,J)=$P($G(RESULT(Y)),U,4) I RESULT(Y)["^.105^" D
"RTN","VIABMS",123,0)
 . . . S VAL=$P(RESULT(Y),U,4) I VAL'="" S VAL=$$GET1^DIQ(405,VAL,.1,"E"),$P(VALUE,U,J)=$P(VALUE,U,J)_"~"_VAL
"RTN","VIABMS",124,0)
 . . S CNT=CNT+1,TRESULT(CNT)=VALUE
"RTN","VIABMS",125,0)
 . . K RESULT
"RTN","VIABMS",126,0)
 D DTCHK(.RESULT,.VIASDT,.VIAEDT) I $D(RESULT) Q
"RTN","VIABMS",127,0)
 S VIASCRN="S X=$P($G(^DPT(Y,0)),U,9) I X?.N S X=$P($G(^DPT(Y,0)),U,16) I X>VIASDT,X<VIAEDT"
"RTN","VIABMS",128,0)
 D GPAT
"RTN","VIABMS",129,0)
 ; add Field .1 DIAGNOSIS [SHORT] from File #405 to result of .105 field in File #2.
"RTN","VIABMS",130,0)
 S X=1 F  S X=$O(RESULT(X)) Q:'X  S VAL=$P(RESULT(X),U,10) I VAL'="" S VAL=$$GET1^DIQ(405,VAL,.1,"E"),$P(RESULT(X),U,10)=$P(RESULT(X),U,10)_"~"_VAL
"RTN","VIABMS",131,0)
 Q
"RTN","VIABMS",132,0)
 ;
"RTN","VIABMS",133,0)
GPAT ;Get patient data from File #2;ICR-10035,ICR-6607
"RTN","VIABMS",134,0)
 ;Data returned
"RTN","VIABMS",135,0)
 ;  .01 Name,.02 Sex,.03 DateOfBirth,.09 SocialSecurityNumber,.097 DateEnteredIntoFile,.103 TreatingSpecialty
"RTN","VIABMS",136,0)
 ;  .1041 AttendingPhysician,.302 ServiceConnectedPercentage,.105 CurrentAdmission
"RTN","VIABMS",137,0)
 N VIAFILE,VIAFIELDS,VIAFLAGS
"RTN","VIABMS",138,0)
 S VIAFILE=2,VIAFIELDS="@;.01;.02;.03;.09;.097;.103;.1041;.302;.105;",VIAFLAGS="IP"
"RTN","VIABMS",139,0)
 D LDIC
"RTN","VIABMS",140,0)
 Q
"RTN","VIABMS",141,0)
 ;
"RTN","VIABMS",142,0)
ADMTPAT ;Returns a list of admitted patients from File #2 up to the Admitted IEN;ICR-10035
"RTN","VIABMS",143,0)
 ;Input - VIA("PATH")="LISTADMITTEDPATIENTS" [required]
"RTN","VIABMS",144,0)
 ;        VIA("TO")=Admission IEN [required]
"RTN","VIABMS",145,0)
 ;        VIA("MAX")=n [optional]
"RTN","VIABMS",146,0)
 ;Data returned
"RTN","VIABMS",147,0)
 ;   .01 Name,.09 Social Security Number,.101 Bed Name,.102 Movement IEN,.105 Admitting Diagnosis,.1  Ward Name
"RTN","VIABMS",148,0)
 N VIAFILE,VIAFIELDS,VIASCRN,VIAFLAGS
"RTN","VIABMS",149,0)
 I VIATO="" S VIAER="Missing Admission IEN Parameter" D ERR(VIAER) Q
"RTN","VIABMS",150,0)
 S VIAFILE=2,VIAFIELDS="@;.01;.09;.101;.102;.105;.1;",VIATO=VIATO+.01,VIAXREF="ACA"
"RTN","VIABMS",151,0)
 S VIASCRN="I $D(^DPT(Y,.105)),$P(^DPT(Y,.105),U,1)<"_VIATO,VIAFLAGS="IP"
"RTN","VIABMS",152,0)
 D LDIC
"RTN","VIABMS",153,0)
 Q
"RTN","VIABMS",154,0)
 ;
"RTN","VIABMS",155,0)
WRDLOC ;Returns information for a ward from File #42;ICR-6609
"RTN","VIABMS",156,0)
 ;Input - VIA("PATH")="GETWARDLOCATIONS" [required]
"RTN","VIABMS",157,0)
 ;        VIA("IENS")=Ward IEN, [required]
"RTN","VIABMS",158,0)
 ;Data returned
"RTN","VIABMS",159,0)
 ;   .01 Name, .017 Specialty, .2 IsCurrentlyOutOfService
"RTN","VIABMS",160,0)
 N VIAFILE,VIAFIELDS
"RTN","VIABMS",161,0)
 I VIAIENS="" S VIAER="Missing Ward IEN" D ERR(VIAER) Q
"RTN","VIABMS",162,0)
 S VIAFILE=42,VIAFIELDS=".01;.017;.2;",VIAFLAGS="IE"
"RTN","VIABMS",163,0)
 D GDIQ
"RTN","VIABMS",164,0)
 Q
"RTN","VIABMS",165,0)
 ;
"RTN","VIABMS",166,0)
HOSLOC ;Returns a list of hospital locations from File #44;ICR-10040;ICR-4782
"RTN","VIABMS",167,0)
 ;Input - VIA("PATH")="LISTHOSPITALLOCATIONS" [required]
"RTN","VIABMS",168,0)
 ;        VIA("IENS")=Hospital IEN, (multiple IENs separated by comma) [optional]
"RTN","VIABMS",169,0)
 ;Data returned
"RTN","VIABMS",170,0)
 ;   .01 Name,1 Abbreviation,99 Telephone,42 WardLocation
"RTN","VIABMS",171,0)
 N VIAFILE,VIAFIELDS,VIAFLAGS,TVIAIENS
"RTN","VIABMS",172,0)
 S VIAFILE=44,VIAFIELDS="@;.01;1;99;42;",VIAFLAGS="IP"
"RTN","VIABMS",173,0)
 I VIAIENS'="" S TVIAIENS=VIAIENS S VIAIENS="",VIAMAX=""
"RTN","VIABMS",174,0)
 D LDIC
"RTN","VIABMS",175,0)
 I $G(TVIAIENS)'="" S VIAIENS=TVIAIENS D PIENS^VIABMS1
"RTN","VIABMS",176,0)
 Q
"RTN","VIABMS",177,0)
 ;
"RTN","VIABMS",178,0)
NEWPER ;Returns a list of people from the NEW PERSON file #200 for a date range on DATE ENTERED Filed (#30)
"RTN","VIABMS",179,0)
 ;Input - VIA("PATH")="LISTNEWPERSON" [required]
"RTN","VIABMS",180,0)
 ;        VIA("IENS")=New Person IEN, (multiple IENs separated by comma) [optional]
"RTN","VIABMS",181,0)
 ;        VIA("SDATE")=Start Date for search [required, if VIA(IENS) not present]
"RTN","VIABMS",182,0)
 ;        VIA("EDATE")=End Date for search [required, if VIA(IENS) not present] 
"RTN","VIABMS",183,0)
 ;Data returned;ICR #10060
"RTN","VIABMS",184,0)
 ;   .01 Name, 30  Date Entered
"RTN","VIABMS",185,0)
 N VIAFILE,VIAFIELDS,VIAFLAGS,TVIAIENS,TRESULT
"RTN","VIABMS",186,0)
 S VIAFILE=200,VIAFIELDS="@;.01;30;",VIAFLAGS="IP",VIAXREF="B"
"RTN","VIABMS",187,0)
 I VIAIENS'="" S TVIAIENS=VIAIENS S VIAIENS=""
"RTN","VIABMS",188,0)
 I $G(TVIAIENS)'="" S VIAFIELDS=".01;30;",VIAFLAGS="I" D  Q
"RTN","VIABMS",189,0)
 . S TRESULT(1)="[Data]",CNT=1
"RTN","VIABMS",190,0)
 . F I=1:1:$L(TVIAIENS,",") S VIAIENS=$P(TVIAIENS,",",I) I VIAIENS'="" D  M RESULT=TRESULT
"RTN","VIABMS",191,0)
 . . S VIAIENS=VIAIENS_","
"RTN","VIABMS",192,0)
 . . K RESULT
"RTN","VIABMS",193,0)
 . . D GDIQ
"RTN","VIABMS",194,0)
 . . I $G(RESULT(1))'["Data" Q
"RTN","VIABMS",195,0)
 . . S CNT=CNT+1,TRESULT(CNT)=$TR(VIAIENS,",")_"^"_$P($G(RESULT(2)),U,4)_"^"_$P($G(RESULT(3)),U,4)
"RTN","VIABMS",196,0)
 . . K RESULT
"RTN","VIABMS",197,0)
 D DTCHK(.RESULT,.VIASDT,.VIAEDT) I $D(RESULT) Q
"RTN","VIABMS",198,0)
 S VIASCRN="S X=$P($G(^(1)),U,7) I X>VIASDT,X<VIAEDT"
"RTN","VIABMS",199,0)
 D LDIC
"RTN","VIABMS",200,0)
 Q
"RTN","VIABMS",201,0)
 ;
"RTN","VIABMS",202,0)
SPLTY ;Returns a list of specialties from the SPECIALTY file #42.4;ICR-2652
"RTN","VIABMS",203,0)
 ;Input - VIA("PATH")="LISTSPECIALTY" [required]
"RTN","VIABMS",204,0)
 ;        VIA("IENS")= Specialty IEN, (multiple IENs separated by comma) [optional] 
"RTN","VIABMS",205,0)
 ;Data returned
"RTN","VIABMS",206,0)
 ;   .01 Name
"RTN","VIABMS",207,0)
 N VIAFILE,VIAFIELDS,VIAFLAGS,TVIAIENS
"RTN","VIABMS",208,0)
 S VIAFILE=42.4,VIAFIELDS="@;.01;",VIAFLAGS="IP"
"RTN","VIABMS",209,0)
 I VIAIENS'="" S TVIAIENS=VIAIENS S VIAIENS="",VIAMAX=""
"RTN","VIABMS",210,0)
 D LDIC
"RTN","VIABMS",211,0)
 I $G(TVIAIENS)'="" S VIAIENS=TVIAIENS D PIENS^VIABMS1
"RTN","VIABMS",212,0)
 Q
"RTN","VIABMS",213,0)
 ;
"RTN","VIABMS",214,0)
PATAPPT ; Returns a list of patient appointments using API SDAPI^SDAMA301;ICR-4433
"RTN","VIABMS",215,0)
 ;Input - VIA("PATH")="LISTPATIENTAPPOINTMENT" [required]
"RTN","VIABMS",216,0)
 ;        VIA("IENS")=Patient IEN [required]
"RTN","VIABMS",217,0)
 ;        VIA("CLNIEN")=Hospital Location IEN [optional]
"RTN","VIABMS",218,0)
 ;        VIA("SDATE")=Start Date for search [optional]
"RTN","VIABMS",219,0)
 ;        VIA("EDATE")=End Date for search [optional]
"RTN","VIABMS",220,0)
 ;Data returned
"RTN","VIABMS",221,0)
 ;    .01 HospitalLocation, 20 DateAppointmentMade, 100 CurrentStatus
"RTN","VIABMS",222,0)
 N VIARRAY,CNT,VIADT,VIADFN,VIAPPT,VIACNT,CLNIEN,RCNT
"RTN","VIABMS",223,0)
 I VIAIENS="" S VIAER="Missing PATIENT IEN" D ERR(VIAER) Q 
"RTN","VIABMS",224,0)
 I (VIASDT'="")!(VIAEDT'="") D DTCHK(.RESULT,.VIASDT,.VIAEDT) I $D(RESULT) Q 
"RTN","VIABMS",225,0)
 S VIADFN=$TR(VIAIENS,","),VIAEDT=$S(VIAEDT="":DT,1:VIAEDT)
"RTN","VIABMS",226,0)
 S RESULT(1)="[Data]",CNT=1,RCNT=1
"RTN","VIABMS",227,0)
 S VIARRAY(1)=$P(VIASDT,".")_";"_$P(VIAEDT,".")
"RTN","VIABMS",228,0)
 I VIACIEN'="" S VIARRAY(2)=VIACIEN
"RTN","VIABMS",229,0)
 S VIARRAY(4)=VIADFN
"RTN","VIABMS",230,0)
 S VIARRAY("FLDS")="1;2;16;22"
"RTN","VIABMS",231,0)
 S VIACNT=$$SDAPI^SDAMA301(.VIARRAY)
"RTN","VIABMS",232,0)
 I VIACNT<1 Q
"RTN","VIABMS",233,0)
 I VIACNT>VIAMAX S RESULT(1)="[Misc]",RESULT(2)="[More]",RESULT(3)="[Data]",CNT=3
"RTN","VIABMS",234,0)
 S CLNIEN=$S(VIAFROM'="":$P(VIAFROM,"^")-1,1:0),VIADT=$S(VIAFROM'="":$P(VIAFROM,"^",2),1:0)
"RTN","VIABMS",235,0)
 F  S CLNIEN=$O(^TMP($J,"SDAMA301",VIADFN,CLNIEN)) Q:'CLNIEN  D  I RCNT>VIAMAX S RESULT(2)=RESULT(2)_"^"_CLNIEN_"^"_VIADT Q
"RTN","VIABMS",236,0)
 . S VIADT=$S((VIAFROM'="")&(RCNT=1):$P(VIAFROM,"^",2),1:0)
"RTN","VIABMS",237,0)
 . F  S VIADT=$O(^TMP($J,"SDAMA301",VIADFN,CLNIEN,VIADT)) Q:'VIADT  D  I RCNT>VIAMAX Q
"RTN","VIABMS",238,0)
 . . S VIAPPT=$G(^TMP($J,"SDAMA301",VIADFN,CLNIEN,VIADT)) ;appointment data
"RTN","VIABMS",239,0)
 . . I (VIADT<VIASDT)!(VIADT>VIAEDT) Q
"RTN","VIABMS",240,0)
 . . S CNT=CNT+1,RCNT=RCNT+1,RESULT(CNT)=VIADT_"^"_CLNIEN_"^"_$P(VIAPPT,"^",16)_"^"_$P($P(VIAPPT,"^",22),";",3)
"RTN","VIABMS",241,0)
 K ^TMP($J,"SDAMA301")
"RTN","VIABMS",242,0)
 Q
"RTN","VIABMS",243,0)
 ;
"RTN","VIABMS",244,0)
CANORDS ; Returns a list of cancelled orders from the ORDER file #100;ICR-5771
"RTN","VIABMS",245,0)
 ;Input - VIA("PATH")=VIA("PATH")="LISTCANCELORDERS" [required]
"RTN","VIABMS",246,0)
 ;        VIA("IENS")=Order IEN [required]
"RTN","VIABMS",247,0)
 ;Data returned
"RTN","VIABMS",248,0)
 ;    .5 OrderStatus
"RTN","VIABMS",249,0)
 N VIAFILE,VIAFIELDS,VIAFLAGS
"RTN","VIABMS",250,0)
 S VIAFILE=100,VIAFIELDS="5",VIAFLAGS="IE"
"RTN","VIABMS",251,0)
 I VIAIENS="" S VIAER="Missing ORDER IEN" D ERR(VIAER) Q
"RTN","VIABMS",252,0)
 D GDIQ
"RTN","VIABMS",253,0)
 Q
"RTN","VIABMS",254,0)
 ;
"RTN","VIABMS",255,0)
LWRDLOC ; Returns a list of ward locations from the WARD LOCATION file #42;ICR-6609
"RTN","VIABMS",256,0)
 ;Input - VIA("PATH")="LISTWARDLOCATION" [required]
"RTN","VIABMS",257,0)
 ;        VIA("IENS")= Ward Location IEN, (multiple IENs separated by comma) [optional] 
"RTN","VIABMS",258,0)
 ;Data returned
"RTN","VIABMS",259,0)
 ;    .01 Name,.017 Specialty,.2 IsCurrentlyOutOfService
"RTN","VIABMS",260,0)
 N VIAFILE,VIAFIELDS,VIAFLAGS,TVIAIENS
"RTN","VIABMS",261,0)
 S VIAFILE=42,VIAFIELDS="@;.01;.017;.2",VIAFLAGS="IP"
"RTN","VIABMS",262,0)
 I VIAIENS'="" S TVIAIENS=VIAIENS S VIAIENS="",VIAMAX=""
"RTN","VIABMS",263,0)
 D LDIC
"RTN","VIABMS",264,0)
 I $G(TVIAIENS)'="" S VIAIENS=TVIAIENS D PIENS^VIABMS1
"RTN","VIABMS",265,0)
 Q
"RTN","VIABMS",266,0)
 ;
"RTN","VIABMS",267,0)
MOVTYP ; Returns a list of facility movement type from the FACILITY MOVEMENT TYPE file #405.1;ICR-6610
"RTN","VIABMS",268,0)
 ;Input - VIA("PATH")="LISTFACILITYMOVEMENTTYPE" [required]
"RTN","VIABMS",269,0)
 ;        VIA("IENS")= Facility Movement Type IEN, (multiple IENs separated by comma) [optional]
"RTN","VIABMS",270,0)
 ;Data returned
"RTN","VIABMS",271,0)
 ;    .01 Name,.04 Active
"RTN","VIABMS",272,0)
 N VIAFILE,VIAFIELDS,VIAFLAGS,TVIAIENS
"RTN","VIABMS",273,0)
 S VIAFILE=405.1,VIAFIELDS="@;.01;.04",VIAFLAGS="IP"
"RTN","VIABMS",274,0)
 I VIAIENS'="" S TVIAIENS=VIAIENS S VIAIENS="",VIAMAX=""
"RTN","VIABMS",275,0)
 D LDIC
"RTN","VIABMS",276,0)
 I $G(TVIAIENS)'="" S VIAIENS=TVIAIENS D PIENS^VIABMS1
"RTN","VIABMS",277,0)
 Q
"RTN","VIABMS",278,0)
 ;
"RTN","VIABMS",279,0)
DTCHK(RESULT,VIASDT,VIAEDT) ;check/set date
"RTN","VIABMS",280,0)
 I (VIASDT="")!(VIAEDT="") S VIAER="Missing Date Parameters" D ERR(VIAER) Q
"RTN","VIABMS",281,0)
 S VIASDT=VIASDT-.000001,VIAEDT=$S(VIAEDT[".":VIAEDT+.000001,1:VIAEDT+.999999)
"RTN","VIABMS",282,0)
 Q
"RTN","VIABMS",283,0)
 ;
"RTN","VIABMS",284,0)
PATCHK(DFN) ;check if patient is valid in File #2
"RTN","VIABMS",285,0)
 D PID^VADPT
"RTN","VIABMS",286,0)
 I $G(VAERR) S VIAER="Invalid Patient IEN" D ERR(VIAER)
"RTN","VIABMS",287,0)
 K VA,VAERR
"RTN","VIABMS",288,0)
 Q
"RTN","VIABMS",289,0)
 ;
"RTN","VIABMS",290,0)
GDIQ ;Runs GETS^DIQ
"RTN","VIABMS",291,0)
 N VIADATA,VIAERR,Y,VIAFLD,N,X,J,C
"RTN","VIABMS",292,0)
 D GETS^DIQ(VIAFILE,VIAIENS,VIAFIELDS,VIAFLAGS,"VIADATA","VIAERR")
"RTN","VIABMS",293,0)
 S N=0
"RTN","VIABMS",294,0)
 D SET("[Data]")
"RTN","VIABMS",295,0)
 S VIAFLD=0 F  S VIAFLD=$O(VIADATA(VIAFILE,VIAIENS,VIAFLD)) Q:'VIAFLD  D
"RTN","VIABMS",296,0)
 . S X=VIAFILE_"^"_$E(VIAIENS,1,$L(VIAIENS)-1)_"^"_VIAFLD_"^"
"RTN","VIABMS",297,0)
 . ; -- below call to $$GET1 is too slow...working w/FM team for speed
"RTN","VIABMS",298,0)
 . ;IF $$GET1^DID(VIAFILE,VIAFLD,"","TYPE")="WORD-PROCESSING" D
"RTN","VIABMS",299,0)
 . IF $P($G(^DD(VIAFILE,VIAFLD,0)),U,4)[";0" D
"RTN","VIABMS",300,0)
 . . D SET(X_"[WORD PROCESSING]")
"RTN","VIABMS",301,0)
 . . S J=0 F  S J=$O(VIADATA(VIAFILE,VIAIENS,VIAFLD,J)) Q:'J  D
"RTN","VIABMS",302,0)
 . . . D SET(VIADATA(VIAFILE,VIAIENS,VIAFLD,J))
"RTN","VIABMS",303,0)
 . . D SET("$$END$$")
"RTN","VIABMS",304,0)
 . E  D
"RTN","VIABMS",305,0)
 . . D SET(X_$G(VIADATA(VIAFILE,VIAIENS,VIAFLD,"I"))_"^"_$G(VIADATA(VIAFILE,VIAIENS,VIAFLD,"E")))
"RTN","VIABMS",306,0)
 ;
"RTN","VIABMS",307,0)
 IF $D(VIAERR) D
"RTN","VIABMS",308,0)
 . D SET("[ERROR]")
"RTN","VIABMS",309,0)
 ;
"RTN","VIABMS",310,0)
 M RESULT=Y
"RTN","VIABMS",311,0)
 Q
"RTN","VIABMS",312,0)
 ; 
"RTN","VIABMS",313,0)
LDIC ;Runs LIST^DIC
"RTN","VIABMS",314,0)
 N VIAERR,Y,I,N
"RTN","VIABMS",315,0)
 D LIST^DIC(VIAFILE,VIAIENS,VIAFIELDS,VIAFLAGS,VIAMAX,.VIAFROM,VIAPART,VIAXREF,VIASCRN,VIAID,"^TMP(""VIARSLT"",$J)","VIAERR")
"RTN","VIABMS",316,0)
 S N=0
"RTN","VIABMS",317,0)
 IF $G(VIAFROM)]"" D
"RTN","VIABMS",318,0)
 . D SET("[Misc]")
"RTN","VIABMS",319,0)
 . D SET("MORE"_U_VIAFROM_U_VIAFROM("IEN"))
"RTN","VIABMS",320,0)
 ;
"RTN","VIABMS",321,0)
 D SET("[Data]")
"RTN","VIABMS",322,0)
 S I=0 F  S I=$O(^TMP("VIARSLT",$J,"DILIST",I)) Q:'I  D SET($G(^TMP("VIARSLT",$J,"DILIST",I,0)))
"RTN","VIABMS",323,0)
 ;
"RTN","VIABMS",324,0)
 IF $D(VIAERR) D
"RTN","VIABMS",325,0)
 . D SET("[Errors]")
"RTN","VIABMS",326,0)
 . D SET($G(VIAERR("DIERR",1,"TEXT",1)))
"RTN","VIABMS",327,0)
 ;
"RTN","VIABMS",328,0)
 M RESULT=Y
"RTN","VIABMS",329,0)
 K ^TMP("VIARSLT",$J)
"RTN","VIABMS",330,0)
 Q
"RTN","VIABMS",331,0)
 ;
"RTN","VIABMS",332,0)
SET(X) ;
"RTN","VIABMS",333,0)
 S N=N+1
"RTN","VIABMS",334,0)
 S Y(N)=X
"RTN","VIABMS",335,0)
 Q
"RTN","VIABMS",336,0)
 ;
"RTN","VIABMS",337,0)
ERR(X) ;Error processing
"RTN","VIABMS",338,0)
 N N
"RTN","VIABMS",339,0)
 S N=0
"RTN","VIABMS",340,0)
 D SET("[Errors]")
"RTN","VIABMS",341,0)
 D SET(X)
"RTN","VIABMS",342,0)
 M RESULT=Y
"RTN","VIABMS",343,0)
 Q
"RTN","VIABMS",344,0)
 ;
"RTN","VIABMS",345,0)
KVAR ;Clean-up
"RTN","VIABMS",346,0)
 K VIAFILE,VIAFIELDS,VIAIENS,VIAEDT,VIAFLAGS,VIAID,VIAMAX,VIAPART,VIASCRN,VIASDT,VIAVAL,VIAXREF,VIAFROM
"RTN","VIABMS",347,0)
 K VIAPIEN,VIACIEN,VIAMDT,VIAMTYP,VIATO,VIALEDT,VIASSN,VIAA,VIAB,VIAC,VIAD,VIAR,VIAV,VIAX,VIAOIEN,VIA3,X,Y
"RTN","VIABMS",348,0)
 Q
"RTN","VIABMS",349,0)
 ;
"RTN","VIABMS",350,0)
HNDL ;Finds PATH and linetag that needs to be executed for results
"RTN","VIABMS",351,0)
 ;;GETPATIENT;GETPAT
"RTN","VIABMS",352,0)
 ;;LISTPATIENTBYSSN;PATSSN
"RTN","VIABMS",353,0)
 ;;LISTADMITTEDPATIENTSFORUPDATE;LADMPAT
"RTN","VIABMS",354,0)
 ;;LISTPATIENT;LSTPAT
"RTN","VIABMS",355,0)
 ;;LISTADMITTEDPATIENTS;ADMTPAT
"RTN","VIABMS",356,0)
 ;;GETWARDLOCATIONS;WRDLOC
"RTN","VIABMS",357,0)
 ;;LISTHOSPITALLOCATIONS;HOSLOC
"RTN","VIABMS",358,0)
 ;;LISTNEWPERSON;NEWPER
"RTN","VIABMS",359,0)
 ;;LISTSPECIALTY;SPLTY
"RTN","VIABMS",360,0)
 ;;LISTPATIENTAPPOINTMENT;PATAPPT
"RTN","VIABMS",361,0)
 ;;LISTCANCELORDERS;CANORDS
"RTN","VIABMS",362,0)
 ;;LISTWARDLOCATION;LWRDLOC
"RTN","VIABMS",363,0)
 ;;LISTFACILITYMOVEMENTTYPE;MOVTYP
"RTN","VIABMS",364,0)
 ;;LISTFACILITYTREATINGSPECIALTY;TRTSPTY^VIABMS1
"RTN","VIABMS",365,0)
 ;;LISTMASMOVEMENTTRANSACTIONTYPE;MASTYP^VIABMS1
"RTN","VIABMS",366,0)
 ;;LISTMEDICALCENTERDIVISION;MEDCTR^VIABMS1
"RTN","VIABMS",367,0)
 ;;LISTORDERABLEITEM;ORDITM^VIABMS1
"RTN","VIABMS",368,0)
 ;;LISTORDERSTATUS;ORDSTA^VIABMS1
"RTN","VIABMS",369,0)
 ;;LISTBEDSWITCH;BEDSWCH^VIABMS1
"RTN","VIABMS",370,0)
 ;;GETPATIENTMOVEMENT;GPATMVT^VIABMS1
"RTN","VIABMS",371,0)
 ;;LISTPATIENTMOVEMENT;LPATMVT^VIABMS1
"RTN","VIABMS",372,0)
 ;;LISTPATIENTMOVEMENTSBYADMISSION;APATMVT^VIABMS1
"RTN","VIABMS",373,0)
 ;;LISTSCHEDULEDADMISSION;SCHADM^VIABMS1
"RTN","VIABMS",374,0)
 ;;LISTROOMBED;RMBED^VIABMS1
"RTN","VIABMS",375,0)
 ;;LISTCLINICAPPOINTMENTS;CLNAPPT^VIABMS1
"RTN","VIABMS",376,0)
 ;;LISTORDERS;LSTORD^VIABMS1
"RTN","VIABMS",377,0)
 ;;LISTORDERACTIONS;ORDACT^VIABMS1
"RTN","VIABMS",378,0)
 ;;END
"RTN","VIABMS1")
0^10^B138039577^n/a
"RTN","VIABMS1",1,0)
VIABMS1 ;AAC/JMC - VIA BMS RPCs ;04/15/2016
"RTN","VIABMS1",2,0)
 ;;1.0;VISTA INTEGRATION ADAPTER;**8**;06-FEB-2014;Build 8
"RTN","VIABMS1",3,0)
 ;
"RTN","VIABMS1",4,0)
 ;The following RPC is in support of the Bed Management System (BMS). This RPC reads the parameter "Path"
"RTN","VIABMS1",5,0)
 ;and determine from that parameter which data to return.  All BMS requests are handled by this one RPC.
"RTN","VIABMS1",6,0)
 ;Continuation of VIABMS
"RTN","VIABMS1",7,0)
 ; RPC VIAB BMS
"RTN","VIABMS1",8,0)
 ; ICR 1254    DIC(45.7,   [field #1]
"RTN","VIABMS1",9,0)
 ; ICR 2638    ORDER STATUS file direct access [Filed 100.01, field #.01]
"RTN","VIABMS1",10,0)
 ; ICR 1359    DBIA1359 [File #45.7;field .01]
"RTN","VIABMS1",11,0)
 ; ICR 433     DBIA433 [File #405.1;field .01]
"RTN","VIABMS1",12,0)
 ; ICR 2438    DBIA2438 [File #40.8;field .01]
"RTN","VIABMS1",13,0)
 ; ICR 2843    DBIA2843 [File #101.43;field .01] (controlled)
"RTN","VIABMS1",14,0)
 ; ICR 2638    ORDER STATUS file direct access [File #100.01;field .01]
"RTN","VIABMS1",15,0)
 ; ICR 6611    SCHEDULED ADMISSION [File 41.1;fields fields .01;2;3;4;5;6;8;9;11;12;13;14](private)
"RTN","VIABMS1",16,0)
 ; ICR 1380    ROOM-BED [File #405.4;fields .01;.2;100](controlled)
"RTN","VIABMS1",17,0)
 ; ICR 4433    NAME: DBIA4433 (API SDAPI^SDAMA301) [supported] 
"RTN","VIABMS1",18,0)
 ; ICR 1865    DBIA1865 [File #405;fields .01;.02;.03;.04;.06;.07;.14;100;101]
"RTN","VIABMS1",19,0)
 ; ICR 6475    LIST ORDERS [File #100; fields .02;6;5;30;31;etc]
"RTN","VIABMS1",20,0)
 Q
"RTN","VIABMS1",21,0)
 ;
"RTN","VIABMS1",22,0)
TRTSPTY ; Returns a list of facility treating specialty from the FACILITY TREATING SPECIALTY file #45.7;ICR-1359
"RTN","VIABMS1",23,0)
 ;Input - VIA("PATH")="LISTFACILITYTREATINGSPECIALTY" [required]
"RTN","VIABMS1",24,0)
 ;        VIA("IENS")= Facility Treating Specialty IEN, (multiple IENs separated by comma) [optional] 
"RTN","VIABMS1",25,0)
 ;Data returned
"RTN","VIABMS1",26,0)
 ;    .01 Name,1 Specialty ID
"RTN","VIABMS1",27,0)
 N VIAFILE,VIAFIELDS,VIAFLAGS,TVIAIENS
"RTN","VIABMS1",28,0)
 S VIAFILE=45.7,VIAFIELDS="@;.01;1",VIAFLAGS="IP"
"RTN","VIABMS1",29,0)
 I VIAIENS'="" S TVIAIENS=VIAIENS S VIAIENS="",VIAMAX=""
"RTN","VIABMS1",30,0)
 D LDIC^VIABMS
"RTN","VIABMS1",31,0)
 I $G(TVIAIENS)'="" S VIAIENS=TVIAIENS D PIENS
"RTN","VIABMS1",32,0)
 Q
"RTN","VIABMS1",33,0)
 ;
"RTN","VIABMS1",34,0)
PIENS ; multiple IENs; parse IENS
"RTN","VIABMS1",35,0)
 N TRESULT,IEN,I,CNT,X
"RTN","VIABMS1",36,0)
 I '$D(RESULT) Q
"RTN","VIABMS1",37,0)
 M TRESULT=RESULT
"RTN","VIABMS1",38,0)
 K RESULT
"RTN","VIABMS1",39,0)
 S RESULT(1)="[Data]",CNT=1
"RTN","VIABMS1",40,0)
 F I=1:1:$L(VIAIENS,",") S IEN=$P(VIAIENS,",",I) I IEN'="" S IEN(IEN)=""
"RTN","VIABMS1",41,0)
 S X=0 F  S X=$O(TRESULT(X)) Q:'X  S IEN=$P(TRESULT(X),U) I IEN'="",$D(IEN(IEN)) D
"RTN","VIABMS1",42,0)
 . S CNT=CNT+1,RESULT(CNT)=TRESULT(X)
"RTN","VIABMS1",43,0)
 Q
"RTN","VIABMS1",44,0)
 ;
"RTN","VIABMS1",45,0)
MASTYP ; Returns a list of MAS movement transaction type from the MAS MOVEMENT TRANSACTION TYPE file #405.3;ICR-433
"RTN","VIABMS1",46,0)
 ;Input - VIA("PATH")="LISTMASMOVEMENTTRANSACTIONTYPE" [required] 
"RTN","VIABMS1",47,0)
 ;Data returned
"RTN","VIABMS1",48,0)
 ;    .01 Name
"RTN","VIABMS1",49,0)
 N VIAFILE,VIAFIELDS,VIAFLAGS
"RTN","VIABMS1",50,0)
 S VIAFILE=405.3,VIAFIELDS="@;.01",VIAFLAGS="IP"
"RTN","VIABMS1",51,0)
 D LDIC^VIABMS
"RTN","VIABMS1",52,0)
 Q
"RTN","VIABMS1",53,0)
 ;
"RTN","VIABMS1",54,0)
MEDCTR ; Returns a list of Medical Center division from the MEDICAL CENTER DIVISION file #40.8;ICR-2438
"RTN","VIABMS1",55,0)
 ;Input - VIA("PATH")="LISTMEDICALCENTERDIVISION" [required]
"RTN","VIABMS1",56,0)
 ;        VIA("IENS")= Medical Center Division IEN, (multiple IENs separated by comma) [optional] 
"RTN","VIABMS1",57,0)
 ;Data returned
"RTN","VIABMS1",58,0)
 ;    .01 Name
"RTN","VIABMS1",59,0)
 N VIAFILE,VIAFIELDS,VIAFLAGS,TVIAIENS
"RTN","VIABMS1",60,0)
 S VIAFILE=40.8,VIAFIELDS="@;.01",VIAFLAGS="IP"
"RTN","VIABMS1",61,0)
 I VIAIENS'="" S TVIAIENS=VIAIENS S VIAIENS="",VIAMAX=""
"RTN","VIABMS1",62,0)
 D LDIC^VIABMS
"RTN","VIABMS1",63,0)
 I $G(TVIAIENS)'="" S VIAIENS=TVIAIENS D PIENS
"RTN","VIABMS1",64,0)
 Q
"RTN","VIABMS1",65,0)
 ;
"RTN","VIABMS1",66,0)
ORDITM ; Returns a list of orderable items from the ORDERABLE ITEMS file #101.43;ICR-2843
"RTN","VIABMS1",67,0)
 ;Input - VIA("PATH")="LISTORDERABLEITEM" [required]
"RTN","VIABMS1",68,0)
 ;Data returned
"RTN","VIABMS1",69,0)
 ;    .01 Name
"RTN","VIABMS1",70,0)
 N VIAFILE,VIAFIELDS,VIAFLAGS,VIAXREF
"RTN","VIABMS1",71,0)
 S VIAFILE=101.43,VIAFIELDS="@;.01",VIAFLAGS="IPQ",VIAXREF="#"
"RTN","VIABMS1",72,0)
 D LDIC^VIABMS
"RTN","VIABMS1",73,0)
 Q
"RTN","VIABMS1",74,0)
 ;
"RTN","VIABMS1",75,0)
ORDSTA ; Returns a list of Medical Center division from the ORDER STATUS file #100.01;ICR-2638
"RTN","VIABMS1",76,0)
 ;Input - VIA("PATH")="LISTORDERSTATUS" [required]
"RTN","VIABMS1",77,0)
 ;        VIA("IENS")= Order Status IEN, (multiple IENs separated by comma) [optional] 
"RTN","VIABMS1",78,0)
 ;Data returned
"RTN","VIABMS1",79,0)
 ;    .01 Name
"RTN","VIABMS1",80,0)
 N VIAFILE,VIAFIELDS,VIAFLAGS,TVIAIENS
"RTN","VIABMS1",81,0)
 S VIAFILE=100.01,VIAFIELDS="@;.01",VIAFLAGS="IP"
"RTN","VIABMS1",82,0)
 I VIAIENS'="" S TVIAIENS=VIAIENS S VIAIENS="",VIAMAX=""
"RTN","VIABMS1",83,0)
 D LDIC^VIABMS
"RTN","VIABMS1",84,0)
 I $G(TVIAIENS)'="" S VIAIENS=TVIAIENS D PIENS
"RTN","VIABMS1",85,0)
 Q
"RTN","VIABMS1",86,0)
 ;
"RTN","VIABMS1",87,0)
BEDSWCH ; Returns a list of bed switch from the PATIENT MOVEMENT file #405;ICR-1865
"RTN","VIABMS1",88,0)
 ;Input - VIA("PATH")="LISTBEDSWITCH" [required]
"RTN","VIABMS1",89,0)
 ;        VIA("IENS")="Patient Movement IEN" (multiple IENs separated by a comma) [required]
"RTN","VIABMS1",90,0)
 ;Data returned
"RTN","VIABMS1",91,0)
 ;    .06 WardLocationId,.07 RoomBedId
"RTN","VIABMS1",92,0)
 N VIAFILE,VIAFIELDS,VIAFLAGS,I,VIATIEN,VIAIEN,TRESULT,X,N,I,VAL
"RTN","VIABMS1",93,0)
 I VIAIENS="" S VIAER="Missing MOVEMENT IEN" D ERR^VIABMS(VIAER) Q 
"RTN","VIABMS1",94,0)
 S VIAFILE=405,VIAFIELDS=".06;.07",VIAFLAGS="IE"
"RTN","VIABMS1",95,0)
 S TRESULT(1)="[Data]",CNT=1
"RTN","VIABMS1",96,0)
 ; multiple IENs
"RTN","VIABMS1",97,0)
 S VIATIEN=VIAIENS
"RTN","VIABMS1",98,0)
 F I=1:1:$L(VIATIEN,",") S VIAIEN=$P(VIATIEN,",",I) I VIAIEN'="" D
"RTN","VIABMS1",99,0)
 . S VIAIENS=VIAIEN_","
"RTN","VIABMS1",100,0)
 . K RESULT
"RTN","VIABMS1",101,0)
 . D GDIQ^VIABMS
"RTN","VIABMS1",102,0)
 . I $G(RESULT(1))'["Data" Q
"RTN","VIABMS1",103,0)
 . S VAL=$P($G(RESULT(2)),U,1,2)_U_$TR($P($G(RESULT(2)),U,4,5),"^",";")_U_$TR($P($G(RESULT(3)),U,4,5),"^",";")
"RTN","VIABMS1",104,0)
 . S CNT=CNT+1,TRESULT(CNT)=VAL
"RTN","VIABMS1",105,0)
 . K RESULT
"RTN","VIABMS1",106,0)
 M RESULT=TRESULT
"RTN","VIABMS1",107,0)
 ;
"RTN","VIABMS1",108,0)
 Q
"RTN","VIABMS1",109,0)
 N VIAFILE,VIAFIELDS,VIAFLAGS,I,VIATIEN,VIAIEN,TRESULT,X,N,I
"RTN","VIABMS1",110,0)
 I VIAIENS="" S VIAER="Missing MOVEMENT IEN" D ERR^VIABMS(VIAER) Q 
"RTN","VIABMS1",111,0)
 S VIAFILE=405,VIAFIELDS=".06;.07",VIAFLAGS="IE"
"RTN","VIABMS1",112,0)
 ; multiple IENs
"RTN","VIABMS1",113,0)
 S VIATIEN=VIAIENS
"RTN","VIABMS1",114,0)
 F I=1:1:$L(VIATIEN,",") S VIAIEN=$P(VIATIEN,",",I) I VIAIEN'="" D
"RTN","VIABMS1",115,0)
 . S VIAIENS=VIAIEN_"," D GDIQ^VIABMS
"RTN","VIABMS1",116,0)
 . I '$D(TRESULT) M TRESULT=RESULT K RESULT Q
"RTN","VIABMS1",117,0)
 . S X=0,N=$O(TRESULT(""),-1) F  S X=$O(RESULT(X)) Q:'X  S N=N+1 S TRESULT(N)=RESULT(X)
"RTN","VIABMS1",118,0)
 . K RESULT
"RTN","VIABMS1",119,0)
 M RESULT=TRESULT
"RTN","VIABMS1",120,0)
 Q 
"RTN","VIABMS1",121,0)
 ;
"RTN","VIABMS1",122,0)
GPATMVT ; Returns a patient movement records from the PATIENT MOVEMENT file #405;ICR-1865
"RTN","VIABMS1",123,0)
 ;Input - VIA("PATH")="GETPATIENTMOVEMENT" [required]
"RTN","VIABMS1",124,0)
 ;        VIA("IENS")="Patient Movement IEN" [required, optional if no other parameter]
"RTN","VIABMS1",125,0)
 ;        VIA("MOVDATE")=Movement Date [optional, required if no Patient Movement IEN]
"RTN","VIABMS1",126,0)
 ;        VIA("MOVTYPE")=Movement Type [optional, required if no Patient Movement IEN]
"RTN","VIABMS1",127,0)
 ;        VIA("PATIEN")=Patient IEN [optional, required if no Patient Movement IEN]
"RTN","VIABMS1",128,0)
 ;Data returned
"RTN","VIABMS1",129,0)
 ;    .01 MovementDate,101 EnteredDate,100 Entered By,.02 TransactionTypeId,.03 PatientIen,
"RTN","VIABMS1",130,0)
 ;    .04 TypeOfMovementIen,.06 WardLocationId,.07 RoomBedId,.14 CurrentAdmissionIen
"RTN","VIABMS1",131,0)
 N VIAFILE,VIAFIELDS,VIAFLAGS,VIASCRN
"RTN","VIABMS1",132,0)
 S VIAFILE=405,VIAFIELDS=".01;101;100;.02;.03;.04;.06;.07;.14"
"RTN","VIABMS1",133,0)
 I VIAIENS="",VIAMDT="",VIAMTYP="",VIAPIEN="" S VIAER="Missing Input parameters" D ERR^VIABMS(VIAER) Q
"RTN","VIABMS1",134,0)
 I VIAPIEN'="" D PATCHK^VIABMS(VIAPIEN) I $D(RESULT) Q
"RTN","VIABMS1",135,0)
 I VIAIENS'="" S VIAFLAGS="IE" D GDIQ^VIABMS Q
"RTN","VIABMS1",136,0)
 S VIAFIELDS="@;"_VIAFIELDS,VIAFLAGS="IP",VIASCRN="S X=$G(^(0)) I $P(X,U)=VIAMDT,$P(X,U,2)=VIAMTYP,$P(X,U,3)=VIAPIEN"
"RTN","VIABMS1",137,0)
 D LDIC^VIABMS
"RTN","VIABMS1",138,0)
 Q
"RTN","VIABMS1",139,0)
 ;
"RTN","VIABMS1",140,0)
LPATMVT ; Returns a list of patient movement records from the PATIENT MOVEMENT file #405;ICR-1865
"RTN","VIABMS1",141,0)
 ;Input - VIA("PATH")="LISTPATIENTMOVEMENT" [required]
"RTN","VIABMS1",142,0)
 ;        VIA("PATIEN")=Patient IEN [required, if no date range]
"RTN","VIABMS1",143,0)
 ;        VIA("SDATE")=Start Date for search [optional]
"RTN","VIABMS1",144,0)
 ;        VIA("EDATE")=End Date for search [optional]
"RTN","VIABMS1",145,0)
 ;        VIA("MAX")=n [optional]
"RTN","VIABMS1",146,0)
 ;Data returned
"RTN","VIABMS1",147,0)
 ;    .01 MovementDate,101 EnteredDate,100 Entered By,.02 TransactionTypeId,.03 PatientIen,
"RTN","VIABMS1",148,0)
 ;    .04 TypeOfMovementIen,.06 WardLocationId,.07 RoomBedId,.14 CurrentAdmissionIen
"RTN","VIABMS1",149,0)
 N VIAFILE,VIAFIELDS,VIAFLAGS,VIASCRN
"RTN","VIABMS1",150,0)
 S VIAFILE=405,VIAFIELDS="@;.01;101;100;.02;.03;.04;.06;.07;.14",VIAFLAGS="IP"
"RTN","VIABMS1",151,0)
 I VIAPIEN="",VIASDT="",VIAEDT="" S VIAER="Missing Input Parameters" D ERR^VIABMS(VIAER) Q
"RTN","VIABMS1",152,0)
 I VIAPIEN'="" D PATCHK^VIABMS(VIAPIEN) I $D(RESULT) Q
"RTN","VIABMS1",153,0)
 I (VIASDT'="")!(VIAEDT'="") D DTCHK^VIABMS(.RESULT,.VIASDT,.VIAEDT) I $D(RESULT) Q 
"RTN","VIABMS1",154,0)
 S VIASCRN=$S((VIAPIEN'="")&(VIASDT'=""):"I $P($G(^DGPM(Y,0)),U,3)=VIAPIEN S X=$P($G(^DGPM(Y,""USR"")),U,2) I X>VIASDT,X<VIAEDT",VIASDT'="":"S X=$P($G(^(""USR"")),U,2) I X>VIASDT,X<VIAEDT",1:"I $P($G(^DGPM(Y,0)),U,3)=VIAPIEN")
"RTN","VIABMS1",155,0)
 D LDIC^VIABMS
"RTN","VIABMS1",156,0)
 Q
"RTN","VIABMS1",157,0)
 ;
"RTN","VIABMS1",158,0)
APATMVT ; Returns patient movement record by admission IEN from the PATIENT MOVEMENT file #405;ICR-1865
"RTN","VIABMS1",159,0)
 ;Input - VIA("PATH")="LISTPATIENTMOVEMENTSBYADMISSION" [required]
"RTN","VIABMS1",160,0)
 ;        VIA("PATIEN")=Patient IEN [required]
"RTN","VIABMS1",161,0)
 ;Data returned
"RTN","VIABMS1",162,0)
 ;    .01 MovementDate,101 EnteredDate,100 Entered By,.02 TransactionTypeId,.03 PatientIen,
"RTN","VIABMS1",163,0)
 ;    .04 TypeOfMovementIen,.06 WardLocationId,.07 RoomBedId,.14 CurrentAdmissionIen
"RTN","VIABMS1",164,0)
 N VIAFILE,VIAFIELDS,VIAFLAGS,VIASCRN
"RTN","VIABMS1",165,0)
 S VIAFILE=405,VIAFIELDS="@;.01;101;100;.02;.03;.04;.06;.07;.14",VIAFLAGS="IP"
"RTN","VIABMS1",166,0)
 I VIAPIEN="" S VIAER="Missing ADMISSION IEN" D ERR^VIABMS(VIAER) Q
"RTN","VIABMS1",167,0)
 S VIASCRN="I $P($G(^(0)),U,14)=VIAPIEN",VIAXREF="CA"
"RTN","VIABMS1",168,0)
 D LDIC^VIABMS
"RTN","VIABMS1",169,0)
 Q
"RTN","VIABMS1",170,0)
 ;
"RTN","VIABMS1",171,0)
SCHADM ; Returns a list of scheduled admissions from the SCHEDULED ADMISSION file #41.1;ICR-6611
"RTN","VIABMS1",172,0)
 ;Input - VIA("PATH")="LISTSCHEDULEDADMISSION" [required]
"RTN","VIABMS1",173,0)
 ;        VIA("PATIEN")=Patient IEN [required, optional if no date parameter]
"RTN","VIABMS1",174,0)
 ;        VIA("SDATE")=Start Date for search [optional]
"RTN","VIABMS1",175,0)
 ;        VIA("EDATE")=End Date for search [optional]
"RTN","VIABMS1",176,0)
 ;        VIA("MAX")=n [optional]
"RTN","VIABMS1",177,0)
 ;Data returned
"RTN","VIABMS1",178,0)
 ;    .01 PatientId,2 ReservationDateTime,3 LengthOfStayExpected,4 AdmittingDiagnosis,6 Surgery,8 WardLocation,
"RTN","VIABMS1",179,0)
 ;    9 TreatingSpecialty,12 MedicalCenterDivision,13 DateTimeCancelled,14 CancelledBy,5 Provider,11 Scheduler
"RTN","VIABMS1",180,0)
 N VIAFILE,VIAFIELDS,VIAFLAGS,VIASCRN
"RTN","VIABMS1",181,0)
 S VIAFILE=41.1,VIAFIELDS="@;.01;2;3;4;6;8;9;12;13;14;5;11",VIAFLAGS="IP"
"RTN","VIABMS1",182,0)
 I VIAPIEN'="" D PATCHK^VIABMS(VIAPIEN) I $D(RESULT) Q
"RTN","VIABMS1",183,0)
 I VIAPIEN'="" S VIASCRN="S X=$G(^DGS(41.1,Y,0)) I $P(X,U)=VIAPIEN"
"RTN","VIABMS1",184,0)
 I (VIASDT'="")!(VIAEDT'="") D DTCHK^VIABMS(.RESULT,.VIASDT,.VIAEDT) I $D(RESULT) Q 
"RTN","VIABMS1",185,0)
 S VIASCRN=$S(($G(VIASCRN)'="")&(VIASDT'=""):VIASCRN_",$P(X,U,2)>VIASDT,$P(X,U,2)<VIAEDT",VIASDT'="":"S X=$P($G(^DGS(41.1,Y,0)),U,2) I X>VIASDT,X<VIAEDT",1:$G(VIASCRN))
"RTN","VIABMS1",186,0)
 D LDIC^VIABMS
"RTN","VIABMS1",187,0)
 Q
"RTN","VIABMS1",188,0)
 ;
"RTN","VIABMS1",189,0)
RMBED ; Returns a list of room/beds from the ROOM-BED file #405.4;ICR-1380
"RTN","VIABMS1",190,0)
 ;Input - VIA("PATH")="LISTROOMBED" [required]
"RTN","VIABMS1",191,0)
 ;        VIA("IENS")="Room Bed IEN" [required, optional if no other parameter] 
"RTN","VIABMS1",192,0)
 ;        VIA("MAX")=n [optional]
"RTN","VIABMS1",193,0)
 ;        VIA("FROM")=string/value to start list [optional]
"RTN","VIABMS1",194,0)
 ;Data returned
"RTN","VIABMS1",195,0)
 ;    .01  Name,.2 CurrentlyOutOfService,100 WardsWhichCanAssign
"RTN","VIABMS1",196,0)
 N VIAFILE,VIAFIELDS,VIAFLAGS,TVIAIENS
"RTN","VIABMS1",197,0)
 S VIAFILE=405.4,VIAFIELDS="@;.01;.2",VIAFLAGS="IP"
"RTN","VIABMS1",198,0)
 I VIAIENS'="" S TVIAIENS=VIAIENS S VIAIENS="",VIAMAX=""
"RTN","VIABMS1",199,0)
 S VIAID="S X="""" I $D(^DG(405.4,Y,""W"",0)) S VIAA="""" F  S VIAA=$O(^DG(405.4,Y,""W"",VIAA)) S:VIAA>0 X=X_$S(X="""":"""",1:"","")_VIAA I VIAA="""" D EN^DDIOL(X) Q"
"RTN","VIABMS1",200,0)
 D LDIC^VIABMS
"RTN","VIABMS1",201,0)
 I $G(TVIAIENS)'="" S VIAIENS=TVIAIENS D PIENS
"RTN","VIABMS1",202,0)
 Q
"RTN","VIABMS1",203,0)
 ;
"RTN","VIABMS1",204,0)
CLNAPPT ; Returns a list of clinic appointments from the HOSPITAL LOCATION sub-file #44.001;ICR-#4433
"RTN","VIABMS1",205,0)
 ;Input - VIA("PATH")="LISTCLINICAPPOINTMENTS" [required]
"RTN","VIABMS1",206,0)
 ;        VIA("IENS")=Client IEN [required]
"RTN","VIABMS1",207,0)
 ;        VIA("SDATE")=Start Date for search [optional]
"RTN","VIABMS1",208,0)
 ;        VIA("EDATE")=End Date for search [optional]
"RTN","VIABMS1",209,0)
 ;        VIA("MAX")=n [optional]
"RTN","VIABMS1",210,0)
 ;Data returned
"RTN","VIABMS1",211,0)
 ;    .01 Appointment Date/Time, 2 Patients
"RTN","VIABMS1",212,0)
 N VIARRAY,VIARY,CNT,VIARRY,VIACNT,VIADT,VIADFN,VIAPPT,I,Y,J,FL,CLNIEN,MORE,TARRAY
"RTN","VIABMS1",213,0)
 I VIAIENS="" S VIAER="Missing CLINIC IEN" D ERR^VIABMS(VIAER) Q
"RTN","VIABMS1",214,0)
 I (VIASDT'="")!(VIAEDT'="") D DTCHK^VIABMS(.RESULT,.VIASDT,.VIAEDT) I $D(RESULT) Q
"RTN","VIABMS1",215,0)
 S CLNIEN=$TR(VIAIENS,","),VIAEDT=$S(VIAEDT="":DT,1:VIAEDT)
"RTN","VIABMS1",216,0)
 S RESULT(1)="[Data]",CNT=1,FL=0,MORE=""
"RTN","VIABMS1",217,0)
 S VIARRAY(1)=$P(VIASDT,".")_";"_$P(VIAEDT,".")
"RTN","VIABMS1",218,0)
 S VIARRAY(2)=CLNIEN
"RTN","VIABMS1",219,0)
 S VIARRAY("FLDS")="1;4"
"RTN","VIABMS1",220,0)
 S VIACNT=$$SDAPI^SDAMA301(.VIARRAY)
"RTN","VIABMS1",221,0)
 I VIACNT<1 G CLAPX Q
"RTN","VIABMS1",222,0)
 S VIADFN=0 F  S VIADFN=$O(^TMP($J,"SDAMA301",CLNIEN,VIADFN)) Q:'VIADFN  D
"RTN","VIABMS1",223,0)
 . S VIADT=0
"RTN","VIABMS1",224,0)
 . F  S VIADT=$O(^TMP($J,"SDAMA301",CLNIEN,VIADFN,VIADT)) Q:'VIADT  D
"RTN","VIABMS1",225,0)
 . . S VIAPPT=$G(^TMP($J,"SDAMA301",CLNIEN,VIADFN,VIADT)) ;appointment data
"RTN","VIABMS1",226,0)
 . . I (VIADT<VIASDT)!(VIADT>VIAEDT) Q
"RTN","VIABMS1",227,0)
 . . S VIARY(VIADT,VIADFN)=VIAPPT
"RTN","VIABMS1",228,0)
 S VIADT=$S(VIAFROM'="":VIAFROM,1:0)
"RTN","VIABMS1",229,0)
 F  S VIADT=$O(VIARY(VIADT)) Q:'VIADT  S CNT=CNT+1,RESULT(CNT)=VIADT D  I CNT>VIAMAX S MORE="MORE^"_VIADT,FL=1 Q
"RTN","VIABMS1",230,0)
 . S (VIADFN,I)=0 F  S VIADFN=$O(VIARY(VIADT,VIADFN)) Q:'VIADFN  D
"RTN","VIABMS1",231,0)
 . . S RESULT(CNT)=RESULT(CNT)_$S('I:"^"_$P(VIARY(VIADT,VIADFN),"^")_"^",1:"")_$S('I:"",1:"~")_VIADFN,I=1
"RTN","VIABMS1",232,0)
 I FL D  ; re-structure results array
"RTN","VIABMS1",233,0)
 . M TARRAY=RESULT
"RTN","VIABMS1",234,0)
 . K RESULT
"RTN","VIABMS1",235,0)
 . S CNT=4,I=0,RESULT(1)="[Misc]",RESULT(2)=MORE,RESULT(3)="[Data]"
"RTN","VIABMS1",236,0)
 . F  S I=$O(TARRAY(I)) Q:'I  D
"RTN","VIABMS1",237,0)
 . . I TARRAY(I)["Data" Q
"RTN","VIABMS1",238,0)
 . . S CNT=CNT+1,RESULT(CNT)=TARRAY(I)
"RTN","VIABMS1",239,0)
CLAPX K ^TMP($J,"SDAMA301")
"RTN","VIABMS1",240,0)
 Q
"RTN","VIABMS1",241,0)
 ;
"RTN","VIABMS1",242,0)
LSTORD ; Returns a list of orders from the ORDER file #100;ICR-6475
"RTN","VIABMS1",243,0)
 ;Input - VIA("PATH")="LISTORDERS" [required]
"RTN","VIABMS1",244,0)
 ;        VIA("ORDIEN")=list of orderable IEN separated by a comma (,") [required]. For example, VIA("ORDIEN")="73,75,76,360,740"
"RTN","VIABMS1",245,0)
 ;        VIA("SDATE")=Start Date for search [optional]. Defaults to today's date, if no date is passed in
"RTN","VIABMS1",246,0)
 ;        VIA("EDATE")=End Date for search [optional]. Defaults to today's date, if no date is passed in
"RTN","VIABMS1",247,0)
 ;        VIA("PATIEN")=Patient IEN; multiple IENS separated by a comma [optional]
"RTN","VIABMS1",248,0)
 ;        VIA("VALUE")=1 or 2 required]. 1 to filter by orderable item(s), 2 to filter by orderable action 
"RTN","VIABMS1",249,0)
 ;        VIA("FROM")=string/value to start list [optional]
"RTN","VIABMS1",250,0)
 ;        VIA("MAX")=n [optional]
"RTN","VIABMS1",251,0)
 ;Data returned
"RTN","VIABMS1",252,0)
 ;    .01 Order #, 5 Status, .02  Object of Order, 6 Patient Location
"RTN","VIABMS1",253,0)
 N VIAOI,VIACNT,OITM,I,X,Y,Z
"RTN","VIABMS1",254,0)
 S:VIASDT="" VIASDT=DT S:VIAEDT="" VIAEDT=DT
"RTN","VIABMS1",255,0)
 D DTCHK^VIABMS(.RESULT,.VIASDT,.VIAEDT) I $D(RESULT) Q
"RTN","VIABMS1",256,0)
 I $G(VIAOIEN)'="" F I=1:1:$L(VIAOIEN,",") S OITM=$P(VIAOIEN,",",I) I OITM'="" S VIAOI(OITM)=""
"RTN","VIABMS1",257,0)
 I $G(VIAPIEN)'="" F I=1:1:$L(VIAPIEN,",") S OITM=$P(VIAPIEN,",",I) I OITM'="" S VIAPIEN(OITM)=""
"RTN","VIABMS1",258,0)
 I VIAVAL=1,$O(VIAOI(""))="" S VIAER="Missing Orderable Items IEN" D ERR^VIABMS(VIAER) Q 
"RTN","VIABMS1",259,0)
 S RESULT(1)="[Data]",VIACNT=2,X=$S($P(VIAFROM,",")'="":$P(VIAFROM,","),1:VIASDT)
"RTN","VIABMS1",260,0)
 F  S X=$O(^OR(100,"AF",X)) Q:'X  Q:X>VIAEDT  I X>=VIASDT,X<VIAEDT D  I VIACNT>VIAMAX Q
"RTN","VIABMS1",261,0)
 . S Y=$S($P(VIAFROM,",",2)'="":$P(VIAFROM,",",2),1:0),$P(VIAFROM,",",2)=""
"RTN","VIABMS1",262,0)
 . F  S Y=$O(^OR(100,"AF",X,Y)) Q:'Y  D  I VIACNT>VIAMAX  S RESULT(VIACNT)="[Misc]",VIACNT=VIACNT+1,RESULT(VIACNT)="MORE"_U_X_","_Y Q
"RTN","VIABMS1",263,0)
 . . I VIAVAL=1 S Z=$$ORDACT1^VIABMS1()
"RTN","VIABMS1",264,0)
 . . I VIAVAL=2 S Z=$$ORDACT2^VIABMS1()
"RTN","VIABMS1",265,0)
 Q
"RTN","VIABMS1",266,0)
 ;
"RTN","VIABMS1",267,0)
ORDACT ; Returns a list of order actions from the ORDER file #100.008
"RTN","VIABMS1",268,0)
 ;Input - VIA("PATH")="LISTORDERACTIONS" [required]
"RTN","VIABMS1",269,0)
 ;        VIA("ORDIEN")=list of orderable IEN separated by a comma (,") [required],if VIA("VALUE")=1
"RTN","VIABMS1",270,0)
 ;        VIA("SDATE")=Start Date for search [optional]. Defaults to today's date, if no date is passed in
"RTN","VIABMS1",271,0)
 ;        VIA("EDATE")=End Date for search [optional]. Defaults to today's date, if no date is passed in
"RTN","VIABMS1",272,0)
 ;        VIA("IENS")=Order IEN [required]
"RTN","VIABMS1",273,0)
 ;        VIA("VALUE")=1 or 2 required]. 1 to filter by orderable item(s), 2 to filter by orderable action 
"RTN","VIABMS1",274,0)
 ;Data returned
"RTN","VIABMS1",275,0)
 ;    .01 Date/Time Ordered,6 Date/Time Signed,16 Release Date/Time,5 Signed By,3 Provider,.1 Order Text
"RTN","VIABMS1",276,0)
 N VIAFILE,VIAFIELDS,VIAFLAGS,OITM,I,TRESULT,I,X,N,IEN,VIATIEN
"RTN","VIABMS1",277,0)
 S VIAFILE=100.008,VIAFIELDS="@;.01;6;16;5;3",VIAFLAGS="IP"
"RTN","VIABMS1",278,0)
 S:VIASDT="" VIASDT=DT S:VIAEDT="" VIAEDT=DT
"RTN","VIABMS1",279,0)
 D DTCHK^VIABMS(.RESULT,.VIASDT,.VIAEDT) I $D(RESULT) Q
"RTN","VIABMS1",280,0)
 I $G(VIAOIEN)'="" F I=1:1:$L(VIAOIEN,",") S OITM=$P(VIAOIEN,",",I) I OITM'="" S VIAOI(OITM)=""
"RTN","VIABMS1",281,0)
 I VIAVAL=1,$O(VIAOI(""))="" S VIAER="Missing Orderable Items IEN" D ERR^VIABMS(VIAER) Q
"RTN","VIABMS1",282,0)
 S VIAID="I $D(^OR(100,DA(1),8,Y,.1)) S I=0 F  S I=$O(^OR(100,DA(1),8,Y,.1,I)) Q:'I  S J=$P(^(I,0),U) D EN^DDIOL(J)"
"RTN","VIABMS1",283,0)
 I VIAVAL=1 D
"RTN","VIABMS1",284,0)
 . S VIASCRN="S VIAX=0 F  S VIAX=$O(^OR(100,Y(1),.1,VIAX)) Q:'VIAX  I VIAX>0 S VIAV=$P(^OR(100,Y(1),.1,VIAX,0),U,1) I $D(VIAOI(VIAV)) Q"
"RTN","VIABMS1",285,0)
 I VIAVAL=2 D
"RTN","VIABMS1",286,0)
 . S VIASCRN="S VIAA=Y(1),(VIAB,VIAC,VIAD,VIAX)=0 F  S VIAX=$O(^OR(100,VIAA,8,Y,.1,VIAX)) Q:'VIAX  I VIAX>0 S VIAR=$$UP^XLFSTR(^OR(100,VIAA,8,Y,.1,VIAX,0)) "
"RTN","VIABMS1",287,0)
 . S VIASCRN=VIASCRN_"S VIAB=VIAB!(VIAR[""ANTICIPATE""),VIAC=VIAC!(VIAR[""PLANNED""),VIAD=VIAD!(VIAR[""DISCHARGE"") I VIAB!VIAC&VIAD Q"
"RTN","VIABMS1",288,0)
 ; multiple IENs
"RTN","VIABMS1",289,0)
 S VIATIEN=VIAIENS,N=0
"RTN","VIABMS1",290,0)
 F I=1:1:$L(VIATIEN,",") S IEN=$P(VIATIEN,",",I) I IEN'="" D
"RTN","VIABMS1",291,0)
 . S VIAIENS=","_IEN_","
"RTN","VIABMS1",292,0)
 . K RESULT
"RTN","VIABMS1",293,0)
 . D LDIC^VIABMS
"RTN","VIABMS1",294,0)
 . S X=0 F  S X=$O(RESULT(X)) Q:'X   S:RESULT(X)["[Data]" RESULT(X)=RESULT(X)_" - "_IEN S N=N+1,TRESULT(N)=RESULT(X)
"RTN","VIABMS1",295,0)
 . K RESULT
"RTN","VIABMS1",296,0)
 M RESULT=TRESULT
"RTN","VIABMS1",297,0)
 Q
"RTN","VIABMS1",298,0)
ORDACT1() ; filters by status, date and orderable items
"RTN","VIABMS1",299,0)
 N FND,VIA3,VIAV,VIAA,VIA8,VIA0,VIAPT
"RTN","VIABMS1",300,0)
 S FND=0
"RTN","VIABMS1",301,0)
 I '$D(^OR(100,Y,.1,0)) Q FND
"RTN","VIABMS1",302,0)
 S VIA0=$G(^OR(100,Y,0)),VIA3=$G(^OR(100,Y,3)),VIAPT=$P(VIA0,U,2)
"RTN","VIABMS1",303,0)
 I $P(VIA3,U,3)'=6 Q FND
"RTN","VIABMS1",304,0)
 I VIAPIEN'="",(VIAPT'["DPT")!('$D(VIAPIEN(+VIAPT))) Q FND
"RTN","VIABMS1",305,0)
 S VIAA=$P(VIA3,U,7),VIAV=$P(VIA3,U)
"RTN","VIABMS1",306,0)
 I VIAA>0,VIAV>=VIASDT,VIAV<VIAEDT S VIA8=$P(^OR(100,Y,8,VIAA,0),U) I VIA8>=VIASDT,VIA8<VIAEDT S VIAX=0 D  Q FND
"RTN","VIABMS1",307,0)
 . F  S VIAX=$O(^OR(100,Y,.1,VIAX)) Q:'VIAX  I VIAX>0 S VIAV=$P(^OR(100,Y,.1,VIAX,0),U,1) I $D(VIAOI(VIAV)) D  Q
"RTN","VIABMS1",308,0)
 . . S FND=1,RESULT(VIACNT)=Y_U_VIA8_U_$P(VIA3,U,3)_U_$P(VIA0,U,2)_U_$P(VIA0,U,10),VIACNT=VIACNT+1
"RTN","VIABMS1",309,0)
 Q FND
"RTN","VIABMS1",310,0)
 ;
"RTN","VIABMS1",311,0)
ORDACT2() ; filters by status, date and orderable actions
"RTN","VIABMS1",312,0)
 N FND,VIA0,VIAA,VIAB,VIAC,VIAD,VIA3,VIAV,VIA8
"RTN","VIABMS1",313,0)
 S FND=0
"RTN","VIABMS1",314,0)
 S VIA0=$G(^OR(100,Y,0))
"RTN","VIABMS1",315,0)
 I $P(^OR(100,Y,3),U,3)'=6 Q FND
"RTN","VIABMS1",316,0)
 S (VIAA,VIAB,VIAC,VIAD)=0
"RTN","VIABMS1",317,0)
 S VIA0=$G(^OR(100,Y,0)),VIA3=$G(^OR(100,Y,3))
"RTN","VIABMS1",318,0)
 I $D(^OR(100,Y,8)) F  S VIAA=$O(^OR(100,Y,8,VIAA)) Q:'VIAA  S VIA8=$P(^OR(100,Y,8,VIAA,0),U,1) I VIA8>=VIASDT,VIA8<VIAEDT,$D(^OR(100,Y,8,VIAA,.1)) S VIAX=0 D  I FND Q
"RTN","VIABMS1",319,0)
 . F  S VIAX=$O(^OR(100,Y,8,VIAA,.1,VIAX)) Q:'VIAX  S VIAR=$G(^OR(100,Y,8,VIAA,.1,VIAX,0)),VIAR=$$UP^XLFSTR(VIAR) S VIAB=VIAB!(VIAR["ANTICIPATE"),VIAC=VIAC!(VIAR["PLANNED"),VIAD=VIAD!(VIAR["DISCHARGE") I VIAB!VIAC&VIAD D  Q
"RTN","VIABMS1",320,0)
 . . S FND=1,RESULT(VIACNT)=Y_U_VIA8_U_$P(VIA3,U,3)_U_$P(VIA0,U,2)_U_$P(VIA0,U,10),VIACNT=VIACNT+1
"RTN","VIABMS1",321,0)
 Q FND
"RTN","VIABMS1",322,0)
 ;
"RTN","VIABRPC")
0^1^B22947290^B2945933
"RTN","VIABRPC",1,0)
VIABRPC ;AAC/JMC - VIA RPCs ;04/05/2016
"RTN","VIABRPC",2,0)
 ;;1.0;VISTA INTEGRATION ADAPTER;**7,8**;06-FEB-2014;Build 8
"RTN","VIABRPC",3,0)
 ; ICR 10090    INSTITUTION FILE (Supported)
"RTN","VIABRPC",4,0)
 ; ICR 3213     XQALSURO (Supported)
"RTN","VIABRPC",5,0)
 ; ICR 2533     DBIA2533 (Controlled)
"RTN","VIABRPC",6,0)
 ; ICR 10061    VADPT (Supported)
"RTN","VIABRPC",7,0)
 ; ICR 4807     API FOR RATED DISABILITIES [D ELIG^VADPT] (Supported)
"RTN","VIABRPC",8,0)
 ; ICR 3119     Consult Default Reason for Request [GETDEF^GMRCDRFR & $$REAF^GMRCDRFR]
"RTN","VIABRPC",9,0)
 ; ICR 2968     Direct access to file 34
"RTN","VIABRPC",10,0)
 ; ICR 2664     OBSERVATION API [$$PT^DGPMOBS] (Supported)
"RTN","VIABRPC",11,0)
 ; ICR 1995     CPT Code APIs [CODM^ICPTCOD] (Supported)
"RTN","VIABRPC",12,0)
 ; ICR 3459     PSB MEDICATION HISTORY REPORT [HISTORY^PSBMLHS] (supported)
"RTN","VIABRPC",13,0)
 ; ICR 1365     DBIA1365 [DSELECT^GMPLENFM] (controlled)
"RTN","VIABRPC",14,0)
 ; ICR 4075     OR CALL TO TIUSRVP [VSTRBLD^TIUSRVP] (private)
"RTN","VIABRPC",15,0)
 ;
"RTN","VIABRPC",16,0)
GETSURR(RESULT,USER) ; surrogate info.
"RTN","VIABRPC",17,0)
 ;RPC VIAB GETSURR
"RTN","VIABRPC",18,0)
 ; get user's surrogate info
"RTN","VIABRPC",19,0)
 I $G(USER)="" S RESULT="" Q
"RTN","VIABRPC",20,0)
 S RESULT=$$GETSURO^XQALSURO(USER) ;ICR(DBIA) #3213 
"RTN","VIABRPC",21,0)
 I +RESULT<1 S RESULT=""
"RTN","VIABRPC",22,0)
 Q
"RTN","VIABRPC",23,0)
SNAME(RET,SID) ; get station/site name
"RTN","VIABRPC",24,0)
 ;RPC VIAB SITENAME
"RTN","VIABRPC",25,0)
 N SIEN
"RTN","VIABRPC",26,0)
 I $G(SID)="" S RET="-1^Missing Station Number or Site ID" Q
"RTN","VIABRPC",27,0)
 S SIEN=$O(^DIC(4,"D",SID,0)) I 'SIEN S RET="-1^No site found for this Station Number or Site ID" Q
"RTN","VIABRPC",28,0)
 ; ICR(DBIA) #10090 (SUPPORTED)
"RTN","VIABRPC",29,0)
 S RET=$$GET1^DIQ(4,SIEN,.01,"E")
"RTN","VIABRPC",30,0)
 Q
"RTN","VIABRPC",31,0)
USERDIV(RESULT,VIADUZ) ; station IEN^station number^station name^default division
"RTN","VIABRPC",32,0)
 ;RPC GET USER DIVISIONS
"RTN","VIABRPC",33,0)
 K RESULT
"RTN","VIABRPC",34,0)
 N VIADX,VIADR,VIADC
"RTN","VIABRPC",35,0)
 S VIADC=0
"RTN","VIABRPC",36,0)
 D DIV4^XUSER(.VIADR,VIADUZ)
"RTN","VIABRPC",37,0)
 S VIADX=0
"RTN","VIABRPC",38,0)
 F  S VIADX=$O(VIADR(VIADX)) Q:'VIADX!($D(RESULT(1)))  D
"RTN","VIABRPC",39,0)
 .I VIADR(VIADX)=1 S VIADC=VIADC+1,RESULT(VIADC)=VIADX_"^"_$$GET1^DIQ(4,+VIADX,99)_"^"_$$GET1^DIQ(4,+VIADX,.01,)_"^1" K VIADR(VIADX)
"RTN","VIABRPC",40,0)
 S VIADX=0
"RTN","VIABRPC",41,0)
 F  S VIADX=$O(VIADR(VIADX)) Q:'VIADX  D
"RTN","VIABRPC",42,0)
 .S VIADC=VIADC+1
"RTN","VIABRPC",43,0)
 .S RESULT(VIADC)=VIADX_"^"_$$GET1^DIQ(4,+VIADX,99)_"^"_$$GET1^DIQ(4,+VIADX,.01)_"^0"
"RTN","VIABRPC",44,0)
 Q
"RTN","VIABRPC",45,0)
 ;
"RTN","VIABRPC",46,0)
DEFRFREQ(RESULT,VIAIEN,VIADFN,RESOLVE) ;Return default reason for request for service - ICR #3119
"RTN","VIABRPC",47,0)
 ;RPC VIAB DEFAULT REQUEST REASON
"RTN","VIABRPC",48,0)
 ; VIAIEN=pointer to file 123.5
"RTN","VIABRPC",49,0)
 ; VIADFN=patient, if RESOLVE=1
"RTN","VIABRPC",50,0)
 ; RESOLVE=1 to resolve boilerplate, 0 to not resolve
"RTN","VIABRPC",51,0)
 Q:+$G(VIAIEN)=0
"RTN","VIABRPC",52,0)
 I +RESOLVE,(+$G(VIADFN)=0) Q
"RTN","VIABRPC",53,0)
 S RESULT=$NA(^TMP("VIABREQ",$J))
"RTN","VIABRPC",54,0)
 S:$G(RESOLVE)="" RESOLVE=0
"RTN","VIABRPC",55,0)
 D GETDEF^GMRCDRFR(.RESULT,VIAIEN,VIADFN,RESOLVE)
"RTN","VIABRPC",56,0)
 K @RESULT@(0)
"RTN","VIABRPC",57,0)
 Q
"RTN","VIABRPC",58,0)
 ;
"RTN","VIABRPC",59,0)
EDITDRFR(RESULT,VIAIEN) ; Allow editing of reason for request? - ICR #3119
"RTN","VIABRPC",60,0)
 ;RPC VIAB EDIT DEFAULT REASON
"RTN","VIABRPC",61,0)
 S RESULT=$$REAF^GMRCDRFR(VIAIEN)
"RTN","VIABRPC",62,0)
 Q
"RTN","VIABRPC",63,0)
 ;
"RTN","VIABRPC",64,0)
RADSRC(RESULT,SRCTYPE) ; return list of available contract/sharing/research sources - ICR #2968
"RTN","VIABRPC",65,0)
 ;RPC VIAB RADSRC
"RTN","VIABRPC",66,0)
 N VIAX
"RTN","VIABRPC",67,0)
 S VIAX=0
"RTN","VIABRPC",68,0)
 F I=1:1 S VIAX=$O(^DIC(34,VIAX)) Q:+VIAX=0  D
"RTN","VIABRPC",69,0)
 . Q:($P(^DIC(34,VIAX,0),U,2)'=SRCTYPE)
"RTN","VIABRPC",70,0)
 . I $D(^DIC(34,VIAX,"I")),(^DIC(34,VIAX,"I")<$$NOW^XLFDT) Q
"RTN","VIABRPC",71,0)
 . S RESULT(I)=VIAX_U_$P(^DIC(34,VIAX,0),U,1)
"RTN","VIABRPC",72,0)
 Q
"RTN","VIABRPC",73,0)
 ;
"RTN","VIABRPC",74,0)
CURSPE(RESULT,PTDFN) ; Return current treating specialty - ICR #2664
"RTN","VIABRPC",75,0)
 ;RPC VIAB CURSPE
"RTN","VIABRPC",76,0)
 Q:'PTDFN
"RTN","VIABRPC",77,0)
 N SPEC S SPEC=$$PT^DGPMOBS(PTDFN),RESULT=""
"RTN","VIABRPC",78,0)
 I SPEC'<0 S RESULT=$P(SPEC,U,3)_U_$P(SPEC,U,2)_U_$P(SPEC,U) ;name^ien^obs flag
"RTN","VIABRPC",79,0)
 Q
"RTN","VIABRPC",80,0)
 ;
"RTN","VIABRPC",81,0)
CPTMODS(RESULT,VIACPTCOD,VIADATE) ;Return CPT Modifiers for a CPT Code - ICR #1995
"RTN","VIABRPC",82,0)
 ;RPC VIAB CPTMODS
"RTN","VIABRPC",83,0)
 N VIAM,VIAIDX,VIAI,MODNAME
"RTN","VIABRPC",84,0)
 S:'+$G(VIADATE) VIADATE=DT
"RTN","VIABRPC",85,0)
 I +($$CODM^ICPTCOD(VIACPTCOD,$NA(VIAM),0,VIADATE)),+$D(VIAM) D
"RTN","VIABRPC",86,0)
 . S VIAIDX="",VIAI=0
"RTN","VIABRPC",87,0)
 . F  S VIAIDX=$O(VIAM(VIAIDX)) Q:(VIAIDX="")  D
"RTN","VIABRPC",88,0)
 . . S VIAI=VIAI+1,MODNAME=$P(VIAM(VIAIDX),U,1)
"RTN","VIABRPC",89,0)
 . . S RESULT(MODNAME_VIAI)=$P(VIAM(VIAIDX),U,2)_U_MODNAME_U_VIAIDX
"RTN","VIABRPC",90,0)
 Q
"RTN","VIABRPC",91,0)
 ;
"RTN","VIABRPC",92,0)
ACTPROB(RESULT,DFN,VIADATE) ;get list of patient's active problems - ICR #1365
"RTN","VIABRPC",93,0)
 ;RPC VIAB ACTPROB
"RTN","VIABRPC",94,0)
 N VIAPROB,VIAPROBIX,VIAPRCNT,GMPINDT,VIAIMPDT
"RTN","VIABRPC",95,0)
 K ^TMP("IB",$J,"INTERFACES","GMP SELECT PATIENT ACTIVE PROBLEMS")
"RTN","VIABRPC",96,0)
 S:'+$G(VIADATE) VIADATE=DT
"RTN","VIABRPC",97,0)
 S GMPINDT=VIADATE,VIAIMPDT=$$IMPDATE^LEXU("10D")
"RTN","VIABRPC",98,0)
 D DSELECT^GMPLENFM  ;DBIA 1365
"RTN","VIABRPC",99,0)
 S VIAPRCNT=0
"RTN","VIABRPC",100,0)
 S VIAPROBIX=0
"RTN","VIABRPC",101,0)
 F  S VIAPROBIX=$O(^TMP("IB",$J,"INTERFACES","GMP SELECT PATIENT ACTIVE PROBLEMS",VIAPROBIX)) Q:'VIAPROBIX  D  ;DBIA 1365
"RTN","VIABRPC",102,0)
 . I (VIADATE<VIAIMPDT)&($P(^TMP("IB",$J,"INTERFACES","GMP SELECT PATIENT ACTIVE PROBLEMS",VIAPROBIX),"^",14)="10D") K ^TMP("IB",$J,"INTERFACES","GMP SELECT PATIENT ACTIVE PROBLEMS",VIAPROBIX) Q
"RTN","VIABRPC",103,0)
 . S VIAPROB=$P(^TMP("IB",$J,"INTERFACES","GMP SELECT PATIENT ACTIVE PROBLEMS",VIAPROBIX),"^",2,3)
"RTN","VIABRPC",104,0)
 . I $L(VIAPROB)>255 S $P(VIAPROB,U)=$E($P(VIAPROB,U),1,245)
"RTN","VIABRPC",105,0)
 . I $E(VIAPROB,1)="$" S VIAPROB=$E(VIAPROB,2,255)
"RTN","VIABRPC",106,0)
 . I '$D(VIAPROB(VIAPROB)) D
"RTN","VIABRPC",107,0)
 .. S VIAPROB(VIAPROB)=""
"RTN","VIABRPC",108,0)
 .. S VIAPRCNT=VIAPRCNT+1
"RTN","VIABRPC",109,0)
 .. S $P(^TMP("IB",$J,"INTERFACES","GMP SELECT PATIENT ACTIVE PROBLEMS",VIAPROBIX),"^",2,3)=VIAPROB
"RTN","VIABRPC",110,0)
 . E  K ^TMP("IB",$J,"INTERFACES","GMP SELECT PATIENT ACTIVE PROBLEMS",VIAPROBIX)
"RTN","VIABRPC",111,0)
 S ^TMP("IB",$J,"INTERFACES","GMP SELECT PATIENT ACTIVE PROBLEMS",0)=VIAPRCNT
"RTN","VIABRPC",112,0)
 S RESULT=$NA(^TMP("IB",$J,"INTERFACES","GMP SELECT PATIENT ACTIVE PROBLEMS"))
"RTN","VIABRPC",113,0)
 Q
"RTN","VIABRPC",114,0)
 ;
"RTN","VIABRPC",115,0)
NOTEVSTR(RESULT,IEN) ; return the VSTR^AUTHOR for a note -; ICR#4075
"RTN","VIABRPC",116,0)
 ;RPC VIAB NOTEVSTR
"RTN","VIABRPC",117,0)
 N X0,X12,VISIT
"RTN","VIABRPC",118,0)
 S X0=$G(^TIU(8925,+IEN,0)),X12=$G(^(12)),VISIT=$P(X12,U,7)
"RTN","VIABRPC",119,0)
 I +VISIT S RESULT=$$VSTRBLD^TIUSRVP(VISIT) I 1
"RTN","VIABRPC",120,0)
 E  S RESULT=$P(X12,U,11)_";"_$P(X0,U,7)_";"_$P(X0,U,13)
"RTN","VIABRPC",121,0)
 Q
"RTN","VIABRPC",122,0)
 ;
"VER")
8.0^22.0
"BLD",10008,6)
^8
**END**
**END**

