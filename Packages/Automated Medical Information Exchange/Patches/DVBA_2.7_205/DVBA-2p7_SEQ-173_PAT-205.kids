Released DVBA*2.7*205 SEQ #173
Extracted from mail message
**KIDS**:DVBA*2.7*205^

**INSTALL NAME**
DVBA*2.7*205
"BLD",10999,0)
DVBA*2.7*205^AUTOMATED MED INFO EXCHANGE^0^3180227^y
"BLD",10999,1,0)
^^2^2^3180227^
"BLD",10999,1,1,0)
With the replacement of Vista Web in CAPRI with Joint Legacy Viewer (JLV)
"BLD",10999,1,2,0)
the new JLV URL's need to be updated and accessible in Vista.
"BLD",10999,4,0)
^9.64PA^^
"BLD",10999,6.3)
1
"BLD",10999,"INIT")
POST^DVBA205P
"BLD",10999,"KRN",0)
^9.67PA^779.2^20
"BLD",10999,"KRN",.4,0)
.4
"BLD",10999,"KRN",.401,0)
.401
"BLD",10999,"KRN",.402,0)
.402
"BLD",10999,"KRN",.403,0)
.403
"BLD",10999,"KRN",.5,0)
.5
"BLD",10999,"KRN",.84,0)
.84
"BLD",10999,"KRN",3.6,0)
3.6
"BLD",10999,"KRN",3.8,0)
3.8
"BLD",10999,"KRN",9.2,0)
9.2
"BLD",10999,"KRN",9.8,0)
9.8
"BLD",10999,"KRN",9.8,"NM",0)
^9.68A^2^2
"BLD",10999,"KRN",9.8,"NM",1,0)
DVBABURL^^0^B8885291
"BLD",10999,"KRN",9.8,"NM",2,0)
DVBA205P^^0^B1630052
"BLD",10999,"KRN",9.8,"NM","B","DVBA205P",2)

"BLD",10999,"KRN",9.8,"NM","B","DVBABURL",1)

"BLD",10999,"KRN",19,0)
19
"BLD",10999,"KRN",19.1,0)
19.1
"BLD",10999,"KRN",101,0)
101
"BLD",10999,"KRN",409.61,0)
409.61
"BLD",10999,"KRN",771,0)
771
"BLD",10999,"KRN",779.2,0)
779.2
"BLD",10999,"KRN",870,0)
870
"BLD",10999,"KRN",8989.51,0)
8989.51
"BLD",10999,"KRN",8989.51,"NM",0)
^9.68A^1^1
"BLD",10999,"KRN",8989.51,"NM",1,0)
DVBAB CAPRI JLV URL^^0
"BLD",10999,"KRN",8989.51,"NM","B","DVBAB CAPRI JLV URL",1)

"BLD",10999,"KRN",8989.52,0)
8989.52
"BLD",10999,"KRN",8994,0)
8994
"BLD",10999,"KRN","B",.4,.4)

"BLD",10999,"KRN","B",.401,.401)

"BLD",10999,"KRN","B",.402,.402)

"BLD",10999,"KRN","B",.403,.403)

"BLD",10999,"KRN","B",.5,.5)

"BLD",10999,"KRN","B",.84,.84)

"BLD",10999,"KRN","B",3.6,3.6)

"BLD",10999,"KRN","B",3.8,3.8)

"BLD",10999,"KRN","B",9.2,9.2)

"BLD",10999,"KRN","B",9.8,9.8)

"BLD",10999,"KRN","B",19,19)

"BLD",10999,"KRN","B",19.1,19.1)

"BLD",10999,"KRN","B",101,101)

"BLD",10999,"KRN","B",409.61,409.61)

"BLD",10999,"KRN","B",771,771)

"BLD",10999,"KRN","B",779.2,779.2)

"BLD",10999,"KRN","B",870,870)

"BLD",10999,"KRN","B",8989.51,8989.51)

"BLD",10999,"KRN","B",8989.52,8989.52)

"BLD",10999,"KRN","B",8994,8994)

"BLD",10999,"QUES",0)
^9.62^^
"BLD",10999,"REQB",0)
^9.611^1^1
"BLD",10999,"REQB",1,0)
DVBA*2.7*192^1
"BLD",10999,"REQB","B","DVBA*2.7*192",1)

"INIT")
POST^DVBA205P
"KRN",8989.5,4165,0)
223;DIC(9.4,^DVBAB CAPRI JLV URL^1
"KRN",8989.5,4165,1)
https://jlv.domain.ext/JLV/Login/loginParam?loginSource=CAPRI
"KRN",8989.51,870,-1)
0^1
"KRN",8989.51,870,0)
DVBAB CAPRI JLV URL^Joint Legacy Viewer URL^0
"KRN",8989.51,870,1)
F^^Enter the JLV URL
"KRN",8989.51,870,20,0)
^8989.512^1^1^3180227^^
"KRN",8989.51,870,20,1,0)
This parameter contains the full URL that points to the Joint Legacy Viewer for a given patient.
"KRN",8989.51,870,30,0)
^8989.513I^1^1
"KRN",8989.51,870,30,1,0)
1^9.4
"MBREQ")
0
"ORD",20,8989.51)
8989.51;20;;;PAR1E1^XPDTA2;PAR1F1^XPDIA3;PAR1E1^XPDIA3;PAR1F2^XPDIA3;;PAR1DEL^XPDIA3(%)
"ORD",20,8989.51,0)
PARAMETER DEFINITION
"PKG",223,-1)
1^1
"PKG",223,0)
AUTOMATED MED INFO EXCHANGE^DVBA^The entire AMIE package 7131/2507.
"PKG",223,20,0)
^9.402P^^
"PKG",223,22,0)
^9.49I^1^1
"PKG",223,22,1,0)
2.7^2950410^2950508
"PKG",223,22,1,"PAH",1,0)
205^3180227
"PKG",223,22,1,"PAH",1,1,0)
^^2^2^3180227
"PKG",223,22,1,"PAH",1,1,1,0)
With the replacement of Vista Web in CAPRI with Joint Legacy Viewer (JLV)
"PKG",223,22,1,"PAH",1,1,2,0)
the new JLV URL's need to be updated and accessible in Vista.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
2
"RTN","DVBA205P")
0^2^B1630052^n/a
"RTN","DVBA205P",1,0)
DVBA205P ;ALB/RRA - PATCH DVBA*2.7*205 POST-INSTALL ;5/14/2012
"RTN","DVBA205P",2,0)
 ;;2.7;AMIE;**205**;Apr 10, 1995;Build 1
"RTN","DVBA205P",3,0)
 ;
"RTN","DVBA205P",4,0)
 Q  ;NO DIRECT ENTRY
"RTN","DVBA205P",5,0)
 ;
"RTN","DVBA205P",6,0)
POST ; Main entry point for post-int item
"RTN","DVBA205P",7,0)
 ; "DVBAB CAPRI JLV URL" parameters  
"RTN","DVBA205P",8,0)
 ;
"RTN","DVBA205P",9,0)
 N DVBERR
"RTN","DVBA205P",10,0)
 S DVBERR=$$ENXPAR("PKG","DVBAB CAPRI JLV URL","https://jlv.domain.ext/JLV/Login/loginParam?loginSource=CAPRI")
"RTN","DVBA205P",11,0)
 D UPDMSG("DVBAB CAPRI JLV URL",DVBERR)
"RTN","DVBA205P",12,0)
 Q
"RTN","DVBA205P",13,0)
 ;
"RTN","DVBA205P",14,0)
ENXPAR(DVBENT,DVBPAR,DVBVAL) ;Update Parameter values
"RTN","DVBA205P",15,0)
 ;
"RTN","DVBA205P",16,0)
 ;  Input:
"RTN","DVBA205P",17,0)
 ;    DVBENT - Parameter Entity
"RTN","DVBA205P",18,0)
 ;    DVBPAR - Parameter Name
"RTN","DVBA205P",19,0)
 ;    DVBVAL - Parameter Value
"RTN","DVBA205P",20,0)
 ;
"RTN","DVBA205P",21,0)
 ;  Output:
"RTN","DVBA205P",22,0)
 ;    Function value - returns "0" on success;
"RTN","DVBA205P",23,0)
 ;                     otherwise returns error#^errortext
"RTN","DVBA205P",24,0)
 ;
"RTN","DVBA205P",25,0)
 N DVBERR
"RTN","DVBA205P",26,0)
 D EN^XPAR(DVBENT,DVBPAR,1,DVBVAL,.DVBERR)
"RTN","DVBA205P",27,0)
 Q DVBERR
"RTN","DVBA205P",28,0)
 ; 
"RTN","DVBA205P",29,0)
UPDMSG(DVBPAR,DVBERR) ;display update message
"RTN","DVBA205P",30,0)
 ;
"RTN","DVBA205P",31,0)
 ;  Input:
"RTN","DVBA205P",32,0)
 ;    DVBPAR - Parameter Name
"RTN","DVBA205P",33,0)
 ;    DVBERR - Parameter Update result
"RTN","DVBA205P",34,0)
 ;
"RTN","DVBA205P",35,0)
 ;  Output: none
"RTN","DVBA205P",36,0)
 ; 
"RTN","DVBA205P",37,0)
 I DVBERR D
"RTN","DVBA205P",38,0)
 . D MES^XPDUTL(DVBPAR_" update FAILURE.")
"RTN","DVBA205P",39,0)
 . D MES^XPDUTL("  Failure reason: "_DVBERR)
"RTN","DVBA205P",40,0)
 E  D
"RTN","DVBA205P",41,0)
 . D MES^XPDUTL(DVBPAR_" update SUCCESS.")
"RTN","DVBA205P",42,0)
 Q
"RTN","DVBA205P",43,0)
 ;
"RTN","DVBABURL")
0^1^B8885291^B7872092
"RTN","DVBABURL",1,0)
DVBABURL ;ALB/SPH - CAPRI URL ;14/MAY/2012
"RTN","DVBABURL",2,0)
 ;;2.7;AMIE;**104,136,143,149,168,181,186,192,205**;Apr 10, 1995;Build 1
"RTN","DVBABURL",3,0)
 ;ALB/RTW - added 7=VICAP website
"RTN","DVBABURL",4,0)
 ;
"RTN","DVBABURL",5,0)
URL(Y,WHICH) ;
"RTN","DVBABURL",6,0)
 ;This procedure supports the DVBAB GET URL remote procedure 
"RTN","DVBABURL",7,0)
 S Y=""
"RTN","DVBABURL",8,0)
 ; 1=VBA's AMIE Worksheet Website
"RTN","DVBABURL",9,0)
 ; 2=CAPRI training website
"RTN","DVBABURL",10,0)
 ; 3=VistAWeb website
"RTN","DVBABURL",11,0)
 ; 5=HIA download website
"RTN","DVBABURL",12,0)
 ; 6=VIRTUAL VA web service server
"RTN","DVBABURL",13,0)
 ; 7=VICAP website
"RTN","DVBABURL",14,0)
 ; 8=VLER DAS web service server
"RTN","DVBABURL",15,0)
 ; 9=JLV website
"RTN","DVBABURL",16,0)
 ; 999=Debug/Test Code
"RTN","DVBABURL",17,0)
 I WHICH=1 S Y="http://152.124.238.193/bl/21/rating/Medical/exams/index.htm"
"RTN","DVBABURL",18,0)
 I WHICH=2 S Y="http://vaww.demo.domain.ext/"
"RTN","DVBABURL",19,0)
 I WHICH=3 D
"RTN","DVBABURL",20,0)
 . I '$$PROD^XUPROD S Y="-1^VistAWeb disabled for non-production systems." Q
"RTN","DVBABURL",21,0)
 . S Y="https://vistaweb.domain.ext/CapriPage.aspx"
"RTN","DVBABURL",22,0)
 I WHICH=4 S Y="M21-1, Part VI, Rating Board Procedures^http://152.124.238.193/bl/21/Publicat/Manuals/Part6/601.htm#Exam"
"RTN","DVBABURL",23,0)
 I WHICH=5 S Y=$$GET^XPAR("PKG","DVBAB CAPRI HIA UPDATE URL",1,"Q")
"RTN","DVBABURL",24,0)
 I WHICH=6 D  ;Virtual VA web service server
"RTN","DVBABURL",25,0)
 . I $$PROD^XUPROD D
"RTN","DVBABURL",26,0)
 . . S Y=$$GET^XPAR("PKG","DVBAB CAPRI VIRTUALVA PROD URL",1,"Q")
"RTN","DVBABURL",27,0)
 . E  D
"RTN","DVBABURL",28,0)
 . . S Y=$$GET^XPAR("PKG","DVBAB CAPRI VIRTUALVA TEST URL",1,"Q")
"RTN","DVBABURL",29,0)
 I WHICH=7 S Y=$$GET^XPAR("PKG","DVBAB CAPRI VICAP URL",1,"Q")
"RTN","DVBABURL",30,0)
 I WHICH=8 D  ;VLER DAS web service server
"RTN","DVBABURL",31,0)
 . I $$PROD^XUPROD D
"RTN","DVBABURL",32,0)
 . . S Y=$$GET^XPAR("PKG","DVBAB CAPRI VLER DAS PROD URL",1,"Q")
"RTN","DVBABURL",33,0)
 . E  D
"RTN","DVBABURL",34,0)
 . . S Y=$$GET^XPAR("PKG","DVBAB CAPRI VLER DAS CH3 URL",1,"Q")
"RTN","DVBABURL",35,0)
  I WHICH=9 D  ;VD 10/4/17 DVBA*2.7*205
"RTN","DVBABURL",36,0)
 . I '$$PROD^XUPROD S Y="-1^JLV disabled for non-production systems." Q
"RTN","DVBABURL",37,0)
 . S Y=$$GET^XPAR("PKG","DVBAB CAPRI JLV URL",1,"Q")
"RTN","DVBABURL",38,0)
 I WHICH=999 S Y="http://vhaannweb2.v11.domain.ext/VwDesktop/CapriPage.aspx"
"RTN","DVBABURL",39,0)
 Q
"RTN","DVBABURL",40,0)
 ;
"RTN","DVBABURL",41,0)
VVATOKEN(DVBAUTH) ;retrieve and return the Virtual VA authorization credentials
"RTN","DVBABURL",42,0)
 ;This procedure supports the DVBA GET VVA TOKEN remote procedure and
"RTN","DVBABURL",43,0)
 ;retrieves the user, password, and token value required to login to the Virtual
"RTN","DVBABURL",44,0)
 ;VA web service.  The procedure supports returning differerent values based on
"RTN","DVBABURL",45,0)
 ;whether the system is a production system or a test/development system.
"RTN","DVBABURL",46,0)
 ;  
"RTN","DVBABURL",47,0)
 ; Returns user^password^token on success; otherwise returns ""
"RTN","DVBABURL",48,0)
 ; Example: "capri^XXXXX^Username-1"
"RTN","DVBABURL",49,0)
 ;
"RTN","DVBABURL",50,0)
 N DVBUSER
"RTN","DVBABURL",51,0)
 N DVBPWD
"RTN","DVBABURL",52,0)
 N DVBTOKEN
"RTN","DVBABURL",53,0)
 ;
"RTN","DVBABURL",54,0)
 I $$PROD^XUPROD D  ;return values for production system
"RTN","DVBABURL",55,0)
 . S DVBUSER=$$GET^XPAR("PKG","DVBAB CAPRI VVA USER",1,"Q")
"RTN","DVBABURL",56,0)
 . S DVBPWD=$$GET^XPAR("PKG","DVBAB CAPRI VVA PROD PASSWD",1,"Q")
"RTN","DVBABURL",57,0)
 . S DVBTOKEN=$$GET^XPAR("PKG","DVBAB CAPRI VVA PROD TOKEN",1,"Q")
"RTN","DVBABURL",58,0)
 E  D  ;return values for test/development system
"RTN","DVBABURL",59,0)
 . S DVBUSER=$$GET^XPAR("PKG","DVBAB CAPRI VVA USER",1,"Q")
"RTN","DVBABURL",60,0)
 . S DVBPWD=$$GET^XPAR("PKG","DVBAB CAPRI VVA TEST PASSWD",1,"Q")
"RTN","DVBABURL",61,0)
 . S DVBTOKEN=$$GET^XPAR("PKG","DVBAB CAPRI VVA TEST TOKEN",1,"Q")
"RTN","DVBABURL",62,0)
 I DVBUSER'="",DVBPWD'="",DVBTOKEN'="" D  ;success
"RTN","DVBABURL",63,0)
 . S DVBAUTH=DVBUSER_U_DVBPWD_U_DVBTOKEN
"RTN","DVBABURL",64,0)
 E  D  ;failure
"RTN","DVBABURL",65,0)
 . S DVBAUTH=""
"RTN","DVBABURL",66,0)
 Q
"VER")
8.0^22.2
"BLD",10999,6)
^173
**END**
**END**

