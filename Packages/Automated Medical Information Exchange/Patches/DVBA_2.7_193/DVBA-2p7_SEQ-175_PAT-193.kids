Released DVBA*2.7*193 SEQ #175
Extracted from mail message
**KIDS**:DVBA*2.7*193^

**INSTALL NAME**
DVBA*2.7*193
"BLD",9470,0)
DVBA*2.7*193^AUTOMATED MED INFO EXCHANGE^0^3180824^y
"BLD",9470,1,0)
^^2^2^3180821^
"BLD",9470,1,1,0)
 
"BLD",9470,1,2,0)
See FORUM patch DVBA*2.7*193 for a description of this patch.
"BLD",9470,4,0)
^9.64PA^396.195^4
"BLD",9470,4,396.195,0)
396.195
"BLD",9470,4,396.195,222)
y^y^f^^n^^y^o^n
"BLD",9470,4,396.3,0)
396.3
"BLD",9470,4,396.3,2,0)
^9.641^396.3^3
"BLD",9470,4,396.3,2,396.3,0)
2507 REQUEST  (File-top level)
"BLD",9470,4,396.3,2,396.3,1,0)
^9.6411^17^1
"BLD",9470,4,396.3,2,396.3,1,17,0)
REQUEST STATUS
"BLD",9470,4,396.3,2,396.34,0)
REROUTE DATE/TIME  (sub-file)
"BLD",9470,4,396.3,2,396.34,1,0)
^9.6411^12^13
"BLD",9470,4,396.3,2,396.34,1,.01,0)
REROUTE DATE/TIME
"BLD",9470,4,396.3,2,396.34,1,.02,0)
REROUTE TO SITE
"BLD",9470,4,396.3,2,396.34,1,1,0)
REROUTE REQUEST IEN
"BLD",9470,4,396.3,2,396.34,1,2,0)
REROUTE PATIENT IEN
"BLD",9470,4,396.3,2,396.34,1,3,0)
REROUTE FROM SITE
"BLD",9470,4,396.3,2,396.34,1,4,0)
REROUTE REASON
"BLD",9470,4,396.3,2,396.34,1,5,0)
REROUTE DESCRIPTION
"BLD",9470,4,396.3,2,396.34,1,7,0)
REROUTE USER
"BLD",9470,4,396.3,2,396.34,1,8,0)
OLD DIVISION
"BLD",9470,4,396.3,2,396.34,1,9,0)
REROUTE TO IEN
"BLD",9470,4,396.3,2,396.34,1,10,0)
REROUTE TO DOMAIN
"BLD",9470,4,396.3,2,396.34,1,11,0)
REROUTE FROM IEN
"BLD",9470,4,396.3,2,396.34,1,12,0)
REROUTE FROM DOMAIN
"BLD",9470,4,396.3,2,396.341,0)
REROUTE STATUS DATA/TIME  (sub-file)
"BLD",9470,4,396.3,2,396.341,1,0)
^9.6411^2^3
"BLD",9470,4,396.3,2,396.341,1,.01,0)
REROUTE STATUS DATA/TIME
"BLD",9470,4,396.3,2,396.341,1,1,0)
REROUTE STATUS CODE
"BLD",9470,4,396.3,2,396.341,1,2,0)
REROUTE REJECTION REASON
"BLD",9470,4,396.3,222)
y^n^p^^^^n^^n
"BLD",9470,4,396.3,224)
 
"BLD",9470,4,396.33,0)
396.33
"BLD",9470,4,396.33,222)
y^y^f^^y^^y^o^n
"BLD",9470,4,396.55,0)
396.55
"BLD",9470,4,396.55,222)
y^y^f^^y^^y^o^n
"BLD",9470,4,"APDD",396.3,396.3)
 
"BLD",9470,4,"APDD",396.3,396.3,17)
 
"BLD",9470,4,"APDD",396.3,396.34)
 
"BLD",9470,4,"APDD",396.3,396.34,.01)
 
"BLD",9470,4,"APDD",396.3,396.34,.02)
 
"BLD",9470,4,"APDD",396.3,396.34,1)
 
"BLD",9470,4,"APDD",396.3,396.34,2)
 
"BLD",9470,4,"APDD",396.3,396.34,3)
 
"BLD",9470,4,"APDD",396.3,396.34,4)
 
"BLD",9470,4,"APDD",396.3,396.34,5)
 
"BLD",9470,4,"APDD",396.3,396.34,7)
 
"BLD",9470,4,"APDD",396.3,396.34,8)
 
"BLD",9470,4,"APDD",396.3,396.34,9)
 
"BLD",9470,4,"APDD",396.3,396.34,10)
 
"BLD",9470,4,"APDD",396.3,396.34,11)
 
"BLD",9470,4,"APDD",396.3,396.34,12)
 
"BLD",9470,4,"APDD",396.3,396.341)
 
"BLD",9470,4,"APDD",396.3,396.341,.01)
 
"BLD",9470,4,"APDD",396.3,396.341,1)
 
"BLD",9470,4,"APDD",396.3,396.341,2)
 
"BLD",9470,4,"B",396.195,396.195)
 
"BLD",9470,4,"B",396.3,396.3)
 
"BLD",9470,4,"B",396.33,396.33)
 
"BLD",9470,4,"B",396.55,396.55)
 
"BLD",9470,6)
14^
"BLD",9470,6.3)
84
"BLD",9470,"ABPKG")
 
"BLD",9470,"INIT")
DVBC193P
"BLD",9470,"KRN",0)
^9.67PA^779.2^20
"BLD",9470,"KRN",.4,0)
.4
"BLD",9470,"KRN",.401,0)
.401
"BLD",9470,"KRN",.402,0)
.402
"BLD",9470,"KRN",.403,0)
.403
"BLD",9470,"KRN",.5,0)
.5
"BLD",9470,"KRN",.84,0)
.84
"BLD",9470,"KRN",3.6,0)
3.6
"BLD",9470,"KRN",3.6,"NM",0)
^9.68A^1^1
"BLD",9470,"KRN",3.6,"NM",1,0)
DVBA CAPRI REROUTE^^0
"BLD",9470,"KRN",3.6,"NM","B","DVBA CAPRI REROUTE",1)
 
"BLD",9470,"KRN",3.8,0)
3.8
"BLD",9470,"KRN",3.8,"NM",0)
^9.68A^1^1
"BLD",9470,"KRN",3.8,"NM",1,0)
DVBA C 2507 REROUTE^^0
"BLD",9470,"KRN",3.8,"NM","B","DVBA C 2507 REROUTE",1)
 
"BLD",9470,"KRN",9.2,0)
9.2
"BLD",9470,"KRN",9.8,0)
9.8
"BLD",9470,"KRN",9.8,"NM",0)
^9.68A^56^53
"BLD",9470,"KRN",9.8,"NM",1,0)
DVBAB2^^0^B32705926
"BLD",9470,"KRN",9.8,"NM",2,0)
DVBAB5^^0^B2646999
"BLD",9470,"KRN",9.8,"NM",3,0)
DVBAB6^^0^B69476368
"BLD",9470,"KRN",9.8,"NM",4,0)
DVBABEBD^^0^B12975161
"BLD",9470,"KRN",9.8,"NM",6,0)
DVBCUTL5^^0^B17533926
"BLD",9470,"KRN",9.8,"NM",7,0)
DVBCTRN1^^0^B5018237
"BLD",9470,"KRN",9.8,"NM",8,0)
DVBCROPN^^0^B28631923
"BLD",9470,"KRN",9.8,"NM",9,0)
DVBCREQP^^0^B25484562
"BLD",9470,"KRN",9.8,"NM",10,0)
DVBCPND1^^0^B20124911
"BLD",9470,"KRN",9.8,"NM",11,0)
DVBCHS0^^0^B8414277
"BLD",9470,"KRN",9.8,"NM",12,0)
DVBCHLR^^0^B27140318
"BLD",9470,"KRN",9.8,"NM",13,0)
DVBCCHKR^^0^B29140314
"BLD",9470,"KRN",9.8,"NM",14,0)
DVBCADEX^^0^B8659510
"BLD",9470,"KRN",9.8,"NM",16,0)
DVBAB70^^0^B35957431
"BLD",9470,"KRN",9.8,"NM",17,0)
DVBAB1C^^0^B26976785
"BLD",9470,"KRN",9.8,"NM",18,0)
DVBARSBD^^0^B203061467
"BLD",9470,"KRN",9.8,"NM",19,0)
DVBCXFR1^^0^B11734137
"BLD",9470,"KRN",9.8,"NM",20,0)
DVBCXFR2^^0^B31249178
"BLD",9470,"KRN",9.8,"NM",21,0)
DVBCXFRC^^0^B92188379
"BLD",9470,"KRN",9.8,"NM",22,0)
DVBCXFRS^^0^B11515454
"BLD",9470,"KRN",9.8,"NM",23,0)
DVBC193P^^0^B4711875
"BLD",9470,"KRN",9.8,"NM",24,0)
DVBCUTL3^^0^B23964326
"BLD",9470,"KRN",9.8,"NM",25,0)
DVBCSCHD^^0^B18709519
"BLD",9470,"KRN",9.8,"NM",26,0)
DVBACRVA^^0^B10866271
"BLD",9470,"KRN",9.8,"NM",27,0)
DVBCREDT^^0^B24629709
"BLD",9470,"KRN",9.8,"NM",28,0)
DVBCCNCL^^0^B28830312
"BLD",9470,"KRN",9.8,"NM",29,0)
DVBCCNC1^^0^B14797282
"BLD",9470,"KRN",9.8,"NM",30,0)
DVBCPNDR^^0^B23812225
"BLD",9470,"KRN",9.8,"NM",31,0)
DVBCEDIT^^0^B19786261
"BLD",9470,"KRN",9.8,"NM",32,0)
DVBCLOG^^0^B16692467
"BLD",9470,"KRN",9.8,"NM",33,0)
DVBCPRN1^^0^B19322619
"BLD",9470,"KRN",9.8,"NM",34,0)
DVBCROP1^^0^B2251550
"BLD",9470,"KRN",9.8,"NM",35,0)
DVBCRELS^^0^B16510562
"BLD",9470,"KRN",9.8,"NM",36,0)
DVBCXFRE^^0^B25364359
"BLD",9470,"KRN",9.8,"NM",37,0)
DVBAALRT^^0^B1094180
"BLD",9470,"KRN",9.8,"NM",38,0)
DVBAB58^^0^B15547843
"BLD",9470,"KRN",9.8,"NM",39,0)
DVBAB82^^0^B149057820
"BLD",9470,"KRN",9.8,"NM",41,0)
DVBCBULL^^0^B30257624
"BLD",9470,"KRN",9.8,"NM",42,0)
DVBCNTSC^^0^B13108259
"BLD",9470,"KRN",9.8,"NM",43,0)
DVBCENQ1^^0^B24659456
"BLD",9470,"KRN",9.8,"NM",44,0)
DVBCIRP2^^0^B81927737
"BLD",9470,"KRN",9.8,"NM",45,0)
DVBCIRPT^^0^B49657590
"BLD",9470,"KRN",9.8,"NM",46,0)
DVBCLABR^^0^B7567469
"BLD",9470,"KRN",9.8,"NM",47,0)
DVBCPRNT^^0^B15392745
"BLD",9470,"KRN",9.8,"NM",48,0)
DVBCPURG^^0^B3907504
"BLD",9470,"KRN",9.8,"NM",49,0)
DVBCRPON^^0^B17053087
"BLD",9470,"KRN",9.8,"NM",50,0)
DVBCRPRT^^0^B20659083
"BLD",9470,"KRN",9.8,"NM",51,0)
DVBCXFRA^^0^B30776087
"BLD",9470,"KRN",9.8,"NM",52,0)
DVBCXFRB^^0^B16864719
"BLD",9470,"KRN",9.8,"NM",53,0)
DVBCXFRD^^0^B17669105
"BLD",9470,"KRN",9.8,"NM",54,0)
DVBCREQ3^^0^B2435535
"BLD",9470,"KRN",9.8,"NM",55,0)
DVBCUTL8^^0^B98535168
"BLD",9470,"KRN",9.8,"NM",56,0)
DVBAB1B^^0^B11312167
"BLD",9470,"KRN",9.8,"NM","B","DVBAALRT",37)
 
"BLD",9470,"KRN",9.8,"NM","B","DVBAB1B",56)

"BLD",9470,"KRN",9.8,"NM","B","DVBAB1C",17)
 
"BLD",9470,"KRN",9.8,"NM","B","DVBAB2",1)
 
"BLD",9470,"KRN",9.8,"NM","B","DVBAB5",2)
 
"BLD",9470,"KRN",9.8,"NM","B","DVBAB58",38)
 
"BLD",9470,"KRN",9.8,"NM","B","DVBAB6",3)
 
"BLD",9470,"KRN",9.8,"NM","B","DVBAB70",16)
 
"BLD",9470,"KRN",9.8,"NM","B","DVBAB82",39)
 
"BLD",9470,"KRN",9.8,"NM","B","DVBABEBD",4)
 
"BLD",9470,"KRN",9.8,"NM","B","DVBACRVA",26)
 
"BLD",9470,"KRN",9.8,"NM","B","DVBARSBD",18)
 
"BLD",9470,"KRN",9.8,"NM","B","DVBC193P",23)
 
"BLD",9470,"KRN",9.8,"NM","B","DVBCADEX",14)
 
"BLD",9470,"KRN",9.8,"NM","B","DVBCBULL",41)
 
"BLD",9470,"KRN",9.8,"NM","B","DVBCCHKR",13)
 
"BLD",9470,"KRN",9.8,"NM","B","DVBCCNC1",29)
 
"BLD",9470,"KRN",9.8,"NM","B","DVBCCNCL",28)
 
"BLD",9470,"KRN",9.8,"NM","B","DVBCEDIT",31)
 
"BLD",9470,"KRN",9.8,"NM","B","DVBCENQ1",43)
 
"BLD",9470,"KRN",9.8,"NM","B","DVBCHLR",12)
 
"BLD",9470,"KRN",9.8,"NM","B","DVBCHS0",11)
 
"BLD",9470,"KRN",9.8,"NM","B","DVBCIRP2",44)
 
"BLD",9470,"KRN",9.8,"NM","B","DVBCIRPT",45)
 
"BLD",9470,"KRN",9.8,"NM","B","DVBCLABR",46)
 
"BLD",9470,"KRN",9.8,"NM","B","DVBCLOG",32)
 
"BLD",9470,"KRN",9.8,"NM","B","DVBCNTSC",42)
 
"BLD",9470,"KRN",9.8,"NM","B","DVBCPND1",10)
 
"BLD",9470,"KRN",9.8,"NM","B","DVBCPNDR",30)
 
"BLD",9470,"KRN",9.8,"NM","B","DVBCPRN1",33)
 
"BLD",9470,"KRN",9.8,"NM","B","DVBCPRNT",47)
 
"BLD",9470,"KRN",9.8,"NM","B","DVBCPURG",48)
 
"BLD",9470,"KRN",9.8,"NM","B","DVBCREDT",27)
 
"BLD",9470,"KRN",9.8,"NM","B","DVBCRELS",35)
 
"BLD",9470,"KRN",9.8,"NM","B","DVBCREQ3",54)
 
"BLD",9470,"KRN",9.8,"NM","B","DVBCREQP",9)
 
"BLD",9470,"KRN",9.8,"NM","B","DVBCROP1",34)
 
"BLD",9470,"KRN",9.8,"NM","B","DVBCROPN",8)
 
"BLD",9470,"KRN",9.8,"NM","B","DVBCRPON",49)
 
"BLD",9470,"KRN",9.8,"NM","B","DVBCRPRT",50)
 
"BLD",9470,"KRN",9.8,"NM","B","DVBCSCHD",25)
 
"BLD",9470,"KRN",9.8,"NM","B","DVBCTRN1",7)
 
"BLD",9470,"KRN",9.8,"NM","B","DVBCUTL3",24)
 
"BLD",9470,"KRN",9.8,"NM","B","DVBCUTL5",6)
 
"BLD",9470,"KRN",9.8,"NM","B","DVBCUTL8",55)
 
"BLD",9470,"KRN",9.8,"NM","B","DVBCXFR1",19)
 
"BLD",9470,"KRN",9.8,"NM","B","DVBCXFR2",20)
 
"BLD",9470,"KRN",9.8,"NM","B","DVBCXFRA",51)
 
"BLD",9470,"KRN",9.8,"NM","B","DVBCXFRB",52)
 
"BLD",9470,"KRN",9.8,"NM","B","DVBCXFRC",21)
 
"BLD",9470,"KRN",9.8,"NM","B","DVBCXFRD",53)
 
"BLD",9470,"KRN",9.8,"NM","B","DVBCXFRE",36)
 
"BLD",9470,"KRN",9.8,"NM","B","DVBCXFRS",22)
 
"BLD",9470,"KRN",19,0)
19
"BLD",9470,"KRN",19,"NM",0)
^9.68A^1^1
"BLD",9470,"KRN",19,"NM",1,0)
DVBA CAPRI GUI^^0
"BLD",9470,"KRN",19,"NM","B","DVBA CAPRI GUI",1)
 
"BLD",9470,"KRN",19.1,0)
19.1
"BLD",9470,"KRN",19.1,"NM",0)
^9.68A^1^1
"BLD",9470,"KRN",19.1,"NM",1,0)
DVBA CAPRI REROUTEREASONS^^0
"BLD",9470,"KRN",19.1,"NM","B","DVBA CAPRI REROUTEREASONS",1)
 
"BLD",9470,"KRN",101,0)
101
"BLD",9470,"KRN",409.61,0)
409.61
"BLD",9470,"KRN",771,0)
771
"BLD",9470,"KRN",779.2,0)
779.2
"BLD",9470,"KRN",870,0)
870
"BLD",9470,"KRN",8989.51,0)
8989.51
"BLD",9470,"KRN",8989.51,"NM",0)
^9.68A^1^1
"BLD",9470,"KRN",8989.51,"NM",1,0)
DVBAB CAPRI MINIMUM VERSION^^0
"BLD",9470,"KRN",8989.51,"NM","B","DVBAB CAPRI MINIMUM VERSION",1)
 
"BLD",9470,"KRN",8989.52,0)
8989.52
"BLD",9470,"KRN",8994,0)
8994
"BLD",9470,"KRN",8994,"NM",0)
^9.68A^9^9
"BLD",9470,"KRN",8994,"NM",1,0)
DVBA CAPRI GET DIV COMMENT^^0
"BLD",9470,"KRN",8994,"NM",2,0)
DVBA CAPRI GET DIV EXAM^^0
"BLD",9470,"KRN",8994,"NM",3,0)
DVBA CAPRI GET DIVISION^^0
"BLD",9470,"KRN",8994,"NM",4,0)
DVBA CAPRI GET REROUTE^^0
"BLD",9470,"KRN",8994,"NM",5,0)
DVBA CAPRI GET REROUTE CODE^^0
"BLD",9470,"KRN",8994,"NM",6,0)
DVBA CAPRI REROUTE INFO^^0
"BLD",9470,"KRN",8994,"NM",7,0)
DVBA CAPRI REROUTE STATUS^^0
"BLD",9470,"KRN",8994,"NM",8,0)
DVBA CAPRI REROUTE VAMC^^0
"BLD",9470,"KRN",8994,"NM",9,0)
DVBA CAPRI SEND REROUTE^^0
"BLD",9470,"KRN",8994,"NM","B","DVBA CAPRI GET DIV COMMENT",1)
 
"BLD",9470,"KRN",8994,"NM","B","DVBA CAPRI GET DIV EXAM",2)
 
"BLD",9470,"KRN",8994,"NM","B","DVBA CAPRI GET DIVISION",3)
 
"BLD",9470,"KRN",8994,"NM","B","DVBA CAPRI GET REROUTE",4)
 
"BLD",9470,"KRN",8994,"NM","B","DVBA CAPRI GET REROUTE CODE",5)
 
"BLD",9470,"KRN",8994,"NM","B","DVBA CAPRI REROUTE INFO",6)
 
"BLD",9470,"KRN",8994,"NM","B","DVBA CAPRI REROUTE STATUS",7)
 
"BLD",9470,"KRN",8994,"NM","B","DVBA CAPRI REROUTE VAMC",8)
 
"BLD",9470,"KRN",8994,"NM","B","DVBA CAPRI SEND REROUTE",9)
 
"BLD",9470,"KRN","B",.4,.4)
 
"BLD",9470,"KRN","B",.401,.401)
 
"BLD",9470,"KRN","B",.402,.402)
 
"BLD",9470,"KRN","B",.403,.403)
 
"BLD",9470,"KRN","B",.5,.5)
 
"BLD",9470,"KRN","B",.84,.84)
 
"BLD",9470,"KRN","B",3.6,3.6)
 
"BLD",9470,"KRN","B",3.8,3.8)
 
"BLD",9470,"KRN","B",9.2,9.2)
 
"BLD",9470,"KRN","B",9.8,9.8)
 
"BLD",9470,"KRN","B",19,19)
 
"BLD",9470,"KRN","B",19.1,19.1)
 
"BLD",9470,"KRN","B",101,101)
 
"BLD",9470,"KRN","B",409.61,409.61)
 
"BLD",9470,"KRN","B",771,771)
 
"BLD",9470,"KRN","B",779.2,779.2)
 
"BLD",9470,"KRN","B",870,870)
 
"BLD",9470,"KRN","B",8989.51,8989.51)
 
"BLD",9470,"KRN","B",8989.52,8989.52)
 
"BLD",9470,"KRN","B",8994,8994)
 
"BLD",9470,"QDEF")
^^^^NO^^^^NO^^NO
"BLD",9470,"QUES",0)
^9.62^^
"BLD",9470,"REQB",0)
^9.611^6^6
"BLD",9470,"REQB",1,0)
DVBA*2.7*168^1
"BLD",9470,"REQB",2,0)
DVBA*2.7*184^1
"BLD",9470,"REQB",3,0)
DVBA*2.7*185^1
"BLD",9470,"REQB",4,0)
DVBA*2.7*192^1
"BLD",9470,"REQB",5,0)
DVBA*2.7*194^1
"BLD",9470,"REQB",6,0)
DI*22.2*3^1
"BLD",9470,"REQB","B","DI*22.2*3",6)
 
"BLD",9470,"REQB","B","DVBA*2.7*168",1)
 
"BLD",9470,"REQB","B","DVBA*2.7*184",2)
 
"BLD",9470,"REQB","B","DVBA*2.7*185",3)
 
"BLD",9470,"REQB","B","DVBA*2.7*192",4)
 
"BLD",9470,"REQB","B","DVBA*2.7*194",5)
 
"DATA",396.195,1,0)
ALBANY located in ALBANY, NEW YORK^NEW YORK^V02.DOMAIN.EXT
"DATA",396.195,2,0)
ALBUQUERQUE located in ALBUQUERQUE, NEW MEXICO^NEW MEXICO^ALBUQUERQUE.DOMAIN.EXT
"DATA",396.195,3,0)
ALEXANDRIA located in PINEVILLE, LOUISIANA^LOUISIANA^ALEXANDRIA.DOMAIN.EXT
"DATA",396.195,4,0)
ALTOONA located in ALTOONA, PENNSYLVANIA^PENNSYLVANIA^ALTOONA.DOMAIN.EXT
"DATA",396.195,5,0)
AMARILLO HCS located in AMARILLO, TEXAS^TEXAS^AMARILLO.DOMAIN.EXT
"DATA",396.195,6,0)
ANCHORAGE VAMROC located in ANCHORAGE, ALASKA^ALASKA^ANCHORAGE.DOMAIN.EXT
"DATA",396.195,7,0)
ANN ARBOR located in ANN ARBOR, MICHIGAN^MICHIGAN^ANN-ARBOR.DOMAIN.EXT
"DATA",396.195,8,0)
ARIZONA HCS located in TUCSON, ARIZONA^ARIZONA^TUCSON.DOMAIN.EXT
"DATA",396.195,9,0)
ASHEVILLE located in ASHEVILLE, NORTH CAROLINA^NORTH CAROLINA^ASHEVILLE.DOMAIN.EXT
"DATA",396.195,10,0)
ATLANTA located in DECATUR, GEORGIA^GEORGIA^ATLANTA.DOMAIN.EXT
"DATA",396.195,11,0)
AUGUSTA located in AUGUSTA, GEORGIA^GEORGIA^AUGUSTA.DOMAIN.EXT
"DATA",396.195,12,0)
BALTIMORE located in BALTIMORE, MARYLAND^MARYLAND^BALTIMORE.DOMAIN.EXT
"DATA",396.195,13,0)
BATAVIA located in ALBANY, NEW YORK^NEW YORK^V02.DOMAIN.EXT
"DATA",396.195,14,0)
BATH located in ALBANY, NEW YORK^NEW YORK^V02.DOMAIN.EXT
"DATA",396.195,15,0)
BATTLE CREEK located in BATTLE CREEK, MICHIGAN^MICHIGAN^BATTLE-CREEK.DOMAIN.EXT
"DATA",396.195,16,0)
BAY PINES VA HCS located in ST. PETERSBURG, FLORIDA^FLORIDA^BAY-PINES.DOMAIN.EXT
"DATA",396.195,17,0)
BECKLEY located in BECKLEY, WEST VIRGINIA^WEST VIRGINIA^BECKLEY.DOMAIN.EXT
"DATA",396.195,18,0)
BEDFORD located in BEDFORD, MASSACHUSSETS^MASSACHUSSETS^BUTLER.DOMAIN.EXT
"DATA",396.195,19,0)
BIG SPRING located in BIG SPRING, TEXAS^TEXAS^BIG-SPRING.DOMAIN.EXT
"DATA",396.195,20,0)
BILOXI located in BILOXI, MISSISSIPPI^MISSISSIPPI^BILOXI.DOMAIN.EXT
"DATA",396.195,21,0)
BIRMINGHAM located in BIRMINGHAM, ALABAMA^ALABAMA^BIRMINGHAM.DOMAIN.EXT
"DATA",396.195,22,0)
BLACK HILLS HCS located in FORT MEADE, SOUTH DAKOTA^SOUTH DAKOTA^BLACK-HILLS.DOMAIN.EXT
"DATA",396.195,23,0)
BOISE located in BOISE, IDAHO^IDAHO^BOISE.DOMAIN.EXT
"DATA",396.195,24,0)
BOSTON HCS located in BOSTON, MASSACHUSSETTS^MASSACHUSSETTS^BOSTON.DOMAIN.EXT
"DATA",396.195,25,0)
BRONX located in BRONX, NEW YORK^NEW YORK^BRONX.DOMAIN.EXT
"DATA",396.195,26,0)
BROOKLYN located in NEW YORK, NEW YORK^NEW YORK^NEW-YORK.DOMAIN.EXT
"DATA",396.195,27,0)
BUFFALO located in ALBANY, NEW YORK^NEW YORK^V02.DOMAIN.EXT
"DATA",396.195,28,0)
BUTLER located in BUTLER, PENNSYLVANIA^PENNSYLVANIA^BUTLER.DOMAIN.EXT
"DATA",396.195,29,0)
CANANDAIGUA located in ALBANY, NEW YORK^NEW YORK^CANANDAIGUA.DOMAIN.EXT
"DATA",396.195,30,0)
CENTRAL ALABAMA HCS located in MONTGOMERY, ALABAMA^ALABAMA^CENTRAL-ALABAMA.DOMAIN.EXT
"DATA",396.195,31,0)
CENTRAL TEXAS HCS located in TEMPLE, TEXAS^TEXAS^CENTRAL-TEXAS.DOMAIN.EXT
"DATA",396.195,32,0)
CHARLESTON located in CHARLESTON, SOUTH CAROLINA^SOUTH CAROLINA^CHARLESTON.DOMAIN.EXT
"DATA",396.195,33,0)
CHEYENNE VAMROC located in CHEYENNE, WYOMING^WYOMING^CHEYENNE.DOMAIN.EXT
"DATA",396.195,34,0)
CHICAGO HCS located in ILLINOIS^ILLINOIS^CHICAGO-LAKE.DOMAIN.EXT
"DATA",396.195,35,0)
CHILLICOTHE located in CHILLICOTHE, OHIO^OHIO^CHILLICOTHE.DOMAIN.EXT
"DATA",396.195,36,0)
CINCINNATI located in CINCINNATI, OHIO^OHIO^CINCINNATI.DOMAIN.EXT
"DATA",396.195,37,0)
CLARKSBURG located in CLARKSBURG, WEST VIRGINIA^WEST VIRGINIA^CLARKSBURG.DOMAIN.EXT
"DATA",396.195,38,0)
CLEVELAND located in CLEVELAND, OHIO^OHIO^CLEVELAND.DOMAIN.EXT
"DATA",396.195,39,0)
COATSVILLE located in COATSVILLE, PENNSYLVANIA^PENNSYLVANIA^COATESVILLE.DOMAIN.EXT
"DATA",396.195,40,0)
COLUMBIA, MO located in KANSAS CITY, MISSOURI^MISSOURI^KANSAS-CITY.DOMAIN.EXT
"DATA",396.195,41,0)
COLUMBIA, SC located in COLUMBIA, SOUTH CAROLINA^SOUTH CAROLINA^COLUMBIA-SC.DOMAIN.EXT
"DATA",396.195,42,0)
COLUMBUS located in COLUMBUS, OHIO^OHIO^COLUMBUS.DOMAIN.EXT
"DATA",396.195,43,0)
CONNECTICUT HCS located in WEST HAVEN, CONNECTICUT^CONNECTICUT^WEST-HAVEN.DOMAIN.EXT
"DATA",396.195,44,0)
CORPUS CHRISTI located in HARLINGEN, TEXAS^TEXAS^VALLEYCOASTALBEND.DOMAIN.EXT
"DATA",396.195,45,0)
DANVILLE located in DANVILLE, ILLINOIS^ILLINOIS^DANVILLE.DOMAIN.EXT
"DATA",396.195,46,0)
DAYTON located in DAYTON, OHIO^OHIO^DAYTON.DOMAIN.EXT
"DATA",396.195,47,0)
DENVER located in DENVER, COLORADO^COLORADO^DENVER.DOMAIN.EXT
"DATA",396.195,48,0)
DES MOINES located in OMAHA, NEBRASKA^NEBRASKA^CENTRAL-PLAINS.DOMAIN.EXT
"DATA",396.195,49,0)
DETROIT located in DETROIT, MICHIGAN^MICHIGAN^DETROIT.DOMAIN.EXT
"DATA",396.195,50,0)
DUBLIN located in DUBLIN, GEORGIA^GEORGIA^DUBLIN.DOMAIN.EXT
"DATA",396.195,51,0)
DURHAM located in DURHAM, NORTH CAROLINA^NORTH CAROLINA^DUBLIN.DOMAIN.EXT
"DATA",396.195,52,0)
EAST ORANGE located in EAST ORANGE, NEW JERSEY^NEW JERSEY^EAST-ORANGE.DOMAIN.EXT
"DATA",396.195,53,0)
EL PASO VA HCS located in EL PASO, TEXAS^TEXAS^EL-PASO.DOMAIN.EXT
"DATA",396.195,54,0)
ERIE located in ERIE, PENNSYLVANIA^PENNSYLVANIA^ERIE.DOMAIN.EXT
"DATA",396.195,55,0)
FARGO VAMROC located in FARGO, NORTH DAKOTA^NORTH DAKOTA^FARGO.DOMAIN.EXT
"DATA",396.195,56,0)
FAYETTEVILLE AR located in FAYETTEVILLE, ARKANSAS^ARKANSAS^FAYETTVL-AR.DOMAIN.EXT
"DATA",396.195,57,0)
FAYETTEVILLE NC VAMC located in FAYETTEVILLE, NORTH CAROLINA^NORTH CAROLINA^FAYETTVL-NC.DOMAIN.EXT
"DATA",396.195,58,0)
FORT HARRISON  located in FORT HARRISON, MONTANA^MONTANA^MONTANA.DOMAIN.EXT
"DATA",396.195,59,0)
FORT HOWARD located in BALTIMORE, MARYLAND^MARYLAND^BALTIMORE.DOMAIN.EXT
"DATA",396.195,60,0)
FORT WAYNE located in MARION, INDIANA^INDIANA^NORTHERN-INDIANA.DOMAIN.EXT
"DATA",396.195,61,0)
FRESNO located in FRESNO, CALIFORNIA^CALIFORNIA^FRESNO.DOMAIN.EXT
"DATA",396.195,62,0)
GAINESVILLE/LAKE CITY located in GAINESVILLE, FLORIDA^FLORIDA^NORTH-FLORIDA.DOMAIN.EXT
"DATA",396.195,63,0)
DEVVCC located in DEVVCC^CALIFORNIA^DEVVCC.DOMAIN.EXT
"DATA",396.195,64,0)
GRAND JUNCTION located in GRAND JUNCTION, COLORADO^COLORADO^GRAND-JUNCT.DOMAIN.EXT
"DATA",396.195,65,0)
HAMPTON located in HAMPTON, VIRGINIA^VIRGINIA^HAMPTON.DOMAIN.EXT
"DATA",396.195,66,0)
HARLINGEN located in HARLINGEN, TEXAS^TEXAS^VALLEYCOASTALBEND.DOMAIN.EXT
"DATA",396.195,67,0)
HINES located in HINES, ILLINOIS^ILLINOIS^HINES.DOMAIN.EXT
"DATA",396.195,68,0)
HONOLULU located in HONOLULU, HAWAII^HAWAII^HONOLULU.DOMAIN.EXT
"DATA",396.195,69,0)
HOUSTON located in HOUSTON, TEXAS^TEXAS^HOUSTON.DOMAIN.EXT
"DATA",396.195,70,0)
HUDSON VALLEY HCS located in MONTROSE, NEW YORK^NEW YORK^MONTROSE.DOMAIN.EXT
"DATA",396.195,71,0)
HUNTINGTON located in HUNTINGTON, WEST VIRGINIA^WEST VIRGINIA^HUNTINGTON.DOMAIN.EXT
"DATA",396.195,72,0)
INDIANAPOLIS located in INDIANAPOLIS, INDIANA^INDIANA^INDIANAPOLIS.DOMAIN.EXT
"DATA",396.195,73,0)
IOWA CITY located in OMAHA, NEBRASKA^NEBRASKA^IOWA-CITY.DOMAIN.EXT
"DATA",396.195,74,0)
IRON MOUNTAIN located in IRON MOUNTAIN, MICHIGAN^MICHIGAN^IRON-MTN.DOMAIN.EXT
"DATA",396.195,75,0)
JACKSON VAMC located in MISSISSIPPI^MISSISSIPPI^JACKSON.DOMAIN.EXT
"DATA",396.195,76,0)
JESSE BROWN VAMC located in ILLINOIS^ILLINOIS^CHICAGO-WEST.DOMAIN.EXT
"DATA",396.195,77,0)
KANSAS CITY located in KANSAS CITY, MISSOURI^MISSOURI^KANSAS-CITY.DOMAIN.EXT
"DATA",396.195,78,0)
KNOXVILLE, IOWA located in OMAHA, NEBRASKA^NEBRASKA^CENTRAL-PLAINS.DOMAIN.EXT
"DATA",396.195,79,0)
LAS VEGAS located in LAS VEGAS, NEVADA^NEVADA^LAS-VEGAS.DOMAIN.EXT
"DATA",396.195,80,0)
LEAVENWORTH located in KANSAS CITY, MISSOURI^MISSOURI^KANSAS-CITY.DOMAIN.EXT
"DATA",396.195,81,0)
LEBANON located in LEBANON, PENNSYLVANIA^PENNSYLVANIA^LEBANON.DOMAIN.EXT
"DATA",396.195,82,0)
LEXINGTON located in LEXINGTON, KENTUCKY^KENTUCKY^LEXINGTON.DOMAIN.EXT
"DATA",396.195,83,0)
LITTLE ROCK located in LITTLE ROCK, ARKANSAS^ARKANSAS^LITTLE-ROCK.DOMAIN.EXT
"DATA",396.195,84,0)
LOMA LINDA located in LOMA LINDA, CALIFORNIA^CALIFORNIA^LOMA-LINDA.DOMAIN.EXT
"DATA",396.195,85,0)
LONG BEACH HSC located in LONG BEACH, CALIFORNIA^CALIFORNIA^LONG-BEACH.DOMAIN.EXT
"DATA",396.195,86,0)
LOS ANGELES VAMC located in LOS ANGELES, CALIFORNIA^CALIFORNIA^WEST-LA.DOMAIN.EXT
"DATA",396.195,87,0)
LOUISVILLE located in LOUISVILLE, KENTUCKY^KENTUCKY^LOUISVILLE.DOMAIN.EXT
"DATA",396.195,88,0)
MADISON located in MADISON, WISCONSIN^WISCONSIN^MADISON.DOMAIN.EXT
"DATA",396.195,89,0)
MANCHESTER located in MANCHESTER, NEW HAMPSHIRE^NEW HAMPSHIRE^MANCHESTER.DOMAIN.EXT
"DATA",396.195,90,0)
MANILA located in PAWAY CITY, METRO MANILA, PHILIPPINES^PHILIPPINES^MANILA.DOMAIN.EXT
"DATA",396.195,91,0)
MARION (VISN-15) located in ST. LOUIS, MISSOURI^MISSOURI^ST-LOUIS.DOMAIN.EXT
"DATA",396.195,92,0)
MARION, INDIANA VAMC located in MARION, INDIANA^INDIANA^NORTHERN-INDIANA.DOMAIN.EXT
"DATA",396.195,93,0)
MARTINEZ located in MARTINEZ, CALIFORNIA^CALIFORNIA^MARTINEZ.DOMAIN.EXT
"DATA",396.195,94,0)
MARTINSBURG located in MARTINSBURG, WEST VIRGINIA^WEST VIRGINIA^MARTINSBURG.DOMAIN.EXT
"DATA",396.195,95,0)
MARYLAND HCS located in BALTIMORE, MARYLAND^MARYLAND^BALTIMORE.DOMAIN.EXT
"DATA",396.195,96,0)
MEMPHIS located in MEMPHIS, TENNESSEE^TENNESSEE^MEMPHIS.DOMAIN.EXT
"DATA",396.195,97,0)
MIAMI located in MIAMI, FLORIDA^FLORIDA^MIAMI.DOMAIN.EXT
"DATA",396.195,98,0)
MILWAUKEE located in MILWAUKEE, WISCONSIN^WISCONSIN^MILWAUKEE.DOMAIN.EXT
"DATA",396.195,99,0)
MINNEAPOLIS located in MINNEAPOLIS, MINNESOTA^MINNESOTA^MINNEAPOLIS.DOMAIN.EXT
"DATA",396.195,100,0)
MONTGOMERY located in MONTGOMERY, ALABAMA^ALABAMA^CENTRAL-ALABAMA.DOMAIN.EXT
"DATA",396.195,101,0)
MONTROSE located in MONTROSE, NEW YORK^NEW YORK^MONTROSE.DOMAIN.EXT
"DATA",396.195,102,0)
MOUNTAIN HOME located in MOUNTAIN HOME, TENNESSEE^TENNESSEE^MTN-HOME.DOMAIN.EXT
"DATA",396.195,103,0)
MUSKOGEE located in MUSKOGEE, OKLAHOMA^OKLAHOMA^MUSKOGEE.DOMAIN.EXT
"DATA",396.195,104,0)
N. FLORIDA/S. GEORGIA VHS located in GAINESVILLE, FLORIDA^FLORIDA^NORTH-FLORIDA.DOMAIN.EXT
"DATA",396.195,105,0)
NASHVILLE/MURFREESBORO located in NASHVILLE, TENNESSEE^TENNESSEE^TENNESSEEVALLEY.DOMAIN.EXT
"DATA",396.195,106,0)
NEW JERSEY HCS located in EAST ORANGE, NEW JERSEY^NEW JERSEY^EAST-ORANGE.DOMAIN.EXT
"DATA",396.195,107,0)
NEW ORLEANS located in NEW ORLEANS, LOUISIANA^LOUISIANA^NEW-ORLEANS.DOMAIN.EXT
"DATA",396.195,108,0)
NEW YORK, HHS located in NEW YORK, NEW YORK^NEW YORK^NY-HARBOR.DOMAIN.EXT
"DATA",396.195,109,0)
NORTH CHICAGO located in NORTH CHICAGO, ILLINOIS^ILLINOIS^N-CHICAGO.DOMAIN.EXT
"DATA",396.195,110,0)
NORTH TEXAS HCS/DALLAS/BONHAM located in DALLAS, TEXAS^TEXAS^DALLAS.DOMAIN.EXT
"DATA",396.195,111,0)
NORTHAMPTON located in LEEDS, MASSACHUSETTS^MASSACHUSETTS^NORTHAMPTON.DOMAIN.EXT
"DATA",396.195,112,0)
NORTHERN CALIFORNIA HCS located in MARTINEZ, CALIFORNIA^CALIFORNIA^MARTINEZ.DOMAIN.EXT
"DATA",396.195,113,0)
NORTHERN INDIANA HCS located in MARION, INDIANA^INDIANA^NORTHERN-INDIANA.DOMAIN.EXT
"DATA",396.195,114,0)
NORTHPORT located in NORTHPORT, NEW YORK^NEW YORK^NORTHPORT.DOMAIN.EXT
"DATA",396.195,115,0)
OKLAHOMA CITY located in OKLAHOMA CITY, OKLAHOMA^OKLAHOMA^OKLAHOMA.DOMAIN.EXT
"DATA",396.195,116,0)
OMAHA located in OHAHA, NEBRASKA^NEBRASKA^CENTRAL-PLAINS.DOMAIN.EXT
"DATA",396.195,117,0)
ORLANDO VAMC located in ORLANDO, FLORIDA^FLORIDA^ORLANDO.DOMAIN.EXT
"DATA",396.195,118,0)
PALO ALTO HCS located in PALO ALTO, CALIFORNIA^CALIFORNIA^PALO-ALTO.DOMAIN.EXT
"DATA",396.195,119,0)
PERRY POINT located in BALTIMORE, MARYLAND^MARYLAND^BALTIMORE.DOMAIN.EXT
"DATA",396.195,120,0)
PHILADELPHIA located in PHILADELPHIA, PENNSYLVANIA^PENNSYLVANIA^PHILADELPHIA.DOMAIN.EXT
"DATA",396.195,121,0)
PHOENIX located in PHOENIX, ARIZONA^ARIZONA^PHOENIX.DOMAIN.EXT
"DATA",396.195,122,0)
PITTSBURGH HCS located in PITTSBURTH, PENNSYLVANIA^PENNSYLVANIA^PITTSBURGH.DOMAIN.EXT
"DATA",396.195,123,0)
POPLAR BLUFF located in ST. LOUIS, MISSOURI^MISSOURI^ST-LOUIS.DOMAIN.EXT
"DATA",396.195,124,0)
PORTLAND located in PORTLAND, OREGON^OREGON^PORTLAND.DOMAIN.EXT
"DATA",396.195,125,0)
PRESCOTT located in PRESCOTT, ARIZONA^ARIZONA^PRESCOTT.DOMAIN.EXT
"DATA",396.195,126,0)
PROVIDENCE located in PROVIDENCE, RHODE ISLAND^RHODE ISLAND^PROVIDENCE.DOMAIN.EXT
"DATA",396.195,127,0)
PUGET SOUND HCS/SEATTLE located in SEATTLE, WASHINGTON^WASHINGTON^PUGET-SOUND.DOMAIN.EXT
"DATA",396.195,128,0)
RENO VAMROC located in RENO, NEVADA^NEVADA^RENO.DOMAIN.EXT
"DATA",396.195,129,0)
RICHMOND located in RICHMOND, VIRGINIA^VIRGINIA^RICHMOND.DOMAIN.EXT
"DATA",396.195,130,0)
ROSEBURG HCS located in ROSEBURG, OREGON^OREGON^ROSEBURG.DOMAIN.EXT
"DATA",396.195,131,0)
SACRAMENTO located in MARTINEZ, CALIFORNIA^CALIFORNIA^MARTINEZ.DOMAIN.EXT
"DATA",396.195,132,0)
SAGINAW located in SAGINAW, MICHIGAN^MICHIGAN^SAGINAW.DOMAIN.EXT
"DATA",396.195,133,0)
SALEM located in SALEM, VIRGINIA^VIRGINIA^SALEM.DOMAIN.EXT
"DATA",396.195,134,0)
SALISBURY located in SALISBURY, NORTH CAROLINA^NORTH CAROLINA^SALISBURY.DOMAIN.EXT
"DATA",396.195,135,0)
SALT LAKE located in SALT LAKE CITY, UTAH^UTAH^SALT-LAKE.DOMAIN.EXT
"DATA",396.195,136,0)
SAN ANTONIO located in SAN ANTONIO, TEXAS^TEXAS^SAN-ANTONIO.DOMAIN.EXT
"DATA",396.195,137,0)
SAN DIEGO HCS located in SAN DIEGO, CALIFORNIA^CALIFORNIA^SAN-DIEGO.DOMAIN.EXT
"DATA",396.195,138,0)
SAN FRANCISCO located in SAN FRANCISCO, CALIFORNIA^CALIFORNIA^SANFRANCISCO.DOMAIN.EXT
"DATA",396.195,139,0)
SAN JUAN located in SAN JUAN, PUERTO RICO^PUERTO RICO^SAN-JUAN.DOMAIN.EXT
"DATA",396.195,140,0)
SEATTLE/PUGET SOUND located in SEATTLE, WASHINGTON^WASHINGTON^PUGET-SOUND.DOMAIN.EXT
"DATA",396.195,141,0)
SEPULVEDA AMBULATORY CARE CENTER located in LOS ANGELES, CALIFORNIA^CALIFORNIA^WEST-LA.DOMAIN.EXT
"DATA",396.195,142,0)
SHERIDAN located in SHERIDAN, WYOMING^WYOMING^SHERIDAN.DOMAIN.EXT
"DATA",396.195,143,0)
SHREVEPORT located in SHREVEPORT, LOUISIANA^LOUISIANA^SHREVEPORT.DOMAIN.EXT
"DATA",396.195,144,0)
SIERRA NEVADA HCS located in RENO, NEVADA^NEVADA^RENO.DOMAIN.EXT
"DATA",396.195,145,0)
SIOUX FALLS VAMROC located in SIOUS FALLS, SOUTH DAKOTA^SOUTH DAKOTA^SIOUX-FALLS.DOMAIN.EXT
"DATA",396.195,146,0)
SPOKANE located in SPOKANE, WASHINGTON^WASHINGTON^SPOKANE.DOMAIN.EXT
"DATA",396.195,147,0)
ST. CLOUD located in ST. CLOUD, MINNESOTA^MINNESOTA^ST-CLOUD.DOMAIN.EXT
"DATA",396.195,148,0)
ST. LOUIS located in ST. LOUIS, MISSOURI^MISSOURI^ST-LOUIS.DOMAIN.EXT
"DATA",396.195,149,0)
SYRACUSE located in ALBANY, NEW YORK^NEW YORK^SYRACUSE.DOMAIN.EXT
"DATA",396.195,150,0)
TAMPA located in TAMPA, FLORIDA^FLORIDA^TAMPA.DOMAIN.EXT
"DATA",396.195,151,0)
TEMPLE located in TEMPLE, TEXAS^TEXAS^CENTRAL-TEXAS.DOMAIN.EXT
"DATA",396.195,152,0)
TENNESSEE VALLEY located in NASHVILLE, TENNESSEE^TENNESSEE^TENNESSEEVALLEY.DOMAIN.EXT
"DATA",396.195,153,0)
TEXAS VALLEY COASTAL BEND located in HARLINGEN, TEXAS^TEXAS^VALLEYCOASTALBEND.DOMAIN.EXT
"DATA",396.195,154,0)
TOGUS VAMROC located in AUGUSTA, MAINE^MAINE^TOGUS.DOMAIN.EXT
"DATA",396.195,155,0)
TOMAH located in TOMAH, WISCONSIN^WISCONSIN^TOMAH.DOMAIN.EXT
"DATA",396.195,156,0)
TOPEKA located in KANSAS CITY, MISSOURI^MISSOURI^KANSAS-CITY.DOMAIN.EXT
"DATA",396.195,157,0)
TUCSON located in TUCSON, ARIZONA^ARIZONA^TUCSON.DOMAIN.EXT
"DATA",396.195,158,0)
TUSCALOOSA located in TUSCALOOSA, ALABAMA^ALABAMA^TUSCALOOSA.DOMAIN.EXT
"DATA",396.195,159,0)
TUSKEGEE located in MONTGOMERY, ALABAMA^ALABAMA^CENTRAL-ALABAMA.DOMAIN.EXT
"DATA",396.195,160,0)
UPSTATE NEW YORK HCS located in ALBANY, NEW YORK^NEW YORK^V02.DOMAIN.EXT
"DATA",396.195,161,0)
WALLA WALLA located in WALLA WALLA, WASHINGTON^WASHINGTON^WALLA-WALLA.DOMAIN.EXT
"DATA",396.195,162,0)
WASHINGTON located in WASHINGTON, DISTRICT OF COLUMBIA^DISTRICT OF COLUMBIA^WASHINGTON.DOMAIN.EXT
"DATA",396.195,163,0)
WEST HAVEN located in WEST HAVEN, CONNECTICUT^CONNECTICUT^WEST-HAVEN.DOMAIN.EXT
"DATA",396.195,164,0)
WEST LA VAMC located in LOS ANGELES, CALIFORNIA^CALIFORNIA^WEST-LA.DOMAIN.EXT
"DATA",396.195,165,0)
WEST PALM BEACH located in WEST PALM BEACH, FLORIDA^FLORIDA^WEST-PALM.DOMAIN.EXT
"DATA",396.195,166,0)
WHITE CITY located in WHITE CITY, OREGON^OREGON^WHITE-CITY.DOMAIN.EXT
"DATA",396.195,167,0)
WHITE RIVER JCT VAMROC located in WHITE RIVER JUNCTION, VERMONT^VERMONT^WHITE-RIVER.DOMAIN.EXT
"DATA",396.195,168,0)
WICHITA located in KANSAS CITY, MISSOURI^MISSOURI^KANSAS-CITY.DOMAIN.EXT
"DATA",396.195,169,0)
WILKES BARRE located in WILKES BARRE, PENNSYLVANIA^PENNSYLVANIA^WILKES-BARRE.DOMAIN.EXT
"DATA",396.195,170,0)
WILMINGTON VAMC located in WILMINGTON, DELAWARE^DELAWARE^WILMINGTON.DOMAIN.EXT
"DATA",396.33,1,0)
NEW^N
"DATA",396.33,2,0)
PENDING, REPORTED^P
"DATA",396.33,3,0)
PENDING, SCHEDULED^S
"DATA",396.33,4,0)
RELEASED TO RO, NOT PRINTED^R
"DATA",396.33,5,0)
COMPLETED, PRINTED BY RO^C
"DATA",396.33,6,0)
CANCELLED BY MAS^X
"DATA",396.33,7,0)
CANCELLED BY RO^RX
"DATA",396.33,8,0)
TRANSCRIBED^T
"DATA",396.33,9,0)
NEW, TRANSFERRED IN^NT
"DATA",396.33,10,0)
COMPLETED, TRANSFERRED OUT^CT
"DATA",396.33,11,0)
NEW, RE-ROUTED^NR
"DATA",396.33,12,0)
RE-ROUTED, REJECTED^RR
"DATA",396.33,13,0)
RE-ROUTED, ACCEPTED^RA
"DATA",396.33,14,0)
RE-ROUTED, PENDING ACCEPTANCE^RP
"DATA",396.33,15,0)
OPEN^O
"DATA",396.55,1,0)
INCORRECT JURISDICTION^A
"DATA",396.55,2,0)
VETERAN IS AN EMPLOYEE^A
"DATA",396.55,3,0)
VETERAN REQUEST/PREFERENCE^A
"DATA",396.55,4,0)
OTHER^A
"FIA",396.195)
CAPRI REROUTE SITE
"FIA",396.195,0)
^DVB(396.195,
"FIA",396.195,0,0)
396.195
"FIA",396.195,0,1)
y^y^f^^n^^y^o^n
"FIA",396.195,0,10)

"FIA",396.195,0,11)

"FIA",396.195,0,"RLRO")

"FIA",396.195,0,"VR")
2.7^DVBA
"FIA",396.195,396.195)
0
"FIA",396.3)
2507 REQUEST
"FIA",396.3,0)
^DVB(396.3,
"FIA",396.3,0,0)
396.3IP
"FIA",396.3,0,1)
y^n^p^^^^n^^n
"FIA",396.3,0,10)

"FIA",396.3,0,11)
 
"FIA",396.3,0,"RLRO")

"FIA",396.3,0,"VR")
2.7^DVBA
"FIA",396.3,396.3)
1
"FIA",396.3,396.3,17)
 
"FIA",396.3,396.3,35)

"FIA",396.3,396.34)
1
"FIA",396.3,396.34,.01)
 
"FIA",396.3,396.34,.02)
 
"FIA",396.3,396.34,1)
 
"FIA",396.3,396.34,2)
 
"FIA",396.3,396.34,3)
 
"FIA",396.3,396.34,4)
 
"FIA",396.3,396.34,5)
 
"FIA",396.3,396.34,6)

"FIA",396.3,396.34,7)
 
"FIA",396.3,396.34,8)
 
"FIA",396.3,396.34,9)
 
"FIA",396.3,396.34,10)
 
"FIA",396.3,396.34,11)
 
"FIA",396.3,396.34,12)
 
"FIA",396.3,396.341)
1
"FIA",396.3,396.341,.01)
 
"FIA",396.3,396.341,1)
 
"FIA",396.3,396.341,2)
 
"FIA",396.33)
2507 STATUS
"FIA",396.33,0)
^DVB(396.33,
"FIA",396.33,0,0)
396.33I
"FIA",396.33,0,1)
y^y^f^^y^^y^o^n
"FIA",396.33,0,10)

"FIA",396.33,0,11)

"FIA",396.33,0,"RLRO")

"FIA",396.33,0,"VR")
2.7^DVBA
"FIA",396.33,396.33)
0
"FIA",396.55)
2507 REROUTE CODE
"FIA",396.55,0)
^DVB(396.55,
"FIA",396.55,0,0)
396.55
"FIA",396.55,0,1)
y^y^f^^y^^y^o^n
"FIA",396.55,0,10)

"FIA",396.55,0,11)

"FIA",396.55,0,"RLRO")

"FIA",396.55,0,"VR")
2.7^DVBA
"FIA",396.55,396.55)
0
"INIT")
DVBC193P
"KRN",3.6,236,-1)
0^1
"KRN",3.6,236,0)
DVBA CAPRI REROUTE^CAPRI 2507 EXAM REQUEST REJECTED
"KRN",3.6,236,3,0)
^^2^2^3161108^
"KRN",3.6,236,3,1,0)
This message is sent to DVBA C 2507 REROUTE mail group when a 2507 Exam 
"KRN",3.6,236,3,2,0)
Request is rejected.
"KRN",3.8,465,-1)
0^1
"KRN",3.8,465,0)
DVBA C 2507 REROUTE^PU^^^^^
"KRN",3.8,465,2,0)
^3.801^1^1^3170525^^^^
"KRN",3.8,465,2,1,0)
This MAIL GROUP is to receive 2507 Request Reroute information.
"KRN",3.8,465,3)

"KRN",3.8,465,5,0)
^3.811P
"KRN",19,9510,-1)
0^1
"KRN",19,9510,0)
DVBA CAPRI GUI^Capri GUI (Broker)^^B^^^^^^^^AUTOMATED MED INFO EXCHANGE^^1
"KRN",19,9510,1,0)
^19.06^2^2^3170222^^^^
"KRN",19,9510,1,1,0)
This is the 'B' type option used by CAPRI GUI client application. It
"KRN",19,9510,1,2,0)
contains all the RPCs used by the CAPRI GUI application.
"KRN",19,9510,20)
 
"KRN",19,9510,25)
 
"KRN",19,9510,99.1)
64875,28290
"KRN",19,9510,"RPC",0)
^19.05P^174^169
"KRN",19,9510,"RPC",1,0)
DVBAB REPORT LISTS
"KRN",19,9510,"RPC",2,0)
DVBAB APPOINTMENT LIST
"KRN",19,9510,"RPC",3,0)
DVBAB CHECK CREDENTIALS
"KRN",19,9510,"RPC",4,0)
DVBAB FIND EXAMS
"KRN",19,9510,"RPC",5,0)
DVBAB PTINQ
"KRN",19,9510,"RPC",6,0)
DVBAB INCREASE EXAM COUNT
"KRN",19,9510,"RPC",7,0)
DVBAB SEND MSG
"KRN",19,9510,"RPC",8,0)
DVBAB REPORT CHECKLIST
"KRN",19,9510,"RPC",9,0)
DDR FILER
"KRN",19,9510,"RPC",10,0)
DDR LISTER
"KRN",19,9510,"RPC",11,0)
DDR VALIDATOR
"KRN",19,9510,"RPC",12,0)
DDR GETS ENTRY DATA
"KRN",19,9510,"RPC",14,0)
XWB GET VARIABLE VALUE
"KRN",19,9510,"RPC",15,0)
DVBAB HEALTH SUMMARY TEXT
"KRN",19,9510,"RPC",16,0)
TIU DOCUMENTS BY CONTEXT
"KRN",19,9510,"RPC",17,0)
TIU GET RECORD TEXT
"KRN",19,9510,"RPC",18,0)
ORQQCN LIST
"KRN",19,9510,"RPC",19,0)
ORQQCN DETAIL
"KRN",19,9510,"RPC",20,0)
DVBAB INST LIST
"KRN",19,9510,"RPC",22,0)
ORWRP REPORT TEXT
"KRN",19,9510,"RPC",23,0)
ORWORR AGET
"KRN",19,9510,"RPC",24,0)
ORWRA IMAGING EXAMS
"KRN",19,9510,"RPC",25,0)
ORWRP1 LISTNUTR
"KRN",19,9510,"RPC",26,0)
ORWMC PATIENT PROCEDURES
"KRN",19,9510,"RPC",27,0)
ORQQPL PROBLEM LIST
"KRN",19,9510,"RPC",28,0)
ORWORR GET4LST
"KRN",19,9510,"RPC",29,0)
ORWLR CUMULATIVE REPORT
"KRN",19,9510,"RPC",32,0)
DVBAB DATETIME
"KRN",19,9510,"RPC",34,0)
ORWPT ADMITLST
"KRN",19,9510,"RPC",35,0)
DVBAB SC VETERAN REPORT
"KRN",19,9510,"RPC",36,0)
ORQQVS VISITS/APPTS
"KRN",19,9510,"RPC",37,0)
ORWU DT
"KRN",19,9510,"RPC",38,0)
ORWLRR CHART
"KRN",19,9510,"RPC",39,0)
DG SENSITIVE RECORD ACCESS
"KRN",19,9510,"RPC",40,0)
DG SENSITIVE RECORD BULLETIN
"KRN",19,9510,"RPC",41,0)
DVBAB REPORT EXAM CHKLIST
"KRN",19,9510,"RPC",42,0)
DVBAB REPORT ADMINQ
"KRN",19,9510,"RPC",43,0)
DVBAB REPORT INCOMPVET
"KRN",19,9510,"RPC",44,0)
DVBAB REPORT DISCHARGE
"KRN",19,9510,"RPC",45,0)
DVBAB REPORT READMIT
"KRN",19,9510,"RPC",46,0)
DVBAB REPORT ADMISSIONS
"KRN",19,9510,"RPC",47,0)
DVBAB REPORT 7131INQ
"KRN",19,9510,"RPC",48,0)
DVBAB PENDING C&P REPORT
"KRN",19,9510,"RPC",49,0)
DVBAB REPORT CPDETAILS
"KRN",19,9510,"RPC",50,0)
DVBAB AMIS REPORT
"KRN",19,9510,"RPC",51,0)
DVBAB REPORT PENDING7131
"KRN",19,9510,"RPC",52,0)
DVBAB LABLIST
"KRN",19,9510,"RPC",53,0)
DVBAB VERSION
"KRN",19,9510,"RPC",54,0)
DDR DELETE ENTRY
"KRN",19,9510,"RPC",55,0)
ORWRP REPORT LISTS
"KRN",19,9510,"RPC",57,0)
DVBAB DIVISION
"KRN",19,9510,"RPC",58,0)
DVBAB TEAM PATIENTS
"KRN",19,9510,"RPC",59,0)
ORWCIRN FACLIST
"KRN",19,9510,"RPC",60,0)
XWB REMOTE STATUS CHECK
"KRN",19,9510,"RPC",61,0)
XWB REMOTE GETDATA
"KRN",19,9510,"RPC",63,0)
ORWPT DIEDON
"KRN",19,9510,"RPC",66,0)
XWB REMOTE RPC
"KRN",19,9510,"RPC",68,0)
DDR FIND1
"KRN",19,9510,"RPC",69,0)
DVBAB REPORTS
"KRN",19,9510,"RPC",70,0)
ORWRP2 COMPABV
"KRN",19,9510,"RPC",71,0)
DVBAB SURGERY CASE
"KRN",19,9510,"RPC",72,0)
ORWRP2 COMPDISP
"KRN",19,9510,"RPC",73,0)
ORWRP2 HS COMPONENTS
"KRN",19,9510,"RPC",74,0)
ORWRP2 HS COMPONENT SUBS
"KRN",19,9510,"RPC",75,0)
ORWRP2 HS COMP FILES
"KRN",19,9510,"RPC",76,0)
ORWRP2 SAVLKUP
"KRN",19,9510,"RPC",77,0)
ORWRP2 HS REPORT TEXT
"KRN",19,9510,"RPC",78,0)
ORWRP2 GETLKUP
"KRN",19,9510,"RPC",79,0)
ORWRP2 HS FILE LOOKUP
"KRN",19,9510,"RPC",80,0)
ORWRP2 HS SUBITEMS
"KRN",19,9510,"RPC",81,0)
DVBAB MAIL INIT
"KRN",19,9510,"RPC",82,0)
ORWLRR MICRO
"KRN",19,9510,"RPC",83,0)
TIU CREATE RECORD
"KRN",19,9510,"RPC",84,0)
DVBAB MPI ASSIGN ICN
"KRN",19,9510,"RPC",85,0)
TIU SIGN RECORD
"KRN",19,9510,"RPC",86,0)
TIU DELETE RECORD
"KRN",19,9510,"RPC",87,0)
TIU REQUIRES COSIGNATURE
"KRN",19,9510,"RPC",88,0)
DVBAB REPORT ADMISSION INQUIRY
"KRN",19,9510,"RPC",89,0)
DVBAB REPORT NEW NOTICES DC
"KRN",19,9510,"RPC",90,0)
DVBAB NOTE TITLES
"KRN",19,9510,"RPC",91,0)
DVBAB TEMPLATE DEFINITION
"KRN",19,9510,"RPC",92,0)
DDR FINDER
"KRN",19,9510,"RPC",93,0)
ORWCV VST
"KRN",19,9510,"RPC",94,0)
TIU LOAD BOILERPLATE TEXT
"KRN",19,9510,"RPC",95,0)
DVBAB GET VISIT INFO
"KRN",19,9510,"RPC",96,0)
DVBAB REPORT SPECIAL
"KRN",19,9510,"RPC",97,0)
DVBAB SAVE FORM
"KRN",19,9510,"RPC",98,0)
DVBAB EXAMS BY DATE
"KRN",19,9510,"RPC",99,0)
TIU GET SITE PARAMETERS
"KRN",19,9510,"RPC",100,0)
TIU GET ALERT INFO
"KRN",19,9510,"RPC",101,0)
ORWU VALIDSIG
"KRN",19,9510,"RPC",103,0)
ORWORB FASTUSER
"KRN",19,9510,"RPC",104,0)
DVBAB TEMPLATE LIST
"KRN",19,9510,"RPC",105,0)
DVBAB LOAD FORM
"KRN",19,9510,"RPC",106,0)
DVBAB TEMPLATE REPORT FULL
"KRN",19,9510,"RPC",107,0)
DVBAB FETCH 1U4N
"KRN",19,9510,"RPC",108,0)
DVBAB FORM DATA BACKUP DELETE
"KRN",19,9510,"RPC",109,0)
DVBAB FORM DATA BACKUP RESTORE
"KRN",19,9510,"RPC",110,0)
DDR LOCK/UNLOCK NODE
"KRN",19,9510,"RPC",111,0)
DVBAB FORM COPY
"KRN",19,9510,"RPC",112,0)
DVBAB FIND DUPS
"KRN",19,9510,"RPC",113,0)
DVBAB NEW PERSON FILE
"KRN",19,9510,"RPC",114,0)
DVBAB FORM DATA BACKUP
"KRN",19,9510,"RPC",116,0)
DVBAB SET DIVISION
"KRN",19,9510,"RPC",117,0)
DVBAB GET URL
"KRN",19,9510,"RPC",118,0)
ORPRF TRIGGER POPUP
"KRN",19,9510,"RPC",119,0)
ORPRF HASFLG
"KRN",19,9510,"RPC",120,0)
ORPRF HASCAT1
"KRN",19,9510,"RPC",121,0)
ORPRF GETFLG
"KRN",19,9510,"RPC",122,0)
ORPRF CLEAR
"KRN",19,9510,"RPC",123,0)
TIU SET DOCUMENT TEXT
"KRN",19,9510,"RPC",124,0)
DVBAB ORIGINAL PROCESSING DATE
"KRN",19,9510,"RPC",125,0)
TIU CREATE ADDENDUM RECORD
"KRN",19,9510,"RPC",126,0)
TIU UPDATE RECORD
"KRN",19,9510,"RPC",128,0)
XUS SET VISITOR
"KRN",19,9510,"RPC",129,0)
XUS GET VISITOR
"KRN",19,9510,"RPC",130,0)
DVBAB RESTRICTED LIST PATIENTS
"KRN",19,9510,"RPC",131,0)
DVBAB DOD INFO
"KRN",19,9510,"RPC",132,0)
DVBAB DOD REPORT
"KRN",19,9510,"RPC",133,0)
DVBAB DOD REPORT TYPES
"KRN",19,9510,"RPC",134,0)
DVBAB FIND DFN BY ICN
"KRN",19,9510,"RPC",135,0)
DVBAB CCOW
"KRN",19,9510,"RPC",136,0)
DVBAB ZIP2CITY
"KRN",19,9510,"RPC",137,0)
DVBA CHECK PATCH
"KRN",19,9510,"RPC",138,0)
DVBAB GET SET
"KRN",19,9510,"RPC",139,0)
DVBAB GET VVA TOKEN
"KRN",19,9510,"RPC",140,0)
VAFCTFU CONVERT ICN TO DFN
"KRN",19,9510,"RPC",141,0)
DVBAB 8861 NOTIFICATIONS
"KRN",19,9510,"RPC",142,0)
DVBA MVI GET CORRESPONDING IDS
"KRN",19,9510,"RPC",143,0)
DVBA MVI SEARCH PERSON
"KRN",19,9510,"RPC",144,0)
DVBAB SEND MSG TWO
"KRN",19,9510,"RPC",145,0)
DVBAD CONTRACTED EXAM REPORTS
"KRN",19,9510,"RPC",146,0)
DVBAD CONTRACTED EXAM CRYPTO
"KRN",19,9510,"RPC",147,0)
DVBA CAPRI GET EXAM IEN
"KRN",19,9510,"RPC",148,0)
DVBA CAPRI EXAM LINK TIU
"KRN",19,9510,"RPC",149,0)
DVBA CAPRI EXAM XML
"KRN",19,9510,"RPC",150,0)
DVBA CAPRI SEND REROUTE
"KRN",19,9510,"RPC",151,0)
DVBA CAPRI REROUTE STATUS
"KRN",19,9510,"RPC",152,0)
DVBA CAPRI REROUTE INFO
"KRN",19,9510,"RPC",153,0)
DVBA CAPRI GET REROUTE
"KRN",19,9510,"RPC",154,0)
DVBA CAPRI GET DIVISION
"KRN",19,9510,"RPC",155,0)
DVBA CAPRI GET DIV EXAM
"KRN",19,9510,"RPC",156,0)
DVBA CAPRI GETSPCLCONSID
"KRN",19,9510,"RPC",157,0)
DVBA CAPRI GET DIV COMMENT
"KRN",19,9510,"RPC",158,0)
DVBA CAPRI GET REROUTE CODE
"KRN",19,9510,"RPC",159,0)
DVBA CAPRI REROUTE VAMC
"KRN",19,9510,"RPC",160,0)
DVBA CAPRI LISTCLAIMTYPE
"KRN",19,9510,"RPC",161,0)
DVBA CAPRI SETCLAIMTYPE
"KRN",19,9510,"RPC",162,0)
DVBA CAPRI GETCONTREMARKS
"KRN",19,9510,"RPC",163,0)
DVBA CAPRI SETCONTREMARKS
"KRN",19,9510,"RPC",164,0)
XWB DIRECT RPC
"KRN",19,9510,"RPC",165,0)
DVBA CAPRI GETCLAIMTYPE
"KRN",19,9510,"RPC",166,0)
DVBA CAPRI LISTSPCLCONSID
"KRN",19,9510,"RPC",167,0)
DVBA CAPRI SETSPCLCONSID
"KRN",19,9510,"RPC",168,0)
DVBA CAPRI GETCANCELREASON
"KRN",19,9510,"RPC",174,0)
DVBA CAPRI LISTINSUFRSN
"KRN",19,9510,"U")
CAPRI GUI (BROKER)
"KRN",19.1,650,-1)
0^1
"KRN",19.1,650,0)
DVBA CAPRI REROUTEREASONS^ACTIVE/INACTIVE REROUTE REASON^^n
"KRN",19.1,650,1,0)
^^3^3^3160825^
"KRN",19.1,650,1,1,0)
This key will allow users the ability to add/inactivate/activate the list 
"KRN",19.1,650,1,2,0)
of reasons within the CAPRI exam cancellation window. The VHA Office of
"KRN",19.1,650,1,3,0)
Disability and Medical Assessment should designate who gets this key.
"KRN",8989.5,1561,0)
223;DIC(9.4,^DVBAB CAPRI MINIMUM VERSION^1
"KRN",8989.5,1561,1)
GUI V2.7*193*1*A
"KRN",8989.51,491,-1)
0^1
"KRN",8989.51,491,0)
DVBAB CAPRI MINIMUM VERSION^CAPRI minimum server version^0^^^0
"KRN",8989.51,491,1)
F^^This is the current minimum CAPRI GUI version
"KRN",8989.51,491,20,0)
^^2^2^3091008^
"KRN",8989.51,491,20,1,0)
This parameter contains the minimum CAPRI GUI version that is compatible 
"KRN",8989.51,491,20,2,0)
with the server version.  Format: CAPRI GUIv2.7*123*1*A*NOOLD
"KRN",8989.51,491,30,0)
^8989.513I^1^1
"KRN",8989.51,491,30,1,0)
1^9.4
"KRN",8994,3295,-1)
0^4
"KRN",8994,3295,0)
DVBA CAPRI GET REROUTE^REROST^DVBCUTL8^1^S^0^^^1
"KRN",8994,3295,1,0)
^^2^2^3160516^
"KRN",8994,3295,1,1,0)
This RPC will return 1 if the Request is able to be rerouted or return 0 
"KRN",8994,3295,1,2,0)
if the Request can not be rerouted.
"KRN",8994,3295,2,0)
^8994.02A^1^1
"KRN",8994,3295,2,1,0)
RSP^1^15^1
"KRN",8994,3295,2,1,1,0)
0
"KRN",8994,3295,2,"B","RSP",1)

"KRN",8994,3297,-1)
0^8
"KRN",8994,3297,0)
DVBA CAPRI REROUTE VAMC^GETFAC^DVBACRVA^2^S^0^^0^1
"KRN",8994,3297,1,0)
^8994.01^2^2^3160711^^^^
"KRN",8994,3297,1,1,0)
VA FACALITIY NAMES AND STATES ARE RETURNED FOR ALL ENTERIES ON FILE.   WILL BE RE
"KRN",8994,3297,1,2,0)
WILL BE RETURNED IN SPECIFIED SORT ORDER.
"KRN",8994,3297,2,0)
^8994.02A^1^1
"KRN",8994,3297,2,1,0)
SORTBY^1^255^1^
"KRN",8994,3297,2,1,1,0)
^8994.021^2^2^3160711^^^^
"KRN",8994,3297,2,1,1,1,0)
THIS INPUT PARAMETER DETERMINES THE ORDER THE FACILITY LIST WILL BE RETURNED 
"KRN",8994,3297,2,1,1,2,0)
RETURNED, EITHER BY STATE OR NAME.
"KRN",8994,3297,2,"B","SORTBY",1)

"KRN",8994,3298,-1)
0^3
"KRN",8994,3298,0)
DVBA CAPRI GET DIVISION^CDIV^DVBCUTL8^2^S^0^^^1
"KRN",8994,3298,1,0)
^8994.01^1^1^3160707^
"KRN",8994,3298,1,1,0)
This RPC will return all of the active division for this site.
"KRN",8994,3298,3,0)
^^1^1^3160707^
"KRN",8994,3298,3,1,0)
Division Name ^ IEN
"KRN",8994,3299,-1)
0^1
"KRN",8994,3299,0)
DVBA CAPRI GET DIV COMMENT^CDIVC^DVBCUTL8^2^S^0^^^1
"KRN",8994,3299,1,0)
^8994.01^1^1^3160714^^^^
"KRN",8994,3299,1,1,0)
This RPC will return the Comment for the selected Division. 
"KRN",8994,3299,2,0)
^8994.02A^1^1
"KRN",8994,3299,2,1,0)
DIV^1^6^1
"KRN",8994,3299,2,1,1,0)
^8994.021^1^1^3160714^^^^
"KRN",8994,3299,2,1,1,1,0)
IEN for file 396.15
"KRN",8994,3299,2,"B","DIV",1)

"KRN",8994,3300,-1)
0^2
"KRN",8994,3300,0)
DVBA CAPRI GET DIV EXAM^CDIVE^DVBCUTL8^2^S^0^^^1
"KRN",8994,3300,1,0)
^8994.01^1^1^3160707^
"KRN",8994,3300,1,1,0)
This RPC will return a the Default List of active exams.
"KRN",8994,3300,2,0)
^8994.02A^1^1
"KRN",8994,3300,2,1,0)
DIV^1^1^1
"KRN",8994,3300,2,1,1,0)
^^1^1^3160707^
"KRN",8994,3300,2,1,1,1,0)
IEN for file 396.15
"KRN",8994,3300,2,"B","DIV",1)

"KRN",8994,3301,-1)
0^5
"KRN",8994,3301,0)
DVBA CAPRI GET REROUTE CODE^ARC^DVBCUTL8^2^S^0^^^1
"KRN",8994,3301,1,0)
^^1^1^3160730^
"KRN",8994,3301,1,1,0)
This RPC returns the active Reroute Code from file #396.55
"KRN",8994,3301,3,0)
0
"KRN",8994,3302,-1)
0^9
"KRN",8994,3302,0)
DVBA CAPRI SEND REROUTE^EN^DVBCXFR1^1^S^0^^^1
"KRN",8994,3302,1,0)
^8994.01^1^1^3160803^^
"KRN",8994,3302,1,1,0)
This RPC reroute a 2507 C&P Request to another VAMC facility.
"KRN",8994,3302,2,0)
^8994.02A^7^7
"KRN",8994,3302,2,1,0)
2507 Request IEN^1^10^1^1
"KRN",8994,3302,2,2,0)
Station Number^1^10^1^2
"KRN",8994,3302,2,2,1,0)
^^1^1^3160803^
"KRN",8994,3302,2,2,1,1,0)
This is the IEN for the Institution File ^DIV(4.
"KRN",8994,3302,2,3,0)
Patient IEN^1^15^1^3
"KRN",8994,3302,2,4,0)
Routing Location^1^10^1^4
"KRN",8994,3302,2,4,1,0)
^^1^1^3160803^
"KRN",8994,3302,2,4,1,1,0)
This is the pointer to the DIVISION file #40.8
"KRN",8994,3302,2,5,0)
REROUTE REASON^1^9^1^5
"KRN",8994,3302,2,5,1,0)
^^1^1^3160803^
"KRN",8994,3302,2,5,1,1,0)
This is the IEN to the REROUTE CODE FIEL #396.55
"KRN",8994,3302,2,6,0)
REROUTE DISCRIPTION^1^30^1^7
"KRN",8994,3302,2,7,0)
Rerout Description
"KRN",8994,3302,2,"B","2507 Request IEN",1)

"KRN",8994,3302,2,"B","Patient IEN",3)

"KRN",8994,3302,2,"B","REROUTE DISCRIPTION",6)

"KRN",8994,3302,2,"B","REROUTE REASON",5)

"KRN",8994,3302,2,"B","Rerout Description",7)

"KRN",8994,3302,2,"B","Routing Location",4)

"KRN",8994,3302,2,"B","Station Number",2)

"KRN",8994,3302,2,"PARAMSEQ",1,1)

"KRN",8994,3302,2,"PARAMSEQ",2,2)

"KRN",8994,3302,2,"PARAMSEQ",3,3)

"KRN",8994,3302,2,"PARAMSEQ",4,4)

"KRN",8994,3302,2,"PARAMSEQ",5,5)

"KRN",8994,3302,2,"PARAMSEQ",7,6)

"KRN",8994,3303,-1)
0^6
"KRN",8994,3303,0)
DVBA CAPRI REROUTE INFO^RINFO^DVBCUTL8^2^S^0^^^1
"KRN",8994,3303,2,0)
^8994.02A^1^1
"KRN",8994,3303,2,1,0)
REQUEST IEN^1^12^1^1
"KRN",8994,3303,2,"B","REQUEST IEN",1)

"KRN",8994,3303,2,"PARAMSEQ",1,1)

"KRN",8994,3304,-1)
0^7
"KRN",8994,3304,0)
DVBA CAPRI REROUTE STATUS^RPRO^DVBCUTL8^1^S^0^^^1
"KRN",8994,3304,1,0)
^^1^1^3160808^
"KRN",8994,3304,1,1,0)
This RPC updates the status of the rerouted 2507 Request
"KRN",8994,3304,2,0)
^8994.02A^3^3
"KRN",8994,3304,2,1,0)
RIEN^1^9^1^1
"KRN",8994,3304,2,1,1,0)
^^1^1^3160808^
"KRN",8994,3304,2,1,1,1,0)
The IEN for the 2507 Request that was rerouted
"KRN",8994,3304,2,2,0)
RRSTA^1^4^1^2
"KRN",8994,3304,2,2,1,0)
^^1^1^3160808^
"KRN",8994,3304,2,2,1,1,0)
The Reroute Status - pointer to 2507 Status file
"KRN",8994,3304,2,3,0)
REJR^1^40^0^3
"KRN",8994,3304,2,3,1,0)
^^1^1^3160808^
"KRN",8994,3304,2,3,1,1,0)
Reject Reason if the reroute request is rejected.
"KRN",8994,3304,2,"B","REJR",3)

"KRN",8994,3304,2,"B","RIEN",1)

"KRN",8994,3304,2,"B","RRSTA",2)

"KRN",8994,3304,2,"PARAMSEQ",1,1)

"KRN",8994,3304,2,"PARAMSEQ",2,2)

"KRN",8994,3304,2,"PARAMSEQ",3,3)

"MBREQ")
0
"ORD",2,3.6)
3.6;2;1;;BUL^XPDTA1;;BULE1^XPDIA1;;;BULDEL^XPDIA1
"ORD",2,3.6,0)
BULLETIN
"ORD",3,19.1)
19.1;3;;;KEY^XPDTA1;KEYF1^XPDIA1;KEYE1^XPDIA1;KEYF2^XPDIA1;;KEYDEL^XPDIA1
"ORD",3,19.1,0)
SECURITY KEY
"ORD",11,3.8)
3.8;11;;;MAILG^XPDTA1;MAILGF1^XPDIA1;MAILGE1^XPDIA1;MAILGF2^XPDIA1;;MAILGDEL^XPDIA1(%)
"ORD",11,3.8,0)
MAIL GROUP
"ORD",16,8994)
8994;16;1;;;;;;;RPCDEL^XPDIA1
"ORD",16,8994,0)
REMOTE PROCEDURE
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"ORD",20,8989.51)
8989.51;20;;;PAR1E1^XPDTA2;PAR1F1^XPDIA3;PAR1E1^XPDIA3;PAR1F2^XPDIA3;;PAR1DEL^XPDIA3(%)
"ORD",20,8989.51,0)
PARAMETER DEFINITION
"PKG",223,-1)
1^1
"PKG",223,0)
AUTOMATED MED INFO EXCHANGE^DVBA^The entire AMIE package 7131/2507.
"PKG",223,20,0)
^9.402P^^
"PKG",223,22,0)
^9.49I^1^1
"PKG",223,22,1,0)
2.7^2950410^3010328
"PKG",223,22,1,"PAH",1,0)
193^3180824^123458832
"PKG",223,22,1,"PAH",1,1,0)
^^2^2^3180824
"PKG",223,22,1,"PAH",1,1,1,0)
 
"PKG",223,22,1,"PAH",1,1,2,0)
See FORUM patch DVBA*2.7*193 for a description of this patch.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
53
"RTN","DVBAALRT")
0^37^B1094180^B1094381
"RTN","DVBAALRT",1,0)
DVBAALRT ;ALB/THM-ALERT RO REPORTS THAT ARE READY ; 1/16/91  7:11 AM
"RTN","DVBAALRT",2,0)
 ;;2.7;AMIE;**193**;Apr 10, 1995;Build 84
"RTN","DVBAALRT",3,0)
EN I '$D(IOF) D HOME^%ZIS
"RTN","DVBAALRT",4,0)
 D DUZ2^DVBAUTIL I $D(DVBAQUIT) K DVBAQUIT,DVBAD2 Q
"RTN","DVBAALRT",5,0)
 I $D(^DVB(396.2,"C",DVBAD2,"R")) W !!,*7,"You have new NOTICES OF DISCHARGE to print.",! H 2
"RTN","DVBAALRT",6,0)
 ;AJF;Request Status conversion
"RTN","DVBAALRT",7,0)
 I $D(^DVB(396.3,"AF",4,DUZ(2))) W !!,*7,"You have new C&P EXAM REPORTS to print.",! H 2
"RTN","DVBAALRT",8,0)
 I $D(^DVB(396,"AC",DVBAD2,"R")) W !!,*7,"You have new 21-DAY CERTIFICATES to print.",! H 2
"RTN","DVBAALRT",9,0)
 Q
"RTN","DVBAB1B")
0^56^B11312167^B11312167
"RTN","DVBAB1B",1,0)
DVBAB1B ;ALB/SPH - CAPRI UTILITIES ; 8/21/18 9:58am
"RTN","DVBAB1B",2,0)
 ;;2.7;AMIE;**104,143,193**;Apr 10, 1995;Build 84
"RTN","DVBAB1B",3,0)
 ;
"RTN","DVBAB1B",4,0)
DPA(LIST,DFN,CHOICE) ;Display Patient Appointments
"RTN","DVBAB1B",5,0)
 N DVBABCNT,CKCHOICE
"RTN","DVBAB1B",6,0)
 S LIST="",DVBABCNT=1,CKCHOICE="A,F,P",DFN=$G(DFN),CHOICE=$G(CHOICE) K ^TMP("DVBAAPPT",$J)
"RTN","DVBAB1B",7,0)
 I DFN="" S ^TMP("DVBAAPPT",$J,DUZ,DVBABCNT)="MISSING PATIENT NAME",LIST=$NA(^TMP("DVBAAPPT",$J,DUZ)) Q
"RTN","DVBAB1B",8,0)
 I CHOICE="" S ^TMP("DVBAAPPT",$J,DUZ,DVBABCNT)="MISSING ALL, PAST, OR FUTURE",LIST=$NA(^TMP("DVBAAPPT",$J,DUZ)) Q
"RTN","DVBAB1B",9,0)
 I CKCHOICE'[CHOICE S ^TMP("DVBAAPPT",$J,DUZ,DVBABCNT)="INVALID SELECTION",LIST=$NA(^TMP("DVBAAPPT",$J,DUZ)) Q
"RTN","DVBAB1B",10,0)
 I CHOICE["A" D
"RTN","DVBAB1B",11,0)
 .S SDT=0
"RTN","DVBAB1B",12,0)
 .S X="T+730" D ^%DT
"RTN","DVBAB1B",13,0)
 .I Y<0 S ^TMP("DVBAAPPT",$J,DUZ,DVBABCNT)="ERROR IN CALCULATING ENDING DATE RANGE",LIST=$NA(^TMP("DVBAAPPT",$J,DUZ))
"RTN","DVBAB1B",14,0)
 .S EDT=Y+.9
"RTN","DVBAB1B",15,0)
 I CHOICE["F" D
"RTN","DVBAB1B",16,0)
 .S X="T+1" D ^%DT
"RTN","DVBAB1B",17,0)
 .I Y<0 S ^TMP("DVBAAPPT",$J,DUZ,DVBABCNT)="ERROR IN CALCULATING START DATE RANGE",LIST=$NA(^TMP("DVBAAPPT",$J,DUZ))
"RTN","DVBAB1B",18,0)
 .S SDT=Y
"RTN","DVBAB1B",19,0)
 .K X,Y
"RTN","DVBAB1B",20,0)
 .S X="T+730" D ^%DT
"RTN","DVBAB1B",21,0)
 .I Y<0 S ^TMP("DVBAAPPT",$J,DUZ,DVBABCNT)="ERROR IN CALCULATING ENDING DATE RANGE",LIST=$NA(^TMP("DVBAAPPT",$J,DUZ))
"RTN","DVBAB1B",22,0)
 .S EDT=Y+.9
"RTN","DVBAB1B",23,0)
 I CHOICE["P" D
"RTN","DVBAB1B",24,0)
 .S X="T" D ^%DT
"RTN","DVBAB1B",25,0)
 .I Y<0 S ^TMP("DVBAAPPT",$J,DUZ,DVBABCNT)="ERROR IN CALCULATING ENDING DATE RANGE",LIST=$NA(^TMP("DVBAAPPT",$J,DUZ))
"RTN","DVBAB1B",26,0)
 .S EDT=Y+.9
"RTN","DVBAB1B",27,0)
 .K X,Y
"RTN","DVBAB1B",28,0)
 .S SDT=0
"RTN","DVBAB1B",29,0)
 Q:LIST["ERROR"
"RTN","DVBAB1B",30,0)
 I $O(^DPT(DFN,"S",SDT))'>0 S ^TMP("DVBAAPPT",$J,DUZ,DVBABCNT)="NO APPOINTMENTS FOUND FOR YOUR DATE RANGE",LIST=$NA(^TMP("DVBAAPPT",$J,DUZ)) Q
"RTN","DVBAB1B",31,0)
 F  S SDT=$O(^DPT(DFN,"S",SDT)) Q:'SDT!(SDT>EDT)  D
"RTN","DVBAB1B",32,0)
 .S CLN=$P(^DPT(DFN,"S",SDT,0),"^") Q:'CLN
"RTN","DVBAB1B",33,0)
 .Q:'$D(^SC(CLN,0))
"RTN","DVBAB1B",34,0)
 .S CLN=$P(^SC(CLN,0),"^")
"RTN","DVBAB1B",35,0)
 .S ZZ=$L(CLN)
"RTN","DVBAB1B",36,0)
 .I ZZ<31 D
"RTN","DVBAB1B",37,0)
 ..F ZZZ=ZZ:1:30 S CLN=CLN_" "
"RTN","DVBAB1B",38,0)
 .S Y=SDT X ^DD("DD")
"RTN","DVBAB1B",39,0)
 .S ZZ2=$L(Y)
"RTN","DVBAB1B",40,0)
 .I ZZ2<21 D
"RTN","DVBAB1B",41,0)
 ..F ZZZ2=ZZ2:1:20 S Y=Y_" "
"RTN","DVBAB1B",42,0)
 .S STATUS=$P(^DPT(DFN,"S",SDT,0),"^",2)
"RTN","DVBAB1B",43,0)
 .I STATUS'="" D
"RTN","DVBAB1B",44,0)
 ..I STATUS="N" S STATUS="NO-SHOW"
"RTN","DVBAB1B",45,0)
 ..I STATUS="C" S STATUS="CANCELLED BY CLINIC"
"RTN","DVBAB1B",46,0)
 ..I STATUS="CA" S STATUS="CANCELLED BY CLINIC & AUTO RE-BOOK"
"RTN","DVBAB1B",47,0)
 ..I STATUS="NA" S STATUS="NO-SHOW & AUTO-REBOOK"
"RTN","DVBAB1B",48,0)
 ..I STATUS="I" S STATUS="INPATIENT APPOINTMENT"
"RTN","DVBAB1B",49,0)
 ..I STATUS="PC" S STATUS="CANCELLED BY PATIENT"
"RTN","DVBAB1B",50,0)
 ..I STATUS="PCA" S STATUS="CANCELLED BY PATIENT & AUTO RE-BOOK"
"RTN","DVBAB1B",51,0)
 ..I STATUS="NT" S STATUS="NO ACTION TAKEN"
"RTN","DVBAB1B",52,0)
 . I $D(^DPT(DFN,"S",SDT,"R")) S REMARK=$P(^DPT(DFN,"S",SDT,"R"),"^",1) ;ADDED
"RTN","DVBAB1B",53,0)
 .S ^TMP("DVBAAPPT",$J,DUZ,DVBABCNT)=CLN_"  "_Y_" "_STATUS,DVBABCNT=DVBABCNT+1
"RTN","DVBAB1B",54,0)
 . I $D(REMARK) S ^TMP("DVBAAPPT",$J,DUZ,DVBABCNT)="   Cancellation Remarks: "_REMARK,DVBABCNT=DVBABCNT+1
"RTN","DVBAB1B",55,0)
 . I $D(REMARK) K REMARK
"RTN","DVBAB1B",56,0)
 .S LIST=$NA(^TMP("DVBAAPPT",$J,DUZ))
"RTN","DVBAB1B",57,0)
 K DFN,X,%DT,CLN,CHOICE,Y,SDT,EDT
"RTN","DVBAB1B",58,0)
 Q
"RTN","DVBAB1B",59,0)
 ;
"RTN","DVBAB1B",60,0)
CHECK(DVBRSLTS,DVBPATCH) ; Checks for KIDS Patch install
"RTN","DVBAB1B",61,0)
 ; RPC: DVBA CHECK PATCH
"RTN","DVBAB1B",62,0)
 ; Input:  DVBPATCH - Patch Number (i.e. DVBA*2.7*142)
"RTN","DVBAB1B",63,0)
 ; Output: Returns "1^Patch Is Installed" on success; 
"RTN","DVBAB1B",64,0)
 ;         otherwise returns "0^Patch Is Not Installed" 
"RTN","DVBAB1B",65,0)
 N DVBX
"RTN","DVBAB1B",66,0)
 S DVBX=$$PATCH^XPDUTL(DVBPATCH)
"RTN","DVBAB1B",67,0)
 S DVBRSLTS=$S(DVBX:"1^Patch Is Installed",1:"0^Patch Is Not Installed")
"RTN","DVBAB1B",68,0)
 Q
"RTN","DVBAB1C")
0^17^B26976785^n/a
"RTN","DVBAB1C",1,0)
DVBAB1C ;AJF - CAPRI UTILITIES ; 09/13/2016 3:52pm
"RTN","DVBAB1C",2,0)
 ;;2.7;AMIE;**193**;Apr 10, 1995;Build 84
"RTN","DVBAB1C",3,0)
 ;
"RTN","DVBAB1C",4,0)
 Q
"RTN","DVBAB1C",5,0)
 ;
"RTN","DVBAB1C",6,0)
MSG(RIEN) ;Generate mail message;AJF
"RTN","DVBAB1C",7,0)
 ;
"RTN","DVBAB1C",8,0)
 D GETREQ
"RTN","DVBAB1C",9,0)
 D MGUSR
"RTN","DVBAB1C",10,0)
 ;
"RTN","DVBAB1C",11,0)
 S XMSUB="CAPRI: 2507 Exam Request Rejected"
"RTN","DVBAB1C",12,0)
 S ^TMP($J,"AMIE1",1)="The 2507 Exam Request as described below has been rejected."
"RTN","DVBAB1C",13,0)
 S ^TMP($J,"AMIE1",2)=""
"RTN","DVBAB1C",14,0)
 S ^TMP($J,"AMIE1",3)=""
"RTN","DVBAB1C",15,0)
 S ^TMP($J,"AMIE1",4)="                 DFN:  `"_DVBADFN
"RTN","DVBAB1C",16,0)
 S ^TMP($J,"AMIE1",5)="          Requested Date: "_DVBADT
"RTN","DVBAB1C",17,0)
 S ^TMP($J,"AMIE1",6)="          Requested Site: "_RTF
"RTN","DVBAB1C",18,0)
 S ^TMP($J,"AMIE1",7)=""
"RTN","DVBAB1C",19,0)
 S ^TMP($J,"AMIE1",8)="          Rerouted Date: "_RDT
"RTN","DVBAB1C",20,0)
 S ^TMP($J,"AMIE1",9)="          Rerouted Site: "_RTO
"RTN","DVBAB1C",21,0)
 S ^TMP($J,"AMIE1",10)=""
"RTN","DVBAB1C",22,0)
 S ^TMP($J,"AMIE1",11)=""
"RTN","DVBAB1C",23,0)
 S ^TMP($J,"AMIE1",12)=""
"RTN","DVBAB1C",24,0)
 S ^TMP($J,"AMIE1",13)="**NOTE: To view the patient using the DFN, paste the DFN number into the CAPRI"
"RTN","DVBAB1C",25,0)
 S ^TMP($J,"AMIE1",14)="Patient Selector 'Patient ID' field to find the patient. Be sure to include"
"RTN","DVBAB1C",26,0)
 S ^TMP($J,"AMIE1",15)="the ` (backward-apostrophe) character."
"RTN","DVBAB1C",27,0)
 S ^TMP($J,"AMIE1",16)=""
"RTN","DVBAB1C",28,0)
 S ^TMP($J,"AMIE1",17)=""
"RTN","DVBAB1C",29,0)
 S ^TMP($J,"AMIE1",18)=""
"RTN","DVBAB1C",30,0)
 S ^TMP($J,"AMIE1",19)="*****This is an auto-generated email.  Do not respond to this email address.*****"
"RTN","DVBAB1C",31,0)
 S XMTEXT="^TMP($J,""AMIE1"","
"RTN","DVBAB1C",32,0)
 D ^XMD,END
"RTN","DVBAB1C",33,0)
 Q
"RTN","DVBAB1C",34,0)
 ;
"RTN","DVBAB1C",35,0)
 ;
"RTN","DVBAB1C",36,0)
FINDEXAM(ZMSG,ZIEN) ;Returns list of exams in 396.4 that are linked to ZIEN in 396.3
"RTN","DVBAB1C",37,0)
 N DVBABCNT,DVBABIEN
"RTN","DVBAB1C",38,0)
 S DVBABCNT=0,DVBABIEN=0
"RTN","DVBAB1C",39,0)
 F  S DVBABIEN=$O(^DVB(396.4,"C",ZIEN,DVBABIEN)) Q:'DVBABIEN  D
"RTN","DVBAB1C",40,0)
 .S DVBABD1=$P($G(^DVB(396.4,DVBABIEN,0)),"^",2)
"RTN","DVBAB1C",41,0)
 .S DVBABD2=$P($G(^DVB(396.6,+$P($G(^DVB(396.4,DVBABIEN,0)),"^",3),0)),"^",1)  ;Name of Exam
"RTN","DVBAB1C",42,0)
 .S DVBABD3=$P($G(^DVB(396.4,DVBABIEN,0)),"^",4)
"RTN","DVBAB1C",43,0)
 .I DVBABD3="O" S DVBABD3="[OPEN]"
"RTN","DVBAB1C",44,0)
 .I DVBABD3="C" S DVBABD3="[COMPLETE]"
"RTN","DVBAB1C",45,0)
 .I DVBABD3="X" S DVBABD3="[CANCELED BY MAS]"
"RTN","DVBAB1C",46,0)
 .I DVBABD3="RX" S DVBABD3="[CANCELED BY RO]"
"RTN","DVBAB1C",47,0)
 .I DVBABD3="T" S DVBABD3="[TRANSFERRED OUT]"
"RTN","DVBAB1C",48,0)
 .I ZIEN=DVBABD1 D
"RTN","DVBAB1C",49,0)
 ..S ZMSG(DVBABCNT)=DVBABIEN_"^"_DVBABD2_" "_DVBABD3
"RTN","DVBAB1C",50,0)
 ..S DVBABCNT=DVBABCNT+1
"RTN","DVBAB1C",51,0)
 K DVBABCNT,DVBABIEN,ZIEN,DVBABD1,DVBABD2,DVBABD3
"RTN","DVBAB1C",52,0)
 Q
"RTN","DVBAB1C",53,0)
 ;
"RTN","DVBAB1C",54,0)
 ;
"RTN","DVBAB1C",55,0)
SENDMSG(RIEN) ;SET UP TO SEND EMAIL/NOTIFICATION TO REQUESTOR OF 2507
"RTN","DVBAB1C",56,0)
 D GETREQ
"RTN","DVBAB1C",57,0)
 Q:DVBAEA=""
"RTN","DVBAB1C",58,0)
 ;
"RTN","DVBAB1C",59,0)
RDYMSG ;SEND REROUTED MESSAGE TO REQUESTOR OF 2507 
"RTN","DVBAB1C",60,0)
 ;no text/body is passed in so we have to build the message from scratch
"RTN","DVBAB1C",61,0)
 S XMSUB="CAPRI: 2507 Exam Request Rerouted"
"RTN","DVBAB1C",62,0)
 S ^TMP($J,"AMIE1",1)="The 2507 Exam Request as described below has been rerouted."
"RTN","DVBAB1C",63,0)
 S ^TMP($J,"AMIE1",2)=""
"RTN","DVBAB1C",64,0)
 S ^TMP($J,"AMIE1",3)=""
"RTN","DVBAB1C",65,0)
 S ^TMP($J,"AMIE1",4)="                 DFN:  `"_DVBADFN
"RTN","DVBAB1C",66,0)
 S ^TMP($J,"AMIE1",5)="          Requested Date: "_DVBADT
"RTN","DVBAB1C",67,0)
 S ^TMP($J,"AMIE1",6)="          Requested Site: "_RTF
"RTN","DVBAB1C",68,0)
 S ^TMP($J,"AMIE1",7)=""
"RTN","DVBAB1C",69,0)
 S ^TMP($J,"AMIE1",8)="          Rerouted Date: "_RDT
"RTN","DVBAB1C",70,0)
 S ^TMP($J,"AMIE1",9)="          Rerouted Site: "_RTO
"RTN","DVBAB1C",71,0)
 S ^TMP($J,"AMIE1",10)=""
"RTN","DVBAB1C",72,0)
 S ^TMP($J,"AMIE1",11)="         Reroute Reason: "_RRR
"RTN","DVBAB1C",73,0)
 S ^TMP($J,"AMIE1",12)=""
"RTN","DVBAB1C",74,0)
 S ^TMP($J,"AMIE1",13)=""
"RTN","DVBAB1C",75,0)
 S ^TMP($J,"AMIE1",14)="**NOTE: To view the patient using the DFN, paste the DFN number into the CAPRI"
"RTN","DVBAB1C",76,0)
 S ^TMP($J,"AMIE1",15)="Patient Selector 'Patient ID' field to find the patient. Be sure to include"
"RTN","DVBAB1C",77,0)
 S ^TMP($J,"AMIE1",16)="the ` (backward-apostrophe) character."
"RTN","DVBAB1C",78,0)
 S ^TMP($J,"AMIE1",17)=""
"RTN","DVBAB1C",79,0)
 S ^TMP($J,"AMIE1",18)=""
"RTN","DVBAB1C",80,0)
 S ^TMP($J,"AMIE1",19)=""
"RTN","DVBAB1C",81,0)
 S ^TMP($J,"AMIE1",20)="*****This is an auto-generated email.  Do not respond to this email address.*****"
"RTN","DVBAB1C",82,0)
 S XMTEXT="^TMP($J,""AMIE1"","
"RTN","DVBAB1C",83,0)
 D ^XMD,END
"RTN","DVBAB1C",84,0)
 Q
"RTN","DVBAB1C",85,0)
 ;
"RTN","DVBAB1C",86,0)
GETREQ ; Get infor the RIEN
"RTN","DVBAB1C",87,0)
 N DVBA0,DVBAREQ,DVBAC,DVBAQUIT,DUZ
"RTN","DVBAB1C",88,0)
 N MSG,MERR,CTR
"RTN","DVBAB1C",89,0)
 ;SINCE MAILMAN DOES NOT ALLOW MESSAGES TO BE SENT FROM USERS WITHOUT ACCESS CODES OR MAILBOXES
"RTN","DVBAB1C",90,0)
 ;WHICH CAPRI REMOTE USER DO NOT HAVE, WE HAVE TO NEW DUZ AND CHANGE XMDUZ TO THE NAME OF THE USER
"RTN","DVBAB1C",91,0)
 ;AS A STRING SO THE PROCESS IS STILL LINKED TO THE USER SENDING/TRIGGERING THE MESSAGE
"RTN","DVBAB1C",92,0)
 S DVBA0=$G(^DVB(396.3,RIEN,0))
"RTN","DVBAB1C",93,0)
 S DVBADFN=$P(DVBA0,"^",1),DVBAREQ=$P(DVBA0,"^",4)
"RTN","DVBAB1C",94,0)
 ;S XMDUZ=$P(^VA(200,DVBAREQ,0),"^",1)_" CAPRI"
"RTN","DVBAB1C",95,0)
 S XMDUZ="CAPRI "_$P(^VA(200,.5,0),"^",1)
"RTN","DVBAB1C",96,0)
 S DVBADT=$$FMTE^XLFDT($P(DVBA0,"^",2))
"RTN","DVBAB1C",97,0)
 ;following call supported by IA 3858
"RTN","DVBAB1C",98,0)
 S DVBAEA=$P($G(^VA(200,DVBAREQ,.15)),"^",1)
"RTN","DVBAB1C",99,0)
 S J1=$O(^DVB(396.3,RIEN,6,99999),-1)
"RTN","DVBAB1C",100,0)
 S J2=$O(^DVB(396.3,RIEN,6,J1,1,99999),-1)
"RTN","DVBAB1C",101,0)
 S J10=^DVB(396.3,RIEN,6,J1,0),J20=^DVB(396.3,RIEN,6,J1,1,J2,0)
"RTN","DVBAB1C",102,0)
 S RRRJ=$G(^DVB(396.3,RIEN,6,J1,1,J2,1))
"RTN","DVBAB1C",103,0)
 S:RRRJ="" RRRJ="None"
"RTN","DVBAB1C",104,0)
 S RRR=$$EXTERNAL^DILFD(396.34,4,,$P(J10,"^",5))
"RTN","DVBAB1C",105,0)
 S RRD=$P(J10,"^",6)
"RTN","DVBAB1C",106,0)
 S:RRD="" RRD="None"
"RTN","DVBAB1C",107,0)
 S RDT=$$EXTERNAL^DILFD(396.34,.01,,$P(J10,"^",1))
"RTN","DVBAB1C",108,0)
 S RTO=$$EXTERNAL^DILFD(396.34,.02,,$P(J10,"^",7))
"RTN","DVBAB1C",109,0)
 S RTF=$$EXTERNAL^DILFD(396.34,3,,$P(J10,"^",4))
"RTN","DVBAB1C",110,0)
 I DVBAEA="" Q
"RTN","DVBAB1C",111,0)
 S XMY(DVBAEA)="",DVBASITE=$$SITE^VASITE
"RTN","DVBAB1C",112,0)
 K J1,J10,J2,J20
"RTN","DVBAB1C",113,0)
 ;
"RTN","DVBAB1C",114,0)
 Q
"RTN","DVBAB1C",115,0)
 ;
"RTN","DVBAB1C",116,0)
MGUSR ; set email addresses from mail group
"RTN","DVBAB1C",117,0)
 ;  Supported References:                                               
"RTN","DVBAB1C",118,0)
 ;     DBIA #10111: Allows FM read access of ^XMB(3.8,D0,0) using DIC.
"RTN","DVBAB1C",119,0)
 ;
"RTN","DVBAB1C",120,0)
 N MGN,XMB,DIC,MMG,MDIEN,DVEM,MMUS,ERR
"RTN","DVBAB1C",121,0)
 S MGN="DVBA C 2507 REROUTE",XMB="DVBA CAPRI REROUTE"
"RTN","DVBAB1C",122,0)
 S XMDUZ="CAPRI "_$P(^VA(200,.5,0),"^",1)
"RTN","DVBAB1C",123,0)
 S DIC="^XMB(3.8,",DIC(0)="QM",X=MGN D ^DIC
"RTN","DVBAB1C",124,0)
 I +Y<0 S ERR="INVALID MAIL GROUP NAME" Q
"RTN","DVBAB1C",125,0)
 S MDIEN=+Y,MMG=0
"RTN","DVBAB1C",126,0)
 I '$$GOTLOCAL^XMXAPIG(MGN) S ERR="NO ACTIVE LOCAL MEMBERS IN MAIL GROUP" K ^TMP("XMERR",$J) Q
"RTN","DVBAB1C",127,0)
 F  S MMG=$O(^XMB(3.8,MDIEN,1,MMG)) Q:MMG="B"  D
"RTN","DVBAB1C",128,0)
 .S MMUS=$P($G(^XMB(3.8,MDIEN,1,MMG,0)),"^",1)
"RTN","DVBAB1C",129,0)
 .S DVEM=$P($G(^VA(200,MMUS,.15)),"^",1)
"RTN","DVBAB1C",130,0)
 .Q:DVEM=""
"RTN","DVBAB1C",131,0)
 .S XMY(DVEM)=""
"RTN","DVBAB1C",132,0)
 Q
"RTN","DVBAB1C",133,0)
 ;
"RTN","DVBAB1C",134,0)
END ;
"RTN","DVBAB1C",135,0)
 K RDT,RRD,RRR,RRRJ,RTF,RTO,X,XMY,XMSUB,XMTEXT,MGN,DIC,DIC(0),J,Y,XMDUZ,XMB,ERR
"RTN","DVBAB1C",136,0)
 K ^TMP($J,"AMIE1"),DVBADFN,DVBASITE,DVBADT,DVBAEA
"RTN","DVBAB1C",137,0)
 Q
"RTN","DVBAB2")
0^1^B32705926^B31951617
"RTN","DVBAB2",1,0)
DVBAB2 ;ALB/KLB - CAPRI RO AMIS REPORT CONT. ;05/01/00
"RTN","DVBAB2",2,0)
 ;;2.7;AMIE;**35,42,149,184,193**;Apr 10, 1995;Build 84
"RTN","DVBAB2",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","DVBAB2",4,0)
 ;
"RTN","DVBAB2",5,0)
DAY30 ;exam completion
"RTN","DVBAB2",6,0)
 N DVBADTS,DVBAPPTS,DVBACNT,DVBADTM,DVBANDE,X,X1,X2
"RTN","DVBAB2",7,0)
 K ^TMP("DVBC",$J),^TMP($J,"SDAMA301")
"RTN","DVBAB2",8,0)
 ;DES Type exams required to be completed in 45 days, all others 30
"RTN","DVBAB2",9,0)
 S DVBADTS=$S(((";IDES;")[(";"_DVBAPREXM_";")):45,1:30)
"RTN","DVBAB2",10,0)
 ;setup call to scheduling API
"RTN","DVBAB2",11,0)
 S DVBAPPTS(1)=DTRPT_";"_EDATE,DVBAPPTS(4)=PNAM,DVBAPPTS(3)="R;I;NT"
"RTN","DVBAB2",12,0)
 S DVBAPPTS("SORT")="P",DVBAPPTS("FLDS")="10"
"RTN","DVBAB2",13,0)
 S DVBACNT=$$SDAPI^SDAMA301(.DVBAPPTS)
"RTN","DVBAB2",14,0)
 I (DVBACNT'>0) K ^TMP($J,"SDAMA301") Q
"RTN","DVBAB2",15,0)
 S DVBADTM=""
"RTN","DVBAB2",16,0)
 F  S DVBADTM=$O(^TMP($J,"SDAMA301",PNAM,DVBADTM)) Q:('+DVBADTM)  D
"RTN","DVBAB2",17,0)
 .S ^TMP("DVBC",$J,9999999-DVBADTM,DVBADTM)=""
"RTN","DVBAB2",18,0)
 S DVBANDE=$O(^TMP("DVBC",$J,0)),DVBADTM=$O(^TMP("DVBC",$J,DVBANDE,0))
"RTN","DVBAB2",19,0)
 D:(DVBADTM]"")
"RTN","DVBAB2",20,0)
 .S X2=DVBADTM,X1=$S(DTSCHEDC]"":DTSCHEDC,1:DVBCNOW)
"RTN","DVBAB2",21,0)
 .D ^%DTC  ;calculate date diff
"RTN","DVBAB2",22,0)
 .S:(X>DVBADTS) TOT(DVBAPREXM,"30DAYEX")=TOT(DVBAPREXM,"30DAYEX")+1
"RTN","DVBAB2",23,0)
 K ^TMP($J,"SDAMA301")
"RTN","DVBAB2",24,0)
 Q
"RTN","DVBAB2",25,0)
 ;
"RTN","DVBAB2",26,0)
PENDCNT I X'<0&(X'>90) S TOT(DVBAPREXM,"P90")=TOT(DVBAPREXM,"P90")+1
"RTN","DVBAB2",27,0)
 I X>90&(X'>120) S TOT(DVBAPREXM,"P121")=TOT(DVBAPREXM,"P121")+1
"RTN","DVBAB2",28,0)
 I X>120&(X'>150) S TOT(DVBAPREXM,"P151")=TOT(DVBAPREXM,"P151")+1
"RTN","DVBAB2",29,0)
 I X>150&(X'>180) S TOT(DVBAPREXM,"P181")=TOT(DVBAPREXM,"P181")+1
"RTN","DVBAB2",30,0)
 I X>180&(X'>365) S TOT(DVBAPREXM,"P365")=TOT(DVBAPREXM,"P365")+1
"RTN","DVBAB2",31,0)
 I X>365 S TOT(DVBAPREXM,"P366")=TOT(DVBAPREXM,"P366")+1
"RTN","DVBAB2",32,0)
 Q
"RTN","DVBAB2",33,0)
 ;
"RTN","DVBAB2",34,0)
SET ;
"RTN","DVBAB2",35,0)
 N DVBAPREXM
"RTN","DVBAB2",36,0)
 S DTA=^DVB(396.3,REQDA,0),DTREQ=$P(DTA,U,2),XRONUM=$P(DTA,U,3),XRONUM=$S($D(^DIC(4,+XRONUM,99)):$P(^(99),U,1),1:0) Q:XRONUM'=RONUM&(RONUM'="ALL")
"RTN","DVBAB2",37,0)
 ; Next 2 lines check for specific division  SPH/ALB - 9/3/02
"RTN","DVBAB2",38,0)
 I DVBDIV'="" I '$D(^DVB(396.3,REQDA,1)) Q
"RTN","DVBAB2",39,0)
 I DVBDIV'="" I $P(^DVB(396.3,REQDA,1),"^",4)'=DVBDIV Q
"RTN","DVBAB2",40,0)
 K XRONUM S DTRPT=$P(DTA,U,5),DTSCHEDC=$P(DTA,U,6),DTRQCMP=$P(DTA,U,7),DTTRANS=$P(DTA,U,12),DTREL=$P(DTA,U,14),RQSTAT=$P(DTA,U,18),DTCAN=$P(DTA,U,19),PRIO=$P(DTA,U,10) K DTA
"RTN","DVBAB2",41,0)
 I DTRPT="",DTCAN]"" S DTRPT=DTCAN
"RTN","DVBAB2",42,0)
 Q:DTRPT=""  ;requests never printed
"RTN","DVBAB2",43,0)
 ;check for Parent Request (retrieve current/parent Priority of Exam)
"RTN","DVBAB2",44,0)
 S DVBAPREXM=$$CHKREQ^DVBCIRP1(REQDA)
"RTN","DVBAB2",45,0)
 ;original report run (Exclude new priorities)
"RTN","DVBAB2",46,0)
 Q:((DVBAEXMP']"")&((";BDD;QS;IDES;AO;")[(";"_DVBAPREXM_";")))
"RTN","DVBAB2",47,0)
 ;report for specific priority
"RTN","DVBAB2",48,0)
 Q:((DVBAEXMP]"")&(DVBAEXMP'[(";"_DVBAPREXM_";")))
"RTN","DVBAB2",49,0)
 S:(DVBAEXMP']"") DVBAPREXM="ALL"  ;identifier for totals
"RTN","DVBAB2",50,0)
 ;AJF;Request Status conversion ;
"RTN","DVBAB2",51,0)
 S RQSTAT=$$RSTAT^DVBCUTL8(REQDA)
"RTN","DVBAB2",52,0)
 I DTREL'<BDATE,DTREL'>EDATE D DAY30
"RTN","DVBAB2",53,0)
 I DTRPT'<BDATE,DTRPT'>EDATE S TOT(DVBAPREXM,"SENT")=TOT(DVBAPREXM,"SENT")+1
"RTN","DVBAB2",54,0)
 I DTRPT'<BDATE,DTRPT'>EDATE,RQSTAT'["X" S X1=$S(DTSCHEDC]"":DTSCHEDC,1:DVBCNOW),X2=DTRPT D ^%DTC I X>3 S TOT(DVBAPREXM,"3DAYSCH")=TOT(DVBAPREXM,"3DAYSCH")+1
"RTN","DVBAB2",55,0)
 I DTREL'<BDATE&(DTREL'>EDATE),RQSTAT="C"!(RQSTAT="R") S:PRIO'="E" DVBCPCTM=$$PROCDAY^DVBCUTL2(REQDA) S:PRIO="E" DVBCPCTM=$$INSFTME^DVBCUTA1(REQDA) S TOT(DVBAPREXM,"DAYS")=TOT(DVBAPREXM,"DAYS")+DVBCPCTM K DVBCPCTM
"RTN","DVBAB2",56,0)
 I DTRPT'>EDATE,"^P^S^T"[RQSTAT S TOT(DVBAPREXM,"PENDADJ")=TOT(DVBAPREXM,"PENDADJ")+1,X1=EDATE,X2=DTRPT D ^%DTC,PENDCNT
"RTN","DVBAB2",57,0)
 I DTRPT'>EDATE,"^C^CT^R^RX^X^"[RQSTAT,(+DTREL>EDATE)!(+DTCAN>EDATE) S TOT(DVBAPREXM,"PENDADJ")=TOT(DVBAPREXM,"PENDADJ")+1,X1=EDATE,X2=DTRPT D ^%DTC,PENDCNT
"RTN","DVBAB2",58,0)
 I DTREL'<BDATE&(DTREL'>EDATE),RQSTAT["C"!(RQSTAT="R") S TOT(DVBAPREXM,"COMPLETED")=TOT(DVBAPREXM,"COMPLETED")+1
"RTN","DVBAB2",59,0)
 I DTRPT'<BDATE,DTRPT'>EDATE,PRIO="E" S TOT(DVBAPREXM,"INSUFF")=TOT(DVBAPREXM,"INSUFF")+1
"RTN","DVBAB2",60,0)
 I DTCAN'<BDATE&(DTCAN'>EDATE),RQSTAT="X"!(RQSTAT="RX") S TOT(DVBAPREXM,"INCOMPLETE")=TOT(DVBAPREXM,"INCOMPLETE")+1
"RTN","DVBAB2",61,0)
 K DTRPT Q
"RTN","DVBAB2",62,0)
 ;
"RTN","DVBAB2",63,0)
GO ;
"RTN","DVBAB2",64,0)
 N DVBAEXMP,DVBAP,DVBAPREXM,DVBATOT,DVBALNE,MSG
"RTN","DVBAB2",65,0)
 S DVBAEXMP=$S($G(DVBAPRTY)["BDD":";BDD;QS;",($G(DVBAPRTY)["IDES"):";IDES;",($G(DVBAPRTY)["AO"):";AO;",1:"")
"RTN","DVBAB2",66,0)
 S DVBABCNT=0,DVBALNE="" K ^TMP($J)
"RTN","DVBAB2",67,0)
 S %DT="TS",X="NOW" D ^%DT S DVBCNOW=Y
"RTN","DVBAB2",68,0)
 S PNAM="" F JJ=0:0 S PNAM=$O(^DVB(396.3,"B",PNAM)) Q:PNAM=""  F REQDA=0:0 S REQDA=$O(^DVB(396.3,"B",PNAM,REQDA)) Q:REQDA=""  D SET
"RTN","DVBAB2",69,0)
 ;
"RTN","DVBAB2",70,0)
 S DVBAEXMP=$S($G(DVBAPRTY)["BDD":"BDD,QS",($G(DVBAPRTY)["IDES"):"IDES",($G(DVBAPRTY)["AO"):"AO",1:"ALL")
"RTN","DVBAB2",71,0)
 M DVBATOT=TOT  ;save totals for all priorities into new array
"RTN","DVBAB2",72,0)
 F DVBAP=1:1:$L(DVBAEXMP,",") D
"RTN","DVBAB2",73,0)
 .S DVBAPREXM=$P(DVBAEXMP,",",DVBAP)
"RTN","DVBAB2",74,0)
 .;re-create TOT array for each priority of exam
"RTN","DVBAB2",75,0)
 .D CRTOT^DVBCAMR2(DVBAPREXM,.DVBATOT,.TOT)
"RTN","DVBAB2",76,0)
 .S TOT("AVGDAYS")=0
"RTN","DVBAB2",77,0)
 .I TOT("COMPLETED")>0 S TOT("AVGDAYS")=TOT("DAYS")/TOT("COMPLETED"),TOT("AVGDAYS")=$J(TOT("AVGDAYS"),5,1)
"RTN","DVBAB2",78,0)
 .D BULLTXT^DVBCAMR1(DVBAPREXM)
"RTN","DVBAB2",79,0)
 .F JI=0:0 S JI=$O(^TMP($J,JI)) Q:JI=""  S DVBABCNT=DVBABCNT+1,MSG(DVBABCNT)=^TMP($J,JI,0)
"RTN","DVBAB2",80,0)
 .S:'$D(XMY) SBULL="N" I SBULL="Y" D SEND
"RTN","DVBAB2",81,0)
 .D:(DVBAP'=$L(DVBAEXMP,","))  ;another report to run
"RTN","DVBAB2",82,0)
 ..;insert line breaks / horizontal line break
"RTN","DVBAB2",83,0)
 ..S DVBABCNT=DVBABCNT+1,MSG(DVBABCNT)=""
"RTN","DVBAB2",84,0)
 ..F JI=1:1:70 S $P(DVBALNE,"-",JI)="-"
"RTN","DVBAB2",85,0)
 ..S DVBABCNT=DVBABCNT+1,MSG(DVBABCNT)=DVBALNE
"RTN","DVBAB2",86,0)
 ..S DVBABCNT=DVBABCNT+1,MSG(DVBABCNT)=""
"RTN","DVBAB2",87,0)
 ;
"RTN","DVBAB2",88,0)
EXIT K BDATE,%DT,DVBABCNT,C,DTCAN,DTREL,DTREQ,DTRQCMP,DTSCHEDC,DTTRANS
"RTN","DVBAB2",89,0)
 K DVBCNOW,DVBCPCTM,EDATE,FA,FB,JI,JJ,L,PNAM,PRIO,REQDA,RONUM,RQSTAT
"RTN","DVBAB2",90,0)
 K SBULL,TOT,X,X1,X2,XMDUZ,XMMG,XMY,Y,YY,DVBDIV,DVBAPRTY
"RTN","DVBAB2",91,0)
 Q
"RTN","DVBAB2",92,0)
 ;
"RTN","DVBAB2",93,0)
BULL S XMDUZ=$P(^VA(200,DUZ,0),U),XMMG=$S($D(^VA(200,DUZ,0)):$P(^(0),U,1),1:""),XMY(DUZ)=""
"RTN","DVBAB2",94,0)
 Q
"RTN","DVBAB2",95,0)
 ;
"RTN","DVBAB2",96,0)
SEND ;send 2507 AMIS report in bulletin
"RTN","DVBAB2",97,0)
 N DVBAXMY M DVBAXMY=XMY
"RTN","DVBAB2",98,0)
 S XMSUB="RO AMIS 290 Report "_$S((($G(DVBAPREXM)]"")&($G(DVBAPREXM)'="ALL")):"("_$G(DVBAPREXM)_" Exam Priority) ",1:"")_"-  "
"RTN","DVBAB2",99,0)
 S Y=BDATE X ^DD("DD") S XMSUB=XMSUB_Y S Y=EDATE X ^DD("DD") S XMSUB=XMSUB_" to "_Y,XMTEXT="^TMP($J,"
"RTN","DVBAB2",100,0)
 D ^XMD K XMTEXT,XMSUB,^TMP($J)
"RTN","DVBAB2",101,0)
 S DVBABCNT=DVBABCNT+1,MSG(DVBABCNT)=""
"RTN","DVBAB2",102,0)
 S DVBABCNT=DVBABCNT+1,MSG(DVBABCNT)=">>> Mail message transmitted. <<<"
"RTN","DVBAB2",103,0)
 M XMY=DVBAXMY  ;restore address list for subsequent bulletins
"RTN","DVBAB2",104,0)
 Q
"RTN","DVBAB2",105,0)
 ;
"RTN","DVBAB5")
0^2^B2646999^B2583661
"RTN","DVBAB5",1,0)
DVBAB5 ;ALB/KLB - CAPRI PENDING REQUESTS CONT ;08/01/00
"RTN","DVBAB5",2,0)
 ;;2.7;AMIE;**35,185,193**;Apr 10, 1995;Build 84
"RTN","DVBAB5",3,0)
 ;
"RTN","DVBAB5",4,0)
SORT ; AJF;Request Status Conversion
"RTN","DVBAB5",5,0)
 N ROUT
"RTN","DVBAB5",6,0)
 S STAT=$P(^DVB(396.3,REQDA,0),U,18)
"RTN","DVBAB5",7,0)
 Q:STAT=""
"RTN","DVBAB5",8,0)
 S STAT=$$RSTAT^DVBCUTL8(STAT)
"RTN","DVBAB5",9,0)
 Q:"^R^X^RX^C^CT^RR^RA^"[(U_STAT_U)  I DVBCSORT="S" Q:STAT'=RSTAT&(RSTAT'="A")
"RTN","DVBAB5",10,0)
 S RONUM=$P(^DVB(396.3,REQDA,0),U,3),RONAME=$S(RONUM]"":$P(^DIC(4,+RONUM,0),U,1),1:"")
"RTN","DVBAB5",11,0)
 S ROFILTER=$S($D(ROFILTER)'=0:ROFILTER,1:0)
"RTN","DVBAB5",12,0)
 I (ROFILTER'[RONAME)&(ROFILTER'=0) Q 
"RTN","DVBAB5",13,0)
 S PNAM=$S($D(^DPT(DFN,0)):$P(^(0),U,1),1:"Unknown"),ROUT=$S($D(^DVB(396.3,REQDA,1)):$P(^(1),U,4),1:0),RDATE=$P(^(0),U,5)
"RTN","DVBAB5",14,0)
 I DVBCSORT="V" S ^TMP($J,PNAM,DFN,REQDA)="" Q
"RTN","DVBAB5",15,0)
 I DVBCSORT="S" S ^TMP($J,STAT,PNAM,DFN,REQDA)="" Q
"RTN","DVBAB5",16,0)
 I DVBCSORT="R",$D(ADIVNUM),ROUT=ADIVNUM S ^TMP($J,ROUT,PNAM,DFN,REQDA)="" Q
"RTN","DVBAB5",17,0)
 I DVBCSORT="A" D ELAPSED I EDAYS'<ERDAYS,EDAYS'>OLDAYS S ^TMP($J,EDAYS,PNAM,DFN,REQDA)=""
"RTN","DVBAB5",18,0)
 Q
"RTN","DVBAB5",19,0)
 ;
"RTN","DVBAB5",20,0)
ELAPSED K EDAYS,X1,X2,X S X1=DT,(X2,X)=RDATE D:ELTYP="C" ^%DTC D:ELTYP="W" ^XUWORKDY S EDAYS=X
"RTN","DVBAB5",21,0)
 Q
"RTN","DVBAB5",22,0)
 ;
"RTN","DVBAB58")
0^38^B15547843^B15185844
"RTN","DVBAB58",1,0)
DVBAB58 ;ALB/SPH - CAPRI INSUFF EXAM TRACKING REPORT ;09/06/00
"RTN","DVBAB58",2,0)
 ;;2.7;AMIE;**35,193**;Apr 10, 1995;Build 84
"RTN","DVBAB58",3,0)
 ;
"RTN","DVBAB58",4,0)
STRT(ZMSG,BEGDT,ENDDT,RPTTYPE) ;
"RTN","DVBAB58",5,0)
MAIN ;**Select Dte Rng & Rpt Type; call report routine
"RTN","DVBAB58",6,0)
 F  Q:$D(DVBAOUT)  DO
"RTN","DVBAB58",7,0)
 .;D HOME^%ZIS
"RTN","DVBAB58",8,0)
 .;S TVAR(1,0)="0,0,1,2:2,1^Insufficient 2507 Exam Report"
"RTN","DVBAB58",9,0)
 .;D WR^DVBAUTL4("TVAR")
"RTN","DVBAB58",10,0)
 .;K TVAR
"RTN","DVBAB58",11,0)
 .;S RPTTYPE=$$RPTTYPE^DVBCUTA1()
"RTN","DVBAB58",12,0)
 .S:((RPTTYPE'="D")&(RPTTYPE'="S")) DVBAOUT=""
"RTN","DVBAB58",13,0)
 .;W:'$D(DVBAOUT) !!
"RTN","DVBAB58",14,0)
 .;D:'$D(DVBAOUT) DATE^DVBCUTL4(.BEGDT,.ENDDT)
"RTN","DVBAB58",15,0)
 .I $D(ENDDT),(+ENDDT>0) DO
"RTN","DVBAB58",16,0)
 ..S ENDDT=ENDDT_".2359"
"RTN","DVBAB58",17,0)
 ..I RPTTYPE="S" DO
"RTN","DVBAB58",18,0)
 ...D DEVSEL
"RTN","DVBAB58",19,0)
 ...I POP D SUMKILL
"RTN","DVBAB58",20,0)
 ...I 'POP DO
"RTN","DVBAB58",21,0)
 ....I $D(IO("Q")) DO
"RTN","DVBAB58",22,0)
 .....N DVBAI
"RTN","DVBAB58",23,0)
 .....S ZTRTN="SUM^DVBCIRPT",ZTIO=ION
"RTN","DVBAB58",24,0)
 .....S ZTDESC="Summary Insufficient Exam Report"
"RTN","DVBAB58",25,0)
 .....F DVBAI="BEGDT","ENDDT" S ZTSAVE(DVBAI)=""
"RTN","DVBAB58",26,0)
 .....D ^%ZTLOAD
"RTN","DVBAB58",27,0)
 .....N TSK S TSK=$S($D(ZTSK)=0:"C",1:"Y")
"RTN","DVBAB58",28,0)
 .....I TSK="Y" W !!,"Summary Report Queued. Task number: ",ZTSK
"RTN","DVBAB58",29,0)
 .....K ZTSK D CONTMES^DVBCUTL4
"RTN","DVBAB58",30,0)
 .....D SUMKILL
"RTN","DVBAB58",31,0)
 ....I '$D(IO("Q")) D SUM
"RTN","DVBAB58",32,0)
 ...D ^%ZISC
"RTN","DVBAB58",33,0)
 ..I RPTTYPE="D" DO
"RTN","DVBAB58",34,0)
 ...D DETSEL^DVBCIRP1 ;**Select the Reasons and Exams to report
"RTN","DVBAB58",35,0)
 ...I '$D(DVBAQTSL) DO
"RTN","DVBAB58",36,0)
 ....D DEVSEL
"RTN","DVBAB58",37,0)
 ....I POP D KVARS^DVBCIRP1
"RTN","DVBAB58",38,0)
 ....I 'POP DO
"RTN","DVBAB58",39,0)
 .....I $D(IO("Q")) DO
"RTN","DVBAB58",40,0)
 ......N DVBAI
"RTN","DVBAB58",41,0)
 ......S ZTRTN="DETAIL^DVBCIRP1",ZTIO=ION
"RTN","DVBAB58",42,0)
 ......S ZTDESC="Detailed Insufficient Exam Report"
"RTN","DVBAB58",43,0)
 ......F DVBAI="BEGDT","ENDDT","DVBAARY(""REASON"",","^TMP($J,""XMTYPE""," S ZTSAVE(DVBAI)=""
"RTN","DVBAB58",44,0)
 ......D ^%ZTLOAD
"RTN","DVBAB58",45,0)
 ......N TSK S TSK=$S($D(ZTSK)=0:"C",1:"Y")
"RTN","DVBAB58",46,0)
 ......I TSK="Y" W !!,"Detail Report Queued. Task number: ",ZTSK
"RTN","DVBAB58",47,0)
 ......K ZTSK D CONTMES^DVBCUTL4
"RTN","DVBAB58",48,0)
 ......D KVARS^DVBCIRP1
"RTN","DVBAB58",49,0)
 .....I '$D(IO("Q")) W:IOST?1"C-".E @IOF D DETAIL^DVBCIRP1
"RTN","DVBAB58",50,0)
 ....D ^%ZISC
"RTN","DVBAB58",51,0)
 ...K DVBAQTSL
"RTN","DVBAB58",52,0)
 ..D CLEANUP
"RTN","DVBAB58",53,0)
 D KVARS
"RTN","DVBAB58",54,0)
 Q
"RTN","DVBAB58",55,0)
 ;
"RTN","DVBAB58",56,0)
KVARS ;** Kill the variables used in report
"RTN","DVBAB58",57,0)
 K DVBAOUT,ENDDT,BEGDT,DTOUT,DUOUT,RPTTYPE,DVBACAN,DVBASTAT
"RTN","DVBAB58",58,0)
 D CLEANUP
"RTN","DVBAB58",59,0)
 Q
"RTN","DVBAB58",60,0)
 ;
"RTN","DVBAB58",61,0)
CLEANUP ;** Kill the variables used by the device handler
"RTN","DVBAB58",62,0)
 K %ZIS,POP,%IS,IOP
"RTN","DVBAB58",63,0)
 Q
"RTN","DVBAB58",64,0)
 ;
"RTN","DVBAB58",65,0)
DEVSEL ;** Select the device to report to
"RTN","DVBAB58",66,0)
 S %ZIS="AEQ"
"RTN","DVBAB58",67,0)
 S %ZIS("A")="Output device: "
"RTN","DVBAB58",68,0)
 D ^%ZIS
"RTN","DVBAB58",69,0)
 Q
"RTN","DVBAB58",70,0)
 ;
"RTN","DVBAB58",71,0)
SUM ;** Set up reason counter array, count all 2507's received
"RTN","DVBAB58",72,0)
 U IO
"RTN","DVBAB58",73,0)
 S (DVBARQCT,DVBAINRQ,DVBAXMCT,DVBAINXM)=0
"RTN","DVBAB58",74,0)
 S DVBACAN("REQ")=0,DVBACAN("EXM")=0
"RTN","DVBAB58",75,0)
 S DVBAENDL=ENDDT
"RTN","DVBAB58",76,0)
 ;
"RTN","DVBAB58",77,0)
 ;** Initialize reason counter array
"RTN","DVBAB58",78,0)
 F DVBARIFN=0:0 S DVBARIFN=$O(^DVB(396.94,DVBARIFN)) Q:+DVBARIFN'>0  DO
"RTN","DVBAB58",79,0)
 .S DVBAINXM(DVBARIFN)=0
"RTN","DVBAB58",80,0)
 S DVBAINXM("NO REASON")=0
"RTN","DVBAB58",81,0)
 ;
"RTN","DVBAB58",82,0)
 ;** Count the total and insufficient number of exams and 2507 requests
"RTN","DVBAB58",83,0)
 S DVBADTLP=BEGDT-.0001
"RTN","DVBAB58",84,0)
 F  S DVBADTLP=$O(^DVB(396.3,"ADP",DVBADTLP)) Q:(DVBADTLP=""!(DVBADTLP>ENDDT))  DO
"RTN","DVBAB58",85,0)
 .S DVBAPRIO=""
"RTN","DVBAB58",86,0)
 .F  S DVBAPRIO=$O(^DVB(396.3,"ADP",DVBADTLP,DVBAPRIO)) Q:DVBAPRIO=""  DO
"RTN","DVBAB58",87,0)
 ..S DVBADALP=""
"RTN","DVBAB58",88,0)
 ..F  S DVBADALP=$O(^DVB(396.3,"ADP",DVBADTLP,DVBAPRIO,DVBADALP)) Q:DVBADALP=""  DO
"RTN","DVBAB58",89,0)
 ...S DVBARQCT=DVBARQCT+1
"RTN","DVBAB58",90,0)
 ...K DVBAINSF
"RTN","DVBAB58",91,0)
 ...I DVBAPRIO="E" DO
"RTN","DVBAB58",92,0)
 ....S DVBAINRQ=DVBAINRQ+1
"RTN","DVBAB58",93,0)
 ....;AJF ;Request Status Convertion
"RTN","DVBAB58",94,0)
 ....I $P(^DVB(396.3,DVBADALP,0),U,18)=7 S DVBACAN("REQ")=DVBACAN("REQ")+1
"RTN","DVBAB58",95,0)
 ....S DVBAINSF=""
"RTN","DVBAB58",96,0)
 ...S DVBAXMDA=""
"RTN","DVBAB58",97,0)
 ...F  S DVBAXMDA=$O(^DVB(396.4,"C",DVBADALP,DVBAXMDA)) Q:DVBAXMDA=""  DO
"RTN","DVBAB58",98,0)
 ....S DVBAXMCT=DVBAXMCT+1
"RTN","DVBAB58",99,0)
 ....I $D(DVBAINSF) DO
"RTN","DVBAB58",100,0)
 .....S DVBAINXM=DVBAINXM+1
"RTN","DVBAB58",101,0)
 .....S DVBARIFN=$P(^DVB(396.4,DVBAXMDA,0),U,11),DVBASTAT=$P(^(0),U,4)
"RTN","DVBAB58",102,0)
 .....S:DVBARIFN="" DVBARIFN="NO REASON"
"RTN","DVBAB58",103,0)
 .....S DVBAINXM(DVBARIFN)=DVBAINXM(DVBARIFN)+1
"RTN","DVBAB58",104,0)
 .....I DVBASTAT="RX" S DVBACAN("EXM")=DVBACAN("EXM")+1
"RTN","DVBAB58",105,0)
 D SUMRPT^DVBCIRP1
"RTN","DVBAB58",106,0)
 S:$D(ZTQUEUED) ZTREQ="@"
"RTN","DVBAB58",107,0)
 D SUMKILL
"RTN","DVBAB58",108,0)
 D ^%ZISC
"RTN","DVBAB58",109,0)
 Q
"RTN","DVBAB58",110,0)
 ;
"RTN","DVBAB58",111,0)
SUMKILL ;** Kill the variables used in the summary report
"RTN","DVBAB58",112,0)
 K DVBADTLP,DVBAENDL,DVBARQCT,DVBAINRQ,DVBAXMCT,DVBAINXM
"RTN","DVBAB58",113,0)
 K DVBAPRIO,DVBADALP,DVBAXMDA,DVBAINSF,DVBARIFN
"RTN","DVBAB58",114,0)
 Q
"RTN","DVBAB6")
0^3^B69476368^B67138708
"RTN","DVBAB6",1,0)
DVBAB6 ;ALB/DJS - CAPRI PENDING 2507 REQUEST REPORT ; 02-27-2013
"RTN","DVBAB6",2,0)
 ;;2.7;AMIE;**35,90,108,168,185,190,192,193**;Apr 10, 1995;Build 84
"RTN","DVBAB6",3,0)
 ;
"RTN","DVBAB6",4,0)
STRT(MSG,DVBCSORT,RSTAT,ERDAYS,OLDAYS,ADIVNUM,ELTYP,DVBADLMTR,ROFILTER) ;
"RTN","DVBAB6",5,0)
 ; MSG=DATA Passed back from RPC to GUI;(.MSG,"A","NR",1,1,7613,"W",0,0)
"RTN","DVBAB6",6,0)
 ;DVBCSORT=Sort by("A"GE,"S"TATUS,"V"ETERAN NAME,"R"OUTING LOCATION)
"RTN","DVBAB6",7,0)
 ;RSTAT= Routing Status("N"ew,"P"ending","T"ranscribed,"NR"New Re-Routed,"RP"Re-routed pending acceptance,"RA"Re-routed acceptance accepted --
"RTN","DVBAB6",8,0)
 ;       routing status continued - "RR"Re-routed rejected,'A'll statuses)  
"RTN","DVBAB6",9,0)
 ;ERDAYS= Earliest age if SORTBY is "A"("1" earliest, "7" latest)
"RTN","DVBAB6",10,0)
 ;OLDAYS = OLDEST AGE IF SORTBY IS "A"("1"=earliest, "7" oldest)
"RTN","DVBAB6",11,0)
 ;ADIVNUM=ROUTING LOCATION -DIVISION IEN     
"RTN","DVBAB6",12,0)
 ;ELTYP= REPORT TYPE("W"ORK DAYS, "C"ALENDAR DAYS)
"RTN","DVBAB6",13,0)
 ;DVBADLMTR= DELIMITER("0"= PLAIN TEXT, "1"=COMMA DELIMITED
"RTN","DVBAB6",14,0)
 ;ROFILTER = MODE ("0"=LOCAL MODE, "1"=REMOTE MODE)   SDAT,EDAT,RSTAT,DELIM,YNODT
"RTN","DVBAB6",15,0)
 I ADIVNUM'="" S X=$O(^DG(40.8,"C",ADIVNUM,"")) S:X]"" ADIVNUM=X
"RTN","DVBAB6",16,0)
 S DVBADLMTR=$S(DVBADLMTR=1:",",1:0),ROFILTER=$S($G(ROFILTER)'=0:ROFILTER,1:0)
"RTN","DVBAB6",17,0)
SETUP K ^TMP($J),^TMP("CAPRI")
"RTN","DVBAB6",18,0)
 S DVBCDT(0)=$$FMTE^XLFDT(DT,"5DZ"),PG=1,DVBCCNT=0,DONE="NO",MSGCNT=1,TRNSFIN=""
"RTN","DVBAB6",19,0)
 S DVBCHDR="Sorted by "_$S(DVBCSORT="V":"VETERAN NAME",DVBCSORT="R":"Routing location",DVBCSORT="S":"Status",DVBCSORT="A":"Age of request",1:"Unknown")
"RTN","DVBAB6",20,0)
HEAD S HEAD="Pending 2507 Requests for "_$S($D(^DVB(396.1,1,0)):$P(^(0),U,1),1:"Unknown site"),PROCDT="Processed on: "_DVBCDT(0),NODATA=0
"RTN","DVBAB6",21,0)
 I $G(DVBADLMTR)'="," D HEADRND G DATA
"RTN","DVBAB6",22,0)
 I $G(DVBADLMTR)="," D HEADRD G DATA
"RTN","DVBAB6",23,0)
 Q
"RTN","DVBAB6",24,0)
HEADRND ; Print non-delimited output header
"RTN","DVBAB6",25,0)
 ;
"RTN","DVBAB6",26,0)
 S ^TMP("CAPRI",MSGCNT)=HEAD_"^",MSGCNT=MSGCNT+1
"RTN","DVBAB6",27,0)
 S ^TMP("CAPRI",MSGCNT)=PROCDT_"^",MSGCNT=MSGCNT+1
"RTN","DVBAB6",28,0)
 S ^TMP("CAPRI",MSGCNT)="^",MSGCNT=MSGCNT+1
"RTN","DVBAB6",29,0)
 S $P(^TMP("CAPRI",MSGCNT),"=",75)="=^",MSGCNT=MSGCNT+1
"RTN","DVBAB6",30,0)
 S ^TMP("CAPRI",MSGCNT)="^",MSGCNT=MSGCNT+1
"RTN","DVBAB6",31,0)
 S ^TMP("CAPRI",MSGCNT)="",MSGCNT=MSGCNT+1
"RTN","DVBAB6",32,0)
 Q
"RTN","DVBAB6",33,0)
HEADRD ; Print delimited output header
"RTN","DVBAB6",34,0)
 ;
"RTN","DVBAB6",35,0)
 S ^TMP("CAPRI",MSGCNT)=HEAD_$C(13),MSGCNT=MSGCNT+1,^TMP("CAPRI",MSGCNT)=PROCDT_$C(13),MSGCNT=MSGCNT+1
"RTN","DVBAB6",36,0)
 S ^TMP("CAPRI",MSGCNT)=$S($G(ROFILTER)'=0:"RO #"_DVBADLMTR,1:"")_"Division"_DVBADLMTR_"Status"_DVBADLMTR_"Veteran Name"_DVBADLMTR_"SSN"_DVBADLMTR_"Claim No."_DVBADLMTR_"Request Date"_DVBADLMTR
"RTN","DVBAB6",37,0)
 S ^TMP("CAPRI",MSGCNT)=^TMP("CAPRI",MSGCNT)_"Elapsed Days"_DVBADLMTR_"Transferred in from"_DVBADLMTR_"Requested by Name"_DVBADLMTR_"Requested by Division"_DVBADLMTR_"Exams Requested"_DVBADLMTR_"Exam Status"_DVBADLMTR
"RTN","DVBAB6",38,0)
 S ^TMP("CAPRI",MSGCNT)=^TMP("CAPRI",MSGCNT)_"Cell Phone"_DVBADLMTR_"Email Address"_DVBADLMTR_"Claim Type"_DVBADLMTR_"Special Consideration(s)"_$C(13)
"RTN","DVBAB6",39,0)
 S MSGCNT=MSGCNT+1
"RTN","DVBAB6",40,0)
 Q
"RTN","DVBAB6",41,0)
 ;
"RTN","DVBAB6",42,0)
DATA ; Sort data records
"RTN","DVBAB6",43,0)
 ;
"RTN","DVBAB6",44,0)
 S DFN="" F  S DFN=$O(^DVB(396.3,"B",DFN)) Q:DFN=""  F REQDA=0:0 S REQDA=$O(^DVB(396.3,"B",DFN,REQDA)) Q:REQDA=""  D SORT^DVBAB5
"RTN","DVBAB6",45,0)
 N EXAMRECRD
"RTN","DVBAB6",46,0)
 I DVBCSORT="V" S PNAM="" F  S PNAM=$O(^TMP($J,PNAM)) Q:PNAM=""  F DFN=0:0 S DFN=$O(^TMP($J,PNAM,DFN)) Q:'DFN  F DA(1)=0:0 S DA(1)=$O(^TMP($J,PNAM,DFN,DA(1))) Q:'DA(1)  D PRINT I $D(OUT) S DA(1)=999999999,PNAM="ZZZ",DONE="YES" Q
"RTN","DVBAB6",47,0)
 I DVBCSORT="R"!(DVBCSORT="A")!(DVBCSORT="S") D
"RTN","DVBAB6",48,0)
 . S JX="" F  S JX=$O(^TMP($J,JX)) Q:JX=""  D
"RTN","DVBAB6",49,0)
 .. S PNAM="" F  S PNAM=$O(^TMP($J,JX,PNAM)) Q:PNAM=""  D
"RTN","DVBAB6",50,0)
 ... F DFN=0:0 S DFN=$O(^TMP($J,JX,PNAM,DFN)) Q:'DFN  D NXT
"RTN","DVBAB6",51,0)
 I DVBCCNT>0 S ^TMP("CAPRI",MSGCNT)="Total pending: "_DVBCCNT,DONE="YES"
"RTN","DVBAB6",52,0)
 ;
"RTN","DVBAB6",53,0)
EXIT I NODATA=0 S ^TMP("CAPRI",MSGCNT)="No pending request found for select parameters.",MSG=$NA(^TMP("CAPRI"))
"RTN","DVBAB6",54,0)
 I DONE="YES" S MSG=$NA(^TMP("CAPRI"))
"RTN","DVBAB6",55,0)
 K ^TMP($J),ADIV,CNUM,NODATA,STATUS,TST,TSTA1,STSAT,PG,PRTNM,RDATE,RDATE1,REQDA,SSN,RONAME,JX,TRNSFIN,PROCDT,REQSTR,MSGCNT,TSTAT
"RTN","DVBAB6",56,0)
 K DA,DFN,DONE,DVBCCNT,DVBCDT,DVBCHDR,X,XX,ZS,ZZZ,HEAD,HEAD2,OUT,OWNDOM,EDAYS,PNAM,DVBADLMTR,EXAMRECRD,ROFILTER,RONUM,VADM
"RTN","DVBAB6",57,0)
 K DVBAA,DVBCELL,DVBCNT,DVBCTW,DVBEMA,DVBSC,DVBSCN,DVBSCNS,DVBSCW,DVBSCWA,DVBX
"RTN","DVBAB6",58,0)
 Q
"RTN","DVBAB6",59,0)
 ;
"RTN","DVBAB6",60,0)
PRINT ; print 2507 request data
"RTN","DVBAB6",61,0)
 ;
"RTN","DVBAB6",62,0)
 S ADIV=$S($D(^DVB(396.3,DA(1),1)):$P(^(1),U,4),1:"") Q:ADIV'=ADIVNUM&(DVBCSORT="R")  I ADIV]"" S ADIV=$S($D(^DG(40.8,+ADIV,0)):$P(^(0),U,1),1:"Unknown Division")
"RTN","DVBAB6",63,0)
 S RDATE1=$P(^DVB(396.3,DA(1),0),U,2),RDATE=$P(^(0),U,5)
"RTN","DVBAB6",64,0)
 S SSN=$P($G(^DPT(DFN,0)),U,9) S:SSN="" SSN="Unknown"
"RTN","DVBAB6",65,0)
 S DVBCELL=$P($G(^DPT(DFN,.13)),U,4)
"RTN","DVBAB6",66,0)
 S DVBEMA=$P($G(^DPT(DFN,.13)),U,3)
"RTN","DVBAB6",67,0)
 S CNUM=$P($G(^DPT(DFN,.31)),U,3) S:CNUM="" CNUM="Unknown"
"RTN","DVBAB6",68,0)
 S OWNDOM=$P(^DVB(396.3,DA(1),0),U,22) I OWNDOM]"" S TRNSFIN=$S($D(^DIC(4.2,+OWNDOM,0)):$P(^(0),U,1),1:"Unknown Site") I $G(DVBADLMTR)=0 S ^TMP("CAPRI",MSGCNT)="Transferred in from "_TRNSFIN_"^",MSGCNT=MSGCNT+1
"RTN","DVBAB6",69,0)
 D ELAPSED^DVBAB5
"RTN","DVBAB6",70,0)
 ;AJF;Request Status conversion Reports ;
"RTN","DVBAB6",71,0)
 S STATUS="Unknown",XX=$$RSTAT^DVBCUTL8($P(^DVB(396.3,DA(1),0),U,18))
"RTN","DVBAB6",72,0)
 S STATUS=$$EXTERNAL^DILFD(396.3,17,,$P(^DVB(396.3,DA(1),0),U,18))
"RTN","DVBAB6",73,0)
 ;S STATUS=$S(XX="N":"New",XX="P":"Pending, reported",XX="S":"Pending, scheduled",XX="R":"Released to RO, not printed",1:"")
"RTN","DVBAB6",74,0)
 ;I STATUS="",$D(XX) S STATUS=$S(XX="C":"Completed, printed by RO",XX="X":"Cancelled by RO",XX="T":"Transcribed",XX="NT":"New,Transferred in",XX="CT":"Completed, Transferred out",1:"Unknown")
"RTN","DVBAB6",75,0)
 I $G(DVBADLMTR)="," D PRINTD,ITEMS Q
"RTN","DVBAB6",76,0)
 S ^TMP("CAPRI",MSGCNT)="Division: "_ADIV_"^",MSGCNT=MSGCNT+1
"RTN","DVBAB6",77,0)
 S ^TMP("CAPRI",MSGCNT)="Status: "_STATUS_"^",MSGCNT=MSGCNT+1
"RTN","DVBAB6",78,0)
 S ^TMP("CAPRI",MSGCNT)=PNAM_" ^",MSGCNT=MSGCNT+1
"RTN","DVBAB6",79,0)
 S ^TMP("CAPRI",MSGCNT)="SSN: "_SSN_"^",MSGCNT=MSGCNT+1
"RTN","DVBAB6",80,0)
 S ^TMP("CAPRI",MSGCNT)="Cell no.: "_DVBCELL_"^",MSGCNT=MSGCNT+1
"RTN","DVBAB6",81,0)
 S ^TMP("CAPRI",MSGCNT)="Email: "_DVBEMA_"^",MSGCNT=MSGCNT+1
"RTN","DVBAB6",82,0)
 S ^TMP("CAPRI",MSGCNT)="Claim no: "_CNUM_"^",MSGCNT=MSGCNT+1
"RTN","DVBAB6",83,0)
 S ^TMP("CAPRI",MSGCNT)="Request Date: "_$$FMTE^XLFDT(RDATE1,"5DZ")_"^",MSGCNT=MSGCNT+1
"RTN","DVBAB6",84,0)
 S ^TMP("CAPRI",MSGCNT)="Elapsed days: "_EDAYS_"^",MSGCNT=MSGCNT+1
"RTN","DVBAB6",85,0)
 S X=$S($D(^DVB(396.3,DA(1),4)):^(4),1:"")
"RTN","DVBAB6",86,0)
 D CLAIMTYP,SPEC
"RTN","DVBAB6",87,0)
 S ^TMP("CAPRI",MSGCNT)="Claim Type: "_DVBCTW_"^",MSGCNT=MSGCNT+1
"RTN","DVBAB6",88,0)
 S ^TMP("CAPRI",MSGCNT)="Special Consideration(s): "_DVBSCWA_"^",MSGCNT=MSGCNT+1
"RTN","DVBAB6",89,0)
 S ^TMP("CAPRI",MSGCNT)="^",MSGCNT=MSGCNT+1
"RTN","DVBAB6",90,0)
 S ^TMP("CAPRI",MSGCNT)="Exams requested:"_"^",MSGCNT=MSGCNT+1
"RTN","DVBAB6",91,0)
 ;
"RTN","DVBAB6",92,0)
ITEMS S NODATA=1,REQSTR=+$P(^DVB(396.3,DA(1),0),U,4)
"RTN","DVBAB6",93,0)
 S ZZZ="Requested by: "_$S($D(^VA(200,+REQSTR,0)):$P(^(0),U,1),1:" (Not specified) ")_" at "
"RTN","DVBAB6",94,0)
 S RONAME=$P(^DVB(396.3,DA(1),0),U,3),RONAME=$S(RONAME]"":$P(^DIC(4,+RONAME,0),U,1),1:"")
"RTN","DVBAB6",95,0)
 I $G(DVBADLMTR)'="," D ITEMSND Q
"RTN","DVBAB6",96,0)
 I $G(DVBADLMTR)="," D ITEMSD Q
"RTN","DVBAB6",97,0)
ITEMSND D TST S ^TMP("CAPRI",MSGCNT)="^"_ZZZ_$S(RONAME]"":RONAME,1:" (Not specified) ")_"^",MSGCNT=MSGCNT+1
"RTN","DVBAB6",98,0)
 S ^TMP("CAPRI",MSGCNT)="^",MSGCNT=MSGCNT+1
"RTN","DVBAB6",99,0)
 S $P(^TMP("CAPRI",MSGCNT),"-",75)="-^",MSGCNT=MSGCNT+1
"RTN","DVBAB6",100,0)
 S DVBCCNT=DVBCCNT+1
"RTN","DVBAB6",101,0)
 Q
"RTN","DVBAB6",102,0)
ITEMSD S ZZZ=$S($D(^VA(200,+REQSTR,0)):$P(^(0),U,1),1:" (Not specified) ")
"RTN","DVBAB6",103,0)
 S EXAMRECRD=EXAMRECRD_""""_ZZZ_""""_DVBADLMTR_""""_RONAME_""""_DVBADLMTR
"RTN","DVBAB6",104,0)
 D TST S DVBCCNT=DVBCCNT+1
"RTN","DVBAB6",105,0)
 Q
"RTN","DVBAB6",106,0)
 ;
"RTN","DVBAB6",107,0)
PRINTD ; Print delimited format output on report
"RTN","DVBAB6",108,0)
 ;
"RTN","DVBAB6",109,0)
 I OWNDOM']"" S TRNSFIN=""
"RTN","DVBAB6",110,0)
 S RONUM=$P(^DVB(396.3,DA(1),0),U,3)
"RTN","DVBAB6",111,0)
 D DEM^VADPT I $G(VADM(1))'="" S SSN=$S(DVBADLMTR=",":$P($G(VADM(2)),U,2),1:$P($G(VADM(2)),U,1))
"RTN","DVBAB6",112,0)
 S EXAMRECRD=$S($G(ROFILTER)'=0:RONUM_DVBADLMTR,1:"")_""""_ADIV_""""_DVBADLMTR_""""_STATUS_""""_DVBADLMTR_""""_PNAM_""""_DVBADLMTR
"RTN","DVBAB6",113,0)
 S EXAMRECRD=EXAMRECRD_SSN_DVBADLMTR_$C(160)_CNUM_DVBADLMTR_$$FMTE^XLFDT(RDATE1,"5DZ")_DVBADLMTR_EDAYS_DVBADLMTR_TRNSFIN_DVBADLMTR
"RTN","DVBAB6",114,0)
 Q
"RTN","DVBAB6",115,0)
 ;
"RTN","DVBAB6",116,0)
NXT F DA(1)=0:0 S DA(1)=$O(^TMP($J,JX,PNAM,DFN,DA(1))) Q:DA(1)=""  D PRINT I $D(OUT) S DA(1)="",PNAM="ZZZZ",JX=$S($A(JX)>57:PNAM,1:9999999),DONE="YES"
"RTN","DVBAB6",117,0)
 Q
"RTN","DVBAB6",118,0)
TST F DA=0:0 S DA=$O(^DVB(396.4,"C",DA(1),DA)) Q:DA=""  K PRINT S TSTAT=$P(^DVB(396.4,DA,0),U,4),TST=$P(^DVB(396.4,DA,0),U,3),PRTNM=$S($D(^DVB(396.6,TST,0)):$P(^(0),U,2),1:"") D TST1
"RTN","DVBAB6",119,0)
 Q
"RTN","DVBAB6",120,0)
TST1 S TSTA1=""
"RTN","DVBAB6",121,0)
 I $D(^DVB(396.4,DA,"CAN")) S TSTA1=$P(^DVB(396.4,DA,"CAN"),U,3)
"RTN","DVBAB6",122,0)
 I $D(^DVB(396.4,DA,"TRAN")) S X=$P(^DVB(396.4,DA,"TRAN"),U,3)
"RTN","DVBAB6",123,0)
 S:TSTA1]"" TSTA1=$P(^DVB(396.5,TSTA1,0),U,1)
"RTN","DVBAB6",124,0)
 I $G(DVBADLMTR)'="," D
"RTN","DVBAB6",125,0)
 . S ^TMP("CAPRI",MSGCNT)=$S(PRTNM]"":PRTNM,1:"Missing exam name")
"RTN","DVBAB6",126,0)
 . S ^TMP("CAPRI",MSGCNT)=^TMP("CAPRI",MSGCNT)_$S(TSTA1]"":" - cancelled ("_TSTA1_")",TSTAT="T":" - Transferred",TSTAT]"":" - "_$$EXTERNAL^DILFD(396.4,.04,,TSTAT),TSTAT="":" (Unknown status)",1:"")_"^"
"RTN","DVBAB6",127,0)
 . S MSGCNT=MSGCNT+1
"RTN","DVBAB6",128,0)
 . I TSTAT="T" S X=$S($D(^DIC(4.2,+X,0)):$P(^(0),U,1),1:"unknown site") S ^TMP("CAPRI",MSGCNT)=" to "_$P(X,".",1),MSGCNT=MSGCNT+1
"RTN","DVBAB6",129,0)
 . Q
"RTN","DVBAB6",130,0)
 I $G(DVBADLMTR)="," D
"RTN","DVBAB6",131,0)
 . D CLAIMTYP,SPEC
"RTN","DVBAB6",132,0)
 . S PRTNM=$S(PRTNM]"":PRTNM,1:"Missing exam name"),TSTAT=$S(TSTA1]"":"Cancelled ("_TSTA1_")",TSTAT="T":"Transferred",TSTAT]"":$$EXTERNAL^DILFD(396.4,.04,,TSTAT),TSTAT="":" (Unknown status)",1:"")
"RTN","DVBAB6",133,0)
 . S ^TMP("CAPRI",MSGCNT)=EXAMRECRD_""""_PRTNM_""""_DVBADLMTR_""""_TSTAT_""""_DVBADLMTR_""""_DVBCELL_""""_DVBADLMTR_""""_DVBEMA_""""_DVBADLMTR_""""_DVBCTW_""""_DVBADLMTR_""""_DVBSCWA_""""
"RTN","DVBAB6",134,0)
 . I TSTAT="T" S X=$S($D(^DIC(4.2,+X,0)):$P(^(0),U,1),1:"unknown site") S ^TMP("CAPRI",MSGCNT)=^TMP("CAPRI",MSGCNT)_" to "_$P(X,".",1)
"RTN","DVBAB6",135,0)
 . S ^TMP("CAPRI",MSGCNT)=^TMP("CAPRI",MSGCNT)_$C(13)
"RTN","DVBAB6",136,0)
 S MSGCNT=MSGCNT+1
"RTN","DVBAB6",137,0)
 Q
"RTN","DVBAB6",138,0)
CLAIMTYP ;THE CLAIM TYPE OF A 2507 REQUEST
"RTN","DVBAB6",139,0)
 S DVBCTW=""
"RTN","DVBAB6",140,0)
 Q:'$D(^DVB(396.3,DA(1),9,0))
"RTN","DVBAB6",141,0)
 ;DVBIEN is the 2507 REQUEST FILE IEN
"RTN","DVBAB6",142,0)
 ;DVBCTW is the string /name of the CLAIM TYPE
"RTN","DVBAB6",143,0)
 D GETS^DIQ(396.3,DA(1)_",","9.1*","E","MSG","ERR")
"RTN","DVBAB6",144,0)
 S DVBCTW=$G(MSG("396.32","1,"_DA(1)_",",".01","E"))
"RTN","DVBAB6",145,0)
 Q
"RTN","DVBAB6",146,0)
 ;
"RTN","DVBAB6",147,0)
SPEC ;SPECIAL CONSIDERATION(S) FOR A 2507 REQUEST
"RTN","DVBAB6",148,0)
 K DVBSCW
"RTN","DVBAB6",149,0)
 S DVBSCWA=""
"RTN","DVBAB6",150,0)
 Q:'$D(^DVB(396.3,DA(1),8))
"RTN","DVBAB6",151,0)
 ;DA(1) is the 2507 REQUEST FILE IEN
"RTN","DVBAB6",152,0)
 ;DVBSC is a the SPECIAL CONSIDERATION entry for the 2507 REQUEST
"RTN","DVBAB6",153,0)
 ;DVBSCN is the pointer number to the SPECIAL CONSIDERATION file 396.25
"RTN","DVBAB6",154,0)
 ;DVBSCW is the string /name of the SPECIAL CONSIDERATION
"RTN","DVBAB6",155,0)
 S DVBAA=$P(^DVB(396.3,DA(1),8,0),U,4)
"RTN","DVBAB6",156,0)
 ;S DVBAA=$P($G(^DVB(396.3,DA(1),8,0)),U,4)
"RTN","DVBAB6",157,0)
 S (DVBSC,DVBCNT)=0 F  S DVBSC=$O(^DVB(396.3,DA(1),8,DVBSC)) Q:'DVBSC  D
"RTN","DVBAB6",158,0)
 .S DVBSCN=$P(^DVB(396.3,DA(1),8,DVBSC,0),U,1)
"RTN","DVBAB6",159,0)
 .S DVBSCW(DVBSC)=$G(^DVB(396.25,DVBSCN,0))
"RTN","DVBAB6",160,0)
 .S DVBCNT=DVBCNT+1
"RTN","DVBAB6",161,0)
 .I (DVBCNT'=DVBAA) S:$D(DVBSCW(DVBSC)) DVBSCW(DVBSC)=DVBSCW(DVBSC)_","
"RTN","DVBAB6",162,0)
 S DVBX="" F  S DVBX=$O(DVBSCW(DVBX)) Q:'DVBX  S DVBSCWA=DVBSCWA_DVBSCW(DVBX)
"RTN","DVBAB6",163,0)
 Q
"RTN","DVBAB6",164,0)
 ;
"RTN","DVBAB70")
0^16^B35957431^B38834112
"RTN","DVBAB70",1,0)
DVBAB70 ;ALB/SPH - CAPRI C&P EXAM INQUIRY ;09/28/2009
"RTN","DVBAB70",2,0)
 ;;2.7;AMIE;**35,42,57,136,143,149,193**;Apr 10, 1995;Build 84
"RTN","DVBAB70",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","DVBAB70",4,0)
 ;
"RTN","DVBAB70",5,0)
STRT(ZMSG,DFN,ZREQDA) ;
"RTN","DVBAB70",6,0)
 N DVBABCNT,REQDA,DA,X,Y,PNAM,NAME,DOB,SSN,CNUM,ADR1,ADR2,ADR3,CITY,STATE
"RTN","DVBAB70",7,0)
 N HOMPHON,BUSPHON,OTHDIS,OTHDIS1,OTHDIS2,COUNTY,PROVINCE,POSTALCD,COUNTRY
"RTN","DVBAB70",8,0)
 N ZIP,CANDT,PRBY,RELBY,DX,DXCOD,DXNUM,JII,PCT,SC,EDTA,EOD,RAD,LINE
"RTN","DVBAB70",9,0)
 N REQN,REQDT,RONAME,STAT,XSTAT
"RTN","DVBAB70",10,0)
 S DVBABCNT=0
"RTN","DVBAB70",11,0)
 K ^TMP($J)
"RTN","DVBAB70",12,0)
 S (DA,DA(1),REQDA)=+ZREQDA
"RTN","DVBAB70",13,0)
 S (NAME,SSN,CNUM,ADR1,ADR2,ADR3,CITY,STATE,ZIP,HOMPHON,BUSPHON,OTHDIS)=""
"RTN","DVBAB70",14,0)
 S (COUNTY,PROVINCE,POSTALCD,COUNTRY)=""
"RTN","DVBAB70",15,0)
 D VARS^DVBCUTIL
"RTN","DVBAB70",16,0)
START ;
"RTN","DVBAB70",17,0)
 S ZMSG(DVBABCNT)="                     COMPENSATION AND PENSION EXAM INQUIRY",DVBABCNT=DVBABCNT+1
"RTN","DVBAB70",18,0)
 S ZMSG(DVBABCNT)="                     -------------------------------------",DVBABCNT=DVBABCNT+1
"RTN","DVBAB70",19,0)
 S ZMSG(DVBABCNT)="",DVBABCNT=DVBABCNT+1
"RTN","DVBAB70",20,0)
 S ZMSG(DVBABCNT)="",DVBABCNT=DVBABCNT+1
"RTN","DVBAB70",21,0)
 S ZMSG(DVBABCNT)="                     Name: "_PNAM,DVBABCNT=DVBABCNT+1
"RTN","DVBAB70",22,0)
 S ZMSG(DVBABCNT)="                      SSN: "_SSN,DVBABCNT=DVBABCNT+1
"RTN","DVBAB70",23,0)
 S ZMSG(DVBABCNT)="                 C-Number: "_CNUM,DVBABCNT=DVBABCNT+1
"RTN","DVBAB70",24,0)
 S Y=DOB X ^DD("DD")
"RTN","DVBAB70",25,0)
 S ZMSG(DVBABCNT)="                      DOB: "_Y,DVBABCNT=DVBABCNT+1
"RTN","DVBAB70",26,0)
 S ZMSG(DVBABCNT)="                  Address: "_ADR1,DVBABCNT=DVBABCNT+1
"RTN","DVBAB70",27,0)
 I ADR2'="" S ZMSG(DVBABCNT)="                           "_ADR2,DVBABCNT=DVBABCNT+1
"RTN","DVBAB70",28,0)
 I ADR3'="" S ZMSG(DVBABCNT)="                           "_ADR3,DVBABCNT=DVBABCNT+1
"RTN","DVBAB70",29,0)
 I $$ISFORGN^DVBCUTIL(COUNTRY)>0 D
"RTN","DVBAB70",30,0)
 . S ZMSG(DVBABCNT)="City,Province,Postal Code: "_CITY_", "_PROVINCE_" "_POSTALCD
"RTN","DVBAB70",31,0)
 . S DVBABCNT=DVBABCNT+1
"RTN","DVBAB70",32,0)
 E  D
"RTN","DVBAB70",33,0)
 . S ZMSG(DVBABCNT)="         City,State,Zip+4: "_CITY_", "_STATE_" "_ZIP
"RTN","DVBAB70",34,0)
 . S DVBABCNT=DVBABCNT+1
"RTN","DVBAB70",35,0)
 I COUNTRY>0 D
"RTN","DVBAB70",36,0)
 . S ZMSG(DVBABCNT)="                  Country: "_$$GETCNTRY^DVBCUTIL(COUNTRY)
"RTN","DVBAB70",37,0)
 . S DVBABCNT=DVBABCNT+1
"RTN","DVBAB70",38,0)
 S ZMSG(DVBABCNT)="                Res Phone: "_HOMPHON,DVBABCNT=DVBABCNT+1
"RTN","DVBAB70",39,0)
 S ZMSG(DVBABCNT)="                Bus Phone: "_BUSPHON,DVBABCNT=DVBABCNT+1
"RTN","DVBAB70",40,0)
 S Y=EOD X ^DD("DD") S:Y="" Y="Not specified"
"RTN","DVBAB70",41,0)
 S ZMSG(DVBABCNT)="   Entered active service: "_Y,DVBABCNT=DVBABCNT+1
"RTN","DVBAB70",42,0)
 S Y=RAD X ^DD("DD") S:Y="" Y="Not specified"
"RTN","DVBAB70",43,0)
 S ZMSG(DVBABCNT)="  Released active service: "_Y,DVBABCNT=DVBABCNT+1
"RTN","DVBAB70",44,0)
 S ZMSG(DVBABCNT)="================================================================================",DVBABCNT=DVBABCNT+1
"RTN","DVBAB70",45,0)
 D ^DVBAB97,^DVBAB68
"RTN","DVBAB70",46,0)
 S REQDT=$P(^DVB(396.3,REQDA,0),U,2)
"RTN","DVBAB70",47,0)
 S Y=REQDT X ^DD("DD")
"RTN","DVBAB70",48,0)
 S ZMSG(DVBABCNT)="This request was initiated on "_$P(Y,"@",1)_" at "_$P(Y,"@",2),DVBABCNT=DVBABCNT+1
"RTN","DVBAB70",49,0)
 S ZMSG(DVBABCNT)="Requester: "_REQN,DVBABCNT=DVBABCNT+1
"RTN","DVBAB70",50,0)
 S ZMSG(DVBABCNT)="Requesting Regional Office: "_RONAME,DVBABCNT=DVBABCNT+1
"RTN","DVBAB70",51,0)
 S ZMSG(DVBABCNT)="VHA Division Processing Request: "_$P($$SITE^VASITE(,$P(^DVB(396.3,REQDA,1),U,4)),U,2),DVBABCNT=DVBABCNT+1
"RTN","DVBAB70",52,0)
 S ZMSG(DVBABCNT)="",DVBABCNT=DVBABCNT+1
"RTN","DVBAB70",53,0)
 I $D(^DVB(396.4,"C",REQDA)) S ZMSG(DVBABCNT)="Exams on this request: ",DVBABCNT=DVBABCNT+1 D TST^DVBAB96
"RTN","DVBAB70",54,0)
 I '$D(^DVB(396.4,"C",REQDA)) S ZMSG(DVBABCNT)="(No exams have yet been entered)",DVBABCNT=DVBABCNT+1
"RTN","DVBAB70",55,0)
 S ZMSG(DVBABCNT)="",DVBABCNT=DVBABCNT+1
"RTN","DVBAB70",56,0)
 S (XSTAT,STAT)=$P(^DVB(396.3,REQDA,0),U,18)
"RTN","DVBAB70",57,0)
 S XSTAT=$$RSTAT^DVBCUTL8(STAT)
"RTN","DVBAB70",58,0)
 S STAT=$$RTSTAT^DVBCUTL8(STAT)
"RTN","DVBAB70",59,0)
 S ZMSG(DVBABCNT)="** Status of request: ",DVBABCNT=DVBABCNT+1
"RTN","DVBAB70",60,0)
 ;S STAT=$S(XSTAT="N":"New",XSTAT="P":"Pending, reported to MAS",XSTAT="T":"Transcribed",XSTAT="S":"Scheduled",XSTAT="R":"Released, not printed",XSTAT="C":"Completed",XSTAT="CT":"Completed, transferred out",XSTAT="NT":"New, transferred in",1:"")
"RTN","DVBAB70",61,0)
 I STAT]"" S ZMSG(DVBABCNT)=STAT,DVBABCNT=DVBABCNT+1
"RTN","DVBAB70",62,0)
 I XSTAT="R"!(XSTAT="C") S Y=$P(^DVB(396.3,REQDA,0),U,14) X ^DD("DD") S RELBY=$P(^DVB(396.3,REQDA,0),U,15),RELBY=$S($D(^VA(200,+RELBY,0)):$P(^(0),U,1),1:"Unknown user") S ZMSG(DVBABCNT)="Released on "_Y_" by "_RELBY,DVBABCNT=DVBABCNT+1
"RTN","DVBAB70",63,0)
 I XSTAT="C" S Y=$P(^DVB(396.3,REQDA,0),U,16) X ^DD("DD") S PRBY=$P(^DVB(396.3,REQDA,0),U,17),PRBY=$S($D(^VA(200,+PRBY,0)):$P(^(0),U,1),1:"Unknown user") S ZMSG(DVBABCNT)="Printed by the RO on "_Y_" by "_PRBY,DVBABCNT=DVBABCNT+1
"RTN","DVBAB70",64,0)
 I STAT="" S STAT=$S(XSTAT="X":"Cancelled by MAS",XSTAT="RX":"Cancelled by RO",1:"Unknown") S ZMSG(DVBABCNT)=STAT,DVBABCNT=DVBABCNT+1
"RTN","DVBAB70",65,0)
 I STAT["Cancelled" S CANDT=$P(^DVB(396.3,REQDA,0),U,19) S ZMSG(DVBABCNT)="  (Cancelled on "_$$FMTE^XLFDT(CANDT,"5DZ")_")",DVBABCNT=DVBABCNT+1
"RTN","DVBAB70",66,0)
 I $D(^DVB(396.3,REQDA,1)),$P(^(1),U,3)="Y" S ZMSG(DVBABCNT)="This request was faxed to the regional office.",DVBABCNT=DVBABCNT+1
"RTN","DVBAB70",67,0)
 S FEXAM=$P(^DVB(396.3,REQDA,0),U,9) I FEXAM="Y" S ZMSG(DVBABCNT)="*** Exams done on a FEE BASIS ***  ",DVBABCNT=DVBABCNT+1 K FEXAM
"RTN","DVBAB70",68,0)
 S ZMSG(DVBABCNT)="--------------------------------------------------------------------------------",DVBABCNT=DVBABCNT+1
"RTN","DVBAB70",69,0)
 D DDIS
"RTN","DVBAB70",70,0)
 S ZMSG(DVBABCNT)="Other Disabilities: "_OTHDIS,DVBABCNT=DVBABCNT+1 I $D(^DVB(396.3,REQDA,1)) S ZMSG(DVBABCNT)="                    "_OTHDIS1,DVBABCNT=DVBABCNT+1 S ZMSG(DVBABCNT)="                    "_OTHDIS2,DVBABCNT=DVBABCNT+1
"RTN","DVBAB70",71,0)
 S ZMSG(DVBABCNT)="General Remarks:",DVBABCNT=DVBABCNT+1
"RTN","DVBAB70",72,0)
 F LINE=0:0 S LINE=$O(^DVB(396.3,REQDA,2,LINE)) Q:LINE=""  S ZMSG(DVBABCNT)=^(LINE,0),DVBABCNT=DVBABCNT+1
"RTN","DVBAB70",73,0)
END K ^TMP($J),TSTA1,TSTAT,XCNP
"RTN","DVBAB70",74,0)
 Q
"RTN","DVBAB70",75,0)
DDIS1 S ZMSG(DVBABCNT)=DX_"  "_$J(PCT,3,0)_" %",DVBABCNT=DVBABCNT+1
"RTN","DVBAB70",76,0)
 S ZMSG(DVBABCNT)="    Service-Connected? "_$S(SC=1:"Yes",1:"No")_"  DX Code: "_DXCOD,DVBABCNT=DVBABCNT+1
"RTN","DVBAB70",77,0)
 Q
"RTN","DVBAB70",78,0)
DDIS ;
"RTN","DVBAB70",79,0)
 I '$D(^DPT(DFN,.372)) S ZMSG(DVBABCNT)="No rated disabilities on file",DVBABCNT=DVBABCNT+1 Q
"RTN","DVBAB70",80,0)
 S ZMSG(DVBABCNT)="",DVBABCNT=DVBABCNT+1
"RTN","DVBAB70",81,0)
 S ZMSG(DVBABCNT)="RATED DISABILITIES:",DVBABCNT=DVBABCNT+1
"RTN","DVBAB70",82,0)
 F JII=0:0 S JII=$O(^DPT(DFN,.372,JII)) Q:JII=""  S DXNUM=$P(^DPT(DFN,.372,JII,0),U,1),PCT=$P(^(0),U,2),SC=$P(^(0),U,3),DX=$S($D(^DIC(31,DXNUM)):$P(^(DXNUM,0),U,1),1:"Unknown"),DXCOD=$S($D(^DIC(31,DXNUM)):$P(^(DXNUM,0),U,3),1:"Unknown") D DDIS1
"RTN","DVBAB70",83,0)
 S ZMSG(DVBABCNT)="",DVBABCNT=DVBABCNT+1
"RTN","DVBAB70",84,0)
 Q
"RTN","DVBAB82")
0^39^B149057820^B146075808
"RTN","DVBAB82",1,0)
DVBAB82 ;ALB/DJS - CAPRI DVBA REPORTS ; 01/24/12
"RTN","DVBAB82",2,0)
 ;;2.7;AMIE;**42,90,100,119,156,149,179,181,184,185,192,196,193**;Apr 10, 1995;Build 84
"RTN","DVBAB82",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","DVBAB82",4,0)
 ;ALB/RTW added subroutine VBACRPON to allow VBA reprint reqardless of office
"RTN","DVBAB82",5,0)
 Q
"RTN","DVBAB82",6,0)
 ;
"RTN","DVBAB82",7,0)
START(MSG,RPID,PARM) ; CALLED BY REMOTE PROCEDURE DVBAB REPORTS
"RTN","DVBAB82",8,0)
 ;Parameters
"RTN","DVBAB82",9,0)
 ;=============
"RTN","DVBAB82",10,0)
 ; MSG  : Output - ^TMP("DVBA",$J)
"RTN","DVBAB82",11,0)
 ; RPID : Report Identification Number
"RTN","DVBAB82",12,0)
 ; PARM : Input parameters separated by "^"
"RTN","DVBAB82",13,0)
 ;
"RTN","DVBAB82",14,0)
 N DVBHFS,DVBERR,DVBGUI,I,DVBADLMTD
"RTN","DVBAB82",15,0)
 K ^TMP("DVBA",$J)
"RTN","DVBAB82",16,0)
 S DVBGUI=1,(DVBERR,DVBADLMTD)=0,DVBHFS=$$HFS(),RPID=$G(RPID)
"RTN","DVBAB82",17,0)
 I RPID<1!(RPID>15) S DVBERR=1,^TMP("DVBA",$J,1)="0^Undefined Report ID" G END
"RTN","DVBAB82",18,0)
 D HFSOPEN("DVBRP",DVBHFS,"W") I DVBERR G END
"RTN","DVBAB82",19,0)
 I RPID=1 D CRMS G END
"RTN","DVBAB82",20,0)
 I RPID=3 D CPRNT G END
"RTN","DVBAB82",21,0)
 I RPID=11 D CNHRP G END  ;FNCNH Print Roster
"RTN","DVBAB82",22,0)
 D CHECK I DVBERR G END  ;reports below require parameters
"RTN","DVBAB82",23,0)
 I RPID=2 D CRRR G END
"RTN","DVBAB82",24,0)
 I RPID=4 D CRPON G END
"RTN","DVBAB82",25,0)
 ;DVBA*196 - I6184115FY16 REMOVE CALL TO VBACRPON
"RTN","DVBAB82",26,0)
 ;I RPID=4,$P(PARM,U,8)=0 D CRPON G END
"RTN","DVBAB82",27,0)
 ;I RPID=4,$P(PARM,U,8)=1 D VBACRPON G END
"RTN","DVBAB82",28,0)
 I RPID=5 D CIRPT G END
"RTN","DVBAB82",29,0)
 I RPID=6 D DSRP G END
"RTN","DVBAB82",30,0)
 I RPID=7 D SDPP G END
"RTN","DVBAB82",31,0)
 I RPID=8 D SPRPT G END
"RTN","DVBAB82",32,0)
 I RPID=9 D VIEW G END
"RTN","DVBAB82",33,0)
 I RPID=10 D CNHDEOC G END  ;FBCNH Display Episode Of Care
"RTN","DVBAB82",34,0)
 I RPID=12 D CNHRAD G END  ;FNCNH Report of Admissions/Discharges
"RTN","DVBAB82",35,0)
 I RPID=13 D CNHSE90D G END  ;FNCNH Stays in Excess of 90 Days
"RTN","DVBAB82",36,0)
 I RPID=14 D REQSTAT G END  ;REQUEST STATUS BY DATE RANGE
"RTN","DVBAB82",37,0)
 I RPID=15 D DVBA8861 G END  ;FORM 28-8861 STATUS REPORT
"RTN","DVBAB82",38,0)
 ;
"RTN","DVBAB82",39,0)
END D HFSCLOSE("DVBRP",DVBHFS)
"RTN","DVBAB82",40,0)
 I ($G(DVBADLMTD)&('+DVBERR)) D  Q  ;Create delimited output if no errors
"RTN","DVBAB82",41,0)
 .D DLMTRPT^DVBAB82D(RPID)
"RTN","DVBAB82",42,0)
 .S I=0 F  S I=$O(^TMP("DVBADLMTD",$J,I)) Q:I=""  D
"RTN","DVBAB82",43,0)
 ..I $G(^TMP("DVBADLMTD",$J,I))["##FFFF##" S ^TMP("DVBADLMTD",$J,I)=$TR(^TMP("DVBADLMTD",$J,I),"##FFFF##","")
"RTN","DVBAB82",44,0)
 .S MSG=$NA(^TMP("DVBADLMTD",$J))
"RTN","DVBAB82",45,0)
 ;Replace "##FFFF##" with Form Feeds - code needed for LINUX environments
"RTN","DVBAB82",46,0)
 S I=0 F  S I=$O(^TMP("DVBA",$J,1,I)) Q:'I  D
"RTN","DVBAB82",47,0)
 .S:^TMP("DVBA",$J,1,I)["##FFFF##" ^TMP("DVBA",$J,1,I)=$P(^TMP("DVBA",$J,1,I),"##FFFF##")_$C(13,12)_$P(^TMP("DVBA",$J,1,I),"##FFFF##",2)
"RTN","DVBAB82",48,0)
 .S ^TMP("DVBA",$J,1,I)=^TMP("DVBA",$J,1,I)_$C(13)
"RTN","DVBAB82",49,0)
 .S:^TMP("DVBA",$J,1,I)["$END" ^TMP("DVBA",$J,1,I)=""
"RTN","DVBAB82",50,0)
 S MSG=$NA(^TMP("DVBA",$J))
"RTN","DVBAB82",51,0)
 I ($G(RPID)=5)&($G(DVBADLMTR)=",") S MSG=$NA(^TMP("INSUFF",$J))
"RTN","DVBAB82",52,0)
 Q
"RTN","DVBAB82",53,0)
CHECK ; VALIDATE INPUT PARAMETERS
"RTN","DVBAB82",54,0)
 I $G(PARM)="" S DVBERR=1,^TMP("DVBA",$J,1)="0^Undefined Input Parameters"
"RTN","DVBAB82",55,0)
 Q
"RTN","DVBAB82",56,0)
 ;
"RTN","DVBAB82",57,0)
SDPP ; Report # 7 - Full (Patient Profile MAS) Report
"RTN","DVBAB82",58,0)
 ;Parameters
"RTN","DVBAB82",59,0)
 ;=============
"RTN","DVBAB82",60,0)
 ; DFN : Patient Identification Number
"RTN","DVBAB82",61,0)
 ; SDR : R/Range or A/All
"RTN","DVBAB82",62,0)
 ; SDBD : Begining date
"RTN","DVBAB82",63,0)
 ; SDED : Ending date
"RTN","DVBAB82",64,0)
 ; SDP : Print the profile? 1 OR 0
"RTN","DVBAB82",65,0)
 ; SDTYP(2) : Print appointments? 1 OR 0
"RTN","DVBAB82",66,0)
 ; SDTYP(1) : Print add/edits? 1 or 0
"RTN","DVBAB82",67,0)
 ; SDTYP(4) : Print enrollments? 1 or 0
"RTN","DVBAB82",68,0)
 ; SDTYP(3) : Print dispositions? 1 OR 0
"RTN","DVBAB82",69,0)
 ; SDTYP(7) : Print team information? 1 OR 0
"RTN","DVBAB82",70,0)
 ; SDTYP(5) : Print means test? 1 OR 0
"RTN","DVBAB82",71,0)
 ;
"RTN","DVBAB82",72,0)
 N SDTYP,SDBD,SDED,SDACT,SDPRINT,SDYES,SDRANGE,SDBEG,SDEN
"RTN","DVBAB82",73,0)
 S ^XTMP("JAP",$J,$$NOW^XLFDT(),"SDPP")=PARM
"RTN","DVBAB82",74,0)
 S DFN=$P(PARM,"^",1),SDR=$P(PARM,"^",2),SDBD=$P(PARM,"^",3),SDED=$P(PARM,"^",4)
"RTN","DVBAB82",75,0)
 S SDP=$P(PARM,"^",5),SDTYP(2)=$P(PARM,"^",6),SDTYP(1)=$P(PARM,"^",7)
"RTN","DVBAB82",76,0)
 S SDTYP(4)=$P(PARM,"^",8),SDTYP(3)=$P(PARM,"^",9),SDTYP(7)=$P(PARM,"^",10),SDTYP(5)=$P(PARM,"^",11)
"RTN","DVBAB82",77,0)
 D VAL Q:DVBERR
"RTN","DVBAB82",78,0)
 S SDACT="",(SDYES,SDRANGE,SDPRINT)=0
"RTN","DVBAB82",79,0)
 I SDR="R" S SDRANGE=1
"RTN","DVBAB82",80,0)
 I SDP=1 S SDYES=1,SDPRINT=1
"RTN","DVBAB82",81,0)
 I 'SDRANGE S (SDBD,SDBEG)=2800101,(SDED,SDEND)=$$ENDDT(),SDHDR=1
"RTN","DVBAB82",82,0)
 D ENS^%ZISS
"RTN","DVBAB82",83,0)
 S SDPRINT=1
"RTN","DVBAB82",84,0)
 S:(SDTYP(2)=1) SDTYP(2)=""  ;appointments
"RTN","DVBAB82",85,0)
 K:(SDTYP(2)=0) SDTYP(2)
"RTN","DVBAB82",86,0)
 S:(SDTYP(1)=1) SDTYP(1)=""  ;add/edits
"RTN","DVBAB82",87,0)
 K:(SDTYP(1)=0) SDTYP(1)
"RTN","DVBAB82",88,0)
 I (SDTYP(4)=1) S SDTYP(4)="",SDACT=0  ;enrollments
"RTN","DVBAB82",89,0)
 K:(SDTYP(4)=0) SDTYP(4)
"RTN","DVBAB82",90,0)
 S:(SDTYP(3)=1) SDTYP(3)=""  ;dispositions
"RTN","DVBAB82",91,0)
 K:(SDTYP(3)=0) SDTYP(3)
"RTN","DVBAB82",92,0)
 S:(SDTYP(5)=1) SDTYP(5)=""  ;means test
"RTN","DVBAB82",93,0)
 K:(SDTYP(5)=0) SDTYP(5)
"RTN","DVBAB82",94,0)
 I SDTYP(7)=1 D  ;team information
"RTN","DVBAB82",95,0)
 . S SDTYP(7)="",GBL="^TMP(""SDPP"","_$J_")"
"RTN","DVBAB82",96,0)
 K:(SDTYP(7)=0) SDTYP(7)
"RTN","DVBAB82",97,0)
 D PRINT^SDPPRT
"RTN","DVBAB82",98,0)
 S VALMBCK="R"
"RTN","DVBAB82",99,0)
 Q
"RTN","DVBAB82",100,0)
ENDDT() ;Calculate end date for "all" date
"RTN","DVBAB82",101,0)
 N DVBAPPTS,DVBX
"RTN","DVBAB82",102,0)
 S DVBAPPTS(1)=2800101,DVBAPPTS(4)=DFN,DVBAPPTS("SORT")="P"
"RTN","DVBAB82",103,0)
 S DVBAPPTS("FLDS")=1,DVBAPPTS("MAX")=-1
"RTN","DVBAB82",104,0)
 S DVBX=$S(($$SDAPI^SDAMA301(.DVBAPPTS)>0):$O(^TMP($J,"SDAMA301",DFN,0)),1:DT_.24)
"RTN","DVBAB82",105,0)
 K ^TMP($J,"SDAMA301")
"RTN","DVBAB82",106,0)
 Q DVBX
"RTN","DVBAB82",107,0)
 ;
"RTN","DVBAB82",108,0)
VIEW ; Report # 9 - View Registration Data Report
"RTN","DVBAB82",109,0)
 ; Parameters
"RTN","DVBAB82",110,0)
 ; ==========
"RTN","DVBAB82",111,0)
 ; DFN : Patient Identification Number
"RTN","DVBAB82",112,0)
 ;
"RTN","DVBAB82",113,0)
 U IO
"RTN","DVBAB82",114,0)
 S DFN=$P(PARM,"^",1)
"RTN","DVBAB82",115,0)
 D VAL Q:DVBERR
"RTN","DVBAB82",116,0)
 D EN1^DGRP
"RTN","DVBAB82",117,0)
 Q
"RTN","DVBAB82",118,0)
 ;
"RTN","DVBAB82",119,0)
DSRP ; Report # 6 - Reprint a Notice of Discharge Report
"RTN","DVBAB82",120,0)
 ; Parameters
"RTN","DVBAB82",121,0)
 ; % : 1=Report on all veterans for a given day (BDATE required)
"RTN","DVBAB82",122,0)
 ;   : 0=Report on a single Veteran (DFN required)
"RTN","DVBAB82",123,0)
 ; BDATE : Original Processing Date - $H/FileMan
"RTN","DVBAB82",124,0)
 ; DFN  : Patient Identification Number
"RTN","DVBAB82",125,0)
 ;
"RTN","DVBAB82",126,0)
 N %,BDATE,DFN,DFNIEN
"RTN","DVBAB82",127,0)
 S %=$P(PARM,"^",1),BDATE=$P(PARM,"^",2),DFN=$P(PARM,"^",3),DFNIEN=""
"RTN","DVBAB82",128,0)
 I BDATE="" S DVBERR=1,^TMP("DVBA",$J,1)="0^Incorrect Date"  Q
"RTN","DVBAB82",129,0)
 D DUZ2^DVBAUTIL
"RTN","DVBAB82",130,0)
 U IO
"RTN","DVBAB82",131,0)
 D VAL Q:DVBERR
"RTN","DVBAB82",132,0)
 I %=1 D  Q
"RTN","DVBAB82",133,0)
 . S HD="SINGLE NOTICE OF DISCHARGE REPRINTING"
"RTN","DVBAB82",134,0)
 . D NOPARM^DVBAUTL2
"RTN","DVBAB82",135,0)
 . I $D(DVBAQUIT) D KILL^DVBAUTIL Q  ;CAUTION: Short-circuit
"RTN","DVBAB82",136,0)
 . S DTAR=^DVB(396.1,1,0),FDT(0)=$$FMTE^XLFDT(DT,"5DZ")
"RTN","DVBAB82",137,0)
 . S HEAD="NOTICE OF DISCHARGE",HEAD1="FOR "_$P(DTAR,U,1)_" ON "_FDT(0)
"RTN","DVBAB82",138,0)
 . I $D(^DVB(396.2,"B",DFN)) D
"RTN","DVBAB82",139,0)
 . . S DFNIEN=$O(^DVB(396.2,"B",DFN,DFNIEN)),ADM=$P(^DVB(396.2,DFNIEN,0),U,3)
"RTN","DVBAB82",140,0)
 . . I $D(^DGPM(+ADM,0)),$P(^(0),U,17)]"" S DCHPTR=$P(^DGPM(+ADM,0),U,17),DISCH=$S($P(^DGPM(DCHPTR,0),U,1)]"":$P(^(0),U,1),1:"") W ?($X+5),"Discharge date: ",$$FMTE^XLFDT(DISCH,"5DZ")
"RTN","DVBAB82",141,0)
 . . I $P(^DVB(396.2,DFNIEN,0),U,7)'=DVBAD2 W *7,!!,"This does not belong to your RO.",!! H 3 Q
"RTN","DVBAB82",142,0)
 . . I DFNIEN>0 S XDA=DFNIEN,DA=$P(^DVB(396.2,DFNIEN,0),U,1),ADMDT=$P(^DVB(396.2,DFNIEN,0),U,2),MB=$P(^(0),U,3)
"RTN","DVBAB82",143,0)
 . . D REPRINT^DVBADSNT
"RTN","DVBAB82",144,0)
 D DEQUE^DVBADSRP
"RTN","DVBAB82",145,0)
 Q
"RTN","DVBAB82",146,0)
 ;
"RTN","DVBAB82",147,0)
SPRPT ; Report # 8 - OP(Operation Report)
"RTN","DVBAB82",148,0)
 ;Parameters
"RTN","DVBAB82",149,0)
 ;=============
"RTN","DVBAB82",150,0)
 ; DFN : Patient Identification Number
"RTN","DVBAB82",151,0)
 ; SRTN : Select Operation
"RTN","DVBAB82",152,0)
 ;
"RTN","DVBAB82",153,0)
 N DFN,SRTN,MAGTMPR2,SRSITE
"RTN","DVBAB82",154,0)
 I $O(^SRO(133,1))'="B" S SRSITE=1
"RTN","DVBAB82",155,0)
 S DFN=$P(PARM,"^",1),SRTN=$P(PARM,"^",2),MAGTMPR2=1
"RTN","DVBAB82",156,0)
 D VAL Q:DVBERR
"RTN","DVBAB82",157,0)
 D ^SROPRPT
"RTN","DVBAB82",158,0)
 Q
"RTN","DVBAB82",159,0)
 ;
"RTN","DVBAB82",160,0)
CRPON ; Report # - 4 Reprint C&P Final Report
"RTN","DVBAB82",161,0)
 ;Parameters
"RTN","DVBAB82",162,0)
 ;=============
"RTN","DVBAB82",163,0)
 ; RTYPE : Select Reprint Option (D)ate or (V)eteran
"RTN","DVBAB82",164,0)
 ; RUNDATE : ORIGINAL PROCESSING date
"RTN","DVBAB82",165,0)
 ; ANS : Reprinted by the RO or MAS
"RTN","DVBAB82",166,0)
 ; % : LAB 1 OR 0
"RTN","DVBAB82",167,0)
 ; DA(1) : Patient IEN for lab results
"RTN","DVBAB82",168,0)
 ; DFN  : Patient Identification Number
"RTN","DVBAB82",169,0)
 ;
"RTN","DVBAB82",170,0)
 U IO
"RTN","DVBAB82",171,0)
 N ONE,DVBAQ,DVBAWHO
"RTN","DVBAB82",172,0)
 S DVBAWHO=$P($G(PARM),U,8),DVBAQ=""
"RTN","DVBAB82",173,0)
 S RTYPE=$P(PARM,"^",1),RUNDATE=$P(PARM,"^",2),ANS=$P(PARM,"^",3),%=$P(PARM,"^",4),DA(1)=$P(PARM,"^",5),DFN=$P(PARM,"^",6),DA=DA(1)
"RTN","DVBAB82",174,0)
 I RTYPE="V" D VAL Q:DVBERR
"RTN","DVBAB82",175,0)
 S XDD=^DD("DD"),$P(ULINE,"_",70)="_",ONE="N",Y=DT
"RTN","DVBAB82",176,0)
 X XDD S HD="Reprint C & P Exams",SUPER=0
"RTN","DVBAB82",177,0)
 I $D(^XUSEC("DVBA C SUPERVISOR",DUZ)) S SUPER=1
"RTN","DVBAB82",178,0)
 S DVBCDT(0)=Y,PGHD="Compensation and Pension Exam Report",LOC=DUZ(2),PG=0,DVBCSITE=$S($D(^DVB(396.1,1,0)):$P(^(0),U,1),1:"Not specified")
"RTN","DVBAB82",179,0)
 I "^D^V^"'[RTYPE S DVBERR=1,^TMP("DVBA",$J,1)="0^Incorrect Data Type" Q
"RTN","DVBAB82",180,0)
 I ANS="R" K AUTO
"RTN","DVBAB82",181,0)
 I ANS="M" S AUTO=1
"RTN","DVBAB82",182,0)
 I "^M^R^"'[ANS S DVBERR=1,^TMP("DVBA",$J,1)="0^Incorrect Data Type" Q
"RTN","DVBAB82",183,0)
 I RTYPE="D" D GO^DVBCRPRT Q
"RTN","DVBAB82",184,0)
 ;DVBA*196 - I6184115FY16 FIX VALIDATION LOGIC FOR "BY VETERAN" TO MEET REQUIREMENTS IN PATCH 192
"RTN","DVBAB82",185,0)
 I RTYPE="V" D
"RTN","DVBAB82",186,0)
 . ;AJF;Request Status conversion
"RTN","DVBAB82",187,0)
 . S RQST=$$RSTAT^DVBCUTL8($P(^DVB(396.3,DA,0),U,18))
"RTN","DVBAB82",188,0)
 . S ONE="Y",RO=$P(^DVB(396.3,DA,0),U,3)
"RTN","DVBAB82",189,0)
 . I DVBAWHO=0  D
"RTN","DVBAB82",190,0)
 .. I RO'=DUZ(2)&('$D(AUTO))&(SUPER=0) W !!,*7,"Those results do not belong to your office.",!! S DVBAQ=1 Q
"RTN","DVBAB82",191,0)
 .. ;AJF;Request Status conversion
"RTN","DVBAB82",192,0)
 .. I RO=DUZ(2)&('$D(AUTO))&("RC"'[RQST) W *7,!!,"This request has not been released to the Regional Office yet.",!! S DVBAQ=1 Q
"RTN","DVBAB82",193,0)
 .. S PRTDATE=$P(^DVB(396.3,DA,0),U,16) I PRTDATE="" W *7,!!,"This has never been printed.",!! I SUPER=0 S OUT=1 S DVBAQ=1 Q
"RTN","DVBAB82",194,0)
 . I DVBAWHO=1 D
"RTN","DVBAB82",195,0)
 ..;AJF;Request Status conversion
"RTN","DVBAB82",196,0)
 .. I "RC"'[RQST W *7,!!,"This request has not been released to the Regional Office yet.",!! S DVBAQ=1 Q
"RTN","DVBAB82",197,0)
 . I DVBAQ=1 Q
"RTN","DVBAB82",198,0)
 . I %=1 D REN2^DVBCLABR Q
"RTN","DVBAB82",199,0)
 . ;D OV^DVBCRPON
"RTN","DVBAB82",200,0)
 . K DVBAON2 D SETLAB^DVBCPRNT,VARS^DVBCUTIL  D
"RTN","DVBAB82",201,0)
 ..I DVBAWHO=1 D VBASTEP2^DVBCRPRT
"RTN","DVBAB82",202,0)
 ..I DVBAWHO=0 D STEP2^DVBCRPRT
"RTN","DVBAB82",203,0)
 Q
"RTN","DVBAB82",204,0)
 ;
"RTN","DVBAB82",205,0)
VBACRPON ; Report # - 4 Reprint C&P Final Report by VBA personnel
"RTN","DVBAB82",206,0)
 ;Parameters
"RTN","DVBAB82",207,0)
 ;=============
"RTN","DVBAB82",208,0)
 ; RTYPE : Select Reprint Option (D)ate or (V)eteran
"RTN","DVBAB82",209,0)
 ; RUNDATE : ORIGINAL PROCESSING date
"RTN","DVBAB82",210,0)
 ; ANS : Reprinted by the RO or MAS
"RTN","DVBAB82",211,0)
 ; % : LAB 1 OR 0
"RTN","DVBAB82",212,0)
 ; DA(1) : Patient IEN for lab results
"RTN","DVBAB82",213,0)
 ; DFN  : Patient Identification Number
"RTN","DVBAB82",214,0)
 ;
"RTN","DVBAB82",215,0)
 S DVBERR=0
"RTN","DVBAB82",216,0)
 I $D(^TMP("DVBA",$J)) S DVBAX=(^TMP("DVBA",$J))
"RTN","DVBAB82",217,0)
 U IO
"RTN","DVBAB82",218,0)
 N ONE
"RTN","DVBAB82",219,0)
 S RTYPE=$P(PARM,"^",1),RUNDATE=$P(PARM,"^",2),ANS=$P(PARM,"^",3),%=$P(PARM,"^",4),DA(1)=$P(PARM,"^",5),DFN=$P(PARM,"^",6),DA=DA(1)
"RTN","DVBAB82",220,0)
 I RTYPE="V" D VAL Q:DVBERR
"RTN","DVBAB82",221,0)
 S XDD=^DD("DD"),$P(ULINE,"_",70)="_",ONE="N",Y=DT
"RTN","DVBAB82",222,0)
 X XDD S HD="Reprint C & P Exams"
"RTN","DVBAB82",223,0)
 S DVBCDT(0)=Y,PGHD="Compensation and Pension Exam Report",LOC=DUZ(2),PG=0,DVBCSITE=$S($D(^DVB(396.1,1,0)):$P(^(0),U,1),1:"Not specified")
"RTN","DVBAB82",224,0)
 I "^D^V^"'[RTYPE S DVBERR=1,^TMP("DVBA",$J,1)="0^Incorrect Data Type" Q
"RTN","DVBAB82",225,0)
 I ANS="R" K AUTO
"RTN","DVBAB82",226,0)
 I ANS="M" S AUTO=1
"RTN","DVBAB82",227,0)
 I "^M^R^"'[ANS S DVBERR=1,^TMP("DVBA",$J,1)="0^Incorrect Data Type" Q
"RTN","DVBAB82",228,0)
 I RTYPE="D" D VBAGO^DVBCRPRT Q
"RTN","DVBAB82",229,0)
 I RTYPE="V" D
"RTN","DVBAB82",230,0)
 . S ONE="Y",RO=$P(^DVB(396.3,DA,0),U,3)
"RTN","DVBAB82",231,0)
 . S PRTDATE=$P(^DVB(396.3,DA,0),U,16)
"RTN","DVBAB82",232,0)
 . I %=1 D REN2^DVBCLABR Q
"RTN","DVBAB82",233,0)
 . K DVBAON2 D SETLAB^DVBCPRNT,VARS^DVBCUTIL,VBASTEP2^DVBCRPRT
"RTN","DVBAB82",234,0)
 Q
"RTN","DVBAB82",235,0)
 ;
"RTN","DVBAB82",236,0)
CIRPT ; Report # 5 - Insufficient Exam Report
"RTN","DVBAB82",237,0)
 ;Parameters
"RTN","DVBAB82",238,0)
 ;=============
"RTN","DVBAB82",239,0)
 ; RPTTYPE : D/Detailed or S/Summary
"RTN","DVBAB82",240,0)
 ; BEGDT : Beginning date $H/FileMan
"RTN","DVBAB82",241,0)
 ; ENDDT : Ending date $H/FileMan
"RTN","DVBAB82",242,0)
 ; RESANS : Insufficient Reason
"RTN","DVBAB82",243,0)
 ; DVBAPRTY : Priority of Exam Code
"RTN","DVBAB82",244,0)
 ;    AO  : Agent Orange
"RTN","DVBAB82",245,0)
 ;    BDD : Benefits Delivery at Discharge / Quick Start
"RTN","DVBAB82",246,0)
 ;    IDES : Integrated Disability Evaluation System
"RTN","DVBAB82",247,0)
 ;    ALL : All Others (Original Report w/ all codes except the above)
"RTN","DVBAB82",248,0)
 ; DVBADLMTR: 0=non-delimted format, ","=delimiter for .csv file for EXCEL
"RTN","DVBAB82",249,0)
 ;
"RTN","DVBAB82",250,0)
 N DVBAPRTY,RPTTYPE,BEGDT,ENDDT,RESANS
"RTN","DVBAB82",251,0)
 U IO
"RTN","DVBAB82",252,0)
 S RPTTYPE=$P(PARM,"^",1),BEGDT=$P(PARM,"^",2),ENDDT=$P(PARM,"^",3),RESANS=""
"RTN","DVBAB82",253,0)
 S DVBADLMTR=$P(PARM,"^",6),DVBADLMTR=$S(DVBADLMTR=1:",",1:0)
"RTN","DVBAB82",254,0)
 S ENDDT=ENDDT_".2359"
"RTN","DVBAB82",255,0)
 I RPTTYPE="S" D SUM^DVBCIRP2 Q
"RTN","DVBAB82",256,0)
 I RPTTYPE="D" D
"RTN","DVBAB82",257,0)
 . D INREAS
"RTN","DVBAB82",258,0)
 . Q:($D(^TMP("DVBA",$J,1)))  ;invalid reason sent
"RTN","DVBAB82",259,0)
 . D EXMTPE,DETAIL^DVBCIRP2
"RTN","DVBAB82",260,0)
 Q
"RTN","DVBAB82",261,0)
 ;
"RTN","DVBAB82",262,0)
EXMTPE ;exam types (retrieve all for filter)
"RTN","DVBAB82",263,0)
 N DVBAXIFN
"RTN","DVBAB82",264,0)
 F DVBAXIFN=0:0 S DVBAXIFN=$O(^DVB(396.6,DVBAXIFN)) Q:+DVBAXIFN=0  DO
"RTN","DVBAB82",265,0)
 . S ^TMP($J,"XMTYPE",DVBAXIFN)=""
"RTN","DVBAB82",266,0)
 Q
"RTN","DVBAB82",267,0)
INREAS ;insufficient reason (validate specific or retrieve all)
"RTN","DVBAB82",268,0)
 N DVBAXIFN
"RTN","DVBAB82",269,0)
 D:(RESANS="")  ;use all insufficient reasons
"RTN","DVBAB82",270,0)
 .F DVBAXIFN=0:0 S DVBAXIFN=$O(^DVB(396.94,DVBAXIFN)) Q:+DVBAXIFN=0  DO
"RTN","DVBAB82",271,0)
 .. S DVBAARY("REASON",DVBAXIFN)=""
"RTN","DVBAB82",272,0)
 ;D:(RESANS'="")  ;use specific insufficient reason
"RTN","DVBAB82",273,0)
 ;.I ('$D(^DVB(396.94,+RESANS))) D  ;validate IEN
"RTN","DVBAB82",274,0)
 ;..S DVBERR=1,^TMP("DVBA",$J,1)="0^Invalid Insufficient Reason IEN"
"RTN","DVBAB82",275,0)
 ;.E  S DVBAARY("REASON",+RESANS)=""
"RTN","DVBAB82",276,0)
 Q
"RTN","DVBAB82",277,0)
 ;
"RTN","DVBAB82",278,0)
CRMS ; Report # 1 - Regional Office 21- day Certificate Printing Report.
"RTN","DVBAB82",279,0)
 ; No Parameters
"RTN","DVBAB82",280,0)
 ;
"RTN","DVBAB82",281,0)
 U IO
"RTN","DVBAB82",282,0)
 D ^DVBACRMS
"RTN","DVBAB82",283,0)
 Q
"RTN","DVBAB82",284,0)
 ;
"RTN","DVBAB82",285,0)
CRRR ; Report # 2 - Reprint a 21 - day Certificate for the RO
"RTN","DVBAB82",286,0)
 ;Parameters
"RTN","DVBAB82",287,0)
 ;=============
"RTN","DVBAB82",288,0)
 ; DVBSEL : Select one of the following:
"RTN","DVBAB82",289,0)
 ;       N         Patient Name
"RTN","DVBAB82",290,0)
 ;       D         ORIGINAL PROCESSING DATE
"RTN","DVBAB82",291,0)
 ; SDATE : ORIGINAL PROCESSING date - $H/FileMan
"RTN","DVBAB82",292,0)
 ; XDA : Patient IEN
"RTN","DVBAB82",293,0)
 ;
"RTN","DVBAB82",294,0)
 U IO
"RTN","DVBAB82",295,0)
 S DVBSEL=$P(PARM,"^",1),SDATE=$P(PARM,"^",2),XDA=$P(PARM,"^",3)
"RTN","DVBAB82",296,0)
 I "^D^N^"'[DVBSEL S DVBERR=1,^TMP("DVBA",$J,1)="0^Incorrect Data Type" Q
"RTN","DVBAB82",297,0)
 I DVBSEL="D" D  I DVBERR Q
"RTN","DVBAB82",298,0)
 . I SDATE="" S DVBERR=1,^TMP("DVBA",$J,1)="0^Undefined Date" Q
"RTN","DVBAB82",299,0)
 . S %DT="X" S X=SDATE D ^%DT I Y<0 D  Q
"RTN","DVBAB82",300,0)
 . . S DVBERR=1,^TMP("DVBA",$J,1)="0^Incorrect Date Format"
"RTN","DVBAB82",301,0)
 I DVBSEL="N" D  I DVBERR Q
"RTN","DVBAB82",302,0)
 . I XDA="" S DVBERR=1,^TMP("DVBA",$J,1)="0^Undefined Patient IEN" Q
"RTN","DVBAB82",303,0)
 . S DIC=2,DIC(0)="NZX",X=XDA D ^DIC I Y<0 D  I DVBERR Q
"RTN","DVBAB82",304,0)
 . . S DVBERR=1,^TMP("DVBA",$J,1)="0^Invalid Patient Name."
"RTN","DVBAB82",305,0)
 . S DFN=XDA
"RTN","DVBAB82",306,0)
 D INIT^DVBACRRR I 'CONT Q
"RTN","DVBAB82",307,0)
 D HDR^DVBACRRR,DATA^DVBACRRR
"RTN","DVBAB82",308,0)
 Q
"RTN","DVBAB82",309,0)
 ;
"RTN","DVBAB82",310,0)
CPRNT ; Report # 3 - Print C&P Final Report (manual) Report
"RTN","DVBAB82",311,0)
 ; No Parameters
"RTN","DVBAB82",312,0)
 ;
"RTN","DVBAB82",313,0)
 S XDD=^DD("DD"),$P(ULINE,"_",70)="_",Y=DT
"RTN","DVBAB82",314,0)
 X XDD S DVBCDT(0)=Y,PGHD="Compensation and Pension Exam Report",DVBCSITE=$S($D(^DVB(396.1,1,0)):$P(^(0),U,1),1:"Not Specified")
"RTN","DVBAB82",315,0)
 D GO^DVBCPRNT
"RTN","DVBAB82",316,0)
 Q
"RTN","DVBAB82",317,0)
VAL ; VALIDATE PATIENT
"RTN","DVBAB82",318,0)
 I $G(DFN)="" S DVBERR=1,^TMP("DVBA",$J,1)="0^Undefined Patient IEN" G END
"RTN","DVBAB82",319,0)
 S DIC=2,DIC(0)="NZX",X=DFN D ^DIC
"RTN","DVBAB82",320,0)
 I Y<0 S DVBERR=1,^TMP("DVBA",$J,1)="0^Invalid Patient Name." G END
"RTN","DVBAB82",321,0)
 Q
"RTN","DVBAB82",322,0)
 ;
"RTN","DVBAB82",323,0)
VALDATE(DVBADTE) ;Validate Date
"RTN","DVBAB82",324,0)
 ;dates must be valid internal FileMan format
"RTN","DVBAB82",325,0)
 N X,Y,%DT
"RTN","DVBAB82",326,0)
 S %DT="X",X=DVBADTE D ^%DT
"RTN","DVBAB82",327,0)
 S:(Y=-1) DVBERR=1,^TMP("DVBA",$J,1)="0^Invalid FileMan formatted date."
"RTN","DVBAB82",328,0)
 Q
"RTN","DVBAB82",329,0)
 ;
"RTN","DVBAB82",330,0)
CNHDEOC ; Report #10 - FBCNH Display Episode of Care
"RTN","DVBAB82",331,0)
 ; Parameters
"RTN","DVBAB82",332,0)
 ; ==========
"RTN","DVBAB82",333,0)
 ;   DFN : IEN in PATIENT (#2) file
"RTN","DVBAB82",334,0)
 ;   IFN : IEN in FEE CNH ACTIVITY (#162.3) file
"RTN","DVBAB82",335,0)
 ;
"RTN","DVBAB82",336,0)
 U IO
"RTN","DVBAB82",337,0)
 N DFN,IFN
"RTN","DVBAB82",338,0)
 S DFN=$P(PARM,U,1),IFN=$P(PARM,U,2)
"RTN","DVBAB82",339,0)
 D ^FBNHDEC  ;DBIA#: 5566
"RTN","DVBAB82",340,0)
 Q
"RTN","DVBAB82",341,0)
 ;
"RTN","DVBAB82",342,0)
CNHRP ; Report #11 - FBCNH Roster Print
"RTN","DVBAB82",343,0)
 ; Parameters
"RTN","DVBAB82",344,0)
 ; ==========
"RTN","DVBAB82",345,0)
 ;   DVBADLMTD : 0 (Standard) or 1 (Delimited)
"RTN","DVBAB82",346,0)
 ; 
"RTN","DVBAB82",347,0)
 U IO
"RTN","DVBAB82",348,0)
 S DVBADLMTD=+$P($G(PARM),U)
"RTN","DVBAB82",349,0)
 D START^FBNHROS  ;DBIA#: 5566
"RTN","DVBAB82",350,0)
 Q
"RTN","DVBAB82",351,0)
 ;
"RTN","DVBAB82",352,0)
CNHRAD ; Report #12 - FBCNH Report of Admissions/Discharges
"RTN","DVBAB82",353,0)
 ; Parameters
"RTN","DVBAB82",354,0)
 ; ==========
"RTN","DVBAB82",355,0)
 ;   BEGDATE   : Start date in FM format
"RTN","DVBAB82",356,0)
 ;   ENDDATE   : End date in FM format
"RTN","DVBAB82",357,0)
 ;   DVBADLMTD : 0 (Standard) or 1 (Delimited)
"RTN","DVBAB82",358,0)
 ;
"RTN","DVBAB82",359,0)
 U IO
"RTN","DVBAB82",360,0)
 N BEGDATE,ENDDATE
"RTN","DVBAB82",361,0)
 S BEGDATE=$P(PARM,U,1),ENDDATE=$P(PARM,U,2)
"RTN","DVBAB82",362,0)
 S DVBADLMTD=+$P(PARM,U,3)
"RTN","DVBAB82",363,0)
 D VALDATE(BEGDATE),VALDATE(ENDDATE)
"RTN","DVBAB82",364,0)
 D:('+DVBERR) START^FBNHAMIE  ;DBIA#: 5566
"RTN","DVBAB82",365,0)
 Q
"RTN","DVBAB82",366,0)
 ;
"RTN","DVBAB82",367,0)
CNHSE90D ; Report #13 - FBCNH Stays in Excess of 90 Days
"RTN","DVBAB82",368,0)
 ; Parameters
"RTN","DVBAB82",369,0)
 ; ==========
"RTN","DVBAB82",370,0)
 ;   FBDT      : Effective date in FM format
"RTN","DVBAB82",371,0)
 ;   DVBADLMTD : 0 (Standard) or 1 (Delimited)
"RTN","DVBAB82",372,0)
 ;
"RTN","DVBAB82",373,0)
 U IO
"RTN","DVBAB82",374,0)
 N FBDT
"RTN","DVBAB82",375,0)
 S FBDT=$P(PARM,U,1),DVBADLMTD=+$P(PARM,U,2)
"RTN","DVBAB82",376,0)
 D VALDATE(FBDT)
"RTN","DVBAB82",377,0)
 D:('+DVBERR) START^FBNHAMI2  ;DBIA#: 5566
"RTN","DVBAB82",378,0)
 Q
"RTN","DVBAB82",379,0)
 ;
"RTN","DVBAB82",380,0)
HFS() ; -- get hfs file name
"RTN","DVBAB82",381,0)
 N H
"RTN","DVBAB82",382,0)
 S H=$H
"RTN","DVBAB82",383,0)
 Q "DVBA_"_$J_"_"_$P(H,",")_"_"_$P(H,",",2)_".DAT"
"RTN","DVBAB82",384,0)
 ;
"RTN","DVBAB82",385,0)
HFSOPEN(HANDLE,DVBHFS,DVBMODE) ; Open File
"RTN","DVBAB82",386,0)
 S DVBDIRY=$$GET^XPAR("DIV","DVB HFS SCRATCH")
"RTN","DVBAB82",387,0)
 ;I DVBDIRY="" S ECERR=1 D  Q
"RTN","DVBAB82",388,0)
 ;. S ^TMP("DVBA",$J,1)="0^A scratch directory for reports doesn't exist"
"RTN","DVBAB82",389,0)
 D OPEN^%ZISH(HANDLE,,DVBHFS,$G(DVBMODE,"W")) D:POP  Q:POP
"RTN","DVBAB82",390,0)
 .S DVBERR=1,^TMP("DVBA",$J,1)="0^Unable to open file "
"RTN","DVBAB82",391,0)
 S IOF="$$IOF^DVBAB82"   ;resets screen position and adds page break flag - added to deal with Linux environments.
"RTN","DVBAB82",392,0)
 Q
"RTN","DVBAB82",393,0)
 ;
"RTN","DVBAB82",394,0)
HFSCLOSE(HANDLE,DVBHFS) ;Close HFS and unload data
"RTN","DVBAB82",395,0)
 N DVBDEL,X,%ZIS
"RTN","DVBAB82",396,0)
 D CLOSE^%ZISH(HANDLE)
"RTN","DVBAB82",397,0)
 S DVBDEL(DVBHFS)=""
"RTN","DVBAB82",398,0)
 S ROOT=$NA(^TMP("DVBA",$J,1))
"RTN","DVBAB82",399,0)
 K:('+DVBERR) @ROOT
"RTN","DVBAB82",400,0)
 S X=$$FTG^%ZISH(,DVBHFS,$NA(@ROOT@(1)),4)
"RTN","DVBAB82",401,0)
 S X=$$DEL^%ZISH(,$NA(DVBDEL))
"RTN","DVBAB82",402,0)
 Q
"RTN","DVBAB82",403,0)
 ;
"RTN","DVBAB82",404,0)
IOF() ;used to reset position and insert page break flag when @IOF is executed.
"RTN","DVBAB82",405,0)
 S $X=0,$Y=0
"RTN","DVBAB82",406,0)
 Q "##FFFF##"_$C(13,10)
"RTN","DVBAB82",407,0)
 ;
"RTN","DVBAB82",408,0)
REQSTAT ; Report #14 - Request Status by Date Range
"RTN","DVBAB82",409,0)
 ; Parameters
"RTN","DVBAB82",410,0)
 ; ==========
"RTN","DVBAB82",411,0)
 ; BEGDAT        : Start date in FM format
"RTN","DVBAB82",412,0)
 ; ENDDAT        : End date in FM format
"RTN","DVBAB82",413,0)
 ; REQSTAT       : Request Status filter
"RTN","DVBAB82",414,0)
 ; ISDELIM       : 0 (Standard format); 1 (Delimited format)
"RTN","DVBAB82",415,0)
 ; ISNODT        : 0 (Use date range); 1 (Ignore date range)
"RTN","DVBAB82",416,0)
 U IO
"RTN","DVBAB82",417,0)
 N BEGDAT,ENDDAT,REQSTAT
"RTN","DVBAB82",418,0)
 S BEGDAT=$P(PARM,U,1),ENDDAT=$P(PARM,U,2)
"RTN","DVBAB82",419,0)
 S REQSTAT=$P(PARM,U,3),ISDELIM=$P(PARM,U,4),ISNODT=$P(PARM,U,5)
"RTN","DVBAB82",420,0)
 D VALDATE(BEGDAT),VALDATE(ENDDAT)
"RTN","DVBAB82",421,0)
 D:('+DVBERR) REQSTAT^DVBARSBD(BEGDAT,ENDDAT,REQSTAT,ISDELIM,ISNODT)
"RTN","DVBAB82",422,0)
 Q
"RTN","DVBAB82",423,0)
 ;
"RTN","DVBAB82",424,0)
DVBA8861 ; Report #15 - Form 28-8861 Status Report
"RTN","DVBAB82",425,0)
 ; Parameters
"RTN","DVBAB82",426,0)
 ; ==========
"RTN","DVBAB82",427,0)
 ; BEGDAT  -  Start date in FM format
"RTN","DVBAB82",428,0)
 ; ENDDAT  -  End date in FM format
"RTN","DVBAB82",429,0)
 ; ROSTAT  -  Regional Office filter
"RTN","DVBAB82",430,0)
 ; REQSTAT -  Request Status filter
"RTN","DVBAB82",431,0)
 ; DELIMTER - 0 (Standard format); 1 (Delimited format)
"RTN","DVBAB82",432,0)
 ;
"RTN","DVBAB82",433,0)
 U IO
"RTN","DVBAB82",434,0)
 N BEGDAT,ENDDAT,REQSTAT
"RTN","DVBAB82",435,0)
 S BEGDAT=$P(PARM,U,1),ENDDAT=$P(PARM,U,2)
"RTN","DVBAB82",436,0)
 S ROSTAT=$P(PARM,U,3),REQSTAT=$P(PARM,U,4),DELIMTER=$P(PARM,U,5)
"RTN","DVBAB82",437,0)
 D VALDATE(BEGDAT),VALDATE(ENDDAT)
"RTN","DVBAB82",438,0)
 D:('+DVBERR) STATRPT^DVBA8861(BEGDAT,ENDDAT,ROSTAT,REQSTAT,DELIMTER)
"RTN","DVBAB82",439,0)
 Q
"RTN","DVBABEBD")
0^4^B12975161^B13866320
"RTN","DVBABEBD",1,0)
DVBABEBD ;ALB - CAPRI EXAM BY DATE REPORT;09/13/04 ; 2/10/11 12:12pm
"RTN","DVBABEBD",2,0)
 ;;2.7;AMIE;**57,108,185,190,192,193**;Apr 10, 1995;Build 84
"RTN","DVBABEBD",3,0)
 ;ALB/RTW - 192 added Claim Type,and Special Consideration(s)
"RTN","DVBABEBD",4,0)
 Q
"RTN","DVBABEBD",5,0)
 ;
"RTN","DVBABEBD",6,0)
EXAMBYDT(MSG,BEGDT,ENDDT,DVBADLMTR) ; CALLED BY REMOTE PROCEDURE DVBAB EXAMS BY DATE
"RTN","DVBABEBD",7,0)
 N DVBABCNT,DVBABIEN,DVBABPAT,DVBABT,DVBAB0,DVBABT1,DVBABT2,DVBABT3,DVBABT4,DVBABT5,DVBABT6,DFN
"RTN","DVBABEBD",8,0)
 N DVBAA,DVBCNT,DVBX,DVBAD,DVBCTN,DVBCTW,DVBSC,DVBSCC,DVBSCN,DVBSCNS,DVBSCW,DVBSCWA,VADM
"RTN","DVBABEBD",9,0)
 ; GRE;  Reroute information added to report and CSV file
"RTN","DVBABEBD",10,0)
 N RRIENINC,RRSTATINC,RRSTAT,RRDATE,RRTOSITE,RRFRMSITE,RRSTATDTE
"RTN","DVBABEBD",11,0)
 S DVBADLMTR=$S($G(DVBADLMTR)=1:",",1:0)
"RTN","DVBABEBD",12,0)
 S DVBAD=DVBADLMTR
"RTN","DVBABEBD",13,0)
 ; AJF ; Request Status Conversion; removed call to SETSTAT 
"RTN","DVBABEBD",14,0)
 K ^TMP("DVBABEBD",DUZ)
"RTN","DVBABEBD",15,0)
 I $G(DVBAD)="," D
"RTN","DVBABEBD",16,0)
 . S ^TMP("DVBABEBD",DUZ,1)="SSN"_DVBAD_"PATIENT NAME"_DVBAD_"REQUEST DATE"_DVBAD_"DATE RELEASED"_DVBAD_"DATE PRINTED BY RO"_DVBAD_"REQUEST STATUS"_DVBAD_"CLAIM TYPE"_DVBAD_"SPECIAL CONSIDERATION(S)"_$C(13)
"RTN","DVBABEBD",17,0)
 S DVBABCNT=$S(DVBAD'=",":1,1:2),DVBABIEN=0,MSG=$NA(^TMP("DVBABEBD",DUZ))
"RTN","DVBABEBD",18,0)
 F  S DVBABIEN=$O(^DVB(396.3,DVBABIEN)) Q:+DVBABIEN=0  D
"RTN","DVBABEBD",19,0)
 . ;REQUEST DATE
"RTN","DVBABEBD",20,0)
 . S DVBAB0=$G(^DVB(396.3,DVBABIEN,0)) Q:DVBAB0=""
"RTN","DVBABEBD",21,0)
 . S DVBABPAT=$G(^DPT($P(DVBAB0,"^"),0)) Q:DVBABPAT=""
"RTN","DVBABEBD",22,0)
 . S DVBABT2=$P($P(DVBAB0,"^",2),".")
"RTN","DVBABEBD",23,0)
 . I (DVBABT2>(BEGDT-1))&(DVBABT2<(ENDDT+1)) D
"RTN","DVBABEBD",24,0)
 .. S DVBABT1=$P(DVBABPAT,"^",1) ;PATIENT NAME
"RTN","DVBABEBD",25,0)
 .. S DFN=$P(DVBAB0,"^") D DEM^VADPT I $G(VADM(1))'="" S DVBABT6=$S($G(DVBAD)=",":$P($G(VADM(2)),U,2),1:$P($G(VADM(2)),U,1))  ;SSN
"RTN","DVBABEBD",26,0)
 .. S DVBABT3=$P($P(DVBAB0,"^",14),".") ;DATE RELEASED
"RTN","DVBABEBD",27,0)
 .. S DVBABT4=$P($P(DVBAB0,"^",16),".") ;DATE PRINTED BY RO
"RTN","DVBABEBD",28,0)
 .. S DVBABT5=$P(DVBAB0,"^",18) ;REQUEST STATUS
"RTN","DVBABEBD",29,0)
 .. S (DVBCTW,DVBSCWA)="" D CLAIMTYP,SPEC
"RTN","DVBABEBD",30,0)
 .. ;AJF ; Request Status Conversion
"RTN","DVBABEBD",31,0)
 .. S DVBABT5=$$RTSTAT^DVBCUTL8(DVBABT5)
"RTN","DVBABEBD",32,0)
 .. S DVBABT2=$$FMTE^XLFDT(DVBABT2,"5DZ"),DVBABT3=$$FMTE^XLFDT(DVBABT3,"5DZ"),DVBABT4=$$FMTE^XLFDT(DVBABT4,"5DZ")
"RTN","DVBABEBD",33,0)
 .. I $G(DVBAD)'="," S ^TMP("DVBABEBD",DUZ,DVBABCNT)=DVBABT1_U_DVBABT2_U_DVBABT3_U_DVBABT4_U_DVBABT5_U_DVBABT6_U_DVBCTW_U_DVBSCWA_$C(13)
"RTN","DVBABEBD",34,0)
 .. I $G(DVBAD)="," S ^TMP("DVBABEBD",DUZ,DVBABCNT)=DVBABT6_DVBADLMTR_""""_DVBABT1_""""_DVBADLMTR_$$FMTE^XLFDT(DVBABT2,"5DZ")_DVBADLMTR_$$FMTE^XLFDT(DVBABT3,"5DZ")_DVBADLMTR_$$FMTE^XLFDT(DVBABT4,"5DZ") D
"RTN","DVBABEBD",35,0)
 .. .S ^TMP("DVBABEBD",DUZ,DVBABCNT)=^TMP("DVBABEBD",DUZ,DVBABCNT)_DVBADLMTR_""""_DVBABT5_""""_DVBAD_""""_DVBCTW_""""_DVBAD_""""_DVBSCWA_""""_$C(13)
"RTN","DVBABEBD",36,0)
 .. S DVBABCNT=DVBABCNT+1
"RTN","DVBABEBD",37,0)
 Q
"RTN","DVBABEBD",38,0)
 ;
"RTN","DVBABEBD",39,0)
CLAIMTYP ;THE CLAIM TYPE OF A 2507 REQUEST
"RTN","DVBABEBD",40,0)
 S DVBCTW=""
"RTN","DVBABEBD",41,0)
 Q:'$D(^DVB(396.3,DVBABIEN,9,0))
"RTN","DVBABEBD",42,0)
 ;DVBIEN is the 2507 REQUEST FILE IEN
"RTN","DVBABEBD",43,0)
 ;DVBCTW is the string /name of the CLAIM TYPE
"RTN","DVBABEBD",44,0)
 D GETS^DIQ(396.3,DVBABIEN_",","9.1*","E","MSG","ERR")
"RTN","DVBABEBD",45,0)
 S DVBCTW=MSG("396.32","1,"_DVBABIEN_",",".01","E")
"RTN","DVBABEBD",46,0)
 Q
"RTN","DVBABEBD",47,0)
 ;
"RTN","DVBABEBD",48,0)
SPEC ;SPECIAL CONSIDERATION(S) FOR A 2507 REQUEST
"RTN","DVBABEBD",49,0)
 K DVBSCW
"RTN","DVBABEBD",50,0)
 S DVBSCWA=""
"RTN","DVBABEBD",51,0)
 Q:'$D(^DVB(396.3,DVBABIEN,8))
"RTN","DVBABEBD",52,0)
 ;DVBABIEN is the 2507 REQUEST FILE IEN
"RTN","DVBABEBD",53,0)
 ;DVBSC is a the SPECIAL CONSIDERATION entry for the 2507 REQUEST
"RTN","DVBABEBD",54,0)
 ;DVBSCN is the pointer number to the SPECIAL CONSIDERATION file 396.25
"RTN","DVBABEBD",55,0)
 ;DVBSCW is the string /name of the SPECIAL CONSIDERATION
"RTN","DVBABEBD",56,0)
 S DVBAA=$P(^DVB(396.3,DVBABIEN,8,0),U,4)
"RTN","DVBABEBD",57,0)
 S (DVBSC,DVBCNT)=0 F  S DVBSC=$O(^DVB(396.3,DVBABIEN,8,DVBSC)) Q:'DVBSC  D
"RTN","DVBABEBD",58,0)
 .S DVBSCN=$P(^DVB(396.3,DVBABIEN,8,DVBSC,0),U,1)
"RTN","DVBABEBD",59,0)
 .S DVBSCW(DVBSC)=$G(^DVB(396.25,DVBSCN,0))
"RTN","DVBABEBD",60,0)
 .S DVBCNT=DVBCNT+1
"RTN","DVBABEBD",61,0)
 .I (DVBCNT'=DVBAA) S:$D(DVBSCW(DVBSC)) DVBSCW(DVBSC)=DVBSCW(DVBSC)_","
"RTN","DVBABEBD",62,0)
 S DVBX="" F  S DVBX=$O(DVBSCW(DVBX)) Q:'DVBX  S DVBSCWA=DVBSCWA_DVBSCW(DVBX)
"RTN","DVBABEBD",63,0)
 Q
"RTN","DVBABEBD",64,0)
 ;
"RTN","DVBACRVA")
0^26^B10866271^n/a
"RTN","DVBACRVA",1,0)
DVBACRVA ;SLC/GRE - ; 01/08/2016
"RTN","DVBACRVA",2,0)
 ;;2.7;AMIE;**193**;AUG 30,2016;Build 84
"RTN","DVBACRVA",3,0)
 ;
"RTN","DVBACRVA",4,0)
 ;Public, Supported ICRs
"RTN","DVBACRVA",5,0)
 ; #2056 - Fileman API - $$GET1^DIQ
"RTN","DVBACRVA",6,0)
 ;
"RTN","DVBACRVA",7,0)
 Q
"RTN","DVBACRVA",8,0)
 ;
"RTN","DVBACRVA",9,0)
GETFAC(RESULT,SORTBY)   ; Extract records from file and sort by State Code
"RTN","DVBACRVA",10,0)
 K ^TMP($J)
"RTN","DVBACRVA",11,0)
 N II,FACNAME,STATE,ST,STATION,STATX,FIEN,FACTYPE,R,F1,F11,F2,F2N
"RTN","DVBACRVA",12,0)
 N VAMCNAME,A1,RES,X,X1
"RTN","DVBACRVA",13,0)
 S (FACNAME,STATE,ST,STATION,STATX,FIEN,FACTYPE,F1,F11,F2,F2N,VAMCNAME)=""
"RTN","DVBACRVA",14,0)
 S (R,II)=0
"RTN","DVBACRVA",15,0)
 ; % IS THE FIRST XREF
"RTN","DVBACRVA",16,0)
 F  S II=$O(^DVB(396.195,II)) Q:II=""  Q:II="B"  D
"RTN","DVBACRVA",17,0)
  . S X=^DVB(396.195,II,0)
"RTN","DVBACRVA",18,0)
  . ;S X1=$G(^DIC(4,II,99))  ;sSTATION NUMBER;$G SETS TO NULL IF RECORD DOES NOT EXIST
"RTN","DVBACRVA",19,0)
  . S FACNAME=$P(X,U,1)
"RTN","DVBACRVA",20,0)
  . S FNAME=$P(FACNAME,"located",1)
"RTN","DVBACRVA",21,0)
  . S ST=$P(X,U,2)
"RTN","DVBACRVA",22,0)
  . S STATION=$$DSTAT(II) Q:STATION=""
"RTN","DVBACRVA",23,0)
  . S:SORTBY="STATE" RES(ST,II)=U_FACNAME_U_II_U_STATION
"RTN","DVBACRVA",24,0)
  . S:SORTBY="NAME" RESULT(FNAME)=U_FACNAME_U_II_U_STATION
"RTN","DVBACRVA",25,0)
 I SORTBY="STATE" S (R,II)=0,ST="" D
"RTN","DVBACRVA",26,0)
  . N CNT S CNT=0
"RTN","DVBACRVA",27,0)
  . F  S ST=$O(RES(ST)) Q:ST=""  D
"RTN","DVBACRVA",28,0)
  .. S II=0
"RTN","DVBACRVA",29,0)
  .. F  S II=$O(RES(ST,II)) Q:II=""  D
"RTN","DVBACRVA",30,0)
  ... S CNT=$G(CNT)+1
"RTN","DVBACRVA",31,0)
  ... S RESULT(CNT)=RES(ST,II)
"RTN","DVBACRVA",32,0)
  Q
"RTN","DVBACRVA",33,0)
  ;
"RTN","DVBACRVA",34,0)
DSTAT(RSI) ; Returns Domain Station Number
"RTN","DVBACRVA",35,0)
  ;
"RTN","DVBACRVA",36,0)
  N DMNI,DMN
"RTN","DVBACRVA",37,0)
  Q:RSI="" 0
"RTN","DVBACRVA",38,0)
  Q:'$D(^DVB(396.195,RSI,0)) 0
"RTN","DVBACRVA",39,0)
  ;
"RTN","DVBACRVA",40,0)
  S DMN=$P(^DVB(396.195,RSI,0),"^",3)
"RTN","DVBACRVA",41,0)
  S DMNI=$O(^DIC(4.2,"B",DMN,""))
"RTN","DVBACRVA",42,0)
  Q:DMNI="" 0
"RTN","DVBACRVA",43,0)
  S STN=$P(^DIC(4.2,DMNI,0),"^",13)
"RTN","DVBACRVA",44,0)
  Q STN
"RTN","DVBACRVA",45,0)
  ;
"RTN","DVBACRVA",46,0)
GETFACNM(RESULT,SORTBY)   ; Extract records from file and sort by State Code
"RTN","DVBACRVA",47,0)
  K ^TMP($J)
"RTN","DVBACRVA",48,0)
  N II,FACNAME,STATE,ST,STATION,STATX,FIEN,FACTYPE,R,F1,F11,F2,F2N
"RTN","DVBACRVA",49,0)
  N VAMCNAME,A1,RES,X,X1
"RTN","DVBACRVA",50,0)
  S (FACNAME,STATE,ST,STATION,STATX,FIEN,FACTYPE,F1,F11,F2,F2N,VAMCNAME)=""
"RTN","DVBACRVA",51,0)
  S (R,II)=0
"RTN","DVBACRVA",52,0)
  ; % IS THE FIRST XREF
"RTN","DVBACRVA",53,0)
  F  S II=$O(^DIC(4,II)) Q:II=""  Q:II="%"  D
"RTN","DVBACRVA",54,0)
  . S X=^DIC(4,II,0),R=0
"RTN","DVBACRVA",55,0)
  . S X1=$G(^DIC(4,II,99))  ;$G SETS TO NULL IF RECORD DOES NOT EXIST
"RTN","DVBACRVA",56,0)
  . S F11=$P(X1,U,4)  ;INACTIVE FLAG - POINTER
"RTN","DVBACRVA",57,0)
  . Q:F11=1  ;QUIT IF F1=INACTIVE=1
"RTN","DVBACRVA",58,0)
  . S F1=$G(^DIC(4,II,3))
"RTN","DVBACRVA",59,0)
  . Q:F1=""
"RTN","DVBACRVA",60,0)
  . S F2=$G(^DIC(4.1,F1,0))
"RTN","DVBACRVA",61,0)
  . S F2N=$P(F2,U,1)
"RTN","DVBACRVA",62,0)
  . S A1=$P(F2,U,1)
"RTN","DVBACRVA",63,0)
  . S FACNAME=$P(X,U,1)
"RTN","DVBACRVA",64,0)
  . I "VAMC"[F2N S R=1
"RTN","DVBACRVA",65,0)
  . I "BVA/VBA-SO"[F2N S R=1
"RTN","DVBACRVA",66,0)
  . I "RO"[F2N S R=1
"RTN","DVBACRVA",67,0)
  . I "CENTRAL OFFICE"[F2N S R=1
"RTN","DVBACRVA",68,0)
  . I "BVA"[F2N S R=1
"RTN","DVBACRVA",69,0)
  . I "M&ROC"[F2N S R=1
"RTN","DVBACRVA",70,0)
  . I "MC&RO"[F2N S R=1
"RTN","DVBACRVA",71,0)
  . I "RO-OC"[F2N S R=1
"RTN","DVBACRVA",72,0)
  . I "RO&IC"[F2N S R=1
"RTN","DVBACRVA",73,0)
  . I "VAMROC"[F2N S R=1
"RTN","DVBACRVA",74,0)
  . I "-RO"[F2N S R=1
"RTN","DVBACRVA",75,0)
  . I "VAHSRO"[F2N S R=1
"RTN","DVBACRVA",76,0)
  . I "TIGER TEAM"[F2N S R=1
"RTN","DVBACRVA",77,0)
  . I II=460 S R=1
"RTN","DVBACRVA",78,0)
  . Q:R=0
"RTN","DVBACRVA",79,0)
  . S FACNAME=$P(X,U,1)
"RTN","DVBACRVA",80,0)
  . S STATE=$P(X,U,2) I STATE="" Q:STATE=""
"RTN","DVBACRVA",81,0)
  . S STATION=$P(X1,U,1)
"RTN","DVBACRVA",82,0)
  . S FIEN=$P(X,U,1)
"RTN","DVBACRVA",83,0)
  . S ST=$$EXTERNAL^DILFD(4,.02,"",STATE)
"RTN","DVBACRVA",84,0)
  . S:SORTBY="STATE" RES(ST,II)=ST_U_FACNAME_U_STATION_U_II_U_A1
"RTN","DVBACRVA",85,0)
  . S:SORTBY="NAME" RESULT(FACNAME)=ST_U_FACNAME_U_STATION_U_II
"RTN","DVBACRVA",86,0)
  I SORTBY="STATE" S (R,II)=0,ST="" D
"RTN","DVBACRVA",87,0)
 . N CNT S CNT=0
"RTN","DVBACRVA",88,0)
 . F  S ST=$O(RES(ST)) Q:ST=""  D
"RTN","DVBACRVA",89,0)
 .. S II=0
"RTN","DVBACRVA",90,0)
 .. F  S II=$O(RES(ST,II)) Q:II=""  D
"RTN","DVBACRVA",91,0)
 ... S CNT=$G(CNT)+1
"RTN","DVBACRVA",92,0)
 ... S RESULT(CNT)=RES(ST,II)
"RTN","DVBACRVA",93,0)
 Q
"RTN","DVBARSBD")
0^18^B203061467^B142334503
"RTN","DVBARSBD",1,0)
DVBARSBD ;ALB/RPM - CAPRI 2507 REQUEST STATUS BY DT RANGE REPORT ; 01/24/12
"RTN","DVBARSBD",2,0)
 ;;2.7;AMIE;**179,185,189,190,192,193**;Apr 10, 1995;Build 84
"RTN","DVBARSBD",3,0)
 ;
"RTN","DVBARSBD",4,0)
 Q  ;NO DIRECT ENTRY
"RTN","DVBARSBD",5,0)
 ;
"RTN","DVBARSBD",6,0)
REQSTAT(DVBSDAT,DVBEDAT,DVBRSTAT,DVBDELIM,DVBNODT) ;entry for request status by dt range
"RTN","DVBARSBD",7,0)
 ;
"RTN","DVBARSBD",8,0)
 ;  Input:
"RTN","DVBARSBD",9,0)
 ;    DVBSDAT - start date (FM format)
"RTN","DVBARSBD",10,0)
 ;    DVBEDAT - end date (FM format)
"RTN","DVBARSBD",11,0)
 ;    DVBRSTAT - request status (internal format)
"RTN","DVBARSBD",12,0)
 ;    DVBDELIM - return delimited results (0=no;1=yes)
"RTN","DVBARSBD",13,0)
 ;    DVBNODT - ignore date range (0=no;1=yes)
"RTN","DVBARSBD",14,0)
 ;
"RTN","DVBARSBD",15,0)
 N EXSTAT  ;request status (external format)
"RTN","DVBARSBD",16,0)
 N EXSDAT  ;start date (external format: MM/DD/YYYY)
"RTN","DVBARSBD",17,0)
 N EXEDAT  ;end date (external format: MM/DD/YYYY)
"RTN","DVBARSBD",18,0)
 N DVBARS  ;request status conversion results
"RTN","DVBARSBD",19,0)
 N DVBERR  ;FM error msg
"RTN","DVBARSBD",20,0)
 N DVBCNT  ;returned record count
"RTN","DVBARSBD",21,0)
 ;GRE- 193 ;Request Status conversion Report changes ;
"RTN","DVBARSBD",22,0)
 N RRIENINC ; re-route ien counter
"RTN","DVBARSBD",23,0)
 N RRDATE  ;re-route date
"RTN","DVBARSBD",24,0)
 N RRTOSITE  ;re-route to site
"RTN","DVBARSBD",25,0)
 N RRFRMSITE ; re-route from site;
"RTN","DVBARSBD",26,0)
 N RRSTATINC ; re-route status counter
"RTN","DVBARSBD",27,0)
 N RRSTATDTE ; re-route status date
"RTN","DVBARSBD",28,0)
 N RRSTAT    ; re-route status
"RTN","DVBARSBD",29,0)
 N DVBLINE  ;header separator
"RTN","DVBARSBD",30,0)
 ;GRE ; end Request Status conversion Report changes ;
"RTN","DVBARSBD",31,0)
 K ^TMP("DVBREQ",$J),^TMP("DVBREQN",$J)
"RTN","DVBARSBD",32,0)
 S EXSDAT=$$FMTE^XLFDT(DVBSDAT,"5DZ")
"RTN","DVBARSBD",33,0)
 S EXEDAT=$$FMTE^XLFDT(DVBEDAT,"5DZ")
"RTN","DVBARSBD",34,0)
 S (RRDATE,RRFRMSITE,RRTOSITE,RRSTATDTE,RRSTAT)="",(RRIENINC,RRSTATINC)=0
"RTN","DVBARSBD",35,0)
 S $P(DVBLINE,"-",131)=""
"RTN","DVBARSBD",36,0)
 I DVBRSTAT="RN" S DVBRSTAT="NR"
"RTN","DVBARSBD",37,0)
 I DVBRSTAT="A" S EXSTAT="ALL"
"RTN","DVBARSBD",38,0)
 E  D
"RTN","DVBARSBD",39,0)
 . D CHK^DIE(396.3,17,"E",DVBRSTAT,.DVBARS,"DVBERR")
"RTN","DVBARSBD",40,0)
 . S EXSTAT=$G(DVBARS(0))
"RTN","DVBARSBD",41,0)
 S DVBCNT=1
"RTN","DVBARSBD",42,0)
 S DVBAD=$S(DVBDELIM=1:",",1:0)
"RTN","DVBARSBD",43,0)
 ;
"RTN","DVBARSBD",44,0)
 ;collect records matching search criteria
"RTN","DVBARSBD",45,0)
 I DVBNODT D
"RTN","DVBARSBD",46,0)
 . S EXSDAT="NO START DATE"
"RTN","DVBARSBD",47,0)
 . S EXEDAT="NO END DATE"
"RTN","DVBARSBD",48,0)
 . I DVBDELIM D DELIMHDR(EXSDAT,EXEDAT,EXSTAT)
"RTN","DVBARSBD",49,0)
 . D GETRECSN(DVBRSTAT,.DVBCNT)
"RTN","DVBARSBD",50,0)
 E  D
"RTN","DVBARSBD",51,0)
 . I DVBDELIM D DELIMHDR(EXSDAT,EXEDAT,EXSTAT)
"RTN","DVBARSBD",52,0)
 . D GETRECS(DVBSDAT,DVBEDAT,DVBRSTAT,.DVBCNT)
"RTN","DVBARSBD",53,0)
D I 'DVBCNT D
"RTN","DVBARSBD",54,0)
 . W "NO DATA FOUND"
"RTN","DVBARSBD",55,0)
 E  D
"RTN","DVBARSBD",56,0)
 . I 'DVBDELIM D PLAINHDR(EXSDAT,EXEDAT,EXSTAT),PLAIN  ;plain text format
"RTN","DVBARSBD",57,0)
 . I DVBDELIM D DELIM  ;comma delimited format
"RTN","DVBARSBD",58,0)
 ;
"RTN","DVBARSBD",59,0)
END ;Clean up local variables
"RTN","DVBARSBD",60,0)
 K DIWF,DIWL,DIWR,DVBAD,DVBAX,DVBAY,DVBCNRS,DVBEXAM,DVBIEN4,DVBI2,DVBX,DVBXCNT,LINE,X
"RTN","DVBARSBD",61,0)
 K DVBAD,DVBAX,DVBAY,DVBCT,DVBCTN,DVBCTW,DVBIEN4,DVBI2,DIWF,DIWL,DIWR,DVBX,DVBSC,DVBSCC,DVBSCN,DVBSCW,DVBSCWA,DVBXCNT,LINE,X
"RTN","DVBARSBD",62,0)
 K DVBSCNS,DVBAA,^TMP("DVBREQ",$J),^TMP("DVBREQH",$J)
"RTN","DVBARSBD",63,0)
 K DVBREQH,DVBREQL2,DVBREQL3,DVBI22,MSG,RCC,RCR,RRFRMSITE
"RTN","DVBARSBD",64,0)
 Q
"RTN","DVBARSBD",65,0)
 ;
"RTN","DVBARSBD",66,0)
GETRECS(SDAT,EDAT,RSTAT,CNT) ;collect 2507 REQUEST record matches, when DVBNODT=0 means not ignoring the date range
"RTN","DVBARSBD",67,0)
 ;This procedure collects all 2507 REQUEST records that have a
"RTN","DVBARSBD",68,0)
 ;DATE STATUS LAST CHANGED within the start and end dates and have
"RTN","DVBARSBD",69,0)
 ;a REQUEST STATUS that matches the input request status parameter.
"RTN","DVBARSBD",70,0)
 ;
"RTN","DVBARSBD",71,0)
 ;  Input:
"RTN","DVBARSBD",72,0)
 ;    SDAT - start date (FM format)
"RTN","DVBARSBD",73,0)
 ;    EDAT - end date (FM format)
"RTN","DVBARSBD",74,0)
 ;    RSTAT - request status (internal format)
"RTN","DVBARSBD",75,0)
 ;    CNT - record count (passed by reference)
"RTN","DVBARSBD",76,0)
 ;
"RTN","DVBARSBD",77,0)
 N CHGDAT  ;change date
"RTN","DVBARSBD",78,0)
 N DVBIEN  ;2507 REQUEST IEN
"RTN","DVBARSBD",79,0)
 N DVBSTAT ;2507 REQUEST STATUS
"RTN","DVBARSBD",80,0)
 N FLD     ;field array in external format
"RTN","DVBARSBD",81,0)
 S CHGDAT=SDAT-1
"RTN","DVBARSBD",82,0)
 S DVBIEN=0,CNT=0 F  S CHGDAT=$O(^DVB(396.3,"AH",CHGDAT)) Q:'CHGDAT!(CHGDAT>EDAT)  D
"RTN","DVBARSBD",83,0)
 . F  S DVBIEN=$O(^DVB(396.3,"AH",CHGDAT,DVBIEN)) Q:'DVBIEN  D
"RTN","DVBARSBD",84,0)
 . . ;AJF; Request Status Conversion
"RTN","DVBARSBD",85,0)
 . . S DVBSTAT=$$RSTAT^DVBCUTL8($P(^DVB(396.3,DVBIEN,0),U,18))
"RTN","DVBARSBD",86,0)
 . . I RSTAT="A"!(DVBSTAT=RSTAT) D
"RTN","DVBARSBD",87,0)
 . . . K FLD
"RTN","DVBARSBD",88,0)
 . . . I $$SETFLDS(DVBIEN,.FLD) D
"RTN","DVBARSBD",89,0)
 . . . . S CNT=CNT+1,DVBXCNT=1
"RTN","DVBARSBD",90,0)
 . . . . I $G(DVBAD)'="," S ^TMP("DVBREQX",$J,CNT)=FLD("IEN")_U_FLD("SS")_U_FLD("NM")_U_FLD("REQDT")_U_FLD("RELDT")_U_FLD("PRTDT")_U_FLD("RS")_U_FLD("CANDT")_U_FLD("RO")_U_FLD("CANRS",DVBXCNT)_U_FLD("CANCOM",DVBXCNT) D
"RTN","DVBARSBD",91,0)
 . . . . . S ^TMP("DVBREQ",$J,CNT,DVBIEN)=FLD("IEN")_U_FLD("SS")_U_FLD("NM")_U_FLD("REQDT")_U_FLD("RELDT")_U_FLD("PRTDT")_U_FLD("RS")_U_FLD("CANDT")_U_FLD("RO")_U_FLD("CANRS",DVBXCNT)_U_FLD("CANCOM",DVBXCNT)_U
"RTN","DVBARSBD",92,0)
 . . . . . S ^TMP("DVBREQ",$J,CNT,DVBIEN)=^TMP("DVBREQ",$J,CNT,DVBIEN)_FLD("DVBCTW")_U_FLD("DVBSCWA")_U_RRDATE_U_RRTOSITE_U_RRFRMSITE
"RTN","DVBARSBD",93,0)
 . . . . . S CNT=CNT+1,DVBXCNT=DVBXCNT+1
"RTN","DVBARSBD",94,0)
 . . . . I $G(DVBAD)="," D
"RTN","DVBARSBD",95,0)
 . . . . . S (RCC,RCR)=""
"RTN","DVBARSBD",96,0)
 . . . . . D:$D(FLD("IEN4",1)) CANFLD
"RTN","DVBARSBD",97,0)
 . . . . . S FLD("CANRS")=RCR,FLD("CANCOM")=RCC
"RTN","DVBARSBD",98,0)
 . . . . . S FLD("RRLOC")=$TR(FLD("RRLOC"),",",""),FLD("RRSTE")=$TR(FLD("RRSTE"),",","")
"RTN","DVBARSBD",99,0)
 . . . . . S ^TMP("DVBREQ",$J,CNT,DVBIEN)=FLD("SS")_DVBAD_""""_FLD("NM")_""""_DVBAD_FLD("REQDT")_DVBAD_FLD("RELDT")_DVBAD_""""_FLD("PRTDT")_""""_DVBAD
"RTN","DVBARSBD",100,0)
 . . . . . S ^TMP("DVBREQ",$J,CNT,DVBIEN)=^TMP("DVBREQ",$J,CNT,DVBIEN)_""""_FLD("RS")_""""_DVBAD_FLD("CANDT")_DVBAD_""""_FLD("RO")_""""_DVBAD
"RTN","DVBARSBD",101,0)
 . . . . . S ^TMP("DVBREQ",$J,CNT,DVBIEN)=^TMP("DVBREQ",$J,CNT,DVBIEN)_""""_FLD("CANRS")_""""_DVBAD_FLD("CANCOM")_DVBAD_""""_FLD("DVBCTW")_""""_DVBAD
"RTN","DVBARSBD",102,0)
 . . . . . S ^TMP("DVBREQ",$J,CNT,DVBIEN)=^TMP("DVBREQ",$J,CNT,DVBIEN)_""""_FLD("DVBSCWA")_""""_DVBAD_FLD("RRDTE")_DVBAD_""""_FLD("RRLOC")_""""_DVBAD
"RTN","DVBARSBD",103,0)
 . . . . . S ^TMP("DVBREQ",$J,CNT,DVBIEN)=^TMP("DVBREQ",$J,CNT,DVBIEN)_""""_FLD("RRSTE")_""""_DVBAD
"RTN","DVBARSBD",104,0)
 . . . . . S CNT=CNT+1
"RTN","DVBARSBD",105,0)
 Q
"RTN","DVBARSBD",106,0)
CANFLD ;
"RTN","DVBARSBD",107,0)
 N RS1,RC1,RRCR,RRCC
"RTN","DVBARSBD",108,0)
 S DVBX=0
"RTN","DVBARSBD",109,0)
 F  S DVBX=$O(FLD("IEN4",DVBX)) Q:'DVBX  D
"RTN","DVBARSBD",110,0)
 . S RS1=FLD("CANRS",DVBX),RC1=FLD("CANCOM",DVBX)
"RTN","DVBARSBD",111,0)
 . S RS1=$E(RS1,1,50),RC1=$E(RC1,1,50)
"RTN","DVBARSBD",112,0)
 . I RS1'="",'$D(RRCR(RS1)) S RRCR(RS1)=""
"RTN","DVBARSBD",113,0)
 . I RC1'="",'$D(RRCC(RC1)) S RRCC(RC1)=""
"RTN","DVBARSBD",114,0)
 S (RCR,RS1)="" F  S RS1=$O(RRCR(RS1)) Q:RS1=""  S RCR=$S(RCR="":RS1,1:RCR_"^"_RS1)
"RTN","DVBARSBD",115,0)
 S (RCC,RC1)="" F  S RC1=$O(RRCC(RC1)) Q:RC1=""  S RCC=$S(RCC="":RC1,1:RCC_"^"_RC1)
"RTN","DVBARSBD",116,0)
 S RCC=$TR(RCC,",","")
"RTN","DVBARSBD",117,0)
 I $L(RCR)>40 S RCR="*"_$E(RCR,1,40)
"RTN","DVBARSBD",118,0)
 I $L(RCC)>40 S RCC="*"_$E(RCC,1,40)
"RTN","DVBARSBD",119,0)
 Q
"RTN","DVBARSBD",120,0)
 ;
"RTN","DVBARSBD",121,0)
SETFLDS(DVBIEN,DVBFLDS) ;build field array in external format
"RTN","DVBARSBD",122,0)
 ;This function formats the collected record data in external format
"RTN","DVBARSBD",123,0)
 ;and returns the results TRUE and an array on success.  Otherwise,
"RTN","DVBARSBD",124,0)
 ;the function returns FALSE.
"RTN","DVBARSBD",125,0)
 ;
"RTN","DVBARSBD",126,0)
 ;  Integration Reference #10061 - DEM^VADPT
"RTN","DVBARSBD",127,0)
 ;
"RTN","DVBARSBD",128,0)
 ;  Input:
"RTN","DVBARSBD",129,0)
 ;    DVBIEN - 2507 REQUEST IEN
"RTN","DVBARSBD",130,0)
 ;    DVBFLDS - field array passed by reference
"RTN","DVBARSBD",131,0)
 ;
"RTN","DVBARSBD",132,0)
 ;  Output:
"RTN","DVBARSBD",133,0)
 ;    DVBFLDS("IEN") - 2507 REQUEST IEN
"RTN","DVBARSBD",134,0)
 ;    DVBFLDS("NM") - patient name
"RTN","DVBARSBD",135,0)
 ;    DVBFLDS("SS") - social security number
"RTN","DVBARSBD",136,0)
 ;    DVBFLDS("RS") - request status
"RTN","DVBARSBD",137,0)
 ;    DVBFLDS("REQDT") - request date
"RTN","DVBARSBD",138,0)
 ;    DVBFLDS("RELDT") - release date
"RTN","DVBARSBD",139,0)
 ;    DVBFLDS("PRTDT") - print date
"RTN","DVBARSBD",140,0)
 ;    DVBFLDS("CANDT") - canceled date
"RTN","DVBARSBD",141,0)
 ;    DVBFLDS("RO") - regional office
"RTN","DVBARSBD",142,0)
 ;    DVBFLDS("IREQDT") - request date in internal FM format
"RTN","DVBARSBD",143,0)
 ;    DVBFLDS("EXAM") - added with patch DVB*2.7*189; HOLDS THE 2507 EXAM name   
"RTN","DVBARSBD",144,0)
 ;    DVBFLDS("CANRS") - added with patch DVB*2.7*189; HOLDS THE 2507 EXAM CANCELLATION REASON name
"RTN","DVBARSBD",145,0)
 ;    DVBFLDS("CANCOM") - added with patch DVB*2.7*189; HOLDS THE 2507 EXAM CANCELLATION COMMENTS name
"RTN","DVBARSBD",146,0)
 ;GRE add re-route fields
"RTN","DVBARSBD",147,0)
 ;    DVBFLDS("RRDATE") - added with patch DVBA*2.7*193 holds the 2507 Re-Route Date
"RTN","DVBARSBD",148,0)
 ;    DVBFLDS("RRSITE") - added with patch DVBA*2.7*193 holds the 2507 Re-Route Site
"RTN","DVBARSBD",149,0)
 ;    DVBFLDS("RRLOC")  - added with patch DVBA*2.7*193 holds the 2507 Re-Route Location
"RTN","DVBARSBD",150,0)
 ;    Function Result - return 1 on success; otherwise returns 0
"RTN","DVBARSBD",151,0)
 ;
"RTN","DVBARSBD",152,0)
 N DFN  ;PATIENT file IEN used in VADPT call
"RTN","DVBARSBD",153,0)
 N DVBDAT  ;2507 REQUEST data field array
"RTN","DVBARSBD",154,0)
 N DVBIENS  ;FM IENS value
"RTN","DVBARSBD",155,0)
 N DVBRSLT  ;function result
"RTN","DVBARSBD",156,0)
 N VADM  ;VADPT return array
"RTN","DVBARSBD",157,0)
 N DVBIEN4 ;the IEN FROM 2507 EXAM FILE 396.4
"RTN","DVBARSBD",158,0)
 N DVBALAST ;number of lines in the wp cancellation comments
"RTN","DVBARSBD",159,0)
 N DVBAI  ;for loop index
"RTN","DVBARSBD",160,0)
 N DVBAX ;
"RTN","DVBARSBD",161,0)
 K DVBFLDS
"RTN","DVBARSBD",162,0)
 S (RRDATE,RRFRMSITE,RRTOSITE)=""
"RTN","DVBARSBD",163,0)
 S DVBRSLT=0
"RTN","DVBARSBD",164,0)
 S DVBIENS=+$G(DVBIEN)_","
"RTN","DVBARSBD",165,0)
 D GETS^DIQ(396.3,DVBIENS,".01;1;2;13;15;17;19","IE","DVBDAT","")
"RTN","DVBARSBD",166,0)
 S DFN=$G(DVBDAT(396.3,DVBIENS,.01,"I"))
"RTN","DVBARSBD",167,0)
 D DEM^VADPT
"RTN","DVBARSBD",168,0)
 I $G(VADM(1))'="" D  ;only return record when name is resolved
"RTN","DVBARSBD",169,0)
 . S DVBFLDS("IEN")=DVBIEN
"RTN","DVBARSBD",170,0)
 . S DVBFLDS("NM")=$G(VADM(1))
"RTN","DVBARSBD",171,0)
 . S DVBFLDS("SS")=$S(DVBDELIM:$P($G(VADM(2)),U,2),1:$P($G(VADM(2)),U,1))
"RTN","DVBARSBD",172,0)
 . S DVBFLDS("RS")=$G(DVBDAT(396.3,DVBIENS,17,"E"))
"RTN","DVBARSBD",173,0)
 . S DVBFLDS("REQDT")=$$FMTE^XLFDT($G(DVBDAT(396.3,DVBIENS,1,"I")),"5DZ")
"RTN","DVBARSBD",174,0)
 . S DVBFLDS("RELDT")=$$FMTE^XLFDT($G(DVBDAT(396.3,DVBIENS,13,"I")),"5DZ")
"RTN","DVBARSBD",175,0)
 . S DVBFLDS("PRTDT")=$$FMTE^XLFDT($G(DVBDAT(396.3,DVBIENS,15,"I")),"5DZ")
"RTN","DVBARSBD",176,0)
 . S DVBFLDS("CANDT")=$$FMTE^XLFDT($G(DVBDAT(396.3,DVBIENS,19,"I")),"5DZ")
"RTN","DVBARSBD",177,0)
 . S DVBFLDS("RO")=$G(DVBDAT(396.3,DVBIENS,2,"E"))
"RTN","DVBARSBD",178,0)
 . D CLAIMTYP,SPEC,GETRRDAT
"RTN","DVBARSBD",179,0)
 . S DVBFLDS("DVBCTW")=DVBCTW
"RTN","DVBARSBD",180,0)
 . S DVBFLDS("DVBSCWA")=DVBSCWA
"RTN","DVBARSBD",181,0)
 . S DVBFLDS("RRDTE")=RRDATE
"RTN","DVBARSBD",182,0)
 . S DVBFLDS("RRSTE")=RRFRMSITE
"RTN","DVBARSBD",183,0)
 . S DVBFLDS("RRLOC")=RRTOSITE
"RTN","DVBARSBD",184,0)
 . S DVBXCNT=1
"RTN","DVBARSBD",185,0)
 . S (DVBFLDS("CANRS",DVBXCNT),DVBFLDS("CANCOM",DVBXCNT),DVBFLDS("IEN4"))=""
"RTN","DVBARSBD",186,0)
 . S DVBIEN4=0 F  S DVBIEN4=$O(^DVB(396.4,"C",DVBIEN,DVBIEN4)) Q:'DVBIEN4  D
"RTN","DVBARSBD",187,0)
 . . I $D(^DVB(396.4,DVBIEN4,"CAN")) D
"RTN","DVBARSBD",188,0)
 . . . S DVBAY=($P($P(^DVB(396.4,DVBIEN4,"CAN"),"^",1),".",1)) I DVBAY>(DVBSDAT-1)&DVBAY<(DVBEDAT+1) D
"RTN","DVBARSBD",189,0)
 . . . . S DVBFLDS("CANRS",DVBXCNT)=$$GET1^DIQ(396.4,DVBIEN4,52)
"RTN","DVBARSBD",190,0)
 . . . . I $D(^DVB(396.4,DVBIEN4,5)) D
"RTN","DVBARSBD",191,0)
 . . . . . S DVBFLDS("IEN4",DVBXCNT)=DVBIEN4
"RTN","DVBARSBD",192,0)
 . . . . . K WP S DVBAX=$$GET1^DIQ(396.4,DVBIEN4,53,"Z","WP") ; this puts the wordprocessing field into an array 'WP(#,0)=' next it gets put into one entry of the DVBFLDS ARRAY so we can handle any comma's that aren't delimiters
"RTN","DVBARSBD",193,0)
 . . . . . ;DVBALAST gets the number of WP lines to loop through in the for loop
"RTN","DVBARSBD",194,0)
 . . . . . S DVBALAST=$P(^DVB(396.4,DVBIEN4,5,0),U,3) S DVBAI="",DVBFLDS("CANCOM",DVBXCNT)=WP(1,0)
"RTN","DVBARSBD",195,0)
 . . . . . F DVBAI=1:1:DVBALAST S DVBFLDS("CANCOM",DVBXCNT)=DVBFLDS("CANCOM",DVBXCNT)_" "_WP(DVBAI,0) Q:$L(DVBFLDS("CANCOM",DVBXCNT))>150
"RTN","DVBARSBD",196,0)
 . . . . . ;S DVBALAST=$P(^DVB(396.4,DVBIEN4,5,0),U,3) S DVBAI="" F DVBAI=1:1:DVBALAST S DVBFLDS("CANCOM",DVBAI)=WP(DVBAI,0)
"RTN","DVBARSBD",197,0)
 . . . . . S DVBXCNT=DVBXCNT+1
"RTN","DVBARSBD",198,0)
 . S DVBFLDS("IREQDT")=$G(DVBDAT(396.3,DVBIENS,1,"I"))
"RTN","DVBARSBD",199,0)
 . S DVBRSLT=1
"RTN","DVBARSBD",200,0)
 Q DVBRSLT
"RTN","DVBARSBD",201,0)
 ;
"RTN","DVBARSBD",202,0)
DELIMHDR(EXSDAT,EXEDAT,EXSTAT) ;output delimited format header
"RTN","DVBARSBD",203,0)
 ;  Input:
"RTN","DVBARSBD",204,0)
 ;    EXSDAT - start date (external format)
"RTN","DVBARSBD",205,0)
 ;    EXEDAT - end date (external format)
"RTN","DVBARSBD",206,0)
 ;    EXSTAT - request status (external format)
"RTN","DVBARSBD",207,0)
 ; GRE ; added re-route status information to the report
"RTN","DVBARSBD",208,0)
 S ^TMP("DVBREQH",$J,DVBCNT)="Request Status by Date Range Report",DVBCNT=DVBCNT+1
"RTN","DVBARSBD",209,0)
 S ^TMP("DVBREQH",$J,DVBCNT)="Date Range: "_EXSDAT_" - "_EXEDAT,DVBCNT=DVBCNT+1
"RTN","DVBARSBD",210,0)
 S ^TMP("DVBREQH",$J,DVBCNT)=""""_"Request Status: "_EXSTAT_""""_$C(13),DVBCNT=DVBCNT+1
"RTN","DVBARSBD",211,0)
 S ^TMP("DVBREQH",$J,DVBCNT)="SSN"_DVBAD_"PatientName"_DVBAD_"RequestDT"_DVBAD_"DTReleased"_DVBAD_"DTPrinted"_DVBAD_"RequestStatus"_DVBAD_"DtCanceled"_DVBAD_"Station"_DVBAD_"Cancellation Reason"_DVBAD_"Cancellation Comments"_DVBAD
"RTN","DVBARSBD",212,0)
 S ^TMP("DVBREQH",$J,DVBCNT)=^TMP("DVBREQH",$J,DVBCNT)_"Claim Type"_DVBAD_"Special Consideration(s)"_DVBAD_"Re-Route Date"_DVBAD_"Re-Route To Site"_DVBAD_"Re-Route From Site",DVBCNT=DVBCNT+1
"RTN","DVBARSBD",213,0)
 Q
"RTN","DVBARSBD",214,0)
 ;
"RTN","DVBARSBD",215,0)
DELIM ;output delimited format
"RTN","DVBARSBD",216,0)
 ;
"RTN","DVBARSBD",217,0)
 N DVBI     ;generic counter
"RTN","DVBARSBD",218,0)
 N DVBREQ   ;request record
"RTN","DVBARSBD",219,0)
 ;
"RTN","DVBARSBD",220,0)
 U IO
"RTN","DVBARSBD",221,0)
 S DVBI=0 F  S DVBI=$O(^TMP("DVBREQH",$J,DVBI)) Q:'DVBI  D
"RTN","DVBARSBD",222,0)
 . S DVBREQH=^TMP("DVBREQH",$J,DVBI)
"RTN","DVBARSBD",223,0)
 . W !,DVBREQH
"RTN","DVBARSBD",224,0)
 S DVBI2=0 F  S DVBI2=$O(^TMP("DVBREQ",$J,DVBI2)) Q:'DVBI2  D
"RTN","DVBARSBD",225,0)
 . S DVBIEN=0 F  S DVBIEN=$O(^TMP("DVBREQ",$J,DVBI2,DVBIEN)) Q:'DVBIEN  D
"RTN","DVBARSBD",226,0)
 . . S DVBREQL2=^TMP("DVBREQ",$J,DVBI2,DVBIEN)
"RTN","DVBARSBD",227,0)
 . . W !,DVBREQL2
"RTN","DVBARSBD",228,0)
 . . S DVBI22=0 F  S DVBI22=$O(^TMP("DVBREQ",$J,DVBI2,DVBIEN,DVBI22)) Q:'DVBI22  D
"RTN","DVBARSBD",229,0)
 . . . S DVBREQL3=^TMP("DVBREQ",$J,DVBI2,DVBIEN,DVBI22)
"RTN","DVBARSBD",230,0)
 . . . W !,DVBREQL3
"RTN","DVBARSBD",231,0)
 ;
"RTN","DVBARSBD",232,0)
 Q
"RTN","DVBARSBD",233,0)
 ;
"RTN","DVBARSBD",234,0)
PLAINHDR(EXSDAT,EXEDAT,EXSTAT)  ;output plain text header
"RTN","DVBARSBD",235,0)
 ;Populate the header information.
"RTN","DVBARSBD",236,0)
 ;CAUTION:  The CAPRI GUI pulls this information to populate the header
"RTN","DVBARSBD",237,0)
 ;for each page when creating a printed report.  Do not modify the
"RTN","DVBARSBD",238,0)
 ;content or line count of the header information without validating
"RTN","DVBARSBD",239,0)
 ;against the CAPRI GUI interface.
"RTN","DVBARSBD",240,0)
 ;
"RTN","DVBARSBD",241,0)
 ;CAPRI GUI to populate 
"RTN","DVBARSBD",242,0)
 ;  Input:
"RTN","DVBARSBD",243,0)
 ;    EXSDAT - start date (external format)
"RTN","DVBARSBD",244,0)
 ;    EXEDAT - end date (external format)
"RTN","DVBARSBD",245,0)
 ;    EXSTAT - request status (external format)
"RTN","DVBARSBD",246,0)
 ;
"RTN","DVBARSBD",247,0)
 ; N DVBLINE  ;header separator
"RTN","DVBARSBD",248,0)
 ;
"RTN","DVBARSBD",249,0)
 U IO
"RTN","DVBARSBD",250,0)
 ;S $P(DVBLINE,"-",131)=""
"RTN","DVBARSBD",251,0)
 W !,"Date Range: "_EXSDAT_" - "_EXEDAT
"RTN","DVBARSBD",252,0)
 W !,"Request Status: ",EXSTAT
"RTN","DVBARSBD",253,0)
 W !,"-----------------------------------------------------------------------------------------------"
"RTN","DVBARSBD",254,0)
 Q
"RTN","DVBARSBD",255,0)
 ;
"RTN","DVBARSBD",256,0)
PLAIN ;output plain text format
"RTN","DVBARSBD",257,0)
 ;Output formatted text format.  The patient name and station nameC
"RTN","DVBARSBD",258,0)
 ;are truncated at 20 characters to maintain 132 character report.
"RTN","DVBARSBD",259,0)
 ;
"RTN","DVBARSBD",260,0)
 N DVBI     ;generic counter
"RTN","DVBARSBD",261,0)
 N DVBREQ   ;request record
"RTN","DVBARSBD",262,0)
 U IO
"RTN","DVBARSBD",263,0)
 S DVBI=0
"RTN","DVBARSBD",264,0)
 F  S DVBI=$O(^TMP("DVBREQ",$J,DVBI)) Q:'DVBI  D
"RTN","DVBARSBD",265,0)
 . S DVBIEN=0 F  S DVBIEN=$O(^TMP("DVBREQ",$J,DVBI,DVBIEN)) Q:'DVBIEN  D
"RTN","DVBARSBD",266,0)
 . . S DVBREQ=^TMP("DVBREQ",$J,DVBI,DVBIEN)
"RTN","DVBARSBD",267,0)
  . . D GETRRDAT
"RTN","DVBARSBD",268,0)
 . . W !,DVBLINE
"RTN","DVBARSBD",269,0)
 . . W !,"SSN:",?14,$P(DVBREQ,U,2)
"RTN","DVBARSBD",270,0)
 . . W !,"PATIENT NAME:",?14,$E($P(DVBREQ,U,3),1,20)
"RTN","DVBARSBD",271,0)
 . . W !,"REQUEST DT:",?14,$P(DVBREQ,U,4)
"RTN","DVBARSBD",272,0)
 . . W !,"DT RELEASED:",?14,$P(DVBREQ,U,5)
"RTN","DVBARSBD",273,0)
 . . W !,"DT PRINTED:",?14,$P(DVBREQ,U,6)
"RTN","DVBARSBD",274,0)
 . . W !,"STATUS:",?14,$P(DVBREQ,U,7)
"RTN","DVBARSBD",275,0)
 . . W !,"DT CANCELED:",?14,$P(DVBREQ,U,8)
"RTN","DVBARSBD",276,0)
 . . D CLAIMTYP,SPEC
"RTN","DVBARSBD",277,0)
 . . W !,"CLAIM TYPE: ",DVBCTW
"RTN","DVBARSBD",278,0)
 . . W !,"SPECIAL CONSIDERATION(S):",DVBSCWA
"RTN","DVBARSBD",279,0)
 . . W !,"RE-ROUTE DATE:",RRDATE
"RTN","DVBARSBD",280,0)
 . . W !,"RE-ROUTE FROM SITE:",RRFRMSITE
"RTN","DVBARSBD",281,0)
 . . W !,"RE-ROUTE TO SITE:",RRTOSITE
"RTN","DVBARSBD",282,0)
 . . S DVBIEN4=0 F  S DVBIEN4=$O(^DVB(396.4,"C",DVBIEN,DVBIEN4)) Q:'DVBIEN4  D
"RTN","DVBARSBD",283,0)
 . . . I $D(^DVB(396.4,DVBIEN4,"CAN")) D
"RTN","DVBARSBD",284,0)
 . . . . S DVBAY=($P($P(^DVB(396.4,DVBIEN4,"CAN"),"^",1),".",1)) I DVBAY>(DVBSDAT-1)&DVBAY<(DVBEDAT+1) D
"RTN","DVBARSBD",285,0)
 . . . . . S DVBCNRS=$$GET1^DIQ(396.4,DVBIEN4,52) D
"RTN","DVBARSBD",286,0)
 . . . . . I DVBCNRS'="" D  W !,"CANCELLATION REASON:",?14,DVBCNRS
"RTN","DVBARSBD",287,0)
 . . . . . .;W !,"CANCELLATION REASON:",?14,DVBCNRS
"RTN","DVBARSBD",288,0)
 . . . . . I $D(^DVB(396.4,DVBIEN4,5)) D
"RTN","DVBARSBD",289,0)
 . . . . . . K ^UTILITY($J,"W")
"RTN","DVBARSBD",290,0)
 . . . . . . W !,"CANCELLATION COMMENTS:",?14 F LINE=0:0 S LINE=$O(^DVB(396.4,DVBIEN4,5,LINE)) Q:LINE=""  S X=^(LINE,0),DIWL=5,DIWR=75,DIWF="NW" D ^DIWP
"RTN","DVBARSBD",291,0)
 Q 
"RTN","DVBARSBD",292,0)
 ;
"RTN","DVBARSBD",293,0)
GETRECSN(RSTAT,DVBCNT) ;collect 2507 REQUEST status matches and ignore date range
"RTN","DVBARSBD",294,0)
 ;This procedure collects all 2507 REQUEST records that have a REQUEST STATUS
"RTN","DVBARSBD",295,0)
 ;that matches the input request status parameter regardless of the LAST
"RTN","DVBARSBD",296,0)
 ;STATUS CHANGE DATE range.  The procedure uses the "AF" index which sorts
"RTN","DVBARSBD",297,0)
 ;by REQUEST STATUS and REGIONAL OFFICE.
"RTN","DVBARSBD",298,0)
 ;
"RTN","DVBARSBD",299,0)
 ;  Input:
"RTN","DVBARSBD",300,0)
 ;    RSTAT - request status (internal format)
"RTN","DVBARSBD",301,0)
 ;    DVBCNT - record count (passed by reference)
"RTN","DVBARSBD",302,0)
 ;
"RTN","DVBARSBD",303,0)
 ;
"RTN","DVBARSBD",304,0)
 N DVBIEN  ;2507 REQUEST IEN
"RTN","DVBARSBD",305,0)
 N FLD     ;field array in external format
"RTN","DVBARSBD",306,0)
 N DVBRO   ;regional office
"RTN","DVBARSBD",307,0)
 S DVBRO=0,DVBCNT=0 F  S DVBRO=$O(^DVB(396.3,"AF",RSTAT,DVBRO)) Q:'DVBRO  D
"RTN","DVBARSBD",308,0)
 . S DVBIEN=0
"RTN","DVBARSBD",309,0)
 . F  S DVBIEN=$O(^DVB(396.3,"AF",RSTAT,DVBRO,DVBIEN)) Q:'DVBIEN  D
"RTN","DVBARSBD",310,0)
 . . K FLD
"RTN","DVBARSBD",311,0)
 . . I $$SETFLDS(DVBIEN,.FLD) D
"RTN","DVBARSBD",312,0)
 . . . S DVBXCNT=1
"RTN","DVBARSBD",313,0)
 . . . I $G(DVBAD)'="," D
"RTN","DVBARSBD",314,0)
 . . . . S ^TMP("DVBREQ",$J,DVBCNT,DVBIEN)=FLD("IEN")_U_FLD("SS")_U_FLD("NM")_U_FLD("REQDT")_U_FLD("RELDT")_U_FLD("PRTDT")_U_FLD("RS")_U_FLD("CANDT")_U_FLD("RO")_U_FLD("CANRS",DVBXCNT)_U_FLD("CANCOM",DVBXCNT)_U
"RTN","DVBARSBD",315,0)
 . . . . S ^TMP("DVBREQ",$J,DVBCNT,DVBIEN)=^TMP("DVBREQ",$J,DVBCNT,DVBIEN)_FLD("DVBCTW")_U_FLD("DVBSCWA")
"RTN","DVBARSBD",316,0)
 . . . . S DVBCNT=DVBCNT+1,DVBXCNT=DVBXCNT+1
"RTN","DVBARSBD",317,0)
 . . . I $G(DVBAD)="," D
"RTN","DVBARSBD",318,0)
 . . . . S (RCC,RCR)=""
"RTN","DVBARSBD",319,0)
 . . . . D:$D(FLD("IEN4",1)) CANFLD
"RTN","DVBARSBD",320,0)
 . . . . S FLD("CANRS")=RCR,FLD("CANCOM")=RCC
"RTN","DVBARSBD",321,0)
 . . . . S FLD("RRLOC")=$TR(FLD("RRLOC"),",",""),FLD("RRSTE")=$TR(FLD("RRSTE"),",","")
"RTN","DVBARSBD",322,0)
 . . . . S ^TMP("DVBREQ",$J,DVBCNT,DVBIEN)=FLD("SS")_DVBAD_""""_FLD("NM")_""""_DVBAD_FLD("REQDT")_DVBAD_FLD("RELDT")_DVBAD_""""_FLD("PRTDT")_""""_DVBAD
"RTN","DVBARSBD",323,0)
 . . . . S ^TMP("DVBREQ",$J,DVBCNT,DVBIEN)=^TMP("DVBREQ",$J,DVBCNT,DVBIEN)_""""_FLD("RS")_""""_DVBAD_FLD("CANDT")_DVBAD_""""_FLD("RO")_""""_DVBAD
"RTN","DVBARSBD",324,0)
 . . . . S ^TMP("DVBREQ",$J,DVBCNT,DVBIEN)=^TMP("DVBREQ",$J,DVBCNT,DVBIEN)_""""_FLD("CANRS")_""""_DVBAD_FLD("CANCOM")_DVBAD_""""_FLD("DVBCTW")_""""_DVBAD
"RTN","DVBARSBD",325,0)
 . . . . S ^TMP("DVBREQ",$J,DVBCNT,DVBIEN)=^TMP("DVBREQ",$J,DVBCNT,DVBIEN)_""""_FLD("DVBSCWA")_""""_DVBAD_FLD("RRDTE")_DVBAD_""""_FLD("RRSTE")_""""_DVBAD
"RTN","DVBARSBD",326,0)
 . . . . S ^TMP("DVBREQ",$J,DVBCNT,DVBIEN)=^TMP("DVBREQ",$J,DVBCNT,DVBIEN)_""""_FLD("RRLOC")_""""_DVBAD
"RTN","DVBARSBD",327,0)
 . . . . S DVBCNT=DVBCNT+1
"RTN","DVBARSBD",328,0)
 ;load output global with sorted list
"RTN","DVBARSBD",329,0)
 S CHGDAT="",CNT=0  ;use "" because value could be zero ("0")
"RTN","DVBARSBD",330,0)
 F  S CHGDAT=$O(^TMP("DVBREQN",$J,CHGDAT)) Q:(CHGDAT="")  D
"RTN","DVBARSBD",331,0)
 . S DVBIEN=0
"RTN","DVBARSBD",332,0)
 . F  S DVBIEN=$O(^TMP("DVBREQN",$J,CHGDAT,DVBIEN)) Q:'DVBIEN  D
"RTN","DVBARSBD",333,0)
 . . S CNT=CNT+1
"RTN","DVBARSBD",334,0)
 . . S ^TMP("DVBREQ",$J,CNT)=^TMP("DVBREQN",$J,CHGDAT,DVBIEN)
"RTN","DVBARSBD",335,0)
 Q
"RTN","DVBARSBD",336,0)
 ;
"RTN","DVBARSBD",337,0)
CLAIMTYP ;THE CLAIM TYPE OF A 2507 REQUEST
"RTN","DVBARSBD",338,0)
 S DVBCTW=""
"RTN","DVBARSBD",339,0)
 Q:'$D(^DVB(396.3,DVBIEN,9,0))
"RTN","DVBARSBD",340,0)
 ;DVBIEN is the 2507 REQUEST FILE IEN
"RTN","DVBARSBD",341,0)
 ;DVBCTW is the string /name of the CLAIM TYPE
"RTN","DVBARSBD",342,0)
 D GETS^DIQ(396.3,DVBIEN_",","9.1*","E","MSG","ERR")
"RTN","DVBARSBD",343,0)
 S DVBCTW=$G(MSG("396.32","1,"_DVBIEN_",",".01","E"))
"RTN","DVBARSBD",344,0)
 Q
"RTN","DVBARSBD",345,0)
 ;
"RTN","DVBARSBD",346,0)
SPEC ;SPECIAL CONSIDERATION(S) FOR A 2507 REQUEST
"RTN","DVBARSBD",347,0)
 K DVBSCW
"RTN","DVBARSBD",348,0)
 S DVBSCWA=""
"RTN","DVBARSBD",349,0)
 N DVBX
"RTN","DVBARSBD",350,0)
 ;DVBIEN is the 2507 REQUEST FILE IEN
"RTN","DVBARSBD",351,0)
 ;DVBSC is a the SPECIAL CONSIDERATION entry for the 2507 REQUEST
"RTN","DVBARSBD",352,0)
 ;DVBSCN is the pointer number to the SPECIAL CONSIDERATION file 396.25
"RTN","DVBARSBD",353,0)
 ;DVBSCW is the string /name of the SPECIAL CONSIDERATION
"RTN","DVBARSBD",354,0)
 Q:'$D(^DVB(396.3,DVBIEN,8,0))
"RTN","DVBARSBD",355,0)
 S DVBAA=$P(^DVB(396.3,DVBIEN,8,0),U,4)
"RTN","DVBARSBD",356,0)
 S (DVBSC,DVBCNT)=0 F  S DVBSC=$O(^DVB(396.3,DVBIEN,8,DVBSC)) Q:'DVBSC  D
"RTN","DVBARSBD",357,0)
 .S DVBSCN=$P(^DVB(396.3,DVBIEN,8,DVBSC,0),U,1)
"RTN","DVBARSBD",358,0)
 .S DVBSCW(DVBSC)=$G(^DVB(396.25,DVBSCN,0))
"RTN","DVBARSBD",359,0)
 .S DVBCNT=DVBCNT+1
"RTN","DVBARSBD",360,0)
 .I (DVBCNT'=DVBAA) S:$D(DVBSCW(DVBSC)) DVBSCW(DVBSC)=DVBSCW(DVBSC)_","
"RTN","DVBARSBD",361,0)
 S DVBX="" F  S DVBX=$O(DVBSCW(DVBX)) Q:'DVBX  S DVBSCWA=DVBSCWA_DVBSCW(DVBX)
"RTN","DVBARSBD",362,0)
 Q
"RTN","DVBARSBD",363,0)
 ;
"RTN","DVBARSBD",364,0)
GETRRDAT ;GRE Input=IEN , get re-route date, to and from site and re-route status
"RTN","DVBARSBD",365,0)
 S (RRDATE,RRTOSITE,RRFRMSITE,RRSTATDTE)=""
"RTN","DVBARSBD",366,0)
 Q:'$D(^DVB(396.3,DVBIEN,6,0)) 
"RTN","DVBARSBD",367,0)
  ; quit if no re-route data found
"RTN","DVBARSBD",368,0)
 K RRIENINC,RRSTATINC,RRSTAT,RRDATE,RRTOSITE,RRFRMSITE,RRSTATDTE
"RTN","DVBARSBD",369,0)
 S (RRIENINC,RRSTATINC)=0
"RTN","DVBARSBD",370,0)
 F  S RRIENINC=$O(^DVB(396.3,DVBIEN,6,RRIENINC)) Q:RRIENINC="B"  D
"RTN","DVBARSBD",371,0)
 . S RRFRMSITE=$$EXTERNAL^DILFD(396.34,.02,,$P(^DVB(396.3,DVBIEN,6,RRIENINC,0),U,4))
"RTN","DVBARSBD",372,0)
 . S RRDATE=$$FMTE^XLFDT($P(^DVB(396.3,DVBIEN,6,RRIENINC,0),U,1),"5DZ")
"RTN","DVBARSBD",373,0)
 . S RRTOSITE=$$EXTERNAL^DILFD(396.34,.02,,$P(^DVB(396.3,DVBIEN,6,RRIENINC,0),U,7))
"RTN","DVBARSBD",374,0)
 . S RRSTATINC=0
"RTN","DVBARSBD",375,0)
 . F  S RRSTATINC=$O(^DVB(396.3,DVBIEN,6,RRIENINC,RRSTATINC)) Q:RRSTATINC=""  D
"RTN","DVBARSBD",376,0)
 . . Q:'$D(^DVB(396.3,DVBIEN,6,RRIENINC,RRSTATINC,0))
"RTN","DVBARSBD",377,0)
 . . S RRSTATDTE=$$FMTE^XLFDT($P(^DVB(396.3,DVBIEN,6,RRIENINC,RRSTATINC,0),U,1),"5DZ")
"RTN","DVBARSBD",378,0)
 . . S RRSTAT=$$EXTERNAL^DILFD(396.341,1,,$P(^DVB(396.3,DVBIEN,6,RRIENINC,RRSTATINC,0),U,2))
"RTN","DVBARSBD",379,0)
 Q
"RTN","DVBARSBD",380,0)
 ;
"RTN","DVBC193P")
0^23^B4711875^n/a
"RTN","DVBC193P",1,0)
DVBC193P ;AJF;Conversion of Request Status Field ; 8/23/18 9:55am
"RTN","DVBC193P",2,0)
 ;;2.7;AMIE;**193**; ;Build 84
"RTN","DVBC193P",3,0)
 ;Post conversion for patch 193
"RTN","DVBC193P",4,0)
 ;This routine converts the Request Status field to a pointer
"RTN","DVBC193P",5,0)
 ;IEN in file #396.33
"RTN","DVBC193P",6,0)
 W !!,"****************************************************"
"RTN","DVBC193P",7,0)
 W !,"Start Request Status Conversion"
"RTN","DVBC193P",8,0)
 W !,"-------------------------",!
"RTN","DVBC193P",9,0)
  N A,A1,A2,RO,DA,X
"RTN","DVBC193P",10,0)
 S A=0
"RTN","DVBC193P",11,0)
 F  S A=$O(^DVB(396.3,A)) Q:A=""  D
"RTN","DVBC193P",12,0)
 .Q:'$D(^DVB(396.3,A,0))
"RTN","DVBC193P",13,0)
 .S A1=$P(^DVB(396.3,A,0),"^",18),RO=$P(^DVB(396.3,A,0),"^",3)
"RTN","DVBC193P",14,0)
 .S A2=$S(A1="N":1,A1="P":2,A1="S":3,A1="R":4,A1="C":5,A1="X":6,A1="RX":7,A1="T":8,A1="NT":9,A1="CT":10,1:A1)
"RTN","DVBC193P",15,0)
 .S $P(^DVB(396.3,A,0),"^",18)=A2
"RTN","DVBC193P",16,0)
 .;Convert "AF" xref
"RTN","DVBC193P",17,0)
 .Q:A=""
"RTN","DVBC193P",18,0)
 .Q:A1=""
"RTN","DVBC193P",19,0)
 .S DA=A,X=A1 X ^DD(396.3,17,1,1,2)
"RTN","DVBC193P",20,0)
 .Q:A2=""
"RTN","DVBC193P",21,0)
 .S X=A2 X ^DD(396.3,17,1,1,1)
"RTN","DVBC193P",22,0)
 W !,"Request Status Field Update Successful",!
"RTN","DVBC193P",23,0)
 W !,"-------------------------"
"RTN","DVBC193P",24,0)
 W !,"End Request Status Conversion"
"RTN","DVBC193P",25,0)
 W !!,"************************************"
"RTN","DVBC193P",26,0)
 ;
"RTN","DVBC193P",27,0)
 ;
"RTN","DVBC193P",28,0)
PMAIN ;-- update DVBAB CAPRI MINIMUM VERSION Parameter.
"RTN","DVBC193P",29,0)
 ;
"RTN","DVBC193P",30,0)
 N DVBERR
"RTN","DVBC193P",31,0)
 ;W !!,"*************************************************"
"RTN","DVBC193P",32,0)
 W !!,"Start DVBAB CAPRI Minimum Version Parameter Update"
"RTN","DVBC193P",33,0)
 W !,"-------------------------",!
"RTN","DVBC193P",34,0)
 ;
"RTN","DVBC193P",35,0)
 S DVBERR=$$ENXPAR("PKG","DVBAB CAPRI MINIMUM VERSION","CAPRI GUI V2.7*193.12*1*A*3181118")
"RTN","DVBC193P",36,0)
 D UPDMSG("CAPRI Minimum Version",DVBERR)
"RTN","DVBC193P",37,0)
 ;
"RTN","DVBC193P",38,0)
 W !!,"-------------------------"
"RTN","DVBC193P",39,0)
 W !,"End DVBAB CAPRI Minimum Version Parameter Updates"
"RTN","DVBC193P",40,0)
 W !,"****************************************************",!!
"RTN","DVBC193P",41,0)
 Q
"RTN","DVBC193P",42,0)
 ;
"RTN","DVBC193P",43,0)
ENXPAR(DVBENT,DVBPAR,DVBVAL) ;Update Parameter values
"RTN","DVBC193P",44,0)
 ;
"RTN","DVBC193P",45,0)
 ;  Input:
"RTN","DVBC193P",46,0)
 ;    DVBENT - Parameter Entity
"RTN","DVBC193P",47,0)
 ;    DVBPAR - Parameter Name
"RTN","DVBC193P",48,0)
 ;    DVBVAL - Parameter Value
"RTN","DVBC193P",49,0)
 ;
"RTN","DVBC193P",50,0)
 ;  Output:
"RTN","DVBC193P",51,0)
 ;    Function value - returns "0" on success;
"RTN","DVBC193P",52,0)
 ;                     otherwise returns error#^errortext
"RTN","DVBC193P",53,0)
 ;
"RTN","DVBC193P",54,0)
 N DVBERR
"RTN","DVBC193P",55,0)
 D EN^XPAR(DVBENT,DVBPAR,1,DVBVAL,.DVBERR)
"RTN","DVBC193P",56,0)
 Q DVBERR
"RTN","DVBC193P",57,0)
 ;
"RTN","DVBC193P",58,0)
UPDMSG(DVBPAR,DVBERR) ;display update message
"RTN","DVBC193P",59,0)
 ;
"RTN","DVBC193P",60,0)
 ;  Input:
"RTN","DVBC193P",61,0)
 ;    DVBPAR - Parameter Name
"RTN","DVBC193P",62,0)
 ;    DVBERR - Parameter Update result
"RTN","DVBC193P",63,0)
 ;
"RTN","DVBC193P",64,0)
 ;  Output: none
"RTN","DVBC193P",65,0)
 ;
"RTN","DVBC193P",66,0)
 I DVBERR D
"RTN","DVBC193P",67,0)
 . D MES^XPDUTL(DVBPAR_" update FAILURE.")
"RTN","DVBC193P",68,0)
 . D MES^XPDUTL("  Failure reason: "_DVBERR)
"RTN","DVBC193P",69,0)
 E  D
"RTN","DVBC193P",70,0)
 . D MES^XPDUTL(DVBPAR_" Update Successful")
"RTN","DVBC193P",71,0)
 Q
"RTN","DVBC193P",72,0)
 ;
"RTN","DVBCADEX")
0^14^B8659510^B8221294
"RTN","DVBCADEX",1,0)
DVBCADEX ;ALB/GTS - 557/THM-ADD C&P EXAMS TO REQUESTS, PART 1 ; 6/28/91  9:32 AM
"RTN","DVBCADEX",2,0)
 ;;2.7;AMIE;**184,193**;Apr 10, 1995;Build 84
"RTN","DVBCADEX",3,0)
 ;
"RTN","DVBCADEX",4,0)
 N FF,HD,HD1,HD2,HD3
"RTN","DVBCADEX",5,0)
SETUP D HOME^%ZIS S FF=IOF,HD="Add a C & P Exam for",HD1="Veteran Selection",HD2="Exam selection",HD3="2507 Exam Addition"
"RTN","DVBCADEX",6,0)
 ;
"RTN","DVBCADEX",7,0)
EN ; Entry point 
"RTN","DVBCADEX",8,0)
 N DVBCARY,DVBCRDAT,DVBCSITE
"RTN","DVBCADEX",9,0)
 K DVBCLCKD D KILL W @FF,!?(IOM-$L(HD3)\2),HD3,!!?(IOM-$L(HD1)\2),HD1,!!!
"RTN","DVBCADEX",10,0)
 S DIC(0)="AEQM",DIC="^DVB(396.3,",DIC("A")="Select VETERAN NAME: "
"RTN","DVBCADEX",11,0)
 S DIC("W")="D DICW^DVBCUTIL"
"RTN","DVBCADEX",12,0)
 S:$D(DVBAROUS) DIC("S")="I $P(^(0),U,10)'=""E""" ;**DVBAROUS set by menu
"RTN","DVBCADEX",13,0)
 D ^DIC G:X=""!(X=U) EXIT
"RTN","DVBCADEX",14,0)
 S:+Y>0 EXCNT=0,(DA,REQDA)=+Y,DFN=$P(Y,U,2) I +Y<0 W "   ???",*7 H 1 G EN
"RTN","DVBCADEX",15,0)
 S X=^DVB(396.3,REQDA,0),OWNDOM=$P(X,U,22)
"RTN","DVBCADEX",16,0)
 D GETS^DIQ(396.3,REQDA,"1;2","E","DVBCARY")
"RTN","DVBCADEX",17,0)
 S DVBCRDAT=DVBCARY(396.3,REQDA_",",1,"E")
"RTN","DVBCADEX",18,0)
 S DVBCSITE=DVBCARY(396.3,REQDA_",",2,"E")
"RTN","DVBCADEX",19,0)
 I OWNDOM]"" W *7,!!,"This request is a TRANSFER IN and exams cannot be added.",!! H 3 G EN
"RTN","DVBCADEX",20,0)
 ;AJF;Request Status conversion
"RTN","DVBCADEX",21,0)
 S STAT=$$RSTAT^DVBCUTL8($P(X,U,18)) K NCN
"RTN","DVBCADEX",22,0)
 F DTB="X","RX","T","C","R","CT","NT" I STAT=DTB S NCN=1 Q
"RTN","DVBCADEX",23,0)
 I $D(NCN) W !!,*7,"This request has been ",$S(STAT["X":"cancelled",STAT="T":"transcribed",STAT["C":"completed",STAT="R":"released",STAT="NT":"transferred in",1:"given an incorrect status"),".",!! H 3 G EN
"RTN","DVBCADEX",24,0)
 S DTA=^DPT(DFN,0),PNAM=$P(DTA,U,1),SSN=$P(DTA,U,9),CNUM=$S($D(^DPT(DFN,.31)):$P(^(.31),U,3),1:"Unknown") S:CNUM="" CNUM="Unknown" D HDR,^DVBCEEXM W !!,"Press RETURN     " R ANS:DTIME G:'$T EXIT
"RTN","DVBCADEX",25,0)
 D ^DVBCADE2,KILL G:$D(OUT)!($D(DVBCLCKD)) EXIT
"RTN","DVBCADEX",26,0)
 G EN
"RTN","DVBCADEX",27,0)
 ;
"RTN","DVBCADEX",28,0)
EXIT K DVBCLCKD G KILL^DVBCUTIL
"RTN","DVBCADEX",29,0)
 ;
"RTN","DVBCADEX",30,0)
HDR W @FF,?(IOM-$L(HD)\2),HD,!!,"Veteran name: ",$P(PNAM,",",2,99)," ",$P(PNAM,",",1),?55,"SSN: ",SSN,!?53,"C-NUM: ",CNUM,!
"RTN","DVBCADEX",31,0)
 F LINE=1:1:IOM W "="
"RTN","DVBCADEX",32,0)
 W ! Q
"RTN","DVBCADEX",33,0)
 ;
"RTN","DVBCADEX",34,0)
KILL K CNUM,DFN,DIK,DR,DTA,DXCOD,DXNUM,EDIT,EX,EXMNM,FMT,PNAM,SSN,PCT,SC,REQDA,CTIM,VX,JY,JJ,X,%,^TMP($J),Y,DA,DIC,DIE,ANS,%Y,%,DTOUT,DUOUT,TEMP,DVBCCONT
"RTN","DVBCADEX",35,0)
 K DVBAINDA,DVBCARY,DVBCRDAT,DVBCSITE,DTB,DVBAROUS,EXCNT
"RTN","DVBCADEX",36,0)
 K LINE,OUT,OWNDOM,STAT
"RTN","DVBCADEX",37,0)
 Q
"RTN","DVBCBULL")
0^41^B30257624^B29784919
"RTN","DVBCBULL",1,0)
DVBCBULL ;ALB/GTS - 557/THM-SEND CANCELLATION BULLETIN ; 6/25/91  11:01 AM
"RTN","DVBCBULL",2,0)
 ;;2.7;AMIE;**42,184,189,193**;Apr 10, 1995;Build 84
"RTN","DVBCBULL",3,0)
 ;
"RTN","DVBCBULL",4,0)
 N MSG1,MERR1,CNT1,MSG2,MERR2,CNT2,RIEN
"RTN","DVBCBULL",5,0)
 K ^TMP("DVBC","BULL",$J),^TMP("DVBC","CMNT",$J) S DIC="^TMP(""DVBC"",""CMNT"",$J,99,",DWPK=1 W @IOF,!!,"Cancellation comments:",!! D EN^DIWE
"RTN","DVBCBULL",6,0)
 K DWPK I $O(^TMP("DVBC","CMNT",$J,99,0))]"" S ^TMP("DVBC","BULL",$J,98,0)=" ",^TMP("DVBC","BULL",$J,97,0)="==========================<  Additional comments  >=========================="
"RTN","DVBCBULL",7,0)
 F I=0:0 S I=$O(^TMP("DVBC","CMNT",$J,99,I)) Q:I=""  S ^TMP("DVBC","BULL",$J,(I+99),0)=^TMP("DVBC","CMNT",$J,99,I,0)
"RTN","DVBCBULL",8,0)
 K ^TMP("DVBC","CMNT",$J) S $P(DOTS,".",45)="." W !!,"A bulletin will now be sent to the 2507 Cancellation mail group.",!
"RTN","DVBCBULL",9,0)
 ;
"RTN","DVBCBULL",10,0)
 ;Build Claim Type Info
"RTN","DVBCBULL",11,0)
 S RIEN=DA
"RTN","DVBCBULL",12,0)
 K ^TMP($J,"DVBCBULL","CT")
"RTN","DVBCBULL",13,0)
 N MSG1,MERR1,CTR1
"RTN","DVBCBULL",14,0)
 S (MSG1,MERR1)="",CTR1=1
"RTN","DVBCBULL",15,0)
 D GETS^DIQ(396.3,RIEN_",","9.1*","E","MSG1","MERR1")
"RTN","DVBCBULL",16,0)
 I $G(MERR1)'="" S ^TMP($J,"DVBCBULL","CT",CTR1)="ERROR GETTING CLAIM TYPE CODES"
"RTN","DVBCBULL",17,0)
 S J=""
"RTN","DVBCBULL",18,0)
 F  S J=$O(MSG1(396.32,J)) Q:J=""  D
"RTN","DVBCBULL",19,0)
 . S CTR1=CTR1+1
"RTN","DVBCBULL",20,0)
 . S ^TMP($J,"DVBCBULL","CT",CTR1)=$G(MSG1(396.32,J,.01,"E"))
"RTN","DVBCBULL",21,0)
 ;
"RTN","DVBCBULL",22,0)
 ;Build Special Considerations Info
"RTN","DVBCBULL",23,0)
 K ^TMP($J,"DVBCBULL","SC")
"RTN","DVBCBULL",24,0)
 N MSG2,MERR2,CTR2
"RTN","DVBCBULL",25,0)
 S (MSG2,MERR2)="",CTR2=1
"RTN","DVBCBULL",26,0)
 D GETS^DIQ(396.3,RIEN,"50*","IE","MSG2","MERR2")
"RTN","DVBCBULL",27,0)
 I $G(MERR2)'="" S ^TMP($J,"DVBCBULL","SC",CTR2)="ERROR GETTING SPECIAL CONSIDERATION CODES"
"RTN","DVBCBULL",28,0)
 S J=""
"RTN","DVBCBULL",29,0)
 F  S J=$O(MSG2(396.31,J)) Q:J=""  D
"RTN","DVBCBULL",30,0)
 . S CTR2=CTR2+1
"RTN","DVBCBULL",31,0)
 . S ^TMP($J,"DVBCBULL","SC",CTR2)=$G(MSG2(396.31,J,.01,"E"))
"RTN","DVBCBULL",32,0)
 ;
"RTN","DVBCBULL",33,0)
GO S L=1,^TMP("DVBC","BULL",$J,L,0)="The following veteran had one or more 2507 exams cancelled:",L=L+1
"RTN","DVBCBULL",34,0)
 S ^TMP("DVBC","BULL",$J,L,0)="   ",L=L+1
"RTN","DVBCBULL",35,0)
 S ^TMP("DVBC","BULL",$J,L,0)="  DFN: `"_DFN_$E("                    ",1,20-$L(DFN))_"SITE: "_DVBCSITE,L=L+1
"RTN","DVBCBULL",36,0)
 S ^TMP("DVBC","BULL",$J,L,0)="  REQUEST DATE: "_DVBCRDAT,L=L+1
"RTN","DVBCBULL",37,0)
 S ^TMP("DVBC","BULL",$J,L,0)="  ",L=L+1
"RTN","DVBCBULL",38,0)
 S ^TMP("DVBC","BULL",$J,L,0)="  Claim Type:",L=L+1
"RTN","DVBCBULL",39,0)
 F  S J=$O(^TMP($J,"DVBCBULL","CT",J)) Q:J=""  D
"RTN","DVBCBULL",40,0)
 . S ^TMP("DVBC","BULL",$J,L,0)="    "_^TMP($J,"DVBCBULL","CT",J),L=L+1
"RTN","DVBCBULL",41,0)
 S ^TMP("DVBC","BULL",$J,L,0)=" ",L=L+1
"RTN","DVBCBULL",42,0)
 S ^TMP("DVBC","BULL",$J,L,0)="  Special Consideration(s):",L=L+1
"RTN","DVBCBULL",43,0)
 S J=""
"RTN","DVBCBULL",44,0)
 F  S J=$O(^TMP($J,"DVBCBULL","SC",J)) Q:J=""  D
"RTN","DVBCBULL",45,0)
 . S ^TMP("DVBC","BULL",$J,L,0)="    "_^TMP($J,"DVBCBULL","SC",J),L=L+1
"RTN","DVBCBULL",46,0)
 S ^TMP("DVBC","BULL",$J,L,0)=" ",L=L+1
"RTN","DVBCBULL",47,0)
 S ^TMP("DVBC","BULL",$J,L,0)="Exams cancelled                               Reason",L=L+1
"RTN","DVBCBULL",48,0)
 S ^TMP("DVBC","BULL",$J,L,0)="  ",L=L+1
"RTN","DVBCBULL",49,0)
 S EXAM="",RSTAT=$P(^DVB(396.3,REQDA,0),U,18)
"RTN","DVBCBULL",50,0)
 ;AJF;Request Status conversion
"RTN","DVBCBULL",51,0)
 S RSTAT=$$RSTAT^DVBCUTL8(RSTAT)
"RTN","DVBCBULL",52,0)
 F JI=0:0 S EXAM=$O(CANC(EXAM)) Q:EXAM=""  I $P(CANC(EXAM),U,1)="X"!($P(CANC(EXAM),U,1)="RX") S REAS=+$P(CANC(EXAM),U,2) D EXAMS
"RTN","DVBCBULL",53,0)
 S ^TMP("DVBC","BULL",$J,L,0)=" ",L=L+1,COMP=1,CMPC=0
"RTN","DVBCBULL",54,0)
 ;
"RTN","DVBCBULL",55,0)
 S ^TMP("DVBC","BULL",$J,L,0)="  ",L=L+1
"RTN","DVBCBULL",56,0)
 S ^TMP("DVBC","BULL",$J,L,0)="** NOTE: To view the patient using the DFN, paste the DFN number into the    **",L=L+1
"RTN","DVBCBULL",57,0)
 S ^TMP("DVBC","BULL",$J,L,0)="** CAPRI Patient Selector 'Patient ID' field to find the patient. Be sure to **",L=L+1
"RTN","DVBCBULL",58,0)
 S ^TMP("DVBC","BULL",$J,L,0)="** include the ' (backward-apostrophe) character.                            **",L=L+1
"RTN","DVBCBULL",59,0)
 S ^TMP("DVBC","BULL",$J,L,0)="  ",L=L+1
"RTN","DVBCBULL",60,0)
 ;
"RTN","DVBCBULL",61,0)
 K ^TMP("DVBC","CMNT",$J)
"RTN","DVBCBULL",62,0)
 I RSTAT["X" S ^TMP("DVBC","BULL",$J,L,0)=" *** All exams on this request are now CANCELLED. ***",L=L+1,^TMP("DVBC","BULL",$J,L,0)=" ",L=L+1
"RTN","DVBCBULL",63,0)
 S ^TMP("DVBC","BULL",$J,L,0)="** This is an auto-generated email.  Do not respond to this email address.   **",L=L+1
"RTN","DVBCBULL",64,0)
 G SEND
"RTN","DVBCBULL",65,0)
 S ECNT=0
"RTN","DVBCBULL",66,0)
 F JZ=0:0 S JZ=$O(^DVB(396.4,"C",REQDA,JZ)) Q:JZ=""  S STAT=$P(^DVB(396.4,JZ,0),U,4) S:STAT="C" CMPC=1 I STAT'="C"&(STAT'["X") S COMP=0,ECNT=ECNT+1
"RTN","DVBCBULL",67,0)
 ;CMPC=completed exam COMP=open exam
"RTN","DVBCBULL",68,0)
 ;both are toggled, depending on exam status.  Both must be 1 to put release banner on message
"RTN","DVBCBULL",69,0)
 I RSTAT'["X",COMP=0 S ^TMP("DVBC","BULL",$J,L,0)=" *** There "_$S(ECNT=1:"is",1:"are")_" still "_ECNT_" exam"_$S(ECNT=1:"",1:"s")_" open on this request. ***",L=L+1,^TMP("DVBC","BULL",$J,L,0)=" ",L=L+1 G SEND
"RTN","DVBCBULL",70,0)
 I COMP=1&(CMPC=1),RSTAT'["X" S ^TMP("DVBC","BULL",$J,L,0)=" *** This request is now COMPLETE and should be released by MAS ***",L=L+1
"RTN","DVBCBULL",71,0)
 I COMP=1&(CMPC=1),RSTAT'["X" S ^TMP("DVBC","BULL",$J,L,0)=" ",L=L+1 ;spacer
"RTN","DVBCBULL",72,0)
 ;
"RTN","DVBCBULL",73,0)
SEND ;remote sites get bulletins only on total cancellations
"RTN","DVBCBULL",74,0)
 S DIC="^XMB(3.8,",DIC(0)="QM",X="DVBA C 2507 CANCELLATION" D ^DIC S MG=+Y I +Y<0 W !!,*7,"2507 mail group NOT found!  Bulletin not sent.",!! H 3 Q
"RTN","DVBCBULL",75,0)
 F JI=0:0 S JI=$O(^XMB(3.8,MG,1,"B",JI)) Q:JI=""  S XMY(JI)=""
"RTN","DVBCBULL",76,0)
 F JI=0:0 S JI=$O(XMY(JI)) Q:JI=""!(+JI=0)  I '$D(^VA(200,JI,2,+REQRO))&'$D(^VA(200,JI,2,+REQRO))&('$D(^XUSEC("DVBA C SUPERVISOR",JI))) K XMY(JI)
"RTN","DVBCBULL",77,0)
 S:REQSTR="" REQSTR=.5 S XMY(REQSTR)="",XMY(DUZ)="",XMSUB="Cancellation of 2507 Exams",XMTEXT="^TMP(""DVBC"",""BULL"",$J,",XMDUZ=DUZ
"RTN","DVBCBULL",78,0)
 I '$D(^VA(200,DUZ,.15)) S XMY(XMDUZ)="" G XMD
"RTN","DVBCBULL",79,0)
 I $D(^VA(200,DUZ,.15))&($P(^VA(200,DUZ,.15),"^",1)="") S XMY(XMDUZ)="" G XMD
"RTN","DVBCBULL",80,0)
 I $D(^VA(200,DUZ,.15)) S XMY($P(^VA(200,DUZ,.15),"^",1))=""
"RTN","DVBCBULL",81,0)
XMD D ^XMD
"RTN","DVBCBULL",82,0)
 K ^TMP("DVBC","BULL",$J),XMDUZ,DOTS,COMP,CMPC,XEXAM,REASON,L,JI,JY,XMY,XMSUB,XMTEXT,XMDUZ,ECNT
"RTN","DVBCBULL",83,0)
 K ^TMP($J,"DVBCBULL","CT"),^TMP($J,"DVBCBULL","SC")
"RTN","DVBCBULL",84,0)
 Q
"RTN","DVBCBULL",85,0)
 ;
"RTN","DVBCBULL",86,0)
EXAMS S REASON=$S($D(^DVB(396.5,+REAS,0)):$P(^(0),U,1),1:"Undetermined")
"RTN","DVBCBULL",87,0)
 S XEXAM=$E(EXAM,1,25),^TMP("DVBC","BULL",$J,L,0)="     "_XEXAM_" "_$E(DOTS,1,35-$L(XEXAM))_" "_REASON S L=L+1
"RTN","DVBCBULL",88,0)
 Q
"RTN","DVBCCHKR")
0^13^B29140314^B29025053
"RTN","DVBCCHKR",1,0)
DVBCCHKR ;ALB/GTS-557/THM-CHECK C&P REQUEST FOR CRITICAL DATA ; 2/12/03 9:44am
"RTN","DVBCCHKR",2,0)
 ;;2.7;AMIE;**17,193,194**;Apr 10, 1995;Build 84
"RTN","DVBCCHKR",3,0)
 ;
"RTN","DVBCCHKR",4,0)
 ;** Version Changes
"RTN","DVBCCHKR",5,0)
 ; 2.7 - GTS/C&P appt links report (Enhc 13)
"RTN","DVBCCHKR",6,0)
 ;
"RTN","DVBCCHKR",7,0)
 S DVBCMAN="" G EN
"RTN","DVBCCHKR",8,0)
 ;
"RTN","DVBCCHKR",9,0)
CHECK N OLDX
"RTN","DVBCCHKR",10,0)
 S OLDX=X,DTA=^DVB(396.3,DA,0),DTB=$S($D(^DVB(396.3,DA,1)):^(1),1:"")
"RTN","DVBCCHKR",11,0)
 ;RRA DVBA*194 priority of exam no longer populated so remove from validation list
"RTN","DVBCCHKR",12,0)
 ;AJF;Request Status conversion
"RTN","DVBCCHKR",13,0)
 Q:$P(DTA,U,18)=6  F XI=2,3,4,18 I $P(^DVB(396.3,DA,0),U,XI)="" S X=X_XI_U
"RTN","DVBCCHKR",14,0)
 I $P(DTB,U,4)="" S X=X_99_U
"RTN","DVBCCHKR",15,0)
 I $O(^DVB(396.4,"C",DA,0))="" S X=X_98_U ;no exams selected
"RTN","DVBCCHKR",16,0)
 S REQDA=DA,NAME=$P(^DPT(DFN,0),U,1) D:STYLEIND'="4" LINKCK
"RTN","DVBCCHKR",17,0)
 I OLDX'=X DO
"RTN","DVBCCHKR",18,0)
 .S:$E(X,$L(X))="^" X=$E(X,1,($L(X)-1))
"RTN","DVBCCHKR",19,0)
 .S X=X_";"_DA_"~"
"RTN","DVBCCHKR",20,0)
 I X]"" S ^TMP($J,NAME,DFN)=X
"RTN","DVBCCHKR",21,0)
 Q
"RTN","DVBCCHKR",22,0)
 ;
"RTN","DVBCCHKR",23,0)
PRINT D HDR S NAME=""
"RTN","DVBCCHKR",24,0)
 F XI=0:0 S NAME=$O(^TMP($J,NAME)) Q:NAME=""!($D(DVBCQUIT))  DO
"RTN","DVBCCHKR",25,0)
 .S (DVBAPC,DVBADTA)=""
"RTN","DVBCCHKR",26,0)
 .F DFN=0:0 S DFN=$O(^TMP($J,NAME,DFN)) Q:DFN=""!($D(DVBCQUIT))  DO
"RTN","DVBCCHKR",27,0)
 ..I (IOST?1"C-".E),($Y>(IOSL-9)) D TERM^DVBCUTL3 S:$D(GETOUT) DVBCQUIT=""
"RTN","DVBCCHKR",28,0)
 ..I '$D(DVBCQUIT) DO
"RTN","DVBCCHKR",29,0)
 ...D:($Y>(IOSL-9)) HDR
"RTN","DVBCCHKR",30,0)
 ...D NAMELN ;**Output name
"RTN","DVBCCHKR",31,0)
 ...F DVBAPC=1:1 S DVBADTA=$P(^TMP($J,NAME,DFN),"~",DVBAPC) Q:DVBADTA=""  DO
"RTN","DVBCCHKR",32,0)
 ....W !
"RTN","DVBCCHKR",33,0)
 ....S DTA=$P(DVBADTA,";",1),REQDA=$P(DVBADTA,";",2) ;**DVBADTA=Prob pce
"RTN","DVBCCHKR",34,0)
 ....F DVBCX=1:1 S DVBAY=$P(DTA,U,DVBCX) Q:DVBAY=""!($D(DVBCQUIT))  I DVBAY]"" D PRINT1
"RTN","DVBCCHKR",35,0)
 .K DVBAPC,DVBADTA
"RTN","DVBCCHKR",36,0)
 I '$D(DVBCQUIT)&(IOST?1"C-".E) D TERM^DVBCUTL3 S:$D(GETOUT) DVBCQUIT=""
"RTN","DVBCCHKR",37,0)
 Q
"RTN","DVBCCHKR",38,0)
 ;
"RTN","DVBCCHKR",39,0)
PRINT1 I (IOST?1"C-".E),($Y>(IOSL-2)) D TERM^DVBCUTL3 S:$D(GETOUT) DVBCQUIT=""
"RTN","DVBCCHKR",40,0)
 I '$D(DVBCQUIT) DO
"RTN","DVBCCHKR",41,0)
 .I ($Y>(IOSL-2)) D HDR,NAMELN
"RTN","DVBCCHKR",42,0)
 .W ?50,$S(DVBAY=2:"Request date",DVBAY=3:"Regional office number",DVBAY=4:"Requester",DVBAY=10:"Priority of exam",DVBAY=18:"Request status",DVBAY=99:"Routing location",1:"")
"RTN","DVBCCHKR",43,0)
 .W:DVBAY=98 ?50,"** No exams selected **"
"RTN","DVBCCHKR",44,0)
 .W:DVBAY=199 ?50,"** No C&P Appt's linked **"
"RTN","DVBCCHKR",45,0)
 .W !
"RTN","DVBCCHKR",46,0)
 Q
"RTN","DVBCCHKR",47,0)
 ;
"RTN","DVBCCHKR",48,0)
EN D HOME^%ZIS S FF=IOF
"RTN","DVBCCHKR",49,0)
 W @FF,!!,"This report will check the 2507 REQUEST file for missing crucial data.",!!,"All requests will be checked and those found missing any of the following",!,"will be reported:",!!
"RTN","DVBCCHKR",50,0)
 W "1)  Request date",!,"2)  Regional office number",!,"3)  Requester",!
"RTN","DVBCCHKR",51,0)
 W "4)  Request status",!,"5)  Routing location",!,"6)  No exams selected"
"RTN","DVBCCHKR",52,0)
 D SETSTYLE
"RTN","DVBCCHKR",53,0)
 W:STYLEIND=4 !
"RTN","DVBCCHKR",54,0)
 W:STYLEIND'="4" !,"7)  Requests older than 3 days without C&P Appt links ",!
"RTN","DVBCCHKR",55,0)
 W ! K PARAMDA
"RTN","DVBCCHKR",56,0)
 ;
"RTN","DVBCCHKR",57,0)
ASK W "Do you want to continue" S %=2 D YN^DICN G:$D(DTOUT) EXIT
"RTN","DVBCCHKR",58,0)
 I $D(%Y),%Y["?" W !!,"Enter Y to print the report or N to quit.",!! H 2 G ASK
"RTN","DVBCCHKR",59,0)
 I $D(%),%'=1 G EXIT
"RTN","DVBCCHKR",60,0)
 ;
"RTN","DVBCCHKR",61,0)
DEV W !! S %ZIS="AEQ" D ^%ZIS K %ZIS G:POP EXIT I $D(IO("Q")) S ZTIO=ION,ZTDESC="2507 exam integrity report",ZTRTN="GO^DVBCCHKR" F I="FF" S ZTSAVE(I)=""
"RTN","DVBCCHKR",62,0)
 I  D ^%ZTLOAD W:$D(ZTSK) !!,"Request queued",!! G EXIT
"RTN","DVBCCHKR",63,0)
 ;
"RTN","DVBCCHKR",64,0)
GO D:'$D(STYLEIND) SETSTYLE
"RTN","DVBCCHKR",65,0)
 K ^TMP($J),LN,DVBCQUIT,GETOUT S (ITEMS,PG)=0,$P(LN,"-",80)="-",HD="C & P Exam Integrity Report",DVBCDT=$$FMTE^XLFDT(DT,"5DZ")
"RTN","DVBCCHKR",66,0)
 U IO F DFN=0:0 S X="",DFN=$O(^DVB(396.3,"B",DFN)) Q:DFN=""  F DA=0:0 S DA=$O(^DVB(396.3,"B",DFN,DA)) Q:DA=""  D CHECK
"RTN","DVBCCHKR",67,0)
 I '$D(^TMP($J)) D HDR W !!!!!?25,"Nothing found to report",!!
"RTN","DVBCCHKR",68,0)
 I $D(^TMP($J)) D PRINT
"RTN","DVBCCHKR",69,0)
 I ('$D(^TMP("DVBA",$J))&((+STYLEIND'="4")&(+$$RPTCHK=1))) DO
"RTN","DVBCCHKR",70,0)
 .D NOW^%DTC S Y=X X ^DD("DD")
"RTN","DVBCCHKR",71,0)
 .S TODAYDT=Y K Y,X
"RTN","DVBCCHKR",72,0)
 .S SITE=$$SITE^DVBCUTL4
"RTN","DVBCCHKR",73,0)
 .D RPTHD^DVBCULAP W !!!!!?25,"Nothing found to report",!!
"RTN","DVBCCHKR",74,0)
 .I (IOST?1"C-".E) D PAUSE^DVBCUTL4
"RTN","DVBCCHKR",75,0)
 .K TODAYDT,SITE
"RTN","DVBCCHKR",76,0)
 I $D(^TMP("DVBA",$J)) D:(+$$RPTCHK=1) ^DVBCULAP
"RTN","DVBCCHKR",77,0)
 ;
"RTN","DVBCCHKR",78,0)
EXIT D ^%ZISC
"RTN","DVBCCHKR",79,0)
 W:'$D(ZTQUEUED) @FF,!!!
"RTN","DVBCCHKR",80,0)
 I $D(ZTQUEUED)&($D(DVBCMAN)) D KILL^%ZTLOAD
"RTN","DVBCCHKR",81,0)
 K %,%Y,DTA,DTB,DTOUT,DVBCDT,FF,HD,NAME,PG,I,ZTSAVE,POP,X,XI,Y
"RTN","DVBCCHKR",82,0)
 K ZTQUEUED,ZTDESC,ZTIO,ZTRTN,ZTSK,ITEMS,PRINT,DFN,DA,LN,DVBCMAN,DVBCQUIT,GETOUT,DVBCX,HDRPRT
"RTN","DVBCCHKR",83,0)
 K ^TMP("DVBA",$J),^TMP($J),REQDA,STYLEIND,DVBAY,DIQ,DIR,DIRUT,DUOUT
"RTN","DVBCCHKR",84,0)
 K DR,DIC
"RTN","DVBCCHKR",85,0)
 Q
"RTN","DVBCCHKR",86,0)
 ;
"RTN","DVBCCHKR",87,0)
HDR S PG=PG+1,HDRPRT="" W @IOF
"RTN","DVBCCHKR",88,0)
 W !,DVBCDT,?(80-$L(HD)\2),HD,?69,"Page: ",PG,!,?(80-$L($$SITE^DVBCUTL4)\2),$$SITE^DVBCUTL4,!!,"Veteran name",?28,"Social Sec #",?50,"Missing items",!
"RTN","DVBCCHKR",89,0)
 Q
"RTN","DVBCCHKR",90,0)
 ;
"RTN","DVBCCHKR",91,0)
LINKCK ;** Patient DFN's w/ 2507's >3 days w/out links
"RTN","DVBCCHKR",92,0)
 ;** Called - 2507 C&P INTEG RPT'=OFF
"RTN","DVBCCHKR",93,0)
 ;** $D(DVBAFND) - 2507 >3 days old w/out links
"RTN","DVBCCHKR",94,0)
 N DVBAX,DVBADAYS
"RTN","DVBCCHKR",95,0)
 S:'$D(X) X=""
"RTN","DVBCCHKR",96,0)
 S DVBAX=X ;**Save X (prob report var)
"RTN","DVBCCHKR",97,0)
 I +$$STYLE^DVBCUTL8(REQDA)=1 DO
"RTN","DVBCCHKR",98,0)
 .K X,X1,X2
"RTN","DVBCCHKR",99,0)
 .D NOW^%DTC
"RTN","DVBCCHKR",100,0)
 .S X2=($P(^DVB(396.3,REQDA,0),U,5)\1),X1=X\1
"RTN","DVBCCHKR",101,0)
 .K X D ^%DTC
"RTN","DVBCCHKR",102,0)
 .S DVBADAYS=X K X
"RTN","DVBCCHKR",103,0)
 .S X=DVBAX ;**Reset X (prob var)
"RTN","DVBCCHKR",104,0)
 .I +DVBADAYS>3 DO  ;**2507 >3 days old, check links
"RTN","DVBCCHKR",105,0)
 ..N APPTDA S APPTDA=""
"RTN","DVBCCHKR",106,0)
 ..K DVBAFND
"RTN","DVBCCHKR",107,0)
 ..I +$O(^DVB(396.95,"AR",REQDA,APPTDA))'>0 DO
"RTN","DVBCCHKR",108,0)
 ...S:$$TRANCHK^DVBCUTA4(REQDA)=0 DVBAFND="" ;**2507 w/out links
"RTN","DVBCCHKR",109,0)
 ..I $D(DVBAFND) DO  ;**Unlinked 2507 >3 days old
"RTN","DVBCCHKR",110,0)
 ...S:(+$$RPTCHK=1) ^TMP("DVBA",$J,NAME,DFN)="" ;**TMP("DVBA") - unlinked 2507's
"RTN","DVBCCHKR",111,0)
 ...S X=X_"199^"
"RTN","DVBCCHKR",112,0)
 K DVBAFND
"RTN","DVBCCHKR",113,0)
 Q
"RTN","DVBCCHKR",114,0)
 ;
"RTN","DVBCCHKR",115,0)
RPTCHK() ;**Check C&P Report Param field - 396.1
"RTN","DVBCCHKR",116,0)
 N PARAMDA,PARAMVAL S PARAMDA=0
"RTN","DVBCCHKR",117,0)
 S PARAMDA=$O(^DVB(396.1,PARAMDA))
"RTN","DVBCCHKR",118,0)
 S PARAMVAL=$P(^DVB(396.1,PARAMDA,0),U,19)
"RTN","DVBCCHKR",119,0)
 Q PARAMVAL
"RTN","DVBCCHKR",120,0)
 ;
"RTN","DVBCCHKR",121,0)
NAMELN W LN,!!,NAME,?28,$P(^DPT(DFN,0),U,9)
"RTN","DVBCCHKR",122,0)
 Q
"RTN","DVBCCHKR",123,0)
 ;
"RTN","DVBCCHKR",124,0)
SETSTYLE ;
"RTN","DVBCCHKR",125,0)
 S PARAMDA=0
"RTN","DVBCCHKR",126,0)
 S PARAMDA=$O(^DVB(396.1,PARAMDA))
"RTN","DVBCCHKR",127,0)
 S STYLEIND=$P(^DVB(396.1,PARAMDA,0),U,15)
"RTN","DVBCCHKR",128,0)
 Q
"RTN","DVBCCNC1")
0^29^B14797282^B14689531
"RTN","DVBCCNC1",1,0)
DVBCCNC1 ;ALB ISC/THM-CANCEL ENTIRE REQUEST ; 9/22/91  4:14 PM
"RTN","DVBCCNC1",2,0)
 ;;2.7;AMIE;**193,194**;Apr 10, 1995;Build 84
"RTN","DVBCCNC1",3,0)
 ;
"RTN","DVBCCNC1",4,0)
ALL K NONE W ! S ALLCANC=1,DIC="^DVB(396.5,",DIC(0)="AEQM",DIC("S")="I $P(^(0),U,3)=1",DIC("A")="Enter REASON FOR CANCELLATION: " D ^DIC G:X=""!(X=U)!(+Y'>0) EXIT^DVBCCNCL S REAS=+Y
"RTN","DVBCCNC1",5,0)
 ;
"RTN","DVBCCNC1",6,0)
BY W !,"Cancelled by (M)AS or (R)O?  M//  "
"RTN","DVBCCNC1",7,0)
 R BY:DTIME
"RTN","DVBCCNC1",8,0)
 G:'$T!(BY=U) EXIT^DVBCCNCL
"RTN","DVBCCNC1",9,0)
 I BY=""!(BY="m") W:BY="" "M" S BY="M" ;echo selection
"RTN","DVBCCNC1",10,0)
 S:BY="r" BY="R"
"RTN","DVBCCNC1",11,0)
 I BY'?1"M"&(BY'?1"R") W !!,"Enter M to indicate cancellation by MAS or",!," R to indicate cancellation by the Regional Office.",!! G BY
"RTN","DVBCCNC1",12,0)
 W $S(BY="M":"AS",BY="R":"O",1:"") ;finish echo of selection
"RTN","DVBCCNC1",13,0)
 ;
"RTN","DVBCCNC1",14,0)
BY1 W *7,!!,"Cancelled by ",$S(BY="":"MAS",BY="M":"MAS",BY="R":"RO",1:"Unknown source")," Ok" S %=2 D YN^DICN G:$D(DTOUT)!(%<0) EXIT^DVBCCNCL
"RTN","DVBCCNC1",15,0)
 I $D(%Y),%Y["?" W !!,"Enter Y to verify or N to reselect",! G BY1
"RTN","DVBCCNC1",16,0)
 I $D(%),%'=1 G BY
"RTN","DVBCCNC1",17,0)
 S BY=$S(BY="R":"RX",BY="M":"X",1:"")
"RTN","DVBCCNC1",18,0)
 W !!
"RTN","DVBCCNC1",19,0)
 F JJZ=0:0 S JJZ=$O(^DVB(396.4,"C",DA(1),JJZ)) Q:JJZ=""  S STAT=$P(^DVB(396.4,JJZ,0),U,4) I STAT="O" D ALL1
"RTN","DVBCCNC1",20,0)
 I '$D(CANC) S CANC("None - (Request only)")=BY_U_REAS ;used in case of request logging error (system)
"RTN","DVBCCNC1",21,0)
 H 1 S DA=DA(1),(DIC,DIE)="^DVB(396.3,",DR="17///"_BY_";19///NOW;20////^S X=DUZ" D ^DIE,NOTIFY,BULL I $D(OUT) G EXIT^DVBCCNCL
"RTN","DVBCCNC1",22,0)
 G LOOK^DVBCCNCL
"RTN","DVBCCNC1",23,0)
 ;
"RTN","DVBCCNC1",24,0)
ALL1 S EXMPTR=$P(^DVB(396.4,JJZ,0),U,3),EXMNM=$S($D(^DVB(396.6,+EXMPTR,0)):$P(^(0),U,1),1:"Unknown exam"_" ("_+EXMPTR_")") K EXMPTR ;show deleted exam
"RTN","DVBCCNC1",25,0)
 S DR=".04////"_BY_";52////"_REAS_";51////^S X=DUZ;50///NOW",DA=JJZ
"RTN","DVBCCNC1",26,0)
 S (DIC,DIE)="^DVB(396.4," D ^DIE
"RTN","DVBCCNC1",27,0)
 I '$D(Y) W:$X>50 ! W:$L(EXMNM)>25&($X>45) ! W EXMNM," cancelled, " S CANC(EXMNM)=BY_U_REAS
"RTN","DVBCCNC1",28,0)
 I $D(Y) W *7,!,"Cancellation error on ",EXMNM," exam !" H 2
"RTN","DVBCCNC1",29,0)
 Q
"RTN","DVBCCNC1",30,0)
 ;
"RTN","DVBCCNC1",31,0)
NOTIFY S X=$P(^DVB(396.3,DA,0),U,18)
"RTN","DVBCCNC1",32,0)
 ;AJF; Request Status Conversion
"RTN","DVBCCNC1",33,0)
 S X=$$RSTAT^DVBCUTL8(X)
"RTN","DVBCCNC1",34,0)
 I X="RX"!(X="X") W !!,"Entire exam is now CANCELLED.",!! H 1 Q
"RTN","DVBCCNC1",35,0)
 I X'="RX"&(X'="X") W *7,!!,"Cancellation error !",!! H 3 S OUT=1
"RTN","DVBCCNC1",36,0)
 Q
"RTN","DVBCCNC1",37,0)
 ;
"RTN","DVBCCNC1",38,0)
BULL Q:'$D(CANC)  S SEND=1,EXAM="" F JI=0:0 S EXAM=$O(CANC(EXAM)) Q:EXAM=""  I $P(CANC(EXAM),U,1)'="X"&($P(CANC(EXAM),U,1)'="RX") S SEND=0 Q
"RTN","DVBCCNC1",39,0)
 I SEND=0 W *7,!!,"An error has occurred during cancellation - bulletin will not be sent!",!!,*7 H 3 Q
"RTN","DVBCCNC1",40,0)
 K OWNDOM,XDOM,DOMAIN,DOMNUM
"RTN","DVBCCNC1",41,0)
 I $D(ALLCANC) S OWNDOM=$P(^DVB(396.3,DA(1),0),U,22) I OWNDOM]"" S XDOM=$S($D(^DIC(4.2,OWNDOM,0)):^(0),1:"") S DOMAIN=$P(XDOM,U,1),DOMNUM=$S(+$P(XDOM,U,3)>0:+$P(XDOM,U,3),1:OWNDOM)
"RTN","DVBCCNC1",42,0)
 I $D(ALLCANC),OWNDOM]"" I +DOMNUM>0 S XMY("G.DVBA C 2507 CANCELLATION@"_DOMAIN)=DOMNUM W !!,*7,"I am sending a copy of this cancellation to the",!,"cancellation mail group at "_DOMAIN,!,"since this was transferred in.",!! H 2
"RTN","DVBCCNC1",43,0)
 I SEND=1 S REQDA=DA(1) D ^DVBCBULL I $D(ALLCANC),OWNDOM]"",+DOMNUM>0 S REQDA=DA(1) D EN1^DVBCXFRE
"RTN","DVBCCNC1",44,0)
 K ALLCANC,CANC,SEND,OWNDOM,DOMNUM
"RTN","DVBCCNC1",45,0)
 Q
"RTN","DVBCCNCL")
0^28^B28830312^B29391810
"RTN","DVBCCNCL",1,0)
DVBCCNCL ;ALB/GTS - 557/THM-2507 CANCEL REQUESTS, EXAMS ; 9/23/91  9:25 AM
"RTN","DVBCCNCL",2,0)
 ;;2.7;AMIE;**102,184,193,194**;Apr 10, 1995;Build 84
"RTN","DVBCCNCL",3,0)
 ;
"RTN","DVBCCNCL",4,0)
 G EN
"RTN","DVBCCNCL",5,0)
LOOK1 S EXAM=$S($D(^DVB(396.6,$P(^DVB(396.4,JZ,0),U,3),0)):$P(^(0),U,1),1:"Unknown")
"RTN","DVBCCNCL",6,0)
 S STAT=$P(^DVB(396.4,JZ,0),U,4)
"RTN","DVBCCNCL",7,0)
 S $P(^TMP($J,EXAM),U,1)=STAT_U_JZ S:STAT="C" TCNCL=1 S:STAT="T" TCNCL=2
"RTN","DVBCCNCL",8,0)
 Q
"RTN","DVBCCNCL",9,0)
 ;
"RTN","DVBCCNCL",10,0)
EN ;
"RTN","DVBCCNCL",11,0)
 N DVBCARY,DVBCRDAT,DVBCSITE
"RTN","DVBCCNCL",12,0)
 D HOME^%ZIS S FF=IOF,HD="2507 Exam Veteran Selection",HD2="2507 Test Cancellation"
"RTN","DVBCCNCL",13,0)
 ;
"RTN","DVBCCNCL",14,0)
LOOK D KILL W @FF,!?(IOM-$L(HD)\2),HD,!?(IOM-$L(HD2)\2),HD2,!! S DIC("W")="D DICW^DVBCUTIL" S DIC="^DVB(396.3,",DIC(0)="AEQM",DIC("A")="Select VETERAN: " D ^DIC G:X=""!(X=U) EXIT I +Y<0 W *7,"  ???" G LOOK
"RTN","DVBCCNCL",15,0)
 S DA(1)=+Y,DFN=$P(Y,U,2),STAT=$P(^DVB(396.3,DA(1),0),U,18)
"RTN","DVBCCNCL",16,0)
 ;AJF; Request Status Conversion
"RTN","DVBCCNCL",17,0)
 S STAT=$$RSTAT^DVBCUTL8(STAT)
"RTN","DVBCCNCL",18,0)
 D STATCHK G:$D(NCN) LOOK S REQDT=$P(^DVB(396.3,DA(1),0),U,2)
"RTN","DVBCCNCL",19,0)
 D GETS^DIQ(396.3,DA(1),"1;2","E","DVBCARY")
"RTN","DVBCCNCL",20,0)
 S DVBCRDAT=DVBCARY(396.3,DA(1)_",",1,"E")
"RTN","DVBCCNCL",21,0)
 S DVBCSITE=DVBCARY(396.3,DA(1)_",",2,"E")
"RTN","DVBCCNCL",22,0)
 I '$D(^DPT(DFN,0)) W *7,!!,"Zeroth node for ^DPT record missing!",!! H 3 G LOOK
"RTN","DVBCCNCL",23,0)
 S PNAM=$P(^DPT(DFN,0),U,1),SSN=$P(^(0),U,9),CNUM=$S($D(^DPT(DFN,.31)):$P(^(.31),U,3),1:"Unknown") K DICW
"RTN","DVBCCNCL",24,0)
 S REQRO=$P(^DVB(396.3,DA(1),0),U,3),REQSTR=$P(^(0),U,4) ;used to screen bulletins
"RTN","DVBCCNCL",25,0)
 K TCNCL F JZ=0:0 S JZ=$O(^DVB(396.4,"C",DA(1),JZ)) Q:JZ=""  D LOOK1
"RTN","DVBCCNCL",26,0)
 ;
"RTN","DVBCCNCL",27,0)
ASK I $D(TCNCL) W *7,!!,"This request cannot be cancelled entirely because",!," one or more exams have ",$S(TCNCL=2:"been transferred.",1:"been completed.")
"RTN","DVBCCNCL",28,0)
 I  W !!,"However, you may cancel other individual exams.",!!,"Press RETURN " R ANS:60 G:'$T!(ANS="^") EXIT G DATA
"RTN","DVBCCNCL",29,0)
 W !!,"Do you want to cancel the entire exam" S %=2 D YN^DICN G:$D(DTOUT)!(%<0) EXIT G:%=1 ^DVBCCNC1
"RTN","DVBCCNCL",30,0)
 I $D(%Y),%Y["?" W !!,"Enter Y to cancel the ENTIRE exam or N to cancel ONLY selected exams",!! G ASK
"RTN","DVBCCNCL",31,0)
 ;
"RTN","DVBCCNCL",32,0)
DATA K EXMPTR,NCN
"RTN","DVBCCNCL",33,0)
 D HDR^DVBCUTIL
"RTN","DVBCCNCL",34,0)
EXMSEL S REQDA=DA(1),Y=$$EXSRH^DVBCUTL4("Select EXAM TO CANCEL: ","I $D(^DVB(396.4,""ARQ""_REQDA,+Y))") ;*Exam lookup function call
"RTN","DVBCCNCL",35,0)
 K DIC("S"),REQDA
"RTN","DVBCCNCL",36,0)
 N DVBACR
"RTN","DVBCCNCL",37,0)
 G:$D(DTOUT) EXIT I X=""!(X=U)&($D(CANC)) D BULL^DVBCCNC1 G LOOK
"RTN","DVBCCNCL",38,0)
 I $D(X),X=""!(X=U)&('$D(CANC)) G LOOK
"RTN","DVBCCNCL",39,0)
 I Y=-1 W *7,"  ??" G EXMSEL  ;DVBA*2.7*102
"RTN","DVBCCNCL",40,0)
 I ($P(^DVB(396.4,+Y,0),U,4)["X")!($P(^DVB(396.4,+Y,0),U,4)="T") W *7," ??" G EXMSEL
"RTN","DVBCCNCL",41,0)
 S EXMPTR=+Y,EXMNM=$P(^DVB(396.4,+Y,0),U,3)
"RTN","DVBCCNCL",42,0)
 S EXMNM=$S($D(^DVB(396.6,EXMNM,0)):$P(^(0),U,1),1:"Unknown exam")
"RTN","DVBCCNCL",43,0)
 S STAT=$P(^TMP($J,EXMNM),U,1)
"RTN","DVBCCNCL",44,0)
 ;AJF; Request Status Conversion
"RTN","DVBCCNCL",45,0)
 ;S STAT=$$RSTAT^DVBCUTL8(STAT)
"RTN","DVBCCNCL",46,0)
 D STATCHK G:$D(NCN) DATA
"RTN","DVBCCNCL",47,0)
 D CNCLCHK G:NOFND=0 DATA G:$D(OUT) EXIT
"RTN","DVBCCNCL",48,0)
 ;
"RTN","DVBCCNCL",49,0)
 ;  ** If selected an exam, enter Cancellation Reason.
"RTN","DVBCCNCL",50,0)
 S DVBCMSG=" for this "_EXMNM_" exam:",EXMCNC="" D CODE G:$D(OUT) EXIT
"RTN","DVBCCNCL",51,0)
 ;RRA DVBA*2.7*194 filter out inactive cancelation reasons
"RTN","DVBCCNCL",52,0)
 S DIC="^DVB(396.5,",DIC(0)="QEAZ",DIC("S")="I $P(^(0),U,3)=1"
"RTN","DVBCCNCL",53,0)
 F  D ^DIC Q:X'=""  W " ??",!,"     Enter the response which best describes the reason for the cancellation."
"RTN","DVBCCNCL",54,0)
 I +Y<0 G EXIT
"RTN","DVBCCNCL",55,0)
 S DVBACR=+Y
"RTN","DVBCCNCL",56,0)
 S DR="52////"_DVBACR_";.04////"_CCODE_";51////^S X=DUZ;50///NOW",DIE="^DVB(396.4,"
"RTN","DVBCCNCL",57,0)
 S DA=EXMPTR D ^DIE K DR,DIE G:($D(Y))!($D(DTOUT)) EXIT
"RTN","DVBCCNCL",58,0)
 S STAT=$P(^DVB(396.4,DA,0),U,4),REASON=+$P(^DVB(396.4,DA,"CAN"),U,3)
"RTN","DVBCCNCL",59,0)
 G:REASON=0 LOOK S $P(^TMP($J,EXMNM),U,1)=STAT
"RTN","DVBCCNCL",60,0)
 S ^TMP("DVBA",$J,9999999-$P(^DVB(396.4,EXMPTR,"CAN"),U,1))=CCODE
"RTN","DVBCCNCL",61,0)
 S CANC(EXMNM)=STAT_U_REASON D CNCLCHK I $D(OUT) G EXIT
"RTN","DVBCCNCL",62,0)
 K %DT G DATA
"RTN","DVBCCNCL",63,0)
 ;
"RTN","DVBCCNCL",64,0)
EXIT D KILL K CCODE,DVBCMSG,TCNCL,^TMP($J),EXMPTR,J,ANS,CNUM,DIR,DTOUT,FF,HD,HD2
"RTN","DVBCCNCL",65,0)
 G KILL^DVBCUTIL
"RTN","DVBCCNCL",66,0)
 ;
"RTN","DVBCCNCL",67,0)
KILL K TCNCL,DIC,DA,D0,D1,DFN,X,Y,OLDEXAM,JDR,REQDT,DR,EXMNM,NCN,STAT,%,NOFND,CANC,^TMP($J),%Y,Z,JY,JZ,DA,DIC,DIE,ALLCANC
"RTN","DVBCCNCL",68,0)
 K DVBCARY,DVBCRDAT,DVBCSITE,EXAM,I,PNAM,REASON,REQRO,REQSTR,SSN
"RTN","DVBCCNCL",69,0)
 Q
"RTN","DVBCCNCL",70,0)
 ;
"RTN","DVBCCNCL",71,0)
CNCLCHK S NOFND=0,Z=$P(^DVB(396.3,DA(1),0),U,18) Q:Z=6!(Z=7)  K Z S I="" F J=0:0 S I=$O(^TMP($J,I)) Q:I=""  I $P(^TMP($J,I),U,1)'="X"&($P(^(I),U,1)'="RX") S NOFND=1
"RTN","DVBCCNCL",72,0)
 Q:NOFND=1  W *7,!!,"Since all exams have been cancelled",!,"the entire request will be CANCELLED.",!! H 3
"RTN","DVBCCNCL",73,0)
 S DVBCMSG=" for this request:" D CODE
"RTN","DVBCCNCL",74,0)
 S DR="17///"_CCODE_";19///NOW;20////^S X=DUZ"
"RTN","DVBCCNCL",75,0)
 S DA=DA(1),DIE="^DVB(396.3," D ^DIE S DA=DA(1) D NOTIFY^DVBCCNC1
"RTN","DVBCCNCL",76,0)
 Q
"RTN","DVBCCNCL",77,0)
 ;
"RTN","DVBCCNCL",78,0)
STATCHK ;Check status
"RTN","DVBCCNCL",79,0)
 ;AJF; Request Status Conversion
"RTN","DVBCCNCL",80,0)
 N STIEN,STNM
"RTN","DVBCCNCL",81,0)
 I +STAT S STAT=$$RSTAT^DVBCUTL8(STAT)
"RTN","DVBCCNCL",82,0)
 Q:STAT="P"!(STAT="N")!(STAT="NT")!(STAT="S")!(STAT="O")
"RTN","DVBCCNCL",83,0)
 S STIEN=$O(^DVB(396.33,"C",STAT,"")),STNM=$$RTSTAT^DVBCUTL8(STIEN)
"RTN","DVBCCNCL",84,0)
 W !!,*7,"This request has a status of ",STNM," and can't be cancelled.",!!
"RTN","DVBCCNCL",85,0)
 S NCN=1 H 2 Q
"RTN","DVBCCNCL",86,0)
 ;NCN=no can do
"RTN","DVBCCNCL",87,0)
 Q
"RTN","DVBCCNCL",88,0)
 ;
"RTN","DVBCCNCL",89,0)
CODE S:'$D(DVBCMSG) DVBCMSG=":" W @IOF,!,"Please enter cancellation code"_DVBCMSG,! K OUT,%
"RTN","DVBCCNCL",90,0)
 S DIR("A")="CANCELLED BY"
"RTN","DVBCCNCL",91,0)
 S:'$D(EXMCNC) DIR(0)="SO^X:MAS CANCELLATION;RX:REGIONAL OFFICE CANCELLATION"
"RTN","DVBCCNCL",92,0)
 S:$D(EXMCNC) DIR(0)="S^X:MAS CANCELLATION;RX:REGIONAL OFFICE CANCELLATION"
"RTN","DVBCCNCL",93,0)
 D ^DIR S CCODE=Y
"RTN","DVBCCNCL",94,0)
 I CCODE=U&('$D(EXMCNC)) W !!,*7,"NO '^' ALLOWED AT THIS PROMPT" D CONTMES^DVBCUTL4 G CODE
"RTN","DVBCCNCL",95,0)
 I $D(DTOUT) D RQCODE^DVBCUTL2 S OUT=1 Q
"RTN","DVBCCNCL",96,0)
 I (X=""&('$D(EXMCNC))) W !,*7,"This is a required response." D CONTMES^DVBCUTL4 G CODE
"RTN","DVBCCNCL",97,0)
CNCBY W !!,*7,"CANCELLED BY ",$S(CCODE="X":"MAS",CCODE="RX":"RO",1:"???"),", OK" S %=2 D YN^DICN I %=2 G CODE
"RTN","DVBCCNCL",98,0)
 I %=-1&('$D(EXMCNC)&('$D(DTOUT))) W !!,*7,"NO '^' ALLOWED AT THIS PROMPT" D CONTMES^DVBCUTL4 G CNCBY
"RTN","DVBCCNCL",99,0)
 K EXMCNC
"RTN","DVBCCNCL",100,0)
 I $D(DTOUT) D BULL^DVBCCNC1 S OUT=1 Q
"RTN","DVBCCNCL",101,0)
 Q
"RTN","DVBCEDIT")
0^31^B19786261^B19337111
"RTN","DVBCEDIT",1,0)
DVBCEDIT ;ALB/GTS-557/THM-EDIT 2507 DATA ; 6/19/91  1:22 PM
"RTN","DVBCEDIT",2,0)
 ;;2.7;AMIE;**7,193**;Apr 10, 1995;Build 84
"RTN","DVBCEDIT",3,0)
 I $D(DUZ)#2=0 W *7,!!,"You have no user number.",!! Q
"RTN","DVBCEDIT",4,0)
 ;
"RTN","DVBCEDIT",5,0)
EN D HOME^%ZIS K OUT S FF=IOF,HD="Veteran Selection",HD2="2507 Exam Data Entry"
"RTN","DVBCEDIT",6,0)
 ;
"RTN","DVBCEDIT",7,0)
LOOK S %DT(0)=-DT D KILL W @FF,!?(80-$L(HD)\2),HD,!?(80-$L(HD2)\2),HD2,!!! S DIC("W")="D DICW^DVBCUTIL" S DIC="^DVB(396.3,",DIC(0)="AEQM",DIC("A")="Select VETERAN: " D ^DIC G:X=""!(X=U) EXIT I +Y<0 W "  ???" H 1 G LOOK
"RTN","DVBCEDIT",8,0)
 S STAT=$P(^DVB(396.3,+Y,0),U,18)
"RTN","DVBCEDIT",9,0)
 ;AJF; Request Status Conversion
"RTN","DVBCEDIT",10,0)
 S STAT=$$RSTAT^DVBCUTL8(STAT)
"RTN","DVBCEDIT",11,0)
 I STAT="N" W *7,!!,"This request has not been reported to MAS and may not be transcribed.",!! H 3 G LOOK
"RTN","DVBCEDIT",12,0)
 S (REQDA,DA(1))=+Y D STATCHK^DVBCUTL4 H:$D(NCN) 2 G:$D(NCN) LOOK
"RTN","DVBCEDIT",13,0)
 S DFN=$P(Y,U,2),REQDT=$P(^DVB(396.3,REQDA,0),U,2),PNAM=$S($D(^DPT(DFN,0)):$P(^(0),U,1),1:"Unknown"),SSN=$S($D(^(0)):$P(^(0),U,9),1:"Not specified")
"RTN","DVBCEDIT",14,0)
 S CNUM=$S($D(^DPT(DFN,.31)):$P(^(.31),U,3),1:"Unknown") K DICW
"RTN","DVBCEDIT",15,0)
 F DA=0:0 S DA=$O(^DVB(396.4,"C",REQDA,DA)) Q:DA=""  S EXAM=$P(^DVB(396.4,DA,0),U,3) S EXAM=$P(^DVB(396.6,EXAM,0),U,1),STAT=$P(^DVB(396.4,DA,0),U,4),^TMP($J,EXAM)=STAT_U_DA
"RTN","DVBCEDIT",16,0)
 ;
"RTN","DVBCEDIT",17,0)
DATA K NCN,QUE D HDR^DVBCUTIL
"RTN","DVBCEDIT",18,0)
 W !
"RTN","DVBCEDIT",19,0)
 S Y=$$EXSRH^DVBCUTL4("Select Exam: ","I $D(^DVB(396.4,""ARQ""_REQDA,+Y))")
"RTN","DVBCEDIT",20,0)
 G:$D(DTOUT) EXIT G:X=""!(X=U) LOOK
"RTN","DVBCEDIT",21,0)
 I +Y<0 W *7,"  ???" G DATA
"RTN","DVBCEDIT",22,0)
 S DVBCLCKD=$$XMLCK(+Y)
"RTN","DVBCEDIT",23,0)
 I +DVBCLCKD'=1 W !!,*7,"This exam is currently being edited.   <RETURN> to continue." R DVBCTST:DTIME K DVBCTST G DATA
"RTN","DVBCEDIT",24,0)
 S (EXMDA,DA)=+Y,EXMNM=$P(^DVB(396.4,+Y,0),U,3)
"RTN","DVBCEDIT",25,0)
 S EXMNM=$P(^DVB(396.6,EXMNM,0),U,1)
"RTN","DVBCEDIT",26,0)
 S STAT=$P(^TMP($J,EXMNM),U,1)
"RTN","DVBCEDIT",27,0)
 D STATCHK^DVBCUTL4
"RTN","DVBCEDIT",28,0)
 I STAT="C",$P(^DVB(396.4,EXMDA,0),U,10)]"" W !,*7,"These exam results have been electronically signed.",!,"No editing is allowed!" D CONTMES^DVBCUTL4 S DVBCLCKD=$$XMUNLCK(EXMDA) G DATA
"RTN","DVBCEDIT",29,0)
 W:STAT="C" "But you may make changes until it is released.",!! H:STAT="C" 2 I $D(NCN)&("^X^RX^"[STAT) S DVBCLCKD=$$XMUNLCK(EXMDA) G DATA
"RTN","DVBCEDIT",30,0)
 I STAT="T" W *7,!!,"This exam has been transferred to another facility.",!! H 2 S DVBCLCKD=$$XMUNLCK(EXMDA) G DATA
"RTN","DVBCEDIT",31,0)
 K DR S (DIC,DIE)="^DVB(396.4,",DR="W @FF;70;W @FF,!!;.06R;.07R"
"RTN","DVBCEDIT",32,0)
 S DA=EXMDA D ^DIE,COMP^DVBCUTL4
"RTN","DVBCEDIT",33,0)
 S DVBCLCKD=$$XMUNLCK(EXMDA)
"RTN","DVBCEDIT",34,0)
 G:$D(OUT) EXIT S STAT1=$P(^DVB(396.4,EXMDA,0),U,4),$P(^TMP($J,EXMNM),U,1)=STAT1
"RTN","DVBCEDIT",35,0)
 S NFINAL=0
"RTN","DVBCEDIT",36,0)
 F EXMDA=0:0 S EXMDA=$O(^DVB(396.4,"C",REQDA,EXMDA)) Q:EXMDA=""  S STAT=$P(^DVB(396.4,EXMDA,0),U,4) I STAT'="C"&(STAT'="X")&(STAT'="RX") S NFINAL=1
"RTN","DVBCEDIT",37,0)
 I NFINAL=0,$P(^DVB(396.3,REQDA,0),U,12)="" S XMB="DVBA C 2507 EXAM READY",XMB(1)=PNAM,XMB(2)=SSN,Y=REQDT X ^DD("DD") S XREQDT=Y,XMB(3)=XREQDT D ^XMB K XMB,XREQDT
"RTN","DVBCEDIT",38,0)
 ;
"RTN","DVBCEDIT",39,0)
 ;AJF;Request Status conversion
"RTN","DVBCEDIT",40,0)
QUE K IO("Q"),%DT S QUE="N" I NFINAL=0 K DR S DIE="^DVB(396.3,",DA=REQDA,DR="11///NOW;17////8" D ^DIE S %DT(0)=-DT
"RTN","DVBCEDIT",41,0)
 ;
"RTN","DVBCEDIT",42,0)
QUE1 K IO("Q") W !!,"Do you want to print a review copy" S %=2 D YN^DICN G:$D(DTOUT) EXIT I %=1 S QUE="Y"
"RTN","DVBCEDIT",43,0)
 I $D(%Y),%Y["?" W !!,"Enter Y to print a copy of the results for review",!,"or N to continue editing.",!! H 2 G QUE1
"RTN","DVBCEDIT",44,0)
 I QUE="Y" S (DA(1),DA)=REQDA W !! S %ZIS="AEQ" D ^%ZIS K %ZIS I POP S QUE="N" K IO("Q")
"RTN","DVBCEDIT",45,0)
 I '$D(IO("Q")),QUE="Y" S EDPRT=1 U IO D ZTSK^DVBCPRN1 K EDPRT,AUTO,ULINE,EXMNM,XEXMNM,PGHD,DVBCSITE
"RTN","DVBCEDIT",46,0)
 I $D(IO("Q")) S ZTRTN="ZTSK^DVBCPRN1",ZTIO=ION,ZTDESC="2507 Review Report",ZTDTH=$H F I="DVBC*","DUZ*","DA*","REQDA","EXMNM" S ZTSAVE(I)=""
"RTN","DVBCEDIT",47,0)
 I $D(IO("Q")) D ^%ZTLOAD I $D(ZTSK) W !!,"2507 Request queued for review to device "_ION,!! H 2 K ZTRTN,ZTIO,ZTSAVE,ZTDTH,ZTSK,IO("Q")
"RTN","DVBCEDIT",48,0)
 D ^%ZISC
"RTN","DVBCEDIT",49,0)
 I QUE="Y" G LOOK
"RTN","DVBCEDIT",50,0)
 G DATA
"RTN","DVBCEDIT",51,0)
 ;
"RTN","DVBCEDIT",52,0)
EXIT K DVBCLCKD D:$D(ZTQUEUED) KILL^%ZTLOAD K WPTYPE,%DT G KILL^DVBCUTIL
"RTN","DVBCEDIT",53,0)
 ;
"RTN","DVBCEDIT",54,0)
KILL K ^TMP($J),DIC,DA,D0,D1,DFN,X,Y,OLDEXAM,REQDT,DR,EXMNM,NCN,STAT,NOFND,NFINAL,QUE,%,%Y,%ZIS,IOP
"RTN","DVBCEDIT",55,0)
 Q
"RTN","DVBCEDIT",56,0)
 ;
"RTN","DVBCEDIT",57,0)
XMLCK(DA) ;  ** Lock the 396.4 exam record selected for transcription **
"RTN","DVBCEDIT",58,0)
 L +^DVB(396.4,+DA,0):1
"RTN","DVBCEDIT",59,0)
 Q $T
"RTN","DVBCEDIT",60,0)
 ;
"RTN","DVBCEDIT",61,0)
XMUNLCK(DA) ;  ** Unlock the 396.4 exam record selected for transcription **
"RTN","DVBCEDIT",62,0)
 L -^DVB(396.4,DA,0)
"RTN","DVBCEDIT",63,0)
 Q 0
"RTN","DVBCENQ1")
0^43^B24659456^B27237652
"RTN","DVBCENQ1",1,0)
DVBCENQ1 ;ALB/GTS,557/THM - 2507 INQUIRY DISPLAY ; 10/14/2009  1:00 PM
"RTN","DVBCENQ1",2,0)
 ;;2.7;AMIE;**17,57,143,149,193**;Apr 10, 1995;Build 84
"RTN","DVBCENQ1",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","DVBCENQ1",4,0)
 ;
"RTN","DVBCENQ1",5,0)
 G START
"RTN","DVBCENQ1",6,0)
CON K OUT I IOST?1"C-".E W !,"Press [RETURN] to continue or ""^"" to stop   " R ANS:DTIME S:ANS=U!('$T) OUT=1 Q:$D(OUT)  D HDR
"RTN","DVBCENQ1",7,0)
 I IOST?1"P-".E,$Y>45 W @IOF D HDR
"RTN","DVBCENQ1",8,0)
 Q
"RTN","DVBCENQ1",9,0)
 ;
"RTN","DVBCENQ1",10,0)
START S PGHD="COMPENSATION AND PENSION EXAM INQUIRY",PG=0
"RTN","DVBCENQ1",11,0)
 D HDR
"RTN","DVBCENQ1",12,0)
 W !?2,"Name: ",PNAM,?56,"SSN: ",SSN
"RTN","DVBCENQ1",13,0)
 W !?51,"C-Number: ",CNUM
"RTN","DVBCENQ1",14,0)
 W !?56,"DOB: " S Y=DOB X ^DD("DD") W Y
"RTN","DVBCENQ1",15,0)
 W !?4,"Address: ",ADR1
"RTN","DVBCENQ1",16,0)
 W ! W:ADR2]"" ?13,ADR2
"RTN","DVBCENQ1",17,0)
 W ! W:ADR3]"" ?13,ADR3
"RTN","DVBCENQ1",18,0)
 W !!?7,"City: ",CITY
"RTN","DVBCENQ1",19,0)
 I $$ISFORGN^DVBCUTIL(COUNTRY) D
"RTN","DVBCENQ1",20,0)
 . W !?3,"Province: ",PROVINCE,?48,"Res Phone: ",HOMPHON
"RTN","DVBCENQ1",21,0)
 . W !,"Postal Code: ",POSTALCD,?48,"Bus Phone: ",BUSPHON
"RTN","DVBCENQ1",22,0)
 E  D
"RTN","DVBCENQ1",23,0)
 . W !?6,"State: ",STATE,?48,"Res Phone: ",HOMPHON
"RTN","DVBCENQ1",24,0)
 . W !?6,"Zip+4: ",ZIP,?48,"Bus Phone: ",BUSPHON
"RTN","DVBCENQ1",25,0)
 I COUNTRY>0 D
"RTN","DVBCENQ1",26,0)
 . W !?4,"Country: ",$$GETCNTRY^DVBCUTIL(COUNTRY),!
"RTN","DVBCENQ1",27,0)
 E  D
"RTN","DVBCENQ1",28,0)
 . W !
"RTN","DVBCENQ1",29,0)
 W !,"Entered active service: " S Y=EOD X ^DD("DD") S:Y="" Y="Not specified" W Y,! S Y=RAD X ^DD("DD") S:Y="" Y="Not specified" W "Released active service: " W Y,!
"RTN","DVBCENQ1",30,0)
 F LINE=1:1:80 W "="
"RTN","DVBCENQ1",31,0)
 W !! D CON Q:$D(OUT)  D ^DVBCENQ2,CON Q:$D(OUT)  D ^DVBCEEXM,CON Q:$D(OUT)  S REQDT=$P(^DVB(396.3,REQDA,0),U,2)
"RTN","DVBCENQ1",32,0)
 W !,"This request was initiated on " S Y=REQDT X ^DD("DD") W $P(Y,"@",1)," at ",$P(Y,"@",2),!!?17,"Requester: ",REQN,!,"Requesting Regional Office: ",RONAME,!
"RTN","DVBCENQ1",33,0)
 W "VHA Division Processing Request: "_$P($$SITE^VASITE(,$P(^DVB(396.3,REQDA,1),U,4)),U,2),!
"RTN","DVBCENQ1",34,0)
 I $D(^DVB(396.4,"C",REQDA)) W !?3,"Exams on this request: " D TST^DVBCUTL2 W !
"RTN","DVBCENQ1",35,0)
 I '$D(^DVB(396.4,"C",REQDA)) W !?3,"(No exams have yet been entered)",!
"RTN","DVBCENQ1",36,0)
 W !,"** Status of request: "
"RTN","DVBCENQ1",37,0)
 S RST=$P(^DVB(396.3,REQDA,0),U,18)
"RTN","DVBCENQ1",38,0)
 ;AJF;Request Status conversion
"RTN","DVBCENQ1",39,0)
 S XSTAT=$$RSTAT^DVBCUTL8(RST)
"RTN","DVBCENQ1",40,0)
 S STAT=$$RTSTAT^DVBCUTL8(RST)
"RTN","DVBCENQ1",41,0)
 I STAT]"" W STAT
"RTN","DVBCENQ1",42,0)
 I XSTAT="R"!(XSTAT="C") W !!?9,"Released on " S Y=$P(^DVB(396.3,REQDA,0),U,14) X ^DD("DD") W Y," by " S RELBY=$P(^DVB(396.3,REQDA,0),U,15),RELBY=$S($D(^VA(200,+RELBY,0)):$P(^(0),U,1),1:"Unknown user") W RELBY,!
"RTN","DVBCENQ1",43,0)
 I XSTAT="C" W "Printed by the RO on " S Y=$P(^DVB(396.3,REQDA,0),U,16) X ^DD("DD") W Y," by " S PRBY=$P(^DVB(396.3,REQDA,0),U,17),PRBY=$S($D(^VA(200,+PRBY,0)):$P(^(0),U,1),1:"Unknown user") W PRBY,!
"RTN","DVBCENQ1",44,0)
 I STAT="" S STAT=$S(XSTAT="X":"Cancelled by MAS",XSTAT="RX":"Cancelled by RO",1:"Unknown") W STAT I STAT["Cancelled" W "  (Cancelled on " S CANDT=$P(^DVB(396.3,REQDA,0),U,19) W $$FMTE^XLFDT(CANDT,"5DZ"),")"
"RTN","DVBCENQ1",45,0)
 ;S X=$S($D(^DVB(396.3,REQDA,4)):$P(^(4),U,1),1:"") I X="y" W !,"Exam(s) transferred to another site -- see pending report.",!
"RTN","DVBCENQ1",46,0)
 I $D(^DVB(396.3,REQDA,1)),$P(^(1),U,3)="Y" W !,"This request was faxed to the regional office.",!
"RTN","DVBCENQ1",47,0)
 S FEXAM=$P(^DVB(396.3,REQDA,0),U,9) I FEXAM="Y" W !!,"*** Exams done on a FEE BASIS ***  ",! K FEXAM
"RTN","DVBCENQ1",48,0)
 W ! F LINE=1:1:79 W "-"
"RTN","DVBCENQ1",49,0)
 W ! D DDIS Q:$D(OUT)  D CON Q:$D(OUT)
"RTN","DVBCENQ1",50,0)
 I IOST?1"P-".E,$Y>45 W @IOF D HDR
"RTN","DVBCENQ1",51,0)
 W !!,"Other Disabilities:",!!?2,OTHDIS,! I $D(^DVB(396.3,REQDA,1)) W ?2,OTHDIS1,!?2,OTHDIS2
"RTN","DVBCENQ1",52,0)
 W !!,"General Remarks:",!!
"RTN","DVBCENQ1",53,0)
 K ^UTILITY($J,"W")
"RTN","DVBCENQ1",54,0)
 F LINE=0:0 S LINE=$O(^DVB(396.3,REQDA,2,LINE)) Q:LINE=""  S X=^(LINE,0),DIWL=5,DIWR=75,DIWF="NW" D ^DIWP I IOST?1"C-".E,$Y>19 D CON W !!,"General Remarks, continued",!!!
"RTN","DVBCENQ1",55,0)
 D ^DIWW
"RTN","DVBCENQ1",56,0)
END K ANS I IOST?1"C-".E W !!,"Press [RETURN] to continue or ""^"" to stop   " R ANS:DTIME S:'$T!(ANS=U) OUT=1 I $D(OUT) Q:OUT=1
"RTN","DVBCENQ1",57,0)
 Q
"RTN","DVBCENQ1",58,0)
 ;
"RTN","DVBCENQ1",59,0)
DDIS1 W ?2,DX,?37,$J(PCT,3,0)," %",?50,$S(SC=1:"Yes",1:"No"),?58,DXCOD,!
"RTN","DVBCENQ1",60,0)
 I $Y>19 D CON
"RTN","DVBCENQ1",61,0)
 Q
"RTN","DVBCENQ1",62,0)
 ;
"RTN","DVBCENQ1",63,0)
DDIS I $Y>12 D CON Q:$D(OUT)
"RTN","DVBCENQ1",64,0)
 I '$D(^DPT(DFN,.372)) W !?25,"No rated disabilities on file",!! Q
"RTN","DVBCENQ1",65,0)
 W !?2,"Rated Disability",?37,"Percent",?50,"SC ?",?58,"Dx Code",! W ?2 F LINE=1:1:63 W "-"
"RTN","DVBCENQ1",66,0)
 W !!
"RTN","DVBCENQ1",67,0)
 F JII=0:0 S JII=$O(^DPT(DFN,.372,JII)) Q:JII=""  S DXNUM=$P(^DPT(DFN,.372,JII,0),U,1),PCT=$P(^(0),U,2),SC=$P(^(0),U,3),DX=$S($D(^DIC(31,DXNUM)):$P(^(DXNUM,0),U,1),1:"Unknown"),DXCOD=$S($D(^DIC(31,DXNUM)):$P(^(DXNUM,0),U,3),1:"Unknown") D DDIS1
"RTN","DVBCENQ1",68,0)
 W !!
"RTN","DVBCENQ1",69,0)
 Q
"RTN","DVBCENQ1",70,0)
 ;
"RTN","DVBCENQ1",71,0)
HDR S PG=PG+1 W:(IOST?1"C-".E) @IOF
"RTN","DVBCENQ1",72,0)
 W !,"Date: ",FDT(0),?(80-$L(PGHD)\2),PGHD,?71,"Page: ",PG W !,?(80-$L($$SITE^DVBCUTL4)\2),$$SITE^DVBCUTL4 I PG>1 W !!,"Name: ",PNAM,?44,"SSN: ",SSN,?63,"C-NUM: ",CNUM
"RTN","DVBCENQ1",73,0)
 W ! F XLINE=1:1:80 W "="
"RTN","DVBCENQ1",74,0)
 W ! Q
"RTN","DVBCHLR")
0^12^B27140318^B27159874
"RTN","DVBCHLR",1,0)
DVBCHLR ;ALB/JLU-Processes the results from the ORU ;1/28/93
"RTN","DVBCHLR",2,0)
 ;;2.7;AMIE;**9,193**;Apr 10, 1995;Build 84
"RTN","DVBCHLR",3,0)
 ;
"RTN","DVBCHLR",4,0)
BEG D INIT
"RTN","DVBCHLR",5,0)
 F  D @$S(DVBCX="PID"&'$D(HLERR):"PID",DVBCX="OBR"&'$D(HLERR):"OBR",DVBCX="OBX"&'$D(HLERR):"OBX",1:"ACK") Q:DVBCX="QUIT"
"RTN","DVBCHLR",6,0)
 D EXIT
"RTN","DVBCHLR",7,0)
 Q
"RTN","DVBCHLR",8,0)
 ;
"RTN","DVBCHLR",9,0)
EXIT K %,DA,DFN,DIE,DR,DVBC,HLERR,DVBCNT2,DVBCOBR,DVBCOBX,DVBCOBXV,DVBCPAT,DVBCPDFN,DVBCPID,DVBCRPDT,DVBCSAV,DVBCSSN,DVBCUEX,DVBCUEXT,DVBCUNIV,DVBCURQ,DVBCX,DVBCX1,DVBX,VADM,VAERR,DVBCEXAM,DVBCST,DVBCELCT,DVBCUEX1
"RTN","DVBCHLR",10,0)
 Q
"RTN","DVBCHLR",11,0)
 ;
"RTN","DVBCHLR",12,0)
INIT ;initializes and checks variables
"RTN","DVBCHLR",13,0)
 S DVBCX="PID",DVBC=1
"RTN","DVBCHLR",14,0)
 I '$D(HLESIG) S HLERR="No Electronic Signature code present, updating cannot be allowed."
"RTN","DVBCHLR",15,0)
 I $S('$D(HLDUZ):1,HLDUZ']"":1,1:0) S HLERR="Not a valid DHCP user number."
"RTN","DVBCHLR",16,0)
 Q
"RTN","DVBCHLR",17,0)
 ;
"RTN","DVBCHLR",18,0)
PID ;Brake apart the PID section
"RTN","DVBCHLR",19,0)
 K HLERR,DVBCPID,DVBCSSN,DVBCPDFN,DVBCPAT,DFN,VAERR,VADM
"RTN","DVBCHLR",20,0)
 S DVBC=$O(^HL(772,HLDA,"IN",DVBC))
"RTN","DVBCHLR",21,0)
 I 'DVBC S HLERR="Missing PID Segment" Q
"RTN","DVBCHLR",22,0)
 S DVBCPID=^(DVBC,0) ;NAKE FROM ^HL(772,HLDA,IN  PID+2
"RTN","DVBCHLR",23,0)
 I $P(DVBCPID,HLFS,1)'="PID" S HLERR="Incorrect PID Segment indicator" Q
"RTN","DVBCHLR",24,0)
 I $P(DVBCPID,HLFS,4)']"" S HLERR="Internal Patient ID Missing" Q
"RTN","DVBCHLR",25,0)
 I $P(DVBCPID,HLFS,6)']"" S HLERR="Patient Name Invalid" Q
"RTN","DVBCHLR",26,0)
 I $P(DVBCPID,HLFS,20)']"" S HLERR="Patient SSN Invalid" Q
"RTN","DVBCHLR",27,0)
 S DVBCSSN=$P(DVBCPID,HLFS,20)
"RTN","DVBCHLR",28,0)
 S DVBCPDFN=+$P(DVBCPID,HLFS,4)
"RTN","DVBCHLR",29,0)
 S DVBCPAT=$$FMNAME^HLFNC($P(DVBCPID,HLFS,6))
"RTN","DVBCHLR",30,0)
 S DFN=DVBCPDFN
"RTN","DVBCHLR",31,0)
 D DEM^VADPT
"RTN","DVBCHLR",32,0)
 I VAERR S HLERR="Incorrect Patient Identifier" Q
"RTN","DVBCHLR",33,0)
 I DVBCSSN'=$P(VADM(2),U,1) S HLERR="Invalid SSN" Q
"RTN","DVBCHLR",34,0)
 S DVBCX="OBR"
"RTN","DVBCHLR",35,0)
 Q
"RTN","DVBCHLR",36,0)
 ;
"RTN","DVBCHLR",37,0)
OBR ;Parsing the OBR segment.
"RTN","DVBCHLR",38,0)
 K DVBCOBR,DVBCUNIV
"RTN","DVBCHLR",39,0)
 F  S DVBC=$O(^HL(772,HLDA,"IN",DVBC)) Q:DVBC=""  S DVBCOBR=^(DVBC,0) Q:$P(DVBCOBR,HLFS,1)="OBR"
"RTN","DVBCHLR",40,0)
 I DVBC="" S HLERR="Missing OBR Segment" Q
"RTN","DVBCHLR",41,0)
 I $P(DVBCOBR,HLFS,5)']"" S HLERR="Missing Universal Identifier" Q
"RTN","DVBCHLR",42,0)
 I $P(DVBCOBR,HLFS,21)']"" S HLERR="Missing Exam Type" Q
"RTN","DVBCHLR",43,0)
 I $P(DVBCOBR,HLFS,23)']"" S HLERR="Missing Report Date" Q
"RTN","DVBCHLR",44,0)
 S DVBCUNIV=$P(DVBCOBR,HLFS,5)
"RTN","DVBCHLR",45,0)
 S DVBCUEXT=$P(DVBCOBR,HLFS,21)
"RTN","DVBCHLR",46,0)
 S DVBCRPDT=$$FMDATE^HLFNC($P(DVBCOBR,HLFS,23))
"RTN","DVBCHLR",47,0)
 S DVBCURQ=$P(DVBCUNIV,$E(HLECH),1)
"RTN","DVBCHLR",48,0)
 S DVBCUEX=$P(DVBCUNIV,$E(HLECH),2)
"RTN","DVBCHLR",49,0)
 I '$D(^DVB(396.3,DVBCURQ,0)) S HLERR="Request No longer Exists" Q
"RTN","DVBCHLR",50,0)
 I "PS"'[$P(^(0),U,18) S HLERR="Status of Request will not allow for down loading" Q  ;NAKED FROM LINE BEFORE
"RTN","DVBCHLR",51,0)
 I '$D(^DVB(396.4,DVBCUEX,0)) S HLERR="Exam No longer Exists" Q
"RTN","DVBCHLR",52,0)
 S DVBCUEX1=^DVB(396.4,DVBCUEX,0)
"RTN","DVBCHLR",53,0)
 I "RXT"[$P(DVBCUEX1,U,4) S HLERR="Exam status not open, no down loading allow* ed" Q
"RTN","DVBCHLR",54,0)
 D HASH^DVBCHLUT
"RTN","DVBCHLR",55,0)
 I '$D(DVBCELCT) S HLERR="Bad electronic signature code." Q
"RTN","DVBCHLR",56,0)
 I $P(DVBCUEX1,U,4)="C",$P(DVBCUEX1,U,10)'=DVBCELCT S HLERR="Electronic signature codes do not match, no down loading allowed" Q
"RTN","DVBCHLR",57,0)
 S DVBCX="OBX"
"RTN","DVBCHLR",58,0)
 Q
"RTN","DVBCHLR",59,0)
 ;
"RTN","DVBCHLR",60,0)
OBX ;looping through the OBX segment
"RTN","DVBCHLR",61,0)
 K DVBCSAV
"RTN","DVBCHLR",62,0)
 S DVBCNT2=0,DVBCSAV=DVBC
"RTN","DVBCHLR",63,0)
 I '$$LOCK^DVBCHLUT(DVBCURQ,DVBCUEX) Q
"RTN","DVBCHLR",64,0)
 D DEL
"RTN","DVBCHLR",65,0)
 F  S DVBC=$O(^HL(772,HLDA,"IN",DVBC)) S:DVBC="" DVBCX="ACK" Q:DVBC=""  S DVBCOBX=^(DVBC,0) D OBX1 Q:DVBCX'="OBX"  S DVBCSAV=DVBC
"RTN","DVBCHLR",66,0)
 S DVBC=DVBCSAV
"RTN","DVBCHLR",67,0)
 I 'DVBCNT2 S HLERR="Invalid OBX Segment" D UNLOCK^DVBCHLUT(DVBCURQ,DVBCUEX) Q
"RTN","DVBCHLR",68,0)
 I DVBCNT2 D CLOSE
"RTN","DVBCHLR",69,0)
 D UNLOCK^DVBCHLUT(DVBCURQ,DVBCUEX)
"RTN","DVBCHLR",70,0)
 Q
"RTN","DVBCHLR",71,0)
 ;
"RTN","DVBCHLR",72,0)
OBX1 ;
"RTN","DVBCHLR",73,0)
 S DVBCOBXV=$P(DVBCOBX,HLFS,1)
"RTN","DVBCHLR",74,0)
 I DVBCOBXV="NTE" Q
"RTN","DVBCHLR",75,0)
 I $S(DVBCOBXV="PID":1,DVBCOBXV="OBR":1,1:0) S DVBCX=DVBCOBXV Q
"RTN","DVBCHLR",76,0)
 I DVBCOBXV'="OBX" S DVBCX="ACK" Q
"RTN","DVBCHLR",77,0)
 S DVBCNT2=DVBCNT2+1
"RTN","DVBCHLR",78,0)
 S ^DVB(396.4,DVBCUEX,"RES",DVBCNT2,0)=$P(DVBCOBX,HLFS,6)
"RTN","DVBCHLR",79,0)
 Q
"RTN","DVBCHLR",80,0)
 ;
"RTN","DVBCHLR",81,0)
CLOSE ;sets exam fields and quits
"RTN","DVBCHLR",82,0)
 D NOW^%DTC
"RTN","DVBCHLR",83,0)
 S ^DVB(396.4,DVBCUEX,"RES",0)="^^"_DVBCNT2_"^"_DVBCNT2_"^"_%
"RTN","DVBCHLR",84,0)
 S DIE="^DVB(396.4,",DA=DVBCUEX
"RTN","DVBCHLR",85,0)
 S DR=".04///C;.06///^S X=DVBCRPDT;.07///^S X=$P(^VA(200,HLDUZ,0),U,1);.1///^S X=DVBCELCT"
"RTN","DVBCHLR",86,0)
 D ^DIE
"RTN","DVBCHLR",87,0)
 S DVBCEXAM=^DVB(396.4,DVBCUEX,0)
"RTN","DVBCHLR",88,0)
 I $P(DVBCEXAM,U,4)'="C"!($P(DVBCEXAM,U,6)']"")!$P(DVBCEXAM,U,7)']"" S HLERR="Results added but request and exam status not updated." Q
"RTN","DVBCHLR",89,0)
 D COMPL
"RTN","DVBCHLR",90,0)
 Q
"RTN","DVBCHLR",91,0)
 ;
"RTN","DVBCHLR",92,0)
ACK ;setting up the acknowledgment segment.
"RTN","DVBCHLR",93,0)
 I $D(HLERR) S DVBCX1=HLSDATA(1) K HLSDATA S HLSDATA(1)=DVBCX1
"RTN","DVBCHLR",94,0)
 S HLSDATA(2)="MSA"_HLFS_$S($D(HLERR):"AE",1:"AA")_HLFS_HLMID_HLFS_$S($D(HLERR):HLERR,1:"")
"RTN","DVBCHLR",95,0)
 S DVBCX="QUIT"
"RTN","DVBCHLR",96,0)
 I $D(HLTRANS) D EN1^HLTRANS
"RTN","DVBCHLR",97,0)
 Q
"RTN","DVBCHLR",98,0)
 ;
"RTN","DVBCHLR",99,0)
COMPL ;This subroutine will search the other exams and set the request's
"RTN","DVBCHLR",100,0)
 ;status to transcribed if able.
"RTN","DVBCHLR",101,0)
 ;This should become a callable subroutine because ^dvbcedit does the same
"RTN","DVBCHLR",102,0)
 ;
"RTN","DVBCHLR",103,0)
 K DVBCOPN
"RTN","DVBCHLR",104,0)
 F DVBC=0:0 S DVBC=$O(^DVB(396.4,"C",DVBCURQ,DVBC)) Q:'DVBC  S DVBCST=$P(^DVB(396.4,DVBC,0),U,4) I DVBCST="O"!(DVBCST="T") S DVBCOPN=1 Q
"RTN","DVBCHLR",105,0)
 Q:$D(DVBCOPN)
"RTN","DVBCHLR",106,0)
 S XMDUZ="Kurzweil"
"RTN","DVBCHLR",107,0)
 S XMB="DVBA C 2507 EXAM READY"
"RTN","DVBCHLR",108,0)
 S XMB(1)=DVBCPAT,XMB(2)=DVBCSSN
"RTN","DVBCHLR",109,0)
 S Y=$P(^DVB(396.3,DVBCURQ,0),U,2)
"RTN","DVBCHLR",110,0)
 X ^DD("DD")
"RTN","DVBCHLR",111,0)
 S XMB(3)=Y
"RTN","DVBCHLR",112,0)
 D ^XMB
"RTN","DVBCHLR",113,0)
 K XMDUZ,XMB,Y
"RTN","DVBCHLR",114,0)
 S DIE="^DVB(396.3,",DA=DVBCURQ
"RTN","DVBCHLR",115,0)
 ;AJF;Request Status Conversion
"RTN","DVBCHLR",116,0)
 S DR="11///NOW;17////8"
"RTN","DVBCHLR",117,0)
 D ^DIE
"RTN","DVBCHLR",118,0)
 I $P(^DVB(396.3,DVBCURQ,0),U,12)']""!($P(^(0),U,18)'=8) S HLERR="Results added and exam status updated but request status not updated."
"RTN","DVBCHLR",119,0)
 Q
"RTN","DVBCHLR",120,0)
 ;
"RTN","DVBCHLR",121,0)
DEL ;to delete the results from an exam if it is being resent.
"RTN","DVBCHLR",122,0)
 I $P(DVBCUEX1,U,10)]"" K ^DVB(396.4,DVBCUEX,"RES")
"RTN","DVBCHLR",123,0)
 Q
"RTN","DVBCHS0")
0^11^B8414277^B7806176
"RTN","DVBCHS0",1,0)
DVBCHS0 ;ALB/JRP - C & P EXTRACT FOR HEALTH SUMMARY;11-JAN-95
"RTN","DVBCHS0",2,0)
 ;;2.7;AMIE;**193**;Apr 10, 1995;Build 84
"RTN","DVBCHS0",3,0)
HSCP(PATPTR,INVBEGDT,INVENDDT,OUTCODE,ARRAY) ;MAIN ENTRY POINT
"RTN","DVBCHS0",4,0)
 ;INPUT  : PATPTR - Pointer to PATIENT file (#2)
"RTN","DVBCHS0",5,0)
 ;         INVBEGDT - Beginning date in inverse FileMan format
"RTN","DVBCHS0",6,0)
 ;                  - Defaults to one year before today
"RTN","DVBCHS0",7,0)
 ;         INVENDDT - Ending date in inverse FileMan format
"RTN","DVBCHS0",8,0)
 ;                  - Defaults to today
"RTN","DVBCHS0",9,0)
 ;         OUTCODE - Flag indicating which optional nodes to return
"RTN","DVBCHS0",10,0)
 ;                 0 = Do not return any optional nodes
"RTN","DVBCHS0",11,0)
 ;                 1 = Node 1 should also be returned
"RTN","DVBCHS0",12,0)
 ;                 2 = Node 2 should also be returned
"RTN","DVBCHS0",13,0)
 ;                 3 = Nodes 1 & 2 should also be returned (default)
"RTN","DVBCHS0",14,0)
 ;         ARRAY - Where to store output (full global reference)
"RTN","DVBCHS0",15,0)
 ;               - Defaults to ^TMP("DVBC",$J)
"RTN","DVBCHS0",16,0)
 ;
"RTN","DVBCHS0",17,0)
 ;OUTPUT : None
"RTN","DVBCHS0",18,0)
 ;      ARRAY(InvExDt,Type,0) = Code ^ DATE OF EXAM [.06]
"RTN","DVBCHS0",19,0)
 ;            ^ EXAM TYPE [.03] ^ EXAMINING PHYSICIAN [.07]
"RTN","DVBCHS0",20,0)
 ;            ^ PRIORITY OF EXAM [396.3;9]
"RTN","DVBCHS0",21,0)
 ; -->  ARRAY(InvExDt,Type,1) = ROUTING LOCATION [396.3;24]
"RTN","DVBCHS0",22,0)
 ;            ^ OWNER DOMAIN [396.3;28] ^ TRANSFERRED OUT TO [62]
"RTN","DVBCHS0",23,0)
 ; -->  ARRAY(InvExDt,Type,2) = REQUEST STATUS [396.3;17]
"RTN","DVBCHS0",24,0)
 ;            ^ APPROVED BY [396.3;25] ^ APPROVAL DATE/TIME [396.3;26]
"RTN","DVBCHS0",25,0)
 ;      ARRAY(InvExDt,Type,"RES",0) = Number of lines in EXAM RESULTS
"RTN","DVBCHS0",26,0)
 ;      ARRAY(InvExDt,Type,"RES",X) = Line X of EXAM RESULTS [70]
"RTN","DVBCHS0",27,0)
 ;
"RTN","DVBCHS0",28,0)
 ;   Subscripts:
"RTN","DVBCHS0",29,0)
 ;     InvExDt - Inverse FileMan date of DATE OF EXAM [.06]
"RTN","DVBCHS0",30,0)
 ;     Type - Poiner value of EXAM TYPE [.03]
"RTN","DVBCHS0",31,0)
 ;
"RTN","DVBCHS0",32,0)
 ;   Code used as follows:
"RTN","DVBCHS0",33,0)
 ;     1 = Exam was performed locally
"RTN","DVBCHS0",34,0)
 ;     2 = Exam was performed by another facility
"RTN","DVBCHS0",35,0)
 ;     3 = Exam was performed locally for another facility
"RTN","DVBCHS0",36,0)
 ;
"RTN","DVBCHS0",37,0)
 ;   All dates will be in the FileMan format
"RTN","DVBCHS0",38,0)
 ;
"RTN","DVBCHS0",39,0)
 ;   With the exception of dates, 'N/A' (not applicable) and 'UNKNOWN'
"RTN","DVBCHS0",40,0)
 ;   will be used for field values when appropriate
"RTN","DVBCHS0",41,0)
 ;
"RTN","DVBCHS0",42,0)
 ;   Optional nodes are marked by an arrow (-->)
"RTN","DVBCHS0",43,0)
 ;
"RTN","DVBCHS0",44,0)
 ;NOTES  : Output array will be initialized (KILLed)
"RTN","DVBCHS0",45,0)
 ;       : Information for an exam is only returned when
"RTN","DVBCHS0",46,0)
 ;           1. The exam status is COMPLETED
"RTN","DVBCHS0",47,0)
 ;           2. The status of the request containing the exam is
"RTN","DVBCHS0",48,0)
 ;              a) RELEASED TO RO, NOT PRINTED
"RTN","DVBCHS0",49,0)
 ;              b) COMPLETED, PRINTED BY RO
"RTN","DVBCHS0",50,0)
 ;              c) COMPLETED, TRANSFERRED OUT
"RTN","DVBCHS0",51,0)
 ;
"RTN","DVBCHS0",52,0)
 ;
"RTN","DVBCHS0",53,0)
 ;CHECK INPUT/SET DEFAULTS
"RTN","DVBCHS0",54,0)
 Q:('$D(^DPT((+$G(PATPTR)),0)))
"RTN","DVBCHS0",55,0)
 S INVBEGDT=+$G(INVBEGDT)
"RTN","DVBCHS0",56,0)
 S:('INVBEGDT) INVBEGDT=9999999-(DT-10000)
"RTN","DVBCHS0",57,0)
 S INVENDDT=+$G(INVENDDT)
"RTN","DVBCHS0",58,0)
 S:('INVENDDT) INVENDDT=9999999-DT
"RTN","DVBCHS0",59,0)
 S OUTCODE=$G(OUTCODE)
"RTN","DVBCHS0",60,0)
 S:((OUTCODE="")!(OUTCODE>3)!(OUTCODE<0)) OUTCODE=3
"RTN","DVBCHS0",61,0)
 S:($G(ARRAY)="") ARRAY="^TMP(""DVBC"",$J)"
"RTN","DVBCHS0",62,0)
 ;KILL OUTPUT ARRAY
"RTN","DVBCHS0",63,0)
 K @ARRAY
"RTN","DVBCHS0",64,0)
 ;DECLARE VARIABLES
"RTN","DVBCHS0",65,0)
 N BEGDATE,ENDDATE,TYPEPTR,EXAMPTR,TMP,NODE0
"RTN","DVBCHS0",66,0)
 ;CONVERT INVERSE DATES TO NORMAL DATES
"RTN","DVBCHS0",67,0)
 S BEGDATE=9999999-INVBEGDT
"RTN","DVBCHS0",68,0)
 S ENDDATE=9999999-INVENDDT
"RTN","DVBCHS0",69,0)
 ;NO EXAMS ON FILE
"RTN","DVBCHS0",70,0)
 Q:('$D(^DVB(396.4,"APS",PATPTR)))
"RTN","DVBCHS0",71,0)
 ;LOOK FOR COMPLETED EXAMS
"RTN","DVBCHS0",72,0)
 S TYPEPTR=0
"RTN","DVBCHS0",73,0)
 F  S TYPEPTR=+$O(^DVB(396.4,"APS",PATPTR,TYPEPTR)) Q:('TYPEPTR)  D
"RTN","DVBCHS0",74,0)
 .S EXAMPTR=0
"RTN","DVBCHS0",75,0)
 .F  S EXAMPTR=+$O(^DVB(396.4,"APS",PATPTR,TYPEPTR,"C",EXAMPTR)) Q:('EXAMPTR)  D
"RTN","DVBCHS0",76,0)
 ..;GET ZERO NODE OF EXAM
"RTN","DVBCHS0",77,0)
 ..S NODE0=$G(^DVB(396.4,EXAMPTR,0))
"RTN","DVBCHS0",78,0)
 ..;MAKE SURE EXAM IS WITHIN DATE RANGE
"RTN","DVBCHS0",79,0)
 ..S TMP=+$P(NODE0,"^",6)
"RTN","DVBCHS0",80,0)
 ..Q:(('TMP)!(TMP<BEGDATE)!(TMP>ENDDATE))
"RTN","DVBCHS0",81,0)
 ..;MAKE SURE REQUEST CONTAINING EXAM HAS BEEN RELEASED
"RTN","DVBCHS0",82,0)
 ..S TMP=+$P(NODE0,"^",2)
"RTN","DVBCHS0",83,0)
 ..Q:('TMP)
"RTN","DVBCHS0",84,0)
 ..S TMP=$P($G(^DVB(396.3,TMP,0)),"^",18)
"RTN","DVBCHS0",85,0)
 ..;AJF ; 2507 Request Status Conversion
"RTN","DVBCHS0",86,0)
 ..S TMP=$$RSTAT^DVBCUTL8(TMP)
"RTN","DVBCHS0",87,0)
 ..Q:((TMP'="C")&(TMP'="R")&(TMP'="CT"))
"RTN","DVBCHS0",88,0)
 ..;SET NODE ZERO OF OUTPUT
"RTN","DVBCHS0",89,0)
 ..D OUT0^DVBCHS1(EXAMPTR,ARRAY)
"RTN","DVBCHS0",90,0)
 ..;SET NODE 'RES' OF OUTPUT
"RTN","DVBCHS0",91,0)
 ..D OUTRES^DVBCHS1(EXAMPTR,ARRAY)
"RTN","DVBCHS0",92,0)
 ..Q:('OUTCODE)
"RTN","DVBCHS0",93,0)
 ..;SET NODE ONE OF OUTPUT (OPTIONAL)
"RTN","DVBCHS0",94,0)
 ..D:((OUTCODE=1)!(OUTCODE=3)) OUT1^DVBCHS2(EXAMPTR,ARRAY)
"RTN","DVBCHS0",95,0)
 ..;SET NODE TWO OF OUTPUT (OPTIONAL)
"RTN","DVBCHS0",96,0)
 ..D:((OUTCODE=2)!(OUTCODE=3)) OUT2^DVBCHS2(EXAMPTR,ARRAY)
"RTN","DVBCHS0",97,0)
 Q
"RTN","DVBCIRP2")
0^44^B81927737^B81228394
"RTN","DVBCIRP2",1,0)
DVBCIRP2 ;ALB/RTW - CAPRI INSUFFICIENT 2507 RPT -CONT 1 ; 07/17/2015  4:24 AM
"RTN","DVBCIRP2",2,0)
 ;;2.7;AMIE;**192,193**;Apr 10, 1995;Build 84
"RTN","DVBCIRP2",3,0)
 ;Copied DVBCIRP1 and to remove all Priority of exam filter code for CAPRI only
"RTN","DVBCIRP2",4,0)
 ;CAPRI Insufficient Exam Report no longer uses priority of exam filters
"RTN","DVBCIRP2",5,0)
 ;no longer uses insufficient reason filters
"RTN","DVBCIRP2",6,0)
 ;** Version Changes
"RTN","DVBCIRP2",7,0)
 ;   2.7 - New routine (Enhc 1)
"RTN","DVBCIRP2",8,0)
 ;
"RTN","DVBCIRP2",9,0)
SUMRPT ;**Output the summary report
"RTN","DVBCIRP2",10,0)
 W:IOST?1"C-".E @IOF
"RTN","DVBCIRP2",11,0)
 D SUMHD
"RTN","DVBCIRP2",12,0)
 ;print request data
"RTN","DVBCIRP2",13,0)
 W !?3,"Total 2507 requests received for date range:",?71,$J(DVBARQCT,5)
"RTN","DVBCIRP2",14,0)
 W !?3,"Total insufficient 2507 requests received for date range:",?71,$J(DVBAINRQ,5)
"RTN","DVBCIRP2",15,0)
 W !?3,"Total insufficient 2507 requests cancelled by RO for date range:",?71,$J(DVBACAN("REQ"),5)
"RTN","DVBCIRP2",16,0)
 I DVBARQCT>0 D
"RTN","DVBCIRP2",17,0)
 .S PERCENT=(DVBAINRQ/DVBARQCT)*100
"RTN","DVBCIRP2",18,0)
 .W !?3,"% of insufficient requests per total requests received:",?71,$J(PERCENT,5,1)_"%"
"RTN","DVBCIRP2",19,0)
 .S PERCENT=((DVBAINRQ-DVBACAN("REQ"))/DVBARQCT)*100
"RTN","DVBCIRP2",20,0)
 .W !?3,"% of uncancelled insufficient requests per total requests received:",?71,$J(PERCENT,5,1)_"%"
"RTN","DVBCIRP2",21,0)
 I DVBARQCT'>0 D
"RTN","DVBCIRP2",22,0)
 .S PERCENT=0
"RTN","DVBCIRP2",23,0)
 .W !?3,"% of insufficient requests per total requests received:",?71,$J(PERCENT,5,1)_"%"
"RTN","DVBCIRP2",24,0)
 .W !?3,"% of uncancelled insufficient requests per total requests received:",?71,$J(PERCENT,5,1)_"%"
"RTN","DVBCIRP2",25,0)
 ;print exam data
"RTN","DVBCIRP2",26,0)
 W !!?3,"Total 2507 exams received for date range:",?71,$J(DVBAXMCT,5)
"RTN","DVBCIRP2",27,0)
 W !?3,"Total insufficient 2507 exams received for date range:",?71,$J(DVBAINXM,5)
"RTN","DVBCIRP2",28,0)
 W !?3,"Total insufficient 2507 exams cancelled by RO for date range:",?71,$J(DVBACAN("EXM"),5)
"RTN","DVBCIRP2",29,0)
 I DVBAXMCT>0 D
"RTN","DVBCIRP2",30,0)
 .S PERCENT=(DVBAINXM/DVBAXMCT)*100
"RTN","DVBCIRP2",31,0)
 .W !?3,"% of insufficient exams per total exams received:",?71,$J(PERCENT,5,1)_"%"
"RTN","DVBCIRP2",32,0)
 .S PERCENT=((DVBAINXM-DVBACAN("EXM"))/DVBAXMCT)*100
"RTN","DVBCIRP2",33,0)
 .W !?3,"% of uncancelled insufficient exams per total exams received:",?71,$J(PERCENT,5,1)_"%"
"RTN","DVBCIRP2",34,0)
 I DVBAXMCT'>0 D
"RTN","DVBCIRP2",35,0)
 .S PERCENT=0
"RTN","DVBCIRP2",36,0)
 .W !?3,"% of insufficient exams per total exams received:",?71,$J(PERCENT,5,1)_"%"
"RTN","DVBCIRP2",37,0)
 .W !?3,"% of uncancelled insufficient exams per total exams received:",?71,$J(PERCENT,5,1)_"%"
"RTN","DVBCIRP2",38,0)
 ;print insufficient reason data
"RTN","DVBCIRP2",39,0)
 I IOST?1"C-".E DO
"RTN","DVBCIRP2",40,0)
 .K DTOUT,DUOUT
"RTN","DVBCIRP2",41,0)
 .W !!
"RTN","DVBCIRP2",42,0)
 .D PAUSE^DVBCUTL4
"RTN","DVBCIRP2",43,0)
 .I '$D(DTOUT),('$D(DUOUT)) DO
"RTN","DVBCIRP2",44,0)
 ..W @IOF
"RTN","DVBCIRP2",45,0)
 ..D SUMHD
"RTN","DVBCIRP2",46,0)
 I '$D(DTOUT),('$D(DUOUT)) DO
"RTN","DVBCIRP2",47,0)
 .W:IOST'?1"C-".E !!
"RTN","DVBCIRP2",48,0)
 .W !?15,"Summary of insufficient exams per Reason",!
"RTN","DVBCIRP2",49,0)
 .W !?3,"Reason",?53,"Num",?59,"Percent"
"RTN","DVBCIRP2",50,0)
 .N DVBARSLP S DVBARSLP=""
"RTN","DVBCIRP2",51,0)
 .F  S DVBARSLP=$O(DVBAINXM(DVBARSLP)) Q:DVBARSLP=""  DO  ;**Reason tot's
"RTN","DVBCIRP2",52,0)
 ..W:+DVBARSLP>0 !?3,$P(^DVB(396.94,DVBARSLP,0),U,3),?53,DVBAINXM(DVBARSLP)
"RTN","DVBCIRP2",53,0)
 ..I +DVBARSLP'>0,(+DVBAINXM(DVBARSLP)>0) W !?3,"Exams without insufficient reason indicated",?53,DVBAINXM(DVBARSLP)
"RTN","DVBCIRP2",54,0)
 ..W:(+DVBAINXM(DVBARSLP)>0&(DVBAINXM>0)) ?59,($P(((DVBAINXM(DVBARSLP)/DVBAINXM)*100),".",1))_$S($E($P(((DVBAINXM(DVBARSLP)/DVBAINXM)*100),".",2),1,1)'="":"."_$E($P(((DVBAINXM(DVBARSLP)/DVBAINXM)*100),".",2),1,1),1:"")_" %"
"RTN","DVBCIRP2",55,0)
 .I IOST?1"C-".E DO
"RTN","DVBCIRP2",56,0)
 ..D CONTMES^DVBCUTL4
"RTN","DVBCIRP2",57,0)
 Q
"RTN","DVBCIRP2",58,0)
 ;
"RTN","DVBCIRP2",59,0)
SUMHD ;** Output Summary Report heading
"RTN","DVBCIRP2",60,0)
 N STRTDT,LSTDT,DVBATXT,DVBASL
"RTN","DVBCIRP2",61,0)
 W !?15,"Summary Insufficient Exam Report for ",$$SITE^DVBCUTL4(),!
"RTN","DVBCIRP2",62,0)
 S Y=$P(BEGDT,".",1) X ^DD("DD") S STRTDT=Y K Y
"RTN","DVBCIRP2",63,0)
 S Y=$P(ENDDT,".",1) X ^DD("DD") S LSTDT=Y K Y
"RTN","DVBCIRP2",64,0)
 S DVBASL=$L($$SITE^DVBCUTL4)
"RTN","DVBCIRP2",65,0)
 ;S DVBATXT=$$PRHD^DVBCIUTL(DVBAPRTY)
"RTN","DVBCIRP2",66,0)
 S DVBATXT=""
"RTN","DVBCIRP2",67,0)
 W ?(((67+DVBASL)-$L(DVBATXT))\2)
"RTN","DVBCIRP2",68,0)
 W !?16,"For Date Range: "_STRTDT_" to "_LSTDT,!
"RTN","DVBCIRP2",69,0)
 Q
"RTN","DVBCIRP2",70,0)
 ;
"RTN","DVBCIRP2",71,0)
DETAIL ;** Output reason, exam type and exam info
"RTN","DVBCIRP2",72,0)
 ;RSDA is the reason ien
"RTN","DVBCIRP2",73,0)
 ;TPDA is the exam type ien
"RTN","DVBCIRP2",74,0)
 ;XMDA is the exam ien from 396.4
"RTN","DVBCIRP2",75,0)
 ;DVBARQST is the request ien from 396.3
"RTN","DVBCIRP2",76,0)
 N STRTDT,LSTDT,DVBARQST,DVBAEXMP,DVBAP,DVBAPREXM,MSGCNT
"RTN","DVBCIRP2",77,0)
 S MSGCNT=0
"RTN","DVBCIRP2",78,0)
 K ^TMP("DVBAEXAMS",$J),^TMP("INSUFF",$J)
"RTN","DVBCIRP2",79,0)
 S X=$P(BEGDT,".",1),STRTDT=$$FMTE^XLFDT(X,"5DZ")
"RTN","DVBCIRP2",80,0)
 S Y=$P(ENDDT,".",1),LSTDT=$$FMTE^XLFDT(Y,"5DZ")
"RTN","DVBCIRP2",81,0)
 U IO
"RTN","DVBCIRP2",82,0)
 S DVBADTLP=BEGDT
"RTN","DVBCIRP2",83,0)
 S DVBAENDL=ENDDT
"RTN","DVBCIRP2",84,0)
 S RSDA=""
"RTN","DVBCIRP2",85,0)
 S DVBAPG1=""
"RTN","DVBCIRP2",86,0)
 F  S RSDA=$O(DVBAARY("REASON",RSDA)) Q:(RSDA=""!($D(GETOUT)))  DO
"RTN","DVBCIRP2",87,0)
 .K DVBARSPT
"RTN","DVBCIRP2",88,0)
 .S TPDA=""
"RTN","DVBCIRP2",89,0)
 .F  S TPDA=$O(^TMP($J,"XMTYPE",TPDA)) Q:(TPDA=""!($D(GETOUT)))  DO
"RTN","DVBCIRP2",90,0)
 ..K DVBAXMPT
"RTN","DVBCIRP2",91,0)
 ..S XMDA=""
"RTN","DVBCIRP2",92,0)
 ..F  S XMDA=$O(^DVB(396.4,"AIT",RSDA,TPDA,XMDA)) Q:(XMDA=""!($D(GETOUT)))  DO
"RTN","DVBCIRP2",93,0)
 ...S DVBARQST=$G(^DVB(396.3,$P(^DVB(396.4,XMDA,0),U,2),0))
"RTN","DVBCIRP2",94,0)
 ...I $P(DVBARQST,U,5)>DVBADTLP,($P(DVBARQST,U,5)<DVBAENDL) D
"RTN","DVBCIRP2",95,0)
 ....S ^TMP("DVBAEXAMS",$J,RSDA,TPDA,XMDA)=""
"RTN","DVBCIRP2",96,0)
 S DVBABIEN=DVBARQST
"RTN","DVBCIRP2",97,0)
 K DVBAPG1 S RSDA=""
"RTN","DVBCIRP2",98,0)
 D CAPDETHD^DVBCIUTL S DVBAPG1=""
"RTN","DVBCIRP2",99,0)
 F  S RSDA=$O(^TMP("DVBAEXAMS",$J,RSDA)) Q:(('+RSDA)!($D(GETOUT)))  D
"RTN","DVBCIRP2",100,0)
 .K DVBARSPT S TPDA=""
"RTN","DVBCIRP2",101,0)
 .F  S TPDA=$O(^TMP("DVBAEXAMS",$J,RSDA,TPDA)) Q:(('+TPDA)!($D(GETOUT)))  D
"RTN","DVBCIRP2",102,0)
 ..K DVBAXMPT S XMDA=""
"RTN","DVBCIRP2",103,0)
 ..F  S XMDA=$O(^TMP("DVBAEXAMS",$J,RSDA,TPDA,XMDA)) Q:(('+XMDA)!($D(GETOUT)))  D EXMOUT^DVBCIUTL
"RTN","DVBCIRP2",104,0)
 I '$D(GETOUT),(IOST?1"C-".E) D CONTMES^DVBCUTL4
"RTN","DVBCIRP2",105,0)
 K GETOUT W !
"RTN","DVBCIRP2",106,0)
 D ^%ZISC
"RTN","DVBCIRP2",107,0)
 D KVARS ;**KILL the variables used by DETAIL
"RTN","DVBCIRP2",108,0)
 Q
"RTN","DVBCIRP2",109,0)
 ;
"RTN","DVBCIRP2",110,0)
KVARS ;** Final Kill for Detail report
"RTN","DVBCIRP2",111,0)
 S:$D(ZTQUEUED) ZTREQ="@"
"RTN","DVBCIRP2",112,0)
 K ^TMP($J),DVBAARY,DVBANAME,DVBASSN,DVBACNUM,RSDA,TPDA,XMDA,DVBADTLP,DVBAENDL
"RTN","DVBCIRP2",113,0)
 Q
"RTN","DVBCIRP2",114,0)
 ;
"RTN","DVBCIRP2",115,0)
 ;
"RTN","DVBCIRP2",116,0)
 ;Input:  IEN of 2507 Request in File #396.3
"RTN","DVBCIRP2",117,0)
 ;Output: Priority of Exam for the Current/Parent 2507 Request
"RTN","DVBCIRP2",118,0)
CHKREQ(DVBARIEN) ;check for parent requests
"RTN","DVBCIRP2",119,0)
 N DVBAPIEN,DVBAPEXM
"RTN","DVBCIRP2",120,0)
 Q:($G(DVBARIEN)']"") ""
"RTN","DVBCIRP2",121,0)
 S DVBAPEXM=$P($G(^DVB(396.3,DVBARIEN,0)),U,10)  ;Priority of Exam
"RTN","DVBCIRP2",122,0)
 S DVBAPIEN=$P($G(^DVB(396.3,DVBARIEN,5)),U)  ;parent IEN if it exists
"RTN","DVBCIRP2",123,0)
 I (DVBAPIEN]"") D  ;Parent 2507 Request
"RTN","DVBCIRP2",124,0)
 .S DVBAPEXM=$P($G(^DVB(396.3,DVBAPIEN,0)),U,10)  ;Priority of Exam
"RTN","DVBCIRP2",125,0)
 Q DVBAPEXM
"RTN","DVBCIRP2",126,0)
SUM ;** Set up reason counter array, count all 2507's received
"RTN","DVBCIRP2",127,0)
 ;copied from DVBCIRPT 
"RTN","DVBCIRP2",128,0)
 N DVBAEXMP,DVBAI,DVBAP,DVBATVAR,DVBAMCDES,DVBAPREXM
"RTN","DVBCIRP2",129,0)
 U IO
"RTN","DVBCIRP2",130,0)
 S (DVBARQCT,DVBAINRQ,DVBAXMCT,DVBAINXM)=0
"RTN","DVBCIRP2",131,0)
 S DVBACAN("REQ")=0,DVBACAN("EXM")=0
"RTN","DVBCIRP2",132,0)
 S DVBAENDL=ENDDT
"RTN","DVBCIRP2",133,0)
 S DVBAEXMP=$S(($G(DVBAPRTY)["BDD"):";BDD;QS;",($G(DVBAPRTY)["IDES"):";IDES;",($G(DVBAPRTY)["AO"):";AO;",1:"")
"RTN","DVBCIRP2",134,0)
 ; S DVBAMCDES=((DVBAEXMP]"")&(DVBAPRTY'="AO"))
"RTN","DVBCIRP2",135,0)
 S NUMRPTS=$L(DVBAEXMP,";")
"RTN","DVBCIRP2",136,0)
 S DVBAMCDES=((DVBAEXMP]"")&(NUMRPTS>3))
"RTN","DVBCIRP2",137,0)
 K ^TMP("DVBATOTALS",$J)  ;for multiple priority reporting
"RTN","DVBCIRP2",138,0)
 ;
"RTN","DVBCIRP2",139,0)
 ;** Initialize reason counter array(s)
"RTN","DVBCIRP2",140,0)
 F DVBARIFN=0:0 S DVBARIFN=$O(^DVB(396.94,DVBARIFN)) Q:+DVBARIFN'>0  DO
"RTN","DVBCIRP2",141,0)
 .D:(DVBAMCDES)
"RTN","DVBCIRP2",142,0)
 ..F DVBAP=$P(DVBAEXMP,";",2),$P(DVBAEXMP,";",3)  D
"RTN","DVBCIRP2",143,0)
 ...Q:DVBAP=""
"RTN","DVBCIRP2",144,0)
 ...S ^TMP("DVBATOTALS",$J,DVBAP,"DVBAINXM",DVBARIFN)=0
"RTN","DVBCIRP2",145,0)
 .S DVBAINXM(DVBARIFN)=0
"RTN","DVBCIRP2",146,0)
 D:(DVBAMCDES)
"RTN","DVBCIRP2",147,0)
 .F DVBAP=$P(DVBAEXMP,";",2),$P(DVBAEXMP,";",3)  D
"RTN","DVBCIRP2",148,0)
 ..Q:DVBAP=""
"RTN","DVBCIRP2",149,0)
 ..S ^TMP("DVBATOTALS",$J,DVBAP,"DVBAINXM","NO REASON")=0
"RTN","DVBCIRP2",150,0)
 S DVBAINXM("NO REASON")=0
"RTN","DVBCIRP2",151,0)
 ;
"RTN","DVBCIRP2",152,0)
 ;** Count the total and insufficient number of exams and 2507 requests
"RTN","DVBCIRP2",153,0)
 ;     For performance, if multiple reports, store totals in single pass of data
"RTN","DVBCIRP2",154,0)
 S DVBADTLP=BEGDT-.0001
"RTN","DVBCIRP2",155,0)
 F  S DVBADTLP=$O(^DVB(396.3,"ADP",DVBADTLP)) Q:(DVBADTLP=""!(DVBADTLP>ENDDT))  DO
"RTN","DVBCIRP2",156,0)
 .S DVBAPRIO=""
"RTN","DVBCIRP2",157,0)
 .F  S DVBAPRIO=$O(^DVB(396.3,"ADP",DVBADTLP,DVBAPRIO)) Q:DVBAPRIO=""  DO
"RTN","DVBCIRP2",158,0)
 ..S DVBADALP=""
"RTN","DVBCIRP2",159,0)
 ..F  S DVBADALP=$O(^DVB(396.3,"ADP",DVBADTLP,DVBAPRIO,DVBADALP)) Q:DVBADALP=""  DO
"RTN","DVBCIRP2",160,0)
 ...;check for Parent Request (retrieve current/parent Priority of Exam)
"RTN","DVBCIRP2",161,0)
 ...S DVBAPREXM=$$CHKREQ(DVBADALP)
"RTN","DVBCIRP2",162,0)
 ...S DVBAPREXM=""
"RTN","DVBCIRP2",163,0)
 ...;original report run (Exclude new priorities)
"RTN","DVBCIRP2",164,0)
 ...Q:((DVBAEXMP']"")&((";BDD;QS;IDES;AO;")[(";"_DVBAPREXM_";")))
"RTN","DVBCIRP2",165,0)
 ...;report for specific Priority of Exam
"RTN","DVBCIRP2",166,0)
 ...Q:((DVBAEXMP]"")&(DVBAEXMP'[(";"_DVBAPREXM_";")))
"RTN","DVBCIRP2",167,0)
 ...S:(DVBAMCDES) ^TMP("DVBATOTALS",$J,DVBAPREXM,"DVBARQCT")=$G(^TMP("DVBATOTALS",$J,DVBAPREXM,"DVBARQCT"))+1
"RTN","DVBCIRP2",168,0)
 ...S DVBARQCT=DVBARQCT+1
"RTN","DVBCIRP2",169,0)
 ...K DVBAINSF
"RTN","DVBCIRP2",170,0)
 ...I DVBAPRIO="E" DO
"RTN","DVBCIRP2",171,0)
 ....S:(DVBAMCDES) ^TMP("DVBATOTALS",$J,DVBAPREXM,"DVBAINRQ")=$G(^TMP("DVBATOTALS",$J,DVBAPREXM,"DVBAINRQ"))+1
"RTN","DVBCIRP2",172,0)
 ....S DVBAINRQ=DVBAINRQ+1
"RTN","DVBCIRP2",173,0)
 ....;AJF;Request Status conversion
"RTN","DVBCIRP2",174,0)
 ....I $P(^DVB(396.3,DVBADALP,0),U,18)=7 D
"RTN","DVBCIRP2",175,0)
 .....S:(DVBAMCDES) ^TMP("DVBATOTALS",$J,DVBAPREXM,"DVBACANREQ")=$G(^TMP("DVBATOTALS",$J,DVBAPREXM,"DVBACANREQ"))+1
"RTN","DVBCIRP2",176,0)
 .....S DVBACAN("REQ")=DVBACAN("REQ")+1
"RTN","DVBCIRP2",177,0)
 ....S DVBAINSF=""
"RTN","DVBCIRP2",178,0)
 ...S DVBAXMDA=""
"RTN","DVBCIRP2",179,0)
 ...F  S DVBAXMDA=$O(^DVB(396.4,"C",DVBADALP,DVBAXMDA)) Q:DVBAXMDA=""  DO
"RTN","DVBCIRP2",180,0)
 ....S:(DVBAMCDES) ^TMP("DVBATOTALS",$J,DVBAPREXM,"DVBAXMCT")=$G(^TMP("DVBATOTALS",$J,DVBAPREXM,"DVBAXMCT"))+1
"RTN","DVBCIRP2",181,0)
 ....S DVBAXMCT=DVBAXMCT+1
"RTN","DVBCIRP2",182,0)
 ....I $D(DVBAINSF) DO
"RTN","DVBCIRP2",183,0)
 .....S:(DVBAMCDES) ^TMP("DVBATOTALS",$J,DVBAPREXM,"DVBAINXM")=$G(^TMP("DVBATOTALS",$J,DVBAPREXM,"DVBAINXM"))+1
"RTN","DVBCIRP2",184,0)
 .....S DVBAINXM=DVBAINXM+1
"RTN","DVBCIRP2",185,0)
 .....S DVBARIFN=$P(^DVB(396.4,DVBAXMDA,0),U,11),DVBASTAT=$P(^(0),U,4)
"RTN","DVBCIRP2",186,0)
 .....S:DVBARIFN="" DVBARIFN="NO REASON"
"RTN","DVBCIRP2",187,0)
 .....S:(DVBAMCDES) ^TMP("DVBATOTALS",$J,DVBAPREXM,"DVBAINXM",DVBARIFN)=$G(^TMP("DVBATOTALS",$J,DVBAPREXM,"DVBAINXM",DVBARIFN))+1
"RTN","DVBCIRP2",188,0)
 .....S DVBAINXM(DVBARIFN)=DVBAINXM(DVBARIFN)+1
"RTN","DVBCIRP2",189,0)
 .....I DVBASTAT="RX" D
"RTN","DVBCIRP2",190,0)
 ......S:(DVBAMCDES) ^TMP("DVBATOTALS",$J,DVBAPREXM,"DVBACANEXM")=$G(^TMP("DVBATOTALS",$J,DVBAPREXM,"DVBACANEXM"))+1
"RTN","DVBCIRP2",191,0)
 ......S DVBACAN("EXM")=DVBACAN("EXM")+1
"RTN","DVBCIRP2",192,0)
 ;
"RTN","DVBCIRP2",193,0)
 S DVBAEXMP=$S(($G(DVBAPRTY)["BDD"):"BDD,QS",($G(DVBAPRTY)["IDES"):"IDES",($G(DVBAPRTY)["AO"):"AO",1:"")
"RTN","DVBCIRP2",194,0)
 F DVBAI=1:1:$L(DVBAEXMP,",")  D
"RTN","DVBCIRP2",195,0)
 .S DVBAPRTY=$P(DVBAEXMP,",",DVBAI)  ;priority to report on
"RTN","DVBCIRP2",196,0)
 .D:(DVBAI>1)  ;Form Feed between multiple Reports
"RTN","DVBCIRP2",197,0)
 ..S DVBATVAR(1,0)="0,0,0,0,1^"
"RTN","DVBCIRP2",198,0)
 ..D WR^DVBAUTL4("DVBATVAR")
"RTN","DVBCIRP2",199,0)
 .;
"RTN","DVBCIRP2",200,0)
 .D:(DVBAMCDES)  ;reset var cntrs for specific priority
"RTN","DVBCIRP2",201,0)
 ..S DVBARQCT=+$G(^TMP("DVBATOTALS",$J,DVBAPRTY,"DVBARQCT"))
"RTN","DVBCIRP2",202,0)
 ..S DVBAINRQ=+$G(^TMP("DVBATOTALS",$J,DVBAPRTY,"DVBAINRQ"))
"RTN","DVBCIRP2",203,0)
 ..S DVBACAN("REQ")=+$G(^TMP("DVBATOTALS",$J,DVBAPRTY,"DVBACANREQ"))
"RTN","DVBCIRP2",204,0)
 ..S DVBAXMCT=+$G(^TMP("DVBATOTALS",$J,DVBAPRTY,"DVBAXMCT"))
"RTN","DVBCIRP2",205,0)
 ..S DVBAINXM=+$G(^TMP("DVBATOTALS",$J,DVBAPRTY,"DVBAINXM"))
"RTN","DVBCIRP2",206,0)
 ..S DVBAP=0 F  S DVBAP=$O(^TMP("DVBATOTALS",$J,DVBAPRTY,"DVBAINXM",DVBAP)) Q:DVBAP=""  D
"RTN","DVBCIRP2",207,0)
 ...S DVBAINXM(DVBAP)=+$G(^TMP("DVBATOTALS",$J,DVBAPRTY,"DVBAINXM",DVBAP))
"RTN","DVBCIRP2",208,0)
 ..S DVBACAN("EXM")=+$G(^TMP("DVBATOTALS",$J,DVBAPRTY,"DVBACANEXM"))
"RTN","DVBCIRP2",209,0)
 .;
"RTN","DVBCIRP2",210,0)
 .D SUMRPT  ;print SUMMARY report
"RTN","DVBCIRP2",211,0)
 S:$D(ZTQUEUED) ZTREQ="@"
"RTN","DVBCIRP2",212,0)
 D SUMKILL
"RTN","DVBCIRP2",213,0)
 D ^%ZISC
"RTN","DVBCIRP2",214,0)
 Q
"RTN","DVBCIRP2",215,0)
 ;
"RTN","DVBCIRP2",216,0)
SUMKILL ;** Kill the variables used in the summary report
"RTN","DVBCIRP2",217,0)
 K DVBADTLP,DVBAENDL,DVBARQCT,DVBAINRQ,DVBAXMCT,DVBAINXM
"RTN","DVBCIRP2",218,0)
 K DVBAPRIO,DVBADALP,DVBAXMDA,DVBAINSF,DVBARIFN
"RTN","DVBCIRP2",219,0)
 K ^TMP("DVBATOTALS",$J)
"RTN","DVBCIRP2",220,0)
 Q
"RTN","DVBCIRPT")
0^45^B49657590^B49088411
"RTN","DVBCIRPT",1,0)
DVBCIRPT ;ALB/GTS-AMIE C&P INSUFF EXAM TRACKING RPT ; 11/9/94  2:00 PM
"RTN","DVBCIRPT",2,0)
 ;;2.7;AMIE;**13,19,27,149,184,185,191,193**;Apr 10, 1995;Build 84
"RTN","DVBCIRPT",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","DVBCIRPT",4,0)
 ;
"RTN","DVBCIRPT",5,0)
 ;** Version Changes
"RTN","DVBCIRPT",6,0)
 ;   2.7 - New routine (Enhc 15)
"RTN","DVBCIRPT",7,0)
 ;
"RTN","DVBCIRPT",8,0)
MAIN ;**Select Dte Rng & Rpt Type; call report routine **
"RTN","DVBCIRPT",9,0)
 ;**DVBA*2.7*191 initializes variable DVBADLMTR to zero before taskman call on detailed report**
"RTN","DVBCIRPT",10,0)
 F  Q:$D(DVBAOUT)  DO
"RTN","DVBCIRPT",11,0)
 .D HOME^%ZIS
"RTN","DVBCIRPT",12,0)
 .S TVAR(1,0)="0,0,1,2:2,1^Insufficient 2507 Exam Report"
"RTN","DVBCIRPT",13,0)
 .D WR^DVBAUTL4("TVAR")
"RTN","DVBCIRPT",14,0)
 .K TVAR
"RTN","DVBCIRPT",15,0)
 .S DVBAPRTY=$$EXMPRTY^DVBCIUTL("Select Priority of Exam for the Insufficient Exam Report")  ;priority of exam selection
"RTN","DVBCIRPT",16,0)
 .S RPTTYPE=$S((DVBAPRTY?.A)&(DVBAPRTY]""):$$RPTTYPE^DVBCUTA1(),1:"")
"RTN","DVBCIRPT",17,0)
 .S:((RPTTYPE'="D")&(RPTTYPE'="S")) DVBAOUT=""
"RTN","DVBCIRPT",18,0)
 .W:'$D(DVBAOUT) !!
"RTN","DVBCIRPT",19,0)
 .D:'$D(DVBAOUT) DATE^DVBCUTL4(.BEGDT,.ENDDT)
"RTN","DVBCIRPT",20,0)
 .I $D(ENDDT),(+ENDDT>0) DO
"RTN","DVBCIRPT",21,0)
 ..S ENDDT=ENDDT_".2359"
"RTN","DVBCIRPT",22,0)
 ..I RPTTYPE="S" DO
"RTN","DVBCIRPT",23,0)
 ...D DEVSEL
"RTN","DVBCIRPT",24,0)
 ...I POP D SUMKILL
"RTN","DVBCIRPT",25,0)
 ...I 'POP DO
"RTN","DVBCIRPT",26,0)
 ....I $D(IO("Q")) DO
"RTN","DVBCIRPT",27,0)
 .....N DVBAI
"RTN","DVBCIRPT",28,0)
 .....S ZTRTN="SUM^DVBCIRPT",ZTIO=ION
"RTN","DVBCIRPT",29,0)
 .....S ZTDESC="Summary Insufficient Exam Report"
"RTN","DVBCIRPT",30,0)
 .....F DVBAI="BEGDT","ENDDT","DVBAPRTY" S ZTSAVE(DVBAI)=""
"RTN","DVBCIRPT",31,0)
 .....D ^%ZTLOAD
"RTN","DVBCIRPT",32,0)
 .....N TSK S TSK=$S($D(ZTSK)=0:"C",1:"Y")
"RTN","DVBCIRPT",33,0)
 .....I TSK="Y" W !!,"Summary Report Queued. Task number: ",ZTSK
"RTN","DVBCIRPT",34,0)
 .....K ZTSK D CONTMES^DVBCUTL4
"RTN","DVBCIRPT",35,0)
 .....D SUMKILL
"RTN","DVBCIRPT",36,0)
 ....I '$D(IO("Q")) D SUM
"RTN","DVBCIRPT",37,0)
 ...D ^%ZISC
"RTN","DVBCIRPT",38,0)
 ..I RPTTYPE="D" DO
"RTN","DVBCIRPT",39,0)
 ...D DETSEL^DVBCIRP1 ;**Select the Reasons and Exams to report
"RTN","DVBCIRPT",40,0)
 ...I '$D(DVBAQTSL) DO
"RTN","DVBCIRPT",41,0)
 ....D DEVSEL
"RTN","DVBCIRPT",42,0)
 ....I POP D KVARS^DVBCIRP1
"RTN","DVBCIRPT",43,0)
 ....I 'POP DO
"RTN","DVBCIRPT",44,0)
 .....I $D(IO("Q")) DO
"RTN","DVBCIRPT",45,0)
 ......N DVBAI,ZTSAVE
"RTN","DVBCIRPT",46,0)
 ......S ZTRTN="DETAIL^DVBCIRP1",ZTIO=ION
"RTN","DVBCIRPT",47,0)
 ......S ZTDESC="Detailed Insufficient Exam Report"
"RTN","DVBCIRPT",48,0)
 ......F DVBAI="BEGDT","ENDDT","DVBAPRTY","DVBAARY(""REASON"",","^TMP($J,""XMTYPE""," S ZTSAVE(DVBAI)="",ZTSAVE("DVBADLMTR")=0
"RTN","DVBCIRPT",49,0)
 ......D ^%ZTLOAD
"RTN","DVBCIRPT",50,0)
 ......N TSK S TSK=$S($D(ZTSK)=0:"C",1:"Y")
"RTN","DVBCIRPT",51,0)
 ......I TSK="Y" W !!,"Detail Report Queued. Task number: ",ZTSK
"RTN","DVBCIRPT",52,0)
 ......K ZTSK D CONTMES^DVBCUTL4
"RTN","DVBCIRPT",53,0)
 ......D KVARS^DVBCIRP1
"RTN","DVBCIRPT",54,0)
 .....I '$D(IO("Q")) W:IOST?1"C-".E @IOF S DVBADLMTR=0 D DETAIL^DVBCIRP1
"RTN","DVBCIRPT",55,0)
 ....D ^%ZISC
"RTN","DVBCIRPT",56,0)
 ...K DVBAQTSL
"RTN","DVBCIRPT",57,0)
 ..D CLEANUP
"RTN","DVBCIRPT",58,0)
 D KVARS
"RTN","DVBCIRPT",59,0)
 Q
"RTN","DVBCIRPT",60,0)
 ;
"RTN","DVBCIRPT",61,0)
KVARS ;** Kill the variables used in report
"RTN","DVBCIRPT",62,0)
 K DVBAOUT,ENDDT,BEGDT,DTOUT,DUOUT,RPTTYPE,DVBACAN,DVBASTAT,DVBAPRTY,DVBADLMTR,NUMRPTS
"RTN","DVBCIRPT",63,0)
 D CLEANUP
"RTN","DVBCIRPT",64,0)
 Q
"RTN","DVBCIRPT",65,0)
 ;
"RTN","DVBCIRPT",66,0)
CLEANUP ;** Kill the variables used by the device handler
"RTN","DVBCIRPT",67,0)
 K %ZIS,POP,%IS,IOP
"RTN","DVBCIRPT",68,0)
 K IOBS,IOHG,IOPAR,IOUPAR,IOXY,POP,%DT,%YY,%XX,ION,IOPAR
"RTN","DVBCIRPT",69,0)
 Q
"RTN","DVBCIRPT",70,0)
 ;
"RTN","DVBCIRPT",71,0)
DEVSEL ;** Select the device to report to
"RTN","DVBCIRPT",72,0)
 S %ZIS="AEQ"
"RTN","DVBCIRPT",73,0)
 S %ZIS("A")="Output device: "
"RTN","DVBCIRPT",74,0)
 D ^%ZIS
"RTN","DVBCIRPT",75,0)
 Q
"RTN","DVBCIRPT",76,0)
 ;
"RTN","DVBCIRPT",77,0)
SUM ;** Set up reason counter array, count all 2507's received
"RTN","DVBCIRPT",78,0)
 N DVBAEXMP,DVBAI,DVBAP,DVBATVAR,DVBAMCDES,DVBAPREXM
"RTN","DVBCIRPT",79,0)
 U IO
"RTN","DVBCIRPT",80,0)
 S (DVBARQCT,DVBAINRQ,DVBAXMCT,DVBAINXM)=0
"RTN","DVBCIRPT",81,0)
 S DVBACAN("REQ")=0,DVBACAN("EXM")=0
"RTN","DVBCIRPT",82,0)
 S DVBAENDL=ENDDT
"RTN","DVBCIRPT",83,0)
 S DVBAEXMP=$S(($G(DVBAPRTY)["BDD"):";BDD;QS;",($G(DVBAPRTY)["IDES"):";IDES;",($G(DVBAPRTY)["AO"):";AO;",1:"")
"RTN","DVBCIRPT",84,0)
 ; S DVBAMCDES=((DVBAEXMP]"")&(DVBAPRTY'="AO"))
"RTN","DVBCIRPT",85,0)
 S NUMRPTS=$L(DVBAEXMP,";")
"RTN","DVBCIRPT",86,0)
 S DVBAMCDES=((DVBAEXMP]"")&(NUMRPTS>3))
"RTN","DVBCIRPT",87,0)
 K ^TMP("DVBATOTALS",$J)  ;for multiple priority reporting
"RTN","DVBCIRPT",88,0)
 ;
"RTN","DVBCIRPT",89,0)
 ;** Initialize reason counter array(s)
"RTN","DVBCIRPT",90,0)
 F DVBARIFN=0:0 S DVBARIFN=$O(^DVB(396.94,DVBARIFN)) Q:+DVBARIFN'>0  DO
"RTN","DVBCIRPT",91,0)
 .D:(DVBAMCDES)
"RTN","DVBCIRPT",92,0)
 ..F DVBAP=$P(DVBAEXMP,";",2),$P(DVBAEXMP,";",3)  D
"RTN","DVBCIRPT",93,0)
 ...Q:DVBAP=""
"RTN","DVBCIRPT",94,0)
 ...S ^TMP("DVBATOTALS",$J,DVBAP,"DVBAINXM",DVBARIFN)=0
"RTN","DVBCIRPT",95,0)
 .S DVBAINXM(DVBARIFN)=0
"RTN","DVBCIRPT",96,0)
 D:(DVBAMCDES)
"RTN","DVBCIRPT",97,0)
 .F DVBAP=$P(DVBAEXMP,";",2),$P(DVBAEXMP,";",3)  D
"RTN","DVBCIRPT",98,0)
 ..Q:DVBAP=""
"RTN","DVBCIRPT",99,0)
 ..S ^TMP("DVBATOTALS",$J,DVBAP,"DVBAINXM","NO REASON")=0
"RTN","DVBCIRPT",100,0)
 S DVBAINXM("NO REASON")=0
"RTN","DVBCIRPT",101,0)
 ;
"RTN","DVBCIRPT",102,0)
 ;** Count the total and insufficient number of exams and 2507 requests
"RTN","DVBCIRPT",103,0)
 ;     For performance, if multiple reports, store totals in single pass of data
"RTN","DVBCIRPT",104,0)
 S DVBADTLP=BEGDT-.0001
"RTN","DVBCIRPT",105,0)
 F  S DVBADTLP=$O(^DVB(396.3,"ADP",DVBADTLP)) Q:(DVBADTLP=""!(DVBADTLP>ENDDT))  DO
"RTN","DVBCIRPT",106,0)
 .S DVBAPRIO=""
"RTN","DVBCIRPT",107,0)
 .F  S DVBAPRIO=$O(^DVB(396.3,"ADP",DVBADTLP,DVBAPRIO)) Q:DVBAPRIO=""  DO
"RTN","DVBCIRPT",108,0)
 ..S DVBADALP=""
"RTN","DVBCIRPT",109,0)
 ..F  S DVBADALP=$O(^DVB(396.3,"ADP",DVBADTLP,DVBAPRIO,DVBADALP)) Q:DVBADALP=""  DO
"RTN","DVBCIRPT",110,0)
 ...;check for Parent Request (retrieve current/parent Priority of Exam)
"RTN","DVBCIRPT",111,0)
 ...S DVBAPREXM=$$CHKREQ^DVBCIRP1(DVBADALP)
"RTN","DVBCIRPT",112,0)
 ...;original report run (Exclude new priorities)
"RTN","DVBCIRPT",113,0)
 ...Q:((DVBAEXMP']"")&((";BDD;QS;IDES;AO;")[(";"_DVBAPREXM_";")))
"RTN","DVBCIRPT",114,0)
 ...;report for specific Priority of Exam
"RTN","DVBCIRPT",115,0)
 ...Q:((DVBAEXMP]"")&(DVBAEXMP'[(";"_DVBAPREXM_";")))
"RTN","DVBCIRPT",116,0)
 ...S:(DVBAMCDES) ^TMP("DVBATOTALS",$J,DVBAPREXM,"DVBARQCT")=$G(^TMP("DVBATOTALS",$J,DVBAPREXM,"DVBARQCT"))+1
"RTN","DVBCIRPT",117,0)
 ...S DVBARQCT=DVBARQCT+1
"RTN","DVBCIRPT",118,0)
 ...K DVBAINSF
"RTN","DVBCIRPT",119,0)
 ...I DVBAPRIO="E" DO
"RTN","DVBCIRPT",120,0)
 ....S:(DVBAMCDES) ^TMP("DVBATOTALS",$J,DVBAPREXM,"DVBAINRQ")=$G(^TMP("DVBATOTALS",$J,DVBAPREXM,"DVBAINRQ"))+1
"RTN","DVBCIRPT",121,0)
 ....S DVBAINRQ=DVBAINRQ+1
"RTN","DVBCIRPT",122,0)
 ....; ;AJF;Request Status conversion
"RTN","DVBCIRPT",123,0)
 ....I $P(^DVB(396.3,DVBADALP,0),U,18)=7 D
"RTN","DVBCIRPT",124,0)
 .....S:(DVBAMCDES) ^TMP("DVBATOTALS",$J,DVBAPREXM,"DVBACANREQ")=$G(^TMP("DVBATOTALS",$J,DVBAPREXM,"DVBACANREQ"))+1
"RTN","DVBCIRPT",125,0)
 .....S DVBACAN("REQ")=DVBACAN("REQ")+1
"RTN","DVBCIRPT",126,0)
 ....S DVBAINSF=""
"RTN","DVBCIRPT",127,0)
 ...S DVBAXMDA=""
"RTN","DVBCIRPT",128,0)
 ...F  S DVBAXMDA=$O(^DVB(396.4,"C",DVBADALP,DVBAXMDA)) Q:DVBAXMDA=""  DO
"RTN","DVBCIRPT",129,0)
 ....S:(DVBAMCDES) ^TMP("DVBATOTALS",$J,DVBAPREXM,"DVBAXMCT")=$G(^TMP("DVBATOTALS",$J,DVBAPREXM,"DVBAXMCT"))+1
"RTN","DVBCIRPT",130,0)
 ....S DVBAXMCT=DVBAXMCT+1
"RTN","DVBCIRPT",131,0)
 ....I $D(DVBAINSF) DO
"RTN","DVBCIRPT",132,0)
 .....S:(DVBAMCDES) ^TMP("DVBATOTALS",$J,DVBAPREXM,"DVBAINXM")=$G(^TMP("DVBATOTALS",$J,DVBAPREXM,"DVBAINXM"))+1
"RTN","DVBCIRPT",133,0)
 .....S DVBAINXM=DVBAINXM+1
"RTN","DVBCIRPT",134,0)
 .....S DVBARIFN=$P(^DVB(396.4,DVBAXMDA,0),U,11),DVBASTAT=$P(^(0),U,4)
"RTN","DVBCIRPT",135,0)
 .....S:DVBARIFN="" DVBARIFN="NO REASON"
"RTN","DVBCIRPT",136,0)
 .....S:(DVBAMCDES) ^TMP("DVBATOTALS",$J,DVBAPREXM,"DVBAINXM",DVBARIFN)=$G(^TMP("DVBATOTALS",$J,DVBAPREXM,"DVBAINXM",DVBARIFN))+1
"RTN","DVBCIRPT",137,0)
 .....S DVBAINXM(DVBARIFN)=DVBAINXM(DVBARIFN)+1
"RTN","DVBCIRPT",138,0)
 .....I DVBASTAT="RX" D
"RTN","DVBCIRPT",139,0)
 ......S:(DVBAMCDES) ^TMP("DVBATOTALS",$J,DVBAPREXM,"DVBACANEXM")=$G(^TMP("DVBATOTALS",$J,DVBAPREXM,"DVBACANEXM"))+1
"RTN","DVBCIRPT",140,0)
 ......S DVBACAN("EXM")=DVBACAN("EXM")+1
"RTN","DVBCIRPT",141,0)
 ;
"RTN","DVBCIRPT",142,0)
 S DVBAEXMP=$S(($G(DVBAPRTY)["BDD"):"BDD,QS",($G(DVBAPRTY)["IDES"):"IDES",($G(DVBAPRTY)["AO"):"AO",1:"")
"RTN","DVBCIRPT",143,0)
 F DVBAI=1:1:$L(DVBAEXMP,",")  D
"RTN","DVBCIRPT",144,0)
 .S DVBAPRTY=$P(DVBAEXMP,",",DVBAI)  ;priority to report on
"RTN","DVBCIRPT",145,0)
 .D:(DVBAI>1)  ;Form Feed between multiple Reports
"RTN","DVBCIRPT",146,0)
 ..S DVBATVAR(1,0)="0,0,0,0,1^"
"RTN","DVBCIRPT",147,0)
 ..D WR^DVBAUTL4("DVBATVAR")
"RTN","DVBCIRPT",148,0)
 .;
"RTN","DVBCIRPT",149,0)
 .D:(DVBAMCDES)  ;reset var cntrs for specific priority
"RTN","DVBCIRPT",150,0)
 ..S DVBARQCT=+$G(^TMP("DVBATOTALS",$J,DVBAPRTY,"DVBARQCT"))
"RTN","DVBCIRPT",151,0)
 ..S DVBAINRQ=+$G(^TMP("DVBATOTALS",$J,DVBAPRTY,"DVBAINRQ"))
"RTN","DVBCIRPT",152,0)
 ..S DVBACAN("REQ")=+$G(^TMP("DVBATOTALS",$J,DVBAPRTY,"DVBACANREQ"))
"RTN","DVBCIRPT",153,0)
 ..S DVBAXMCT=+$G(^TMP("DVBATOTALS",$J,DVBAPRTY,"DVBAXMCT"))
"RTN","DVBCIRPT",154,0)
 ..S DVBAINXM=+$G(^TMP("DVBATOTALS",$J,DVBAPRTY,"DVBAINXM"))
"RTN","DVBCIRPT",155,0)
 ..S DVBAP=0 F  S DVBAP=$O(^TMP("DVBATOTALS",$J,DVBAPRTY,"DVBAINXM",DVBAP)) Q:DVBAP=""  D
"RTN","DVBCIRPT",156,0)
 ...S DVBAINXM(DVBAP)=+$G(^TMP("DVBATOTALS",$J,DVBAPRTY,"DVBAINXM",DVBAP))
"RTN","DVBCIRPT",157,0)
 ..S DVBACAN("EXM")=+$G(^TMP("DVBATOTALS",$J,DVBAPRTY,"DVBACANEXM"))
"RTN","DVBCIRPT",158,0)
 .;
"RTN","DVBCIRPT",159,0)
 .D SUMRPT^DVBCIRP1  ;print SUMMARY report
"RTN","DVBCIRPT",160,0)
 S:$D(ZTQUEUED) ZTREQ="@"
"RTN","DVBCIRPT",161,0)
 D SUMKILL
"RTN","DVBCIRPT",162,0)
 D ^%ZISC
"RTN","DVBCIRPT",163,0)
 Q
"RTN","DVBCIRPT",164,0)
 ;
"RTN","DVBCIRPT",165,0)
SUMKILL ;** Kill the variables used in the summary report
"RTN","DVBCIRPT",166,0)
 K DVBADTLP,DVBAENDL,DVBARQCT,DVBAINRQ,DVBAXMCT,DVBAINXM
"RTN","DVBCIRPT",167,0)
 K DVBAPRIO,DVBADALP,DVBAXMDA,DVBAINSF,DVBARIFN
"RTN","DVBCIRPT",168,0)
 K ^TMP("DVBATOTALS",$J)
"RTN","DVBCIRPT",169,0)
 Q
"RTN","DVBCLABR")
0^46^B7567469^B7416408
"RTN","DVBCLABR",1,0)
DVBCLABR ;ALB/GTS-557/THM-PRINT C&P LAB TEST RESULTS ; 9/6/91  1:40 PM
"RTN","DVBCLABR",2,0)
 ;;2.7;AMIE;**11,42,193**;Apr 10, 1995;Build 84
"RTN","DVBCLABR",3,0)
 ;
"RTN","DVBCLABR",4,0)
LAB N XX S XX=1
"RTN","DVBCLABR",5,0)
 F  Q:'$D(DVBCRALC(XX))  D
"RTN","DVBCLABR",6,0)
 .S DVBCRALC=DVBCRALC(XX)
"RTN","DVBCLABR",7,0)
 .S XX=XX+1 D LAB1
"RTN","DVBCLABR",8,0)
 Q
"RTN","DVBCLABR",9,0)
LAB1 ;print lab
"RTN","DVBCLABR",10,0)
 ;AJF;Request Status conversion
"RTN","DVBCLABR",11,0)
 S STAT=$P(^DVB(396.3,DA(1),0),U,18),STAT=$$RSTAT^DVBCUTL8(STAT)
"RTN","DVBCLABR",12,0)
 Q:STAT["X"  I '$D(DVBCRALC) D SETLAB^DVBCPRNT ; ** Set variable DVBCRALC
"RTN","DVBCLABR",13,0)
 S LRDFN=$S($D(^DPT(DFN,"LR")):+^("LR"),1:0),DTREL=$P(^DVB(396.3,DA(1),0),U,14) Q:DTREL=""
"RTN","DVBCLABR",14,0)
 ; ** 'CH' X-ref is for Chemistry tests, 'MI' X-ref is for Micro tests.
"RTN","DVBCLABR",15,0)
 D RSET S DVBCW=1 F DVBCI=0:0 S LRIDT=$O(^LR(LRDFN,"CH",LRIDT)) Q:LRIDT=""!(LRIDT>LREDT)  D LK
"RTN","DVBCLABR",16,0)
 D RSET S DVBCW=2 F DVBCI=0:0 S LRIDT=$O(^LR(LRDFN,"MI",LRIDT)) Q:LRIDT=""!(LRIDT>LREDT)  D LK
"RTN","DVBCLABR",17,0)
 ;
"RTN","DVBCLABR",18,0)
RAD ;print radiology
"RTN","DVBCLABR",19,0)
 Q:'$D(^RADPT(0))  ;quit if not running radiology package
"RTN","DVBCLABR",20,0)
 S RABDT=DVBCBDT,RAEDT=DTREL,RAHLOC=DVBCRALC D ^RAUTL3
"RTN","DVBCLABR",21,0)
 K DVBCW,RABDT,RAEDT,RAHLOC
"RTN","DVBCLABR",22,0)
 Q
"RTN","DVBCLABR",23,0)
 ;
"RTN","DVBCLABR",24,0)
REN I '$D(FF) D HOME^%ZIS S FF=IOF
"RTN","DVBCLABR",25,0)
 ;
"RTN","DVBCLABR",26,0)
REN1 W @FF,!,"Reprint Lab/X-Ray Results for C&P Exams",!!!
"RTN","DVBCLABR",27,0)
 S DIC="^DVB(396.3,",DIC(0)="AEQM" D ^DIC I X=""!(X=U) G KILL^DVBCUTIL
"RTN","DVBCLABR",28,0)
 I +Y>0 S DA(1)=+Y,DFN=$P(Y,U,2)
"RTN","DVBCLABR",29,0)
 W !! S %ZIS="AEQ",%ZIS("A")="Output device: " D ^%ZIS K %ZIS G:POP KILL^DVBCUTIL
"RTN","DVBCLABR",30,0)
 I $D(IO("Q")) S ZTRTN="REN2^DVBCLABR",ZTIO=ION,ZTDESC="C&P lab/radiology print" F I="DIC*","DA*","DFN" S ZTSAVE(I)=""
"RTN","DVBCLABR",31,0)
 I $D(IO("Q")) D ^%ZTLOAD W:$D(ZTSK) !!,"Request queued",!! H 2 G KILL^DVBCUTIL
"RTN","DVBCLABR",32,0)
REN2 U IO D SETLAB^DVBCPRNT,LAB S LKILL=1
"RTN","DVBCLABR",33,0)
 Q:$G(DVBGUI)  D:$D(ZTQUEUED) KILL^%ZTLOAD
"RTN","DVBCLABR",34,0)
 G KILL^DVBCUTIL
"RTN","DVBCLABR",35,0)
 ;
"RTN","DVBCLABR",36,0)
RSET D:'$D(LRPARAM) DT^LRX,EN^LRPARAM S (LREND,LRSTOP)=0,LRCW=8,LRHF=1,LRFOOT=0,(LRONESPC,LRONETST)=""
"RTN","DVBCLABR",37,0)
 S LRLAB=1,X1=DTREL,X2=-120 D C^%DTC S (DVBCBDT,LREDT)=X,LRSDT=DTREL,LRIDT=9999999-LRSDT,LREDT=9999999-LREDT D PT^LRX
"RTN","DVBCLABR",38,0)
 Q
"RTN","DVBCLABR",39,0)
 ;
"RTN","DVBCLABR",40,0)
LK I DVBCW=1 S DVBCRLOC=$P(^LR(LRDFN,"CH",LRIDT,0),U,11)
"RTN","DVBCLABR",41,0)
 I DVBCW=2 S DVBCRLOC=$P(^LR(LRDFN,"MI",LRIDT,0),U,8)
"RTN","DVBCLABR",42,0)
 Q:DVBCRLOC=""  ; * Quit if DVBCRLOC is NULL.
"RTN","DVBCLABR",43,0)
 ;
"RTN","DVBCLABR",44,0)
 ; ** NOTE: DVBCRALC=^Pointer to file 44^Pointer to file 44^
"RTN","DVBCLABR",45,0)
 ; ** NOTE: DVBCRALC pointers come from file 396.1 C&P ROUTING LOCATION
"RTN","DVBCLABR",46,0)
 ; ** DVBCRLOC is the REQUESTING LOCATION in the Lab Data File multiple
"RTN","DVBCLABR",47,0)
 F ZJ=0:0 S ZJ=$O(^SC("C",DVBCRLOC,ZJ)) Q:ZJ=""  S DVBCXLOC=U_ZJ_U I DVBCRALC[DVBCXLOC D:DVBCW=1 CH^LRRP2 D:DVBCW=2 MI^LRRP2 Q
"RTN","DVBCLABR",48,0)
 K DVBCXLOC
"RTN","DVBCLOG")
0^32^B16692467^B16688763
"RTN","DVBCLOG",1,0)
DVBCLOG ;ALB/GTS-557/THM-LOG A 2507 REQUEST ; 9/21/91  9:26 PM
"RTN","DVBCLOG",2,0)
 ;;2.7;AMIE;**193**;Apr 10, 1995;Build 84
"RTN","DVBCLOG",3,0)
 ;
"RTN","DVBCLOG",4,0)
 I '$D(DUZ(2)) W *7,!!,"Your division number is missing.",!! H 3 G EXIT
"RTN","DVBCLOG",5,0)
 I $D(DUZ)#2=0 W !!,*7,"Your user number is invalid." H 3 G EXIT
"RTN","DVBCLOG",6,0)
 I +DUZ(2)<1 W !!,*7,"Invalid division",!! H 3 G EXIT
"RTN","DVBCLOG",7,0)
 ;
"RTN","DVBCLOG",8,0)
SETUP K ^TMP($J) D HOME^%ZIS S FF=IOF,HD="C & P Request Entry for",HD1="C & P Request Veteran Selection",HD2="Exam selection"
"RTN","DVBCLOG",9,0)
 ;
"RTN","DVBCLOG",10,0)
EN D KILL W @FF,?(IOM-$L(HD1)\2),HD1,!!! D ^DVBCPATA I $D(OUT) K OUT G EXIT
"RTN","DVBCLOG",11,0)
 S %DT="TS",X="NOW" D ^%DT S CTIM=Y K X,Y,%DT
"RTN","DVBCLOG",12,0)
 I $D(EDIT) K EDIT W @IOF,!,HD1," continued ---",!!!!!!
"RTN","DVBCLOG",13,0)
 ;
"RTN","DVBCLOG",14,0)
WARD S WARD=$S($D(^DPT(DFN,.1)):$P(^(.1),U,1),1:"") I WARD]"" W *7,"Vet is an INPATIENT, on ward "_WARD,!,"Want to continue" S %=2 D YN^DICN I $D(DTOUT) G EXIT
"RTN","DVBCLOG",15,0)
 I $D(%Y),%Y["?" W !!,"Enter Y to proceed with the request or N to go",!,"back and re-select.",!! G WARD
"RTN","DVBCLOG",16,0)
 I $D(%),%'=1 G EN
"RTN","DVBCLOG",17,0)
 K DVBCNEW,DA,DD,DO,X,Y W !!
"RTN","DVBCLOG",18,0)
 S DIC="^DVB(396.3,",DIE=DIC,DIC(0)="EQLM",X=DFN,DLAYGO=396.3
"RTN","DVBCLOG",19,0)
 K OUT D HDR,^DVBCEEXM,DDIS^DVBCUTL2 K DIC("W") S X=DFN D DR,FILE^DICN K DLAYGO I $D(DTOUT) W *7,"   ... Timed out!  " H 1 W *7 S REQDA=+Y D DEL G EN
"RTN","DVBCLOG",20,0)
 I +Y<0 H 2 G EN ;deletions via ^ in file^dicn
"RTN","DVBCLOG",21,0)
 S (DA,REQDA)=+Y
"RTN","DVBCLOG",22,0)
 D:$P(^DVB(396.3,REQDA,0),"^",10)="E" INSUF^DVBCLOG2
"RTN","DVBCLOG",23,0)
 I $D(DVBAOUT) D DEL G EN
"RTN","DVBCLOG",24,0)
 ;
"RTN","DVBCLOG",25,0)
EDIT1 K ANS W !!,"Select action:",!!," Press [RETURN] to continue, or enter E to edit or X to cancel:  Continue// " R ANS:DTIME I '$T D DEL G EXIT
"RTN","DVBCLOG",26,0)
 I ANS[U W *7,!!,"""^"" NOT allowed here" G EDIT1
"RTN","DVBCLOG",27,0)
 I ANS["?" W !!,"[RETURN] will continue to exam selection, E will allow",!,"editing of what you have entered and X will DELETE",!,"the entire request" G EDIT1
"RTN","DVBCLOG",28,0)
 I ANS="E" K DVBAINRQ S:$P(^DVB(396.3,REQDA,0),"^",10)="E" DVBAINRQ="" W !?20,"(Edit) " H 1 S DA=REQDA,DIE="^DVB(396.3,",DR="9;10:10.2;29;21;24" D HDR,^DIE D:$P(^DVB(396.3,REQDA,0),"^",10)'="E"&($D(DVBAINRQ)) CLINSF^DVBCLOG2
"RTN","DVBCLOG",29,0)
 I ANS="E"&($D(DVBAINRQ)&($P(^DVB(396.3,REQDA,0),"^",10)="E")) DO
"RTN","DVBCLOG",30,0)
 .S DIR(0)="Y^AO",DIR("A")="Do you want to change the request this insufficient is linked to? "
"RTN","DVBCLOG",31,0)
 .S DIR("?")="Enter Yes to change the link and No to keep the current link",DIR("B")="NO" D ^DIR
"RTN","DVBCLOG",32,0)
 .I +Y=1 K DIR,Y D CLINSF^DVBCLOG2 S DA=REQDA D INSUF^DVBCLOG2
"RTN","DVBCLOG",33,0)
 I ANS="E"&('$D(DVBAINRQ)&($P(^DVB(396.3,REQDA,0),"^",10)="E")) D INSUF^DVBCLOG2
"RTN","DVBCLOG",34,0)
 I ANS="E",($D(DVBAOUT)) D DEL G EN
"RTN","DVBCLOG",35,0)
 I ANS="E" K DVBAINRQ G EDIT1
"RTN","DVBCLOG",36,0)
 I ANS="X" W !?20,"(Cancel) " D DEL K ANS G EN
"RTN","DVBCLOG",37,0)
 I ANS'?1"E"&(ANS'?1"X")&(ANS'?1"") W !!,*7,"Must be the RETURN key, X, or E " G EDIT1
"RTN","DVBCLOG",38,0)
 K DIC,DIE,ANS D ^DVBCLOGE I $D(OUT) K OUT D DEL
"RTN","DVBCLOG",39,0)
 I $D(DVBCLCKD) D DEL
"RTN","DVBCLOG",40,0)
 H 1 D KILL G EN
"RTN","DVBCLOG",41,0)
 ;
"RTN","DVBCLOG",42,0)
EXIT G KILL^DVBCUTIL
"RTN","DVBCLOG",43,0)
 ;
"RTN","DVBCLOG",44,0)
HDR W @FF,?(IOM-$L(HD)\2),HD,!!,"Veteran name: ",$P(PNAM,",",2,99)," ",$P(PNAM,",",1),?55,"SSN: ",SSN,!?53,"C-NUM: ",CNUM,!
"RTN","DVBCLOG",45,0)
 F LINE=1:1:IOM W "="
"RTN","DVBCLOG",46,0)
 W ! Q
"RTN","DVBCLOG",47,0)
 ;
"RTN","DVBCLOG",48,0)
DEL S DIK="^DVB(396.3,",DA=REQDA D ^DIK W !!,*7,"Request DELETED.",! K DIK,REQDA,DA S OUT=1 D CONTMES^DVBCUTL4 Q
"RTN","DVBCLOG",49,0)
 ;
"RTN","DVBCLOG",50,0)
KILL K %DT,CNUM,DFN,DIK,DR,DTA,DXCOD,DXNUM,EDIT,EX,ROUTLOC,EXMNM,EXMPT,PNAM,SSN,PCT,SC,REQDA,VX,JJ,X,%,^TMP($J),DA,DO,DD
"RTN","DVBCLOG",51,0)
 K Y,DVBCNEW,DIC,DIE,Y,DA,%Y,ADD1,ADD2,CITY,CNTY,CTIM,D0,DX,ELIG,INCMP,PRDSV,STATE,WARD,ZIP,DUOUT,DTOUT,DVBCLCKD,DVBAOUT,DVBADTOT
"RTN","DVBCLOG",52,0)
 Q
"RTN","DVBCLOG",53,0)
 ;
"RTN","DVBCLOG",54,0)
 ;AJF;Request Status conversion
"RTN","DVBCLOG",55,0)
DR S DIC("DR")="1////"_CTIM_";17////1"_";2////^S X=DUZ(2);3////^S X=DUZ;9;10;10.1;10.2;S %DT(0)=-DT;29;21;24" Q
"RTN","DVBCNTSC")
0^42^B13108259^B13019940
"RTN","DVBCNTSC",1,0)
DVBCNTSC ;ALB ISC/THM-REQUESTS NOT SCHEDULED IN THREE DAYS ; 9/28/91  8:13 AM
"RTN","DVBCNTSC",2,0)
 ;;2.7;AMIE;**2,19,193**;Apr 10, 1995;Build 84
"RTN","DVBCNTSC",3,0)
 ;;
"RTN","DVBCNTSC",4,0)
 D HOME^%ZIS S (PG,TOTAL)=0
"RTN","DVBCNTSC",5,0)
 S Y=DT X ^DD("DD") S DVBCDT(0)=Y D NOW^%DTC S DVBCNOW=% K %
"RTN","DVBCNTSC",6,0)
 G EN
"RTN","DVBCNTSC",7,0)
 ;
"RTN","DVBCNTSC",8,0)
PRINT S DTA=^DVB(396.3,DA,0),DFN=$P(DTA,U,1),DTRPT=$P(DTA,U,5)
"RTN","DVBCNTSC",9,0)
 ;AJF; Request Status Conversion
"RTN","DVBCNTSC",10,0)
 S RQSTAT=$$RSTAT^DVBCUTL8($P(DTA,U,18)),REQCA=$P(DTA,U,19) Q:(RQSTAT["X"!(REQCA'=""))  ;cancelled requests
"RTN","DVBCNTSC",11,0)
 S Y=DTRPT X ^DD("DD") S DTRPT2=Y,RO=$P(DTA,U,3),RO=$S($D(^DIC(4,+RO,0)):$P(^(0),U,1),1:"Unknown RO"),DTSCH=$P(DTA,U,6),Y=DTSCH X ^DD("DD") S DTSCH2=Y K DTA
"RTN","DVBCNTSC",12,0)
 S DAYS=0 I DTSCH="" S X1=DVBCNOW,X2=DTRPT D ^%DTC Q:X'>3  S DAYS=X
"RTN","DVBCNTSC",13,0)
 I DTSCH]"" S X1=DTSCH,X2=DTRPT D ^%DTC Q:X'>3  S DAYS=X
"RTN","DVBCNTSC",14,0)
 W PNAM,?33,^TMP($J,RQDT,PNAM,DA),?45,DTRPT2,?69,DTSCH2,?93,RO,?119,DAYS,! S TOTAL=TOTAL+1 I $Y>55 D HDR
"RTN","DVBCNTSC",15,0)
 Q
"RTN","DVBCNTSC",16,0)
 ;
"RTN","DVBCNTSC",17,0)
EN W @IOF,"2507 Exams Not Scheduled Within Three Days",!!!
"RTN","DVBCNTSC",18,0)
 S %DT(0)=-DT,%DT="AE",%DT("A")="Enter STARTING DATE REPORTED TO MAS: " D ^%DT G:Y<0 EXIT S SDATE2=Y,SDATE=Y-.5
"RTN","DVBCNTSC",19,0)
 S %DT("A")="    and ENDING DATE REPORTED TO MAS: " D ^%DT G:Y<0 EXIT S EDATE2=Y,EDATE=Y+.2359
"RTN","DVBCNTSC",20,0)
 K %DT S HD="2507 Requests Not Scheduled in Three Days at "_$$SITE^DVBCUTL4,HD2="From " S Y=$E(SDATE2,1,7) X ^DD("DD") S HD2=HD2_Y S Y=$E(EDATE2,1,7) X ^DD("DD") S HD2=HD2_" to "_Y
"RTN","DVBCNTSC",21,0)
 ;
"RTN","DVBCNTSC",22,0)
DEV W !! S %ZIS="AEQ" D ^%ZIS G:POP EXIT
"RTN","DVBCNTSC",23,0)
 I IOM<132 W *7,!!,"A right margin of 132 is required for this output!",!! G DEV
"RTN","DVBCNTSC",24,0)
 I $D(IO("Q")) S ZTIO=ION,ZTRTN="GO^DVBCNTSC",ZTDESC="2507 exams not scheduled in 3 days" F I="TOTAL","PG","SDATE*","EDATE*","HD*","DVBC*" S ZTSAVE(I)=""
"RTN","DVBCNTSC",25,0)
 I  D ^%ZTLOAD W:$D(ZTSK) *7,!!,"Request queued.",!! G EXIT
"RTN","DVBCNTSC",26,0)
 ;
"RTN","DVBCNTSC",27,0)
GO K ^TMP($J) ;S X1=SDATE,X2=-7 D C^%DTC S SDATE=X ;allow for last month since using date reported
"RTN","DVBCNTSC",28,0)
 U IO D HDR F RQDT=SDATE:0 S RQDT=$O(^DVB(396.3,"C",RQDT)) Q:RQDT=""!(RQDT>EDATE)  F DA=0:0 S DA=$O(^DVB(396.3,"C",RQDT,DA)) Q:DA=""  S X=$P(^DVB(396.3,DA,0),U,5) I X'<SDATE,X'>EDATE D GO1
"RTN","DVBCNTSC",29,0)
 S PNAM="" F RQDT=0:0 S RQDT=$O(^TMP($J,RQDT)) Q:RQDT=""  F ZI=0:0 S PNAM=$O(^TMP($J,RQDT,PNAM)) Q:PNAM=""  F DA=0:0 S DA=$O(^TMP($J,RQDT,PNAM,DA)) Q:DA=""  D PRINT
"RTN","DVBCNTSC",30,0)
 W !!,"Total requests: ",TOTAL,!!
"RTN","DVBCNTSC",31,0)
 ;
"RTN","DVBCNTSC",32,0)
EXIT D:$D(ZTQUEUED) KILL^%ZTLOAD K DTRPT,DTRPT2,REQCA G KILL^DVBCUTIL
"RTN","DVBCNTSC",33,0)
 ;
"RTN","DVBCNTSC",34,0)
GO1 ;request can be included only if at least one exam wasn't transferred out
"RTN","DVBCNTSC",35,0)
 S TFIND=0,COUNT=0
"RTN","DVBCNTSC",36,0)
 F XI=0:0 S XI=$O(^DVB(396.4,"C",DA,XI)) Q:XI=""  D
"RTN","DVBCNTSC",37,0)
 .S COUNT=COUNT+1
"RTN","DVBCNTSC",38,0)
 .I $D(^DVB(396.4,XI,"TRAN")) S TFIND=TFIND+1
"RTN","DVBCNTSC",39,0)
 ;if TFIND=COUNT then all exams are transferred, so do not consider for report
"RTN","DVBCNTSC",40,0)
 I TFIND<COUNT D
"RTN","DVBCNTSC",41,0)
 .S DFN=$P(^DVB(396.3,DA,0),U,1)
"RTN","DVBCNTSC",42,0)
 .S NAME=$S($D(^DPT(DFN,0)):$P(^(0),U,1),1:"patient file record missing")
"RTN","DVBCNTSC",43,0)
 .S DVBCSSN=$S($D(^DPT(DFN,0)):$P(^(0),U,9),1:"")
"RTN","DVBCNTSC",44,0)
 .S ^TMP($J,$E(RQDT,1,7),NAME,DA)=DVBCSSN K DVBCSSN,DFN,NAME
"RTN","DVBCNTSC",45,0)
 Q
"RTN","DVBCNTSC",46,0)
 ;
"RTN","DVBCNTSC",47,0)
HDR S PG=PG+1 I (IOST?1"C-".E)!(PG>1) W @IOF
"RTN","DVBCNTSC",48,0)
 W DVBCDT(0),?(IOM-$L(HD)\2),HD,?(IOM-9),"Page: ",PG,!?(IOM-$L(HD2)\2),HD2,!!!
"RTN","DVBCNTSC",49,0)
 W "Veteran name",?33,"SSN",?45,"Date reported-MAS",?69,"Date scheduled",?93,"Requested by",?119,"Days",!
"RTN","DVBCNTSC",50,0)
 F LINE=1:1:IOM W "-"
"RTN","DVBCNTSC",51,0)
 W !! Q
"RTN","DVBCPND1")
0^10^B20124911^B23119648
"RTN","DVBCPND1",1,0)
DVBCPND1 ;ALB/GTS-557/THM,SBW-2507 PENDING REQUESTS, PART 2 ; 3/MAY/2011
"RTN","DVBCPND1",2,0)
 ;;2.7;AMIE;**17,168,193**;Apr 10, 1995;Build 84
"RTN","DVBCPND1",3,0)
 ;
"RTN","DVBCPND1",4,0)
NXT F DA(1)=0:0 S DA(1)=$O(^TMP($J,JX,PNAM,DFN,DA(1))) Q:DA(1)=""  D PRINT I $D(OUT) S DA(1)="",PNAM="ZZZZ",JX=$S($A(JX)>57:PNAM,1:999999)
"RTN","DVBCPND1",5,0)
 Q
"RTN","DVBCPND1",6,0)
 ;
"RTN","DVBCPND1",7,0)
SORT ; AJF;Request Status Conversion 
"RTN","DVBCPND1",8,0)
 S ST1=$P(^DVB(396.3,REQDA,0),U,18),STAT=$$RSTAT^DVBCUTL8(ST1)
"RTN","DVBCPND1",9,0)
 Q:"^R^X^RX^C^CT^RR^RA^"[(U_STAT_U)
"RTN","DVBCPND1",10,0)
 I DVBCSORT="S" Q:STAT'=RSTAT&(RSTAT'="A")
"RTN","DVBCPND1",11,0)
 S PNAM=$S($D(^DPT(DFN,0)):$P(^(0),U,1),1:"Unknown"),ROUT=$S($D(^DVB(396.3,REQDA,1)):$P(^(1),U,4),1:0),RDATE=$P(^(0),U,5)
"RTN","DVBCPND1",12,0)
 I DVBCSORT="V" S ^TMP($J,PNAM,DFN,REQDA)="" Q
"RTN","DVBCPND1",13,0)
 I DVBCSORT="S" S ^TMP($J,STAT,PNAM,DFN,REQDA)="" Q
"RTN","DVBCPND1",14,0)
 I DVBCSORT="R",$D(ADIVNUM),ROUT=ADIVNUM S ^TMP($J,ROUT,PNAM,DFN,REQDA)="" Q
"RTN","DVBCPND1",15,0)
 I DVBCSORT="A" D ELAPSED I EDAYS'<ERDAYS,EDAYS'>OLDAYS S ^TMP($J,EDAYS,PNAM,DFN,REQDA)=""
"RTN","DVBCPND1",16,0)
 Q
"RTN","DVBCPND1",17,0)
 ;
"RTN","DVBCPND1",18,0)
SETUP K ^TMP($J) S DVBCDT(0)=$$FMTE^XLFDT(DT,"5DZ"),PG=0
"RTN","DVBCPND1",19,0)
 S HEAD="Pending 2507 Requests for "_$S($D(^DVB(396.1,1,0)):$P(^(0),U,1),1:"Unknown site"),HEAD2="",PROCDT="Processed on: "_DVBCDT(0),NODATA=0 U IO D HEADER
"RTN","DVBCPND1",20,0)
 ;
"RTN","DVBCPND1",21,0)
DATA S DFN="" F J=0:0 S DFN=$O(^DVB(396.3,"B",DFN)) Q:DFN=""  F REQDA=0:0 S REQDA=$O(^DVB(396.3,"B",DFN,REQDA)) Q:REQDA=""  D SORT^DVBAB5
"RTN","DVBCPND1",22,0)
 I DVBCSORT="V" S PNAM="" F I=0:0 S PNAM=$O(^TMP($J,PNAM)) Q:PNAM=""  F DFN=0:0 S DFN=$O(^TMP($J,PNAM,DFN)) Q:DFN=""  F DA(1)=0:0 S DA(1)=$O(^TMP($J,PNAM,DFN,DA(1))) Q:DA(1)=""  D PRINT I $D(OUT) S DA(1)="",PNAM="ZZZ" Q
"RTN","DVBCPND1",23,0)
 I DVBCSORT="R"!(DVBCSORT="A") S PNAM="" F JX=-1:0 S JX=$O(^TMP($J,JX)) Q:JX=""  F I=0:0 S PNAM=$O(^TMP($J,JX,PNAM)) Q:PNAM=""  F DFN=0:0 S DFN=$O(^TMP($J,JX,PNAM,DFN)) Q:DFN=""  D NXT
"RTN","DVBCPND1",24,0)
 I DVBCSORT="S" S (PNAM,JX)="" F ZX=0:0 S JX=$O(^TMP($J,JX)) Q:JX=""  F I=0:0 S PNAM=$O(^TMP($J,JX,PNAM)) Q:PNAM=""  F DFN=0:0 S DFN=$O(^TMP($J,JX,PNAM,DFN)) Q:DFN=""  D NXT
"RTN","DVBCPND1",25,0)
 D:$Y>60 HEADER I DVBCCNT>0 W !!,"Total pending: ",DVBCCNT,!
"RTN","DVBCPND1",26,0)
 I IOST?1"C-".E W !!,"Press RETURN  " R ANS:DTIME
"RTN","DVBCPND1",27,0)
 ;
"RTN","DVBCPND1",28,0)
EXIT I NODATA=0 U IO W *7,!!!!!,"No pending requests found for selected parameters.",!! H 2
"RTN","DVBCPND1",29,0)
 ;
"RTN","DVBCPND1",30,0)
KILL D:$D(ZTQUEUED) KILL^%ZTLOAD K ANS,JX,DVBCHDR,^TMP($J),ZX,ADIV,ADIVNUM,CNUM,DA
"RTN","DVBCPND1",31,0)
 K DFN,DVBCCNT,DVBCHDR,DVBCSORT,ELTYP,ERDAYS,HEAD
"RTN","DVBCPND1",32,0)
 G KILL^DVBCUTIL
"RTN","DVBCPND1",33,0)
 ;
"RTN","DVBCPND1",34,0)
PRINT S ADIV=$S($D(^DVB(396.3,DA(1),1)):$P(^(1),U,4),1:"") Q:ADIV'=ADIVNUM&(DVBCSORT="R")  I ADIV]"" S ADIV=$S($D(^DG(40.8,+ADIV,0)):$P(^(0),U,1),1:"Unknown Division")
"RTN","DVBCPND1",35,0)
 S RDATE1=$P(^DVB(396.3,DA(1),0),U,2),RDATE=$P(^(0),U,5),SSN=$P(^DPT(DFN,0),U,9),CNUM=$S($D(^(.31)):$P(^(.31),U,3),1:"Unknown") D ELAPSED
"RTN","DVBCPND1",36,0)
 ;AJF;Conversion
"RTN","DVBCPND1",37,0)
 W !?10,"Division: "_ADIV,!?12,"Status: " S XX=$P(^DVB(396.3,DA(1),0),U,18)
"RTN","DVBCPND1",38,0)
 S STATUS=$$RTSTAT^DVBCUTL8(XX)
"RTN","DVBCPND1",39,0)
 S XX=$$RSTAT^DVBCUTL8(XX)
"RTN","DVBCPND1",40,0)
 W STATUS,!!,PNAM,?49,"SSN: ",SSN,!?44,"Claim no: ",CNUM,!?40,"Request date: ",$$FMTE^XLFDT(RDATE1,"5DZ"),!?40,"Elapsed days: ",EDAYS,!!
"RTN","DVBCPND1",41,0)
 S X=$S($D(^DVB(396.3,DA(1),4)):^(4),1:"")
"RTN","DVBCPND1",42,0)
 S OWNDOM=$P(^DVB(396.3,DA(1),0),U,22) I OWNDOM]"" W "Transferred in from ",$S($D(^DIC(4.2,+OWNDOM,0)):$P(^(0),U,1),1:"Unknown site"),!
"RTN","DVBCPND1",43,0)
 W !?5,"Exams requested:",!!
"RTN","DVBCPND1",44,0)
 ;
"RTN","DVBCPND1",45,0)
ITEMS ;
"RTN","DVBCPND1",46,0)
 N DVBPALL
"RTN","DVBCPND1",47,0)
 S DVBPALL=1
"RTN","DVBCPND1",48,0)
 D TST^DVBCUTL2 S NODATA=1,REQSTR=+$P(^DVB(396.3,DA(1),0),U,4)
"RTN","DVBCPND1",49,0)
 W !!,"Requested by: ",$S($D(^VA(200,+REQSTR,0)):$P(^(0),U,1),1:" (Not specified) ")," at "
"RTN","DVBCPND1",50,0)
 S RONAME=$P(^DVB(396.3,DA(1),0),U,3),RONAME=$S(RONAME]"":$P(^DIC(4,+RONAME,0),U,1),1:"") W $S(RONAME]"":RONAME,1:" (Not specified) "),! F L=1:1:79 W "-"
"RTN","DVBCPND1",51,0)
 S DVBCCNT=DVBCCNT+1 I IOST?1"C-".E K OUT W !!!,"Press RETURN to continue or ""^"" exit  " R ANS:DTIME S:'$T!(ANS=U) OUT=1 Q:$D(OUT)  D HEADER Q
"RTN","DVBCPND1",52,0)
 W ! I $Y>45 D HEADER
"RTN","DVBCPND1",53,0)
 Q
"RTN","DVBCPND1",54,0)
 ;
"RTN","DVBCPND1",55,0)
HEADER S PG=PG+1 W @IOF,!!
"RTN","DVBCPND1",56,0)
 W ?(80-$L(HEAD)\2),HEAD,?71,"Page: ",PG,!?(80-$L(DVBCHDR)\2),DVBCHDR,!! I HEAD2]"" W ?(80-$L(HEAD2)\2),HEAD2,!
"RTN","DVBCPND1",57,0)
 W ?(80-$L(PROCDT)\2),PROCDT,!?(80-$L(HEAD3)\2),HEAD3,! F LN=1:1:80 W "="
"RTN","DVBCPND1",58,0)
 W !!
"RTN","DVBCPND1",59,0)
 Q
"RTN","DVBCPND1",60,0)
 ;
"RTN","DVBCPND1",61,0)
ELAPSED K EDAYS,X1,X2,X S X1=DT,(X2,X)=RDATE D:ELTYP="C" ^%DTC D:ELTYP="W" ^XUWORKDY S EDAYS=X
"RTN","DVBCPNDR")
0^30^B23812225^B21488603
"RTN","DVBCPNDR",1,0)
DVBCPNDR ;ALB/GTS-557/THM-2507 PENDING REQUESTS, PART 1 ; 2/12/03 5:21pm
"RTN","DVBCPNDR",2,0)
 ;;2.7;AMIE;**51,193**;Apr 10, 1995;Build 84
"RTN","DVBCPNDR",3,0)
 ;
"RTN","DVBCPNDR",4,0)
 S DVBCCNT=0 D HOME^%ZIS W @IOF,"Pending 2507 Request Report",!!! K NOASK S ADIVNUM="",ADIV="",FF=IOF
"RTN","DVBCPNDR",5,0)
 ;
"RTN","DVBCPNDR",6,0)
ASK W !!,"Do you want to sort by:",!!?5,"(A)ge of request",!?5,"(S)tatus",!?5,"(V)eteran name",!?5,"(R)outing location",!!?5,"Selection:   V// " R DVBCSORT:DTIME G:'$T!(DVBCSORT=U) KILL^DVBCUTIL
"RTN","DVBCPNDR",7,0)
 S:DVBCSORT="r" DVBCSORT="R"
"RTN","DVBCPNDR",8,0)
 S:DVBCSORT="a" DVBCSORT="A"
"RTN","DVBCPNDR",9,0)
 S:DVBCSORT="s" DVBCSORT="S"
"RTN","DVBCPNDR",10,0)
 S:DVBCSORT="v" DVBCSORT="V"
"RTN","DVBCPNDR",11,0)
 I DVBCSORT'=""&("A^S^V^R"'[DVBCSORT) W !!,*7,"Answer must be A, S, V, or R.",!! H 3 W @IOF G ASK
"RTN","DVBCPNDR",12,0)
 W $S(DVBCSORT="V":"eteran name",DVBCSORT="":"Veteran name",DVBCSORT="A":"ge of request",DVBCSORT="S":"tatus",DVBCSORT="R":"outing location",1:"") I DVBCSORT="" S DVBCSORT="V"
"RTN","DVBCPNDR",13,0)
 S DVBCHDR=$S(DVBCSORT="V":"Veteran name",DVBCSORT="R":"Routing location",DVBCSORT="S":"Status",DVBCSORT="A":"Age of request",1:"Unknown"),DVBCHDR="Sorted by "_DVBCHDR
"RTN","DVBCPNDR",14,0)
 ;
"RTN","DVBCPNDR",15,0)
 ; Added Re-Routed Status ; patch 193
"RTN","DVBCPNDR",16,0)
SSORT H 1 I DVBCSORT="S" W @IOF,"Status selection:",!!!!,"Select STATUS (enter A for all): P// " R RSTAT:DTIME G:'$T!(RSTAT=U) KILL^DVBCUTIL I RSTAT="" S RSTAT="P" W RSTAT
"RTN","DVBCPNDR",17,0)
 I DVBCSORT="S" S:RSTAT="n" RSTAT="N" S:RSTAT="t" RSTAT="T" S:RSTAT="p" RSTAT="P" S:RSTAT="a" RSTAT="A"
"RTN","DVBCPNDR",18,0)
 I DVBCSORT="S",RSTAT'?1"N",RSTAT'?1"RP",RSTAT'?1"NR",RSTAT'?1"P",RSTAT'?1"T",RSTAT'?1"A" W *7,!!,"Status must be N (new), P (pending), NR (New, Re-Routed), RP (Re-Routed, Pending Acceptance), T (transcribed) or A (all)" H 3 G SSORT
"RTN","DVBCPNDR",19,0)
 I DVBCSORT="S" W $S(RSTAT="P":"ending",RSTAT="NR":"New, Re-Routed",RSTAT="RP":"Re-Routed, Pending Acceptance",RSTAT="T":"ranscribed",RSTAT="N":"ew",RSTAT="A":"ll",1:"")
"RTN","DVBCPNDR",20,0)
 ;
"RTN","DVBCPNDR",21,0)
ESORT I DVBCSORT="A" W @IOF,!,"Age selection:",!!!?5,"Enter EARLIEST age: " R ERDAYS:DTIME G:'$T!(ERDAYS=U) KILL^DVBCUTIL
"RTN","DVBCPNDR",22,0)
 I DVBCSORT="A",(ERDAYS<1) W *7,!!,"Enter the shortest time span (in days) which 2507 processing has elapsed.",!,"Cannot be less than one day !",!,"If you want NEW requests (zero days), sort by status.",!! D CONTMES^DVBCUTL4 G ESORT
"RTN","DVBCPNDR",23,0)
 ;
"RTN","DVBCPNDR",24,0)
OSORT I DVBCSORT="A" W !?8," and OLDEST age: " R OLDAYS:DTIME G:'$T!(OLDAYS=U) KILL^DVBCUTIL
"RTN","DVBCPNDR",25,0)
 I DVBCSORT="A",(OLDAYS<1) W *7,!!,"Enter the longest time span (in days) which 2507 processing has elapsed.",!,"Cannot be less than 1 day",!! H 4 G OSORT
"RTN","DVBCPNDR",26,0)
 I DVBCSORT="A",ERDAYS>OLDAYS W *7,!!,"Earliest age must be less than oldest age",!! H 2 G ESORT
"RTN","DVBCPNDR",27,0)
 G CALWRK:DVBCSORT'="R" H 1 W @IOF,!,"Routing Location Selection:",!!! S DIC="^DG(40.8,",DIC(0)="AEQM",DIC("A")="Enter MEDICAL CENTER DIVISION: " D ^DIC G:X=""!(X=U) KILL^DVBCUTIL S ADIVNUM=+Y I ADIVNUM<0 G KILL^DVBCUTIL
"RTN","DVBCPNDR",28,0)
 ;
"RTN","DVBCPNDR",29,0)
CALWRK W !!,"Do you want elapsed time reported",!," in (C)alender days or (W)ork days?  C// " R ELTYP:DTIME I '$T!(ELTYP=U) G KILL^DVBCUTIL
"RTN","DVBCPNDR",30,0)
 S:ELTYP="c" ELTYP="C"
"RTN","DVBCPNDR",31,0)
 S:ELTYP="w" ELTYP="W"
"RTN","DVBCPNDR",32,0)
 I ELTYP'?1"W"&(ELTYP'?1"C")&(ELTYP'="") W !!,*7,"Must be C for Calendar, W for Workdays",!,"or simply press RETURN to accept the default.",!! H 2 G CALWRK
"RTN","DVBCPNDR",33,0)
 W $S(ELTYP="":"Calendar",ELTYP="C":"alendar",ELTYP="W":"ork",1:"Unknown")_" days" I ELTYP="" S ELTYP="C"
"RTN","DVBCPNDR",34,0)
 S HEAD3="(Elapsed time in "_$S(ELTYP="C":"Calendar",ELTYP="W":"Work",1:"Unknown")_" days)"
"RTN","DVBCPNDR",35,0)
 ;
"RTN","DVBCPNDR",36,0)
DEV W !! S %ZIS="AEQ",%ZIS("A")="Printing device: " D ^%ZIS K %ZIS G:POP KILL^DVBCUTIL
"RTN","DVBCPNDR",37,0)
 I $D(IO("Q")) S ZTRTN="SETUP^DVBCPND1",ZTIO=ION,ZTDESC="2507 PENDING REPORT",NOASK=1 F I="STAT","RSTAT","DVBC*","HEAD*","ELTYP","CMPDIV","ERDAYS","OLDAYS","ADIVNUM","ADIV","NOASK","DUZ" S ZTSAVE(I)=""
"RTN","DVBCPNDR",38,0)
 I  D ^%ZTLOAD W:$D(ZTSK) !!,"Request queued.",!! H 1 G KILL^DVBCUTIL
"RTN","DVBCPNDR",39,0)
 G SETUP^DVBCPND1
"RTN","DVBCPRN1")
0^33^B19322619^B19169531
"RTN","DVBCPRN1",1,0)
DVBCPRN1 ;ALB/GTS-557/THM-C&P FINAL REPORT PRINT ; 9/3/91  8:05 AM
"RTN","DVBCPRN1",2,0)
 ;;2.7;AMIE;**31,193**;Apr 10, 1995;Build 84
"RTN","DVBCPRN1",3,0)
 ;
"RTN","DVBCPRN1",4,0)
PHYS S PHYS=$S($D(^DVB(396.4,DA,0)):$P(^(0),U,7),1:"")
"RTN","DVBCPRN1",5,0)
 Q
"RTN","DVBCPRN1",6,0)
 ;
"RTN","DVBCPRN1",7,0)
STEP2A S EXMNM=$S($D(^DVB(396.6,JI,0)):$P(^(0),U,1),1:"Unknown exam") I $D(AUTO),$D(XEXMNM),EXMNM'=XEXMNM Q  ;print one exam on transcription
"RTN","DVBCPRN1",8,0)
 S EXHD="For "_EXMNM_" Exam" D HDR W "Examining provider: ",PHYS,!,"Examined on: " S Y=$P(^DVB(396.4,DA,0),U,6) X XDD W Y,! F LINE=1:1:80 W "="
"RTN","DVBCPRN1",9,0)
 W !!?2,"Examination results:",!! K NCN S EXSTAT=$P(^DVB(396.4,DA,0),U,4) I EXSTAT="X"!(EXSTAT="RX") W !!!!!?25,"This exam was CANCELLED by ",$S(EXSTAT="RX":"the RO.",1:"MAS."),!! Q
"RTN","DVBCPRN1",10,0)
 D STEP3
"RTN","DVBCPRN1",11,0)
 Q
"RTN","DVBCPRN1",12,0)
 ;
"RTN","DVBCPRN1",13,0)
STEP2 F DA=0:0 S DA=$O(^DVB(396.4,"C",DA(1),DA)) Q:DA=""  S RO=+$P(^DVB(396.3,DA(1),0),U,3) Q:'$D(AUTO)&(DUZ(2)'=RO)  S PG=0,JI=$P(^DVB(396.4,DA,0),U,3) D PHYS,STEP2A I $D(PRINT) D BOT K PRINT
"RTN","DVBCPRN1",14,0)
 ;AJF;Request Status conversion
"RTN","DVBCPRN1",15,0)
 I '$D(AUTO) S %DT="TS",X="NOW" D ^%DT S DA=DA(1),CTIM=Y,DR="6////"_CTIM_";15////"_CTIM_";16////^S X=DUZ;17////5",DIE="^DVB(396.3,",DIC=DIE D ^DIE
"RTN","DVBCPRN1",16,0)
 Q
"RTN","DVBCPRN1",17,0)
 ;
"RTN","DVBCPRN1",18,0)
STEP3 K ^UTILITY($J,"W") S DIWL=1,DIWR=80,DIWF="NW" S OLDA=DA,OLDA1=DA(1)
"RTN","DVBCPRN1",19,0)
 F LINE=0:0 S LINE=$O(^DVB(396.4,OLDA,"RES",LINE)) Q:LINE=""  S X=^DVB(396.4,OLDA,"RES",LINE,0) D ^DIWP,STEP3A
"RTN","DVBCPRN1",20,0)
 D ^DIWW S PRINT=1 S DA=OLDA,DA(1)=OLDA1 Q
"RTN","DVBCPRN1",21,0)
 ;
"RTN","DVBCPRN1",22,0)
STEP3A I $Y>(IOSL-11) D UP,NEXT,HDR W:$O(^DVB(396.4,OLDA,"RES",LINE))]"" !!,"Exam Results Continued",!!
"RTN","DVBCPRN1",23,0)
 Q
"RTN","DVBCPRN1",24,0)
 ;
"RTN","DVBCPRN1",25,0)
HDR S PG=PG+1 I PG>1 D HDR2^DVBCUTL2 Q
"RTN","DVBCPRN1",26,0)
 S:ZPR'="E" TOTTIME=$$PROCDAY^DVBCUTL2(DA(1))
"RTN","DVBCPRN1",27,0)
 S:ZPR="E" TOTTIME=$$INSFTME^DVBCUTA1(DA(1))
"RTN","DVBCPRN1",28,0)
 S OUTTIME="Processing time: "_TOTTIME
"RTN","DVBCPRN1",29,0)
 W @IOF
"RTN","DVBCPRN1",30,0)
 W !,"Date: ",DVBCDT(0),?(80-$L(PGHD)\2),PGHD,?71,"Page: ",PG,!?(80-$L(DVBCSITE)\2),DVBCSITE,!
"RTN","DVBCPRN1",31,0)
 W ?35,"** FINAL **",! W ?(80-$L(OUTTIME)\2),OUTTIME,!?(80-$L(EXHD)\2),EXHD,! F LNE=1:1:80 W "="
"RTN","DVBCPRN1",32,0)
 K LNE S:EXHD["AGENT ORANGE" DVBCAO=1 I EXHD'["AGENT ORANGE" K DVBCAO
"RTN","DVBCPRN1",33,0)
 D SSNOUT^DVBCUTIL
"RTN","DVBCPRN1",34,0)
 W !!?2,"Name: ",PNAM,?56,"SSN: ",DVBCSSNO,!?51,"C-Number: ",CNUM,!?56,"DOB: " S Y=DOB X XDD W Y,!?2,"Address: ",ADR1,! W:ADR2]"" ?11,ADR2,! W:ADR3]"" ?11,ADR3,!!
"RTN","DVBCPRN1",35,0)
 K DVBCSSNO
"RTN","DVBCPRN1",36,0)
 W !?2,"City,State,Zip+4: ",?48,"Res Phone: ",HOMPHON,!?5,CITY,"  ",STATE,"  ",ZIP,?48,"Bus Phone: ",BUSPHON,!
"RTN","DVBCPRN1",37,0)
 W !,"Entered active service: " S Y=EOD X XDD S:Y="" Y="Not specified" W Y,?40,"Last rating exam date: ",LREXMDT,! S Y=RAD X XDD S:Y="" Y="Not specified" W "Released active service: " W Y,!!,"Priority of exam: ",PRIO,!
"RTN","DVBCPRN1",38,0)
 F LNE=1:1:80 W "="
"RTN","DVBCPRN1",39,0)
 W ! Q
"RTN","DVBCPRN1",40,0)
 ;
"RTN","DVBCPRN1",41,0)
ZTSK S PG=0,AUTO=1 K ULINE
"RTN","DVBCPRN1",42,0)
 ;$D(AUTO)=copy for review, Vet file after approval
"RTN","DVBCPRN1",43,0)
 I '$D(DT) S X="T" D ^%DT S DT=Y
"RTN","DVBCPRN1",44,0)
 S XDD=^DD("DD"),Y=DT X XDD S DVBCDT(0)=Y,PGHD="Compensation and Pension Exam Report",DVBCSITE=$S($D(^DVB(396.1,1,0)):$P(^(0),U,1),1:"Site name not in file")
"RTN","DVBCPRN1",45,0)
 S $P(ULINE,"_",70)="_",XEXMNM=EXMNM K EXMNM D VARS^DVBCUTIL,STEP2,BOT
"RTN","DVBCPRN1",46,0)
 I '$D(EDPRT) G KILL^DVBCUTIL
"RTN","DVBCPRN1",47,0)
 Q
"RTN","DVBCPRN1",48,0)
 ;
"RTN","DVBCPRN1",49,0)
UP F XIX=$Y:1:(IOSL-8) W !
"RTN","DVBCPRN1",50,0)
 Q
"RTN","DVBCPRN1",51,0)
 ;
"RTN","DVBCPRN1",52,0)
NEXT W !,"Continued on next page",!,"VA Form 2507"
"RTN","DVBCPRN1",53,0)
 Q
"RTN","DVBCPRN1",54,0)
 ;
"RTN","DVBCPRN1",55,0)
BOT I '$D(AUTO),$D(PRINT) D UP W ?7,"This exam has been reviewed and approved by the examining provider" W:$D(DVBCAO) !?27,"and signed by the veteran" W ".",!!,"VA Form 2507",! ;if for RO
"RTN","DVBCPRN1",56,0)
 I $D(AUTO),$D(PRINT) D UP W ?7," Approved by: ___________________________________     Date: _____________",!!
"RTN","DVBCPRN1",57,0)
 I $D(AUTO),$D(PRINT) W "Provider signature: ___________________________________     Date: _____________",!!,"VA Form 2507",! ;if file copy
"RTN","DVBCPRN1",58,0)
 Q
"RTN","DVBCPRNT")
0^47^B15392745^B15307493
"RTN","DVBCPRNT",1,0)
DVBCPRNT ;ALB/GTS-557/THM-FINAL REPORT DRIVER ; 5/17/91  10:29 AM
"RTN","DVBCPRNT",2,0)
 ;;2.7;AMIE;**193**;Apr 10, 1995;Build 84
"RTN","DVBCPRNT",3,0)
 ;
"RTN","DVBCPRNT",4,0)
 I '$D(DUZ(2)) W *7,!!,"You DIVISION NUMBER is incorrect.",! H 2 Q
"RTN","DVBCPRNT",5,0)
 I DUZ(2)<1 W !,*7,"Your DIVISION NUMBER is invalid.",! H 2 Q
"RTN","DVBCPRNT",6,0)
 ;
"RTN","DVBCPRNT",7,0)
SETUP K EDPRT,ULINE S XDD=^DD("DD"),$P(ULINE,"_",70)="_" K AUTO
"RTN","DVBCPRNT",8,0)
 D HOME^%ZIS S FF=IOF,HD="C & P Exam Printing" W @IOF,!?(IOM-$L(HD)\2),HD,!!!
"RTN","DVBCPRNT",9,0)
 S Y=DT X XDD S DVBCDT(0)=Y,PGHD="Compensation and Pension Exam Report",DVBCSITE=$S($D(^DVB(396.1,1,0)):$P(^(0),U,1),1:"Not specified")
"RTN","DVBCPRNT",10,0)
 W !!,"Note:  All reports will be produced in 'terminal-digit' order.",!! H 1
"RTN","DVBCPRNT",11,0)
 ;
"RTN","DVBCPRNT",12,0)
DEVICE S %ZIS="AEQ",%ZIS("B")="0;P-OTHER",%ZIS("A")="Output device: " D ^%ZIS G:POP KILL^DVBCUTIL
"RTN","DVBCPRNT",13,0)
 I $D(IO("Q")) S ZTRTN="GO^DVBCPRNT",ZTIO=ION,ZTDESC="2507 Final Exam Report" F I="D*","XDD","ULINE","HD","FF","PGHD" S ZTSAVE(I)=""
"RTN","DVBCPRNT",14,0)
 I $D(IO("Q")) D ^%ZTLOAD W:$D(ZTSK) !!,"Request queued",!! K ZTSK G KILL^DVBCUTIL
"RTN","DVBCPRNT",15,0)
 ;
"RTN","DVBCPRNT",16,0)
GO D STM^DVBCUTL4
"RTN","DVBCPRNT",17,0)
 U IO K ^TMP($J) D HDA S (XCNT,XPRINT)=0
"RTN","DVBCPRNT",18,0)
 ;AJF;Request Status conversion
"RTN","DVBCPRNT",19,0)
 F DA(1)=0:0 S DA(1)=$O(^DVB(396.3,"AF",4,DUZ(2),DA(1))) Q:DA(1)=""  DO
"RTN","DVBCPRNT",20,0)
 .I $D(^DVB(396.3,DA(1),0)) D GO1 S XPRINT=1,XCNT=XCNT+1
"RTN","DVBCPRNT",21,0)
 .I '$D(^DVB(396.3,DA(1),0)) D BADXRF
"RTN","DVBCPRNT",22,0)
 I XPRINT=0 K XPRINT,XPG,XXLN W !!!!!?25,"Nothing to print",!! H 2 D:$D(ZTQUEUED) KILL^%ZTLOAD G KILL^DVBCUTIL
"RTN","DVBCPRNT",23,0)
 I XCNT>0,XPRINT=1 W !!,"Total requests to be printed: ",XCNT,!
"RTN","DVBCPRNT",24,0)
 K XCNT,XXLN,XPG,XPRINT,OUT
"RTN","DVBCPRNT",25,0)
 D SETLAB
"RTN","DVBCPRNT",26,0)
 S (XCN,PNAM)=""
"RTN","DVBCPRNT",27,0)
 F XCN=0:0 S XCN=$O(^TMP($J,XCN)) Q:XCN=""  F JJ=0:0 S PNAM=$O(^TMP($J,XCN,PNAM)) Q:PNAM=""  K PRINT F DA(1)=0:0 S DA(1)=$O(^TMP($J,XCN,PNAM,DA(1))) Q:DA(1)=""  S DA=DA(1) D VARS^DVBCUTIL,STEP2^DVBCPRN1 I '$D(AUTO) D ^DVBCLABR,LKILL^DVBCUTL3
"RTN","DVBCPRNT",28,0)
 S XRTN=$T(+0)
"RTN","DVBCPRNT",29,0)
 D SPM^DVBCUTL4
"RTN","DVBCPRNT",30,0)
 K DVBCN S LKILL=1 D:$D(ZTQUEUED) KILL^%ZTLOAD G KILL^DVBCUTIL
"RTN","DVBCPRNT",31,0)
 ;
"RTN","DVBCPRNT",32,0)
GO1 S DFN=$P(^DVB(396.3,DA(1),0),U,1),PNAM=$P(^DPT(DFN,0),U,1) W $E(PNAM,1,25),?28,$E($P(^(0),U,9),1,3)_" "_$E($P(^(0),U,9),4,5)_" "_$E($P(^(0),U,9),6,9)
"RTN","DVBCPRNT",33,0)
 S CNUM=$S($D(^DPT(DFN,.31)):$P(^(.31),U,3),1:"Missing") W ?43,CNUM,?55 S Y=$P(^DVB(396.3,DA(1),0),U,2) X XDD W Y,! D:$Y>(IOSL-16) HDA
"RTN","DVBCPRNT",34,0)
 S XCN=$E(CNUM,$L(CNUM)-1,$L(CNUM)),XCN=+XCN
"RTN","DVBCPRNT",35,0)
 I PNAM]"" S ^TMP($J,XCN,PNAM,DA(1))=""
"RTN","DVBCPRNT",36,0)
 K PNAM,XCN,CNUM
"RTN","DVBCPRNT",37,0)
 Q
"RTN","DVBCPRNT",38,0)
 ;
"RTN","DVBCPRNT",39,0)
SETLAB N XX S XX=1,DVBCRALC(XX)="^",Y=0
"RTN","DVBCPRNT",40,0)
 F  S Y=$O(^DVB(396.1,1,4,"B",Y)) Q:(Y="")  I $D(^SC(+Y,0)) S DVBCRALC(XX)=DVBCRALC(XX)_+Y_U I $L(DVBCRALC(XX))>230 S XX=XX+1,DVBCRALC(XX)="^"
"RTN","DVBCPRNT",41,0)
 Q
"RTN","DVBCPRNT",42,0)
 ;
"RTN","DVBCPRNT",43,0)
HDA S:'$D(XPG) XPG=0 S XPG=XPG+1
"RTN","DVBCPRNT",44,0)
 I (IOST?1"C-".E)!($D(DVBAON2)) W @IOF
"RTN","DVBCPRNT",45,0)
 S:('$D(DVBAON2)) DVBAON2=""
"RTN","DVBCPRNT",46,0)
 W !,"Final C&P Reports for print date " S Y=DT X XDD W Y,!!,"Operator: ",$S($D(^VA(200,+DUZ,0)):$P(^(0),U,1),1:"Unknown operator"),!,"Location: ",$S($D(^DIC(4,+DUZ(2),0)):$P(^(0),U,1),1:"Unknown location"),!
"RTN","DVBCPRNT",47,0)
 W !,"Veteran Name",?28,"SSN",?43,"C-Number",?55,"Request date",!
"RTN","DVBCPRNT",48,0)
 F XXLN=1:1:79 W "-"
"RTN","DVBCPRNT",49,0)
 W !!
"RTN","DVBCPRNT",50,0)
 Q
"RTN","DVBCPRNT",51,0)
 ;
"RTN","DVBCPRNT",52,0)
WARN W !!,*7,"Too many locations to store!  Some locations may not be reported.",!! H 3 S OUT=1
"RTN","DVBCPRNT",53,0)
 Q
"RTN","DVBCPRNT",54,0)
 ;
"RTN","DVBCPRNT",55,0)
BADXRF ; ** Display a message that a bad cross reference exists **
"RTN","DVBCPRNT",56,0)
 W !,"A bad 'D' X-Reference exists on the 2507 Request File (#396.3) for"
"RTN","DVBCPRNT",57,0)
 W " DA="_DA(1)_"."
"RTN","DVBCPRNT",58,0)
 W !,"Please notify IRM at the facility where you have created"
"RTN","DVBCPRNT",59,0)
 W " this report.",!!
"RTN","DVBCPRNT",60,0)
 Q
"RTN","DVBCPURG")
0^48^B3907504^B3914601
"RTN","DVBCPURG",1,0)
DVBCPURG ;ALB/GTS-557/THM-C&P PURGING PROGRAM ; 10/28/90  8:40 PM
"RTN","DVBCPURG",2,0)
 ;;2.7;AMIE;**48,193**;Apr 10, 1995;Build 84
"RTN","DVBCPURG",3,0)
 ;
"RTN","DVBCPURG",4,0)
 ;** Version Changes
"RTN","DVBCPURG",5,0)
 ;   2.7 - GTS/Coded to purge 396.95  (Enhc 13)
"RTN","DVBCPURG",6,0)
 ;   2.7 - JLU/Utilize the 2507 purge parameter
"RTN","DVBCPURG",7,0)
 ;
"RTN","DVBCPURG",8,0)
SETUP I '$D(DT) S X="T" D ^%DT S DT=Y
"RTN","DVBCPURG",9,0)
 S HIST=$$PAR()
"RTN","DVBCPURG",10,0)
 S X1=DT,X2=HIST,X2=-X2 D C^%DTC S PDATE=X
"RTN","DVBCPURG",11,0)
 ;
"RTN","DVBCPURG",12,0)
 ;AJF;Request Status conversion
"RTN","DVBCPURG",13,0)
GO F TYP=5,6,7,10 F REGOFF=0:0 S REGOFF=$O(^DVB(396.3,"AF",TYP,REGOFF)) Q:REGOFF=""  F REQDA=0:0 S REQDA=$O(^DVB(396.3,"AF",TYP,REGOFF,REQDA)) Q:REQDA=""  D KILL
"RTN","DVBCPURG",14,0)
 ;
"RTN","DVBCPURG",15,0)
EXIT K DIK,X,Y,REGOFF,DA,I,J,PDATE,X1,X2,HIST,%,%DT,%H,TYP,REQDA,EXMDA
"RTN","DVBCPURG",16,0)
 Q
"RTN","DVBCPURG",17,0)
 ;
"RTN","DVBCPURG",18,0)
KILL I '$D(^DVB(396.3,REQDA,0)) K ^DVB(396.3,"AF",TYP,REGOFF,REQDA)
"RTN","DVBCPURG",19,0)
 I '$D(^DVB(396.3,REQDA,0)) Q  ;clean up bad index records
"RTN","DVBCPURG",20,0)
 S X1=PDATE,RS0=^DVB(396.3,REQDA,0)
"RTN","DVBCPURG",21,0)
 ;AJF;Request Status conversion
"RTN","DVBCPURG",22,0)
 S X2=$S(TYP=6:$P(RS0,U,19),TYP=7:$P(RS0,U,19),1:$P(RS0,U,7))
"RTN","DVBCPURG",23,0)
 D ^%DTC I (+X>0),('$D(^DVB(396.3,"AORQ",REQDA))) D APPTLP,EXAMLP S DIK="^DVB(396.3,",DA=REQDA D ^DIK
"RTN","DVBCPURG",24,0)
 K DIK,DA,RS0
"RTN","DVBCPURG",25,0)
 Q
"RTN","DVBCPURG",26,0)
 ;
"RTN","DVBCPURG",27,0)
APPTLP ;  **  Loop through existing appointments  **
"RTN","DVBCPURG",28,0)
 N LPCNT
"RTN","DVBCPURG",29,0)
 S LPCNT=""
"RTN","DVBCPURG",30,0)
 F  S LPCNT=$O(^DVB(396.95,"AR",REQDA,LPCNT)) Q:LPCNT=""  DO
"RTN","DVBCPURG",31,0)
 .S DIK="^DVB(396.95,",DA=LPCNT D ^DIK K DA,DIK
"RTN","DVBCPURG",32,0)
 Q
"RTN","DVBCPURG",33,0)
 ;
"RTN","DVBCPURG",34,0)
EXAMLP ;  **  Loop through existing exams  **
"RTN","DVBCPURG",35,0)
 F EXMDA=0:0 S EXMDA=$O(^DVB(396.4,"C",REQDA,EXMDA)) Q:EXMDA=""  D KEXAMS
"RTN","DVBCPURG",36,0)
 Q
"RTN","DVBCPURG",37,0)
 ;
"RTN","DVBCPURG",38,0)
KEXAMS ;  ** Delete exams on the request  **
"RTN","DVBCPURG",39,0)
 S DA=EXMDA,DIK="^DVB(396.4," D ^DIK K DIK,DA
"RTN","DVBCPURG",40,0)
 Q
"RTN","DVBCPURG",41,0)
 ;
"RTN","DVBCPURG",42,0)
PAR() ;function call to get the number of days to retain the 2507 requests.
"RTN","DVBCPURG",43,0)
 ;
"RTN","DVBCPURG",44,0)
 N IFN,Y
"RTN","DVBCPURG",45,0)
 S IFN=$$IFNPAR^DVBAUTL3()
"RTN","DVBCPURG",46,0)
 I IFN DO
"RTN","DVBCPURG",47,0)
 .S Y=$P(^DVB(396.1,IFN,0),U,11)
"RTN","DVBCPURG",48,0)
 .I 'Y!(Y<120) S Y=99999
"RTN","DVBCPURG",49,0)
 I 'IFN S Y=99999
"RTN","DVBCPURG",50,0)
 Q Y
"RTN","DVBCREDT")
0^27^B24629709^B23640819
"RTN","DVBCREDT",1,0)
DVBCREDT ;ALB/GTS-557/THM-EDIT STATIC C&P INFO ; 11/20/90  6:29 AM
"RTN","DVBCREDT",2,0)
 ;;2.7;AMIE;**193**;Apr 10, 1995;Build 84
"RTN","DVBCREDT",3,0)
 ;
"RTN","DVBCREDT",4,0)
 ;**Note:  Priority E is Insufficient
"RTN","DVBCREDT",5,0)
 ;         Priority 'E is not insufficient
"RTN","DVBCREDT",6,0)
 ;
"RTN","DVBCREDT",7,0)
 K ^TMP("DVBCEDIT",$J) I $D(DUZ)#2=0 W !!,*7,"Your user number is invalid.",!! H 3 G EXIT
"RTN","DVBCREDT",8,0)
 S LN="EDIT C&P STATIC INFORMATION" D HOME^%ZIS S FF=IOF
"RTN","DVBCREDT",9,0)
 G EN1
"RTN","DVBCREDT",10,0)
 ;
"RTN","DVBCREDT",11,0)
COMPARE I '$D(^TMP("DVBCEDIT",$J,DA,2,I,0)) S DVBCMOD=1 Q
"RTN","DVBCREDT",12,0)
 I ^DVB(396.3,DA,2,I,0)'=^TMP("DVBCEDIT",$J,DA,2,I,0) S DVBCMOD=1 Q
"RTN","DVBCREDT",13,0)
 Q
"RTN","DVBCREDT",14,0)
 ;
"RTN","DVBCREDT",15,0)
EN1 W @IOF,!?(IOM-$L(LN)\2),LN,!!! S DIC="AE",DIC("A")="Enter VETERAN NAME: ",DIC="^DVB(396.3,",DIE=DIC,DIC(0)="AEQM" D ^DIC G:X=""!(X=U) EXIT S DA=+Y I DA<0 G EN1
"RTN","DVBCREDT",16,0)
 S STAT=$P(^DVB(396.3,DA,0),U,18)
"RTN","DVBCREDT",17,0)
 ;AJF; Request Status Conversion
"RTN","DVBCREDT",18,0)
 S STAT=$$RSTAT^DVBCUTL8(STAT)
"RTN","DVBCREDT",19,0)
 I STAT'="N"&(STAT'="P")&(STAT'="NR") W !!,"The status of this request is not NEW or NEW RE-ROUTED or PENDING, REPORTED.",!,"It cannot, therefore, be modified.",*7,!! S DVBCMOD=1 G CON
"RTN","DVBCREDT",20,0)
 F I=0:0 S I=$O(^DVB(396.3,DA,2,I)) Q:I=""  S ^TMP("DVBCEDIT",$J,DA,2,I,0)=^DVB(396.3,DA,2,I,0) ;save lines for compare
"RTN","DVBCREDT",21,0)
 ;
"RTN","DVBCREDT",22,0)
EDIT ;
"RTN","DVBCREDT",23,0)
 N DVBARQST,SAVEDA,ENTTOUT
"RTN","DVBCREDT",24,0)
 S DVBARQST=$P(^DVB(396.3,DA,0),U,10)
"RTN","DVBCREDT",25,0)
 S SAVEDA=DA
"RTN","DVBCREDT",26,0)
 W !! S DR="W @IOF,!!;9;10:10.2;24;29;21;W !!;23" D ^DIE
"RTN","DVBCREDT",27,0)
 S:$D(DTOUT) ENTTOUT=""
"RTN","DVBCREDT",28,0)
 ;
"RTN","DVBCREDT",29,0)
 ;**Priority E -> E
"RTN","DVBCREDT",30,0)
 I DVBARQST="E",($P(^DVB(396.3,DA,0),U,10)="E"&('$D(ENTTOUT))) DO
"RTN","DVBCREDT",31,0)
 .W !
"RTN","DVBCREDT",32,0)
 .N UPDT2507
"RTN","DVBCREDT",33,0)
 .K DTOUT,DUOUT
"RTN","DVBCREDT",34,0)
 .S DIR(0)="Y^AO",DIR("A")="Do you want to change the request this insufficient is linked to"
"RTN","DVBCREDT",35,0)
 .S DIR("?")="Enter Yes to change the link and No to keep the current link.",DIR("B")="NO" D ^DIR
"RTN","DVBCREDT",36,0)
 .S:+Y=1 UPDT2507=""
"RTN","DVBCREDT",37,0)
 .I $D(UPDT2507) DO
"RTN","DVBCREDT",38,0)
 ..K DIR,Y
"RTN","DVBCREDT",39,0)
 ..N REQDA S REQDA=SAVEDA
"RTN","DVBCREDT",40,0)
 ..S NODE5=""
"RTN","DVBCREDT",41,0)
 ..S:$D(^DVB(396.3,REQDA,5)) NODE5=^DVB(396.3,REQDA,5) ;**Save link node
"RTN","DVBCREDT",42,0)
 ..D CLINSF^DVBCLOG2 S DA=SAVEDA D INSUF^DVBCLOG2 ;*Update 2507 Link info
"RTN","DVBCREDT",43,0)
 ..I '$D(DVBAOUT),('$D(DUOUT)) D INSUFXM^DVBCUTA2 ;*Update exam info
"RTN","DVBCREDT",44,0)
 ..I $D(DVBAOUT)!($D(DUOUT)) D RESTLINK^DVBCUTA2 ;*Restore 2507 link
"RTN","DVBCREDT",45,0)
 ..K NODE5
"RTN","DVBCREDT",46,0)
 .I '$D(UPDT2507) DO  ;**Exam info update check
"RTN","DVBCREDT",47,0)
 ..W !
"RTN","DVBCREDT",48,0)
 ..N REQDA S REQDA=SAVEDA
"RTN","DVBCREDT",49,0)
 ..S NODE5=^DVB(396.3,REQDA,5) ;**Save the link info node
"RTN","DVBCREDT",50,0)
 ..D INSUFXM^DVBCUTA2 ;**Update exam info
"RTN","DVBCREDT",51,0)
 ..K XMEDT,NODE5
"RTN","DVBCREDT",52,0)
 .S DA=SAVEDA
"RTN","DVBCREDT",53,0)
 ;
"RTN","DVBCREDT",54,0)
 ;**Priority 'E -> E
"RTN","DVBCREDT",55,0)
 I DVBARQST'="E",($P(^DVB(396.3,DA,0),U,10)="E"&('$D(ENTTOUT))) DO
"RTN","DVBCREDT",56,0)
 .K DIR,Y
"RTN","DVBCREDT",57,0)
 .N REQDA,XMDA S REQDA=SAVEDA
"RTN","DVBCREDT",58,0)
 .D INSUF^DVBCLOG2 ;**Enter 2507 insuf link info
"RTN","DVBCREDT",59,0)
 .I '$D(DVBAOUT) DO  ;**Enter insuf info on exams
"RTN","DVBCREDT",60,0)
 ..N EXMNM,XMSTAT
"RTN","DVBCREDT",61,0)
 ..K DTOUT
"RTN","DVBCREDT",62,0)
 ..F XMDA=0:0 S XMDA=$O(^DVB(396.4,"C",REQDA,XMDA)) Q:(XMDA=""!($D(DTOUT)))  DO
"RTN","DVBCREDT",63,0)
 ...W @IOF
"RTN","DVBCREDT",64,0)
 ...D XMUPDT^DVBCUTA2 ;**Exam info
"RTN","DVBCREDT",65,0)
 ..S:$D(DTOUT) DVBAOUT="" K Y,^TMP($J,"NEW")
"RTN","DVBCREDT",66,0)
 .I $D(DVBAOUT) DO  ;**Restore priority info when time out
"RTN","DVBCREDT",67,0)
 ..N MSG,RESET,EXMCLR
"RTN","DVBCREDT",68,0)
 ..S (RESET,MSG,EXMCLR)=""
"RTN","DVBCREDT",69,0)
 ..D RESTORE
"RTN","DVBCREDT",70,0)
 .S DA=SAVEDA
"RTN","DVBCREDT",71,0)
 ;
"RTN","DVBCREDT",72,0)
 ;**Priority E -> 'E
"RTN","DVBCREDT",73,0)
 I DVBARQST="E",($P(^DVB(396.3,DA,0),U,10)'="E") DO
"RTN","DVBCREDT",74,0)
 .N REQDA,EXMCLR S REQDA=SAVEDA S EXMCLR=""
"RTN","DVBCREDT",75,0)
 .D RESTORE ;**Clear link and insuf info on exams
"RTN","DVBCREDT",76,0)
 .S DA=SAVEDA
"RTN","DVBCREDT",77,0)
 ;
"RTN","DVBCREDT",78,0)
 ;**If Timed out of information edit in DR string
"RTN","DVBCREDT",79,0)
 I $D(ENTTOUT) DO
"RTN","DVBCREDT",80,0)
 .I DVBARQST'="E",($P(^DVB(396.3,DA,0),U,10)="E") DO  ;**clear insf info
"RTN","DVBCREDT",81,0)
 ..N REQDA,MSG,RESET
"RTN","DVBCREDT",82,0)
 ..S REQDA=SAVEDA S (MSG,RESET)=""
"RTN","DVBCREDT",83,0)
 ..D RESTORE
"RTN","DVBCREDT",84,0)
 S DA=SAVEDA
"RTN","DVBCREDT",85,0)
 S DIE="^DVB(396.3,"
"RTN","DVBCREDT",86,0)
 I $P(^DVB(396.3,DA,0),U,2)[DT G CONK ;no check if entered today
"RTN","DVBCREDT",87,0)
 K DVBCMOD F I=0:0 S I=$O(^DVB(396.3,DA,2,I)) Q:I=""  D COMPARE Q:$D(DVBCMOD)
"RTN","DVBCREDT",88,0)
 I $D(DVBCMOD) S DR="23.5///NOW;23.6////^S X=DUZ" D ^DIE W @IOF,!!,*7,"Since you have modified the REMARKS section,",!,"a new copy of the request will be issued to the",!,"medical center tomorrow morning."
"RTN","DVBCREDT",89,0)
 ;
"RTN","DVBCREDT",90,0)
CON I $D(DVBCMOD) W !!,"Press RETURN to continue  " R ANS:DTIME G:'$T!(ANS=U) EXIT
"RTN","DVBCREDT",91,0)
CONK K I,DVBCMOD,DIC,DA,DIE,X,Y G EN1
"RTN","DVBCREDT",92,0)
 ;
"RTN","DVBCREDT",93,0)
EXIT K ^TMP("DVBCEDIT",$J),ANS,DVBAOUT,FF,LN,STAT G KILL^DVBCUTIL
"RTN","DVBCREDT",94,0)
 ;
"RTN","DVBCREDT",95,0)
RESTORE ;** Remove insufficient info from 2507
"RTN","DVBCREDT",96,0)
 K DIE,DA,DR
"RTN","DVBCREDT",97,0)
 D CLINSF^DVBCLOG2 ;**Clear 2507 info
"RTN","DVBCREDT",98,0)
 I $D(RESET) DO  ;**Reset Priority
"RTN","DVBCREDT",99,0)
 .S DA=REQDA,DR="9////^S X=DVBARQST",DIE="^DVB(396.3,"
"RTN","DVBCREDT",100,0)
 .D ^DIE K DA,DR,DIE
"RTN","DVBCREDT",101,0)
 I $D(EXMCLR) DO  ;**Clear exam info
"RTN","DVBCREDT",102,0)
 .F XMDA=0:0 S XMDA=$O(^DVB(396.4,"C",REQDA,XMDA)) Q:(XMDA="")  DO
"RTN","DVBCREDT",103,0)
 ..K DA,DR,DIE
"RTN","DVBCREDT",104,0)
 ..S DA=XMDA,DR=".11////@;.12///@;80///@",DIE="^DVB(396.4,"
"RTN","DVBCREDT",105,0)
 ..D ^DIE
"RTN","DVBCREDT",106,0)
 .K DA,DR,DIE
"RTN","DVBCREDT",107,0)
 I $D(MSG) DO  ;**Output message
"RTN","DVBCREDT",108,0)
 .S TVAR(1,0)="1,3,0,2:1,0^Insufficient link info not updated!...Priority restored"
"RTN","DVBCREDT",109,0)
 .D WR^DVBAUTL4("TVAR")
"RTN","DVBCREDT",110,0)
 .K TVAR
"RTN","DVBCREDT",111,0)
 .D CONTMES^DVBCUTL4
"RTN","DVBCREDT",112,0)
 Q
"RTN","DVBCRELS")
0^35^B16510562^B16425320
"RTN","DVBCRELS",1,0)
DVBCRELS ;ALB/GTS-557/THM-RELEASE 2507 REQUEST TO RO ; 5/27/91  4:54 PM
"RTN","DVBCRELS",2,0)
 ;;2.7;AMIE;**83,193**;Apr 10, 1995;Build 84
"RTN","DVBCRELS",3,0)
 ;
"RTN","DVBCRELS",4,0)
 I $D(DUZ)#2=0 W *7,!!,"Invalid user number (DUZ)",!! H 3 Q
"RTN","DVBCRELS",5,0)
 I '$D(^XUSEC("DVBA C RELEASE 2507",DUZ)) W *7,!!,"You are not authorized to release 2507 requests!!",!! H 3 Q
"RTN","DVBCRELS",6,0)
 G EN
"RTN","DVBCRELS",7,0)
 ;
"RTN","DVBCRELS",8,0)
EXAM S EXAM=$P(^DVB(396.4,DA,0),U,3),EXAM=$P(^DVB(396.6,+EXAM,0),U,1)
"RTN","DVBCRELS",9,0)
 S STAT=$P(^DVB(396.4,DA,0),U,4)
"RTN","DVBCRELS",10,0)
 I STAT'="C"&(STAT'["X") S NFINAL=1 W !,EXAM," is not complete " W:STAT="T" " (transferred)"
"RTN","DVBCRELS",11,0)
 Q
"RTN","DVBCRELS",12,0)
 ;
"RTN","DVBCRELS",13,0)
EN D HOME^%ZIS S FF=IOF,HD="Veteran Selection",HD2="2507 Exam Release"
"RTN","DVBCRELS",14,0)
 ;
"RTN","DVBCRELS",15,0)
LOOK D KILL W @FF,!?(IOM-$L(HD)\2),HD,!?(IOM-$L(HD2)\2),HD2,!!!
"RTN","DVBCRELS",16,0)
 S DIC("W")="D DICW^DVBCUTIL" S DIC="^DVB(396.3,",DIC(0)="AEQM",DIC("A")="Select VETERAN: " D ^DIC G:X=""!(X=U) EXIT I +Y<0 W *7,"  ???" G LOOK
"RTN","DVBCRELS",17,0)
 ;AJF;Request Status conversion
"RTN","DVBCRELS",18,0)
 S STAT=$$RSTAT^DVBCUTL8($P(^DVB(396.3,+Y,0),U,18)) D STATCHK G:$D(NCN) LOOK
"RTN","DVBCRELS",19,0)
 S REQDA=+Y,DFN=+$P(Y,U,2),REQDT=$P(^DVB(396.3,REQDA,0),U,2)
"RTN","DVBCRELS",20,0)
 S (PNAM,SSN)="Unknown" I $D(^DPT(DFN,0)) S PNAM=$P(^(0),U,1),SSN=$P(^(0),U,9)
"RTN","DVBCRELS",21,0)
 S CNUM=$S($D(^DPT(DFN,.31)):$P(^(.31),U,3),1:"Unknown") K DICW
"RTN","DVBCRELS",22,0)
 S STAT=$$RSTAT^DVBCUTL8($P(^DVB(396.3,+Y,0),U,18)) D STATCHK I $D(NCN) K NCN G LOOK
"RTN","DVBCRELS",23,0)
 W !!,"Please wait while the individual exam statuses are checked.  " H 1 W !
"RTN","DVBCRELS",24,0)
 ;
"RTN","DVBCRELS",25,0)
DATA S NFINAL=0 F DA=0:0 S DA=$O(^DVB(396.4,"C",REQDA,DA)) Q:DA=""  D EXAM
"RTN","DVBCRELS",26,0)
 I NFINAL=0 W !!,"All exams have been completed, please enter the following:",!!
"RTN","DVBCRELS",27,0)
 I NFINAL=1 W *7,!!,"Since there are still incomplete exams,",!,"  this request cannot be released to the RO.  " W !!,"Press RETURN or ""^"" to exit  " R ANS:DTIME G:'$T!(ANS=U) EXIT G LOOK
"RTN","DVBCRELS",28,0)
 S DVBOTH=$P(^DVB(396.3,REQDA,1),U,3),DVBABY=$P(^(1),U,5),DVBDTA=$P(^(1),U,6)
"RTN","DVBCRELS",29,0)
 S:DVBABY="" DVBABY="@" S:DVBDTA="" DVBDTA="@"
"RTN","DVBCRELS",30,0)
 I NFINAL=0 K DR S CTIM=$$NOW^XLFDT,DA=REQDA,DIE="^DVB(396.3,",DR="12////"_CTIM_";13////"_CTIM_";14////^S X=DUZ;17////4;W *7;22;25R;26R" D ^DIE K CTIM
"RTN","DVBCRELS",31,0)
 I '$D(Y),NFINAL=0 W !!,"This request is now released.",!! H 2
"RTN","DVBCRELS",32,0)
 I '$D(Y),$P(^DVB(396.3,REQDA,0),U,22)]"",$P(^(0),U,22)'=$P(^XMB(1,1,0),U,1) D ^DVBCXFRE K DIC,DIE,DR,DA S FAX="Y",RSTAT="CT" G FX ;transfers
"RTN","DVBCRELS",33,0)
 ;set back to transcribed if error or not completed
"RTN","DVBCRELS",34,0)
 ;AJF;Request Status conversion
"RTN","DVBCRELS",35,0)
 I $D(Y) W *7,!!,"Release NOT COMPLETED !!",!! H 2 S DR="6///@;12///@;13///@;14///@;17////8;25////"_DVBABY_";26////"_DVBDTA,DIE="^DVB(396.3,",DA=REQDA,DIC=DIE,$P(^DVB(396.3,REQDA,1),U,3)=DVBOTH D ^DIE G LOOK
"RTN","DVBCRELS",36,0)
 S FAX=$S($D(^DVB(396.3,REQDA,1)):$P(^(1),U,3),1:"N"),RSTAT="C"
"RTN","DVBCRELS",37,0)
 ;
"RTN","DVBCRELS",38,0)
FX ;if to be faxed or transferred out, set like RO has printed it
"RTN","DVBCRELS",39,0)
 ;AJF;Request Status conversion
"RTN","DVBCRELS",40,0)
 I FAX="Y" K DR S CTIM=$$NOW^XLFDT,DR="6////"_CTIM_";15////"_CTIM_";16////^S X=DUZ;17///"_RSTAT S (DIE,DIC)="^DVB(396.3,",DA=REQDA D ^DIE
"RTN","DVBCRELS",41,0)
 G LOOK
"RTN","DVBCRELS",42,0)
 ;
"RTN","DVBCRELS",43,0)
EXIT G KILL^DVBCUTIL
"RTN","DVBCRELS",44,0)
 ;
"RTN","DVBCRELS",45,0)
KILL K CNUM,SSN,PNAM,FAX,CTIM,DIC,DA,D0,D1,DFN,X,Y,NCN,STAT,%,NOFND,NFINAL,REQDA,STAT,RSTAT,DVBDTA,DVBOTH,DVBABY
"RTN","DVBCRELS",46,0)
 Q
"RTN","DVBCRELS",47,0)
 ;
"RTN","DVBCRELS",48,0)
STATCHK I STAT="RX" W *7,!!,"This request has been cancelled by the RO.",!! H 2 S NCN=1 Q
"RTN","DVBCRELS",49,0)
 I STAT="CT" W *7,!!,"This request has been completed and transferred out.",!! H 2 S NCN=1 Q
"RTN","DVBCRELS",50,0)
 I STAT="X" W *7,!!,"This request has been cancelled by MAS.",!! H 2 S NCN=1 Q
"RTN","DVBCRELS",51,0)
 I STAT="R" W *7,!!,"This request has been released to the RO.",!! H 2 S NCN=1 Q
"RTN","DVBCRELS",52,0)
 I STAT="C" W *7,!!,"This request has been printed by the RO.",!! H 2 S NCN=1 Q
"RTN","DVBCRELS",53,0)
 I STAT="N"!(STAT="NT") W *7,!!,"This request is new and has not yet been reported to MAS.",!! H 2 S NCN=1
"RTN","DVBCRELS",54,0)
 Q
"RTN","DVBCREQ3")
0^54^B2435535^B3240101
"RTN","DVBCREQ3",1,0)
DVBCREQ3 ;ALB/GTS-557/THM-NEW REQUESTS RECAP SHEET ; 6/18/91  1:23 PM
"RTN","DVBCREQ3",2,0)
 ;;2.7;AMIE;**193**;Apr 10, 1995;Build 84
"RTN","DVBCREQ3",3,0)
 ;
"RTN","DVBCREQ3",4,0)
EN S P1=0,PG=0,$P(PLINE,"-",75)="-" D HDR
"RTN","DVBCREQ3",5,0)
 ;
"RTN","DVBCREQ3",6,0)
 ;AJF ; Adding REROUTED Request to Recap Sheet;
"RTN","DVBCREQ3",7,0)
RECAP F X="NEW","MODIFIED","ADDITIONAL","REROUTED" S P1=P1+1 D
"RTN","DVBCREQ3",8,0)
 .W !!,X,$S(P1=3:" exams",1:" requests"),":",!! S (PNAM,SSN)=""
"RTN","DVBCREQ3",9,0)
 .F SM=1:1 S PNAM=$O(^TMP($J,X,PNAM)) Q:PNAM=""  D
"RTN","DVBCREQ3",10,0)
 ..F SN=0:0 S SSN=$O(^TMP($J,X,PNAM,SSN)) Q:SSN=""  D RECAP1
"RTN","DVBCREQ3",11,0)
 I IOST?1"C-".E D TERM^DVBCUTL3
"RTN","DVBCREQ3",12,0)
 ;
"RTN","DVBCREQ3",13,0)
EXIT K P1,COL,SM,SN,PNAM,SSN,CNUM,CN,PG,PLINE,X,^TMP($J),DVBCSSNO Q
"RTN","DVBCREQ3",14,0)
 ;
"RTN","DVBCREQ3",15,0)
RECAP1 F CN=0:0 S CNUM=$O(^TMP($J,X,PNAM,SSN,CNUM)) Q:CNUM=""  S COL=$S(SM>9:0,1:1) D SSNOUT^DVBCUTIL W ?COL,SM,". ",PNAM,?40,DVBCSSNO,?63,CNUM,! I $Y>55 W @IOF,!
"RTN","DVBCREQ3",16,0)
 Q
"RTN","DVBCREQ3",17,0)
 ;
"RTN","DVBCREQ3",18,0)
HDR S PG=PG+1 W @IOF,!,"New Request Recap Sheet for Run Date ",DVBCDT(0),?63,"Page: ",PG,!!!
"RTN","DVBCREQ3",19,0)
 W ?1,"Veteran Name",?40,"S S #",?63,"C-Number",!,PLINE,!
"RTN","DVBCREQ3",20,0)
 Q
"RTN","DVBCREQP")
0^9^B25484562^B20787575
"RTN","DVBCREQP",1,0)
DVBCREQP ;ALB/GTS-557/THM-PRINT NEW REQUESTS ; 6/27/91  9:36 AM
"RTN","DVBCREQP",2,0)
 ;;2.7;AMIE;**193**;;Build 84
"RTN","DVBCREQP",3,0)
 S DVBAMAN="" G EN
"RTN","DVBCREQP",4,0)
 ;
"RTN","DVBCREQP",5,0)
CK1 F JI=BDTRQ-.1:0 S JI=$O(^DVB(396.3,XD,JI)) Q:JI=""  F DA(1)=0:0 S DA(1)=$O(^DVB(396.3,XD,JI,DA(1))) Q:DA(1)=""  S DVBXD=$S($D(^DVB(396.3,DA(1),1)):$P(^(1),U,4),1:"") I DVBXD=XDIV S FIND=1
"RTN","DVBCREQP",6,0)
 Q
"RTN","DVBCREQP",7,0)
 ;
"RTN","DVBCREQP",8,0)
PRINT K OUT S STAT=$P(^DVB(396.3,DA(1),0),U,18) ;I STAT["X" S OUT=1 Q
"RTN","DVBCREQP",9,0)
 ;AJF ; Request Status; 012417
"RTN","DVBCREQP",10,0)
 S STAT=$$RSTAT^DVBCUTL8(STAT)
"RTN","DVBCREQP",11,0)
 S DVBCDIV=$S($D(^DVB(396.3,DA(1),1)):$P(^(1),U,4),1:"") Q:DVBCDIV'=XDIV
"RTN","DVBCREQP",12,0)
 S DA=DA(1) D VARS^DVBCUTIL,^DVBCREQ1
"RTN","DVBCREQP",13,0)
 S:CNUM="" CNUM=99999999 S:SSN="" SSN=999999999 S:PNAM="" PNAM="Missing vet name"
"RTN","DVBCREQP",14,0)
 S DA=DA(1),DIE="^DVB(396.3,",DR="17////2"
"RTN","DVBCREQP",15,0)
 I STAT="N"!(STAT="NT") D ^DIE
"RTN","DVBCREQP",16,0)
 ;AJF ; Reroute request; 072016
"RTN","DVBCREQP",17,0)
 I STAT="NR" S DA=DA(1),DIE="^DVB(396.3,",DR="17////14" D ^DIE
"RTN","DVBCREQP",18,0)
SET S DA=DA(1),DR="4///NOW",(DIC,DIE)="^DVB(396.3,"
"RTN","DVBCREQP",19,0)
 I $P(^DVB(396.3,DA,0),U,5)="" D ^DIE
"RTN","DVBCREQP",20,0)
 I '$D(ONE) S ^TMP($J,DVBCTYPE,PNAM,SSN,CNUM)="" ;for last sheet
"RTN","DVBCREQP",21,0)
 S (PNAM,SSN,CNUM,ADR1,ADR2,ADR3,CITY,STATE,ZIP,HOMPHON,BUSPHON,OTHDIS)="",PRINT=1
"RTN","DVBCREQP",22,0)
 Q
"RTN","DVBCREQP",23,0)
 ;
"RTN","DVBCREQP",24,0)
EN K PRINT S Y=DT X ^DD("DD") S DVBCDT(0)=Y D HOME^%ZIS S FF=IOF W @FF,"Manual New C&P Request Printing",!!!
"RTN","DVBCREQP",25,0)
 ;
"RTN","DVBCREQP",26,0)
ASK K ONE W !,"Do you want just one request" S %=2 D YN^DICN G:$D(DTOUT) EXIT I $D(%Y),%Y["?" W !,"Enter Y for only one Vet or N for all Vets.",! G ASK
"RTN","DVBCREQP",27,0)
 G:%Y=U EXIT I %=1 G ONEREQ
"RTN","DVBCREQP",28,0)
 W ! D DIV I $D(OUT) K OUT G EXIT
"RTN","DVBCREQP",29,0)
 W ! S %DT(0)=-DT,%DT="AET",%DT("A")="Enter BEGINNING date of request: " D ^%DT G:Y<0 EXIT S BDTRQ=Y,%DT="AET",%DT("A")="     and ENDING date of request: " D ^%DT G:Y<0 EN S EDTRQ=Y+.2359
"RTN","DVBCREQP",30,0)
 I EDTRQ<BDTRQ W !!,*7,"Ending date is earlier than starting date!",!! H 2 G EN
"RTN","DVBCREQP",31,0)
 ;
"RTN","DVBCREQP",32,0)
DEVICE K %DT W !! S %ZIS="AEQ",%ZIS("A")="Output device: " D ^%ZIS K %ZIS G:POP EXIT
"RTN","DVBCREQP",33,0)
 I $D(IO("Q")) S ZTRTN=$S($D(ONE):"PRINT^DVBCREQP",1:"GO^DVBCREQP"),ZTIO=ION,ZTDESC="New C&P request printing" F I="ONE","BDTRQ*","EDTRQ*","DA*","Y","XDIV","DIVNM","DVBCDT(0)","DVBCMAN" S ZTSAVE(I)=""
"RTN","DVBCREQP",34,0)
 I $D(IO("Q")) D ^%ZTLOAD G:'$D(ZTSK) EXIT W !!,"Request queued",!! G EXIT
"RTN","DVBCREQP",35,0)
 I $D(ONE) U IO D PRINT K DA G EXIT
"RTN","DVBCREQP",36,0)
 ;
"RTN","DVBCREQP",37,0)
GO D STM^DVBCUTL4
"RTN","DVBCREQP",38,0)
 U IO S X="New C&P Requests -- "_DIVNM
"RTN","DVBCREQP",39,0)
 W:(IOST?1"C-".E) @IOF
"RTN","DVBCREQP",40,0)
 W !!!!!!!!!!!!!!! F I=1:1:10 W ?5,X,!!
"RTN","DVBCREQP",41,0)
 K ^TMP($J),X,PRINT S DVBCTYPE="NEW"
"RTN","DVBCREQP",42,0)
 F JI=BDTRQ_".0001":0 S JI=$O(^DVB(396.3,"C",JI)) Q:JI=""!(JI>EDTRQ)  F DA(1)=0:0 S DA(1)=$O(^DVB(396.3,"C",JI,DA(1))) Q:DA(1)=""  K OUT D PRINT
"RTN","DVBCREQP",43,0)
 K OUT I '$D(PRINT) W @IOF,!!!,"There were no new 2507 requests for " S Y=BDTRQ X ^DD("DD") W Y," to " S Y=$E(EDTRQ,1,7) X ^DD("DD") W Y,!,"for division ",DIVNM,!!
"RTN","DVBCREQP",44,0)
MODS K FIND S XD="AC" D CK1 I '$D(FIND) G ADDS
"RTN","DVBCREQP",45,0)
 K PRINT,FIND S X="C&P Request Modifications -- "_DIVNM W @IOF,!!!!!!!!!!!!!!! F I=1:1:10 W ?5,X,!!
"RTN","DVBCREQP",46,0)
 K X S DVBCTYPE="MODIFIED"
"RTN","DVBCREQP",47,0)
 F JI=BDTRQ_".0001":0 S JI=$O(^DVB(396.3,"AC",JI)) Q:JI=""!(JI>EDTRQ)  F DA(1)=0:0 S DA(1)=$O(^DVB(396.3,"AC",JI,DA(1))) Q:DA(1)=""  K OUT D PRINT
"RTN","DVBCREQP",48,0)
 I '$D(PRINT) W @IOF,!!!,"No modified requests to report.",!!
"RTN","DVBCREQP",49,0)
 ;
"RTN","DVBCREQP",50,0)
ADDS K FIND S XD="AD" D CK1 I '$D(FIND) G REROUTE
"RTN","DVBCREQP",51,0)
 K PRINT,FIND S X="C&P Exams Added -- "_DIVNM W @IOF,!!!!!!!!!!!!!!! F I=1:1:10 W ?5,X,!!
"RTN","DVBCREQP",52,0)
 K X S DVBCTYPE="ADDITIONAL"
"RTN","DVBCREQP",53,0)
 F JI=BDTRQ_".0001":0 S JI=$O(^DVB(396.3,"AD",JI)) Q:JI=""!(JI>EDTRQ)  F DA(1)=0:0 S DA(1)=$O(^DVB(396.3,"AD",JI,DA(1))) Q:DA(1)=""  K OUT D PRINT
"RTN","DVBCREQP",54,0)
 I '$D(PRINT) W @IOF,!!!,"No added exams to report.",!!
"RTN","DVBCREQP",55,0)
 ;
"RTN","DVBCREQP",56,0)
REROUTE K FIND S XD="AR" D CK1 I '$D(FIND) G RECAP
"RTN","DVBCREQP",57,0)
 K PRINT,FIND S X="C&P Request Rerouted -- "_DIVNM W @IOF,!!!!!!!!!!!!!!! F I=1:1:10 W ?5,X,!!
"RTN","DVBCREQP",58,0)
 K X S DVBCTYPE="REROUTED",CSITE=$P($$SITE^VASITE,"^",3)
"RTN","DVBCREQP",59,0)
 F JI=BDTRQ_".0001":0 S JI=$O(^DVB(396.3,"AR",JI)) Q:JI=""!(JI>EDTRQ)  D
"RTN","DVBCREQP",60,0)
 .F DA(1)=0:0 S DA(1)=$O(^DVB(396.3,"AR",JI,DA(1))) Q:DA(1)=""  D
"RTN","DVBCREQP",61,0)
 ..S R1=$O(^DVB(396.3,DA(1),6,99999),-1),R2=$O(^DVB(396.3,DA(1),6,R1,1,99999),-1)
"RTN","DVBCREQP",62,0)
 ..S RRQST=$P($G(^DVB(396.3,DA(1),6,R1,1,R2,0)),"^",2)
"RTN","DVBCREQP",63,0)
 ..Q:CSITE=$P(^DVB(396.3,DA(1),6,1,2),"^",4)&(RRQST'="R")
"RTN","DVBCREQP",64,0)
 ..K OUT D PRINT
"RTN","DVBCREQP",65,0)
 I '$D(PRINT) W @IOF,!!!,"No Rerouted request to report.",!!
"RTN","DVBCREQP",66,0)
 ; 
"RTN","DVBCREQP",67,0)
RECAP D ^DVBCREQ3 ;recap sheet
"RTN","DVBCREQP",68,0)
 ;
"RTN","DVBCREQP",69,0)
EXIT S XRTN=$T(+0)
"RTN","DVBCREQP",70,0)
 D SPM^DVBCUTL4
"RTN","DVBCREQP",71,0)
 I $D(DVBCMAN)&($D(ZTQUEUED)) D KILL^%ZTLOAD
"RTN","DVBCREQP",72,0)
 K DVBCMAN,DIVNM,XDIV,DVBXD G KILL^DVBCUTIL
"RTN","DVBCREQP",73,0)
 ;
"RTN","DVBCREQP",74,0)
 ;
"RTN","DVBCREQP",75,0)
ONEREQ W !! S DIC="^DVB(396.3,",DIC(0)="AEQM",DIC("W")="W !?10,""Date of request: "" S:$D(Y) OLDY=Y S Y=$P(^(0),U,2) X ^DD(""DD"") W Y S:$D(OLDY) Y=OLDY",DIC("A")="Enter VETERAN NAME: " D ^DIC G:X=""!(X=U) EXIT
"RTN","DVBCREQP",76,0)
 S JI=$P(Y,U,2),DA(1)=+Y D DIV I $D(OUT) G EXIT
"RTN","DVBCREQP",77,0)
 S ONE=1 G DEVICE
"RTN","DVBCREQP",78,0)
 ;
"RTN","DVBCREQP",79,0)
TASK D ^DVBCREQ2 Q
"RTN","DVBCREQP",80,0)
 ;
"RTN","DVBCREQP",81,0)
DIV W !! K OUT S DIC("A")="Enter MED CENTER DIVISION: ",DIC(0)="AEQM",DIC="^DG(40.8," D ^DIC I X=""!(X=U) S OUT=1 Q
"RTN","DVBCREQP",82,0)
 I +Y<0 W *7,"  ???" G DIV
"RTN","DVBCREQP",83,0)
 S XDIV=+Y,DIVNM=$S($D(^DG(40.8,XDIV,0)):$P(^(0),U,1),1:"Unknown Division") Q
"RTN","DVBCROP1")
0^34^B2251550^B2247426
"RTN","DVBCROP1",1,0)
DVBCROP1 ;ALB/GTS-557/THM-REOPEN REQUESTS/EXAMS, CONTINUED ; 11/16/90  7:39 AM
"RTN","DVBCROP1",2,0)
 ;;2.7;AMIE;**193**;Apr 10, 1995;Build 84
"RTN","DVBCROP1",3,0)
 ;
"RTN","DVBCROP1",4,0)
STATUS1 W *7,!!,"Since this request has reopened, its status will",!,"be PENDING, REPORTED.",!!,"Be sure to regenerate any exam worksheets that will be needed",!,"for this request.",!!
"RTN","DVBCROP1",5,0)
 W "Press RETURN to continue " R ANS:DTIME ;if timeout, properly set record
"RTN","DVBCROP1",6,0)
 ;AJF;Request Status conversion
"RTN","DVBCROP1",7,0)
 K DR S DIE="^DVB(396.3,",DR="6///@;11///@;12///@;13///@;14///@;15///@;16///@;17////2;19///@;20///@;26///@",DA=REQDA D ^DIE
"RTN","DVBCROP1",8,0)
 Q
"RTN","DVBCROPN")
0^8^B28631923^B27642320
"RTN","DVBCROPN",1,0)
DVBCROPN ;ALB/GTS-557/THM-REOPEN REQUEST/SELECTED EXAMS ; 9/22/91  4:54 PM
"RTN","DVBCROPN",2,0)
 ;;2.7;AMIE;**42,193**;Apr 10, 1995;Build 84
"RTN","DVBCROPN",3,0)
 I $D(DUZ)#2=0 W *7,!!,"Your user number (DUZ) is invalid !",!! H 3 G EXIT
"RTN","DVBCROPN",4,0)
 S SUPER=$S($D(^XUSEC("DVBA C SUPERVISOR",DUZ)):1,1:0)
"RTN","DVBCROPN",5,0)
 G EN
"RTN","DVBCROPN",6,0)
 ;
"RTN","DVBCROPN",7,0)
LOOK1 S EXAM=$P(^DVB(396.4,DA,0),U,3)
"RTN","DVBCROPN",8,0)
 S EXAM=$S($D(^DVB(396.6,+EXAM,0)):$P(^(0),U,1),1:"Unknown")
"RTN","DVBCROPN",9,0)
 S STAT=$P(^DVB(396.4,DA,0),U,4),^TMP($J,EXAM)=STAT_U_DA
"RTN","DVBCROPN",10,0)
 Q
"RTN","DVBCROPN",11,0)
 ;
"RTN","DVBCROPN",12,0)
EN D HOME^%ZIS S FF=IOF,HD="2507 Exam Veteran Selection",HD2="Re-open Exams/Requests"
"RTN","DVBCROPN",13,0)
 ;
"RTN","DVBCROPN",14,0)
LOOK D KILL W @FF,!?(IOM-$L(HD)\2),HD,!?(IOM-$L(HD2)\2),HD2,!!
"RTN","DVBCROPN",15,0)
 S DIC("W")="D DICW^DVBCUTIL" S DIC="^DVB(396.3,",DIC(0)="AEQM",DIC("A")="Select VETERAN: " D ^DIC G:X=""!(X=U) EXIT I +Y<0 W *7,"  ???" G LOOK
"RTN","DVBCROPN",16,0)
 ;AJF;Request Status conversion
"RTN","DVBCROPN",17,0)
 S (REQDA,DA(1))=+Y,STAT=$$RSTAT^DVBCUTL8($P(^DVB(396.3,DA(1),0),U,18)),DFN=$P(Y,U,2)
"RTN","DVBCROPN",18,0)
 I STAT="C"!(STAT["X")!(STAT="R")&(SUPER=0) W !!,*7,"Status prohibits activity except by supervisors.",!! H 3 G EN
"RTN","DVBCROPN",19,0)
 S REQDT=$P(^DVB(396.3,DA(1),0),U,2),DATA=$S($D(^DPT(DFN,0)):^(0),1:"")
"RTN","DVBCROPN",20,0)
 S PNAM=$S($P(DATA,U,1)]"":$P(DATA,U,1),1:"Unknown"),SSN=$P(DATA,U,9),CNUM=$S($D(^DPT(DFN,.31)):$P(^(.31),U,3),1:"Unknown") K DICW
"RTN","DVBCROPN",21,0)
 S RELDAT=$P(^DVB(396.3,DA(1),0),U,13)
"RTN","DVBCROPN",22,0)
 F DA=0:0 S DA=$O(^DVB(396.4,"C",DA(1),DA)) Q:DA=""  D LOOK1
"RTN","DVBCROPN",23,0)
 I $P(^DVB(396.3,DA(1),0),U,5)="" DO
"RTN","DVBCROPN",24,0)
 .S TVAR(1,0)="1,0,0,2,0^This 2507 was never reported to MAS, it can NOT be reopened."
"RTN","DVBCROPN",25,0)
 .D WR^DVBAUTL4("TVAR")
"RTN","DVBCROPN",26,0)
 .D CONTMES^DVBCUTL4
"RTN","DVBCROPN",27,0)
 .S NOTRPT=""
"RTN","DVBCROPN",28,0)
 .K TVAR
"RTN","DVBCROPN",29,0)
 G:$D(NOTRPT) LOOK
"RTN","DVBCROPN",30,0)
 ;AJF;Request Status conversion
"RTN","DVBCROPN",31,0)
 S STAT=$$RSTAT^DVBCUTL8($P(^DVB(396.3,DA(1),0),U,18)) D STATCHK G:$D(NCN) LOOK
"RTN","DVBCROPN",32,0)
 ;
"RTN","DVBCROPN",33,0)
ROPN W !!,"Do you want to reopen the ENTIRE request" S %=2 D YN^DICN G:$D(DTOUT)!(%<0) EXIT G:%=1 ALL
"RTN","DVBCROPN",34,0)
 I $D(%Y),%Y["?" W !,"Enter Y to reopen the ENTIRE request or N to reopen only selected exams.",!! H 1 G ROPN
"RTN","DVBCROPN",35,0)
DATA D HDR^DVBCUTIL K NOFND
"RTN","DVBCROPN",36,0)
 W !!
"RTN","DVBCROPN",37,0)
 S Y=$$EXSRH^DVBCUTL4("Select EXAM TO REOPEN: ","I $D(^DVB(396.4,""ARQ""_REQDA,+Y))") ;*Exam lookup function call
"RTN","DVBCROPN",38,0)
 G:$D(DTOUT) EXIT G:X=""!(X=U) UPDATE I +Y<0 W *7,"  ???" G DATA
"RTN","DVBCROPN",39,0)
 S EXY=+Y,EXMNM=$S($D(^DVB(396.6,+$P(^DVB(396.4,EXY,0),U,3),0)):$P(^(0),U,1),1:"")
"RTN","DVBCROPN",40,0)
 I EXMNM="" W *7,!!,"Exam name not found in file 396.6 !",!! H 2 G EXIT
"RTN","DVBCROPN",41,0)
 S STAT=$P(^TMP($J,EXMNM),U,1) I STAT="O" W *7,!!,"Already open!",!! H 2 G DATA
"RTN","DVBCROPN",42,0)
 D STATCHK G:$D(NCN) DATA
"RTN","DVBCROPN",43,0)
 S DA=EXY,DIE="^DVB(396.4,"
"RTN","DVBCROPN",44,0)
 S DR=".04////O;52///@;51///@;50///@"
"RTN","DVBCROPN",45,0)
 D ^DIE I '$D(Y) W " .. reopened" H 1
"RTN","DVBCROPN",46,0)
 I $D(Y) W *7,"   reopen error !" H 2 G EXIT
"RTN","DVBCROPN",47,0)
 S STAT=$P(^DVB(396.4,EXY,0),U,4),$P(^TMP($J,EXMNM),U,1)=STAT S EDIT=1
"RTN","DVBCROPN",48,0)
 G DATA
"RTN","DVBCROPN",49,0)
UPDATE I $D(EDIT) W @FF D STATUS1^DVBCROP1,BULL
"RTN","DVBCROPN",50,0)
 G LOOK
"RTN","DVBCROPN",51,0)
 ;
"RTN","DVBCROPN",52,0)
EXIT G KILL^DVBCUTIL
"RTN","DVBCROPN",53,0)
 ;
"RTN","DVBCROPN",54,0)
KILL K DIC,DA,ALLROPN,EXAM,REQDA,D0,D1,DFN,X,Y,EXY,OLDEXAM,DR,REQDT,DR,EXMNM,NCN,STAT,%,NOFND,^TMP($J),EDIT,NOTRPT,RELDAT,DATA
"RTN","DVBCROPN",55,0)
 Q
"RTN","DVBCROPN",56,0)
HDR D HDR^DVBCUTIL
"RTN","DVBCROPN",57,0)
 Q
"RTN","DVBCROPN",58,0)
STATCHK S I="",NCN=1 F J=0:0 S I=$O(^TMP($J,I)) Q:I=""  I $P(^TMP($J,I),U,1)["X"!($P(^(I),U,1)="C") K NCN Q
"RTN","DVBCROPN",59,0)
 I $D(NCN) W !!,*7,"There are no cancelled or completed exams remaining on this request.",!! H 3
"RTN","DVBCROPN",60,0)
 Q
"RTN","DVBCROPN",61,0)
ALL W !! D STATCHK G:$D(NCN) LOOK W ! S ALLROPN=1,EXMNM="" F JJY=0:0 S EXMNM=$O(^TMP($J,EXMNM)) Q:EXMNM=""  S STAT=$P(^TMP($J,EXMNM),U,1) I STAT["X"!(STAT="C") S X=EXMNM D ALL1
"RTN","DVBCROPN",62,0)
 H 2 W @FF D STATUS1^DVBCROP1,NOTIFY G EN
"RTN","DVBCROPN",63,0)
ALL1 K DR S DIC(0)="QM",DR=".04////O;52///@;51///@;50///@"
"RTN","DVBCROPN",64,0)
 S (DIC,DIE)="^DVB(396.4,",DA=$P(^TMP($J,EXMNM),U,2)
"RTN","DVBCROPN",65,0)
 D ^DIE I '$D(Y) W:$X>50 ! W:$L(EXMNM)>25&($X>45) ! W EXMNM," reopened, "
"RTN","DVBCROPN",66,0)
 I $D(Y) W *7,!,"Reopen error on ",EXMNM," exam !",! H 2
"RTN","DVBCROPN",67,0)
 Q
"RTN","DVBCROPN",68,0)
 ;AJF;Request Status conversion
"RTN","DVBCROPN",69,0)
NOTIFY S X=$$RSTAT^DVBCUTL8($P(^DVB(396.3,DA(1),0),U,18)) I X'["X"&(X'="")&(X'="C") W !!,"Entire exam is now REOPENED.",!! H 1
"RTN","DVBCROPN",70,0)
 I X["X"!(X="")!(X="C") W *7,!!,"Reopen error !",!! H 3 S OUT=1 K X Q
"RTN","DVBCROPN",71,0)
 D BULL K X Q
"RTN","DVBCROPN",72,0)
BULL W !!,"Sending a bulletin to the 2507 REOPENED mail group ...",!!
"RTN","DVBCROPN",73,0)
 H 1 S Y=REQDT X ^DD("DD") S XREQDT=Y,XMDUZ=DUZ
"RTN","DVBCROPN",74,0)
 I RELDAT'="" S Y=RELDAT X ^DD("DD") S XRELDAT=Y
"RTN","DVBCROPN",75,0)
 S XMB="DVBA C 2507 EXAM REOPENED",XMB(1)=PNAM,XMB(2)="XXXXX"_$E(SSN,6,9),XMB(3)=XREQDT,XMB(4)=$P(^VA(200,DUZ,0),U,1),XMB(5)=$S(RELDAT'="":XRELDAT,1:"This request has not been released.")
"RTN","DVBCROPN",76,0)
 S XMB(6)=$S(RELDAT="":"     This reopen will not affect the AMIE AMIS 290.",1:"     **THIS REOPEN WILL AFFECT THE AMIE AMIS 290**")
"RTN","DVBCROPN",77,0)
 S XMB(7)=$S(RELDAT'="":"/Affects AMIE AMIS 290",1:"")
"RTN","DVBCROPN",78,0)
 I $D(ALLROPN) S OWNDOM=$P(^DVB(396.3,DA(1),0),U,22) I OWNDOM]"" S XDOM=$S($D(^DIC(4.2,OWNDOM,0)):^(0),1:"") S DOMAIN=$P(XDOM,U,1),DOMNUM=+$P(XDOM,U,3)
"RTN","DVBCROPN",79,0)
 I $D(ALLROPN),OWNDOM]"" I +DOMNUM>0 S XMY("G.DVBA C 2507 EXAM REOPENED@"_DOMAIN)=DOMNUM W !!,*7,"I am sending updated information to "_DOMAIN,!,"since this was transferred in.",!! H 2
"RTN","DVBCROPN",80,0)
 I '$D(^VA(200,DUZ,.15)) S XMY(XMDUZ)="" G XMB
"RTN","DVBCROPN",81,0)
 I $D(^VA(200,DUZ,.15))&($P(^VA(200,DUZ,.15),"^",1)="") S XMY(XMDUZ)="" G XMB
"RTN","DVBCROPN",82,0)
 I $D(^VA(200,DUZ,.15)) S XMY($P(^VA(200,DUZ,.15),"^",1))=""
"RTN","DVBCROPN",83,0)
XMB D ^XMB K XMDUZ
"RTN","DVBCROPN",84,0)
 I $D(ALLROPN),OWNDOM]"",+DOMNUM>0 S REQDA=DA(1) D EN1^DVBCXFRE
"RTN","DVBCROPN",85,0)
 K ALLROPN,CANC,SEND,OWNDOM,DOMNUM,XMB,XREQDT,XDOM,DOMAIN,RELDAT,XRELDAT
"RTN","DVBCROPN",86,0)
 Q
"RTN","DVBCRPON")
0^49^B17053087^B16783860
"RTN","DVBCRPON",1,0)
DVBCRPON ;ALB/GTS-557/THM-REPRINT C&P REPORTS ; 7/1/91  1:09 PM
"RTN","DVBCRPON",2,0)
 ;;2.7;AMIE;**2,32,193**;Apr 10, 1995;Build 84
"RTN","DVBCRPON",3,0)
 ;
"RTN","DVBCRPON",4,0)
SETUP D HOME^%ZIS K ULINE S FF=IOF,HD="Reprint C & P Exams"
"RTN","DVBCRPON",5,0)
 S XDD=^DD("DD"),$P(ULINE,"_",70)="_"
"RTN","DVBCRPON",6,0)
 I $G(DUZ(2))<1 W !!,*7,"Your division code is invalid.",!! H 2 G EXIT
"RTN","DVBCRPON",7,0)
 S SUPER=0 I $D(^XUSEC("DVBA C SUPERVISOR",DUZ)) S SUPER=1
"RTN","DVBCRPON",8,0)
 ;
"RTN","DVBCRPON",9,0)
SETUP1 ;** Drops into if setup is ok
"RTN","DVBCRPON",10,0)
 W @IOF,!?(IOM-$L(HD)\2),HD,!!!
"RTN","DVBCRPON",11,0)
 S ONE="N",Y=DT X XDD
"RTN","DVBCRPON",12,0)
 S DVBCDT(0)=Y,PGHD="Compensation and Pension Exam Report",LOC=DUZ(2),PG=0,DVBCSITE=$S($D(^DVB(396.1,1,0)):$P(^(0),U,1),1:"Not specified")
"RTN","DVBCRPON",13,0)
 ;
"RTN","DVBCRPON",14,0)
RASK W !!,"Select Reprint Option - (D)ate or (V)eteran:  D// " R RTYPE:DTIME I RTYPE[U!('$T) G EXIT
"RTN","DVBCRPON",15,0)
 I RTYPE'=""&(RTYPE'="D"&(RTYPE'="d"&(RTYPE'="v"&(RTYPE'="V")))) S RTYPE="E"
"RTN","DVBCRPON",16,0)
 W:RTYPE="" "Date" W $S(RTYPE="D"!(RTYPE="d"):"ate",RTYPE="V"!(RTYPE="v"):"eteran",1:"") I RTYPE=""!(RTYPE="d") S RTYPE="D"
"RTN","DVBCRPON",17,0)
 I RTYPE="v" S RTYPE="V"
"RTN","DVBCRPON",18,0)
 I RTYPE'?1"D",RTYPE'?1"V" W !!,"Must be D or V" G RASK
"RTN","DVBCRPON",19,0)
 G:RTYPE="D" ADATE I RTYPE="V" S ONE="Y"
"RTN","DVBCRPON",20,0)
 ;
"RTN","DVBCRPON",21,0)
ONLYLAB ;** Dropped into if the user doesn't exit from RASK and selects to
"RTN","DVBCRPON",22,0)
 ;**  to reprint by veteran
"RTN","DVBCRPON",23,0)
 W !!,"Do you want just the Lab/X-ray results" S %=2 D YN^DICN I %=1 H 1 G REN^DVBCLABR ;** Branches to ^DVBCLABR which branches to ^DVBCPRNT
"RTN","DVBCRPON",24,0)
 I %=0 W !!,"Enter Y to get just the Lab/X-ray results for the Vet",!,"or N to get the entire exam results AND Lab/X-ray." H 2 G ONLYLAB
"RTN","DVBCRPON",25,0)
 ;
"RTN","DVBCRPON",26,0)
ADATE ;** Jumped into from RASK or dropped into from ONLYLAB
"RTN","DVBCRPON",27,0)
 I RTYPE="D" S %DT="AE",%DT("A")="Enter original printing date: ",%DT(0)=-DT D ^%DT G:+Y<0 EXIT S RUNDATE=+Y
"RTN","DVBCRPON",28,0)
 ;
"RTN","DVBCRPON",29,0)
WHO ;** Dropped into from ADATE
"RTN","DVBCRPON",30,0)
 W !!,"Reprinted by the RO or MAS ?   >> " R ANS:DTIME G:'$T EXIT I ANS=""!(ANS=U) G EXIT
"RTN","DVBCRPON",31,0)
 I ANS'="R"&(ANS'="r"&(ANS'="m"&(ANS'="M"))) S ANS="E"
"RTN","DVBCRPON",32,0)
 W $S(ANS="M"!(ANS="m"):"AS",ANS="R"!(ANS="r"):"O",1:"")
"RTN","DVBCRPON",33,0)
 S:ANS="r" ANS="R"
"RTN","DVBCRPON",34,0)
 S:ANS="m" ANS="M"
"RTN","DVBCRPON",35,0)
 I ANS'?1"R"&(ANS'?1"M") W !,"Must be R for Regional Office or M for MAS.",!!,*7 G WHO
"RTN","DVBCRPON",36,0)
 I ANS="R" K AUTO ;selects header type
"RTN","DVBCRPON",37,0)
 I ANS="M" S AUTO=1
"RTN","DVBCRPON",38,0)
 I ONE="Y" K OUT D ONEVET I $D(OUT) G EXIT
"RTN","DVBCRPON",39,0)
 ;
"RTN","DVBCRPON",40,0)
DEVICE ;** Dropped into from WHO
"RTN","DVBCRPON",41,0)
 W @IOF S %ZIS="AEQ",%ZIS("B")="0;P-OTHER",%ZIS("A")="Output device: " D ^%ZIS G:POP EXIT
"RTN","DVBCRPON",42,0)
 I $D(IO("Q")),ONE="N" S ZTRTN="GO^DVBCRPRT",ZTIO=ION,ZTDESC="2507 Final Exam Reprint" F I="XDD","D*","PGHD","RTYPE","RUNDATE","Y","AUTO","LOC","ANS","ULINE","ONE" S ZTSAVE(I)=""
"RTN","DVBCRPON",43,0)
 I $D(IO("Q")),ONE="Y" S ZTRTN="OV^DVBCRPON",ZTIO=ION,ZTDESC="Single 2507 Final Exam Reprint" F I="XDD","D*","PGHD","RTYPE","RUNDATE","Y","AUTO","LOC","ANS","ULINE","ONE" S ZTSAVE(I)=""
"RTN","DVBCRPON",44,0)
 I $D(IO("Q")) D ^%ZTLOAD W:$D(ZTSK) !!,"Request queued",!! H 1 G EXIT
"RTN","DVBCRPON",45,0)
 I ONE="N" G GO^DVBCRPRT
"RTN","DVBCRPON",46,0)
 I ONE="Y" G OV
"RTN","DVBCRPON",47,0)
 ;
"RTN","DVBCRPON",48,0)
ONEVET ;** Called from WHO when ONE=Y
"RTN","DVBCRPON",49,0)
 W !! S DIC("W")="D DICW^DVBCUTIL",DIC="^DVB(396.3,",DIC(0)="AEQM" D ^DIC I X=""!(X=U) S OUT=1 Q
"RTN","DVBCRPON",50,0)
 I +Y<0 W *7,"   ???" H 2 G ONEVET
"RTN","DVBCRPON",51,0)
 S DA=+Y
"RTN","DVBCRPON",52,0)
 S RO=$P(^DVB(396.3,DA,0),U,3) I RO'=DUZ(2)&('$D(AUTO))&(SUPER=0) W !!,*7,"Those results do not belong to your office.",!! H 3 G ONEVET
"RTN","DVBCRPON",53,0)
 ;;AJF;Request Status conversion
"RTN","DVBCRPON",54,0)
 N RST
"RTN","DVBCRPON",55,0)
 S RST=$$RSTAT^DVBCUTL8($P(^DVB(396.3,DA,0),U,18))
"RTN","DVBCRPON",56,0)
 I RO=DUZ(2)&('$D(AUTO))&("RC"'[RST) W *7,!!,"This request has not been released to the Regional Office yet.",!! H 3 G ONEVET
"RTN","DVBCRPON",57,0)
 S PRTDATE=$P(^DVB(396.3,DA,0),U,16) I PRTDATE="" W *7,!!,"This has never been printed.",!! I SUPER=0 S OUT=1 H 3 Q
"RTN","DVBCRPON",58,0)
 Q
"RTN","DVBCRPON",59,0)
 ;
"RTN","DVBCRPON",60,0)
OV ;** Run as a background task or in real-time
"RTN","DVBCRPON",61,0)
 U IO S DA(1)=DA K DVBAON2 D SETLAB^DVBCPRNT,VARS^DVBCUTIL,STEP2^DVBCRPRT
"RTN","DVBCRPON",62,0)
 K AUTO D ^%ZISC I '$D(ZTQUEUED) G SETUP1
"RTN","DVBCRPON",63,0)
 ;
"RTN","DVBCRPON",64,0)
EXIT K AUTO S LKILL=1 D:$D(ZTQUEUED) KILL^%ZTLOAD G KILL^DVBCUTIL
"RTN","DVBCRPON",65,0)
 ;
"RTN","DVBCRPON",66,0)
 Q
"RTN","DVBCRPRT")
0^50^B20659083^B20397962
"RTN","DVBCRPRT",1,0)
DVBCRPRT ;ALB/GTS-557/THM-REPRINT C&P REPORT ; 5/17/91  10:28 AM
"RTN","DVBCRPRT",2,0)
 ;;2.7;AMIE;**31,42,119,192,196,193**;Apr 10, 1995;Build 84
"RTN","DVBCRPRT",3,0)
 ;
"RTN","DVBCRPRT",4,0)
 ; ** DVBCRPRT is called from DVBCRPON **
"RTN","DVBCRPRT",5,0)
 ; ** DVBCRPRT is called from DVBAB82 **
"RTN","DVBCRPRT",6,0)
PHYS S PHYS=$S($D(^DVB(396.4,DA,0)):$P(^(0),U,7),1:"")
"RTN","DVBCRPRT",7,0)
 Q
"RTN","DVBCRPRT",8,0)
STEP2A ;  ** Called from STEP2 only **
"RTN","DVBCRPRT",9,0)
 S EXMNM=$S($D(^DVB(396.6,$P(^DVB(396.4,DA,0),U,3),0)):$P(^(0),U,1),1:"Unknown exam"),EXHD="For "_EXMNM_" Exam" D HDR^DVBCRPR1
"RTN","DVBCRPRT",10,0)
 W "Examining provider: ",PHYS,!,"Examined on: " S Y=$P(^DVB(396.4,DA,0),U,6) X XDD W Y,! F LINE=1:1:80 W "="
"RTN","DVBCRPRT",11,0)
 W !!?2,"Examination results:",!! S EXSTAT=$P(^DVB(396.4,DA,0),U,4) I EXSTAT="X"!(EXSTAT="RX") W !!!!!?25,"This exam was CANCELLED by ",$S(EXSTAT="RX":"the RO.",1:"MAS."),!! Q
"RTN","DVBCRPRT",12,0)
 D STEP3
"RTN","DVBCRPRT",13,0)
 Q
"RTN","DVBCRPRT",14,0)
STEP2 ; ** An external entry point and called from GO2 **
"RTN","DVBCRPRT",15,0)
 F DA=0:0 S DA=$O(^DVB(396.4,"C",DA(1),DA)) Q:DA=""  D GETRO Q:RO'=DUZ(2)&('$D(^XUSEC("DVBA C SUPERVISOR",DUZ)))  S PG=0 D PHYS,STEP2A I $D(PRINT) D BOT^DVBCRPR1 K PRINT
"RTN","DVBCRPRT",16,0)
 D ^DVBCLABR Q
"RTN","DVBCRPRT",17,0)
 K DVBAON2
"RTN","DVBCRPRT",18,0)
 Q
"RTN","DVBCRPRT",19,0)
VBASTEP2 ; call from VBACRPON^DVBAB82
"RTN","DVBCRPRT",20,0)
 F DA=0:0 S DA=$O(^DVB(396.4,"C",DA(1),DA)) Q:DA=""  D GETRO S PG=0 D PHYS,STEP2A I $D(PRINT) D BOT^DVBCRPR1 K PRINT
"RTN","DVBCRPRT",21,0)
 D ^DVBCLABR Q
"RTN","DVBCRPRT",22,0)
 K DVBAON2
"RTN","DVBCRPRT",23,0)
 Q
"RTN","DVBCRPRT",24,0)
STEP3 ;  ** Called from STEP2A only **
"RTN","DVBCRPRT",25,0)
 K ^UTILITY($J,"W") S DIWL=1,DIWR=80,DIWF="NW" S OLDA=DA,OLDA1=DA(1)
"RTN","DVBCRPRT",26,0)
 F LINE=0:0 S LINE=$O(^DVB(396.4,OLDA,"RES",LINE)) Q:LINE=""  S X=^DVB(396.4,OLDA,"RES",LINE,0) D ^DIWP,STEP3A
"RTN","DVBCRPRT",27,0)
 D ^DIWW S PRINT=1 S DA=OLDA,DA(1)=OLDA1
"RTN","DVBCRPRT",28,0)
 Q
"RTN","DVBCRPRT",29,0)
STEP3A ;  ** Called from STEP3 only **
"RTN","DVBCRPRT",30,0)
 I +$G(DVBGUI) D
"RTN","DVBCRPRT",31,0)
 .I $Y>(IOSL-9) D HDR^DVBCRPR1
"RTN","DVBCRPRT",32,0)
 I '+$G(DVBGUI) D
"RTN","DVBCRPRT",33,0)
 .I $Y>(IOSL-9) D UP^DVBCRPR1,NEXT,HDR^DVBCRPR1 W:$O(^DVB(396.4,OLDA,"RES",LINE))]""&('+$G(DVBGUI)) !!,"Exam Results Continued",!!
"RTN","DVBCRPRT",34,0)
 Q
"RTN","DVBCRPRT",35,0)
GO ;  ** An external entry point called from DVBCRPON **
"RTN","DVBCRPRT",36,0)
 U IO K ^TMP($J),DVBAON2 D HDA^DVBCRPR1 S (XCNT,XPRINT)=0
"RTN","DVBCRPRT",37,0)
 I '$D(^XUSEC("DVBA C SUPERVISOR",DUZ)) D
"RTN","DVBCRPRT",38,0)
 .F DA(1)=0:0 S DA(1)=$O(^DVB(396.3,"AF",5,DUZ(2),DA(1))) Q:DA(1)=""  DO
"RTN","DVBCRPRT",39,0)
 ..I $D(^DVB(396.3,DA(1),0)) D GO1
"RTN","DVBCRPRT",40,0)
 ..I '$D(^DVB(396.3,DA(1),0)) D BADXRF^DVBCPRNT
"RTN","DVBCRPRT",41,0)
 I $D(^XUSEC("DVBA C SUPERVISOR",DUZ)) D
"RTN","DVBCRPRT",42,0)
 .;AJF;Request Status conversion
"RTN","DVBCRPRT",43,0)
 .F LOC=0:0 S LOC=$O(^DVB(396.3,"AF",5,LOC)) Q:LOC=""  D
"RTN","DVBCRPRT",44,0)
 ..F DA(1)=0:0 S DA(1)=$O(^DVB(396.3,"AF",5,LOC,DA(1))) Q:DA(1)=""  DO
"RTN","DVBCRPRT",45,0)
 ...I $D(^DVB(396.3,DA(1),0)) D GO1
"RTN","DVBCRPRT",46,0)
 ...I '$D(^DVB(396.3,DA(1),0)) D BADXRF^DVBCPRNT
"RTN","DVBCRPRT",47,0)
 I XPRINT=0 K XPRINT,XPG,XXLN W !!!!!?25,"Nothing to print",!! H 2 G KILL^DVBCUTIL
"RTN","DVBCRPRT",48,0)
 I XCNT>0,XPRINT=1 W !!,"Total requests to be printed: ",XCNT,!
"RTN","DVBCRPRT",49,0)
 K XCNT,XXLN,XPG,XPRINT D SETLAB^DVBCPRNT S (XCN,PNAM)=""
"RTN","DVBCRPRT",50,0)
 F DVBCN=0:0 S XCN=$O(^TMP($J,XCN)) Q:XCN=""  F JJ=0:0 S PNAM=$O(^TMP($J,XCN,PNAM)) Q:PNAM=""  D GO2
"RTN","DVBCRPRT",51,0)
 G EXIT
"RTN","DVBCRPRT",52,0)
VBAGO ;  ** An external entry point called from DVBCRPON **
"RTN","DVBCRPRT",53,0)
 U IO K ^TMP($J),DVBAON2 D HDA^DVBCRPR1 S (XCNT,XPRINT)=0
"RTN","DVBCRPRT",54,0)
 D
"RTN","DVBCRPRT",55,0)
 .S DVBADUZ(2)=$P(^DVB(396.3,DA(1),0),U,2)
"RTN","DVBCRPRT",56,0)
 .F DA(1)=0:0 S DA(1)=$O(^DVB(396.3,"AF",5,DVBADUZ(2),DA(1))) Q:DA(1)=""  DO
"RTN","DVBCRPRT",57,0)
 ..I $D(^DVB(396.3,DA(1),0)) D GO1
"RTN","DVBCRPRT",58,0)
 ..I '$D(^DVB(396.3,DA(1),0)) D BADXRF^DVBCPRNT
"RTN","DVBCRPRT",59,0)
 I XPRINT=0 K XPRINT,XPG,XXLN W !!!!!?25,"Nothing to print",!! H 2 G KILL^DVBCUTIL
"RTN","DVBCRPRT",60,0)
 I XCNT>0,XPRINT=1 W !!,"Total requests to be printed: ",XCNT,!
"RTN","DVBCRPRT",61,0)
 K XCNT,XXLN,XPG,XPRINT D SETLAB^DVBCPRNT S (XCN,PNAM)=""
"RTN","DVBCRPRT",62,0)
 F DVBCN=0:0 S XCN=$O(^TMP($J,XCN)) Q:XCN=""  F JJ=0:0 S PNAM=$O(^TMP($J,XCN,PNAM)) Q:PNAM=""  D GO2
"RTN","DVBCRPRT",63,0)
 G EXIT
"RTN","DVBCRPRT",64,0)
GO2 F DA(1)=0:0 K PRINT S DA(1)=$O(^TMP($J,XCN,PNAM,DA(1))) Q:DA(1)=""  S PRTDATE=$P(^DVB(396.3,DA(1),0),U,16) I PRTDATE[RUNDATE S DA=DA(1) D VARS^DVBCUTIL Q:(LOC'=RO)&('$D(^XUSEC("DVBA C SUPERVISOR",DUZ)))&('$D(AUTO))  D STEP2
"RTN","DVBCRPRT",65,0)
 Q
"RTN","DVBCRPRT",66,0)
GO1 S DFN=$P(^DVB(396.3,DA(1),0),U,1),PRTDATE=$P(^(0),U,16),PNAM=$P(^DPT(DFN,0),U,1),SSN=$P(^(0),U,9),CNUM=$S($D(^DPT(DFN,.31)):$P(^(.31),U,3),1:"Missing")
"RTN","DVBCRPRT",67,0)
 I RTYPE="D" Q:PRTDATE'[RUNDATE!(RUNDATE']"")
"RTN","DVBCRPRT",68,0)
 S XCN=$E(CNUM,$L(CNUM)-1,$L(CNUM)),XCN=+XCN
"RTN","DVBCRPRT",69,0)
 I PNAM]"" S ^TMP($J,XCN,PNAM,DA(1))="",XPRINT=1,XCNT=XCNT+1
"RTN","DVBCRPRT",70,0)
 D SSNSHRT^DVBCUTIL
"RTN","DVBCRPRT",71,0)
 W $E(PNAM,1,25),?28,DVBCSSNO,?43,CNUM,?55 S Y=$P(^DVB(396.3,DA(1),0),U,2) X XDD W Y,! D:$Y>(IOSL-16) HDA^DVBCRPR1
"RTN","DVBCRPRT",72,0)
 K PNAM,XCN,CNUM,DVBCSSNO
"RTN","DVBCRPRT",73,0)
 Q
"RTN","DVBCRPRT",74,0)
 ;
"RTN","DVBCRPRT",75,0)
EXIT K XDD,AUTO,DVBADUZ(2) S LKILL=1 G KILL^DVBCUTIL ; ** GOTO will quit from this RTN
"RTN","DVBCRPRT",76,0)
 ;
"RTN","DVBCRPRT",77,0)
NEXT I '$D(DVBGUI) W !,"Continued on next page",!,"VA Form 2507"
"RTN","DVBCRPRT",78,0)
 Q
"RTN","DVBCRPRT",79,0)
 ;
"RTN","DVBCRPRT",80,0)
GETRO S RO=$P(^DVB(396.3,DA(1),0),U,3)
"RTN","DVBCRPRT",81,0)
 Q
"RTN","DVBCSCHD")
0^25^B18709519^B20499986
"RTN","DVBCSCHD",1,0)
DVBCSCHD ;ALB/GTS-557/THM-SCHEDULE C&P EXAMS ; 9/23/91  9:54 AM
"RTN","DVBCSCHD",2,0)
 ;;2.7;AMIE;**17,193**;Apr 10, 1995;Build 84
"RTN","DVBCSCHD",3,0)
 ;
"RTN","DVBCSCHD",4,0)
 ;** Version Changes
"RTN","DVBCSCHD",5,0)
 ;   2.7 - GTS/Set DVBADA,DVBASDRT SD Event driver  (Enhc 13)
"RTN","DVBCSCHD",6,0)
 ;
"RTN","DVBCSCHD",7,0)
SETUP D HOME^%ZIS S HD="SCHEDULE C&P EXAMS",FF=IOF
"RTN","DVBCSCHD",8,0)
 I $D(DUZ)#2=0 W *7,!!,"You have no user number !",!! H 3 G EXIT
"RTN","DVBCSCHD",9,0)
 S SUPER=0 I $D(^XUSEC("DVBA C SUPERVISOR",DUZ)) S SUPER=1
"RTN","DVBCSCHD",10,0)
 ;
"RTN","DVBCSCHD",11,0)
EN D ZAP W @FF,?(IOM-$L(HD)\2),HD,!!!
"RTN","DVBCSCHD",12,0)
 S DIC="^DVB(396.3,",DIC(0)="AEQM",DIC("A")="Enter VETERAN NAME: ",DIC("W")="D DICW^DVBCUTIL"
"RTN","DVBCSCHD",13,0)
 D ^DIC G:X=""!(X[U)!($D(DTOUT)) EXIT
"RTN","DVBCSCHD",14,0)
 I +Y>0 S (OLDDA,REQDA)=+Y,DFN=$P(Y,U,2)
"RTN","DVBCSCHD",15,0)
 I $O(^DVB(396.4,"C",REQDA,0))="" W !!,*7,"This request has no exams on it and should",!,"be completely cancelled.",!! H 3 G EN
"RTN","DVBCSCHD",16,0)
 D GO1 I '$D(TFIND) W !!,*7,"This request has been completely transferred to another site.",!,"Scheduling will not be allowed.",!! H 3 G EN
"RTN","DVBCSCHD",17,0)
 ;AJF;Conversion of Request Status field 
"RTN","DVBCSCHD",18,0)
 S STAT=$P(^DVB(396.3,REQDA,0),U,18),STAT=$$RSTAT^DVBCUTL8(STAT) D STATCHK I $D(NCN) G EN
"RTN","DVBCSCHD",19,0)
 S DTSCHED=$P(^DVB(396.3,+Y,0),U,6) I DTSCHED]"" W !!,*7,"Scheduling has been completed for this request as of ",$$FMTE^XLFDT(DTSCHED,"5DZ")_".",!
"RTN","DVBCSCHD",20,0)
 I DTSCHED]"",SUPER=0 W "Only supervisors can change it.",!! H 3 G EN
"RTN","DVBCSCHD",21,0)
 ;
"RTN","DVBCSCHD",22,0)
ASK K %,%Y I DTSCHED]"",SUPER=1 W "Do you want to change" S %=2 D YN^DICN G:$D(DTOUT)!(%<0) EXIT
"RTN","DVBCSCHD",23,0)
 I $D(%Y),%Y["?" W !!,"Enter Y to be able to change the scheduling information or N to backup.",!! G ASK
"RTN","DVBCSCHD",24,0)
 I $D(%),%'=1 G EN
"RTN","DVBCSCHD",25,0)
 ;
"RTN","DVBCSCHD",26,0)
ASK1 I $D(^DVB(396.3,REQDA,4)),$P(^(4),U,1)="y" W !!,"Note:  One or more exams on this request have transferred out."
"RTN","DVBCSCHD",27,0)
 W !!,"Do you want to make an appointment for a clinic" S %=1 D YN^DICN G:$D(DTOUT)!(%<0) EXIT I %=1 W @FF,"Schedule a Clinic Appointment for 2507 Exam",!!! S ORACTION=1,DVBADA=REQDA,DVBASDRT="",ORVP=DFN D OERR^SDM
"RTN","DVBCSCHD",28,0)
 I $D(%Y),%Y["?" W !!,"Enter Y to make an appointment via ADT/Scheduling or N to skip." G ASK1
"RTN","DVBCSCHD",29,0)
 ;
"RTN","DVBCSCHD",30,0)
EN1 W @FF,"Enter Scheduling Information for 2507 Exams",!!
"RTN","DVBCSCHD",31,0)
 ;
"RTN","DVBCSCHD",32,0)
ASK2 W !,"Has scheduling for all exams been completed" S %=2 D YN^DICN G:$D(DTOUT)!(%<0) EXIT
"RTN","DVBCSCHD",33,0)
 I $D(%Y),%Y["?" W !!,"Enter Y if scheduling is completed, N if not.",!! G ASK2
"RTN","DVBCSCHD",34,0)
 G:%'=1 EN
"RTN","DVBCSCHD",35,0)
 W !!,"Ok, then please complete the following:",!!
"RTN","DVBCSCHD",36,0)
 S:$P(^DVB(396.3,REQDA,0),U,6)="" DR="5///NOW",DIE="^DVB(396.3,",DA=REQDA D ^DIE:$P(^DVB(396.3,REQDA,0),U,6)="",EXAMS I '$D(Y) G EN
"RTN","DVBCSCHD",37,0)
 I $D(Y) W *7,!!,"Important scheduling information is missing!",!,"2507 file NOT updated!",!! S DR="5///@",DIE="^DVB(396.3,",DA=REQDA D ^DIE H 2 G EN ;delete date if "^"
"RTN","DVBCSCHD",38,0)
 ;
"RTN","DVBCSCHD",39,0)
ZAP K %,%Y,NCN,DFN,EXAM,JDR,JDT,DTSCHED,REQDA,RO,RONAME,STAT,TFIND,TSTDT
"RTN","DVBCSCHD",40,0)
 Q
"RTN","DVBCSCHD",41,0)
 ;
"RTN","DVBCSCHD",42,0)
EXIT K TFIND,ORACTION,ORVP,DVBAXJ,DVBASDRT G KILL^DVBCUTIL
"RTN","DVBCSCHD",43,0)
 ;
"RTN","DVBCSCHD",44,0)
STATCHK Q:STAT="P"!(STAT="N")!(STAT="NT")!(STAT="S")!(STAT="O")
"RTN","DVBCSCHD",45,0)
 ;AJF; Request Status Conversion
"RTN","DVBCSCHD",46,0)
 N STIEN,STNM
"RTN","DVBCSCHD",47,0)
 S STIEN=$O(^DVB(396.33,"C",STAT,"")),STNM=$$RTSTAT^DVBCUTL8(STIEN)
"RTN","DVBCSCHD",48,0)
 W !!,*7,"This request has a status of ",STNM," and can't be scheduled.",!!
"RTN","DVBCSCHD",49,0)
 S NCN=1 H 2 Q
"RTN","DVBCSCHD",50,0)
 Q
"RTN","DVBCSCHD",51,0)
 ;
"RTN","DVBCSCHD",52,0)
EXAMS H 1 S DA(1)=REQDA
"RTN","DVBCSCHD",53,0)
 F DA=0:0 S DA=$O(^DVB(396.4,"C",DA(1),DA)) Q:DA=""!(+DA=0)  S EXNAME=+$P(^DVB(396.4,DA,0),U,3),EXST=$P(^(0),U,4),EXNAME=$S($D(^DVB(396.6,EXNAME,0)):$P(^(0),U,1),1:"") I EXST'["X",EXST'="T" D EXAMS1 ;screen cancels, transfers
"RTN","DVBCSCHD",54,0)
 Q
"RTN","DVBCSCHD",55,0)
 ;
"RTN","DVBCSCHD",56,0)
EXAMS1 I EXNAME]"" S DIE="^DVB(396.4,",DR=".08//NO;.09//CLINIC" W @IOF,!!!,"Exam: ",EXNAME,!!! D ^DIE Q:$D(Y)
"RTN","DVBCSCHD",57,0)
 Q
"RTN","DVBCSCHD",58,0)
 ;
"RTN","DVBCSCHD",59,0)
GO1 K TFIND F DVBAXJ=0:0 S DVBAXJ=$O(^DVB(396.4,"C",REQDA,DVBAXJ)) Q:DVBAXJ=""  I $P(^DVB(396.4,DVBAXJ,0),U,4)'="T" S TFIND=1
"RTN","DVBCSCHD",60,0)
 Q
"RTN","DVBCSCHD",61,0)
 ;if $D(TFIND) at least one exam to be done locally
"RTN","DVBCSCHD",62,0)
 ;if '$D(TFIND) all exams are transferred/don't consider
"RTN","DVBCTRN1")
0^7^B5018237^B4904198
"RTN","DVBCTRN1",1,0)
DVBCTRN1 ;ALB/JLU;AMIE link routine;12/21/92
"RTN","DVBCTRN1",2,0)
 ;;2.7;AMIE;**12,193**;Apr 10, 1995;Build 84
"RTN","DVBCTRN1",3,0)
NSFT K DVBCHK
"RTN","DVBCTRN1",4,0)
 I $S('$D(DVBCDFN):1,DVBCDFN']"":1,1:0) S DVBCHK="-1^Patient's DFN not defined OR is null" Q
"RTN","DVBCTRN1",5,0)
 I $S('$D(DVBCXM):1,DVBCXM']"":1,1:0) S DVBCHK="-2^Exam not defined OR is null" Q
"RTN","DVBCTRN1",6,0)
 S DVBCDFN1=$O(^DVB(396.3,"B",DVBCDFN,0))
"RTN","DVBCTRN1",7,0)
 I 'DVBCDFN1 S DVBCHK="-3^No 2507 request for this patient" Q
"RTN","DVBCTRN1",8,0)
 ;for loop to handle multiple exams with same name
"RTN","DVBCTRN1",9,0)
 N FOUND,STOP,TOXM
"RTN","DVBCTRN1",10,0)
 S (DVBCXM1,FOUND,STOP)=0
"RTN","DVBCTRN1",11,0)
 F  S DVBCXM1=$O(^DVB(396.6,"B",$E(DVBCXM,1,30),DVBCXM1)) Q:(DVBCXM1="")!(+$G(DVBCHK)<0)  D
"RTN","DVBCTRN1",12,0)
 .Q:($P(^DVB(396.6,DVBCXM1,0),"^"))'=DVBCXM
"RTN","DVBCTRN1",13,0)
 .S FOUND=1 ;an entry does exist for exam passed in DVBCXM
"RTN","DVBCTRN1",14,0)
 .S DVBCOXM=$O(^DVB(396.4,"APS",DVBCDFN,DVBCXM1,"O",0))
"RTN","DVBCTRN1",15,0)
 .I STOP,DVBCOXM'="" S DVBCHK="-8^More than one open exam" Q
"RTN","DVBCTRN1",16,0)
 .I STOP,DVBCOXM="" Q
"RTN","DVBCTRN1",17,0)
 .; ^ multiple exams with same name but different pointer values.
"RTN","DVBCTRN1",18,0)
 .I $O(^DVB(396.4,"APS",DVBCDFN,DVBCXM1,"O",DVBCOXM)) S DVBCHK="-8^More than one open exam" Q
"RTN","DVBCTRN1",19,0)
 .I DVBCOXM'="" S STOP=1,TOXM=DVBCOXM
"RTN","DVBCTRN1",20,0)
 .; ^open exam found
"RTN","DVBCTRN1",21,0)
 I +$G(DVBCHK)<0 Q
"RTN","DVBCTRN1",22,0)
 I 'FOUND S DVBCHK="-4^No Exam by that name in the 2507 Exam file" Q
"RTN","DVBCTRN1",23,0)
 I 'STOP S DVBCHK="-6^No open Exam for data given" Q
"RTN","DVBCTRN1",24,0)
 S DVBCOXM=TOXM
"RTN","DVBCTRN1",25,0)
 I '$D(^DVB(396.4,DVBCOXM,0)) S DVBCHK="-7^Exam cross reference is bad" Q
"RTN","DVBCTRN1",26,0)
 S DVBCX=$P(^DVB(396.4,DVBCOXM,0),U,2)
"RTN","DVBCTRN1",27,0)
 I '$$OREQ($P(^DVB(396.3,DVBCX,0),"^",18)) S DVBCHK="-5^No open requests for data given" Q
"RTN","DVBCTRN1",28,0)
 S DVBCHK="396.3:"_DVBCX_":"_396.4_":"_DVBCOXM_";^Soft Link entry"
"RTN","DVBCTRN1",29,0)
 Q
"RTN","DVBCTRN1",30,0)
 ;
"RTN","DVBCTRN1",31,0)
OREQ(DVBX) ;
"RTN","DVBCTRN1",32,0)
 ;This function will check to see if there is an open request.
"RTN","DVBCTRN1",33,0)
 ;DVBCX should contain the REQUEST STATUS.
"RTN","DVBCTRN1",34,0)
 ;
"RTN","DVBCTRN1",35,0)
 ;AJF; 2507 Request Status Conversion
"RTN","DVBCTRN1",36,0)
 S DVBX=$$RSTAT^DVBCUTL8(DVBX)
"RTN","DVBCTRN1",37,0)
 I $S(DVBX'="P"&(DVBX'="S")&(DVBX'="T")&(DVBX'="NT"):1,1:0) Q 0
"RTN","DVBCTRN1",38,0)
 Q 1
"RTN","DVBCUTL3")
0^24^B23964326^B23312372
"RTN","DVBCUTL3",1,0)
DVBCUTL3 ;ALB/GTS-557/THM-DVBCUTL2, CONTINUED ; 5/17/91  11:35 AM
"RTN","DVBCUTL3",2,0)
 ;;2.7;AMIE;**132,193**;Apr 10, 1995;Build 84
"RTN","DVBCUTL3",3,0)
 ;
"RTN","DVBCUTL3",4,0)
KILL I $D(LKILL) K LKILL D LKILL
"RTN","DVBCUTL3",5,0)
 K C0,DVBCLTR,DVBCNOW,DVBCSORT,LI,LREXMDT,LV,PGRN,ROUT,RT,TSTAT,XMB,XT,EXNAME,OTHDIS1,OTHDIS2,PG,REQRO,RSTAT,TIME,ZI,ZZI,DAYEX,DINUM,DTCAN,ERDAYS,EXMDA,FB,OLDAYS,^TMP("DVBC",$J),^TMP("DVBCLAB",$J),DVBCBDT,DVBCLOC,DVBCN,DVBCRLOC
"RTN","DVBCUTL3",6,0)
 K HD4,RONUM,TPRT,DG,LRPARAM,RARPT,SUPER,^TMP($J),^TMP("DVBC","BULL",$J),EXCNT,RTYPE,XD,XLINE,ZC,LY,LZ,MX,MY,WKSNUM,HD7,HD8,HD9,LN1,LN2,DXCMT,CANBY,CANDT,CANREM,CFLOC,CFREQ,CMBN,DVBCI,ELIGCOD,ELIGSDT,ELIGST,DVBCD2
"RTN","DVBCUTL3",7,0)
 K EXM,EXMDT,EXMPL,EXPHYS,FREAS,HD5,HD6,HD7,HD8,HD9,LNH,NREQDA,OLREQDA,OTHDOC,OWNER,PDSRV,PFAX,POWSTAT,SITE,SITE1,SRVCON,SRVEDT,SRVPCT,SRVSDT,SUB,TIME,TOT,USER,USERNM,USR,VETST,WRKSHT,XFERDT,XFERSITE,XMER,XMREC,XMRG,ZJ,ZK
"RTN","DVBCUTL3",8,0)
 K HD91,CNUM,DFN,DX,DXCOD,DXNUM,I,LINE,DVBCRALC,PCT,SC,SSN,CANCBY,CANCDT,CANCREM,DATRETN,EXST,FA,OWNDOM,REMK,TSTA1,XMFG,YY,ZG,ZH,DVBCAO,XCN,MANUAL
"RTN","DVBCUTL3",9,0)
 K DVBCTYPE,HD7,HD8,HD9,HD91,RDATE1,TPRT,XJ,RONAM,PNAM,^TMP($J)
"RTN","DVBCUTL3",10,0)
 K ZTQUEUED,ZIP4,ZIP,Z1,ZH,XRTN,XMVAR,XMRG,XMREC,XMER,XMCNT,XD,WRKSHT,VETST
"RTN","DVBCUTL3",11,0)
 K USER,USERNM
"RTN","DVBCUTL3",12,0)
 Q
"RTN","DVBCUTL3",13,0)
 ;
"RTN","DVBCUTL3",14,0)
LKILL K LRO,LR0,LRAA,LRAAO,LRCDT,LRCMNT,LRNIDT,LRCW,LRDATA,LRDFN,LRDN,LRDOC,LRDPF,LREDT,LREND,LRFFLG,LRFOOT,LRHF,LRHI,LRIDT,LRLAB,LRLO,LRMNIDT,LROC,LRONESPC,LRONETST,LRORN,LRPC,LRPO,LRSDT,LRSPEC,LRSS,LRSTOP,LRSUB,LRTC,LRCNIDT
"RTN","DVBCUTL3",15,0)
 K LRTHER,LRTSTS,LRWRD,RACNI,RAST,RPTR,OK,LRBLOOD,LRPARAM,LRPLASMA,LRSERUM,LRUNKNOW,LRURINE,LRPANEL,LRTM60,LRDT0,LRLABKY
"RTN","DVBCUTL3",16,0)
 Q
"RTN","DVBCUTL3",17,0)
 ;  **The following routines are called by DVBCREQ1 **
"RTN","DVBCUTL3",18,0)
DDIS1 S DXNUM=$P(^DPT(DFN,.372,DVBCXJI,0),U,1),PCT=$P(^(0),U,2)
"RTN","DVBCUTL3",19,0)
 S DVBCSC=$P(^(0),U,3)
"RTN","DVBCUTL3",20,0)
 S DVBCDX=$S($D(^DIC(31,DXNUM)):$P(^(DXNUM,0),U,1),1:"Unknown")
"RTN","DVBCUTL3",21,0)
 S DXCOD=$S($D(^DIC(31,DXNUM)):$P(^(DXNUM,0),U,3),1:"Unknown")
"RTN","DVBCUTL3",22,0)
 W ?2,DVBCDX,?37,$J(PCT,3,0)," %",?50,$S(DVBCSC=1:"Yes",1:"No")
"RTN","DVBCUTL3",23,0)
 W ?58,DXCOD,!
"RTN","DVBCUTL3",24,0)
 I IOST?1"C-".E W !,"VA Form 21-2507" D TERM
"RTN","DVBCUTL3",25,0)
 Q
"RTN","DVBCUTL3",26,0)
 ;
"RTN","DVBCUTL3",27,0)
DDIS ;display rated disabilities
"RTN","DVBCUTL3",28,0)
 I '$D(^DPT(DFN,.372)) W !?25,"No rated disabilities on file",!! Q
"RTN","DVBCUTL3",29,0)
 W !?2,"Rated Disability",?37,"Percent",?50,"SC ?",?58,"Dx Code",! W ?2 F LINE=1:1:63 W "-"
"RTN","DVBCUTL3",30,0)
 W !!
"RTN","DVBCUTL3",31,0)
 F DVBCXJI=0:0 S DVBCXJI=$O(^DPT(DFN,.372,DVBCXJI)) Q:DVBCXJI=""  D DDIS1  Q:($D(GETOUT))
"RTN","DVBCUTL3",32,0)
 W !!
"RTN","DVBCUTL3",33,0)
 Q
"RTN","DVBCUTL3",34,0)
 ;
"RTN","DVBCUTL3",35,0)
TST W ?3
"RTN","DVBCUTL3",36,0)
 F DA=0:0 S DA=$O(^DVB(396.4,"C",DA(1),DA)) Q:(DA="")!($D(GETOUT))  D CONTST
"RTN","DVBCUTL3",37,0)
 Q
"RTN","DVBCUTL3",38,0)
 ;
"RTN","DVBCUTL3",39,0)
CONTST K PRINT S TSTAT=$P(^DVB(396.4,DA,0),U,4)
"RTN","DVBCUTL3",40,0)
 S TST=$P(^DVB(396.4,DA,0),U,3)
"RTN","DVBCUTL3",41,0)
 S PRTNM=$S($D(^DVB(396.6,TST,0)):$P(^(0),U,2),1:"")
"RTN","DVBCUTL3",42,0)
 D TST1
"RTN","DVBCUTL3",43,0)
 Q
"RTN","DVBCUTL3",44,0)
 ;
"RTN","DVBCUTL3",45,0)
TST1 I $Y>(IOSL-3) W !,"VA Form 21-2507" I IOST?1"C-".E D TERM Q:($D(GETOUT))
"RTN","DVBCUTL3",46,0)
 S TSTA1=""
"RTN","DVBCUTL3",47,0)
 I $D(^DVB(396.4,DA,"CAN")) S TSTA1=$P(^DVB(396.4,DA,"CAN"),U,3)
"RTN","DVBCUTL3",48,0)
 I $D(^DVB(396.4,DA,"TRAN")) S X=$P(^DVB(396.4,DA,"TRAN"),U,3)
"RTN","DVBCUTL3",49,0)
 S:TSTA1]"" TSTA1=$P(^DVB(396.5,TSTA1,0),U,1) ;tsta1=cancellation reason
"RTN","DVBCUTL3",50,0)
 ;DVBA*132 - added Exam Ref# to end of Write command below
"RTN","DVBCUTL3",51,0)
 W:(($L(PRTNM)+$L(TSTA1)+$X)>55!($D(DVBAINSF))) !?1 W $S(PRTNM]"":PRTNM,1:"Missing exam name")_$S(TSTA1]"":" - cancelled ("_TSTA1_")",TSTAT="T":" - Transferred",TSTAT="":" (Unknown status)",1:"")," (Exam Ref#: ",DA,")"
"RTN","DVBCUTL3",52,0)
 I TSTAT="T" S X=$S($D(^DIC(4.2,+X,0)):$P(^(0),U,1),1:"unknown site") W " to ",$P(X,".",1)
"RTN","DVBCUTL3",53,0)
 W "; "
"RTN","DVBCUTL3",54,0)
 I $D(DVBAINSF) DO
"RTN","DVBCUTL3",55,0)
 .I +$P(^DVB(396.4,DA,0),U,11)>0 DO
"RTN","DVBCUTL3",56,0)
 ..I $Y>(IOSL-7) D BOT D:'$D(GETOUT) HDR^DVBCREQ1
"RTN","DVBCUTL3",57,0)
 ..I '$D(GETOUT) DO
"RTN","DVBCUTL3",58,0)
 ...S TVAR(1,0)="0,3,0,2,0^Insufficient Reason: "_$P(^DVB(396.94,$P(^DVB(396.4,DA,0),U,11),0),U,1)
"RTN","DVBCUTL3",59,0)
 ...S TVAR(2,0)="0,3,0,2:1,0^Insufficient Remarks: "
"RTN","DVBCUTL3",60,0)
 ...D WR^DVBAUTL4("TVAR")
"RTN","DVBCUTL3",61,0)
 ...K TVAR
"RTN","DVBCUTL3",62,0)
 ...I $D(^DVB(396.4,DA,"INREM")) DO
"RTN","DVBCUTL3",63,0)
 ....K ^UTILITY($J,"W")
"RTN","DVBCUTL3",64,0)
 ....S DIWL=5,DIWF="NW"
"RTN","DVBCUTL3",65,0)
 ....F LPCNT=0:0 S LPCNT=$O(^DVB(396.4,DA,"INREM",LPCNT)) Q:LPCNT=""!($D(GETOUT))  DO  ;**Loop Insufficient Remarks
"RTN","DVBCUTL3",66,0)
 .....S X=^DVB(396.4,DA,"INREM",LPCNT,0)
"RTN","DVBCUTL3",67,0)
 .....S:X="<" X=" <"
"RTN","DVBCUTL3",68,0)
 .....S X=$P(X,"<",1)
"RTN","DVBCUTL3",69,0)
 .....D ^DIWP ;**Print Insufficient Remarks
"RTN","DVBCUTL3",70,0)
 .....I $Y>(IOSL-8),$O(^DVB(396.4,DA,"INREM",LPCNT))]"" DO
"RTN","DVBCUTL3",71,0)
 ......D BOT D:'$D(GETOUT) HDR^DVBCREQ1,RMRK
"RTN","DVBCUTL3",72,0)
 ....D:'$D(GETOUT)&($O(^DVB(396.4,DA,"INREM",0))>0) ^DIWW
"RTN","DVBCUTL3",73,0)
 ...W !!
"RTN","DVBCUTL3",74,0)
 Q
"RTN","DVBCUTL3",75,0)
 ;
"RTN","DVBCUTL3",76,0)
TERM ;  ** If output to CRT, display 'Continue' prompt **
"RTN","DVBCUTL3",77,0)
 S DIR(0)="F,O^^",DIR("A")="Enter [Return] to continue or ""^"" to exit"
"RTN","DVBCUTL3",78,0)
 K GETOUT D ^DIR S:$D(DTOUT)!($D(DUOUT)) GETOUT=1
"RTN","DVBCUTL3",79,0)
 I '$D(GETOUT) W @IOF K DIR,DIRUT
"RTN","DVBCUTL3",80,0)
 Q
"RTN","DVBCUTL3",81,0)
 ;
"RTN","DVBCUTL3",82,0)
BOT ;**Write form # at bottom
"RTN","DVBCUTL3",83,0)
 I IOST?1"C-".E F LPCNT1=$Y:1:(IOSL-6) W !
"RTN","DVBCUTL3",84,0)
 I IOST'?1"C-".E F LPCNT1=$Y:1:(IOSL-4) W !
"RTN","DVBCUTL3",85,0)
 W !,"VA Form 21-2507"
"RTN","DVBCUTL3",86,0)
 I IOST?1"C-".E D TERM
"RTN","DVBCUTL3",87,0)
 Q
"RTN","DVBCUTL3",88,0)
 ;
"RTN","DVBCUTL3",89,0)
RMRK ;** Write remarks continued at top of page
"RTN","DVBCUTL3",90,0)
 W !!?3,"Insufficient remarks, continued",!!
"RTN","DVBCUTL3",91,0)
 Q
"RTN","DVBCUTL5")
0^6^B17533926^B16842075
"RTN","DVBCUTL5",1,0)
DVBCUTL5 ;ALB/GTS-AMIE C&P APPT LINK USER SEL RTNS ; 10/20/94  1:00 PM
"RTN","DVBCUTL5",2,0)
 ;;2.7;AMIE;**193**;Apr 10, 1995;Build 84
"RTN","DVBCUTL5",3,0)
 ;
"RTN","DVBCUTL5",4,0)
 ;** NOTICE: This routine is part of an implementation of a Nationally
"RTN","DVBCUTL5",5,0)
 ;**         Controlled Procedure.  Local modifications to this routine
"RTN","DVBCUTL5",6,0)
 ;**         are prohibited per VHA Directive 10-93-142
"RTN","DVBCUTL5",7,0)
 ;
"RTN","DVBCUTL5",8,0)
 ;** Version Changes
"RTN","DVBCUTL5",9,0)
 ;   2.7 - New routine (Enhc 13)
"RTN","DVBCUTL5",10,0)
 ;
"RTN","DVBCUTL5",11,0)
REQARY ;** Create Array of 2507's for veteran
"RTN","DVBCUTL5",12,0)
 ;
"RTN","DVBCUTL5",13,0)
 ;** If 2507 status=DVBASTAT, set node in ^TMP("DVBC",$J)
"RTN","DVBCUTL5",14,0)
 ;**  ^TMP("DVBC",$J) ordered from newest to oldest 2507
"RTN","DVBCUTL5",15,0)
 ;**  The following variables must be KILLed by the calling routine:
"RTN","DVBCUTL5",16,0)
 ;**   DVBAMORE, DVBALP, DVBAOUT, DVBADTOT, DVBAPNAM,DVBADA,DVBADFN
"RTN","DVBCUTL5",17,0)
 ;**   DVBADT,DVBAORD
"RTN","DVBCUTL5",18,0)
 ;**  NOTE: DVBASTAT must be defined before REQARY entry
"RTN","DVBCUTL5",19,0)
 S DVBACNT=0
"RTN","DVBCUTL5",20,0)
 ;
"RTN","DVBCUTL5",21,0)
 ;**  If entered from INSUF^DVBCLOG or DVBCMKLK and open
"RTN","DVBCUTL5",22,0)
 ;**   exam on current 2507, Set ^TMP
"RTN","DVBCUTL5",23,0)
 F  S DVBADA=$O(^DVB(396.3,"B",DVBADFN,DVBADA)) Q:DVBADA=""  DO
"RTN","DVBCUTL5",24,0)
 .;AJF;Request Status conversion ;
"RTN","DVBCUTL5",25,0)
 .I $$RSTAT^DVBCUTL8($P(^DVB(396.3,DVBADA,0),U,18))=DVBASTAT DO
"RTN","DVBCUTL5",26,0)
 ..S DVBAOPEN=$$OPENCHK(DVBADA) I +DVBAOPEN'>0 K DVBAOPEN
"RTN","DVBCUTL5",27,0)
 ..I '$D(DVBASDPR)!($D(DVBASDPR)&($D(DVBAOPEN))) DO
"RTN","DVBCUTL5",28,0)
 ...K DVBAOPEN
"RTN","DVBCUTL5",29,0)
 ...S DVBADT=$P(^DVB(396.3,DVBADA,0),"^",2),DVBACNT=DVBACNT+1
"RTN","DVBCUTL5",30,0)
 ...S ^TMP("DVBC",$J,9999999.999999-DVBADT,DVBADT,DVBADA)=""
"RTN","DVBCUTL5",31,0)
 Q
"RTN","DVBCUTL5",32,0)
 ;
"RTN","DVBCUTL5",33,0)
REQSEL ;** Select 2507
"RTN","DVBCUTL5",34,0)
 ;
"RTN","DVBCUTL5",35,0)
 ;**  Loop ^TMP array, display 2507's in groups of 5
"RTN","DVBCUTL5",36,0)
 ;**  ^TMP subscripts:
"RTN","DVBCUTL5",37,0)
 ;**    ^TMP("DVBC",$J,9999999.999999-2507 Request date int,
"RTN","DVBCUTL5",38,0)
 ;**         Request date int, Request DA)
"RTN","DVBCUTL5",39,0)
 W !!,"Select a 2507 request",!
"RTN","DVBCUTL5",40,0)
 S DVBAORD=""
"RTN","DVBCUTL5",41,0)
 S DVBAPNAM=$P(^DPT(DVBADFN,0),"^",1)
"RTN","DVBCUTL5",42,0)
 F DVBALP=1:1 S DVBAORD=$O(^TMP("DVBC",$J,DVBAORD)) Q:DVBAORD=""  DO
"RTN","DVBCUTL5",43,0)
 .S (DVBADT,DVBADA)=""
"RTN","DVBCUTL5",44,0)
 .S DVBADT=$O(^TMP("DVBC",$J,DVBAORD,DVBADT))
"RTN","DVBCUTL5",45,0)
 .S DVBADA=$O(^TMP("DVBC",$J,DVBAORD,DVBADT,DVBADA))
"RTN","DVBCUTL5",46,0)
 .K Y S Y=DVBADT X ^DD("DD")
"RTN","DVBCUTL5",47,0)
 .W !,?5,DVBALP,?8," ",DVBAPNAM,?40,"  Request date: ",Y
"RTN","DVBCUTL5",48,0)
 .S DVBAMORE=$O(^TMP("DVBC",$J,DVBAORD))
"RTN","DVBCUTL5",49,0)
 .I +DVBAMORE'>0 D SELREQ ;**No more entries
"RTN","DVBCUTL5",50,0)
 .I (+DVBAMORE>0)&(DVBALP#5=0) DO  ;**More entries exist, 5 displayed
"RTN","DVBCUTL5",51,0)
 ..W !,"ENTER '^' TO STOP, OR"
"RTN","DVBCUTL5",52,0)
 ..D SELREQ
"RTN","DVBCUTL5",53,0)
 Q
"RTN","DVBCUTL5",54,0)
 ;
"RTN","DVBCUTL5",55,0)
FINDDA ;** Loop ^TMP, get 396.3 DA
"RTN","DVBCUTL5",56,0)
 F DVBALP=1:1:DVBASEL S DVBAORD=$O(^TMP("DVBC",$J,DVBAORD)) DO
"RTN","DVBCUTL5",57,0)
 .S (DVBADT,DVBADA)=""
"RTN","DVBCUTL5",58,0)
 .S DVBADT=$O(^TMP("DVBC",$J,DVBAORD,DVBADT))
"RTN","DVBCUTL5",59,0)
 .S DVBADA=$O(^TMP("DVBC",$J,DVBAORD,DVBADT,DVBADA))
"RTN","DVBCUTL5",60,0)
 Q
"RTN","DVBCUTL5",61,0)
 ;
"RTN","DVBCUTL5",62,0)
SELREQ ;** Select 2507 from ^TMP
"RTN","DVBCUTL5",63,0)
 K DVBAOUT
"RTN","DVBCUTL5",64,0)
 S DIR(0)="NOA^1:"_DVBALP_"^K:X[""."" X"
"RTN","DVBCUTL5",65,0)
 S DIR("?")="Select a 2507 request by entering it's associated number"
"RTN","DVBCUTL5",66,0)
 S DIR("A")="CHOOSE 1-"_DVBALP_": " D ^DIR
"RTN","DVBCUTL5",67,0)
 I $D(DTOUT)!($D(DUOUT)) S DVBAORD="9999999.999999",DVBAOUT=""
"RTN","DVBCUTL5",68,0)
 I '$D(DTOUT)&('$D(DUOUT)) S:+Y>0 DVBAORD="9999999.999999"
"RTN","DVBCUTL5",69,0)
 S:$D(DTOUT) DVBADTOT=""
"RTN","DVBCUTL5",70,0)
 W !
"RTN","DVBCUTL5",71,0)
 K DTOUT,DUOUT,DIR
"RTN","DVBCUTL5",72,0)
 Q
"RTN","DVBCUTL5",73,0)
 ;
"RTN","DVBCUTL5",74,0)
OPENCHK(REQDA) ;** Check for open exam on 2507
"RTN","DVBCUTL5",75,0)
 N LPDA,QVAR
"RTN","DVBCUTL5",76,0)
 S LPDA=""
"RTN","DVBCUTL5",77,0)
 F  S LPDA=$O(^DVB(396.4,"C",REQDA,LPDA)) Q:'LPDA!($D(QVAR))  DO
"RTN","DVBCUTL5",78,0)
 .I $P(^DVB(396.4,LPDA,0),U,4)="O" DO
"RTN","DVBCUTL5",79,0)
 ..S:'$D(QVAR) QVAR=LPDA
"RTN","DVBCUTL5",80,0)
 S:'$D(QVAR) QVAR=""
"RTN","DVBCUTL5",81,0)
 Q +QVAR
"RTN","DVBCUTL5",82,0)
 ;
"RTN","DVBCUTL5",83,0)
REQPAT() ;** Select patient who has 2507's
"RTN","DVBCUTL5",84,0)
 S DIC(0)="AEMQ",DIC("A")="Select C&P Veteran Name: ",DIC="^DPT("
"RTN","DVBCUTL5",85,0)
 S DIC("S")="I $D(^DVB(396.3,""B"",+Y))" D ^DIC K DIC
"RTN","DVBCUTL5",86,0)
 Q +Y
"RTN","DVBCUTL5",87,0)
 ;
"RTN","DVBCUTL5",88,0)
CPPATARY(DVBADFN) ;** Set ^TMP of 2507's for vet
"RTN","DVBCUTL5",89,0)
 ;
"RTN","DVBCUTL5",90,0)
 ;**  ^TMP array ordered newest to oldest
"RTN","DVBCUTL5",91,0)
 ;**  DVBACNT to be killed by calling routine
"RTN","DVBCUTL5",92,0)
 N REQDA,REQDT,REQ
"RTN","DVBCUTL5",93,0)
 S DVBACNT=0
"RTN","DVBCUTL5",94,0)
 S REQDA=""
"RTN","DVBCUTL5",95,0)
 F  S REQDA=$O(^DVB(396.3,"B",DVBADFN,REQDA)) Q:REQDA=""  DO
"RTN","DVBCUTL5",96,0)
 .S REQ=$G(^DVB(396.3,REQDA,0))
"RTN","DVBCUTL5",97,0)
 .;AJF;Request Status conversion ;changed "N" to 1
"RTN","DVBCUTL5",98,0)
 .I +$P(REQ,U,2)>0,($P(REQ,U,18)'=1) DO
"RTN","DVBCUTL5",99,0)
 ..I $P(REQ,U,18)'="" DO
"RTN","DVBCUTL5",100,0)
 ...S REQDT=$P(REQ,"^",2),DVBACNT=DVBACNT+1
"RTN","DVBCUTL5",101,0)
 ...S ^TMP("DVBC",$J,9999999.999999-REQDT,REQDT,REQDA)=""
"RTN","DVBCUTL5",102,0)
 Q
"RTN","DVBCUTL5",103,0)
 ;
"RTN","DVBCUTL5",104,0)
NO2507 ;** 2507 not selected, error
"RTN","DVBCUTL5",105,0)
 S DIR("A",1)="You have not selected a 2507 request to link a C&P appointment to."
"RTN","DVBCUTL5",106,0)
 S DIR("A",2)="This is required to continue processing with the AMIE link management option."
"RTN","DVBCUTL5",107,0)
 S DIR("A",3)=" "
"RTN","DVBCUTL5",108,0)
 S DIR(0)="FAO^1:1",DIR("A")="Hit Return to continue." D ^DIR K DIR,X,Y
"RTN","DVBCUTL5",109,0)
 Q
"RTN","DVBCUTL5",110,0)
 ;
"RTN","DVBCUTL5",111,0)
SDEVTSPC(DVBAPCE) ;**Return piece of 'S' node in Sched event
"RTN","DVBCUTL5",112,0)
 N DVBASPCV
"RTN","DVBCUTL5",113,0)
 S DVBASPCV=""
"RTN","DVBCUTL5",114,0)
 S:($D(^TMP("SDEVT",$J,SDHDL,1,"DPT",0,"AFTER"))) DVBASPCV=$P(^TMP("SDEVT",$J,SDHDL,1,"DPT",0,"AFTER"),U,DVBAPCE)
"RTN","DVBCUTL5",115,0)
 Q DVBASPCV
"RTN","DVBCUTL5",116,0)
 ;
"RTN","DVBCUTL5",117,0)
SDEVTXST() ;** Check ^TMP("SDEVT",$J) existence
"RTN","DVBCUTL5",118,0)
 Q $D(^TMP("SDEVT",$J,SDHDL,1,"DPT",0,"AFTER"))
"RTN","DVBCUTL5",119,0)
 ;
"RTN","DVBCUTL5",120,0)
SDORGST() ;** Return value of SD Event originating process
"RTN","DVBCUTL5",121,0)
 N DVBAVAR
"RTN","DVBCUTL5",122,0)
 S DVBAVAR=""
"RTN","DVBCUTL5",123,0)
 Q $O(^TMP("SDEVT",$J,SDHDL,DVBAVAR))
"RTN","DVBCUTL5",124,0)
 ;
"RTN","DVBCUTL8")
0^55^B98535168^B17624545
"RTN","DVBCUTL8",1,0)
DVBCUTL8 ;ALB/GTS-AMIE C&P APPT LINK FILE MNT RTNS 2 ; 10/20/94  3:30 PM
"RTN","DVBCUTL8",2,0)
 ;;2.7;AMIE;**193**;Apr 10, 1995;Build 84
"RTN","DVBCUTL8",3,0)
 ;
"RTN","DVBCUTL8",4,0)
 ;** NOTICE: This routine is part of an implementation of a Nationally
"RTN","DVBCUTL8",5,0)
 ;**         Controlled Procedure.  Local modifications to this routine
"RTN","DVBCUTL8",6,0)
 ;**         are prohibited per VHA Directive 10-93-142
"RTN","DVBCUTL8",7,0)
 ;
"RTN","DVBCUTL8",8,0)
 ;** Version Changes
"RTN","DVBCUTL8",9,0)
 ;   2.7 - New routine (Enhc 13)
"RTN","DVBCUTL8",10,0)
 Q
"RTN","DVBCUTL8",11,0)
 ;
"RTN","DVBCUTL8",12,0)
FIXLK ;** Re-attach unlinked appt to new appt
"RTN","DVBCUTL8",13,0)
 ;
"RTN","DVBCUTL8",14,0)
 ;** ^TMP("DVBC",$J,) must have nodes:
"RTN","DVBCUTL8",15,0)
 ;**    ORIGINAL APPT DATE, CURRENT APPT DATE, VETERAN CANCELLATION,
"RTN","DVBCUTL8",16,0)
 ;**    VETERAN REQ APPT DATE, APPOINTMENT STATUS = appt to be linked
"RTN","DVBCUTL8",17,0)
 ;
"RTN","DVBCUTL8",18,0)
 N REQDT,SAVY
"RTN","DVBCUTL8",19,0)
 S:$D(Y) SAVY=Y
"RTN","DVBCUTL8",20,0)
 S REQDT=$$GETDTE^DVBCMKLK(DVBADA) ;**Set REQDT
"RTN","DVBCUTL8",21,0)
 S:$D(SAVY) Y=SAVY
"RTN","DVBCUTL8",22,0)
 S DIR("A",1)="Adjusting C&P appointment link for 2507 request dated "_REQDT_"."
"RTN","DVBCUTL8",23,0)
 S DIR("A",2)=" "
"RTN","DVBCUTL8",24,0)
 S DIR(0)="FAO^1:1",DIR("A")="Hit Return to continue." D ^DIR K DIR,X,Y
"RTN","DVBCUTL8",25,0)
 N ORIGAPPT,CURRAPPT,VETCANC,APPTSTAT,APPTNODE,VETDTE,INITAPPT
"RTN","DVBCUTL8",26,0)
 S VETDTE=""
"RTN","DVBCUTL8",27,0)
 S ORIGAPPT=^TMP("DVBC",$J,"ORIGINAL APPT DATE")
"RTN","DVBCUTL8",28,0)
 S CURRAPPT=^TMP("DVBC",$J,"CURRENT APPT DATE")
"RTN","DVBCUTL8",29,0)
 S VETCANC=^TMP("DVBC",$J,"VETERAN CANCELLATION")
"RTN","DVBCUTL8",30,0)
 S:$D(^TMP("DVBC",$J,"VETERAN REQ APPT DATE")) VETDTE=^TMP("DVBC",$J,"VETERAN REQ APPT DATE")
"RTN","DVBCUTL8",31,0)
 S APPTSTAT=^TMP("DVBC",$J,"APPOINTMENT STATUS")
"RTN","DVBCUTL8",32,0)
 K DA,DIE,DR
"RTN","DVBCUTL8",33,0)
 ;
"RTN","DVBCUTL8",34,0)
 ;** Only one current appt date/time for vet can exist in 396.95
"RTN","DVBCUTL8",35,0)
 S DA="" S DA=DVBAOLDA
"RTN","DVBCUTL8",36,0)
 S APPTNODE=^DVB(396.95,DA,0) ;**APPTNODE 396.95 rec before mods
"RTN","DVBCUTL8",37,0)
 S DIE="^DVB(396.95,",DR=""
"RTN","DVBCUTL8",38,0)
 ;
"RTN","DVBCUTL8",39,0)
 ;** If 396.95 initial appt lost, set to original appt
"RTN","DVBCUTL8",40,0)
 I $P(APPTNODE,U,1)="",($P(APPTNODE,U,2)'="") S INITAPPT=$P(APPTNODE,U,2)
"RTN","DVBCUTL8",41,0)
 I $P(APPTNODE,U,1)="" S DR=".01////^S X=INITAPPT;"
"RTN","DVBCUTL8",42,0)
 I $P(APPTNODE,U,4)'=1 S DR=DR_".02////^S X=ORIGAPPT;"
"RTN","DVBCUTL8",43,0)
 S DR=DR_".03////^S X=CURRAPPT;"
"RTN","DVBCUTL8",44,0)
 I $P(APPTNODE,U,4)'=1 S DR=DR_".04////^S X=VETCANC;"
"RTN","DVBCUTL8",45,0)
 I VETCANC=1 S DR=DR_".05////^S X=VETDTE;" ;**Update last vet req date
"RTN","DVBCUTL8",46,0)
 S DR=DR_".07////^S X=APPTSTAT"
"RTN","DVBCUTL8",47,0)
 D ^DIE K DIE,DA,DR
"RTN","DVBCUTL8",48,0)
 Q
"RTN","DVBCUTL8",49,0)
 ;
"RTN","DVBCUTL8",50,0)
ADDLK ;** Add link from 2507 to appt
"RTN","DVBCUTL8",51,0)
 ;
"RTN","DVBCUTL8",52,0)
 ;** ^TMP("DVBC",$J,) nodes:
"RTN","DVBCUTL8",53,0)
 ;**    ORIGINAL APPT DATE, CURRENT APPT DATE, VETERAN CANCELLATION,
"RTN","DVBCUTL8",54,0)
 ;**    VETERAN REQ APPT DATE, APPOINTMENT STATUS = appt to be linked
"RTN","DVBCUTL8",55,0)
 ;
"RTN","DVBCUTL8",56,0)
 N REQDT,SAVY
"RTN","DVBCUTL8",57,0)
 S:$D(Y) SAVY=Y
"RTN","DVBCUTL8",58,0)
 S REQDT=$$GETDTE^DVBCMKLK(DVBADA) ;**Set REQDT
"RTN","DVBCUTL8",59,0)
 S:$D(SAVY) Y=SAVY
"RTN","DVBCUTL8",60,0)
 S DIR("A",1)="Adding new C&P appointment link for 2507 request dated "_REQDT_"."
"RTN","DVBCUTL8",61,0)
 S DIR("A",2)=" "
"RTN","DVBCUTL8",62,0)
 S DIR(0)="FAO^1:1",DIR("A")="Hit Return to continue." D ^DIR K DIR,X,Y
"RTN","DVBCUTL8",63,0)
 N ORIGAPPT,CURRAPPT,VETCANC,APPTSTAT,APPTNODE,VETDTE
"RTN","DVBCUTL8",64,0)
 S VETDTE=""
"RTN","DVBCUTL8",65,0)
 S ORIGAPPT=^TMP("DVBC",$J,"ORIGINAL APPT DATE")
"RTN","DVBCUTL8",66,0)
 S CURRAPPT=^TMP("DVBC",$J,"CURRENT APPT DATE")
"RTN","DVBCUTL8",67,0)
 S VETCANC=^TMP("DVBC",$J,"VETERAN CANCELLATION")
"RTN","DVBCUTL8",68,0)
 S:$D(^TMP("DVBC",$J,"VETERAN REQ APPT DATE")) VETDTE=^TMP("DVBC",$J,"VETERAN REQ APPT DATE")
"RTN","DVBCUTL8",69,0)
 S APPTSTAT=^TMP("DVBC",$J,"APPOINTMENT STATUS")
"RTN","DVBCUTL8",70,0)
 K DA,DIC,X,DD,DO
"RTN","DVBCUTL8",71,0)
 S X=^TMP("DVBC",$J,"INITIAL APPT DATE")
"RTN","DVBCUTL8",72,0)
 S DIC="^DVB(396.95,",DIC(0)="L",DIC("DR")=""
"RTN","DVBCUTL8",73,0)
 S DIC("DR")=DIC("DR")_".02////^S X=ORIGAPPT;.03////^S X=CURRAPPT;"
"RTN","DVBCUTL8",74,0)
 S DIC("DR")=DIC("DR")_".04////^S X=VETCANC;.05////^S X=VETDTE;"
"RTN","DVBCUTL8",75,0)
 S DIC("DR")=DIC("DR")_".06////^S X=DVBADA;.07////^S X=APPTSTAT"
"RTN","DVBCUTL8",76,0)
 D FILE^DICN
"RTN","DVBCUTL8",77,0)
 I +Y'>0 DO
"RTN","DVBCUTL8",78,0)
 .S DIR("A",1)="The C&P appointment link was not properly added.  Please investigate the"
"RTN","DVBCUTL8",79,0)
 .S DIR("A",2)="appointment scheduled for "_ORIGAPPT_" for "_$P(^DPT(DVBADFN,0),U,1)
"RTN","DVBCUTL8",80,0)
 .S DIR("A",3)=" "
"RTN","DVBCUTL8",81,0)
 .S DIR(0)="FAO^1:1",DIR("A")="Hit Return to continue." D ^DIR K DIR,X,Y
"RTN","DVBCUTL8",82,0)
 K DIC,DA,X,Y
"RTN","DVBCUTL8",83,0)
 Q
"RTN","DVBCUTL8",84,0)
 ;
"RTN","DVBCUTL8",85,0)
STYLE(REQDA) ;** Return indication of 2507 status matching integ report type
"RTN","DVBCUTL8",86,0)
 N STATIND,REQSTAT,STYLEIND,PARAMDA
"RTN","DVBCUTL8",87,0)
 S STATIND=0 ;**Leave set to zero if STYLEIND=4
"RTN","DVBCUTL8",88,0)
 S REQSTAT=$$RSTAT($P(^DVB(396.3,REQDA,0),U,18))
"RTN","DVBCUTL8",89,0)
 S PARAMDA=0
"RTN","DVBCUTL8",90,0)
 S PARAMDA=$O(^DVB(396.1,PARAMDA))
"RTN","DVBCUTL8",91,0)
 S STYLEIND=$P(^DVB(396.1,PARAMDA,0),U,15)
"RTN","DVBCUTL8",92,0)
 I STYLEIND="1" S:"P^S"[REQSTAT STATIND=1
"RTN","DVBCUTL8",93,0)
 I STYLEIND="2" S:"R^C"[REQSTAT STATIND=1
"RTN","DVBCUTL8",94,0)
 I STYLEIND="3" S STATIND=1
"RTN","DVBCUTL8",95,0)
 Q +STATIND
"RTN","DVBCUTL8",96,0)
 ;
"RTN","DVBCUTL8",97,0)
SELLNK(REQDA) ;** Return IEN from 396.95 for link to modify
"RTN","DVBCUTL8",98,0)
 N SELDA
"RTN","DVBCUTL8",99,0)
 D LNKARY^DVBCUTA3(REQDA,DVBADFN) ;**Set up link array
"RTN","DVBCUTL8",100,0)
 I '$D(TMP("DVBC LINK")) DO
"RTN","DVBCUTL8",101,0)
 .S SELDA=0,DVBANOLK=""
"RTN","DVBCUTL8",102,0)
 .D NOLNK^DVBCLKT2
"RTN","DVBCUTL8",103,0)
 I $D(TMP("DVBC LINK")) DO
"RTN","DVBCUTL8",104,0)
 .I '$D(DVBAAPT) DO
"RTN","DVBCUTL8",105,0)
 ..S Y=$P(SDATA,U,3)
"RTN","DVBCUTL8",106,0)
 ..X ^DD("DD")
"RTN","DVBCUTL8",107,0)
 ..S DVBAAPT=Y
"RTN","DVBCUTL8",108,0)
 ..S DVBAAPST=""
"RTN","DVBCUTL8",109,0)
 .D LINKDISP^DVBCUTA1
"RTN","DVBCUTL8",110,0)
 .I $D(DVBAAPST) K DVBAAPT,DVBAAPST
"RTN","DVBCUTL8",111,0)
 K Y
"RTN","DVBCUTL8",112,0)
 Q +SELDA
"RTN","DVBCUTL8",113,0)
 ;
"RTN","DVBCUTL8",114,0)
 ;AJF; Request Status Conversion
"RTN","DVBCUTL8",115,0)
RSTAT(RSP) ;**Return Request Status Code from 396.33
"RTN","DVBCUTL8",116,0)
 ;RSP - IEN for file 396.33
"RTN","DVBCUTL8",117,0)
 Q:'$D(RSP) ""
"RTN","DVBCUTL8",118,0)
 Q:'+RSP ""
"RTN","DVBCUTL8",119,0)
 Q:'$D(^DVB(396.33,RSP,0)) ""
"RTN","DVBCUTL8",120,0)
 Q $P(^DVB(396.33,RSP,0),"^",2)
"RTN","DVBCUTL8",121,0)
 ;
"RTN","DVBCUTL8",122,0)
 ;AJF; Request Status Conversion
"RTN","DVBCUTL8",123,0)
RTSTAT(RSP) ;**Return Status (External) from 396.33
"RTN","DVBCUTL8",124,0)
 ;RSP - IEN for file 396.33
"RTN","DVBCUTL8",125,0)
 Q:'$D(RSP) ""
"RTN","DVBCUTL8",126,0)
 Q:'+RSP ""
"RTN","DVBCUTL8",127,0)
 Q:'$D(^DVB(396.33,RSP,0)) ""
"RTN","DVBCUTL8",128,0)
 Q $P(^DVB(396.33,RSP,0),"^",1)
"RTN","DVBCUTL8",129,0)
 ;
"RTN","DVBCUTL8",130,0)
 ;AJF ; Reroute function
"RTN","DVBCUTL8",131,0)
REROST(RTN,RSP) ;**Returns 1 if this Request is able to be rerouted
"RTN","DVBCUTL8",132,0)
 ;RPC: DVBA CAPRI GET REROUTE
"RTN","DVBCUTL8",133,0)
 ;RSP - IEN for file 396.3
"RTN","DVBCUTL8",134,0)
 ;RTN - Return value 1 for yes  0 for no
"RTN","DVBCUTL8",135,0)
 Q:'$D(RSP) 0
"RTN","DVBCUTL8",136,0)
 Q:'+RSP 0
"RTN","DVBCUTL8",137,0)
 Q:'$D(^DVB(396.3,RSP,0)) 0
"RTN","DVBCUTL8",138,0)
 N CSITE,RSTA,FSITE
"RTN","DVBCUTL8",139,0)
 S RTN=0
"RTN","DVBCUTL8",140,0)
 S CSITE=$P($$SITE^VASITE,"^",3)
"RTN","DVBCUTL8",141,0)
 S FSITE=$S('$D(^DVB(396.3,RSP,6,1,2)):CSITE,1:$P(^DVB(396.3,RSP,6,1,2),"^",4))
"RTN","DVBCUTL8",142,0)
 S RSTA=$P(^DVB(396.3,RSP,0),"^",18)
"RTN","DVBCUTL8",143,0)
 I CSITE=FSITE S:RSTA=1!(RSTA=2)!(RSTA=12) RTN=1
"RTN","DVBCUTL8",144,0)
 S RTN=RTN_"^"_CSITE
"RTN","DVBCUTL8",145,0)
 Q
"RTN","DVBCUTL8",146,0)
 ;
"RTN","DVBCUTL8",147,0)
CDIV(RTN,SITE) ;AJF ; Provides list from CAPRI DIVISION EXAM (396.15
"RTN","DVBCUTL8",148,0)
 ;RPC DVBA CAPRI GET DIVISION
"RTN","DVBCUTL8",149,0)
 ;RTN - Return list of active divisions "^" Division IEN
"RTN","DVBCUTL8",150,0)
 ;
"RTN","DVBCUTL8",151,0)
 N CNT,DN,DVP,DV0,FNUM
"RTN","DVBCUTL8",152,0)
 S I=0,RTN(1)="No active CAPRI Divisions"
"RTN","DVBCUTL8",153,0)
 F  S I=$O(^DVB(396.15,I)) Q:I="B"!(I="")  D
"RTN","DVBCUTL8",154,0)
 . Q:$P($G(^DVB(396.15,I,3)),"^")="Y"
"RTN","DVBCUTL8",155,0)
 . S CNT=$G(CNT)+1,DVP=$P(^DVB(396.15,I,0),"^")
"RTN","DVBCUTL8",156,0)
 . Q:DVP=""
"RTN","DVBCUTL8",157,0)
 . S DV0=$G(^DG(40.8,DVP,0))
"RTN","DVBCUTL8",158,0)
 . S DN=$P(DV0,"^",1),FNUM=$P(DV0,"^",2)
"RTN","DVBCUTL8",159,0)
 . S RTN(CNT)=DN_"  "_FNUM_"^"_I
"RTN","DVBCUTL8",160,0)
 Q
"RTN","DVBCUTL8",161,0)
 ;
"RTN","DVBCUTL8",162,0)
CDIVC(RTN,DIV) ;AJF; Provides comments for GUI
"RTN","DVBCUTL8",163,0)
 ; RPC: DVBA CAPRI GET DIV COMMENT
"RTN","DVBCUTL8",164,0)
 ; RTN - Return comment
"RTN","DVBCUTL8",165,0)
 ; DIV - Division IEN
"RTN","DVBCUTL8",166,0)
 N I
"RTN","DVBCUTL8",167,0)
 S I=0,RTN(1)="No Division comment available "
"RTN","DVBCUTL8",168,0)
 Q:'$D(DIV)
"RTN","DVBCUTL8",169,0)
 Q:'+DIV
"RTN","DVBCUTL8",170,0)
 F  S I=$O(^DVB(396.15,DIV,2,I)) Q:I=""  D
"RTN","DVBCUTL8",171,0)
 .Q:'$D(^DVB(396.15,DIV,2,I,0))
"RTN","DVBCUTL8",172,0)
 . S RTN(I)=^DVB(396.15,DIV,2,I,0)
"RTN","DVBCUTL8",173,0)
 Q
"RTN","DVBCUTL8",174,0)
CDIVE(RTN,DIV) ;AJF ; Provides list of active exams
"RTN","DVBCUTL8",175,0)
 ; RPC: DVBA CAPRI GET DIV EXAM
"RTN","DVBCUTL8",176,0)
 ; RTN - Return exam 
"RTN","DVBCUTL8",177,0)
 ; DIV - Division IEN
"RTN","DVBCUTL8",178,0)
 N C2,C3,EN,CNT
"RTN","DVBCUTL8",179,0)
 S (C2,CNT)=0,RTN(1)="No exam found"
"RTN","DVBCUTL8",180,0)
 Q:'$D(DIV)
"RTN","DVBCUTL8",181,0)
 Q:'+DIV
"RTN","DVBCUTL8",182,0)
 F  S C2=$O(^DVB(396.15,DIV,1,C2)) Q:C2="B"!(CNT=100)  D
"RTN","DVBCUTL8",183,0)
 . Q:"DEFAULT "'[$E(^DVB(396.15,DIV,1,C2,0),1,7)
"RTN","DVBCUTL8",184,0)
 . S C3=0
"RTN","DVBCUTL8",185,0)
 . F  S C3=$O(^DVB(396.15,DIV,1,C2,3,C3)) Q:C3=""!(CNT=100)  D
"RTN","DVBCUTL8",186,0)
 .. Q:'$D(^DVB(396.15,DIV,1,C2,3,C3,0))
"RTN","DVBCUTL8",187,0)
 .. Q:$G(^DVB(396.15,DIV,1,C2,3,C3,2))'="Y"
"RTN","DVBCUTL8",188,0)
 .. S EN=$P(^DVB(396.15,DIV,1,C2,3,C3,0),"^")
"RTN","DVBCUTL8",189,0)
 .. S EN=$$EXTERNAL^DILFD(396.1514,.01,,EN,)
"RTN","DVBCUTL8",190,0)
 .. S CNT=CNT+1,RTN(CNT)=EN
"RTN","DVBCUTL8",191,0)
 Q
"RTN","DVBCUTL8",192,0)
 ;
"RTN","DVBCUTL8",193,0)
ARC(RTN) ;AJF ;7/15/2016 Returns all active Reroute Code
"RTN","DVBCUTL8",194,0)
 ; RPC: DVBA CAPRI GET REROUTE CODE
"RTN","DVBCUTL8",195,0)
 ; RTN - Return exam 
"RTN","DVBCUTL8",196,0)
 ; 
"RTN","DVBCUTL8",197,0)
 N CT,C1,R0,R2
"RTN","DVBCUTL8",198,0)
 S CT=0
"RTN","DVBCUTL8",199,0)
 F  S CT=$O(^DVB(396.55,CT)) Q:CT="B"  D
"RTN","DVBCUTL8",200,0)
 . S R0=^DVB(396.55,CT,0)
"RTN","DVBCUTL8",201,0)
 . Q:$P(R0,"^",2)="I"
"RTN","DVBCUTL8",202,0)
 . S C1=$G(C1)+1
"RTN","DVBCUTL8",203,0)
 . S RTN(C1)=CT_"^"_$P(R0,"^")
"RTN","DVBCUTL8",204,0)
 Q
"RTN","DVBCUTL8",205,0)
 ;
"RTN","DVBCUTL8",206,0)
RINFO(RTN,RIEN) ;AJF; Returns reroute information for a given 2507 Request
"RTN","DVBCUTL8",207,0)
 ;RPC: DVBA CAPRI REROUTE INFO
"RTN","DVBCUTL8",208,0)
 ;Input
"RTN","DVBCUTL8",209,0)
 ; RIEN: 2507 Request IEN
"RTN","DVBCUTL8",210,0)
 ;
"RTN","DVBCUTL8",211,0)
 ;Output
"RTN","DVBCUTL8",212,0)
 ;  REROUTE TO^REROUTE DATE^REROUTE STATUS^STATUS DATE^REROUTED FROM^ REROUTE REASON ^ REJECT REASON
"RTN","DVBCUTL8",213,0)
 ;  ^ 0 for site A/ 1 for site B or C
"RTN","DVBCUTL8",214,0)
 ;
"RTN","DVBCUTL8",215,0)
 N RTD,RTF,RTO,RTS,RTSD,RRD,RRD,J1,J2,J10,J20,J4
"RTN","DVBCUTL8",216,0)
 N REJR,RRW1,RRW2,RUSR,RDIV,RTDIV,RFDIV,CST,CRQ
"RTN","DVBCUTL8",217,0)
 I RIEN="" S RTN="0^Missing 2507 Request IEN" Q
"RTN","DVBCUTL8",218,0)
 I '$D(^DVB(396.3,RIEN,0)) S RTN="0^Not a valid 2507 Request IEN" Q
"RTN","DVBCUTL8",219,0)
 I '$D(^DVB(396.3,RIEN,6,0)) S RTN="0^This 2507 Request has not been Rerouted" Q
"RTN","DVBCUTL8",220,0)
 ;
"RTN","DVBCUTL8",221,0)
 S J1=$O(^DVB(396.3,RIEN,6,99999),-1)
"RTN","DVBCUTL8",222,0)
 S J2=$O(^DVB(396.3,RIEN,6,J1,1,99999),-1)
"RTN","DVBCUTL8",223,0)
 I J2="" S RTN="0^This 2507 Request has not been Rerouted" Q
"RTN","DVBCUTL8",224,0)
 S J10=^DVB(396.3,RIEN,6,J1,0),J20=^DVB(396.3,RIEN,6,J1,1,J2,0)
"RTN","DVBCUTL8",225,0)
 S J4=$G(^DVB(396.3,RIEN,6,J1,2))
"RTN","DVBCUTL8",226,0)
 S REJR=$G(^DVB(396.3,RIEN,6,J1,1,J2,1))
"RTN","DVBCUTL8",227,0)
 S RTD=$$EXTERNAL^DILFD(396.34,.01,,$P(J10,"^",1))
"RTN","DVBCUTL8",228,0)
 S RTO=$$EXTERNAL^DILFD(396.34,.02,,$P(J10,"^",7))
"RTN","DVBCUTL8",229,0)
 S RTF=$$EXTERNAL^DILFD(396.34,3,,$P(J10,"^",4))
"RTN","DVBCUTL8",230,0)
 S RTSD=$$EXTERNAL^DILFD(396.341,.01,,$P(J20,"^",1))
"RTN","DVBCUTL8",231,0)
 S RTS=$$EXTERNAL^DILFD(396.341,1,,$P(J20,"^",2))
"RTN","DVBCUTL8",232,0)
 S RRR=$$EXTERNAL^DILFD(396.34,4,,$P(J10,"^",5))
"RTN","DVBCUTL8",233,0)
 S RRD=$G(^DVB(396.3,RIEN,6,J1,1))
"RTN","DVBCUTL8",234,0)
 S RTDIV=$$EXTERNAL^DILFD(396.3,24,,$P(^DVB(396.3,RIEN,1),"^",4))
"RTN","DVBCUTL8",235,0)
 S RFDIV=$$EXTERNAL^DILFD(396.34,8,,$P(J10,"^",9))
"RTN","DVBCUTL8",236,0)
 ;
"RTN","DVBCUTL8",237,0)
 S CSITE=+$$SITE^VASITE,CRQ=$P(^DVB(396.3,RIEN,0),"^",18),RRW1=0
"RTN","DVBCUTL8",238,0)
 I CSITE=$P(J4,"^",1)&(CSITE=$P(J4,"^",3)) S RRW1=1
"RTN","DVBCUTL8",239,0)
 S RRW2=$S(RRW1:1,CSITE=$P(J4,"^",3):0,1:1)
"RTN","DVBCUTL8",240,0)
 S CST=$S(RRW2=0:0,CRQ=14:1,CRQ=11:1,1:0)
"RTN","DVBCUTL8",241,0)
 ;
"RTN","DVBCUTL8",242,0)
 S RTN(1)=RTO_"^"_RTD_"^"_RTS_"^"_RTSD_"^"_RTF_"^"_RRR_"^"_CST_"^"_RFDIV_"^"_RTDIV
"RTN","DVBCUTL8",243,0)
 S RTN(2)=RRD
"RTN","DVBCUTL8",244,0)
 S RTN(3)=REJR
"RTN","DVBCUTL8",245,0)
 ;
"RTN","DVBCUTL8",246,0)
 Q
"RTN","DVBCUTL8",247,0)
RPRO(RTN,RIEN,RRST,RRR) ; AJF; 7/25/2016; Update Reroute Status
"RTN","DVBCUTL8",248,0)
 ;RPC: DVBA CAPRI REROUTE STATUS
"RTN","DVBCUTL8",249,0)
 ;Input:
"RTN","DVBCUTL8",250,0)
 ;  RIEN = 2507 Request IEN
"RTN","DVBCUTL8",251,0)
 ;  RRST = Reroute status
"RTN","DVBCUTL8",252,0)
 ;  RRR = Reject Reason
"RTN","DVBCUTL8",253,0)
 ;
"RTN","DVBCUTL8",254,0)
 ;Output:
"RTN","DVBCUTL8",255,0)
 ;  RTN = 0 for Failure
"RTN","DVBCUTL8",256,0)
 ;        1 for Success
"RTN","DVBCUTL8",257,0)
 ;
"RTN","DVBCUTL8",258,0)
 N OSITE,OIEN,DA,DR,DIE,REJM,NSITE,RRUP,J1,J2,DIV1,DIV2
"RTN","DVBCUTL8",259,0)
 I RIEN="" S RTN="0^Missing 2507 Request IEN" Q
"RTN","DVBCUTL8",260,0)
 I '$D(^DVB(396.3,RIEN,0)) S RTN="0^Not a valid 2507 Request IEN" Q
"RTN","DVBCUTL8",261,0)
 I '$D(^DVB(396.3,RIEN,6,0)) S RTN="0^This 2507 Request has not been rerouted" Q
"RTN","DVBCUTL8",262,0)
 ;
"RTN","DVBCUTL8",263,0)
 S RRR=$G(RRR)
"RTN","DVBCUTL8",264,0)
 S J1=$O(^DVB(396.3,RIEN,6,99999),-1)
"RTN","DVBCUTL8",265,0)
 S J2=$O(^DVB(396.3,RIEN,6,J1,99999),-1)
"RTN","DVBCUTL8",266,0)
 I J2="" S RTN="0^This 2507 Request has not been rerouted" Q
"RTN","DVBCUTL8",267,0)
 S RRIEN=J1,RRDT=$$NOW^XLFDT()
"RTN","DVBCUTL8",268,0)
 S RRUP=$$UPRS(RIEN,RRIEN,RRDT,RRST,RRR)
"RTN","DVBCUTL8",269,0)
 ;
"RTN","DVBCUTL8",270,0)
 S R0=^DVB(396.3,RIEN,6,J1,0)
"RTN","DVBCUTL8",271,0)
 S R1=^DVB(396.3,RIEN,6,J1,2)
"RTN","DVBCUTL8",272,0)
 S CSITE=$P($$SITE^VASITE,"^",3),OSITE=$P(R1,"^",4),OIEN=$P(R0,"^",2),NSITE=$P(R1,"^",2)
"RTN","DVBCUTL8",273,0)
 S DIV1=$P(R0,"^",9),DIV2=$P($G(^DVB(396.3,RIEN,1)),"^",4)
"RTN","DVBCUTL8",274,0)
 I CSITE=OSITE,CSITE=NSITE,RRST="R" D
"RTN","DVBCUTL8",275,0)
 . S DIE="^DVB(396.3,"_RIEN_",6,",DA=J1,DA(1)=RIEN
"RTN","DVBCUTL8",276,0)
 . S DR="8////"_DIV2
"RTN","DVBCUTL8",277,0)
 . D ^DIE ;set Reroute fields
"RTN","DVBCUTL8",278,0)
 . K DIE,DA
"RTN","DVBCUTL8",279,0)
 ; Check to see if this the original site
"RTN","DVBCUTL8",280,0)
 I CSITE=OSITE D
"RTN","DVBCUTL8",281,0)
 . I RRST="A" S DR="6////"_RRDT_";17////13" Q
"RTN","DVBCUTL8",282,0)
 . I RRST="R" S DR="17////1",REJM=1 D EXSET(RIEN,"O") S ^DVB(396.3,"AR",RRDT,RIEN)=""
"RTN","DVBCUTL8",283,0)
 I CSITE'=OSITE D
"RTN","DVBCUTL8",284,0)
 . I RRST="A" S DR="17////2" Q
"RTN","DVBCUTL8",285,0)
 . I RRST="R" S DR="6////"_RRDT_";17////12" D EXSET(RIEN,"T")
"RTN","DVBCUTL8",286,0)
 I CSITE=OSITE,CSITE=NSITE D
"RTN","DVBCUTL8",287,0)
 . I RRST="A" S DR="17////2" Q
"RTN","DVBCUTL8",288,0)
 . I RRST="R" S DR="17////1;24////"_DIV1,^DVB(396.3,"AR",RRDT,RIEN)=""
"RTN","DVBCUTL8",289,0)
 S DA=RIEN,DIE="^DVB(396.3,"
"RTN","DVBCUTL8",290,0)
 D ^DIE
"RTN","DVBCUTL8",291,0)
 ;
"RTN","DVBCUTL8",292,0)
 ; Send Reject Message to DVBA C 2507 Reroute Group
"RTN","DVBCUTL8",293,0)
 D:RRST="R" MSG^DVBAB1C(RIEN)
"RTN","DVBCUTL8",294,0)
 ; 
"RTN","DVBCUTL8",295,0)
 I CSITE=OSITE S RTN="1^Reroute status updated" Q
"RTN","DVBCUTL8",296,0)
 ;
"RTN","DVBCUTL8",297,0)
 S OIEN=$P(R0,"^",2)
"RTN","DVBCUTL8",298,0)
 S RTN="1^Reroute status updated^"_OSITE_"^"_OIEN
"RTN","DVBCUTL8",299,0)
 ; 
"RTN","DVBCUTL8",300,0)
 Q 
"RTN","DVBCUTL8",301,0)
 ;
"RTN","DVBCUTL8",302,0)
 ;
"RTN","DVBCUTL8",303,0)
UPRR(RIEN,RRDT) ;AJF ; 7/30/2016; Update Reroute information
"RTN","DVBCUTL8",304,0)
 ;create Reroute entry for 2507 Request in sub-file 396.33
"RTN","DVBCUTL8",305,0)
 N DIC,X,Y,DA,DTOUT,DUOUT,DLAYGO,DO
"RTN","DVBCUTL8",306,0)
 S DIC="^DVB(396.3,"_RIEN_",6,",DA(1)=RIEN
"RTN","DVBCUTL8",307,0)
 S DIC(0)="L",DLAYGO=396.3
"RTN","DVBCUTL8",308,0)
 S X=RRDT  ;.01 2507 REQUEST REROUTE DATE
"RTN","DVBCUTL8",309,0)
 D FILE^DICN K DLAYGO
"RTN","DVBCUTL8",310,0)
 ;
"RTN","DVBCUTL8",311,0)
 ;
"RTN","DVBCUTL8",312,0)
 Q Y_"^"_RRDT
"RTN","DVBCUTL8",313,0)
 ;
"RTN","DVBCUTL8",314,0)
UPRS(RIEN,RRIEN,RRDT,RRST,RRR) ; Update the status
"RTN","DVBCUTL8",315,0)
 N DIC,X,Y,DA,DO,DTOUT,DUOUT,DLAYGO
"RTN","DVBCUTL8",316,0)
 S RRR=$G(RRR)
"RTN","DVBCUTL8",317,0)
 S DIC="^DVB(396.3,"_RIEN_",6,"_RRIEN_",1,"
"RTN","DVBCUTL8",318,0)
 S DA(1)=RIEN,DA(2)=RRIEN
"RTN","DVBCUTL8",319,0)
 S DIC(0)="FL",DLAYGO=396.3
"RTN","DVBCUTL8",320,0)
 S X=RRDT  ;.01 2507 REQUEST REROUTE DATE
"RTN","DVBCUTL8",321,0)
 S DIC("DR")="1////"_RRST_";2////"_RRR
"RTN","DVBCUTL8",322,0)
 D FILE^DICN
"RTN","DVBCUTL8",323,0)
 S R2=Y
"RTN","DVBCUTL8",324,0)
 Q Y
"RTN","DVBCUTL8",325,0)
 ;
"RTN","DVBCUTL8",326,0)
EXSET(RIEN,EST) ;Set Exam status
"RTN","DVBCUTL8",327,0)
 Q:RIEN=""!(EST="")
"RTN","DVBCUTL8",328,0)
 N DA,DIE,DR,JJ
"RTN","DVBCUTL8",329,0)
 F JJ=0:0 S JJ=$O(^DVB(396.4,"C",RIEN,JJ)) Q:JJ=""  D
"RTN","DVBCUTL8",330,0)
 . I $P(^DVB(396.4,JJ,0),U,4)="X" Q
"RTN","DVBCUTL8",331,0)
 . I $P(^DVB(396.4,JJ,0),U,4)="C" Q
"RTN","DVBCUTL8",332,0)
 . S DA=JJ,DIE="^DVB(396.4,",DR=".04////"_EST
"RTN","DVBCUTL8",333,0)
 . D ^DIE
"RTN","DVBCUTL8",334,0)
 Q
"RTN","DVBCXFR1")
0^19^B11734137^n/a
"RTN","DVBCXFR1",1,0)
DVBCXFR1 ;AJF/ReRoute C&P Request ; 7/18/16  2:14 PM
"RTN","DVBCXFR1",2,0)
 ;;2.7;AMIE;**193**;;Build 84
"RTN","DVBCXFR1",3,0)
 ;
"RTN","DVBCXFR1",4,0)
 ;
"RTN","DVBCXFR1",5,0)
 Q
"RTN","DVBCXFR1",6,0)
EN(RTN,REQDA,PIEN,SNUM,RDIV,RR,RD) ;Call from CAPRI
"RTN","DVBCXFR1",7,0)
 ; RPC: DVBA CAPRI SEND REROUTE
"RTN","DVBCXFR1",8,0)
 ;
"RTN","DVBCXFR1",9,0)
 ;ReRoute C&P 2507 Request
"RTN","DVBCXFR1",10,0)
 ;  RTN = Return value
"RTN","DVBCXFR1",11,0)
 ;  REQDA = 2507 Request IEN
"RTN","DVBCXFR1",12,0)
 ;  SNUM = CAPRI Reroute IEN
"RTN","DVBCXFR1",13,0)
 ;  PIEN = Patient IEN
"RTN","DVBCXFR1",14,0)
 ;  RDIV = Division IEN
"RTN","DVBCXFR1",15,0)
 ;  RR = Reroute Reason
"RTN","DVBCXFR1",16,0)
 ;  RD = Reroute Description
"RTN","DVBCXFR1",17,0)
 ;
"RTN","DVBCXFR1",18,0)
 I $G(REQDA)="" S RTN="0^Missing request number number" Q
"RTN","DVBCXFR1",19,0)
 I $G(SNUM)="" S RTN="0^Missing CAPRI Reroute Site number" Q
"RTN","DVBCXFR1",20,0)
 I $G(PIEN)="" S RTN="0^Missing Patient IEN" Q
"RTN","DVBCXFR1",21,0)
 I $G(RDIV)="" S RTN="0^Missing Routing Location" Q
"RTN","DVBCXFR1",22,0)
 I $G(RR)="" S RTN="0^Missing Reroute Reason" Q
"RTN","DVBCXFR1",23,0)
 I '$D(^DVB(396.3,REQDA,0)) S RTN="0^Not a valad request number" Q
"RTN","DVBCXFR1",24,0)
 I '$D(^DVB(396.195,SNUM)) S RTN="0^Not a valid CAPRI Reroute Site IEN" Q
"RTN","DVBCXFR1",25,0)
 ;
"RTN","DVBCXFR1",26,0)
 N R0,DFN,DIEN,DOMNAM,DOMNUM,DOMNUM1,EXAMS,EXMNM,EXR,JJ,PNAM,INAM
"RTN","DVBCXFR1",27,0)
 N SSN,XMCNT,XMVAR
"RTN","DVBCXFR1",28,0)
 S R0=^DVB(396.3,REQDA,0)
"RTN","DVBCXFR1",29,0)
 K DVBAINSF
"RTN","DVBCXFR1",30,0)
 I $P(R0,U,18)>2 S RTN="0^This request does not have a NEW or PENDING status and may not be rerouted." Q
"RTN","DVBCXFR1",31,0)
 ;I $P(R0,U,18)'=1,($P(R0,U,18)'=2),($P(R0,U,18)'=12) S RTN="0^This request does not have a NEW or PENDING status and may not be rerouted." Q
"RTN","DVBCXFR1",32,0)
 ;I $P(R0,U,22)]"" S RTN="0^This request was transferred in and CANNOT be transferred to any other site " Q
"RTN","DVBCXFR1",33,0)
 ;
"RTN","DVBCXFR1",34,0)
 S DFN=$P(R0,U,1)
"RTN","DVBCXFR1",35,0)
 I DFN'=PIEN S RTN="0^Patient IEN passed in does match 2507 Request" Q
"RTN","DVBCXFR1",36,0)
 S PNAM=$P(^DPT(DFN,0),U,1),SSN=$P(^(0),U,9)
"RTN","DVBCXFR1",37,0)
 S:$P(R0,U,10)="E" DVBAINSF=""
"RTN","DVBCXFR1",38,0)
 S DOMNAM=$P(^DVB(396.195,SNUM,0),"^",3)
"RTN","DVBCXFR1",39,0)
 S DIEN=$O(^DIC(4.2,"B",DOMNAM,""))
"RTN","DVBCXFR1",40,0)
 I DIEN="" S RTN="0^Domain Name not found in Domain File. Please contact IRM for assistance." Q
"RTN","DVBCXFR1",41,0)
 S STN=$P(^DIC(4.2,DIEN,0),"^",13)
"RTN","DVBCXFR1",42,0)
 I STN="" S RTN="0^Station Number not found in Domain File. Please contact IRM for assistance." Q
"RTN","DVBCXFR1",43,0)
 S INUM=$O(^DIC(4,"D",STN,0))
"RTN","DVBCXFR1",44,0)
 I INUM'="" S TSITE=$P($G(^DIC(4,INUM,0)),"^",1)
"RTN","DVBCXFR1",45,0)
 S:INUM="" INUM=STN
"RTN","DVBCXFR1",46,0)
 S DOMNUM=$S($P(^DIC(4.2,DIEN,0),U,3)]"":$P(^(0),U,3),1:DIEN)
"RTN","DVBCXFR1",47,0)
 S INAM=$S($D(TSITE):TSITE,1:$P(^DIC(4.2,DIEN,0),U,1))
"RTN","DVBCXFR1",48,0)
 S DOMNUM1=DIEN
"RTN","DVBCXFR1",49,0)
 ;
"RTN","DVBCXFR1",50,0)
 I $L($G(RD))>250 S RD=$E(RD,1,250)
"RTN","DVBCXFR1",51,0)
 ;I $D(CORR) G DISPLAY
"RTN","DVBCXFR1",52,0)
 ;
"RTN","DVBCXFR1",53,0)
 ;EXAMS K XEXAMS W @FF,!,"Exam selection",!!!! S EXAMS="",XMCNT=0
"RTN","DVBCXFR1",54,0)
 ;F LPCNT=0:0 S LPCNT=$O(XMVAR(LPCNT)) Q:LPCNT=""  K XMVAR(LPCNT)
"RTN","DVBCXFR1",55,0)
 ;W !!,"Do you want to transfer ALL exams" S %=2 D YN^DICN G:%<0 EXIT
"RTN","DVBCXFR1",56,0)
 ;I %=2 W !! G PART
"RTN","DVBCXFR1",57,0)
 ;I %=0 W !!,"Enter Y if you want to transfer all exams or N if not.",!! D CONTMES^DVBCUTL4 G EXAMS
"RTN","DVBCXFR1",58,0)
 ;W !!! 
"RTN","DVBCXFR1",59,0)
 K XEXAMS S EXAMS="",XMCNT=0
"RTN","DVBCXFR1",60,0)
 F JJ=0:0 S JJ=$O(^DVB(396.4,"C",REQDA,JJ)) Q:JJ=""  D SET
"RTN","DVBCXFR1",61,0)
 ;
"RTN","DVBCXFR1",62,0)
 D INREAS^DVBCXUTL
"RTN","DVBCXFR1",63,0)
MAILMAN D ^DVBCXFR2
"RTN","DVBCXFR1",64,0)
 ;
"RTN","DVBCXFR1",65,0)
 Q
"RTN","DVBCXFR1",66,0)
 ;
"RTN","DVBCXFR1",67,0)
SET ;** EXAMS - Xfr all
"RTN","DVBCXFR1",68,0)
 S EXMNM=$P(^DVB(396.6,$P(^DVB(396.4,JJ,0),U,3),0),U,1)
"RTN","DVBCXFR1",69,0)
 I $P(^DVB(396.4,JJ,0),U,4)["X" S EXR(JJ)=EXMNM_" is CANCELED and cannot be transferred." Q
"RTN","DVBCXFR1",70,0)
 I $P(^DVB(396.4,JJ,0),U,4)="C" S EXR(JJ)=EXMNM_" is COMPLETED and cannot be transferred." Q
"RTN","DVBCXFR1",71,0)
 I $P(^DVB(396.4,JJ,0),U,4)="T" S EXR(JJ)=EXMNM_" has been TRANSFERRED and cannot be selected." Q
"RTN","DVBCXFR1",72,0)
 ;W !,EXMNM," is OK to transfer.",!!
"RTN","DVBCXFR1",73,0)
 S EXAMS=EXAMS_$P(^DVB(396.4,JJ,0),U,3)_U,XEXAMS(JJ)="",XMCNT=XMCNT+1
"RTN","DVBCXFR1",74,0)
 ;
"RTN","DVBCXFR1",75,0)
 ;** Set XMVAR(XMCNT)=$EXAM AMIE EXAM IFN^INSUFF REASON IFN
"RTN","DVBCXFR1",76,0)
 S XMVAR(XMCNT)="$EXAM "_$P(^DVB(396.4,JJ,0),U,3)_U_$S(+$P(^DVB(396.4,JJ,0),U,11)>0:$P(^DVB(396.94,$P(^DVB(396.4,JJ,0),U,11),0),U,1),1:"")
"RTN","DVBCXFR1",77,0)
 ;EXAMS for MailMan msg, XEXAMS sets exam status
"RTN","DVBCXFR1",78,0)
 ;XMVAR() add one exam/line to bulletin - Future
"RTN","DVBCXFR1",79,0)
 Q
"RTN","DVBCXFR1",80,0)
 ;
"RTN","DVBCXFR1",81,0)
 ;
"RTN","DVBCXFR1",82,0)
EXIT D CLRVAR^DVBCXUTL,KILLVRS^DVBCXUTL,KILL^DVBCUTIL
"RTN","DVBCXFR2")
0^20^B31249178^n/a
"RTN","DVBCXFR2",1,0)
DVBCXFR2 ;AJF/ReRoute C&P REQUESTS ; 7/25/16 1:55 PM
"RTN","DVBCXFR2",2,0)
 ;;2.7;AMIE;**193**;;Build 84
"RTN","DVBCXFR2",3,0)
 ;
"RTN","DVBCXFR2",4,0)
 ;Copy of DVBCXFRB
"RTN","DVBCXFR2",5,0)
 ;
"RTN","DVBCXFR2",6,0)
EN ;file 2
"RTN","DVBCXFR2",7,0)
 N DVBSBRCH,DVBDTYPE,CSPT
"RTN","DVBCXFR2",8,0)
 K ^TMP("DVBCXFR",$J),L S X=^DVB(396.3,REQDA,0),DFN=$P(X,U,1)
"RTN","DVBCXFR2",9,0)
 S X=^DPT(DFN,0),PNAM=$P(X,U,1),DOB=$P(X,U,3),SEX=$P(X,U,2),SSN=$P(X,U,9),POBC=$P(X,U,11),POBS=$P(X,U,12)
"RTN","DVBCXFR2",10,0)
 S X=$S($D(^DPT(DFN,.11)):^(.11),1:""),ADR1=$P(X,U,1),ADR2=$P(X,U,2),ADR3=$P(X,U,3),CITY=$P(X,U,4)
"RTN","DVBCXFR2",11,0)
 S STATE=$P(X,U,5),ZIP=$P(X,U,6),CNTY=$P(X,U,7),ZIP4=$P(X,U,12)
"RTN","DVBCXFR2",12,0)
 S CNTY=$S($D(^DIC(5,+STATE,1,+CNTY,0)):$P(^(0),U,1),1:""),STATE=$S($D(^DIC(5,+STATE,0)):$P(^(0),U,1),1:"")
"RTN","DVBCXFR2",13,0)
 S X=$S($D(^DPT(DFN,.13)):^(.13),1:"") S HOMPHON=$P(X,U,1),BUSPHON=$P(X,U,2)
"RTN","DVBCXFR2",14,0)
 S X=$S($D(^DPT(DFN,.3)):^(.3),1:""),SRVCON=$P(X,U,1),SRVPCT=$P(X,U,2)
"RTN","DVBCXFR2",15,0)
 S X=$S($D(^DPT(DFN,.31)):^(.31),1:""),CNUM=$P(X,U,3)
"RTN","DVBCXFR2",16,0)
 S CFLOC=$$STATION^DVBAUTL1(DFN)
"RTN","DVBCXFR2",17,0)
 S:CFLOC=-1 CFLOC=""
"RTN","DVBCXFR2",18,0)
 S X=$S($D(^DPT(DFN,.32)):^(.32),1:""),PDSRV=$P(X,U,3),PDSRV=$S($D(^DIC(21,+PDSRV,0)):$P(^(0),U,3),1:"")
"RTN","DVBCXFR2",19,0)
 S X=$$SVC^DVBCUTIL(DFN,"I"),SRVEDT=$P(X,U),SRVSDT=$P(X,U,2)
"RTN","DVBCXFR2",20,0)
 S X=$$SVC^DVBCUTIL(DFN,"E"),DVBSBRCH=$P(X,U,3),DVBDTYPE=$P(X,U,4)
"RTN","DVBCXFR2",21,0)
 S X=$S($D(^DPT(DFN,.36)):^(.36),1:""),ELIGCOD=$P(X,U,1),ELIGCOD=$S($D(^DIC(8,+ELIGCOD,0)):$P(^(0),U,9),1:"")
"RTN","DVBCXFR2",22,0)
 S X=$S($D(^DPT(DFN,.361)):^(.361),1:""),ELIGST=$P(X,U,1),ELIGSDT=$P(X,U,2)
"RTN","DVBCXFR2",23,0)
 S X=$S($D(^DPT(DFN,.52)):^(.52),1:""),POWSTAT=$P(X,U,5)
"RTN","DVBCXFR2",24,0)
 S X=$S($D(^DPT(DFN,"VET")):^("VET"),1:""),VETST=$P(X,U,1)
"RTN","DVBCXFR2",25,0)
 S X=$S($D(^DPT(DFN,"TYPE")):^("TYPE"),1:"") S TYPE=$S(X]"":$P(^DG(391,X,0),U,1),1:"")
"RTN","DVBCXFR2",26,0)
 S ICN=$$GETICN^MPIF001(DFN),PREFAC=STN,CSPT=0
"RTN","DVBCXFR2",27,0)
 I $D(^DGSL(38.1,DFN,0)) S CSPT=$P(^DGSL(38.1,DFN,0),U,2)
"RTN","DVBCXFR2",28,0)
 ;
"RTN","DVBCXFR2",29,0)
 S LINE(1)="$DEM0 "_PNAM_U_DOB_U_SEX_U_SSN_U_POBC_U_POBS_U_ICN_U_PREFAC_U_CSPT
"RTN","DVBCXFR2",30,0)
 S LINE(2)="$DEM1 "_ADR1_U_ADR2_U_ADR3_U_CITY_U_STATE_U_CNTY_U_ZIP_U_HOMPHON_U_BUSPHON_U_ZIP4
"RTN","DVBCXFR2",31,0)
 S LINE(3)="$ELIG "_SRVCON_U_SRVPCT_U_CFLOC_U_CNUM_U_PDSRV_U_SRVEDT_U_SRVSDT_U_ELIGCOD_U_ELIGST_U_ELIGSDT_U_POWSTAT_U_VETST_U_TYPE_U_DVBSBRCH_U_DVBDTYPE
"RTN","DVBCXFR2",32,0)
 ;
"RTN","DVBCXFR2",33,0)
 ;file 396.3
"RTN","DVBCXFR2",34,0)
EN1 S X=^DVB(396.3,REQDA,0),RO=$P(X,U,3),RONAM=$P($G(^DIC(4,+RO,99)),U,1),REQDT=$P(X,U,2)
"RTN","DVBCXFR2",35,0)
 S FEXM=$P(X,U,9),PRIO=$P(X,U,10),OTHDIS=$P(X,U,11),LREXMDT=$P(X,U,20),DMAS=$P(X,U,5)
"RTN","DVBCXFR2",36,0)
 S X=$S($D(^DVB(396.3,REQDA,1)):^(1),1:""),CFREQ=$P(X,U,2),OTHDOC=$P(X,U,3),LREXMDT=$P(X,U,7),OTHDIS1=$P(X,U,9),OTHDIS2=$P(X,U,10)
"RTN","DVBCXFR2",37,0)
 S CLTYP=$G(^DVB(396.3,REQDA,9,1,0)),RRDIV=$P($G(^DVB(396.3,REQDA,1)),"^",4),(SPEC,ECF)="",II=0
"RTN","DVBCXFR2",38,0)
 I $D(^DVB(396.3,REQDA,5)) S ECF=$P(^DVB(396.3,REQDA,5),"^",3)
"RTN","DVBCXFR2",39,0)
 I $D(^DVB(396.3,REQDA,8)) F  S II=$O(^DVB(396.3,REQDA,8,II)) Q:II=""!(II="B")  D
"RTN","DVBCXFR2",40,0)
 . S SPEC=SPEC_$G(^DVB(396.3,REQDA,8,II,0))_"^"
"RTN","DVBCXFR2",41,0)
 S LINE(4)="$REQ0 "_REQDA_U_RO_U_PRIO_U_CFLOC_U_LREXMDT_U_CFREQ_U_LREXMDT_U_RONAM_U_RDIV_U_REQDT_U_DMAS
"RTN","DVBCXFR2",42,0)
 S LINE(5)="$ODIS "_OTHDIS_U_OTHDIS1_U_OTHDIS2
"RTN","DVBCXFR2",43,0)
 S EXAMS="$EXAM "_EXAMS,LINE(6)=EXAMS
"RTN","DVBCXFR2",44,0)
 S CINFO=$$SITE^VASITE,RRDT=$$NOW^XLFDT()
"RTN","DVBCXFR2",45,0)
 S RRFIEN=$P(CINFO,"^",1),RRF=$P(CINFO,"^",2),RRFSTN=$P(CINFO,"^",3)
"RTN","DVBCXFR2",46,0)
 S RRFD=$P(^DIC(4,RRFIEN,6),U,1)
"RTN","DVBCXFR2",47,0)
 ; AJF ; Reroute data for MailMan message
"RTN","DVBCXFR2",48,0)
 S LINE(7)="$RDAT "_REQDA_U_PIEN_U_RRF_U_RR_U_RD_U_INAM_U_RRDT_U_CLTYP_U_ECF_U_RRFD
"RTN","DVBCXFR2",49,0)
 S LINE(7)=LINE(7)_U_RRFIEN_U_RRFSTN_U_STN_U_INUM
"RTN","DVBCXFR2",50,0)
 S LINE(8)="$SPEC "_SPEC
"RTN","DVBCXFR2",51,0)
 ;
"RTN","DVBCXFR2",52,0)
 ;**NOTE: RONAM is now RO NUMBER
"RTN","DVBCXFR2",53,0)
LOAD S L=1,^TMP("DVBCXFR",$J,L,0)="$TRANSFER IN",L=L+1
"RTN","DVBCXFR2",54,0)
 F X=1:1 Q:'$D(LINE(X))  S ^TMP("DVBCXFR",$J,L,0)=LINE(X),L=L+1
"RTN","DVBCXFR2",55,0)
 F JI=0:0 S JI=$O(^DVB(396.3,REQDA,2,JI)) Q:JI=""  S ^TMP("DVBCXFR",$J,L,0)="$REMK "_^DVB(396.3,REQDA,2,JI,0),L=L+1
"RTN","DVBCXFR2",56,0)
 S SITE=$P(^XMB(1,1,0),U,1),SITE1=$P(^DIC(4.2,SITE,0),U,1)
"RTN","DVBCXFR2",57,0)
 S USERNM=$P(^VA(200,DUZ,0),U,1),^TMP("DVBCXFR",$J,L,0)="$USER "_USERNM_U_SITE_U_SITE1,L=L+1
"RTN","DVBCXFR2",58,0)
 S ^TMP("DVBCXFR",$J,L,0)="$END "
"RTN","DVBCXFR2",59,0)
 N XMNODE
"RTN","DVBCXFR2",60,0)
 S XMNODE=0
"RTN","DVBCXFR2",61,0)
 F X=(L+1):1:(L+XMCNT) DO
"RTN","DVBCXFR2",62,0)
 .S XMNODE=XMNODE+1
"RTN","DVBCXFR2",63,0)
 .S ^TMP("DVBCXFR",$J,X,0)=XMVAR(XMNODE)
"RTN","DVBCXFR2",64,0)
 S ^TMP("DVBCXFR",$J,X+1,0)="$END1 "
"RTN","DVBCXFR2",65,0)
 ;
"RTN","DVBCXFR2",66,0)
SEND K XMZ
"RTN","DVBCXFR2",67,0)
 ;S XMY("POSTMASTER@"_DOMNAM)=DOMNUM
"RTN","DVBCXFR2",68,0)
 N RRIF
"RTN","DVBCXFR2",69,0)
 S RRXM=0
"RTN","DVBCXFR2",70,0)
 ;Check for reroute within VAMC
"RTN","DVBCXFR2",71,0)
 I RRF'=INUM D
"RTN","DVBCXFR2",72,0)
 .S XMY(DUZ)="",XMY("S.DVBA C PROCESS MAIL MESSAGE@"_DOMNAM)=DOMNUM,XMSUB="Transfer of C&P Exams",XMTEXT="^TMP(""DVBCXFR"",$J,",XMDUZ=DUZ
"RTN","DVBCXFR2",73,0)
 .D ^XMD
"RTN","DVBCXFR2",74,0)
 .I $D(XMZ) S RTN="1^Transmitted as message # "_XMZ_" from this site to "_DOMNAM
"RTN","DVBCXFR2",75,0)
 .I '$D(XMZ) S RTN="0^Message transmission error! Request WILL NOT be rerouted!",RRXM=1
"RTN","DVBCXFR2",76,0)
 ;if all ok, update main, sub-file
"RTN","DVBCXFR2",77,0)
 I RRXM=1 D VKILL Q
"RTN","DVBCXFR2",78,0)
 I RRF=INUM S RTN="1^Rerouted to another division within "_DOMNAM
"RTN","DVBCXFR2",79,0)
 F III=0:0 S III=$O(XEXAMS(III)) Q:III=""  D
"RTN","DVBCXFR2",80,0)
 .S DIE="^DVB(396.4,",DA=III,DR=".04///T;62///"_DOMNAM_";60////"_DT_";61///"_USERNM
"RTN","DVBCXFR2",81,0)
 .D ^DIE
"RTN","DVBCXFR2",82,0)
 K DIE,DA,DR S DIE="^DVB(396.3,",DA=REQDA,DR="17///14"
"RTN","DVBCXFR2",83,0)
 ;
"RTN","DVBCXFR2",84,0)
 ; ajf - Defect #2 - 02/17/2017
"RTN","DVBCXFR2",85,0)
 S CSITE=+$$SITE^VASITE
"RTN","DVBCXFR2",86,0)
 I CSITE=RRFIEN&(CSITE=INUM) S DR=DR_";24////"_$P(^DVB(396.15,RDIV,0),"^")
"RTN","DVBCXFR2",87,0)
 D ^DIE ;set transfer items
"RTN","DVBCXFR2",88,0)
 ;
"RTN","DVBCXFR2",89,0)
 S RRIF=$$UPRR^DVBCUTL8(REQDA,RRDT)
"RTN","DVBCXFR2",90,0)
 S DA=$P(RRIF,"^")
"RTN","DVBCXFR2",91,0)
 S DIE="^DVB(396.3,"_REQDA_",6,",DA(1)=REQDA
"RTN","DVBCXFR2",92,0)
 S DR="1////"_REQDA_";2////"_PIEN_";3////"_RRF_";4////"_RR_";5////"_RD
"RTN","DVBCXFR2",93,0)
 S DR=DR_";.02////"_INAM_";8////"_RRDIV_";7////"_DUZ
"RTN","DVBCXFR2",94,0)
 S DR=DR_";9////"_INUM_";10////"_STN_";11////"_RRFIEN_";12////"_RRFSTN
"RTN","DVBCXFR2",95,0)
 D ^DIE ;set Reroute fields
"RTN","DVBCXFR2",96,0)
 S RRIEN=DA,RRST="N",RRR=""
"RTN","DVBCXFR2",97,0)
 D UPRS^DVBCUTL8(REQDA,RRIEN,RRDT,RRST,RRR) ; Update the status
"RTN","DVBCXFR2",98,0)
 ; Send Reroute message to Requestor
"RTN","DVBCXFR2",99,0)
 D SENDMSG^DVBAB1C(REQDA)
"RTN","DVBCXFR2",100,0)
 ;
"RTN","DVBCXFR2",101,0)
 ;  REQDA = 2507 Request IEN
"RTN","DVBCXFR2",102,0)
 ;  INUM = Institution IEN
"RTN","DVBCXFR2",103,0)
 ;  PIEN = Patient IEN
"RTN","DVBCXFR2",104,0)
 ;  DIEN = Division IEN
"RTN","DVBCXFR2",105,0)
 ;  RR = Reroute Reason
"RTN","DVBCXFR2",106,0)
 ;  RD = Reroute Description
"RTN","DVBCXFR2",107,0)
 ;
"RTN","DVBCXFR2",108,0)
 ;
"RTN","DVBCXFR2",109,0)
 ;
"RTN","DVBCXFR2",110,0)
 K LINE,DOMNUM,DOMNUM1,^TMP("DVBCXFR",$J),XMDUZ,III,L,JI,JY,XMY,XMZ,XMSUB,XMTEXT,XMDUZ,DIE,DA,DR,TYPE
"RTN","DVBCXFR2",111,0)
 ;
"RTN","DVBCXFR2",112,0)
VKILL ; Kill varables from process
"RTN","DVBCXFR2",113,0)
 ;
"RTN","DVBCXFR2",114,0)
 K XMERR,ADR1,ADR2,ADR3,BUSPHON,CFLOC,CFREQ,CITY,CLTYP,CNTY,CNUM
"RTN","DVBCXFR2",115,0)
 K CSITE,DFN,DOB,DOMNAM,ECF,ELIGCOD,ELIGSDT,ELIGST,EXAMS,FEXM
"RTN","DVBCXFR2",116,0)
 K HOMPHON,II,INUM,LREXMDT,MDIV,OTDIS,OTHDIS,OTHDIS1,OTHDIS2,OTHDOC,PDSRV
"RTN","DVBCXFR2",117,0)
 K PIEN,PNAM,POWSTAT,PRIO,RD,RDIV,REQDA,REQDT,RR,RONAM,RO,RRDT,RRDIV
"RTN","DVBCXFR2",118,0)
 K RRFD,RRIEN,RRR,RRF,RRST,RRXM,SEX,SITE,SITE1,SPEC,SRVCON,SRVEDT,SRVSDT
"RTN","DVBCXFR2",119,0)
 K SRVPCT,SSN,STATE,USERNM,VETST,X,XEXAMS,XMCNT,XMVAR,ZIP,ZIP4,DMAS,INAM
"RTN","DVBCXFR2",120,0)
 D KILL^DVBCUTIL,KILL^DVBCUTL2,KILL^DVBCUTL3
"RTN","DVBCXFR2",121,0)
 Q
"RTN","DVBCXFRA")
0^51^B30776087^B30546302
"RTN","DVBCXFRA",1,0)
DVBCXFRA ;ALB/GTS-557/THM-TRANSFER C&P REQUESTS ; 4/18/91  2:14 PM
"RTN","DVBCXFRA",2,0)
 ;;2.7;AMIE;**193**;Apr 10, 1995;Build 84
"RTN","DVBCXFRA",3,0)
 ;
"RTN","DVBCXFRA",4,0)
 D HOME^%ZIS K CORR S FF=IOF G EN
"RTN","DVBCXFRA",5,0)
 ;
"RTN","DVBCXFRA",6,0)
CORSEL I SEL=1 G EN
"RTN","DVBCXFRA",7,0)
 I SEL=2 G DOMAIN
"RTN","DVBCXFRA",8,0)
 I SEL=3 G EXAMS
"RTN","DVBCXFRA",9,0)
 I SEL=4 K CORR,EXAMS,X,Y,REQDA G EN
"RTN","DVBCXFRA",10,0)
 I SEL[U G EXIT
"RTN","DVBCXFRA",11,0)
 ;
"RTN","DVBCXFRA",12,0)
SET ;** EXAMS - Xfr all
"RTN","DVBCXFRA",13,0)
 S EXMNM=$P(^DVB(396.6,$P(^DVB(396.4,JJ,0),U,3),0),U,1)
"RTN","DVBCXFRA",14,0)
 I $P(^DVB(396.4,JJ,0),U,4)["X" W EXMNM," is CANCELED and cannot be transferred.",!,*7 Q
"RTN","DVBCXFRA",15,0)
 I $P(^DVB(396.4,JJ,0),U,4)="C" W EXMNM," is COMPLETED and cannot be transferred.",!,*7 Q
"RTN","DVBCXFRA",16,0)
 I $P(^DVB(396.4,JJ,0),U,4)="T" W EXMNM," has been TRANSFERRED and cannot be selected.",!,*7 Q
"RTN","DVBCXFRA",17,0)
 W !,EXMNM," is OK to transfer.",!!
"RTN","DVBCXFRA",18,0)
 S EXAMS=EXAMS_$P(^DVB(396.4,JJ,0),U,3)_U,XEXAMS(JJ)="",XMCNT=XMCNT+1
"RTN","DVBCXFRA",19,0)
 ;
"RTN","DVBCXFRA",20,0)
 ;** Set XMVAR(XMCNT)=$EXAM AMIE EXAM IFN^INSUFF REASON IFN
"RTN","DVBCXFRA",21,0)
 S XMVAR(XMCNT)="$EXAM "_$P(^DVB(396.4,JJ,0),U,3)_U_$S(+$P(^DVB(396.4,JJ,0),U,11)>0:$P(^DVB(396.94,$P(^DVB(396.4,JJ,0),U,11),0),U,1),1:"")
"RTN","DVBCXFRA",22,0)
 ;EXAMS for MailMan msg, XEXAMS sets exam status
"RTN","DVBCXFRA",23,0)
 ;XMVAR() add one exam/line to bulletin - Future
"RTN","DVBCXFRA",24,0)
 Q
"RTN","DVBCXFRA",25,0)
 ;
"RTN","DVBCXFRA",26,0)
EN W @FF,!,"Transfer C&P Exams",!!!!
"RTN","DVBCXFRA",27,0)
 K DVBAINSF S DIC="^DVB(396.3,",DIC(0)="AEQMZ",DIC("A")="Select VETERAN NAME: " D ^DIC K DIC G:X=""!(X=U) EXIT I +Y<0 W *7,"  ???" H 2 G EN
"RTN","DVBCXFRA",28,0)
 ;AJF ; Request Status Convertion
"RTN","DVBCXFRA",29,0)
 I $P(Y(0),U,18)'=2 W !!,*7,"This request does not have a PENDING status and may not be transferred.",!! H 3 G EN
"RTN","DVBCXFRA",30,0)
 I $P(Y(0),U,22)]"" W !!,*7,"This request was transferred in and CANNOT be transferred to any other site !",!! H 3 G EN
"RTN","DVBCXFRA",31,0)
 ;
"RTN","DVBCXFRA",32,0)
ENQUEST W !!!,"Is this the correct request" S %=2 D YN^DICN G:%<0 EXIT I %=2 H 1 G EN
"RTN","DVBCXFRA",33,0)
 I %=0 W !!,"Enter Y if the correct Veteran or N if not.",!! DO
"RTN","DVBCXFRA",34,0)
 .D CONTMES^DVBCUTL4
"RTN","DVBCXFRA",35,0)
 I %=0 G ENQUEST
"RTN","DVBCXFRA",36,0)
 K DVBAINSF
"RTN","DVBCXFRA",37,0)
 S REQDA=+Y,DFN=$P(Y,U,2),PNAM=$P(^DPT(DFN,0),U,1),SSN=$P(^(0),U,9)
"RTN","DVBCXFRA",38,0)
 S:$P(^DVB(396.3,REQDA,0),U,10)="E" DVBAINSF=""
"RTN","DVBCXFRA",39,0)
 I $D(CORR) G DISPLAY
"RTN","DVBCXFRA",40,0)
 ;
"RTN","DVBCXFRA",41,0)
DOMAIN W @FF,!,"Selection of transfer domain:",!!!!
"RTN","DVBCXFRA",42,0)
 S DIC("A")="Send to domain: ",DIC="^DIC(4.2,",DIC(0)="AEQM" D ^DIC G:X=""!(X=U) EXIT I +Y<0 W *7,"  ???" H 2 G EN
"RTN","DVBCXFRA",43,0)
 ;
"RTN","DVBCXFRA",44,0)
DOMQST W !!!,"Is this the correct domain" S %=2 D YN^DICN G:%<0 EXIT I %=2 H 1 G DOMAIN
"RTN","DVBCXFRA",45,0)
 I %=0 W !!,"Enter Y if the domain is correct or N to reselect." D CONTMES^DVBCUTL4 G DOMQST
"RTN","DVBCXFRA",46,0)
 S DOMNUM=$S($P(^DIC(4.2,+Y,0),U,3)]"":$P(^(0),U,3),1:+Y),DOMNAM=$P(^(0),U,1),DOMNUM1=+Y
"RTN","DVBCXFRA",47,0)
 I $D(CORR) G DISPLAY
"RTN","DVBCXFRA",48,0)
 ;
"RTN","DVBCXFRA",49,0)
EXAMS K XEXAMS W @FF,!,"Exam selection",!!!! S EXAMS="",XMCNT=0
"RTN","DVBCXFRA",50,0)
 F LPCNT=0:0 S LPCNT=$O(XMVAR(LPCNT)) Q:LPCNT=""  K XMVAR(LPCNT)
"RTN","DVBCXFRA",51,0)
 W !!,"Do you want to transfer ALL exams" S %=2 D YN^DICN G:%<0 EXIT
"RTN","DVBCXFRA",52,0)
 I %=2 W !! G PART
"RTN","DVBCXFRA",53,0)
 I %=0 W !!,"Enter Y if you want to transfer all exams or N if not.",!! D CONTMES^DVBCUTL4 G EXAMS
"RTN","DVBCXFRA",54,0)
 W !!! F JJ=0:0 S JJ=$O(^DVB(396.4,"C",REQDA,JJ)) Q:JJ=""  D SET
"RTN","DVBCXFRA",55,0)
 D PAUSE^DVBCUTL4
"RTN","DVBCXFRA",56,0)
 G @$S(EXAM]""&(Y):"DISPLAY",1:"EN")
"RTN","DVBCXFRA",57,0)
 ;
"RTN","DVBCXFRA",58,0)
PART W @FF,!,"Individual exam selection",!!!!
"RTN","DVBCXFRA",59,0)
 S Y=$$EXSRH^DVBCUTL4("Select EXAM TO TRANSFER: ","I $D(^DVB(396.4,""ARQ""_REQDA,+Y))") ;*Exam lookup function call
"RTN","DVBCXFRA",60,0)
 K DIC G:X=""&(EXAMS]"") DISPLAY G:X=U EXIT
"RTN","DVBCXFRA",61,0)
 I +Y<0 W *7,!!,"No exams have been selected for transfer." D CONTMES^DVBCUTL4 G EN
"RTN","DVBCXFRA",62,0)
 I $P(^DVB(396.4,+Y,0),U,4)["X" W !!,"This exam is CANCELED and cannot be transferred.",*7,!! D CONTMES^DVBCUTL4 G PART
"RTN","DVBCXFRA",63,0)
 I $P(^DVB(396.4,+Y,0),U,4)="C" W !!,"This exam has been COMPLETED and cannot be transferred.",!!,*7 D CONTMES^DVBCUTL4 G PART
"RTN","DVBCXFRA",64,0)
 I $P(^DVB(396.4,+Y,0),U,4)="T" W !!,"This exam has been TRANSFERRED and cannot be selected.",!!,*7 D CONTMES^DVBCUTL4 G PART
"RTN","DVBCXFRA",65,0)
PART1 W !!!,"Is this the correct exam" S %=2 D YN^DICN G:%<0 EXIT I %=2 G EXAMS
"RTN","DVBCXFRA",66,0)
 I %=0 W !!,"Enter Y if all is correct or N to reselect another exam." D CONTMES^DVBCUTL4 G PART1
"RTN","DVBCXFRA",67,0)
 I EXAMS[$P(^DVB(396.4,+Y,0),U,3)_U DO
"RTN","DVBCXFRA",68,0)
 .W !!,*7,"You have already selected this exam for transfer."
"RTN","DVBCXFRA",69,0)
 .D CONTMES^DVBCUTL4
"RTN","DVBCXFRA",70,0)
 I EXAMS[$P(^DVB(396.4,+Y,0),U,3)_U G PART
"RTN","DVBCXFRA",71,0)
 S EXAMS=EXAMS_$P(^DVB(396.4,+Y,0),U,3)_U,XEXAMS(+Y)="",XMCNT=XMCNT+1
"RTN","DVBCXFRA",72,0)
 D SETXMVR^DVBCXUTL ;** Set XMVAR(XMCNT)
"RTN","DVBCXFRA",73,0)
 W !! G PART
"RTN","DVBCXFRA",74,0)
 ;
"RTN","DVBCXFRA",75,0)
DISPLAY I EXAMS="" W @FF,!!!,"No exams have been selected for transfer.",!! D PAUSE^DVBCUTL4 G EN
"RTN","DVBCXFRA",76,0)
 W @FF,!!,"You have selected the following:",!!!,"Veteran name: ",PNAM,?50,"SSN: ",SSN,!,"Request date: " S Y=$P(^DVB(396.3,REQDA,0),U,2) X ^DD("DD") W Y,!!!,"Exams selected for transfer:",!!
"RTN","DVBCXFRA",77,0)
 F I=1:1 S X=$P(EXAMS,U,I) Q:X=""  W $P(^DVB(396.6,X,0),U,1),"; " I $X>45 W !?2
"RTN","DVBCXFRA",78,0)
 ;
"RTN","DVBCXFRA",79,0)
YN K DA(1) W !!!,"Is this information correct" S %=2 D YN^DICN I %<0 K EXAMS,REQDA,X,DIC,DA,Y,DVBAINSF,XMCNT F LPCNT=0:0 S LPCNT=$O(XMVAR(LPCNT)) Q:LPCNT=""  K XMVAR(LPCNT)
"RTN","DVBCXFRA",80,0)
 I %<0 K LPCNT G EN
"RTN","DVBCXFRA",81,0)
 I %=0 W !!,"Answer YES if correct and NO if not" G YN
"RTN","DVBCXFRA",82,0)
 I %=1 W !!,"One moment please ...   "
"RTN","DVBCXFRA",83,0)
 ;
"RTN","DVBCXFRA",84,0)
DISPLAY1 ;
"RTN","DVBCXFRA",85,0)
 K CORR I %=2 S CORR=1 W @FF,!!,"Select part to correct:",!!!,"1. Veteran name",!,"2. Domain",!,"3. Exams",!,"4. All parts",!!,"Selection: " R SEL:DTIME G:'$T!(SEL[U) EXIT
"RTN","DVBCXFRA",86,0)
 I $D(CORR) I (SEL'?1N)!(+SEL'>0)!(+SEL'<5)!(SEL["?") W *7,!!,"Must be a number from 1 to 4.   " D CONTMES^DVBCUTL4 G DISPLAY1
"RTN","DVBCXFRA",87,0)
 I $D(CORR) G CORSEL
"RTN","DVBCXFRA",88,0)
 D INREAS^DVBCXUTL
"RTN","DVBCXFRA",89,0)
 G ^DVBCXFRB
"RTN","DVBCXFRA",90,0)
 ;
"RTN","DVBCXFRA",91,0)
EXIT D CLRVAR^DVBCXUTL
"RTN","DVBCXFRA",92,0)
 D KILLVRS^DVBCXUTL G KILL^DVBCUTIL
"RTN","DVBCXFRB")
0^52^B16864719^B16766311
"RTN","DVBCXFRB",1,0)
DVBCXFRB ;ALB/GTS-557/THM-LOAD TRANSFER MAIL MESSAGE ; 4/29/91  8:09 AM
"RTN","DVBCXFRB",2,0)
 ;;2.7;AMIE;**149,193**;Apr 10, 1995;Build 84
"RTN","DVBCXFRB",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","DVBCXFRB",4,0)
 ;
"RTN","DVBCXFRB",5,0)
EN ;file 2
"RTN","DVBCXFRB",6,0)
 N DVBSBRCH,DVBDTYPE
"RTN","DVBCXFRB",7,0)
 K ^TMP("DVBCXFR",$J),L S X=^DVB(396.3,REQDA,0),DFN=$P(X,U,1)
"RTN","DVBCXFRB",8,0)
 S X=^DPT(DFN,0),PNAM=$P(X,U,1),DOB=$P(X,U,3),SEX=$P(X,U,2),SSN=$P(X,U,9)
"RTN","DVBCXFRB",9,0)
 S X=$S($D(^DPT(DFN,.11)):^(.11),1:""),ADR1=$P(X,U,1),ADR2=$P(X,U,2),ADR3=$P(X,U,3),CITY=$P(X,U,4),STATE=$P(X,U,5),ZIP=$P(X,U,6),CNTY=$P(X,U,7),ZIP4=$P(X,U,12)
"RTN","DVBCXFRB",10,0)
 S CNTY=$S($D(^DIC(5,+STATE,1,+CNTY,0)):$P(^(0),U,1),1:""),STATE=$S($D(^DIC(5,+STATE,0)):$P(^(0),U,1),1:"")
"RTN","DVBCXFRB",11,0)
 S X=$S($D(^DPT(DFN,.13)):^(.13),1:"") S HOMPHON=$P(X,U,1),BUSPHON=$P(X,U,2)
"RTN","DVBCXFRB",12,0)
 S X=$S($D(^DPT(DFN,.3)):^(.3),1:""),SRVCON=$P(X,U,1),SRVPCT=$P(X,U,2)
"RTN","DVBCXFRB",13,0)
 S X=$S($D(^DPT(DFN,.31)):^(.31),1:""),CNUM=$P(X,U,3)
"RTN","DVBCXFRB",14,0)
 S CFLOC=$$STATION^DVBAUTL1(DFN)
"RTN","DVBCXFRB",15,0)
 S:CFLOC=-1 CFLOC=""
"RTN","DVBCXFRB",16,0)
 S X=$S($D(^DPT(DFN,.32)):^(.32),1:""),PDSRV=$P(X,U,3),PDSRV=$S($D(^DIC(21,+PDSRV,0)):$P(^(0),U,3),1:"")
"RTN","DVBCXFRB",17,0)
 S X=$$SVC^DVBCUTIL(DFN,"I"),SRVEDT=$P(X,U),SRVSDT=$P(X,U,2)
"RTN","DVBCXFRB",18,0)
 S X=$$SVC^DVBCUTIL(DFN,"E"),DVBSBRCH=$P(X,U,3),DVBDTYPE=$P(X,U,4)
"RTN","DVBCXFRB",19,0)
 S X=$S($D(^DPT(DFN,.36)):^(.36),1:""),ELIGCOD=$P(X,U,1),ELIGCOD=$S($D(^DIC(8,+ELIGCOD,0)):$P(^(0),U,9),1:"")
"RTN","DVBCXFRB",20,0)
 S X=$S($D(^DPT(DFN,.361)):^(.361),1:""),ELIGST=$P(X,U,1),ELIGSDT=$P(X,U,2)
"RTN","DVBCXFRB",21,0)
 S X=$S($D(^DPT(DFN,.52)):^(.52),1:""),POWSTAT=$P(X,U,5)
"RTN","DVBCXFRB",22,0)
 S X=$S($D(^DPT(DFN,"VET")):^("VET"),1:""),VETST=$P(X,U,1)
"RTN","DVBCXFRB",23,0)
 S X=$S($D(^DPT(DFN,"TYPE")):^("TYPE"),1:"") S TYPE=$S(X]"":$P(^DG(391,X,0),U,1),1:"")
"RTN","DVBCXFRB",24,0)
 S LINE(1)="$DEM0 "_PNAM_U_DOB_U_SEX_U_SSN
"RTN","DVBCXFRB",25,0)
 S LINE(2)="$DEM1 "_ADR1_U_ADR2_U_ADR3_U_CITY_U_STATE_U_CNTY_U_ZIP_U_HOMPHON_U_BUSPHON_U_ZIP4
"RTN","DVBCXFRB",26,0)
 S LINE(3)="$ELIG "_SRVCON_U_SRVPCT_U_CFLOC_U_CNUM_U_PDSRV_U_SRVEDT_U_SRVSDT_U_ELIGCOD_U_ELIGST_U_ELIGSDT_U_POWSTAT_U_VETST_U_TYPE_U_DVBSBRCH_U_DVBDTYPE
"RTN","DVBCXFRB",27,0)
 ;
"RTN","DVBCXFRB",28,0)
 ;file 396.3
"RTN","DVBCXFRB",29,0)
EN1 S X=^DVB(396.3,REQDA,0),RO=$P(X,U,3),RONAM=$P($G(^DIC(4,+RO,99)),U,1),REQDT=$P(X,U,2),FEXM=$P(X,U,9),PRIO=$P(X,U,10),OTHDIS=$P(X,U,11),LREXMDT=$P(X,U,20)
"RTN","DVBCXFRB",30,0)
 S X=$S($D(^DVB(396.3,REQDA,1)):^(1),1:""),CFREQ=$P(X,U,2),OTHDOC=$P(X,U,3),LREXMDT=$P(X,U,7),OTHDIS1=$P(X,U,9),OTHDIS2=$P(X,U,10)
"RTN","DVBCXFRB",31,0)
 S LINE(4)="$REQ0 "_REQDA_U_RO_U_PRIO_U_CFLOC_U_LREXMDT_U_CFREQ_U_LREXMDT_U_RONAM_U_U_REQDT
"RTN","DVBCXFRB",32,0)
 S LINE(5)="$ODIS "_OTHDIS_U_OTHDIS1_U_OTHDIS2
"RTN","DVBCXFRB",33,0)
 S EXAMS="$EXAM "_EXAMS,LINE(6)=EXAMS
"RTN","DVBCXFRB",34,0)
 ;**NOTE: RONAM is now RO NUMBER
"RTN","DVBCXFRB",35,0)
LOAD S L=1,^TMP("DVBCXFR",$J,L,0)="$TRANSFER IN",L=L+1
"RTN","DVBCXFRB",36,0)
 F X=1:1 Q:'$D(LINE(X))  S ^TMP("DVBCXFR",$J,L,0)=LINE(X),L=L+1
"RTN","DVBCXFRB",37,0)
 F JI=0:0 S JI=$O(^DVB(396.3,REQDA,2,JI)) Q:JI=""  S ^TMP("DVBCXFR",$J,L,0)="$REMK "_^DVB(396.3,REQDA,2,JI,0),L=L+1
"RTN","DVBCXFRB",38,0)
 S SITE=$P(^XMB(1,1,0),U,1),SITE1=$P(^DIC(4.2,SITE,0),U,1)
"RTN","DVBCXFRB",39,0)
 S USERNM=$P(^VA(200,DUZ,0),U,1),^TMP("DVBCXFR",$J,L,0)="$USER "_USERNM_U_SITE_U_SITE1,L=L+1
"RTN","DVBCXFRB",40,0)
 S ^TMP("DVBCXFR",$J,L,0)="$END "
"RTN","DVBCXFRB",41,0)
 N XMNODE
"RTN","DVBCXFRB",42,0)
 S XMNODE=0
"RTN","DVBCXFRB",43,0)
 F X=(L+1):1:(L+XMCNT) DO
"RTN","DVBCXFRB",44,0)
 .S XMNODE=XMNODE+1
"RTN","DVBCXFRB",45,0)
 .S ^TMP("DVBCXFR",$J,X,0)=XMVAR(XMNODE)
"RTN","DVBCXFRB",46,0)
 S ^TMP("DVBCXFR",$J,X+1,0)="$END1 "
"RTN","DVBCXFRB",47,0)
 ;
"RTN","DVBCXFRB",48,0)
SEND K XMZ
"RTN","DVBCXFRB",49,0)
 ;S XMY("POSTMASTER@"_DOMNAM)=DOMNUM
"RTN","DVBCXFRB",50,0)
 S XMY(DUZ)="",XMY("S.DVBA C PROCESS MAIL MESSAGE@"_DOMNAM)=DOMNUM,XMSUB="Transfer of C&P Exams",XMTEXT="^TMP(""DVBCXFR"",$J,",XMDUZ=DUZ D ^XMD
"RTN","DVBCXFRB",51,0)
 I $D(XMZ) W !!,"Transmitted as message # "_XMZ_" from this site to "_DOMNAM,! H 3
"RTN","DVBCXFRB",52,0)
 I '$D(XMZ) W !!,*7,"Message transmission error!",!,"Request WILL NOT be transferred!",!!,"Press RETURN  " R ANS:DTIME S OUT=1 G KILL^DVBCUTIL
"RTN","DVBCXFRB",53,0)
 ;if all ok, update main, sub-file
"RTN","DVBCXFRB",54,0)
 F III=0:0 S III=$O(XEXAMS(III)) Q:III=""  S DIE="^DVB(396.4,",DA=III,DR=".04///T;62///"_DOMNAM_";60////"_DT_";61///"_USERNM D ^DIE
"RTN","DVBCXFRB",55,0)
 K DIE,DA,DR S DIE="^DVB(396.3,",DA=REQDA,DR="31///y;32///N"
"RTN","DVBCXFRB",56,0)
 D ^DIE ;set transfer items
"RTN","DVBCXFRB",57,0)
 K LINE,DOMNUM,DOMNUM1,^TMP("DVBCXFR",$J),XMDUZ,III,L,JI,JY,XMY,XMZ,XMSUB,XMTEXT,XMDUZ,DIE,DA,DR,TYPE
"RTN","DVBCXFRB",58,0)
 G KILL^DVBCUTIL
"RTN","DVBCXFRC")
0^21^B92188379^B44128395
"RTN","DVBCXFRC",1,0)
DVBCXFRC ;ALB/GTS-557/THM-PROCESS TRANSFER-IN MAIL MESSAGE ; 10/4/91  9:26 AM
"RTN","DVBCXFRC",2,0)
 ;;2.7;AMIE;**1,6,18,65,149,193**;Apr 10, 1995;Build 84
"RTN","DVBCXFRC",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","DVBCXFRC",4,0)
 ;
"RTN","DVBCXFRC",5,0)
EN1 N XMB,RDAT,RSTS,CM,SP,UP K OUT,CNT S (CNTA,OUT,RDAT)=0,SP=" ",CM=",",UP="^"
"RTN","DVBCXFRC",6,0)
 X XMREC I XMRG["TRANSFER OUT" G EN1^DVBCXFRS
"RTN","DVBCXFRC",7,0)
 F DVBCI=0:0 X XMREC Q:XMER<0!(XMRG["$END")  S XLN=XMRG,SUB=$E(XLN,2,5),XLN=$E(XLN,7,245) D @SUB
"RTN","DVBCXFRC",8,0)
 ;check for existence of primary division
"RTN","DVBCXFRC",9,0)
 S DVBCDIV=$$PRIM^VASITE I DVBCDIV=""!(DVBCDIV=-1) D BULL8^DVBCXFRD G EXIT
"RTN","DVBCXFRC",10,0)
 ;check for unique regional office station# using variable ronam
"RTN","DVBCXFRC",11,0)
 S RO=$$FIND1^DIC(4,,"X",RONAM,"D",,"DVBCERR") I RO=""!(RO=0) S OUT=1 D BULL11^DVBCXFRD G EXIT
"RTN","DVBCXFRC",12,0)
 ;if primary division and regional office station# ok, then proceed
"RTN","DVBCXFRC",13,0)
 K XLN,CNTA I XMRG["$END" S OUT=0 D PATEDIT G:OUT EXIT D REQEDIT
"RTN","DVBCXFRC",14,0)
 I $D(DVBCNEW) S XMB="DVBA C NEW C&P VETERAN",XMB(1)=PNAM,XMB(2)=SSN,XMB(3)=$S($D(^VA(200,+DUZ,0)):$P(^(0),U),1:"Unknown user"),Y=DT X ^DD("DD") S XMB(4)=Y D ^XMB
"RTN","DVBCXFRC",15,0)
 ;
"RTN","DVBCXFRC",16,0)
EXIT D DELSER^DVBCUTL4 ;deletes the server message
"RTN","DVBCXFRC",17,0)
 K DGMSGF,TYPE,REASONS,DVBADMNM,EXMRS,XMORPV,DVBSBRCH,DVBDTYPE
"RTN","DVBCXFRC",18,0)
 K ADR1,ADR2,ADR3,BUSPHON,CFLOC,CFREQ,CITY,CLTY,CNTY,CNUM,DFN,DOB
"RTN","DVBCXFRC",19,0)
 K DVBCDIV,DVBCI,ECF,ELIGCOD,ELIGST,ELIGSDT,EXAMS,EXM,HOMPHON,I,II,LREXMDT
"RTN","DVBCXFRC",20,0)
 K OLREQDA,OREQDA,OTHDIS,OTHDIS1,OTHDIS2,PDSRV,REMK,REASONS,RIEN,RRIF,RRF
"RTN","DVBCXFRC",21,0)
 K PIEN,PNAM,POWSTAT,PRIO,RD,RDIV,REQDA,REQDT,RR,RONAM,RO,RRDT,RRDIV,RRT,RQDT
"RTN","DVBCXFRC",22,0)
 K RRFD,RRIEN,RRR,RRST,RRXM,SEX,SITE,SITE1,SPEC,SRVCON,SRVEDT,SRVSDT
"RTN","DVBCXFRC",23,0)
 K SSN,STATE,USERNM,VETST,X,XEXAMS,XMCNT,XMVAR,ZIP,ZIP4,RRUP,SRVPCT
"RTN","DVBCXFRC",24,0)
 K SUB,TYPEPTR,USER,XMER,XMRG,XMREC,ZI,PREF,POBC,POBS,CSPT,DVP
"RTN","DVBCXFRC",25,0)
 G KILL^DVBCUTIL
"RTN","DVBCXFRC",26,0)
 ;
"RTN","DVBCXFRC",27,0)
DEM0 S PNAM=$E($P(XLN,U,1),1,28),DOB=$P(XLN,U,2),SEX=$P(XLN,U,3)
"RTN","DVBCXFRC",28,0)
 S SSN=$P(XLN,U,4),POBC=$P(XLN,U,5),POBS=$P(XLN,U,6),ICN=$P(XLN,U,7)
"RTN","DVBCXFRC",29,0)
 S PREF=$P(XLN,U,8),CSPT=$P(XLN,U,9)
"RTN","DVBCXFRC",30,0)
 Q
"RTN","DVBCXFRC",31,0)
 ;
"RTN","DVBCXFRC",32,0)
USER S USER=$P(XLN,U,1),SITE=$P(XLN,U,2),SITE1=$P(XLN,U,3)
"RTN","DVBCXFRC",33,0)
 Q
"RTN","DVBCXFRC",34,0)
 ;
"RTN","DVBCXFRC",35,0)
DEM1 S ADR1=$P(XLN,U,1),ADR2=$P(XLN,U,2),ADR3=$P(XLN,U,3),CITY=$P(XLN,U,4),STATE=$P(XLN,U,5),CNTY=$P(XLN,U,6),ZIP=$P(XLN,U,7),HOMPHON=$P(XLN,U,8),BUSPHON=$P(XLN,U,9),ZIP4=$P(XLN,U,10)
"RTN","DVBCXFRC",36,0)
 I STATE?.E1A.E S STATE=$O(^DIC(5,"B",STATE,0)) DO
"RTN","DVBCXFRC",37,0)
 .I CNTY?.E1A.E S CNTY=$O(^DIC(5,+STATE,1,"B",CNTY,0)) Q
"RTN","DVBCXFRC",38,0)
 I 'STATE S STATE=""
"RTN","DVBCXFRC",39,0)
 I 'CNTY S CNTY=""
"RTN","DVBCXFRC",40,0)
 Q
"RTN","DVBCXFRC",41,0)
 ;
"RTN","DVBCXFRC",42,0)
ELIG S SRVCON=$P(XLN,U,1),SRVPCT=$P(XLN,U,2),CFLOC=$P(XLN,U,3),CNUM=$P(XLN,U,4),PDSRV=$P(XLN,U,5),SRVEDT=$P(XLN,U,6),SRVSDT=$P(XLN,U,7),ELIGCOD=$P(XLN,U,8),ELIGST=$P(XLN,U,9),ELIGSDT=$P(XLN,U,10),POWSTAT=$P(XLN,U,11),VETST=$P(XLN,U,12)
"RTN","DVBCXFRC",43,0)
 S TYPE=$P(XLN,U,13),DVBSBRCH=$P(XLN,U,14),DVBDTYPE=$P(XLN,U,15),TYPEPTR=""
"RTN","DVBCXFRC",44,0)
 S:TYPE]"" TYPEPTR=$O(^DG(391,"B",TYPE,TYPEPTR))
"RTN","DVBCXFRC",45,0)
 S ELIGCOD=$O(^DIC(8,"D",+ELIGCOD,0))
"RTN","DVBCXFRC",46,0)
 S ELIGCOD=$S(ELIGCOD="":"",$D(^DIC(8,"D",+ELIGCOD)):$O(^DIC(8,"D",+ELIGCOD,0)),1:"")
"RTN","DVBCXFRC",47,0)
 S PDSRV=$S(PDSRV="":"",$D(^DIC(21,"D",PDSRV)):$O(^DIC(21,"D",PDSRV,0)),1:"")
"RTN","DVBCXFRC",48,0)
 Q
"RTN","DVBCXFRC",49,0)
 ;
"RTN","DVBCXFRC",50,0)
 ; $REQ0 "_REQDA_U_RO_U_PRIO_U_CFLOC_U_LREXMDT_U_CFREQ_U_LREXMDT_U_RONAM_U_RDIV_U_REQDT_U_DMAS
"RTN","DVBCXFRC",51,0)
 ;
"RTN","DVBCXFRC",52,0)
REQ0 S OLREQDA=$P(XLN,U,1),RO=$P(XLN,U,2),RONAM=$P(XLN,U,8),RDIV=$P(XLN,U,9)
"RTN","DVBCXFRC",53,0)
 S PRIO=$P(XLN,U,3),CFLOC=+$P(XLN,U,4),LREXMDT=$P(XLN,U,5),CFREQ=$P(XLN,U,6)
"RTN","DVBCXFRC",54,0)
 S LREXMDT=$P(XLN,U,7),RQDT=$P(XLN,U,10),DMAS=$P(XLN,U,11)
"RTN","DVBCXFRC",55,0)
 S CFLOC=$O(^DIC(4,"D",CFLOC,""))
"RTN","DVBCXFRC",56,0)
 S:'$D(^DIC(4,+CFLOC,0)) CFLOC=""
"RTN","DVBCXFRC",57,0)
 Q
"RTN","DVBCXFRC",58,0)
 ;
"RTN","DVBCXFRC",59,0)
ODIS S OTHDIS=$P(XLN,U,1),OTHDIS1=$P(XLN,U,2),OTHDIS2=$P(XLN,U,3)
"RTN","DVBCXFRC",60,0)
 Q
"RTN","DVBCXFRC",61,0)
 ;
"RTN","DVBCXFRC",62,0)
EXAM S EXAMS=$P(XLN,"^^",1),REASONS=$P(XLN,"^^",2)
"RTN","DVBCXFRC",63,0)
 Q
"RTN","DVBCXFRC",64,0)
 ;
"RTN","DVBCXFRC",65,0)
REMK S:'$D(CNT) CNT=0 S CNT=CNT+1,REMK(CNT)=XLN
"RTN","DVBCXFRC",66,0)
 Q
"RTN","DVBCXFRC",67,0)
 ;
"RTN","DVBCXFRC",68,0)
 ; AJF ; 2507 Reroute fields
"RTN","DVBCXFRC",69,0)
RDAT S OREQDA=$P(XLN,"^",1),PIEN=$P(XLN,"^",2),RRF=$P(XLN,"^",3)
"RTN","DVBCXFRC",70,0)
 S RR=$P(XLN,"^",4),RD=$P(XLN,"^",5),RRT=$P(XLN,"^",6)
"RTN","DVBCXFRC",71,0)
 S RRDT=$P(XLN,"^",7),CLTY=$P(XLN,"^",8),ECF=$P(XLN,"^",9)
"RTN","DVBCXFRC",72,0)
 S RRFD=$P(XLN,"^",10),RRFIEN=$P(XLN,"^",11),RRFSTN=$P(XLN,"^",12)
"RTN","DVBCXFRC",73,0)
 S STN=$P(XLN,"^",13),INUM=$P(XLN,"^",14)
"RTN","DVBCXFRC",74,0)
 S RDAT=1
"RTN","DVBCXFRC",75,0)
 Q
"RTN","DVBCXFRC",76,0)
 ;
"RTN","DVBCXFRC",77,0)
SPEC F II=1:1  S SPEC(II)=$P(XLN,"^",II) Q:SPEC(II)=""
"RTN","DVBCXFRC",78,0)
 Q
"RTN","DVBCXFRC",79,0)
 ;
"RTN","DVBCXFRC",80,0)
REQEDIT ;  ** Add entry to file #396.3 (request)
"RTN","DVBCXFRC",81,0)
 K DD,DO,DA,DR,DIC,X,Y
"RTN","DVBCXFRC",82,0)
 ;I '$D(DFN) S OUT=1 D BULL1^DVBCXFRD Q 
"RTN","DVBCXFRC",83,0)
 ;
"RTN","DVBCXFRC",84,0)
 S DIC="^DVB(396.3,",DLAYGO=396.3,DIC(0)="L",X=DFN
"RTN","DVBCXFRC",85,0)
 S:$G(RDAT)=0 ECF=""
"RTN","DVBCXFRC",86,0)
 S DIC("DR")="1///"_RQDT_";2////"_RO_";3////.5;4////"_DMAS_";9////"_PRIO_";30////"_OLREQDA
"RTN","DVBCXFRC",87,0)
 D FILE^DICN K DLAYGO
"RTN","DVBCXFRC",88,0)
 S (DA,REQDA)=+Y I DA<0 S OUT=1 D BULL1^DVBCXFRD Q
"RTN","DVBCXFRC",89,0)
 ;Give Med Center Primary Division as routing location (DVBCDIV)
"RTN","DVBCXFRC",90,0)
 S DIE="^DVB(396.3,"
"RTN","DVBCXFRC",91,0)
 S RSTS=$S($G(RDAT)=0:9,1:11)
"RTN","DVBCXFRC",92,0)
 S DVP=$P(^DVB(396.15,RDIV,0),"^")
"RTN","DVBCXFRC",93,0)
 S DR="10////"_OTHDIS_";10.1////"_OTHDIS1_";10.2////"_OTHDIS2_";17////"_RSTS D ^DIE
"RTN","DVBCXFRC",94,0)
 S DR="21////"_CFREQ_";23.3////"_LREXMDT_";24////"_DVP_";21.1////"_ECF
"RTN","DVBCXFRC",95,0)
 D ^DIE K DIC,DIE,DD,DO
"RTN","DVBCXFRC",96,0)
 I +RDAT D
"RTN","DVBCXFRC",97,0)
 .; AJF ;New Reroute fields
"RTN","DVBCXFRC",98,0)
 .S RIEN=REQDA
"RTN","DVBCXFRC",99,0)
 .S RRIF=$$UPRR^DVBCUTL8(DA,RRDT)
"RTN","DVBCXFRC",100,0)
 .S DA=$P(RRIF,"^")
"RTN","DVBCXFRC",101,0)
 .S DIE="^DVB(396.3,"_RIEN_",6,",DA(1)=RIEN
"RTN","DVBCXFRC",102,0)
 .S DR="1////"_OREQDA_";2////"_PIEN_";3////"_RRF_";4////"_RR_";5////"_RD_";.02////"_RRT
"RTN","DVBCXFRC",103,0)
 .S DR=DR_";.9////"_INUM_";10////"_STN_";11////"_RRFIEN_";12////"_RRFSTN
"RTN","DVBCXFRC",104,0)
 .D ^DIE ;set Reroute fields
"RTN","DVBCXFRC",105,0)
 .S RRIEN=DA,RRST="N",RRR=""
"RTN","DVBCXFRC",106,0)
 .S RRUP=$$UPRS^DVBCUTL8(RIEN,RRIEN,RRDT,RRST,RRR) ; Update the status
"RTN","DVBCXFRC",107,0)
 .;
"RTN","DVBCXFRC",108,0)
 .S II=0
"RTN","DVBCXFRC",109,0)
 .F  S II=$O(SPEC(II)) Q:II=""  D
"RTN","DVBCXFRC",110,0)
 ..S DIC="^DVB(396.3,"_RIEN_",8,",DA(1)=RIEN,DLAYGO=396.3,DIC(0)="L",X=SPEC(II)
"RTN","DVBCXFRC",111,0)
 ..D FILE^DICN K DIC
"RTN","DVBCXFRC",112,0)
 .;
"RTN","DVBCXFRC",113,0)
 .S DIC="^DVB(396.3,"_RIEN_",9,",DA(1)=RIEN,DLAYGO=396.3,DIC(0)="L",X=CLTY
"RTN","DVBCXFRC",114,0)
 .D FILE^DICN K DLAYGO,DIC
"RTN","DVBCXFRC",115,0)
 .;Add to Treating Facility List 
"RTN","DVBCXFRC",116,0)
 .;D FILENEW^VAFCTFU(DFN,RRF)
"RTN","DVBCXFRC",117,0)
 ;
"RTN","DVBCXFRC",118,0)
 S CNT=0 I '$D(^DVB(396.3,REQDA,2,0)) S ^(0)="^^0^0^"_DT_"^^^^"
"RTN","DVBCXFRC",119,0)
 F ZI=0:0 S ZI=$O(REMK(ZI)) Q:ZI=""  S X=REMK(ZI) S CNT=CNT+1,^DVB(396.3,REQDA,2,CNT,0)=X F Y=3,4 S $P(^DVB(396.3,REQDA,2,0),U,Y)=CNT
"RTN","DVBCXFRC",120,0)
 S X="",DVBADMNM=$P(SITE1,".",1)
"RTN","DVBCXFRC",121,0)
 F I=1:1 S EXM=$P(EXAMS,U,I) Q:EXM=""  D SETVARS Q:OUT
"RTN","DVBCXFRC",122,0)
 ;if adding exams failed, then delete request
"RTN","DVBCXFRC",123,0)
 I OUT S DA=REQDA,DIK="^DVB(396.3," D ^DIK K DA,DIK
"RTN","DVBCXFRC",124,0)
 Q
"RTN","DVBCXFRC",125,0)
 ;
"RTN","DVBCXFRC",126,0)
PATEDIT ;  ** Lookup and/or Add entry to file #2 (patient)
"RTN","DVBCXFRC",127,0)
 N DVBCPT,DVBCARAY,DVBCERR,DVBCIENS,DOB2,NAME1,NAME2,BYEAR,X,Y
"RTN","DVBCXFRC",128,0)
 K DVBCNEW S DVBCPT=$$FIND1^DIC(2,,"X",SSN,"SSN",,"DVBCERR")
"RTN","DVBCXFRC",129,0)
 ;if error returned, send error msg
"RTN","DVBCXFRC",130,0)
 I DVBCPT="" S OUT=1 D BULL9^DVBCXFRD Q
"RTN","DVBCXFRC",131,0)
 ;if found matching ssn, make sure the name and dob also match
"RTN","DVBCXFRC",132,0)
 I +DVBCPT>0 D  Q
"RTN","DVBCXFRC",133,0)
 .S DVBCIENS=DVBCPT_"," K DVBCERR
"RTN","DVBCXFRC",134,0)
 .D GETS^DIQ(2,DVBCIENS,".01;.03;.09","I","DVBCARAY","DVBCERR")
"RTN","DVBCXFRC",135,0)
 .;if fm returned an error msg and no data, send error msg
"RTN","DVBCXFRC",136,0)
 .I '$D(DVBCARAY(2,DVBCIENS)) S OUT=1 D BULL10^DVBCXFRD Q
"RTN","DVBCXFRC",137,0)
 .;make sure about that ssn
"RTN","DVBCXFRC",138,0)
 .I SSN'=DVBCARAY(2,DVBCIENS,.09,"I") S OUT=1,DVBCERR(1)="Possible 'SSN' index problem.",DVBCERR(2)=""
"RTN","DVBCXFRC",139,0)
 .;if name and/or dob don't match, send error msg
"RTN","DVBCXFRC",140,0)
 .I (PNAM'=DVBCARAY(2,DVBCIENS,.01,"I"))!(DOB'=DVBCARAY(2,DVBCIENS,.03,"I")) D  Q:OUT
"RTN","DVBCXFRC",141,0)
 ..S X=$P(PNAM,",",1),NAME1(1)=$P(X," ",1),X=$P(PNAM,",",2),NAME1(2)=$P(X," ",1)
"RTN","DVBCXFRC",142,0)
 ..S X=$P(DVBCARAY(2,DVBCIENS,.01,"I"),",",1),NAME2(1)=$P(X," ",1),X=$P(DVBCARAY(2,DVBCIENS,.01,"I"),",",2),NAME2(2)=$P(X," ",1)
"RTN","DVBCXFRC",143,0)
 ..I (NAME1(1)'=NAME2(1))!(NAME1(2)'=NAME2(2)) S OUT=1
"RTN","DVBCXFRC",144,0)
 ..S BYEAR(1)=$E(DOB,1,3),BYEAR(2)=$E(DVBCARAY(2,DVBCIENS,.03,"I"),1,3)
"RTN","DVBCXFRC",145,0)
 ..I BYEAR(1)'=BYEAR(2) S OUT=1
"RTN","DVBCXFRC",146,0)
 ..I OUT D
"RTN","DVBCXFRC",147,0)
 ...S DVBCERR(1)="Patient name and/or DOB at target site does not match transfer request."
"RTN","DVBCXFRC",148,0)
 ...S DOB2=DVBCARAY(2,DVBCIENS,.03,"I") S Y=DOB2 X ^DD("DD") S DOB2=Y
"RTN","DVBCXFRC",149,0)
 ...S DVBCERR(2)="Name: "_DVBCARAY(2,DVBCIENS,.01,"I")_"   DOB: "_DOB2
"RTN","DVBCXFRC",150,0)
 ...D BULL10^DVBCXFRD
"RTN","DVBCXFRC",151,0)
 .S DFN=+DVBCPT K X,Y,DIC
"RTN","DVBCXFRC",152,0)
 ;if no match, then add record
"RTN","DVBCXFRC",153,0)
 I +DVBCPT=0 D  Q
"RTN","DVBCXFRC",154,0)
 .;Required elements include:
"RTN","DVBCXFRC",155,0)
 .; PARAM("PRFCLTY")=PREFERRED FACILITY
"RTN","DVBCXFRC",156,0)
 .; PARAM("NAME")=NAME (last name minimal; recommend full name)
"RTN","DVBCXFRC",157,0)
 .; PARAM("GENDER")=SEX
"RTN","DVBCXFRC",158,0)
 .; PARAM("DOB")=DATE OF BIRTH
"RTN","DVBCXFRC",159,0)
 .; PARAM("SSN")=SOCIAL SECURITY NUMBER OR NULL IF NONE
"RTN","DVBCXFRC",160,0)
 .; PARAM("SRVCNCTD")=SERVICE CONNECTED?
"RTN","DVBCXFRC",161,0)
 .; PARAM("TYPE")=TYPE
"RTN","DVBCXFRC",162,0)
 .; PARAM("VET")=VETERAN (Y/N)?
"RTN","DVBCXFRC",163,0)
 .; PARAM("FULLICN")=INTEGRATION CONTROL NUMBER AND CHECKSUM
"RTN","DVBCXFRC",164,0)
 .; .301 SERVICE CONNECTED?
"RTN","DVBCXFRC",165,0)
 .; .302 SERVICE CONNECTED PERCENTAGE
"RTN","DVBCXFRC",166,0)
 .; .314 CLAIM FOLDER LOCATION
"RTN","DVBCXFRC",167,0)
 .; .313 CLAIM NUMBER
"RTN","DVBCXFRC",168,0)
 .; .323 PERIOD OF SERVICE
"RTN","DVBCXFRC",169,0)
 .; .326 SERVICE ENTRY DATE [LAST]
"RTN","DVBCXFRC",170,0)
 .; .327 SERVICE SEPARATION DATE [LAST]
"RTN","DVBCXFRC",171,0)
 .; .361 PRIMARY ELIGIBILITY CODE
"RTN","DVBCXFRC",172,0)
 .; .3611 ELIGIBILITY STATUS
"RTN","DVBCXFRC",173,0)
 .; .3612 ELIGIBILITY STATUS DATE
"RTN","DVBCXFRC",174,0)
 .; .525 POW STATUS INDICATED?
"RTN","DVBCXFRC",175,0)
 .; 1901 VETERAN (Y/N)?
"RTN","DVBCXFRC",176,0)
 .; 391 TYPE
"RTN","DVBCXFRC",177,0)
 .S PNAM=$TR(PNAM,CM,UP),PNAM=$TR(PNAM,SP,UP)
"RTN","DVBCXFRC",178,0)
 .S PARAM("PRFCLTY")=PREF,PARAM("NAME")=PNAM,PARAM("GENDER")=SEX,PARAM("DOB")=DOB
"RTN","DVBCXFRC",179,0)
 .S PARAM("SSN")=SSN,PARAM("SRVCNCTD")=SRVCON,PARAM("TYPE")=TYPE,PARAM("VET")=VETST
"RTN","DVBCXFRC",180,0)
 .S PARAM("FULLICN")=ICN
"RTN","DVBCXFRC",181,0)
 .;
"RTN","DVBCXFRC",182,0)
 .S ^XTMP("CAPRI",PNAM,0)=""
"RTN","DVBCXFRC",183,0)
 .S ^XTMP("CAPRI",PNAM,"PRFCLTY")=PREF,^XTMP("CAPRI",PNAM,"NAME")=PNAM
"RTN","DVBCXFRC",184,0)
 .S ^XTMP("CAPRI",PNAM,"GENDER")=SEX,^XTMP("CAPRI",PNAM,"DOB")=DOB
"RTN","DVBCXFRC",185,0)
 .S ^XTMP("CAPRI",PNAM,"SSN")=SSN,^XTMP("CAPRI",PNAM,"SRVCNCTD")=SRVCON
"RTN","DVBCXFRC",186,0)
 .S ^XTMP("CAPRI",PNAM,"TYPE")=TYPEPTR,^XTMP("CAPRI",PNAM,"VET")=VETST
"RTN","DVBCXFRC",187,0)
 .S ^XTMP("CAPRI",PNAM,"FULLICN")=ICN
"RTN","DVBCXFRC",188,0)
 .;
"RTN","DVBCXFRC",189,0)
 .; IA 6810
"RTN","DVBCXFRC",190,0)
 .D ADD^VAFCPTAD(.RET,.PARAM)
"RTN","DVBCXFRC",191,0)
 .I $P(RET(1),"^")'=1 D BULL3^DVBCXFRD S OUT=1 Q
"RTN","DVBCXFRC",192,0)
 .S DFN=$P(RET(1),"^",2) S RESLT=$$A24^MPIFA24B(DFN)
"RTN","DVBCXFRC",193,0)
 .S DGMSGF=1 ;why is this variable needed?
"RTN","DVBCXFRC",194,0)
 .D ADDEDIT
"RTN","DVBCXFRC",195,0)
 .S DIE="^DPT(",DA=DFN
"RTN","DVBCXFRC",196,0)
 .S DR(1,2,1)=".302////"_SRVPCT_";.314////"_CFLOC_";.313////"_CNUM_";.323////"_PDSRV_$S('+$$VFILE^DILFD(2.3216):";.326////"_SRVEDT_";.327////"_SRVSDT,1:"")_";.361////"_ELIGCOD
"RTN","DVBCXFRC",197,0)
 .S DR(1,2,2)=".3611////"_ELIGST_";.3612////"_ELIGSDT_";.525////"_POWSTAT
"RTN","DVBCXFRC",198,0)
 .D ^DIE
"RTN","DVBCXFRC",199,0)
 .;MSE data now to be stored in .3216 subfile in the PATIENT File (2)
"RTN","DVBCXFRC",200,0)
 .;after Patch DG*5.3*797 has been installed. Editing of the fields
"RTN","DVBCXFRC",201,0)
 .;.326 and .327 above can be removed once DG*5.3*797 has been released.
"RTN","DVBCXFRC",202,0)
 .D:((+$$VFILE^DILFD(2.3216))&(SRVEDT]"")) CRTMSE
"RTN","DVBCXFRC",203,0)
 .;Set Sensitive Record 
"RTN","DVBCXFRC",204,0)
 .I CSPT D
"RTN","DVBCXFRC",205,0)
 ..S (X,DINUM)=DFN,DIC(0)="L",DLAYGO=38.1
"RTN","DVBCXFRC",206,0)
 ..S DIC("DR")="2///1;3///.5;4///"_$$HTFM^XLFDT($H)
"RTN","DVBCXFRC",207,0)
 ..S DIC="^DGSL(38.1,"
"RTN","DVBCXFRC",208,0)
 ..D FILE^DICN K DLAYGO
"RTN","DVBCXFRC",209,0)
 Q 
"RTN","DVBCXFRC",210,0)
 ;
"RTN","DVBCXFRC",211,0)
 ;.K DA,DR,DIC,DO,DD,X,Y S DVBCNEW=1
"RTN","DVBCXFRC",212,0)
 ;.S DLAYGO=2,DIC="^DPT(",DIC(0)="L",X=PNAM,DIC("DR")=".02////"_SEX_";.03////"_DOB_";.09////"_SSN
"RTN","DVBCXFRC",213,0)
 ;.D FILE^DICN K DLAYGO S (DFN,DA)=+Y
"RTN","DVBCXFRC",214,0)
 ;.I DA<0 D BULL3^DVBCXFRD S OUT=1 Q
"RTN","DVBCXFRC",215,0)
 ;.S DGMSGF=1 ;why is this variable needed?
"RTN","DVBCXFRC",216,0)
 ;.D ADDEDIT
"RTN","DVBCXFRC",217,0)
 ;.S DIE="^DPT(",DA=DFN
"RTN","DVBCXFRC",218,0)
 ;.S DR(1,2,1)=".301////"_SRVCON_";.302////"_SRVPCT_";.314////"_CFLOC_";.313////"_CNUM_";.323////"_PDSRV_$S('+$$VFILE^DILFD(2.3216):";.326////"_SRVEDT_";.327////"_SRVSDT,1:"")_";.361////"_ELIGCOD
"RTN","DVBCXFRC",219,0)
 ;.S DR(1,2,2)=".3611////"_ELIGST_";.3612////"_ELIGSDT_";.525////"_POWSTAT_";1901////"_VETST
"RTN","DVBCXFRC",220,0)
 ;.S:TYPEPTR]"" DR(1,2,3)="391////"_TYPEPTR
"RTN","DVBCXFRC",221,0)
 ;.D ^DIE
"RTN","DVBCXFRC",222,0)
 ;.;MSE data now to be stored in .3216 subfile in the PATIENT File (2)
"RTN","DVBCXFRC",223,0)
 ;.;after Patch DG*5.3*797 has been installed. Editing of the fields
"RTN","DVBCXFRC",224,0)
 ;.;.326 and .327 above can be removed once DG*5.3*797 has been released.
"RTN","DVBCXFRC",225,0)
 ;.D:((+$$VFILE^DILFD(2.3216))&(SRVEDT]"")) CRTMSE
"RTN","DVBCXFRC",226,0)
 ;Q
"RTN","DVBCXFRC",227,0)
 ;
"RTN","DVBCXFRC",228,0)
SETVARS ;  ** Add entry to file #396.4 (exam) **
"RTN","DVBCXFRC",229,0)
 I REASONS'="" DO
"RTN","DVBCXFRC",230,0)
 .S EXMRS=$P(REASONS,U,I) ;**Stuff Insufficient Reason
"RTN","DVBCXFRC",231,0)
 .S XMORPV="Transferred from "_DVBADMNM ;**Stuff Original Provider
"RTN","DVBCXFRC",232,0)
 S DIC="^DVB(396.4,"
"RTN","DVBCXFRC",233,0)
 S DIC(0)="L",DLAYGO=396.4
"RTN","DVBCXFRC",234,0)
 S DIC("DR")=".02////"_REQDA_";.03////"_EXM_";.04////O;63////"_DT
"RTN","DVBCXFRC",235,0)
 S:REASONS'="" DIC("DR")=DIC("DR")_";.11///"_EXMRS_";.12///"_XMORPV
"RTN","DVBCXFRC",236,0)
 S X=$$EXAM^DVBCUTL4 I 'X S OUT=1 D BULL2^DVBCXFRD Q
"RTN","DVBCXFRC",237,0)
 K DD,DO D FILE^DICN
"RTN","DVBCXFRC",238,0)
 I +Y=-1 S OUT=1 D BULL2^DVBCXFRD
"RTN","DVBCXFRC",239,0)
 K DLAYGO,DIC,X,Y
"RTN","DVBCXFRC",240,0)
 Q
"RTN","DVBCXFRC",241,0)
 ;
"RTN","DVBCXFRC",242,0)
ADDEDIT ;  ** Add Patient address **
"RTN","DVBCXFRC",243,0)
 S DA=DFN,DIE="^DPT("
"RTN","DVBCXFRC",244,0)
 S DR=".111////"_ADR1_";.112////"_ADR2_";.113////"_ADR3_";.114////"_CITY_";.115////"_STATE
"RTN","DVBCXFRC",245,0)
 S DR=DR_$S(ZIP4]"":";.1112////"_ZIP4,1:";.116////"_ZIP)_";.117////"_CNTY_";.131////"_HOMPHON_";.132////"_BUSPHON
"RTN","DVBCXFRC",246,0)
 D ^DIE K DIE,DA
"RTN","DVBCXFRC",247,0)
 Q
"RTN","DVBCXFRC",248,0)
 ;
"RTN","DVBCXFRC",249,0)
CRTMSE ;create LAST MSE entry for patient in sub-file 2.3216
"RTN","DVBCXFRC",250,0)
 N DIC,X,Y,DA,DTOUT,DUOUT,DLAYGO
"RTN","DVBCXFRC",251,0)
 S DIC="^DPT("_DFN_",.3216,",DA(1)=DFN
"RTN","DVBCXFRC",252,0)
 S DIC(0)="FL",DLAYGO=2
"RTN","DVBCXFRC",253,0)
 S X=SRVEDT  ;.01 SERVICE ENTRY DATE
"RTN","DVBCXFRC",254,0)
 ;SERVICE SEPARATION DATE ; SERVICE BRANCH ; SERVICE DISCHARGE TYPE
"RTN","DVBCXFRC",255,0)
 S DIC("DR")=".02////"_SRVSDT_";.03///"_DVBSBRCH_";.06///"_DVBDTYPE
"RTN","DVBCXFRC",256,0)
 K DO D FILE^DICN K DLAYGO
"RTN","DVBCXFRC",257,0)
 Q
"RTN","DVBCXFRD")
0^53^B17669105^B17456538
"RTN","DVBCXFRD",1,0)
DVBCXFRD ;ALB/GTS-557/THM-MISCELLANOUS TRANSFER BULLETINS ; 4/17/91  10:59 AM
"RTN","DVBCXFRD",2,0)
 ;;2.7;AMIE;**18,193**;Apr 10, 1995;Build 84
"RTN","DVBCXFRD",3,0)
 ;
"RTN","DVBCXFRD",4,0)
BULL1 S FREAS="Addition of C&P request record at target site failed." K MCP D PAR Q
"RTN","DVBCXFRD",5,0)
 ;
"RTN","DVBCXFRD",6,0)
BULL2 ;  ** Adding exams failed & request deleted **
"RTN","DVBCXFRD",7,0)
 N FREAS,FREAS1
"RTN","DVBCXFRD",8,0)
 S FREAS="Addition of C&P exams for request record at target site failed."
"RTN","DVBCXFRD",9,0)
 S FREAS1="Therefore, the C&P request record was deleted."
"RTN","DVBCXFRD",10,0)
 K MCP D PAR
"RTN","DVBCXFRD",11,0)
 Q
"RTN","DVBCXFRD",12,0)
 ;
"RTN","DVBCXFRD",13,0)
BULL3 ;  ** Bulletin for creating New Patient record failed
"RTN","DVBCXFRD",14,0)
 N FREAS,FREAS1
"RTN","DVBCXFRD",15,0)
 S FREAS="Addition of veteran in Patient file at target site failed. "
"RTN","DVBCXFRD",16,0)
 S FREAS1=$P($G(RET(1)),"^",2)
"RTN","DVBCXFRD",17,0)
 K MCP,DVBCNEW D PAR
"RTN","DVBCXFRD",18,0)
 Q
"RTN","DVBCXFRD",19,0)
 ;
"RTN","DVBCXFRD",20,0)
BULL4 S FREAS="Missing C&P request for transfer in - pointer="_REQDA_".",MCP=1 D PAR Q
"RTN","DVBCXFRD",21,0)
 ;
"RTN","DVBCXFRD",22,0)
BULL5 S FREAS="Missing C&P exams for transfer in",MCP=1 D PAR Q
"RTN","DVBCXFRD",23,0)
 ;
"RTN","DVBCXFRD",24,0)
BULL6 S FREAS="Local unload of MailMan message failed." K MCP D PAR Q
"RTN","DVBCXFRD",25,0)
 ;
"RTN","DVBCXFRD",26,0)
BULL7 ;  **  Bulletin for failed address edit  **
"RTN","DVBCXFRD",27,0)
 S FREAS="Edit of veteran address in patient file at target site failed."
"RTN","DVBCXFRD",28,0)
 K MCP D PAR
"RTN","DVBCXFRD",29,0)
 Q
"RTN","DVBCXFRD",30,0)
 ;
"RTN","DVBCXFRD",31,0)
BULL8 ;  ** Target site has no primary division **
"RTN","DVBCXFRD",32,0)
 N FREAS,FREAS1
"RTN","DVBCXFRD",33,0)
 S FREAS="Addition of C&P request record at target site failed."
"RTN","DVBCXFRD",34,0)
 S FREAS1="Could not determine primary medical center division."
"RTN","DVBCXFRD",35,0)
 D PAR
"RTN","DVBCXFRD",36,0)
 Q
"RTN","DVBCXFRD",37,0)
 ;
"RTN","DVBCXFRD",38,0)
BULL9 ;  ** Duplicate SSNs exist or other problem in file #2 **
"RTN","DVBCXFRD",39,0)
 N ERR,FREAS,FREAS1
"RTN","DVBCXFRD",40,0)
 S FREAS="Update of patient data at target site failed."
"RTN","DVBCXFRD",41,0)
 ;if duplicate ssn, then send in error msg
"RTN","DVBCXFRD",42,0)
 I $D(DVBCERR("DIERR","E",299)) D
"RTN","DVBCXFRD",43,0)
 .S ERR=$O(DVBCERR("DIERR","E",299,0)) I ERR S FREAS1=DVBCERR("DIERR",ERR,"TEXT",1)
"RTN","DVBCXFRD",44,0)
 ;if other problem, then just send the first error msg available
"RTN","DVBCXFRD",45,0)
 I '$D(DVBCERR("DIERR","E",299)) D
"RTN","DVBCXFRD",46,0)
 .S FREAS1=DVBCERR("DIERR",1,"TEXT",1)
"RTN","DVBCXFRD",47,0)
 D PAR
"RTN","DVBCXFRD",48,0)
 Q
"RTN","DVBCXFRD",49,0)
 ;
"RTN","DVBCXFRD",50,0)
BULL10 ;  ** Same SSN but possibly different patient in file #2 **
"RTN","DVBCXFRD",51,0)
 N FREAS,FREAS1,FREAS2,FREAS3
"RTN","DVBCXFRD",52,0)
 S FREAS="Update of patient data at target site failed for SSN "_SSN_"."
"RTN","DVBCXFRD",53,0)
 ;if error returned from fm, just send the first error msg available
"RTN","DVBCXFRD",54,0)
 I $D(DVBCERR("DIERR")) S FREAS1=DVBCERR("DIERR",1,"TEXT",1)
"RTN","DVBCXFRD",55,0)
 ;if name or dob didn't match, then send back that info
"RTN","DVBCXFRD",56,0)
 I $D(DVBCERR(1)) S FREAS1=DVBCERR(1),FREAS2="At target site --",FREAS3=DVBCERR(2)
"RTN","DVBCXFRD",57,0)
 D PAR
"RTN","DVBCXFRD",58,0)
 Q
"RTN","DVBCXFRD",59,0)
 ;
"RTN","DVBCXFRD",60,0)
BULL11 ;  ** Regional office station# doesn't exist or not unique **
"RTN","DVBCXFRD",61,0)
 N FREAS,FREAS1,FREAS2
"RTN","DVBCXFRD",62,0)
 S FREAS="Addition of C&P request record at target site failed."
"RTN","DVBCXFRD",63,0)
 I RO="" S FREAS1="Your Regional Office station # ("_RONAM_") is not unique"
"RTN","DVBCXFRD",64,0)
 I RO=0 S FREAS1="Your Regional Office station # ("_RONAM_") could not be found"
"RTN","DVBCXFRD",65,0)
 S FREAS2="in the Institution file of the target site."
"RTN","DVBCXFRD",66,0)
 D PAR
"RTN","DVBCXFRD",67,0)
 Q
"RTN","DVBCXFRD",68,0)
 ;
"RTN","DVBCXFRD",69,0)
PAR K ^TMP("DVBC","BULL",$J)
"RTN","DVBCXFRD",70,0)
 S XMSUB="C&P Request Reroute Failure",XMDUZ=.5,XMTEXT="^TMP(""DVBC"",""BULL"",$J,",L=0
"RTN","DVBCXFRD",71,0)
 I $D(MCP) S USR=$S($D(^DVB(396.3,REQDA,4)):$P(^(4),U,2),1:0) I USR>0 S XMY(USR)="" D PAR1
"RTN","DVBCXFRD",72,0)
 S XMY("G.DVBA C 2507 REROUTE")=SITE
"RTN","DVBCXFRD",73,0)
 ;
"RTN","DVBCXFRD",74,0)
PAR1 S XMY(XMDUZ)="",L=1,^TMP("DVBC","BULL",$J,L,0)="The reroute of a C&P request "_$S($D(MCP):"from ",1:"to ")_$P(^DVB(396.1,1,0),U,1),L=L+1
"RTN","DVBCXFRD",75,0)
 K MCP S ^TMP("DVBC","BULL",$J,L,0)="for the following veteran has failed:",L=L+1
"RTN","DVBCXFRD",76,0)
 S ^TMP("DVBC","BULL",$J,L,0)="   ",L=L+1
"RTN","DVBCXFRD",77,0)
 S ^TMP("DVBC","BULL",$J,L,0)="   Name: "_PNAM_"   SSN: "_SSN_"   "_"C-Number: "_CNUM,L=L+1
"RTN","DVBCXFRD",78,0)
 S Y=DOB X ^DD("DD") S DOB2=Y
"RTN","DVBCXFRD",79,0)
 S ^TMP("DVBC","BULL",$J,L,0)="   DOB: "_DOB2,L=L+1
"RTN","DVBCXFRD",80,0)
 S ^TMP("DVBC","BULL",$J,L,0)="  ",L=L+1
"RTN","DVBCXFRD",81,0)
 S ^TMP("DVBC","BULL",$J,L,0)="Reason for failure: ",L=L+1
"RTN","DVBCXFRD",82,0)
 S ^TMP("DVBC","BULL",$J,L,0)="  ",L=L+1
"RTN","DVBCXFRD",83,0)
 S ^TMP("DVBC","BULL",$J,L,0)="  "_FREAS,L=L+1
"RTN","DVBCXFRD",84,0)
 I $D(FREAS1) S ^TMP("DVBC","BULL",$J,L,0)="  "_FREAS1,L=L+1
"RTN","DVBCXFRD",85,0)
 I $D(FREAS2) S ^TMP("DVBC","BULL",$J,L,0)="  "_FREAS2,L=L+1
"RTN","DVBCXFRD",86,0)
 I $D(FREAS3) S ^TMP("DVBC","BULL",$J,L,0)="  "_FREAS3,L=L+1
"RTN","DVBCXFRD",87,0)
 S ^TMP("DVBC","BULL",$J,L,0)="  ",L=L+1
"RTN","DVBCXFRD",88,0)
 S ^TMP("DVBC","BULL",$J,L,0)="  ",L=L+1
"RTN","DVBCXFRD",89,0)
 S ^TMP("DVBC","BULL",$J,L,0)="Original sender: "_USER_" at "_SITE1,L=L+1
"RTN","DVBCXFRD",90,0)
 S ^TMP("DVBC","BULL",$J,L,0)="  ",L=L+1
"RTN","DVBCXFRD",91,0)
 D ^XMD
"RTN","DVBCXFRD",92,0)
 Q
"RTN","DVBCXFRE")
0^36^B25364359^B25183514
"RTN","DVBCXFRE",1,0)
DVBCXFRE ;ALB/GTS - 557/THM-SEND BACK TRANSFERS WHEN RELEASED ; 5/30/91  9:42 AM
"RTN","DVBCXFRE",2,0)
 ;;2.7;AMIE;**10,184,193**;Apr 10, 1995;Build 84
"RTN","DVBCXFRE",3,0)
 ;
"RTN","DVBCXFRE",4,0)
EN W !!,*7,"This request was transferred in.",!,"Please wait while I return it.",!! H 2
"RTN","DVBCXFRE",5,0)
 ;
"RTN","DVBCXFRE",6,0)
EN1 W @FF,!! S SITE=$P(^DVB(396.3,REQDA,0),U,22),DTTRNSC=$P(^(0),U,12),SITE1=$S($D(^DIC(4.2,+SITE,0)):$P(^(0),U,1),1:""),SITE=$S($P(^(0),U,3)]"":$P(^(0),U,3),1:SITE)
"RTN","DVBCXFRE",7,0)
 I SITE="" W !!,*7,"There is no home domain indicated.",!,"This request was not transferred in.",!! H 3 Q
"RTN","DVBCXFRE",8,0)
 S NREQDA=$S($D(^DVB(396.3,REQDA,1)):$P(^(1),U,8),1:"") I +NREQDA=0 W !!,*7,"The original request indicator is missing!",!,"I have no way to match it back at "_SITE1,!! H 3 Q
"RTN","DVBCXFRE",9,0)
 W !!,"Setting up return mail message ...",!! H 1
"RTN","DVBCXFRE",10,0)
 S L=3,^TMP("DVBCXFR",$J,1,0)="$TRANSFER OUT FROM V"_$$VERSION^XPDUTL("DVBA"),^TMP("DVBCXFR",$J,2,0)="$RQDA "_NREQDA_U_DTTRNSC_U_$P(^DVB(396.3,REQDA,0),U,18)_U_$P(^(0),"^",19) W ".."
"RTN","DVBCXFRE",11,0)
 I $D(ALLROPN) S ^TMP("DVBCXFR",$J,L,0)="$ROPN 1^",L=L+1 W "."
"RTN","DVBCXFRE",12,0)
 F JJ=0:0 S JJ=$O(^DVB(396.4,"C",REQDA,JJ)) Q:JJ=""  S DIE="^DVB(396.4,",DA=JJ,DR="64///N" D ^DIE K DA,DIE,DR D RSLT,RSLT1
"RTN","DVBCXFRE",13,0)
 S ^TMP("DVBCXFR",$J,L,0)="$USER "_$S($D(^VA(200,+DUZ,0)):$P(^(0),U,1),1:"POSTMASTER")_U_SITE_U_SITE1,L=L+1 W "."
"RTN","DVBCXFRE",14,0)
 S ^TMP("DVBCXFR",$J,L,0)="$END ",L=L+1 W "."
"RTN","DVBCXFRE",15,0)
 S ^TMP("DVBCXFR",$J,L,0)="  ",L=L+1 W "."
"RTN","DVBCXFRE",16,0)
 S ^TMP("DVBCXFR",$J,L,0)="  DFN: `"_DFN_$E("                    ",1,20-$L(DFN))_"SITE: "_DVBCSITE,L=L+1 W "."
"RTN","DVBCXFRE",17,0)
 S ^TMP("DVBCXFR",$J,L,0)="  REQUEST DATE: "_DVBCRDAT,L=L+1 W "."
"RTN","DVBCXFRE",18,0)
 ;
"RTN","DVBCXFRE",19,0)
 S ^TMP("DVBCXFR",$J,L,0)="  ",L=L+1 W "."
"RTN","DVBCXFRE",20,0)
 S ^TMP("DVBCXFR",$J,L,0)="** NOTE: To view the patient using the DFN, paste the DFN number into the    **",L=L+1 W "."
"RTN","DVBCXFRE",21,0)
 S ^TMP("DVBCXFR",$J,L,0)="** CAPRI Patient Selector 'Patient ID' field to find the patient. Be sure to **",L=L+1 W "."
"RTN","DVBCXFRE",22,0)
 S ^TMP("DVBCXFR",$J,L,0)="** include the ' (backward-apostrophe) character.                            **",L=L+1 W "."
"RTN","DVBCXFRE",23,0)
 S ^TMP("DVBCXFR",$J,L,0)=" ",L=L+1 W "."
"RTN","DVBCXFRE",24,0)
 S ^TMP("DVBCXFR",$J,L,0)="** This is an auto-generated email.  Do not respond to this email address.   **",L=L+1 W "."
"RTN","DVBCXFRE",25,0)
 ;
"RTN","DVBCXFRE",26,0)
 H 1 W !!,"Message is now ready to send back ...",!! H 2
"RTN","DVBCXFRE",27,0)
 ;
"RTN","DVBCXFRE",28,0)
SEND ;set status now for manual return if auto send fails; skip reopens
"RTN","DVBCXFRE",29,0)
 ;AJF;Request Status conversion
"RTN","DVBCXFRE",30,0)
 I '$D(ALLROPN) S DIC(0)="QM",(DIC,DIE)="^DVB(396.3,",DA=REQDA,DR="17////10" D ^DIE
"RTN","DVBCXFRE",31,0)
 K XMZ S XMY(DUZ)="",XMSUB="Return of Transferred C&P Exams",XMTEXT="^TMP(""DVBCXFR"",$J,",XMY("S.DVBA C PROCESS MAIL MESSAGE@"_SITE1)=SITE D ^XMD
"RTN","DVBCXFRE",32,0)
 I $D(XMZ) W !!,"Transmitted as message # "_XMZ_" from this site to "_SITE1,! H 3
"RTN","DVBCXFRE",33,0)
 I '$D(XMZ) W !!,*7,"Message transmission error!",!,"Request WILL NOT be transferred!",!!,"Press RETURN  " R ANS:DTIME S OUT=1 Q:'$D(MANUAL)  I $D(MANUAL) K MANUAL G KILL^DVBCUTIL
"RTN","DVBCXFRE",34,0)
 K DIC,DIE,DR,DA,LN,^TMP("DVBCXFR",$J),XMZ,ANS,L,JY,XMY,XMSUB,XMTEXT,XMDUZ
"RTN","DVBCXFRE",35,0)
 I $D(MANUAL) K MANUAL G KILL^DVBCUTIL
"RTN","DVBCXFRE",36,0)
 Q
"RTN","DVBCXFRE",37,0)
 ;
"RTN","DVBCXFRE",38,0)
RSLT1 F LN=0:0 S LN=$O(^DVB(396.4,JJ,"RES",LN)) Q:LN=""  S ^TMP("DVBCXFR",$J,L,0)="$RSLT "_^(LN,0),L=L+1 W "."
"RTN","DVBCXFRE",39,0)
 Q
"RTN","DVBCXFRE",40,0)
 ;
"RTN","DVBCXFRE",41,0)
MANUAL S MANUAL=1 D HOME^%ZIS S FF=IOF
"RTN","DVBCXFRE",42,0)
 ;
"RTN","DVBCXFRE",43,0)
MANUAL1 W @FF,!,"Manual Return of C&P Transfers",!!!!
"RTN","DVBCXFRE",44,0)
 K DIC S DIC="^DVB(396.3,",DIC(0)="AEQMZ",DIC("A")="Select VETERAN NAME: " D ^DIC G:X=""!(X=U) EXIT I +Y<0 W *7,"  ???" H 3 G MANUAL1
"RTN","DVBCXFRE",45,0)
 I '$P(^DVB(396.3,+Y,0),U,22) W *7,!!,"This request was not transferred in to this site and",!,"it is not possible to select it for return." K OUT D PAUSE G:$D(OUT) KILL^DVBCUTIL G MANUAL1
"RTN","DVBCXFRE",46,0)
 ;AJF;Request Status conversion
"RTN","DVBCXFRE",47,0)
 I $P(^DVB(396.3,+Y,0),U,18)'=10 W !!,*7,"This request is not in the proper status to manually return it.",!,"The status must be COMPLETED/TRANSFERRED OUT (CT)." K OUT D PAUSE G:$D(OUT) KILL^DVBCUTIL G MANUAL1
"RTN","DVBCXFRE",48,0)
 ;
"RTN","DVBCXFRE",49,0)
ASK S REQDA=+Y W !!!,"Is this the correct request" S %=2 D YN^DICN G:%<0!($D(DTOUT)) EXIT I %=2 G MANUAL1
"RTN","DVBCXFRE",50,0)
 I %=0 W !!,"Enter Y if this is the correct request or N to re-select.",!! H 3 G ASK
"RTN","DVBCXFRE",51,0)
 S DFN=$P(^DVB(396.3,REQDA,0),U,1),SSN=$P(^DPT(DFN,0),U,9)
"RTN","DVBCXFRE",52,0)
 G EN1
"RTN","DVBCXFRE",53,0)
 ;
"RTN","DVBCXFRE",54,0)
EXIT K MANUAL,DIC,X,Y,REQDA,%,%Y,DTTRNSC,J,TSTDT,POP,STAT,RONAME,RO,JY,EXAM,C Q
"RTN","DVBCXFRE",55,0)
 ;
"RTN","DVBCXFRE",56,0)
RSLT S X=^DVB(396.4,JJ,0),WRKSHT=$P(X,U,5),EXSTAT=$P(X,U,4)
"RTN","DVBCXFRE",57,0)
 S CANCNODE=$S($D(^DVB(396.4,JJ,"CAN")):^DVB(396.4,JJ,"CAN"),1:""),CANCREM=$P(CANCNODE,U,3)
"RTN","DVBCXFRE",58,0)
 S CANCBY=$P(CANCNODE,U,2) S:CANCBY]"" CANCBY=.5
"RTN","DVBCXFRE",59,0)
 S CANCDT=$P(CANCNODE,U,1)
"RTN","DVBCXFRE",60,0)
 S EXMDT=$P(X,U,6),EXPHYS=$P(X,U,7),FEXM=$P(X,U,8),EXMPL=$P(X,U,9)
"RTN","DVBCXFRE",61,0)
 S ^TMP("DVBCXFR",$J,L,0)="$EXAM "_$P(^DVB(396.4,JJ,0),U,3)_U_WRKSHT_U_EXSTAT_U_CANCREM_U_CANCBY_U_CANCDT_U_EXMDT_U_EXPHYS_U_FEXM_U_EXMPL,L=L+1
"RTN","DVBCXFRE",62,0)
 K CANCNODE
"RTN","DVBCXFRE",63,0)
 Q
"RTN","DVBCXFRE",64,0)
 ;
"RTN","DVBCXFRE",65,0)
PAUSE W !!,"Press RETURN to continue or ""^"" to exit  " R ANS:DTIME I ANS[U S OUT=1
"RTN","DVBCXFRE",66,0)
 Q
"RTN","DVBCXFRS")
0^22^B11515454^B10365515
"RTN","DVBCXFRS",1,0)
DVBCXFRS ;ALB/GTS-557/THM-STUFF C&P TRANSFER RESULTS ; 5/30/91  9:59 AM
"RTN","DVBCXFRS",2,0)
 ;;2.7;AMIE;**10,193**;Apr 10, 1995;Build 84
"RTN","DVBCXFRS",3,0)
 ;
"RTN","DVBCXFRS",4,0)
EN1 S (CNT,CNTA)=0 K OUT,FINISH
"RTN","DVBCXFRS",5,0)
 F DVBCI=0:0 X XMREC S:XMRG["$END" FINISH=1 Q:XMER<0!(XMRG["$END")  S XLN=XMRG,SUB=$E(XLN,2,5),XLN=$E(XLN,7,245) K OUT D @SUB Q:$D(OUT)
"RTN","DVBCXFRS",6,0)
 K DFN,REQDT,EXMNM
"RTN","DVBCXFRS",7,0)
 I '$D(FINISH) D BULL6^DVBCXFRD G EXIT ;sent to sender at orig site
"RTN","DVBCXFRS",8,0)
 ;check to see if complete, if so send bulletins
"RTN","DVBCXFRS",9,0)
 S NFINAL=0
"RTN","DVBCXFRS",10,0)
 F EXMDA=0:0 S EXMDA=$O(^DVB(396.4,"C",REQDA,EXMDA)) Q:EXMDA=""  S STAT=$P($G(^DVB(396.4,EXMDA,0)),U,4) I STAT'="C"&(STAT'["X") S NFINAL=1
"RTN","DVBCXFRS",11,0)
 S CURSTAT=$S(CURSTAT]""&(CURSTAT["X"):CURSTAT,1:"T")
"RTN","DVBCXFRS",12,0)
 I '$D(ALLROPN),NFINAL=0 S (DIC,DIE)="^DVB(396.3,",DA=REQDA,DR="17///"_CURSTAT_$S(RQCANCDT:";19////"_RQCANCDT,1:"") D ^DIE
"RTN","DVBCXFRS",13,0)
 I NFINAL=0 S DFN=$P(^DVB(396.3,REQDA,0),U,1),REQDT=$P(^(0),U,2),PNAM=$P(^DPT(DFN,0),U,1),SSN=$P(^(0),U,9)
"RTN","DVBCXFRS",14,0)
 I NFINAL=0 S XMB="DVBA C 2507 EXAM READY",XMB(1)=PNAM,XMB(2)=SSN,Y=REQDT X ^DD("DD") S XREQDT=Y,XMB(3)=XREQDT D ^XMB K XMB,XREQDT
"RTN","DVBCXFRS",15,0)
EXIT D DELSER^DVBCUTL4
"RTN","DVBCXFRS",16,0)
 K FINISH,ALLROPN,CURSTAT,RQCANCDT,CANCBY,CANCDT,CANCREM,EXMPL,EXSTAT,FEXM
"RTN","DVBCXFRS",17,0)
 K SITE,SITE1,SSN,STAT,SUB,PNAM,NFINAL,X,WRKSHT,USER,XLN,XMER,XMREC,XMRG,Y,ZH
"RTN","DVBCXFRS",18,0)
 K CNT,CNTA,DATRETN,DTTRNSC,EXPHYS,EXMDT,EXMDA,EXM,DVBCI
"RTN","DVBCXFRS",19,0)
 G KILL^DVBCUTIL
"RTN","DVBCXFRS",20,0)
 ;
"RTN","DVBCXFRS",21,0)
USER S USER=$P(XLN,U,1),SITE=$P(XLN,U,2),SITE1=$P(XLN,U,3)
"RTN","DVBCXFRS",22,0)
 Q
"RTN","DVBCXFRS",23,0)
 ;
"RTN","DVBCXFRS",24,0)
RQDA S REQDA=+XLN,DTTRNSC=$P(XLN,U,2),CURSTAT=$P(XLN,U,3),RQCANCDT=$P(XLN,U,4)
"RTN","DVBCXFRS",25,0)
 I '$D(^DVB(396.3,REQDA,0)) D BULL4^DVBCXFRD K DIC,DIE,DA,REQDA S OUT=1
"RTN","DVBCXFRS",26,0)
 S (DIC,DIE)="^DVB(396.3,",DR="11////"_DTTRNSC,DA=REQDA D ^DIE K DIC,DIE,DR
"RTN","DVBCXFRS",27,0)
 Q
"RTN","DVBCXFRS",28,0)
 ;
"RTN","DVBCXFRS",29,0)
EXAM N DFN,REQDT,EXMNM S DFN=$P(^DVB(396.3,REQDA,0),U,1),REQDT=$P(^(0),U,2)
"RTN","DVBCXFRS",30,0)
 S EXM=$P(XLN,U,1),WRKSHT=$P(XLN,U,2),EXSTAT=$P(XLN,U,3)
"RTN","DVBCXFRS",31,0)
 S EXMNM=$P(^DVB(396.6,EXM,0),U,1),CNT=0
"RTN","DVBCXFRS",32,0)
 S CANCREM=$P(XLN,U,4),CANCBY=$P(XLN,U,5),CANCDT=$P(XLN,U,6)
"RTN","DVBCXFRS",33,0)
 S EXMDT=$P(XLN,U,7),EXPHYS=$P(XLN,U,8),FEXM=$P(XLN,U,9)
"RTN","DVBCXFRS",34,0)
 S EXMPL=$P(XLN,U,10),DATRETN=$P(XLN,U,11)
"RTN","DVBCXFRS",35,0)
 S DA=$O(^DVB(396.4,"APE",DFN,EXMNM,REQDT,0))
"RTN","DVBCXFRS",36,0)
 I DA="" D BULL5^DVBCXFRD S OUT=1 Q
"RTN","DVBCXFRS",37,0)
 S (DIC,DIE)="^DVB(396.4,"
"RTN","DVBCXFRS",38,0)
 S DR=".05////"_WRKSHT_";.04////"_EXSTAT_";52////"_CANCREM_";51////"_CANCBY_";50////"_CANCDT_";.06////"_EXMDT_";.07////"_EXPHYS_";.08////"_FEXM_";.09////"_EXMPL_";63////"_DATRETN
"RTN","DVBCXFRS",39,0)
 D ^DIE
"RTN","DVBCXFRS",40,0)
 I $D(ALLROPN) K DR S DR="52///@;51///@;50///@" D ^DIE ;can't stuff nulls
"RTN","DVBCXFRS",41,0)
 S NCN=0 F ZH=0:0 S ZH=$O(^DVB(396.4,"C",REQDA,ZH)) Q:ZH=""  I $P(^DVB(396.4,ZH,0),U,4)="T" S NCN=1
"RTN","DVBCXFRS",42,0)
 I NCN=0 S (DIC,DIE)="^DVB(396.3,",DA=REQDA,DR="31///@;34////"_DT D ^DIE
"RTN","DVBCXFRS",43,0)
 K NCN,ZZ Q
"RTN","DVBCXFRS",44,0)
 ;
"RTN","DVBCXFRS",45,0)
ROPN S ALLROPN=1,(DIC,DIE)="^DVB(396.3,",DA=REQDA
"RTN","DVBCXFRS",46,0)
 S DR="11///@;31////y;34///@;17////2"  ;AJF; Status Conversion
"RTN","DVBCXFRS",47,0)
 D ^DIE ;transfers cancelled in error
"RTN","DVBCXFRS",48,0)
 Q
"RTN","DVBCXFRS",49,0)
 ;
"RTN","DVBCXFRS",50,0)
RSLT S DFN=$P(^DVB(396.3,REQDA,0),U,1)
"RTN","DVBCXFRS",51,0)
 S DA=$O(^DVB(396.4,"APS",DFN,EXM,"C",0))
"RTN","DVBCXFRS",52,0)
 I '$D(^DVB(396.4,DA,"RES",0)) S ^(0)="^^0^0^"_DT_"^^^^"
"RTN","DVBCXFRS",53,0)
 I DA="" D BULL5^DVBCXFRD S OUT=1 Q
"RTN","DVBCXFRS",54,0)
 S CNT=CNT+1,^DVB(396.4,DA,"RES",CNT,0)=XLN
"RTN","DVBCXFRS",55,0)
 F X=3,4 S $P(^DVB(396.4,DA,"RES",0),U,X)=CNT
"RTN","DVBCXFRS",56,0)
 Q
"SEC","^DIC",396.195,396.195,0,"AUDIT")
@
"SEC","^DIC",396.195,396.195,0,"DD")
@
"SEC","^DIC",396.195,396.195,0,"DEL")
@
"SEC","^DIC",396.195,396.195,0,"LAYGO")
@
"SEC","^DIC",396.195,396.195,0,"RD")
@
"SEC","^DIC",396.195,396.195,0,"WR")
@
"SEC","^DIC",396.33,396.33,0,"AUDIT")

"SEC","^DIC",396.33,396.33,0,"DD")

"SEC","^DIC",396.33,396.33,0,"DEL")

"SEC","^DIC",396.33,396.33,0,"LAYGO")

"SEC","^DIC",396.33,396.33,0,"RD")

"SEC","^DIC",396.33,396.33,0,"WR")

"SEC","^DIC",396.55,396.55,0,"AUDIT")
@
"SEC","^DIC",396.55,396.55,0,"DD")
@
"SEC","^DIC",396.55,396.55,0,"DEL")
@
"SEC","^DIC",396.55,396.55,0,"LAYGO")
@
"SEC","^DIC",396.55,396.55,0,"RD")
@
"SEC","^DIC",396.55,396.55,0,"WR")
@
"UP",396.3,396.34,-1)
396.3^6
"UP",396.3,396.34,0)
396.34
"UP",396.3,396.341,-2)
396.3^6
"UP",396.3,396.341,-1)
396.34^1
"UP",396.3,396.341,0)
396.341
"VER")
8.0^22.2
"^DD",396.195,396.195,0)
FIELD^^.03^3
"^DD",396.195,396.195,0,"DT")
3170615
"^DD",396.195,396.195,0,"IX","B",396.195,.01)

"^DD",396.195,396.195,0,"IX","C",396.195,.05)
 
"^DD",396.195,396.195,0,"NM","CAPRI REROUTE SITE")
 
"^DD",396.195,396.195,0,"VRPK")
DVBA
"^DD",396.195,396.195,.01,0)
NAME^RFJ70^^0;1^K:$L(X)>70!($L(X)<3)!'(X'?1P.E) X
"^DD",396.195,396.195,.01,1,0)
^.1
"^DD",396.195,396.195,.01,1,1,0)
396.195^B
"^DD",396.195,396.195,.01,1,1,1)
S ^DVB(396.195,"B",$E(X,1,30),DA)=""
"^DD",396.195,396.195,.01,1,1,2)
K ^DVB(396.195,"B",$E(X,1,30),DA)
"^DD",396.195,396.195,.01,3)
Enter the site name for rerouting. Answer must be 3 to 70 characters.
"^DD",396.195,396.195,.01,21,0)
^^1^1^3170307^
"^DD",396.195,396.195,.01,21,1,0)
This field contains the name of the site for rerouting.
"^DD",396.195,396.195,.01,"DT")
3170307
"^DD",396.195,396.195,.02,0)
State^FJ20^^0;2^K:$L(X)>20!($L(X)<3) X
"^DD",396.195,396.195,.02,3)
Answer must be 3-20 characters in length.
"^DD",396.195,396.195,.02,21,0)
^^1^1^3170307^
"^DD",396.195,396.195,.02,21,1,0)
This field contains the state where reroute site is located.
"^DD",396.195,396.195,.02,"DT")
3170307
"^DD",396.195,396.195,.03,0)
DOMAIN^FJ50^^0;3^K:$L(X)>50!($L(X)<3) X
"^DD",396.195,396.195,.03,3)
Answer must be 3-50 characters in length.
"^DD",396.195,396.195,.03,21,0)
^^1^1^3170307^
"^DD",396.195,396.195,.03,21,1,0)
This field contains the domain for the reroute site.
"^DD",396.195,396.195,.03,"DT")
3170330
"^DD",396.3,396.3,17,0)
REQUEST STATUS^RP396.33'^DVB(396.33,^0;18^Q
"^DD",396.3,396.3,17,1,0)
^.1
"^DD",396.3,396.3,17,1,1,0)
396.3^AF^MUMPS
"^DD",396.3,396.3,17,1,1,1)
S DVBCRO=$P(^DVB(396.3,DA,0),U,3) S:DVBCRO]"" ^DVB(396.3,"AF",$E(X,1,30),DVBCRO,DA)="" K DVBCRO
"^DD",396.3,396.3,17,1,1,2)
S DVBCRO=$P(^DVB(396.3,DA,0),U,3) K:DVBCRO]"" ^DVB(396.3,"AF",$E(X,1,30),DVBCRO,DA) K DVBCRO
"^DD",396.3,396.3,17,1,1,"%D",0)
^^2^2^2940906^
"^DD",396.3,396.3,17,1,1,"%D",1,0)
This cross reference is to collect all entries with the same Regional
"^DD",396.3,396.3,17,1,1,"%D",2,0)
Office number and request status.
"^DD",396.3,396.3,17,1,1,"DT")
2940906
"^DD",396.3,396.3,17,1,2,0)
^^TRIGGER^396.3^7
"^DD",396.3,396.3,17,1,2,1)
K DIV S DIV=X,D0=DA,DIV(0)=D0 S Y(1)=$S($D(^DVB(396.3,D0,7)):^(7),1:"") S X=$P(Y(1),U,1),X=X S DIU=X K Y S X=DIV N %I,%H,% D NOW^%DTC S DIH=$G(^DVB(396.3,DIV(0),7)),DIV=X S $P(^(7),U,1)=DIV,DIH=396.3,DIG=7 D ^DICR
"^DD",396.3,396.3,17,1,2,2)
K DIV S DIV=X,D0=DA,DIV(0)=D0 S Y(1)=$S($D(^DVB(396.3,D0,7)):^(7),1:"") S X=$P(Y(1),U,1),X=X S DIU=X K Y S X=DIV N %I,%H,% D NOW^%DTC S DIH=$G(^DVB(396.3,DIV(0),7)),DIV=X S $P(^(7),U,1)=DIV,DIH=396.3,DIG=7 D ^DICR
"^DD",396.3,396.3,17,1,2,"%D",0)
^^3^3^3120117^
"^DD",396.3,396.3,17,1,2,"%D",1,0)
This trigger populates the DATE STATUS LAST CHANGED (#7) field with the 
"^DD",396.3,396.3,17,1,2,"%D",2,0)
value of TODAY whenever the REQUEST STATUS (#17) field is entered or 
"^DD",396.3,396.3,17,1,2,"%D",3,0)
changed.
"^DD",396.3,396.3,17,1,2,"CREATE VALUE")
TODAY
"^DD",396.3,396.3,17,1,2,"DELETE VALUE")
TODAY
"^DD",396.3,396.3,17,1,2,"DT")
3120117
"^DD",396.3,396.3,17,1,2,"FIELD")
DATE STATUS LAST
"^DD",396.3,396.3,17,3)
Enter the status of the entire request.
"^DD",396.3,396.3,17,21,0)
^.001^1^1^3160407^^^^
"^DD",396.3,396.3,17,21,1,0)
This field contains the request status of the 2507 exam request.
"^DD",396.3,396.3,17,"DT")
3120117
"^DD",396.3,396.3,35,0)
REROUTE DATE/TIME^396.34PA^^6;0
"^DD",396.3,396.3,35,21,0)
^.001^2^2^3170823^^^
"^DD",396.3,396.3,35,21,1,0)
This sub file contains information about the
"^DD",396.3,396.3,35,21,2,0)
sites where the original request was placed.
"^DD",396.3,396.3,35,"DT")
3160802
"^DD",396.3,396.34,0)
REROUTE DATE/TIME SUB-FIELD^^12^14
"^DD",396.3,396.34,0,"NM","REROUTE DATE/TIME")

"^DD",396.3,396.34,.01,0)
REROUTE DATE/TIME^RD^^0;1^S %DT="ETR" D ^%DT S X=Y K:Y<1 X
"^DD",396.3,396.34,.01,1,0)
^.1
"^DD",396.3,396.34,.01,1,1,0)
396.34^B
"^DD",396.3,396.34,.01,1,1,1)
S ^DVB(396.3,DA(1),6,"B",$E(X,1,30),DA)=""
"^DD",396.3,396.34,.01,1,1,2)
K ^DVB(396.3,DA(1),6,"B",$E(X,1,30),DA)
"^DD",396.3,396.34,.01,1,2,0)
396.3^AR
"^DD",396.3,396.34,.01,1,2,1)
S ^DVB(396.3,"AR",$E(X,1,30),DA(1),DA)=""
"^DD",396.3,396.34,.01,1,2,2)
K ^DVB(396.3,"AR",$E(X,1,30),DA(1),DA)
"^DD",396.3,396.34,.01,1,2,"DT")
3170623
"^DD",396.3,396.34,.01,3)
Enter the date/time of this reroute request
"^DD",396.3,396.34,.01,21,0)
^.001^1^1^3160411^^^^
"^DD",396.3,396.34,.01,21,1,0)
This field contains the date/time of reroute request
"^DD",396.3,396.34,.01,"DT")
3170623
"^DD",396.3,396.34,.02,0)
REROUTE TO SITE^RFJ25^^0;7^K:$L(X)>25!($L(X)<2) X
"^DD",396.3,396.34,.02,3)
Answer must be 2-25 characters in length.
"^DD",396.3,396.34,.02,21,0)
^.001^1^1^3170728^^^^
"^DD",396.3,396.34,.02,21,1,0)
This field contains the site where the original was reroute to
"^DD",396.3,396.34,.02,"DT")
3170728
"^DD",396.3,396.34,1,0)
REROUTE REQUEST IEN^RNJ7,0^^0;2^K:+X'=X!(X>9999999)!(X<0)!(X?.E1"."1N.N) X
"^DD",396.3,396.34,1,3)
Enter request IEN from rerouting site, must be a number between 0 and 9999999.
"^DD",396.3,396.34,1,21,0)
^^1^1^3160407^^^
"^DD",396.3,396.34,1,21,1,0)
This field contains the IEN from the rerouting site for file 396.3
"^DD",396.3,396.34,1,"DT")
3161129
"^DD",396.3,396.34,2,0)
REROUTE PATIENT IEN^RNJ9,0^^0;3^K:+X'=X!(X>999999999)!(X<0)!(X?.E1"."1.N) X
"^DD",396.3,396.34,2,3)
Type a number between 0 and 999999999, 0 decimal digits.
"^DD",396.3,396.34,2,21,0)
^.001^1^1^3160407^^^^
"^DD",396.3,396.34,2,21,1,0)
This field contains the IEN from the rerouting site for file 2
"^DD",396.3,396.34,2,"DT")
3160412
"^DD",396.3,396.34,3,0)
REROUTE FROM SITE^RFJ25^^0;4^K:$L(X)>25!($L(X)<3) X
"^DD",396.3,396.34,3,3)
Answer must be 3-25 characters in length.
"^DD",396.3,396.34,3,21,0)
^.001^1^1^3170728^^^^
"^DD",396.3,396.34,3,21,1,0)
This field contains the site where the original request was placed
"^DD",396.3,396.34,3,"DT")
3170728
"^DD",396.3,396.34,4,0)
REROUTE REASON^RP396.55'^DVB(396.55,^0;5^Q
"^DD",396.3,396.34,4,3)
Enter the reason for rerouting this request
"^DD",396.3,396.34,4,21,0)
^.001^1^1^3160727^^^^
"^DD",396.3,396.34,4,21,1,0)
This field contains the reason code for this reroute request
"^DD",396.3,396.34,4,"DT")
3160803
"^DD",396.3,396.34,5,0)
REROUTE DESCRIPTION^FJ250^^1;1^K:$L(X)>250!($L(X)<3) X
"^DD",396.3,396.34,5,3)
Answer must be 3-250 characters in length.
"^DD",396.3,396.34,5,"DT")
3170823
"^DD",396.3,396.34,6,0)
REROUTE STATUS DATE/TIME^396.341DA^^1;0
"^DD",396.3,396.34,6,21,0)
^^1^1^3161129^
"^DD",396.3,396.34,6,21,1,0)
This is a multiple to track each reroute status.
"^DD",396.3,396.34,6,"DT")
3161116
"^DD",396.3,396.34,7,0)
REROUTE USER^RP200'^VA(200,^0;8^Q
"^DD",396.3,396.34,7,3)
Enter the user rerouting the request.
"^DD",396.3,396.34,7,21,0)
^^1^1^3161129^
"^DD",396.3,396.34,7,21,1,0)
This field contains the person who rerouted the request
"^DD",396.3,396.34,7,"DT")
3161129
"^DD",396.3,396.34,8,0)
OLD DIVISION^P40.8^DG(40.8,^0;9^Q
"^DD",396.3,396.34,8,3)
Enter the old medical center division
"^DD",396.3,396.34,8,21,0)
^^1^1^3161129^
"^DD",396.3,396.34,8,21,1,0)
This field contains the old medical center division
"^DD",396.3,396.34,8,"DT")
3161129
"^DD",396.3,396.34,9,0)
REROUTE TO IEN^NJ9,0^^2;1^K:+X'=X!(X>999999999)!(X<1)!(X?.E1"."1.N) X
"^DD",396.3,396.34,9,3)
Type a number between 1 and 999999999, 0 decimal digits.
"^DD",396.3,396.34,9,"DT")
3170728
"^DD",396.3,396.34,10,0)
REROUTE TO DOMAIN^NJ9,0^^2;2^K:+X'=X!(X>999999999)!(X<1)!(X?.E1"."1.N) X
"^DD",396.3,396.34,10,3)
Type a number between 1 and 999999999, 0 decimal digits.
"^DD",396.3,396.34,10,"DT")
3170728
"^DD",396.3,396.34,11,0)
REROUTE FROM IEN^NJ9,0^^2;3^K:+X'=X!(X>999999999)!(X<1)!(X?.E1"."1.N) X
"^DD",396.3,396.34,11,3)
Type a number between 1 and 999999999, 0 decimal digits.
"^DD",396.3,396.34,11,"DT")
3170728
"^DD",396.3,396.34,12,0)
REROUTE FROM DOMAIN^NJ9,0^^2;4^K:+X'=X!(X>999999999)!(X<1)!(X?.E1"."1.N) X
"^DD",396.3,396.34,12,3)
Type a number between 1 and 999999999, 0 decimal digits.
"^DD",396.3,396.34,12,"DT")
3170728
"^DD",396.3,396.341,0)
REROUTE STATUS DATE/TIME SUB-FIELD^^2^3
"^DD",396.3,396.341,0,"NM","REROUTE STATUS DATE/TIME")

"^DD",396.3,396.341,.01,0)
REROUTE STATUS DATE/TIME^RD^^0;1^S %DT="ETR" D ^%DT S X=Y K:X<1 X
"^DD",396.3,396.341,.01,1,0)
^.1
"^DD",396.3,396.341,.01,1,1,0)
396.341^B
"^DD",396.3,396.341,.01,1,1,1)
S ^DVB(396.3,DA(1),6,DA(2),1,"B",$E(X,1,30),DA)=""
"^DD",396.3,396.341,.01,1,1,2)
K ^DVB(396.3,DA(1),6,DA(2),1,"B",$E(X,1,30),DA)
"^DD",396.3,396.341,.01,3)
Enter the date/time of this reroute status
"^DD",396.3,396.341,.01,21,0)
^^1^1^3161129^^
"^DD",396.3,396.341,.01,21,1,0)
This is the data/time the reroute status is stored in the system.
"^DD",396.3,396.341,.01,"DT")
3161129
"^DD",396.3,396.341,1,0)
REROUTE STATUS CODE^RS^N:NEW;A:ACCEPTED;R:REJECTED;^0;2^Q
"^DD",396.3,396.341,1,3)
Enter status of this reroute request
"^DD",396.3,396.341,1,21,0)
^^1^1^3160407^^^^
"^DD",396.3,396.341,1,21,1,0)
This field contains the status for this request
"^DD",396.3,396.341,1,"DT")
3160407
"^DD",396.3,396.341,2,0)
REROUTE REJECTION REASON^F^^1;1^K:$L(X)>250!($L(X)<5) X
"^DD",396.3,396.341,2,3)
Answer must be 5-250 characters in length.
"^DD",396.3,396.341,2,21,0)
^^1^1^3160407^^^^
"^DD",396.3,396.341,2,21,1,0)
This field contains the rejection reason
"^DD",396.3,396.341,2,"DT")
3160412
"^DD",396.33,396.33,0)
FIELD^^.02^2
"^DD",396.33,396.33,0,"DDA")
N
"^DD",396.33,396.33,0,"DT")
3170308
"^DD",396.33,396.33,0,"ID",.02)
W ""
"^DD",396.33,396.33,0,"IX","B",396.33,.01)

"^DD",396.33,396.33,0,"IX","C",396.33,.02)

"^DD",396.33,396.33,0,"NM","2507 STATUS")
 
"^DD",396.33,396.33,0,"PT",396.3,17)
 
"^DD",396.33,396.33,0,"VRPK")
DVBA
"^DD",396.33,396.33,.01,0)
NAME^RF^^0;1^K:$L(X)>30!(X?.N)!($L(X)<3)!'(X'?1P.E) X
"^DD",396.33,396.33,.01,1,0)
^.1
"^DD",396.33,396.33,.01,1,1,0)
396.33^B
"^DD",396.33,396.33,.01,1,1,1)
S ^DVB(396.33,"B",$E(X,1,30),DA)=""
"^DD",396.33,396.33,.01,1,1,2)
K ^DVB(396.33,"B",$E(X,1,30),DA)
"^DD",396.33,396.33,.01,3)
Enter a name 3-30 charaters, not numeric or starting with punctuation
"^DD",396.33,396.33,.01,21,0)
^^1^1^3160406^^^
"^DD",396.33,396.33,.01,21,1,0)
This field contains the status of the request
"^DD",396.33,396.33,.01,"DT")
3160329
"^DD",396.33,396.33,.02,0)
CODE^RF^^0;2^K:$L(X)>3!($L(X)<1) X
"^DD",396.33,396.33,.02,1,0)
^.1
"^DD",396.33,396.33,.02,1,1,0)
396.33^C
"^DD",396.33,396.33,.02,1,1,1)
S ^DVB(396.33,"C",$E(X,1,30),DA)=""
"^DD",396.33,396.33,.02,1,1,2)
K ^DVB(396.33,"C",$E(X,1,30),DA)
"^DD",396.33,396.33,.02,1,1,"DT")
3160329
"^DD",396.33,396.33,.02,3)
Answer must be 1-3 characters in length.
"^DD",396.33,396.33,.02,21,0)
^^1^1^3160406^^^
"^DD",396.33,396.33,.02,21,1,0)
This field contains the code for the status
"^DD",396.33,396.33,.02,"DT")
3170308
"^DD",396.55,396.55,0)
FIELD^^.02^2
"^DD",396.55,396.55,0,"DDA")
N
"^DD",396.55,396.55,0,"DT")
3160727
"^DD",396.55,396.55,0,"IX","B",396.55,.01)

"^DD",396.55,396.55,0,"NM","2507 REROUTE CODE")
 
"^DD",396.55,396.55,0,"PT",396.34,4)

"^DD",396.55,396.55,0,"VRPK")
DVBA
"^DD",396.55,396.55,.01,0)
REROUTE CODE^RF^^0;1^K:$L(X)>30!($L(X)<3)!'(X'?1P.E) X
"^DD",396.55,396.55,.01,1,0)
^.1
"^DD",396.55,396.55,.01,1,1,0)
396.55^B
"^DD",396.55,396.55,.01,1,1,1)
S ^DVB(396.55,"B",$E(X,1,30),DA)=""
"^DD",396.55,396.55,.01,1,1,2)
K ^DVB(396.55,"B",$E(X,1,30),DA)
"^DD",396.55,396.55,.01,3)
Answer must be 3-30 characters in length.
"^DD",396.55,396.55,.01,21,0)
^^1^1^3160727^
"^DD",396.55,396.55,.01,21,1,0)
Reason for rerouting the 2507 Request to another VCMA site.
"^DD",396.55,396.55,.01,"DT")
3160727
"^DD",396.55,396.55,.02,0)
STATUS^RS^A:Active;I:Inactive;^0;2^Q
"^DD",396.55,396.55,.02,3)
Select 'A' if the status is active or 'I' if the status is inactive
"^DD",396.55,396.55,.02,21,0)
^^1^1^3160801^^
"^DD",396.55,396.55,.02,21,1,0)
This field will determine if the Reroute Reason is active or inactive.
"^DD",396.55,396.55,.02,"DT")
3160801
"^DIC",396.195,396.195,0)
CAPRI REROUTE SITE^396.195
"^DIC",396.195,396.195,0,"GL")
^DVB(396.195,
"^DIC",396.195,396.195,"%",0)
^1.005^1^1
"^DIC",396.195,396.195,"%",1,0)
DVBA
"^DIC",396.195,396.195,"%","B","DVBA",1)

"^DIC",396.195,396.195,"%D",0)
^^1^1^3170307^^
"^DIC",396.195,396.195,"%D",1,0)
This global will contain the selectable reroute site for CAPRI.
"^DIC",396.195,"B","CAPRI REROUTE SITE",396.195)

"^DIC",396.33,396.33,0)
2507 STATUS^396.33
"^DIC",396.33,396.33,0,"GL")
^DVB(396.33,
"^DIC",396.33,396.33,"%",0)
^1.005^^0
"^DIC",396.33,396.33,"%D",0)
^^1^1^3160407^
"^DIC",396.33,396.33,"%D",1,0)
This file contains the status for the 2507 Request.
"^DIC",396.33,"B","2507 STATUS",396.33)

"^DIC",396.55,396.55,0)
2507 REROUTE CODE^396.55
"^DIC",396.55,396.55,0,"GL")
^DVB(396.55,
"^DIC",396.55,396.55,"%",0)
^1.005^1^1
"^DIC",396.55,396.55,"%",1,0)
DVBA
"^DIC",396.55,396.55,"%","B","DVBA",1)

"^DIC",396.55,396.55,"%D",0)
^^1^1^3160801^
"^DIC",396.55,396.55,"%D",1,0)
Codes for rerouting the 2507 Request
"^DIC",396.55,"B","2507 REROUTE CODE",396.55)

"BLD",9470,6)
^175
**END**
**END**

