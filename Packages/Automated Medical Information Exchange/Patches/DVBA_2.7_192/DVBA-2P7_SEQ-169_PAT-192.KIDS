Released DVBA*2.7*192 SEQ #169
Extracted from mail message
**KIDS**:DVBA*2.7*192^

**INSTALL NAME**
DVBA*2.7*192
"BLD",9255,0)
DVBA*2.7*192^AUTOMATED MED INFO EXCHANGE^0^3150813^y
"BLD",9255,1,0)
^^1^1^3150630^
"BLD",9255,1,1,0)
Please see FORUM for a complete patch description
"BLD",9255,4,0)
^9.64PA^396.4^1
"BLD",9255,4,396.4,0)
396.4
"BLD",9255,4,396.4,2,0)
^9.641^396.4^1
"BLD",9255,4,396.4,2,396.4,0)
2507 EXAM  (File-top level)
"BLD",9255,4,396.4,2,396.4,1,0)
^9.6411^103^1
"BLD",9255,4,396.4,2,396.4,1,103,0)
REMARKS SENT TO CONTRACTOR
"BLD",9255,4,396.4,222)
y^y^p^^^^n^^n
"BLD",9255,4,396.4,224)

"BLD",9255,4,"APDD",396.4,396.4)

"BLD",9255,4,"APDD",396.4,396.4,103)

"BLD",9255,4,"B",396.4,396.4)

"BLD",9255,6.3)
15
"BLD",9255,"INID")
^y
"BLD",9255,"INIT")
DVBA192P
"BLD",9255,"KRN",0)
^9.67PA^779.2^20
"BLD",9255,"KRN",.4,0)
.4
"BLD",9255,"KRN",.401,0)
.401
"BLD",9255,"KRN",.402,0)
.402
"BLD",9255,"KRN",.403,0)
.403
"BLD",9255,"KRN",.5,0)
.5
"BLD",9255,"KRN",.84,0)
.84
"BLD",9255,"KRN",3.6,0)
3.6
"BLD",9255,"KRN",3.8,0)
3.8
"BLD",9255,"KRN",9.2,0)
9.2
"BLD",9255,"KRN",9.8,0)
9.8
"BLD",9255,"KRN",9.8,"NM",0)
^9.68A^14^11
"BLD",9255,"KRN",9.8,"NM",1,0)
DVBACREM^^0^B2557988
"BLD",9255,"KRN",9.8,"NM",2,0)
DVBAB6^^0^B67138708
"BLD",9255,"KRN",9.8,"NM",3,0)
DVBAB82^^0^B137858381
"BLD",9255,"KRN",9.8,"NM",4,0)
DVBABEBD^^0^B13866320
"BLD",9255,"KRN",9.8,"NM",5,0)
DVBARSBD^^0^B142334503
"BLD",9255,"KRN",9.8,"NM",6,0)
DVBABURL^^0^B7872092
"BLD",9255,"KRN",9.8,"NM",7,0)
DVBCRPRT^^0^B19769692
"BLD",9255,"KRN",9.8,"NM",8,0)
DVBCAMIS^^0^B18105359
"BLD",9255,"KRN",9.8,"NM",9,0)
DVBCAMRO^^0^B13590807
"BLD",9255,"KRN",9.8,"NM",11,0)
DVBCIUTL^^0^B91825542
"BLD",9255,"KRN",9.8,"NM",14,0)
DVBCIRP2^^0^B81228394
"BLD",9255,"KRN",9.8,"NM","B","DVBAB6",2)

"BLD",9255,"KRN",9.8,"NM","B","DVBAB82",3)

"BLD",9255,"KRN",9.8,"NM","B","DVBABEBD",4)

"BLD",9255,"KRN",9.8,"NM","B","DVBABURL",6)

"BLD",9255,"KRN",9.8,"NM","B","DVBACREM",1)

"BLD",9255,"KRN",9.8,"NM","B","DVBARSBD",5)

"BLD",9255,"KRN",9.8,"NM","B","DVBCAMIS",8)

"BLD",9255,"KRN",9.8,"NM","B","DVBCAMRO",9)

"BLD",9255,"KRN",9.8,"NM","B","DVBCIRP2",14)

"BLD",9255,"KRN",9.8,"NM","B","DVBCIUTL",11)

"BLD",9255,"KRN",9.8,"NM","B","DVBCRPRT",7)

"BLD",9255,"KRN",19,0)
19
"BLD",9255,"KRN",19,"NM",0)
^9.68A^^0
"BLD",9255,"KRN",19.1,0)
19.1
"BLD",9255,"KRN",19.1,"NM",0)
^9.68A^^0
"BLD",9255,"KRN",101,0)
101
"BLD",9255,"KRN",409.61,0)
409.61
"BLD",9255,"KRN",771,0)
771
"BLD",9255,"KRN",779.2,0)
779.2
"BLD",9255,"KRN",870,0)
870
"BLD",9255,"KRN",8989.51,0)
8989.51
"BLD",9255,"KRN",8989.51,"NM",0)
^9.68A^1^1
"BLD",9255,"KRN",8989.51,"NM",1,0)
DVBAB CAPRI VICAP URL^^0
"BLD",9255,"KRN",8989.51,"NM","B","DVBAB CAPRI VICAP URL",1)

"BLD",9255,"KRN",8989.52,0)
8989.52
"BLD",9255,"KRN",8989.52,"NM",0)
^9.68A^^
"BLD",9255,"KRN",8994,0)
8994
"BLD",9255,"KRN",8994,"NM",0)
^9.68A^2^2
"BLD",9255,"KRN",8994,"NM",1,0)
DVBA CAPRI GETCONTREMARKS^^0
"BLD",9255,"KRN",8994,"NM",2,0)
DVBA CAPRI SETCONTREMARKS^^0
"BLD",9255,"KRN",8994,"NM","B","DVBA CAPRI GETCONTREMARKS",1)

"BLD",9255,"KRN",8994,"NM","B","DVBA CAPRI SETCONTREMARKS",2)

"BLD",9255,"KRN","B",.4,.4)

"BLD",9255,"KRN","B",.401,.401)

"BLD",9255,"KRN","B",.402,.402)

"BLD",9255,"KRN","B",.403,.403)

"BLD",9255,"KRN","B",.5,.5)

"BLD",9255,"KRN","B",.84,.84)

"BLD",9255,"KRN","B",3.6,3.6)

"BLD",9255,"KRN","B",3.8,3.8)

"BLD",9255,"KRN","B",9.2,9.2)

"BLD",9255,"KRN","B",9.8,9.8)

"BLD",9255,"KRN","B",19,19)

"BLD",9255,"KRN","B",19.1,19.1)

"BLD",9255,"KRN","B",101,101)

"BLD",9255,"KRN","B",409.61,409.61)

"BLD",9255,"KRN","B",771,771)

"BLD",9255,"KRN","B",779.2,779.2)

"BLD",9255,"KRN","B",870,870)

"BLD",9255,"KRN","B",8989.51,8989.51)

"BLD",9255,"KRN","B",8989.52,8989.52)

"BLD",9255,"KRN","B",8994,8994)

"BLD",9255,"QDEF")
^^^^NO^^^^NO^^NO
"BLD",9255,"QUES",0)
^9.62^^
"BLD",9255,"REQB",0)
^9.611^4^2
"BLD",9255,"REQB",3,0)
DVBA*2.7*190^1
"BLD",9255,"REQB",4,0)
DVBA*2.7*186^1
"BLD",9255,"REQB","B","DVBA*2.7*186",4)

"BLD",9255,"REQB","B","DVBA*2.7*190",3)

"FIA",396.4)
2507 EXAM
"FIA",396.4,0)
^DVB(396.4,
"FIA",396.4,0,0)
396.4I
"FIA",396.4,0,1)
y^y^p^^^^n^^n
"FIA",396.4,0,10)

"FIA",396.4,0,11)

"FIA",396.4,0,"RLRO")

"FIA",396.4,0,"VR")
2.7^DVBA
"FIA",396.4,396.4)
1
"FIA",396.4,396.4,103)

"FIA",396.4,396.4103)
0
"INIT")
DVBA192P
"KRN",8989.5,3418,0)
223;DIC(9.4,^DVBAB CAPRI VICAP URL^1
"KRN",8989.5,3418,1)
http://vaww.demo.domain.ext/dmareports.asp
"KRN",8989.51,790,-1)
0^1
"KRN",8989.51,790,0)
DVBAB CAPRI VICAP URL^VA Informatics for C&P URL^0
"KRN",8989.51,790,1)
F
"KRN",8989.51,790,20,0)
^^10^10^3150728^
"KRN",8989.51,790,20,1,0)
This parameter contains the URL used to connect to the VA Informatics for 
"KRN",8989.51,790,20,2,0)
Compensation and Pension (VICAP) system.  VICAP is a replacement for the 
"KRN",8989.51,790,20,3,0)
AMIS 290 reporting in the AMIE package.
"KRN",8989.51,790,20,4,0)
 
"KRN",8989.51,790,20,5,0)
Placing any value in this parameter has the effect of disabling the AMIS
"KRN",8989.51,790,20,6,0)
290 for the Regional Office [DVBA C RO AMIS 290] and AMIS 290 Report for
"KRN",8989.51,790,20,7,0)
C&P [DVBA C AMIS REPORT] options in VistA, the corresponding AMIS 290 and
"KRN",8989.51,790,20,8,0)
AMIS 290 by Division reports on the CAPRI Reports dialog box, and the AMIS
"KRN",8989.51,790,20,9,0)
290 report on the Consolidated Remote Reports dialog box in the CAPRI GUI
"KRN",8989.51,790,20,10,0)
application.
"KRN",8989.51,790,30,0)
^8989.513I^1^1
"KRN",8989.51,790,30,1,0)
1^9.4
"KRN",8994,3257,-1)
0^1
"KRN",8994,3257,0)
DVBA CAPRI GETCONTREMARKS^WPGET^DVBACREM^2^R^0^^1^192
"KRN",8994,3257,1,0)
3^8994.01^3^3^3150804^^^^
"KRN",8994,3257,1,1,0)
This gets the remarks sent to the contractor concerning the 2507 REQUEST 
"KRN",8994,3257,1,2,0)
in file 396.3. The remarks are stored in the word processing field #103 of
"KRN",8994,3257,1,3,0)
the 2507 EXAM file 396.4.
"KRN",8994,3257,2,0)
^8994.02A^2^1
"KRN",8994,3257,2,2,0)
DVBEIEN^1^^1^1
"KRN",8994,3257,2,2,1,0)
^8994.021^1^1^3150629^^
"KRN",8994,3257,2,2,1,1,0)
This is the Exam Ien to get the comments from
"KRN",8994,3257,2,"B","DVBEIEN",2)

"KRN",8994,3257,2,"PARAMSEQ",1,2)

"KRN",8994,3257,3,0)
^8994.03^1^1^3150804^^^^
"KRN",8994,3257,3,1,0)
Returns a 1 if remarks exist
"KRN",8994,3258,-1)
0^2
"KRN",8994,3258,0)
DVBA CAPRI SETCONTREMARKS^WPSET^DVBACREM^3^R^0^^1^192
"KRN",8994,3258,1,0)
^8994.01^3^3^3150804^^^^
"KRN",8994,3258,1,1,0)
The RPC sets remarks sent to the contractor into the new word processing
"KRN",8994,3258,1,2,0)
field #103 of the 2507 EXAM file 396.4. The 2507 EXAMs are connected to
"KRN",8994,3258,1,3,0)
the 2507 REQUEST file via a pointer.
"KRN",8994,3258,2,0)
^8994.02A^4^4
"KRN",8994,3258,2,1,0)
RQID^1^255^1^3
"KRN",8994,3258,2,1,1,0)
^8994.021^4^4^3150604^^^
"KRN",8994,3258,2,1,1,1,0)
The is the 2507 REQUEST ID from the 2507 REQUEST file 396.3. The
"KRN",8994,3258,2,1,1,2,0)
2507 EXAMs are connected to the 2507 REQUEST file via a pointer. The
"KRN",8994,3258,2,1,1,3,0)
remarks sent to the contractor are stored in the new word processing field
"KRN",8994,3258,2,1,1,4,0)
#103 of the 2507 EXAM file 396.4. 
"KRN",8994,3258,2,2,0)
TEXT^3^32000^1^4
"KRN",8994,3258,2,2,1,0)
^^2^2^3150602^
"KRN",8994,3258,2,2,1,1,0)
The is the text from the contractor remarks. They will be stored in the
"KRN",8994,3258,2,2,1,2,0)
new word processing field #103 of the 2507 EXAM file 396.4
"KRN",8994,3258,2,3,0)
RETURN^1^1^1^1
"KRN",8994,3258,2,3,1,0)
^8994.021^2^2^3150602^^
"KRN",8994,3258,2,3,1,1,0)
Returns a '1' if remarks are successfully set and a '0' if the remarks are
"KRN",8994,3258,2,3,1,2,0)
not set.
"KRN",8994,3258,2,4,0)
EIEN^2^512^1^2
"KRN",8994,3258,2,4,1,0)
^8994.021^4^4^3150604^^^^
"KRN",8994,3258,2,4,1,1,0)
The is the 2507 EXAM ID from the 2507 EXAM file 396.4. The remarks
"KRN",8994,3258,2,4,1,2,0)
sent to the contractor are stored in the new word processing field #103 of
"KRN",8994,3258,2,4,1,3,0)
the 2507 EXAM file 396.4. The 2507 EXAMs are connected to the 2507 REQUEST
"KRN",8994,3258,2,4,1,4,0)
file via a pointer.
"KRN",8994,3258,2,"B","EIEN",4)

"KRN",8994,3258,2,"B","RETURN",3)

"KRN",8994,3258,2,"B","RQID",1)

"KRN",8994,3258,2,"B","TEXT",2)

"KRN",8994,3258,2,"PARAMSEQ",1,3)

"KRN",8994,3258,2,"PARAMSEQ",2,4)

"KRN",8994,3258,2,"PARAMSEQ",3,1)

"KRN",8994,3258,2,"PARAMSEQ",4,2)

"KRN",8994,3258,3,0)
^8994.03^1^1^3150804^^^^
"KRN",8994,3258,3,1,0)
returns a 1 when set
"MBREQ")
0
"ORD",16,8994)
8994;16;1;;;;;;;RPCDEL^XPDIA1
"ORD",16,8994,0)
REMOTE PROCEDURE
"ORD",20,8989.51)
8989.51;20;;;PAR1E1^XPDTA2;PAR1F1^XPDIA3;PAR1E1^XPDIA3;PAR1F2^XPDIA3;;PAR1DEL^XPDIA3(%)
"ORD",20,8989.51,0)
PARAMETER DEFINITION
"PKG",223,-1)
1^1
"PKG",223,0)
AUTOMATED MED INFO EXCHANGE^DVBA^The entire AMIE package 7131/2507.
"PKG",223,20,0)
^9.402P^^
"PKG",223,22,0)
^9.49I^1^1
"PKG",223,22,1,0)
2.7^2950410^3010328
"PKG",223,22,1,"PAH",1,0)
192^3150813
"PKG",223,22,1,"PAH",1,1,0)
^^1^1^3150813
"PKG",223,22,1,"PAH",1,1,1,0)
Please see FORUM for a complete patch description
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
12
"RTN","DVBA192P")
0^^B1459756^n/a
"RTN","DVBA192P",1,0)
DVBA192P ;ALB/RTW - DVBA CAPRI PATCH 192 POST INSTALL ROUTINE; 07/09/2015  12:13 PM
"RTN","DVBA192P",2,0)
 ;;2.7;AMIE;**192**;Apr 10, 1995;Build 15
"RTN","DVBA192P",3,0)
 ;This routine updates the AMIE 290 report parameters
"RTN","DVBA192P",4,0)
 D PARAM,END
"RTN","DVBA192P",5,0)
 Q
"RTN","DVBA192P",6,0)
END ;
"RTN","DVBA192P",7,0)
 K DVBENT,DVBERR,DVBAL
"RTN","DVBA192P",8,0)
 Q
"RTN","DVBA192P",9,0)
 ;
"RTN","DVBA192P",10,0)
PARAM ; new URL http://vaww.demo.domain.ext/dmareports.asp
"RTN","DVBA192P",11,0)
 S DVBERR=$$ENXPAR("PKG","DVBAB CAPRI VICAP URL","http://vaww.demo.domain.ext/dmareports.asp")
"RTN","DVBA192P",12,0)
 D UPDMSG("DVBAB CAPRI VICAP URL",DVBERR)
"RTN","DVBA192P",13,0)
 Q
"RTN","DVBA192P",14,0)
ENXPAR(DVBENT,DVBPAR,DVBVAL) ;Update Parameter values
"RTN","DVBA192P",15,0)
 ;
"RTN","DVBA192P",16,0)
 ;  Input:
"RTN","DVBA192P",17,0)
 ;    DVBENT - Parameter Entity
"RTN","DVBA192P",18,0)
 ;    DVBPAR - Parameter Name
"RTN","DVBA192P",19,0)
 ;    DVBVAL - Parameter Value
"RTN","DVBA192P",20,0)
 ;
"RTN","DVBA192P",21,0)
 ;  Output:
"RTN","DVBA192P",22,0)
 ;    Function value - returns "0" on success;
"RTN","DVBA192P",23,0)
 ;                     otherwise returns error#^errortext
"RTN","DVBA192P",24,0)
 ;
"RTN","DVBA192P",25,0)
 N DVBERR
"RTN","DVBA192P",26,0)
 D EN^XPAR(DVBENT,DVBPAR,1,DVBVAL,.DVBERR)
"RTN","DVBA192P",27,0)
 Q DVBERR
"RTN","DVBA192P",28,0)
 ;
"RTN","DVBA192P",29,0)
UPDMSG(DVBPAR,DVBERR) ;display update message
"RTN","DVBA192P",30,0)
 ;
"RTN","DVBA192P",31,0)
 ;  Input:
"RTN","DVBA192P",32,0)
 ;    DVBPAR - Parameter Name
"RTN","DVBA192P",33,0)
 ;    DVBERR - Parameter Update result
"RTN","DVBA192P",34,0)
 ;
"RTN","DVBA192P",35,0)
 ;  Output: none
"RTN","DVBA192P",36,0)
 ; 
"RTN","DVBA192P",37,0)
 I DVBERR D
"RTN","DVBA192P",38,0)
 . D MES^XPDUTL(DVBPAR_" update FAILURE.")
"RTN","DVBA192P",39,0)
 . D MES^XPDUTL("  Failure reason: "_DVBERR)
"RTN","DVBA192P",40,0)
 E  D
"RTN","DVBA192P",41,0)
 . D MES^XPDUTL(DVBPAR_" update SUCCESS.")
"RTN","DVBA192P",42,0)
 Q
"RTN","DVBAB6")
0^2^B67138708^B57291338
"RTN","DVBAB6",1,0)
DVBAB6 ;ALB/DJS - CAPRI PENDING 2507 REQUEST REPORT ; 02-27-2013
"RTN","DVBAB6",2,0)
 ;;2.7;AMIE;**35,90,108,168,185,190,192**;Apr 10, 1995;Build 15
"RTN","DVBAB6",3,0)
 ;
"RTN","DVBAB6",4,0)
STRT(MSG,DVBCSORT,RSTAT,ERDAYS,OLDAYS,ADIVNUM,ELTYP,DVBADLMTR,ROFILTER) ;
"RTN","DVBAB6",5,0)
 I ADIVNUM'="" S X=$O(^DG(40.8,"C",ADIVNUM,"")) S:X]"" ADIVNUM=X
"RTN","DVBAB6",6,0)
 S DVBADLMTR=$S(DVBADLMTR=1:",",1:0),ROFILTER=$S($G(ROFILTER)'=0:ROFILTER,1:0)
"RTN","DVBAB6",7,0)
SETUP K ^TMP($J),^TMP("CAPRI")
"RTN","DVBAB6",8,0)
 S DVBCDT(0)=$$FMTE^XLFDT(DT,"5DZ"),PG=1,DVBCCNT=0,DONE="NO",MSGCNT=1,TRNSFIN=""
"RTN","DVBAB6",9,0)
 S DVBCHDR="Sorted by "_$S(DVBCSORT="V":"VETERAN NAME",DVBCSORT="R":"Routing location",DVBCSORT="S":"Status",DVBCSORT="A":"Age of request",1:"Unknown")
"RTN","DVBAB6",10,0)
HEAD S HEAD="Pending 2507 Requests for "_$S($D(^DVB(396.1,1,0)):$P(^(0),U,1),1:"Unknown site"),PROCDT="Processed on: "_DVBCDT(0),NODATA=0
"RTN","DVBAB6",11,0)
 I $G(DVBADLMTR)'="," D HEADRND G DATA
"RTN","DVBAB6",12,0)
 I $G(DVBADLMTR)="," D HEADRD G DATA
"RTN","DVBAB6",13,0)
 Q
"RTN","DVBAB6",14,0)
HEADRND ; Print non-delimited output header
"RTN","DVBAB6",15,0)
 ;
"RTN","DVBAB6",16,0)
 S ^TMP("CAPRI",MSGCNT)=HEAD_"^",MSGCNT=MSGCNT+1
"RTN","DVBAB6",17,0)
 S ^TMP("CAPRI",MSGCNT)=PROCDT_"^",MSGCNT=MSGCNT+1
"RTN","DVBAB6",18,0)
 S ^TMP("CAPRI",MSGCNT)="^",MSGCNT=MSGCNT+1
"RTN","DVBAB6",19,0)
 S $P(^TMP("CAPRI",MSGCNT),"=",75)="=^",MSGCNT=MSGCNT+1
"RTN","DVBAB6",20,0)
 S ^TMP("CAPRI",MSGCNT)="^",MSGCNT=MSGCNT+1
"RTN","DVBAB6",21,0)
 S ^TMP("CAPRI",MSGCNT)="",MSGCNT=MSGCNT+1
"RTN","DVBAB6",22,0)
 Q
"RTN","DVBAB6",23,0)
HEADRD ; Print delimited output header
"RTN","DVBAB6",24,0)
 ;
"RTN","DVBAB6",25,0)
 S ^TMP("CAPRI",MSGCNT)=HEAD_$C(13),MSGCNT=MSGCNT+1,^TMP("CAPRI",MSGCNT)=PROCDT_$C(13),MSGCNT=MSGCNT+1
"RTN","DVBAB6",26,0)
 S ^TMP("CAPRI",MSGCNT)=$S($G(ROFILTER)'=0:"RO #"_DVBADLMTR,1:"")_"Division"_DVBADLMTR_"Status"_DVBADLMTR_"Veteran Name"_DVBADLMTR_"SSN"_DVBADLMTR_"Claim No."_DVBADLMTR_"Request Date"_DVBADLMTR
"RTN","DVBAB6",27,0)
 S ^TMP("CAPRI",MSGCNT)=^TMP("CAPRI",MSGCNT)_"Elapsed Days"_DVBADLMTR_"Transferred in from"_DVBADLMTR_"Requested by Name"_DVBADLMTR_"Requested by Division"_DVBADLMTR_"Exams Requested"_DVBADLMTR_"Exam Status"_DVBADLMTR
"RTN","DVBAB6",28,0)
 S ^TMP("CAPRI",MSGCNT)=^TMP("CAPRI",MSGCNT)_"Cell Phone"_DVBADLMTR_"Email Address"_DVBADLMTR_"Claim Type"_DVBADLMTR_"Special Consideration(s)"_$C(13)
"RTN","DVBAB6",29,0)
 S MSGCNT=MSGCNT+1
"RTN","DVBAB6",30,0)
 Q
"RTN","DVBAB6",31,0)
 ;
"RTN","DVBAB6",32,0)
DATA ; Sort data records
"RTN","DVBAB6",33,0)
 ;
"RTN","DVBAB6",34,0)
 S DFN="" F  S DFN=$O(^DVB(396.3,"B",DFN)) Q:DFN=""  F REQDA=0:0 S REQDA=$O(^DVB(396.3,"B",DFN,REQDA)) Q:REQDA=""  D SORT^DVBAB5
"RTN","DVBAB6",35,0)
 N EXAMRECRD
"RTN","DVBAB6",36,0)
 I DVBCSORT="V" S PNAM="" F  S PNAM=$O(^TMP($J,PNAM)) Q:PNAM=""  F DFN=0:0 S DFN=$O(^TMP($J,PNAM,DFN)) Q:'DFN  F DA(1)=0:0 S DA(1)=$O(^TMP($J,PNAM,DFN,DA(1))) Q:'DA(1)  D PRINT I $D(OUT) S DA(1)=999999999,PNAM="ZZZ",DONE="YES" Q
"RTN","DVBAB6",37,0)
 I DVBCSORT="R"!(DVBCSORT="A")!(DVBCSORT="S") D
"RTN","DVBAB6",38,0)
 . S JX="" F  S JX=$O(^TMP($J,JX)) Q:JX=""  D
"RTN","DVBAB6",39,0)
 .. S PNAM="" F  S PNAM=$O(^TMP($J,JX,PNAM)) Q:PNAM=""  D
"RTN","DVBAB6",40,0)
 ... F DFN=0:0 S DFN=$O(^TMP($J,JX,PNAM,DFN)) Q:'DFN  D NXT
"RTN","DVBAB6",41,0)
 I DVBCCNT>0 S ^TMP("CAPRI",MSGCNT)="Total pending: "_DVBCCNT,DONE="YES"
"RTN","DVBAB6",42,0)
 ;
"RTN","DVBAB6",43,0)
EXIT I NODATA=0 S ^TMP("CAPRI",MSGCNT)="No pending request found for select parameters.",MSG=$NA(^TMP("CAPRI"))
"RTN","DVBAB6",44,0)
 I DONE="YES" S MSG=$NA(^TMP("CAPRI"))
"RTN","DVBAB6",45,0)
 K ^TMP($J),ADIV,CNUM,NODATA,STATUS,TST,TSTA1,STSAT,PG,PRTNM,RDATE,RDATE1,REQDA,SSN,RONAME,JX,TRNSFIN,PROCDT,REQSTR,MSGCNT,TSTAT
"RTN","DVBAB6",46,0)
 K DA,DFN,DONE,DVBCCNT,DVBCDT,DVBCHDR,X,XX,ZS,ZZZ,HEAD,HEAD2,OUT,OWNDOM,EDAYS,PNAM,DVBADLMTR,EXAMRECRD,ROFILTER,RONUM,VADM(1),VADM(2)
"RTN","DVBAB6",47,0)
 K DVBAA,DVBCELL,DVBCNT,DVBCTW,DVBEMA,DVBSC,DVBSCN,DVBSCNS,DVBSCW,DVBSCWA,DVBX
"RTN","DVBAB6",48,0)
 Q
"RTN","DVBAB6",49,0)
 ;
"RTN","DVBAB6",50,0)
PRINT ; print 2507 request data
"RTN","DVBAB6",51,0)
 ;
"RTN","DVBAB6",52,0)
 S ADIV=$S($D(^DVB(396.3,DA(1),1)):$P(^(1),U,4),1:"") Q:ADIV'=ADIVNUM&(DVBCSORT="R")  I ADIV]"" S ADIV=$S($D(^DG(40.8,+ADIV,0)):$P(^(0),U,1),1:"Unknown Division")
"RTN","DVBAB6",53,0)
 S RDATE1=$P(^DVB(396.3,DA(1),0),U,2),RDATE=$P(^(0),U,5)
"RTN","DVBAB6",54,0)
 S SSN=$P($G(^DPT(DFN,0)),U,9) S:SSN="" SSN="Unknown"
"RTN","DVBAB6",55,0)
 S DVBCELL=$P($G(^DPT(DFN,.13)),U,4)
"RTN","DVBAB6",56,0)
 S DVBEMA=$P($G(^DPT(DFN,.13)),U,3)
"RTN","DVBAB6",57,0)
 S CNUM=$P($G(^DPT(DFN,.31)),U,3) S:CNUM="" CNUM="Unknown"
"RTN","DVBAB6",58,0)
 S OWNDOM=$P(^DVB(396.3,DA(1),0),U,22) I OWNDOM]"" S TRNSFIN=$S($D(^DIC(4.2,+OWNDOM,0)):$P(^(0),U,1),1:"Unknown Site") I $G(DVBADLMTR)=0 S ^TMP("CAPRI",MSGCNT)="Transferred in from "_TRNSFIN_"^",MSGCNT=MSGCNT+1
"RTN","DVBAB6",59,0)
 D ELAPSED^DVBAB5
"RTN","DVBAB6",60,0)
 S STATUS="Unknown",XX=$P(^DVB(396.3,DA(1),0),U,18),STATUS=$S(XX="N":"New",XX="P":"Pending, reported",XX="S":"Pending, scheduled",XX="R":"Released to RO, not printed",1:"")
"RTN","DVBAB6",61,0)
 I STATUS="",$D(XX) S STATUS=$S(XX="C":"Completed, printed by RO",XX="X":"Cancelled by RO",XX="T":"Transcribed",XX="NT":"New,Transferred in",XX="CT":"Completed, Transferred out",1:"Unknown")
"RTN","DVBAB6",62,0)
 I $G(DVBADLMTR)="," D PRINTD,ITEMS Q
"RTN","DVBAB6",63,0)
 S ^TMP("CAPRI",MSGCNT)="Division: "_ADIV_"^",MSGCNT=MSGCNT+1
"RTN","DVBAB6",64,0)
 S ^TMP("CAPRI",MSGCNT)="Status: "_STATUS_"^",MSGCNT=MSGCNT+1
"RTN","DVBAB6",65,0)
 S ^TMP("CAPRI",MSGCNT)=PNAM_" ^",MSGCNT=MSGCNT+1
"RTN","DVBAB6",66,0)
 S ^TMP("CAPRI",MSGCNT)="SSN: "_SSN_"^",MSGCNT=MSGCNT+1
"RTN","DVBAB6",67,0)
 S ^TMP("CAPRI",MSGCNT)="Cell no.: "_DVBCELL_"^",MSGCNT=MSGCNT+1
"RTN","DVBAB6",68,0)
 S ^TMP("CAPRI",MSGCNT)="Email: "_DVBEMA_"^",MSGCNT=MSGCNT+1
"RTN","DVBAB6",69,0)
 S ^TMP("CAPRI",MSGCNT)="Claim no: "_CNUM_"^",MSGCNT=MSGCNT+1
"RTN","DVBAB6",70,0)
 S ^TMP("CAPRI",MSGCNT)="Request Date: "_$$FMTE^XLFDT(RDATE1,"5DZ")_"^",MSGCNT=MSGCNT+1
"RTN","DVBAB6",71,0)
 S ^TMP("CAPRI",MSGCNT)="Elapsed days: "_EDAYS_"^",MSGCNT=MSGCNT+1
"RTN","DVBAB6",72,0)
 S X=$S($D(^DVB(396.3,DA(1),4)):^(4),1:"")
"RTN","DVBAB6",73,0)
 D CLAIMTYP,SPEC
"RTN","DVBAB6",74,0)
 S ^TMP("CAPRI",MSGCNT)="Claim Type: "_DVBCTW_"^",MSGCNT=MSGCNT+1
"RTN","DVBAB6",75,0)
 S ^TMP("CAPRI",MSGCNT)="Special Consideration(s): "_DVBSCWA_"^",MSGCNT=MSGCNT+1
"RTN","DVBAB6",76,0)
 S ^TMP("CAPRI",MSGCNT)="^",MSGCNT=MSGCNT+1
"RTN","DVBAB6",77,0)
 S ^TMP("CAPRI",MSGCNT)="Exams requested:"_"^",MSGCNT=MSGCNT+1
"RTN","DVBAB6",78,0)
 ;
"RTN","DVBAB6",79,0)
ITEMS S NODATA=1,REQSTR=+$P(^DVB(396.3,DA(1),0),U,4)
"RTN","DVBAB6",80,0)
 S ZZZ="Requested by: "_$S($D(^VA(200,+REQSTR,0)):$P(^(0),U,1),1:" (Not specified) ")_" at "
"RTN","DVBAB6",81,0)
 S RONAME=$P(^DVB(396.3,DA(1),0),U,3),RONAME=$S(RONAME]"":$P(^DIC(4,+RONAME,0),U,1),1:"")
"RTN","DVBAB6",82,0)
 I $G(DVBADLMTR)'="," D ITEMSND Q
"RTN","DVBAB6",83,0)
 I $G(DVBADLMTR)="," D ITEMSD Q
"RTN","DVBAB6",84,0)
ITEMSND D TST S ^TMP("CAPRI",MSGCNT)="^"_ZZZ_$S(RONAME]"":RONAME,1:" (Not specified) ")_"^",MSGCNT=MSGCNT+1
"RTN","DVBAB6",85,0)
 S ^TMP("CAPRI",MSGCNT)="^",MSGCNT=MSGCNT+1
"RTN","DVBAB6",86,0)
 S $P(^TMP("CAPRI",MSGCNT),"-",75)="-^",MSGCNT=MSGCNT+1
"RTN","DVBAB6",87,0)
 S DVBCCNT=DVBCCNT+1
"RTN","DVBAB6",88,0)
 Q
"RTN","DVBAB6",89,0)
ITEMSD S ZZZ=$S($D(^VA(200,+REQSTR,0)):$P(^(0),U,1),1:" (Not specified) ")
"RTN","DVBAB6",90,0)
 S EXAMRECRD=EXAMRECRD_""""_ZZZ_""""_DVBADLMTR_""""_RONAME_""""_DVBADLMTR
"RTN","DVBAB6",91,0)
 D TST S DVBCCNT=DVBCCNT+1
"RTN","DVBAB6",92,0)
 Q
"RTN","DVBAB6",93,0)
 ;
"RTN","DVBAB6",94,0)
PRINTD ; Print delimited format output on report
"RTN","DVBAB6",95,0)
 ;
"RTN","DVBAB6",96,0)
 I OWNDOM']"" S TRNSFIN=""
"RTN","DVBAB6",97,0)
 S RONUM=$P(^DVB(396.3,DA(1),0),U,3)
"RTN","DVBAB6",98,0)
 D DEM^VADPT I $G(VADM(1))'="" S SSN=$S(DVBADLMTR=",":$P($G(VADM(2)),U,2),1:$P($G(VADM(2)),U,1))
"RTN","DVBAB6",99,0)
 S EXAMRECRD=$S($G(ROFILTER)'=0:RONUM_DVBADLMTR,1:"")_""""_ADIV_""""_DVBADLMTR_""""_STATUS_""""_DVBADLMTR_""""_PNAM_""""_DVBADLMTR
"RTN","DVBAB6",100,0)
 S EXAMRECRD=EXAMRECRD_SSN_DVBADLMTR_$C(160)_CNUM_DVBADLMTR_$$FMTE^XLFDT(RDATE1,"5DZ")_DVBADLMTR_EDAYS_DVBADLMTR_TRNSFIN_DVBADLMTR
"RTN","DVBAB6",101,0)
 Q
"RTN","DVBAB6",102,0)
 ;
"RTN","DVBAB6",103,0)
NXT F DA(1)=0:0 S DA(1)=$O(^TMP($J,JX,PNAM,DFN,DA(1))) Q:DA(1)=""  D PRINT I $D(OUT) S DA(1)="",PNAM="ZZZZ",JX=$S($A(JX)>57:PNAM,1:9999999),DONE="YES"
"RTN","DVBAB6",104,0)
 Q
"RTN","DVBAB6",105,0)
TST F DA=0:0 S DA=$O(^DVB(396.4,"C",DA(1),DA)) Q:DA=""  K PRINT S TSTAT=$P(^DVB(396.4,DA,0),U,4),TST=$P(^DVB(396.4,DA,0),U,3),PRTNM=$S($D(^DVB(396.6,TST,0)):$P(^(0),U,2),1:"") D TST1
"RTN","DVBAB6",106,0)
 Q
"RTN","DVBAB6",107,0)
TST1 S TSTA1=""
"RTN","DVBAB6",108,0)
 I $D(^DVB(396.4,DA,"CAN")) S TSTA1=$P(^DVB(396.4,DA,"CAN"),U,3)
"RTN","DVBAB6",109,0)
 I $D(^DVB(396.4,DA,"TRAN")) S X=$P(^DVB(396.4,DA,"TRAN"),U,3)
"RTN","DVBAB6",110,0)
 S:TSTA1]"" TSTA1=$P(^DVB(396.5,TSTA1,0),U,1)
"RTN","DVBAB6",111,0)
 I $G(DVBADLMTR)'="," D
"RTN","DVBAB6",112,0)
 . S ^TMP("CAPRI",MSGCNT)=$S(PRTNM]"":PRTNM,1:"Missing exam name")
"RTN","DVBAB6",113,0)
 . S ^TMP("CAPRI",MSGCNT)=^TMP("CAPRI",MSGCNT)_$S(TSTA1]"":" - cancelled ("_TSTA1_")",TSTAT="T":" - Transferred",TSTAT]"":" - "_$$EXTERNAL^DILFD(396.4,.04,,TSTAT),TSTAT="":" (Unknown status)",1:"")_"^"
"RTN","DVBAB6",114,0)
 . S MSGCNT=MSGCNT+1
"RTN","DVBAB6",115,0)
 . I TSTAT="T" S X=$S($D(^DIC(4.2,+X,0)):$P(^(0),U,1),1:"unknown site") S ^TMP("CAPRI",MSGCNT)=" to "_$P(X,".",1),MSGCNT=MSGCNT+1
"RTN","DVBAB6",116,0)
 . Q
"RTN","DVBAB6",117,0)
 I $G(DVBADLMTR)="," D
"RTN","DVBAB6",118,0)
 . D CLAIMTYP,SPEC
"RTN","DVBAB6",119,0)
 . S PRTNM=$S(PRTNM]"":PRTNM,1:"Missing exam name"),TSTAT=$S(TSTA1]"":"Cancelled ("_TSTA1_")",TSTAT="T":"Transferred",TSTAT]"":$$EXTERNAL^DILFD(396.4,.04,,TSTAT),TSTAT="":" (Unknown status)",1:"")
"RTN","DVBAB6",120,0)
 . S ^TMP("CAPRI",MSGCNT)=EXAMRECRD_""""_PRTNM_""""_DVBADLMTR_""""_TSTAT_""""_DVBADLMTR_""""_DVBCELL_""""_DVBADLMTR_""""_DVBEMA_""""_DVBADLMTR_""""_DVBCTW_""""_DVBADLMTR_""""_DVBSCWA_""""
"RTN","DVBAB6",121,0)
 . I TSTAT="T" S X=$S($D(^DIC(4.2,+X,0)):$P(^(0),U,1),1:"unknown site") S ^TMP("CAPRI",MSGCNT)=^TMP("CAPRI",MSGCNT)_" to "_$P(X,".",1)
"RTN","DVBAB6",122,0)
 . S ^TMP("CAPRI",MSGCNT)=^TMP("CAPRI",MSGCNT)_$C(13)
"RTN","DVBAB6",123,0)
 S MSGCNT=MSGCNT+1
"RTN","DVBAB6",124,0)
 Q
"RTN","DVBAB6",125,0)
CLAIMTYP ;THE CLAIM TYPE OF A 2507 REQUEST
"RTN","DVBAB6",126,0)
 S DVBCTW=""
"RTN","DVBAB6",127,0)
 Q:'$D(^DVB(396.3,DA(1),9,0))
"RTN","DVBAB6",128,0)
 ;DVBIEN is the 2507 REQUEST FILE IEN
"RTN","DVBAB6",129,0)
 ;DVBCTW is the string /name of the CLAIM TYPE
"RTN","DVBAB6",130,0)
 D GETS^DIQ(396.3,DA(1)_",","9.1*","E","MSG","ERR")
"RTN","DVBAB6",131,0)
 S DVBCTW=MSG("396.32","1,"_DA(1)_",",".01","E")
"RTN","DVBAB6",132,0)
 Q
"RTN","DVBAB6",133,0)
 ;
"RTN","DVBAB6",134,0)
SPEC ;SPECIAL CONSIDERATION(S) FOR A 2507 REQUEST
"RTN","DVBAB6",135,0)
 K DVBSCW
"RTN","DVBAB6",136,0)
 S DVBSCWA=""
"RTN","DVBAB6",137,0)
 Q:'$D(^DVB(396.3,DA(1),8))
"RTN","DVBAB6",138,0)
 ;DA(1) is the 2507 REQUEST FILE IEN
"RTN","DVBAB6",139,0)
 ;DVBSC is a the SPECIAL CONSIDERATION entry for the 2507 REQUEST
"RTN","DVBAB6",140,0)
 ;DVBSCN is the pointer number to the SPECIAL CONSIDERATION file 396.25
"RTN","DVBAB6",141,0)
 ;DVBSCW is the string /name of the SPECIAL CONSIDERATION
"RTN","DVBAB6",142,0)
 S DVBAA=$P(^DVB(396.3,DA(1),8,0),U,4)
"RTN","DVBAB6",143,0)
 S (DVBSC,DVBCNT)=0 F  S DVBSC=$O(^DVB(396.3,DA(1),8,DVBSC)) Q:'DVBSC  D
"RTN","DVBAB6",144,0)
 .S DVBSCN=$P(^DVB(396.3,DA(1),8,DVBSC,0),U,1)
"RTN","DVBAB6",145,0)
 .S DVBSCW(DVBSC)=$G(^DVB(396.25,DVBSCN,0))
"RTN","DVBAB6",146,0)
 .S DVBCNT=DVBCNT+1
"RTN","DVBAB6",147,0)
 .I (DVBCNT'=DVBAA) S:$D(DVBSCW(DVBSC)) DVBSCW(DVBSC)=DVBSCW(DVBSC)_","
"RTN","DVBAB6",148,0)
 S DVBX="" F  S DVBX=$O(DVBSCW(DVBX)) Q:'DVBX  S DVBSCWA=DVBSCWA_DVBSCW(DVBX)
"RTN","DVBAB6",149,0)
 Q
"RTN","DVBAB82")
0^3^B137858381^B120585412
"RTN","DVBAB82",1,0)
DVBAB82 ;ALB/DJS - CAPRI DVBA REPORTS ; 01/24/12
"RTN","DVBAB82",2,0)
 ;;2.7;AMIE;**42,90,100,119,156,149,179,181,184,185,192**;Apr 10, 1995;Build 15
"RTN","DVBAB82",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","DVBAB82",4,0)
 ;ALB/RTW added subroutine VBACRPON to allow VBA reprint reqardless of office
"RTN","DVBAB82",5,0)
 Q
"RTN","DVBAB82",6,0)
 ;
"RTN","DVBAB82",7,0)
START(MSG,RPID,PARM) ; CALLED BY REMOTE PROCEDURE DVBAB REPORTS
"RTN","DVBAB82",8,0)
 ;Parameters
"RTN","DVBAB82",9,0)
 ;=============
"RTN","DVBAB82",10,0)
 ; MSG  : Output - ^TMP("DVBA",$J)
"RTN","DVBAB82",11,0)
 ; RPID : Report Identification Number
"RTN","DVBAB82",12,0)
 ; PARM : Input parameters separated by "^"
"RTN","DVBAB82",13,0)
 ;
"RTN","DVBAB82",14,0)
 N DVBHFS,DVBERR,DVBGUI,I,DVBADLMTD
"RTN","DVBAB82",15,0)
 K ^TMP("DVBA",$J)
"RTN","DVBAB82",16,0)
 S DVBGUI=1,(DVBERR,DVBADLMTD)=0,DVBHFS=$$HFS(),RPID=$G(RPID)
"RTN","DVBAB82",17,0)
 I RPID<1!(RPID>15) S DVBERR=1,^TMP("DVBA",$J,1)="0^Undefined Report ID" G END
"RTN","DVBAB82",18,0)
 D HFSOPEN("DVBRP",DVBHFS,"W") I DVBERR G END
"RTN","DVBAB82",19,0)
 I RPID=1 D CRMS G END
"RTN","DVBAB82",20,0)
 I RPID=3 D CPRNT G END
"RTN","DVBAB82",21,0)
 I RPID=11 D CNHRP G END  ;FNCNH Print Roster
"RTN","DVBAB82",22,0)
 D CHECK I DVBERR G END  ;reports below require parameters
"RTN","DVBAB82",23,0)
 I RPID=2 D CRRR G END
"RTN","DVBAB82",24,0)
 I RPID=4,$P(PARM,U,8)=0 D CRPON G END
"RTN","DVBAB82",25,0)
 I RPID=4,$P(PARM,U,8)=1 D VBACRPON G END
"RTN","DVBAB82",26,0)
 I RPID=5 D CIRPT G END
"RTN","DVBAB82",27,0)
 I RPID=6 D DSRP G END
"RTN","DVBAB82",28,0)
 I RPID=7 D SDPP G END
"RTN","DVBAB82",29,0)
 I RPID=8 D SPRPT G END
"RTN","DVBAB82",30,0)
 I RPID=9 D VIEW G END
"RTN","DVBAB82",31,0)
 I RPID=10 D CNHDEOC G END  ;FBCNH Display Episode Of Care
"RTN","DVBAB82",32,0)
 I RPID=12 D CNHRAD G END  ;FNCNH Report of Admissions/Discharges
"RTN","DVBAB82",33,0)
 I RPID=13 D CNHSE90D G END  ;FNCNH Stays in Excess of 90 Days
"RTN","DVBAB82",34,0)
 I RPID=14 D REQSTAT G END  ;REQUEST STATUS BY DATE RANGE
"RTN","DVBAB82",35,0)
 I RPID=15 D DVBA8861 G END  ;FORM 28-8861 STATUS REPORT
"RTN","DVBAB82",36,0)
 ;
"RTN","DVBAB82",37,0)
END D HFSCLOSE("DVBRP",DVBHFS)
"RTN","DVBAB82",38,0)
 I ($G(DVBADLMTD)&('+DVBERR)) D  Q  ;Create delimited output if no errors
"RTN","DVBAB82",39,0)
 .D DLMTRPT^DVBAB82D(RPID)
"RTN","DVBAB82",40,0)
 .S I=0 F  S I=$O(^TMP("DVBADLMTD",$J,I)) Q:I=""  D
"RTN","DVBAB82",41,0)
 ..I $G(^TMP("DVBADLMTD",$J,I))["##FFFF##" S ^TMP("DVBADLMTD",$J,I)=$TR(^TMP("DVBADLMTD",$J,I),"##FFFF##","")
"RTN","DVBAB82",42,0)
 .S MSG=$NA(^TMP("DVBADLMTD",$J))
"RTN","DVBAB82",43,0)
 ;Replace "##FFFF##" with Form Feeds - code needed for LINUX environments
"RTN","DVBAB82",44,0)
 S I=0 F  S I=$O(^TMP("DVBA",$J,1,I)) Q:'I  D
"RTN","DVBAB82",45,0)
 .S:^TMP("DVBA",$J,1,I)["##FFFF##" ^TMP("DVBA",$J,1,I)=$P(^TMP("DVBA",$J,1,I),"##FFFF##")_$C(13,12)_$P(^TMP("DVBA",$J,1,I),"##FFFF##",2)
"RTN","DVBAB82",46,0)
 .S ^TMP("DVBA",$J,1,I)=^TMP("DVBA",$J,1,I)_$C(13)
"RTN","DVBAB82",47,0)
 .S:^TMP("DVBA",$J,1,I)["$END" ^TMP("DVBA",$J,1,I)=""
"RTN","DVBAB82",48,0)
 S MSG=$NA(^TMP("DVBA",$J))
"RTN","DVBAB82",49,0)
 I ($G(RPID)=5)&($G(DVBADLMTR)=",") S MSG=$NA(^TMP("INSUFF",$J))
"RTN","DVBAB82",50,0)
 Q
"RTN","DVBAB82",51,0)
CHECK ; VALIDATE INPUT PARAMETERS
"RTN","DVBAB82",52,0)
 I $G(PARM)="" S DVBERR=1,^TMP("DVBA",$J,1)="0^Undefined Input Parameters"
"RTN","DVBAB82",53,0)
 Q
"RTN","DVBAB82",54,0)
 ;
"RTN","DVBAB82",55,0)
SDPP ; Report # 7 - Full (Patient Profile MAS) Report
"RTN","DVBAB82",56,0)
 ;Parameters
"RTN","DVBAB82",57,0)
 ;=============
"RTN","DVBAB82",58,0)
 ; DFN : Patient Identification Number
"RTN","DVBAB82",59,0)
 ; SDR : R/Range or A/All
"RTN","DVBAB82",60,0)
 ; SDBD : Begining date
"RTN","DVBAB82",61,0)
 ; SDED : Ending date
"RTN","DVBAB82",62,0)
 ; SDP : Print the profile? 1 OR 0
"RTN","DVBAB82",63,0)
 ; SDTYP(2) : Print appointments? 1 OR 0
"RTN","DVBAB82",64,0)
 ; SDTYP(1) : Print add/edits? 1 or 0
"RTN","DVBAB82",65,0)
 ; SDTYP(4) : Print enrollments? 1 or 0
"RTN","DVBAB82",66,0)
 ; SDTYP(3) : Print dispositions? 1 OR 0
"RTN","DVBAB82",67,0)
 ; SDTYP(7) : Print team information? 1 OR 0
"RTN","DVBAB82",68,0)
 ; SDTYP(5) : Print means test? 1 OR 0
"RTN","DVBAB82",69,0)
 ;
"RTN","DVBAB82",70,0)
 N SDTYP,SDBD,SDED,SDACT,SDPRINT,SDYES,SDRANGE,SDBEG,SDEN
"RTN","DVBAB82",71,0)
 S ^XTMP("JAP",$J,$$NOW^XLFDT(),"SDPP")=PARM
"RTN","DVBAB82",72,0)
 S DFN=$P(PARM,"^",1),SDR=$P(PARM,"^",2),SDBD=$P(PARM,"^",3),SDED=$P(PARM,"^",4)
"RTN","DVBAB82",73,0)
 S SDP=$P(PARM,"^",5),SDTYP(2)=$P(PARM,"^",6),SDTYP(1)=$P(PARM,"^",7)
"RTN","DVBAB82",74,0)
 S SDTYP(4)=$P(PARM,"^",8),SDTYP(3)=$P(PARM,"^",9),SDTYP(7)=$P(PARM,"^",10),SDTYP(5)=$P(PARM,"^",11)
"RTN","DVBAB82",75,0)
 D VAL Q:DVBERR
"RTN","DVBAB82",76,0)
 S SDACT="",(SDYES,SDRANGE,SDPRINT)=0
"RTN","DVBAB82",77,0)
 I SDR="R" S SDRANGE=1
"RTN","DVBAB82",78,0)
 I SDP=1 S SDYES=1,SDPRINT=1
"RTN","DVBAB82",79,0)
 I 'SDRANGE S (SDBD,SDBEG)=2800101,(SDED,SDEND)=$$ENDDT(),SDHDR=1
"RTN","DVBAB82",80,0)
 D ENS^%ZISS
"RTN","DVBAB82",81,0)
 S SDPRINT=1
"RTN","DVBAB82",82,0)
 S:(SDTYP(2)=1) SDTYP(2)=""  ;appointments
"RTN","DVBAB82",83,0)
 K:(SDTYP(2)=0) SDTYP(2)
"RTN","DVBAB82",84,0)
 S:(SDTYP(1)=1) SDTYP(1)=""  ;add/edits
"RTN","DVBAB82",85,0)
 K:(SDTYP(1)=0) SDTYP(1)
"RTN","DVBAB82",86,0)
 I (SDTYP(4)=1) S SDTYP(4)="",SDACT=0  ;enrollments
"RTN","DVBAB82",87,0)
 K:(SDTYP(4)=0) SDTYP(4)
"RTN","DVBAB82",88,0)
 S:(SDTYP(3)=1) SDTYP(3)=""  ;dispositions
"RTN","DVBAB82",89,0)
 K:(SDTYP(3)=0) SDTYP(3)
"RTN","DVBAB82",90,0)
 S:(SDTYP(5)=1) SDTYP(5)=""  ;means test
"RTN","DVBAB82",91,0)
 K:(SDTYP(5)=0) SDTYP(5)
"RTN","DVBAB82",92,0)
 I SDTYP(7)=1 D  ;team information
"RTN","DVBAB82",93,0)
 . S SDTYP(7)="",GBL="^TMP(""SDPP"","_$J_")"
"RTN","DVBAB82",94,0)
 K:(SDTYP(7)=0) SDTYP(7)
"RTN","DVBAB82",95,0)
 D PRINT^SDPPRT
"RTN","DVBAB82",96,0)
 S VALMBCK="R"
"RTN","DVBAB82",97,0)
 Q
"RTN","DVBAB82",98,0)
ENDDT() ;Calculate end date for "all" date
"RTN","DVBAB82",99,0)
 N DVBAPPTS,DVBX
"RTN","DVBAB82",100,0)
 S DVBAPPTS(1)=2800101,DVBAPPTS(4)=DFN,DVBAPPTS("SORT")="P"
"RTN","DVBAB82",101,0)
 S DVBAPPTS("FLDS")=1,DVBAPPTS("MAX")=-1
"RTN","DVBAB82",102,0)
 S DVBX=$S(($$SDAPI^SDAMA301(.DVBAPPTS)>0):$O(^TMP($J,"SDAMA301",DFN,0)),1:DT_.24)
"RTN","DVBAB82",103,0)
 K ^TMP($J,"SDAMA301")
"RTN","DVBAB82",104,0)
 Q DVBX
"RTN","DVBAB82",105,0)
 ;
"RTN","DVBAB82",106,0)
VIEW ; Report # 9 - View Registration Data Report
"RTN","DVBAB82",107,0)
 ; Parameters
"RTN","DVBAB82",108,0)
 ; ==========
"RTN","DVBAB82",109,0)
 ; DFN : Patient Identification Number
"RTN","DVBAB82",110,0)
 ;
"RTN","DVBAB82",111,0)
 U IO
"RTN","DVBAB82",112,0)
 S DFN=$P(PARM,"^",1)
"RTN","DVBAB82",113,0)
 D VAL Q:DVBERR
"RTN","DVBAB82",114,0)
 D EN1^DGRP
"RTN","DVBAB82",115,0)
 Q
"RTN","DVBAB82",116,0)
 ;
"RTN","DVBAB82",117,0)
DSRP ; Report # 6 - Reprint a Notice of Discharge Report
"RTN","DVBAB82",118,0)
 ; Parameters
"RTN","DVBAB82",119,0)
 ; % : 1=Report on all veterans for a given day (BDATE required)
"RTN","DVBAB82",120,0)
 ;   : 0=Report on a single Veteran (DFN required)
"RTN","DVBAB82",121,0)
 ; BDATE : Original Processing Date - $H/FileMan
"RTN","DVBAB82",122,0)
 ; DFN  : Patient Identification Number
"RTN","DVBAB82",123,0)
 ;
"RTN","DVBAB82",124,0)
 N %,BDATE,DFN,DFNIEN
"RTN","DVBAB82",125,0)
 S %=$P(PARM,"^",1),BDATE=$P(PARM,"^",2),DFN=$P(PARM,"^",3),DFNIEN=""
"RTN","DVBAB82",126,0)
 I BDATE="" S DVBERR=1,^TMP("DVBA",$J,1)="0^Incorrect Date"  Q
"RTN","DVBAB82",127,0)
 D DUZ2^DVBAUTIL
"RTN","DVBAB82",128,0)
 U IO
"RTN","DVBAB82",129,0)
 D VAL Q:DVBERR
"RTN","DVBAB82",130,0)
 I %=1 D  Q
"RTN","DVBAB82",131,0)
 . S HD="SINGLE NOTICE OF DISCHARGE REPRINTING"
"RTN","DVBAB82",132,0)
 . D NOPARM^DVBAUTL2
"RTN","DVBAB82",133,0)
 . I $D(DVBAQUIT) D KILL^DVBAUTIL Q  ;CAUTION: Short-circuit
"RTN","DVBAB82",134,0)
 . S DTAR=^DVB(396.1,1,0),FDT(0)=$$FMTE^XLFDT(DT,"5DZ")
"RTN","DVBAB82",135,0)
 . S HEAD="NOTICE OF DISCHARGE",HEAD1="FOR "_$P(DTAR,U,1)_" ON "_FDT(0)
"RTN","DVBAB82",136,0)
 . I $D(^DVB(396.2,"B",DFN)) D
"RTN","DVBAB82",137,0)
 . . S DFNIEN=$O(^DVB(396.2,"B",DFN,DFNIEN)),ADM=$P(^DVB(396.2,DFNIEN,0),U,3)
"RTN","DVBAB82",138,0)
 . . I $D(^DGPM(+ADM,0)),$P(^(0),U,17)]"" S DCHPTR=$P(^DGPM(+ADM,0),U,17),DISCH=$S($P(^DGPM(DCHPTR,0),U,1)]"":$P(^(0),U,1),1:"") W ?($X+5),"Discharge date: ",$$FMTE^XLFDT(DISCH,"5DZ")
"RTN","DVBAB82",139,0)
 . . I $P(^DVB(396.2,DFNIEN,0),U,7)'=DVBAD2 W *7,!!,"This does not belong to your RO.",!! H 3 Q
"RTN","DVBAB82",140,0)
 . . I DFNIEN>0 S XDA=DFNIEN,DA=$P(^DVB(396.2,DFNIEN,0),U,1),ADMDT=$P(^DVB(396.2,DFNIEN,0),U,2),MB=$P(^(0),U,3)
"RTN","DVBAB82",141,0)
 . . D REPRINT^DVBADSNT
"RTN","DVBAB82",142,0)
 D DEQUE^DVBADSRP
"RTN","DVBAB82",143,0)
 Q
"RTN","DVBAB82",144,0)
 ;
"RTN","DVBAB82",145,0)
SPRPT ; Report # 8 - OP(Operation Report)
"RTN","DVBAB82",146,0)
 ;Parameters
"RTN","DVBAB82",147,0)
 ;=============
"RTN","DVBAB82",148,0)
 ; DFN : Patient Identification Number
"RTN","DVBAB82",149,0)
 ; SRTN : Select Operation
"RTN","DVBAB82",150,0)
 ;
"RTN","DVBAB82",151,0)
 N DFN,SRTN,MAGTMPR2,SRSITE
"RTN","DVBAB82",152,0)
 I $O(^SRO(133,1))'="B" S SRSITE=1
"RTN","DVBAB82",153,0)
 S DFN=$P(PARM,"^",1),SRTN=$P(PARM,"^",2),MAGTMPR2=1
"RTN","DVBAB82",154,0)
 D VAL Q:DVBERR
"RTN","DVBAB82",155,0)
 D ^SROPRPT
"RTN","DVBAB82",156,0)
 Q
"RTN","DVBAB82",157,0)
 ;
"RTN","DVBAB82",158,0)
CRPON ; Report # - 4 Reprint C&P Final Report
"RTN","DVBAB82",159,0)
 ;Parameters
"RTN","DVBAB82",160,0)
 ;=============
"RTN","DVBAB82",161,0)
 ; RTYPE : Select Reprint Option (D)ate or (V)eteran
"RTN","DVBAB82",162,0)
 ; RUNDATE : ORIGINAL PROCESSING date
"RTN","DVBAB82",163,0)
 ; ANS : Reprinted by the RO or MAS
"RTN","DVBAB82",164,0)
 ; % : LAB 1 OR 0
"RTN","DVBAB82",165,0)
 ; DA(1) : Patient IEN for lab results
"RTN","DVBAB82",166,0)
 ; DFN  : Patient Identification Number
"RTN","DVBAB82",167,0)
 ;
"RTN","DVBAB82",168,0)
 U IO
"RTN","DVBAB82",169,0)
 N ONE
"RTN","DVBAB82",170,0)
 S RTYPE=$P(PARM,"^",1),RUNDATE=$P(PARM,"^",2),ANS=$P(PARM,"^",3),%=$P(PARM,"^",4),DA(1)=$P(PARM,"^",5),DFN=$P(PARM,"^",6),DA=DA(1)
"RTN","DVBAB82",171,0)
 I RTYPE="V" D VAL Q:DVBERR
"RTN","DVBAB82",172,0)
 S XDD=^DD("DD"),$P(ULINE,"_",70)="_",ONE="N",Y=DT
"RTN","DVBAB82",173,0)
 X XDD S HD="Reprint C & P Exams",SUPER=0
"RTN","DVBAB82",174,0)
 I $D(^XUSEC("DVBA C SUPERVISOR",DUZ)) S SUPER=1
"RTN","DVBAB82",175,0)
 S DVBCDT(0)=Y,PGHD="Compensation and Pension Exam Report",LOC=DUZ(2),PG=0,DVBCSITE=$S($D(^DVB(396.1,1,0)):$P(^(0),U,1),1:"Not specified")
"RTN","DVBAB82",176,0)
 I "^D^V^"'[RTYPE S DVBERR=1,^TMP("DVBA",$J,1)="0^Incorrect Data Type" Q
"RTN","DVBAB82",177,0)
 I ANS="R" K AUTO
"RTN","DVBAB82",178,0)
 I ANS="M" S AUTO=1
"RTN","DVBAB82",179,0)
 I "^M^R^"'[ANS S DVBERR=1,^TMP("DVBA",$J,1)="0^Incorrect Data Type" Q
"RTN","DVBAB82",180,0)
 I RTYPE="D" D GO^DVBCRPRT Q
"RTN","DVBAB82",181,0)
 I RTYPE="V" D
"RTN","DVBAB82",182,0)
 . S ONE="Y",RO=$P(^DVB(396.3,DA,0),U,3)
"RTN","DVBAB82",183,0)
 . I RO'=DUZ(2)&('$D(AUTO))&(SUPER=0) W !!,*7,"Those results do not belong to your office.",!! Q
"RTN","DVBAB82",184,0)
 . I RO=DUZ(2)&('$D(AUTO))&("RC"'[($P(^DVB(396.3,DA,0),U,18))) W *7,!!,"This request has not been released to the Regional Office yet.",!! Q
"RTN","DVBAB82",185,0)
 . S PRTDATE=$P(^DVB(396.3,DA,0),U,16) I PRTDATE="" W *7,!!,"This has never been printed.",!! I SUPER=0 S OUT=1 Q
"RTN","DVBAB82",186,0)
 . I %=1 D REN2^DVBCLABR Q
"RTN","DVBAB82",187,0)
 . ;D OV^DVBCRPON
"RTN","DVBAB82",188,0)
 . K DVBAON2 D SETLAB^DVBCPRNT,VARS^DVBCUTIL,STEP2^DVBCRPRT
"RTN","DVBAB82",189,0)
 Q
"RTN","DVBAB82",190,0)
 ;
"RTN","DVBAB82",191,0)
VBACRPON ; Report # - 4 Reprint C&P Final Report by VBA personnel
"RTN","DVBAB82",192,0)
 ;Parameters
"RTN","DVBAB82",193,0)
 ;=============
"RTN","DVBAB82",194,0)
 ; RTYPE : Select Reprint Option (D)ate or (V)eteran
"RTN","DVBAB82",195,0)
 ; RUNDATE : ORIGINAL PROCESSING date
"RTN","DVBAB82",196,0)
 ; ANS : Reprinted by the RO or MAS
"RTN","DVBAB82",197,0)
 ; % : LAB 1 OR 0
"RTN","DVBAB82",198,0)
 ; DA(1) : Patient IEN for lab results
"RTN","DVBAB82",199,0)
 ; DFN  : Patient Identification Number
"RTN","DVBAB82",200,0)
 ;
"RTN","DVBAB82",201,0)
 S DVBERR=0
"RTN","DVBAB82",202,0)
 I $D(^TMP("DVBA",$J)) S DVBAX=(^TMP("DVBA",$J))
"RTN","DVBAB82",203,0)
 U IO
"RTN","DVBAB82",204,0)
 N ONE
"RTN","DVBAB82",205,0)
 S RTYPE=$P(PARM,"^",1),RUNDATE=$P(PARM,"^",2),ANS=$P(PARM,"^",3),%=$P(PARM,"^",4),DA(1)=$P(PARM,"^",5),DFN=$P(PARM,"^",6),DA=DA(1)
"RTN","DVBAB82",206,0)
 I RTYPE="V" D VAL Q:DVBERR
"RTN","DVBAB82",207,0)
 S XDD=^DD("DD"),$P(ULINE,"_",70)="_",ONE="N",Y=DT
"RTN","DVBAB82",208,0)
 X XDD S HD="Reprint C & P Exams"
"RTN","DVBAB82",209,0)
 S DVBCDT(0)=Y,PGHD="Compensation and Pension Exam Report",LOC=DUZ(2),PG=0,DVBCSITE=$S($D(^DVB(396.1,1,0)):$P(^(0),U,1),1:"Not specified")
"RTN","DVBAB82",210,0)
 I "^D^V^"'[RTYPE S DVBERR=1,^TMP("DVBA",$J,1)="0^Incorrect Data Type" Q
"RTN","DVBAB82",211,0)
 I ANS="R" K AUTO
"RTN","DVBAB82",212,0)
 I ANS="M" S AUTO=1
"RTN","DVBAB82",213,0)
 I "^M^R^"'[ANS S DVBERR=1,^TMP("DVBA",$J,1)="0^Incorrect Data Type" Q
"RTN","DVBAB82",214,0)
 I RTYPE="D" D VBAGO^DVBCRPRT Q
"RTN","DVBAB82",215,0)
 I RTYPE="V" D
"RTN","DVBAB82",216,0)
 . S ONE="Y",RO=$P(^DVB(396.3,DA,0),U,3)
"RTN","DVBAB82",217,0)
 . S PRTDATE=$P(^DVB(396.3,DA,0),U,16)
"RTN","DVBAB82",218,0)
 . I %=1 D REN2^DVBCLABR Q
"RTN","DVBAB82",219,0)
 . K DVBAON2 D SETLAB^DVBCPRNT,VARS^DVBCUTIL,VBASTEP2^DVBCRPRT
"RTN","DVBAB82",220,0)
 Q
"RTN","DVBAB82",221,0)
 ;
"RTN","DVBAB82",222,0)
CIRPT ; Report # 5 - Insufficient Exam Report
"RTN","DVBAB82",223,0)
 ;Parameters
"RTN","DVBAB82",224,0)
 ;=============
"RTN","DVBAB82",225,0)
 ; RPTTYPE : D/Detailed or S/Summary
"RTN","DVBAB82",226,0)
 ; BEGDT : Beginning date $H/FileMan
"RTN","DVBAB82",227,0)
 ; ENDDT : Ending date $H/FileMan
"RTN","DVBAB82",228,0)
 ; RESANS : Insufficient Reason
"RTN","DVBAB82",229,0)
 ; DVBAPRTY : Priority of Exam Code
"RTN","DVBAB82",230,0)
 ;    AO  : Agent Orange
"RTN","DVBAB82",231,0)
 ;    BDD : Benefits Delivery at Discharge / Quick Start
"RTN","DVBAB82",232,0)
 ;    IDES : Integrated Disability Evaluation System
"RTN","DVBAB82",233,0)
 ;    ALL : All Others (Original Report w/ all codes except the above)
"RTN","DVBAB82",234,0)
 ; DVBADLMTR: 0=non-delimted format, ","=delimiter for .csv file for EXCEL
"RTN","DVBAB82",235,0)
 ;
"RTN","DVBAB82",236,0)
 N DVBAPRTY,RPTTYPE,BEGDT,ENDDT,RESANS
"RTN","DVBAB82",237,0)
 U IO
"RTN","DVBAB82",238,0)
 S RPTTYPE=$P(PARM,"^",1),BEGDT=$P(PARM,"^",2),ENDDT=$P(PARM,"^",3),RESANS=""
"RTN","DVBAB82",239,0)
 S DVBADLMTR=$P(PARM,"^",6),DVBADLMTR=$S(DVBADLMTR=1:",",1:0)
"RTN","DVBAB82",240,0)
 S ENDDT=ENDDT_".2359"
"RTN","DVBAB82",241,0)
 I RPTTYPE="S" D SUM^DVBCIRP2 Q
"RTN","DVBAB82",242,0)
 I RPTTYPE="D" D
"RTN","DVBAB82",243,0)
 . D INREAS
"RTN","DVBAB82",244,0)
 . Q:($D(^TMP("DVBA",$J,1)))  ;invalid reason sent
"RTN","DVBAB82",245,0)
 . D EXMTPE,DETAIL^DVBCIRP2
"RTN","DVBAB82",246,0)
 Q
"RTN","DVBAB82",247,0)
 ;
"RTN","DVBAB82",248,0)
EXMTPE ;exam types (retrieve all for filter)
"RTN","DVBAB82",249,0)
 N DVBAXIFN
"RTN","DVBAB82",250,0)
 F DVBAXIFN=0:0 S DVBAXIFN=$O(^DVB(396.6,DVBAXIFN)) Q:+DVBAXIFN=0  DO
"RTN","DVBAB82",251,0)
 . S ^TMP($J,"XMTYPE",DVBAXIFN)=""
"RTN","DVBAB82",252,0)
 Q
"RTN","DVBAB82",253,0)
INREAS ;insufficient reason (validate specific or retrieve all)
"RTN","DVBAB82",254,0)
 N DVBAXIFN
"RTN","DVBAB82",255,0)
 D:(RESANS="")  ;use all insufficient reasons
"RTN","DVBAB82",256,0)
 .F DVBAXIFN=0:0 S DVBAXIFN=$O(^DVB(396.94,DVBAXIFN)) Q:+DVBAXIFN=0  DO
"RTN","DVBAB82",257,0)
 .. S DVBAARY("REASON",DVBAXIFN)=""
"RTN","DVBAB82",258,0)
 ;D:(RESANS'="")  ;use specific insufficient reason
"RTN","DVBAB82",259,0)
 ;.I ('$D(^DVB(396.94,+RESANS))) D  ;validate IEN
"RTN","DVBAB82",260,0)
 ;..S DVBERR=1,^TMP("DVBA",$J,1)="0^Invalid Insufficient Reason IEN"
"RTN","DVBAB82",261,0)
 ;.E  S DVBAARY("REASON",+RESANS)=""
"RTN","DVBAB82",262,0)
 Q
"RTN","DVBAB82",263,0)
 ;
"RTN","DVBAB82",264,0)
CRMS ; Report # 1 - Regional Office 21- day Certificate Printing Report.
"RTN","DVBAB82",265,0)
 ; No Parameters
"RTN","DVBAB82",266,0)
 ;
"RTN","DVBAB82",267,0)
 U IO
"RTN","DVBAB82",268,0)
 D ^DVBACRMS
"RTN","DVBAB82",269,0)
 Q
"RTN","DVBAB82",270,0)
 ;
"RTN","DVBAB82",271,0)
CRRR ; Report # 2 - Reprint a 21 - day Certificate for the RO
"RTN","DVBAB82",272,0)
 ;Parameters
"RTN","DVBAB82",273,0)
 ;=============
"RTN","DVBAB82",274,0)
 ; DVBSEL : Select one of the following:
"RTN","DVBAB82",275,0)
 ;       N         Patient Name
"RTN","DVBAB82",276,0)
 ;       D         ORIGINAL PROCESSING DATE
"RTN","DVBAB82",277,0)
 ; SDATE : ORIGINAL PROCESSING date - $H/FileMan
"RTN","DVBAB82",278,0)
 ; XDA : Patient IEN
"RTN","DVBAB82",279,0)
 ;
"RTN","DVBAB82",280,0)
 U IO
"RTN","DVBAB82",281,0)
 S DVBSEL=$P(PARM,"^",1),SDATE=$P(PARM,"^",2),XDA=$P(PARM,"^",3)
"RTN","DVBAB82",282,0)
 I "^D^N^"'[DVBSEL S DVBERR=1,^TMP("DVBA",$J,1)="0^Incorrect Data Type" Q
"RTN","DVBAB82",283,0)
 I DVBSEL="D" D  I DVBERR Q
"RTN","DVBAB82",284,0)
 . I SDATE="" S DVBERR=1,^TMP("DVBA",$J,1)="0^Undefined Date" Q
"RTN","DVBAB82",285,0)
 . S %DT="X" S X=SDATE D ^%DT I Y<0 D  Q
"RTN","DVBAB82",286,0)
 . . S DVBERR=1,^TMP("DVBA",$J,1)="0^Incorrect Date Format"
"RTN","DVBAB82",287,0)
 I DVBSEL="N" D  I DVBERR Q
"RTN","DVBAB82",288,0)
 . I XDA="" S DVBERR=1,^TMP("DVBA",$J,1)="0^Undefined Patient IEN" Q
"RTN","DVBAB82",289,0)
 . S DIC=2,DIC(0)="NZX",X=XDA D ^DIC I Y<0 D  I DVBERR Q
"RTN","DVBAB82",290,0)
 . . S DVBERR=1,^TMP("DVBA",$J,1)="0^Invalid Patient Name."
"RTN","DVBAB82",291,0)
 . S DFN=XDA
"RTN","DVBAB82",292,0)
 D INIT^DVBACRRR I 'CONT Q
"RTN","DVBAB82",293,0)
 D HDR^DVBACRRR,DATA^DVBACRRR
"RTN","DVBAB82",294,0)
 Q
"RTN","DVBAB82",295,0)
 ;
"RTN","DVBAB82",296,0)
CPRNT ; Report # 3 - Print C&P Final Report (manual) Report
"RTN","DVBAB82",297,0)
 ; No Parameters
"RTN","DVBAB82",298,0)
 ;
"RTN","DVBAB82",299,0)
 S XDD=^DD("DD"),$P(ULINE,"_",70)="_",Y=DT
"RTN","DVBAB82",300,0)
 X XDD S DVBCDT(0)=Y,PGHD="Compensation and Pension Exam Report",DVBCSITE=$S($D(^DVB(396.1,1,0)):$P(^(0),U,1),1:"Not Specified")
"RTN","DVBAB82",301,0)
 D GO^DVBCPRNT
"RTN","DVBAB82",302,0)
 Q
"RTN","DVBAB82",303,0)
VAL ; VALIDATE PATIENT
"RTN","DVBAB82",304,0)
 I $G(DFN)="" S DVBERR=1,^TMP("DVBA",$J,1)="0^Undefined Patient IEN" G END
"RTN","DVBAB82",305,0)
 S DIC=2,DIC(0)="NZX",X=DFN D ^DIC
"RTN","DVBAB82",306,0)
 I Y<0 S DVBERR=1,^TMP("DVBA",$J,1)="0^Invalid Patient Name." G END
"RTN","DVBAB82",307,0)
 Q
"RTN","DVBAB82",308,0)
 ;
"RTN","DVBAB82",309,0)
VALDATE(DVBADTE) ;Validate Date
"RTN","DVBAB82",310,0)
 ;dates must be valid internal FileMan format
"RTN","DVBAB82",311,0)
 N X,Y,%DT
"RTN","DVBAB82",312,0)
 S %DT="X",X=DVBADTE D ^%DT
"RTN","DVBAB82",313,0)
 S:(Y=-1) DVBERR=1,^TMP("DVBA",$J,1)="0^Invalid FileMan formatted date."
"RTN","DVBAB82",314,0)
 Q
"RTN","DVBAB82",315,0)
 ;
"RTN","DVBAB82",316,0)
CNHDEOC ; Report #10 - FBCNH Display Episode of Care
"RTN","DVBAB82",317,0)
 ; Parameters
"RTN","DVBAB82",318,0)
 ; ==========
"RTN","DVBAB82",319,0)
 ;   DFN : IEN in PATIENT (#2) file
"RTN","DVBAB82",320,0)
 ;   IFN : IEN in FEE CNH ACTIVITY (#162.3) file
"RTN","DVBAB82",321,0)
 ;
"RTN","DVBAB82",322,0)
 U IO
"RTN","DVBAB82",323,0)
 N DFN,IFN
"RTN","DVBAB82",324,0)
 S DFN=$P(PARM,U,1),IFN=$P(PARM,U,2)
"RTN","DVBAB82",325,0)
 D ^FBNHDEC  ;DBIA#: 5566
"RTN","DVBAB82",326,0)
 Q
"RTN","DVBAB82",327,0)
 ;
"RTN","DVBAB82",328,0)
CNHRP ; Report #11 - FBCNH Roster Print
"RTN","DVBAB82",329,0)
 ; Parameters
"RTN","DVBAB82",330,0)
 ; ==========
"RTN","DVBAB82",331,0)
 ;   DVBADLMTD : 0 (Standard) or 1 (Delimited)
"RTN","DVBAB82",332,0)
 ; 
"RTN","DVBAB82",333,0)
 U IO
"RTN","DVBAB82",334,0)
 S DVBADLMTD=+$P($G(PARM),U)
"RTN","DVBAB82",335,0)
 D START^FBNHROS  ;DBIA#: 5566
"RTN","DVBAB82",336,0)
 Q
"RTN","DVBAB82",337,0)
 ;
"RTN","DVBAB82",338,0)
CNHRAD ; Report #12 - FBCNH Report of Admissions/Discharges
"RTN","DVBAB82",339,0)
 ; Parameters
"RTN","DVBAB82",340,0)
 ; ==========
"RTN","DVBAB82",341,0)
 ;   BEGDATE   : Start date in FM format
"RTN","DVBAB82",342,0)
 ;   ENDDATE   : End date in FM format
"RTN","DVBAB82",343,0)
 ;   DVBADLMTD : 0 (Standard) or 1 (Delimited)
"RTN","DVBAB82",344,0)
 ;
"RTN","DVBAB82",345,0)
 U IO
"RTN","DVBAB82",346,0)
 N BEGDATE,ENDDATE
"RTN","DVBAB82",347,0)
 S BEGDATE=$P(PARM,U,1),ENDDATE=$P(PARM,U,2)
"RTN","DVBAB82",348,0)
 S DVBADLMTD=+$P(PARM,U,3)
"RTN","DVBAB82",349,0)
 D VALDATE(BEGDATE),VALDATE(ENDDATE)
"RTN","DVBAB82",350,0)
 D:('+DVBERR) START^FBNHAMIE  ;DBIA#: 5566
"RTN","DVBAB82",351,0)
 Q
"RTN","DVBAB82",352,0)
 ;
"RTN","DVBAB82",353,0)
CNHSE90D ; Report #13 - FBCNH Stays in Excess of 90 Days
"RTN","DVBAB82",354,0)
 ; Parameters
"RTN","DVBAB82",355,0)
 ; ==========
"RTN","DVBAB82",356,0)
 ;   FBDT      : Effective date in FM format
"RTN","DVBAB82",357,0)
 ;   DVBADLMTD : 0 (Standard) or 1 (Delimited)
"RTN","DVBAB82",358,0)
 ;
"RTN","DVBAB82",359,0)
 U IO
"RTN","DVBAB82",360,0)
 N FBDT
"RTN","DVBAB82",361,0)
 S FBDT=$P(PARM,U,1),DVBADLMTD=+$P(PARM,U,2)
"RTN","DVBAB82",362,0)
 D VALDATE(FBDT)
"RTN","DVBAB82",363,0)
 D:('+DVBERR) START^FBNHAMI2  ;DBIA#: 5566
"RTN","DVBAB82",364,0)
 Q
"RTN","DVBAB82",365,0)
 ;
"RTN","DVBAB82",366,0)
HFS() ; -- get hfs file name
"RTN","DVBAB82",367,0)
 N H
"RTN","DVBAB82",368,0)
 S H=$H
"RTN","DVBAB82",369,0)
 Q "DVBA_"_$J_"_"_$P(H,",")_"_"_$P(H,",",2)_".DAT"
"RTN","DVBAB82",370,0)
 ;
"RTN","DVBAB82",371,0)
HFSOPEN(HANDLE,DVBHFS,DVBMODE) ; Open File
"RTN","DVBAB82",372,0)
 S DVBDIRY=$$GET^XPAR("DIV","DVB HFS SCRATCH")
"RTN","DVBAB82",373,0)
 ;I DVBDIRY="" S ECERR=1 D  Q
"RTN","DVBAB82",374,0)
 ;. S ^TMP("DVBA",$J,1)="0^A scratch directory for reports doesn't exist"
"RTN","DVBAB82",375,0)
 D OPEN^%ZISH(HANDLE,,DVBHFS,$G(DVBMODE,"W")) D:POP  Q:POP
"RTN","DVBAB82",376,0)
 .S DVBERR=1,^TMP("DVBA",$J,1)="0^Unable to open file "
"RTN","DVBAB82",377,0)
 S IOF="$$IOF^DVBAB82"   ;resets screen position and adds page break flag - added to deal with Linux environments.
"RTN","DVBAB82",378,0)
 Q
"RTN","DVBAB82",379,0)
 ;
"RTN","DVBAB82",380,0)
HFSCLOSE(HANDLE,DVBHFS) ;Close HFS and unload data
"RTN","DVBAB82",381,0)
 N DVBDEL,X,%ZIS
"RTN","DVBAB82",382,0)
 D CLOSE^%ZISH(HANDLE)
"RTN","DVBAB82",383,0)
 S DVBDEL(DVBHFS)=""
"RTN","DVBAB82",384,0)
 S ROOT=$NA(^TMP("DVBA",$J,1))
"RTN","DVBAB82",385,0)
 K:('+DVBERR) @ROOT
"RTN","DVBAB82",386,0)
 S X=$$FTG^%ZISH(,DVBHFS,$NA(@ROOT@(1)),4)
"RTN","DVBAB82",387,0)
 S X=$$DEL^%ZISH(,$NA(DVBDEL))
"RTN","DVBAB82",388,0)
 Q
"RTN","DVBAB82",389,0)
 ;
"RTN","DVBAB82",390,0)
IOF() ;used to reset position and insert page break flag when @IOF is executed.
"RTN","DVBAB82",391,0)
 S $X=0,$Y=0
"RTN","DVBAB82",392,0)
 Q "##FFFF##"_$C(13,10)
"RTN","DVBAB82",393,0)
 ;
"RTN","DVBAB82",394,0)
REQSTAT ; Report #14 - Request Status by Date Range
"RTN","DVBAB82",395,0)
 ; Parameters
"RTN","DVBAB82",396,0)
 ; ==========
"RTN","DVBAB82",397,0)
 ; BEGDAT        : Start date in FM format
"RTN","DVBAB82",398,0)
 ; ENDDAT        : End date in FM format
"RTN","DVBAB82",399,0)
 ; REQSTAT       : Request Status filter
"RTN","DVBAB82",400,0)
 ; ISDELIM       : 0 (Standard format); 1 (Delimited format)
"RTN","DVBAB82",401,0)
 ; ISNODT        : 0 (Use date range); 1 (Ignore date range)
"RTN","DVBAB82",402,0)
 U IO
"RTN","DVBAB82",403,0)
 N BEGDAT,ENDDAT,REQSTAT
"RTN","DVBAB82",404,0)
 S BEGDAT=$P(PARM,U,1),ENDDAT=$P(PARM,U,2)
"RTN","DVBAB82",405,0)
 S REQSTAT=$P(PARM,U,3),ISDELIM=$P(PARM,U,4),ISNODT=$P(PARM,U,5)
"RTN","DVBAB82",406,0)
 D VALDATE(BEGDAT),VALDATE(ENDDAT)
"RTN","DVBAB82",407,0)
 D:('+DVBERR) REQSTAT^DVBARSBD(BEGDAT,ENDDAT,REQSTAT,ISDELIM,ISNODT)
"RTN","DVBAB82",408,0)
 Q
"RTN","DVBAB82",409,0)
 ;
"RTN","DVBAB82",410,0)
DVBA8861 ; Report #15 - Form 28-8861 Status Report
"RTN","DVBAB82",411,0)
 ; Parameters
"RTN","DVBAB82",412,0)
 ; ==========
"RTN","DVBAB82",413,0)
 ; BEGDAT  -  Start date in FM format
"RTN","DVBAB82",414,0)
 ; ENDDAT  -  End date in FM format
"RTN","DVBAB82",415,0)
 ; ROSTAT  -  Regional Office filter
"RTN","DVBAB82",416,0)
 ; REQSTAT -  Request Status filter
"RTN","DVBAB82",417,0)
 ; DELIMTER - 0 (Standard format); 1 (Delimited format)
"RTN","DVBAB82",418,0)
 ;
"RTN","DVBAB82",419,0)
 U IO
"RTN","DVBAB82",420,0)
 N BEGDAT,ENDDAT,REQSTAT
"RTN","DVBAB82",421,0)
 S BEGDAT=$P(PARM,U,1),ENDDAT=$P(PARM,U,2)
"RTN","DVBAB82",422,0)
 S ROSTAT=$P(PARM,U,3),REQSTAT=$P(PARM,U,4),DELIMTER=$P(PARM,U,5)
"RTN","DVBAB82",423,0)
 D VALDATE(BEGDAT),VALDATE(ENDDAT)
"RTN","DVBAB82",424,0)
 D:('+DVBERR) STATRPT^DVBA8861(BEGDAT,ENDDAT,ROSTAT,REQSTAT,DELIMTER)
"RTN","DVBAB82",425,0)
 Q
"RTN","DVBABEBD")
0^4^B13866320^B8904032
"RTN","DVBABEBD",1,0)
DVBABEBD ;ALB - CAPRI EXAM BY DATE REPORT;09/13/04 ; 2/10/11 12:12pm
"RTN","DVBABEBD",2,0)
 ;;2.7;AMIE;**57,108,185,190,192**;Apr 10, 1995;Build 15
"RTN","DVBABEBD",3,0)
 ;ALB/RTW - 192 added Claim Type,and Special Consideration(s)
"RTN","DVBABEBD",4,0)
 Q
"RTN","DVBABEBD",5,0)
 ;
"RTN","DVBABEBD",6,0)
EXAMBYDT(MSG,BEGDT,ENDDT,DVBADLMTR) ; CALLED BY REMOTE PROCEDURE DVBAB EXAMS BY DATE
"RTN","DVBABEBD",7,0)
 N DVBABCNT,DVBABIEN,DVBABPAT,DVBABT,DVBAB0,DVBABT1,DVBABT2,DVBABT3,DVBABT4,DVBABT5,DVBABT6,DFN
"RTN","DVBABEBD",8,0)
 N DVBAA,DVBCNT,DVBX,DVBAD,DVBCTN,DVBCTW,DVBSC,DVBSCC,DVBSCN,DVBSCNS,DVBSCW,DVBSCWA
"RTN","DVBABEBD",9,0)
 S DVBADLMTR=$S($G(DVBADLMTR)=1:",",1:0)
"RTN","DVBABEBD",10,0)
 S DVBAD=DVBADLMTR
"RTN","DVBABEBD",11,0)
 K ^TMP("DVBABEBD",DUZ) D SETSTAT
"RTN","DVBABEBD",12,0)
 I $G(DVBAD)="," D
"RTN","DVBABEBD",13,0)
 . S ^TMP("DVBABEBD",DUZ,1)="SSN"_DVBAD_"PATIENT NAME"_DVBAD_"REQUEST DATE"_DVBAD_"DATE RELEASED"_DVBAD_"DATE PRINTED BY RO"_DVBAD_"REQUEST STATUS"_DVBAD_"CLAIM TYPE"_DVBAD_"SPECIAL CONSIDERATION(S)"_$C(13)
"RTN","DVBABEBD",14,0)
 S DVBABCNT=$S(DVBAD'=",":1,1:2),DVBABIEN=0,MSG=$NA(^TMP("DVBABEBD",DUZ))
"RTN","DVBABEBD",15,0)
 F  S DVBABIEN=$O(^DVB(396.3,DVBABIEN)) Q:+DVBABIEN=0  D
"RTN","DVBABEBD",16,0)
 . ;REQUEST DATE
"RTN","DVBABEBD",17,0)
 . S DVBAB0=$G(^DVB(396.3,DVBABIEN,0)) Q:DVBAB0=""
"RTN","DVBABEBD",18,0)
 . S DVBABPAT=$G(^DPT($P(DVBAB0,"^"),0)) Q:DVBABPAT=""
"RTN","DVBABEBD",19,0)
 . S DVBABT2=$P($P(DVBAB0,"^",2),".")
"RTN","DVBABEBD",20,0)
 . I (DVBABT2>(BEGDT-1))&(DVBABT2<(ENDDT+1)) D
"RTN","DVBABEBD",21,0)
 .. S DVBABT1=$P(DVBABPAT,"^",1) ;PATIENT NAME
"RTN","DVBABEBD",22,0)
 .. S DFN=$P(DVBAB0,"^") D DEM^VADPT I $G(VADM(1))'="" S DVBABT6=$S($G(DVBAD)=",":$P($G(VADM(2)),U,2),1:$P($G(VADM(2)),U,1))  ;SSN
"RTN","DVBABEBD",23,0)
 .. S DVBABT3=$P($P(DVBAB0,"^",14),".") ;DATE RELEASED
"RTN","DVBABEBD",24,0)
 .. S DVBABT4=$P($P(DVBAB0,"^",16),".") ;DATE PRINTED BY RO
"RTN","DVBABEBD",25,0)
 .. S DVBABT5=$P(DVBAB0,"^",18) ;REQUEST STATUS
"RTN","DVBABEBD",26,0)
 .. S (DVBCTW,DVBSCWA)="" D CLAIMTYP,SPEC
"RTN","DVBABEBD",27,0)
 .. S:$D(DVBABT(DVBABT5)) DVBABT5=DVBABT(DVBABT5)
"RTN","DVBABEBD",28,0)
 .. S DVBABT2=$$FMTE^XLFDT(DVBABT2,"5DZ"),DVBABT3=$$FMTE^XLFDT(DVBABT3,"5DZ"),DVBABT4=$$FMTE^XLFDT(DVBABT4,"5DZ")
"RTN","DVBABEBD",29,0)
 .. I $G(DVBAD)'="," S ^TMP("DVBABEBD",DUZ,DVBABCNT)=DVBABT1_U_DVBABT2_U_DVBABT3_U_DVBABT4_U_DVBABT5_U_DVBABT6_U_DVBCTW_U_DVBSCWA_$C(13)
"RTN","DVBABEBD",30,0)
 .. I $G(DVBAD)="," S ^TMP("DVBABEBD",DUZ,DVBABCNT)=DVBABT6_DVBADLMTR_""""_DVBABT1_""""_DVBADLMTR_$$FMTE^XLFDT(DVBABT2,"5DZ")_DVBADLMTR_$$FMTE^XLFDT(DVBABT3,"5DZ")_DVBADLMTR_$$FMTE^XLFDT(DVBABT4,"5DZ") D
"RTN","DVBABEBD",31,0)
 .. .S ^TMP("DVBABEBD",DUZ,DVBABCNT)=^TMP("DVBABEBD",DUZ,DVBABCNT)_DVBADLMTR_""""_DVBABT5_""""_DVBAD_""""_DVBCTW_""""_DVBAD_""""_DVBSCWA_""""_$C(13)
"RTN","DVBABEBD",32,0)
 .. S DVBABCNT=DVBABCNT+1
"RTN","DVBABEBD",33,0)
 Q
"RTN","DVBABEBD",34,0)
 ;
"RTN","DVBABEBD",35,0)
SETSTAT S DVBABT("N")="NEW"
"RTN","DVBABEBD",36,0)
 S DVBABT("P")="PENDING, REPORTED"
"RTN","DVBABEBD",37,0)
 S DVBABT("S")="PENDING, SCHEDULED"
"RTN","DVBABEBD",38,0)
 S DVBABT("R")="RELEASED TO RO, NOT PRINTED"
"RTN","DVBABEBD",39,0)
 S DVBABT("C")="COMPLETED, PRINTED BY RO"
"RTN","DVBABEBD",40,0)
 S DVBABT("X")="CANCELLED BY MAS"
"RTN","DVBABEBD",41,0)
 S DVBABT("RX")="CANCELLED BY RO"
"RTN","DVBABEBD",42,0)
 S DVBABT("T")="TRANSCRIBED"
"RTN","DVBABEBD",43,0)
 S DVBABT("NT")="NEW, TRANSFERRED IN"
"RTN","DVBABEBD",44,0)
 S DVBABT("CT")="COMPLETE, TRANSFERRED OUT"
"RTN","DVBABEBD",45,0)
 Q
"RTN","DVBABEBD",46,0)
CLAIMTYP ;THE CLAIM TYPE OF A 2507 REQUEST
"RTN","DVBABEBD",47,0)
 S DVBCTW=""
"RTN","DVBABEBD",48,0)
 Q:'$D(^DVB(396.3,DVBABIEN,9,0))
"RTN","DVBABEBD",49,0)
 ;DVBIEN is the 2507 REQUEST FILE IEN
"RTN","DVBABEBD",50,0)
 ;DVBCTW is the string /name of the CLAIM TYPE
"RTN","DVBABEBD",51,0)
 D GETS^DIQ(396.3,DVBABIEN_",","9.1*","E","MSG","ERR")
"RTN","DVBABEBD",52,0)
 S DVBCTW=MSG("396.32","1,"_DVBABIEN_",",".01","E")
"RTN","DVBABEBD",53,0)
 Q
"RTN","DVBABEBD",54,0)
 ;
"RTN","DVBABEBD",55,0)
SPEC ;SPECIAL CONSIDERATION(S) FOR A 2507 REQUEST
"RTN","DVBABEBD",56,0)
 K DVBSCW
"RTN","DVBABEBD",57,0)
 S DVBSCWA=""
"RTN","DVBABEBD",58,0)
 Q:'$D(^DVB(396.3,DVBABIEN,8))
"RTN","DVBABEBD",59,0)
 ;DVBABIEN is the 2507 REQUEST FILE IEN
"RTN","DVBABEBD",60,0)
 ;DVBSC is a the SPECIAL CONSIDERATION entry for the 2507 REQUEST
"RTN","DVBABEBD",61,0)
 ;DVBSCN is the pointer number to the SPECIAL CONSIDERATION file 396.25
"RTN","DVBABEBD",62,0)
 ;DVBSCW is the string /name of the SPECIAL CONSIDERATION
"RTN","DVBABEBD",63,0)
 S DVBAA=$P(^DVB(396.3,DVBABIEN,8,0),U,4)
"RTN","DVBABEBD",64,0)
 S (DVBSC,DVBCNT)=0 F  S DVBSC=$O(^DVB(396.3,DVBABIEN,8,DVBSC)) Q:'DVBSC  D
"RTN","DVBABEBD",65,0)
 .S DVBSCN=$P(^DVB(396.3,DVBABIEN,8,DVBSC,0),U,1)
"RTN","DVBABEBD",66,0)
 .S DVBSCW(DVBSC)=$G(^DVB(396.25,DVBSCN,0))
"RTN","DVBABEBD",67,0)
 .S DVBCNT=DVBCNT+1
"RTN","DVBABEBD",68,0)
 .I (DVBCNT'=DVBAA) S:$D(DVBSCW(DVBSC)) DVBSCW(DVBSC)=DVBSCW(DVBSC)_","
"RTN","DVBABEBD",69,0)
 S DVBX="" F  S DVBX=$O(DVBSCW(DVBX)) Q:'DVBX  S DVBSCWA=DVBSCWA_DVBSCW(DVBX)
"RTN","DVBABEBD",70,0)
 Q
"RTN","DVBABURL")
0^6^B7872092^B7360044
"RTN","DVBABURL",1,0)
DVBABURL ;ALB/SPH - CAPRI URL ;14/MAY/2012
"RTN","DVBABURL",2,0)
 ;;2.7;AMIE;**104,136,143,149,168,181,186,192**;Apr 10, 1995;Build 15
"RTN","DVBABURL",3,0)
 ;ALB/RTW - added 7=VICAP website
"RTN","DVBABURL",4,0)
 ;
"RTN","DVBABURL",5,0)
URL(Y,WHICH) ;
"RTN","DVBABURL",6,0)
 ;This procedure supports the DVBAB GET URL remote procedure 
"RTN","DVBABURL",7,0)
 S Y=""
"RTN","DVBABURL",8,0)
 ; 1=VBA's AMIE Worksheet Website
"RTN","DVBABURL",9,0)
 ; 2=CAPRI training website
"RTN","DVBABURL",10,0)
 ; 3=VistAWeb website
"RTN","DVBABURL",11,0)
 ; 5=HIA download website
"RTN","DVBABURL",12,0)
 ; 6=VIRTUAL VA web service server
"RTN","DVBABURL",13,0)
 ; 7=VICAP website
"RTN","DVBABURL",14,0)
 ; 8=VLER DAS web service server
"RTN","DVBABURL",15,0)
 ; 999=Debug/Test Code
"RTN","DVBABURL",16,0)
 I WHICH=1 S Y="http://152.124.238.193/bl/21/rating/Medical/exams/index.htm"
"RTN","DVBABURL",17,0)
 I WHICH=2 S Y="http://vaww.demo.domain.ext/"
"RTN","DVBABURL",18,0)
 I WHICH=3 D
"RTN","DVBABURL",19,0)
 . I '$$PROD^XUPROD S Y="-1^VistAWeb disabled for non-production systems." Q
"RTN","DVBABURL",20,0)
 . S Y="https://vistaweb.domain.ext/CapriPage.aspx"
"RTN","DVBABURL",21,0)
 I WHICH=4 S Y="M21-1, Part VI, Rating Board Procedures^http://152.124.238.193/bl/21/Publicat/Manuals/Part6/601.htm#Exam"
"RTN","DVBABURL",22,0)
 I WHICH=5 S Y=$$GET^XPAR("PKG","DVBAB CAPRI HIA UPDATE URL",1,"Q")
"RTN","DVBABURL",23,0)
 I WHICH=6 D  ;Virtual VA web service server
"RTN","DVBABURL",24,0)
 . I $$PROD^XUPROD D
"RTN","DVBABURL",25,0)
 . . S Y=$$GET^XPAR("PKG","DVBAB CAPRI VIRTUALVA PROD URL",1,"Q")
"RTN","DVBABURL",26,0)
 . E  D
"RTN","DVBABURL",27,0)
 . . S Y=$$GET^XPAR("PKG","DVBAB CAPRI VIRTUALVA TEST URL",1,"Q")
"RTN","DVBABURL",28,0)
 I WHICH=7 S Y=$$GET^XPAR("PKG","DVBAB CAPRI VICAP URL",1,"Q")
"RTN","DVBABURL",29,0)
 I WHICH=8 D  ;VLER DAS web service server
"RTN","DVBABURL",30,0)
 . I $$PROD^XUPROD D
"RTN","DVBABURL",31,0)
 . . S Y=$$GET^XPAR("PKG","DVBAB CAPRI VLER DAS PROD URL",1,"Q")
"RTN","DVBABURL",32,0)
 . E  D
"RTN","DVBABURL",33,0)
 . . S Y=$$GET^XPAR("PKG","DVBAB CAPRI VLER DAS CH3 URL",1,"Q")
"RTN","DVBABURL",34,0)
 I WHICH=999 S Y="http://vhaannweb2.v11.domain.ext/VwDesktop/CapriPage.aspx"
"RTN","DVBABURL",35,0)
 Q
"RTN","DVBABURL",36,0)
 ;
"RTN","DVBABURL",37,0)
VVATOKEN(DVBAUTH) ;retrieve and return the Virtual VA authorization credentials
"RTN","DVBABURL",38,0)
 ;This procedure supports the DVBA GET VVA TOKEN remote procedure and
"RTN","DVBABURL",39,0)
 ;retrieves the user, password, and token value required to login to the Virtual
"RTN","DVBABURL",40,0)
 ;VA web service.  The procedure supports returning differerent values based on
"RTN","DVBABURL",41,0)
 ;whether the system is a production system or a test/development system.
"RTN","DVBABURL",42,0)
 ;  
"RTN","DVBABURL",43,0)
 ; Returns user^password^token on success; otherwise returns ""
"RTN","DVBABURL",44,0)
 ; Example: "capri^XXXXX^Username-1"
"RTN","DVBABURL",45,0)
 ;
"RTN","DVBABURL",46,0)
 N DVBUSER
"RTN","DVBABURL",47,0)
 N DVBPWD
"RTN","DVBABURL",48,0)
 N DVBTOKEN
"RTN","DVBABURL",49,0)
 ;
"RTN","DVBABURL",50,0)
 I $$PROD^XUPROD D  ;return values for production system
"RTN","DVBABURL",51,0)
 . S DVBUSER=$$GET^XPAR("PKG","DVBAB CAPRI VVA USER",1,"Q")
"RTN","DVBABURL",52,0)
 . S DVBPWD=$$GET^XPAR("PKG","DVBAB CAPRI VVA PROD PASSWD",1,"Q")
"RTN","DVBABURL",53,0)
 . S DVBTOKEN=$$GET^XPAR("PKG","DVBAB CAPRI VVA PROD TOKEN",1,"Q")
"RTN","DVBABURL",54,0)
 E  D  ;return values for test/development system
"RTN","DVBABURL",55,0)
 . S DVBUSER=$$GET^XPAR("PKG","DVBAB CAPRI VVA USER",1,"Q")
"RTN","DVBABURL",56,0)
 . S DVBPWD=$$GET^XPAR("PKG","DVBAB CAPRI VVA TEST PASSWD",1,"Q")
"RTN","DVBABURL",57,0)
 . S DVBTOKEN=$$GET^XPAR("PKG","DVBAB CAPRI VVA TEST TOKEN",1,"Q")
"RTN","DVBABURL",58,0)
 I DVBUSER'="",DVBPWD'="",DVBTOKEN'="" D  ;success
"RTN","DVBABURL",59,0)
 . S DVBAUTH=DVBUSER_U_DVBPWD_U_DVBTOKEN
"RTN","DVBABURL",60,0)
 E  D  ;failure
"RTN","DVBABURL",61,0)
 . S DVBAUTH=""
"RTN","DVBABURL",62,0)
 Q
"RTN","DVBACREM")
0^1^B2557988^n/a
"RTN","DVBACREM",1,0)
DVBACREM ;ALB/RTW - REMARKS SENT TO CONTRACTORS;05/27/2015
"RTN","DVBACREM",2,0)
 ;;2.7;AMIE;**192**;Apr 10, 1995;Build 15
"RTN","DVBACREM",3,0)
 ; At WPGET This routine gets remarks sent to contractors,(from global 396.4),for a 2507 Exam Reqiest
"RTN","DVBACREM",4,0)
 ; At WPSET This routine sets remarks sent to contractors,(from global 396.4),for a 2507 Exam Request 
"RTN","DVBACREM",5,0)
 Q  ;no direct entry
"RTN","DVBACREM",6,0)
 ;
"RTN","DVBACREM",7,0)
WPGET(DVBADATA,DVBEIEN) ;
"RTN","DVBACREM",8,0)
 ;RPC: DVBA CAPRI GETCONTREMARKS
"RTN","DVBACREM",9,0)
 N DVBCR
"RTN","DVBACREM",10,0)
 K ^TMP("DVBA",$J)
"RTN","DVBACREM",11,0)
 S X=0
"RTN","DVBACREM",12,0)
 S DVBCR=0 F  S DVBCR=$O(^DVB(396.4,DVBEIEN,6,DVBCR)) Q:'DVBCR  D
"RTN","DVBACREM",13,0)
 . S DVBARMKS=$G(^DVB(396.4,DVBEIEN,6,DVBCR,0))
"RTN","DVBACREM",14,0)
 . S ^TMP("DVBA",$J,DVBCR)=DVBARMKS
"RTN","DVBACREM",15,0)
 S DVBCNT=0,DVBCNA=0 F  S DVBCNA=$O(^TMP("DVBA",$J,DVBCNA)) Q:DVBCNA=""  D
"RTN","DVBACREM",16,0)
 . S DVBAREM=$G(^TMP("DVBA",$J,DVBCNA))
"RTN","DVBACREM",17,0)
 . S DVBADATA(DVBCNT)=DVBAREM
"RTN","DVBACREM",18,0)
 . S DVBCNT=DVBCNT+1
"RTN","DVBACREM",19,0)
 K DVBCA,DVBCNT,DVBAREM,DVBARMKS,X
"RTN","DVBACREM",20,0)
 S RESULT=$NA(^TMP("DVBA",$J))
"RTN","DVBACREM",21,0)
 Q
"RTN","DVBACREM",22,0)
 ;
"RTN","DVBACREM",23,0)
WPSET(RESULT,DVBRIEN,DVBEIEN,DVBDATA) ;RPC: DVBA CAPRI SETCONTREMARKS
"RTN","DVBACREM",24,0)
 ;DVBEIEN exam ien(s) example ** DVBEIEN="12736^12737^12738"
"RTN","DVBACREM",25,0)
 ;DVBPEIN is the individual IENs pieced out.
"RTN","DVBACREM",26,0)
 K ^TMP("DVBA",$J)
"RTN","DVBACREM",27,0)
 S DVBPIEN=0 F DVBI=1:1 S DVBPIEN=$P(DVBEIEN,U,DVBI) Q:'DVBPIEN  D
"RTN","DVBACREM",28,0)
 . D WPDATA
"RTN","DVBACREM",29,0)
 K DVBI,DVBRIEN,DVBPIEN,DVBCNT,DVBCNA
"RTN","DVBACREM",30,0)
 Q
"RTN","DVBACREM",31,0)
WPDATA ;
"RTN","DVBACREM",32,0)
 S DVBLINE="",DVBCNT=1 F  S DVBLINE=$O(DVBDATA(DVBLINE)) Q:DVBLINE=""  D
"RTN","DVBACREM",33,0)
 .S ^TMP("DVBA",$J,"WP",DVBCNT)=$G(DVBDATA(DVBLINE))
"RTN","DVBACREM",34,0)
 .S DVBCNT=DVBCNT+1
"RTN","DVBACREM",35,0)
 S D0=DVBPIEN
"RTN","DVBACREM",36,0)
 D WP^DIE(396.4,DVBPIEN,103,"K","^TMP(""DVBA"",$J,""WP"")")
"RTN","DVBACREM",37,0)
 S RESULT=$NA(^TMP("DVB",$J))
"RTN","DVBACREM",38,0)
 K D0,DVBLINE,DVBCNT
"RTN","DVBACREM",39,0)
 Q
"RTN","DVBARSBD")
0^5^B142334503^B106363771
"RTN","DVBARSBD",1,0)
DVBARSBD ;ALB/RPM - CAPRI 2507 REQUEST STATUS BY DT RANGE REPORT ; 01/24/12
"RTN","DVBARSBD",2,0)
 ;;2.7;AMIE;**179,185,189,190,192**;Apr 10, 1995;Build 15
"RTN","DVBARSBD",3,0)
 ;
"RTN","DVBARSBD",4,0)
 Q  ;NO DIRECT ENTRY
"RTN","DVBARSBD",5,0)
 ;
"RTN","DVBARSBD",6,0)
REQSTAT(DVBSDAT,DVBEDAT,DVBRSTAT,DVBDELIM,DVBNODT) ;entry for request status by dt range
"RTN","DVBARSBD",7,0)
 ;
"RTN","DVBARSBD",8,0)
 ;  Input:
"RTN","DVBARSBD",9,0)
 ;    DVBSDAT - start date (FM format)
"RTN","DVBARSBD",10,0)
 ;    DVBEDAT - end date (FM format)
"RTN","DVBARSBD",11,0)
 ;    DVBRSTAT - request status (internal format)
"RTN","DVBARSBD",12,0)
 ;    DVBDELIM - return delimited results (0=no;1=yes)
"RTN","DVBARSBD",13,0)
 ;    DVBNODT - ignore date range (0=no;1=yes)
"RTN","DVBARSBD",14,0)
 ;
"RTN","DVBARSBD",15,0)
 N EXSTAT  ;request status (external format)
"RTN","DVBARSBD",16,0)
 N EXSDAT  ;start date (external format: MM/DD/YYYY)
"RTN","DVBARSBD",17,0)
 N EXEDAT  ;end date (external format: MM/DD/YYYY)
"RTN","DVBARSBD",18,0)
 N DVBARS  ;request status conversion results
"RTN","DVBARSBD",19,0)
 N DVBERR  ;FM error msg
"RTN","DVBARSBD",20,0)
 N DVBCNT   ;returned record count
"RTN","DVBARSBD",21,0)
 ;
"RTN","DVBARSBD",22,0)
 K ^TMP("DVBREQ",$J),^TMP("DVBREQN",$J)
"RTN","DVBARSBD",23,0)
 S EXSDAT=$$FMTE^XLFDT(DVBSDAT,"5DZ")
"RTN","DVBARSBD",24,0)
 S EXEDAT=$$FMTE^XLFDT(DVBEDAT,"5DZ")
"RTN","DVBARSBD",25,0)
 I DVBRSTAT="A" S EXSTAT="ALL"
"RTN","DVBARSBD",26,0)
 E  D
"RTN","DVBARSBD",27,0)
 . D CHK^DIE(396.3,17,"E",DVBRSTAT,.DVBARS,"DVBERR")
"RTN","DVBARSBD",28,0)
 . S EXSTAT=$G(DVBARS(0))
"RTN","DVBARSBD",29,0)
 S DVBCNT=1
"RTN","DVBARSBD",30,0)
 S DVBAD=$S(DVBDELIM=1:",",1:0)
"RTN","DVBARSBD",31,0)
 ;
"RTN","DVBARSBD",32,0)
 ;collect records matching search criteria
"RTN","DVBARSBD",33,0)
 I DVBNODT D
"RTN","DVBARSBD",34,0)
 . S EXSDAT="NO START DATE"
"RTN","DVBARSBD",35,0)
 . S EXEDAT="NO END DATE"
"RTN","DVBARSBD",36,0)
 . I DVBDELIM D DELIMHDR(EXSDAT,EXEDAT,EXSTAT)
"RTN","DVBARSBD",37,0)
 . D GETRECSN(DVBRSTAT,.DVBCNT)
"RTN","DVBARSBD",38,0)
 E  D
"RTN","DVBARSBD",39,0)
 . I DVBDELIM D DELIMHDR(EXSDAT,EXEDAT,EXSTAT)
"RTN","DVBARSBD",40,0)
 . D GETRECS(DVBSDAT,DVBEDAT,DVBRSTAT,.DVBCNT)
"RTN","DVBARSBD",41,0)
 ;
"RTN","DVBARSBD",42,0)
 ;output results
"RTN","DVBARSBD",43,0)
 I 'DVBCNT D
"RTN","DVBARSBD",44,0)
 . W "NO DATA FOUND"
"RTN","DVBARSBD",45,0)
 E  D
"RTN","DVBARSBD",46,0)
 . I 'DVBDELIM D PLAINHDR(EXSDAT,EXEDAT,EXSTAT),PLAIN  ;plain text format
"RTN","DVBARSBD",47,0)
 . I DVBDELIM D DELIM  ;comma delimited format
"RTN","DVBARSBD",48,0)
 ;
"RTN","DVBARSBD",49,0)
END ;Clean up local variables
"RTN","DVBARSBD",50,0)
 K DIWF,DIWL,DIWR,DVBAD,DVBAX,DVBAY,DVBCNRS,DVBEXAM,DVBIEN4,DVBI2,DVBX,DVBXCNT,LINE,X
"RTN","DVBARSBD",51,0)
 K DVBAD,DVBAX,DVBAY,DVBCNRS,DVBCT,DVBCTN,DVBCTW,DVBIEN4,DVBI2,DIWF,DIWL,DIWR,DVBX,DVBSC,DVBSCC,DVBSCN,DVBSCW,DVBSCWA,DVBXCNT,LINE,X
"RTN","DVBARSBD",52,0)
 K DVBSCNS,DVBAA,^TMP("DVBREQ",$J),^TMP("DVBREQH",$J)
"RTN","DVBARSBD",53,0)
 Q
"RTN","DVBARSBD",54,0)
 ;
"RTN","DVBARSBD",55,0)
GETRECS(SDAT,EDAT,RSTAT,CNT) ;collect 2507 REQUEST record matches, when DVBNODT=0 means not ignoring the date range
"RTN","DVBARSBD",56,0)
 ;This procedure collects all 2507 REQUEST records that have a
"RTN","DVBARSBD",57,0)
 ;DATE STATUS LAST CHANGED within the start and end dates and have
"RTN","DVBARSBD",58,0)
 ;a REQUEST STATUS that matches the input request status parameter.
"RTN","DVBARSBD",59,0)
 ;
"RTN","DVBARSBD",60,0)
 ;  Input:
"RTN","DVBARSBD",61,0)
 ;    SDAT - start date (FM format)
"RTN","DVBARSBD",62,0)
 ;    EDAT - end date (FM format)
"RTN","DVBARSBD",63,0)
 ;    RSTAT - request status (internal format)
"RTN","DVBARSBD",64,0)
 ;    CNT - record count (passed by reference)
"RTN","DVBARSBD",65,0)
 ;
"RTN","DVBARSBD",66,0)
 N CHGDAT  ;change date
"RTN","DVBARSBD",67,0)
 N DVBIEN  ;2507 REQUEST IEN
"RTN","DVBARSBD",68,0)
 N DVBSTAT ;2507 REQUEST STATUS
"RTN","DVBARSBD",69,0)
 N FLD     ;field array in external format
"RTN","DVBARSBD",70,0)
 ;
"RTN","DVBARSBD",71,0)
 S CHGDAT=SDAT-1
"RTN","DVBARSBD",72,0)
 S DVBIEN=0,CNT=0 F  S CHGDAT=$O(^DVB(396.3,"AH",CHGDAT)) Q:'CHGDAT!(CHGDAT>EDAT)  D
"RTN","DVBARSBD",73,0)
 . F  S DVBIEN=$O(^DVB(396.3,"AH",CHGDAT,DVBIEN)) Q:'DVBIEN  D
"RTN","DVBARSBD",74,0)
 . . S DVBSTAT=$$GET1^DIQ(396.3,DVBIEN_",",17,"I","","")
"RTN","DVBARSBD",75,0)
 . . I RSTAT="A"!(DVBSTAT=RSTAT) D
"RTN","DVBARSBD",76,0)
 . . . K FLD
"RTN","DVBARSBD",77,0)
 . . . I $$SETFLDS(DVBIEN,.FLD) D
"RTN","DVBARSBD",78,0)
 . . . . S CNT=CNT+1,DVBXCNT=1
"RTN","DVBARSBD",79,0)
 . . . . I $G(DVBAD)'="," S ^TMP("DVBREQ",$J,CNT)=FLD("IEN")_U_FLD("SS")_U_FLD("NM")_U_FLD("REQDT")_U_FLD("RELDT")_U_FLD("PRTDT")_U_FLD("RS")_U_FLD("CANDT")_U_FLD("RO")_U_FLD("CANRS",DVBXCNT)_U_FLD("CANCOM",DVBXCNT) D
"RTN","DVBARSBD",80,0)
 . . . . . S ^TMP("DVBREQ",$J,CNT,DVBIEN)=FLD("IEN")_U_FLD("SS")_U_FLD("NM")_U_FLD("REQDT")_U_FLD("RELDT")_U_FLD("PRTDT")_U_FLD("RS")_U_FLD("CANDT")_U_FLD("RO")_U_FLD("CANRS",DVBXCNT)_U_FLD("CANCOM",DVBXCNT)_U
"RTN","DVBARSBD",81,0)
 . . . . . S ^TMP("DVBREQ",$J,CNT,DVBIEN)=^TMP("DVBREQ",$J,CNT,DVBIEN)_FLD("DVBCTW")_U_FLD("DVBSCWA")
"RTN","DVBARSBD",82,0)
 . . . . . S CNT=CNT+1,DVBXCNT=DVBXCNT+1
"RTN","DVBARSBD",83,0)
 . . . . I $G(DVBAD)="," D
"RTN","DVBARSBD",84,0)
 . . . . . S ^TMP("DVBREQ",$J,CNT,DVBIEN)=FLD("SS")_DVBAD_""""_FLD("NM")_""""_DVBAD_FLD("REQDT")_DVBAD_FLD("RELDT")_DVBAD_""""_FLD("PRTDT")_""""_DVBAD
"RTN","DVBARSBD",85,0)
 . . . . . S ^TMP("DVBREQ",$J,CNT,DVBIEN)=^TMP("DVBREQ",$J,CNT,DVBIEN)_""""_FLD("RS")_""""_DVBAD_FLD("CANDT")_DVBAD_""""_FLD("RO")_""""_DVBAD
"RTN","DVBARSBD",86,0)
 . . . . . S ^TMP("DVBREQ",$J,CNT,DVBIEN)=^TMP("DVBREQ",$J,CNT,DVBIEN)_DVBAD_DVBAD_FLD("DVBCTW")_DVBAD_""""_FLD("DVBSCWA")_""""_DVBAD
"RTN","DVBARSBD",87,0)
 . . . . . S DVBX=0 F  S DVBX=$O(FLD("IEN4",DVBX)) Q:'DVBX  D
"RTN","DVBARSBD",88,0)
 . . . . . . S ^TMP("DVBREQ",$J,CNT,DVBIEN,DVBX)=FLD("SS")_DVBAD_DVBAD_DVBAD_DVBAD_DVBAD_DVBAD_DVBAD_DVBAD_""""_FLD("CANRS",DVBXCNT)_""""_DVBAD_""""_FLD("CANCOM",DVBXCNT)_""""_DVBAD_$C(13)
"RTN","DVBARSBD",89,0)
 . . . . . . S DVBXCNT=DVBXCNT+1
"RTN","DVBARSBD",90,0)
 . . . . . S CNT=CNT+1
"RTN","DVBARSBD",91,0)
 Q
"RTN","DVBARSBD",92,0)
 ;
"RTN","DVBARSBD",93,0)
SETFLDS(DVBIEN,DVBFLDS) ;build field array in external format
"RTN","DVBARSBD",94,0)
 ;This function formats the collected record data in external format
"RTN","DVBARSBD",95,0)
 ;and returns the results TRUE and an array on success.  Otherwise,
"RTN","DVBARSBD",96,0)
 ;the function returns FALSE.
"RTN","DVBARSBD",97,0)
 ;
"RTN","DVBARSBD",98,0)
 ;  Integration Reference #10061 - DEM^VADPT
"RTN","DVBARSBD",99,0)
 ;
"RTN","DVBARSBD",100,0)
 ;  Input:
"RTN","DVBARSBD",101,0)
 ;    DVBIEN - 2507 REQUEST IEN
"RTN","DVBARSBD",102,0)
 ;    DVBFLDS - field array passed by reference
"RTN","DVBARSBD",103,0)
 ;
"RTN","DVBARSBD",104,0)
 ;  Output:
"RTN","DVBARSBD",105,0)
 ;    DVBFLDS("IEN") - 2507 REQUEST IEN
"RTN","DVBARSBD",106,0)
 ;    DVBFLDS("NM") - patient name
"RTN","DVBARSBD",107,0)
 ;    DVBFLDS("SS") - social security number
"RTN","DVBARSBD",108,0)
 ;    DVBFLDS("RS") - request status
"RTN","DVBARSBD",109,0)
 ;    DVBFLDS("REQDT") - request date
"RTN","DVBARSBD",110,0)
 ;    DVBFLDS("RELDT") - release date
"RTN","DVBARSBD",111,0)
 ;    DVBFLDS("PRTDT") - print date
"RTN","DVBARSBD",112,0)
 ;    DVBFLDS("CANDT") - canceled date
"RTN","DVBARSBD",113,0)
 ;    DVBFLDS("RO") - regional office
"RTN","DVBARSBD",114,0)
 ;    DVBFLDS("IREQDT") - request date in internal FM format
"RTN","DVBARSBD",115,0)
 ;    DVBFLDS("EXAM") - added with patch DVB*2.7*189; HOLDS THE 2507 EXAM name   
"RTN","DVBARSBD",116,0)
 ;    DVBFLDS("CANRS") - added with patch DVB*2.7*189; HOLDS THE 2507 EXAM CANCELLATION REASON name
"RTN","DVBARSBD",117,0)
 ;    DVBFLDS("CANCOM") - added with patch DVB*2.7*189; HOLDS THE 2507 EXAM CANCELLATION COMMENTS name
"RTN","DVBARSBD",118,0)
 ;    Function Result - return 1 on success; otherwise returns 0
"RTN","DVBARSBD",119,0)
 ;
"RTN","DVBARSBD",120,0)
 N DFN  ;PATIENT file IEN used in VADPT call
"RTN","DVBARSBD",121,0)
 N DVBDAT  ;2507 REQUEST data field array
"RTN","DVBARSBD",122,0)
 N DVBIENS  ;FM IENS value
"RTN","DVBARSBD",123,0)
 N DVBRSLT  ;function result
"RTN","DVBARSBD",124,0)
 N VADM  ;VADPT return array
"RTN","DVBARSBD",125,0)
 N DVBIEN4 ;the IEN FROM 2507 EXAM FILE 396.4
"RTN","DVBARSBD",126,0)
 N DVBALAST ;number of lines in the wp cancellation comments
"RTN","DVBARSBD",127,0)
 N DVBAI  ;for loop index
"RTN","DVBARSBD",128,0)
 N DVBAX ;
"RTN","DVBARSBD",129,0)
 ;
"RTN","DVBARSBD",130,0)
 S DVBRSLT=0
"RTN","DVBARSBD",131,0)
 S DVBIENS=+$G(DVBIEN)_","
"RTN","DVBARSBD",132,0)
 D GETS^DIQ(396.3,DVBIENS,".01;1;2;13;15;17;19","IE","DVBDAT","")
"RTN","DVBARSBD",133,0)
 S DFN=$G(DVBDAT(396.3,DVBIENS,.01,"I"))
"RTN","DVBARSBD",134,0)
 D DEM^VADPT
"RTN","DVBARSBD",135,0)
 I $G(VADM(1))'="" D  ;only return record when name is resolved
"RTN","DVBARSBD",136,0)
 . S DVBFLDS("IEN")=DVBIEN
"RTN","DVBARSBD",137,0)
 . S DVBFLDS("NM")=$G(VADM(1))
"RTN","DVBARSBD",138,0)
 . S DVBFLDS("SS")=$S(DVBDELIM:$P($G(VADM(2)),U,2),1:$P($G(VADM(2)),U,1))
"RTN","DVBARSBD",139,0)
 . S DVBFLDS("RS")=$G(DVBDAT(396.3,DVBIENS,17,"E"))
"RTN","DVBARSBD",140,0)
 . S DVBFLDS("REQDT")=$$FMTE^XLFDT($G(DVBDAT(396.3,DVBIENS,1,"I")),"5DZ")
"RTN","DVBARSBD",141,0)
 . S DVBFLDS("RELDT")=$$FMTE^XLFDT($G(DVBDAT(396.3,DVBIENS,13,"I")),"5DZ")
"RTN","DVBARSBD",142,0)
 . S DVBFLDS("PRTDT")=$$FMTE^XLFDT($G(DVBDAT(396.3,DVBIENS,15,"I")),"5DZ")
"RTN","DVBARSBD",143,0)
 . S DVBFLDS("CANDT")=$$FMTE^XLFDT($G(DVBDAT(396.3,DVBIENS,19,"I")),"5DZ")
"RTN","DVBARSBD",144,0)
 . S DVBFLDS("RO")=$G(DVBDAT(396.3,DVBIENS,2,"E"))
"RTN","DVBARSBD",145,0)
 . D CLAIMTYP,SPEC
"RTN","DVBARSBD",146,0)
 . S DVBFLDS("DVBCTW")=DVBCTW
"RTN","DVBARSBD",147,0)
 . S DVBFLDS("DVBSCWA")=DVBSCWA
"RTN","DVBARSBD",148,0)
 . S DVBXCNT=1
"RTN","DVBARSBD",149,0)
 . S (DVBFLDS("CANRS",DVBXCNT),DVBFLDS("CANCOM",DVBXCNT),DVBFLDS("IEN4"))=""
"RTN","DVBARSBD",150,0)
 . S DVBIEN4=0 F  S DVBIEN4=$O(^DVB(396.4,"C",DVBIEN,DVBIEN4)) Q:'DVBIEN4  D
"RTN","DVBARSBD",151,0)
 . . I $D(^DVB(396.4,DVBIEN4,"CAN")) D
"RTN","DVBARSBD",152,0)
 . . . S DVBAY=($P($P(^DVB(396.4,DVBIEN4,"CAN"),"^",1),".",1)) I DVBAY>(DVBSDAT-1)&DVBAY<(DVBEDAT+1) D
"RTN","DVBARSBD",153,0)
 . . . . S DVBFLDS("CANRS",DVBXCNT)=$$GET1^DIQ(396.4,DVBIEN4,52)
"RTN","DVBARSBD",154,0)
 . . . . I $D(^DVB(396.4,DVBIEN4,5)) D
"RTN","DVBARSBD",155,0)
 . . . . . S DVBFLDS("IEN4",DVBXCNT)=DVBIEN4
"RTN","DVBARSBD",156,0)
 . . . . . K WP S DVBAX=$$GET1^DIQ(396.4,DVBIEN4,53,"Z","WP") ; this puts the wordprocessing field into an array 'WP(#,0)=' next it gets put into one entry of the DVBFLDS ARRAY so we can handle any comma's that aren't delimiters
"RTN","DVBARSBD",157,0)
 . . . . . ;DVBALAST gets the number of WP lines to loop through in the for loop
"RTN","DVBARSBD",158,0)
 . . . . . S DVBALAST=$P(^DVB(396.4,DVBIEN4,5,0),U,3) S DVBAI="",DVBFLDS("CANCOM",DVBXCNT)=WP(1,0) F DVBAI=2:1:DVBALAST S DVBFLDS("CANCOM",DVBXCNT)=DVBFLDS("CANCOM",DVBXCNT)_WP(DVBAI,0)
"RTN","DVBARSBD",159,0)
 . . . . . S DVBXCNT=DVBXCNT+1
"RTN","DVBARSBD",160,0)
 . S DVBFLDS("IREQDT")=$G(DVBDAT(396.3,DVBIENS,1,"I"))
"RTN","DVBARSBD",161,0)
 . S DVBRSLT=1
"RTN","DVBARSBD",162,0)
 Q DVBRSLT
"RTN","DVBARSBD",163,0)
 ;
"RTN","DVBARSBD",164,0)
DELIMHDR(EXSDAT,EXEDAT,EXSTAT) ;output delimited format header
"RTN","DVBARSBD",165,0)
 ;  Input:
"RTN","DVBARSBD",166,0)
 ;    EXSDAT - start date (external format)
"RTN","DVBARSBD",167,0)
 ;    EXEDAT - end date (external format)
"RTN","DVBARSBD",168,0)
 ;    EXSTAT - request status (external format)
"RTN","DVBARSBD",169,0)
 S ^TMP("DVBREQH",$J,DVBCNT)="Request Status by Date Range Report",DVBCNT=DVBCNT+1
"RTN","DVBARSBD",170,0)
 S ^TMP("DVBREQH",$J,DVBCNT)="Date Range: "_EXSDAT_" - "_EXEDAT,DVBCNT=DVBCNT+1
"RTN","DVBARSBD",171,0)
 S ^TMP("DVBREQH",$J,DVBCNT)=""""_"Request Status: "_EXSTAT_""""_$C(13),DVBCNT=DVBCNT+1
"RTN","DVBARSBD",172,0)
 S ^TMP("DVBREQH",$J,DVBCNT)="SSN"_DVBAD_"PatientName"_DVBAD_"RequestDT"_DVBAD_"DTReleased"_DVBAD_"DTPrinted"_DVBAD_"RequestStatus"_DVBAD_"DtCanceled"_DVBAD_"Station"_DVBAD_"Cancellation Reason"_DVBAD_"Cancellation Comments"_DVBAD
"RTN","DVBARSBD",173,0)
 S ^TMP("DVBREQH",$J,DVBCNT)=^TMP("DVBREQH",$J,DVBCNT)_"Claim Type"_DVBAD_"Special Consideration(s)",DVBCNT=DVBCNT+1
"RTN","DVBARSBD",174,0)
 Q
"RTN","DVBARSBD",175,0)
 ;
"RTN","DVBARSBD",176,0)
DELIM ;output delimited format
"RTN","DVBARSBD",177,0)
 ;
"RTN","DVBARSBD",178,0)
 N DVBI     ;generic counter
"RTN","DVBARSBD",179,0)
 N DVBREQ   ;request record
"RTN","DVBARSBD",180,0)
 ;
"RTN","DVBARSBD",181,0)
 U IO
"RTN","DVBARSBD",182,0)
 S DVBI=0 F  S DVBI=$O(^TMP("DVBREQH",$J,DVBI)) Q:'DVBI  D
"RTN","DVBARSBD",183,0)
 . S DVBREQH=^TMP("DVBREQH",$J,DVBI)
"RTN","DVBARSBD",184,0)
 . W !,DVBREQH
"RTN","DVBARSBD",185,0)
 S DVBI2=0 F  S DVBI2=$O(^TMP("DVBREQ",$J,DVBI2)) Q:'DVBI2  D
"RTN","DVBARSBD",186,0)
 . S DVBIEN=0 F  S DVBIEN=$O(^TMP("DVBREQ",$J,DVBI2,DVBIEN)) Q:'DVBIEN  D
"RTN","DVBARSBD",187,0)
 . . S DVBREQL2=^TMP("DVBREQ",$J,DVBI2,DVBIEN)
"RTN","DVBARSBD",188,0)
 . . W !,DVBREQL2
"RTN","DVBARSBD",189,0)
 . . S DVBI22=0 F  S DVBI22=$O(^TMP("DVBREQ",$J,DVBI2,DVBIEN,DVBI22)) Q:'DVBI22  D
"RTN","DVBARSBD",190,0)
 . . . S DVBREQL3=^TMP("DVBREQ",$J,DVBI2,DVBIEN,DVBI22)
"RTN","DVBARSBD",191,0)
 . . . W !,DVBREQL3
"RTN","DVBARSBD",192,0)
 ;
"RTN","DVBARSBD",193,0)
 Q
"RTN","DVBARSBD",194,0)
 ;
"RTN","DVBARSBD",195,0)
PLAINHDR(EXSDAT,EXEDAT,EXSTAT)  ;output plain text header
"RTN","DVBARSBD",196,0)
 ;Populate the header information.
"RTN","DVBARSBD",197,0)
 ;CAUTION:  The CAPRI GUI pulls this information to populate the header
"RTN","DVBARSBD",198,0)
 ;for each page when creating a printed report.  Do not modify the
"RTN","DVBARSBD",199,0)
 ;content or line count of the header information without validating
"RTN","DVBARSBD",200,0)
 ;against the CAPRI GUI interface.
"RTN","DVBARSBD",201,0)
 ;
"RTN","DVBARSBD",202,0)
 ;CAPRI GUI to populate 
"RTN","DVBARSBD",203,0)
 ;  Input:
"RTN","DVBARSBD",204,0)
 ;    EXSDAT - start date (external format)
"RTN","DVBARSBD",205,0)
 ;    EXEDAT - end date (external format)
"RTN","DVBARSBD",206,0)
 ;    EXSTAT - request status (external format)
"RTN","DVBARSBD",207,0)
 ;
"RTN","DVBARSBD",208,0)
 N DVBLINE  ;header separator
"RTN","DVBARSBD",209,0)
 ;
"RTN","DVBARSBD",210,0)
 U IO
"RTN","DVBARSBD",211,0)
 S $P(DVBLINE,"-",131)=""
"RTN","DVBARSBD",212,0)
 W "Date Range: "_EXSDAT_" - "_EXEDAT
"RTN","DVBARSBD",213,0)
 W !,"Request Status: ",EXSTAT
"RTN","DVBARSBD",214,0)
 W !
"RTN","DVBARSBD",215,0)
 W !,"SSN",?11,"PATIENT NAME",?33,"REQUEST DT",?45,"DT RELEASED"
"RTN","DVBARSBD",216,0)
 W ?57,"DT PRINTED",?69,"STATUS",?98,"DT CANCELED",?110,"STATION"
"RTN","DVBARSBD",217,0)
 W !,?2,"CLAIM TYPE"
"RTN","DVBARSBD",218,0)
 W !,?2,"SPECIAL CONSIDERATION(S)"
"RTN","DVBARSBD",219,0)
 W !,?2,"CANCELLATION REASON"
"RTN","DVBARSBD",220,0)
 W !,?2,"CANCELLATION COMMENTS"
"RTN","DVBARSBD",221,0)
 W !,DVBLINE
"RTN","DVBARSBD",222,0)
 Q
"RTN","DVBARSBD",223,0)
 ;
"RTN","DVBARSBD",224,0)
PLAIN ;output plain text format
"RTN","DVBARSBD",225,0)
 ;Output formatted text format.  The patient name and station name
"RTN","DVBARSBD",226,0)
 ;are truncated at 20 characters to maintain 132 character report.
"RTN","DVBARSBD",227,0)
 ;
"RTN","DVBARSBD",228,0)
 N DVBI     ;generic counter
"RTN","DVBARSBD",229,0)
 N DVBREQ   ;request record
"RTN","DVBARSBD",230,0)
 ;
"RTN","DVBARSBD",231,0)
 U IO
"RTN","DVBARSBD",232,0)
 S DVBI=0
"RTN","DVBARSBD",233,0)
 F  S DVBI=$O(^TMP("DVBREQ",$J,DVBI)) Q:'DVBI  D
"RTN","DVBARSBD",234,0)
 . S DVBIEN=0 F  S DVBIEN=$O(^TMP("DVBREQ",$J,DVBI,DVBIEN)) Q:'DVBIEN  D
"RTN","DVBARSBD",235,0)
 . . S DVBREQ=^TMP("DVBREQ",$J,DVBI,DVBIEN)
"RTN","DVBARSBD",236,0)
 . . W !,$P(DVBREQ,U,2),?11,$E($P(DVBREQ,U,3),1,20),?33,$P(DVBREQ,U,4)
"RTN","DVBARSBD",237,0)
 . . W ?45,$P(DVBREQ,U,5),?57,$P(DVBREQ,U,6),?69,$P(DVBREQ,U,7)
"RTN","DVBARSBD",238,0)
 . . W ?98,$P(DVBREQ,U,8),?110,$E($P(DVBREQ,U,9),1,20),!
"RTN","DVBARSBD",239,0)
 . . D CLAIMTYP,SPEC
"RTN","DVBARSBD",240,0)
 . . W !,?2,"CLAIM TYPE: ",DVBCTW
"RTN","DVBARSBD",241,0)
 . . W !,?2,"SPECIAL CONSIDERATION(S): ",DVBSCWA,!
"RTN","DVBARSBD",242,0)
 . . S DVBIEN4=0 F  S DVBIEN4=$O(^DVB(396.4,"C",DVBIEN,DVBIEN4)) Q:'DVBIEN4  D
"RTN","DVBARSBD",243,0)
 . . . I $D(^DVB(396.4,DVBIEN4,"CAN")) D
"RTN","DVBARSBD",244,0)
 . . . . S DVBAY=($P($P(^DVB(396.4,DVBIEN4,"CAN"),"^",1),".",1)) I DVBAY>(DVBSDAT-1)&DVBAY<(DVBEDAT+1) D
"RTN","DVBARSBD",245,0)
 . . . . . S DVBCNRS=$$GET1^DIQ(396.4,DVBIEN4,52) D
"RTN","DVBARSBD",246,0)
 . . . . . .W !,?2,"CANCELLATION REASON: ",DVBCNRS,!
"RTN","DVBARSBD",247,0)
 . . . . . I $D(^DVB(396.4,DVBIEN4,5)) D
"RTN","DVBARSBD",248,0)
 . . . . . . K ^UTILITY($J,"W")
"RTN","DVBARSBD",249,0)
 . . . . . . W !,?2,"CANCELLATION COMMENTS:  " F LINE=0:0 S LINE=$O(^DVB(396.4,DVBIEN4,5,LINE)) Q:LINE=""  S X=^(LINE,0),DIWL=5,DIWR=75,DIWF="NW" D ^DIWP
"RTN","DVBARSBD",250,0)
 . . . . . . W !
"RTN","DVBARSBD",251,0)
 Q 
"RTN","DVBARSBD",252,0)
 ;
"RTN","DVBARSBD",253,0)
GETRECSN(RSTAT,DVBCNT) ;collect 2507 REQUEST status matches and ignore date range
"RTN","DVBARSBD",254,0)
 ;This procedure collects all 2507 REQUEST records that have a REQUEST STATUS
"RTN","DVBARSBD",255,0)
 ;that matches the input request status parameter regardless of the LAST
"RTN","DVBARSBD",256,0)
 ;STATUS CHANGE DATE range.  The procedure uses the "AF" index which sorts
"RTN","DVBARSBD",257,0)
 ;by REQUEST STATUS and REGIONAL OFFICE.
"RTN","DVBARSBD",258,0)
 ;
"RTN","DVBARSBD",259,0)
 ;  Input:
"RTN","DVBARSBD",260,0)
 ;    RSTAT - request status (internal format)
"RTN","DVBARSBD",261,0)
 ;    DVBCNT - record count (passed by reference)
"RTN","DVBARSBD",262,0)
 ;
"RTN","DVBARSBD",263,0)
 ;
"RTN","DVBARSBD",264,0)
 N DVBIEN  ;2507 REQUEST IEN
"RTN","DVBARSBD",265,0)
 N FLD     ;field array in external format
"RTN","DVBARSBD",266,0)
 N DVBRO   ;regional office
"RTN","DVBARSBD",267,0)
 S DVBRO=0,DVBCNT=0 F  S DVBRO=$O(^DVB(396.3,"AF",RSTAT,DVBRO)) Q:'DVBRO  D
"RTN","DVBARSBD",268,0)
 . S DVBIEN=0
"RTN","DVBARSBD",269,0)
 . F  S DVBIEN=$O(^DVB(396.3,"AF",RSTAT,DVBRO,DVBIEN)) Q:'DVBIEN  D
"RTN","DVBARSBD",270,0)
 . . K FLD
"RTN","DVBARSBD",271,0)
 . . I $$SETFLDS(DVBIEN,.FLD) D
"RTN","DVBARSBD",272,0)
 . . . S DVBXCNT=1
"RTN","DVBARSBD",273,0)
 . . . I $G(DVBAD)'="," D
"RTN","DVBARSBD",274,0)
 . . . . S ^TMP("DVBREQ",$J,DVBCNT,DVBIEN)=FLD("IEN")_U_FLD("SS")_U_FLD("NM")_U_FLD("REQDT")_U_FLD("RELDT")_U_FLD("PRTDT")_U_FLD("RS")_U_FLD("CANDT")_U_FLD("RO")_U_FLD("CANRS",DVBXCNT)_U_FLD("CANCOM",DVBXCNT)_U
"RTN","DVBARSBD",275,0)
 . . . . S ^TMP("DVBREQ",$J,DVBCNT,DVBIEN)=^TMP("DVBREQ",$J,DVBCNT,DVBIEN)_FLD("DVBCTW")_U_FLD("DVBSCWA")
"RTN","DVBARSBD",276,0)
 . . . . S DVBCNT=DVBCNT+1,DVBXCNT=DVBXCNT+1
"RTN","DVBARSBD",277,0)
 . . . I $G(DVBAD)="," D
"RTN","DVBARSBD",278,0)
 . . . . S ^TMP("DVBREQ",$J,DVBCNT,DVBIEN)=FLD("SS")_DVBAD_""""_FLD("NM")_""""_DVBAD_FLD("REQDT")_DVBAD_FLD("RELDT")_DVBAD_""""_FLD("PRTDT")_""""_DVBAD
"RTN","DVBARSBD",279,0)
 . . . . S ^TMP("DVBREQ",$J,DVBCNT,DVBIEN)=^TMP("DVBREQ",$J,DVBCNT,DVBIEN)_""""_FLD("RS")_""""_DVBAD_FLD("CANDT")_DVBAD_""""_FLD("RO")_""""_DVBAD
"RTN","DVBARSBD",280,0)
 . . . . S ^TMP("DVBREQ",$J,DVBCNT,DVBIEN)=^TMP("DVBREQ",$J,DVBCNT,DVBIEN)_DVBAD_DVBAD_FLD("DVBCTW")_DVBAD_""""_FLD("DVBSCWA")_""""_DVBAD
"RTN","DVBARSBD",281,0)
 . . . . S DVBX=0 F  S DVBX=$O(FLD("IEN4",DVBX)) Q:'DVBX  D
"RTN","DVBARSBD",282,0)
 . . . . . S ^TMP("DVBREQ",$J,DVBCNT,DVBIEN,DVBX)=FLD("SS")_DVBAD_DVBAD_DVBAD_DVBAD_DVBAD_DVBAD_DVBAD_DVBAD_""""_FLD("CANRS",DVBXCNT)_""""_DVBAD_""""_FLD("CANCOM",DVBXCNT)_""""_DVBAD_$C(13)
"RTN","DVBARSBD",283,0)
 . . . . . S DVBXCNT=DVBXCNT+1
"RTN","DVBARSBD",284,0)
 . . . . S DVBCNT=DVBCNT+1
"RTN","DVBARSBD",285,0)
 ;load output global with sorted list
"RTN","DVBARSBD",286,0)
 S CHGDAT="",CNT=0  ;use "" because value could be zero ("0")
"RTN","DVBARSBD",287,0)
 F  S CHGDAT=$O(^TMP("DVBREQN",$J,CHGDAT)) Q:(CHGDAT="")  D
"RTN","DVBARSBD",288,0)
 . S DVBIEN=0
"RTN","DVBARSBD",289,0)
 . F  S DVBIEN=$O(^TMP("DVBREQN",$J,CHGDAT,DVBIEN)) Q:'DVBIEN  D
"RTN","DVBARSBD",290,0)
 . . S CNT=CNT+1
"RTN","DVBARSBD",291,0)
 . . S ^TMP("DVBREQ",$J,CNT)=^TMP("DVBREQN",$J,CHGDAT,DVBIEN)
"RTN","DVBARSBD",292,0)
 Q
"RTN","DVBARSBD",293,0)
CLAIMTYP ;THE CLAIM TYPE OF A 2507 REQUEST
"RTN","DVBARSBD",294,0)
 S DVBCTW=""
"RTN","DVBARSBD",295,0)
 Q:'$D(^DVB(396.3,DVBIEN,9,0))
"RTN","DVBARSBD",296,0)
 ;DVBIEN is the 2507 REQUEST FILE IEN
"RTN","DVBARSBD",297,0)
 ;DVBCTW is the string /name of the CLAIM TYPE
"RTN","DVBARSBD",298,0)
 D GETS^DIQ(396.3,DVBIEN_",","9.1*","E","MSG","ERR")
"RTN","DVBARSBD",299,0)
 S DVBCTW=MSG("396.32","1,"_DVBIEN_",",".01","E")
"RTN","DVBARSBD",300,0)
 Q
"RTN","DVBARSBD",301,0)
SPEC ;SPECIAL CONSIDERATION(S) FOR A 2507 REQUEST
"RTN","DVBARSBD",302,0)
 K DVBSCW
"RTN","DVBARSBD",303,0)
 S DVBSCWA=""
"RTN","DVBARSBD",304,0)
 N DVBX
"RTN","DVBARSBD",305,0)
 Q:'$D(^DVB(396.3,DVBIEN,8))
"RTN","DVBARSBD",306,0)
 ;DVBIEN is the 2507 REQUEST FILE IEN
"RTN","DVBARSBD",307,0)
 ;DVBSC is a the SPECIAL CONSIDERATION entry for the 2507 REQUEST
"RTN","DVBARSBD",308,0)
 ;DVBSCN is the pointer number to the SPECIAL CONSIDERATION file 396.25
"RTN","DVBARSBD",309,0)
 ;DVBSCW is the string /name of the SPECIAL CONSIDERATION
"RTN","DVBARSBD",310,0)
 S DVBAA=$P(^DVB(396.3,DVBIEN,8,0),U,4)
"RTN","DVBARSBD",311,0)
 S (DVBSC,DVBCNT)=0 F  S DVBSC=$O(^DVB(396.3,DVBIEN,8,DVBSC)) Q:'DVBSC  D
"RTN","DVBARSBD",312,0)
 .S DVBSCN=$P(^DVB(396.3,DVBIEN,8,DVBSC,0),U,1)
"RTN","DVBARSBD",313,0)
 .S DVBSCW(DVBSC)=$G(^DVB(396.25,DVBSCN,0))
"RTN","DVBARSBD",314,0)
 .S DVBCNT=DVBCNT+1
"RTN","DVBARSBD",315,0)
 .I (DVBCNT'=DVBAA) S:$D(DVBSCW(DVBSC)) DVBSCW(DVBSC)=DVBSCW(DVBSC)_","
"RTN","DVBARSBD",316,0)
 S DVBX="" F  S DVBX=$O(DVBSCW(DVBX)) Q:'DVBX  S DVBSCWA=DVBSCWA_DVBSCW(DVBX)
"RTN","DVBARSBD",317,0)
 Q
"RTN","DVBCAMIS")
0^8^B18105359^B14811175
"RTN","DVBCAMIS",1,0)
DVBCAMIS ;ALB/GTS-557/THM-2507 AMIS REPORT ;21 MAY 89@0822 ; 5/23/91  1:30 PM
"RTN","DVBCAMIS",2,0)
 ;;2.7;AMIE;**17,149,184,192**;Apr 10, 1995;Build 15
"RTN","DVBCAMIS",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","DVBCAMIS",4,0)
 ;
"RTN","DVBCAMIS",5,0)
SETUP ;
"RTN","DVBCAMIS",6,0)
 ;
"RTN","DVBCAMIS",7,0)
 ; Check for AMIS 290 replacement URL
"RTN","DVBCAMIS",8,0)
 ;
"RTN","DVBCAMIS",9,0)
 ; Input:
"RTN","DVBCAMIS",10,0)
 ;   RTN - Return value, current URL
"RTN","DVBCAMIS",11,0)
 ;   WHICH - index of URL to retrieve
"RTN","DVBCAMIS",12,0)
 ;
"RTN","DVBCAMIS",13,0)
 ; Output:
"RTN","DVBCAMIS",14,0)
 ;   RTN - URL of location to replace this report
"RTN","DVBCAMIS",15,0)
 ;
"RTN","DVBCAMIS",16,0)
 N RTN,WHICH
"RTN","DVBCAMIS",17,0)
 S RTN="",WHICH=7
"RTN","DVBCAMIS",18,0)
 D URL^DVBABURL(.RTN,WHICH)
"RTN","DVBCAMIS",19,0)
 I RTN'="" W !,"The AMIS 290 Report is no longer available here.",!," Please go to: ",RTN Q
"RTN","DVBCAMIS",20,0)
 N DVBAPRTY,DVBAEXMP,DVBAP
"RTN","DVBCAMIS",21,0)
 S UPDATE="N",HD="AMIS 290 REPORT" I '$D(DT) S X="T" D ^%DT S DT=Y
"RTN","DVBCAMIS",22,0)
 S DVBCDT(0)=$$FMTE^XLFDT(DT,"5DZ")
"RTN","DVBCAMIS",23,0)
 D HOME^%ZIS S FF=IOF
"RTN","DVBCAMIS",24,0)
 ;prompt for priority of exam
"RTN","DVBCAMIS",25,0)
 S DVBAPRTY=$$EXMPRTY^DVBCIUTL("Select the Priority of Exam for the AMIS 290 Report")
"RTN","DVBCAMIS",26,0)
 G:('(DVBAPRTY?.A)!(DVBAPRTY']"")) EXIT  ;quit if no priority of exam selected 
"RTN","DVBCAMIS",27,0)
 ;
"RTN","DVBCAMIS",28,0)
INIT ;initialize counter arrays
"RTN","DVBCAMIS",29,0)
 S DVBAEXMP=$S($G(DVBAPRTY)["BDD":"BDD,QS",($G(DVBAPRTY)["IDES"):"IDES",($G(DVBAPRTY)["AO"):"AO",1:"ALL")
"RTN","DVBCAMIS",30,0)
 F JI="3DAYSCH","30DAYEX","PENDADJ","TRANSIN","TRNRETTO","TRNPNDTO","TRANSOUT","TRNRETFR","TRNPNDFR","INSUFF" D
"RTN","DVBCAMIS",31,0)
 .F DVBAP=1:1:$L(DVBAEXMP,",") S TOT($P(DVBAEXMP,",",DVBAP),JI)=0
"RTN","DVBCAMIS",32,0)
 F JI="RECEIVED","INCOMPLETE","DAYS","COMPLETED" D
"RTN","DVBCAMIS",33,0)
 .F DVBAP=1:1:$L(DVBAEXMP,",") S TOT($P(DVBAEXMP,",",DVBAP),JI)=0
"RTN","DVBCAMIS",34,0)
 F JI="P90","P121","P151","P181","P365","P366" D
"RTN","DVBCAMIS",35,0)
 .F DVBAP=1:1:$L(DVBAEXMP,",") S TOT($P(DVBAEXMP,",",DVBAP),JI)=0
"RTN","DVBCAMIS",36,0)
 ;
"RTN","DVBCAMIS",37,0)
EN W @IOF,!?(IOM-$L(HD)\2),HD,!!!
"RTN","DVBCAMIS",38,0)
 S %DT(0)=-DT,%DT="AE",%DT("A")="Enter STARTING DATE: " D ^%DT G:Y<0 EXIT S BDATE1=Y,BDATE=Y-.1
"RTN","DVBCAMIS",39,0)
 S %DT="AE",%DT("A")="    and ENDING DATE: " D ^%DT G:Y<0 EN S EDATE1=Y,EDATE=Y+.5
"RTN","DVBCAMIS",40,0)
 I EDATE1<BDATE1 W *7,!!,"Invalid date sequence - ending date is before starting date.",!! H 3 G EN
"RTN","DVBCAMIS",41,0)
ASK0 ;prompt for previous month pending count
"RTN","DVBCAMIS",42,0)
 N DIR,X,Y,DTOUT,DUOUT,DIRUT,DIROUT,DVBATXT
"RTN","DVBCAMIS",43,0)
 S DIR(0)="N^0:9999:0"
"RTN","DVBCAMIS",44,0)
 S DIR("?",1)="Enter the totals for the month previous to the one you are processing."
"RTN","DVBCAMIS",45,0)
 S DIR("?")="Must be a number from 0 to 9999."
"RTN","DVBCAMIS",46,0)
 S DIR("T")=DTIME  ;time-out value specified by system
"RTN","DVBCAMIS",47,0)
 W !!
"RTN","DVBCAMIS",48,0)
 ;get previous month pending count for each priority of exam to run
"RTN","DVBCAMIS",49,0)
 F DVBAP=1:1:$L(DVBAEXMP,",") Q:($G(DIRUT)!($G(DIROUT)))  D
"RTN","DVBCAMIS",50,0)
 .S DVBATXT=$$GPTYPE($P(DVBAEXMP,",",DVBAP))
"RTN","DVBCAMIS",51,0)
 .S DIR("A",1)="Please enter the total pending, "_DVBATXT
"RTN","DVBCAMIS",52,0)
 .S DIR("A")=" exam priorities, from the previous month"
"RTN","DVBCAMIS",53,0)
 .D ^DIR
"RTN","DVBCAMIS",54,0)
 .S:$L(DVBAEXMP,",")=1 PREVMO=$G(Y)
"RTN","DVBCAMIS",55,0)
 .S:$L(DVBAEXMP,",")>1 PREVMO($P(DVBAEXMP,",",DVBAP))=$G(Y)
"RTN","DVBCAMIS",56,0)
 G:($G(DIRUT)!($G(DIROUT))) EXIT  ;user timed/exited out
"RTN","DVBCAMIS",57,0)
 ;
"RTN","DVBCAMIS",58,0)
ASK K %DT S SBULL="Y"
"RTN","DVBCAMIS",59,0)
 W !!!,"Do you want to send a bulletin when processing is done"
"RTN","DVBCAMIS",60,0)
 S %=1 D YN^DICN G:$D(DTOUT)!(%<0) EXIT
"RTN","DVBCAMIS",61,0)
 I %=0 W !!,"Enter Y to send a bulletin to selected recipients or N not to send it at all.",!! G ASK
"RTN","DVBCAMIS",62,0)
 I %'=1 S SBULL="N"
"RTN","DVBCAMIS",63,0)
 I SBULL="Y" D BULL^DVBCAMI3
"RTN","DVBCAMIS",64,0)
 W ! S %ZIS="AEQ",%ZIS("A")="Output device: " D ^%ZIS G:POP EXIT
"RTN","DVBCAMIS",65,0)
 I $D(IO("Q")) S ZTRTN="GO^DVBCAMI2",ZTDESC="2507 Amis Report",ZTIO=ION F I="PREVMO*","RO*","BDATE*","TOT*","EDATE*","SBULL","DUZ","DVBCDT(0)","XM*","DVBAPRTY" S ZTSAVE(I)=""
"RTN","DVBCAMIS",66,0)
 I $D(IO("Q")) D ^%ZTLOAD W:$D(ZTSK) !!,"Request queued",!! H 1 K ZTSK G EXIT
"RTN","DVBCAMIS",67,0)
 G GO^DVBCAMI2
"RTN","DVBCAMIS",68,0)
 ;
"RTN","DVBCAMIS",69,0)
EXIT K PREVMO,UPDATE G KILL^DVBCUTIL
"RTN","DVBCAMIS",70,0)
 ;
"RTN","DVBCAMIS",71,0)
 ;
"RTN","DVBCAMIS",72,0)
 ;Input : DVBACDE - Code to get description for
"RTN","DVBCAMIS",73,0)
 ;           [BDD,QS,IDES,AO]
"RTN","DVBCAMIS",74,0)
 ;Ouput : Corresponding description for code
"RTN","DVBCAMIS",75,0)
GPTYPE(DVBACDE) ;get exam priority desc
"RTN","DVBCAMIS",76,0)
 N DVBATXT
"RTN","DVBCAMIS",77,0)
 Q:($G(DVBACDE)']"") ""
"RTN","DVBCAMIS",78,0)
 S DVBATXT=$S(DVBACDE="BDD":"'Benefits Delivery at Discharge ("_DVBACDE_")'",1:"")
"RTN","DVBCAMIS",79,0)
 S:(DVBATXT']"") DVBATXT=$S(DVBACDE="QS":"'Quick Start ("_DVBACDE_")'",1:"")
"RTN","DVBCAMIS",80,0)
 S:(DVBATXT']"") DVBATXT=$S(DVBACDE="IDES":"'Integrated Disability Evaluation System ("_DVBACDE_")'",1:"")
"RTN","DVBCAMIS",81,0)
 S:(DVBATXT']"") DVBATXT=$S(DVBACDE="AO":"'Agent Orange ("_DVBACDE_")'",1:"")
"RTN","DVBCAMIS",82,0)
 S:(DVBATXT']"") DVBATXT=$S(DVBACDE="ALL":"excluding BDD,QS,IDES and AO",1:"")
"RTN","DVBCAMIS",83,0)
 Q DVBATXT
"RTN","DVBCAMRO")
0^9^B13590807^B10848195
"RTN","DVBCAMRO",1,0)
DVBCAMRO ;ALB ISC/THM-REGIONAL OFFICE 2507 AMIS REPORT ; 9/28/91  6:39 AM
"RTN","DVBCAMRO",2,0)
 ;;2.7;AMIE;**17,149,184,192**;Apr 10, 1995;Build 15
"RTN","DVBCAMRO",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","DVBCAMRO",4,0)
 ;
"RTN","DVBCAMRO",5,0)
SETUP ;
"RTN","DVBCAMRO",6,0)
 ;
"RTN","DVBCAMRO",7,0)
 ; Check for AMIS 290 replacement URL
"RTN","DVBCAMRO",8,0)
 ;
"RTN","DVBCAMRO",9,0)
 ; Input:
"RTN","DVBCAMRO",10,0)
 ;   RTN - Return value, current URL
"RTN","DVBCAMRO",11,0)
 ;   WHICH - index of URL to retrieve
"RTN","DVBCAMRO",12,0)
 ;
"RTN","DVBCAMRO",13,0)
 ; Output:
"RTN","DVBCAMRO",14,0)
 ;   RTN - URL of location to replace this report
"RTN","DVBCAMRO",15,0)
 ;
"RTN","DVBCAMRO",16,0)
 N RTN,WHICH
"RTN","DVBCAMRO",17,0)
 S RTN="",WHICH=7
"RTN","DVBCAMRO",18,0)
 D URL^DVBABURL(.RTN,WHICH)
"RTN","DVBCAMRO",19,0)
 I Y'="" W !,"The AMIS 290 Regional Office Report is no longer available here.",!,"Please go to: ",RTN Q
"RTN","DVBCAMRO",20,0)
 N DVBAPRTY,DVBAEXMP,DVBAP,DTOUT,DUOUT
"RTN","DVBCAMRO",21,0)
 S UPDATE="N",PREVMO=$P(^DVB(396.1,1,0),U,11),HD="REGIONAL OFFICE 2507 AMIS REPORT" I '$D(DT) S X="T" D ^%DT S DT=Y
"RTN","DVBCAMRO",22,0)
 S DVBCDT(0)=$$FMTE^XLFDT(DT,"5DZ")
"RTN","DVBCAMRO",23,0)
 D HOME^%ZIS S FF=IOF
"RTN","DVBCAMRO",24,0)
 ;prompt for priority of exam
"RTN","DVBCAMRO",25,0)
 S DVBAPRTY=$$EXMPRTY^DVBCIUTL("Select the Priority of Exam for the 2507 AMIS Report")
"RTN","DVBCAMRO",26,0)
 G:('(DVBAPRTY?.A)!(DVBAPRTY']"")) EXIT  ;quit if no priority of exam selected
"RTN","DVBCAMRO",27,0)
 ;
"RTN","DVBCAMRO",28,0)
INIT ;initialize counter arrays
"RTN","DVBCAMRO",29,0)
 S DVBAEXMP=$S($G(DVBAPRTY)["BDD":"BDD,QS",($G(DVBAPRTY)["IDES"):"IDES",($G(DVBAPRTY)["AO"):"AO",1:"ALL")
"RTN","DVBCAMRO",30,0)
 F JI="3DAYSCH","30DAYEX","PENDADJ" D
"RTN","DVBCAMRO",31,0)
 .F DVBAP=1:1:$L(DVBAEXMP,",") S TOT($P(DVBAEXMP,",",DVBAP),JI)=0
"RTN","DVBCAMRO",32,0)
 F JI="INSUFF","SENT","INCOMPLETE","DAYS","COMPLETED" D
"RTN","DVBCAMRO",33,0)
 .F DVBAP=1:1:$L(DVBAEXMP,",") S TOT($P(DVBAEXMP,",",DVBAP),JI)=0
"RTN","DVBCAMRO",34,0)
 F JI="P90","P121","P151","P181","P365","P366" D
"RTN","DVBCAMRO",35,0)
 .F DVBAP=1:1:$L(DVBAEXMP,",") S TOT($P(DVBAEXMP,",",DVBAP),JI)=0
"RTN","DVBCAMRO",36,0)
 ;
"RTN","DVBCAMRO",37,0)
EN W @IOF,!?(IOM-$L(HD)\2),HD,!!!
"RTN","DVBCAMRO",38,0)
 S %DT(0)=-DT,%DT="AE",%DT("A")="Enter STARTING DATE: " D ^%DT G:Y<0 EXIT S BDATE1=Y,BDATE=Y-.1
"RTN","DVBCAMRO",39,0)
 S %DT="AE",%DT("A")="    and ENDING DATE: " D ^%DT G:Y<0 EN S EDATE1=Y,EDATE=Y+.5
"RTN","DVBCAMRO",40,0)
 I EDATE1<BDATE1 W *7,!!,"Invalid date sequence - ending date is before starting date.",!! H 3 G EN
"RTN","DVBCAMRO",41,0)
 W !!,"When selecting regional offices you may enter an individual station name,",!,"station number or nothing if all regional offices should be searched.",!!
"RTN","DVBCAMRO",42,0)
 S DIC("A")="Select REGIONAL OFFICE NUMBER: ",DIC(0)="AEQM",DIC="^DIC(4," D ^DIC G:($D(DTOUT)!($D(DUOUT))) EXIT
"RTN","DVBCAMRO",43,0)
 I +Y>0 S DA=+Y,RONUM=$S($D(^DIC(4,DA,99)):$P(^(99),U,1),1:"000"),RONAME=$P(Y,U,2)
"RTN","DVBCAMRO",44,0)
 I +Y<0 S (RONUM,RONAME)="ALL"
"RTN","DVBCAMRO",45,0)
 ;
"RTN","DVBCAMRO",46,0)
ASK K %DT S SBULL="Y" W !!!,"Want to send a bulletin when processing is done" S %=1 D YN^DICN G:$D(DTOUT)!(%<0) EXIT
"RTN","DVBCAMRO",47,0)
 I $D(%Y) I %Y["?" W !!,"Enter Y to send the bulletin to selected recipients or N not to send it at all.",!! G ASK
"RTN","DVBCAMRO",48,0)
 I %'=1 S SBULL="N"
"RTN","DVBCAMRO",49,0)
 I SBULL="Y" D BULL^DVBCAMR2
"RTN","DVBCAMRO",50,0)
 W ! S %ZIS="AEQ",%ZIS("B")="0;P-OTHER",%ZIS("A")="Output device: " D ^%ZIS G:POP EXIT
"RTN","DVBCAMRO",51,0)
 I $D(IO("Q")) S ZTRTN="GO^DVBCAMR2",ZTDESC="2507 Amis Report",ZTIO=ION F I="UPDATE","RO*","PREVMO","BDATE*","TOT*","EDATE*","SBULL","DUZ","DVBCDT(0)","XM*","DVBAPRTY" S ZTSAVE(I)=""
"RTN","DVBCAMRO",52,0)
 I $D(IO("Q")) D ^%ZTLOAD W:$D(ZTSK) !!,"Request queued",!! H 1 K ZTSK G EXIT
"RTN","DVBCAMRO",53,0)
 G GO^DVBCAMR2
"RTN","DVBCAMRO",54,0)
 ;
"RTN","DVBCAMRO",55,0)
EXIT K PREVMO,UPDATE G KILL^DVBCUTIL
"RTN","DVBCIRP2")
0^14^B81228394^n/a
"RTN","DVBCIRP2",1,0)
DVBCIRP2 ;ALB/RTW - CAPRI INSUFFICIENT 2507 RPT -CONT 1 ; 07/17/2015  4:24 AM
"RTN","DVBCIRP2",2,0)
 ;;2.7;AMIE;**192**;Apr 10, 1995;Build 15
"RTN","DVBCIRP2",3,0)
 ;Copied DVBCIRP1 and to remove all Priority of exam filter code for CAPRI only
"RTN","DVBCIRP2",4,0)
 ;CAPRI Insufficient Exam Report no longer uses priority of exam filters
"RTN","DVBCIRP2",5,0)
 ;no longer uses insufficient reason filters
"RTN","DVBCIRP2",6,0)
 ;** Version Changes
"RTN","DVBCIRP2",7,0)
 ;   2.7 - New routine (Enhc 1)
"RTN","DVBCIRP2",8,0)
 ;
"RTN","DVBCIRP2",9,0)
SUMRPT ;**Output the summary report
"RTN","DVBCIRP2",10,0)
 W:IOST?1"C-".E @IOF
"RTN","DVBCIRP2",11,0)
 D SUMHD
"RTN","DVBCIRP2",12,0)
 ;print request data
"RTN","DVBCIRP2",13,0)
 W !?3,"Total 2507 requests received for date range:",?71,$J(DVBARQCT,5)
"RTN","DVBCIRP2",14,0)
 W !?3,"Total insufficient 2507 requests received for date range:",?71,$J(DVBAINRQ,5)
"RTN","DVBCIRP2",15,0)
 W !?3,"Total insufficient 2507 requests cancelled by RO for date range:",?71,$J(DVBACAN("REQ"),5)
"RTN","DVBCIRP2",16,0)
 I DVBARQCT>0 D
"RTN","DVBCIRP2",17,0)
 .S PERCENT=(DVBAINRQ/DVBARQCT)*100
"RTN","DVBCIRP2",18,0)
 .W !?3,"% of insufficient requests per total requests received:",?71,$J(PERCENT,5,1)_"%"
"RTN","DVBCIRP2",19,0)
 .S PERCENT=((DVBAINRQ-DVBACAN("REQ"))/DVBARQCT)*100
"RTN","DVBCIRP2",20,0)
 .W !?3,"% of uncancelled insufficient requests per total requests received:",?71,$J(PERCENT,5,1)_"%"
"RTN","DVBCIRP2",21,0)
 I DVBARQCT'>0 D
"RTN","DVBCIRP2",22,0)
 .S PERCENT=0
"RTN","DVBCIRP2",23,0)
 .W !?3,"% of insufficient requests per total requests received:",?71,$J(PERCENT,5,1)_"%"
"RTN","DVBCIRP2",24,0)
 .W !?3,"% of uncancelled insufficient requests per total requests received:",?71,$J(PERCENT,5,1)_"%"
"RTN","DVBCIRP2",25,0)
 ;print exam data
"RTN","DVBCIRP2",26,0)
 W !!?3,"Total 2507 exams received for date range:",?71,$J(DVBAXMCT,5)
"RTN","DVBCIRP2",27,0)
 W !?3,"Total insufficient 2507 exams received for date range:",?71,$J(DVBAINXM,5)
"RTN","DVBCIRP2",28,0)
 W !?3,"Total insufficient 2507 exams cancelled by RO for date range:",?71,$J(DVBACAN("EXM"),5)
"RTN","DVBCIRP2",29,0)
 I DVBAXMCT>0 D
"RTN","DVBCIRP2",30,0)
 .S PERCENT=(DVBAINXM/DVBAXMCT)*100
"RTN","DVBCIRP2",31,0)
 .W !?3,"% of insufficient exams per total exams received:",?71,$J(PERCENT,5,1)_"%"
"RTN","DVBCIRP2",32,0)
 .S PERCENT=((DVBAINXM-DVBACAN("EXM"))/DVBAXMCT)*100
"RTN","DVBCIRP2",33,0)
 .W !?3,"% of uncancelled insufficient exams per total exams received:",?71,$J(PERCENT,5,1)_"%"
"RTN","DVBCIRP2",34,0)
 I DVBAXMCT'>0 D
"RTN","DVBCIRP2",35,0)
 .S PERCENT=0
"RTN","DVBCIRP2",36,0)
 .W !?3,"% of insufficient exams per total exams received:",?71,$J(PERCENT,5,1)_"%"
"RTN","DVBCIRP2",37,0)
 .W !?3,"% of uncancelled insufficient exams per total exams received:",?71,$J(PERCENT,5,1)_"%"
"RTN","DVBCIRP2",38,0)
 ;print insufficient reason data
"RTN","DVBCIRP2",39,0)
 I IOST?1"C-".E DO
"RTN","DVBCIRP2",40,0)
 .K DTOUT,DUOUT
"RTN","DVBCIRP2",41,0)
 .W !!
"RTN","DVBCIRP2",42,0)
 .D PAUSE^DVBCUTL4
"RTN","DVBCIRP2",43,0)
 .I '$D(DTOUT),('$D(DUOUT)) DO
"RTN","DVBCIRP2",44,0)
 ..W @IOF
"RTN","DVBCIRP2",45,0)
 ..D SUMHD
"RTN","DVBCIRP2",46,0)
 I '$D(DTOUT),('$D(DUOUT)) DO
"RTN","DVBCIRP2",47,0)
 .W:IOST'?1"C-".E !!
"RTN","DVBCIRP2",48,0)
 .W !?15,"Summary of insufficient exams per Reason",!
"RTN","DVBCIRP2",49,0)
 .W !?3,"Reason",?53,"Num",?59,"Percent"
"RTN","DVBCIRP2",50,0)
 .N DVBARSLP S DVBARSLP=""
"RTN","DVBCIRP2",51,0)
 .F  S DVBARSLP=$O(DVBAINXM(DVBARSLP)) Q:DVBARSLP=""  DO  ;**Reason tot's
"RTN","DVBCIRP2",52,0)
 ..W:+DVBARSLP>0 !?3,$P(^DVB(396.94,DVBARSLP,0),U,3),?53,DVBAINXM(DVBARSLP)
"RTN","DVBCIRP2",53,0)
 ..I +DVBARSLP'>0,(+DVBAINXM(DVBARSLP)>0) W !?3,"Exams without insufficient reason indicated",?53,DVBAINXM(DVBARSLP)
"RTN","DVBCIRP2",54,0)
 ..W:(+DVBAINXM(DVBARSLP)>0&(DVBAINXM>0)) ?59,($P(((DVBAINXM(DVBARSLP)/DVBAINXM)*100),".",1))_$S($E($P(((DVBAINXM(DVBARSLP)/DVBAINXM)*100),".",2),1,1)'="":"."_$E($P(((DVBAINXM(DVBARSLP)/DVBAINXM)*100),".",2),1,1),1:"")_" %"
"RTN","DVBCIRP2",55,0)
 .I IOST?1"C-".E DO
"RTN","DVBCIRP2",56,0)
 ..D CONTMES^DVBCUTL4
"RTN","DVBCIRP2",57,0)
 Q
"RTN","DVBCIRP2",58,0)
 ;
"RTN","DVBCIRP2",59,0)
SUMHD ;** Output Summary Report heading
"RTN","DVBCIRP2",60,0)
 N STRTDT,LSTDT,DVBATXT,DVBASL
"RTN","DVBCIRP2",61,0)
 W !?15,"Summary Insufficient Exam Report for ",$$SITE^DVBCUTL4(),!
"RTN","DVBCIRP2",62,0)
 S Y=$P(BEGDT,".",1) X ^DD("DD") S STRTDT=Y K Y
"RTN","DVBCIRP2",63,0)
 S Y=$P(ENDDT,".",1) X ^DD("DD") S LSTDT=Y K Y
"RTN","DVBCIRP2",64,0)
 S DVBASL=$L($$SITE^DVBCUTL4)
"RTN","DVBCIRP2",65,0)
 ;S DVBATXT=$$PRHD^DVBCIUTL(DVBAPRTY)
"RTN","DVBCIRP2",66,0)
 S DVBATXT=""
"RTN","DVBCIRP2",67,0)
 W ?(((67+DVBASL)-$L(DVBATXT))\2)
"RTN","DVBCIRP2",68,0)
 W !?16,"For Date Range: "_STRTDT_" to "_LSTDT,!
"RTN","DVBCIRP2",69,0)
 Q
"RTN","DVBCIRP2",70,0)
 ;
"RTN","DVBCIRP2",71,0)
DETAIL ;** Output reason, exam type and exam info
"RTN","DVBCIRP2",72,0)
 ;RSDA is the reason ien
"RTN","DVBCIRP2",73,0)
 ;TPDA is the exam type ien
"RTN","DVBCIRP2",74,0)
 ;XMDA is the exam ien from 396.4
"RTN","DVBCIRP2",75,0)
 ;DVBARQST is the request ien from 396.3
"RTN","DVBCIRP2",76,0)
 N STRTDT,LSTDT,DVBARQST,DVBAEXMP,DVBAP,DVBAPREXM,MSGCNT
"RTN","DVBCIRP2",77,0)
 S MSGCNT=0
"RTN","DVBCIRP2",78,0)
 K ^TMP("DVBAEXAMS",$J),^TMP("INSUFF",$J)
"RTN","DVBCIRP2",79,0)
 S X=$P(BEGDT,".",1),STRTDT=$$FMTE^XLFDT(X,"5DZ")
"RTN","DVBCIRP2",80,0)
 S Y=$P(ENDDT,".",1),LSTDT=$$FMTE^XLFDT(Y,"5DZ")
"RTN","DVBCIRP2",81,0)
 U IO
"RTN","DVBCIRP2",82,0)
 S DVBADTLP=BEGDT
"RTN","DVBCIRP2",83,0)
 S DVBAENDL=ENDDT
"RTN","DVBCIRP2",84,0)
 S RSDA=""
"RTN","DVBCIRP2",85,0)
 S DVBAPG1=""
"RTN","DVBCIRP2",86,0)
 F  S RSDA=$O(DVBAARY("REASON",RSDA)) Q:(RSDA=""!($D(GETOUT)))  DO
"RTN","DVBCIRP2",87,0)
 .K DVBARSPT
"RTN","DVBCIRP2",88,0)
 .S TPDA=""
"RTN","DVBCIRP2",89,0)
 .F  S TPDA=$O(^TMP($J,"XMTYPE",TPDA)) Q:(TPDA=""!($D(GETOUT)))  DO
"RTN","DVBCIRP2",90,0)
 ..K DVBAXMPT
"RTN","DVBCIRP2",91,0)
 ..S XMDA=""
"RTN","DVBCIRP2",92,0)
 ..F  S XMDA=$O(^DVB(396.4,"AIT",RSDA,TPDA,XMDA)) Q:(XMDA=""!($D(GETOUT)))  DO
"RTN","DVBCIRP2",93,0)
 ...S DVBARQST=$G(^DVB(396.3,$P(^DVB(396.4,XMDA,0),U,2),0))
"RTN","DVBCIRP2",94,0)
 ...I $P(DVBARQST,U,5)>DVBADTLP,($P(DVBARQST,U,5)<DVBAENDL) D
"RTN","DVBCIRP2",95,0)
 ....S ^TMP("DVBAEXAMS",$J,RSDA,TPDA,XMDA)=""
"RTN","DVBCIRP2",96,0)
 S DVBABIEN=DVBARQST
"RTN","DVBCIRP2",97,0)
 K DVBAPG1 S RSDA=""
"RTN","DVBCIRP2",98,0)
 D CAPDETHD^DVBCIUTL S DVBAPG1=""
"RTN","DVBCIRP2",99,0)
 F  S RSDA=$O(^TMP("DVBAEXAMS",$J,RSDA)) Q:(('+RSDA)!($D(GETOUT)))  D
"RTN","DVBCIRP2",100,0)
 .K DVBARSPT S TPDA=""
"RTN","DVBCIRP2",101,0)
 .F  S TPDA=$O(^TMP("DVBAEXAMS",$J,RSDA,TPDA)) Q:(('+TPDA)!($D(GETOUT)))  D
"RTN","DVBCIRP2",102,0)
 ..K DVBAXMPT S XMDA=""
"RTN","DVBCIRP2",103,0)
 ..F  S XMDA=$O(^TMP("DVBAEXAMS",$J,RSDA,TPDA,XMDA)) Q:(('+XMDA)!($D(GETOUT)))  D EXMOUT^DVBCIUTL
"RTN","DVBCIRP2",104,0)
 I '$D(GETOUT),(IOST?1"C-".E) D CONTMES^DVBCUTL4
"RTN","DVBCIRP2",105,0)
 K GETOUT W !
"RTN","DVBCIRP2",106,0)
 D ^%ZISC
"RTN","DVBCIRP2",107,0)
 D KVARS ;**KILL the variables used by DETAIL
"RTN","DVBCIRP2",108,0)
 Q
"RTN","DVBCIRP2",109,0)
 ;
"RTN","DVBCIRP2",110,0)
KVARS ;** Final Kill for Detail report
"RTN","DVBCIRP2",111,0)
 S:$D(ZTQUEUED) ZTREQ="@"
"RTN","DVBCIRP2",112,0)
 K ^TMP($J),DVBAARY,DVBANAME,DVBASSN,DVBACNUM,RSDA,TPDA,XMDA,DVBADTLP,DVBAENDL
"RTN","DVBCIRP2",113,0)
 Q
"RTN","DVBCIRP2",114,0)
 ;
"RTN","DVBCIRP2",115,0)
 ;
"RTN","DVBCIRP2",116,0)
 ;Input:  IEN of 2507 Request in File #396.3
"RTN","DVBCIRP2",117,0)
 ;Output: Priority of Exam for the Current/Parent 2507 Request
"RTN","DVBCIRP2",118,0)
CHKREQ(DVBARIEN) ;check for parent requests
"RTN","DVBCIRP2",119,0)
 N DVBAPIEN,DVBAPEXM
"RTN","DVBCIRP2",120,0)
 Q:($G(DVBARIEN)']"") ""
"RTN","DVBCIRP2",121,0)
 S DVBAPEXM=$P($G(^DVB(396.3,DVBARIEN,0)),U,10)  ;Priority of Exam
"RTN","DVBCIRP2",122,0)
 S DVBAPIEN=$P($G(^DVB(396.3,DVBARIEN,5)),U)  ;parent IEN if it exists
"RTN","DVBCIRP2",123,0)
 I (DVBAPIEN]"") D  ;Parent 2507 Request
"RTN","DVBCIRP2",124,0)
 .S DVBAPEXM=$P($G(^DVB(396.3,DVBAPIEN,0)),U,10)  ;Priority of Exam
"RTN","DVBCIRP2",125,0)
 Q DVBAPEXM
"RTN","DVBCIRP2",126,0)
SUM ;** Set up reason counter array, count all 2507's received
"RTN","DVBCIRP2",127,0)
 ;copied from DVBCIRPT 
"RTN","DVBCIRP2",128,0)
 N DVBAEXMP,DVBAI,DVBAP,DVBATVAR,DVBAMCDES,DVBAPREXM
"RTN","DVBCIRP2",129,0)
 U IO
"RTN","DVBCIRP2",130,0)
 S (DVBARQCT,DVBAINRQ,DVBAXMCT,DVBAINXM)=0
"RTN","DVBCIRP2",131,0)
 S DVBACAN("REQ")=0,DVBACAN("EXM")=0
"RTN","DVBCIRP2",132,0)
 S DVBAENDL=ENDDT
"RTN","DVBCIRP2",133,0)
 S DVBAEXMP=$S(($G(DVBAPRTY)["BDD"):";BDD;QS;",($G(DVBAPRTY)["IDES"):";IDES;",($G(DVBAPRTY)["AO"):";AO;",1:"")
"RTN","DVBCIRP2",134,0)
 ; S DVBAMCDES=((DVBAEXMP]"")&(DVBAPRTY'="AO"))
"RTN","DVBCIRP2",135,0)
 S NUMRPTS=$L(DVBAEXMP,";")
"RTN","DVBCIRP2",136,0)
 S DVBAMCDES=((DVBAEXMP]"")&(NUMRPTS>3))
"RTN","DVBCIRP2",137,0)
 K ^TMP("DVBATOTALS",$J)  ;for multiple priority reporting
"RTN","DVBCIRP2",138,0)
 ;
"RTN","DVBCIRP2",139,0)
 ;** Initialize reason counter array(s)
"RTN","DVBCIRP2",140,0)
 F DVBARIFN=0:0 S DVBARIFN=$O(^DVB(396.94,DVBARIFN)) Q:+DVBARIFN'>0  DO
"RTN","DVBCIRP2",141,0)
 .D:(DVBAMCDES)
"RTN","DVBCIRP2",142,0)
 ..F DVBAP=$P(DVBAEXMP,";",2),$P(DVBAEXMP,";",3)  D
"RTN","DVBCIRP2",143,0)
 ...Q:DVBAP=""
"RTN","DVBCIRP2",144,0)
 ...S ^TMP("DVBATOTALS",$J,DVBAP,"DVBAINXM",DVBARIFN)=0
"RTN","DVBCIRP2",145,0)
 .S DVBAINXM(DVBARIFN)=0
"RTN","DVBCIRP2",146,0)
 D:(DVBAMCDES)
"RTN","DVBCIRP2",147,0)
 .F DVBAP=$P(DVBAEXMP,";",2),$P(DVBAEXMP,";",3)  D
"RTN","DVBCIRP2",148,0)
 ..Q:DVBAP=""
"RTN","DVBCIRP2",149,0)
 ..S ^TMP("DVBATOTALS",$J,DVBAP,"DVBAINXM","NO REASON")=0
"RTN","DVBCIRP2",150,0)
 S DVBAINXM("NO REASON")=0
"RTN","DVBCIRP2",151,0)
 ;
"RTN","DVBCIRP2",152,0)
 ;** Count the total and insufficient number of exams and 2507 requests
"RTN","DVBCIRP2",153,0)
 ;     For performance, if multiple reports, store totals in single pass of data
"RTN","DVBCIRP2",154,0)
 S DVBADTLP=BEGDT-.0001
"RTN","DVBCIRP2",155,0)
 F  S DVBADTLP=$O(^DVB(396.3,"ADP",DVBADTLP)) Q:(DVBADTLP=""!(DVBADTLP>ENDDT))  DO
"RTN","DVBCIRP2",156,0)
 .S DVBAPRIO=""
"RTN","DVBCIRP2",157,0)
 .F  S DVBAPRIO=$O(^DVB(396.3,"ADP",DVBADTLP,DVBAPRIO)) Q:DVBAPRIO=""  DO
"RTN","DVBCIRP2",158,0)
 ..S DVBADALP=""
"RTN","DVBCIRP2",159,0)
 ..F  S DVBADALP=$O(^DVB(396.3,"ADP",DVBADTLP,DVBAPRIO,DVBADALP)) Q:DVBADALP=""  DO
"RTN","DVBCIRP2",160,0)
 ...;check for Parent Request (retrieve current/parent Priority of Exam)
"RTN","DVBCIRP2",161,0)
 ...S DVBAPREXM=$$CHKREQ(DVBADALP)
"RTN","DVBCIRP2",162,0)
 ...S DVBAPREXM=""
"RTN","DVBCIRP2",163,0)
 ...;original report run (Exclude new priorities)
"RTN","DVBCIRP2",164,0)
 ...Q:((DVBAEXMP']"")&((";BDD;QS;IDES;AO;")[(";"_DVBAPREXM_";")))
"RTN","DVBCIRP2",165,0)
 ...;report for specific Priority of Exam
"RTN","DVBCIRP2",166,0)
 ...Q:((DVBAEXMP]"")&(DVBAEXMP'[(";"_DVBAPREXM_";")))
"RTN","DVBCIRP2",167,0)
 ...S:(DVBAMCDES) ^TMP("DVBATOTALS",$J,DVBAPREXM,"DVBARQCT")=$G(^TMP("DVBATOTALS",$J,DVBAPREXM,"DVBARQCT"))+1
"RTN","DVBCIRP2",168,0)
 ...S DVBARQCT=DVBARQCT+1
"RTN","DVBCIRP2",169,0)
 ...K DVBAINSF
"RTN","DVBCIRP2",170,0)
 ...I DVBAPRIO="E" DO
"RTN","DVBCIRP2",171,0)
 ....S:(DVBAMCDES) ^TMP("DVBATOTALS",$J,DVBAPREXM,"DVBAINRQ")=$G(^TMP("DVBATOTALS",$J,DVBAPREXM,"DVBAINRQ"))+1
"RTN","DVBCIRP2",172,0)
 ....S DVBAINRQ=DVBAINRQ+1
"RTN","DVBCIRP2",173,0)
 ....I $P(^DVB(396.3,DVBADALP,0),U,18)="RX" D
"RTN","DVBCIRP2",174,0)
 .....S:(DVBAMCDES) ^TMP("DVBATOTALS",$J,DVBAPREXM,"DVBACANREQ")=$G(^TMP("DVBATOTALS",$J,DVBAPREXM,"DVBACANREQ"))+1
"RTN","DVBCIRP2",175,0)
 .....S DVBACAN("REQ")=DVBACAN("REQ")+1
"RTN","DVBCIRP2",176,0)
 ....S DVBAINSF=""
"RTN","DVBCIRP2",177,0)
 ...S DVBAXMDA=""
"RTN","DVBCIRP2",178,0)
 ...F  S DVBAXMDA=$O(^DVB(396.4,"C",DVBADALP,DVBAXMDA)) Q:DVBAXMDA=""  DO
"RTN","DVBCIRP2",179,0)
 ....S:(DVBAMCDES) ^TMP("DVBATOTALS",$J,DVBAPREXM,"DVBAXMCT")=$G(^TMP("DVBATOTALS",$J,DVBAPREXM,"DVBAXMCT"))+1
"RTN","DVBCIRP2",180,0)
 ....S DVBAXMCT=DVBAXMCT+1
"RTN","DVBCIRP2",181,0)
 ....I $D(DVBAINSF) DO
"RTN","DVBCIRP2",182,0)
 .....S:(DVBAMCDES) ^TMP("DVBATOTALS",$J,DVBAPREXM,"DVBAINXM")=$G(^TMP("DVBATOTALS",$J,DVBAPREXM,"DVBAINXM"))+1
"RTN","DVBCIRP2",183,0)
 .....S DVBAINXM=DVBAINXM+1
"RTN","DVBCIRP2",184,0)
 .....S DVBARIFN=$P(^DVB(396.4,DVBAXMDA,0),U,11),DVBASTAT=$P(^(0),U,4)
"RTN","DVBCIRP2",185,0)
 .....S:DVBARIFN="" DVBARIFN="NO REASON"
"RTN","DVBCIRP2",186,0)
 .....S:(DVBAMCDES) ^TMP("DVBATOTALS",$J,DVBAPREXM,"DVBAINXM",DVBARIFN)=$G(^TMP("DVBATOTALS",$J,DVBAPREXM,"DVBAINXM",DVBARIFN))+1
"RTN","DVBCIRP2",187,0)
 .....S DVBAINXM(DVBARIFN)=DVBAINXM(DVBARIFN)+1
"RTN","DVBCIRP2",188,0)
 .....I DVBASTAT="RX" D
"RTN","DVBCIRP2",189,0)
 ......S:(DVBAMCDES) ^TMP("DVBATOTALS",$J,DVBAPREXM,"DVBACANEXM")=$G(^TMP("DVBATOTALS",$J,DVBAPREXM,"DVBACANEXM"))+1
"RTN","DVBCIRP2",190,0)
 ......S DVBACAN("EXM")=DVBACAN("EXM")+1
"RTN","DVBCIRP2",191,0)
 ;
"RTN","DVBCIRP2",192,0)
 S DVBAEXMP=$S(($G(DVBAPRTY)["BDD"):"BDD,QS",($G(DVBAPRTY)["IDES"):"IDES",($G(DVBAPRTY)["AO"):"AO",1:"")
"RTN","DVBCIRP2",193,0)
 F DVBAI=1:1:$L(DVBAEXMP,",")  D
"RTN","DVBCIRP2",194,0)
 .S DVBAPRTY=$P(DVBAEXMP,",",DVBAI)  ;priority to report on
"RTN","DVBCIRP2",195,0)
 .D:(DVBAI>1)  ;Form Feed between multiple Reports
"RTN","DVBCIRP2",196,0)
 ..S DVBATVAR(1,0)="0,0,0,0,1^"
"RTN","DVBCIRP2",197,0)
 ..D WR^DVBAUTL4("DVBATVAR")
"RTN","DVBCIRP2",198,0)
 .;
"RTN","DVBCIRP2",199,0)
 .D:(DVBAMCDES)  ;reset var cntrs for specific priority
"RTN","DVBCIRP2",200,0)
 ..S DVBARQCT=+$G(^TMP("DVBATOTALS",$J,DVBAPRTY,"DVBARQCT"))
"RTN","DVBCIRP2",201,0)
 ..S DVBAINRQ=+$G(^TMP("DVBATOTALS",$J,DVBAPRTY,"DVBAINRQ"))
"RTN","DVBCIRP2",202,0)
 ..S DVBACAN("REQ")=+$G(^TMP("DVBATOTALS",$J,DVBAPRTY,"DVBACANREQ"))
"RTN","DVBCIRP2",203,0)
 ..S DVBAXMCT=+$G(^TMP("DVBATOTALS",$J,DVBAPRTY,"DVBAXMCT"))
"RTN","DVBCIRP2",204,0)
 ..S DVBAINXM=+$G(^TMP("DVBATOTALS",$J,DVBAPRTY,"DVBAINXM"))
"RTN","DVBCIRP2",205,0)
 ..S DVBAP=0 F  S DVBAP=$O(^TMP("DVBATOTALS",$J,DVBAPRTY,"DVBAINXM",DVBAP)) Q:DVBAP=""  D
"RTN","DVBCIRP2",206,0)
 ...S DVBAINXM(DVBAP)=+$G(^TMP("DVBATOTALS",$J,DVBAPRTY,"DVBAINXM",DVBAP))
"RTN","DVBCIRP2",207,0)
 ..S DVBACAN("EXM")=+$G(^TMP("DVBATOTALS",$J,DVBAPRTY,"DVBACANEXM"))
"RTN","DVBCIRP2",208,0)
 .;
"RTN","DVBCIRP2",209,0)
 .D SUMRPT  ;print SUMMARY report
"RTN","DVBCIRP2",210,0)
 S:$D(ZTQUEUED) ZTREQ="@"
"RTN","DVBCIRP2",211,0)
 D SUMKILL
"RTN","DVBCIRP2",212,0)
 D ^%ZISC
"RTN","DVBCIRP2",213,0)
 Q
"RTN","DVBCIRP2",214,0)
 ;
"RTN","DVBCIRP2",215,0)
SUMKILL ;** Kill the variables used in the summary report
"RTN","DVBCIRP2",216,0)
 K DVBADTLP,DVBAENDL,DVBARQCT,DVBAINRQ,DVBAXMCT,DVBAINXM
"RTN","DVBCIRP2",217,0)
 K DVBAPRIO,DVBADALP,DVBAXMDA,DVBAINSF,DVBARIFN
"RTN","DVBCIRP2",218,0)
 K ^TMP("DVBATOTALS",$J)
"RTN","DVBCIRP2",219,0)
 Q
"RTN","DVBCIUTL")
0^11^B91825542^B63990855
"RTN","DVBCIUTL",1,0)
DVBCIUTL ;ALB/GTS-AMIE INSUFFICIENT RPT UTILITY RTN ; 11/14/94  9:15 AM
"RTN","DVBCIUTL",2,0)
 ;;2.7;AMIE;**13,17,19,149,184,185,192**;Apr 10, 1995;Build 15
"RTN","DVBCIUTL",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","DVBCIUTL",4,0)
 ;
"RTN","DVBCIUTL",5,0)
 ;** Version Changes
"RTN","DVBCIUTL",6,0)
 ;   2.7 - New routine (Enhc 15)
"RTN","DVBCIUTL",7,0)
 ;
"RTN","DVBCIUTL",8,0)
DETHD ;** AMIE Detailed Report header
"RTN","DVBCIUTL",9,0)
 N DVBAI,DVBATXT S DVBAI=2
"RTN","DVBCIUTL",10,0)
 ;I DVBADLMTR="," S:DVBAPRTY'["QS" MSGCNT=1 S:$G(DVBAP)="QS" ^TMP("INSUFF",$J,MSGCNT)=$C(13)_$C(13),MSGCNT=MSGCNT+1 D DETHDLIM Q 
"RTN","DVBCIUTL",11,0)
 I DVBADLMTR="," D  Q
"RTN","DVBCIUTL",12,0)
 . S MSGCNT=MSGCNT+1
"RTN","DVBCIUTL",13,0)
 . S:$G(DVBAP)="QS" ^TMP("INSUFF",$J,MSGCNT)=$C(13)_$C(13),MSGCNT=MSGCNT+1 D DETHDLIM Q
"RTN","DVBCIUTL",14,0)
 . I MSGCNT=1!(MSGCNT=2) D DETHDLIM Q
"RTN","DVBCIUTL",15,0)
 S:'$D(DVBAPG1) TVAR(1,0)="0,15,0,1,0^Detailed Insufficient Exam Report"
"RTN","DVBCIUTL",16,0)
 S:$D(DVBAPG1) TVAR(1,0)="0,15,0,1,1^Detailed Insufficient Exam Report"
"RTN","DVBCIUTL",17,0)
 S DVBATXT=$$PRHD(DVBAPRTY)
"RTN","DVBCIUTL",18,0)
 S TVAR(DVBAI,0)="0,"_((63-$L(DVBATXT))\2)_",0,1,0^"_DVBATXT
"RTN","DVBCIUTL",19,0)
 S DVBAI=DVBAI+1
"RTN","DVBCIUTL",20,0)
 S TVAR(DVBAI,0)="0,11,0,2,0^For Date Range: "_STRTDT_" to "_LSTDT
"RTN","DVBCIUTL",21,0)
 D WR^DVBAUTL4("TVAR")
"RTN","DVBCIUTL",22,0)
 K TVAR
"RTN","DVBCIUTL",23,0)
 Q
"RTN","DVBCIUTL",24,0)
CAPDETHD ;** CAPRI Detailed Report header
"RTN","DVBCIUTL",25,0)
 N DVBAI,DVBATXT S DVBAI=2
"RTN","DVBCIUTL",26,0)
 I DVBADLMTR="," D  Q
"RTN","DVBCIUTL",27,0)
 . S MSGCNT=MSGCNT+1
"RTN","DVBCIUTL",28,0)
 . I MSGCNT=1!(MSGCNT=2) D DETHDLIM Q
"RTN","DVBCIUTL",29,0)
 S:'$D(DVBAPG1) TVAR(1,0)="0,15,0,1,0^Detailed Insufficient Exam Report"
"RTN","DVBCIUTL",30,0)
 S:$D(DVBAPG1) TVAR(1,0)="0,15,0,1,1^Detailed Insufficient Exam Report"
"RTN","DVBCIUTL",31,0)
 S DVBATXT=""
"RTN","DVBCIUTL",32,0)
 S TVAR(DVBAI,0)="0,"_((63-$L(DVBATXT))\2)_",0,0,0^"_DVBATXT
"RTN","DVBCIUTL",33,0)
 S DVBAI=DVBAI+1
"RTN","DVBCIUTL",34,0)
 S TVAR(DVBAI,0)="0,11,0,1,0^For Date Range: "_STRTDT_" to "_LSTDT
"RTN","DVBCIUTL",35,0)
 D WR^DVBAUTL4("TVAR")
"RTN","DVBCIUTL",36,0)
 K TVAR
"RTN","DVBCIUTL",37,0)
 Q
"RTN","DVBCIUTL",38,0)
 ;
"RTN","DVBCIUTL",39,0)
DETHDLIM ;Print Report Header in delimited format
"RTN","DVBCIUTL",40,0)
 S ^TMP("INSUFF",$J,MSGCNT)="Detailed Insufficient Exam Report"_$C(13),MSGCNT=MSGCNT+1
"RTN","DVBCIUTL",41,0)
 S ^TMP("INSUFF",$J,MSGCNT)="FOR DATE RANGE: "_STRTDT_" TO "_LSTDT_$C(13)_$C(13),MSGCNT=MSGCNT+1
"RTN","DVBCIUTL",42,0)
 S ^TMP("INSUFF",$J,MSGCNT)="Reason"_DVBADLMTR_"Exam"_DVBADLMTR_"Provider"_DVBADLMTR_"Exam Date"_DVBADLMTR_"Patient Name"_DVBADLMTR_"SSN"_DVBADLMTR
"RTN","DVBCIUTL",43,0)
 S ^TMP("INSUFF",$J,MSGCNT)=^TMP("INSUFF",$J,MSGCNT)_"Claim #"_DVBADLMTR_"Claim Type"_DVBADLMTR_"Special Consideration(s)"_DVBADLMTR_"Priority of Exam"_DVBADLMTR
"RTN","DVBCIUTL",44,0)
 S ^TMP("INSUFF",$J,MSGCNT)=^TMP("INSUFF",$J,MSGCNT)_"Cancellation Information"_DVBADLMTR_"Cancellation Reason"_$C(13),MSGCNT=MSGCNT+1
"RTN","DVBCIUTL",45,0)
 Q
"RTN","DVBCIUTL",46,0)
 ;
"RTN","DVBCIUTL",47,0)
 ;Input : DVBAPRTY - Priority Exam Code (File #396.3 Fld #9)
"RTN","DVBCIUTL",48,0)
 ;Output: Description for Priority Exam Code
"RTN","DVBCIUTL",49,0)
PRHD(DVBAPRTY) ;priority exam type header info
"RTN","DVBCIUTL",50,0)
 N DVBATXT
"RTN","DVBCIUTL",51,0)
 S DVBATXT=$S((DVBAPRTY["BDD"):"Benefits Delivery at Discharge",1:"X")
"RTN","DVBCIUTL",52,0)
 S:(DVBATXT="X") DVBATXT=$S((DVBAPRTY["QS"):"Quick Start",1:"X")
"RTN","DVBCIUTL",53,0)
 S:(DVBATXT="X") DVBATXT=$S((DVBAPRTY["IDES"):"Integrated Disability Evaluation System",1:"X")
"RTN","DVBCIUTL",54,0)
 S:(DVBATXT="X") DVBATXT=$S((DVBAPRTY["AO"):"Agent Orange",1:"Excludes Exam Priorities: AO,BDD,IDES,QS")
"RTN","DVBCIUTL",55,0)
 S:(DVBATXT'["Excludes") DVBATXT="Priority of Exam: "_DVBATXT
"RTN","DVBCIUTL",56,0)
 Q $G(DVBATXT)
"RTN","DVBCIUTL",57,0)
 ;
"RTN","DVBCIUTL",58,0)
EXMOUT ;** Output exam information for reason/type
"RTN","DVBCIUTL",59,0)
 I $Y>(IOSL-9) DO
"RTN","DVBCIUTL",60,0)
 .I IOST?1"C-".E D TERM^DVBCUTL3
"RTN","DVBCIUTL",61,0)
 D
"RTN","DVBCIUTL",62,0)
 .I '$D(GETOUT) DO
"RTN","DVBCIUTL",63,0)
 ..;D DETHD
"RTN","DVBCIUTL",64,0)
 ..D RESOUT
"RTN","DVBCIUTL",65,0)
 ..W !
"RTN","DVBCIUTL",66,0)
 ..D TYPEOUT
"RTN","DVBCIUTL",67,0)
 ..S (DVBARSPT,DVBAXMPT)=""
"RTN","DVBCIUTL",68,0)
 I '$D(GETOUT) DO
"RTN","DVBCIUTL",69,0)
 .I '$D(DVBARSPT) DO
"RTN","DVBCIUTL",70,0)
 ..D RESOUT
"RTN","DVBCIUTL",71,0)
 ..S DVBARSPT=""
"RTN","DVBCIUTL",72,0)
 .I '$D(DVBAXMPT) DO
"RTN","DVBCIUTL",73,0)
 ..W !
"RTN","DVBCIUTL",74,0)
 ..D TYPEOUT
"RTN","DVBCIUTL",75,0)
 ..S DVBAXMPT=""
"RTN","DVBCIUTL",76,0)
 .S (DVBARQDT,DVBAXDT,DVBAXRS)=""
"RTN","DVBCIUTL",77,0)
 .S REQDA=$P(^DVB(396.4,XMDA,0),U,2) ;*REQDA of PRIORITY Insuf 2507
"RTN","DVBCIUTL",78,0)
 .I $D(^DVB(396.4,XMDA,"CAN")) D
"RTN","DVBCIUTL",79,0)
 ..S DVBAXDT=$P(^DVB(396.4,XMDA,"CAN"),U,1),DVBAXRS=$P(^("CAN"),U,3)
"RTN","DVBCIUTL",80,0)
 ..I DVBAXDT S DVBAXDT=$$FMTE^XLFDT(DVBAXDT,"5DZ")
"RTN","DVBCIUTL",81,0)
 ..I DVBAXRS S DVBAXRS=$P(^DVB(396.5,DVBAXRS,0),U,1)
"RTN","DVBCIUTL",82,0)
 .I +REQDA>0 DO  ;*Get REQDA of Orig 2507
"RTN","DVBCIUTL",83,0)
 ..S DFN=$P(^DVB(396.3,REQDA,0),U,1),DVBARQDT=$P(^(0),U,2),DVBARQDT=$$FMTE^XLFDT(DVBARQDT,"5DZ")
"RTN","DVBCIUTL",84,0)
 ..I '$D(^DVB(396.3,REQDA,5)) S REQDA=""
"RTN","DVBCIUTL",85,0)
 ..I +REQDA>0,($D(^DVB(396.3,REQDA,5))) S REQDA=$P(^DVB(396.3,REQDA,5),U,1)
"RTN","DVBCIUTL",86,0)
 .S DVBAORXM=""
"RTN","DVBCIUTL",87,0)
 .I +REQDA>0 DO  ;*If link to orig 2507
"RTN","DVBCIUTL",88,0)
 ..S DVBAXMTP=$P(^DVB(396.4,XMDA,0),U,3)
"RTN","DVBCIUTL",89,0)
 ..S DVBACMND="F  S DVBAORXM=$O(^DVB(396.4,""ARQ"_REQDA_""","_DVBAXMTP_",DVBAORXM)) Q:DVBAORXM=""""  Q:$D(^DVB(396.4,""APS"","_DFN_","_DVBAXMTP_",""C"",DVBAORXM))"
"RTN","DVBCIUTL",90,0)
 ..X DVBACMND ;**Return DA of original, insuff exam
"RTN","DVBCIUTL",91,0)
 .S DVBANAME=$P(^DPT(DFN,0),U,1)
"RTN","DVBCIUTL",92,0)
 .D DEM^VADPT I $G(VADM(1))'="" S DVBASSN=$S(DVBADLMTR=",":$P($G(VADM(2)),U,2),1:$P($G(VADM(2)),U,1))
"RTN","DVBCIUTL",93,0)
 .S DVBACNUM="" S:$D(^DPT(DFN,.31)) DVBACNUM=$P(^DPT(DFN,.31),U,3)
"RTN","DVBCIUTL",94,0)
 .I DVBAORXM'="",($D(^DVB(396.4,DVBAORXM,0))) S DVBAORDT=$P(^DVB(396.4,DVBAORXM,0),U,6)
"RTN","DVBCIUTL",95,0)
 .I DVBAORXM'="",('$D(^DVB(396.4,DVBAORXM,0))) S (DVBAORDT,DVBADTE)=""
"RTN","DVBCIUTL",96,0)
 .S:DVBAORXM="" (DVBAORDT,DVBADTE)=""
"RTN","DVBCIUTL",97,0)
 .S:DVBAORDT="" DVBADTE=""
"RTN","DVBCIUTL",98,0)
 .I DVBAORDT'="" DO
"RTN","DVBCIUTL",99,0)
 ..S DVBADTWK=$P(DVBAORDT,".",1)
"RTN","DVBCIUTL",100,0)
 ..S DVBADTE=$$FMTE^XLFDT(DVBADTWK,"5DZ")
"RTN","DVBCIUTL",101,0)
 .S DVBAORPV=$P(^DVB(396.4,XMDA,0),U,12)
"RTN","DVBCIUTL",102,0)
 .S DVBABIEN=$P(^DVB(396.4,XMDA,0),U,2)
"RTN","DVBCIUTL",103,0)
 .D CLAIMTYP,SPEC,PRIORITY
"RTN","DVBCIUTL",104,0)
 .I DVBADLMTR="," D DETDELIM D:DVBAXDT]"" DETITEMS S ^TMP("INSUFF",$J,MSGCNT)=^TMP("INSUFF",$J,MSGCNT)_$C(13),MSGCNT=MSGCNT+1 Q
"RTN","DVBCIUTL",105,0)
 .S DVBAORP1=$E(DVBAORPV,1,15)
"RTN","DVBCIUTL",106,0)
 .S DVBANAM1=$E(DVBANAME,1,15)
"RTN","DVBCIUTL",107,0)
 .W !,DVBAORP1
"RTN","DVBCIUTL",108,0)
 .W:$L(DVBAORPV)>$L(DVBAORP1) "**" ;**Indicate that Dr.'s Name truncated
"RTN","DVBCIUTL",109,0)
 .W ?20,DVBADTE,?32,DVBANAM1
"RTN","DVBCIUTL",110,0)
 .W:$L(DVBANAME)>$L(DVBANAM1) "**" ;**Indicate that Vet's Name truncated
"RTN","DVBCIUTL",111,0)
 .W ?52,DVBASSN,?66,DVBACNUM
"RTN","DVBCIUTL",112,0)
 .W !,?2,"Claim Type: "_DVBCTW,!,?2,"Special Consideration(s): "_DVBSCWA,!,?2,"Priority Of Exam: "_DVBPOX
"RTN","DVBCIUTL",113,0)
 .I DVBAXDT]"" D
"RTN","DVBCIUTL",114,0)
 ..W !,"Exam request of "_DVBARQDT_" to correct insufficiency was cancelled on "_DVBAXDT_"."
"RTN","DVBCIUTL",115,0)
 ..W !,"Reason: "_DVBAXRS_"."
"RTN","DVBCIUTL",116,0)
 K DVBAA,DVBABIEN,DVBSC,DVBSCC,DVBSCN,DVBSCNS,DVBSCW,DVBSCWA,DVBPOX,DVBPOXID
"RTN","DVBCIUTL",117,0)
 Q
"RTN","DVBCIUTL",118,0)
 ;
"RTN","DVBCIUTL",119,0)
DETDELIM ; Print details of Insufficient Exams
"RTN","DVBCIUTL",120,0)
 ; Reason,Exam,Provider,Exam Date,Patient Name,SSN,Claim #,Claim Type,Special Consideration(s),Priority of Exam
"RTN","DVBCIUTL",121,0)
 I $D(^TMP("INSUFF",$J,MSGCNT)) D
"RTN","DVBCIUTL",122,0)
 .S ^TMP("INSUFF",$J,MSGCNT)=^TMP("INSUFF",$J,MSGCNT)_""""_DVBAORPV_""""_DVBADLMTR_DVBADTE_DVBADLMTR_""""_DVBANAME_""""_DVBADLMTR_DVBASSN_DVBADLMTR
"RTN","DVBCIUTL",123,0)
 .S ^TMP("INSUFF",$J,MSGCNT)=^TMP("INSUFF",$J,MSGCNT)_$C(160)_DVBACNUM_DVBADLMTR_DVBCTW_DVBADLMTR_""""_DVBSCWA_""""_DVBADLMTR_DVBPOX_"" Q
"RTN","DVBCIUTL",124,0)
 I '$D(^TMP("INSUFF",$J,MSGCNT)) D
"RTN","DVBCIUTL",125,0)
 .S ^TMP("INSUFF",$J,MSGCNT)=DVBADLMTR_DVBADLMTR_""""_DVBAORPV_""""_DVBADLMTR_DVBADTE_DVBADLMTR_""""_DVBANAME_""""_DVBADLMTR_DVBASSN_DVBADLMTR_$C(160)_DVBACNUM_DVBADLMTR_DVBCTW_DVBADLMTR_""""_DVBSCWA_""""_DVBADLMTR_DVBPOX_""
"RTN","DVBCIUTL",126,0)
 Q
"RTN","DVBCIUTL",127,0)
 ;
"RTN","DVBCIUTL",128,0)
DETITEMS ; Print final exam details
"RTN","DVBCIUTL",129,0)
 S ^TMP("INSUFF",$J,MSGCNT)=^TMP("INSUFF",$J,MSGCNT)_DVBADLMTR_"Exam request of "_DVBARQDT_" to correct insufficiency was cancelled on "_DVBAXDT_"."
"RTN","DVBCIUTL",130,0)
 S ^TMP("INSUFF",$J,MSGCNT)=^TMP("INSUFF",$J,MSGCNT)_DVBADLMTR_DVBAXRS_"."
"RTN","DVBCIUTL",131,0)
 Q
"RTN","DVBCIUTL",132,0)
 ;
"RTN","DVBCIUTL",133,0)
RESOUT ;** Output the Reason
"RTN","DVBCIUTL",134,0)
 I DVBADLMTR="," S ^TMP("INSUFF",$J,MSGCNT)=$P(^DVB(396.94,$P(^DVB(396.4,XMDA,0),U,11),0),U,3)_DVBADLMTR Q
"RTN","DVBCIUTL",135,0)
 W !!!!!,"Reason: ",$P(^DVB(396.94,$P(^DVB(396.4,XMDA,0),U,11),0),U,3)
"RTN","DVBCIUTL",136,0)
 Q
"RTN","DVBCIUTL",137,0)
 ;
"RTN","DVBCIUTL",138,0)
TYPEOUT ;** Output the Exam
"RTN","DVBCIUTL",139,0)
 I DVBADLMTR="," D TYPEDLIM Q 
"RTN","DVBCIUTL",140,0)
 W !,"Exam: ",$P(^DVB(396.6,$P(^DVB(396.4,XMDA,0),U,3),0),U,2)
"RTN","DVBCIUTL",141,0)
 W !,"Provider",?20,"Exam Dt",?32,"Patient Name",?52,"SSN",?66,"Claim #"
"RTN","DVBCIUTL",142,0)
 Q
"RTN","DVBCIUTL",143,0)
 ;
"RTN","DVBCIUTL",144,0)
TYPEDLIM ; ** Output the delimited Exam 
"RTN","DVBCIUTL",145,0)
 I $D(^TMP("INSUFF",$J,MSGCNT)) S ^TMP("INSUFF",$J,MSGCNT)=^TMP("INSUFF",$J,MSGCNT)_""""_$P(^DVB(396.6,$P(^DVB(396.4,XMDA,0),U,3),0),U,2)_""""_DVBADLMTR Q
"RTN","DVBCIUTL",146,0)
 I '$D(^TMP("INSUFF",$J,MSGCNT)) S ^TMP("INSUFF",$J,MSGCNT)=$P(^DVB(396.94,$P(^DVB(396.4,XMDA,0),U,11),0),U,3)_DVBADLMTR_""""_$P(^DVB(396.6,$P(^DVB(396.4,XMDA,0),U,3),0),U,2)_""""_DVBADLMTR Q
"RTN","DVBCIUTL",147,0)
 ;
"RTN","DVBCIUTL",148,0)
RSEL ;** Select Reasons
"RTN","DVBCIUTL",149,0)
 ;** The selection prompt is defaulted to ALL.  If the user selects
"RTN","DVBCIUTL",150,0)
 ;**  'All', only reasons for exams entered on requests with a
"RTN","DVBCIUTL",151,0)
 ;**  priority of 'Insufficient' will be reported.  Not all reasons.
"RTN","DVBCIUTL",152,0)
 ;
"RTN","DVBCIUTL",153,0)
 W @IOF,!
"RTN","DVBCIUTL",154,0)
 W !,"Insufficient Reason Selection"
"RTN","DVBCIUTL",155,0)
 S DVBCYQ=""
"RTN","DVBCIUTL",156,0)
 N RESANS,DVBAOUT S DVBAOUT="" ;**Pre-read
"RTN","DVBCIUTL",157,0)
 K Y,DTOUT,DUOUT,DVBATSAV
"RTN","DVBCIUTL",158,0)
 F  Q:(DVBAOUT=1!(DVBCYQ=1))  DO
"RTN","DVBCIUTL",159,0)
 .W !!,"  Enter '^' to end Reason Selection"
"RTN","DVBCIUTL",160,0)
 .W !,"  'Return' to select all Insufficient Reasons",!
"RTN","DVBCIUTL",161,0)
 .K DIC,DTOUT,DUOUT,Y
"RTN","DVBCIUTL",162,0)
 .W !,"  Enter Insufficient Reason: ALL//"
"RTN","DVBCIUTL",163,0)
 .R RESANS:DTIME
"RTN","DVBCIUTL",164,0)
 .S:$T DVBATSAV=""
"RTN","DVBCIUTL",165,0)
 .I RESANS=""&($D(DVBATSAV)) S Y=-1 D INREAS^DVBCIUT1
"RTN","DVBCIUTL",166,0)
 .S:('$D(DVBATSAV)!(RESANS["^")) DVBAOUT="1"
"RTN","DVBCIUTL",167,0)
 .I DVBAOUT'=1,('$D(Y)) DO
"RTN","DVBCIUTL",168,0)
 ..I RESANS["?" DO
"RTN","DVBCIUTL",169,0)
 ...N LPDA S LPDA=0
"RTN","DVBCIUTL",170,0)
 ...W !,"CHOOSE FROM:"
"RTN","DVBCIUTL",171,0)
 ...F  S LPDA=$O(^DVB(396.94,LPDA)) Q:+LPDA'>0  DO
"RTN","DVBCIUTL",172,0)
 ....W !,?3,$P(^DVB(396.94,LPDA,0),U,1)
"RTN","DVBCIUTL",173,0)
 ...W !
"RTN","DVBCIUTL",174,0)
 ..I RESANS'["?" DO
"RTN","DVBCIUTL",175,0)
 ...S DIC="^DVB(396.94,"
"RTN","DVBCIUTL",176,0)
 ...S DIC(0)="EMQ"
"RTN","DVBCIUTL",177,0)
 ...S X=RESANS
"RTN","DVBCIUTL",178,0)
 ...D ^DIC
"RTN","DVBCIUTL",179,0)
 ...D:+Y>0 INREAS^DVBCIUT1
"RTN","DVBCIUTL",180,0)
 .I RESANS="",($D(Y)&(+Y=-1)) S DVBCYQ=1
"RTN","DVBCIUTL",181,0)
 K DTOUT,DUOUT,Y,DIC,DVBCYQ,DVBATSAV
"RTN","DVBCIUTL",182,0)
 Q
"RTN","DVBCIUTL",183,0)
 ;
"RTN","DVBCIUTL",184,0)
XMSEL ;** Select Exams
"RTN","DVBCIUTL",185,0)
 ;** The selection prompt is defaulted to ALL.  If the user selects
"RTN","DVBCIUTL",186,0)
 ;**  'All', only exams entered on requests with a priority of 
"RTN","DVBCIUTL",187,0)
 ;**  'Insufficient' will be reported.  Not all exams.
"RTN","DVBCIUTL",188,0)
 ;
"RTN","DVBCIUTL",189,0)
 W @IOF,!
"RTN","DVBCIUTL",190,0)
 W !,"AMIE Exam Selection"
"RTN","DVBCIUTL",191,0)
 S DVBCYQ=""
"RTN","DVBCIUTL",192,0)
 K Y,DTOUT,DUOUT
"RTN","DVBCIUTL",193,0)
 F  Q:($D(DTOUT)!($D(DUOUT)!(DVBCYQ=1)))  DO
"RTN","DVBCIUTL",194,0)
 .W !!,"  Enter '^' to end Exam Selection"
"RTN","DVBCIUTL",195,0)
 .W !,"  'Return' to select all AMIE Exams",!
"RTN","DVBCIUTL",196,0)
 .K DIC,DTOUT,DUOUT
"RTN","DVBCIUTL",197,0)
 .S DIC="^DVB(396.6,"
"RTN","DVBCIUTL",198,0)
 .S DIC(0)="AEMQ"
"RTN","DVBCIUTL",199,0)
 .S DIC("A")="  Enter Exam: ALL//"
"RTN","DVBCIUTL",200,0)
 .;removed screen for inactive exams
"RTN","DVBCIUTL",201,0)
 .D ^DIC
"RTN","DVBCIUTL",202,0)
 .I '$D(DTOUT),('$D(DUOUT)) D EXMTPE^DVBCIUT1
"RTN","DVBCIUTL",203,0)
 .I $D(Y),(+Y=-1) S DVBCYQ=1
"RTN","DVBCIUTL",204,0)
 K DTOUT,DUOUT,Y,DIC,DVBCYQ
"RTN","DVBCIUTL",205,0)
 Q
"RTN","DVBCIUTL",206,0)
 ;
"RTN","DVBCIUTL",207,0)
 ;Input: DVBADIRA - Prompt to display for DIR call
"RTN","DVBCIUTL",208,0)
 ;Ouput: Code selected from set or ^ if user exited selection
"RTN","DVBCIUTL",209,0)
EXMPRTY(DVBADIRA) ;** Select Priority of Exam
"RTN","DVBCIUTL",210,0)
 N DIR,X,Y,DTOUT,DUOUT,DIRUT,DIROUT
"RTN","DVBCIUTL",211,0)
 S DIR(0)="S^AO:Agent Orange;BDD:Benefits Delivery at Discharge / Quick Start;"
"RTN","DVBCIUTL",212,0)
 S DIR(0)=DIR(0)_"IDES:Integrated Disability Evaluation System;"
"RTN","DVBCIUTL",213,0)
 S DIR(0)=DIR(0)_"ALL:All Others"
"RTN","DVBCIUTL",214,0)
 S DIR("A")=$S($G(DVBADIRA)]"":DVBADIRA,1:"Select Priority of Exam for the Report")
"RTN","DVBCIUTL",215,0)
 S DIR("B")="All Others"
"RTN","DVBCIUTL",216,0)
 S DIR("T")=DTIME  ;time-out value specified by system
"RTN","DVBCIUTL",217,0)
 S DIR("?",1)="Select the priority of exam(s) to report on or ALL for the original report,"
"RTN","DVBCIUTL",218,0)
 S DIR("?")="which excludes the AO, BDD and IDES exam priorities."
"RTN","DVBCIUTL",219,0)
 D ^DIR
"RTN","DVBCIUTL",220,0)
 Q Y
"RTN","DVBCIUTL",221,0)
CLAIMTYP ;THE CLAIM TYPE OF A 2507 REQUEST
"RTN","DVBCIUTL",222,0)
 S DVBCTW=""
"RTN","DVBCIUTL",223,0)
 Q:'$D(^DVB(396.3,DVBABIEN,9,0))
"RTN","DVBCIUTL",224,0)
 ;DVBIEN is the 2507 REQUEST FILE IEN
"RTN","DVBCIUTL",225,0)
 ;DVBCTW is the string /name of the CLAIM TYPE
"RTN","DVBCIUTL",226,0)
 D GETS^DIQ(396.3,DVBABIEN_",","9.1*","E","MSG","ERR")
"RTN","DVBCIUTL",227,0)
 S DVBCTW=MSG("396.32","1,"_DVBABIEN_",",".01","E")
"RTN","DVBCIUTL",228,0)
 Q
"RTN","DVBCIUTL",229,0)
SPEC ;SPECIAL CONSIDERATION(S) FOR A 2507 REQUEST
"RTN","DVBCIUTL",230,0)
 K DVBSCW
"RTN","DVBCIUTL",231,0)
 S DVBSCWA=""
"RTN","DVBCIUTL",232,0)
 Q:'$D(^DVB(396.3,DVBABIEN,8))
"RTN","DVBCIUTL",233,0)
 ;DVBABIEN is the 2507 REQUEST FILE IEN
"RTN","DVBCIUTL",234,0)
 ;DVBSC is a the SPECIAL CONSIDERATION entry for the 2507 REQUEST
"RTN","DVBCIUTL",235,0)
 ;DVBSCN is the pointer number to the SPECIAL CONSIDERATION file 396.25
"RTN","DVBCIUTL",236,0)
 ;DVBSCW is the string /name of the SPECIAL CONSIDERATION
"RTN","DVBCIUTL",237,0)
 S DVBAA=$P(^DVB(396.3,DVBABIEN,8,0),U,4)
"RTN","DVBCIUTL",238,0)
 S (DVBSC,DVBCNT)=0 F  S DVBSC=$O(^DVB(396.3,DVBABIEN,8,DVBSC)) Q:'DVBSC  D
"RTN","DVBCIUTL",239,0)
 .S DVBSCN=$P(^DVB(396.3,DVBABIEN,8,DVBSC,0),U,1)
"RTN","DVBCIUTL",240,0)
 .S DVBSCW(DVBSC)=$G(^DVB(396.25,DVBSCN,0))
"RTN","DVBCIUTL",241,0)
 .S DVBCNT=DVBCNT+1
"RTN","DVBCIUTL",242,0)
 .I (DVBCNT'=DVBAA) S:$D(DVBSCW(DVBSC)) DVBSCW(DVBSC)=DVBSCW(DVBSC)_","
"RTN","DVBCIUTL",243,0)
 S DVBX="" F  S DVBX=$O(DVBSCW(DVBX)) Q:'DVBX  S DVBSCWA=DVBSCWA_DVBSCW(DVBX)
"RTN","DVBCIUTL",244,0)
 Q
"RTN","DVBCIUTL",245,0)
PRIORITY ;
"RTN","DVBCIUTL",246,0)
 S DVBPOX=""
"RTN","DVBCIUTL",247,0)
 Q:($P(^DVB(396.3,DVBABIEN,0),U,10))=""
"RTN","DVBCIUTL",248,0)
 S DVBPOXID=$P(^DVB(396.3,DVBABIEN,0),U,10)
"RTN","DVBCIUTL",249,0)
 S DVBPOX=$$GET1^DIQ(396.3,DVBABIEN,"PRIORITY OF EXAM")
"RTN","DVBCIUTL",250,0)
 Q
"RTN","DVBCRPRT")
0^7^B19769692^B14877180
"RTN","DVBCRPRT",1,0)
DVBCRPRT ;ALB/GTS-557/THM-REPRINT C&P REPORT ; 5/17/91  10:28 AM
"RTN","DVBCRPRT",2,0)
 ;;2.7;AMIE;**31,42,119,192**;Apr 10, 1995;Build 15
"RTN","DVBCRPRT",3,0)
 ;
"RTN","DVBCRPRT",4,0)
 ; ** DVBCRPRT is called from DVBCRPON **
"RTN","DVBCRPRT",5,0)
 ; ** DVBCRPRT is called from DVBAB82 **
"RTN","DVBCRPRT",6,0)
PHYS S PHYS=$S($D(^DVB(396.4,DA,0)):$P(^(0),U,7),1:"")
"RTN","DVBCRPRT",7,0)
 Q
"RTN","DVBCRPRT",8,0)
STEP2A ;  ** Called from STEP2 only **
"RTN","DVBCRPRT",9,0)
 S EXMNM=$S($D(^DVB(396.6,$P(^DVB(396.4,DA,0),U,3),0)):$P(^(0),U,1),1:"Unknown exam"),EXHD="For "_EXMNM_" Exam" D HDR^DVBCRPR1
"RTN","DVBCRPRT",10,0)
 W "Examining provider: ",PHYS,!,"Examined on: " S Y=$P(^DVB(396.4,DA,0),U,6) X XDD W Y,! F LINE=1:1:80 W "="
"RTN","DVBCRPRT",11,0)
 W !!?2,"Examination results:",!! S EXSTAT=$P(^DVB(396.4,DA,0),U,4) I EXSTAT="X"!(EXSTAT="RX") W !!!!!?25,"This exam was CANCELLED by ",$S(EXSTAT="RX":"the RO.",1:"MAS."),!! Q
"RTN","DVBCRPRT",12,0)
 D STEP3
"RTN","DVBCRPRT",13,0)
 Q
"RTN","DVBCRPRT",14,0)
STEP2 ; ** An external entry point and called from GO2 **
"RTN","DVBCRPRT",15,0)
 F DA=0:0 S DA=$O(^DVB(396.4,"C",DA(1),DA)) Q:DA=""  D GETRO Q:RO'=DUZ(2)&('$D(^XUSEC("DVBA C SUPERVISOR",DUZ)))  S PG=0 D PHYS,STEP2A I $D(PRINT) D BOT^DVBCRPR1 K PRINT
"RTN","DVBCRPRT",16,0)
 D ^DVBCLABR Q
"RTN","DVBCRPRT",17,0)
 K DVBAON2
"RTN","DVBCRPRT",18,0)
 Q
"RTN","DVBCRPRT",19,0)
VBASTEP2 ; call from VBACRPON^DVBAB82
"RTN","DVBCRPRT",20,0)
 F DA=0:0 S DA=$O(^DVB(396.4,"C",DA(1),DA)) Q:DA=""  D GETRO S PG=0 D PHYS,STEP2A I $D(PRINT) D BOT^DVBCRPR1 K PRINT
"RTN","DVBCRPRT",21,0)
 D ^DVBCLABR Q
"RTN","DVBCRPRT",22,0)
 K DVBAON2
"RTN","DVBCRPRT",23,0)
 Q
"RTN","DVBCRPRT",24,0)
STEP3 ;  ** Called from STEP2A only **
"RTN","DVBCRPRT",25,0)
 K ^UTILITY($J,"W") S DIWL=1,DIWR=80,DIWF="NW" S OLDA=DA,OLDA1=DA(1)
"RTN","DVBCRPRT",26,0)
 F LINE=0:0 S LINE=$O(^DVB(396.4,OLDA,"RES",LINE)) Q:LINE=""  S X=^DVB(396.4,OLDA,"RES",LINE,0) D ^DIWP,STEP3A
"RTN","DVBCRPRT",27,0)
 D ^DIWW S PRINT=1 S DA=OLDA,DA(1)=OLDA1
"RTN","DVBCRPRT",28,0)
 Q
"RTN","DVBCRPRT",29,0)
STEP3A ;  ** Called from STEP3 only **
"RTN","DVBCRPRT",30,0)
 I +$G(DVBGUI) D
"RTN","DVBCRPRT",31,0)
 .I $Y>(IOSL-9) D HDR^DVBCRPR1
"RTN","DVBCRPRT",32,0)
 I '+$G(DVBGUI) D
"RTN","DVBCRPRT",33,0)
 .I $Y>(IOSL-9) D UP^DVBCRPR1,NEXT,HDR^DVBCRPR1 W:$O(^DVB(396.4,OLDA,"RES",LINE))]""&&('+$G(DVBGUI)) !!,"Exam Results Continued",!!
"RTN","DVBCRPRT",34,0)
 Q
"RTN","DVBCRPRT",35,0)
GO ;  ** An external entry point called from DVBCRPON **
"RTN","DVBCRPRT",36,0)
 U IO K ^TMP($J),DVBAON2 D HDA^DVBCRPR1 S (XCNT,XPRINT)=0
"RTN","DVBCRPRT",37,0)
 I '$D(^XUSEC("DVBA C SUPERVISOR",DUZ)) D
"RTN","DVBCRPRT",38,0)
 .F DA(1)=0:0 S DA(1)=$O(^DVB(396.3,"AF","C",DUZ(2),DA(1))) Q:DA(1)=""  DO
"RTN","DVBCRPRT",39,0)
 ..I $D(^DVB(396.3,DA(1),0)) D GO1
"RTN","DVBCRPRT",40,0)
 ..I '$D(^DVB(396.3,DA(1),0)) D BADXRF^DVBCPRNT
"RTN","DVBCRPRT",41,0)
 I $D(^XUSEC("DVBA C SUPERVISOR",DUZ)) D
"RTN","DVBCRPRT",42,0)
 .F LOC=0:0 S LOC=$O(^DVB(396.3,"AF","C",LOC)) Q:LOC=""  D
"RTN","DVBCRPRT",43,0)
 ..F DA(1)=0:0 S DA(1)=$O(^DVB(396.3,"AF","C",LOC,DA(1))) Q:DA(1)=""  DO
"RTN","DVBCRPRT",44,0)
 ...I $D(^DVB(396.3,DA(1),0)) D GO1
"RTN","DVBCRPRT",45,0)
 ...I '$D(^DVB(396.3,DA(1),0)) D BADXRF^DVBCPRNT
"RTN","DVBCRPRT",46,0)
 I XPRINT=0 K XPRINT,XPG,XXLN W !!!!!?25,"Nothing to print",!! H 2 G KILL^DVBCUTIL
"RTN","DVBCRPRT",47,0)
 I XCNT>0,XPRINT=1 W !!,"Total requests to be printed: ",XCNT,!
"RTN","DVBCRPRT",48,0)
 K XCNT,XXLN,XPG,XPRINT D SETLAB^DVBCPRNT S (XCN,PNAM)=""
"RTN","DVBCRPRT",49,0)
 F DVBCN=0:0 S XCN=$O(^TMP($J,XCN)) Q:XCN=""  F JJ=0:0 S PNAM=$O(^TMP($J,XCN,PNAM)) Q:PNAM=""  D GO2
"RTN","DVBCRPRT",50,0)
 G EXIT
"RTN","DVBCRPRT",51,0)
VBAGO ;  ** An external entry point called from DVBCRPON **
"RTN","DVBCRPRT",52,0)
 U IO K ^TMP($J),DVBAON2 D HDA^DVBCRPR1 S (XCNT,XPRINT)=0
"RTN","DVBCRPRT",53,0)
 D
"RTN","DVBCRPRT",54,0)
 .S DVBADUZ(2)=$P(^DVB(396.3,DA(1),0),U,2)
"RTN","DVBCRPRT",55,0)
 .F DA(1)=0:0 S DA(1)=$O(^DVB(396.3,"AF","C",DVBADUZ(2),DA(1))) Q:DA(1)=""  DO
"RTN","DVBCRPRT",56,0)
 ..I $D(^DVB(396.3,DA(1),0)) D GO1
"RTN","DVBCRPRT",57,0)
 ..I '$D(^DVB(396.3,DA(1),0)) D BADXRF^DVBCPRNT
"RTN","DVBCRPRT",58,0)
 I XPRINT=0 K XPRINT,XPG,XXLN W !!!!!?25,"Nothing to print",!! H 2 G KILL^DVBCUTIL
"RTN","DVBCRPRT",59,0)
 I XCNT>0,XPRINT=1 W !!,"Total requests to be printed: ",XCNT,!
"RTN","DVBCRPRT",60,0)
 K XCNT,XXLN,XPG,XPRINT D SETLAB^DVBCPRNT S (XCN,PNAM)=""
"RTN","DVBCRPRT",61,0)
 F DVBCN=0:0 S XCN=$O(^TMP($J,XCN)) Q:XCN=""  F JJ=0:0 S PNAM=$O(^TMP($J,XCN,PNAM)) Q:PNAM=""  D GO2
"RTN","DVBCRPRT",62,0)
 G EXIT
"RTN","DVBCRPRT",63,0)
GO2 F DA(1)=0:0 K PRINT S DA(1)=$O(^TMP($J,XCN,PNAM,DA(1))) Q:DA(1)=""  S PRTDATE=$P(^DVB(396.3,DA(1),0),U,16) I PRTDATE[RUNDATE S DA=DA(1) D VARS^DVBCUTIL
"RTN","DVBCRPRT",64,0)
 Q:(LOC'=RO)&('$D(^XUSEC("DVBA C SUPERVISOR",DUZ)))&('$D(AUTO))  D STEP2
"RTN","DVBCRPRT",65,0)
 Q
"RTN","DVBCRPRT",66,0)
GO1 S DFN=$P(^DVB(396.3,DA(1),0),U,1),PRTDATE=$P(^(0),U,16),PNAM=$P(^DPT(DFN,0),U,1),SSN=$P(^(0),U,9),CNUM=$S($D(^DPT(DFN,.31)):$P(^(.31),U,3),1:"Missing")
"RTN","DVBCRPRT",67,0)
 I RTYPE="D" Q:PRTDATE'[RUNDATE!(RUNDATE']"")
"RTN","DVBCRPRT",68,0)
 S XCN=$E(CNUM,$L(CNUM)-1,$L(CNUM)),XCN=+XCN
"RTN","DVBCRPRT",69,0)
 I PNAM]"" S ^TMP($J,XCN,PNAM,DA(1))="",XPRINT=1,XCNT=XCNT+1
"RTN","DVBCRPRT",70,0)
 D SSNSHRT^DVBCUTIL
"RTN","DVBCRPRT",71,0)
 W $E(PNAM,1,25),?28,DVBCSSNO,?43,CNUM,?55 S Y=$P(^DVB(396.3,DA(1),0),U,2) X XDD W Y,! D:$Y>(IOSL-16) HDA^DVBCRPR1
"RTN","DVBCRPRT",72,0)
 K PNAM,XCN,CNUM,DVBCSSNO
"RTN","DVBCRPRT",73,0)
 Q
"RTN","DVBCRPRT",74,0)
 ;
"RTN","DVBCRPRT",75,0)
EXIT K XDD,AUTO,DVBADUZ(2) S LKILL=1 G KILL^DVBCUTIL ; ** GOTO will quit from this RTN
"RTN","DVBCRPRT",76,0)
 ;
"RTN","DVBCRPRT",77,0)
NEXT I '$D(DVBGUI) W !,"Continued on next page",!,"VA Form 2507"
"RTN","DVBCRPRT",78,0)
 Q
"RTN","DVBCRPRT",79,0)
 ;
"RTN","DVBCRPRT",80,0)
GETRO S RO=$P(^DVB(396.3,DA(1),0),U,3)
"RTN","DVBCRPRT",81,0)
 Q
"SEC","^DD",396.4,396.4,103,9)
"@"
"SEC","^DD",396.4,396.4103,.01,8.5)
"@"
"SEC","^DD",396.4,396.4103,.01,9)
"@"
"UP",396.4,396.4103,-1)
396.4^6
"UP",396.4,396.4103,0)
396.4103
"VER")
8.0^22.0
"^DD",396.4,396.4,103,0)
REMARKS SENT TO CONTRACTOR^396.4103^^6;0
"^DD",396.4,396.4,103,21,0)
^.001^2^2^3150721^^
"^DD",396.4,396.4,103,21,1,0)
This field captures the comments from the CAPRI GUI remarks sent to the 
"^DD",396.4,396.4,103,21,2,0)
contractor.
"^DD",396.4,396.4,103,23,0)
^.001^3^3^3150721^^
"^DD",396.4,396.4,103,23,1,0)
This field saves the remarks, (previously not saved) that were sent
"^DD",396.4,396.4,103,23,2,0)
to the contractor. This enables future review and comparison to verify 
"^DD",396.4,396.4,103,23,3,0)
completion of requested actions.
"^DD",396.4,396.4103,0)
REMARKS SENT TO CONTRACTOR SUB-FIELD^^.01^1
"^DD",396.4,396.4103,0,"DT")
3150526
"^DD",396.4,396.4103,0,"NM","REMARKS SENT TO CONTRACTOR")

"^DD",396.4,396.4103,0,"UP")
396.4
"^DD",396.4,396.4103,.01,0)
REMARKS SENT TO CONTRACTOR^Wx^^0;1^Q
"^DD",396.4,396.4103,.01,.1)
REMARKS SENT TO VENDOR
"^DD",396.4,396.4103,.01,3)
ENTER REMARKS SENT TO CONTRACTORS
"^DD",396.4,396.4103,.01,21,0)
^.001^2^2^3150625^^^
"^DD",396.4,396.4103,.01,21,1,0)
 This field captures the comments from the CAPRI GUI remarks sent to the 
"^DD",396.4,396.4103,.01,21,2,0)
contractor.
"^DD",396.4,396.4103,.01,23,0)
^.001^3^3^3150625^^
"^DD",396.4,396.4103,.01,23,1,0)
This field saves the remarks, (previously not saved) that were sent
"^DD",396.4,396.4103,.01,23,2,0)
to the contractor. This enables future review and comparison to verify 
"^DD",396.4,396.4103,.01,23,3,0)
completion of requested actions.
"^DD",396.4,396.4103,.01,"DT")
3150526
"BLD",9255,6)
^169
**END**
**END**

