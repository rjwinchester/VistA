Released DVBA*2.7*196 SEQ #171
Extracted from mail message
**KIDS**:DVBA*2.7*196^

**INSTALL NAME**
DVBA*2.7*196
"BLD",10078,0)
DVBA*2.7*196^AUTOMATED MED INFO EXCHANGE^0^3151216^y
"BLD",10078,1,0)
^^4^4^3151215^
"BLD",10078,1,1,0)
This patch fixes an issue on the Vista side that leads to a <SUBSCRIPT>
"BLD",10078,1,2,0)
error which results in a "RPC DVBAB REPORTS could not be accessed!"
"BLD",10078,1,3,0)
error in CAPRI when the "Re-Print C&P Final Report(s)" report is run
"BLD",10078,1,4,0)
by date.
"BLD",10078,4,0)
^9.64PA^^
"BLD",10078,6.3)
1
"BLD",10078,"KRN",0)
^9.67PA^779.2^20
"BLD",10078,"KRN",.4,0)
.4
"BLD",10078,"KRN",.401,0)
.401
"BLD",10078,"KRN",.402,0)
.402
"BLD",10078,"KRN",.403,0)
.403
"BLD",10078,"KRN",.5,0)
.5
"BLD",10078,"KRN",.84,0)
.84
"BLD",10078,"KRN",3.6,0)
3.6
"BLD",10078,"KRN",3.8,0)
3.8
"BLD",10078,"KRN",9.2,0)
9.2
"BLD",10078,"KRN",9.8,0)
9.8
"BLD",10078,"KRN",9.8,"NM",0)
^9.68A^2^2
"BLD",10078,"KRN",9.8,"NM",1,0)
DVBAB82^^0^B146075808
"BLD",10078,"KRN",9.8,"NM",2,0)
DVBCRPRT^^0^B20397962
"BLD",10078,"KRN",9.8,"NM","B","DVBAB82",1)

"BLD",10078,"KRN",9.8,"NM","B","DVBCRPRT",2)

"BLD",10078,"KRN",19,0)
19
"BLD",10078,"KRN",19.1,0)
19.1
"BLD",10078,"KRN",101,0)
101
"BLD",10078,"KRN",409.61,0)
409.61
"BLD",10078,"KRN",771,0)
771
"BLD",10078,"KRN",779.2,0)
779.2
"BLD",10078,"KRN",870,0)
870
"BLD",10078,"KRN",8989.51,0)
8989.51
"BLD",10078,"KRN",8989.52,0)
8989.52
"BLD",10078,"KRN",8994,0)
8994
"BLD",10078,"KRN","B",.4,.4)

"BLD",10078,"KRN","B",.401,.401)

"BLD",10078,"KRN","B",.402,.402)

"BLD",10078,"KRN","B",.403,.403)

"BLD",10078,"KRN","B",.5,.5)

"BLD",10078,"KRN","B",.84,.84)

"BLD",10078,"KRN","B",3.6,3.6)

"BLD",10078,"KRN","B",3.8,3.8)

"BLD",10078,"KRN","B",9.2,9.2)

"BLD",10078,"KRN","B",9.8,9.8)

"BLD",10078,"KRN","B",19,19)

"BLD",10078,"KRN","B",19.1,19.1)

"BLD",10078,"KRN","B",101,101)

"BLD",10078,"KRN","B",409.61,409.61)

"BLD",10078,"KRN","B",771,771)

"BLD",10078,"KRN","B",779.2,779.2)

"BLD",10078,"KRN","B",870,870)

"BLD",10078,"KRN","B",8989.51,8989.51)

"BLD",10078,"KRN","B",8989.52,8989.52)

"BLD",10078,"KRN","B",8994,8994)

"BLD",10078,"QUES",0)
^9.62^^
"BLD",10078,"REQB",0)
^9.611^1^1
"BLD",10078,"REQB",1,0)
DVBA*2.7*192^1
"BLD",10078,"REQB","B","DVBA*2.7*192",1)

"MBREQ")
0
"PKG",223,-1)
1^1
"PKG",223,0)
AUTOMATED MED INFO EXCHANGE^DVBA^The entire AMIE package 7131/2507.
"PKG",223,20,0)
^9.402P^^
"PKG",223,22,0)
^9.49I^1^1
"PKG",223,22,1,0)
2.7^2950410^2950508
"PKG",223,22,1,"PAH",1,0)
196^3151216
"PKG",223,22,1,"PAH",1,1,0)
^^4^4^3151216
"PKG",223,22,1,"PAH",1,1,1,0)
This patch fixes an issue on the Vista side that leads to a <SUBSCRIPT>
"PKG",223,22,1,"PAH",1,1,2,0)
error which results in a "RPC DVBAB REPORTS could not be accessed!"
"PKG",223,22,1,"PAH",1,1,3,0)
error in CAPRI when the "Re-Print C&P Final Report(s)" report is run
"PKG",223,22,1,"PAH",1,1,4,0)
by date.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
2
"RTN","DVBAB82")
0^1^B146075808^B137858381
"RTN","DVBAB82",1,0)
DVBAB82 ;ALB/DJS - CAPRI DVBA REPORTS ; 01/24/12
"RTN","DVBAB82",2,0)
 ;;2.7;AMIE;**42,90,100,119,156,149,179,181,184,185,192,196**;Apr 10, 1995;Build 1
"RTN","DVBAB82",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","DVBAB82",4,0)
 ;ALB/RTW added subroutine VBACRPON to allow VBA reprint reqardless of office
"RTN","DVBAB82",5,0)
 Q
"RTN","DVBAB82",6,0)
 ;
"RTN","DVBAB82",7,0)
START(MSG,RPID,PARM) ; CALLED BY REMOTE PROCEDURE DVBAB REPORTS
"RTN","DVBAB82",8,0)
 ;Parameters
"RTN","DVBAB82",9,0)
 ;=============
"RTN","DVBAB82",10,0)
 ; MSG  : Output - ^TMP("DVBA",$J)
"RTN","DVBAB82",11,0)
 ; RPID : Report Identification Number
"RTN","DVBAB82",12,0)
 ; PARM : Input parameters separated by "^"
"RTN","DVBAB82",13,0)
 ;
"RTN","DVBAB82",14,0)
 N DVBHFS,DVBERR,DVBGUI,I,DVBADLMTD
"RTN","DVBAB82",15,0)
 K ^TMP("DVBA",$J)
"RTN","DVBAB82",16,0)
 S DVBGUI=1,(DVBERR,DVBADLMTD)=0,DVBHFS=$$HFS(),RPID=$G(RPID)
"RTN","DVBAB82",17,0)
 I RPID<1!(RPID>15) S DVBERR=1,^TMP("DVBA",$J,1)="0^Undefined Report ID" G END
"RTN","DVBAB82",18,0)
 D HFSOPEN("DVBRP",DVBHFS,"W") I DVBERR G END
"RTN","DVBAB82",19,0)
 I RPID=1 D CRMS G END
"RTN","DVBAB82",20,0)
 I RPID=3 D CPRNT G END
"RTN","DVBAB82",21,0)
 I RPID=11 D CNHRP G END  ;FNCNH Print Roster
"RTN","DVBAB82",22,0)
 D CHECK I DVBERR G END  ;reports below require parameters
"RTN","DVBAB82",23,0)
 I RPID=2 D CRRR G END
"RTN","DVBAB82",24,0)
 I RPID=4 D CRPON G END
"RTN","DVBAB82",25,0)
 ;DVBA*196 - I6184115FY16 REMOVE CALL TO VBACRPON
"RTN","DVBAB82",26,0)
 ;I RPID=4,$P(PARM,U,8)=0 D CRPON G END
"RTN","DVBAB82",27,0)
 ;I RPID=4,$P(PARM,U,8)=1 D VBACRPON G END
"RTN","DVBAB82",28,0)
 I RPID=5 D CIRPT G END
"RTN","DVBAB82",29,0)
 I RPID=6 D DSRP G END
"RTN","DVBAB82",30,0)
 I RPID=7 D SDPP G END
"RTN","DVBAB82",31,0)
 I RPID=8 D SPRPT G END
"RTN","DVBAB82",32,0)
 I RPID=9 D VIEW G END
"RTN","DVBAB82",33,0)
 I RPID=10 D CNHDEOC G END  ;FBCNH Display Episode Of Care
"RTN","DVBAB82",34,0)
 I RPID=12 D CNHRAD G END  ;FNCNH Report of Admissions/Discharges
"RTN","DVBAB82",35,0)
 I RPID=13 D CNHSE90D G END  ;FNCNH Stays in Excess of 90 Days
"RTN","DVBAB82",36,0)
 I RPID=14 D REQSTAT G END  ;REQUEST STATUS BY DATE RANGE
"RTN","DVBAB82",37,0)
 I RPID=15 D DVBA8861 G END  ;FORM 28-8861 STATUS REPORT
"RTN","DVBAB82",38,0)
 ;
"RTN","DVBAB82",39,0)
END D HFSCLOSE("DVBRP",DVBHFS)
"RTN","DVBAB82",40,0)
 I ($G(DVBADLMTD)&('+DVBERR)) D  Q  ;Create delimited output if no errors
"RTN","DVBAB82",41,0)
 .D DLMTRPT^DVBAB82D(RPID)
"RTN","DVBAB82",42,0)
 .S I=0 F  S I=$O(^TMP("DVBADLMTD",$J,I)) Q:I=""  D
"RTN","DVBAB82",43,0)
 ..I $G(^TMP("DVBADLMTD",$J,I))["##FFFF##" S ^TMP("DVBADLMTD",$J,I)=$TR(^TMP("DVBADLMTD",$J,I),"##FFFF##","")
"RTN","DVBAB82",44,0)
 .S MSG=$NA(^TMP("DVBADLMTD",$J))
"RTN","DVBAB82",45,0)
 ;Replace "##FFFF##" with Form Feeds - code needed for LINUX environments
"RTN","DVBAB82",46,0)
 S I=0 F  S I=$O(^TMP("DVBA",$J,1,I)) Q:'I  D
"RTN","DVBAB82",47,0)
 .S:^TMP("DVBA",$J,1,I)["##FFFF##" ^TMP("DVBA",$J,1,I)=$P(^TMP("DVBA",$J,1,I),"##FFFF##")_$C(13,12)_$P(^TMP("DVBA",$J,1,I),"##FFFF##",2)
"RTN","DVBAB82",48,0)
 .S ^TMP("DVBA",$J,1,I)=^TMP("DVBA",$J,1,I)_$C(13)
"RTN","DVBAB82",49,0)
 .S:^TMP("DVBA",$J,1,I)["$END" ^TMP("DVBA",$J,1,I)=""
"RTN","DVBAB82",50,0)
 S MSG=$NA(^TMP("DVBA",$J))
"RTN","DVBAB82",51,0)
 I ($G(RPID)=5)&($G(DVBADLMTR)=",") S MSG=$NA(^TMP("INSUFF",$J))
"RTN","DVBAB82",52,0)
 Q
"RTN","DVBAB82",53,0)
CHECK ; VALIDATE INPUT PARAMETERS
"RTN","DVBAB82",54,0)
 I $G(PARM)="" S DVBERR=1,^TMP("DVBA",$J,1)="0^Undefined Input Parameters"
"RTN","DVBAB82",55,0)
 Q
"RTN","DVBAB82",56,0)
 ;
"RTN","DVBAB82",57,0)
SDPP ; Report # 7 - Full (Patient Profile MAS) Report
"RTN","DVBAB82",58,0)
 ;Parameters
"RTN","DVBAB82",59,0)
 ;=============
"RTN","DVBAB82",60,0)
 ; DFN : Patient Identification Number
"RTN","DVBAB82",61,0)
 ; SDR : R/Range or A/All
"RTN","DVBAB82",62,0)
 ; SDBD : Begining date
"RTN","DVBAB82",63,0)
 ; SDED : Ending date
"RTN","DVBAB82",64,0)
 ; SDP : Print the profile? 1 OR 0
"RTN","DVBAB82",65,0)
 ; SDTYP(2) : Print appointments? 1 OR 0
"RTN","DVBAB82",66,0)
 ; SDTYP(1) : Print add/edits? 1 or 0
"RTN","DVBAB82",67,0)
 ; SDTYP(4) : Print enrollments? 1 or 0
"RTN","DVBAB82",68,0)
 ; SDTYP(3) : Print dispositions? 1 OR 0
"RTN","DVBAB82",69,0)
 ; SDTYP(7) : Print team information? 1 OR 0
"RTN","DVBAB82",70,0)
 ; SDTYP(5) : Print means test? 1 OR 0
"RTN","DVBAB82",71,0)
 ;
"RTN","DVBAB82",72,0)
 N SDTYP,SDBD,SDED,SDACT,SDPRINT,SDYES,SDRANGE,SDBEG,SDEN
"RTN","DVBAB82",73,0)
 S ^XTMP("JAP",$J,$$NOW^XLFDT(),"SDPP")=PARM
"RTN","DVBAB82",74,0)
 S DFN=$P(PARM,"^",1),SDR=$P(PARM,"^",2),SDBD=$P(PARM,"^",3),SDED=$P(PARM,"^",4)
"RTN","DVBAB82",75,0)
 S SDP=$P(PARM,"^",5),SDTYP(2)=$P(PARM,"^",6),SDTYP(1)=$P(PARM,"^",7)
"RTN","DVBAB82",76,0)
 S SDTYP(4)=$P(PARM,"^",8),SDTYP(3)=$P(PARM,"^",9),SDTYP(7)=$P(PARM,"^",10),SDTYP(5)=$P(PARM,"^",11)
"RTN","DVBAB82",77,0)
 D VAL Q:DVBERR
"RTN","DVBAB82",78,0)
 S SDACT="",(SDYES,SDRANGE,SDPRINT)=0
"RTN","DVBAB82",79,0)
 I SDR="R" S SDRANGE=1
"RTN","DVBAB82",80,0)
 I SDP=1 S SDYES=1,SDPRINT=1
"RTN","DVBAB82",81,0)
 I 'SDRANGE S (SDBD,SDBEG)=2800101,(SDED,SDEND)=$$ENDDT(),SDHDR=1
"RTN","DVBAB82",82,0)
 D ENS^%ZISS
"RTN","DVBAB82",83,0)
 S SDPRINT=1
"RTN","DVBAB82",84,0)
 S:(SDTYP(2)=1) SDTYP(2)=""  ;appointments
"RTN","DVBAB82",85,0)
 K:(SDTYP(2)=0) SDTYP(2)
"RTN","DVBAB82",86,0)
 S:(SDTYP(1)=1) SDTYP(1)=""  ;add/edits
"RTN","DVBAB82",87,0)
 K:(SDTYP(1)=0) SDTYP(1)
"RTN","DVBAB82",88,0)
 I (SDTYP(4)=1) S SDTYP(4)="",SDACT=0  ;enrollments
"RTN","DVBAB82",89,0)
 K:(SDTYP(4)=0) SDTYP(4)
"RTN","DVBAB82",90,0)
 S:(SDTYP(3)=1) SDTYP(3)=""  ;dispositions
"RTN","DVBAB82",91,0)
 K:(SDTYP(3)=0) SDTYP(3)
"RTN","DVBAB82",92,0)
 S:(SDTYP(5)=1) SDTYP(5)=""  ;means test
"RTN","DVBAB82",93,0)
 K:(SDTYP(5)=0) SDTYP(5)
"RTN","DVBAB82",94,0)
 I SDTYP(7)=1 D  ;team information
"RTN","DVBAB82",95,0)
 . S SDTYP(7)="",GBL="^TMP(""SDPP"","_$J_")"
"RTN","DVBAB82",96,0)
 K:(SDTYP(7)=0) SDTYP(7)
"RTN","DVBAB82",97,0)
 D PRINT^SDPPRT
"RTN","DVBAB82",98,0)
 S VALMBCK="R"
"RTN","DVBAB82",99,0)
 Q
"RTN","DVBAB82",100,0)
ENDDT() ;Calculate end date for "all" date
"RTN","DVBAB82",101,0)
 N DVBAPPTS,DVBX
"RTN","DVBAB82",102,0)
 S DVBAPPTS(1)=2800101,DVBAPPTS(4)=DFN,DVBAPPTS("SORT")="P"
"RTN","DVBAB82",103,0)
 S DVBAPPTS("FLDS")=1,DVBAPPTS("MAX")=-1
"RTN","DVBAB82",104,0)
 S DVBX=$S(($$SDAPI^SDAMA301(.DVBAPPTS)>0):$O(^TMP($J,"SDAMA301",DFN,0)),1:DT_.24)
"RTN","DVBAB82",105,0)
 K ^TMP($J,"SDAMA301")
"RTN","DVBAB82",106,0)
 Q DVBX
"RTN","DVBAB82",107,0)
 ;
"RTN","DVBAB82",108,0)
VIEW ; Report # 9 - View Registration Data Report
"RTN","DVBAB82",109,0)
 ; Parameters
"RTN","DVBAB82",110,0)
 ; ==========
"RTN","DVBAB82",111,0)
 ; DFN : Patient Identification Number
"RTN","DVBAB82",112,0)
 ;
"RTN","DVBAB82",113,0)
 U IO
"RTN","DVBAB82",114,0)
 S DFN=$P(PARM,"^",1)
"RTN","DVBAB82",115,0)
 D VAL Q:DVBERR
"RTN","DVBAB82",116,0)
 D EN1^DGRP
"RTN","DVBAB82",117,0)
 Q
"RTN","DVBAB82",118,0)
 ;
"RTN","DVBAB82",119,0)
DSRP ; Report # 6 - Reprint a Notice of Discharge Report
"RTN","DVBAB82",120,0)
 ; Parameters
"RTN","DVBAB82",121,0)
 ; % : 1=Report on all veterans for a given day (BDATE required)
"RTN","DVBAB82",122,0)
 ;   : 0=Report on a single Veteran (DFN required)
"RTN","DVBAB82",123,0)
 ; BDATE : Original Processing Date - $H/FileMan
"RTN","DVBAB82",124,0)
 ; DFN  : Patient Identification Number
"RTN","DVBAB82",125,0)
 ;
"RTN","DVBAB82",126,0)
 N %,BDATE,DFN,DFNIEN
"RTN","DVBAB82",127,0)
 S %=$P(PARM,"^",1),BDATE=$P(PARM,"^",2),DFN=$P(PARM,"^",3),DFNIEN=""
"RTN","DVBAB82",128,0)
 I BDATE="" S DVBERR=1,^TMP("DVBA",$J,1)="0^Incorrect Date"  Q
"RTN","DVBAB82",129,0)
 D DUZ2^DVBAUTIL
"RTN","DVBAB82",130,0)
 U IO
"RTN","DVBAB82",131,0)
 D VAL Q:DVBERR
"RTN","DVBAB82",132,0)
 I %=1 D  Q
"RTN","DVBAB82",133,0)
 . S HD="SINGLE NOTICE OF DISCHARGE REPRINTING"
"RTN","DVBAB82",134,0)
 . D NOPARM^DVBAUTL2
"RTN","DVBAB82",135,0)
 . I $D(DVBAQUIT) D KILL^DVBAUTIL Q  ;CAUTION: Short-circuit
"RTN","DVBAB82",136,0)
 . S DTAR=^DVB(396.1,1,0),FDT(0)=$$FMTE^XLFDT(DT,"5DZ")
"RTN","DVBAB82",137,0)
 . S HEAD="NOTICE OF DISCHARGE",HEAD1="FOR "_$P(DTAR,U,1)_" ON "_FDT(0)
"RTN","DVBAB82",138,0)
 . I $D(^DVB(396.2,"B",DFN)) D
"RTN","DVBAB82",139,0)
 . . S DFNIEN=$O(^DVB(396.2,"B",DFN,DFNIEN)),ADM=$P(^DVB(396.2,DFNIEN,0),U,3)
"RTN","DVBAB82",140,0)
 . . I $D(^DGPM(+ADM,0)),$P(^(0),U,17)]"" S DCHPTR=$P(^DGPM(+ADM,0),U,17),DISCH=$S($P(^DGPM(DCHPTR,0),U,1)]"":$P(^(0),U,1),1:"") W ?($X+5),"Discharge date: ",$$FMTE^XLFDT(DISCH,"5DZ")
"RTN","DVBAB82",141,0)
 . . I $P(^DVB(396.2,DFNIEN,0),U,7)'=DVBAD2 W *7,!!,"This does not belong to your RO.",!! H 3 Q
"RTN","DVBAB82",142,0)
 . . I DFNIEN>0 S XDA=DFNIEN,DA=$P(^DVB(396.2,DFNIEN,0),U,1),ADMDT=$P(^DVB(396.2,DFNIEN,0),U,2),MB=$P(^(0),U,3)
"RTN","DVBAB82",143,0)
 . . D REPRINT^DVBADSNT
"RTN","DVBAB82",144,0)
 D DEQUE^DVBADSRP
"RTN","DVBAB82",145,0)
 Q
"RTN","DVBAB82",146,0)
 ;
"RTN","DVBAB82",147,0)
SPRPT ; Report # 8 - OP(Operation Report)
"RTN","DVBAB82",148,0)
 ;Parameters
"RTN","DVBAB82",149,0)
 ;=============
"RTN","DVBAB82",150,0)
 ; DFN : Patient Identification Number
"RTN","DVBAB82",151,0)
 ; SRTN : Select Operation
"RTN","DVBAB82",152,0)
 ;
"RTN","DVBAB82",153,0)
 N DFN,SRTN,MAGTMPR2,SRSITE
"RTN","DVBAB82",154,0)
 I $O(^SRO(133,1))'="B" S SRSITE=1
"RTN","DVBAB82",155,0)
 S DFN=$P(PARM,"^",1),SRTN=$P(PARM,"^",2),MAGTMPR2=1
"RTN","DVBAB82",156,0)
 D VAL Q:DVBERR
"RTN","DVBAB82",157,0)
 D ^SROPRPT
"RTN","DVBAB82",158,0)
 Q
"RTN","DVBAB82",159,0)
 ;
"RTN","DVBAB82",160,0)
CRPON ; Report # - 4 Reprint C&P Final Report
"RTN","DVBAB82",161,0)
 ;Parameters
"RTN","DVBAB82",162,0)
 ;=============
"RTN","DVBAB82",163,0)
 ; RTYPE : Select Reprint Option (D)ate or (V)eteran
"RTN","DVBAB82",164,0)
 ; RUNDATE : ORIGINAL PROCESSING date
"RTN","DVBAB82",165,0)
 ; ANS : Reprinted by the RO or MAS
"RTN","DVBAB82",166,0)
 ; % : LAB 1 OR 0
"RTN","DVBAB82",167,0)
 ; DA(1) : Patient IEN for lab results
"RTN","DVBAB82",168,0)
 ; DFN  : Patient Identification Number
"RTN","DVBAB82",169,0)
 ;
"RTN","DVBAB82",170,0)
 U IO
"RTN","DVBAB82",171,0)
 N ONE,DVBAQ,DVBAWHO
"RTN","DVBAB82",172,0)
 S DVBAWHO=$P($G(PARM),U,8),DVBAQ=""
"RTN","DVBAB82",173,0)
 S RTYPE=$P(PARM,"^",1),RUNDATE=$P(PARM,"^",2),ANS=$P(PARM,"^",3),%=$P(PARM,"^",4),DA(1)=$P(PARM,"^",5),DFN=$P(PARM,"^",6),DA=DA(1)
"RTN","DVBAB82",174,0)
 I RTYPE="V" D VAL Q:DVBERR
"RTN","DVBAB82",175,0)
 S XDD=^DD("DD"),$P(ULINE,"_",70)="_",ONE="N",Y=DT
"RTN","DVBAB82",176,0)
 X XDD S HD="Reprint C & P Exams",SUPER=0
"RTN","DVBAB82",177,0)
 I $D(^XUSEC("DVBA C SUPERVISOR",DUZ)) S SUPER=1
"RTN","DVBAB82",178,0)
 S DVBCDT(0)=Y,PGHD="Compensation and Pension Exam Report",LOC=DUZ(2),PG=0,DVBCSITE=$S($D(^DVB(396.1,1,0)):$P(^(0),U,1),1:"Not specified")
"RTN","DVBAB82",179,0)
 I "^D^V^"'[RTYPE S DVBERR=1,^TMP("DVBA",$J,1)="0^Incorrect Data Type" Q
"RTN","DVBAB82",180,0)
 I ANS="R" K AUTO
"RTN","DVBAB82",181,0)
 I ANS="M" S AUTO=1
"RTN","DVBAB82",182,0)
 I "^M^R^"'[ANS S DVBERR=1,^TMP("DVBA",$J,1)="0^Incorrect Data Type" Q
"RTN","DVBAB82",183,0)
 I RTYPE="D" D GO^DVBCRPRT Q
"RTN","DVBAB82",184,0)
 ;DVBA*196 - I6184115FY16 FIX VALIDATION LOGIC FOR "BY VETERAN" TO MEET REQUIREMENTS IN PATCH 192
"RTN","DVBAB82",185,0)
 I RTYPE="V" D
"RTN","DVBAB82",186,0)
 . S ONE="Y",RO=$P(^DVB(396.3,DA,0),U,3)
"RTN","DVBAB82",187,0)
 . I DVBAWHO=0  D
"RTN","DVBAB82",188,0)
 .. I RO'=DUZ(2)&('$D(AUTO))&(SUPER=0) W !!,*7,"Those results do not belong to your office.",!! S DVBAQ=1 Q
"RTN","DVBAB82",189,0)
 .. I RO=DUZ(2)&('$D(AUTO))&("RC"'[($P(^DVB(396.3,DA,0),U,18))) W *7,!!,"This request has not been released to the Regional Office yet.",!! S DVBAQ=1 Q
"RTN","DVBAB82",190,0)
 .. S PRTDATE=$P(^DVB(396.3,DA,0),U,16) I PRTDATE="" W *7,!!,"This has never been printed.",!! I SUPER=0 S OUT=1 S DVBAQ=1 Q
"RTN","DVBAB82",191,0)
 . I DVBAWHO=1 D
"RTN","DVBAB82",192,0)
 .. I "RC"'[($P(^DVB(396.3,DA,0),U,18)) W *7,!!,"This request has not been released to the Regional Office yet.",!! S DVBAQ=1 Q
"RTN","DVBAB82",193,0)
 . I DVBAQ=1 Q
"RTN","DVBAB82",194,0)
 . I %=1 D REN2^DVBCLABR Q
"RTN","DVBAB82",195,0)
 . ;D OV^DVBCRPON
"RTN","DVBAB82",196,0)
 . K DVBAON2 D SETLAB^DVBCPRNT,VARS^DVBCUTIL  D
"RTN","DVBAB82",197,0)
 ..I DVBAWHO=1 D VBASTEP2^DVBCRPRT
"RTN","DVBAB82",198,0)
 ..I DVBAWHO=0 D STEP2^DVBCRPRT
"RTN","DVBAB82",199,0)
 Q
"RTN","DVBAB82",200,0)
 ;
"RTN","DVBAB82",201,0)
VBACRPON ; Report # - 4 Reprint C&P Final Report by VBA personnel
"RTN","DVBAB82",202,0)
 ;Parameters
"RTN","DVBAB82",203,0)
 ;=============
"RTN","DVBAB82",204,0)
 ; RTYPE : Select Reprint Option (D)ate or (V)eteran
"RTN","DVBAB82",205,0)
 ; RUNDATE : ORIGINAL PROCESSING date
"RTN","DVBAB82",206,0)
 ; ANS : Reprinted by the RO or MAS
"RTN","DVBAB82",207,0)
 ; % : LAB 1 OR 0
"RTN","DVBAB82",208,0)
 ; DA(1) : Patient IEN for lab results
"RTN","DVBAB82",209,0)
 ; DFN  : Patient Identification Number
"RTN","DVBAB82",210,0)
 ;
"RTN","DVBAB82",211,0)
 S DVBERR=0
"RTN","DVBAB82",212,0)
 I $D(^TMP("DVBA",$J)) S DVBAX=(^TMP("DVBA",$J))
"RTN","DVBAB82",213,0)
 U IO
"RTN","DVBAB82",214,0)
 N ONE
"RTN","DVBAB82",215,0)
 S RTYPE=$P(PARM,"^",1),RUNDATE=$P(PARM,"^",2),ANS=$P(PARM,"^",3),%=$P(PARM,"^",4),DA(1)=$P(PARM,"^",5),DFN=$P(PARM,"^",6),DA=DA(1)
"RTN","DVBAB82",216,0)
 I RTYPE="V" D VAL Q:DVBERR
"RTN","DVBAB82",217,0)
 S XDD=^DD("DD"),$P(ULINE,"_",70)="_",ONE="N",Y=DT
"RTN","DVBAB82",218,0)
 X XDD S HD="Reprint C & P Exams"
"RTN","DVBAB82",219,0)
 S DVBCDT(0)=Y,PGHD="Compensation and Pension Exam Report",LOC=DUZ(2),PG=0,DVBCSITE=$S($D(^DVB(396.1,1,0)):$P(^(0),U,1),1:"Not specified")
"RTN","DVBAB82",220,0)
 I "^D^V^"'[RTYPE S DVBERR=1,^TMP("DVBA",$J,1)="0^Incorrect Data Type" Q
"RTN","DVBAB82",221,0)
 I ANS="R" K AUTO
"RTN","DVBAB82",222,0)
 I ANS="M" S AUTO=1
"RTN","DVBAB82",223,0)
 I "^M^R^"'[ANS S DVBERR=1,^TMP("DVBA",$J,1)="0^Incorrect Data Type" Q
"RTN","DVBAB82",224,0)
 I RTYPE="D" D VBAGO^DVBCRPRT Q
"RTN","DVBAB82",225,0)
 I RTYPE="V" D
"RTN","DVBAB82",226,0)
 . S ONE="Y",RO=$P(^DVB(396.3,DA,0),U,3)
"RTN","DVBAB82",227,0)
 . S PRTDATE=$P(^DVB(396.3,DA,0),U,16)
"RTN","DVBAB82",228,0)
 . I %=1 D REN2^DVBCLABR Q
"RTN","DVBAB82",229,0)
 . K DVBAON2 D SETLAB^DVBCPRNT,VARS^DVBCUTIL,VBASTEP2^DVBCRPRT
"RTN","DVBAB82",230,0)
 Q
"RTN","DVBAB82",231,0)
 ;
"RTN","DVBAB82",232,0)
CIRPT ; Report # 5 - Insufficient Exam Report
"RTN","DVBAB82",233,0)
 ;Parameters
"RTN","DVBAB82",234,0)
 ;=============
"RTN","DVBAB82",235,0)
 ; RPTTYPE : D/Detailed or S/Summary
"RTN","DVBAB82",236,0)
 ; BEGDT : Beginning date $H/FileMan
"RTN","DVBAB82",237,0)
 ; ENDDT : Ending date $H/FileMan
"RTN","DVBAB82",238,0)
 ; RESANS : Insufficient Reason
"RTN","DVBAB82",239,0)
 ; DVBAPRTY : Priority of Exam Code
"RTN","DVBAB82",240,0)
 ;    AO  : Agent Orange
"RTN","DVBAB82",241,0)
 ;    BDD : Benefits Delivery at Discharge / Quick Start
"RTN","DVBAB82",242,0)
 ;    IDES : Integrated Disability Evaluation System
"RTN","DVBAB82",243,0)
 ;    ALL : All Others (Original Report w/ all codes except the above)
"RTN","DVBAB82",244,0)
 ; DVBADLMTR: 0=non-delimted format, ","=delimiter for .csv file for EXCEL
"RTN","DVBAB82",245,0)
 ;
"RTN","DVBAB82",246,0)
 N DVBAPRTY,RPTTYPE,BEGDT,ENDDT,RESANS
"RTN","DVBAB82",247,0)
 U IO
"RTN","DVBAB82",248,0)
 S RPTTYPE=$P(PARM,"^",1),BEGDT=$P(PARM,"^",2),ENDDT=$P(PARM,"^",3),RESANS=""
"RTN","DVBAB82",249,0)
 S DVBADLMTR=$P(PARM,"^",6),DVBADLMTR=$S(DVBADLMTR=1:",",1:0)
"RTN","DVBAB82",250,0)
 S ENDDT=ENDDT_".2359"
"RTN","DVBAB82",251,0)
 I RPTTYPE="S" D SUM^DVBCIRP2 Q
"RTN","DVBAB82",252,0)
 I RPTTYPE="D" D
"RTN","DVBAB82",253,0)
 . D INREAS
"RTN","DVBAB82",254,0)
 . Q:($D(^TMP("DVBA",$J,1)))  ;invalid reason sent
"RTN","DVBAB82",255,0)
 . D EXMTPE,DETAIL^DVBCIRP2
"RTN","DVBAB82",256,0)
 Q
"RTN","DVBAB82",257,0)
 ;
"RTN","DVBAB82",258,0)
EXMTPE ;exam types (retrieve all for filter)
"RTN","DVBAB82",259,0)
 N DVBAXIFN
"RTN","DVBAB82",260,0)
 F DVBAXIFN=0:0 S DVBAXIFN=$O(^DVB(396.6,DVBAXIFN)) Q:+DVBAXIFN=0  DO
"RTN","DVBAB82",261,0)
 . S ^TMP($J,"XMTYPE",DVBAXIFN)=""
"RTN","DVBAB82",262,0)
 Q
"RTN","DVBAB82",263,0)
INREAS ;insufficient reason (validate specific or retrieve all)
"RTN","DVBAB82",264,0)
 N DVBAXIFN
"RTN","DVBAB82",265,0)
 D:(RESANS="")  ;use all insufficient reasons
"RTN","DVBAB82",266,0)
 .F DVBAXIFN=0:0 S DVBAXIFN=$O(^DVB(396.94,DVBAXIFN)) Q:+DVBAXIFN=0  DO
"RTN","DVBAB82",267,0)
 .. S DVBAARY("REASON",DVBAXIFN)=""
"RTN","DVBAB82",268,0)
 ;D:(RESANS'="")  ;use specific insufficient reason
"RTN","DVBAB82",269,0)
 ;.I ('$D(^DVB(396.94,+RESANS))) D  ;validate IEN
"RTN","DVBAB82",270,0)
 ;..S DVBERR=1,^TMP("DVBA",$J,1)="0^Invalid Insufficient Reason IEN"
"RTN","DVBAB82",271,0)
 ;.E  S DVBAARY("REASON",+RESANS)=""
"RTN","DVBAB82",272,0)
 Q
"RTN","DVBAB82",273,0)
 ;
"RTN","DVBAB82",274,0)
CRMS ; Report # 1 - Regional Office 21- day Certificate Printing Report.
"RTN","DVBAB82",275,0)
 ; No Parameters
"RTN","DVBAB82",276,0)
 ;
"RTN","DVBAB82",277,0)
 U IO
"RTN","DVBAB82",278,0)
 D ^DVBACRMS
"RTN","DVBAB82",279,0)
 Q
"RTN","DVBAB82",280,0)
 ;
"RTN","DVBAB82",281,0)
CRRR ; Report # 2 - Reprint a 21 - day Certificate for the RO
"RTN","DVBAB82",282,0)
 ;Parameters
"RTN","DVBAB82",283,0)
 ;=============
"RTN","DVBAB82",284,0)
 ; DVBSEL : Select one of the following:
"RTN","DVBAB82",285,0)
 ;       N         Patient Name
"RTN","DVBAB82",286,0)
 ;       D         ORIGINAL PROCESSING DATE
"RTN","DVBAB82",287,0)
 ; SDATE : ORIGINAL PROCESSING date - $H/FileMan
"RTN","DVBAB82",288,0)
 ; XDA : Patient IEN
"RTN","DVBAB82",289,0)
 ;
"RTN","DVBAB82",290,0)
 U IO
"RTN","DVBAB82",291,0)
 S DVBSEL=$P(PARM,"^",1),SDATE=$P(PARM,"^",2),XDA=$P(PARM,"^",3)
"RTN","DVBAB82",292,0)
 I "^D^N^"'[DVBSEL S DVBERR=1,^TMP("DVBA",$J,1)="0^Incorrect Data Type" Q
"RTN","DVBAB82",293,0)
 I DVBSEL="D" D  I DVBERR Q
"RTN","DVBAB82",294,0)
 . I SDATE="" S DVBERR=1,^TMP("DVBA",$J,1)="0^Undefined Date" Q
"RTN","DVBAB82",295,0)
 . S %DT="X" S X=SDATE D ^%DT I Y<0 D  Q
"RTN","DVBAB82",296,0)
 . . S DVBERR=1,^TMP("DVBA",$J,1)="0^Incorrect Date Format"
"RTN","DVBAB82",297,0)
 I DVBSEL="N" D  I DVBERR Q
"RTN","DVBAB82",298,0)
 . I XDA="" S DVBERR=1,^TMP("DVBA",$J,1)="0^Undefined Patient IEN" Q
"RTN","DVBAB82",299,0)
 . S DIC=2,DIC(0)="NZX",X=XDA D ^DIC I Y<0 D  I DVBERR Q
"RTN","DVBAB82",300,0)
 . . S DVBERR=1,^TMP("DVBA",$J,1)="0^Invalid Patient Name."
"RTN","DVBAB82",301,0)
 . S DFN=XDA
"RTN","DVBAB82",302,0)
 D INIT^DVBACRRR I 'CONT Q
"RTN","DVBAB82",303,0)
 D HDR^DVBACRRR,DATA^DVBACRRR
"RTN","DVBAB82",304,0)
 Q
"RTN","DVBAB82",305,0)
 ;
"RTN","DVBAB82",306,0)
CPRNT ; Report # 3 - Print C&P Final Report (manual) Report
"RTN","DVBAB82",307,0)
 ; No Parameters
"RTN","DVBAB82",308,0)
 ;
"RTN","DVBAB82",309,0)
 S XDD=^DD("DD"),$P(ULINE,"_",70)="_",Y=DT
"RTN","DVBAB82",310,0)
 X XDD S DVBCDT(0)=Y,PGHD="Compensation and Pension Exam Report",DVBCSITE=$S($D(^DVB(396.1,1,0)):$P(^(0),U,1),1:"Not Specified")
"RTN","DVBAB82",311,0)
 D GO^DVBCPRNT
"RTN","DVBAB82",312,0)
 Q
"RTN","DVBAB82",313,0)
VAL ; VALIDATE PATIENT
"RTN","DVBAB82",314,0)
 I $G(DFN)="" S DVBERR=1,^TMP("DVBA",$J,1)="0^Undefined Patient IEN" G END
"RTN","DVBAB82",315,0)
 S DIC=2,DIC(0)="NZX",X=DFN D ^DIC
"RTN","DVBAB82",316,0)
 I Y<0 S DVBERR=1,^TMP("DVBA",$J,1)="0^Invalid Patient Name." G END
"RTN","DVBAB82",317,0)
 Q
"RTN","DVBAB82",318,0)
 ;
"RTN","DVBAB82",319,0)
VALDATE(DVBADTE) ;Validate Date
"RTN","DVBAB82",320,0)
 ;dates must be valid internal FileMan format
"RTN","DVBAB82",321,0)
 N X,Y,%DT
"RTN","DVBAB82",322,0)
 S %DT="X",X=DVBADTE D ^%DT
"RTN","DVBAB82",323,0)
 S:(Y=-1) DVBERR=1,^TMP("DVBA",$J,1)="0^Invalid FileMan formatted date."
"RTN","DVBAB82",324,0)
 Q
"RTN","DVBAB82",325,0)
 ;
"RTN","DVBAB82",326,0)
CNHDEOC ; Report #10 - FBCNH Display Episode of Care
"RTN","DVBAB82",327,0)
 ; Parameters
"RTN","DVBAB82",328,0)
 ; ==========
"RTN","DVBAB82",329,0)
 ;   DFN : IEN in PATIENT (#2) file
"RTN","DVBAB82",330,0)
 ;   IFN : IEN in FEE CNH ACTIVITY (#162.3) file
"RTN","DVBAB82",331,0)
 ;
"RTN","DVBAB82",332,0)
 U IO
"RTN","DVBAB82",333,0)
 N DFN,IFN
"RTN","DVBAB82",334,0)
 S DFN=$P(PARM,U,1),IFN=$P(PARM,U,2)
"RTN","DVBAB82",335,0)
 D ^FBNHDEC  ;DBIA#: 5566
"RTN","DVBAB82",336,0)
 Q
"RTN","DVBAB82",337,0)
 ;
"RTN","DVBAB82",338,0)
CNHRP ; Report #11 - FBCNH Roster Print
"RTN","DVBAB82",339,0)
 ; Parameters
"RTN","DVBAB82",340,0)
 ; ==========
"RTN","DVBAB82",341,0)
 ;   DVBADLMTD : 0 (Standard) or 1 (Delimited)
"RTN","DVBAB82",342,0)
 ; 
"RTN","DVBAB82",343,0)
 U IO
"RTN","DVBAB82",344,0)
 S DVBADLMTD=+$P($G(PARM),U)
"RTN","DVBAB82",345,0)
 D START^FBNHROS  ;DBIA#: 5566
"RTN","DVBAB82",346,0)
 Q
"RTN","DVBAB82",347,0)
 ;
"RTN","DVBAB82",348,0)
CNHRAD ; Report #12 - FBCNH Report of Admissions/Discharges
"RTN","DVBAB82",349,0)
 ; Parameters
"RTN","DVBAB82",350,0)
 ; ==========
"RTN","DVBAB82",351,0)
 ;   BEGDATE   : Start date in FM format
"RTN","DVBAB82",352,0)
 ;   ENDDATE   : End date in FM format
"RTN","DVBAB82",353,0)
 ;   DVBADLMTD : 0 (Standard) or 1 (Delimited)
"RTN","DVBAB82",354,0)
 ;
"RTN","DVBAB82",355,0)
 U IO
"RTN","DVBAB82",356,0)
 N BEGDATE,ENDDATE
"RTN","DVBAB82",357,0)
 S BEGDATE=$P(PARM,U,1),ENDDATE=$P(PARM,U,2)
"RTN","DVBAB82",358,0)
 S DVBADLMTD=+$P(PARM,U,3)
"RTN","DVBAB82",359,0)
 D VALDATE(BEGDATE),VALDATE(ENDDATE)
"RTN","DVBAB82",360,0)
 D:('+DVBERR) START^FBNHAMIE  ;DBIA#: 5566
"RTN","DVBAB82",361,0)
 Q
"RTN","DVBAB82",362,0)
 ;
"RTN","DVBAB82",363,0)
CNHSE90D ; Report #13 - FBCNH Stays in Excess of 90 Days
"RTN","DVBAB82",364,0)
 ; Parameters
"RTN","DVBAB82",365,0)
 ; ==========
"RTN","DVBAB82",366,0)
 ;   FBDT      : Effective date in FM format
"RTN","DVBAB82",367,0)
 ;   DVBADLMTD : 0 (Standard) or 1 (Delimited)
"RTN","DVBAB82",368,0)
 ;
"RTN","DVBAB82",369,0)
 U IO
"RTN","DVBAB82",370,0)
 N FBDT
"RTN","DVBAB82",371,0)
 S FBDT=$P(PARM,U,1),DVBADLMTD=+$P(PARM,U,2)
"RTN","DVBAB82",372,0)
 D VALDATE(FBDT)
"RTN","DVBAB82",373,0)
 D:('+DVBERR) START^FBNHAMI2  ;DBIA#: 5566
"RTN","DVBAB82",374,0)
 Q
"RTN","DVBAB82",375,0)
 ;
"RTN","DVBAB82",376,0)
HFS() ; -- get hfs file name
"RTN","DVBAB82",377,0)
 N H
"RTN","DVBAB82",378,0)
 S H=$H
"RTN","DVBAB82",379,0)
 Q "DVBA_"_$J_"_"_$P(H,",")_"_"_$P(H,",",2)_".DAT"
"RTN","DVBAB82",380,0)
 ;
"RTN","DVBAB82",381,0)
HFSOPEN(HANDLE,DVBHFS,DVBMODE) ; Open File
"RTN","DVBAB82",382,0)
 S DVBDIRY=$$GET^XPAR("DIV","DVB HFS SCRATCH")
"RTN","DVBAB82",383,0)
 ;I DVBDIRY="" S ECERR=1 D  Q
"RTN","DVBAB82",384,0)
 ;. S ^TMP("DVBA",$J,1)="0^A scratch directory for reports doesn't exist"
"RTN","DVBAB82",385,0)
 D OPEN^%ZISH(HANDLE,,DVBHFS,$G(DVBMODE,"W")) D:POP  Q:POP
"RTN","DVBAB82",386,0)
 .S DVBERR=1,^TMP("DVBA",$J,1)="0^Unable to open file "
"RTN","DVBAB82",387,0)
 S IOF="$$IOF^DVBAB82"   ;resets screen position and adds page break flag - added to deal with Linux environments.
"RTN","DVBAB82",388,0)
 Q
"RTN","DVBAB82",389,0)
 ;
"RTN","DVBAB82",390,0)
HFSCLOSE(HANDLE,DVBHFS) ;Close HFS and unload data
"RTN","DVBAB82",391,0)
 N DVBDEL,X,%ZIS
"RTN","DVBAB82",392,0)
 D CLOSE^%ZISH(HANDLE)
"RTN","DVBAB82",393,0)
 S DVBDEL(DVBHFS)=""
"RTN","DVBAB82",394,0)
 S ROOT=$NA(^TMP("DVBA",$J,1))
"RTN","DVBAB82",395,0)
 K:('+DVBERR) @ROOT
"RTN","DVBAB82",396,0)
 S X=$$FTG^%ZISH(,DVBHFS,$NA(@ROOT@(1)),4)
"RTN","DVBAB82",397,0)
 S X=$$DEL^%ZISH(,$NA(DVBDEL))
"RTN","DVBAB82",398,0)
 Q
"RTN","DVBAB82",399,0)
 ;
"RTN","DVBAB82",400,0)
IOF() ;used to reset position and insert page break flag when @IOF is executed.
"RTN","DVBAB82",401,0)
 S $X=0,$Y=0
"RTN","DVBAB82",402,0)
 Q "##FFFF##"_$C(13,10)
"RTN","DVBAB82",403,0)
 ;
"RTN","DVBAB82",404,0)
REQSTAT ; Report #14 - Request Status by Date Range
"RTN","DVBAB82",405,0)
 ; Parameters
"RTN","DVBAB82",406,0)
 ; ==========
"RTN","DVBAB82",407,0)
 ; BEGDAT        : Start date in FM format
"RTN","DVBAB82",408,0)
 ; ENDDAT        : End date in FM format
"RTN","DVBAB82",409,0)
 ; REQSTAT       : Request Status filter
"RTN","DVBAB82",410,0)
 ; ISDELIM       : 0 (Standard format); 1 (Delimited format)
"RTN","DVBAB82",411,0)
 ; ISNODT        : 0 (Use date range); 1 (Ignore date range)
"RTN","DVBAB82",412,0)
 U IO
"RTN","DVBAB82",413,0)
 N BEGDAT,ENDDAT,REQSTAT
"RTN","DVBAB82",414,0)
 S BEGDAT=$P(PARM,U,1),ENDDAT=$P(PARM,U,2)
"RTN","DVBAB82",415,0)
 S REQSTAT=$P(PARM,U,3),ISDELIM=$P(PARM,U,4),ISNODT=$P(PARM,U,5)
"RTN","DVBAB82",416,0)
 D VALDATE(BEGDAT),VALDATE(ENDDAT)
"RTN","DVBAB82",417,0)
 D:('+DVBERR) REQSTAT^DVBARSBD(BEGDAT,ENDDAT,REQSTAT,ISDELIM,ISNODT)
"RTN","DVBAB82",418,0)
 Q
"RTN","DVBAB82",419,0)
 ;
"RTN","DVBAB82",420,0)
DVBA8861 ; Report #15 - Form 28-8861 Status Report
"RTN","DVBAB82",421,0)
 ; Parameters
"RTN","DVBAB82",422,0)
 ; ==========
"RTN","DVBAB82",423,0)
 ; BEGDAT  -  Start date in FM format
"RTN","DVBAB82",424,0)
 ; ENDDAT  -  End date in FM format
"RTN","DVBAB82",425,0)
 ; ROSTAT  -  Regional Office filter
"RTN","DVBAB82",426,0)
 ; REQSTAT -  Request Status filter
"RTN","DVBAB82",427,0)
 ; DELIMTER - 0 (Standard format); 1 (Delimited format)
"RTN","DVBAB82",428,0)
 ;
"RTN","DVBAB82",429,0)
 U IO
"RTN","DVBAB82",430,0)
 N BEGDAT,ENDDAT,REQSTAT
"RTN","DVBAB82",431,0)
 S BEGDAT=$P(PARM,U,1),ENDDAT=$P(PARM,U,2)
"RTN","DVBAB82",432,0)
 S ROSTAT=$P(PARM,U,3),REQSTAT=$P(PARM,U,4),DELIMTER=$P(PARM,U,5)
"RTN","DVBAB82",433,0)
 D VALDATE(BEGDAT),VALDATE(ENDDAT)
"RTN","DVBAB82",434,0)
 D:('+DVBERR) STATRPT^DVBA8861(BEGDAT,ENDDAT,ROSTAT,REQSTAT,DELIMTER)
"RTN","DVBAB82",435,0)
 Q
"RTN","DVBCRPRT")
0^2^B20397962^B19769692
"RTN","DVBCRPRT",1,0)
DVBCRPRT ;ALB/GTS-557/THM-REPRINT C&P REPORT ; 5/17/91  10:28 AM
"RTN","DVBCRPRT",2,0)
 ;;2.7;AMIE;**31,42,119,192,196**;Apr 10, 1995;Build 1
"RTN","DVBCRPRT",3,0)
 ;
"RTN","DVBCRPRT",4,0)
 ; ** DVBCRPRT is called from DVBCRPON **
"RTN","DVBCRPRT",5,0)
 ; ** DVBCRPRT is called from DVBAB82 **
"RTN","DVBCRPRT",6,0)
PHYS S PHYS=$S($D(^DVB(396.4,DA,0)):$P(^(0),U,7),1:"")
"RTN","DVBCRPRT",7,0)
 Q
"RTN","DVBCRPRT",8,0)
STEP2A ;  ** Called from STEP2 only **
"RTN","DVBCRPRT",9,0)
 S EXMNM=$S($D(^DVB(396.6,$P(^DVB(396.4,DA,0),U,3),0)):$P(^(0),U,1),1:"Unknown exam"),EXHD="For "_EXMNM_" Exam" D HDR^DVBCRPR1
"RTN","DVBCRPRT",10,0)
 W "Examining provider: ",PHYS,!,"Examined on: " S Y=$P(^DVB(396.4,DA,0),U,6) X XDD W Y,! F LINE=1:1:80 W "="
"RTN","DVBCRPRT",11,0)
 W !!?2,"Examination results:",!! S EXSTAT=$P(^DVB(396.4,DA,0),U,4) I EXSTAT="X"!(EXSTAT="RX") W !!!!!?25,"This exam was CANCELLED by ",$S(EXSTAT="RX":"the RO.",1:"MAS."),!! Q
"RTN","DVBCRPRT",12,0)
 D STEP3
"RTN","DVBCRPRT",13,0)
 Q
"RTN","DVBCRPRT",14,0)
STEP2 ; ** An external entry point and called from GO2 **
"RTN","DVBCRPRT",15,0)
 F DA=0:0 S DA=$O(^DVB(396.4,"C",DA(1),DA)) Q:DA=""  D GETRO Q:RO'=DUZ(2)&('$D(^XUSEC("DVBA C SUPERVISOR",DUZ)))  S PG=0 D PHYS,STEP2A I $D(PRINT) D BOT^DVBCRPR1 K PRINT
"RTN","DVBCRPRT",16,0)
 D ^DVBCLABR Q
"RTN","DVBCRPRT",17,0)
 K DVBAON2
"RTN","DVBCRPRT",18,0)
 Q
"RTN","DVBCRPRT",19,0)
VBASTEP2 ; call from VBACRPON^DVBAB82
"RTN","DVBCRPRT",20,0)
 F DA=0:0 S DA=$O(^DVB(396.4,"C",DA(1),DA)) Q:DA=""  D GETRO S PG=0 D PHYS,STEP2A I $D(PRINT) D BOT^DVBCRPR1 K PRINT
"RTN","DVBCRPRT",21,0)
 D ^DVBCLABR Q
"RTN","DVBCRPRT",22,0)
 K DVBAON2
"RTN","DVBCRPRT",23,0)
 Q
"RTN","DVBCRPRT",24,0)
STEP3 ;  ** Called from STEP2A only **
"RTN","DVBCRPRT",25,0)
 K ^UTILITY($J,"W") S DIWL=1,DIWR=80,DIWF="NW" S OLDA=DA,OLDA1=DA(1)
"RTN","DVBCRPRT",26,0)
 F LINE=0:0 S LINE=$O(^DVB(396.4,OLDA,"RES",LINE)) Q:LINE=""  S X=^DVB(396.4,OLDA,"RES",LINE,0) D ^DIWP,STEP3A
"RTN","DVBCRPRT",27,0)
 D ^DIWW S PRINT=1 S DA=OLDA,DA(1)=OLDA1
"RTN","DVBCRPRT",28,0)
 Q
"RTN","DVBCRPRT",29,0)
STEP3A ;  ** Called from STEP3 only **
"RTN","DVBCRPRT",30,0)
 I +$G(DVBGUI) D
"RTN","DVBCRPRT",31,0)
 .I $Y>(IOSL-9) D HDR^DVBCRPR1
"RTN","DVBCRPRT",32,0)
 I '+$G(DVBGUI) D
"RTN","DVBCRPRT",33,0)
 .I $Y>(IOSL-9) D UP^DVBCRPR1,NEXT,HDR^DVBCRPR1 W:$O(^DVB(396.4,OLDA,"RES",LINE))]""&('+$G(DVBGUI)) !!,"Exam Results Continued",!!
"RTN","DVBCRPRT",34,0)
 Q
"RTN","DVBCRPRT",35,0)
GO ;  ** An external entry point called from DVBCRPON **
"RTN","DVBCRPRT",36,0)
 U IO K ^TMP($J),DVBAON2 D HDA^DVBCRPR1 S (XCNT,XPRINT)=0
"RTN","DVBCRPRT",37,0)
 I '$D(^XUSEC("DVBA C SUPERVISOR",DUZ)) D
"RTN","DVBCRPRT",38,0)
 .F DA(1)=0:0 S DA(1)=$O(^DVB(396.3,"AF","C",DUZ(2),DA(1))) Q:DA(1)=""  DO
"RTN","DVBCRPRT",39,0)
 ..I $D(^DVB(396.3,DA(1),0)) D GO1
"RTN","DVBCRPRT",40,0)
 ..I '$D(^DVB(396.3,DA(1),0)) D BADXRF^DVBCPRNT
"RTN","DVBCRPRT",41,0)
 I $D(^XUSEC("DVBA C SUPERVISOR",DUZ)) D
"RTN","DVBCRPRT",42,0)
 .F LOC=0:0 S LOC=$O(^DVB(396.3,"AF","C",LOC)) Q:LOC=""  D
"RTN","DVBCRPRT",43,0)
 ..F DA(1)=0:0 S DA(1)=$O(^DVB(396.3,"AF","C",LOC,DA(1))) Q:DA(1)=""  DO
"RTN","DVBCRPRT",44,0)
 ...I $D(^DVB(396.3,DA(1),0)) D GO1
"RTN","DVBCRPRT",45,0)
 ...I '$D(^DVB(396.3,DA(1),0)) D BADXRF^DVBCPRNT
"RTN","DVBCRPRT",46,0)
 I XPRINT=0 K XPRINT,XPG,XXLN W !!!!!?25,"Nothing to print",!! H 2 G KILL^DVBCUTIL
"RTN","DVBCRPRT",47,0)
 I XCNT>0,XPRINT=1 W !!,"Total requests to be printed: ",XCNT,!
"RTN","DVBCRPRT",48,0)
 K XCNT,XXLN,XPG,XPRINT D SETLAB^DVBCPRNT S (XCN,PNAM)=""
"RTN","DVBCRPRT",49,0)
 F DVBCN=0:0 S XCN=$O(^TMP($J,XCN)) Q:XCN=""  F JJ=0:0 S PNAM=$O(^TMP($J,XCN,PNAM)) Q:PNAM=""  D GO2
"RTN","DVBCRPRT",50,0)
 G EXIT
"RTN","DVBCRPRT",51,0)
VBAGO ;  ** An external entry point called from DVBCRPON **
"RTN","DVBCRPRT",52,0)
 U IO K ^TMP($J),DVBAON2 D HDA^DVBCRPR1 S (XCNT,XPRINT)=0
"RTN","DVBCRPRT",53,0)
 D
"RTN","DVBCRPRT",54,0)
 .S DVBADUZ(2)=$P(^DVB(396.3,DA(1),0),U,2)
"RTN","DVBCRPRT",55,0)
 .F DA(1)=0:0 S DA(1)=$O(^DVB(396.3,"AF","C",DVBADUZ(2),DA(1))) Q:DA(1)=""  DO
"RTN","DVBCRPRT",56,0)
 ..I $D(^DVB(396.3,DA(1),0)) D GO1
"RTN","DVBCRPRT",57,0)
 ..I '$D(^DVB(396.3,DA(1),0)) D BADXRF^DVBCPRNT
"RTN","DVBCRPRT",58,0)
 I XPRINT=0 K XPRINT,XPG,XXLN W !!!!!?25,"Nothing to print",!! H 2 G KILL^DVBCUTIL
"RTN","DVBCRPRT",59,0)
 I XCNT>0,XPRINT=1 W !!,"Total requests to be printed: ",XCNT,!
"RTN","DVBCRPRT",60,0)
 K XCNT,XXLN,XPG,XPRINT D SETLAB^DVBCPRNT S (XCN,PNAM)=""
"RTN","DVBCRPRT",61,0)
 F DVBCN=0:0 S XCN=$O(^TMP($J,XCN)) Q:XCN=""  F JJ=0:0 S PNAM=$O(^TMP($J,XCN,PNAM)) Q:PNAM=""  D GO2
"RTN","DVBCRPRT",62,0)
 G EXIT
"RTN","DVBCRPRT",63,0)
GO2 F DA(1)=0:0 K PRINT S DA(1)=$O(^TMP($J,XCN,PNAM,DA(1))) Q:DA(1)=""  S PRTDATE=$P(^DVB(396.3,DA(1),0),U,16) I PRTDATE[RUNDATE S DA=DA(1) D VARS^DVBCUTIL Q:(LOC'=RO)&('$D(^XUSEC("DVBA C SUPERVISOR",DUZ)))&('$D(AUTO))  D STEP2
"RTN","DVBCRPRT",64,0)
 Q
"RTN","DVBCRPRT",65,0)
GO1 S DFN=$P(^DVB(396.3,DA(1),0),U,1),PRTDATE=$P(^(0),U,16),PNAM=$P(^DPT(DFN,0),U,1),SSN=$P(^(0),U,9),CNUM=$S($D(^DPT(DFN,.31)):$P(^(.31),U,3),1:"Missing")
"RTN","DVBCRPRT",66,0)
 I RTYPE="D" Q:PRTDATE'[RUNDATE!(RUNDATE']"")
"RTN","DVBCRPRT",67,0)
 S XCN=$E(CNUM,$L(CNUM)-1,$L(CNUM)),XCN=+XCN
"RTN","DVBCRPRT",68,0)
 I PNAM]"" S ^TMP($J,XCN,PNAM,DA(1))="",XPRINT=1,XCNT=XCNT+1
"RTN","DVBCRPRT",69,0)
 D SSNSHRT^DVBCUTIL
"RTN","DVBCRPRT",70,0)
 W $E(PNAM,1,25),?28,DVBCSSNO,?43,CNUM,?55 S Y=$P(^DVB(396.3,DA(1),0),U,2) X XDD W Y,! D:$Y>(IOSL-16) HDA^DVBCRPR1
"RTN","DVBCRPRT",71,0)
 K PNAM,XCN,CNUM,DVBCSSNO
"RTN","DVBCRPRT",72,0)
 Q
"RTN","DVBCRPRT",73,0)
 ;
"RTN","DVBCRPRT",74,0)
EXIT K XDD,AUTO,DVBADUZ(2) S LKILL=1 G KILL^DVBCUTIL ; ** GOTO will quit from this RTN
"RTN","DVBCRPRT",75,0)
 ;
"RTN","DVBCRPRT",76,0)
NEXT I '$D(DVBGUI) W !,"Continued on next page",!,"VA Form 2507"
"RTN","DVBCRPRT",77,0)
 Q
"RTN","DVBCRPRT",78,0)
 ;
"RTN","DVBCRPRT",79,0)
GETRO S RO=$P(^DVB(396.3,DA(1),0),U,3)
"RTN","DVBCRPRT",80,0)
 Q
"VER")
8.0^22.0
"BLD",10078,6)
^171
**END**
**END**

