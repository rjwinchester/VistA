Released DVBA*2.7*190 SEQ #168
Extracted from mail message
**KIDS**:DVBA*2.7*190^

**INSTALL NAME**
DVBA*2.7*190
"BLD",9164,0)
DVBA*2.7*190^AUTOMATED MED INFO EXCHANGE^0^3150608^y
"BLD",9164,1,0)
^^1^1^3150605^
"BLD",9164,1,1,0)
Please see FORUM for a more complete description of DVBA*2.7*190
"BLD",9164,4,0)
^9.64PA^396.17^2
"BLD",9164,4,396.17,0)
396.17
"BLD",9164,4,396.17,2,0)
^9.641^396.17^1
"BLD",9164,4,396.17,2,396.17,0)
CAPRI TEMPLATES  (File-top level)
"BLD",9164,4,396.17,2,396.17,1,0)
^9.6411^1^1
"BLD",9164,4,396.17,2,396.17,1,1,0)
ACCEPTABLE CLINICAL EVIDENCE
"BLD",9164,4,396.17,222)
y^y^p^^^^n^^n
"BLD",9164,4,396.17,224)

"BLD",9164,4,396.3,0)
396.3
"BLD",9164,4,396.3,2,0)
^9.641^396.3^1
"BLD",9164,4,396.3,2,396.3,0)
2507 REQUEST  (File-top level)
"BLD",9164,4,396.3,2,396.3,1,0)
^9.6411^21.1^1
"BLD",9164,4,396.3,2,396.3,1,21.1,0)
ELECTRONIC CLAIM FOLDER AVAIL
"BLD",9164,4,396.3,222)
y^y^p^^^^n^^n
"BLD",9164,4,396.3,224)

"BLD",9164,4,"APDD",396.17,396.17)

"BLD",9164,4,"APDD",396.17,396.17,1)

"BLD",9164,4,"APDD",396.3,396.3)

"BLD",9164,4,"APDD",396.3,396.3,21.1)

"BLD",9164,4,"B",396.17,396.17)

"BLD",9164,4,"B",396.3,396.3)

"BLD",9164,6.3)
24
"BLD",9164,"KRN",0)
^9.67PA^779.2^20
"BLD",9164,"KRN",.4,0)
.4
"BLD",9164,"KRN",.4,"NM",0)
^9.68A^^
"BLD",9164,"KRN",.401,0)
.401
"BLD",9164,"KRN",.402,0)
.402
"BLD",9164,"KRN",.403,0)
.403
"BLD",9164,"KRN",.5,0)
.5
"BLD",9164,"KRN",.84,0)
.84
"BLD",9164,"KRN",3.6,0)
3.6
"BLD",9164,"KRN",3.8,0)
3.8
"BLD",9164,"KRN",9.2,0)
9.2
"BLD",9164,"KRN",9.8,0)
9.8
"BLD",9164,"KRN",9.8,"NM",0)
^9.68A^3^2
"BLD",9164,"KRN",9.8,"NM",1,0)
DVBAB6^^0^B57291338
"BLD",9164,"KRN",9.8,"NM",3,0)
DVBARSBD^^0^B106363771
"BLD",9164,"KRN",9.8,"NM","B","DVBAB6",1)

"BLD",9164,"KRN",9.8,"NM","B","DVBARSBD",3)

"BLD",9164,"KRN",19,0)
19
"BLD",9164,"KRN",19.1,0)
19.1
"BLD",9164,"KRN",19.1,"NM",0)
^9.68A^2^2
"BLD",9164,"KRN",19.1,"NM",1,0)
DVBA CAPRI EXAMCANC^^0
"BLD",9164,"KRN",19.1,"NM",2,0)
DVBA CAPRI EXAMINSUFF^^0
"BLD",9164,"KRN",19.1,"NM","B","DVBA CAPRI EXAMCANC",1)

"BLD",9164,"KRN",19.1,"NM","B","DVBA CAPRI EXAMINSUFF",2)

"BLD",9164,"KRN",101,0)
101
"BLD",9164,"KRN",409.61,0)
409.61
"BLD",9164,"KRN",771,0)
771
"BLD",9164,"KRN",779.2,0)
779.2
"BLD",9164,"KRN",870,0)
870
"BLD",9164,"KRN",8989.51,0)
8989.51
"BLD",9164,"KRN",8989.52,0)
8989.52
"BLD",9164,"KRN",8994,0)
8994
"BLD",9164,"KRN","B",.4,.4)

"BLD",9164,"KRN","B",.401,.401)

"BLD",9164,"KRN","B",.402,.402)

"BLD",9164,"KRN","B",.403,.403)

"BLD",9164,"KRN","B",.5,.5)

"BLD",9164,"KRN","B",.84,.84)

"BLD",9164,"KRN","B",3.6,3.6)

"BLD",9164,"KRN","B",3.8,3.8)

"BLD",9164,"KRN","B",9.2,9.2)

"BLD",9164,"KRN","B",9.8,9.8)

"BLD",9164,"KRN","B",19,19)

"BLD",9164,"KRN","B",19.1,19.1)

"BLD",9164,"KRN","B",101,101)

"BLD",9164,"KRN","B",409.61,409.61)

"BLD",9164,"KRN","B",771,771)

"BLD",9164,"KRN","B",779.2,779.2)

"BLD",9164,"KRN","B",870,870)

"BLD",9164,"KRN","B",8989.51,8989.51)

"BLD",9164,"KRN","B",8989.52,8989.52)

"BLD",9164,"KRN","B",8994,8994)

"BLD",9164,"QDEF")
^^^^NO^^^^NO^^NO
"BLD",9164,"QUES",0)
^9.62^^
"BLD",9164,"REQB",0)
^9.611^2^2
"BLD",9164,"REQB",1,0)
DVBA*2.7*185^2
"BLD",9164,"REQB",2,0)
DVBA*2.7*189^2
"BLD",9164,"REQB","B","DVBA*2.7*185",1)

"BLD",9164,"REQB","B","DVBA*2.7*189",2)

"FIA",396.17)
CAPRI TEMPLATES
"FIA",396.17,0)
^DVB(396.17,
"FIA",396.17,0,0)
396.17PI
"FIA",396.17,0,1)
y^y^p^^^^n^^n
"FIA",396.17,0,10)

"FIA",396.17,0,11)

"FIA",396.17,0,"RLRO")

"FIA",396.17,0,"VR")
2.7^DVBA
"FIA",396.17,396.17)
1
"FIA",396.17,396.17,1)

"FIA",396.3)
2507 REQUEST
"FIA",396.3,0)
^DVB(396.3,
"FIA",396.3,0,0)
396.3IP
"FIA",396.3,0,1)
y^y^p^^^^n^^n
"FIA",396.3,0,10)

"FIA",396.3,0,11)

"FIA",396.3,0,"RLRO")

"FIA",396.3,0,"VR")
2.7^DVBA
"FIA",396.3,396.3)
1
"FIA",396.3,396.3,21.1)

"KRN",19.1,635,-1)
0^1
"KRN",19.1,635,0)
DVBA CAPRI EXAMCANC^EDIT CANCELLATION REASONS^l^n^
"KRN",19.1,635,1,0)
^^4^4^3150331^
"KRN",19.1,635,1,1,0)
The CAPRI GUI checks for assignment of this security key in the token
"KRN",19.1,635,1,2,0)
sent with the user from the CLAIMS system. If this key is assigned the
"KRN",19.1,635,1,3,0)
user will be able to add new cancellation reasons to global 396.5. The
"KRN",19.1,635,1,4,0)
user can also activate or inactivate existing cancellation reasons.
"KRN",19.1,636,-1)
0^2
"KRN",19.1,636,0)
DVBA CAPRI EXAMINSUFF^EDIT INSUFFICIENT REASONS^^n^
"KRN",19.1,636,1,0)
^^4^4^3150331^
"KRN",19.1,636,1,1,0)
The CAPRI GUI checks for assignment of this security key in the token
"KRN",19.1,636,1,2,0)
sent with the user from the CLAIMS system. If this key is assigned the
"KRN",19.1,636,1,3,0)
user will be able to add new insufficient reasons to global 396.94 . The
"KRN",19.1,636,1,4,0)
user can also activate or inactivate existing insufficient reasons.
"KRN",19.1,636,3,0)
^19.13P
"MBREQ")
0
"ORD",3,19.1)
19.1;3;;;KEY^XPDTA1;KEYF1^XPDIA1;KEYE1^XPDIA1;KEYF2^XPDIA1;;KEYDEL^XPDIA1
"ORD",3,19.1,0)
SECURITY KEY
"PKG",223,-1)
1^1
"PKG",223,0)
AUTOMATED MED INFO EXCHANGE^DVBA^The entire AMIE package 7131/2507.
"PKG",223,20,0)
^9.402P^^
"PKG",223,22,0)
^9.49I^1^1
"PKG",223,22,1,0)
2.7^2950410^3010328
"PKG",223,22,1,"PAH",1,0)
190^3150608
"PKG",223,22,1,"PAH",1,1,0)
^^1^1^3150608
"PKG",223,22,1,"PAH",1,1,1,0)
Please see FORUM for a more complete description of DVBA*2.7*190
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
2
"RTN","DVBAB6")
0^1^B57291338^B53380970
"RTN","DVBAB6",1,0)
DVBAB6 ;ALB/DJS - CAPRI PENDING 2507 REQUEST REPORT ; 02-27-2013
"RTN","DVBAB6",2,0)
 ;;2.7;AMIE;**35,90,108,168,185,190**;Apr 10, 1995;Build 24
"RTN","DVBAB6",3,0)
 ;
"RTN","DVBAB6",4,0)
STRT(MSG,DVBCSORT,RSTAT,ERDAYS,OLDAYS,ADIVNUM,ELTYP,DVBADLMTR,ROFILTER) ;
"RTN","DVBAB6",5,0)
 I ADIVNUM'="" S X=$O(^DG(40.8,"C",ADIVNUM,"")) S:X]"" ADIVNUM=X
"RTN","DVBAB6",6,0)
 S DVBADLMTR=$S(DVBADLMTR=1:",",1:0),ROFILTER=$S($G(ROFILTER)'=0:ROFILTER,1:0)
"RTN","DVBAB6",7,0)
SETUP K ^TMP($J),^TMP("CAPRI")
"RTN","DVBAB6",8,0)
 S DVBCDT(0)=$$FMTE^XLFDT(DT,"5DZ"),PG=1,DVBCCNT=0,DONE="NO",MSGCNT=1,TRNSFIN=""
"RTN","DVBAB6",9,0)
 S DVBCHDR="Sorted by "_$S(DVBCSORT="V":"VETERAN NAME",DVBCSORT="R":"Routing location",DVBCSORT="S":"Status",DVBCSORT="A":"Age of request",1:"Unknown")
"RTN","DVBAB6",10,0)
HEAD S HEAD="Pending 2507 Requests for "_$S($D(^DVB(396.1,1,0)):$P(^(0),U,1),1:"Unknown site"),PROCDT="Processed on: "_DVBCDT(0),NODATA=0
"RTN","DVBAB6",11,0)
 I $G(DVBADLMTR)'="," D HEADRND G DATA
"RTN","DVBAB6",12,0)
 I $G(DVBADLMTR)="," D HEADRD G DATA
"RTN","DVBAB6",13,0)
 Q
"RTN","DVBAB6",14,0)
HEADRND ; Print non-delimited output header
"RTN","DVBAB6",15,0)
 ;
"RTN","DVBAB6",16,0)
 S ^TMP("CAPRI",MSGCNT)=HEAD_"^",MSGCNT=MSGCNT+1
"RTN","DVBAB6",17,0)
 S ^TMP("CAPRI",MSGCNT)=PROCDT_"^",MSGCNT=MSGCNT+1
"RTN","DVBAB6",18,0)
 S ^TMP("CAPRI",MSGCNT)="^",MSGCNT=MSGCNT+1
"RTN","DVBAB6",19,0)
 S $P(^TMP("CAPRI",MSGCNT),"=",75)="=^",MSGCNT=MSGCNT+1
"RTN","DVBAB6",20,0)
 S ^TMP("CAPRI",MSGCNT)="^",MSGCNT=MSGCNT+1
"RTN","DVBAB6",21,0)
 S ^TMP("CAPRI",MSGCNT)="",MSGCNT=MSGCNT+1
"RTN","DVBAB6",22,0)
 Q
"RTN","DVBAB6",23,0)
HEADRD ; Print delimited output header
"RTN","DVBAB6",24,0)
 ;
"RTN","DVBAB6",25,0)
 S ^TMP("CAPRI",MSGCNT)=HEAD_$C(13),MSGCNT=MSGCNT+1,^TMP("CAPRI",MSGCNT)=PROCDT_$C(13),MSGCNT=MSGCNT+1
"RTN","DVBAB6",26,0)
 S ^TMP("CAPRI",MSGCNT)=$S($G(ROFILTER)'=0:"RO #"_DVBADLMTR,1:"")_"Division"_DVBADLMTR_"Status"_DVBADLMTR_"Veteran Name"_DVBADLMTR_"SSN"_DVBADLMTR_"Claim No."_DVBADLMTR_"Request Date"_DVBADLMTR
"RTN","DVBAB6",27,0)
 S ^TMP("CAPRI",MSGCNT)=^TMP("CAPRI",MSGCNT)_"Elapsed Days"_DVBADLMTR_"Transferred in from"_DVBADLMTR_"Requested by Name"_DVBADLMTR_"Requested by Division"_DVBADLMTR_"Exams Requested"_DVBADLMTR_"Exam Status"_DVBADLMTR
"RTN","DVBAB6",28,0)
 S ^TMP("CAPRI",MSGCNT)=^TMP("CAPRI",MSGCNT)_"Cell Phone"_DVBADLMTR_"Email Address"_$C(13)
"RTN","DVBAB6",29,0)
 S MSGCNT=MSGCNT+1
"RTN","DVBAB6",30,0)
 Q
"RTN","DVBAB6",31,0)
 ;
"RTN","DVBAB6",32,0)
DATA ; Sort data records
"RTN","DVBAB6",33,0)
 ;
"RTN","DVBAB6",34,0)
 S DFN="" F  S DFN=$O(^DVB(396.3,"B",DFN)) Q:DFN=""  F REQDA=0:0 S REQDA=$O(^DVB(396.3,"B",DFN,REQDA)) Q:REQDA=""  D SORT^DVBAB5
"RTN","DVBAB6",35,0)
 N EXAMRECRD
"RTN","DVBAB6",36,0)
 I DVBCSORT="V" S PNAM="" F  S PNAM=$O(^TMP($J,PNAM)) Q:PNAM=""  F DFN=0:0 S DFN=$O(^TMP($J,PNAM,DFN)) Q:'DFN  F DA(1)=0:0 S DA(1)=$O(^TMP($J,PNAM,DFN,DA(1))) Q:'DA(1)  D PRINT I $D(OUT) S DA(1)=999999999,PNAM="ZZZ",DONE="YES" Q
"RTN","DVBAB6",37,0)
 I DVBCSORT="R"!(DVBCSORT="A")!(DVBCSORT="S") D
"RTN","DVBAB6",38,0)
 . S JX="" F  S JX=$O(^TMP($J,JX)) Q:JX=""  D
"RTN","DVBAB6",39,0)
 .. S PNAM="" F  S PNAM=$O(^TMP($J,JX,PNAM)) Q:PNAM=""  D
"RTN","DVBAB6",40,0)
 ... F DFN=0:0 S DFN=$O(^TMP($J,JX,PNAM,DFN)) Q:'DFN  D NXT
"RTN","DVBAB6",41,0)
 I DVBCCNT>0 S ^TMP("CAPRI",MSGCNT)="Total pending: "_DVBCCNT,DONE="YES"
"RTN","DVBAB6",42,0)
 ;
"RTN","DVBAB6",43,0)
EXIT I NODATA=0 S ^TMP("CAPRI",MSGCNT)="No pending request found for select parameters.",MSG=$NA(^TMP("CAPRI"))
"RTN","DVBAB6",44,0)
 I DONE="YES" S MSG=$NA(^TMP("CAPRI"))
"RTN","DVBAB6",45,0)
 K ^TMP($J),ADIV,CNUM,NODATA,STATUS,TST,TSTA1,STSAT,PG,PRTNM,RDATE,RDATE1,REQDA,SSN,RONAME,JX,TRNSFIN,PROCDT,REQSTR,MSGCNT,TSTAT
"RTN","DVBAB6",46,0)
 K DA,DFN,DONE,DVBCCNT,DVBCDT,DVBCHDR,X,XX,ZS,ZZZ,HEAD,HEAD2,OUT,OWNDOM,EDAYS,PNAM,DVBADLMTR,EXAMRECRD,ROFILTER,RONUM,VADM(1),VADM(2)
"RTN","DVBAB6",47,0)
 K DVBCELL,DVBEMA
"RTN","DVBAB6",48,0)
 Q
"RTN","DVBAB6",49,0)
 ;
"RTN","DVBAB6",50,0)
PRINT ; print 2507 request data
"RTN","DVBAB6",51,0)
 ;
"RTN","DVBAB6",52,0)
 S ADIV=$S($D(^DVB(396.3,DA(1),1)):$P(^(1),U,4),1:"") Q:ADIV'=ADIVNUM&(DVBCSORT="R")  I ADIV]"" S ADIV=$S($D(^DG(40.8,+ADIV,0)):$P(^(0),U,1),1:"Unknown Division")
"RTN","DVBAB6",53,0)
 S RDATE1=$P(^DVB(396.3,DA(1),0),U,2),RDATE=$P(^(0),U,5)
"RTN","DVBAB6",54,0)
 S SSN=$P($G(^DPT(DFN,0)),U,9) S:SSN="" SSN="Unknown"
"RTN","DVBAB6",55,0)
 S DVBCELL=$P($G(^DPT(DFN,.13)),U,4)
"RTN","DVBAB6",56,0)
 S DVBEMA=$P($G(^DPT(DFN,.13)),U,3)
"RTN","DVBAB6",57,0)
 S CNUM=$P($G(^DPT(DFN,.31)),U,3) S:CNUM="" CNUM="Unknown"
"RTN","DVBAB6",58,0)
 S OWNDOM=$P(^DVB(396.3,DA(1),0),U,22) I OWNDOM]"" S TRNSFIN=$S($D(^DIC(4.2,+OWNDOM,0)):$P(^(0),U,1),1:"Unknown Site") I $G(DVBADLMTR)=0 S ^TMP("CAPRI",MSGCNT)="Transferred in from "_TRNSFIN_"^",MSGCNT=MSGCNT+1
"RTN","DVBAB6",59,0)
 D ELAPSED^DVBAB5
"RTN","DVBAB6",60,0)
 S STATUS="Unknown",XX=$P(^DVB(396.3,DA(1),0),U,18),STATUS=$S(XX="N":"New",XX="P":"Pending, reported",XX="S":"Pending, scheduled",XX="R":"Released to RO, not printed",1:"")
"RTN","DVBAB6",61,0)
 I STATUS="",$D(XX) S STATUS=$S(XX="C":"Completed, printed by RO",XX="X":"Cancelled by RO",XX="T":"Transcribed",XX="NT":"New,Transferred in",XX="CT":"Completed, Transferred out",1:"Unknown")
"RTN","DVBAB6",62,0)
 I $G(DVBADLMTR)="," D PRINTD,ITEMS Q
"RTN","DVBAB6",63,0)
 S ^TMP("CAPRI",MSGCNT)="Division: "_ADIV_"^",MSGCNT=MSGCNT+1
"RTN","DVBAB6",64,0)
 S ^TMP("CAPRI",MSGCNT)="Status: "_STATUS_"^",MSGCNT=MSGCNT+1
"RTN","DVBAB6",65,0)
 S ^TMP("CAPRI",MSGCNT)=PNAM_" ^",MSGCNT=MSGCNT+1
"RTN","DVBAB6",66,0)
 S ^TMP("CAPRI",MSGCNT)="SSN: "_SSN_"^",MSGCNT=MSGCNT+1
"RTN","DVBAB6",67,0)
 S ^TMP("CAPRI",MSGCNT)="Cell no.: "_DVBCELL_"^",MSGCNT=MSGCNT+1
"RTN","DVBAB6",68,0)
 S ^TMP("CAPRI",MSGCNT)="Email: "_DVBEMA_"^",MSGCNT=MSGCNT+1
"RTN","DVBAB6",69,0)
 S ^TMP("CAPRI",MSGCNT)="Claim no: "_CNUM_"^",MSGCNT=MSGCNT+1
"RTN","DVBAB6",70,0)
 S ^TMP("CAPRI",MSGCNT)="Request Date: "_$$FMTE^XLFDT(RDATE1,"5DZ")_"^",MSGCNT=MSGCNT+1
"RTN","DVBAB6",71,0)
 S ^TMP("CAPRI",MSGCNT)="Elapsed days: "_EDAYS_"^",MSGCNT=MSGCNT+1
"RTN","DVBAB6",72,0)
 S X=$S($D(^DVB(396.3,DA(1),4)):^(4),1:"")
"RTN","DVBAB6",73,0)
 S ^TMP("CAPRI",MSGCNT)="^",MSGCNT=MSGCNT+1
"RTN","DVBAB6",74,0)
 S ^TMP("CAPRI",MSGCNT)="Exams requested:"_"^",MSGCNT=MSGCNT+1
"RTN","DVBAB6",75,0)
 ;
"RTN","DVBAB6",76,0)
ITEMS S NODATA=1,REQSTR=+$P(^DVB(396.3,DA(1),0),U,4)
"RTN","DVBAB6",77,0)
 S ZZZ="Requested by: "_$S($D(^VA(200,+REQSTR,0)):$P(^(0),U,1),1:" (Not specified) ")_" at "
"RTN","DVBAB6",78,0)
 S RONAME=$P(^DVB(396.3,DA(1),0),U,3),RONAME=$S(RONAME]"":$P(^DIC(4,+RONAME,0),U,1),1:"")
"RTN","DVBAB6",79,0)
 I $G(DVBADLMTR)'="," D ITEMSND Q
"RTN","DVBAB6",80,0)
 I $G(DVBADLMTR)="," D ITEMSD Q
"RTN","DVBAB6",81,0)
ITEMSND D TST S ^TMP("CAPRI",MSGCNT)="^"_ZZZ_$S(RONAME]"":RONAME,1:" (Not specified) ")_"^",MSGCNT=MSGCNT+1
"RTN","DVBAB6",82,0)
 S ^TMP("CAPRI",MSGCNT)="^",MSGCNT=MSGCNT+1
"RTN","DVBAB6",83,0)
 S $P(^TMP("CAPRI",MSGCNT),"-",75)="-^",MSGCNT=MSGCNT+1
"RTN","DVBAB6",84,0)
 S DVBCCNT=DVBCCNT+1
"RTN","DVBAB6",85,0)
 Q
"RTN","DVBAB6",86,0)
ITEMSD S ZZZ=$S($D(^VA(200,+REQSTR,0)):$P(^(0),U,1),1:" (Not specified) ")
"RTN","DVBAB6",87,0)
 S EXAMRECRD=EXAMRECRD_""""_ZZZ_""""_DVBADLMTR_""""_RONAME_""""_DVBADLMTR
"RTN","DVBAB6",88,0)
 D TST S DVBCCNT=DVBCCNT+1
"RTN","DVBAB6",89,0)
 Q
"RTN","DVBAB6",90,0)
 ;
"RTN","DVBAB6",91,0)
PRINTD ; Print delimited format output on report
"RTN","DVBAB6",92,0)
 ;
"RTN","DVBAB6",93,0)
 I OWNDOM']"" S TRNSFIN=""
"RTN","DVBAB6",94,0)
 S RONUM=$P(^DVB(396.3,DA(1),0),U,3)
"RTN","DVBAB6",95,0)
 D DEM^VADPT I $G(VADM(1))'="" S SSN=$S(DVBADLMTR=",":$P($G(VADM(2)),U,2),1:$P($G(VADM(2)),U,1))
"RTN","DVBAB6",96,0)
 S EXAMRECRD=$S($G(ROFILTER)'=0:RONUM_DVBADLMTR,1:"")_""""_ADIV_""""_DVBADLMTR_""""_STATUS_""""_DVBADLMTR_""""_PNAM_""""_DVBADLMTR
"RTN","DVBAB6",97,0)
 S EXAMRECRD=EXAMRECRD_SSN_DVBADLMTR_$C(160)_CNUM_DVBADLMTR_$$FMTE^XLFDT(RDATE1,"5DZ")_DVBADLMTR_EDAYS_DVBADLMTR_TRNSFIN_DVBADLMTR
"RTN","DVBAB6",98,0)
 Q
"RTN","DVBAB6",99,0)
 ;
"RTN","DVBAB6",100,0)
NXT F DA(1)=0:0 S DA(1)=$O(^TMP($J,JX,PNAM,DFN,DA(1))) Q:DA(1)=""  D PRINT I $D(OUT) S DA(1)="",PNAM="ZZZZ",JX=$S($A(JX)>57:PNAM,1:9999999),DONE="YES"
"RTN","DVBAB6",101,0)
 Q
"RTN","DVBAB6",102,0)
TST F DA=0:0 S DA=$O(^DVB(396.4,"C",DA(1),DA)) Q:DA=""  K PRINT S TSTAT=$P(^DVB(396.4,DA,0),U,4),TST=$P(^DVB(396.4,DA,0),U,3),PRTNM=$S($D(^DVB(396.6,TST,0)):$P(^(0),U,2),1:"") D TST1
"RTN","DVBAB6",103,0)
 Q
"RTN","DVBAB6",104,0)
TST1 S TSTA1=""
"RTN","DVBAB6",105,0)
 I $D(^DVB(396.4,DA,"CAN")) S TSTA1=$P(^DVB(396.4,DA,"CAN"),U,3)
"RTN","DVBAB6",106,0)
 I $D(^DVB(396.4,DA,"TRAN")) S X=$P(^DVB(396.4,DA,"TRAN"),U,3)
"RTN","DVBAB6",107,0)
 S:TSTA1]"" TSTA1=$P(^DVB(396.5,TSTA1,0),U,1)
"RTN","DVBAB6",108,0)
 I $G(DVBADLMTR)'="," D
"RTN","DVBAB6",109,0)
 . S ^TMP("CAPRI",MSGCNT)=$S(PRTNM]"":PRTNM,1:"Missing exam name")
"RTN","DVBAB6",110,0)
 . S ^TMP("CAPRI",MSGCNT)=^TMP("CAPRI",MSGCNT)_$S(TSTA1]"":" - cancelled ("_TSTA1_")",TSTAT="T":" - Transferred",TSTAT]"":" - "_$$EXTERNAL^DILFD(396.4,.04,,TSTAT),TSTAT="":" (Unknown status)",1:"")_"^"
"RTN","DVBAB6",111,0)
 . S MSGCNT=MSGCNT+1
"RTN","DVBAB6",112,0)
 . I TSTAT="T" S X=$S($D(^DIC(4.2,+X,0)):$P(^(0),U,1),1:"unknown site") S ^TMP("CAPRI",MSGCNT)=" to "_$P(X,".",1),MSGCNT=MSGCNT+1
"RTN","DVBAB6",113,0)
 . Q
"RTN","DVBAB6",114,0)
 I $G(DVBADLMTR)="," D
"RTN","DVBAB6",115,0)
 . S PRTNM=$S(PRTNM]"":PRTNM,1:"Missing exam name"),TSTAT=$S(TSTA1]"":"Cancelled ("_TSTA1_")",TSTAT="T":"Transferred",TSTAT]"":$$EXTERNAL^DILFD(396.4,.04,,TSTAT),TSTAT="":" (Unknown status)",1:"")
"RTN","DVBAB6",116,0)
 . S ^TMP("CAPRI",MSGCNT)=EXAMRECRD_""""_PRTNM_""""_DVBADLMTR_""""_TSTAT_""""_DVBADLMTR_""""_DVBCELL_""""_DVBADLMTR_""""_DVBEMA_""""
"RTN","DVBAB6",117,0)
 . I TSTAT="T" S X=$S($D(^DIC(4.2,+X,0)):$P(^(0),U,1),1:"unknown site") S ^TMP("CAPRI",MSGCNT)=^TMP("CAPRI",MSGCNT)_" to "_$P(X,".",1)
"RTN","DVBAB6",118,0)
 . S ^TMP("CAPRI",MSGCNT)=^TMP("CAPRI",MSGCNT)_$C(13)
"RTN","DVBAB6",119,0)
 S MSGCNT=MSGCNT+1
"RTN","DVBAB6",120,0)
 Q
"RTN","DVBARSBD")
0^3^B106363771^B106348391
"RTN","DVBARSBD",1,0)
DVBARSBD ;ALB/RPM - CAPRI 2507 REQUEST STATUS BY DT RANGE REPORT ; 01/24/12
"RTN","DVBARSBD",2,0)
 ;;2.7;AMIE;**179,185,189,190**;Apr 10, 1995;Build 24
"RTN","DVBARSBD",3,0)
 ;
"RTN","DVBARSBD",4,0)
 Q  ;NO DIRECT ENTRY
"RTN","DVBARSBD",5,0)
 ;
"RTN","DVBARSBD",6,0)
REQSTAT(DVBSDAT,DVBEDAT,DVBRSTAT,DVBDELIM,DVBNODT) ;entry for request status by dt range
"RTN","DVBARSBD",7,0)
 ;
"RTN","DVBARSBD",8,0)
 ;  Input:
"RTN","DVBARSBD",9,0)
 ;    DVBSDAT - start date (FM format)
"RTN","DVBARSBD",10,0)
 ;    DVBEDAT - end date (FM format)
"RTN","DVBARSBD",11,0)
 ;    DVBRSTAT - request status (internal format)
"RTN","DVBARSBD",12,0)
 ;    DVBDELIM - return delimited results (0=no;1=yes)
"RTN","DVBARSBD",13,0)
 ;    DVBNODT - ignore date range (0=no;1=yes)
"RTN","DVBARSBD",14,0)
 ;
"RTN","DVBARSBD",15,0)
 N EXSTAT  ;request status (external format)
"RTN","DVBARSBD",16,0)
 N EXSDAT  ;start date (external format: MM/DD/YYYY)
"RTN","DVBARSBD",17,0)
 N EXEDAT  ;end date (external format: MM/DD/YYYY)
"RTN","DVBARSBD",18,0)
 N DVBARS  ;request status conversion results
"RTN","DVBARSBD",19,0)
 N DVBERR  ;FM error msg
"RTN","DVBARSBD",20,0)
 N DVBCNT   ;returned record count
"RTN","DVBARSBD",21,0)
 ;
"RTN","DVBARSBD",22,0)
 K ^TMP("DVBREQ",$J),^TMP("DVBREQN",$J)
"RTN","DVBARSBD",23,0)
 S EXSDAT=$$FMTE^XLFDT(DVBSDAT,"5DZ")
"RTN","DVBARSBD",24,0)
 S EXEDAT=$$FMTE^XLFDT(DVBEDAT,"5DZ")
"RTN","DVBARSBD",25,0)
 I DVBRSTAT="A" S EXSTAT="ALL"
"RTN","DVBARSBD",26,0)
 E  D
"RTN","DVBARSBD",27,0)
 . D CHK^DIE(396.3,17,"E",DVBRSTAT,.DVBARS,"DVBERR")
"RTN","DVBARSBD",28,0)
 . S EXSTAT=$G(DVBARS(0))
"RTN","DVBARSBD",29,0)
 S DVBCNT=1
"RTN","DVBARSBD",30,0)
 S DVBAD=$S(DVBDELIM=1:",",1:0)
"RTN","DVBARSBD",31,0)
 ;
"RTN","DVBARSBD",32,0)
 ;collect records matching search criteria
"RTN","DVBARSBD",33,0)
 I DVBNODT D
"RTN","DVBARSBD",34,0)
 . S EXSDAT="NO START DATE"
"RTN","DVBARSBD",35,0)
 . S EXEDAT="NO END DATE"
"RTN","DVBARSBD",36,0)
 . I DVBDELIM D DELIMHDR(EXSDAT,EXEDAT,EXSTAT)
"RTN","DVBARSBD",37,0)
 . D GETRECSN(DVBRSTAT,.DVBCNT)
"RTN","DVBARSBD",38,0)
 E  D
"RTN","DVBARSBD",39,0)
 . I DVBDELIM D DELIMHDR(EXSDAT,EXEDAT,EXSTAT)
"RTN","DVBARSBD",40,0)
 . D GETRECS(DVBSDAT,DVBEDAT,DVBRSTAT,.DVBCNT)
"RTN","DVBARSBD",41,0)
 ;
"RTN","DVBARSBD",42,0)
 ;output results
"RTN","DVBARSBD",43,0)
 I 'DVBCNT D
"RTN","DVBARSBD",44,0)
 . W "NO DATA FOUND"
"RTN","DVBARSBD",45,0)
 E  D
"RTN","DVBARSBD",46,0)
 . I 'DVBDELIM D PLAINHDR(EXSDAT,EXEDAT,EXSTAT),PLAIN  ;plain text format
"RTN","DVBARSBD",47,0)
 . I DVBDELIM D DELIM  ;comma delimited format
"RTN","DVBARSBD",48,0)
 ;
"RTN","DVBARSBD",49,0)
END ;Clean up local variables
"RTN","DVBARSBD",50,0)
 K DIWF,DIWL,DIWR,DVBAD,DVBAX,DVBAY,DVBCNRS,DVBEXAM,DVBIEN4,DVBI2,DVBX,DVBXCNT,LINE,X
"RTN","DVBARSBD",51,0)
 K ^TMP("DVBREQ"),^TMP("DVBREQH")
"RTN","DVBARSBD",52,0)
 Q
"RTN","DVBARSBD",53,0)
 ;
"RTN","DVBARSBD",54,0)
GETRECS(SDAT,EDAT,RSTAT,CNT) ;collect 2507 REQUEST record matches
"RTN","DVBARSBD",55,0)
 ;This procedure collects all 2507 REQUEST records that have a
"RTN","DVBARSBD",56,0)
 ;DATE STATUS LAST CHANGED within the start and end dates and have
"RTN","DVBARSBD",57,0)
 ;a REQUEST STATUS that matches the input request status parameter.
"RTN","DVBARSBD",58,0)
 ;
"RTN","DVBARSBD",59,0)
 ;  Input:
"RTN","DVBARSBD",60,0)
 ;    SDAT - start date (FM format)
"RTN","DVBARSBD",61,0)
 ;    EDAT - end date (FM format)
"RTN","DVBARSBD",62,0)
 ;    RSTAT - request status (internal format)
"RTN","DVBARSBD",63,0)
 ;    CNT - record count (passed by reference)
"RTN","DVBARSBD",64,0)
 ;
"RTN","DVBARSBD",65,0)
 N CHGDAT  ;change date
"RTN","DVBARSBD",66,0)
 N DVBIEN  ;2507 REQUEST IEN
"RTN","DVBARSBD",67,0)
 N DVBSTAT ;2507 REQUEST STATUS
"RTN","DVBARSBD",68,0)
 N FLD     ;field array in external format
"RTN","DVBARSBD",69,0)
 ;
"RTN","DVBARSBD",70,0)
 S CHGDAT=SDAT-1
"RTN","DVBARSBD",71,0)
 S DVBIEN=0,CNT=0 F  S CHGDAT=$O(^DVB(396.3,"AH",CHGDAT)) Q:'CHGDAT!(CHGDAT>EDAT)  D
"RTN","DVBARSBD",72,0)
 . F  S DVBIEN=$O(^DVB(396.3,"AH",CHGDAT,DVBIEN)) Q:'DVBIEN  D
"RTN","DVBARSBD",73,0)
 . . S DVBSTAT=$$GET1^DIQ(396.3,DVBIEN_",",17,"I","","")
"RTN","DVBARSBD",74,0)
 . . I RSTAT="A"!(DVBSTAT=RSTAT) D
"RTN","DVBARSBD",75,0)
 . . . K FLD
"RTN","DVBARSBD",76,0)
 . . . I $$SETFLDS(DVBIEN,.FLD) D
"RTN","DVBARSBD",77,0)
 . . . . S CNT=CNT+1,DVBXCNT=1
"RTN","DVBARSBD",78,0)
 . . . . I $G(DVBAD)'="," S ^TMP("DVBREQ",$J,CNT)=FLD("IEN")_U_FLD("SS")_U_FLD("NM")_U_FLD("REQDT")_U_FLD("RELDT")_U_FLD("PRTDT")_U_FLD("RS")_U_FLD("CANDT")_U_FLD("RO")_U_FLD("CANRS",DVBXCNT)_U_FLD("CANCOM",DVBXCNT)_U_FLD("EXAM",DVBXCNT) D
"RTN","DVBARSBD",79,0)
 . . . . . S DVBXCNT=DVBXCNT+1 Q
"RTN","DVBARSBD",80,0)
 . . . . I $G(DVBAD)="," D
"RTN","DVBARSBD",81,0)
 . . . . . S ^TMP("DVBREQ",$J,CNT)=FLD("SS")_DVBAD_""""_FLD("NM")_""""_DVBAD_FLD("REQDT")_DVBAD_FLD("RELDT")_DVBAD_FLD("PRTDT")_DVBAD
"RTN","DVBARSBD",82,0)
 . . . . . S ^TMP("DVBREQ",$J,CNT)=^TMP("DVBREQ",$J,CNT)_""""_FLD("RS")_""""_DVBAD_FLD("CANDT")_DVBAD_""""_FLD("RO")_""""_DVBAD
"RTN","DVBARSBD",83,0)
 . . . . . S DVBX=0 F  S DVBX=$O(FLD("IEN4",DVBX)) Q:'DVBX  D
"RTN","DVBARSBD",84,0)
 . . . . . . S ^TMP("DVBREQ",$J,CNT,DVBX)=^TMP("DVBREQ",$J,CNT)_$C(13)_FLD("SS")_DVBAD_DVBAD_DVBAD_DVBAD_DVBAD_DVBAD_DVBAD_DVBAD_""""_FLD("EXAM",DVBXCNT)_""""_DVBAD_""""_FLD("CANRS",DVBXCNT)_""""_DVBAD_""""_FLD("CANCOM",DVBXCNT)_""""_$C(13)
"RTN","DVBARSBD",85,0)
 . . . . . . S DVBXCNT=DVBXCNT+1
"RTN","DVBARSBD",86,0)
 Q
"RTN","DVBARSBD",87,0)
 ;
"RTN","DVBARSBD",88,0)
SETFLDS(DVBIEN,DVBFLDS) ;build field array in external format
"RTN","DVBARSBD",89,0)
 ;This function formats the collected record data in external format
"RTN","DVBARSBD",90,0)
 ;and returns the results TRUE and an array on success.  Otherwise,
"RTN","DVBARSBD",91,0)
 ;the function returns FALSE.
"RTN","DVBARSBD",92,0)
 ;
"RTN","DVBARSBD",93,0)
 ;  Integration Reference #10061 - DEM^VADPT
"RTN","DVBARSBD",94,0)
 ;
"RTN","DVBARSBD",95,0)
 ;  Input:
"RTN","DVBARSBD",96,0)
 ;    DVBIEN - 2507 REQUEST IEN
"RTN","DVBARSBD",97,0)
 ;    DVBFLDS - field array passed by reference
"RTN","DVBARSBD",98,0)
 ;
"RTN","DVBARSBD",99,0)
 ;  Output:
"RTN","DVBARSBD",100,0)
 ;    DVBFLDS("IEN") - 2507 REQUEST IEN
"RTN","DVBARSBD",101,0)
 ;    DVBFLDS("NM") - patient name
"RTN","DVBARSBD",102,0)
 ;    DVBFLDS("SS") - social security number
"RTN","DVBARSBD",103,0)
 ;    DVBFLDS("RS") - request status
"RTN","DVBARSBD",104,0)
 ;    DVBFLDS("REQDT") - request date
"RTN","DVBARSBD",105,0)
 ;    DVBFLDS("RELDT") - release date
"RTN","DVBARSBD",106,0)
 ;    DVBFLDS("PRTDT") - print date
"RTN","DVBARSBD",107,0)
 ;    DVBFLDS("CANDT") - canceled date
"RTN","DVBARSBD",108,0)
 ;    DVBFLDS("RO") - regional office
"RTN","DVBARSBD",109,0)
 ;    DVBFLDS("IREQDT") - request date in internal FM format
"RTN","DVBARSBD",110,0)
 ;    DVBFLDS("EXAM") - added with patch DVB*2.7*189; HOLDS THE 2507 EXAM name   
"RTN","DVBARSBD",111,0)
 ;    DVBFLDS("CANRS") - added with patch DVB*2.7*189; HOLDS THE 2507 EXAM CANCELLATION REASON name
"RTN","DVBARSBD",112,0)
 ;    DVBFLDS("CANCOM") - added with patch DVB*2.7*189; HOLDS THE 2507 EXAM CANCELLATION COMMENTS name
"RTN","DVBARSBD",113,0)
 ;    Function Result - return 1 on success; otherwise returns 0
"RTN","DVBARSBD",114,0)
 ;
"RTN","DVBARSBD",115,0)
 N DFN  ;PATIENT file IEN used in VADPT call
"RTN","DVBARSBD",116,0)
 N DVBDAT  ;2507 REQUEST data field array
"RTN","DVBARSBD",117,0)
 N DVBIENS  ;FM IENS value
"RTN","DVBARSBD",118,0)
 N DVBRSLT  ;function result
"RTN","DVBARSBD",119,0)
 N VADM  ;VADPT return array
"RTN","DVBARSBD",120,0)
 N DVBIEN4 ;the IEN FROM 2507 EXAM FILE 396.4
"RTN","DVBARSBD",121,0)
 N DVBALAST ;number of lines in the wp cancellation comments
"RTN","DVBARSBD",122,0)
 N DVBAI  ;for loop index
"RTN","DVBARSBD",123,0)
 N DVBAX ;
"RTN","DVBARSBD",124,0)
 ;
"RTN","DVBARSBD",125,0)
 S DVBRSLT=0
"RTN","DVBARSBD",126,0)
 S DVBIENS=+$G(DVBIEN)_","
"RTN","DVBARSBD",127,0)
 D GETS^DIQ(396.3,DVBIENS,".01;1;2;13;15;17;19","IE","DVBDAT","")
"RTN","DVBARSBD",128,0)
 S DFN=$G(DVBDAT(396.3,DVBIENS,.01,"I"))
"RTN","DVBARSBD",129,0)
 D DEM^VADPT
"RTN","DVBARSBD",130,0)
 I $G(VADM(1))'="" D  ;only return record when name is resolved
"RTN","DVBARSBD",131,0)
 . S DVBFLDS("IEN")=DVBIEN
"RTN","DVBARSBD",132,0)
 . S DVBFLDS("NM")=$G(VADM(1))
"RTN","DVBARSBD",133,0)
 . S DVBFLDS("SS")=$S(DVBDELIM:$P($G(VADM(2)),U,2),1:$P($G(VADM(2)),U,1))
"RTN","DVBARSBD",134,0)
 . S DVBFLDS("RS")=$G(DVBDAT(396.3,DVBIENS,17,"E"))
"RTN","DVBARSBD",135,0)
 . S DVBFLDS("REQDT")=$$FMTE^XLFDT($G(DVBDAT(396.3,DVBIENS,1,"I")),"5DZ")
"RTN","DVBARSBD",136,0)
 . S DVBFLDS("RELDT")=$$FMTE^XLFDT($G(DVBDAT(396.3,DVBIENS,13,"I")),"5DZ")
"RTN","DVBARSBD",137,0)
 . S DVBFLDS("PRTDT")=$$FMTE^XLFDT($G(DVBDAT(396.3,DVBIENS,15,"I")),"5DZ")
"RTN","DVBARSBD",138,0)
 . S DVBFLDS("CANDT")=$$FMTE^XLFDT($G(DVBDAT(396.3,DVBIENS,19,"I")),"5DZ")
"RTN","DVBARSBD",139,0)
 . S DVBFLDS("RO")=$G(DVBDAT(396.3,DVBIENS,2,"E"))
"RTN","DVBARSBD",140,0)
 . S DVBXCNT=1
"RTN","DVBARSBD",141,0)
 . S (DVBFLDS("EXAM",DVBXCNT),DVBFLDS("CANRS",DVBXCNT),DVBFLDS("CANCOM",DVBXCNT),DVBFLDS("IEN4"))=""
"RTN","DVBARSBD",142,0)
 . S DVBIEN4=0 F  S DVBIEN4=$O(^DVB(396.4,"C",DVBIEN,DVBIEN4)) Q:'DVBIEN4  D
"RTN","DVBARSBD",143,0)
 . . I $D(^DVB(396.4,DVBIEN4,"CAN")) D
"RTN","DVBARSBD",144,0)
 . . . S DVBAY=($P($P(^DVB(396.4,DVBIEN4,"CAN"),"^",1),".",1)) I DVBAY>(DVBSDAT-1)&DVBAY<(DVBEDAT+1) D
"RTN","DVBARSBD",145,0)
 . . . . S DVBFLDS("EXAM",DVBXCNT)=$$GET1^DIQ(396.4,DVBIEN4,.03),DVBFLDS("CANRS",DVBXCNT)=$$GET1^DIQ(396.4,DVBIEN4,52)
"RTN","DVBARSBD",146,0)
 . . . . I $D(^DVB(396.4,DVBIEN4,5)) D
"RTN","DVBARSBD",147,0)
 . . . . . S DVBFLDS("IEN4",DVBXCNT)=DVBIEN4
"RTN","DVBARSBD",148,0)
 . . . . . K WP S DVBAX=$$GET1^DIQ(396.4,DVBIEN4,53,"Z","WP") ; this puts the wordprocessing field into an array 'WP(#,0)=' next it gets put into one entry of the DVBFLDS ARRAY so we can handle any comma's that aren't delimiters
"RTN","DVBARSBD",149,0)
 . . . . . ;DVBALAST gets the number of WP lines to loop through in the for loop
"RTN","DVBARSBD",150,0)
 . . . . . S DVBALAST=$P(^DVB(396.4,DVBIEN4,5,0),U,3) S DVBAI="",DVBFLDS("CANCOM",DVBXCNT)=WP(1,0) F DVBAI=2:1:DVBALAST S DVBFLDS("CANCOM",DVBXCNT)=DVBFLDS("CANCOM",DVBXCNT)_WP(DVBAI,0)
"RTN","DVBARSBD",151,0)
 . . . . . S DVBXCNT=DVBXCNT+1
"RTN","DVBARSBD",152,0)
 . S DVBFLDS("IREQDT")=$G(DVBDAT(396.3,DVBIENS,1,"I"))
"RTN","DVBARSBD",153,0)
 . S DVBRSLT=1
"RTN","DVBARSBD",154,0)
 Q DVBRSLT
"RTN","DVBARSBD",155,0)
 ;
"RTN","DVBARSBD",156,0)
DELIMHDR(EXSDAT,EXEDAT,EXSTAT) ;output delimited format header
"RTN","DVBARSBD",157,0)
 ;  Input:
"RTN","DVBARSBD",158,0)
 ;    EXSDAT - start date (external format)
"RTN","DVBARSBD",159,0)
 ;    EXEDAT - end date (external format)
"RTN","DVBARSBD",160,0)
 ;    EXSTAT - request status (external format)
"RTN","DVBARSBD",161,0)
 S ^TMP("DVBREQH",$J,DVBCNT)="Request Status by Date Range Report",DVBCNT=DVBCNT+1
"RTN","DVBARSBD",162,0)
 S ^TMP("DVBREQH",$J,DVBCNT)="Date Range: "_EXSDAT_" - "_EXEDAT,DVBCNT=DVBCNT+1
"RTN","DVBARSBD",163,0)
 S ^TMP("DVBREQH",$J,DVBCNT)=""""_"Request Status: "_EXSTAT_""""_$C(13),DVBCNT=DVBCNT+1
"RTN","DVBARSBD",164,0)
 S ^TMP("DVBREQH",$J,DVBCNT)="SSN"_DVBAD_"PatientName"_DVBAD_"RequestDT"_DVBAD_"DTReleased"_DVBAD_"DTPrinted"_DVBAD_"RequestStatus"_DVBAD_"DtCanceled"_DVBAD_"Station"_DVBAD_"EXAM"_DVBAD_"CANCEL RSN"_DVBAD_"CANCEL CMNTS",DVBCNT=DVBCNT+1
"RTN","DVBARSBD",165,0)
 Q
"RTN","DVBARSBD",166,0)
 ;
"RTN","DVBARSBD",167,0)
DELIM ;output delimited format
"RTN","DVBARSBD",168,0)
 ;
"RTN","DVBARSBD",169,0)
 N DVBI     ;generic counter
"RTN","DVBARSBD",170,0)
 N DVBREQ   ;request record
"RTN","DVBARSBD",171,0)
 ;
"RTN","DVBARSBD",172,0)
 U IO
"RTN","DVBARSBD",173,0)
 S DVBI=0
"RTN","DVBARSBD",174,0)
 F  S DVBI=$O(^TMP("DVBREQH",$J,DVBI)) Q:'DVBI  D
"RTN","DVBARSBD",175,0)
 . S DVBREQ=^TMP("DVBREQH",$J,DVBI)
"RTN","DVBARSBD",176,0)
 . W !,DVBREQ
"RTN","DVBARSBD",177,0)
 S DVBI=0 F  S DVBI=$O(^TMP("DVBREQ",$J,DVBI)) Q:'DVBI  D
"RTN","DVBARSBD",178,0)
 . S DVBREQ=^TMP("DVBREQ",$J,DVBI)
"RTN","DVBARSBD",179,0)
 . W !,DVBREQ
"RTN","DVBARSBD",180,0)
 . S DVBI2=0 F  S DVBI2=$O(^TMP("DVBREQ",$J,DVBI,DVBI2)) Q:'DVBI2  D
"RTN","DVBARSBD",181,0)
 . .S DVBREQ=^TMP("DVBREQ",$J,DVBI,DVBI2)
"RTN","DVBARSBD",182,0)
 . .W !,DVBREQ
"RTN","DVBARSBD",183,0)
 Q
"RTN","DVBARSBD",184,0)
 ;
"RTN","DVBARSBD",185,0)
PLAINHDR(EXSDAT,EXEDAT,EXSTAT)  ;output plain text header
"RTN","DVBARSBD",186,0)
 ;Populate the header information.
"RTN","DVBARSBD",187,0)
 ;CAUTION:  The CAPRI GUI pulls this information to populate the header
"RTN","DVBARSBD",188,0)
 ;for each page when creating a printed report.  Do not modify the
"RTN","DVBARSBD",189,0)
 ;content or line count of the header information without validating
"RTN","DVBARSBD",190,0)
 ;against the CAPRI GUI interface.
"RTN","DVBARSBD",191,0)
 ;
"RTN","DVBARSBD",192,0)
 ;CAPRI GUI to populate 
"RTN","DVBARSBD",193,0)
 ;  Input:
"RTN","DVBARSBD",194,0)
 ;    EXSDAT - start date (external format)
"RTN","DVBARSBD",195,0)
 ;    EXEDAT - end date (external format)
"RTN","DVBARSBD",196,0)
 ;    EXSTAT - request status (external format)
"RTN","DVBARSBD",197,0)
 ;
"RTN","DVBARSBD",198,0)
 N DVBLINE  ;header separator
"RTN","DVBARSBD",199,0)
 ;
"RTN","DVBARSBD",200,0)
 U IO
"RTN","DVBARSBD",201,0)
 S $P(DVBLINE,"-",131)=""
"RTN","DVBARSBD",202,0)
 W "Date Range: "_EXSDAT_" - "_EXEDAT
"RTN","DVBARSBD",203,0)
 W !,"Request Status: ",EXSTAT
"RTN","DVBARSBD",204,0)
 W !
"RTN","DVBARSBD",205,0)
 W !,"SSN",?11,"PATIENT NAME",?33,"REQUEST DT",?45,"DT RELEASED"
"RTN","DVBARSBD",206,0)
 W ?57,"DT PRINTED",?69,"STATUS",?98,"DT CANCELED",?110,"STATION"
"RTN","DVBARSBD",207,0)
 W !,?2,"EXAM",?65,"CANCELLATION REASON"
"RTN","DVBARSBD",208,0)
 W !,?2,"CANCELLATION COMMENTS"
"RTN","DVBARSBD",209,0)
 W !,DVBLINE
"RTN","DVBARSBD",210,0)
 Q
"RTN","DVBARSBD",211,0)
 ;
"RTN","DVBARSBD",212,0)
PLAIN ;output plain text format
"RTN","DVBARSBD",213,0)
 ;Output formatted text format.  The patient name and station name
"RTN","DVBARSBD",214,0)
 ;are truncated at 20 characters to maintain 132 character report.
"RTN","DVBARSBD",215,0)
 ;
"RTN","DVBARSBD",216,0)
 N DVBI     ;generic counter
"RTN","DVBARSBD",217,0)
 N DVBREQ   ;request record
"RTN","DVBARSBD",218,0)
 ;
"RTN","DVBARSBD",219,0)
 U IO
"RTN","DVBARSBD",220,0)
 S DVBI=0
"RTN","DVBARSBD",221,0)
 F  S DVBI=$O(^TMP("DVBREQ",$J,DVBI)) Q:'DVBI  D
"RTN","DVBARSBD",222,0)
 . S DVBREQ=^TMP("DVBREQ",$J,DVBI)
"RTN","DVBARSBD",223,0)
 . W !,$P(DVBREQ,U,2),?11,$E($P(DVBREQ,U,3),1,20),?33,$P(DVBREQ,U,4)
"RTN","DVBARSBD",224,0)
 . W ?45,$P(DVBREQ,U,5),?57,$P(DVBREQ,U,6),?69,$P(DVBREQ,U,7)
"RTN","DVBARSBD",225,0)
 . W ?98,$P(DVBREQ,U,8),?110,$E($P(DVBREQ,U,9),1,20),!
"RTN","DVBARSBD",226,0)
 . S DVBIEN=$P(^TMP("DVBREQ",$J,DVBI),U,1)
"RTN","DVBARSBD",227,0)
 . S DVBIEN4=0 F  S DVBIEN4=$O(^DVB(396.4,"C",DVBIEN,DVBIEN4)) Q:'DVBIEN4  D
"RTN","DVBARSBD",228,0)
 . . I $D(^DVB(396.4,DVBIEN4,"CAN")) D
"RTN","DVBARSBD",229,0)
 . . . S DVBAY=($P($P(^DVB(396.4,DVBIEN4,"CAN"),"^",1),".",1)) I DVBAY>(DVBSDAT-1)&DVBAY<(DVBEDAT+1) D
"RTN","DVBARSBD",230,0)
 . . . . S DVBEXAM=$$GET1^DIQ(396.4,DVBIEN4,.03) S DVBCNRS=$$GET1^DIQ(396.4,DVBIEN4,52) D
"RTN","DVBARSBD",231,0)
 . . . . . W !,?2,"CANCELED EXAM: ",DVBEXAM,?65,"CANCELLATION REASON: ",DVBCNRS,!
"RTN","DVBARSBD",232,0)
 . . . . I $D(^DVB(396.4,DVBIEN4,5)) D
"RTN","DVBARSBD",233,0)
 . . . . . K ^UTILITY($J,"W")
"RTN","DVBARSBD",234,0)
 . . . . . W !,?2,"CANCELLATION COMMENTS:  " F LINE=0:0 S LINE=$O(^DVB(396.4,DVBIEN4,5,LINE)) Q:LINE=""  S X=^(LINE,0),DIWL=5,DIWR=75,DIWF="NW" D ^DIWP
"RTN","DVBARSBD",235,0)
 . . . . . W !
"RTN","DVBARSBD",236,0)
 Q 
"RTN","DVBARSBD",237,0)
 ;
"RTN","DVBARSBD",238,0)
GETRECSN(RSTAT,CNT) ;collect 2507 REQUEST status matches and ignore date range
"RTN","DVBARSBD",239,0)
 ;This procedure collects all 2507 REQUEST records that have a REQUEST STATUS
"RTN","DVBARSBD",240,0)
 ;that matches the input request status parameter regardless of the LAST
"RTN","DVBARSBD",241,0)
 ;STATUS CHANGE DATE range.  The procedure uses the "AF" index which sorts
"RTN","DVBARSBD",242,0)
 ;by REQUEST STATUS and REGIONAL OFFICE.
"RTN","DVBARSBD",243,0)
 ;
"RTN","DVBARSBD",244,0)
 ;  Input:
"RTN","DVBARSBD",245,0)
 ;    RSTAT - request status (internal format)
"RTN","DVBARSBD",246,0)
 ;    CNT - record count (passed by reference)
"RTN","DVBARSBD",247,0)
 ;
"RTN","DVBARSBD",248,0)
 N CHGDAT  ;change date
"RTN","DVBARSBD",249,0)
 N SRTDAT  ;sort date
"RTN","DVBARSBD",250,0)
 N DVBIEN  ;2507 REQUEST IEN
"RTN","DVBARSBD",251,0)
 N FLD     ;field array in external format
"RTN","DVBARSBD",252,0)
 N DVBRO   ;regional office
"RTN","DVBARSBD",253,0)
 ;
"RTN","DVBARSBD",254,0)
 ;create list sorted by LAST STATUS CHANGE DATE
"RTN","DVBARSBD",255,0)
 S DVBRO=0
"RTN","DVBARSBD",256,0)
 F  S DVBRO=$O(^DVB(396.3,"AF",RSTAT,DVBRO)) Q:'DVBRO  D
"RTN","DVBARSBD",257,0)
 . S DVBIEN=0
"RTN","DVBARSBD",258,0)
 . F  S DVBIEN=$O(^DVB(396.3,"AF",RSTAT,DVBRO,DVBIEN)) Q:'DVBIEN  D
"RTN","DVBARSBD",259,0)
 . . K FLD
"RTN","DVBARSBD",260,0)
 . . I $$SETFLDS(DVBIEN,.FLD) D
"RTN","DVBARSBD",261,0)
 . . . ;use request date as sort for blank date
"RTN","DVBARSBD",262,0)
 . . . S SRTDAT=+$G(FLD("IREQDT"))
"RTN","DVBARSBD",263,0)
 . . . I $G(DVBAD)'="," S ^TMP("DVBREQN",$J,SRTDAT,DVBIEN)=FLD("SS")_U_FLD("NM")_U_FLD("REQDT")_U_FLD("RELDT")_U_FLD("PRTDT")_U_FLD("RS")_U_FLD("CANDT")_U_FLD("RO")_U_FLD("EXAM")_U_FLD("CANRS")_U_FLD("CANCOM")
"RTN","DVBARSBD",264,0)
 . . . I $G(DVBAD)="," D
"RTN","DVBARSBD",265,0)
 . . . . S ^TMP("DVBREQN",$J,SRTDAT,DVBIEN)=FLD("SS")_DVBAD_""""_FLD("NM")_""""_DVBAD_FLD("REQDT")_DVBAD_FLD("RELDT")_DVBAD_FLD("PRTDT")_DVBAD
"RTN","DVBARSBD",266,0)
 . . . . S ^TMP("DVBREQN",$J,SRTDAT,DVBIEN)=^TMP("DVBREQN",$J,SRTDAT,DVBIEN)_""""_FLD("RS")_""""_DVBAD_FLD("CANDT")_DVBAD_""""_FLD("RO")_""""_DVBAD_FLD("EXAM")_""""_DVBAD_FLD("CANRS")_""""_DVBAD_FLD("CANCOM")_""""
"RTN","DVBARSBD",267,0)
 ;
"RTN","DVBARSBD",268,0)
 ;load output global with sorted list
"RTN","DVBARSBD",269,0)
 S CHGDAT="",CNT=0  ;use "" because value could be zero ("0")
"RTN","DVBARSBD",270,0)
 F  S CHGDAT=$O(^TMP("DVBREQN",$J,CHGDAT)) Q:(CHGDAT="")  D
"RTN","DVBARSBD",271,0)
 . S DVBIEN=0
"RTN","DVBARSBD",272,0)
 . F  S DVBIEN=$O(^TMP("DVBREQN",$J,CHGDAT,DVBIEN)) Q:'DVBIEN  D
"RTN","DVBARSBD",273,0)
 . . S CNT=CNT+1
"RTN","DVBARSBD",274,0)
 . . S ^TMP("DVBREQ",$J,CNT)=^TMP("DVBREQN",$J,CHGDAT,DVBIEN)
"RTN","DVBARSBD",275,0)
 Q
"SEC","^DD",396.17,396.17,1,8.5)
"@"
"SEC","^DD",396.17,396.17,1,9)
"@"
"SEC","^DD",396.3,396.3,21.1,8.5)
"@"
"SEC","^DD",396.3,396.3,21.1,9)
"@"
"VER")
8.0^22.0
"^DD",396.17,396.17,1,0)
ACCEPTABLE CLINICAL EVIDENCE^S^Y:YES;N:NO;^13;2^Q
"^DD",396.17,396.17,1,.1)
ACCEPTABLE CLINCAL EVIDENCE
"^DD",396.17,396.17,1,1,0)
^.1
"^DD",396.17,396.17,1,1,1,0)
396.17^D
"^DD",396.17,396.17,1,1,1,1)
S ^DVB(396.17,"D",$E(X,1,30),DA)=""
"^DD",396.17,396.17,1,1,1,2)
K ^DVB(396.17,"D",$E(X,1,30),DA)
"^DD",396.17,396.17,1,1,1,3)
This is connected to 2507 EXAMS where ACE was used
"^DD",396.17,396.17,1,1,1,"%D",0)
^^2^2^3150319^
"^DD",396.17,396.17,1,1,1,"%D",1,0)
This helps with the lookup of templates connected to exams where 
"^DD",396.17,396.17,1,1,1,"%D",2,0)
Acceptable Clinical Evidence was used.
"^DD",396.17,396.17,1,1,1,"DT")
3150319
"^DD",396.17,396.17,1,3)
ENTER Y if ACCEPTABLE CLINCAL EVIDENCE 'ACE' was used on the displayed 2507 EXAMs
"^DD",396.17,396.17,1,21,0)
^^4^4^3150323^
"^DD",396.17,396.17,1,21,1,0)
This field stores the boolean response from the Delphi Capri GUI 
"^DD",396.17,396.17,1,21,2,0)
'Template Screen' form. Select Y if Acceptable Clinical Evidence was
"^DD",396.17,396.17,1,21,3,0)
used for the list of exams, or N if Acceptable Clinical Evidence was not 
"^DD",396.17,396.17,1,21,4,0)
Used.
"^DD",396.17,396.17,1,"DT")
3150319
"^DD",396.3,396.3,21.1,0)
ELECTRONIC CLAIM FOLDER AVAIL^RS^Y:YES;N:NO;^5;3^Q
"^DD",396.3,396.3,21.1,.1)
ELECTRONIC CLAIM FOLDER AVAILABLE
"^DD",396.3,396.3,21.1,1,0)
^.1
"^DD",396.3,396.3,21.1,1,1,0)
396.3^H
"^DD",396.3,396.3,21.1,1,1,1)
S ^DVB(396.3,"H",$E(X,1,30),DA)=""
"^DD",396.3,396.3,21.1,1,1,2)
K ^DVB(396.3,"H",$E(X,1,30),DA)
"^DD",396.3,396.3,21.1,1,1,"%D",0)
^.101^2^2^3150324^^
"^DD",396.3,396.3,21.1,1,1,"%D",1,0)
This cross reference will help to look up exams that have an Electronic 
"^DD",396.3,396.3,21.1,1,1,"%D",2,0)
Claims Folder associated with it. the responses are Y for Yes and N for No
"^DD",396.3,396.3,21.1,1,1,"DT")
3150319
"^DD",396.3,396.3,21.1,3)
:      Enter Y if an ELECTRONIC CLAIM FOLDER is available And N if an ELECTRONIC CLAIM FOLDER is not available
"^DD",396.3,396.3,21.1,21,0)
^.001^2^2^3150408^^^^
"^DD",396.3,396.3,21.1,21,1,0)
An answer is required in the EXAM FOLDER AVAILABLE field
"^DD",396.3,396.3,21.1,21,2,0)
if the CLAIM FOLDER REQUIRED field is marked YES
"^DD",396.3,396.3,21.1,23,0)
^.001^3^3^3150408^^
"^DD",396.3,396.3,21.1,23,1,0)
This field stores the response from the Delphi CAPRI GUI 'Add New C&P
"^DD",396.3,396.3,21.1,23,2,0)
Exam' form, (Yes or No) if an Electronic Claim Folder is available for
"^DD",396.3,396.3,21.1,23,3,0)
this Exam.
"^DD",396.3,396.3,21.1,"DT")
3150319
"BLD",9164,6)
^168
**END**
**END**

