Released FB*3.5*164 SEQ #155
Extracted from mail message
**KIDS**:FB*3.5*164^

**INSTALL NAME**
FB*3.5*164
"BLD",9840,0)
FB*3.5*164^FEE BASIS^0^3180213^y
"BLD",9840,1,0)
^^1^1^3160628^^
"BLD",9840,1,1,0)
HAC EDI CLAIMS ATTACHMENTS
"BLD",9840,4,0)
^9.64PA^162^1
"BLD",9840,4,162,0)
162
"BLD",9840,4,162,2,0)
^9.641^162.0384^1
"BLD",9840,4,162,2,162.0384,0)
ATTACHMENT ID  (sub-file)
"BLD",9840,4,162,2,162.0384,1,0)
^9.6411^^
"BLD",9840,4,162,222)
y^y^p^^^^n^^n
"BLD",9840,4,162,224)

"BLD",9840,4,"APDD",162,162.0384)

"BLD",9840,4,"B",162,162)

"BLD",9840,6)
5^
"BLD",9840,6.3)
28
"BLD",9840,"ABPKG")
n
"BLD",9840,"INID")
^
"BLD",9840,"INIT")

"BLD",9840,"KRN",0)
^9.67PA^779.2^20
"BLD",9840,"KRN",.4,0)
.4
"BLD",9840,"KRN",.401,0)
.401
"BLD",9840,"KRN",.402,0)
.402
"BLD",9840,"KRN",.402,"NM",0)
^9.68A^^0
"BLD",9840,"KRN",.403,0)
.403
"BLD",9840,"KRN",.5,0)
.5
"BLD",9840,"KRN",.84,0)
.84
"BLD",9840,"KRN",3.6,0)
3.6
"BLD",9840,"KRN",3.8,0)
3.8
"BLD",9840,"KRN",9.2,0)
9.2
"BLD",9840,"KRN",9.8,0)
9.8
"BLD",9840,"KRN",9.8,"NM",0)
^9.68A^8^4
"BLD",9840,"KRN",9.8,"NM",5,0)
FBCHVH^^0^B48116454
"BLD",9840,"KRN",9.8,"NM",6,0)
FBAACCB^^0^B39441611
"BLD",9840,"KRN",9.8,"NM",7,0)
FBAACCB1^^0^B36081848
"BLD",9840,"KRN",9.8,"NM",8,0)
FBAAPIN^^0^B45830813
"BLD",9840,"KRN",9.8,"NM","B","FBAACCB",6)

"BLD",9840,"KRN",9.8,"NM","B","FBAACCB1",7)

"BLD",9840,"KRN",9.8,"NM","B","FBAAPIN",8)

"BLD",9840,"KRN",9.8,"NM","B","FBCHVH",5)

"BLD",9840,"KRN",19,0)
19
"BLD",9840,"KRN",19,"NM",0)
^9.68A^^0
"BLD",9840,"KRN",19.1,0)
19.1
"BLD",9840,"KRN",101,0)
101
"BLD",9840,"KRN",409.61,0)
409.61
"BLD",9840,"KRN",771,0)
771
"BLD",9840,"KRN",779.2,0)
779.2
"BLD",9840,"KRN",870,0)
870
"BLD",9840,"KRN",8989.51,0)
8989.51
"BLD",9840,"KRN",8989.52,0)
8989.52
"BLD",9840,"KRN",8994,0)
8994
"BLD",9840,"KRN",8994,"NM",0)
^9.68A^^0
"BLD",9840,"KRN","B",.4,.4)

"BLD",9840,"KRN","B",.401,.401)

"BLD",9840,"KRN","B",.402,.402)

"BLD",9840,"KRN","B",.403,.403)

"BLD",9840,"KRN","B",.5,.5)

"BLD",9840,"KRN","B",.84,.84)

"BLD",9840,"KRN","B",3.6,3.6)

"BLD",9840,"KRN","B",3.8,3.8)

"BLD",9840,"KRN","B",9.2,9.2)

"BLD",9840,"KRN","B",9.8,9.8)

"BLD",9840,"KRN","B",19,19)

"BLD",9840,"KRN","B",19.1,19.1)

"BLD",9840,"KRN","B",101,101)

"BLD",9840,"KRN","B",409.61,409.61)

"BLD",9840,"KRN","B",771,771)

"BLD",9840,"KRN","B",779.2,779.2)

"BLD",9840,"KRN","B",870,870)

"BLD",9840,"KRN","B",8989.51,8989.51)

"BLD",9840,"KRN","B",8989.52,8989.52)

"BLD",9840,"KRN","B",8994,8994)

"BLD",9840,"QUES",0)
^9.62^^
"BLD",9840,"REQB",0)
^9.611^3^3
"BLD",9840,"REQB",1,0)
FB*3.5*123^1
"BLD",9840,"REQB",2,0)
FB*3.5*154^1
"BLD",9840,"REQB",3,0)
FB*3.5*158^1
"BLD",9840,"REQB","B","FB*3.5*123",1)

"BLD",9840,"REQB","B","FB*3.5*154",2)

"BLD",9840,"REQB","B","FB*3.5*158",3)

"FIA",162)
FEE BASIS PAYMENT
"FIA",162,0)
^FBAAC(
"FIA",162,0,0)
162P
"FIA",162,0,1)
y^y^p^^^^n^^n
"FIA",162,0,10)

"FIA",162,0,11)

"FIA",162,0,"RLRO")

"FIA",162,0,"VR")
3.5^FB
"FIA",162,162)
1
"FIA",162,162.03)
1
"FIA",162,162.03,84)

"FIA",162,162.0384)
0
"MBREQ")
0
"PKG",114,-1)
1^1
"PKG",114,0)
FEE BASIS^FB^Used to pay private vendors
"PKG",114,20,0)
^9.402P^1^1
"PKG",114,20,1,0)
2^^FBPMRG
"PKG",114,20,1,1)

"PKG",114,20,"B",2,1)

"PKG",114,22,0)
^9.49I^1^1
"PKG",114,22,1,0)
3.5^2950130^2960822
"PKG",114,22,1,"PAH",1,0)
164^3180213^101048
"PKG",114,22,1,"PAH",1,1,0)
^^1^1^3180213
"PKG",114,22,1,"PAH",1,1,1,0)
HAC EDI CLAIMS ATTACHMENTS
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
4
"RTN","FBAACCB")
0^6^B39441611^B34771662
"RTN","FBAACCB",1,0)
FBAACCB ;AISC/GRR - CLERK CLOSE BATCH ;7/9/14  16:16
"RTN","FBAACCB",2,0)
 ;;3.5;FEE BASIS;**4,61,77,116,154,164**;JAN 30, 1995;Build 28
"RTN","FBAACCB",3,0)
 ;;Per VA Directive 6402, this routine should not be modified.
"RTN","FBAACCB",4,0)
 K QQ D DT^DICRW
"RTN","FBAACCB",5,0)
BT W !! S DIC="^FBAA(161.7,",DIC(0)="AEQ",DIC("S")=$S($D(^XUSEC("FBAA LEVEL 2",DUZ)):"I $G(^(""ST""))=""O""",1:"I $P(^(0),U,5)=DUZ&($G(^(""ST""))=""O"")") D ^DIC K DIC("S")
"RTN","FBAACCB",6,0)
 G Q^FBAACCB0:X="^"!(X=""),BT:Y<0 S B=+Y,FZ=^FBAA(161.7,B,0),FBTYPE=$P(FZ,"^",3)
"RTN","FBAACCB",7,0)
 I FBTYPE="B3",'$D(^FBAAC("AC",B)) W !!,*7,"No payments in Batch yet!",! G BT
"RTN","FBAACCB",8,0)
 I FBTYPE="B2",'$D(^FBAAC("AD",B)) W !!,*7,"No Payments in Batch yet!",! G BT
"RTN","FBAACCB",9,0)
 I FBTYPE="B5",'$D(^FBAA(162.1,"AE",B)) W !!,*7,"No Payments in Batch yet!",! G BT
"RTN","FBAACCB",10,0)
 I FBTYPE="B9",'$D(^FBAAI("AC",B)) W !!,*7,"No Payments in Batch yet!",! G BT
"RTN","FBAACCB",11,0)
RDD S DIR(0)="Y",DIR("A")="Want to review batch",DIR("B")="NO",DIR("?")="If you want a detail list of each payment line, answer ""Yes"" otherwise press Return key" D ^DIR K DIR
"RTN","FBAACCB",12,0)
 G BT:$D(DIRUT) W:Y @IOF D:Y LIST:FBTYPE="B3",LISTP:FBTYPE="B5",LISTT^FBAACCB0:FBTYPE="B2",LISTC^FBAACCB1:FBTYPE="B9"
"RTN","FBAACCB",13,0)
RDD1 S DIR(0)="Y",DIR("A")="Do you still want to close Batch",DIR("B")="YES" D ^DIR K DIR G BT:'Y!$D(DIRUT)
"RTN","FBAACCB",14,0)
 N FBARY,FBOLD,FBINVT
"RTN","FBAACCB",15,0)
 ;
"RTN","FBAACCB",16,0)
 S C=0,T=0 G PHARM^FBAACCB1:FBTYPE="B5",TRAV^FBAACCB1:FBTYPE="B2",CHNH^FBAACCB1:FBTYPE="B9"
"RTN","FBAACCB",17,0)
 F J=0:0 S J=$O(^FBAAC("AC",B,J)) Q:J'>0  F K=0:0 S K=$O(^FBAAC("AC",B,J,K)) Q:K'>0  F L=0:0 S L=$O(^FBAAC("AC",B,J,K,L)) Q:L'>0  F M=0:0 S M=$O(^FBAAC("AC",B,J,K,L,M)) Q:M'>0  D GOT
"RTN","FBAACCB",18,0)
FIN ; FB*3.5*116 - check and handle $0 invoices
"RTN","FBAACCB",19,0)
 D CHECK(.FBARY)
"RTN","FBAACCB",20,0)
 I $D(FBARY) D  G BT
"RTN","FBAACCB",21,0)
 . ;D EN^DDIOL(.FBARY)
"RTN","FBAACCB",22,0)
 . W *7,!!?2,"Batch cannot be closed. Listed invoices are zero dollar "
"RTN","FBAACCB",23,0)
 . W *7,!?2,"and must be corrected or removed from the batch."
"RTN","FBAACCB",24,0)
 ; end of changes
"RTN","FBAACCB",25,0)
 ;
"RTN","FBAACCB",26,0)
 S $P(FZ,"^",9)=T,$P(FZ,"^",11)=C
"RTN","FBAACCB",27,0)
 S $P(FZ,"^",13)=DT,^FBAA(161.7,B,0)=FZ,^FBAA(161.7,B,"ST")="C",^FBAA(161.7,"AC","C",B)="",DA=B,DR="0;ST" K ^FBAA(161.7,"AC","O",B),^FBAA(161.7,"AB","O",$P(^FBAA(161.7,B,0),"^",5),B) W !! D EN^DIQ W !!,"Batch Closed" G BT
"RTN","FBAACCB",28,0)
 ;
"RTN","FBAACCB",29,0)
GOT S Y(0)=$G(^FBAAC(J,1,K,1,L,1,M,0)),FBIN=$P(Y(0),"^",16)
"RTN","FBAACCB",30,0)
 ; HIPAA 5010 - count line items that have 0.00 amount paid
"RTN","FBAACCB",31,0)
 S T=T+$P(Y(0),"^",3),C=C+1
"RTN","FBAACCB",32,0)
 ; FB*3.5*116 -collect amount paid for each invoice in batch
"RTN","FBAACCB",33,0)
 S FBARY(FBIN)=$G(FBARY(FBIN))+$P(Y(0),"^",3)
"RTN","FBAACCB",34,0)
 Q
"RTN","FBAACCB",35,0)
 ;
"RTN","FBAACCB",36,0)
CHECK(FBINV) ; order thru array and save zero dollar invoices; report any zero dollar invoices
"RTN","FBAACCB",37,0)
 ; FBINV = array of invoices
"RTN","FBAACCB",38,0)
 N FBAAIN
"RTN","FBAACCB",39,0)
 S FBAAIN=0 F  S FBAAIN=$O(FBINV(FBAAIN)) Q:'FBAAIN  D
"RTN","FBAACCB",40,0)
 . I FBINV(FBAAIN)'>0 W !!,"Invoice #: "_FBAAIN_" totals $0.00"
"RTN","FBAACCB",41,0)
 . E  K FBINV(FBAAIN) ; remove array elements that represent non-zero dollar invoices
"RTN","FBAACCB",42,0)
 Q
"RTN","FBAACCB",43,0)
 ;
"RTN","FBAACCB",44,0)
LIST S Q="",$P(Q,"=",80)="="
"RTN","FBAACCB",45,0)
 S IOP=$S($D(ION):ION,1:"HOME") D ^%ZIS K IOP
"RTN","FBAACCB",46,0)
ENM D HED S (FBIN,FBINOLD)="",(FBAAOUT,FBINTOT)=0 F XY=0:0 S FBIN=$O(^FBAAC("AJ",B,FBIN)) Q:FBIN=""!($G(FBAAOUT))  D INTOT^FBAACCB0 F J=0:0 S J=$O(^FBAAC("AJ",B,FBIN,J)) Q:J'>0!($G(FBAAOUT))  D GMORE^FBAACCB0
"RTN","FBAACCB",47,0)
 I '$G(FBAAOUT) S FBIN=0 D INTOT^FBAACCB0
"RTN","FBAACCB",48,0)
 Q
"RTN","FBAACCB",49,0)
SET ;
"RTN","FBAACCB",50,0)
 N FBADJLA,FBADJLR,FBFPPSC,FBFPPSL,FBX,FBY3,TAMT
"RTN","FBAACCB",51,0)
 S N=$S($D(^DPT(J,0)):$P(^DPT(J,0),"^",1),1:""),S=$S(N]"":$P(^DPT(J,0),"^",9),1:""),V=$S($D(^FBAAV(K,0)):$P(^FBAAV(K,0),"^",1),1:""),VID=$S(V]"":$P(^(0),"^",2),1:"")
"RTN","FBAACCB",52,0)
 S D=+$G(^FBAAC(J,1,K,1,L,0)) Q:'D
"RTN","FBAACCB",53,0)
 S Y=$G(^FBAAC(J,1,K,1,L,1,M,0)) Q:Y']""
"RTN","FBAACCB",54,0)
 S FBY3=$G(^FBAAC(J,1,K,1,L,1,M,3))
"RTN","FBAACCB",55,0)
 S FBFPPSC=$P(FBY3,U)
"RTN","FBAACCB",56,0)
 S FBFPPSL=$P(FBY3,U,2)
"RTN","FBAACCB",57,0)
 S FBX=$$ADJLRA^FBAAFA(M_","_L_","_K_","_J_",")
"RTN","FBAACCB",58,0)
 S FBADJLR=$P(FBX,U)
"RTN","FBAACCB",59,0)
 S FBADJLA=$P(FBX,U,2)
"RTN","FBAACCB",60,0)
 S T=$P(Y,"^",5),FBIN=$P(Y,"^",16),ZS=$P(Y,"^",20)
"RTN","FBAACCB",61,0)
 S TAMT=$FN($P(Y,"^",4),"",2)
"RTN","FBAACCB",62,0)
 S FBVP=$S($P(Y,"^",21)="VP":"#",1:"")
"RTN","FBAACCB",63,0)
 S FBAACPT=$$CPT^FBAAUTL4($P(Y,U))
"RTN","FBAACCB",64,0)
 S CPTDESC=$$CPT^FBAAUTL4($P(Y,U),1,D)
"RTN","FBAACCB",65,0)
 S FBVCHDT=$P(Y,"^",6),FBIN(1)=$P(Y,"^",15) D FBCKO^FBAACCB2(J,K,L,M)
"RTN","FBAACCB",66,0)
 S FBMODLE=$$MODL^FBAAUTL4("^FBAAC("_J_",1,"_K_",1,"_L_",1,"_M_",""M"")","E")
"RTN","FBAACCB",67,0)
GO S A1=$P(Y,"^",2)+.0001,A2=$P(Y,"^",3)+.0001,A1=$P(A1,".",1)_"."_$E($P(A1,".",2),1,2),A2=$P(A2,".",1)_"."_$E($P(A2,".",2),1,2),FBINTOT=FBINTOT+A2
"RTN","FBAACCB",68,0)
 D WRT:FBTYPE'="B2",WRTT^FBAACCB0:FBTYPE="B2"
"RTN","FBAACCB",69,0)
 Q
"RTN","FBAACCB",70,0)
WRT I $Y+8>IOSL D ASKH^FBAACCB0:$E(IOST,1,2)["C-" Q:FBAAOUT  W @IOF D HED
"RTN","FBAACCB",71,0)
 S B(1617)=$S(B="":"",$D(^FBAA(161.7,B,0)):$P(^(0),"^"),1:"")
"RTN","FBAACCB",72,0)
 W !!,N,?35,$$SSN^FBAAUTL(J),?58,B(1617),?67,$$DATX^FBAAUTL($G(FBVCHDT)),!,?3,V,?42,VID,?55,FBIN,?67,$$DATX^FBAAUTL(FBIN(1))
"RTN","FBAACCB",73,0)
 W !,$S($D(QQ):QQ_")",1:""),$S(ZS="R":"*",1:""),$S(FBTYPE="B3":FBVP,1:""),$S(FBTYPE="B5":FBPV,1:""),$S($G(FBCAN)]"":"+",1:"")
"RTN","FBAACCB",74,0)
 I FBTYPE="B3" W ?4,$$DATX^FBAAUTL(D),?14,FBAACPT_$S($G(FBMODLE)]"":"-"_$P(FBMODLE,","),1:""),?24,CPTDESC,?54,FBFPPSC,?66,FBFPPSL
"RTN","FBAACCB",75,0)
 I FBTYPE="B5" W ?4,$$DATX^FBAAUTL(D),?14,FBAACPT_$S($G(FBMODLE)]"":"-"_$P(FBMODLE,","),1:""),?24,CPTDESC,?56,FBFPPSC,?68,FBFPPSL
"RTN","FBAACCB",76,0)
 I $P($G(FBMODLE),",",2)]"" D  Q:FBAAOUT
"RTN","FBAACCB",77,0)
 . N FBI,FBMOD
"RTN","FBAACCB",78,0)
 . F FBI=2:1 S FBMOD=$P(FBMODLE,",",FBI) Q:FBMOD=""  D  Q:FBAAOUT
"RTN","FBAACCB",79,0)
 . . I $Y+5>IOSL D  Q:FBAAOUT
"RTN","FBAACCB",80,0)
 . . . I $E(IOST,1,2)="C-" D ASKH^FBAACCB0 Q:FBAAOUT
"RTN","FBAACCB",81,0)
 . . . W @IOF D HED W !,"(continued)"
"RTN","FBAACCB",82,0)
 . . W !,?19,"-",FBMOD
"RTN","FBAACCB",83,0)
 W !?4,$J(A1,6),?17,$J(A2,6)
"RTN","FBAACCB",84,0)
 ; write adjustment reasons, if null then write suspend code
"RTN","FBAACCB",85,0)
 W ?30,$S(FBADJLR]"":FBADJLR,1:T)
"RTN","FBAACCB",86,0)
 ; write adjustment amounts, if null then write amount suspended
"RTN","FBAACCB",87,0)
 W ?41,$S(FBADJLA]"":FBADJLA,1:TAMT)
"RTN","FBAACCB",88,0)
 ; write attachment IDs FB*3.5*164
"RTN","FBAACCB",89,0)
 I FBTYPE="B3",$D(^FBAAC(J,1,K,1,L,1,M,10)) D
"RTN","FBAACCB",90,0)
 . N AI,AID,AITI S AI=0 S WRTPC="Attachment ID:"
"RTN","FBAACCB",91,0)
 . F  S AI=$O(^FBAAC(J,1,K,1,L,1,M,10,AI)) Q:'AI  D
"RTN","FBAACCB",92,0)
 . . S AID=$P($G(^FBAAC(J,1,K,1,L,1,M,10,AI,0)),U) I AI>1 S WRTPC=WRTPC_","
"RTN","FBAACCB",93,0)
 . . S WRTPC=WRTPC_" "_AID
"RTN","FBAACCB",94,0)
 . . S AITI=$P($G(^FBAAC(J,1,K,1,L,1,M,10,AI,0)),U,2) I AITI D
"RTN","FBAACCB",95,0)
 . . . S WRTPC=WRTPC_" ("_$P($G(^IBE(353.3,AITI,0)),U)
"RTN","FBAACCB",96,0)
 . . . S WRTPC=WRTPC_" - "
"RTN","FBAACCB",97,0)
 . . . S WRTPC=WRTPC_$P($G(^IBE(353.3,AITI,0)),U,2)_")"
"RTN","FBAACCB",98,0)
 . . I $L(WRTPC)>IOM D WRTSTR^FBAACCB1(.WRTPC,IOM)
"RTN","FBAACCB",99,0)
 . I $L(WRTPC)>0 D WRTSTR^FBAACCB1(.WRTPC,IOM)
"RTN","FBAACCB",100,0)
 ;
"RTN","FBAACCB",101,0)
 D PMNT^FBAACCB2 S FBINOLD=FBIN
"RTN","FBAACCB",102,0)
 Q
"RTN","FBAACCB",103,0)
HED W "Patient Name",?20,"('*' Reimbursement to Patient   '+' Cancellation Activity)",!,?13,"('#' Voided Payment)",?58,"Batch #",?67,"Voucher Date"
"RTN","FBAACCB",104,0)
 W !,?3,"Vendor Name",?42,"Vendor ID",?53,"Invoice #",?67,"Date Rec'd."
"RTN","FBAACCB",105,0)
 I FBTYPE="B3" D
"RTN","FBAACCB",106,0)
 . W !,?4,"SVC DATE",?14,"CPT-MOD",?24,"SERVICE PROVIDED",?54,"FPPS CLAIM",?66,"FPPS LINE"
"RTN","FBAACCB",107,0)
 . W !,?4,"CLAIMED",?17,"PAID",?30,"ADJ CODE",?41,"ADJ AMOUNT"
"RTN","FBAACCB",108,0)
 I FBTYPE="B5" D
"RTN","FBAACCB",109,0)
 . W !,?4,"RX  DATE",?14,"RX #",?24,"DRUG NAME",?56,"FPPS CLAIM",?68,"FPPS LINE"
"RTN","FBAACCB",110,0)
 . W !,?4,"CLAIMED",?17,"PAID",?30,"ADJ CODE",?41,"ADJ AMOUNT"
"RTN","FBAACCB",111,0)
 W !,Q,!
"RTN","FBAACCB",112,0)
 Q
"RTN","FBAACCB",113,0)
LISTP S Q="",$P(Q,"=",80)="="
"RTN","FBAACCB",114,0)
 S IOP=$S($D(ION):ION,1:"HOME") D ^%ZIS K IOP
"RTN","FBAACCB",115,0)
ENP D HED S (FBAAOUT,FBINTOT)=0,FBINOLD=""
"RTN","FBAACCB",116,0)
 F A=0:0 S A=$O(^FBAA(162.1,"AE",B,A)) Q:A'>0!($G(FBAAOUT))  S FBIN=A D SETV^FBAACCB0 F B2=0:0 S B2=$O(^FBAA(162.1,"AE",B,A,B2)) Q:B2'>0!($G(FBAAOUT))  D INTOT^FBAACCB0 I $D(^FBAA(162.1,A,"RX",B2,0)) S Z(0)=^(0) D MORE^FBAACCB1
"RTN","FBAACCB",117,0)
 I '$G(FBAAOUT) S FBIN=0 D INTOT^FBAACCB0
"RTN","FBAACCB",118,0)
 Q
"RTN","FBAACCB1")
0^7^B36081848^B28490763
"RTN","FBAACCB1",1,0)
FBAACCB1 ;AISC/GRR-CLERK CLOSE BATCH CONTINUED ; 11/24/10 10:27am
"RTN","FBAACCB1",2,0)
 ;;3.5;FEE BASIS;**55,61,116,108,164**;JAN 30, 1995;Build 28
"RTN","FBAACCB1",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","FBAACCB1",4,0)
PHARM ;ENTRY FOR PHARMACY BATCH CALCULATE TOTAL DOLLARS AND LINE COUNT
"RTN","FBAACCB1",5,0)
 ; HIPAA 5010 - count line items that have 0.00 amount paid
"RTN","FBAACCB1",6,0)
 F A=0:0 S A=$O(^FBAA(162.1,"AE",B,A)) Q:A'>0  F B2=0:0 S B2=$O(^FBAA(162.1,"AE",B,A,B2)) Q:B2'>0  I $D(^FBAA(162.1,A,"RX",B2,0)) S Z(0)=^(0) D MOREP
"RTN","FBAACCB1",7,0)
 G FIN^FBAACCB
"RTN","FBAACCB1",8,0)
MOREP S T=T+$P(Z(0),"^",16),C=C+1 Q
"RTN","FBAACCB1",9,0)
 ;
"RTN","FBAACCB1",10,0)
TRAV ;ENTRY FOR TRAVEL BATCH CALCULATE TOTAL DOLLARS AND LINE COUNT
"RTN","FBAACCB1",11,0)
 ; HIPAA 5010 - count line items that have 0.00 amount paid
"RTN","FBAACCB1",12,0)
 F J=0:0 S J=$O(^FBAAC("AD",B,J)) Q:J'>0  F K=0:0 S K=$O(^FBAAC("AD",B,J,K)) Q:K'>0  I $D(^FBAAC(J,3,K,0)) S Z(0)=^(0) D MORET
"RTN","FBAACCB1",13,0)
 G FIN^FBAACCB
"RTN","FBAACCB1",14,0)
 ;
"RTN","FBAACCB1",15,0)
MORET S T=T+$P(Z(0),"^",3),C=C+1 Q
"RTN","FBAACCB1",16,0)
LISTC S Q="",$P(Q,"=",80)="=",(FBAAOUT,FBLISTC)=0,IOP=$S($D(ION):ION,1:"HOME") D ^%ZIS K IOP
"RTN","FBAACCB1",17,0)
PRTC D HEDC
"RTN","FBAACCB1",18,0)
 F I=0:0 S I=$O(^FBAAI("AC",B,I)) Q:I'>0!(FBAAOUT)  I $D(^FBAAI(I,0)) S Z(0)=^(0) D CMORE
"RTN","FBAACCB1",19,0)
 Q
"RTN","FBAACCB1",20,0)
CMORE N FBADJLR,FBFPPSC,FBFPPSL,FBX,FBY3,FBDX,FBPOA,FBADMTDX
"RTN","FBAACCB1",21,0)
 S K=$P(Z(0),"^",3),J=$P(Z(0),"^",4) D ENV^FBAACCB0 S N=$$NAME^FBCHREQ2(J),S=$$SSN^FBAAUTL(J),FBIN=I,FBAC=$P(Z(0),"^",8)+.0001,FBAP=$P(Z(0),"^",9)+.0001,FBVP=$P(Z(0),"^",14),ZS=$P(Z(0),"^",13)
"RTN","FBAACCB1",22,0)
 S FBAC=$P(FBAC,".",1)_"."_$E($P(FBAC,".",2),1,2),FBAP=$P(FBAP,".",1)_"."_$E($P(FBAP,".",2),1,2)
"RTN","FBAACCB1",23,0)
 S FBSC=$P(Z(0),"^",11),FBSC=$S(FBSC="":"",$D(^FBAA(161.27,FBSC,0)):$P(^(0),"^",1),1:""),FBFD=$P(Z(0),"^",6),FBTD=$P(Z(0),"^",7) S FBPDT=FBFD D CDAT S FBFD=FBPDT,FBPDT=FBTD D CDAT S FBTD=FBPDT
"RTN","FBAACCB1",24,0)
 S FBY3=$G(^FBAAI(I,3))
"RTN","FBAACCB1",25,0)
 S FBFPPSC=$P(FBY3,U)
"RTN","FBAACCB1",26,0)
 S FBFPPSL=$P(FBY3,U,2)
"RTN","FBAACCB1",27,0)
 S FBX=$$ADJLRA^FBCHFA(I_",")
"RTN","FBAACCB1",28,0)
 S FBADJLR=$P(FBX,U)
"RTN","FBAACCB1",29,0)
 D FBCKI(I)
"RTN","FBAACCB1",30,0)
 S B(1617)=$S(B="":"",$D(^FBAA(161.7,B,0)):$P(^(0),"^"),1:"")
"RTN","FBAACCB1",31,0)
 S FBIN(1)=$P(Z(0),"^",2)
"RTN","FBAACCB1",32,0)
 D WRITC
"RTN","FBAACCB1",33,0)
 Q
"RTN","FBAACCB1",34,0)
WRITC I $Y+7>IOSL D ASKH^FBAACCB0:$E(IOST,1,2)["C-" Q:FBAAOUT  W @IOF D HEDC
"RTN","FBAACCB1",35,0)
 W !!,$S('$D(ZS):"",ZS="R":"*",1:"")
"RTN","FBAACCB1",36,0)
 W N,?35,S,?60,B(1617)
"RTN","FBAACCB1",37,0)
 W !,?3,V,?45,VID,?58,FBIN,?70,$$DATX^FBAAUTL($E(FBIN(1),1,7))
"RTN","FBAACCB1",38,0)
 I FBFPPSC]"" W !,?4,"FPPS Claim ID: ",FBFPPSC,"   FPPS Line: ",FBFPPSL
"RTN","FBAACCB1",39,0)
 W !,$S($D(QQ):QQ_")",1:""),FBVP,$S(FBCAN]"":"+",1:""),?4,FBFD,?13,FBTD,?22,$J(FBAC,6),?32,$J(FBAP,6),?45,$S(FBADJLR]"":FBADJLR,1:FBSC)
"RTN","FBAACCB1",40,0)
 W:$P(Z(0),"^",24) ?56,"Discharge ",$$ICD^FBCSV1(+$P(Z(0),"^",24),$P(Z(0),"^",6)) W ! ;CSV
"RTN","FBAACCB1",41,0)
 ; write admitting diagnosis
"RTN","FBAACCB1",42,0)
 N P7,P8
"RTN","FBAACCB1",43,0)
 S P7=$G(^FBAAI(I,5))
"RTN","FBAACCB1",44,0)
 S FBADMTDX=$P(P7,"^",9)
"RTN","FBAACCB1",45,0)
 S P8=$$ICD9^FBCSV1(FBADMTDX,$P($G(Z(0)),"^",6))
"RTN","FBAACCB1",46,0)
 I P8'="" W !,?4,"Admit Dx: ",P8
"RTN","FBAACCB1",47,0)
 ; set diagnosis code and present on admission code
"RTN","FBAACCB1",48,0)
 N P1,P2
"RTN","FBAACCB1",49,0)
 S P1=$G(^FBAAI(I,"DX"))
"RTN","FBAACCB1",50,0)
 S P2=$G(^FBAAI(I,"POA"))
"RTN","FBAACCB1",51,0)
 F FBK=1:1:25 D WRTDX
"RTN","FBAACCB1",52,0)
 ; set procedure code
"RTN","FBAACCB1",53,0)
 N P5
"RTN","FBAACCB1",54,0)
 S P5=$G(^FBAAI(I,"PROC"))
"RTN","FBAACCB1",55,0)
 F FBL=1:1:25 D WRTPC
"RTN","FBAACCB1",56,0)
 ; write attachment IDs
"RTN","FBAACCB1",57,0)
 I $D(^FBAAI(I,10)) D
"RTN","FBAACCB1",58,0)
 . N AI,AID,AITI,WRTPC
"RTN","FBAACCB1",59,0)
 . S AI=0 S WRTPC="Attachment ID:"
"RTN","FBAACCB1",60,0)
 . F  S AI=$O(^FBAAI(I,10,AI)) Q:'AI  D
"RTN","FBAACCB1",61,0)
 . . S AID=$P($G(^FBAAI(I,10,AI,0)),"^") I AI>1 S WRTPC=WRTPC_","
"RTN","FBAACCB1",62,0)
 . . S WRTPC=WRTPC_" "_AID
"RTN","FBAACCB1",63,0)
 . . S AITI=$P($G(^FBAAI(I,10,AI,0)),"^",2) I AITI D
"RTN","FBAACCB1",64,0)
 . . . S WRTPC=WRTPC_" ("_$P($G(^IBE(353.3,AITI,0)),"^")
"RTN","FBAACCB1",65,0)
 . . . S WRTPC=WRTPC_" - "
"RTN","FBAACCB1",66,0)
 . . . S WRTPC=WRTPC_$P($G(^IBE(353.3,AITI,0)),"^",2)_")"
"RTN","FBAACCB1",67,0)
 . . I $L(WRTPC)>IOM D WRTSTR(.WRTPC,IOM)
"RTN","FBAACCB1",68,0)
 . I $L(WRTPC)>0 D WRTSTR(.WRTPC,IOM)
"RTN","FBAACCB1",69,0)
 S A2=FBAP D PMNT^FBAACCB2 K A2
"RTN","FBAACCB1",70,0)
 Q
"RTN","FBAACCB1",71,0)
WRTSTR(STR,MX) ; Wordwrap string
"RTN","FBAACCB1",72,0)
 N RM,I
"RTN","FBAACCB1",73,0)
WRTSTR1 S RM=$S(STR?1"Attachment ID:".E:MX-4,1:MX-7)
"RTN","FBAACCB1",74,0)
 F I=1:1:$L(STR," ") Q:$L($P(STR," ",1,I))>RM
"RTN","FBAACCB1",75,0)
 W !,?4 W:STR'?1"Attachment ID:".E ?7
"RTN","FBAACCB1",76,0)
 I $L($P(STR," ",1,I))>RM W $P(STR," ",1,I-1) S STR=$P(STR," ",I,999)
"RTN","FBAACCB1",77,0)
 E  W $P(STR," ",1,I) S STR=""
"RTN","FBAACCB1",78,0)
 I $L(STR)>(MX-3) G WRTSTR1
"RTN","FBAACCB1",79,0)
 Q
"RTN","FBAACCB1",80,0)
CDAT S FBPDT=$E(FBPDT,4,5)_"/"_$S($E(FBPDT,6,7)="00":$E(FBPDT,2,3),1:$E(FBPDT,6,7)_"/"_$E(FBPDT,2,3))
"RTN","FBAACCB1",81,0)
 Q
"RTN","FBAACCB1",82,0)
HEDC W "Patient Name",?20,"('*' Reimbursement to Veteran   '+' Cancellation Activity)",!,?13,"('#' Voided Payment '&' Additional Payment)",?60,"Batch Number"
"RTN","FBAACCB1",83,0)
 W !,?3,"Vendor Name",?45,"Vendor ID",?57,"Invoice #",?68,"Dt Inv Rec'd",!,?3,"FR DATE",?14,"TO DATE  CLAIMED   PAID",?41,"ADJ CODE",!,Q,!
"RTN","FBAACCB1",84,0)
 Q
"RTN","FBAACCB1",85,0)
CHNH ; FB*3.5*116
"RTN","FBAACCB1",86,0)
 S (J,FZ("CNT"))=0 F  S J=$O(^FBAAI("AC",B,J)) Q:J'>0  I $D(^FBAAI(J,0)) S Z(0)=^(0) D MORECH D:$P(FZ,U,15)'="Y" INVCNT
"RTN","FBAACCB1",87,0)
 S:$G(FZ("CNT")) $P(FZ,U,10)=FZ("CNT") K FZ("CNT")  ; CNH batch
"RTN","FBAACCB1",88,0)
 G FIN^FBAACCB
"RTN","FBAACCB1",89,0)
 ;
"RTN","FBAACCB1",90,0)
MORECH ; HIPAA 5010 - count line items that have 0.00 amount paid
"RTN","FBAACCB1",91,0)
 S T=T+$P(Z(0),"^",9),C=C+1
"RTN","FBAACCB1",92,0)
 ; FB*3.5*116 - build array of invoices
"RTN","FBAACCB1",93,0)
 ;do not build array for CH batches not exempt from the pricer
"RTN","FBAACCB1",94,0)
 Q:($P(FZ,"^",18)'="Y")&($P(FZ,"^",15)="Y") 
"RTN","FBAACCB1",95,0)
 S FBARY($P(Z(0),"^"))=+$P(Z(0),"^",9)
"RTN","FBAACCB1",96,0)
 Q
"RTN","FBAACCB1",97,0)
 ;
"RTN","FBAACCB1",98,0)
WRTDX ; write diagnosis code and present on admission code
"RTN","FBAACCB1",99,0)
 N P3,P4
"RTN","FBAACCB1",100,0)
 S FBDX=$P(P1,"^",FBK)
"RTN","FBAACCB1",101,0)
 S FBPOA=$P(P2,"^",FBK)
"RTN","FBAACCB1",102,0)
 Q:FBDX=""
"RTN","FBAACCB1",103,0)
 S P3=$$ICD9^FBCSV1(FBDX,$P($G(Z(0)),"^",6))_"/"
"RTN","FBAACCB1",104,0)
 S P4=P3_$S(FBPOA:$P($G(^FB(161.94,FBPOA,0)),"^"),1:"")
"RTN","FBAACCB1",105,0)
 I FBK=1!($X+$L(P4)+2>IOM) W !,?4,"DX/POA: "
"RTN","FBAACCB1",106,0)
 W P4," "
"RTN","FBAACCB1",107,0)
 Q
"RTN","FBAACCB1",108,0)
 ;
"RTN","FBAACCB1",109,0)
WRTPC ; write procedure code (if present)
"RTN","FBAACCB1",110,0)
 N P6
"RTN","FBAACCB1",111,0)
 S FBPROC=$P(P5,"^",FBL)
"RTN","FBAACCB1",112,0)
 Q:FBPROC=""
"RTN","FBAACCB1",113,0)
 S P6=$$ICD0^FBCSV1(FBPROC,$P($G(Z(0)),"^",6))
"RTN","FBAACCB1",114,0)
 I FBL=1!($X+$L(P6)+2>IOM) W !,?4,"PROC: "
"RTN","FBAACCB1",115,0)
 W P6," "
"RTN","FBAACCB1",116,0)
 Q
"RTN","FBAACCB1",117,0)
MORE ;
"RTN","FBAACCB1",118,0)
 N FBADJLA,FBADJLR,FBFPPSC,FBFPPSL,FBX,TAMT
"RTN","FBAACCB1",119,0)
 S J=$P(Z(0),"^",5),D=$P(Z(0),"^",3),FBAACPT=$P(Z(0),"^",1),N=$S($D(^DPT(J,0)):$P(^(0),"^",1),1:""),S=$S(N]"":$P(^DPT(J,0),"^",9),1:""),FBIN=A,CPTDESC=$P(Z(0),"^",2)
"RTN","FBAACCB1",120,0)
 S Y="",$P(Y,"^",2)=$P(Z(0),"^",4),$P(Y,"^",3)=$P(Z(0),"^",16),$P(Y,"^",12)=0,T=$P(Z(0),"^",8),T=$S(T="":"",$D(^FBAA(161.27,T,0)):^(0),1:""),$P(Y,"^",9)=$P(Z(0),"^",1),ZS=$P(Z(0),"^",20),FBPV=""
"RTN","FBAACCB1",121,0)
 ;
"RTN","FBAACCB1",122,0)
 S FBFPPSC=$P($G(^FBAA(162.1,A,0)),U,13)
"RTN","FBAACCB1",123,0)
 S FBFPPSL=$P($G(^FBAA(162.1,A,"RX",B2,3)),U)
"RTN","FBAACCB1",124,0)
 S FBX=$$ADJLRA^FBRXFA(B2_","_A_",")
"RTN","FBAACCB1",125,0)
 S FBADJLR=$P(FBX,U)
"RTN","FBAACCB1",126,0)
 S FBADJLA=$P(FBX,U,2)
"RTN","FBAACCB1",127,0)
 S TAMT=$FN($P(Z(0),"^",7),"",2)
"RTN","FBAACCB1",128,0)
 ;
"RTN","FBAACCB1",129,0)
 D FBCKP(A,B2)
"RTN","FBAACCB1",130,0)
 S FBIN(1)=$P($G(^FBAA(162.1,+A,0)),"^",2)
"RTN","FBAACCB1",131,0)
 G GO^FBAACCB
"RTN","FBAACCB1",132,0)
INVCNT ;set invoice count for cnh batch
"RTN","FBAACCB1",133,0)
 S FZ("CNT")=FZ("CNT")+1
"RTN","FBAACCB1",134,0)
 Q
"RTN","FBAACCB1",135,0)
FBCKI(FBI) ;set inpatient check variables
"RTN","FBAACCB1",136,0)
 ;fbi=DA
"RTN","FBAACCB1",137,0)
 I '$G(FBI) S (FBCKDT,FBCK,FBCANDT,FBCANR,FBCAN,FBDIS,FBCKINT)="" Q
"RTN","FBAACCB1",138,0)
 S FBCKIN=$G(^FBAAI(FBI,2))
"RTN","FBAACCB1",139,0)
 S U="^",FBCKDT=+FBCKIN,FBCK=$P(FBCKIN,U,4),FBCANDT=$P(FBCKIN,U,5),FBCANR=$P(FBCKIN,U,6),FBCAN=$P(FBCKIN,U,7),FBDIS=$P(FBCKIN,U,8),FBCKINT=$P(FBCKIN,U,9) K FBCKIN
"RTN","FBAACCB1",140,0)
 Q
"RTN","FBAACCB1",141,0)
FBCKP(J,K) ;set pharmacy check variables
"RTN","FBAACCB1",142,0)
 ;j,k required input variables to = da(1) and da respectively (162.1)
"RTN","FBAACCB1",143,0)
 I '$G(J)!('$G(K)) Q
"RTN","FBAACCB1",144,0)
 S FBCKIN=$G(^FBAA(162.1,J,"RX",K,2))
"RTN","FBAACCB1",145,0)
 S U="^",FBCKDT=$P(FBCKIN,U,8),FBCK=$P(FBCKIN,U,10),FBCANDT=$P(FBCKIN,U,11),FBCANR=$P(FBCKIN,U,12),FBCAN=$P(FBCKIN,U,13),FBDIS=$P(FBCKIN,U,14),FBCKINT=$P(FBCKIN,U,15) K FBCKIN
"RTN","FBAACCB1",146,0)
 Q
"RTN","FBAAPIN")
0^8^B45830813^B39786989
"RTN","FBAAPIN",1,0)
FBAAPIN ;AISC/GRR - INVOICE DISPLAY ;7/17/2003
"RTN","FBAAPIN",2,0)
 ;;3.5;FEE BASIS;**4,61,122,133,108,135,123,164**;JAN 30, 1995;Build 28
"RTN","FBAAPIN",3,0)
 ;;Per VA Directive 6402, this routine should not be modified.
"RTN","FBAAPIN",4,0)
 D DT^DICRW
"RTN","FBAAPIN",5,0)
RD1 W ! S (FBHDONE,FBAAOUT,FBINTOT)=0,FBSW=0 K FBHED S DIR(0)="NO",DIR("A")="Select Invoice Number",DIR("?")="^D HELP^FBAAPIN1" D ^DIR K DIR G Q:$D(DIRUT)!'Y
"RTN","FBAAPIN",6,0)
 I '$D(^FBAAC("C",X)) W !,*7,"Invalid selection.",! G RD1
"RTN","FBAAPIN",7,0)
 S HX=X,FBAAIN=X D LIST S X=HX G RD1
"RTN","FBAAPIN",8,0)
LIST S Q="",$P(Q,"=",80)="="
"RTN","FBAAPIN",9,0)
 S IOP=$S($D(ION):ION,1:"HOME") D ^%ZIS K IOP
"RTN","FBAAPIN",10,0)
 F J=0:0 S J=$O(^FBAAC("C",FBAAIN,J)) Q:J'>0!(FBAAOUT)  D MMORE
"RTN","FBAAPIN",11,0)
 Q
"RTN","FBAAPIN",12,0)
SET S FBFILE="^FBAAC("_J_",1,"_K_",1,"_L_",1,"_M_",1,",D=$P($G(^FBAAC(J,1,K,1,L,0)),"^",1),FBYY=$G(^FBAAC(J,1,K,1,L,1,M,0)),FBYY("REJ")=$S($D(^FBAAC(J,1,K,1,L,1,M,"FBREJ")):^("FBREJ"),1:""),FBY=$G(^FBAAC(J,1,K,1,L,1,M,2))
"RTN","FBAAPIN",13,0)
 S FBY3=$G(^FBAAC(J,1,K,1,L,1,M,3))
"RTN","FBAAPIN",14,0)
 S FBAARCE=$$GET1^DIQ(162.03,M_","_L_","_K_","_J_",",48)
"RTN","FBAAPIN",15,0)
 D SET2
"RTN","FBAAPIN",16,0)
 Q
"RTN","FBAAPIN",17,0)
SET2 ;
"RTN","FBAAPIN",18,0)
 N FBX,FBIA,FBDODINV
"RTN","FBAAPIN",19,0)
 S N=$S($D(^DPT(J,0)):$P(^(0),"^",1),1:""),S=$S(N]"":$P(^DPT(J,0),"^",9),1:""),V=$S($D(^FBAAV(K,0)):$P(^FBAAV(K,0),"^",1),1:"")
"RTN","FBAAPIN",20,0)
 S T=$P(FBYY,"^",5),D2=$P(FBYY,"^",6),ZS=$P(FBYY,"^",20),VP=$P(FBYY,"^",21)
"RTN","FBAAPIN",21,0)
 S T=$P($G(^FBAA(161.27,+T,0)),U)
"RTN","FBAAPIN",22,0)
 S TAMT=$FN($P(FBYY,U,4),"",2)
"RTN","FBAAPIN",23,0)
 S FBAACPT=$P(FBYY,"^",1) I FBAACPT]"" S FBAACPT=$$CPT^FBAAUTL4(FBAACPT)
"RTN","FBAAPIN",24,0)
 S FBMODLE=$$MODL^FBAAUTL4("^FBAAC("_J_",1,"_K_",1,"_L_",1,"_M_",""M"")","E")
"RTN","FBAAPIN",25,0)
 S FBUNITS=$P(FBY,U,14)
"RTN","FBAAPIN",26,0)
 S FBFPPSL=$P(FBY3,U,2)
"RTN","FBAAPIN",27,0)
 S FBX=$$ADJLRA^FBAAFA(M_","_L_","_K_","_J_",")
"RTN","FBAAPIN",28,0)
 S FBADJLR=$P(FBX,U)
"RTN","FBAAPIN",29,0)
 S FBADJLA=$P(FBX,U,2)
"RTN","FBAAPIN",30,0)
 S FBRRMKL=$$RRL^FBAAFR(M_","_L_","_K_","_J_",")
"RTN","FBAAPIN",31,0)
 S FBCNTRN=$S($P(FBY3,U,8):$P($G(^FBAA(161.43,$P(FBY3,U,8),0)),U),1:"")
"RTN","FBAAPIN",32,0)
 S FBIA=+$P($G(^FBAAC(J,1,K,1,L,1,M,3)),U,6)              ; IPAC agreement pointer (*123)
"RTN","FBAAPIN",33,0)
 S FBIA=$S(FBIA:$P($G(^FBAA(161.95,FBIA,0)),U,1),1:"")    ; IPAC vendor agreement ID (*123)
"RTN","FBAAPIN",34,0)
 S FBDODINV=$P($G(^FBAAC(J,1,K,1,L,1,M,3)),U,7)           ; DoD invoice number (*123)
"RTN","FBAAPIN",35,0)
 S A1=$P(FBYY,"^",2)+.0001,A2=$P(FBYY,"^",3)+.0001,A3=$P(FBYY,"^",12)+.0001,A1=$P(A1,".",1)_"."_$E($P(A1,".",2),1,2),A2=$P(A2,".",1)_"."_$E($P(A2,".",2),1,2),A3=$P(A3,".",1)_"."_$E($P(A3,".",2),1,2),FBINTOT=FBINTOT+A2+.0001
"RTN","FBAAPIN",36,0)
 S FBINTOT=$P(FBINTOT,".")_"."_$E($P(FBINTOT,".",2),1,2)
"RTN","FBAAPIN",37,0)
 S FBBN=$S($P(FBYY,"^",8)]"":$S($D(^FBAA(161.7,$P(FBYY,"^",8),0)):$P(^(0),"^",1),1:""),$P(FBYY("REJ"),"^",3)]"":$S($D(^FBAA(161.7,$P(FBYY("REJ"),"^",3),0)):$P(^(0),"^",1),1:""),1:"")
"RTN","FBAAPIN",38,0)
 D FBCKO^FBAACCB2(J,K,L,M)
"RTN","FBAAPIN",39,0)
 I $D(^FBAAC(J,1,K,1,L,1,M,4))!($D(^FBAAC(J,1,K,1,L,1,M,5))) D PROV
"RTN","FBAAPIN",40,0)
 I '$D(FBHED) D HED
"RTN","FBAAPIN",41,0)
 D WRT S FBHED=1
"RTN","FBAAPIN",42,0)
 Q
"RTN","FBAAPIN",43,0)
WRT I ($Y+5)>IOSL S DIR(0)="E" D ^DIR K DIR S:'Y FBAAOUT=1 Q:FBAAOUT  D HED
"RTN","FBAAPIN",44,0)
 W !!,N,?33,$$DATX^FBAAUTL(D),?43,FBAACPT_$S($G(FBMODLE)]"":"-"_$P(FBMODLE,","),1:"")
"RTN","FBAAPIN",45,0)
 I FBAARCE]"" W ?51,"/",FBAARCE
"RTN","FBAAPIN",46,0)
 W ?57,FBBN,?67,$S(FBYY("REJ")]"":"Rejected",1:$$DATX^FBAAUTL(D2))
"RTN","FBAAPIN",47,0)
 I $P($G(FBMODLE),",",2)]"" D  Q:FBAAOUT
"RTN","FBAAPIN",48,0)
 . N FBI
"RTN","FBAAPIN",49,0)
 . F FBI=2:1 S FBMOD=$P(FBMODLE,",",FBI) Q:FBMOD=""  D  Q:FBAAOUT
"RTN","FBAAPIN",50,0)
 . . I $Y+5>IOSL D  Q:FBAAOUT  W !,"(continued)"
"RTN","FBAAPIN",51,0)
 . . . S DIR(0)="E" D ^DIR K DIR S:'Y FBAAOUT=1 Q:FBAAOUT  D HED
"RTN","FBAAPIN",52,0)
 . . W !,?48,"-",FBMOD
"RTN","FBAAPIN",53,0)
 W !,$S(ZS="R":"*",1:""),$S(VP="VP":"#",1:""),$S($G(FBCAN)]"":"+",1:"")
"RTN","FBAAPIN",54,0)
 W ?3,FBFPPSL,?14,"$",$J(A1,8),?26,"$",$J(A2,8),?37,FBUNITS
"RTN","FBAAPIN",55,0)
 ; write adjustment reasons, if null then write suspend code
"RTN","FBAAPIN",56,0)
 W ?43,$S(FBADJLR]"":FBADJLR,1:T)
"RTN","FBAAPIN",57,0)
 ; write adjustment amounts, if null then write amount suspended
"RTN","FBAAPIN",58,0)
 W ?53,"$",$S(FBADJLA]"":FBADJLA,1:TAMT)
"RTN","FBAAPIN",59,0)
 W ?69,FBRRMKL
"RTN","FBAAPIN",60,0)
 ; if adjustment reasons null and suspend code = other then write desc.
"RTN","FBAAPIN",61,0)
 I FBADJLR="",T=4 D ^FBAAPIN1
"RTN","FBAAPIN",62,0)
 I FBCNTRN]"" W !!,?2,"Contract Number: ",FBCNTRN
"RTN","FBAAPIN",63,0)
 I FBIA'=""!(FBDODINV'="") W !!?5,"IPAC Number: ",FBIA,?30,"DoD Invoice Number: ",FBDODINV
"RTN","FBAAPIN",64,0)
 ;
"RTN","FBAAPIN",65,0)
 ; write attachment IDs FB*3.5*164
"RTN","FBAAPIN",66,0)
 I $D(^FBAAC(J,1,K,1,L,1,M,10)) D
"RTN","FBAAPIN",67,0)
 . N AI,AID,AITI,WRTPC
"RTN","FBAAPIN",68,0)
 . S AI=0 S WRTPC="Attachment ID:"
"RTN","FBAAPIN",69,0)
 . F  S AI=$O(^FBAAC(J,1,K,1,L,1,M,10,AI)) Q:'AI  D
"RTN","FBAAPIN",70,0)
 . . S AID=$P($G(^FBAAC(J,1,K,1,L,1,M,10,AI,0)),U)
"RTN","FBAAPIN",71,0)
 . . I AI>1 S WRTPC=WRTPC_","
"RTN","FBAAPIN",72,0)
 . . S WRTPC=WRTPC_" "_AID
"RTN","FBAAPIN",73,0)
 . . S AITI=$P($G(^FBAAC(J,1,K,1,L,1,M,10,AI,0)),U,2)
"RTN","FBAAPIN",74,0)
 . . I AITI D
"RTN","FBAAPIN",75,0)
 . . . S WRTPC=WRTPC_" ("_$P($G(^IBE(353.3,AITI,0)),U)
"RTN","FBAAPIN",76,0)
 . . . S WRTPC=WRTPC_" - "
"RTN","FBAAPIN",77,0)
 . . . S WRTPC=WRTPC_$P($G(^IBE(353.3,AITI,0)),U,2)_")"
"RTN","FBAAPIN",78,0)
 . . I $L(WRTPC)>IOM D WRTSTR^FBAACCB1(.WRTPC,IOM)
"RTN","FBAAPIN",79,0)
 . I $L(WRTPC)>0 D WRTSTR^FBAACCB1(.WRTPC,IOM)
"RTN","FBAAPIN",80,0)
 ;
"RTN","FBAAPIN",81,0)
 D PMNT^FBAACCB2
"RTN","FBAAPIN",82,0)
 ; Display LI Rendering Provider data
"RTN","FBAAPIN",83,0)
 N FBLIPRV S FBLIPRV=$G(^FBAAC(J,1,K,1,L,1,M,3))  ; FB*3.5*135
"RTN","FBAAPIN",84,0)
 I $L($P(FBLIPRV,U,3)) D
"RTN","FBAAPIN",85,0)
 . W !?3,"RENDERING PROV NAME (LI): "_$P(FBLIPRV,U,3)
"RTN","FBAAPIN",86,0)
 . I $L($P(FBLIPRV,U,4,5))>1 W !?7,"NPI: "_$P(FBLIPRV,U,4),?29,"TAXONOMY CODE: "_$P(FBLIPRV,U,5)
"RTN","FBAAPIN",87,0)
 Q
"RTN","FBAAPIN",88,0)
HED W @IOF,!,"Invoice Number: ",FBAAIN,?30,"Vendor Name: ",V,!,?2,"Date Received: ",FBINDAT
"RTN","FBAAPIN",89,0)
 I +$G(FBY) W ?33,"Invoice Date: ",$$DATX^FBAAUTL(+FBY)
"RTN","FBAAPIN",90,0)
 W !?2,"FPPS Claim ID: ",$S(FBFPPSC]"":FBFPPSC,1:"N/A")
"RTN","FBAAPIN",91,0)
 W ?33,"Patient Account #: ",FBCSID
"RTN","FBAAPIN",92,0)
 W !?10,"('*' Reimb. to Patient  '+' Cancel. Activity  '#' Voided Payment)"
"RTN","FBAAPIN",93,0)
 ;W !,"SVC DATE"," CPT-MOD ","   AMT CLAIMED",?35,"AMT PAID",?47,"CODE",?57,"BATCH NO.",?67,"VOUCHER DATE",!,?5,"Other Suspension Description",!,$$REPEAT^XLFSTR("=",79),!
"RTN","FBAAPIN",94,0)
 W !,"PATIENT",?33,"SVC DATE",?43,"CPT-MOD",?51,"/REV",?57,"BATCH NO.",?67,"VOUCHER DATE"
"RTN","FBAAPIN",95,0)
 W !,?3,"FPPS LINE",?14,"AMT CLAIMED",?26,"AMT PAID",?36,"UNITS",?43,"ADJ CODE",?53,"ADJ AMT",?69,"REMIT RMK"
"RTN","FBAAPIN",96,0)
 W !,$$REPEAT^XLFSTR("=",79)
"RTN","FBAAPIN",97,0)
 Q
"RTN","FBAAPIN",98,0)
Q K D,N,V,D2,J,K,L,M,DIC,T,FBYY,Q,I,A1,A2,A3,C,DIYS,FBAACPT,FBAAIN,FBAAOUT,FBBN,FBINTOT,FBINDAT,FBSW,FBHDONE,HX,S,VP,Z,ZS,FBHED,FBFILE,DIRUT,FBY,FBMOD
"RTN","FBAAPIN",99,0)
 K FBMODLE
"RTN","FBAAPIN",100,0)
 K FBAARCE,FBADJLA,FBADJLR,FBCSID,FBFPPSC,FBFPPSL,FBRRMKL,FBUNITS,TAMT
"RTN","FBAAPIN",101,0)
 Q
"RTN","FBAAPIN",102,0)
ERR W !,*7,"Please enter a whole number! Alpha characters and puctuation are invalid" G RD1
"RTN","FBAAPIN",103,0)
SETHD S V=$S($D(^FBAAV(K,0)):$P(^(0),"^",1),1:"") D INDAT:FBSW S FBHDONE=1 Q
"RTN","FBAAPIN",104,0)
MMORE S FBSW=1 F K=0:0 S K=$O(^FBAAC("C",FBAAIN,J,K)) Q:K=""!(FBAAOUT)  D SETHD F L=0:0 S L=$O(^FBAAC("C",FBAAIN,J,K,L)) Q:L=""!(FBAAOUT)  F M=0:0 S M=$O(^FBAAC("C",FBAAIN,J,K,L,M)) Q:M'>0  D SET Q:FBAAOUT
"RTN","FBAAPIN",105,0)
 Q
"RTN","FBAAPIN",106,0)
INDAT S L=$O(^FBAAC("C",FBAAIN,J,K,"")),M=$O(^FBAAC("C",FBAAIN,J,K,L,""))
"RTN","FBAAPIN",107,0)
 S FBINDAT=$P($G(^FBAAC(J,1,K,1,L,1,M,0)),"^",15)
"RTN","FBAAPIN",108,0)
 S FBINDAT=$S(FBINDAT="":"Unknown",1:$E(FBINDAT,4,5)_"/"_$E(FBINDAT,6,7)_"/"_$E(FBINDAT,2,3))
"RTN","FBAAPIN",109,0)
 S FBFPPSC=$P($G(^FBAAC(J,1,K,1,L,1,M,3)),U,1)
"RTN","FBAAPIN",110,0)
 S FBCSID=$P($G(^FBAAC(J,1,K,1,L,1,M,2)),U,16)
"RTN","FBAAPIN",111,0)
 S FBSW=0 K L,M Q
"RTN","FBAAPIN",112,0)
 Q
"RTN","FBAAPIN",113,0)
PROV ;Display Invoice Provider information before invoice details FB*3.5*122
"RTN","FBAAPIN",114,0)
 N FBPRI,FBSRVF S FBPRI=$G(^FBAAC(J,1,K,1,L,1,M,4)),FBSRVF=$G(^FBAAC(J,1,K,1,L,1,M,5)),$P(FBSRVF,U,3)=$$GET1^DIQ(5,$P(FBSRVF,U,3)_",",1)
"RTN","FBAAPIN",115,0)
 W @IOF,!?30,"INVOICE DISPLAY",!?30,"===============",!?28,"PROVIDER INFORMATION",!
"RTN","FBAAPIN",116,0)
 I $L($P(FBPRI,U,1,3))>3 W !?3,"ATTENDING PROV NAME: "_$P(FBPRI,U),!?3,"ATTENDING PROV NPI: "_$P(FBPRI,U,2),?35,"ATTENDING PROV TAXONOMY CODE: "_$P(FBPRI,U,3)
"RTN","FBAAPIN",117,0)
 I $L($P(FBPRI,U,4,5))>2 W !!?3,"OPERATING PROV NAME: "_$P(FBPRI,U,4),!?3,"OPERATING PROV NPI: "_$P(FBPRI,U,5)
"RTN","FBAAPIN",118,0)
 I $L($P(FBPRI,U,6,8))>3 W !!?3,"RENDERING PROV NAME: "_$P(FBPRI,U,6),!?3,"RENDERING PROV NPI: "_$P(FBPRI,U,7),?35,"RENDERING PROV TAXONOMY CODE: "_$P(FBPRI,U,8)
"RTN","FBAAPIN",119,0)
 I $L($P(FBPRI,U,9,10))>2 W !!?3,"SERVICING PROV NAME: "_$P(FBPRI,U,9),!?3,"SERVICING PROV NPI: "_$P(FBPRI,U,10)
"RTN","FBAAPIN",120,0)
 I $L($P(FBSRVF,U,1,4))>4 W !?3,"SERVICING FACILITY ADDRESS: ",!?5,$P(FBSRVF,U),!?5,$P(FBSRVF,U,2) I $P(FBSRVF,U,2)'="" W ", "
"RTN","FBAAPIN",121,0)
 W $P(FBSRVF,U,3)_" "_$P(FBSRVF,U,4)
"RTN","FBAAPIN",122,0)
 I $L($P(FBPRI,U,11,12))>2 W !!?3,"REFERRING PROV NAME: "_$P(FBPRI,U,11),!?3,"REFERRING PROV NPI: "_$P(FBPRI,U,12),!!
"RTN","FBAAPIN",123,0)
 I '$D(FBHED) S DIR(0)="E" D ^DIR
"RTN","FBAAPIN",124,0)
 Q
"RTN","FBCHVH")
0^5^B48116454^B38454495
"RTN","FBCHVH",1,0)
FBCHVH ;AISC/DMK - VENDOR PAYMENT HISTORY ;7/17/2003
"RTN","FBCHVH",2,0)
 ;;3.5;FEE BASIS;**55,61,122,108,135,144,123,164**;JAN 30, 1995;Build 28
"RTN","FBCHVH",3,0)
 ;;Per VA Directive 6402, this routine should not be modified.
"RTN","FBCHVH",4,0)
GETVEN K FBAANQ D GETVEN^FBAAUTL1 G END:IFN']""
"RTN","FBCHVH",5,0)
 D DATE^FBAAUTL G:FBPOP GETVEN S ZZ=9999999.9999,FBBEG=ZZ-ENDDATE,FBEND=ZZ-BEGDATE
"RTN","FBCHVH",6,0)
 I '$D(^FBAAI("AF",IFN)) W !,*7,"No invoices on line for this vendor." G GETVEN
"RTN","FBCHVH",7,0)
 S VAR="IFN^FBBEG^FBEND^BEGDATE^ENDDATE"_$S($D(FBPROG):"^FBPROG",1:""),VAL=IFN_"^"_FBBEG_"^"_FBEND_"^"_BEGDATE_"^"_ENDDATE_$S($D(FBPROG):"^"_FBPROG,1:""),PGM="START^FBCHVH" D ZIS^FBAAUTL G:FBPOP END S:IO=IO(0) FBAANQ=1
"RTN","FBCHVH",8,0)
START S:'$D(FBPROG) FBPROG=6 S FBHEAD="VENDOR",Q="",$P(Q,"=",80)="=",FBAAOUT=0 U IO D GETDAT S:$E(IOST,1,2)'["C-" FBPG=1 D HEDC
"RTN","FBCHVH",9,0)
 F FBM=FBBEG-.1:0 S FBM=$O(^FBAAI("AF",IFN,FBM)) Q:FBM'>0!(FBM>FBEND)  F FBI=0:0 S FBI=$O(^FBAAI("AF",IFN,FBM,FBI)) Q:FBI'>0!(FBAAOUT)  I $D(^FBAAI(FBI,0)),$P(^(0),"^",12)=FBPROG,'$D(^("FBREJ")) D GETINV
"RTN","FBCHVH",10,0)
 G:$D(FBAANQ) GETVEN
"RTN","FBCHVH",11,0)
END K DA,BEGDATE,ENDDATE,FBBEG,FBEND,DIC,FBAANQ,FBAAOUT,FBDX,FBI,FBIN,FBPROC,FBVEN,FBVID,IFN,J,K,L,PGM,Q,VADM,VAERR,VAL,VAR,X,Y,VA,ZZ,FBM,FBHEAD,FBPROG,FBPG,FBVINDT
"RTN","FBCHVH",12,0)
 D CLOSE^FBAAUTL Q
"RTN","FBCHVH",13,0)
GETINV ;
"RTN","FBCHVH",14,0)
 N FBADJLA,FBADJLR,FBCDAYS,FBCSID,FBFPPSC,FBFPPSL,FBRRMKL,FBY2,FBY3,FBY5,FBADMTDX,FBPOA,FBCNTRN,B
"RTN","FBCHVH",15,0)
 N AD
"RTN","FBCHVH",16,0)
 S FBIN=^FBAAI(FBI,0)
"RTN","FBCHVH",17,0)
 S FBY2=$G(^FBAAI(FBI,2))
"RTN","FBCHVH",18,0)
 S FBY3=$G(^FBAAI(FBI,3))
"RTN","FBCHVH",19,0)
 S FBY5=$G(^FBAAI(FBI,5))
"RTN","FBCHVH",20,0)
 F J=1,2,3,4,6,7,8,9,10,11,13,14 S FBIN(J)=$P(FBIN,"^",J)
"RTN","FBCHVH",21,0)
 S FBVINDT=$P(FBY2,"^",2) D FBCKI^FBAACCB1(FBI)
"RTN","FBCHVH",22,0)
 S FBVEN=$S($D(^FBAAV(+FBIN(3),0)):$P(^(0),"^",1),1:"") I FBVEN]"" S FBVID=$P(^(0),"^",2)
"RTN","FBCHVH",23,0)
 S DFN=FBIN(4) Q:'DFN  D DEM^VADPT
"RTN","FBCHVH",24,0)
 S Y=FBIN(2) D CDAT S FBIN(2)=Y
"RTN","FBCHVH",25,0)
 S Y=FBIN(6) D CDAT S FBIN(6)=Y,Y=FBIN(7) D CDAT S FBIN(7)=Y
"RTN","FBCHVH",26,0)
 S FBCDAYS=$P(FBY2,U,10) ; covered days
"RTN","FBCHVH",27,0)
 S FBCSID=$P(FBY2,U,11) ; patient control number
"RTN","FBCHVH",28,0)
 S FBFPPSC=$P(FBY3,U) ; fpps claim id
"RTN","FBCHVH",29,0)
 S FBFPPSL=$P(FBY3,U,2) ; fpps line item
"RTN","FBCHVH",30,0)
 S FBX=$$ADJLRA^FBCHFA(FBI_",")
"RTN","FBCHVH",31,0)
 S FBADJLR=$P(FBX,U)
"RTN","FBCHVH",32,0)
 S FBADJLA=$P(FBX,U,2)
"RTN","FBCHVH",33,0)
 S FBRRMKL=$$RRL^FBCHFR(FBI_",")
"RTN","FBCHVH",34,0)
WRT I $Y+6>IOSL D HANG^FBAAUTL1:$E(IOST,1,2)["C-" Q:FBAAOUT  I $D(^FBAAI(FBI,4)) D HEDC
"RTN","FBCHVH",35,0)
 W !,$S('$D(FBIN(13)):"",FBIN(13)="R":"*",1:""),$S($G(FBCAN)]"":"+",1:"")
"RTN","FBCHVH",36,0)
 W VADM(1)_"  "_$P(VADM(2),"^",2),?48,FBCSID
"RTN","FBCHVH",37,0)
 W !,?4,FBVEN,?45,FBVID,?62,FBIN(1)
"RTN","FBCHVH",38,0)
 W !,$S(FBIN(13)["R":"*",1:""),$S(FBIN(14)]"":"#",1:"")
"RTN","FBCHVH",39,0)
 W ?4,FBFPPSC,?18,FBFPPSL,?35,FBIN(2),?46,$$DATX^FBAAUTL(FBVINDT),?57,FBIN(6),?68,FBIN(7)
"RTN","FBCHVH",40,0)
 W !?4,$J(FBIN(8),1,2),?17,$J(FBIN(9),1,2),?29,FBCDAYS
"RTN","FBCHVH",41,0)
 ; write adjustment reasons, if null then write suspend code
"RTN","FBCHVH",42,0)
 W ?39,$S(FBADJLR]"":FBADJLR,1:FBIN(11))
"RTN","FBCHVH",43,0)
 ; write adjustment amounts, if null then write amount suspended
"RTN","FBCHVH",44,0)
 W ?49,$S(FBADJLA]"":FBADJLA,1:$J(FBIN(10),1,2))
"RTN","FBCHVH",45,0)
 W ?64,FBRRMKL
"RTN","FBCHVH",46,0)
 ;IPAC agreement data from patch FB*3.5*123
"RTN","FBCHVH",47,0)
 I +$P(FBY5,U,10) W !!?5,"IPAC Number: ",$P($G(^FBAA(161.95,+$P(FBY5,U,10),0)),U,1),?30,"DoD Invoice Number: ",$P(FBY5,U,7)
"RTN","FBCHVH",48,0)
 ;write admitting diagnosis
"RTN","FBCHVH",49,0)
 S FBADMTDX=$P(FBY5,"^",9) I FBADMTDX]"" W !?2,"Admit Dx: ",$$ICD9^FBCSV1((FBADMTDX),$P($G(FBIN),"^",6))
"RTN","FBCHVH",50,0)
 ;write contract number
"RTN","FBCHVH",51,0)
 S FBCNTRN=$S($P(FBY5,U,8):$P($G(^FBAA(161.43,$P(FBY5,U,8),0)),U),1:"")
"RTN","FBCHVH",52,0)
 I FBCNTRN]"" W ?25,"Contract Number: ",FBCNTRN
"RTN","FBCHVH",53,0)
 ;set diagnosis code and present on admission code
"RTN","FBCHVH",54,0)
 N P1,P2
"RTN","FBCHVH",55,0)
 S P1=$G(^FBAAI(FBI,"DX"))
"RTN","FBCHVH",56,0)
 S P2=$G(^FBAAI(FBI,"POA"))
"RTN","FBCHVH",57,0)
 F K=1:1:25 D WRTDX
"RTN","FBCHVH",58,0)
 ;display procedure code with line item prov data - FB*3.5*135
"RTN","FBCHVH",59,0)
 N DIR,DUOUT,DTOUT,FBOUT,F135,L,P3,P5,RPROV,STRLEN,WRTPC
"RTN","FBCHVH",60,0)
 S P5=$G(^FBAAI(FBI,"PROC"))   ; Procedure codes
"RTN","FBCHVH",61,0)
 M RPROV=^FBAAI(FBI,"RPROV")   ; LI Provider array
"RTN","FBCHVH",62,0)
 S F135=24,FBOUT=0,STRLEN=66
"RTN","FBCHVH",63,0)
 F L=1:1:25 S WRTPC=$$WRTPC I WRTPC]"" D  Q:FBOUT
"RTN","FBCHVH",64,0)
 . S P3=$O(RPROV("B",L,0))
"RTN","FBCHVH",65,0)
 . I P3 D    ; display LI Provider and NPI/TAXONOMY data if present
"RTN","FBCHVH",66,0)
 .. W !,?4,"PROC: "_WRTPC,?17,"RENDERING PROV NAME (LI): "_$P(RPROV(P3,0),U,2) S F135=1+F135,STRLEN=66
"RTN","FBCHVH",67,0)
 .. I '$L($P(RPROV(P3,0),U,3)),'$L($P(RPROV(P3,0),U,4)) Q
"RTN","FBCHVH",68,0)
 .. W !,?22,"NPI: "_$P(RPROV(P3,0),U,3),?43,"TAXONOMY CODE: "_$P(RPROV(P3,0),U,4) S F135=1+F135
"RTN","FBCHVH",69,0)
 . E  D  Q   ; only display procedure code
"RTN","FBCHVH",70,0)
 .. I STRLEN>65 W !,?4,"PROC: " S STRLEN=0    ; start new line
"RTN","FBCHVH",71,0)
 .. W WRTPC_" " S STRLEN=1+STRLEN+$L(WRTPC)
"RTN","FBCHVH",72,0)
 . I F135>22 S F135=0,STRLEN=66,DIR(0)="E" W ! D ^DIR K DIR S:$D(DUOUT)!($D(DTOUT)) FBOUT=1   ; pagination
"RTN","FBCHVH",73,0)
 I $D(^FBAAI(FBI,10)) D  Q:FBOUT
"RTN","FBCHVH",74,0)
 . N AI,AID,AITI S AI=0 S WRTPC="Attachment ID:"
"RTN","FBCHVH",75,0)
 . F  S AI=$O(^FBAAI(FBI,10,AI)) Q:'AI  D  Q:FBOUT
"RTN","FBCHVH",76,0)
 . . S AID=$P($G(^FBAAI(FBI,10,AI,0)),"^") I $L(WRTPC)>20 S WRTPC=WRTPC_","
"RTN","FBCHVH",77,0)
 . . S WRTPC=WRTPC_" "_AID
"RTN","FBCHVH",78,0)
 . . S AITI=$P($G(^FBAAI(FBI,10,AI,0)),"^",2) I AITI D
"RTN","FBCHVH",79,0)
 . . . S WRTPC=WRTPC_" ("_$P($G(^IBE(353.3,AITI,0)),"^")
"RTN","FBCHVH",80,0)
 . . . S WRTPC=WRTPC_" - "
"RTN","FBCHVH",81,0)
 . . . S WRTPC=WRTPC_$P($G(^IBE(353.3,AITI,0)),"^",2)_")"
"RTN","FBCHVH",82,0)
 . . I $L(WRTPC)>65 S FBOUT=$$WRTSTR(.WRTPC,65)
"RTN","FBCHVH",83,0)
 . I $L(WRTPC)>0 S FBOUT=$$WRTSTR(.WRTPC,65)
"RTN","FBCHVH",84,0)
 N A2 S A2=FBIN(9) W ! D PMNT^FBAACCB2
"RTN","FBCHVH",85,0)
 Q
"RTN","FBCHVH",86,0)
WRTSTR(STR,MX) ; Wordwrap string
"RTN","FBCHVH",87,0)
 N RM,I S FBOUT=0
"RTN","FBCHVH",88,0)
WRTSTR1 S RM=$S(STR?1"Attachment ID:".E:MX-4,1:MX-7)
"RTN","FBCHVH",89,0)
 F I=1:1:$L(STR," ") Q:$L($P(STR," ",1,I))>RM
"RTN","FBCHVH",90,0)
 W !,?4 W:STR'?1"Attachment ID:".E ?7 W $P(STR," ",1,$S(I=$L(STR," "):I,1:I-1))
"RTN","FBCHVH",91,0)
 S STR=$P(STR," ",I,999)
"RTN","FBCHVH",92,0)
 S F135=F135+1 I F135>22 S F135=0,DIR(0)="E" W ! D ^DIR K DIR S:$D(DUOUT)!($D(DTOUT)) FBOUT=1   ; pagination
"RTN","FBCHVH",93,0)
 I FBOUT Q FBOUT
"RTN","FBCHVH",94,0)
 I $L(STR)>(MX-3) G WRTSTR1
"RTN","FBCHVH",95,0)
 Q FBOUT
"RTN","FBCHVH",96,0)
WRTDX ;write dianosis code and present on admission code
"RTN","FBCHVH",97,0)
 N P3,P4
"RTN","FBCHVH",98,0)
 S FBDX=$P(P1,"^",K)
"RTN","FBCHVH",99,0)
 S FBPOA=$P(P2,"^",K)
"RTN","FBCHVH",100,0)
 Q:FBDX=""
"RTN","FBCHVH",101,0)
 S P3=$$ICD9^FBCSV1((FBDX),$P($G(FBIN),"^",6))_"/"
"RTN","FBCHVH",102,0)
 S P4=P3_$S(FBPOA:$P($G(^FB(161.94,FBPOA,0)),"^"),1:"")_" "
"RTN","FBCHVH",103,0)
 I K=1!($X+$L(P4)+2>IOM) W !,?4,"DX/POA: "
"RTN","FBCHVH",104,0)
 W P4,""
"RTN","FBCHVH",105,0)
 Q
"RTN","FBCHVH",106,0)
WRTPC() ;write procedure code (if present)    ; FB*3.5*135
"RTN","FBCHVH",107,0)
 N P6
"RTN","FBCHVH",108,0)
 S FBPROC=$P(P5,"^",L)
"RTN","FBCHVH",109,0)
 Q:FBPROC="" ""
"RTN","FBCHVH",110,0)
 S P6=$$ICD0^FBCSV1((FBPROC),$P($G(FBIN),"^",6))_" "
"RTN","FBCHVH",111,0)
 Q P6
"RTN","FBCHVH",112,0)
HEDC I $D(FBHEAD) W:'$G(FBPG) @IOF K:$G(FBPG) FBPG W ?25,FBHEAD_" PAYMENT HISTORY",!,?24,$E(Q,1,24),!?48,"Date Range: ",BEGDATE_" to "_ENDDATE
"RTN","FBCHVH",113,0)
 I '$D(FBHEAD) W:'$G(FBPG) @IOF K:$G(FBPG) FBPG W !?32,"INVOICE DISPLAY",!,?31,$E(Q,1,17),!
"RTN","FBCHVH",114,0)
 W !,"Veteran's Name",?48,"Patient Control Number"
"RTN","FBCHVH",115,0)
 W !,"('*'Reimbursement to Veteran   '+' Cancellation Activity)   '#' Voided Payment)"
"RTN","FBCHVH",116,0)
 ;FB*3.5*164
"RTN","FBCHVH",117,0)
 ;W !,"('&' Additional Payment)"
"RTN","FBCHVH",118,0)
 ;
"RTN","FBCHVH",119,0)
 W !,?4,"Vendor Name",?45,"Vendor ID",?59,"Invoice #"
"RTN","FBCHVH",120,0)
 ;W !,?3,"Fr Date",?14,"To Date  Claimed   Paid",?41,"Sus Code",?59,"Dt. Rec.",?69,"Inv. Date"
"RTN","FBCHVH",121,0)
 W !,?4,"FPPS Claim ID",?18,"FPPS Line Item",?35,"Date Rec.",?46,"Inv. Date",?57,"Fr Date",?68,"To Date"
"RTN","FBCHVH",122,0)
 W !,?4,"Amt Claimed",?17,"Amt Paid",?29,"Cov.Days",?39,"Adj Code",?49,"Adj Amount",?64,"Remit Remark"
"RTN","FBCHVH",123,0)
 W !,Q,!
"RTN","FBCHVH",124,0)
 Q
"RTN","FBCHVH",125,0)
CDAT S Y=$E(Y,4,5)_"/"_$S($E(Y,6,7)="00":$E(Y,2,3),1:$E(Y,6,7)_"/"_$E(Y,2,3)) Q
"RTN","FBCHVH",126,0)
GETDAT S Y=BEGDATE D PDF^FBAAUTL S BEGDATE=Y,Y=ENDDATE D PDF^FBAAUTL S ENDDATE=Y
"RTN","FBCHVH",127,0)
 Q
"RTN","FBCHVH",128,0)
PRVD ;DISPLAY PROVIDER INFORMATION BEFORE INVOICE DISPLAY FB*3.5*122
"RTN","FBCHVH",129,0)
 N FBPRI,FBSRVF,FBST
"RTN","FBCHVH",130,0)
 S FBPRI=$G(^FBAAI(FBI,4)),FBSRVF=$G(^FBAAI(FBI,5)),$P(FBSRVF,U,3)=$$GET1^DIQ(5,$P(FBSRVF,U,3)_",",1)
"RTN","FBCHVH",131,0)
 W @IOF,!?30,"INVOICE DISPLAY",!?30,"===============",!?28,"PROVIDER INFORMATION",!
"RTN","FBCHVH",132,0)
 I $L($P(FBPRI,U,1,3))>3 W !?3,"ATTENDING PROV NAME: "_$P(FBPRI,U),!?3,"ATTENDING PROV NPI: "_$P(FBPRI,U,2),?35,"ATTENDING PROV TAXONOMY CODE: "_$P(FBPRI,U,3)
"RTN","FBCHVH",133,0)
 I $L($P(FBPRI,U,4,5))>2 W !!?3,"OPERATING PROV NAME: "_$P(FBPRI,U,4),!?3,"OPERATING PROV NPI: "_$P(FBPRI,U,5)
"RTN","FBCHVH",134,0)
 I $L($P(FBPRI,U,6,8))>3 W !!?3,"RENDERING PROV NAME: "_$P(FBPRI,U,6),!?3,"RENDERING PROV NPI: "_$P(FBPRI,U,7),?35,"RENDERING PROV TAXONOMY CODE: "_$P(FBPRI,U,8)
"RTN","FBCHVH",135,0)
 I $L($P(FBPRI,U,9,10))>2 W !!?3,"SERVICING PROV NAME: "_$P(FBPRI,U,9),!?3,"SERVICING PROV NPI: "_$P(FBPRI,U,10)
"RTN","FBCHVH",136,0)
 I $L($P(FBSRVF,U,1,4))>4 W !?3,"SERVICING FACILITY ADDRESS: ",!?5,$P(FBSRVF,U),!?5,$P(FBSRVF,U,2) I $P(FBSRVF,U,2)'="" W ", "
"RTN","FBCHVH",137,0)
 W $P(FBSRVF,U,3)_" "_$P(FBSRVF,U,4)
"RTN","FBCHVH",138,0)
 I $L($P(FBPRI,U,11,12))>2 W !!?3,"REFERRING PROV NAME: "_$P(FBPRI,U,11),!?3,"REFERRING PROV NPI: "_$P(FBPRI,U,12),!!
"RTN","FBCHVH",139,0)
 S DIR(0)="E" D ^DIR
"RTN","FBCHVH",140,0)
 Q
"UP",162,162.0384,-4)
162^1
"UP",162,162.0384,-3)
162.01^1
"UP",162,162.0384,-2)
162.02^1
"UP",162,162.0384,-1)
162.03^10
"UP",162,162.0384,0)
162.0384
"VER")
8.0^22.0
"^DD",162,162.03,84,0)
ATTACHMENT ID^162.0384A^^10;0
"^DD",162,162.03,84,21,0)
^^2^2^3160921^
"^DD",162,162.03,84,21,1,0)
This multiple holds Attachment IDs and Attachment Report Types supporting 
"^DD",162,162.03,84,21,2,0)
this payment in the Attachment Retrieval System (ARS).
"^DD",162,162.0384,0)
ATTACHMENT ID SUB-FIELD^^.02^2
"^DD",162,162.0384,0,"DT")
3160617
"^DD",162,162.0384,0,"IX","B",162.0384,.01)

"^DD",162,162.0384,0,"NM","ATTACHMENT ID")

"^DD",162,162.0384,0,"UP")
162.03
"^DD",162,162.0384,.01,0)
ATTACHMENT ID^F^^0;1^K:$L(X)>30!($L(X)<1) X
"^DD",162,162.0384,.01,1,0)
^.1
"^DD",162,162.0384,.01,1,1,0)
162.0384^B
"^DD",162,162.0384,.01,1,1,1)
S ^FBAAC(DA(4),1,DA(3),1,DA(2),1,DA(1),10,"B",$E(X,1,30),DA)=""
"^DD",162,162.0384,.01,1,1,2)
K ^FBAAC(DA(4),1,DA(3),1,DA(2),1,DA(1),10,"B",$E(X,1,30),DA)
"^DD",162,162.0384,.01,3)
Answer must be 1-30 characters in length.
"^DD",162,162.0384,.01,21,0)
^^3^3^3160617^
"^DD",162,162.0384,.01,21,1,0)
This field contains the ID of an attachment supporting this payment in 
"^DD",162,162.0384,.01,21,2,0)
the Attachment Retrieval System (ARS). This data is populated 
"^DD",162,162.0384,.01,21,3,0)
automatically and should not be edited by users.
"^DD",162,162.0384,.01,"DT")
3160617
"^DD",162,162.0384,.02,0)
ATTACHMENT REPORT TYPE^P353.3'^IBE(353.3,^0;2^Q
"^DD",162,162.0384,.02,3)
Enter an Attachment Report Type Code.
"^DD",162,162.0384,.02,21,0)
^.001^2^2^3160921^^
"^DD",162,162.0384,.02,21,1,0)
The Report Type Code describes the type of documentation that will 
"^DD",162,162.0384,.02,21,2,0)
provide additional information for this payment.
"^DD",162,162.0384,.02,"DT")
3160617
"BLD",9840,6)
^155
**END**
**END**

