Released FB*3.5*158 SEQ #149
Extracted from mail message
**KIDS**:FB*3.5*158^

**INSTALL NAME**
FB*3.5*158
"BLD",9162,0)
FB*3.5*158^FEE BASIS^0^3171206^y
"BLD",9162,1,0)
^^1^1^3150528^^
"BLD",9162,1,1,0)
HAC EDI Purchase Care ERA Inc. 2 Development
"BLD",9162,4,0)
^9.64PA^161.93^8
"BLD",9162,4,161.4,0)
161.4
"BLD",9162,4,161.4,2,0)
^9.641^161.4^1
"BLD",9162,4,161.4,2,161.4,0)
FEE BASIS SITE PARAMETERS  (File-top level)
"BLD",9162,4,161.4,2,161.4,1,0)
^9.6411^10^1
"BLD",9162,4,161.4,2,161.4,1,10,0)
NEXT BATCH NUMBER
"BLD",9162,4,161.4,222)
y^n^p^^^^n^^n
"BLD",9162,4,161.4,224)

"BLD",9162,4,161.7,0)
161.7
"BLD",9162,4,161.7,2,0)
^9.641^161.7^1
"BLD",9162,4,161.7,2,161.7,0)
FEE BASIS BATCH  (File-top level)
"BLD",9162,4,161.7,2,161.7,1,0)
^9.6411^.01^1
"BLD",9162,4,161.7,2,161.7,1,.01,0)
NUMBER
"BLD",9162,4,161.7,222)
y^n^p^^^^n^^n
"BLD",9162,4,161.7,224)

"BLD",9162,4,161.91,0)
161.91
"BLD",9162,4,161.91,2,0)
^9.641^161.917^3
"BLD",9162,4,161.91,2,161.91,0)
ADJUSTMENT REASON  (File-top level)
"BLD",9162,4,161.91,2,161.91,1,0)
^9.6411^6^1
"BLD",9162,4,161.91,2,161.91,1,6,0)
CORE SCENARIO
"BLD",9162,4,161.91,2,161.915,0)
REMITTANCE REMARK  (sub-file)
"BLD",9162,4,161.91,2,161.915,1,0)
^9.6411^^
"BLD",9162,4,161.91,2,161.917,0)
ADJUSTMENT GROUP  (sub-file)
"BLD",9162,4,161.91,2,161.917,1,0)
^9.6411^^
"BLD",9162,4,161.91,222)
y^y^p^^^^n^^n
"BLD",9162,4,161.91,224)

"BLD",9162,4,161.93,0)
161.93
"BLD",9162,4,161.93,2,0)
^9.641^161.933^1
"BLD",9162,4,161.93,2,161.933,0)
ADJUSTMENT GROUP  (sub-file)
"BLD",9162,4,161.93,2,161.933,1,0)
^9.6411^^
"BLD",9162,4,161.93,222)
y^y^p^^^^n^^n
"BLD",9162,4,161.93,224)

"BLD",9162,4,162,0)
162
"BLD",9162,4,162,2,0)
^9.641^162.0384^4
"BLD",9162,4,162,2,162.03,0)
SERVICE PROVIDED  (sub-file)
"BLD",9162,4,162,2,162.03,1,0)
^9.6411^83^2
"BLD",9162,4,162,2,162.03,1,82,0)
PAYMENT METHODOLOGY
"BLD",9162,4,162,2,162.03,1,83,0)
AUTHORIZATION NUMBER
"BLD",9162,4,162,2,162.0384,0)
ATTACHMENT ID  (sub-file)
"BLD",9162,4,162,2,162.0384,1,0)
^9.6411^^
"BLD",9162,4,162,2,162.07,0)
ADJUSTMENT  (sub-file)
"BLD",9162,4,162,2,162.07,1,0)
^9.6411^.01^1
"BLD",9162,4,162,2,162.07,1,.01,0)
ADJUSTMENT REASON
"BLD",9162,4,162,2,162.08,0)
REMITTANCE REMARK  (sub-file)
"BLD",9162,4,162,2,162.08,1,0)
^9.6411^1^1
"BLD",9162,4,162,2,162.08,1,1,0)
ADJUSTMENT
"BLD",9162,4,162,222)
y^y^p^^^^n^^n
"BLD",9162,4,162,224)

"BLD",9162,4,162.1,0)
162.1
"BLD",9162,4,162.1,2,0)
^9.641^162.11^3
"BLD",9162,4,162.1,2,162.11,0)
PRESCRIPTION NUMBER  (sub-file)
"BLD",9162,4,162.1,2,162.11,1,0)
^9.6411^40^1
"BLD",9162,4,162.1,2,162.11,1,40,0)
AUTHORIZATION NUMBER
"BLD",9162,4,162.1,2,162.14,0)
ADJUSTMENT  (sub-file)
"BLD",9162,4,162.1,2,162.14,1,0)
^9.6411^.01^1
"BLD",9162,4,162.1,2,162.14,1,.01,0)
ADJUSTMENT REASON
"BLD",9162,4,162.1,2,162.15,0)
REMITTANCE REMARK  (sub-file)
"BLD",9162,4,162.1,2,162.15,1,0)
^9.6411^1^1
"BLD",9162,4,162.1,2,162.15,1,1,0)
ADJUSTMENT
"BLD",9162,4,162.1,222)
y^y^p^^^^n^^n
"BLD",9162,4,162.1,224)

"BLD",9162,4,162.5,0)
162.5
"BLD",9162,4,162.5,2,0)
^9.641^162.591^4
"BLD",9162,4,162.5,2,162.5,0)
FEE BASIS INVOICE  (File-top level)
"BLD",9162,4,162.5,2,162.5,1,0)
^9.6411^90^3
"BLD",9162,4,162.5,2,162.5,1,88,0)
AUTHORIZATION NUMBER
"BLD",9162,4,162.5,2,162.5,1,89,0)
CLAIM LEVEL ALLOWED AMOUNT
"BLD",9162,4,162.5,2,162.5,1,90,0)
PAYMENT METHODOLOGY
"BLD",9162,4,162.5,2,162.558,0)
ADJUSTMENT  (sub-file)
"BLD",9162,4,162.5,2,162.558,1,0)
^9.6411^.01^1
"BLD",9162,4,162.5,2,162.558,1,.01,0)
ADJUSTMENT REASON
"BLD",9162,4,162.5,2,162.559,0)
REMITTANCE REMARK  (sub-file)
"BLD",9162,4,162.5,2,162.559,1,0)
^9.6411^1^1
"BLD",9162,4,162.5,2,162.559,1,1,0)
ADJUSTMENT
"BLD",9162,4,162.5,2,162.591,0)
ATTACHMENT ID  (sub-file)
"BLD",9162,4,162.5,2,162.591,1,0)
^9.6411^^
"BLD",9162,4,162.5,222)
y^y^p^^^^n^^n
"BLD",9162,4,162.5,224)

"BLD",9162,4,163.98,0)
163.98
"BLD",9162,4,163.98,222)
y^y^f^^n^^y^o^n
"BLD",9162,4,"APDD",161.4,161.4)

"BLD",9162,4,"APDD",161.4,161.4,10)

"BLD",9162,4,"APDD",161.7,161.7)

"BLD",9162,4,"APDD",161.7,161.7,.01)

"BLD",9162,4,"APDD",161.91,161.91)

"BLD",9162,4,"APDD",161.91,161.91,6)

"BLD",9162,4,"APDD",161.91,161.915)

"BLD",9162,4,"APDD",161.91,161.917)

"BLD",9162,4,"APDD",161.93,161.933)

"BLD",9162,4,"APDD",162,162.03)

"BLD",9162,4,"APDD",162,162.03,82)

"BLD",9162,4,"APDD",162,162.03,83)

"BLD",9162,4,"APDD",162,162.0384)

"BLD",9162,4,"APDD",162,162.07)

"BLD",9162,4,"APDD",162,162.07,.01)

"BLD",9162,4,"APDD",162,162.08)

"BLD",9162,4,"APDD",162,162.08,1)

"BLD",9162,4,"APDD",162.1,162.11)

"BLD",9162,4,"APDD",162.1,162.11,40)

"BLD",9162,4,"APDD",162.1,162.14)

"BLD",9162,4,"APDD",162.1,162.14,.01)

"BLD",9162,4,"APDD",162.1,162.15)

"BLD",9162,4,"APDD",162.1,162.15,1)

"BLD",9162,4,"APDD",162.5,162.5)

"BLD",9162,4,"APDD",162.5,162.5,88)

"BLD",9162,4,"APDD",162.5,162.5,89)

"BLD",9162,4,"APDD",162.5,162.5,90)

"BLD",9162,4,"APDD",162.5,162.558)

"BLD",9162,4,"APDD",162.5,162.558,.01)

"BLD",9162,4,"APDD",162.5,162.559)

"BLD",9162,4,"APDD",162.5,162.559,1)

"BLD",9162,4,"APDD",162.5,162.591)

"BLD",9162,4,"B",161.4,161.4)

"BLD",9162,4,"B",161.7,161.7)

"BLD",9162,4,"B",161.91,161.91)

"BLD",9162,4,"B",161.93,161.93)

"BLD",9162,4,"B",162,162)

"BLD",9162,4,"B",162.1,162.1)

"BLD",9162,4,"B",162.5,162.5)

"BLD",9162,4,"B",163.98,163.98)

"BLD",9162,6.3)
94
"BLD",9162,"ABPKG")
n
"BLD",9162,"INID")
^n
"BLD",9162,"INIT")
EN^FBXIP158
"BLD",9162,"KRN",0)
^9.67PA^779.2^20
"BLD",9162,"KRN",.4,0)
.4
"BLD",9162,"KRN",.4,"NM",0)
^9.68A^^
"BLD",9162,"KRN",.401,0)
.401
"BLD",9162,"KRN",.402,0)
.402
"BLD",9162,"KRN",.402,"NM",0)
^9.68A^3^3
"BLD",9162,"KRN",.402,"NM",1,0)
FBCH ENTER PAYMENT    FILE #162.5^162.5^0
"BLD",9162,"KRN",.402,"NM",2,0)
FBNH EDIT PAYMENT    FILE #162.5^162.5^0
"BLD",9162,"KRN",.402,"NM",3,0)
FBCH EDIT PAYMENT    FILE #162.5^162.5^0
"BLD",9162,"KRN",.402,"NM","B","FBCH EDIT PAYMENT    FILE #162.5",3)

"BLD",9162,"KRN",.402,"NM","B","FBCH ENTER PAYMENT    FILE #162.5",1)

"BLD",9162,"KRN",.402,"NM","B","FBNH EDIT PAYMENT    FILE #162.5",2)

"BLD",9162,"KRN",.403,0)
.403
"BLD",9162,"KRN",.5,0)
.5
"BLD",9162,"KRN",.84,0)
.84
"BLD",9162,"KRN",3.6,0)
3.6
"BLD",9162,"KRN",3.8,0)
3.8
"BLD",9162,"KRN",9.2,0)
9.2
"BLD",9162,"KRN",9.8,0)
9.8
"BLD",9162,"KRN",9.8,"NM",0)
^9.68A^36^34
"BLD",9162,"KRN",9.8,"NM",2,0)
FBAAUTL^^0^B36872113
"BLD",9162,"KRN",9.8,"NM",3,0)
FBAAV0^^0^B76214254
"BLD",9162,"KRN",9.8,"NM",4,0)
FBAAVR5^^0^B40211366
"BLD",9162,"KRN",9.8,"NM",5,0)
FBSVBR^^0^B79485755
"BLD",9162,"KRN",9.8,"NM",6,0)
FBSVVA^^0^B22383786
"BLD",9162,"KRN",9.8,"NM",7,0)
FBAADOB^^0^B2800687
"BLD",9162,"KRN",9.8,"NM",8,0)
FBBPG7Y^^0^B8669207
"BLD",9162,"KRN",9.8,"NM",9,0)
FBAACIE^^0^B17356437
"BLD",9162,"KRN",9.8,"NM",10,0)
FBUTL1^^0^B19606435
"BLD",9162,"KRN",9.8,"NM",11,0)
FBRXFR^^0^B9233192
"BLD",9162,"KRN",9.8,"NM",12,0)
FBUTL2^^0^B70356259
"BLD",9162,"KRN",9.8,"NM",13,0)
FBUTL4^^0^B26671787
"BLD",9162,"KRN",9.8,"NM",14,0)
FBAAFR^^0^B13991294
"BLD",9162,"KRN",9.8,"NM",15,0)
FBAACO2^^0^B33011458
"BLD",9162,"KRN",9.8,"NM",16,0)
FBAACO3^^0^B57937070
"BLD",9162,"KRN",9.8,"NM",17,0)
FBAAEPI^^0^B32470147
"BLD",9162,"KRN",9.8,"NM",18,0)
FBAAMP^^0^B133720533
"BLD",9162,"KRN",9.8,"NM",19,0)
FBAAMP1^^0^B12388857
"BLD",9162,"KRN",9.8,"NM",20,0)
FBAAPET^^0^B51739856
"BLD",9162,"KRN",9.8,"NM",21,0)
FBAAPP0^^0^B4339891
"BLD",9162,"KRN",9.8,"NM",22,0)
FBCHEAP^^0^B21016855
"BLD",9162,"KRN",9.8,"NM",23,0)
FBCHFR^^0^B8623931
"BLD",9162,"KRN",9.8,"NM",24,0)
FBCHPET^^0^B43033601
"BLD",9162,"KRN",9.8,"NM",25,0)
FBNHEP1^^0^B9136492
"BLD",9162,"KRN",9.8,"NM",26,0)
FBAAV2^^0^B39413585
"BLD",9162,"KRN",9.8,"NM",27,0)
FBAAV01^^0^B48459341
"BLD",9162,"KRN",9.8,"NM",28,0)
FBAAV5^^0^B139989645
"BLD",9162,"KRN",9.8,"NM",29,0)
FBUTL4A^^0^B30641813
"BLD",9162,"KRN",9.8,"NM",31,0)
FBAAV4^^0^B39332795
"BLD",9162,"KRN",9.8,"NM",32,0)
FBAAV1^^0^B29696707
"BLD",9162,"KRN",9.8,"NM",33,0)
FBAAV8^^0^B120330474
"BLD",9162,"KRN",9.8,"NM",34,0)
FBAAUTL3^^0^B4122598
"BLD",9162,"KRN",9.8,"NM",35,0)
FBAAV3^^0^B4896340
"BLD",9162,"KRN",9.8,"NM",36,0)
FBX2P158^^0^B176094799
"BLD",9162,"KRN",9.8,"NM","B","FBAACIE",9)

"BLD",9162,"KRN",9.8,"NM","B","FBAACO2",15)

"BLD",9162,"KRN",9.8,"NM","B","FBAACO3",16)

"BLD",9162,"KRN",9.8,"NM","B","FBAADOB",7)

"BLD",9162,"KRN",9.8,"NM","B","FBAAEPI",17)

"BLD",9162,"KRN",9.8,"NM","B","FBAAFR",14)

"BLD",9162,"KRN",9.8,"NM","B","FBAAMP",18)

"BLD",9162,"KRN",9.8,"NM","B","FBAAMP1",19)

"BLD",9162,"KRN",9.8,"NM","B","FBAAPET",20)

"BLD",9162,"KRN",9.8,"NM","B","FBAAPP0",21)

"BLD",9162,"KRN",9.8,"NM","B","FBAAUTL",2)

"BLD",9162,"KRN",9.8,"NM","B","FBAAUTL3",34)

"BLD",9162,"KRN",9.8,"NM","B","FBAAV0",3)

"BLD",9162,"KRN",9.8,"NM","B","FBAAV01",27)

"BLD",9162,"KRN",9.8,"NM","B","FBAAV1",32)

"BLD",9162,"KRN",9.8,"NM","B","FBAAV2",26)

"BLD",9162,"KRN",9.8,"NM","B","FBAAV3",35)

"BLD",9162,"KRN",9.8,"NM","B","FBAAV4",31)

"BLD",9162,"KRN",9.8,"NM","B","FBAAV5",28)

"BLD",9162,"KRN",9.8,"NM","B","FBAAV8",33)

"BLD",9162,"KRN",9.8,"NM","B","FBAAVR5",4)

"BLD",9162,"KRN",9.8,"NM","B","FBBPG7Y",8)

"BLD",9162,"KRN",9.8,"NM","B","FBCHEAP",22)

"BLD",9162,"KRN",9.8,"NM","B","FBCHFR",23)

"BLD",9162,"KRN",9.8,"NM","B","FBCHPET",24)

"BLD",9162,"KRN",9.8,"NM","B","FBNHEP1",25)

"BLD",9162,"KRN",9.8,"NM","B","FBRXFR",11)

"BLD",9162,"KRN",9.8,"NM","B","FBSVBR",5)

"BLD",9162,"KRN",9.8,"NM","B","FBSVVA",6)

"BLD",9162,"KRN",9.8,"NM","B","FBUTL1",10)

"BLD",9162,"KRN",9.8,"NM","B","FBUTL2",12)

"BLD",9162,"KRN",9.8,"NM","B","FBUTL4",13)

"BLD",9162,"KRN",9.8,"NM","B","FBUTL4A",29)

"BLD",9162,"KRN",9.8,"NM","B","FBX2P158",36)

"BLD",9162,"KRN",19,0)
19
"BLD",9162,"KRN",19,"NM",0)
^9.68A^3^2
"BLD",9162,"KRN",19,"NM",2,0)
FBAA BATCH 7YR PURGE^^0
"BLD",9162,"KRN",19,"NM",3,0)
ZTMQUEUABLE OPTIONS^^2
"BLD",9162,"KRN",19,"NM","B","FBAA BATCH 7YR PURGE",2)

"BLD",9162,"KRN",19,"NM","B","ZTMQUEUABLE OPTIONS",3)

"BLD",9162,"KRN",19.1,0)
19.1
"BLD",9162,"KRN",101,0)
101
"BLD",9162,"KRN",409.61,0)
409.61
"BLD",9162,"KRN",771,0)
771
"BLD",9162,"KRN",779.2,0)
779.2
"BLD",9162,"KRN",870,0)
870
"BLD",9162,"KRN",8989.51,0)
8989.51
"BLD",9162,"KRN",8989.52,0)
8989.52
"BLD",9162,"KRN",8994,0)
8994
"BLD",9162,"KRN","B",.4,.4)

"BLD",9162,"KRN","B",.401,.401)

"BLD",9162,"KRN","B",.402,.402)

"BLD",9162,"KRN","B",.403,.403)

"BLD",9162,"KRN","B",.5,.5)

"BLD",9162,"KRN","B",.84,.84)

"BLD",9162,"KRN","B",3.6,3.6)

"BLD",9162,"KRN","B",3.8,3.8)

"BLD",9162,"KRN","B",9.2,9.2)

"BLD",9162,"KRN","B",9.8,9.8)

"BLD",9162,"KRN","B",19,19)

"BLD",9162,"KRN","B",19.1,19.1)

"BLD",9162,"KRN","B",101,101)

"BLD",9162,"KRN","B",409.61,409.61)

"BLD",9162,"KRN","B",771,771)

"BLD",9162,"KRN","B",779.2,779.2)

"BLD",9162,"KRN","B",870,870)

"BLD",9162,"KRN","B",8989.51,8989.51)

"BLD",9162,"KRN","B",8989.52,8989.52)

"BLD",9162,"KRN","B",8994,8994)

"BLD",9162,"QDEF")
^^^^NO^^^^NO^^NO
"BLD",9162,"QUES",0)
^9.62^^
"BLD",9162,"REQB",0)
^9.611^6^6
"BLD",9162,"REQB",1,0)
FB*3.5*73^2
"BLD",9162,"REQB",2,0)
FB*3.5*91^2
"BLD",9162,"REQB",3,0)
FB*3.5*127^2
"BLD",9162,"REQB",4,0)
FB*3.5*157^2
"BLD",9162,"REQB",5,0)
FB*3.5*153^2
"BLD",9162,"REQB",6,0)
FB*3.5*128^2
"BLD",9162,"REQB","B","FB*3.5*127",3)

"BLD",9162,"REQB","B","FB*3.5*128",6)

"BLD",9162,"REQB","B","FB*3.5*153",5)

"BLD",9162,"REQB","B","FB*3.5*157",4)

"BLD",9162,"REQB","B","FB*3.5*73",1)

"BLD",9162,"REQB","B","FB*3.5*91",2)

"DATA",163.98,1,0)
Ambulance^A
"DATA",163.98,2,0)
Bill Charge^B
"DATA",163.98,3,0)
Contract^C
"DATA",163.98,4,0)
End Stage Renal Disease (ESRD)^D
"DATA",163.98,5,0)
Local VA Fee Schedule^F
"DATA",163.98,6,0)
Inpatient Perspective Payment System Acute (IPPS)^I
"DATA",163.98,7,0)
Laboratory^L
"DATA",163.98,8,0)
Anesthesia^N
"DATA",163.98,9,0)
Outpatient Perspective Payment System (OPPS)^O
"DATA",163.98,10,0)
Medicare Physician Fee Schedule (MPFS)^P
"DATA",163.98,11,0)
RBRVS^R
"DATA",163.98,12,0)
Ambulatory Surgical Center (ASC)^S
"DATA",163.98,13,0)
Other^Z
"FIA",161.4)
FEE BASIS SITE PARAMETERS
"FIA",161.4,0)
^FBAA(161.4,
"FIA",161.4,0,0)
161.4
"FIA",161.4,0,1)
y^n^p^^^^n^^n
"FIA",161.4,0,10)

"FIA",161.4,0,11)

"FIA",161.4,0,"RLRO")

"FIA",161.4,0,"VR")
3.5^FB
"FIA",161.4,161.4)
1
"FIA",161.4,161.4,10)

"FIA",161.7)
FEE BASIS BATCH
"FIA",161.7,0)
^FBAA(161.7,
"FIA",161.7,0,0)
161.7I
"FIA",161.7,0,1)
y^n^p^^^^n^^n
"FIA",161.7,0,10)

"FIA",161.7,0,11)

"FIA",161.7,0,"RLRO")

"FIA",161.7,0,"VR")
3.5^FB
"FIA",161.7,161.7)
1
"FIA",161.7,161.7,.01)

"FIA",161.91)
ADJUSTMENT REASON
"FIA",161.91,0)
^FB(161.91,
"FIA",161.91,0,0)
161.91I
"FIA",161.91,0,1)
y^y^p^^^^n^^n
"FIA",161.91,0,10)

"FIA",161.91,0,11)

"FIA",161.91,0,"RLRO")

"FIA",161.91,0,"VR")
3.5^FB
"FIA",161.91,161.91)
1
"FIA",161.91,161.91,5)

"FIA",161.91,161.91,6)

"FIA",161.91,161.91,7)

"FIA",161.91,161.915)
0
"FIA",161.91,161.917)
0
"FIA",161.93)
REMITTANCE REMARK
"FIA",161.93,0)
^FB(161.93,
"FIA",161.93,0,0)
161.93I
"FIA",161.93,0,1)
y^y^p^^^^n^^n
"FIA",161.93,0,10)

"FIA",161.93,0,11)

"FIA",161.93,0,"RLRO")

"FIA",161.93,0,"VR")
3.5^FB
"FIA",161.93,161.93)
1
"FIA",161.93,161.93,3)

"FIA",161.93,161.933)
0
"FIA",162)
FEE BASIS PAYMENT
"FIA",162,0)
^FBAAC(
"FIA",162,0,0)
162P
"FIA",162,0,1)
y^y^p^^^^n^^n
"FIA",162,0,10)

"FIA",162,0,11)

"FIA",162,0,"RLRO")

"FIA",162,0,"VR")
3.5^FB
"FIA",162,162)
1
"FIA",162,162.03)
1
"FIA",162,162.03,52)

"FIA",162,162.03,82)

"FIA",162,162.03,83)

"FIA",162,162.03,84)

"FIA",162,162.0384)
0
"FIA",162,162.07)
1
"FIA",162,162.07,.01)

"FIA",162,162.08)
1
"FIA",162,162.08,1)

"FIA",162.1)
FEE BASIS PHARMACY INVOICE
"FIA",162.1,0)
^FBAA(162.1,
"FIA",162.1,0,0)
162.1
"FIA",162.1,0,1)
y^y^p^^^^n^^n
"FIA",162.1,0,10)

"FIA",162.1,0,11)

"FIA",162.1,0,"RLRO")

"FIA",162.1,0,"VR")
3.5^FB
"FIA",162.1,162.1)
1
"FIA",162.1,162.11)
1
"FIA",162.1,162.11,37)

"FIA",162.1,162.11,40)

"FIA",162.1,162.14)
1
"FIA",162.1,162.14,.01)

"FIA",162.1,162.15)
1
"FIA",162.1,162.15,1)

"FIA",162.5)
FEE BASIS INVOICE
"FIA",162.5,0)
^FBAAI(
"FIA",162.5,0,0)
162.5
"FIA",162.5,0,1)
y^y^p^^^^n^^n
"FIA",162.5,0,10)

"FIA",162.5,0,11)

"FIA",162.5,0,"RLRO")

"FIA",162.5,0,"VR")
3.5^FB
"FIA",162.5,162.5)
1
"FIA",162.5,162.5,58)

"FIA",162.5,162.5,88)

"FIA",162.5,162.5,89)

"FIA",162.5,162.5,90)

"FIA",162.5,162.5,91)

"FIA",162.5,162.558)
1
"FIA",162.5,162.558,.01)

"FIA",162.5,162.559)
1
"FIA",162.5,162.559,1)

"FIA",162.5,162.591)
0
"FIA",163.98)
FEE BASIS PAYMENT METHODOLOGY
"FIA",163.98,0)
^FBAA(163.98,
"FIA",163.98,0,0)
163.98
"FIA",163.98,0,1)
y^y^f^^n^^y^o^n
"FIA",163.98,0,10)

"FIA",163.98,0,11)

"FIA",163.98,0,"RLRO")

"FIA",163.98,0,"VR")
3.5^FB
"FIA",163.98,163.98)
0
"INIT")
EN^FBXIP158
"KRN",.402,362,-1)
0^1
"KRN",.402,362,0)
FBCH ENTER PAYMENT^3160901.1442^^162.5^^^3160610
"KRN",.402,362,"DIAB",1,0,162.5,11)
36.22;REQ
"KRN",.402,362,"DIAB",1,0,162.5,22)
35.72;REQ
"KRN",.402,362,"DIAB",1,0,162.5,24)
36.02;REQ
"KRN",.402,362,"DIAB",1,0,162.5,26)
36.32;REQ
"KRN",.402,362,"DIAB",1,0,162.5,28)
36.62;REQ
"KRN",.402,362,"DIAB",1,0,162.5,30)
36.92;REQ
"KRN",.402,362,"DIAB",2,0,162.5,9)
35.72;REQ
"KRN",.402,362,"DIAB",2,0,162.5,12)
36.52;REQ
"KRN",.402,362,"DIAB",3,0,162.5,5)
31.02;REQ
"KRN",.402,362,"DIAB",3,0,162.5,6)
34.02;REQ
"KRN",.402,362,"DIAB",3,0,162.5,7)
35.22;REQ
"KRN",.402,362,"DIAB",3,0,162.5,10)
36.02;REQ
"KRN",.402,362,"DIAB",3,0,162.5,13)
36.82;REQ
"KRN",.402,362,"DIAB",3,0,162.5,14)
30.02;REQ
"KRN",.402,362,"DIAB",3,0,162.5,16)
33.02;REQ
"KRN",.402,362,"DIAB",4,0,162.5,8)
35.52;REQ
"KRN",.402,362,"DIAB",4,0,162.5,17)
35.02;REQ
"KRN",.402,362,"DIAB",4,0,162.5,19)
35.32;REQ
"KRN",.402,362,"DIAB",4,0,162.5,21)
35.62;REQ
"KRN",.402,362,"DIAB",4,0,162.5,23)
35.92;REQ
"KRN",.402,362,"DIAB",4,0,162.5,25)
36.22;REQ
"KRN",.402,362,"DIAB",4,0,162.5,27)
36.52;REQ
"KRN",.402,362,"DIAB",4,0,162.5,29)
36.82;REQ
"KRN",.402,362,"DIAB",5,0,162.5,11)
36.32;REQ
"KRN",.402,362,"DIAB",5,0,162.5,15)
32.02;REQ
"KRN",.402,362,"DIAB",6,0,162.5,9)
35.82;REQ
"KRN",.402,362,"DIAB",6,0,162.5,12)
36.62;REQ
"KRN",.402,362,"DIAB",6,0,162.5,18)
35.22;REQ
"KRN",.402,362,"DIAB",7,0,162.5,5)
32.02;REQ
"KRN",.402,362,"DIAB",7,0,162.5,6)
35.02;REQ
"KRN",.402,362,"DIAB",7,0,162.5,7)
35.32;REQ
"KRN",.402,362,"DIAB",7,0,162.5,10)
36.12;REQ
"KRN",.402,362,"DIAB",7,0,162.5,13)
36.92;REQ
"KRN",.402,362,"DIAB",7,0,162.5,20)
35.52;REQ
"KRN",.402,362,"DIAB",8,0,162.5,8)
35.62;REQ
"KRN",.402,362,"DIAB",8,0,162.5,22)
35.82;REQ
"KRN",.402,362,"DIAB",8,0,162.5,24)
36.12;REQ
"KRN",.402,362,"DIAB",8,0,162.5,26)
36.42;REQ
"KRN",.402,362,"DIAB",8,0,162.5,28)
36.72;REQ
"KRN",.402,362,"DIAB",9,0,162.5,11)
36.42;REQ
"KRN",.402,362,"DIAB",10,0,162.5,9)
35.92;REQ
"KRN",.402,362,"DIAB",10,0,162.5,12)
36.72;REQ
"KRN",.402,362,"DIAB",10,0,162.5,14)
31.02;REQ
"KRN",.402,362,"DIAB",10,0,162.5,16)
34.02;REQ
"KRN",.402,362,"DIAB",11,0,162.5,4)
30.02;REQ
"KRN",.402,362,"DIAB",11,0,162.5,5)
33.02;REQ
"KRN",.402,362,"DIAB",11,0,162.5,6)
35.12;REQ
"KRN",.402,362,"DIAB",11,0,162.5,7)
35.42;REQ
"KRN",.402,362,"DIAB",11,0,162.5,17)
35.12;REQ
"KRN",.402,362,"DIAB",11,0,162.5,19)
35.42;REQ
"KRN",.402,362,"DR",1,162.5)
1////^S X=FBAAID;46////^S X=FBAAVID;55///^S X=FBCSID;56///^S X=$G(FBFPPSC);85///^S X=$G(FBUCI135);57///^S X=$G(FBFPPSL);47////^S X=FBAAMM1;2////^S X=FBVEN;3////^S X=FBVET;60////^S X=$G(FBCNTRP);87////^S X=$G(FBIA);
"KRN",.402,362,"DR",1,162.5,1)
86////^S X=$G(FBDODINV);4////^S X=FBI7078;5////^S X=FBAABDT;6////^S X=FBAAEDT;23////^S X=FBPSA;21////^S X=FBPOV;22////^S X=FBPT;11////^S X=FBTYPE;12////^S X=FBAAPTC;20////^S X=FBAABE;W !;6.5;54//^S X=$G(FBCDAYS);6.6;I 1;7;
"KRN",.402,362,"DR",1,162.5,2)
S FBAMTC=X;I $G(FBEXMPT)'="Y" S Y="@25";S:FBI7078'["FB583" Y=8;S:'$P($G(^FB583(+FBI7078,0)),U,28) Y=8;W !?2,"**Payment is for emergency treatment under 38 U.S.C. 1725.";8;S FBAMTP=X;I FBAMTC=FBAMTP S Y="@25";
"KRN",.402,362,"DR",1,162.5,3)
S FBX=$$ADJ^FBUTL2(FBAMTC-FBAMTP,.FBADJ,5,,,1,.FBRRMK);@20;I $G(FBEXMPT)="Y" S Y="@25";@26;24;I $$INPICD^FBCSV1(X,$G(DA),FBAABDT) S Y="@26";@25;6.7;I 1;64;65;66;67;68;69;70;71;72;73;80;81;82;83;74;75;
"KRN",.402,362,"DR",1,162.5,4)
S ICDSYS=10,IMPDATE=$$IMPDATE^FBCSV1("10D");S EDATE=ICDVDT;S EDATEH=EDATE;S:EDATE<IMPDATE ICDSYS=9;S:ICDSYS=9 Y="@30";S XSP="ICD";S ICDDATE=EDATE;@120;S XX1=$$ASKICD10^FBASF(XSP,1) S:XX1<0 Y="@120";30////^S X=XX1;30.02R~;@121;
"KRN",.402,362,"DR",1,162.5,5)
S XX2=$$ASKICD10^FBASF(XSP,2) S:XX2<0 Y="@59";31////^S X=XX2;31.02R~;@122;S XX3=$$ASKICD10^FBASF(XSP,3) S:XX3<0 Y="@59";32////^S X=XX3;32.02R~;@123;S XX4=$$ASKICD10^FBASF(XSP,4) S:XX4<0 Y="@59";33////^S X=XX4;33.02R~;@124;
"KRN",.402,362,"DR",1,162.5,6)
S XX5=$$ASKICD10^FBASF(XSP,5) S:XX5<0 Y="@59";34////^S X=XX5;34.02R~;@125;S XX6=$$ASKICD10^FBASF(XSP,6) S:XX6<0 Y="@59";35////^S X=XX6;35.02R~;@126;S XX7=$$ASKICD10^FBASF(XSP,7) S:XX7<0 Y="@59";35.1////^S X=XX7;35.12R~;@127;
"KRN",.402,362,"DR",1,162.5,7)
S XX8=$$ASKICD10^FBASF(XSP,8) S:XX8<0 Y="@59";35.2////^S X=XX8;35.22R~;@128;S XX9=$$ASKICD10^FBASF(XSP,9) S:XX9<0 Y="@59";35.3////^S X=XX9;35.32R~;@129;S XX10=$$ASKICD10^FBASF(XSP,10) S:XX10<0 Y="@59";35.4////^S X=XX10;35.42R~;
"KRN",.402,362,"DR",1,162.5,8)
@130;S XX11=$$ASKICD10^FBASF(XSP,11) S:XX11<0 Y="@59";35.5////^S X=XX11;35.52R~;@131;S XX12=$$ASKICD10^FBASF(XSP,12) S:XX12<0 Y="@59";35.6////^S X=XX12;35.62R~;@132;S XX13=$$ASKICD10^FBASF(XSP,13) S:XX13<0 Y="@59";
"KRN",.402,362,"DR",1,162.5,9)
35.7////^S X=XX13;35.72R~;@133;S XX14=$$ASKICD10^FBASF(XSP,14) S:XX14<0 Y="@59";35.8////^S X=XX14;35.82R~;@134;S XX15=$$ASKICD10^FBASF(XSP,15) S:XX15<0 Y="@59";35.9////^S X=XX15;35.92R~;@135;
"KRN",.402,362,"DR",1,162.5,10)
S XX16=$$ASKICD10^FBASF(XSP,16) S:XX16<0 Y="@59";36////^S X=XX16;36.02R~;@136;S XX17=$$ASKICD10^FBASF(XSP,17) S:XX17<0 Y="@59";36.1////^S X=XX17;36.12R~;@137;S XX18=$$ASKICD10^FBASF(XSP,18) S:XX18<0 Y="@59";36.2////^S X=XX18;
"KRN",.402,362,"DR",1,162.5,11)
36.22R~;@138;S XX19=$$ASKICD10^FBASF(XSP,19) S:XX19<0 Y="@59";36.3////^S X=XX19;36.32R~;@139;S XX20=$$ASKICD10^FBASF(XSP,20) S:XX20<0 Y="@59";36.4////^S X=XX20;36.42R~;@140;S XX21=$$ASKICD10^FBASF(XSP,21) S:XX21<0 Y="@59";
"KRN",.402,362,"DR",1,162.5,12)
36.5////^S X=XX21;36.52R~;@141;S XX22=$$ASKICD10^FBASF(XSP,22) S:XX22<0 Y="@59";36.6////^S X=XX22;36.62R~;@142;S XX23=$$ASKICD10^FBASF(XSP,23) S:XX23<0 Y="@59";36.7////^S X=XX23;36.72R~;@143;
"KRN",.402,362,"DR",1,162.5,13)
S XX24=$$ASKICD10^FBASF(XSP,24) S:XX24<0 Y="@59";36.8////^S X=XX24;36.82R~;@144;S XX25=$$ASKICD10^FBASF(XSP,25) S:XX25<0 Y="@59";36.9////^S X=XX25;36.92R~;S Y="@57";@30;S XSP="ICD1";
"KRN",.402,362,"DR",1,162.5,14)
S XX1=$$ENICD9^FBICD9(EDATE,XSP,"N") S:XX1<0 Y="@30";30////^S X=+XX1;30.02R~;@31;S XSP="ICD2";S XX2=$$ENICD9^FBICD9(EDATE,XSP,"N");I XX2<0,$P(XX2,"^",2)["inactive" S Y="@31";S:XX2<0 Y="@57";31////^S X=+XX2;31.02R~;@32;S XSP="ICD3";
"KRN",.402,362,"DR",1,162.5,15)
S XX3=$$ENICD9^FBICD9(EDATE,XSP,"N");I XX3<0,$P(XX3,"^",2)["inactive" S Y="@32";S:XX3<0 Y="@57";32////^S X=+XX3;32.02R~;@33;S XSP="ICD4";S XX4=$$ENICD9^FBICD9(EDATE,XSP,"N");I XX4<0,$P(XX4,"^",2)["inactive" S Y="@33";
"KRN",.402,362,"DR",1,162.5,16)
S:XX4<0 Y="@57";33////^S X=+XX4;33.02R~;@34;S XSP="ICD5";S XX5=$$ENICD9^FBICD9(EDATE,XSP,"N");I XX5<0,$P(XX5,"^",2)["inactive" S Y="@34";S:XX5<0 Y="@57";34////^S X=+XX5;34.02R~;@35;S XSP="ICD6";S XX6=$$ENICD9^FBICD9(EDATE,XSP,"N");
"KRN",.402,362,"DR",1,162.5,17)
I XX6<0,$P(XX6,"^",2)["inactive" S Y="@35";S:XX6<0 Y="@57";35////^S X=+XX6;35.02R~;@36;S XSP="ICD7";S XX7=$$ENICD9^FBICD9(EDATE,XSP,"N");I XX7<0,$P(XX7,"^",2)["inactive" S Y="@36";S:XX7<0 Y="@57";35.1////^S X=+XX7;35.12R~;@37;
"KRN",.402,362,"DR",1,162.5,18)
S XSP="ICD8";S XX8=$$ENICD9^FBICD9(EDATE,XSP,"N");I XX8<0,$P(XX8,"^",2)["inactive" S Y="@37";S:XX8<0 Y="@57";35.2////^S X=+XX8;35.22R~;@38;S XSP="ICD9";S XX9=$$ENICD9^FBICD9(EDATE,XSP,"N");
"KRN",.402,362,"DR",1,162.5,19)
I XX9<0,$P(XX9,"^",2)["inactive" S Y="@38";S:XX9<0 Y="@57";35.3////^S X=+XX9;35.32R~;@39;S XSP="ICD10";S XX10=$$ENICD9^FBICD9(EDATE,XSP,"N");I XX10<0,$P(XX10,"^",2)["inactive" S Y="@39";S:XX10<0 Y="@57";35.4////^S X=+XX10;35.42R~;
"KRN",.402,362,"DR",1,162.5,20)
@40;S XSP="ICD11";S XX11=$$ENICD9^FBICD9(EDATE,XSP,"N");I XX11<0,$P(XX11,"^",2)["inactive" S Y="@40";S:XX11<0 Y="@57";35.5////^S X=+XX11;35.52R~;@41;S XSP="ICD12";S XX12=$$ENICD9^FBICD9(EDATE,XSP,"N");
"KRN",.402,362,"DR",1,162.5,21)
I XX12<0,$P(XX12,"^",2)["inactive" S Y="@41";S:XX12<0 Y="@57";35.6////^S X=+XX12;35.62R~;@42;S XSP="ICD13";S XX13=$$ENICD9^FBICD9(EDATE,XSP,"N");I XX13<0,$P(XX13,"^",2)["inactive" S Y="@42";S:XX13<0 Y="@57";35.7////^S X=+XX13;
"KRN",.402,362,"DR",1,162.5,22)
35.72R~;@43;S XSP="ICD14";S XX14=$$ENICD9^FBICD9(EDATE,XSP,"N");I XX14<0,$P(XX14,"^",2)["inactive" S Y="@43";S:XX14<0 Y="@57";35.8////^S X=+XX14;35.82R~;@44;S XSP="ICD15";S XX15=$$ENICD9^FBICD9(EDATE,XSP,"N");
"KRN",.402,362,"DR",1,162.5,23)
I XX15<0,$P(XX15,"^",2)["inactive" S Y="@44";S:XX15<0 Y="@57";35.9////^S X=+XX15;35.92R~;@45;S XSP="ICD16";S XX16=$$ENICD9^FBICD9(EDATE,XSP,"N");I XX16<0,$P(XX16,"^",2)["inactive" S Y="@45";S:XX16<0 Y="@57";36////^S X=+XX16;
"KRN",.402,362,"DR",1,162.5,24)
36.02R~;@46;S XSP="ICD17";S XX17=$$ENICD9^FBICD9(EDATE,XSP,"N");I XX17<0,$P(XX17,"^",2)["inactive" S Y="@46";S:XX17<0 Y="@57";36.1////^S X=+XX17;36.12R~;@47;S XSP="ICD18";S XX18=$$ENICD9^FBICD9(EDATE,XSP,"N");
"KRN",.402,362,"DR",1,162.5,25)
I XX18<0,$P(XX18,"^",2)["inactive" S Y="@47";S:XX18<0 Y="@57";36.2////^S X=+XX18;36.22R~;@48;S XSP="ICD19";S XX19=$$ENICD9^FBICD9(EDATE,XSP,"N");I XX19<0,$P(XX19,"^",2)["inactive" S Y="@48";S:XX19<0 Y="@57";36.3////^S X=+XX19;
"KRN",.402,362,"DR",1,162.5,26)
36.32R~;@49;S XSP="ICD20";S XX20=$$ENICD9^FBICD9(EDATE,XSP,"N");I XX20<0,$P(XX20,"^",2)["inactive" S Y="@49";S:XX20<0 Y="@57";36.4////^S X=+XX20;36.42R~;@50;S XSP="ICD21";S XX21=$$ENICD9^FBICD9(EDATE,XSP,"N");
"KRN",.402,362,"DR",1,162.5,27)
I XX21<0,$P(XX21,"^",2)["inactive" S Y="@50";S:XX21<0 Y="@57";36.5////^S X=+XX21;36.52R~;@51;S XSP="ICD22";S XX22=$$ENICD9^FBICD9(EDATE,XSP,"N");I XX22<0,$P(XX22,"^",2)["inactive" S Y="@51";S:XX22<0 Y="@57";36.6////^S X=+XX22;
"KRN",.402,362,"DR",1,162.5,28)
36.62R~;@52;S XSP="ICD23";S XX23=$$ENICD9^FBICD9(EDATE,XSP,"N");I XX23<0,$P(XX23,"^",2)["inactive" S Y="@52";S:XX23<0 Y="@57";36.7////^S X=+XX23;36.72R~;@53;S XSP="ICD24";S XX24=$$ENICD9^FBICD9(EDATE,XSP,"N");
"KRN",.402,362,"DR",1,162.5,29)
I XX24<0,$P(XX24,"^",2)["inactive" S Y="@53";S:XX24<0 Y="@57";36.8////^S X=+XX24;36.82R~;@54;S XSP="ICD25";S XX25=$$ENICD9^FBICD9(EDATE,XSP,"N");I XX25<0,$P(XX25,"^",2)["inactive" S Y="@54";S:XX25<0 Y="@57";36.9////^S X=+XX25;
"KRN",.402,362,"DR",1,162.5,30)
36.92R~;@57;S EDATE=$$FRDTINV^FBCSV1(DA);I EDATE<$$IMPDATE^FBCSV1("10D") S Y="@58";S EDATE=EDATEH,Y="@59";@58;S XSP="ADMITTING DIAGNOSIS";S XXAD=$$ENICD9^FBICD9(EDATE,XSP,"N") S:XXAD<0 Y="@58";39////^S X=+XXAD;S EDATE=EDATEH;
"KRN",.402,362,"DR",1,162.5,31)
S Y="@60";@59;S XAD=-1 S XAD=$$ASKICD10^FBASF("ADMITTING DIAGNOSIS","");S:XAD<0 Y="@59";39////^S X=XAD;@60;S XSP="PROC1";S XX1=$$ENICD9^FBICDP(EDATE,XSP);I XX1<0,$P(XX1,"^",2)["inactive" S Y="@60";S:XX1<0 Y="@99";40////^S X=+XX1;
"KRN",.402,362,"DR",1,162.5,32)
@61;S XSP="PROC2";S XX2=$$ENICD9^FBICDP(EDATE,XSP);I XX2<0,$P(XX2,"^",2)["inactive" S Y="@61";S:XX2<0 Y="@99";41////^S X=+XX2;@62;S XSP="PROC3";S XX3=$$ENICD9^FBICDP(EDATE,XSP);I XX3<0,$P(XX3,"^",2)["inactive" S Y="@62";
"KRN",.402,362,"DR",1,162.5,33)
S:XX3<0 Y="@99";42////^S X=+XX3;@63;S XSP="PROC4";S XX4=$$ENICD9^FBICDP(EDATE,XSP);I XX4<0,$P(XX4,"^",2)["inactive" S Y="@63";S:XX4<0 Y="@99";43////^S X=+XX4;@64;S XSP="PROC5";S XX5=$$ENICD9^FBICDP(EDATE,XSP);
"KRN",.402,362,"DR",1,162.5,34)
I XX5<0,$P(XX5,"^",2)["inactive" S Y="@64";S:XX5<0 Y="@99";44////^S X=+XX5;@65;S XSP="PROC6";S XX6=$$ENICD9^FBICDP(EDATE,XSP);I XX6<0,$P(XX6,"^",2)["inactive" S Y="@65";S:XX6<0 Y="@99";44.06////^S X=+XX6;@66;S XSP="PROC7";
"KRN",.402,362,"DR",1,162.5,35)
S XX7=$$ENICD9^FBICDP(EDATE,XSP);I XX7<0,$P(XX7,"^",2)["inactive" S Y="@66";S:XX7<0 Y="@99";44.07////^S X=+XX7;@67;S XSP="PROC8";S XX8=$$ENICD9^FBICDP(EDATE,XSP);I XX8<0,$P(XX8,"^",2)["inactive" S Y="@67";S:XX8<0 Y="@99";
"KRN",.402,362,"DR",1,162.5,36)
44.08////^S X=+XX8;@68;S XSP="PROC9";S XX9=$$ENICD9^FBICDP(EDATE,XSP);I XX9<0,$P(XX9,"^",2)["inactive" S Y="@68";S:XX9<0 Y="@99";44.09////^S X=+XX9;@69;S XSP="PROC10";S XX10=$$ENICD9^FBICDP(EDATE,XSP);
"KRN",.402,362,"DR",1,162.5,37)
I XX10<0,$P(XX10,"^",2)["inactive" S Y="@69";S:XX10<0 Y="@99";44.1////^S X=+XX10;@70;S XSP="PROC11";S XX11=$$ENICD9^FBICDP(EDATE,XSP);I XX11<0,$P(XX11,"^",2)["inactive" S Y="@70";S:XX11<0 Y="@99";44.11////^S X=+XX11;@71;
"KRN",.402,362,"DR",1,162.5,38)
S XSP="PROC12";S XX12=$$ENICD9^FBICDP(EDATE,XSP);I XX12<0,$P(XX12,"^",2)["inactive" S Y="@71";S:XX12<0 Y="@99";44.12////^S X=+XX12;@72;S XSP="PROC13";S XX13=$$ENICD9^FBICDP(EDATE,XSP);I XX13<0,$P(XX13,"^",2)["inactive" S Y="@72";
"KRN",.402,362,"DR",1,162.5,39)
S:XX13<0 Y="@99";44.13////^S X=+XX13;@73;S XSP="PROC14";S XX14=$$ENICD9^FBICDP(EDATE,XSP);I XX14<0,$P(XX14,"^",2)["inactive" S Y="@73";S:XX14<0 Y="@99";44.14////^S X=+XX14;@74;S XSP="PROC15";S XX15=$$ENICD9^FBICDP(EDATE,XSP);
"KRN",.402,362,"DR",1,162.5,40)
I XX15<0,$P(XX15,"^",2)["inactive" S Y="@74";S:XX15<0 Y="@99";44.15////^S X=+XX15;@75;S XSP="PROC16";S XX16=$$ENICD9^FBICDP(EDATE,XSP);I XX16<0,$P(XX16,"^",2)["inactive" S Y="@75";S:XX16<0 Y="@99";44.16////^S X=+XX16;@76;
"KRN",.402,362,"DR",1,162.5,41)
S XSP="PROC17";S XX17=$$ENICD9^FBICDP(EDATE,XSP);I XX17<0,$P(XX17,"^",2)["inactive" S Y="@76";S:XX17<0 Y="@99";44.17////^S X=+XX17;@77;S XSP="PROC18";S XX18=$$ENICD9^FBICDP(EDATE,XSP);I XX18<0,$P(XX18,"^",2)["inactive" S Y="@77";
"KRN",.402,362,"DR",1,162.5,42)
S:XX18<0 Y="@99";44.18////^S X=+XX18;@78;S XSP="PROC19";S XX19=$$ENICD9^FBICDP(EDATE,XSP);I XX19<0,$P(XX19,"^",2)["inactive" S Y="@78";S:XX19<0 Y="@99";44.19////^S X=+XX19;@79;S XSP="PROC20";S XX20=$$ENICD9^FBICDP(EDATE,XSP);
"KRN",.402,362,"DR",1,162.5,43)
I XX20<0,$P(XX20,"^",2)["inactive" S Y="@79";S:XX20<0 Y="@99";44.2////^S X=+XX20;@80;S XSP="PROC21";S XX21=$$ENICD9^FBICDP(EDATE,XSP);I XX21<0,$P(XX21,"^",2)["inactive" S Y="@80";S:XX21<0 Y="@99";44.21////^S X=+XX21;@81;
"KRN",.402,362,"DR",1,162.5,44)
S XSP="PROC22";S XX22=$$ENICD9^FBICDP(EDATE,XSP);I XX22<0,$P(XX22,"^",2)["inactive" S Y="@81";S:XX22<0 Y="@99";44.22////^S X=+XX22;@82;S XSP="PROC23";S XX23=$$ENICD9^FBICDP(EDATE,XSP);I XX23<0,$P(XX23,"^",2)["inactive" S Y="@82";
"KRN",.402,362,"DR",1,162.5,45)
S:XX23<0 Y="@99";44.23////^S X=+XX23;@83;S XSP="PROC24";S XX24=$$ENICD9^FBICDP(EDATE,XSP);I XX24<0,$P(XX24,"^",2)["inactive" S Y="@83";S:XX24<0 Y="@99";44.24////^S X=+XX24;@84;S XSP="PROC25";S XX25=$$ENICD9^FBICDP(EDATE,XSP);
"KRN",.402,362,"DR",1,162.5,46)
I XX25<0,$P(XX25,"^",2)["inactive" S Y="@84";S:XX25<0 Y="@99";44.25////^S X=+XX25;@99;I $D(^FBAAI(DA,"DX")),$P(^("DX"),U)="" W !!,*7,"The 'ICD1' field is a mandatory field!",! S Y="@30";S FBX=$$RPROV^FBUTL8(.FBPROV,.FBPROVD);
"KRN",.402,362,"DR",1,162.5,47)
I $G(FBEXMPT)'="Y" S Y="@992";S FBX=$$CLESSR^FBUTL4A(.FBADJ,5,.FBRRMK);@992;25////^S X=FBRESUB;@999;
"KRN",.402,363,-1)
0^3
"KRN",.402,363,0)
FBCH EDIT PAYMENT^3160901.1457^^162.5^^^3160617
"KRN",.402,363,"DIAB",1,0,162.5,19)
35.42;REQ
"KRN",.402,363,"DIAB",2,0,162.5,5)
24.5;REQ
"KRN",.402,363,"DIAB",2,0,162.5,22)
35.62;REQ
"KRN",.402,363,"DIAB",2,0,162.5,25)
35.82;REQ
"KRN",.402,363,"DIAB",2,0,162.5,28)
36.02;REQ
"KRN",.402,363,"DIAB",2,0,162.5,31)
36.22;REQ
"KRN",.402,363,"DIAB",2,0,162.5,34)
36.42;REQ
"KRN",.402,363,"DIAB",2,0,162.5,37)
36.62;REQ
"KRN",.402,363,"DIAB",2,0,162.5,40)
36.82;REQ
"KRN",.402,363,"DIAB",3,0,162.5,9)
32.02;REQ
"KRN",.402,363,"DIAB",3,0,162.5,16)
35.22;REQ
"KRN",.402,363,"DIAB",3,0,162.5,43)
30.02;REQ
"KRN",.402,363,"DIAB",4,0,162.5,45)
33.02;REQ
"KRN",.402,363,"DIAB",4,0,162.5,46)
34.02;REQ
"KRN",.402,363,"DIAB",4,0,162.5,47)
35.02;REQ
"KRN",.402,363,"DIAB",4,0,162.5,48)
35.12;REQ
"KRN",.402,363,"DIAB",4,0,162.5,49)
35.22;REQ
"KRN",.402,363,"DIAB",4,0,162.5,50)
35.32;REQ
"KRN",.402,363,"DIAB",4,0,162.5,51)
35.42;REQ
"KRN",.402,363,"DIAB",4,0,162.5,52)
35.52;REQ
"KRN",.402,363,"DIAB",4,0,162.5,53)
35.62;REQ
"KRN",.402,363,"DIAB",4,0,162.5,54)
35.72;REQ
"KRN",.402,363,"DIAB",4,0,162.5,55)
35.82;REQ
"KRN",.402,363,"DIAB",4,0,162.5,56)
35.92;REQ
"KRN",.402,363,"DIAB",4,0,162.5,57)
36.02;REQ
"KRN",.402,363,"DIAB",4,0,162.5,58)
36.12;REQ
"KRN",.402,363,"DIAB",4,0,162.5,59)
36.22;REQ
"KRN",.402,363,"DIAB",4,0,162.5,60)
36.32;REQ
"KRN",.402,363,"DIAB",4,0,162.5,61)
36.42;REQ
"KRN",.402,363,"DIAB",4,0,162.5,62)
36.52;REQ
"KRN",.402,363,"DIAB",4,0,162.5,63)
36.62;REQ
"KRN",.402,363,"DIAB",4,0,162.5,64)
36.72;REQ
"KRN",.402,363,"DIAB",4,0,162.5,65)
36.82;REQ
"KRN",.402,363,"DIAB",4,0,162.5,66)
36.92;REQ
"KRN",.402,363,"DIAB",5,0,162.5,6)
30.02;REQ
"KRN",.402,363,"DIAB",5,0,162.5,13)
35.02;REQ
"KRN",.402,363,"DIAB",6,0,162.5,10)
33.02;REQ
"KRN",.402,363,"DIAB",6,0,162.5,17)
35.32;REQ
"KRN",.402,363,"DIAB",6,0,162.5,20)
35.52;REQ
"KRN",.402,363,"DIAB",6,0,162.5,23)
35.72;REQ
"KRN",.402,363,"DIAB",6,0,162.5,26)
35.92;REQ
"KRN",.402,363,"DIAB",6,0,162.5,29)
36.12;REQ
"KRN",.402,363,"DIAB",6,0,162.5,32)
36.32;REQ
"KRN",.402,363,"DIAB",6,0,162.5,35)
36.52;REQ
"KRN",.402,363,"DIAB",6,0,162.5,38)
36.72;REQ
"KRN",.402,363,"DIAB",6,0,162.5,41)
36.92;REQ
"KRN",.402,363,"DIAB",6,0,162.5,44)
32.02;REQ
"KRN",.402,363,"DIAB",7,0,162.5,7)
31.02;REQ
"KRN",.402,363,"DIAB",7,0,162.5,14)
35.12;REQ
"KRN",.402,363,"DIAB",8,0,162.5,11)
34.02;REQ
"KRN",.402,363,"DIAB",8,0,162.5,43)
31.02;REQ
"KRN",.402,363,"DIAB",10,0,162.5,4)
24;REQ
"KRN",.402,363,"DR",1,162.5)
@1;1;I 1;I $$BADDATE^FBCHEP1(X,DA) S Y="@1";46;I '$$IPACREQD^FBAAMP($P($G(^FBAAI(DA,0)),U,3)) S Y="@123";87////^S X=$G(FBIA);86////^S X=$G(FBDODINV);@123;55;S FBX=$$FPPSC^FBUTL5(1,FBFPPSC);D EDINPAT^FBUTL136($G(FBX),$G(FBI));
"KRN",.402,363,"DR",1,162.5,1)
S:FBX=-1 Y=0;S:FBX="" Y="@10";56///^S X=FBX;S FBFPPSC=X;S FBX=$$FPPSL^FBUTL5(FBFPPSL,1);S:FBX=-1 Y=0;57///^S X=FBX;S FBFPPSL=X;S Y="@14";@10;56///@;S FBFPPSC="";57///@;S FBFPPSL="";@14;S FBV=$P($G(^FBAAI(DA,0)),U,3);
"KRN",.402,363,"DR",1,162.5,2)
S FBAAMM=$S($G(FBAAPTC)="R":"",$D(FB583):"",1:1);D PPT^FBAACO1($G(FBAAMM1),$G(FBCNTRP));47////@;47///^S X=FBAAMM1;60///@;60////^S X=$G(FBCNTRP);6.5;54;6.6;I 1;6.7;64;65;66;67;68;69;70;71;72;73;80;81;82;83;74;75;
"KRN",.402,363,"DR",1,162.5,3)
S DIE("NO^")="NO QUIT";7;S:$D(FBPRICE) Y="@19";S FBJJ=X;I $G(FBEXMPT)="Y" S Y="@16";26;S FBPAMT=X;@16;W:FB1725 !?2,"**Payment is for emergency treatment under 38 U.S.C. 1725.";
"KRN",.402,363,"DR",1,162.5,4)
W:FB1725&($G(FBPAMT)>0) !?2,"  70% of Pricer Amount = "_$J(.7*FBPAMT,0,2);8;S FBKK=X;K FBADJD;M FBADJD=FBADJ;S FBX=$$ADJ^FBUTL2(FBJJ-FBKK,.FBADJ,5,,.FBADJD,1,.FBRRMK);K FBADJD;I $G(FBEXMPT)="Y" S Y="@19";@18;24R~;
"KRN",.402,363,"DR",1,162.5,5)
I $$INPICD^FBCSV1(X,$G(DA)) S Y="@18";24.5R~;@19;S ICDSYS=10,IMPDATE=$$IMPDATE^FBCSV1("10D");S EDATE=ICDVDT;S:EDATE<IMPDATE ICDSYS=9;S EDATEH=EDATE;S:ICDSYS=10 Y="@210";@20;S XXE1=$P($G(^FBAAI(DA,"DX")),"^",1);S XSP="ICD1";
"KRN",.402,363,"DR",1,162.5,6)
S XX1=$$ENICD9^FBICD9(EDATE,XSP,"N","N","Y",XXE1);I XX1<0,$P(XX1,"^",2)["inactive" S Y="@20";S:XX1<0 XX1=XXE1;30////^S X=+XX1;30.02R~;@22;S XSP="ICD2";S XXE2=$P($G(^FBAAI(DA,"DX")),"^",2);
"KRN",.402,363,"DR",1,162.5,7)
S XX2=$$ENICD9^FBICD9(EDATE,XSP,"N","Y","N",XXE2);I XX2<0,$P(XX2,"^",2)["inactive" S Y="@22";I XX2<0,XXE2'?1N.N S Y="@70";S:XX2<0 XX2=XXE2;31////^S X=+XX2;I XX2="@" S Y="@23";31.02R~;S:$G(LASTDX)<2 LASTDX=2;S Y="@24";@23;31.02///@;
"KRN",.402,363,"DR",1,162.5,8)
S:$G(LASTDX)'>2 Y="@70";@24;S XSP="ICD3";S XXE3=$P($G(^FBAAI(DA,"DX")),"^",3);S XX3=$$ENICD9^FBICD9(EDATE,XSP,"N","Y","N",XXE3);I XX3<0,$P(XX3,"^",2)["inactive" S Y="@24";I XX3<0,XXE3'?1N.N S Y="@70";I XX3<0 S XX3=XXE3;
"KRN",.402,363,"DR",1,162.5,9)
32////^S X=+XX3;I XX3="@" S Y="@25";32.02R~;S:$G(LASTDX)<3 LASTDX=3;S Y="@26";@25;32.02///@;S:$G(LASTDX)'>3 Y="@70";@26;S XSP="ICD4";S XXE4=$P($G(^FBAAI(DA,"DX")),"^",4);S XX4=$$ENICD9^FBICD9(EDATE,XSP,"N","Y","N",XXE4);
"KRN",.402,363,"DR",1,162.5,10)
I XX4<0,$P(XX4,"^",2)["inactive" S Y="@26";I XX4<0,XXE4'?1N.N S Y="@70";S:XX4<0 XX4=XXE4;33////^S X=+XX4;I XX4="@" S Y="@27";33.02R~;S:$G(LASTDX)<4 LASTDX=4;S Y="@28";@27;33.02///@;S:$G(LASTDX)'>4 Y="@70";@28;S XSP="ICD5";
"KRN",.402,363,"DR",1,162.5,11)
S XXE5=$P($G(^FBAAI(DA,"DX")),"^",5);S XX5=$$ENICD9^FBICD9(EDATE,XSP,"N","Y","N",XXE5);I XX5<0,$P(XX5,"^",2)["inactive" S Y="@28";I XX5<0,XXE5'?1N.N S Y="@70";S:XX5<0 XX5=XXE5;34////^S X=+XX5;I XX5="@" S Y="@29";34.02R~;
"KRN",.402,363,"DR",1,162.5,12)
S:$G(LASTDX)<5 LASTDX=5;S Y="@30";@29;34.02///@;S:$G(LASTDX)'>5 Y="@70";@30;S XSP="ICD6";S XXE6=$P($G(^FBAAI(DA,"DX")),"^",6);S XX6=$$ENICD9^FBICD9(EDATE,XSP,"N","Y","N",XXE6);I XX6<0,$P(XX6,"^",2)["inactive" S Y="@30";
"KRN",.402,363,"DR",1,162.5,13)
I XX6<0,XXE6'?1N.N S Y="@70";S:XX6<0 XX6=XXE6;35////^S X=+XX6;I XX6="@" S Y="@31";35.02R~;S:$G(LASTDX)<6 LASTDX=6;S Y="@32";@31;35.02///@;S:$G(LASTDX)'>6 Y="@70";@32;S XSP="ICD7";S XXE7=$P($G(^FBAAI(DA,"DX")),"^",7);
"KRN",.402,363,"DR",1,162.5,14)
S XX7=$$ENICD9^FBICD9(EDATE,XSP,"N","Y","N",XXE7);I XX7<0,$P(XX7,"^",2)["inactive" S Y="@32";I XX7<0,XXE7'?1N.N S Y="@70";S:XX7<0 XX7=XXE7;35.1////^S X=+XX7;I XX7="@" S Y="@33";35.12R~;S:$G(LASTDX)<7 LASTDX=7;S Y="@34";@33;
"KRN",.402,363,"DR",1,162.5,15)
35.12///@;S:$G(LASTDX)'>7 Y="@70";@34;S XSP="ICD8";S XXE8=$P($G(^FBAAI(DA,"DX")),"^",8);S XX8=$$ENICD9^FBICD9(EDATE,XSP,"N","Y","N",XXE8);I XX8<0,$P(XX8,"^",2)["inactive" S Y="@34";I XX8<0,XXE8'?1N.N S Y="@70";S:XX8<0 XX8=XXE8;
"KRN",.402,363,"DR",1,162.5,16)
35.2////^S X=+XX8;I XX8="@" S Y="@35";35.22R~;S:$G(LASTDX)<8 LASTDX=8;S Y="@36";@35;35.22///@;S:$G(LASTDX)'>8 Y="@70";@36;S XSP="ICD9";S XXE9=$P($G(^FBAAI(DA,"DX")),"^",9);S XX9=$$ENICD9^FBICD9(EDATE,XSP,"N","Y","N",XXE9);
"KRN",.402,363,"DR",1,162.5,17)
I XX9<0,$P(XX9,"^",2)["inactive" S Y="@36";I XX9<0,XXE9'?1N.N S Y="@70";S:XX9<0 XX9=XXE9;35.3////^S X=+XX9;I XX9="@" S Y="@37";35.32R~;S:$G(LASTDX)<9 LASTDX=9;S Y="@38";@37;35.32///@;S:$G(LASTDX)'>9 Y="@70";@38;S XSP="ICD10";
"KRN",.402,363,"DR",1,162.5,18)
S XXE10=$P($G(^FBAAI(DA,"DX")),"^",10);S XX10=$$ENICD9^FBICD9(EDATE,XSP,"N","Y","N",XXE10);I XX10<0,$P(XX10,"^",2)["inactive" S Y="@38";I XX10<0,XXE10'?1N.N S Y="@70";S:XX10<0 XX10=XXE10;35.4////^S X=+XX10;I XX10="@" S Y="@39";
"KRN",.402,363,"DR",1,162.5,19)
35.42R~;S:$G(LASTDX)<10 LASTDX=10;S Y="@40";@39;35.42///@;S:$G(LASTDX)'>10 Y="@70";@40;S XSP="ICD11";S XXE11=$P($G(^FBAAI(DA,"DX")),"^",11);S XX11=$$ENICD9^FBICD9(EDATE,XSP,"N","Y","N",XXE11);
"KRN",.402,363,"DR",1,162.5,20)
I XX11<0,$P(XX11,"^",2)["inactive" S Y="@40";I XX11<0,XXE11'?1N.N S Y="@70";S:XX11<0 XX11=XXE11;35.5////^S X=+XX11;I XX11="@" S Y="@41";35.52R~;S:$G(LASTDX)<11 LASTDX=11;S Y="@42";@41;35.52///@;S:$G(LASTDX)'>11 Y="@70";@42;
"KRN",.402,363,"DR",1,162.5,21)
S XSP="ICD12";S XXE12=$P($G(^FBAAI(DA,"DX")),"^",12);S XX12=$$ENICD9^FBICD9(EDATE,XSP,"N","Y","N",XXE12);I XX12<0,$P(XX12,"^",2)["inactive" S Y="@42";I XX12<0,XXE12'?1N.N S Y="@70";S:XX12<0 XX12=XXE12;35.6////^S X=+XX12;
"KRN",.402,363,"DR",1,162.5,22)
I XX12="@" S Y="@43";35.62R~;S:$G(LASTDX)<12 LASTDX=12;S Y="@44";@43;35.62///@;S:$G(LASTDX)'>12 Y="@70";@44;S XSP="ICD13";S XXE13=$P($G(^FBAAI(DA,"DX")),"^",13);S XX13=$$ENICD9^FBICD9(EDATE,XSP,"N","Y","N",XXE13);
"KRN",.402,363,"DR",1,162.5,23)
I XX13<0,$P(XX13,"^",2)["inactive" S Y="@44";I XX13<0,XXE13'?1N.N S Y="@70";S:XX13<0 XX13=XXE13;35.7////^S X=+XX13;I XX13="@" S Y="@45";35.72R~;S:$G(LASTDX)<13 LASTDX=13;S Y="@46";@45;35.72///@;S:$G(LASTDX)'>13 Y="@70";@46;
"KRN",.402,363,"DR",1,162.5,24)
S XSP="ICD14";S XXE14=$P($G(^FBAAI(DA,"DX")),"^",14);S XX14=$$ENICD9^FBICD9(EDATE,XSP,"N","Y","N",XXE14);I XX14<0,$P(XX14,"^",2)["inactive" S Y="@46";I XX14<0,XXE14'?1N.N S Y="@70";S:XX14<0 XX14=XXE14;35.8////^S X=+XX14;
"KRN",.402,363,"DR",1,162.5,25)
I XX14="@" S Y="@47";35.82R~;S:$G(LASTDX)<14 LASTDX=14;S Y="@48";@47;35.82///@;S:$G(LASTDX)'>14 Y="@70";@48;S XSP="ICD15";S XXE15=$P($G(^FBAAI(DA,"DX")),"^",15);S XX15=$$ENICD9^FBICD9(EDATE,XSP,"N","Y","N",XXE15);
"KRN",.402,363,"DR",1,162.5,26)
I XX15<0,$P(XX15,"^",2)["inactive" S Y="@48";I XX15<0,XXE15'?1N.N S Y="@70";S:XX15<0 XX15=XXE15;35.9////^S X=+XX15;I XX15="@" S Y="@49";35.92R~;S:$G(LASTDX)<15 LASTDX=15;S Y="@50";@49;35.92///@;S:$G(LASTDX)'>15 Y="@70";@50;
"KRN",.402,363,"DR",1,162.5,27)
S XSP="ICD16";S XXE16=$P($G(^FBAAI(DA,"DX")),"^",16);S XX16=$$ENICD9^FBICD9(EDATE,XSP,"N","Y","N",XXE16);I XX16<0,$P(XX16,"^",2)["inactive" S Y="@50";I XX16<0,XXE16'?1N.N S Y="@70";S:XX16<0 XX16=XXE16;36////^S X=+XX16;
"KRN",.402,363,"DR",1,162.5,28)
I XX16="@" S Y="@51";36.02R~;S:$G(LASTDX)<16 LASTDX=16;S Y="@52";@51;36.02///@;S:$G(LASTDX)'>16 Y="@70";@52;S XSP="ICD17";S XXE17=$P($G(^FBAAI(DA,"DX")),"^",17);S XX17=$$ENICD9^FBICD9(EDATE,XSP,"N","Y","N",XXE17);
"KRN",.402,363,"DR",1,162.5,29)
I XX17<0,$P(XX17,"^",2)["inactive" S Y="@52";I XX17<0,XXE17'?1N.N S Y="@70";S:XX17<0 XX17=XXE17;36.1////^S X=+XX17;I XX17="@" S Y="@53";36.12R~;S:$G(LASTDX)<17 LASTDX=17;S Y="@54";@53;36.12///@;S:$G(LASTDX)'>17 Y="@70";@54;
"KRN",.402,363,"DR",1,162.5,30)
S XSP="ICD18";S XXE18=$P($G(^FBAAI(DA,"DX")),"^",18);S XX18=$$ENICD9^FBICD9(EDATE,XSP,"N","Y","N",XXE18);I XX18<0,$P(XX18,"^",2)["inactive" S Y="@54";I XX18<0,XXE18'?1N.N S Y="@70";S:XX18<0 XX18=XXE18;36.2////^S X=+XX18;
"KRN",.402,363,"DR",1,162.5,31)
I XX18="@" S Y="@55";36.22R~;S:$G(LASTDX)<18 LASTDX=18;S Y="@56";@55;36.22///@;S:$G(LASTDX)'>18 Y="@70";@56;S XSP="ICD19";S XXE19=$P($G(^FBAAI(DA,"DX")),"^",19);S XX19=$$ENICD9^FBICD9(EDATE,XSP,"N","Y","N",XXE19);
"KRN",.402,363,"DR",1,162.5,32)
I XX19<0,$P(XX19,"^",2)["inactive" S Y="@56";I XX19<0,XXE19'?1N.N S Y="@70";S:XX19<0 XX19=XXE19;36.3////^S X=+XX19;I XX19="@" S Y="@57";36.32R~;S:$G(LASTDX)<19 LASTDX=19;S Y="@58";@57;36.32///@;S:$G(LASTDX)'>19 Y="@70";@58;
"KRN",.402,363,"DR",1,162.5,33)
S XSP="ICD20";S XXE20=$P($G(^FBAAI(DA,"DX")),"^",20);S XX20=$$ENICD9^FBICD9(EDATE,XSP,"N","Y","N",XXE20);I XX20<0,$P(XX20,"^",2)["inactive" S Y="@58";I XX20<0,XXE20'?1N.N S Y="@70";S:XX20<0 XX20=XXE20;36.4////^S X=+XX20;
"KRN",.402,363,"DR",1,162.5,34)
I XX20="@" S Y="@59";36.42R~;S:$G(LASTDX)<20 LASTDX=20;S Y="@60";@59;36.42///@;S:$G(LASTDX)'>20 Y="@70";@60;S XSP="ICD21";S XXE21=$P($G(^FBAAI(DA,"DX")),"^",21);S XX21=$$ENICD9^FBICD9(EDATE,XSP,"N","Y","N",XXE21);
"KRN",.402,363,"DR",1,162.5,35)
I XX21<0,$P(XX21,"^",2)["inactive" S Y="@60";I XX21<0,XXE21'?1N.N S Y="@70";S:XX21<0 XX21=XXE21;36.5////^S X=+XX21;I XX21="@" S Y="@61";36.52R~;S:$G(LASTDX)<21 LASTDX=21;S Y="@62";@61;36.52///@;S:$G(LASTDX)'>21 Y="@70";@62;
"KRN",.402,363,"DR",1,162.5,36)
S XSP="ICD22";S XXE22=$P($G(^FBAAI(DA,"DX")),"^",22);S XX22=$$ENICD9^FBICD9(EDATE,XSP,"N","Y","N",XXE22);I XX22<0,$P(XX22,"^",2)["inactive" S Y="@62";I XX22<0,XXE22'?1N.N S Y="@70";S:XX22<0 XX22=XXE22;36.6////^S X=+XX22;
"KRN",.402,363,"DR",1,162.5,37)
I XX22="@" S Y="@63";36.62R~;S:$G(LASTDX)<22 LASTDX=22;S Y="@64";@63;36.62///@;S:$G(LASTDX)'>22 Y="@70";@64;S XSP="ICD23";S XXE23=$P($G(^FBAAI(DA,"DX")),"^",23);S XX23=$$ENICD9^FBICD9(EDATE,XSP,"N","Y","N",XXE23);
"KRN",.402,363,"DR",1,162.5,38)
I XX23<0,$P(XX23,"^",2)["inactive" S Y="@64";I XX23<0,XXE23'?1N.N S Y="@70";S:XX23<0 XX23=XXE23;36.7////^S X=+XX23;I XX23="@" S Y="@65";36.72R~;S:$G(LASTDX)<23 LASTDX=23;S Y="@66";@65;36.72///@;S:$G(LASTDX)'>23 Y="@70";@66;
"KRN",.402,363,"DR",1,162.5,39)
S XSP="ICD24";S XXE24=$P($G(^FBAAI(DA,"DX")),"^",24);S XX24=$$ENICD9^FBICD9(EDATE,XSP,"N","Y","N",XXE24);I XX24<0,$P(XX24,"^",2)["inactive" S Y="@66";I XX24<0,XXE24'?1N.N S Y="@70";S:XX24<0 XX24=XXE24;36.8////^S X=+XX24;
"KRN",.402,363,"DR",1,162.5,40)
I XX24="@" S Y="@67";36.82R~;S:$G(LASTDX)<24 LASTDX=24;S Y="@68";@67;36.82///@;S:$G(LASTDX)'>24 Y="@70";@68;S XSP="ICD25";S XXE25=$P($G(^FBAAI(DA,"DX")),"^",25);S XX25=$$ENICD9^FBICD9(EDATE,XSP,"N","Y","N",XXE25);
"KRN",.402,363,"DR",1,162.5,41)
I XX25<0,$P(XX25,"^",2)["inactive" S Y="@68";I XX25<0,XXE25'?1N.N S Y="@70";S:XX25<0 XX25=XXE25;36.9////^S X=+XX25;I XX25="@" S Y="@69";36.92R~;S:$G(LASTDX)<25 LASTDX=25;S Y="@70";@69;36.92///@;@70;S XSP="ADMITTING DIAGNOSIS";
"KRN",.402,363,"DR",1,162.5,42)
S XXEAD=$P($G(^FBAAI(DA,5)),"^",9);S XXAD=$$ENICD9^FBICD9(EDATE,XSP,"N","N","Y",XXEAD);I XXAD<0,$P(XXAD,"^",2)["inactive" S Y="@70";I XXAD<0,XXEAD'?1N.N S Y="@70";S:XXAD<0 XXAD=XXEAD;39////^S X=+XXAD;S Y="@320";@210;S XSP="ICD";
"KRN",.402,363,"DR",1,162.5,43)
S XX1=$$ASKICD10^FBASF(XSP,1) S:XX1<0 Y="@210";30////^S X=XX1;30.02R~;@211;S XX2=$$ASKICD10^FBASF(XSP,2,"","Y") S:XX2<0 Y="@300";31////^S X=XX2;I XX2="@" S Y="@212";31.02R~;S:$G(LASTDX)<2 LASTDX=2;S Y="@213";@212;31.02///@;
"KRN",.402,363,"DR",1,162.5,44)
S:$G(LASTDX)'>2 Y="@300";@213;S XX3=$$ASKICD10^FBASF(XSP,3,"","Y") S:XX3<0 Y="@300";32////^S X=XX3;I XX3="@" S Y="@214";32.02R~;S:$G(LASTDX)<3 LASTDX=3;S Y="@215";@214;32.02///@;S:$G(LASTDX)'>3 Y="@300";@215;
"KRN",.402,363,"DR",1,162.5,45)
S XX4=$$ASKICD10^FBASF(XSP,4,"","Y") S:XX4<0 Y="@300";33////^S X=XX4;I XX4="@" S Y="@216";33.02R~;S:$G(LASTDX)<4 LASTDX=4;S Y="@217";@216;33.02///@;S:$G(LASTDX)'>4 Y="@300";@217;
"KRN",.402,363,"DR",1,162.5,46)
S XX5=$$ASKICD10^FBASF(XSP,5,"","Y") S:XX5<0 Y="@300";34////^S X=XX5;I XX5="@" S Y="@218";34.02R~;S:$G(LASTDX)<5 LASTDX=5;S Y="@219";@218;34.02///@;S:$G(LASTDX)'>5 Y="@300";@219;
"KRN",.402,363,"DR",1,162.5,47)
S XX6=$$ASKICD10^FBASF(XSP,6,"","Y") S:XX6<0 Y="@300";35////^S X=XX6;I XX6="@" S Y="@220";35.02R~;S:$G(LASTDX)<6 LASTDX=6;S Y="@221";@220;35.02///@;S:$G(LASTDX)'>6 Y="@300";@221;
"KRN",.402,363,"DR",1,162.5,48)
S XX7=$$ASKICD10^FBASF(XSP,7,"","Y") S:XX7<0 Y="@300";35.1////^S X=XX7;I XX7="@" S Y="@222";35.12R~;S:$G(LASTDX)<7 LASTDX=7;S Y="@223";@222;35.12///@;S:$G(LASTDX)'>7 Y="@300";@223;
"KRN",.402,363,"DR",1,162.5,49)
S XX8=$$ASKICD10^FBASF(XSP,8,"","Y") S:XX8<0 Y="@300";35.2////^S X=XX8;I XX8="@" S Y="@224";35.22R~;S:$G(LASTDX)<8 LASTDX=8;S Y="@225";@224;35.22///@;S:$G(LASTDX)'>8 Y="@300";@225;
"KRN",.402,363,"DR",1,162.5,50)
S XX9=$$ASKICD10^FBASF(XSP,9,"","Y") S:XX9<0 Y="@300";35.3////^S X=XX9;I XX9="@" S Y="@226";35.32R~;S:$G(LASTDX)<9 LASTDX=9;S Y="@227";@226;35.32///@;S:$G(LASTDX)'>9 Y="@300";@227;
"KRN",.402,363,"DR",1,162.5,51)
S XX10=$$ASKICD10^FBASF(XSP,10,"","Y") S:XX10<0 Y="@300";35.4////^S X=XX10;I XX10="@" S Y="@228";35.42R~;S:$G(LASTDX)<10 LASTDX=10;S Y="@229";@228;35.42///@;S:$G(LASTDX)'>10 Y="@300";@229;
"KRN",.402,363,"DR",1,162.5,52)
S XX11=$$ASKICD10^FBASF(XSP,11,"","Y") S:XX11<0 Y="@300";35.5////^S X=XX11;I XX11="@" S Y="@230";35.52R~;S:$G(LASTDX)<11 LASTDX=11;S Y="@231";@230;35.52///@;S:$G(LASTDX)'>11 Y="@300";@231;
"KRN",.402,363,"DR",1,162.5,53)
S XX12=$$ASKICD10^FBASF(XSP,12,"","Y") S:XX12<0 Y="@300";35.6////^S X=XX12;I XX12="@" S Y="@232";35.62R~;S:$G(LASTDX)<12 LASTDX=12;S Y="@233";@232;35.62///@;S:$G(LASTDX)'>12 Y="@300";@233;
"KRN",.402,363,"DR",1,162.5,54)
S XX13=$$ASKICD10^FBASF(XSP,13,"","Y") S:XX13<0 Y="@300";35.7////^S X=XX13;I XX13="@" S Y="@234";35.72R~;S:$G(LASTDX)<13 LASTDX=13;S Y="@235";@234;35.72///@;S:$G(LASTDX)'>13 Y="@300";@235;
"KRN",.402,363,"DR",1,162.5,55)
S XX14=$$ASKICD10^FBASF(XSP,14,"","Y") S:XX14<0 Y="@300";35.8////^S X=XX14;I XX14="@" S Y="@236";35.82R~;S:$G(LASTDX)<14 LASTDX=14;S Y="@237";@236;35.82///@;S:$G(LASTDX)'>14 Y="@300";@237;
"KRN",.402,363,"DR",1,162.5,56)
S XX15=$$ASKICD10^FBASF(XSP,15,"","Y") S:XX15<0 Y="@300";35.9////^S X=XX15;I XX15="@" S Y="@238";35.92R~;S:$G(LASTDX)<15 LASTDX=15;S Y="@239";@238;35.92///@;S:$G(LASTDX)'>15 Y="@300";@239;
"KRN",.402,363,"DR",1,162.5,57)
S XX16=$$ASKICD10^FBASF(XSP,16,"","Y") S:XX16<0 Y="@300";36////^S X=XX16;I XX16="@" S Y="@240";36.02R~;S:$G(LASTDX)<16 LASTDX=16;S Y="@241";@240;36.02///@;S:$G(LASTDX)'>16 Y="@300";@241;
"KRN",.402,363,"DR",1,162.5,58)
S XX17=$$ASKICD10^FBASF(XSP,17,"","Y") S:XX17<0 Y="@300";36.1////^S X=XX17;I XX17="@" S Y="@242";36.12R~;S:$G(LASTDX)<17 LASTDX=17;S Y="@243";@242;36.12///@;S:$G(LASTDX)'>17 Y="@300";@243;
"KRN",.402,363,"DR",1,162.5,59)
S XX18=$$ASKICD10^FBASF(XSP,18,"","Y") S:XX18<0 Y="@300";36.2////^S X=XX18;I XX18="@" S Y="@244";36.22R~;S:$G(LASTDX)<18 LASTDX=18;S Y="@245";@244;36.22///@;S:$G(LASTDX)'>18 Y="@300";@245;
"KRN",.402,363,"DR",1,162.5,60)
S XX19=$$ASKICD10^FBASF(XSP,19,"","Y") S:XX19<0 Y="@300";36.3////^S X=XX19;I XX19="@" S Y="@246";36.32R~;S:$G(LASTDX)<19 LASTDX=19;S Y="@247";@246;36.32///@;S:$G(LASTDX)'>19 Y="@300";@247;
"KRN",.402,363,"DR",1,162.5,61)
S XX20=$$ASKICD10^FBASF(XSP,20,"","Y") S:XX20<0 Y="@300";36.4////^S X=XX20;I XX20="@" S Y="@248";36.42R~;S:$G(LASTDX)<20 LASTDX=20;S Y="@249";@248;36.42///@;S:$G(LASTDX)'>20 Y="@300";@249;
"KRN",.402,363,"DR",1,162.5,62)
S XX21=$$ASKICD10^FBASF(XSP,21,"","Y") S:XX21<0 Y="@300";36.5////^S X=XX21;I XX21="@" S Y="@250";36.52R~;S:$G(LASTDX)<21 LASTDX=21;S Y="@251";@250;36.52///@;S:$G(LASTDX)'>21 Y="@300";@251;
"KRN",.402,363,"DR",1,162.5,63)
S XX22=$$ASKICD10^FBASF(XSP,22,"","Y") S:XX22<0 Y="@300";36.6////^S X=XX22;I XX22="@" S Y="@252";36.62R~;S:$G(LASTDX)<22 LASTDX=22;S Y="@253";@252;36.62///@;S:$G(LASTDX)'>22 Y="@300";@253;
"KRN",.402,363,"DR",1,162.5,64)
S XX23=$$ASKICD10^FBASF(XSP,23,"","Y") S:XX23<0 Y="@300";36.7////^S X=XX23;I XX23="@" S Y="@254";36.72R~;S:$G(LASTDX)<23 LASTDX=23;S Y="@255";@254;36.72///@;S:$G(LASTDX)'>23 Y="@300";@255;
"KRN",.402,363,"DR",1,162.5,65)
S XX24=$$ASKICD10^FBASF(XSP,24,"","Y") S:XX24<0 Y="@300";36.8////^S X=XX24;I XX24="@" S Y="@256";36.82R~;S:$G(LASTDX)<24 LASTDX=24;S Y="@257";@256;36.82///@;S:$G(LASTDX)'>24 Y="@300";@257;
"KRN",.402,363,"DR",1,162.5,66)
S XX25=$$ASKICD10^FBASF(XSP,25,"","Y") S:XX25<0 Y="@300";36.9////^S X=XX25;I XX25="@" S Y="@258";36.92R~;S:$G(LASTDX)<25 LASTDX=25;S Y="@300";@258;36.92///@;@300;S EDATE=$$FRDTINV^FBCSV1(DA);
"KRN",.402,363,"DR",1,162.5,67)
I EDATE<$$IMPDATE^FBCSV1("10D") S Y="@305";S EDATE=EDATEH,Y="@310";@305;39;S:$$INPICD9^FBCSV1(X,$G(DA)) Y="@305";S EDATE=EDATEH,Y="@320";@310;S XAD=-1 S XAD=$$ASKICD10^FBASF("ADMITTING DIAGNOSIS","");S:XAD<0 Y="@310";
"KRN",.402,363,"DR",1,162.5,68)
39////^S X=XAD;@320;S ICDCD=31,IMPDATE=$$IMPDATE^FBCSV1("10D");S:EDATE<IMPDATE ICDCD=2;S XSP="PROC1";S XXE1=$P($G(^FBAAI(DA,"PROC")),"^",1);S XX1=$$ENICD9^FBICDP(EDATE,XSP,"N","Y","N",XXE1);
"KRN",.402,363,"DR",1,162.5,69)
I XX1<0,$P(XX1,"^",2)["inactive" S Y="@320";I XX1<0,XXE1'?1N.N S Y="@99";S:XX1<0 XX1=XXE1;40////^S X=+XX1;@325;S XSP="PROC2";S XXE2=$P($G(^FBAAI(DA,"PROC")),"^",2);S XX2=$$ENICD9^FBICDP(EDATE,XSP,"N","Y","N",XXE2);
"KRN",.402,363,"DR",1,162.5,70)
I XX2<0,$P(XX2,"^",2)["inactive" S Y="@325";I XX2<0,XXE2'?1N.N S Y="@99";S:XX2<0 XX2=XXE2;41////^S X=+XX2;@326;S XSP="PROC3";S XXE3=$P($G(^FBAAI(DA,"PROC")),"^",3);S XX3=$$ENICD9^FBICDP(EDATE,XSP,"N","Y","N",XXE3);
"KRN",.402,363,"DR",1,162.5,71)
I XX3<0,$P(XX3,"^",2)["inactive" S Y="@326";I XX3<0,XXE3'?1N.N S Y="@99";S:XX3<0 XX3=XXE3;42////^S X=+XX3;@327;S XSP="PROC4";S XXE4=$P($G(^FBAAI(DA,"PROC")),"^",4);S XX4=$$ENICD9^FBICDP(EDATE,XSP,"N","Y","N",XXE4);
"KRN",.402,363,"DR",1,162.5,72)
I XX4<0,$P(XX4,"^",2)["inactive" S Y="@327";I XX4<0,XXE4'?1N.N S Y="@99";S:XX4<0 XX4=XXE4;43////^S X=+XX4;@328;S XSP="PROC5";S XXE5=$P($G(^FBAAI(DA,"PROC")),"^",5);S XX5=$$ENICD9^FBICDP(EDATE,XSP,"N","Y","N",XXE5);
"KRN",.402,363,"DR",1,162.5,73)
I XX5<0,$P(XX5,"^",2)["inactive" S Y="@328";I XX5<0,XXE5'?1N.N S Y="@99";S:XX5<0 XX5=XXE5;44////^S X=+XX5;@329;S XSP="PROC6";S XXE6=$P($G(^FBAAI(DA,"PROC")),"^",6);S XX6=$$ENICD9^FBICDP(EDATE,XSP,"N","Y","N",XXE6);
"KRN",.402,363,"DR",1,162.5,74)
I XX6<0,$P(XX6,"^",2)["inactive" S Y="@329";I XX6<0,XXE6'?1N.N S Y="@99";S:XX6<0 XX6=XXE6;44.06////^S X=+XX6;@330;S XSP="PROC7";S XXE7=$P($G(^FBAAI(DA,"PROC")),"^",7);S XX7=$$ENICD9^FBICDP(EDATE,XSP,"N","Y","N",XXE7);
"KRN",.402,363,"DR",1,162.5,75)
I XX7<0,$P(XX7,"^",2)["inactive" S Y="@330";I XX7<0,XXE7'?1N.N S Y="@99";S:XX7<0 XX7=XXE7;44.07////^S X=+XX7;@331;S XSP="PROC8";S XXE8=$P($G(^FBAAI(DA,"PROC")),"^",8);S XX8=$$ENICD9^FBICDP(EDATE,XSP,"N","Y","N",XXE8);
"KRN",.402,363,"DR",1,162.5,76)
I XX8<0,$P(XX8,"^",2)["inactive" S Y="@331";I XX8<0,XXE8'?1N.N S Y="@99";S:XX8<0 XX8=XXE8;44.08////^S X=+XX8;@332;S XSP="PROC9";S XXE9=$P($G(^FBAAI(DA,"PROC")),"^",9);S XX9=$$ENICD9^FBICDP(EDATE,XSP,"N","Y","N",XXE9);
"KRN",.402,363,"DR",1,162.5,77)
I XX9<0,$P(XX9,"^",2)["inactive" S Y="@332";I XX9<0,XXE9'?1N.N S Y="@99";S:XX9<0 XX9=XXE9;44.09////^S X=+XX9;@333;S XSP="PROC10";S XXE10=$P($G(^FBAAI(DA,"PROC")),"^",10);S XX10=$$ENICD9^FBICDP(EDATE,XSP,"N","Y","N",XXE10);
"KRN",.402,363,"DR",1,162.5,78)
I XX10<0,$P(XX10,"^",2)["inactive" S Y="@333";I XX10<0,XXE10'?1N.N S Y="@99";S:XX10<0 XX10=XXE10;44.1////^S X=+XX10;@334;S XSP="PROC11";S XXE11=$P($G(^FBAAI(DA,"PROC")),"^",11);S XX11=$$ENICD9^FBICDP(EDATE,XSP,"N","Y","N",XXE11);
"KRN",.402,363,"DR",1,162.5,79)
I XX11<0,$P(XX11,"^",2)["inactive" S Y="@334";I XX11<0,XXE11'?1N.N S Y="@99";S:XX11<0 XX11=XXE11;44.11////^S X=+XX11;@335;S XSP="PROC12";S XXE12=$P($G(^FBAAI(DA,"PROC")),"^",12);S XX12=$$ENICD9^FBICDP(EDATE,XSP,"N","Y","N",XXE12);
"KRN",.402,363,"DR",1,162.5,80)
I XX12<0,$P(XX12,"^",2)["inactive" S Y="@335";I XX12<0,XXE12'?1N.N S Y="@99";S:XX12<0 XX12=XXE12;44.12////^S X=+XX12;@336;S XSP="PROC13";S XXE13=$P($G(^FBAAI(DA,"PROC")),"^",13);S XX13=$$ENICD9^FBICDP(EDATE,XSP,"N","Y","N",XXE13);
"KRN",.402,363,"DR",1,162.5,81)
I XX13<0,$P(XX13,"^",2)["inactive" S Y="@336";I XX13<0,XXE13'?1N.N S Y="@99";S:XX13<0 XX13=XXE13;44.13////^S X=+XX13;@337;S XSP="PROC14";S XXE14=$P($G(^FBAAI(DA,"PROC")),"^",14);S XX14=$$ENICD9^FBICDP(EDATE,XSP,"N","Y","N",XXE14);
"KRN",.402,363,"DR",1,162.5,82)
I XX14<0,$P(XX14,"^",2)["inactive" S Y="@337";I XX14<0,XXE14'?1N.N S Y="@99";S:XX14<0 XX14=XXE14;44.14////^S X=+XX14;@338;S XSP="PROC15";S XXE15=$P($G(^FBAAI(DA,"PROC")),"^",15);S XX15=$$ENICD9^FBICDP(EDATE,XSP,"N","Y","N",XXE15);
"KRN",.402,363,"DR",1,162.5,83)
I XX15<0,$P(XX15,"^",2)["inactive" S Y="@338";I XX15<0,XXE15'?1N.N S Y="@99";S:XX15<0 XX15=XXE15;44.15////^S X=+XX15;@339;S XSP="PROC16";S XXE16=$P($G(^FBAAI(DA,"PROC")),"^",16);S XX16=$$ENICD9^FBICDP(EDATE,XSP,"N","Y","N",XXE16);
"KRN",.402,363,"DR",1,162.5,84)
I XX16<0,$P(XX16,"^",2)["inactive" S Y="@339";I XX16<0,XXE16'?1N.N S Y="@99";S:XX16<0 XX16=XXE16;44.16////^S X=+XX16;@340;S XSP="PROC17";S XXE17=$P($G(^FBAAI(DA,"PROC")),"^",17);S XX17=$$ENICD9^FBICDP(EDATE,XSP,"N","Y","N",XXE17);
"KRN",.402,363,"DR",1,162.5,85)
I XX17<0,$P(XX17,"^",2)["inactive" S Y="@340";I XX17<0,XXE17'?1N.N S Y="@99";S:XX17<0 XX17=XXE17;44.17////^S X=+XX17;@341;S XSP="PROC18";S XXE18=$P($G(^FBAAI(DA,"PROC")),"^",18);S XX18=$$ENICD9^FBICDP(EDATE,XSP,"N","Y","N",XXE18);
"KRN",.402,363,"DR",1,162.5,86)
I XX18<0,$P(XX18,"^",2)["inactive" S Y="@341";I XX18<0,XXE18'?1N.N S Y="@99";S:XX18<0 XX18=XXE18;44.18////^S X=+XX18;@342;S XSP="PROC19";S XXE19=$P($G(^FBAAI(DA,"PROC")),"^",19);S XX19=$$ENICD9^FBICDP(EDATE,XSP,"N","Y","N",XXE19);
"KRN",.402,363,"DR",1,162.5,87)
I XX19<0,$P(XX19,"^",2)["inactive" S Y="@342";I XX19<0,XXE19'?1N.N S Y="@99";S:XX19<0 XX19=XXE19;44.19////^S X=+XX19;@343;S XSP="PROC20";S XXE20=$P($G(^FBAAI(DA,"PROC")),"^",20);S XX20=$$ENICD9^FBICDP(EDATE,XSP,"N","Y","N",XXE20);
"KRN",.402,363,"DR",1,162.5,88)
I XX20<0,$P(XX20,"^",2)["inactive" S Y="@343";I XX20<0,XXE20'?1N.N S Y="@99";S:XX20<0 XX20=XXE20;44.2////^S X=+XX20;@344;S XSP="PROC21";S XXE21=$P($G(^FBAAI(DA,"PROC")),"^",21);S XX21=$$ENICD9^FBICDP(EDATE,XSP,"N","Y","N",XXE21);
"KRN",.402,363,"DR",1,162.5,89)
I XX21<0,$P(XX21,"^",2)["inactive" S Y="@344";I XX21<0,XXE21'?1N.N S Y="@99";S:XX21<0 XX21=XXE21;44.21////^S X=+XX21;@345;S XSP="PROC22";S XXE22=$P($G(^FBAAI(DA,"PROC")),"^",22);S XX22=$$ENICD9^FBICDP(EDATE,XSP,"N","Y","N",XXE22);
"KRN",.402,363,"DR",1,162.5,90)
I XX22<0,$P(XX22,"^",2)["inactive" S Y="@345";I XX22<0,XXE22'?1N.N S Y="@99";S:XX22<0 XX22=XXE22;44.22////^S X=+XX22;@346;S XSP="PROC23";S XXE23=$P($G(^FBAAI(DA,"PROC")),"^",23);S XX23=$$ENICD9^FBICDP(EDATE,XSP,"N","Y","N",XXE23);
"KRN",.402,363,"DR",1,162.5,91)
I XX23<0,$P(XX23,"^",2)["inactive" S Y="@346";I XX23<0,XXE23'?1N.N S Y="@99";S:XX23<0 XX23=XXE23;44.23////^S X=+XX23;@347;S XSP="PROC24";S XXE24=$P($G(^FBAAI(DA,"PROC")),"^",24);S XX24=$$ENICD9^FBICDP(EDATE,XSP,"N","Y","N",XXE24);
"KRN",.402,363,"DR",1,162.5,92)
I XX24<0,$P(XX24,"^",2)["inactive" S Y="@347";I XX24<0,XXE24'?1N.N S Y="@99";S:XX24<0 XX24=XXE24;44.24////^S X=+XX24;@348;S XSP="PROC25";S XXE25=$P($G(^FBAAI(DA,"PROC")),"^",25);S XX25=$$ENICD9^FBICDP(EDATE,XSP,"N","Y","N",XXE25);
"KRN",.402,363,"DR",1,162.5,93)
I XX25<0,$P(XX25,"^",2)["inactive" S Y="@348";I XX25<0,XXE25'?1N.N S Y="@99";S:XX25<0 XX25=XXE25;44.25////^S X=+XX25;@99;K FBPROVD;M FBPROVD=FBPROV;S FBX=$$RPROV^FBUTL8(.FBPROV,.FBPROVD);K FBPROVD;S:$D(FBPRICE) Y="@992";
"KRN",.402,363,"DR",1,162.5,94)
S FBX=$$CLESSR^FBUTL4A(.FBADJ,5,.FBRRMK);@992;K FBJJ,FBKK,DIE("NO^"),FBX;
"KRN",.402,690,-1)
0^2
"KRN",.402,690,0)
FBNH EDIT PAYMENT^3160901.1504^^162.5^^^3150327
"KRN",.402,690,"DIAB",3,0,162.5,0)
1;"(whichever is later)"
"KRN",.402,690,"DIAB",5,0,162.5,4)
20;REQ
"KRN",.402,690,"DIAB",6,0,162.5,4)
21;REQ
"KRN",.402,690,"DIAB",7,0,162.5,4)
22;REQ
"KRN",.402,690,"DIAB",8,0,162.5,4)
23;REQ
"KRN",.402,690,"DR",1,162.5)
@1;W !!,"Enter Date Correct Invoice Received or Last Date of Service";1(whichever is later)~;S INVRDATE=X I $$BADDATE^FBNHEDPA(X,DA) S Y="@1";46;55;S FBX=$$FPPSC^FBUTL5(1,FBFPPSC);S:FBX=-1 Y="@11";S:FBX="" Y="@10";56///^S X=FBX;
"KRN",.402,690,"DR",1,162.5,1)
S FBFPPSC=X;S FBX=$$FPPSL^FBUTL5(FBFPPSL,1,1);57///^S X=FBX;S FBFPPSL=X;S Y="@11";@10;56///@;S FBFPPSC="";57///@;S FBFPPSL="";@11;2;3;@5;5;I $$BADTDATE^FBNHEDPA(X,INVRDATE,"FROM") S Y="@5";@6;6;
"KRN",.402,690,"DR",1,162.5,2)
I $P(^FBAAI(DA,0),U,6)>X W !,*7,"To date cannot be before from date.",! S Y=5;I $$BADTDATE^FBNHEDPA(X,INVRDATE,"TO") S Y="@6";54;@12;S FBHAC=$P(^FBAAI(DA,0),U,8);7;S FBAC=X;S FBHAP=$P(^FBAAI(DA,0),U,9);8;S FBAP=X;
"KRN",.402,690,"DR",1,162.5,3)
I FBAP>FBAC S $P(^FBAAI(DA,0),U,9)=FBHAP,$P(^(0),U,8)=FBHAC W !,*7,"Amount Paid cannot be greater than the Amount Claimed" S Y="@12";S FBBAL=FBAC-FBAP;K FBADJD;M FBADJD=FBADJ;
"KRN",.402,690,"DR",1,162.5,4)
S FBX=$$ADJ^FBUTL2(FBAC-FBAP,.FBADJ,5,,.FBADJD,1,.FBRRMK);K FBADJD;12////^S X="V";S DIE("NO^")="OUTOK";20R~;21R~;22R~;23R~;S FBX=$$CLESSR^FBUTL4A(.FBADJ,5,.FBRRMK);
"KRN",19,2568,-1)
2^3
"KRN",19,2568,0)
ZTMQUEUABLE OPTIONS^Parent of Queuable Options^^M^636^^^^^^^^^
"KRN",19,2568,10,0)
^19.01IP^22^16
"KRN",19,2568,10,22,0)
13166^7YR
"KRN",19,2568,10,22,"^")
FBAA BATCH 7YR PURGE
"KRN",19,2568,"U")
PARENT OF QUEUABLE OPTIONS
"KRN",19,13166,-1)
0^2
"KRN",19,13166,0)
FBAA BATCH 7YR PURGE^Batch 7-Year Purge^^R^^^^^^^^FEE BASIS
"KRN",19,13166,1,0)
^19.06^3^3^3150226^^
"KRN",19,13166,1,1,0)
This option executes code to purge Batch file entries that have a status 
"KRN",19,13166,1,2,0)
of FINALIZED and are at least 7 years old. It should be scheduled to run 
"KRN",19,13166,1,3,0)
monthly.
"KRN",19,13166,25)
EN^FBBPG7Y
"KRN",19,13166,200.9)
y
"KRN",19,13166,"U")
BATCH 7-YEAR PURGE
"MBREQ")
0
"ORD",7,.402)
.402;7;;;EDEOUT^DIFROMSO(.402,DA,"",XPDA);FPRE^DIFROMSI(.402,"",XPDA);EPRE^DIFROMSI(.402,DA,$E("N",$G(XPDNEW)),XPDA,"",OLDA);;EPOST^DIFROMSI(.402,DA,"",XPDA);DEL^DIFROMSK(.402,"",%)
"ORD",7,.402,0)
INPUT TEMPLATE
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"PKG",60,-1)
1^1
"PKG",60,0)
FEE BASIS^FB^Used to pay private vendors
"PKG",60,20,0)
^9.402P^1^1
"PKG",60,20,1,0)
2^^FBPMRG
"PKG",60,20,1,1)

"PKG",60,20,"B",2,1)

"PKG",60,22,0)
^9.49I^1^1
"PKG",60,22,1,0)
3.5^2950130^3030225
"PKG",60,22,1,"PAH",1,0)
158^3171206
"PKG",60,22,1,"PAH",1,1,0)
^^1^1^3171206
"PKG",60,22,1,"PAH",1,1,1,0)
HAC EDI Purchase Care ERA Inc. 2 Development
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
35
"RTN","FBAACIE")
0^9^B17356437^B16604968
"RTN","FBAACIE",1,0)
FBAACIE ;AISC/GRR - COMPLETE PHARMACY INVOICE ;1/22/2015
"RTN","FBAACIE",2,0)
 ;;3.5;FEE BASIS;**38,61,91,154,158**;JAN 30, 1995;Build 94
"RTN","FBAACIE",3,0)
 ;;Per VA Directive 6402, this routine should not be modified.
"RTN","FBAACIE",4,0)
 D DT^DICRW,HOME^%ZIS I '$D(^FBAA(162.1,"AC",2)) W !!,*7,"There are no Invoices Pending completion!",!! Q
"RTN","FBAACIE",5,0)
 D SITEP^FBAAUTL I FBPOP W !,*7,"Fee Site Parameters must be Initialized!" K FBPOP Q
"RTN","FBAACIE",6,0)
 S FBAAOUT=1,FBMDF=$P(FBSITE(0),"^",10),UL="",$P(UL,"=",79)="="
"RTN","FBAACIE",7,0)
RINV W ! S FBINTOT=0,DIC="^FBAA(162.1,",DIC(0)="AEQM",DIC("S")="I $P(^(0),U,5)=2&($D(^(""RX"",""AC"",2)))" D ^DIC K DIC("S") G END:X="^"!(X=""),RINV:Y<0 S FBIN=+Y,FBINTOT=+$P(^(0),"^",7)
"RTN","FBAACIE",8,0)
 I '$D(^FBAA(162.1,FBIN,"RX","AC",2)) G RINV
"RTN","FBAACIE",9,0)
 S J=0 F  S J=$O(^FBAA(162.1,FBIN,"RX","AC",2,J)) Q:'J  I $D(^FBAA(162.1,FBIN,"RX",J,0)) S Y(0)=^(0) D GOT
"RTN","FBAACIE",10,0)
 I '$D(^FBAA(162.1,FBIN,"RX","AC",2)) K ^FBAA(162.1,"AC",2,FBIN) S ^FBAA(162.1,"AC",3,FBIN)="",$P(^FBAA(162.1,FBIN,0),"^",5)=3
"RTN","FBAACIE",11,0)
 I $D(^FBAA(162.1,"AC",3,FBIN)) W !!,"Invoice is Complete",?30,"Totals: $ "_$J(FBINTOT,1,2)
"RTN","FBAACIE",12,0)
 G RINV
"RTN","FBAACIE",13,0)
END K FBAAOUT,FBIN,FBRX,FBSITE,FBDATEF,FBDRUG,FBPATN,FBPID,FBVNAME,FBVID,FBAC,FBAAPR,DA,X,Y,D0,D1,DI,DIC,DIE,DIRUT,DIV,DQ,DR,FBAP,FBGEN,FBGENSUB,FBINTOT,FBMDF,FBQTY,FBRBC,FBSTR,FBVEN,S,UL,ULL,POP,J,DFN,Z,ZZ,FBSW,FBPOP,FB1725
"RTN","FBAACIE",14,0)
 K FBADJ,FBFPPSC,FBFPPSL,FBRRMK,DTOUT,FBX,FTP
"RTN","FBAACIE",15,0)
 Q
"RTN","FBAACIE",16,0)
GOT S FBDRUG=$P(Y(0),"^",2)
"RTN","FBAACIE",17,0)
 S FBGENSUB=$$GET1^DIQ(162.11,J_","_FBIN_",",8.5)
"RTN","FBAACIE",18,0)
 S FBGEN=$$GET1^DIQ(162.11,J_","_FBIN_",",9)
"RTN","FBAACIE",19,0)
 S FBRX=$P(Y(0),"^"),FBDATEF=$P(Y(0),"^",3),FBAC=$P(Y(0),"^",4),DFN=+$P(Y(0),"^",5),FBPATN=$$VET^FBUCUTL(DFN),FBPID=$$SSN^FBAAUTL(DFN)
"RTN","FBAACIE",20,0)
 S FBSTR=$P(Y(0),"^",12),FBQTY=$P(Y(0),"^",13),FBAAPR=$P(Y(0),"^",22)
"RTN","FBAACIE",21,0)
 S Y=$S($D(^FBAA(162.1,FBIN,0)):^(0),1:"")
"RTN","FBAACIE",22,0)
 S FBFPPSC=$P(Y,U,13)
"RTN","FBAACIE",23,0)
 S FBFPPSL=$P($G(^FBAA(162.1,FBIN,"RX",J,3)),U)
"RTN","FBAACIE",24,0)
 S FBVEN=+$P(Y,"^",4),FBVNAME=$$VEN^FBUCUTL(FBVEN),FBVID=$P($G(^FBAAV(FBVEN,0)),"^",2)
"RTN","FBAACIE",25,0)
 ; set FB1725 flag = true if payment for a 38 U.S.C. 1725 claim
"RTN","FBAACIE",26,0)
 S Y(2)=$G(^FBAA(162.1,FBIN,"RX",J,2))
"RTN","FBAACIE",27,0)
 S FB1725=$S($P(Y(2),U,6)["FB583":+$P($G(^FB583(+$P(Y(2),U,6),0)),U,28),1:0)
"RTN","FBAACIE",28,0)
 S FTP=$P(Y(2),U,7)
"RTN","FBAACIE",29,0)
 W @IOF,"Vendor: ",FBVNAME,"   Vendor ID: ",FBVID
"RTN","FBAACIE",30,0)
 W !!,"Patient: ",FBPATN,"   Patient ID: ",FBPID
"RTN","FBAACIE",31,0)
 W !,"FPPS Claim ID: ",$S(FBFPPSC="":"N/A",1:FBFPPSC)
"RTN","FBAACIE",32,0)
 W ?28,"FPPS Line Item: ",$S(FBFPPSL="":"N/A",1:FBFPPSL)
"RTN","FBAACIE",33,0)
 W !!,"Drug Name",?32,"   RX #  "," Strength  ","  Qty","   Amt Claimed   ",!,UL
"RTN","FBAACIE",34,0)
 W !,FBDRUG,?34,FBRX,?43,FBSTR,?54,FBQTY,?63,FBAC
"RTN","FBAACIE",35,0)
 I FBGENSUB]"" W !!,?4,"Generic Drug Issued: ",FBGENSUB,?30,"Generic Drug Name: ",$E(FBGEN,1,30)
"RTN","FBAACIE",36,0)
 W:FBAAPR]"" !!,?5,"Pharmacy Remarks: ",FBAAPR
"RTN","FBAACIE",37,0)
 I '$$UOKPAY^FBUTL9(DFN,FTP) D  Q
"RTN","FBAACIE",38,0)
 . W !!,"You cannot process a payment associated with authorization ",DFN,"-",FTP
"RTN","FBAACIE",39,0)
 . W !,"due to separation of duties."
"RTN","FBAACIE",40,0)
 . S DIR(0)="E",DIR("A")="Press RETURN to continue" D ^DIR K DIR
"RTN","FBAACIE",41,0)
FEE S DIR(0)="161.4,9",DIR("B")=FBMDF,DIR("?")="Hit Return to accept default dispensing fee or enter a dollar amount between .01 and 20" D ^DIR K DIR Q:$D(DIRUT)
"RTN","FBAACIE",42,0)
 W:FB1725 !?2,"**Payment is for emergency treatment under 38 U.S.C. 1725."
"RTN","FBAACIE",43,0)
 W !! S FBMDF=+Y K FBAP
"RTN","FBAACIE",44,0)
 S DA(1)=FBIN,DIE="^FBAA(162.1,"_FBIN_",""RX"",",DA=J,DIC=DIE,DR="5;S FBRBC=X;6.5//^S X=$S(FBRBC+FBMDF>FBAC:FBAC,1:FBRBC+FBMDF);S FBAP=X"
"RTN","FBAACIE",45,0)
 S DR(1,162.11,1)="I FBAP>FBAC S $P(^FBAA(162.1,DA(1),""RX"",DA,0),U,16)="""" W !,*7,""Amount Paid cannot be greater than the Amount Claimed"" S Y=6.5"
"RTN","FBAACIE",46,0)
 ;FB*3.5*158
"RTN","FBAACIE",47,0)
 K FBRRMK S DR(1,162.11,2)="S FBX=$$ADJ^FBUTL2(FBAC-FBAP,.FBADJ,5,,,1,.FBRRMK,1)"
"RTN","FBAACIE",48,0)
 S DR(1,162.11,3)="8////^S X=3"
"RTN","FBAACIE",49,0)
 D ^DIE K DIE Q:$D(Y)'=0
"RTN","FBAACIE",50,0)
 S:$D(FBAP) FBINTOT=FBINTOT+FBAP
"RTN","FBAACIE",51,0)
 S $P(^FBAA(162.1,FBIN,0),"^",7)=FBINTOT
"RTN","FBAACIE",52,0)
 G:$D(DTOUT) H^XUS
"RTN","FBAACIE",53,0)
 ; file adjustments
"RTN","FBAACIE",54,0)
 D FILEADJ^FBRXFA(DA_","_FBIN_",",.FBADJ)
"RTN","FBAACIE",55,0)
 ; file remittance remarks
"RTN","FBAACIE",56,0)
 D FILERR^FBRXFR(DA_","_FBIN_",",.FBRRMK)
"RTN","FBAACIE",57,0)
 Q
"RTN","FBAACIE",58,0)
 ;
"RTN","FBAACIE",59,0)
BLDRR(FBA1,FBA2) ; build array FILERR^FBRXFR understands
"RTN","FBAACIE",60,0)
 ;
"RTN","FBAACIE",61,0)
 N I1,I2,CNTR K FBA2
"RTN","FBAACIE",62,0)
 S I1=0,CNTR=0
"RTN","FBAACIE",63,0)
 F  S I1=$O(FBA1(I1)) Q:'I1  D
"RTN","FBAACIE",64,0)
 . S I2=0
"RTN","FBAACIE",65,0)
 . F  S I2=$O(FBA1(I1,I2)) Q:'I2  D
"RTN","FBAACIE",66,0)
 . . S CNTR=CNTR+1
"RTN","FBAACIE",67,0)
 . . S FBA2(CNTR)=FBA1(I1,I2)
"RTN","FBAACIE",68,0)
 Q
"RTN","FBAACIE",69,0)
 ;
"RTN","FBAACO2")
0^15^B33011458^B31897549
"RTN","FBAACO2",1,0)
FBAACO2 ;AISC/GRR - PAYMENT PROCESS FOR DUPLICATE ;12/19/2014
"RTN","FBAACO2",2,0)
 ;;3.5;FEE BASIS;**4,55,61,77,116,122,133,108,135,139,123,157,158**;JAN 30, 1995;Build 94
"RTN","FBAACO2",3,0)
 ;;Per VA Directive 6402, this routine should not be modified.
"RTN","FBAACO2",4,0)
 ;
"RTN","FBAACO2",5,0)
 ;FB*3.5*157 Modify file 162, Diagnosis (field 28) stuff from '///' to '////'
"RTN","FBAACO2",6,0)
 ;           since needed file 80 dx IEN is already passed back from DX 
"RTN","FBAACO2",7,0)
 ;           lookup.
"RTN","FBAACO2",8,0)
 ;
"RTN","FBAACO2",9,0)
RD S DIR(0)="Y",DIR("A")="Want this payment stored as a Medical Denial",DIR("B")="YES",DIR("?")="Enter 'Yes' to store payment entry as a denial and send a Suspension letter.  Enter 'No' to have nothing happen." D ^DIR K DIR Q:$D(DIRUT)!('Y)
"RTN","FBAACO2",10,0)
 S FBDEN=1 Q
"RTN","FBAACO2",11,0)
FILE ;files sp multiple entry
"RTN","FBAACO2",12,0)
 K DR S TP="" I $G(FBDEN) S FBAMTPD=0
"RTN","FBAACO2",13,0)
 ; FB*3.5*123 - set IPAC fields .05 and .055 on the next line
"RTN","FBAACO2",14,0)
 S DR="49///^S X=$G(FBCSID);50///^S X=$G(FBFPPSC);81///^S X=$G(FBUCI135);.05////^S X=$G(FBIA);.055///^S X=$G(FBDODINV);I $G(FBDEN) S Y=1;48;47//1;S FBUNITS=X;S:$G(FBFPPSC)="""" Y=""@11"";S FBX=$$FPPSL^FBUTL5();S:FBX=-1 Y=0;51///^S X=FBX;@11"
"RTN","FBAACO2",15,0)
 ; fb*3.5*116 do not enable different interest indicator values at line item level; interest indicator set at invoice level
"RTN","FBAACO2",16,0)
 ;FB*3.5*158 store payment methodology using fee schedule code
"RTN","FBAACO2",17,0)
 S DR(1,162.03,1)="34///^S X=$G(FBAAMM);D POS^FBAACO1;S:'$G(FBHCFA(30)) Y=0;1;S J=X;I $G(FBDEN) S Y=2;D FEE^FBAACO0;44////^S X=FBFSAMT;45///^S X=FBFSUSD;2///^S X=FBAMTPD;S K=X;82///^S X=$$PYMTH^FBAAUTL(FBFSUSD)"
"RTN","FBAACO2",18,0)
 S DR(1,162.03,2)="S FBX=$$ADJ^FBUTL2(J-K,.FBADJ,5,,,,.FBRRMK,1);S:FBX=0 Y=0;6////^S X=DUZ"
"RTN","FBAACO2",19,0)
 S DR(1,162.03,3)="7////^S X=FBAABE;8////^S X=BO;13///^S X=FBAAID;14///^S X=FBAAIN;33///^S X=FBAAVID;I $G(FBDEN) S FBTST=1"
"RTN","FBAACO2",20,0)
 I '$G(FBDEN) D
"RTN","FBAACO2",21,0)
 . ; FB*3.5*139-JLG/JAS-ICD10 REMEDIATION - Made modifications to DR strings for ICD-10, added FBDXCHK1 and FBDXCHK2 for this
"RTN","FBAACO2",22,0)
 .N FBCSVSTR S FBCSVSTR="I X]"""" S:$$INPICD9^FBCSV1(X,"""",$G(FBAADT)) Y=""@30"";"
"RTN","FBAACO2",23,0)
 .N FBDXCHK1 S FBDXCHK1=";@20;S XX1=-1 S XX1=$$FBDXCHK^FBAACO2(FBAADT) S:XX1<0 Y=""@20"";28////^S X=XX1;S Y=""@6"";"   ;FB*3.5*157
"RTN","FBAACO2",24,0)
 .N FBDXCHK2 S FBDXCHK2=";@25;S XX1=-1 S XX1=$$FBDXCHK^FBAACO2(FBAADT) S:XX1<0 Y=""@25"";28////^S X=XX1;S Y=""@35"";@30;"    ;FB*3.5*157
"RTN","FBAACO2",25,0)
 .S DR(1,162.03,4)="S:$$EXTPV^FBAAUTL5(FBPOV)=""01"" Y=""@1"";S:FB7078]""""!($D(FB583)) Y=30"_FBDXCHK1_"@6;30////^S X=FBHCFA(30);"
"RTN","FBAACO2",26,0)
 .S DR(1,162.03,5)="31;32R;S Y=15;@1"_FBDXCHK2_FBCSVSTR_"@35;30////^S X=FBHCFA(30);31;15///^S X=FBPT;"
"RTN","FBAACO2",27,0)
 . ;end 139
"RTN","FBAACO2",28,0)
 .S DR(1,162.03,6)="16////^S X=FBPOV;17///^S X=FBTT;18///^S X=FBAAPTC;23////^S X=FBTYPE;26////^S X=FBPSA;S:$D(FBV583) Y=""@2"";27////^S X=FB7078;S Y=""@99"";@2;27////^S X=FBV583;@99;S FBTST=1;54////^S X=FBCNTRP"
"RTN","FBAACO2",29,0)
 .S DR(1,162.03,7)="73;74;75;58;59;60;61;62;63;64;65;66;67;76;77;78;79;68;69" ;FB*3.5*122 Line Item Provider information ;FB*3.5*133 Provider Information
"RTN","FBAACO2",30,0)
 S DIE="^FBAAC("_DFN_",1,"_FBV_",1,"_FBSDI_",1,"
"RTN","FBAACO2",31,0)
 S DA(3)=DFN,DA(2)=FBV,DA(1)=FBSDI,DA=FBAACPI
"RTN","FBAACO2",32,0)
 D LOCK^FBUCUTL("^FBAAC("_DFN_",1,"_FBV_",1,"_FBSDI_",1,",FBAACPI,1)
"RTN","FBAACO2",33,0)
 D
"RTN","FBAACO2",34,0)
 . N ICDVDT S ICDVDT=$G(FBAADT) D ^DIE
"RTN","FBAACO2",35,0)
 I '$D(DTOUT),$G(FBTST) D
"RTN","FBAACO2",36,0)
 . D FILEADJ^FBAAFA(FBAACPI_","_FBSDI_","_FBV_","_DFN_",",.FBADJ)
"RTN","FBAACO2",37,0)
 . D FILERR^FBAAFR(FBAACPI_","_FBSDI_","_FBV_","_DFN_",",.FBRRMK)
"RTN","FBAACO2",38,0)
 . K FBADJ,FBRRMK  ;must kill so codes don't persist into next procedure/line
"RTN","FBAACO2",39,0)
 L -^FBAAC(DFN,1,FBV,1,FBSDI,1,FBAACPI)
"RTN","FBAACO2",40,0)
 I $D(DTOUT) D KILL Q
"RTN","FBAACO2",41,0)
 I '$G(FBTST),$G(DA) S DIR(0)="YA",DIR("A")="Entering an '^' will delete "_$S($G(FBDEN):"denial",1:"payment")_".  Are you sure you want to delete? ",DIR("B")="No" D ^DIR K DIR G FILE:'$D(DIRUT)&('Y) D KILL Q
"RTN","FBAACO2",42,0)
 K FBTST,FBDEN,DIE,DR,DA,FBX
"RTN","FBAACO2",43,0)
 I $D(FBDL) S FBAAOUT=1 Q
"RTN","FBAACO2",44,0)
 Q
"RTN","FBAACO2",45,0)
 ;
"RTN","FBAACO2",46,0)
FBDXCHK(FBAADT) ;DEM;139 Call to ASF if ICD-10.
"RTN","FBAACO2",47,0)
 ;
"RTN","FBAACO2",48,0)
 ; This call checks if the payment diagnosis date to
"RTN","FBAACO2",49,0)
 ; determine if diagnosis code is ICD-9 or ICD-10.
"RTN","FBAACO2",50,0)
 ; If ICD-9, then call ICD-9 code enhanced for inactive code checks.
"RTN","FBAACO2",51,0)
 ; Else, call Advanced Search Functionality (ASF).
"RTN","FBAACO2",52,0)
 ; If user enters "^" to exit, then quit and send calling
"RTN","FBAACO2",53,0)
 ; routine 999 for exit.
"RTN","FBAACO2",54,0)
 ;
"RTN","FBAACO2",55,0)
 ; If no ICD-10 data found, then send calling routine -1 
"RTN","FBAACO2",56,0)
 ; to indicate no data found.
"RTN","FBAACO2",57,0)
 ; If data found, then stuff diagnosis into ICD DIAGNOSIS
"RTN","FBAACO2",58,0)
 ; field, and quit and send the calling routine 10 for ICD-10 code.
"RTN","FBAACO2",59,0)
 ;
"RTN","FBAACO2",60,0)
 ; Input:
"RTN","FBAACO2",61,0)
 ; FBAADT = Date of Interest for FB payments.
"RTN","FBAACO2",62,0)
 ;
"RTN","FBAACO2",63,0)
 ; Output:
"RTN","FBAACO2",64,0)
 ; FB9 = ICD-9 diagnosis
"RTN","FBAACO2",65,0)
 ; FB99 = User entered "^" to exit payment edit.
"RTN","FBAACO2",66,0)
 ; -1 = No ICD-10 data found
"RTN","FBAACO2",67,0)
 ; FB10 = ICD-10 diagnosis 
"RTN","FBAACO2",68,0)
 ;
"RTN","FBAACO2",69,0)
 N ICDSYS,IMPDATE,XX1
"RTN","FBAACO2",70,0)
 S ICDSYS=10,IMPDATE=$$IMPDATE^LEXU("10D")
"RTN","FBAACO2",71,0)
 S:FBAADT<IMPDATE ICDSYS=9
"RTN","FBAACO2",72,0)
 S XX1=-1
"RTN","FBAACO2",73,0)
 I ICDSYS=9 S XX1=$$ASKICD9^FBAACO2(FBAADT) Q XX1  ;ICD-9
"RTN","FBAACO2",74,0)
 S XX1=$$ASKICD10^FBAACO2(FBAADT) Q XX1  ;ICD-10 IEN CODE
"RTN","FBAACO2",75,0)
 ;
"RTN","FBAACO2",76,0)
 ; retrieves existing value in db if exists and prompts user for ICD-9 primary diagnosis 
"RTN","FBAACO2",77,0)
ASKICD9(INDT,FBFREQ) ;FB*3.5*139-JAS-ICD10 REMEDIATION
"RTN","FBAACO2",78,0)
 N DPRMPT,FBDX
"RTN","FBAACO2",79,0)
 S EDATE=INDT  ; edate is the date of interest for ICD10 diagnosis code lookup
"RTN","FBAACO2",80,0)
 I $G(FBFREQ)="" S FBFREQ="N"  ; force field to be required flag
"RTN","FBAACO2",81,0)
 N FBDXIEN
"RTN","FBAACO2",82,0)
 S DPRMPT="PRIMARY DIAGNOSIS"
"RTN","FBAACO2",83,0)
 S FBDXIEN=$P($G(^FBAAC(DFN,1,FBV,1,FBSDI,1,FBAACPI,0)),U,23) ; retrieve existing DX ien 
"RTN","FBAACO2",84,0)
 ;S:FBDXIEN>0 DPRMPT=DPRMPT_": "_$$ICD9^FBCSV1(FBDXIEN,EDATE)_"// "  ;obtain current diagnosis and set as default
"RTN","FBAACO2",85,0)
 S FBDX=-1 S FBDX=$$ENICD9^FBICD9(EDATE,DPRMPT,"Y","","Y",FBDXIEN)
"RTN","FBAACO2",86,0)
 I FBDXIEN>0,FBDX=-1 S FBDX=FBDXIEN W $$ICD9^FBCSV1(FBDXIEN,EDATE) ; return default value if spaces entered
"RTN","FBAACO2",87,0)
 K EDATE,INDT
"RTN","FBAACO2",88,0)
 S FBDX=+FBDX
"RTN","FBAACO2",89,0)
 Q FBDX
"RTN","FBAACO2",90,0)
 ;
"RTN","FBAACO2",91,0)
 ; retrieves existing value in db if exists and prompts user for ICD-10 primary diagnosis 
"RTN","FBAACO2",92,0)
ASKICD10(INDT,FBFREQ) ;FB*3.5*139-JLG-ICD10 REMEDIATION
"RTN","FBAACO2",93,0)
 N DP,DPRMPT,FBDCDA,FBDX
"RTN","FBAACO2",94,0)
 S EDATE=INDT  ; edate is the date of interest for ICD10 diagnosis code lookup
"RTN","FBAACO2",95,0)
 I $G(FBFREQ)="" S FBFREQ="N"  ; force field to be required flag
"RTN","FBAACO2",96,0)
 S DP=162.03   ; file number used to check if diagnosis field is required
"RTN","FBAACO2",97,0)
 S FBDCDA=DA   ; DA equals FBAACPI
"RTN","FBAACO2",98,0)
 N FBDXIEN
"RTN","FBAACO2",99,0)
 S DPRMPT="PRIMARY DIAGNOSIS"
"RTN","FBAACO2",100,0)
 S FBDXIEN=$P($G(^FBAAC(DFN,1,FBV,1,FBSDI,1,FBAACPI,0)),U,23) ; retrieve existing DX ien 
"RTN","FBAACO2",101,0)
 S:FBDXIEN>0 DPRMPT=DPRMPT_": "_$$ICD9^FBCSV1(FBDXIEN,EDATE)_"// "  ;obtain current diagnosis and set as default
"RTN","FBAACO2",102,0)
 S FBDX=-1 S FBDX=$$ASKICD10^FBASF(DPRMPT,"","","",FBFREQ) ; returns -1 or ien of icd10 diagnosis code
"RTN","FBAACO2",103,0)
 I FBDXIEN>0,FBDX=-1 S FBDX=FBDXIEN W $$ICD9^FBCSV1(FBDXIEN,EDATE) ; return default value if spaces entered
"RTN","FBAACO2",104,0)
 K EDATE,INDT
"RTN","FBAACO2",105,0)
 Q FBDX
"RTN","FBAACO2",106,0)
 ;
"RTN","FBAACO2",107,0)
KILL S DIK=DIE D ^DIK K DIE,DIK I '$G(FBCNP) D Q^FBAACO S FBAAOUT=1
"RTN","FBAACO2",108,0)
 W !,"Deleted" Q
"RTN","FBAACO3")
0^16^B57937070^B58658444
"RTN","FBAACO3",1,0)
FBAACO3 ;AISC/GRR - ENTER PAYMENT CONTINUED ;12/4/14  14:11
"RTN","FBAACO3",2,0)
 ;;3.5;FEE BASIS;**4,38,55,61,116,122,133,108,124,143,139,157,154,158**;JAN 30, 1995;Build 94
"RTN","FBAACO3",3,0)
 ;;Per VA Directive 6402, this routine should not be modified.
"RTN","FBAACO3",4,0)
 ;
"RTN","FBAACO3",5,0)
 ;FB*3.5*157 Modify file 162, Diagnosis (field 28) stuff from '///' to '////'
"RTN","FBAACO3",6,0)
 ;           since needed file 80 dx IEN is already passed back from DX 
"RTN","FBAACO3",7,0)
 ;           lookup.
"RTN","FBAACO3",8,0)
 ;
"RTN","FBAACO3",9,0)
DOEDIT ;
"RTN","FBAACO3",10,0)
 N FB1725,FBFPPSC
"RTN","FBAACO3",11,0)
 W ! S FBAACP(0)=FBAACP
"RTN","FBAACO3",12,0)
 S DIC="^FBAAC("_DFN_",1,"_FBV_",1,"_FBSDI_",1,"
"RTN","FBAACO3",13,0)
 S DIC(0)="EQMZ",DA(3)=DFN,DA(2)=FBV,DA(1)=FBSDI
"RTN","FBAACO3",14,0)
 S X=$$CPT^FBAAUTL4(FBAACP)
"RTN","FBAACO3",15,0)
 D ^DIC I Y<0 S FBAAOUT=1 Q
"RTN","FBAACO3",16,0)
 S (DA,FBAACPI)=+Y,K=$P(Y(0),U,3),FBZBN=$P(Y(0),U,8),FBZBS=$S(FBZBN]"":$P($G(^FBAA(161.7,FBZBN,"ST")),U),1:""),FBAAPTC=$P(Y(0),U,20),J(0)=$P(Y(0),U,2)
"RTN","FBAACO3",17,0)
 ; set FB1725 true (1) if payment is for a Mill Bill claim
"RTN","FBAACO3",18,0)
 S FB1725=$S($P(Y(0),U,13)["FB583":+$P($G(^FB583(+$P(Y(0),U,13),0)),U,28),1:0)
"RTN","FBAACO3",19,0)
 S FBAAMM1=$P($G(^FBAAC(DFN,1,FBV,1,FBSDI,1,FBAACPI,2)),U,2)
"RTN","FBAACO3",20,0)
 S FBCNTRP=$P($G(^FBAAC(DFN,1,FBV,1,FBSDI,1,FBAACPI,3)),U,8)
"RTN","FBAACO3",21,0)
 S FBFSAMT(0)=$P($G(^FBAAC(DFN,1,FBV,1,FBSDI,1,FBAACPI,2)),U,12)
"RTN","FBAACO3",22,0)
 ; determine lesser of original fee schedule amount and amount claimed
"RTN","FBAACO3",23,0)
 S FBAMTPD(0)=$S(FBFSAMT(0)="":J(0),FBFSAMT(0)>J(0):J(0),1:FBFSAMT(0))
"RTN","FBAACO3",24,0)
 S FBMODL=$$MODL^FBAAUTL4("^FBAAC("_DFN_",1,"_FBV_",1,"_FBSDI_",1,"_FBAACPI_",""M"")")
"RTN","FBAACO3",25,0)
 ; load current adjustment data
"RTN","FBAACO3",26,0)
 D LOADADJ^FBAAFA(FBAACPI_","_FBSDI_","_FBV_","_DFN_",",.FBADJ)
"RTN","FBAACO3",27,0)
 ; save adjustment data prior to edit session in sorted list
"RTN","FBAACO3",28,0)
 S FBADJL(0)=$$ADJL^FBUTL2(.FBADJ) ; sorted list of original adjustments
"RTN","FBAACO3",29,0)
 ; load current remittance remark data
"RTN","FBAACO3",30,0)
 D LOADRR^FBAAFR(FBAACPI_","_FBSDI_","_FBV_","_DFN_",",.FBRRMK)
"RTN","FBAACO3",31,0)
 ; save remittance remarks prior to edit session in sorted list
"RTN","FBAACO3",32,0)
 S FBRRMKL(0)=$$RRL^FBUTL4(.FBRRMK)
"RTN","FBAACO3",33,0)
 ; load FPPS data
"RTN","FBAACO3",34,0)
 S FBFPPSC=$P($G(^FBAAC(DFN,1,FBV,1,FBSDI,1,FBAACPI,3)),U)
"RTN","FBAACO3",35,0)
 S FBFPPSL=$P($G(^FBAAC(DFN,1,FBV,1,FBSDI,1,FBAACPI,3)),U,2)
"RTN","FBAACO3",36,0)
 I FBZBS=""!(FBZBS="V") D NOGO S FBAAOUT=1 Q
"RTN","FBAACO3",37,0)
 ; first edit CPT code and modifiers
"RTN","FBAACO3",38,0)
 D CPTM^FBAALU(FBAADT,DFN,FBAACP(0),FBMODL) I '$G(FBGOT) S FBAAOUT=1 Q
"RTN","FBAACO3",39,0)
 ; if CPT was changed then update file
"RTN","FBAACO3",40,0)
 I FBAACP'=FBAACP(0) D  I FBAACP="@" S FBAAOUT=1 Q
"RTN","FBAACO3",41,0)
 . N FBIENS,FBFDA
"RTN","FBAACO3",42,0)
 . S FBIENS=FBAACPI_","_FBSDI_","_FBV_","_DFN_","
"RTN","FBAACO3",43,0)
 . S FBFDA(162.03,FBIENS,.01)=FBAACP
"RTN","FBAACO3",44,0)
 . D FILE^DIE("","FBFDA") D MSG^DIALOG()
"RTN","FBAACO3",45,0)
 ; if modifiers changed then update file
"RTN","FBAACO3",46,0)
 I FBMODL'=$$MODL^FBAAUTL4("FBMODA") D REPMOD^FBAAUTL4(DFN,FBV,FBSDI,FBAACPI)
"RTN","FBAACO3",47,0)
 ; now edit remaining fields
"RTN","FBAACO3",48,0)
 D SETO K DR
"RTN","FBAACO3",49,0)
 ;JAS - 09/13/13 - PATCH 139 - Added FBDXCHK1 and FBDXCHK2
"RTN","FBAACO3",50,0)
 N FBDXCHK1 S FBDXCHK1=";S:FBAADT<$$IMPDATE^FBCSV1(""10D"") Y=""@20"";@15;S XX1=-1 S XX1=$$ASKICD10^FBAACO2(FBAADT) S:XX1<0 Y=""@15"";28////^S X=XX1;S Y=""@21"";"   ;;FB*3.5*157
"RTN","FBAACO3",51,0)
 S FBDXCHK1=FBDXCHK1_"@20;S XX1=$$ASKICD9^FBAACO2(FBAADT) S:+XX1<0 Y=""@20"";28////^S X=+XX1;@21;31;32R;S Y=""@7"";"
"RTN","FBAACO3",52,0)
 N FBDXCHK2 S FBDXCHK2=";S:FBAADT<$$IMPDATE^FBCSV1(""10D"") Y=""@26"";@25;S XX1=-1 S XX1=$$ASKICD10^FBAACO2(FBAADT) S:XX1<0 Y=""@25"";28////^S X=XX1;S Y=""@30"";@26;"   ;;FB*3.5*157
"RTN","FBAACO3",53,0)
 S DR="48;47;S FBUNITS=X;42R;S FBZIP=X;S:$$ANES^FBAAFS($$CPT^FBAAUTL4(FBAACP)) Y=""@2"";43///@;S FBTIME=X;S Y=""@3"";@2;43R;S FBTIME=X;@3"
"RTN","FBAACO3",54,0)
 ; fb*3.5*116 remove edit of interest indicator (162.03,34) to prevent different interest indicator values at line item level; interest indicator set at invoice level only
"RTN","FBAACO3",55,0)
 S DR(1,162.03,1)="S FBAAMM=$S(FBAAPTC=""R"":"""",1:1);D PPT^FBAACO1(FBAAMM1,FBCNTRP,1);34///@;34////^S X=FBAAMM1;54///@;54////^S X=FBCNTRP;30R;S FBHCFA(30)=X;1;S J=X;Q"
"RTN","FBAACO3",56,0)
 S DR(1,162.03,2)="D FEEDT^FBAACO3;44///@;44///^S X=FBFSAMT;45///@;45///^S X=FBFSUSD;S:FBAMTPD'>0!(FBAMTPD=FBAMTPD(0)) Y=""@4"";2///^S X=FBAMTPD;@4;2//^S X=FBAMTPD;S K=X"
"RTN","FBAACO3",57,0)
 S DR(1,162.03,3)="K FBADJD;M FBADJD=FBADJ;S FBX=$$ADJ^FBUTL2(J-K,.FBADJ,5,,.FBADJD,1,.FBRRMK,1)"
"RTN","FBAACO3",58,0)
 S DR(1,162.03,4)="S:FBFPPSC="""" Y=13;W !,""FPPS CLAIM ID: ""_FBFPPSC;S FBX=$$FPPSL^FBUTL5(FBFPPSL,,1);51///^S X=FBX;S FBFPPSL=X;@13;13;I $$BADDATE^FBAACO3(FBAADT,X) S Y=""@13"";33"
"RTN","FBAACO3",59,0)
 ;JAS - 09/13/13 - PATCH 139 - Updated line below for ICD-10
"RTN","FBAACO3",60,0)
 S DR(1,162.03,5)="S:$$EXTPV^FBAAUTL5(FBPOV)=""01"" Y=""@1"";S Y=$S('$D(FB7078):""@5"",FB7078]"""":""@21"",1:""@5"");@5"_FBDXCHK1_"@1"_FBDXCHK2_"S XX1=$$ASKICD9^FBAACO2(FBAADT) S:+XX1<0 Y=""@26"";28////^S X=+XX1;@30;31"
"RTN","FBAACO3",61,0)
 S DR(1,162.03,6)="73;74;75;58;59;60;61;62;63;64;65;66;67;76;77;78;79;68;69"
"RTN","FBAACO3",62,0)
 S DR(1,162.03,7)="82///^S X=$$PYMTH^FBAAUTL(FBFSUSD)" ;FB*3.5*158
"RTN","FBAACO3",63,0)
 S DIE="^FBAAC("_DFN_",1,"_FBV_",1,"_FBSDI_",1,",DIE("NO^")="",FBOT=1
"RTN","FBAACO3",64,0)
 D LOCK^FBUCUTL("^FBAAC("_DFN_",1,"_FBV_",1,"_FBSDI_",1,",FBAACPI) I 'FBLOCK S FBAAOUT=1 Q
"RTN","FBAACO3",65,0)
 D ^DIE
"RTN","FBAACO3",66,0)
 ; if adjustment data changed then file
"RTN","FBAACO3",67,0)
 I $$ADJL^FBUTL2(.FBADJ)'=FBADJL(0) D FILEADJ^FBAAFA(FBAACPI_","_FBSDI_","_FBV_","_DFN_",",.FBADJ)
"RTN","FBAACO3",68,0)
 ; if remit remark data changed then file
"RTN","FBAACO3",69,0)
 I $$RRL^FBUTL4(.FBRRMK)'=FBRRMKL(0) D FILERR^FBAAFR(FBAACPI_","_FBSDI_","_FBV_","_DFN_",",.FBRRMK)
"RTN","FBAACO3",70,0)
 L -^FBAAC(DFN,1,FBV,1,FBSDI,1,FBAACPI) K FBOT,DIE,DR,DA
"RTN","FBAACO3",71,0)
 Q:$D(FBDL)
"RTN","FBAACO3",72,0)
 I $G(FBAAIN) S FBINTOT=0 D CALC
"RTN","FBAACO3",73,0)
 Q
"RTN","FBAACO3",74,0)
 ;
"RTN","FBAACO3",75,0)
BADDATE(FBDOS,INVRCVDT) ;Reject entry if InvRcvDt is Prior to the Date of Service on the Invoice
"RTN","FBAACO3",76,0)
 I INVRCVDT<FBDOS D  Q 1 ;Reject entry
"RTN","FBAACO3",77,0)
 .N SHOWDOS  S SHOWDOS=$E(FBDOS,4,5)_"/"_$E(FBDOS,6,7)_"/"_$E(FBDOS,2,3) ;Convert FBDOS into display format for error message
"RTN","FBAACO3",78,0)
 .W *7,!!?5,"*** Invoice Received Date cannot be prior to the",!?8," Date of Service ("_SHOWDOS_") !!!"
"RTN","FBAACO3",79,0)
 Q 0 ;Accept entry
"RTN","FBAACO3",80,0)
 ;
"RTN","FBAACO3",81,0)
SETO S FY=$E(FBAADT,1,3)+1700+$S($E(FBAADT,4,5)>9:1,1:0)
"RTN","FBAACO3",82,0)
 Q
"RTN","FBAACO3",83,0)
OUT ;
"RTN","FBAACO3",84,0)
 ; FB*3.5*116 count line items that have 0.00 amount paid
"RTN","FBAACO3",85,0)
 ;I K>0 S Z1=$P(^FBAA(161.7,FBAABE,0),"^",11)+1,$P(^(0),"^",11)=Z1,FBINTOT=FBINTOT+K
"RTN","FBAACO3",86,0)
 S Z1=$P(^FBAA(161.7,FBAABE,0),"^",11)+1,$P(^(0),"^",11)=Z1,FBINTOT=FBINTOT+K
"RTN","FBAACO3",87,0)
 Q
"RTN","FBAACO3",88,0)
CKMAX S (FBAOT,A)=0,O="" F Z=S-.1:0 S Z=$O(^FBAAC(DFN,"AB",Z)) Q:Z'>0!(Z>R)  F Q=0:0 S Q=$O(^FBAAC(DFN,"AB",Z,Q)) Q:Q'>0  S W=$O(^FBAAC(DFN,"AB",Z,Q,0)) I $D(^FBAAC(DFN,1,Q,1,W,0)) D SMORE
"RTN","FBAACO3",89,0)
 I A>$P(FBSITE(1),"^",9) G NO
"RTN","FBAACO3",90,0)
 Q
"RTN","FBAACO3",91,0)
SMORE N FBA,FBB S FBB=$P($G(^FBAAC(+DFN,1,+Q,1,+W,0)),U,4),E=0
"RTN","FBAACO3",92,0)
 F  S E=$O(^FBAAC(DFN,1,Q,1,W,1,E)) Q:'E  S FBA=$G(^(E,0)) I $P(FBA,"^",9)=2,$P(FBA,"^",18)'=1 D
"RTN","FBAACO3",93,0)
 .I $$IDCHK^FBAAUTL3(DFN,FBB) S A=A+$P(FBA,"^",3) Q
"RTN","FBAACO3",94,0)
 .S FBAOT=FBAOT+$P(FBA,U,3)
"RTN","FBAACO3",95,0)
 Q
"RTN","FBAACO3",96,0)
NO W !!,*7,"Warning Patient already at maximum allowed for month of service",! Q
"RTN","FBAACO3",97,0)
WARN W !!,*7,"You have reached the maximum number of payments for a Batch!",!,"You must select another Batch for entering Payments!"
"RTN","FBAACO3",98,0)
CALC ;Calculate Current Invoice Total
"RTN","FBAACO3",99,0)
 F J=0:0 S J=$O(^FBAAC("C",FBAAIN,J)) Q:J'>0  F K=0:0 S K=$O(^FBAAC("C",FBAAIN,J,K)) Q:K'>0  F L=0:0 S L=$O(^FBAAC("C",FBAAIN,J,K,L)) Q:L'>0  F M=0:0 S M=$O(^FBAAC("C",FBAAIN,J,K,L,M)) Q:M'>0  D CALC1
"RTN","FBAACO3",100,0)
 K J,K,L,M,FZNODE Q
"RTN","FBAACO3",101,0)
CALC1 S FZNODE=^FBAAC(J,1,K,1,L,1,M,0),A2=$P(FZNODE,"^",3),FBINTOT=FBINTOT+A2,FBAAID=$P(FZNODE,"^",15),FBAAVID=$P($G(^FBAAC(J,1,K,1,L,1,M,2)),"^")
"RTN","FBAACO3",102,0)
 Q
"RTN","FBAACO3",103,0)
FEEDT ;
"RTN","FBAACO3",104,0)
 ;FB*3.5*143 Adding FB1725 as a parameter to prevent incorrect
"RTN","FBAACO3",105,0)
 ; reductions in local fee schedule pricing.
"RTN","FBAACO3",106,0)
 ; input FB1725 - true (=1) when edited payment is for a Mill BilL claim.
"RTN","FBAACO3",107,0)
 N FBX
"RTN","FBAACO3",108,0)
 D SETO:'$G(FY) S FBFY=FY-1
"RTN","FBAACO3",109,0)
 S (FBFSAMT,FBFSUSD)="",FBAMTPD=$G(FBAMTPD)
"RTN","FBAACO3",110,0)
 S FBX=$$GET^FBAAFS($$CPT^FBAAUTL4(FBAACP),$$MODL^FBAAUTL4("FBMODA","E"),FBAADT,$G(FBZIP),$$FAC^FBAAFS($G(FBHCFA(30))),$G(FBTIME),$G(FB1725))
"RTN","FBAACO3",111,0)
 I '$G(FBAAMM1) D
"RTN","FBAACO3",112,0)
 . S FBFSAMT=$P(FBX,U),FBFSUSD=$P(FBX,U,2)
"RTN","FBAACO3",113,0)
 E  D
"RTN","FBAACO3",114,0)
 . W !,?2,"Payment is for a contracted service so fee schedule does not apply."
"RTN","FBAACO3",115,0)
 I $P($G(FBX),U)]"" D
"RTN","FBAACO3",116,0)
 . W !?2,$S($G(FBAAMM1):"However, f",1:"F")
"RTN","FBAACO3",117,0)
 . W "ee schedule amount is $",$P(FBX,U)," from the "
"RTN","FBAACO3",118,0)
 . W:$P(FBX,U,3)]"" $P(FBX,U,3)," " ; year if returned
"RTN","FBAACO3",119,0)
 . W:$P(FBX,U,2)]"" $$EXTERNAL^DILFD(162.03,45,"",$P(FBX,U,2))
"RTN","FBAACO3",120,0)
 E  W !?2,"Unable to determine a FEE schedule amount."
"RTN","FBAACO3",121,0)
 ;
"RTN","FBAACO3",122,0)
 I FB1725 D
"RTN","FBAACO3",123,0)
 . W !!?2,"**Payment is for emergency treatment under 38 U.S.C. 1725."
"RTN","FBAACO3",124,0)
 . I FBFSAMT D
"RTN","FBAACO3",125,0)
 . . S FBFSAMT=$J(FBFSAMT*.7,0,2)
"RTN","FBAACO3",126,0)
 . . W !?2,"  Therefore, fee schedule amount reduced to $",FBFSAMT," (70%)."
"RTN","FBAACO3",127,0)
 ;
"RTN","FBAACO3",128,0)
 I $G(FBUNITS)>1 D
"RTN","FBAACO3",129,0)
 . W !!?2,"Units Paid = ",FBUNITS
"RTN","FBAACO3",130,0)
 . Q:FBFSAMT'>0
"RTN","FBAACO3",131,0)
 . N FBFSUNIT
"RTN","FBAACO3",132,0)
 . ; determine if fee schedule can be multiplied by units
"RTN","FBAACO3",133,0)
 . S FBFSUNIT=$S(FBFSUSD="R":1,FBFSUSD="F"&(FBAADT>3040930):1,1:0)
"RTN","FBAACO3",134,0)
 . I FBFSUNIT D
"RTN","FBAACO3",135,0)
 . . S FBFSAMT=$J(FBFSAMT*FBUNITS,0,2)
"RTN","FBAACO3",136,0)
 . . W !?2,"  Therefore, fee schedule amount increased to $",FBFSAMT
"RTN","FBAACO3",137,0)
 . E  D
"RTN","FBAACO3",138,0)
 . . W !?2,"  Fee schedule not complied on per unit basis so amount not adjusted by units."
"RTN","FBAACO3",139,0)
 ;
"RTN","FBAACO3",140,0)
 I '$G(FBAAMM1) D
"RTN","FBAACO3",141,0)
 . ; set default amount paid to lesser of amt claimed (J) or fee sched.
"RTN","FBAACO3",142,0)
 . S FBAMTPD=$S(FBFSAMT'>0:J,FBFSAMT>J:J,1:FBFSAMT)
"RTN","FBAACO3",143,0)
 W !
"RTN","FBAACO3",144,0)
 Q
"RTN","FBAACO3",145,0)
NOGO W !!,*7,"This payment CANNOT be edited.  The batch the payment is in",!,"has been Vouchered.  You may void the payment with the Void Payment option.",!
"RTN","FBAACO3",146,0)
 Q
"RTN","FBAACO3",147,0)
 ;
"RTN","FBAACO3",148,0)
SC W *7,!?4,"Suspense code is required!",! S Y="@4" Q
"RTN","FBAACO3",149,0)
 ;
"RTN","FBAACO3",150,0)
DEL ;delete date of service if no service provided entered
"RTN","FBAACO3",151,0)
 I '$O(^FBAAC(DFN,1,FBV,1,FBSDI,1,0)) D
"RTN","FBAACO3",152,0)
 .S DIK="^FBAAC(DFN,1,FBV,1,",DA(2)=DFN,DA(1)=FBV,DA=FBSDI D ^DIK W !!?5,*7,"Incomplete payment entry deleted.",!
"RTN","FBAACO3",153,0)
 K DIK,DA Q
"RTN","FBAADOB")
0^7^B2800687^B2793564
"RTN","FBAADOB",1,0)
FBAADOB ;AISC/GRR-DISPLAY OPEN BATCHES ;03JAN86
"RTN","FBAADOB",2,0)
 ;;3.5;FEE BASIS;**158**;JAN 30, 1995;Build 94
"RTN","FBAADOB",3,0)
 ;;Per VA Directive 6402, this routine should not be modified.
"RTN","FBAADOB",4,0)
 S IOP=$S($D(ION):ION,1:"HOME") D ^%ZIS K IOP S Q="",$P(Q,"=",80)="=",FBAAOUT=0
"RTN","FBAADOB",5,0)
 I '$D(^FBAA(161.7,"AC","O")) W !!,*7,"There are No Open Batches!",!! G Q
"RTN","FBAADOB",6,0)
 D HED
"RTN","FBAADOB",7,0)
 F B=0:0 S B=$O(^FBAA(161.7,"AC","O",B)) Q:B'>0!(FBAAOUT)  I $D(^FBAA(161.7,B,0)) S Z=^(0) D WRT
"RTN","FBAADOB",8,0)
Q K A,B1,B2,B3,B4,B5,Q,Z,B,BT,D,FBAAOUT,J,K,POP,X,Y Q
"RTN","FBAADOB",9,0)
HED W @IOF W !,"Batch #","  Type",?22,"Dt Open",?32,"Clerk Who Opened",?65,"Obligation #",!,Q
"RTN","FBAADOB",10,0)
 Q
"RTN","FBAADOB",11,0)
WRT I $Y+5>IOSL S DIR(0)="E" D ^DIR K DIR S:'Y FBAAOUT=1 Q:FBAAOUT  W @IOF D HED
"RTN","FBAADOB",12,0)
 S B1=$P(Z,"^",1),B4=$P(Z,"^",2),B2=$$DATX^FBAAUTL($P(Z,"^",4)),BT=$P(Z,"^",3)
"RTN","FBAADOB",13,0)
 S BT=$S(BT="B3":"Medical",BT="B5":"Pharmacy",BT="B2":"Travel",BT="B9":"CH/CNH",1:"Unknown")
"RTN","FBAADOB",14,0)
 S BT=$S($P($G(Z),U,19):BT_"-STAT",1:BT)
"RTN","FBAADOB",15,0)
 S B3=$S($P(Z,"^",5)]"":$P(Z,"^",5),1:""),B3=$S(B3="":"",$D(^VA(200,B3,0)):$P(^VA(200,B3,0),"^",1),1:"")
"RTN","FBAADOB",16,0)
 W !!,B1,?9,BT,?22,B2,?32,B3,?65,B4  ;FB*3.5*158
"RTN","FBAADOB",17,0)
 Q
"RTN","FBAAEPI")
0^17^B32470147^B33105165
"RTN","FBAAEPI",1,0)
FBAAEPI ;AISC/GRR - EDIT PREVIOUSLY ENTERED PHARMACY INVOICE ;11/20/2014
"RTN","FBAAEPI",2,0)
 ;;3.5;FEE BASIS;**38,61,124,132,123,154,158**;JAN 30, 1995;Build 94
"RTN","FBAAEPI",3,0)
 ;;Per VA Directive 6402, this routine should not be modified.
"RTN","FBAAEPI",4,0)
RD W ! S DIC="^FBAA(162.1,",DIC(0)="AEQM",DIC("A")="Select Invoice #: ",DIC("S")="I $P(^(0),U,5)'=4!($P(^(0),U,5)=4&$D(^XUSEC(""FBAA LEVEL 2"",DUZ)))" D ^DIC K DIC("S") G END:X=""!(X="^"),RD:Y<0
"RTN","FBAAEPI",5,0)
 S (DA,FBDA)=+Y,DIE=DIC
"RTN","FBAAEPI",6,0)
 ;
"RTN","FBAAEPI",7,0)
 ; loop thru Rx and enforce separation of duty
"RTN","FBAAEPI",8,0)
 I $$SODPINV(FBDA) D  G RD
"RTN","FBAAEPI",9,0)
 . W !!,"You cannot process this payment due to separation of duties."
"RTN","FBAAEPI",10,0)
 . W !,"You previously entered/edited an associated authorization."
"RTN","FBAAEPI",11,0)
 ;
"RTN","FBAAEPI",12,0)
 ; save FPPS data prior to edit session
"RTN","FBAAEPI",13,0)
 S (FBFPPSC,FBFPPSC(0))=$P($G(^FBAA(162.1,FBDA,0)),U,13)
"RTN","FBAAEPI",14,0)
 D LASTRXDT ;Look up last RX FILL DATE in selected invoice, for use in validating Invoice Received Date if it is edited.
"RTN","FBAAEPI",15,0)
 S DR="@1;1;I $$BADDATE^FBAAEPI(LASTRXDT,X) S Y=""@1"";Q;12;S FBX=$$FPPSC^FBUTL5(1,FBFPPSC);S:FBX=-1 Y=0;S:FBX="""" Y=""@10"";13///^S X=FBX;S FBFPPSC=X;S Y=""@15"";@10;13///@;S FBFPPSC="""";@15;3;5"
"RTN","FBAAEPI",16,0)
 D ^DIE K DIC
"RTN","FBAAEPI",17,0)
 ; if FPPS CLAIM ID changed, then update Rx's
"RTN","FBAAEPI",18,0)
 I FBFPPSC'=FBFPPSC(0) D CKINVEDI^FBAAEPI1(FBFPPSC(0),FBFPPSC,FBDA)
"RTN","FBAAEPI",19,0)
 S DIC="^FBAA(162.1,DA,""RX"",",DIC(0)="AEQM",DIC("W")="W ?30,""DATE RX FILLED: "",$E($P(^(0),U,3),4,5)_""/""_$E($P(^(0),U,3),6,7)_""/""_$E($P(^(0),U,3),2,3)" D ^DIC K DIC("W")
"RTN","FBAAEPI",20,0)
 I Y<0 D END G RD ; a prescription was not selected
"RTN","FBAAEPI",21,0)
 W !
"RTN","FBAAEPI",22,0)
 S (FBJ,FBK)=0
"RTN","FBAAEPI",23,0)
 ;check status of batch rx is in.
"RTN","FBAAEPI",24,0)
 S DA=+Y,DA(1)=FBDA S FBSTAT=$P($G(^FBAA(161.7,+$P($G(^FBAA(162.1,+FBDA,"RX",+DA,0)),U,17),"ST")),U) I FBSTAT]"" D
"RTN","FBAAEPI",25,0)
 .I '$D(^XUSEC("FBAA LEVEL 2",DUZ)) D
"RTN","FBAAEPI",26,0)
 .. I $S(FBSTAT="O":0,FBSTAT="C":0,1:1) D
"RTN","FBAAEPI",27,0)
 ... W !,*7,"You cannot edit a payment once released by a supervisor.",! S FBOUT=1 Q
"RTN","FBAAEPI",28,0)
 .I $S(FBSTAT="T":1,FBSTAT="F":1,FBSTAT="V":1,1:0) D
"RTN","FBAAEPI",29,0)
 .. W !,*7,"You cannot edit an invoice when the batch has been sent to Austin",! S FBOUT=1
"RTN","FBAAEPI",30,0)
 I $G(FBOUT) D END G FBAAEPI
"RTN","FBAAEPI",31,0)
 ;
"RTN","FBAAEPI",32,0)
 ; FB*3.5*123 - Edit pharmacy IPAC data for Federal Vendors
"RTN","FBAAEPI",33,0)
 I '$$IPACEDIT^FBAAPET1(162.1,.DA) D END G FBAAEPI
"RTN","FBAAEPI",34,0)
 ;
"RTN","FBAAEPI",35,0)
 S DIE="^FBAA(162.1,FBDA,""RX"","
"RTN","FBAAEPI",36,0)
 ; get current value of FPPS LINE ITEM to use as default
"RTN","FBAAEPI",37,0)
 S FBFPPSL=$P($G(^FBAA(162.1,FBDA,"RX",DA,3)),U)
"RTN","FBAAEPI",38,0)
 ; load current adjustment data
"RTN","FBAAEPI",39,0)
 D LOADADJ^FBRXFA(DA_","_FBDA_",",.FBADJ)
"RTN","FBAAEPI",40,0)
 ; save adjustment data prior to edit session in sorted list
"RTN","FBAAEPI",41,0)
 S FBADJL(0)=$$ADJL^FBUTL2(.FBADJ) ; sorted list of original adjustments
"RTN","FBAAEPI",42,0)
 ; load current remittance remark data
"RTN","FBAAEPI",43,0)
 D LOADRR^FBRXFR(DA_","_FBDA_",",.FBRRMK)
"RTN","FBAAEPI",44,0)
 ; save remittance remarks prior to edit session in sorted list
"RTN","FBAAEPI",45,0)
 S FBRRMKL(0)=$$RRL^FBUTL4(.FBRRMK)
"RTN","FBAAEPI",46,0)
 S DR=".01;S:FBFPPSC="""" Y=1;S FBX=$$FPPSL^FBUTL5(FBFPPSL);S:FBX=-1 Y=0;36///^S X=FBX;S FBFPPSL=X;1;1.5;1.6;3;S FBJ=X;I $P(^FBAA(162.1,DA(1),""RX"",DA,0),U,9)=1 S Y="""";I 1;5"
"RTN","FBAAEPI",47,0)
 S DR(1,162.11,1)="S FBA=$P($G(^FBAA(162.1,DA(1),""RX"",DA,2)),U,6);S FB1725=$S(FBA[""FB583"":+$P($G(^FB583(+FBA,0)),U,28),1:0);W:FB1725 !?2,""**Payment is for emergency treatment under 38 U.S.C. 1725."""
"RTN","FBAAEPI",48,0)
 S DR(1,162.11,2)="@12;S FBHAP=$P(^FBAA(162.1,DA(1),""RX"",DA,0),U,16);6.5;S FBK=X;S:FBK]"""" Y=""@20"";K FBADJ,FBRRMK;S Y=8"
"RTN","FBAAEPI",49,0)
 S DR(1,162.11,3)="@20;I FBK>FBJ S $P(^FBAA(162.1,DA(1),""RX"",DA,0),U,16)=FBHAP W !,*7,""Amount Paid cannot be greater than the Amount Claimed"" S Y=""@12"""
"RTN","FBAAEPI",50,0)
 S DR(1,162.11,4)="K FBADJD;M FBADJD=FBADJ;S FBX=$$ADJ^FBUTL2(FBJ-FBK,.FBADJ,5,,.FBADJD,1,.FBRRMK,1);K FBADJD;S:FBX=-1 Y=0;8"
"RTN","FBAAEPI",51,0)
 D ^DIE
"RTN","FBAAEPI",52,0)
 I '$D(DA) D END G RD ; prescription was deleted
"RTN","FBAAEPI",53,0)
 ; if adjustment data changed then file
"RTN","FBAAEPI",54,0)
 I $$ADJL^FBUTL2(.FBADJ)'=FBADJL(0) D FILEADJ^FBRXFA(DA_","_FBDA_",",.FBADJ)
"RTN","FBAAEPI",55,0)
 ; if remit remark data changed then file
"RTN","FBAAEPI",56,0)
 I $$RRL^FBUTL4(.FBRRMK)'=FBRRMKL(0) D FILERR^FBRXFR(DA_","_FBDA_",",.FBRRMK)
"RTN","FBAAEPI",57,0)
 ; clean up and return to invoice selection
"RTN","FBAAEPI",58,0)
 D END G RD
"RTN","FBAAEPI",59,0)
 ;
"RTN","FBAAEPI",60,0)
LASTRXDT ;Look up last RX FILL DATE in selected invoice, for use in validating Invoice Received Date if it is edited.
"RTN","FBAAEPI",61,0)
 ;DA contains the selected INV#
"RTN","FBAAEPI",62,0)
 N I
"RTN","FBAAEPI",63,0)
 S LASTRXDT=0
"RTN","FBAAEPI",64,0)
 F I=1:1 Q:'$D(^FBAA(162.1,DA,"RX",I))  D
"RTN","FBAAEPI",65,0)
 .N RXDT S RXDT=$P(^FBAA(162.1,DA,"RX",I,0),"^",3)
"RTN","FBAAEPI",66,0)
 .I RXDT>LASTRXDT S LASTRXDT=RXDT,RXNUM=$P(^FBAA(162.1,DA,"RX",I,0),"^",1)
"RTN","FBAAEPI",67,0)
 Q
"RTN","FBAAEPI",68,0)
 ;
"RTN","FBAAEPI",69,0)
BADDATE(LASTRXDT,INVRCVDT) ;Reject entry if InvRcvDt is Prior to the last Rx Fill Date on the Invoice
"RTN","FBAAEPI",70,0)
 I INVRCVDT<LASTRXDT D  Q 1 ;Reject entry
"RTN","FBAAEPI",71,0)
 .N SHOWRXDT  S SHOWRXDT=$E(LASTRXDT,4,5)_"/"_$E(LASTRXDT,6,7)_"/"_$E(LASTRXDT,2,3) ;Convert RXDT into display format for error message
"RTN","FBAAEPI",72,0)
 .W *7,!!?5,"*** Invoice Received Date cannot be prior to the last",!?8," Prescription Filled Date on the Invoice ("_SHOWRXDT_" for RX# "_RXNUM_") !!!"
"RTN","FBAAEPI",73,0)
 Q 0 ;Accept entry
"RTN","FBAAEPI",74,0)
 ;
"RTN","FBAAEPI",75,0)
END K D,DA,DIC,DIE,DR,FBJ,FBK,FBDA,FBOUT,FBSTAT,FBHAP,X,Y,FBA,FB1725
"RTN","FBAAEPI",76,0)
 K FBADJ,FBADJD,FBADJL,FBFPPSC,FBFPPSL,FBRRMK,FBRRMKD,FBRRMKL,LASTRXDT,RXNUM
"RTN","FBAAEPI",77,0)
 Q
"RTN","FBAAEPI",78,0)
 ;
"RTN","FBAAEPI",79,0)
GETIPAC(FBDA,FBVEN,FBIA,FBDODINV) ; Get vendor/IPAC data for Pharmacy (FB*3.5*123)
"RTN","FBAAEPI",80,0)
 ; All parameters required and assumed to exist
"RTN","FBAAEPI",81,0)
 ; Called by $$IPACEDIT^FBAAPET1
"RTN","FBAAEPI",82,0)
 S FBVEN=+$P($G(^FBAA(162.1,FBDA(1),0)),U,4)               ; vendor ien
"RTN","FBAAEPI",83,0)
 S FBIA=+$P($G(^FBAA(162.1,FBDA(1),0)),U,23)               ; IPAC agreement ien
"RTN","FBAAEPI",84,0)
 S FBDODINV=$P($G(^FBAA(162.1,FBDA(1),"RX",FBDA,6)),U,1)   ; DoD invoice#
"RTN","FBAAEPI",85,0)
 Q
"RTN","FBAAEPI",86,0)
 ;
"RTN","FBAAEPI",87,0)
DELIPAC(FBDA) ; Delete all IPAC data on file for Pharmacy (FB*3.5*123)
"RTN","FBAAEPI",88,0)
 ; Called by $$IPACEDIT^FBAAPET1
"RTN","FBAAEPI",89,0)
 N FBIENS,FBIAFDA,DIE,DA,DR,DIC
"RTN","FBAAEPI",90,0)
 S FBIENS=FBDA_","_FBDA(1)_","
"RTN","FBAAEPI",91,0)
 S FBIAFDA(162.11,FBIENS,39)=""       ; remove DoD invoice# from subfile 162.11
"RTN","FBAAEPI",92,0)
 D FILE^DIE("","FBIAFDA")
"RTN","FBAAEPI",93,0)
 S DIE=162.1,DA=FBDA(1),DR="14///@" D ^DIE  ; remove IPAC ptr from file top level 162.1
"RTN","FBAAEPI",94,0)
 Q
"RTN","FBAAEPI",95,0)
 ;
"RTN","FBAAEPI",96,0)
SAVEIPAC(FBDA,FBIA,FBDODINV,WHICH) ; Store IPAC data into the database for Pharmacy (FB*3.5*123)
"RTN","FBAAEPI",97,0)
 ; Called by $$IPACEDIT^FBAAPET1
"RTN","FBAAEPI",98,0)
 N FBIENS,FBIAFDA,DIE,DA,DR,DIC
"RTN","FBAAEPI",99,0)
 S:'$D(WHICH) WHICH=""
"RTN","FBAAEPI",100,0)
 S FBIENS=FBDA_","_FBDA(1)_","
"RTN","FBAAEPI",101,0)
 I WHICH'=1 D
"RTN","FBAAEPI",102,0)
 . S FBIAFDA(162.11,FBIENS,39)=FBDODINV       ; store DoD invoice# in subfile 162.11
"RTN","FBAAEPI",103,0)
 . D FILE^DIE("","FBIAFDA")
"RTN","FBAAEPI",104,0)
 I WHICH'=2 D
"RTN","FBAAEPI",105,0)
 . S DIE=162.1,DA=FBDA(1),DR="14////^S X=FBIA" D ^DIE    ; store IPAC pointer ien in file top level 162.1
"RTN","FBAAEPI",106,0)
 Q
"RTN","FBAAEPI",107,0)
 ;
"RTN","FBAAEPI",108,0)
SODPINV(FBDA) ; check separation of duty for pharmacy invoice
"RTN","FBAAEPI",109,0)
 ; checks all prescriptions on invoice for separation of duty issue
"RTN","FBAAEPI",110,0)
 ; input
"RTN","FBAAEPI",111,0)
 ;   FBDA (required) IEN of pharmacy invoice in file 162.1
"RTN","FBAAEPI",112,0)
 ;   DUZ (current user)
"RTN","FBAAEPI",113,0)
 ; result
"RTN","FBAAEPI",114,0)
 ;   = 0 if user did not enter or edit any associated authorization
"RTN","FBAAEPI",115,0)
 ;   = 1 if user did enter or edit at least one associated authorization
"RTN","FBAAEPI",116,0)
 ;     and thus should be prevented from processing the payment
"RTN","FBAAEPI",117,0)
 N FBDFN,FBFTP,FBI,FBRET
"RTN","FBAAEPI",118,0)
 S FBRET=0
"RTN","FBAAEPI",119,0)
 ; loop thru all Rx on invoice
"RTN","FBAAEPI",120,0)
 S FBI=0 F  S FBI=$O(^FBAA(162.1,FBDA,"RX",FBI)) Q:'FBI  D  Q:FBRET
"RTN","FBAAEPI",121,0)
 . S FBDFN=$P($G(^FBAA(162.1,FBDA,"RX",FBI,0)),U,5)
"RTN","FBAAEPI",122,0)
 . Q:'FBDFN
"RTN","FBAAEPI",123,0)
 . S FBFTP=$P($G(^FBAA(162.1,FBDA,"RX",FBI,2)),U,7)
"RTN","FBAAEPI",124,0)
 . Q:'FBFTP
"RTN","FBAAEPI",125,0)
 . I '$$UOKPAY^FBUTL9(FBDFN,FBFTP) S FBRET=1
"RTN","FBAAEPI",126,0)
 Q FBRET
"RTN","FBAAFR")
0^14^B13991294^B2615408
"RTN","FBAAFR",1,0)
FBAAFR ;WOIFO/SAB-FILE REMITTANCE REMARKS FOR MEDICAL/ANC PAYMENT ;7/16/2003
"RTN","FBAAFR",2,0)
 ;;3.5;FEE BASIS;**61,158**;JAN 30, 1995;Build 94
"RTN","FBAAFR",3,0)
 ;;Per VA Directive 6402, this routine should not be modified.
"RTN","FBAAFR",4,0)
 Q
"RTN","FBAAFR",5,0)
FILERR(FBIENS,FBRRMK) ; File Remittance Remakrs
"RTN","FBAAFR",6,0)
 ;
"RTN","FBAAFR",7,0)
 ; Input
"RTN","FBAAFR",8,0)
 ;   FBIENS -  required, internal entry numbers for subfile 162.03
"RTN","FBAAFR",9,0)
 ;             in standard format as specified for FileMan DBS calls
"RTN","FBAAFR",10,0)
 ;   FBRRMK -  required, array passed by reference
"RTN","FBAAFR",11,0)
 ;             array of remittance remarks to file
"RTN","FBAAFR",12,0)
 ;             array does not have to contain any data or be defined
"RTN","FBAAFR",13,0)
 ;             format
"RTN","FBAAFR",14,0)
 ;               FBRRMK(FBADJ,#)=FBRRMKC
"RTN","FBAAFR",15,0)
 ;             where
"RTN","FBAAFR",16,0)
 ;               FBADJ = Adjustment Reason Code IEN
"RTN","FBAAFR",17,0)
 ;               # = sequentially assigned number starting with 1
"RTN","FBAAFR",18,0)
 ;               FBRRMKC = remittance remark (internal value file 162.93)
"RTN","FBAAFR",19,0)
 ; Output
"RTN","FBAAFR",20,0)
 ;   Data in File 162.03 will be modified
"RTN","FBAAFR",21,0)
 ;
"RTN","FBAAFR",22,0)
 N FB,FBFDA,FBI,FBSIENS,FBADJ,CNTR,ADJDA
"RTN","FBAAFR",23,0)
 ;
"RTN","FBAAFR",24,0)
 ; delete remitance remarks currently on file
"RTN","FBAAFR",25,0)
 D GETS^DIQ(162.03,FBIENS,"53*","","FB")
"RTN","FBAAFR",26,0)
 K FBFDA
"RTN","FBAAFR",27,0)
 S FBSIENS="" F  S FBSIENS=$O(FB(162.08,FBSIENS)) Q:FBSIENS=""  D
"RTN","FBAAFR",28,0)
 . S FBFDA(162.08,FBSIENS,.01)="@"
"RTN","FBAAFR",29,0)
 I $D(FBFDA) D FILE^DIE("","FBFDA")
"RTN","FBAAFR",30,0)
 ;
"RTN","FBAAFR",31,0)
 ; file remarks from input array
"RTN","FBAAFR",32,0)
 K FBFDA
"RTN","FBAAFR",33,0)
 ;FB*3.5*158
"RTN","FBAAFR",34,0)
 S (FBADJ,CNTR)=0
"RTN","FBAAFR",35,0)
 D DA^DILF(FBIENS,.FBDA)
"RTN","FBAAFR",36,0)
 F  S FBADJ=$O(FBRRMK(FBADJ)) Q:'FBADJ  D
"RTN","FBAAFR",37,0)
 . ;S ADJDA=$$GETADJI(FBADJ,.FBDA)
"RTN","FBAAFR",38,0)
 . S ADJDA=$S(FBADJ'=999:$$GETADJI(FBADJ,.FBDA),1:FBADJ) ;999 indicates a CARCless RARC
"RTN","FBAAFR",39,0)
 . S FBI=0
"RTN","FBAAFR",40,0)
 . F  S FBI=$O(FBRRMK(FBADJ,FBI)) Q:'FBI  D
"RTN","FBAAFR",41,0)
 . . S CNTR=CNTR+1
"RTN","FBAAFR",42,0)
 . . S FBFDA(162.08,"+"_CNTR_","_FBIENS,.01)=$P(FBRRMK(FBADJ,FBI),U)
"RTN","FBAAFR",43,0)
 . . S FBFDA(162.08,"+"_CNTR_","_FBIENS,1)=ADJDA
"RTN","FBAAFR",44,0)
 I $D(FBFDA) D UPDATE^DIE("","FBFDA")
"RTN","FBAAFR",45,0)
 Q
"RTN","FBAAFR",46,0)
 ;
"RTN","FBAAFR",47,0)
GETADJI(ADJI,FBDA) ; get correct DA from ADJUSTMENT multiple
"RTN","FBAAFR",48,0)
 ;
"RTN","FBAAFR",49,0)
 N DA
"RTN","FBAAFR",50,0)
 I $D(FBDA)'=11 Q ""
"RTN","FBAAFR",51,0)
 S DA=""
"RTN","FBAAFR",52,0)
 I $G(FBDA),$G(FBDA(1)),$G(FBDA(2)),$G(FBDA(3)),$G(ADJI) D
"RTN","FBAAFR",53,0)
 . I $D(^FBAAC(FBDA(3),1,FBDA(2),1,FBDA(1),1,FBDA,7,"B",ADJI)) D
"RTN","FBAAFR",54,0)
 . . S DA=$O(^FBAAC(FBDA(3),1,FBDA(2),1,FBDA(1),1,FBDA,7,"B",ADJI,DA))
"RTN","FBAAFR",55,0)
 Q DA
"RTN","FBAAFR",56,0)
 ;
"RTN","FBAAFR",57,0)
LOADRR(FBIENS,FBRRMK) ; Load Remittance Remarks
"RTN","FBAAFR",58,0)
 ; Input
"RTN","FBAAFR",59,0)
 ;   FBIENS -  required, internal entry numbers for subfile 162.03
"RTN","FBAAFR",60,0)
 ;             in standard format as specified for FileMan DBS calls
"RTN","FBAAFR",61,0)
 ;   FBRRMK - required, array passed by reference
"RTN","FBAAFR",62,0)
 ;             array to load adjustments into
"RTN","FBAAFR",63,0)
 ; Output
"RTN","FBAAFR",64,0)
 ;   FBRRMK - the FBRRMK input array passed by reference will be modified
"RTN","FBAAFR",65,0)
 ;             format
"RTN","FBAAFR",66,0)
 ;               FBRRMK(ADJI,#)=FBRRMKC
"RTN","FBAAFR",67,0)
 ;             where
"RTN","FBAAFR",68,0)
 ;               ADJI = ADJUSTMENT REASON IEN
"RTN","FBAAFR",69,0)
 ;               # = sequentially assigned number starting with 1
"RTN","FBAAFR",70,0)
 ;               FBRRMKC = remittance remark (internal value file 162.93)
"RTN","FBAAFR",71,0)
 ;             if no remarks are on file then the array will be undefined
"RTN","FBAAFR",72,0)
 N FB,FBC,FBI,FBSIENS,FBDA,RRI,ADJMI,ADJI
"RTN","FBAAFR",73,0)
 ;
"RTN","FBAAFR",74,0)
 K FBRRMK
"RTN","FBAAFR",75,0)
 ;
"RTN","FBAAFR",76,0)
 S FBC=0,ADJMI=""
"RTN","FBAAFR",77,0)
 D DA^DILF(FBIENS,.FBDA)
"RTN","FBAAFR",78,0)
 I $D(FBDA)'=11 Q
"RTN","FBAAFR",79,0)
 D GETS^DIQ(162.03,FBIENS,"53*","I","FB")
"RTN","FBAAFR",80,0)
 S FBSIENS=""
"RTN","FBAAFR",81,0)
 F  S FBSIENS=$O(FB(162.08,FBSIENS)) Q:FBSIENS=""  D
"RTN","FBAAFR",82,0)
 . S RRI=FB(162.08,FBSIENS,.01,"I")
"RTN","FBAAFR",83,0)
 . S ADJMI=FB(162.08,FBSIENS,1,"I")
"RTN","FBAAFR",84,0)
 . I ADJMI,$D(^FBAAC(FBDA(3),1,FBDA(2),1,FBDA(1),1,FBDA,7,ADJMI,0)) D
"RTN","FBAAFR",85,0)
 . . S ADJI=$P(^FBAAC(FBDA(3),1,FBDA(2),1,FBDA(1),1,FBDA,7,ADJMI,0),U)
"RTN","FBAAFR",86,0)
 . E  S ADJI=999
"RTN","FBAAFR",87,0)
 . S FBC=$S($D(FBRRMK(ADJI)):$O(FBRRMK(ADJI,FBC)),1:0)
"RTN","FBAAFR",88,0)
 . S FBRRMK(ADJI,FBC+1)=RRI
"RTN","FBAAFR",89,0)
 ;
"RTN","FBAAFR",90,0)
 Q
"RTN","FBAAFR",91,0)
 ;
"RTN","FBAAFR",92,0)
RRL(FBIENS) ; Remittance Remarks List Extrinsic Function
"RTN","FBAAFR",93,0)
 ; Input
"RTN","FBAAFR",94,0)
 ;   FBIENS -  required, internal entry numbers for subfile 162.03
"RTN","FBAAFR",95,0)
 ;             in standard format as specified for FileMan DBS calls
"RTN","FBAAFR",96,0)
 ; Result
"RTN","FBAAFR",97,0)
 ;   string containing sorted list (by external code) of remarks
"RTN","FBAAFR",98,0)
 ;   format
"RTN","FBAAFR",99,0)
 ;      FBRRMKCE 1, FBRRMKCE 2
"RTN","FBAAFR",100,0)
 ;   where
"RTN","FBAAFR",101,0)
 ;      FBRRMKCE = remittance remark code (external value)
"RTN","FBAAFR",102,0)
 N FBRET,FBRRMK
"RTN","FBAAFR",103,0)
 D LOADRR^FBAAFR(FBIENS,.FBRRMK)
"RTN","FBAAFR",104,0)
 S FBRET=$$RRL^FBUTL4(.FBRRMK)
"RTN","FBAAFR",105,0)
 Q FBRET
"RTN","FBAAFR",106,0)
 ;
"RTN","FBAAFR",107,0)
KILLRR(X,DA) ; Called from FEE BASIS PAYMENT (#162), 
"RTN","FBAAFR",108,0)
 ;             ADJUSTMENT (#162.03,52), ADJUSTMENT REASON (162.07, .01)
"RTN","FBAAFR",109,0)
 ;             to delete remittance remarks associated with adjustment
"RTN","FBAAFR",110,0)
 ;             reasons being deleted.
"RTN","FBAAFR",111,0)
 ;
"RTN","FBAAFR",112,0)
 N FBIENS,FB,FBFDA,FBSIENS
"RTN","FBAAFR",113,0)
 ;
"RTN","FBAAFR",114,0)
 S FBIENS=$G(DA(1))_","_$G(DA(2))_","_$G(DA(3))_","_$G(DA(4))_","
"RTN","FBAAFR",115,0)
 D GETS^DIQ(162.03,FBIENS,"53*","","FB")
"RTN","FBAAFR",116,0)
 ;
"RTN","FBAAFR",117,0)
 S FBSIENS="" F  S FBSIENS=$O(FB(162.08,FBSIENS)) Q:FBSIENS=""  D
"RTN","FBAAFR",118,0)
 . I FB(162.08,FBSIENS,1)=$G(DA) S FBFDA(162.08,FBSIENS,.01)="@"
"RTN","FBAAFR",119,0)
 I $D(FBFDA) D FILE^DIE("","FBFDA")
"RTN","FBAAFR",120,0)
 ;
"RTN","FBAAFR",121,0)
 Q
"RTN","FBAAFR",122,0)
 ;
"RTN","FBAAFR",123,0)
FILERRCP(FBIENS,FBRRMK) ; File Remittance Remakrs
"RTN","FBAAFR",124,0)
 ;
"RTN","FBAAFR",125,0)
 ; Input
"RTN","FBAAFR",126,0)
 ;   FBIENS -  required, internal entry numbers for subfile 162.03
"RTN","FBAAFR",127,0)
 ;             in standard format as specified for FileMan DBS calls
"RTN","FBAAFR",128,0)
 ;   FBRRMK -  required, array passed by reference
"RTN","FBAAFR",129,0)
 ;             array of remittance remarks to file
"RTN","FBAAFR",130,0)
 ;             array does not have to contain any data or be defined
"RTN","FBAAFR",131,0)
 ;             format
"RTN","FBAAFR",132,0)
 ;               FBRRMK(#)=FBRRMKC
"RTN","FBAAFR",133,0)
 ;             where
"RTN","FBAAFR",134,0)
 ;               # = sequentially assigned number starting with 1
"RTN","FBAAFR",135,0)
 ;               FBRRMKC = remittance remark (internal value file 162.93)
"RTN","FBAAFR",136,0)
 ; Output
"RTN","FBAAFR",137,0)
 ;   Data in File 162.03 will be modified
"RTN","FBAAFR",138,0)
 ;
"RTN","FBAAFR",139,0)
 N FB,FBFDA,FBI,FBSIENS
"RTN","FBAAFR",140,0)
 ;
"RTN","FBAAFR",141,0)
 ; delete remitance remarks currently on file
"RTN","FBAAFR",142,0)
 D GETS^DIQ(162.03,FBIENS,"53*","","FB")
"RTN","FBAAFR",143,0)
 K FBFDA
"RTN","FBAAFR",144,0)
 S FBSIENS="" F  S FBSIENS=$O(FB(162.08,FBSIENS)) Q:FBSIENS=""  D
"RTN","FBAAFR",145,0)
 . S FBFDA(162.08,FBSIENS,.01)="@"
"RTN","FBAAFR",146,0)
 I $D(FBFDA) D FILE^DIE("","FBFDA")
"RTN","FBAAFR",147,0)
 ;
"RTN","FBAAFR",148,0)
 ; file remarks from input array
"RTN","FBAAFR",149,0)
 K FBFDA
"RTN","FBAAFR",150,0)
 S FBI=0 F  S FBI=$O(FBRRMK(FBI)) Q:'FBI  D
"RTN","FBAAFR",151,0)
 . S FBFDA(162.08,"+"_FBI_","_FBIENS,.01)=$P(FBRRMK(FBI),U)
"RTN","FBAAFR",152,0)
 I $D(FBFDA) D UPDATE^DIE("","FBFDA")
"RTN","FBAAFR",153,0)
 ;
"RTN","FBAAFR",154,0)
 Q
"RTN","FBAAFR",155,0)
 ;
"RTN","FBAAFR",156,0)
 ;FBAAFR
"RTN","FBAAMP")
0^18^B133720533^B134317556
"RTN","FBAAMP",1,0)
FBAAMP ;AISC/CMR - MULTIPLE PAYMENT ENTRY ;10/23/14  12:47
"RTN","FBAAMP",2,0)
 ;;3.5;FEE BASIS;**4,21,38,55,61,67,116,108,143,123,154,158**;JAN 30, 1995;Build 94
"RTN","FBAAMP",3,0)
 ;;Per VA Directive 6402, this routine should not be modified.
"RTN","FBAAMP",4,0)
 S FBMP=1 ;multiple payment flag
"RTN","FBAAMP",5,0)
 G ^FBAACO
"RTN","FBAAMP",6,0)
1 ;return from FBAACO
"RTN","FBAAMP",7,0)
 D MMPPT^FBAACO G:$G(FBAAOUT) Q1
"RTN","FBAAMP",8,0)
 D MPDT I 'FBMPDT G Q1
"RTN","FBAAMP",9,0)
 K FBAAOUT W ! D CPTM^FBAALU(FBMPDT,DFN) I 'FBGOT G Q1
"RTN","FBAAMP",10,0)
 ; prompt revenue code
"RTN","FBAAMP",11,0)
 S FBAARC=$$ASKREVC^FBUTL5() I FBAARC="^" S FBAAOUT=1 G Q1
"RTN","FBAAMP",12,0)
 ; prompt units paid
"RTN","FBAAMP",13,0)
 S FBUNITS=$$ASKUNITS^FBUTL5() I FBUNITS="^" S FBAAOUT=1 G Q1
"RTN","FBAAMP",14,0)
 S FY=$E(DT,1,3)+1700+$S($E(DT,4,5)>9:1,1:0)
"RTN","FBAAMP",15,0)
 D ASKZIP^FBAAFS($G(FBV)) I $G(FBAAOUT)!($G(FBZIP)']"") G Q1
"RTN","FBAAMP",16,0)
 I $$ANES^FBAAFS($$CPT^FBAAUTL4(FBAACP)) D ASKTIME^FBAAFS I $G(FBAAOUT)!('$G(FBTIME)) G Q1
"RTN","FBAAMP",17,0)
 D HCFA^FBAAMP1 G Q1:$G(FBAAOUT)
"RTN","FBAAMP",18,0)
AMTCL S DIR(0)="162.03,1",DIR("A")="AMOUNT CLAIMED",DIR("?")="Enter the amount being claimed by the vendor" D ^DIR K DIR G Q:$D(DIRUT) S FBJ=+Y
"RTN","FBAAMP",19,0)
 W ! S DIR("A")="Is $"_FBJ_" correct for Amount Claimed",DIR("B")="Yes",DIR(0)="Y" D ^DIR K DIR G Q:$D(DIRUT),AMTCL:'Y
"RTN","FBAAMP",20,0)
RDAP D FEE G Q:$G(FBAAOUT) S FBK=FBAMTPD W ! S DIR("A")="Is $"_FBK_" correct for Amount Paid",DIR("B")="Yes",DIR(0)="Y" D ^DIR K DIR G Q:$D(DIRUT),RDAP:'Y
"RTN","FBAAMP",21,0)
 S FBAAAS=0 K FBADJ I FBJ-FBK D SUSP^FBAAMP1 I $G(FBAAOUT) G Q:$D(DUOUT),Q1
"RTN","FBAAMP",22,0)
 S FBJ=+FBJ,FBK=+FBK,FBAAAS=+FBAAAS
"RTN","FBAAMP",23,0)
MULT W:FBINTOT>0 !,"Invoice: "_FBAAIN_" Totals: $ "_FBINTOT
"RTN","FBAAMP",24,0)
 W !! S %DT("A")="Date of Service: ",%DT="AEPX" D ^%DT G Q1:X=""!(X="^")
"RTN","FBAAMP",25,0)
 D DATCK^FBAAUTL G MULT:'$D(X)!(Y<0)
"RTN","FBAAMP",26,0)
 S FBDT=Y
"RTN","FBAAMP",27,0)
 I '$$CHKCPT() W !,$C(7),"Invalid Date of Service." G MULT
"RTN","FBAAMP",28,0)
 I $$CHKICD9^FBCSV1(+$G(FBHCFA(28)),$G(FBDT))="" G MULT
"RTN","FBAAMP",29,0)
 I '$G(FBAAMM1),'$$CHKFS() W !,$C(7),"Invalid Date of Service." G MULT
"RTN","FBAAMP",30,0)
 S DIR(0)="Y",DIR("A")="Is "_($$DATX^FBAAUTL(FBDT))_" correct",DIR("B")="Yes" D ^DIR K DIR G MULT:$D(DIRUT)!('Y)
"RTN","FBAAMP",31,0)
 S FBAADT=FBDT
"RTN","FBAAMP",32,0)
 S FBMODL=$$MODL^FBAAUTL4("FBMODA","I")
"RTN","FBAAMP",33,0)
 I $D(^FBAAC("AE",DFN,FBV,FBAADT,FBAACP_$S($G(FBMODL)]"":"-"_FBMODL,1:""))) S DIR(0)="Y",DIR("A")="Code already exists for that date!  Want to add another service for the SAME DATE",DIR("B")="No" D ^DIR K DIR G MULT:$D(DIRUT)!('Y)
"RTN","FBAAMP",34,0)
 I FBFPPSC]"" S FBFPPSL=$$FPPSL^FBUTL5() I FBFPPSL=-1 G Q1
"RTN","FBAAMP",35,0)
 W !! D GETSVDT^FBAACO5(DFN,FBV,FBASSOC,0,FBAADT) G Q:$G(FBAAOUT)
"RTN","FBAAMP",36,0)
 D SETO^FBAACO3,SVCPR^FBAACO1 G Q:$G(FBAAOUT)
"RTN","FBAAMP",37,0)
FILE S TP="",DR="1///^S X=FBJ;Q;2///^S X=FBK;47///^S X=FBUNITS"
"RTN","FBAAMP",38,0)
 I FBCSID]"" S DR=DR_";49///^S X=FBCSID"
"RTN","FBAAMP",39,0)
 I FBFPPSC]"" S DR=DR_";50///^S X=FBFPPSC;51///^S X=FBFPPSL"
"RTN","FBAAMP",40,0)
 I FBAARC]"" S DR=DR_";48////^S X=FBAARC"
"RTN","FBAAMP",41,0)
 S DR(1,162.03,1)="6////^S X=DUZ;7////^S X=FBAABE;8////^S X=BO;13///^S X=FBAAID;14///^S X=FBAAIN;15///^S X=FBPT;16////^S X=FBPOV;17///^S X=FBTT;18///^S X=FBAAPTC;23////^S X=FBTYPE;26////^S X=FBPSA"
"RTN","FBAAMP",42,0)
 S DR(1,162.03,2)="34///^S X=$G(FBAAMM1);54////^S X=$G(FBCNTRP);28////^S X=FBHCFA(28);30////^S X=FBHCFA(30);31////^S X=FBHCFA(31);32////^S X=FBHCFA(32);33///^S X=FBAAVID;44///^S X=FBFSAMT;45////^S X=FBFSUSD"
"RTN","FBAAMP",43,0)
 S DR(1,162.03,3)=".05////^S X=$G(FBIA);.055///^S X=$G(FBDODINV)"         ; FB*3.5*123
"RTN","FBAAMP",44,0)
 S DR(1,162.03,4)="82///^S X=$$PYMTH^FBAAUTL(FBFSUSD)" ;FB*3.5*158
"RTN","FBAAMP",45,0)
 S DIE="^FBAAC("_DFN_",1,"_FBV_",1,"_FBSDI_",1,"
"RTN","FBAAMP",46,0)
 S DA=FBAACPI,DA(1)=FBSDI,DA(2)=FBV,DA(3)=DFN
"RTN","FBAAMP",47,0)
 D LOCK^FBUCUTL(DIE,FBAACPI,1)
"RTN","FBAAMP",48,0)
 D ^DIE
"RTN","FBAAMP",49,0)
 D FILEADJ^FBAAFA(FBAACPI_","_FBSDI_","_FBV_","_DFN_",",.FBADJ)
"RTN","FBAAMP",50,0)
 D FILERR^FBAAFR(FBAACPI_","_FBSDI_","_FBV_","_DFN_",",.FBRRMK)
"RTN","FBAAMP",51,0)
 L -^FBAAC(DFN,1,FBV,1,FBSDI,1,FBAACPI)
"RTN","FBAAMP",52,0)
 S FBINTOT=FBINTOT+FBK
"RTN","FBAAMP",53,0)
 W " ....OK, DONE...."
"RTN","FBAAMP",54,0)
 ; HIPAA 5010 - count line items that have 0.00 amount paid
"RTN","FBAAMP",55,0)
 S Z1=$P(^FBAA(161.7,FBAABE,0),"^",11)+1,$P(^(0),"^",11)=Z1
"RTN","FBAAMP",56,0)
 W:Z1>(FBAAMPI-20) !,*7,"Warning, you can only enter ",(FBAAMPI-Z1)," more line items!" I Z1>(FBAAMPI-1) D  S FBMAX=1 G Q1
"RTN","FBAAMP",57,0)
 .W !!,*7,"You have reached the maximum number of payments for a Batch!",!,"You must select another Batch for entering Payments!"
"RTN","FBAAMP",58,0)
 G MULT
"RTN","FBAAMP",59,0)
Q1 K FBADJ,FBAADT,FBX,FBAACP,DIC,DIE,X,Y,DIRUT,DUOUT,DTOUT,FBOUT,FBSI,FBMPDT,FBIA,FBDODINV G ^FBAACO:$D(FBMAX),1^FBAACO
"RTN","FBAAMP",60,0)
 ;
"RTN","FBAAMP",61,0)
Q ;kill variables and exit
"RTN","FBAAMP",62,0)
 D Q^FBAACO
"RTN","FBAAMP",63,0)
 Q
"RTN","FBAAMP",64,0)
 ;
"RTN","FBAAMP",65,0)
MPDT ;
"RTN","FBAAMP",66,0)
 S FBMPDT=""
"RTN","FBAAMP",67,0)
 S DIR(0)="D^::EX"
"RTN","FBAAMP",68,0)
 S DIR("A")="Enter date to use for CPT/ICD checks and fee schedule calc"
"RTN","FBAAMP",69,0)
 S DIR("B")="TODAY"
"RTN","FBAAMP",70,0)
 S DIR("?",1)="Enter a date. This date will be used when checking for"
"RTN","FBAAMP",71,0)
 S DIR("?",2)="an active CPT/Modifier/ICD code. Also, the fee schedule"
"RTN","FBAAMP",72,0)
 S DIR("?",3)="amount will be computed based on this date."
"RTN","FBAAMP",73,0)
 S DIR("?")="Enter '^' to exit."
"RTN","FBAAMP",74,0)
 W !
"RTN","FBAAMP",75,0)
 D ^DIR K DIR S:'$D(DIRUT) FBMPDT=Y
"RTN","FBAAMP",76,0)
 Q
"RTN","FBAAMP",77,0)
 ;
"RTN","FBAAMP",78,0)
FEE N FBX,FB1725
"RTN","FBAAMP",79,0)
 ; set FB1725 flag = true if payment for a 38 U.S.C. 1725 claim
"RTN","FBAAMP",80,0)
 S FB1725=$S($G(FB583):+$P($G(^FB583(+FB583,0)),U,28),1:0)
"RTN","FBAAMP",81,0)
 S FBFY=FY-1
"RTN","FBAAMP",82,0)
 S (FBFSAMT,FBFSUSD,FBAMFS)=""
"RTN","FBAAMP",83,0)
 ; FB*3.5*143 Adding FB1725 as a parameter to prevent reduction 
"RTN","FBAAMP",84,0)
 ; of local fee schedule payments
"RTN","FBAAMP",85,0)
 S FBX=$$GET^FBAAFS($$CPT^FBAAUTL4(FBAACP),$$MODL^FBAAUTL4("FBMODA","E"),FBMPDT,$G(FBZIP),$$FAC^FBAAFS($G(FBHCFA(30))),$G(FBTIME),$G(FB1725))
"RTN","FBAAMP",86,0)
 ;
"RTN","FBAAMP",87,0)
 I '$G(FBAAMM1) D
"RTN","FBAAMP",88,0)
 . S FBFSAMT=$P(FBX,U),FBFSUSD=$P(FBX,U,2)
"RTN","FBAAMP",89,0)
 E  D
"RTN","FBAAMP",90,0)
 . W !,?2,"Payment is for a contracted service so fee schedule does not apply."
"RTN","FBAAMP",91,0)
 ;
"RTN","FBAAMP",92,0)
 I $P($G(FBX),U)]"" D
"RTN","FBAAMP",93,0)
 . W !?2,$S($G(FBAAMM1):"However, f",1:"F")
"RTN","FBAAMP",94,0)
 . W "ee schedule amount is $",$P(FBX,U)," from the "
"RTN","FBAAMP",95,0)
 . W:$P(FBX,U,3)]"" $P(FBX,U,3)," " ; year if returned
"RTN","FBAAMP",96,0)
 . W:$P(FBX,U,2)]"" $$EXTERNAL^DILFD(162.03,45,"",$P(FBX,U,2))
"RTN","FBAAMP",97,0)
 E  W !?2,"Unable to determine a FEE schedule amount."
"RTN","FBAAMP",98,0)
 ;
"RTN","FBAAMP",99,0)
 ; FB*3.5*143 - Preventing 70% reduction of 75th percentile rates
"RTN","FBAAMP",100,0)
 I FB1725,FBFSUSD'="F" D
"RTN","FBAAMP",101,0)
 . W !!?2,"**Payment is for emergency treatment under 38 U.S.C. 1725."
"RTN","FBAAMP",102,0)
 . I FBFSAMT D
"RTN","FBAAMP",103,0)
 . . S FBFSAMT=$J(FBFSAMT*.7,0,2)
"RTN","FBAAMP",104,0)
 . . W !?2,"  Therefore, fee schedule amount reduced to $",FBFSAMT," (70%)."
"RTN","FBAAMP",105,0)
 ;
"RTN","FBAAMP",106,0)
 I $G(FBUNITS)>1 D
"RTN","FBAAMP",107,0)
 . W !!?2,"Units Paid = ",FBUNITS
"RTN","FBAAMP",108,0)
 . Q:FBFSAMT'>0
"RTN","FBAAMP",109,0)
 . N FBFSUNIT
"RTN","FBAAMP",110,0)
 . ; determine if fee schedule can be multiplied by units
"RTN","FBAAMP",111,0)
 . S FBFSUNIT=$S(FBFSUSD="R":1,FBFSUSD="F"&(FBMPDT>3040930):1,1:0)
"RTN","FBAAMP",112,0)
 . I FBFSUNIT D
"RTN","FBAAMP",113,0)
 . . S FBFSAMT=$J(FBFSAMT*FBUNITS,0,2)
"RTN","FBAAMP",114,0)
 . . W !?2,"  Therefore, fee schedule amount increased to $",FBFSAMT
"RTN","FBAAMP",115,0)
 . E  D
"RTN","FBAAMP",116,0)
 . . W !?2,"  Fee schedule not complied on per unit basis so amount not adjusted by units."
"RTN","FBAAMP",117,0)
 ;
"RTN","FBAAMP",118,0)
 I '$G(FBAAMM1) D
"RTN","FBAAMP",119,0)
 . ; set default amount paid to lesser of amt claimed (J) or fee sched.
"RTN","FBAAMP",120,0)
 . S FBAMFS=$S(FBFSAMT>$G(FBJ):$G(FBJ),1:FBFSAMT)
"RTN","FBAAMP",121,0)
 ;
"RTN","FBAAMP",122,0)
 W !
"RTN","FBAAMP",123,0)
 ;
"RTN","FBAAMP",124,0)
AMTPD K DIR S DIR(0)="162.03,2",DIR("A")="AMOUNT PAID" S:$G(FBAMFS)'="" DIR("B")=FBAMFS D ^DIR K DIR I $D(DIRUT) S FBAAOUT=1 Q
"RTN","FBAAMP",125,0)
 S FBAMTPD=+Y K FBAMFS Q
"RTN","FBAAMP",126,0)
 ;
"RTN","FBAAMP",127,0)
CHKCPT() ; check if CPT/Modifier active on date of service
"RTN","FBAAMP",128,0)
 N FBCPTX,FBI,FBMOD,FBMODX,FBRET
"RTN","FBAAMP",129,0)
 S FBRET=1
"RTN","FBAAMP",130,0)
 S FBCPTX=$$CPT^ICPTCOD(FBAACP,FBDT,1)
"RTN","FBAAMP",131,0)
 I '$P(FBCPTX,U,7) S FBRET=0 W !,"  CPT Code ",$P(FBCPTX,U,2)," inactive on date of service."
"RTN","FBAAMP",132,0)
 I $O(FBMODA(0)) D
"RTN","FBAAMP",133,0)
 . S FBI=0 F  S FBI=$O(FBMODA(FBI)) Q:'FBI  D
"RTN","FBAAMP",134,0)
 . . S FBMODX=$$MOD^ICPTMOD(FBMODA(FBI),"I",FBDT,1)
"RTN","FBAAMP",135,0)
 . . I '$P(FBMODX,U,7) S FBRET=0 W !,"  CPT Modifier ",$P(FBMODX,U,2)," inactive on date of service."
"RTN","FBAAMP",136,0)
 Q FBRET
"RTN","FBAAMP",137,0)
 ;
"RTN","FBAAMP",138,0)
CHKFS() ; check if fee schedule amount is different on date of service
"RTN","FBAAMP",139,0)
 N FBX,FBRET,FB1725
"RTN","FBAAMP",140,0)
 S FBRET=1 ; return value - true if date of service allowed
"RTN","FBAAMP",141,0)
 ; set FB1725 flag = true if payment for a 38 U.S.C. 1725 claim
"RTN","FBAAMP",142,0)
 S FB1725=$S($G(FB583):+$P($G(^FB583(+FB583,0)),U,28),1:0)
"RTN","FBAAMP",143,0)
 S FBX=$$GET^FBAAFS($$CPT^FBAAUTL4(FBAACP),$$MODL^FBAAUTL4("FBMODA","E"),FBDT,$G(FBZIP),$$FAC^FBAAFS($G(FBHCFA(30))),$G(FBTIME),$G(FB1725))
"RTN","FBAAMP",144,0)
 ; set FB1725 flag = true if payment for a 38 U.S.C. 1725 claim
"RTN","FBAAMP",145,0)
 S FB1725=$S($G(FB583):+$P($G(^FB583(+FB583,0)),U,28),1:0)
"RTN","FBAAMP",146,0)
 ; adjust amount if mill bill
"RTN","FBAAMP",147,0)
 I FB1725 S $P(FBX,U)=$J($P(FBX,U)*.7,0,2)
"RTN","FBAAMP",148,0)
 ; adjust amount if units > 1
"RTN","FBAAMP",149,0)
 I $G(FBUNITS) D
"RTN","FBAAMP",150,0)
 . N FBFSUNIT
"RTN","FBAAMP",151,0)
 . ; determine if fee schedule can be multiplied by units
"RTN","FBAAMP",152,0)
 . S FBFSUNIT=$S($P(FBX,U,2)="R":1,$P(FBX,U,2)="F"&(FBDT>3040930):1,1:0)
"RTN","FBAAMP",153,0)
 . I FBFSUNIT S $P(FBX,U)=$J($P(FBX,U)*FBUNITS,0,2)
"RTN","FBAAMP",154,0)
 ; issue warning if lesser of claim and fee schedule amount different
"RTN","FBAAMP",155,0)
 I +$S($P(FBX,U)>$G(FBJ):$G(FBJ),1:$P(FBX,U))'=+$S(FBFSAMT>$G(FBJ):$G(FBJ),1:FBFSAMT) D
"RTN","FBAAMP",156,0)
 . W !,"  Warning: The fee schedule amount (",$P(FBX,U),") for this date of service "
"RTN","FBAAMP",157,0)
 . W !,"  differs from the initial fee schedule amount (",FBFSAMT,")."
"RTN","FBAAMP",158,0)
 . I $P(FBX,U)>0,FBK>$P(FBX,U) D
"RTN","FBAAMP",159,0)
 . . W !,"  Amount paid (",FBK,") exceeds the fee schedule amount."
"RTN","FBAAMP",160,0)
 . W:FBRET !,"  You may want to separately process this date of service."
"RTN","FBAAMP",161,0)
 Q FBRET
"RTN","FBAAMP",162,0)
 ;
"RTN","FBAAMP",163,0)
IPACID(FBVEN,FBIPIEN) ; function to return IPAC agreement ID# if exactly 1 active IPAC on file for vendor (FB*3.5*123)
"RTN","FBAAMP",164,0)
 ; No user interface allowed with this function.  Called by background, Austin transmission process.
"RTN","FBAAMP",165,0)
 ;
"RTN","FBAAMP",166,0)
 ; Input:
"RTN","FBAAMP",167,0)
 ;   FBVEN - Vendor ien (ptr to file 161.2)
"RTN","FBAAMP",168,0)
 ;
"RTN","FBAAMP",169,0)
 ; Output:
"RTN","FBAAMP",170,0)
 ;   Function value = if exactly 1 active IPAC agreement is on file, then this returns the external agreement ID#
"RTN","FBAAMP",171,0)
 ;                    otherwise, this returns ""
"RTN","FBAAMP",172,0)
 ;   FBIPIEN (pass by reference) - internal entry ien of the active IPAC agreement on file
"RTN","FBAAMP",173,0)
 ;
"RTN","FBAAMP",174,0)
 N X1,X2,RET
"RTN","FBAAMP",175,0)
 S RET=""       ; default value
"RTN","FBAAMP",176,0)
 S FBIPIEN=""   ; initialize
"RTN","FBAAMP",177,0)
 S FBVEN=+$G(FBVEN)
"RTN","FBAAMP",178,0)
 I '$$IPACREQD(FBVEN) G IPACIDX                            ; IPAC not required
"RTN","FBAAMP",179,0)
 S X1=+$O(^FBAA(161.95,"AVA",FBVEN,"A",""))                ; first active IPAC entry
"RTN","FBAAMP",180,0)
 I 'X1 G IPACIDX                                           ; no IPAC data found for vendor so get out
"RTN","FBAAMP",181,0)
 S X2=+$O(^FBAA(161.95,"AVA",FBVEN,"A",""),-1)             ; last active IPAC entry
"RTN","FBAAMP",182,0)
 ;
"RTN","FBAAMP",183,0)
 ; only 1 IPAC on file - retrieve the ID# in this case only
"RTN","FBAAMP",184,0)
 I X1=X2 S RET=$P($G(^FBAA(161.95,X1,0)),U,1),FBIPIEN=X1   ; IPAC external agreement ID#
"RTN","FBAAMP",185,0)
 ;
"RTN","FBAAMP",186,0)
IPACIDX ;
"RTN","FBAAMP",187,0)
 Q RET
"RTN","FBAAMP",188,0)
 ;
"RTN","FBAAMP",189,0)
IPAC(FBVEN) ; Determine if active IPAC agreement data exists for vendor (FB*3.5*123)
"RTN","FBAAMP",190,0)
 ; Input:
"RTN","FBAAMP",191,0)
 ;   FBVEN - Vendor ien (ptr to file 161.2)
"RTN","FBAAMP",192,0)
 ;
"RTN","FBAAMP",193,0)
 ; Output:
"RTN","FBAAMP",194,0)
 ;   Function value = -1 if active IPAC records exist, but none were selected (this is an error condition)
"RTN","FBAAMP",195,0)
 ;                  = ien of IPAC entry in file 161.95 (if only 1 exists, or user selected it)
"RTN","FBAAMP",196,0)
 ;                  = "" if no IPAC data found or if IPAC not required
"RTN","FBAAMP",197,0)
 ;
"RTN","FBAAMP",198,0)
 N FBIA,X1,X2,DIR,DIROUT,DIRUT,DTOUT,DUOUT,X,Y
"RTN","FBAAMP",199,0)
 S FBIA=""
"RTN","FBAAMP",200,0)
 S FBVEN=+$G(FBVEN)
"RTN","FBAAMP",201,0)
 I '$$IPACREQD(FBVEN) G IPACX                          ; IPAC not required
"RTN","FBAAMP",202,0)
 S X1=+$O(^FBAA(161.95,"AVA",FBVEN,"A",""))            ; first active IPAC entry
"RTN","FBAAMP",203,0)
 I 'X1 G IPACX                                         ; no IPAC data found for vendor, get out with FBIA=""
"RTN","FBAAMP",204,0)
 W !!,"This is a Federal Vendor. IPAC payment information is required."
"RTN","FBAAMP",205,0)
 S X2=+$O(^FBAA(161.95,"AVA",FBVEN,"A",""),-1)         ; last active IPAC entry
"RTN","FBAAMP",206,0)
 ;
"RTN","FBAAMP",207,0)
 ; only 1 IPAC on file - select it automatically
"RTN","FBAAMP",208,0)
 I X1=X2 S FBIA=X1 D
"RTN","FBAAMP",209,0)
 . W !,"  - Required IPAC agreement information has been found."
"RTN","FBAAMP",210,0)
 . Q
"RTN","FBAAMP",211,0)
 ;
"RTN","FBAAMP",212,0)
 I X1'=X2 S FBIA=$$MULTIPAC(FBVEN)                     ; multiple IPAC selection for vendor
"RTN","FBAAMP",213,0)
 I FBIA'>0 G IPACX                                     ; get out if user failed to select one
"RTN","FBAAMP",214,0)
 ;
"RTN","FBAAMP",215,0)
 S DIR(0)="Y",DIR("A")="Would you like to display the detailed IPAC agreement information"
"RTN","FBAAMP",216,0)
 S DIR("B")="No"
"RTN","FBAAMP",217,0)
 W ! D ^DIR K DIR
"RTN","FBAAMP",218,0)
 I $D(DIRUT) W "  Not displaying detail ... "
"RTN","FBAAMP",219,0)
 I 'Y G IPACX   ; exit without displaying the data by user choice
"RTN","FBAAMP",220,0)
 ;
"RTN","FBAAMP",221,0)
 ; Display the IPAC data
"RTN","FBAAMP",222,0)
 W !
"RTN","FBAAMP",223,0)
 D VADISP^FBAAIAU(FBIA,1)
"RTN","FBAAMP",224,0)
 S DIR(0)="E" D ^DIR K DIR    ; press return to continue
"RTN","FBAAMP",225,0)
IPACX ;
"RTN","FBAAMP",226,0)
 Q FBIA
"RTN","FBAAMP",227,0)
 ;
"RTN","FBAAMP",228,0)
MULTIPAC(FBVEN) ; multiple IPAC agreement display, lister, selection
"RTN","FBAAMP",229,0)
 ; same input and output parameters as IPAC above
"RTN","FBAAMP",230,0)
 ;
"RTN","FBAAMP",231,0)
 N FBIA,Z,CNT,FBLN,FBG,ID,FY,DESC,DIR,DIROUT,DIRUT,DTOUT,DUOUT,X,Y,LN,T,W
"RTN","FBAAMP",232,0)
 S FBVEN=+$G(FBVEN)
"RTN","FBAAMP",233,0)
 S FBIA=""
"RTN","FBAAMP",234,0)
 S Z=0,CNT=0 K FBLN
"RTN","FBAAMP",235,0)
 F  S Z=$O(^FBAA(161.95,"AVA",FBVEN,"A",Z)) Q:'Z  D
"RTN","FBAAMP",236,0)
 . S FBG=$G(^FBAA(161.95,Z,0)) I FBG="" Q
"RTN","FBAAMP",237,0)
 . S ID=$P(FBG,U,1)
"RTN","FBAAMP",238,0)
 . S FY=$P(FBG,U,3)
"RTN","FBAAMP",239,0)
 . S DESC=$P(FBG,U,5)
"RTN","FBAAMP",240,0)
 . S CNT=CNT+1,FBLN(CNT)=Z_U_ID_U_FY_U_DESC
"RTN","FBAAMP",241,0)
 . Q
"RTN","FBAAMP",242,0)
 ;
"RTN","FBAAMP",243,0)
 I 'CNT G MULIPACX    ; get out if nothing found (should not happen)
"RTN","FBAAMP",244,0)
 I CNT=1 S FBIA=$P(FBLN(1),U,1) G MULIPACX       ; only 1 found (also should not happen)
"RTN","FBAAMP",245,0)
 ;
"RTN","FBAAMP",246,0)
 ; Multiple found. Build list.
"RTN","FBAAMP",247,0)
 S DIR(0)="N"_U_"1:"_CNT,LN=0
"RTN","FBAAMP",248,0)
 S LN=LN+1,DIR("A",LN)=$$GET1^DIQ(161.2,FBVEN_",",.01)_" is a Federal Vendor with"
"RTN","FBAAMP",249,0)
 S LN=LN+1,DIR("A",LN)=CNT_" active IPAC agreements on file:"
"RTN","FBAAMP",250,0)
 S LN=LN+1,DIR("A",LN)=" "
"RTN","FBAAMP",251,0)
 S LN=LN+1,DIR("A",LN)="#   ID          FY   Description"
"RTN","FBAAMP",252,0)
 S LN=LN+1,DIR("A",LN)="-- ----------  ----  -----------"
"RTN","FBAAMP",253,0)
 S T=0 F  S T=$O(FBLN(T)) Q:'T  S W=FBLN(T) D
"RTN","FBAAMP",254,0)
 . S LN=LN+1,DIR("A",LN)=$$LJ^XLFSTR(T,3)_$$LJ^XLFSTR($P(W,U,2),12)_$$LJ^XLFSTR($P(W,U,3),6)_$E($P(W,U,4),1,58)
"RTN","FBAAMP",255,0)
 . Q
"RTN","FBAAMP",256,0)
 S LN=LN+1,DIR("A",LN)=" "
"RTN","FBAAMP",257,0)
 S LN=LN+1,DIR("A",LN)="Please select the IPAC agreement to be used with this invoice."
"RTN","FBAAMP",258,0)
 S LN=LN+1,DIR("A",LN)="This information is required."
"RTN","FBAAMP",259,0)
 S DIR("A")="Selection#"
"RTN","FBAAMP",260,0)
 W ! D ^DIR K DIR
"RTN","FBAAMP",261,0)
 I Y>0 S FBIA=$P($G(FBLN(Y)),U,1) G MULIPACX    ; user selection is good so set FBIA and get out
"RTN","FBAAMP",262,0)
 ;
"RTN","FBAAMP",263,0)
 ; in all other cases, user failed to make a selection so set FBIA=-1
"RTN","FBAAMP",264,0)
 S FBIA=-1
"RTN","FBAAMP",265,0)
 W !!,$C(7),"IPAC Agreement Selection is required for this vendor."
"RTN","FBAAMP",266,0)
 ;
"RTN","FBAAMP",267,0)
MULIPACX ;
"RTN","FBAAMP",268,0)
 Q FBIA
"RTN","FBAAMP",269,0)
 ;
"RTN","FBAAMP",270,0)
IPACINV(FBDODINV,FBDEF) ; function to get the DoD invoice number for IPAC (FB*3.5*123)
"RTN","FBAAMP",271,0)
 ; Function value is 1 if the DoD invoice number was obtained.
"RTN","FBAAMP",272,0)
 ; Function value is 0 if not.
"RTN","FBAAMP",273,0)
 ; FBDODINV - pass by reference. This is set to the DoD invoice number.
"RTN","FBAAMP",274,0)
 ; FBDEF is an optional default value
"RTN","FBAAMP",275,0)
 ;
"RTN","FBAAMP",276,0)
 N RET,DIR,X,Y,DTOUT,DUOUT,DIRUT,DIROUT
"RTN","FBAAMP",277,0)
 S FBDODINV="",RET=0   ; initialize
"RTN","FBAAMP",278,0)
 S DIR(0)="Fr^3:22",DIR("A")="Enter the DoD Invoice Number"
"RTN","FBAAMP",279,0)
 I $G(FBDEF)'="" S DIR("B")=FBDEF
"RTN","FBAAMP",280,0)
 S DIR("?",1)="If invoice is a UB-04 look in block 3a."
"RTN","FBAAMP",281,0)
 S DIR("?",2)="If invoice is a CMS-1500 look in block 26."
"RTN","FBAAMP",282,0)
 S DIR("?")="You must enter between 3-22 characters."
"RTN","FBAAMP",283,0)
 W ! D ^DIR K DIR
"RTN","FBAAMP",284,0)
 I $D(DIRUT),$G(FBDEF)'="" S Y=FBDEF K DIRUT
"RTN","FBAAMP",285,0)
 I '$D(DIRUT),Y'="" S FBDODINV=Y,RET=1 G IPINVX
"RTN","FBAAMP",286,0)
 W !!,$C(7),"The DoD Invoice Number is required for IPAC processing."
"RTN","FBAAMP",287,0)
IPINVX ;
"RTN","FBAAMP",288,0)
 W !
"RTN","FBAAMP",289,0)
 Q RET
"RTN","FBAAMP",290,0)
 ;
"RTN","FBAAMP",291,0)
IPACREQD(FBVEN) ; Is IPAC data required for vendor?  (FB*3.5*123)
"RTN","FBAAMP",292,0)
 I $G(FBAAPTC)="R" Q 0      ; IPAC is not applicable for Patient/Veteran reimbursements
"RTN","FBAAMP",293,0)
 I +$O(^FBAA(161.95,"AVA",+$G(FBVEN),"A","")) Q 1
"RTN","FBAAMP",294,0)
 Q 0
"RTN","FBAAMP",295,0)
 ;
"RTN","FBAAMP",296,0)
IPACDISP(FBIA,FBDODINV) ; Quick display of IPAC data currently on file for this invoice  (FB*3.5*123)
"RTN","FBAAMP",297,0)
 N G
"RTN","FBAAMP",298,0)
 S FBIA=+$G(FBIA)
"RTN","FBAAMP",299,0)
 S G=$G(^FBAA(161.95,FBIA,0))
"RTN","FBAAMP",300,0)
 I G="",$G(FBDODINV)="" G IDISPX
"RTN","FBAAMP",301,0)
 W !!,"IPAC Agreement Information on file for this Invoice/Payment"
"RTN","FBAAMP",302,0)
 W !,"-----------------------------------------------------------"
"RTN","FBAAMP",303,0)
 W !,"IPAC Agreement ID: ",$P(G,U,1),"  (",$$GET1^DIQ(161.95,FBIA,3),")"
"RTN","FBAAMP",304,0)
 W !?11,"Vendor: ",$$GET1^DIQ(161.95,FBIA,1)
"RTN","FBAAMP",305,0)
 W !?6,"Fiscal Year: ",$P(G,U,3)
"RTN","FBAAMP",306,0)
 W !,"Short Description: ",$P(G,U,5)
"RTN","FBAAMP",307,0)
 W !?5,"DoD Invoice#: ",$G(FBDODINV)
"RTN","FBAAMP",308,0)
IDISPX ;
"RTN","FBAAMP",309,0)
 Q
"RTN","FBAAMP",310,0)
 ;
"RTN","FBAAMP",311,0)
ANCIL ;ENTRY POINT FOR multiple ancillary payment option
"RTN","FBAAMP",312,0)
 S FBCHCO=1 D ^FBAAMP
"RTN","FBAAMP",313,0)
 K FBCHCO Q
"RTN","FBAAMP1")
0^19^B12388857^B12344888
"RTN","FBAAMP1",1,0)
FBAAMP1 ;AISC/CMR - MULTIPLE PAYMENT ENTRY ;7/6/2003
"RTN","FBAAMP1",2,0)
 ;;3.5;FEE BASIS;**4,55,61,77,139,158**;JAN 30, 1995;Build 94
"RTN","FBAAMP1",3,0)
 ;;Per VA Directive 6402, this routine should not be modified.
"RTN","FBAAMP1",4,0)
SUSP ;enter suspense data
"RTN","FBAAMP1",5,0)
 N FBX
"RTN","FBAAMP1",6,0)
 ;S DIR(0)="162.5,9",DIR("A")="Amount Suspended: $",DIR("B")=FBJ-FBK,DIR("?")="Press Return if $ "_(FBJ-FBK)_" is Amount Suspended, otherwise enter correct suspension amount" D ^DIR K DIR
"RTN","FBAAMP1",7,0)
 ;I $D(DIRUT) W !!,"Invalid entry, enter a number between .01 and 999999" G SUSP
"RTN","FBAAMP1",8,0)
 ;S FBAAAS=+Y
"RTN","FBAAMP1",9,0)
 ;I +Y'=(FBJ-FBK) S FBAAAS=+Y W ! S DIR("A")="Is $"_FBAAAS_" correct for Amount Suspended",DIR("B")="Yes",DIR(0)="Y" D ^DIR K DIR I $D(DIRUT) S FBAAOUT=1 Q
"RTN","FBAAMP1",10,0)
 ;G SUSP:'Y
"RTN","FBAAMP1",11,0)
 ;W !! S DIC="^FBAA(161.27,",DIC(0)="AEQ" D ^DIC I X["^" S FBAAOUT=1 Q
"RTN","FBAAMP1",12,0)
 ;S FBAASC=+Y
"RTN","FBAAMP1",13,0)
 S FBX=$$ADJ^FBUTL2(FBJ-FBK,.FBADJ,5,,,,.FBRRMK,1)
"RTN","FBAAMP1",14,0)
 I FBX=0 S FBAAOUT=1
"RTN","FBAAMP1",15,0)
 Q
"RTN","FBAAMP1",16,0)
SUSP1 I FBAASC=4 K ^TMP($J,"FBWP") W !!,"Suspension Description: " S DIC="^TMP($J,""FBWP"",",DWLW=80,DWPK=1 D EN^DIWE K DIC,DWLW,DWPK I '$O(^TMP($J,"FBWP",0)) W !!,*7,"Description of Suspense is required." G SUSP1
"RTN","FBAAMP1",17,0)
 Q
"RTN","FBAAMP1",18,0)
HCFA N ICDMDE S ICDMDE=10
"RTN","FBAAMP1",19,0)
 I FBMPDT<$$IMPDATE^LEXU("10D") S ICDMDE=9 N XX1 ;FB*3.5*139-JLG-ICD10 REMEDIATION
"RTN","FBAAMP1",20,0)
 F FBSI=28,30,31,32 S FBHCFA(FBSI)=""
"RTN","FBAAMP1",21,0)
 W ! F FBSI=28,30,31 D  Q:$G(FBAAOUT)
"RTN","FBAAMP1",22,0)
 . ;DEM/JLG/JAS FB*3.5*139-JLG-ICD10 REMEDIATION
"RTN","FBAAMP1",23,0)
 . I (FBSI=28)&(ICDMDE=10) F  D  Q:($G(FBAAOUT))!(XX1>0)
"RTN","FBAAMP1",24,0)
 . . S XX1=$$ASKICD10(FBMPDT) S:XX1=-3 FBAAOUT=1
"RTN","FBAAMP1",25,0)
 . . Q:XX1<0
"RTN","FBAAMP1",26,0)
 . . S FBHCFA(28)=XX1
"RTN","FBAAMP1",27,0)
 . . Q
"RTN","FBAAMP1",28,0)
 . Q:($G(FBAAOUT))!((ICDMDE=10)&(FBSI=28))
"RTN","FBAAMP1",29,0)
 . I (FBSI=28)&(ICDMDE=9) F  D  Q:($G(FBAAOUT))!(XX1>0)
"RTN","FBAAMP1",30,0)
 . . S XX1=$$ASKICD9(FBMPDT) S:XX1="^" FBAAOUT=1
"RTN","FBAAMP1",31,0)
 . . Q:XX1<0
"RTN","FBAAMP1",32,0)
 . . S FBHCFA(28)=XX1
"RTN","FBAAMP1",33,0)
 . . Q
"RTN","FBAAMP1",34,0)
 . Q:($G(FBAAOUT))!((ICDMDE=9)&(FBSI=28))
"RTN","FBAAMP1",35,0)
 . ;END 139
"RTN","FBAAMP1",36,0)
 . N ICDVDT S ICDVDT=$G(FBMPDT)
"RTN","FBAAMP1",37,0)
 . ;JAS - 08/23/13 - FB*3.5*139 (ICD10 REMEDIATION) - Modified next line for ICD-10.
"RTN","FBAAMP1",38,0)
 . F  S DIR(0)="P"_$S(FBSI=30:"^353.1",FBSI=31:"O^353.2")_":EMZ" D HCFA1 Q:$G(FBAAOUT)  Q
"RTN","FBAAMP1",39,0)
 Q:$G(FBAAOUT)
"RTN","FBAAMP1",40,0)
 W !
"RTN","FBAAMP1",41,0)
 I $$EXTPV^FBAAUTL5(FBPOV)'="01" D
"RTN","FBAAMP1",42,0)
 . S FBSI=32,DIR(0)="Y",DIR("A")="Service connected condition"
"RTN","FBAAMP1",43,0)
 . S DIR("?")="^W !!,""Respond by answering 'Yes' or 'No'."",! I $G(DFN) W !?1,*7,""Patient:  "",$$NAME^FBCHREQ2(DFN) D DIS^DGRPDB W !!"
"RTN","FBAAMP1",44,0)
 . D HCFA1 I $D(DIRUT) S FBAAOUT=1 Q
"RTN","FBAAMP1",45,0)
 Q
"RTN","FBAAMP1",46,0)
 ;
"RTN","FBAAMP1",47,0)
ASKICD9(FBINDT) ;JAS - 08/23/13 - FB*3.5*139 (ICD10 REMEDIATION)
"RTN","FBAAMP1",48,0)
 N FBDX,EDATE,XSP
"RTN","FBAAMP1",49,0)
 S EDATE=FBINDT ; edate is the date of interest for ICD9 diagnosis code lookup
"RTN","FBAAMP1",50,0)
 S XSP="ICD DIAGNOSIS"
"RTN","FBAAMP1",51,0)
 S FBDX=$$ENICD9^FBICD9(EDATE,XSP,"Y")
"RTN","FBAAMP1",52,0)
 K EDATE,FBINDT
"RTN","FBAAMP1",53,0)
 Q +FBDX
"RTN","FBAAMP1",54,0)
 ; 
"RTN","FBAAMP1",55,0)
ASKICD10(FBINDT) ; FB*3.5*139-JLG-ICD10 REMEDIATION
"RTN","FBAAMP1",56,0)
 N FBDX,EDATE,DA,DP
"RTN","FBAAMP1",57,0)
 S EDATE=FBINDT ; edate is the date of interest for ICD10 diagnosis code lookup
"RTN","FBAAMP1",58,0)
 S DA=DFN,DP=162.03 ; these must be defined prior to calling $$ASKICD10
"RTN","FBAAMP1",59,0)
 S FBDX=-1 S FBDX=$$ASKICD10^FBASF("PRIMARY DIAGNOSIS","","Y") ; returns -1 or ien of icd10 diagnosis code
"RTN","FBAAMP1",60,0)
 K EDATE,FBINDT
"RTN","FBAAMP1",61,0)
 Q FBDX
"RTN","FBAAMP1",62,0)
 ;
"RTN","FBAAMP1",63,0)
HCFA1 D ^DIR I $D(DTOUT)!($D(DUOUT)) S FBAAOUT=1 Q
"RTN","FBAAMP1",64,0)
 I Y'=-1 D
"RTN","FBAAMP1",65,0)
 .I DIR(0)["P" S FBHCFA(FBSI)=$P(Y,"^")
"RTN","FBAAMP1",66,0)
 .I DIR(0)="Y" S FBHCFA(FBSI)=$S(Y=1:"Y",1:"N")
"RTN","FBAAMP1",67,0)
 K DIR Q
"RTN","FBAAMP1",68,0)
DESC N FBJ
"RTN","FBAAMP1",69,0)
 I FBAASC=4,$D(^TMP($J,"FBWP",0)) S ^FBAAC(DFN,1,FBV,1,FBSDI,1,FBAACPI,1,0)=^(0) F FBJ=1:1 Q:'$D(^TMP($J,"FBWP",FBJ,0))  S ^FBAAC(DFN,1,FBV,1,FBSDI,1,FBAACPI,1,FBJ,0)=^(0)
"RTN","FBAAMP1",70,0)
 Q
"RTN","FBAAPET")
0^20^B51739856^B51663555
"RTN","FBAAPET",1,0)
FBAAPET ;AISC/DMK - EDIT PAYMENT ;10/1/14  17:10
"RTN","FBAAPET",2,0)
 ;;3.5;FEE BASIS;**4,38,55,61,77,116,122,133,108,124,132,139,123,154,158**;JAN 30, 1995;Build 94
"RTN","FBAAPET",3,0)
 ;;Per VA Directive 6402, this routine should not be modified.
"RTN","FBAAPET",4,0)
 S FBOT=1
"RTN","FBAAPET",5,0)
GETPT I $G(BAT) D
"RTN","FBAAPET",6,0)
 .I '$D(^FBAAC("AC",+BAT)) F I=9,10,11 S $P(^FBAA(161.7,+BAT,0),U,I)=""
"RTN","FBAAPET",7,0)
 .I $D(^FBAAC("AC",+BAT)) D  S $P(^FBAA(161.7,+BAT,0),U,11)=I,$P(^(0),U,9)=$G(FBTOT) K I,FBTOT
"RTN","FBAAPET",8,0)
 ..N J,K,L,M S (I,J,K,L,M,FBTOT)=0
"RTN","FBAAPET",9,0)
 ..F  S J=$O(^FBAAC("AC",+BAT,J)) Q:'J  F  S K=$O(^FBAAC("AC",+BAT,J,K)) Q:'K  F  S L=$O(^FBAAC("AC",+BAT,J,K,L)) Q:'L  F  S M=$O(^FBAAC("AC",+BAT,J,K,L,M)) Q:'M  I $D(^FBAAC(J,1,K,1,L,1,M,0)) S I=I+1,FBTOT=FBTOT+$P(^(0),U,3)
"RTN","FBAAPET",10,0)
 W !! S DIC="^FBAAC(",DIC(0)="AEQM" D ^DIC G END:X="^"!(X=""),GETPT:Y<0 S (DFN,FBDA(3))=+Y
"RTN","FBAAPET",11,0)
 S:'$D(^FBAAC(DFN,1,0)) ^FBAAC(DFN,1,0)="^162.01P^0^0"
"RTN","FBAAPET",12,0)
 S DIC=DIC_DFN_",1,"
"RTN","FBAAPET",13,0)
GETVD W !! S DIC(0)="AEQM" D ^DIC G GETPT:X="^"!(X=""),GETVD:Y<0 S (FBV,FBVD,FBDA(2))=+Y
"RTN","FBAAPET",14,0)
 S:'$D(^FBAAC(DFN,1,FBDA(2),1,0)) ^FBAAC(DFN,1,FBDA(2),1,0)="^162.02DA^0^0"
"RTN","FBAAPET",15,0)
 S DIC=DIC_FBVD_",1,"
"RTN","FBAAPET",16,0)
GETDT S DIC(0)="AEQM",DIC("A")="Date of Service: " D ^DIC K DIC("A") G GETPT:X="^"!(X=""),GETDT:Y<0 S (FBSD,FBSDI,FBDA(1))=+Y,FBAADT=$P(Y,U,2)
"RTN","FBAAPET",17,0)
 S:'$D(^FBAAC(DFN,1,FBDA(2),1,FBDA(1),1,0)) ^FBAAC(DFN,1,FBDA(2),1,FBDA(1),1,0)="^162.03A^0^0"
"RTN","FBAAPET",18,0)
 S FBZ=DIC_FBSD_",1,"
"RTN","FBAAPET",19,0)
SERV S DA(3)=FBDA(3),DA(2)=FBDA(2),DA(1)=FBDA(1)
"RTN","FBAAPET",20,0)
 S DIC("W")="N FBX S FBX=$$MODL^FBAAUTL4(""^FBAAC(FBDA(3),1,FBDA(2),1,FBDA(1),1,+Y,""""M"""")"",""E"") W:FBX]"""" ""    CPT Modifier(s): "",FBX Q"
"RTN","FBAAPET",21,0)
 S DIC=FBZ,DIC(0)="AEQMZ"
"RTN","FBAAPET",22,0)
 D
"RTN","FBAAPET",23,0)
 . N ICPTVDT S ICPTVDT=$G(FBAADT) D ^DIC
"RTN","FBAAPET",24,0)
 G GETPT:X="^"!(X=""),SERV:Y<0 S (FBSV,FBAACPI,FBDA)=+Y,BAT=$P(Y(0),U,8),FBDUZ=$P(Y(0),U,7),(FBAACP,FBAACP(0))=$P(Y,U,2),K=$P(Y(0),U,3),FBAAPTC=$P(Y(0),U,20),J(0)=$P(Y(0),U,2)
"RTN","FBAAPET",25,0)
 ;
"RTN","FBAAPET",26,0)
 S FTP=$P($G(^FBAAC(FBDA(3),1,FBDA(2),1,FBDA(1),1,FBDA,3)),U,9)
"RTN","FBAAPET",27,0)
 I '$$UOKPAY^FBUTL9(DFN,FTP) D  G GETPT
"RTN","FBAAPET",28,0)
 . W !!,"You cannot process a payment associated with authorization ",DFN,"-",FTP
"RTN","FBAAPET",29,0)
 . W !,"due to separation of duties."
"RTN","FBAAPET",30,0)
 ;
"RTN","FBAAPET",31,0)
 ; set FB1725 true (1) if payment is for a Mill Bill claim
"RTN","FBAAPET",32,0)
 S FB1725=$S($P(Y(0),U,13)["FB583":+$P($G(^FB583(+$P(Y(0),U,13),0)),U,28),1:0)
"RTN","FBAAPET",33,0)
 I FBDUZ'=DUZ&('$D(^XUSEC("FBAA LEVEL 2",DUZ))) W !!,*7,"Sorry, only the clerk who entered the payment or",!," a holder of the FBAA LEVEL 2 key can edit this payment." G GETPT
"RTN","FBAAPET",34,0)
 ;S FBAAMM1=$P($G(^FBAAC(FBDA(3),1,FBDA(2),1,FBDA(1),1,FBDA,2)),U,2)
"RTN","FBAAPET",35,0)
 S FBFSAMT(0)=$P($G(^FBAAC(FBDA(3),1,FBDA(2),1,FBDA(1),1,FBDA,2)),U,12)
"RTN","FBAAPET",36,0)
 ; determine lesser of original fee schedule amount and amount claimed
"RTN","FBAAPET",37,0)
 S FBAMTPD(0)=$S(FBFSAMT(0)="":J(0),FBFSAMT(0)>J(0):J(0),1:FBFSAMT(0))
"RTN","FBAAPET",38,0)
 S FBMODL=$$MODL^FBAAUTL4("^FBAAC("_FBDA(3)_",1,"_FBDA(2)_",1,"_FBDA(1)_",1,"_FBDA_",""M"")")
"RTN","FBAAPET",39,0)
 ; load current adjustment data
"RTN","FBAAPET",40,0)
 D LOADADJ^FBAAFA(FBDA_","_FBDA(1)_","_FBDA(2)_","_FBDA(3)_",",.FBADJ)
"RTN","FBAAPET",41,0)
 ; save adjustment data prior to edit session in sorted list
"RTN","FBAAPET",42,0)
 S FBADJL(0)=$$ADJL^FBUTL2(.FBADJ) ; sorted list of original adjustments
"RTN","FBAAPET",43,0)
 ; load current remittance remark data
"RTN","FBAAPET",44,0)
 D LOADRR^FBAAFR(FBDA_","_FBDA(1)_","_FBDA(2)_","_FBDA(3)_",",.FBRRMK)
"RTN","FBAAPET",45,0)
 ; save remittance remarks prior to edit session in sorted list
"RTN","FBAAPET",46,0)
 S FBRRMKL(0)=$$RRL^FBUTL4(.FBRRMK)
"RTN","FBAAPET",47,0)
 ; save FPPS data prior to edit session
"RTN","FBAAPET",48,0)
 S FBFPPSC(0)=$P($G(^FBAAC(FBDA(3),1,FBDA(2),1,FBDA(1),1,FBDA,3)),U)
"RTN","FBAAPET",49,0)
 S FBFPPSC=FBFPPSC(0)
"RTN","FBAAPET",50,0)
 S FBFPPSL(0)=$P($G(^FBAAC(FBDA(3),1,FBDA(2),1,FBDA(1),1,FBDA,3)),U,2)
"RTN","FBAAPET",51,0)
 S FBFPPSL=FBFPPSL(0)
"RTN","FBAAPET",52,0)
 G:BAT']"" EDIT
"RTN","FBAAPET",53,0)
 ; check batch status
"RTN","FBAAPET",54,0)
 S FBSTAT=$P($G(^FBAA(161.7,BAT,"ST")),U) ; batch status
"RTN","FBAAPET",55,0)
 I FBSTAT="S",'$D(^XUSEC("FBAA LEVEL 2",DUZ)) W !!,*7,"Sorry, only a holder of the FBAA LEVEL 2 key can edit",!," a payment once the batch has been released." G GETPT
"RTN","FBAAPET",56,0)
 I "^T^F^V^"[(U_FBSTAT_U) W !!,*7,"Sorry, you cannot edit a payment when the batch has been sent to Austin." G GETPT
"RTN","FBAAPET",57,0)
 K FBSTAT
"RTN","FBAAPET",58,0)
 ;
"RTN","FBAAPET",59,0)
EDIT S DA=FBSV
"RTN","FBAAPET",60,0)
 ;
"RTN","FBAAPET",61,0)
 ; first edit CPT code and modifiers
"RTN","FBAAPET",62,0)
 D CPTM^FBAALU(FBAADT,DFN,FBAACP(0),FBMODL) I '$G(FBGOT) G GETPT
"RTN","FBAAPET",63,0)
 ; if CPT was changed then update file
"RTN","FBAAPET",64,0)
 I FBAACP'=FBAACP(0) D  I FBAACP="@" G GETPT
"RTN","FBAAPET",65,0)
 . N FBIENS,FBFDA
"RTN","FBAAPET",66,0)
 . S FBIENS=FBDA_","_FBDA(1)_","_FBDA(2)_","_FBDA(3)_","
"RTN","FBAAPET",67,0)
 . S FBFDA(162.03,FBIENS,.01)=FBAACP
"RTN","FBAAPET",68,0)
 . D FILE^DIE("","FBFDA") D MSG^DIALOG()
"RTN","FBAAPET",69,0)
 ; if modifiers changed then update file
"RTN","FBAAPET",70,0)
 I FBMODL'=$$MODL^FBAAUTL4("FBMODA") D REPMOD^FBAAUTL4(FBDA(3),FBDA(2),FBDA(1),FBDA)
"RTN","FBAAPET",71,0)
 ;
"RTN","FBAAPET",72,0)
 ; Check for IPAC data requirements for Federal Vendors (FB*3.5*123)
"RTN","FBAAPET",73,0)
 I '$$IPACEDIT^FBAAPET1(162.03,.FBDA) G SERV
"RTN","FBAAPET",74,0)
 ;
"RTN","FBAAPET",75,0)
 ; now edit remaining fields
"RTN","FBAAPET",76,0)
 S DIE("NO^")=""
"RTN","FBAAPET",77,0)
 ; FB*3.5*139-JLG-ICD10 REMEDIATION -added FBDXCHK1 and FBDXCHK2
"RTN","FBAAPET",78,0)
 N FBDXCHK1 S FBDXCHK1="S:FBAADT<$$IMPDATE^FBCSV1(""10D"") Y=""@7"";@60;S XX1=-1 S XX1=$$ASKICD10^FBAACO2(FBAADT,""Y"") S:XX1<0 Y=""@60"";28////^S X=XX1;S Y=31;"
"RTN","FBAAPET",79,0)
 N FBDXCHK2 S FBDXCHK2="S:FBAADT<$$IMPDATE^FBCSV1(""10D"") Y=""@8"";@15;S XX1=-1 S XX1=$$ASKICD10^FBAACO2(FBAADT) S:XX1<0 Y=""@15"";28////^S X=XX1;S Y=31;"
"RTN","FBAAPET",80,0)
 S DR="48;47;S FBUNITS=X;42R;S FBZIP=X;S:$$ANES^FBAAFS($$CPT^FBAAUTL4(FBAACP)) Y=""@2"";43///@;S FBTIME=X;S Y=""@3"";@2;43R;S FBTIME=X;@3"
"RTN","FBAAPET",81,0)
 ; fb*3.5*116 remove edit of interest indicator (162.03,34) to prevent different interest indicator values at line item level; interest indicator set at invoice level only; 
"RTN","FBAAPET",82,0)
 S DR(1,162.03,1)="S FBAAMM=$S(FBAAPTC=""R"":"""",1:1);D PPT^FBAACO1(FBAAMM1,FBCNTRP,1);54///@;54////^S X=FBCNTRP;30R;S FBHCFA(30)=X;1;S J=X;Q"
"RTN","FBAAPET",83,0)
 ;S DR(1,162.03,1)="30R;S FBHCFA(30)=X;1;S J=X;Q"
"RTN","FBAAPET",84,0)
 S DR(1,162.03,2)="D FEEDT^FBAACO3;44///@;44///^S X=FBFSAMT;45///@;45///^S X=FBFSUSD;S:FBAMTPD'>0!(FBAMTPD=FBAMTPD(0)) Y=""@4"";2///^S X=FBAMTPD;@4;2//^S X=FBAMTPD;S K=X"
"RTN","FBAAPET",85,0)
 ;S DR(1,162.03,3)="3////^S X=$S(J-K:J-K,1:"""");I X S Y=""@11"";4////@;S Y=""@5"";@11;3R;4R;S:X'=4 Y=""@5"";22"
"RTN","FBAAPET",86,0)
 S DR(1,162.03,3)="K FBADJD;M FBADJD=FBADJ;S FBX=$$ADJ^FBUTL2(J-K,.FBADJ,5,,.FBADJD,1,.FBRRMK,1)"
"RTN","FBAAPET",87,0)
 S DR(1,162.03,4)="S FBX=$$FPPSC^FBUTL5(1,FBFPPSC);S:FBX=-1 Y=0;S:FBX="""" Y=""@5"";50///^S X=FBX;S FBFPPSC=X;S FBX=$$FPPSL^FBUTL5(FBFPPSL);S:FBX=-1 Y=0;51///^S X=FBX;S FBFPPCL=X;S Y=""@55"";@5;50///@;S FBFPPSC="""";51///@;S FBFPPSL="""";@55"
"RTN","FBAAPET",88,0)
 S DR(1,162.03,5)="K DIE(""NO^"");W !,""Exit ('^') allowed now"";26;S PRC(""SITE"")=X;8;@13;13;I $$BADDATE^FBAAPET(FBAADT,X) S Y=""@13"";Q;33;49"
"RTN","FBAAPET",89,0)
 ;JAS - 09/11/13 - PATCH 139 - Modified next two lines (previously one line) for ICD-10
"RTN","FBAAPET",90,0)
 S DR(1,162.03,6)="15;17;16;S:X=1 Y=""@1"";@6;"_FBDXCHK1_"@7;S FBI9=$$ASKICD9^FBAACO2(FBAADT,""Y"") S:+FBI9<0 Y=""@7"";28////^S X=+FBI9;31;32R;S Y=""@9"";"
"RTN","FBAAPET",91,0)
 S DR(1,162.03,7)="@1;"_FBDXCHK2_"@8;S FBI9=$$ASKICD9^FBAACO2(FBAADT) S:+FBI9<0 Y=""@8"";28////^S X=+FBI9;31"
"RTN","FBAAPET",92,0)
 S DR(1,162.03,8)="@9"
"RTN","FBAAPET",93,0)
 S DR(1,162.03,9)="73;74;75;58;59;60;61;62;63;64;65;66;67;76;77;78;79;68;69" ;FB*3.5*122,FB*3.5*133 edit line item provider fields
"RTN","FBAAPET",94,0)
 S DR(1,162.03,10)="@999;K FBDXCHK1,FBDXCHK2,XX1"  ;DEM;139 ICD-10 ASF
"RTN","FBAAPET",95,0)
 S DR(1,162.03,11)="82///^S X=$$PYMTH^FBAAUTL(FBFSUSD)" ;FB*3.5*158
"RTN","FBAAPET",96,0)
 S DIE=FBZ
"RTN","FBAAPET",97,0)
 D
"RTN","FBAAPET",98,0)
 . N ICPTVDT,ICDVDT,FB583,FBAAMM,FBAAMM1,FBCNTRA,FBCNTRP,FBVEN,FTP
"RTN","FBAAPET",99,0)
 . S (ICPTVDT,ICDVDT)=$G(FBAADT)
"RTN","FBAAPET",100,0)
 . ; set variables for call to PPT^FBAACO1
"RTN","FBAAPET",101,0)
 . S FBAAMM1=$P($G(^FBAAC(FBDA(3),1,FBDA(2),1,FBDA(1),1,FBDA,2)),U,2)
"RTN","FBAAPET",102,0)
 . S FBCNTRP=$P($G(^FBAAC(FBDA(3),1,FBDA(2),1,FBDA(1),1,FBDA,3)),U,8)
"RTN","FBAAPET",103,0)
 . S X=$P($G(^FBAAC(FBDA(3),1,FBDA(2),1,FBDA(1),1,FBDA,0)),U,13)
"RTN","FBAAPET",104,0)
 . S:X[";FB583(" FB583=+X
"RTN","FBAAPET",105,0)
 . S FTP=$P($G(^FBAAC(FBDA(3),1,FBDA(2),1,FBDA(1),1,FBDA,3)),U,9)
"RTN","FBAAPET",106,0)
 . S FBVEN=$S(FTP:$P($G(^FBAAA(DFN,1,FTP,0)),U,4),1:"")
"RTN","FBAAPET",107,0)
 . S FBCNTRA=$S(FTP:$P($G(^FBAAA(DFN,1,FTP,0)),U,22),1:"")
"RTN","FBAAPET",108,0)
 . D ^DIE
"RTN","FBAAPET",109,0)
 ; if adjustment data changed then file
"RTN","FBAAPET",110,0)
 I $$ADJL^FBUTL2(.FBADJ)'=FBADJL(0) D FILEADJ^FBAAFA(FBDA_","_FBDA(1)_","_FBDA(2)_","_FBDA(3)_",",.FBADJ)
"RTN","FBAAPET",111,0)
 ; if remit remark data changed then file
"RTN","FBAAPET",112,0)
 I $$RRL^FBUTL4(.FBRRMK)'=FBRRMKL(0) D FILERR^FBAAFR(FBDA_","_FBDA(1)_","_FBDA(2)_","_FBDA(3)_",",.FBRRMK)
"RTN","FBAAPET",113,0)
 ; if FPPS CLAIM ID changed, update other line items on invoice
"RTN","FBAAPET",114,0)
 I FBFPPSC'=FBFPPSC(0) D
"RTN","FBAAPET",115,0)
 . N FBAAIN
"RTN","FBAAPET",116,0)
 . S FBAAIN=$$GET1^DIQ(162.03,FBDA_","_FBDA(1)_","_FBDA(2)_","_FBDA(3)_",",14)
"RTN","FBAAPET",117,0)
 . D CKINVEDI^FBAAPET1(FBFPPSC(0),FBFPPSC,FBAAIN,FBDA_","_FBDA(1)_","_FBDA(2)_","_FBDA(3)_",")
"RTN","FBAAPET",118,0)
 K FBSV W !! G SERV
"RTN","FBAAPET",119,0)
 ;
"RTN","FBAAPET",120,0)
BADDATE(FBDOS,INVRCVDT) ;Reject entry if InvRcvDt is Prior to the Date of Service on the Invoice
"RTN","FBAAPET",121,0)
 I INVRCVDT<FBDOS D  Q 1 ;Reject entry
"RTN","FBAAPET",122,0)
 .N SHOWDOS S SHOWDOS=$E(FBDOS,4,5)_"/"_$E(FBDOS,6,7)_"/"_$E(FBDOS,2,3) ;Convert FBDOS into display format for error message
"RTN","FBAAPET",123,0)
 .W *7,!!?5,"*** Invoice Received Date cannot be prior to the",!?8,"Date of Service ("_SHOWDOS_") !!!"
"RTN","FBAAPET",124,0)
 Q 0 ;Accept entry
"RTN","FBAAPET",125,0)
 ;
"RTN","FBAAPET",126,0)
END K DR,DIC,DIE,X,DFN,FBOT,FBVD,FBSD,BAT,FBAADT,FBSV,DA,FBDA,FBZ,FBDUZ,FBAACP,FBFY,FY,FBAMTPD,J,K,Y,ZZ,PRC,FBHOLDX,FBV,FBSDI,FBAACPI
"RTN","FBAAPET",127,0)
 K FBFSAMT,FBFSUSD,FBMODA,FBZIP,FBTIME,FBHCFA(30),FBAAPTC,FB1725,FBADJ,FBADJD,FBADJL(0),FBRRMK,FBRRMKD,FBRRMKL(0),FBX,FBUNITS,FTP
"RTN","FBAAPET",128,0)
 Q
"RTN","FBAAPP0")
0^21^B4339891^B4309645
"RTN","FBAAPP0",1,0)
FBAAPP0 ;AISC/GRR-ENTER FEE PHARMACY DETERMINATION CONT ;4/27/2005
"RTN","FBAAPP0",2,0)
 ;;3.5;FEE BASIS;**61,91,158**;JAN 30, 1995;Build 94
"RTN","FBAAPP0",3,0)
 ;;Per VA Directive 6402, this routine should not be modified.
"RTN","FBAAPP0",4,0)
HELPI W !!,"Enter Invoice number you wish to make a determination on.  Must",!,"be an invoice which is 'Pending Determination' status." G RDIN^FBAAPP
"RTN","FBAAPP0",5,0)
ALRDY W !,*7,"Someone is editing that invoice now!" G RDIN^FBAAPP
"RTN","FBAAPP0",6,0)
 ;
"RTN","FBAAPP0",7,0)
NO1 ;ASK PHARMACIST TO SPECIFY ADJUSTMENT REASON
"RTN","FBAAPP0",8,0)
 N FBX
"RTN","FBAAPP0",9,0)
 ; prompt for adjustments
"RTN","FBAAPP0",10,0)
 S FBX=$$ADJ^FBUTL2($P(FBY(0),U,4),.FBADJ,5,,,,.FBRRMK) Q:FBX=0
"RTN","FBAAPP0",11,0)
 ; prompt for carcless rarcs
"RTN","FBAAPP0",12,0)
 S FBX=$$CLESSR^FBUTL4A(.FBADJ,5,.FBRRMK)
"RTN","FBAAPP0",13,0)
 Q
"RTN","FBAAPP0",14,0)
 ;
"RTN","FBAAPP0",15,0)
GOON ; entry point when prescription was denied by pharmacy
"RTN","FBAAPP0",16,0)
 S STAT=3,$P(FBY(0),"^",11)=0,$P(FBY(0),"^",14)=DUZ,$P(FBY(0),"^",15)=DT,$P(FBY(0),"^",9)=3,$P(FBY(0),"^",16)=0
"RTN","FBAAPP0",17,0)
RSET ; entry point when prescription was not denied by pharmacy
"RTN","FBAAPP0",18,0)
 S $P(FBY(0),"^",21)=$S(FBAAGP="Yes":"Y",FBAAGP="No":"N",1:"")
"RTN","FBAAPP0",19,0)
 S $P(FBY(0),"^",22)=FBAAPR
"RTN","FBAAPP0",20,0)
 S ^FBAA(162.1,FBJ,"RX",FBK,0)=FBY(0)
"RTN","FBAAPP0",21,0)
 K ^FBAA(162.1,FBJ,"RX","AC",1,FBK) S ^FBAA(162.1,FBJ,"RX","AC",STAT,FBK)="",$P(^FBAA(162.1,FBJ,0),"^",5)=$S($D(^FBAA(162.1,FBJ,"RX","AC",1)):1,$D(^(2)):2,$D(^(3)):3,1:0)
"RTN","FBAAPP0",22,0)
 I '$D(^FBAA(162.1,FBJ,"RX","AC",1)) K ^FBAA(162.1,"AC",1,FBJ) S ^FBAA(162.1,"AC",2,FBJ)=""
"RTN","FBAAPP0",23,0)
 I $D(FBADJ) D
"RTN","FBAAPP0",24,0)
 . D FILEADJ^FBRXFA(FBK_","_FBJ_",",.FBADJ) ; file adjustments
"RTN","FBAAPP0",25,0)
 . D FILERR^FBRXFR(FBK_","_FBJ_",",.FBRRMK) ; file remittance remarks
"RTN","FBAAPP0",26,0)
 Q
"RTN","FBAAUTL")
0^2^B36872113^B26368074
"RTN","FBAAUTL",1,0)
FBAAUTL ;AISC/GRR,SBW-Fee Basis Utility Routine ; 4/23/10 3:06pm
"RTN","FBAAUTL",2,0)
 ;;3.5;FEE BASIS;**101,114,108,124,127,158**;JAN 30, 1995;Build 94
"RTN","FBAAUTL",3,0)
 ;;Per VA Directive 6402, this routine should not be modified.
"RTN","FBAAUTL",4,0)
DATE N FBDT S FBPOP=0 K BEGDATE,ENDDATE K:$G(%DT)'["A" %DT W !!,"**** Date Range Selection ****"
"RTN","FBAAUTL",5,0)
 S FBDT=$S($D(%DT):1,1:0) W ! S %DT=$S(FBDT:%DT,1:"APEX"),%DT("A")="   Beginning DATE : " D ^%DT S:Y<0 FBPOP=1 Q:Y<0  S (%DT(0),BEGDATE)=Y
"RTN","FBAAUTL",6,0)
 W ! S %DT=$S(FBDT:%DT,1:"AEX"),%DT("A")="   Ending    DATE : " D ^%DT K %DT S:Y<0 FBPOP=1 Q:Y<0  W ! S ENDDATE=Y
"RTN","FBAAUTL",7,0)
 Q
"RTN","FBAAUTL",8,0)
 ;
"RTN","FBAAUTL",9,0)
ZIS S ZTRTN=PGM,ZTSAVE="",FBPOP=0 F I=1:1 Q:$P(VAR,"^",I)']""  S ZTSAVE($P(VAR,"^",I))=""
"RTN","FBAAUTL",10,0)
 I '$D(ZTDESC) S ZTDESC=$S($D(PGM):PGM,1:"UNKNOWN OPTION")
"RTN","FBAAUTL",11,0)
 W ! S %ZIS="QMP" D ^%ZIS S:POP FBPOP=1 Q:POP  I $D(IO("Q")) K IO("Q"),ZTIO D ^%ZTLOAD W:$D(ZTSK) !,*7,"REQUEST QUEUED",!,"Task #: ",$G(ZTSK) K I,ZTSK,ZTIO,ZTSAVE,ZTRTN D HOME^%ZIS S FBPOP=1 Q
"RTN","FBAAUTL",12,0)
 Q
"RTN","FBAAUTL",13,0)
 ;
"RTN","FBAAUTL",14,0)
CLOSE I '$D(ZTQUEUED) D ^%ZISC
"RTN","FBAAUTL",15,0)
 K IOP,ZTDESC,ZTRTN,ZTSAVE,ZTDTH,VAR,VAL,PGM,FBPOP,POP Q
"RTN","FBAAUTL",16,0)
 ;
"RTN","FBAAUTL",17,0)
D S Y=$P("JAN^FEB^MAR^APR^MAY^JUN^JUL^AUG^SEP^OCT^NOV^DEC","^",$E(Y,4,5))_" "_$S(Y#100:$J(Y#100\1,2)_",",1:"")_(Y\10000+1700)_$S(Y#1:"  "_$E(Y_0,9,10)_":"_$E(Y_"000",11,12),1:"") Q
"RTN","FBAAUTL",18,0)
SITEP ;SET FBSITE(0),FBSITE(1) VARIABLE TO FEE SITE PARAMETERS
"RTN","FBAAUTL",19,0)
 S FBPOP=0,FBSITE(0)=$G(^FBAA(161.4,1,0)) S:FBSITE(0)']"" FBPOP=1
"RTN","FBAAUTL",20,0)
 S FBSITE(1)=$G(^FBAA(161.4,1,1)) S:FBSITE(1)']"" FBPOP=1
"RTN","FBAAUTL",21,0)
 S FBSITE("FBNUM")=$G(^FBAA(161.4,1,"FBNUM")) S:FBSITE("FBNUM")']"" FBPOP=1
"RTN","FBAAUTL",22,0)
 W:FBPOP !,*7,"Fee Basis Site Parameters must be entered to proceed",!
"RTN","FBAAUTL",23,0)
 Q
"RTN","FBAAUTL",24,0)
TM S X=$E($P(X,".",2)_"0000",1,4),%=X>1159 S:X>1259 X=X-1200 S X=X\100_":"_$E(X#100+100,2,3)_" "_$E("AP",%+1)_"M" Q
"RTN","FBAAUTL",25,0)
PDF S:Y Y=$E(Y,4,5)_"/"_$E(Y,6,7)_"/"_$E(Y,2,3) Q
"RTN","FBAAUTL",26,0)
GETNXB ;GET NEXT AVAILABLE BATCH NUMBER
"RTN","FBAAUTL",27,0)
 L +^FBAA(161.4):$G(DILOCKTM,3) I '$T D  G GETNXB
"RTN","FBAAUTL",28,0)
 .W !,"Another user is opening a batch.  Trying again.",!
"RTN","FBAAUTL",29,0)
 I '$D(^FBAA(161.4,1,"FBNUM")) S ^FBAA(161.4,1,"FBNUM")="1^1"
"RTN","FBAAUTL",30,0)
 I '$P($G(^FBAA(161.4,1,"FBNUM")),"^") S $P(^("FBNUM"),"^")=1
"RTN","FBAAUTL",31,0)
 S FBBN=$P(^FBAA(161.4,1,"FBNUM"),"^")
"RTN","FBAAUTL",32,0)
 N FBBATLT ;Batches Left *127
"RTN","FBAAUTL",33,0)
 S FBBATLT=$P($G(^FBAA(161.7,0)),U,4)
"RTN","FBAAUTL",34,0)
 I FBBATLT>9999499 D WARNBT ;*114,127,FB*3.5*158
"RTN","FBAAUTL",35,0)
 S $P(^FBAA(161.4,1,"FBNUM"),"^",1)=$S(FBBN+1>9999999:1,1:FBBN+1) I '$$CHKBI^FBAAUTL4(FBBN,1) L -^FBAA(161.4) G GETNXB
"RTN","FBAAUTL",36,0)
 L -^FBAA(161.4) Q
"RTN","FBAAUTL",37,0)
WARNBT W !,*7,"There are ",9999999-FBBATLT," batches left before the BATCH PURGE routine",!,"needs to be run. Contact your IRM Service!",!!
"RTN","FBAAUTL",38,0)
 Q
"RTN","FBAAUTL",39,0)
GETNXI ;GET NEXT AVAILABLE INVOICE NUMBER 
"RTN","FBAAUTL",40,0)
 L +^FBAA(161.4):$G(DILOCKTM,3) I '$T D  G GETNXI
"RTN","FBAAUTL",41,0)
 .W !,"Another user is obtaining an invoice number.  Trying again.",!
"RTN","FBAAUTL",42,0)
 I '$D(^FBAA(161.4,1,"FBNUM")) S ^FBAA(161.4,1,"FBNUM")="1^1"
"RTN","FBAAUTL",43,0)
 I '$P($G(^FBAA(161.4,1,"FBNUM")),U,2) S $P(^("FBNUM"),U,2)=1
"RTN","FBAAUTL",44,0)
 S FBAAIN=$P(^FBAA(161.4,1,"FBNUM"),"^",2),$P(^("FBNUM"),"^",2)=$S(FBAAIN+1>9999999:1,1:FBAAIN+1) I '$$CHKBI^FBAAUTL4(FBAAIN) L -^FBAA(161.4) G GETNXI
"RTN","FBAAUTL",45,0)
 L -^FBAA(161.4) Q
"RTN","FBAAUTL",46,0)
PDATE S FBPDT=$P("January^February^March^April^May^June^July^August^September^October^November^December","^",$E(Y,4,5))_" "_$S(Y#100:$J(Y#100\1,2)_", ",1:"")_(Y\10000+1700)_$S(Y#1:"  "_$E(Y_0,9,10)_":"_$E(Y_"000",11,12),1:"") Q
"RTN","FBAAUTL",47,0)
DATCK S HOLDY=Y,HOLDY=$S($P(HOLDY,"^",2):$P(HOLDY,"^",2),1:HOLDY)
"RTN","FBAAUTL",48,0)
 I $D(FBAAID),Y>FBAAID D  K X Q
"RTN","FBAAUTL",49,0)
 .N SHODAT S SHODAT=$E(FBAAID,4,5)_"/"_$E(FBAAID,6,7)_"/"_$E(FBAAID,2,3)
"RTN","FBAAUTL",50,0)
 .W !!,*7,?5,"*** Date of Service cannot be later than",!?8," Invoice Received Date ("_SHODAT_") !!!",!
"RTN","FBAAUTL",51,0)
 I $D(FBAABDT),$D(FBAAEDT),(Y<FBAABDT!(Y>FBAAEDT)) D  K X
"RTN","FBAAUTL",52,0)
 .N PRIORLAT,AUTHDAT,SHODAT
"RTN","FBAAUTL",53,0)
 .S PRIORLAT=$S($P(Y,"^",2)<FBAABDT:"prior to ",1:"later than ")
"RTN","FBAAUTL",54,0)
 .S AUTHDAT=$S($P(Y,"^",2)<FBAABDT:FBAABDT,1:FBAAEDT)
"RTN","FBAAUTL",55,0)
 .S SHODAT=$E(AUTHDAT,4,5)_"/"_$E(AUTHDAT,6,7)_"/"_$E(AUTHDAT,2,3)
"RTN","FBAAUTL",56,0)
 .W !!,*7,?5,"*** Date of Service cannot be ",PRIORLAT
"RTN","FBAAUTL",57,0)
 .W !?8," Authorization period ("_SHODAT_") !!!",!
"RTN","FBAAUTL",58,0)
 S Y=HOLDY Q
"RTN","FBAAUTL",59,0)
 ;
"RTN","FBAAUTL",60,0)
DATX(X) ;external output function for date format
"RTN","FBAAUTL",61,0)
 ;INPUT = FM internal date format (time optional)
"RTN","FBAAUTL",62,0)
 ;OUTPUT = date/time with slashes
"RTN","FBAAUTL",63,0)
 Q $$FMTE^XLFDT(X,2)
"RTN","FBAAUTL",64,0)
 ;
"RTN","FBAAUTL",65,0)
STATION ;GET STATION NUMBER FROM INSTITUTION FILE
"RTN","FBAAUTL",66,0)
 I '$D(FBSITE(1)) D SITEP
"RTN","FBAAUTL",67,0)
 I $S('$D(FBSITE(1)):1,$P(FBSITE(1),"^",3)="":1,'$D(^DIC(4,$P(FBSITE(1),"^",3),0)):1,'$D(^DIC(4,$P(FBSITE(1),"^",3),99)):1,'+$P(^DIC(4,$P(FBSITE(1),"^",3),99),"^"):1,1:0) G NOSTA
"RTN","FBAAUTL",68,0)
 S (FBSN,FBAASN)=$S($D(^DIC(4,$P(FBSITE(1),"^",3),99)):$E(^(99),1,3),1:999)
"RTN","FBAAUTL",69,0)
 Q
"RTN","FBAAUTL",70,0)
NOSTA S FB("ERROR")=1 I '$D(ZTQUEUED) W !!,*7,"Unable to determine Station Number. Check Fee Site Parameters or Station Number in the Institution File.",!!
"RTN","FBAAUTL",71,0)
 Q
"RTN","FBAAUTL",72,0)
 ;
"RTN","FBAAUTL",73,0)
HD ;set transmission header
"RTN","FBAAUTL",74,0)
 I '$D(FBSITE(1)) S FBSITE(1)=$G(^FBAA(161.4,1,1))
"RTN","FBAAUTL",75,0)
 S FBHD=$$HDR^FBAAUTL3() I FBHD']"" S FB("ERROR")=1 W !,"Transmission header must exist in FEE BASIS SITE PARAMETER file",!,"before you can proceed.",*7,!
"RTN","FBAAUTL",76,0)
 Q
"RTN","FBAAUTL",77,0)
 ;
"RTN","FBAAUTL",78,0)
SSN(PID,BID,DOD) ;
"RTN","FBAAUTL",79,0)
 ;PID = DFN of Patient. If this is all that is past,
"RTN","FBAAUTL",80,0)
 ;full Pt.ID (000-00-0000) will be returned.
"RTN","FBAAUTL",81,0)
 ;If BID = 1 the call will return last 4 of Pt.ID only.
"RTN","FBAAUTL",82,0)
 ;If DOD is defined to internal entry # of eligibility the appropriate
"RTN","FBAAUTL",83,0)
 ;Pt.ID will be returned.
"RTN","FBAAUTL",84,0)
 N DFN,FBSSN
"RTN","FBAAUTL",85,0)
 S DFN=PID
"RTN","FBAAUTL",86,0)
 I 'DFN Q "Unknown"
"RTN","FBAAUTL",87,0)
 S:'$D(BID) BID="" S:$D(DOD) VAPTYP=DOD
"RTN","FBAAUTL",88,0)
 D PID^VADPT6 I VAERR K VAERR Q "Unknown"
"RTN","FBAAUTL",89,0)
 S FBSSN=$S(BID:VA("BID"),1:VA("PID"))
"RTN","FBAAUTL",90,0)
 K VA("BID"),VA("PID"),VAERR,VAPTYP
"RTN","FBAAUTL",91,0)
 Q FBSSN
"RTN","FBAAUTL",92,0)
 ;
"RTN","FBAAUTL",93,0)
SSNL4(SSN) ;Convert 1st 5 digits of SSN to X (Only print last 4 digits of SSN)
"RTN","FBAAUTL",94,0)
 ;Input:
"RTN","FBAAUTL",95,0)
 ;   SSN - SSN in 9 digit or ###-##-#### format
"RTN","FBAAUTL",96,0)
 ;     Pseudo SSN is also allowed as input
"RTN","FBAAUTL",97,0)
 ;Output
"RTN","FBAAUTL",98,0)
 ;   SSN - SSN in XXXXX#### or XXX-XX-#### format
"RTN","FBAAUTL",99,0)
 ;     Pseudo SSN will be changed as above with passed "P" at end
"RTN","FBAAUTL",100,0)
 ; X represent actual X and # represent digit
"RTN","FBAAUTL",101,0)
 ;
"RTN","FBAAUTL",102,0)
 S SSN=$G(SSN)
"RTN","FBAAUTL",103,0)
 ;Change SSN ######### to XXXXX####
"RTN","FBAAUTL",104,0)
 S:SSN?9N0.1"P" $E(SSN,1,5)="XXXXX"
"RTN","FBAAUTL",105,0)
 ;Change SSN ###-##-#### to XXX-XX-####
"RTN","FBAAUTL",106,0)
 S:SSN?3N1"-"2N1"-"4N0.1"P" $E(SSN,1,7)="XXX-XX-"
"RTN","FBAAUTL",107,0)
 Q SSN
"RTN","FBAAUTL",108,0)
 ;
"RTN","FBAAUTL",109,0)
PYMTH(CODE) ; Payment Methodology Processing (FB*3.5*158)
"RTN","FBAAUTL",110,0)
 ; input --> CODE: Fee Schedule/Payment Methodology code
"RTN","FBAAUTL",111,0)
 ; output --> Payment methodology name or '@' to delete existing value
"RTN","FBAAUTL",112,0)
 ;
"RTN","FBAAUTL",113,0)
 ;S CODE="F" ;debug
"RTN","FBAAUTL",114,0)
 Q:CODE']"" "@"
"RTN","FBAAUTL",115,0)
 N IEN
"RTN","FBAAUTL",116,0)
 S IEN=$O(^FBAA(163.98,"C",CODE,""))
"RTN","FBAAUTL",117,0)
 Q $S(IEN:$P(^FBAA(163.98,IEN,0),U),1:"@")
"RTN","FBAAUTL",118,0)
 ;
"RTN","FBAAUTL",119,0)
CRARC(FBADJ,FBRRMK,FBCRARC) ; compile CARCs and RARCs into an array for batch processing
"RTN","FBAAUTL",120,0)
 ;
"RTN","FBAAUTL",121,0)
 N I,J,K,FBADJGI,FBADJGE,FBADJRI,FBADJRE,FBADJA,FBADJAE,FBRRMKI,FBRRMKE,CNT
"RTN","FBAAUTL",122,0)
 S (I,CNT)=0
"RTN","FBAAUTL",123,0)
 F  S I=$O(FBADJ(I)) Q:'I  D
"RTN","FBAAUTL",124,0)
 . S CNT=I
"RTN","FBAAUTL",125,0)
 . S X=$P(FBADJ(I),U,2)_U_$P(FBADJ(I),U)_U_$P(FBADJ(I),U,3)
"RTN","FBAAUTL",126,0)
 . S FBADJGI=$P(FBADJ(I),U,2)
"RTN","FBAAUTL",127,0)
 . S FBADJGE=$S(FBADJGI:$P($G(^FB(161.92,FBADJGI,0)),U),1:"")
"RTN","FBAAUTL",128,0)
 . S FBADJRI=$P(FBADJ(I),U)
"RTN","FBAAUTL",129,0)
 . S FBADJRE=$S(FBADJRI:$P($G(^FB(161.91,FBADJRI,0)),U),1:"")
"RTN","FBAAUTL",130,0)
 . S FBADJA=$P(FBADJ(I),U,3)
"RTN","FBAAUTL",131,0)
 . S FBADJAE=$FN(FBADJA,"",2)
"RTN","FBAAUTL",132,0)
 . S FBCRARC(I)=FBADJGE_U_FBADJRE_U_FBADJAE_U
"RTN","FBAAUTL",133,0)
 . ; RARCs
"RTN","FBAAUTL",134,0)
 . S J=0
"RTN","FBAAUTL",135,0)
 . F  S J=$O(FBRRMK(FBADJRI,J)) Q:'J  D
"RTN","FBAAUTL",136,0)
 . . S FBRRMKI=FBRRMK(FBADJRI,J)
"RTN","FBAAUTL",137,0)
 . . S FBRRMKE=$S(FBRRMKI:$P($G(^FB(161.93,FBRRMKI,0)),U),1:"")
"RTN","FBAAUTL",138,0)
 . . S FBCRARC(I)=FBCRARC(I)_FBRRMKE_U
"RTN","FBAAUTL",139,0)
 ; CARCless RARCs
"RTN","FBAAUTL",140,0)
 S FBADJRI=999,J=0,(FBADJGE,FBADJRE,FBADJAE)="",DONE=0,I=CNT
"RTN","FBAAUTL",141,0)
 F  D  Q:DONE
"RTN","FBAAUTL",142,0)
 . S I=I+1
"RTN","FBAAUTL",143,0)
 . F K=1:1:2 D  I 'J S DONE=1 Q
"RTN","FBAAUTL",144,0)
 . . S J=$O(FBRRMK(FBADJRI,J)) Q:'J  D
"RTN","FBAAUTL",145,0)
 . . S:K=1 FBCRARC(I)=FBADJGE_U_FBADJRE_U_FBADJAE_U
"RTN","FBAAUTL",146,0)
 . . S FBRRMKI=FBRRMK(FBADJRI,J)
"RTN","FBAAUTL",147,0)
 . . S FBRRMKE=$S(FBRRMKI:$P($G(^FB(161.93,FBRRMKI,0)),U),1:"")
"RTN","FBAAUTL",148,0)
 . . S FBCRARC(I)=FBCRARC(I)_FBRRMKE_U
"RTN","FBAAUTL",149,0)
 Q
"RTN","FBAAUTL",150,0)
 ;
"RTN","FBAAUTL3")
0^34^B4122598^B4132421
"RTN","FBAAUTL3",1,0)
FBAAUTL3 ;AISC/DMK - FEE BASIS UTILITY ROUTINE ;4/20/2012
"RTN","FBAAUTL3",2,0)
 ;;3.5;FEE BASIS;**132,158**;JAN 30, 1995;Build 94
"RTN","FBAAUTL3",3,0)
 ;;Per VA Directive 6402, this routine should not be modified.
"RTN","FBAAUTL3",4,0)
HDR() ;this is a supported call to be used by IFCAP to determine
"RTN","FBAAUTL3",5,0)
 ;the System Identifier for the 994 code sheets
"RTN","FBAAUTL3",6,0)
 ;Q $S($P($G(^FBAA(161.4,1,1)),U,10)]"":$P(^(1),U,10),1:"FEN")
"RTN","FBAAUTL3",7,0)
 ; switch to FEE for the Subsystem Identifier FB*3.5*132
"RTN","FBAAUTL3",8,0)
 ;Q $S($$VER5():"FEN",1:"FEE")
"RTN","FBAAUTL3",9,0)
 Q "FEN"  ;FB*3.5*158
"RTN","FBAAUTL3",10,0)
 ;
"RTN","FBAAUTL3",11,0)
POV(X) ;determine ien of pov based on austin code
"RTN","FBAAUTL3",12,0)
 ;INPUT:  X = pov code
"RTN","FBAAUTL3",13,0)
 ;OUTPUT: ien of active record containing passed pov code or 0
"RTN","FBAAUTL3",14,0)
 S:X']"" X=0
"RTN","FBAAUTL3",15,0)
 Q +$O(^FBAA(161.82,"AC",X,0))
"RTN","FBAAUTL3",16,0)
 ;
"RTN","FBAAUTL3",17,0)
RCOMP ;entry point to re-compile templates
"RTN","FBAAUTL3",18,0)
 S:'$D(DTIME) DTIME=300 S U="^"
"RTN","FBAAUTL3",19,0)
 S DIR(0)="Y",DIR("A")="Re-compile FB input templates" D ^DIR K DIR G RCOMPQ:'Y
"RTN","FBAAUTL3",20,0)
 S $P(QQ,"=",81)="" W !!?17,"Recompilation of Fee Basis Input Templates",!,QQ
"RTN","FBAAUTL3",21,0)
 S FBMAX=^DD("ROU") F FBX="FB VENDOR UPDATE","FBAA AUTHORIZATION" S Y=$O(^DIE("B",FBX,0)) Q:'Y  I $D(^DIE(Y,"ROUOLD")),^("ROUOLD")]"",$D(^(0)) S X=$P(^("ROUOLD"),"^"),DMAX=FBMAX D EN^DIEZ
"RTN","FBAAUTL3",22,0)
RCOMPQ ;kill off variables and exit re-compile option
"RTN","FBAAUTL3",23,0)
 K DMAX,FBX,Y,X,QQ,FBMAX
"RTN","FBAAUTL3",24,0)
 Q
"RTN","FBAAUTL3",25,0)
 ;
"RTN","FBAAUTL3",26,0)
UP(X) ;entry point to convert lower case to upper case letters
"RTN","FBAAUTL3",27,0)
 I $G(X)']"" Q 0
"RTN","FBAAUTL3",28,0)
 Q $TR(X,"abcdefghijklmnopqrstuvwxyz","ABCDEFGHIJKLMNOPQRSTUVWXYZ")
"RTN","FBAAUTL3",29,0)
 ;
"RTN","FBAAUTL3",30,0)
YN ;called from input transform on Yes - No type fields to allow
"RTN","FBAAUTL3",31,0)
 ;a user to enter:
"RTN","FBAAUTL3",32,0)
 ;              1 = Yes     0 = No  stores Y or N
"RTN","FBAAUTL3",33,0)
 ;
"RTN","FBAAUTL3",34,0)
 S X=$E($$UP^FBAAUTL3(X))
"RTN","FBAAUTL3",35,0)
 S X=$S(X:"Y",X="Y":X,X="N":X,X=0:"N",1:2)
"RTN","FBAAUTL3",36,0)
 I X'=2 W "  (",$S(X="Y":"YES",1:"NO"),")" Q
"RTN","FBAAUTL3",37,0)
 W *7,!?4,"NOT A VALID ENTRY!" K X
"RTN","FBAAUTL3",38,0)
 Q
"RTN","FBAAUTL3",39,0)
 ;
"RTN","FBAAUTL3",40,0)
OUTYN ;called from output transform on fields that are defined as Y/N
"RTN","FBAAUTL3",41,0)
 ;
"RTN","FBAAUTL3",42,0)
 S Y=$S(Y="Y":"YES",Y="N":"NO",1:"")
"RTN","FBAAUTL3",43,0)
 Q
"RTN","FBAAUTL3",44,0)
 ;
"RTN","FBAAUTL3",45,0)
VER5() ;returns '1' if site is running version 5 of IFCAP
"RTN","FBAAUTL3",46,0)
 ;used to handle record layouts for FMS payments
"RTN","FBAAUTL3",47,0)
 N X
"RTN","FBAAUTL3",48,0)
 ;S X=$G(^DIC(9.4,+$O(^DIC(9.4,"C","PRC",0)),"VERSION"))
"RTN","FBAAUTL3",49,0)
 S X=$$VERSION^XPDUTL("PRC")
"RTN","FBAAUTL3",50,0)
 Q $S(+X>4:1,1:0)
"RTN","FBAAUTL3",51,0)
 ;
"RTN","FBAAUTL3",52,0)
IDCHK(DFN,AUTH) ;call to check if authorization being paid is
"RTN","FBAAUTL3",53,0)
 ;an ID card.  Called during payment process.
"RTN","FBAAUTL3",54,0)
 ;DFN = patients internal entry number
"RTN","FBAAUTL3",55,0)
 ;AUTH= internal entry number of authorization in 161.
"RTN","FBAAUTL3",56,0)
 ;both are required
"RTN","FBAAUTL3",57,0)
 I $S('$G(DFN):1,'$G(AUTH):1,1:0) Q 0
"RTN","FBAAUTL3",58,0)
 Q $S('$D(^FBAAA(+DFN,1,+AUTH,0)):0,$P(^(0),U,13)=3:1,1:0)
"RTN","FBAAV0")
0^3^B76214254^B56393278
"RTN","FBAAV0",1,0)
FBAAV0 ;AISC/GRR - ELECTRONICALLY TRANSMIT FEE DATA ;3/22/2012
"RTN","FBAAV0",2,0)
 ;;3.5;FEE BASIS;**3,4,55,89,98,116,108,132,139,123,158**;JAN 30, 1995;Build 94
"RTN","FBAAV0",3,0)
 ;;Per VA Directive 6402, this routine should not be modified.
"RTN","FBAAV0",4,0)
 ;
"RTN","FBAAV0",5,0)
 ; References to API $$CODEABA^ICDEX supported by ICR #5747
"RTN","FBAAV0",6,0)
 ;
"RTN","FBAAV0",7,0)
 K ^TMP($J,"FBAABATCH"),^TMP($J,"FBVADAT") D DT^DICRW
"RTN","FBAAV0",8,0)
 ;
"RTN","FBAAV0",9,0)
 N FBTRT S FBTRT=0   ; Flag indicating if any transactions are found that need to be transmitted
"RTN","FBAAV0",10,0)
 I $D(^FBAA(161.7,"AC","S")) S FBTRT=1       ; supervisor closed batch
"RTN","FBAAV0",11,0)
 I $D(^FBAA(161.7,"AC","R")) S FBTRT=1       ; reviewed after pricer batch
"RTN","FBAAV0",12,0)
 I $D(^FBAA(161.25,"AE")) S FBTRT=1          ; vendor correction
"RTN","FBAAV0",13,0)
 I +$O(^FBAA(161.26,"AC","P",0)) S FBTRT=1   ; FB patient master record changes
"RTN","FBAAV0",14,0)
 I +$O(^FBAA(161.96,"AS","P",0)) S FBTRT=1   ; ipac vendor agreement MRA changes (FB*3.5*123)
"RTN","FBAAV0",15,0)
 I 'FBTRT W !,*7,"There are no transactions requiring transmission",*7 Q
"RTN","FBAAV0",16,0)
 ;
"RTN","FBAAV0",17,0)
 W !!,"This option will transmit all Batches and MRA's ready to be transmitted",!,"to Austin"
"RTN","FBAAV0",18,0)
RD W !! S DIR(0)="Y",DIR("A")="Are you sure you want to continue",DIR("B")="No" D ^DIR K DIR G END:'Y
"RTN","FBAAV0",19,0)
 L +^FBAA(161.7,"AC"):0 G:'$T LOCK^FBAAUTL1
"RTN","FBAAV0",20,0)
 W !!,"The following Batches will be transmitted: " F FBSTAT="S","R" F J=0:0 S J=$O(^FBAA(161.7,"AC",FBSTAT,J)) Q:J'>0  S FBATCH=$G(^FBAA(161.7,J,0)) D
"RTN","FBAAV0",21,0)
 .Q:'+FBATCH
"RTN","FBAAV0",22,0)
 .I (FBSTAT="S"&($P(FBATCH,U,15)="Y"))!(+$P(FBATCH,U,9)) S ^TMP($J,"FBAABATCH",J)="" W !,+FBATCH
"RTN","FBAAV0",23,0)
RTRAN ;Entry from Re-transmit MRA routine
"RTN","FBAAV0",24,0)
 D ADDRESS^FBAAV01 G END:VATERR K VAT
"RTN","FBAAV0",25,0)
 D WAIT^DICD,STATION^FBAAUTL,HD^FBAAUTL I $D(FB("ERROR")) G END
"RTN","FBAAV0",26,0)
 S TOTSTR=0,$P(PAD," ",200)=" "
"RTN","FBAAV0",27,0)
 D ^FBAAV1:$D(^FBAA(161.25,"AE"))         ; Vendor MRA
"RTN","FBAAV0",28,0)
 D ^FBAAV4:$D(^FBAA(161.26,"AC","P"))     ; Patient MRA
"RTN","FBAAV0",29,0)
 D ^FBAAV8:$D(^FBAA(161.96,"AS","P"))     ; IPAC agreement MRA (FB*3.5*123)
"RTN","FBAAV0",30,0)
 ;
"RTN","FBAAV0",31,0)
 F J=0:0 S J=$O(^TMP($J,"FBAABATCH",J)) Q:J'>0  I $D(^FBAA(161.7,J,0)) S Y(0)=^(0) D SET1,DET:FBAABT="B3",DETP^FBAAV2:FBAABT="B5",DETT^FBAAV3:FBAABT="B2",^FBAAV5:FBAABT="B9"
"RTN","FBAAV0",32,0)
END L -^FBAA(161.7,"AC") D KILL^FBAAV1 Q
"RTN","FBAAV0",33,0)
SET1 ; build the payment batch header string (used by all four formats)
"RTN","FBAAV0",34,0)
 S FBAABN=$P(Y(0),"^",1),FBAABN=$E("0000000",$L(FBAABN)+1,7)_FBAABN  ;FB*3.5*158
"RTN","FBAAV0",35,0)
 S FBAAON=$E($P(Y(0),"^",2),3,6) ;obligation #
"RTN","FBAAV0",36,0)
 S FBAACD=$$AUSDT^FBAAV3(DT)
"RTN","FBAAV0",37,0)
 S FBAACP=$E($P(Y(0),"^",2),1,2) ;obligation #
"RTN","FBAAV0",38,0)
 S FBAABT=$P(Y(0),"^",3) ;Type
"RTN","FBAAV0",39,0)
 S FBAAAP=$$AUSAMT^FBAAV3($P(Y(0),"^",9),11) ;total dollars
"RTN","FBAAV0",40,0)
 S FBSTAT=$P(^FBAA(161.7,J,"ST"),"^") ;status
"RTN","FBAAV0",41,0)
 S FBCHB=$P(Y(0),"^",15) ;contract hospital batch
"RTN","FBAAV0",42,0)
 S FBEXMPT=$P(Y(0),"^",18) ;batch exempt
"RTN","FBAAV0",43,0)
 S X=$$SUB^FBAAUTL5(+$P(Y(0),U,8)_"-"_$P(Y(0),U,2)) ;station # - obligation #
"RTN","FBAAV0",44,0)
 S FBAASN=$$LJ^XLFSTR($S(X]"":X,1:FBAASN),6," ")
"RTN","FBAAV0",45,0)
 I FBSTAT="R"!(FBSTAT="S"&(FBCHB'["Y"))!(FBSTAT="S"&($G(FBEXMPT)="Y")) S FBSTR=FBHD_$S(FBAABT="B2":"BT",1:FBAABT)_FBAACD_FBAASN_FBAABN_" "_FBAAAP_FBAACP_" $"
"RTN","FBAAV0",46,0)
 Q
"RTN","FBAAV0",47,0)
DET ;entry point to process B3 (outpatient/ancillary) batch
"RTN","FBAAV0",48,0)
 ; input (partial list)
"RTN","FBAAV0",49,0)
 ;   J      - Batch IEN in file 161.7
"RTN","FBAAV0",50,0)
 ;   FBAAON - last 4 of obligation number
"RTN","FBAAV0",51,0)
 ;   FBAASN - station number (formatted)
"RTN","FBAAV0",52,0)
 S FBTXT=0
"RTN","FBAAV0",53,0)
 D CKB3V^FBAAV01 I $G(FBERR) K FBERR Q
"RTN","FBAAV0",54,0)
 ; HIPAA 5010 - line items that have 0.00 amount paid are now required to go to Central Fee
"RTN","FBAAV0",55,0)
 F K=0:0 S K=$O(^FBAAC("AC",J,K)) Q:K'>0  F L=0:0 S L=$O(^FBAAC("AC",J,K,L)) Q:L'>0  F M=0:0 S M=$O(^FBAAC("AC",J,K,L,M)) Q:M'>0  F N=0:0 S N=$O(^FBAAC("AC",J,K,L,M,N)) Q:N'>0  S Y(0)=$G(^FBAAC(K,1,L,1,M,1,N,0)) I Y(0)]"" D
"RTN","FBAAV0",56,0)
 .N FBDTSR1,FBPICN
"RTN","FBAAV0",57,0)
 .S FBDTSR1=+$G(^FBAAC(K,1,L,1,M,0))
"RTN","FBAAV0",58,0)
 .S FBPICN=K_U_L_U_M_U_N
"RTN","FBAAV0",59,0)
 .S FBPICN=$$ORGICN^FBAAVR5(162.03,FBPICN)
"RTN","FBAAV0",60,0)
 .S FBY=$G(^FBAAC(K,1,L,1,M,1,N,2))
"RTN","FBAAV0",61,0)
 .S FBY3=$G(^FBAAC(K,1,L,1,M,1,N,3))
"RTN","FBAAV0",62,0)
 .S FBY9=$G(^FBAAC(K,1,L,1,M,1,N,9))
"RTN","FBAAV0",63,0)
 .I 'FBTXT S FBTXT=1 D NEWMSG^FBAAV01,STORE^FBAAV01,UPD
"RTN","FBAAV0",64,0)
 .D GOT
"RTN","FBAAV0",65,0)
 ;
"RTN","FBAAV0",66,0)
 D:FBTXT XMIT^FBAAV01
"RTN","FBAAV0",67,0)
 Q
"RTN","FBAAV0",68,0)
 ;
"RTN","FBAAV0",69,0)
GOT ; process a B3 line item
"RTN","FBAAV0",70,0)
 ;
"RTN","FBAAV0",71,0)
 N DFN,FBADJ,FBADJA1,FBADJA2,FBADJR1,FBADJR2,FBADMIT,FBAUTHF,FBIENS
"RTN","FBAAV0",72,0)
 N FBMOD1,FBMOD2,FBMOD3,FBMOD4,FBPNAMX,FBUNITS,FBX,FBNPI
"RTN","FBAAV0",73,0)
 N FBCSID,FBEDIF,FBCNTRN,FBFPPSID,FBCRARC,FBPYMTH,FBAUTHNUM
"RTN","FBAAV0",74,0)
 N FBIA,FBDODINV,FBAMTC,FBLNITM
"RTN","FBAAV0",75,0)
 ;
"RTN","FBAAV0",76,0)
 S FBIENS=N_","_M_","_L_","_K_","
"RTN","FBAAV0",77,0)
 ;
"RTN","FBAAV0",78,0)
 S FBLNITM=+$P(FBY3,U,2),FBLNITM=$$RJ^XLFSTR(FBLNITM,3,0) ;FPPS LINE ITEM
"RTN","FBAAV0",79,0)
 ;
"RTN","FBAAV0",80,0)
 S FBEDIF=$S($P($G(^FBAAC(K,1,L,1,M,1,N,3)),"^")]"":"Y",1:" ") ;EDI flag
"RTN","FBAAV0",81,0)
 ; get CPT modifiers
"RTN","FBAAV0",82,0)
 D
"RTN","FBAAV0",83,0)
 . N FBMODA,FBMODL
"RTN","FBAAV0",84,0)
 . D MODDATA^FBAAUTL4(K,L,M,N)
"RTN","FBAAV0",85,0)
 . S FBMODL=$$MODL^FBAAUTL4("FBMODA","E")
"RTN","FBAAV0",86,0)
 . S FBMOD1=$$RJ^XLFSTR($P(FBMODL,",",1),5," ")
"RTN","FBAAV0",87,0)
 . S FBMOD2=$$RJ^XLFSTR($P(FBMODL,",",2),5," ")
"RTN","FBAAV0",88,0)
 . S FBMOD3=$$RJ^XLFSTR($P(FBMODL,",",3),5," ")
"RTN","FBAAV0",89,0)
 . S FBMOD4=$$RJ^XLFSTR($P(FBMODL,",",4),5," ")
"RTN","FBAAV0",90,0)
 ;
"RTN","FBAAV0",91,0)
 S FBPAYT=$P(Y(0),"^",20),FBPAYT=$S(FBPAYT]"":FBPAYT,1:"V") ;PAYMENT TYPE
"RTN","FBAAV0",92,0)
 ;
"RTN","FBAAV0",93,0)
 S FBVID=$P($G(^FBAAV(L,0)),U,2) ;VENDOR ID
"RTN","FBAAV0",94,0)
 S FBVID=FBVID_$E(PAD,$L(FBVID)+1,11)
"RTN","FBAAV0",95,0)
 ;
"RTN","FBAAV0",96,0)
 ; FB*3.5*123 - get IPAC variables
"RTN","FBAAV0",97,0)
 S FBIA=+$P(FBY3,U,6)                                            ; IPAC agreement ptr
"RTN","FBAAV0",98,0)
 S FBIA=$S(FBIA:$P($G(^FBAA(161.95,FBIA,0)),U,1),1:"")           ; IPAC external agreement id# or ""
"RTN","FBAAV0",99,0)
 S FBIA=$$LJ^XLFSTR(FBIA,"10T")                                  ; format to 10 characters
"RTN","FBAAV0",100,0)
 S FBDODINV=$P(FBY3,U,7),FBDODINV=$$LJ^XLFSTR(FBDODINV,"22T")    ; DoD invoice# formatted to 22 characters
"RTN","FBAAV0",101,0)
 ;
"RTN","FBAAV0",102,0)
 S:FBPAYT="R" FBVID=$E(PAD,1,11)
"RTN","FBAAV0",103,0)
 S FBNPI=$$EN^FBNPILK(L)  ;SET THE NPI TO BE PASSED TO FBAAV01,FBAAV2,FBAAV5
"RTN","FBAAV0",104,0)
 ;
"RTN","FBAAV0",105,0)
 D POV^FBAAUTL2
"RTN","FBAAV0",106,0)
 S POV=$S(POV']"":"",POV="A":6,POV="B":7,POV="C":8,POV="D":9,POV="E":10,1:POV)
"RTN","FBAAV0",107,0)
 S POV=$S(POV']"":99,$D(^FBAA(161.82,POV,0)):$P(^(0),"^",3),1:99)
"RTN","FBAAV0",108,0)
 S FBPOV=POV
"RTN","FBAAV0",109,0)
 S FBTT=$S(FBTT]"":FBTT,1:1)
"RTN","FBAAV0",110,0)
 S FBCPT=$$CPT^FBAAUTL4($P(Y(0),"^")),FBCPT=$S($L(FBCPT)=5:FBCPT,1:"     ")  ;SERVICE PROVIDED
"RTN","FBAAV0",111,0)
 S FBPSA=$$PSA^FBAAV5(+$P(Y(0),U,12),+FBAASN) I $L(+FBPSA)'=3 S FBPSA=999
"RTN","FBAAV0",112,0)
 S FBPATT=$P(Y(0),"^",17),FBPATT=$S(FBPATT]"":FBPATT,1:10)
"RTN","FBAAV0",113,0)
 S FBTD=$$AUSDT^FBAAV3(FBDTSR1) ; formatted treatment date
"RTN","FBAAV0",114,0)
 S FBSUSP=$P(Y(0),"^",5),FBSUSP=$S(FBSUSP]"":FBSUSP,1:" ")
"RTN","FBAAV0",115,0)
 S FBSUSP=$S(FBSUSP=" ":" ",$D(^FBAA(161.27,+FBSUSP,0)):$P(^(0),"^"),1:" ")
"RTN","FBAAV0",116,0)
 S FBAP=$$AUSAMT^FBAAV3($P(Y(0),"^",3),8) ; amount paid
"RTN","FBAAV0",117,0)
 S FBAMTC=$$AUSAMT^FBAAV3($P(Y(0),U,2),12) ;amount claimed FB*3.5*158 - service line billed amount
"RTN","FBAAV0",118,0)
 S FBPOS=+$P(Y(0),"^",25),FBPOS=$S(FBPOS:$P(^IBE(353.1,FBPOS,0),"^"),1:"  ")
"RTN","FBAAV0",119,0)
 S FBHCFA=+$P(Y(0),"^",26),FBHCFA=$S(FBHCFA:$P(^IBE(353.2,FBHCFA,0),"^"),1:""),FBHCFA=$E(PAD,$L(FBHCFA)+1,2)_FBHCFA
"RTN","FBAAV0",120,0)
 S FBVTOS=+$P(Y(0),"^",24),FBVTOS=$S(FBVTOS:$P(^FBAA(163.85,FBVTOS,0),"^",2),1:"  ")
"RTN","FBAAV0",121,0)
 ; FB*3.5*139-DEM-Modifications for ICD-10 remediation
"RTN","FBAAV0",122,0)
 S FBPD=+$P(Y(0),"^",23)
"RTN","FBAAV0",123,0)
 S FBPD=$S(FBPD:$$ICD9^FBCSV1(FBPD,$G(FBDTSR1)),1:"")
"RTN","FBAAV0",124,0)
 ; decimal is stripped only from ICD-10 diagnosis codes.
"RTN","FBAAV0",125,0)
 I FBPD'="",$$CODEABA^ICDEX(FBPD,80,30)>0 S:FBPD["." FBPD=$P(FBPD,".",1)_$P(FBPD,".",2)
"RTN","FBAAV0",126,0)
 S FBPD=$E(PAD,$L(FBPD)+1,7)_FBPD
"RTN","FBAAV0",127,0)
 ; End 139
"RTN","FBAAV0",128,0)
 S FBINVN=$P(Y(0),"^",16)
"RTN","FBAAV0",129,0)
 S FBINVN=$E("000000000",$L(FBINVN)+1,9)_FBINVN
"RTN","FBAAV0",130,0)
 S FBAUTHF=$S($P(Y(0),U,13)["FB583":"U",1:"A") ; auth/unauth flag
"RTN","FBAAV0",131,0)
 S FBDIN=$$AUSDT^FBAAV3($P(Y(0),"^",15)) ; invoice date rec'd
"RTN","FBAAV0",132,0)
 S FBADMIT=$$AUSDT^FBAAV3($$B3ADMIT(FBIENS)) ; formatted admission date
"RTN","FBAAV0",133,0)
 ;
"RTN","FBAAV0",134,0)
 S VAPA("P")=""
"RTN","FBAAV0",135,0)
 S DFN=K
"RTN","FBAAV0",136,0)
 ; Note - before this point Y(0) was the 0 node of subfile #162.03
"RTN","FBAAV0",137,0)
 ;      - after this point Y(0) will be the 0 node of file #2
"RTN","FBAAV0",138,0)
 S Y(0)=$G(^DPT(+K,0)) Q:Y(0)']""
"RTN","FBAAV0",139,0)
 D PAT^FBAAUTL2
"RTN","FBAAV0",140,0)
 ; obtain date of birth, must follow call to PAT^FBAAUTL2 to overwrite 
"RTN","FBAAV0",141,0)
 ; the value returned from it
"RTN","FBAAV0",142,0)
 S FBDOB=$$AUSDT^FBAAV3($P(Y(0),"^",3)) ; date of birth
"RTN","FBAAV0",143,0)
 D ADD^VADPT
"RTN","FBAAV0",144,0)
 S FBPNAMX=$$HL7NAME^FBAAV2(DFN) ; patient name
"RTN","FBAAV0",145,0)
 S FBUNITS=$P(FBY,U,14)
"RTN","FBAAV0",146,0)
 S:FBUNITS<1 FBUNITS=1
"RTN","FBAAV0",147,0)
 S FBUNITS=$$RJ^XLFSTR(FBUNITS,5,0) ; volume indicator (units paid)
"RTN","FBAAV0",148,0)
 S FBCSID=$$LJ^XLFSTR($P(FBY,"^",16),20," ") ; patient acct #
"RTN","FBAAV0",149,0)
 D
"RTN","FBAAV0",150,0)
 . N FBCNTRP
"RTN","FBAAV0",151,0)
 . S FBCNTRP=$P(FBY3,"^",8)
"RTN","FBAAV0",152,0)
 . S FBCNTRN=$S(FBCNTRP:$P($G(^FBAA(161.43,FBCNTRP,0)),"^"),1:"")
"RTN","FBAAV0",153,0)
 . S FBCNTRN=$$LJ^XLFSTR(FBCNTRN,20," ") ; contract number
"RTN","FBAAV0",154,0)
 ;
"RTN","FBAAV0",155,0)
 S FBFPPSID=$E($P(FBY3,U),1,12),FBFPPSID=$$RJ^XLFSTR(FBFPPSID,12,0) ;FPPS Claim Number
"RTN","FBAAV0",156,0)
 ; Authorization Number
"RTN","FBAAV0",157,0)
 S FBAUTHNUM=$P(FBY9,U)
"RTN","FBAAV0",158,0)
 I FBAUTHNUM']"" D
"RTN","FBAAV0",159,0)
 . S FBAUTHNUM=$$AUTHOP1(FBIENS) ;inpatient authorization used for outpatient service
"RTN","FBAAV0",160,0)
 . S:FBAUTHNUM']"" FBAUTHNUM=$$AUTHOP2(DFN,FBDTSR1) ;out for out
"RTN","FBAAV0",161,0)
 ;
"RTN","FBAAV0",162,0)
 S FBAUTHNUM=$$LJ^XLFSTR(FBAUTHNUM,"29T"," ")  ;AUTHORIZATION NUMBER
"RTN","FBAAV0",163,0)
 ; get and format adjustment reason codes and amounts (if any)
"RTN","FBAAV0",164,0)
 D CRARC(FBIENS,.FBCRARC) ; FB*3.5*158
"RTN","FBAAV0",165,0)
 S FBPYMTH=$$PYMTH($P(FBY,U,7))
"RTN","FBAAV0",166,0)
 S FBST=$S($P(VAPA(5),"^")="":"  ",$D(^DIC(5,$P(VAPA(5),"^"),0)):$P(^(0),"^",2),1:"  ")
"RTN","FBAAV0",167,0)
 I $L(FBST)>2 S FBST="**"
"RTN","FBAAV0",168,0)
 S:$L(FBST)'=2 FBST=$E(PAD,$L(FBST)+1,2)_FBST
"RTN","FBAAV0",169,0)
 S FBCTY=$S($P(VAPA(7),"^",1)="":"   ",FBST="  ":"   ",$D(^DIC(5,$P(VAPA(5),"^"),1,$P(VAPA(7),"^"),0)):$P(^(0),"^",3),1:"   ")
"RTN","FBAAV0",170,0)
 I $L(FBCTY)'=3 S FBCTY=$E("000",$L(FBCTY)+1,3)_FBCTY
"RTN","FBAAV0",171,0)
 S FBZIP=$S('+$G(VAPA(11)):VAPA(6),+VAPA(11):$P(VAPA(11),U),1:VAPA(6)),FBZIP=$TR(FBZIP,"-","")_$E("000000000",$L(FBZIP)+1,9)
"RTN","FBAAV0",172,0)
 D STRING^FBAAV01
"RTN","FBAAV0",173,0)
 Q
"RTN","FBAAV0",174,0)
 ;
"RTN","FBAAV0",175,0)
AUTHOP2(DFN,FBSDT) ; get the outpatient authorization number
"RTN","FBAAV0",176,0)
 ; input:
"RTN","FBAAV0",177,0)
 ;  DFN   -> patient IEN
"RTN","FBAAV0",178,0)
 ;  FBSDT -> date of service
"RTN","FBAAV0",179,0)
 ; output:
"RTN","FBAAV0",180,0)
 ;  authorization #, format: patient IEN-authorization IEN
"RTN","FBAAV0",181,0)
 ;
"RTN","FBAAV0",182,0)
 N ANUM,FBFDT,I,FB2DT
"RTN","FBAAV0",183,0)
 S ANUM=""
"RTN","FBAAV0",184,0)
 Q:'$D(^FBAAA(DFN,1)) ANUM
"RTN","FBAAV0",185,0)
 S FBFDT=9999999
"RTN","FBAAV0",186,0)
 F  S FBFDT=$O(^FBAAA(DFN,1,"B",FBFDT),-1) Q:'FBFDT  D  Q:+ANUM
"RTN","FBAAV0",187,0)
 . S I=0
"RTN","FBAAV0",188,0)
 . F  S I=$O(^FBAAA(DFN,1,"B",FBFDT,I)) Q:'I  I $D(^FBAAA(DFN,1,I,0)) D  Q:+ANUM
"RTN","FBAAV0",189,0)
 . . S FB2DT=$P(^FBAAA(DFN,1,I,0),U,2)
"RTN","FBAAV0",190,0)
 . . I FBFDT<=FBSDT,FBSDT<=FB2DT D
"RTN","FBAAV0",191,0)
 . . . S ANUM=DFN_"-"_I
"RTN","FBAAV0",192,0)
 Q ANUM
"RTN","FBAAV0",193,0)
 ;
"RTN","FBAAV0",194,0)
AUTHOP1(IENS) ;get the authorization number from ^FB7078
"RTN","FBAAV0",195,0)
 ;
"RTN","FBAAV0",196,0)
 N REFNUM
"RTN","FBAAV0",197,0)
 S REFNUM=""
"RTN","FBAAV0",198,0)
 D GETS^DIQ(162.03,IENS,"27","I","FB")
"RTN","FBAAV0",199,0)
 I $D(FB),FB(162.03,IENS,27,"I")["FB7078" D
"RTN","FBAAV0",200,0)
 . S FB7078=$P(FB(162.03,IENS,27,"I"),";")
"RTN","FBAAV0",201,0)
 . S:$D(^FB7078(FB7078,0)) REFNUM=$P(^FB7078(FB7078,0),U)
"RTN","FBAAV0",202,0)
 Q REFNUM
"RTN","FBAAV0",203,0)
 ;
"RTN","FBAAV0",204,0)
CRARC(FBIENS,FBCRARC) ; load CARCs and RARCs
"RTN","FBAAV0",205,0)
 ;
"RTN","FBAAV0",206,0)
 N FBADJ,FBRRMK
"RTN","FBAAV0",207,0)
 D LOADADJ^FBAAFA(FBIENS,.FBADJ)
"RTN","FBAAV0",208,0)
 D LOADRR^FBAAFR(FBIENS,.FBRRMK)
"RTN","FBAAV0",209,0)
 D CRARC^FBAAUTL(.FBADJ,.FBRRMK,.FBCRARC)
"RTN","FBAAV0",210,0)
 Q
"RTN","FBAAV0",211,0)
 ;
"RTN","FBAAV0",212,0)
PYMTH(IEN) ; get Payment Methodology code - FB*3.5*158
"RTN","FBAAV0",213,0)
 ;
"RTN","FBAAV0",214,0)
 ;input  --> IEN: ien of entry in FEE BASIS PAYMENT METHODOLOGY file (#163.98)
"RTN","FBAAV0",215,0)
 ;output --> CODE (163.98,1) or null
"RTN","FBAAV0",216,0)
 ;
"RTN","FBAAV0",217,0)
 N FBC
"RTN","FBAAV0",218,0)
 S FBC=" "
"RTN","FBAAV0",219,0)
 I IEN,$D(^FBAA(163.98,IEN)) S FBC=$P(^(IEN,0),U,2)
"RTN","FBAAV0",220,0)
 Q FBC
"RTN","FBAAV0",221,0)
 ;
"RTN","FBAAV0",222,0)
UPD ; update the batch file
"RTN","FBAAV0",223,0)
 N Y
"RTN","FBAAV0",224,0)
 S DA=J,(DIC,DIE)="^FBAA(161.7,"
"RTN","FBAAV0",225,0)
 S DR="11////^S X=""T"";12////^S X=DT"
"RTN","FBAAV0",226,0)
 D ^DIE
"RTN","FBAAV0",227,0)
 Q
"RTN","FBAAV0",228,0)
 ;
"RTN","FBAAV0",229,0)
STORE D STORE^FBAAV01 Q
"RTN","FBAAV0",230,0)
 ;
"RTN","FBAAV0",231,0)
B3ADMIT(FBIENS) ; Determine Admission Date for a B3 payment line item
"RTN","FBAAV0",232,0)
 ; input
"RTN","FBAAV0",233,0)
 ;   FBIENS - IENS (FileMan format) for subfile 162.03 entry
"RTN","FBAAV0",234,0)
 ; returns admission date in internal FileMan format or null value
"RTN","FBAAV0",235,0)
 ;
"RTN","FBAAV0",236,0)
 N FB7078,FBRET
"RTN","FBAAV0",237,0)
 S FBRET=""
"RTN","FBAAV0",238,0)
 S FB7078=$$GET1^DIQ(162.03,FBIENS,27,"I") ; associated 7078/583
"RTN","FBAAV0",239,0)
 ; (the unauthorized ancillary claims will have the treatment date
"RTN","FBAAV0",240,0)
 ;  instead of the inpatient admission date so nothing is sent to
"RTN","FBAAV0",241,0)
 ;  Austin for them)
"RTN","FBAAV0",242,0)
 ;
"RTN","FBAAV0",243,0)
 ; if line items points to a 7078 authorization then return a date
"RTN","FBAAV0",244,0)
 I $P(FB7078,";",2)="FB7078(" D
"RTN","FBAAV0",245,0)
 . N FBY
"RTN","FBAAV0",246,0)
 . S FBY=$G(^FB7078(+FB7078,0))
"RTN","FBAAV0",247,0)
 . ; if fee program is civil hospital then return 7078 date of admission
"RTN","FBAAV0",248,0)
 . I $P(FBY,U,11)=6 S FBRET=$P(FBY,U,15)
"RTN","FBAAV0",249,0)
 . ; if fee program is CNH then return 7078 authorized from date
"RTN","FBAAV0",250,0)
 . I $P(FBY,U,11)=7 S FBRET=$P(FBY,U,4)
"RTN","FBAAV0",251,0)
 ;
"RTN","FBAAV0",252,0)
 Q FBRET
"RTN","FBAAV01")
0^27^B48459341^B27989531
"RTN","FBAAV01",1,0)
FBAAV01 ;AISC/GRR - ELECTRONICALLY TRANSMIT FEE DATA CONTINUED ;6/15/2009
"RTN","FBAAV01",2,0)
 ;;3.5;FEE BASIS;**89,98,108,123,158**;JAN 30, 1995;Build 94
"RTN","FBAAV01",3,0)
 ;;Per VA Directive 6402, this routine should not be modified.
"RTN","FBAAV01",4,0)
NEWMSG ;get new message number, reset line counter
"RTN","FBAAV01",5,0)
 ;FBLN=line counter, FBFEE=FEE message counter, FBNVP=NVP message counter
"RTN","FBAAV01",6,0)
 ;FBOKTX=1 if message pending, 0 otherwise
"RTN","FBAAV01",7,0)
 S FBXMZ=0,FBJ=$G(J),FBK=$G(K) S:'$D(FBFEE) FBFEE=1 S:'$D(FBNVP) FBNVP=1
"RTN","FBAAV01",8,0)
 S XMSUB=$S('$D(FBFLAG):"FEE BASIS MESSAGE # "_FBFEE,1:"FEE NON-VA HOSP TO PRICER MESSAGE # "_FBNVP),XMDUZ=DUZ
"RTN","FBAAV01",9,0)
 S FBOKTX=0
"RTN","FBAAV01",10,0)
 D XMZ^XMA2
"RTN","FBAAV01",11,0)
 I '$D(XMZ)!(XMZ'>0) G NEWMSG
"RTN","FBAAV01",12,0)
 S FBXMZ=XMZ,FBLN=0,FBOKTX=1,J=FBJ,K=FBK K XMZ
"RTN","FBAAV01",13,0)
 Q
"RTN","FBAAV01",14,0)
 ;
"RTN","FBAAV01",15,0)
XMIT ;send message, increment message counter
"RTN","FBAAV01",16,0)
 ;FBLN=line counter, FBFEE=FEE message counter, FBNVP=NVP message counter
"RTN","FBAAV01",17,0)
 ;FBXMFEE(=FEE recipient array, FBXMNVP(=NVP recipient array
"RTN","FBAAV01",18,0)
 S FBJ=J,FBK=K K XMY D ROUT
"RTN","FBAAV01",19,0)
 S XMZ=FBXMZ,^XMB(3.9,XMZ,2,0)="^3.92A^"_FBLN_"^"_FBLN_"^"_DT
"RTN","FBAAV01",20,0)
 S XMDUN=$P(^VA(200,DUZ,0),U) D ENT1^XMD
"RTN","FBAAV01",21,0)
 S FBLN=0,FBOKTX=0
"RTN","FBAAV01",22,0)
 D INCRM ;increment message counter
"RTN","FBAAV01",23,0)
 S J=FBJ,K=FBK
"RTN","FBAAV01",24,0)
 Q
"RTN","FBAAV01",25,0)
 ;
"RTN","FBAAV01",26,0)
ROUT ;set up recipients for message
"RTN","FBAAV01",27,0)
 I $D(FBFLAG) S FBI=0 F  S FBI=$O(FBXMNVP(FBI)) Q:'FBI  S X=FBXMNVP(FBI),XMN=0,XMDF="" D INST^XMA21 K XMN,XMDF
"RTN","FBAAV01",28,0)
 I '$D(FBFLAG) S FBI=0 F  S FBI=$O(FBXMFEE(FBI)) Q:'FBI  S X=FBXMFEE(FBI),XMN=0,XMDF="" D INST^XMA21 K XMN,XMDF
"RTN","FBAAV01",29,0)
 S XMY(DUZ)="",XMDUZ=DUZ Q
"RTN","FBAAV01",30,0)
 ;
"RTN","FBAAV01",31,0)
INCRM ;increment message counter
"RTN","FBAAV01",32,0)
 I $D(FBFLAG) S FBNVP=FBNVP+1
"RTN","FBAAV01",33,0)
 E  S FBFEE=FBFEE+1
"RTN","FBAAV01",34,0)
 Q
"RTN","FBAAV01",35,0)
 ;
"RTN","FBAAV01",36,0)
INCRL ;increment line counter
"RTN","FBAAV01",37,0)
 S FBLN=FBLN+1 Q
"RTN","FBAAV01",38,0)
 ;
"RTN","FBAAV01",39,0)
STORE ;set message string
"RTN","FBAAV01",40,0)
 D INCRL S ^XMB(3.9,FBXMZ,2,FBLN,0)=FBSTR
"RTN","FBAAV01",41,0)
 Q
"RTN","FBAAV01",42,0)
 ;
"RTN","FBAAV01",43,0)
ADDRESS ;set up recipient array, FBXMFEE( for FEE router, FBXMNVP( for NVP router
"RTN","FBAAV01",44,0)
 F VATNAME="FEE","NVP" D ^VATRAN G:VATERR ADDQ S FBI=0 F  S FBI=$O(VAT(FBI)) Q:'FBI  S FBVAR="FBXM"_VATNAME_"("_FBI_")" S @FBVAR=VAT(FBI)
"RTN","FBAAV01",45,0)
ADDQ Q
"RTN","FBAAV01",46,0)
 ;Following checks for Austin Name Field in Vendor file in order to continue transmitting that batch.
"RTN","FBAAV01",47,0)
CKB3V F FB1=0:0 S FB1=$O(^FBAAC("AC",J,FB1)) Q:'FB1!($G(FBERR))  F FB2=0:0 S FB2=$O(^FBAAC("AC",J,FB1,FB2)) Q:FB2'>0!($G(FBERR))  D CHKV
"RTN","FBAAV01",48,0)
 Q
"RTN","FBAAV01",49,0)
CKB5V F FB1=0:0 S FB1=$O(^FBAA(162.1,"AE",J,FB1)) Q:'FB1!($G(FBERR))  I $G(^FBAA(162.1,FB1,0)) S FB2=+$P(^(0),"^",4) D CHKV
"RTN","FBAAV01",50,0)
 Q
"RTN","FBAAV01",51,0)
CKB9V F FB1=0:0 S FB1=$O(^FBAAI("AC",J,FB1)) Q:'FB1!($G(FBERR))  I $G(^FBAAI(FB1,0)) S FB2=+$P(^(0),"^",3) D CHKV
"RTN","FBAAV01",52,0)
 Q
"RTN","FBAAV01",53,0)
CHKV I $$CKVEN^FBAADV(FB2) W !!,*7,"VENDOR: ",$$VNAME^FBNHEXP(FB2)," Not approved in Austin yet.",!,"Batch # ",FBAABN," CANNOT BE TRANSMITTED!!!" S FBERR=1
"RTN","FBAAV01",54,0)
 Q
"RTN","FBAAV01",55,0)
 ;
"RTN","FBAAV01",56,0)
STRING ; called from FBAAV0 to build 'B3' payment record; also called by DSIFPAY5 (FBCS) with DBIA# 5093
"RTN","FBAAV01",57,0)
 ;
"RTN","FBAAV01",58,0)
 S FBPICN=$$PADZ(FBPICN,30)
"RTN","FBAAV01",59,0)
 ;
"RTN","FBAAV01",60,0)
 ; build 1st line
"RTN","FBAAV01",61,0)
 S FBSTR=3_FBAASN_FBSSN_FBPAYT_FBPNAMX_FBVID_"  "_FBAP_FBAAON_FBSUSP
"RTN","FBAAV01",62,0)
 S FBSTR=FBSTR_FBPOV_FBPATT_FBTD_FBTT_FBDIN_FBINVN
"RTN","FBAAV01",63,0)
 S FBSTR=FBSTR_$E(PAD,1,33)_FBST_FBCTY_FBZIP ; reserved for foreign addr
"RTN","FBAAV01",64,0)
 S FBSTR=FBSTR_$E(FBPSA,1,3)_FBCPT_FBPOS_FBHCFA_FBVTOS_FBPD
"RTN","FBAAV01",65,0)
 S FBSTR=FBSTR_+$P($G(FBY),U,2)_$E(PAD,1,8)_FBPICN ;Internal Control Number
"RTN","FBAAV01",66,0)
 S FBSTR=FBSTR_$S(+FBY:$$AUSDT^FBAAV3(+FBY),1:FBDIN)_FBADMIT_FBDOB_"~"
"RTN","FBAAV01",67,0)
 D STORE
"RTN","FBAAV01",68,0)
 ;
"RTN","FBAAV01",69,0)
 ; build 2nd line
"RTN","FBAAV01",70,0)
 S FBSTR=FBUNITS_FBAUTHF_FBMOD1_FBMOD2_FBMOD3_FBMOD4
"RTN","FBAAV01",71,0)
 S FBADJR1=$S($D(FBCRARC(1)):$P(FBCRARC(1),U,2),1:""),FBADJR1=$$RJ^XLFSTR(FBADJR1,5," ")
"RTN","FBAAV01",72,0)
 S FBADJR2=$S($D(FBCRARC(2)):$P(FBCRARC(2),U,2),1:""),FBADJR2=$$RJ^XLFSTR(FBADJR2,5," ")
"RTN","FBAAV01",73,0)
 S FBSTR=FBSTR_FBADJR1_FBADJR2
"RTN","FBAAV01",74,0)
 S FBADJA1=$S($D(FBCRARC(1)):$P(FBCRARC(1),U,3),1:0),FBADJA1=$$AUSAMT^FBAAV3(FBADJA1,9,1)
"RTN","FBAAV01",75,0)
 S FBADJA2=$S($D(FBCRARC(2)):$P(FBCRARC(2),U,3),1:0),FBADJA2=$$AUSAMT^FBAAV3(FBADJA2,9,1)
"RTN","FBAAV01",76,0)
 S FBSTR=FBSTR_FBADJA1_FBADJA2
"RTN","FBAAV01",77,0)
 S FBSTR=FBSTR_FBNPI_FBCSID_FBEDIF_FBCNTRN
"RTN","FBAAV01",78,0)
 ;
"RTN","FBAAV01",79,0)
 ; FB*3.5*123 - esg - Check to make sure IPAC variables are defined
"RTN","FBAAV01",80,0)
 I '$D(FBIA)!'$D(FBDODINV) D IPAC(K,L,M,N,.FBIA,.FBDODINV)    ; set and format the IPAC variables if coming from FBCS
"RTN","FBAAV01",81,0)
 ;
"RTN","FBAAV01",82,0)
 S FBSTR=FBSTR_FBIA_FBDODINV_"~"          ; FB*3.5*123 - IPAC data formatted in FBAAV0 or below in IPAC
"RTN","FBAAV01",83,0)
 D STORE
"RTN","FBAAV01",84,0)
 ;
"RTN","FBAAV01",85,0)
 ; 3rd line
"RTN","FBAAV01",86,0)
 S FBSTR=FBFPPSID ; FPPS Claim Number
"RTN","FBAAV01",87,0)
 S FBSTR=FBSTR_FBAUTHNUM ;AUTHORIZATION NUMBER
"RTN","FBAAV01",88,0)
 S FBLNITM=$$RJ^XLFSTR(FBLNITM,3,0) ;fpps line item
"RTN","FBAAV01",89,0)
 S FBSTR=FBSTR_FBLNITM
"RTN","FBAAV01",90,0)
 S FBSTR=FBSTR_FBAMTC ;Service Line Billed Amount = Claimed Amount
"RTN","FBAAV01",91,0)
 ;
"RTN","FBAAV01",92,0)
 S FBADJG=$S($D(FBCRARC(1)):$P(FBCRARC(1),U),1:""),FBADJG=$$RJ^XLFSTR(FBADJG,2," ")
"RTN","FBAAV01",93,0)
 S FBRRC1=$S($D(FBCRARC(1)):$P(FBCRARC(1),U,4),1:""),FBRRC1=$$RJ^XLFSTR(FBRRC1,6," ")
"RTN","FBAAV01",94,0)
 S FBRRC2=$S($D(FBCRARC(1)):$P(FBCRARC(1),U,5),1:""),FBRRC2=$$RJ^XLFSTR(FBRRC2,6," ")
"RTN","FBAAV01",95,0)
 S FBSTR=FBSTR_FBADJG_FBRRC1_FBRRC2
"RTN","FBAAV01",96,0)
 ;
"RTN","FBAAV01",97,0)
 S FBADJG=$S($D(FBCRARC(2)):$P(FBCRARC(2),U),1:""),FBADJG=$$RJ^XLFSTR(FBADJG,2," ")
"RTN","FBAAV01",98,0)
 S FBRRC1=$S($D(FBCRARC(2)):$P(FBCRARC(2),U,4),1:""),FBRRC1=$$RJ^XLFSTR(FBRRC1,6," ")
"RTN","FBAAV01",99,0)
 S FBRRC2=$S($D(FBCRARC(2)):$P(FBCRARC(2),U,5),1:""),FBRRC2=$$RJ^XLFSTR(FBRRC2,6," ")
"RTN","FBAAV01",100,0)
 S FBSTR=FBSTR_FBADJG_FBRRC1_FBRRC2
"RTN","FBAAV01",101,0)
 ; 
"RTN","FBAAV01",102,0)
 F FBI=3:1:5 D
"RTN","FBAAV01",103,0)
 . S FBADJG=$S($D(FBCRARC(FBI)):$P(FBCRARC(FBI),U),1:""),FBADJG=$$RJ^XLFSTR(FBADJG,2," ")
"RTN","FBAAV01",104,0)
 . S FBADJR=$S($D(FBCRARC(FBI)):$P(FBCRARC(FBI),U,2),1:""),FBADJR=$$RJ^XLFSTR(FBADJR,5," ")
"RTN","FBAAV01",105,0)
 . S FBRRC1=$S($D(FBCRARC(FBI)):$P(FBCRARC(FBI),U,4),1:""),FBRRC1=$$RJ^XLFSTR(FBRRC1,6," ")
"RTN","FBAAV01",106,0)
 . S FBRRC2=$S($D(FBCRARC(FBI)):$P(FBCRARC(FBI),U,5),1:""),FBRRC2=$$RJ^XLFSTR(FBRRC2,6," ")
"RTN","FBAAV01",107,0)
 . S FBADJA=$S($D(FBCRARC(FBI)):$P(FBCRARC(FBI),U,3),1:0),FBADJA=$$AUSAMT^FBAAV3(FBADJA,9,1)
"RTN","FBAAV01",108,0)
 . S FBSTR=FBSTR_FBADJG_FBADJR_FBRRC1_FBRRC2_FBADJA
"RTN","FBAAV01",109,0)
 ;
"RTN","FBAAV01",110,0)
 S FBSTR=FBSTR_$$RJ^XLFSTR(FBPYMTH,1," ")
"RTN","FBAAV01",111,0)
 S FBSTR=FBSTR_" "  ;Additional Payment Indicator
"RTN","FBAAV01",112,0)
 S FBSTR=FBSTR_" "  ;Additional Payment Type
"RTN","FBAAV01",113,0)
 S FBSTR=FBSTR_$$PADZ(0,30)  ;Parent Internal Control Number
"RTN","FBAAV01",114,0)
 ;
"RTN","FBAAV01",115,0)
 S FBSTR=FBSTR_"~$"
"RTN","FBAAV01",116,0)
 D STORE
"RTN","FBAAV01",117,0)
 ;
"RTN","FBAAV01",118,0)
 K FBPICN,FBY
"RTN","FBAAV01",119,0)
 K FBIA,FBDODINV      ; FB*3.5*123 kill IPAC variables after using them. They will get rebuilt by the next claim.
"RTN","FBAAV01",120,0)
 Q
"RTN","FBAAV01",121,0)
 ;
"RTN","FBAAV01",122,0)
PADZ(X,Y) ;call to pad 'X' with leading zeros' to a field length of 'Y'
"RTN","FBAAV01",123,0)
 ;
"RTN","FBAAV01",124,0)
 I $S('$L(X):1,'Y:1,Y<$L(X):1,1:0) Q ""
"RTN","FBAAV01",125,0)
 N Z S Z=0,$P(Z,0,Y)=0
"RTN","FBAAV01",126,0)
 Q $E(Z,$L(X)+1,Y)_X
"RTN","FBAAV01",127,0)
 ;
"RTN","FBAAV01",128,0)
IPAC(K,L,M,N,FBIA,FBDODINV) ; set IPAC variables if being called from FBCS
"RTN","FBAAV01",129,0)
 ;        K - 162.03 subscript#1 - DFN
"RTN","FBAAV01",130,0)
 ;        L - 162.03 subscript#2 - vendor ien
"RTN","FBAAV01",131,0)
 ;        M - 162.03 subscript#3 - treatment date subfile ien
"RTN","FBAAV01",132,0)
 ;        N - 162.03 subscript#4 - service provided subfile ien
"RTN","FBAAV01",133,0)
 ; Output:
"RTN","FBAAV01",134,0)
 ;     FBIA - formatted IPAC agreement ID# (pass by reference) - will be 10 characters in length
"RTN","FBAAV01",135,0)
 ; FBDODINV - formatted DoD invoice# (pass by reference) - will be 22 characters in length
"RTN","FBAAV01",136,0)
 ;
"RTN","FBAAV01",137,0)
 N FBY2,FBY3,FBIPIEN
"RTN","FBAAV01",138,0)
 S (FBIA,FBDODINV)=""
"RTN","FBAAV01",139,0)
 I '$$IPACREQD^FBAAMP(L) G IPACX    ; IPAC data is not required so get out
"RTN","FBAAV01",140,0)
 ;
"RTN","FBAAV01",141,0)
 S FBY2=$G(^FBAAC(K,1,L,1,M,1,N,2))   ; 2 node of file 162.03
"RTN","FBAAV01",142,0)
 S FBY3=$G(^FBAAC(K,1,L,1,M,1,N,3))   ; 3 node of file 162.03
"RTN","FBAAV01",143,0)
 S FBIA=+$P(FBY3,U,6)      ; .05 field IPAC agreement ien
"RTN","FBAAV01",144,0)
 S FBIA=$S(FBIA:$P($G(^FBAA(161.95,FBIA,0)),U,1),1:"")    ; IPAC agreement ID# or ""
"RTN","FBAAV01",145,0)
 S FBDODINV=$P(FBY3,U,7)   ; IPAC DoD invoice#
"RTN","FBAAV01",146,0)
 ;
"RTN","FBAAV01",147,0)
 ; if IPAC agreement is not on file, but there is only one active IPAC on file for the vendor, then save it/use it
"RTN","FBAAV01",148,0)
 I FBIA="" S FBIA=$$IPACID^FBAAMP(L,.FBIPIEN) I FBIA'="",FBIPIEN D
"RTN","FBAAV01",149,0)
 . N FBIENS,FBIAFDA
"RTN","FBAAV01",150,0)
 . S FBIENS=N_","_M_","_L_","_K_","
"RTN","FBAAV01",151,0)
 . S FBIAFDA(162.03,FBIENS,.05)=FBIPIEN    ; ipac agreement ien
"RTN","FBAAV01",152,0)
 . D FILE^DIE("","FBIAFDA")                ; update the database
"RTN","FBAAV01",153,0)
 . Q
"RTN","FBAAV01",154,0)
 ;
"RTN","FBAAV01",155,0)
 ; if IPAC agreement is still not found, then report an error condition to Central Fee
"RTN","FBAAV01",156,0)
 I FBIA="" S FBIA="9999999999"        ; error value to be sent to Central Fee so they reject it back to VistA
"RTN","FBAAV01",157,0)
 ;
"RTN","FBAAV01",158,0)
 ; if DoD invoice# is not on file, then attempt to use field# 49 PATIENT ACCOUNT NUMBER. use it/save it if it exists
"RTN","FBAAV01",159,0)
 I FBDODINV="" S FBDODINV=$P(FBY2,U,16) I FBDODINV'="" D
"RTN","FBAAV01",160,0)
 . N FBIENS,FBIAFDA
"RTN","FBAAV01",161,0)
 . S FBIENS=N_","_M_","_L_","_K_","
"RTN","FBAAV01",162,0)
 . S FBIAFDA(162.03,FBIENS,.055)=FBDODINV     ; DoD invoice#
"RTN","FBAAV01",163,0)
 . D FILE^DIE("","FBIAFDA")                   ; update the database
"RTN","FBAAV01",164,0)
 . Q
"RTN","FBAAV01",165,0)
 ;
"RTN","FBAAV01",166,0)
 ; if DoD invoice# is still not found, then report an error condition to Central Fee
"RTN","FBAAV01",167,0)
 I FBDODINV="" S FBDODINV="9999999999999999999999"  ; error value to be sent to Central Fee
"RTN","FBAAV01",168,0)
 ;
"RTN","FBAAV01",169,0)
IPACX ;
"RTN","FBAAV01",170,0)
 S FBIA=$$LJ^XLFSTR(FBIA,"10T")           ; IPAC agreement id#
"RTN","FBAAV01",171,0)
 S FBDODINV=$$LJ^XLFSTR(FBDODINV,"22T")   ; DoD invoice#
"RTN","FBAAV01",172,0)
 Q
"RTN","FBAAV01",173,0)
 ;
"RTN","FBAAV1")
0^32^B29696707^B29697333
"RTN","FBAAV1",1,0)
FBAAV1 ;AISC/GRR-ELECTRONICALLY TRANSMIT FEE (VENDOR MRA'S) PART 2 ;07/18/06
"RTN","FBAAV1",2,0)
 ;;3.5;FEE BASIS;**10,36,39,98,158**;JAN 30, 1995;Build 94
"RTN","FBAAV1",3,0)
 ;;Per VA Directive 6402, this routine should not be modified.
"RTN","FBAAV1",4,0)
 S (ZMCNT,ZPCNT,FB("M"),FB("P"))=0
"RTN","FBAAV1",5,0)
 ;D STATION^FBAAUTL,HD^FBAAUTL Q:$D(FB("ERROR"))
"RTN","FBAAV1",6,0)
 S FBTXT=0
"RTN","FBAAV1",7,0)
 F J="O","P" I $D(^FBAA(161.25,"AE",J)) F K=0:0 S K=$O(^FBAA(161.25,"AE",J,K)) Q:K'>0  S FBTC=$G(^FBAA(161.25,K,0)),FBTC=$S(FBTC']"":"N",J="P":$P(FBTC,U,2),J="O":$P(FBTC,U,3),1:"N") S Y(0)=$G(^FBAAV(K,0)) I Y(0)]"" D
"RTN","FBAAV1",8,0)
 .S Y(1)=$G(^FBAAV(K,"ADEL")),Y(2)=$G(^FBAAV(K,"AMS")),Y(3)=$G(^FBAAV(K,1)) D GETGRP^FBAAUTL6(K,5)
"RTN","FBAAV1",9,0)
 .I 'FBTXT S FBTXT=1 D NEWMSG^FBAAV01
"RTN","FBAAV1",10,0)
 .D GOT
"RTN","FBAAV1",11,0)
 D:+$G(FBOKTX) XMIT^FBAAV01 Q
"RTN","FBAAV1",12,0)
GOT S FBNAME=$P(Y(0),"^",1),FBNAME=$S(FBNAME[",":$E($P(FBNAME,",",2),1)_" "_$E($P(FBNAME,",",2),$F($P(FBNAME,",",2)," "))_$S($F($P(FBNAME,",",2)," "):" ",1:"  ")_$P(FBNAME,",",1),1:FBNAME)
"RTN","FBAAV1",13,0)
 S FBNAME=$S($L(FBNAME)<30:FBNAME_$E(PAD,$L(FBNAME)+1,30),1:$E(FBNAME,1,30)),FBID=$P(Y(0),"^",2),FBID=FBID_$E(PAD,$L(FBID)+1,11),FBPART=$P(Y(0),"^",7),FBSN=FBSN_$E("      ",$L(FBSN)+1,6)
"RTN","FBAAV1",14,0)
 S FBSC=$S($P(Y(0),"^",8)]"":$P(Y(0),"^",8),1:"  "),FBSC=$S(FBSC="  ":FBSC,$D(^FBAA(161.6,FBSC,0)):$P(^(0),"^",2),1:"  "),FBTC=$S(FBTC]"":FBTC,1:"N"),OCDT=$S(Y(1)]"":$P(Y(1),"^",2),1:"")
"RTN","FBAAV1",15,0)
 S FBPC=$S($P(Y(0),"^",9)]"":$P(Y(0),"^",9),1:"  "),FBPC=$S(FBPC="  ":FBPC,$D(^FBAA(161.81,FBPC,0)):$P(^(0),"^",2),1:"  ")
"RTN","FBAAV1",16,0)
 S FBTC=$S(FBTC="N":"A",1:FBTC),FBAD=$P(Y(0),"^",3),FBAD=FBAD_$E(PAD,$L(FBAD)+1,30),FBAD1=$P(Y(0),"^",14),FBAD1=FBAD1_$E(PAD,$L(FBAD1)+1,30),FBCITY=$E($P(Y(0),"^",4),1,19),FBCITY=FBCITY_$E(PAD,$L(FBCITY)+1,19)
"RTN","FBAAV1",17,0)
 S FBSTCD=$P(Y(0),"^",5),FBSTATE=$S(FBSTCD']"":"  ",$D(^DIC(5,FBSTCD,0)):$P(^(0),"^",2),1:"  "),FBSTATE=$S($L(FBSTATE)'=2:"  ",1:FBSTATE),FBZIP=$P(Y(0),"^",6),FBZIP=$TR(FBZIP,"-","")_$E("000000000",$L(FBZIP)+1,9)
"RTN","FBAAV1",18,0)
 S FBMRC=$P(Y(0),"^",18),FBMRC=$S(FBMRC]"":FBMRC,1:"  "),FBCHAIN=$P(Y(0),"^",10),FBCHAIN=$E("0000",$L(FBCHAIN)+1,4)_FBCHAIN
"RTN","FBAAV1",19,0)
 S STCC=$P(Y(0),"^",13),FBCC="000" I STCC]"",FBSTCD]"" S FBCC=$S($D(^DIC(5,FBSTCD,1,STCC,0)):$P(^(0),"^",3),1:"000")
"RTN","FBAAV1",20,0)
 S FBCC=$E("000",$L(FBCC)+1,3)_FBCC,FBRT=$S(J="P":4,1:1),FBICN=$E(FBSN,1,3)_K,FBICN=$E("000000000000000",$L(FBICN)+1,15)_FBICN,FBTID=$P(Y(2),"^",6),FBTID=$S(FBTID]"":FBTID,1:"T"),FBFMST=$P(Y(2),"^",4),FBFMST=$S(FBFMST]"":FBFMST,1:"C")
"RTN","FBAAV1",21,0)
 S FBNPI=$$EN^FBNPILK(K)
"RTN","FBAAV1",22,0)
 ; pad FPDS data
"RTN","FBAAV1",23,0)
 S FBBT=$S($P(Y(3),U,10)]"":$P(Y(3),U,10),1:" ")_" "
"RTN","FBAAV1",24,0)
 F I=1:1:5 S FBSG(I)=$G(FBSG(I))_$E("  ",1,2-$L($G(FBSG(I))))
"RTN","FBAAV1",25,0)
 ;
"RTN","FBAAV1",26,0)
 D SETP:J="P",SETM:J="O",UPDT
"RTN","FBAAV1",27,0)
 ;S ^FBAA(161.25,"AD","T",K)="",$P(^FBAA(161.25,K,0),"^",3)="T" K ^FBAA(161.25,"AD",J,K)
"RTN","FBAAV1",28,0)
 D STORE Q
"RTN","FBAAV1",29,0)
SETM S ZMCNT=ZMCNT+1 D:FB("M")=0!(ZMCNT>100) BHEDM S FBSTR=FBRT_FBTC_FBSN_FBID_"  "
"RTN","FBAAV1",30,0)
 I FBTC="D"!(FBTC="R") S FBSTR=FBSTR_"$" Q
"RTN","FBAAV1",31,0)
 S FBSTR=FBSTR_"1"_FBSC_FBPC_FBNAME_FBAD_FBAD1_FBCITY_FBSTATE_FBZIP_FBMRC_FBCC_"B"_FBTID_"Y"_FBFMST_FBICN_FBBT_FBSG(1)_FBSG(2)_FBSG(3)_FBSG(4)_FBSG(5)_FBNPI_"$"
"RTN","FBAAV1",32,0)
 Q
"RTN","FBAAV1",33,0)
SETP S ZPCNT=ZPCNT+1 D:FB("P")=0!(ZPCNT>100) BHEDP S FBSTR=FBRT_FBTC_FBSN_$E(FBID,1,9)_FBCHAIN
"RTN","FBAAV1",34,0)
 I FBTC="D"!(FBTC="R") S FBSTR=FBSTR_"$" Q
"RTN","FBAAV1",35,0)
 S FBSTR=FBSTR_"1"_FBNAME_FBAD_FBAD1_FBCITY_FBSTATE_FBZIP_FBMRC_FBCC_"B"_FBTID_"Y"_FBFMST_FBICN_FBBT_FBSG(1)_FBSG(2)_FBSG(3)_FBSG(4)_FBSG(5)_FBNPI_"$"
"RTN","FBAAV1",36,0)
 Q
"RTN","FBAAV1",37,0)
BHEDM S BTYPE="M" D GETB S FB("M")=1,FBSTR=FBHD_"C1"_$E(DT,4,7)_$E(DT,2,3)_FBSN_FBZBNM_"$" D STORE S ZMCNT=1 Q
"RTN","FBAAV1",38,0)
BHEDP S BTYPE="P" D GETB S FB("P")=1,FBSTR=FBHD_"C4"_$E(DT,4,7)_$E(DT,2,3)_FBSN_FBZBNP_"$" D STORE S ZPCNT=1 Q
"RTN","FBAAV1",39,0)
UPDT L +^FBAA(161.25,K):5 K ^FBAA(161.25,"AE",J,K)
"RTN","FBAAV1",40,0)
 ;I $D(^FBAA(161.25,"AE",$S(J="P":"O",1:"P"),K)) S $P(^FBAA(161.25,K,0),"^",3)="N" L -^FBAA(161.25,K) Q  ;commented out since don't know why it is set
"RTN","FBAAV1",41,0)
 ;K:OCDT]"" ^FBAAV("AC",OCDT,K) S $P(^FBAAV(K,0),"^",15)=DT,^FBAAV("AC",DT,K)="" L -^FBAA(161.25,K)
"RTN","FBAAV1",42,0)
 S DA=K,(DIC,DIE)="^FBAA(161.25,",DR="4///^S X=DT" D ^DIE L -^FBAA(161.25,K)
"RTN","FBAAV1",43,0)
 S DIE="^FBAAV(",DA=K,DR="12///^S X=DT" D LOCK^FBUCUTL(DIE,DA,1) I FBLOCK D ^DIE L -^FBAAV(DA)
"RTN","FBAAV1",44,0)
 K DA,DIE,DR,FBLOCK Q
"RTN","FBAAV1",45,0)
GETB D GETNXB^FBAAUTL
"RTN","FBAAV1",46,0)
 I BTYPE="M" S FBZBNM=$E("0000000",$L(FBBN)+1,7)_FBBN Q
"RTN","FBAAV1",47,0)
 I BTYPE="P" S FBZBNP=$E("0000000",$L(FBBN)+1,7)_FBBN
"RTN","FBAAV1",48,0)
 Q
"RTN","FBAAV1",49,0)
STORE I TOTSTR+$L(FBSTR)>13900!(ZMCNT>100)!(ZPCNT>100) S TOTSTR=0 D XMIT^FBAAV01,NEWMSG^FBAAV01 S FBTMP=FBSTR D BHEDM:J="O",BHEDP:J="P" S FBSTR=FBTMP K FBTMP
"RTN","FBAAV1",50,0)
 S TOTSTR=TOTSTR+$L(FBSTR) D STORE^FBAAV01
"RTN","FBAAV1",51,0)
 Q
"RTN","FBAAV1",52,0)
KILL K FBATCH,FBCHB,J,K,L,M,N,FBAABN,FBAAON,FBAASN,FBAACP,FBAACD,FBAABT,FBAAAP,FBSTR,PAD,PAD1,FBPAYT,FBVID,FBPOV,FBTT,FBPATT,FBTD,FBSUSP,FBAP,FBEXMPT,FBFNI,FBFNY,^TMP($J)
"RTN","FBAAV1",53,0)
 K A,FBTYPE,DO,DI,DIC,DIE,DOD,DQ,ER,FBADD,FBAUTH,FBBD,FBBN,FBCHAIN,FBFDC,FBFLNAM,FBFR,FBLNAM,FBMST,FBRECT,FBRT,FBSEX,FBSTAT,FBSTCD,FBTC,FBTO,BTYPE,POS,POV,POW,STCC,STCD,T,TOTSTR,XMKK,XMLOCK,XMR,XMSUB,XMT,XMTEXT,XMZ,ZMCNT,ZPCNT
"RTN","FBAAV1",54,0)
 K FBINVN,FBDIN,FBSSN,FBNAME,FBLNAME,FBFI,FBMI,XMDUZ,DA,DR,X,Y,FBPART,FBC,FBSN,FBID,FEEO,FBSC,FBPC,FBAD,FBCITY,FBSTATE,FBZIP,FBCC,FBZBN,FBZBNM,FBZBNP,FB,D,Z,Q,VAT,VATERR,VATNAME,FBSDI
"RTN","FBAAV1",55,0)
 K FBCTY,FBDX,FBFTD,FBPRC,FBPSA,FBST,OCDT,X1,X2,FB7078,FBBILL,FBCLAIM,FBCTY,FBDISP,FBDOB,FBFDT,FBJ,FBLOS,FBMED,FBPART1,FBSTABR,FBTDT,FBTTD,FBVEN,PAD,VAPA,FBSITE,FBK,FBNPI
"RTN","FBAAV1",56,0)
 K FB0,FBFEE,FBHD,FBI,FBLN,FBNVP,FBOKTX,FBTXT,FBVAR,FBXMFEE,FBXMNVP,FBXMZ,XMDUN,FBRESUB,FBAD1,FBFMST,FBICN,FBMRC,FBTID,FBPOP,FBCPT,FBHCFA,FBPD,FBPOS,FBVTOS,FBAC,FBCSN,FBRX,FBVFN
"RTN","FBAAV1",57,0)
 Q
"RTN","FBAAV2")
0^26^B39413585^B17032694
"RTN","FBAAV2",1,0)
FBAAV2 ;AISC/GRR-ELECTRONICALLY TRANSMIT PHARMACY PAYMENTS ;11 Apr 2006  2:52 PM
"RTN","FBAAV2",2,0)
 ;;3.5;FEE BASIS;**3,89,98,116,108,123,158**;JAN 30, 1995;Build 94
"RTN","FBAAV2",3,0)
 ;;Per VA Directive 6402, this routine should not be modified.
"RTN","FBAAV2",4,0)
DETP ; ENTRY FROM FBAAV0
"RTN","FBAAV2",5,0)
 S FBTXT=0
"RTN","FBAAV2",6,0)
 D CKB5V^FBAAV01 I $G(FBERR) K FBERR Q
"RTN","FBAAV2",7,0)
 ; HIPAA 5010 - line items that have 0.00 amount paid are now required togo to Central Fee
"RTN","FBAAV2",8,0)
 F K=0:0 S K=$O(^FBAA(162.1,"AE",J,K)) Q:K'>0  F L=0:0 S L=$O(^FBAA(162.1,"AE",J,K,L)) Q:L'>0  S Y(0)=$G(^FBAA(162.1,K,"RX",L,0)),Y(2)=$G(^(2)),Y=$G(^FBAA(162.1,K,0)) I Y(0)]"",Y]"" D
"RTN","FBAAV2",9,0)
 .S Y(6)=$G(^FBAA(162.1,K,"RX",L,6))       ; FB*3.5*123
"RTN","FBAAV2",10,0)
 .S Y(3)=$G(^FBAA(162.1,K,"RX",L,3))       ; FB*3.5*158
"RTN","FBAAV2",11,0)
 .N FBPICN,FBY
"RTN","FBAAV2",12,0)
 .S FBPICN=K_U_L
"RTN","FBAAV2",13,0)
 .S FBY=$S($P(Y,U,12):$P(Y,U,12),1:$P(Y,U,2))_U_+$P(Y(2),U,9)
"RTN","FBAAV2",14,0)
 .I 'FBTXT S FBTXT=1 D NEWMSG^FBAAV01,STORE^FBAAV01,UPD^FBAAV0
"RTN","FBAAV2",15,0)
 .D GOTP
"RTN","FBAAV2",16,0)
 D:FBTXT XMIT^FBAAV01
"RTN","FBAAV2",17,0)
 Q
"RTN","FBAAV2",18,0)
 ;
"RTN","FBAAV2",19,0)
GOTP ; process a B5 line item
"RTN","FBAAV2",20,0)
 N DFN,FBADJ,FBADJA1,FBADJA2,FBADJR1,FBADJR2,FBIENS,FBPNAMX,FBVY0,FBX
"RTN","FBAAV2",21,0)
 N FBNPI,FBEDIF,FBIA,FBDODINV,FBCRARC,FBFPPSID,FBAUTHNUM,FBAMTCLM,FBQNTY
"RTN","FBAAV2",22,0)
 ;
"RTN","FBAAV2",23,0)
 S FBLNITM=+$P(Y(3),U) ;FPPS line item
"RTN","FBAAV2",24,0)
 S FBIENS=$P(FBPICN,U,2)_","_$P(FBPICN,U,1)_","
"RTN","FBAAV2",25,0)
 S FBPAYT=$P(Y(0),"^",20),FBPAYT=$S(FBPAYT]"":FBPAYT,1:"V")
"RTN","FBAAV2",26,0)
 S FBINVN=$P(Y,"^"),FBINVN=$E("000000000",$L(FBINVN)+1,9)_FBINVN
"RTN","FBAAV2",27,0)
 S FBEDIF=$S($P(Y,"^",13)]"":"Y",1:" ") ; EDI flag
"RTN","FBAAV2",28,0)
 S FBFPPSID=$E($P(Y,U,13),1,12),FBFPPSID=$$RJ^XLFSTR(FBFPPSID,12,0) ;FPPS Claim Number
"RTN","FBAAV2",29,0)
 S FBAUTHNUM=$P(Y(3),U,2)  ;AUTHORIZATION NUMBER
"RTN","FBAAV2",30,0)
 I FBAUTHNUM']"" S FBAUTHNUM=$$AUTHRX(FBIENS)
"RTN","FBAAV2",31,0)
 S FBAUTHNUM=$$LJ^XLFSTR(FBAUTHNUM,"29T"," ")
"RTN","FBAAV2",32,0)
 S FBAMTCLM=$P(Y(0),U,4) ;Amount Claimed = Service Line Billed Amount
"RTN","FBAAV2",33,0)
 S FBDIN=$$AUSDT^FBAAV3($P(Y,"^",2))
"RTN","FBAAV2",34,0)
 ;
"RTN","FBAAV2",35,0)
 S FBVFN=$P(Y,"^",4)
"RTN","FBAAV2",36,0)
 S FBNPI=$$EN^FBNPILK(FBVFN)
"RTN","FBAAV2",37,0)
 S FBVY0=$G(^FBAAV(FBVFN,0)) ; vendor 0 node
"RTN","FBAAV2",38,0)
 ;
"RTN","FBAAV2",39,0)
 S FBIA=+$P(Y,U,23)                                      ; IPAC agreement ptr
"RTN","FBAAV2",40,0)
 S FBIA=$S(FBIA:$P($G(^FBAA(161.95,FBIA,0)),U,1),1:"")   ; IPAC external agreement ID# or ""
"RTN","FBAAV2",41,0)
 S FBIA=$$LJ^XLFSTR(FBIA,"10T")                          ; format to 10 characters
"RTN","FBAAV2",42,0)
 S FBDODINV=$P(Y(6),U,1)                                 ; DoD invoice#
"RTN","FBAAV2",43,0)
 S FBDODINV=$$LJ^XLFSTR(FBDODINV,"22T")                  ; format to 22 characters
"RTN","FBAAV2",44,0)
 ;
"RTN","FBAAV2",45,0)
 S FBVID=$P(FBVY0,U,2),FBVID=$E(FBVID,1,9)_$E(PAD,$L(FBVID)+1,9)
"RTN","FBAAV2",46,0)
 S FBCSN=$S($P(FBVY0,U,2)]"":$P(FBVY0,U,10),1:"")
"RTN","FBAAV2",47,0)
 S FBCSN=$E("0000",$L(FBCSN)+1,4)_FBCSN
"RTN","FBAAV2",48,0)
 I FBPAYT="R" S FBVID=$E(PAD,1,9),FBCSN=$E(PAD,1,4)
"RTN","FBAAV2",49,0)
 K FBVY0
"RTN","FBAAV2",50,0)
 ;
"RTN","FBAAV2",51,0)
 S FBRX=$P(Y(0),"^",1),FBRX=$E("00000000",$L(FBRX)+1,8)_FBRX
"RTN","FBAAV2",52,0)
 I '$L($G(FBAASN)) D STATION^FBAAUTL
"RTN","FBAAV2",53,0)
 S FBPSA=$$PSA^FBAAV5(+$P(Y(2),U,5),+FBAASN) I $L(+FBPSA)'=3 S FBPSA=999
"RTN","FBAAV2",54,0)
 S FBTD=$$AUSDT^FBAAV3($P(Y(0),"^",3))
"RTN","FBAAV2",55,0)
 S FBSUSP=$P(Y(0),"^",8),FBSUSP=$S(FBSUSP="":" ",$D(^FBAA(161.27,+FBSUSP,0)):$P(^(0),"^"),1:" ")
"RTN","FBAAV2",56,0)
 S FBAC=$$AUSAMT^FBAAV3($P(Y(0),"^",4),8)
"RTN","FBAAV2",57,0)
 S FBAP=$$AUSAMT^FBAAV3($P(Y(0),"^",16),8)
"RTN","FBAAV2",58,0)
 I FBAC=FBAP S FBAP="        "
"RTN","FBAAV2",59,0)
 ;
"RTN","FBAAV2",60,0)
 S FBQNTY=+$P(Y(0),U,13)  ;Quantity/Units 162.11,1.6
"RTN","FBAAV2",61,0)
 S FBQNTY=$S((FBQNTY>0)&(FBQNTY<10000000):FBQNTY,1:0)
"RTN","FBAAV2",62,0)
 S FBQNTY=$$AUSNUM^FBAAV3(FBQNTY,5,12)
"RTN","FBAAV2",63,0)
 ;
"RTN","FBAAV2",64,0)
 S DFN=$P(Y(0),"^",5)
"RTN","FBAAV2",65,0)
 Q:'DFN
"RTN","FBAAV2",66,0)
 Q:'$D(^DPT(DFN,0))
"RTN","FBAAV2",67,0)
 ; Note: Prior to the following line Y(0) = the 0 node of subfile 161.11
"RTN","FBAAV2",68,0)
 ;After the line Y(0) will be the 0 node of file #2
"RTN","FBAAV2",69,0)
 S VAPA("P")="",Y(0)=^DPT(DFN,0) D PAT^FBAAUTL2,ADD^VADPT
"RTN","FBAAV2",70,0)
 S FBPNAMX=$$HL7NAME^FBAAV2(DFN)
"RTN","FBAAV2",71,0)
 S FBST=$S($P(VAPA(5),"^")="":"  ",$D(^DIC(5,$P(VAPA(5),"^"),0)):$P(^(0),"^",2),1:"  ")
"RTN","FBAAV2",72,0)
 I $L(FBST)>2 S FBST="**"
"RTN","FBAAV2",73,0)
 S:$L(FBST)'=2 FBST=$E(PAD,$L(FBST)+1,2)_FBST
"RTN","FBAAV2",74,0)
 S FBCTY=$S($P(VAPA(7),"^")="":"   ",FBST="  ":"   ",$D(^DIC(5,$P(VAPA(5),"^"),1,$P(VAPA(7),"^"),0)):$P(^(0),"^",3),1:"   ")
"RTN","FBAAV2",75,0)
 I $L(FBCTY)'=3 S FBCTY=$E("000",$L(FBCTY)+1,3)_FBCTY
"RTN","FBAAV2",76,0)
 S FBZIP=$S('+$G(VAPA(11)):VAPA(6),+VAPA(11):$P(VAPA(11),U),1:VAPA(6)),FBZIP=$TR(FBZIP,"-","")_$E("000000000",$L(FBZIP)+1,9)
"RTN","FBAAV2",77,0)
 ;
"RTN","FBAAV2",78,0)
 ; get and format CARCs and RARCs
"RTN","FBAAV2",79,0)
 D CRARC(FBIENS,.FBCRARC) ; FB*3.5*158
"RTN","FBAAV2",80,0)
 ;
"RTN","FBAAV2",81,0)
 ; build 1st line
"RTN","FBAAV2",82,0)
 S FBSTR=5_FBAASN_FBSSN_FBPAYT_FBPNAMX_FBVID_FBCSN_FBAC_FBAP_FBAAON
"RTN","FBAAV2",83,0)
 S FBSTR=FBSTR_FBSUSP_FBTD_FBRX_FBDIN_FBINVN
"RTN","FBAAV2",84,0)
 S FBSTR=FBSTR_$E(PAD,1,33)_FBST_FBCTY_FBZIP ; reserved for foreign addr
"RTN","FBAAV2",85,0)
 S FBSTR=FBSTR_$E(FBPSA,1,3)_$P(FBY,U,2)_$E(PAD,1,8)
"RTN","FBAAV2",86,0)
 S FBSTR=FBSTR_$$PADZ^FBAAV01(FBPICN,30)_$$AUSDT^FBAAV3(+FBY)_"~"
"RTN","FBAAV2",87,0)
 D STORE^FBAAV01
"RTN","FBAAV2",88,0)
 ;
"RTN","FBAAV2",89,0)
 ; build 2nd line
"RTN","FBAAV2",90,0)
 ; FB*3.5*158
"RTN","FBAAV2",91,0)
 S FBADJR1=$S($D(FBCRARC(1)):$P(FBCRARC(1),U,2),1:""),FBADJR1=$$RJ^XLFSTR(FBADJR1,5," ")
"RTN","FBAAV2",92,0)
 S FBADJR2=$S($D(FBCRARC(2)):$P(FBCRARC(2),U,2),1:""),FBADJR2=$$RJ^XLFSTR(FBADJR2,5," ")
"RTN","FBAAV2",93,0)
 S FBSTR=FBADJR1_FBADJR2
"RTN","FBAAV2",94,0)
 S FBADJA1=$S($D(FBCRARC(1)):$P(FBCRARC(1),U,3),1:0),FBADJA1=$$AUSAMT^FBAAV3(FBADJA1,9,1)
"RTN","FBAAV2",95,0)
 S FBADJA2=$S($D(FBCRARC(2)):$P(FBCRARC(2),U,3),1:0),FBADJA2=$$AUSAMT^FBAAV3(FBADJA2,9,1)
"RTN","FBAAV2",96,0)
 S FBSTR=FBSTR_FBADJA1_FBADJA2
"RTN","FBAAV2",97,0)
 ;
"RTN","FBAAV2",98,0)
 S FBSTR=FBSTR_FBNPI_FBEDIF
"RTN","FBAAV2",99,0)
 S FBSTR=FBSTR_FBIA_FBDODINV                          ; IPAC data from FB*3.5*123
"RTN","FBAAV2",100,0)
 ; FB*3.5*158
"RTN","FBAAV2",101,0)
 S FBSTR=FBSTR_FBFPPSID
"RTN","FBAAV2",102,0)
 S FBSTR=FBSTR_FBAUTHNUM ;Authorization Number
"RTN","FBAAV2",103,0)
 S FBSTR=FBSTR_$$RJ^XLFSTR(FBLNITM,3,0) ;FPPS line item
"RTN","FBAAV2",104,0)
 S FBSTR=FBSTR_$$AUSAMT^FBAAV3(FBAMTCLM,12) ;Service Line Billed Amount
"RTN","FBAAV2",105,0)
 ;
"RTN","FBAAV2",106,0)
 S FBADJG=$S($D(FBCRARC(1)):$P(FBCRARC(1),U),1:""),FBADJG=$$RJ^XLFSTR(FBADJG,2," ")
"RTN","FBAAV2",107,0)
 S FBRRC1=$S($D(FBCRARC(1)):$P(FBCRARC(1),U,4),1:""),FBRRC1=$$RJ^XLFSTR(FBRRC1,6," ")
"RTN","FBAAV2",108,0)
 S FBRRC2=$S($D(FBCRARC(1)):$P(FBCRARC(1),U,5),1:""),FBRRC2=$$RJ^XLFSTR(FBRRC2,6," ")
"RTN","FBAAV2",109,0)
 S FBSTR=FBSTR_FBADJG_FBRRC1_FBRRC2
"RTN","FBAAV2",110,0)
 ;
"RTN","FBAAV2",111,0)
 S FBADJG=$S($D(FBCRARC(2)):$P(FBCRARC(2),U),1:""),FBADJG=$$RJ^XLFSTR(FBADJG,2," ")
"RTN","FBAAV2",112,0)
 S FBRRC1=$S($D(FBCRARC(2)):$P(FBCRARC(2),U,4),1:""),FBRRC1=$$RJ^XLFSTR(FBRRC1,6," ")
"RTN","FBAAV2",113,0)
 S FBRRC2=$S($D(FBCRARC(2)):$P(FBCRARC(2),U,5),1:""),FBRRC2=$$RJ^XLFSTR(FBRRC2,6," ")
"RTN","FBAAV2",114,0)
 S FBSTR=FBSTR_FBADJG_FBRRC1_FBRRC2
"RTN","FBAAV2",115,0)
 ; 
"RTN","FBAAV2",116,0)
 F FBI=3:1:5 D
"RTN","FBAAV2",117,0)
 . S FBADJG=$S($D(FBCRARC(FBI)):$P(FBCRARC(FBI),U),1:""),FBADJG=$$RJ^XLFSTR(FBADJG,2," ")
"RTN","FBAAV2",118,0)
 . S FBADJR=$S($D(FBCRARC(FBI)):$P(FBCRARC(FBI),U,2),1:""),FBADJR=$$RJ^XLFSTR(FBADJR,5," ")
"RTN","FBAAV2",119,0)
 . S FBRRC1=$S($D(FBCRARC(FBI)):$P(FBCRARC(FBI),U,4),1:""),FBRRC1=$$RJ^XLFSTR(FBRRC1,6," ")
"RTN","FBAAV2",120,0)
 . S FBRRC2=$S($D(FBCRARC(FBI)):$P(FBCRARC(FBI),U,5),1:""),FBRRC2=$$RJ^XLFSTR(FBRRC2,6," ")
"RTN","FBAAV2",121,0)
 . S FBADJA=$S($D(FBCRARC(FBI)):$P(FBCRARC(FBI),U,3),1:0),FBADJA=$$AUSAMT^FBAAV3(FBADJA,9,1)
"RTN","FBAAV2",122,0)
 . S FBSTR=FBSTR_FBADJG_FBADJR_FBRRC1_FBRRC2_FBADJA
"RTN","FBAAV2",123,0)
 ;
"RTN","FBAAV2",124,0)
 S FBSTR=FBSTR_FBQNTY
"RTN","FBAAV2",125,0)
 ;
"RTN","FBAAV2",126,0)
 S FBSTR=FBSTR_"~$"
"RTN","FBAAV2",127,0)
 D STORE^FBAAV01
"RTN","FBAAV2",128,0)
 Q
"RTN","FBAAV2",129,0)
 ;
"RTN","FBAAV2",130,0)
AUTHRX(IENS) ; returns REFERENCE NUMBER from ^FB7078
"RTN","FBAAV2",131,0)
 ;
"RTN","FBAAV2",132,0)
 N REFNUM
"RTN","FBAAV2",133,0)
 S REFNUM=""
"RTN","FBAAV2",134,0)
 D GETS^DIQ(162.11,IENS,"26","I","FB")
"RTN","FBAAV2",135,0)
 I $D(FB),FB(162.11,IENS,26,"I")["FB7078" D
"RTN","FBAAV2",136,0)
 . S FB7078=$P(FB(162.11,IENS,26,"I"),";")
"RTN","FBAAV2",137,0)
 . S:$D(^FB7078(FB7078,0)) REFNUM=$P(^FB7078(FB7078,0),U)
"RTN","FBAAV2",138,0)
 Q REFNUM
"RTN","FBAAV2",139,0)
 ;
"RTN","FBAAV2",140,0)
HL7NAME(FBDFN) ; return patient name formatted in a 35 character length string
"RTN","FBAAV2",141,0)
 N FBAR,FBNM
"RTN","FBAAV2",142,0)
 S FBAR("FILE")=2,FBAR("IENS")=FBDFN,FBAR("FIELD")=.01
"RTN","FBAAV2",143,0)
 S FBNM=$$HLNAME^XLFNAME(.FBAR,"L35","|")
"RTN","FBAAV2",144,0)
 Q $$LRJ^FBAAV4(FBNM,35)
"RTN","FBAAV2",145,0)
 ;
"RTN","FBAAV2",146,0)
CRARC(FBIENS,FBCRARC) ; load CARCs and RARCs
"RTN","FBAAV2",147,0)
 ;
"RTN","FBAAV2",148,0)
 N FBADJ,FBRRMK
"RTN","FBAAV2",149,0)
 D LOADADJ^FBRXFA(FBIENS,.FBADJ)
"RTN","FBAAV2",150,0)
 D LOADRR^FBRXFR(FBIENS,.FBRRMK)
"RTN","FBAAV2",151,0)
 D CRARC^FBAAUTL(.FBADJ,.FBRRMK,.FBCRARC)
"RTN","FBAAV2",152,0)
 Q
"RTN","FBAAV2",153,0)
 ;
"RTN","FBAAV3")
0^35^B4896340^B3409907
"RTN","FBAAV3",1,0)
FBAAV3 ;AISC/GRR - CREATE & ELECTRONICALLY TRANSMIT TRANSACTIONS FOR TRAVEL PAYMENTS ;3/23/2012
"RTN","FBAAV3",2,0)
 ;;3.5;FEE BASIS;**3,89,116,132,158**;JAN 30, 1995;Build 94
"RTN","FBAAV3",3,0)
 ;;Per VA Directive 6402, this routine should not be modified.
"RTN","FBAAV3",4,0)
DETT ; process a travel batch
"RTN","FBAAV3",5,0)
 S FBTXT=0
"RTN","FBAAV3",6,0)
 ; HIPAA 5010 - line items that have 0.00 amount paid are now required to go to Central Fee
"RTN","FBAAV3",7,0)
 ;F K=0:0 S K=$O(^FBAAC("AD",J,K)) Q:K'>0  F L=0:0 S L=$O(^FBAAC("AD",J,K,L)) Q:L'>0  S Y(0)=$G(^FBAAC(K,3,L,0)) I Y(0)]"",+$P(Y(0),U,3) D
"RTN","FBAAV3",8,0)
 F K=0:0 S K=$O(^FBAAC("AD",J,K)) Q:K'>0  F L=0:0 S L=$O(^FBAAC("AD",J,K,L)) Q:L'>0  S Y(0)=$G(^FBAAC(K,3,L,0)) I Y(0)]"" D
"RTN","FBAAV3",9,0)
 .S FBPICN=K_U_L
"RTN","FBAAV3",10,0)
 .S FBPICN=$$ORGICN^FBAAVR5(162.04,FBPICN)
"RTN","FBAAV3",11,0)
 .I 'FBTXT S FBTXT=1 D NEWMSG^FBAAV01,STORE^FBAAV01,UPD^FBAAV0
"RTN","FBAAV3",12,0)
 .D GOT
"RTN","FBAAV3",13,0)
 D:FBTXT XMIT^FBAAV01 Q
"RTN","FBAAV3",14,0)
GOT ; process a travel line item
"RTN","FBAAV3",15,0)
 N DFN,FBPNAMX
"RTN","FBAAV3",16,0)
 S FBTD=$$AUSDT($P(Y(0),U))
"RTN","FBAAV3",17,0)
 S FBAP=$$AUSAMT($P(Y(0),"^",3),8)
"RTN","FBAAV3",18,0)
 S DFN=K
"RTN","FBAAV3",19,0)
 Q:'DFN
"RTN","FBAAV3",20,0)
 Q:'$D(^DPT(DFN,0))
"RTN","FBAAV3",21,0)
 ; Note: Prior to the following line Y(0) = 0 node of subfile #162.04
"RTN","FBAAV3",22,0)
 ;       After the line, Y(0) will = 0 node of file #2
"RTN","FBAAV3",23,0)
 S Y(0)=^DPT(DFN,0)
"RTN","FBAAV3",24,0)
 D PAT^FBAAUTL2
"RTN","FBAAV3",25,0)
 S FBPNAMX=$$HL7NAME^FBAAV4(DFN) ; formatted patient name
"RTN","FBAAV3",26,0)
 S FBSTR="T"_FBAASN_FBSSN_"T"_FBPNAMX_FBAP_FBAAON_FBTD_"0"_$E(PAD,1,8)
"RTN","FBAAV3",27,0)
 S FBSTR=FBSTR_$$PADZ^FBAAV01(FBPICN,30)_FBTD_"$"
"RTN","FBAAV3",28,0)
 D STORE^FBAAV01
"RTN","FBAAV3",29,0)
 K FBPICN
"RTN","FBAAV3",30,0)
 Q
"RTN","FBAAV3",31,0)
 ;
"RTN","FBAAV3",32,0)
AUSDT(FBDT) ;called to format date from VA FileMan internal to YYYYMMDD
"RTN","FBAAV3",33,0)
 ; if input date is blank or invalid, eight spaces will be returned
"RTN","FBAAV3",34,0)
 ;
"RTN","FBAAV3",35,0)
 N FBRET
"RTN","FBAAV3",36,0)
 S:FBDT FBRET=$$FMTHL7^XLFDT($P(FBDT,"."))
"RTN","FBAAV3",37,0)
 S:$G(FBRET)=""!($G(FBRET)<0) FBRET="        "
"RTN","FBAAV3",38,0)
 Q FBRET
"RTN","FBAAV3",39,0)
 ;
"RTN","FBAAV3",40,0)
AUSAMT(FBAMT,FBL,FBS) ; called to format signed dollar amount for Austin
"RTN","FBAAV3",41,0)
 ; input
"RTN","FBAAV3",42,0)
 ;   FBAMT - dollar amount
"RTN","FBAAV3",43,0)
 ;   FBL   - (optional) length of return sting 
"RTN","FBAAV3",44,0)
 ;   FBS   - (optional) =true(1) if return value could be negative (-)
"RTN","FBAAV3",45,0)
 ;           default is false (0)
"RTN","FBAAV3",46,0)
 ; result
"RTN","FBAAV3",47,0)
 ;   string value, right justified, 0 padded, decimal point removed,
"RTN","FBAAV3",48,0)
 ;   with rightmost 2 numeric characters the cents
"RTN","FBAAV3",49,0)
 ;   if FBS true then rightmost character indicate the sign (' ' or '-')
"RTN","FBAAV3",50,0)
 ;   example with FBS false: 12.41 with length 8 would return '00001241'
"RTN","FBAAV3",51,0)
 ;   example with FBS true:  12.41 with length 9 would return '00001241 '
"RTN","FBAAV3",52,0)
 ;   example with FBS true: -12.41 with length 9 would return '00001241-'
"RTN","FBAAV3",53,0)
 ;
"RTN","FBAAV3",54,0)
 N FBRET
"RTN","FBAAV3",55,0)
 ;
"RTN","FBAAV3",56,0)
 ; use absolute value
"RTN","FBAAV3",57,0)
 S FBRET=$S(FBAMT<0:-FBAMT,1:FBAMT)
"RTN","FBAAV3",58,0)
 ;
"RTN","FBAAV3",59,0)
 ; format with 2 decimals places
"RTN","FBAAV3",60,0)
 S FBRET=$FN(FBRET,"",2)
"RTN","FBAAV3",61,0)
 ;
"RTN","FBAAV3",62,0)
 ; remove the decimal point
"RTN","FBAAV3",63,0)
 S FBRET=$TR(FBRET,".","")
"RTN","FBAAV3",64,0)
 ;
"RTN","FBAAV3",65,0)
 ; add the suffix denoting the sign when applicable (when FBS true)
"RTN","FBAAV3",66,0)
 S FBRET=FBRET_$S('$G(FBS):"",FBAMT<0:"-",1:" ")
"RTN","FBAAV3",67,0)
 ;
"RTN","FBAAV3",68,0)
 ; right justify and 0 pad
"RTN","FBAAV3",69,0)
 S FBRET=$$RJ^XLFSTR(FBRET,$G(FBL),"0")
"RTN","FBAAV3",70,0)
 ;
"RTN","FBAAV3",71,0)
 ; return result
"RTN","FBAAV3",72,0)
 Q FBRET
"RTN","FBAAV3",73,0)
 ;
"RTN","FBAAV3",74,0)
AUSNUM(FBNUM,FBDEC,FBL,FBS) ; called to format signed/unsigned numeric for Austin
"RTN","FBAAV3",75,0)
 ; input
"RTN","FBAAV3",76,0)
 ;   FBNUM - numeric
"RTN","FBAAV3",77,0)
 ;   FBDEC - number of decimal places
"RTN","FBAAV3",78,0)
 ;   FBL   - (optional) length of return sting 
"RTN","FBAAV3",79,0)
 ;   FBS   - (optional) =true(1) if return value could be negative (-)
"RTN","FBAAV3",80,0)
 ;           default is false (0)
"RTN","FBAAV3",81,0)
 ; result
"RTN","FBAAV3",82,0)
 ;   string value, right justified, 0 padded, decimal point removed,
"RTN","FBAAV3",83,0)
 ;   with rightmost FBDEC=5 numeric characters the decimal part
"RTN","FBAAV3",84,0)
 ;   if FBS true then rightmost character indicate the sign (' ' or '-')
"RTN","FBAAV3",85,0)
 ;   example with FBS false: 12.41 with length 12 would return '000001241000'
"RTN","FBAAV3",86,0)
 ;   example with FBS true:  12.41 with length 13 would return '000001241000 '
"RTN","FBAAV3",87,0)
 ;   example with FBS true: -12.41 with length 13 would return '000001241000-'
"RTN","FBAAV3",88,0)
 ;
"RTN","FBAAV3",89,0)
 N FBRET
"RTN","FBAAV3",90,0)
 ;
"RTN","FBAAV3",91,0)
 ; use absolute value
"RTN","FBAAV3",92,0)
 S FBRET=$S(FBNUM<0:-FBNUM,1:FBNUM)
"RTN","FBAAV3",93,0)
 ;
"RTN","FBAAV3",94,0)
 ; format with 5 decimals places
"RTN","FBAAV3",95,0)
 S FBRET=$FN(FBRET,"",FBDEC)
"RTN","FBAAV3",96,0)
 ;
"RTN","FBAAV3",97,0)
 ; remove the decimal point
"RTN","FBAAV3",98,0)
 S FBRET=$TR(FBRET,".","")
"RTN","FBAAV3",99,0)
 ;
"RTN","FBAAV3",100,0)
 ; add the suffix denoting the sign when applicable (when FBS true)
"RTN","FBAAV3",101,0)
 S FBRET=FBRET_$S('$G(FBS):"",FBNUM<0:"-",1:" ")
"RTN","FBAAV3",102,0)
 ;
"RTN","FBAAV3",103,0)
 ; right justify and 0 pad
"RTN","FBAAV3",104,0)
 S FBRET=$$RJ^XLFSTR(FBRET,$G(FBL),"0")
"RTN","FBAAV3",105,0)
 ;
"RTN","FBAAV3",106,0)
 ; return result
"RTN","FBAAV3",107,0)
 Q FBRET
"RTN","FBAAV3",108,0)
 ;FBAAV3
"RTN","FBAAV4")
0^31^B39332795^B39089780
"RTN","FBAAV4",1,0)
FBAAV4 ;AISC/GRR-ELECTRONICALLY TRANSMIT PATIENT MRA'S ;12/16/2003
"RTN","FBAAV4",2,0)
 ;;3.5;FEE BASIS;**13,34,37,70,146,127,153,158**;JAN 30, 1995;Build 94
"RTN","FBAAV4",3,0)
 ;;Per VA Directive 6402, this routine should not be modified.
"RTN","FBAAV4",4,0)
 ;
"RTN","FBAAV4",5,0)
 ;FB*3.5*153 Modify MRA transmission to Austin to insure that a
"RTN","FBAAV4",6,0)
 ;           undefined state code defaults to 2 spaces.
"RTN","FBAAV4",7,0)
 ;           Also, delete the entry in file 161.26 if no auth
"RTN","FBAAV4",8,0)
 ;           pointer exists in record or the auth pointer points
"RTN","FBAAV4",9,0)
 ;           to deleted patient authorization.  In addition,
"RTN","FBAAV4",10,0)
 ;           insure processing continues if error condition
"RTN","FBAAV4",11,0)
 ;           and less than 100 stacked msgs for transmission.
"RTN","FBAAV4",12,0)
 ;
"RTN","FBAAV4",13,0)
 ;D STATION^FBAAUTL,HD^FBAAUTL Q:$D(FB("ERROR"))
"RTN","FBAAV4",14,0)
 S FBTXT=0,ZMCNT=1 ;FBTXT , ZMCNT 
"RTN","FBAAV4",15,0)
GO S J=0 F  S J=$O(^FBAA(161.26,"AC","P",J)) Q:J'>0  S FB0=$G(^FBAA(161.26,J,0)) I $P(FB0,U) S Y(0)=$G(^DPT($P(FB0,U),0)) I Y(0)]"" S FBTYPE=$S($P(FB0,U,4)]"":$P(FB0,U,4),1:"A"),FBFDC=$P(FB0,U,6),FBMST=$P(FB0,U,7) D
"RTN","FBAAV4",16,0)
 .; GETBT-prepare header 
"RTN","FBAAV4",17,0)
 .; NEWMSG^FBAAV01-get new message number, reset line counter, set subject line 
"RTN","FBAAV4",18,0)
 .; STORE^FBAAV01- increment line counter and store in ^XMB
"RTN","FBAAV4",19,0)
 .; FBLN -line counter; FBFEE- "FEE message" counter; FBOKTX=1 if message pending, 0 otherwise
"RTN","FBAAV4",20,0)
 .I 'FBTXT S FBTXT=1 D GETBT,NEWMSG^FBAAV01,STORE^FBAAV01
"RTN","FBAAV4",21,0)
 .; prepare and store patient MRA portion (can be more than 1)
"RTN","FBAAV4",22,0)
 .D GOT
"RTN","FBAAV4",23,0)
 D:ZMCNT>1 XMIT^FBAAV01    ;FB*3.5*153
"RTN","FBAAV4",24,0)
 Q
"RTN","FBAAV4",25,0)
 ;GETBT - prepare the "header" of the message 
"RTN","FBAAV4",26,0)
GETBT D GETNXB^FBAAUTL ;get next batch # in FBBN
"RTN","FBAAV4",27,0)
 S FBZBN=$E("0000000",$L(FBBN)+1,7)_FBBN ;FB*3.5*158
"RTN","FBAAV4",28,0)
 S FBSN=FBSN_$E("      ",$L(FBSN)+1,6)
"RTN","FBAAV4",29,0)
 S FBSTR=FBHD_"C2"_$E(DT,4,7)_$E(DT,2,3)_FBSN_FBZBN_"$"
"RTN","FBAAV4",30,0)
 Q
"RTN","FBAAV4",31,0)
 ; 
"RTN","FBAAV4",32,0)
GOT ;patient MRA portion of the message
"RTN","FBAAV4",33,0)
 N FBCCFLG,FBPATICN,FB2NDSTR
"RTN","FBAAV4",34,0)
 ; patient info;input:Y(0);output:FBDOB,FBFI,FBFLNAM,FBLNAM,FBMI,FBNAME,FBSEX,FBSSN
"RTN","FBAAV4",35,0)
 D PAT^FBAAUTL2
"RTN","FBAAV4",36,0)
 S DFN=$P(FB0,U)
"RTN","FBAAV4",37,0)
 S FBFLNAM=$$HL7NAME(DFN),FBFI="",FBMI="" ;name (FBFI,FBMI - obsolete)
"RTN","FBAAV4",38,0)
 ; demographic info, output:VADM
"RTN","FBAAV4",39,0)
 D DEM^VADPT Q:$G(VAERR)
"RTN","FBAAV4",40,0)
 S FBBD=$P(VADM(3),"^"),FBBD=$E(FBBD,4,7)_$E(FBBD,2,3) ;DOB
"RTN","FBAAV4",41,0)
 S FBBD=$S(FBBD="":"      ",1:FBBD),FBSEX=$P(VADM(5),"^"),FBSEX=$S(FBSEX="F":2,1:1)
"RTN","FBAAV4",42,0)
 S DOD=$P($P(VADM(6),"^"),".") ;DOD
"RTN","FBAAV4",43,0)
 K VADM,VAERR
"RTN","FBAAV4",44,0)
 ;S Y(0)=$S($D(^DPT(DFN,.11)):^(.11),1:"") Q:Y(0)']""
"RTN","FBAAV4",45,0)
 ;S FBADD=$E($P(Y(0),"^",1),1,21),FBADD=FBADD_$E(PAD,$L(FBADD)+1,21),FBCITY=$E($P(Y(0),"^",4),1,13),FBCITY=FBCITY_$E(PAD,$L(FBCITY)+1,13),FBSTAT="  "
"RTN","FBAAV4",46,0)
 ;S STCD=$P(Y(0),"^",5) I STCD]"" S FBSTAT=$S($D(^DIC(5,STCD,0)):$P(^(0),"^",2),1:"  ")
"RTN","FBAAV4",47,0)
 ;
"RTN","FBAAV4",48,0)
 ;address info, output: VAPA()
"RTN","FBAAV4",49,0)
 S VAPA("P")="" D ADD^VADPT Q:$G(VAERR)
"RTN","FBAAV4",50,0)
 S FBADD=$$LRJ($G(VAPA(1)),35)_$$LRJ($G(VAPA(2)),35)_$$LRJ($G(VAPA(3)),35) ;street address
"RTN","FBAAV4",51,0)
 S FBCITY=$$LRJ($G(VAPA(4)),30) ;city
"RTN","FBAAV4",52,0)
 S STCD=+VAPA(5),FBSTAT=$S($D(^DIC(5,STCD,0)):$P(^(0),"^",2),1:"  ") ;state     FB*3.5*153
"RTN","FBAAV4",53,0)
 S FBZIP=$S('+$G(VAPA(11)):VAPA(6),+VAPA(11):$P(VAPA(11),"^"),1:VAPA(6)) ;zip
"RTN","FBAAV4",54,0)
 ;check for Confidential Communication (CC) address
"RTN","FBAAV4",55,0)
 S FBCCFLG=0 I 'VAERR S FBCCFLG=$$SENDCC()
"RTN","FBAAV4",56,0)
 S FB2NDSTR=$$SECLINE()
"RTN","FBAAV4",57,0)
 S FBZIP=$TR(FBZIP,"-","")_$E("000000000",$L(FBZIP)+1,9)
"RTN","FBAAV4",58,0)
 S STCC=+VAPA(7),FBCC="000" I STCC,STCD S FBCC=$S($D(^DIC(5,STCD,1,STCC,0)):$P(^(0),"^",3),1:"000") ;county code
"RTN","FBAAV4",59,0)
 K VAPA,VAERR
"RTN","FBAAV4",60,0)
 ;
"RTN","FBAAV4",61,0)
 ; eligibility, output:VAEL()
"RTN","FBAAV4",62,0)
 D ELIG^VADPT
"RTN","FBAAV4",63,0)
 S POS=$S(+VAEL(2):+VAEL(2),1:"") ;PERIOD OF SERVICE
"RTN","FBAAV4",64,0)
 K VAEL,VAERR
"RTN","FBAAV4",65,0)
 S POS=$S(POS="":8,$D(^DIC(21,POS,0)):$P(^(0),"^",3),1:8) ;default: 8 (POST-VIETNAM)
"RTN","FBAAV4",66,0)
 S DOD=$S(DOD="":"000000",1:$E(DOD,4,7)_$E(DOD,2,3))
"RTN","FBAAV4",67,0)
 ;
"RTN","FBAAV4",68,0)
 ; service information
"RTN","FBAAV4",69,0)
 D SVC^VADPT
"RTN","FBAAV4",70,0)
 S POW=$S(+VASV(4):+VASV(4),1:""),POW=$S(POW="":2,POW=1:1,1:2) ;if prisoner of war
"RTN","FBAAV4",71,0)
 ;
"RTN","FBAAV4",72,0)
 ; remove all variables defined by VADPT
"RTN","FBAAV4",73,0)
 D KVAR^VADPT
"RTN","FBAAV4",74,0)
 ;
"RTN","FBAAV4",75,0)
 ;using pointer FEE BASIS PATIENT MRA file retrieve info from 
"RTN","FBAAV4",76,0)
 ;FEE BASIS PATIENT file#161, from its authorization multiple ^FBAAA(DA(1),1,DA
"RTN","FBAAV4",77,0)
 ;S FBAUTH=$P(^FBAA(161.26,J,0),"^",3) Q:FBAUTH']""  Q:'$D(^FBAAA(DFN,1,FBAUTH,0))  S Y(0)=^(0) ;Removed line to modify code - FB*3.5*127
"RTN","FBAAV4",78,0)
 S FBAUTH=$P(^FBAA(161.26,J,0),"^",3) I FBAUTH']"" D KILBAD Q  ;FB*3.5*153
"RTN","FBAAV4",79,0)
 I '$D(^FBAAA(DFN,1,FBAUTH,0)) D KILBAD Q  ;FB*3.5*153
"RTN","FBAAV4",80,0)
 S Y(0)=^(0) ;FB*3.5*127
"RTN","FBAAV4",81,0)
 ;authorisation FROM
"RTN","FBAAV4",82,0)
 S FBFR=$P(Y(0),"^")
"RTN","FBAAV4",83,0)
 ;authorisation TO
"RTN","FBAAV4",84,0)
 S FBTO=$P(Y(0),"^",2)
"RTN","FBAAV4",85,0)
 ;PURPOSE OF VISIT
"RTN","FBAAV4",86,0)
 S POV=$P(Y(0),"^",7),POV=$S(POV="":"",$D(^FBAA(161.82,POV,0)):$P(^(0),"^",3),1:""),POV=$S(POV]"":POV,1:"05")
"RTN","FBAAV4",87,0)
 ;TREATMENT TYPE CODE (SHORT TERM,HOME NURSING,I.D. CARD,STATE HOME)
"RTN","FBAAV4",88,0)
 S FBTT=$P(Y(0),"^",13),FBTT=$S(FBTT]"":FBTT,1:1)
"RTN","FBAAV4",89,0)
 ;
"RTN","FBAAV4",90,0)
 S FBRECT=$S(FBTT=4:"7",FBTT=2:"S",$G(POV)>28&($G(POV)<50):"C",1:2)
"RTN","FBAAV4",91,0)
 ;formatting FORM and TO dates
"RTN","FBAAV4",92,0)
 S FBFR=$E(FBFR,4,7)_$E(FBFR,2,3),FBTO=$E(FBTO,4,7)_$E(FBTO,2,3)
"RTN","FBAAV4",93,0)
 ;flag that the authorization From Date is being changed by this 
"RTN","FBAAV4",94,0)
 ;master record adjustment (see file #161.26, field #5)
"RTN","FBAAV4",95,0)
 I FBTYPE="C" S FBTO=$S(FBFDC=1:"      ",1:FBTO)
"RTN","FBAAV4",96,0)
 ;
"RTN","FBAAV4",97,0)
 I FBTT=2,"^70^71^74^"'[(U_POV_U) S POV=71
"RTN","FBAAV4",98,0)
 ;if 
"RTN","FBAAV4",99,0)
 S ZMCNT=ZMCNT+1 I ZMCNT>100 D GETBT,STORE S ZMCNT=ZMCNT+1
"RTN","FBAAV4",100,0)
 ; patch FB*3.5*13 changed format of delete MRAs to include the From Date
"RTN","FBAAV4",101,0)
 I FBTYPE="D" D  Q
"RTN","FBAAV4",102,0)
 . S FBRECT=$S(FBTT=4:"7",FBTT=2:"S",$G(POV)=31:"C",1:2)
"RTN","FBAAV4",103,0)
 . S FBSTR=FBRECT_FBTYPE_FBSN_FBSSN_FBFR_"$"
"RTN","FBAAV4",104,0)
 . D ZAP
"RTN","FBAAV4",105,0)
 I FBTYPE="R" D
"RTN","FBAAV4",106,0)
 . S FBRECT=$S(FBTT=4:"7",FBTT=2:"S",$G(POV)=31:"C",1:2)
"RTN","FBAAV4",107,0)
 . ; If Re-Instate for a State Home record type then switch to Add
"RTN","FBAAV4",108,0)
 . ;   because Central FEE does not retain deleted State Home auth.
"RTN","FBAAV4",109,0)
 . I FBRECT=7 S FBTYPE="A" Q
"RTN","FBAAV4",110,0)
 . ; For all other record types send a Re-Instate followed by a Change
"RTN","FBAAV4",111,0)
 . S FBSTR=FBRECT_FBTYPE_FBSN_FBSSN_"$"
"RTN","FBAAV4",112,0)
 . D ZAP
"RTN","FBAAV4",113,0)
 . S FBTYPE="C"
"RTN","FBAAV4",114,0)
 ; construct Add and Change record types
"RTN","FBAAV4",115,0)
 S FBTT=$S(FBMST="Y":0,1:FBTT)
"RTN","FBAAV4",116,0)
 S FBPATICN=$$ICN(DFN) ;get patient's ICN
"RTN","FBAAV4",117,0)
 S FBSTR=FBRECT_FBTYPE_FBSN_FBSSN_FBFI_FBMI_FBFLNAM_FBADD_FBCITY_FBSTAT_FBZIP_FBFR_FBTO_FBCC_FBBD_POV_" "_FBTT_FBSEX_POW_DOD_" "_POS_FBPATICN_"~"
"RTN","FBAAV4",118,0)
 ;if no CC address then send only 1st line of Add and Change record
"RTN","FBAAV4",119,0)
 I FBCCFLG=0 S FBSTR=FBSTR_"$" D ZAP Q
"RTN","FBAAV4",120,0)
 ;save 1st line of Add and Change record
"RTN","FBAAV4",121,0)
 D STORE
"RTN","FBAAV4",122,0)
 ;create 2nd line for CC address
"RTN","FBAAV4",123,0)
 S FBSTR=FB2NDSTR
"RTN","FBAAV4",124,0)
 D ZAP
"RTN","FBAAV4",125,0)
 Q
"RTN","FBAAV4",126,0)
 ;place in XMB for transmission and update FBAA(161.26
"RTN","FBAAV4",127,0)
ZAP D STORE
"RTN","FBAAV4",128,0)
 S DA=J,(DIC,DIE)="^FBAA(161.26,",T="T",DR="1///^S X=T;4///^S X=DT" D ^DIE
"RTN","FBAAV4",129,0)
 Q
"RTN","FBAAV4",130,0)
SKIP S FBRECT=$S(FBTT=2:"S",1:2),FBSTR=FBRECT_FBTYPE_FBSN_FBSSN_"$" G ZAP
"RTN","FBAAV4",131,0)
STORE I ZMCNT>100 D XMIT^FBAAV01,NEWMSG^FBAAV01 S ZMCNT=1
"RTN","FBAAV4",132,0)
 D STORE^FBAAV01
"RTN","FBAAV4",133,0)
 Q
"RTN","FBAAV4",134,0)
 ;---
"RTN","FBAAV4",135,0)
 ;Patient's INTEGRATION CONTROL NUMBER
"RTN","FBAAV4",136,0)
 ;to be implemented in future
"RTN","FBAAV4",137,0)
 ;meanwhile returns 17 spaces
"RTN","FBAAV4",138,0)
ICN(FBDFN) ;
"RTN","FBAAV4",139,0)
 Q $$LRJ("",17)
"RTN","FBAAV4",140,0)
 ;---
"RTN","FBAAV4",141,0)
 ;adds spaces on right/left or truncates to make return string FBLEN characters long
"RTN","FBAAV4",142,0)
 ;FBST- original string
"RTN","FBAAV4",143,0)
 ;FBLEN - desired length
"RTN","FBAAV4",144,0)
 ;FBCHR -character (default = SPACE)
"RTN","FBAAV4",145,0)
 ;FBSIDE - on which side to add characters (default = RIGHT)
"RTN","FBAAV4",146,0)
LRJ(FBST,FBLEN,FBCHR,FBSIDE) ;
"RTN","FBAAV4",147,0)
 N Y S $P(Y,$S($L($G(FBCHR)):FBCHR,1:" "),$S(FBLEN-$L(FBST)<0:1,1:FBLEN-$L(FBST)+1))=""
"RTN","FBAAV4",148,0)
 Q $E($S($G(FBSIDE)="L":Y_FBST,1:FBST_Y),1,FBLEN)
"RTN","FBAAV4",149,0)
 ;---
"RTN","FBAAV4",150,0)
 ;parse name components
"RTN","FBAAV4",151,0)
HL7NAME(FBDFN) ;
"RTN","FBAAV4",152,0)
 N FBAR,FBNM
"RTN","FBAAV4",153,0)
 S FBAR("FILE")=2,FBAR("IENS")=FBDFN,FBAR("FIELD")=.01
"RTN","FBAAV4",154,0)
 S FBNM=$$HLNAME^XLFNAME(.FBAR,"L30","|")
"RTN","FBAAV4",155,0)
 Q $$LRJ(FBNM,30)
"RTN","FBAAV4",156,0)
 ;
"RTN","FBAAV4",157,0)
 ;create 2nd line for CC address
"RTN","FBAAV4",158,0)
 ;VAPA should be determined
"RTN","FBAAV4",159,0)
SECLINE() ;
"RTN","FBAAV4",160,0)
 N FBSTR1
"RTN","FBAAV4",161,0)
 S FBSTR1=$$LRJ($G(VAPA(13)),35)_$$LRJ($G(VAPA(14)),35)_$$LRJ($G(VAPA(15)),35)_$$LRJ($G(VAPA(16)),30) ;street address
"RTN","FBAAV4",162,0)
 S FBSTR1=FBSTR1_$$LRJ($S(+$G(VAPA(17)):$P($G(^DIC(5,+$G(VAPA(17)),0)),"^",2),1:""),2) ;state
"RTN","FBAAV4",163,0)
 S FBSTR1=FBSTR1_$$LRJ($TR($P($G(VAPA(18)),"^",1),"-",""),9,"0") ;zip
"RTN","FBAAV4",164,0)
 S FBSTR1=FBSTR1_$$LRJ($E(+$G(VAPA(20)),4,5)_$E(+$G(VAPA(20)),6,7)_$E(+$G(VAPA(20)),2,3),6)
"RTN","FBAAV4",165,0)
 S FBSTR1=FBSTR1_$$LRJ($E(+$G(VAPA(21)),4,5)_$E(+$G(VAPA(21)),6,7)_$E(+$G(VAPA(21)),2,3),6)
"RTN","FBAAV4",166,0)
 S FBSTR1=FBSTR1_$$LRJ($P($G(^DIC(5,+$G(VAPA(17)),1,+$G(VAPA(19)),0)),"^",3),3,"0","L") ;county code
"RTN","FBAAV4",167,0)
 S FBSTR1=FBSTR1_"~$"
"RTN","FBAAV4",168,0)
 Q FBSTR1
"RTN","FBAAV4",169,0)
 ;------
"RTN","FBAAV4",170,0)
 ;SENDCC
"RTN","FBAAV4",171,0)
 ;returns 1 if CC address needs to be sent, otherwise - 0
"RTN","FBAAV4",172,0)
 ;is called after ADD^VADPT, i.e. VAPA should be defined
"RTN","FBAAV4",173,0)
SENDCC() ;
"RTN","FBAAV4",174,0)
 ;if it is currrently active
"RTN","FBAAV4",175,0)
 I $$ACTIVECC^FBAACO0() Q 1
"RTN","FBAAV4",176,0)
 N X D NOW^%DTC ;set X to TODAY
"RTN","FBAAV4",177,0)
 I ($P($G(VAPA(22,3)),"^",3)="Y"),+$G(VAPA(20))>X Q 1
"RTN","FBAAV4",178,0)
 Q 0
"RTN","FBAAV4",179,0)
 ;
"RTN","FBAAV4",180,0)
KILBAD ;DELETE mra W/ NO POINTER OR UNDEFINED POINTER TO PAT. AUTH
"RTN","FBAAV4",181,0)
 I $D(DA) S FBHDA=DA
"RTN","FBAAV4",182,0)
 S DA=J,DIK="^FBAA(161.26," D ^DIK K DIK
"RTN","FBAAV4",183,0)
 I $D(FBHDA) S DA=FBHDA K FBHDA
"RTN","FBAAV4",184,0)
 Q
"RTN","FBAAV5")
0^28^B139989645^B101588501
"RTN","FBAAV5",1,0)
FBAAV5 ;AISC/GRR - CREATE TRANSACTIONS FOR CH/CNH PAYMENTS ;11 Apr 2006  2:54 PM
"RTN","FBAAV5",2,0)
 ;;3.5;FEE BASIS;**3,55,89,98,116,108,139,123,158**;JAN 30, 1995;Build 94
"RTN","FBAAV5",3,0)
 ;;Per VA Directive 6402, this routine should not be modified.
"RTN","FBAAV5",4,0)
 ;
"RTN","FBAAV5",5,0)
 ; Reference to API $$CODEABA^ICDEX supported by ICR #5747
"RTN","FBAAV5",6,0)
 ;
"RTN","FBAAV5",7,0)
 D CKB9V^FBAAV01 I $G(FBERR) K FBERR Q
"RTN","FBAAV5",8,0)
 G:FBSTAT="S"&(FBCHB="Y")&($P(Y(0),"^",18)'="Y") ^FBAAV6
"RTN","FBAAV5",9,0)
DETCH S FBTXT=0
"RTN","FBAAV5",10,0)
 ; HIPAA 5010 - line items that have 0.00 amount paid are now required to go to Central Fee
"RTN","FBAAV5",11,0)
 F K=0:0 S K=$O(^FBAAI("AC",J,K)) Q:K'>0  S Y(0)=$G(^FBAAI(K,0)),Y(2)=$G(^(2)),Y(3)=$G(^(3)),Y(5)=$G(^(5)),Y(7)=$G(^(7)) I Y(0)]"" D
"RTN","FBAAV5",12,0)
 .N FBPICN,FBY
"RTN","FBAAV5",13,0)
 .S FBPICN=K
"RTN","FBAAV5",14,0)
 .S FBY=$S($P(Y(2),U,2):$P(Y(2),U,2),1:$P(Y(0),U,2))_U_+$P(Y(2),U,3)
"RTN","FBAAV5",15,0)
 .I 'FBTXT S FBTXT=1 D NEWMSG^FBAAV01,STORE^FBAAV01,UPD^FBAAV0
"RTN","FBAAV5",16,0)
 .D GOT
"RTN","FBAAV5",17,0)
 D:FBTXT XMIT^FBAAV01 Q
"RTN","FBAAV5",18,0)
GOT ; process an inpatient invoice
"RTN","FBAAV5",19,0)
 N DFN,FBADJ,FBADJA,FBADJR,FBADMIT,FBAUTHF,FBCDAYS,FBDISDT,FBDISTY,FBNPI
"RTN","FBAAV5",20,0)
 N FBDRG,FBIENS,FBPA,FBPNAMX,FBVMID,FBX,FBFPPSID,FBCRARC,FBADJG,FBRRC1,FBRRC2
"RTN","FBAAV5",21,0)
 N FB4LN,FBADMTDX,FBCSVDT,FBCSID,FBEDIF,FBCNTRN,FBAUTHNUM,FBDRGWT,FBBILAMT
"RTN","FBAAV5",22,0)
 N FBIA,FBDODINV,FBCLAMT,FBPYMTH
"RTN","FBAAV5",23,0)
 S FBIENS=K_","
"RTN","FBAAV5",24,0)
 S FBCSVDT=$$FRDTINV^FBCSV1(K)
"RTN","FBAAV5",25,0)
 I '$L($G(FBAASN)) D STATION^FBAAUTL
"RTN","FBAAV5",26,0)
 S FBPSA=$$PSA(+$P(Y(0),U,20),+$G(FBAASN)) I $L(+FBPSA)'=3 S FBPSA=999
"RTN","FBAAV5",27,0)
 S FBPAYT=$P(Y(0),"^",13),FBPAYT=$S(FBPAYT]"":FBPAYT,1:"V")
"RTN","FBAAV5",28,0)
 S L=$P(Y(0),"^",3)
"RTN","FBAAV5",29,0)
 S FBVID=$S($D(^FBAAV(L,0)):$P(^(0),"^",2),1:"")
"RTN","FBAAV5",30,0)
 ;
"RTN","FBAAV5",31,0)
 ; FB*3.5*123 - gather and format IPAC agreement ID and DoD invoice# for federal vendors
"RTN","FBAAV5",32,0)
 S FBIA=+$P(Y(5),U,10)                                   ; IPAC vendor agreement pointer (FB*3.5*123)
"RTN","FBAAV5",33,0)
 S FBIA=$S(FBIA:$P($G(^FBAA(161.95,FBIA,0)),U,1),1:"")   ; IPAC external agreement ID# or ""
"RTN","FBAAV5",34,0)
 S FBDODINV=$P(Y(5),U,7)                                 ; DoD invoice#
"RTN","FBAAV5",35,0)
 I $$IPACREQD^FBAAMP(L) D
"RTN","FBAAV5",36,0)
 . N FBIPIEN
"RTN","FBAAV5",37,0)
 . ;
"RTN","FBAAV5",38,0)
 . ; If IPAC is required, but IPAC ID is not on file, and only 1 active IPAC agreement exists, then save it/use it
"RTN","FBAAV5",39,0)
 . I FBIA="" S FBIA=$$IPACID^FBAAMP(L,.FBIPIEN) I FBIA'="",FBIPIEN D
"RTN","FBAAV5",40,0)
 .. N FBIAFDA
"RTN","FBAAV5",41,0)
 .. S FBIAFDA(162.5,FBIENS,87)=FBIPIEN    ; ipac vendor agreement ien
"RTN","FBAAV5",42,0)
 .. D FILE^DIE("","FBIAFDA")              ; update the database
"RTN","FBAAV5",43,0)
 .. Q
"RTN","FBAAV5",44,0)
 . I FBIA="" S FBIA="9999999999"          ; if still not found, send error condition to Central Fee
"RTN","FBAAV5",45,0)
 . ;
"RTN","FBAAV5",46,0)
 . ; if IPAC is required, but DoD invoice# is not on file, then attempt to use PATIENT CONTROL NUMBER (field# 55)
"RTN","FBAAV5",47,0)
 . I FBDODINV="" S FBDODINV=$P(Y(2),U,11) I FBDODINV'="" D
"RTN","FBAAV5",48,0)
 .. N FBIAFDA
"RTN","FBAAV5",49,0)
 .. S FBIAFDA(162.5,FBIENS,86)=FBDODINV   ; DoD invoice# field
"RTN","FBAAV5",50,0)
 .. D FILE^DIE("","FBIAFDA")              ; update the database
"RTN","FBAAV5",51,0)
 .. Q
"RTN","FBAAV5",52,0)
 . I FBDODINV="" S FBDODINV="9999999999999999999999"  ; if still not found, send error condition to Central Fee
"RTN","FBAAV5",53,0)
 . Q
"RTN","FBAAV5",54,0)
 ;
"RTN","FBAAV5",55,0)
 S FBIA=$$LJ^XLFSTR(FBIA,"10T")                          ; format IPAC agreement ID to 10 characters
"RTN","FBAAV5",56,0)
 S FBDODINV=$$LJ^XLFSTR(FBDODINV,"22T")                  ; format DoD invoice# to 22 characters
"RTN","FBAAV5",57,0)
 ;
"RTN","FBAAV5",58,0)
 S FBNPI=$$EN^FBNPILK(L)
"RTN","FBAAV5",59,0)
 S FBVID=FBVID_$E(PAD,$L(FBVID)+1,11)
"RTN","FBAAV5",60,0)
 S:FBPAYT="R" FBVID=$E(PAD,1,11)
"RTN","FBAAV5",61,0)
 S FBVMID=$S($D(^FBAAV(L,0)):$P(^(0),"^",17),1:"")
"RTN","FBAAV5",62,0)
 S FBVMID=$E(PAD,$L(FBVMID)+1,6)_FBVMID
"RTN","FBAAV5",63,0)
 S POV=$P(Y(0),"^",18)
"RTN","FBAAV5",64,0)
 S POV=$S(POV']"":"",POV="A":6,POV="B":7,POV="C":8,POV="D":9,POV="E":10,1:POV),POV=$S(POV']"":40,$D(^FBAA(161.82,POV,0)):$P(^(0),"^",3),1:40),FBPOV=POV
"RTN","FBAAV5",65,0)
 S FBPATT=$P(Y(0),"^",19),FBPATT=$S(FBPATT]"":FBPATT,1:10)
"RTN","FBAAV5",66,0)
 S FBFTD=$$AUSDT^FBAAV3($P(Y(0),"^",6)) ; from treatment date
"RTN","FBAAV5",67,0)
 S FBTTD=$$AUSDT^FBAAV3($P(Y(0),"^",7)) ; to treatment date
"RTN","FBAAV5",68,0)
 S FBSUSP=$P(Y(0),"^",11),FBSUSP=$S(FBSUSP="":" ",$D(^FBAA(161.27,FBSUSP,0)):$P(^(0),"^",1),1:" ")
"RTN","FBAAV5",69,0)
 S FBINVN=$P(Y(0),"^",1)
"RTN","FBAAV5",70,0)
 S FBINVN=$E("000000000",$L(FBINVN)+1,9)_FBINVN
"RTN","FBAAV5",71,0)
 S FBDIN=$$AUSDT^FBAAV3($P(Y(0),"^",2)) ; invoice date rec'd
"RTN","FBAAV5",72,0)
 S FBAP=$$AUSAMT^FBAAV3($P(Y(0),"^",9),9) ;AMOUNT PAID (#8)
"RTN","FBAAV5",73,0)
 S FBAC=$$AUSAMT^FBAAV3($P(Y(0),"^",8),9) ;AMOUNT CLAIMED (#7)
"RTN","FBAAV5",74,0)
 S FBPA=$$AUSAMT^FBAAV3($P(Y(0),"^",26),9) ;NVH PRICER AMOUNT (#26)
"RTN","FBAAV5",75,0)
 S FBDRG=$P(Y(0),"^",24),FBDRG=$E(PAD,$L(FBDRG)+1,4)_FBDRG
"RTN","FBAAV5",76,0)
 S FBAUTHF=$S($P(Y(0),U,5)["FB583":"U",1:"A") ; auth/unauth flag
"RTN","FBAAV5",77,0)
 S FBCSID=$$LJ^XLFSTR($P(Y(2),"^",11),20," ") ; patient acct #
"RTN","FBAAV5",78,0)
 S FBDRGWT=$P(Y(2),U,12),FBDRGWT=$$AUSNUM^FBAAV3(FBDRGWT,4,8) ;DRG WEIGHT
"RTN","FBAAV5",79,0)
 S FBPYMTH=$P(Y(2),U,16),FBPYMTH=$$PYMTH^FBAAV0(FBPYMTH)  ;PAYMENT METHODOLOGY
"RTN","FBAAV5",80,0)
 S FBPYMTH=$$RJ^XLFSTR(FBPYMTH,1," ")
"RTN","FBAAV5",81,0)
 S FBBILAMT=$P(Y(0),U,22),FBBILAMT=$$AUSAMT^FBAAV3(FBBILAMT,10,1) ;BILLED CHARGES
"RTN","FBAAV5",82,0)
 S FBFPPSID=$$RJ^XLFSTR($P(Y(3),U),"12T",0) ; FPPS CLAIM ID
"RTN","FBAAV5",83,0)
 S FBAUTHNUM=$P(Y(7),U) I FBAUTHNUM']"" S FBAUTHNUM=$$AUTHIP(FBIENS)   ;AUTHORIZATION NUMBER
"RTN","FBAAV5",84,0)
 S FBAUTHNUM=$$LJ^XLFSTR(FBAUTHNUM,"29T"," ")
"RTN","FBAAV5",85,0)
 S FBCLAMT=$P(Y(7),U,2),FBCLAMT=$$AUSAMT^FBAAV3(FBCLAMT,9)  ;CLAIM LEVEL ALLOWED AMOUNT
"RTN","FBAAV5",86,0)
 S FBADMTDX=$P(Y(5),"^",9) ; admitting Dx pointer
"RTN","FBAAV5",87,0)
 D
"RTN","FBAAV5",88,0)
 . N FBCNTRP
"RTN","FBAAV5",89,0)
 . S FBCNTRP=$P(Y(5),"^",8)
"RTN","FBAAV5",90,0)
 . S FBCNTRN=$S(FBCNTRP:$P($G(^FBAA(161.43,FBCNTRP,0)),"^"),1:"")
"RTN","FBAAV5",91,0)
 . S FBCNTRN=$$LJ^XLFSTR(FBCNTRN,20," ") ; contract number
"RTN","FBAAV5",92,0)
 S FBEDIF=$S($P($G(^FBAAI(K,3)),"^")]"":"Y",1:" ") ;EDI flag
"RTN","FBAAV5",93,0)
 ;
"RTN","FBAAV5",94,0)
 K FBDX
"RTN","FBAAV5",95,0)
 S FBDX(0)="       " ; initialize admitting Dx transmitted value to 7 spaces
"RTN","FBAAV5",96,0)
 F M=1:1:25 S FBDX(M)="        "  ;8 spaces
"RTN","FBAAV5",97,0)
 I FBADMTDX D
"RTN","FBAAV5",98,0)
 . N FBX
"RTN","FBAAV5",99,0)
 . S FBX=$$ICD9^FBCSV1(FBADMTDX,FBCSVDT)
"RTN","FBAAV5",100,0)
 . Q:FBX=""
"RTN","FBAAV5",101,0)
 . ;DEM;139 ICD-10 Project - decimal is stripped only from ICD-10 diagnosis codes and not ICD-9 diagnosis codes.
"RTN","FBAAV5",102,0)
 . I $$CODEABA^ICDEX(FBX,80,30)>0 S:FBX["." FBX=$P(FBX,".",1)_$P(FBX,".",2)  ;DEM;139 ICD-10 Project
"RTN","FBAAV5",103,0)
 . S FBDX(0)=FBX_$E("       ",$L(FBX)+1,7)
"RTN","FBAAV5",104,0)
 S FBYDX=$G(^FBAAI(K,"DX")),FBYPOA=$G(^FBAAI(K,"POA"))
"RTN","FBAAV5",105,0)
 F M=1:1:25 Q:$P(FBYDX,"^",M)=""  D
"RTN","FBAAV5",106,0)
 . S FBDX(M)=$$DX($P(FBYDX,"^",M),FBCSVDT,$P(FBYPOA,"^",M))
"RTN","FBAAV5",107,0)
 K FBYDX,FBYPOA
"RTN","FBAAV5",108,0)
 ;
"RTN","FBAAV5",109,0)
 K FBPRC
"RTN","FBAAV5",110,0)
 F M=1:1:25 S FBPRC(M)="       "  ;7 SPACES
"RTN","FBAAV5",111,0)
 S FBYPROC=$G(^FBAAI(K,"PROC"))
"RTN","FBAAV5",112,0)
 F M=1:1:25 Q:$P(FBYPROC,"^",M)=""  D
"RTN","FBAAV5",113,0)
 . S FBPRC(M)=$$PROC($P(FBYPROC,"^",M),FBCSVDT)
"RTN","FBAAV5",114,0)
 K FBYPROC
"RTN","FBAAV5",115,0)
 ;
"RTN","FBAAV5",116,0)
 S DFN=$P(Y(0),"^",4)
"RTN","FBAAV5",117,0)
 ; Note: Prior to the following line Y(0) = the 0 node of file 162.5
"RTN","FBAAV5",118,0)
 ;After the line Y(0) will equal the 0 node of file #2
"RTN","FBAAV5",119,0)
 S VAPA("P")="",Y(0)=$S($D(^DPT(DFN,0)):^(0),1:"")
"RTN","FBAAV5",120,0)
 D PAT^FBAAUTL2
"RTN","FBAAV5",121,0)
 ; obtain date of birth, must follow call to PAT^FBAAUTL2 to overwrite 
"RTN","FBAAV5",122,0)
 ; the value returned from it
"RTN","FBAAV5",123,0)
 S FBDOB=$$AUSDT^FBAAV3($P(Y(0),"^",3))
"RTN","FBAAV5",124,0)
 D ADD^VADPT
"RTN","FBAAV5",125,0)
 S FBPNAMX=$$HL7NAME^FBAAV2(DFN) ; patient name
"RTN","FBAAV5",126,0)
 S FBST=$S($P(VAPA(5),"^",1)="":"  ",$D(^DIC(5,$P(VAPA(5),"^",1),0)):$P(^(0),"^",2),1:"  ")
"RTN","FBAAV5",127,0)
 I $L(FBST)>2 S FBST="**"
"RTN","FBAAV5",128,0)
 S:$L(FBST)'=2 FBST=$E(PAD,$L(FBST)+1,2)_FBST
"RTN","FBAAV5",129,0)
 S FBCTY=$S($P(VAPA(7),"^",1)="":"   ",FBST="  ":"   ",$D(^DIC(5,$P(VAPA(5),"^",1),1,$P(VAPA(7),"^",1),0)):$P(^(0),"^",3),1:"   ")
"RTN","FBAAV5",130,0)
 I $L(FBCTY)'=3 S FBCTY=$E("000",$L(FBCTY)+1,3)_FBCTY
"RTN","FBAAV5",131,0)
 S FBZIP=$S('+$G(VAPA(11)):VAPA(6),+VAPA(11):$P(VAPA(11),U),1:VAPA(6)),FBZIP=$TR(FBZIP,"-","")_$E("000000000",$L(FBZIP)+1,9)
"RTN","FBAAV5",132,0)
 S FBADMIT=$$AUSDT^FBAAV3($P($$B9ADMIT(FBIENS),".")) ; admission date
"RTN","FBAAV5",133,0)
 ; get and format discharge date and type
"RTN","FBAAV5",134,0)
 S FBX=$$B9DISCHG(FBIENS)
"RTN","FBAAV5",135,0)
 S FBDISDT=$$AUSDT^FBAAV3($P($P(FBX,U),".")) ; discharge date
"RTN","FBAAV5",136,0)
 S FBDISTY=$$RJ^XLFSTR($P(FBX,U,2),3,0) ; discharge type
"RTN","FBAAV5",137,0)
 K FBX
"RTN","FBAAV5",138,0)
 ; get volume indicator (covered days)
"RTN","FBAAV5",139,0)
 S FBCDAYS=$$RJ^XLFSTR($$GET1^DIQ(162.5,FBIENS,54),5,"0")
"RTN","FBAAV5",140,0)
 ; obtain and format the adjustment codes and amounts
"RTN","FBAAV5",141,0)
 ; get and format adjustment reason codes and amounts (if any)
"RTN","FBAAV5",142,0)
 D CRARC(FBIENS,.FBCRARC)
"RTN","FBAAV5",143,0)
 ;
"RTN","FBAAV5",144,0)
 ; determine if 4th line needed (set FB4LN =1 when true)
"RTN","FBAAV5",145,0)
 S FB4LN=1 I FBDX(11)="        ",FBPRC(11)="       " S FB4LN=0
"RTN","FBAAV5",146,0)
 ;
"RTN","FBAAV5",147,0)
 ; build 1st line
"RTN","FBAAV5",148,0)
 S FBSTR=9_FBAASN_FBSSN_FBPAYT_FBPNAMX_FBVID_"  "_FBAP_FBAAON_FBSUSP
"RTN","FBAAV5",149,0)
 S FBSTR=FBSTR_FBPOV_FBPATT_FBFTD_FBTTD_FBDIN_FBINVN_FBVMID
"RTN","FBAAV5",150,0)
 S FBSTR=FBSTR_$E(PAD,1,33)_FBST_FBCTY_FBZIP ; reserved for foreign addr
"RTN","FBAAV5",151,0)
 S FBSTR=FBSTR_FBPSA_$P(FBY,U,2)_$E(PAD,1,14)
"RTN","FBAAV5",152,0)
 F I=1:1:5 S FBSTR=FBSTR_FBDX(I)
"RTN","FBAAV5",153,0)
 S FBSTR=FBSTR_"~"
"RTN","FBAAV5",154,0)
 D STORE^FBAAV01
"RTN","FBAAV5",155,0)
 ;
"RTN","FBAAV5",156,0)
 ; build 2nd line
"RTN","FBAAV5",157,0)
 S FBSTR=$$PADZ^FBAAV01(FBPICN,23)_$$AUSDT^FBAAV3(+FBY)
"RTN","FBAAV5",158,0)
 F I=1:1:5 S FBSTR=FBSTR_FBPRC(I)
"RTN","FBAAV5",159,0)
 S FBADJR=$S($D(FBCRARC(1)):$P(FBCRARC(1),U,2),1:""),FBADJR=$$RJ^XLFSTR(FBADJR,5," ")
"RTN","FBAAV5",160,0)
 S FBADJA=$S($D(FBCRARC(1)):$P(FBCRARC(1),U,3),1:0),FBADJA=$$AUSAMT^FBAAV3(FBADJA,10,1)
"RTN","FBAAV5",161,0)
 S FBSTR=FBSTR_FBAC_FBPA_FBDRG_" "_FBADMIT_FBDISDT_FBDOB_FBDISTY_FBCDAYS_FBAUTHF_FBADJR_FBADJA_FBNPI_FBDX(0)_FBCSID_FBEDIF_FBCNTRN
"RTN","FBAAV5",162,0)
 S FBSTR=FBSTR_FBIA_FBDODINV_"~"                          ; IPAC data from FB*3.5*123
"RTN","FBAAV5",163,0)
 D STORE^FBAAV01
"RTN","FBAAV5",164,0)
 ;
"RTN","FBAAV5",165,0)
 ; build 3rd line
"RTN","FBAAV5",166,0)
 S FBSTR=""
"RTN","FBAAV5",167,0)
 F I=6:1:10 S FBSTR=FBSTR_FBDX(I)
"RTN","FBAAV5",168,0)
 F I=6:1:10 S FBSTR=FBSTR_FBPRC(I)
"RTN","FBAAV5",169,0)
 S FBSTR=FBSTR_"~"
"RTN","FBAAV5",170,0)
 D STORE^FBAAV01
"RTN","FBAAV5",171,0)
 ;
"RTN","FBAAV5",172,0)
 ; build 4th line
"RTN","FBAAV5",173,0)
 S FBSTR=""
"RTN","FBAAV5",174,0)
 I FB4LN D
"RTN","FBAAV5",175,0)
 . F I=11:1:25 S FBSTR=FBSTR_FBDX(I)
"RTN","FBAAV5",176,0)
 . F I=11:1:25 S FBSTR=FBSTR_FBPRC(I)
"RTN","FBAAV5",177,0)
 S FBSTR=FBSTR_"~"
"RTN","FBAAV5",178,0)
 D STORE^FBAAV01
"RTN","FBAAV5",179,0)
 ;
"RTN","FBAAV5",180,0)
 ; build 5th line FB*3.5*158
"RTN","FBAAV5",181,0)
 S FBSTR=FBFPPSID
"RTN","FBAAV5",182,0)
 S FBSTR=FBSTR_FBAUTHNUM ;Authorization Number
"RTN","FBAAV5",183,0)
 S FBSTR=FBSTR_FBCLAMT   ;Claim Level Allowed Amount
"RTN","FBAAV5",184,0)
 S FBADJG=$S($D(FBCRARC(1)):$P(FBCRARC(1),U),1:""),FBADJG=$$RJ^XLFSTR(FBADJG,2," ")
"RTN","FBAAV5",185,0)
 S FBRRC1=$S($D(FBCRARC(1)):$P(FBCRARC(1),U,4),1:""),FBRRC1=$$RJ^XLFSTR(FBRRC1,6," ")
"RTN","FBAAV5",186,0)
 S FBRRC2=$S($D(FBCRARC(1)):$P(FBCRARC(1),U,5),1:""),FBRRC2=$$RJ^XLFSTR(FBRRC2,6," ")
"RTN","FBAAV5",187,0)
 S FBSTR=FBSTR_FBADJG_FBRRC1_FBRRC2
"RTN","FBAAV5",188,0)
 ; 
"RTN","FBAAV5",189,0)
 F FBI=2:1:5 D
"RTN","FBAAV5",190,0)
 . S FBADJG=$S($D(FBCRARC(FBI)):$P(FBCRARC(FBI),U),1:""),FBADJG=$$RJ^XLFSTR(FBADJG,2," ")
"RTN","FBAAV5",191,0)
 . S FBADJR=$S($D(FBCRARC(FBI)):$P(FBCRARC(FBI),U,2),1:""),FBADJR=$$RJ^XLFSTR(FBADJR,5," ")
"RTN","FBAAV5",192,0)
 . S FBRRC1=$S($D(FBCRARC(FBI)):$P(FBCRARC(FBI),U,4),1:""),FBRRC1=$$RJ^XLFSTR(FBRRC1,6," ")
"RTN","FBAAV5",193,0)
 . S FBRRC2=$S($D(FBCRARC(FBI)):$P(FBCRARC(FBI),U,5),1:""),FBRRC2=$$RJ^XLFSTR(FBRRC2,6," ")
"RTN","FBAAV5",194,0)
 . S FBADJA=$S($D(FBCRARC(FBI)):$P(FBCRARC(FBI),U,3),1:0),FBADJA=$$AUSAMT^FBAAV3(FBADJA,10,1)
"RTN","FBAAV5",195,0)
 . S FBSTR=FBSTR_FBADJG_FBADJR_FBRRC1_FBRRC2_FBADJA
"RTN","FBAAV5",196,0)
 ;
"RTN","FBAAV5",197,0)
 S FBSTR=FBSTR_FBDRGWT_FBBILAMT_FBPYMTH
"RTN","FBAAV5",198,0)
 S FBSTR=FBSTR_" "  ;Additional Payment Indicator
"RTN","FBAAV5",199,0)
 S FBSTR=FBSTR_" "  ;Additional Payment Type
"RTN","FBAAV5",200,0)
 S FBSTR=FBSTR_$$PADZ^FBAAV01(0,30)  ;Parent Internal Control Number
"RTN","FBAAV5",201,0)
 S FBSTR=FBSTR_"~$"
"RTN","FBAAV5",202,0)
 D STORE^FBAAV01
"RTN","FBAAV5",203,0)
 Q
"RTN","FBAAV5",204,0)
 ;
"RTN","FBAAV5",205,0)
AUTHIP(IENS) ;
"RTN","FBAAV5",206,0)
 ;
"RTN","FBAAV5",207,0)
 N REFNUM
"RTN","FBAAV5",208,0)
 S REFNUM=""
"RTN","FBAAV5",209,0)
 D GETS^DIQ(162.5,IENS,"4","I","FB")
"RTN","FBAAV5",210,0)
 I $D(FB),FB(162.5,IENS,4,"I")["FB7078" D
"RTN","FBAAV5",211,0)
 . S FB7078=$P(FB(162.5,IENS,4,"I"),";")
"RTN","FBAAV5",212,0)
 . S:$D(^FB7078(FB7078,0)) REFNUM=$P(^FB7078(FB7078,0),U)
"RTN","FBAAV5",213,0)
 Q REFNUM
"RTN","FBAAV5",214,0)
 ;
"RTN","FBAAV5",215,0)
PSA(X,Y) ;call to set default Primary Service Area (PSA)
"RTN","FBAAV5",216,0)
 ;to send to Austin.
"RTN","FBAAV5",217,0)
 ;X = pointer to the institution file
"RTN","FBAAV5",218,0)
 ;Y = default if unable to determine station number in file 4
"RTN","FBAAV5",219,0)
 ;call returns the 3 digit station number only
"RTN","FBAAV5",220,0)
 ;if Y undef return '0'
"RTN","FBAAV5",221,0)
 I '$G(Y) S Y=0
"RTN","FBAAV5",222,0)
 Q $S('X:+Y,$E($P($G(^DIC(4,+X,99)),U),1,3)'?3N:+Y,1:$E($P($G(^(99)),U),1,3))
"RTN","FBAAV5",223,0)
 ;
"RTN","FBAAV5",224,0)
B9ADMIT(FBIENS) ; Determine Admission Date for a B9 payment
"RTN","FBAAV5",225,0)
 ; input
"RTN","FBAAV5",226,0)
 ;   FBIENS
"RTN","FBAAV5",227,0)
 ; returns admission date in internal FileMan format or null value
"RTN","FBAAV5",228,0)
 N FB7078,FBRET
"RTN","FBAAV5",229,0)
 S FBRET=""  ;NULL
"RTN","FBAAV5",230,0)
 ;
"RTN","FBAAV5",231,0)
 S FB7078=$$GET1^DIQ(162.5,FBIENS,4,"I") ; associated 7078/583
"RTN","FBAAV5",232,0)
 ;
"RTN","FBAAV5",233,0)
 ; if invoice points to a 7078 authorization then get date from the 7078
"RTN","FBAAV5",234,0)
 I $P(FB7078,";",2)="FB7078(" D
"RTN","FBAAV5",235,0)
 . N FBY
"RTN","FBAAV5",236,0)
 . S FBY=$G(^FB7078(+FB7078,0))
"RTN","FBAAV5",237,0)
 . ; if fee program is civil hospital then return 7078 date of admission
"RTN","FBAAV5",238,0)
 . I $P(FBY,U,11)=6 S FBRET=$P(FBY,U,15)
"RTN","FBAAV5",239,0)
 . ; if fee program is CNH then return 7078 authorized from date
"RTN","FBAAV5",240,0)
 . I $P(FBY,U,11)=7 S FBRET=$P(FBY,U,4)
"RTN","FBAAV5",241,0)
 ;
"RTN","FBAAV5",242,0)
 ; if invoice points to an unauthorized claim then use the treatment from
"RTN","FBAAV5",243,0)
 ;   date on the unauthorized claim
"RTN","FBAAV5",244,0)
 I $P(FB7078,";",2)="FB583(" D
"RTN","FBAAV5",245,0)
 . N FBY
"RTN","FBAAV5",246,0)
 . S FBY=$G(^FB583(+FB7078,0))
"RTN","FBAAV5",247,0)
 . S FBRET=$P(FBY,U,5)
"RTN","FBAAV5",248,0)
 ;
"RTN","FBAAV5",249,0)
 ; return the result
"RTN","FBAAV5",250,0)
 Q FBRET
"RTN","FBAAV5",251,0)
 ;
"RTN","FBAAV5",252,0)
B9DISCHG(FBIENS) ; Determine Discharge Date and Type for a B9 payment
"RTN","FBAAV5",253,0)
 ; input
"RTN","FBAAV5",254,0)
 ;   FBIENS - Invoice IEN (file 162.5) with trailing comma
"RTN","FBAAV5",255,0)
 ; returns discharge date in internal FileMan format or null value and
"RTN","FBAAV5",256,0)
 ; discharge type or null value
"RTN","FBAAV5",257,0)
 N FB7078,FBDISDT,FBDISTY
"RTN","FBAAV5",258,0)
 S (FBDISDT,FBDISTY)=""
"RTN","FBAAV5",259,0)
 ;
"RTN","FBAAV5",260,0)
 S FB7078=$$GET1^DIQ(162.5,FBIENS,4,"I") ; associated 7078/583
"RTN","FBAAV5",261,0)
 ;
"RTN","FBAAV5",262,0)
 ; if invoice points to an unauthorized claim then use the treatment to
"RTN","FBAAV5",263,0)
 ;   date on the unauthorized claim
"RTN","FBAAV5",264,0)
 I $P(FB7078,";",2)="FB583(" D
"RTN","FBAAV5",265,0)
 . N FBY
"RTN","FBAAV5",266,0)
 . S FBY=$G(^FB583(+FB7078,0))
"RTN","FBAAV5",267,0)
 . S FBDISDT=$P(FBY,U,6)
"RTN","FBAAV5",268,0)
 . S FBDISTY=$$GET1^DIQ(162.5,FBIENS,"6.5:1") ; discharge type
"RTN","FBAAV5",269,0)
 ;
"RTN","FBAAV5",270,0)
 ; if invoice points to a 7078 authorization then get date from the 7078
"RTN","FBAAV5",271,0)
 I $P(FB7078,";",2)="FB7078(" D
"RTN","FBAAV5",272,0)
 . N FBY
"RTN","FBAAV5",273,0)
 . S FBY=$G(^FB7078(+FB7078,0))
"RTN","FBAAV5",274,0)
 . ;
"RTN","FBAAV5",275,0)
 . ; if fee program is civil hospital then return 7078 date of discharge
"RTN","FBAAV5",276,0)
 . I $P(FBY,U,11)=6 D
"RTN","FBAAV5",277,0)
 . . S FBDISDT=$P(FBY,U,16) ; discharge date
"RTN","FBAAV5",278,0)
 . . S FBDISTY=$$GET1^DIQ(162.5,FBIENS,"6.5:1") ; discharge type
"RTN","FBAAV5",279,0)
 . ;
"RTN","FBAAV5",280,0)
 . ; if fee program is CNH then get date & type from CNH activity file
"RTN","FBAAV5",281,0)
 . I $P(FBY,U,11)=7 D
"RTN","FBAAV5",282,0)
 . . N DFN,FBADMIT,FBADMITR,FBACTA,FBAUTHP,FBDA,FBDTR
"RTN","FBAAV5",283,0)
 . . S DFN=$P(FBY,U,3) ; patient IEN
"RTN","FBAAV5",284,0)
 . . S FBADMIT=$P($P(FBY,U,4),".") ; CNH admission date
"RTN","FBAAV5",285,0)
 . . S FBAUTHP=+$O(^FBAAA("AG",FB7078,DFN,0)) ; authorization 'pointer'
"RTN","FBAAV5",286,0)
 . . ;
"RTN","FBAAV5",287,0)
 . . ; find the admission entry in CNH ACTIVITY file   
"RTN","FBAAV5",288,0)
 . . S FBACTA=0 ; init the admission activity ien
"RTN","FBAAV5",289,0)
 . . S FBADMITR=9999999-FBADMIT ; reverse admission date
"RTN","FBAAV5",290,0)
 . . S FBDTR=9999999-$$FMADD^XLFDT(FBADMIT,1) ; start loop
"RTN","FBAAV5",291,0)
 . . F  S FBDTR=$O(^FBAACNH("AF",DFN,FBDTR)) Q:'FBDTR!($P(FBDTR,".")>FBADMITR)  D  Q:FBACTA
"RTN","FBAAV5",292,0)
 . . . S FBDA=0 F  S FBDA=$O(^FBAACNH("AF",DFN,FBDTR,FBDA)) Q:'FBDA  D
"RTN","FBAAV5",293,0)
 . . . . S FBY=$G(^FBAACNH(FBDA,0))
"RTN","FBAAV5",294,0)
 . . . . I $P(FBY,U,3)="A",$P(FBY,U,10)=FBAUTHP S FBACTA=FBDA ; found it
"RTN","FBAAV5",295,0)
 . . Q:'FBACTA  ; could not find the admission activity
"RTN","FBAAV5",296,0)
 . . ;
"RTN","FBAAV5",297,0)
 . . ; get date from associated discharge (if any) in CNH ACTIVITY file
"RTN","FBAAV5",298,0)
 . . S FBDA=" "
"RTN","FBAAV5",299,0)
 . . F  S FBDA=$O(^FBAACNH("AC",FBACTA,FBDA),-1) Q:FBDA'>0  D  Q:FBDISDT
"RTN","FBAAV5",300,0)
 . . . S FBY=$G(^FBAACNH(FBDA,0))
"RTN","FBAAV5",301,0)
 . . . I $P(FBY,U,3)="D" D
"RTN","FBAAV5",302,0)
 . . . . S FBDISDT=$P($P(FBY,U),".")
"RTN","FBAAV5",303,0)
 . . . . S FBDISTY=$P(FBY,U,8)
"RTN","FBAAV5",304,0)
 . . . . I FBDISTY'="" S FBDISTY=FBDISTY+100
"RTN","FBAAV5",305,0)
 ;
"RTN","FBAAV5",306,0)
 ; return the result
"RTN","FBAAV5",307,0)
 Q FBDISDT_"^"_FBDISTY
"RTN","FBAAV5",308,0)
 ;
"RTN","FBAAV5",309,0)
DX(FBDX,FBDATE,FBPOA) ; format diagnosis & POA for B9
"RTN","FBAAV5",310,0)
 ; Input
"RTN","FBAAV5",311,0)
 ;   FBDX   = pointer to file 80 (ICD diagnosis)
"RTN","FBAAV5",312,0)
 ;   FBDATE = fileman date
"RTN","FBAAV5",313,0)
 ;   FBPOA  = (optional) poiner to file 161.94 (present on admission)
"RTN","FBAAV5",314,0)
 ; Returns formatted string of 8 characters
"RTN","FBAAV5",315,0)
 N FBRET,FBX,FBX2
"RTN","FBAAV5",316,0)
 S FBRET="        "
"RTN","FBAAV5",317,0)
 I FBDX D
"RTN","FBAAV5",318,0)
 . S FBX=$$ICD9^FBCSV1(FBDX,FBDATE)
"RTN","FBAAV5",319,0)
 . Q:FBX=""
"RTN","FBAAV5",320,0)
 . ;DEM;139 ICD-10 Project - decimal is stripped only from ICD-10 diagnosis codes and not ICD-9 diagnosis codes.
"RTN","FBAAV5",321,0)
 . I $$CODEABA^ICDEX(FBX,80,30)>0 S:FBX["." FBX=$P(FBX,".",1)_$P(FBX,".",2)  ;DEM;139 ICD-10 Project
"RTN","FBAAV5",322,0)
 . S FBX=FBX_$E("       ",$L(FBX)+1,7)
"RTN","FBAAV5",323,0)
 . S FBX2=$S($G(FBPOA):$P($G(^FB(161.94,FBPOA,0)),"^"),1:"")
"RTN","FBAAV5",324,0)
 . S:FBX2="" FBX2=" "
"RTN","FBAAV5",325,0)
 . S FBRET=FBX_FBX2
"RTN","FBAAV5",326,0)
 Q FBRET
"RTN","FBAAV5",327,0)
 ;
"RTN","FBAAV5",328,0)
PROC(FBPROC,FBDATE) ; format procedure for B9
"RTN","FBAAV5",329,0)
 ; Input
"RTN","FBAAV5",330,0)
 ;   FBPROC = pointer to file 80.1 (ICD operation/procedure)
"RTN","FBAAV5",331,0)
 ;   FBDATE = fileman date
"RTN","FBAAV5",332,0)
 ; Returns formatted string of 7 characters
"RTN","FBAAV5",333,0)
 N FBRET,FBX
"RTN","FBAAV5",334,0)
 S FBRET="       "
"RTN","FBAAV5",335,0)
 I FBPROC D
"RTN","FBAAV5",336,0)
 . S FBX=$$ICD0^FBCSV1(FBPROC,FBDATE)
"RTN","FBAAV5",337,0)
 . Q:FBX=""
"RTN","FBAAV5",338,0)
 . S FBX=FBX_$E("       ",$L(FBX)+1,7)
"RTN","FBAAV5",339,0)
 . S FBRET=FBX
"RTN","FBAAV5",340,0)
 Q FBRET
"RTN","FBAAV5",341,0)
 ;
"RTN","FBAAV5",342,0)
CRARC(FBIENS,FBCRARC) ; load CARCs and RARCs
"RTN","FBAAV5",343,0)
 ;
"RTN","FBAAV5",344,0)
 N FBADJ,FBRRMK
"RTN","FBAAV5",345,0)
 D LOADADJ^FBCHFA(FBIENS,.FBADJ)
"RTN","FBAAV5",346,0)
 D LOADRR^FBCHFR(FBIENS,.FBRRMK)
"RTN","FBAAV5",347,0)
 D CRARC^FBAAUTL(.FBADJ,.FBRRMK,.FBCRARC)
"RTN","FBAAV5",348,0)
 Q
"RTN","FBAAV5",349,0)
 ;FBAAV5
"RTN","FBAAV8")
0^33^B120330474^B119931377
"RTN","FBAAV8",1,0)
FBAAV8 ;ALB/FA - BUILD IPAC MRA MESSAGE ;18 Dec 2013 10:04 AM
"RTN","FBAAV8",2,0)
 ;;3.5;FEE BASIS;**123,158**;JAN 30, 1995;Build 94
"RTN","FBAAV8",3,0)
 ;;Per VA Directive 6402, this routine should not be modified.
"RTN","FBAAV8",4,0)
 ;
"RTN","FBAAV8",5,0)
 ;
"RTN","FBAAV8",6,0)
 ;-----------------------------------------------------------------------------
"RTN","FBAAV8",7,0)
 ;                           Entry Points
"RTN","FBAAV8",8,0)
 ; EN  - Transmit IPAC MRA Messages
"RTN","FBAAV8",9,0)
 ;       NOTE: (actually called from first line of routine)
"RTN","FBAAV8",10,0)
 ;-----------------------------------------------------------------------------
"RTN","FBAAV8",11,0)
 ;
"RTN","FBAAV8",12,0)
EN ;EP
"RTN","FBAAV8",13,0)
 ; Transmit IPAC MRA messages
"RTN","FBAAV8",14,0)
 ; Input:       FBFEE       - Current # of FEE messages
"RTN","FBAAV8",15,0)
 ; Output:      IPAC MRA messages Transmitted
"RTN","FBAAV8",16,0)
 ;              FBFEE       - Updated # of FEE messages
"RTN","FBAAV8",17,0)
 ;              FBNVP       - 1 (if its not already set)
"RTN","FBAAV8",18,0)
 ;              FBSITE      - Array Fee Basis Site Parameters (161.4)
"RTN","FBAAV8",19,0)
 ;                            (if not already passed in)
"RTN","FBAAV8",20,0)
 ; Called From: RTRAN@FBAAV0
"RTN","FBAAV8",21,0)
 N FBMSG,FBLN,FBSN,FBTXT,FBXMZ,MARIEN,X,ZMCNT
"RTN","FBAAV8",22,0)
 S ZMCNT=0,FBTXT=0,FBLN=0
"RTN","FBAAV8",23,0)
 S MRAIEN=""
"RTN","FBAAV8",24,0)
 F  D  Q:MRAIEN=""
"RTN","FBAAV8",25,0)
 . S MRAIEN=$O(^FBAA(161.96,"AS","P",MRAIEN))
"RTN","FBAAV8",26,0)
 . Q:MRAIEN=""
"RTN","FBAAV8",27,0)
 . Q:'$$EN1(MRAIEN,.FBMSG,.FBTXT,.FBLN,.FBSN,.FBXMZ,.ZMCNT)  ; Build Message
"RTN","FBAAV8",28,0)
 ;
"RTN","FBAAV8",29,0)
 Q:'$D(FBMSG)                                   ; No more records to transmit
"RTN","FBAAV8",30,0)
 D XMIT^FBAAV01                                 ; Transmit data remaining records
"RTN","FBAAV8",31,0)
 D MRAUPDT(.FBMSG)                              ; Update MRA records with transmission date
"RTN","FBAAV8",32,0)
 Q
"RTN","FBAAV8",33,0)
 ;
"RTN","FBAAV8",34,0)
EN1(MRAIEN,FBMSG,FBTXT,FBLN,FBSN,FBXMZ,ZMCNT) ; Build the message lines for the specified
"RTN","FBAAV8",35,0)
 ; MRA Record.
"RTN","FBAAV8",36,0)
 ; Input:       MRAIEN  - IEN of the IPAC MRA record being sent
"RTN","FBAAV8",37,0)
 ;              FBMSG   - Current Array of the MRA records that have currently been built
"RTN","FBAAV8",38,0)
 ;                        for transmission, sorted by message number
"RTN","FBAAV8",39,0)
 ;              FBTXT   - 0 - Header message not yet built
"RTN","FBAAV8",40,0)
 ;                        1 - Header message already built
"RTN","FBAAV8",41,0)
 ;              FBLN    - Current Line count
"RTN","FBAAV8",42,0)
 ;              FBSN    - 6 character (blank padded) station number or "" if not yet set
"RTN","FBAAV8",43,0)
 ;              FBXMZ   - Current Message Number, "" if no header has been built yet
"RTN","FBAAV8",44,0)
 ;              ZMCNT   - Current total line count
"RTN","FBAAV8",45,0)
 ; Output:      FBMSG   - Updated Array of the MRA records that have currently been built
"RTN","FBAAV8",46,0)
 ;                        for transmission, sorted by message number
"RTN","FBAAV8",47,0)
 ;              FBTXT   - Updated to 1 if it was initially 0 to indicate that the
"RTN","FBAAV8",48,0)
 ;                        IPAC MRA message header line was built
"RTN","FBAAV8",49,0)
 ;              FBLN    - Updated Line count
"RTN","FBAAV8",50,0)
 ;              FBSN    - 6 character (blank padded) station number
"RTN","FBAAV8",51,0)
 ;              FBXMZ   - Updated Message Number (only updated if HEAD is called)
"RTN","FBAAV8",52,0)
 ;              ZMCNT   - Updated total line count
"RTN","FBAAV8",53,0)
 ; Returns:     1 - Message is built for the specified MRA record, 0 otherwise
"RTN","FBAAV8",54,0)
 ; Called From: EN
"RTN","FBAAV8",55,0)
 N IX1,VAIEN
"RTN","FBAAV8",56,0)
 S VAIEN=$P(^FBAA(161.96,MRAIEN,0),U,2)                 ; IEN of the selected IPAC agreement
"RTN","FBAAV8",57,0)
 I VAIEN'="",'$D(^FBAA(161.95,VAIEN)) Q 0               ; Invalid IPAC Agreement IEN
"RTN","FBAAV8",58,0)
 S FBMSG(MRAIEN)=""                                     ; Log the MRA record to be transmitted
"RTN","FBAAV8",59,0)
 D LNBLD(VAIEN,MRAIEN,.FBMSG,.FBXMZ,.FBLN,.FBSN,.FBTXT,.ZMCNT) ; Build message to be transmitted
"RTN","FBAAV8",60,0)
 Q 1
"RTN","FBAAV8",61,0)
 ;
"RTN","FBAAV8",62,0)
LNBLD(VAIEN,MRAIEN,FBMSG,FBXMZ,FBLN,FBSN,FBTXT,ZMCNT) ; Build the message
"RTN","FBAAV8",63,0)
 ; Input:       VAIEN   - IEN of the IPAC Agreement of selected MRA record
"RTN","FBAAV8",64,0)
 ;              MRAIEN  - IEN of the selected MRA record
"RTN","FBAAV8",65,0)
 ;              FBMSG   - Array of the MRA records that have currently been built for 
"RTN","FBAAV8",66,0)
 ;                        transmission, sorted by message number
"RTN","FBAAV8",67,0)
 ;              FBXMZ   - Current Message number
"RTN","FBAAV8",68,0)
 ;              FBLN    - Current Line count
"RTN","FBAAV8",69,0)
 ;              FBSN    - 6 character (blank padded) station number or "" if not yet set
"RTN","FBAAV8",70,0)
 ;              FBTXT   - 0 - Header message not yet built
"RTN","FBAAV8",71,0)
 ;                        1 - Header message already built
"RTN","FBAAV8",72,0)
 ;              ZMCNT   - Current total line count
"RTN","FBAAV8",73,0)
 ; Output:      FBXMZ   - Updated Message number
"RTN","FBAAV8",74,0)
 ;              FBLN    - Updated line count
"RTN","FBAAV8",75,0)
 ;              FBSN    - 6 character (blank padded) station number
"RTN","FBAAV8",76,0)
 ;              FBTXT   - Updated to 1 if it was initially 0 to indicate that the
"RTN","FBAAV8",77,0)
 ;                        IPAC MRA message header line was built
"RTN","FBAAV8",78,0)
 ;              ZMCNT   - Updated total line count
"RTN","FBAAV8",79,0)
 ;
"RTN","FBAAV8",80,0)
 N ACT,FBSTR,IX1,VADATA,VAID,XX
"RTN","FBAAV8",81,0)
 S ACT=$P(^FBAA(161.96,MRAIEN,0),U,4)           ; MRA Record Action
"RTN","FBAAV8",82,0)
 S VAID=$P(^FBAA(161.96,MRAIEN,0),U,3)          ; Agreement ID
"RTN","FBAAV8",83,0)
 I ACT'="D" D                                   ; Not a delete record
"RTN","FBAAV8",84,0)
 . F IX1=0:1:6 D
"RTN","FBAAV8",85,0)
 . . S VADATA(IX1)=$G(^FBAA(161.95,VAIEN,IX1))  ; Array of IPAC Vendor Agreement data
"RTN","FBAAV8",86,0)
 E  D
"RTN","FBAAV8",87,0)
 . S VADATA(0)=VAID
"RTN","FBAAV8",88,0)
 ;
"RTN","FBAAV8",89,0)
 I 'FBTXT D                                     ; No header yet, build it now
"RTN","FBAAV8",90,0)
 . S FBTXT=1,ZMCNT=1,FBLN=0
"RTN","FBAAV8",91,0)
 . D HEAD(.FBLN,.FBXMZ,.FBSN)
"RTN","FBAAV8",92,0)
 ;
"RTN","FBAAV8",93,0)
 S FBSTR=$$LINE1(MRAIEN,FBSN,.VADATA)           ; 1st line of data for the MRA record
"RTN","FBAAV8",94,0)
 D STORE^FBAAV01
"RTN","FBAAV8",95,0)
 S ZMCNT=ZMCNT+1
"RTN","FBAAV8",96,0)
 I ACT'="D" D                                   ; If we're not transmitting a delete record
"RTN","FBAAV8",97,0)
 . S FBSTR=$$LINE2(.VADATA)                     ; 2nd line of data for the MRA record
"RTN","FBAAV8",98,0)
 . D STORE^FBAAV01
"RTN","FBAAV8",99,0)
 . S FBSTR=$$LINE3(.VADATA)                     ; 3rd line of data for the MRA record
"RTN","FBAAV8",100,0)
 . D STORE^FBAAV01
"RTN","FBAAV8",101,0)
 . S FBSTR=$$LINE4(.VADATA)                     ; 4th line of data for the MRA record
"RTN","FBAAV8",102,0)
 . D STORE^FBAAV01
"RTN","FBAAV8",103,0)
 . S FBSTR=$$LINE5(.VADATA)                     ; 5th line of data for the MRA record
"RTN","FBAAV8",104,0)
 . D STORE^FBAAV01
"RTN","FBAAV8",105,0)
 . S FBSTR=$$LINE6(.VADATA)                     ; 6th line of data for the MRA record
"RTN","FBAAV8",106,0)
 . D STORE^FBAAV01
"RTN","FBAAV8",107,0)
 . S FBSTR=$$LINE7(.VADATA)                     ; 7th line of data for the MRA record
"RTN","FBAAV8",108,0)
 . D STORE^FBAAV01
"RTN","FBAAV8",109,0)
 . S ZMCNT=ZMCNT+6                              ; Increment total line count
"RTN","FBAAV8",110,0)
 ;
"RTN","FBAAV8",111,0)
 ; Maximum total line count reached, transmit current lines
"RTN","FBAAV8",112,0)
 I ZMCNT>27 D
"RTN","FBAAV8",113,0)
 . D XMIT^FBAAV01                               ; Transmit the current data
"RTN","FBAAV8",114,0)
 . D MRAUPDT(.FBMSG)                            ; Update MRA records with transmission date
"RTN","FBAAV8",115,0)
 . S ZMCNT=0,FBLN=0,FBTXT=0                     ; Reset total line count, line count, header flag
"RTN","FBAAV8",116,0)
 Q
"RTN","FBAAV8",117,0)
 ;
"RTN","FBAAV8",118,0)
HEAD(FBLN,FBXMZ,FBSN)    ; Create header line for IPAC MRA Message
"RTN","FBAAV8",119,0)
 ; Input:       FBLN    - Current Line count of the message
"RTN","FBAAV8",120,0)
 ;              FBXMZ   - Current Message number
"RTN","FBAAV8",121,0)
 ; Output:      FBLN    - Updated Line count
"RTN","FBAAV8",122,0)
 ;              FBSN    - Agency Station Number
"RTN","FBAAV8",123,0)
 ;              FBXMZ   - Updated Message Number
"RTN","FBAAV8",124,0)
 ;
"RTN","FBAAV8",125,0)
 N FB,FBAASN,FBBN,FBHD,FBJ,FBSTR
"RTN","FBAAV8",126,0)
 D NEWMSG^FBAAV01                               ; FBOKTX,XMSUB,XMDUZ
"RTN","FBAAV8",127,0)
 S FBHD=$$HDR^FBAAUTL3()                        ; 'FEE' - first piece of batch header
"RTN","FBAAV8",128,0)
 D STATION^FBAAUTL                              ; Returns FBSN,FBAASN (and maybe FBSITE)
"RTN","FBAAV8",129,0)
 S FBSN=$$LJ^XLFSTR(FBSN,6)                     ; Station number padded with trailing spaces
"RTN","FBAAV8",130,0)
 D GETNXB^FBAAUTL                               ; Next Fee Basis Batch Number (FBBN)
"RTN","FBAAV8",131,0)
 ;FB*3.5*158
"RTN","FBAAV8",132,0)
 S FBBN=$$RJ^XLFSTR(FBBN,7,"0")                 ; Padded with leading 0s to 7 digits as necessary
"RTN","FBAAV8",133,0)
 ;
"RTN","FBAAV8",134,0)
 ; Build header line for IPAC MRA Messages
"RTN","FBAAV8",135,0)
 S FBSTR=FBHD_"C8"_$TR($$FMTE^XLFDT(DT,"5DZ"),"/","")_FBSN_FBBN_"$"
"RTN","FBAAV8",136,0)
 D STORE^FBAAV01
"RTN","FBAAV8",137,0)
 Q
"RTN","FBAAV8",138,0)
 ;
"RTN","FBAAV8",139,0)
LINE1(MRAIEN,FBSN,VADATA)  ; Create 1st message line for an MRA record
"RTN","FBAAV8",140,0)
 ; Input:       MRAIEN      - IEN of the IPAC MRA record being transmitted
"RTN","FBAAV8",141,0)
 ;              FBSN        - Agency Station # (6 chars padded with trailing spaces)
"RTN","FBAAV8",142,0)
 ;              VADATA      - Array of IPAC Agreement data
"RTN","FBAAV8",143,0)
 ; Returns:     1st line of data for the MRA record
"RTN","FBAAV8",144,0)
 ; Called From: LNBLD 
"RTN","FBAAV8",145,0)
 N FBSTR,VID,XX
"RTN","FBAAV8",146,0)
 ;
"RTN","FBAAV8",147,0)
 ; Build Line 1 of the Message for the selected MRA record
"RTN","FBAAV8",148,0)
 S FBSTR=8                                      ; 1st char, 1st line of IPAC Agreement data
"RTN","FBAAV8",149,0)
 S FBSTR=FBSTR_$P(^FBAA(161.96,MRAIEN,0),U,4)   ; 2nd char - IPAC MRA Action type (A,C,D)
"RTN","FBAAV8",150,0)
 S FBSTR=FBSTR_FBSN                             ; 3-8 char - Agency Station Number
"RTN","FBAAV8",151,0)
 S XX=$P(VADATA(0),U,1)                         ; IPAC Agreement ID
"RTN","FBAAV8",152,0)
 S XX=$$LJ^XLFSTR(XX,10)                        ; IPAC Agreement ID padded with trailing spaces
"RTN","FBAAV8",153,0)
 S FBSTR=FBSTR_XX                               ; 9-18 char - IPAC Agreement ID
"RTN","FBAAV8",154,0)
 I '$D(VADATA(1)) Q FBSTR_"~$"                  ; Delete action being transmitted, quit now
"RTN","FBAAV8",155,0)
 S VID=$P(VADATA(0),U,2)                        ; IEN of the IPAC Agreement Vendor, "" for deleted
"RTN","FBAAV8",156,0)
 S XX=$P(^FBAAV(VID,0),U,2)                     ; Vendor ID number
"RTN","FBAAV8",157,0)
 S XX=$$LJ^XLFSTR(XX,11)                        ; Vendor ID # left justified, padded with trailing spaces
"RTN","FBAAV8",158,0)
 I $P(^FBAAV(VID,0),U,7)="3" D                  ; Pharmacy Vendor
"RTN","FBAAV8",159,0)
 . N CHAIN
"RTN","FBAAV8",160,0)
 . S CHAIN=$P(^FBAAV(VID,0),U,10)               ; Pharmacy chain #
"RTN","FBAAV8",161,0)
 . S CHAIN=$$RJ^XLFSTR(CHAIN,4,"0")             ; Chain padded with leading 0's
"RTN","FBAAV8",162,0)
 . S XX=$E(XX,1,9)_CHAIN                        ; Chain appended to the Vendor ID for pharmacy
"RTN","FBAAV8",163,0)
 E  S XX=XX_"  "                                ; Non-Pharmacy Vendor
"RTN","FBAAV8",164,0)
 S FBSTR=FBSTR_XX                               ; 19-31 char - Vendor ID
"RTN","FBAAV8",165,0)
 S FBSTR=FBSTR_$P(VADATA(0),U,3)                ; 32-35 - IPAC Agreement Fiscal Year
"RTN","FBAAV8",166,0)
 S XX=$P(VADATA(0),U,5)                         ; IPAC Agreement Description
"RTN","FBAAV8",167,0)
 S XX=$$LJ^XLFSTR(XX,60)                        ; Description with trailing spaces
"RTN","FBAAV8",168,0)
 S FBSTR=FBSTR_XX                               ; 36-95 char - IPAC Agreement Description
"RTN","FBAAV8",169,0)
 S XX=$P(VADATA(0),U,6)                         ; IPAC Agreement Sharing #
"RTN","FBAAV8",170,0)
 S XX=$$LJ^XLFSTR(XX,13)                        ; Sharing Agreement padded with trailing spaces
"RTN","FBAAV8",171,0)
 S FBSTR=FBSTR_XX                               ; 96-108 char - Sharing Agreement #
"RTN","FBAAV8",172,0)
 S FBSTR=FBSTR_$P(VADATA(0),U,4)_"~"            ; 109 char - IPAC Agreement Status ('A' or 'I') 
"RTN","FBAAV8",173,0)
 Q FBSTR
"RTN","FBAAV8",174,0)
 ;
"RTN","FBAAV8",175,0)
LINE2(VADATA)  ; Create 2nd message line for an MRA record
"RTN","FBAAV8",176,0)
 ; Input:       VADATA      - Array of IPAC Agreement data
"RTN","FBAAV8",177,0)
 ; Returns:     2nd line of data for the MRA record
"RTN","FBAAV8",178,0)
 ; Called From: LNBLD 
"RTN","FBAAV8",179,0)
 N FBSTR,XX
"RTN","FBAAV8",180,0)
 S XX=$P(VADATA(1),U,1)                         ; IPAC Agreement Customer ALC
"RTN","FBAAV8",181,0)
 S XX=$$LJ^XLFSTR(XX,8)                         ; Customer ALC with trailing spaces
"RTN","FBAAV8",182,0)
 S FBSTR=XX                                     ; 1-8 Char - Customer ALC
"RTN","FBAAV8",183,0)
 S XX=$P(VADATA(1),U,2)                         ; IPAC Agreement Receiver TAS
"RTN","FBAAV8",184,0)
 S XX=$$LJ^XLFSTR(XX,27)                        ; Receiver TAS with trailing spaces
"RTN","FBAAV8",185,0)
 S FBSTR=FBSTR_XX                               ; 9-35 Char - Receiver TAS
"RTN","FBAAV8",186,0)
 S XX=$P(VADATA(1),U,5)                         ; IPAC Agreement Sender TAS
"RTN","FBAAV8",187,0)
 S XX=$$LJ^XLFSTR(XX,27)                        ; Sender TAS with trailing spaces
"RTN","FBAAV8",188,0)
 S FBSTR=FBSTR_XX                               ; 36-62 Char - Receiver TAS
"RTN","FBAAV8",189,0)
 S XX=$P(VADATA(1),U,3)                         ; IPAC Agreement Agency Field Station Number
"RTN","FBAAV8",190,0)
 S XX=$$LJ^XLFSTR(XX,8)                         ; Agency Field Station Number with trailing spaces
"RTN","FBAAV8",191,0)
 S FBSTR=FBSTR_XX                               ; 63-70 Char - Agency Field Station Number
"RTN","FBAAV8",192,0)
 S XX=$P(VADATA(1),U,4)                         ; IPAC Agreement Obligating Document #
"RTN","FBAAV8",193,0)
 S XX=$$LJ^XLFSTR(XX,17)                        ; Obligating Document # with trailing spaces
"RTN","FBAAV8",194,0)
 S FBSTR=FBSTR_XX_"~"                           ; 71-87 Char - Obligating Document #
"RTN","FBAAV8",195,0)
 Q FBSTR
"RTN","FBAAV8",196,0)
LINE3(VADATA)  ; Create 3rd message line for an MRA record
"RTN","FBAAV8",197,0)
 ; Input:       VADATA      - Array of IPAC Agreement data
"RTN","FBAAV8",198,0)
 ; Returns:     3rd line of data for the MRA record
"RTN","FBAAV8",199,0)
 ; Called From: LNBLD 
"RTN","FBAAV8",200,0)
 N FBSTR,XX
"RTN","FBAAV8",201,0)
 S XX=$P(VADATA(2),U,1)                         ; IPAC Agreement Station Contact Name
"RTN","FBAAV8",202,0)
 S XX=$$LJ^XLFSTR(XX,60)                        ; Station Contact Name with trailing spaces
"RTN","FBAAV8",203,0)
 S FBSTR=XX                                     ; 1-60 char - Station Contact Name
"RTN","FBAAV8",204,0)
 S XX=$P(VADATA(2),U,2)                         ; IPAC Agreement Station Contact Phone
"RTN","FBAAV8",205,0)
 S XX=$$LJ^XLFSTR(XX,17)                        ; Station Contact Phone with trailing spaces
"RTN","FBAAV8",206,0)
 S FBSTR=FBSTR_XX                               ; 61-77 char - Station Contact Phone
"RTN","FBAAV8",207,0)
 S XX=$P(VADATA(2),U,3)                         ; IPAC Agreement Station Contact Email
"RTN","FBAAV8",208,0)
 S XX=$$LJ^XLFSTR(XX,100)                       ; Station Contact Email with trailing spaces
"RTN","FBAAV8",209,0)
 S FBSTR=FBSTR_XX_"~"                           ; 78-177 char - Station Contact Phone
"RTN","FBAAV8",210,0)
 Q FBSTR
"RTN","FBAAV8",211,0)
 ; 
"RTN","FBAAV8",212,0)
LINE4(VADATA)  ; Create 4th message line for an MRA record
"RTN","FBAAV8",213,0)
 ; Input:       VADATA      - Array of IPAC Agreement data
"RTN","FBAAV8",214,0)
 ; Returns:     4th line of data for the MRA record
"RTN","FBAAV8",215,0)
 ; Called From: LNBLD 
"RTN","FBAAV8",216,0)
 N FBSTR,XX
"RTN","FBAAV8",217,0)
 S XX=$P(VADATA(3),U,1)                         ; IPAC Agreement Station Complete line of Accounting
"RTN","FBAAV8",218,0)
 S XX=$$LJ^XLFSTR(XX,60)                        ; Complete line of accounting with trailing spaces
"RTN","FBAAV8",219,0)
 S FBSTR=XX_"~"                                 ; 1-60 char - Complete line of Accounting
"RTN","FBAAV8",220,0)
 Q FBSTR
"RTN","FBAAV8",221,0)
 ; 
"RTN","FBAAV8",222,0)
LINE5(VADATA)  ; Create 5th message line for an MRA record
"RTN","FBAAV8",223,0)
 ; Input:       VADATA      - Array of IPAC Agreement data
"RTN","FBAAV8",224,0)
 ; Returns:     5th line of data for the MRA record
"RTN","FBAAV8",225,0)
 ; Called From: LNBLD 
"RTN","FBAAV8",226,0)
 N FBSTR,XX
"RTN","FBAAV8",227,0)
 S XX=$P(VADATA(4),U,1)                         ; IPAC Agreement Station Goods & Services
"RTN","FBAAV8",228,0)
 S XX=$$LJ^XLFSTR(XX,200)                       ; Goods & Services with trailing spaces
"RTN","FBAAV8",229,0)
 S FBSTR=XX_"~"                                 ; 1-200 char - Goods & Services
"RTN","FBAAV8",230,0)
 Q FBSTR
"RTN","FBAAV8",231,0)
 ;
"RTN","FBAAV8",232,0)
LINE6(VADATA)  ; Create 6th message line for an MRA record
"RTN","FBAAV8",233,0)
 ; Input:       VADATA      - Array of IPAC Agreement data
"RTN","FBAAV8",234,0)
 ; Returns:     6th line of data for the MRA record
"RTN","FBAAV8",235,0)
 ; Called From: LNBLD 
"RTN","FBAAV8",236,0)
 N FBSTR,XX
"RTN","FBAAV8",237,0)
 S XX=$P(VADATA(5),U,1)                         ; IPAC Agreement Miscellaneous Line 1
"RTN","FBAAV8",238,0)
 S XX=$$LJ^XLFSTR(XX,220)                       ; Miscellaneous Line 1 with trailing spaces
"RTN","FBAAV8",239,0)
 S FBSTR=XX_"~"                                 ; 1-220 char - Miscellaneous Line 1
"RTN","FBAAV8",240,0)
 Q FBSTR
"RTN","FBAAV8",241,0)
 ;
"RTN","FBAAV8",242,0)
LINE7(VADATA)  ; Create 7th message line for an MRA record
"RTN","FBAAV8",243,0)
 ; Input:       VADATA      - Array of IPAC Agreement data
"RTN","FBAAV8",244,0)
 ; Returns:     7tht line of data for the MRA record
"RTN","FBAAV8",245,0)
 ; Called From: LNBLD 
"RTN","FBAAV8",246,0)
 N FBSTR,XX
"RTN","FBAAV8",247,0)
 S XX=$P(VADATA(6),U,1)                         ; IPAC Agreement Miscellaneous Line 2
"RTN","FBAAV8",248,0)
 S XX=$$LJ^XLFSTR(XX,100)                       ; Miscellaneous Line 2 with trailing spaces
"RTN","FBAAV8",249,0)
 S FBSTR=XX_"~$"                                ; 1-100 char - Miscellaneous Line 2
"RTN","FBAAV8",250,0)
 Q FBSTR
"RTN","FBAAV8",251,0)
 Q
"RTN","FBAAV8",252,0)
 ;
"RTN","FBAAV8",253,0)
MRAUPDT(FBMSG)   ; Update MRA records with transmit status and date
"RTN","FBAAV8",254,0)
 ; Input:       FBMSG()         - Array of MRA IENs that were transmitted
"RTN","FBAAV8",255,0)
 ; Output:      MRA records updated with transmit status and date
"RTN","FBAAV8",256,0)
 ; Called From: EN, LNBLD
"RTN","FBAAV8",257,0)
 N DA,DIE,DR,MRAIEN,X
"RTN","FBAAV8",258,0)
 S MRAIEN=""
"RTN","FBAAV8",259,0)
 F  D  Q:MRAIEN=""
"RTN","FBAAV8",260,0)
 . S MRAIEN=$O(FBMSG(MRAIEN))
"RTN","FBAAV8",261,0)
 . Q:MRAIEN=""
"RTN","FBAAV8",262,0)
 . S DIE="^FBAA(161.96,",DA=MRAIEN
"RTN","FBAAV8",263,0)
 . S DR="4///^S X="_"""TRANSMITTED"""
"RTN","FBAAV8",264,0)
 . S DR=DR_";5///TODAY"
"RTN","FBAAV8",265,0)
 . D ^DIE
"RTN","FBAAV8",266,0)
 . K FBMSG(MRAIEN)
"RTN","FBAAV8",267,0)
 Q
"RTN","FBAAV8",268,0)
 ;
"RTN","FBAAVR5")
0^4^B40211366^B40211184
"RTN","FBAAVR5",1,0)
FBAAVR5 ;WOIFO/SAB - GENERATE VOUCHER BATCH MSG ;9/12/2012
"RTN","FBAAVR5",2,0)
 ;;3.5;FEE BASIS;**132,158**;JAN 30, 1995;Build 94
"RTN","FBAAVR5",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","FBAAVR5",4,0)
 ;
"RTN","FBAAVR5",5,0)
 ; ICRs
"RTN","FBAAVR5",6,0)
 ;  #2053  FILE^DIE
"RTN","FBAAVR5",7,0)
 ;  #2054  CLEAN^DILF
"RTN","FBAAVR5",8,0)
 ;  #2056  $$GET1^DIQ
"RTN","FBAAVR5",9,0)
 ;  #2729  SENDMSG^XMXAPI
"RTN","FBAAVR5",10,0)
 ;  #10104 $$LG^XLFSTR, $$RJ^XLFSTR
"RTN","FBAAVR5",11,0)
 Q
"RTN","FBAAVR5",12,0)
 ;
"RTN","FBAAVR5",13,0)
VBMSG(FBN) ; Generate Voucher Batch Message
"RTN","FBAAVR5",14,0)
 ; input
"RTN","FBAAVR5",15,0)
 ;   FBN - Batch IEN (file 161.7)
"RTN","FBAAVR5",16,0)
 ; returns value
"RTN","FBAAVR5",17,0)
 ;   =message number if successful
"RTN","FBAAVR5",18,0)
 ;   =0^error message if unsuccessful
"RTN","FBAAVR5",19,0)
 ;
"RTN","FBAAVR5",20,0)
 N FBAUS,FBCNT,FBHD,FBLN,FBNUM,FBRET,FBSTUB,FBTYPE
"RTN","FBAAVR5",21,0)
 K ^TMP($J,"FBVBM")
"RTN","FBAAVR5",22,0)
 ;
"RTN","FBAAVR5",23,0)
 ; check for required input
"RTN","FBAAVR5",24,0)
 I '$G(FBN) S FBRET="0^Batch IEN not provided." G END
"RTN","FBAAVR5",25,0)
 ;
"RTN","FBAAVR5",26,0)
 ; retrieve batch data
"RTN","FBAAVR5",27,0)
 S FBNUM=$$GET1^DIQ(161.7,FBN_",",.01) ; NUMBER
"RTN","FBAAVR5",28,0)
 I $D(DIERR) S FBRET="0^Error getting batch data." G END
"RTN","FBAAVR5",29,0)
 S FBTYPE=$$GET1^DIQ(161.7,FBN_",",2,"I") ; TYPE
"RTN","FBAAVR5",30,0)
 I "^B2^B3^B5^B9^"'[("^"_FBTYPE_"^") S FBRET="0^Invalid batch type" G END
"RTN","FBAAVR5",31,0)
 ;
"RTN","FBAAVR5",32,0)
 ; determine subsystem identifier
"RTN","FBAAVR5",33,0)
 D HD^FBAAUTL
"RTN","FBAAVR5",34,0)
 I $G(FBHD)="" S FBRET="0^Error obtaining Subsystem Identifier." G END
"RTN","FBAAVR5",35,0)
 ;
"RTN","FBAAVR5",36,0)
 ; determine string values to transmit
"RTN","FBAAVR5",37,0)
 S FBAUS("SN")=$$LJ^XLFSTR($$STANUM(FBN),6) ; station number
"RTN","FBAAVR5",38,0)
 S FBAUS("DT")=$$AUSDT^FBAAV3(DT) ; date
"RTN","FBAAVR5",39,0)
 S FBAUS("PT")=$S(FBTYPE="B2":"T",1:$E(FBTYPE,2)) ; payment type
"RTN","FBAAVR5",40,0)
 ;
"RTN","FBAAVR5",41,0)
 S FBCNT=0 ; init reject line count
"RTN","FBAAVR5",42,0)
 ;
"RTN","FBAAVR5",43,0)
 ; determine stub string for voucher batch reject line
"RTN","FBAAVR5",44,0)
 S FBSTUB=FBAUS("SN")_FBAUS("DT")_"V"_FBAUS("PT")
"RTN","FBAAVR5",45,0)
 ;
"RTN","FBAAVR5",46,0)
 ; loop thru line items rejected from batch
"RTN","FBAAVR5",47,0)
 I FBTYPE="B2" D
"RTN","FBAAVR5",48,0)
 . N FBIEN,FBIENS
"RTN","FBAAVR5",49,0)
 . S FBIEN(1)=0
"RTN","FBAAVR5",50,0)
 . F  S FBIEN(1)=$O(^FBAAC("AG",FBN,FBIEN(1))) Q:'FBIEN(1)  D
"RTN","FBAAVR5",51,0)
 . . S FBIEN=0
"RTN","FBAAVR5",52,0)
 . . F  S FBIEN=$O(^FBAAC("AG",FBN,FBIEN(1),FBIEN)) Q:'FBIEN  D
"RTN","FBAAVR5",53,0)
 . . . S FBIENS=FBIEN_","_FBIEN(1)_","
"RTN","FBAAVR5",54,0)
 . . . Q:$$GET1^DIQ(162.04,FBIENS,6.3,"I")=1  ; skip interface rej.
"RTN","FBAAVR5",55,0)
 . . . S FBPICN=FBIEN(1)_"^"_FBIEN
"RTN","FBAAVR5",56,0)
 . . . S FBPICN=$$ORGICN(162.04,FBPICN) ; send original ICN
"RTN","FBAAVR5",57,0)
 . . . D ADDLN
"RTN","FBAAVR5",58,0)
 ;
"RTN","FBAAVR5",59,0)
 I FBTYPE="B3" D
"RTN","FBAAVR5",60,0)
 . N FBIEN,FBIENS,FBPICN
"RTN","FBAAVR5",61,0)
 . S FBIEN(3)=0
"RTN","FBAAVR5",62,0)
 . F  S FBIEN(3)=$O(^FBAAC("AH",FBN,FBIEN(3))) Q:'FBIEN(3)  D
"RTN","FBAAVR5",63,0)
 . . S FBIEN(2)=0
"RTN","FBAAVR5",64,0)
 . . F  S FBIEN(2)=$O(^FBAAC("AH",FBN,FBIEN(3),FBIEN(2))) Q:'FBIEN(2)  D
"RTN","FBAAVR5",65,0)
 . . . S FBIEN(1)=0
"RTN","FBAAVR5",66,0)
 . . . F  S FBIEN(1)=$O(^FBAAC("AH",FBN,FBIEN(3),FBIEN(2),FBIEN(1))) Q:'FBIEN(1)  D
"RTN","FBAAVR5",67,0)
 . . . . S FBIEN=0
"RTN","FBAAVR5",68,0)
 . . . . F  S FBIEN=$O(^FBAAC("AH",FBN,FBIEN(3),FBIEN(2),FBIEN(1),FBIEN)) Q:'FBIEN  D
"RTN","FBAAVR5",69,0)
 . . . . . S FBIENS=FBIEN_","_FBIEN(1)_","_FBIEN(2)_","_FBIEN(3)_","
"RTN","FBAAVR5",70,0)
 . . . . . Q:$$GET1^DIQ(162.03,FBIENS,21.3,"I")=1  ; skip interface rej.
"RTN","FBAAVR5",71,0)
 . . . . . S FBPICN=FBIEN(3)_"^"_FBIEN(2)_"^"_FBIEN(1)_"^"_FBIEN
"RTN","FBAAVR5",72,0)
 . . . . . S FBPICN=$$ORGICN(162.03,FBPICN) ; send orignal ICN
"RTN","FBAAVR5",73,0)
 . . . . . D ADDLN
"RTN","FBAAVR5",74,0)
 ;
"RTN","FBAAVR5",75,0)
 I FBTYPE="B5" D
"RTN","FBAAVR5",76,0)
 . N FBIEN,FBIENS,FBPICN
"RTN","FBAAVR5",77,0)
 . S FBIEN(1)=0
"RTN","FBAAVR5",78,0)
 . F  S FBIEN(1)=$O(^FBAA(162.1,"AF",FBN,FBIEN(1))) Q:'FBIEN(1)  D
"RTN","FBAAVR5",79,0)
 . . S FBIEN=0
"RTN","FBAAVR5",80,0)
 . . F  S FBIEN=$O(^FBAA(162.1,"AF",FBN,FBIEN(1),FBIEN)) Q:'FBIEN  D
"RTN","FBAAVR5",81,0)
 . . . S FBIENS=FBIEN_","_FBIEN(1)_","
"RTN","FBAAVR5",82,0)
 . . . Q:$$GET1^DIQ(162.11,FBIENS,19.3,"I")=1  ; skip interface rej.
"RTN","FBAAVR5",83,0)
 . . . S FBPICN=FBIEN(1)_"^"_FBIEN
"RTN","FBAAVR5",84,0)
 . . . D ADDLN
"RTN","FBAAVR5",85,0)
 ;
"RTN","FBAAVR5",86,0)
 I FBTYPE="B9" D
"RTN","FBAAVR5",87,0)
 . N FBIEN,FBIENS,FBPICN
"RTN","FBAAVR5",88,0)
 . S FBIEN=0
"RTN","FBAAVR5",89,0)
 . F  S FBIEN=$O(^FBAAI("AH",FBN,FBIEN)) Q:'FBIEN  D
"RTN","FBAAVR5",90,0)
 . . S FBIENS=FBIEN_","
"RTN","FBAAVR5",91,0)
 . . Q:$$GET1^DIQ(162.5,FBIENS,15.3,"I")=1  ; skip interface rej.
"RTN","FBAAVR5",92,0)
 . . S FBPICN=FBIEN
"RTN","FBAAVR5",93,0)
 . . D ADDLN
"RTN","FBAAVR5",94,0)
 ;
"RTN","FBAAVR5",95,0)
 ; build message header line - FB*3.5*158
"RTN","FBAAVR5",96,0)
 S ^TMP($J,"FBVBM",1)=FBHD_"V"_FBAUS("PT")_FBAUS("DT")_FBAUS("SN")_$$RJ^XLFSTR(FBNUM,7,"0")_$$RJ^XLFSTR(FBCNT,3,"0")_"$"
"RTN","FBAAVR5",97,0)
 ;
"RTN","FBAAVR5",98,0)
 ; address and send message
"RTN","FBAAVR5",99,0)
 D
"RTN","FBAAVR5",100,0)
 . N FBINSTR,XMDUZ,XMERR,XMSUBJ,XMY,XMZ
"RTN","FBAAVR5",101,0)
 . S XMSUBJ="FEE BASIS VOUCHER MESSAGE BATCH "_FBNUM
"RTN","FBAAVR5",102,0)
 . S FBINSTR("ADDR FLAGS")="R"
"RTN","FBAAVR5",103,0)
 . D RECIP
"RTN","FBAAVR5",104,0)
 . D SENDMSG^XMXAPI(XMDUZ,XMSUBJ,"^TMP("_$J_",""FBVBM"")",.XMY,.FBINSTR,.XMZ)
"RTN","FBAAVR5",105,0)
 . I $G(XMERR) S FBRET="0^Error generating mail message"
"RTN","FBAAVR5",106,0)
 . I '$G(XMERR) S FBRET=XMZ
"RTN","FBAAVR5",107,0)
 ;
"RTN","FBAAVR5",108,0)
 ; if message created update batch
"RTN","FBAAVR5",109,0)
 I FBRET D
"RTN","FBAAVR5",110,0)
 . N DIERR,FBFDA,FBX
"RTN","FBAAVR5",111,0)
 . S FBFDA(161.7,FBN_",",21)=DT ; VOUCHER MSG DATE
"RTN","FBAAVR5",112,0)
 . S FBFDA(161.7,FBN_",",22)="P" ; VOUCHER MSG ACK STATUS
"RTN","FBAAVR5",113,0)
 . D FILE^DIE("","FBFDA")
"RTN","FBAAVR5",114,0)
 . D CLEAN^DILF
"RTN","FBAAVR5",115,0)
 ;
"RTN","FBAAVR5",116,0)
END ;
"RTN","FBAAVR5",117,0)
 K ^TMP($J,"FBVBM")
"RTN","FBAAVR5",118,0)
 Q FBRET
"RTN","FBAAVR5",119,0)
 ;
"RTN","FBAAVR5",120,0)
ADDLN ; add detail line
"RTN","FBAAVR5",121,0)
 S FBCNT=FBCNT+1
"RTN","FBAAVR5",122,0)
 S ^TMP($J,"FBVBM",FBCNT+1)=FBSTUB_$$RJ^XLFSTR(FBPICN,30,"0")_"$"
"RTN","FBAAVR5",123,0)
 Q
"RTN","FBAAVR5",124,0)
 ;
"RTN","FBAAVR5",125,0)
STANUM(FBN) ; determine station number to transmit
"RTN","FBAAVR5",126,0)
 ;
"RTN","FBAAVR5",127,0)
 N FBRET,FBX,FBY0
"RTN","FBAAVR5",128,0)
 S FBRET=""
"RTN","FBAAVR5",129,0)
 ;
"RTN","FBAAVR5",130,0)
 ; determine station number based on obligation of batch
"RTN","FBAAVR5",131,0)
 I $G(FBN) D
"RTN","FBAAVR5",132,0)
 . S FBY0=$G(^FBAA(161.7,FBN,0))
"RTN","FBAAVR5",133,0)
 . S FBX=$$SUB^FBAAUTL5(+$P(FBY0,U,8)_"-"_$P(FBY0,U,2))
"RTN","FBAAVR5",134,0)
 . I FBX]"" S FBRET=FBX
"RTN","FBAAVR5",135,0)
 ;
"RTN","FBAAVR5",136,0)
 ; if station number not found use default station number
"RTN","FBAAVR5",137,0)
 I FBRET="" D
"RTN","FBAAVR5",138,0)
 . S FBX=$P($G(^FBAA(161.4,1,1)),"^",3)
"RTN","FBAAVR5",139,0)
 . S:FBX FBRET=$$STA^XUAF4(FBX)
"RTN","FBAAVR5",140,0)
 ;
"RTN","FBAAVR5",141,0)
 Q FBRET
"RTN","FBAAVR5",142,0)
 ;
"RTN","FBAAVR5",143,0)
RECIP ; determine message recipients
"RTN","FBAAVR5",144,0)
 ; input
"RTN","FBAAVR5",145,0)
 ;  DUZ
"RTN","FBAAVR5",146,0)
 ; output
"RTN","FBAAVR5",147,0)
 ;  XMDUZ
"RTN","FBAAVR5",148,0)
 ;  XMY(
"RTN","FBAAVR5",149,0)
 N FBXMFEE,FBXMNVP
"RTN","FBAAVR5",150,0)
 S XMDUZ=DUZ
"RTN","FBAAVR5",151,0)
 ;
"RTN","FBAAVR5",152,0)
 ; get recipients from TRANSMISISON ROUTERS files
"RTN","FBAAVR5",153,0)
 D
"RTN","FBAAVR5",154,0)
 . N FBI,FBVAR,VAT,VATERR,VATNAME
"RTN","FBAAVR5",155,0)
 . D ADDRESS^FBAAV01
"RTN","FBAAVR5",156,0)
 ;
"RTN","FBAAVR5",157,0)
 ; set XMY array and XMDUZ
"RTN","FBAAVR5",158,0)
 D
"RTN","FBAAVR5",159,0)
 . N FBFLAG,FBI,XMD,XMLOC,XMMG,XMN,X,Y
"RTN","FBAAVR5",160,0)
 . D ROUT^FBAAV01
"RTN","FBAAVR5",161,0)
 Q
"RTN","FBAAVR5",162,0)
 ;
"RTN","FBAAVR5",163,0)
ORGICN(FBFILE,FBICN) ; return original ICN value for a line item
"RTN","FBAAVR5",164,0)
 ; input
"RTN","FBAAVR5",165,0)
 ;   FBFILE - sub-file (162.03 or 162.04)
"RTN","FBAAVR5",166,0)
 ;   FBICN  - ICN value
"RTN","FBAAVR5",167,0)
 ; return value = the original ICN value
"RTN","FBAAVR5",168,0)
 ;
"RTN","FBAAVR5",169,0)
 N FBRET
"RTN","FBAAVR5",170,0)
 S FBRET=$G(FBICN)
"RTN","FBAAVR5",171,0)
 ;
"RTN","FBAAVR5",172,0)
 I "^162.03^162.04^"[("^"_$G(FBFILE)_"^"),$G(FBICN)'="" D
"RTN","FBAAVR5",173,0)
 . N FBCIENS,FBOIENS,FBSIENS
"RTN","FBAAVR5",174,0)
 . ; determine starting IEN string
"RTN","FBAAVR5",175,0)
 . I FBFILE=162.03 S FBSIENS=$P(FBICN,"^",4)_","_$P(FBICN,"^",3)_","_$P(FBICN,"^",2)_","_$P(FBICN,"^",1)_","
"RTN","FBAAVR5",176,0)
 . I FBFILE=162.04 S FBSIENS=$P(FBICN,"^",2)_","_$P(FBICN,"^",1)_","
"RTN","FBAAVR5",177,0)
 . ;
"RTN","FBAAVR5",178,0)
 . S FBCIENS=FBSIENS ; init current IEN string as starting IEN string
"RTN","FBAAVR5",179,0)
 . ;
"RTN","FBAAVR5",180,0)
 . ;loop thru moves for current IENs until no more moves are found
"RTN","FBAAVR5",181,0)
 . F  D  Q:FBOIENS=""
"RTN","FBAAVR5",182,0)
 . . N FBDA
"RTN","FBAAVR5",183,0)
 . . S FBOIENS="" ; init old IENs value for a move
"RTN","FBAAVR5",184,0)
 . . S FBDA=$O(^FBAA(161.45,"AN",FBFILE,FBCIENS,0))
"RTN","FBAAVR5",185,0)
 . . Q:'FBDA  ; no more moves
"RTN","FBAAVR5",186,0)
 . . S FBOIENS=$P($G(^FBAA(161.45,FBDA,0)),U,2) ; old IENs
"RTN","FBAAVR5",187,0)
 . . ; if old IEN is same as starting IEN, break out of the endless loop
"RTN","FBAAVR5",188,0)
 . . I FBOIENS=FBSIENS S FBOIENS="" Q
"RTN","FBAAVR5",189,0)
 . . ; set current IENs to the new value
"RTN","FBAAVR5",190,0)
 . . S:FBOIENS'="" FBCIENS=FBOIENS
"RTN","FBAAVR5",191,0)
 . ;
"RTN","FBAAVR5",192,0)
 . ; if current IENs is different from starting IENs update outputs
"RTN","FBAAVR5",193,0)
 . I FBCIENS'=FBSIENS D
"RTN","FBAAVR5",194,0)
 . . I FBFILE=162.03 S FBRET=$P(FBCIENS,",",4)_"^"_$P(FBCIENS,",",3)_"^"_$P(FBCIENS,",",2)_"^"_$P(FBCIENS,",",1)
"RTN","FBAAVR5",195,0)
 . . I FBFILE=162.04 S FBRET=$P(FBCIENS,",",2)_"^"_$P(FBCIENS,",",1)
"RTN","FBAAVR5",196,0)
 ;
"RTN","FBAAVR5",197,0)
 Q FBRET
"RTN","FBAAVR5",198,0)
 ;
"RTN","FBAAVR5",199,0)
 ;FBAAVR5
"RTN","FBBPG7Y")
0^8^B8669207^n/a
"RTN","FBBPG7Y",1,0)
FBBPG7Y ;SLT - PURGE BATCH FILE ENTRIES AFTER 7 YRS ;03/01/2015
"RTN","FBBPG7Y",2,0)
 ;;3.5;FEE BASIS;**158**;JAN 30, 1995;Build 94
"RTN","FBBPG7Y",3,0)
 ;;Per VA Directive 6402, this routine should not be modified.
"RTN","FBBPG7Y",4,0)
 Q
"RTN","FBBPG7Y",5,0)
 ;
"RTN","FBBPG7Y",6,0)
EN ; Main Entry Point
"RTN","FBBPG7Y",7,0)
 ;
"RTN","FBBPG7Y",8,0)
 N PRGDT,FNLZDT,IEN,ZNODE,BCNT,B,FBTYPE,FBDUZ
"RTN","FBBPG7Y",9,0)
 S PRGDT=$$FMADD^XLFDT(DT,-2555)
"RTN","FBBPG7Y",10,0)
 ;S PRGDT=2940121 ;$$FMADD^XLFDT(DT,-7650) - debug
"RTN","FBBPG7Y",11,0)
 S BCNT=0
"RTN","FBBPG7Y",12,0)
 ;
"RTN","FBBPG7Y",13,0)
 S FNLZDT="" K ^TMP($J,"FBBPG7Y")
"RTN","FBBPG7Y",14,0)
 F  S FNLZDT=$O(^FBAA(161.7,"AF",FNLZDT)) Q:('FNLZDT!(FNLZDT>PRGDT))  D
"RTN","FBBPG7Y",15,0)
 . S IEN=""
"RTN","FBBPG7Y",16,0)
 . F  S IEN=$O(^FBAA(161.7,"AF",FNLZDT,IEN)) Q:'IEN  D
"RTN","FBBPG7Y",17,0)
 . . S ZNODE=^FBAA(161.7,IEN,0),B=$P(ZNODE,U),FBTYPE=$P(ZNODE,U,3),FBDUZ=$P(ZNODE,U,5)
"RTN","FBBPG7Y",18,0)
 . . ;
"RTN","FBBPG7Y",19,0)
 . . I FBTYPE="B3" D MEDP(IEN)
"RTN","FBBPG7Y",20,0)
 . . I FBTYPE="B2" D TRAVP(IEN)
"RTN","FBBPG7Y",21,0)
 . . I FBTYPE="B5" D RPHP(IEN)
"RTN","FBBPG7Y",22,0)
 . . I FBTYPE="B9" D CHP(IEN)
"RTN","FBBPG7Y",23,0)
 . . ;
"RTN","FBBPG7Y",24,0)
 . . S BCNT=BCNT+1
"RTN","FBBPG7Y",25,0)
 . . S ^TMP($J,"FBBPG7Y",BCNT)=IEN_U_FNLZDT
"RTN","FBBPG7Y",26,0)
 . . S DIK="^FBAA(161.7,",DA=IEN D ^DIK
"RTN","FBBPG7Y",27,0)
 . ;
"RTN","FBBPG7Y",28,0)
 ;
"RTN","FBBPG7Y",29,0)
 D SNDBUL(PRGDT,BCNT)
"RTN","FBBPG7Y",30,0)
 Q
"RTN","FBBPG7Y",31,0)
 ;
"RTN","FBBPG7Y",32,0)
MEDP(BIEN) ;outpatient
"RTN","FBBPG7Y",33,0)
 ;
"RTN","FBBPG7Y",34,0)
 N PIEN,K,L,M
"RTN","FBBPG7Y",35,0)
 S PIEN=0
"RTN","FBBPG7Y",36,0)
 F  S PIEN=$O(^FBAAC("AC",BIEN,PIEN)) Q:'PIEN  D
"RTN","FBBPG7Y",37,0)
 . S K=0
"RTN","FBBPG7Y",38,0)
 . F  S K=$O(^FBAAC("AC",BIEN,PIEN,K)) Q:'K  D
"RTN","FBBPG7Y",39,0)
 . . S L=0
"RTN","FBBPG7Y",40,0)
 . . F  S L=$O(^FBAAC("AC",BIEN,PIEN,K,L)) Q:'L  D
"RTN","FBBPG7Y",41,0)
 . . . S M=0
"RTN","FBBPG7Y",42,0)
 . . . F  S M=$O(^FBAAC("AC",BIEN,PIEN,K,L,M)) Q:'M  D
"RTN","FBBPG7Y",43,0)
 . . . . I $D(^FBAAC(PIEN,1,K,1,L,1,M,0)) D
"RTN","FBBPG7Y",44,0)
 . . . . . S ^TMP($J,"FBBPG7Y",BCNT,"MEDP",K,L,M)=PIEN
"RTN","FBBPG7Y",45,0)
 . . . . . S $P(^(0),U,8)=""
"RTN","FBBPG7Y",46,0)
 K ^FBAAC("AC",BIEN)
"RTN","FBBPG7Y",47,0)
 Q
"RTN","FBBPG7Y",48,0)
 ;
"RTN","FBBPG7Y",49,0)
TRAVP(BIEN) ;travel
"RTN","FBBPG7Y",50,0)
 ;
"RTN","FBBPG7Y",51,0)
 N PIEN,K
"RTN","FBBPG7Y",52,0)
 S PIEN=0
"RTN","FBBPG7Y",53,0)
 F  S PIEN=$O(^FBAAC("AD",BIEN,PIEN)) Q:'PIEN  D
"RTN","FBBPG7Y",54,0)
 . S K=0
"RTN","FBBPG7Y",55,0)
 . F  S K=$O(^FBAAC("AD",BIEN,PIEN,K)) Q:'K  D
"RTN","FBBPG7Y",56,0)
 . . I $D(^FBAAC(PIEN,3,K,0)) D
"RTN","FBBPG7Y",57,0)
 . . . S ^TMP($J,"FBBPG7Y",BCNT,"TRAVP",K)=PIEN
"RTN","FBBPG7Y",58,0)
 . . . S $P(^(0),U,2)=""
"RTN","FBBPG7Y",59,0)
 K ^FBAAC("AD",BIEN)
"RTN","FBBPG7Y",60,0)
 Q
"RTN","FBBPG7Y",61,0)
 ;
"RTN","FBBPG7Y",62,0)
RPHP(BIEN) ;Rx
"RTN","FBBPG7Y",63,0)
 ;
"RTN","FBBPG7Y",64,0)
 N PIEN,K
"RTN","FBBPG7Y",65,0)
 S PIEN=0
"RTN","FBBPG7Y",66,0)
 F  S PIEN=$O(^FBAA(162.1,"AE",BIEN,PIEN)) Q:'PIEN  D
"RTN","FBBPG7Y",67,0)
 . S K=0
"RTN","FBBPG7Y",68,0)
 . F  S K=$O(^FBAA(162.1,"AE",BIEN,PIEN,K)) Q:'K  D
"RTN","FBBPG7Y",69,0)
 . . I $D(^FBAA(162.1,PIEN,"RX",K,0)) D
"RTN","FBBPG7Y",70,0)
 . . . S ^TMP($J,"FBBPG7Y",BCNT,"RPHP",K)=PIEN
"RTN","FBBPG7Y",71,0)
 . . . S $P(^(0),U,17)=""
"RTN","FBBPG7Y",72,0)
 K ^FBAA(162.1,"AE",BIEN),^FBAA(162.1,"AJ",BIEN)
"RTN","FBBPG7Y",73,0)
 Q
"RTN","FBBPG7Y",74,0)
 ;
"RTN","FBBPG7Y",75,0)
CHP(BIEN) ;inpatient
"RTN","FBBPG7Y",76,0)
 ;
"RTN","FBBPG7Y",77,0)
 N IIEN
"RTN","FBBPG7Y",78,0)
 S IIEN=0
"RTN","FBBPG7Y",79,0)
 F  S IIEN=$O(^FBAAI("AC",BIEN,IIEN)) Q:'IIEN  D
"RTN","FBBPG7Y",80,0)
 . I $D(^FBAAI(IIEN,0)) D
"RTN","FBBPG7Y",81,0)
 . . S ^TMP($J,"FBBPG7Y",BCNT,"CHP")=IIEN
"RTN","FBBPG7Y",82,0)
 . . S $P(^FBAAI(IIEN,0),U,17)=""
"RTN","FBBPG7Y",83,0)
 K ^FBAAI("AC",BIEN),^FBAAI("AE",BIEN)
"RTN","FBBPG7Y",84,0)
 Q
"RTN","FBBPG7Y",85,0)
 ;
"RTN","FBBPG7Y",86,0)
SNDBUL(PRGDT,BCNT) ;send a bulletin to a mail group
"RTN","FBBPG7Y",87,0)
 ;
"RTN","FBBPG7Y",88,0)
 N XMB,FBPGDT,Y,XMY
"RTN","FBBPG7Y",89,0)
 S XMB(1)=$S($D(^VA(200,DUZ,0)):$P(^(0),U),1:"Unknown User")
"RTN","FBBPG7Y",90,0)
 S Y=DT D PDF^FBAAUTL S FBPGDT=Y,XMB(2)=FBPGDT
"RTN","FBBPG7Y",91,0)
 S Y=PRGDT D PDF^FBAAUTL S XMB(3)=Y
"RTN","FBBPG7Y",92,0)
 S XMB(4)=BCNT
"RTN","FBBPG7Y",93,0)
 S XMB="FBAA BATCH PURGE"
"RTN","FBBPG7Y",94,0)
 ;debug
"RTN","FBBPG7Y",95,0)
 S XMY=DUZ
"RTN","FBBPG7Y",96,0)
 ;
"RTN","FBBPG7Y",97,0)
 D ^XMB
"RTN","FBBPG7Y",98,0)
 Q
"RTN","FBBPG7Y",99,0)
 ;
"RTN","FBCHEAP")
0^22^B21016855^B21240885
"RTN","FBCHEAP",1,0)
FBCHEAP ;AISC/DMK - ENTER AMOUNT PAID FROM PRICER ;10/1/2014
"RTN","FBCHEAP",2,0)
 ;;3.5;FEE BASIS;**38,55,61,77,154,158**;JAN 30, 1995;Build 94
"RTN","FBCHEAP",3,0)
 ;;Per VA Directive 6402, this routine should not be modified.
"RTN","FBCHEAP",4,0)
DIC W ! S DIC="^FBAA(161.7,",DIC(0)="AEQMZ",DIC("S")="I $P(^(0),U,15)=""Y""&($G(^(""ST""))=""P"")"_$S($D(^XUSEC("FBAA LEVEL 2",DUZ)):"",1:"&($P(^(0),U,5)=DUZ)") D ^DIC
"RTN","FBCHEAP",5,0)
 G END:X="^"!(X=""),DIC:Y<0 S FBN=+Y,FBN(0)=Y(0)
"RTN","FBCHEAP",6,0)
ASK S DIR(0)="Y",DIR("A")="Would you like to reject any invoices from the pricer",DIR("B")="NO" D ^DIR K DIR G END:$D(DIRUT),REJECT:Y
"RTN","FBCHEAP",7,0)
DIC1 W !! S DIC="^FBAAI(",DIC(0)="AEQMZ",DIC("A")="Select Patient: ",D="D",DIC("S")="I $P(^(0),U,17)=FBN",DIC("W")="W ?25,$S($D(^DPT($P(^(0),U,4),0)):$P(^(0),U),1:"""")" D ^DIC S DIE=DIC K DIC,D G END:X="^",DIC:X=""!(Y<0)
"RTN","FBCHEAP",8,0)
 S (DA,FBI)=+Y,FBI(0)=Y(0) G END:'$D(^FBAAI(FBI,0))
"RTN","FBCHEAP",9,0)
DISP S FBLISTC="" D HOME^%ZIS,START^FBCHDI2
"RTN","FBCHEAP",10,0)
 W !!
"RTN","FBCHEAP",11,0)
 ;
"RTN","FBCHEAP",12,0)
 ;enforce separation of duties
"RTN","FBCHEAP",13,0)
 S FBDFN=$P(FBI(0),U,4)
"RTN","FBCHEAP",14,0)
 S FB7078I=$P(FBI(0),U,5)
"RTN","FBCHEAP",15,0)
 S FTP=$S(FB7078I]"":$O(^FBAAA("AG",FB7078I,FBDFN,0)),1:"")
"RTN","FBCHEAP",16,0)
 I FBDFN,FTP,'$$UOKPAY^FBUTL9(FBDFN,FTP) D  G DIC1
"RTN","FBCHEAP",17,0)
 . W "You cannot process a payment associated with authorization ",FBDFN,"-",FTP
"RTN","FBCHEAP",18,0)
 . W !,"due to separation of duties."
"RTN","FBCHEAP",19,0)
 ;
"RTN","FBCHEAP",20,0)
 S FBJ=$P(FBI(0),"^",8)
"RTN","FBCHEAP",21,0)
 ; set FB1725 flag = true if payment for a 38 U.S.C. 1725 claim
"RTN","FBCHEAP",22,0)
 S FB1725=$S($P(FBI(0),U,5)["FB583":+$P($G(^FB583(+$P(FBI(0),U,5),0)),U,28),1:0)
"RTN","FBCHEAP",23,0)
 S DR="26;S FBPAMT=X;W:FB1725 !?2,""**Payment is for emergency treatment under 38 U.S.C. 1725."";W:FB1725&($G(FBPAMT)>0) !?2,""  70% of Pricer Amount = ""_$J(.7*FBPAMT,0,2);8;S FBK=X"
"RTN","FBCHEAP",24,0)
 ;S DR(1,162.5,1)="S:(FBJ-FBK)'>0 Y=24;9//^S X=$S(FBJ-FBK:FBJ-FBK,1:"""");S:'X Y=24;10;S:X'=4 Y=24;18"
"RTN","FBCHEAP",25,0)
 S DR(1,162.5,1)="S FBX=$$ADJ^FBUTL2(FBJ-FBK,.FBADJ,5,,,1,.FBRRMK,1)"
"RTN","FBCHEAP",26,0)
 S DR(1,162.5,2)="@20;24R;S:$$INPICD^FBCSV1(X,$G(DA),$P($G(FBIN),""^"",6)) Y=""@20"";24.5R"
"RTN","FBCHEAP",27,0)
 S DIE("NO^")=""
"RTN","FBCHEAP",28,0)
 D
"RTN","FBCHEAP",29,0)
 . N ICDVDT S ICDVDT=$P($G(FBIN),"^",6) D ^DIE
"RTN","FBCHEAP",30,0)
 K DIE("NO^") G END:$D(DTOUT)
"RTN","FBCHEAP",31,0)
 ; file adjustment reasons
"RTN","FBCHEAP",32,0)
 D FILEADJ^FBCHFA(FBI_",",.FBADJ)
"RTN","FBCHEAP",33,0)
 ; file remittance remarks
"RTN","FBCHEAP",34,0)
 D FILERR^FBCHFR(FBI_",",.FBRRMK)
"RTN","FBCHEAP",35,0)
 D TOT S $P(FBN(0),"^",9)=FBK(1),^FBAA(161.7,FBN,0)=FBN(0)
"RTN","FBCHEAP",36,0)
 D CHK I $D(FBCHSW) K FBCHSW G DIC1
"RTN","FBCHEAP",37,0)
 I '$D(FBCHSW) S DA=FBN,(DIC,DIE)="^FBAA(161.7,",DIC(0)="LQ",DR="11////^S X=""A""",DLAYGO=161.7 D ^DIE G DIC
"RTN","FBCHEAP",38,0)
 G DIC1:$O(^FBAAI("AC",FBN,FBI))
"RTN","FBCHEAP",39,0)
END K DA,DFN,DIC,DIE,DR,FBAAOUT,FBDX,FBI,FBIN,FBJ,FBK,FBLISTC,FBN,FBPROC,FBVEN,FBVID,I,J,K,L,POP,Q,VA,VADM,X,POP,YS,VAL,ZZ,Y,FBRR,FBTYPE,FBCHSW,DIRUT,FB1725,FBPAMT
"RTN","FBCHEAP",40,0)
 K FBADJ,FBRRMK,FBDFN,FB7078I,FTP
"RTN","FBCHEAP",41,0)
 D END^FBCHDI
"RTN","FBCHEAP",42,0)
 Q
"RTN","FBCHEAP",43,0)
REJECT S FBTYPE="B9"
"RTN","FBCHEAP",44,0)
 W ! S DIC="^FBAAI(",DIC(0)="AEQMZ",DIC("S")="I $P(^(0),U,17)=FBN&($P(^(0),U,9)="""")",DIC("W")="W ?25,$S($D(^DPT($P(^(0),U,4),0)):$P(^(0),U),1:"""")" D ^DIC G END:X=""!(X="^"),REJECT:Y<0 S FBI=+Y,FBI(0)=Y(0)
"RTN","FBCHEAP",45,0)
 S FBLISTC="" D HOME^%ZIS,START^FBCHDI2
"RTN","FBCHEAP",46,0)
 ;
"RTN","FBCHEAP",47,0)
 ;enforce separation of duties
"RTN","FBCHEAP",48,0)
 S FBDFN=$P(FBI(0),U,4)
"RTN","FBCHEAP",49,0)
 S FB7078I=$P(FBI(0),U,5)
"RTN","FBCHEAP",50,0)
 S FTP=$S(FB7078I]"":$O(^FBAAA("AG",FB7078I,FBDFN,0)),1:"")
"RTN","FBCHEAP",51,0)
 I FBDFN,FTP,'$$UOKPAY^FBUTL9(FBDFN,FTP) D  G REJECT
"RTN","FBCHEAP",52,0)
 . W !,"You cannot process a payment associated with authorization ",FBDFN,"-",FTP
"RTN","FBCHEAP",53,0)
 . W !,"due to separation of duties."
"RTN","FBCHEAP",54,0)
 ;
"RTN","FBCHEAP",55,0)
RASK S DIR(0)="F^2:40",DIR("A")="Enter reason for rejecting (2-40 characters)",DIR("?")="Enter a reason for rejecting payment from Austin Pricer" D ^DIR K DIR G END:$D(DIRUT) S FBRR=X
"RTN","FBCHEAP",56,0)
ASKSU S DIR(0)="Y",DIR("A")="Are you sure you want to reject this item",DIR("B")="NO" D ^DIR K DIR G END:$D(DIRUT),DIC:'Y
"RTN","FBCHEAP",57,0)
 S (DLAYGO,DIDEL)=162.5,DIC(0)="AEQLM"
"RTN","FBCHEAP",58,0)
 S (DIC,DIE)="^FBAAI(",DA=FBI,DR="13////^S X=""P"";14////^S X=FBRR;15////^S X=FBN;20///^S X=""@""" D ^DIE
"RTN","FBCHEAP",59,0)
 S $P(FBN(0),"^",10)=$P(FBN(0),"^",10)-1,$P(FBN(0),"^",11)=$P(FBN(0),"^",11)-1,$P(FBN(0),"^",17)="Y",^FBAA(161.7,FBN,0)=FBN(0)
"RTN","FBCHEAP",60,0)
RASKSU I $O(^FBAAI("AC",FBN,FBI)) S DIR(0)="Y",DIR("A")="Reject another",DIR("B")="NO" D ^DIR K DIR G END:$D(DIRUT),REJECT:Y
"RTN","FBCHEAP",61,0)
 I $P(^FBAA(161.7,FBN,0),"^",11)=0 S (DIC,DIE)="^FBAA(161.7,",DIC(0)="AEQM",DA=FBN,DR="11////^S X=""V"";12////^S X=DT" D ^DIE G DIC
"RTN","FBCHEAP",62,0)
 G END
"RTN","FBCHEAP",63,0)
CHK F I=0:0 S I=$O(^FBAAI("AC",FBN,I)) Q:I'>0  I $D(^FBAAI(I,0)),$P(^(0),"^",9)="" S FBCHSW=1
"RTN","FBCHEAP",64,0)
 Q
"RTN","FBCHEAP",65,0)
TOT S FBK(1)=0 F I=0:0 S I=$O(^FBAAI("AC",FBN,I)) Q:'I  S FBK(1)=FBK(1)+$P($G(^FBAAI(I,0)),"^",9)
"RTN","FBCHEAP",66,0)
 Q
"RTN","FBCHFR")
0^23^B8623931^B2637264
"RTN","FBCHFR",1,0)
FBCHFR ;WOIFO/SAB-FILE REMITTANCE REMARKS FOR CH/CNH PAYMENT ;7/17/2003
"RTN","FBCHFR",2,0)
 ;;3.5;FEE BASIS;**61,158**;JAN 30, 1995;Build 94
"RTN","FBCHFR",3,0)
 ;;Per VA Directive 6402, this routine should not be modified.
"RTN","FBCHFR",4,0)
 Q
"RTN","FBCHFR",5,0)
FILERR(FBIENS,FBRRMK) ; File Remittance Remarks
"RTN","FBCHFR",6,0)
 ;
"RTN","FBCHFR",7,0)
 ; Input
"RTN","FBCHFR",8,0)
 ;   FBIENS -  required, internal entry numbers for subfile 162.5
"RTN","FBCHFR",9,0)
 ;             in standard format as specified for FileMan DBS calls
"RTN","FBCHFR",10,0)
 ;   FBRRMK -  required, array passed by reference
"RTN","FBCHFR",11,0)
 ;             array of remittance remarks to file
"RTN","FBCHFR",12,0)
 ;             array does not have to contain any data or be defined
"RTN","FBCHFR",13,0)
 ;             format
"RTN","FBCHFR",14,0)
 ;               FBRRMK(FBADJ,#)=FBRRMKC
"RTN","FBCHFR",15,0)
 ;             where
"RTN","FBCHFR",16,0)
 ;               FBADJ = Adjustment Reason IEN (#161.91)
"RTN","FBCHFR",17,0)
 ;               # = sequentially assigned number starting with 1
"RTN","FBCHFR",18,0)
 ;               FBRRMKC = remittance remark (internal value file 162.93)
"RTN","FBCHFR",19,0)
 ; Output
"RTN","FBCHFR",20,0)
 ;   Data in File 162.5 will be modified
"RTN","FBCHFR",21,0)
 ;
"RTN","FBCHFR",22,0)
 N FB,FBFDA,FBI,FBSIENS
"RTN","FBCHFR",23,0)
 ;
"RTN","FBCHFR",24,0)
 ; delete remitance remarks currently on file
"RTN","FBCHFR",25,0)
 D GETS^DIQ(162.5,FBIENS,"59*","","FB")
"RTN","FBCHFR",26,0)
 K FBFDA
"RTN","FBCHFR",27,0)
 S FBSIENS="" F  S FBSIENS=$O(FB(162.559,FBSIENS)) Q:FBSIENS=""  D
"RTN","FBCHFR",28,0)
 . S FBFDA(162.559,FBSIENS,.01)="@"
"RTN","FBCHFR",29,0)
 I $D(FBFDA) D FILE^DIE("","FBFDA")
"RTN","FBCHFR",30,0)
 ;
"RTN","FBCHFR",31,0)
  ; file remarks from input array
"RTN","FBCHFR",32,0)
 K FBFDA
"RTN","FBCHFR",33,0)
 S (FBADJ,CNTR)=0
"RTN","FBCHFR",34,0)
 D DA^DILF(FBIENS,.FBDA)
"RTN","FBCHFR",35,0)
 F  S FBADJ=$O(FBRRMK(FBADJ)) Q:'FBADJ  D
"RTN","FBCHFR",36,0)
 . S ADJDA=$S(FBADJ'=999:$$GETADJI(FBADJ,.FBDA),1:FBADJ) ;999 indicates a CARCless RARC
"RTN","FBCHFR",37,0)
 . S FBI=0
"RTN","FBCHFR",38,0)
 . F  S FBI=$O(FBRRMK(FBADJ,FBI)) Q:'FBI  D
"RTN","FBCHFR",39,0)
 . . S CNTR=CNTR+1
"RTN","FBCHFR",40,0)
 . . S FBFDA(162.559,"+"_CNTR_","_FBIENS,.01)=$P(FBRRMK(FBADJ,FBI),U)
"RTN","FBCHFR",41,0)
 . . S FBFDA(162.559,"+"_CNTR_","_FBIENS,1)=ADJDA
"RTN","FBCHFR",42,0)
 I $D(FBFDA) D UPDATE^DIE("","FBFDA")
"RTN","FBCHFR",43,0)
 ;
"RTN","FBCHFR",44,0)
 Q
"RTN","FBCHFR",45,0)
 ;
"RTN","FBCHFR",46,0)
GETADJI(ADJI,FBDA) ; get correct DA from ADJUSTMENT multiple
"RTN","FBCHFR",47,0)
 ;
"RTN","FBCHFR",48,0)
 N DA
"RTN","FBCHFR",49,0)
 I $D(FBDA)'=1 Q ""
"RTN","FBCHFR",50,0)
 S DA=""
"RTN","FBCHFR",51,0)
 I $G(ADJI),$D(^FBAAI(FBDA,8,"B",ADJI)) D
"RTN","FBCHFR",52,0)
 . S DA=$O(^FBAAI(FBDA,8,"B",ADJI,DA))
"RTN","FBCHFR",53,0)
 Q DA
"RTN","FBCHFR",54,0)
 ;
"RTN","FBCHFR",55,0)
LOADRR(FBIENS,FBRRMK) ; Load Remittance Remarks
"RTN","FBCHFR",56,0)
 ; Input
"RTN","FBCHFR",57,0)
 ;   FBIENS -  required, internal entry numbers for subfile 162.5
"RTN","FBCHFR",58,0)
 ;             in standard format as specified for FileMan DBS calls
"RTN","FBCHFR",59,0)
 ;   FBRRMK - required, array passed by reference
"RTN","FBCHFR",60,0)
 ;             array to load adjustments into
"RTN","FBCHFR",61,0)
 ; Output
"RTN","FBCHFR",62,0)
 ;   FBRRMK - the FBRRMK input array passed by reference will be modified
"RTN","FBCHFR",63,0)
 ;             format
"RTN","FBCHFR",64,0)
 ;               FBRRMK(#)=FBRRMKC
"RTN","FBCHFR",65,0)
 ;             where
"RTN","FBCHFR",66,0)
 ;               # = sequentially assigned number starting with 1
"RTN","FBCHFR",67,0)
 ;               FBRRMKC = remittance remark (internal value file 162.93)
"RTN","FBCHFR",68,0)
 ;             if no remarks are on file then the array will be undefined
"RTN","FBCHFR",69,0)
 N FBC,FBI,FBSIENS,ADJMI,FBDA,ADJI,RRI,FB
"RTN","FBCHFR",70,0)
 ;
"RTN","FBCHFR",71,0)
 K FBRRMK
"RTN","FBCHFR",72,0)
 ;
"RTN","FBCHFR",73,0)
 S FBC=0,ADJMI=""
"RTN","FBCHFR",74,0)
 D DA^DILF(FBIENS,.FBDA)
"RTN","FBCHFR",75,0)
 D GETS^DIQ(162.5,FBIENS,"59*","I","FB")
"RTN","FBCHFR",76,0)
 S FBSIENS=""
"RTN","FBCHFR",77,0)
 F  S FBSIENS=$O(FB(162.559,FBSIENS)) Q:FBSIENS=""  D
"RTN","FBCHFR",78,0)
 . S RRI=FB(162.559,FBSIENS,.01,"I")
"RTN","FBCHFR",79,0)
 . S ADJMI=FB(162.559,FBSIENS,1,"I")
"RTN","FBCHFR",80,0)
 . I ADJMI,$D(^FBAAI(FBDA,8,ADJMI,0)) S ADJI=$P(^FBAAI(FBDA,8,ADJMI,0),U)
"RTN","FBCHFR",81,0)
 . E  S ADJI=999
"RTN","FBCHFR",82,0)
 . S FBC=$S($D(FBRRMK(ADJI)):$O(FBRRMK(ADJI,FBC)),1:0)
"RTN","FBCHFR",83,0)
 . S FBRRMK(ADJI,FBC+1)=RRI
"RTN","FBCHFR",84,0)
 ;
"RTN","FBCHFR",85,0)
 Q
"RTN","FBCHFR",86,0)
 ;
"RTN","FBCHFR",87,0)
RRL(FBIENS) ; Remittance Remarks List Extrinsic Function
"RTN","FBCHFR",88,0)
 ; Input
"RTN","FBCHFR",89,0)
 ;   FBIENS -  required, internal entry number for file 162.5
"RTN","FBCHFR",90,0)
 ;             in standard format as specified for FileMan DBS calls
"RTN","FBCHFR",91,0)
 ; Result
"RTN","FBCHFR",92,0)
 ;   string containing sorted list (by external code) of remarks
"RTN","FBCHFR",93,0)
 ;   format
"RTN","FBCHFR",94,0)
 ;      FBRRMKCE 1, FBRRMKCE 2
"RTN","FBCHFR",95,0)
 ;   where
"RTN","FBCHFR",96,0)
 ;      FBRRMKCE = remittance remark code (external value)
"RTN","FBCHFR",97,0)
 N FBRET,FBRRMK
"RTN","FBCHFR",98,0)
 D LOADRR^FBCHFR(FBIENS,.FBRRMK)
"RTN","FBCHFR",99,0)
 S FBRET=$$RRL^FBUTL4(.FBRRMK)
"RTN","FBCHFR",100,0)
 Q FBRET
"RTN","FBCHFR",101,0)
 ;
"RTN","FBCHFR",102,0)
KILLRR(X,DA) ; Called from FEE BASIS INVOICE (#162.5), 
"RTN","FBCHFR",103,0)
 ;             ADJUSTMENT (#58), ADJUSTMENT REASON (.01)
"RTN","FBCHFR",104,0)
 ;             to delete REMITTANCE REMARK (#59) entries associated
"RTN","FBCHFR",105,0)
 ;             with adjustment reasons being deleted.
"RTN","FBCHFR",106,0)
 ;
"RTN","FBCHFR",107,0)
 N FBIENS,FB,FBFDA,FBSIENS
"RTN","FBCHFR",108,0)
 ;
"RTN","FBCHFR",109,0)
 S FBIENS=$G(DA(1))_","
"RTN","FBCHFR",110,0)
 D GETS^DIQ(162.5,FBIENS,"59*","","FB")
"RTN","FBCHFR",111,0)
 ;
"RTN","FBCHFR",112,0)
 S FBSIENS="" F  S FBSIENS=$O(FB(162.559,FBSIENS)) Q:FBSIENS=""  D
"RTN","FBCHFR",113,0)
 . I FB(162.559,FBSIENS,1)=$G(DA) S FBFDA(162.559,FBSIENS,.01)="@"
"RTN","FBCHFR",114,0)
 I $D(FBFDA) D FILE^DIE("","FBFDA")
"RTN","FBCHFR",115,0)
 ;
"RTN","FBCHFR",116,0)
 Q
"RTN","FBCHFR",117,0)
 ;FBCHFR
"RTN","FBCHPET")
0^24^B43033601^B44036498
"RTN","FBCHPET",1,0)
FBCHPET ;AISC/DMK - EDIT ANCILLARY PAYMENT ;10/02/2014
"RTN","FBCHPET",2,0)
 ;;3.5;FEE BASIS;**4,38,61,77,116,108,124,132,123,154,158**;JAN 30, 1995;Build 94
"RTN","FBCHPET",3,0)
 ;;Per VA Directive 6402, this routine should not be modified.
"RTN","FBCHPET",4,0)
 S FY=$E(DT,1,3)+1700+$S($E(4,5)>9:1,1:0)
"RTN","FBCHPET",5,0)
GETPT I $G(BAT) D
"RTN","FBCHPET",6,0)
 .I '$D(^FBAAC("AC",+BAT)) F I=9,10,11 S $P(^FBAA(161.7,+BAT,0),U,I)=""
"RTN","FBCHPET",7,0)
 .I $D(^FBAAC("AC",+BAT)) D  S $P(^FBAA(161.7,+BAT,0),U,11)=I,$P(^(0),U,9)=$G(FBTOT) K I,FBTOT
"RTN","FBCHPET",8,0)
 ..N J,K,L,M S (I,J,K,L,M,FBTOT)=0
"RTN","FBCHPET",9,0)
 ..F  S J=$O(^FBAAC("AC",+BAT,J)) Q:'J  F  S K=$O(^FBAAC("AC",+BAT,J,K)) Q:'K  F  S L=$O(^FBAAC("AC",+BAT,J,K,L)) Q:'L  F  S M=$O(^FBAAC("AC",+BAT,J,K,L,M)) Q:'M  I $D(^FBAAC(J,1,K,1,L,1,M,0)) S I=I+1,FBTOT=FBTOT+$P(^(0),U,3)
"RTN","FBCHPET",10,0)
 W !! S DIC="^FBAAC(",DIC(0)="AEQM" D ^DIC G END:X="^"!(X=""),GETPT:Y<0 S (DFN,FBDA(3))=+Y
"RTN","FBCHPET",11,0)
 S:'$D(^FBAAC(DFN,1,0)) ^FBAAC(DFN,1,0)="^162.01P^0^0"
"RTN","FBCHPET",12,0)
 S DIC=DIC_DFN_",1,"
"RTN","FBCHPET",13,0)
GETVD W !! S DIC(0)="AEQM" D ^DIC G GETPT:X="^"!(X=""),GETVD:Y<0 S (FBV,FBVD,FBDA(2))=+Y
"RTN","FBCHPET",14,0)
 S:'$D(^FBAAC(DFN,1,FBDA(2),1,0)) ^FBAAC(DFN,1,FBDA(2),1,0)="^162.02DA^0^0"
"RTN","FBCHPET",15,0)
 S DIC=DIC_FBVD_",1,"
"RTN","FBCHPET",16,0)
GETDT S DIC(0)="AEQM",DIC("A")="Date of Service: " D ^DIC K DIC("A") G GETPT:X="^"!(X=""),GETDT:Y<0 S (FBSD,FBSDI,FBDA(1))=+Y,FBAADT=$P(Y,U,2) S:'$D(^FBAAC(DFN,1,FBDA(2),1,FBDA(1),1,0)) ^FBAAC(DFN,1,FBDA(2),1,FBDA(1),1,0)="^162.03A^0^0"
"RTN","FBCHPET",17,0)
 S FBZ=DIC_FBSD_",1,"
"RTN","FBCHPET",18,0)
SERV S DA(3)=FBDA(3),DA(2)=FBDA(2),DA(1)=FBDA(1)
"RTN","FBCHPET",19,0)
 S DIC("W")="N FBX S FBX=$$MODL^FBAAUTL4(""^FBAAC(FBDA(3),1,FBDA(2),1,FBDA(1),1,+Y,""""M"""")"",""E"") W:FBX]"""" ""    CPT Modifier(s): "",FBX Q"
"RTN","FBCHPET",20,0)
 S DIC=FBZ,DIC(0)="AEQMZ"
"RTN","FBCHPET",21,0)
 D
"RTN","FBCHPET",22,0)
 . N ICPTVDT S ICPTVDT=$G(FBAADT) D ^DIC
"RTN","FBCHPET",23,0)
 G GETPT:X="^"!(X=""),SERV:Y<0 S (FBSV,FBAACPI,FBDA)=+Y,BAT=$P(Y(0),U,8),FBDUZ=$P(Y(0),U,7),(FBAACP,FBAACP(0))=$P(Y,U,2),K=$P(Y(0),U,3),FBAAPTC=$P(Y(0),U,20),J(0)=$P(Y(0),U,2)
"RTN","FBCHPET",24,0)
 ;
"RTN","FBCHPET",25,0)
 ; enforce separation of duties
"RTN","FBCHPET",26,0)
 S FTP=$P($G(^FBAAC(FBDA(3),1,FBDA(2),1,FBDA(1),1,FBDA,3)),U,9)
"RTN","FBCHPET",27,0)
 I '$$UOKPAY^FBUTL9(DFN,FTP) D  G GETPT
"RTN","FBCHPET",28,0)
 . W !!,"You cannot process a payment associated with authorization ",DFN,"-",FTP
"RTN","FBCHPET",29,0)
 . W !,"due to separation of duties."
"RTN","FBCHPET",30,0)
 ;
"RTN","FBCHPET",31,0)
 ; set FB1725 true (1) if payment is for a Mill Bill claim
"RTN","FBCHPET",32,0)
 S FB1725=$S($P(Y(0),U,13)["FB583":+$P($G(^FB583(+$P(Y(0),U,13),0)),U,28),1:0)
"RTN","FBCHPET",33,0)
 I FBDUZ'=DUZ&('$D(^XUSEC("FBAA LEVEL 2",DUZ))) W !!,*7,"Sorry,only the clerk who entered the payment or",!," a holder of the FBAA LEVEL 2 key can edit this payment." G GETPT
"RTN","FBCHPET",34,0)
 ;S FBAAMM1=$P($G(^FBAAC(FBDA(3),1,FBDA(2),1,FBDA(1),1,FBDA,2)),U,2)
"RTN","FBCHPET",35,0)
 S FBFSAMT(0)=$P($G(^FBAAC(FBDA(3),1,FBDA(2),1,FBDA(1),1,FBDA,2)),U,12)
"RTN","FBCHPET",36,0)
 ; determine lesser of original fee schedule amount and amount claimed
"RTN","FBCHPET",37,0)
 S FBAMTPD(0)=$S(FBFSAMT(0)="":J(0),FBFSAMT(0)>J(0):J(0),1:FBFSAMT(0))
"RTN","FBCHPET",38,0)
 S FBMODL=$$MODL^FBAAUTL4("^FBAAC("_FBDA(3)_",1,"_FBDA(2)_",1,"_FBDA(1)_",1,"_FBDA_",""M"")")
"RTN","FBCHPET",39,0)
 ; load current adjustment data
"RTN","FBCHPET",40,0)
 D LOADADJ^FBAAFA(FBDA_","_FBDA(1)_","_FBDA(2)_","_FBDA(3)_",",.FBADJ)
"RTN","FBCHPET",41,0)
 ; save adjustment data prior to edit session in sorted list
"RTN","FBCHPET",42,0)
 S FBADJL(0)=$$ADJL^FBUTL2(.FBADJ) ; sorted list of original adjustments
"RTN","FBCHPET",43,0)
 ; load current remittance remark data
"RTN","FBCHPET",44,0)
 D LOADRR^FBAAFR(FBDA_","_FBDA(1)_","_FBDA(2)_","_FBDA(3)_",",.FBRRMK)
"RTN","FBCHPET",45,0)
 ; save remittance remarks prior to edit session in sorted list
"RTN","FBCHPET",46,0)
 S FBRRMKL(0)=$$RRL^FBUTL4(.FBRRMK)
"RTN","FBCHPET",47,0)
 S FBFPPSC(0)=$P($G(^FBAAC(FBDA(3),1,FBDA(2),1,FBDA(1),1,FBDA,3)),U)
"RTN","FBCHPET",48,0)
 S FBFPPSC=FBFPPSC(0)
"RTN","FBCHPET",49,0)
 S FBFPPSL(0)=$P($G(^FBAAC(FBDA(3),1,FBDA(2),1,FBDA(1),1,FBDA,3)),U,2)
"RTN","FBCHPET",50,0)
 S FBFPPSL=FBFPPSL(0)
"RTN","FBCHPET",51,0)
 G:BAT']"" EDIT
"RTN","FBCHPET",52,0)
 ; check batch status
"RTN","FBCHPET",53,0)
 S FBSTAT=$P($G(^FBAA(161.7,BAT,"ST")),U) ; batch status
"RTN","FBCHPET",54,0)
 I FBSTAT="S",'$D(^XUSEC("FBAA LEVEL 2",DUZ)) W !!,*7,"Sorry, only a holder of the FBAA LEVEL 2 key can edit a payment",!," once the batch has been released." G GETPT
"RTN","FBCHPET",55,0)
 I "^T^F^V^"[(U_FBSTAT_U) W !!,*7,"Sorry, you cannot edit a payment when the batch has been sent to Austin." G GETPT
"RTN","FBCHPET",56,0)
 K FBSTAT
"RTN","FBCHPET",57,0)
EDIT S DA=FBSV
"RTN","FBCHPET",58,0)
 ;
"RTN","FBCHPET",59,0)
 ; first edit CPT code and modifiers
"RTN","FBCHPET",60,0)
 D CPTM^FBAALU(FBAADT,DFN,FBAACP(0),FBMODL) I '$G(FBGOT) G GETPT
"RTN","FBCHPET",61,0)
 ; if CPT was changed then update file
"RTN","FBCHPET",62,0)
 I FBAACP'=FBAACP(0) D  I FBAACP="@" G GETPT
"RTN","FBCHPET",63,0)
 . N FBIENS,FBFDA
"RTN","FBCHPET",64,0)
 . S FBIENS=FBDA_","_FBDA(1)_","_FBDA(2)_","_FBDA(3)_","
"RTN","FBCHPET",65,0)
 . S FBFDA(162.03,FBIENS,.01)=FBAACP
"RTN","FBCHPET",66,0)
 . D FILE^DIE("","FBFDA") D MSG^DIALOG()
"RTN","FBCHPET",67,0)
 ; if modifiers changed then update file
"RTN","FBCHPET",68,0)
 I FBMODL'=$$MODL^FBAAUTL4("FBMODA") D REPMOD^FBAAUTL4(FBDA(3),FBDA(2),FBDA(1),FBDA)
"RTN","FBCHPET",69,0)
 ;
"RTN","FBCHPET",70,0)
 ; Check for IPAC data requirements for Federal Vendors (FB*3.5*123)
"RTN","FBCHPET",71,0)
 I '$$IPACEDIT^FBAAPET1(162.03,.FBDA) G SERV
"RTN","FBCHPET",72,0)
 ;
"RTN","FBCHPET",73,0)
 ; now edit remaining fields
"RTN","FBCHPET",74,0)
 S DIE("NO^")=""
"RTN","FBCHPET",75,0)
 S DR="48;47;S FBUNITS=X;42R;S FBZIP=X;S:$$ANES^FBAAFS($$CPT^FBAAUTL4(FBAACP)) Y=""@2"";43///@;S FBTIME=X;S Y=""@3"";@2;43R;S FBTIME=X;@3"
"RTN","FBCHPET",76,0)
 ; fb*3.5*116 remove edit of interest indicator (162.03,34) to prevent different interest indicator values at line item level; interest indicator set at invoice level only;
"RTN","FBCHPET",77,0)
 S DR(1,162.03,1)="S FBAAMM=$S(FBAAPTC=""R"":"""",$D(FB583):"""",1:1);D PPT^FBAACO1(FBAAMM1,FBCNTRP,1);54///@;54////^S X=$G(FBCNTRP);30R;S FBHCFA(30)=X;1;S J=X;Q"
"RTN","FBCHPET",78,0)
 S DR(1,162.03,2)="D FEEDT^FBAACO3;44///@;44///^S X=FBFSAMT;45///@;45///^S X=FBFSUSD;S:FBAMTPD'>0!(FBAMTPD=FBAMTPD(0)) Y=""@4"";2///^S X=FBAMTPD;@4;2//^S X=FBAMTPD;S K=X"
"RTN","FBCHPET",79,0)
 S DR(1,162.03,3)="K FBADJD;M FBADJD=FBADJ;S FBX=$$ADJ^FBUTL2(J-K,.FBADJ,5,,.FBADJD,1,.FBRRMK,1)"
"RTN","FBCHPET",80,0)
 S DR(1,162.03,4)="S FBX=$$FPPSC^FBUTL5(1,FBFPPSC);S:FBX=-1 Y=0;S:FBX="""" Y=""@5"";50///^S X=FBX;S FBFPPSC=X;S FBX=$$FPPSL^FBUTL5(FBFPPSL);S:FBX=-1 Y=0;51///^S X=FBX;S FBFPPCL=X;S Y=""@55"";@5;50///@;S FBFPPSC="""";51///@;S FBFPPCL="""";@55"
"RTN","FBCHPET",81,0)
 S DR(1,162.03,5)="@5;K DIE(""NO^"");W !,""Exit ('^') allowed now"";26;S PRC(""SITE"")=X;8;@13;13;I $$BADDATE^FBCHPET(FBAADT,X) S Y=""@13"";Q;33;49"
"RTN","FBCHPET",82,0)
 S DR(1,162.03,6)="15;16;17////^S X=1"
"RTN","FBCHPET",83,0)
 S DIE=FBZ
"RTN","FBCHPET",84,0)
 D
"RTN","FBCHPET",85,0)
 . N ICPTVDT,ICDVDT,FB583,FBAAMM,FBAAMM1,FBCNTRA,FBCNTRP,FBVEN,FTP
"RTN","FBCHPET",86,0)
 . S (ICPTVDT,ICDVDT)=$G(FBAADT)
"RTN","FBCHPET",87,0)
 . ; set variables for call to PPT^FBAACO1
"RTN","FBCHPET",88,0)
 . S FBAAMM1=$P($G(^FBAAC(FBDA(3),1,FBDA(2),1,FBDA(1),1,FBDA,2)),U,2)
"RTN","FBCHPET",89,0)
 . S FBCNTRP=$P($G(^FBAAC(FBDA(3),1,FBDA(2),1,FBDA(1),1,FBDA,3)),U,8)
"RTN","FBCHPET",90,0)
 . S X=$P($G(^FBAAC(FBDA(3),1,FBDA(2),1,FBDA(1),1,FBDA,0)),U,13)
"RTN","FBCHPET",91,0)
 . S:X[";FB583(" FB583=+X
"RTN","FBCHPET",92,0)
 . S FTP=$P($G(^FBAAC(FBDA(3),1,FBDA(2),1,FBDA(1),1,FBDA,3)),U,9)
"RTN","FBCHPET",93,0)
 . S FBVEN=$S(FTP:$P($G(^FBAAA(DFN,1,FTP,0)),U,4),1:"")
"RTN","FBCHPET",94,0)
 . S FBCNTRA=$S(FTP:$P($G(^FBAAA(DFN,1,FTP,0)),U,22),1:"")
"RTN","FBCHPET",95,0)
 . D ^DIE
"RTN","FBCHPET",96,0)
 ; if adjustment data changed then file
"RTN","FBCHPET",97,0)
 I $$ADJL^FBUTL2(.FBADJ)'=FBADJL(0) D FILEADJ^FBAAFA(FBDA_","_FBDA(1)_","_FBDA(2)_","_FBDA(3)_",",.FBADJ)
"RTN","FBCHPET",98,0)
 ; if remit remark data changed then file
"RTN","FBCHPET",99,0)
 I $$RRL^FBUTL4(.FBRRMK)'=FBRRMKL(0) D FILERR^FBAAFR(FBDA_","_FBDA(1)_","_FBDA(2)_","_FBDA(3)_",",.FBRRMK)
"RTN","FBCHPET",100,0)
 ; if FPPS CLAIM ID changed, update other line items on invoice
"RTN","FBCHPET",101,0)
 I FBFPPSC'=FBFPPSC(0) D
"RTN","FBCHPET",102,0)
 . N FBAAIN
"RTN","FBCHPET",103,0)
 . S FBAAIN=$$GET1^DIQ(162.03,FBDA_","_FBDA(1)_","_FBDA(2)_","_FBDA(3)_",",14)
"RTN","FBCHPET",104,0)
 . D CKINVEDI^FBAAPET1(FBFPPSC(0),FBFPPSC,FBAAIN,FBDA_","_FBDA(1)_","_FBDA(2)_","_FBDA(3)_",")
"RTN","FBCHPET",105,0)
 K FBSV W !! G SERV
"RTN","FBCHPET",106,0)
 ;
"RTN","FBCHPET",107,0)
BADDATE(FBDOS,INVRCVDT) ;Reject entry if InvRcvDt is Prior to the Date of Service on the Invoice
"RTN","FBCHPET",108,0)
 I INVRCVDT<FBDOS D  Q 1 ;Reject entry
"RTN","FBCHPET",109,0)
 .N SHOWDOS S SHOWDOS=$E(FBDOS,4,5)_"/"_$E(FBDOS,6,7)_"/"_$E(FBDOS,2,3) ;Convert FBDOS into display format for error message
"RTN","FBCHPET",110,0)
 .W *7,!!?5,"*** Invoice Received Date cannot be prior to the",!?8,"Date of Service ("_SHOWDOS_") !!!"
"RTN","FBCHPET",111,0)
 Q 0 ;Accept entry
"RTN","FBCHPET",112,0)
 ;
"RTN","FBCHPET",113,0)
END K DR,DIC,DIE,X,DFN,FBVD,FBSD,BAT,FBSV,DA,FBDA,FBZ,FBDUZ,FBAACP,FBFY,FY,FBAMTPD,J,K,Y,PRC,FBHOLDX,ZZ,FBAADT,FBV,FBSDI,FBAACPI
"RTN","FBCHPET",114,0)
 K FBAAMM,FBAAMM1,FBFSAMT,FBFSUSD,FBMODA,FBZIP,FBTIME,FBHCFA(30)
"RTN","FBCHPET",115,0)
 K FBAAPTC,FB1725
"RTN","FBCHPET",116,0)
 K FBADJ,FBADJD,FBADJL,FBRRMK,FBRRMKD,FBRRMKL,FBX,FBUNITS,FTP
"RTN","FBCHPET",117,0)
 Q
"RTN","FBNHEP1")
0^25^B9136492^B9319871
"RTN","FBNHEP1",1,0)
FBNHEP1 ;AISC/GRR-PAYMENT PROCESS CONTINUED ;7/8/2003
"RTN","FBNHEP1",2,0)
 ;;3.5;FEE BASIS;**12,61,158**;JAN 30, 1995;Build 94
"RTN","FBNHEP1",3,0)
 ;;Per VA Directive 6402, this routine should not be modified.
"RTN","FBNHEP1",4,0)
 N FBADJ,FBRRMK,FBX,FBFPPSC,FBFPPSL
"RTN","FBNHEP1",5,0)
 K FBAAID,FBAAVID D GETNXI^FBAAUTL W !!,"Invoice # ",FBAAIN," assigned to this invoice"
"RTN","FBNHEP1",6,0)
 S DIC="^FBAAI(",X=FBAAIN,DIC(0)="L",DLAYGO=162.5 D ^DIC S DA=+Y K DLAYGO
"RTN","FBNHEP1",7,0)
RID D GETINDT^FBAACO1 G DEL:$G(FBAAOUT)
"RTN","FBNHEP1",8,0)
 S DIE=DIC,FBNL=""
"RTN","FBNHEP1",9,0)
 S FBI7078=FB7078_";FB7078("
"RTN","FBNHEP1",10,0)
 S DR="1////^S X=FBAAID;46////^S X=FBAAVID;47////^S X=1;2////^S X=IFN;3////^S X=DFN;20////^S X=FBBAT;55"
"RTN","FBNHEP1",11,0)
 S DR(1,162.5,1)="S FBFPPSC=$$FPPSC^FBUTL5();S:FBFPPSC=-1 Y=0;S:FBFPPSC="""" Y=""@20"";56///^S X=FBFPPSC;S FBFPPSL=$$FPPSL^FBUTL5(,1);S:FBFPPSL=-1 Y=0;57///^S X=FBFPPSL;@20;54//^S X=$G(FBTRDYS)"
"RTN","FBNHEP1",12,0)
 S DR(1,162.5,2)="7;S FBNHAC=X;5////^S X=$S(FBPAYDT>FBAABDT:(FBPAYDT+1),1:FBAABDT);6////^S X=FBENDDT;8//^S X=$S(FBNHAC>FBDEFP:FBDEFP,1:FBNHAC);S FBAMTP=X"
"RTN","FBNHEP1",13,0)
 S DR(1,162.5,3)="S FBX=$$ADJ^FBUTL2(FBNHAC-FBAMTP,.FBADJ,1,,,,.FBRRMK,1);S:FBX=0 Y=0"
"RTN","FBNHEP1",14,0)
 S DR(1,162.5,4)="11////^S X=7;12////^S X=FBAAPTC;23////^S X=FBPSA;4////^S X=FBI7078;21////^S X=FBPOV;22////^S X=FBPT;S FBTST=1"
"RTN","FBNHEP1",15,0)
 D ^DIE I '$G(FBTST) W !,*7,"Entering an '^' will delete this payment" S DIR(0)="Y",DIR("A")="Shall I delete",DIR("B")="No" D ^DIR G DEL:$D(DIRUT)!(Y),RID
"RTN","FBNHEP1",16,0)
 ; file adjustment reasons
"RTN","FBNHEP1",17,0)
 D FILEADJ^FBCHFA(DA_",",.FBADJ)
"RTN","FBNHEP1",18,0)
 ; file remittance remarks
"RTN","FBNHEP1",19,0)
 D FILERR^FBCHFR(DA_",",.FBRRMK)
"RTN","FBNHEP1",20,0)
 K FBTST G GETVET^FBNHEP
"RTN","FBNHEP1",21,0)
DEL S DIK="^FBAAI(" W !!,"Deleting Invoice !" D ^DIK K DIK G GETVET^FBNHEP
"RTN","FBNHEP1",22,0)
 Q
"RTN","FBNHEP1",23,0)
PROB W !,*7,"The patient was not in this vendor's facility for the month and year selected!",!,"Use the Display Episode of Care option to review this veteran's activity!" S FBERR=1
"RTN","FBNHEP1",24,0)
 Q
"RTN","FBNHEP1",25,0)
 ;
"RTN","FBNHEP1",26,0)
TRUB W !!,*7,"Check Contract data for Community Nursing Home: ",$P(^FBAAV(IFN,0),"^",1),!,"It is not complete",!! S FBERR=1 Q
"RTN","FBNHEP1",27,0)
 ;
"RTN","FBNHEP1",28,0)
DAYS(X) ;CALCULATES THE NUMBER OF DAYS IN MONTH
"RTN","FBNHEP1",29,0)
 N X1
"RTN","FBNHEP1",30,0)
 S X1=X,X=+$E(X,4,5),X=$S("^1^3^5^7^8^10^12^"[("^"_X_"^"):31,X=2:28,1:30)
"RTN","FBNHEP1",31,0)
 I X=28 D
"RTN","FBNHEP1",32,0)
 . N YEAR
"RTN","FBNHEP1",33,0)
 . S YEAR=$E(X1,1,3)+1700
"RTN","FBNHEP1",34,0)
 . I $S(YEAR#400=0:1,YEAR#4=0&'(YEAR#100=0):1,1:0) S X=29
"RTN","FBNHEP1",35,0)
 Q X
"RTN","FBRXFR")
0^11^B9233192^B2618713
"RTN","FBRXFR",1,0)
FBRXFR ;WOIFO/SAB-FILE REMITTANCE REMARKS FOR PHARMACY PAYMENT ;7/17/2003
"RTN","FBRXFR",2,0)
 ;;3.5;FEE BASIS;**61,158**;JAN 30, 1995;Build 94
"RTN","FBRXFR",3,0)
 ;;Per VA Directive 6402, this routine should not be modified.
"RTN","FBRXFR",4,0)
 Q
"RTN","FBRXFR",5,0)
FILERR(FBIENS,FBRRMK) ; File Remittance Remakrs
"RTN","FBRXFR",6,0)
 ;
"RTN","FBRXFR",7,0)
 ; Input
"RTN","FBRXFR",8,0)
 ;   FBIENS -  required, internal entry numbers for subfile 162.11
"RTN","FBRXFR",9,0)
 ;             in standard format as specified for FileMan DBS calls
"RTN","FBRXFR",10,0)
 ;   FBRRMK -  required, array passed by reference
"RTN","FBRXFR",11,0)
 ;             array of remittance remarks to file
"RTN","FBRXFR",12,0)
 ;             array does not have to contain any data or be defined
"RTN","FBRXFR",13,0)
 ;             format
"RTN","FBRXFR",14,0)
 ;               FBRRMK(FBADJ,#)=FBRRMKC
"RTN","FBRXFR",15,0)
 ;             where
"RTN","FBRXFR",16,0)
 ;               FBADJ = Adjustment Reason IEN (internal value from file 161.91)
"RTN","FBRXFR",17,0)
 ;               # = sequentially assigned number starting with 1
"RTN","FBRXFR",18,0)
 ;               FBRRMKC = remittance remark (internal value file 162.93)
"RTN","FBRXFR",19,0)
 ; Output
"RTN","FBRXFR",20,0)
 ;   Data in File 162.11 will be modified
"RTN","FBRXFR",21,0)
 ;
"RTN","FBRXFR",22,0)
 N FB,FBFDA,FBI,FBSIENS,FBADJ,FBDA,CNTR,ADJDA
"RTN","FBRXFR",23,0)
 ;
"RTN","FBRXFR",24,0)
 ; delete remitance remarks currently on file
"RTN","FBRXFR",25,0)
 D GETS^DIQ(162.11,FBIENS,"38*","IE","FB")
"RTN","FBRXFR",26,0)
 K FBFDA
"RTN","FBRXFR",27,0)
 S FBSIENS="" F  S FBSIENS=$O(FB(162.15,FBSIENS)) Q:FBSIENS=""  D
"RTN","FBRXFR",28,0)
 . S FBFDA(162.15,FBSIENS,.01)="@"
"RTN","FBRXFR",29,0)
 I $D(FBFDA) D FILE^DIE("","FBFDA")
"RTN","FBRXFR",30,0)
 ;
"RTN","FBRXFR",31,0)
 ; file remarks from input array
"RTN","FBRXFR",32,0)
 K FBFDA
"RTN","FBRXFR",33,0)
 S (FBADJ,CNTR)=0
"RTN","FBRXFR",34,0)
 D DA^DILF(FBIENS,.FBDA)
"RTN","FBRXFR",35,0)
 F  S FBADJ=$O(FBRRMK(FBADJ)) Q:'FBADJ  D
"RTN","FBRXFR",36,0)
 . ;S ADJDA=$$GETADJI(FBADJ,.FBDA)
"RTN","FBRXFR",37,0)
 . S ADJDA=$S(FBADJ'=999:$$GETADJI(FBADJ,.FBDA),1:FBADJ) ;999 indicates a CARCless RARC
"RTN","FBRXFR",38,0)
 . S FBI=0
"RTN","FBRXFR",39,0)
 . F  S FBI=$O(FBRRMK(FBADJ,FBI)) Q:'FBI  D
"RTN","FBRXFR",40,0)
 . . S CNTR=CNTR+1
"RTN","FBRXFR",41,0)
 . . S FBFDA(162.15,"+"_CNTR_","_FBIENS,.01)=$P(FBRRMK(FBADJ,FBI),U)
"RTN","FBRXFR",42,0)
 . . S FBFDA(162.15,"+"_CNTR_","_FBIENS,1)=ADJDA
"RTN","FBRXFR",43,0)
 I $D(FBFDA) D UPDATE^DIE("","FBFDA")
"RTN","FBRXFR",44,0)
 ;
"RTN","FBRXFR",45,0)
 Q
"RTN","FBRXFR",46,0)
 ;
"RTN","FBRXFR",47,0)
GETADJI(ADJI,FBDA) ; get correct DA from ADJUSTMENT multiple
"RTN","FBRXFR",48,0)
 ;
"RTN","FBRXFR",49,0)
 N DA
"RTN","FBRXFR",50,0)
 I $D(FBDA)'=11 Q ""
"RTN","FBRXFR",51,0)
 S DA=""
"RTN","FBRXFR",52,0)
 I $G(ADJI),$D(^FBAA(162.1,FBDA(1),"RX",FBDA,4,"B",ADJI)) D
"RTN","FBRXFR",53,0)
 . S DA=$O(^FBAA(162.1,FBDA(1),"RX",FBDA,4,"B",ADJI,DA))
"RTN","FBRXFR",54,0)
 Q DA
"RTN","FBRXFR",55,0)
 ;
"RTN","FBRXFR",56,0)
LOADRR(FBIENS,FBRRMK) ; Load Remittance Remarks
"RTN","FBRXFR",57,0)
 ; Input
"RTN","FBRXFR",58,0)
 ;   FBIENS -  required, internal entry numbers for subfile 162.11
"RTN","FBRXFR",59,0)
 ;             in standard format as specified for FileMan DBS calls
"RTN","FBRXFR",60,0)
 ;   FBRRMK - required, array passed by reference
"RTN","FBRXFR",61,0)
 ;             array to load adjustments into
"RTN","FBRXFR",62,0)
 ; Output
"RTN","FBRXFR",63,0)
 ;   FBRRMK - the FBRRMK input array passed by reference will be modified
"RTN","FBRXFR",64,0)
 ;             format
"RTN","FBRXFR",65,0)
 ;               FBRRMK(#)=FBRRMKC
"RTN","FBRXFR",66,0)
 ;             where
"RTN","FBRXFR",67,0)
 ;               # = sequentially assigned number starting with 1
"RTN","FBRXFR",68,0)
 ;               FBRRMKC = remittance remark (internal value file 162.93)
"RTN","FBRXFR",69,0)
 ;             if no remarks are on file then the array will be undefined
"RTN","FBRXFR",70,0)
 N FB,FBC,FBI,FBSIENS,ADJMI,FBDA,RRI,ADJI
"RTN","FBRXFR",71,0)
 ;
"RTN","FBRXFR",72,0)
 K FBRRMK
"RTN","FBRXFR",73,0)
 ;
"RTN","FBRXFR",74,0)
 S FBC=0,ADJMI=""
"RTN","FBRXFR",75,0)
 D DA^DILF(FBIENS,.FBDA)
"RTN","FBRXFR",76,0)
 D GETS^DIQ(162.11,FBIENS,"38*","I","FB")
"RTN","FBRXFR",77,0)
 S FBSIENS=""
"RTN","FBRXFR",78,0)
 F  S FBSIENS=$O(FB(162.15,FBSIENS)) Q:FBSIENS=""  D
"RTN","FBRXFR",79,0)
 . S RRI=FB(162.15,FBSIENS,.01,"I")
"RTN","FBRXFR",80,0)
 . S ADJMI=FB(162.15,FBSIENS,1,"I")
"RTN","FBRXFR",81,0)
 . I ADJMI,$D(^FBAA(162.1,FBDA(1),"RX",FBDA,4,ADJMI,0)) D
"RTN","FBRXFR",82,0)
 . . S ADJI=$P(^FBAA(162.1,FBDA(1),"RX",FBDA,4,ADJMI,0),U)
"RTN","FBRXFR",83,0)
 . E  S ADJI=999
"RTN","FBRXFR",84,0)
 . S FBC=$S($D(FBRRMK(ADJI)):$O(FBRRMK(ADJI,FBC)),1:0)
"RTN","FBRXFR",85,0)
 . S FBRRMK(ADJI,FBC+1)=RRI
"RTN","FBRXFR",86,0)
 ;
"RTN","FBRXFR",87,0)
 Q
"RTN","FBRXFR",88,0)
 ;
"RTN","FBRXFR",89,0)
RRL(FBIENS) ; Remittance Remarks List Extrinsic Function
"RTN","FBRXFR",90,0)
 ; Input
"RTN","FBRXFR",91,0)
 ;   FBIENS -  required, internal entry numbers for subfile 162.11
"RTN","FBRXFR",92,0)
 ;             in standard format as specified for FileMan DBS calls
"RTN","FBRXFR",93,0)
 ; Result
"RTN","FBRXFR",94,0)
 ;   string containing sorted list (by external code) of remarks
"RTN","FBRXFR",95,0)
 ;   format
"RTN","FBRXFR",96,0)
 ;      FBRRMKCE 1, FBRRMKCE 2
"RTN","FBRXFR",97,0)
 ;   where
"RTN","FBRXFR",98,0)
 ;      FBRRMKCE = remittance remark code (external value)
"RTN","FBRXFR",99,0)
 N FBRET,FBRRMK
"RTN","FBRXFR",100,0)
 D LOADRR^FBRXFR(FBIENS,.FBRRMK)
"RTN","FBRXFR",101,0)
 S FBRET=$$RRL^FBUTL4(.FBRRMK)
"RTN","FBRXFR",102,0)
 Q FBRET
"RTN","FBRXFR",103,0)
 ;
"RTN","FBRXFR",104,0)
KILLRR(X,DA) ; Called from FEE BASIS PHARMACY INVOICE (#162.1), 
"RTN","FBRXFR",105,0)
 ;             ADJUSTMENT (#162.11,37), ADJUSTMENT REASON (162.14, .01)
"RTN","FBRXFR",106,0)
 ;             to delete REMITTANCE REMARK (#162.11,38) entries associated
"RTN","FBRXFR",107,0)
 ;             with adjustment reasons being deleted.
"RTN","FBRXFR",108,0)
 ;
"RTN","FBRXFR",109,0)
 N FBIENS,FB,FBFDA,FBSIENS
"RTN","FBRXFR",110,0)
 ;
"RTN","FBRXFR",111,0)
 S FBIENS=$G(DA(1))_","_$G(DA(2))_","
"RTN","FBRXFR",112,0)
 D GETS^DIQ(162.11,FBIENS,"38*","","FB")
"RTN","FBRXFR",113,0)
 ;
"RTN","FBRXFR",114,0)
 S FBSIENS="" F  S FBSIENS=$O(FB(162.15,FBSIENS)) Q:FBSIENS=""  D
"RTN","FBRXFR",115,0)
 . I FB(162.15,FBSIENS,1)=$G(DA) S FBFDA(162.15,FBSIENS,.01)="@"
"RTN","FBRXFR",116,0)
 I $D(FBFDA) D FILE^DIE("","FBFDA")
"RTN","FBRXFR",117,0)
 ;
"RTN","FBRXFR",118,0)
 Q
"RTN","FBRXFR",119,0)
 ;FBRXFR
"RTN","FBSVBR")
0^5^B79485755^B72554273
"RTN","FBSVBR",1,0)
FBSVBR ;ISW/SAB - PAYMENT BATCH RESULT MESSAGE SERVER ;5/8/2012
"RTN","FBSVBR",2,0)
 ;;3.5;FEE BASIS;**131,132,158**;JAN 30, 1995;Build 94
"RTN","FBSVBR",3,0)
 ;;Per VA Directive 6402, this routine should not be modified.
"RTN","FBSVBR",4,0)
 ;
"RTN","FBSVBR",5,0)
 ; This routine is called by a server option to process the
"RTN","FBSVBR",6,0)
 ; Payment Batch Result message sent by Central Fee.
"RTN","FBSVBR",7,0)
 ;
"RTN","FBSVBR",8,0)
 ; ICRs
"RTN","FBSVBR",9,0)
 ;  #2053  FILE^DIE
"RTN","FBSVBR",10,0)
 ;  #2054  CLEAN^DILF
"RTN","FBSVBR",11,0)
 ;  #2056  $$GET1^DIQ
"RTN","FBSVBR",12,0)
 ;  #10069 XMB
"RTN","FBSVBR",13,0)
 ;  #10072 REMSBMSG^XMA1C
"RTN","FBSVBR",14,0)
 ;  #10096 ^%ZOSF("ERRTN" ), ^%ZOSF("TRAP")
"RTN","FBSVBR",15,0)
 ;  #10103 $$FMTE^XLFDT, $$NOW^XLFDT
"RTN","FBSVBR",16,0)
 ;  #10104 $$TRIM^XLFSTR
"RTN","FBSVBR",17,0)
 ;
"RTN","FBSVBR",18,0)
 ; init
"RTN","FBSVBR",19,0)
 N FBBAMT,FBERR,FBHL,FBN,FBSN,FBSTAT,FBTYPE,X,XMER,XMRG,FBNEW
"RTN","FBSVBR",20,0)
 S FBERR=0
"RTN","FBSVBR",21,0)
 ;
"RTN","FBSVBR",22,0)
 ; switch to a Fee Basis server error trap
"RTN","FBSVBR",23,0)
 S X="TRAP^FBMRASV2" S @^%ZOSF("TRAP")
"RTN","FBSVBR",24,0)
 ;
"RTN","FBSVBR",25,0)
HDR ; process header line
"RTN","FBSVBR",26,0)
 X XMREC
"RTN","FBSVBR",27,0)
 I XMER<0 D ERR("Error reading header line.")
"RTN","FBSVBR",28,0)
 I FBERR G END
"RTN","FBSVBR",29,0)
 I $E(XMRG,2,4)="FEB" G HDR ; skip initial line if just envelope data
"RTN","FBSVBR",30,0)
 ;
"RTN","FBSVBR",31,0)
 ;FB*3.5*158
"RTN","FBSVBR",32,0)
 I $L(XMRG)=33 S FBNEW=0    ;six digit batch number
"RTN","FBSVBR",33,0)
 E  I $L(XMRG)=34 S FBNEW=1 ;seven digit batch number
"RTN","FBSVBR",34,0)
 E  D ERR("Header line has incorrect length.")
"RTN","FBSVBR",35,0)
 I FBERR G END
"RTN","FBSVBR",36,0)
 ;
"RTN","FBSVBR",37,0)
 ; extract data from header line
"RTN","FBSVBR",38,0)
 S FBHL(1)=$$TRIM^XLFSTR($E(XMRG,1,6),"R") ; station number
"RTN","FBSVBR",39,0)
 S FBHL(2)=$E(XMRG,7,14) ; date YYYYMMDD
"RTN","FBSVBR",40,0)
 S FBHL(3)=$E(XMRG,15) ; processing stage (R)
"RTN","FBSVBR",41,0)
 S FBHL(4)=$E(XMRG,16) ; payment type (3, 5, 9, or T)
"RTN","FBSVBR",42,0)
 ;FB*3.5*158
"RTN","FBSVBR",43,0)
 I FBNEW D  ;7 digit batch number
"RTN","FBSVBR",44,0)
 . S FBHL(5)=+$E(XMRG,17,23)
"RTN","FBSVBR",45,0)
 . S FBHL(6)=$$TRIM^XLFSTR($E(XMRG,24,27)) ; batch reject code
"RTN","FBSVBR",46,0)
 . S FBHL(7)=+$E(XMRG,28,30) ; number accepted
"RTN","FBSVBR",47,0)
 . S FBHL(8)=+$E(XMRG,31,33) ; number rejected
"RTN","FBSVBR",48,0)
 . S FBHL(9)=$E(XMRG,34) ; delimiter ($)
"RTN","FBSVBR",49,0)
 E  D  ;6 digit batch number
"RTN","FBSVBR",50,0)
 . S FBHL(5)=+$E(XMRG,17,22)
"RTN","FBSVBR",51,0)
 . S FBHL(6)=$$TRIM^XLFSTR($E(XMRG,23,26)) ; batch reject code
"RTN","FBSVBR",52,0)
 . S FBHL(7)=+$E(XMRG,27,29) ; number accepted
"RTN","FBSVBR",53,0)
 . S FBHL(8)=+$E(XMRG,30,32) ; number rejected
"RTN","FBSVBR",54,0)
 . S FBHL(9)=$E(XMRG,33) ; delimiter ($)
"RTN","FBSVBR",55,0)
 ;
"RTN","FBSVBR",56,0)
 ; validate header data
"RTN","FBSVBR",57,0)
 I FBHL(3)'="R" D ERR("Processing stage ("_FBHL(3)_") is invalid.")
"RTN","FBSVBR",58,0)
 I "^3^5^9^T^"'[("^"_FBHL(4)_"^") D ERR("Payment type ("_FBHL(4)_") is invalid.")
"RTN","FBSVBR",59,0)
 I FBERR G END
"RTN","FBSVBR",60,0)
 ;
"RTN","FBSVBR",61,0)
 ; determine batch IEN
"RTN","FBSVBR",62,0)
 S FBN=$O(^FBAA(161.7,"B",FBHL(5),0))
"RTN","FBSVBR",63,0)
 I 'FBN D ERR("Could not locate record for batch "_FBHL(5)_".")
"RTN","FBSVBR",64,0)
 I FBERR G END
"RTN","FBSVBR",65,0)
 ;
"RTN","FBSVBR",66,0)
 ; obtain batch data
"RTN","FBSVBR",67,0)
 S FBTYPE=$$GET1^DIQ(161.7,FBN_",",2,"I") ; type (internal)
"RTN","FBSVBR",68,0)
 S FBSTAT=$$GET1^DIQ(161.7,FBN_",",11,"I") ; status (internal)
"RTN","FBSVBR",69,0)
 S FBSN=$$GET1^DIQ(161.7,FBN_",",16) ; station number (3 digit)
"RTN","FBSVBR",70,0)
 ;
"RTN","FBSVBR",71,0)
 ; verify batch values
"RTN","FBSVBR",72,0)
 I FBHL(4)="T",FBTYPE'="B2" D ERR("Payment Type in message is not consistent with the batch type.")
"RTN","FBSVBR",73,0)
 I FBHL(4),FBHL(4)'=$E(FBTYPE,2) D ERR("Payment Type in message is not consistent with the batch type.")
"RTN","FBSVBR",74,0)
 I FBSN'=$E(FBHL(1),1,3) D ERR("Station number in message is not consistent with the batch station number.")
"RTN","FBSVBR",75,0)
 I FBSTAT'="T" D ERR("Current batch status is not TRANSMITTED.")
"RTN","FBSVBR",76,0)
 I FBERR G END
"RTN","FBSVBR",77,0)
 ;
"RTN","FBSVBR",78,0)
 S FBBAMT=0 ; init dollar amount for posting to 1358 by batch
"RTN","FBSVBR",79,0)
 ;
"RTN","FBSVBR",80,0)
 ; if batch reject code sent then reject entire batch
"RTN","FBSVBR",81,0)
 I FBHL(6)'="" D
"RTN","FBSVBR",82,0)
 . N FBIEN,FBIENS,FBRCA
"RTN","FBSVBR",83,0)
 . S FBRCA(1)=FBHL(6) ; reject code array
"RTN","FBSVBR",84,0)
 . ;
"RTN","FBSVBR",85,0)
 . ; loop thru line items in batch
"RTN","FBSVBR",86,0)
 . I FBTYPE="B2" D
"RTN","FBSVBR",87,0)
 . . S FBIEN(1)=0
"RTN","FBSVBR",88,0)
 . . F  S FBIEN(1)=$O(^FBAAC("AD",FBN,FBIEN(1))) Q:'FBIEN(1)  D
"RTN","FBSVBR",89,0)
 . . . S FBIEN=0
"RTN","FBSVBR",90,0)
 . . . F  S FBIEN=$O(^FBAAC("AD",FBN,FBIEN(1),FBIEN)) Q:'FBIEN  D
"RTN","FBSVBR",91,0)
 . . . . S FBIENS=FBIEN_","_FBIEN(1)_","
"RTN","FBSVBR",92,0)
 . . . . D REJLN
"RTN","FBSVBR",93,0)
 . ;
"RTN","FBSVBR",94,0)
 . I FBTYPE="B3" D
"RTN","FBSVBR",95,0)
 . . S FBIEN(3)=0
"RTN","FBSVBR",96,0)
 . . F  S FBIEN(3)=$O(^FBAAC("AC",FBN,FBIEN(3))) Q:'FBIEN(3)  D
"RTN","FBSVBR",97,0)
 . . . S FBIEN(2)=0
"RTN","FBSVBR",98,0)
 . . . F  S FBIEN(2)=$O(^FBAAC("AC",FBN,FBIEN(3),FBIEN(2))) Q:'FBIEN(2)  D
"RTN","FBSVBR",99,0)
 . . . . S FBIEN(1)=0
"RTN","FBSVBR",100,0)
 . . . . F  S FBIEN(1)=$O(^FBAAC("AC",FBN,FBIEN(3),FBIEN(2),FBIEN(1))) Q:'FBIEN(1)  D
"RTN","FBSVBR",101,0)
 . . . . . S FBIEN=0
"RTN","FBSVBR",102,0)
 . . . . . F  S FBIEN=$O(^FBAAC("AC",FBN,FBIEN(3),FBIEN(2),FBIEN(1),FBIEN)) Q:'FBIEN  D
"RTN","FBSVBR",103,0)
 . . . . . . S FBIENS=FBIEN_","_FBIEN(1)_","_FBIEN(2)_","_FBIEN(3)_","
"RTN","FBSVBR",104,0)
 . . . . . . D REJLN
"RTN","FBSVBR",105,0)
 . ;
"RTN","FBSVBR",106,0)
 . I FBTYPE="B5" D
"RTN","FBSVBR",107,0)
 . . S FBIEN(1)=0
"RTN","FBSVBR",108,0)
 . . F  S FBIEN(1)=$O(^FBAA(162.1,"AE",FBN,FBIEN(1))) Q:'FBIEN(1)  D
"RTN","FBSVBR",109,0)
 . . . S FBIEN=0
"RTN","FBSVBR",110,0)
 . . . F  S FBIEN=$O(^FBAA(162.1,"AE",FBN,FBIEN(1),FBIEN)) Q:'FBIEN  D
"RTN","FBSVBR",111,0)
 . . . . S FBIENS=FBIEN_","_FBIEN(1)_","
"RTN","FBSVBR",112,0)
 . . . . D REJLN
"RTN","FBSVBR",113,0)
 . ;
"RTN","FBSVBR",114,0)
 . I FBTYPE="B9" D
"RTN","FBSVBR",115,0)
 . . S FBIEN=0
"RTN","FBSVBR",116,0)
 . . F  S FBIEN=$O(^FBAAI("AC",FBN,FBIEN)) Q:'FBIEN  D
"RTN","FBSVBR",117,0)
 . . . S FBIENS=FBIEN_","
"RTN","FBSVBR",118,0)
 . . . D REJLN
"RTN","FBSVBR",119,0)
 ;
"RTN","FBSVBR",120,0)
 ; if batch reject code not sent then process line rejects (if any)
"RTN","FBSVBR",121,0)
 I FBHL(6)="" D
"RTN","FBSVBR",122,0)
 . ; loop thru detail lines in message
"RTN","FBSVBR",123,0)
 . F  X XMREC Q:XMER<0!($E(XMRG,1,4)="NNNN")  I XMRG]"" D
"RTN","FBSVBR",124,0)
 . . N FBI,FBJ,FBIEN,FBIENS,FBRCA,FBX
"RTN","FBSVBR",125,0)
 . . ; determine the reject codes for the line item
"RTN","FBSVBR",126,0)
 . . S FBJ=0 ; init number of reject codes for line item
"RTN","FBSVBR",127,0)
 . . ; loop thru the five data elements that can hold a reject code
"RTN","FBSVBR",128,0)
 . . F FBI=1:1:5 D
"RTN","FBSVBR",129,0)
 . . . N FBP
"RTN","FBSVBR",130,0)
 . . . S FBP=$S(FBNEW:54,1:53)+((FBI-1)*4) ; calc data element starting position
"RTN","FBSVBR",131,0)
 . . . S FBX=$$TRIM^XLFSTR($E(XMRG,FBP,FBP+3))
"RTN","FBSVBR",132,0)
 . . . I FBX'="" S FBJ=FBJ+1,FBRCA(FBJ)=FBX ; add to array
"RTN","FBSVBR",133,0)
 . . ;
"RTN","FBSVBR",134,0)
 . . ; determine the IENs for the line item
"RTN","FBSVBR",135,0)
 . . S FBX=$E(XMRG,$S(FBNEW:24,1:23),$S(FBNEW:53,1:52)) ; IEN string
"RTN","FBSVBR",136,0)
 . . I FBTYPE="B2" D
"RTN","FBSVBR",137,0)
 . . . S FBIEN(1)=+$P(FBX,U),FBIEN=+$P(FBX,U,2)
"RTN","FBSVBR",138,0)
 . . . ; if line item not found then check if moved
"RTN","FBSVBR",139,0)
 . . . I '$D(^FBAAC(FBIEN(1),3,FBIEN,0)) D
"RTN","FBSVBR",140,0)
 . . . . N FBPROG
"RTN","FBSVBR",141,0)
 . . . . S FBPROG="T"
"RTN","FBSVBR",142,0)
 . . . . D CHKMOVE^FBPAID1
"RTN","FBSVBR",143,0)
 . . . S FBIENS=FBIEN_","_FBIEN(1)_","
"RTN","FBSVBR",144,0)
 . . ;
"RTN","FBSVBR",145,0)
 . . I FBTYPE="B3" D
"RTN","FBSVBR",146,0)
 . . . S FBIEN(3)=+$P(FBX,U),FBIEN(2)=+$P(FBX,U,2)
"RTN","FBSVBR",147,0)
 . . . S FBIEN(1)=+$P(FBX,U,3),FBIEN=+$P(FBX,U,4)
"RTN","FBSVBR",148,0)
 . . . ; if line item not found then check if moved
"RTN","FBSVBR",149,0)
 . . . I '$D(^FBAAC(FBIEN(3),1,FBIEN(2),1,FBIEN(1),1,FBIEN,0)) D
"RTN","FBSVBR",150,0)
 . . . . N FBPROG
"RTN","FBSVBR",151,0)
 . . . . S FBPROG=3
"RTN","FBSVBR",152,0)
 . . . . D CHKMOVE^FBPAID1
"RTN","FBSVBR",153,0)
 . . . S FBIENS=FBIEN_","_FBIEN(1)_","_FBIEN(2)_","_FBIEN(3)_","
"RTN","FBSVBR",154,0)
 . . ;
"RTN","FBSVBR",155,0)
 . . I FBTYPE="B5" D
"RTN","FBSVBR",156,0)
 . . . S FBIEN(1)=+$P(FBX,U),FBIEN=+$P(FBX,U,2)
"RTN","FBSVBR",157,0)
 . . . S FBIENS=FBIEN_","_FBIEN(1)_","
"RTN","FBSVBR",158,0)
 . . ;
"RTN","FBSVBR",159,0)
 . . I FBTYPE="B9" D
"RTN","FBSVBR",160,0)
 . . . S FBIEN=+FBX
"RTN","FBSVBR",161,0)
 . . . S FBIENS=FBIEN_","
"RTN","FBSVBR",162,0)
 . . ;
"RTN","FBSVBR",163,0)
 . . ; call to reject the line item
"RTN","FBSVBR",164,0)
 . . D REJLN
"RTN","FBSVBR",165,0)
 ;
"RTN","FBSVBR",166,0)
 ; update obligation for rejected lines posted by batch
"RTN","FBSVBR",167,0)
 I FBBAMT>0 D
"RTN","FBSVBR",168,0)
 . N FBX
"RTN","FBSVBR",169,0)
 . S FBX=$$POSTBAT^FB1358(FBN,FBBAMT,"R",1)
"RTN","FBSVBR",170,0)
 . I 'FBX D
"RTN","FBSVBR",171,0)
 . . D ERR("Error posting to 1358 for batch")
"RTN","FBSVBR",172,0)
 . . D ERR("  "_$P(FBX,"^",2))
"RTN","FBSVBR",173,0)
 ;
"RTN","FBSVBR",174,0)
 ; update batch status
"RTN","FBSVBR",175,0)
 I FBN D
"RTN","FBSVBR",176,0)
 . N DIERR,FBFDA,FBX
"RTN","FBSVBR",177,0)
 . S FBX="F" ; init new status as Central Fee Accepted
"RTN","FBSVBR",178,0)
 . ; if no lines remain in batch change new status to Vouchered
"RTN","FBSVBR",179,0)
 . I FBTYPE="B2",'$O(^FBAAC("AD",FBN,0)) S FBX="V"
"RTN","FBSVBR",180,0)
 . I FBTYPE="B3",'$O(^FBAAC("AC",FBN,0)) S FBX="V"
"RTN","FBSVBR",181,0)
 . I FBTYPE="B5",'$O(^FBAA(162.1,"AE",FBN,0)) S FBX="V"
"RTN","FBSVBR",182,0)
 . I FBTYPE="B9",'$O(^FBAAI("AC",FBN,0)) S FBX="V"
"RTN","FBSVBR",183,0)
 . S FBFDA(161.7,FBN_",",11)=FBX
"RTN","FBSVBR",184,0)
 . I FBX="V" D
"RTN","FBSVBR",185,0)
 . . S FBFDA(161.7,FBN_",",13)=DT ; DATE FINALIZED
"RTN","FBSVBR",186,0)
 . . S FBFDA(161.7,FBN_",",14)=DUZ ; PERSON WHO COMPLETED
"RTN","FBSVBR",187,0)
 . D FILE^DIE("","FBFDA")
"RTN","FBSVBR",188,0)
 . D CLEAN^DILF
"RTN","FBSVBR",189,0)
 ;
"RTN","FBSVBR",190,0)
END ;
"RTN","FBSVBR",191,0)
 ; switch back to the standard Kernel error trap
"RTN","FBSVBR",192,0)
 S X=^%ZOSF("ERRTN"),@^%ZOSF("TRAP")
"RTN","FBSVBR",193,0)
 ;
"RTN","FBSVBR",194,0)
 ; remove Central Fee message from server basket
"RTN","FBSVBR",195,0)
 N XMSER,XMZ
"RTN","FBSVBR",196,0)
 S XMSER="S."_XQSOP,XMZ=XQMSG D REMSBMSG^XMA1C
"RTN","FBSVBR",197,0)
 ;
"RTN","FBSVBR",198,0)
 I FBERR D
"RTN","FBSVBR",199,0)
 . ; add text to bulletin
"RTN","FBSVBR",200,0)
 . D ERR(" ")
"RTN","FBSVBR",201,0)
 . D ERR("The above message # has been forwarded to the FEE mail group.")
"RTN","FBSVBR",202,0)
 . ;
"RTN","FBSVBR",203,0)
 . ; send bulletin
"RTN","FBSVBR",204,0)
 . D SNDBUL("for batch "_$G(FBHL(5))_" results")
"RTN","FBSVBR",205,0)
 . ;
"RTN","FBSVBR",206,0)
 . ; forward served message to G.FEE
"RTN","FBSVBR",207,0)
 . N XMDUZ,XMY,XMZ
"RTN","FBSVBR",208,0)
 . S XMY("G.FEE")=""
"RTN","FBSVBR",209,0)
 . S XMZ=XQMSG
"RTN","FBSVBR",210,0)
 . D ENT1^XMD
"RTN","FBSVBR",211,0)
 ;
"RTN","FBSVBR",212,0)
 K XQSTXT
"RTN","FBSVBR",213,0)
 Q
"RTN","FBSVBR",214,0)
 ;
"RTN","FBSVBR",215,0)
ERR(FBTXT) ; set error flag and save text for inclusion in bulletin
"RTN","FBSVBR",216,0)
 N FBL
"RTN","FBSVBR",217,0)
 S FBERR=1
"RTN","FBSVBR",218,0)
 S FBL=$P($G(XQSTXT(0)),"^",4)
"RTN","FBSVBR",219,0)
 S FBL=FBL+1
"RTN","FBSVBR",220,0)
 S XQSTXT(FBL)=$G(FBTXT)
"RTN","FBSVBR",221,0)
 S $P(XQSTXT(0),"^",3,4)=FBL_"^"_FBL
"RTN","FBSVBR",222,0)
 Q
"RTN","FBSVBR",223,0)
 ;
"RTN","FBSVBR",224,0)
REJLN ; reject payment line item
"RTN","FBSVBR",225,0)
 N FBX
"RTN","FBSVBR",226,0)
 ; set reject flag
"RTN","FBSVBR",227,0)
 S FBX=$$SETREJ^FBAAVR4(FBN,FBTYPE,FBIENS,1,,.FBRCA)
"RTN","FBSVBR",228,0)
 ;
"RTN","FBSVBR",229,0)
 ; if problem
"RTN","FBSVBR",230,0)
 I 'FBX D
"RTN","FBSVBR",231,0)
 . D ERR("Error rejecting line with IENS "_FBIENS)
"RTN","FBSVBR",232,0)
 . D ERR("  "_$P(FBX,"^",2))
"RTN","FBSVBR",233,0)
 ;
"RTN","FBSVBR",234,0)
 ; if success
"RTN","FBSVBR",235,0)
 I FBX D
"RTN","FBSVBR",236,0)
 . N FBPBYINV
"RTN","FBSVBR",237,0)
 . ; determine if 1358 posted by invoice or batch
"RTN","FBSVBR",238,0)
 . S FBPBYINV=0
"RTN","FBSVBR",239,0)
 . I FBTYPE="B9",$$GET1^DIQ(162.5,FBIENS,4,"I")'["FB583" S FBPBYINV=1
"RTN","FBSVBR",240,0)
 . ;
"RTN","FBSVBR",241,0)
 . ; if by batch then accumulate amount for later posting
"RTN","FBSVBR",242,0)
 . I 'FBPBYINV S FBBAMT=FBBAMT+$P(FBX,"^",3)
"RTN","FBSVBR",243,0)
 . ;
"RTN","FBSVBR",244,0)
 . ; if by B9 invoice then post it now
"RTN","FBSVBR",245,0)
 . I FBPBYINV D
"RTN","FBSVBR",246,0)
 . . N FBX1
"RTN","FBSVBR",247,0)
 . . S FBX1=$$POSTINV^FB1358(FBN,+FBIENS,"R",1)
"RTN","FBSVBR",248,0)
 . . I 'FBX1 D
"RTN","FBSVBR",249,0)
 . . . D ERR("Error posting invoice "_+FBIENS_" to 1358")
"RTN","FBSVBR",250,0)
 . . . D ERR("  "_$P(FBX1,"^",2))
"RTN","FBSVBR",251,0)
 Q
"RTN","FBSVBR",252,0)
 ;
"RTN","FBSVBR",253,0)
SNDBUL(FBSUB) ; send bulletin
"RTN","FBSVBR",254,0)
 ;
"RTN","FBSVBR",255,0)
 N XMB,XMBTMP,XMDF,XMDT,XMDUZ,XMTEXT,XMY,XMYBLOB
"RTN","FBSVBR",256,0)
 S XMB="FBAA SERVER"
"RTN","FBSVBR",257,0)
 S XMB(1)=$$FMTE^XLFDT($$NOW^XLFDT) ; date/time
"RTN","FBSVBR",258,0)
 S XMB(2)=$G(XQSND) ; sender of message sent to server option
"RTN","FBSVBR",259,0)
 S XMB(3)=$G(XQSOP) ; server option
"RTN","FBSVBR",260,0)
 S XMB(4)=$G(XQSUB) ; subject of message sent to server option
"RTN","FBSVBR",261,0)
 S XMB(5)=$G(XQMSG) ; number of message sent to server option
"RTN","FBSVBR",262,0)
 S XMB(6)="An issue occurred that requires notification." ; comment
"RTN","FBSVBR",263,0)
 S XMB(7)=$G(FBSUB) ; optional text for bulletin message subject
"RTN","FBSVBR",264,0)
 S:$O(XQSTXT(0)) XMTEXT="XQSTXT(" ; additional text
"RTN","FBSVBR",265,0)
 S XMY("G.FEE")=""
"RTN","FBSVBR",266,0)
 S XMY("G.FEE FINANCE")=""
"RTN","FBSVBR",267,0)
 D ^XMB
"RTN","FBSVBR",268,0)
 Q
"RTN","FBSVBR",269,0)
 ;FBSVBR
"RTN","FBSVVA")
0^6^B22383786^B19365869
"RTN","FBSVVA",1,0)
FBSVVA ;ISW/SAB - VOUCHER BATCH ACKNOWLEDGEMENT MESSAGE SERVER ;4/23/2012
"RTN","FBSVVA",2,0)
 ;;3.5;FEE BASIS;**131,132,158**;JAN 30, 1995;Build 94
"RTN","FBSVVA",3,0)
 ;;Per VA Directive 6402, this routine should not be modified.
"RTN","FBSVVA",4,0)
 ;
"RTN","FBSVVA",5,0)
 ; This routine is called by a server option to process the
"RTN","FBSVVA",6,0)
 ; Payment Batch Result message sent by Central Fee.
"RTN","FBSVVA",7,0)
 ;
"RTN","FBSVVA",8,0)
 ; ICRs
"RTN","FBSVVA",9,0)
 ;  #2053  FILE^DIE
"RTN","FBSVVA",10,0)
 ;  #2054  CLEAN^DILF
"RTN","FBSVVA",11,0)
 ;  #2056  $$GET1^DIQ
"RTN","FBSVVA",12,0)
 ;  #10069 XMB
"RTN","FBSVVA",13,0)
 ;  #10072 REMSBMSG^XMA1C
"RTN","FBSVVA",14,0)
 ;  #10096 ^%ZOSF("ERRTN" ), ^%ZOSF("TRAP")
"RTN","FBSVVA",15,0)
 ;  #10103 $$FMTE^XLFDT, $$NOW^XLFDT
"RTN","FBSVVA",16,0)
 ;  #10104 $$TRIM^XLFSTR
"RTN","FBSVVA",17,0)
 ;
"RTN","FBSVVA",18,0)
 ; init
"RTN","FBSVVA",19,0)
 N FBERR,FBHDR,FBHL,FBN,FBSN,FBSTAT,FBTYPE,X,XMER,XMRG,FBNEW
"RTN","FBSVVA",20,0)
 S FBERR=0
"RTN","FBSVVA",21,0)
 ;
"RTN","FBSVVA",22,0)
 ; switch to a Fee Basis server error trap
"RTN","FBSVVA",23,0)
 S X="TRAP^FBMRASV2" S @^%ZOSF("TRAP")
"RTN","FBSVVA",24,0)
 ;
"RTN","FBSVVA",25,0)
HDR ; process header line
"RTN","FBSVVA",26,0)
 X XMREC
"RTN","FBSVVA",27,0)
 I XMER<0 D ERR("Error reading header line.")
"RTN","FBSVVA",28,0)
 I FBERR G END
"RTN","FBSVVA",29,0)
 I $E(XMRG,2,4)="FEV" G HDR ; skip initial line if just envelope data
"RTN","FBSVVA",30,0)
 ;
"RTN","FBSVVA",31,0)
 I $L(XMRG)'=25,$L(XMRG)'=26 D ERR("Header line has incorrect length.")  ;FB*3.5*158
"RTN","FBSVVA",32,0)
 I FBERR G END
"RTN","FBSVVA",33,0)
 ;
"RTN","FBSVVA",34,0)
 ; extract data from header line
"RTN","FBSVVA",35,0)
 S FBHL(1)=$$TRIM^XLFSTR($E(XMRG,1,6),"R") ; station number
"RTN","FBSVVA",36,0)
 S FBHL(2)=$E(XMRG,7,14) ; date YYYYMMDD
"RTN","FBSVVA",37,0)
 S FBHL(3)=$E(XMRG,15) ; processing stage (A)
"RTN","FBSVVA",38,0)
 S FBHL(4)=$E(XMRG,16) ; payment type (3, 5, 9, or T)
"RTN","FBSVVA",39,0)
 ;FB*3.5*158
"RTN","FBSVVA",40,0)
 S FBNEW=$S($L(XMRG)=25:0,1:1)
"RTN","FBSVVA",41,0)
 ;
"RTN","FBSVVA",42,0)
 I FBNEW D
"RTN","FBSVVA",43,0)
 . S FBHL(5)=+$E(XMRG,17,23) ; batch number
"RTN","FBSVVA",44,0)
 . S FBHL(6)=$E(XMRG,24,25) ; status (AA or AE)
"RTN","FBSVVA",45,0)
 . S FBHL(7)=$E(XMRG,26) ; delimiter ($)
"RTN","FBSVVA",46,0)
 E  D
"RTN","FBSVVA",47,0)
 . S FBHL(5)=+$E(XMRG,17,22) ; batch number
"RTN","FBSVVA",48,0)
 . S FBHL(6)=$E(XMRG,23,24) ; status (AA or AE)
"RTN","FBSVVA",49,0)
 . S FBHL(7)=$E(XMRG,25) ; delimiter ($)
"RTN","FBSVVA",50,0)
 ;
"RTN","FBSVVA",51,0)
 ; validate header data
"RTN","FBSVVA",52,0)
 I FBHL(3)'="A" D ERR("Processing stage ("_FBHL(3)_") is invalid.")
"RTN","FBSVVA",53,0)
 I "^3^5^9^T^"'[("^"_FBHL(4)_"^") D ERR("Payment type ("_FBHL(4)_") is invalid.")
"RTN","FBSVVA",54,0)
 I "^AA^AE^"'[("^"_FBHL(6)_"^") D ERR("Acknowledgement status ("_FBHL(6)_") is invalid.")
"RTN","FBSVVA",55,0)
 I FBERR G END
"RTN","FBSVVA",56,0)
 ;
"RTN","FBSVVA",57,0)
 ; determine batch IEN
"RTN","FBSVVA",58,0)
 S FBN=$O(^FBAA(161.7,"B",FBHL(5),0))
"RTN","FBSVVA",59,0)
 I 'FBN D ERR("Could not locate record for batch "_FBHL(5)_".")
"RTN","FBSVVA",60,0)
 I FBERR G END
"RTN","FBSVVA",61,0)
 ;
"RTN","FBSVVA",62,0)
 ; obtain batch data
"RTN","FBSVVA",63,0)
 S FBTYPE=$$GET1^DIQ(161.7,FBN_",",2,"I") ; type (internal)
"RTN","FBSVVA",64,0)
 S FBSTAT=$$GET1^DIQ(161.7,FBN_",",11,"I") ; status (internal)
"RTN","FBSVVA",65,0)
 S FBSN=$$GET1^DIQ(161.7,FBN_",",16) ; station number (3 digit)
"RTN","FBSVVA",66,0)
 ;
"RTN","FBSVVA",67,0)
 ; verify batch values
"RTN","FBSVVA",68,0)
 I FBHL(4)="T",FBTYPE'="B2" D ERR("Payment Type in message is not consistent with the batch type.")
"RTN","FBSVVA",69,0)
 I FBHL(4),FBHL(4)'=$E(FBTYPE,2) D ERR("Payment Type in message is not consistent with the batch type.")
"RTN","FBSVVA",70,0)
 I FBSN'=$E(FBHL(1),1,3) D ERR("Station number in message is not consistent with the batch station number.")
"RTN","FBSVVA",71,0)
 I FBSTAT'="V" D ERR("Current batch status is not VOUCHERED.")
"RTN","FBSVVA",72,0)
 I FBERR G END
"RTN","FBSVVA",73,0)
 ;
"RTN","FBSVVA",74,0)
 ; loop thru detail lines (errors and warnings) in message
"RTN","FBSVVA",75,0)
 S FBHDR=1
"RTN","FBSVVA",76,0)
 F  X XMREC Q:XMER<0!($E(XMRG,1,4)="NNNN")  I XMRG]"" D
"RTN","FBSVVA",77,0)
 . N FBDL
"RTN","FBSVVA",78,0)
 . ;
"RTN","FBSVVA",79,0)
 . S FBDL(6)=$E(XMRG,$S(FBNEW:24,1:23),$S(FBNEW:24,1:23)) ; severity (E or W)
"RTN","FBSVVA",80,0)
 . S FBDL(7)=$$TRIM^XLFSTR($E(XMRG,$S(FBNEW:25,1:24),$S(FBNEW:28,1:27))) ; message code
"RTN","FBSVVA",81,0)
 . S FBDL(8)=$$TRIM^XLFSTR($E(XMRG,$S(FBNEW:29,1:28),$S(FBNEW:98,1:97))) ; message text
"RTN","FBSVVA",82,0)
 . ;
"RTN","FBSVVA",83,0)
 . I FBHDR D MSG("Messages from Central Fee follow") S FBHDR=0
"RTN","FBSVVA",84,0)
 . D MSG(" ("_FBDL(6)_")  "_FBDL(8))
"RTN","FBSVVA",85,0)
 ;
"RTN","FBSVVA",86,0)
 ; update batch
"RTN","FBSVVA",87,0)
 I FBN D
"RTN","FBSVVA",88,0)
 . N DIERR,FBFDA,FBX
"RTN","FBSVVA",89,0)
 . ; set VOUCHER MSG ACK STATUS to A or E
"RTN","FBSVVA",90,0)
 . S FBFDA(161.7,FBN_",",22)=$S(FBHL(6)="AA":"A",1:"E")
"RTN","FBSVVA",91,0)
 . D FILE^DIE("","FBFDA")
"RTN","FBSVVA",92,0)
 . D CLEAN^DILF
"RTN","FBSVVA",93,0)
 ;
"RTN","FBSVVA",94,0)
END ;
"RTN","FBSVVA",95,0)
 ; switch back to the standard Kernel error trap
"RTN","FBSVVA",96,0)
 S X=^%ZOSF("ERRTN"),@^%ZOSF("TRAP")
"RTN","FBSVVA",97,0)
 ;
"RTN","FBSVVA",98,0)
 ; remove Central Fee message from server basket
"RTN","FBSVVA",99,0)
 N XMSER,XMZ
"RTN","FBSVVA",100,0)
 S XMSER="S."_XQSOP,XMZ=XQMSG D REMSBMSG^XMA1C
"RTN","FBSVVA",101,0)
 ;
"RTN","FBSVVA",102,0)
 I FBERR D
"RTN","FBSVVA",103,0)
 . ; add text to bulletin
"RTN","FBSVVA",104,0)
 . D ERR(" ")
"RTN","FBSVVA",105,0)
 . D ERR("The above message # has been forwarded to the FEE mail group.")
"RTN","FBSVVA",106,0)
 . ;
"RTN","FBSVVA",107,0)
 . ; send bulletin
"RTN","FBSVVA",108,0)
 . D SNDBUL^FBSVBR("for batch "_$G(FBHL(5))_" voucher ack.")
"RTN","FBSVVA",109,0)
 . ;
"RTN","FBSVVA",110,0)
 . ; forward served message to G.FEE
"RTN","FBSVVA",111,0)
 . N XMDUZ,XMY,XMZ
"RTN","FBSVVA",112,0)
 . S XMY("G.FEE")=""
"RTN","FBSVVA",113,0)
 . S XMZ=XQMSG
"RTN","FBSVVA",114,0)
 . D ENT1^XMD
"RTN","FBSVVA",115,0)
 ;
"RTN","FBSVVA",116,0)
 ; if no VistA error, but Central Fee sent a warning or error
"RTN","FBSVVA",117,0)
 I 'FBERR,'FBHDR D
"RTN","FBSVVA",118,0)
 . ; send bulletin
"RTN","FBSVVA",119,0)
 . D SNDBUL^FBSVBR("for batch "_$G(FBHL(5))_" voucher ack.")
"RTN","FBSVVA",120,0)
 ;
"RTN","FBSVVA",121,0)
 K XQSTXT
"RTN","FBSVVA",122,0)
 Q
"RTN","FBSVVA",123,0)
 ;
"RTN","FBSVVA",124,0)
ERR(FBTXT) ; set error flag and save text for inclusion in bulletin
"RTN","FBSVVA",125,0)
 N FBL
"RTN","FBSVVA",126,0)
 S FBERR=1
"RTN","FBSVVA",127,0)
 S FBL=$P($G(XQSTXT(0)),"^",4)
"RTN","FBSVVA",128,0)
 S FBL=FBL+1
"RTN","FBSVVA",129,0)
 S XQSTXT(FBL)=$G(FBTXT)
"RTN","FBSVVA",130,0)
 S $P(XQSTXT(0),"^",3,4)=FBL_"^"_FBL
"RTN","FBSVVA",131,0)
 Q
"RTN","FBSVVA",132,0)
 ;
"RTN","FBSVVA",133,0)
MSG(FBTXT) ; set save text for inclusion in bulletin
"RTN","FBSVVA",134,0)
 N FBL
"RTN","FBSVVA",135,0)
 S FBL=$P($G(XQSTXT(0)),"^",4)
"RTN","FBSVVA",136,0)
 S FBL=FBL+1
"RTN","FBSVVA",137,0)
 S XQSTXT(FBL)=$G(FBTXT)
"RTN","FBSVVA",138,0)
 S $P(XQSTXT(0),"^",3,4)=FBL_"^"_FBL
"RTN","FBSVVA",139,0)
 Q
"RTN","FBSVVA",140,0)
 ;
"RTN","FBSVVA",141,0)
 ;FBSVVA
"RTN","FBUTL1")
0^10^B19606435^B14646555
"RTN","FBUTL1",1,0)
FBUTL1 ;WOIFO/SAB-FEE BASIS UTILITY ;6/17/2003
"RTN","FBUTL1",2,0)
 ;;3.5;FEE BASIS;**61,158**;JAN 30, 1995;Build 94
"RTN","FBUTL1",3,0)
 ;;Per VA Directive 6402, this routine should not be modified.
"RTN","FBUTL1",4,0)
 Q
"RTN","FBUTL1",5,0)
 ;Extrinsic functions AR, AG, and RR have similar inputs and outputs
"RTN","FBUTL1",6,0)
 ; input
"RTN","FBUTL1",7,0)
 ;   FBCI - Internal entry number of code.
"RTN","FBUTL1",8,0)
 ;          Not required if external value is passed.
"RTN","FBUTL1",9,0)
 ;   FBCE - External value of code.
"RTN","FBUTL1",10,0)
 ;          Not required if internal value is passed.
"RTN","FBUTL1",11,0)
 ;          If both the internal and external values are passed
"RTN","FBUTL1",12,0)
 ;          then the external value will be ignored.
"RTN","FBUTL1",13,0)
 ;   FBDT - Effective date.
"RTN","FBUTL1",14,0)
 ;          Optional - DT (Today) will be used if a value is not passed.
"RTN","FBUTL1",15,0)
 ;          An input date prior to 6/1/03 will be changed to be 6/1/03.
"RTN","FBUTL1",16,0)
 ;   FBAR - Root of local or global array in which the description
"RTN","FBUTL1",17,0)
 ;          word processing field will be returned.
"RTN","FBUTL1",18,0)
 ;          Optional - description will not be returned if an array root
"RTN","FBUTL1",19,0)
 ;          is not passed.  The root should be in closed format
"RTN","FBUTL1",20,0)
 ;          such as FBAR or FBAR(2) or ^TMP($J,"DESC").
"RTN","FBUTL1",21,0)
 ;          The root should not be a variable name already used in FBUTL1
"RTN","FBUTL1",22,0)
 ; FBCORE - Optional value indicating the CORE Scenario to use when
"RTN","FBUTL1",23,0)
 ;          displaying lists of CARCs. Only related CARCs will list.
"RTN","FBUTL1",24,0)
 ; Returns a string value
"RTN","FBUTL1",25,0)
 ;     Internal code ^ External code ^ HIPAA status ^ FEE status ^ name
"RTN","FBUTL1",26,0)
 ;   OR if there is an error
"RTN","FBUTL1",27,0)
 ;     -1^-1^^^error message text
"RTN","FBUTL1",28,0)
 ;   where
"RTN","FBUTL1",29,0)
 ;     internal code = internal entry number of code in file
"RTN","FBUTL1",30,0)
 ;     external code = external value of code
"RTN","FBUTL1",31,0)
 ;     HIPAA status = 1 (active) or 0 (inactive) as of effective date
"RTN","FBUTL1",32,0)
 ;     FEE status = 1 (applicable) or 0 (not applicable) for fee claim
"RTN","FBUTL1",33,0)
 ;                  adjudication as of the effective date
"RTN","FBUTL1",34,0)
 ;     name = a short descriptive name for the code as of the eff. date
"RTN","FBUTL1",35,0)
 ;            name is only returned by AG (not returned by AR and RR)
"RTN","FBUTL1",36,0)
 ;     error message text = an error message
"RTN","FBUTL1",37,0)
 ; Output
"RTN","FBUTL1",38,0)
 ;   fbarr( - Array containing the description as of the effective date.
"RTN","FBUTL1",39,0)
 ;            For example, if "FBTXT" was passed in parameter FBAR then
"RTN","FBUTL1",40,0)
 ;            the output might be
"RTN","FBUTL1",41,0)
 ;              FBTXT(1)=1st line of description
"RTN","FBUTL1",42,0)
 ;              FBTXT(2)=2nd line of description
"RTN","FBUTL1",43,0)
 ;            The array will be undefined if there is not a description
"RTN","FBUTL1",44,0)
 ;
"RTN","FBUTL1",45,0)
AR(FBCI,FBCE,FBDT,FBAR,FBCORE) ; ADJUSTMENT REASON extrinsic function
"RTN","FBUTL1",46,0)
 ; Provides status and description for an adjustment reason code
"RTN","FBUTL1",47,0)
 ; stored in the ADJUSTMENT REASON (#161.91) file.
"RTN","FBUTL1",48,0)
 ; see top of routine for additional documentation
"RTN","FBUTL1",49,0)
 N FBC,FBDT1,FBERR,FBRET,FBCORE2
"RTN","FBUTL1",50,0)
 S FBRET="",FBERR=""
"RTN","FBUTL1",51,0)
 I $G(FBAR)]"" K @FBAR
"RTN","FBUTL1",52,0)
 S (FBCORE,FBCORE2)=$G(FBCORE)
"RTN","FBUTL1",53,0)
 I FBCORE D
"RTN","FBUTL1",54,0)
 . I $G(FBCI)="",$G(FBCE)]"" S FBCI=$O(^FB(161.91,"B",FBCE,0))
"RTN","FBUTL1",55,0)
 . I $G(FBCI) S FBCORE2=$P($G(^FB(161.91,FBCI,0)),U,3)
"RTN","FBUTL1",56,0)
 I FBCORE]"",FBCORE'=FBCORE2 Q "^^^0"
"RTN","FBUTL1",57,0)
 ;
"RTN","FBUTL1",58,0)
 ; find code in file
"RTN","FBUTL1",59,0)
 D FNDCDE(161.91)
"RTN","FBUTL1",60,0)
 ;
"RTN","FBUTL1",61,0)
 ; set effective date for search
"RTN","FBUTL1",62,0)
 D SETDT
"RTN","FBUTL1",63,0)
 ;
"RTN","FBUTL1",64,0)
 ; determine status of code
"RTN","FBUTL1",65,0)
 I FBCI,FBERR="" D GETSTAT(161.91)
"RTN","FBUTL1",66,0)
 ;
"RTN","FBUTL1",67,0)
 ; if array root passed then determine description of code
"RTN","FBUTL1",68,0)
 I $G(FBAR)]"",FBCI,FBERR="" D GETDESC(161.91)
"RTN","FBUTL1",69,0)
 ;
"RTN","FBUTL1",70,0)
 I FBERR]"" S FBRET="-1^-1^^^"_FBERR
"RTN","FBUTL1",71,0)
 Q FBRET
"RTN","FBUTL1",72,0)
 ;
"RTN","FBUTL1",73,0)
AG(FBCI,FBCE,FBDT,FBAR) ; ADJUSTMENT GROUP extrinsic function
"RTN","FBUTL1",74,0)
 ; Provides status and description for an adjustment group code
"RTN","FBUTL1",75,0)
 ; stored in the ADJUSTMENT GROUP (#161.92) file.
"RTN","FBUTL1",76,0)
 ; see top of routine for additional documentation
"RTN","FBUTL1",77,0)
 N FBC,FBDT1,FBERR,FBRET
"RTN","FBUTL1",78,0)
 S FBRET="",FBERR=""
"RTN","FBUTL1",79,0)
 I $G(FBAR)]"" K @FBAR
"RTN","FBUTL1",80,0)
 ;
"RTN","FBUTL1",81,0)
 ; find code in file
"RTN","FBUTL1",82,0)
 D FNDCDE(161.92)
"RTN","FBUTL1",83,0)
 ;
"RTN","FBUTL1",84,0)
 ; set effective date for search
"RTN","FBUTL1",85,0)
 D SETDT
"RTN","FBUTL1",86,0)
 ;
"RTN","FBUTL1",87,0)
 ; determine status of code
"RTN","FBUTL1",88,0)
 I FBCI,FBERR="" D GETSTAT(161.92)
"RTN","FBUTL1",89,0)
 ;
"RTN","FBUTL1",90,0)
 ; determine name, description of code
"RTN","FBUTL1",91,0)
 I FBCI,FBERR="" D GETDESC(161.92)
"RTN","FBUTL1",92,0)
 ;
"RTN","FBUTL1",93,0)
 I FBERR]"" S FBRET="-1^-1^^^"_FBERR
"RTN","FBUTL1",94,0)
 Q FBRET
"RTN","FBUTL1",95,0)
 ;
"RTN","FBUTL1",96,0)
RR(FBCI,FBCE,FBDT,FBAR,FBADJ) ; REMITTANCE REMARK extrinsic function
"RTN","FBUTL1",97,0)
 ; Provides status and description for an adjustment reason code
"RTN","FBUTL1",98,0)
 ; stored in the REMITTANCE REMARK (#161.93) file.
"RTN","FBUTL1",99,0)
 ; see top of routine for additional documentation
"RTN","FBUTL1",100,0)
 N FBC,FBDT1,FBERR,FBRET
"RTN","FBUTL1",101,0)
 S FBRET="",FBERR=""
"RTN","FBUTL1",102,0)
 I $G(FBAR)]"" K @FBAR
"RTN","FBUTL1",103,0)
 ;
"RTN","FBUTL1",104,0)
 ; find code in file
"RTN","FBUTL1",105,0)
 I $G(FBADJ) D FNDRARC(FBCI,FBADJ)
"RTN","FBUTL1",106,0)
 E  D FNDCDE(161.93)
"RTN","FBUTL1",107,0)
 ;
"RTN","FBUTL1",108,0)
 ; set effective date for search
"RTN","FBUTL1",109,0)
 D SETDT
"RTN","FBUTL1",110,0)
 ;
"RTN","FBUTL1",111,0)
 ; determine status of code
"RTN","FBUTL1",112,0)
 I FBCI,FBERR="" D GETSTAT(161.93)
"RTN","FBUTL1",113,0)
 ;
"RTN","FBUTL1",114,0)
 ; if array root passed then determine description of code
"RTN","FBUTL1",115,0)
 I $G(FBAR)]"",FBCI,FBERR="" D GETDESC(161.93)
"RTN","FBUTL1",116,0)
 ;
"RTN","FBUTL1",117,0)
 I FBERR]"" S FBRET="-1^-1^^^"_FBERR
"RTN","FBUTL1",118,0)
 Q FBRET
"RTN","FBUTL1",119,0)
 ;
"RTN","FBUTL1",120,0)
FNDCDE(FBFILE) ; find code
"RTN","FBUTL1",121,0)
 ;   determine ien if not passed
"RTN","FBUTL1",122,0)
 I $G(FBCI)="",$G(FBCE)]"" S FBCI=$O(^FB(FBFILE,"B",FBCE,0))
"RTN","FBUTL1",123,0)
 ;   get data
"RTN","FBUTL1",124,0)
 I $G(FBCI) S FBC=$P($G(^FB(FBFILE,FBCI,0)),U)
"RTN","FBUTL1",125,0)
 I $G(FBC)="" S FBERR="CODE NOT FOUND IN FILE"
"RTN","FBUTL1",126,0)
 E  S FBRET=FBCI_U_FBC
"RTN","FBUTL1",127,0)
 Q
"RTN","FBUTL1",128,0)
 ;
"RTN","FBUTL1",129,0)
FNDRARC(FBCI,FBADJ) ; find RARC in Adjustment Reason sub-file
"RTN","FBUTL1",130,0)
 ;
"RTN","FBUTL1",131,0)
 I $D(^FB(161.91,FBADJ,"RARC")) D
"RTN","FBUTL1",132,0)
 . I $G(FBCI),$D(^FB(161.91,FBADJ,"RARC","B",FBCI)) D
"RTN","FBUTL1",133,0)
 . . S FBC=$P($G(^FB(161.93,FBCI,0)),U)
"RTN","FBUTL1",134,0)
 . . S FBRET=FBCI_U_FBC
"RTN","FBUTL1",135,0)
 . E  S FBERR="CODE NOT FOUND IN FILE"
"RTN","FBUTL1",136,0)
 E  D FNDCDE(161.93)
"RTN","FBUTL1",137,0)
 Q
"RTN","FBUTL1",138,0)
 ;
"RTN","FBUTL1",139,0)
SETDT ; set date
"RTN","FBUTL1",140,0)
 I $G(FBDT)'?7N S FBDT=DT ; if date not passed then set as Today
"RTN","FBUTL1",141,0)
 I FBDT<3030601 S FBDT=3030601 ; if date prior to 6/1/03 then set
"RTN","FBUTL1",142,0)
 S FBDT1=$$FMADD^XLFDT(FBDT,1) ; use date + 1 in reverse $Orders
"RTN","FBUTL1",143,0)
 Q
"RTN","FBUTL1",144,0)
 ;
"RTN","FBUTL1",145,0)
GETSTAT(FBFILE) ; get status
"RTN","FBUTL1",146,0)
 N FBFEEU,FBSEDT,FBSI,FBSTAT,FBSY
"RTN","FBUTL1",147,0)
 ; find most recent status effective date prior to the input date 
"RTN","FBUTL1",148,0)
 S FBSEDT=$O(^FB(FBFILE,FBCI,1,"B",FBDT1),-1)
"RTN","FBUTL1",149,0)
 S:FBSEDT]"" FBSI=$O(^FB(FBFILE,FBCI,1,"B",FBSEDT,0))
"RTN","FBUTL1",150,0)
 S:$G(FBSI) FBSY=$G(^FB(FBFILE,FBCI,1,FBSI,0))
"RTN","FBUTL1",151,0)
 S:$G(FBSY)]"" FBSTAT=$P(FBSY,U,2),FBFEEU=$S('FBSTAT:0,1:+$P(FBSY,U,3))
"RTN","FBUTL1",152,0)
 I $G(FBSTAT)="" S FBERR="STATUS NOT AVAILABLE FOR SPECIFIED DATE" Q
"RTN","FBUTL1",153,0)
 S FBRET=FBRET_U_FBSTAT_U_FBFEEU
"RTN","FBUTL1",154,0)
 Q
"RTN","FBUTL1",155,0)
 ;
"RTN","FBUTL1",156,0)
GETDESC(FBFILE) ; get description
"RTN","FBUTL1",157,0)
 N FBDEDT,FBDI,FBDN,FBX
"RTN","FBUTL1",158,0)
 ; find most recent description effective date prior to input date
"RTN","FBUTL1",159,0)
 S FBDEDT=$O(^FB(FBFILE,FBCI,2,"B",FBDT1),-1)
"RTN","FBUTL1",160,0)
 S:FBDEDT]"" FBDI=$O(^FB(FBFILE,FBCI,2,"B",FBDEDT,0))
"RTN","FBUTL1",161,0)
 ; if file 161.92 then get short descriptive name
"RTN","FBUTL1",162,0)
 I FBFILE=161.92 D
"RTN","FBUTL1",163,0)
 . S:$G(FBDI) FBDN=$P($G(^FB(FBFILE,FBCI,2,FBDI,0)),U,2)
"RTN","FBUTL1",164,0)
 . S FBRET=FBRET_U_$G(FBDN)
"RTN","FBUTL1",165,0)
 ; if array root passed then get full description
"RTN","FBUTL1",166,0)
 I $G(FBAR)]"",$G(FBDI) S FBX=$$GET1^DIQ(FBFILE_"2",FBDI_","_FBCI_",",1,,FBAR)
"RTN","FBUTL1",167,0)
 Q
"RTN","FBUTL1",168,0)
 ;
"RTN","FBUTL1",169,0)
 ;FBUTL1
"RTN","FBUTL2")
0^12^B70356259^B53713039
"RTN","FBUTL2",1,0)
FBUTL2 ;WOIFO/SAB-FEE BASIS UTILITY ;7/1/2003
"RTN","FBUTL2",2,0)
 ;;3.5;FEE BASIS;**61,73,158**;JAN 30, 1995;Build 94
"RTN","FBUTL2",3,0)
 ;;Per VA Directive 6402, this routine should not be modified.
"RTN","FBUTL2",4,0)
 Q
"RTN","FBUTL2",5,0)
ADJ(FBTAS,FBADJ,FBMAX,FBDT,FBADJD,FBNOOUT,FBRRMK,CLESSR) ; Prompt for adjustments
"RTN","FBUTL2",6,0)
 ;
"RTN","FBUTL2",7,0)
 ; Input
"RTN","FBUTL2",8,0)
 ;   FBTAS  - required, total amount suspended, number, may be negative
"RTN","FBUTL2",9,0)
 ;            the sum of all adjustment amounts must equal this value
"RTN","FBUTL2",10,0)
 ;   FBADJ  - required, array passed by reference
"RTN","FBUTL2",11,0)
 ;            will be initialized (killed)
"RTN","FBUTL2",12,0)
 ;            array of any entered adjustments
"RTN","FBUTL2",13,0)
 ;            format
"RTN","FBUTL2",14,0)
 ;              FBADJ(#)=FBADJR^FBADJG^FBADJA
"RTN","FBUTL2",15,0)
 ;            where
"RTN","FBUTL2",16,0)
 ;              # = sequentially assigned number starting with 1
"RTN","FBUTL2",17,0)
 ;              FBADJR = adjustment reason (internal value file 162.91)
"RTN","FBUTL2",18,0)
 ;              FBADJG = adjustment group (inernal value file 162.92)
"RTN","FBUTL2",19,0)
 ;              FBADJA = adjustment amount (dollar value)
"RTN","FBUTL2",20,0)
 ;   FBMAX  -  optional, number, default to 1
"RTN","FBUTL2",21,0)
 ;             maximum number of adjustments that may be entered by user
"RTN","FBUTL2",22,0)
 ;   FBDT   -  optional, effective date, FileMan internal format
"RTN","FBUTL2",23,0)
 ;             default to current date, used to determine available codes
"RTN","FBUTL2",24,0)
 ;   FBADJD -  optional, array passed by reference
"RTN","FBUTL2",25,0)
 ;             same format as FBADJ
"RTN","FBUTL2",26,0)
 ;             if passed, it will be used to supply default values
"RTN","FBUTL2",27,0)
 ;             normally only used when editing an existing payment 
"RTN","FBUTL2",28,0)
 ;   FBNOOUT-  optional, boolean value, default 0, set =1 if user
"RTN","FBUTL2",29,0)
 ;             should not be allowed to exit using an uparrow
"RTN","FBUTL2",30,0)
 ;   CLESSR -  CARCless RARCs flag; prompt for if 'true'
"RTN","FBUTL2",31,0)
 ;
"RTN","FBUTL2",32,0)
 ; Result (value of $$ADJ extrinsic function)
"RTN","FBUTL2",33,0)
 ;   FBRET  - boulean value (0 or 1)
"RTN","FBUTL2",34,0)
 ;             = 1 when valid adjustments entered
"RTN","FBUTL2",35,0)
 ;             = 0 when processed ended due to time-out or entry of '^'
"RTN","FBUTL2",36,0)
 ; Output
"RTN","FBUTL2",37,0)
 ;   FBADJ  - the FBADJ input array passed by reference will be modified
"RTN","FBUTL2",38,0)
 ;            if the result = 1 then it will contain entered adjustments
"RTN","FBUTL2",39,0)
 ;            if the result = 0 then it will be undefined
"RTN","FBUTL2",40,0)
 ;   FBRRMK - array of remittance remark codes
"RTN","FBUTL2",41,0)
 ;
"RTN","FBUTL2",42,0)
DBG ;
"RTN","FBUTL2",43,0)
 N FBADJR,FBCAS,FBCNT,FBEDIT,FBERR,FBI,FBNEW,FBRET,FBRRMKD
"RTN","FBUTL2",44,0)
 N DIR,DIRUT,DTOUT,DUOUT,X,Y,FBXX,FBCORES
"RTN","FBUTL2",45,0)
 S FBRET=1
"RTN","FBUTL2",46,0)
 S FBMAX=$G(FBMAX,1)
"RTN","FBUTL2",47,0)
 S FBDT=$G(FBDT,DT)
"RTN","FBUTL2",48,0)
 S FBNOOUT=$G(FBNOOUT,0)
"RTN","FBUTL2",49,0)
 S FBTAS=+FBTAS
"RTN","FBUTL2",50,0)
 K FBADJ
"RTN","FBUTL2",51,0)
 ;
"RTN","FBUTL2",52,0)
 I +FBTAS=0 G EXIT ; no adjustment since total amount susp. is 0
"RTN","FBUTL2",53,0)
 ;
"RTN","FBUTL2",54,0)
 ; if default adjustments exist then load them into array
"RTN","FBUTL2",55,0)
 I $D(FBADJD) M FBADJ=FBADJD
"RTN","FBUTL2",56,0)
 S (FBCNT,FBCAS)=0
"RTN","FBUTL2",57,0)
 I $D(FBADJ) S FBI=0 F  S FBI=$O(FBADJ(FBI)) Q:'FBI  D
"RTN","FBUTL2",58,0)
 . S FBCNT=FBCNT+1
"RTN","FBUTL2",59,0)
 . S FBCAS=FBCAS+$P(FBADJ(FBI),U,3)
"RTN","FBUTL2",60,0)
 ;
"RTN","FBUTL2",61,0)
 ; if more than one adjustment can be entered then display number
"RTN","FBUTL2",62,0)
 ;
"RTN","FBUTL2",63,0)
 ;
"RTN","FBUTL2",64,0)
ASKADJ ; multiply prompt for adjustments
"RTN","FBUTL2",65,0)
 ;
"RTN","FBUTL2",66,0)
 ; get default core scenario
"RTN","FBUTL2",67,0)
 S FBCORES=""
"RTN","FBUTL2",68,0)
 I $D(FBADJ(1)) D
"RTN","FBUTL2",69,0)
 . S FBCORES=$P(^FB(161.91,$P(FBADJ(1),U),0),U,3) ;CORE Scenario
"RTN","FBUTL2",70,0)
 ;
"RTN","FBUTL2",71,0)
 ; display current list of adjustments when more than 1 allowed
"RTN","FBUTL2",72,0)
 I FBMAX>1!(FBCNT>1) D
"RTN","FBUTL2",73,0)
 . W !!,"Current list of Adjustments: "
"RTN","FBUTL2",74,0)
 . I '$O(FBADJ(0)) W "none"
"RTN","FBUTL2",75,0)
 . S FBI=0 F  S FBI=$O(FBADJ(FBI)) Q:'FBI  D
"RTN","FBUTL2",76,0)
 . . W ?30,"Code: "
"RTN","FBUTL2",77,0)
 . . W:$P(FBADJ(FBI),U)]"" $P($G(^FB(161.91,$P(FBADJ(FBI),U),0)),U)
"RTN","FBUTL2",78,0)
 . . W ?44,"Group: "
"RTN","FBUTL2",79,0)
 . . W:$P(FBADJ(FBI),U,2)]"" $P($G(^FB(161.92,$P(FBADJ(FBI),U,2),0)),U)
"RTN","FBUTL2",80,0)
 . . W ?56,"Amount: "
"RTN","FBUTL2",81,0)
 . . W "$",$FN($P(FBADJ(FBI),U,3),"",2),!
"RTN","FBUTL2",82,0)
 ;
"RTN","FBUTL2",83,0)
 ; prompt for adjustment reason
"RTN","FBUTL2",84,0)
 ;   if max is 1 and reason already on list then automatically select it
"RTN","FBUTL2",85,0)
 I FBMAX=1,FBCNT=1 D
"RTN","FBUTL2",86,0)
 . N FBI,FBADJR
"RTN","FBUTL2",87,0)
 . S FBI=$O(FBADJ(0))
"RTN","FBUTL2",88,0)
 . S:FBI FBADJR=$P(FBADJ(FBI),U)
"RTN","FBUTL2",89,0)
 . I FBADJR S Y=FBADJR_U_$P($G(^FB(161.91,FBADJR,0)),U)
"RTN","FBUTL2",90,0)
 E  D  I $D(DTOUT)!$D(DUOUT) S FBRET=0 G EXIT  ; prompt user
"RTN","FBUTL2",91,0)
 . S DIR(0)="PO^161.91:EMZ"
"RTN","FBUTL2",92,0)
 . S DIR("A")="Select ADJUSTMENT REASON"
"RTN","FBUTL2",93,0)
 . S DIR("S")="I $P($$AR^FBUTL1(Y,,FBDT,,FBCORES),U,4)=1"
"RTN","FBUTL2",94,0)
 . S DIR("?")="Select a HIPAA Adjustment (suspense) Reason Code"
"RTN","FBUTL2",95,0)
 . S DIR("?",1)="Adjustment reason codes explain why the amount paid differs"
"RTN","FBUTL2",96,0)
 . S DIR("?",2)="from the amount claimed."
"RTN","FBUTL2",97,0)
 . D ^DIR K DIR
"RTN","FBUTL2",98,0)
 ; if value was entered then process it and ask another if not max and
"RTN","FBUTL2",99,0)
 ;   total amount suspended has not been accounted for
"RTN","FBUTL2",100,0)
 I +Y>0 D  G:FBRET=0 EXIT I FBCNT<FBMAX,FBCAS'=FBTAS G ASKADJ
"RTN","FBUTL2",101,0)
 . S FBADJR=+Y
"RTN","FBUTL2",102,0)
 . ; if specified adj. reason already in list set FBEDIT = it's number
"RTN","FBUTL2",103,0)
 . S (FBI,FBEDIT)=0 F  S FBI=$O(FBADJ(FBI)) Q:'FBI  D  Q:FBEDIT
"RTN","FBUTL2",104,0)
 . . I $P(FBADJ(FBI),U)=FBADJR S FBEDIT=FBI
"RTN","FBUTL2",105,0)
 . S FBNEW=$S(FBEDIT:0,1:1) ; flag as new if not on list
"RTN","FBUTL2",106,0)
 . ; if in list then edit the existing adj. reason
"RTN","FBUTL2",107,0)
 . I FBEDIT D  Q:$D(DIRUT)  Q:FBADJR=""
"RTN","FBUTL2",108,0)
 . . S DIR(0)="162.558,.01"
"RTN","FBUTL2",109,0)
 . . S DIR("B")=$P($G(^FB(161.91,FBADJR,0)),U)
"RTN","FBUTL2",110,0)
 . . D ^DIR K DIR I $D(DTOUT)!$D(DUOUT) S:FBMAX=1 FBRET=0 Q
"RTN","FBUTL2",111,0)
 . . I X="@" D  Q  ; "@" removes from list
"RTN","FBUTL2",112,0)
 . . . D DEL(FBEDIT)
"RTN","FBUTL2",113,0)
 . . . S FBADJR=""
"RTN","FBUTL2",114,0)
 . . . W "   (deleted)"
"RTN","FBUTL2",115,0)
 . . I +Y>0 D  S FBADJR=+Y
"RTN","FBUTL2",116,0)
 . . . I +Y'=FBADJR K FBRRMK(FBADJR) ;get rid of rarcs associated with old reason
"RTN","FBUTL2",117,0)
 . . ; ensure new value of edited reason is not already on list
"RTN","FBUTL2",118,0)
 . . S FBI=0 F  S FBI=$O(FBADJ(FBI)) Q:'FBI  D  Q:FBADJR=""
"RTN","FBUTL2",119,0)
 . . . I $P(FBADJ(FBI),U)=FBADJR,FBI'=FBEDIT S FBADJR="" W !,$C(7),"     Change was not accepted because the new value is already on the list."
"RTN","FBUTL2",120,0)
 . . Q:FBADJR=""
"RTN","FBUTL2",121,0)
 . . ; upate the existing reason
"RTN","FBUTL2",122,0)
 . . S $P(FBADJ(FBEDIT),U)=FBADJR
"RTN","FBUTL2",123,0)
 . ;
"RTN","FBUTL2",124,0)
 . ; if new reason then add to list
"RTN","FBUTL2",125,0)
 . I 'FBEDIT D  Q:FBADJR=""
"RTN","FBUTL2",126,0)
 . . I (FBCNT+1)>FBMAX D  Q
"RTN","FBUTL2",127,0)
 . . . S FBADJR=""
"RTN","FBUTL2",128,0)
 . . . W !,$C(7),"ERROR: A new reason would exceed maximum number (",FBMAX,") allowed for this invoice."
"RTN","FBUTL2",129,0)
 . . . W !,"   Select a reason code on the current list instead."
"RTN","FBUTL2",130,0)
 . . S FBEDIT=$O(FBADJ(" "),-1)+1
"RTN","FBUTL2",131,0)
 . . S $P(FBADJ(FBEDIT),U)=FBADJR,FBCNT=FBCNT+1
"RTN","FBUTL2",132,0)
 . ;
"RTN","FBUTL2",133,0)
 . ; ask for RARCs
"RTN","FBUTL2",134,0)
 . ;I '$D(FBPRICE),$G(FBEXMPT)="Y",'$G(FBDEN) D
"RTN","FBUTL2",135,0)
 .  I $D(FBRRMK) M FBRRMKD=FBRRMK
"RTN","FBUTL2",136,0)
 .  S FBXX=$$RR^FBUTL4(.FBRRMK,2,FBDT,.FBRRMKD,FBADJR)
"RTN","FBUTL2",137,0)
 . ;
"RTN","FBUTL2",138,0)
 . ; let's do some group processing
"RTN","FBUTL2",139,0)
 . S GRPS=","
"RTN","FBUTL2",140,0)
 . I $D(FBRRMK(FBADJR)) D  ;RARCs first
"RTN","FBUTL2",141,0)
 . . S I="" F  S I=$O(FBRRMK(FBADJR,I)) Q:'I  D
"RTN","FBUTL2",142,0)
 . . . S RRIEN=FBRRMK(FBADJR,I)
"RTN","FBUTL2",143,0)
 . . . I RRIEN,$D(^FB(161.93,RRIEN,3)) D  ;if the RARC has groups...
"RTN","FBUTL2",144,0)
 . . . . S AGI=0 F  S AGI=$O(^FB(161.93,RRIEN,3,AGI)) Q:'AGI  D  ;group associations
"RTN","FBUTL2",145,0)
 . . . . . S GIEN=$P(^FB(161.93,RRIEN,3,AGI,0),U)
"RTN","FBUTL2",146,0)
 . . . . . Q:'$D(^FB(161.92,GIEN,0))
"RTN","FBUTL2",147,0)
 . . . . . S GCD=$P(^FB(161.92,GIEN,0),U)
"RTN","FBUTL2",148,0)
 . . . . . I GRPS'[GCD S GRPS=GRPS_GCD_","
"RTN","FBUTL2",149,0)
 . I GRPS=",",$D(^FB(161.91,FBADJR,3)) D  ;if the RARCs didn't have groups and the CARC has groups...
"RTN","FBUTL2",150,0)
 . . S AGI=0 F  S AGI=$O(^FB(161.91,FBADJR,3,AGI)) Q:'AGI  D
"RTN","FBUTL2",151,0)
 . . . S GIEN=$P(^FB(161.91,FBADJR,3,AGI,0),U)
"RTN","FBUTL2",152,0)
 . . . I $D(^FB(161.92,GIEN)) D  ;get the codes and string them together
"RTN","FBUTL2",153,0)
 . . . . S GCD=$P(^FB(161.92,GIEN,0),U)
"RTN","FBUTL2",154,0)
 . . . . S GRPS=GRPS_GCD_","
"RTN","FBUTL2",155,0)
 . ; ask for adjustment group
"RTN","FBUTL2",156,0)
 . S DIC=161.92,DIC(0)="AQZ",DIC("A")="ADJUSTMENT GROUP: "
"RTN","FBUTL2",157,0)
 . I $P(FBADJ(FBEDIT),U,2)]"" S DIC("B")=$P($G(^FB(161.92,$P(FBADJ(FBEDIT),U,2),0)),U)
"RTN","FBUTL2",158,0)
 . S DIC("S")="I (GRPS="","")!(GRPS[$P(^(0),U))"
"RTN","FBUTL2",159,0)
 . D ^DIC
"RTN","FBUTL2",160,0)
 . I $D(DTOUT)!$D(DUOUT)!(Y=-1) D:FBNEW DEL(FBEDIT) Q
"RTN","FBUTL2",161,0)
 . S $P(FBADJ(FBEDIT),U,2)=+Y
"RTN","FBUTL2",162,0)
 . K DIC
"RTN","FBUTL2",163,0)
 . ;
"RTN","FBUTL2",164,0)
 . ; ask for adjustment amount
"RTN","FBUTL2",165,0)
 . S DIR(0)="162.558,2"
"RTN","FBUTL2",166,0)
 . ;S DIR(0)="NA^-9999999.99:9999999.99:2^K:+X=0 X"
"RTN","FBUTL2",167,0)
 . ;S DIR("A")="  ADJUSTMENT AMOUNT: "
"RTN","FBUTL2",168,0)
 . S DIR("B")=$FN(FBTAS-FBCAS+$P(FBADJ(FBEDIT),U,3),"",2)
"RTN","FBUTL2",169,0)
 . D ^DIR K DIR I $D(DIRUT) D:FBNEW DEL(FBEDIT) Q
"RTN","FBUTL2",170,0)
 . S FBCAS=FBCAS-$P($G(FBADJ(FBEDIT)),U,3)+Y
"RTN","FBUTL2",171,0)
 . S $P(FBADJ(FBEDIT),U,3)=+Y
"RTN","FBUTL2",172,0)
 ;
"RTN","FBUTL2",173,0)
VAL ; validate
"RTN","FBUTL2",174,0)
 S FBERR=0
"RTN","FBUTL2",175,0)
 I FBCAS'=FBTAS D
"RTN","FBUTL2",176,0)
 . S FBERR=1
"RTN","FBUTL2",177,0)
 . W !,$C(7),"ERROR: Must account for $",$FN(FBTAS-FBCAS,"",2)," more to cover the total amount suspended."
"RTN","FBUTL2",178,0)
 . W !,"   The current sum of adjustments is $",$FN(FBCAS,"",2),"."
"RTN","FBUTL2",179,0)
 . W !,"   The total amount suspended is $",$FN(FBTAS,"",2),"."
"RTN","FBUTL2",180,0)
 I FBCNT>FBMAX D
"RTN","FBUTL2",181,0)
 . S FBERR=1
"RTN","FBUTL2",182,0)
 . W !,$C(7),"ERROR: Maximum number of adjustment reasons (",FBMAX,") have been exceeded."
"RTN","FBUTL2",183,0)
 I FBERR G ASKADJ
"RTN","FBUTL2",184,0)
 ;
"RTN","FBUTL2",185,0)
EXIT ;
"RTN","FBUTL2",186,0)
 ;CARCless RARCs
"RTN","FBUTL2",187,0)
 S:$G(CLESSR) FBXX=$$CLESSR^FBUTL4A(.FBADJ,FBMAX,.FBRRMK)
"RTN","FBUTL2",188,0)
 ;
"RTN","FBUTL2",189,0)
XEXIT ;
"RTN","FBUTL2",190,0)
 ; if time-out or uparrow and total amount not covered then check if
"RTN","FBUTL2",191,0)
 ; exit is allowed by the calling routine. (not allowed during edit)
"RTN","FBUTL2",192,0)
 I FBRET=0,FBNOOUT S FBRET=1 I FBTAS'=FBCAS G VAL
"RTN","FBUTL2",193,0)
 I FBRET=0 K FBADJ
"RTN","FBUTL2",194,0)
 ;
"RTN","FBUTL2",195,0)
 Q FBRET
"RTN","FBUTL2",196,0)
 ;
"RTN","FBUTL2",197,0)
DEL(FBI) ; delete adjustment reason from list
"RTN","FBUTL2",198,0)
 S FBCAS=FBCAS-$P($G(FBADJ(FBI)),U,3)
"RTN","FBUTL2",199,0)
 S FBCNT=FBCNT-1
"RTN","FBUTL2",200,0)
 K FBADJ(FBI),FBRRMK(FBADJR)
"RTN","FBUTL2",201,0)
 S FBADJR=""
"RTN","FBUTL2",202,0)
 W "   (reason deleted)"
"RTN","FBUTL2",203,0)
 Q
"RTN","FBUTL2",204,0)
 ;
"RTN","FBUTL2",205,0)
ADJL(FBADJ) ; build list of adjustments extrinsic function
"RTN","FBUTL2",206,0)
 ; Input
"RTN","FBUTL2",207,0)
 ;   FBADJ  - required, array passed by reference
"RTN","FBUTL2",208,0)
 ;            array adjustments
"RTN","FBUTL2",209,0)
 ;            format
"RTN","FBUTL2",210,0)
 ;              FBADJ(#)=FBADJR^FBADJG^FBADJA
"RTN","FBUTL2",211,0)
 ;            where
"RTN","FBUTL2",212,0)
 ;              # = integer number greater than 0
"RTN","FBUTL2",213,0)
 ;              FBADJR = adjustment reason (internal value file 162.91)
"RTN","FBUTL2",214,0)
 ;              FBADJG = adjustment group (inernal value file 162.92)
"RTN","FBUTL2",215,0)
 ;              FBADJA = adjustment amount (dollar value)
"RTN","FBUTL2",216,0)
 ; Result
"RTN","FBUTL2",217,0)
 ;   string containing sorted list (by external reason) of adjustments
"RTN","FBUTL2",218,0)
 ;   format
"RTN","FBUTL2",219,0)
 ;      FBADJRE 1^FBADJGE 1^FBADJAE 1^FBADJRE 2^FBADJGE 2^FBADJAE 2
"RTN","FBUTL2",220,0)
 ;   where
"RTN","FBUTL2",221,0)
 ;      FBADJRE = adjustment reason (external value)
"RTN","FBUTL2",222,0)
 ;      FBADJGE = adjustment group (external value)
"RTN","FBUTL2",223,0)
 ;      FBADJAE = adjustment amount (with cents)
"RTN","FBUTL2",224,0)
 N FBRET
"RTN","FBUTL2",225,0)
 N FBARJR,FBADJRE,FBADJG,FBADJGE,FBADJA,FBADJAE
"RTN","FBUTL2",226,0)
 N FBI,FBADJS
"RTN","FBUTL2",227,0)
 S FBRET=""
"RTN","FBUTL2",228,0)
 ;
"RTN","FBUTL2",229,0)
 ; build sorted array containing external values
"RTN","FBUTL2",230,0)
 S FBI=0 F  S FBI=$O(FBADJ(FBI)) Q:'FBI  D
"RTN","FBUTL2",231,0)
 . ; obtain internal values
"RTN","FBUTL2",232,0)
 . S FBADJR=$P(FBADJ(FBI),U)
"RTN","FBUTL2",233,0)
 . S FBADJG=$P(FBADJ(FBI),U,2)
"RTN","FBUTL2",234,0)
 . S FBADJA=$P(FBADJ(FBI),U,3)
"RTN","FBUTL2",235,0)
 . ; convert to external values
"RTN","FBUTL2",236,0)
 . S FBADJRE=$S(FBADJR:$P($G(^FB(161.91,FBADJR,0)),U),1:"")
"RTN","FBUTL2",237,0)
 . S FBADJGE=$S(FBADJG:$P($G(^FB(161.92,FBADJG,0)),U),1:"")
"RTN","FBUTL2",238,0)
 . S FBADJAE=$FN(FBADJA,"",2)
"RTN","FBUTL2",239,0)
 . ; store in sorted array
"RTN","FBUTL2",240,0)
 . S FBADJS(FBADJRE_U_FBI)=FBADJRE_U_FBADJGE_U_FBADJAE_U
"RTN","FBUTL2",241,0)
 ;
"RTN","FBUTL2",242,0)
 ; build list from sorted array
"RTN","FBUTL2",243,0)
 S FBI="" F  S FBI=$O(FBADJS(FBI)) Q:FBI=""  D
"RTN","FBUTL2",244,0)
 . S FBRET=FBRET_FBADJS(FBI)
"RTN","FBUTL2",245,0)
 ; strip trailing "^" from list
"RTN","FBUTL2",246,0)
 I $E(FBRET,$L(FBRET))="^" S FBRET=$E(FBRET,1,$L(FBRET)-1)
"RTN","FBUTL2",247,0)
 ;
"RTN","FBUTL2",248,0)
 Q FBRET
"RTN","FBUTL2",249,0)
 ;
"RTN","FBUTL2",250,0)
ADJLR(FBADJL) ; build list of adjustment reasons extrinsic function
"RTN","FBUTL2",251,0)
 ; Input
"RTN","FBUTL2",252,0)
 ;   FBADJL - required, string containing sorted list
"RTN","FBUTL2",253,0)
 ;           (by external reason) of adjustments (see $$ADJL result)
"RTN","FBUTL2",254,0)
 ; Result
"RTN","FBUTL2",255,0)
 ;   sting of adjustment reasons delimited by commas
"RTN","FBUTL2",256,0)
 ;
"RTN","FBUTL2",257,0)
 N FBRET,FBADJRE
"RTN","FBUTL2",258,0)
 N FBI
"RTN","FBUTL2",259,0)
 S FBRET=""
"RTN","FBUTL2",260,0)
 F FBI=1:3 S FBADJRE=$P(FBADJL,U,FBI) Q:FBADJRE=""  S FBRET=FBRET_FBADJRE_","
"RTN","FBUTL2",261,0)
 ; strip trailing "," from list
"RTN","FBUTL2",262,0)
 I $E(FBRET,$L(FBRET))="," S FBRET=$E(FBRET,1,$L(FBRET)-1)
"RTN","FBUTL2",263,0)
 ;
"RTN","FBUTL2",264,0)
 Q FBRET
"RTN","FBUTL2",265,0)
 ;
"RTN","FBUTL2",266,0)
ADJLA(FBADJL) ; build list of adjustment amounts extrinsic function
"RTN","FBUTL2",267,0)
 ; Input
"RTN","FBUTL2",268,0)
 ;   FBADJL - required, string containing sorted list
"RTN","FBUTL2",269,0)
 ;           (by external reason) of adjustments (see $$ADJL result)
"RTN","FBUTL2",270,0)
 ; Result
"RTN","FBUTL2",271,0)
 ;   sting of adjustment reasons delimited by commas
"RTN","FBUTL2",272,0)
 ;
"RTN","FBUTL2",273,0)
 N FBRET,FBADJRE
"RTN","FBUTL2",274,0)
 N FBI
"RTN","FBUTL2",275,0)
 S FBRET=""
"RTN","FBUTL2",276,0)
 F FBI=3:3 S FBADJRE=$P(FBADJL,U,FBI) Q:FBADJRE=""  S FBRET=FBRET_FBADJRE_","
"RTN","FBUTL2",277,0)
 ; strip trailing "," from list
"RTN","FBUTL2",278,0)
 I $E(FBRET,$L(FBRET))="," S FBRET=$E(FBRET,1,$L(FBRET)-1)
"RTN","FBUTL2",279,0)
 ;
"RTN","FBUTL2",280,0)
 Q FBRET
"RTN","FBUTL2",281,0)
 ;
"RTN","FBUTL2",282,0)
 ;FBUTL2
"RTN","FBUTL4")
0^13^B26671787^B23579110
"RTN","FBUTL4",1,0)
FBUTL4 ;WOIFO/SAB-FEE BASIS UTILITY ;7/6/2003
"RTN","FBUTL4",2,0)
 ;;3.5;FEE BASIS;**61,158**;JAN 30, 1995;Build 94
"RTN","FBUTL4",3,0)
 ;;Per VA Directive 6402, this routine should not be modified.
"RTN","FBUTL4",4,0)
 ;;Per VA Directive 6402, this routine should not be modified.
"RTN","FBUTL4",5,0)
 Q
"RTN","FBUTL4",6,0)
RR(FBRRMK,FBMAX,FBDT,FBRRMKD,FBADJ) ; Prompt for Remittance Remarks
"RTN","FBUTL4",7,0)
 ;
"RTN","FBUTL4",8,0)
 ; Input
"RTN","FBUTL4",9,0)
 ;   FBRRMK - required, array passed by reference
"RTN","FBUTL4",10,0)
 ;            will be initialized (killed)
"RTN","FBUTL4",11,0)
 ;            array of any entered remark codes
"RTN","FBUTL4",12,0)
 ;            format
"RTN","FBUTL4",13,0)
 ;              FBRRMK(#)=FBRRMKC
"RTN","FBUTL4",14,0)
 ;            where
"RTN","FBUTL4",15,0)
 ;              # = sequentially assigned number starting with 1
"RTN","FBUTL4",16,0)
 ;              FBRRMKC = remittance remark (internal value file 162.93)
"RTN","FBUTL4",17,0)
 ;   FBMAX  -  optional, number, default to 2
"RTN","FBUTL4",18,0)
 ;             maximum number of remarks that may be entered by user
"RTN","FBUTL4",19,0)
 ;   FBDT   -  optional, effective date, FileMan internal format
"RTN","FBUTL4",20,0)
 ;             default to current date, used to determine available codes
"RTN","FBUTL4",21,0)
 ;   FBRRMKD-  optional, array passed by reference
"RTN","FBUTL4",22,0)
 ;             same format as FBRRMK
"RTN","FBUTL4",23,0)
 ;             if passed, it will be used to supply default values
"RTN","FBUTL4",24,0)
 ;             normally only used when editing an existing payment
"RTN","FBUTL4",25,0)
 ;   FBADJ  -  adjustment reason code IEN
"RTN","FBUTL4",26,0)
 ; Result (value of $$RR extrinsic function)
"RTN","FBUTL4",27,0)
 ;   FBRET  - boulean value (0 or 1)
"RTN","FBUTL4",28,0)
 ;             = 1 when process did not end due to time-out or "^"
"RTN","FBUTL4",29,0)
 ;             = 0 when process ended due to time-out OR "^"
"RTN","FBUTL4",30,0)
 ; Output
"RTN","FBUTL4",31,0)
 ;   FBRRMK-  the FBRRMK input array passed by reference will be modified
"RTN","FBUTL4",32,0)
 ;            it will contain any entered remarks
"RTN","FBUTL4",33,0)
 ;
"RTN","FBUTL4",34,0)
 N FBRRMKC,FBCNT,FBEDIT,FBERR,FBI,FBNEW,FBRET
"RTN","FBUTL4",35,0)
 N DIR,DIRUT,DTOUT,DUOUT,X,Y,FBADJI
"RTN","FBUTL4",36,0)
 S FBADJI=0
"RTN","FBUTL4",37,0)
 S FBRET=1
"RTN","FBUTL4",38,0)
 S FBMAX=$G(FBMAX,2)
"RTN","FBUTL4",39,0)
 S FBDT=$G(FBDT,DT)
"RTN","FBUTL4",40,0)
 K FBRRMK(FBADJ)
"RTN","FBUTL4",41,0)
 ;
"RTN","FBUTL4",42,0)
 ; if default remarks exist then load them into array
"RTN","FBUTL4",43,0)
 I $D(FBRRMKD(FBADJ)) M FBRRMK(FBADJ)=FBRRMKD(FBADJ)
"RTN","FBUTL4",44,0)
 S FBCNT=0
"RTN","FBUTL4",45,0)
 I $D(FBRRMK(FBADJ)) S FBI=0 F  S FBI=$O(FBRRMK(FBADJ,FBI)) Q:'FBI  S FBCNT=FBCNT+1
"RTN","FBUTL4",46,0)
 ;
"RTN","FBUTL4",47,0)
ASKRR ; multiply prompt for remarks
"RTN","FBUTL4",48,0)
 ;
"RTN","FBUTL4",49,0)
 ; display current list of remarks when more than 1 allowed
"RTN","FBUTL4",50,0)
 I FBMAX>1!(FBCNT>1) D
"RTN","FBUTL4",51,0)
 . W !!,"Current list of Remittance Remarks: "
"RTN","FBUTL4",52,0)
 . I '$O(FBRRMK(FBADJ,0)) W "none"
"RTN","FBUTL4",53,0)
 . S FBI=0 F  S FBI=$O(FBRRMK(FBADJ,FBI)) Q:'FBI  D
"RTN","FBUTL4",54,0)
 . . W:$P(FBRRMK(FBADJ,FBI),U)]"" $P($G(^FB(161.93,$P(FBRRMK(FBADJ,FBI),U),0)),U),", "
"RTN","FBUTL4",55,0)
 . W !
"RTN","FBUTL4",56,0)
 ;
"RTN","FBUTL4",57,0)
 ; prompt for remark
"RTN","FBUTL4",58,0)
 ;   if max is 1 and reason already on list then automatically select it
"RTN","FBUTL4",59,0)
 I FBMAX=1,FBCNT=1 D
"RTN","FBUTL4",60,0)
 . N FBI,FBRRMKC
"RTN","FBUTL4",61,0)
 . S FBI=$O(FBRRMK(FBADJ,0))
"RTN","FBUTL4",62,0)
 . S:FBI FBRRMKC=$P(FBRRMK(FBADJ,FBI),U)
"RTN","FBUTL4",63,0)
 . I FBRRMKC S Y=FBRRMKC_U_$P($G(^FB(161.93,FBRRMKC,0)),U)
"RTN","FBUTL4",64,0)
 E  D  I $D(DTOUT)!$D(DUOUT) S FBRET=0 G EXIT  ; prompt user
"RTN","FBUTL4",65,0)
 . S DIR(0)="PO^161.93:EMZ"
"RTN","FBUTL4",66,0)
 . S DIR("A")="Select REMITTANCE REMARK"
"RTN","FBUTL4",67,0)
 . S DIR("S")="I $P($$RR^FBUTL1(Y,,FBDT,,FBADJ),U,4)=1"
"RTN","FBUTL4",68,0)
 . S DIR("?")="Select a HIPAA Remittance Remark Code."
"RTN","FBUTL4",69,0)
 . S DIR("?",1)="Select a remittance remark code to provide non-financial"
"RTN","FBUTL4",70,0)
 . S DIR("?",2)="information critical to understanding the adjudication of the claim."
"RTN","FBUTL4",71,0)
 . D ^DIR K DIR
"RTN","FBUTL4",72,0)
 ;
"RTN","FBUTL4",73,0)
 ; if value was entered then process it and ask another if not max
"RTN","FBUTL4",74,0)
 ;I +Y>0 D  G:FBRET=0 EXIT I FBCNT<FBMAX!(FBRRMKC="") G ASKRR
"RTN","FBUTL4",75,0)
 I +Y>0 D  G:FBRET=0 EXIT G ASKRR
"RTN","FBUTL4",76,0)
 . S FBRRMKC=+Y
"RTN","FBUTL4",77,0)
 . ; if specified remark already in list set FBEDIT = it's number
"RTN","FBUTL4",78,0)
 . S (FBI,FBEDIT)=0 F  S FBI=$O(FBRRMK(FBADJ,FBI)) Q:'FBI  D  Q:FBEDIT
"RTN","FBUTL4",79,0)
 . . I $P(FBRRMK(FBADJ,FBI),U)=FBRRMKC S FBEDIT=FBI
"RTN","FBUTL4",80,0)
 . S FBNEW=$S(FBEDIT:0,1:1) ; flag as new if not on list
"RTN","FBUTL4",81,0)
 . ; if in list then edit the existing remark
"RTN","FBUTL4",82,0)
 . I FBEDIT D  Q:$D(DIRUT)  Q:FBRRMKC=""
"RTN","FBUTL4",83,0)
 . . S DIR(0)="162.559,.01"
"RTN","FBUTL4",84,0)
 . . S DIR("B")=$P($G(^FB(161.93,FBRRMKC,0)),U)
"RTN","FBUTL4",85,0)
 . . D ^DIR K DIR I $D(DTOUT)!$D(DUOUT) S:FBMAX=1 FBRET=0 Q
"RTN","FBUTL4",86,0)
 . . I X="@" D  Q  ; "@" removes from list
"RTN","FBUTL4",87,0)
 . . . D DEL(FBADJ,FBEDIT)
"RTN","FBUTL4",88,0)
 . . I +Y>0 S FBRRMKC=+Y
"RTN","FBUTL4",89,0)
 . . ; ensure new value of edited remark is not already on list
"RTN","FBUTL4",90,0)
 . . S FBI=0 F  S FBI=$O(FBRRMK(FBADJ,FBI)) Q:'FBI  D  Q:FBRRMKC=""
"RTN","FBUTL4",91,0)
 . . . I $P(FBRRMK(FBADJ,FBI),U)=FBRRMKC,FBI'=FBEDIT S FBRRMKC="" W !,$C(7),"     Change was not accepted because the new value is already on the list."
"RTN","FBUTL4",92,0)
 . . Q:FBRRMKC=""
"RTN","FBUTL4",93,0)
 . . ; upate the existing reason
"RTN","FBUTL4",94,0)
 . . S $P(FBRRMK(FBADJ,FBEDIT),U)=FBRRMKC
"RTN","FBUTL4",95,0)
 . ;
"RTN","FBUTL4",96,0)
 . ; if new reason then add to list
"RTN","FBUTL4",97,0)
 . I 'FBEDIT D  Q:FBRRMKC=""
"RTN","FBUTL4",98,0)
 . . I (FBCNT+1)>FBMAX D  Q
"RTN","FBUTL4",99,0)
 . . . S FBRRMKC=""
"RTN","FBUTL4",100,0)
 . . . W !!,$C(7),"ERROR: A new reason would exceed maximum number (",FBMAX,") allowed for this invoice."
"RTN","FBUTL4",101,0)
 . . . W !,"  If necessary, a code on the current list can be selected and changed."
"RTN","FBUTL4",102,0)
 . . S FBEDIT=$O(FBRRMK(FBADJ," "),-1)+1
"RTN","FBUTL4",103,0)
 . . S $P(FBRRMK(FBADJ,FBEDIT),U)=FBRRMKC,FBCNT=FBCNT+1
"RTN","FBUTL4",104,0)
 ;
"RTN","FBUTL4",105,0)
 ; validate
"RTN","FBUTL4",106,0)
 I FBCNT>FBMAX D  G ASKRR
"RTN","FBUTL4",107,0)
 . W !!,$C(7),"ERROR: Maximum number of remittance remark codes (",FBMAX,") have been exceeded."
"RTN","FBUTL4",108,0)
 ;
"RTN","FBUTL4",109,0)
EXIT ;
"RTN","FBUTL4",110,0)
 Q FBRET
"RTN","FBUTL4",111,0)
 ;
"RTN","FBUTL4",112,0)
DEL(FBADJ,FBI) ; delete remark from list
"RTN","FBUTL4",113,0)
 S FBCNT=FBCNT-1
"RTN","FBUTL4",114,0)
 K FBRRMK(FBADJ,FBI)
"RTN","FBUTL4",115,0)
 S FBRRMKC=""
"RTN","FBUTL4",116,0)
 W "   (deleted)"
"RTN","FBUTL4",117,0)
 Q
"RTN","FBUTL4",118,0)
 ;
"RTN","FBUTL4",119,0)
RRL(FBRRMK) ; build list of remittance remarks extrinsic function
"RTN","FBUTL4",120,0)
 ; Input
"RTN","FBUTL4",121,0)
 ;   FBRRMK- required, array passed by reference
"RTN","FBUTL4",122,0)
 ;           array of remittance remarks
"RTN","FBUTL4",123,0)
 ;            format
"RTN","FBUTL4",124,0)
 ;              FBRRMK(ADJI,#)=FBRRMKC
"RTN","FBUTL4",125,0)
 ;            where
"RTN","FBUTL4",126,0)
 ;              ADJI = Adjustment Reason IEN
"RTN","FBUTL4",127,0)
 ;              # = integer number greater than 0
"RTN","FBUTL4",128,0)
 ;              FBRRMKC = remittance remark (internal value file 162.93)
"RTN","FBUTL4",129,0)
 ; Result
"RTN","FBUTL4",130,0)
 ;   string containing sorted list (by external code) of remarks
"RTN","FBUTL4",131,0)
 ;   format
"RTN","FBUTL4",132,0)
 ;      FBRRMKCE 1, FBRRMKCE 2
"RTN","FBUTL4",133,0)
 ;   where
"RTN","FBUTL4",134,0)
 ;      FBRRMKCE = remittance remark code (external value)
"RTN","FBUTL4",135,0)
 N FBRET,FBRRMKC,FBRRMKCE,FBRRMKS,FBI,ADJI
"RTN","FBUTL4",136,0)
 S FBRET=""
"RTN","FBUTL4",137,0)
 S ADJI=""
"RTN","FBUTL4",138,0)
 F  S ADJI=$O(FBRRMK(ADJI)) Q:'ADJI  D
"RTN","FBUTL4",139,0)
 . S FBI=0
"RTN","FBUTL4",140,0)
 . F  S FBI=$O(FBRRMK(ADJI,FBI)) Q:'FBI  D
"RTN","FBUTL4",141,0)
 . . ; obtain internal values
"RTN","FBUTL4",142,0)
 . . S FBRRMKC=$P(FBRRMK(ADJI,FBI),U)
"RTN","FBUTL4",143,0)
 . . ; convert to external values
"RTN","FBUTL4",144,0)
 . . S FBRRMKCE=$S(FBRRMKC:$P($G(^FB(161.93,FBRRMKC,0)),U),1:"")
"RTN","FBUTL4",145,0)
 . . ; store in sorted array
"RTN","FBUTL4",146,0)
 . . S FBRRMKS(FBRRMKCE_U_FBI)=FBRRMKCE_","
"RTN","FBUTL4",147,0)
 ;
"RTN","FBUTL4",148,0)
 ; build list from sorted array
"RTN","FBUTL4",149,0)
 S FBI="" F  S FBI=$O(FBRRMKS(FBI)) Q:FBI=""  D
"RTN","FBUTL4",150,0)
 . S FBRET=FBRET_FBRRMKS(FBI)
"RTN","FBUTL4",151,0)
 ; strip trailing "," from list
"RTN","FBUTL4",152,0)
 I $E(FBRET,$L(FBRET))="," S FBRET=$E(FBRET,1,$L(FBRET)-1)
"RTN","FBUTL4",153,0)
 ;
"RTN","FBUTL4",154,0)
 Q FBRET
"RTN","FBUTL4",155,0)
 ;
"RTN","FBUTL4",156,0)
 ;FBUTL4
"RTN","FBUTL4A")
0^29^B30641813^n/a
"RTN","FBUTL4A",1,0)
FBUTL4A ;WOIFO/SAB-FEE BASIS UTILITY ;7/6/2003
"RTN","FBUTL4A",2,0)
 ;;3.5;FEE BASIS;**61,158**;JAN 30, 1995;Build 94
"RTN","FBUTL4A",3,0)
 Q
"RTN","FBUTL4A",4,0)
 ;
"RTN","FBUTL4A",5,0)
CLESSR(FBADJ,AMAX,FBRRMK) ; CARCless RARCs
"RTN","FBUTL4A",6,0)
 ; Input:
"RTN","FBUTL4A",7,0)
 ;   FBADJ -> required, array of Adjustment Reasons
"RTN","FBUTL4A",8,0)
 ;   AMAX  -> required, maximum allowed number of adjustment reasons
"RTN","FBUTL4A",9,0)
 ;   FBRRMK -> required, array of remittance remarks
"RTN","FBUTL4A",10,0)
 N ADJI,RMAX,CLESS,FBRET,FBRRMKD
"RTN","FBUTL4A",11,0)
 S (CLESS,ADJI)=999
"RTN","FBUTL4A",12,0)
 I $D(FBADJ),$O(FBADJ("")) S ADJI=$O(FBADJ(ADJI),-1)
"RTN","FBUTL4A",13,0)
 I ADJI=AMAX K FBRRMK(CLESS) Q 0 ;no room in this invoice for additional RARCS 
"RTN","FBUTL4A",14,0)
 S RMAX=$S(ADJI=999:AMAX*2,1:(AMAX-ADJI)*2) ;determine how many CARCless RARCs are allowed
"RTN","FBUTL4A",15,0)
 ;#44 - determine whether current carcless rarc list exceeds the max allowed. If so, delete them all.
"RTN","FBUTL4A",16,0)
 S RCNT=$O(FBRRMK(CLESS,11),-1)
"RTN","FBUTL4A",17,0)
 I RCNT>RMAX K FBRRMK(CLESS)
"RTN","FBUTL4A",18,0)
 ;
"RTN","FBUTL4A",19,0)
 I $D(FBRRMK(CLESS)) M FBRRMKD(CLESS)=FBRRMK(CLESS)
"RTN","FBUTL4A",20,0)
 S FBDT=$G(FBDT,DT)
"RTN","FBUTL4A",21,0)
 S FBRET=$$RR(.FBRRMK,RMAX,FBDT,.FBRRMKD)
"RTN","FBUTL4A",22,0)
 Q FBRET
"RTN","FBUTL4A",23,0)
 ;
"RTN","FBUTL4A",24,0)
RR(FBRRMK,FBMAX,FBDT,FBRRMKD) ; Prompt for CARCless Remittance Remarks
"RTN","FBUTL4A",25,0)
 ;
"RTN","FBUTL4A",26,0)
 ; Input
"RTN","FBUTL4A",27,0)
 ;   FBRRMK - required, array passed by reference
"RTN","FBUTL4A",28,0)
 ;            will be initialized (killed)
"RTN","FBUTL4A",29,0)
 ;            array of any entered CARCless remark codes
"RTN","FBUTL4A",30,0)
 ;            format
"RTN","FBUTL4A",31,0)
 ;              FBRRMK(999,#)=FBRRMKC
"RTN","FBUTL4A",32,0)
 ;            where
"RTN","FBUTL4A",33,0)
 ;              # = sequentially assigned number starting with 1
"RTN","FBUTL4A",34,0)
 ;              FBRRMKC = remittance remark (internal value file 162.93)
"RTN","FBUTL4A",35,0)
 ;   FBMAX  -  maximum number of RARCs
"RTN","FBUTL4A",36,0)
 ;   FBDT   -  optional, effective date, FileMan internal format
"RTN","FBUTL4A",37,0)
 ;             default to current date, used to determine available codes
"RTN","FBUTL4A",38,0)
 ;   FBRRMKD-  optional, array passed by reference
"RTN","FBUTL4A",39,0)
 ;             same format as FBRRMK
"RTN","FBUTL4A",40,0)
 ;             if passed, it will be used to supply default values
"RTN","FBUTL4A",41,0)
 ;             normally only used when editing an existing payment 
"RTN","FBUTL4A",42,0)
 ; Result (value of $$RR extrinsic function)
"RTN","FBUTL4A",43,0)
 ;   FBRET  - boulean value (0 or 1)
"RTN","FBUTL4A",44,0)
 ;             = 1 when process did not end due to time-out or "^"
"RTN","FBUTL4A",45,0)
 ;             = 0 when process ended due to time-out OR "^"
"RTN","FBUTL4A",46,0)
 ; Output
"RTN","FBUTL4A",47,0)
 ;   FBRRMK-  the FBRRMK input array passed by reference will be modified
"RTN","FBUTL4A",48,0)
 ;            it will contain any entered remarks
"RTN","FBUTL4A",49,0)
 ;
"RTN","FBUTL4A",50,0)
 N FBRRMKC,FBCNT,FBEDIT,FBERR,FBI,FBNEW,FBRET
"RTN","FBUTL4A",51,0)
 N DIR,DIRUT,DTOUT,DUOUT,X,Y
"RTN","FBUTL4A",52,0)
 S FBRET=1
"RTN","FBUTL4A",53,0)
 K FBRRMK(999)
"RTN","FBUTL4A",54,0)
 ; if default remarks exist then load them into array
"RTN","FBUTL4A",55,0)
 I $D(FBRRMKD(999)) M FBRRMK(999)=FBRRMKD(999)
"RTN","FBUTL4A",56,0)
 S FBCNT=0
"RTN","FBUTL4A",57,0)
 I $D(FBRRMK(999)) S FBI=0 F  S FBI=$O(FBRRMK(999,FBI)) Q:'FBI  S FBCNT=FBCNT+1
"RTN","FBUTL4A",58,0)
 ;
"RTN","FBUTL4A",59,0)
ASKRR ; multiple prompts for CARCless RARCs
"RTN","FBUTL4A",60,0)
 ;
"RTN","FBUTL4A",61,0)
 ; display current list of remarks when more than 1 allowed
"RTN","FBUTL4A",62,0)
 I FBMAX>1!(FBCNT>1) D
"RTN","FBUTL4A",63,0)
 . W !!,"Current list of Remittance Remarks (CARCless RARCs): "
"RTN","FBUTL4A",64,0)
 . I '$O(FBRRMK(999,0)) W "none"
"RTN","FBUTL4A",65,0)
 . S FBI=0 F  S FBI=$O(FBRRMK(999,FBI)) Q:'FBI  D
"RTN","FBUTL4A",66,0)
 . . W:$P(FBRRMK(999,FBI),U)]"" $P($G(^FB(161.93,$P(FBRRMK(999,FBI),U),0)),U),", "
"RTN","FBUTL4A",67,0)
 . W !
"RTN","FBUTL4A",68,0)
 ;
"RTN","FBUTL4A",69,0)
 ; prompt for remark
"RTN","FBUTL4A",70,0)
 ;   if max is 1 and reason already on list then automatically select it
"RTN","FBUTL4A",71,0)
 I FBMAX=1,FBCNT=1 D
"RTN","FBUTL4A",72,0)
 . N FBI,FBRRMKC
"RTN","FBUTL4A",73,0)
 . S FBI=$O(FBRRMK(999,0))
"RTN","FBUTL4A",74,0)
 . S:FBI FBRRMKC=$P(FBRRMK(999,FBI),U)
"RTN","FBUTL4A",75,0)
 . I FBRRMKC S Y=FBRRMKC_U_$P($G(^FB(161.93,FBRRMKC,0)),U)
"RTN","FBUTL4A",76,0)
 E  D  I $D(DTOUT)!$D(DUOUT) S FBRET=0 G EXIT  ; prompt user
"RTN","FBUTL4A",77,0)
 . S DIR(0)="PO^161.93:EMZ"
"RTN","FBUTL4A",78,0)
 . S DIR("A")="Select additional REMITTANCE REMARK"
"RTN","FBUTL4A",79,0)
 . S DIR("S")="I $P($$RR^FBUTL1(Y,,FBDT),U,4)=1"
"RTN","FBUTL4A",80,0)
 . S DIR("?")="Select a HIPAA Remittance Remark Code."
"RTN","FBUTL4A",81,0)
 . S DIR("?",1)="Select a remittance remark code to provide non-financial"
"RTN","FBUTL4A",82,0)
 . S DIR("?",2)="information critical to understanding the adjudication of the claim."
"RTN","FBUTL4A",83,0)
 . D ^DIR K DIR
"RTN","FBUTL4A",84,0)
 ;
"RTN","FBUTL4A",85,0)
 ; if value was entered then process it and ask another if not max
"RTN","FBUTL4A",86,0)
 I +Y>0 D  G:FBRET=0 EXIT G ASKRR
"RTN","FBUTL4A",87,0)
 . S FBRRMKC=+Y
"RTN","FBUTL4A",88,0)
 . ; if specified remark already in list set FBEDIT = it's number
"RTN","FBUTL4A",89,0)
 . S (FBI,FBEDIT)=0 F  S FBI=$O(FBRRMK(999,FBI)) Q:'FBI  D  Q:FBEDIT
"RTN","FBUTL4A",90,0)
 . . I $P(FBRRMK(999,FBI),U)=FBRRMKC S FBEDIT=FBI
"RTN","FBUTL4A",91,0)
 . S FBNEW=$S(FBEDIT:0,1:1) ; flag as new if not on list
"RTN","FBUTL4A",92,0)
 . ; if in list then edit the existing remark
"RTN","FBUTL4A",93,0)
 . I FBEDIT D  Q:$D(DIRUT)  Q:FBRRMKC=""
"RTN","FBUTL4A",94,0)
 . . S DIR(0)="162.559,.01"
"RTN","FBUTL4A",95,0)
 . . S DIR("B")=$P($G(^FB(161.93,FBRRMKC,0)),U)
"RTN","FBUTL4A",96,0)
 . . D ^DIR K DIR I $D(DTOUT)!$D(DUOUT) S:FBMAX=1 FBRET=0 Q
"RTN","FBUTL4A",97,0)
 . . I X="@" D  Q  ; "@" removes from list
"RTN","FBUTL4A",98,0)
 . . . D DEL(FBEDIT)
"RTN","FBUTL4A",99,0)
 . . I +Y>0 S FBRRMKC=+Y
"RTN","FBUTL4A",100,0)
 . . ; ensure new value of edited remark is not already on list
"RTN","FBUTL4A",101,0)
 . . S FBI=0 F  S FBI=$O(FBRRMK(999,FBI)) Q:'FBI  D  Q:FBRRMKC=""
"RTN","FBUTL4A",102,0)
 . . . I $P(FBRRMK(999,FBI),U)=FBRRMKC,FBI'=FBEDIT S FBRRMKC="" W !,$C(7),"     Change was not accepted because the new value is already on the list."
"RTN","FBUTL4A",103,0)
 . . Q:FBRRMKC=""
"RTN","FBUTL4A",104,0)
 . . ; upate the existing reason
"RTN","FBUTL4A",105,0)
 . . S $P(FBRRMK(999,FBEDIT),U)=FBRRMKC
"RTN","FBUTL4A",106,0)
 . ;
"RTN","FBUTL4A",107,0)
 . ; if new reason then add to list
"RTN","FBUTL4A",108,0)
 . I 'FBEDIT D  Q:FBRRMKC=""
"RTN","FBUTL4A",109,0)
 . . I (FBCNT+1)>FBMAX D  Q
"RTN","FBUTL4A",110,0)
 . . . S FBRRMKC=""
"RTN","FBUTL4A",111,0)
 . . . W !!,$C(7),"ERROR: A new reason would exceed maximum number (",FBMAX,") allowed for this invoice."
"RTN","FBUTL4A",112,0)
 . . . W !,"  If necessary, a code on the current list can be selected and changed."
"RTN","FBUTL4A",113,0)
 . . S FBEDIT=$O(FBRRMK(999," "),-1)+1
"RTN","FBUTL4A",114,0)
 . . S $P(FBRRMK(999,FBEDIT),U)=FBRRMKC,FBCNT=FBCNT+1
"RTN","FBUTL4A",115,0)
 ;
"RTN","FBUTL4A",116,0)
 ; validate
"RTN","FBUTL4A",117,0)
 I FBCNT>FBMAX D  G ASKRR
"RTN","FBUTL4A",118,0)
 . W !!,$C(7),"ERROR: Maximum number of remittance remark codes (",FBMAX,") have been exceeded."
"RTN","FBUTL4A",119,0)
 ;
"RTN","FBUTL4A",120,0)
EXIT ;
"RTN","FBUTL4A",121,0)
 Q FBRET
"RTN","FBUTL4A",122,0)
 ;
"RTN","FBUTL4A",123,0)
DEL(FBI) ; delete remark from list
"RTN","FBUTL4A",124,0)
 S FBCNT=FBCNT-1
"RTN","FBUTL4A",125,0)
 K FBRRMK(999,FBI)
"RTN","FBUTL4A",126,0)
 S FBRRMKC=""
"RTN","FBUTL4A",127,0)
 W "   (deleted)"
"RTN","FBUTL4A",128,0)
 Q
"RTN","FBUTL4A",129,0)
 ;
"RTN","FBUTL4A",130,0)
TSTCR ;
"RTN","FBUTL4A",131,0)
 N FBADJ,FBRRMK
"RTN","FBUTL4A",132,0)
 ;CARCs
"RTN","FBUTL4A",133,0)
 S IENS="1,2,1096,7169710,"
"RTN","FBUTL4A",134,0)
 D LOADADJ^FBAAFA(IENS,.FBADJ)
"RTN","FBUTL4A",135,0)
 ;RARCs
"RTN","FBUTL4A",136,0)
 D LOADRR^FBAAFR(IENS,.FBRRMK)
"RTN","FBUTL4A",137,0)
 ;
"RTN","FBUTL4A",138,0)
 S RET=$$CLESSR(.FBADJ,5,.FBRRMK)
"RTN","FBUTL4A",139,0)
 Q
"RTN","FBUTL4A",140,0)
 ;
"RTN","FBUTL4A",141,0)
RRL(FBRRMK) ; build list of remittance remarks extrinsic function
"RTN","FBUTL4A",142,0)
 ; Input
"RTN","FBUTL4A",143,0)
 ;   FBRRMK- required, array passed by reference
"RTN","FBUTL4A",144,0)
 ;           array of remittance remarks
"RTN","FBUTL4A",145,0)
 ;            format
"RTN","FBUTL4A",146,0)
 ;              FBRRMK(#)=FBRRMKC
"RTN","FBUTL4A",147,0)
 ;            where
"RTN","FBUTL4A",148,0)
 ;              # = integer number greater than 0
"RTN","FBUTL4A",149,0)
 ;              FBRRMKC = remittance remark (internal value file 162.93)
"RTN","FBUTL4A",150,0)
 ; Result
"RTN","FBUTL4A",151,0)
 ;   string containing sorted list (by external code) of remarks
"RTN","FBUTL4A",152,0)
 ;   format
"RTN","FBUTL4A",153,0)
 ;      FBRRMKCE 1, FBRRMKCE 2
"RTN","FBUTL4A",154,0)
 ;   where
"RTN","FBUTL4A",155,0)
 ;      FBRRMKCE = remittance remark code (external value)
"RTN","FBUTL4A",156,0)
 N FBRET
"RTN","FBUTL4A",157,0)
 N FBRRMKC,FBRRMKCE
"RTN","FBUTL4A",158,0)
 N FBRRMKS,FBI
"RTN","FBUTL4A",159,0)
 S FBRET=""
"RTN","FBUTL4A",160,0)
 ;
"RTN","FBUTL4A",161,0)
 ; build sorted array containing external values
"RTN","FBUTL4A",162,0)
 S FBI=0 F  S FBI=$O(FBRRMK(FBI)) Q:'FBI  D
"RTN","FBUTL4A",163,0)
 . ; obtain internal values
"RTN","FBUTL4A",164,0)
 . S FBRRMKC=$P(FBRRMK(FBI),U)
"RTN","FBUTL4A",165,0)
 . ; convert to external values
"RTN","FBUTL4A",166,0)
 . S FBRRMKCE=$S(FBRRMKC:$P($G(^FB(161.93,FBRRMKC,0)),U),1:"")
"RTN","FBUTL4A",167,0)
 . ; store in sorted array
"RTN","FBUTL4A",168,0)
 . S FBRRMKS(FBRRMKCE_U_FBI)=FBRRMKCE_","
"RTN","FBUTL4A",169,0)
 ;
"RTN","FBUTL4A",170,0)
 ; build list from sorted array
"RTN","FBUTL4A",171,0)
 S FBI="" F  S FBI=$O(FBRRMKS(FBI)) Q:FBI=""  D
"RTN","FBUTL4A",172,0)
 . S FBRET=FBRET_FBRRMKS(FBI)
"RTN","FBUTL4A",173,0)
 ; strip trailing "," from list
"RTN","FBUTL4A",174,0)
 I $E(FBRET,$L(FBRET))="," S FBRET=$E(FBRET,1,$L(FBRET)-1)
"RTN","FBUTL4A",175,0)
 ;
"RTN","FBUTL4A",176,0)
 Q FBRET
"RTN","FBUTL4A",177,0)
 ;
"RTN","FBUTL4A",178,0)
 ;FBUTL4A
"RTN","FBX2P158")
0^36^B176094799^n/a
"RTN","FBX2P158",1,0)
FBX2P158 ;WCIOFO/SLT-PATCH INSTALL ROUTINE ;5/27/2006
"RTN","FBX2P158",2,0)
 ;;3.5;FEE BASIS;**158**;JAN 30, 1995;Build 94
"RTN","FBX2P158",3,0)
 Q
"RTN","FBX2P158",4,0)
 ;
"RTN","FBX2P158",5,0)
CSGR ; entry point for establishing CARC/RARC relationships
"RTN","FBX2P158",6,0)
 D MES^XPDUTL("  Establishing CARC/RARC Relationships...")
"RTN","FBX2P158",7,0)
 N STR,I,CARC,RARC,SCNR,CAGCLST,CAGC,PC,CAGCI,CNT,FDA,RARCI,TAG,J,RLN,RARCLST,CARCI
"RTN","FBX2P158",8,0)
 S I=1 F  S STR=$T(CSGRTBL+I) Q:$P(STR,";;",2)["THE END"  D
"RTN","FBX2P158",9,0)
 . S STR=$P(STR,";;",2)
"RTN","FBX2P158",10,0)
 . S CARC=$P(STR,";")
"RTN","FBX2P158",11,0)
 . I '$D(^FB(161.91,"B",CARC)) Q
"RTN","FBX2P158",12,0)
 . S CARCI=$O(^FB(161.91,"B",CARC,"")) Q:'CARCI
"RTN","FBX2P158",13,0)
 . S $P(^FB(161.91,CARCI,0),U,3)="" ;clear scenario
"RTN","FBX2P158",14,0)
 . D DCAGC(CARCI),DRARC(CARCI)  ;clear CAGC and RARC codes
"RTN","FBX2P158",15,0)
 . S SCNR=+$P(STR,";",2)
"RTN","FBX2P158",16,0)
 . S:SCNR $P(^FB(161.91,CARCI,0),U,3)=SCNR  ;set business scenario
"RTN","FBX2P158",17,0)
 . ;
"RTN","FBX2P158",18,0)
 . S CAGCLST=$P(STR,";",3)  ;get the CAGC list
"RTN","FBX2P158",19,0)
 . I CAGCLST]"" D  ; update CAGCs
"RTN","FBX2P158",20,0)
 . . S CNT=$L(CAGCLST,U)-1  ; number of CAGCs
"RTN","FBX2P158",21,0)
 . . F PC=1:1:CNT D
"RTN","FBX2P158",22,0)
 . . . S CAGC=$P(CAGCLST,U,PC) Q:CAGC']""
"RTN","FBX2P158",23,0)
 . . . I '$D(^FB(161.92,"B",CAGC)) Q
"RTN","FBX2P158",24,0)
 . . . S CAGCI=$O(^FB(161.92,"B",CAGC,"")) Q:'CAGCI
"RTN","FBX2P158",25,0)
 . . . S FDA(161.917,"+"_PC_","_CARCI_",",.01)=CAGCI
"RTN","FBX2P158",26,0)
 . . I $D(FDA) D UPDATE^DIE("","FDA") K FDA
"RTN","FBX2P158",27,0)
 . ;
"RTN","FBX2P158",28,0)
 . S RARCLST=$P(STR,";",4) ; get the RARC list
"RTN","FBX2P158",29,0)
 . I RARCLST]"",$E(RARCLST)'="*" D  ;update RARCs
"RTN","FBX2P158",30,0)
 . . S CNT=$L(RARCLST,U)-1
"RTN","FBX2P158",31,0)
 . . F PC=1:1:CNT D
"RTN","FBX2P158",32,0)
 . . . S RARC=$P(RARCLST,U,PC) Q:RARC']""
"RTN","FBX2P158",33,0)
 . . . I '$D(^FB(161.93,"B",RARC)) Q
"RTN","FBX2P158",34,0)
 . . . S RARCI=$O(^FB(161.93,"B",RARC,"")) Q:'RARCI
"RTN","FBX2P158",35,0)
 . . . S FDA(161.915,"+"_PC_","_CARCI_",",.01)=RARCI
"RTN","FBX2P158",36,0)
 . . I $D(FDA) D UPDATE^DIE("","FDA") K FDA
"RTN","FBX2P158",37,0)
 . E  I $E(RARCLST)="*" D
"RTN","FBX2P158",38,0)
 . . S TAG=$P(RARCLST,"*",2)
"RTN","FBX2P158",39,0)
 . . F J=1:1 S RLN=$T(@(TAG)+J) Q:$P(RLN,";;",2)["THE END"  D
"RTN","FBX2P158",40,0)
 . . . S RARCLST=$P(RLN,";;",2)
"RTN","FBX2P158",41,0)
 . . . I RARCLST]"" D
"RTN","FBX2P158",42,0)
 . . . . S CNT=$L(RARCLST,U)-1
"RTN","FBX2P158",43,0)
 . . . . F PC=1:1:CNT D
"RTN","FBX2P158",44,0)
 . . . . . S RARC=$P(RARCLST,U,PC) Q:RARC']""
"RTN","FBX2P158",45,0)
 . . . . . I '$D(^FB(161.93,"B",RARC)) Q
"RTN","FBX2P158",46,0)
 . . . . . S RARCI=$O(^FB(161.93,"B",RARC,"")) Q:'RARCI
"RTN","FBX2P158",47,0)
 . . . . . S FDA(161.915,"+"_PC_","_CARCI_",",.01)=RARCI
"RTN","FBX2P158",48,0)
 . . . . I $D(FDA) D UPDATE^DIE("","FDA") K FDA
"RTN","FBX2P158",49,0)
 . S I=$I(I)
"RTN","FBX2P158",50,0)
 D MES^XPDUTL("  done.")
"RTN","FBX2P158",51,0)
 Q
"RTN","FBX2P158",52,0)
 ;
"RTN","FBX2P158",53,0)
DCAGC(CI) ; delete existing CAGCs
"RTN","FBX2P158",54,0)
 ;
"RTN","FBX2P158",55,0)
 N IENS,SIENS,FDA,FB
"RTN","FBX2P158",56,0)
 S IENS=CI_","
"RTN","FBX2P158",57,0)
 D GETS^DIQ(161.91,IENS,"7*","","FB")
"RTN","FBX2P158",58,0)
 S SIENS="" F  S SIENS=$O(FB(161.917,SIENS)) Q:SIENS=""  D
"RTN","FBX2P158",59,0)
 . S FDA(161.917,SIENS,.01)="@"
"RTN","FBX2P158",60,0)
 I $D(FDA) D FILE^DIE("","FDA") K FDA
"RTN","FBX2P158",61,0)
 Q
"RTN","FBX2P158",62,0)
 ;
"RTN","FBX2P158",63,0)
DRARC(CI) ; delete existing RARCs
"RTN","FBX2P158",64,0)
 ;
"RTN","FBX2P158",65,0)
 N IENS,SIENS,FDA,FB
"RTN","FBX2P158",66,0)
 S IENS=CI_","
"RTN","FBX2P158",67,0)
 D GETS^DIQ(161.91,IENS,"5*","","FB")
"RTN","FBX2P158",68,0)
 S SIENS="" F  S SIENS=$O(FB(161.915,SIENS)) Q:SIENS=""  D
"RTN","FBX2P158",69,0)
 . S FDA(161.915,SIENS,.01)="@"
"RTN","FBX2P158",70,0)
 I $D(FDA) D FILE^DIE("","FDA") K FDA
"RTN","FBX2P158",71,0)
 Q
"RTN","FBX2P158",72,0)
 ;
"RTN","FBX2P158",73,0)
 ; CORE Version 3.3.0
"RTN","FBX2P158",74,0)
CSGRTBL ;;CARC;SCENARIO;GRP1^[GRP2^...GRPn^];RARC1^[RARC2^...RARCn^]^ or *C_CARC if long list.
"RTN","FBX2P158",75,0)
 ;;4;2;CO^PI^;N517^N519^M20^N657^M114^N56^N108^N386^N572^N644^
"RTN","FBX2P158",76,0)
 ;;5;3;CO^PI^PR^;MA109^M77^
"RTN","FBX2P158",77,0)
 ;;6;3;CO^PI^PR^;M37^M82^N129^N115^
"RTN","FBX2P158",78,0)
 ;;7;3;CO^PI^PR^;N115^
"RTN","FBX2P158",79,0)
 ;;8;3;CO^PI^PR^;MA130^N684^N95^
"RTN","FBX2P158",80,0)
 ;;9;3;CO^PI^PR^;N517^M89^N657^
"RTN","FBX2P158",81,0)
 ;;10;3;CO^PI^PR^;N517^N657^MA130^
"RTN","FBX2P158",82,0)
 ;;11;3;CO^PI^PR^;N657^MA130^N386^MA63^N115^
"RTN","FBX2P158",83,0)
 ;;12;3;CO^PI^PR^;N657^MA63^
"RTN","FBX2P158",84,0)
 ;;13;2;CO^PI^;
"RTN","FBX2P158",85,0)
 ;;14;2;CO^PI^;
"RTN","FBX2P158",86,0)
 ;;15;2;CO^PI^;N517^MA130^N596^M25^M62^N752^
"RTN","FBX2P158",87,0)
 ;;16;2;CO^PI^;*C16
"RTN","FBX2P158",88,0)
 ;;18;2;CO^OA^;N111^N347^N522^N702^
"RTN","FBX2P158",89,0)
 ;;19;3;CO^PI^PR^;N418^N722^N728^
"RTN","FBX2P158",90,0)
 ;;20;3;CO^PI^PR^;MA04^N723^N725^
"RTN","FBX2P158",91,0)
 ;;21;3;CO^PI^PR^;MA04^N728^N724^N727^
"RTN","FBX2P158",92,0)
 ;;22;3;CO^PI^PR^;N4^N479^MA04^MA92^N36^N245^MA64^N374^MA16^N197^N376^N598^N743^N744^
"RTN","FBX2P158",93,0)
 ;;24;4;CO^PI^PR^;M112^
"RTN","FBX2P158",94,0)
 ;;26;3;CO^PI^PR^;N30^N216^N622^N52^N128^N650^N652^
"RTN","FBX2P158",95,0)
 ;;27;3;CO^PI^PR^;N30^N622^N52^N650^MA47^N619^
"RTN","FBX2P158",96,0)
 ;;29;3;CO^PI^PR^;
"RTN","FBX2P158",97,0)
 ;;31;3;CO^PI^PR^;MA130^MA61^
"RTN","FBX2P158",98,0)
 ;;32;3;CO^PI^PR^;N129^N52^MA47^N15^
"RTN","FBX2P158",99,0)
 ;;33;3;PR^;N578^
"RTN","FBX2P158",100,0)
 ;;34;3;CO^PI^PR^;
"RTN","FBX2P158",101,0)
 ;;35;3;CO^PI^PR^;N117^N370^N587^
"RTN","FBX2P158",102,0)
 ;;39;3;CO^PI^PR^;
"RTN","FBX2P158",103,0)
 ;;40;3;CO^PI^PR^;N10^N409^
"RTN","FBX2P158",104,0)
 ;;49;3;CO^PI^PR^;N130^N129^N115^M90^N390^N427^N429^N567^
"RTN","FBX2P158",105,0)
 ;;50;3;CO^PI^PR^;M1^N45^M127^M31^M60^M135^N40^N178^N214^N455^N170^N206^M64^N227^N130^N10^M26^N163^N237^N238^N240^N242^N244^N456^N129^N386^M25^M76^M51^N229^N443^N115^M85^MA126^N124^N161^N180^N362^N372^N383^N607^N658^N661^N721^N734^
"RTN","FBX2P158",106,0)
 ;;51;3;CO^PI^PR^;N45^N10^N204^N607^N174^
"RTN","FBX2P158",107,0)
 ;;53;3;CO^PI^PR^;
"RTN","FBX2P158",108,0)
 ;;54;3;CO^PI^PR^;N10^N646^N450^
"RTN","FBX2P158",109,0)
 ;;55;3;CO^PI^PR^;M49^N111^N10^N115^N623^
"RTN","FBX2P158",110,0)
 ;;56;3;CO^PI^PR^;N115^N623^
"RTN","FBX2P158",111,0)
 ;;58;3;CO^PI^PR^;N386^N115^N87^N732^N760^
"RTN","FBX2P158",112,0)
 ;;59;3;CO^PI^PR^;N10^N644^N633^N670^
"RTN","FBX2P158",113,0)
 ;;60;3;CO^PI^PR^;N130^M114^N676^
"RTN","FBX2P158",114,0)
 ;;61;3;CO^PI^PR^;
"RTN","FBX2P158",115,0)
 ;;69;2;CO^PI^;
"RTN","FBX2P158",116,0)
 ;;78;3;CO^PI^PR^;
"RTN","FBX2P158",117,0)
 ;;89;3;CO^PI^PR^;N200^
"RTN","FBX2P158",118,0)
 ;;95;3;CO^PI^PR^;N594^N595^N596^N182^N33^N385^N584^N593^N630^
"RTN","FBX2P158",119,0)
 ;;96;3;CO^PI^PR^;*C96
"RTN","FBX2P158",120,0)
 ;;97;4;CO^PI^PR^;M2^M15^M80^M144^MA109^N19^N130^N111^N122^N115^M86^N390^M112^M97^M109^N20^N67^N357^N472^N525^N626^N628^N637^N646^N666^
"RTN","FBX2P158",121,0)
 ;;107;2;CO^PI^;M121^MA66^N122^N173^N674^
"RTN","FBX2P158",122,0)
 ;;108;3;CO^PI^PR^;N223^M7^N130^N10^N370^N518^N372^N171^M10^M36^M94^
"RTN","FBX2P158",123,0)
 ;;109;3;CO^PI^PR^;N36^N130^N216^M114^N418^N106^N538^N104^N448^N576^M11^N105^N127^N557^N558^N559^N747^N751^
"RTN","FBX2P158",124,0)
 ;;110;2;CO^PI^;M52^M59^N622^
"RTN","FBX2P158",125,0)
 ;;111;3;CO^PI^PR^;
"RTN","FBX2P158",126,0)
 ;;114;3;CO^PI^PR^;N623^M61^M102^
"RTN","FBX2P158",127,0)
 ;;115;3;CO^PI^PR^;
"RTN","FBX2P158",128,0)
 ;;116;1;CO^PI^;
"RTN","FBX2P158",129,0)
 ;;117;3;CO^PI^PR^;N115^
"RTN","FBX2P158",130,0)
 ;;119;3;CO^PI^PR^;N45^M80^M7^N130^N111^M89^N386^N115^N117^N587^M86^M90^N357^N362^M83^M139^N435^N636^N640^
"RTN","FBX2P158",131,0)
 ;;125;M7^N517^MA30^N519^
"RTN","FBX2P158",132,0)
 ;;128;3;CO^PI^PR^;
"RTN","FBX2P158",133,0)
 ;;129;2;CO^PI^;MA36^N48^MA130^
"RTN","FBX2P158",134,0)
 ;;138;3;CO^PI^PR^;N584^
"RTN","FBX2P158",135,0)
 ;;139;3;
"RTN","FBX2P158",136,0)
 ;;140;2;CO^PI^;MA36^MA130^MA27^MA61^
"RTN","FBX2P158",137,0)
 ;;146;2;CO^PI^;M64^N517^N657^M76^MA63^MA65^
"RTN","FBX2P158",138,0)
 ;;149;3;CO^PI^PR^;N386^N117^N587^
"RTN","FBX2P158",139,0)
 ;;150;3;CO^PI^PR^;N10^M26^N163^M25^N115^N124^N125^N640^
"RTN","FBX2P158",140,0)
 ;;151;3;CO^PI^PR^;M3^N206^N130^N10^N386^M25^N115^M86^N362^N435^M69^
"RTN","FBX2P158",141,0)
 ;;152;3;CO^PI^PR^;M26^N115^N640^
"RTN","FBX2P158",142,0)
 ;;153;3;CO^PI^PR^;
"RTN","FBX2P158",143,0)
 ;;154;3;CO^PI^PR^;
"RTN","FBX2P158",144,0)
 ;;155;3;CO^PI^PR^;
"RTN","FBX2P158",145,0)
 ;;157;3;CO^PI^PR^;
"RTN","FBX2P158",146,0)
 ;;158;3;PR^;N176^
"RTN","FBX2P158",147,0)
 ;;159;3;CO^PI^PR^;
"RTN","FBX2P158",148,0)
 ;;160;3;CO^PI^PR^;N622^N607^N167^N356^N425^
"RTN","FBX2P158",149,0)
 ;;163;1;CO^PI^;*C163
"RTN","FBX2P158",150,0)
 ;;164;1;CO^PI^;N42^N764^
"RTN","FBX2P158",151,0)
 ;;165;3;CO^PI^PR^;N45^N475^N489^N490^N285^N630^
"RTN","FBX2P158",152,0)
 ;;166;3;CO^PI^PR^;
"RTN","FBX2P158",153,0)
 ;;167;3;CO^PI^PR^;N386^MA63^N647^N115^N30^N607^N428^
"RTN","FBX2P158",154,0)
 ;;168;3;CO^PI^PR^;N30^N174^
"RTN","FBX2P158",155,0)
 ;;169;3;CO^PI^PR^;MA109^N10^
"RTN","FBX2P158",156,0)
 ;;170;3;CO^PI^PR^;M143^M114^N95^N732^N90^N348^N665^
"RTN","FBX2P158",157,0)
 ;;171;3;CO^PI^PR^;M97^N732^N92^N110^N121^N428^N762^
"RTN","FBX2P158",158,0)
 ;;172;3;CO^PI^PR^;M13^
"RTN","FBX2P158",159,0)
 ;;173;3;CO^PI^PR^;N667^N130^N668^N574^
"RTN","FBX2P158",160,0)
 ;;174;3;CO^PI^PR^;N667^N668^N115^
"RTN","FBX2P158",161,0)
 ;;175;2;CO^PI^;N668^N319^N378^N388^N592^
"RTN","FBX2P158",162,0)
 ;;176;3;CO^PI^PR^;N592^
"RTN","FBX2P158",163,0)
 ;;177;3;CO^PI^PR^;N375^N10^
"RTN","FBX2P158",164,0)
 ;;178;3;CO^PI^PR^;
"RTN","FBX2P158",165,0)
 ;;179;3;CO^PI^PR^;
"RTN","FBX2P158",166,0)
 ;;180;3;CO^PI^PR^;
"RTN","FBX2P158",167,0)
 ;;181;2;CO^PI^;N517^M20^N56^
"RTN","FBX2P158",168,0)
 ;;182;2;CO^PI^;N517^N657^
"RTN","FBX2P158",169,0)
 ;;183;3;CO^PI^PR^;N630^N574^N767^
"RTN","FBX2P158",170,0)
 ;;184;3;CO^PI^PR^;N386^M115^N574^N767^
"RTN","FBX2P158",171,0)
 ;;185;3;CO^PI^PR^;N570^N386^N684^N95^N450^N767^
"RTN","FBX2P158",172,0)
 ;;188;3;CO^PI^PR^;N386^M61^M102^
"RTN","FBX2P158",173,0)
 ;;189;2;CO^PI^;N657^M81^
"RTN","FBX2P158",174,0)
 ;;190;4;CO^PI^PR^;N106^N107^N538^
"RTN","FBX2P158",175,0)
 ;;194;3;CO^PI^PR^;M80^
"RTN","FBX2P158",176,0)
 ;;197;3;CO^PI^PR^;N83^
"RTN","FBX2P158",177,0)
 ;;198;3;CO^PI^PR^;N54^N10^M62^N351^N435^N758^
"RTN","FBX2P158",178,0)
 ;;199;2;CO^PI^;N657^
"RTN","FBX2P158",179,0)
 ;;200;3;CO^PI^PR^;N650^N619^
"RTN","FBX2P158",180,0)
 ;;201;3;PR^;N722^N723^N724^
"RTN","FBX2P158",181,0)
 ;;202;3;CO^PI^PR^;N658^
"RTN","FBX2P158",182,0)
 ;;204;3;CO^PI^PR^;N157^N130^N10^N129^N386^N429^N567^N357^N666^N383^N658^N12^N158^N171^N426^N428^N441^N448^N569^N651^N751^
"RTN","FBX2P158",183,0)
 ;;206;2;CO^PI^;N257^N286^N31^N77^N253^N262^N265^
"RTN","FBX2P158",184,0)
 ;;207;2;CO^PI^;N257^N286^N31^N77^N253^N262^N265^
"RTN","FBX2P158",185,0)
 ;;208;2;CO^PI^;N257^N286^N31^N77^N253^N262^N265^N516^N562^
"RTN","FBX2P158",186,0)
 ;;210;3;CO^PI^PR^;
"RTN","FBX2P158",187,0)
 ;;212;3;OA^PI^PR^;N658^
"RTN","FBX2P158",188,0)
 ;;213;3;
"RTN","FBX2P158",189,0)
 ;;222;3;CO^PI^PR^;N115^N587^N633^N640^
"RTN","FBX2P158",190,0)
 ;;224;3;CO^;
"RTN","FBX2P158",191,0)
 ;;228;3;CO^PI^PR^;N555^N556^
"RTN","FBX2P158",192,0)
 ;;231;3;CO^PI^PR^;N628^
"RTN","FBX2P158",193,0)
 ;;233;3;CO^PI^PR^;
"RTN","FBX2P158",194,0)
 ;;234;4;CO^PI^PR^;M2^M14^M15^M80^N122^N390^N20^N67^N525^N626^N628^N83^N518^N676^
"RTN","FBX2P158",195,0)
 ;;236;2;CO^PI^;N657^N644^
"RTN","FBX2P158",196,0)
 ;;238;3;PR^;
"RTN","FBX2P158",197,0)
 ;;239;3;CO^PI^PR^;
"RTN","FBX2P158",198,0)
 ;;240;2;CO^PI^;N657^M76^MA63^N207^
"RTN","FBX2P158",199,0)
 ;;242;3;CO^PI^PR^;N130^N95^N450^M115^N767^
"RTN","FBX2P158",200,0)
 ;;243;3;CO^PI^PR^;N130^N95^N450^N630^M115^N767^
"RTN","FBX2P158",201,0)
 ;;246;3;CO^PI^PR^;N572^
"RTN","FBX2P158",202,0)
 ;;249;3;CO^;N561^
"RTN","FBX2P158",203,0)
 ;;250;1;CO^PI^;*C250
"RTN","FBX2P158",204,0)
 ;;251;1;CO^PI^;*C251
"RTN","FBX2P158",205,0)
 ;;252;1;CO^PI^;*C252
"RTN","FBX2P158",206,0)
 ;;254;3;CO^PI^PR^;N130^
"RTN","FBX2P158",207,0)
 ;;256;3;CO^PI^PR^;M14^N130^M37^M82^M89^M81^N95^MA16^N52^N117^M90^M97^N734^N623^M61^M139^N103^N118^N428^N448^M96^N246^
"RTN","FBX2P158",208,0)
 ;;258;3;OA^PI^PR^;N30^N103^
"RTN","FBX2P158",209,0)
 ;;261;3;CO^PI^PR^;
"RTN","FBX2P158",210,0)
 ;;267;2;CO^PI^;N61^N62^N63^N74^
"RTN","FBX2P158",211,0)
 ;;268;2;CO^PI^;
"RTN","FBX2P158",212,0)
 ;;269;3;CO^PI^PR^;N54^N130^N10^M37^M82^M89^N129^M25^N30^N124^M83^N96^
"RTN","FBX2P158",213,0)
 ;;270;3;CO^PI^PR^;N130^N658^
"RTN","FBX2P158",214,0)
 ;;272;3;CO^PI^PR^;N10^N386^N115^N20^N357^N584^N593^N507^N564^M40^N151^
"RTN","FBX2P158",215,0)
 ;;273;3;CO^PI^PR^;M13^N10^N386^N115^N362^N435^
"RTN","FBX2P158",216,0)
 ;;274;3;CO^PI^PR^;
"RTN","FBX2P158",217,0)
 ;;276;3;CO^PI^PR^;N536^
"RTN","FBX2P158",218,0)
 ;;A6;3;CO^PI^PR^;
"RTN","FBX2P158",219,0)
 ;;A8;2;CO^PI^;N657^N647^
"RTN","FBX2P158",220,0)
 ;;B1;3;CO^PI^PR^;N30^N628^N734^N113^
"RTN","FBX2P158",221,0)
 ;;B10;4;CO^PI^PR^;M144^
"RTN","FBX2P158",222,0)
 ;;B11;3;CO^OA^PI^PR^;N216^N418^N743^N744^N751^
"RTN","FBX2P158",223,0)
 ;;B12;3;CO^PI^;N199^
"RTN","FBX2P158",224,0)
 ;;B13;3;CO^PI^PR^;N10^N347^M86^M97^N472^
"RTN","FBX2P158",225,0)
 ;;B14;3;CO^PI^PR^;M26^M25^M86^N628^N637^N666^N2^
"RTN","FBX2P158",226,0)
 ;;B15;3;CO^PI^PR^;M80^M114^N386^M25^N122^N674^M51^N115^N20^N748^
"RTN","FBX2P158",227,0)
 ;;B16;3;CO^PI^PR^;M13^N113^
"RTN","FBX2P158",228,0)
 ;;B20;3;CO^PI^PR^;N10^N347^M86^N472^N538^N120^
"RTN","FBX2P158",229,0)
 ;;B23;3;CO^PI^PR^;
"RTN","FBX2P158",230,0)
 ;;B7;3;CO^PI^PR^;N570^M143^MA120^N115^N95^MA47^N450^N732^MA56^N425^N665^N612^
"RTN","FBX2P158",231,0)
 ;;B8;3;CO^PI^PR^;
"RTN","FBX2P158",232,0)
 ;;B9;3;CO^PI^PR^;M25^N90^
"RTN","FBX2P158",233,0)
 ;;P14;4;CO^PI^PR^;M2^M15^M80^M144^N19^N111^N702^M86^N390^M97^N20^N67^N525^M75^
"RTN","FBX2P158",234,0)
 ;;P16;3;CO^OA^;
"RTN","FBX2P158",235,0)
 ;;P17;3;CO^PI^PR^;
"RTN","FBX2P158",236,0)
 ;;P19;4;CO^PI^PR^;
"RTN","FBX2P158",237,0)
 ;;P2;3;CO^PI^PR^;
"RTN","FBX2P158",238,0)
 ;;P20;3;CO^PI^PR^;N104^
"RTN","FBX2P158",239,0)
 ;;P21;3;CO^PI^PR^;M80^N479^MA04^N590^N667^N36^N10^N657^N668^N594^N595^N596^N622^N653^N95^N598^N650^N652^N578^N587^N409^N666^N607^N658^N661^N584^N593^N158^N576^N588^N589^N621^N651^N665^N577^N579^N580^N582^N583^N585^N586^N611^
"RTN","FBX2P158",240,0)
 ;;P3;3;PR^;
"RTN","FBX2P158",241,0)
 ;;P4;3;CO^PI^PR^;N612^
"RTN","FBX2P158",242,0)
 ;;P7;2;CO^PI^;M51^M119^
"RTN","FBX2P158",243,0)
 ;;THE END
"RTN","FBX2P158",244,0)
 Q
"RTN","FBX2P158",245,0)
 ;
"RTN","FBX2P158",246,0)
C16 ;;CARC 16, RARC list too long for single line
"RTN","FBX2P158",247,0)
 ;;M24^N54^N184^N188^M60^N4^N439^N479^N685^N764^M124^MA04^MA92^N80^M64^N257^N286^
"RTN","FBX2P158",248,0)
 ;;MA75^MA81^MA88^MA111^MA30^N519^MA36^N48^M20^M49^N243^N245^N331^N440^N657^N480^
"RTN","FBX2P158",249,0)
 ;;M21^M125^MA27^MA64^MA76^N50^N350^N595^N596^N56^N572^M62^N752^MA66^N173^M52^M59^
"RTN","FBX2P158",250,0)
 ;;MA61^M76^MA63^MA65^N319^N378^N388^M81^N31^N77^N253^N262^N265^N562^N207^N61^N62^
"RTN","FBX2P158",251,0)
 ;;N63^M51^M119^M12^M22^M44^M45^M46^M47^M50^M53^M54^M56^M65^M67^N389^M73^M77^M79^M84^
"RTN","FBX2P158",252,0)
 ;;M91^M99^M122^M123^M126^M129^M133^M136^MA21^MA31^MA32^MA33^MA34^MA35^MA37^MA39^MA40^
"RTN","FBX2P158",253,0)
 ;;MA41^MA42^MA43^MA48^MA50^MA53^MA58^MA60^MA69^MA70^MA71^MA83^MA89^MA90^MA94^MA96^MA97^
"RTN","FBX2P158",254,0)
 ;;MA99^MA100^MA110^MA112^MA113^MA114^MA115^MA116^MA120^MA121^MA122^MA128^MA134^N8^N27^
"RTN","FBX2P158",255,0)
 ;;N32^N34^N37^N39^N46^N53^N57^N58^N64^N65^N75^N76^N94^N142^N147^N148^N150^N152^N153^N182^
"RTN","FBX2P158",256,0)
 ;;N190^N203^N208^N209^N213^N229^N230^N247^N248^N249^N250^N251^N252^N254^N256^N258^N259^N260^
"RTN","FBX2P158",257,0)
 ;;N261^N263^N264^N266^N267^N268^N269^N270^N271^N272^N273^N274^N275^N276^N277^N278^N279^N280^
"RTN","FBX2P158",258,0)
 ;;N281^N282^N283^N284^N285^N287^N288^N289^N290^N291^N292^N293^N294^N295^N296^N297^N298^N299^
"RTN","FBX2P158",259,0)
 ;;N300^N301^N302^N303^N304^N305^N306^N307^N308^N309^N310^N312^N313^N314^N315^N316^N317^N320^
"RTN","FBX2P158",260,0)
 ;;N321^N322^N323^N324^N325^N326^N327^N328^N329^N330^N332^N333^N334^N335^N336^N337^N338^N339^
"RTN","FBX2P158",261,0)
 ;;N340^N341^N342^N344^N345^N346^N349^N359^N374^N382^N407^N430^N433^N434^N443^N471^N521^N547^
"RTN","FBX2P158",262,0)
 ;;N554^N575^N625^N653^N753^N754^N755^N756^N763^N769^
"RTN","FBX2P158",263,0)
 ;;THE END
"RTN","FBX2P158",264,0)
 Q
"RTN","FBX2P158",265,0)
 ;
"RTN","FBX2P158",266,0)
C96 ;;CARC 96, RARC list too long for single line
"RTN","FBX2P158",267,0)
 ;;M1^M2^M3^M8^M13^M41^M80^MA109^N43^N54^N157^N188^N590^N130^N216^MA67^N10^M26^N163^M37^M82^M89^N129^
"RTN","FBX2P158",268,0)
 ;;M114^N56^N386^M25^M121^N622^N592^N61^N647^MA96^N32^N653^N115^N95^N722^N376^N52^N30^N652^MA47^N15^
"RTN","FBX2P158",269,0)
 ;;N578^N117^N370^N587^N409^M86^M90^N427^N429^N567^M97^N20^N357^N525^N626^N628^N637^N666^N538^N83^
"RTN","FBX2P158",270,0)
 ;;N676^MA126^N124^N161^N180^N362^N372^N383^N607^N658^N721^N734^N174^N450^N623^N87^N732^N633^N33^
"RTN","FBX2P158",271,0)
 ;;N584^N593^N630^M18^M28^M55^M61^M83^M87^M100^M111^M115^M116^M117^M134^M138^M139^MA20^MA24^MA25^
"RTN","FBX2P158",272,0)
 ;;MA54^MA55^MA56^MA57^MA73^MA84^MA123^MA131^N6^N12^N35^N55^N68^N81^N86^N90^N92^N96^N103^N104^N110^
"RTN","FBX2P158",273,0)
 ;;N113^N118^N120^N121^N125^N126^N141^N143^N158^N159^N167^N171^N176^N194^N198^N348^N351^N356^N405^
"RTN","FBX2P158",274,0)
 ;;N406^N408^N410^N424^N425^N426^N428^N431^N435^N441^N448^N507^N528^N529^N564^N569^N576^N588^N589^
"RTN","FBX2P158",275,0)
 ;;N621^N624^N636^N640^N643^N651^N665^N726^N765^N766^
"RTN","FBX2P158",276,0)
 ;;THE END
"RTN","FBX2P158",277,0)
 Q
"RTN","FBX2P158",278,0)
 ;
"RTN","FBX2P158",279,0)
C163 ;;
"RTN","FBX2P158",280,0)
 ;;M4^M19^M127^M141^M23^M29^M30^M31^M60^M130^M135^N4^N3^N26^N40^N42^N146^N178^N186^N214^N221^N223^
"RTN","FBX2P158",281,0)
 ;;N375^N391^N393^N395^N398^N403^N439^N445^N451^N453^N455^N457^N459^N461^N465^N467^N473^N475^N477^
"RTN","FBX2P158",282,0)
 ;;N479^N481^N485^N487^N489^N493^N495^N497^N499^N501^N503^N555^N678^N680^N681^N682^N683^N685^N686^
"RTN","FBX2P158",283,0)
 ;;N706^N708^N710^N712^N714^N716^N718^N729^N737^N739^N745^N749^N764^
"RTN","FBX2P158",284,0)
 ;;THE END
"RTN","FBX2P158",285,0)
 Q
"RTN","FBX2P158",286,0)
 ;
"RTN","FBX2P158",287,0)
C250 ;;
"RTN","FBX2P158",288,0)
 ;;M19^M127^M141^M23^M29^M30^M31^M60^M130^M135^N4^N3^N26^N40^N42^N146^N178^N186^N214^N221^N223^N375^
"RTN","FBX2P158",289,0)
 ;;N391^N393^N395^N398^N403^N439^N445^N451^N453^N455^N457^N459^N461^N465^N467^N473^N475^N477^N479^
"RTN","FBX2P158",290,0)
 ;;N481^N485^N487^N489^N493^N495^N497^N499^N501^N503^N555^N678^N680^N681^N682^N683^N686^N706^N708^
"RTN","FBX2P158",291,0)
 ;;N710^N712^N714^N716^N718^N729^N737^N739^N745^N749^M124^M131^M132^M142^MA04^MA92^N80^N170^N175^
"RTN","FBX2P158",292,0)
 ;;N206^N401^N463^N491^N542^N590^N667^
"RTN","FBX2P158",293,0)
 ;;THE END
"RTN","FBX2P158",294,0)
 Q
"RTN","FBX2P158",295,0)
 ;
"RTN","FBX2P158",296,0)
C251 ;;
"RTN","FBX2P158",297,0)
 ;;M135^N4^N214^N375^N680^N681^N682^N683^N686^N764^MA04^N80^N170^N491^N286^MA75^MA81^MA88^MA111^N78^
"RTN","FBX2P158",298,0)
 ;;N205^N222^N224^N226^N227^N228^N231^N232^N233^N234^N235^N236^M42^N28^N237^N238^N239^N240^N241^N242^
"RTN","FBX2P158",299,0)
 ;;N243^N244^N245^N331^N354^N392^N394^N396^N399^N402^N404^N440^N446^N452^N454^N456^N458^N460^N462^
"RTN","FBX2P158",300,0)
 ;;N466^N468^N474^N476^N478^N480^N482^N486^N488^N490^N494^N496^N498^N500^N502^N504^N543^N556^N570^
"RTN","FBX2P158",301,0)
 ;;N668^N679^N705^N707^N709^N711^N713^N715^N717^N730^N731^N736^N738^N746^N750^N768^
"RTN","FBX2P158",302,0)
 ;;THE END
"RTN","FBX2P158",303,0)
 Q
"RTN","FBX2P158",304,0)
 ;
"RTN","FBX2P158",305,0)
C252 ;;
"RTN","FBX2P158",306,0)
 ;;M1^M19^M127^M141^M23^M29^M30^M31^M60^M130^M135^N4^N3^N26^N40^N42^N146^N178^N186^N214^N221^N223^
"RTN","FBX2P158",307,0)
 ;;N375^N391^N393^N395^N398^N403^N439^N445^N451^N453^N455^N457^N459^N461^N465^N467^N473^N475^N477^
"RTN","FBX2P158",308,0)
 ;;N479^N481^N485^N487^N489^N493^N495^N497^N499^N501^N503^N555^N678^N680^N681^N682^N683^N685^N686^
"RTN","FBX2P158",309,0)
 ;;N706^N708^N710^N712^N714^N716^N718^N729^N737^N739^N745^N749^N764^M131^M132^M142^MA04^MA92^N80^
"RTN","FBX2P158",310,0)
 ;;N170^N175^N401^N491^N542^N590^N667^MA75^MA81^MA88^MA111^M42^N28^N241^N331^N668^N707^M21^M125^M143^
"RTN","FBX2P158",311,0)
 ;;MA27^MA64^MA76^N50^N191^N204^N350^N594^N595^N596^
"RTN","FBX2P158",312,0)
 ;;THE END
"RTN","FBX2P158",313,0)
 Q
"RTN","FBXIP158")
0^^B8013846^n/a
"RTN","FBXIP158",1,0)
FBXIP158 ;WCIOFO/SLT-PATCH INSTALL ROUTINE ;5/27/2006
"RTN","FBXIP158",2,0)
 ;;3.5;FEE BASIS;**158**;JAN 30, 1995;Build 94
"RTN","FBXIP158",3,0)
 Q
"RTN","FBXIP158",4,0)
 ;
"RTN","FBXIP158",5,0)
EN ; post-install entry point
"RTN","FBXIP158",6,0)
 D MES^XPDUTL("Post-install start...")
"RTN","FBXIP158",7,0)
 D ITC,ROPT,UPDSITE,ADJRSN
"RTN","FBXIP158",8,0)
 D CSGR^FBX2P158
"RTN","FBXIP158",9,0)
 D MES^XPDUTL("Post-install complete.")
"RTN","FBXIP158",10,0)
 Q
"RTN","FBXIP158",11,0)
 ;
"RTN","FBXIP158",12,0)
ITC ;Recompile Input Templates
"RTN","FBXIP158",13,0)
 N FBC,DMAX,FBMAX,FBN
"RTN","FBXIP158",14,0)
 S FBMAX=$$ROUSIZE^DILF
"RTN","FBXIP158",15,0)
 D MES^XPDUTL("  Recompiling affected input templates ...")
"RTN","FBXIP158",16,0)
 F FBC=1:1 S FBN=$P($T(TMPL+FBC),";;",2) Q:FBN=""  D COMP(FBN,FBMAX)
"RTN","FBXIP158",17,0)
 D MES^XPDUTL("  done.")
"RTN","FBXIP158",18,0)
 Q
"RTN","FBXIP158",19,0)
 ;
"RTN","FBXIP158",20,0)
COMP(TNAME,DMAX) ; Compile the Input Template
"RTN","FBXIP158",21,0)
 N FBIEN,FBRTN,X,Y
"RTN","FBXIP158",22,0)
 ;find the ien of the input template
"RTN","FBXIP158",23,0)
 S FBIEN=$O(^DIE("B",TNAME,0)) Q:'FBIEN
"RTN","FBXIP158",24,0)
 ;quit if input template not compiled
"RTN","FBXIP158",25,0)
 S FBRTN=$P($G(^DIE(FBIEN,"ROUOLD")),U) Q:FBRTN=""
"RTN","FBXIP158",26,0)
 D MES^XPDUTL("    Compiling "_TNAME_" , compiled routine is "_FBRTN_" ...")
"RTN","FBXIP158",27,0)
 S X=FBRTN,Y=FBIEN
"RTN","FBXIP158",28,0)
 D EN^DIEZ
"RTN","FBXIP158",29,0)
 D MES^XPDUTL("    done.")
"RTN","FBXIP158",30,0)
 D MES^XPDUTL("")
"RTN","FBXIP158",31,0)
 Q
"RTN","FBXIP158",32,0)
 ;
"RTN","FBXIP158",33,0)
ROPT ; remove option from parent option
"RTN","FBXIP158",34,0)
 N POIEN,COIEN,DA,DIK
"RTN","FBXIP158",35,0)
 D MES^XPDUTL("  Removing Option FB FPPS TRANSMIT from FB FPPS UPDATE MENU...")
"RTN","FBXIP158",36,0)
 Q:'$D(^DIC(19,"B","FB FPPS UPDATE MENU"))
"RTN","FBXIP158",37,0)
 S (POIEN,COIEN,DA)=0
"RTN","FBXIP158",38,0)
 S POIEN=$O(^DIC(19,"B","FB FPPS UPDATE MENU",""))
"RTN","FBXIP158",39,0)
 I POIEN S COIEN=$O(^DIC(19,"B","FB FPPS TRANSMIT",""))
"RTN","FBXIP158",40,0)
 I COIEN D
"RTN","FBXIP158",41,0)
 . S DA=$O(^DIC(19,POIEN,10,"B",COIEN,"")) Q:'DA
"RTN","FBXIP158",42,0)
 . S DA(1)=POIEN,DIK="^DIC(19,"_DA(1)_",10,"
"RTN","FBXIP158",43,0)
 . D ^DIK
"RTN","FBXIP158",44,0)
 D MES^XPDUTL("  done.")
"RTN","FBXIP158",45,0)
 Q
"RTN","FBXIP158",46,0)
 ;
"RTN","FBXIP158",47,0)
UPDSITE ; update FEE BASIS SITE PARAMETERS file, MAX #* fields
"RTN","FBXIP158",48,0)
 N SIEN
"RTN","FBXIP158",49,0)
 D MES^XPDUTL("  Updating FEE BASIS SITE PARAMETERS file, MAX #* fields...")
"RTN","FBXIP158",50,0)
 I '$D(^FBAA(161.4,0)) D MES^XPDUTL("   Site Parameters file undefined. Unable to continue.") Q
"RTN","FBXIP158",51,0)
 S SIEN=$P(^FBAA(161.4,0),U,3)
"RTN","FBXIP158",52,0)
 I 'SIEN D MES^XPDUTL("   A single entry is required in Site Parameters. Unable to continue.") Q
"RTN","FBXIP158",53,0)
 I $D(^FBAA(161.4,SIEN)) D
"RTN","FBXIP158",54,0)
 . S $P(^FBAA(161.4,SIEN,"FBNUM"),U,3)=50  ;MAX # PAYMENT LINE ITEMS (#17)
"RTN","FBXIP158",55,0)
 . S $P(^FBAA(161.4,SIEN,"FBNUM"),U,4)=30  ;MAX # CH PAYMENT LINES (#17.1)
"RTN","FBXIP158",56,0)
 . S $P(^FBAA(161.4,SIEN,"FBNUM"),U,5)=30  ;MAX # CNH PAYMENT LINES (#17.2)
"RTN","FBXIP158",57,0)
 D MES^XPDUTL("  done.")
"RTN","FBXIP158",58,0)
 Q
"RTN","FBXIP158",59,0)
 ;
"RTN","FBXIP158",60,0)
ADJRSN ; changed "B1 " to "B1" in the adjustment reason file #161.91
"RTN","FBXIP158",61,0)
 N DIC,DIE,DA,DR,X,Y,NUM,FBC
"RTN","FBXIP158",62,0)
 S X="B1 "
"RTN","FBXIP158",63,0)
 S DIC="^FB(161.91," D ^DIC S NUM=+Y
"RTN","FBXIP158",64,0)
 Q:NUM=-1
"RTN","FBXIP158",65,0)
 ; update entry
"RTN","FBXIP158",66,0)
 S DA=NUM
"RTN","FBXIP158",67,0)
 S FBC="B1"
"RTN","FBXIP158",68,0)
 S DR=".01////^S X=FBC"
"RTN","FBXIP158",69,0)
 S DIE="^FB(161.91,"
"RTN","FBXIP158",70,0)
 D ^DIE
"RTN","FBXIP158",71,0)
 Q
"RTN","FBXIP158",72,0)
 ;
"RTN","FBXIP158",73,0)
 ;
"RTN","FBXIP158",74,0)
TMPL ;;
"RTN","FBXIP158",75,0)
 ;;FBCH EDIT PAYMENT
"RTN","FBXIP158",76,0)
 ;;FBCH ENTER PAYMENT
"RTN","FBXIP158",77,0)
 ;;FBNH EDIT PAYMENT
"RTN","FBXIP158",78,0)
 ;;
"SEC","^DIC",163.98,163.98,0,"AUDIT")
@
"SEC","^DIC",163.98,163.98,0,"DD")
@
"SEC","^DIC",163.98,163.98,0,"DEL")
@
"SEC","^DIC",163.98,163.98,0,"LAYGO")
@
"SEC","^DIC",163.98,163.98,0,"RD")

"SEC","^DIC",163.98,163.98,0,"WR")
@
"UP",161.91,161.915,-1)
161.91^RARC
"UP",161.91,161.915,0)
161.915
"UP",161.91,161.917,-1)
161.91^3
"UP",161.91,161.917,0)
161.917
"UP",161.93,161.933,-1)
161.93^3
"UP",161.93,161.933,0)
161.933
"UP",162,162.03,-3)
162^1
"UP",162,162.03,-2)
162.01^1
"UP",162,162.03,-1)
162.02^1
"UP",162,162.03,0)
162.03
"UP",162,162.0384,-4)
162^1
"UP",162,162.0384,-3)
162.01^1
"UP",162,162.0384,-2)
162.02^1
"UP",162,162.0384,-1)
162.03^10
"UP",162,162.0384,0)
162.0384
"UP",162,162.07,-4)
162^1
"UP",162,162.07,-3)
162.01^1
"UP",162,162.07,-2)
162.02^1
"UP",162,162.07,-1)
162.03^7
"UP",162,162.07,0)
162.07
"UP",162,162.08,-4)
162^1
"UP",162,162.08,-3)
162.01^1
"UP",162,162.08,-2)
162.02^1
"UP",162,162.08,-1)
162.03^8
"UP",162,162.08,0)
162.08
"UP",162.1,162.11,-1)
162.1^RX
"UP",162.1,162.11,0)
162.11
"UP",162.1,162.14,-2)
162.1^RX
"UP",162.1,162.14,-1)
162.11^4
"UP",162.1,162.14,0)
162.14
"UP",162.1,162.15,-2)
162.1^RX
"UP",162.1,162.15,-1)
162.11^5
"UP",162.1,162.15,0)
162.15
"UP",162.5,162.558,-1)
162.5^8
"UP",162.5,162.558,0)
162.558
"UP",162.5,162.559,-1)
162.5^9
"UP",162.5,162.559,0)
162.559
"UP",162.5,162.591,-1)
162.5^10
"UP",162.5,162.591,0)
162.591
"VER")
8.0^22.2
"^DD",161.4,161.4,10,0)
NEXT BATCH NUMBER^RNJ5,0IX^^FBNUM;1^K:+X'=X!(X>9999999)!(X<1)!(X?.E1"."1N.N) X
"^DD",161.4,161.4,10,3)
TYPE A WHOLE NUMBER BETWEEN 1 AND 9999999
"^DD",161.4,161.4,10,21,0)
^^2^2^2880617^^^^
"^DD",161.4,161.4,10,21,1,0)
The next batch number which will be assigned by the system. This cannot
"^DD",161.4,161.4,10,21,2,0)
be edited or changed.
"^DD",161.4,161.4,10,"DT")
3150119
"^DD",161.7,161.7,.01,0)
NUMBER^RFIX^^0;1^K:X[""""!($A(X)=45) X I $D(X) K:$L(X)>7!($L(X)<1)!'(X'?1P.E)!(X'?.ANP) X I $D(X),'$$CHKBI^FBAAUTL4(X,1) K X
"^DD",161.7,161.7,.01,1,0)
^.1^^-1
"^DD",161.7,161.7,.01,1,1,0)
161.7^B
"^DD",161.7,161.7,.01,1,1,1)
S ^FBAA(161.7,"B",$E(X,1,30),DA)=""
"^DD",161.7,161.7,.01,1,1,2)
K ^FBAA(161.7,"B",$E(X,1,30),DA)
"^DD",161.7,161.7,.01,3)
ANSWER MUST BE 1-7 CHARACTERS IN LENGTH
"^DD",161.7,161.7,.01,21,0)
^.001^2^2^3150119^^
"^DD",161.7,161.7,.01,21,1,0)
The number identifying this batch. The batch number is automatically
"^DD",161.7,161.7,.01,21,2,0)
assigned to the batch when a clerk opens a batch. 
"^DD",161.7,161.7,.01,"DEL",.01,0)
S Z=$P(^FBAA(161.7,D0,0),U,3) I $S(Z="B3":$S($D(^FBAAC("AC",D0)):1,1:0),Z="B2":$S($D(^FBAAC("AD",D0)):1,1:0),Z="B5":$S($D(^FBAA(162.1,"AE",D0)):1,1:0),1:0) W !,*7,"Batch has activity, cannot be deleted!"
"^DD",161.7,161.7,.01,"DT")
3150119
"^DD",161.91,161.91,5,0)
REMITTANCE REMARK^161.915PA^^RARC;0
"^DD",161.91,161.91,5,21,0)
^.001^3^3^3160914^^^
"^DD",161.91,161.91,5,21,1,0)
This field contains the sub-set of remittance remarks allowed for this
"^DD",161.91,161.91,5,21,2,0)
adjustment reason. It should only be modified when updated adjustment
"^DD",161.91,161.91,5,21,3,0)
reason and remittance remark codes, and their relationships, are released.
"^DD",161.91,161.91,6,0)
CORE SCENARIO^S^1:Incorrect Documentation;2:Incorrect Claim Data;3:Billed Service Not Covered;4:Benefit for Service Not Payable;^0;3^Q
"^DD",161.91,161.91,6,3)
Enter the CAQH CORE Code Combinations Scenario Number.
"^DD",161.91,161.91,6,21,0)
^^2^2^3160329^
"^DD",161.91,161.91,6,21,1,0)
Used to indicate what business scenario, associated with Phase III CORE 
"^DD",161.91,161.91,6,21,2,0)
360 Rule, this adjustment reason code is associated with, if any.
"^DD",161.91,161.91,6,"DT")
3160613
"^DD",161.91,161.91,7,0)
ADJUSTMENT GROUP^161.917PA^^3;0
"^DD",161.91,161.91,7,21,0)
^.001^2^2^3160714^^
"^DD",161.91,161.91,7,21,1,0)
Some CARCs have GROUP restrictions. Specify the allowable GROUPS for this 
"^DD",161.91,161.91,7,21,2,0)
CARC here.
"^DD",161.91,161.915,0)
REMITTANCE REMARK SUB-FIELD^^.01^1
"^DD",161.91,161.915,0,"DT")
3150306
"^DD",161.91,161.915,0,"IX","B",161.915,.01)

"^DD",161.91,161.915,0,"NM","REMITTANCE REMARK")

"^DD",161.91,161.915,0,"UP")
161.91
"^DD",161.91,161.915,.01,0)
REMITTANCE REMARK^MP161.93'^FB(161.93,^0;1^Q
"^DD",161.91,161.915,.01,1,0)
^.1
"^DD",161.91,161.915,.01,1,1,0)
161.915^B
"^DD",161.91,161.915,.01,1,1,1)
S ^FB(161.91,DA(1),"RARC","B",$E(X,1,30),DA)=""
"^DD",161.91,161.915,.01,1,1,2)
K ^FB(161.91,DA(1),"RARC","B",$E(X,1,30),DA)
"^DD",161.91,161.915,.01,3)
Enter an existing Remittance Remark Code
"^DD",161.91,161.915,.01,21,0)
^.001^3^3^3160914^^
"^DD",161.91,161.915,.01,21,1,0)
This field holds the REMITTANCE REMARK associated with the ADJUSTMENT
"^DD",161.91,161.915,.01,21,2,0)
REASON. Only these remittance remarks are listed during a FileMan lookup,
"^DD",161.91,161.915,.01,21,3,0)
if defined.
"^DD",161.91,161.915,.01,"DT")
3150306
"^DD",161.91,161.917,0)
ADJUSTMENT GROUP SUB-FIELD^^.01^1
"^DD",161.91,161.917,0,"DT")
3160714
"^DD",161.91,161.917,0,"IX","B",161.917,.01)

"^DD",161.91,161.917,0,"NM","ADJUSTMENT GROUP")

"^DD",161.91,161.917,0,"UP")
161.91
"^DD",161.91,161.917,.01,0)
ADJUSTMENT GROUP^MP161.92'^FB(161.92,^0;1^Q
"^DD",161.91,161.917,.01,1,0)
^.1
"^DD",161.91,161.917,.01,1,1,0)
161.917^B
"^DD",161.91,161.917,.01,1,1,1)
S ^FB(161.91,DA(1),3,"B",$E(X,1,30),DA)=""
"^DD",161.91,161.917,.01,1,1,2)
K ^FB(161.91,DA(1),3,"B",$E(X,1,30),DA)
"^DD",161.91,161.917,.01,3)
Enter an ADJUSTMENT GROUP (#161.93)
"^DD",161.91,161.917,.01,"DT")
3160714
"^DD",161.93,161.93,3,0)
ADJUSTMENT GROUP^161.933PA^^3;0
"^DD",161.93,161.93,3,21,0)
^.001^1^1^3160714^^
"^DD",161.93,161.93,3,21,1,0)
Some RARCs have GROUP restrictions. Set this RARC's allowable groups here.
"^DD",161.93,161.933,0)
ADJUSTMENT GROUP SUB-FIELD^^.01^1
"^DD",161.93,161.933,0,"DT")
3160714
"^DD",161.93,161.933,0,"IX","B",161.933,.01)

"^DD",161.93,161.933,0,"NM","ADJUSTMENT GROUP")

"^DD",161.93,161.933,0,"UP")
161.93
"^DD",161.93,161.933,.01,0)
ADJUSTMENT GROUP^MP161.92'^FB(161.92,^0;1^Q
"^DD",161.93,161.933,.01,1,0)
^.1
"^DD",161.93,161.933,.01,1,1,0)
161.933^B
"^DD",161.93,161.933,.01,1,1,1)
S ^FB(161.93,DA(1),3,"B",$E(X,1,30),DA)=""
"^DD",161.93,161.933,.01,1,1,2)
K ^FB(161.93,DA(1),3,"B",$E(X,1,30),DA)
"^DD",161.93,161.933,.01,3)
Enter an ADJUSTMENT GROUP
"^DD",161.93,161.933,.01,"DT")
3160714
"^DD",162,162.03,52,0)
ADJUSTMENT^162.07PA^^7;0
"^DD",162,162.03,82,0)
PAYMENT METHODOLOGY^P163.98'^FBAA(163.98,^2;7^Q
"^DD",162,162.03,82,3)
Enter a valid Fee Basis Payment Methodology
"^DD",162,162.03,82,21,0)
^.001^2^2^3150630^^
"^DD",162,162.03,82,21,1,0)
The values in this field come from FBCS and represents the actual payment
"^DD",162,162.03,82,21,2,0)
methodology used in FBCS to adjudicate the claim.
"^DD",162,162.03,82,"DT")
3150417
"^DD",162,162.03,83,0)
AUTHORIZATION NUMBER^F^^9;1^K:$L(X)>30!($L(X)<3) X
"^DD",162,162.03,83,3)
Answer must be 3-30 characters in length.
"^DD",162,162.03,83,21,0)
^^1^1^3150528^
"^DD",162,162.03,83,21,1,0)
This field holds the authorization numbers transmitted from FBCS.
"^DD",162,162.03,83,"DT")
3150527
"^DD",162,162.03,84,0)
ATTACHMENT ID^162.0384A^^10;0
"^DD",162,162.0384,0)
ATTACHMENT ID SUB-FIELD^^.02^2
"^DD",162,162.0384,0,"DT")
3160620
"^DD",162,162.0384,0,"IX","B",162.0384,.01)

"^DD",162,162.0384,0,"NM","ATTACHMENT ID")

"^DD",162,162.0384,0,"UP")
162.03
"^DD",162,162.0384,.01,0)
ATTACHMENT ID^F^^0;1^K:$L(X)>30!($L(X)<1) X
"^DD",162,162.0384,.01,1,0)
^.1
"^DD",162,162.0384,.01,1,1,0)
162.0384^B
"^DD",162,162.0384,.01,1,1,1)
S ^FBAAC(DA(4),1,DA(3),1,DA(2),1,DA(1),10,"B",$E(X,1,30),DA)=""
"^DD",162,162.0384,.01,1,1,2)
K ^FBAAC(DA(4),1,DA(3),1,DA(2),1,DA(1),10,"B",$E(X,1,30),DA)
"^DD",162,162.0384,.01,3)
Answer must be 1-30 characters in length.
"^DD",162,162.0384,.01,21,0)
^^3^3^3160620^
"^DD",162,162.0384,.01,21,1,0)
This field contains the ID of an attachment supporting this payment in 
"^DD",162,162.0384,.01,21,2,0)
the Attachment Retrieval System (ARS). This data is populated 
"^DD",162,162.0384,.01,21,3,0)
automatically and should not be edited by users.
"^DD",162,162.0384,.01,"DT")
3160620
"^DD",162,162.0384,.02,0)
ATTACHMENT REPORT TYPE^P353.3'^IBE(353.3,^0;2^Q
"^DD",162,162.0384,.02,21,0)
^^2^2^3160620^
"^DD",162,162.0384,.02,21,1,0)
The Report Type Code describes the type of documentation that will 
"^DD",162,162.0384,.02,21,2,0)
provide additional information for this payment.
"^DD",162,162.0384,.02,"DT")
3160620
"^DD",162,162.07,0)
ADJUSTMENT SUB-FIELD^^2^3
"^DD",162,162.07,0,"NM","ADJUSTMENT")

"^DD",162,162.07,.01,0)
ADJUSTMENT REASON^M*P161.91'^FB(161.91,^0;1^S DIC("S")="I $P($$AR^FBUTL1(Y),U,4)=1" D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"^DD",162,162.07,.01,1,0)
^.1
"^DD",162,162.07,.01,1,1,0)
162.07^B
"^DD",162,162.07,.01,1,1,1)
S ^FBAAC(DA(4),1,DA(3),1,DA(2),1,DA(1),7,"B",$E(X,1,30),DA)=""
"^DD",162,162.07,.01,1,1,2)
K ^FBAAC(DA(4),1,DA(3),1,DA(2),1,DA(1),7,"B",$E(X,1,30),DA)
"^DD",162,162.07,.01,1,2,0)
162^AO^MUMPS
"^DD",162,162.07,.01,1,2,1)
Q
"^DD",162,162.07,.01,1,2,2)
D KILLRR^FBAAFR(X,.DA)
"^DD",162,162.07,.01,1,2,"%D",0)
^^2^2^3150528^
"^DD",162,162.07,.01,1,2,"%D",1,0)
Deletes remittance remarks associated with adjustment reasons when
"^DD",162,162.07,.01,1,2,"%D",2,0)
the reason is deleted.
"^DD",162,162.07,.01,1,2,"DT")
3150325
"^DD",162,162.07,.01,3)
Select a HIPAA Adjustment (suspense) Reason Code.
"^DD",162,162.07,.01,12)
Only adjustment reasons that are applicable for Fee use can be selected.
"^DD",162,162.07,.01,12.1)
S DIC("S")="I $P($$AR^FBUTL1(Y),U,4)=1"
"^DD",162,162.07,.01,21,0)
^.001^2^2^3030617^^
"^DD",162,162.07,.01,21,1,0)
Adjustment reason codes explain why the amount paid differs from the 
"^DD",162,162.07,.01,21,2,0)
amount claimed.
"^DD",162,162.07,.01,"DT")
3150325
"^DD",162,162.08,1,0)
ADJUSTMENT^NJ3,0^^0;2^K:+X'=X!(X>999)!(X<0)!(X?.E1"."1N.N) X
"^DD",162,162.08,1,3)
Type a number between 0 and 999, 0 decimal digits.
"^DD",162,162.08,1,21,0)
^^3^3^3150528^
"^DD",162,162.08,1,21,1,0)
For Internal use only. Used to associate a remittance remark entry with
"^DD",162,162.08,1,21,2,0)
an adjustment reason. The value entered into the ADJUSTMENT field is the 
"^DD",162,162.08,1,21,3,0)
DA of the adjustment reason entry.
"^DD",162,162.08,1,"DT")
3150319
"^DD",162.1,162.11,37,0)
ADJUSTMENT^162.14P^^4;0
"^DD",162.1,162.11,40,0)
AUTHORIZATION NUMBER^F^^3;2^K:$L(X)>30!($L(X)<3) X
"^DD",162.1,162.11,40,3)
Answer must be 3-30 characters in length.
"^DD",162.1,162.11,40,21,0)
^^1^1^3150528^
"^DD",162.1,162.11,40,21,1,0)
This field holds the authorization numbers transmitted from FBCS.
"^DD",162.1,162.11,40,"DT")
3150527
"^DD",162.1,162.14,0)
ADJUSTMENT SUB-FIELD^^2^3
"^DD",162.1,162.14,0,"NM","ADJUSTMENT")

"^DD",162.1,162.14,.01,0)
ADJUSTMENT REASON^M*P161.91'^FB(161.91,^0;1^S DIC("S")="I $P($$AR^FBUTL1(Y),U,4)=1" D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"^DD",162.1,162.14,.01,1,0)
^.1
"^DD",162.1,162.14,.01,1,1,0)
162.14^B
"^DD",162.1,162.14,.01,1,1,1)
S ^FBAA(162.1,DA(2),"RX",DA(1),4,"B",$E(X,1,30),DA)=""
"^DD",162.1,162.14,.01,1,1,2)
K ^FBAA(162.1,DA(2),"RX",DA(1),4,"B",$E(X,1,30),DA)
"^DD",162.1,162.14,.01,1,2,0)
162.1^AI^MUMPS
"^DD",162.1,162.14,.01,1,2,1)
Q
"^DD",162.1,162.14,.01,1,2,2)
D KILLRR^FBRXFR(X,.DA)
"^DD",162.1,162.14,.01,1,2,"%D",0)
^^2^2^3150528^
"^DD",162.1,162.14,.01,1,2,"%D",1,0)
Deletes remittance remarks associated with the adjustment reason when the
"^DD",162.1,162.14,.01,1,2,"%D",2,0)
reason is deleted.
"^DD",162.1,162.14,.01,1,2,"DT")
3150326
"^DD",162.1,162.14,.01,3)
Select a HIPAA Adjustment (suspense) Reason Code.
"^DD",162.1,162.14,.01,12)
Only adjustment reasons that are applicable for Fee use can be selected.
"^DD",162.1,162.14,.01,12.1)
S DIC("S")="I $P($$AR^FBUTL1(Y),U,4)=1"
"^DD",162.1,162.14,.01,21,0)
^.001^2^2^3030618^^^
"^DD",162.1,162.14,.01,21,1,0)
Adjustment reason codes explain why the amount paid differs from the 
"^DD",162.1,162.14,.01,21,2,0)
amount claimed.
"^DD",162.1,162.14,.01,"DT")
3150326
"^DD",162.1,162.15,1,0)
ADJUSTMENT^NJ3,0^^0;2^K:+X'=X!(X>999)!(X<0)!(X?.E1"."1N.N) X
"^DD",162.1,162.15,1,3)
Type a number between 0 and 999, 0 decimal digits.
"^DD",162.1,162.15,1,21,0)
^^3^3^3150409^
"^DD",162.1,162.15,1,21,1,0)
For Internal use only. Used to associate a remittance remark entry with
"^DD",162.1,162.15,1,21,2,0)
an adjustment reason within the ADJUSTMENT Multiple. The value entered 
"^DD",162.1,162.15,1,21,3,0)
into the ADJUSTMENT field is the DA of the adjustment reason entry.
"^DD",162.1,162.15,1,"DT")
3150317
"^DD",162.5,162.5,58,0)
ADJUSTMENT^162.558P^^8;0
"^DD",162.5,162.5,88,0)
AUTHORIZATION NUMBER^F^^7;1^K:$L(X)>30!($L(X)<3) X
"^DD",162.5,162.5,88,3)
Answer must be 3-30 characters in length.
"^DD",162.5,162.5,88,21,0)
^^1^1^3150528^
"^DD",162.5,162.5,88,21,1,0)
This field holds the authorization numbers transmitted from FBCS.
"^DD",162.5,162.5,88,"DT")
3150527
"^DD",162.5,162.5,89,0)
CLAIM LEVEL ALLOWED AMOUNT^NJ10,2^^7;2^S:X["$" X=$P(X,"$",2) K:X'?.N.1".".2N!(X>9999999.99)!(X<0) X
"^DD",162.5,162.5,89,3)
Type a dollar amount between 0 and 9999999.99, 2 decimal digits.
"^DD",162.5,162.5,89,21,0)
^^2^2^3150910^
"^DD",162.5,162.5,89,21,1,0)
This field is for internal use only. FBCS will populate the value, if 
"^DD",162.5,162.5,89,21,2,0)
available, for claims sent to VistA from FBCS.
"^DD",162.5,162.5,89,"DT")
3150910
"^DD",162.5,162.5,90,0)
PAYMENT METHODOLOGY^P163.98'^FBAA(163.98,^2;16^Q
"^DD",162.5,162.5,90,3)
Enter a valid Fee Basis Payment methodology
"^DD",162.5,162.5,90,21,0)
^^2^2^3160204^
"^DD",162.5,162.5,90,21,1,0)
The values in this field come from FBCS and represents the actual payment
"^DD",162.5,162.5,90,21,2,0)
methodology used in FBCS to adjudicate the claim.
"^DD",162.5,162.5,90,"DT")
3160204
"^DD",162.5,162.5,91,0)
ATTACHMENT ID^162.591A^^10;0
"^DD",162.5,162.558,0)
ADJUSTMENT SUB-FIELD^^2^3
"^DD",162.5,162.558,0,"NM","ADJUSTMENT")

"^DD",162.5,162.558,.01,0)
ADJUSTMENT REASON^*P161.91'^FB(161.91,^0;1^S DIC("S")="I $P($$AR^FBUTL1(Y),U,4)=1" D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"^DD",162.5,162.558,.01,1,0)
^.1
"^DD",162.5,162.558,.01,1,1,0)
162.558^B
"^DD",162.5,162.558,.01,1,1,1)
S ^FBAAI(DA(1),8,"B",$E(X,1,30),DA)=""
"^DD",162.5,162.558,.01,1,1,2)
K ^FBAAI(DA(1),8,"B",$E(X,1,30),DA)
"^DD",162.5,162.558,.01,1,2,0)
162.5^AL^MUMPS
"^DD",162.5,162.558,.01,1,2,1)
Q
"^DD",162.5,162.558,.01,1,2,2)
D KILLRR^FBCHFR(X,.DA)
"^DD",162.5,162.558,.01,1,2,"%D",0)
^^2^2^3150528^
"^DD",162.5,162.558,.01,1,2,"%D",1,0)
Deletes remittance remarks associated with the adjustment reason when the
"^DD",162.5,162.558,.01,1,2,"%D",2,0)
reason is deleted.
"^DD",162.5,162.558,.01,1,2,"DT")
3150326
"^DD",162.5,162.558,.01,3)
Select a HIPAA Adjustment (suspense) Reason Code.
"^DD",162.5,162.558,.01,12)
Only adjustment reasons that are applicable for Fee use can be selected.
"^DD",162.5,162.558,.01,12.1)
S DIC("S")="I $P($$AR^FBUTL1(Y),U,4)=1"
"^DD",162.5,162.558,.01,21,0)
^.001^2^2^3030625^^^^
"^DD",162.5,162.558,.01,21,1,0)
Adjustment reason codes explain why the amount paid differs from the 
"^DD",162.5,162.558,.01,21,2,0)
amount claimed.
"^DD",162.5,162.558,.01,"DT")
3150326
"^DD",162.5,162.559,1,0)
ADJUSTMENT^NJ3,0^^0;2^K:+X'=X!(X>999)!(X<1)!(X?.E1"."1N.N) X
"^DD",162.5,162.559,1,3)
Type a number between 1 and 999, 0 decimal digits.
"^DD",162.5,162.559,1,21,0)
^^4^4^3150325^
"^DD",162.5,162.559,1,21,1,0)
For Internal use only. Used to associate a remittance remark entry with 
"^DD",162.5,162.559,1,21,2,0)
an adjustment reason within the ADJUSTMENT Multiple (#162.558), 
"^DD",162.5,162.559,1,21,3,0)
ADJUSTMENT REASON (#.01) field. The value entered into the ADJUSTMENT 
"^DD",162.5,162.559,1,21,4,0)
field is the DA of the adjustment reason entry.
"^DD",162.5,162.559,1,"DT")
3150325
"^DD",162.5,162.591,0)
ATTACHMENT ID SUB-FIELD^^.02^2
"^DD",162.5,162.591,0,"DT")
3160419
"^DD",162.5,162.591,0,"IX","B",162.591,.01)

"^DD",162.5,162.591,0,"NM","ATTACHMENT ID")

"^DD",162.5,162.591,0,"UP")
162.5
"^DD",162.5,162.591,.01,0)
ATTACHMENT ID^F^^0;1^K:$L(X)>30!($L(X)<1) X
"^DD",162.5,162.591,.01,1,0)
^.1
"^DD",162.5,162.591,.01,1,1,0)
162.591^B
"^DD",162.5,162.591,.01,1,1,1)
S ^FBAAI(DA(1),10,"B",$E(X,1,30),DA)=""
"^DD",162.5,162.591,.01,1,1,2)
K ^FBAAI(DA(1),10,"B",$E(X,1,30),DA)
"^DD",162.5,162.591,.01,3)
Enter a new Attachment ID, 1-30 characters in length.
"^DD",162.5,162.591,.01,21,0)
^^3^3^3160419^
"^DD",162.5,162.591,.01,21,1,0)
This field contains the ID of an attachment supporting this invoice in the
"^DD",162.5,162.591,.01,21,2,0)
Attachment Retrieval System (ARS). This data is populated automatically 
"^DD",162.5,162.591,.01,21,3,0)
and should not be edited by users.
"^DD",162.5,162.591,.01,"DT")
3160419
"^DD",162.5,162.591,.02,0)
ATTACHMENT REPORT TYPE^P353.3'^IBE(353.3,^0;2^Q
"^DD",162.5,162.591,.02,21,0)
^^3^3^3160419^
"^DD",162.5,162.591,.02,21,1,0)
The Report Type Code describes the type of documentation that will provide
"^DD",162.5,162.591,.02,21,2,0)
additional information for this claim. The Attachment Report Type Code is
"^DD",162.5,162.591,.02,21,3,0)
at both the claim level and line level.
"^DD",162.5,162.591,.02,"DT")
3160419
"^DD",163.98,163.98,0)
FIELD^^1^2
"^DD",163.98,163.98,0,"DDA")
N
"^DD",163.98,163.98,0,"DT")
3150417
"^DD",163.98,163.98,0,"IX","B",163.98,.01)

"^DD",163.98,163.98,0,"IX","C",163.98,1)

"^DD",163.98,163.98,0,"NM","FEE BASIS PAYMENT METHODOLOGY")

"^DD",163.98,163.98,0,"PT",162.03,82)

"^DD",163.98,163.98,0,"PT",162.5,90)

"^DD",163.98,163.98,.01,0)
NAME^RF^^0;1^K:$L(X)>50!($L(X)<3)!'(X'?1P.E) X
"^DD",163.98,163.98,.01,.1)
Payment Methodology Name
"^DD",163.98,163.98,.01,1,0)
^.1
"^DD",163.98,163.98,.01,1,1,0)
163.98^B
"^DD",163.98,163.98,.01,1,1,1)
S ^FBAA(163.98,"B",$E(X,1,30),DA)=""
"^DD",163.98,163.98,.01,1,1,2)
K ^FBAA(163.98,"B",$E(X,1,30),DA)
"^DD",163.98,163.98,.01,3)
Answer must be 3-50 characters in length.
"^DD",163.98,163.98,.01,21,0)
^^1^1^3150417^
"^DD",163.98,163.98,.01,21,1,0)
This is the full name of the payment methodology.
"^DD",163.98,163.98,.01,"DT")
3150417
"^DD",163.98,163.98,1,0)
CODE^RF^^0;2^K:$L(X)>1!($L(X)<1) X
"^DD",163.98,163.98,1,1,0)
^.1
"^DD",163.98,163.98,1,1,1,0)
163.98^C
"^DD",163.98,163.98,1,1,1,1)
S ^FBAA(163.98,"C",$E(X,1,30),DA)=""
"^DD",163.98,163.98,1,1,1,2)
K ^FBAA(163.98,"C",$E(X,1,30),DA)
"^DD",163.98,163.98,1,1,1,"%D",0)
^^2^2^3150630^
"^DD",163.98,163.98,1,1,1,"%D",1,0)
This cross-reference holds available Payment Methodology Codes and used 
"^DD",163.98,163.98,1,1,1,"%D",2,0)
as an alternate lookup for the Name.
"^DD",163.98,163.98,1,1,1,"DT")
3150417
"^DD",163.98,163.98,1,3)
Answer must be 1 character in length.
"^DD",163.98,163.98,1,21,0)
^^1^1^3150417^
"^DD",163.98,163.98,1,21,1,0)
This is the single character code associated with the payment methodology.
"^DD",163.98,163.98,1,"DT")
3150417
"^DIC",163.98,163.98,0)
FEE BASIS PAYMENT METHODOLOGY^163.98
"^DIC",163.98,163.98,0,"GL")
^FBAA(163.98,
"^DIC",163.98,163.98,"%",0)
^1.005^^
"^DIC",163.98,163.98,"%D",0)
^^2^2^3150630^
"^DIC",163.98,163.98,"%D",1,0)
This file is used as the table of current Payment Methodologies received 
"^DIC",163.98,163.98,"%D",2,0)
from FBCS as part of the claim data.
"^DIC",163.98,"B","FEE BASIS PAYMENT METHODOLOGY",163.98)

"BLD",9162,6)
^149
**END**
**END**

