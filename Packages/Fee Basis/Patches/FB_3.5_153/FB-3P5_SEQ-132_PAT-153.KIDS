Released FB*3.5*153 SEQ #132
Extracted from mail message
**KIDS**:FB*3.5*153^

**INSTALL NAME**
FB*3.5*153
"BLD",9612,0)
FB*3.5*153^FEE BASIS^0^3150304^y
"BLD",9612,1,0)
^^11^11^3150304^
"BLD",9612,1,1,0)
1. Patient MRA rejections from FMS
"BLD",9612,1,2,0)
 
"BLD",9612,1,3,0)
2. For option 'Enter Unauthorized Claim' the response to query Mill Bill
"BLD",9612,1,4,0)
   Claim indicator is not always stored when 'NO'.
"BLD",9612,1,5,0)
 
"BLD",9612,1,6,0)
3. Authorization that are entered for Contract Nursing Home obligations 
"BLD",9612,1,7,0)
   are hitting every station's obligations for integrated sites when
"BLD",9612,1,8,0)
   posted.
"BLD",9612,1,9,0)
 
"BLD",9612,1,10,0)
4. Patient MRA transmissions are not being sent due to deleted patient
"BLD",9612,1,11,0)
   authorizations.
"BLD",9612,4,0)
^9.64PA^^
"BLD",9612,6)
1^
"BLD",9612,6.3)
14
"BLD",9612,"ABPKG")
n
"BLD",9612,"KRN",0)
^9.67PA^779.2^20
"BLD",9612,"KRN",.4,0)
.4
"BLD",9612,"KRN",.4,"NM",0)
^9.68A^^
"BLD",9612,"KRN",.401,0)
.401
"BLD",9612,"KRN",.401,"NM",0)
^9.68A^^
"BLD",9612,"KRN",.402,0)
.402
"BLD",9612,"KRN",.402,"NM",0)
^9.68A^1^1
"BLD",9612,"KRN",.402,"NM",1,0)
FB UNAUTHORIZED ENTER    FILE #162.7^162.7^0
"BLD",9612,"KRN",.402,"NM","B","FB UNAUTHORIZED ENTER    FILE #162.7",1)

"BLD",9612,"KRN",.403,0)
.403
"BLD",9612,"KRN",.5,0)
.5
"BLD",9612,"KRN",.84,0)
.84
"BLD",9612,"KRN",3.6,0)
3.6
"BLD",9612,"KRN",3.8,0)
3.8
"BLD",9612,"KRN",9.2,0)
9.2
"BLD",9612,"KRN",9.8,0)
9.8
"BLD",9612,"KRN",9.8,"NM",0)
^9.68A^5^4
"BLD",9612,"KRN",9.8,"NM",2,0)
FBUCEN^^0^B27715243
"BLD",9612,"KRN",9.8,"NM",3,0)
FBNHPC^^0^B14162859
"BLD",9612,"KRN",9.8,"NM",4,0)
FBNHPC1^^0^B13879946
"BLD",9612,"KRN",9.8,"NM",5,0)
FBAAV4^^0^B39089780
"BLD",9612,"KRN",9.8,"NM","B","FBAAV4",5)

"BLD",9612,"KRN",9.8,"NM","B","FBNHPC",3)

"BLD",9612,"KRN",9.8,"NM","B","FBNHPC1",4)

"BLD",9612,"KRN",9.8,"NM","B","FBUCEN",2)

"BLD",9612,"KRN",19,0)
19
"BLD",9612,"KRN",19.1,0)
19.1
"BLD",9612,"KRN",101,0)
101
"BLD",9612,"KRN",409.61,0)
409.61
"BLD",9612,"KRN",771,0)
771
"BLD",9612,"KRN",779.2,0)
779.2
"BLD",9612,"KRN",870,0)
870
"BLD",9612,"KRN",8989.51,0)
8989.51
"BLD",9612,"KRN",8989.52,0)
8989.52
"BLD",9612,"KRN",8994,0)
8994
"BLD",9612,"KRN","B",.4,.4)

"BLD",9612,"KRN","B",.401,.401)

"BLD",9612,"KRN","B",.402,.402)

"BLD",9612,"KRN","B",.403,.403)

"BLD",9612,"KRN","B",.5,.5)

"BLD",9612,"KRN","B",.84,.84)

"BLD",9612,"KRN","B",3.6,3.6)

"BLD",9612,"KRN","B",3.8,3.8)

"BLD",9612,"KRN","B",9.2,9.2)

"BLD",9612,"KRN","B",9.8,9.8)

"BLD",9612,"KRN","B",19,19)

"BLD",9612,"KRN","B",19.1,19.1)

"BLD",9612,"KRN","B",101,101)

"BLD",9612,"KRN","B",409.61,409.61)

"BLD",9612,"KRN","B",771,771)

"BLD",9612,"KRN","B",779.2,779.2)

"BLD",9612,"KRN","B",870,870)

"BLD",9612,"KRN","B",8989.51,8989.51)

"BLD",9612,"KRN","B",8989.52,8989.52)

"BLD",9612,"KRN","B",8994,8994)

"BLD",9612,"QDEF")
^^^^^^^^^^YES
"BLD",9612,"QUES",0)
^9.62^^
"BLD",9612,"REQB",0)
^9.611^4^3
"BLD",9612,"REQB",2,0)
FB*3.5*114^2
"BLD",9612,"REQB",3,0)
FB*3.5*25^2
"BLD",9612,"REQB",4,0)
FB*3.5*127^2
"BLD",9612,"REQB","B","FB*3.5*114",2)

"BLD",9612,"REQB","B","FB*3.5*127",4)

"BLD",9612,"REQB","B","FB*3.5*25",3)

"KRN",.402,1179,-1)
0^1
"KRN",.402,1179,0)
FB UNAUTHORIZED ENTER^3150220.1248^^162.7^^^3150227
"KRN",.402,1179,"%D",0)
^^1^1^2931012^^
"KRN",.402,1179,"%D",1,0)
Enter unauthorized claim
"KRN",.402,1179,"DIAB",1,1,162.715,0)
ALL
"KRN",.402,1179,"DIAB",2,0,162.7,6)
12//^S X=FBX;REQ
"KRN",.402,1179,"DIAB",4,0,162.7,6)
13//^S X=$S(FBDISP=1:FBTTO,1:"");REQ
"KRN",.402,1179,"DIAB",15,0,162.7,4)
6;REQ
"KRN",.402,1179,"DIAB",17,0,162.7,4)
9;T;DUP
"KRN",.402,1179,"DR",1,162.7)
S:'$D(FBVET)!('$D(FBVEN))!('$D(FBMASTER))!('$D(FBORDER))!('$D(FBTFROM))!('$D(FBTTO))!('$D(FBOK))!('$D(FBPR))!('$D(FBDA))!('$D(FBUC))!('$D(FBINENT)) Y="@999";2////^S X=FBVET;S:'FBVEN&(FBINENT) Y="@51";1////^S X=FBVEN;@51;
"KRN",.402,1179,"DR",1,162.7,1)
.5////^S X=FBPR;S:$G(FBFPPSC)="" Y="@513";32///^S X=FBFPPSC;@513;S FB1725=$S(FB1725:1,1:0);31////^S X=FB1725;@515;3///^S X=FBTFROM;S:'FBTTO&(FBINENT) Y="@52";4///^S X=FBTTO;@52;24////^S X=$$STATUS^FBUCUTL(FBORDER);
"KRN",.402,1179,"DR",1,162.7,2)
20////^S X=FBMASTER;27////^S X=DUZ;28///^S X=DT;S:'FBOK Y="@1";7///^S X=DT;@1;S:'FBVEN&(FBINENT) Y="@53";23;@53;.01;W:$$DTC^FBUCUTL(X,FBTTO)>90&FB1725 !!,"Warning: Claim > 90 days",!;S:FBPR=7 FBX=3,Y="@4";
"KRN",.402,1179,"DR",1,162.7,3)
S:$$DTC^FBUCUTL(DT,$S(FBPR=6!(FBPR=7):DT,1:FBTFROM))>730&'FB1725 FBX=6,Y="@4";S:$P(FBUC,U,7) Y="@999";S ICDSYS=10,IMPDATE=$$IMPDATE^FBCSV1("10D");S:FBPR=6 EDATE=$$FRDTUC^FBCSV1(FBDA);S:((FBPR=2)!(FBPR=3)) EDATE=FBTTO;
"KRN",.402,1179,"DR",1,162.7,4)
S:'EDATE EDATE=FBTFROM;S:'EDATE EDATE=DT;S:EDATE<IMPDATE ICDSYS=9;S:ICDSYS=9 Y="@85";@80;S XX1=-1;S XX1=$$ASKICD10^FBASF("ICD DIAGNOSIS","");S:XX1=-3 Y="@99";S:XX1=-1 Y="@86";5.1////^S:XX1>0 X=XX1;S Y="@86";@85;5;@86;6R~;8;9d~T~;
"KRN",.402,1179,"DR",1,162.7,5)
S:'FBOK!($D(^FBAA(162.8,"ACD",FBDA))) Y="@99";10;S FBDISP=X;10.5;S:FBDISP FBORDER=40;S Y=$S(FBDISP=1!(FBDISP=4):"@2",FBDISP=2:"@3",1:"@99");@2;S FBZDAYS=$$CDTC^FBUCUTL(+$G(^FB583(DA,0)),-731);
"KRN",.402,1179,"DR",1,162.7,6)
S FBX=$S(FBTTO>FBZDAYS&(FBTFROM<FBZDAYS):FBZDAYS,1:FBTFROM);12R~//^S X=FBX;K FBX,FBZDAYS;13R~//^S X=$S(FBDISP=1:FBTTO,1:"");S Y="@99";@3;15;S Y="@99";@4;D UNTIME^FBUCUTL(FBX);10////^S X=2;D DISAP^FBUCUTL(DA,FBX);S FBORDER=40;@99;
"KRN",.402,1179,"DR",1,162.7,7)
S:FBORDER'=40 Y="@999";24////^S X=$$STATUS^FBUCUTL(FBORDER);@999;K FBDISP,FBX;
"KRN",.402,1179,"DR",2,162.715)
.01
"MBREQ")
0
"ORD",7,.402)
.402;7;;;EDEOUT^DIFROMSO(.402,DA,"",XPDA);FPRE^DIFROMSI(.402,"",XPDA);EPRE^DIFROMSI(.402,DA,$E("N",$G(XPDNEW)),XPDA,"",OLDA);;EPOST^DIFROMSI(.402,DA,"",XPDA);DEL^DIFROMSK(.402,"",%)
"ORD",7,.402,0)
INPUT TEMPLATE
"PKG",60,-1)
1^1
"PKG",60,0)
FEE BASIS^FB^Used to pay private vendors
"PKG",60,20,0)
^9.402P^1^1
"PKG",60,20,1,0)
2^^FBPMRG
"PKG",60,20,1,1)

"PKG",60,20,"B",2,1)

"PKG",60,22,0)
^9.49I^1^1
"PKG",60,22,1,0)
3.5^2950130^2950313
"PKG",60,22,1,"PAH",1,0)
153^3150304^719
"PKG",60,22,1,"PAH",1,1,0)
^^11^11^3150304
"PKG",60,22,1,"PAH",1,1,1,0)
1. Patient MRA rejections from FMS
"PKG",60,22,1,"PAH",1,1,2,0)
 
"PKG",60,22,1,"PAH",1,1,3,0)
2. For option 'Enter Unauthorized Claim' the response to query Mill Bill
"PKG",60,22,1,"PAH",1,1,4,0)
   Claim indicator is not always stored when 'NO'.
"PKG",60,22,1,"PAH",1,1,5,0)
 
"PKG",60,22,1,"PAH",1,1,6,0)
3. Authorization that are entered for Contract Nursing Home obligations 
"PKG",60,22,1,"PAH",1,1,7,0)
   are hitting every station's obligations for integrated sites when
"PKG",60,22,1,"PAH",1,1,8,0)
   posted.
"PKG",60,22,1,"PAH",1,1,9,0)
 
"PKG",60,22,1,"PAH",1,1,10,0)
4. Patient MRA transmissions are not being sent due to deleted patient
"PKG",60,22,1,"PAH",1,1,11,0)
   authorizations.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
4
"RTN","FBAAV4")
0^5^B39089780^B35214888
"RTN","FBAAV4",1,0)
FBAAV4 ;AISC/GRR-ELECTRONICALLY TRANSMIT PATIENT MRA'S ;12/16/2003
"RTN","FBAAV4",2,0)
 ;;3.5;FEE BASIS;**13,34,37,70,146,127,153**;JAN 30, 1995;Build 14
"RTN","FBAAV4",3,0)
 ;;Per VA Directive 6402, this routine should not be modified.
"RTN","FBAAV4",4,0)
 ;
"RTN","FBAAV4",5,0)
 ;FB*3.5*153 Modify MRA transmission to Austin to insure that a
"RTN","FBAAV4",6,0)
 ;           undefined state code defaults to 2 spaces.
"RTN","FBAAV4",7,0)
 ;           Also, delete the entry in file 161.26 if no auth
"RTN","FBAAV4",8,0)
 ;           pointer exists in record or the auth pointer points
"RTN","FBAAV4",9,0)
 ;           to deleted patient authorization.  In addition,
"RTN","FBAAV4",10,0)
 ;           insure processing continues if error condition
"RTN","FBAAV4",11,0)
 ;           and less than 100 stacked msgs for transmission.
"RTN","FBAAV4",12,0)
 ;
"RTN","FBAAV4",13,0)
 ;D STATION^FBAAUTL,HD^FBAAUTL Q:$D(FB("ERROR"))
"RTN","FBAAV4",14,0)
 S FBTXT=0,ZMCNT=1 ;FBTXT , ZMCNT 
"RTN","FBAAV4",15,0)
GO S J=0 F  S J=$O(^FBAA(161.26,"AC","P",J)) Q:J'>0  S FB0=$G(^FBAA(161.26,J,0)) I $P(FB0,U) S Y(0)=$G(^DPT($P(FB0,U),0)) I Y(0)]"" S FBTYPE=$S($P(FB0,U,4)]"":$P(FB0,U,4),1:"A"),FBFDC=$P(FB0,U,6),FBMST=$P(FB0,U,7) D
"RTN","FBAAV4",16,0)
 .; GETBT-prepare header 
"RTN","FBAAV4",17,0)
 .; NEWMSG^FBAAV01-get new message number, reset line counter, set subject line 
"RTN","FBAAV4",18,0)
 .; STORE^FBAAV01- increment line counter and store in ^XMB
"RTN","FBAAV4",19,0)
 .; FBLN -line counter; FBFEE- "FEE message" counter; FBOKTX=1 if message pending, 0 otherwise
"RTN","FBAAV4",20,0)
 .I 'FBTXT S FBTXT=1 D GETBT,NEWMSG^FBAAV01,STORE^FBAAV01
"RTN","FBAAV4",21,0)
 .; prepare and store patient MRA portion (can be more than 1)
"RTN","FBAAV4",22,0)
 .D GOT
"RTN","FBAAV4",23,0)
 D:ZMCNT>1 XMIT^FBAAV01    ;FB*3.5*153
"RTN","FBAAV4",24,0)
 Q
"RTN","FBAAV4",25,0)
 ;GETBT - prepare the "header" of the message 
"RTN","FBAAV4",26,0)
GETBT D GETNXB^FBAAUTL ;get next batch # in FBBN
"RTN","FBAAV4",27,0)
 S FBZBN=$E("00000",$L(FBBN)+1,5)_FBBN,FBSN=FBSN_$E("      ",$L(FBSN)+1,6)
"RTN","FBAAV4",28,0)
 S FBSTR=FBHD_"C2"_$E(DT,4,7)_$E(DT,2,3)_FBSN_FBZBN_"$"
"RTN","FBAAV4",29,0)
 Q
"RTN","FBAAV4",30,0)
 ; 
"RTN","FBAAV4",31,0)
GOT ;patient MRA portion of the message
"RTN","FBAAV4",32,0)
 N FBCCFLG,FBPATICN,FB2NDSTR
"RTN","FBAAV4",33,0)
 ; patient info;input:Y(0);output:FBDOB,FBFI,FBFLNAM,FBLNAM,FBMI,FBNAME,FBSEX,FBSSN
"RTN","FBAAV4",34,0)
 D PAT^FBAAUTL2
"RTN","FBAAV4",35,0)
 S DFN=$P(FB0,U)
"RTN","FBAAV4",36,0)
 S FBFLNAM=$$HL7NAME(DFN),FBFI="",FBMI="" ;name (FBFI,FBMI - obsolete)
"RTN","FBAAV4",37,0)
 ; demographic info, output:VADM
"RTN","FBAAV4",38,0)
 D DEM^VADPT Q:$G(VAERR)
"RTN","FBAAV4",39,0)
 S FBBD=$P(VADM(3),"^"),FBBD=$E(FBBD,4,7)_$E(FBBD,2,3) ;DOB
"RTN","FBAAV4",40,0)
 S FBBD=$S(FBBD="":"      ",1:FBBD),FBSEX=$P(VADM(5),"^"),FBSEX=$S(FBSEX="F":2,1:1)
"RTN","FBAAV4",41,0)
 S DOD=$P($P(VADM(6),"^"),".") ;DOD
"RTN","FBAAV4",42,0)
 K VADM,VAERR
"RTN","FBAAV4",43,0)
 ;S Y(0)=$S($D(^DPT(DFN,.11)):^(.11),1:"") Q:Y(0)']""
"RTN","FBAAV4",44,0)
 ;S FBADD=$E($P(Y(0),"^",1),1,21),FBADD=FBADD_$E(PAD,$L(FBADD)+1,21),FBCITY=$E($P(Y(0),"^",4),1,13),FBCITY=FBCITY_$E(PAD,$L(FBCITY)+1,13),FBSTAT="  "
"RTN","FBAAV4",45,0)
 ;S STCD=$P(Y(0),"^",5) I STCD]"" S FBSTAT=$S($D(^DIC(5,STCD,0)):$P(^(0),"^",2),1:"  ")
"RTN","FBAAV4",46,0)
 ;
"RTN","FBAAV4",47,0)
 ;address info, output: VAPA()
"RTN","FBAAV4",48,0)
 S VAPA("P")="" D ADD^VADPT Q:$G(VAERR)
"RTN","FBAAV4",49,0)
 S FBADD=$$LRJ($G(VAPA(1)),35)_$$LRJ($G(VAPA(2)),35)_$$LRJ($G(VAPA(3)),35) ;street address
"RTN","FBAAV4",50,0)
 S FBCITY=$$LRJ($G(VAPA(4)),30) ;city
"RTN","FBAAV4",51,0)
 S STCD=+VAPA(5),FBSTAT=$S($D(^DIC(5,STCD,0)):$P(^(0),"^",2),1:"  ") ;state     FB*3.5*153
"RTN","FBAAV4",52,0)
 S FBZIP=$S('+$G(VAPA(11)):VAPA(6),+VAPA(11):$P(VAPA(11),"^"),1:VAPA(6)) ;zip
"RTN","FBAAV4",53,0)
 ;check for Confidential Communication (CC) address
"RTN","FBAAV4",54,0)
 S FBCCFLG=0 I 'VAERR S FBCCFLG=$$SENDCC()
"RTN","FBAAV4",55,0)
 S FB2NDSTR=$$SECLINE()
"RTN","FBAAV4",56,0)
 S FBZIP=$TR(FBZIP,"-","")_$E("000000000",$L(FBZIP)+1,9)
"RTN","FBAAV4",57,0)
 S STCC=+VAPA(7),FBCC="000" I STCC,STCD S FBCC=$S($D(^DIC(5,STCD,1,STCC,0)):$P(^(0),"^",3),1:"000") ;county code
"RTN","FBAAV4",58,0)
 K VAPA,VAERR
"RTN","FBAAV4",59,0)
 ;
"RTN","FBAAV4",60,0)
 ; eligibility, output:VAEL()
"RTN","FBAAV4",61,0)
 D ELIG^VADPT
"RTN","FBAAV4",62,0)
 S POS=$S(+VAEL(2):+VAEL(2),1:"") ;PERIOD OF SERVICE
"RTN","FBAAV4",63,0)
 K VAEL,VAERR
"RTN","FBAAV4",64,0)
 S POS=$S(POS="":8,$D(^DIC(21,POS,0)):$P(^(0),"^",3),1:8) ;default: 8 (POST-VIETNAM)
"RTN","FBAAV4",65,0)
 S DOD=$S(DOD="":"000000",1:$E(DOD,4,7)_$E(DOD,2,3))
"RTN","FBAAV4",66,0)
 ;
"RTN","FBAAV4",67,0)
 ; service information
"RTN","FBAAV4",68,0)
 D SVC^VADPT
"RTN","FBAAV4",69,0)
 S POW=$S(+VASV(4):+VASV(4),1:""),POW=$S(POW="":2,POW=1:1,1:2) ;if prisoner of war
"RTN","FBAAV4",70,0)
 ;
"RTN","FBAAV4",71,0)
 ; remove all variables defined by VADPT
"RTN","FBAAV4",72,0)
 D KVAR^VADPT
"RTN","FBAAV4",73,0)
 ;
"RTN","FBAAV4",74,0)
 ;using pointer FEE BASIS PATIENT MRA file retrieve info from 
"RTN","FBAAV4",75,0)
 ;FEE BASIS PATIENT file#161, from its authorization multiple ^FBAAA(DA(1),1,DA
"RTN","FBAAV4",76,0)
 ;S FBAUTH=$P(^FBAA(161.26,J,0),"^",3) Q:FBAUTH']""  Q:'$D(^FBAAA(DFN,1,FBAUTH,0))  S Y(0)=^(0) ;Removed line to modify code - FB*3.5*127
"RTN","FBAAV4",77,0)
 S FBAUTH=$P(^FBAA(161.26,J,0),"^",3) I FBAUTH']"" D KILBAD Q  ;FB*3.5*153
"RTN","FBAAV4",78,0)
 I '$D(^FBAAA(DFN,1,FBAUTH,0)) D KILBAD Q  ;FB*3.5*153
"RTN","FBAAV4",79,0)
 S Y(0)=^(0) ;FB*3.5*127
"RTN","FBAAV4",80,0)
 ;authorisation FROM
"RTN","FBAAV4",81,0)
 S FBFR=$P(Y(0),"^")
"RTN","FBAAV4",82,0)
 ;authorisation TO
"RTN","FBAAV4",83,0)
 S FBTO=$P(Y(0),"^",2)
"RTN","FBAAV4",84,0)
 ;PURPOSE OF VISIT
"RTN","FBAAV4",85,0)
 S POV=$P(Y(0),"^",7),POV=$S(POV="":"",$D(^FBAA(161.82,POV,0)):$P(^(0),"^",3),1:""),POV=$S(POV]"":POV,1:"05")
"RTN","FBAAV4",86,0)
 ;TREATMENT TYPE CODE (SHORT TERM,HOME NURSING,I.D. CARD,STATE HOME)
"RTN","FBAAV4",87,0)
 S FBTT=$P(Y(0),"^",13),FBTT=$S(FBTT]"":FBTT,1:1)
"RTN","FBAAV4",88,0)
 ;
"RTN","FBAAV4",89,0)
 S FBRECT=$S(FBTT=4:"7",FBTT=2:"S",$G(POV)>28&($G(POV)<50):"C",1:2)
"RTN","FBAAV4",90,0)
 ;formatting FORM and TO dates
"RTN","FBAAV4",91,0)
 S FBFR=$E(FBFR,4,7)_$E(FBFR,2,3),FBTO=$E(FBTO,4,7)_$E(FBTO,2,3)
"RTN","FBAAV4",92,0)
 ;flag that the authorization From Date is being changed by this 
"RTN","FBAAV4",93,0)
 ;master record adjustment (see file #161.26, field #5)
"RTN","FBAAV4",94,0)
 I FBTYPE="C" S FBTO=$S(FBFDC=1:"      ",1:FBTO)
"RTN","FBAAV4",95,0)
 ;
"RTN","FBAAV4",96,0)
 I FBTT=2,"^70^71^74^"'[(U_POV_U) S POV=71
"RTN","FBAAV4",97,0)
 ;if 
"RTN","FBAAV4",98,0)
 S ZMCNT=ZMCNT+1 I ZMCNT>100 D GETBT,STORE S ZMCNT=ZMCNT+1
"RTN","FBAAV4",99,0)
 ; patch FB*3.5*13 changed format of delete MRAs to include the From Date
"RTN","FBAAV4",100,0)
 I FBTYPE="D" D  Q
"RTN","FBAAV4",101,0)
 . S FBRECT=$S(FBTT=4:"7",FBTT=2:"S",$G(POV)=31:"C",1:2)
"RTN","FBAAV4",102,0)
 . S FBSTR=FBRECT_FBTYPE_FBSN_FBSSN_FBFR_"$"
"RTN","FBAAV4",103,0)
 . D ZAP
"RTN","FBAAV4",104,0)
 I FBTYPE="R" D
"RTN","FBAAV4",105,0)
 . S FBRECT=$S(FBTT=4:"7",FBTT=2:"S",$G(POV)=31:"C",1:2)
"RTN","FBAAV4",106,0)
 . ; If Re-Instate for a State Home record type then switch to Add
"RTN","FBAAV4",107,0)
 . ;   because Central FEE does not retain deleted State Home auth.
"RTN","FBAAV4",108,0)
 . I FBRECT=7 S FBTYPE="A" Q
"RTN","FBAAV4",109,0)
 . ; For all other record types send a Re-Instate followed by a Change
"RTN","FBAAV4",110,0)
 . S FBSTR=FBRECT_FBTYPE_FBSN_FBSSN_"$"
"RTN","FBAAV4",111,0)
 . D ZAP
"RTN","FBAAV4",112,0)
 . S FBTYPE="C"
"RTN","FBAAV4",113,0)
 ; construct Add and Change record types
"RTN","FBAAV4",114,0)
 S FBTT=$S(FBMST="Y":0,1:FBTT)
"RTN","FBAAV4",115,0)
 S FBPATICN=$$ICN(DFN) ;get patient's ICN
"RTN","FBAAV4",116,0)
 S FBSTR=FBRECT_FBTYPE_FBSN_FBSSN_FBFI_FBMI_FBFLNAM_FBADD_FBCITY_FBSTAT_FBZIP_FBFR_FBTO_FBCC_FBBD_POV_" "_FBTT_FBSEX_POW_DOD_" "_POS_FBPATICN_"~"
"RTN","FBAAV4",117,0)
 ;if no CC address then send only 1st line of Add and Change record
"RTN","FBAAV4",118,0)
 I FBCCFLG=0 S FBSTR=FBSTR_"$" D ZAP Q
"RTN","FBAAV4",119,0)
 ;save 1st line of Add and Change record
"RTN","FBAAV4",120,0)
 D STORE
"RTN","FBAAV4",121,0)
 ;create 2nd line for CC address
"RTN","FBAAV4",122,0)
 S FBSTR=FB2NDSTR
"RTN","FBAAV4",123,0)
 D ZAP
"RTN","FBAAV4",124,0)
 Q
"RTN","FBAAV4",125,0)
 ;place in XMB for transmission and update FBAA(161.26
"RTN","FBAAV4",126,0)
ZAP D STORE
"RTN","FBAAV4",127,0)
 S DA=J,(DIC,DIE)="^FBAA(161.26,",T="T",DR="1///^S X=T;4///^S X=DT" D ^DIE
"RTN","FBAAV4",128,0)
 Q
"RTN","FBAAV4",129,0)
SKIP S FBRECT=$S(FBTT=2:"S",1:2),FBSTR=FBRECT_FBTYPE_FBSN_FBSSN_"$" G ZAP
"RTN","FBAAV4",130,0)
STORE I ZMCNT>100 D XMIT^FBAAV01,NEWMSG^FBAAV01 S ZMCNT=1
"RTN","FBAAV4",131,0)
 D STORE^FBAAV01
"RTN","FBAAV4",132,0)
 Q
"RTN","FBAAV4",133,0)
 ;---
"RTN","FBAAV4",134,0)
 ;Patient's INTEGRATION CONTROL NUMBER
"RTN","FBAAV4",135,0)
 ;to be implemented in future
"RTN","FBAAV4",136,0)
 ;meanwhile returns 17 spaces
"RTN","FBAAV4",137,0)
ICN(FBDFN) ;
"RTN","FBAAV4",138,0)
 Q $$LRJ("",17)
"RTN","FBAAV4",139,0)
 ;---
"RTN","FBAAV4",140,0)
 ;adds spaces on right/left or truncates to make return string FBLEN characters long
"RTN","FBAAV4",141,0)
 ;FBST- original string
"RTN","FBAAV4",142,0)
 ;FBLEN - desired length
"RTN","FBAAV4",143,0)
 ;FBCHR -character (default = SPACE)
"RTN","FBAAV4",144,0)
 ;FBSIDE - on which side to add characters (default = RIGHT)
"RTN","FBAAV4",145,0)
LRJ(FBST,FBLEN,FBCHR,FBSIDE) ;
"RTN","FBAAV4",146,0)
 N Y S $P(Y,$S($L($G(FBCHR)):FBCHR,1:" "),$S(FBLEN-$L(FBST)<0:1,1:FBLEN-$L(FBST)+1))=""
"RTN","FBAAV4",147,0)
 Q $E($S($G(FBSIDE)="L":Y_FBST,1:FBST_Y),1,FBLEN)
"RTN","FBAAV4",148,0)
 ;---
"RTN","FBAAV4",149,0)
 ;parse name components
"RTN","FBAAV4",150,0)
HL7NAME(FBDFN) ;
"RTN","FBAAV4",151,0)
 N FBAR,FBNM
"RTN","FBAAV4",152,0)
 S FBAR("FILE")=2,FBAR("IENS")=FBDFN,FBAR("FIELD")=.01
"RTN","FBAAV4",153,0)
 S FBNM=$$HLNAME^XLFNAME(.FBAR,"L30","|")
"RTN","FBAAV4",154,0)
 Q $$LRJ(FBNM,30)
"RTN","FBAAV4",155,0)
 ;
"RTN","FBAAV4",156,0)
 ;create 2nd line for CC address
"RTN","FBAAV4",157,0)
 ;VAPA should be determined
"RTN","FBAAV4",158,0)
SECLINE() ;
"RTN","FBAAV4",159,0)
 N FBSTR1
"RTN","FBAAV4",160,0)
 S FBSTR1=$$LRJ($G(VAPA(13)),35)_$$LRJ($G(VAPA(14)),35)_$$LRJ($G(VAPA(15)),35)_$$LRJ($G(VAPA(16)),30) ;street address
"RTN","FBAAV4",161,0)
 S FBSTR1=FBSTR1_$$LRJ($S(+$G(VAPA(17)):$P($G(^DIC(5,+$G(VAPA(17)),0)),"^",2),1:""),2) ;state
"RTN","FBAAV4",162,0)
 S FBSTR1=FBSTR1_$$LRJ($TR($P($G(VAPA(18)),"^",1),"-",""),9,"0") ;zip
"RTN","FBAAV4",163,0)
 S FBSTR1=FBSTR1_$$LRJ($E(+$G(VAPA(20)),4,5)_$E(+$G(VAPA(20)),6,7)_$E(+$G(VAPA(20)),2,3),6)
"RTN","FBAAV4",164,0)
 S FBSTR1=FBSTR1_$$LRJ($E(+$G(VAPA(21)),4,5)_$E(+$G(VAPA(21)),6,7)_$E(+$G(VAPA(21)),2,3),6)
"RTN","FBAAV4",165,0)
 S FBSTR1=FBSTR1_$$LRJ($P($G(^DIC(5,+$G(VAPA(17)),1,+$G(VAPA(19)),0)),"^",3),3,"0","L") ;county code
"RTN","FBAAV4",166,0)
 S FBSTR1=FBSTR1_"~$"
"RTN","FBAAV4",167,0)
 Q FBSTR1
"RTN","FBAAV4",168,0)
 ;------
"RTN","FBAAV4",169,0)
 ;SENDCC
"RTN","FBAAV4",170,0)
 ;returns 1 if CC address needs to be sent, otherwise - 0
"RTN","FBAAV4",171,0)
 ;is called after ADD^VADPT, i.e. VAPA should be defined
"RTN","FBAAV4",172,0)
SENDCC() ;
"RTN","FBAAV4",173,0)
 ;if it is currrently active
"RTN","FBAAV4",174,0)
 I $$ACTIVECC^FBAACO0() Q 1
"RTN","FBAAV4",175,0)
 N X D NOW^%DTC ;set X to TODAY
"RTN","FBAAV4",176,0)
 I ($P($G(VAPA(22,3)),"^",3)="Y"),+$G(VAPA(20))>X Q 1
"RTN","FBAAV4",177,0)
 Q 0
"RTN","FBAAV4",178,0)
 ;
"RTN","FBAAV4",179,0)
KILBAD ;DELETE mra W/ NO POINTER OR UNDEFINED POINTER TO PAT. AUTH
"RTN","FBAAV4",180,0)
 I $D(DA) S FBHDA=DA
"RTN","FBAAV4",181,0)
 S DA=J,DIK="^FBAA(161.26," D ^DIK K DIK
"RTN","FBAAV4",182,0)
 I $D(FBHDA) S DA=FBHDA K FBHDA
"RTN","FBAAV4",183,0)
 Q
"RTN","FBNHPC")
0^3^B14162859^B12365925
"RTN","FBNHPC",1,0)
FBNHPC ;AISC/GRR-POST COMMITMENTS TO 1358 ;1DEC00
"RTN","FBNHPC",2,0)
 ;;3.5;FEE BASIS;**25,153**;JAN 30, 1995;Build 14
"RTN","FBNHPC",3,0)
 ;;Per VA Directive 6402, this routine should not be modified.
"RTN","FBNHPC",4,0)
 ;
"RTN","FBNHPC",5,0)
 ;FB*3.5*153 Save requested site internal to insure obligation found in file
"RTN","FBNHPC",6,0)
 ;           FB7078 for time period selected is from the same station selected
"RTN","FBNHPC",7,0)
 ;           during option process.  This is true for both monthly activity
"RTN","FBNHPC",8,0)
 ;           as well as carry over activity and Insufficient Authorization 
"RTN","FBNHPC",9,0)
 ;           Rate data on file
"RTN","FBNHPC",10,0)
 ;
"RTN","FBNHPC",11,0)
 S PRCS("TYPE")="FB",(FBNHCC,FBTOT)=0,PRCS("A")="Select Obligation Number: " K PRCS("X") D EN1^PRCS58 G:Y<0 Q S FBOBN=$P(Y,"^",2),FBSTA=PRC("SST")   ;FB*3.5*153
"RTN","FBNHPC",12,0)
 ;entry point for estimate report FBNHCC=1,(FBSEQ,FBOBN)=""
"RTN","FBNHPC",13,0)
EN1 I FBNHCC D STA^PRCSUT Q:'$D(PRC("SITE"))  S FBSTA=PRC("SST")     ;FB*3.5*153
"RTN","FBNHPC",14,0)
 S FBTOT=0,%DT=$S(FBNHCC:"AEPMX",1:"AEPMX"),%DT("A")=$S(FBNHCC:"Calculate ",1:"Post ")_"Commitments for which Month/Year: " D ^%DT G:X="^"!(X="") Q S FBPAYDT=$E(+Y,1,5)_"00",FBMM=$E(+Y,4,5),FBYY=$E(+Y,2,3),X=+Y D DAYS^FBAAUTL1 S FBDAYS=X
"RTN","FBNHPC",15,0)
 S VAR="FBOBN^FBPAYDT^FBMM^FBYY^FBDAYS^FBNHCC",VAL=FBOBN_"^"_FBPAYDT_"^"_FBMM_"^"_FBYY_"^"_FBDAYS_"^"_FBNHCC,PGM="START^FBNHPC" D ZIS^FBAAUTL G:FBPOP END
"RTN","FBNHPC",16,0)
 ;
"RTN","FBNHPC",17,0)
START K ^TMP($J,"FBNHPC") S (FBPAYEDT,FBENDDT)=$E(FBPAYDT,1,5)_FBDAYS,Q="",$P(Q,"=",80)="=",(FBTOT,FBTOTAL,FBOUT)=0 U IO W:$E(IOST,1,2)["C-" @IOF D HED^FBNHPC1
"RTN","FBNHPC",18,0)
 N FBCNT S FBCNT=0
"RTN","FBNHPC",19,0)
 S FBIFN=0,^XTMP("FBPOST",0)=$$CDTC^FBUCUTL(DT,1)_"^"_DT
"RTN","FBNHPC",20,0)
 F FBDD=FBPAYDT:0 S FBDD=$O(^FB7078("AD",7,FBDD)) Q:FBDD'>0!(FBOUT)  D
"RTN","FBNHPC",21,0)
 .F  S FBIFN=$O(^FB7078("AD",7,FBDD,FBIFN)) Q:'FBIFN!(FBOUT)  I $D(^FB7078(FBIFN,0)) S FBZ=^(0) I $P(FBZ,U,9)'="DC" S (FBHIFN,FB7078)=FBIFN,FBABD=$P(FBZ,"^",4),IFN=+$P(FBZ,"^",2),DFN=+$P(FBZ,"^",3) D
"RTN","FBNHPC",22,0)
 ..D L(FBIFN,1) I $G(FBLERR) S FBNAME=$$NAME^FBCHREQ2(DFN),FBSSN=$$SSN^FBAAUTL(DFN),Y="Another user is editing 7078." D ERR K FBLERR,Y W ! Q
"RTN","FBNHPC",23,0)
 ..I '$D(^XTMP("FBPOST",FBIFN)) D CHECK^FBNHPC1,L(FBIFN,2)
"RTN","FBNHPC",24,0)
 G END:FBOUT
"RTN","FBNHPC",25,0)
 D PRT^FBNHPC1
"RTN","FBNHPC",26,0)
 I $$WRT() W !!?10,"No funds currently need to be posted.",! G END
"RTN","FBNHPC",27,0)
Q W !!,?10,"Total ",$S(FBNHCC:"Estimated: ",1:"Posted: "),$J(FBTOT,10,2),?50,"Total Days: ",$S($D(FBTOTAL):FBTOTAL,1:0),!
"RTN","FBNHPC",28,0)
 ;
"RTN","FBNHPC",29,0)
END K FBMM,FBYY,FBDEFP,FBABD,FBPAYDT,FBDAYS,FBIFN,Z1,Z2,FBVCAR,FBCD,FBSEQ,FBOBN,FBNAME,FBSSN,FBPOSDT,FBNHCC,FBTOTAL,FBPAYEDT,FB7078,FBAABDT,FBX1,FBOUT,DFN,FBVEN,FBENDFLG,FBLERR
"RTN","FBNHPC",30,0)
 K %,%DT,DIC,FBDD,FBERR,FBTOT,IFN,PGM,Q,VAL,VAR,Z,FBEDT,FBENDDT,FBHIFN,FBRIFN,FBTDT,FBTRDYS,FBZ,FB,I,PRCS,Y,PRC,PRCSCPAN,X,X1,^TMP($J,"FBNHPC")
"RTN","FBNHPC",31,0)
 K FBSTA,FBOBIEN,FBOBNO,PRC23,FBPOP,FBCNT,FBHIN,FBMM
"RTN","FBNHPC",32,0)
 K ^XTMP("FBPOST") D CLOSE^FBAAUTL Q
"RTN","FBNHPC",33,0)
 ;
"RTN","FBNHPC",34,0)
WRT() ;determine if write to output
"RTN","FBNHPC",35,0)
 ;return 1 if nothing to post
"RTN","FBNHPC",36,0)
 Q $S('$G(FBTOT):1,'$G(FBTOTAL):1,1:0)
"RTN","FBNHPC",37,0)
 ;
"RTN","FBNHPC",38,0)
ERR W !!,*7,"Unable to Post the following transaction because of the following:",!,Y,!?7,FBNAME,?40,FBSSN I '$G(FBLERR) W ?60,"$"_$FN(FBDEFP,",",2)
"RTN","FBNHPC",39,0)
 Q
"RTN","FBNHPC",40,0)
 ;
"RTN","FBNHPC",41,0)
L(FBDA,FBL) ;lock/unlock 7078
"RTN","FBNHPC",42,0)
 ;INPUT:  FBDA = ien (fbifn) of 7078 file
"RTN","FBNHPC",43,0)
 ;        FBL = lock code:  1 to lock, 2 to unlock
"RTN","FBNHPC",44,0)
 ;OUTPUT:  no output variables; fb7078 entry will be locked or unlocked
"RTN","FBNHPC",45,0)
 N FBLCTR S FBLCTR=0
"RTN","FBNHPC",46,0)
L1 I $S('+$G(FBDA):1,'+$G(FBL):1,1:0) Q
"RTN","FBNHPC",47,0)
 I FBL=1 L +^FB7078(FBDA):2 I '$T S FBLCTR=FBLCTR+1 G:FBLCTR<5 L1 S FBLERR=1 Q
"RTN","FBNHPC",48,0)
 I FBL=2 K ^XTMP("FBPOST",FBDA) L -^FB7078(FBDA)
"RTN","FBNHPC",49,0)
 Q
"RTN","FBNHPC1")
0^4^B13879946^B11615342
"RTN","FBNHPC1",1,0)
FBNHPC1 ;AISC/CMR-POST COMMITMENTS TO 1358 cont. ;9/20/94
"RTN","FBNHPC1",2,0)
 ;;3.5;FEE BASIS;**153**;JAN 30, 1995;Build 14
"RTN","FBNHPC1",3,0)
 ;;Per VA Directive 6402, this routine should not be modified.
"RTN","FBNHPC1",4,0)
 ;
"RTN","FBNHPC1",5,0)
 ;FB*3.5*153 Added calls to tag 'CHKSITOB' to insure obligation found in file
"RTN","FBNHPC1",6,0)
 ;           FB7078 for time period selected is from the same station selected
"RTN","FBNHPC1",7,0)
 ;           during option process.  This is true for both monthly activity
"RTN","FBNHPC1",8,0)
 ;           as well as carry over activity and Insufficient Authorization 
"RTN","FBNHPC1",9,0)
 ;           Rate data on file
"RTN","FBNHPC1",10,0)
 ;
"RTN","FBNHPC1",11,0)
CHECK S ^XTMP("FBPOST",FBIFN)=""
"RTN","FBNHPC1",12,0)
 Q:$E(FBPAYDT,1,5)<$E(FBABD,1,5)
"RTN","FBNHPC1",13,0)
 S FBTRDYS=0 K FBELSE
"RTN","FBNHPC1",14,0)
 S FBERR=""  D CHKSITOB Q:$G(FBELSE)=1  D GETRAT^FBNHEP2 Q:FBERR  D CHECK^FBNHEP2 Q:FBERR  ;FB*3.5*153
"RTN","FBNHPC1",15,0)
 S FBIFN=FBHIFN
"RTN","FBNHPC1",16,0)
 D
"RTN","FBNHPC1",17,0)
 .I $E(FBABD,1,5)<$E(FBPAYDT,1,5)&($E(FBDD,1,5)>$E(FBPAYDT,1,5)) S FBTRDYS=FBDAYS D CALC Q
"RTN","FBNHPC1",18,0)
 .I $E(FBABD,1,5)<$E(FBPAYDT,1,5)&($E(FBDD,1,5)'>$E(FBPAYDT,1,5)) S FBTRDYS=$E(FBDD,6,7)-1,FBTRDYS=$S(FBTRDYS>0:FBTRDYS,1:0) S:FBTRDYS'>0 FBELSE=1 D CALC Q
"RTN","FBNHPC1",19,0)
 .I $E(FBABD,1,5)=$E(FBPAYDT,1,5)&($E(FBDD,1,5)>$E(FBPAYDT,1,5)) S FBTRDYS=(FBDAYS-$E(FBABD,6,7))+1 D CALC Q
"RTN","FBNHPC1",20,0)
 .I FBABD=FBDD S FBTRDYS=1 D CALC Q
"RTN","FBNHPC1",21,0)
 .I $E(FBABD,1,5)=$E(FBPAYDT,1,5)&($E(FBDD,1,5)'>$E(FBPAYDT,1,5)) S FBTRDYS=FBDD-FBABD,FBTRDYS=$S(FBTRDYS>0:FBTRDYS,1:0) S:FBTRDYS'>0 FBELSE=1 D CALC Q
"RTN","FBNHPC1",22,0)
 Q:$D(FBELSE)
"RTN","FBNHPC1",23,0)
 ;ifcap calls for posting
"RTN","FBNHPC1",24,0)
 I 'FBNHCC,$D(^PRC(424,"E",+$P(FBZ,"^",3)_";"_+FBIFN_";"_$P(FBOBN,"-",2)_";"_FBMM)) Q
"RTN","FBNHPC1",25,0)
 S FBSEQ="" I 'FBNHCC S X=FBOBN,PRCS("TYPE")="FB" D EN1^PRCSUT31 Q:Y=""  S FBSEQ=Y
"RTN","FBNHPC1",26,0)
 S DFN=$P(FBZ,"^",3),FBNAME=$$NAME^FBCHREQ2(DFN),FBSSN=$$SSN^FBAAUTL(DFN),FBVEN=$P(FBZ,"^",2)
"RTN","FBNHPC1",27,0)
 S PRCS("TYPE")="FB" I 'FBNHCC D NOW^%DTC S FBPOSDT=%,X=FBOBN_"^"_FBPOSDT_"^"_FBDEFP_"^^"_FBSEQ_"^"_FBNAME_"  ("_FBSSN_")"_"^"_+DFN_";"_+FBIFN_";"_$P(FBOBN,"-",2)_";"_FBMM D EN2^PRCS58
"RTN","FBNHPC1",28,0)
 I 'FBNHCC G:+Y=0 ERR^FBNHPC
"RTN","FBNHPC1",29,0)
 S FBTOTAL=FBTOTAL+FBTRDYS,FBTOT=FBTOT+FBDEFP,FBCNT=FBCNT+1
"RTN","FBNHPC1",30,0)
 S ^TMP($J,"FBNHPC",FBNAME,FBCNT)=FBSSN_"^"_FBTRDYS_"^"_FBDEFP_"^"_$G(FBSEQ)_"^"_+FBVEN
"RTN","FBNHPC1",31,0)
 Q
"RTN","FBNHPC1",32,0)
 ;
"RTN","FBNHPC1",33,0)
PRT S FBNAME="" F  S FBNAME=$O(^TMP($J,"FBNHPC",FBNAME)) Q:FBNAME']""!($G(FBOUT))  F FBCNT=0:0 S FBCNT=$O(^TMP($J,"FBNHPC",FBNAME,FBCNT)) Q:'FBCNT!($G(FBOUT))  D
"RTN","FBNHPC1",34,0)
 .S Y(0)=$G(^TMP($J,"FBNHPC",FBNAME,FBCNT)),FBSSN=$P(Y(0),"^"),FBTRDYS=$P(Y(0),"^",2),FBDEFP=$P(Y(0),"^",3),FBSEQ=$P(Y(0),"^",4),FBVEN=$P(Y(0),"^",5)
"RTN","FBNHPC1",35,0)
 .I $Y+3>IOSL,$E(IOST,1,2)["C-" S DIR(0)="E" D ^DIR K DIR S:'Y FBOUT=1 Q:FBOUT
"RTN","FBNHPC1",36,0)
 .I ($Y+3)>IOSL W @IOF D HED
"RTN","FBNHPC1",37,0)
 .W !,FBSEQ,?7,$E(FBNAME,1,20),?30,FBSSN,?44,$E($$VNAME^FBNHEXP(FBVEN),1,20),?66,FBTRDYS,?70,$J($FN(FBDEFP,",",2),10)
"RTN","FBNHPC1",38,0)
 Q
"RTN","FBNHPC1",39,0)
 ;
"RTN","FBNHPC1",40,0)
HED W !?11,"C O M M U N I T Y   N U R S I N G   H O M E   R E P O R T",!
"RTN","FBNHPC1",41,0)
 S I="",$P(I,"-",59)="-" W ?10,I K I W !
"RTN","FBNHPC1",42,0)
 I FBNHCC W ?5,"Estimated Funds for: ",$P("Jan^Feb^Mar^Apr^May^Jun^Jul^Aug^Sep^Oct^Nov^Dec","^",+FBMM)," ",FBYY,!!
"RTN","FBNHPC1",43,0)
 I 'FBNHCC W ?5,"Postings for Obligation Number: ",$P(FBOBN,"-",2),!!,"Ref #"
"RTN","FBNHPC1",44,0)
 W ?7,"Veteran",?30,"SSN",?44,"Vendor",?65,"Days",?74,"Total",!,Q,!
"RTN","FBNHPC1",45,0)
 Q
"RTN","FBNHPC1",46,0)
 ;
"RTN","FBNHPC1",47,0)
CALC S FBENDFLG=$S(FBDD'>FBENDDT:1,1:""),FBENDDT=$S(FBDD>FBENDDT:FBENDDT,1:FBDD),FBAABDT=FBABD D CALC^FBNHEP2
"RTN","FBNHPC1",48,0)
 S FBENDDT=FBPAYEDT K FB
"RTN","FBNHPC1",49,0)
 Q
"RTN","FBNHPC1",50,0)
 ;FB*3.5*153
"RTN","FBNHPC1",51,0)
CHKSITOB ;INSURE ENTRY IS FOR CORRECT SITE/OBLIGATION
"RTN","FBNHPC1",52,0)
 S FBOBNO=$E($P(FBZ,U),1,6)
"RTN","FBNHPC1",53,0)
 S FBOBIEN=$O(^PRC(442,"B",PRC("SITE")_"-"_FBOBNO,0)) I FBOBIEN="" S FBELSE=1 Q
"RTN","FBNHPC1",54,0)
 S PRC23=$G(^PRC(442,FBOBIEN,23)) I PRC23="" S FBELSE=1 Q
"RTN","FBNHPC1",55,0)
 I $P(PRC23,U,7)'=FBSTA S FBELSE=1 Q
"RTN","FBNHPC1",56,0)
 Q
"RTN","FBUCEN")
0^2^B27715243^B26341993
"RTN","FBUCEN",1,0)
FBUCEN ;ALBISC/TET - ENTER UNAUTHORIZED CLAIM ; 4/9/10 11:25am
"RTN","FBUCEN",2,0)
 ;;3.5;FEE BASIS;**32,61,114,153**;JAN 30, 1995;Build 14
"RTN","FBUCEN",3,0)
 ;;Per VA Directive 6402, this routine should not be modified.
"RTN","FBUCEN",4,0)
 ;
"RTN","FBUCEN",5,0)
 ;FB*3.5*153 Insure the response to the Millenium Act 38
"RTN","FBUCEN",6,0)
 ;           U.S.C. 1725 for Y/N is set to 1/0 in field 
"RTN","FBUCEN",7,0)
 ;           #31 of file 162.7.
"RTN","FBUCEN",8,0)
 ;
"RTN","FBUCEN",9,0)
 ;FBUC - unauthorized claims site parameter node
"RTN","FBUCEN",10,0)
 ;FBTRACK - 1 to track incomplete claims, 0 to track complete claims only
"RTN","FBUCEN",11,0)
 ;FBUCP - 0 to not automatically print letters, otherwise default device
"RTN","FBUCEN",12,0)
 ;FBOK - 0 if claim is incomplete, 1 if claim is complete.
"RTN","FBUCEN",13,0)
 ;FBACT - ENT for enter (fbact represents action type)
"RTN","FBUCEN",14,0)
 ;FBINENT = initial entry parameter: 1 if using, 0 if not
"RTN","FBUCEN",15,0)
 S FBOUT=0,FBUC=$$FBUC^FBUCUTL2(1),FBTRACK=+$P(FBUC,U),FBOK=$S('FBTRACK:1,1:0),FBACT="ENT",FBINENT=+$P(FBUC,U,7)
"RTN","FBUCEN",16,0)
GET ;get info on new claim entry
"RTN","FBUCEN",17,0)
 K FBVEN,FBVET
"RTN","FBUCEN",18,0)
VET ;get vet info
"RTN","FBUCEN",19,0)
 N DIR,DA W !! S DIR(0)="162.7,2O",DIR("A")="Select VETERAN" D ^DIR K DIR,DA G END:$D(DIRUT),VET:+Y'>0 S FBVET=+Y
"RTN","FBUCEN",20,0)
VEN ;get vendor info
"RTN","FBUCEN",21,0)
 N DIR,DA S DIR(0)="162.7,1O",DIR("A")="Select FEE VENDOR" D ^DIR K DIR,DA G VET:$D(DUOUT)!($D(DTOUT)),VEN:+Y<0,VEN:+Y=0&('FBINENT) S FBVEN=+Y
"RTN","FBUCEN",22,0)
PROG N DIC,DA S DIC="^FBAA(161.8,",DIC(0)="AEQMZ",DIC("S")="I +$P(^(0),U,3)" D ^DIC K DIC,DA S:$D(DTOUT)!($D(DUOUT)) FBOUT=1 G END:FBOUT,GET:Y<0 S FBPR=+Y D  S:FBOUT FBOUT=0 G VET
"RTN","FBUCEN",23,0)
 .N FBDA,FBMASTER,FBORDER,FBTFROM,FBTTO,FB1725,FBFPPSC
"RTN","FBUCEN",24,0)
 .; ask if claim is an EDI claim (patch *61)
"RTN","FBUCEN",25,0)
 .S FBFPPSC=$$FPPSC^FBUTL5() I FBFPPSC=-1 S FBFPPSC="",FBOUT=1 Q
"RTN","FBUCEN",26,0)
 .; ask if claim is a mill bill emergency care claim (patch *32)
"RTN","FBUCEN",27,0)
 .S DIR(0)="Y"
"RTN","FBUCEN",28,0)
 .S DIR("A")="Is this claim being considered under Millennium Act 38 U.S.C. 1725 (Y/N)"
"RTN","FBUCEN",29,0)
 .D ^DIR K DIR I $D(DIRUT) S FBOUT=1 Q
"RTN","FBUCEN",30,0)
 .S FB1725=+Y     ;FB*3.5*153
"RTN","FBUCEN",31,0)
 .D ASKDT Q:FBOUT  I FBTRACK,'FBINENT D  Q:FBOUT
"RTN","FBUCEN",32,0)
 ..S DIR(0)="Y",DIR("A")="Is the unauthorized claim complete for the FEE PROGRAM" D DIRQ,^DIR K DIR S:$D(DIRUT) FBOUT=1 S:'FBOUT FBOK=Y Q:FBOUT!(FBOK)
"RTN","FBUCEN",33,0)
 ..D REQ^FBUCPEND Q:FBOUT  S FBORDER=10 ;display/select pending information,set status order to incomplete if selected pending items
"RTN","FBUCEN",34,0)
 .;check for duplicates
"RTN","FBUCEN",35,0)
 .I 'FBINENT W !,"Checking for potential duplicates...",! H 1 D ^FBUCDUP
"RTN","FBUCEN",36,0)
 .W !!,"Checking eligibility...",! H 1 S DFN=FBVET D ELIG^VADPT W:VAEL(4)'=1 !,"Patient is not a veteran.",*7 D ELIG^FBAADEM K VAEL,VAERR
"RTN","FBUCEN",37,0)
 .W ! S DIR("A")="Are you sure you wish to enter a new unauthorized claim",DIR(0)="Y" D ^DIR K DIR S:'Y!($D(DIRUT)) FBOUT=1 Q:FBOUT
"RTN","FBUCEN",38,0)
 .;file new claim
"RTN","FBUCEN",39,0)
 .S DIC="^FB583(",DIC(0)="Z",X=DT K DD,DO D FILE^DICN S FBOUT=$S($P(Y,U,3):0,1:1) Q:FBOUT  S FBDA=+Y D PRIOR^FBUCEVT(FBDA,FBACT) D
"RTN","FBUCEN",40,0)
 ..S FBMASTER=FBDA,FBORDER=$S(+$G(FBORDER)=10:10,'FBINENT:30,1:5)
"RTN","FBUCEN",41,0)
 ..S DIE=DIC,DIE("NO^")="BACKOUTOK",DR="[FB UNAUTHORIZED ENTER]",DA=FBDA
"RTN","FBUCEN",42,0)
 ..D LOCK^FBUCUTL(DIE,DA,1) S:'FBLOCK FBOUT=1 Q:FBOUT  D ^DIE L -^FB583(FBDA) K DA,DIE,DQ,DR,FBLOCK I $D(Y)!($D(DTOUT)) S DIK=DIC,DA=FBDA D ^DIK K DIK W !,"... Deleting incomplete record.",*7 S FBOUT=1 Q
"RTN","FBUCEN",43,0)
 ..I FBORDER=10 D FREQ^FBUCPEND ;file requested info
"RTN","FBUCEN",44,0)
 ..K ^TMP("FBARY",$J),^TMP("FBAR",$J)
"RTN","FBUCEN",45,0)
 .D AFTER^FBUCEVT(FBDA,FBACT)
"RTN","FBUCEN",46,0)
 .K FBARY,FBLOCK Q:FBOUT  D ENTER^FBUCLNK1(FBDA,FBUCA,1) K FBARY,^TMP("FBARY",$J),^TMP("FBAR",$J)
"RTN","FBUCEN",47,0)
 .I FBORDER'=10,+$G(FBVEN)>0,+$G(FBTTO)>0 D AFTER^FBUCEVT(FBDA,FBACT),EN^FBUCEN1(FBUCA,FBDA) ;if claim complete, check if group, any in group dispositioned
"RTN","FBUCEN",48,0)
 .;do update
"RTN","FBUCEN",49,0)
 .D AFTER^FBUCEVT(FBDA,FBACT),^FBUCUPD(FBUCP,FBUCPA,FBUCA,FBUCAA,FBDA,FBACT)
"RTN","FBUCEN",50,0)
 ;
"RTN","FBUCEN",51,0)
END ;kill and quit
"RTN","FBUCEN",52,0)
 K DA,DFN,DIC,DIE,DIR,DIRUT,DQ,DR,DTOUT,DUOUT,FBACT,FBARY,FBDA,FBDISP,FBINENT,FBLOCK,FBMASTER,FBOK,FBORDER,FBOUT,FBPEND,FBPI,FBPR,FBPROG
"RTN","FBUCEN",53,0)
 K FBSTATUS,FBTFROM,FBTRACK,FBTTO,FBUC,FBUCA,FBUCP,FBUCAA,FBUCP,FBUCPA,FBVEN,FBVET,X,Y,^TMP("FBAR",$J),^TMP("FBARY",$J)
"RTN","FBUCEN",54,0)
 Q
"RTN","FBUCEN",55,0)
ASKDT ;ask treatment from/to dates
"RTN","FBUCEN",56,0)
 S DIR(0)="162.7,3" S:FBPR=6 DIR("A")="ADMISSION DATE" D ^DIR K DIR S:'+Y DIRUT="^" S:$D(DIRUT) FBOUT=1 S:'FBOUT FBTFROM=Y
"RTN","FBUCEN",57,0)
 I 'FBOUT S DIR(0)="162.7,4O" S:FBPR=6 DIR("A")="DISCHARGE DATE" S:FBPR'=6&(FBPR'=7) DIR("B")=$$DATX^FBAAUTL(FBTFROM) D ^DIR K DIR S:$D(DUOUT)!($D(DTOUT)) FBOUT=1 I 'FBOUT,'FBINENT G:+Y'>0!(FBTFROM>Y) ASKDT S FBTTO=Y
"RTN","FBUCEN",58,0)
 I 'FBOUT S FBTTO=+Y
"RTN","FBUCEN",59,0)
 Q
"RTN","FBUCEN",60,0)
HELP ;help text for complete claim question - ??
"RTN","FBUCEN",61,0)
 W !?10,"An unauthorized claim is considered complete (or valid)"
"RTN","FBUCEN",62,0)
 W !?10,"if all the necessary information has been received."
"RTN","FBUCEN",63,0)
 W !?10,"A claim can never be considered complete if it is missing"
"RTN","FBUCEN",64,0)
 W !?10,"form 10-583 or form 10-583 is incomplete."
"RTN","FBUCEN",65,0)
 W !?10,"Some examples of other items which are needed are:"
"RTN","FBUCEN",66,0)
 W !?20,"Copies of actual bills",!?20,"Original paid receipt"
"RTN","FBUCEN",67,0)
 W !?20,"Itemized invoice/UB82",!?20,"Medical records or signature for release"
"RTN","FBUCEN",68,0)
 W !?20,"Diagnostic/Procedure code(s)",!
"RTN","FBUCEN",69,0)
 Q
"RTN","FBUCEN",70,0)
DIRQ ;set dir(?,#)
"RTN","FBUCEN",71,0)
 S DIR("?")="Enter Y(es) if complete, N(o) if incomplete."
"RTN","FBUCEN",72,0)
 S DIR("??")="^D HELP^FBUCEN"
"RTN","FBUCEN",73,0)
 S DIR("?",1)="Enter Y(es) if all required information has been submitted,"
"RTN","FBUCEN",74,0)
 S DIR("?",2)="      N(o)  if the claim is incomplete."
"RTN","FBUCEN",75,0)
 S DIR("?",3)=""
"RTN","FBUCEN",76,0)
 Q
"VER")
8.0^22.0
"BLD",9612,6)
^132
**END**
**END**

