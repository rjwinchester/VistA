Released FB*3.5*163 SEQ #145
Extracted from mail message
**KIDS**:FB*3.5*163^

**INSTALL NAME**
FB*3.5*163
"BLD",9718,0)
FB*3.5*163^FEE BASIS^0^3160906^y
"BLD",9718,1,0)
^^56^56^3151118^^^
"BLD",9718,1,1,0)
This National Patch consists of FEE BASIS enhancements related to the 
"BLD",9718,1,2,0)
following NSRs:
"BLD",9718,1,3,0)
 
"BLD",9718,1,4,0)
NSR ##20110304 - Service Connected Decision
"BLD",9718,1,5,0)
 
"BLD",9718,1,6,0)
The Fee-Revenue Service Connected (SC) Condition Decision project will 
"BLD",9718,1,7,0)
enhance the interface between the Integrated Billing (IB) and Fee Basis
"BLD",9718,1,8,0)
(FB) Veterans Health Information Systems and Technology Architecture 
"BLD",9718,1,9,0)
(VistA) applications by automating the transfer of data elements 
"BLD",9718,1,10,0)
received from Non-Department of Veterans Affairs (VA) providers which 
"BLD",9718,1,11,0)
are necessary for third party billing.
"BLD",9718,1,12,0)
 
"BLD",9718,1,13,0)
The proposed enhancement seeks modifications the FB application's 
"BLD",9718,1,14,0)
Potential Cost Recovery Report (PCRR) to ensure that all Non-VA Care 
"BLD",9718,1,15,0)
billed line item charges are included, regardless of responses entered
"BLD",9718,1,16,0)
in the FB software by Fee Clerks." By removing the report filtering
"BLD",9718,1,17,0)
that pertains to the SC Condition and Potential Cost Recovery data 
"BLD",9718,1,18,0)
values, line item charges previously excluded based on responses to 
"BLD",9718,1,19,0)
POTENTIAL COST RECOVERY and SC CONDITION prompts in FB all Non-VA 
"BLD",9718,1,20,0)
care billed line item charges will appear on the PCRR, enabling the 
"BLD",9718,1,21,0)
Revenue Staff to optimize cost recovery. 
"BLD",9718,1,22,0)
 
"BLD",9718,1,23,0)
NSR #20081010 - Billing Precertification Enhancements
"BLD",9718,1,24,0)
 
"BLD",9718,1,25,0)
Typically, Department of Veterans Affairs (VA) facilities are able to 
"BLD",9718,1,26,0)
provide all of the necessary medical care and services required by its
"BLD",9718,1,27,0)
patients. However, there are times when the Veteran is not able to 
"BLD",9718,1,28,0)
access VA health care facilities based on geographic constraints, due 
"BLD",9718,1,29,0)
to medical emergencies, or because it is economically advantageous to 
"BLD",9718,1,30,0)
provide treatment in the community. In these cases, the VA may 
"BLD",9718,1,31,0)
authorize medical care at private-sector facilities for those Veterans
"BLD",9718,1,32,0)
who meet the eligibility requirements. This concept is referred to as
"BLD",9718,1,33,0)
FEE BASIS (FB) (or Non-VA) care.
"BLD",9718,1,34,0)
 
"BLD",9718,1,35,0)
Regardless of where the care is provided, precertification is often a 
"BLD",9718,1,36,0)
prerequisite for certain services before payment is issued by insurance
"BLD",9718,1,37,0)
companies. Precertification is the process of obtaining approval from
"BLD",9718,1,38,0)
the Veteran's private insurance health plan for routine hospital 
"BLD",9718,1,39,0)
inpatient admissions or outpatient visits prior to the delivery of 
"BLD",9718,1,40,0)
health care. Currently, Medical Care Collections Fund (MCCF) Staff is 
"BLD",9718,1,41,0)
not notified of scheduled VA-provided outpatient services requiring 
"BLD",9718,1,42,0)
precertification. Notification regarding authorized 
"BLD",9718,1,43,0)
nonservice-connected FB care is received after treatment has been 
"BLD",9718,1,44,0)
rendered. As a result, VA Medical Centers (VAMCs) often miss 
"BLD",9718,1,45,0)
opportunities to be reimbursed by insurance companies for care due to 
"BLD",9718,1,46,0)
the lack of obtaining timely precertification.
"BLD",9718,1,47,0)
 
"BLD",9718,1,48,0)
The goal of this project is to assist the VAMCs in obtaining timely p
"BLD",9718,1,49,0)
recertification from third party payers before care is rendered by 
"BLD",9718,1,50,0)
notifying the appropriate staff as soon as VA-provided outpatient 
"BLD",9718,1,51,0)
services requiring precertification are scheduled and authorizations 
"BLD",9718,1,52,0)
are created in the Veterans Health Information Systems and Technology 
"BLD",9718,1,53,0)
Architecture (VistA) Fee Package for inpatient or outpatient care. This
"BLD",9718,1,54,0)
would also provide an opportunity for insurance identification/ 
"BLD",9718,1,55,0)
verification processes (either internally or externally/outsourced) to 
"BLD",9718,1,56,0)
be completed prior to treatment.
"BLD",9718,4,0)
^9.64PA^161.43^2
"BLD",9718,4,161,0)
161
"BLD",9718,4,161,2,0)
^9.641^161.01^1
"BLD",9718,4,161,2,161.01,0)
AUTHORIZATION  (sub-file)
"BLD",9718,4,161,2,161.01,1,0)
^9.6411^.01^1
"BLD",9718,4,161,2,161.01,1,.01,0)
FROM DATE
"BLD",9718,4,161,222)
y^n^p^^^^n^^n
"BLD",9718,4,161,224)

"BLD",9718,4,161.43,0)
161.43
"BLD",9718,4,161.43,2,0)
^9.641^161.43^1
"BLD",9718,4,161.43,2,161.43,0)
FEE BASIS CONTRACT  (File-top level)
"BLD",9718,4,161.43,2,161.43,1,0)
^9.6411^5^2
"BLD",9718,4,161.43,2,161.43,1,4,0)
CHOICE INDICATOR
"BLD",9718,4,161.43,2,161.43,1,5,0)
CHOICE PROVIDER AGREEMENT
"BLD",9718,4,161.43,222)
y^n^p^^^^n^^n
"BLD",9718,4,161.43,224)

"BLD",9718,4,"APDD",161,161.01)

"BLD",9718,4,"APDD",161,161.01,.01)

"BLD",9718,4,"APDD",161.43,161.43)

"BLD",9718,4,"APDD",161.43,161.43,4)

"BLD",9718,4,"APDD",161.43,161.43,5)

"BLD",9718,4,"B",161,161)

"BLD",9718,4,"B",161.43,161.43)

"BLD",9718,6.3)
21
"BLD",9718,"ABPKG")
n
"BLD",9718,"KRN",0)
^9.67PA^779.2^20
"BLD",9718,"KRN",.4,0)
.4
"BLD",9718,"KRN",.4,"NM",0)
^9.68A^^
"BLD",9718,"KRN",.401,0)
.401
"BLD",9718,"KRN",.402,0)
.402
"BLD",9718,"KRN",.403,0)
.403
"BLD",9718,"KRN",.5,0)
.5
"BLD",9718,"KRN",.84,0)
.84
"BLD",9718,"KRN",3.6,0)
3.6
"BLD",9718,"KRN",3.8,0)
3.8
"BLD",9718,"KRN",9.2,0)
9.2
"BLD",9718,"KRN",9.2,"NM",0)
^9.68A^^
"BLD",9718,"KRN",9.8,0)
9.8
"BLD",9718,"KRN",9.8,"NM",0)
^9.68A^21^6
"BLD",9718,"KRN",9.8,"NM",16,0)
FBAACFE^^0^B2043443
"BLD",9718,"KRN",9.8,"NM",17,0)
FBPCR^^0^B129969114
"BLD",9718,"KRN",9.8,"NM",18,0)
FBPCR2^^0^B114347873
"BLD",9718,"KRN",9.8,"NM",19,0)
FBPCR3^^0^B30358812
"BLD",9718,"KRN",9.8,"NM",20,0)
FBPCR67^^0^B34734633
"BLD",9718,"KRN",9.8,"NM",21,0)
FBPCR671^^0^B51983526
"BLD",9718,"KRN",9.8,"NM","B","FBAACFE",16)

"BLD",9718,"KRN",9.8,"NM","B","FBPCR",17)

"BLD",9718,"KRN",9.8,"NM","B","FBPCR2",18)

"BLD",9718,"KRN",9.8,"NM","B","FBPCR3",19)

"BLD",9718,"KRN",9.8,"NM","B","FBPCR67",20)

"BLD",9718,"KRN",9.8,"NM","B","FBPCR671",21)

"BLD",9718,"KRN",19,0)
19
"BLD",9718,"KRN",19,"NM",0)
^9.68A^^0
"BLD",9718,"KRN",19.1,0)
19.1
"BLD",9718,"KRN",101,0)
101
"BLD",9718,"KRN",101,"NM",0)
^9.68A^^0
"BLD",9718,"KRN",409.61,0)
409.61
"BLD",9718,"KRN",409.61,"NM",0)
^9.68A^^0
"BLD",9718,"KRN",771,0)
771
"BLD",9718,"KRN",771,"NM",0)
^9.68A^^
"BLD",9718,"KRN",779.2,0)
779.2
"BLD",9718,"KRN",870,0)
870
"BLD",9718,"KRN",8989.51,0)
8989.51
"BLD",9718,"KRN",8989.52,0)
8989.52
"BLD",9718,"KRN",8994,0)
8994
"BLD",9718,"KRN","B",.4,.4)

"BLD",9718,"KRN","B",.401,.401)

"BLD",9718,"KRN","B",.402,.402)

"BLD",9718,"KRN","B",.403,.403)

"BLD",9718,"KRN","B",.5,.5)

"BLD",9718,"KRN","B",.84,.84)

"BLD",9718,"KRN","B",3.6,3.6)

"BLD",9718,"KRN","B",3.8,3.8)

"BLD",9718,"KRN","B",9.2,9.2)

"BLD",9718,"KRN","B",9.8,9.8)

"BLD",9718,"KRN","B",19,19)

"BLD",9718,"KRN","B",19.1,19.1)

"BLD",9718,"KRN","B",101,101)

"BLD",9718,"KRN","B",409.61,409.61)

"BLD",9718,"KRN","B",771,771)

"BLD",9718,"KRN","B",779.2,779.2)

"BLD",9718,"KRN","B",870,870)

"BLD",9718,"KRN","B",8989.51,8989.51)

"BLD",9718,"KRN","B",8989.52,8989.52)

"BLD",9718,"KRN","B",8994,8994)

"BLD",9718,"QDEF")
^^^^NO^^^^^^YES
"BLD",9718,"QUES",0)
^9.62^^
"BLD",9718,"REQB",0)
^9.611^8^7
"BLD",9718,"REQB",1,0)
FB*3.5*148^1
"BLD",9718,"REQB",2,0)
IB*2.0*554^1
"BLD",9718,"REQB",4,0)
FB*3.5*135^1
"BLD",9718,"REQB",5,0)
FB*3.5*133^1
"BLD",9718,"REQB",6,0)
FB*3.5*98^1
"BLD",9718,"REQB",7,0)
FB*3.5*108^1
"BLD",9718,"REQB",8,0)
FB*3.5*154^1
"BLD",9718,"REQB","B","FB*3.5*108",7)

"BLD",9718,"REQB","B","FB*3.5*133",5)

"BLD",9718,"REQB","B","FB*3.5*135",4)

"BLD",9718,"REQB","B","FB*3.5*148",1)

"BLD",9718,"REQB","B","FB*3.5*154",8)

"BLD",9718,"REQB","B","FB*3.5*98",6)

"BLD",9718,"REQB","B","IB*2.0*554",2)

"FIA",161)
FEE BASIS PATIENT
"FIA",161,0)
^FBAAA(
"FIA",161,0,0)
161P
"FIA",161,0,1)
y^n^p^^^^n^^n
"FIA",161,0,10)

"FIA",161,0,11)

"FIA",161,0,"RLRO")

"FIA",161,0,"VR")
3.5^FB
"FIA",161,161)
1
"FIA",161,161,1)

"FIA",161,161.01)
1
"FIA",161,161.01,.01)

"FIA",161.43)
FEE BASIS CONTRACT
"FIA",161.43,0)
^FBAA(161.43,
"FIA",161.43,0,0)
161.43I
"FIA",161.43,0,1)
y^n^p^^^^n^^n
"FIA",161.43,0,10)

"FIA",161.43,0,11)

"FIA",161.43,0,"RLRO")

"FIA",161.43,0,"VR")
3.5^FB
"FIA",161.43,161.43)
1
"FIA",161.43,161.43,4)

"FIA",161.43,161.43,5)

"IX",161,161.01,"AMRA",0)
161.01^AMRA^This index deletes associated MRAs when the Authorization is deleted.^MU^^R^^I^161.01^^^^^A
"IX",161,161.01,"AMRA",.1,0)
^^2^2^3150425^^
"IX",161,161.01,"AMRA",.1,1,0)
This index deletes associated MRAs in the MRA TRANSMISSION (#161.26) file 
"IX",161,161.01,"AMRA",.1,2,0)
when the authorization is deleted.
"IX",161,161.01,"AMRA",1)
Q
"IX",161,161.01,"AMRA",1.4)

"IX",161,161.01,"AMRA",2)
D:X2(1)="" DELB^FBUCDD2(.DA)
"IX",161,161.01,"AMRA",2.4)

"IX",161,161.01,"AMRA",11.1,0)
^.114IA^1^1
"IX",161,161.01,"AMRA",11.1,1,0)
1^F^161.01^.01^^^F
"IX",161,161.01,"AUD",0)
161.01^AUD^This index populates the DATA AUDIT multiple.^MU^^R^^I^161.01^^^^^A
"IX",161,161.01,"AUD",.1,0)
^^3^3^3140203^
"IX",161,161.01,"AUD",.1,1,0)
This cross reference audits selected fields.  The DATA AUDIT multiple is
"IX",161,161.01,"AUD",.1,2,0)
populated by this cross reference.  Routine FBAAAUD must be updated if 
"IX",161,161.01,"AUD",.1,3,0)
the list of fields in this cross-reference is modified.
"IX",161,161.01,"AUD",1)
D AUD^FBAAAUD(1)
"IX",161,161.01,"AUD",2)
D AUD^FBAAAUD(0)
"IX",161,161.01,"AUD",11.1,0)
^.114IA^5^5
"IX",161,161.01,"AUD",11.1,1,0)
1^F^161.01^.01^^^F
"IX",161,161.01,"AUD",11.1,2,0)
2^F^161.01^.02^^^F
"IX",161,161.01,"AUD",11.1,3,0)
3^F^161.01^.06^^^F
"IX",161,161.01,"AUD",11.1,4,0)
4^F^161.01^.07^^^F
"IX",161,161.01,"AUD",11.1,5,0)
5^F^161.01^.095^^^F
"MBREQ")
0
"PKG",60,-1)
1^1
"PKG",60,0)
FEE BASIS^FB^Used to pay private vendors
"PKG",60,20,0)
^9.402P^1^1
"PKG",60,20,1,0)
2^^FBPMRG
"PKG",60,20,1,1)

"PKG",60,20,"B",2,1)

"PKG",60,22,0)
^9.49I^1^1
"PKG",60,22,1,0)
3.5^2950130^2950313
"PKG",60,22,1,"PAH",1,0)
163^3160906^101114
"PKG",60,22,1,"PAH",1,1,0)
^^56^56^3160906
"PKG",60,22,1,"PAH",1,1,1,0)
This National Patch consists of FEE BASIS enhancements related to the 
"PKG",60,22,1,"PAH",1,1,2,0)
following NSRs:
"PKG",60,22,1,"PAH",1,1,3,0)
 
"PKG",60,22,1,"PAH",1,1,4,0)
NSR ##20110304 - Service Connected Decision
"PKG",60,22,1,"PAH",1,1,5,0)
 
"PKG",60,22,1,"PAH",1,1,6,0)
The Fee-Revenue Service Connected (SC) Condition Decision project will 
"PKG",60,22,1,"PAH",1,1,7,0)
enhance the interface between the Integrated Billing (IB) and Fee Basis
"PKG",60,22,1,"PAH",1,1,8,0)
(FB) Veterans Health Information Systems and Technology Architecture 
"PKG",60,22,1,"PAH",1,1,9,0)
(VistA) applications by automating the transfer of data elements 
"PKG",60,22,1,"PAH",1,1,10,0)
received from Non-Department of Veterans Affairs (VA) providers which 
"PKG",60,22,1,"PAH",1,1,11,0)
are necessary for third party billing.
"PKG",60,22,1,"PAH",1,1,12,0)
 
"PKG",60,22,1,"PAH",1,1,13,0)
The proposed enhancement seeks modifications the FB application's 
"PKG",60,22,1,"PAH",1,1,14,0)
Potential Cost Recovery Report (PCRR) to ensure that all Non-VA Care 
"PKG",60,22,1,"PAH",1,1,15,0)
billed line item charges are included, regardless of responses entered
"PKG",60,22,1,"PAH",1,1,16,0)
in the FB software by Fee Clerks." By removing the report filtering
"PKG",60,22,1,"PAH",1,1,17,0)
that pertains to the SC Condition and Potential Cost Recovery data 
"PKG",60,22,1,"PAH",1,1,18,0)
values, line item charges previously excluded based on responses to 
"PKG",60,22,1,"PAH",1,1,19,0)
POTENTIAL COST RECOVERY and SC CONDITION prompts in FB all Non-VA 
"PKG",60,22,1,"PAH",1,1,20,0)
care billed line item charges will appear on the PCRR, enabling the 
"PKG",60,22,1,"PAH",1,1,21,0)
Revenue Staff to optimize cost recovery. 
"PKG",60,22,1,"PAH",1,1,22,0)
 
"PKG",60,22,1,"PAH",1,1,23,0)
NSR #20081010 - Billing Precertification Enhancements
"PKG",60,22,1,"PAH",1,1,24,0)
 
"PKG",60,22,1,"PAH",1,1,25,0)
Typically, Department of Veterans Affairs (VA) facilities are able to 
"PKG",60,22,1,"PAH",1,1,26,0)
provide all of the necessary medical care and services required by its
"PKG",60,22,1,"PAH",1,1,27,0)
patients. However, there are times when the Veteran is not able to 
"PKG",60,22,1,"PAH",1,1,28,0)
access VA health care facilities based on geographic constraints, due 
"PKG",60,22,1,"PAH",1,1,29,0)
to medical emergencies, or because it is economically advantageous to 
"PKG",60,22,1,"PAH",1,1,30,0)
provide treatment in the community. In these cases, the VA may 
"PKG",60,22,1,"PAH",1,1,31,0)
authorize medical care at private-sector facilities for those Veterans
"PKG",60,22,1,"PAH",1,1,32,0)
who meet the eligibility requirements. This concept is referred to as
"PKG",60,22,1,"PAH",1,1,33,0)
FEE BASIS (FB) (or Non-VA) care.
"PKG",60,22,1,"PAH",1,1,34,0)
 
"PKG",60,22,1,"PAH",1,1,35,0)
Regardless of where the care is provided, precertification is often a 
"PKG",60,22,1,"PAH",1,1,36,0)
prerequisite for certain services before payment is issued by insurance
"PKG",60,22,1,"PAH",1,1,37,0)
companies. Precertification is the process of obtaining approval from
"PKG",60,22,1,"PAH",1,1,38,0)
the Veteran's private insurance health plan for routine hospital 
"PKG",60,22,1,"PAH",1,1,39,0)
inpatient admissions or outpatient visits prior to the delivery of 
"PKG",60,22,1,"PAH",1,1,40,0)
health care. Currently, Medical Care Collections Fund (MCCF) Staff is 
"PKG",60,22,1,"PAH",1,1,41,0)
not notified of scheduled VA-provided outpatient services requiring 
"PKG",60,22,1,"PAH",1,1,42,0)
precertification. Notification regarding authorized 
"PKG",60,22,1,"PAH",1,1,43,0)
nonservice-connected FB care is received after treatment has been 
"PKG",60,22,1,"PAH",1,1,44,0)
rendered. As a result, VA Medical Centers (VAMCs) often miss 
"PKG",60,22,1,"PAH",1,1,45,0)
opportunities to be reimbursed by insurance companies for care due to 
"PKG",60,22,1,"PAH",1,1,46,0)
the lack of obtaining timely precertification.
"PKG",60,22,1,"PAH",1,1,47,0)
 
"PKG",60,22,1,"PAH",1,1,48,0)
The goal of this project is to assist the VAMCs in obtaining timely p
"PKG",60,22,1,"PAH",1,1,49,0)
recertification from third party payers before care is rendered by 
"PKG",60,22,1,"PAH",1,1,50,0)
notifying the appropriate staff as soon as VA-provided outpatient 
"PKG",60,22,1,"PAH",1,1,51,0)
services requiring precertification are scheduled and authorizations 
"PKG",60,22,1,"PAH",1,1,52,0)
are created in the Veterans Health Information Systems and Technology 
"PKG",60,22,1,"PAH",1,1,53,0)
Architecture (VistA) Fee Package for inpatient or outpatient care. This
"PKG",60,22,1,"PAH",1,1,54,0)
would also provide an opportunity for insurance identification/ 
"PKG",60,22,1,"PAH",1,1,55,0)
verification processes (either internally or externally/outsourced) to 
"PKG",60,22,1,"PAH",1,1,56,0)
be completed prior to treatment.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
6
"RTN","FBAACFE")
0^16^B2043443^B1826171
"RTN","FBAACFE",1,0)
FBAACFE ;WOIFO/SAB - CONTRACT FILE ENTER/EDIT ;9/24/2009
"RTN","FBAACFE",2,0)
 ;;3.5;FEE BASIS;**108,163**;JAN 30, 1995;Build 21
"RTN","FBAACFE",3,0)
 ;Per VA Directive 6402, this routine should not be modified.
"RTN","FBAACFE",4,0)
 ;
"RTN","FBAACFE",5,0)
 N DA,DIC,DIDEL,DR,DLAYGO,DTOUT,DUOUT,X,Y
"RTN","FBAACFE",6,0)
 N FBCNTRN,FBDA,FBNEW,FBX
"RTN","FBAACFE",7,0)
 ;
"RTN","FBAACFE",8,0)
SEL ; add/select
"RTN","FBAACFE",9,0)
 S DIC="^FBAA(161.43,",DIC(0)="AQELM",DLAYGO=161.43
"RTN","FBAACFE",10,0)
 S DIC("A")="Select FEE BASIS CONTRACT NUMBER: "
"RTN","FBAACFE",11,0)
 D ^DIC K DIC
"RTN","FBAACFE",12,0)
 I Y<0 G END
"RTN","FBAACFE",13,0)
 S (DA,FBDA)=+Y
"RTN","FBAACFE",14,0)
 S FBCNTRN=$P(Y,"^",2)
"RTN","FBAACFE",15,0)
 S FBNEW=+$P(Y,"^",3)
"RTN","FBAACFE",16,0)
 ;
"RTN","FBAACFE",17,0)
 ; lock
"RTN","FBAACFE",18,0)
 L +^FBAA(161.43,FBDA):$S($D(DILOCKTM):DILOCKTM,1:5) I '$T D  G SEL
"RTN","FBAACFE",19,0)
 . W $C(7),!,"Record being edited by someone else. Try later.",!
"RTN","FBAACFE",20,0)
 ;
"RTN","FBAACFE",21,0)
 ; edit
"RTN","FBAACFE",22,0)
 S DIE="^FBAA(161.43,"
"RTN","FBAACFE",23,0)
 I 'FBNEW,$$CNTRPTR^FBUTL7(DA) D
"RTN","FBAACFE",24,0)
 . S FBX="CONTRACT NUMBER: "_FBCNTRN_" (referenced, no editing)"
"RTN","FBAACFE",25,0)
 . S DR="W !,FBX;1:5"
"RTN","FBAACFE",26,0)
 E  S DR=".01:5"  ; FB*3.5*163 - Added fields 4 and 5 for CHOICE Program Indicator
"RTN","FBAACFE",27,0)
 S DIDEL=161.43
"RTN","FBAACFE",28,0)
 S DIE("NO^")="BACK"
"RTN","FBAACFE",29,0)
 D ^DIE K DIE,DIDEL,DR
"RTN","FBAACFE",30,0)
 I $D(DTOUT) G END
"RTN","FBAACFE",31,0)
 ;
"RTN","FBAACFE",32,0)
 ; unlock
"RTN","FBAACFE",33,0)
 L -^FBAA(161.43,FBDA)
"RTN","FBAACFE",34,0)
 ;
"RTN","FBAACFE",35,0)
 ; repeat
"RTN","FBAACFE",36,0)
 W !
"RTN","FBAACFE",37,0)
 G SEL
"RTN","FBAACFE",38,0)
 ;
"RTN","FBAACFE",39,0)
END ; exit
"RTN","FBAACFE",40,0)
 Q
"RTN","FBPCR")
0^17^B129969114^B73151731
"RTN","FBPCR",1,0)
FBPCR ;AISC/DMK,GRR,TET-POTENTIAL COST RECOVERY OUTPUT DRIVER ;5/23/2006
"RTN","FBPCR",2,0)
 ;;3.5;FEE BASIS;**12,48,76,98,103,135,163**;JAN 30, 1995;Build 21
"RTN","FBPCR",3,0)
 ;Per VA Directive 6402, this routine should not be modified.
"RTN","FBPCR",4,0)
 ; DBIA SUPPORTED REF $$NPI^XUSNPI = 4532
"RTN","FBPCR",5,0)
DOC ;Refer to fbdoc, tag fbpcr, for documentation of fbpcr* routines 
"RTN","FBPCR",6,0)
PSF ;select one/many/all primary service failities 
"RTN","FBPCR",7,0)
 K FBBILL,FBNPB,FBADJ,FBADJR,FBPVL133,FBINV,FBPVLIST,Y  ;FB*3.5*163
"RTN","FBPCR",8,0)
 S FBARRLTC=""
"RTN","FBPCR",9,0)
 W !! S DIC="^DIC(4,",VAUTSTR="Primary Service Facility",VAUTNI=2,VAUTVB="FBPSV" D FIRST^VAUTOMA K DIC I Y=-1 G EXIT
"RTN","FBPCR",10,0)
ARRAY ;set fee program array for all programs
"RTN","FBPCR",11,0)
 S FBPI=0 F  S FBPI=$O(^FBAA(161.8,FBPI)) Q:'FBPI  S FBPIN=$G(^(FBPI,0)) I $P(FBPIN,U,3) S FBPROG(FBPI)=$P(FBPIN,U)
"RTN","FBPCR",12,0)
 I '$D(FBPROG) G EXIT
"RTN","FBPCR",13,0)
 ;prepare array with LTC POV codes
"RTN","FBPCR",14,0)
 D MKARRLTC^FBPCR4
"RTN","FBPCR",15,0)
 ;what party to include
"RTN","FBPCR",16,0)
 K DIR
"RTN","FBPCR",17,0)
 S DIR(0)="SO^P:Patient;I:Insurance;B:Both",DIR("A")="Include (P)atient Co-pays / (I)nsurance / (B)oth",DIR("B")="Both"
"RTN","FBPCR",18,0)
 S DIR("?")=" Select type of recover to include",DIR("?",1)=" P - include only recover from patient copays",DIR("?",2)=" I - include only recover from insurance",DIR("?",3)=" B - include both",DIR("L")=""
"RTN","FBPCR",19,0)
 D ^DIR S FBPARTY=$S($G(Y(0))="Patient":1,$G(Y(0))="Insurance":2,$G(Y(0))="Both":3,X="Both":3,1:0)
"RTN","FBPCR",20,0)
 K DIR
"RTN","FBPCR",21,0)
 G:FBPARTY=0 EXIT
"RTN","FBPCR",22,0)
 ;what type of copay to include
"RTN","FBPCR",23,0)
 S FBCOPAY=3
"RTN","FBPCR",24,0)
 I FBPARTY'=2 D
"RTN","FBPCR",25,0)
 . S DIR(0)="SO^M:MeansTest;L:LTC;B:Both",DIR("A")="Include (M)eans Test Co-pays /(L)TC Co-pays /(B)oth",DIR("B")="Both"
"RTN","FBPCR",26,0)
 . S DIR("?")=" Select services to include",DIR("?",1)=" M - include only Means Test copays",DIR("?",2)=" L - include only LTC copays",DIR("?",3)=" B - include both",DIR("L")=""
"RTN","FBPCR",27,0)
 . D ^DIR S FBCOPAY=$S($G(Y(0))="LTC":1,$G(Y(0))="MeansTest":2,$G(Y(0))="Both":3,X="Both":3,1:0)
"RTN","FBPCR",28,0)
 . K DIR
"RTN","FBPCR",29,0)
 G:FBCOPAY=0 EXIT
"RTN","FBPCR",30,0)
 ;
"RTN","FBPCR",31,0)
 ;include patients if their insurance informations is unavailable?
"RTN","FBPCR",32,0)
 S FBINCUNK=0
"RTN","FBPCR",33,0)
 I FBPARTY=2!(FBPARTY=3) D
"RTN","FBPCR",34,0)
 . S FBINCUNK=1
"RTN","FBPCR",35,0)
 . N Y,X
"RTN","FBPCR",36,0)
 . W !!
"RTN","FBPCR",37,0)
 . S DIR("A")="Do you want to include patients whose insurance status is unavailable? "
"RTN","FBPCR",38,0)
 . S DIR("?")="Please answer Yes or No."
"RTN","FBPCR",39,0)
 . S DIR("B")="YES",DIR(0)="YA^^"
"RTN","FBPCR",40,0)
 . D ^DIR K DIR
"RTN","FBPCR",41,0)
 . I $G(DIRUT) S FBINCUNK=-1 Q
"RTN","FBPCR",42,0)
 . I $G(Y)=0 S FBINCUNK=0
"RTN","FBPCR",43,0)
 I FBINCUNK=-1 G EXIT ;uparrow - exit
"RTN","FBPCR",44,0)
 N FBINEXCL  ; FB*3.5*135
"RTN","FBPCR",45,0)
 D EXCLINS  ;select insurances to be excluded ; FB*3.5*135
"RTN","FBPCR",46,0)
 ;
"RTN","FBPCR",47,0)
PREBL ;Include Only Not Previously Billed NVC FB*3.5*163
"RTN","FBPCR",48,0)
 N Y,X
"RTN","FBPCR",49,0)
 W !
"RTN","FBPCR",50,0)
 S DIR("A")="Include only Non VA Care not previously billed to third party carrier: "
"RTN","FBPCR",51,0)
 S DIR("?")="Please answer Yes or No."
"RTN","FBPCR",52,0)
 S DIR("B")="YES",DIR(0)="YA^^"
"RTN","FBPCR",53,0)
 D ^DIR K DIR
"RTN","FBPCR",54,0)
 S FBNPB=Y
"RTN","FBPCR",55,0)
 ; 
"RTN","FBPCR",56,0)
DATE ;select date range
"RTN","FBPCR",57,0)
 D DATE^FBAAUTL I FBPOP G PSF
"RTN","FBPCR",58,0)
 S FBBDATE=BEGDATE,FBEDATE=ENDDATE
"RTN","FBPCR",59,0)
 S Z=9999999.9999,FBBEG=Z-FBEDATE,FBEND=Z-FBBDATE
"RTN","FBPCR",60,0)
Q K ^TMP($J,"FB"),^TMP($J,"FBINSIBAPI"),DIC
"RTN","FBPCR",61,0)
 ;
"RTN","FBPCR",62,0)
 S VAR="FBINCUNK^FBARRLTC^FBARRLTC(^FBPARTY^FBCOPAY^FBNAME^FBIEN^FBID^FBBEG^FBEND^FBBDATE^FBEDATE^FBPSV^FBPSV(^FBPROG(",VAL=VAR,PGM="DQ^FBPCR",IOP="Q" D ZIS^FBAAUTL G:FBPOP EXIT
"RTN","FBPCR",63,0)
DQ S $P(FBDASH,"=",80)="",$P(FBDASH1,"-",80)="",FBPG=0,FBCRT=$S($E(IOST,1,2)="C-":1,1:0),FBOUT=0,FBBEG=FBBEG-.9 U IO
"RTN","FBPCR",64,0)
SORT ;sort driver for payment output(s)
"RTN","FBPCR",65,0)
 S FBPI=0 F  S FBPI=$O(FBPROG(FBPI)) Q:'FBPI  S FBXPROG=FBPROG(FBPI) D
"RTN","FBPCR",66,0)
 .I FBPI=2 D EN^FBPCR2 ;outpatient payments
"RTN","FBPCR",67,0)
 .I FBPI=3 D EN^FBPCR3 ;pharmacy payments
"RTN","FBPCR",68,0)
 .I FBPI=6!(FBPI=7) S:FBPI=6&($D(FBPROG(7))) FBPI=67 D EN^FBPCR67 S:FBPI=67 FBPI=7 ;civil hospital/cnh payments
"RTN","FBPCR",69,0)
PRINT ;print driver for payment output(s)
"RTN","FBPCR",70,0)
 I $G(^TMP($J,"FBINSIBAPI"))>0 D HDRUNK
"RTN","FBPCR",71,0)
 S FBPI=$O(^TMP($J,"FB",0)) I FBPI']"" D WMSG G OUT
"RTN","FBPCR",72,0)
 S FBSTA=0
"RTN","FBPCR",73,0)
 S FBFIRST=0 ; FB*3.5*163
"RTN","FBPCR",74,0)
 S FBPSF=0 F  S FBPSF=$O(^TMP($J,"FB",FBPSF)) Q:'FBPSF!FBOUT  D STA S FBPT="" F  S FBPT=$O(^TMP($J,"FB",FBPSF,FBPT)) Q:FBPT']""!FBOUT  S DFN=$P(FBPT,";",2) D VET S FBPI=0 F  S FBPI=$O(FBPROG(FBPI)) Q:'FBPI  S FBXPROG=FBPROG(FBPI) D  Q:FBOUT
"RTN","FBPCR",75,0)
 .I FBPSF_FBPT'=FBSTA D HDR Q:FBOUT
"RTN","FBPCR",76,0)
 .I FBPI=2,$D(^TMP($J,"FB",FBPSF,FBPT,FBPI)) D PRINT^FBPCR2 Q
"RTN","FBPCR",77,0)
 .I FBPI=3 D:$D(^TMP($J,"FB",FBPSF,FBPT,FBPI)) PRINT^FBPCR3 Q
"RTN","FBPCR",78,0)
 .I FBPI=6!(FBPI=7) D:$D(^TMP($J,"FB",FBPSF,FBPT,FBPI)) PRINT^FBPCR671 Q
"RTN","FBPCR",79,0)
OUT I $G(^TMP($J,"FBINSIBAPI"))>0 D ERRHDL^FBPCR4
"RTN","FBPCR",80,0)
 I FBFIRST=0 D WMSG  ; FB*3.5*163
"RTN","FBPCR",81,0)
 I FBOUT!$D(ZTQUEUED) G EXIT
"RTN","FBPCR",82,0)
 D EXIT G PSF
"RTN","FBPCR",83,0)
 Q
"RTN","FBPCR",84,0)
 ;
"RTN","FBPCR",85,0)
EXCLINS ;create list of insurance type to be excluded ; FB*3.5*135
"RTN","FBPCR",86,0)
 N Y,X,DIC,DTOUT,DUOUT,DIR,DIRUT,DIROUT
"RTN","FBPCR",87,0)
 K FBINEXCL S FBINEXCL=0,X=1
"RTN","FBPCR",88,0)
 W !!!,"Select the TYPE of INSURANCE PLANS to be EXCLUDED from the PCR report:"
"RTN","FBPCR",89,0)
 F  Q:$G(X)=""  S DIC="^IBE(355.1,",DIC(0)="QEAFIBS",DIC("S")="I '$P($G(^(0)),U,4)" K X,Y D ^DIC I $G(Y)>0 S FBINEXCL(+Y)=$P(Y,U,2),FBINEXCL("INS",$P(Y,U,2))=+Y
"RTN","FBPCR",90,0)
 S FBINEXCL="A",X=0 F  S FBINEXCL=$O(FBINEXCL("INS",FBINEXCL)) Q:FBINEXCL=""  W:'X !!,"Type of Plan selected for EXCLUSION: " S X=1 W ?41,FBINEXCL,!
"RTN","FBPCR",91,0)
 I $O(FBINEXCL(0)) K X,Y S DIR(0)="Y",DIR("B")="NO",DIR("A")="Recreate Exclusion List" D ^DIR I Y D EXCLINS
"RTN","FBPCR",92,0)
 K FBINEXCL("INS")
"RTN","FBPCR",93,0)
 Q
"RTN","FBPCR",94,0)
 ;
"RTN","FBPCR",95,0)
EXIT ;kill and quit
"RTN","FBPCR",96,0)
KILL ;kill all variables set in the FBPCR* routines, other than fbx
"RTN","FBPCR",97,0)
 D CLOSE^FBAAUTL K ^TMP($J,"FB")
"RTN","FBPCR",98,0)
 K A1,A2,A3,BEGDATE,C,D,D2,DFN,DIC,DIR,DTOUT,DUOUT,ENDDATE,FBPDXC,FBPARTY,FBCOPAY,FBARRLTC,FBINCUNK,FBFIRST
"RTN","FBPCR",99,0)
 K FBAAA,FBAACPTC,FBAC,FBAP,FBBATCH,FBBDATE,FBBEG,FBBN,FBCATC,FBCNT,FBCP,FBCRT,FBDA1,FBDASH,FBDASH1,FBDATA,FBDOB,FBDRUG,FBDT,FBDT1,FBDOS,FBDX,FBDX1,FBEDATE,FBEND,FBERR,FBFD,FBFD1,FBHEAD
"RTN","FBPCR",100,0)
 K FBI,FBID,FBIEN,FBIN,FBINS,FBINVN,FBIX,FBJ,FBLOC,FBM,FBNAME,FBOB,FBOPI,FBOUT,FBOV,FBP,FBPAT,FBPD,FBPDX,FBPG,FBPI,FBPID,FBPIN,FBPNAME,FBPROC,FBPROC1,FBPROG,FBPSF,FBPSFNAM,FBPSFNUM,FBPSV,FBPT,FBPV,FBQTY,FBREIM,FBRX
"RTN","FBPCR",101,0)
 K FBSC,FBSL,FBSTA,FBSTR,FBSUSP,FBTA,FBTYPE,FBV,FBVCHAIN,FBVEN,FBVENID,FBVNAME,FBVI,FBVID,FBVP,FBXPROG,FBY,FBZ,I,IOP,J,K,L,M,N,PGM,T,V,VA,VAERR,VAL,VAR,VAUTNI,VAUTSTR,VAUTVB,X,Y,Z,FBSTANPI,FBXX
"RTN","FBPCR",102,0)
 Q
"RTN","FBPCR",103,0)
 ;
"RTN","FBPCR",104,0)
WMSG ;write message if no matches found
"RTN","FBPCR",105,0)
 D HDR W !!?3,"There are no potential cost recoveries on file"
"RTN","FBPCR",106,0)
 W !?5,"for specified date range:  ",$$DATX^FBAAUTL(FBBDATE)," through ",$$DATX^FBAAUTL(FBEDATE)
"RTN","FBPCR",107,0)
 I 'FBPSV D
"RTN","FBPCR",108,0)
 .W ",",!?5,"and selected Primary Service Area(s):"
"RTN","FBPCR",109,0)
 .S FBPSF=0 F  S FBPSF=$O(FBPSV(FBPSF)) Q:'FBPSF  W !?31,$G(FBPSV(FBPSF))
"RTN","FBPCR",110,0)
 E  W !?5,"and ALL Primary Service Areas "
"RTN","FBPCR",111,0)
 W ".",*7,!!
"RTN","FBPCR",112,0)
 Q
"RTN","FBPCR",113,0)
 ;
"RTN","FBPCR",114,0)
CATC(DFN,FBDT,FBPOV) ; 
"RTN","FBPCR",115,0)
 ;treats all copays as Means test for date < 3020705 (JULY 5,2002)
"RTN","FBPCR",116,0)
 ;check if patient is liable for copay
"RTN","FBPCR",117,0)
 ;INPUT:
"RTN","FBPCR",118,0)
 ; DFN = IEN of Patient file
"RTN","FBPCR",119,0)
 ; FBDT= Date
"RTN","FBPCR",120,0)
 ; FBPOV = POV code (for LTC determination)
"RTN","FBPCR",121,0)
 ;OUTPUT:
"RTN","FBPCR",122,0)
 ;0 - the patient is not liable for any co-pay;
"RTN","FBPCR",123,0)
 ;1 - if Means test catc or pending adjudication and agree to pay deduc
"RTN","FBPCR",124,0)
 ;2 - the patient is liable for LTC co-pay;
"RTN","FBPCR",125,0)
 ;3 - no 1010EC on file
"RTN","FBPCR",126,0)
 ;4 - more analysis is needed to determine the patient liability
"RTN","FBPCR",127,0)
 N FBLTC,FBISLTC
"RTN","FBPCR",128,0)
 S FBCATC=$$BIL^DGMTUB(DFN,FBDT)
"RTN","FBPCR",129,0)
 I '$D(FBPOV)!(FBDT<3020705) Q $S(FBCATC:1,1:0)
"RTN","FBPCR",130,0)
 S FBISLTC=$$ISLTC^FBPCR4(FBPOV)
"RTN","FBPCR",131,0)
 I FBISLTC=0 Q $S(FBCATC:1,1:0)  ;Means test
"RTN","FBPCR",132,0)
 I FBISLTC=2 Q 0  ;LTC-service, but LTC-copay is not applicable
"RTN","FBPCR",133,0)
 S FBLTC=$$LTCST^FBPCR4(DFN,FBDT)
"RTN","FBPCR",134,0)
 I FBLTC=2 Q 2  ;LTC copay
"RTN","FBPCR",135,0)
 I FBLTC=0 Q 3  ;no 1010EC on file
"RTN","FBPCR",136,0)
 I FBLTC=4 Q 4  ;more info needed
"RTN","FBPCR",137,0)
 Q 0  ;exemption from LTC -copay
"RTN","FBPCR",138,0)
 ;
"RTN","FBPCR",139,0)
VET ;set vet name/ssn/dob info
"RTN","FBPCR",140,0)
 ;INPUT:  DFN  = IEN of Patient file
"RTN","FBPCR",141,0)
 ;      FBPI = IEN of fee program (optional)
"RTN","FBPCR",142,0)
 ;OUTPUT:  FBPNAME = Patient's name
"RTN","FBPCR",143,0)
 ;      FBPID   = Patient's pid
"RTN","FBPCR",144,0)
 ;      FBDOB   = Patient's dob (if pharmacy fee program)
"RTN","FBPCR",145,0)
 N N
"RTN","FBPCR",146,0)
 S N=$G(^DPT(DFN,0)),FBPNAME=$P(N,U),FBPID=$$SSN^FBAAUTL(DFN),FBDOB=$$FMTE^XLFDT($P(N,U,3))
"RTN","FBPCR",147,0)
 Q
"RTN","FBPCR",148,0)
 ;
"RTN","FBPCR",149,0)
STA ;set station name & number
"RTN","FBPCR",150,0)
 ;INPUT = FBPSF - IEN to institution file
"RTN","FBPCR",151,0)
 ;OUTPUT = FBPSFNAM = station name
"RTN","FBPCR",152,0)
 ;      FBPSFNUM = station number
"RTN","FBPCR",153,0)
 S FBPSFNAM=$P($G(^DIC(4,FBPSF,0)),U),FBPSFNUM=$P($G(^DIC(4,FBPSF,99)),U)
"RTN","FBPCR",154,0)
 S:FBPSFNAM=+FBPSFNAM FBPSFNAM="UNKNOWN"
"RTN","FBPCR",155,0)
 S FBSTANPI=$S($G(FBPSFNAM)="":"",FBPSFNAM="UNKNOWN":"",1:$P($$NPI^XUSNPI("Organization_ID",FBPSF),U,1))
"RTN","FBPCR",156,0)
 Q
"RTN","FBPCR",157,0)
 ;
"RTN","FBPCR",158,0)
PAGE ;form feed when new station/patient
"RTN","FBPCR",159,0)
 S FBSTA=$G(FBPSF)_$G(FBPT)
"RTN","FBPCR",160,0)
 I FBCRT&(FBPG'=0) D CR Q:FBOUT
"RTN","FBPCR",161,0)
 I FBPG>0!FBCRT W @IOF
"RTN","FBPCR",162,0)
 S FBPG=FBPG+1
"RTN","FBPCR",163,0)
 Q
"RTN","FBPCR",164,0)
 ;
"RTN","FBPCR",165,0)
CR ;read for display
"RTN","FBPCR",166,0)
 S DIR(0)="E" W ! D ^DIR K DIR S:$D(DUOUT)!($D(DTOUT)) FBOUT=1
"RTN","FBPCR",167,0)
 Q
"RTN","FBPCR",168,0)
 ;
"RTN","FBPCR",169,0)
HDR ;general header for potential recoveries
"RTN","FBPCR",170,0)
 D PAGE Q:FBOUT
"RTN","FBPCR",171,0)
 W !?(IOM-30/2),"POTENTIAL COST RECOVERY REPORT"
"RTN","FBPCR",172,0)
 W !?(IOM-(11+$L($G(FBPSFNAM))+$L($G(FBPSFNUM)))/2),"Division/Station: ",$G(FBPSFNUM)," ",$G(FBPSFNAM) ;FB*3.5*163
"RTN","FBPCR",173,0)
 W !?(IOM-14/2),"NPI: ",$S($G(FBSTANPI)="":"",$G(FBSTANPI)<1:"",1:$G(FBSTANPI))
"RTN","FBPCR",174,0)
 W !?(IOM-19/2),$$DATX^FBAAUTL(FBBDATE)," - ",$$DATX^FBAAUTL(FBEDATE)
"RTN","FBPCR",175,0)
 W !?71,"Page: ",FBPG
"RTN","FBPCR",176,0)
 W !,"Patient: ",$G(FBPNAME),?40,"Pat. ID: ",$G(FBPID),?62,"DOB: ",$G(FBDOB)
"RTN","FBPCR",177,0)
 W !
"RTN","FBPCR",178,0)
 S FBFIRST=1  ;FB*3.5*163
"RTN","FBPCR",179,0)
 I '$D(DFN) Q  ;FB*3.5*163
"RTN","FBPCR",180,0)
 D PATDEMO ;FB*3.5*163
"RTN","FBPCR",181,0)
 I FBINCUNK=1,$D(^TMP($J,"FBINSIBAPI",+$G(DFN))) W ">> Warning: accurate insurance information for the patient is unavailable"
"RTN","FBPCR",182,0)
 W !?3,"('*' Represents Reimbursement to Patient",?50,"'#' Represents Voided Payment)"
"RTN","FBPCR",183,0)
 W !,FBDASH
"RTN","FBPCR",184,0)
 ; W ! D:$D(DFN) INS^DGRPDB  ;FB*3.5*163
"RTN","FBPCR",185,0)
 W ! D:$D(DFN) INS  ;FB*3.5*163
"RTN","FBPCR",186,0)
 Q
"RTN","FBPCR",187,0)
 ;
"RTN","FBPCR",188,0)
HDRUNK ;Warning message if patient's insurance status is unknown
"RTN","FBPCR",189,0)
 D PAGE Q:FBOUT
"RTN","FBPCR",190,0)
 W !?(IOM-30/2),"POTENTIAL COST RECOVERY REPORT"
"RTN","FBPCR",191,0)
 ;W !?(IOM-(11+$L($G(FBPSFNAM))+$L($G(FBPSFNUM)))/2),"Division: ",$G(FBPSFNUM)," ",$G(FBPSFNAM) ;FB*3.5*163
"RTN","FBPCR",192,0)
 W !?(IOM-(19+$L($G(FBPSFNAM))+$L($G(FBPSFNUM)))/2),"Division/Station: ",$G(FBPSFNUM)," ",$G(FBPSFNAM) ;FB*3.5*163
"RTN","FBPCR",193,0)
 W !?(IOM-19/2),$$DATX^FBAAUTL(FBBDATE)," - ",$$DATX^FBAAUTL(FBEDATE)
"RTN","FBPCR",194,0)
 W !?71,"Page: ",FBPG
"RTN","FBPCR",195,0)
 W !,"------------------------------ !!! WARNING !!! --------------------------------"
"RTN","FBPCR",196,0)
 W !,"This report is incomplete due to problems with obtaining insurance information"
"RTN","FBPCR",197,0)
 W !,"for those patients listed in a separate section in the end of the report. You"
"RTN","FBPCR",198,0)
 W !,"may want to rerun the report again to get more accurate results."
"RTN","FBPCR",199,0)
 W !,FBDASH
"RTN","FBPCR",200,0)
 I FBINCUNK=1 D
"RTN","FBPCR",201,0)
 . W !,"Note: You have chosen to include patients with unknown insurance status in"
"RTN","FBPCR",202,0)
 . W !,"this report. Please be aware that these patients will be treated as if they"
"RTN","FBPCR",203,0)
 . W !,"have billable insurance and their treatment details will be marked accordingly."
"RTN","FBPCR",204,0)
 . W !,"The names of these patients will be accompanied with the following message"
"RTN","FBPCR",205,0)
 . W !,"to order to identify them:"
"RTN","FBPCR",206,0)
 . W !,">> Warning: accurate insurance information for the patient is unavailable"
"RTN","FBPCR",207,0)
 . W !,FBDASH
"RTN","FBPCR",208,0)
 Q
"RTN","FBPCR",209,0)
 ;
"RTN","FBPCR",210,0)
PATDEMO ; Patient Demographics FB*3.5*163
"RTN","FBPCR",211,0)
 N VAEL,FBCP,FBMT
"RTN","FBPCR",212,0)
 D ELIG^VADPT
"RTN","FBPCR",213,0)
 S FBMT=$P($G(VAEL(9)),U,2)
"RTN","FBPCR",214,0)
 W !,?10,"Outpatient Copayment Status: ",FBMT
"RTN","FBPCR",215,0)
 D DISP^IBARXEU(DFN,DT,1,"")
"RTN","FBPCR",216,0)
 D GETSC
"RTN","FBPCR",217,0)
 D GETSTA
"RTN","FBPCR",218,0)
 Q
"RTN","FBPCR",219,0)
 ;
"RTN","FBPCR",220,0)
GETSC    ; Get Service Connected FB*3.5*163
"RTN","FBPCR",221,0)
 N FBD,FBI,FBX,FBY,FBSC
"RTN","FBPCR",222,0)
 W !,?20,"Service Connected: "
"RTN","FBPCR",223,0)
 I VAEL(3)=0 W "NO" Q
"RTN","FBPCR",224,0)
 I $P(VAEL(3),U,2)="" W "NO" Q
"RTN","FBPCR",225,0)
 W $P(VAEL(3),U,2)_"%"
"RTN","FBPCR",226,0)
 I '$O(^DPT(DFN,.372,0)) Q
"RTN","FBPCR",227,0)
 S FBI=0 F  S FBI=$O(^DPT(DFN,.372,FBI)) Q:'FBI  D
"RTN","FBPCR",228,0)
 . S FBX=$G(^DPT(DFN,.372,FBI,0)),FBY=$G(^DIC(31,+FBX,0))
"RTN","FBPCR",229,0)
 . S FBD=$S($P(FBY,U,4)="":$P(FBY,U,1),1:$P(FBY,U,4))_" ("_$P(FBX,U,2)_"%-"_$S(+$P(FBX,U,3):"SC",1:"NSC")_")"
"RTN","FBPCR",230,0)
 . W !?39,FBD
"RTN","FBPCR",231,0)
 Q
"RTN","FBPCR",232,0)
 ;
"RTN","FBPCR",233,0)
GETSTA ; Get Special Authority Eligibility FB*3.5*163
"RTN","FBPCR",234,0)
 N FBY,FBADT,FBARR
"RTN","FBPCR",235,0)
 W !,?13,"Special Auth Eligibility: "
"RTN","FBPCR",236,0)
 S FBADT=DT
"RTN","FBPCR",237,0)
 D CL^SDCO21(DFN,FBADT,"",.FBARR)
"RTN","FBPCR",238,0)
 I $D(FBARR(3)) W "SC TREATMENT",!
"RTN","FBPCR",239,0)
 I $D(FBARR(7)),+$$CVEDT^DGCV(DFN,FBADT) W ?13,"COMBAT VETERAN",!
"RTN","FBPCR",240,0)
 I $D(FBARR(1)) W ?39,"AGENT ORANGE",!
"RTN","FBPCR",241,0)
 I $D(FBARR(2)) W ?39,"IONIZING RADIATION",!
"RTN","FBPCR",242,0)
 I $D(FBARR(4)) W ?39,"SOUTHWEST ASIA",!
"RTN","FBPCR",243,0)
 I $D(FBARR(8)) W ?39,"PROJECT 112/SHAD",!
"RTN","FBPCR",244,0)
 I $D(FBARR(5)) W ?39,"MILITARY SEXUAL TRAUMA",!
"RTN","FBPCR",245,0)
 I $D(FBARR(6)) W ?39,"HEAD/NECK CANCER",!
"RTN","FBPCR",246,0)
 I '$D(FBARR) W "NO",!
"RTN","FBPCR",247,0)
 Q
"RTN","FBPCR",248,0)
 ;
"RTN","FBPCR",249,0)
INS  ;Print Insurance Information FB*3.5*163
"RTN","FBPCR",250,0)
 N FBYN,FBINS,FBRTN,FBERR,FBX,FBSTAT,FBVAL
"RTN","FBPCR",251,0)
 W !,"    Health Insurance: "
"RTN","FBPCR",252,0)
 S FBSTAT="RB"
"RTN","FBPCR",253,0)
 S FBYN=$$INSUR^IBBAPI(DFN,"",FBSTAT,.FBRTN,"*")
"RTN","FBPCR",254,0)
 W $S(FBYN:"YES",1:"NO"),!
"RTN","FBPCR",255,0)
 S:FBYN<0 FBERR=$O(FBRTN("IBBAPI","INSUR","ERROR",0))
"RTN","FBPCR",256,0)
 D INSHDR
"RTN","FBPCR",257,0)
 I $G(FBERR) W !?6,FBRTN("IBBAPI","INSUR","ERROR",FBERR) D INSQ Q
"RTN","FBPCR",258,0)
 I 'FBYN W !!,"No Insurance Information" D INSQ Q
"RTN","FBPCR",259,0)
 M FBINS=FBRTN("IBBAPI","INSUR")
"RTN","FBPCR",260,0)
 S FBX=0
"RTN","FBPCR",261,0)
 F  S FBX=$O(FBINS(FBX)) Q:'FBX  D INSDSP(FBX)
"RTN","FBPCR",262,0)
 ;
"RTN","FBPCR",263,0)
INSQ  ;Check Insurance Buffer and verify no coverage then quit FB*3.5*163
"RTN","FBPCR",264,0)
 N FBNC
"RTN","FBPCR",265,0)
 W ! I $D(FBRTN("BUFFER")) D
"RTN","FBPCR",266,0)
 . I FBRTN("BUFFER")>0 W !?17,"*** Patient has Insurance Buffer entries ***"
"RTN","FBPCR",267,0)
 S FBNC=+$G(^IBA(354,DFN,60)) I +FBNC D
"RTN","FBPCR",268,0)
 . W !?17,"*** Verification of No Coverage "_$$FMTE^XLFDT(FBNC)_" ***"
"RTN","FBPCR",269,0)
 Q
"RTN","FBPCR",270,0)
 ;
"RTN","FBPCR",271,0)
INSHDR ;Print insurance header FB*3.5*163
"RTN","FBPCR",272,0)
 N FBEQL
"RTN","FBPCR",273,0)
 W !,"Insurance",?13,"COB",?17,"Subscriber ID",?35,"Group",?47,"Holder",?54,"Eff Dt",?63,"Exp Dt",?72,"Verified"
"RTN","FBPCR",274,0)
 S FBEQL="",$P(FBEQL,"=",80)="=" W !,FBEQL
"RTN","FBPCR",275,0)
 Q
"RTN","FBPCR",276,0)
 ;
"RTN","FBPCR",277,0)
INSDSP(FBVAL) ;Print insurance display line FB*3.5*163 
"RTN","FBPCR",278,0)
 N FBY,FBZ
"RTN","FBPCR",279,0)
 Q:'$D(FBINS)
"RTN","FBPCR",280,0)
 W !,$S($D(FBINS(FBVAL,1)):$E($P(FBINS(FBVAL,1),U,2),1,10),1:"UNKNOWN")  ;Insurance Company
"RTN","FBPCR",281,0)
 S FBY=+FBINS(FBVAL,7) I FBY'="" S FBY=$S(FBY=1:"p",FBY=2:"s",FBY=3:"t",1:"")
"RTN","FBPCR",282,0)
 W ?13,FBY  ;COB
"RTN","FBPCR",283,0)
 W ?17,$E(FBINS(FBVAL,14),1,16)  ;Subscriber ID
"RTN","FBPCR",284,0)
 W ?35,$E(FBINS(FBVAL,18),1,10)  ;Group
"RTN","FBPCR",285,0)
 S FBZ=$P(FBINS(FBVAL,12),U,1)
"RTN","FBPCR",286,0)
 W ?47,$S(FBZ="P":"SELF",FBZ="S":"SPOUSE",1:"OTHER")  ;Policy Holder
"RTN","FBPCR",287,0)
 W ?54,$TR($$FMTE^XLFDT(FBINS(FBVAL,10),"2DF")," ","0")  ;Effective Date
"RTN","FBPCR",288,0)
 W ?63,$TR($$FMTE^XLFDT(FBINS(FBVAL,11),"2DF")," ","0")  ;Expiration Date
"RTN","FBPCR",289,0)
 W ?72,$TR($$FMTE^XLFDT(FBINS(FBVAL,25),"2DF")," ","0")  ;Date Last Verified
"RTN","FBPCR",290,0)
 Q
"RTN","FBPCR2")
0^18^B114347873^B77224131
"RTN","FBPCR2",1,0)
FBPCR2 ;AISC/DMK,GRR,TET-OUTPATIENT POTENTIAL COST RECOVERY SORT/PRINT ;7/1/2006
"RTN","FBPCR2",2,0)
 ;;3.5;FEE BASIS;**4,48,55,69,76,98,122,133,163**;JAN 30, 1995;Build 21
"RTN","FBPCR2",3,0)
 ;Per VA Directive 6402, this routine should not be modified.
"RTN","FBPCR2",4,0)
 ;
"RTN","FBPCR2",5,0)
EN ;entry point
"RTN","FBPCR2",6,0)
 S (FBCATC,FBINS,FBPSF)=0
"RTN","FBPCR2",7,0)
SORT ;sort by date finalized, patient, vendor, treatment ien, service ien
"RTN","FBPCR2",8,0)
 S FBPVLIST="ATTENDING PROV NAME^ATTENDING PROV NPI^ATTENDING PROV TAXONOMY CODE^OPERATING PROV NAME^OPERATING PROV NPI^RENDERING PROV NAME"  ; FB*3.5*122
"RTN","FBPCR2",9,0)
 S FBPVLIST=FBPVLIST_"^RENDERING PROV NPI^RENDERING PROV TAXONOMY CODE^SERVICING PROV NAME^SERVICING PROV NPI^REFERRING PROV NAME^REFERRING PROV NPI"  ; FB*3.5*122
"RTN","FBPCR2",10,0)
 S FBLIPVL="^^LI-RENDERING-PROV-NAME^LI-RENDERING-PROV-NPI^LI-RENDERING-PROV-TAXONOMY"   ; FB*3.5*122
"RTN","FBPCR2",11,0)
 S I=FBBDATE-.1 F  S I=$O(^FBAAC("AK",I)) Q:'I!(I>FBEDATE)  S J=0 F  S J=$O(^FBAAC("AK",I,J)) Q:'J  D
"RTN","FBPCR2",12,0)
 .S DFN=J D VET^FBPCR
"RTN","FBPCR2",13,0)
 .S K=0  F  S K=$O(^FBAAC("AK",I,J,K)) Q:'K  S L=0 F  S L=$O(^FBAAC("AK",I,J,K,L)) Q:'L  D SETTR S M=0 F  S M=$O(^FBAAC("AK",I,J,K,L,M)) Q:'M  D  S (FBCATC,FBINS,FBPSF)=0
"RTN","FBPCR2",14,0)
 ..D SET Q:'FBPSV&('$D(FBPSV(FBPSF)))  I FBCATC!FBINS D SETTMP
"RTN","FBPCR2",15,0)
KILL ;kill variables set in this routine
"RTN","FBPCR2",16,0)
 K A1,A2,A3,D,D2,DFN,FBAACPTC,FBBN,FBCATC,FBCP,FBDOB,FBDOS,FBDT,FBDT1,FBIN,FBINS,FBOB,FBP,FBPAT,FBPCR,FBPDX,FBPDXC,FBPID,FBPNAME,FBPSF,FBSC,FBTA,FBTYPE,FBVEN,FBVID,FBVNAME,FBVP,I,J,K,L,M,T,Y,FBMODLE
"RTN","FBPCR2",17,0)
 K FBCSID,FBADJLA,FBADJLR,FBRRMKL,FBUNITS,TAMT,T,FBADJ,FBDAT002,FBDAT003,FBDAT004,FBDAT005,FBPVLIST,FBLIPVL,FBPVL133  ; FB*3.5*122 ; FB*3.5*133
"RTN","FBPCR2",18,0)
 K FBADX1,FBADX2,FBADX3,FBAICD,FBAIEN,FBAREF,FBAREFA,FBARNPI,FBAUTH,FBAVND,FBAVNDA,FBAVNPI,FBAVTAX ; FB*3.5*163
"RTN","FBPCR2",19,0)
 Q
"RTN","FBPCR2",20,0)
SET ;set variables - also entry point from FBPCR67
"RTN","FBPCR2",21,0)
 N FBPCR,FBX
"RTN","FBPCR2",22,0)
 S Y=$G(^FBAAC(J,1,K,1,L,1,M,0)) Q:'+$P(Y,U,9)!($G(^FBAAC(J,1,K,1,L,1,M,"FBREJ"))]"")
"RTN","FBPCR2",23,0)
 S FBY=$G(^FBAAC(J,1,K,1,L,1,M,2)),FBDAT003=$G(^FBAAC(J,1,K,1,L,1,M,3))  ; FB*3.5*122
"RTN","FBPCR2",24,0)
 S FBDAT004=$G(^FBAAC(J,1,K,1,L,1,M,4)),FBDAT005=$G(^FBAAC(J,1,K,1,L,1,M,5))  ; FB*3.5*133
"RTN","FBPCR2",25,0)
 S FBVNAME=$E($P($G(^FBAAV(K,0)),U),1,23),FBVID=$S(FBVNAME]"":$P(^(0),U,2)_"/"_$S($P($G(^(3)),U,2)]"":$P(^(3),U,2),1:"**********"),1:"")
"RTN","FBPCR2",26,0)
 S FBP=+$P(Y,U,9),FBSC=$P(Y,U,27),FBPDX=+$P(Y,U,23),FBPSF=+$P(Y,U,12)
"RTN","FBPCR2",27,0)
 S ^TMP($J,"FB",FBPSF)=$G(^FBAAC(J,1,K,1,L,4))  ; FB*3.5*122
"RTN","FBPCR2",28,0)
 S FBSC=$S(FBSC="Y":"YES",FBSC="N":"NO",1:"-")
"RTN","FBPCR2",29,0)
 S T=$P(Y,U,5),D2=$P(Y,U,6),FBDOS=D2,D2=$$DATX^FBAAUTL(D2),FBCP=$P(Y,U,18),FBCP=$S(FBCP=1:"(C&P)",1:"")
"RTN","FBPCR2",30,0)
 ; FB*3.5*163 - baa start
"RTN","FBPCR2",31,0)
 ;Q:FBCP]""!('FBPSV&('$D(FBPSV(FBPSF))))  S FBPCR=+$G(^FBAAC(J,1,K,1,L,0)),FBCATC=$$CATC^FBPCR(DFN,FBPCR,+$P(Y,U,18)),FBINS=$S(FBSC["N":$$INSURED^FBPCR4(DFN,FBPCR),1:0) Q:'FBCATC&'FBINS
"RTN","FBPCR2",32,0)
 Q:FBCP]""!('FBPSV&('$D(FBPSV(FBPSF))))
"RTN","FBPCR2",33,0)
 S FBPCR=+$G(^FBAAC(J,1,K,1,L,0)),FBCATC=$$CATC^FBPCR(DFN,FBPCR,+$P(Y,U,18)),FBINS=$$INSURED^FBPCR4(DFN,FBPCR)
"RTN","FBPCR2",34,0)
 Q:'FBCATC&'FBINS
"RTN","FBPCR2",35,0)
 ; FB*3.5*163 - baa  end
"RTN","FBPCR2",36,0)
 S FBAACPTC=$$CPT^FBAAUTL4($P(Y,U))
"RTN","FBPCR2",37,0)
 S FBOB=$P(Y,U,10)
"RTN","FBPCR2",38,0)
 I T]"" S T=$P($G(^FBAA(161.27,+T,0)),U)
"RTN","FBPCR2",39,0)
 S FBTYPE=$P(Y,U,20),FBVP=$P(Y,U,21),FBIN=$P(Y,U,16),FBBN=$P(Y,U,8),FBBN=$S(FBBN']"":"",$D(^FBAA(161.7,FBBN,0)):$P(^(0),U),1:""),FBBN=$S(FBBN="":"",1:$E("00000",$L(FBBN)+1,5)_FBBN)
"RTN","FBPCR2",40,0)
 S FBVEN=FBVNAME_";"_FBVID,FBPAT=FBPNAME_";"_DFN
"RTN","FBPCR2",41,0)
 S FBMODLE=$$MODL^FBAAUTL4("^FBAAC("_J_",1,"_K_",1,"_L_",1,"_M_",""M"")","E")
"RTN","FBPCR2",42,0)
 I T]"" S T=$P($G(^FBAA(161.27,+T,0)),U) ;suspend code
"RTN","FBPCR2",43,0)
 S TAMT=$FN($P(Y,U,4),"",2) ;suspend amount
"RTN","FBPCR2",44,0)
 S FBUNITS=$P(FBY,U,14) ;units paid
"RTN","FBPCR2",45,0)
 S FBCSID=$P(FBY,U,16) ;patient account number
"RTN","FBPCR2",46,0)
 S FBX=$$ADJLRA^FBAAFA(M_","_L_","_K_","_J_",")
"RTN","FBPCR2",47,0)
 S FBADJLR=$P(FBX,U) ;adjustment codes
"RTN","FBPCR2",48,0)
 S FBADJLA=$P(FBX,U,2) ;adjustment amounts
"RTN","FBPCR2",49,0)
 S FBRRMKL=$$RRL^FBAAFR(M_","_L_","_K_","_J_",") ;remit remarks
"RTN","FBPCR2",50,0)
 ;output format
"RTN","FBPCR2",51,0)
 S A1=$J($P(Y,U,2),6,2),A2=$J($P(Y,U,3),6,2),A3=$J(A3,6,2),FBIN=$J(FBIN,7)
"RTN","FBPCR2",52,0)
 S FBDT1=$S(FBVP="VP":"#",1:"")_$S(FBTYPE="R":"*",1:" ")_FBDT
"RTN","FBPCR2",53,0)
 ;FB*3.5*163 - Get data from fee basis authorization if available
"RTN","FBPCR2",54,0)
 S FBAUTH=$P(FBDAT003,U,9) ;FB*3.5*163
"RTN","FBPCR2",55,0)
 I FBAUTH D FBAUTH(FBAUTH,J) ;FB*3.5*163
"RTN","FBPCR2",56,0)
 Q
"RTN","FBPCR2",57,0)
 ;
"RTN","FBPCR2",58,0)
SETTMP ;sort data by primary service facility, patient, fee program, vendor, date
"RTN","FBPCR2",59,0)
 N FBBILL,FBINAU,FBSKIP  ;FB*3.5*163
"RTN","FBPCR2",60,0)
 S FBSKIP=0,(FBBILL,FBINAU)=""  ;FB*3.5*163
"RTN","FBPCR2",61,0)
 Q:$$FILTER^FBPCR4()=0
"RTN","FBPCR2",62,0)
 I $P(Y,U,9)'=FBPI Q
"RTN","FBPCR2",63,0)
 D CHKBILL^IBFBUTIL(FBIN) ;FB*3.5*163
"RTN","FBPCR2",64,0)
 I $G(FBSKIP),$G(FBNPB) Q  ;Quit if running for not previously billed and bill IEN exists on File #360 FB*3.5*163
"RTN","FBPCR2",65,0)
 S ^TMP($J,"FB",FBPSF,FBPAT,FBP,FBVEN,I,L_M)=FBDT1_U_FBAACPTC_FBCP_$S($G(FBMODLE)]"":"-"_FBMODLE,1:"")_U_A1_U_A2_U_T_U_FBBN_U_FBIN_U_D2_U_FBSC_U_FBPDX_U_FBOB_U_FBPI_U_FBCATC_U_FBINS
"RTN","FBPCR2",66,0)
 S ^TMP($J,"FB",FBPSF,FBPAT,FBP,FBVEN,I,L_M,"FBADJ")=TAMT_U_FBUNITS_U_FBADJLR_U_FBADJLA_U_FBRRMKL_U_FBCSID
"RTN","FBPCR2",67,0)
 I FBBILL S ^TMP($J,"FB",FBPSF,FBPAT,FBP,FBVEN,I,L_M,"FBBILL")=FBBILL  ; FB*3.5*163 Bill Number
"RTN","FBPCR2",68,0)
 I FBINAU S ^TMP($J,"FB",FBPSF,FBPAT,FBP,FBVEN,I,L_M,"FBINAU")=FBINAU  ; FB*3.5*163 Insurance Auth
"RTN","FBPCR2",69,0)
 I $G(FBAUTH)'="" S ^TMP($J,"FB",FBPSF,FBPAT,FBP,FBVEN,I,L_M,"FBAUTH")=FBADX1_U_FBADX2_U_FBADX3_U_FBAICD_U_FBAREF_U_$G(FBARNPI)_U_FBAVND_U_$G(FBAVNPI)_U_$G(FBAVTAX) ; FB*3.5*163
"RTN","FBPCR2",70,0)
 ;I $TR($G(FBDAT002),U)'="" S ^TMP($J,"FB",FBPSF,FBPAT,FBP,FBVEN)=FBDAT002 K FBDAT002                   ; FB*3.5*122
"RTN","FBPCR2",71,0)
 ;I $TR($G(FBDAT004),U)'="" S $P(^TMP($J,"FB",FBPSF,FBPAT,FBP,FBVEN),U,20)=FBDAT004 K FBDAT004          ; FB*3.5*122
"RTN","FBPCR2",72,0)
 I $TR($G(FBDAT003),U)'="" S ^TMP($J,"FB",FBPSF,FBPAT,FBP,FBVEN,I,L_M,"FBDAT003")=FBDAT003 K FBDAT003  ; FB*3.5*122
"RTN","FBPCR2",73,0)
 I $TR($G(FBDAT004),U)'="" S ^TMP($J,"FB",FBPSF,FBPAT,FBP,FBVEN,I,L_M,"FBDAT004")=FBDAT004 K FBDAT004  ; FB*3.5*133
"RTN","FBPCR2",74,0)
 I $TR($G(FBDAT005),U)'="" S ^TMP($J,"FB",FBPSF,FBPAT,FBP,FBVEN,I,L_M,"FBDAT005")=FBDAT005 K FBDAT005  ; FB*3.5*133
"RTN","FBPCR2",75,0)
 Q
"RTN","FBPCR2",76,0)
SETTR S D=$S($D(^FBAAC(J,1,K,1,L,0)):$P(^(0),"^",1),1:""),A3=".00"
"RTN","FBPCR2",77,0)
 I D]"",$D(^FBAAC(J,3,"AB",D)) S FBTA=$O(^FBAAC(J,3,"AB",D,0)),A3=$S($P(^FBAAC(J,3,FBTA,0),"^",3)]"":$P(^(0),"^",3),1:.0001)
"RTN","FBPCR2",78,0)
 S FBDT=$$DATX^FBAAUTL(D)
"RTN","FBPCR2",79,0)
 ;S FBDAT002=$G(^FBAAC(J,1,K,1,L,2))  ; FB*3.5*122
"RTN","FBPCR2",80,0)
 ;S FBDAT004=$G(^FBAAC(J,1,K,1,L,4))  ; FB*3.5*122
"RTN","FBPCR2",81,0)
 Q
"RTN","FBPCR2",82,0)
EN1 ;entry point to set variables, called by fbpcr67, anc
"RTN","FBPCR2",83,0)
 N FBVEN,FBPAT,FBDT1
"RTN","FBPCR2",84,0)
 D SETTR,SET
"RTN","FBPCR2",85,0)
 Q
"RTN","FBPCR2",86,0)
PRINT ;write output
"RTN","FBPCR2",87,0)
 N FB5010PV,FBLIPVL,FBPVLIST,FBBILL,FBINAU
"RTN","FBPCR2",88,0)
 S FB5010PV=""
"RTN","FBPCR2",89,0)
 S FBPVLIST="ATTENDING PROV NAME^NPI^TAXONOMY CODE^OPERATING PROV NAME^NPI^RENDERING PROV NAME^NPI^TAXONOMY CODE"
"RTN","FBPCR2",90,0)
 S FBPVLIST=FBPVLIST_"^SERVICING PROV NAME^NPI^REFERRING PROV NAME^NPI"
"RTN","FBPCR2",91,0)
 S FBPVL133="ATTENDING PROV NAME^NPI^TAXONOMY CODE^OPERATING PROV NAME^NPI^RENDERING PROV NAME"  ; FB*3.5*133
"RTN","FBPCR2",92,0)
 S FBPVL133=FBPVL133_"^NPI^TAXONOMY CODE^SERVICING PROV NAME^NPI^REFERRING PROV NAME^NPI"  ; FB*3.5*133
"RTN","FBPCR2",93,0)
 S FBLIPVL="^^RENDERING PROV NAME (LI)^NPI^TAXONOMY CODE"
"RTN","FBPCR2",94,0)
 D HDR1 S FBVI=""
"RTN","FBPCR2",95,0)
 F  S FBVI=$O(^TMP($J,"FB",FBPSF,FBPT,FBPI,FBVI)) Q:FBVI']""!(FBOUT)  D:FB5010PV]"" PRNT5010(2,FB5010PV) S FB5010PV=FBVI D SH Q:FBOUT  D  Q:FBOUT
"RTN","FBPCR2",96,0)
 .S FBDT=0 F  S FBDT=$O(^TMP($J,"FB",FBPSF,FBPT,FBPI,FBVI,FBDT)) Q:'FBDT  S M=0 F  S M=$O(^TMP($J,"FB",FBPSF,FBPT,FBPI,FBVI,FBDT,M)) Q:'M  D  Q:FBOUT
"RTN","FBPCR2",97,0)
 ..I ($Y+4)>IOSL D PAGE Q:FBOUT
"RTN","FBPCR2",98,0)
 ..S FBDATA=^TMP($J,"FB",FBPSF,FBPT,FBPI,FBVI,FBDT,M),FBCATC=$P(FBDATA,U,13),FBINS=$P(FBDATA,U,14)
"RTN","FBPCR2",99,0)
 ..S FBADJ=$G(^TMP($J,"FB",FBPSF,FBPT,FBPI,FBVI,FBDT,M,"FBADJ"))
"RTN","FBPCR2",100,0)
 ..S FBBILL=$G(^TMP($J,"FB",FBPSF,FBPT,FBPI,FBVI,FBDT,M,"FBBILL"))  ;FB*3.5*163
"RTN","FBPCR2",101,0)
 ..S FBINAU=$G(^TMP($J,"FB",FBPSF,FBPT,FBPI,FBVI,FBDT,M,"FBINAU"))  ;FB*3.5*163
"RTN","FBPCR2",102,0)
 ..;S FBLOC=1_U_12_U_23_U_33_U_47_U_57_U_63_U_71
"RTN","FBPCR2",103,0)
 ..W !
"RTN","FBPCR2",104,0)
 ..;S I=1 W ?$P(FBLOC,U,I),$P(FBDATA,U,I)
"RTN","FBPCR2",105,0)
 ..W ?1,$P(FBDATA,U,1) ;Service Date
"RTN","FBPCR2",106,0)
 ..;S I=2 W ?$P(FBLOC,U,I),$P($P(FBDATA,U,I),",")
"RTN","FBPCR2",107,0)
 ..W ?11,$P($P(FBDATA,U,2),",") ;CPT MOD
"RTN","FBPCR2",108,0)
 ..;F I=3:1:8 W ?$P(FBLOC,U,I),$P(FBDATA,U,I)
"RTN","FBPCR2",109,0)
 ..W ?31,$J($P(FBADJ,U,2),10) ;Units Paid
"RTN","FBPCR2",110,0)
 ..W ?43,$P(FBDATA,U,6) ;Batch No.
"RTN","FBPCR2",111,0)
 ..W ?54,$P(FBDATA,U,7) ;Invoice No.
"RTN","FBPCR2",112,0)
 ..W ?64,$P(FBDATA,U,8) ;Voucher Date
"RTN","FBPCR2",113,0)
 ..I $P($P(FBDATA,U,2),",",2)]"" D  Q:FBOUT
"RTN","FBPCR2",114,0)
 ...N FBI,FBMOD
"RTN","FBPCR2",115,0)
 ...F FBI=2:1 S FBMOD=$P($P(FBDATA,U,2),",",FBI) Q:FBMOD=""  D  Q:FBOUT
"RTN","FBPCR2",116,0)
 ....I $Y+7>IOSL D PAGE Q:FBOUT  W !,"  (continued)"
"RTN","FBPCR2",117,0)
 ....W !,?16,"-",FBMOD
"RTN","FBPCR2",118,0)
 ..W !,$P(FBDATA,U,3) ;Amt Claimed
"RTN","FBPCR2",119,0)
 ..W ?13,$P(FBDATA,U,4) ;Amt Paid
"RTN","FBPCR2",120,0)
 ..W ?23,$S($P(FBADJ,U,3)]"":$P(FBADJ,U,3),1:$P(FBDATA,U,5)) ;Adj Code
"RTN","FBPCR2",121,0)
 ..W ?33,$J($S($P(FBADJ,U,4)]"":$J($P(FBADJ,U,4),14),1:$P(FBADJ,U,1)),14) ;Adj Amts
"RTN","FBPCR2",122,0)
 ..W ?48,$P(FBADJ,U,5) ;Remit Remarks
"RTN","FBPCR2",123,0)
 ..W ?60,$P(FBADJ,U,6) ;Patient Account No.
"RTN","FBPCR2",124,0)
 ..W !,?3,$S(FBBILL:"Y",1:"N"),?9,FBBILL  ;FB*3.5*163 Billed Bill No.
"RTN","FBPCR2",125,0)
 ..W ?24,FBINAU  ;FB*3.5*163 Ins Auth No.
"RTN","FBPCR2",126,0)
 ..S FBPDX=$P(FBDATA,U,10),FBPDXC=$$ICD9^FBCSV1(FBPDX,$$DT2FMDT^FBCSV1($P(FBDATA,U))),$P(FBDATA,U,10)=$E($$ICD9P^FBCSV1(FBPDX,3,$$DT2FMDT^FBCSV1($P(FBDATA,U))),1,19),FBPDXC=$S(FBPDXC="":"",1:" ("_FBPDXC_")")
"RTN","FBPCR2",127,0)
 ..W !?3,"Primary Dx: ",$P(FBDATA,U,10),FBPDXC,?45,"S/C Condition? ",$P(FBDATA,U,9) W ?66,"Obl.#: ",$P(FBDATA,U,11)
"RTN","FBPCR2",128,0)
 ..I FBCATC!FBINS D
"RTN","FBPCR2",129,0)
 ...W !?5,">>>"
"RTN","FBPCR2",130,0)
 ...I FBCATC=0 W "Cost recover from insurance."
"RTN","FBPCR2",131,0)
 ...I FBCATC=1 W "Cost recover from means testing"_$S(FBINS:" and insurance.",1:".")
"RTN","FBPCR2",132,0)
 ...I FBCATC=2 W "Cost recover from LTC co-pay"_$S(FBINS:" and insurance.",1:".")
"RTN","FBPCR2",133,0)
 ...I FBCATC=3 W $S(FBINS:"Cost recover from insurance, ",1:"")_"1010EC Missing for LTC Patient."
"RTN","FBPCR2",134,0)
 ...I FBCATC=4 W $S(FBINS:"Cost Recover from insurance and ",1:"")_"Potential Cost Recover from LTC co-pay."
"RTN","FBPCR2",135,0)
 .. D PRNT5010(3,M)  ; FB*3.5*122
"RTN","FBPCR2",136,0)
 .. D PRTAUTH(M)  ; FB*3.5*163
"RTN","FBPCR2",137,0)
 ..S A3=".00"
"RTN","FBPCR2",138,0)
 I FB5010PV]"" D PRNT5010(2,FB5010PV)  ; FB*3.5*122
"RTN","FBPCR2",139,0)
 Q
"RTN","FBPCR2",140,0)
HDR ;main header
"RTN","FBPCR2",141,0)
 D HDR^FBPCR Q:FBOUT
"RTN","FBPCR2",142,0)
HDR1 W !!?(IOM-(13+$L(FBXPROG))/2),"NVC PROGRAM: ",FBXPROG ;FB*3.5*163 - Changed from FEE to NVC
"RTN","FBPCR2",143,0)
 ;W !!,?2,"Svc Date",?11,"CPT-MOD",?23,"Amount",?33," Amount",?42,"Susp",?49,"Travel",?57,"Batch",?63,"Invoice",?71,"Voucher"
"RTN","FBPCR2",144,0)
 ;W !,?23,"Claimed",?35,"Paid",?42,"Code",?50,"Paid",?58,"Num",?64,"Num",?72,"Date",!,FBDASH
"RTN","FBPCR2",145,0)
 W !!,?1,"Svc Date",?11,"CPT-MOD ",?19,"Travel Paid",?31,"Units Paid",?43,"Batch No.",?54,"Inv No.",?64,"Voucher Date"
"RTN","FBPCR2",146,0)
 ;W !,"Amt Claimed",?13,"Amt Paid",?23,"Adj Code",?36,"Adj Amounts",?48,"Remit Remark",?61,"Patient Account No",!,FBDASH
"RTN","FBPCR2",147,0)
 W !,"Amt Claimed",?13,"Amt Paid",?23,"Adj Code",?36,"Adj Amounts",?48,"Remit Remark",?61,"Patient Account No" ;FB*3.5*163
"RTN","FBPCR2",148,0)
 W !,"Billed?",?9,"Bill#",?24,"Ins Auth#",!,FBDASH ;FB*3.5*163
"RTN","FBPCR2",149,0)
 Q
"RTN","FBPCR2",150,0)
SH ;subheader - vendor, prints when name changed
"RTN","FBPCR2",151,0)
 I ($Y+6)>IOSL D HDR Q:FBOUT
"RTN","FBPCR2",152,0)
 ;W !!,"Vendor: ",$P(FBVI,";"),?41,"Vendor ID/NPI: ",$P(FBVI,";",2)
"RTN","FBPCR2",153,0)
 W !!,"Vendor: ",$P(FBVI,";"),?41,"Vendor ID: ",$P($P(FBVI,";",2),"/",1)
"RTN","FBPCR2",154,0)
 W !?20,"Fee Basis Billing Provider NPI: ",$P(FBVI,"/",2)
"RTN","FBPCR2",155,0)
 Q
"RTN","FBPCR2",156,0)
CR ;read for display
"RTN","FBPCR2",157,0)
 S DIR(0)="E" W ! D ^DIR K DIR S:$D(DUOUT)!($D(DTOUT)) FBOUT=1
"RTN","FBPCR2",158,0)
 Q
"RTN","FBPCR2",159,0)
PAGE ;new page
"RTN","FBPCR2",160,0)
 D HDR Q:FBOUT  D SH
"RTN","FBPCR2",161,0)
 Q
"RTN","FBPCR2",162,0)
PRNT5010(FBTYPE,FBNODE) ; Format and print based on data type  ; FB*3.5*122  FB*3.5*133
"RTN","FBPCR2",163,0)
 N FBVDAT,FBCNT
"RTN","FBPCR2",164,0)
 I $G(FBTYPE)=2 D  Q   ; Vender level
"RTN","FBPCR2",165,0)
 . I $G(FBPSF)]"",$G(FBPT)]"",$G(FBPI)]"",$G(FBNODE)]"",$G(^TMP($J,"FB",FBPSF,FBPT,FBPI,FBNODE))]"" S FBVDAT=^TMP($J,"FB",FBPSF,FBPT,FBPI,FBNODE)
"RTN","FBPCR2",166,0)
 . E  Q
"RTN","FBPCR2",167,0)
 . F FBCNT=1,6 I $P(FBVDAT,U,FBCNT)]"" D
"RTN","FBPCR2",168,0)
 .. W !,$P(FBPVLIST,U,FBCNT)_": "_$P(FBVDAT,U,FBCNT),?55,$P(FBPVLIST,U,FBCNT+1)_": "_$P(FBVDAT,U,FBCNT+1)
"RTN","FBPCR2",169,0)
 .. W !,?6,$P(FBPVLIST,U,FBCNT+2)_": "_$P(FBVDAT,U,FBCNT+2)
"RTN","FBPCR2",170,0)
 . F FBCNT=4,11,9 I $P(FBVDAT,U,FBCNT)]"" D
"RTN","FBPCR2",171,0)
 .. W !,$P(FBPVLIST,U,FBCNT)_": "_$P(FBVDAT,U,FBCNT),?55,$P(FBPVLIST,U,FBCNT+1)_": "_$P(FBVDAT,U,FBCNT+1)
"RTN","FBPCR2",172,0)
 . I $P(FBVDAT,U,20)]"" D
"RTN","FBPCR2",173,0)
 .. W !,"  SERVICING FACILITY ADDRESS: "_$P(FBVDAT,U,20),!,"                              "_$P(FBVDAT,U,21)_", "
"RTN","FBPCR2",174,0)
 .. I $P(FBVDAT,U,22)]"" W $$GET1^DIQ(5,$P(FBVDAT,U,22)_",",.01)
"RTN","FBPCR2",175,0)
 .. W " "_$P(FBVDAT,U,23),!
"RTN","FBPCR2",176,0)
 ;
"RTN","FBPCR2",177,0)
 I $G(FBTYPE)=3 D  Q   ; Line Item level
"RTN","FBPCR2",178,0)
 . I $G(FBPSF)]"",$G(FBPT)]"",$G(FBPI)]"",$G(FBVI)]"",$G(FBDT)]"",$G(FBNODE)]"",$G(^TMP($J,"FB",FBPSF,FBPT,FBPI,FBVI,FBDT,FBNODE,"FBDAT003"))]"" D
"RTN","FBPCR2",179,0)
 .. S FBVDAT=^TMP($J,"FB",FBPSF,FBPT,FBPI,FBVI,FBDT,FBNODE,"FBDAT003")
"RTN","FBPCR2",180,0)
 .. W !,?8,$P(FBLIPVL,U,3)_": "_$P(FBVDAT,U,3)
"RTN","FBPCR2",181,0)
 .. W !,?12,$P(FBLIPVL,U,4)_": "_$P(FBVDAT,U,4),?35,$P(FBLIPVL,U,5),": ",$P(FBVDAT,U,5),!!
"RTN","FBPCR2",182,0)
 . ;
"RTN","FBPCR2",183,0)
 . ; FB*3.5*133
"RTN","FBPCR2",184,0)
 . I $G(FBPSF)]"",$G(FBPT)]"",$G(FBPI)]"",$G(FBVI)]"",$G(FBDT)]"",$G(FBNODE)]"",$G(^TMP($J,"FB",FBPSF,FBPT,FBPI,FBVI,FBDT,FBNODE,"FBDAT004"))]"" D
"RTN","FBPCR2",185,0)
 .. S FBVDAT=^TMP($J,"FB",FBPSF,FBPT,FBPI,FBVI,FBDT,FBNODE,"FBDAT004")
"RTN","FBPCR2",186,0)
 .. F FBCNT=1,6 I $P(FBVDAT,U,FBCNT)]"" D
"RTN","FBPCR2",187,0)
 ... W !,$P(FBPVL133,U,FBCNT)_": "_$P(FBVDAT,U,FBCNT),?55,$P(FBPVL133,U,FBCNT+1)_": "_$P(FBVDAT,U,FBCNT+1)
"RTN","FBPCR2",188,0)
 ... W !,?6,$P(FBPVL133,U,FBCNT+2)_": "_$P(FBVDAT,U,FBCNT+2)
"RTN","FBPCR2",189,0)
 .. F FBCNT=4,11,9 I $P(FBVDAT,U,FBCNT)]"" D
"RTN","FBPCR2",190,0)
 ... W !,$P(FBPVL133,U,FBCNT)_": "_$P(FBVDAT,U,FBCNT),?55,$P(FBPVL133,U,FBCNT+1)_": "_$P(FBVDAT,U,FBCNT+1)
"RTN","FBPCR2",191,0)
 . ;
"RTN","FBPCR2",192,0)
 . I $G(FBPSF)]"",$G(FBPT)]"",$G(FBPI)]"",$G(FBVI)]"",$G(FBDT)]"",$G(FBNODE)]"",$G(^TMP($J,"FB",FBPSF,FBPT,FBPI,FBVI,FBDT,FBNODE,"FBDAT005"))]"" D
"RTN","FBPCR2",193,0)
 .. S FBVDAT=^TMP($J,"FB",FBPSF,FBPT,FBPI,FBVI,FBDT,FBNODE,"FBDAT005")
"RTN","FBPCR2",194,0)
 .. W !,"  SERVICING FACILITY ADDRESS: "_$P(FBVDAT,U,1),!,"                              "_$P(FBVDAT,U,2)_", "
"RTN","FBPCR2",195,0)
 .. I $P(FBVDAT,U,3)]"" W $$GET1^DIQ(5,$P(FBVDAT,U,3)_",",.01)
"RTN","FBPCR2",196,0)
 .. W " "_$P(FBVDAT,U,4),!
"RTN","FBPCR2",197,0)
 Q
"RTN","FBPCR2",198,0)
 ;
"RTN","FBPCR2",199,0)
FBAUTH(FBAUTH,FBDFN) ;Get Authorization Data if it exists FB*3.5*163
"RTN","FBPCR2",200,0)
 N FBIEN
"RTN","FBPCR2",201,0)
 S (FBADX1,FBADX2,FBADX3,FBAICD,FBAREF,FBAREFA,FBARNPI,FBAVND,FBAVNDA,FBAVNPI,FBAVTAX)=""
"RTN","FBPCR2",202,0)
 Q:FBAUTH=""
"RTN","FBPCR2",203,0)
 S FBIEN=FBAUTH_","_FBDFN_","
"RTN","FBPCR2",204,0)
 S FBADX1=$$GET1^DIQ(161.01,FBIEN_",",.08)
"RTN","FBPCR2",205,0)
 S FBADX2=$$GET1^DIQ(161.01,FBIEN_",",.085)
"RTN","FBPCR2",206,0)
 S FBADX3=$$GET1^DIQ(161.01,FBIEN_",",.086)
"RTN","FBPCR2",207,0)
 S FBAICD=$$GET1^DIQ(161.01,FBIEN_",",.087)
"RTN","FBPCR2",208,0)
 S FBAREF=$$GET1^DIQ(161.01,FBIEN_",",104)
"RTN","FBPCR2",209,0)
 S FBAREFA=$$GET1^DIQ(161.01,FBIEN_",",104,"I")
"RTN","FBPCR2",210,0)
 I FBAREFA'="" S FBARNPI=$$GET1^DIQ(200,FBAREFA_",",41.99)
"RTN","FBPCR2",211,0)
 S FBAVND=$$GET1^DIQ(161.01,FBIEN_",",.04)
"RTN","FBPCR2",212,0)
 S FBAVNDA=$$GET1^DIQ(161.01,FBIEN_",",.04,"I")
"RTN","FBPCR2",213,0)
 I FBAVNDA'="" D
"RTN","FBPCR2",214,0)
 . S FBAVNPI=$$GET1^DIQ(161.2,FBAVNDA_",",41.01)
"RTN","FBPCR2",215,0)
 . S FBAVTAX=$$GET1^DIQ(161.2,FBAVNDA_",",42)
"RTN","FBPCR2",216,0)
 Q
"RTN","FBPCR2",217,0)
 ;
"RTN","FBPCR2",218,0)
PRTAUTH(FBX) ;Print Data from Authorization FB*3.5*163
"RTN","FBPCR2",219,0)
 N FBAUPR
"RTN","FBPCR2",220,0)
 I '$D(^TMP($J,"FB",FBPSF,FBPT,FBPI,FBVI,FBDT,FBX,"FBAUTH")) Q
"RTN","FBPCR2",221,0)
 S FBAUPR=^TMP($J,"FB",FBPSF,FBPT,FBPI,FBVI,FBDT,FBX,"FBAUTH")
"RTN","FBPCR2",222,0)
 W !,"** Authorization Data **"
"RTN","FBPCR2",223,0)
 W !,"  Diagnosis:  ",$P(FBAUPR,U,1)," / ",$P(FBAUPR,U,2)," / ",$P(FBAUPR,U,3)," / ",$P(FBAUPR,U,4)
"RTN","FBPCR2",224,0)
 W !,"  Rendering Provider:  "_$P(FBAUPR,U,7)
"RTN","FBPCR2",225,0)
 W !,"    NPI:  "_$P(FBAUPR,U,8),?30,"TAXONOMY CODE: "_$P(FBAUPR,U,9)
"RTN","FBPCR2",226,0)
 W !,"  Referring Provider:  "_$P(FBAUPR,U,5)
"RTN","FBPCR2",227,0)
 W !,"    NPI:  "_$P(FBAUPR,U,6)
"RTN","FBPCR2",228,0)
 W !
"RTN","FBPCR2",229,0)
 Q
"RTN","FBPCR3")
0^19^B30358812^B26362342
"RTN","FBPCR3",1,0)
FBPCR3 ;AISC/GRR,TET-PHARMACY POTENTIAL COST RECOVERY, SORT/PRINT ;6/30/2006
"RTN","FBPCR3",2,0)
 ;;3.5;FEE BASIS;**48,69,98,163,166**;JAN 30, 1995;Build 21
"RTN","FBPCR3",3,0)
 ;Per VA Directive 6402, this routine should not be modified.
"RTN","FBPCR3",4,0)
 ;
"RTN","FBPCR3",5,0)
EN ;entry point
"RTN","FBPCR3",6,0)
 S (FBCATC,FBINS,FBPSF)=0
"RTN","FBPCR3",7,0)
SORT ;sort by date certified for payment, patient, invoice number ien, rx ien
"RTN","FBPCR3",8,0)
 S I=FBBDATE-.1 F  S I=$O(^FBAA(162.1,"AA",I)) Q:'I!(I>FBEDATE)  S J=0 F  S J=$O(^FBAA(162.1,"AA",I,J)) Q:'J  D
"RTN","FBPCR3",9,0)
 .S DFN=J D VET^FBPCR
"RTN","FBPCR3",10,0)
 .S K=0 F  S K=$O(^FBAA(162.1,"AA",I,J,K)) Q:K'>0  S L=0 F  S L=$O(^FBAA(162.1,"AA",I,J,K,L)) Q:L'>0  D  S (FBCATC,FBINS,FBPSF)=0
"RTN","FBPCR3",11,0)
 ..D SET Q:'FBPSV&('$D(FBPSV(FBPSF)))  I FBCATC!FBINS D SETTMP
"RTN","FBPCR3",12,0)
KILL ;kill variables set in sort
"RTN","FBPCR3",13,0)
 K A1,A2,DFN,FBAAA,FBAC,FBAP,FBBATCH,FBCATC,FBDA1,FBDRUG,FBFD,FBFD1,FBIN,FBINS,FBINVN,FBLOC,FBPAT,FBPD,FBPSF,FBPV,FBQTY,FBREIM,FBRX,FBSC,FBSTR,FBSUSP,FBVEN,FBVI,I,J,K,L,N,V,Y
"RTN","FBPCR3",14,0)
 K FBVNAME,FBVID,FBVCHAIN,FBPNAME,FBPID,FBDOB
"RTN","FBPCR3",15,0)
 K FBADJLA,FBADJLR,TAMT,FBRRMKL
"RTN","FBPCR3",16,0)
 K FBAUTH,FBIEN,FBX ;FB*3.5*163
"RTN","FBPCR3",17,0)
 D KILL^FBPCR2
"RTN","FBPCR3",18,0)
 Q
"RTN","FBPCR3",19,0)
SET ;set variables
"RTN","FBPCR3",20,0)
 N FBIEN,FBX ;FB*3.5*163
"RTN","FBPCR3",21,0)
 S Y(0)=$G(^FBAA(162.1,+K,"RX",+L,0)) I Y(0)']""!($P(Y(0),U,9)=1) Q
"RTN","FBPCR3",22,0)
 I $G(^FBAA(162.1,+K,"RX",+L,"FBREJ"))]"" Q
"RTN","FBPCR3",23,0)
 S Y(2)=$G(^FBAA(162.1,+K,0))
"RTN","FBPCR3",24,0)
 S Y(1)=$G(^FBAA(162.1,+K,"RX",+L,2))
"RTN","FBPCR3",25,0)
 S FBX=$$ADJLRA^FBRXFA(+L_","_+K_",")
"RTN","FBPCR3",26,0)
 S FBADJLR=$P(FBX,U) ;adjustment code
"RTN","FBPCR3",27,0)
 S FBADJLA=$P(FBX,U,2) ;adjustment amount
"RTN","FBPCR3",28,0)
 S TAMT=$FN($P(Y(0),"^",7),"",2) ;suspend amount
"RTN","FBPCR3",29,0)
 S FBRRMKL=$$RRL^FBRXFR(+L_","_+K_",") ;remitt remarks
"RTN","FBPCR3",30,0)
 S FBPSF=+$P(Y(1),U,5),FBFD=$P(Y(0),U,3),FBAAA=$P(Y(0),U,5)
"RTN","FBPCR3",31,0)
 Q:'FBPSV&('$D(FBPSV(FBPSF)))  S FBCATC=$$CATC^FBPCR(DFN,FBFD)
"RTN","FBPCR3",32,0)
 ;,FBINS=$S($O(^FBAAA("AIC",FBAAA,+$O(^FBAAA("AIC",FBAAA,-FBFD)),0))="Y":1,1:0)
"RTN","FBPCR3",33,0)
 S FBINS=$S($$INSCK(FBFD,FBAAA,FBPI)=1:$$INSURED^FBPCR4(DFN,FBFD),1:0)
"RTN","FBPCR3",34,0)
 Q:'FBCATC&'FBINS
"RTN","FBPCR3",35,0)
 S FBINVN=$P(Y(2),U) D VEN
"RTN","FBPCR3",36,0)
 S FBRX=$P(Y(0),U,1),FBDRUG=$P(Y(0),U,2),FBAC=$P(Y(0),U,4),FBAP=$P(Y(0),U,16),FBSUSP=$P(Y(0),U,8),FBPD=$P(Y(0),U,19),FBBATCH=$P(Y(0),U,17),FBBATCH=$P($G(^FBAA(161.7,+FBBATCH,0)),U)
"RTN","FBPCR3",37,0)
 I FBSUSP]"" S FBSUSP=$P($G(^FBAA(161.27,+FBSUSP,0)),U)
"RTN","FBPCR3",38,0)
 S FBREIM=$S($P(Y(0),U,20)="R":"*",1:""),FBSTR=$P(Y(0),U,12),FBQTY=$P(Y(0),U,13),A1=$J(FBAC,6,2),A2=$J(FBAP,6,2),FBPV=""
"RTN","FBPCR3",39,0)
 S FBPD=$$DATX^FBAAUTL(FBPD),FBFD=$$DATX^FBAAUTL(FBFD)
"RTN","FBPCR3",40,0)
 S FBPV=$S($P(Y(1),U,3)="V":"#",1:""),FBFD1=$S(FBPV="":" ",1:FBPV)_$S(FBREIM="":" ",1:FBREIM)_FBFD,FBRX="Rx: "_FBRX
"RTN","FBPCR3",41,0)
 S FBVEN=FBVNAME_";"_FBVID,FBPAT=FBPNAME_";"_DFN
"RTN","FBPCR3",42,0)
 S FBAUTH=$P(Y(1),U,7) ;Get linked auth FB*3.5*163
"RTN","FBPCR3",43,0)
 I FBAUTH D FBAUTH^FBPCR2(FBAUTH,DFN)  ;FB*3.5*163
"RTN","FBPCR3",44,0)
 Q
"RTN","FBPCR3",45,0)
SETTMP ;sort data by primary service facility, patient, fee program, vendor, date
"RTN","FBPCR3",46,0)
 Q:$$FILTER^FBPCR4()=0
"RTN","FBPCR3",47,0)
 S ^TMP($J,"FB",FBPSF,FBPAT,FBPI,FBVEN,I,K_L)=FBFD1_U_FBRX_U_FBDRUG_U_FBSTR_U_FBQTY_U_A1_U_A2_U_FBSUSP_U_FBINVN_U_FBBATCH_U_FBPD_U_FBDOB_U_FBVCHAIN_U_FBPI_U_FBCATC_U_FBINS
"RTN","FBPCR3",48,0)
 S ^TMP($J,"FB",FBPSF,FBPAT,FBPI,FBVEN,I,K_L,"FBADJ")=FBADJLR_U_FBADJLA_U_FBRRMKL_U_TAMT
"RTN","FBPCR3",49,0)
 S ^TMP($J,"FB",FBPSF,FBPAT,FBPI,FBVEN,I,K_L,"FBAUTH")=$G(FBADX1)_U_$G(FBADX2)_U_$G(FBADX3)_U_$G(FBAICD)_U_$G(FBAREF)_U_$G(FBARNPI)_U_$G(FBAVND)_U_$G(FBAVNPI)_U_$G(FBAVTAX) ; FB*3.5*163
"RTN","FBPCR3",50,0)
 S ^TMP($J,"FB",FBPSF,FBPAT,FBPI,FBVEN)=FBVCHAIN,^TMP($J,"FB",FBPSF,FBPAT)=FBDOB
"RTN","FBPCR3",51,0)
 ;S FBIN(5)=$P(Y(1),U,6) I FBIN(5)]"",$D(^TMP($J,"FB",FBPSF,FBPAT,FBPI,FBVEN,I,L)) D ANC^FBPCR67
"RTN","FBPCR3",52,0)
 Q
"RTN","FBPCR3",53,0)
VEN ;set variables for vendor
"RTN","FBPCR3",54,0)
 S V=$G(^FBAAV(+$P(Y(2),U,4),0)),FBVNAME=$E($P(V,U),1,23),FBVID=$P(V,U,2),FBVCHAIN=$P(V,U,10)
"RTN","FBPCR3",55,0)
 Q
"RTN","FBPCR3",56,0)
PRINT ;write output
"RTN","FBPCR3",57,0)
 I FBPG>1&(($Y+10)>IOSL) D HDR Q:FBOUT
"RTN","FBPCR3",58,0)
 E  D HDR1 Q:FBOUT
"RTN","FBPCR3",59,0)
 S FBVI="" F  S FBVI=$O(^TMP($J,"FB",FBPSF,FBPT,FBPI,FBVI)) Q:FBVI']""!(FBOUT)  D SH Q:FBOUT  D  Q:FBOUT
"RTN","FBPCR3",60,0)
 .S FBDT=0 F  S FBDT=$O(^TMP($J,"FB",FBPSF,FBPT,FBPI,FBVI,FBDT)) Q:'FBDT  S L=0 F  S L=$O(^TMP($J,"FB",FBPSF,FBPT,FBPI,FBVI,FBDT,L)) Q:'L  D  Q:FBOUT
"RTN","FBPCR3",61,0)
 ..I ($Y+6)>IOSL D PAGE Q:FBOUT
"RTN","FBPCR3",62,0)
 ..S FBDATA=^TMP($J,"FB",FBPSF,FBPT,FBPI,FBVI,FBDT,L),FBCATC=$P(FBDATA,U,15),FBINS=$P(FBDATA,U,16)
"RTN","FBPCR3",63,0)
 ..S FBADJ=^TMP($J,"FB",FBPSF,FBPT,FBPI,FBVI,FBDT,L,"FBADJ")
"RTN","FBPCR3",64,0)
 ..W !,$P(FBDATA,U),?64,$P(FBDATA,U,11),!
"RTN","FBPCR3",65,0)
 ..W ?2,$P(FBDATA,U,2),?15,$P(FBDATA,U,3),?45,$P(FBDATA,U,4),?63,$P(FBDATA,U,5)
"RTN","FBPCR3",66,0)
 ..W !?4,$P(FBDATA,U,6),?12,$P(FBDATA,U,7)
"RTN","FBPCR3",67,0)
 ..W ?20 I $P(FBADJ,U,1)]"" W $P(FBADJ,U,1),?30,$J($P(FBADJ,U,2),14)
"RTN","FBPCR3",68,0)
 ..;If no adjustment code then print suspend cpde amd amount
"RTN","FBPCR3",69,0)
 ..I $P(FBADJ,U,1)="" W $P(FBDATA,U,8),?30,$J($P(FBADJ,U,4),14)
"RTN","FBPCR3",70,0)
 ..W ?47,$P(FBDATA,U,9),?58,$P(FBDATA,U,10),?66,$P(FBADJ,U,3)
"RTN","FBPCR3",71,0)
 ..I FBCATC!FBINS W !?5,">>> Cost recover from "_$S(FBCATC:"means testing",FBINS:"insurance",1:"") W:FBCATC&FBINS " and insurance" W "."
"RTN","FBPCR3",72,0)
 ..W ! D PRTAUTH^FBPCR2(L)  ; FB*3.5*163
"RTN","FBPCR3",73,0)
 ..W !
"RTN","FBPCR3",74,0)
EXIT ;kill and quit
"RTN","FBPCR3",75,0)
 Q
"RTN","FBPCR3",76,0)
HDR ;main header
"RTN","FBPCR3",77,0)
 D HDR^FBPCR Q:FBOUT
"RTN","FBPCR3",78,0)
HDR1 W !!?(IOM-(13+$L(FBXPROG))/2),"NVC PROGRAM: ",FBXPROG ;FB*3.5*163 Changed from FEE to NVC
"RTN","FBPCR3",79,0)
 W !?4,"Fill Date",?64,"Date Certified"
"RTN","FBPCR3",80,0)
 W !,?15,"Drug Name",?44,"Strength",?60,"Quantity"
"RTN","FBPCR3",81,0)
 W !?2,"Claimed",?12,"Paid",?20,"Adj Code",?33,"Adj Amounts",?47,"Invoice #",?58,"Batch #",?66,"Remit Remarks",!,FBDASH
"RTN","FBPCR3",82,0)
 Q
"RTN","FBPCR3",83,0)
SH ;subheader - vendor, prints when name changes
"RTN","FBPCR3",84,0)
 I ($Y+4)>IOSL D HDR Q:FBOUT
"RTN","FBPCR3",85,0)
 W !!,"Vendor: ",$P(FBVI,";"),?41,"Vendor ID: ",$P($P(FBVI,";",2),"/",1),?65,"Chain #: ",$P($G(^TMP($J,"FB",FBPSF,FBPT,FBPI,FBVI)),U)
"RTN","FBPCR3",86,0)
 W !?20,"Fee Basis Billing Provider NPI: ",$P(FBVI,"/",2)
"RTN","FBPCR3",87,0)
 Q
"RTN","FBPCR3",88,0)
CR ;read for display
"RTN","FBPCR3",89,0)
 S DIR(0)="E" W ! D ^DIR K DIR S:$D(DUOUT)!($D(DTOUT)) FBOUT=1
"RTN","FBPCR3",90,0)
 Q
"RTN","FBPCR3",91,0)
PAGE ;new page
"RTN","FBPCR3",92,0)
 D HDR Q:FBOUT  D SH
"RTN","FBPCR3",93,0)
 Q
"RTN","FBPCR3",94,0)
 ;FB*3.5*163 - modified to process yes or no Potential Cost Recovery value.
"RTN","FBPCR3",95,0)
INSCK(FBDT,FBDA1,FBPI) ;possible cost recovery fcn call
"RTN","FBPCR3",96,0)
 ;Passed variables:  fbdt=fill date or treatment from date
"RTN","FBPCR3",97,0)
 ;                   fbda1=ien if fee patient file, patient ien
"RTN","FBPCR3",98,0)
 ;                   fbpi=fee program
"RTN","FBPCR3",99,0)
 ;Output variables:  fbins=1 if possible recovery, 0 if no
"RTN","FBPCR3",100,0)
 N FBDA,FBFLAG,FBINS
"RTN","FBPCR3",101,0)
 S FBINS=0,FBFLAG=0,FBDT=FBDT+.1,FBDT=+$O(^FBAAA("AIC",FBDA1,-FBDT))
"RTN","FBPCR3",102,0)
 I FBDT S FBINS=$O(^FBAAA("AIC",FBDA1,FBDT,"N")) I FBINS="Y"!(FBINS="N") D
"RTN","FBPCR3",103,0)
 .S FBDA=0 F  S FBDA=$O(^FBAAA("AIC",FBDA1,FBDT,FBINS,FBDA)) Q:'FBDA  D  ; Get both inpatient and outpatient pcr - FB*3.5*166
"RTN","FBPCR3",104,0)
 ..I $P($G(^FBAAA(FBDA1,1,FBDA,0)),U,3)=FBPI S FBFLAG=1
"RTN","FBPCR3",105,0)
 I 'FBFLAG S FBINS=0
"RTN","FBPCR3",106,0)
 Q $S(FBINS="Y":1,FBINS="N":1,1:0)
"RTN","FBPCR67")
0^20^B34734633^B27989751
"RTN","FBPCR67",1,0)
FBPCR67 ;AISC/DMK,TET-CH/CNH POTENTIAL COST RECOVERY SORT ;7/5/2013
"RTN","FBPCR67",2,0)
 ;;3.5;FEE BASIS;**4,48,55,69,98,122,108,148,163**;JAN 30, 1995;Build 21
"RTN","FBPCR67",3,0)
 ;Per VA Directive 6402, this routine should not be modified.
"RTN","FBPCR67",4,0)
 ;
"RTN","FBPCR67",5,0)
EN ;entry point for sort
"RTN","FBPCR67",6,0)
 S (FBCATC,FBINS,FBPSF)=0
"RTN","FBPCR67",7,0)
SORT ;sort by date finalized, ien
"RTN","FBPCR67",8,0)
 N FBY2,FBY5,FBCDAYS,FBCSID,FBX,FBADJLR,FBADJLA,FBRRMKL
"RTN","FBPCR67",9,0)
 S FBM=FBBDATE-.1 F  S FBM=$O(^FBAAI("AD",FBM)) Q:'FBM!(FBM>FBEDATE)  S FBI=0 F  S FBI=$O(^FBAAI("AD",FBM,FBI)) Q:FBI'>0  S FBIN=$G(^FBAAI(FBI,0)) I FBIN]""&($G(^FBAAI(FBI,"FBREJ"))']"") D  S (FBCATC,FBINS,FBPSF)=0
"RTN","FBPCR67",10,0)
 .S (DFN,J)=+$P(FBIN,U,4) D VET^FBPCR
"RTN","FBPCR67",11,0)
 .D SET Q:FBPI'[+$P(FBIN,U,12)!('FBPSV&('$D(FBPSV(FBPSF))))  I FBCATC!FBINS D SETTMP
"RTN","FBPCR67",12,0)
KILL ;kill variables set in this routine and in FPAY2, sort/set sections
"RTN","FBPCR67",13,0)
 K A1,A2,A3,D,D2,DFN,FBAACPTC,FBBN,FBCATC,FBCNT,FBCP,FBDOB,FBDT,FBDT1,FBDX,FBDX1,FBI,FBIN,FBINS,FBIX,FBJ,FBM,FBOB,FBPAT,FBPDX,FBPROC,FBPROC1,FBPSF,FBSC,FBTA,FBVEN,FBVENID,FBVP,I,J,K,L,M,Y,FBPOA,FBPROA,FBADMTDX
"RTN","FBPCR67",14,0)
 K FBVNAME,FBVID,FBPNAME,FBPID
"RTN","FBPCR67",15,0)
 K FBY2,FBY4,FBCDAYS,FBCSID,FBX,FBADJLR,FBADJLA,FBRRMKL   ; FB*3.5*122
"RTN","FBPCR67",16,0)
 D KILL^FBPCR2
"RTN","FBPCR67",17,0)
 Q
"RTN","FBPCR67",18,0)
SET ;set variables
"RTN","FBPCR67",19,0)
 S FBY2=$G(^FBAAI(FBI,2)),FBY4=$G(^FBAAI(FBI,4)),$P(FBY4,U,20)=$P($G(^FBAAI(FBI,5)),U,1,4)  ; FB*3.5*122
"RTN","FBPCR67",20,0)
 S FBY5=$G(^FBAAI(FBI,5))
"RTN","FBPCR67",21,0)
 F FBJ=1,2,3,4,6,7,8,9,11,13,14 S FBIN(FBJ)=$P(FBIN,"^",FBJ)
"RTN","FBPCR67",22,0)
 Q:FBPI'[+$P(FBIN,U,12)  S FBPSF=+$P(FBIN,U,20)
"RTN","FBPCR67",23,0)
 Q:'FBPSV&('$D(FBPSV(FBPSF)))
"RTN","FBPCR67",24,0)
 S ^TMP($J,"FB",FBPSF)=$G(^FBAAI(FBI,5))  ; FB*3.5*122
"RTN","FBPCR67",25,0)
 D
"RTN","FBPCR67",26,0)
 . N FBCATC2
"RTN","FBPCR67",27,0)
 . S FBCATC=$$CATC^FBPCR(DFN,+$P(FBIN,U,6),+$P(FBIN,U,18))
"RTN","FBPCR67",28,0)
 . Q:FBCATC=2
"RTN","FBPCR67",29,0)
 . S FBCATC2=$$CATC^FBPCR(DFN,+$P(FBIN,U,7),+$P(FBIN,U,18))
"RTN","FBPCR67",30,0)
 . I FBCATC2=0 Q
"RTN","FBPCR67",31,0)
 . I FBCATC=0!(FBCATC=1) S FBCATC=FBCATC2 Q
"RTN","FBPCR67",32,0)
 . S:FBCATC2=2 FBCATC=2
"RTN","FBPCR67",33,0)
 ;,FBINS=$S($O(^FBAAA("AIC",FBIN(4),+$O(^FBAAA("AIC",FBIN(4),-FBIN(6))),0))="Y":1,1:0)
"RTN","FBPCR67",34,0)
 S FBINS=$S($$INSCK^FBPCR3(FBIN(6),FBIN(4),+$P(FBIN,U,12))=1:$$INSURED^FBPCR4(DFN,+$P(FBIN,U,6),+$P(FBIN,U,7)),1:0)
"RTN","FBPCR67",35,0)
 Q:'FBCATC&'FBINS
"RTN","FBPCR67",36,0)
 S FBIN(5)=$P(FBIN,U,5)
"RTN","FBPCR67",37,0)
 S FBIEN=FBIN(3),FBVNAME=$G(^FBAAV(FBIN(3),0)) Q:FBVNAME']""  S FBVID=$P(FBVNAME,U,2)_"/"_$S($P($G(^FBAAV(FBIEN,3)),U,2)]"":$P($G(^FBAAV(FBIEN,3)),U,2),1:"**********"),FBVNAME=$E($P(FBVNAME,U),1,23)
"RTN","FBPCR67",38,0)
 S FBIN(2)=$$DATX^FBAAUTL(FBIN(2)),FBVEN=FBVNAME_";"_FBVID,FBPAT=FBPNAME_";"_DFN
"RTN","FBPCR67",39,0)
 S FBIN(6)=$$DATX^FBAAUTL(FBIN(6)),FBIN(7)=$$DATX^FBAAUTL(FBIN(7))
"RTN","FBPCR67",40,0)
 Q
"RTN","FBPCR67",41,0)
SETTMP ;sort data by primary service facility, patient, fee program, vendor, date
"RTN","FBPCR67",42,0)
 N FBBILL,FBINAU,FBSKIP  ;FB*3.5*163
"RTN","FBPCR67",43,0)
 S FBSKIP=0,(FBBILL,FBINAU)=""  ;FB*3.5*163
"RTN","FBPCR67",44,0)
 Q:$$FILTER^FBPCR4()=0
"RTN","FBPCR67",45,0)
 D CHKBILL^IBFBUTIL(FBIN) ;FB*3.5*163
"RTN","FBPCR67",46,0)
 I $G(FBSKIP),$G(FBNPB) Q  ;Quit if running for not previously billed and bill IEN exists on File #360 FB*3.5*163
"RTN","FBPCR67",47,0)
 S ^TMP($J,"FB",FBPSF,FBPAT,+$P(FBIN,U,12),FBVEN,FBM,FBI)=FBIN(2)_U_$J(FBIN(8),8,2)_U_$J(FBIN(9),8,2)_U_FBIN(11)_U_$J(FBIN(1),8)_U_FBIN(6)_U_FBIN(7)_U_$P(FBIN,U,12)_U_FBCATC_U_FBINS_U_FBIN(13)_U_FBIN(14)
"RTN","FBPCR67",48,0)
 S FBCDAYS=$P(FBY2,U,10) ; covered days
"RTN","FBPCR67",49,0)
 S FBCSID=$P(FBY2,U,11) ; patient control number
"RTN","FBPCR67",50,0)
 S FBX=$$ADJLRA^FBCHFA(FBI_",")
"RTN","FBPCR67",51,0)
 S FBADJLR=$P(FBX,U) ;adjustment reason
"RTN","FBPCR67",52,0)
 S FBADJLA=$P(FBX,U,2) ;adjustment amount
"RTN","FBPCR67",53,0)
 S FBRRMKL=$$RRL^FBCHFR(FBI_",") ;remittance remarks
"RTN","FBPCR67",54,0)
 S FBADMTDX=$$ICD9^FBCSV1($P(FBY5,"^",9))  ; admitting diagnosis
"RTN","FBPCR67",55,0)
 S ^TMP($J,"FB",FBPSF,FBPAT,+$P(FBIN,U,12),FBVEN,FBM,FBI,"FBINV")=FBCDAYS_"^"_FBCSID_"^"_FBADJLR_"^"_FBADJLA_"^"_FBRRMKL_"^"_FBADMTDX
"RTN","FBPCR67",56,0)
 ;S FBDX=$G(^FBAAI(FBI,"DX")) I FBDX]"" S FBDX1="" F I=1:1:5 S:$P(FBDX,U,I) FBDX1=FBDX1_$$ICD9^FBCSV1($P(FBDX,U,I),+$P($G(FBIN),U,6))_U
"RTN","FBPCR67",57,0)
 S FBDX=$G(^FBAAI(FBI,"DX"))
"RTN","FBPCR67",58,0)
 S FBPOA=$G(^FBAAI(FBI,"POA"))
"RTN","FBPCR67",59,0)
 I FBDX]"" S FBDX1="" F I=1:1:25 D
"RTN","FBPCR67",60,0)
 . N FBPOA1
"RTN","FBPCR67",61,0)
 . Q:$P(FBDX,U,I)=""
"RTN","FBPCR67",62,0)
 . S FBPOA1=$P(FBPOA,U,I)
"RTN","FBPCR67",63,0)
 . S FBDX1=FBDX1_$$ICD9^FBCSV1($P(FBDX,U,I),+$P($G(FBIN),U,6))_"/"
"RTN","FBPCR67",64,0)
 . S FBDX1=FBDX1_$S(FBPOA1:$P($G(^FB(161.94,FBPOA1,0)),"^"),1:"")_U
"RTN","FBPCR67",65,0)
 . Q
"RTN","FBPCR67",66,0)
 I FBDX]"" S FBDX1=$P(FBDX1,U,1,($L(FBDX1,U)-1)),^TMP($J,"FB",FBPSF,FBPAT,+$P(FBIN,U,12),FBVEN,FBM,FBI,"DX")=FBDX1
"RTN","FBPCR67",67,0)
 S FBPROC=$G(^FBAAI(FBI,"PROC")) I FBPROC]"" S FBPROC1="" F I=1:1:25 S:$P(FBPROC,U,I) FBPROC1=FBPROC1_$$ICD0^FBCSV1($P(FBPROC,U,I),+$P($G(FBIN),U,6))_U
"RTN","FBPCR67",68,0)
 I FBPROC]"" S FBPROC1=$P(FBPROC1,U,1,($L(FBPROC1,U)-1)),^TMP($J,"FB",FBPSF,FBPAT,+$P(FBIN,U,12),FBVEN,FBM,FBI,"PROC")=FBPROC1
"RTN","FBPCR67",69,0)
 ;*** removed conditional to get ancillary payments processed
"RTN","FBPCR67",70,0)
 ;D ANC:$D(^TMP($J,"FB",FBPSF,FBPAT,FBPI,FBVEN,FBM,FBI))
"RTN","FBPCR67",71,0)
 D ANC
"RTN","FBPCR67",72,0)
 K FB5010
"RTN","FBPCR67",73,0)
 ;get line item rendering provider data
"RTN","FBPCR67",74,0)
 I FBPROC]"" S I=0 F  S I=$O(^FBAAI(FBI,"RPROV",I)) Q:'I  D
"RTN","FBPCR67",75,0)
 . N X
"RTN","FBPCR67",76,0)
 . S X=$G(^FBAAI(FBI,"RPROV",I,0))
"RTN","FBPCR67",77,0)
 . I $P(X,U) S FB5010($P(X,U))=X
"RTN","FBPCR67",78,0)
 I $D(FB5010) M ^TMP($J,"FB",FBPSF,FBPAT,+$P(FBIN,U,12),FBVEN,FBM,FBI,"RPROV")=FB5010 K FB5010
"RTN","FBPCR67",79,0)
 I $TR(FBY4,U)]"" S ^TMP($J,"FB",FBPSF,FBPAT,+$P(FBIN,U,12),FBVEN,FBM,FBI,"FBY4")=FBY4         ; FB*3.5*122
"RTN","FBPCR67",80,0)
 I FBBILL S ^TMP($J,"FB",FBPSF,FBPAT,+$P(FBIN,U,12),FBVEN,FBM,FBI,"FBBILL")=FBBILL  ; FB*3.5*163 Bill Number
"RTN","FBPCR67",81,0)
 I FBINAU S ^TMP($J,"FB",FBPSF,FBPAT,+$P(FBIN,U,12),FBVEN,FBM,FBI,"FBINAU")=FBINAU  ; FB*3.5*163 Insurance Auth
"RTN","FBPCR67",82,0)
 I $G(FBAUTH)'="" S ^TMP($J,"FB",FBPSF,FBPAT,+$P(FBIN,U,12),FBVEN,FBM,FBI,"FBAUTH")=$G(FBADX1)_U_$G(FBADX2)_U_$G(FBADX3)_U_$G(FBAICD)_U_$G(FBAREF)_U_$G(FBARNPI)_U_$G(FBAVND)_U_$G(FBAVNPI)_U_$G(FBAVTAX) ; FB*3.5*163
"RTN","FBPCR67",83,0)
 ;I FBPROC]"" K FB5010 F I=1:1:25 S:$P(FBPROC,U,I) FB5010(I)=$G(^FBAAI(FBI,"RPROV",I,0))          ; FB*3.5*122
"RTN","FBPCR67",84,0)
 ;I FBPROC]"" K FB5010 F I=1:1:25 S:$P(FBPROC,U,I) FB5010($P($G(^FBAAI(FBI,"RPROV",I,0)),U,1))=$G(^FBAAI(FBI,"RPROV",I,0))
"RTN","FBPCR67",85,0)
 ;I FBPROC]"" M ^TMP($J,"FB",FBPSF,FBPAT,+$P(FBIN,U,12),FBVEN,FBM,FBI,"RPROV")=FB5010 K FB5010   ; FB*3.5*122 
"RTN","FBPCR67",86,0)
 Q
"RTN","FBPCR67",87,0)
ANC ;ancillary payments
"RTN","FBPCR67",88,0)
 ;Patch FB*3.5*148 saves off any previous values and then cleans up variable FBAACPTC
"RTN","FBPCR67",89,0)
 N J,K,L,M,Y,FBDT1,FBVID,FBAACPTC I FBPI=67 N FBPI S FBPI=+$P(FBIN,U,12)
"RTN","FBPCR67",90,0)
 S J=DFN,FBCNT=0 I J,+FBIN(5),$D(^FBAAC("AM",FBIN(5),J)) D
"RTN","FBPCR67",91,0)
 .F K=0:0 S K=$O(^FBAAC("AM",FBIN(5),J,K)) Q:'K  S L=0 F  S L=$O(^FBAAC("AM",FBIN(5),J,K,L)) Q:'L  D
"RTN","FBPCR67",92,0)
 ..S FBDT1=$P($G(^FBAAC(J,1,K,1,L,0)),U) I FBDT1]"" S FBDT1=$$DATX^FBAAUTL(FBDT1)
"RTN","FBPCR67",93,0)
 ..S M=0 F  S M=$O(^FBAAC("AM",FBIN(5),J,K,L,M)) Q:'M  S Y=$G(^FBAAC(J,1,K,1,L,1,M,0)) I Y]"" D
"RTN","FBPCR67",94,0)
 ...K FBAACPTC
"RTN","FBPCR67",95,0)
 ...D EN1^FBPCR2 Q:'$D(FBAACPTC)  S FBCNT=FBCNT+1
"RTN","FBPCR67",96,0)
 ...Q:$$FILTER^FBPCR4()=0
"RTN","FBPCR67",97,0)
 ...S ^TMP($J,"FB",FBPSF,FBPAT,FBPI,FBVEN,FBM,FBI,"A",FBCNT)=FBDT1_U_FBAACPTC_FBCP_$S($G(FBMODLE)]"":"-"_FBMODLE,1:"")_U_A1_U_A2_U_FBBN_U_FBIN_U_D2_U_FBSC_U_FBPDX_U_FBOB_U_FBVNAME_U_FBVID_U_FBPI_U_FBCATC_U_FBINS
"RTN","FBPCR67",98,0)
 ...S ^TMP($J,"FB",FBPSF,FBPAT,FBPI,FBVEN,FBM,FBI,"A",FBCNT,"FBADJ")=TAMT_U_FBUNITS_U_FBADJLR_U_FBADJLA_U_FBRRMKL_U_FBCSID
"RTN","FBPCR67",99,0)
 Q
"RTN","FBPCR671")
0^21^B51983526^B46739204
"RTN","FBPCR671",1,0)
FBPCR671 ;AISC/DMK,TET-CH/CNH POTENTIAL COST RECOVERY PRINT ;7/18/2006
"RTN","FBPCR671",2,0)
 ;;3.5;FEE BASIS;**4,48,55,69,76,98,122,108,163**;JAN 30, 1995;Build 21
"RTN","FBPCR671",3,0)
 ;Per VA Directive 6402, this routine should not be modified.
"RTN","FBPCR671",4,0)
 ;
"RTN","FBPCR671",5,0)
PRINT ;print data from tmp global
"RTN","FBPCR671",6,0)
 N FBBILL,FBINAU  ; FB*3.5*163
"RTN","FBPCR671",7,0)
 I FBPG>1&(($Y+12)>IOSL) D HDR Q:FBOUT
"RTN","FBPCR671",8,0)
 E  D HDR1 Q:FBOUT
"RTN","FBPCR671",9,0)
 S FBPVLIST="ATTENDING PROV NAME^NPI^TAXONOMY CODE^OPERATING PROV NAME^NPI^RENDERING PROV NAME"
"RTN","FBPCR671",10,0)
 S FBPVLIST=FBPVLIST_"^NPI^TAXONOMY CODE^SERVICING PROV NAME^NPI^REFERRING PROV NAME^NPI"
"RTN","FBPCR671",11,0)
 S FBVI="" F  S FBVI=$O(^TMP($J,"FB",FBPSF,FBPT,FBPI,FBVI)) Q:FBVI']""!(FBOUT)  D SH Q:FBOUT  D  Q:FBOUT
"RTN","FBPCR671",12,0)
 .S FBDT=0 F  S FBDT=$O(^TMP($J,"FB",FBPSF,FBPT,FBPI,FBVI,FBDT)) Q:'FBDT  S FBI=0 F  S FBI=$O(^TMP($J,"FB",FBPSF,FBPT,FBPI,FBVI,FBDT,FBI)) Q:'FBI  D  Q:FBOUT
"RTN","FBPCR671",13,0)
 ..I ($Y+5)>IOSL D PAGE Q:FBOUT
"RTN","FBPCR671",14,0)
 ..S FBDATA=$G(^TMP($J,"FB",FBPSF,FBPT,FBPI,FBVI,FBDT,FBI)),FBCATC=$P(FBDATA,U,9),FBINS=$P(FBDATA,U,10)  ;FB*3.5*163 Add $G 
"RTN","FBPCR671",15,0)
 ..S FBINV=$G(^TMP($J,"FB",FBPSF,FBPT,FBPI,FBVI,FBDT,FBI,"FBINV"))  ; FB*3.5*163 Add $G
"RTN","FBPCR671",16,0)
 ..S FBBILL=$G(^TMP($J,"FB",FBPSF,FBPT,FBPI,FBVI,FBDT,FBI,"FBBILL"))  ; FB*3.5*163 Bill No.
"RTN","FBPCR671",17,0)
 ..S FBINAU=$G(^TMP($J,"FB",FBPSF,FBPT,FBPI,FBVI,FBDT,FBI,"FBINAU"))  ; FB*3.5*163 Ins Auth No.
"RTN","FBPCR671",18,0)
 ..W ! W:$P(FBDATA,U,8)["R" "*" W:$P(FBDATA,U,9)]"" "#"
"RTN","FBPCR671",19,0)
 ..W ?2,$P(FBDATA,U,1),?15,$P(FBDATA,U,5),?31,$P(FBDATA,U,6)
"RTN","FBPCR671",20,0)
 ..W ?47,$P(FBDATA,U,7),?57,$P(FBINV,U,2)
"RTN","FBPCR671",21,0)
 ..W !?2,$P(FBDATA,U,2),?15,$P(FBDATA,U,3),?25,$P(FBINV,U,1)
"RTN","FBPCR671",22,0)
 .. ;Print adj reasons, if null then print suspend code
"RTN","FBPCR671",23,0)
 ..W ?36,$S($P(FBINV,U,3)]"":$P(FBINV,U,3),1:$P(FBDATA,U,4))
"RTN","FBPCR671",24,0)
 ..W ?46,$S($P(FBINV,U,3)]"":$J($P(FBINV,U,4),14),1:$J($P(FBDATA,U,10),14))
"RTN","FBPCR671",25,0)
 ..W ?63,$P(FBINV,U,5)
"RTN","FBPCR671",26,0)
 ..W !,?2,$S(FBBILL:"Y",1:"N"),?9,FBBILL  ; FB*3.5*163 Bill No.
"RTN","FBPCR671",27,0)
 ..W ?24,FBINAU  ; FB*3.5*163 Ins Auth No.
"RTN","FBPCR671",28,0)
 ..; write admitting diagnosis if present
"RTN","FBPCR671",29,0)
 .. I $P(FBINV,U,6)'="" W !?6,"Admit Dx: ",$P(FBINV,U,6)
"RTN","FBPCR671",30,0)
 ..;F FBY="DX","PROC" I $D(^TMP($J,"FB",FBPSF,FBPT,FBPI,FBVI,FBDT,FBI,FBY)) S FBDATA=^(FBY),FBSL=$L(FBDATA,"^") W !?2,FBY,": " F I=1:1:FBSL W $P(FBDATA,U,I),"    "
"RTN","FBPCR671",31,0)
 ..I $D(^TMP($J,"FB",FBPSF,FBPT,FBPI,FBVI,FBDT,FBI,"DX")) S FBDATA=$G(^TMP($J,"FB",FBPSF,FBPT,FBPI,FBVI,FBDT,FBI,"DX")),FBSL=$L(FBDATA,"^") F I=1:1:FBSL D WRTDX
"RTN","FBPCR671",32,0)
 ..S FBNEWLN=1
"RTN","FBPCR671",33,0)
 ..I $D(^TMP($J,"FB",FBPSF,FBPT,FBPI,FBVI,FBDT,FBI,"PROC")) S FBDATA=$G(^TMP($J,"FB",FBPSF,FBPT,FBPI,FBVI,FBDT,FBI,"PROC")),FBSL=$L(FBDATA,"^") F I=1:1:FBSL D WRTPC
"RTN","FBPCR671",34,0)
 ..K FBNEWLN
"RTN","FBPCR671",35,0)
 ..;I FBDATA]"" F I=1:1:FBSL I $P(FBDATA,U,I)]"" D                                                                                      ; FB*3.5*122
"RTN","FBPCR671",36,0)
 ..;.;W:FBRPROV !,?2,"PROC: " W:$G(FBRPROV)="" "    " W $P(FBDATA,U,I)                                                                         ; FB*3.5*122
"RTN","FBPCR671",37,0)
 ..;.;S FBRPROV=$G(^TMP($J,"FB",FBPSF,FBPT,FBPI,FBVI,FBDT,FBI,"RPROV",I)) I FBRPROV="" Q                                                 ; FB*3.5*122
"RTN","FBPCR671",38,0)
 ..;.;W ?20,"RENDERING PROVIDER NAME: "_$P(FBRPROV,U,2),!,?21,"NPI: "_$P(FBRPROV,U,3),?46,"TAXONOMY CODE: "_$P(FBRPROV,U,4) S FBRPROV=1  ; FB*3.5*122
"RTN","FBPCR671",39,0)
 ..K FBRPROV
"RTN","FBPCR671",40,0)
 ..I FBCATC!FBINS D
"RTN","FBPCR671",41,0)
 ...W !?5,">>>"
"RTN","FBPCR671",42,0)
 ...I FBCATC=0 W "Cost recover from insurance."
"RTN","FBPCR671",43,0)
 ...I FBCATC=1 W "Cost recover from means testing"_$S(FBINS:" and insurance.",1:".")
"RTN","FBPCR671",44,0)
 ...I FBCATC=2 W "Cost recover from LTC co-pay"_$S(FBINS:" and insurance.",1:".")
"RTN","FBPCR671",45,0)
 ...I FBCATC=3 W $S(FBINS:"Cost recover from insurance, ",1:"")_"1010EC Missing for LTC Patient."
"RTN","FBPCR671",46,0)
 ...I FBCATC=4 W $S(FBINS:"Cost Recover from insurance and ",1:"")_"Potential Cost Recover from LTC co-pay."
"RTN","FBPCR671",47,0)
 ..;
"RTN","FBPCR671",48,0)
 ..I +$O(^TMP($J,"FB",FBPSF,FBPT,FBPI,FBVI,FBDT,FBI,"A",0)) D  Q:FBOUT  W !,FBDASH1
"RTN","FBPCR671",49,0)
 ...S (FBOV,FBCNT)=0,FBSL=7 D SHA Q:FBOUT
"RTN","FBPCR671",50,0)
 ...F  S FBCNT=$O(^TMP($J,"FB",FBPSF,FBPT,FBPI,FBVI,FBDT,FBI,"A",FBCNT)) Q:'FBCNT  S FBDATA=^(FBCNT),FBV=$P(FBDATA,U,11)_";"_$P(FBDATA,U,12) D  D WRT Q:FBOUT
"RTN","FBPCR671",51,0)
 ....N FBXX S FBXX=$O(^FBAAV("C",$P(FBDATA,U,12),"")) S $P(FBV,";",2)=$P(FBV,";",2)_"/"_$S(FBXX="":"**********",$P($G(^FBAAV(FBXX,3)),U,2)]"":$P(^FBAAV(FBXX,3),U,2),1:"**********")
"RTN","FBPCR671",52,0)
 ..D PRNT5010  ; FB*3.5*122
"RTN","FBPCR671",53,0)
 ..W ! D PRTAUTH^FBPCR2(FBI)  ;FB*3.5*163
"RTN","FBPCR671",54,0)
 Q
"RTN","FBPCR671",55,0)
PRNT5010 ; Format and print based on data type  ; FB*3.5*122
"RTN","FBPCR671",56,0)
 N FBVDAT,FBCNT
"RTN","FBPCR671",57,0)
 I $G(FBPSF)]"",$G(FBPT)]"",$G(FBPI)]"",$G(FBVI)]"",$G(FBDT)]"",$G(FBI)]"",$G(^TMP($J,"FB",FBPSF,FBPT,FBPI,FBVI,FBDT,FBI,"FBY4"))]""
"RTN","FBPCR671",58,0)
 E  Q
"RTN","FBPCR671",59,0)
 W ! S FBVDAT=^TMP($J,"FB",FBPSF,FBPT,FBPI,FBVI,FBDT,FBI,"FBY4")
"RTN","FBPCR671",60,0)
 F FBCNT=1,6 I $P(FBVDAT,U,FBCNT)]"" D
"RTN","FBPCR671",61,0)
 . W !,$P(FBPVLIST,U,FBCNT)_": "_$P(FBVDAT,U,FBCNT),?55,$P(FBPVLIST,U,FBCNT+1)_": "_$P(FBVDAT,U,FBCNT+1)
"RTN","FBPCR671",62,0)
 . W !,?6,$P(FBPVLIST,U,FBCNT+2)_": "_$P(FBVDAT,U,FBCNT+2)
"RTN","FBPCR671",63,0)
 F FBCNT=4,11,9 I $P(FBVDAT,U,FBCNT)]"" D
"RTN","FBPCR671",64,0)
 . W !,$P(FBPVLIST,U,FBCNT)_": "_$P(FBVDAT,U,FBCNT),?55,$P(FBPVLIST,U,FBCNT+1)_": "_$P(FBVDAT,U,FBCNT+1)
"RTN","FBPCR671",65,0)
 I $P(FBVDAT,U,20)]"" D
"RTN","FBPCR671",66,0)
 . W !,"  SERVICING FACILITY ADDRESS: "_$P(FBVDAT,U,20),!,"                              "_$P(FBVDAT,U,21)_", "
"RTN","FBPCR671",67,0)
 . I $P(FBVDAT,U,22)]"" W $$GET1^DIQ(5,$P(FBVDAT,U,22)_",",.01)
"RTN","FBPCR671",68,0)
 . W " "_$P(FBVDAT,U,23)
"RTN","FBPCR671",69,0)
 W !
"RTN","FBPCR671",70,0)
 Q
"RTN","FBPCR671",71,0)
WRT ;write ancillary info
"RTN","FBPCR671",72,0)
 N FBCATC,FBINS,FBADJ I ($Y+4)>IOSL D PAGE Q:FBOUT  D SHA,SHA2
"RTN","FBPCR671",73,0)
 D:FBOV'=FBV SHA2
"RTN","FBPCR671",74,0)
 S FBADJ=^TMP($J,"FB",FBPSF,FBPT,FBPI,FBVI,FBDT,FBI,"A",FBCNT,"FBADJ")
"RTN","FBPCR671",75,0)
 S FBCATC=$P(FBDATA,U,14),FBINS=$P(FBDATA,U,15)
"RTN","FBPCR671",76,0)
 W !
"RTN","FBPCR671",77,0)
 W ?1,$P(FBDATA,U,1)
"RTN","FBPCR671",78,0)
 W ?11,$P($P(FBDATA,U,2),",")
"RTN","FBPCR671",79,0)
 W ?31,$J($P(FBADJ,U,2),10)
"RTN","FBPCR671",80,0)
 W ?43,$P(FBDATA,U,6)
"RTN","FBPCR671",81,0)
 W ?54,$P(FBDATA,U,7)
"RTN","FBPCR671",82,0)
 W ?64,$P(FBDATA,U,8)
"RTN","FBPCR671",83,0)
 I $P($P(FBDATA,U,2),",",2)]"" D  Q:FBOUT
"RTN","FBPCR671",84,0)
 . N FBI,FBMOD
"RTN","FBPCR671",85,0)
 . F FBI=2:1 S FBMOD=$P($P(FBDATA,U,2),",",FBI) Q:FBMOD=""  D  Q:FBOUT
"RTN","FBPCR671",86,0)
 . . I $Y+6>IOSL D PAGE Q:FBOUT  D SHA,SHA2 W !,"  (continued)"
"RTN","FBPCR671",87,0)
 . . W !,?16,"-",FBMOD
"RTN","FBPCR671",88,0)
 W !,$P(FBDATA,U,3)
"RTN","FBPCR671",89,0)
 W ?13,$P(FBDATA,U,4)
"RTN","FBPCR671",90,0)
 W ?23,$S($P(FBADJ,U,3)]"":$P(FBADJ,U,3),1:$P(FBDATA,U,5))
"RTN","FBPCR671",91,0)
 W ?33,$J($S($P(FBADJ,U,4)]"":$J($P(FBADJ,U,4),14),1:$P(FBADJ,U,1)),14)
"RTN","FBPCR671",92,0)
 W ?48,$P(FBADJ,U,5)
"RTN","FBPCR671",93,0)
 W ?60,$P(FBADJ,U,6)
"RTN","FBPCR671",94,0)
 W !?5,"Primary Dx: ",$P(FBDATA,U,9),?40,"S/C Condition? ",$P(FBDATA,U,8),?66,"Obl.#: ",$P(FBDATA,U,10)
"RTN","FBPCR671",95,0)
 I FBCATC!FBINS D
"RTN","FBPCR671",96,0)
 .W !?5,">>>"
"RTN","FBPCR671",97,0)
 .I FBCATC=0 W "Cost recover from insurance."
"RTN","FBPCR671",98,0)
 .I FBCATC=1 W "Cost recover from means testing"_$S(FBINS:" and insurance.",1:".")
"RTN","FBPCR671",99,0)
 .I FBCATC=2 W "Cost recover from LTC co-pay"_$S(FBINS:" and insurance.",1:".")
"RTN","FBPCR671",100,0)
 .I FBCATC=3 W $S(FBINS:"Cost recover from insurance, ",1:"")_"1010EC Missing for LTC Patient."
"RTN","FBPCR671",101,0)
 .I FBCATC=4 W $S(FBINS:"Cost Recover from insurance and ",1:"")_"Potential Cost Recover from LTC co-pay."
"RTN","FBPCR671",102,0)
 ;
"RTN","FBPCR671",103,0)
 Q
"RTN","FBPCR671",104,0)
HDR ;main header
"RTN","FBPCR671",105,0)
 D HDR^FBPCR Q:FBOUT
"RTN","FBPCR671",106,0)
HDR1 W !!?(IOM-(13+$L(FBXPROG))/2),"NVC PROGRAM: ",FBXPROG ;FB*3.5*163 - Changed from FEE to NVC
"RTN","FBPCR671",107,0)
 W !?1,"Invoice Date",?15,"Invoice No.",?31,"From Date",?48,"To Date",?57,"Patient Control #"
"RTN","FBPCR671",108,0)
 ; W !?1,"Amt Claimed",?15,"Amt Paid",?25,"Cov Days",?36,"Adj Codes",?49,"Adj Amounts",?63,"Remit Remarks",!,FBDASH
"RTN","FBPCR671",109,0)
 W !?1,"Amt Claimed",?15,"Amt Paid",?25,"Cov Days",?36,"Adj Codes",?49,"Adj Amounts",?63,"Remit Remarks"  ; FB*3.5*163
"RTN","FBPCR671",110,0)
 W !?1,"Billed?",?9,"Bill#",?24,"Ins Auth#",!,FBDASH ;FB*3.5*163
"RTN","FBPCR671",111,0)
 Q
"RTN","FBPCR671",112,0)
SH ;subheader - vendor, prints when name changed
"RTN","FBPCR671",113,0)
 I ($Y+7)>IOSL D HDR Q:FBOUT
"RTN","FBPCR671",114,0)
 W !!,"Vendor: ",$P(FBVI,";"),?41,"Vendor ID: ",$P($P(FBVI,";",2),"/",1)
"RTN","FBPCR671",115,0)
 W !?20,"Fee Basis Billing Provider NPI: ",$P(FBVI,"/",2)
"RTN","FBPCR671",116,0)
 Q
"RTN","FBPCR671",117,0)
SHA ;ancillary subheader
"RTN","FBPCR671",118,0)
 I ($Y+16)>IOSL D PAGE Q:FBOUT
"RTN","FBPCR671",119,0)
 W !?20,">>> ANCILLARY SERVICE PAYMENTS <<<",!
"RTN","FBPCR671",120,0)
SHA1 ;subheader for ancillary data
"RTN","FBPCR671",121,0)
 W !!,?1,"Svc Date",?11,"CPT-MOD ",?19,"Travel Paid",?31,"Units Paid",?43,"Batch No.",?54,"Inv No.",?64,"Voucher Date"
"RTN","FBPCR671",122,0)
 W !,"Amt Claimed",?13,"Amt Paid",?23,"Adj Code",?36,"Adj Amounts",?48,"Remit Remark",?61,"Patient Account No",!,FBDASH
"RTN","FBPCR671",123,0)
 Q
"RTN","FBPCR671",124,0)
SHA2 ;subheader for vendor name
"RTN","FBPCR671",125,0)
 I ($Y+9)>IOSL D HDR Q:FBOUT  D SH,SHA
"RTN","FBPCR671",126,0)
 I FBOV'=FBV S FBOV=FBV
"RTN","FBPCR671",127,0)
 W !!,"Vendor: ",$P(FBV,";"),?41,"Vendor ID/NPI: ",$P(FBV,";",2)
"RTN","FBPCR671",128,0)
 Q
"RTN","FBPCR671",129,0)
CR ;read for display
"RTN","FBPCR671",130,0)
 Q:'FBPG  S DIR(0)="E" W ! D ^DIR K DIR S:$D(DUOUT)!($D(DTOUT)) FBOUT=1
"RTN","FBPCR671",131,0)
 Q
"RTN","FBPCR671",132,0)
PAGE ;new page
"RTN","FBPCR671",133,0)
 D HDR Q:FBOUT  D SH
"RTN","FBPCR671",134,0)
 Q
"RTN","FBPCR671",135,0)
WRTDX ;input
"RTN","FBPCR671",136,0)
 ; FBDATA contains node from ^TMP
"RTN","FBPCR671",137,0)
 ; I contains piece to be written
"RTN","FBPCR671",138,0)
 I I=1!($X+$L($P(FBDATA,"^",I))+1>IOM) W !,?4,"DX/POA: "
"RTN","FBPCR671",139,0)
 W $P(FBDATA,"^",I)," "
"RTN","FBPCR671",140,0)
 Q
"RTN","FBPCR671",141,0)
WRTPC ;input
"RTN","FBPCR671",142,0)
 ;FBDATA contains node from ^TMP
"RTN","FBPCR671",143,0)
 ;I contains piece to be written
"RTN","FBPCR671",144,0)
 ; if FBNEWLN true then force new line and label for procedure
"RTN","FBPCR671",145,0)
 N FBRPROV
"RTN","FBPCR671",146,0)
 S FBRPROV=$G(^TMP($J,"FB",FBPSF,FBPT,FBPI,FBVI,FBDT,FBI,"RPROV",I))
"RTN","FBPCR671",147,0)
 ; start new line for procedures when appropriate
"RTN","FBPCR671",148,0)
 I FBRPROV'="" S FBNEWLN=1
"RTN","FBPCR671",149,0)
 I FBNEWLN!($X+$L($P(FBDATA,"^",I))+2>IOM) W !?4,"PROC: " S FBNEWLN=0
"RTN","FBPCR671",150,0)
 ; write procedure code
"RTN","FBPCR671",151,0)
 W $P(FBDATA,"^",I)," "
"RTN","FBPCR671",152,0)
 ; write line rendering provider data if applicable
"RTN","FBPCR671",153,0)
 I FBRPROV="" Q
"RTN","FBPCR671",154,0)
 W ?20,"RENDERING PROVIDER NAME: "_$P(FBRPROV,U,2)
"RTN","FBPCR671",155,0)
 W !?21,"NPI: "_$P(FBRPROV,U,3)
"RTN","FBPCR671",156,0)
 W ?46,"TAXONOMY CODE: "_$P(FBRPROV,U,4)
"RTN","FBPCR671",157,0)
 S FBNEWLN=1  ; force new line for next procedure
"RTN","FBPCR671",158,0)
 Q
"RTN","FBPCR671",159,0)
 ;I I=1!($X+$L($P(FBDATA,"^",I))+1>IOM) W !,?4,"PROC: "
"RTN","FBPCR671",160,0)
 ;W $P(FBDATA,"^",I)," "
"RTN","FBPCR671",161,0)
 ;Q
"RTN","FBPCR671",162,0)
 ;S FBRPROV=$G(^TMP($J,"FB",FBPSF,FBPT,FBPI,FBVI,FBDT,FBI,"RPROV",I))                                                 ; FB*3.5*122
"RTN","FBPCR671",163,0)
 ;W !,?2,"PROC: ",$P(FBDATA,U,I) I FBRPROV="" Q                                                                       ; FB*3.5*122
"RTN","FBPCR671",164,0)
 ;W ?20,"RENDERING PROVIDER NAME: "_$P(FBRPROV,U,2),!,?21,"NPI: "_$P(FBRPROV,U,3),?46,"TAXONOMY CODE: "_$P(FBRPROV,U,4) S FBRPROV=1  ; FB*3.5*122
"RTN","FBPCR671",165,0)
 ;Q
"RTN","FBPCR671",166,0)
WRTSC ;write service connected
"RTN","FBPCR671",167,0)
 W !,"SERVICE CONNECTED? ",$S(+VAEL(3):"YES",1:"NO"),!
"RTN","FBPCR671",168,0)
 Q
"RTN","FBPCR671",169,0)
 ;
"UP",161,161.01,-1)
161^1
"UP",161,161.01,0)
161.01
"VER")
8.0^22.0
"^DD",161,161,1,0)
AUTHORIZATION^161.01ID^^1;0
"^DD",161,161,1,21,0)
^^2^2^2930603^^^^
"^DD",161,161,1,21,1,0)
This data is related to specific validity periods where the veteran
"^DD",161,161,1,21,2,0)
is authorized to obtain Fee services and the VA will reimburse.
"^DD",161,161,1,"DT")
2930603
"^DD",161,161.01,0)
AUTHORIZATION SUB-FIELD^NL^292^27
"^DD",161,161.01,0,"NM","AUTHORIZATION")

"^DD",161,161.01,.01,0)
FROM DATE^DX^^0;1^S %DT="EX" D ^%DT S X=Y K:Y<1 X
"^DD",161,161.01,.01,1,0)
^.1
"^DD",161,161.01,.01,1,1,0)
161^AIC1^MUMPS
"^DD",161,161.01,.01,1,1,1)
S:$P(^FBAAA(DA(1),1,DA,0),U,20)]"" ^FBAAA("AIC",DA(1),-X,$P(^FBAAA(DA(1),1,DA,0),U,20),DA)=""
"^DD",161,161.01,.01,1,1,2)
K:$P(^FBAAA(DA(1),1,DA,0),U,20)]"" ^FBAAA("AIC",DA(1),-X,$P(^FBAAA(DA(1),1,DA,0),U,20),DA)
"^DD",161,161.01,.01,1,1,"%D",0)
2^^2^2^2930514^^^
"^DD",161,161.01,.01,1,1,"%D",1,0)
Cross-reference used to identify potential billables using inverse date.
"^DD",161,161.01,.01,1,1,"%D",2,0)
Used to set "AIC" cross-reference on field .097, POTENTIAL COST RECOVERY CASE.
"^DD",161,161.01,.01,1,1,"DT")
2930326
"^DD",161,161.01,.01,1,2,0)
161^ATST
"^DD",161,161.01,.01,1,2,1)
S ^FBAAA("ATST",$E(X,1,30),DA(1),DA)=""
"^DD",161,161.01,.01,1,2,2)
K ^FBAAA("ATST",$E(X,1,30),DA(1),DA)
"^DD",161,161.01,.01,1,2,"DT")
2921014
"^DD",161,161.01,.01,1,3,0)
161.01^B
"^DD",161,161.01,.01,1,3,1)
S ^FBAAA(DA(1),1,"B",$E(X,1,30),DA)=""
"^DD",161,161.01,.01,1,3,2)
K ^FBAAA(DA(1),1,"B",$E(X,1,30),DA)
"^DD",161,161.01,.01,1,3,"DT")
2980929
"^DD",161,161.01,.01,1,4,0)
161^AENR01^MUMPS
"^DD",161,161.01,.01,1,4,1)
D:'$D(DIU(0)) EVENT^IVMPLOG(DA(1))
"^DD",161,161.01,.01,1,4,2)
D:'$D(DIU(0)) EVENT^IVMPLOG(DA(1))
"^DD",161,161.01,.01,1,4,"%D",0)
^^1^1^2980723^^
"^DD",161,161.01,.01,1,4,"%D",1,0)
Notify HEC of changes to FEE Authorization.
"^DD",161,161.01,.01,1,4,"DT")
2980723
"^DD",161,161.01,.01,1,5,0)
161^AC^MUMPS
"^DD",161,161.01,.01,1,5,1)
D:'$D(DIU(0)) EVENT^IBFBUTIL(DA(1))
"^DD",161,161.01,.01,1,5,2)
D:'$D(DIU(0)) EVENT^IBFBUTIL(DA(1))
"^DD",161,161.01,.01,1,5,"%D",0)
^.101^1^1^3160112^^^^
"^DD",161,161.01,.01,1,5,"%D",1,0)
Add new entry into file 360 on new Authorization
"^DD",161,161.01,.01,1,5,"DT")
3151005
"^DD",161,161.01,.01,21,0)
^^4^4^2930603^^^^
"^DD",161,161.01,.01,21,1,0)
The beginning date for which the patient is authorized to obtain services
"^DD",161,161.01,.01,21,2,0)
from private vendors. For every claim made by a vendor for this patient,
"^DD",161,161.01,.01,21,3,0)
this date will be checked to insure that the date the service was provided
"^DD",161,161.01,.01,21,4,0)
was on or after this date.
"^DD",161,161.01,.01,"DEL",.01,0)
I $$DELA^FBUCDD1(.DA,1)
"^DD",161,161.01,.01,"DT")
3150217
"^DD",161.43,161.43,4,0)
CHOICE INDICATOR^S^0:NO;1:YES;^0;3^Q
"^DD",161.43,161.43,4,.1)
CHOICE PROGRAM INDICATOR
"^DD",161.43,161.43,4,3)
Enter 'Yes' if this Fee Basis Contract Number is indicative of the Veterans Choice Program.
"^DD",161.43,161.43,4,21,0)
^^2^2^3151118^^
"^DD",161.43,161.43,4,21,1,0)
This field is used to identify Fee Basis Contracts associated with Non-VA 
"^DD",161.43,161.43,4,21,2,0)
Care Vendors participating in the Veterans Choice Program.
"^DD",161.43,161.43,4,23,0)
^^3^3^3151118^^
"^DD",161.43,161.43,4,23,1,0)
A '1' in piece 3 of the 0 node on File #161.43 indicates that this 
"^DD",161.43,161.43,4,23,2,0)
particular contract for Non-VA Care Vendor(s) is part of the Veterans 
"^DD",161.43,161.43,4,23,3,0)
Choice Program.
"^DD",161.43,161.43,4,"DT")
3151118
"^DD",161.43,161.43,5,0)
CHOICE PROVIDER AGREEMENT^S^0:NO;1:YES;^0;4^Q
"^DD",161.43,161.43,5,3)
Enter 'Yes' if this Fee Basis Contract Number is indicative of the Veterans Choice Program - Choice Provider Agreement.
"^DD",161.43,161.43,5,21,0)
^^2^2^3160125^
"^DD",161.43,161.43,5,21,1,0)
This field is used to identify Non-VA Care Vendors participating in the 
"^DD",161.43,161.43,5,21,2,0)
Veterans Choice Program via a Choice Provider Agreement.
"^DD",161.43,161.43,5,23,0)
^^3^3^3160125^
"^DD",161.43,161.43,5,23,1,0)
A '1' in piece 4 of the 0 node on File #161.43 indicates that this 
"^DD",161.43,161.43,5,23,2,0)
particular contract for Non-VA Care Vendor(s) is part of the Veterans 
"^DD",161.43,161.43,5,23,3,0)
Choice Program via a Choice Provider Agreement.
"^DD",161.43,161.43,5,"DT")
3160125
"BLD",9718,6)
^145
**END**
**END**

