Released FB*3.5*154 SEQ #142
Extracted from mail message
**KIDS**:FB*3.5*154^

**INSTALL NAME**
FB*3.5*154
"BLD",9633,0)
FB*3.5*154^FEE BASIS^0^3150520^y
"BLD",9633,1,0)
^^14^14^3141224^
"BLD",9633,1,1,0)
This patch will enhance the Fee Basis package per the requirements of the
"BLD",9633,1,2,0)
VistA Fee Separation of Duties project.  The patch will make the 
"BLD",9633,1,3,0)
following changes to Fee Basis:
"BLD",9633,1,4,0)
 o Add new security keys.
"BLD",9633,1,5,0)
 o Revise locks on menu options to enhance separation of duty controls.
"BLD",9633,1,6,0)
 o Attach menu options to additional menus.
"BLD",9633,1,7,0)
 o Revise locks on functionality within menu options.
"BLD",9633,1,8,0)
 o Add the Security Key Report for Fee Basis
"BLD",9633,1,9,0)
 o Prevent entry of payment or pricing if user entered the authorization.
"BLD",9633,1,10,0)
 o Add reports to display users that entered or edited authorizations.
"BLD",9633,1,11,0)
 o Correct an existing issue with the identification of the associated
"BLD",9633,1,12,0)
   authorization for outpatient and ancillary payments.
"BLD",9633,1,13,0)
 o Prevent an undefined error when a prescription is deleted.
"BLD",9633,1,14,0)
 o Prevent an undefined error when rejected payments are re-initiated.
"BLD",9633,4,0)
^9.64PA^162.7^6
"BLD",9633,4,161,0)
161
"BLD",9633,4,161,2,0)
^9.641^161.192^1
"BLD",9633,4,161,2,161.192,0)
USER AUDIT  (sub-file)
"BLD",9633,4,161,2,161.192,1,0)
^9.6411^^
"BLD",9633,4,161,222)
y^y^p^^^^n^^n
"BLD",9633,4,161,224)

"BLD",9633,4,161.4,0)
161.4
"BLD",9633,4,161.4,2,0)
^9.641^161.4^1
"BLD",9633,4,161.4,2,161.4,0)
FEE BASIS SITE PARAMETERS  (File-top level)
"BLD",9633,4,161.4,2,161.4,1,0)
^9.6411^19^1
"BLD",9633,4,161.4,2,161.4,1,19,0)
*EDIT AUTH. DURING PAYMENT
"BLD",9633,4,161.4,222)
y^y^p^^^^n^^n
"BLD",9633,4,161.4,224)

"BLD",9633,4,162,0)
162
"BLD",9633,4,162,2,0)
^9.641^162.04^3
"BLD",9633,4,162,2,162.02,0)
INITIAL TREATMENT DATE  (sub-file)
"BLD",9633,4,162,2,162.02,1,0)
^9.6411^3^1
"BLD",9633,4,162,2,162.02,1,3,0)
*AUTHORIZATION POINTER
"BLD",9633,4,162,2,162.03,0)
SERVICE PROVIDED  (sub-file)
"BLD",9633,4,162,2,162.03,1,0)
^9.6411^2^2
"BLD",9633,4,162,2,162.03,1,2,0)
AMOUNT PAID
"BLD",9633,4,162,2,162.03,1,15.5,0)
AUTHORIZATION POINTER
"BLD",9633,4,162,2,162.04,0)
TRAVEL PAYMENT DATE  (sub-file)
"BLD",9633,4,162,2,162.04,1,0)
^9.6411^15^1
"BLD",9633,4,162,2,162.04,1,15,0)
AUTHORIZATION POINTER
"BLD",9633,4,162,222)
y^y^p^^^^n^^n
"BLD",9633,4,162,224)

"BLD",9633,4,162.2,0)
162.2
"BLD",9633,4,162.2,2,0)
^9.641^162.292^1
"BLD",9633,4,162.2,2,162.292,0)
USER AUDIT  (sub-file)
"BLD",9633,4,162.2,2,162.292,1,0)
^9.6411^^
"BLD",9633,4,162.2,222)
y^y^p^^^^n^^n
"BLD",9633,4,162.2,224)

"BLD",9633,4,162.4,0)
162.4
"BLD",9633,4,162.4,2,0)
^9.641^162.492^1
"BLD",9633,4,162.4,2,162.492,0)
USER AUDIT  (sub-file)
"BLD",9633,4,162.4,2,162.492,1,0)
^9.6411^^
"BLD",9633,4,162.4,222)
y^y^p^^^^n^^n
"BLD",9633,4,162.4,224)

"BLD",9633,4,162.7,0)
162.7
"BLD",9633,4,162.7,2,0)
^9.641^162.792^1
"BLD",9633,4,162.7,2,162.792,0)
USER AUDIT  (sub-file)
"BLD",9633,4,162.7,2,162.792,1,0)
^9.6411^^
"BLD",9633,4,162.7,222)
y^y^p^^^^n^^n
"BLD",9633,4,162.7,224)

"BLD",9633,4,"APDD",161,161.192)

"BLD",9633,4,"APDD",161.4,161.4)

"BLD",9633,4,"APDD",161.4,161.4,19)

"BLD",9633,4,"APDD",162,162.02)

"BLD",9633,4,"APDD",162,162.02,3)

"BLD",9633,4,"APDD",162,162.03)

"BLD",9633,4,"APDD",162,162.03,2)

"BLD",9633,4,"APDD",162,162.03,15.5)

"BLD",9633,4,"APDD",162,162.04)

"BLD",9633,4,"APDD",162,162.04,15)

"BLD",9633,4,"APDD",162.2,162.292)

"BLD",9633,4,"APDD",162.4,162.492)

"BLD",9633,4,"APDD",162.7,162.792)

"BLD",9633,4,"B",161,161)

"BLD",9633,4,"B",161.4,161.4)

"BLD",9633,4,"B",162,162)

"BLD",9633,4,"B",162.2,162.2)

"BLD",9633,4,"B",162.4,162.4)

"BLD",9633,4,"B",162.7,162.7)

"BLD",9633,6)
2^
"BLD",9633,6.3)
12
"BLD",9633,"INIT")
PS^FBXIP154
"BLD",9633,"KRN",0)
^9.67PA^779.2^20
"BLD",9633,"KRN",.4,0)
.4
"BLD",9633,"KRN",.4,"NM",0)
^9.68A^^
"BLD",9633,"KRN",.401,0)
.401
"BLD",9633,"KRN",.402,0)
.402
"BLD",9633,"KRN",.402,"NM",0)
^9.68A^1^1
"BLD",9633,"KRN",.402,"NM",1,0)
FBAA SITE PARAMETERS    FILE #161.4^161.4^0
"BLD",9633,"KRN",.402,"NM","B","FBAA SITE PARAMETERS    FILE #161.4",1)

"BLD",9633,"KRN",.403,0)
.403
"BLD",9633,"KRN",.5,0)
.5
"BLD",9633,"KRN",.84,0)
.84
"BLD",9633,"KRN",3.6,0)
3.6
"BLD",9633,"KRN",3.8,0)
3.8
"BLD",9633,"KRN",9.2,0)
9.2
"BLD",9633,"KRN",9.8,0)
9.8
"BLD",9633,"KRN",9.8,"NM",0)
^9.68A^77^75
"BLD",9633,"KRN",9.8,"NM",1,0)
FBAACLU^^0^B35110722
"BLD",9633,"KRN",9.8,"NM",2,0)
FBAAFED^^0^B26728323
"BLD",9633,"KRN",9.8,"NM",3,0)
FBAAPHV^^0^B7102778
"BLD",9633,"KRN",9.8,"NM",4,0)
FBAASCB^^0^B26462590
"BLD",9633,"KRN",9.8,"NM",5,0)
FBAAVP^^0^B25842895
"BLD",9633,"KRN",9.8,"NM",6,0)
FBCHC78^^0^B15534924
"BLD",9633,"KRN",9.8,"NM",7,0)
FBCHFED^^0^B10466486
"BLD",9633,"KRN",9.8,"NM",8,0)
FBCHREQ2^^0^B9185141
"BLD",9633,"KRN",9.8,"NM",9,0)
FBCHVP^^0^B23175690
"BLD",9633,"KRN",9.8,"NM",10,0)
FBRXFED^^0^B15191002
"BLD",9633,"KRN",9.8,"NM",11,0)
FBAABDL^^0^B8082291
"BLD",9633,"KRN",9.8,"NM",12,0)
FBAABET^^0^B8176586
"BLD",9633,"KRN",9.8,"NM",13,0)
FBAACCB^^0^B34771662
"BLD",9633,"KRN",9.8,"NM",14,0)
FBAACO^^0^B49645560
"BLD",9633,"KRN",9.8,"NM",15,0)
FBAACO0^^0^B30569706
"BLD",9633,"KRN",9.8,"NM",16,0)
FBAACO3^^0^B58658444
"BLD",9633,"KRN",9.8,"NM",18,0)
FBAAEPI^^0^B33105165
"BLD",9633,"KRN",9.8,"NM",19,0)
FBAAMP^^0^B134317556
"BLD",9633,"KRN",9.8,"NM",20,0)
FBAAODP0^^0^B4415099
"BLD",9633,"KRN",9.8,"NM",21,0)
FBAAPET^^0^B51663555
"BLD",9633,"KRN",9.8,"NM",22,0)
FBAARB^^0^B6175868
"BLD",9633,"KRN",9.8,"NM",23,0)
FBAAUTL2^^0^B18342335
"BLD",9633,"KRN",9.8,"NM",24,0)
FBAAVD2^^0^B34694491
"BLD",9633,"KRN",9.8,"NM",25,0)
FBCHDEL^^0^B2165242
"BLD",9633,"KRN",9.8,"NM",26,0)
FBCHDIN^^0^B6884285
"BLD",9633,"KRN",9.8,"NM",27,0)
FBCHEAP^^0^B21240885
"BLD",9633,"KRN",9.8,"NM",28,0)
FBCHEP1^^0^B51535191
"BLD",9633,"KRN",9.8,"NM",29,0)
FBCHPET^^0^B44036498
"BLD",9633,"KRN",9.8,"NM",30,0)
FBCHRR^^0^B15446498
"BLD",9633,"KRN",9.8,"NM",31,0)
FBCHSTA^^0^B4547349
"BLD",9633,"KRN",9.8,"NM",32,0)
FBFHLX^^0^B59495819
"BLD",9633,"KRN",9.8,"NM",33,0)
FBNHEDPA^^0^B17524026
"BLD",9633,"KRN",9.8,"NM",34,0)
FBAAAUT^^0^B15987856
"BLD",9633,"KRN",9.8,"NM",35,0)
FBAACIE^^0^B16604968
"BLD",9633,"KRN",9.8,"NM",36,0)
FBAAEAR^^1^
"BLD",9633,"KRN",9.8,"NM",37,0)
FBAAETA^^0^B3716839
"BLD",9633,"KRN",9.8,"NM",38,0)
FBAAPIE^^0^B27534429
"BLD",9633,"KRN",9.8,"NM",39,0)
FBAAPIP^^0^B16684065
"BLD",9633,"KRN",9.8,"NM",40,0)
FBAARR1^^0^B29692050
"BLD",9633,"KRN",9.8,"NM",41,0)
FBCH78^^0^B53484323
"BLD",9633,"KRN",9.8,"NM",42,0)
FBCHCD^^0^B23155265
"BLD",9633,"KRN",9.8,"NM",43,0)
FBCHREQ^^0^B24998930
"BLD",9633,"KRN",9.8,"NM",44,0)
FBCHREQ1^^0^B15968034
"BLD",9633,"KRN",9.8,"NM",45,0)
FBNHDLAD^^0^B7092641
"BLD",9633,"KRN",9.8,"NM",46,0)
FBNHDLDI^^0^B9276531
"BLD",9633,"KRN",9.8,"NM",47,0)
FBNHDLTR^^0^B4147651
"BLD",9633,"KRN",9.8,"NM",48,0)
FBNHEA^^0^B10123939
"BLD",9633,"KRN",9.8,"NM",49,0)
FBNHEAUT^^0^B28883284
"BLD",9633,"KRN",9.8,"NM",50,0)
FBNHED^^0^B11597213
"BLD",9633,"KRN",9.8,"NM",51,0)
FBNHEDAD^^0^B2542752
"BLD",9633,"KRN",9.8,"NM",52,0)
FBNHEDAT^^0^B16634471
"BLD",9633,"KRN",9.8,"NM",53,0)
FBNHEDDI^^0^B5681933
"BLD",9633,"KRN",9.8,"NM",54,0)
FBNHEDTR^^0^B7981505
"BLD",9633,"KRN",9.8,"NM",55,0)
FBNHEP^^0^B35945966
"BLD",9633,"KRN",9.8,"NM",56,0)
FBNHET^^0^B9794262
"BLD",9633,"KRN",9.8,"NM",57,0)
FBNHRAT^^0^B14005307
"BLD",9633,"KRN",9.8,"NM",58,0)
FBNHRAT1^^0^B7549171
"BLD",9633,"KRN",9.8,"NM",59,0)
FBNHRC^^0^B14502667
"BLD",9633,"KRN",9.8,"NM",60,0)
FBUCPAY^^0^B25249019
"BLD",9633,"KRN",9.8,"NM",61,0)
FBUCUPD^^0^B26849705
"BLD",9633,"KRN",9.8,"NM",63,0)
FBAACO1^^0^B50176519
"BLD",9633,"KRN",9.8,"NM",64,0)
FBAACO5^^0^B5864672
"BLD",9633,"KRN",9.8,"NM",65,0)
FBLTCAR^^0^B22874177
"BLD",9633,"KRN",9.8,"NM",66,0)
FBPMRG^^0^B47383810
"BLD",9633,"KRN",9.8,"NM",67,0)
FBUCDD1^^0^B12232651
"BLD",9633,"KRN",9.8,"NM",68,0)
FBAASKR^^0^B33713453
"BLD",9633,"KRN",9.8,"NM",69,0)
FBUTL9^^0^B6528526
"BLD",9633,"KRN",9.8,"NM",70,0)
FBXIP154^^0^B186355971
"BLD",9633,"KRN",9.8,"NM",71,0)
FBCHEP^^0^B39727558
"BLD",9633,"KRN",9.8,"NM",72,0)
FBUCED^^0^B41181903
"BLD",9633,"KRN",9.8,"NM",73,0)
FBUCED0^^0^B27953320
"BLD",9633,"KRN",9.8,"NM",74,0)
FBUCEN^^0^B27771069
"BLD",9633,"KRN",9.8,"NM",75,0)
FBUCEX^^0^B19203515
"BLD",9633,"KRN",9.8,"NM",76,0)
FBUCLINK^^0^B19446324
"BLD",9633,"KRN",9.8,"NM",77,0)
FBAAODP^^0^B8130048
"BLD",9633,"KRN",9.8,"NM","B","FBAAAUT",34)

"BLD",9633,"KRN",9.8,"NM","B","FBAABDL",11)

"BLD",9633,"KRN",9.8,"NM","B","FBAABET",12)

"BLD",9633,"KRN",9.8,"NM","B","FBAACCB",13)

"BLD",9633,"KRN",9.8,"NM","B","FBAACIE",35)

"BLD",9633,"KRN",9.8,"NM","B","FBAACLU",1)

"BLD",9633,"KRN",9.8,"NM","B","FBAACO",14)

"BLD",9633,"KRN",9.8,"NM","B","FBAACO0",15)

"BLD",9633,"KRN",9.8,"NM","B","FBAACO1",63)

"BLD",9633,"KRN",9.8,"NM","B","FBAACO3",16)

"BLD",9633,"KRN",9.8,"NM","B","FBAACO5",64)

"BLD",9633,"KRN",9.8,"NM","B","FBAAEAR",36)

"BLD",9633,"KRN",9.8,"NM","B","FBAAEPI",18)

"BLD",9633,"KRN",9.8,"NM","B","FBAAETA",37)

"BLD",9633,"KRN",9.8,"NM","B","FBAAFED",2)

"BLD",9633,"KRN",9.8,"NM","B","FBAAMP",19)

"BLD",9633,"KRN",9.8,"NM","B","FBAAODP",77)

"BLD",9633,"KRN",9.8,"NM","B","FBAAODP0",20)

"BLD",9633,"KRN",9.8,"NM","B","FBAAPET",21)

"BLD",9633,"KRN",9.8,"NM","B","FBAAPHV",3)

"BLD",9633,"KRN",9.8,"NM","B","FBAAPIE",38)

"BLD",9633,"KRN",9.8,"NM","B","FBAAPIP",39)

"BLD",9633,"KRN",9.8,"NM","B","FBAARB",22)

"BLD",9633,"KRN",9.8,"NM","B","FBAARR1",40)

"BLD",9633,"KRN",9.8,"NM","B","FBAASCB",4)

"BLD",9633,"KRN",9.8,"NM","B","FBAASKR",68)

"BLD",9633,"KRN",9.8,"NM","B","FBAAUTL2",23)

"BLD",9633,"KRN",9.8,"NM","B","FBAAVD2",24)

"BLD",9633,"KRN",9.8,"NM","B","FBAAVP",5)

"BLD",9633,"KRN",9.8,"NM","B","FBCH78",41)

"BLD",9633,"KRN",9.8,"NM","B","FBCHC78",6)

"BLD",9633,"KRN",9.8,"NM","B","FBCHCD",42)

"BLD",9633,"KRN",9.8,"NM","B","FBCHDEL",25)

"BLD",9633,"KRN",9.8,"NM","B","FBCHDIN",26)

"BLD",9633,"KRN",9.8,"NM","B","FBCHEAP",27)

"BLD",9633,"KRN",9.8,"NM","B","FBCHEP",71)

"BLD",9633,"KRN",9.8,"NM","B","FBCHEP1",28)

"BLD",9633,"KRN",9.8,"NM","B","FBCHFED",7)

"BLD",9633,"KRN",9.8,"NM","B","FBCHPET",29)

"BLD",9633,"KRN",9.8,"NM","B","FBCHREQ",43)

"BLD",9633,"KRN",9.8,"NM","B","FBCHREQ1",44)

"BLD",9633,"KRN",9.8,"NM","B","FBCHREQ2",8)

"BLD",9633,"KRN",9.8,"NM","B","FBCHRR",30)

"BLD",9633,"KRN",9.8,"NM","B","FBCHSTA",31)

"BLD",9633,"KRN",9.8,"NM","B","FBCHVP",9)

"BLD",9633,"KRN",9.8,"NM","B","FBFHLX",32)

"BLD",9633,"KRN",9.8,"NM","B","FBLTCAR",65)

"BLD",9633,"KRN",9.8,"NM","B","FBNHDLAD",45)

"BLD",9633,"KRN",9.8,"NM","B","FBNHDLDI",46)

"BLD",9633,"KRN",9.8,"NM","B","FBNHDLTR",47)

"BLD",9633,"KRN",9.8,"NM","B","FBNHEA",48)

"BLD",9633,"KRN",9.8,"NM","B","FBNHEAUT",49)

"BLD",9633,"KRN",9.8,"NM","B","FBNHED",50)

"BLD",9633,"KRN",9.8,"NM","B","FBNHEDAD",51)

"BLD",9633,"KRN",9.8,"NM","B","FBNHEDAT",52)

"BLD",9633,"KRN",9.8,"NM","B","FBNHEDDI",53)

"BLD",9633,"KRN",9.8,"NM","B","FBNHEDPA",33)

"BLD",9633,"KRN",9.8,"NM","B","FBNHEDTR",54)

"BLD",9633,"KRN",9.8,"NM","B","FBNHEP",55)

"BLD",9633,"KRN",9.8,"NM","B","FBNHET",56)

"BLD",9633,"KRN",9.8,"NM","B","FBNHRAT",57)

"BLD",9633,"KRN",9.8,"NM","B","FBNHRAT1",58)

"BLD",9633,"KRN",9.8,"NM","B","FBNHRC",59)

"BLD",9633,"KRN",9.8,"NM","B","FBPMRG",66)

"BLD",9633,"KRN",9.8,"NM","B","FBRXFED",10)

"BLD",9633,"KRN",9.8,"NM","B","FBUCDD1",67)

"BLD",9633,"KRN",9.8,"NM","B","FBUCED",72)

"BLD",9633,"KRN",9.8,"NM","B","FBUCED0",73)

"BLD",9633,"KRN",9.8,"NM","B","FBUCEN",74)

"BLD",9633,"KRN",9.8,"NM","B","FBUCEX",75)

"BLD",9633,"KRN",9.8,"NM","B","FBUCLINK",76)

"BLD",9633,"KRN",9.8,"NM","B","FBUCPAY",60)

"BLD",9633,"KRN",9.8,"NM","B","FBUCUPD",61)

"BLD",9633,"KRN",9.8,"NM","B","FBUTL9",69)

"BLD",9633,"KRN",9.8,"NM","B","FBXIP154",70)

"BLD",9633,"KRN",19,0)
19
"BLD",9633,"KRN",19,"NM",0)
^9.68A^138^137
"BLD",9633,"KRN",19,"NM",1,0)
FBAA QUEUE DATA FOR TRANS.^^0
"BLD",9633,"KRN",19,"NM",2,0)
FBCH LEGAL ENTITLEMENT^^0
"BLD",9633,"KRN",19,"NM",3,0)
FBCH MEDICAL ENTITLEMENT^^0
"BLD",9633,"KRN",19,"NM",4,0)
FBCH DELETE REQUEST^^0
"BLD",9633,"KRN",19,"NM",5,0)
FBCH REOPEN REQUEST^^0
"BLD",9633,"KRN",19,"NM",6,0)
FBCH COMPLETE 7078^^0
"BLD",9633,"KRN",19,"NM",7,0)
FBCH EDIT 7078^^0
"BLD",9633,"KRN",19,"NM",8,0)
FBCH CANCEL 7078^^0
"BLD",9633,"KRN",19,"NM",9,0)
FBCH PRINT CANCELLED 7078^^0
"BLD",9633,"KRN",19,"NM",10,0)
FBCH 7078 SETUP^^0
"BLD",9633,"KRN",19,"NM",11,0)
FBCH ANCILLARY PAYMENT^^0
"BLD",9633,"KRN",19,"NM",12,0)
FBCH COMPLETE PAYMENT^^0
"BLD",9633,"KRN",19,"NM",13,0)
FBCH DELETE INVOICE^^0
"BLD",9633,"KRN",19,"NM",14,0)
FBCH EDIT ANCILLARY PAYMENT^^0
"BLD",9633,"KRN",19,"NM",15,0)
FBCH ENTER PAYMENT^^0
"BLD",9633,"KRN",19,"NM",16,0)
FBCH EDIT PAYMENT^^0
"BLD",9633,"KRN",19,"NM",17,0)
FBCH MULTIPLE PAYMENTS^^0
"BLD",9633,"KRN",19,"NM",18,0)
FBCH ANCILLARY REIMBURSEMENT^^0
"BLD",9633,"KRN",19,"NM",19,0)
FBCH REIMBURSEMENT INVOICE^^0
"BLD",9633,"KRN",19,"NM",20,0)
FBCH OPEN BATCH^^0
"BLD",9633,"KRN",19,"NM",21,0)
FBAA BATCH EDIT^^0
"BLD",9633,"KRN",19,"NM",22,0)
FBAA CLOSE BATCH^^0
"BLD",9633,"KRN",19,"NM",23,0)
FBAA REOPEN BATCH^^0
"BLD",9633,"KRN",19,"NM",24,0)
FBCH PRICER RELEASE^^0
"BLD",9633,"KRN",19,"NM",25,0)
FBCH REINITIATE PRICER REJECTS^^0
"BLD",9633,"KRN",19,"NM",26,0)
FBAA SUPERVISOR RELEASE^^0
"BLD",9633,"KRN",19,"NM",27,0)
FBAA REINITIATE REJECTS^^0
"BLD",9633,"KRN",19,"NM",28,0)
FBAA BATCH DELETE^^0
"BLD",9633,"KRN",19,"NM",29,0)
FBCH OPEN ANCILLARY BATCH^^0
"BLD",9633,"KRN",19,"NM",30,0)
FBCNH UPDATE VENDOR CONTRACT^^0
"BLD",9633,"KRN",19,"NM",31,0)
FBCNH ENTER AUTHORIZATION^^0
"BLD",9633,"KRN",19,"NM",32,0)
FBCNH EDIT AUTHORIZATION^^0
"BLD",9633,"KRN",19,"NM",33,0)
FBCNH CANCEL 7078^^0
"BLD",9633,"KRN",19,"NM",34,0)
FBCNH RATE CHANGE^^0
"BLD",9633,"KRN",19,"NM",35,0)
FBCNH DELETE RATE^^0
"BLD",9633,"KRN",19,"NM",36,0)
FBCNH ENTER VETERAN RATES^^0
"BLD",9633,"KRN",19,"NM",37,0)
FBCNH OPEN BATCH^^0
"BLD",9633,"KRN",19,"NM",38,0)
FBCNH ESTIMATE FUNDS^^0
"BLD",9633,"KRN",19,"NM",39,0)
FBCNH POST COMMITMENTS^^0
"BLD",9633,"KRN",19,"NM",40,0)
FBCNH ADMIT^^0
"BLD",9633,"KRN",19,"NM",41,0)
FBCNH DELETE MOVEMENT MENU^^0
"BLD",9633,"KRN",19,"NM",42,0)
FBCNH DISCHARGE^^0
"BLD",9633,"KRN",19,"NM",43,0)
FBCNH EDIT MOVEMENT^^0
"BLD",9633,"KRN",19,"NM",44,0)
FBCNH TRANSFER^^0
"BLD",9633,"KRN",19,"NM",45,0)
FBCNH DELETE ADMISSION^^0
"BLD",9633,"KRN",19,"NM",46,0)
FBCNH DELETE DISCHARGE^^0
"BLD",9633,"KRN",19,"NM",47,0)
FBCNH DELETE TRANSFER^^0
"BLD",9633,"KRN",19,"NM",48,0)
FBCNH EDIT ADMISSION^^0
"BLD",9633,"KRN",19,"NM",49,0)
FBCNH EDIT DISCHARGE^^0
"BLD",9633,"KRN",19,"NM",50,0)
FBCNH EDIT TRANSFER^^0
"BLD",9633,"KRN",19,"NM",51,0)
FBCNH EDIT PAYMENT^^0
"BLD",9633,"KRN",19,"NM",52,0)
FBCNH ENTER PAYMENT^^0
"BLD",9633,"KRN",19,"NM",53,0)
FBAA ENTER AUTHORIZATION^^0
"BLD",9633,"KRN",19,"NM",54,0)
FBAA TERMINATE ID CARD^^0
"BLD",9633,"KRN",19,"NM",55,0)
FBAA OPEN BATCH^^0
"BLD",9633,"KRN",19,"NM",56,0)
FBAA PRINT 7079 GROUP^^0
"BLD",9633,"KRN",19,"NM",58,0)
FBAA DELETE PAYMENT^^0
"BLD",9633,"KRN",19,"NM",59,0)
FBAA EDIT PAYMENT^^0
"BLD",9633,"KRN",19,"NM",60,0)
FBAA ENTER PAYMENT^^0
"BLD",9633,"KRN",19,"NM",61,0)
FBAA MULTIPLE PAYMENT ENTRY^^0
"BLD",9633,"KRN",19,"NM",62,0)
FBAA MEDICAL REIMBURSEMENT^^0
"BLD",9633,"KRN",19,"NM",63,0)
FBAA TRAVEL ENTRY^^0
"BLD",9633,"KRN",19,"NM",64,0)
FBAA CLERK LOOK-UP^^0
"BLD",9633,"KRN",19,"NM",65,0)
FBAA ENTER/EDIT LETTERS^^0
"BLD",9633,"KRN",19,"NM",66,0)
FBAA EDIT INVOICE STATUS^^0
"BLD",9633,"KRN",19,"NM",67,0)
FB SEG DUTY RPT^^0
"BLD",9633,"KRN",19,"NM",68,0)
FBAA VOID PAYMENT MENU^^0
"BLD",9633,"KRN",19,"NM",69,0)
FBAA EDIT SCHEDULE^^0
"BLD",9633,"KRN",19,"NM",70,0)
FBAA CALCULATE SCHEDULE^^0
"BLD",9633,"KRN",19,"NM",71,0)
FBAA FPPS EDIT INVOICE^^0
"BLD",9633,"KRN",19,"NM",72,0)
FBRX FPPS EDIT INVOICE^^0
"BLD",9633,"KRN",19,"NM",73,0)
FBCH FPPS EDIT INVOICE^^0
"BLD",9633,"KRN",19,"NM",74,0)
FB FPPS PURGE^^0
"BLD",9633,"KRN",19,"NM",75,0)
FBAA VENDOR MRA MAIN MENU^^0
"BLD",9633,"KRN",19,"NM",76,0)
FBAA VETERAN MRA MAIN MENU^^0
"BLD",9633,"KRN",19,"NM",77,0)
FBAA FMS UPDATE^^0
"BLD",9633,"KRN",19,"NM",78,0)
FBAA MRA DELETE VENDOR^^0
"BLD",9633,"KRN",19,"NM",79,0)
FBAA MRA VENDOR REINSTATE^^0
"BLD",9633,"KRN",19,"NM",80,0)
FBAA MRA'S AWAITING APPROVAL^^0
"BLD",9633,"KRN",19,"NM",81,0)
FBAA MRA VETERAN ADD TYPE^^0
"BLD",9633,"KRN",19,"NM",82,0)
FBAA MRA VETERAN CHANGE TYPE^^0
"BLD",9633,"KRN",19,"NM",83,0)
FBAA MRA VETERAN DELETE TYPE^^0
"BLD",9633,"KRN",19,"NM",84,0)
FBAA MRA VETERAN REINSTATE^^0
"BLD",9633,"KRN",19,"NM",85,0)
FBUC ADD NEW PERSON^^0
"BLD",9633,"KRN",19,"NM",86,0)
FBUC DISAPPROVAL REASONS FILE^^0
"BLD",9633,"KRN",19,"NM",87,0)
FBUC DISPOSITIONS FILE^^0
"BLD",9633,"KRN",19,"NM",88,0)
FBUC REQUEST INFO FILE^^0
"BLD",9633,"KRN",19,"NM",89,0)
FBCH DELETE VOID^^0
"BLD",9633,"KRN",19,"NM",90,0)
FBCH VOID PAYMENT^^0
"BLD",9633,"KRN",19,"NM",91,0)
FBCNH DELETE VOID^^0
"BLD",9633,"KRN",19,"NM",92,0)
FBCNH VOID PAYMENT^^0
"BLD",9633,"KRN",19,"NM",93,0)
FBAA CANCEL MEDICAL VOID^^0
"BLD",9633,"KRN",19,"NM",94,0)
FBAA MEDICAL VOID PAYMENT^^0
"BLD",9633,"KRN",19,"NM",95,0)
FBAA CANCEL PHARMACY VOID^^0
"BLD",9633,"KRN",19,"NM",96,0)
FBAA PHARMACY VOID PAYMENT^^0
"BLD",9633,"KRN",19,"NM",97,0)
FBAA CLOSE OUT INVOICE^^0
"BLD",9633,"KRN",19,"NM",98,0)
FBAA COMPLETE PHARMACY INVOICE^^0
"BLD",9633,"KRN",19,"NM",99,0)
FBAA EDIT PHARMACY INVOICE^^0
"BLD",9633,"KRN",19,"NM",100,0)
FBAA ENTER PHARMACY INVOICE^^0
"BLD",9633,"KRN",19,"NM",101,0)
FBAA REIMBURSEMENT PHARMACY^^0
"BLD",9633,"KRN",19,"NM",102,0)
FBAA OPEN PHARMACY BATCH^^0
"BLD",9633,"KRN",19,"NM",103,0)
FBSH ENTER AUTH^^0
"BLD",9633,"KRN",19,"NM",104,0)
FBSH CHANGE AUTH^^0
"BLD",9633,"KRN",19,"NM",105,0)
FBSH DELETE AUTH^^0
"BLD",9633,"KRN",19,"NM",106,0)
FBSH REINSTATE AUTH^^0
"BLD",9633,"KRN",19,"NM",107,0)
FBUC REQUEST INFORMATION^^0
"BLD",9633,"KRN",19,"NM",108,0)
FBUC RECEIVE INFORMATION^^0
"BLD",9633,"KRN",19,"NM",109,0)
FBUC LETTERS^^0
"BLD",9633,"KRN",19,"NM",110,0)
FBUC PAYMENTS^^0
"BLD",9633,"KRN",19,"NM",111,0)
FBUC ENTER^^0
"BLD",9633,"KRN",19,"NM",112,0)
FBUC MODIFY UNAUTHORIZED CLAIM^^0
"BLD",9633,"KRN",19,"NM",113,0)
FBUC DISPOSITION UNAUTH CLAIM^^0
"BLD",9633,"KRN",19,"NM",114,0)
FBUC REOPEN^^0
"BLD",9633,"KRN",19,"NM",115,0)
FBUC INITIATE APPEAL^^0
"BLD",9633,"KRN",19,"NM",116,0)
FBUC APPEAL EDIT^^0
"BLD",9633,"KRN",19,"NM",117,0)
FBUC COVA APPEAL^^0
"BLD",9633,"KRN",19,"NM",118,0)
FBUC UPDATE DATE LETTER SENT^^0
"BLD",9633,"KRN",19,"NM",119,0)
FBUC BATCH PRINT LETTERS^^0
"BLD",9633,"KRN",19,"NM",120,0)
FBUC REPRINT LETTER(S)^^0
"BLD",9633,"KRN",19,"NM",121,0)
FBUC ASSOCIATE^^0
"BLD",9633,"KRN",19,"NM",122,0)
FBUC DISASSOCIATE^^0
"BLD",9633,"KRN",19,"NM",123,0)
FBUC RETURN ADDRESS DIS/ED^^0
"BLD",9633,"KRN",19,"NM",124,0)
FBAA BATCH MENU^^2
"BLD",9633,"KRN",19,"NM",125,0)
FBAA PHARMACY BATCH OPTIONS^^2
"BLD",9633,"KRN",19,"NM",126,0)
FBCH BATCH OPTIONS^^2
"BLD",9633,"KRN",19,"NM",127,0)
FBAA VOUCHER DELETE REJECT^^4^
"BLD",9633,"KRN",19,"NM",128,0)
FBAA FINALIZE BATCH^^4^
"BLD",9633,"KRN",19,"NM",129,0)
FBAA LIST CLOSED BATCHES^^4^
"BLD",9633,"KRN",19,"NM",130,0)
FB SEC KEY RPT^^0
"BLD",9633,"KRN",19,"NM",131,0)
FBCH CLERK LOOKUP^^0
"BLD",9633,"KRN",19,"NM",132,0)
FBCH REQUEST CLERK LOOKUP^^0
"BLD",9633,"KRN",19,"NM",133,0)
FBUC CLERK LOOKUP^^0
"BLD",9633,"KRN",19,"NM",134,0)
FBCH NOTIFICATION MENU^^2
"BLD",9633,"KRN",19,"NM",135,0)
FBUC OUTPUTS^^2
"BLD",9633,"KRN",19,"NM",136,0)
FBCH OUTPUT MENU^^2
"BLD",9633,"KRN",19,"NM",137,0)
FBCNH OUTPUTS MAIN MENU^^2
"BLD",9633,"KRN",19,"NM",138,0)
FBAA SUPERVISOR OPTIONS^^3
"BLD",9633,"KRN",19,"NM","B","FB FPPS PURGE",74)

"BLD",9633,"KRN",19,"NM","B","FB SEC KEY RPT",130)

"BLD",9633,"KRN",19,"NM","B","FB SEG DUTY RPT",67)

"BLD",9633,"KRN",19,"NM","B","FBAA BATCH DELETE",28)

"BLD",9633,"KRN",19,"NM","B","FBAA BATCH EDIT",21)

"BLD",9633,"KRN",19,"NM","B","FBAA BATCH MENU",124)

"BLD",9633,"KRN",19,"NM","B","FBAA CALCULATE SCHEDULE",70)

"BLD",9633,"KRN",19,"NM","B","FBAA CANCEL MEDICAL VOID",93)

"BLD",9633,"KRN",19,"NM","B","FBAA CANCEL PHARMACY VOID",95)

"BLD",9633,"KRN",19,"NM","B","FBAA CLERK LOOK-UP",64)

"BLD",9633,"KRN",19,"NM","B","FBAA CLOSE BATCH",22)

"BLD",9633,"KRN",19,"NM","B","FBAA CLOSE OUT INVOICE",97)

"BLD",9633,"KRN",19,"NM","B","FBAA COMPLETE PHARMACY INVOICE",98)

"BLD",9633,"KRN",19,"NM","B","FBAA DELETE PAYMENT",58)

"BLD",9633,"KRN",19,"NM","B","FBAA EDIT INVOICE STATUS",66)

"BLD",9633,"KRN",19,"NM","B","FBAA EDIT PAYMENT",59)

"BLD",9633,"KRN",19,"NM","B","FBAA EDIT PHARMACY INVOICE",99)

"BLD",9633,"KRN",19,"NM","B","FBAA EDIT SCHEDULE",69)

"BLD",9633,"KRN",19,"NM","B","FBAA ENTER AUTHORIZATION",53)

"BLD",9633,"KRN",19,"NM","B","FBAA ENTER PAYMENT",60)

"BLD",9633,"KRN",19,"NM","B","FBAA ENTER PHARMACY INVOICE",100)

"BLD",9633,"KRN",19,"NM","B","FBAA ENTER/EDIT LETTERS",65)

"BLD",9633,"KRN",19,"NM","B","FBAA FINALIZE BATCH",128)

"BLD",9633,"KRN",19,"NM","B","FBAA FMS UPDATE",77)

"BLD",9633,"KRN",19,"NM","B","FBAA FPPS EDIT INVOICE",71)

"BLD",9633,"KRN",19,"NM","B","FBAA LIST CLOSED BATCHES",129)

"BLD",9633,"KRN",19,"NM","B","FBAA MEDICAL REIMBURSEMENT",62)

"BLD",9633,"KRN",19,"NM","B","FBAA MEDICAL VOID PAYMENT",94)

"BLD",9633,"KRN",19,"NM","B","FBAA MRA DELETE VENDOR",78)

"BLD",9633,"KRN",19,"NM","B","FBAA MRA VENDOR REINSTATE",79)

"BLD",9633,"KRN",19,"NM","B","FBAA MRA VETERAN ADD TYPE",81)

"BLD",9633,"KRN",19,"NM","B","FBAA MRA VETERAN CHANGE TYPE",82)

"BLD",9633,"KRN",19,"NM","B","FBAA MRA VETERAN DELETE TYPE",83)

"BLD",9633,"KRN",19,"NM","B","FBAA MRA VETERAN REINSTATE",84)

"BLD",9633,"KRN",19,"NM","B","FBAA MRA'S AWAITING APPROVAL",80)

"BLD",9633,"KRN",19,"NM","B","FBAA MULTIPLE PAYMENT ENTRY",61)

"BLD",9633,"KRN",19,"NM","B","FBAA OPEN BATCH",55)

"BLD",9633,"KRN",19,"NM","B","FBAA OPEN PHARMACY BATCH",102)

"BLD",9633,"KRN",19,"NM","B","FBAA PHARMACY BATCH OPTIONS",125)

"BLD",9633,"KRN",19,"NM","B","FBAA PHARMACY VOID PAYMENT",96)

"BLD",9633,"KRN",19,"NM","B","FBAA PRINT 7079 GROUP",56)

"BLD",9633,"KRN",19,"NM","B","FBAA QUEUE DATA FOR TRANS.",1)

"BLD",9633,"KRN",19,"NM","B","FBAA REIMBURSEMENT PHARMACY",101)

"BLD",9633,"KRN",19,"NM","B","FBAA REINITIATE REJECTS",27)

"BLD",9633,"KRN",19,"NM","B","FBAA REOPEN BATCH",23)

"BLD",9633,"KRN",19,"NM","B","FBAA SUPERVISOR OPTIONS",138)

"BLD",9633,"KRN",19,"NM","B","FBAA SUPERVISOR RELEASE",26)

"BLD",9633,"KRN",19,"NM","B","FBAA TERMINATE ID CARD",54)

"BLD",9633,"KRN",19,"NM","B","FBAA TRAVEL ENTRY",63)

"BLD",9633,"KRN",19,"NM","B","FBAA VENDOR MRA MAIN MENU",75)

"BLD",9633,"KRN",19,"NM","B","FBAA VETERAN MRA MAIN MENU",76)

"BLD",9633,"KRN",19,"NM","B","FBAA VOID PAYMENT MENU",68)

"BLD",9633,"KRN",19,"NM","B","FBAA VOUCHER DELETE REJECT",127)

"BLD",9633,"KRN",19,"NM","B","FBCH 7078 SETUP",10)

"BLD",9633,"KRN",19,"NM","B","FBCH ANCILLARY PAYMENT",11)

"BLD",9633,"KRN",19,"NM","B","FBCH ANCILLARY REIMBURSEMENT",18)

"BLD",9633,"KRN",19,"NM","B","FBCH BATCH OPTIONS",126)

"BLD",9633,"KRN",19,"NM","B","FBCH CANCEL 7078",8)

"BLD",9633,"KRN",19,"NM","B","FBCH CLERK LOOKUP",131)

"BLD",9633,"KRN",19,"NM","B","FBCH COMPLETE 7078",6)

"BLD",9633,"KRN",19,"NM","B","FBCH COMPLETE PAYMENT",12)

"BLD",9633,"KRN",19,"NM","B","FBCH DELETE INVOICE",13)

"BLD",9633,"KRN",19,"NM","B","FBCH DELETE REQUEST",4)

"BLD",9633,"KRN",19,"NM","B","FBCH DELETE VOID",89)

"BLD",9633,"KRN",19,"NM","B","FBCH EDIT 7078",7)

"BLD",9633,"KRN",19,"NM","B","FBCH EDIT ANCILLARY PAYMENT",14)

"BLD",9633,"KRN",19,"NM","B","FBCH EDIT PAYMENT",16)

"BLD",9633,"KRN",19,"NM","B","FBCH ENTER PAYMENT",15)

"BLD",9633,"KRN",19,"NM","B","FBCH FPPS EDIT INVOICE",73)

"BLD",9633,"KRN",19,"NM","B","FBCH LEGAL ENTITLEMENT",2)

"BLD",9633,"KRN",19,"NM","B","FBCH MEDICAL ENTITLEMENT",3)

"BLD",9633,"KRN",19,"NM","B","FBCH MULTIPLE PAYMENTS",17)

"BLD",9633,"KRN",19,"NM","B","FBCH NOTIFICATION MENU",134)

"BLD",9633,"KRN",19,"NM","B","FBCH OPEN ANCILLARY BATCH",29)

"BLD",9633,"KRN",19,"NM","B","FBCH OPEN BATCH",20)

"BLD",9633,"KRN",19,"NM","B","FBCH OUTPUT MENU",136)

"BLD",9633,"KRN",19,"NM","B","FBCH PRICER RELEASE",24)

"BLD",9633,"KRN",19,"NM","B","FBCH PRINT CANCELLED 7078",9)

"BLD",9633,"KRN",19,"NM","B","FBCH REIMBURSEMENT INVOICE",19)

"BLD",9633,"KRN",19,"NM","B","FBCH REINITIATE PRICER REJECTS",25)

"BLD",9633,"KRN",19,"NM","B","FBCH REOPEN REQUEST",5)

"BLD",9633,"KRN",19,"NM","B","FBCH REQUEST CLERK LOOKUP",132)

"BLD",9633,"KRN",19,"NM","B","FBCH VOID PAYMENT",90)

"BLD",9633,"KRN",19,"NM","B","FBCNH ADMIT",40)

"BLD",9633,"KRN",19,"NM","B","FBCNH CANCEL 7078",33)

"BLD",9633,"KRN",19,"NM","B","FBCNH DELETE ADMISSION",45)

"BLD",9633,"KRN",19,"NM","B","FBCNH DELETE DISCHARGE",46)

"BLD",9633,"KRN",19,"NM","B","FBCNH DELETE MOVEMENT MENU",41)

"BLD",9633,"KRN",19,"NM","B","FBCNH DELETE RATE",35)

"BLD",9633,"KRN",19,"NM","B","FBCNH DELETE TRANSFER",47)

"BLD",9633,"KRN",19,"NM","B","FBCNH DELETE VOID",91)

"BLD",9633,"KRN",19,"NM","B","FBCNH DISCHARGE",42)

"BLD",9633,"KRN",19,"NM","B","FBCNH EDIT ADMISSION",48)

"BLD",9633,"KRN",19,"NM","B","FBCNH EDIT AUTHORIZATION",32)

"BLD",9633,"KRN",19,"NM","B","FBCNH EDIT DISCHARGE",49)

"BLD",9633,"KRN",19,"NM","B","FBCNH EDIT MOVEMENT",43)

"BLD",9633,"KRN",19,"NM","B","FBCNH EDIT PAYMENT",51)

"BLD",9633,"KRN",19,"NM","B","FBCNH EDIT TRANSFER",50)

"BLD",9633,"KRN",19,"NM","B","FBCNH ENTER AUTHORIZATION",31)

"BLD",9633,"KRN",19,"NM","B","FBCNH ENTER PAYMENT",52)

"BLD",9633,"KRN",19,"NM","B","FBCNH ENTER VETERAN RATES",36)

"BLD",9633,"KRN",19,"NM","B","FBCNH ESTIMATE FUNDS",38)

"BLD",9633,"KRN",19,"NM","B","FBCNH OPEN BATCH",37)

"BLD",9633,"KRN",19,"NM","B","FBCNH OUTPUTS MAIN MENU",137)

"BLD",9633,"KRN",19,"NM","B","FBCNH POST COMMITMENTS",39)

"BLD",9633,"KRN",19,"NM","B","FBCNH RATE CHANGE",34)

"BLD",9633,"KRN",19,"NM","B","FBCNH TRANSFER",44)

"BLD",9633,"KRN",19,"NM","B","FBCNH UPDATE VENDOR CONTRACT",30)

"BLD",9633,"KRN",19,"NM","B","FBCNH VOID PAYMENT",92)

"BLD",9633,"KRN",19,"NM","B","FBRX FPPS EDIT INVOICE",72)

"BLD",9633,"KRN",19,"NM","B","FBSH CHANGE AUTH",104)

"BLD",9633,"KRN",19,"NM","B","FBSH DELETE AUTH",105)

"BLD",9633,"KRN",19,"NM","B","FBSH ENTER AUTH",103)

"BLD",9633,"KRN",19,"NM","B","FBSH REINSTATE AUTH",106)

"BLD",9633,"KRN",19,"NM","B","FBUC ADD NEW PERSON",85)

"BLD",9633,"KRN",19,"NM","B","FBUC APPEAL EDIT",116)

"BLD",9633,"KRN",19,"NM","B","FBUC ASSOCIATE",121)

"BLD",9633,"KRN",19,"NM","B","FBUC BATCH PRINT LETTERS",119)

"BLD",9633,"KRN",19,"NM","B","FBUC CLERK LOOKUP",133)

"BLD",9633,"KRN",19,"NM","B","FBUC COVA APPEAL",117)

"BLD",9633,"KRN",19,"NM","B","FBUC DISAPPROVAL REASONS FILE",86)

"BLD",9633,"KRN",19,"NM","B","FBUC DISASSOCIATE",122)

"BLD",9633,"KRN",19,"NM","B","FBUC DISPOSITION UNAUTH CLAIM",113)

"BLD",9633,"KRN",19,"NM","B","FBUC DISPOSITIONS FILE",87)

"BLD",9633,"KRN",19,"NM","B","FBUC ENTER",111)

"BLD",9633,"KRN",19,"NM","B","FBUC INITIATE APPEAL",115)

"BLD",9633,"KRN",19,"NM","B","FBUC LETTERS",109)

"BLD",9633,"KRN",19,"NM","B","FBUC MODIFY UNAUTHORIZED CLAIM",112)

"BLD",9633,"KRN",19,"NM","B","FBUC OUTPUTS",135)

"BLD",9633,"KRN",19,"NM","B","FBUC PAYMENTS",110)

"BLD",9633,"KRN",19,"NM","B","FBUC RECEIVE INFORMATION",108)

"BLD",9633,"KRN",19,"NM","B","FBUC REOPEN",114)

"BLD",9633,"KRN",19,"NM","B","FBUC REPRINT LETTER(S)",120)

"BLD",9633,"KRN",19,"NM","B","FBUC REQUEST INFO FILE",88)

"BLD",9633,"KRN",19,"NM","B","FBUC REQUEST INFORMATION",107)

"BLD",9633,"KRN",19,"NM","B","FBUC RETURN ADDRESS DIS/ED",123)

"BLD",9633,"KRN",19,"NM","B","FBUC UPDATE DATE LETTER SENT",118)

"BLD",9633,"KRN",19.1,0)
19.1
"BLD",9633,"KRN",19.1,"NM",0)
^9.68A^4^4
"BLD",9633,"KRN",19.1,"NM",1,0)
FBAASUPERVISOR^^0
"BLD",9633,"KRN",19.1,"NM",2,0)
FBAA LEVEL 1 AUTH^^0
"BLD",9633,"KRN",19.1,"NM",3,0)
FBAA LEVEL 1 PMT^^0
"BLD",9633,"KRN",19.1,"NM",4,0)
FBAA LEVEL 2^^0
"BLD",9633,"KRN",19.1,"NM","B","FBAA LEVEL 1 AUTH",2)

"BLD",9633,"KRN",19.1,"NM","B","FBAA LEVEL 1 PMT",3)

"BLD",9633,"KRN",19.1,"NM","B","FBAA LEVEL 2",4)

"BLD",9633,"KRN",19.1,"NM","B","FBAASUPERVISOR",1)

"BLD",9633,"KRN",101,0)
101
"BLD",9633,"KRN",409.61,0)
409.61
"BLD",9633,"KRN",771,0)
771
"BLD",9633,"KRN",779.2,0)
779.2
"BLD",9633,"KRN",870,0)
870
"BLD",9633,"KRN",8989.51,0)
8989.51
"BLD",9633,"KRN",8989.52,0)
8989.52
"BLD",9633,"KRN",8994,0)
8994
"BLD",9633,"KRN","B",.4,.4)

"BLD",9633,"KRN","B",.401,.401)

"BLD",9633,"KRN","B",.402,.402)

"BLD",9633,"KRN","B",.403,.403)

"BLD",9633,"KRN","B",.5,.5)

"BLD",9633,"KRN","B",.84,.84)

"BLD",9633,"KRN","B",3.6,3.6)

"BLD",9633,"KRN","B",3.8,3.8)

"BLD",9633,"KRN","B",9.2,9.2)

"BLD",9633,"KRN","B",9.8,9.8)

"BLD",9633,"KRN","B",19,19)

"BLD",9633,"KRN","B",19.1,19.1)

"BLD",9633,"KRN","B",101,101)

"BLD",9633,"KRN","B",409.61,409.61)

"BLD",9633,"KRN","B",771,771)

"BLD",9633,"KRN","B",779.2,779.2)

"BLD",9633,"KRN","B",870,870)

"BLD",9633,"KRN","B",8989.51,8989.51)

"BLD",9633,"KRN","B",8989.52,8989.52)

"BLD",9633,"KRN","B",8994,8994)

"BLD",9633,"QDEF")
^^^^^^^^^^YES
"BLD",9633,"QUES",0)
^9.62^^
"BLD",9633,"REQB",0)
^9.611^11^10
"BLD",9633,"REQB",2,0)
FB*3.5*7^2
"BLD",9633,"REQB",3,0)
FB*3.5*17^2
"BLD",9633,"REQB",4,0)
FB*3.5*49^2
"BLD",9633,"REQB",5,0)
FB*3.5*59^2
"BLD",9633,"REQB",6,0)
FB*3.5*69^2
"BLD",9633,"REQB",7,0)
FB*3.5*91^2
"BLD",9633,"REQB",8,0)
FB*3.5*123^2
"BLD",9633,"REQB",9,0)
FB*3.5*127^2
"BLD",9633,"REQB",10,0)
FB*3.5*153^2
"BLD",9633,"REQB",11,0)
FB*3.5*157^2
"BLD",9633,"REQB","B","FB*3.5*123",8)

"BLD",9633,"REQB","B","FB*3.5*127",9)

"BLD",9633,"REQB","B","FB*3.5*153",10)

"BLD",9633,"REQB","B","FB*3.5*157",11)

"BLD",9633,"REQB","B","FB*3.5*17",3)

"BLD",9633,"REQB","B","FB*3.5*49",4)

"BLD",9633,"REQB","B","FB*3.5*59",5)

"BLD",9633,"REQB","B","FB*3.5*69",6)

"BLD",9633,"REQB","B","FB*3.5*7",2)

"BLD",9633,"REQB","B","FB*3.5*91",7)

"FIA",161)
FEE BASIS PATIENT
"FIA",161,0)
^FBAAA(
"FIA",161,0,0)
161P
"FIA",161,0,1)
y^y^p^^^^n^^n
"FIA",161,0,10)

"FIA",161,0,11)

"FIA",161,0,"RLRO")

"FIA",161,0,"VR")
3.5^FB
"FIA",161,161)
1
"FIA",161,161.01)
1
"FIA",161,161.01,292)

"FIA",161,161.192)
0
"FIA",161.4)
FEE BASIS SITE PARAMETERS
"FIA",161.4,0)
^FBAA(161.4,
"FIA",161.4,0,0)
161.4
"FIA",161.4,0,1)
y^y^p^^^^n^^n
"FIA",161.4,0,10)

"FIA",161.4,0,11)

"FIA",161.4,0,"RLRO")

"FIA",161.4,0,"VR")
3.5^FB
"FIA",161.4,161.4)
1
"FIA",161.4,161.4,19)

"FIA",162)
FEE BASIS PAYMENT
"FIA",162,0)
^FBAAC(
"FIA",162,0,0)
162P
"FIA",162,0,1)
y^y^p^^^^n^^n
"FIA",162,0,10)

"FIA",162,0,11)

"FIA",162,0,"RLRO")

"FIA",162,0,"VR")
3.5^FB
"FIA",162,162)
1
"FIA",162,162.02)
1
"FIA",162,162.02,3)

"FIA",162,162.03)
1
"FIA",162,162.03,2)

"FIA",162,162.03,15.5)

"FIA",162,162.04)
1
"FIA",162,162.04,15)

"FIA",162.2)
FEE NOTIFICATION/REQUEST
"FIA",162.2,0)
^FBAA(162.2,
"FIA",162.2,0,0)
162.2DI
"FIA",162.2,0,1)
y^y^p^^^^n^^n
"FIA",162.2,0,10)

"FIA",162.2,0,11)

"FIA",162.2,0,"RLRO")

"FIA",162.2,0,"VR")
3.5^FB
"FIA",162.2,162.2)
1
"FIA",162.2,162.2,292)

"FIA",162.2,162.292)
0
"FIA",162.4)
VA FORM 10-7078
"FIA",162.4,0)
^FB7078(
"FIA",162.4,0,0)
162.4I
"FIA",162.4,0,1)
y^y^p^^^^n^^n
"FIA",162.4,0,10)

"FIA",162.4,0,11)

"FIA",162.4,0,"RLRO")

"FIA",162.4,0,"VR")
3.5^FB
"FIA",162.4,162.4)
1
"FIA",162.4,162.4,292)

"FIA",162.4,162.492)
0
"FIA",162.7)
FEE BASIS UNAUTHORIZED CLAIMS
"FIA",162.7,0)
^FB583(
"FIA",162.7,0,0)
162.7ID
"FIA",162.7,0,1)
y^y^p^^^^n^^n
"FIA",162.7,0,10)

"FIA",162.7,0,11)

"FIA",162.7,0,"RLRO")

"FIA",162.7,0,"VR")
3.5^FB
"FIA",162.7,162.7)
1
"FIA",162.7,162.7,292)

"FIA",162.7,162.792)
0
"INIT")
PS^FBXIP154
"IX",161,161.192,"AU",0)
161.192^AU^Index of users that edited the authorization.^R^^F^IR^I^161.192^^^^^S
"IX",161,161.192,"AU",.1,0)
^^3^3^3140203^
"IX",161,161.192,"AU",.1,1,0)
This is a regular cross-reference of the users that entered or edited the
"IX",161,161.192,"AU",.1,2,0)
authorization. It is accessed during payment processing to enforce
"IX",161,161.192,"AU",.1,3,0)
separation of duty.
"IX",161,161.192,"AU",1)
S ^FBAAA(DA(2),1,DA(1),"LOG1","AU",X,DA)=""
"IX",161,161.192,"AU",2)
K ^FBAAA(DA(2),1,DA(1),"LOG1","AU",X,DA)
"IX",161,161.192,"AU",2.5)
K ^FBAAA(DA(2),1,DA(1),"LOG1","AU")
"IX",161,161.192,"AU",11.1,0)
^.114IA^1^1
"IX",161,161.192,"AU",11.1,1,0)
1^F^161.192^1^^1^F
"IX",161,161.192,"AU",11.1,1,3)

"IX",162.2,162.292,"AU",0)
162.292^AU^Index of users that edited the notification.^R^^F^IR^I^162.292^^^^^S
"IX",162.2,162.292,"AU",.1,0)
^^3^3^3140203^
"IX",162.2,162.292,"AU",.1,1,0)
This is a regular cross-reference of the users that entered or edited the
"IX",162.2,162.292,"AU",.1,2,0)
notification.  It is accessed during payment processing to enforce
"IX",162.2,162.292,"AU",.1,3,0)
separation of duty.
"IX",162.2,162.292,"AU",1)
S ^FBAA(162.2,DA(1),"LOG1","AU",X,DA)=""
"IX",162.2,162.292,"AU",2)
K ^FBAA(162.2,DA(1),"LOG1","AU",X,DA)
"IX",162.2,162.292,"AU",2.5)
K ^FBAA(162.2,DA(1),"LOG1","AU")
"IX",162.2,162.292,"AU",11.1,0)
^.114IA^1^1
"IX",162.2,162.292,"AU",11.1,1,0)
1^F^162.292^1^^1^F
"IX",162.2,162.292,"AU",11.1,1,3)

"IX",162.4,162.492,"AU",0)
162.492^AU^Index of users that edited the authorization.^R^^F^IR^I^162.492^^^^^S
"IX",162.4,162.492,"AU",.1,0)
^^3^3^3140203^
"IX",162.4,162.492,"AU",.1,1,0)
This is a regular cross-reference of the users that entered or edited the
"IX",162.4,162.492,"AU",.1,2,0)
authorization. It is accessed during payment processing to enforce
"IX",162.4,162.492,"AU",.1,3,0)
separation of duty.
"IX",162.4,162.492,"AU",1)
S ^FB7078(DA(1),"LOG1","AU",X,DA)=""
"IX",162.4,162.492,"AU",2)
K ^FB7078(DA(1),"LOG1","AU",X,DA)
"IX",162.4,162.492,"AU",2.5)
K ^FB7078(DA(1),"LOG1","AU")
"IX",162.4,162.492,"AU",11.1,0)
^.114IA^1^1
"IX",162.4,162.492,"AU",11.1,1,0)
1^F^162.492^1^^1^F
"IX",162.4,162.492,"AU",11.1,1,3)

"IX",162.7,162.792,"AU",0)
162.792^AU^Index of users that edited the claim.^R^^F^IR^I^162.792^^^^^S
"IX",162.7,162.792,"AU",.1,0)
^^3^3^3140203^
"IX",162.7,162.792,"AU",.1,1,0)
This is a regular cross-reference of the users that entered or edited the
"IX",162.7,162.792,"AU",.1,2,0)
unauthorized claim.  It is accessed during payment processing to enforce
"IX",162.7,162.792,"AU",.1,3,0)
separation of duty.
"IX",162.7,162.792,"AU",1)
S ^FB583(DA(1),"LOG1","AU",X,DA)=""
"IX",162.7,162.792,"AU",2)
K ^FB583(DA(1),"LOG1","AU",X,DA)
"IX",162.7,162.792,"AU",2.5)
K ^FB583(DA(1),"LOG1","AU")
"IX",162.7,162.792,"AU",11.1,0)
^.114IA^1^1
"IX",162.7,162.792,"AU",11.1,1,0)
1^F^162.792^1^^1^F
"IX",162.7,162.792,"AU",11.1,1,3)

"KRN",.402,353,-1)
0^1
"KRN",.402,353,0)
FBAA SITE PARAMETERS^3141007.1034^^161.4^^^3150223
"KRN",.402,353,"DIAB",13,0,161.4,0)
32;T
"KRN",.402,353,"DR",1,161.4)
.01;I $$VER^FBAAUTL2(161.4)=3,$D(^FBAA(161.4,1,0)) S $P(^(1),U,10)="FEE";I $D(^FBAA(161.4,1,0)),$P(^(1),U,9)="" S $P(^(1),U,9)=125;1;2;16;3:8;9;12:14;15;17:17.2;21:28;32T~;32.5;33;34;35;35.5;35.6;35.7;40;
"KRN",.402,353,"DR",2,161.428)
.01
"KRN",19,441,-1)
3^138
"KRN",19,441,0)
FBAA SUPERVISOR OPTIONS^Supervisor Main Menu^^M^^FBAA LEVEL 2^^^^^^
"KRN",19,441,1,0)
^19.06^1^1^3140910^^^^
"KRN",19,441,1,1,0)
Main Menu for Supervisor options.
"KRN",19,441,10,0)
^19.01IP^34^34
"KRN",19,441,10,1,0)
998^
"KRN",19,441,10,1,"^")
FBAA SUPERVISOR RELEASE
"KRN",19,441,10,2,0)
459^
"KRN",19,441,10,2,"^")
FBAA LIST CLOSED BATCHES
"KRN",19,441,10,8,0)
792^
"KRN",19,441,10,8,"^")
FBAA REINITIATE REJECTS
"KRN",19,441,10,11,0)
939^
"KRN",19,441,10,11,"^")
FBAA ENTER/EDIT LETTERS
"KRN",19,441,10,14,0)
1146^
"KRN",19,441,10,14,"^")
FBAA QUEUE DATA FOR TRANS.
"KRN",19,441,10,15,0)
1023^
"KRN",19,441,10,15,"^")
FBAA EDIT INVOICE STATUS
"KRN",19,441,10,17,0)
789^
"KRN",19,441,10,17,"^")
FBAA FINALIZE BATCH
"KRN",19,441,10,18,0)
790^
"KRN",19,441,10,18,"^")
FBAA VOUCHER DELETE REJECT
"KRN",19,441,10,19,0)
1280^
"KRN",19,441,10,19,"^")
FBAA CLERK LOOK-UP
"KRN",19,441,10,20,0)
1286^
"KRN",19,441,10,20,"^")
FBAA VOID PAYMENT MENU
"KRN",19,441,10,23,0)
2276^
"KRN",19,441,10,23,"^")
FBCH PRICER RELEASE
"KRN",19,441,10,29,0)
13627
"KRN",19,441,10,29,"^")
FB SEG DUTY RPT
"KRN",19,441,10,34,0)
13954
"KRN",19,441,10,34,"^")
FB SEC KEY RPT
"KRN",19,441,99)
63602,40667
"KRN",19,441,99.1)
63692,3605
"KRN",19,441,"U")
SUPERVISOR MAIN MENU
"KRN",19,442,-1)
0^60
"KRN",19,442,0)
FBAA ENTER PAYMENT^Enter Payment^^R^^FBAA LEVEL 1 PMT^^^^^^
"KRN",19,442,1,0)
^19.06^1^1^3081001^^^^
"KRN",19,442,1,1,0)
Used to enter or edit Medical Payment data.
"KRN",19,442,25)
FBAACO
"KRN",19,442,99)
55726,47541
"KRN",19,442,"U")
ENTER PAYMENT
"KRN",19,445,-1)
0^58
"KRN",19,445,0)
FBAA DELETE PAYMENT^Delete Payment Entry^^R^^FBAA LEVEL 1 PMT^^^^^^FEE BASIS
"KRN",19,445,1,0)
^^2^2^2940105^^^^
"KRN",19,445,1,1,0)
Used to delete a payment transaction. User must be same as user who entered
"KRN",19,445,1,2,0)
payment.
"KRN",19,445,20)

"KRN",19,445,25)
FBAAODP0
"KRN",19,445,"U")
DELETE PAYMENT ENTRY
"KRN",19,446,-1)
0^53
"KRN",19,446,0)
FBAA ENTER AUTHORIZATION^Enter Authorization^^R^^FBAA LEVEL 1 AUTH^^^^^^
"KRN",19,446,1,0)
^19.06^1^1^3080909^^^^
"KRN",19,446,1,1,0)
Used to enter or edit an Authorization for Fee services.
"KRN",19,446,25)
FBAAAUT
"KRN",19,446,"U")
ENTER AUTHORIZATION
"KRN",19,452,-1)
2^124
"KRN",19,452,0)
FBAA BATCH MENU^Batch Main Menu^^M^.5^^^^^^^
"KRN",19,452,10,0)
^19.01IP^14^14
"KRN",19,452,10,3,0)
454^
"KRN",19,452,10,3,"^")
FBAA CLOSE BATCH
"KRN",19,452,10,4,0)
455^
"KRN",19,452,10,4,"^")
FBAA REOPEN BATCH
"KRN",19,452,10,6,0)
786^
"KRN",19,452,10,6,"^")
FBAA OPEN BATCH
"KRN",19,452,10,7,0)
882^
"KRN",19,452,10,7,"^")
FBAA BATCH EDIT
"KRN",19,452,10,10,0)
4118^
"KRN",19,452,10,10,"^")
FBAA BATCH DELETE
"KRN",19,452,10,11,0)
998^
"KRN",19,452,10,11,"^")
FBAA SUPERVISOR RELEASE
"KRN",19,452,10,12,0)
790
"KRN",19,452,10,12,"^")
FBAA VOUCHER DELETE REJECT
"KRN",19,452,10,13,0)
789
"KRN",19,452,10,13,"^")
FBAA FINALIZE BATCH
"KRN",19,452,10,14,0)
459
"KRN",19,452,10,14,"^")
FBAA LIST CLOSED BATCHES
"KRN",19,452,"U")
BATCH MAIN MENU
"KRN",19,454,-1)
0^22
"KRN",19,454,0)
FBAA CLOSE BATCH^Close-out Batch^^R^^FBAA LEVEL 1 PMT^^^^^^
"KRN",19,454,1,0)
^^2^2^2860102^
"KRN",19,454,1,1,0)
Closes a Batch. Once batch is closed, no further payments may be added
"KRN",19,454,1,2,0)
to Batch.Travel dollars and Payment line count are tabulated.
"KRN",19,454,25)
FBAACCB
"KRN",19,454,"U")
CLOSE-OUT BATCH
"KRN",19,455,-1)
0^23
"KRN",19,455,0)
FBAA REOPEN BATCH^Re-open Batch^^R^^FBAA LEVEL 1 PMT^^^^^^
"KRN",19,455,1,0)
^^2^2^2860102^
"KRN",19,455,1,1,0)
Re-open a Batch which was previously closed. This will alliow 
"KRN",19,455,1,2,0)
additional payments to be entered into batch.
"KRN",19,455,25)
FBAARB
"KRN",19,455,"U")
RE-OPEN BATCH
"KRN",19,459,-1)
4^129
"KRN",19,459,0)
FBAA LIST CLOSED BATCHES
"KRN",19,464,-1)
0^100
"KRN",19,464,0)
FBAA ENTER PHARMACY INVOICE^Enter Pharmacy Invoice^^R^^FBAA LEVEL 1 PMT^^^^^^
"KRN",19,464,1,0)
^^1^1^2930322^^
"KRN",19,464,1,1,0)
Used to enter Fee Basis Pharmacy Invoices.
"KRN",19,464,25)
FBAAPIE
"KRN",19,464,"U")
ENTER PHARMACY INVOICE
"KRN",19,728,-1)
0^97
"KRN",19,728,0)
FBAA CLOSE OUT INVOICE^Closeout Pharmacy Invoice^^R^^FBAA LEVEL 1 PMT^^^^^^^^^1
"KRN",19,728,1,0)
^^3^3^2860512^^
"KRN",19,728,1,1,0)
This option must be used to assign a Batch Number to a Pharmacy Invoice
"KRN",19,728,1,2,0)
prior to Payment being sent to Austin. Option allows selection of 
"KRN",19,728,1,3,0)
only those Invoices which have been Completed by MAS.
"KRN",19,728,15)
K FBSW Q
"KRN",19,728,25)
FBAAPIP
"KRN",19,728,"U")
CLOSEOUT PHARMACY INVOICE
"KRN",19,729,-1)
0^98
"KRN",19,729,0)
FBAA COMPLETE PHARMACY INVOICE^Complete Pharmacy Invoice^^R^^FBAA LEVEL 1 PMT^^^^^^
"KRN",19,729,1,0)
^^3^3^2901108^^
"KRN",19,729,1,1,0)
Used to enter the remaining payment data for those items within the 
"KRN",19,729,1,2,0)
Invoice which required a determination by Pharmacy service. MAS must 
"KRN",19,729,1,3,0)
enter the remaining data prior to Close-out.
"KRN",19,729,25)
FBAACIE
"KRN",19,729,99)
55642,31672
"KRN",19,729,"U")
COMPLETE PHARMACY INVOICE
"KRN",19,783,-1)
0^62
"KRN",19,783,0)
FBAA MEDICAL REIMBURSEMENT^Reimbursement Payment Entry^^R^^FBAA LEVEL 1 PMT^^^^^^
"KRN",19,783,1,0)
^^1^1^2860722^^^
"KRN",19,783,1,1,0)
Used to enter a Reimbursement Payment for Medical Services.
"KRN",19,783,25)
FBAARP
"KRN",19,783,"U")
REIMBURSEMENT PAYMENT ENTRY
"KRN",19,786,-1)
0^55
"KRN",19,786,0)
FBAA OPEN BATCH^Open a Batch^^R^^FBAA LEVEL 1 PMT^^^^^^
"KRN",19,786,1,0)
^19.06^1^1^3111212^^
"KRN",19,786,1,1,0)
Allows user to create and open a new Batch. 
"KRN",19,786,25)
FBAAOB
"KRN",19,786,"U")
OPEN A BATCH
"KRN",19,789,-1)
4^128
"KRN",19,789,0)
FBAA FINALIZE BATCH
"KRN",19,790,-1)
4^127
"KRN",19,790,0)
FBAA VOUCHER DELETE REJECT
"KRN",19,792,-1)
0^27
"KRN",19,792,0)
FBAA REINITIATE REJECTS^Re-initiate Rejected Payment Items^^R^^FBAA LEVEL 1 PMT^^^^^^
"KRN",19,792,1,0)
^^1^1^2930426^^^
"KRN",19,792,1,1,0)
Used to re-initiate rejected items and assign to a new Batch.
"KRN",19,792,25)
FBAARR
"KRN",19,792,99)
55756,63230
"KRN",19,792,"U")
RE-INITIATE REJECTED PAYMENT I
"KRN",19,859,-1)
0^78
"KRN",19,859,0)
FBAA MRA DELETE VENDOR^Delete Vendor MRA^^R^^FBAA LEVEL 2^^^^^^
"KRN",19,859,1,0)
^19.06^17^17^3070927^^^^
"KRN",19,859,1,1,0)
The 'Delete Vendor MRA' option is used to place a vendor locally
"KRN",19,859,1,2,0)
in delete status whenever a vendor becomes inactive or cancels
"KRN",19,859,1,3,0)
FEE care.  This option will not send a delete request to the
"KRN",19,859,1,4,0)
Central Fee system in Austin.
"KRN",19,859,1,5,0)
  
"KRN",19,859,1,6,0)
  
"KRN",19,859,1,7,0)
 1)  If the vendor is in delete status on both your system as well as
"KRN",19,859,1,8,0)
     Central FEE, you only need to use the 'Reinstate Vendor MRA' option.
"KRN",19,859,1,9,0)
 
"KRN",19,859,1,10,0)
 2)  If the vendor is in delete status on your system, but no longer
"KRN",19,859,1,11,0)
     resides on the Central FEE system, use the 'Update FMS Vendor File 
"KRN",19,859,1,12,0)
     in Austin' option.
"KRN",19,859,1,13,0)
  
"KRN",19,859,1,14,0)
 3)  If a vendor which you were now adding to your system somehow
"KRN",19,859,1,15,0)
     already resided on the Central FEE system, but in delete status,
"KRN",19,859,1,16,0)
     you would need to add the vendor to your systemonly.  Doing so
"KRN",19,859,1,17,0)
     will re-activate the vendor in the Central system.
"KRN",19,859,25)
FBAADV
"KRN",19,859,"U")
DELETE VENDOR MRA
"KRN",19,862,-1)
0^75
"KRN",19,862,0)
FBAA VENDOR MRA MAIN MENU^Vendor MRA Main Menu^^M^^FBAA LEVEL 2^^^^^^
"KRN",19,862,1,0)
^19.06^1^1^3071001^^^^
"KRN",19,862,1,1,0)
Main Menu for Vendor MRA options.
"KRN",19,862,10,0)
^19.01IP^7^6
"KRN",19,862,10,1,0)
859^^2
"KRN",19,862,10,1,"^")
FBAA MRA DELETE VENDOR
"KRN",19,862,10,4,0)
1147^^3
"KRN",19,862,10,4,"^")
FBAA MRA VENDOR REINSTATE
"KRN",19,862,10,5,0)
4123^^1
"KRN",19,862,10,5,"^")
FBAA FMS UPDATE
"KRN",19,862,10,7,0)
4177^^5
"KRN",19,862,10,7,"^")
FBAA MRA'S AWAITING APPROVAL
"KRN",19,862,99)
63602,40666
"KRN",19,862,"U")
VENDOR MRA MAIN MENU
"KRN",19,882,-1)
0^21
"KRN",19,882,0)
FBAA BATCH EDIT^Edit Batch data^^R^^FBAA LEVEL 1 PMT^^^^^^
"KRN",19,882,1,0)
^^1^1^2930706^^^
"KRN",19,882,1,1,0)
Allows the editing of Obligation number and Date Batch Opened.
"KRN",19,882,25)
FBAABET
"KRN",19,882,30)

"KRN",19,882,31)

"KRN",19,882,50)

"KRN",19,882,51)

"KRN",19,882,"U")
EDIT BATCH DATA
"KRN",19,883,-1)
0^63
"KRN",19,883,0)
FBAA TRAVEL ENTRY^Travel Payment Only^^R^^FBAA LEVEL 1 PMT^^^^^^
"KRN",19,883,1,0)
^^2^2^2880304^
"KRN",19,883,1,1,0)
This option is used to enter/edit/delete a travel payment
"KRN",19,883,1,2,0)
for a fee patient.
"KRN",19,883,25)
FBAAETA
"KRN",19,883,"U")
TRAVEL PAYMENT ONLY
"KRN",19,906,-1)
0^101
"KRN",19,906,0)
FBAA REIMBURSEMENT PHARMACY^Patient Re-imbursement^^A^^FBAA LEVEL 1 PMT^^^^^^^^1
"KRN",19,906,1,0)
^^1^1^2861211^
"KRN",19,906,1,1,0)
Used to pay the Patient rather than a Vendor for a Pharmacy claim.
"KRN",19,906,20)
S FBAAPTC="R" D ^FBAAPIE K FBAAPTC
"KRN",19,906,99)
55775,36398
"KRN",19,906,"U")
PATIENT RE-IMBURSEMENT
"KRN",19,939,-1)
0^65
"KRN",19,939,0)
FBAA ENTER/EDIT LETTERS^Enter/Edit Suspension Letters^^R^^FBAASUPERVISOR^^^^^^
"KRN",19,939,1,0)
^^1^1^2930514^^
"KRN",19,939,1,1,0)
This option is used to enter/edit suspension and unauthorized claim letters.
"KRN",19,939,25)
FBAAELT
"KRN",19,939,"U")
ENTER/EDIT SUSPENSION LETTERS
"KRN",19,941,-1)
0^61
"KRN",19,941,0)
FBAA MULTIPLE PAYMENT ENTRY^Multiple Payment Entry^^R^^FBAA LEVEL 1 PMT^^^^^^
"KRN",19,941,1,0)
^^3^3^2880304^
"KRN",19,941,1,1,0)
This option is used to enter identical medical
"KRN",19,941,1,2,0)
payments for a specific patient and vendor.Only
"KRN",19,941,1,3,0)
the date of service may differ.
"KRN",19,941,25)
FBAAMP
"KRN",19,941,"U")
MULTIPLE PAYMENT ENTRY
"KRN",19,998,-1)
0^26
"KRN",19,998,0)
FBAA SUPERVISOR RELEASE^Release a Batch^^R^^FBAA LEVEL 2^^^^^^
"KRN",19,998,1,0)
^19.06^1^1^3140515^^^^
"KRN",19,998,1,1,0)
Used by a holder of the FBAA LEVEL 2 key to Release batch for payment.
"KRN",19,998,25)
FBAASCB
"KRN",19,998,"U")
RELEASE A BATCH
"KRN",19,999,-1)
0^56
"KRN",19,999,0)
FBAA PRINT 7079 GROUP^Group 7079 Print^^R^^FBAA LEVEL 2^^^^^^
"KRN",19,999,1,0)
^^1^1^2930610^^^^
"KRN",19,999,1,1,0)
Prints VA Form 7079 the Request for Outpatient Medical Services for a group.
"KRN",19,999,25)
FBAA79
"KRN",19,999,"U")
GROUP 7079 PRINT
"KRN",19,1009,-1)
0^99
"KRN",19,1009,0)
FBAA EDIT PHARMACY INVOICE^Edit Pharmacy Invoice^^R^^FBAA LEVEL 1 PMT^^^^^^
"KRN",19,1009,1,0)
^^1^1^2870318^
"KRN",19,1009,1,1,0)
ALLOWS EDITING OF PREVIOUSLY ENTERED PHARMACY INVOICE.
"KRN",19,1009,25)
FBAAEPI
"KRN",19,1009,"U")
EDIT PHARMACY INVOICE
"KRN",19,1021,-1)
0^59
"KRN",19,1021,0)
FBAA EDIT PAYMENT^Edit Payment^^R^^FBAA LEVEL 1 PMT^^^^^^
"KRN",19,1021,1,0)
^19.06^2^2^3081002^^^^
"KRN",19,1021,1,1,0)
This option is used to edit payments already entered in the
"KRN",19,1021,1,2,0)
system.
"KRN",19,1021,25)
FBAAPET
"KRN",19,1021,"U")
EDIT PAYMENT
"KRN",19,1023,-1)
0^66
"KRN",19,1023,0)
FBAA EDIT INVOICE STATUS^Edit Pharmacy Invoice Status^^E^^FBAA LEVEL 2^^^^^^
"KRN",19,1023,1,0)
^^1^1^2930507^^^
"KRN",19,1023,1,1,0)
USED TO CHANGE THE STATUS OF A PHARMACY INVOICE.
"KRN",19,1023,30)
FBAA(162.1,
"KRN",19,1023,31)
AEQM
"KRN",19,1023,50)
FBAA(162.1,
"KRN",19,1023,51)
5
"KRN",19,1023,"U")
EDIT PHARMACY INVOICE STATUS
"KRN",19,1141,-1)
0^83
"KRN",19,1141,0)
FBAA MRA VETERAN DELETE TYPE^Delete type Veteran MRA^^A^^FBAA LEVEL 2^^^^^^^^1
"KRN",19,1141,1,0)
^^2^2^2860915^^
"KRN",19,1141,1,1,0)
Creates a Patient MRA delete type transaction which will result in the
"KRN",19,1141,1,2,0)
deleting of that patient master record in the Fee centralized system.
"KRN",19,1141,20)
S FBMTYPE="D" D ^FBAAPM
"KRN",19,1141,25)

"KRN",19,1141,"U")
DELETE TYPE VETERAN MRA
"KRN",19,1142,-1)
0^81
"KRN",19,1142,0)
FBAA MRA VETERAN ADD TYPE^Add type Veteran MRA^^A^^FBAA LEVEL 2^^^^^^^^1
"KRN",19,1142,1,0)
^^3^3^2930706^^^
"KRN",19,1142,1,1,0)
Creates an Add type Veteran MRA transaction to be sent to the Centralized
"KRN",19,1142,1,2,0)
Fee system in Austin. Will result in the creation of a new Patient entry
"KRN",19,1142,1,3,0)
in the Central Patient file.
"KRN",19,1142,20)
S FBMTYPE="A" D ^FBAAPM
"KRN",19,1142,"U")
ADD TYPE VETERAN MRA
"KRN",19,1143,-1)
0^82
"KRN",19,1143,0)
FBAA MRA VETERAN CHANGE TYPE^Change type Veteran MRA^^A^^FBAA LEVEL 2^^^^^^^^1
"KRN",19,1143,1,0)
^^2^2^2860915^
"KRN",19,1143,1,1,0)
Creates Change type patient MRA to be sent to the Austin Central Fee system.
"KRN",19,1143,1,2,0)
Will result in the change of the Patient master record on that system.
"KRN",19,1143,20)
S FBMTYPE="C" D ^FBAAPM
"KRN",19,1143,"U")
CHANGE TYPE VETERAN MRA
"KRN",19,1144,-1)
0^84
"KRN",19,1144,0)
FBAA MRA VETERAN REINSTATE^Reinstate type Veteran MRA^^A^^FBAA LEVEL 2^^^^^^^^1
"KRN",19,1144,1,0)
^^2^2^2860915^
"KRN",19,1144,1,1,0)
Creates patient MRA 'Reinstate' type transaction. Will Reinstate patient
"KRN",19,1144,1,2,0)
(previously deleted) in the Central Fee system.
"KRN",19,1144,20)
S FBMTYPE="R" D ^FBAAPM
"KRN",19,1144,"U")
REINSTATE TYPE VETERAN MRA
"KRN",19,1145,-1)
0^76
"KRN",19,1145,0)
FBAA VETERAN MRA MAIN MENU^Veteran MRA Main Menu^^M^^FBAA LEVEL 2^^^^^^
"KRN",19,1145,1,0)
^^1^1^2860915^
"KRN",19,1145,1,1,0)
Main Menu for Patient MRA options.
"KRN",19,1145,10,0)
^19.01IP^4^4
"KRN",19,1145,10,1,0)
1142^
"KRN",19,1145,10,1,"^")
FBAA MRA VETERAN ADD TYPE
"KRN",19,1145,10,2,0)
1143^
"KRN",19,1145,10,2,"^")
FBAA MRA VETERAN CHANGE TYPE
"KRN",19,1145,10,3,0)
1141^
"KRN",19,1145,10,3,"^")
FBAA MRA VETERAN DELETE TYPE
"KRN",19,1145,10,4,0)
1144^
"KRN",19,1145,10,4,"^")
FBAA MRA VETERAN REINSTATE
"KRN",19,1145,99)
63602,40661
"KRN",19,1145,"U")
VETERAN MRA MAIN MENU
"KRN",19,1146,-1)
0^1
"KRN",19,1146,0)
FBAA QUEUE DATA FOR TRANS.^Queue Data for Transmission^^R^^FBAA LEVEL 2^^^^^^
"KRN",19,1146,1,0)
^19.06^2^2^3080407^^^^
"KRN",19,1146,1,1,0)
This option is used by the supervisor to transmit to Austin
"KRN",19,1146,1,2,0)
FEE payments and MRA's via electronic mail.
"KRN",19,1146,25)
FBAAV0
"KRN",19,1146,"U")
QUEUE DATA FOR TRANSMISSION
"KRN",19,1147,-1)
0^79
"KRN",19,1147,0)
FBAA MRA VENDOR REINSTATE^Reinstate Vendor MRA^^R^^FBAA LEVEL 2^^^^^^
"KRN",19,1147,1,0)
^19.06^14^14^3070920^^^^
"KRN",19,1147,1,1,0)
The 'Reinstate Vendor MRA' option is used to reactivate a vendor formerly in delete status.
"KRN",19,1147,1,2,0)
  
"KRN",19,1147,1,3,0)
  
"KRN",19,1147,1,4,0)
 1)  If the vendor is in delete status on both your system as well as
"KRN",19,1147,1,5,0)
     Central FEE, you only need to use the 'Reinstate Vendor MRA' option.
"KRN",19,1147,1,6,0)
 
"KRN",19,1147,1,7,0)
 2)  If the vendor is in delete status on your system, but no longer
"KRN",19,1147,1,8,0)
     resides on the Central FEE system, use the 'Update FMS Vendor File 
"KRN",19,1147,1,9,0)
     in Austin' option.
"KRN",19,1147,1,10,0)
  
"KRN",19,1147,1,11,0)
 3)  If a vendor which you were now adding to your system somehow
"KRN",19,1147,1,12,0)
     already resided on the Central FEE system, but in delete status,
"KRN",19,1147,1,13,0)
     you would need to add the vendor to your system, transmit data
"KRN",19,1147,1,14,0)
     to Austin, and then invoke the 'Reinstate Vendor MRA' option.
"KRN",19,1147,25)
FBAARV
"KRN",19,1147,"U")
REINSTATE VENDOR MRA
"KRN",19,1276,-1)
0^94
"KRN",19,1276,0)
FBAA MEDICAL VOID PAYMENT^Medical Void Payment^^R^^FBAA LEVEL 2^^^^^^
"KRN",19,1276,1,0)
^19.06^6^6^3140515^^^^
"KRN",19,1276,1,1,0)
This option allows a holder of the FBAA LEVEL 2 key to void
"KRN",19,1276,1,2,0)
a payment that has already been finalized. This option is useful
"KRN",19,1276,1,3,0)
in the circumstance that a check is returned by a vendor. You can
"KRN",19,1276,1,4,0)
retain the payment history but flag the payment as void(#).
"KRN",19,1276,1,5,0)
The dollars for the payment must be added back into
"KRN",19,1276,1,6,0)
the appropriate obligation using the appropriate IFCAP option.
"KRN",19,1276,25)
FBAAVP
"KRN",19,1276,"U")
MEDICAL VOID PAYMENT
"KRN",19,1277,-1)
0^96
"KRN",19,1277,0)
FBAA PHARMACY VOID PAYMENT^Pharmacy Void Payment^^R^^FBAA LEVEL 2^^^^^^
"KRN",19,1277,1,0)
^19.06^5^5^3140515^^^^
"KRN",19,1277,1,1,0)
This option allows a holder of the FBAA Level 2 key to void a
"KRN",19,1277,1,2,0)
payment to a Pharmacy vendor that has already been Finalized. By
"KRN",19,1277,1,3,0)
using this option you have the ability to retain the payment history
"KRN",19,1277,1,4,0)
yet, for some reason, void the payment. The dollar amount must be added
"KRN",19,1277,1,5,0)
back to the obligation using the appropriate IFCAP option.
"KRN",19,1277,25)
FBAAPHV
"KRN",19,1277,"U")
PHARMACY VOID PAYMENT
"KRN",19,1278,-1)
0^93
"KRN",19,1278,0)
FBAA CANCEL MEDICAL VOID^Medical Delete Void Payment^^R^^FBAA LEVEL 2^^^^^^^^1^1
"KRN",19,1278,1,0)
^19.06^3^3^3140515^^^^
"KRN",19,1278,1,1,0)
This option will delete the void flag. The dollar amount for the payment
"KRN",19,1278,1,2,0)
must be subtracted from the obligation using the appropriate
"KRN",19,1278,1,3,0)
IFCAP option.
"KRN",19,1278,15)
K FBVOID
"KRN",19,1278,20)
S FBVOID=1
"KRN",19,1278,25)
FBAAVP
"KRN",19,1278,"U")
MEDICAL DELETE VOID PAYMENT
"KRN",19,1279,-1)
0^95
"KRN",19,1279,0)
FBAA CANCEL PHARMACY VOID^Pharmacy Delete Void Payment^^R^^FBAA LEVEL 2^^^^^^^^1^1
"KRN",19,1279,1,0)
^19.06^3^3^3140515^^^
"KRN",19,1279,1,1,0)
This option will delete the void flag. The dollar amount for the payment
"KRN",19,1279,1,2,0)
must be subtracted from the obligation using the appropriate
"KRN",19,1279,1,3,0)
IFCAP obligation.
"KRN",19,1279,15)
K FBVOID
"KRN",19,1279,20)
S FBVOID=1
"KRN",19,1279,25)
FBAAPHV
"KRN",19,1279,"U")
PHARMACY DELETE VOID PAYMENT
"KRN",19,1280,-1)
0^64
"KRN",19,1280,0)
FBAA CLERK LOOK-UP^Clerk Look-Up For An Authorization^^R^^FBAASUPERVISOR^^^^^^FEE BASIS^^1^1
"KRN",19,1280,1,0)
^^4^4^3141125^
"KRN",19,1280,1,1,0)
This option will list users that entered or edited a specified 
"KRN",19,1280,1,2,0)
authorization in the FEE BASIS PATIENT file.  When applicable the output 
"KRN",19,1280,1,3,0)
will also show users that entered or edited the civil hospital 
"KRN",19,1280,1,4,0)
notification or unauthorized claims associated with the authorization.
"KRN",19,1280,15)
K FBFILE
"KRN",19,1280,20)
S FBFILE=161.01
"KRN",19,1280,25)
FBAACLU
"KRN",19,1280,"U")
CLERK LOOK-UP FOR AN AUTHORIZA
"KRN",19,1286,-1)
0^68
"KRN",19,1286,0)
FBAA VOID PAYMENT MENU^Void Payment Main Menu^^M^^FBAA LEVEL 2^^^^^^
"KRN",19,1286,1,0)
^^2^2^2900713^^
"KRN",19,1286,1,1,0)
This menu contains the options to void and/or cancel a
"KRN",19,1286,1,2,0)
void on a payment that has already been finalized.
"KRN",19,1286,10,0)
^19.01IP^8^8
"KRN",19,1286,10,1,0)
1276^
"KRN",19,1286,10,1,"^")
FBAA MEDICAL VOID PAYMENT
"KRN",19,1286,10,2,0)
1277^
"KRN",19,1286,10,2,"^")
FBAA PHARMACY VOID PAYMENT
"KRN",19,1286,10,3,0)
1278^
"KRN",19,1286,10,3,"^")
FBAA CANCEL MEDICAL VOID
"KRN",19,1286,10,4,0)
1279^
"KRN",19,1286,10,4,"^")
FBAA CANCEL PHARMACY VOID
"KRN",19,1286,10,5,0)
3927^
"KRN",19,1286,10,5,"^")
FBCH VOID PAYMENT
"KRN",19,1286,10,6,0)
3928^
"KRN",19,1286,10,6,"^")
FBCH DELETE VOID
"KRN",19,1286,10,7,0)
3929^
"KRN",19,1286,10,7,"^")
FBCNH VOID PAYMENT
"KRN",19,1286,10,8,0)
3930^
"KRN",19,1286,10,8,"^")
FBCNH DELETE VOID
"KRN",19,1286,99)
63602,40665
"KRN",19,1286,"U")
VOID PAYMENT MAIN MENU
"KRN",19,1288,-1)
0^2
"KRN",19,1288,0)
FBCH LEGAL ENTITLEMENT^Legal Entitlement^^R^^FBAA LEVEL 1 AUTH^^^^^^
"KRN",19,1288,1,0)
^19.06^3^3^3120709^^^
"KRN",19,1288,1,1,0)
Legal entitlement must be determined by the user before
"KRN",19,1288,1,2,0)
medical entitlement. If the veteran is determined not
"KRN",19,1288,1,3,0)
to be legally entitled then the request is completed.
"KRN",19,1288,25)
LENT^FBCHREQ
"KRN",19,1288,"U")
LEGAL ENTITLEMENT
"KRN",19,1289,-1)
0^3
"KRN",19,1289,0)
FBCH MEDICAL ENTITLEMENT^Medical Entitlement^^R^^FBAA LEVEL 1 AUTH^^^^^^
"KRN",19,1289,1,0)
^^3^3^2900424^^
"KRN",19,1289,1,1,0)
This option is used to enter the medical entitlement of a
"KRN",19,1289,1,2,0)
veteran. Legal entitlement has to be determined , for the
"KRN",19,1289,1,3,0)
veteran, prior to using this option.
"KRN",19,1289,25)
MENT^FBCHREQ
"KRN",19,1289,"U")
MEDICAL ENTITLEMENT
"KRN",19,1290,-1)
0^6
"KRN",19,1290,0)
FBCH COMPLETE 7078^Complete 7078/Authorization^^R^^FBAA LEVEL 1 AUTH^^^^^^
"KRN",19,1290,1,0)
^19.06^3^3^3070809^^
"KRN",19,1290,1,1,0)
If the discharge date was not determined at the time of the
"KRN",19,1290,1,2,0)
medical entitlement, this option is used to complete
"KRN",19,1290,1,3,0)
the 7078.
"KRN",19,1290,25)
FBCHCD
"KRN",19,1290,"U")
COMPLETE 7078/AUTHORIZATION
"KRN",19,1291,-1)
0^7
"KRN",19,1291,0)
FBCH EDIT 7078^Edit Completed 7078^^R^^FBAA LEVEL 1 AUTH^^^^^^
"KRN",19,1291,1,0)
^^9^9^2900725^^^
"KRN",19,1291,1,1,0)
This option allows the user to edit a completed 7078/authorization.
"KRN",19,1291,1,2,0)
The following fields may be editted using this option:
"KRN",19,1291,1,3,0)
         - Admitting Authority
"KRN",19,1291,1,4,0)
         - To Date
"KRN",19,1291,1,5,0)
         - Discharge Type
"KRN",19,1291,1,6,0)
         - Bedsection/Treating Specialty
"KRN",19,1291,1,7,0)
         - Purpose of Visit
"KRN",19,1291,1,8,0)
         - Authorization Remarks
"KRN",19,1291,1,9,0)
         - Primary Service Area
"KRN",19,1291,25)
EDIT^FBCHCD
"KRN",19,1291,99)
55647,37357
"KRN",19,1291,"U")
EDIT COMPLETED 7078
"KRN",19,1294,-1)
0^15
"KRN",19,1294,0)
FBCH ENTER PAYMENT^Enter Invoice/Payment^^R^^FBAA LEVEL 1 PMT^^^^^^^^^1
"KRN",19,1294,1,0)
^^3^3^2890131^^
"KRN",19,1294,1,1,0)
This option is used to enter a payment for the first time.
"KRN",19,1294,1,2,0)
The user has to use the 'Edit payment' option to make
"KRN",19,1294,1,3,0)
changes.
"KRN",19,1294,15)
K FB583 Q
"KRN",19,1294,25)
FBCHEP
"KRN",19,1294,99)
55769,39621
"KRN",19,1294,"U")
ENTER INVOICE/PAYMENT
"KRN",19,1295,-1)
0^16
"KRN",19,1295,0)
FBCH EDIT PAYMENT^Invoice Edit^^R^^FBAA LEVEL 1 PMT^^^^^^
"KRN",19,1295,1,0)
^^2^2^2890127^
"KRN",19,1295,1,1,0)
This option is used to edit the dollar amounts as well
"KRN",19,1295,1,2,0)
as any diagnostic and/or procedure codes.
"KRN",19,1295,25)
FBCHEP1
"KRN",19,1295,"U")
INVOICE EDIT
"KRN",19,1297,-1)
2^134
"KRN",19,1297,0)
FBCH NOTIFICATION MENU^Notification/Request Menu^^M^.5^^^^^^^
"KRN",19,1297,10,0)
^19.01IP^13^13
"KRN",19,1297,10,2,0)
1288^^2
"KRN",19,1297,10,2,"^")
FBCH LEGAL ENTITLEMENT
"KRN",19,1297,10,3,0)
1289^^3
"KRN",19,1297,10,3,"^")
FBCH MEDICAL ENTITLEMENT
"KRN",19,1297,10,5,0)
2325^
"KRN",19,1297,10,5,"^")
FBCH DELETE REQUEST
"KRN",19,1297,10,11,0)
3603^
"KRN",19,1297,10,11,"^")
FBCH REOPEN REQUEST
"KRN",19,1297,10,13,0)
13957
"KRN",19,1297,10,13,"^")
FBCH REQUEST CLERK LOOKUP
"KRN",19,1297,"U")
NOTIFICATION/REQUEST MENU
"KRN",19,1300,-1)
2^136
"KRN",19,1300,0)
FBCH OUTPUT MENU^Output Menu^^M^.5^^^^^^^
"KRN",19,1300,10,0)
^19.01IP^23^23
"KRN",19,1300,10,2,0)
459^
"KRN",19,1300,10,2,"^")
FBAA LIST CLOSED BATCHES
"KRN",19,1300,10,23,0)
13956
"KRN",19,1300,10,23,"^")
FBCH CLERK LOOKUP
"KRN",19,1300,"U")
OUTPUT MENU
"KRN",19,1301,-1)
0^20
"KRN",19,1301,0)
FBCH OPEN BATCH^Open a Batch^^R^^FBAA LEVEL 1 PMT^^^^^^
"KRN",19,1301,1,0)
^^1^1^2900409^^
"KRN",19,1301,1,1,0)
This option is used to open a batch for Contract Hospital.
"KRN",19,1301,25)
RCHOP^FBAAOB
"KRN",19,1301,"U")
OPEN A BATCH
"KRN",19,1306,-1)
2^126
"KRN",19,1306,0)
FBCH BATCH OPTIONS^Batch Main Menu - CH^^M^.5^^^^^^^
"KRN",19,1306,10,0)
^19.01IP^17^17
"KRN",19,1306,10,3,0)
454^^3
"KRN",19,1306,10,3,"^")
FBAA CLOSE BATCH
"KRN",19,1306,10,4,0)
455^^4
"KRN",19,1306,10,4,"^")
FBAA REOPEN BATCH
"KRN",19,1306,10,6,0)
1301^^1
"KRN",19,1306,10,6,"^")
FBCH OPEN BATCH
"KRN",19,1306,10,7,0)
882^^2
"KRN",19,1306,10,7,"^")
FBAA BATCH EDIT
"KRN",19,1306,10,8,0)
790^^8
"KRN",19,1306,10,8,"^")
FBAA VOUCHER DELETE REJECT
"KRN",19,1306,10,9,0)
789^^6
"KRN",19,1306,10,9,"^")
FBAA FINALIZE BATCH
"KRN",19,1306,10,11,0)
792^^7
"KRN",19,1306,10,11,"^")
FBAA REINITIATE REJECTS
"KRN",19,1306,10,12,0)
2276^^5
"KRN",19,1306,10,12,"^")
FBCH PRICER RELEASE
"KRN",19,1306,10,13,0)
998^^5.5
"KRN",19,1306,10,13,"^")
FBAA SUPERVISOR RELEASE
"KRN",19,1306,10,14,0)
2303^^5.3
"KRN",19,1306,10,14,"^")
FBCH REINITIATE PRICER REJECTS
"KRN",19,1306,10,15,0)
2323^
"KRN",19,1306,10,15,"^")
FBCH OPEN ANCILLARY BATCH
"KRN",19,1306,10,16,0)
4118^
"KRN",19,1306,10,16,"^")
FBAA BATCH DELETE
"KRN",19,1306,10,17,0)
459
"KRN",19,1306,10,17,"^")
FBAA LIST CLOSED BATCHES
"KRN",19,1306,"U")
BATCH MAIN MENU - CH
"KRN",19,1311,-1)
0^39
"KRN",19,1311,0)
FBCNH POST COMMITMENTS^Post Commitments for Obligation^^R^^FBAA LEVEL 1 AUTH^^^^^^
"KRN",19,1311,1,0)
^19.06^5^5^3001130^^^^
"KRN",19,1311,1,1,0)
Used to post commitments for Community Nursing Home obligation. The data
"KRN",19,1311,1,2,0)
is based on previously entered VA FORM 10-7078 file entries.
"KRN",19,1311,1,3,0)
This option passes data to the IFCAP system, specifically, the 1358 module.
"KRN",19,1311,1,4,0)
This option can  only be used if the CNH program uses one control point and 
"KRN",19,1311,1,5,0)
obligation per month.
"KRN",19,1311,25)
FBNHPC
"KRN",19,1311,"U")
POST COMMITMENTS FOR OBLIGATIO
"KRN",19,1312,-1)
0^38
"KRN",19,1312,0)
FBCNH ESTIMATE FUNDS^Estimate Funds for Obligation^^A^^FBAA LEVEL 1 AUTH^^^^^^^^1
"KRN",19,1312,1,0)
^19.06^2^2^3001201^^^^
"KRN",19,1312,1,1,0)
Used to estimate funds needed in the future. Estimate is based on 
"KRN",19,1312,1,2,0)
previously entered data in the VA FORM 10-7078 file.
"KRN",19,1312,20)
S FBNHCC=1,(FBSEQ,FBOBN)="" D EN1^FBNHPC Q
"KRN",19,1312,99)
55780,50178
"KRN",19,1312,"U")
ESTIMATE FUNDS FOR OBLIGATION
"KRN",19,2116,-1)
0^70
"KRN",19,2116,0)
FBAA CALCULATE SCHEDULE^Compile Fee Schedule^^R^^FBAASUPERVISOR^^^^^^
"KRN",19,2116,1,0)
^^6^6^2890822^
"KRN",19,2116,1,1,0)
This option will compile your Fee Schedule based on
"KRN",19,2116,1,2,0)
a specified date range. In order to be effective at
"KRN",19,2116,1,3,0)
least one year of data should be on line. Since this
"KRN",19,2116,1,4,0)
option will go through the payment file for the
"KRN",19,2116,1,5,0)
specified date range it should be a QUEUED output.
"KRN",19,2116,1,6,0)
This option must be run yearly.
"KRN",19,2116,25)
FBAAPAY
"KRN",19,2116,"U")
COMPILE FEE SCHEDULE
"KRN",19,2118,-1)
0^69
"KRN",19,2118,0)
FBAA EDIT SCHEDULE^Add/Edit Fee Schedule^^R^^FBAASUPERVISOR^^^^^^
"KRN",19,2118,1,0)
^^3^3^2941222^^
"KRN",19,2118,1,1,0)
This option can be used to enter a CPT code into
"KRN",19,2118,1,2,0)
the Fee Schedule file for use as a default Amount
"KRN",19,2118,1,3,0)
Paid in the Outpatient Medical program.
"KRN",19,2118,25)
FBAAPAA
"KRN",19,2118,"U")
ADD/EDIT FEE SCHEDULE
"KRN",19,2250,-1)
0^37
"KRN",19,2250,0)
FBCNH OPEN BATCH^Open CNH Batch^^A^^FBAA LEVEL 1 PMT^^^^^^FEE BASIS^y^1
"KRN",19,2250,1,0)
^^1^1^2930517^^^
"KRN",19,2250,1,1,0)
Used to open a Community Nursing Home Batch type.
"KRN",19,2250,20)
D RCHNH^FBAAOB
"KRN",19,2250,"U")
OPEN CNH BATCH
"KRN",19,2253,-1)
0^40
"KRN",19,2253,0)
FBCNH ADMIT^Admit To CNH^^R^^FBAA LEVEL 1 AUTH^^^^^^FEE BASIS^y
"KRN",19,2253,1,0)
^^1^1^2900326^
"KRN",19,2253,1,1,0)
Used to Admit a veteran to a Community Nursing Home.
"KRN",19,2253,25)
FBNHEA
"KRN",19,2253,"U")
ADMIT TO CNH
"KRN",19,2254,-1)
0^44
"KRN",19,2254,0)
FBCNH TRANSFER^Transfer Movement^^R^^FBAA LEVEL 1 AUTH^^^^^^FEE BASIS^y
"KRN",19,2254,1,0)
^^2^2^2900326^
"KRN",19,2254,1,1,0)
Used to Transfer veteran from ASIH or to ASIH within the Community
"KRN",19,2254,1,2,0)
Nursing Home program.
"KRN",19,2254,25)
FBNHET
"KRN",19,2254,"U")
TRANSFER MOVEMENT
"KRN",19,2255,-1)
0^42
"KRN",19,2255,0)
FBCNH DISCHARGE^Discharge From CNH^^R^^FBAA LEVEL 1 AUTH^^^^^^FEE BASIS^y
"KRN",19,2255,1,0)
^^1^1^2900425^^
"KRN",19,2255,1,1,0)
Used to enter a Discharge from a Community Nursing Home.
"KRN",19,2255,25)
FBNHED
"KRN",19,2255,"U")
DISCHARGE FROM CNH
"KRN",19,2256,-1)
0^31
"KRN",19,2256,0)
FBCNH ENTER AUTHORIZATION^Enter CNH Authorization^^R^^FBAA LEVEL 1 AUTH^^^^^^FEE BASIS^y
"KRN",19,2256,1,0)
^19.06^2^2^3080828^^
"KRN",19,2256,1,1,0)
Used to enter a new Community Nursing Home authorization only.  This
"KRN",19,2256,1,2,0)
option cannot be used to edit a previously entered authorization.
"KRN",19,2256,25)
FBNHEAUT
"KRN",19,2256,99)
55816,53431
"KRN",19,2256,"U")
ENTER CNH AUTHORIZATION
"KRN",19,2257,-1)
0^52
"KRN",19,2257,0)
FBCNH ENTER PAYMENT^Enter CNH Payment^^R^^FBAA LEVEL 1 PMT^^^^^^FEE BASIS^y
"KRN",19,2257,1,0)
^^1^1^2900423^^
"KRN",19,2257,1,1,0)
Used to enter a Community Nursing Home payment.
"KRN",19,2257,25)
FBNHEP
"KRN",19,2257,"U")
ENTER CNH PAYMENT
"KRN",19,2276,-1)
0^24
"KRN",19,2276,0)
FBCH PRICER RELEASE^Pricer Batch Release^^R^^FBAA LEVEL 1 PMT^^^^^^
"KRN",19,2276,1,0)
^19.06^3^3^3140528^^^^
"KRN",19,2276,1,1,0)
This option is used to review payments for contract hospital
"KRN",19,2276,1,2,0)
and mark them for transmission to the Austin Pricer for
"KRN",19,2276,1,3,0)
grouping and price.
"KRN",19,2276,25)
FBCHSCB
"KRN",19,2276,"U")
PRICER BATCH RELEASE
"KRN",19,2277,-1)
0^12
"KRN",19,2277,0)
FBCH COMPLETE PAYMENT^Complete a Payment^^R^^FBAA LEVEL 1 PMT^^^^^^
"KRN",19,2277,1,0)
^19.06^4^4^3140714^^^^
"KRN",19,2277,1,1,0)
This option is used to enter the amount paid for a contract hospital
"KRN",19,2277,1,2,0)
bill received from the Austin pricer. The status of the batch must be
"KRN",19,2277,1,3,0)
equal to "P" and the user must be the owner of the batch or hold the
"KRN",19,2277,1,4,0)
'FBAA LEVEL 2' security key in order to complete the batch.
"KRN",19,2277,25)
FBCHEAP
"KRN",19,2277,99)
55685,43203
"KRN",19,2277,"U")
COMPLETE A PAYMENT
"KRN",19,2279,-1)
0^32
"KRN",19,2279,0)
FBCNH EDIT AUTHORIZATION^Edit CNH Authorization^^R^^FBAA LEVEL 1 AUTH^^^^^^
"KRN",19,2279,1,0)
^^1^1^2940803^^^
"KRN",19,2279,1,1,0)
Used to edit a previously entered Community Nursing Home authorization.
"KRN",19,2279,25)
FBNHEDAT
"KRN",19,2279,"U")
EDIT CNH AUTHORIZATION
"KRN",19,2281,-1)
0^51
"KRN",19,2281,0)
FBCNH EDIT PAYMENT^Edit CNH Payment^^A^^FBAA LEVEL 1 PMT^^^^^^^^1
"KRN",19,2281,1,0)
^19.06^1^1^3020923^^^^
"KRN",19,2281,1,1,0)
Used to edit a previously entered Community Nursing Home payment.
"KRN",19,2281,20)
D EDIT^FBNHEDPA
"KRN",19,2281,"U")
EDIT CNH PAYMENT
"KRN",19,2285,-1)
0^10
"KRN",19,2285,0)
FBCH 7078 SETUP^Set-up a 7078^^R^^FBAA LEVEL 1 AUTH^^^^^^
"KRN",19,2285,1,0)
^^2^2^2900425^
"KRN",19,2285,1,1,0)
This option is used to set-up a 7078 Contract Hospital authorization.
"KRN",19,2285,1,2,0)
There must be a "completed" request on file for this option.
"KRN",19,2285,25)
FBCH78
"KRN",19,2285,"U")
SET-UP A 7078
"KRN",19,2289,-1)
2^137
"KRN",19,2289,0)
FBCNH OUTPUTS MAIN MENU^Output Main Menu - CNH^^M^.5^^^^^^^
"KRN",19,2289,10,0)
^19.01IP^27^27
"KRN",19,2289,10,27,0)
13956
"KRN",19,2289,10,27,"^")
FBCH CLERK LOOKUP
"KRN",19,2289,"U")
OUTPUT MAIN MENU - CNH
"KRN",19,2291,-1)
0^48
"KRN",19,2291,0)
FBCNH EDIT ADMISSION^Admission Edit^^R^^FBAA LEVEL 1 AUTH^^^^^^
"KRN",19,2291,1,0)
^^1^1^2900426^
"KRN",19,2291,1,1,0)
Used to edit admission data.
"KRN",19,2291,25)
FBNHEDAD
"KRN",19,2291,"U")
ADMISSION EDIT
"KRN",19,2292,-1)
0^50
"KRN",19,2292,0)
FBCNH EDIT TRANSFER^Transfer Edit^^R^^FBAA LEVEL 1 AUTH^^^^^^
"KRN",19,2292,1,0)
^^1^1^2930510^^
"KRN",19,2292,1,1,0)
Edit Transfer in Fee Basis CNH Activity file.
"KRN",19,2292,25)
FBNHEDTR
"KRN",19,2292,"U")
TRANSFER EDIT
"KRN",19,2293,-1)
0^49
"KRN",19,2293,0)
FBCNH EDIT DISCHARGE^Discharge Edit^^R^^FBAA LEVEL 1 AUTH^^^^^^
"KRN",19,2293,1,0)
^^1^1^2930510^^
"KRN",19,2293,1,1,0)
Used to edit discharge data in Fee Basis CNH Activity file.
"KRN",19,2293,25)
FBNHEDDI
"KRN",19,2293,"U")
DISCHARGE EDIT
"KRN",19,2294,-1)
0^43
"KRN",19,2294,0)
FBCNH EDIT MOVEMENT^Edit Movement Menu^^M^^FBAA LEVEL 1 AUTH^^^^^^
"KRN",19,2294,1,0)
^^1^1^2900426^
"KRN",19,2294,1,1,0)
Main menu containing edit movement options.
"KRN",19,2294,10,0)
^19.01IP^3^3
"KRN",19,2294,10,1,0)
2291^
"KRN",19,2294,10,1,"^")
FBCNH EDIT ADMISSION
"KRN",19,2294,10,2,0)
2292^
"KRN",19,2294,10,2,"^")
FBCNH EDIT TRANSFER
"KRN",19,2294,10,3,0)
2293^
"KRN",19,2294,10,3,"^")
FBCNH EDIT DISCHARGE
"KRN",19,2294,99)
63602,40664
"KRN",19,2294,"U")
EDIT MOVEMENT MENU
"KRN",19,2295,-1)
0^41
"KRN",19,2295,0)
FBCNH DELETE MOVEMENT MENU^Delete Movement Menu^^M^^FBAA LEVEL 1 AUTH^^^^^^
"KRN",19,2295,1,0)
^^1^1^2941228^^^
"KRN",19,2295,1,1,0)
Main menu for delete movement options.
"KRN",19,2295,10,0)
^19.01IP^3^3
"KRN",19,2295,10,1,0)
2296^
"KRN",19,2295,10,1,"^")
FBCNH DELETE ADMISSION
"KRN",19,2295,10,2,0)
2297^
"KRN",19,2295,10,2,"^")
FBCNH DELETE TRANSFER
"KRN",19,2295,10,3,0)
2298^
"KRN",19,2295,10,3,"^")
FBCNH DELETE DISCHARGE
"KRN",19,2295,99)
63602,40664
"KRN",19,2295,"U")
DELETE MOVEMENT MENU
"KRN",19,2296,-1)
0^45
"KRN",19,2296,0)
FBCNH DELETE ADMISSION^Admission Delete^^R^^FBAA LEVEL 1 AUTH^^^^^^
"KRN",19,2296,1,0)
^^1^1^2900426^
"KRN",19,2296,1,1,0)
Used to delete an admission.
"KRN",19,2296,25)
FBNHDLAD
"KRN",19,2296,"U")
ADMISSION DELETE
"KRN",19,2297,-1)
0^47
"KRN",19,2297,0)
FBCNH DELETE TRANSFER^Transfer Delete^^R^^FBAA LEVEL 1 AUTH^^^^^^
"KRN",19,2297,1,0)
^^1^1^2900426^
"KRN",19,2297,1,1,0)
Used to delete a transfer movement.
"KRN",19,2297,25)
FBNHDLTR
"KRN",19,2297,"U")
TRANSFER DELETE
"KRN",19,2298,-1)
0^46
"KRN",19,2298,0)
FBCNH DELETE DISCHARGE^Discharge Delete^^R^^FBAA LEVEL 1 AUTH^^^^^^
"KRN",19,2298,1,0)
^^1^1^2900426^
"KRN",19,2298,1,1,0)
Used to delete a discharge.
"KRN",19,2298,25)
FBNHDLDI
"KRN",19,2298,"U")
DISCHARGE DELETE
"KRN",19,2303,-1)
0^25
"KRN",19,2303,0)
FBCH REINITIATE PRICER REJECTS^Re-initiate Pricer Rejected Items^^R^^FBAA LEVEL 1 PMT^^^^^^
"KRN",19,2303,1,0)
^^3^3^2930517^^^
"KRN",19,2303,1,1,0)
This option is used to reinitiate rejects from the Austin
"KRN",19,2303,1,2,0)
Pricer system. You will be given the opportunity to edit the
"KRN",19,2303,1,3,0)
payment after reinitiating.
"KRN",19,2303,25)
FBCHRR
"KRN",19,2303,"U")
RE-INITIATE PRICER REJECTED IT
"KRN",19,2310,-1)
0^11
"KRN",19,2310,0)
FBCH ANCILLARY PAYMENT^Ancillary Contract Hosp/CNH Payment^^R^^FBAA LEVEL 1 PMT^^^^^^
"KRN",19,2310,1,0)
^19.06^4^4^3020923^^^^
"KRN",19,2310,1,1,0)
This option is used to enter payments for ancillary services
"KRN",19,2310,1,2,0)
incurred while a contract hospital or community nursing home patient.
"KRN",19,2310,1,3,0)
The option allows the selection of a MEDICAL batch ('B3')
"KRN",19,2310,1,4,0)
and a Contract Hospital or Community Nursing Home authorization.
"KRN",19,2310,25)
FBCHCO
"KRN",19,2310,99)
55747,68179
"KRN",19,2310,"U")
ANCILLARY CONTRACT HOSP/CNH PA
"KRN",19,2323,-1)
0^29
"KRN",19,2323,0)
FBCH OPEN ANCILLARY BATCH^Open Ancillary Payment Batch^^R^^FBAA LEVEL 1 PMT^^^^^^
"KRN",19,2323,1,0)
^^2^2^2900814^^
"KRN",19,2323,1,1,0)
This option is used to open a batch that is used for entering
"KRN",19,2323,1,2,0)
ancillary payments associated with a contract hospital admission.
"KRN",19,2323,25)
ANCOB^FBAAOB
"KRN",19,2323,"U")
OPEN ANCILLARY PAYMENT BATCH
"KRN",19,2325,-1)
0^4
"KRN",19,2325,0)
FBCH DELETE REQUEST^Delete Notification/Request^^R^^FBAA LEVEL 1 AUTH^^^^^^
"KRN",19,2325,1,0)
^19.06^4^4^3140714^^^
"KRN",19,2325,1,1,0)
This option allows you to delete a Request/Notification as long
"KRN",19,2325,1,2,0)
as there is not a 7078 set up for the request. In order to delete the
"KRN",19,2325,1,3,0)
request, you must either be the user who entered the request or be
"KRN",19,2325,1,4,0)
the holder of the FBAA LEVEL 2 security key.
"KRN",19,2325,25)
FBCHDEL
"KRN",19,2325,"U")
DELETE NOTIFICATION/REQUEST
"KRN",19,2361,-1)
0^14
"KRN",19,2361,0)
FBCH EDIT ANCILLARY PAYMENT^Edit Ancillary Payment^^R^^FBAA LEVEL 1 PMT^^^^^^
"KRN",19,2361,1,0)
^^1^1^2930315^^^
"KRN",19,2361,1,1,0)
This is an edit payment option for ancillary payments.
"KRN",19,2361,25)
FBCHPET
"KRN",19,2361,"U")
EDIT ANCILLARY PAYMENT
"KRN",19,2365,-1)
0^102
"KRN",19,2365,0)
FBAA OPEN PHARMACY BATCH^Open a Pharmacy Batch^^A^^FBAA LEVEL 1 PMT^^^^^^^^1^1
"KRN",19,2365,1,0)
^^2^2^2930517^^
"KRN",19,2365,1,1,0)
This option is on the Pharmacy batch menu, and allows the user to
"KRN",19,2365,1,2,0)
open pharmacy batches only.
"KRN",19,2365,15)
K FBPHOPT
"KRN",19,2365,20)
S FBPHOPT=1 D RPHARM^FBAAOB
"KRN",19,2365,25)

"KRN",19,2365,"U")
OPEN A PHARMACY BATCH
"KRN",19,2366,-1)
2^125
"KRN",19,2366,0)
FBAA PHARMACY BATCH OPTIONS^Batch Menu - Pharmacy^^M^.5^^^^^^^
"KRN",19,2366,10,0)
^19.01IP^12^12
"KRN",19,2366,10,1,0)
2365^
"KRN",19,2366,10,1,"^")
FBAA OPEN PHARMACY BATCH
"KRN",19,2366,10,2,0)
454^
"KRN",19,2366,10,2,"^")
FBAA CLOSE BATCH
"KRN",19,2366,10,4,0)
882^
"KRN",19,2366,10,4,"^")
FBAA BATCH EDIT
"KRN",19,2366,10,6,0)
455^
"KRN",19,2366,10,6,"^")
FBAA REOPEN BATCH
"KRN",19,2366,10,8,0)
998^
"KRN",19,2366,10,8,"^")
FBAA SUPERVISOR RELEASE
"KRN",19,2366,10,9,0)
4118^
"KRN",19,2366,10,9,"^")
FBAA BATCH DELETE
"KRN",19,2366,10,10,0)
790
"KRN",19,2366,10,10,"^")
FBAA VOUCHER DELETE REJECT
"KRN",19,2366,10,11,0)
789
"KRN",19,2366,10,11,"^")
FBAA FINALIZE BATCH
"KRN",19,2366,10,12,0)
459
"KRN",19,2366,10,12,"^")
FBAA LIST CLOSED BATCHES
"KRN",19,2366,"U")
BATCH MENU - PHARMACY
"KRN",19,3603,-1)
0^5
"KRN",19,3603,0)
FBCH REOPEN REQUEST^Reconsider a Denied Request^^R^^FBAA LEVEL 2^^^^^^
"KRN",19,3603,1,0)
^19.06^3^3^3140513^^^^
"KRN",19,3603,1,1,0)
This option is restricted to the holder of the 'FBAA LEVEL 2' key.
"KRN",19,3603,1,2,0)
It allows the supervisor to reconsider a previously denied request.
"KRN",19,3603,1,3,0)
There is an audit on the Legal and Medical Entitlement fields.
"KRN",19,3603,25)
FBCHREQ2
"KRN",19,3603,"U")
RECONSIDER A DENIED REQUEST
"KRN",19,3606,-1)
0^8
"KRN",19,3606,0)
FBCH CANCEL 7078^Cancel 7078 Entered in Error^^R^^FBAA LEVEL 2^^^^^^
"KRN",19,3606,1,0)
^19.06^3^3^3140513^^
"KRN",19,3606,1,1,0)
This option, restricted to the holder of the FBAA LEVEL 2 key, will cancel
"KRN",19,3606,1,2,0)
a 7078 that was entered in error.  When used, the estimated dollars
"KRN",19,3606,1,3,0)
will be freed up on the 1358.
"KRN",19,3606,25)
FBCHC78
"KRN",19,3606,"U")
CANCEL 7078 ENTERED IN ERROR
"KRN",19,3620,-1)
0^9
"KRN",19,3620,0)
FBCH PRINT CANCELLED 7078^Print List of Cancelled 7078^^P^^FBAA LEVEL 2^^^^^^
"KRN",19,3620,1,0)
^19.06^1^1^3140528^^^^
"KRN",19,3620,1,1,0)
This option will print out cancelled 7078s.
"KRN",19,3620,60)
FB7078(
"KRN",19,3620,62)
0
"KRN",19,3620,63)
[FBCH 7078 CANCEL]
"KRN",19,3620,64)
[FBCH 7078 CANCEL]
"KRN",19,3620,99)
55644,54057
"KRN",19,3620,"U")
PRINT LIST OF CANCELLED 7078
"KRN",19,3621,-1)
0^19
"KRN",19,3621,0)
FBCH REIMBURSEMENT INVOICE^Reimbursement for Inpatient Hospital Invoice^^R^^FBAA LEVEL 1 PMT^^^^^^
"KRN",19,3621,1,0)
^^5^5^2921013^
"KRN",19,3621,1,1,0)
This option is used to enter a patient reimbursement for an inpatient
"KRN",19,3621,1,2,0)
hospital stay.
"KRN",19,3621,1,3,0)
The payment will be sent through the Austin Pricer just like a direct
"KRN",19,3621,1,4,0)
vendor invoice and the patient is reimbursed the same as 
"KRN",19,3621,1,5,0)
the private facility.
"KRN",19,3621,25)
PRBT^FBCHEP
"KRN",19,3621,"U")
REIMBURSEMENT FOR INPATIENT HO
"KRN",19,3897,-1)
0^13
"KRN",19,3897,0)
FBCH DELETE INVOICE^Delete Inpatient Invoice^^R^^FBAA LEVEL 1 PMT^^^^^^
"KRN",19,3897,1,0)
^^2^2^2930113^
"KRN",19,3897,1,1,0)
This option will allow a user to delete an invoice entered in error.
"KRN",19,3897,1,2,0)
The invoice must be in a batch that has not been released for payment.
"KRN",19,3897,25)
FBCHDIN
"KRN",19,3897,"U")
DELETE INPATIENT INVOICE
"KRN",19,3903,-1)
0^18
"KRN",19,3903,0)
FBCH ANCILLARY REIMBURSEMENT^Patient Reimbursement for Ancillary Services^^R^^FBAA LEVEL 1 PMT^^^^^^
"KRN",19,3903,1,0)
^^2^2^2930202^
"KRN",19,3903,1,1,0)
This option is used to reimburse a patient for ancillary services
"KRN",19,3903,1,2,0)
paid for by the patient.  
"KRN",19,3903,25)
PRBT^FBCHCO
"KRN",19,3903,"U")
PATIENT REIMBURSEMENT FOR ANCI
"KRN",19,3927,-1)
0^90
"KRN",19,3927,0)
FBCH VOID PAYMENT^CH Void Payment^^R^^FBAA LEVEL 2^^^^^^FEE BASIS^^1
"KRN",19,3927,1,0)
^19.06^3^3^3140516^^
"KRN",19,3927,1,1,0)
Searches all finalized payments that do not contain a VOID status for
"KRN",19,3927,1,2,0)
a specific patient and vendor.  Provides user with a list of payments from
"KRN",19,3927,1,3,0)
which they may choose to void one/many/all.
"KRN",19,3927,20)
S FBTYPE=6
"KRN",19,3927,25)
FBCHVP
"KRN",19,3927,"U")
CH VOID PAYMENT
"KRN",19,3928,-1)
0^89
"KRN",19,3928,0)
FBCH DELETE VOID^CH Delete Void Payment^^R^^FBAA LEVEL 2^^^^^^FEE BASIS^^1
"KRN",19,3928,1,0)
^19.06^3^3^3140516^^
"KRN",19,3928,1,1,0)
Searches all finalized payments that contain a VOID status for a
"KRN",19,3928,1,2,0)
specified patient and vendor.  Provides user with a list of voided
"KRN",19,3928,1,3,0)
payments from which they may choose to cancel the void on one/many/all.
"KRN",19,3928,20)
S FBTYPE=6,FBVOID=1
"KRN",19,3928,25)
FBCHVP
"KRN",19,3928,"U")
CH DELETE VOID PAYMENT
"KRN",19,3929,-1)
0^92
"KRN",19,3929,0)
FBCNH VOID PAYMENT^CNH Void Payment^^R^^FBAA LEVEL 2^^^^^^FEE BASIS^^1
"KRN",19,3929,1,0)
^19.06^3^3^3140516^^
"KRN",19,3929,1,1,0)
Searches all finalized payments that do not contain a VOID status for
"KRN",19,3929,1,2,0)
a specific patient and vendor.  Provides user with a list of payments from
"KRN",19,3929,1,3,0)
which they may choose to void one/many/all.
"KRN",19,3929,20)
S FBTYPE=7
"KRN",19,3929,25)
FBCHVP
"KRN",19,3929,"U")
CNH VOID PAYMENT
"KRN",19,3930,-1)
0^91
"KRN",19,3930,0)
FBCNH DELETE VOID^CNH Delete Void Payment^^R^^FBAA LEVEL 2^^^^^^FEE BASIS^^1
"KRN",19,3930,1,0)
^19.06^3^3^3140516^^^
"KRN",19,3930,1,1,0)
Searches all finalized payments that contain a VOID status for a
"KRN",19,3930,1,2,0)
specific patient and vendor.  Provides user with a list of Voided payments
"KRN",19,3930,1,3,0)
from which they may choose to cancel the void on one/many/all.
"KRN",19,3930,20)
S FBTYPE=7,FBVOID=1
"KRN",19,3930,25)
FBCHVP
"KRN",19,3930,"U")
CNH DELETE VOID PAYMENT
"KRN",19,4022,-1)
0^33
"KRN",19,4022,0)
FBCNH CANCEL 7078^Cancel Authorization Entered in Error^^R^^FBAA LEVEL 2^^^^^^
"KRN",19,4022,1,0)
^19.06^3^3^3140513^^^
"KRN",19,4022,1,1,0)
This option should be used when an authorization has been set up and
"KRN",19,4022,1,2,0)
has been determined that it was entered in error.  Once cancelled,
"KRN",19,4022,1,3,0)
a user can re-enter the correct authorization.
"KRN",19,4022,25)
CNH^FBCHC78
"KRN",19,4022,99)
55610,33111
"KRN",19,4022,"U")
CANCEL AUTHORIZATION ENTERED I
"KRN",19,4024,-1)
0^111
"KRN",19,4024,0)
FBUC ENTER^Enter Unauthorized Claim^^R^^FBAA LEVEL 1 AUTH^^^^^^
"KRN",19,4024,1,0)
^19.06^7^7^3070404^^^^
"KRN",19,4024,1,1,0)
Enter a new unauthorized claim.  If you have indicated that you will be
"KRN",19,4024,1,2,0)
tracking incomplete claims in your Fee Basis Site Parameters file, you may 
"KRN",19,4024,1,3,0)
enter an incomplete claim.  If you have not entered anything in the 
"KRN",19,4024,1,4,0)
parameter, you can only enter complete unauthorized claims.
"KRN",19,4024,1,5,0)
  
"KRN",19,4024,1,6,0)
A claim is considered complete when a VA form 10-583 and all documentation
"KRN",19,4024,1,7,0)
has been received in order to determine legal and medical entitlement.
"KRN",19,4024,25)
FBUCEN
"KRN",19,4024,99)
55647,57709
"KRN",19,4024,"U")
ENTER UNAUTHORIZED CLAIM
"KRN",19,4025,-1)
0^112
"KRN",19,4025,0)
FBUC MODIFY UNAUTHORIZED CLAIM^Modify Unauthorized Claim^^R^^FBAA LEVEL 1 AUTH^^^^^^
"KRN",19,4025,1,0)
^19.06^2^2^3070403^^^
"KRN",19,4025,1,1,0)
Edit an unauthorized claim.  Only claims which were never dispositioned
"KRN",19,4025,1,2,0)
may be edited.
"KRN",19,4025,25)
EDT^FBUCED
"KRN",19,4025,"U")
MODIFY UNAUTHORIZED CLAIM
"KRN",19,4026,-1)
0^113
"KRN",19,4026,0)
FBUC DISPOSITION UNAUTH CLAIM^Disposition Unauthorized Claim^^R^^FBAA LEVEL 1 AUTH^^^^^^
"KRN",19,4026,1,0)
^19.06^4^4^3070403^^^^
"KRN",19,4026,1,1,0)
Disposition an unauthorized claim.  Any claim may be selected.
"KRN",19,4026,1,2,0)
If the disposition reason is changed from APPROVED to a reason other than
"KRN",19,4026,1,3,0)
APPROVED, and payments have been made, only a user who holds the
"KRN",19,4026,1,4,0)
supervisor's security key may change the disposition.
"KRN",19,4026,25)
DIS^FBUCED
"KRN",19,4026,99)
55787,64747
"KRN",19,4026,"U")
DISPOSITION UNAUTHORIZED CLAIM
"KRN",19,4027,-1)
0^114
"KRN",19,4027,0)
FBUC REOPEN^Re-open Unauthorized Claim^^R^^FBAA LEVEL 1 AUTH^^^^^^
"KRN",19,4027,1,0)
^19.06^4^4^3070403^^^^
"KRN",19,4027,1,1,0)
Reopen a claim which has been dispositioned.  This is essentially the same
"KRN",19,4027,1,2,0)
as the MODIFY UNAUTHORIZED CLAIM option, only selection is limited to claims
"KRN",19,4027,1,3,0)
with a status of DISPOSITIONED, and the date the claim was reopened is
"KRN",19,4027,1,4,0)
entered.
"KRN",19,4027,25)
REO^FBUCED
"KRN",19,4027,99)
55644,52684
"KRN",19,4027,"U")
RE-OPEN UNAUTHORIZED CLAIM
"KRN",19,4028,-1)
0^115
"KRN",19,4028,0)
FBUC INITIATE APPEAL^Initiate Appeal for Unauthorized Claim^^R^^FBAA LEVEL 1 AUTH^^^^^^
"KRN",19,4028,1,0)
^^3^3^2931008^^^^
"KRN",19,4028,1,1,0)
Initiate an appeal to Board of Veterans Appeals (BVA).
"KRN",19,4028,1,2,0)
  
"KRN",19,4028,1,3,0)
Selection of claims is limited to only those claims which have a status of DISPOSITIONED.
"KRN",19,4028,25)
APL^FBUCED
"KRN",19,4028,"U")
INITIATE APPEAL FOR UNAUTHORIZ
"KRN",19,4029,-1)
0^116
"KRN",19,4029,0)
FBUC APPEAL EDIT^Appeal Edit for Unauthorized Claim^^R^^FBAA LEVEL 2^^^^^^
"KRN",19,4029,1,0)
^19.06^5^5^3070403^^^^
"KRN",19,4029,1,1,0)
Edit a claim which has been appealed to the Board of Veterans Appeals (BVA).
"KRN",19,4029,1,2,0)
  
"KRN",19,4029,1,3,0)
Selection of claims is limited to only those claims which have a status
"KRN",19,4029,1,4,0)
of APPEAL/NOTICE OF DISAGREE RECV, APPEAL/ISSUED STATMENT OF CASE,
"KRN",19,4029,1,5,0)
APPEAL COMPLETE/PENDING REVIEW or APPEAL DISPOSITIONED.
"KRN",19,4029,25)
AED^FBUCED
"KRN",19,4029,"U")
APPEAL EDIT FOR UNAUTHORIZED C
"KRN",19,4030,-1)
0^117
"KRN",19,4030,0)
FBUC COVA APPEAL^COVA Appeal Enter/Edit^^R^^FBAA LEVEL 2^^^^^^
"KRN",19,4030,1,0)
^19.06^6^6^3070403^^^^
"KRN",19,4030,1,1,0)
This option is used to enter or edit an appeal to the Court of Veterans
"KRN",19,4030,1,2,0)
Affairs (COVA).  This is an appeal of the Board of Veterans Affairs (BVA)
"KRN",19,4030,1,3,0)
decision.
"KRN",19,4030,1,4,0)
  
"KRN",19,4030,1,5,0)
Selection of claims is limited to those claims which have a status
"KRN",19,4030,1,6,0)
of APPEAL DISPOSITIONED, COVA APPEAL or COVA DISPOSITION.
"KRN",19,4030,25)
COVA^FBUCED
"KRN",19,4030,99)
55633,36628
"KRN",19,4030,"U")
COVA APPEAL ENTER/EDIT
"KRN",19,4031,-1)
0^107
"KRN",19,4031,0)
FBUC REQUEST INFORMATION^Request Information on Unauthorized Claim^^R^^FBAA LEVEL 1 AUTH^^^^^^
"KRN",19,4031,1,0)
^^8^8^2930630^^
"KRN",19,4031,1,1,0)
Request information on an unauthorized claim.  Selection of claims
"KRN",19,4031,1,2,0)
is limited to those claims which have a status of INCOMPLETE UNAUTHORIZED
"KRN",19,4031,1,3,0)
CLAIM, PENDING - REASON UNKNOWN, COMPLETE/PENDING REVIEW,
"KRN",19,4031,1,4,0)
APPEAL/NOTICE OF DISAGREE RECV or APPEAL/ISSUED STATMENT OF CASE.
"KRN",19,4031,1,5,0)
  
"KRN",19,4031,1,6,0)
A letter will print or be flagged for printing (depending upon your
"KRN",19,4031,1,7,0)
parameter set-up) if the request causes the status to change, or 
"KRN",19,4031,1,8,0)
requests additional information.
"KRN",19,4031,25)
REQ^FBUCED
"KRN",19,4031,"U")
REQUEST INFORMATION ON UNAUTHO
"KRN",19,4032,-1)
0^108
"KRN",19,4032,0)
FBUC RECEIVE INFORMATION^Receive Requested Information^^R^^FBAA LEVEL 1 AUTH^^^^^^
"KRN",19,4032,1,0)
^^4^4^2930923^^
"KRN",19,4032,1,1,0)
Receive information which was requested for a claim.  Selection of claims
"KRN",19,4032,1,2,0)
is limited to those claims which have a status of INCOMPLETE
"KRN",19,4032,1,3,0)
UNAUTHORIZED CLAIM, APPEAL/NOTICE OF DISAGREE RECV or
"KRN",19,4032,1,4,0)
APPEAL/ISSUED STATMENT OF CASE.
"KRN",19,4032,25)
REC^FBUCED
"KRN",19,4032,"U")
RECEIVE REQUESTED INFORMATION
"KRN",19,4033,-1)
0^88
"KRN",19,4033,0)
FBUC REQUEST INFO FILE^Request Info File Enter/Edit^^R^^FBAASUPERVISOR^^^^^^
"KRN",19,4033,1,0)
^^2^2^2930409^
"KRN",19,4033,1,1,0)
Enter/edit data in the Fee Basis Unauthorized Requested Information file
"KRN",19,4033,1,2,0)
(# 162.93).
"KRN",19,4033,25)
REQENT^FBUCED
"KRN",19,4033,"U")
REQUEST INFO FILE ENTER/EDIT
"KRN",19,4034,-1)
0^118
"KRN",19,4034,0)
FBUC UPDATE DATE LETTER SENT^Update Date Letter Sent^^R^^FBAA LEVEL 1 AUTH^^^^^^
"KRN",19,4034,1,0)
^^3^3^2930409^
"KRN",19,4034,1,1,0)
This option should be used if you are not generating your letters.
"KRN",19,4034,1,2,0)
It will update the date the letter was sent.  If applicable, the
"KRN",19,4034,1,3,0)
expiration date will also be updated.
"KRN",19,4034,25)
LET^FBUCED
"KRN",19,4034,"U")
UPDATE DATE LETTER SENT
"KRN",19,4035,-1)
0^119
"KRN",19,4035,0)
FBUC BATCH PRINT LETTERS^Batch Print Letters^^R^^FBAA LEVEL 1 AUTH^^^^^^
"KRN",19,4035,1,0)
^^7^7^2930409^
"KRN",19,4035,1,1,0)
This option will batch print letters which have been flagged for printing,
"KRN",19,4035,1,2,0)
but for some reason could not be printed.  A site parameter exists
"KRN",19,4035,1,3,0)
for an output device for your letters.  If you have not filled this, or
"KRN",19,4035,1,4,0)
if this parameter contains an invalid device, and you have indicated
"KRN",19,4035,1,5,0)
that your letters will be either automatically or batch printed, you
"KRN",19,4035,1,6,0)
can print your pending letters using this option.
"KRN",19,4035,1,7,0)
 
"KRN",19,4035,25)
BATCH^FBUCLET
"KRN",19,4035,99)
55616,66143
"KRN",19,4035,"U")
BATCH PRINT LETTERS
"KRN",19,4039,-1)
0^109
"KRN",19,4039,0)
FBUC LETTERS^Letters for Unauthorized Claim^^M^^FBAA LEVEL 1 AUTH^^^^^^
"KRN",19,4039,1,0)
^^1^1^2930617^^
"KRN",19,4039,1,1,0)
Menu option for printing or updating letters.
"KRN",19,4039,10,0)
^19.01IP^3^3
"KRN",19,4039,10,1,0)
4034^^1
"KRN",19,4039,10,1,"^")
FBUC UPDATE DATE LETTER SENT
"KRN",19,4039,10,2,0)
4035^^2
"KRN",19,4039,10,2,"^")
FBUC BATCH PRINT LETTERS
"KRN",19,4039,10,3,0)
4100^
"KRN",19,4039,10,3,"^")
FBUC REPRINT LETTER(S)
"KRN",19,4039,99)
63602,40666
"KRN",19,4039,"U")
LETTERS FOR UNAUTHORIZED CLAIM
"KRN",19,4040,-1)
2^135
"KRN",19,4040,0)
FBUC OUTPUTS^Outputs for Unauthorized Claims^^M^.5^^^^^^^
"KRN",19,4040,10,0)
^19.01IP^13^13
"KRN",19,4040,10,13,0)
13955
"KRN",19,4040,10,13,"^")
FBUC CLERK LOOKUP
"KRN",19,4040,"U")
OUTPUTS FOR UNAUTHORIZED CLAIM
"KRN",19,4049,-1)
0^36
"KRN",19,4049,0)
FBCNH ENTER VETERAN RATES^Enter Veteran Rates under new Vendor Contract^^R^^FBAA LEVEL 1 AUTH^^^^^^FEE BASIS
"KRN",19,4049,1,0)
^^3^3^2930730^^
"KRN",19,4049,1,1,0)
Allows user to choose a vendor who may have a new contract.  It will prompt
"KRN",19,4049,1,2,0)
them for all patients who require rate choices as a result of the new
"KRN",19,4049,1,3,0)
contract.
"KRN",19,4049,25)
FBNHRAT
"KRN",19,4049,"U")
ENTER VETERAN RATES UNDER NEW 
"KRN",19,4050,-1)
0^54
"KRN",19,4050,0)
FBAA TERMINATE ID CARD^Terminate ID Card^^R^^FBAA LEVEL 1 AUTH^^^^^^
"KRN",19,4050,1,0)
^19.06^1^1^3080808^^^^
"KRN",19,4050,1,1,0)
This option is used to terminate the Fee ID card number.
"KRN",19,4050,25)
FBAATIC
"KRN",19,4050,"U")
TERMINATE ID CARD
"KRN",19,4070,-1)
0^110
"KRN",19,4070,0)
FBUC PAYMENTS^Payments for Unauthorized Claims^^R^^FBAA LEVEL 1 PMT^^^^^^
"KRN",19,4070,1,0)
^19.06^2^2^3081002^^^^
"KRN",19,4070,1,1,0)
This option should be used to enter payments for an unauthorized claim
"KRN",19,4070,1,2,0)
which has been dispositioned to approved or approved to stabilization.
"KRN",19,4070,25)
FBUCPAY
"KRN",19,4070,99)
55640,35436
"KRN",19,4070,"U")
PAYMENTS FOR UNAUTHORIZED CLAI
"KRN",19,4072,-1)
0^34
"KRN",19,4072,0)
FBCNH RATE CHANGE^Change Existing Contract Rate for a Patient^^R^^FBAA LEVEL 1 AUTH^^^^^^
"KRN",19,4072,1,0)
^19.06^6^6^3091110^^^^
"KRN",19,4072,1,1,0)
Selection of a patient and an authorization will allow the user to
"KRN",19,4072,1,2,0)
see all rates associated with that authorization.  If they wish to change
"KRN",19,4072,1,3,0)
the rate for this patient, they are prompted to enter an effective date
"KRN",19,4072,1,4,0)
of the change and to choose a new rate.  If the rates are the same, the
"KRN",19,4072,1,5,0)
change will not take effect.  The user will see the new rates for this
"KRN",19,4072,1,6,0)
authorization upon completion of the change.
"KRN",19,4072,25)
FBNHRC
"KRN",19,4072,99)
55797,36376
"KRN",19,4072,"U")
CHANGE EXISTING CONTRACT RATE 
"KRN",19,4073,-1)
0^85
"KRN",19,4073,0)
FBUC ADD NEW PERSON^Add New Person for Unauthorized Claim^^R^^FBAA LEVEL 1 AUTH^^^^^^
"KRN",19,4073,1,0)
^^6^6^2930628^^
"KRN",19,4073,1,1,0)
This option allows entry to the New Person file.
"KRN",19,4073,1,2,0)
  
"KRN",19,4073,1,3,0)
If an Unauthorized Claim is submitted by an other party (ie not veteran or
"KRN",19,4073,1,4,0)
not vendor), name and address of submitter needs to be entered into the
"KRN",19,4073,1,5,0)
New Person file if it does not already exist.  This will allow correspondence
"KRN",19,4073,1,6,0)
 and/or payments to efficiently reach the appropriate party.
"KRN",19,4073,25)
ADD^FBUCUTL3
"KRN",19,4073,99)
55634,39955
"KRN",19,4073,"U")
ADD NEW PERSON FOR UNAUTHORIZE
"KRN",19,4084,-1)
0^121
"KRN",19,4084,0)
FBUC ASSOCIATE^Associate an Unauthorized Claim to a Primary^^R^^FBAA LEVEL 1 AUTH^^^^^^
"KRN",19,4084,1,0)
^^3^3^2930514^
"KRN",19,4084,1,1,0)
This option should be used when you wish to associate unauthorized claims
"KRN",19,4084,1,2,0)
to a primary claim.  The primary claim is the first claim which was entered
"KRN",19,4084,1,3,0)
for a veteran and episode of care (same treatment from and to dates).
"KRN",19,4084,25)
EDIT^FBUCLINK
"KRN",19,4084,"U")
ASSOCIATE AN UNAUTHORIZED CLAI
"KRN",19,4099,-1)
0^35
"KRN",19,4099,0)
FBCNH DELETE RATE^Delete CNH Rate^^R^^FBAA LEVEL 2^^^^^^
"KRN",19,4099,1,0)
^^7^7^2930614^
"KRN",19,4099,1,1,0)
This option allows the deletion of a CNH Rate, only if the rate has not
"KRN",19,4099,1,2,0)
been used by a patient yet (i.e. found in the Fee Basis CNH Authorization
"KRN",19,4099,1,3,0)
Rate File 161.23).  The option prompts for the contract number, and will
"KRN",19,4099,1,4,0)
display all valid rates for that contract.  The user may choose from the
"KRN",19,4099,1,5,0)
rates displayed.  If successful, the rate will be deleted from the file.
"KRN",19,4099,1,6,0)
If the rate is found to be in use, a message will display to the user,
"KRN",19,4099,1,7,0)
indicating that the rate may not be deleted.
"KRN",19,4099,25)
FBNHRDEL
"KRN",19,4099,"U")
DELETE CNH RATE
"KRN",19,4100,-1)
0^120
"KRN",19,4100,0)
FBUC REPRINT LETTER(S)^Reprint Letter(s)^^R^^FBAA LEVEL 1 AUTH^^^^^^
"KRN",19,4100,1,0)
^^9^9^2930628^^
"KRN",19,4100,1,1,0)
This option allows you to reprint letters which were already printed,
"KRN",19,4100,1,2,0)
provided that the current status of the unauthorized claim involves a 
"KRN",19,4100,1,3,0)
letter.
"KRN",19,4100,1,4,0)
  
"KRN",19,4100,1,5,0)
You have the option to reprint for a date range (probably useful in the
"KRN",19,4100,1,6,0)
event of a printer jam or malfunction when the original letters were
"KRN",19,4100,1,7,0)
printed) or selective claims.  You also have the option to update the 
"KRN",19,4100,1,8,0)
expiration date.  (You would want to update the expiration date if the 
"KRN",19,4100,1,9,0)
original letters were never mailed, in the case of hardware problems.)
"KRN",19,4100,25)
REPRINT^FBUCLET
"KRN",19,4100,99)
55686,68126
"KRN",19,4100,"U")
REPRINT LETTER(S)
"KRN",19,4118,-1)
0^28
"KRN",19,4118,0)
FBAA BATCH DELETE^Batch Delete^^R^^FBAA LEVEL 1 PMT^^^^^^
"KRN",19,4118,1,0)
^19.06^8^8^3140714^^^
"KRN",19,4118,1,1,0)
This option allows the user who opened a batch, or any user who holds
"KRN",19,4118,1,2,0)
the 'FBAA LEVEL 2' security key, the ability to delete a batch from
"KRN",19,4118,1,3,0)
the system.  The batch must meet the following criteria in order
"KRN",19,4118,1,4,0)
to be deleted.
"KRN",19,4118,1,5,0)
    1. Total Dollars equal zero
"KRN",19,4118,1,6,0)
    2. Invoice Count equal zero
"KRN",19,4118,1,7,0)
    3. Payment Line Count equal zero
"KRN",19,4118,1,8,0)
    4. Rejects Pending flag not set to yes
"KRN",19,4118,25)
FBAABDL
"KRN",19,4118,"U")
BATCH DELETE
"KRN",19,4123,-1)
0^77
"KRN",19,4123,0)
FBAA FMS UPDATE^Update FMS Vendor File in Austin^^R^^FBAA LEVEL 2^^^^^^
"KRN",19,4123,1,0)
^19.06^13^13^3071001^^^^
"KRN",19,4123,1,1,0)
This option creates a Master Record Adjustment (MRA) transaction which
"KRN",19,4123,1,2,0)
results in the updating of selected vendor demographic data in the FMS
"KRN",19,4123,1,3,0)
vendor file in Austin.
"KRN",19,4123,1,4,0)
  
"KRN",19,4123,1,5,0)
This option should only be used if a vendor entry is correctly entered into
"KRN",19,4123,1,6,0)
the DHCP Fee Basis Vendor file but needs to update the FMS vendor file
"KRN",19,4123,1,7,0)
with the appropriate information.
"KRN",19,4123,1,8,0)
 (NOTE:  The vendor may not exist on the FMS system or may exist, but
"KRN",19,4123,1,9,0)
         the information does not reflect accurate information.)
"KRN",19,4123,1,10,0)
  
"KRN",19,4123,1,11,0)
Use of this option should update the FMS vendor file to reflect what is
"KRN",19,4123,1,12,0)
currently in the DHCP system.  Information at all other VA Medical Centers
"KRN",19,4123,1,13,0)
using this vendor will also be updated.
"KRN",19,4123,25)
UPDATE^FBAAAV
"KRN",19,4123,99)
55743,65034
"KRN",19,4123,"U")
UPDATE FMS VENDOR FILE IN AUST
"KRN",19,4125,-1)
0^30
"KRN",19,4125,0)
FBCNH UPDATE VENDOR CONTRACT^Update Vendor Contract/Rates - CNH^^R^^FBAA LEVEL 2^^^^^^^^^1
"KRN",19,4125,1,0)
^19.06^2^2^3090102^^^
"KRN",19,4125,1,1,0)
This option allows the user to enter/edit Community Nursing Home
"KRN",19,4125,1,2,0)
vendor contracts and rates.
"KRN",19,4125,15)
K FBCIEN,FBCNUM,FBEXDT,FBEXNDT,FBX
"KRN",19,4125,25)
GETVEN^FBAAVD2
"KRN",19,4125,99)
55797,39877
"KRN",19,4125,"U")
UPDATE VENDOR CONTRACT/RATES -
"KRN",19,4172,-1)
0^122
"KRN",19,4172,0)
FBUC DISASSOCIATE^Disassociate an Unauthorized Claim^^R^^FBAA LEVEL 1 AUTH^^^^^^
"KRN",19,4172,1,0)
^^2^2^2930911^
"KRN",19,4172,1,1,0)
This option will allow you to disassociate an unauthorized claim which
"KRN",19,4172,1,2,0)
has been associated to others.
"KRN",19,4172,25)
DISASSOC^FBUCLINK
"KRN",19,4172,"U")
DISASSOCIATE AN UNAUTHORIZED C
"KRN",19,4173,-1)
0^123
"KRN",19,4173,0)
FBUC RETURN ADDRESS DIS/ED^Return Address Display/Edit^^R^^FBAA LEVEL 2^^^^^y^
"KRN",19,4173,1,0)
^^3^3^2930911^
"KRN",19,4173,1,1,0)
This option will display the return address which will appear on an
"KRN",19,4173,1,2,0)
Unauthorized Claim letter, if letterhead is not used.  You can also edit
"KRN",19,4173,1,3,0)
the return address using this option.
"KRN",19,4173,25)
RETURN^FBUCDIS
"KRN",19,4173,"U")
RETURN ADDRESS DISPLAY/EDIT
"KRN",19,4177,-1)
0^80
"KRN",19,4177,0)
FBAA MRA'S AWAITING APPROVAL^MRA'S Awaiting Austin Approval^^R^^FBAA LEVEL 2^^^^^^
"KRN",19,4177,1,0)
5^19.06^5^5^3080718^
"KRN",19,4177,1,1,0)
This option will output the vendors that have an MRA action pending, and
"KRN",19,4177,1,2,0)
therefore are still awaiting Austin approval.  The output lists the
"KRN",19,4177,1,3,0)
vendor and the date the MRA was transmitted to Austin.  Records with
"KRN",19,4177,1,4,0)
no date transmitted indicate an MRA has just been initiated, but the
"KRN",19,4177,1,5,0)
transmission has not left the local station yet.
"KRN",19,4177,25)
FBAAPV
"KRN",19,4177,"U")
MRA'S AWAITING AUSTIN APPROVAL
"KRN",19,4997,-1)
0^17
"KRN",19,4997,0)
FBCH MULTIPLE PAYMENTS^Multiple Ancillary Payments^^R^^FBAA LEVEL 1 PMT^^^^^^
"KRN",19,4997,1,0)
^^3^3^2940919^^
"KRN",19,4997,1,1,0)
This option is used to enter identical ancillary services incurred while
"KRN",19,4997,1,2,0)
in a Non-VA Hospital for a specific patient and vendor.  Only the date of
"KRN",19,4997,1,3,0)
service may differ.
"KRN",19,4997,25)
ANCIL^FBAAMP
"KRN",19,4997,"U")
MULTIPLE ANCILLARY PAYMENTS
"KRN",19,7423,-1)
0^103
"KRN",19,7423,0)
FBSH ENTER AUTH^Enter New State Home Authorization^^R^^FBAA LEVEL 1 AUTH^^^^^^FEE BASIS
"KRN",19,7423,1,0)
^^1^1^2980817^
"KRN",19,7423,1,1,0)
Enter a new State Home FEE program authorization for a patient.
"KRN",19,7423,25)
ADD^FBSHAUT
"KRN",19,7423,"U")
ENTER NEW STATE HOME AUTHORIZA
"KRN",19,7424,-1)
0^104
"KRN",19,7424,0)
FBSH CHANGE AUTH^Change a State Home Authorization^^R^^FBAA LEVEL 1 AUTH^^^^^^FEE BASIS
"KRN",19,7424,1,0)
^^1^1^2980818^^
"KRN",19,7424,1,1,0)
Change an existing State Home authorization for a patient.
"KRN",19,7424,25)
CHANGE^FBSHAUT
"KRN",19,7424,"U")
CHANGE A STATE HOME AUTHORIZAT
"KRN",19,7425,-1)
0^105
"KRN",19,7425,0)
FBSH DELETE AUTH^Delete a State Home Authorization^^R^^FBAA LEVEL 1 AUTH^^^^^^FEE BASIS
"KRN",19,7425,1,0)
^^1^1^2980818^
"KRN",19,7425,1,1,0)
Delete an existing State Home authorization that was entered in error.
"KRN",19,7425,25)
DELETE^FBSHAUT
"KRN",19,7425,"U")
DELETE A STATE HOME AUTHORIZAT
"KRN",19,7426,-1)
0^106
"KRN",19,7426,0)
FBSH REINSTATE AUTH^Reinstate State Home Authorization^^R^^FBAA LEVEL 1 AUTH^^^^^^FEE BASIS
"KRN",19,7426,1,0)
^^1^1^2980818^^^^
"KRN",19,7426,1,1,0)
Reinstate a previously deleted State Home authorization for a patient.
"KRN",19,7426,25)
REINSTA^FBSHAUT
"KRN",19,7426,"U")
REINSTATE STATE HOME AUTHORIZA
"KRN",19,10806,-1)
0^86
"KRN",19,10806,0)
FBUC DISAPPROVAL REASONS FILE^Disapproval Reasons File Enter/Edit^^R^^FBAASUPERVISOR^^^^^^FEE BASIS
"KRN",19,10806,1,0)
^^2^2^3010702^
"KRN",19,10806,1,1,0)
Enter/edit data in the Fee Basis Unauthorized Disapproval Reasons file (#
"KRN",19,10806,1,2,0)
162.94).
"KRN",19,10806,25)
DISENT^FBUCED
"KRN",19,10806,"U")
DISAPPROVAL REASONS FILE ENTER
"KRN",19,10811,-1)
0^87
"KRN",19,10811,0)
FBUC DISPOSITIONS FILE^Dispositions File Edit^^R^^FBAASUPERVISOR^^^^^^FEE BASIS
"KRN",19,10811,1,0)
^^2^2^3010702^
"KRN",19,10811,1,1,0)
Edit data in the Fee Basis Unauthorized Claims Dispositions file
"KRN",19,10811,1,2,0)
(#162.91).
"KRN",19,10811,25)
DSPENT^FBUCED
"KRN",19,10811,"U")
DISPOSITIONS FILE EDIT
"KRN",19,11758,-1)
0^71
"KRN",19,11758,0)
FBAA FPPS EDIT INVOICE^Outpatient/Ancillary Invoice Edit^^R^^FBAA LEVEL 2^^^^^^FEE BASIS
"KRN",19,11758,1,0)
^19.06^3^3^3140515^^^
"KRN",19,11758,1,1,0)
This option is used to edit an outpatient or ancillary invoice that has
"KRN",19,11758,1,2,0)
previously been transmitted to FPPS.  If changes are made, the invoice
"KRN",19,11758,1,3,0)
will be queued to be resent to FPPS.
"KRN",19,11758,25)
FBAAFED
"KRN",19,11758,"U")
OUTPATIENT/ANCILLARY INVOICE E
"KRN",19,11759,-1)
0^73
"KRN",19,11759,0)
FBCH FPPS EDIT INVOICE^Inpatient Invoice Edit^^R^^FBAA LEVEL 2^^^^^^FEE BASIS
"KRN",19,11759,1,0)
^19.06^3^3^3140515^^
"KRN",19,11759,1,1,0)
This option is used to edit an inpatient (civil hospital or community 
"KRN",19,11759,1,2,0)
nursing home) invoice that has previously been transmitted to FPPS.  If
"KRN",19,11759,1,3,0)
changes are made, the invoice will be queued to be resent to FPPS.
"KRN",19,11759,25)
FBCHFED
"KRN",19,11759,"U")
INPATIENT INVOICE EDIT
"KRN",19,11760,-1)
0^72
"KRN",19,11760,0)
FBRX FPPS EDIT INVOICE^Pharmacy Invoice Edit^^R^^FBAA LEVEL 2^^^^^^FEE BASIS
"KRN",19,11760,1,0)
^19.06^3^3^3140516^^^
"KRN",19,11760,1,1,0)
This option is used to edit a pharmacy invoice that has previously been
"KRN",19,11760,1,2,0)
transmitted to FPPS.  If changes are made, the invoice will be queued to
"KRN",19,11760,1,3,0)
be resent to FPPS.
"KRN",19,11760,25)
FBRXFED
"KRN",19,11760,"U")
PHARMACY INVOICE EDIT
"KRN",19,11827,-1)
0^74
"KRN",19,11827,0)
FB FPPS PURGE^Purge Message Text^^R^^FBAA LEVEL 2^^^^^^FEE BASIS
"KRN",19,11827,1,0)
^19.06^7^7^3030909^^
"KRN",19,11827,1,1,0)
When an invoice is transmitted to FPPS via the HL7 package, a copy of the 
"KRN",19,11827,1,2,0)
HL7 message text is saved in the FPPS QUEUED INVOICES (#163.5) file.
"KRN",19,11827,1,3,0)
 
"KRN",19,11827,1,4,0)
This option purges the message text for invoices transmitted prior to a
"KRN",19,11827,1,5,0)
specified date.  Messages that have not been accepted by the VistA 
"KRN",19,11827,1,6,0)
Interface Engine will not be purged unless there is a later message for
"KRN",19,11827,1,7,0)
the same invoice number that has been accepted.
"KRN",19,11827,25)
FBFHLP
"KRN",19,11827,"U")
PURGE MESSAGE TEXT
"KRN",19,13627,-1)
0^67
"KRN",19,13627,0)
FB SEG DUTY RPT^Fee Basis 1358 Segregation of Duty Report^^R^^FBAASUPERVISOR^^^^^^FEE BASIS
"KRN",19,13627,1,0)
^^36^36^3110411^
"KRN",19,13627,1,1,0)
This report reviews fee invoice certification events and determines if 
"KRN",19,13627,1,2,0)
there was a segregation of duty violation.  The certifier of a fee invoice
"KRN",19,13627,1,3,0)
must not be the requestor, approving official, or obligator of the
"KRN",19,13627,1,4,0)
associated 1358 obligation or any increase/decrease adjustments to the
"KRN",19,13627,1,5,0)
1358 that were obligated before the invoice certification took place.
"KRN",19,13627,1,6,0)
 
"KRN",19,13627,1,7,0)
The release of a payment batch by a fee supervisor is the certification 
"KRN",19,13627,1,8,0)
event.  The report examines all payment batches that were released during 
"KRN",19,13627,1,9,0)
a specified period.  Each batch is associated with a single 1358. 
"KRN",19,13627,1,10,0)
 
"KRN",19,13627,1,11,0)
The results are sorted by 1358 and within that by the date and time of an 
"KRN",19,13627,1,12,0)
event.  Three event types may be listed.
"KRN",19,13627,1,13,0)
  Obligate - Initial obligation of the 1358 in IFCAP.
"KRN",19,13627,1,14,0)
  Adjust   - Obligation of an increase/decrease to the 1358 in IFCAP.
"KRN",19,13627,1,15,0)
  Certify  - Release of a fee payment batch associated with the 1358 
"KRN",19,13627,1,16,0)
             by a fee supervisor.  The batch number is shown.
"KRN",19,13627,1,17,0)
 
"KRN",19,13627,1,18,0)
The IFCAP events have three roles (requestor, approver, and obligator).
"KRN",19,13627,1,19,0)
 
"KRN",19,13627,1,20,0)
The specified reporting period is used to select released fee batches.  
"KRN",19,13627,1,21,0)
All prior IFCAP events for the 1358 are relevant to segregation to duty
"KRN",19,13627,1,22,0)
and will be considered even if they precede the reporting period.
"KRN",19,13627,1,23,0)
 
"KRN",19,13627,1,24,0)
If YES is entered at the "Only list 1358s with a violation (Y/N)?" prompt,
"KRN",19,13627,1,25,0)
only 1358s with at least one violation will be displayed.  Additionally,
"KRN",19,13627,1,26,0)
the fee certifications (batch release) that do not violate segregation of
"KRN",19,13627,1,27,0)
duties will not be displayed.  IFCAP and Fee Basis have been enhanced 
"KRN",19,13627,1,28,0)
by patches PRC*5.1*148 and FB*3.5*117 to enforce segregation of duties for
"KRN",19,13627,1,29,0)
a 1358 so no violations are expected after installation of those patches.
"KRN",19,13627,1,30,0)
 
"KRN",19,13627,1,31,0)
The Fee Basis batch data can optionally be purged by a site.  The IFCAP 
"KRN",19,13627,1,32,0)
data is normally retained for at least 7 years, but must be purged prior 
"KRN",19,13627,1,33,0)
to 10 years since the document numbers are recycled. If the source data
"KRN",19,13627,1,34,0)
for this report has been purged, it will not be included in the report.  
"KRN",19,13627,1,35,0)
Selection of a period starting 9 or more years ago may return inaccurate 
"KRN",19,13627,1,36,0)
results due to recycling of 1358 document numbers.
"KRN",19,13627,25)
FBAASDR
"KRN",19,13627,"U")
FEE BASIS 1358 SEGREGATION OF 
"KRN",19,13954,-1)
0^130
"KRN",19,13954,0)
FB SEC KEY RPT^Security Key Report for Fee Basis^^R^^FBAASUPERVISOR^^^^^^FEE BASIS
"KRN",19,13954,1,0)
^^1^1^3140220^
"KRN",19,13954,1,1,0)
This option generates a report of users that hold Fee Basis security keys.
"KRN",19,13954,25)
FBAASKR
"KRN",19,13954,"U")
SECURITY KEY REPORT FOR FEE BA
"KRN",19,13955,-1)
0^133
"KRN",19,13955,0)
FBUC CLERK LOOKUP^Clerk Lookup for Unauthorized Claim^^R^^FBAASUPERVISOR^^^^^^FEE BASIS^^1^1
"KRN",19,13955,1,0)
^19.06^2^2^3140220^^
"KRN",19,13955,1,1,0)
This option will list users that entered or edited a specified
"KRN",19,13955,1,2,0)
unauthorized claim.
"KRN",19,13955,15)
K FBFILE
"KRN",19,13955,20)
S FBFILE="162.7"
"KRN",19,13955,25)
FBAACLU
"KRN",19,13955,"U")
CLERK LOOKUP FOR UNAUTHORIZED 
"KRN",19,13956,-1)
0^131
"KRN",19,13956,0)
FBCH CLERK LOOKUP^Clerk Lookup for 7078 Authorization^^R^^FBAASUPERVISOR^^^^^^FEE BASIS^^1^1
"KRN",19,13956,1,0)
^^5^5^3141125^
"KRN",19,13956,1,1,0)
This option will list users that entered or edited a specified 7078 
"KRN",19,13956,1,2,0)
authorization.  Entry or edit of nursing home rate and movements are 
"KRN",19,13956,1,3,0)
included in this output. When applicable the output will also show users
"KRN",19,13956,1,4,0)
that entered or edited the civil hospital notification associated with the
"KRN",19,13956,1,5,0)
authorization.
"KRN",19,13956,15)
K FBFILE
"KRN",19,13956,20)
S FBFILE="162.4"
"KRN",19,13956,25)
FBAACLU
"KRN",19,13956,"U")
CLERK LOOKUP FOR 7078 AUTHORIZ
"KRN",19,13957,-1)
0^132
"KRN",19,13957,0)
FBCH REQUEST CLERK LOOKUP^Clerk Lookup for Notification/Request^^R^^FBAASUPERVISOR^^^^^^FEE BASIS^^1^1
"KRN",19,13957,1,0)
^^2^2^3140220^
"KRN",19,13957,1,1,0)
This option will list users that entered or edited a specified 
"KRN",19,13957,1,2,0)
notification/request.
"KRN",19,13957,15)
K FBFILE
"KRN",19,13957,20)
S FBFILE="162.2"
"KRN",19,13957,25)
FBAACLU
"KRN",19,13957,"U")
CLERK LOOKUP FOR NOTIFICATION/
"KRN",19.1,21,-1)
0^1
"KRN",19.1,21,0)
FBAASUPERVISOR^^
"KRN",19.1,21,1,0)
^19.11^4^4^3140512^^^^
"KRN",19.1,21,1,1,0)
Permits the holder to edit site parameters, maintain the VA fee schedule,
"KRN",19.1,21,1,2,0)
edit the contract file, reprocess an overdue batch, resend a completed
"KRN",19.1,21,1,3,0)
batch, re-transmit MRAs, and purge MRAs.  This key is normally assigned
"KRN",19.1,21,1,4,0)
to a supervisor.
"KRN",19.1,666,-1)
0^2
"KRN",19.1,666,0)
FBAA LEVEL 1 AUTH
"KRN",19.1,666,1,0)
^^3^3^3140220^
"KRN",19.1,666,1,1,0)
Permits the holder to enter and edit 7079 authorizations, 7078 
"KRN",19.1,666,1,2,0)
authorizations, civil hospital notifications, nursing home movements, and 
"KRN",19.1,666,1,3,0)
unauthorized claims.
"KRN",19.1,667,-1)
0^3
"KRN",19.1,667,0)
FBAA LEVEL 1 PMT
"KRN",19.1,667,1,0)
^^1^1^3140220^
"KRN",19.1,667,1,1,0)
Permits the holder to enter and edit invoices and payments.
"KRN",19.1,668,-1)
0^4
"KRN",19.1,668,0)
FBAA LEVEL 2
"KRN",19.1,668,1,0)
^^5^5^3140220^
"KRN",19.1,668,1,1,0)
Permits the holder to certify a batch for payment, queue data for 
"KRN",19.1,668,1,2,0)
transmission to Central FEE, void payments, and update contract and rate 
"KRN",19.1,668,1,3,0)
data for nursing home vendors. The holder of this key can also bypass some
"KRN",19.1,668,1,4,0)
user and status restrictions during selection of a payment or batch. This
"KRN",19.1,668,1,5,0)
key is normally assigned to a lead clerk or supervisor.
"MBREQ")
0
"ORD",0,9.8)
9.8;;1;RTNF^XPDTA;RTNE^XPDTA
"ORD",0,9.8,0)
ROUTINE
"ORD",3,19.1)
19.1;3;;;KEY^XPDTA1;KEYF1^XPDIA1;KEYE1^XPDIA1;KEYF2^XPDIA1;;KEYDEL^XPDIA1
"ORD",3,19.1,0)
SECURITY KEY
"ORD",7,.402)
.402;7;;;EDEOUT^DIFROMSO(.402,DA,"",XPDA);FPRE^DIFROMSI(.402,"",XPDA);EPRE^DIFROMSI(.402,DA,$E("N",$G(XPDNEW)),XPDA,"",OLDA);;EPOST^DIFROMSI(.402,DA,"",XPDA);DEL^DIFROMSK(.402,"",%)
"ORD",7,.402,0)
INPUT TEMPLATE
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"PKG",60,-1)
1^1
"PKG",60,0)
FEE BASIS^FB^Used to pay private vendors
"PKG",60,20,0)
^9.402P^^0
"PKG",60,22,0)
^9.49I^1^1
"PKG",60,22,1,0)
3.5^2950130^2950313
"PKG",60,22,1,"PAH",1,0)
154^3150520^12222
"PKG",60,22,1,"PAH",1,1,0)
^^14^14^3150520
"PKG",60,22,1,"PAH",1,1,1,0)
This patch will enhance the Fee Basis package per the requirements of the
"PKG",60,22,1,"PAH",1,1,2,0)
VistA Fee Separation of Duties project.  The patch will make the 
"PKG",60,22,1,"PAH",1,1,3,0)
following changes to Fee Basis:
"PKG",60,22,1,"PAH",1,1,4,0)
 o Add new security keys.
"PKG",60,22,1,"PAH",1,1,5,0)
 o Revise locks on menu options to enhance separation of duty controls.
"PKG",60,22,1,"PAH",1,1,6,0)
 o Attach menu options to additional menus.
"PKG",60,22,1,"PAH",1,1,7,0)
 o Revise locks on functionality within menu options.
"PKG",60,22,1,"PAH",1,1,8,0)
 o Add the Security Key Report for Fee Basis
"PKG",60,22,1,"PAH",1,1,9,0)
 o Prevent entry of payment or pricing if user entered the authorization.
"PKG",60,22,1,"PAH",1,1,10,0)
 o Add reports to display users that entered or edited authorizations.
"PKG",60,22,1,"PAH",1,1,11,0)
 o Correct an existing issue with the identification of the associated
"PKG",60,22,1,"PAH",1,1,12,0)
   authorization for outpatient and ancillary payments.
"PKG",60,22,1,"PAH",1,1,13,0)
 o Prevent an undefined error when a prescription is deleted.
"PKG",60,22,1,"PAH",1,1,14,0)
 o Prevent an undefined error when rejected payments are re-initiated.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
75
"RTN","FBAAAUT")
0^34^B15987856^B14647205
"RTN","FBAAAUT",1,0)
FBAAAUT ;AISC/DMK - ENTER/EDIT AUTHORIZATION ;2/5/2015
"RTN","FBAAAUT",2,0)
 ;;3.5;FEE BASIS;**13,95,103,111,154**;JAN 30, 1995;Build 12
"RTN","FBAAAUT",3,0)
 ;;Per VA Directive 6402, this routine should not be modified.
"RTN","FBAAAUT",4,0)
 D SITEP^FBAAUTL G Q:FBPOP S FBAADDYS=+$P(FBSITE(0),"^",13),FBAAASKV=$P(FBSITE(1),"^",1),FBPROG=$S($P(FBSITE(1),"^",6)="":"I 1",1:"I $P(^(0),U,3)=2")
"RTN","FBAAAUT",5,0)
 W ! S DIC="^DPT(",DIC(0)="QEAZM" D ^DIC G Q:Y<0 S DFN=+Y
"RTN","FBAAAUT",6,0)
 I $P($G(^DPT(DFN,.361)),"^")="" W !!,"ELIGIBILITY HAS NOT BEEN DETERMINED NOR PENDING, CANNOT ENTER AN AUTHORIZATION." G FBAAAUT
"RTN","FBAAAUT",7,0)
CONT I $P($G(^DPT(DFN,.32)),"^",4)=2&($P($G(^DPT(DFN,.15)),"^",2)'="") W !!?4,"VETERAN HAS A DISHONORABLE DISCHARGE, " S X=$P($G(^(.321)),"^") W $S(X="Y":"ONLY ELIGIBLE FOR AGENT ORANGE EXAM.",1:"NOT ELIGIBLE FOR BENEFITS.")
"RTN","FBAAAUT",8,0)
 W ! S DIR("A")="Do you want to continue",DIR(0)="Y",DIR("B")="Yes" D ^DIR K DIR G FBAAAUT:$S($D(DIRUT):1,'Y:1,1:0)
"RTN","FBAAAUT",9,0)
1 S DA=DFN I '$D(^FBAAA(DA,0)) N FBLQ D  G:+$G(FBLQ)!(Y<0) Q
"RTN","FBAAAUT",10,0)
 .L +^FBAAA(DFN):$G(DILOCKTM,3) I '$T D  S FBLQ=1 Q
"RTN","FBAAAUT",11,0)
 ..W !,"This record is being edited by another user.  Try again later.",!
"RTN","FBAAAUT",12,0)
 .K DD,DO S (X,DINUM)=DA,DIC="^FBAAA(",DIC(0)="LM",DLAYGO=161 D FILE^DICN L -^FBAAA(DFN) K DIC
"RTN","FBAAAUT",13,0)
 S:'$D(^FBAAA(DFN,1,0)) ^(0)="^161.01D^^"
"RTN","FBAAAUT",14,0)
 D ^FBAADEM K DIRUT,DIROUT,DTOUT,DUOUT
"RTN","FBAAAUT",15,0)
2 W ! S (HID,NID,FBAAP79,FBANEW)="",DA=DFN,DIE="^FBAAA(",DIE("NO^")="",DR="[FBAA AUTHORIZATION]" D ^DIE I $D(FBD1) S FBANEW=$G(^FBAAA(DFN,1,FBD1,0))
"RTN","FBAAAUT",16,0)
 D:'$D(Y)&(HID'="")&(HID'=NID) TRIG K HID,NID,NIDR,TIME
"RTN","FBAAAUT",17,0)
 G FBAAAUT:FBANEW']""
"RTN","FBAAAUT",18,0)
 D
"RTN","FBAAAUT",19,0)
 . N FBX,FBTXT
"RTN","FBAAAUT",20,0)
 . S FBTXT=$S($P($G(FBAOLD),"^",2)="":"Entered",1:"Edited")_" authorization."
"RTN","FBAAAUT",21,0)
 . S FBX=$$ADDUA^FBUTL9(161.01,FBD1_","_DFN_",",FBTXT)
"RTN","FBAAAUT",22,0)
 . I 'FBX W !,"Error adding record in User Audit. Please contact IRM."
"RTN","FBAAAUT",23,0)
 S X=FBANEW,K=FBD1,J=DT
"RTN","FBAAAUT",24,0)
 I FBAAP79="Y" S $P(^FBAAA(DFN,1,FBD1,1),"^",2)="",FBDFN=DFN D CHEKP79 S DFN=FBDFN
"RTN","FBAAAUT",25,0)
 I $D(FBAOLD),FBAOLD'=FBANEW,$D(FBAALT),FBAALT="Y" S FBTTYPE="A",FBMST=$S($P(FBANEW,"^",13)=1:"Y",1:""),FBFDC=$S($P(FBAOLD,"^")'=$P(FBANEW,"^"):1,1:"") D MORE
"RTN","FBAAAUT",26,0)
 I '$D(^FBAAC(DFN,0)) K DD,DO S (X,DINUM)=DFN,DIC(0)="L",DLAYGO=162,DIC="^FBAAC(" D FILE^DICN K DIC,DLAYGO
"RTN","FBAAAUT",27,0)
 G FBAAAUT
"RTN","FBAAAUT",28,0)
TRIG ;Add an entry in Fee Basis ID Card Audit file
"RTN","FBAAAUT",29,0)
 I '$D(^FBAA(161.83,DFN)) K DD,DO S (X,DINUM)=DFN,DIC="^FBAA(161.83,",DIC(0)="L",DLAYGO=161.83 D FILE^DICN Q:Y<0
"RTN","FBAAAUT",30,0)
 S:'$D(^FBAA(161.83,DFN,1,0)) ^(0)="^161.831DA^^"
"RTN","FBAAAUT",31,0)
 S %DT="XT",X="NOW" D ^%DT K %DT S TIME=Y
"RTN","FBAAAUT",32,0)
 F  L +^FBAA(161.83,DFN):$G(DILOCKTM,3) Q:$T  W !,"This patient's record is being edited by another user.  Trying again."
"RTN","FBAAAUT",33,0)
 S DIC="^FBAA(161.83,"_DFN_",1,",DIC(0)="LM",DINUM=9999999.9999-TIME,X=TIME,DIC("DR")="1////^S X=HID;2////^S X=NIDR;3////^S X=DUZ",DA(1)=DFN K DD,DO D FILE^DICN I Y<0 L -^FBAA(161.83,DFN) Q
"RTN","FBAAAUT",34,0)
 K DIE,DIC,DA,DLAYGO L -^FBAA(161.83,DFN)
"RTN","FBAAAUT",35,0)
 Q
"RTN","FBAAAUT",36,0)
ENT ;ENTRY POINT FROM ^FBAAPM TO CREATE MRA TRANSACTION
"RTN","FBAAAUT",37,0)
MORE ;
"RTN","FBAAAUT",38,0)
 S DIC="^FBAA(161.26,",DIC(0)="L",DLAYGO=161.26,X=DFN
"RTN","FBAAAUT",39,0)
 S DIC("DR")="1///^S X=""P"";2///^S X=FBD1;3///^S X=FBTTYPE;5////^S X=FBFDC;6////^S X=FBMST"
"RTN","FBAAAUT",40,0)
 K DD,DO D FILE^DICN K DIC,DLAYGO S DA=+Y
"RTN","FBAAAUT",41,0)
 Q
"RTN","FBAAAUT",42,0)
 ;
"RTN","FBAAAUT",43,0)
CHEKP79 W ! S DIR("A")="Want to Print 7079 for this patient now",DIR(0)="Y",DIR("B")="No" D ^DIR K DIR I Y S FBK=FBD1 D EN1^FBAAS79
"RTN","FBAAAUT",44,0)
 Q
"RTN","FBAAAUT",45,0)
Q K DA,DAT,DFN,DR,F,FBAASKV,FBAADDYS,FBAALT,FBAAP79,FBAATT,FBANEW,FBAOLD,FBCOUNTY,FBDX,FBI,FBRR,FBSITE,FBTYPE,FBXX,I,J,K,PI,S,T,Z,ZZ,FBAAASKV,FBPROG,DIC,DIE,FBAAX,X,Y,PTYPE,FBPRG,FBAAOUT,FBDFN
"RTN","FBAAAUT",46,0)
 K FBAUT,FBD1,FBPOP
"RTN","FBAAAUT",47,0)
 Q
"RTN","FBAAAUT",48,0)
 ;
"RTN","FBAAAUT",49,0)
 ; PROVIDER LOOKUP
"RTN","FBAAAUT",50,0)
 ;
"RTN","FBAAAUT",51,0)
 ; This function checks the inputed File 200 entry to ensure that it has been assigned the Security Key PROVIDER.
"RTN","FBAAAUT",52,0)
 ; 
"RTN","FBAAAUT",53,0)
 ; Referenced: AUTHORIZATION Sub-File (#161.01) OF FEE BASIS PATIENT File (#161) - REFERRING PROVIDER Field (#104)
"RTN","FBAAAUT",54,0)
 ; Referenced: FEE NOTIFICATION/REQUEST File (#162.2) - REFERRING PROVIDER Field (#17)
"RTN","FBAAAUT",55,0)
 ; Referenced: VA FORM 10-7078 File (#162.4) - REFERRING PROVIDER Field (#15)
"RTN","FBAAAUT",56,0)
 ; 
"RTN","FBAAAUT",57,0)
 ;  Input - FB200IEN - Internal IEN of file 200 entry
"RTN","FBAAAUT",58,0)
 ; Output - 0 Blank Input or entry without PROVIDER Security Key
"RTN","FBAAAUT",59,0)
 ;        - 1 Entry PROVIDER Security Key assigned
"RTN","FBAAAUT",60,0)
 ;
"RTN","FBAAAUT",61,0)
PROVIDER(FB200IEN) N Y
"RTN","FBAAAUT",62,0)
 ;
"RTN","FBAAAUT",63,0)
 Q:$G(FB200IEN)="" 0
"RTN","FBAAAUT",64,0)
 ;
"RTN","FBAAAUT",65,0)
 ;Test for PROVIDER Security Key
"RTN","FBAAAUT",66,0)
 I $D(^XUSEC("PROVIDER",FB200IEN)) Q 1
"RTN","FBAAAUT",67,0)
 ;
"RTN","FBAAAUT",68,0)
 ;Entry did not have PROVIDER Security Key
"RTN","FBAAAUT",69,0)
 Q 0
"RTN","FBAABDL")
0^11^B8082291^B8137938
"RTN","FBAABDL",1,0)
FBAABDL ;AISC/DMK - DELETE A BATCH ;7/14/14  12:07
"RTN","FBAABDL",2,0)
 ;;3.5;FEE BASIS;**132,154**;JAN 30, 1995;Build 12
"RTN","FBAABDL",3,0)
 ;;Per VA Directive 6402, this routine should not be modified.
"RTN","FBAABDL",4,0)
 ;This routine allows the deletion of a batch that has no line
"RTN","FBAABDL",5,0)
 ;items associated with it.  Access is restricted to the user
"RTN","FBAABDL",6,0)
 ;who opened the batch or the holder of the 'FBAA LEVEL 2'
"RTN","FBAABDL",7,0)
 ;security key.
"RTN","FBAABDL",8,0)
BT ;select batch
"RTN","FBAABDL",9,0)
 S FBNO=1
"RTN","FBAABDL",10,0)
 W ! S DIC="^FBAA(161.7,",DIC(0)="AEQZ",DIC("S")=$S($D(^XUSEC("FBAA LEVEL 2",DUZ)):"",1:"I $P(^(0),U,5)=DUZ")
"RTN","FBAABDL",11,0)
 D ^DIC K DIC G END:X=""!(X="^") G BT:Y<0 S FBBAT=+Y,FBBAT(0)=Y(0)
"RTN","FBAABDL",12,0)
 ;
"RTN","FBAABDL",13,0)
 I $$GET1^DIQ(161.7,FBBAT_",",25,"I")=1 W !!,"Batch cannot be deleted because:",!?5,$P($T(NOGO+6),";;",2) S FBNO=0 D END G BT
"RTN","FBAABDL",14,0)
 ;reset batch line count and total dollars first
"RTN","FBAABDL",15,0)
 I $G(FBBAT) N FBTOTAL,FBLCNT D
"RTN","FBAABDL",16,0)
 .  D CNTTOT^FBAARB(FBBAT) S DA=FBBAT,DIE="^FBAA(161.7,",DR="10////^S X=FBLCNT;8////^S X=FBTOTAL;S:FBLCNT!(FBTOTAL) Y="""";9///@" D ^DIE K DIE,DR,DA D
"RTN","FBAABDL",17,0)
 ..S:FBTOTAL=0 $P(^FBAA(161.7,+FBBAT,0),U,9)=""
"RTN","FBAABDL",18,0)
 ..S:FBLCNT=0 $P(^FBAA(161.7,+FBBAT,0),U,11)=""
"RTN","FBAABDL",19,0)
 . S FBBAT(0)=^FBAA(161.7,+FBBAT,0)
"RTN","FBAABDL",20,0)
 ;
"RTN","FBAABDL",21,0)
 ;check to see if batch meets criteria for deletion
"RTN","FBAABDL",22,0)
 ;Total Dollars '>0        Invoice Count '>0
"RTN","FBAABDL",23,0)
 ;Payment Line Count '>0        Rejects Pending flag '= "Y"
"RTN","FBAABDL",24,0)
 ;
"RTN","FBAABDL",25,0)
 F I=9,10,11 I $P(FBBAT(0),U,I)>0 W !!?5,$P($T(NOGO+(I-8)),";;",2) S FBNO=0 D END G BT
"RTN","FBAABDL",26,0)
 ;check to see if any invoices point to batch
"RTN","FBAABDL",27,0)
 S FBTYPE=$P(^FBAA(161.7,FBBAT,0),"^",3) I $S(FBTYPE="B3":$D(^FBAAC("AC",FBBAT)),FBTYPE="B5":$D(^FBAA(162.1,"AE",FBBAT)),FBTYPE="B9":$D(^FBAAI("AC",FBBAT)),FBTYPE="B2":$D(^FBAAC("AD",FBBAT)),1:0) D  D END G BT
"RTN","FBAABDL",28,0)
 .W !!?5,$P($T(NOGO+5),";;",2)
"RTN","FBAABDL",29,0)
 I $P(FBBAT(0),U,17)="Y" W !!?5,$P($T(NOGO+4),";;",2) S FBNO=0 D END G BT
"RTN","FBAABDL",30,0)
 ;display batch and ask if sure want to delete
"RTN","FBAABDL",31,0)
 W !! S DIC="^FBAA(161.7,",DA=FBBAT,DR="0:1;ST" D EN^DIQ K DIC,DR,DA
"RTN","FBAABDL",32,0)
 ;
"RTN","FBAABDL",33,0)
 S DIR(0)="Y",DIR("B")="No",DIR("A")="Sure you want to DELETE this batch" D ^DIR K DIR S:'Y FBNO=0
"RTN","FBAABDL",34,0)
 I $D(DIRUT)!('Y) D END G BT
"RTN","FBAABDL",35,0)
 ;
"RTN","FBAABDL",36,0)
 ;delete batch
"RTN","FBAABDL",37,0)
 I $G(FBNO) S DA=FBBAT,DIK="^FBAA(161.7," D ^DIK K DIK
"RTN","FBAABDL",38,0)
 W !!?5,*7,"Batch Deleted.",!
"RTN","FBAABDL",39,0)
 D END G BT
"RTN","FBAABDL",40,0)
 ;
"RTN","FBAABDL",41,0)
END K DA,I,FBBAT,FBNO,X,Y,FBTYPE Q
"RTN","FBAABDL",42,0)
 ;
"RTN","FBAABDL",43,0)
NOGO ;reasons why batch cannot be deleted
"RTN","FBAABDL",44,0)
 ;;TOTAL DOLLARS in batch is greater than zero.
"RTN","FBAABDL",45,0)
 ;;INVOICE COUNT in batch is greater than zero.
"RTN","FBAABDL",46,0)
 ;;PAYMENT LINE COUNT in batch is greater than zero.
"RTN","FBAABDL",47,0)
 ;;REJECTS PENDING flag in batch is set to 'YES'.
"RTN","FBAABDL",48,0)
 ;;Batch has INVOICES associated with it.
"RTN","FBAABDL",49,0)
 ;;Batch was rejected using the Reprocess Overdue Batch option.
"RTN","FBAABET")
0^12^B8176586^B8247831
"RTN","FBAABET",1,0)
FBAABET ;AISC/UNK - EDIT BATCH ;7/9/14  15:48
"RTN","FBAABET",2,0)
 ;;3.5;FEE BASIS;**154**;JAN 30, 1995;Build 12
"RTN","FBAABET",3,0)
 ;;Per VA Directive 6402, this routine should not be modified.
"RTN","FBAABET",4,0)
RD W !! S DIC="^FBAA(161.7,",DIC(0)="AEQZ",DIC("S")=$S($D(^XUSEC("FBAA LEVEL 2",DUZ)):"I $G(^(""ST""))=""O""",1:"I $P(^(0),U,5)=DUZ&($G(^(""ST""))=""O"")") D ^DIC K DIC G END:X="^"!(X=""),RD:Y<0 S FBDA=+Y,FBDA(0)=Y(0)
"RTN","FBAABET",5,0)
 S FBON=$P(FBDA(0),U,2),PRC("SITE")=$P(FBDA(0),U,8),FBTYPE=$P(FBDA(0),U,3)
"RTN","FBAABET",6,0)
 ;
"RTN","FBAABET",7,0)
OB W !,"Obligation Number:  ",FBON,"//"
"RTN","FBAABET",8,0)
 S DIR(0)="Y",DIR("A")="Do you want to change the Obligation Number",DIR("B")="No" D ^DIR K DIR G END:$D(DIRUT) D GETOB:Y
"RTN","FBAABET",9,0)
 S DIE="^FBAA(161.7,",DA=FBDA,DR="[FBAA BATCH EDIT]" D ^DIE K DIE,DIC,DR
"RTN","FBAABET",10,0)
 G RD
"RTN","FBAABET",11,0)
 ;
"RTN","FBAABET",12,0)
END K DR,DIC,DIE,X,DO,DA,DI,DQ,Z,ZZ,PRC,FBHOLDX,FBPOP,FBSITE,FBON,FBDA,DIRUT,DUOUT,DTOUT,PRCS,PRCSCPAN,Y,FBI,FBJ,FBK,FBL
"RTN","FBAABET",13,0)
 Q
"RTN","FBAABET",14,0)
 ;
"RTN","FBAABET",15,0)
GETOB ;Get valid Obligation Number
"RTN","FBAABET",16,0)
 S PRCS("A")="Select Obligation Number:  " K PRCS("X"),DR S PRCS("TYPE")="FB" D EN1^PRCS58 Q:Y=-1  S FBON=$P($P(Y,"^",2),"-",2) D
"RTN","FBAABET",17,0)
 . ;find if any payments are associated with this batch and change
"RTN","FBAABET",18,0)
 . ;obligation number
"RTN","FBAABET",19,0)
 . I FBTYPE="B3",$D(^FBAAC("AC",FBDA)) D
"RTN","FBAABET",20,0)
 ..S (FBI,FBJ,FBK,FBL)=0 F  S FBI=$O(^FBAAC("AC",FBDA,FBI)) Q:'FBI  F  S FBJ=$O(^FBAAC("AC",FBDA,FBI,FBJ)) Q:'FBJ  F  S FBK=$O(^FBAAC("AC",FBDA,FBI,FBJ,FBK)) Q:'FBK  D
"RTN","FBAABET",21,0)
 ... F  S FBL=$O(^FBAAC("AC",FBDA,FBI,FBJ,FBK,FBL)) Q:'FBL  I $G(^FBAAC(FBI,1,FBJ,1,FBK,1,FBL,0)),$P(^(0),U,8)=FBDA D
"RTN","FBAABET",22,0)
 .... S DA(3)=FBI,DA(2)=FBJ,DA(1)=FBK,DA=FBL,DIE="^FBAAC("_FBI_",1,"_FBJ_",1,"_FBK_",1,",DR="8////^S X=FBON" D ^DIE K DIC,DIE,DR,DA
"RTN","FBAABET",23,0)
 . I FBTYPE="B5",$D(^FBAA(162.1,"AE",FBDA)) D
"RTN","FBAABET",24,0)
 .. S (FBI,FBJ)=0 F  S FBI=$O(^FBAA(162.1,"AE",FBDA,FBI)) Q:'FBI  F  S FBJ=$O(^FBAA(162.1,"AE",FBDA,FBI,FBJ)) Q:'FBJ  I $G(^FBAA(162.1,FBI,"RX",FBJ,0)),$P(^(0),U,17)=FBDA D
"RTN","FBAABET",25,0)
 ... S DA(1)=FBI,DA=FBJ,DIE="^FBAA(162.1,"_FBI_",""RX"",",DR="14////^S X=FBON" D ^DIE K DIC,DIE,DR,DA
"RTN","FBAABET",26,0)
 Q
"RTN","FBAACCB")
0^13^B34771662^B34837713
"RTN","FBAACCB",1,0)
FBAACCB ;AISC/GRR - CLERK CLOSE BATCH ;7/9/14  16:16
"RTN","FBAACCB",2,0)
 ;;3.5;FEE BASIS;**4,61,77,116,154**;JAN 30, 1995;Build 12
"RTN","FBAACCB",3,0)
 ;;Per VA Directive 6402, this routine should not be modified.
"RTN","FBAACCB",4,0)
 K QQ D DT^DICRW
"RTN","FBAACCB",5,0)
BT W !! S DIC="^FBAA(161.7,",DIC(0)="AEQ",DIC("S")=$S($D(^XUSEC("FBAA LEVEL 2",DUZ)):"I $G(^(""ST""))=""O""",1:"I $P(^(0),U,5)=DUZ&($G(^(""ST""))=""O"")") D ^DIC K DIC("S")
"RTN","FBAACCB",6,0)
 G Q^FBAACCB0:X="^"!(X=""),BT:Y<0 S B=+Y,FZ=^FBAA(161.7,B,0),FBTYPE=$P(FZ,"^",3)
"RTN","FBAACCB",7,0)
 I FBTYPE="B3",'$D(^FBAAC("AC",B)) W !!,*7,"No payments in Batch yet!",! G BT
"RTN","FBAACCB",8,0)
 I FBTYPE="B2",'$D(^FBAAC("AD",B)) W !!,*7,"No Payments in Batch yet!",! G BT
"RTN","FBAACCB",9,0)
 I FBTYPE="B5",'$D(^FBAA(162.1,"AE",B)) W !!,*7,"No Payments in Batch yet!",! G BT
"RTN","FBAACCB",10,0)
 I FBTYPE="B9",'$D(^FBAAI("AC",B)) W !!,*7,"No Payments in Batch yet!",! G BT
"RTN","FBAACCB",11,0)
RDD S DIR(0)="Y",DIR("A")="Want to review batch",DIR("B")="NO",DIR("?")="If you want a detail list of each payment line, answer ""Yes"" otherwise press Return key" D ^DIR K DIR
"RTN","FBAACCB",12,0)
 G BT:$D(DIRUT) W:Y @IOF D:Y LIST:FBTYPE="B3",LISTP:FBTYPE="B5",LISTT^FBAACCB0:FBTYPE="B2",LISTC^FBAACCB1:FBTYPE="B9"
"RTN","FBAACCB",13,0)
RDD1 S DIR(0)="Y",DIR("A")="Do you still want to close Batch",DIR("B")="YES" D ^DIR K DIR G BT:'Y!$D(DIRUT)
"RTN","FBAACCB",14,0)
 N FBARY,FBOLD,FBINVT
"RTN","FBAACCB",15,0)
 ;
"RTN","FBAACCB",16,0)
 S C=0,T=0 G PHARM^FBAACCB1:FBTYPE="B5",TRAV^FBAACCB1:FBTYPE="B2",CHNH^FBAACCB1:FBTYPE="B9"
"RTN","FBAACCB",17,0)
 F J=0:0 S J=$O(^FBAAC("AC",B,J)) Q:J'>0  F K=0:0 S K=$O(^FBAAC("AC",B,J,K)) Q:K'>0  F L=0:0 S L=$O(^FBAAC("AC",B,J,K,L)) Q:L'>0  F M=0:0 S M=$O(^FBAAC("AC",B,J,K,L,M)) Q:M'>0  D GOT
"RTN","FBAACCB",18,0)
FIN ; FB*3.5*116 - check and handle $0 invoices
"RTN","FBAACCB",19,0)
 D CHECK(.FBARY)
"RTN","FBAACCB",20,0)
 I $D(FBARY) D  G BT
"RTN","FBAACCB",21,0)
 . ;D EN^DDIOL(.FBARY)
"RTN","FBAACCB",22,0)
 . W *7,!!?2,"Batch cannot be closed. Listed invoices are zero dollar "
"RTN","FBAACCB",23,0)
 . W *7,!?2,"and must be corrected or removed from the batch."
"RTN","FBAACCB",24,0)
 ; end of changes
"RTN","FBAACCB",25,0)
 ;
"RTN","FBAACCB",26,0)
 S $P(FZ,"^",9)=T,$P(FZ,"^",11)=C
"RTN","FBAACCB",27,0)
 S $P(FZ,"^",13)=DT,^FBAA(161.7,B,0)=FZ,^FBAA(161.7,B,"ST")="C",^FBAA(161.7,"AC","C",B)="",DA=B,DR="0;ST" K ^FBAA(161.7,"AC","O",B),^FBAA(161.7,"AB","O",$P(^FBAA(161.7,B,0),"^",5),B) W !! D EN^DIQ W !!,"Batch Closed" G BT
"RTN","FBAACCB",28,0)
 ;
"RTN","FBAACCB",29,0)
GOT S Y(0)=$G(^FBAAC(J,1,K,1,L,1,M,0)),FBIN=$P(Y(0),"^",16)
"RTN","FBAACCB",30,0)
 ; HIPAA 5010 - count line items that have 0.00 amount paid
"RTN","FBAACCB",31,0)
 S T=T+$P(Y(0),"^",3),C=C+1
"RTN","FBAACCB",32,0)
 ; FB*3.5*116 -collect amount paid for each invoice in batch
"RTN","FBAACCB",33,0)
 S FBARY(FBIN)=$G(FBARY(FBIN))+$P(Y(0),"^",3)
"RTN","FBAACCB",34,0)
 Q
"RTN","FBAACCB",35,0)
 ;
"RTN","FBAACCB",36,0)
CHECK(FBINV) ; order thru array and save zero dollar invoices; report any zero dollar invoices
"RTN","FBAACCB",37,0)
 ; FBINV = array of invoices
"RTN","FBAACCB",38,0)
 N FBAAIN
"RTN","FBAACCB",39,0)
 S FBAAIN=0 F  S FBAAIN=$O(FBINV(FBAAIN)) Q:'FBAAIN  D
"RTN","FBAACCB",40,0)
 . I FBINV(FBAAIN)'>0 W !!,"Invoice #: "_FBAAIN_" totals $0.00"
"RTN","FBAACCB",41,0)
 . E  K FBINV(FBAAIN) ; remove array elements that represent non-zero dollar invoices
"RTN","FBAACCB",42,0)
 Q
"RTN","FBAACCB",43,0)
 ;
"RTN","FBAACCB",44,0)
LIST S Q="",$P(Q,"=",80)="="
"RTN","FBAACCB",45,0)
 S IOP=$S($D(ION):ION,1:"HOME") D ^%ZIS K IOP
"RTN","FBAACCB",46,0)
ENM D HED S (FBIN,FBINOLD)="",(FBAAOUT,FBINTOT)=0 F XY=0:0 S FBIN=$O(^FBAAC("AJ",B,FBIN)) Q:FBIN=""!($G(FBAAOUT))  D INTOT^FBAACCB0 F J=0:0 S J=$O(^FBAAC("AJ",B,FBIN,J)) Q:J'>0!($G(FBAAOUT))  D GMORE^FBAACCB0
"RTN","FBAACCB",47,0)
 I '$G(FBAAOUT) S FBIN=0 D INTOT^FBAACCB0
"RTN","FBAACCB",48,0)
 Q
"RTN","FBAACCB",49,0)
SET ;
"RTN","FBAACCB",50,0)
 N FBADJLA,FBADJLR,FBFPPSC,FBFPPSL,FBX,FBY3,TAMT
"RTN","FBAACCB",51,0)
 S N=$S($D(^DPT(J,0)):$P(^DPT(J,0),"^",1),1:""),S=$S(N]"":$P(^DPT(J,0),"^",9),1:""),V=$S($D(^FBAAV(K,0)):$P(^FBAAV(K,0),"^",1),1:""),VID=$S(V]"":$P(^(0),"^",2),1:"")
"RTN","FBAACCB",52,0)
 S D=+$G(^FBAAC(J,1,K,1,L,0)) Q:'D
"RTN","FBAACCB",53,0)
 S Y=$G(^FBAAC(J,1,K,1,L,1,M,0)) Q:Y']""
"RTN","FBAACCB",54,0)
 S FBY3=$G(^FBAAC(J,1,K,1,L,1,M,3))
"RTN","FBAACCB",55,0)
 S FBFPPSC=$P(FBY3,U)
"RTN","FBAACCB",56,0)
 S FBFPPSL=$P(FBY3,U,2)
"RTN","FBAACCB",57,0)
 S FBX=$$ADJLRA^FBAAFA(M_","_L_","_K_","_J_",")
"RTN","FBAACCB",58,0)
 S FBADJLR=$P(FBX,U)
"RTN","FBAACCB",59,0)
 S FBADJLA=$P(FBX,U,2)
"RTN","FBAACCB",60,0)
 S T=$P(Y,"^",5),FBIN=$P(Y,"^",16),ZS=$P(Y,"^",20)
"RTN","FBAACCB",61,0)
 S TAMT=$FN($P(Y,"^",4),"",2)
"RTN","FBAACCB",62,0)
 S FBVP=$S($P(Y,"^",21)="VP":"#",1:"")
"RTN","FBAACCB",63,0)
 S FBAACPT=$$CPT^FBAAUTL4($P(Y,U))
"RTN","FBAACCB",64,0)
 S CPTDESC=$$CPT^FBAAUTL4($P(Y,U),1,D)
"RTN","FBAACCB",65,0)
 S FBVCHDT=$P(Y,"^",6),FBIN(1)=$P(Y,"^",15) D FBCKO^FBAACCB2(J,K,L,M)
"RTN","FBAACCB",66,0)
 S FBMODLE=$$MODL^FBAAUTL4("^FBAAC("_J_",1,"_K_",1,"_L_",1,"_M_",""M"")","E")
"RTN","FBAACCB",67,0)
GO S A1=$P(Y,"^",2)+.0001,A2=$P(Y,"^",3)+.0001,A1=$P(A1,".",1)_"."_$E($P(A1,".",2),1,2),A2=$P(A2,".",1)_"."_$E($P(A2,".",2),1,2),FBINTOT=FBINTOT+A2
"RTN","FBAACCB",68,0)
 D WRT:FBTYPE'="B2",WRTT^FBAACCB0:FBTYPE="B2"
"RTN","FBAACCB",69,0)
 Q
"RTN","FBAACCB",70,0)
WRT I $Y+8>IOSL D ASKH^FBAACCB0:$E(IOST,1,2)["C-" Q:FBAAOUT  W @IOF D HED
"RTN","FBAACCB",71,0)
 S B(1617)=$S(B="":"",$D(^FBAA(161.7,B,0)):$P(^(0),"^"),1:"")
"RTN","FBAACCB",72,0)
 W !!,N,?35,$$SSN^FBAAUTL(J),?58,B(1617),?67,$$DATX^FBAAUTL($G(FBVCHDT)),!,?3,V,?42,VID,?55,FBIN,?67,$$DATX^FBAAUTL(FBIN(1))
"RTN","FBAACCB",73,0)
 W !,$S($D(QQ):QQ_")",1:""),$S(ZS="R":"*",1:""),$S(FBTYPE="B3":FBVP,1:""),$S(FBTYPE="B5":FBPV,1:""),$S($G(FBCAN)]"":"+",1:"")
"RTN","FBAACCB",74,0)
 I FBTYPE="B3" W ?4,$$DATX^FBAAUTL(D),?14,FBAACPT_$S($G(FBMODLE)]"":"-"_$P(FBMODLE,","),1:""),?24,CPTDESC,?54,FBFPPSC,?66,FBFPPSL
"RTN","FBAACCB",75,0)
 I FBTYPE="B5" W ?4,$$DATX^FBAAUTL(D),?14,FBAACPT_$S($G(FBMODLE)]"":"-"_$P(FBMODLE,","),1:""),?24,CPTDESC,?56,FBFPPSC,?68,FBFPPSL
"RTN","FBAACCB",76,0)
 I $P($G(FBMODLE),",",2)]"" D  Q:FBAAOUT
"RTN","FBAACCB",77,0)
 . N FBI,FBMOD
"RTN","FBAACCB",78,0)
 . F FBI=2:1 S FBMOD=$P(FBMODLE,",",FBI) Q:FBMOD=""  D  Q:FBAAOUT
"RTN","FBAACCB",79,0)
 . . I $Y+5>IOSL D  Q:FBAAOUT
"RTN","FBAACCB",80,0)
 . . . I $E(IOST,1,2)="C-" D ASKH^FBAACCB0 Q:FBAAOUT
"RTN","FBAACCB",81,0)
 . . . W @IOF D HED W !,"(continued)"
"RTN","FBAACCB",82,0)
 . . W !,?19,"-",FBMOD
"RTN","FBAACCB",83,0)
 W !?4,$J(A1,6),?17,$J(A2,6)
"RTN","FBAACCB",84,0)
 ; write adjustment reasons, if null then write suspend code
"RTN","FBAACCB",85,0)
 W ?30,$S(FBADJLR]"":FBADJLR,1:T)
"RTN","FBAACCB",86,0)
 ; write adjustment amounts, if null then write amount suspended
"RTN","FBAACCB",87,0)
 W ?41,$S(FBADJLA]"":FBADJLA,1:TAMT)
"RTN","FBAACCB",88,0)
 D PMNT^FBAACCB2 S FBINOLD=FBIN
"RTN","FBAACCB",89,0)
 Q
"RTN","FBAACCB",90,0)
HED W "Patient Name",?20,"('*' Reimbursement to Patient   '+' Cancellation Activity)",!,?13,"('#' Voided Payment)",?58,"Batch #",?67,"Voucher Date"
"RTN","FBAACCB",91,0)
 W !,?3,"Vendor Name",?42,"Vendor ID",?53,"Invoice #",?67,"Date Rec'd."
"RTN","FBAACCB",92,0)
 I FBTYPE="B3" D
"RTN","FBAACCB",93,0)
 . W !,?4,"SVC DATE",?14,"CPT-MOD",?24,"SERVICE PROVIDED",?54,"FPPS CLAIM",?66,"FPPS LINE"
"RTN","FBAACCB",94,0)
 . W !,?4,"CLAIMED",?17,"PAID",?30,"ADJ CODE",?41,"ADJ AMOUNT"
"RTN","FBAACCB",95,0)
 I FBTYPE="B5" D
"RTN","FBAACCB",96,0)
 . W !,?4,"RX  DATE",?14,"RX #",?24,"DRUG NAME",?56,"FPPS CLAIM",?68,"FPPS LINE"
"RTN","FBAACCB",97,0)
 . W !,?4,"CLAIMED",?17,"PAID",?30,"ADJ CODE",?41,"ADJ AMOUNT"
"RTN","FBAACCB",98,0)
 W !,Q,!
"RTN","FBAACCB",99,0)
 Q
"RTN","FBAACCB",100,0)
LISTP S Q="",$P(Q,"=",80)="="
"RTN","FBAACCB",101,0)
 S IOP=$S($D(ION):ION,1:"HOME") D ^%ZIS K IOP
"RTN","FBAACCB",102,0)
ENP D HED S (FBAAOUT,FBINTOT)=0,FBINOLD=""
"RTN","FBAACCB",103,0)
 F A=0:0 S A=$O(^FBAA(162.1,"AE",B,A)) Q:A'>0!($G(FBAAOUT))  S FBIN=A D SETV^FBAACCB0 F B2=0:0 S B2=$O(^FBAA(162.1,"AE",B,A,B2)) Q:B2'>0!($G(FBAAOUT))  D INTOT^FBAACCB0 I $D(^FBAA(162.1,A,"RX",B2,0)) S Z(0)=^(0) D MORE^FBAACCB1
"RTN","FBAACCB",104,0)
 I '$G(FBAAOUT) S FBIN=0 D INTOT^FBAACCB0
"RTN","FBAACCB",105,0)
 Q
"RTN","FBAACIE")
0^35^B16604968^B15124561
"RTN","FBAACIE",1,0)
FBAACIE ;AISC/GRR - COMPLETE PHARMACY INVOICE ;1/22/2015
"RTN","FBAACIE",2,0)
 ;;3.5;FEE BASIS;**38,61,91,154**;JAN 30, 1995;Build 12
"RTN","FBAACIE",3,0)
 ;;Per VA Directive 6402, this routine should not be modified.
"RTN","FBAACIE",4,0)
 D DT^DICRW,HOME^%ZIS I '$D(^FBAA(162.1,"AC",2)) W !!,*7,"There are no Invoices Pending completion!",!! Q
"RTN","FBAACIE",5,0)
 D SITEP^FBAAUTL I FBPOP W !,*7,"Fee Site Parameters must be Initialized!" K FBPOP Q
"RTN","FBAACIE",6,0)
 S FBAAOUT=1,FBMDF=$P(FBSITE(0),"^",10),UL="",$P(UL,"=",79)="="
"RTN","FBAACIE",7,0)
RINV W ! S FBINTOT=0,DIC="^FBAA(162.1,",DIC(0)="AEQM",DIC("S")="I $P(^(0),U,5)=2&($D(^(""RX"",""AC"",2)))" D ^DIC K DIC("S") G END:X="^"!(X=""),RINV:Y<0 S FBIN=+Y,FBINTOT=+$P(^(0),"^",7)
"RTN","FBAACIE",8,0)
 I '$D(^FBAA(162.1,FBIN,"RX","AC",2)) G RINV
"RTN","FBAACIE",9,0)
 S J=0 F  S J=$O(^FBAA(162.1,FBIN,"RX","AC",2,J)) Q:'J  I $D(^FBAA(162.1,FBIN,"RX",J,0)) S Y(0)=^(0) D GOT
"RTN","FBAACIE",10,0)
 I '$D(^FBAA(162.1,FBIN,"RX","AC",2)) K ^FBAA(162.1,"AC",2,FBIN) S ^FBAA(162.1,"AC",3,FBIN)="",$P(^FBAA(162.1,FBIN,0),"^",5)=3
"RTN","FBAACIE",11,0)
 I $D(^FBAA(162.1,"AC",3,FBIN)) W !!,"Invoice is Complete",?30,"Totals: $ "_$J(FBINTOT,1,2)
"RTN","FBAACIE",12,0)
 G RINV
"RTN","FBAACIE",13,0)
END K FBAAOUT,FBIN,FBRX,FBSITE,FBDATEF,FBDRUG,FBPATN,FBPID,FBVNAME,FBVID,FBAC,FBAAPR,DA,X,Y,D0,D1,DI,DIC,DIE,DIRUT,DIV,DQ,DR,FBAP,FBGEN,FBGENSUB,FBINTOT,FBMDF,FBQTY,FBRBC,FBSTR,FBVEN,S,UL,ULL,POP,J,DFN,Z,ZZ,FBSW,FBPOP,FB1725
"RTN","FBAACIE",14,0)
 K FBADJ,FBFPPSC,FBFPPSL,FBRRMK,DTOUT,FBX,FTP
"RTN","FBAACIE",15,0)
 Q
"RTN","FBAACIE",16,0)
GOT S FBDRUG=$P(Y(0),"^",2)
"RTN","FBAACIE",17,0)
 S FBGENSUB=$$GET1^DIQ(162.11,J_","_FBIN_",",8.5)
"RTN","FBAACIE",18,0)
 S FBGEN=$$GET1^DIQ(162.11,J_","_FBIN_",",9)
"RTN","FBAACIE",19,0)
 S FBRX=$P(Y(0),"^"),FBDATEF=$P(Y(0),"^",3),FBAC=$P(Y(0),"^",4),DFN=+$P(Y(0),"^",5),FBPATN=$$VET^FBUCUTL(DFN),FBPID=$$SSN^FBAAUTL(DFN)
"RTN","FBAACIE",20,0)
 S FBSTR=$P(Y(0),"^",12),FBQTY=$P(Y(0),"^",13),FBAAPR=$P(Y(0),"^",22)
"RTN","FBAACIE",21,0)
 S Y=$S($D(^FBAA(162.1,FBIN,0)):^(0),1:"")
"RTN","FBAACIE",22,0)
 S FBFPPSC=$P(Y,U,13)
"RTN","FBAACIE",23,0)
 S FBFPPSL=$P($G(^FBAA(162.1,FBIN,"RX",J,3)),U)
"RTN","FBAACIE",24,0)
 S FBVEN=+$P(Y,"^",4),FBVNAME=$$VEN^FBUCUTL(FBVEN),FBVID=$P($G(^FBAAV(FBVEN,0)),"^",2)
"RTN","FBAACIE",25,0)
 ; set FB1725 flag = true if payment for a 38 U.S.C. 1725 claim
"RTN","FBAACIE",26,0)
 S Y(2)=$G(^FBAA(162.1,FBIN,"RX",J,2))
"RTN","FBAACIE",27,0)
 S FB1725=$S($P(Y(2),U,6)["FB583":+$P($G(^FB583(+$P(Y(2),U,6),0)),U,28),1:0)
"RTN","FBAACIE",28,0)
 S FTP=$P(Y(2),U,7)
"RTN","FBAACIE",29,0)
 W @IOF,"Vendor: ",FBVNAME,"   Vendor ID: ",FBVID
"RTN","FBAACIE",30,0)
 W !!,"Patient: ",FBPATN,"   Patient ID: ",FBPID
"RTN","FBAACIE",31,0)
 W !,"FPPS Claim ID: ",$S(FBFPPSC="":"N/A",1:FBFPPSC)
"RTN","FBAACIE",32,0)
 W ?28,"FPPS Line Item: ",$S(FBFPPSL="":"N/A",1:FBFPPSL)
"RTN","FBAACIE",33,0)
 W !!,"Drug Name",?32,"   RX #  "," Strength  ","  Qty","   Amt Claimed   ",!,UL
"RTN","FBAACIE",34,0)
 W !,FBDRUG,?34,FBRX,?43,FBSTR,?54,FBQTY,?63,FBAC
"RTN","FBAACIE",35,0)
 I FBGENSUB]"" W !!,?4,"Generic Drug Issued: ",FBGENSUB,?30,"Generic Drug Name: ",$E(FBGEN,1,30)
"RTN","FBAACIE",36,0)
 W:FBAAPR]"" !!,?5,"Pharmacy Remarks: ",FBAAPR
"RTN","FBAACIE",37,0)
 I '$$UOKPAY^FBUTL9(DFN,FTP) D  Q
"RTN","FBAACIE",38,0)
 . W !!,"You cannot process a payment associated with authorization ",DFN,"-",FTP
"RTN","FBAACIE",39,0)
 . W !,"due to separation of duties."
"RTN","FBAACIE",40,0)
 . S DIR(0)="E",DIR("A")="Press RETURN to continue" D ^DIR K DIR
"RTN","FBAACIE",41,0)
FEE S DIR(0)="161.4,9",DIR("B")=FBMDF,DIR("?")="Hit Return to accept default dispensing fee or enter a dollar amount between .01 and 20" D ^DIR K DIR Q:$D(DIRUT)
"RTN","FBAACIE",42,0)
 W:FB1725 !?2,"**Payment is for emergency treatment under 38 U.S.C. 1725."
"RTN","FBAACIE",43,0)
 W !! S FBMDF=+Y K FBAP
"RTN","FBAACIE",44,0)
 S DA(1)=FBIN,DIE="^FBAA(162.1,"_FBIN_",""RX"",",DA=J,DIC=DIE,DR="5;S FBRBC=X;6.5//^S X=$S(FBRBC+FBMDF>FBAC:FBAC,1:FBRBC+FBMDF);S FBAP=X"
"RTN","FBAACIE",45,0)
 S DR(1,162.11,1)="I FBAP>FBAC S $P(^FBAA(162.1,DA(1),""RX"",DA,0),U,16)="""" W !,*7,""Amount Paid cannot be greater than the Amount Claimed"" S Y=6.5"
"RTN","FBAACIE",46,0)
 S DR(1,162.11,2)="S FBX=$$ADJ^FBUTL2(FBAC-FBAP,.FBADJ,2,,,1)"
"RTN","FBAACIE",47,0)
 S DR(1,162.11,3)="S FBX=$$RR^FBUTL4(.FBRRMK,2);8////^S X=3"
"RTN","FBAACIE",48,0)
 D ^DIE K DIE Q:($D(Y)'=0)!$D(DTOUT)
"RTN","FBAACIE",49,0)
 S:$D(FBAP) FBINTOT=FBINTOT+FBAP
"RTN","FBAACIE",50,0)
 S $P(^FBAA(162.1,FBIN,0),"^",7)=FBINTOT
"RTN","FBAACIE",51,0)
 ; file adjustments
"RTN","FBAACIE",52,0)
 D FILEADJ^FBRXFA(DA_","_FBIN_",",.FBADJ)
"RTN","FBAACIE",53,0)
 ; file remittance remarks
"RTN","FBAACIE",54,0)
 D FILERR^FBRXFR(DA_","_FBIN_",",.FBRRMK)
"RTN","FBAACIE",55,0)
 Q
"RTN","FBAACLU")
0^1^B35110722^B2956691
"RTN","FBAACLU",1,0)
FBAACLU ;AISC/DMK,WOIFO/SAB - CLERK WHO ENTERED AUTHORIZATION ;12/8/2014
"RTN","FBAACLU",2,0)
 ;;3.5;FEE BASIS;**154**;JAN 30, 1995;Build 12
"RTN","FBAACLU",3,0)
 ;;Per VA Directive 6402, this routine should not be modified.
"RTN","FBAACLU",4,0)
 ;
"RTN","FBAACLU",5,0)
 ; inputs
"RTN","FBAACLU",6,0)
 ;   FBFILE - (required) file/sub-file # from menu option entry action
"RTN","FBAACLU",7,0)
 ;
"RTN","FBAACLU",8,0)
 ; check for required input
"RTN","FBAACLU",9,0)
 Q:"^161.01^162.2^162.4^162.7^"'[("^"_$G(FBFILE)_"^")
"RTN","FBAACLU",10,0)
 ;
"RTN","FBAACLU",11,0)
 N D,FBDA,POP,%ZIS
"RTN","FBAACLU",12,0)
 ;
"RTN","FBAACLU",13,0)
 ; ask record in file
"RTN","FBAACLU",14,0)
 I FBFILE=161.01 D
"RTN","FBAACLU",15,0)
 . S DIC="^FBAAA(",DIC(0)="AEQM"
"RTN","FBAACLU",16,0)
 . D ^DIC K DIC Q:Y<0  S FBDA(1)=+Y
"RTN","FBAACLU",17,0)
 . S DIC="^FBAAA("_FBDA(1)_",1,",DIC(0)="AEQM"
"RTN","FBAACLU",18,0)
 . D ^DIC K DIC Q:Y<0  S FBDA=+Y
"RTN","FBAACLU",19,0)
 I FBFILE=162.2 D
"RTN","FBAACLU",20,0)
 . S DIC="^FBAA(162.2,",DIC(0)="AQEM"
"RTN","FBAACLU",21,0)
 . D ^DIC K DIC Q:Y<0  S FBDA=+Y
"RTN","FBAACLU",22,0)
 I FBFILE=162.4 D
"RTN","FBAACLU",23,0)
 . S DIC="^FB7078(",DIC(0)="AQEM",DIC("A")="Select Patient: ",D="D"
"RTN","FBAACLU",24,0)
 . D IX^DIC K DIC Q:Y<0  S FBDA=+Y
"RTN","FBAACLU",25,0)
 I FBFILE=162.7 D
"RTN","FBAACLU",26,0)
 . N FBARY,FBI,FBOUT
"RTN","FBAACLU",27,0)
 . D LOOKUP^FBUCUTL3(0)
"RTN","FBAACLU",28,0)
 . I 'FBOUT D
"RTN","FBAACLU",29,0)
 . . S FBI=$O(^TMP("FBARY",$J,0))
"RTN","FBAACLU",30,0)
 . . S:FBI FBDA=$P($G(^TMP("FBARY",$J,FBI)),";",1)
"RTN","FBAACLU",31,0)
 . K ^TMP("FBARY",$J)
"RTN","FBAACLU",32,0)
 I '$G(FBDA) G EXIT
"RTN","FBAACLU",33,0)
 ;
"RTN","FBAACLU",34,0)
 ; ask device
"RTN","FBAACLU",35,0)
 S %ZIS="Q" D ^%ZIS G:POP EXIT
"RTN","FBAACLU",36,0)
 I $D(IO("Q")) D  G EXIT
"RTN","FBAACLU",37,0)
 . N FBX
"RTN","FBAACLU",38,0)
 . N ZTRTN,ZTDESC,ZTDTH,ZTIO,ZTUCI,ZTCPU,ZTPRI,ZTSAVE,ZTKIL,ZTSYNC,ZTSK
"RTN","FBAACLU",39,0)
 . S ZTRTN="QEN^FBAACLU",ZTDESC="Fee Clerk Lookup"
"RTN","FBAACLU",40,0)
 . F FBX="FBFILE","FBDA*" S ZTSAVE(FBX)=""
"RTN","FBAACLU",41,0)
 . D ^%ZTLOAD,HOME^%ZIS
"RTN","FBAACLU",42,0)
 ;
"RTN","FBAACLU",43,0)
QEN ; queued entry point
"RTN","FBAACLU",44,0)
 ; inputs from Taskman
"RTN","FBAACLU",45,0)
 ;   ZTQUEUED - (optional) set by TaskMan to indicate report is tasked
"RTN","FBAACLU",46,0)
 ; outputs to Taskman
"RTN","FBAACLU",47,0)
 ;   ZTREQ - set when report is tasked
"RTN","FBAACLU",48,0)
 ;   ZTSTOP - set when report is tasked and job was stopped per request
"RTN","FBAACLU",49,0)
 ;
"RTN","FBAACLU",50,0)
 N %
"RTN","FBAACLU",51,0)
 ;
"RTN","FBAACLU",52,0)
 U IO
"RTN","FBAACLU",53,0)
 ;
"RTN","FBAACLU",54,0)
 S (FBQUIT,FBPG)=0 D NOW^%DTC S Y=% D DD^%DT S FBDTR=Y
"RTN","FBAACLU",55,0)
 K FBDL
"RTN","FBAACLU",56,0)
 S FBDL="",$P(FBDL,"-",80)=""
"RTN","FBAACLU",57,0)
 S FBDL("ED")="    "_$E(FBDL,1,21)_"  "_$E(FBDL,1,35)
"RTN","FBAACLU",58,0)
 ;
"RTN","FBAACLU",59,0)
 ; build page header text
"RTN","FBAACLU",60,0)
 I FBFILE=161.01 S FBHD="Clerk Lookup for an authorization"
"RTN","FBAACLU",61,0)
 I FBFILE=162.2 S FBHD="Clerk Lookup for a CH notification"
"RTN","FBAACLU",62,0)
 I FBFILE=162.4 S FBHD="Clerk Lookup for a 7078 authorization"
"RTN","FBAACLU",63,0)
 I FBFILE=162.7 S FBHD="Clerk Lookup for an unauthorized claim"
"RTN","FBAACLU",64,0)
 ;
"RTN","FBAACLU",65,0)
 ; determine which files to display
"RTN","FBAACLU",66,0)
 F FBX=161.01,162.2,162.4,162.7 S FBSHOW(FBX)=0 ; init FBSHOW(
"RTN","FBAACLU",67,0)
 S FBSHOW(FBFILE)=FBDA ; always show input file
"RTN","FBAACLU",68,0)
 I FBFILE=161.01 D
"RTN","FBAACLU",69,0)
 . S FBX=$P($G(^FBAAA(FBDA(1),1,FBDA,0)),U,9) ; ASSOC 7078/583
"RTN","FBAACLU",70,0)
 . I FBX["FB7078" S FBSHOW(162.4)=+FBX
"RTN","FBAACLU",71,0)
 . I FBX["FB583" S FBSHOW(162.7)=+FBX
"RTN","FBAACLU",72,0)
 I FBSHOW(162.4) D
"RTN","FBAACLU",73,0)
 . S FBX=$O(^FBAA(162.2,"AM",FBSHOW(162.4),0))
"RTN","FBAACLU",74,0)
 . I FBX S FBSHOW(162.2)=FBX
"RTN","FBAACLU",75,0)
 ;
"RTN","FBAACLU",76,0)
 ; display output
"RTN","FBAACLU",77,0)
 D HD
"RTN","FBAACLU",78,0)
 ;
"RTN","FBAACLU",79,0)
 ; show information for authorization
"RTN","FBAACLU",80,0)
 I 'FBQUIT,FBSHOW(161.01) D
"RTN","FBAACLU",81,0)
 . N FBDATA
"RTN","FBAACLU",82,0)
 . ; skip if no user audit data and either 7078 or unauthorized claim
"RTN","FBAACLU",83,0)
 . ;   (very similar information) will be shown later
"RTN","FBAACLU",84,0)
 . S FBDATA=$O(^FBAAA(FBDA(1),1,FBDA,"LOG1",0))
"RTN","FBAACLU",85,0)
 . I 'FBDATA,FBSHOW(162.4)!FBSHOW(162.7) Q
"RTN","FBAACLU",86,0)
 . ;
"RTN","FBAACLU",87,0)
 . S FBIENS=FBDA_","_FBDA(1)_","
"RTN","FBAACLU",88,0)
 . I $Y+6>IOSL D HD Q:FBQUIT
"RTN","FBAACLU",89,0)
 . W !!,"Authorization"
"RTN","FBAACLU",90,0)
 . W !,"Veteran: ",$$GET1^DIQ(161,FBDA(1)_",",.01)
"RTN","FBAACLU",91,0)
 . W ?40,"Vendor: ",$$GET1^DIQ(161.01,FBIENS,.04)
"RTN","FBAACLU",92,0)
 . W !,"Authorization Number: ",FBDA(1),"-",FBDA
"RTN","FBAACLU",93,0)
 . W !,"Authorized From Date: ",$$GET1^DIQ(161.01,FBIENS,.01)
"RTN","FBAACLU",94,0)
 . W ?40,"Authorized To Date: ",$$GET1^DIQ(161.01,FBIENS,.02)
"RTN","FBAACLU",95,0)
 . D DUA("^FBAAA("_FBDA(1)_",1,"_FBDA_",""LOG1"",")
"RTN","FBAACLU",96,0)
 ;
"RTN","FBAACLU",97,0)
 ; show information for 10-7078 authorization
"RTN","FBAACLU",98,0)
 I 'FBQUIT,FBSHOW(162.4) D
"RTN","FBAACLU",99,0)
 . N FBVEN
"RTN","FBAACLU",100,0)
 . S FBIENS=FBSHOW(162.4)_","
"RTN","FBAACLU",101,0)
 . I $Y+6>IOSL D HD Q:FBQUIT
"RTN","FBAACLU",102,0)
 . W !!,"10-7078 Authorization"
"RTN","FBAACLU",103,0)
 . W !,"Veteran: ",$$GET1^DIQ(162.4,FBIENS,2)
"RTN","FBAACLU",104,0)
 . S FBVEN=+$P($G(^FB7078(FBSHOW(162.4),0)),"^",2)
"RTN","FBAACLU",105,0)
 . W ?40,"Vendor: ",$$GET1^DIQ(161.2,FBVEN_",",.01)
"RTN","FBAACLU",106,0)
 . W !,"Reference Number: ",$$GET1^DIQ(162.4,FBIENS,.01)
"RTN","FBAACLU",107,0)
 . W ?40,"Fee Program: ",$$GET1^DIQ(162.4,FBIENS,.5)
"RTN","FBAACLU",108,0)
 . W !,"Authorized From Date: ",$$GET1^DIQ(162.4,FBIENS,3)
"RTN","FBAACLU",109,0)
 . W ?40,"Authorized To Date: ",$$GET1^DIQ(162.4,FBIENS,4)
"RTN","FBAACLU",110,0)
 . D DUA("^FB7078("_FBSHOW(162.4)_",""LOG1"",")
"RTN","FBAACLU",111,0)
 ;
"RTN","FBAACLU",112,0)
 ; show information for civil hospital notification
"RTN","FBAACLU",113,0)
 I 'FBQUIT,FBSHOW(162.2) D
"RTN","FBAACLU",114,0)
 . S FBIENS=FBSHOW(162.2)_","
"RTN","FBAACLU",115,0)
 . I $Y+6>IOSL D HD Q:FBQUIT
"RTN","FBAACLU",116,0)
 . W !!,"CH Notification"
"RTN","FBAACLU",117,0)
 . W !,"Date/Time: ",$$GET1^DIQ(162.2,FBIENS,.01)
"RTN","FBAACLU",118,0)
 . W !,"Veteran: ",$$GET1^DIQ(162.2,FBIENS,3)
"RTN","FBAACLU",119,0)
 . W ?40,"Vendor: ",$$GET1^DIQ(162.2,FBIENS,1)
"RTN","FBAACLU",120,0)
 . D DUA("^FBAA(162.2,"_FBSHOW(162.2)_",""LOG1"",")
"RTN","FBAACLU",121,0)
 ;
"RTN","FBAACLU",122,0)
 ; show information for unauthorized claim
"RTN","FBAACLU",123,0)
 I 'FBQUIT,FBSHOW(162.7) D
"RTN","FBAACLU",124,0)
 . S FBIENS=FBSHOW(162.7)_","
"RTN","FBAACLU",125,0)
 . I $Y+6>IOSL D HD Q:FBQUIT
"RTN","FBAACLU",126,0)
 . W !!,"Unauthorized Claim"
"RTN","FBAACLU",127,0)
 . W !,"Veteran: ",$$GET1^DIQ(162.7,FBIENS,2)
"RTN","FBAACLU",128,0)
 . W ?40,"Vendor: ",$$GET1^DIQ(162.7,FBIENS,1)
"RTN","FBAACLU",129,0)
 . W !,"Date Claim Received: ",$$GET1^DIQ(162.7,FBIENS,.01)
"RTN","FBAACLU",130,0)
 . W ?40,"Fee Program: ",$$GET1^DIQ(162.7,FBIENS,.5)
"RTN","FBAACLU",131,0)
 . W !,"Treatment From Date: ",$$GET1^DIQ(162.7,FBIENS,3)
"RTN","FBAACLU",132,0)
 . W ?40,"Treatment To Date: ",$$GET1^DIQ(162.7,FBIENS,4)
"RTN","FBAACLU",133,0)
 . D DUA("^FB583("_FBSHOW(162.7)_",""LOG1"",")
"RTN","FBAACLU",134,0)
 ;
"RTN","FBAACLU",135,0)
 I 'FBQUIT,$E(IOST,1,2)="C-" S DIR(0)="E" D ^DIR K DIR
"RTN","FBAACLU",136,0)
 D ^%ZISC
"RTN","FBAACLU",137,0)
 ;
"RTN","FBAACLU",138,0)
EXIT ;
"RTN","FBAACLU",139,0)
 I $D(ZTQUEUED) S ZTREQ="@"
"RTN","FBAACLU",140,0)
 K FBDA,FBDL,FBDT,FBDTR,FBHD,FBIENS,FBPG,FBSHOW,FBQUIT,FBX
"RTN","FBAACLU",141,0)
 K DIC,DIR,DIROUT,DIRUT,DTOUT,DUOUT,X,Y
"RTN","FBAACLU",142,0)
 Q
"RTN","FBAACLU",143,0)
 ;
"RTN","FBAACLU",144,0)
HD ; page header
"RTN","FBAACLU",145,0)
 N FBI
"RTN","FBAACLU",146,0)
 I $D(ZTQUEUED),$$S^%ZTLOAD S ZTSTOP=1,FBQUIT=1 Q
"RTN","FBAACLU",147,0)
 I $E(IOST,1,2)="C-",FBPG S DIR(0)="E" D ^DIR K DIR I 'Y S FBQUIT=1 Q
"RTN","FBAACLU",148,0)
 I $E(IOST,1,2)="C-"!FBPG W @IOF
"RTN","FBAACLU",149,0)
 S FBPG=FBPG+1
"RTN","FBAACLU",150,0)
 W FBHD,?49,FBDTR,?72,"page ",FBPG
"RTN","FBAACLU",151,0)
 W !,FBDL
"RTN","FBAACLU",152,0)
 Q
"RTN","FBAACLU",153,0)
 ;
"RTN","FBAACLU",154,0)
HDEDT(FBCONT) ; header for edited table
"RTN","FBAACLU",155,0)
 ; input
"RTN","FBAACLU",156,0)
 ;   FBCONT (optional) =1 when table continued after page break
"RTN","FBAACLU",157,0)
 W !!,?4,"Date/Time Edited",?27,"Edited By"
"RTN","FBAACLU",158,0)
 W:$G(FBCONT) " (continued)"
"RTN","FBAACLU",159,0)
 W !,FBDL("ED")
"RTN","FBAACLU",160,0)
 Q
"RTN","FBAACLU",161,0)
 ;
"RTN","FBAACLU",162,0)
DUA(FBROOT) ; display the user audit for a record in one of the supported files
"RTN","FBAACLU",163,0)
 N FBC,FBDT,FBI,FBTXT,FBUSR,FBY0
"RTN","FBAACLU",164,0)
 I $Y+6>IOSL D HD Q:FBQUIT
"RTN","FBAACLU",165,0)
 D HDEDT(0)
"RTN","FBAACLU",166,0)
 S (FBC,FBI)=0 F  S FBI=$O(@(FBROOT_FBI_")")) Q:'FBI  D  Q:FBQUIT
"RTN","FBAACLU",167,0)
 . S FBC=FBC+1
"RTN","FBAACLU",168,0)
 . S FBY0=$G(@(FBROOT_FBI_",0)"))
"RTN","FBAACLU",169,0)
 . S FBDT=$P(FBY0,"^")
"RTN","FBAACLU",170,0)
 . S FBUSR=$P(FBY0,"^",2)
"RTN","FBAACLU",171,0)
 . S FBTXT=$P(FBY0,"^",3)
"RTN","FBAACLU",172,0)
 . I $Y+4>IOSL D HD Q:FBQUIT  D HDEDT(1)
"RTN","FBAACLU",173,0)
 . W !
"RTN","FBAACLU",174,0)
 . W ?4,$S(FBDT:$$FMTE^XLFDT(FBDT),1:"")
"RTN","FBAACLU",175,0)
 . W ?27,$S(FBUSR:$$GET1^DIQ(200,FBUSR,.01),1:"")
"RTN","FBAACLU",176,0)
 . I FBTXT]"" W !,?6,"Comments: ",FBTXT
"RTN","FBAACLU",177,0)
 I FBC=0 W !,?4,"No information found in user audit"
"RTN","FBAACLU",178,0)
 Q
"RTN","FBAACLU",179,0)
 ;
"RTN","FBAACLU",180,0)
 ;FBAACLU
"RTN","FBAACO")
0^14^B49645560^B48482031
"RTN","FBAACO",1,0)
FBAACO ;AISC/GRR - ENTER MEDICAL PAYMENT ;9/25/2014
"RTN","FBAACO",2,0)
 ;;3.5;FEE BASIS;**4,61,79,116,122,133,108,135,123,154**;JAN 30, 1995;Build 12
"RTN","FBAACO",3,0)
 ;;Per VA Directive 6402, this routine should not be modified.
"RTN","FBAACO",4,0)
EN583 ;driver for opt payments (entry point for uc)
"RTN","FBAACO",5,0)
 K FBAAOUT,FBPOP
"RTN","FBAACO",6,0)
 D SITE G Q:$G(FBPOP) D BT G Q:$G(FBAAOUT)
"RTN","FBAACO",7,0)
1 K FBAAID,FBAAVID,FBAAOUT,FBDL,FBAAMM D SITE G Q:$G(FBPOP) S FBINTOT=0 W !!
"RTN","FBAACO",8,0)
 I '$D(FB583) K FBDL,FBAR D GETVET^FBAAUTL1 G EN583:'DFN K FBAAOUT,FBDMRA D GETAUTH^FBAAUTL1 G 1:FTP']""
"RTN","FBAACO",9,0)
 I '$$UOKPAY^FBUTL9(DFN,FTP) D  G 1
"RTN","FBAACO",10,0)
 . W !!,"You cannot process a payment associated with authorization ",DFN,"-",FTP
"RTN","FBAACO",11,0)
 . W !,"due to separation of duties."
"RTN","FBAACO",12,0)
 K FBAAOUT
"RTN","FBAACO",13,0)
 I $G(FBCHCO) S FB7078=$S($G(FB7078):FB7078_";FB7078(",$D(FB583):FB583_";FB583(",1:"")
"RTN","FBAACO",14,0)
 D:FBAAPTC="R" ^FBAACO0
"RTN","FBAACO",15,0)
 D PAT,GETVEN1^FBAACO1:$D(FB583),GETVEN^FBAACO1:'$D(FB583) I $G(FBAAOUT) G Q:$D(FB583),1
"RTN","FBAACO",16,0)
 W !! D FILEV^FBAACO5(DFN,FBV) I $G(FBAAOUT) G Q:$D(FB583),1
"RTN","FBAACO",17,0)
 ;check for payments against all linked vendors
"RTN","FBAACO",18,0)
 S DA=+Y D CHK^FBAACO4 K FBAACK1,FBAAOUT,DA,X,Y
"RTN","FBAACO",19,0)
 K FBAAID,FBAAVID D GETINV^FBAACO1 I $G(FBAAOUT) Q:$D(FBCHCO)  G Q:$D(FB583),1
"RTN","FBAACO",20,0)
 I '$D(FBAAID)!('$D(FBAAVID)) D GETINDT^FBAACO1 I $G(FBAAOUT) D OUT G Q:$D(FB583),1:'$D(FBCHCO) Q
"RTN","FBAACO",21,0)
 ;
"RTN","FBAACO",22,0)
 ; FB*3.5*123 - check for IPAC agreement for Federal vendor and capture DoD invoice number (both req'd if IPAC)
"RTN","FBAACO",23,0)
 S FBDODINV=""
"RTN","FBAACO",24,0)
 S FBIA=$$IPAC^FBAAMP(FBV) I FBIA=-1 S FBAAOUT=1 D OUT G Q:$D(FB583),1:'$D(FBCHCO) Q
"RTN","FBAACO",25,0)
 I FBIA,'$$IPACINV^FBAAMP(.FBDODINV) S FBAAOUT=1 D OUT G Q:$D(FB583),1:'$D(FBCHCO) Q
"RTN","FBAACO",26,0)
 ;
"RTN","FBAACO",27,0)
 ; ask patient account number
"RTN","FBAACO",28,0)
 S FBCSID=$$ASKPAN^FBUTL5() I FBCSID="^" K FBCSID S FBAAOUT=1 D OUT G Q:$D(FB583),1:'$D(FBCHCO) Q
"RTN","FBAACO",29,0)
 ; if U/C then get FPPS Claim ID else ask user
"RTN","FBAACO",30,0)
 I $D(FB583) S FBFPPSC=$P($G(^FB583(FB583,5)),U) W !,"FPPS CLAIM ID: ",$S(FBFPPSC="":"N/A",1:FBFPPSC)
"RTN","FBAACO",31,0)
 E  S FBFPPSC=$$FPPSC^FBUTL5() I FBFPPSC=-1 K FBFPPSC S FBAAOUT=1 D OUT G Q:$D(FB583),1:'$D(FBCHCO) Q
"RTN","FBAACO",32,0)
 ;
"RTN","FBAACO",33,0)
 S FBUCI135=$$ENTROUTP^FBUTL136(DFN,FBV,FBAAVID,FBFPPSC)                   ; Enter UCID FB3.5*135
"RTN","FBAACO",34,0)
 I FBUCI135<1 K FBFPPSC S FBAAOUT=1 D OUT G Q:$D(FB583),1:'$D(FBCHCO) Q    ; Enter UCID FB3.5*135
"RTN","FBAACO",35,0)
 ;
"RTN","FBAACO",36,0)
 G 1^FBAAMP:$G(FBMP) D MM G Q:$G(FBAAOUT)
"RTN","FBAACO",37,0)
SVDT K FBAAOUT,HOLDY W !! D GETSVDT^FBAACO5(DFN,FBV,FBASSOC,1) I $G(FBAAOUT) K FBAADT,FBX,FBAACP W:FBINTOT>0 !!,"Invoice: "_FBAAIN_" Totals $ "_$J(FBINTOT,1,2) G Q:$D(FB583)!($G(FBCHCO)),1
"RTN","FBAACO",38,0)
 D SETO^FBAACO3,DISPINV^FBAACO1
"RTN","FBAACO",39,0)
 W ! D ASKZIP^FBAAFS($G(FBV),$G(FBAADT))
"RTN","FBAACO",40,0)
 I $G(FBAAOUT)!(FBZIP']"") D DEL^FBAACO3 G SVDT
"RTN","FBAACO",41,0)
CPT K FBAAOUT W !
"RTN","FBAACO",42,0)
 D CPTM^FBAALU($G(FBAADT),$G(DFN)) I 'FBGOT D DEL^FBAACO3 G SVDT
"RTN","FBAACO",43,0)
 D CHK2^FBAACO4 I FBJ']"" G SVPR
"RTN","FBAACO",44,0)
CHKE ;determines what action to take on duplicate services entered
"RTN","FBAACO",45,0)
 K FBAAOUT W !!,*7,"Service selected for that date already in system."
"RTN","FBAACO",46,0)
 S DIR(0)="Y",DIR("A")="Do you want to add another service for the SAME DATE",DIR("B")="No" D ^DIR K DIR G Q:$D(DIRUT),SVPR:Y
"RTN","FBAACO",47,0)
 I FBJ]"",FBJ'=FBV W !!,*7,"You must use the 'EDIT PAYMENT' option to edit the service previously",!,"entered for that date." D DEL^FBAACO3 G SVDT
"RTN","FBAACO",48,0)
 S DIR(0)="Y",DIR("A")="Want to edit it",DIR("B")="No" D ^DIR K DIR G Q:$D(DIRUT) I Y D DOEDIT^FBAACO3 G SVDT:'$D(FBDL)!($G(FBAAOUT)),Q:$D(FB583),1
"RTN","FBAACO",49,0)
 D ^FBAACO2 G CPT:'$G(FBDEN)
"RTN","FBAACO",50,0)
SVPR K FBAAOUT
"RTN","FBAACO",51,0)
 I $$ANES^FBAAFS($$CPT^FBAAUTL4($G(FBAACP))) D ASKTIME^FBAAFS I $G(FBAAOUT)!'$G(FBTIME) G CPT
"RTN","FBAACO",52,0)
 D SVCPR^FBAACO1 G CPT:$G(FBAAOUT)
"RTN","FBAACO",53,0)
 S FBAMTPD=0 D FILE^FBAACO2 I $D(FBAAOUT) G Q:$D(FB583),1:$D(FBDL),Q ;FB*3.5*133 removed provider field save
"RTN","FBAACO",54,0)
 D OUT^FBAACO3 W:Z1>(FBAAMPI-20) !,*7,"Warning, you can only enter ",(FBAAMPI-Z1)," more line(s)!" G CPT:Z1'>(FBAAMPI-1) D WARN^FBAACO3 G EN583
"RTN","FBAACO",55,0)
 G 1
"RTN","FBAACO",56,0)
 ;
"RTN","FBAACO",57,0)
Q ;exit point for outpatient payment routines
"RTN","FBAACO",58,0)
 K FBAAPTC,DIC,Y,A,I,DFN,BO,DA,DI,DQ,DR,E,FBAABDT,FBAABE,FBFY,FBDL,FBAAID,FBAAIN,FBAAMPI,FBAAOPA,FBAAPN,FBCONT,FBDX,FBGOT,FBPOV,FBPT,DLAYGO,FBPSA,FBASSOC,FBZBN,FBZBS,FBDEN,FBV,FBSDI,FBAACPI,FBAACP,FBX,FBLOCK
"RTN","FBAACO",59,0)
 K FBSP,FBTPD,FBTT,FBTYPE,FTP,FBDEL,FY,FBINTOT,G,H,MAJN,NO,PI,Q,R,SUB,SUBN,TA,TP,UL,W,X1,Z,Z1,ZZ,FBAADT,K,L,J,FBTOV,FBPARCD,FBT,FEEO,Z2,FBSITE,FBAUT,T,FBLOC,FBSSN,FBVEN,FBD1,Z0,FB583
"RTN","FBAACO",60,0)
 K A1,A2,B1,B2,DAT,DIE,FBAACPT,FBAMTPD,FBAAEDT,FBAAOUT,FBAAPD,FBI,FBIN,FBPROG,FBRR,FBXX,PTYPE,S,VAL,X,V,ZS,FB7078,FBFDC,FBCOUNTY,FBMST,FBTTYPE,FBTV,HY,FBDMRA,DIRUT,FBPOP,FBJ,FBAACK1,FBAR,FBDA,FBST
"RTN","FBAACO",61,0)
 K FBMP,FBK,FBAAAS,%DT,FBDT,FBMAX,FBAMFS,FBAASC,FBHCFA,FBSI,FBCNP,FBAAAMT,FBAAVID,FBAAMM,FBAAMM1,VAPA,FBZX,FBTST,HOLDY,FBAOT
"RTN","FBAACO",62,0)
 K FBCSID,FBFPPSC,FBFPPSL,FBADJ,FBADJD,FBADJL,FBRRMK,FBRRMKD,FBRRMKL,FBUNITS,FBCNTRP,FBUCI135,FBIA,FBDODINV
"RTN","FBAACO",63,0)
AUTHQ K DIC,DFN,CNT,FB7078,FBAABDT,FBAAEDT,FBAAOUT,FBASSOC,FBAUT,FBPOV,FBPROG,FBPSA,FBPT,FBTT,FBTYPE,FBVEN,FBTP,PI,TA,FBMOD,FBMODA,FBZIP,FBTIME,FBFSAMT,FBFSUSD
"RTN","FBAACO",64,0)
 D GETAUTHK^FBAAUTL1
"RTN","FBAACO",65,0)
 Q
"RTN","FBAACO",66,0)
 ;
"RTN","FBAACO",67,0)
SITE ;set up site variables
"RTN","FBAACO",68,0)
 D:'$D(FBSITE(0)) SITEP^FBAAUTL Q:$G(FBPOP)  I '$G(FBPROG) D
"RTN","FBAACO",69,0)
 .I $G(FBCHCO) S FBPROG="I ($P(^(0),""^"",3)=6!($P(^(0),""^"",3)=7))&($P(^(0),U,9)'[""FB583"")" Q
"RTN","FBAACO",70,0)
 .S FBPROG=$S($P(FBSITE(1),"^",6)="":"I $P(^(0),""^"",9)'[""FB583""",1:"I $P(^(0),""^"",3)=2,($P(^(0),""^"",9)'[""FB583"")")
"RTN","FBAACO",71,0)
 S:'$D(FBAAPTC) FBAAPTC="V"
"RTN","FBAACO",72,0)
 S FBAAMPI=$P($G(^FBAA(161.4,1,"FBNUM")),"^",3),FBAAMPI=$S(FBAAMPI]"":FBAAMPI,1:100)
"RTN","FBAACO",73,0)
 Q
"RTN","FBAACO",74,0)
 ;
"RTN","FBAACO",75,0)
BT ;select batch
"RTN","FBAACO",76,0)
 S DIC="^FBAA(161.7,",DIC(0)="AEQM",DIC("S")="I $P(^(0),U,3)=""B3""&($G(^(""ST""))=""O"")&(($P(^(0),U,5)=DUZ)!($D(^XUSEC(""FBAA LEVEL 2"",DUZ))))",DIC("W")="W !,""  Obligation #: "",$P(^(0),U,2)" W !! D ^DIC K DIC I X["^"!(X="") S FBAAOUT=1 Q
"RTN","FBAACO",77,0)
 G BT:Y<0 S (DA,FBAABE)=+Y,Y(0)=^FBAA(161.7,DA,0)
"RTN","FBAACO",78,0)
 I $P(Y(0),"^",11)>(FBAAMPI-1) W !!,"This Batch already has the maximum number of Payments!" G BT
"RTN","FBAACO",79,0)
 S Z1=$P(Y(0),"^",11),FB7078="",BO=$P(^FBAA(161.7,DA,0),"^",2)
"RTN","FBAACO",80,0)
 Q
"RTN","FBAACO",81,0)
PAT ;set up patient in patient file
"RTN","FBAACO",82,0)
 ;required input variable DFN
"RTN","FBAACO",83,0)
 I '$D(^FBAAC(DFN,0)) K DD,DO S (X,DINUM)=DFN,DIC(0)="L",DLAYGO=162,DIC="^FBAAC(" D FILE^DICN K DLAYGO,DIC,DINUM,DD,DO,DA
"RTN","FBAACO",84,0)
 Q
"RTN","FBAACO",85,0)
MM ;check for money management of entire invoice
"RTN","FBAACO",86,0)
 ; fb*3.5*116
"RTN","FBAACO",87,0)
 D MMPPT
"RTN","FBAACO",88,0)
 Q
"RTN","FBAACO",89,0)
OUT K FBAADT,FBX,FBAACP W:FBINTOT>0 !!,"Invoice: "_FBAAIN_" Totals $ "_$J(FBINTOT,1,2) Q
"RTN","FBAACO",90,0)
 ;
"RTN","FBAACO",91,0)
MMPPT ;money management/prompt pay type for multiple payment entry
"RTN","FBAACO",92,0)
 ; input
"RTN","FBAACO",93,0)
 ;   FBAAPTC = payment type code, "R" when patient reimbursement
"RTN","FBAACO",94,0)
 ;   FBV     = vendor being paid (ien)
"RTN","FBAACO",95,0)
 ;   when called from FBAAMP additional variables will be available
"RTN","FBAACO",96,0)
 ;     FBCNTRA = contract ien from authorization
"RTN","FBAACO",97,0)
 ;     FBVEN   = vendor from authorization
"RTN","FBAACO",98,0)
 ;     FB583   = defined when unauthorized claim
"RTN","FBAACO",99,0)
 ; output
"RTN","FBAACO",100,0)
 ;   FBAAMM  = prompt payment, =1 to ask
"RTN","FBAACO",101,0)
 ;   FBAAMM1 = prompt payment type for line
"RTN","FBAACO",102,0)
 ;   FBAAOUT = (optional), = 1 to quit
"RTN","FBAACO",103,0)
 ;   FBCNTRP = contract for line item (ien)
"RTN","FBAACO",104,0)
 ;
"RTN","FBAACO",105,0)
 S (FBAAMM,FBAAMM1,FBCNTRP)=""
"RTN","FBAACO",106,0)
 I $G(FBAAPTC)'="R",'$D(FB583) D
"RTN","FBAACO",107,0)
 . ;
"RTN","FBAACO",108,0)
 . ; check if contract required by authorization
"RTN","FBAACO",109,0)
 . I '$D(FB583),$$UCFA^FBUTL7($G(FBV),$G(FBVEN),$G(FBCNTRA)) D  Q
"RTN","FBAACO",110,0)
 . . W !,"All lines items on this invoice will be considered as contracted services"
"RTN","FBAACO",111,0)
 . . W !,"under Contract ",$P($G(^FBAA(161.43,FBCNTRA,0)),U)," from the authorization."
"RTN","FBAACO",112,0)
 . . S (FBAAMM,FBAAMM1)=1
"RTN","FBAACO",113,0)
 . . S FBCNTRP=FBCNTRA
"RTN","FBAACO",114,0)
 . ;
"RTN","FBAACO",115,0)
 . ; when not forced by authorization ask if contracted service
"RTN","FBAACO",116,0)
 . W !,"The answer to the following will apply to all payments entered via this option."
"RTN","FBAACO",117,0)
 . S DIR(0)="Y"
"RTN","FBAACO",118,0)
 . S DIR("A")="Are payments for contracted services"
"RTN","FBAACO",119,0)
 . S DIR("B")="No"
"RTN","FBAACO",120,0)
 . S DIR("?",1)="Answering no indicates interest will not be paid for any line items."
"RTN","FBAACO",121,0)
 . S DIR("?",2)="Answering yes indicates interest will be paid."
"RTN","FBAACO",122,0)
 . S DIR("?",3)="A fee schedule is not used for contracted services."
"RTN","FBAACO",123,0)
 . S DIR("?")="Enter either 'Y' or 'N'."
"RTN","FBAACO",124,0)
 . D ^DIR K DIR I $D(DIRUT) S FBAAOUT=1 Q
"RTN","FBAACO",125,0)
 . S (FBAAMM,FBAAMM1)=$S(Y:1,1:"")
"RTN","FBAACO",126,0)
 . Q:FBAAMM1=""
"RTN","FBAACO",127,0)
 . ;
"RTN","FBAACO",128,0)
 . ; if contracted service, ask contract
"RTN","FBAACO",129,0)
 . S DIR(0)="PO^161.43:AQEM"
"RTN","FBAACO",130,0)
 . S DIR("A")="CONTRACT"
"RTN","FBAACO",131,0)
 . S DIR("?",1)="If the line item is under a contract then select it."
"RTN","FBAACO",132,0)
 . S DIR("?")="Contract must be active and applicable for the vendor."
"RTN","FBAACO",133,0)
 . S DIR("S")="I $P($G(^(0)),""^"",2)'=""I"",$$VCNTR^FBUTL7($G(FBV),+Y)"
"RTN","FBAACO",134,0)
 . D ^DIR K DIR I $D(DTOUT)!$D(DUOUT) S FBAAOUT=1 Q
"RTN","FBAACO",135,0)
 . S:Y>0 FBCNTRP=+Y
"RTN","FBAACO",136,0)
 Q
"RTN","FBAACO",137,0)
 ;
"RTN","FBAACO0")
0^15^B30569706^B34388675
"RTN","FBAACO0",1,0)
FBAACO0 ;AISC/GRR - DISPLAY PATIENT ADDRESS DATA AND EDIT ;10/16/14  15:39
"RTN","FBAACO0",2,0)
 ;;3.5;FEE BASIS;**4,38,52,57,61,75,70,143,154**;JAN 30, 1995;Build 12
"RTN","FBAACO0",3,0)
 ;;Per VA Directive 6402, this routine should not be modified.
"RTN","FBAACO0",4,0)
 S FBMST=$S(FBTT=1:"Y",1:""),FBTTYPE="A",FBFDC=""
"RTN","FBAACO0",5,0)
 N FBEDPTAD S (FBEDPTAD(1),FBEDPTAD(2))=0
"RTN","FBAACO0",6,0)
 W @IOF,"Patient:  ",$P(^DPT(DFN,0),"^") S (Y(0),HY(0))=$G(^DPT(DFN,.11)) I Y(0)="" W !,*7,"No Address information for this patient!" G EDIT
"RTN","FBAACO0",7,0)
 S VAPA("P")="" D ADD^VADPT
"RTN","FBAACO0",8,0)
 S FBEDPTAD(1)=$$ISCCADR()
"RTN","FBAACO0",9,0)
 S FBEDPTAD(2)="N"
"RTN","FBAACO0",10,0)
 I $$CCADR(2)
"RTN","FBAACO0",11,0)
 W !!,"Patient's Permanent address:"
"RTN","FBAACO0",12,0)
 F Z=1:1:3 I VAPA(Z)]"" W !?2,"Address Line ",Z,":",?18,VAPA(Z)
"RTN","FBAACO0",13,0)
 W !?2,"City:",?18,VAPA(4),!?2,"State:",?18,$P(VAPA(5),U,2)
"RTN","FBAACO0",14,0)
 W !?2,"Zip:",?18,$S(+$G(VAPA(11)):$P(VAPA(11),U,2),1:VAPA(6)),!?2,"County",?18,$P(VAPA(7),U,2)
"RTN","FBAACO0",15,0)
 K VAPA,VAERR
"RTN","FBAACO0",16,0)
RD W ! S DIR("A")="Want to edit Permanent Address data",DIR("B")="No",DIR(0)="Y" D ^DIR K DIR  S:Y&('$D(DIRUT)) FBEDPTAD(2)="Y" G EDIT
"RTN","FBAACO0",17,0)
 Q
"RTN","FBAACO0",18,0)
EDIT I $G(FBEDPTAD(2))'="N" W !! S HY(0)=$G(^DPT(DFN,.11)) D EN^DGREGAED(DFN)
"RTN","FBAACO0",19,0)
 I $$EDTCCADR()=0 I FBTT'=1 I FBEDPTAD(2)="N" Q
"RTN","FBAACO0",20,0)
MRA I FBTT=1!($G(^DPT(DFN,.11))'=$G(HY(0))) S FBD1=FTP D ENT^FBAAAUT K FBD1
"RTN","FBAACO0",21,0)
 Q
"RTN","FBAACO0",22,0)
FEE ;calculates amount paid based on fee schedule
"RTN","FBAACO0",23,0)
 N FB1725
"RTN","FBAACO0",24,0)
 ; set FB1725 flag = true if payment for a 38 U.S.C. 1725 claim
"RTN","FBAACO0",25,0)
 S FB1725=$S($G(FB583):+$P($G(^FB583(+FB583,0)),U,28),1:0)
"RTN","FBAACO0",26,0)
 S FBFY=FY-1
"RTN","FBAACO0",27,0)
 S (FBFSAMT,FBFSUSD)="",FBAMTPD=$S($G(FBAMTPD)>0:FBAMTPD,1:"")
"RTN","FBAACO0",28,0)
 ; if amount not passed then use fee schedule
"RTN","FBAACO0",29,0)
 I '$G(FBAMTPD) D
"RTN","FBAACO0",30,0)
 . N FBX
"RTN","FBAACO0",31,0)
 .; FB*3.5*143 Adding FB1725 as a parameter to prevent incorrect
"RTN","FBAACO0",32,0)
 .; reductions in local fee schedule pricing.
"RTN","FBAACO0",33,0)
 . S FBX=$$GET^FBAAFS($$CPT^FBAAUTL4(FBAACP),$$MODL^FBAAUTL4("FBMODA","E"),FBAADT,$G(FBZIP),$$FAC^FBAAFS($G(FBHCFA(30))),$G(FBTIME),$G(FB1725))
"RTN","FBAACO0",34,0)
 . ;
"RTN","FBAACO0",35,0)
 . I '$G(FBAAMM1) D
"RTN","FBAACO0",36,0)
 . . S FBFSAMT=$P(FBX,U),FBFSUSD=$P(FBX,U,2)
"RTN","FBAACO0",37,0)
 . E  W !?2,"Payment is for a contracted service so fee schedule does not apply."
"RTN","FBAACO0",38,0)
 . ;
"RTN","FBAACO0",39,0)
 . I $P($G(FBX),U)]"" D
"RTN","FBAACO0",40,0)
 . . W !?2,$S($G(FBAAMM1):"However, f",1:"F")
"RTN","FBAACO0",41,0)
 . . W "ee schedule amount is $",$P(FBX,U)," from the "
"RTN","FBAACO0",42,0)
 . . W:$P(FBX,U,3)]"" $P(FBX,U,3)," " ; year if returned
"RTN","FBAACO0",43,0)
 . . W:$P(FBX,U,2)]"" $$EXTERNAL^DILFD(162.03,45,"",$P(FBX,U,2))
"RTN","FBAACO0",44,0)
 . E  W !?2,"Unable to determine a FEE schedule amount."
"RTN","FBAACO0",45,0)
 . ;
"RTN","FBAACO0",46,0)
 . ; FB*3.5*143 - Preventing 70% reduction of 75th percentile rates
"RTN","FBAACO0",47,0)
 . I FB1725,FBFSUSD'="F" D
"RTN","FBAACO0",48,0)
 . . W !!?2,"**Payment is for emergency treatment under 38 U.S.C. 1725."
"RTN","FBAACO0",49,0)
 . . I FBFSAMT D
"RTN","FBAACO0",50,0)
 . . . S FBFSAMT=$J(FBFSAMT*.7,0,2)
"RTN","FBAACO0",51,0)
 . . . W !?2,"  Therefore, fee schedule amount reduced to $",FBFSAMT," (70%)."
"RTN","FBAACO0",52,0)
 . ;
"RTN","FBAACO0",53,0)
 . I $G(FBUNITS)>1 D
"RTN","FBAACO0",54,0)
 . . W !!?2,"Units Paid = ",FBUNITS
"RTN","FBAACO0",55,0)
 . . Q:FBFSAMT'>0
"RTN","FBAACO0",56,0)
 . . N FBFSUNIT
"RTN","FBAACO0",57,0)
 . . ; determine if fee schedule can be multiplied by units
"RTN","FBAACO0",58,0)
 . . S FBFSUNIT=$S(FBFSUSD="R":1,FBFSUSD="F"&(FBAADT>3040930):1,1:0)
"RTN","FBAACO0",59,0)
 . . I FBFSUNIT D
"RTN","FBAACO0",60,0)
 . . . S FBFSAMT=$J(FBFSAMT*FBUNITS,0,2)
"RTN","FBAACO0",61,0)
 . . . W !?2,"  Therefore, fee schedule amount increased to $",FBFSAMT
"RTN","FBAACO0",62,0)
 . . E  D
"RTN","FBAACO0",63,0)
 . . . W !?2,"  Fee schedule not complied on per unit basis so amount not adjusted for units."
"RTN","FBAACO0",64,0)
 . ;
"RTN","FBAACO0",65,0)
 . I '$G(FBAAMM1) D
"RTN","FBAACO0",66,0)
 . . ; set default amount paid to lesser of amt claimed (J) or fee sched.
"RTN","FBAACO0",67,0)
 . . S FBAMTPD=$S(FBFSAMT>J:J,FBFSAMT>0:FBFSAMT,1:"")
"RTN","FBAACO0",68,0)
 . ;
"RTN","FBAACO0",69,0)
 . W !
"RTN","FBAACO0",70,0)
 ;
"RTN","FBAACO0",71,0)
AMTPD W !,"AMOUNT PAID: "_$S(FBAMTPD]"":FBAMTPD_"//",1:"") R X:DTIME S:X="" X=FBAMTPD G KILL:$E(X)="^",HELPPD:$E(X,1,2)="??",HELP1:$E(X)="?" S X=$TR(X,"$") I +X'=X&(X'?.N.1".".2N)!(X>999999)!(X<0) G HELP1
"RTN","FBAACO0",72,0)
 S FBAMTPD=X Q
"RTN","FBAACO0",73,0)
KILL W !!,*7,"Entering an '^' will delete this payment!" R !,?5,"Do you want to delete? No//",X:DTIME S:X="" X="N" D VALCK^FBAAUTL1 G KILL:'VAL,AMTPD:"Nn"[$E(X)
"RTN","FBAACO0",74,0)
 S DIK="^FBAAC("_DA(3)_",1,"_DA(2)_",1,"_DA(1)_",1," D WAIT^DICD,^DIK W !,?3,"<DELETED>" K DA,J,K,DIC,DIK,FBAACP,FBAADT,FBX S Y=0,FBDL=1 Q
"RTN","FBAACO0",75,0)
HELP1 W !!,"Enter the amount to pay in dollars and cents between 0 and 999999.",!,"Entering an '^' will delete the payment.",!
"RTN","FBAACO0",76,0)
 G AMTPD
"RTN","FBAACO0",77,0)
HELPPD W !!,"The amount that the VA is going to pay for this service provided.",! G AMTPD
"RTN","FBAACO0",78,0)
 Q
"RTN","FBAACO0",79,0)
 ;print Confidential Communication address
"RTN","FBAACO0",80,0)
 ;ADD^VADPT must be invoked before this call
"RTN","FBAACO0",81,0)
 ;FBDFN -patient's DFN
"RTN","FBAACO0",82,0)
 ;FBSTPOS - position to start print
"RTN","FBAACO0",83,0)
 ;returns 0 if there is no active CC address
"RTN","FBAACO0",84,0)
 ;returns 1 if active
"RTN","FBAACO0",85,0)
CCADR(FBSTPOS) ;
"RTN","FBAACO0",86,0)
 N FBACT
"RTN","FBAACO0",87,0)
 S FBACT=0
"RTN","FBAACO0",88,0)
 I '$D(VAPA(12)) Q 0  ;if D ADD^VADPT was not invoked before
"RTN","FBAACO0",89,0)
 I 'VAERR D
"RTN","FBAACO0",90,0)
 . S FBACT=$$ACTIVECC()
"RTN","FBAACO0",91,0)
 . Q:'FBACT
"RTN","FBAACO0",92,0)
 . W !!,"Confidential Communication address until: "_$P($G(VAPA(21)),U,2)
"RTN","FBAACO0",93,0)
 . I $G(VAPA(13))]"" W !?FBSTPOS,"Line 1: ",$G(VAPA(13))
"RTN","FBAACO0",94,0)
 . I $G(VAPA(14))]"" W " Line 2: ",$G(VAPA(14))
"RTN","FBAACO0",95,0)
 . I $G(VAPA(15))]"" W !?FBSTPOS,"Line 3: ",$G(VAPA(15))
"RTN","FBAACO0",96,0)
 . W !?FBSTPOS,"City:",?9,$S($G(VAPA(16))]"":$G(VAPA(16)),1:"     ")
"RTN","FBAACO0",97,0)
 . W ?40,"State:",?47,$S($P($G(VAPA(17)),U,2)]"":$P($G(VAPA(17)),U,2),1:"  ")
"RTN","FBAACO0",98,0)
 . W !?FBSTPOS,"Zip:",?9,$P($G(VAPA(18)),U,2)
"RTN","FBAACO0",99,0)
 . W ?20,"County:",?28,$P($G(VAPA(19)),U,2)
"RTN","FBAACO0",100,0)
 Q $G(FBACT)
"RTN","FBAACO0",101,0)
 ;
"RTN","FBAACO0",102,0)
 ;is called after ADD^VADPT to verify whether confidential address is 
"RTN","FBAACO0",103,0)
 ;active or not to encapsulate the logic related to status of CC address
"RTN","FBAACO0",104,0)
 ;input:  VAPA
"RTN","FBAACO0",105,0)
ACTIVECC() ;
"RTN","FBAACO0",106,0)
 Q (+$G(VAPA(12))=1)&($P($G(VAPA(22,3)),"^",3)="Y")
"RTN","FBAACO0",107,0)
 ;
"RTN","FBAACO0",108,0)
 ;edit confidential address
"RTN","FBAACO0",109,0)
 ;returns 1 if CC address has been edited
"RTN","FBAACO0",110,0)
 ;otherwise - 0
"RTN","FBAACO0",111,0)
EDTCCADR() ;
"RTN","FBAACO0",112,0)
 Q:'$G(DFN) 0
"RTN","FBAACO0",113,0)
 I FBEDPTAD(1)=0 D
"RTN","FBAACO0",114,0)
 . N VAPA S VAPA("P")="" D ADD^VADPT S FBEDPTAD(1)=$$ISCCADR()
"RTN","FBAACO0",115,0)
 I FBEDPTAD(1)'="N" D
"RTN","FBAACO0",116,0)
 . W:FBEDPTAD(1)'="B" !!,"WARNING: The Confidential address is NOT active for the Billing Category."
"RTN","FBAACO0",117,0)
 . S DIR("A")="Want to edit Confidential Address data"
"RTN","FBAACO0",118,0)
 E  S DIR("A")="Want to add Confidential Address data"
"RTN","FBAACO0",119,0)
 W ! S DIR("B")="No",DIR(0)="Y"
"RTN","FBAACO0",120,0)
 D ^DIR K DIR
"RTN","FBAACO0",121,0)
 Q:($D(DIRUT)) 0
"RTN","FBAACO0",122,0)
 ;Registration API
"RTN","FBAACO0",123,0)
 I Y D QUES^DGRPU1(+DFN,"ADD4") Q 1
"RTN","FBAACO0",124,0)
 Q 0
"RTN","FBAACO0",125,0)
 ;
"RTN","FBAACO0",126,0)
 ;returns "B" if patient has any (active or inactive) CC address and billing category
"RTN","FBAACO0",127,0)
 ;returns "Y" if patient has any (active or inactive) CC address with another category
"RTN","FBAACO0",128,0)
 ;otherwise returns "N"
"RTN","FBAACO0",129,0)
ISCCADR() ;
"RTN","FBAACO0",130,0)
 Q:($P($G(VAPA(22,3)),"^",3)="Y") "B"
"RTN","FBAACO0",131,0)
 Q:'$O(VAPA(22,0)) "N"
"RTN","FBAACO0",132,0)
 Q "Y"
"RTN","FBAACO0",133,0)
 ;
"RTN","FBAACO0",134,0)
 ;FBAACO0
"RTN","FBAACO1")
0^63^B50176519^B49387409
"RTN","FBAACO1",1,0)
FBAACO1 ;AISC/GRR - ENTER PAYMENT CONTINUED ;5/12/2014
"RTN","FBAACO1",2,0)
 ;;3.5;FEE BASIS;**4,61,77,108,124,154**;JAN 30, 1995;Build 12
"RTN","FBAACO1",3,0)
 ;;Per VA Directive 6402, this routine should not be modified.
"RTN","FBAACO1",4,0)
SVCPR ;set up service provided multiple
"RTN","FBAACO1",5,0)
 ; input FBASSOC (auth ptr,0 if not known)
"RTN","FBAACO1",6,0)
 I '$D(^FBAAC(DFN,1,FBV,1,FBSDI,1,0)) S ^FBAAC(DFN,1,FBV,1,FBSDI,1,0)="^162.03A^0^0"
"RTN","FBAACO1",7,0)
 W ! S DLAYGO=162,DIC="^FBAAC("_DFN_",1,"_FBV_",1,"_FBSDI_",1,",DIC(0)=$S($G(FBCNP):"QL",1:"EQL"),X=""""_FBX_"""",DA(3)=DFN,DA(2)=FBV,DA(1)=FBSDI
"RTN","FBAACO1",8,0)
 D
"RTN","FBAACO1",9,0)
 . N ICPTVDT S ICPTVDT=$G(FBAADT) D ^DIC
"RTN","FBAACO1",10,0)
 K DIC,DLAYGO,DA I Y<0 S FBAAOUT=1 Q
"RTN","FBAACO1",11,0)
 S (FBAACPI,DA)=+Y
"RTN","FBAACO1",12,0)
 ;
"RTN","FBAACO1",13,0)
 ; update zip code, anesthesia time, and authorization pointer
"RTN","FBAACO1",14,0)
 S DIE="^FBAAC("_DFN_",1,"_FBV_",1,"_FBSDI_",1,"
"RTN","FBAACO1",15,0)
 K DA S DA(3)=DFN,DA(2)=FBV,DA(1)=FBSDI,DA=FBAACPI
"RTN","FBAACO1",16,0)
 S DR="42////^S X=$G(FBZIP);43////^S X=$G(FBTIME)"
"RTN","FBAACO1",17,0)
 S:$G(FBASSOC)>0 DR=DR_";15.5////^S X=FBASSOC"
"RTN","FBAACO1",18,0)
 D ^DIE K DIE,DA,DR
"RTN","FBAACO1",19,0)
 ;
"RTN","FBAACO1",20,0)
 ; create CPT MODIFIER entries from data in array FBMODA
"RTN","FBAACO1",21,0)
 D REPMOD^FBAAUTL4(DFN,FBV,FBSDI,FBAACPI)
"RTN","FBAACO1",22,0)
 ;
"RTN","FBAACO1",23,0)
 Q
"RTN","FBAACO1",24,0)
 ;
"RTN","FBAACO1",25,0)
PPT(FBDEF,FBDEFC,FB162) ;establishes prompt pay type and contract for entry
"RTN","FBAACO1",26,0)
 ; input
"RTN","FBAACO1",27,0)
 ;   FBDEF  = (optional) default for DIR prompt: =1 for yes, else no
"RTN","FBAACO1",28,0)
 ;   FBDEFC = (optional) default for the contract prompt
"RTN","FBAACO1",29,0)
 ;   FBAAMM = ppt if 1 ask for each line item; if 0 don't ask
"RTN","FBAACO1",30,0)
 ;   FBV    = vendor (ien) being paid
"RTN","FBAACO1",31,0)
 ;   FBVEN  = vendor (ien) from authorization
"RTN","FBAACO1",32,0)
 ;   FBCNTRA= contract (ien) from authorization
"RTN","FBAACO1",33,0)
 ;   FB583  = (optional) $D(FB583) true if unauthorized claim
"RTN","FBAACO1",34,0)
 ;   FB162  = (optional) = 1 if payment line item in sub-file 162.03 is being edited.  FBDEF and FBDEFC must be current values.
"RTN","FBAACO1",35,0)
 ; output
"RTN","FBAACO1",36,0)
 ;   FBAAMM1 = the ppt for the line item
"RTN","FBAACO1",37,0)
 ;   FBCNTRP = contract ien for the line item
"RTN","FBAACO1",38,0)
 N Y
"RTN","FBAACO1",39,0)
 S (FBAAMM1,FBCNTRP)=""
"RTN","FBAACO1",40,0)
 I FBAAMM="" Q
"RTN","FBAACO1",41,0)
 S:'$D(FBV) FBV=$G(FBVEN)  ;SOMETIMES FBV DOES NOT EXIST BUT FBVEN IS SET EQUAL TO THE VENDOR IN FBCH ENTER PAYMENT
"RTN","FBAACO1",42,0)
 I FBAAMM=1,'$D(FB583),$$UCFA^FBUTL7($G(FBV),$G(FBVEN),$G(FBCNTRA)) D  Q
"RTN","FBAACO1",43,0)
 . W !,"Contract is ",$P($G(^FBAA(161.43,FBCNTRA,0)),U)," from the authorization."
"RTN","FBAACO1",44,0)
 . S FBAAMM1=1
"RTN","FBAACO1",45,0)
 . S FBCNTRP=FBCNTRA
"RTN","FBAACO1",46,0)
 I FBAAMM=1 D
"RTN","FBAACO1",47,0)
 . ;if editing line in file 162 contracted services can't be changed
"RTN","FBAACO1",48,0)
 . I $G(FB162)=1 D
"RTN","FBAACO1",49,0)
 .. W !,"Invoice ",$S(FBDEF=1:"is",1:"is not")," for contracted services."
"RTN","FBAACO1",50,0)
 .. S Y=$S(FBDEF=1:1,1:0)
"RTN","FBAACO1",51,0)
 . ;if not editing line in file 162 contracted services can be changed
"RTN","FBAACO1",52,0)
 . I $G(FB162)'=1 F  D  Q:Y]""
"RTN","FBAACO1",53,0)
 . . S DIR(0)="Y",DIR("A")="Is this line item for a contracted service"
"RTN","FBAACO1",54,0)
 . . S DIR("B")=$S($G(FBDEF)=1:"Yes",1:"No")
"RTN","FBAACO1",55,0)
 . . S DIR("?")="Answering no indicates that interest will not be paid for this line item."
"RTN","FBAACO1",56,0)
 . . D ^DIR K DIR I $D(DIRUT) W !,$C(7),"Required Response!" S Y=""
"RTN","FBAACO1",57,0)
 . S FBAAMM1=$S(Y=1:1,1:"")
"RTN","FBAACO1",58,0)
 . Q:FBAAMM1=""
"RTN","FBAACO1",59,0)
 . ;
"RTN","FBAACO1",60,0)
 . S DIR(0)="PO^161.43:AQEM"
"RTN","FBAACO1",61,0)
 . S DIR("A")="CONTRACT"
"RTN","FBAACO1",62,0)
 . S DIR("?",1)="If the line item is under a contract then select it."
"RTN","FBAACO1",63,0)
 . S DIR("?")="Contract must be active and applicable for the vendor."
"RTN","FBAACO1",64,0)
 . S DIR("S")="I $P($G(^(0)),""^"",2)'=""I"",$$VCNTR^FBUTL7($G(FBV),+Y)"
"RTN","FBAACO1",65,0)
 . S:$G(FBDEFC) DIR("B")=$P($G(^FBAA(161.43,FBDEFC,0)),U)
"RTN","FBAACO1",66,0)
 . D ^DIR K DIR
"RTN","FBAACO1",67,0)
 . ; if time-out or '^' and has default value (i.e. edit payment)
"RTN","FBAACO1",68,0)
 . ;   return default so existing payment is not altered
"RTN","FBAACO1",69,0)
 . I $D(DTOUT)!$D(DUOUT),$G(FBDEFC)>0 S FBCNTRP=FBDEFC Q
"RTN","FBAACO1",70,0)
 . I Y>0 S FBCNTRP=+Y
"RTN","FBAACO1",71,0)
 Q
"RTN","FBAACO1",72,0)
 ;
"RTN","FBAACO1",73,0)
Q K FBAADT,FBX,FBAACP W:FBINTOT>0 !!,"Invoice: "_FBAAIN_"  Totals $ "_$J(FBINTOT,1,2) G Q^FBAACO:$D(FB583),1^FBAACO:'$D(FBCHCO) Q
"RTN","FBAACO1",74,0)
 ;
"RTN","FBAACO1",75,0)
POS ; prompt for place of service
"RTN","FBAACO1",76,0)
 ; output
"RTN","FBAACO1",77,0)
 ;   FBHCFA(30) = place of service (internal)
"RTN","FBAACO1",78,0)
 N Y
"RTN","FBAACO1",79,0)
 S FBHCFA(30)=""
"RTN","FBAACO1",80,0)
 S DIR(0)="P^353.1:EMZ"
"RTN","FBAACO1",81,0)
 D ^DIR K DIR I $D(DIRUT) Q
"RTN","FBAACO1",82,0)
 S FBHCFA(30)=$P(Y,U)
"RTN","FBAACO1",83,0)
 Q
"RTN","FBAACO1",84,0)
 ;
"RTN","FBAACO1",85,0)
GETVEN ;select vendor from vendor file
"RTN","FBAACO1",86,0)
 W !! S DLAYGO=161.2,DIC="^FBAAV(",DIC(0)="AEQLM" D ^DIC K DLAYGO I X="^"!(X="") S FBAAOUT=1 Q
"RTN","FBAACO1",87,0)
 ;if new vendor, call in to new vendor setup routine
"RTN","FBAACO1",88,0)
 G GETVEN:Y<0 S DA=+Y,DIE=DIC D:$P(Y,"^",3)=1 NEW^FBAAVD K DIE,DIC,DR,X,DLAYGO
"RTN","FBAACO1",89,0)
GETVEN1 I $D(FB583) S DA=FBVEN
"RTN","FBAACO1",90,0)
 I $D(^FBAAV(DA,0)),$P($G(^("ADEL")),U)="Y" W !!,$C(7),"Vendor has been flagged for Austin deletion!" G GETVEN:'$D(FB583) S FBAAOUT=1 Q
"RTN","FBAACO1",91,0)
 D:$P(FBSITE(0),"^",11)="Y" EN1^FBAAVD
"RTN","FBAACO1",92,0)
GETVEN2 I $P(FBSITE(0),"^",11)="Y",$D(^XUSEC("FBAA ESTABLISH VENDOR",DUZ)) S DIR(0)="Y",DIR("A")="Want to Edit data",DIR("B")="NO" D ^DIR K DIR S:$D(DIRUT) FBAAOUT=1 Q:$D(DIRUT)  D:Y EDITV^FBAAVD
"RTN","FBAACO1",93,0)
 I $P(FBSITE(0),"^",11)'="Y"!('$D(^XUSEC("FBAA ESTABLISH VENDOR",DUZ))) S DIR(0)="E" D ^DIR K DIR I $D(DIRUT) S FBAAOUT=1 Q
"RTN","FBAACO1",94,0)
 S FBV=DA,FBAR(DA)="" D ^FBAACO4
"RTN","FBAACO1",95,0)
 Q
"RTN","FBAACO1",96,0)
 ;
"RTN","FBAACO1",97,0)
GETINV ;assign invoice number or select existing invoice number
"RTN","FBAACO1",98,0)
 K FBAAOUT S FBINTOT=0 S DIR(0)="Y",DIR("A")="Want a new Invoice number assigned",DIR("B")="YES" D ^DIR K DIR I $D(DIRUT) S FBAAOUT=1 Q
"RTN","FBAACO1",99,0)
 I Y D GETNXI^FBAAUTL W !!,"Invoice # ",FBAAIN," assigned to this Invoice" Q
"RTN","FBAACO1",100,0)
GETINV1 ;selects existing invoice if user does not choose to assign new number
"RTN","FBAACO1",101,0)
 S DIR(0)="N",DIR("A")="Select Invoice number",DIR("?")="Select one of the previously entered Invoice #'s" D ^DIR K DIR I $D(DIRUT)!(X="") G GETINV:'$G(FB583) S FBAAOUT=1 Q
"RTN","FBAACO1",102,0)
 D CHK1^FBAACO4 G GETINV1:'$G(FBAACK1) K FBAACK1
"RTN","FBAACO1",103,0)
 I '$D(^FBAAC("AJ",FBAABE,X)) D  G GETINV1
"RTN","FBAACO1",104,0)
 . W !,$C(7),"Only previously entered invoices in the same batch may be selected!"
"RTN","FBAACO1",105,0)
 S FBAAIN=X D CALC^FBAACO3 W:FBINTOT>0 ?33,"Current Total: $ "_$J(FBINTOT,1,2)
"RTN","FBAACO1",106,0)
 Q
"RTN","FBAACO1",107,0)
 ;
"RTN","FBAACO1",108,0)
GETINDT ;get invoice dates
"RTN","FBAACO1",109,0)
 ;input requires FBAABDT (authorization from date)
"RTN","FBAACO1",110,0)
 K FBAAOUT W !,"Enter Date Correct Invoice Received or Last Date of Service" S %DT("A")="(whichever is later): " S:$G(FBAAID) %DT("B")=$$DATX^FBAAUTL(FBAAID) I $G(FBCNH) S %DT(0)=$G(FBENDDT)
"RTN","FBAACO1",111,0)
 S %DT="AEXP" D ^%DT K %DT I X="^"!(X="") S FBAAOUT=1 Q
"RTN","FBAACO1",112,0)
 S FBAAID=Y I $G(CALLERID)="FBCHEP",FBAAID<FBAAEDT D  K FBAAID G GETINDT
"RTN","FBAACO1",113,0)
 .N SHOWDOS S SHOWDOS=$E(FBAAEDT,4,5)_"/"_$E(FBAAEDT,6,7)_"/"_$E(FBAAEDT,2,3) ;Convert FBAAEDT (Treatment TO Date) into display format for error message
"RTN","FBAACO1",114,0)
 .W *7,!!?5,"*** Invoice Received Date cannot be before the ",!?8," Treatment TO Date ("_SHOWDOS_") !!!"
"RTN","FBAACO1",115,0)
 I '$G(FBCNP) I FBAAID<FBAABDT D  K FBAAID G GETINDT
"RTN","FBAACO1",116,0)
 .N SHOWDOS S SHOWDOS=$E(FBAABDT,4,5)_"/"_$E(FBAABDT,6,7)_"/"_$E(FBAABDT,2,3) ;Convert FBAABDT (Authorization From Date) into display format for error message
"RTN","FBAACO1",117,0)
 .W !!,$C(7),?5,"*** Invoice Received Date cannot be earlier than",!?8," Patient's Authorization Date ("_SHOWDOS_") !!!"
"RTN","FBAACO1",118,0)
GETIND1 W ! S %DT("A")="Enter Vendor Invoice Date: ",%DT="AEXP" S:$G(FBAAVID) %DT("B")=$$DATX^FBAAUTL(FBAAVID) D ^%DT K %DT G GETINDT:X="" I X="^" S FBAAOUT=1 Q
"RTN","FBAACO1",119,0)
 S FBAAVID=Y I FBAAVID>FBAAID W !!,$C(7),"Vendor's invoice date is later than the date you received it!!" K FBAAVID G GETIND1
"RTN","FBAACO1",120,0)
 Q
"RTN","FBAACO1",121,0)
 ;
"RTN","FBAACO1",122,0)
DISPINV ;display invoice totals
"RTN","FBAACO1",123,0)
 ;required inputs FBAADT (auth dt),DFN
"RTN","FBAACO1",124,0)
 S H=$E(FBAADT,1,5)_"00",R=9999999.9999-H,S=$E(FBAADT,1,5)_31,S=9999999.9999-S,G=+$E(FBAADT,4,5)_+$E(FBAADT,2,3) D CKMAX^FBAACO3
"RTN","FBAACO1",125,0)
 S FBTPD=0 I $D(^FBAAC(DFN,3,"AB",FBAADT)) S FBZX=$O(^FBAAC(DFN,3,"AB",FBAADT,0)) I $D(^FBAAC(DFN,3,FBZX,0)) W !!,"$ ",$P(^(0),"^",3)," for travel already entered for this date of service" S FBTPD=1
"RTN","FBAACO1",126,0)
 W:'$D(FBCHCO) !!,"Total already paid on ID Card for month:   $ ",A,"   Maximum allowed: $ ",$P(FBSITE(1),"^",9),!,"Total already paid on All/Other for month: $ ",FBAOT
"RTN","FBAACO1",127,0)
 Q
"RTN","FBAACO3")
0^16^B58658444^B62984303
"RTN","FBAACO3",1,0)
FBAACO3 ;AISC/GRR - ENTER PAYMENT CONTINUED ;12/4/14  14:11
"RTN","FBAACO3",2,0)
 ;;3.5;FEE BASIS;**4,38,55,61,116,122,133,108,124,143,139,157,154**;JAN 30, 1995;Build 12
"RTN","FBAACO3",3,0)
 ;;Per VA Directive 6402, this routine should not be modified.
"RTN","FBAACO3",4,0)
 ;
"RTN","FBAACO3",5,0)
 ;FB*3.5*157 Modify file 162, Diagnosis (field 28) stuff from '///' to '////'
"RTN","FBAACO3",6,0)
 ;           since needed file 80 dx IEN is already passed back from DX 
"RTN","FBAACO3",7,0)
 ;           lookup.
"RTN","FBAACO3",8,0)
 ;
"RTN","FBAACO3",9,0)
DOEDIT ;
"RTN","FBAACO3",10,0)
 N FB1725,FBFPPSC
"RTN","FBAACO3",11,0)
 W ! S FBAACP(0)=FBAACP
"RTN","FBAACO3",12,0)
 S DIC="^FBAAC("_DFN_",1,"_FBV_",1,"_FBSDI_",1,"
"RTN","FBAACO3",13,0)
 S DIC(0)="EQMZ",DA(3)=DFN,DA(2)=FBV,DA(1)=FBSDI
"RTN","FBAACO3",14,0)
 S X=$$CPT^FBAAUTL4(FBAACP)
"RTN","FBAACO3",15,0)
 D ^DIC I Y<0 S FBAAOUT=1 Q
"RTN","FBAACO3",16,0)
 S (DA,FBAACPI)=+Y,K=$P(Y(0),U,3),FBZBN=$P(Y(0),U,8),FBZBS=$S(FBZBN]"":$P($G(^FBAA(161.7,FBZBN,"ST")),U),1:""),FBAAPTC=$P(Y(0),U,20),J(0)=$P(Y(0),U,2)
"RTN","FBAACO3",17,0)
 ; set FB1725 true (1) if payment is for a Mill Bill claim
"RTN","FBAACO3",18,0)
 S FB1725=$S($P(Y(0),U,13)["FB583":+$P($G(^FB583(+$P(Y(0),U,13),0)),U,28),1:0)
"RTN","FBAACO3",19,0)
 S FBAAMM1=$P($G(^FBAAC(DFN,1,FBV,1,FBSDI,1,FBAACPI,2)),U,2)
"RTN","FBAACO3",20,0)
 S FBCNTRP=$P($G(^FBAAC(DFN,1,FBV,1,FBSDI,1,FBAACPI,3)),U,8)
"RTN","FBAACO3",21,0)
 S FBFSAMT(0)=$P($G(^FBAAC(DFN,1,FBV,1,FBSDI,1,FBAACPI,2)),U,12)
"RTN","FBAACO3",22,0)
 ; determine lesser of original fee schedule amount and amount claimed
"RTN","FBAACO3",23,0)
 S FBAMTPD(0)=$S(FBFSAMT(0)="":J(0),FBFSAMT(0)>J(0):J(0),1:FBFSAMT(0))
"RTN","FBAACO3",24,0)
 S FBMODL=$$MODL^FBAAUTL4("^FBAAC("_DFN_",1,"_FBV_",1,"_FBSDI_",1,"_FBAACPI_",""M"")")
"RTN","FBAACO3",25,0)
 ; load current adjustment data
"RTN","FBAACO3",26,0)
 D LOADADJ^FBAAFA(FBAACPI_","_FBSDI_","_FBV_","_DFN_",",.FBADJ)
"RTN","FBAACO3",27,0)
 ; save adjustment data prior to edit session in sorted list
"RTN","FBAACO3",28,0)
 S FBADJL(0)=$$ADJL^FBUTL2(.FBADJ) ; sorted list of original adjustments
"RTN","FBAACO3",29,0)
 ; load current remittance remark data
"RTN","FBAACO3",30,0)
 D LOADRR^FBAAFR(FBAACPI_","_FBSDI_","_FBV_","_DFN_",",.FBRRMK)
"RTN","FBAACO3",31,0)
 ; save remittance remarks prior to edit session in sorted list
"RTN","FBAACO3",32,0)
 S FBRRMKL(0)=$$RRL^FBUTL4(.FBRRMK)
"RTN","FBAACO3",33,0)
 ; load FPPS data
"RTN","FBAACO3",34,0)
 S FBFPPSC=$P($G(^FBAAC(DFN,1,FBV,1,FBSDI,1,FBAACPI,3)),U)
"RTN","FBAACO3",35,0)
 S FBFPPSL=$P($G(^FBAAC(DFN,1,FBV,1,FBSDI,1,FBAACPI,3)),U,2)
"RTN","FBAACO3",36,0)
 I FBZBS=""!(FBZBS="V") D NOGO S FBAAOUT=1 Q
"RTN","FBAACO3",37,0)
 ; first edit CPT code and modifiers
"RTN","FBAACO3",38,0)
 D CPTM^FBAALU(FBAADT,DFN,FBAACP(0),FBMODL) I '$G(FBGOT) S FBAAOUT=1 Q
"RTN","FBAACO3",39,0)
 ; if CPT was changed then update file
"RTN","FBAACO3",40,0)
 I FBAACP'=FBAACP(0) D  I FBAACP="@" S FBAAOUT=1 Q
"RTN","FBAACO3",41,0)
 . N FBIENS,FBFDA
"RTN","FBAACO3",42,0)
 . S FBIENS=FBAACPI_","_FBSDI_","_FBV_","_DFN_","
"RTN","FBAACO3",43,0)
 . S FBFDA(162.03,FBIENS,.01)=FBAACP
"RTN","FBAACO3",44,0)
 . D FILE^DIE("","FBFDA") D MSG^DIALOG()
"RTN","FBAACO3",45,0)
 ; if modifiers changed then update file
"RTN","FBAACO3",46,0)
 I FBMODL'=$$MODL^FBAAUTL4("FBMODA") D REPMOD^FBAAUTL4(DFN,FBV,FBSDI,FBAACPI)
"RTN","FBAACO3",47,0)
 ; now edit remaining fields
"RTN","FBAACO3",48,0)
 D SETO K DR
"RTN","FBAACO3",49,0)
 ;JAS - 09/13/13 - PATCH 139 - Added FBDXCHK1 and FBDXCHK2
"RTN","FBAACO3",50,0)
 N FBDXCHK1 S FBDXCHK1=";S:FBAADT<$$IMPDATE^FBCSV1(""10D"") Y=""@20"";@15;S XX1=-1 S XX1=$$ASKICD10^FBAACO2(FBAADT) S:XX1<0 Y=""@15"";28////^S X=XX1;S Y=""@21"";"   ;;FB*3.5*157
"RTN","FBAACO3",51,0)
 S FBDXCHK1=FBDXCHK1_"@20;S XX1=$$ASKICD9^FBAACO2(FBAADT) S:+XX1<0 Y=""@20"";28////^S X=+XX1;@21;31;32R;S Y=""@7"";"
"RTN","FBAACO3",52,0)
 N FBDXCHK2 S FBDXCHK2=";S:FBAADT<$$IMPDATE^FBCSV1(""10D"") Y=""@26"";@25;S XX1=-1 S XX1=$$ASKICD10^FBAACO2(FBAADT) S:XX1<0 Y=""@25"";28////^S X=XX1;S Y=""@30"";@26;"   ;;FB*3.5*157
"RTN","FBAACO3",53,0)
 S DR="48;47;S FBUNITS=X;42R;S FBZIP=X;S:$$ANES^FBAAFS($$CPT^FBAAUTL4(FBAACP)) Y=""@2"";43///@;S FBTIME=X;S Y=""@3"";@2;43R;S FBTIME=X;@3"
"RTN","FBAACO3",54,0)
 ; fb*3.5*116 remove edit of interest indicator (162.03,34) to prevent different interest indicator values at line item level; interest indicator set at invoice level only
"RTN","FBAACO3",55,0)
 S DR(1,162.03,1)="S FBAAMM=$S(FBAAPTC=""R"":"""",1:1);D PPT^FBAACO1(FBAAMM1,FBCNTRP,1);34///@;34////^S X=FBAAMM1;54///@;54////^S X=FBCNTRP;30R;S FBHCFA(30)=X;1;S J=X;Q"
"RTN","FBAACO3",56,0)
 ;S DR(1,162.03,1)="30R;S FBHCFA(30)=X;1;S J=X;Q"
"RTN","FBAACO3",57,0)
 S DR(1,162.03,2)="D FEEDT^FBAACO3;44///@;44///^S X=FBFSAMT;45///@;45///^S X=FBFSUSD;S:FBAMTPD'>0!(FBAMTPD=FBAMTPD(0)) Y=""@4"";2///^S X=FBAMTPD;@4;2//^S X=FBAMTPD;S K=X"
"RTN","FBAACO3",58,0)
 ;S DR(1,162.03,3)="3//^S X=$S(J-K:J-K,1:"""");4;S:X'=4 Y=6;22;6////^S X=DUZ;13;33"
"RTN","FBAACO3",59,0)
 S DR(1,162.03,3)="K FBADJD;M FBADJD=FBADJ;S FBX=$$ADJ^FBUTL2(J-K,.FBADJ,2,,.FBADJD,1)"
"RTN","FBAACO3",60,0)
 S DR(1,162.03,4)="S:FBFPPSC="""" Y=13;W !,""FPPS CLAIM ID: ""_FBFPPSC;S FBX=$$FPPSL^FBUTL5(FBFPPSL,,1);51///^S X=FBX;S FBFPPSL=X;@13;13;I $$BADDATE^FBAACO3(FBAADT,X) S Y=""@13"";33"
"RTN","FBAACO3",61,0)
 ;JAS - 09/13/13 - PATCH 139 - Updated line below for ICD-10
"RTN","FBAACO3",62,0)
 S DR(1,162.03,5)="S:$$EXTPV^FBAAUTL5(FBPOV)=""01"" Y=""@1"";S Y=$S('$D(FB7078):""@5"",FB7078]"""":""@21"",1:""@5"");@5"_FBDXCHK1_"@1"_FBDXCHK2_"S XX1=$$ASKICD9^FBAACO2(FBAADT) S:+XX1<0 Y=""@26"";28////^S X=+XX1;@30;31"
"RTN","FBAACO3",63,0)
 S DR(1,162.03,6)="@7;K FBRRMKD;M FBRRMKD=FBRRMK;S FBX=$$RR^FBUTL4(.FBRRMK,2,,.FBRRMKD)"
"RTN","FBAACO3",64,0)
 S DR(1,162.03,7)="73;74;75;58;59;60;61;62;63;64;65;66;67;76;77;78;79;68;69"
"RTN","FBAACO3",65,0)
 S DIE="^FBAAC("_DFN_",1,"_FBV_",1,"_FBSDI_",1,",DIE("NO^")="",FBOT=1
"RTN","FBAACO3",66,0)
 D LOCK^FBUCUTL("^FBAAC("_DFN_",1,"_FBV_",1,"_FBSDI_",1,",FBAACPI) I 'FBLOCK S FBAAOUT=1 Q
"RTN","FBAACO3",67,0)
 D ^DIE
"RTN","FBAACO3",68,0)
 ; if adjustment data changed then file
"RTN","FBAACO3",69,0)
 I $$ADJL^FBUTL2(.FBADJ)'=FBADJL(0) D FILEADJ^FBAAFA(FBAACPI_","_FBSDI_","_FBV_","_DFN_",",.FBADJ)
"RTN","FBAACO3",70,0)
 ; if remit remark data changed then file
"RTN","FBAACO3",71,0)
 I $$RRL^FBUTL4(.FBRRMK)'=FBRRMKL(0) D FILERR^FBAAFR(FBAACPI_","_FBSDI_","_FBV_","_DFN_",",.FBRRMK)
"RTN","FBAACO3",72,0)
 L -^FBAAC(DFN,1,FBV,1,FBSDI,1,FBAACPI) K FBOT,DIE,DR,DA
"RTN","FBAACO3",73,0)
 Q:$D(FBDL)
"RTN","FBAACO3",74,0)
 I $G(FBAAIN) S FBINTOT=0 D CALC
"RTN","FBAACO3",75,0)
 Q
"RTN","FBAACO3",76,0)
 ;
"RTN","FBAACO3",77,0)
BADDATE(FBDOS,INVRCVDT) ;Reject entry if InvRcvDt is Prior to the Date of Service on the Invoice
"RTN","FBAACO3",78,0)
 I INVRCVDT<FBDOS D  Q 1 ;Reject entry
"RTN","FBAACO3",79,0)
 .N SHOWDOS  S SHOWDOS=$E(FBDOS,4,5)_"/"_$E(FBDOS,6,7)_"/"_$E(FBDOS,2,3) ;Convert FBDOS into display format for error message
"RTN","FBAACO3",80,0)
 .W *7,!!?5,"*** Invoice Received Date cannot be prior to the",!?8," Date of Service ("_SHOWDOS_") !!!"
"RTN","FBAACO3",81,0)
 Q 0 ;Accept entry
"RTN","FBAACO3",82,0)
 ;
"RTN","FBAACO3",83,0)
SETO S FY=$E(FBAADT,1,3)+1700+$S($E(FBAADT,4,5)>9:1,1:0)
"RTN","FBAACO3",84,0)
 Q
"RTN","FBAACO3",85,0)
OUT ;
"RTN","FBAACO3",86,0)
 ; FB*3.5*116 count line items that have 0.00 amount paid
"RTN","FBAACO3",87,0)
 ;I K>0 S Z1=$P(^FBAA(161.7,FBAABE,0),"^",11)+1,$P(^(0),"^",11)=Z1,FBINTOT=FBINTOT+K
"RTN","FBAACO3",88,0)
 S Z1=$P(^FBAA(161.7,FBAABE,0),"^",11)+1,$P(^(0),"^",11)=Z1,FBINTOT=FBINTOT+K
"RTN","FBAACO3",89,0)
 Q
"RTN","FBAACO3",90,0)
CKMAX S (FBAOT,A)=0,O="" F Z=S-.1:0 S Z=$O(^FBAAC(DFN,"AB",Z)) Q:Z'>0!(Z>R)  F Q=0:0 S Q=$O(^FBAAC(DFN,"AB",Z,Q)) Q:Q'>0  S W=$O(^FBAAC(DFN,"AB",Z,Q,0)) I $D(^FBAAC(DFN,1,Q,1,W,0)) D SMORE
"RTN","FBAACO3",91,0)
 I A>$P(FBSITE(1),"^",9) G NO
"RTN","FBAACO3",92,0)
 Q
"RTN","FBAACO3",93,0)
SMORE N FBA,FBB S FBB=$P($G(^FBAAC(+DFN,1,+Q,1,+W,0)),U,4),E=0
"RTN","FBAACO3",94,0)
 F  S E=$O(^FBAAC(DFN,1,Q,1,W,1,E)) Q:'E  S FBA=$G(^(E,0)) I $P(FBA,"^",9)=2,$P(FBA,"^",18)'=1 D
"RTN","FBAACO3",95,0)
 .I $$IDCHK^FBAAUTL3(DFN,FBB) S A=A+$P(FBA,"^",3) Q
"RTN","FBAACO3",96,0)
 .S FBAOT=FBAOT+$P(FBA,U,3)
"RTN","FBAACO3",97,0)
 Q
"RTN","FBAACO3",98,0)
NO W !!,*7,"Warning Patient already at maximum allowed for month of service",! Q
"RTN","FBAACO3",99,0)
WARN W !!,*7,"You have reached the maximum number of payments for a Batch!",!,"You must select another Batch for entering Payments!"
"RTN","FBAACO3",100,0)
CALC ;Calculate Current Invoice Total
"RTN","FBAACO3",101,0)
 F J=0:0 S J=$O(^FBAAC("C",FBAAIN,J)) Q:J'>0  F K=0:0 S K=$O(^FBAAC("C",FBAAIN,J,K)) Q:K'>0  F L=0:0 S L=$O(^FBAAC("C",FBAAIN,J,K,L)) Q:L'>0  F M=0:0 S M=$O(^FBAAC("C",FBAAIN,J,K,L,M)) Q:M'>0  D CALC1
"RTN","FBAACO3",102,0)
 K J,K,L,M,FZNODE Q
"RTN","FBAACO3",103,0)
CALC1 S FZNODE=^FBAAC(J,1,K,1,L,1,M,0),A2=$P(FZNODE,"^",3),FBINTOT=FBINTOT+A2,FBAAID=$P(FZNODE,"^",15),FBAAVID=$P($G(^FBAAC(J,1,K,1,L,1,M,2)),"^")
"RTN","FBAACO3",104,0)
 Q
"RTN","FBAACO3",105,0)
FEEDT ;
"RTN","FBAACO3",106,0)
 ;FB*3.5*143 Adding FB1725 as a parameter to prevent incorrect
"RTN","FBAACO3",107,0)
 ; reductions in local fee schedule pricing.
"RTN","FBAACO3",108,0)
 ; input FB1725 - true (=1) when edited payment is for a Mill BilL claim.
"RTN","FBAACO3",109,0)
 N FBX
"RTN","FBAACO3",110,0)
 D SETO:'$G(FY) S FBFY=FY-1
"RTN","FBAACO3",111,0)
 S (FBFSAMT,FBFSUSD)="",FBAMTPD=$G(FBAMTPD)
"RTN","FBAACO3",112,0)
 S FBX=$$GET^FBAAFS($$CPT^FBAAUTL4(FBAACP),$$MODL^FBAAUTL4("FBMODA","E"),FBAADT,$G(FBZIP),$$FAC^FBAAFS($G(FBHCFA(30))),$G(FBTIME),$G(FB1725))
"RTN","FBAACO3",113,0)
 I '$G(FBAAMM1) D
"RTN","FBAACO3",114,0)
 . S FBFSAMT=$P(FBX,U),FBFSUSD=$P(FBX,U,2)
"RTN","FBAACO3",115,0)
 E  D
"RTN","FBAACO3",116,0)
 . W !,?2,"Payment is for a contracted service so fee schedule does not apply."
"RTN","FBAACO3",117,0)
 I $P($G(FBX),U)]"" D
"RTN","FBAACO3",118,0)
 . W !?2,$S($G(FBAAMM1):"However, f",1:"F")
"RTN","FBAACO3",119,0)
 . W "ee schedule amount is $",$P(FBX,U)," from the "
"RTN","FBAACO3",120,0)
 . W:$P(FBX,U,3)]"" $P(FBX,U,3)," " ; year if returned
"RTN","FBAACO3",121,0)
 . W:$P(FBX,U,2)]"" $$EXTERNAL^DILFD(162.03,45,"",$P(FBX,U,2))
"RTN","FBAACO3",122,0)
 E  W !?2,"Unable to determine a FEE schedule amount."
"RTN","FBAACO3",123,0)
 ;
"RTN","FBAACO3",124,0)
 I FB1725 D
"RTN","FBAACO3",125,0)
 . W !!?2,"**Payment is for emergency treatment under 38 U.S.C. 1725."
"RTN","FBAACO3",126,0)
 . I FBFSAMT D
"RTN","FBAACO3",127,0)
 . . S FBFSAMT=$J(FBFSAMT*.7,0,2)
"RTN","FBAACO3",128,0)
 . . W !?2,"  Therefore, fee schedule amount reduced to $",FBFSAMT," (70%)."
"RTN","FBAACO3",129,0)
 ;
"RTN","FBAACO3",130,0)
 I $G(FBUNITS)>1 D
"RTN","FBAACO3",131,0)
 . W !!?2,"Units Paid = ",FBUNITS
"RTN","FBAACO3",132,0)
 . Q:FBFSAMT'>0
"RTN","FBAACO3",133,0)
 . N FBFSUNIT
"RTN","FBAACO3",134,0)
 . ; determine if fee schedule can be multiplied by units
"RTN","FBAACO3",135,0)
 . S FBFSUNIT=$S(FBFSUSD="R":1,FBFSUSD="F"&(FBAADT>3040930):1,1:0)
"RTN","FBAACO3",136,0)
 . I FBFSUNIT D
"RTN","FBAACO3",137,0)
 . . S FBFSAMT=$J(FBFSAMT*FBUNITS,0,2)
"RTN","FBAACO3",138,0)
 . . W !?2,"  Therefore, fee schedule amount increased to $",FBFSAMT
"RTN","FBAACO3",139,0)
 . E  D
"RTN","FBAACO3",140,0)
 . . W !?2,"  Fee schedule not complied on per unit basis so amount not adjusted by units."
"RTN","FBAACO3",141,0)
 ;
"RTN","FBAACO3",142,0)
 I '$G(FBAAMM1) D
"RTN","FBAACO3",143,0)
 . ; set default amount paid to lesser of amt claimed (J) or fee sched.
"RTN","FBAACO3",144,0)
 . S FBAMTPD=$S(FBFSAMT'>0:J,FBFSAMT>J:J,1:FBFSAMT)
"RTN","FBAACO3",145,0)
 W !
"RTN","FBAACO3",146,0)
 Q
"RTN","FBAACO3",147,0)
NOGO W !!,*7,"This payment CANNOT be edited.  The batch the payment is in",!,"has been Vouchered.  You may void the payment with the Void Payment option.",!
"RTN","FBAACO3",148,0)
 Q
"RTN","FBAACO3",149,0)
 ;
"RTN","FBAACO3",150,0)
SC W *7,!?4,"Suspense code is required!",! S Y="@4" Q
"RTN","FBAACO3",151,0)
 ;
"RTN","FBAACO3",152,0)
DEL ;delete date of service if no service provided entered
"RTN","FBAACO3",153,0)
 I '$O(^FBAAC(DFN,1,FBV,1,FBSDI,1,0)) D
"RTN","FBAACO3",154,0)
 .S DIK="^FBAAC(DFN,1,FBV,1,",DA(2)=DFN,DA(1)=FBV,DA=FBSDI D ^DIK W !!?5,*7,"Incomplete payment entry deleted.",!
"RTN","FBAACO3",155,0)
 K DIK,DA Q
"RTN","FBAACO5")
0^64^B5864672^B6803212
"RTN","FBAACO5",1,0)
FBAACO5 ;AISC/GRR - ENTER PAYMENT CONTINUED ;9/5/2014
"RTN","FBAACO5",2,0)
 ;;3.5;FEE BASIS;**73,79,124,154**;JAN 30, 1995;Build 12
"RTN","FBAACO5",3,0)
 ;;Per VA Directive 6402, this routine should not be modified.
"RTN","FBAACO5",4,0)
FILEV(DFN,FBV) ;files vendor multiple in outpatient payment file
"RTN","FBAACO5",5,0)
 ;required input variable DFN,FBV (vendor ien)
"RTN","FBAACO5",6,0)
 K FBAAOUT
"RTN","FBAACO5",7,0)
 I '$G(DFN)!('FBV) S FBAAOUT=1 Q
"RTN","FBAACO5",8,0)
 S:'$D(^FBAAC(DFN,1,0)) ^FBAAC(DFN,1,0)="^162.01P^0^0"
"RTN","FBAACO5",9,0)
 S DLAYGO=162,DIC="^FBAAC("_DFN_",1,",DIC(0)="QLNM",DA(1)=DFN,X="`"_FBV D ^DIC K DIC,DLAYGO I Y<0 W !,*7,"Cannot select this Vendor at this time" S FBAAOUT=1 Q
"RTN","FBAACO5",10,0)
 Q
"RTN","FBAACO5",11,0)
GETSVDT(DFN,FBV,FBASSOC,FBA,X) ;set date of service multiple
"RTN","FBAACO5",12,0)
 ;required input DFN,FBV (vendor ien)
"RTN","FBAACO5",13,0)
 ;FBASSOC (auth ptr,0 if not known) not required or used (FB*3.5*154)
"RTN","FBAACO5",14,0)
 ;required input FBA (1=ask dt,0=do not ask dt)
"RTN","FBAACO5",15,0)
 ;optional/required input X (dt) - X req if FBA=0 (do not ask)
"RTN","FBAACO5",16,0)
 ;output FBSDI=ien of svc date mult,FBAADT=svc date
"RTN","FBAACO5",17,0)
TRYAGAIN ;
"RTN","FBAACO5",18,0)
 K FBAAOUT
"RTN","FBAACO5",19,0)
 I '$G(DFN)!('$G(FBV))!('$D(FBA)) S FBAAOUT=1 Q
"RTN","FBAACO5",20,0)
 I FBA=0,('$G(X)) S FBAAOUT=1 Q
"RTN","FBAACO5",21,0)
 I $G(FBA) S DIC("A")="Date of Service: ",DIC(0)="AEQLM"
"RTN","FBAACO5",22,0)
 I '$G(FBA) S DIC(0)="QLMN"
"RTN","FBAACO5",23,0)
 I '$D(^FBAAC(DFN,1,FBV,1,0)) S ^FBAAC(DFN,1,FBV,1,0)="^162.02DA^0^0"
"RTN","FBAACO5",24,0)
 S DLAYGO=162,DA(2)=DFN,DA(1)=FBV,DIC="^FBAAC("_DFN_",1,"_FBV_",1," D ^DIC K DLAYGO,DIC,DA I X=""!(X="^")!(Y<0) S FBAAOUT=1 Q
"RTN","FBAACO5",25,0)
 ;if date of service input transform called skip checks
"RTN","FBAACO5",26,0)
 I $D(HOLDY),HOLDY=$P(Y,"^",2) GOTO DONASK
"RTN","FBAACO5",27,0)
 I $D(FBAAID),$P(Y,"^",2)>FBAAID D  G TRYAGAIN
"RTN","FBAACO5",28,0)
 .N SHODAT S SHODAT=$E(FBAAID,4,5)_"/"_$E(FBAAID,6,7)_"/"_$E(FBAAID,2,3)
"RTN","FBAACO5",29,0)
 .W !!,*7,?5,"*** Date of Service cannot be later than",!?8," Invoice Received Date ("_SHODAT_") !!!",!
"RTN","FBAACO5",30,0)
 I $D(FBAABDT),$D(FBAAEDT),($P(Y,"^",2)<FBAABDT!($P(Y,"^",2)>FBAAEDT)) D  G TRYAGAIN
"RTN","FBAACO5",31,0)
 .N PRIORLAT,AUTHDAT,SHODAT
"RTN","FBAACO5",32,0)
 .S PRIORLAT=$S($P(Y,"^",2)<FBAABDT:"prior to ",1:"later than ")
"RTN","FBAACO5",33,0)
 .S AUTHDAT=$S($P(Y,"^",2)<FBAABDT:FBAABDT,1:FBAAEDT)
"RTN","FBAACO5",34,0)
 .S SHODAT=$E(AUTHDAT,4,5)_"/"_$E(AUTHDAT,6,7)_"/"_$E(AUTHDAT,2,3)
"RTN","FBAACO5",35,0)
 .W !!,*7,?5,"*** Date of Service cannot be ",PRIORLAT,!?8," Authorization period ("_SHODAT_") !!!",!
"RTN","FBAACO5",36,0)
DONASK ;
"RTN","FBAACO5",37,0)
 S FBSDI=+Y,FBAADT=$P(Y,"^",2)
"RTN","FBAACO5",38,0)
 Q
"RTN","FBAAEAR")
1^36^^B1712071
"RTN","FBAAEPI")
0^18^B33105165^B27520800
"RTN","FBAAEPI",1,0)
FBAAEPI ;AISC/GRR - EDIT PREVIOUSLY ENTERED PHARMACY INVOICE ;11/20/2014
"RTN","FBAAEPI",2,0)
 ;;3.5;FEE BASIS;**38,61,124,132,123,154**;JAN 30, 1995;Build 12
"RTN","FBAAEPI",3,0)
 ;;Per VA Directive 6402, this routine should not be modified.
"RTN","FBAAEPI",4,0)
RD W ! S DIC="^FBAA(162.1,",DIC(0)="AEQM",DIC("A")="Select Invoice #: ",DIC("S")="I $P(^(0),U,5)'=4!($P(^(0),U,5)=4&$D(^XUSEC(""FBAA LEVEL 2"",DUZ)))" D ^DIC K DIC("S") G END:X=""!(X="^"),RD:Y<0
"RTN","FBAAEPI",5,0)
 S (DA,FBDA)=+Y,DIE=DIC
"RTN","FBAAEPI",6,0)
 ;
"RTN","FBAAEPI",7,0)
 ; loop thru Rx and enforce separation of duty
"RTN","FBAAEPI",8,0)
 I $$SODPINV(FBDA) D  G RD
"RTN","FBAAEPI",9,0)
 . W !!,"You cannot process this payment due to separation of duties."
"RTN","FBAAEPI",10,0)
 . W !,"You previously entered/edited an associated authorization."
"RTN","FBAAEPI",11,0)
 ;
"RTN","FBAAEPI",12,0)
 ; save FPPS data prior to edit session
"RTN","FBAAEPI",13,0)
 S (FBFPPSC,FBFPPSC(0))=$P($G(^FBAA(162.1,FBDA,0)),U,13)
"RTN","FBAAEPI",14,0)
 D LASTRXDT ;Look up last RX FILL DATE in selected invoice, for use in validating Invoice Received Date if it is edited.
"RTN","FBAAEPI",15,0)
 S DR="@1;1;I $$BADDATE^FBAAEPI(LASTRXDT,X) S Y=""@1"";Q;12;S FBX=$$FPPSC^FBUTL5(1,FBFPPSC);S:FBX=-1 Y=0;S:FBX="""" Y=""@10"";13///^S X=FBX;S FBFPPSC=X;S Y=""@15"";@10;13///@;S FBFPPSC="""";@15;3;5"
"RTN","FBAAEPI",16,0)
 D ^DIE K DIC
"RTN","FBAAEPI",17,0)
 ; if FPPS CLAIM ID changed, then update Rx's
"RTN","FBAAEPI",18,0)
 I FBFPPSC'=FBFPPSC(0) D CKINVEDI^FBAAEPI1(FBFPPSC(0),FBFPPSC,FBDA)
"RTN","FBAAEPI",19,0)
 S DIC="^FBAA(162.1,DA,""RX"",",DIC(0)="AEQM",DIC("W")="W ?30,""DATE RX FILLED: "",$E($P(^(0),U,3),4,5)_""/""_$E($P(^(0),U,3),6,7)_""/""_$E($P(^(0),U,3),2,3)" D ^DIC K DIC("W")
"RTN","FBAAEPI",20,0)
 I Y<0 D END G RD ; a prescription was not selected
"RTN","FBAAEPI",21,0)
 W !
"RTN","FBAAEPI",22,0)
 S (FBJ,FBK)=0
"RTN","FBAAEPI",23,0)
 ;check status of batch rx is in.
"RTN","FBAAEPI",24,0)
 S DA=+Y,DA(1)=FBDA S FBSTAT=$P($G(^FBAA(161.7,+$P($G(^FBAA(162.1,+FBDA,"RX",+DA,0)),U,17),"ST")),U) I FBSTAT]"" D
"RTN","FBAAEPI",25,0)
 .I '$D(^XUSEC("FBAA LEVEL 2",DUZ)) D
"RTN","FBAAEPI",26,0)
 .. I $S(FBSTAT="O":0,FBSTAT="C":0,1:1) D
"RTN","FBAAEPI",27,0)
 ... W !,*7,"You cannot edit a payment once released by a supervisor.",! S FBOUT=1 Q
"RTN","FBAAEPI",28,0)
 .I $S(FBSTAT="T":1,FBSTAT="F":1,FBSTAT="V":1,1:0) D
"RTN","FBAAEPI",29,0)
 .. W !,*7,"You cannot edit an invoice when the batch has been sent to Austin",! S FBOUT=1
"RTN","FBAAEPI",30,0)
 I $G(FBOUT) D END G FBAAEPI
"RTN","FBAAEPI",31,0)
 ;
"RTN","FBAAEPI",32,0)
 ; FB*3.5*123 - Edit pharmacy IPAC data for Federal Vendors
"RTN","FBAAEPI",33,0)
 I '$$IPACEDIT^FBAAPET1(162.1,.DA) D END G FBAAEPI
"RTN","FBAAEPI",34,0)
 ;
"RTN","FBAAEPI",35,0)
 S DIE="^FBAA(162.1,FBDA,""RX"","
"RTN","FBAAEPI",36,0)
 ; get current value of FPPS LINE ITEM to use as default
"RTN","FBAAEPI",37,0)
 S FBFPPSL=$P($G(^FBAA(162.1,FBDA,"RX",DA,3)),U)
"RTN","FBAAEPI",38,0)
 ; load current adjustment data
"RTN","FBAAEPI",39,0)
 D LOADADJ^FBRXFA(DA_","_FBDA_",",.FBADJ)
"RTN","FBAAEPI",40,0)
 ; save adjustment data prior to edit session in sorted list
"RTN","FBAAEPI",41,0)
 S FBADJL(0)=$$ADJL^FBUTL2(.FBADJ) ; sorted list of original adjustments
"RTN","FBAAEPI",42,0)
 ; load current remittance remark data
"RTN","FBAAEPI",43,0)
 D LOADRR^FBRXFR(DA_","_FBDA_",",.FBRRMK)
"RTN","FBAAEPI",44,0)
 ; save remittance remarks prior to edit session in sorted list
"RTN","FBAAEPI",45,0)
 S FBRRMKL(0)=$$RRL^FBUTL4(.FBRRMK)
"RTN","FBAAEPI",46,0)
 S DR=".01;S:FBFPPSC="""" Y=1;S FBX=$$FPPSL^FBUTL5(FBFPPSL);S:FBX=-1 Y=0;36///^S X=FBX;S FBFPPSL=X;1;1.5;1.6;3;S FBJ=X;I $P(^FBAA(162.1,DA(1),""RX"",DA,0),U,9)=1 S Y="""";I 1;5"
"RTN","FBAAEPI",47,0)
 S DR(1,162.11,1)="S FBA=$P($G(^FBAA(162.1,DA(1),""RX"",DA,2)),U,6);S FB1725=$S(FBA[""FB583"":+$P($G(^FB583(+FBA,0)),U,28),1:0);W:FB1725 !?2,""**Payment is for emergency treatment under 38 U.S.C. 1725."""
"RTN","FBAAEPI",48,0)
 S DR(1,162.11,2)="@12;S FBHAP=$P(^FBAA(162.1,DA(1),""RX"",DA,0),U,16);6.5;S FBK=X;S:FBK]"""" Y=""@20"";K FBADJ,FBRRMK;S Y=8"
"RTN","FBAAEPI",49,0)
 S DR(1,162.11,3)="@20;I FBK>FBJ S $P(^FBAA(162.1,DA(1),""RX"",DA,0),U,16)=FBHAP W !,*7,""Amount Paid cannot be greater than the Amount Claimed"" S Y=""@12"""
"RTN","FBAAEPI",50,0)
 S DR(1,162.11,4)="K FBADJD;M FBADJD=FBADJ;S FBX=$$ADJ^FBUTL2(FBJ-FBK,.FBADJ,2,,.FBADJD,1);K FBADJD"
"RTN","FBAAEPI",51,0)
 S DR(1,162.11,5)="K FBRRMKD;M FBRRMKD=FBRRMK;S FBX=$$RR^FBUTL4(.FBRRMK,2,,.FBRRMKD);K FBRRMKD;S:FBX=-1 Y=0;8"
"RTN","FBAAEPI",52,0)
 D ^DIE
"RTN","FBAAEPI",53,0)
 I '$D(DA) D END G RD ; prescription was deleted
"RTN","FBAAEPI",54,0)
 ; if adjustment data changed then file
"RTN","FBAAEPI",55,0)
 I $$ADJL^FBUTL2(.FBADJ)'=FBADJL(0) D FILEADJ^FBRXFA(DA_","_FBDA_",",.FBADJ)
"RTN","FBAAEPI",56,0)
 ; if remit remark data changed then file
"RTN","FBAAEPI",57,0)
 I $$RRL^FBUTL4(.FBRRMK)'=FBRRMKL(0) D FILERR^FBRXFR(DA_","_FBDA_",",.FBRRMK)
"RTN","FBAAEPI",58,0)
 ; clean up and return to invoice selection
"RTN","FBAAEPI",59,0)
 D END G RD
"RTN","FBAAEPI",60,0)
 ;
"RTN","FBAAEPI",61,0)
LASTRXDT ;Look up last RX FILL DATE in selected invoice, for use in validating Invoice Received Date if it is edited.
"RTN","FBAAEPI",62,0)
 ;DA contains the selected INV#
"RTN","FBAAEPI",63,0)
 N I
"RTN","FBAAEPI",64,0)
 S LASTRXDT=0
"RTN","FBAAEPI",65,0)
 F I=1:1 Q:'$D(^FBAA(162.1,DA,"RX",I))  D
"RTN","FBAAEPI",66,0)
 .N RXDT S RXDT=$P(^FBAA(162.1,DA,"RX",I,0),"^",3)
"RTN","FBAAEPI",67,0)
 .I RXDT>LASTRXDT S LASTRXDT=RXDT,RXNUM=$P(^FBAA(162.1,DA,"RX",I,0),"^",1)
"RTN","FBAAEPI",68,0)
 Q
"RTN","FBAAEPI",69,0)
 ;
"RTN","FBAAEPI",70,0)
BADDATE(LASTRXDT,INVRCVDT) ;Reject entry if InvRcvDt is Prior to the last Rx Fill Date on the Invoice
"RTN","FBAAEPI",71,0)
 I INVRCVDT<LASTRXDT D  Q 1 ;Reject entry
"RTN","FBAAEPI",72,0)
 .N SHOWRXDT  S SHOWRXDT=$E(LASTRXDT,4,5)_"/"_$E(LASTRXDT,6,7)_"/"_$E(LASTRXDT,2,3) ;Convert RXDT into display format for error message
"RTN","FBAAEPI",73,0)
 .W *7,!!?5,"*** Invoice Received Date cannot be prior to the last",!?8," Prescription Filled Date on the Invoice ("_SHOWRXDT_" for RX# "_RXNUM_") !!!"
"RTN","FBAAEPI",74,0)
 Q 0 ;Accept entry
"RTN","FBAAEPI",75,0)
 ;
"RTN","FBAAEPI",76,0)
END K D,DA,DIC,DIE,DR,FBJ,FBK,FBDA,FBOUT,FBSTAT,FBHAP,X,Y,FBA,FB1725
"RTN","FBAAEPI",77,0)
 K FBADJ,FBADJD,FBADJL,FBFPPSC,FBFPPSL,FBRRMK,FBRRMKD,FBRRMKL,LASTRXDT,RXNUM
"RTN","FBAAEPI",78,0)
 Q
"RTN","FBAAEPI",79,0)
 ;
"RTN","FBAAEPI",80,0)
GETIPAC(FBDA,FBVEN,FBIA,FBDODINV) ; Get vendor/IPAC data for Pharmacy (FB*3.5*123)
"RTN","FBAAEPI",81,0)
 ; All parameters required and assumed to exist
"RTN","FBAAEPI",82,0)
 ; Called by $$IPACEDIT^FBAAPET1
"RTN","FBAAEPI",83,0)
 S FBVEN=+$P($G(^FBAA(162.1,FBDA(1),0)),U,4)               ; vendor ien
"RTN","FBAAEPI",84,0)
 S FBIA=+$P($G(^FBAA(162.1,FBDA(1),0)),U,23)               ; IPAC agreement ien
"RTN","FBAAEPI",85,0)
 S FBDODINV=$P($G(^FBAA(162.1,FBDA(1),"RX",FBDA,6)),U,1)   ; DoD invoice#
"RTN","FBAAEPI",86,0)
 Q
"RTN","FBAAEPI",87,0)
 ;
"RTN","FBAAEPI",88,0)
DELIPAC(FBDA) ; Delete all IPAC data on file for Pharmacy (FB*3.5*123)
"RTN","FBAAEPI",89,0)
 ; Called by $$IPACEDIT^FBAAPET1
"RTN","FBAAEPI",90,0)
 N FBIENS,FBIAFDA,DIE,DA,DR,DIC
"RTN","FBAAEPI",91,0)
 S FBIENS=FBDA_","_FBDA(1)_","
"RTN","FBAAEPI",92,0)
 S FBIAFDA(162.11,FBIENS,39)=""       ; remove DoD invoice# from subfile 162.11
"RTN","FBAAEPI",93,0)
 D FILE^DIE("","FBIAFDA")
"RTN","FBAAEPI",94,0)
 S DIE=162.1,DA=FBDA(1),DR="14///@" D ^DIE  ; remove IPAC ptr from file top level 162.1
"RTN","FBAAEPI",95,0)
 Q
"RTN","FBAAEPI",96,0)
 ;
"RTN","FBAAEPI",97,0)
SAVEIPAC(FBDA,FBIA,FBDODINV,WHICH) ; Store IPAC data into the database for Pharmacy (FB*3.5*123)
"RTN","FBAAEPI",98,0)
 ; Called by $$IPACEDIT^FBAAPET1
"RTN","FBAAEPI",99,0)
 N FBIENS,FBIAFDA,DIE,DA,DR,DIC
"RTN","FBAAEPI",100,0)
 S:'$D(WHICH) WHICH=""
"RTN","FBAAEPI",101,0)
 S FBIENS=FBDA_","_FBDA(1)_","
"RTN","FBAAEPI",102,0)
 I WHICH'=1 D
"RTN","FBAAEPI",103,0)
 . S FBIAFDA(162.11,FBIENS,39)=FBDODINV       ; store DoD invoice# in subfile 162.11
"RTN","FBAAEPI",104,0)
 . D FILE^DIE("","FBIAFDA")
"RTN","FBAAEPI",105,0)
 I WHICH'=2 D
"RTN","FBAAEPI",106,0)
 . S DIE=162.1,DA=FBDA(1),DR="14////^S X=FBIA" D ^DIE    ; store IPAC pointer ien in file top level 162.1
"RTN","FBAAEPI",107,0)
 Q
"RTN","FBAAEPI",108,0)
 ;
"RTN","FBAAEPI",109,0)
SODPINV(FBDA) ; check separation of duty for pharmacy invoice
"RTN","FBAAEPI",110,0)
 ; checks all prescriptions on invoice for separation of duty issue
"RTN","FBAAEPI",111,0)
 ; input
"RTN","FBAAEPI",112,0)
 ;   FBDA (required) IEN of pharmacy invoice in file 162.1
"RTN","FBAAEPI",113,0)
 ;   DUZ (current user)
"RTN","FBAAEPI",114,0)
 ; result
"RTN","FBAAEPI",115,0)
 ;   = 0 if user did not enter or edit any associated authorization
"RTN","FBAAEPI",116,0)
 ;   = 1 if user did enter or edit at least one associated authorization
"RTN","FBAAEPI",117,0)
 ;     and thus should be prevented from processing the payment
"RTN","FBAAEPI",118,0)
 N FBDFN,FBFTP,FBI,FBRET
"RTN","FBAAEPI",119,0)
 S FBRET=0
"RTN","FBAAEPI",120,0)
 ; loop thru all Rx on invoice
"RTN","FBAAEPI",121,0)
 S FBI=0 F  S FBI=$O(^FBAA(162.1,FBDA,"RX",FBI)) Q:'FBI  D  Q:FBRET
"RTN","FBAAEPI",122,0)
 . S FBDFN=$P($G(^FBAA(162.1,FBDA,"RX",FBI,0)),U,5)
"RTN","FBAAEPI",123,0)
 . Q:'FBDFN
"RTN","FBAAEPI",124,0)
 . S FBFTP=$P($G(^FBAA(162.1,FBDA,"RX",FBI,2)),U,7)
"RTN","FBAAEPI",125,0)
 . Q:'FBFTP
"RTN","FBAAEPI",126,0)
 . I '$$UOKPAY^FBUTL9(FBDFN,FBFTP) S FBRET=1
"RTN","FBAAEPI",127,0)
 Q FBRET
"RTN","FBAAETA")
0^37^B3716839^B3027950
"RTN","FBAAETA",1,0)
FBAAETA ;AISC/GRR,DMK/CMR - ENTER TRAVEL PAYMENT ONLY ;9/25/2014
"RTN","FBAAETA",2,0)
 ;;3.5;FEE BASIS;**154**;JAN 30, 1995;Build 12
"RTN","FBAAETA",3,0)
 ;;Per VA Directive 6402, this routine should not be modified.
"RTN","FBAAETA",4,0)
RD ;set site parameters
"RTN","FBAAETA",5,0)
 S:$G(FBAAPTC)']"" FBAAPTC="R"
"RTN","FBAAETA",6,0)
 D SITE^FBAACO G END:$G(FBPOP)
"RTN","FBAAETA",7,0)
 ;get veteran
"RTN","FBAAETA",8,0)
 D GETVET^FBAAUTL1 I '$G(DFN) D END Q
"RTN","FBAAETA",9,0)
 ;get authorization
"RTN","FBAAETA",10,0)
 D GETAUTH^FBAAUTL1 G RD:'$G(FTP)
"RTN","FBAAETA",11,0)
 ;
"RTN","FBAAETA",12,0)
 I '$$UOKPAY^FBUTL9(DFN,FTP) D  G RD
"RTN","FBAAETA",13,0)
 . W !!,"You cannot process a payment associated with authorization ",DFN,"-",FTP
"RTN","FBAAETA",14,0)
 . W !,"due to separation of duties."
"RTN","FBAAETA",15,0)
 ;
"RTN","FBAAETA",16,0)
 ;call to verify veteran address data
"RTN","FBAAETA",17,0)
 D ^FBAACO0
"RTN","FBAAETA",18,0)
 ;check for travel multiple dd reference
"RTN","FBAAETA",19,0)
 S DA(1)=+$G(DFN)
"RTN","FBAAETA",20,0)
 I '$D(^FBAAC(DA(1),3,0)) S ^(0)="^162.04DA^^"
"RTN","FBAAETA",21,0)
RD1 W !! S DIC="^FBAAC(DA(1),3,",DIC(0)="AEQLM",DLAYGO=162 D ^DIC K DLAYGO
"RTN","FBAAETA",22,0)
 G END:X="^"!(X=""),RD1:Y<0 S DA=+Y,FBNEW=$P(Y,"^",3)
"RTN","FBAAETA",23,0)
 S FBTRVDT=$P(Y,U,2)
"RTN","FBAAETA",24,0)
 ;check if travel date within selected authorization if 'kill and reask
"RTN","FBAAETA",25,0)
 I $G(FBAABDT),$G(FBAAEDT),(FBTRVDT<FBAABDT!(FBTRVDT>FBAAEDT)) D  D KILL G RD1
"RTN","FBAAETA",26,0)
 . W !!,*7,"Date of Travel is ",$S(FBTRVDT<FBAABDT:"prior to",1:"after")," authorization date.",!
"RTN","FBAAETA",27,0)
 ;set travel payment
"RTN","FBAAETA",28,0)
 S DIE=DIC,DR=".01;1;2;3.5///^S X=FBAAPTC;15///^S X=FTP" D ^DIE I $G(FBNEW)&($D(Y)'=0) D KILL,END
"RTN","FBAAETA",29,0)
 G RD
"RTN","FBAAETA",30,0)
 ;
"RTN","FBAAETA",31,0)
END K DIC,DIE,DR,X,Y,DA,C,D0,D1,DI,DIYS,Z,FBNEW,DLAYGO,FB1,FB2,FBTRVDT
"RTN","FBAAETA",32,0)
 D Q^FBAACO
"RTN","FBAAETA",33,0)
 Q
"RTN","FBAAETA",34,0)
KILL ;KILLS ENTRY IF USER UP-ARROWED DURING ENTRY
"RTN","FBAAETA",35,0)
 W !!,*7,"Travel Payment entry not complete.   Deleting entry..."
"RTN","FBAAETA",36,0)
 S DIK="^FBAAC("_DA(1)_",3," D ^DIK Q
"RTN","FBAAFED")
0^2^B26728323^B27873786
"RTN","FBAAFED",1,0)
FBAAFED ;WOIFO/SAB - FPPS DATA EDIT OUTPATIENT/ANCILLARY INVOICE ;5/15/14  12:49
"RTN","FBAAFED",2,0)
 ;;3.5;FEE BASIS;**61,154**;JAN 30, 1995;Build 12
"RTN","FBAAFED",3,0)
 ;;Per VA Directive 6402, this routine should not be modified.
"RTN","FBAAFED",4,0)
 ;
"RTN","FBAAFED",5,0)
 S FBAAOUT=0
"RTN","FBAAFED",6,0)
 F  D INVED Q:FBAAOUT
"RTN","FBAAFED",7,0)
 D CLEAN
"RTN","FBAAFED",8,0)
 Q
"RTN","FBAAFED",9,0)
 ;
"RTN","FBAAFED",10,0)
INVED ; Invoice Edit
"RTN","FBAAFED",11,0)
 ;
"RTN","FBAAFED",12,0)
ASKINV ; Select Invoice to Edit
"RTN","FBAAFED",13,0)
 W !
"RTN","FBAAFED",14,0)
 S DIR(0)="NO",DIR("A")="Select Invoice Number"
"RTN","FBAAFED",15,0)
 S DIR("?")="^D HELP^FBAAPIN1"
"RTN","FBAAFED",16,0)
 D ^DIR K DIR I $D(DIRUT)!(Y="") S FBAAOUT=1 Q
"RTN","FBAAFED",17,0)
 I '$D(^FBAAC("C",Y)) W !,$C(7),"Invalid selection.",! G ASKINV
"RTN","FBAAFED",18,0)
 S FBAAIN=Y
"RTN","FBAAFED",19,0)
 ;
"RTN","FBAAFED",20,0)
 I $$CKFPPS^FBFHLL(FBAAIN)'=1 D  G ASKINV
"RTN","FBAAFED",21,0)
 . W !?5,"Invoice ",FBAAIN," has not been transmitted to FPPS."
"RTN","FBAAFED",22,0)
 ;
"RTN","FBAAFED",23,0)
 ; Get Lines on Invoice
"RTN","FBAAFED",24,0)
 D MILL^FBAAPET1(FBAAIN,.FBMILL)
"RTN","FBAAFED",25,0)
 ;
"RTN","FBAAFED",26,0)
 ; Determine Vendor and FPPS CLAIM ID based on first line on invoice
"RTN","FBAAFED",27,0)
 S FBIENS=FBMILL($O(FBMILL(0)))
"RTN","FBAAFED",28,0)
 S FBV=$P(FBIENS,",",3)
"RTN","FBAAFED",29,0)
 S (FBFPPSC,FBFPPSC(0))=$$GET1^DIQ(162.03,FBIENS,50)
"RTN","FBAAFED",30,0)
 ;
"RTN","FBAAFED",31,0)
 I FBFPPSC="" D  G ASKINV
"RTN","FBAAFED",32,0)
 . W !,$C(7),"Only EDI Claims can be selected!"
"RTN","FBAAFED",33,0)
 ;
"RTN","FBAAFED",34,0)
 S FBINVCHG=0 ; initialize invoice changed flag
"RTN","FBAAFED",35,0)
 ;
"RTN","FBAAFED",36,0)
EDITFC ; edit FPPS CLAIM ID
"RTN","FBAAFED",37,0)
 S FBX=$$FPPSC^FBUTL5(1,FBFPPSC)
"RTN","FBAAFED",38,0)
 I FBX=-1 S FBAAOUT=1 G INVEDX
"RTN","FBAAFED",39,0)
 ; need to verify if following restriction is appropriate
"RTN","FBAAFED",40,0)
 I FBX="" D  G EDITFC
"RTN","FBAAFED",41,0)
 . W !,$C(7),"Can not change EDI from YES to NO on invoice that has been sent to FPPS!"
"RTN","FBAAFED",42,0)
 S FBFPPSC=FBX
"RTN","FBAAFED",43,0)
 ;
"RTN","FBAAFED",44,0)
 ; if FPPS CLAIM ID changed, then update file, audit log, and lines
"RTN","FBAAFED",45,0)
 I FBFPPSC'=FBFPPSC(0) D
"RTN","FBAAFED",46,0)
 . ; set invoice changed flag
"RTN","FBAAFED",47,0)
 . S FBINVCHG=1
"RTN","FBAAFED",48,0)
 . ;
"RTN","FBAAFED",49,0)
 . K FBFDA
"RTN","FBAAFED",50,0)
 . ; loop thru lines on invoice
"RTN","FBAAFED",51,0)
 . S FBI=0 F  S FBI=$O(FBMILL(FBI)) Q:'FBI  D
"RTN","FBAAFED",52,0)
 . . S FBIENS=FBMILL(FBI)
"RTN","FBAAFED",53,0)
 . . ; file data in 162.03 for each line
"RTN","FBAAFED",54,0)
 . . S FBFDA(162.03,FBIENS,50)=$S(FBFPPSC="":"@",1:FBFPPSC)
"RTN","FBAAFED",55,0)
 . . ;
"RTN","FBAAFED",56,0)
 . . ; add record to audit log
"RTN","FBAAFED",57,0)
 . . K FBFDAA
"RTN","FBAAFED",58,0)
 . . S FBFDAA(163.7,"+1,",.01)=FBAAIN ; invoice number
"RTN","FBAAFED",59,0)
 . . S FBFDAA(163.7,"+1,",1)=$$NOW^XLFDT() ; date/time changed
"RTN","FBAAFED",60,0)
 . . S FBFDAA(163.7,"+1,",2)=162.03 ; file #
"RTN","FBAAFED",61,0)
 . . S FBFDAA(163.7,"+1,",3)=FBIENS ; iens
"RTN","FBAAFED",62,0)
 . . S FBFDAA(163.7,"+1,",4)=50 ; field #
"RTN","FBAAFED",63,0)
 . . S FBFDAA(163.7,"+1,",5)=FBFPPSC(0) ; old value
"RTN","FBAAFED",64,0)
 . . S FBFDAA(163.7,"+1,",6)=FBFPPSC ; new value
"RTN","FBAAFED",65,0)
 . . S FBFDAA(163.7,"+1,",7)=DUZ ; user
"RTN","FBAAFED",66,0)
 . . I $D(FBFDAA) D UPDATE^DIE("","FBFDAA") D MSG^DIALOG()
"RTN","FBAAFED",67,0)
 . . ;
"RTN","FBAAFED",68,0)
 . I $D(FBFDA) D FILE^DIE("","FBFDA") D MSG^DIALOG()
"RTN","FBAAFED",69,0)
 ;
"RTN","FBAAFED",70,0)
ASKLINE ; Select Line to Edit
"RTN","FBAAFED",71,0)
 ;
"RTN","FBAAFED",72,0)
ASKPT ; Select Patient
"RTN","FBAAFED",73,0)
 W !
"RTN","FBAAFED",74,0)
 S DIC="^FBAAC(",DIC(0)="AEQM"
"RTN","FBAAFED",75,0)
 D ^DIC K DIC I $D(DTOUT)!$D(DUOUT) G INVEDX
"RTN","FBAAFED",76,0)
 I Y'>0 D  G:$D(DIRUT) INVEDX G:'Y ASKPT G INVEDX
"RTN","FBAAFED",77,0)
 . S DIR(0)="Y"
"RTN","FBAAFED",78,0)
 . S DIR("A")="Are you finished entering patients for this invoice"
"RTN","FBAAFED",79,0)
 . D ^DIR K DIR I $D(DIRUT) S FBAAOUT=1
"RTN","FBAAFED",80,0)
 S FBDA(3)=+Y
"RTN","FBAAFED",81,0)
 ;
"RTN","FBAAFED",82,0)
ASKVEN ; Select Vendor
"RTN","FBAAFED",83,0)
 W !
"RTN","FBAAFED",84,0)
 ;S DIC(0)="AEQM"
"RTN","FBAAFED",85,0)
 ;S DIC="^FBAAC("_FBDA(3)_",1,"
"RTN","FBAAFED",86,0)
 ;D ^DIC K DIC I $D(DTOUT)!$D(DUOUT) G INVEDX
"RTN","FBAAFED",87,0)
 ;I Y'>0 D  G:$D(DIRUT) INVEDX G:'Y ASKVEN G ASKPT
"RTN","FBAAFED",88,0)
 ;. S DIR(0)="Y"
"RTN","FBAAFED",89,0)
 ;. S DIR("A")="Are you finished entering vendors for this patient"
"RTN","FBAAFED",90,0)
 ;. D ^DIR K DIR I $D(DIRUT) S FBAAOUT=1
"RTN","FBAAFED",91,0)
 ;S FBDA(2)=+Y
"RTN","FBAAFED",92,0)
 S FBDA(2)=FBV
"RTN","FBAAFED",93,0)
 W !,"Vendor = ",$P($G(^FBAAV(FBV,0)),U)
"RTN","FBAAFED",94,0)
 ;
"RTN","FBAAFED",95,0)
ASKDOS ; Select Date of Service
"RTN","FBAAFED",96,0)
 W !
"RTN","FBAAFED",97,0)
 S DIC(0)="AEQM"
"RTN","FBAAFED",98,0)
 S DIC="^FBAAC("_FBDA(3)_",1,"_FBDA(2)_",1,"
"RTN","FBAAFED",99,0)
 S DIC("A")="Select DATE OF SERVICE: "
"RTN","FBAAFED",100,0)
 D ^DIC K DIC I $D(DTOUT)!$D(DUOUT) G INVEDX
"RTN","FBAAFED",101,0)
 I Y'>0 D  G:$D(DIRUT) INVEDX G:'Y ASKDOS G ASKPT
"RTN","FBAAFED",102,0)
 . S DIR(0)="Y"
"RTN","FBAAFED",103,0)
 . S DIR("A")="Are you finished entering dates for this patient"
"RTN","FBAAFED",104,0)
 . D ^DIR K DIR I $D(DIRUT) S FBAAOUT=1
"RTN","FBAAFED",105,0)
 S FBDA(1)=+Y
"RTN","FBAAFED",106,0)
 ;
"RTN","FBAAFED",107,0)
ASKSVC ; Select Service Provided
"RTN","FBAAFED",108,0)
 W !
"RTN","FBAAFED",109,0)
 S DIC(0)="AEQM"
"RTN","FBAAFED",110,0)
 S DIC="^FBAAC("_FBDA(3)_",1,"_FBDA(2)_",1,"_FBDA(1)_",1,"
"RTN","FBAAFED",111,0)
 D ^DIC K DIC I $D(DTOUT)!$D(DUOUT) G INVEDX
"RTN","FBAAFED",112,0)
 I Y'>0 D  G:$D(DIRUT) INVEDX G:'Y ASKSVC G ASKDOS
"RTN","FBAAFED",113,0)
 . S DIR(0)="Y"
"RTN","FBAAFED",114,0)
 . S DIR("A")="Are you finished entering services for this date"
"RTN","FBAAFED",115,0)
 . D ^DIR K DIR I $D(DIRUT) S FBAAOUT=1
"RTN","FBAAFED",116,0)
 S FBDA=+Y
"RTN","FBAAFED",117,0)
 ;
"RTN","FBAAFED",118,0)
 S FBIENS=FBDA_","_FBDA(1)_","_FBDA(2)_","_FBDA(3)_","
"RTN","FBAAFED",119,0)
 ;
"RTN","FBAAFED",120,0)
 ; check if line is on invoice
"RTN","FBAAFED",121,0)
 I $$GET1^DIQ(162.03,FBIENS,14)'=FBAAIN D  G ASKSVC
"RTN","FBAAFED",122,0)
 . W $C(7),!,"Line is not on invoice ",FBAAIN,"!"
"RTN","FBAAFED",123,0)
 ;
"RTN","FBAAFED",124,0)
 ; get current value of FPPS LINE ITEM to use as default
"RTN","FBAAFED",125,0)
 S (FBFPPSL(0),FBFPPSL)=$$GET1^DIQ(162.03,FBIENS,51)
"RTN","FBAAFED",126,0)
 ;
"RTN","FBAAFED",127,0)
EDITFL ; edit FPPS Line Item
"RTN","FBAAFED",128,0)
 S FBX=$$FPPSL^FBUTL5(FBFPPSL)
"RTN","FBAAFED",129,0)
 I FBX=-1 S FBAAOUT=1 G INVEDX
"RTN","FBAAFED",130,0)
 ; need to verify if following restriction is appropriate
"RTN","FBAAFED",131,0)
 S FBFPPSL=FBX
"RTN","FBAAFED",132,0)
 ;
"RTN","FBAAFED",133,0)
 ; if FPPS LINE ITEM changed, then update file and audit log
"RTN","FBAAFED",134,0)
 I FBFPPSL'=FBFPPSL(0) D
"RTN","FBAAFED",135,0)
 . ; set invoice changed flag
"RTN","FBAAFED",136,0)
 . S FBINVCHG=1
"RTN","FBAAFED",137,0)
 . ;
"RTN","FBAAFED",138,0)
 . ; file data in 162.03
"RTN","FBAAFED",139,0)
 . K FBFDA
"RTN","FBAAFED",140,0)
 . S FBFDA(162.03,FBIENS,51)=FBFPPSL
"RTN","FBAAFED",141,0)
 . I $D(FBFDA) D FILE^DIE("","FBFDA") D MSG^DIALOG()
"RTN","FBAAFED",142,0)
 . ;
"RTN","FBAAFED",143,0)
 . ; add record to audit log
"RTN","FBAAFED",144,0)
 . K FBFDA
"RTN","FBAAFED",145,0)
 . S FBFDA(163.7,"+1,",.01)=FBAAIN ; invoice number
"RTN","FBAAFED",146,0)
 . S FBFDA(163.7,"+1,",1)=$$NOW^XLFDT() ; date/time changed
"RTN","FBAAFED",147,0)
 . S FBFDA(163.7,"+1,",2)=162.03 ; file #
"RTN","FBAAFED",148,0)
 . S FBFDA(163.7,"+1,",3)=FBIENS ; iens
"RTN","FBAAFED",149,0)
 . S FBFDA(163.7,"+1,",4)=51 ; field #
"RTN","FBAAFED",150,0)
 . S FBFDA(163.7,"+1,",5)=FBFPPSL(0) ; old value
"RTN","FBAAFED",151,0)
 . S FBFDA(163.7,"+1,",6)=FBFPPSL ; new value
"RTN","FBAAFED",152,0)
 . S FBFDA(163.7,"+1,",7)=DUZ ; user
"RTN","FBAAFED",153,0)
 . I $D(FBFDA) D UPDATE^DIE("","FBFDA") D MSG^DIALOG()
"RTN","FBAAFED",154,0)
 ;
"RTN","FBAAFED",155,0)
 G ASKSVC
"RTN","FBAAFED",156,0)
 ;
"RTN","FBAAFED",157,0)
INVEDX ; Invoice Edit Exit
"RTN","FBAAFED",158,0)
 ; if invoice changed then queue for retransmit to FPPS
"RTN","FBAAFED",159,0)
 I FBINVCHG D FILEQUE^FBFHLL(FBAAIN,3)
"RTN","FBAAFED",160,0)
 Q
"RTN","FBAAFED",161,0)
 ;
"RTN","FBAAFED",162,0)
CLEAN K D,DIC,DIR,DIROUT,DIRUT,DTOUT,DUOUT,X,Y
"RTN","FBAAFED",163,0)
 K FBAAIN,FBAAOUT,FBDA,FBFDA,FBFDAA,FBIENS,FBFPPSC,FBFPPSL,FBINVCHG
"RTN","FBAAFED",164,0)
 K FBMILL,FBV,FBX
"RTN","FBAAFED",165,0)
 Q
"RTN","FBAAFED",166,0)
 ;FBAAFED
"RTN","FBAAMP")
0^19^B134317556^B145435703
"RTN","FBAAMP",1,0)
FBAAMP ;AISC/CMR - MULTIPLE PAYMENT ENTRY ;10/23/14  12:47
"RTN","FBAAMP",2,0)
 ;;3.5;FEE BASIS;**4,21,38,55,61,67,116,108,143,123,154**;JAN 30, 1995;Build 12
"RTN","FBAAMP",3,0)
 ;;Per VA Directive 6402, this routine should not be modified.
"RTN","FBAAMP",4,0)
 S FBMP=1 ;multiple payment flag
"RTN","FBAAMP",5,0)
 G ^FBAACO
"RTN","FBAAMP",6,0)
1 ;return from FBAACO
"RTN","FBAAMP",7,0)
 D MMPPT^FBAACO G:$G(FBAAOUT) Q1
"RTN","FBAAMP",8,0)
 D MPDT I 'FBMPDT G Q1
"RTN","FBAAMP",9,0)
 K FBAAOUT W ! D CPTM^FBAALU(FBMPDT,DFN) I 'FBGOT G Q1
"RTN","FBAAMP",10,0)
 ; prompt revenue code
"RTN","FBAAMP",11,0)
 S FBAARC=$$ASKREVC^FBUTL5() I FBAARC="^" S FBAAOUT=1 G Q1
"RTN","FBAAMP",12,0)
 ; prompt units paid
"RTN","FBAAMP",13,0)
 S FBUNITS=$$ASKUNITS^FBUTL5() I FBUNITS="^" S FBAAOUT=1 G Q1
"RTN","FBAAMP",14,0)
 S FY=$E(DT,1,3)+1700+$S($E(DT,4,5)>9:1,1:0)
"RTN","FBAAMP",15,0)
 D ASKZIP^FBAAFS($G(FBV)) I $G(FBAAOUT)!($G(FBZIP)']"") G Q1
"RTN","FBAAMP",16,0)
 I $$ANES^FBAAFS($$CPT^FBAAUTL4(FBAACP)) D ASKTIME^FBAAFS I $G(FBAAOUT)!('$G(FBTIME)) G Q1
"RTN","FBAAMP",17,0)
 D HCFA^FBAAMP1 G Q1:$G(FBAAOUT)
"RTN","FBAAMP",18,0)
AMTCL S DIR(0)="162.03,1",DIR("A")="AMOUNT CLAIMED",DIR("?")="Enter the amount being claimed by the vendor" D ^DIR K DIR G Q:$D(DIRUT) S FBJ=+Y
"RTN","FBAAMP",19,0)
 W ! S DIR("A")="Is $"_FBJ_" correct for Amount Claimed",DIR("B")="Yes",DIR(0)="Y" D ^DIR K DIR G Q:$D(DIRUT),AMTCL:'Y
"RTN","FBAAMP",20,0)
RDAP D FEE G Q:$G(FBAAOUT) S FBK=FBAMTPD W ! S DIR("A")="Is $"_FBK_" correct for Amount Paid",DIR("B")="Yes",DIR(0)="Y" D ^DIR K DIR G Q:$D(DIRUT),RDAP:'Y
"RTN","FBAAMP",21,0)
 S FBAAAS=0 K FBADJ I FBJ-FBK D SUSP^FBAAMP1 I $G(FBAAOUT) G Q:$D(DUOUT),Q1
"RTN","FBAAMP",22,0)
 S FBJ=+FBJ,FBK=+FBK,FBAAAS=+FBAAAS
"RTN","FBAAMP",23,0)
 ; prompt for remittance remarks
"RTN","FBAAMP",24,0)
 I $$RR^FBUTL4(.FBRRMK,2)=0 S FBAAOUT=1 G Q1
"RTN","FBAAMP",25,0)
MULT W:FBINTOT>0 !,"Invoice: "_FBAAIN_" Totals: $ "_FBINTOT
"RTN","FBAAMP",26,0)
 W !! S %DT("A")="Date of Service: ",%DT="AEPX" D ^%DT G Q1:X=""!(X="^")
"RTN","FBAAMP",27,0)
 D DATCK^FBAAUTL G MULT:'$D(X)!(Y<0)
"RTN","FBAAMP",28,0)
 S FBDT=Y
"RTN","FBAAMP",29,0)
 I '$$CHKCPT() W !,$C(7),"Invalid Date of Service." G MULT
"RTN","FBAAMP",30,0)
 I $$CHKICD9^FBCSV1(+$G(FBHCFA(28)),$G(FBDT))="" G MULT
"RTN","FBAAMP",31,0)
 I '$G(FBAAMM1),'$$CHKFS() W !,$C(7),"Invalid Date of Service." G MULT
"RTN","FBAAMP",32,0)
 S DIR(0)="Y",DIR("A")="Is "_($$DATX^FBAAUTL(FBDT))_" correct",DIR("B")="Yes" D ^DIR K DIR G MULT:$D(DIRUT)!('Y)
"RTN","FBAAMP",33,0)
 S FBAADT=FBDT
"RTN","FBAAMP",34,0)
 S FBMODL=$$MODL^FBAAUTL4("FBMODA","I")
"RTN","FBAAMP",35,0)
 I $D(^FBAAC("AE",DFN,FBV,FBAADT,FBAACP_$S($G(FBMODL)]"":"-"_FBMODL,1:""))) S DIR(0)="Y",DIR("A")="Code already exists for that date!  Want to add another service for the SAME DATE",DIR("B")="No" D ^DIR K DIR G MULT:$D(DIRUT)!('Y)
"RTN","FBAAMP",36,0)
 I FBFPPSC]"" S FBFPPSL=$$FPPSL^FBUTL5() I FBFPPSL=-1 G Q1
"RTN","FBAAMP",37,0)
 W !! D GETSVDT^FBAACO5(DFN,FBV,FBASSOC,0,FBAADT) G Q:$G(FBAAOUT)
"RTN","FBAAMP",38,0)
 D SETO^FBAACO3,SVCPR^FBAACO1 G Q:$G(FBAAOUT)
"RTN","FBAAMP",39,0)
FILE S TP="",DR="1///^S X=FBJ;Q;2///^S X=FBK;47///^S X=FBUNITS"
"RTN","FBAAMP",40,0)
 I FBCSID]"" S DR=DR_";49///^S X=FBCSID"
"RTN","FBAAMP",41,0)
 I FBFPPSC]"" S DR=DR_";50///^S X=FBFPPSC;51///^S X=FBFPPSL"
"RTN","FBAAMP",42,0)
 I FBAARC]"" S DR=DR_";48////^S X=FBAARC"
"RTN","FBAAMP",43,0)
 S DR(1,162.03,1)="6////^S X=DUZ;7////^S X=FBAABE;8////^S X=BO;13///^S X=FBAAID;14///^S X=FBAAIN;15///^S X=FBPT;16////^S X=FBPOV;17///^S X=FBTT;18///^S X=FBAAPTC;23////^S X=FBTYPE;26////^S X=FBPSA"
"RTN","FBAAMP",44,0)
 S DR(1,162.03,2)="34///^S X=$G(FBAAMM1);54////^S X=$G(FBCNTRP);28////^S X=FBHCFA(28);30////^S X=FBHCFA(30);31////^S X=FBHCFA(31);32////^S X=FBHCFA(32);33///^S X=FBAAVID;44///^S X=FBFSAMT;45////^S X=FBFSUSD"
"RTN","FBAAMP",45,0)
 S DR(1,162.03,3)=".05////^S X=$G(FBIA);.055///^S X=$G(FBDODINV)"         ; FB*3.5*123
"RTN","FBAAMP",46,0)
 S DIE="^FBAAC("_DFN_",1,"_FBV_",1,"_FBSDI_",1,"
"RTN","FBAAMP",47,0)
 S DA=FBAACPI,DA(1)=FBSDI,DA(2)=FBV,DA(3)=DFN
"RTN","FBAAMP",48,0)
 D LOCK^FBUCUTL(DIE,FBAACPI,1)
"RTN","FBAAMP",49,0)
 D ^DIE
"RTN","FBAAMP",50,0)
 D FILEADJ^FBAAFA(FBAACPI_","_FBSDI_","_FBV_","_DFN_",",.FBADJ)
"RTN","FBAAMP",51,0)
 D FILERR^FBAAFR(FBAACPI_","_FBSDI_","_FBV_","_DFN_",",.FBRRMK)
"RTN","FBAAMP",52,0)
 L -^FBAAC(DFN,1,FBV,1,FBSDI,1,FBAACPI)
"RTN","FBAAMP",53,0)
 S FBINTOT=FBINTOT+FBK
"RTN","FBAAMP",54,0)
 W " ....OK, DONE...."
"RTN","FBAAMP",55,0)
 ; HIPAA 5010 - count line items that have 0.00 amount paid
"RTN","FBAAMP",56,0)
 S Z1=$P(^FBAA(161.7,FBAABE,0),"^",11)+1,$P(^(0),"^",11)=Z1
"RTN","FBAAMP",57,0)
 W:Z1>(FBAAMPI-20) !,*7,"Warning, you can only enter ",(FBAAMPI-Z1)," more line items!" I Z1>(FBAAMPI-1) D  S FBMAX=1 G Q1
"RTN","FBAAMP",58,0)
 .W !!,*7,"You have reached the maximum number of payments for a Batch!",!,"You must select another Batch for entering Payments!"
"RTN","FBAAMP",59,0)
 G MULT
"RTN","FBAAMP",60,0)
Q1 K FBADJ,FBAADT,FBX,FBAACP,DIC,DIE,X,Y,DIRUT,DUOUT,DTOUT,FBOUT,FBSI,FBMPDT,FBIA,FBDODINV G ^FBAACO:$D(FBMAX),1^FBAACO
"RTN","FBAAMP",61,0)
 ;
"RTN","FBAAMP",62,0)
Q ;kill variables and exit
"RTN","FBAAMP",63,0)
 D Q^FBAACO
"RTN","FBAAMP",64,0)
 Q
"RTN","FBAAMP",65,0)
 ;
"RTN","FBAAMP",66,0)
MPDT ;
"RTN","FBAAMP",67,0)
 S FBMPDT=""
"RTN","FBAAMP",68,0)
 S DIR(0)="D^::EX"
"RTN","FBAAMP",69,0)
 S DIR("A")="Enter date to use for CPT/ICD checks and fee schedule calc"
"RTN","FBAAMP",70,0)
 S DIR("B")="TODAY"
"RTN","FBAAMP",71,0)
 S DIR("?",1)="Enter a date. This date will be used when checking for"
"RTN","FBAAMP",72,0)
 S DIR("?",2)="an active CPT/Modifier/ICD code. Also, the fee schedule"
"RTN","FBAAMP",73,0)
 S DIR("?",3)="amount will be computed based on this date."
"RTN","FBAAMP",74,0)
 S DIR("?")="Enter '^' to exit."
"RTN","FBAAMP",75,0)
 W !
"RTN","FBAAMP",76,0)
 D ^DIR K DIR S:'$D(DIRUT) FBMPDT=Y
"RTN","FBAAMP",77,0)
 Q
"RTN","FBAAMP",78,0)
 ;
"RTN","FBAAMP",79,0)
FEE N FBX,FB1725
"RTN","FBAAMP",80,0)
 ; set FB1725 flag = true if payment for a 38 U.S.C. 1725 claim
"RTN","FBAAMP",81,0)
 S FB1725=$S($G(FB583):+$P($G(^FB583(+FB583,0)),U,28),1:0)
"RTN","FBAAMP",82,0)
 S FBFY=FY-1
"RTN","FBAAMP",83,0)
 S (FBFSAMT,FBFSUSD,FBAMFS)=""
"RTN","FBAAMP",84,0)
 ; FB*3.5*143 Adding FB1725 as a parameter to prevent reduction 
"RTN","FBAAMP",85,0)
 ; of local fee schedule payments
"RTN","FBAAMP",86,0)
 S FBX=$$GET^FBAAFS($$CPT^FBAAUTL4(FBAACP),$$MODL^FBAAUTL4("FBMODA","E"),FBMPDT,$G(FBZIP),$$FAC^FBAAFS($G(FBHCFA(30))),$G(FBTIME),$G(FB1725))
"RTN","FBAAMP",87,0)
 ;
"RTN","FBAAMP",88,0)
 I '$G(FBAAMM1) D
"RTN","FBAAMP",89,0)
 . S FBFSAMT=$P(FBX,U),FBFSUSD=$P(FBX,U,2)
"RTN","FBAAMP",90,0)
 E  D
"RTN","FBAAMP",91,0)
 . W !,?2,"Payment is for a contracted service so fee schedule does not apply."
"RTN","FBAAMP",92,0)
 ;
"RTN","FBAAMP",93,0)
 I $P($G(FBX),U)]"" D
"RTN","FBAAMP",94,0)
 . W !?2,$S($G(FBAAMM1):"However, f",1:"F")
"RTN","FBAAMP",95,0)
 . W "ee schedule amount is $",$P(FBX,U)," from the "
"RTN","FBAAMP",96,0)
 . W:$P(FBX,U,3)]"" $P(FBX,U,3)," " ; year if returned
"RTN","FBAAMP",97,0)
 . W:$P(FBX,U,2)]"" $$EXTERNAL^DILFD(162.03,45,"",$P(FBX,U,2))
"RTN","FBAAMP",98,0)
 E  W !?2,"Unable to determine a FEE schedule amount."
"RTN","FBAAMP",99,0)
 ;
"RTN","FBAAMP",100,0)
 ; FB*3.5*143 - Preventing 70% reduction of 75th percentile rates
"RTN","FBAAMP",101,0)
 I FB1725,FBFSUSD'="F" D
"RTN","FBAAMP",102,0)
 . W !!?2,"**Payment is for emergency treatment under 38 U.S.C. 1725."
"RTN","FBAAMP",103,0)
 . I FBFSAMT D
"RTN","FBAAMP",104,0)
 . . S FBFSAMT=$J(FBFSAMT*.7,0,2)
"RTN","FBAAMP",105,0)
 . . W !?2,"  Therefore, fee schedule amount reduced to $",FBFSAMT," (70%)."
"RTN","FBAAMP",106,0)
 ;
"RTN","FBAAMP",107,0)
 I $G(FBUNITS)>1 D
"RTN","FBAAMP",108,0)
 . W !!?2,"Units Paid = ",FBUNITS
"RTN","FBAAMP",109,0)
 . Q:FBFSAMT'>0
"RTN","FBAAMP",110,0)
 . N FBFSUNIT
"RTN","FBAAMP",111,0)
 . ; determine if fee schedule can be multiplied by units
"RTN","FBAAMP",112,0)
 . S FBFSUNIT=$S(FBFSUSD="R":1,FBFSUSD="F"&(FBMPDT>3040930):1,1:0)
"RTN","FBAAMP",113,0)
 . I FBFSUNIT D
"RTN","FBAAMP",114,0)
 . . S FBFSAMT=$J(FBFSAMT*FBUNITS,0,2)
"RTN","FBAAMP",115,0)
 . . W !?2,"  Therefore, fee schedule amount increased to $",FBFSAMT
"RTN","FBAAMP",116,0)
 . E  D
"RTN","FBAAMP",117,0)
 . . W !?2,"  Fee schedule not complied on per unit basis so amount not adjusted by units."
"RTN","FBAAMP",118,0)
 ;
"RTN","FBAAMP",119,0)
 I '$G(FBAAMM1) D
"RTN","FBAAMP",120,0)
 . ; set default amount paid to lesser of amt claimed (J) or fee sched.
"RTN","FBAAMP",121,0)
 . S FBAMFS=$S(FBFSAMT>$G(FBJ):$G(FBJ),1:FBFSAMT)
"RTN","FBAAMP",122,0)
 ;
"RTN","FBAAMP",123,0)
 W !
"RTN","FBAAMP",124,0)
 ;
"RTN","FBAAMP",125,0)
AMTPD K DIR S DIR(0)="162.03,2",DIR("A")="AMOUNT PAID" S:$G(FBAMFS)'="" DIR("B")=FBAMFS D ^DIR K DIR I $D(DIRUT) S FBAAOUT=1 Q
"RTN","FBAAMP",126,0)
 S FBAMTPD=+Y K FBAMFS Q
"RTN","FBAAMP",127,0)
 ;
"RTN","FBAAMP",128,0)
CHKCPT() ; check if CPT/Modifier active on date of service
"RTN","FBAAMP",129,0)
 N FBCPTX,FBI,FBMOD,FBMODX,FBRET
"RTN","FBAAMP",130,0)
 S FBRET=1
"RTN","FBAAMP",131,0)
 S FBCPTX=$$CPT^ICPTCOD(FBAACP,FBDT,1)
"RTN","FBAAMP",132,0)
 I '$P(FBCPTX,U,7) S FBRET=0 W !,"  CPT Code ",$P(FBCPTX,U,2)," inactive on date of service."
"RTN","FBAAMP",133,0)
 I $O(FBMODA(0)) D
"RTN","FBAAMP",134,0)
 . S FBI=0 F  S FBI=$O(FBMODA(FBI)) Q:'FBI  D
"RTN","FBAAMP",135,0)
 . . S FBMODX=$$MOD^ICPTMOD(FBMODA(FBI),"I",FBDT,1)
"RTN","FBAAMP",136,0)
 . . I '$P(FBMODX,U,7) S FBRET=0 W !,"  CPT Modifier ",$P(FBMODX,U,2)," inactive on date of service."
"RTN","FBAAMP",137,0)
 Q FBRET
"RTN","FBAAMP",138,0)
 ;
"RTN","FBAAMP",139,0)
CHKFS() ; check if fee schedule amount is different on date of service
"RTN","FBAAMP",140,0)
 N FBX,FBRET,FB1725
"RTN","FBAAMP",141,0)
 S FBRET=1 ; return value - true if date of service allowed
"RTN","FBAAMP",142,0)
 ; set FB1725 flag = true if payment for a 38 U.S.C. 1725 claim
"RTN","FBAAMP",143,0)
 S FB1725=$S($G(FB583):+$P($G(^FB583(+FB583,0)),U,28),1:0)
"RTN","FBAAMP",144,0)
 S FBX=$$GET^FBAAFS($$CPT^FBAAUTL4(FBAACP),$$MODL^FBAAUTL4("FBMODA","E"),FBDT,$G(FBZIP),$$FAC^FBAAFS($G(FBHCFA(30))),$G(FBTIME),$G(FB1725))
"RTN","FBAAMP",145,0)
 ; set FB1725 flag = true if payment for a 38 U.S.C. 1725 claim
"RTN","FBAAMP",146,0)
 S FB1725=$S($G(FB583):+$P($G(^FB583(+FB583,0)),U,28),1:0)
"RTN","FBAAMP",147,0)
 ; adjust amount if mill bill
"RTN","FBAAMP",148,0)
 I FB1725 S $P(FBX,U)=$J($P(FBX,U)*.7,0,2)
"RTN","FBAAMP",149,0)
 ; adjust amount if units > 1
"RTN","FBAAMP",150,0)
 I $G(FBUNITS) D
"RTN","FBAAMP",151,0)
 . N FBFSUNIT
"RTN","FBAAMP",152,0)
 . ; determine if fee schedule can be multiplied by units
"RTN","FBAAMP",153,0)
 . S FBFSUNIT=$S($P(FBX,U,2)="R":1,$P(FBX,U,2)="F"&(FBDT>3040930):1,1:0)
"RTN","FBAAMP",154,0)
 . I FBFSUNIT S $P(FBX,U)=$J($P(FBX,U)*FBUNITS,0,2)
"RTN","FBAAMP",155,0)
 ; issue warning if lesser of claim and fee schedule amount different
"RTN","FBAAMP",156,0)
 I +$S($P(FBX,U)>$G(FBJ):$G(FBJ),1:$P(FBX,U))'=+$S(FBFSAMT>$G(FBJ):$G(FBJ),1:FBFSAMT) D
"RTN","FBAAMP",157,0)
 . W !,"  Warning: The fee schedule amount (",$P(FBX,U),") for this date of service "
"RTN","FBAAMP",158,0)
 . W !,"  differs from the initial fee schedule amount (",FBFSAMT,")."
"RTN","FBAAMP",159,0)
 . I $P(FBX,U)>0,FBK>$P(FBX,U) D
"RTN","FBAAMP",160,0)
 . . W !,"  Amount paid (",FBK,") exceeds the fee schedule amount."
"RTN","FBAAMP",161,0)
 . W:FBRET !,"  You may want to separately process this date of service."
"RTN","FBAAMP",162,0)
 Q FBRET
"RTN","FBAAMP",163,0)
 ;
"RTN","FBAAMP",164,0)
IPACID(FBVEN,FBIPIEN) ; function to return IPAC agreement ID# if exactly 1 active IPAC on file for vendor (FB*3.5*123)
"RTN","FBAAMP",165,0)
 ; No user interface allowed with this function.  Called by background, Austin transmission process.
"RTN","FBAAMP",166,0)
 ;
"RTN","FBAAMP",167,0)
 ; Input:
"RTN","FBAAMP",168,0)
 ;   FBVEN - Vendor ien (ptr to file 161.2)
"RTN","FBAAMP",169,0)
 ;
"RTN","FBAAMP",170,0)
 ; Output:
"RTN","FBAAMP",171,0)
 ;   Function value = if exactly 1 active IPAC agreement is on file, then this returns the external agreement ID#
"RTN","FBAAMP",172,0)
 ;                    otherwise, this returns ""
"RTN","FBAAMP",173,0)
 ;   FBIPIEN (pass by reference) - internal entry ien of the active IPAC agreement on file
"RTN","FBAAMP",174,0)
 ;
"RTN","FBAAMP",175,0)
 N X1,X2,RET
"RTN","FBAAMP",176,0)
 S RET=""       ; default value
"RTN","FBAAMP",177,0)
 S FBIPIEN=""   ; initialize
"RTN","FBAAMP",178,0)
 S FBVEN=+$G(FBVEN)
"RTN","FBAAMP",179,0)
 I '$$IPACREQD(FBVEN) G IPACIDX                            ; IPAC not required
"RTN","FBAAMP",180,0)
 S X1=+$O(^FBAA(161.95,"AVA",FBVEN,"A",""))                ; first active IPAC entry
"RTN","FBAAMP",181,0)
 I 'X1 G IPACIDX                                           ; no IPAC data found for vendor so get out
"RTN","FBAAMP",182,0)
 S X2=+$O(^FBAA(161.95,"AVA",FBVEN,"A",""),-1)             ; last active IPAC entry
"RTN","FBAAMP",183,0)
 ;
"RTN","FBAAMP",184,0)
 ; only 1 IPAC on file - retrieve the ID# in this case only
"RTN","FBAAMP",185,0)
 I X1=X2 S RET=$P($G(^FBAA(161.95,X1,0)),U,1),FBIPIEN=X1   ; IPAC external agreement ID#
"RTN","FBAAMP",186,0)
 ;
"RTN","FBAAMP",187,0)
IPACIDX ;
"RTN","FBAAMP",188,0)
 Q RET
"RTN","FBAAMP",189,0)
 ;
"RTN","FBAAMP",190,0)
IPAC(FBVEN) ; Determine if active IPAC agreement data exists for vendor (FB*3.5*123)
"RTN","FBAAMP",191,0)
 ; Input:
"RTN","FBAAMP",192,0)
 ;   FBVEN - Vendor ien (ptr to file 161.2)
"RTN","FBAAMP",193,0)
 ;
"RTN","FBAAMP",194,0)
 ; Output:
"RTN","FBAAMP",195,0)
 ;   Function value = -1 if active IPAC records exist, but none were selected (this is an error condition)
"RTN","FBAAMP",196,0)
 ;                  = ien of IPAC entry in file 161.95 (if only 1 exists, or user selected it)
"RTN","FBAAMP",197,0)
 ;                  = "" if no IPAC data found or if IPAC not required
"RTN","FBAAMP",198,0)
 ;
"RTN","FBAAMP",199,0)
 N FBIA,X1,X2,DIR,DIROUT,DIRUT,DTOUT,DUOUT,X,Y
"RTN","FBAAMP",200,0)
 S FBIA=""
"RTN","FBAAMP",201,0)
 S FBVEN=+$G(FBVEN)
"RTN","FBAAMP",202,0)
 I '$$IPACREQD(FBVEN) G IPACX                          ; IPAC not required
"RTN","FBAAMP",203,0)
 S X1=+$O(^FBAA(161.95,"AVA",FBVEN,"A",""))            ; first active IPAC entry
"RTN","FBAAMP",204,0)
 I 'X1 G IPACX                                         ; no IPAC data found for vendor, get out with FBIA=""
"RTN","FBAAMP",205,0)
 W !!,"This is a Federal Vendor. IPAC payment information is required."
"RTN","FBAAMP",206,0)
 S X2=+$O(^FBAA(161.95,"AVA",FBVEN,"A",""),-1)         ; last active IPAC entry
"RTN","FBAAMP",207,0)
 ;
"RTN","FBAAMP",208,0)
 ; only 1 IPAC on file - select it automatically
"RTN","FBAAMP",209,0)
 I X1=X2 S FBIA=X1 D
"RTN","FBAAMP",210,0)
 . W !,"  - Required IPAC agreement information has been found."
"RTN","FBAAMP",211,0)
 . Q
"RTN","FBAAMP",212,0)
 ;
"RTN","FBAAMP",213,0)
 I X1'=X2 S FBIA=$$MULTIPAC(FBVEN)                     ; multiple IPAC selection for vendor
"RTN","FBAAMP",214,0)
 I FBIA'>0 G IPACX                                     ; get out if user failed to select one
"RTN","FBAAMP",215,0)
 ;
"RTN","FBAAMP",216,0)
 S DIR(0)="Y",DIR("A")="Would you like to display the detailed IPAC agreement information"
"RTN","FBAAMP",217,0)
 S DIR("B")="No"
"RTN","FBAAMP",218,0)
 W ! D ^DIR K DIR
"RTN","FBAAMP",219,0)
 I $D(DIRUT) W "  Not displaying detail ... "
"RTN","FBAAMP",220,0)
 I 'Y G IPACX   ; exit without displaying the data by user choice
"RTN","FBAAMP",221,0)
 ;
"RTN","FBAAMP",222,0)
 ; Display the IPAC data
"RTN","FBAAMP",223,0)
 W !
"RTN","FBAAMP",224,0)
 D VADISP^FBAAIAU(FBIA,1)
"RTN","FBAAMP",225,0)
 S DIR(0)="E" D ^DIR K DIR    ; press return to continue
"RTN","FBAAMP",226,0)
IPACX ;
"RTN","FBAAMP",227,0)
 Q FBIA
"RTN","FBAAMP",228,0)
 ;
"RTN","FBAAMP",229,0)
MULTIPAC(FBVEN) ; multiple IPAC agreement display, lister, selection
"RTN","FBAAMP",230,0)
 ; same input and output parameters as IPAC above
"RTN","FBAAMP",231,0)
 ;
"RTN","FBAAMP",232,0)
 N FBIA,Z,CNT,FBLN,FBG,ID,FY,DESC,DIR,DIROUT,DIRUT,DTOUT,DUOUT,X,Y,LN,T,W
"RTN","FBAAMP",233,0)
 S FBVEN=+$G(FBVEN)
"RTN","FBAAMP",234,0)
 S FBIA=""
"RTN","FBAAMP",235,0)
 S Z=0,CNT=0 K FBLN
"RTN","FBAAMP",236,0)
 F  S Z=$O(^FBAA(161.95,"AVA",FBVEN,"A",Z)) Q:'Z  D
"RTN","FBAAMP",237,0)
 . S FBG=$G(^FBAA(161.95,Z,0)) I FBG="" Q
"RTN","FBAAMP",238,0)
 . S ID=$P(FBG,U,1)
"RTN","FBAAMP",239,0)
 . S FY=$P(FBG,U,3)
"RTN","FBAAMP",240,0)
 . S DESC=$P(FBG,U,5)
"RTN","FBAAMP",241,0)
 . S CNT=CNT+1,FBLN(CNT)=Z_U_ID_U_FY_U_DESC
"RTN","FBAAMP",242,0)
 . Q
"RTN","FBAAMP",243,0)
 ;
"RTN","FBAAMP",244,0)
 I 'CNT G MULIPACX    ; get out if nothing found (should not happen)
"RTN","FBAAMP",245,0)
 I CNT=1 S FBIA=$P(FBLN(1),U,1) G MULIPACX       ; only 1 found (also should not happen)
"RTN","FBAAMP",246,0)
 ;
"RTN","FBAAMP",247,0)
 ; Multiple found. Build list.
"RTN","FBAAMP",248,0)
 S DIR(0)="N"_U_"1:"_CNT,LN=0
"RTN","FBAAMP",249,0)
 S LN=LN+1,DIR("A",LN)=$$GET1^DIQ(161.2,FBVEN_",",.01)_" is a Federal Vendor with"
"RTN","FBAAMP",250,0)
 S LN=LN+1,DIR("A",LN)=CNT_" active IPAC agreements on file:"
"RTN","FBAAMP",251,0)
 S LN=LN+1,DIR("A",LN)=" "
"RTN","FBAAMP",252,0)
 S LN=LN+1,DIR("A",LN)="#   ID          FY   Description"
"RTN","FBAAMP",253,0)
 S LN=LN+1,DIR("A",LN)="-- ----------  ----  -----------"
"RTN","FBAAMP",254,0)
 S T=0 F  S T=$O(FBLN(T)) Q:'T  S W=FBLN(T) D
"RTN","FBAAMP",255,0)
 . S LN=LN+1,DIR("A",LN)=$$LJ^XLFSTR(T,3)_$$LJ^XLFSTR($P(W,U,2),12)_$$LJ^XLFSTR($P(W,U,3),6)_$E($P(W,U,4),1,58)
"RTN","FBAAMP",256,0)
 . Q
"RTN","FBAAMP",257,0)
 S LN=LN+1,DIR("A",LN)=" "
"RTN","FBAAMP",258,0)
 S LN=LN+1,DIR("A",LN)="Please select the IPAC agreement to be used with this invoice."
"RTN","FBAAMP",259,0)
 S LN=LN+1,DIR("A",LN)="This information is required."
"RTN","FBAAMP",260,0)
 S DIR("A")="Selection#"
"RTN","FBAAMP",261,0)
 W ! D ^DIR K DIR
"RTN","FBAAMP",262,0)
 I Y>0 S FBIA=$P($G(FBLN(Y)),U,1) G MULIPACX    ; user selection is good so set FBIA and get out
"RTN","FBAAMP",263,0)
 ;
"RTN","FBAAMP",264,0)
 ; in all other cases, user failed to make a selection so set FBIA=-1
"RTN","FBAAMP",265,0)
 S FBIA=-1
"RTN","FBAAMP",266,0)
 W !!,$C(7),"IPAC Agreement Selection is required for this vendor."
"RTN","FBAAMP",267,0)
 ;
"RTN","FBAAMP",268,0)
MULIPACX ;
"RTN","FBAAMP",269,0)
 Q FBIA
"RTN","FBAAMP",270,0)
 ;
"RTN","FBAAMP",271,0)
IPACINV(FBDODINV,FBDEF) ; function to get the DoD invoice number for IPAC (FB*3.5*123)
"RTN","FBAAMP",272,0)
 ; Function value is 1 if the DoD invoice number was obtained.
"RTN","FBAAMP",273,0)
 ; Function value is 0 if not.
"RTN","FBAAMP",274,0)
 ; FBDODINV - pass by reference. This is set to the DoD invoice number.
"RTN","FBAAMP",275,0)
 ; FBDEF is an optional default value
"RTN","FBAAMP",276,0)
 ;
"RTN","FBAAMP",277,0)
 N RET,DIR,X,Y,DTOUT,DUOUT,DIRUT,DIROUT
"RTN","FBAAMP",278,0)
 S FBDODINV="",RET=0   ; initialize
"RTN","FBAAMP",279,0)
 S DIR(0)="Fr^3:22",DIR("A")="Enter the DoD Invoice Number"
"RTN","FBAAMP",280,0)
 I $G(FBDEF)'="" S DIR("B")=FBDEF
"RTN","FBAAMP",281,0)
 S DIR("?",1)="If invoice is a UB-04 look in block 3a."
"RTN","FBAAMP",282,0)
 S DIR("?",2)="If invoice is a CMS-1500 look in block 26."
"RTN","FBAAMP",283,0)
 S DIR("?")="You must enter between 3-22 characters."
"RTN","FBAAMP",284,0)
 W ! D ^DIR K DIR
"RTN","FBAAMP",285,0)
 I $D(DIRUT),$G(FBDEF)'="" S Y=FBDEF K DIRUT
"RTN","FBAAMP",286,0)
 I '$D(DIRUT),Y'="" S FBDODINV=Y,RET=1 G IPINVX
"RTN","FBAAMP",287,0)
 W !!,$C(7),"The DoD Invoice Number is required for IPAC processing."
"RTN","FBAAMP",288,0)
IPINVX ;
"RTN","FBAAMP",289,0)
 W !
"RTN","FBAAMP",290,0)
 Q RET
"RTN","FBAAMP",291,0)
 ;
"RTN","FBAAMP",292,0)
IPACREQD(FBVEN) ; Is IPAC data required for vendor?  (FB*3.5*123)
"RTN","FBAAMP",293,0)
 I $G(FBAAPTC)="R" Q 0      ; IPAC is not applicable for Patient/Veteran reimbursements
"RTN","FBAAMP",294,0)
 I +$O(^FBAA(161.95,"AVA",+$G(FBVEN),"A","")) Q 1
"RTN","FBAAMP",295,0)
 Q 0
"RTN","FBAAMP",296,0)
 ;
"RTN","FBAAMP",297,0)
IPACDISP(FBIA,FBDODINV) ; Quick display of IPAC data currently on file for this invoice  (FB*3.5*123)
"RTN","FBAAMP",298,0)
 N G
"RTN","FBAAMP",299,0)
 S FBIA=+$G(FBIA)
"RTN","FBAAMP",300,0)
 S G=$G(^FBAA(161.95,FBIA,0))
"RTN","FBAAMP",301,0)
 I G="",$G(FBDODINV)="" G IDISPX
"RTN","FBAAMP",302,0)
 W !!,"IPAC Agreement Information on file for this Invoice/Payment"
"RTN","FBAAMP",303,0)
 W !,"-----------------------------------------------------------"
"RTN","FBAAMP",304,0)
 W !,"IPAC Agreement ID: ",$P(G,U,1),"  (",$$GET1^DIQ(161.95,FBIA,3),")"
"RTN","FBAAMP",305,0)
 W !?11,"Vendor: ",$$GET1^DIQ(161.95,FBIA,1)
"RTN","FBAAMP",306,0)
 W !?6,"Fiscal Year: ",$P(G,U,3)
"RTN","FBAAMP",307,0)
 W !,"Short Description: ",$P(G,U,5)
"RTN","FBAAMP",308,0)
 W !?5,"DoD Invoice#: ",$G(FBDODINV)
"RTN","FBAAMP",309,0)
IDISPX ;
"RTN","FBAAMP",310,0)
 Q
"RTN","FBAAMP",311,0)
 ;
"RTN","FBAAMP",312,0)
ANCIL ;ENTRY POINT FOR multiple ancillary payment option
"RTN","FBAAMP",313,0)
 S FBCHCO=1 D ^FBAAMP
"RTN","FBAAMP",314,0)
 K FBCHCO Q
"RTN","FBAAODP")
0^77^B8130048^B7108303
"RTN","FBAAODP",1,0)
FBAAODP ;AISC/GRR - DELETE PAYMENT ;11/13/2014
"RTN","FBAAODP",2,0)
 ;;3.5;FEE BASIS;**154**;JAN 30, 1995;Build 12
"RTN","FBAAODP",3,0)
 ;;Per VA Directive 6402, this routine should not be modified.
"RTN","FBAAODP",4,0)
 S:'$D(^FBAAC(DFN,1,0)) ^FBAAC(DFN,1,0)="^162.01P^0^0"
"RTN","FBAAODP",5,0)
RDV W !! S DIC="^FBAAC("_DFN_",1,",DIC(0)="AEQM",DA(1)=DFN D ^DIC G Q:X="^"!(X=""),RDV:Y<0 S (FBV,DA)=+Y
"RTN","FBAAODP",6,0)
 I '$D(^FBAAC(DFN,FBV,"AD")) W !,"Vendor has no prior claims",! G RDV
"RTN","FBAAODP",7,0)
 D EN1^FBAAVS
"RTN","FBAAODP",8,0)
RDATE K FBSDI,FBAACPI W !! I '$D(^FBAAC(DFN,1,FBV,1,0)) S ^FBAAC(DFN,1,FBV,1,0)="^162.02DA^0^0"
"RTN","FBAAODP",9,0)
 S DA(2)=DFN,DA(1)=FBV,DIC(0)="AEQM",DIC("A")="Date of Service: ",DIC="^FBAAC("_DFN_",1,"_FBV_",1," D ^DIC K DIC,DA G RDV:X="^"!(X=""),RDATE:Y<0 S FBSDI=+Y,FBAADT=$P(Y,"^",2)
"RTN","FBAAODP",10,0)
 I '$D(^FBAAC(DFN,1,FBV,1,FBSDI,1,0)) S ^FBAAC(DFN,1,FBV,1,FBSDI,1,0)="^162.03A^0^0"
"RTN","FBAAODP",11,0)
LOOK G CHKE
"RTN","FBAAODP",12,0)
Q K FBAADT,FBX,FBAACP,FBAAOBN,FBAAODUZ,FBAAOPA,FBAACPI,FBSDI,FBMOD Q
"RTN","FBAAODP",13,0)
CHKE S DIC="^FBAAC("_DFN_",1,"_FBV_",1,"_FBSDI_",1,",DIC(0)="AEQM",DA(3)=DFN,DA(2)=FBV,DA(1)=FBSDI D ^DIC Q:X=""!(X="^")  G RDATE:Y<0 S (FBAACPI,DA)=+Y D SETO
"RTN","FBAAODP",14,0)
 I FBAABE'=FBAAOBN W !,*7,"Sorry, that payment is not in the Batch you selected!",*7 G RDATE
"RTN","FBAAODP",15,0)
 ; enforce segregation of duties
"RTN","FBAAODP",16,0)
 S FTP(0)=$P($G(^FBAAC(DA(3),1,DA(2),1,DA(1),1,DA,3)),U,9)
"RTN","FBAAODP",17,0)
 I '$$UOKPAY^FBUTL9(DFN,FTP(0)) D  G RDATE
"RTN","FBAAODP",18,0)
 . W !!,"You cannot process a payment associated with authorization ",DFN,"-",FTP(0)
"RTN","FBAAODP",19,0)
 . W !,"due to separation of duties."
"RTN","FBAAODP",20,0)
 ;
"RTN","FBAAODP",21,0)
RD W ! S DIR("A")="Are you sure you want to delete this payment record",DIR("B")="No",DIR(0)="Y" D ^DIR K DIR Q:$D(DIRUT)  I 'Y G RDATE
"RTN","FBAAODP",22,0)
 S DIK=DIC D ^DIK D  K A,B,J,K W !,"Payment record Deleted!",! G RDATE
"RTN","FBAAODP",23,0)
 .; reset batch total and line count
"RTN","FBAAODP",24,0)
 . I +$G(FBAABE) N DA,FBTOTAL,FBLCNT D CNTTOT^FBAARB(+FBAABE) D
"RTN","FBAAODP",25,0)
 ..S DA=+FBAABE,DIE="^FBAA(161.7,",DR="10////^S X=FBLCNT;8////^S X=FBTOTAL;S:FBLCNT!(FBTOTAL) Y="""";9///@" D ^DIE K DIE,DR
"RTN","FBAAODP",26,0)
 ..S:FBTOTAL=0 $P(^FBAA(161.7,+FBAABE,0),U,9)=""
"RTN","FBAAODP",27,0)
 ..S:FBLCNT=0 $P(^FBAA(161.7,+FBAABE,0),U,11)=""
"RTN","FBAAODP",28,0)
 Q
"RTN","FBAAODP",29,0)
SETO S FBAAOPA=$S($P(Y,"^",3)=1:0,$D(^FBAAC(DA(3),1,DA(2),1,DA(1),1,DA,0)):$P(^(0),"^",3),1:0),FBAAODUZ=$P(^(0),"^",7),FBAAOBN=$P(^(0),"^",8)
"RTN","FBAAODP",30,0)
 S FY=$E(FBAADT,1,3)+1700+$S($E(FBAADT,4,5)>9:1,1:0)
"RTN","FBAAODP",31,0)
 Q
"RTN","FBAAODP0")
0^20^B4415099^B4472268
"RTN","FBAAODP0",1,0)
FBAAODP0 ;AISC/GRR - DELETE PAYMENT ;11/13/2014
"RTN","FBAAODP0",2,0)
 ;;3.5;FEE BASIS;**108,154**;JAN 30, 1995;Build 12
"RTN","FBAAODP0",3,0)
 ;;Per VA Directive 6402, this routine should not be modified.
"RTN","FBAAODP0",4,0)
 D DT^DICRW
"RTN","FBAAODP0",5,0)
BT S DIC="^FBAA(161.7,",DIC("S")=$S($D(^XUSEC("FBAA LEVEL 2",DUZ)):"I $G(^(""ST""))=""O"",$P(^(0),U,3)=""B3""",1:"I $P(^(0),U,5)=DUZ,$P(^(0),U,3)=""B3"",$G(^(""ST""))=""O""")
"RTN","FBAAODP0",6,0)
 S DIC(0)="AEQM",DIC("W")="W ""  Obligation #: "",$P(^(0),U,2)" W !! D ^DIC K DIC("W"),DIC("S")
"RTN","FBAAODP0",7,0)
 G Q:X["^"!(X="") I Y>0 S (DA,FBAABE)=+Y
"RTN","FBAAODP0",8,0)
 S FBAABO=$P(^FBAA(161.7,DA,0),"^",2)
"RTN","FBAAODP0",9,0)
1 I '$D(FBPROG) D SITEP^FBAAUTL S FBPROG=$S($P(FBSITE(1),"^",6)="":"I 1",1:"I $P(^(0),U,3)=2")
"RTN","FBAAODP0",10,0)
 D GETVET^FBAAUTL1 G BT:'DFN
"RTN","FBAAODP0",11,0)
 D GETAUTH^FBAAUTL1 G 1:FTP']""
"RTN","FBAAODP0",12,0)
 D ^FBAAODP G 1
"RTN","FBAAODP0",13,0)
Q K DIC,CNT,Y,X,X1,I,DIC,D0,DFN,A1,A2,B1,B2,DA,DR,F,FBI,FBPROG,FBRR,FBXX,PTYPE,FBAABDT,FBAABE,FBAABO,FBAACPT,FBAAEDT,FBAAPD,FBAATA,FBDX,FBGOT,FBIN,FBPOV,FBPT,FBTT,FBTYPE,FY,H,HDA,HOLDDA,MAJN,PI,Q,SUB,SUBN,UL,Z,ZS,ZZ
"RTN","FBAAODP0",14,0)
 K A,TA,FBAAOUT,FBAUT,L,K,V,FBVEN,FTP,FBSITE,FBLOC,FBASSOC,FB7078,FBPSA,FBAADT,FBAAOBN,FBAAODUZ,FBAAOPA,FBPOP,FBST,FBV,FBAOT,FBVCHDT,FB583
"RTN","FBAAODP0",15,0)
 D GETAUTHK^FBAAUTL1
"RTN","FBAAODP0",16,0)
 Q
"RTN","FBAAPET")
0^21^B51663555^B48467737
"RTN","FBAAPET",1,0)
FBAAPET ;AISC/DMK - EDIT PAYMENT ;10/1/14  17:10
"RTN","FBAAPET",2,0)
 ;;3.5;FEE BASIS;**4,38,55,61,77,116,122,133,108,124,132,139,123,154**;JAN 30, 1995;Build 12
"RTN","FBAAPET",3,0)
 ;;Per VA Directive 6402, this routine should not be modified.
"RTN","FBAAPET",4,0)
 S FBOT=1
"RTN","FBAAPET",5,0)
GETPT I $G(BAT) D
"RTN","FBAAPET",6,0)
 .I '$D(^FBAAC("AC",+BAT)) F I=9,10,11 S $P(^FBAA(161.7,+BAT,0),U,I)=""
"RTN","FBAAPET",7,0)
 .I $D(^FBAAC("AC",+BAT)) D  S $P(^FBAA(161.7,+BAT,0),U,11)=I,$P(^(0),U,9)=$G(FBTOT) K I,FBTOT
"RTN","FBAAPET",8,0)
 ..N J,K,L,M S (I,J,K,L,M,FBTOT)=0
"RTN","FBAAPET",9,0)
 ..F  S J=$O(^FBAAC("AC",+BAT,J)) Q:'J  F  S K=$O(^FBAAC("AC",+BAT,J,K)) Q:'K  F  S L=$O(^FBAAC("AC",+BAT,J,K,L)) Q:'L  F  S M=$O(^FBAAC("AC",+BAT,J,K,L,M)) Q:'M  I $D(^FBAAC(J,1,K,1,L,1,M,0)) S I=I+1,FBTOT=FBTOT+$P(^(0),U,3)
"RTN","FBAAPET",10,0)
 W !! S DIC="^FBAAC(",DIC(0)="AEQM" D ^DIC G END:X="^"!(X=""),GETPT:Y<0 S (DFN,FBDA(3))=+Y
"RTN","FBAAPET",11,0)
 S:'$D(^FBAAC(DFN,1,0)) ^FBAAC(DFN,1,0)="^162.01P^0^0"
"RTN","FBAAPET",12,0)
 S DIC=DIC_DFN_",1,"
"RTN","FBAAPET",13,0)
GETVD W !! S DIC(0)="AEQM" D ^DIC G GETPT:X="^"!(X=""),GETVD:Y<0 S (FBV,FBVD,FBDA(2))=+Y
"RTN","FBAAPET",14,0)
 S:'$D(^FBAAC(DFN,1,FBDA(2),1,0)) ^FBAAC(DFN,1,FBDA(2),1,0)="^162.02DA^0^0"
"RTN","FBAAPET",15,0)
 S DIC=DIC_FBVD_",1,"
"RTN","FBAAPET",16,0)
GETDT S DIC(0)="AEQM",DIC("A")="Date of Service: " D ^DIC K DIC("A") G GETPT:X="^"!(X=""),GETDT:Y<0 S (FBSD,FBSDI,FBDA(1))=+Y,FBAADT=$P(Y,U,2)
"RTN","FBAAPET",17,0)
 S:'$D(^FBAAC(DFN,1,FBDA(2),1,FBDA(1),1,0)) ^FBAAC(DFN,1,FBDA(2),1,FBDA(1),1,0)="^162.03A^0^0"
"RTN","FBAAPET",18,0)
 S FBZ=DIC_FBSD_",1,"
"RTN","FBAAPET",19,0)
SERV S DA(3)=FBDA(3),DA(2)=FBDA(2),DA(1)=FBDA(1)
"RTN","FBAAPET",20,0)
 S DIC("W")="N FBX S FBX=$$MODL^FBAAUTL4(""^FBAAC(FBDA(3),1,FBDA(2),1,FBDA(1),1,+Y,""""M"""")"",""E"") W:FBX]"""" ""    CPT Modifier(s): "",FBX Q"
"RTN","FBAAPET",21,0)
 S DIC=FBZ,DIC(0)="AEQMZ"
"RTN","FBAAPET",22,0)
 D
"RTN","FBAAPET",23,0)
 . N ICPTVDT S ICPTVDT=$G(FBAADT) D ^DIC
"RTN","FBAAPET",24,0)
 G GETPT:X="^"!(X=""),SERV:Y<0 S (FBSV,FBAACPI,FBDA)=+Y,BAT=$P(Y(0),U,8),FBDUZ=$P(Y(0),U,7),(FBAACP,FBAACP(0))=$P(Y,U,2),K=$P(Y(0),U,3),FBAAPTC=$P(Y(0),U,20),J(0)=$P(Y(0),U,2)
"RTN","FBAAPET",25,0)
 ;
"RTN","FBAAPET",26,0)
 S FTP=$P($G(^FBAAC(FBDA(3),1,FBDA(2),1,FBDA(1),1,FBDA,3)),U,9)
"RTN","FBAAPET",27,0)
 I '$$UOKPAY^FBUTL9(DFN,FTP) D  G GETPT
"RTN","FBAAPET",28,0)
 . W !!,"You cannot process a payment associated with authorization ",DFN,"-",FTP
"RTN","FBAAPET",29,0)
 . W !,"due to separation of duties."
"RTN","FBAAPET",30,0)
 ;
"RTN","FBAAPET",31,0)
 ; set FB1725 true (1) if payment is for a Mill Bill claim
"RTN","FBAAPET",32,0)
 S FB1725=$S($P(Y(0),U,13)["FB583":+$P($G(^FB583(+$P(Y(0),U,13),0)),U,28),1:0)
"RTN","FBAAPET",33,0)
 I FBDUZ'=DUZ&('$D(^XUSEC("FBAA LEVEL 2",DUZ))) W !!,*7,"Sorry, only the clerk who entered the payment or",!," a holder of the FBAA LEVEL 2 key can edit this payment." G GETPT
"RTN","FBAAPET",34,0)
 ;S FBAAMM1=$P($G(^FBAAC(FBDA(3),1,FBDA(2),1,FBDA(1),1,FBDA,2)),U,2)
"RTN","FBAAPET",35,0)
 S FBFSAMT(0)=$P($G(^FBAAC(FBDA(3),1,FBDA(2),1,FBDA(1),1,FBDA,2)),U,12)
"RTN","FBAAPET",36,0)
 ; determine lesser of original fee schedule amount and amount claimed
"RTN","FBAAPET",37,0)
 S FBAMTPD(0)=$S(FBFSAMT(0)="":J(0),FBFSAMT(0)>J(0):J(0),1:FBFSAMT(0))
"RTN","FBAAPET",38,0)
 S FBMODL=$$MODL^FBAAUTL4("^FBAAC("_FBDA(3)_",1,"_FBDA(2)_",1,"_FBDA(1)_",1,"_FBDA_",""M"")")
"RTN","FBAAPET",39,0)
 ; load current adjustment data
"RTN","FBAAPET",40,0)
 D LOADADJ^FBAAFA(FBDA_","_FBDA(1)_","_FBDA(2)_","_FBDA(3)_",",.FBADJ)
"RTN","FBAAPET",41,0)
 ; save adjustment data prior to edit session in sorted list
"RTN","FBAAPET",42,0)
 S FBADJL(0)=$$ADJL^FBUTL2(.FBADJ) ; sorted list of original adjustments
"RTN","FBAAPET",43,0)
 ; load current remittance remark data
"RTN","FBAAPET",44,0)
 D LOADRR^FBAAFR(FBDA_","_FBDA(1)_","_FBDA(2)_","_FBDA(3)_",",.FBRRMK)
"RTN","FBAAPET",45,0)
 ; save remittance remarks prior to edit session in sorted list
"RTN","FBAAPET",46,0)
 S FBRRMKL(0)=$$RRL^FBUTL4(.FBRRMK)
"RTN","FBAAPET",47,0)
 ; save FPPS data prior to edit session
"RTN","FBAAPET",48,0)
 S FBFPPSC(0)=$P($G(^FBAAC(FBDA(3),1,FBDA(2),1,FBDA(1),1,FBDA,3)),U)
"RTN","FBAAPET",49,0)
 S FBFPPSC=FBFPPSC(0)
"RTN","FBAAPET",50,0)
 S FBFPPSL(0)=$P($G(^FBAAC(FBDA(3),1,FBDA(2),1,FBDA(1),1,FBDA,3)),U,2)
"RTN","FBAAPET",51,0)
 S FBFPPSL=FBFPPSL(0)
"RTN","FBAAPET",52,0)
 G:BAT']"" EDIT
"RTN","FBAAPET",53,0)
 ; check batch status
"RTN","FBAAPET",54,0)
 S FBSTAT=$P($G(^FBAA(161.7,BAT,"ST")),U) ; batch status
"RTN","FBAAPET",55,0)
 I FBSTAT="S",'$D(^XUSEC("FBAA LEVEL 2",DUZ)) W !!,*7,"Sorry, only a holder of the FBAA LEVEL 2 key can edit",!," a payment once the batch has been released." G GETPT
"RTN","FBAAPET",56,0)
 I "^T^F^V^"[(U_FBSTAT_U) W !!,*7,"Sorry, you cannot edit a payment when the batch has been sent to Austin." G GETPT
"RTN","FBAAPET",57,0)
 K FBSTAT
"RTN","FBAAPET",58,0)
 ;
"RTN","FBAAPET",59,0)
EDIT S DA=FBSV
"RTN","FBAAPET",60,0)
 ;
"RTN","FBAAPET",61,0)
 ; first edit CPT code and modifiers
"RTN","FBAAPET",62,0)
 D CPTM^FBAALU(FBAADT,DFN,FBAACP(0),FBMODL) I '$G(FBGOT) G GETPT
"RTN","FBAAPET",63,0)
 ; if CPT was changed then update file
"RTN","FBAAPET",64,0)
 I FBAACP'=FBAACP(0) D  I FBAACP="@" G GETPT
"RTN","FBAAPET",65,0)
 . N FBIENS,FBFDA
"RTN","FBAAPET",66,0)
 . S FBIENS=FBDA_","_FBDA(1)_","_FBDA(2)_","_FBDA(3)_","
"RTN","FBAAPET",67,0)
 . S FBFDA(162.03,FBIENS,.01)=FBAACP
"RTN","FBAAPET",68,0)
 . D FILE^DIE("","FBFDA") D MSG^DIALOG()
"RTN","FBAAPET",69,0)
 ; if modifiers changed then update file
"RTN","FBAAPET",70,0)
 I FBMODL'=$$MODL^FBAAUTL4("FBMODA") D REPMOD^FBAAUTL4(FBDA(3),FBDA(2),FBDA(1),FBDA)
"RTN","FBAAPET",71,0)
 ;
"RTN","FBAAPET",72,0)
 ; Check for IPAC data requirements for Federal Vendors (FB*3.5*123)
"RTN","FBAAPET",73,0)
 I '$$IPACEDIT^FBAAPET1(162.03,.FBDA) G SERV
"RTN","FBAAPET",74,0)
 ;
"RTN","FBAAPET",75,0)
 ; now edit remaining fields
"RTN","FBAAPET",76,0)
 S DIE("NO^")=""
"RTN","FBAAPET",77,0)
 ; FB*3.5*139-JLG-ICD10 REMEDIATION -added FBDXCHK1 and FBDXCHK2
"RTN","FBAAPET",78,0)
 N FBDXCHK1 S FBDXCHK1="S:FBAADT<$$IMPDATE^FBCSV1(""10D"") Y=""@7"";@60;S XX1=-1 S XX1=$$ASKICD10^FBAACO2(FBAADT,""Y"") S:XX1<0 Y=""@60"";28////^S X=XX1;S Y=31;"
"RTN","FBAAPET",79,0)
 N FBDXCHK2 S FBDXCHK2="S:FBAADT<$$IMPDATE^FBCSV1(""10D"") Y=""@8"";@15;S XX1=-1 S XX1=$$ASKICD10^FBAACO2(FBAADT) S:XX1<0 Y=""@15"";28////^S X=XX1;S Y=31;"
"RTN","FBAAPET",80,0)
 S DR="48;47;S FBUNITS=X;42R;S FBZIP=X;S:$$ANES^FBAAFS($$CPT^FBAAUTL4(FBAACP)) Y=""@2"";43///@;S FBTIME=X;S Y=""@3"";@2;43R;S FBTIME=X;@3"
"RTN","FBAAPET",81,0)
 ; fb*3.5*116 remove edit of interest indicator (162.03,34) to prevent different interest indicator values at line item level; interest indicator set at invoice level only; 
"RTN","FBAAPET",82,0)
 S DR(1,162.03,1)="S FBAAMM=$S(FBAAPTC=""R"":"""",1:1);D PPT^FBAACO1(FBAAMM1,FBCNTRP,1);54///@;54////^S X=FBCNTRP;30R;S FBHCFA(30)=X;1;S J=X;Q"
"RTN","FBAAPET",83,0)
 ;S DR(1,162.03,1)="30R;S FBHCFA(30)=X;1;S J=X;Q"
"RTN","FBAAPET",84,0)
 S DR(1,162.03,2)="D FEEDT^FBAACO3;44///@;44///^S X=FBFSAMT;45///@;45///^S X=FBFSUSD;S:FBAMTPD'>0!(FBAMTPD=FBAMTPD(0)) Y=""@4"";2///^S X=FBAMTPD;@4;2//^S X=FBAMTPD;S K=X"
"RTN","FBAAPET",85,0)
 ;S DR(1,162.03,3)="3////^S X=$S(J-K:J-K,1:"""");I X S Y=""@11"";4////@;S Y=""@5"";@11;3R;4R;S:X'=4 Y=""@5"";22"
"RTN","FBAAPET",86,0)
 S DR(1,162.03,3)="K FBADJD;M FBADJD=FBADJ;S FBX=$$ADJ^FBUTL2(J-K,.FBADJ,2,,.FBADJD,1)"
"RTN","FBAAPET",87,0)
 S DR(1,162.03,4)="S FBX=$$FPPSC^FBUTL5(1,FBFPPSC);S:FBX=-1 Y=0;S:FBX="""" Y=""@5"";50///^S X=FBX;S FBFPPSC=X;S FBX=$$FPPSL^FBUTL5(FBFPPSL);S:FBX=-1 Y=0;51///^S X=FBX;S FBFPPCL=X;S Y=""@55"";@5;50///@;S FBFPPSC="""";51///@;S FBFPPSL="""";@55"
"RTN","FBAAPET",88,0)
 S DR(1,162.03,5)="K DIE(""NO^"");W !,""Exit ('^') allowed now"";26;S PRC(""SITE"")=X;8;@13;13;I $$BADDATE^FBAAPET(FBAADT,X) S Y=""@13"";Q;33;49"
"RTN","FBAAPET",89,0)
 ;JAS - 09/11/13 - PATCH 139 - Modified next two lines (previously one line) for ICD-10
"RTN","FBAAPET",90,0)
 S DR(1,162.03,6)="15;17;16;S:X=1 Y=""@1"";@6;"_FBDXCHK1_"@7;S FBI9=$$ASKICD9^FBAACO2(FBAADT,""Y"") S:+FBI9<0 Y=""@7"";28////^S X=+FBI9;31;32R;S Y=""@9"";"
"RTN","FBAAPET",91,0)
 S DR(1,162.03,7)="@1;"_FBDXCHK2_"@8;S FBI9=$$ASKICD9^FBAACO2(FBAADT) S:+FBI9<0 Y=""@8"";28////^S X=+FBI9;31"
"RTN","FBAAPET",92,0)
 S DR(1,162.03,8)="@9;K FBRRMKD;M FBRRMKD=FBRRMK;S FBX=$$RR^FBUTL4(.FBRRMK,2,,.FBRRMKD)"
"RTN","FBAAPET",93,0)
 S DR(1,162.03,9)="73;74;75;58;59;60;61;62;63;64;65;66;67;76;77;78;79;68;69" ;FB*3.5*122,FB*3.5*133 edit line item provider fields
"RTN","FBAAPET",94,0)
 S DR(1,162.03,10)="@999;K FBDXCHK1,FBDXCHK2,XX1"  ;DEM;139 ICD-10 ASF
"RTN","FBAAPET",95,0)
 S DIE=FBZ
"RTN","FBAAPET",96,0)
 D
"RTN","FBAAPET",97,0)
 . N ICPTVDT,ICDVDT,FB583,FBAAMM,FBAAMM1,FBCNTRA,FBCNTRP,FBVEN,FTP
"RTN","FBAAPET",98,0)
 . S (ICPTVDT,ICDVDT)=$G(FBAADT)
"RTN","FBAAPET",99,0)
 . ; set variables for call to PPT^FBAACO1
"RTN","FBAAPET",100,0)
 . S FBAAMM1=$P($G(^FBAAC(FBDA(3),1,FBDA(2),1,FBDA(1),1,FBDA,2)),U,2)
"RTN","FBAAPET",101,0)
 . S FBCNTRP=$P($G(^FBAAC(FBDA(3),1,FBDA(2),1,FBDA(1),1,FBDA,3)),U,8)
"RTN","FBAAPET",102,0)
 . S X=$P($G(^FBAAC(FBDA(3),1,FBDA(2),1,FBDA(1),1,FBDA,0)),U,13)
"RTN","FBAAPET",103,0)
 . S:X[";FB583(" FB583=+X
"RTN","FBAAPET",104,0)
 . S FTP=$P($G(^FBAAC(FBDA(3),1,FBDA(2),1,FBDA(1),1,FBDA,3)),U,9)
"RTN","FBAAPET",105,0)
 . S FBVEN=$S(FTP:$P($G(^FBAAA(DFN,1,FTP,0)),U,4),1:"")
"RTN","FBAAPET",106,0)
 . S FBCNTRA=$S(FTP:$P($G(^FBAAA(DFN,1,FTP,0)),U,22),1:"")
"RTN","FBAAPET",107,0)
 . D ^DIE
"RTN","FBAAPET",108,0)
 ; if adjustment data changed then file
"RTN","FBAAPET",109,0)
 I $$ADJL^FBUTL2(.FBADJ)'=FBADJL(0) D FILEADJ^FBAAFA(FBDA_","_FBDA(1)_","_FBDA(2)_","_FBDA(3)_",",.FBADJ)
"RTN","FBAAPET",110,0)
 ; if remit remark data changed then file
"RTN","FBAAPET",111,0)
 I $$RRL^FBUTL4(.FBRRMK)'=FBRRMKL(0) D FILERR^FBAAFR(FBDA_","_FBDA(1)_","_FBDA(2)_","_FBDA(3)_",",.FBRRMK)
"RTN","FBAAPET",112,0)
 ; if FPPS CLAIM ID changed, update other line items on invoice
"RTN","FBAAPET",113,0)
 I FBFPPSC'=FBFPPSC(0) D
"RTN","FBAAPET",114,0)
 . N FBAAIN
"RTN","FBAAPET",115,0)
 . S FBAAIN=$$GET1^DIQ(162.03,FBDA_","_FBDA(1)_","_FBDA(2)_","_FBDA(3)_",",14)
"RTN","FBAAPET",116,0)
 . D CKINVEDI^FBAAPET1(FBFPPSC(0),FBFPPSC,FBAAIN,FBDA_","_FBDA(1)_","_FBDA(2)_","_FBDA(3)_",")
"RTN","FBAAPET",117,0)
 K FBSV W !! G SERV
"RTN","FBAAPET",118,0)
 ;
"RTN","FBAAPET",119,0)
BADDATE(FBDOS,INVRCVDT) ;Reject entry if InvRcvDt is Prior to the Date of Service on the Invoice
"RTN","FBAAPET",120,0)
 I INVRCVDT<FBDOS D  Q 1 ;Reject entry
"RTN","FBAAPET",121,0)
 .N SHOWDOS S SHOWDOS=$E(FBDOS,4,5)_"/"_$E(FBDOS,6,7)_"/"_$E(FBDOS,2,3) ;Convert FBDOS into display format for error message
"RTN","FBAAPET",122,0)
 .W *7,!!?5,"*** Invoice Received Date cannot be prior to the",!?8,"Date of Service ("_SHOWDOS_") !!!"
"RTN","FBAAPET",123,0)
 Q 0 ;Accept entry
"RTN","FBAAPET",124,0)
 ;
"RTN","FBAAPET",125,0)
END K DR,DIC,DIE,X,DFN,FBOT,FBVD,FBSD,BAT,FBAADT,FBSV,DA,FBDA,FBZ,FBDUZ,FBAACP,FBFY,FY,FBAMTPD,J,K,Y,ZZ,PRC,FBHOLDX,FBV,FBSDI,FBAACPI
"RTN","FBAAPET",126,0)
 K FBFSAMT,FBFSUSD,FBMODA,FBZIP,FBTIME,FBHCFA(30),FBAAPTC,FB1725,FBADJ,FBADJD,FBADJL(0),FBRRMK,FBRRMKD,FBRRMKL(0),FBX,FBUNITS,FTP
"RTN","FBAAPET",127,0)
 Q
"RTN","FBAAPHV")
0^3^B7102778^B7669949
"RTN","FBAAPHV",1,0)
FBAAPHV ;AISC/DMK - PHARMACY PAYMENT VOID ;5/15/14  13:44
"RTN","FBAAPHV",2,0)
 ;;3.5;FEE BASIS;**69,154**;JAN 30, 1995;Build 12
"RTN","FBAAPHV",3,0)
 ;;Per VA Directive 6402, this routine should not be modified.
"RTN","FBAAPHV",4,0)
 ;Variable 'FBVOID' is set if cancelling a voided payment.
"RTN","FBAAPHV",5,0)
 D DT^DICRW
"RTN","FBAAPHV",6,0)
 N FBFPPSC
"RTN","FBAAPHV",7,0)
RD S DIC="^FBAA(162.1,",DIC(0)="AEQM",DIC("A")="Select Invoice number: ",DIC("S")="I $P(^(0),U,5)=4" D ^DIC G Q:X["^"!(X=""),RD:Y<0 S FBAAIN=+Y K DIC("A"),DIC("S")
"RTN","FBAAPHV",8,0)
 S FBFPPSC=$P($G(^FBAA(162.1,FBAAIN,0)),U,13)
"RTN","FBAAPHV",9,0)
 I FBFPPSC]"" W !,?2,"FPPS Claim ID: ",FBFPPSC
"RTN","FBAAPHV",10,0)
RX W ! S DIC="^FBAA(162.1,FBAAIN,""RX"",",DIC(0)="AEQM",DIC("A")="Select Prescription # : " D ^DIC G Q:X["^"!(X=""),RD:Y<0
"RTN","FBAAPHV",11,0)
 S (DA,RX)=+Y,RXN=$P(Y,"^",2) K DIC
"RTN","FBAAPHV",12,0)
 I $D(FBVOID),'$D(^FBAA(162.1,FBAAIN,"RX",RX,2)) W !,*7,"Payment not voided!",! K DA G RD
"RTN","FBAAPHV",13,0)
 I '$D(FBVOID),$D(^FBAA(162.1,FBAAIN,"RX",RX,2)),$P(^(2),"^",3)="V" W !,*7,"Payment already voided!",! K DA G RD
"RTN","FBAAPHV",14,0)
 W !! S DIC="^FBAA(162.1,FBAAIN,""RX"",",DIC(0)="AEQM",DR="" D EN^DIQ
"RTN","FBAAPHV",15,0)
RD1 S DIR(0)="Y",DIR("A")="Is this the prescription you want to "_$S($D(FBVOID):"Cancel the void on ",1:"Void"),DIR("B")="NO",DIR("?")="Answer 'Yes' if you want to "_$S($D(FBVOID):"Cancel the void on ",1:"Void ")_"this prescription."
"RTN","FBAAPHV",16,0)
 D ^DIR K DIR G RD:$D(DIRUT),RX:'Y
"RTN","FBAAPHV",17,0)
 S V=$S($D(FBVOID):"",1:"VOID"),DR=$S($D(FBVOID):"23///@;23.5///@;24///@",1:"23////^S X=""V"";23.5R;24////^S X=DUZ"),DIE="^FBAA(162.1,FBAAIN,""RX""," D ^DIE
"RTN","FBAAPHV",18,0)
 S FBON=$P(^FBAA(162.1,FBAAIN,"RX",DA,0),"^",18),A2=$P(^(0),"^",16),DFN=$P(^(0),"^",5) D ^FBAAVP0 W !,?5,"...  Done.",!
"RTN","FBAAPHV",19,0)
Q K DA,DIC,DIE,DIRUT,RX,RXN,X,Y,A2,DFN,DR,FBAACB,FBAAIN,FBON,FBVOID,ON,P3,P4,RX,RXN,V,VAL Q
"RTN","FBAAPIE")
0^38^B27534429^B25905815
"RTN","FBAAPIE",1,0)
FBAAPIE ;AISC/GRR - ENTER FEE PHARMACY INVOICE ;9/25/2014
"RTN","FBAAPIE",2,0)
 ;;3.5;FEE BASIS;**61,124,123,154**;JAN 30, 1995;Build 12
"RTN","FBAAPIE",3,0)
 ;;Per VA Directive 6402, this routine should not be modified.
"RTN","FBAAPIE",4,0)
 D SITEP^FBAAUTL W:FBPOP !!,*7,"Fee site parameters must be initialized!!" Q:FBPOP  S FBMDF=$P(FBSITE(0),"^",10),FBAAPTC=$S($D(FBAAPTC):FBAAPTC,1:"V")
"RTN","FBAAPIE",5,0)
 N FBIA,FBDODINV
"RTN","FBAAPIE",6,0)
RD1 W ! S DIR("A")="Are you sure you want to enter a new invoice",DIR("B")="Yes",DIR(0)="Y" D ^DIR K DIR G Q^FBAAPIE1:$D(DIRUT),RDM^FBAAPIE1:'Y
"RTN","FBAAPIE",7,0)
ENTER S (LCNT,TAC,FBINTOT)=0,STAT(0)="",FBAAOUT=1 K FBTOUT
"RTN","FBAAPIE",8,0)
 D GETNXI^FBAAUTL S X=FBAAIN
"RTN","FBAAPIE",9,0)
 S DLAYGO=162.1,DIC="^FBAA(162.1,",DIC(0)="LQ" D ^DIC K DLAYGO G:Y<0 PROB^FBAAPIE1 W !!,"Invoice # assigned is: ",X S IN=X,DA(1)=IN
"RTN","FBAAPIE",10,0)
RDV I '$D(FB583) W !! S DLAYGO=161.2,(DIE,DIC)="^FBAAV(",DIC(0)="AEQLM" D ^DIC K DLAYGO G CHK:Y<0 S DA=+Y D NEW^FBAAVD:$P(Y,"^",3)=1
"RTN","FBAAPIE",11,0)
 I $D(FB583) S DA=FBVEN
"RTN","FBAAPIE",12,0)
 I $D(^FBAAV(DA,0)),$P($G(^("ADEL")),"^")="Y" W !!,"Vendor is flagged for Austin deletion!" G RDV:'$D(FB583),Q^FBAAPIE1
"RTN","FBAAPIE",13,0)
 D EN1^FBAAVD:$P(FBSITE(0),"^",12)="Y" S VIN=DA
"RTN","FBAAPIE",14,0)
RDV1 I $D(^XUSEC("FBAA ESTABLISH VENDOR",DUZ)) W ! S DIR("A")="Want to edit Vendor data",DIR("B")="No",DIR(0)="Y" D ^DIR K DIR G CHK:$D(DIRUT) D:Y EDITV^FBAAVD S VIN=DA
"RTN","FBAAPIE",15,0)
 S FBAR(DA)="" D ^FBAACO4
"RTN","FBAAPIE",16,0)
 ;
"RTN","FBAAPIE",17,0)
 ; FB*3.5*123 - check for IPAC agreement for Federal Vendor
"RTN","FBAAPIE",18,0)
 S FBIA=$$IPAC^FBAAMP($G(VIN)) I FBIA=-1 G CHK
"RTN","FBAAPIE",19,0)
 ;
"RTN","FBAAPIE",20,0)
 W !! S %DT="AEQXP",%DT(0)=-DT,%DT("A")="Date Correct Invoice Received: " D ^%DT K %DT(0),%DT("A") G CHK:Y<0 S INVDATE=Y
"RTN","FBAAPIE",21,0)
 W !! S %DT="AEQXP",%DT(0)=-INVDATE,%DT("A")="Vendor Invoice Date:  " D ^%DT K %DT(0),%DT("A") G CHK:Y<0 S FBVINVDT=Y
"RTN","FBAAPIE",22,0)
 ; if U/C then get FPPS Claim ID else ask user
"RTN","FBAAPIE",23,0)
 I $D(FB583) S FBFPPSC=$P($G(^FB583(FB583,5)),U) W !,"FPPS CLAIM ID: ",$S(FBFPPSC="":"N/A",1:FBFPPSC)
"RTN","FBAAPIE",24,0)
 E  S FBFPPSC=$$FPPSC^FBUTL5() I FBFPPSC=-1 K FBFPPSC G CHK
"RTN","FBAAPIE",25,0)
 S (DIE,DIC)="^FBAA(162.1,",DA=IN
"RTN","FBAAPIE",26,0)
 S DR="1////^S X=INVDATE;1.5////^S X=DT;2////^S X=DUZ;3////^S X=VIN;5////^S X=1;12////^S X=FBVINVDT;13///^S X=FBFPPSC"
"RTN","FBAAPIE",27,0)
 I $G(FBIA) S DR=DR_";14////^S X=FBIA"    ; FB*3.5*123 file IPAC agreement ptr if it exists
"RTN","FBAAPIE",28,0)
 D ^DIE
"RTN","FBAAPIE",29,0)
 I '$D(^FBAA(162.1,IN,"RX",0)) S ^FBAA(162.1,IN,"RX",0)="^162.11A^^"
"RTN","FBAAPIE",30,0)
RDP S FBPHARM=1 W:FBINTOT>0 !,?15,"Pharmacy Invoice #: "_IN_"  Totals: $ "_$J(FBINTOT,1,2)
"RTN","FBAAPIE",31,0)
 ; if EDI then ask FPPS Line Item
"RTN","FBAAPIE",32,0)
 I FBFPPSC]"" W !!! S FBFPPSL=$$FPPSL^FBUTL5() I FBFPPSL=-1 K FBFPPSL G CHK
"RTN","FBAAPIE",33,0)
 D ^FBAASAP K FBPHARM I 'DFN K DFN G CHK
"RTN","FBAAPIE",34,0)
 ;
"RTN","FBAAPIE",35,0)
 I '$D(FB583),'$$UOKPAY^FBUTL9(DFN,FTP) D  G RDP
"RTN","FBAAPIE",36,0)
 . W !!,"You cannot process a payment associated with authorization ",DFN,"-",FTP
"RTN","FBAAPIE",37,0)
 . W !,"due to separation of duties."
"RTN","FBAAPIE",38,0)
 ;
"RTN","FBAAPIE",39,0)
 I FBTT=1 S FBMST="Y",FBTTYPE="A",FBFDC="",FBD1=FTP D ENT^FBAAAUT
"RTN","FBAAPIE",40,0)
 D HOME^%ZIS,FBPH^FBAAUTL2 I $D(DIRUT),$D(FB583) G CHK
"RTN","FBAAPIE",41,0)
RDD W !! S %DT(0)=-DT,%DT="AEXP",%DT("A")="DATE PRESCRIPTION FILLED: " D ^%DT K %DT G:X["^"!(X="") RDP G RDD:Y<0 S DATEF=Y
"RTN","FBAAPIE",42,0)
 I DATEF<FBAABDT!(DATEF>FBAAEDT) W !!,*7,"Date Prescription Filled is ",$S(DATEF<FBAABDT:" prior to ",1:"later than "),"authorization period!!" G RDD
"RTN","FBAAPIE",43,0)
 I INVDATE]"",DATEF>INVDATE D  G RDD
"RTN","FBAAPIE",44,0)
 .N SHOINVDT S SHOINVDT=$E(INVDATE,4,5)_"/"_$E(INVDATE,6,7)_"/"_$E(INVDATE,2,3)
"RTN","FBAAPIE",45,0)
 .W !!,*7,?5,"*** Date Prescription Filled cannot be later than",!?8," Invoice Received Date (",SHOINVDT,") !!!"
"RTN","FBAAPIE",46,0)
 ;
"RTN","FBAAPIE",47,0)
 ; FB*3.5*123 - for IPAC capture the DoD Invoice number
"RTN","FBAAPIE",48,0)
 I $G(FBIA),'$$IPACINV^FBAAMP(.FBDODINV) G RDD
"RTN","FBAAPIE",49,0)
 I '$G(FBIA) S FBDODINV=""
"RTN","FBAAPIE",50,0)
 ;
"RTN","FBAAPIE",51,0)
 I '$D(^FBAA(162.1,IN,"RX",0)) S ^FBAA(162.1,IN,"RX",0)="^162.11A^^"
"RTN","FBAAPIE",52,0)
RDRX S DIR(0)="162.11,.01",DIR("A")="Select PRESCRIPTION NUMBER" D ^DIR K DIR G CHK:Y="^"!(Y="") S PSRX=Y,AC=0
"RTN","FBAAPIE",53,0)
 I $D(^FBAA(162.1,IN,"RX","B",PSRX)) G RX2^FBAAPIE1
"RTN","FBAAPIE",54,0)
 D CHK2^FBAAPIE1 I FBJ]"" K FBJ G CHKK^FBAAPIE1
"RTN","FBAAPIE",55,0)
RXADD K DA S DLAYGO=162.1,DA(1)=IN,DIC="^FBAA(162.1,"_IN_",""RX"",",DIC(0)="EQL",X=""""_PSRX_"""" D ^DIC K DLAYGO G:Y<0 RDRX S FBDA=+Y
"RTN","FBAAPIE",56,0)
 S DIE="^FBAA(162.1,",DA=IN,DR="[FB ADD RX]" D ^DIE I $D(DTOUT)!('$G(FBUP)) G DELRX
"RTN","FBAAPIE",57,0)
 S LCNT=LCNT+1,TAC=TAC+AC K FBUP
"RTN","FBAAPIE",58,0)
RDDER W !!,*7,"Prescription referred to Pharmacy Service for determination.",! S X="Y"
"RTN","FBAAPIE",59,0)
 S STAT(1)="" G RDP:'$D(FB583),Q^FBAAPIE1
"RTN","FBAAPIE",60,0)
 S $P(^FBAA(162.1,IN,"RX",DA,2),"^")="P",^FBAA(162.1,"AH","P",IN,DA)="",$P(^FBAA(162.1,IN,0),"^",10)="P"
"RTN","FBAAPIE",61,0)
 S DA(1)=IN,DIE=DIC
"RTN","FBAAPIE",62,0)
HERE S:$D(FBAP) FBINTOT=FBINTOT+FBAP S:$D(DTOUT) FBTOUT="" G OVR:$D(DTOUT),RDD
"RTN","FBAAPIE",63,0)
CHK I LCNT'>0 W !!,"Since you didn't enter any line items",!,"Invoice # ",IN," has been Deleted!!",*7 D KILL G Q^FBAAPIE1:$D(FBTOUT),MORE:'$D(FB583),Q^FBAAPIE1
"RTN","FBAAPIE",64,0)
OVR K DTOUT,DR,DQ,DG
"RTN","FBAAPIE",65,0)
 K STAT(2)
"RTN","FBAAPIE",66,0)
 S (DIE,DIC)="^FBAA(162.1,",DA=IN,STAT=$O(STAT(0)),DR="5////^S X=STAT;6///^S X=TAC;7///^S X=FBINTOT;8///^S X=LCNT" D ^DIE G:$D(FBTOUT) Q^FBAAPIE1 W !!,"Invoice No.: ",IN," Completed!" W:FBINTOT>0 ?45,"Invoice Total: $ ",$J(FBINTOT,1,2)
"RTN","FBAAPIE",67,0)
MORE K STAT,FBHX W ! S DIR("A")="Want to enter another Invoice",DIR("B")="No",DIR(0)="Y" D ^DIR K DIR G Q^FBAAPIE1:$D(DIRUT)!('Y),ENTER
"RTN","FBAAPIE",68,0)
 Q
"RTN","FBAAPIE",69,0)
KILL S DIK="^FBAA(162.1,",DA=IN D ^DIK K DIK Q
"RTN","FBAAPIE",70,0)
DELRX S DIK="^FBAA(162.1,"_DA(1)_",""RX"",",DA=FBDA D ^DIK K DTOUT,DQ,DR,DG S FBTOUT="" W !,"Incomplete prescription entry.  Deleted.",! G CHK
"RTN","FBAAPIP")
0^39^B16684065^B14820302
"RTN","FBAAPIP",1,0)
FBAAPIP ;AISC/GRR - ESTABLISH BATCH FOR INVOICE AND CLOSE-OUT ;11/24/2014
"RTN","FBAAPIP",2,0)
 ;;3.5;FEE BASIS;**116,154**;JAN 30, 1995;Build 12
"RTN","FBAAPIP",3,0)
 ;;Per VA Directive 6402, this routine should not be modified.
"RTN","FBAAPIP",4,0)
 D DT^DICRW S FBSW=1
"RTN","FBAAPIP",5,0)
RD1 W !! S DIC="^FBAA(162.1,",DIC(0)="AEQM",DIC("S")="I $P(^(0),U,5)=3" D ^DIC K DIC G Q:X="^"!(X=""),RD1:Y<0 S (DA,IN,FBIN)=+Y,FBINTOT=0 D CALC^FBAAPIE1,WRT
"RTN","FBAAPIP",6,0)
 ;
"RTN","FBAAPIP",7,0)
 ; loop thru Rx and enforce separation of duty
"RTN","FBAAPIP",8,0)
 I $$SODPINV^FBAAEPI(FBIN) D  G RD1
"RTN","FBAAPIP",9,0)
 . W !!,"You cannot process this payment due to separation of duties."
"RTN","FBAAPIP",10,0)
 . W !,"You previously entered/edited an associated authorization."
"RTN","FBAAPIP",11,0)
 ;
"RTN","FBAAPIP",12,0)
 D EN1
"RTN","FBAAPIP",13,0)
 G RD1
"RTN","FBAAPIP",14,0)
EN1 ;ENTRY FROM THE MAS CLOSE-OUT OPTION (FBAACIE)
"RTN","FBAAPIP",15,0)
 ;FB*3.5*116 - check for $0 invoice and stop close-out
"RTN","FBAAPIP",16,0)
 I +FBINTOT=0 W !!,*7,"Invoice must be greater than 0.00. Invoice cannot be closed out." Q
"RTN","FBAAPIP",17,0)
 ; end of changes
"RTN","FBAAPIP",18,0)
 S FY=$E(DT,1,3)+1700+$S($E(DT,4,5)>9:1,1:0)
"RTN","FBAAPIP",19,0)
 S FBAAMPI=$S($D(^FBAA(161.4,1,"FBNUM")):$P(^("FBNUM"),"^",3),1:100),FBAAMPI=$S(FBAAMPI]"":FBAAMPI,1:100),FBSW=1
"RTN","FBAAPIP",20,0)
 D BT Q:'$D(FBBN)  D WAIT^DICD S (TIC,TAC,TAP,FBSW,FBAATPV)=0 D GO Q
"RTN","FBAAPIP",21,0)
BT W !! S DIC="^FBAA(161.7,",DIC(0)="AEQM",DIC("A")="Select Batch for this Invoice: ",DIC("S")="I $P(^(0),U,3)=""B5""&($G(^(""ST""))=""O"")"
"RTN","FBAAPIP",22,0)
 S DIC("W")="W !,""  Obligation #: "",$P(^(0),U,2)" D ^DIC K DIC G Q:X="^"!(X=""),BT:Y<0 S (DA,FBBN)=+Y
"RTN","FBAAPIP",23,0)
 I $P(Y,"^",3)'=1 G NOTYOU:$P(^FBAA(161.7,DA,0),"^",5)'=DUZ,NOTPH:$P(^(0),"^",3)'="B5",NOTOP:$P(^("ST"),"^",1)'="O"
"RTN","FBAAPIP",24,0)
 S Z(0)=^FBAA(161.7,DA,0),FBAABO=$P(Z(0),"^",2),FBBTA=$P(Z(0),"^",9),FBBIC=$P(Z(0),"^",10)+1,FBBLC=$P(Z(0),"^",11)
"RTN","FBAAPIP",25,0)
 G:FBBLC>(FBAAMPI-1) WARN
"RTN","FBAAPIP",26,0)
 Q
"RTN","FBAAPIP",27,0)
GO ; HIPAA 5010 - count line items that have 0.00 amount paid 
"RTN","FBAAPIP",28,0)
 ;S FBAAVIN=$P(^FBAA(162.1,FBIN,0),"^",4) F FBJ=0:0 S FBJ=$O(^FBAA(162.1,FBIN,"RX",FBJ)) Q:FBJ'>0  S Y(0)=^FBAA(162.1,FBIN,"RX",FBJ,0) D:$P(Y(0),"^",16)>0 GOT
"RTN","FBAAPIP",29,0)
 S FBAAVIN=$P(^FBAA(162.1,FBIN,0),"^",4) F FBJ=0:0 S FBJ=$O(^FBAA(162.1,FBIN,"RX",FBJ)) Q:FBJ'>0  S Y(0)=^FBAA(162.1,FBIN,"RX",FBJ,0) D GOT
"RTN","FBAAPIP",30,0)
 D RSET W !!,"Invoice Closed out!!" S FBSW=1
"RTN","FBAAPIP",31,0)
Q Q:'FBSW  K J,FBAABO,FBBN,FBIN,TAC,TAP,TIC,DIC,D0,DA,DI,DIE,DQ,DR,IN,FBINTOT,FBAAMPI,FBAATPV,FBAAVIN,FBBIC,FBBLC,FBBTA,FBJ,FY,FBZZ,X,Y,Z,FBSTN Q
"RTN","FBAAPIP",32,0)
GOT S TAC=TAC+$P(Y(0),"^",4),TAP=TAP+$P(Y(0),"^",16),TIC=TIC+1,FBBLC=FBBLC+1,FBSW=0 I $P(Y(0),"^",20)'="R" S FBAATPV=FBAATPV+$P(Y(0),"^",16)
"RTN","FBAAPIP",33,0)
 S DIC="^FBAA(162.1,"_FBIN_",""RX"",",DA=FBJ,DA(1)=FBIN,DIE=DIC,DR="13////^S X=FBBN;14////^S X=FBAABO;15////^S X=DT;8////^S X=4"
"RTN","FBAAPIP",34,0)
 D ^DIE
"RTN","FBAAPIP",35,0)
 I FBBLC>(FBAAMPI-1) D FULL
"RTN","FBAAPIP",36,0)
 Q
"RTN","FBAAPIP",37,0)
RSET S DIC="^FBAA(162.1,",DA=FBIN,DIE=DIC,DR="5////^S X=4;6///^S X=TAC;7///^S X=TAP;8///^S X=TIC" D ^DIE
"RTN","FBAAPIP",38,0)
RSET2 S FBBTA=FBBTA+TAP,$P(Z(0),"^",9)=FBBTA,$P(Z(0),"^",10)=FBBIC,$P(Z(0),"^",11)=FBBLC,^FBAA(161.7,FBBN,0)=Z(0)
"RTN","FBAAPIP",39,0)
 Q
"RTN","FBAAPIP",40,0)
NOTYOU W !!,*7,"Batch selected established by another user, choose another." G BT
"RTN","FBAAPIP",41,0)
NOTPH W !!,*7,"Batch selected is NOT a Pharmacy type batch, choose another." G BT
"RTN","FBAAPIP",42,0)
NOTOP W !!,*7,"Batch selected not in Open status, choose another." G BT
"RTN","FBAAPIP",43,0)
FULL D RSET2 W !!,*7,"Batch has reached maximum allowable payment entries!",!,"Now openning another batch for you.",! K FBBN
"RTN","FBAAPIP",44,0)
 D NEWBT G BT:'$D(FBBN)
"RTN","FBAAPIP",45,0)
 Q
"RTN","FBAAPIP",46,0)
WARN W !!,*7,"That Batch already has maximum allowable payment items!" K FBBN G BT
"RTN","FBAAPIP",47,0)
OUT Q
"RTN","FBAAPIP",48,0)
WRT W !,?20,"Invoice Totals: $ "_$J(FBINTOT,1,2) Q
"RTN","FBAAPIP",49,0)
NEWBT ;OPEN NEW BATCH IF NEEDED TO CLOSEOUT INVOICE
"RTN","FBAAPIP",50,0)
 S FBSTN=$P(Z(0),"^",8),FBAAOB=$P(Z(0),"^",2) W ! D GETNXB^FBAAUTL W !!,*7,"New Batch to closeout invoice is: ",FBBN
"RTN","FBAAPIP",51,0)
 S DIC="^FBAA(161.7,",DLAYGO=161.7,X=FBBN,DIC(0)="LQ",DIC("DR")="1////^S X=FBAAOB;2////^S X=""B5"";3////^S X=DT;4////^S X=DUZ;11////^S X=""O"";16////^S X=FBSTN"
"RTN","FBAAPIP",52,0)
 K DD,DO D FILE^DICN K DLAYGO S FBBN=+Y,Z(0)=^FBAA(161.7,FBBN,0)
"RTN","FBAAPIP",53,0)
 S FBAAOB=$P(Z(0),"^",2),FBBTA=$P(Z(0),"^",9),FBBIC=$P(Z(0),"^",10)+1,FBBLC=$P(Z(0),"^",11)
"RTN","FBAAPIP",54,0)
 Q
"RTN","FBAARB")
0^22^B6175868^B6238285
"RTN","FBAARB",1,0)
FBAARB ;AISC/GRR,DMK - RE-OPEN BATCH PREVIOUSLY CLOSED ;7/10/14  15:22
"RTN","FBAARB",2,0)
 ;;3.5;FEE BASIS;**154**;JAN 30, 1995;Build 12
"RTN","FBAARB",3,0)
 ;;Per VA Directive 6402, this routine should not be modified.
"RTN","FBAARB",4,0)
BT W !!
"RTN","FBAARB",5,0)
 S DIC="^FBAA(161.7,",DIC(0)="AEQMZ",DIC("S")=$S($D(^XUSEC("FBAA LEVEL 2",DUZ)):"I $G(^(""ST""))=""C""",1:"I $P(^(0),U,5)=DUZ&($G(^(""ST""))=""C"")")
"RTN","FBAARB",6,0)
 D ^DIC K DIC G Q:X="^"!(X=""),BT:Y<0
"RTN","FBAARB",7,0)
 S FBBAT=+Y,FBTYPE=$P(Y(0),U,3)
"RTN","FBAARB",8,0)
 ;FBBAT=ien of batch in 161.7  FBTYPE= batch type (B2,B3,B5,B9)
"RTN","FBAARB",9,0)
 ;reset payment line item total and total dollars
"RTN","FBAARB",10,0)
 D CNTTOT(FBBAT)
"RTN","FBAARB",11,0)
 S DIE="^FBAA(161.7,",DR="4////^S X=DUZ;4.5///@;10////^S X=FBLCNT;8////^S X=FBTOTAL;11////^S X=""O"";S:$G(FBTYPE)'=""B9"" Y="""";9////^S X=FBLCNT",DA=FBBAT
"RTN","FBAARB",12,0)
 D ^DIE K DIE,DR
"RTN","FBAARB",13,0)
 S:FBTOTAL=0 $P(^FBAA(161.7,+FBBAT,0),U,9)=""
"RTN","FBAARB",14,0)
 S:FBLCNT=0 $P(^FBAA(161.7,+FBBAT,0),U,11)=""
"RTN","FBAARB",15,0)
 W !! D EN^DIQ W !,"Batch has been Re-opened!" D Q G BT
"RTN","FBAARB",16,0)
 ;
"RTN","FBAARB",17,0)
Q K DA,FBLCNT,FBTOTAL,FBBAT,Y
"RTN","FBAARB",18,0)
 Q
"RTN","FBAARB",19,0)
 ;
"RTN","FBAARB",20,0)
CNTTOT(B) ;called to determine line count and total dollars for a batch
"RTN","FBAARB",21,0)
 ; INPUT:  B = IEN of batch in 161.7
"RTN","FBAARB",22,0)
 ; OUTPUT: FBLCNT = total line items in batch
"RTN","FBAARB",23,0)
 ;         FBTOTAL= total dollars in batch
"RTN","FBAARB",24,0)
 ;
"RTN","FBAARB",25,0)
 N A
"RTN","FBAARB",26,0)
 S (FBLCNT,FBTOTAL)=0
"RTN","FBAARB",27,0)
 Q:'$G(B)
"RTN","FBAARB",28,0)
 Q:'$D(^FBAA(161.7,+B,0))  S A=$P($G(^(0)),U,3)
"RTN","FBAARB",29,0)
 Q:A']""
"RTN","FBAARB",30,0)
 D @A
"RTN","FBAARB",31,0)
 Q
"RTN","FBAARB",32,0)
B2 ;travel batch use ^FBAAC("AD", to locate line items
"RTN","FBAARB",33,0)
 N I,J
"RTN","FBAARB",34,0)
 S (I,J)=0 F  S I=$O(^FBAAC("AD",B,I)) Q:'I  F  S J=$O(^FBAAC("AD",B,I,J)) Q:'J  I $D(^FBAAC(I,3,J,0)) D
"RTN","FBAARB",35,0)
 . S FBLCNT=FBLCNT+1,FBTOTAL=FBTOTAL+$P(^(0),U,3)
"RTN","FBAARB",36,0)
 Q
"RTN","FBAARB",37,0)
 ;
"RTN","FBAARB",38,0)
B3 ;outpatient batch use ^FBAAC("AC", to locate line items
"RTN","FBAARB",39,0)
 N I,J,K,L
"RTN","FBAARB",40,0)
 S (I,J,K,L)=0
"RTN","FBAARB",41,0)
 F  S I=$O(^FBAAC("AC",B,I)) Q:'I  F  S J=$O(^FBAAC("AC",B,I,J)) Q:'J  F  S K=$O(^FBAAC("AC",B,I,J,K)) Q:'K  F  S L=$O(^FBAAC("AC",B,I,J,K,L)) Q:'L  I $D(^FBAAC(I,1,J,1,K,1,L,0)) D
"RTN","FBAARB",42,0)
 . S FBLCNT=FBLCNT+1,FBTOTAL=FBTOTAL+$P(^(0),U,3)
"RTN","FBAARB",43,0)
 Q
"RTN","FBAARB",44,0)
 ;
"RTN","FBAARB",45,0)
B5 ;pharmacy batch use ^FBAA(162.1,"AE", to locate line items
"RTN","FBAARB",46,0)
 N I,J
"RTN","FBAARB",47,0)
 S (I,J)=0
"RTN","FBAARB",48,0)
 F  S I=$O(^FBAA(162.1,"AE",B,I)) Q:'I  F  S J=$O(^FBAA(162.1,"AE",B,I,J)) Q:'J  I $D(^FBAA(162.1,I,"RX",J,0)) D
"RTN","FBAARB",49,0)
 . S FBLCNT=FBLCNT+1,FBTOTAL=FBTOTAL+$P(^(0),U,16)
"RTN","FBAARB",50,0)
 Q
"RTN","FBAARB",51,0)
 ;
"RTN","FBAARB",52,0)
B9 ;inpatient batch use ^FBAAI("AC", to locate line items
"RTN","FBAARB",53,0)
 N I
"RTN","FBAARB",54,0)
 S I=0
"RTN","FBAARB",55,0)
 F  S I=$O(^FBAAI("AC",B,I)) Q:'I  I $D(^FBAAI(I,0)) D
"RTN","FBAARB",56,0)
 . S FBLCNT=FBLCNT+1,FBTOTAL=FBTOTAL+$P(^(0),U,9)
"RTN","FBAARB",57,0)
 Q
"RTN","FBAARR1")
0^40^B29692050^B19022226
"RTN","FBAARR1",1,0)
FBAARR1 ;AISC/GRR - FEE BASIS REINITIATE ENTIRE BATCH ;3/19/2014
"RTN","FBAARR1",2,0)
 ;;3.5;FEE BASIS;**61,132,154**;JAN 30, 1995;Build 12
"RTN","FBAARR1",3,0)
 ;;Per VA Directive 6402, this routine should not be modified.
"RTN","FBAARR1",4,0)
RD S DIR(0)="Y",DIR("A")="Are you sure you want to re-initiate all line items in this batch",DIR("B")="NO"
"RTN","FBAARR1",5,0)
 D ^DIR K DIR G:$D(DIRUT)!'Y RD1^FBAARR
"RTN","FBAARR1",6,0)
 D WAIT^DICD
"RTN","FBAARR1",7,0)
 S (FBRJS,FBRJV)=0
"RTN","FBAARR1",8,0)
 D ALLM:FBTYPE="B3",ALLT:FBTYPE="B2",ALLP:FBTYPE="B5",ALLC:FBTYPE="B9"
"RTN","FBAARR1",9,0)
 K FBRJS,FBRJV
"RTN","FBAARR1",10,0)
 D UNLK^FBAARR
"RTN","FBAARR1",11,0)
 G BT^FBAARR
"RTN","FBAARR1",12,0)
 ;
"RTN","FBAARR1",13,0)
ALLM ; re-initiate all rejected line items in medical (B3) type batch
"RTN","FBAARR1",14,0)
 K FBILM
"RTN","FBAARR1",15,0)
 F J=0:0 S J=$O(^FBAAC("AH",B,J)) Q:J'>0  F K=0:0 S K=$O(^FBAAC("AH",B,J,K)) Q:K'>0  F L=0:0 S L=$O(^FBAAC("AH",B,J,K,L)) Q:L'>0  F M=0:0 S M=$O(^FBAAC("AH",B,J,K,L,M)) Q:M'>0  D REJM
"RTN","FBAARR1",16,0)
 ; Assign new invoice number to moved lines if medical invoice was split
"RTN","FBAARR1",17,0)
 I $$CKSPLIT^FBAARR(B,.FBILM) S DIR(0)="E" D ^DIR K DIR
"RTN","FBAARR1",18,0)
ADONE ;
"RTN","FBAARR1",19,0)
 W !!,"All rejected items have been re-initiated"
"RTN","FBAARR1",20,0)
 I '$G(FBRJS),'$G(FBRJV) W "!"
"RTN","FBAARR1",21,0)
 I $G(FBRJS)!$G(FBRJV) D
"RTN","FBAARR1",22,0)
 . W " with the following exceptions."
"RTN","FBAARR1",23,0)
 . I $G(FBRJS) W !,"One or more payments were not re-initiated due to separation of duties."
"RTN","FBAARR1",24,0)
 . I $G(FBRJV) W !,"Voided payments were not re-initiated."
"RTN","FBAARR1",25,0)
 Q
"RTN","FBAARR1",26,0)
 ;
"RTN","FBAARR1",27,0)
REJM S FBIN=+$P(^FBAAC(J,1,K,1,L,1,M,0),"^",16)
"RTN","FBAARR1",28,0)
 I $P(^FBAAC(J,1,K,1,L,1,M,0),"^",21)="VP" D VOID S FBRJV=1 Q
"RTN","FBAARR1",29,0)
 N FTP
"RTN","FBAARR1",30,0)
 ;
"RTN","FBAARR1",31,0)
 S FTP=$P($G(^FBAAC(J,1,K,1,L,1,M,3)),U,9)
"RTN","FBAARR1",32,0)
 I FTP,'$$UOKPAY^FBUTL9(J,FTP) D  S:$G(FBRJS)=0 FBRJS=1 Q
"RTN","FBAARR1",33,0)
 . W !!,"You cannot re-initiate invoice ",$P(^FBAAC(J,1,K,1,L,1,M,0),"^",16)," due to separation of duties."
"RTN","FBAARR1",34,0)
 . S FBERR=1
"RTN","FBAARR1",35,0)
 ;
"RTN","FBAARR1",36,0)
 S FBX=$$DELREJ^FBAARR3("162.03",M_","_L_","_K_","_J_",",FBNB)
"RTN","FBAARR1",37,0)
 I 'FBX D
"RTN","FBAARR1",38,0)
 . W !,"Error re-initiating line with IENs = "_M_","_L_","_K_","_J_","
"RTN","FBAARR1",39,0)
 . W !,"  ",$P(FBX,U,2)
"RTN","FBAARR1",40,0)
 . S FBERR=1
"RTN","FBAARR1",41,0)
 ; update list of invoice lines that were moved to the new batch
"RTN","FBAARR1",42,0)
 S FBILM(FBIN,M_","_L_","_K_","_J_",")=""
"RTN","FBAARR1",43,0)
 Q
"RTN","FBAARR1",44,0)
 ;
"RTN","FBAARR1",45,0)
ALLT F J=0:0 S J=$O(^FBAAC("AG",B,J)) Q:J'>0  F K=0:0 S K=$O(^FBAAC("AG",B,J,K)) Q:K'>0  D REJT
"RTN","FBAARR1",46,0)
 G ADONE
"RTN","FBAARR1",47,0)
REJT ;SETUP REJECT FIELDS FOR TRAVEL
"RTN","FBAARR1",48,0)
 N FTP
"RTN","FBAARR1",49,0)
 ;
"RTN","FBAARR1",50,0)
 S FTP=$P($G(^FBAAC(J,3,K,1)),U,1)
"RTN","FBAARR1",51,0)
 I FTP,'$$UOKPAY^FBUTL9(J,FTP) D  S:$G(FBRJS)=0 FBRJS=1 Q
"RTN","FBAARR1",52,0)
 . W !!,"You cannot re-initiate travel payment due to separation of duties."
"RTN","FBAARR1",53,0)
 . S FBERR=1
"RTN","FBAARR1",54,0)
 ;
"RTN","FBAARR1",55,0)
 S FBX=$$DELREJ^FBAARR3("162.04",K_","_J_",",FBNB)
"RTN","FBAARR1",56,0)
 I 'FBX D
"RTN","FBAARR1",57,0)
 . W !,"Error re-initiating line with IENs = "_K_","_J_","
"RTN","FBAARR1",58,0)
 . W !,"  ",$P(FBX,U,2)
"RTN","FBAARR1",59,0)
 . S FBERR=1
"RTN","FBAARR1",60,0)
 Q
"RTN","FBAARR1",61,0)
 ;
"RTN","FBAARR1",62,0)
ALLP F J=0:0 S J=$O(^FBAA(162.1,"AF",B,J)) Q:J'>0  F K=0:0 S K=$O(^FBAA(162.1,"AF",B,J,K)) Q:K'>0  D REJP
"RTN","FBAARR1",63,0)
 G ADONE
"RTN","FBAARR1",64,0)
REJP I $P($G(^FBAA(162.1,J,"RX",K,2)),"^",3)="V" S FBIN=J D VOID S FBRJV=1 Q
"RTN","FBAARR1",65,0)
 N FBDFN,FTP
"RTN","FBAARR1",66,0)
 ;
"RTN","FBAARR1",67,0)
 S FBDFN=$P($G(^FBAA(162.1,J,"RX",K,0)),"^",5)
"RTN","FBAARR1",68,0)
 S FTP=$P($G(^FBAA(162.1,J,"RX",K,2)),"^",7)
"RTN","FBAARR1",69,0)
 I FBDFN,FTP,'$$UOKPAY^FBUTL9(FBDFN,FTP) D  S:$G(FBRJS)=0 FBRJS=1 Q
"RTN","FBAARR1",70,0)
 . W !!,"You cannot re-initiate invoice ",J," due to separation of duties."
"RTN","FBAARR1",71,0)
 . S FBERR=1
"RTN","FBAARR1",72,0)
 ;
"RTN","FBAARR1",73,0)
 S FBX=$$DELREJ^FBAARR3("162.11",K_","_J_",",FBNB)
"RTN","FBAARR1",74,0)
 I 'FBX D
"RTN","FBAARR1",75,0)
 . W !,"Error re-initiating line with IENs = "_K_","_J_","
"RTN","FBAARR1",76,0)
 . W !,"  ",$P(FBX,U,2)
"RTN","FBAARR1",77,0)
 . S FBERR=1
"RTN","FBAARR1",78,0)
 Q
"RTN","FBAARR1",79,0)
 ;
"RTN","FBAARR1",80,0)
ALLC F J=0:0 S J=$O(^FBAAI("AH",B,J)) Q:J'>0  I $D(^FBAAI(J,0)) D REJC
"RTN","FBAARR1",81,0)
 G ADONE
"RTN","FBAARR1",82,0)
REJC I $P(^FBAAI(J,0),"^",14)="VP" S FBIN=J D VOID S FBRJV=1 Q
"RTN","FBAARR1",83,0)
 N FBDFN,FBI7078,FTP
"RTN","FBAARR1",84,0)
 ;
"RTN","FBAARR1",85,0)
 S FBDFN=$P(^FBAAI(J,0),"^",4)
"RTN","FBAARR1",86,0)
 S FBI7078=$P(^FBAAI(J,0),"^",5)
"RTN","FBAARR1",87,0)
 S FTP=$S(FBI7078]"":$O(^FBAAA("AG",FBI7078,FBDFN,0)),1:"")
"RTN","FBAARR1",88,0)
 I FBDFN,FTP,'$$UOKPAY^FBUTL9(FBDFN,FTP) D  S:$G(FBRJS)=0 FBRJS=1 Q
"RTN","FBAARR1",89,0)
 . W !!,"You cannot re-initiate invoice ",J," due to separation of duties."
"RTN","FBAARR1",90,0)
 . S FBERR=1
"RTN","FBAARR1",91,0)
 ;
"RTN","FBAARR1",92,0)
 S FBX=$$DELREJ^FBAARR3(162.5,J_",",FBNB)
"RTN","FBAARR1",93,0)
 I 'FBX D
"RTN","FBAARR1",94,0)
 . W !,"Error re-initiating line with IENs = "_J_","
"RTN","FBAARR1",95,0)
 . W !,"  ",$P(FBX,U,2)
"RTN","FBAARR1",96,0)
 . S FBERR=1
"RTN","FBAARR1",97,0)
 Q
"RTN","FBAARR1",98,0)
 ;
"RTN","FBAARR1",99,0)
KILL K A,A1,A2,B,CPTDESC,D0,DA,FBAACPT,FBAAOUT,FBVP,J,K,L,M,X,Y,Z,DIC,ERR,FBIN,FBNB,FBNUM,FBPV,FBRR,FBTYPE,FBVD,FBVDUZ,FZ,I,POP,DR,IOP,V,VID,ZS,FBN,FBOB,FBNOB,CNT,Q,UL,VAL,FBINTOT,PRCS,PRCSI,FBFDC,FBMST,FBTTYPE,FBSTN,FBDCB,FBBN
"RTN","FBAARR1",100,0)
 K FBAAAP,FBAC,FBAP,FBDX,FBFD,FBK,FBL,FBPDT,FBPROC,FBSC,FBINOLD,FBTD,N,S,FBCNT,FBNBCNT,I,DIRUT,FBEXMPT,FBX
"RTN","FBAARR1",101,0)
 K FBAAMPI,HX,B2,FBERR
"RTN","FBAARR1",102,0)
 Q
"RTN","FBAARR1",103,0)
 ;
"RTN","FBAARR1",104,0)
BATCNT ;GET NUMBER OF REJECTS IN OLD BATCH
"RTN","FBAARR1",105,0)
 S:'$D(FBAAMPI) FBAAMPI=$S($D(^FBAA(161.4,1,"FBNUM")):$P(^("FBNUM"),"^",3),1:100),FBAAMPI=$S(FBAAMPI]"":FBAAMPI,1:100)
"RTN","FBAARR1",106,0)
 Q:'$D(FBN)  S FBCNT=0
"RTN","FBAARR1",107,0)
 F I=0:0 S I=$O(^FBAAC("AH",FBN,I)) Q:'I  F J=0:0 S J=$O(^FBAAC("AH",FBN,I,J)) Q:'J  F K=0:0 S K=$O(^FBAAC("AH",FBN,I,J,K)) Q:'K  F L=0:0 S L=$O(^FBAAC("AH",FBN,I,J,K,L)) Q:'L  I $D(^FBAAC(I,1,J,1,K,1,L,"FBREJ")) S FBCNT=FBCNT+1
"RTN","FBAARR1",108,0)
 Q:'$D(FBNB)
"RTN","FBAARR1",109,0)
 S FBNBCNT=$S($D(^FBAA(161.7,FBNB,0)):(FBAAMPI-$P(^(0),"^",11)),1:0)
"RTN","FBAARR1",110,0)
 I FBCNT>FBNBCNT W !!,*7,"New Batch selected does not have enough room to fit the",!,FBCNT," rejects pending from batch ",$P(FZ,"^")," !",!! K FBNB Q
"RTN","FBAARR1",111,0)
 Q
"RTN","FBAARR1",112,0)
 ;
"RTN","FBAARR1",113,0)
VOID W !!,*7,"Invoice #: ",FBIN," has a status of VOID.  Please delete the VOID",!,"before re-initiating this rejected payment."
"RTN","FBAARR1",114,0)
 Q
"RTN","FBAASCB")
0^4^B26462590^B27212930
"RTN","FBAASCB",1,0)
FBAASCB ;AISC/GRR - SUPERVISOR RELEASE ;5/15/14  15:48
"RTN","FBAASCB",2,0)
 ;;3.5;FEE BASIS;**38,61,116,117,132,154**;JAN 30, 1995;Build 12
"RTN","FBAASCB",3,0)
 ;;Per VA Directive 6402, this routine should not be modified.
"RTN","FBAASCB",4,0)
 S FBERR=0 D DT^DICRW
"RTN","FBAASCB",5,0)
 I '$D(^FBAA(161.7,"AC","C"))&('$D(^FBAA(161.7,"AC","A"))) W !!,*7,"There are no batches Pending Release!" Q
"RTN","FBAASCB",6,0)
BT W !! S DIC="^FBAA(161.7,",DIC(0)="AEQ",DIC("S")="I ($G(^(""ST""))=""C""!($G(^(""ST""))=""A""))&('$G(^XTMP(""FBAASCB"",+Y)))" D ^DIC K DIC("S") G Q:X="^"!(X=""),BT:Y<0 S FBN=+Y,^XTMP("FBAASCB",FBN)=1
"RTN","FBAASCB",7,0)
 D LOCK^FBUCUTL("^FBAA(161.7,",FBN) I 'FBLOCK W !!,*7,"Try releasing batch at another time." D Q G FBAASCB
"RTN","FBAASCB",8,0)
 S FZ=^FBAA(161.7,FBN,0),FBTYPE=$P(FZ,"^",3),FBAAON=$P(FZ,"^",2),FBAAB=$P(FZ,"^")
"RTN","FBAASCB",9,0)
 I $G(FBTYPE)="B9",$P(FZ,"^",15)="Y",$P(^FBAA(161.7,FBN,"ST"),"^")="C",$P(FZ,"^",18)'="Y" W !!,*7,"Batch needs to be released to Pricer first.",! G Q
"RTN","FBAASCB",10,0)
 I $G(FBTYPE)="B9",$P(FZ,"^",15)="" S FBCNH=1
"RTN","FBAASCB",11,0)
 S FBSTAT=^FBAA(161.7,FBN,"ST"),FBSTAT=$S(FBSTAT="C":"S",FBSTAT="A":"R",1:FBSTAT)
"RTN","FBAASCB",12,0)
 S FBAAOB=$P(FZ,"^",8)_"-"_FBAAON,FBAAMT=$P(FZ,"^",9),FBCOMM="Release of batch "_FBAAB
"RTN","FBAASCB",13,0)
 ; enforce segregation of duties (FB*3.5*117)
"RTN","FBAASCB",14,0)
 D UOKCERT^PRCEMOA(.FBUOK,FBAAOB,DUZ) ; IA #5573
"RTN","FBAASCB",15,0)
 I 'FBUOK D  D Q G FBAASCB
"RTN","FBAASCB",16,0)
 . W $C(7),!,$P(FBUOK,U,2) ; display text returned by IFCAP API
"RTN","FBAASCB",17,0)
 . I $P(FBUOK,U)="0" W !,"Due to segregation of duties, you cannot also certify an invoice for payment."
"RTN","FBAASCB",18,0)
 . I $P(FBUOK,U)="E" W !,"This 1358 error must be resolved before the batch can be released."
"RTN","FBAASCB",19,0)
 ;
"RTN","FBAASCB",20,0)
 S DA=FBN,DR="0:1;ST" W !! D EN^DIQ
"RTN","FBAASCB",21,0)
RD S B=FBN S DIR(0)="Y",DIR("A")="Want line items listed",DIR("B")="NO" D ^DIR K DIR G Q:$D(DIRUT) W:Y @IOF D:Y LIST^FBAACCB:FBTYPE="B3",LISTP^FBAACCB:FBTYPE="B5",LISTT^FBAACCB0:FBTYPE="B2",LISTC^FBAACCB1:FBTYPE="B9"
"RTN","FBAASCB",22,0)
RDD S DIR(0)="Y",DIR("A")="Do you want to Release Batch as Correct",DIR("B")="NO" D ^DIR K DIR G Q:$D(DIRUT) I 'Y W !!,"Batch has NOT been Released!",*7 D Q G FBAASCB
"RTN","FBAASCB",23,0)
 D WAIT^DICD
"RTN","FBAASCB",24,0)
 S FBAARA=0
"RTN","FBAASCB",25,0)
 I FBTYPE="B9" D ^FBAASCB0 G SHORT:$D(FBERR)
"RTN","FBAASCB",26,0)
 I FBTYPE="B9",FBAARA>0 S FBAAMT=FBAARA D POST G SHORT:$D(FBERR)
"RTN","FBAASCB",27,0)
 I FBTYPE'="B9" D POST I $D(FBERR) G SHORT
"RTN","FBAASCB",28,0)
FIN ;
"RTN","FBAASCB",29,0)
 ; use FileMan to update fields 5 and 6, store date & time (FB*3.5*117)
"RTN","FBAASCB",30,0)
 S DA=FBN,DIE="^FBAA(161.7,"
"RTN","FBAASCB",31,0)
 S DR="11////^S X=FBSTAT;6////^S X=DUZ;5////^S X=$$NOW^XLFDT" D ^DIE
"RTN","FBAASCB",32,0)
 K DA,DIE,DIC,DR
"RTN","FBAASCB",33,0)
 D UCAUTOP
"RTN","FBAASCB",34,0)
 S DA=FBN,DR="0:1;ST",DIC="^FBAA(161.7," W !! D EN^DIQ W !!," Batch has been Released!"
"RTN","FBAASCB",35,0)
 D Q G FBAASCB
"RTN","FBAASCB",36,0)
Q I $G(FBN) K ^XTMP("FBAASCB",FBN) L -^FBAA(161.7,FBN)
"RTN","FBAASCB",37,0)
 K B,J,K,L,M,X,Y,Z,DIC,FBN,A,A1,A2,BE,CPTDESC,D0,DA,DL,DR,DRX,DX,FBAACB,FBAACPT,FBAAON,FBAAOUT,FBVP,FBIN,DK,N,XY,FBINOLD,FBINTOT,FBTYPE,FZ,P3,P4,Q,S,T,V,VID,ZS,FBAAB,FBAAMT,FBAAOB,FBCOMM,FBAUT,FBSITE,I,X,Y,Z,FBERR,DIRUT,FBSTAT,FBLOCK
"RTN","FBAASCB",38,0)
 K FBAC,FBAP,FBCNH,FBFD,FBI,FBLISTC,FBPDT,FBSC,FBTD,PRCSCPAN,DFN,FBINV
"RTN","FBAASCB",39,0)
 K FBUOK,FBAARA
"RTN","FBAASCB",40,0)
 Q
"RTN","FBAASCB",41,0)
SHORT ;
"RTN","FBAASCB",42,0)
 I '$D(FBINV) W !!,*7,"This batch CANNOT be released. Check your 1358.",!
"RTN","FBAASCB",43,0)
 L -^FBAA(161.7,FBN) D Q G FBAASCB
"RTN","FBAASCB",44,0)
POST ;FBAAOB=FULL OBLIGATION NUMBER(STA-CXXXXX)
"RTN","FBAASCB",45,0)
 ;FBCOMM=COMMENT FOR 1358
"RTN","FBAASCB",46,0)
 ;FBAAMT=TOTAL AMOUNT OF BATCH
"RTN","FBAASCB",47,0)
 ;FBAAB=BATCH NUMBER
"RTN","FBAASCB",48,0)
 ;IF CALL FAILS FBERR RETURNED=1
"RTN","FBAASCB",49,0)
 ;FBN added as 7th peice of 'X'. It is the interface ID
"RTN","FBAASCB",50,0)
 K FBERR
"RTN","FBAASCB",51,0)
 S PRCS("X")=FBAAOB,PRCS("TYPE")="FB" D EN3^PRCS58 I Y=-1 W !!,*7,?5,"1358 not available for posting!",! S FBERR=1 Q
"RTN","FBAASCB",52,0)
 D NOW^%DTC S X=FBAAOB_"^"_%_"^^"_FBAAMT_"^"_$S($L(FBAAB)<3:$$PADZ^FBAAV01(FBAAB,4),1:FBAAB)_"^"_FBCOMM_"^"_FBN_"^"_1,PRCS("TYPE")="FB" D EN2^PRCS58 I +Y=0 W !!,*7,Y,! S FBERR=1 Q
"RTN","FBAASCB",53,0)
 K PRCS("SITE"),PRCSI Q
"RTN","FBAASCB",54,0)
UCAUTOP ; Unauthorized Claims Autoprint
"RTN","FBAASCB",55,0)
 ; If unauthorized claims autoprint feature is enabled then check items
"RTN","FBAASCB",56,0)
 ; in batch and print an unauthorized claim disposition letter if all
"RTN","FBAASCB",57,0)
 ; payments for a claim have been released
"RTN","FBAASCB",58,0)
 ; input FBN    - batch ien
"RTN","FBAASCB",59,0)
 ;       FBTYPE - batch type
"RTN","FBAASCB",60,0)
 ;       FBCNH  - (opt) equals 1 if batch is for community nursing home
"RTN","FBAASCB",61,0)
 N DA,FBDA,FBORDER,FBUC,FBUCA,FBX
"RTN","FBAASCB",62,0)
 Q:"^B3^B5^B9^"'[(U_FBTYPE_U)  ; not an applicable batch type
"RTN","FBAASCB",63,0)
 Q:$G(FBCNH)=1  ; CNH batch won't have associated unauth claims
"RTN","FBAASCB",64,0)
 S FBUC=$$FBUC^FBUCUTL2(1)
"RTN","FBAASCB",65,0)
 Q:'$$PARAM^FBUCLET(FBUC)  ; autoprint feature not enabled
"RTN","FBAASCB",66,0)
 ;
"RTN","FBAASCB",67,0)
 ; loop thru items in batch to build list of unauthorized claims
"RTN","FBAASCB",68,0)
 K ^TMP("FBUC",$J)
"RTN","FBAASCB",69,0)
 I FBTYPE="B3" D  ; if outpatient/ancillary batch
"RTN","FBAASCB",70,0)
 . S DA(3)=0 F  S DA(3)=$O(^FBAAC("AC",FBN,DA(3))) Q:'DA(3)  D
"RTN","FBAASCB",71,0)
 . . S DA(2)=0 F  S DA(2)=$O(^FBAAC("AC",FBN,DA(3),DA(2))) Q:'DA(2)  D
"RTN","FBAASCB",72,0)
 . . . S DA(1)=0
"RTN","FBAASCB",73,0)
 . . . F  S DA(1)=$O(^FBAAC("AC",FBN,DA(3),DA(2),DA(1))) Q:'DA(1)  D
"RTN","FBAASCB",74,0)
 . . . . S DA=0
"RTN","FBAASCB",75,0)
 . . . . F  S DA=$O(^FBAAC("AC",FBN,DA(3),DA(2),DA(1),DA)) Q:'DA  D
"RTN","FBAASCB",76,0)
 . . . . . S FBX=$P($G(^FBAAC(DA(3),1,DA(2),1,DA(1),1,DA,0)),U,13)
"RTN","FBAASCB",77,0)
 . . . . . I FBX["FB583" S ^TMP("FBUC",$J,+FBX)=""
"RTN","FBAASCB",78,0)
 I FBTYPE="B5" D  ; if pharmacy batch
"RTN","FBAASCB",79,0)
 . S DA(1)=0 F  S DA(1)=$O(^FBAA(162.1,"AE",FBN,DA(1))) Q:'DA(1)  D
"RTN","FBAASCB",80,0)
 . . S DA=0 F  S DA=$O(^FBAA(162.1,"AE",FBN,DA(1),DA)) Q:'DA  D
"RTN","FBAASCB",81,0)
 . . . S FBX=$P($G(^FBAA(162.1,DA(1),"RX",DA,2)),U,6)
"RTN","FBAASCB",82,0)
 . . . I FBX["FB583" S ^TMP("FBUC",$J,+FBX)=""
"RTN","FBAASCB",83,0)
 I FBTYPE="B9" D  ; if inpatient batch
"RTN","FBAASCB",84,0)
 . S DA=0 F  S DA=$O(^FBAAI("AC",FBN,DA)) Q:'DA  D
"RTN","FBAASCB",85,0)
 . . S FBX=$P($G(^FBAAI(DA,0)),U,5)
"RTN","FBAASCB",86,0)
 . . I FBX["FB583" S ^TMP("FBUC",$J,+FBX)=""
"RTN","FBAASCB",87,0)
 ;
"RTN","FBAASCB",88,0)
 ; loop thru unauthorized claim list and print letter when appropriate
"RTN","FBAASCB",89,0)
 S FBDA=0 F  S FBDA=$O(^TMP("FBUC",$J,FBDA)) Q:'FBDA  D
"RTN","FBAASCB",90,0)
 . Q:'$$PAYST^FBUCUTL(FBDA)  ; not all payments for claim released yet
"RTN","FBAASCB",91,0)
 . S FBUCA=$G(^FB583(FBDA,0))
"RTN","FBAASCB",92,0)
 . Q:$P(FBUCA,U,16)'=1  ; claim not flagged for printing
"RTN","FBAASCB",93,0)
 . S FBORDER=$$ORDER^FBUCUTL($P(FBUCA,U,24))
"RTN","FBAASCB",94,0)
 . D AUTO^FBUCLET(FBDA,FBORDER,FBUCA,FBUC) ; autoprint letter
"RTN","FBAASCB",95,0)
 ;
"RTN","FBAASCB",96,0)
 K ^TMP("FBUC",$J)
"RTN","FBAASCB",97,0)
 Q
"RTN","FBAASCB",98,0)
 ;
"RTN","FBAASKR")
0^68^B33713453^n/a
"RTN","FBAASKR",1,0)
FBAASKR ;WIOFO/LKG - SECURITY KEY REPORT ;1/29/15  11:27
"RTN","FBAASKR",2,0)
 ;;3.5;FEE BASIS;**154**;JAN 30, 1995;Build 12
"RTN","FBAASKR",3,0)
 ;;Per VA Directive 6402, this routine should not be modified.
"RTN","FBAASKR",4,0)
 ; IAs
"RTN","FBAASKR",5,0)
 ;  #1340   Lookup Security Key file (#19.1) entries
"RTN","FBAASKR",6,0)
 ;  #4398   FIRST^VAUTOMA
"RTN","FBAASKR",7,0)
 ;  #10060  New Person File (#200) Read w/FileMan
"RTN","FBAASKR",8,0)
 ;  #10090  Institution File (#4) Read w/FileMan
"RTN","FBAASKR",9,0)
 ;  #10076  ^XUSEC GLOBAL
"RTN","FBAASKR",10,0)
 ;
"RTN","FBAASKR",11,0)
ST ;
"RTN","FBAASKR",12,0)
 N DIR,DIRUT,DIROUT,DTOUT,DUOUT,X,Y,FBABORT,FBACTIVE,FBRT,POP,VAUTSTR,VAUTNI,VAUTVB,FBKEY,FBUSER
"RTN","FBAASKR",13,0)
 S DIR(0)="YB",DIR("A")="Should report include terminated users with keys",DIR("B")="NO"
"RTN","FBAASKR",14,0)
 D ^DIR G:$D(DIRUT) END
"RTN","FBAASKR",15,0)
 S FBACTIVE=$S('Y:1,1:0) K DIR
"RTN","FBAASKR",16,0)
 S FBABORT=0
"RTN","FBAASKR",17,0)
 S DIR(0)="SB^S:SECURITY KEY;U:USER",DIR("A")="Sort by Security Key or User"
"RTN","FBAASKR",18,0)
 S DIR("?",1)="Enter 'S' to have report by Security Key or"
"RTN","FBAASKR",19,0)
 S DIR("?")="  'U' to have the report by User.  Enter '^' to exit."
"RTN","FBAASKR",20,0)
 S DIR("??")="^D EN^DDIOL(""The report is users listed by Security Key (S) or Keys listed by User (U)."","""",""!?2"")"
"RTN","FBAASKR",21,0)
 D ^DIR
"RTN","FBAASKR",22,0)
 G END:$D(DIRUT)
"RTN","FBAASKR",23,0)
 S FBRT=Y
"RTN","FBAASKR",24,0)
 I FBRT="S" D  G END:FBABORT,DEV
"RTN","FBAASKR",25,0)
 . N DIC S DIC="^DIC(19.1,",DIC("S")="I $E($P($G(^(0)),U),1,2)=""FB"",$E($P($G(^(0)),U),3)'=""Z"""
"RTN","FBAASKR",26,0)
 . S VAUTSTR="Fee Basis Security Key",VAUTNI=2,VAUTVB="FBKEY"
"RTN","FBAASKR",27,0)
 . D FIRST^VAUTOMA I Y=-1 S FBABORT=1
"RTN","FBAASKR",28,0)
 . I FBKEY=1 D
"RTN","FBAASKR",29,0)
 . . N FBARR,FBERR,FBI
"RTN","FBAASKR",30,0)
 . . D LIST^DIC(19.1,"","","","","","FB","B","I $E($P($G(^(0)),U),1,3)'=""FBZ""","","FBARR","FBERR")
"RTN","FBAASKR",31,0)
 . . F FBI=1:1:(+FBARR("DILIST",0)) S FBKEY(FBARR("DILIST",2,FBI))=FBARR("DILIST",1,FBI)
"RTN","FBAASKR",32,0)
 I FBRT="U" D  G END:FBABORT,DEV
"RTN","FBAASKR",33,0)
 . N DIC S DIC="^VA(200,",VAUTSTR="User",VAUTNI=2,VAUTVB="FBUSER"
"RTN","FBAASKR",34,0)
 . S:FBACTIVE DIC("S")="I '$$TERM^FBAASKR(Y)"
"RTN","FBAASKR",35,0)
 . D FIRST^VAUTOMA I Y=-1 S FBABORT=1
"RTN","FBAASKR",36,0)
DEV ;Ask device
"RTN","FBAASKR",37,0)
 S %ZIS="Q" D ^%ZIS G:POP END
"RTN","FBAASKR",38,0)
 I $D(IO("Q")) D  G END
"RTN","FBAASKR",39,0)
 . N ZTRTN,ZTDESC,ZTDTH,ZTIO,ZTUCI,ZTCPU,ZPRI,ZTSAVE,ZTKIL,ZTSYNC,ZTSK
"RTN","FBAASKR",40,0)
 . S ZTRTN="COMPILE^FBAASKR",ZTDESC="Security Key Report for Fee Basis"
"RTN","FBAASKR",41,0)
 . S ZTSAVE("FBKEY")="",ZTSAVE("FBKEY(")="",ZTSAVE("FBUSER")="",ZTSAVE("FBUSER(")="",ZTSAVE("FBRT")="",ZTSAVE("FBACTIVE")=""
"RTN","FBAASKR",42,0)
 . D ^%ZTLOAD,HOME^%ZIS
"RTN","FBAASKR",43,0)
COMPILE ;
"RTN","FBAASKR",44,0)
 N DIR,DIRUT,DIROUT,DTOUT,DUOUT,FBABORT,FBDTR,FBLINE,FBLP,FBPAGE,X,Y
"RTN","FBAASKR",45,0)
 S FBABORT=0,$P(FBLINE,"-",41)="",FBPAGE=0
"RTN","FBAASKR",46,0)
 D NOW^%DTC S Y=% D DD^%DT S FBDTR=Y
"RTN","FBAASKR",47,0)
 ;
"RTN","FBAASKR",48,0)
 K ^TMP($J)
"RTN","FBAASKR",49,0)
 I FBRT="S" D
"RTN","FBAASKR",50,0)
 . N FBERR,FBI,FBJ,FBK,FBN S FBI=""
"RTN","FBAASKR",51,0)
 . F  S FBI=$O(FBKEY(FBI)) Q:'FBI  D
"RTN","FBAASKR",52,0)
 . . S FBJ=FBKEY(FBI)
"RTN","FBAASKR",53,0)
 . . I '$D(^XUSEC(FBJ)) S ^TMP($J,FBJ,"No holders^0")="" Q
"RTN","FBAASKR",54,0)
 . . S FBK=""
"RTN","FBAASKR",55,0)
 . . F  S FBK=$O(^XUSEC(FBJ,FBK)) Q:FBK=""  D
"RTN","FBAASKR",56,0)
 . . . I FBACTIVE,$$TERM(FBK) Q
"RTN","FBAASKR",57,0)
 . . . S FBN=$$GET1^DIQ(200,FBK_",",.01,"","","FBERR") K FBERR
"RTN","FBAASKR",58,0)
 . . . S ^TMP($J,FBJ,FBN_"^"_FBK)=""
"RTN","FBAASKR",59,0)
 I FBRT="U" D
"RTN","FBAASKR",60,0)
 . I FBUSER'=1 D  Q
"RTN","FBAASKR",61,0)
 . . N FBC,FBK,FBJ S FBK=""
"RTN","FBAASKR",62,0)
 . . F  S FBK=$O(FBUSER(FBK)) Q:FBK=""  D
"RTN","FBAASKR",63,0)
 . . . S FBJ="FA~",FBC=0
"RTN","FBAASKR",64,0)
 . . . F  S FBJ=$O(^XUSEC(FBJ)) Q:FBJ]"FBY~"!(FBJ="")  D
"RTN","FBAASKR",65,0)
 . . . . I $D(^XUSEC(FBJ,FBK)) S ^TMP($J,FBUSER(FBK)_"^"_FBK,FBJ)="",FBC=FBC+1
"RTN","FBAASKR",66,0)
 . . . S:FBC=0 ^TMP($J,FBUSER(FBK)_"^"_FBK,"No Fee Basis Key Held")=""
"RTN","FBAASKR",67,0)
 . I FBUSER=1 D
"RTN","FBAASKR",68,0)
 . . N FBERR,FBJ,FBK,FBN
"RTN","FBAASKR",69,0)
 . . S FBJ="FA~"
"RTN","FBAASKR",70,0)
 . . F  S FBJ=$O(^XUSEC(FBJ)) Q:FBJ]"FBY~"!(FBJ="")  D
"RTN","FBAASKR",71,0)
 . . . S FBK=0
"RTN","FBAASKR",72,0)
 . . . F  S FBK=$O(^XUSEC(FBJ,FBK)) Q:FBK=""  D
"RTN","FBAASKR",73,0)
 . . . . I FBACTIVE,$$TERM(FBK) Q
"RTN","FBAASKR",74,0)
 . . . . S FBN=$$GET1^DIQ(200,FBK_",",".01","","","FBERR") K FBERR
"RTN","FBAASKR",75,0)
 . . . . S ^TMP($J,FBN_"^"_FBK,FBJ)=""
"RTN","FBAASKR",76,0)
 ;
"RTN","FBAASKR",77,0)
PRT ;Print report
"RTN","FBAASKR",78,0)
 U IO D HDR
"RTN","FBAASKR",79,0)
 N FBI,FBIOLD,FBDA,FBJ,FBK,FBN,FBOLDPG,FBU,FBX S FBOLDPG=FBPAGE
"RTN","FBAASKR",80,0)
 S FBI="",FBIOLD="",FBJ=""
"RTN","FBAASKR",81,0)
 F  S FBI=$O(^TMP($J,FBI)) Q:FBI=""  D  Q:FBABORT
"RTN","FBAASKR",82,0)
 . F  S FBJ=$O(^TMP($J,FBI,FBJ)) Q:FBJ=""  D  Q:FBABORT
"RTN","FBAASKR",83,0)
 . . D:FBLP+5>IOSL HDR Q:FBABORT
"RTN","FBAASKR",84,0)
 . . I FBRT="S" D
"RTN","FBAASKR",85,0)
 . . . I FBI=FBIOLD,FBPAGE'=FBOLDPG W !!,"Key: ",FBI,?35,"(continued)" S FBLP=FBLP+2
"RTN","FBAASKR",86,0)
 . . . I FBI'=FBIOLD W !!,"Key: ",FBI S FBIOLD=FBI,FBLP=FBLP+2
"RTN","FBAASKR",87,0)
 . . . S FBDA=$P(FBJ,U,2),FBN=$P(FBJ,U),FBX=$S(FBDA>0:$$GETDATA(FBDA),1:FBN)
"RTN","FBAASKR",88,0)
 . . . W !?2,$P(FBX,U)_$S($P(FBX,U,5)'="":" (T)",1:""),?37,$P(FBX,U,2),?44,$P(FBX,U,3) S FBLP=FBLP+1
"RTN","FBAASKR",89,0)
 . . . I $P(FBX,U,4)'="" W !?5,"Division(s): ",$P(FBX,U,4) S FBLP=FBLP+1
"RTN","FBAASKR",90,0)
 . . . S FBOLDPG=FBPAGE
"RTN","FBAASKR",91,0)
 . . I FBRT="U" D
"RTN","FBAASKR",92,0)
 . . . I FBI=FBIOLD,FBPAGE'=FBOLDPG W !,$P(FBI,U),?35,"(continued)" S FBLP=FBLP+1
"RTN","FBAASKR",93,0)
 . . . I FBI'=FBIOLD D
"RTN","FBAASKR",94,0)
 . . . . S FBIOLD=FBI
"RTN","FBAASKR",95,0)
 . . . . S FBDA=$P(FBI,U,2),FBN=$P(FBI,U),FBX=$S(FBDA>0:$$GETDATA(FBDA),1:"")
"RTN","FBAASKR",96,0)
 . . . . W !,$P(FBX,U)_$S($P(FBX,U,5)'="":" (T)",1:""),?37,$P(FBX,U,2),?44,$P(FBX,U,3) S FBLP=FBLP+1
"RTN","FBAASKR",97,0)
 . . . . I $P(FBX,U,4)'="" W !?5,"Division(s): ",$P(FBX,U,4) S FBLP=FBLP+1
"RTN","FBAASKR",98,0)
 . . . W !?3,"Key: ",FBJ S FBLP=FBLP+1
"RTN","FBAASKR",99,0)
 . . . S FBOLDPG=FBPAGE
"RTN","FBAASKR",100,0)
 I 'FBABORT,$E(IOST,1,2)="C-" N DIR S DIR(0)="E" D ^DIR
"RTN","FBAASKR",101,0)
 D ^%ZISC
"RTN","FBAASKR",102,0)
END ;
"RTN","FBAASKR",103,0)
 S:$D(ZTQUEUED) ZTREQ="@"
"RTN","FBAASKR",104,0)
 K ^TMP($J),FBKEY,FBUSER,FBRT,FBACTIVE
"RTN","FBAASKR",105,0)
 Q
"RTN","FBAASKR",106,0)
TERM(FBIEN) ;Extrinsic function that returns
"RTN","FBAASKR",107,0)
 ; '1' if user is terminated, or
"RTN","FBAASKR",108,0)
 ; '0' if not terminated.
"RTN","FBAASKR",109,0)
 ;Input FBIEN is the IEN of the person in the New Person file (#200)
"RTN","FBAASKR",110,0)
 N FBTERMDT,FBERR,FBRESULT S FBRESULT=0
"RTN","FBAASKR",111,0)
 S FBTERMDT=$$GET1^DIQ(200,FBIEN_",",9.2,"","","FBERR")
"RTN","FBAASKR",112,0)
 I FBTERMDT'="",FBTERMDT'>DT S FBRESULT=1
"RTN","FBAASKR",113,0)
 Q FBRESULT
"RTN","FBAASKR",114,0)
 ;
"RTN","FBAASKR",115,0)
HDR ;Writing report heading
"RTN","FBAASKR",116,0)
 I $E(IOST,1,2)="C-",FBPAGE>0 D  Q:FBABORT
"RTN","FBAASKR",117,0)
 . N DIR S DIR(0)="E" D ^DIR
"RTN","FBAASKR",118,0)
 . S:$D(DIRUT) FBABORT=1
"RTN","FBAASKR",119,0)
 S FBPAGE=FBPAGE+1
"RTN","FBAASKR",120,0)
 W @IOF,"Security Key Report for Fee Basis",?44,FBDTR,"   page ",FBPAGE
"RTN","FBAASKR",121,0)
 I FBRT="S" W !?2,"by Security Key for ",$S(FBKEY=1:"all",1:"specified")," FB keys"
"RTN","FBAASKR",122,0)
 I FBRT="U" W !?2,"by User for ",$S(FBUSER=1:"all",1:"specified")," users"
"RTN","FBAASKR",123,0)
 W:'FBACTIVE " including terminated (T) users"
"RTN","FBAASKR",124,0)
 W !!,"Name",?37,"SSN",?44,"Title",!,$E(FBLINE,1,35),?37,$E(FBLINE,1,4),?44,$E(FBLINE,1,30)
"RTN","FBAASKR",125,0)
 S FBLP=5
"RTN","FBAASKR",126,0)
 Q
"RTN","FBAASKR",127,0)
 ;
"RTN","FBAASKR",128,0)
GETDATA(FBIEN) ;This extrinsic function returns a caret delimited string
"RTN","FBAASKR",129,0)
 ;of Name^Last4_SSN^Title^Division(comma-delimited station #s)^Terminated_flag
"RTN","FBAASKR",130,0)
 ;FBIEN is the IEN of the person in the New Person file (#200)
"RTN","FBAASKR",131,0)
 N FBARRAY,FBERR,FBI,FBW,FBX,FBY
"RTN","FBAASKR",132,0)
 S FBIEN=FBIEN_","
"RTN","FBAASKR",133,0)
 D GETS^DIQ(200,FBIEN,".01;8;9","","FBARRAY","FBERR")
"RTN","FBAASKR",134,0)
 S FBY=FBARRAY(200,FBIEN,9)
"RTN","FBAASKR",135,0)
 S FBX=FBARRAY(200,FBIEN,.01)_"^"_$E(FBY,$L(FBY)-3,$L(FBY))_"^"_FBARRAY(200,FBIEN,8)
"RTN","FBAASKR",136,0)
 K FBARRAY,FBERR D GETS^DIQ(200,FBIEN,"16*","I","FBARRAY","FBERR")
"RTN","FBAASKR",137,0)
 S FBY="",FBI="",FBW=""
"RTN","FBAASKR",138,0)
 F  S FBI=$O(FBARRAY(200.02,FBI)) Q:FBI=""  D
"RTN","FBAASKR",139,0)
 . S FBW=FBARRAY(200.02,FBI,.01,"I") K FBERR
"RTN","FBAASKR",140,0)
 . S FBW=$$GET1^DIQ(4,FBW_",",99,"","","FBERR")
"RTN","FBAASKR",141,0)
 . S:FBW'="" FBY=FBY_$S(FBY="":"",1:", ")_FBW
"RTN","FBAASKR",142,0)
 S FBX=FBX_"^"_FBY_"^"_$S($$TERM(FBIEN):"T",1:"")
"RTN","FBAASKR",143,0)
 Q FBX
"RTN","FBAASKR",144,0)
 ;FBAASKR
"RTN","FBAAUTL2")
0^23^B18342335^B19718250
"RTN","FBAAUTL2",1,0)
FBAAUTL2 ;AISC/GRR - FEE UTILITY ROUTINE ;9/21/14  21:48
"RTN","FBAAUTL2",2,0)
 ;;3.5;FEE BASIS;**8,143,154**;JAN 30, 1995;Build 12
"RTN","FBAAUTL2",3,0)
 ;;Per VA Directive 6402, this routine should not be modified.
"RTN","FBAAUTL2",4,0)
CONDAT ;called from input transform in 161.21,.02-.03
"RTN","FBAAUTL2",5,0)
 S (FBOUT,Z)=0
"RTN","FBAAUTL2",6,0)
 F  S Z=$O(^FBAA(161.21,"C",+$G(FBVIEN),Z)) Q:'Z  I $P($G(^FBAA(161.21,Z,0)),U,2) S Z(0)=^(0),FBVCON($P(Z(0),U,2))=$P(Z(0),U,3)
"RTN","FBAAUTL2",7,0)
 K FBVCON(+$P(^FBAA(161.21,DA,0),U,2))
"RTN","FBAAUTL2",8,0)
 S Z=0 F  S Z=$O(FBVCON(Z)) Q:Z'>0!(FBOUT)  I X'<Z&(X'>FBVCON(Z)) S FBOUT=1 W !,*7,"Date entered overlaps existing contract dates!",! K X,Z,FBVCON Q
"RTN","FBAAUTL2",9,0)
 K Z,FBVCON
"RTN","FBAAUTL2",10,0)
 Q
"RTN","FBAAUTL2",11,0)
DATES ;ASK FROM AND TO DATES AND ENSURE THEY DO NOT OVERLAP PRIOR AUTHORIZATIONS
"RTN","FBAAUTL2",12,0)
 ;variables FBO and FB1 are set in FBNHEDAT as default dates
"RTN","FBAAUTL2",13,0)
 S FBFLAG=1 K FBAUT
"RTN","FBAAUTL2",14,0)
FDAT S (FBBEGDT,FBENDDT)="",%DT("A")="Select FROM DATE: ",%DT="AEX" S:$S($G(FBO):1,1:0) %DT("B")=$$FMTE^XLFDT(FBO,1) D ^%DT G:Y'>0 END S FBBEGDT=Y
"RTN","FBAAUTL2",15,0)
 G:FBFLAG=2 EN1
"RTN","FBAAUTL2",16,0)
EDAT S FBOUT=0,%DT("A")="Select TO DATE: ",%DT="AEX",%DT(0)=FBBEGDT S:$S($G(FB1):1,1:0) %DT("B")=$$FMTE^XLFDT(FB1,1) D ^%DT K %DT(0) G:Y'>0 END S FBENDDT=Y
"RTN","FBAAUTL2",17,0)
EN1 ;CHECK WHETHER AUTHORIZATION FROM DATE OVERLAPS PREVIOUS ENTRIES
"RTN","FBAAUTL2",18,0)
 S (FBOUT,FBLG)=0 F Z=0:0 S Z=$O(^FBAAA(DFN,1,Z)) Q:Z'>0  I $D(^(Z,0)) S Z(0)=^(0) I $P(Z(0),"^",3)=FBPROG S FBAUT($P(Z(0),"^"))=$P(Z(0),"^",2)
"RTN","FBAAUTL2",19,0)
 I $G(FBO),($G(FB1)),($G(FBAUT(FBO))=FB1) K FBAUT(FBO)
"RTN","FBAAUTL2",20,0)
 F Z=0:0 S Z=$O(FBAUT(Z)) Q:Z'>0!(FBOUT)  D CHKDT:FBFLAG=1,CHKBO:FBFLAG=2,ERRD:FBLG>0
"RTN","FBAAUTL2",21,0)
 I FBOUT S FBOUT=0 G:FBLG>0&(FBFLAG=1) FDAT
"RTN","FBAAUTL2",22,0)
 Q
"RTN","FBAAUTL2",23,0)
END S (FBBEGDT,FBENDDT)="" K Z,FBAUT,FBOUT,FBLG Q
"RTN","FBAAUTL2",24,0)
CHKDT I FBBEGDT<Z&(FBENDDT<Z) S FBLG=0,FBOUT=1 Q
"RTN","FBAAUTL2",25,0)
 I FBBEGDT<Z&(FBENDDT'<Z) S FBLG=2,FBOUT=1 Q
"RTN","FBAAUTL2",26,0)
 I FBPROG=7,FBAUT(Z)>DT S FBLG=0,FBOUT=1,FBBEGDT="" K FBAUT W !!?5,"There already is an active CNH authorization on file.",!?5,"Use the 'Edit CNH Authorization' option.",! Q
"RTN","FBAAUTL2",27,0)
 I FBPROG=7,FBBEGDT=FBAUT(Z) Q
"RTN","FBAAUTL2",28,0)
CHKBO I FBBEGDT'<Z&(FBBEGDT'>FBAUT(Z)) S FBLG=1,FBOUT=1 Q
"RTN","FBAAUTL2",29,0)
 Q
"RTN","FBAAUTL2",30,0)
ERRD W !,*7,$S(FBLG=1:"FROM ",1:"TO "),"DATE entered overlaps a previous Authorization!",!
"RTN","FBAAUTL2",31,0)
 Q
"RTN","FBAAUTL2",32,0)
 ;
"RTN","FBAAUTL2",33,0)
UPDT ;UPDATE BATCH STATUS
"RTN","FBAAUTL2",34,0)
 S DA=J,(DIC,DIE)="^FBAA(161.7,",DR="11////^S X=FBSTAT;12////^S X=DT" D ^DIE Q
"RTN","FBAAUTL2",35,0)
 Q
"RTN","FBAAUTL2",36,0)
 ;
"RTN","FBAAUTL2",37,0)
PAT S FBSSN=$P(Y(0),"^",9) S:$L(FBSSN)=9 FBSSN=FBSSN_" " S FBSEX=$P(Y(0),"^",2),FBSEX=$S(FBSEX="F":FBSEX,1:"M")
"RTN","FBAAUTL2",38,0)
 S FBDOB=$P(Y(0),"^",3),FBDOB=$S(FBDOB="":"        ",1:$E(FBDOB,4,7)_($E(FBDOB,1,3)+1700))
"RTN","FBAAUTL2",39,0)
 S FBNAME=$P(Y(0),"^",1),FBLNAM=$E($P(FBNAME,",",1),1,5),FBFLNAM=$E($P(FBNAME,",",1),1,21),FBFLNAM=FBFLNAM_$E(PAD,$L(FBFLNAM)+1,21)
"RTN","FBAAUTL2",40,0)
 S:$L(FBLNAM)<5 FBLNAM=FBLNAM_$E("     ",$L(FBLNAM)+1,5)
"RTN","FBAAUTL2",41,0)
 S FBFI=$E($P(FBNAME,",",2),1),FBMI=$P(FBNAME,",",2),A=$F(FBMI," "),FBMI=$S(A<1:" ",1:$E(FBMI,A)),FBMI=$S(FBMI="":" ",1:FBMI)
"RTN","FBAAUTL2",42,0)
 Q
"RTN","FBAAUTL2",43,0)
 ;
"RTN","FBAAUTL2",44,0)
ASKVOK S DIR(0)="Y",DIR("A")="Is this the correct vendor",DIR("B")="YES" D ^DIR K DIR G:$D(DIRUT) VENOUT S:'Y FBVENO=1
"RTN","FBAAUTL2",45,0)
 Q
"RTN","FBAAUTL2",46,0)
VENOUT S FBVENOT=1 K DIRUT Q
"RTN","FBAAUTL2",47,0)
 ;
"RTN","FBAAUTL2",48,0)
FBPH W ! S DIR("A")="Want to review fee pharmacy payment history",DIR("B")="No",DIR(0)="Y" D ^DIR K DIR
"RTN","FBAAUTL2",49,0)
 I Y,$D(DFN),$D(^DPT(+DFN,0)) S N=$P(^(0),"^"),FBHDFN=DFN N FBAAOUT D LIST^FBAAPPH S DFN=FBHDFN K FBHDFN
"RTN","FBAAUTL2",50,0)
 Q
"RTN","FBAAUTL2",51,0)
PRPRDT D NOW^%DTC S Y=% X ^DD("DD") W ?60,Y
"RTN","FBAAUTL2",52,0)
 Q
"RTN","FBAAUTL2",53,0)
IFCAP S PRCF("X")="S" D ^PRCFSITE S PRC("SITE")=$S($D(PRC("SITE")):PRC("SITE"),1:"") I PRC("SITE")="" S FBERR(1)=1 Q
"RTN","FBAAUTL2",54,0)
 S FB("SITE")=PRC("SITE")
"RTN","FBAAUTL2",55,0)
 Q
"RTN","FBAAUTL2",56,0)
POV ;GET POV/TREATMENT TYPE FROM 161 FOR TRANSMISSION OF PAYMENTS
"RTN","FBAAUTL2",57,0)
 ; in K, L, M, N - IENs for File 162 service provided multiple
"RTN","FBAAUTL2",58,0)
 ; out POV - purpose of visit (internal pointer) or null
"RTN","FBAAUTL2",59,0)
 ; out FBTT - treatment type (internal code) or null
"RTN","FBAAUTL2",60,0)
 S (FBTT,POV)=""
"RTN","FBAAUTL2",61,0)
 N FTP
"RTN","FBAAUTL2",62,0)
 S FTP=$P($G(^FBAAC(K,1,L,1,M,1,N,3)),U,9)
"RTN","FBAAUTL2",63,0)
 I FTP D
"RTN","FBAAUTL2",64,0)
 . N FBY
"RTN","FBAAUTL2",65,0)
 . S FBY=$G(^FBAAA(K,1,FTP,0))
"RTN","FBAAUTL2",66,0)
 . S POV=$P(FBY,"^",7)
"RTN","FBAAUTL2",67,0)
 . S FBTT=$P(FBY,"^",13)
"RTN","FBAAUTL2",68,0)
 Q
"RTN","FBAAUTL2",69,0)
XREF ;SET X-REF FOR PRINT AUTHORIZATION FIELD (161.01,1)
"RTN","FBAAUTL2",70,0)
 Q:'$D(^FBAAA(DA(1),1,DA,0))  N FBZZ S FBZZ(0)=^(0),FBZZ(1)=$P(FBZZ(0),"^",3)
"RTN","FBAAUTL2",71,0)
 S FBZZ(2)=$S(FBZZ(1)=2:"",FBZZ(1)=3:"",FBZZ(1)=11:"",1:1) I FBZZ(2) S ZZZ="" Q
"RTN","FBAAUTL2",72,0)
 S ZZZ=$P(FBZZ(0),"^",13),ZZZ=$S(ZZZ=1:$P(FBZZ(0),"^"),ZZZ=2:$P(FBZZ(0),"^"),ZZZ=3:$S($D(^FBAAA(DA(1),4)):$P(^(4),"^",2),1:""),1:"")
"RTN","FBAAUTL2",73,0)
 Q
"RTN","FBAAUTL2",74,0)
ADD S ZZZ="" D XREF Q:ZZZ=""  S ^FBAAA("AF",$P(^FBAAA(DA(1),1,DA,0),"^",3),ZZZ,DA(1),DA)=""
"RTN","FBAAUTL2",75,0)
 Q
"RTN","FBAAUTL2",76,0)
KILL S ZZZ="" D XREF Q:ZZZ=""  K ^FBAAA("AF",$P(^FBAAA(DA(1),1,DA,0),"^",3),ZZZ,DA(1),DA)
"RTN","FBAAUTL2",77,0)
 Q
"RTN","FBAAUTL2",78,0)
 ;
"RTN","FBAAUTL2",79,0)
VER(X) ;determine version of a file based on DD node
"RTN","FBAAUTL2",80,0)
 ;X= file number
"RTN","FBAAUTL2",81,0)
 Q $S('X:0,1:+$P($G(^DD(X,0,"VR")),U))
"RTN","FBAAVD2")
0^24^B34694491^B33240026
"RTN","FBAAVD2",1,0)
FBAAVD2 ;AISC/DMK - EDIT VENDOR DEMOGRAPHICS ;7/10/14  17:07
"RTN","FBAAVD2",2,0)
 ;;3.5;FEE BASIS;**9,10,47,65,98,111,122,154**;JAN 30, 1995;Build 12
"RTN","FBAAVD2",3,0)
 ;;Per VA Directive 6402, this routine should not be modified.
"RTN","FBAAVD2",4,0)
EDITV ;entry to edit vendor demographic data
"RTN","FBAAVD2",5,0)
 ;DA defined to IEN of vendor file (161.2)
"RTN","FBAAVD2",6,0)
 Q:'$G(DA)  N FBADT,FBDA,Z6 S FBDA=DA  L +^FBAAV(DA):$G(DILOCKTM,3) I '$T W !,"Another user is editing this vendor record. Try again later.",! Q
"RTN","FBAAVD2",7,0)
 S FBT=$S($D(FBT):FBT,1:""),FBT=$S(FBT="N":FBT,1:"C")
"RTN","FBAAVD2",8,0)
 S FEEO="",DIE="^FBAAV(",DR="[FBAA EDIT VENDOR]",DIE("NO^")="BACKOUTOK"
"RTN","FBAAVD2",9,0)
 S Z1=$G(^FBAAV(DA,0)),Z3=$G(^(1)),Z4=$G(^("AMS")),Z5=$G(^("ADEL")),Z6=$P($G(^(3)),U,2)
"RTN","FBAAVD2",10,0)
 D GETGRP^FBAAUTL6(DA)
"RTN","FBAAVD2",11,0)
 D ^DIE
"RTN","FBAAVD2",12,0)
 I $P($G(^FBAAV(DA,0)),"^",13)']"" S DR="3;4;5;5.5",DIE("NO^")="" D ^DIE
"RTN","FBAAVD2",13,0)
 K DIE
"RTN","FBAAVD2",14,0)
 L -^FBAAV(DA)
"RTN","FBAAVD2",15,0)
 ;check if data was changed
"RTN","FBAAVD2",16,0)
 I $D(^FBAAV(DA,0)),(($P(Z1,U,2,6)'=$P(^FBAAV(DA,0),U,2,6))!($P(Z1,U,8,16)'=$P(^FBAAV(DA,0),U,8,16))!($P(Z3,U,10)'=$P($G(^FBAAV(DA,1)),U,10))!$$GRPDIF^FBAAUTL6(DA)!($P($G(^FBAAV(DA,3)),U,2)'=Z6)) D
"RTN","FBAAVD2",17,0)
 .S FBVNAME=$P(^FBAAV(DA,0),U),FBIEN1=DA,FBADT=$P(Z5,U,4),FBNPI=$P($G(^FBAAV(FBIEN1,3)),U,2),FBTXC=$P($G(^(3)),U,3)
"RTN","FBAAVD2",18,0)
 .;check if date last received from austin, version 3.  If so, then did not receive in upload - send update instead of change
"RTN","FBAAVD2",19,0)
 .;fbadt = date received from austin.
"RTN","FBAAVD2",20,0)
 .I '$$CKVEN^FBAADV(DA),FBADT']"" D UPDT^FBAAAV(FBDA) Q  ;,FBADT<FBINSTAL D UPDT^FBAAAV(DA) Q
"RTN","FBAAVD2",21,0)
 .;if austin deleted is yes, send update instead of change
"RTN","FBAAVD2",22,0)
 .I $P($G(^FBAAV(FBDA,"ADEL")),"^")="Y" D UPDT^FBAAAV(FBDA) Q
"RTN","FBAAVD2",23,0)
 .;if editing a newly added vendor, send update instead of change
"RTN","FBAAVD2",24,0)
 .I FBT="N" D UPDT^FBAAAV(FBDA) Q
"RTN","FBAAVD2",25,0)
 .;if only FPDS data was changed
"RTN","FBAAVD2",26,0)
 .I $P(Z1,U,2,6)=$P(^FBAAV(DA,0),U,2,6),$P(Z1,U,8,16)=$P(^FBAAV(DA,0),U,8,16) D  Q:FBT=""
"RTN","FBAAVD2",27,0)
 ..I '$D(^FBAA(161.25,"AF",DA)),'$D(^FBAA(161.25,DA,0)) S FBT="F" Q  ; no pending actions - add "F"
"RTN","FBAAVD2",28,0)
 ..I '$D(^FBAA(161.25,"AF",DA)),$D(^FBAA(161.25,DA,0)),$P(^(0),U,5)="" S FBT="" Q  ; action pending, but not yet transmitted - will incl. FPDS data
"RTN","FBAAVD2",29,0)
 .I FBT="F" S FBIEN1=DA,FEEO="" D SETGL^FBAAVD Q  ; send FEE-ONLY
"RTN","FBAAVD2",30,0)
 .;If date from austin not null then add vendor entry for a change
"RTN","FBAAVD2",31,0)
 .K DD,DO S DIC="^FBAAV(",DIC(0)="L",DLAYGO=161.2,X=FBVNAME D FILE^DICN Q:Y<0  S FBIEN=+Y
"RTN","FBAAVD2",32,0)
 .F  L +^FBAAV(FBIEN):$G(DILOCKTM,3) Q:$T  W !,"Another user is editing this vendor record.  Trying again.  ",!
"RTN","FBAAVD2",33,0)
 .S ^FBAAV(FBIEN,0)=$G(^FBAAV(FBIEN1,0))
"RTN","FBAAVD2",34,0)
 .S ^FBAAV(FBIEN,1)=$G(^FBAAV(FBIEN1,1))
"RTN","FBAAVD2",35,0)
 .S ^FBAAV(FBIEN,"AMS")=$G(^FBAAV(FBIEN1,"AMS")),$P(^FBAAV(FBIEN,"AMS"),"^")=""
"RTN","FBAAVD2",36,0)
 .K FBFDA
"RTN","FBAAVD2",37,0)
 .S I=0 F  S I=$O(^FBAAV(FBIEN1,2,I)) Q:'I  D
"RTN","FBAAVD2",38,0)
 ..S X=$P($G(^(I,0)),U) I X]"" S FBFDA(161.225,"+"_I_","_FBIEN_",",.01)=X
"RTN","FBAAVD2",39,0)
 .I $D(FBFDA) D UPDATE^DIE("","FBFDA")
"RTN","FBAAVD2",40,0)
 .S DIK="^FBAAV(",DA=FBIEN D IX1^DIK
"RTN","FBAAVD2",41,0)
 .L -^FBAAV(FBIEN)
"RTN","FBAAVD2",42,0)
 .;restore original vendor data
"RTN","FBAAVD2",43,0)
 .F  L +^FBAAV(FBIEN1):$G(DILOCKTM,3) Q:$T  W !,"Another user is editing this vendor record.  Trying again.  ",!
"RTN","FBAAVD2",44,0)
 .S DIE="^FBAAV(",DA=FBIEN1,DR="[FB VENDOR UPDATE]" D ^DIE K DIE
"RTN","FBAAVD2",45,0)
 .D UPDGRP^FBAAUTL6(FBIEN1)
"RTN","FBAAVD2",46,0)
 .L -^FBAAV(FBIEN1)
"RTN","FBAAVD2",47,0)
 .S DA=FBIEN D SETGL^FBAAVD
"RTN","FBAAVD2",48,0)
 K FBSG,FBVNAME,FBIEN,FBIEN1,Z3,Z4,Z5
"RTN","FBAAVD2",49,0)
 ;
"RTN","FBAAVD2",50,0)
CONTR ;enter contract information for a CNH vendor
"RTN","FBAAVD2",51,0)
 Q:$S('$D(FBPARCD):1,FBPARCD'=5:1,1:0)
"RTN","FBAAVD2",52,0)
 I '$D(^XUSEC("FBAA LEVEL 2",DUZ)) W !!?3,$C(7)_"You must be a holder of the FBAA LEVEL 2 security key to edit",!?3,"contracts and rates." Q
"RTN","FBAAVD2",53,0)
 Q:'$G(DA)  S FBVIEN=DA
"RTN","FBAAVD2",54,0)
 S FBLIEN=$P($G(^FBAA(161.25,FBVIEN,0)),"^",6) I FBLIEN]"",FBLIEN'=FBVIEN W !!,*7,"Cannot add contract information to this vendor until change has been",!,"approved by Austin." Q
"RTN","FBAAVD2",55,0)
 W ! S DIC="^FBAA(161.21,",DIC(0)="AEQLM",DLAYGO=161.21,DIC("S")="I $P(^(0),U,4)="_FBVIEN
"RTN","FBAAVD2",56,0)
 D ^DIC K DIC,DLAYGO Q:X=""!(X="^")  G CONTR:Y<0
"RTN","FBAAVD2",57,0)
 S DA=+Y,FBCNUM=$P(Y,"^",2),DIE="^FBAA(161.21,"
"RTN","FBAAVD2",58,0)
 F  L +^FBAA(161.21,DA):$G(DILOCKTM,3) Q:$T  W !,"This contract is being edited by another user, trying again.",!
"RTN","FBAAVD2",59,0)
 S ZO1=^FBAA(161.21,DA,0),DR="[FBNH ENTER CONTRACT]",DIE("NO^")="" D ^DIE K DIE,DR
"RTN","FBAAVD2",60,0)
 I '$G(DA) K ZO1 Q
"RTN","FBAAVD2",61,0)
 I $D(^FBAA(161.22,"AC",DA)) D
"RTN","FBAAVD2",62,0)
 .Q:$P(ZO1,"^",1,2)=$P(^FBAA(161.21,DA,0),"^",1,2)  W !!,*7,"You cannot change contract numbers or effective dates on",!,"a contract that has rates associated with it."
"RTN","FBAAVD2",63,0)
 .S DIE="^FBAA(161.21,",DR=".01////^S X=$P(ZO1,U);.02////^S X=$P(ZO1,U,2);.03////^S X=$P(ZO1,U,3);.04////^S X=$P(ZO1,U,4)" D ^DIE K DIE,DR W !!,"Contract information reset"
"RTN","FBAAVD2",64,0)
 L -^FBAA(161.21,DA) K ZO1
"RTN","FBAAVD2",65,0)
 Q:$D(DTOUT)
"RTN","FBAAVD2",66,0)
 I $G(FBEXNDT)<$G(FBEXDT) D URATE K FBCIEN,FBEXDT,FBEXNDT,FBURT
"RTN","FBAAVD2",67,0)
 ;create rates for a contract. Rates cannot be changed, but the
"RTN","FBAAVD2",68,0)
 ;user can enter multiple rates for a contract.
"RTN","FBAAVD2",69,0)
 ;FBCIEN=internal entry number for contract in 161.21
"RTN","FBAAVD2",70,0)
 S FBCIEN=DA K FBX
"RTN","FBAAVD2",71,0)
RATE K DA W ! S DIR(0)="161.22,.02",DIR("A")="Enter Nursing Home Rate",DIR("?")="^K FBX,FBRATE D DISPLAY^FBAAVD1 W !,""Enter an amount between .01 and 9999999.99""" D ^DIR
"RTN","FBAAVD2",72,0)
 K DIR Q:$D(DIRUT)  Q:'Y  S FBR=+Y
"RTN","FBAAVD2",73,0)
 ;I $L($$RATE^FBAAVD1($P(^FBAA(161.21,FBCIEN,0),"^",1)))+$L("^"_FBR)>510 W !,*7,"There are too many rates loaded for that contract! Please remove obsolete rates.",! Q
"RTN","FBAAVD2",74,0)
 I $D(^FBAA(161.22,"AD",FBCIEN,FBR)) K FBR W !,*7,"Rate already exists for that contract!",! G RATE
"RTN","FBAAVD2",75,0)
 S X=$P(^FBAA(161.22,0),U,3)
"RTN","FBAAVD2",76,0)
RETRY S X=X+1 G:$D(^FBAA(161.22,X)) RETRY
"RTN","FBAAVD2",77,0)
 F  L +^FBAA(161.22,X):$G(DILOCKTM,3) Q:$T  W !,"Another user is editing this rate record.  Trying again.  ",!
"RTN","FBAAVD2",78,0)
 K DD,DO S DIC="^FBAA(161.22,",DIC(0)="L",DLAYGO=161.22,DIC("DR")=".02////^S X="_FBR_";.03////^S X="_FBCIEN D FILE^DICN K DIC,DLAYGO
"RTN","FBAAVD2",79,0)
 L -^FBAA(161.22,+Y)
"RTN","FBAAVD2",80,0)
 G RATE
"RTN","FBAAVD2",81,0)
 ;
"RTN","FBAAVD2",82,0)
GETVEN K FBRATE D GETVEN^FBAAUTL1 G END:'IFN
"RTN","FBAAVD2",83,0)
 S DA=IFN K DIC,IFN
"RTN","FBAAVD2",84,0)
 S FBPARCD=$P($G(^FBAAV(DA,0)),U,9)
"RTN","FBAAVD2",85,0)
 I FBPARCD'=5 W !?5,*7,"Vendor selected is not a Community Nursing Home.",! G GETVEN
"RTN","FBAAVD2",86,0)
 D CONTR G GETVEN
"RTN","FBAAVD2",87,0)
END K DIC,DA,FBVIEN,IFN,FBPARCD,X,Y,FBLIEN
"RTN","FBAAVD2",88,0)
 Q
"RTN","FBAAVD2",89,0)
URATE ;Update rate when user backs up contract dates.
"RTN","FBAAVD2",90,0)
 N DA S (FBCIEN,FBURT)=0
"RTN","FBAAVD2",91,0)
 F  S FBURT=$O(^FBAA(161.23,"AE",FBCNUM,FBURT)) Q:'FBURT  F  S FBCIEN=$O(^FBAA(161.23,"AE",FBCNUM,FBURT,FBCIEN)) Q:'FBCIEN  I $P($G(^FBAA(161.23,FBCIEN,0)),"^",2)>FBEXNDT D
"RTN","FBAAVD2",92,0)
 .I +$G(^FBAA(161.23,FBCIEN,0))>FBEXNDT S DIK="^FBAA(161.23,",DA=FBCIEN D ^DIK K DIK Q
"RTN","FBAAVD2",93,0)
 .S DIE="^FBAA(161.23,",DA=FBCIEN,DR=".02////^S X=FBEXNDT" D ^DIE K DIE
"RTN","FBAAVD2",94,0)
 Q
"RTN","FBAAVP")
0^5^B25842895^B26602032
"RTN","FBAAVP",1,0)
FBAAVP ;AISC/DMK - VOID & CANCEL VOIDED MEDICAL PAYMENT ;5/15/14  17:36
"RTN","FBAAVP",2,0)
 ;;3.5;FEE BASIS;**4,69,154**;JAN 30, 1995;Build 12
"RTN","FBAAVP",3,0)
 ;;Per VA Directive 6402, this routine should not be modified.
"RTN","FBAAVP",4,0)
 ;Variable 'FBVOID' is set if cancelling a voided payment.
"RTN","FBAAVP",5,0)
 D DT^DICRW
"RTN","FBAAVP",6,0)
RDP K ^TMP($J) W !! S DIC="^FBAAC(",DIC(0)="AEQM",DIC("A")="Select Patient: " D ^DIC K DIC("A") G Q:X="^"!(X=""),RDP:Y<0 S DFN=+Y
"RTN","FBAAVP",7,0)
 S:'$D(^FBAAC(DFN,1,0)) ^FBAAC(DFN,1,0)="^162.01P^0^0"
"RTN","FBAAVP",8,0)
RDV W !! S DIC="^FBAAV(",DIC(0)="AEQM",DA(1)=DFN D ^DIC G RDP:X="^"!(X=""),RDV:Y<0 S DA=+Y G:'$D(^FBAAC(DFN,DA,"AD")) NOCL^FBAAVP0 D EN1
"RTN","FBAAVP",9,0)
 I CNT'>0 G NVOID^FBAAVP0
"RTN","FBAAVP",10,0)
 D CPAY G Q
"RTN","FBAAVP",11,0)
EN1 S Q="",$P(Q,"-",80)="-",CNT=0
"RTN","FBAAVP",12,0)
 S IOP=$S($D(ION):ION,1:"HOME") D ^%ZIS K IOP D HED
"RTN","FBAAVP",13,0)
 F D=0:0 S D=$O(^FBAAC(DFN,DA,"AD",D)) Q:D'>0  F B=0:0 S B=$O(^FBAAC(DFN,DA,"AD",D,B)) Q:B'>0  F K=0:0 S K=$O(^FBAAC(DFN,1,DA,1,B,1,K)) Q:K'>0  S L=^(K,0) Q:$D(^FBAAC(DFN,1,DA,1,B,1,K,"FBREJ"))  D EN2
"RTN","FBAAVP",14,0)
 Q
"RTN","FBAAVP",15,0)
EN2 S FBAAPD=$P(L,"^",14),ZS=$P(L,"^",20),FD=$P(L,"^",6),FBON=$P(L,"^",10),V=$P(L,"^",21) I FD]""&$S($D(FBVOID):(V="VP"),1:(V="")) D WRT
"RTN","FBAAVP",16,0)
 Q
"RTN","FBAAVP",17,0)
WRT N FBFPPSC S FBFPPSC=$P($G(^FBAAC(DFN,1,DA,1,B,1,K,3)),U,1)
"RTN","FBAAVP",18,0)
 S FBDT=$P(^FBAAC(DFN,1,DA,1,B,0),"^"),FBAADT=$E(FBDT,4,5)_"/"_$E(FBDT,6,7)_"/"_$E(FBDT,2,3),B1=$P(L,"^",8),B2=$S(B1="":"",$D(^FBAA(161.7,B1,0)):$P(^FBAA(161.7,B1,0),"^"),1:""),CNT=CNT+1,FBVD=DA,FBSD=B,FBSV=K
"RTN","FBAAVP",19,0)
 D FBCKO^FBAACCB2(DFN,FBVD,FBSD,FBSV)
"RTN","FBAAVP",20,0)
 S FBAAPD=$S(FBAAPD]"":$E(FBAAPD,4,5)_"/"_$E(FBAAPD,6,7)_"/"_$E(FBAAPD,2,3),1:"")
"RTN","FBAAVP",21,0)
 S A1=$P(L,"^",2)+.0001,A2=$P(L,"^",3)+.0001,A1=$P(A1,".")_"."_$E($P(A1,".",2),1,2),A2=$P(A2,".")_"."_$E($P(A2,".",2),1,2),FBIN=$P(L,"^",16)
"RTN","FBAAVP",22,0)
 S FBAACPT=$$CPT^FBAAUTL4($P(L,"^"))
"RTN","FBAAVP",23,0)
 S FBMODLE=$$MODL^FBAAUTL4("^FBAAC("_DFN_",1,"_DA_",1,"_B_",1,"_K_",""M"")","E")
"RTN","FBAAVP",24,0)
 W !,CNT_") ",$S(ZS="R":"*",1:""),$S(V="VP":"#",1:""),?3,FBAADT,?14,FBAACPT_$S($G(FBMODLE)]"":"-"_$P(FBMODLE,","),1:""),?23,"$",$J(A1,8),?34,"$",$J(A2,8),?49,FBIN,?60,B2,?68,FBAAPD
"RTN","FBAAVP",25,0)
 I $P($G(FBMODLE),",",2)]"" D  ;Q:FBAAOUT
"RTN","FBAAVP",26,0)
 . N FBI
"RTN","FBAAVP",27,0)
 . F FBI=2:1 S FBMOD=$P(FBMODLE,",",FBI) Q:FBMOD=""  D  ;Q:FBAAOUT
"RTN","FBAAVP",28,0)
 . . ;I $Y+4>IOSL D  Q:FBAAOUT
"RTN","FBAAVP",29,0)
 . . ;. I $E(IOST,1,2)="C-" S DIR(0)="E" D ^DIR K DIR I 'Y S FBAAOUT=1 Q
"RTN","FBAAVP",30,0)
 . . ;. D HED W !,CNT,") (continued)"
"RTN","FBAAVP",31,0)
 . . W !,?19,"-",FBMOD
"RTN","FBAAVP",32,0)
 I FBFPPSC]"" W !,?4,"FPPS Claim ID: ",FBFPPSC
"RTN","FBAAVP",33,0)
 D PMNT^FBAACCB2
"RTN","FBAAVP",34,0)
 I $D(^FBAAC(DFN,1,DA,1,B,1,K,"R")),^("R")]"" W !?3,"Reason:",!?10,^("R"),!
"RTN","FBAAVP",35,0)
 S ^TMP($J,CNT)=FBAADT_"^"_FBAACPT_$S($G(FBMODLE)]"":"-"_FBMODLE,1:"")_"^"_$J(A1,8)_"^"_$J(A2,8)_"^"_FBFPPSC_"^"_FBIN_"^"_B2_"^"_FBAAPD_"^"_FBSD_"^"_FBSV_"^"_FD_"^"_A2_"^"_FBON Q
"RTN","FBAAVP",36,0)
 Q
"RTN","FBAAVP",37,0)
HED W @IOF,"Patient Name: ",$P(^DPT(DFN,0),"^"),?50,"Pt.ID ",$$SSN^FBAAUTL(DFN),!!,?2,"VENDOR: ",$P(^FBAAV(DA,0),"^"),!,?10,"('*' Reimb. to Patient   '#' Voided Payment)"
"RTN","FBAAVP",38,0)
 W !," SVC DATE",?11,"CPT-MOD",?20,"AMT CLAIMED",?35,"AMT PAID",?47,"INVOICE #",?57,"BATCH #",?66,"DATE PAID",!,Q,!
"RTN","FBAAVP",39,0)
 Q
"RTN","FBAAVP",40,0)
Q K DIC,DIE,DA,DF,DA(1),^TMP($J),A,A1,A2,B,B1,B2,C,CNT,D,D0,D1,D2,D3,DI,DR,DFN,DIYS,FBAACB,FBAACPT,FBAADT,FBAAPD,FBX,DIR,FBDT,FBIN,FBON,FBSD,FBSV,FD,FBVD,FBVOID,I,K,L,ON,POP,P3,P4,Q,V,X,Y,VP,VAL,ZS,Z,ZZ,FBSSN,DIRUT,FBMOD,FBMODLE
"RTN","FBAAVP",41,0)
 Q
"RTN","FBAAVP",42,0)
CPAY W !!,"Which payment item(s) would you like to ",$S($D(FBVOID):"Cancel the void on",1:"Void")," ? " S DIR(0)="L^1:"_CNT D ^DIR
"RTN","FBAAVP",43,0)
 G RDV:$D(DIRUT) S FBX=Y D HED
"RTN","FBAAVP",44,0)
 F A=1:1:CNT S X=$P(FBX,",",A) Q:X=""  S Y(0)=^TMP($J,X),FBSD=$P(Y(0),"^",9),FBSV=$P(Y(0),"^",10),FD=$P(Y(0),"^",11),A2=$P(Y(0),"^",12),FBON=$P(Y(0),"^",13),^TMP($J,"VOID",X)=DFN_"^"_FBVD_"^"_FBSD_"^"_FBSV_"^"_FD_"^"_A2_"^"_FBON D PRT2
"RTN","FBAAVP",45,0)
VERF S DIR(0)="Y",DIR("A")="Are you sure you want to "_$S($D(FBVOID):"Cancel the void on ",1:"Void ")_"the payment(s)",DIR("B")="NO" D ^DIR K DIR G RDP:$D(DIRUT)!'Y
"RTN","FBAAVP",46,0)
 F I=0:0 S I=$O(^TMP($J,"VOID",I)) Q:I'>0  S Y(0)=^(I),DFN=$P(Y(0),"^"),FBVD=$P(Y(0),"^",2),FBSD=$P(Y(0),"^",3),FBSV=$P(Y(0),"^",4),A2=$P(Y(0),"^",6),FBON=$P(Y(0),"^",7) D SETN,^FBAAVP0 W !,?5,".... Done.",!
"RTN","FBAAVP",47,0)
 K FBVR Q
"RTN","FBAAVP",48,0)
SETN S DA=FBSV,VP=$S($D(FBVOID):"",1:"VOID")
"RTN","FBAAVP",49,0)
 I $D(FBVOID) S DR="24///@;24.5///@;25///@"
"RTN","FBAAVP",50,0)
 I '$D(FBVOID) S DR="24///^S X=VP;25////^S X=DUZ"_$S($D(FBVR):";24.5////^S X=FBVR",1:";24.5R;S FBVR=X")
"RTN","FBAAVP",51,0)
 S DIE="^FBAAC("_DFN_",1,"_FBVD_",1,"_FBSD_",1,",DIDEL=162 D ^DIE K DIDEL Q
"RTN","FBAAVP",52,0)
PRT2 D FBCKO^FBAACCB2(DFN,FBVD,FBSD,FBSV)
"RTN","FBAAVP",53,0)
 W !,$P(Y(0),"^",1),?14,$P($P(Y(0),"^",2),","),?23,$P(Y(0),"^",3),?34,$P(Y(0),"^",4),?49,$P(Y(0),"^",6),?62,$P(Y(0),"^",7),?68,$P(Y(0),"^",8)
"RTN","FBAAVP",54,0)
 I $P($P(Y(0),U,2),",",2)]"" D  ;Q:FBAAOUT
"RTN","FBAAVP",55,0)
 . N FBI
"RTN","FBAAVP",56,0)
 . F FBI=2:1 S FBMOD=$P($P(Y(0),U,2),",",FBI) Q:FBMOD=""  D  ;Q:FBAAOUT
"RTN","FBAAVP",57,0)
 . . ;I $Y+4>IOSL D  Q:FBAAOUT
"RTN","FBAAVP",58,0)
 . . ;. I $E(IOST,1,2)="C-" S DIR(0)="E" D ^DIR K DIR I 'Y S FBAAOUT=1 Q
"RTN","FBAAVP",59,0)
 . . ;. D HED W !,CNT,") (continued)"
"RTN","FBAAVP",60,0)
 . . W !,?19,"-",FBMOD
"RTN","FBAAVP",61,0)
 I $P(Y(0),U,5)]"" W !,?4,"FPPS Claim ID: ",$P(Y(0),U,5)
"RTN","FBAAVP",62,0)
 W !
"RTN","FBAAVP",63,0)
 D PMNT^FBAACCB2
"RTN","FBAAVP",64,0)
 Q
"RTN","FBCH78")
0^41^B53484323^B51567098
"RTN","FBCH78",1,0)
FBCH78 ;AISC/DMK - SETS UP 7078/AUTHORIZATION FOR CONTRACT HOSPITAL ;9/18/2014
"RTN","FBCH78",2,0)
 ;;3.5;FEE BASIS;**43,103,108,146,139,154**;JAN 30, 1995;Build 12
"RTN","FBCH78",3,0)
 ;;Per VA Directive 6402, this routine should not be modified.
"RTN","FBCH78",4,0)
 S DIC("S")="I $P(^(0),U,15)=3&($P(^(0),U,12)=""Y"")" D ASKV^FBCHREQ G END:$E(X)="^"!($E(X)="")!('$D(FBDA))
"RTN","FBCH78",5,0)
 I $P(^FBAA(162.2,FBDA,0),"^",17)]"" W !!,*7,"There already is a 7078 set up for this request.",!,"The number is ",$P(^FB7078($P(^FBAA(162.2,FBDA,0),"^",17),0),"^")," .",! G END
"RTN","FBCH78",6,0)
EN ;DEM;139 ICD=10 Project - Replaced original line with next two to add condition FBFRDT<$$IMPDATE^FBCSV1("10D")
"RTN","FBCH78",7,0)
 S FBVEN=$P(^FBAA(162.2,FBDA,0),"^",2)_";FBAAV(",FBVET=$P(^(0),"^",4),FBFRDT=$P(^(0),"^",5),FBFRDT=FBFRDT\1,FBDOA=$S($P(^(0),"^",19):$P(^(0),"^",19)\1,1:"")
"RTN","FBCH78",8,0)
 S FBDXS="" S:FBFRDT<$$IMPDATE^FBCSV1("10D") FBDXS=$P(^FBAA(162.2,FBDA,0),"^",6)
"RTN","FBCH78",9,0)
 ;FB*3.5*103 ;added FBRP
"RTN","FBCH78",10,0)
 S FBRP=$P($G(^FBAA(162.2,FBDA,2)),"^") K DA
"RTN","FBCH78",11,0)
 D NBCHK
"RTN","FBCH78",12,0)
 I NEWB=1 W !! S %DT="APEX",%DT("A")="AUTHORIZATION TO DATE: ",%DT("B")=$$DATX^FBAAUTL(FBDOB7) S DOB7=%DT("B") D ^%DT K %DT G END:X="^" S FBTODT=$S(X="":"",1:Y) D DTCHK1 I DTFG=1 G EN
"RTN","FBCH78",13,0)
 I NEWB'=1 W !! S %DT="APEX",%DT("A")="AUTHORIZATION TO DATE: " D ^%DT K %DT G END:X="^" S FBTODT=$S(X="":"",1:Y)
"RTN","FBCH78",14,0)
 I FBTODT]"",FBFRDT>FBTODT W !!,*7,?5,"Authorization To Date must be after Authorization From Date!",! G EN
"RTN","FBCH78",15,0)
 W !! S %DT="APEX",%DT("A")="DATE OF DISCHARGE: ",%DT("B")=$$DATX^FBAAUTL(FBTODT) D ^%DT K %DT G END:X="^" S FBDOD=$S(X="":"",1:Y)
"RTN","FBCH78",16,0)
 I NEWB'=1 I FBDOD]"",FBTODT>FBDOD W !!,*7,?5,"Date of Discharge must not be earlier than the Authorization To Date!",! G EN
"RTN","FBCH78",17,0)
 I FBDOD]"",FBDOB>FBDOD W !!,*7,?5,"Date of Discharge must not be earlier than the Date of Birth!",! G EN
"RTN","FBCH78",18,0)
 S DIR(0)="162.4,5",DIR("A")="ADMITTING AUTHORITY" D ^DIR K DIR
"RTN","FBCH78",19,0)
 G END:$D(DIRUT) S FBADMIT=+Y
"RTN","FBCH78",20,0)
 S DIR(0)="162.4,6" D ^DIR K DIR
"RTN","FBCH78",21,0)
 G END:$D(DIRUT) S FBEST=+Y
"RTN","FBCH78",22,0)
FBPDIS I FBTODT="" S DIR(0)="162.4,12" D ^DIR K DIR G END:$D(DUOUT),END:$D(DTOUT),NULL^FBCH780:X="" S FBPDIS=+Y
"RTN","FBCH78",23,0)
 ;
"RTN","FBCH78",24,0)
ASKPT I FBTODT]"" S DIR(0)="SAO^00:SURGICAL;10:MEDICAL;86:PSYCHIATRY",DIR("A")="BEDSECTION/TREATING SPECIALTY: ",DIR("?")="^D HELP^FBCH780" D ^DIR K DIR D NOUP^FBCHCD:$D(DIRUT) G ASKPT:$D(DIRUT) S FBPT=Y
"RTN","FBCH78",25,0)
7078 S PRCS("A")="Select Obligation Number: ",PRCS("TYPE")="FB" D EN1^PRCS58 G:Y=-1 NOGOOD S (X,FBCHOB)=$P(Y,"^",2) K PRCS("A") S PRCS("TYPE")="FB" D EN1^PRCSUT31 G:Y="" NOGOOD S FB7078=$P(FBCHOB,"-",2)_"."_Y S FBSEQ=Y
"RTN","FBCH78",26,0)
 S DIC="^FB7078(",DIC(0)="LQ",DLAYGO=162.4,X=""""_FB7078_"""" D ^DIC G:Y<0 PROB S (DA,FBAA78)=+Y
"RTN","FBCH78",27,0)
 S DIE="^FBAA(162.2,",DA=FBDA,DR="16////^S X=FBAA78" D ^DIE K DIE,DIC,DA,DR
"RTN","FBCH78",28,0)
SET78 S DIE="^FB7078(",DA=FBAA78,DR="[FBCH ENTER 7078]" D ^DIE K DIC,DIE,DR,DA
"RTN","FBCH78",29,0)
 D ^FBCH780 I $G(FBOUT) W !!,*7,"...deleting 7078." D DEL G END
"RTN","FBCH78",30,0)
 I +Y=0 W !!,*7,Y,!,"...deleting 7078.  Use 'Set-up a 7078' after adjusting 1358.",! D DEL G END
"RTN","FBCH78",31,0)
 K DIE,DIC,DA
"RTN","FBCH78",32,0)
 D
"RTN","FBCH78",33,0)
 . N FBX
"RTN","FBCH78",34,0)
 . S FBX=$$ADDUA^FBUTL9(162.4,FBAA78_",","Set-up 7078 authorization.")
"RTN","FBCH78",35,0)
 . I 'FBX W !,"Error adding record in User Audit. Please contact IRM."
"RTN","FBCH78",36,0)
 I $G(FBVET) S:'$G(DFN) DFN=FBVET D PTF^FBCH780
"RTN","FBCH78",37,0)
 G SHOW:FBTODT=""
"RTN","FBCH78",38,0)
AUTH D HOME^%ZIS
"RTN","FBCH78",39,0)
 D:'$D(FBSITE(1)) SITEP^FBAAUTL Q:FBPOP  S FBPSA=$S($P(FBSITE(1),"^",3)="":"",$D(^DIC(4,$P(FBSITE(1),"^",3),0)):$P(^(0),"^"),1:"")
"RTN","FBCH78",40,0)
 S FBVEN=$P(FBVEN,";")
"RTN","FBCH78",41,0)
 I '$D(^FBAAA(FBVET,0)) D  G:Y<0 END
"RTN","FBCH78",42,0)
 . N DINUM
"RTN","FBCH78",43,0)
 . S Y=-1
"RTN","FBCH78",44,0)
 . L +^FBAAA(FBVET):$S($D(DILOCKTM):DILOCKTM,1:5) I $T D
"RTN","FBCH78",45,0)
 . . K DD,DO S (X,DINUM)=FBVET,DIC="^FBAAA(",DIC(0)="LM",DLAYGO=161
"RTN","FBCH78",46,0)
 . . D FILE^DICN
"RTN","FBCH78",47,0)
 . . L -^FBAAA(FBVET)
"RTN","FBCH78",48,0)
 . I Y<0 W !,"ERROR: Unable to create entry in FEE BASIS PATIENT file."
"RTN","FBCH78",49,0)
 K DE,DQ,DR,DIE,DLAYGO
"RTN","FBCH78",50,0)
 ;FB*3.5*108 ask Contract
"RTN","FBCH78",51,0)
 D  G:$D(DTOUT)!$D(DUOUT) END
"RTN","FBCH78",52,0)
 . S FBCNTRA=""
"RTN","FBCH78",53,0)
 . N DIR
"RTN","FBCH78",54,0)
 . S DIR(0)="PO^161.43:AQEM"
"RTN","FBCH78",55,0)
 . S DIR("A")="CONTRACT"
"RTN","FBCH78",56,0)
 . S DIR("?",1)="If the authorization is under a contract then select it."
"RTN","FBCH78",57,0)
 . S DIR("?")="Contract must be active and applicable for the authorized vendor."
"RTN","FBCH78",58,0)
 . S DIR("S")="I $P($G(^(0)),""^"",2)'=""I"",$$VCNTR^FBUTL7(FBVEN,+Y)"
"RTN","FBCH78",59,0)
 . D ^DIR Q:$D(DTOUT)!$D(DUOUT)
"RTN","FBCH78",60,0)
 . I Y>0 S FBCNTRA=+Y
"RTN","FBCH78",61,0)
FBDCHG S DIR(0)="161.01,.06" D ^DIR K DIR G END:$D(DTOUT),END:$D(DUOUT) D NULL1^FBCH780:X="" G FBDCHG:X="" S FBDCHG=+Y
"RTN","FBCH78",62,0)
FBPUR S FBTYPE=6,DIR(0)="161.01,.07" D ^DIR K DIR S FBPUR=+Y
"RTN","FBCH78",63,0)
 G END:$D(DTOUT),END:$D(DUOUT)
"RTN","FBCH78",64,0)
FBPSA S DIR(0)="161.01,101" D ^DIR K DIR G END:$D(DTOUT),END:$D(DUOUT) D NULL1^FBCH780:X="" G FBPSA:X="" S FBPSA=+Y
"RTN","FBCH78",65,0)
 ;file entry in authorization multiple of file 161
"RTN","FBCH78",66,0)
 S DIC="^FBAAA("_FBVET_",1,",DIC(0)="LM",DLAYGO=161,DA(1)=FBVET,X=FBFRDT K DD,DO D FILE^DICN G:Y<0 END S DA=+Y,DIE("NO^")="" ;DA(1)=FBVET
"RTN","FBCH78",67,0)
 S FB78=FBAA78_";FB7078("
"RTN","FBCH78",68,0)
 ;FB*3.5*103 ;added FBRP
"RTN","FBCH78",69,0)
 S DIE=DIC,DR=".02////^S X=FBTODT;.03////^S X=6;100////^S X=DUZ;1////^S X=""YES"";.055////^S X=FB78;.06////^S X=FBDCHG;S FBTYPE=6;.04////^S X=FBVEN;.065////^S X=FBPT;101////^S X=FBPSA"
"RTN","FBCH78",70,0)
 S:$G(FBRP)]"" DR=DR_";104////^S X=FBRP"
"RTN","FBCH78",71,0)
 S DR=DR_";.095////^S X=1"
"RTN","FBCH78",72,0)
 ; DEM/JAS;139 ICD-10 Project - Modified for ICD-10 to add FBFRDT'<$$IMPDATE^FBCSV1(""10D"") condition
"RTN","FBCH78",73,0)
 S DR(1,161.01,1)="I $D(^FB7078(FBAA78,1,0)) S ^FBAAA(DA(1),1,DA,2,0)=^(0) F FBI=1:1 Q:'$D(^FB7078(FBAA78,1,FBI,0))  I $D(^(0)) S ^FBAAA(DA(1),1,DA,2,FBI,0)=^(0);.07////^S X=FBPUR"
"RTN","FBCH78",74,0)
 S DR(1,161.01,2)="I FBFRDT'<$$IMPDATE^FBCSV1(""10D"") S Y=""@10"";@9;.08///^S X=$G(FBDXS);@10;.096;.097//^S X=""N"""
"RTN","FBCH78",75,0)
 I $G(FBCNTRA)]"" S DR(1,161.01,3)="105////^S X=FBCNTRA"
"RTN","FBCH78",76,0)
 ; End 139
"RTN","FBCH78",77,0)
 D ^DIE K DIE,DR
"RTN","FBCH78",78,0)
 S (DIC,DIE)="^FB7078(",DA=FBAA78,DR="9///^S X=""C"";12///^S X=""@""" D ^DIE K DR,DIE,DA,X
"RTN","FBCH78",79,0)
SHOW W !! S DA=FBAA78,DR="0;1",DIC="^FB7078(" D EN^DIQ
"RTN","FBCH78",80,0)
 S X=$$CN7078(FBAA78) I X]"" W ?2,"CONTRACT: ",$P(X,U,2)
"RTN","FBCH78",81,0)
 ;
"RTN","FBCH78",82,0)
 ;FB*3.5*103 ;added FBRP
"RTN","FBCH78",83,0)
END K D,DA,DIC,DIE,DIR,DLAYGO,DR,FBDA,FB7078,FBAA78,FBPT,FBTYPE,FBVEN,FBZ,FBVET,FBFRDT,FBTODT,J,S,POP,X,Y,DFN,FBCHOB,FBCOMM,FBDFN,FBEST,FBI,FBLENT,FBMENT,FBNAME,FBSEQ,FBSSN,FBSW,I,K,PRC,VAL,FB,FBFLG,ZZ,FBPSA,FBSITE,FB78,FBOUT
"RTN","FBCH78",84,0)
 K FBDCHG,FBPUR,FBPDIS,FBADMIT,FBDXS,A,D0,D1,X1,DIRUT,DTOUT,DUOUT,FBDOA,FBDOD,FBPOP,FBZZ,ZZZ,PRCSCPAN,FBRP,FBCNTRA,PRCS,FBDOB,FBDOB7
"RTN","FBCH78",85,0)
 Q
"RTN","FBCH78",86,0)
PROB W !!,"The reference number did not get set up with the",!,"IFCAP software. Contact your package coordinator." G END
"RTN","FBCH78",87,0)
NOGOOD S DIR(0)="Y",DIR("A")="Obligation number selected is invalid or you are not a control point user in the IFCAP package!  Try again",DIR("B")="YES" D ^DIR K DIR G END:$D(DIRUT)!'Y,7078
"RTN","FBCH78",88,0)
 ;
"RTN","FBCH78",89,0)
OUTP ;ENTRY TO DISPLAY A 7078
"RTN","FBCH78",90,0)
 ;FB*3.5*103 ; Display the 0 node fields with computed REFERRING PROVIDER NPI, then 1 node fields
"RTN","FBCH78",91,0)
 S DIC="^FB7078(",DIC(0)="AEQM",D="D",DIC("A")="Select Patient: " D IX^DIC
"RTN","FBCH78",92,0)
 G END:X=""!(X="^")
"RTN","FBCH78",93,0)
 S (DA,FBDA)=+Y,DR="0",DIQ(0)="C" W !! D EN^DIQ K DIQ(0)
"RTN","FBCH78",94,0)
 S DA=FBDA,DR="1" D EN^DIQ
"RTN","FBCH78",95,0)
 S X=$$CN7078(FBDA) I X]"" W ?2,"CONTRACT: ",$P(X,U,2),!
"RTN","FBCH78",96,0)
 I $$DISCH^FBCH780(FBDA)]"" W ?2,"DISCHARGE TYPE: ",$$DISCH^FBCH780(FBDA),!
"RTN","FBCH78",97,0)
 G OUTP
"RTN","FBCH78",98,0)
 ;
"RTN","FBCH78",99,0)
REFNPI(IEN200,IEN162P4,CHKAUTH) ;FB*3.5*103
"RTN","FBCH78",100,0)
 ; a new function that returns the REFERRING PROVIDER NPI if it is Active and the provider has authorized use of the NPI
"RTN","FBCH78",101,0)
 ; If is used in both a Fileman function and in other FB routines.
"RTN","FBCH78",102,0)
 ;
"RTN","FBCH78",103,0)
 ; Input
"RTN","FBCH78",104,0)
 ; IEN200 - IEN to file 200 if known
"RTN","FBCH78",105,0)
 ; IEN162P4 (optional) - IEN to File 162.4 (if ref prov is not known)
"RTN","FBCH78",106,0)
 ; CHKAUTH (optional) - Flag on whether to Chek Authorization in file 200
"RTN","FBCH78",107,0)
 ;
"RTN","FBCH78",108,0)
 ; Output
"RTN","FBCH78",109,0)
 ; A valid/active NPI if one can be determined.  Otherwise, nada.
"RTN","FBCH78",110,0)
 ;
"RTN","FBCH78",111,0)
 ; If neither IEN is passed in, there is no NPI coming out
"RTN","FBCH78",112,0)
 I $G(IEN200)<1,$G(IEN162P4)<1 Q ""
"RTN","FBCH78",113,0)
 ;
"RTN","FBCH78",114,0)
 ; If there is no referrring provider IEN passed in, try getting it from the IEN from 162.4 (VA FORM 10-7078)
"RTN","FBCH78",115,0)
 ; return nothing if you can't
"RTN","FBCH78",116,0)
 I $G(IEN200)<1 S IEN200=$$GET1^DIQ(162.4,IEN162P4_",",15,"I") Q:$G(IEN200)<1 ""
"RTN","FBCH78",117,0)
 ;
"RTN","FBCH78",118,0)
 ; Now that we have an IEN to 200 see if we need authorization and have to display/print NPI
"RTN","FBCH78",119,0)
 ; If the return value is less than 1, then we don't have permission or it was not a valid IEN.
"RTN","FBCH78",120,0)
 ; IA#5070
"RTN","FBCH78",121,0)
 I $G(CHKAUTH) Q:+$$GETRLNPI^XUSNPI(IEN200)<1 ""
"RTN","FBCH78",122,0)
 ;
"RTN","FBCH78",123,0)
 ; Go get the NPI for this IEN
"RTN","FBCH78",124,0)
 N NPI S NPI=$$NPI^XUSNPI("Individual_ID",IEN200)
"RTN","FBCH78",125,0)
 ;
"RTN","FBCH78",126,0)
 ; Make sure it is a valid/Active NPI
"RTN","FBCH78",127,0)
 I +NPI<1!($P(NPI,U,3)="Inactive") Q ""
"RTN","FBCH78",128,0)
 Q +NPI
"RTN","FBCH78",129,0)
 ;
"RTN","FBCH78",130,0)
NBCHK ;Newborn Enhancement check FB*3.5*146
"RTN","FBCH78",131,0)
 N DOB,NOW
"RTN","FBCH78",132,0)
 S NEWB=0,FBDOB7=0,FBDOB=0
"RTN","FBCH78",133,0)
 S DOB=$P(^DPT(FBDFN,0),"^",3)
"RTN","FBCH78",134,0)
 D NOW^%DTC S NOW=X
"RTN","FBCH78",135,0)
 I $$FMDIFF^XLFDT(NOW,DOB,1)>365 Q 
"RTN","FBCH78",136,0)
 S FBDOB=$$F2H^XLFDT(DOB),FBDOB=$$H2F^XLFDT(FBDOB)
"RTN","FBCH78",137,0)
 S NEWB=1,FBDOB7=$$F2H^XLFDT(DOB)+7,FBDOB7=$$H2F^XLFDT(FBDOB7) Q
"RTN","FBCH78",138,0)
 Q
"RTN","FBCH78",139,0)
 ; 
"RTN","FBCH78",140,0)
DTCHK1 ;
"RTN","FBCH78",141,0)
 S DTFG=0
"RTN","FBCH78",142,0)
 I FBTODT]"",FBTODT>FBDOB7 W !!,*7,?5,"Patient is a newborn. Authorization To Date must not be more than 7 days after the Date of Birth",! S DTFG=1 Q
"RTN","FBCH78",143,0)
 I FBTODT]"",FBTODT<FBDOB W !!,*7,?5,"Patient is a newborn. Authorization To Date must not be before the Date of Birth",! S DTFG=1 Q
"RTN","FBCH78",144,0)
 Q
"RTN","FBCH78",145,0)
DEL S DA=FBAA78,DIK="^FB7078(" D ^DIK K DIK S DA=$O(^FBAA(162.2,"AM",+FBAA78,0)) I DA S DIE="^FBAA(162.2,",DR="16///@" D ^DIE
"RTN","FBCH78",146,0)
 Q
"RTN","FBCH78",147,0)
CN7078(FBDA) ; VA FORM 10-7078 Contract
"RTN","FBCH78",148,0)
 ; input FBDA = ien of entry in file 162.4
"RTN","FBCH78",149,0)
 ; returns contract ien^contract number for the 7078 or null
"RTN","FBCH78",150,0)
 N DFN,FBAU,FBCNTRA,FBRET
"RTN","FBCH78",151,0)
 S FBRET=""
"RTN","FBCH78",152,0)
 I $G(FBDA) D
"RTN","FBCH78",153,0)
 . S DFN=$P($G(^FB7078(FBDA,0)),U,3)
"RTN","FBCH78",154,0)
 . Q:'DFN
"RTN","FBCH78",155,0)
 . S FBAU=$O(^FBAAA("AG",FBDA_";FB7078(",DFN,0))
"RTN","FBCH78",156,0)
 . Q:'FBAU
"RTN","FBCH78",157,0)
 . S FBCNTRA=$P($G(^FBAAA(DFN,1,FBAU,0)),U,22)
"RTN","FBCH78",158,0)
 . Q:'FBCNTRA
"RTN","FBCH78",159,0)
 . S FBRET=FBCNTRA_U_$P($G(^FBAA(161.43,FBCNTRA,0)),U)
"RTN","FBCH78",160,0)
 Q FBRET
"RTN","FBCHC78")
0^6^B15534924^B16420420
"RTN","FBCHC78",1,0)
FBCHC78 ;AISC/DMK - CANCEL A 7078 ;8/25/14  15:22
"RTN","FBCHC78",2,0)
 ;;3.5;FEE BASIS;**82,154**;JAN 30, 1995;Build 12
"RTN","FBCHC78",3,0)
 ;;Per VA Directive 6402, this routine should not be modified.
"RTN","FBCHC78",4,0)
 Q:'$G(DUZ)
"RTN","FBCHC78",5,0)
 ;
"RTN","FBCHC78",6,0)
 ;get station number from site parameter file
"RTN","FBCHC78",7,0)
 D SITEP^FBAAUTL G END:FBPOP
"RTN","FBCHC78",8,0)
 S FBPSA=$E($P($G(^DIC(4,+$P($G(FBSITE(1)),"^",3),99)),"^"),1,3)
"RTN","FBCHC78",9,0)
 ;
"RTN","FBCHC78",10,0)
ASK ;get 7078 entry to cancel
"RTN","FBCHC78",11,0)
 W ! S DIC(0)="AEQMZ",DIC="^FB7078(",D="D",DIC("A")="Select Patient: ",DIC("S")="I $P(^(0),U,9)'=""DC""&($P(^(0),U,11)=$S($D(FBNH):7,1:6))" D IX^DIC K DIC,D G END:X=""!(X="^"),ASK:Y<0
"RTN","FBCHC78",12,0)
 S FB7078=+Y_";FB7078(",FBAAOB=FBPSA_"-"_$P(Y(0,0),".")_"-"_$P(Y(0,0),".",2),DFN=+$P(Y(0),"^",3),FB(161)=+$O(^FBAAA("AG",FB7078,DFN,0)),FBMM=$E($P(Y(0),U,4),4,5)
"RTN","FBCHC78",13,0)
 S FBADDT=$P(Y(0),U,4),FBVEN=$P(Y(0),U,2)
"RTN","FBCHC78",14,0)
 I $D(FBNH) S DIC="^FBAACNH(",DIC(0)="MZ",DIC("S")="I $P(^(0),U,2)=DFN&($P(^(0),U,10)=FB(161))",X=$P(Y(0),U,4) D ^DIC K DIC I +Y>0 W !,*7,"Must delete all movements associated with this authorization before canceling.",! G END
"RTN","FBCHC78",15,0)
 ;
"RTN","FBCHC78",16,0)
 ;check if payments made against the 7078
"RTN","FBCHC78",17,0)
 ;if so do not allow a user to cancel
"RTN","FBCHC78",18,0)
 I $D(^FBAAI("E",FB7078)) W !!,*7,"There is already an invoice entered for this hospitalization.  Cannot delete!",!! G END
"RTN","FBCHC78",19,0)
 I $D(^FBAAC("AM",FB7078)) W !!,*7,"There already are ancillary services entered against this authorization.  Cannot delete!",!! G END
"RTN","FBCHC78",20,0)
 ;
"RTN","FBCHC78",21,0)
 ;display 7078 and ask if ok to cancel
"RTN","FBCHC78",22,0)
 S DA=+FB7078,DIC="^FB7078(",DR="0;1" D EN^DIQ
"RTN","FBCHC78",23,0)
 W ! S DIR(0)="Y",DIR("A")="Are you sure you want to cancel",DIR("B")="No" D ^DIR K DIR G FBCHC78:'Y,END:$D(DIRUT)
"RTN","FBCHC78",24,0)
 ;
"RTN","FBCHC78",25,0)
 ;cancelling 7078 and associated athorization in file 161
"RTN","FBCHC78",26,0)
 ;deleting associated 7078 from the notification file in civil hospital
"RTN","FBCHC78",27,0)
 ;remove entries assoiciated with CNH in 161.23
"RTN","FBCHC78",28,0)
 ;removing estimated amount from 1358
"RTN","FBCHC78",29,0)
 I '$D(FBNH) S DA=$O(^FBAA(162.2,"AM",+FB7078,0)) I DA S DIE="^FBAA(162.2,",DR="16///@" D ^DIE K DIC,DIE W " ."
"RTN","FBCHC78",30,0)
 S DA(1)=DFN,DA=$O(^FBAAA("AG",FB7078,DFN,0)) I DA S DIK="^FBAAA("_DFN_",1," D ^DIK K DIK,DA W "."
"RTN","FBCHC78",31,0)
 S DA=+FB7078,DIE="^FB7078(",DR=".013////^S X=DUZ;.014////^S X=DT;9////^S X=""DC""" D ^DIE K DIE,DIC W "."
"RTN","FBCHC78",32,0)
 I $D(FBNH) S FBI=0 F  S FBI=$O(^FBAA(161.23,"AC",+FB7078,FBI)) Q:'FBI  I $D(^FBAA(161.23,FBI,0)) D
"RTN","FBCHC78",33,0)
 . S DA=FBI,DIK="^FBAA(161.23," D ^DIK K DIK W "."
"RTN","FBCHC78",34,0)
 ; if cancelled civil hospital 7078 then delete associated PTF record
"RTN","FBCHC78",35,0)
 I '$G(FBNH) D PTFD^FBUTL6(DFN,FBADDT)
"RTN","FBCHC78",36,0)
 W !!,"Authorization cancelled.  Now updating 1358.",!
"RTN","FBCHC78",37,0)
 D 1358 I $D(FBERR) W !,"Unable to affect 1358 adjustment.  Use appropriate IFCAP options.",!
"RTN","FBCHC78",38,0)
 W "...  Finished",!
"RTN","FBCHC78",39,0)
 ;
"RTN","FBCHC78",40,0)
END K DA,DR,DIE,DIC,DFN,FB,FBI,FB7078,FBAAOB,FBERR,PRC,PRCS,PRCSX,FBPSA,FBZZ,FBSITE,X,Y,FBPOP,FBNH,FBMM,FBADDT,FBVEN
"RTN","FBCHC78",41,0)
 Q
"RTN","FBCHC78",42,0)
1358 ;subtract estimated dollar amount from 1358
"RTN","FBCHC78",43,0)
 ;FBAAOB=FULL OBLIGATION NUMBER (STATION #-OBLIGATION #-REF #)
"RTN","FBCHC78",44,0)
 ;FBERR returned if IFCAP call fails
"RTN","FBCHC78",45,0)
 ;internal entry # in 424 = $O(^PRC(424,"B",FBAAOB,0))
"RTN","FBCHC78",46,0)
 ;
"RTN","FBCHC78",47,0)
 ;check if 1358 available for posting
"RTN","FBCHC78",48,0)
 I '$$INTER() W !,*7,"Unable to locate reference number on 1358.",! S FBERR=1 Q
"RTN","FBCHC78",49,0)
 S PRCS("X")=$P(FBAAOB,"-",1,2),PRCS("TYPE")="FB" D EN3^PRCS58 I Y=-1 W !,*7,"1358 Not available for posting.",! S FBERR=1 Q
"RTN","FBCHC78",50,0)
 D NOW^%DTC
"RTN","FBCHC78",51,0)
 S PRCSX=$$INTER()_"^"_%_"^"_0_"^"_"Authorization has been cancelled"_"^"_1_"^"
"RTN","FBCHC78",52,0)
 S PRCS("TYPE")="FB" D ^PRCS58CC I Y'=1 W !,*7,$P(Y,"^",2),! S FBERR=1 Q
"RTN","FBCHC78",53,0)
 Q
"RTN","FBCHC78",54,0)
 ;
"RTN","FBCHC78",55,0)
INTER() ;get internal entry number from file 424
"RTN","FBCHC78",56,0)
 ;first check interface id x-ref
"RTN","FBCHC78",57,0)
 ;second check is to "B" x-ref to stay backward compatible with IFCAP3.6
"RTN","FBCHC78",58,0)
 ;
"RTN","FBCHC78",59,0)
 I '$G(FBNH),$D(^PRC(424,"E",DFN_";"_+FB7078_";"_$P(FBAAOB,"-",2))) Q $O(^(DFN_";"_+FB7078_";"_$P(FBAAOB,"-",2),0))
"RTN","FBCHC78",60,0)
 I $G(FBNH),$D(^PRC(424,"E",DFN_";"_+FB7078_";"_$P(FBAAOB,"-",2)_";"_FBMM)) Q $O(^(DFN_";"_+FB7078_";"_$P(FBAAOB,"-",2)_";"_FBMM,0))
"RTN","FBCHC78",61,0)
 I $D(^PRC(424,"B",FBAAOB)) Q $O(^(FBAAOB,0))
"RTN","FBCHC78",62,0)
 Q 0
"RTN","FBCHC78",63,0)
 ;
"RTN","FBCHC78",64,0)
CNH ;entry point to cancel an authorization associated with the
"RTN","FBCHC78",65,0)
 ;community nursing home program.
"RTN","FBCHC78",66,0)
 S FBNH=1 G FBCHC78
"RTN","FBCHC78",67,0)
 Q
"RTN","FBCHCD")
0^42^B23155265^B20874782
"RTN","FBCHCD",1,0)
FBCHCD ;AISC/DMK - COMPLETE DISPOSITION ;1/22/2015
"RTN","FBCHCD",2,0)
 ;;3.5;FEE BASIS;**108,154**;JAN 30, 1995;Build 12
"RTN","FBCHCD",3,0)
 ;;Per VA Directive 6402, this routine should not be modified.
"RTN","FBCHCD",4,0)
ASK S DIC="^FB7078(",DIC(0)="AEQMZ",D="D",DIC("A")="Select Veteran: ",DIC("S")="I $P(^(0),U,9)=""I""" D IX^DIC G END:$E(X)="^"!(X=""),ASK:Y<0 S (DA,FBAA78)=+Y,FBTYPE=6,FB(0)=Y(0),FBDXS="",FBFRDT=$P(FB(0),"^",4) K DIC("S"),D
"RTN","FBCHCD",5,0)
EN S DIR(0)="162.4,4",DIR("A")="AUTHORIZATION TO DATE" D ^DIR
"RTN","FBCHCD",6,0)
 G END:$D(DUOUT)!$D(DTOUT),END:+Y'>0 S FBTODT=+Y K DIR,X,Y
"RTN","FBCHCD",7,0)
 I FBTODT]"",FBFRDT>FBTODT W !!,*7,?5,"Authorization To Date must be after Authorization From Date!",! G EN
"RTN","FBCHCD",8,0)
 S DIR(0)="162.4,4.5",DIR("A")="DATE OF DISCHARGE" D ^DIR K DIR
"RTN","FBCHCD",9,0)
 G END:$D(DUOUT)!$D(DTOUT),END:+Y'>0 S FBDOD=+Y K X,Y
"RTN","FBCHCD",10,0)
 I FBDOD]"",FBTODT>FBDOD W !!,*7,?5,"Date of Discharge must not be earlier than the Authorization To Date!",! G EN
"RTN","FBCHCD",11,0)
 S FBVEN=$P(FB(0),"^",2),FBVET=$P(FB(0),"^",3),DIE=DIC,DR="4////^S X=FBTODT;S:X="""" (Y,FBTODT)="""";S FBTODT=X;4.5////^S X=FBDOD" D ^DIE G END:FBTODT=""
"RTN","FBCHCD",12,0)
 D
"RTN","FBCHCD",13,0)
 . N FBX
"RTN","FBCHCD",14,0)
 . S FBX=$$ADDUA^FBUTL9(162.4,FBAA78_",","Complete 7078 authorization.")
"RTN","FBCHCD",15,0)
 . I 'FBX W !,"Error adding record in User Audit. Please contact IRM."
"RTN","FBCHCD",16,0)
ASKPT W ! S DIR(0)="SAO^00:SURGICAL;10:MEDICAL;86:PSYCHIATRY",DIR("A")="BEDSECTION/TREATING: ",DIR("?")="^D HELP^FBCH780" D ^DIR D NOUP:$D(DIRUT) G ASKPT:$D(DIRUT) S FBPT=Y K X,Y,DIRUT,DIR G AUTH^FBCH78
"RTN","FBCHCD",17,0)
EDIT ;ENTRY TO EDIT A COMPLETED DISPOSITION
"RTN","FBCHCD",18,0)
 S FBEDAT=0
"RTN","FBCHCD",19,0)
 S DIC="^FB7078(",DIC(0)="AEMQZ",D="D",DIC("A")="Select Patient: ",DIC("S")="I $P(^(0),U,9)=""C""&($P(^(0),U,11)=6)" D IX^DIC G END:X="^"!(X=""),EDIT:Y<0 S FB7078=+Y,FBVET=$P(Y(0),"^",3),FBHTDT=$P(Y(0),"^",5),FBHFDT=$P(Y(0),"^",4)
"RTN","FBCHCD",20,0)
 G END:'$D(^FBAAA("AG",FB7078_";FB7078("))
"RTN","FBCHCD",21,0)
 D
"RTN","FBCHCD",22,0)
 . N FBX
"RTN","FBCHCD",23,0)
 . S FBX=$$ADDUA^FBUTL9(162.4,FB7078_",","Edit 7078 authorization.")
"RTN","FBCHCD",24,0)
 . I 'FBX W !,"Error adding record in User Audit. Please contact IRM."
"RTN","FBCHCD",25,0)
 I $D(^FBAAI("E",FB7078_";FB7078(")) S FBEDAT=1 W !!,*7,"Payment already exists for this disposition, editing of dates not allowed!",!
"RTN","FBCHCD",26,0)
 I 'FBEDAT S DA=$O(^FBAA(162.2,"AM",+FB7078,0)) I DA]"" S DIE="^FBAA(162.2,",DR="4;S FBFRDT=(X\1)",DIE("NO^")="" D ^DIE K DIE,DR
"RTN","FBCHCD",27,0)
 I 'FBEDAT,(DA']"") G END
"RTN","FBCHCD",28,0)
 I 'FBEDAT,$G(FBFRDT) S DIE="^FB7078(",DA=+FB7078,DR=$S(FBHFDT'=FBFRDT:"3///^S X=FBFRDT;I 1;",1:"")_"4;S FBTODT=X",DIE("NO^")="" D ^DIE K DIE,DR
"RTN","FBCHCD",29,0)
 G END:+$G(FBTODT)'>0,END:'$G(FBFRDT)
"RTN","FBCHCD",30,0)
 I 'FBEDAT,(FBHTDT'=FBTODT),(FBTODT>$P(^FB7078(+FB7078,0),"^",16)) W !!,*7,"Date of Discharge must now be edited to be equal to or later than",!,"the Authorization To Date.",! S FBDR="4.5////^S X=FBTODT;I 1;"
"RTN","FBCHCD",31,0)
 I 'FBEDAT S FBDR=$G(FBDR)_"4.5;"
"RTN","FBCHCD",32,0)
 S FBTYPE=6,DIE="^FB7078(",DA=+FB7078,DR=$S($G(FBDR):FBDR,1:"")_"7///^S X=""@"";5ADMITTING AUTHORITY~",DIE("NO^")="" D ^DIE K DIC,DIE,D,DR,DA,FBDR
"RTN","FBCHCD",33,0)
 S DA(1)=FBVET,DIC="^FBAAA("_FBVET_",1,",DIC(0)="EQM",DA=$O(^FBAAA("AG",FB7078_";FB7078(",FBVET,0))
"RTN","FBCHCD",34,0)
 S DR=$S(FBEDAT'=1:".01////^S X=FBFRDT;",1:"")_$S(FBEDAT'=1:".02////^S X=FBTODT;",1:"")
"RTN","FBCHCD",35,0)
 ; FB*3.5*108 edit contract
"RTN","FBCHCD",36,0)
 I $$EDCNTRA^FBUTL7(DA(1),DA) S DR=DR_"105;"
"RTN","FBCHCD",37,0)
 S DR=DR_".06;D DEFPTC^FBCHCD;.065///^S X=FBPT;.07;.021;.096;.097//^S X=""NO"""
"RTN","FBCHCD",38,0)
 S DR(1,161.01,1)="I $D(^FBAAA(FBVET,1,DA,2,0)) S ^FB7078(FB7078,1,0)=^(0) F FBI=1:1 Q:'$D(^FBAAA(FBVET,1,DA,2,FBI,0))  I $D(^(0)) S ^FB7078(FB7078,1,FBI,0)=^(0);101",DIE=DIC,DIE("NO^")="" W ! D ^DIE K DIE,DR,DIC
"RTN","FBCHCD",39,0)
 W !! G EDIT
"RTN","FBCHCD",40,0)
END K DIC,DIE,DA,DR,FB,FBPROG,FBAAOUT,FBSW,FBVET,FB7078,FBHTDT,FBTODT,FBTYPE,FBAA78,FBFRDT,FBVEN,K,PTYPE,X,Y,Z,FBDEF,FBPT,FBI,FBHFDT,J,FBZZ,FBDA,FBDFN,FBDXS,FBNAME,FBSSN,FBZZ,ZZZ,FBDOD,FBEDAT
"RTN","FBCHCD",41,0)
 Q
"RTN","FBCHCD",42,0)
DEFPTC S FBDEF=$P(^FBAAA(FBVET,1,DA,0),U,18),FBDEF=$S(FBDEF="00":"SURGICAL",FBDEF=10:"MEDICAL",FBDEF=86:"PSYCHIATRY",1:"")
"RTN","FBCHCD",43,0)
 N X,DP,Y,DQ S DIR(0)="SA^00:SURGICAL;10:MEDICAL;86:PSYCHIATRY",DIR("A")="BEDSECTION/TREATING SPECIALTY: ",DIR("?")="^D HELP^FBCH780",DIR("B")=FBDEF D ^DIR D NOUP:$D(DUOUT) G DEFPTC:$D(DIRUT) S FBPT=Y K DIR,DIRUT Q
"RTN","FBCHCD",44,0)
NOUP W !!,*7,?5,"This is a mandatory response. Entering an '^' is not allowed!",! D HELP^FBCH780 Q
"RTN","FBCHDEL")
0^25^B2165242^B2224529
"RTN","FBCHDEL",1,0)
FBCHDEL ;AISC/DMK - DELETE NOTIFICATION/REQUEST ;7/11/14  15:39
"RTN","FBCHDEL",2,0)
 ;;3.5;FEE BASIS;**154**;JAN 30, 1995;Build 12
"RTN","FBCHDEL",3,0)
 ;;Per VA Directive 6402, this routine should not be modified.
"RTN","FBCHDEL",4,0)
 D HOME^%ZIS S DIC("S")=$S($D(^XUSEC("FBAA LEVEL 2",DUZ)):"I $P(^(0),U,17)=""""",1:"I $P(^(0),U,17)=""""&($P(^(0),U,8)=DUZ)") D ASKV^FBCHREQ G END:X=""!(X="^")
"RTN","FBCHDEL",5,0)
 W !! S DR="0:99" D EN^DIQ
"RTN","FBCHDEL",6,0)
ASK S DIR(0)="Y",DIR("A")="Are you sure you want to delete this Request",DIR("B")="NO" D ^DIR K DIR G END:$D(DIRUT)!'Y
"RTN","FBCHDEL",7,0)
EN I $D(DA),DA S FBDA=DA,DIK="^FBAA(162.2," D ^DIK W !,?3,"...request deleted",!
"RTN","FBCHDEL",8,0)
 I $D(FBDA),FBDA,$D(^FBAA(161.5,FBDA,0)) S DA=FBDA,DIK="^FBAA(161.5," D ^DIK
"RTN","FBCHDEL",9,0)
END K DIC,DIK,DIRUT,DA,FBDA,X,VAL,FBDA,DR,FBDFN,FBNAME,FBSSN,S,Y Q
"RTN","FBCHDIN")
0^26^B6884285^B5017257
"RTN","FBCHDIN",1,0)
FBCHDIN ;AISC/DMK - DELETE INPATIENT INVOICE ;12/12/14  14:37
"RTN","FBCHDIN",2,0)
 ;;3.5;FEE BASIS;**132,154**;JAN 30, 1995;Build 12
"RTN","FBCHDIN",3,0)
 ;;Per VA Directive 6402, this routine should not be modified.
"RTN","FBCHDIN",4,0)
 ;
"RTN","FBCHDIN",5,0)
BAT ;ask batch Number
"RTN","FBCHDIN",6,0)
 ;cannot delete an invoice from a batch that has a status of
"RTN","FBCHDIN",7,0)
 ;supervisor closed, reviewed after pricer, transmitted or vouchered.
"RTN","FBCHDIN",8,0)
 ;A clerk may delete an invoice in a batch
"RTN","FBCHDIN",9,0)
 ;they own if the status is open, closed, forwarded to pricer or
"RTN","FBCHDIN",10,0)
 ;assigned price.
"RTN","FBCHDIN",11,0)
 ;
"RTN","FBCHDIN",12,0)
 D HOME^%ZIS
"RTN","FBCHDIN",13,0)
 W ! S DIC="^FBAA(161.7,",DIC(0)="AEQMZ"
"RTN","FBCHDIN",14,0)
 S DIC("S")=$S($D(^XUSEC("FBAA LEVEL 2",DUZ)):"I ""TFV""'[$G(^(""ST""))",1:"I $P(^(0),U,5)=DUZ&(""TFVRS""'[($G(^(""ST""))))")_"&($P(^(0),U,3)=""B9"")"
"RTN","FBCHDIN",15,0)
 D ^DIC K DIC G:Y<1 END
"RTN","FBCHDIN",16,0)
 L +^FBAA(161.7,+Y):$G(DILOCKTM,3)
"RTN","FBCHDIN",17,0)
 I '$T W !,"Another user is editing this batch.  Try again later." G BAT
"RTN","FBCHDIN",18,0)
 S FBBAT=+Y,FBBAT(0)=Y(0)
"RTN","FBCHDIN",19,0)
 ;
"RTN","FBCHDIN",20,0)
INV ;get invoice user wants to delete in batch selected
"RTN","FBCHDIN",21,0)
 W ! S DIC="^FBAAI(",DIC(0)="AEQZ",DIC("S")="I $D(^FBAAI(""AC"",FBBAT,X))"
"RTN","FBCHDIN",22,0)
 S DIC("A")="Select Invoice to delete: " D ^DIC K DIC I X=""!(X="^") L -^FBAA(161.7,FBBAT) G BAT
"RTN","FBCHDIN",23,0)
 S FBDINV=Y,FBDINV(0)=Y(0),FBI=+Y,FBLISTC=0 D START^FBCHDI
"RTN","FBCHDIN",24,0)
 ;
"RTN","FBCHDIN",25,0)
 ; enforce separation of duties
"RTN","FBCHDIN",26,0)
 S FBDFN=$P(FBDINV(0),U,4)
"RTN","FBCHDIN",27,0)
 S FB7078I=$P(FBDINV(0),U,5)
"RTN","FBCHDIN",28,0)
 S FTP=$S(FB7078I]"":$O(^FBAAA("AG",FB7078I,FBDFN,0)),1:"")
"RTN","FBCHDIN",29,0)
 I FBDFN,FTP,'$$UOKPAY^FBUTL9(FBDFN,FTP) D  L -^FBAA(161.7,FBBAT) G BAT
"RTN","FBCHDIN",30,0)
 . W !,"You cannot process a payment associated with authorization ",FBDFN,"-",FTP
"RTN","FBCHDIN",31,0)
 . W !,"due to separation of duties."
"RTN","FBCHDIN",32,0)
 ;
"RTN","FBCHDIN",33,0)
 W ! S DIR(0)="Y",DIR("B")="No",DIR("A")="Sure you want to delete this invoice" D ^DIR K DIR G END:$D(DIRUT) I 'Y L -^FBAA(161.7,FBBAT) G BAT
"RTN","FBCHDIN",34,0)
 ;
"RTN","FBCHDIN",35,0)
 S DA=+FBDINV,DIK="^FBAAI(" W !?5,".... deleting!",!
"RTN","FBCHDIN",36,0)
 D ^DIK K DIK
"RTN","FBCHDIN",37,0)
 ;
"RTN","FBCHDIN",38,0)
 ;reset batch dollar amount, total payment items and invoice count
"RTN","FBCHDIN",39,0)
 D CNTTOT^FBAARB(FBBAT)
"RTN","FBCHDIN",40,0)
 S $P(FBBAT(0),"^",9)=+FBTOTAL
"RTN","FBCHDIN",41,0)
 S $P(FBBAT(0),"^",10)=+FBLCNT
"RTN","FBCHDIN",42,0)
 S $P(FBBAT(0),"^",11)=+FBLCNT
"RTN","FBCHDIN",43,0)
 S:$P(FBBAT(0),"^",10)'>0 $P(FBBAT(0),"^",18)=""
"RTN","FBCHDIN",44,0)
 S $P(^FBAA(161.7,FBBAT,0),"^",9,11)=$P(FBBAT(0),"^",9,11),$P(^FBAA(161.7,FBBAT,0),"^",18)=$P(FBBAT(0),"^",18)
"RTN","FBCHDIN",45,0)
END I $G(FBBAT) L -^FBAA(161.7,FBBAT)
"RTN","FBCHDIN",46,0)
 K DA,FBBAT,FBLISTC,FBDINV,FBAAOUT,FBDX,FBDX1,FBPAT,FBPROC,FBVEN,X,Y,Q
"RTN","FBCHDIN",47,0)
 K FB7078I,FBDFN,FTP,DTOUT,DUOUT,DIRUT,DIROUT,FBI,FBLCNT,FBTOTAL
"RTN","FBCHDIN",48,0)
 D END^FBCHDI Q
"RTN","FBCHEAP")
0^27^B21240885^B16779482
"RTN","FBCHEAP",1,0)
FBCHEAP ;AISC/DMK - ENTER AMOUNT PAID FROM PRICER ;10/1/2014
"RTN","FBCHEAP",2,0)
 ;;3.5;FEE BASIS;**38,55,61,77,154**;JAN 30, 1995;Build 12
"RTN","FBCHEAP",3,0)
 ;;Per VA Directive 6402, this routine should not be modified.
"RTN","FBCHEAP",4,0)
DIC W ! S DIC="^FBAA(161.7,",DIC(0)="AEQMZ",DIC("S")="I $P(^(0),U,15)=""Y""&($G(^(""ST""))=""P"")"_$S($D(^XUSEC("FBAA LEVEL 2",DUZ)):"",1:"&($P(^(0),U,5)=DUZ)") D ^DIC
"RTN","FBCHEAP",5,0)
 G END:X="^"!(X=""),DIC:Y<0 S FBN=+Y,FBN(0)=Y(0)
"RTN","FBCHEAP",6,0)
ASK S DIR(0)="Y",DIR("A")="Would you like to reject any invoices from the pricer",DIR("B")="NO" D ^DIR K DIR G END:$D(DIRUT),REJECT:Y
"RTN","FBCHEAP",7,0)
DIC1 W !! S DIC="^FBAAI(",DIC(0)="AEQMZ",DIC("A")="Select Patient: ",D="D",DIC("S")="I $P(^(0),U,17)=FBN",DIC("W")="W ?25,$S($D(^DPT($P(^(0),U,4),0)):$P(^(0),U),1:"""")" D ^DIC S DIE=DIC K DIC,D G END:X="^",DIC:X=""!(Y<0)
"RTN","FBCHEAP",8,0)
 S (DA,FBI)=+Y,FBI(0)=Y(0) G END:'$D(^FBAAI(FBI,0))
"RTN","FBCHEAP",9,0)
DISP S FBLISTC="" D HOME^%ZIS,START^FBCHDI2
"RTN","FBCHEAP",10,0)
 W !!
"RTN","FBCHEAP",11,0)
 ;
"RTN","FBCHEAP",12,0)
 ;enforce separation of duties
"RTN","FBCHEAP",13,0)
 S FBDFN=$P(FBI(0),U,4)
"RTN","FBCHEAP",14,0)
 S FB7078I=$P(FBI(0),U,5)
"RTN","FBCHEAP",15,0)
 S FTP=$S(FB7078I]"":$O(^FBAAA("AG",FB7078I,FBDFN,0)),1:"")
"RTN","FBCHEAP",16,0)
 I FBDFN,FTP,'$$UOKPAY^FBUTL9(FBDFN,FTP) D  G DIC1
"RTN","FBCHEAP",17,0)
 . W "You cannot process a payment associated with authorization ",FBDFN,"-",FTP
"RTN","FBCHEAP",18,0)
 . W !,"due to separation of duties."
"RTN","FBCHEAP",19,0)
 ;
"RTN","FBCHEAP",20,0)
 S FBJ=$P(FBI(0),"^",8)
"RTN","FBCHEAP",21,0)
 ; set FB1725 flag = true if payment for a 38 U.S.C. 1725 claim
"RTN","FBCHEAP",22,0)
 S FB1725=$S($P(FBI(0),U,5)["FB583":+$P($G(^FB583(+$P(FBI(0),U,5),0)),U,28),1:0)
"RTN","FBCHEAP",23,0)
 S DR="26;S FBPAMT=X;W:FB1725 !?2,""**Payment is for emergency treatment under 38 U.S.C. 1725."";W:FB1725&($G(FBPAMT)>0) !?2,""  70% of Pricer Amount = ""_$J(.7*FBPAMT,0,2);8;S FBK=X"
"RTN","FBCHEAP",24,0)
 ;S DR(1,162.5,1)="S:(FBJ-FBK)'>0 Y=24;9//^S X=$S(FBJ-FBK:FBJ-FBK,1:"""");S:'X Y=24;10;S:X'=4 Y=24;18"
"RTN","FBCHEAP",25,0)
 S DR(1,162.5,1)="S FBX=$$ADJ^FBUTL2(FBJ-FBK,.FBADJ,1,,,1)"
"RTN","FBCHEAP",26,0)
 S DR(1,162.5,2)="@20;24R;S:$$INPICD^FBCSV1(X,$G(DA),$P($G(FBIN),""^"",6)) Y=""@20"";24.5R"
"RTN","FBCHEAP",27,0)
 S DR(1,162.5,3)="S FBX=$$RR^FBUTL4(.FBRRMK,2)"
"RTN","FBCHEAP",28,0)
 S DIE("NO^")=""
"RTN","FBCHEAP",29,0)
 D
"RTN","FBCHEAP",30,0)
 . N ICDVDT S ICDVDT=$P($G(FBIN),"^",6) D ^DIE
"RTN","FBCHEAP",31,0)
 K DIE("NO^") G END:$D(DTOUT)
"RTN","FBCHEAP",32,0)
 ; file adjustment reasons
"RTN","FBCHEAP",33,0)
 D FILEADJ^FBCHFA(FBI_",",.FBADJ)
"RTN","FBCHEAP",34,0)
 ; file remittance remarks
"RTN","FBCHEAP",35,0)
 D FILERR^FBCHFR(FBI_",",.FBRRMK)
"RTN","FBCHEAP",36,0)
 D TOT S $P(FBN(0),"^",9)=FBK(1),^FBAA(161.7,FBN,0)=FBN(0)
"RTN","FBCHEAP",37,0)
 D CHK I $D(FBCHSW) K FBCHSW G DIC1
"RTN","FBCHEAP",38,0)
 I '$D(FBCHSW) S DA=FBN,(DIC,DIE)="^FBAA(161.7,",DIC(0)="LQ",DR="11////^S X=""A""",DLAYGO=161.7 D ^DIE G DIC
"RTN","FBCHEAP",39,0)
 G DIC1:$O(^FBAAI("AC",FBN,FBI))
"RTN","FBCHEAP",40,0)
END K DA,DFN,DIC,DIE,DR,FBAAOUT,FBDX,FBI,FBIN,FBJ,FBK,FBLISTC,FBN,FBPROC,FBVEN,FBVID,I,J,K,L,POP,Q,VA,VADM,X,POP,YS,VAL,ZZ,Y,FBRR,FBTYPE,FBCHSW,DIRUT,FB1725,FBPAMT
"RTN","FBCHEAP",41,0)
 K FBADJ,FBRRMK,FBDFN,FB7078I,FTP
"RTN","FBCHEAP",42,0)
 D END^FBCHDI
"RTN","FBCHEAP",43,0)
 Q
"RTN","FBCHEAP",44,0)
REJECT S FBTYPE="B9"
"RTN","FBCHEAP",45,0)
 W ! S DIC="^FBAAI(",DIC(0)="AEQMZ",DIC("S")="I $P(^(0),U,17)=FBN&($P(^(0),U,9)="""")",DIC("W")="W ?25,$S($D(^DPT($P(^(0),U,4),0)):$P(^(0),U),1:"""")" D ^DIC G END:X=""!(X="^"),REJECT:Y<0 S FBI=+Y,FBI(0)=Y(0)
"RTN","FBCHEAP",46,0)
 S FBLISTC="" D HOME^%ZIS,START^FBCHDI2
"RTN","FBCHEAP",47,0)
 ;
"RTN","FBCHEAP",48,0)
 ;enforce separation of duties
"RTN","FBCHEAP",49,0)
 S FBDFN=$P(FBI(0),U,4)
"RTN","FBCHEAP",50,0)
 S FB7078I=$P(FBI(0),U,5)
"RTN","FBCHEAP",51,0)
 S FTP=$S(FB7078I]"":$O(^FBAAA("AG",FB7078I,FBDFN,0)),1:"")
"RTN","FBCHEAP",52,0)
 I FBDFN,FTP,'$$UOKPAY^FBUTL9(FBDFN,FTP) D  G REJECT
"RTN","FBCHEAP",53,0)
 . W !,"You cannot process a payment associated with authorization ",FBDFN,"-",FTP
"RTN","FBCHEAP",54,0)
 . W !,"due to separation of duties."
"RTN","FBCHEAP",55,0)
 ;
"RTN","FBCHEAP",56,0)
RASK S DIR(0)="F^2:40",DIR("A")="Enter reason for rejecting (2-40 characters)",DIR("?")="Enter a reason for rejecting payment from Austin Pricer" D ^DIR K DIR G END:$D(DIRUT) S FBRR=X
"RTN","FBCHEAP",57,0)
ASKSU S DIR(0)="Y",DIR("A")="Are you sure you want to reject this item",DIR("B")="NO" D ^DIR K DIR G END:$D(DIRUT),DIC:'Y
"RTN","FBCHEAP",58,0)
 S (DLAYGO,DIDEL)=162.5,DIC(0)="AEQLM"
"RTN","FBCHEAP",59,0)
 S (DIC,DIE)="^FBAAI(",DA=FBI,DR="13////^S X=""P"";14////^S X=FBRR;15////^S X=FBN;20///^S X=""@""" D ^DIE
"RTN","FBCHEAP",60,0)
 S $P(FBN(0),"^",10)=$P(FBN(0),"^",10)-1,$P(FBN(0),"^",11)=$P(FBN(0),"^",11)-1,$P(FBN(0),"^",17)="Y",^FBAA(161.7,FBN,0)=FBN(0)
"RTN","FBCHEAP",61,0)
RASKSU I $O(^FBAAI("AC",FBN,FBI)) S DIR(0)="Y",DIR("A")="Reject another",DIR("B")="NO" D ^DIR K DIR G END:$D(DIRUT),REJECT:Y
"RTN","FBCHEAP",62,0)
 I $P(^FBAA(161.7,FBN,0),"^",11)=0 S (DIC,DIE)="^FBAA(161.7,",DIC(0)="AEQM",DA=FBN,DR="11////^S X=""V"";12////^S X=DT" D ^DIE G DIC
"RTN","FBCHEAP",63,0)
 G END
"RTN","FBCHEAP",64,0)
CHK F I=0:0 S I=$O(^FBAAI("AC",FBN,I)) Q:I'>0  I $D(^FBAAI(I,0)),$P(^(0),"^",9)="" S FBCHSW=1
"RTN","FBCHEAP",65,0)
 Q
"RTN","FBCHEAP",66,0)
TOT S FBK(1)=0 F I=0:0 S I=$O(^FBAAI("AC",FBN,I)) Q:'I  S FBK(1)=FBK(1)+$P($G(^FBAAI(I,0)),"^",9)
"RTN","FBCHEAP",67,0)
 Q
"RTN","FBCHEP")
0^71^B39727558^B37636915
"RTN","FBCHEP",1,0)
FBCHEP ;AISC/DMK - ENTER PAYMENT FOR CONTRACT HOSPITAL ;10/1/2004
"RTN","FBCHEP",2,0)
 ;;3.5;FEE BASIS;**4,61,77,82,122,108,124,135,139,123,154**;JAN 30, 1995;Build 12
"RTN","FBCHEP",3,0)
 ;;Per VA Directive 6402, this routine should not be modified.
"RTN","FBCHEP",4,0)
 S FBAAPTC="V",FBAAOUT=0
"RTN","FBCHEP",5,0)
RD K FBAAID,FBAAVID S FBRESUB="" D GETVET^FBAAUTL1 G:DFN']"" Q
"RTN","FBCHEP",6,0)
 S FBPROG="I $P(^(0),U,3)=6,($P(^(0),U,9)'[""FB583"")" D GETAUTH^FBAAUTL1 G RD:$D(DUOUT),RD:FTP']""
"RTN","FBCHEP",7,0)
 ;W !!,?25,"<  ASSOCIATED 7078  >",!!
"RTN","FBCHEP",8,0)
 ;S DIC="^FB7078(",DA=FB7078,DR="0;1" D EN^DIQ
"RTN","FBCHEP",9,0)
 I FB7078="" W !,*7,"No 7078 on file for this authorization." G RD
"RTN","FBCHEP",10,0)
 S FBI7078=FB7078_";FB7078("
"RTN","FBCHEP",11,0)
 ;
"RTN","FBCHEP",12,0)
 I '$$UOKPAY^FBUTL9(DFN,FTP) D  G RD
"RTN","FBCHEP",13,0)
 . W !!,"You cannot process a payment associated with authorization ",DFN,"-",FTP
"RTN","FBCHEP",14,0)
 . W !,"due to separation of duties."
"RTN","FBCHEP",15,0)
 ;
"RTN","FBCHEP",16,0)
 I $D(^FBAAI("E",FBI7078)) S FBAAIN=$O(^FBAAI("E",FBI7078,0)) G OUT
"RTN","FBCHEP",17,0)
SETINV S FBZ(0)=^FB7078(FB7078,0),FBVET=$P(FBZ(0),"^",3),FBVEN=$P(FBZ(0),"^",2),FBVEN=$P(FBVEN,";",1)
"RTN","FBCHEP",18,0)
 ;
"RTN","FBCHEP",19,0)
EN583 ;Entry from 583 enter payment
"RTN","FBCHEP",20,0)
 I FBAAPTC="R" D ^FBAACO0
"RTN","FBCHEP",21,0)
 S DA=FBVEN D EN1^FBAAVD
"RTN","FBCHEP",22,0)
 I $P($G(^FBAAV(FBVEN,"ADEL")),U)="Y" W !!,*7,"Vendor is flagged for Austin deletion!" G Q
"RTN","FBCHEP",23,0)
 D SITEP^FBAAUTL G Q:FBPOP
"RTN","FBCHEP",24,0)
 S FBAAMPI=$P(FBSITE("FBNUM"),U,4)
"RTN","FBCHEP",25,0)
 ;
"RTN","FBCHEP",26,0)
RDV S FBVE="" S:$D(^FBAAV(FBVEN,"AMS")) FBVE=$P(^("AMS"),"^",2) S:$G(FBVE)'="Y" FBVE="N"
"RTN","FBCHEP",27,0)
 I FBVE="Y" W *7,!!,"Vendor is listed as 'exempt from the pricer'." S DIR(0)="Y",DIR("A")="Do you wish to keep this invoice exempt from the pricer",DIR("B")="Yes" D ^DIR K DIR G Q:$D(DIRUT) S FBVE=$S(Y=1:"Y",1:"N")
"RTN","FBCHEP",28,0)
 I $G(FBVE)'="Y",($P($G(^FBAAV(FBVEN,0)),"^",17)']"") W !!,*7,"Medicare ID Number is needed for this Vendor!" S DIE="^FBAAV(",DR=22 D ^DIE K DIE G Q:$D(DTOUT)!('$L(X))
"RTN","FBCHEP",29,0)
 ;
"RTN","FBCHEP",30,0)
BAT S DIC="^FBAA(161.7,",DIC(0)="AEQMZ",DIC("S")="I $P(^(0),U,3)=""B9""&($P(^(0),U,5)=DUZ)&($P(^(0),U,15)=""Y"")&($G(^(""ST""))=""O"")&(FBAAMPI>$P(^(0),U,10))" W ! D ^DIC K DIC
"RTN","FBCHEP",31,0)
 G Q:X="^"!(X=""),BAT:Y<0 S FBAABE=+Y,FBY(0)=Y(0),Z1=$P(FBY(0),"^",11),BO=$P(FBY(0),"^",2),Z2=$P(FBY(0),"^",10),FBSTN=$P(FBY(0),"^",8),FBCHOB=FBSTN_"-"_$P(FBY(0),"^",2),FBEXMPT=$P(FBY(0),"^",18) S FBAAOUT=0 D CHK I FBAAOUT K Y,Y(0),FBAABE G BAT
"RTN","FBCHEP",32,0)
 I FBI7078["FB7078(",BO'=$P($P(FBZ(0),U),".") W !,*7,"Obligation number on batch does not match 1358.",!,"Obligation number on batch must be ",$P($P(FBZ(0),U),"."),".",! G BAT
"RTN","FBCHEP",33,0)
 S FBINC=$S($P(FBY(0),"^",10)="":0,1:$P(FBY(0),"^",10)),FBLN=$S($P(FBY(0),"^",11)="":0,1:$P(FBY(0),"^",11))
"RTN","FBCHEP",34,0)
GETNXI D GETNXI^FBAAUTL
"RTN","FBCHEP",35,0)
 W !!,"Invoice # ",FBAAIN," assigned to this Invoice"
"RTN","FBCHEP",36,0)
RIN S CALLERID="FBCHEP" D GETINDT^FBAACO1 K CALLERID G Q:$G(FBAAOUT)
"RTN","FBCHEP",37,0)
 ;
"RTN","FBCHEP",38,0)
 ; FB*3.5*123 - check for IPAC agreement for Federal vendor and capture DoD invoice number (both req'd if IPAC)
"RTN","FBCHEP",39,0)
 S FBDODINV=""
"RTN","FBCHEP",40,0)
 S FBIA=$$IPAC^FBAAMP($G(FBVEN)) I FBIA=-1 G Q
"RTN","FBCHEP",41,0)
 I FBIA,'$$IPACINV^FBAAMP(.FBDODINV) G Q
"RTN","FBCHEP",42,0)
 ;
"RTN","FBCHEP",43,0)
 ; ask patient control number
"RTN","FBCHEP",44,0)
 S FBCSID=$$ASKPCN^FBUTL5() I FBCSID="^" G Q
"RTN","FBCHEP",45,0)
 ; if U/C then get FPPS Claim ID else ask user
"RTN","FBCHEP",46,0)
 I $D(FB583) S FBFPPSC=$P($G(^FB583(FB583,5)),U) W !,"FPPS CLAIM ID: ",$S(FBFPPSC="":"N/A",1:FBFPPSC)
"RTN","FBCHEP",47,0)
 E  S FBFPPSC=$$FPPSC^FBUTL5() I FBFPPSC=-1 G Q
"RTN","FBCHEP",48,0)
 ; Get Unique Claim ID  ; FB*3.5*135
"RTN","FBCHEP",49,0)
 S FBUCI135=$$ENTINPAT^FBUTL136($G(FBSTN),1,,"I",$G(FBFPPSC),$G(FBVEN)) I FBUCI135<1 G Q
"RTN","FBCHEP",50,0)
 ; if EDI claim then ask FPPS line item
"RTN","FBCHEP",51,0)
 I FBFPPSC]"" S FBFPPSL=$$FPPSL^FBUTL5(,1) I FBFPPSL=-1 G Q
"RTN","FBCHEP",52,0)
 ; compute default Covered Days
"RTN","FBCHEP",53,0)
 S FBCDAYS=$$FMDIFF^XLFDT(FBAAEDT,FBAABDT)
"RTN","FBCHEP",54,0)
 I FBCDAYS=0 S FBCDAYS=1
"RTN","FBCHEP",55,0)
 S FBAAMM=$S(FBAAPTC="R":"",$D(FB583):"",1:1) D PPT^FBAACO1()
"RTN","FBCHEP",56,0)
DIC S DIC="^FBAAI(",DIC(0)="LQ",DLAYGO=162.5,X=FBAAIN D ^DIC G Q:Y<0
"RTN","FBCHEP",57,0)
 S DA=+Y,DIE=DIC,DR="[FBCH ENTER PAYMENT]",DIE("NO^")=""
"RTN","FBCHEP",58,0)
 D
"RTN","FBCHEP",59,0)
 . ; JAS - 12/18/13 - PATCH 139 - Modified original code for ICD-10--date of interest must be Auth. To date, if available.
"RTN","FBCHEP",60,0)
 . N ICDVDT S ICDVDT=$G(FBAAEDT)
"RTN","FBCHEP",61,0)
 . I ICDVDT="" S ICDVDT=$G(FBAABDT)
"RTN","FBCHEP",62,0)
 . D ^DIE
"RTN","FBCHEP",63,0)
 . ; End 139
"RTN","FBCHEP",64,0)
 ; file adjustment reasons
"RTN","FBCHEP",65,0)
 D FILEADJ^FBCHFA(DA_",",.FBADJ)
"RTN","FBCHEP",66,0)
 ; file remittance remarks
"RTN","FBCHEP",67,0)
 D FILERR^FBCHFR(DA_",",.FBRRMK)
"RTN","FBCHEP",68,0)
 ; file Line Item Rendering providers
"RTN","FBCHEP",69,0)
 D FILERP^FBUTL8(DA_",",.FBPROV) ;FB*3.5*122
"RTN","FBCHEP",70,0)
 K DIE,DIC,D,DA,DR
"RTN","FBCHEP",71,0)
 S $P(FBY(0),"^",10)=FBINC+1,$P(FBY(0),"^",11)=FBLN+1,$P(FBY(0),"^",18)=FBEXMPT,^FBAA(161.7,FBAABE,0)=FBY(0) ;D:'$D(FBNOPTF) PTF G Q:$D(FB583),RD
"RTN","FBCHEP",72,0)
 D
"RTN","FBCHEP",73,0)
 . N FBX
"RTN","FBCHEP",74,0)
 . S FBX=FBAAMPI-(FBINC+1)
"RTN","FBCHEP",75,0)
 . I FBX<6 W !,$C(7),"Warning, you can only enter ",FBX," more invoices in this batch!",!
"RTN","FBCHEP",76,0)
 D:'$D(FBNOPTF) PTF
"RTN","FBCHEP",77,0)
 G Q:$D(FB583),RD
"RTN","FBCHEP",78,0)
OUT W !!,*7,?3,"Invoice number ",FBAAIN," has already been entered for this authorization.",!,?3,"Use the Contract Hospital 'Invoice Edit' option if needed.",!
"RTN","FBCHEP",79,0)
 ;check if user wants to add a second invoice for this 7078
"RTN","FBCHEP",80,0)
 W ! S DIR("A")="Want to add another invoice for this episode of care",DIR("B")="No",DIR(0)="Y" D ^DIR K DIR I Y S (FBNOPTF,FBRESUB)=1 G SETINV
"RTN","FBCHEP",81,0)
Q K BO,CNT,D,DA,DAT,DIC,DIE,DLAYGO,DR,FB7078,FBAABDT,FBAABE,FBAAEDT,FBAAID,FBAAIN,FBAAOUT,FBAAPTC,FBDX,FBTT,FBTYPE,FBVEN,FBVET,FBXX,FTP,I,J,FBK,PI,FBPOP,PTYPE,S,FBZ,Z1,FBI,FBPROG,FBRR,FBSW,FBPOV,FBPT,FBY,T,Y,Z1,Z2,ZZ,FBPSA,A,FBI7078
"RTN","FBCHEP",82,0)
 K FBCHOB,FBAUT,FBSEQ,X,FBSITE,F,FBSTN,FBASSOC,FBLOC,DUOUT,PSA,FBCOUNTY,DFN,FBNOPTF,DIRUT,FBVE,FBAAOUT,FBEXMPT,FBAAPN,FBAMTC,FBDEL,FBINC,FBLN,FBRESUB
"RTN","FBCHEP",83,0)
 K FBD1,FBFDC,FBMST,FBTTYPE,FB583,FBUCI135
"RTN","FBCHEP",84,0)
 K FBCSID,FBFPPSC,FBFPPSL,FBCDAYS,FBAMTP,FBADJ,FBRRMK,FBAAMPI,FBV,FBIA,FBDODINV
"RTN","FBCHEP",85,0)
 D GETAUTHK^FBAAUTL1
"RTN","FBCHEP",86,0)
 Q
"RTN","FBCHEP",87,0)
PTF I $G(FBVET),$G(FBI7078)["FB583" S:'$G(DFN) DFN=FBVET D PTFC^FBUTL6(DFN,$P(FBZ(0),"^",4))
"RTN","FBCHEP",88,0)
 Q
"RTN","FBCHEP",89,0)
PRBT ;Entry point for patient reimbursement option
"RTN","FBCHEP",90,0)
 ;
"RTN","FBCHEP",91,0)
 S FBAAPTC="R"
"RTN","FBCHEP",92,0)
 G RD
"RTN","FBCHEP",93,0)
CHK ;Check for vendor and batch being exempt from pricer
"RTN","FBCHEP",94,0)
 I $G(FBVE)'="Y"&($G(FBVE)'="N") S FBVE="N"
"RTN","FBCHEP",95,0)
 I $G(FBEXMPT)="Y" Q:FBVE="Y"  G OPEN:FBVE="N"
"RTN","FBCHEP",96,0)
 I $G(FBEXMPT)="N" Q:FBVE="N"  G OPEN:FBVE="Y"
"RTN","FBCHEP",97,0)
 I '$G(FBEXMPT)&($G(Z2)'>0) S FBEXMPT=FBVE Q
"RTN","FBCHEP",98,0)
 I '$G(FBEXMPT)&($G(Z2)>0) S $P(^FBAA(161.7,FBAABE,0),"^",18)="N",FBEXMPT="N" G CHK
"RTN","FBCHEP",99,0)
 Q
"RTN","FBCHEP",100,0)
OPEN W *7,!!,"This Invoice may not be added to Batch # ",+FBY(0),".",!,"***You may not add a ",$S(FBVE="Y":"pricer exempt",1:"non-exempt")," invoice to a ",$S(FBVE="Y":"non-exempt",1:"pricer exempt")," batch.***"
"RTN","FBCHEP",101,0)
 S DIR(0)="Y",DIR("A")="Do you want to open a new batch at this time",DIR("B")="Y" D ^DIR K DIR S:$D(DIRUT)!('Y) FBAAOUT=1 Q:FBAAOUT  D RCHOP^FBAAOB S FBEXMPT=FBVE D
"RTN","FBCHEP",102,0)
 .S FBY(0)=$G(^FBAA(161.7,FBAABE,0)),Z1=$P(FBY(0),"^",11),BO=$P(FBY(0),"^",2),Z2=$P(FBY(0),"^",10),FBSTN=$P(FBY(0),"^",8),FBCHOB=FBSTN_"-"_$P(FBY(0),"^",2)
"RTN","FBCHEP",103,0)
 Q
"RTN","FBCHEP1")
0^28^B51535191^B47429330
"RTN","FBCHEP1",1,0)
FBCHEP1 ;AISC/DMK - EDIT PAYMENT FOR CONTRACT HOSPITAL ;10/01/14
"RTN","FBCHEP1",2,0)
 ;;3.5;FEE BASIS;**38,61,122,133,108,124,132,139,123,154**;JAN 30, 1995;Build 12
"RTN","FBCHEP1",3,0)
 ;;Per VA Directive 6402, this routine should not be modified.
"RTN","FBCHEP1",4,0)
EDIT ;ENTRY POINT TO EDIT PAYMENT
"RTN","FBCHEP1",5,0)
 N LASTDX,LASTPROC
"RTN","FBCHEP1",6,0)
 S IOP=$S($D(ION):ION,1:"HOME") D ^%ZIS K IOP
"RTN","FBCHEP1",7,0)
BT W ! S DIC="^FBAA(161.7,",DIC(0)="AEQMZ",DIC("S")="I $P(^(0),U,3)=""B9""&($P(^(0),U,15)=""Y"")",DIC("S")=$S($D(^XUSEC("FBAA LEVEL 2",DUZ)):DIC("S"),1:DIC("S")_"&($P(^(0),U,5)=DUZ)") D ^DIC
"RTN","FBCHEP1",8,0)
 G END:X=""!(X="^"),BT:Y<0 S FBN=+Y,FBN(0)=Y(0)
"RTN","FBCHEP1",9,0)
 S FBEXMPT=$P(FBN(0),"^",18)
"RTN","FBCHEP1",10,0)
 S FBSTAT=^FBAA(161.7,FBN,"ST"),FBBAMT=$S($P(FBN(0),"^",9)="":0,1:$P(FBN(0),"^",9))
"RTN","FBCHEP1",11,0)
 I FBSTAT="C"&('$D(^XUSEC("FBAA LEVEL 2",DUZ))) W !!,*7,?3,"You must Reopen the batch prior to editing the invoice.",! G END
"RTN","FBCHEP1",12,0)
 I FBSTAT="S"!(FBSTAT="P")!(FBSTAT="R")&('$D(^XUSEC("FBAA LEVEL 2",DUZ))) W !!,*7,?3,"You must be a holder of the FBAA LEVEL 2 security key",!,?3,"to edit this invoice.",! G END
"RTN","FBCHEP1",13,0)
 I FBSTAT="T"!(FBSTAT="F")!(FBSTAT="V") W !!,?3,"Batch has already been sent to Austin for payment.",! G END
"RTN","FBCHEP1",14,0)
INV W ! S DIC="^FBAAI(",DIC(0)="AEQZ",DIC("S")="I $P(^(0),U,17)=FBN" D ^DIC K DIC("S") G BT:X=""!(X="^"),INV:Y<0 S FBI=+Y
"RTN","FBCHEP1",15,0)
 ;
"RTN","FBCHEP1",16,0)
 ; enforce separation of duties
"RTN","FBCHEP1",17,0)
 S FBDFN=$P($G(^FBAAI(FBI,0)),U,4)
"RTN","FBCHEP1",18,0)
 S FB7078I=$P($G(^FBAAI(FBI,0)),U,5)
"RTN","FBCHEP1",19,0)
 S FTP=$S(FB7078I]"":$O(^FBAAA("AG",FB7078I,FBDFN,0)),1:"")
"RTN","FBCHEP1",20,0)
 I '$$UOKPAY^FBUTL9(FBDFN,FTP) D  Q
"RTN","FBCHEP1",21,0)
 . W !!,"You cannot process a payment associated with authorization ",FBDFN,"-",FTP
"RTN","FBCHEP1",22,0)
 . W !,"due to separation of duties."
"RTN","FBCHEP1",23,0)
 ;
"RTN","FBCHEP1",24,0)
 ;
"RTN","FBCHEP1",25,0)
 ; FB*3.5*123 - edit inpatient invoice - check for IPAC data for Federal Vendors
"RTN","FBCHEP1",26,0)
 I '$$IPACEDIT^FBAAPET1(162.5,FBI,.FBIA,.FBDODINV) G INV
"RTN","FBCHEP1",27,0)
 ;
"RTN","FBCHEP1",28,0)
 S FBK=$S($P(^FBAAI(FBI,0),"^",9)="":0,1:$P(^(0),"^",9))
"RTN","FBCHEP1",29,0)
 S FBLISTC="",FBAAI=FBI W @IOF D START^FBCHDI2 S FBI=FBAAI I $P(^FBAAI(FBI,0),"^",9)="" S FBPRICE=""
"RTN","FBCHEP1",30,0)
 ; set FB1725 flag = true if payment for a 38 U.S.C. 1725 claim
"RTN","FBCHEP1",31,0)
 D
"RTN","FBCHEP1",32,0)
 . N FBY
"RTN","FBCHEP1",33,0)
 . S FBY=$G(^FBAAI(FBI,0))
"RTN","FBCHEP1",34,0)
 . S FB1725=$S($P(FBY,U,5)["FB583":+$P($G(^FB583(+$P(FBY,U,5),0)),U,28),1:0)
"RTN","FBCHEP1",35,0)
 ; get values of FPPS Claim ID and Line Item
"RTN","FBCHEP1",36,0)
 S FBFPPSC=$P($G(^FBAAI(FBI,3)),U)
"RTN","FBCHEP1",37,0)
 S FBFPPSL=$P($G(^FBAAI(FBI,3)),U,2)
"RTN","FBCHEP1",38,0)
 ; load current adjustment data
"RTN","FBCHEP1",39,0)
 D LOADADJ^FBCHFA(FBI_",",.FBADJ)
"RTN","FBCHEP1",40,0)
 ; save adjustment data prior to edit session in sorted list
"RTN","FBCHEP1",41,0)
 S FBADJL(0)=$$ADJL^FBUTL2(.FBADJ) ; sorted list of original adjustments
"RTN","FBCHEP1",42,0)
 ; load current remittance remark data
"RTN","FBCHEP1",43,0)
 D LOADRR^FBCHFR(FBI_",",.FBRRMK)
"RTN","FBCHEP1",44,0)
 ; load Item level Rendering provider data
"RTN","FBCHEP1",45,0)
 D LOADRP^FBUTL8(FBI_",",.FBPROV) ;FB*3.5*122
"RTN","FBCHEP1",46,0)
 ; save remittance remarks prior to edit session in sorted list
"RTN","FBCHEP1",47,0)
 S FBRRMKL(0)=$$RRL^FBUTL4(.FBRRMK)
"RTN","FBCHEP1",48,0)
 S LASTDX=$$LAST(FBI,"DX"),LASTPROC=$$LAST(FBI,"PROC")
"RTN","FBCHEP1",49,0)
 S (DIE,DIC)="^FBAAI(",DIC(0)="AEQM",DA=FBI,DR="[FBCH EDIT PAYMENT]" W !
"RTN","FBCHEP1",50,0)
 D
"RTN","FBCHEP1",51,0)
 . N ICDVDT,DFN,FB583,FBAAMM1,FBAAPTC,FBCNTRA,FBCNTRP,FBV,FBVEN,FTP
"RTN","FBCHEP1",52,0)
 . S ICDVDT=$$FRDTINV^FBCSV1(DA) ;date for files 80 and 80.1 identifier
"RTN","FBCHEP1",53,0)
 . ;get variables for call to PPT^FBAACO1
"RTN","FBCHEP1",54,0)
 . S FBAAMM1=$P($G(^FBAAI(DA,2)),U,3)
"RTN","FBCHEP1",55,0)
 . S FBCNTRP=$P($G(^FBAAI(DA,5)),U,8)
"RTN","FBCHEP1",56,0)
 . S FBV=$P($G(^FBAAI(DA,0)),U,3)
"RTN","FBCHEP1",57,0)
 . S DFN=$P($G(^FBAAI(DA,0)),U,4)
"RTN","FBCHEP1",58,0)
 . S FBAAPTC=$P($G(^FBAAI(DA,0)),U,13)
"RTN","FBCHEP1",59,0)
 . S X=$P($G(^FBAAI(DA,0)),U,5)
"RTN","FBCHEP1",60,0)
 . S:X[";FB583(" FB583=+X
"RTN","FBCHEP1",61,0)
 . S FTP=$S(X]"":+$O(^FBAAA("AG",X,DFN,0)),1:"")
"RTN","FBCHEP1",62,0)
 . S FBVEN=$S(FTP:$P($G(^FBAAA(DFN,1,FTP,0)),U,4),1:"")
"RTN","FBCHEP1",63,0)
 . S FBCNTRA=$S(FTP:$P($G(^FBAAA(DFN,1,FTP,0)),U,22),1:"")
"RTN","FBCHEP1",64,0)
 . D ^DIE
"RTN","FBCHEP1",65,0)
 ; if adjustment data changed then file
"RTN","FBCHEP1",66,0)
 I $$ADJL^FBUTL2(.FBADJ)'=FBADJL(0) D FILEADJ^FBCHFA(FBI_",",.FBADJ)
"RTN","FBCHEP1",67,0)
 ; if remit remark data changed then file
"RTN","FBCHEP1",68,0)
 I $$RRL^FBUTL4(.FBRRMK)'=FBRRMKL(0) D FILERR^FBCHFR(FBI_",",.FBRRMK)
"RTN","FBCHEP1",69,0)
 ; remove any gaps in codes
"RTN","FBCHEP1",70,0)
 D RMVGAP(FBI,1)
"RTN","FBCHEP1",71,0)
 ; if line item rendering providers exist then file FB*3.5*133
"RTN","FBCHEP1",72,0)
 I $D(FBPROV) D FILERP^FBUTL8(FBI_",",.FBPROV)
"RTN","FBCHEP1",73,0)
 K FBAAMM,FBAAMM1
"RTN","FBCHEP1",74,0)
 S FBNK=$P(^FBAAI(FBI,0),"^",9)
"RTN","FBCHEP1",75,0)
 I FBNK-FBK S $P(^FBAA(161.7,FBN,0),"^",9)=FBBAMT+(FBNK-FBK)
"RTN","FBCHEP1",76,0)
END K DA,DFN,DIC,DIE,DR,FBAAOUT,FBDX,FBI,FBIN,FBLISTC,FBN,FBPROC,FBSTAT,FBVEN,FBVID,J,K,L,POP,Q,VA,VADM,X,FBIFN,Y,FBPRICE,FBK,FBNK,FB583,FBAAPN,FBASSOC,FBDEL,FBLOC,DAT
"RTN","FBCHEP1",77,0)
 K CNT,D0,FB7078,FBAABDT,FBAAEDT,FBASSOC,FBAUT,FBLOC,FBPROG,FBPSA,FBPT,FBRR,FBTT,FBTYPE,FBXX,FTP,PI,PTYPE,T,Z,ZZ,F,FBPOV,I,TA,VAL,DUOUT,FBVET,FBBAMT,FBAAI,FBEXMPT,FB1725,FBPAMT
"RTN","FBCHEP1",78,0)
 K FBFPPSC,FBFPPSL,FBADJ,FBADJD,FBRRMK,FBRRMKD,FBIA,FBDODINV
"RTN","FBCHEP1",79,0)
 K FB7078I,FBDFN
"RTN","FBCHEP1",80,0)
 D END^FBCHDI
"RTN","FBCHEP1",81,0)
 Q
"RTN","FBCHEP1",82,0)
 ;
"RTN","FBCHEP1",83,0)
BADDATE(INVRCVDT,TEMPDA) ;Compare edited Invoice Received Date to Treatment Date, reject if before. Called from [FBCH EDIT PAYMENT] template. 
"RTN","FBCHEP1",84,0)
 I INVRCVDT="" Q 0 ;Inv Date not changed, no check necessary
"RTN","FBCHEP1",85,0)
 N TDAT,SHODAT S TDAT=$$GET1^DIQ(162.5,TEMPDA_",",6,"I") I TDAT]"" S SHODAT="TO"
"RTN","FBCHEP1",86,0)
 I TDAT="" S TDAT=$$GET1^DIQ(162.5,TEMPDA_",",5,"I"),SHODAT="FROM"
"RTN","FBCHEP1",87,0)
 I INVRCVDT<TDAT D  Q 1 ;Reject entered date
"RTN","FBCHEP1",88,0)
 .N SHOTDAT S SHOTDAT=$E(TDAT,4,5)_"/"_$E(TDAT,6,7)_"/"_$E(TDAT,2,3) ;Convert TDAT into display format for error message.
"RTN","FBCHEP1",89,0)
 .N MSG1,MSG2 S MSG1="*** Invoice Received Date cannot be before",MSG2=" Treatment "_SHODAT_" Date ("_SHOTDAT_") !!!"
"RTN","FBCHEP1",90,0)
 .W !!?5,*7,MSG1,!?8,MSG2
"RTN","FBCHEP1",91,0)
 Q 0 ;Date entered is OK
"RTN","FBCHEP1",92,0)
 ;
"RTN","FBCHEP1",93,0)
LAST(FBDA,FBNODE) ; Returns number (0-25) of last code in node for invoice
"RTN","FBCHEP1",94,0)
 D RMVGAP(FBDA,0)  ;Insure that gaps were not created outside normal processes
"RTN","FBCHEP1",95,0)
 N FBI,FBRET,FBX
"RTN","FBCHEP1",96,0)
 S FBRET=0
"RTN","FBCHEP1",97,0)
 I FBDA,"^DX^PROC^"[(U_FBNODE_U) D
"RTN","FBCHEP1",98,0)
 . S FBX=$G(^FBAAI(FBDA,FBNODE))
"RTN","FBCHEP1",99,0)
 . F FBI=25:-1:1 I $P(FBX,"^",FBI)'="" S FBRET=FBI Q
"RTN","FBCHEP1",100,0)
 Q FBRET
"RTN","FBCHEP1",101,0)
 ;
"RTN","FBCHEP1",102,0)
RMVGAP(FBDA,FBWRT) ;  Remove gaps in ICD diagnosis and procedure codes
"RTN","FBCHEP1",103,0)
 ; input
"RTN","FBCHEP1",104,0)
 ;   FBDA  IEN of invoice
"RTN","FBCHEP1",105,0)
 ;   FBWRT (optional) =1 if messages can be written to the screen
"RTN","FBCHEP1",106,0)
 ; remove any gaps
"RTN","FBCHEP1",107,0)
 N DXFLD,FBDX,FBFDA,FBI,FBMOVED,FBN,FBPOA,FBPROC,POAFLD,PROCFLD
"RTN","FBCHEP1",108,0)
 D FLDLIST ; get list of field numbers
"RTN","FBCHEP1",109,0)
 ; check diagnosis and POA codes
"RTN","FBCHEP1",110,0)
 S FBDX=$G(^FBAAI(FBDA,"DX"))
"RTN","FBCHEP1",111,0)
 S FBPOA=$G(^FBAAI(FBDA,"POA"))
"RTN","FBCHEP1",112,0)
 S FBMOVED=0
"RTN","FBCHEP1",113,0)
 S FBN=0
"RTN","FBCHEP1",114,0)
 F FBI=1:1:25 D
"RTN","FBCHEP1",115,0)
 . ; JAS - 03/05/14 - Patch 139 (ICD-10 Project) - Modified next line to also quit if 0
"RTN","FBCHEP1",116,0)
 . Q:(($P(FBDX,U,FBI)="")!($P(FBDX,U,FBI)=0))
"RTN","FBCHEP1",117,0)
 . S FBN=FBN+1 ; increment number of diagnosis codes
"RTN","FBCHEP1",118,0)
 . Q:FBI=FBN  ; no gap
"RTN","FBCHEP1",119,0)
 . ; move diagnosis and POA from slot FBI to slot FBN
"RTN","FBCHEP1",120,0)
 . S FBMOVED=1 ; set flag for message
"RTN","FBCHEP1",121,0)
 . K FBFDA
"RTN","FBCHEP1",122,0)
 . S FBFDA(162.5,FBDA_",",$P(DXFLD,U,FBN))=$P(FBDX,U,FBI)
"RTN","FBCHEP1",123,0)
 . S FBFDA(162.5,FBDA_",",$P(POAFLD,U,FBN))=$P(FBPOA,U,FBI)
"RTN","FBCHEP1",124,0)
 . S FBFDA(162.5,FBDA_",",$P(DXFLD,U,FBI))="@"
"RTN","FBCHEP1",125,0)
 . S FBFDA(162.5,FBDA_",",$P(POAFLD,U,FBI))="@"
"RTN","FBCHEP1",126,0)
 . D FILE^DIE("","FBFDA") D:$G(FBWRT) MSG^DIALOG()
"RTN","FBCHEP1",127,0)
 . S $P(FBDX,U,FBN)=$P(FBDX,U,FBI)
"RTN","FBCHEP1",128,0)
 . S $P(FBPOA,U,FBN)=$P(FBPOA,U,FBI)
"RTN","FBCHEP1",129,0)
 . S $P(FBDX,U,FBI)=""
"RTN","FBCHEP1",130,0)
 . S $P(FBPOA,U,FBI)=""
"RTN","FBCHEP1",131,0)
 I $G(FBWRT),FBMOVED W !,"Diagnosis codes were moved to remove gaps"
"RTN","FBCHEP1",132,0)
 ;
"RTN","FBCHEP1",133,0)
 S FBPROC=$G(^FBAAI(FBDA,"PROC"))
"RTN","FBCHEP1",134,0)
 S FBMOVED=0
"RTN","FBCHEP1",135,0)
 S FBN=0
"RTN","FBCHEP1",136,0)
 F FBI=1:1:25 D
"RTN","FBCHEP1",137,0)
 . ; JAS - 03/05/14 - Patch 139 (ICD-10 Project) - Modified next line to also quit if 0
"RTN","FBCHEP1",138,0)
 . Q:(($P(FBPROC,U,FBI)="")!($P(FBPROC,U,FBI)=0))
"RTN","FBCHEP1",139,0)
 . S FBN=FBN+1 ; increment number of procedure codes
"RTN","FBCHEP1",140,0)
 . Q:FBI=FBN  ; no gap
"RTN","FBCHEP1",141,0)
 . ; move procedure from slot FBI to slot FBN
"RTN","FBCHEP1",142,0)
 . S FBMOVED=1
"RTN","FBCHEP1",143,0)
 . K FBFDA
"RTN","FBCHEP1",144,0)
 . S FBFDA(162.5,FBDA_",",$P(PROCFLD,U,FBN))=$P(FBPROC,U,FBI)
"RTN","FBCHEP1",145,0)
 . S FBFDA(162.5,FBDA_",",$P(PROCFLD,U,FBI))="@"
"RTN","FBCHEP1",146,0)
 . D FILE^DIE("","FBFDA") D:$G(FBWRT) MSG^DIALOG()
"RTN","FBCHEP1",147,0)
 . S $P(FBPROC,U,FBN)=$P(FBPROC,U,FBI)
"RTN","FBCHEP1",148,0)
 . S $P(FBPROC,U,FBI)=""
"RTN","FBCHEP1",149,0)
 I $G(FBWRT),FBMOVED W !,"Procedure codes were moved to remove gaps"
"RTN","FBCHEP1",150,0)
 Q
"RTN","FBCHEP1",151,0)
 ;
"RTN","FBCHEP1",152,0)
FLDLIST ; Provide list of fields for diagnosis, POA, and procedures
"RTN","FBCHEP1",153,0)
 S DXFLD="30^31^32^33^34^35^35.1^35.2^35.3^35.4^35.5^35.6^35.7^35.8^35.9^36^36.1^36.2^36.3^36.4^36.5^36.6^36.7^36.8^36.9"
"RTN","FBCHEP1",154,0)
 S POAFLD="30.02^31.02^32.02^33.02^34.02^35.02^35.12^35.22^35.32^35.42^35.52^35.62^35.72^35.82^35.92^36.02^36.12^36.22^36.32^36.42^36.52^36.62^36.72^26.82^36.92"
"RTN","FBCHEP1",155,0)
 S PROCFLD="40^41^42^43^44^44.06^44.07^44.08^44.09^44.1^44.11^44.12^44.13^44.14^44.15^44.16^44.17^44.18^44.19^44.2^44.21^44.22^44.23^44.24^44.25"
"RTN","FBCHEP1",156,0)
 Q
"RTN","FBCHEP1",157,0)
 ;
"RTN","FBCHEP1",158,0)
GETIPAC(FBDA,FBVEN,FBIA,FBDODINV) ; Get vendor/IPAC data for Inpatient (FB*3.5*123)
"RTN","FBCHEP1",159,0)
 ; All parameters required and assumed to exist
"RTN","FBCHEP1",160,0)
 ; Called by $$IPACEDIT^FBAAPET1
"RTN","FBCHEP1",161,0)
 N GX5
"RTN","FBCHEP1",162,0)
 S FBVEN=+$P($G(^FBAAI(FBDA,0)),U,3)    ; vendor ien
"RTN","FBCHEP1",163,0)
 S GX5=$G(^FBAAI(FBDA,5))
"RTN","FBCHEP1",164,0)
 S FBIA=+$P(GX5,U,10)                   ; ipac agreement ien
"RTN","FBCHEP1",165,0)
 S FBDODINV=$P(GX5,U,7)                 ; ipac DoD invoice#
"RTN","FBCHEP1",166,0)
 Q
"RTN","FBCHEP1",167,0)
 ;
"RTN","FBCHEP1",168,0)
DELIPAC(FBDA) ; Delete all IPAC data on file for Inpatient (FB*3.5*123)
"RTN","FBCHEP1",169,0)
 ; Called by $$IPACEDIT^FBAAPET1
"RTN","FBCHEP1",170,0)
 N DIE,DA,DR,DIC
"RTN","FBCHEP1",171,0)
 S DIE=162.5,DA=FBDA,DR="86///@;87///@" D ^DIE
"RTN","FBCHEP1",172,0)
 Q
"RTN","FBCHEP1",173,0)
 ;
"RTN","FBCHFED")
0^7^B10466486^B11304560
"RTN","FBCHFED",1,0)
FBCHFED ;WOIFO/SAB - FPPS DATA EDIT INPATIENT INVOICE ;5/15/14  18:25
"RTN","FBCHFED",2,0)
 ;;3.5;FEE BASIS;**61,154**;JAN 30, 1995;Build 12
"RTN","FBCHFED",3,0)
 ;;Per VA Directive 6402, this routine should not be modified.
"RTN","FBCHFED",4,0)
 ;
"RTN","FBCHFED",5,0)
 S FBAAOUT=0
"RTN","FBCHFED",6,0)
 F  D INVED Q:FBAAOUT
"RTN","FBCHFED",7,0)
 D CLEAN
"RTN","FBCHFED",8,0)
 Q
"RTN","FBCHFED",9,0)
 ;
"RTN","FBCHFED",10,0)
INVED ; Invoice Edit
"RTN","FBCHFED",11,0)
 ;
"RTN","FBCHFED",12,0)
ASKINV ; Select Invoice to Edit
"RTN","FBCHFED",13,0)
 W ! S DIC="^FBAAI(",DIC(0)="AEQZ"
"RTN","FBCHFED",14,0)
 S DIC("S")="I $P($G(^(3)),U)]""""" ; screen on EDI claim
"RTN","FBCHFED",15,0)
 D ^DIC K DIC I Y'>0 S FBAAOUT=1 Q
"RTN","FBCHFED",16,0)
 S FBDA=+Y
"RTN","FBCHFED",17,0)
 ;
"RTN","FBCHFED",18,0)
 I $$CKFPPS^FBFHLL(FBDA)'=1 D  G ASKINV
"RTN","FBCHFED",19,0)
 . W !?5,"Invoice ",FBDA," has not been transmitted to FPPS."
"RTN","FBCHFED",20,0)
 ;
"RTN","FBCHFED",21,0)
 ; save FPPS Claim ID and Line Item data prior to edit session
"RTN","FBCHFED",22,0)
 S (FBFPPSC,FBFPPSC(0))=$P($G(^FBAAI(FBDA,3)),U)
"RTN","FBCHFED",23,0)
 S (FBFPPSL,FBFPPSL(0))=$P($G(^FBAAI(FBDA,3)),U,2)
"RTN","FBCHFED",24,0)
 S FBINVCHG=0 ; initialize invoice changed flag
"RTN","FBCHFED",25,0)
 ;
"RTN","FBCHFED",26,0)
EDITFC ; edit FPPS CLAIM ID
"RTN","FBCHFED",27,0)
 S FBX=$$FPPSC^FBUTL5(1,FBFPPSC)
"RTN","FBCHFED",28,0)
 I FBX=-1 S FBAAOUT=1 G INVEDX
"RTN","FBCHFED",29,0)
 ; need to verify if following restriction is appropriate
"RTN","FBCHFED",30,0)
 I FBX="" D  G EDITFC
"RTN","FBCHFED",31,0)
 . W !,$C(7),"Can not change EDI from YES to NO on invoice that has been sent to FPPS!"
"RTN","FBCHFED",32,0)
 S FBFPPSC=FBX
"RTN","FBCHFED",33,0)
 ;
"RTN","FBCHFED",34,0)
 ; if FPPS CLAIM ID changed, then update file and audit log
"RTN","FBCHFED",35,0)
 I FBFPPSC'=FBFPPSC(0) D
"RTN","FBCHFED",36,0)
 . ; set invoice changed flag
"RTN","FBCHFED",37,0)
 . S FBINVCHG=1
"RTN","FBCHFED",38,0)
 . ;
"RTN","FBCHFED",39,0)
 . ; file data in 162.5
"RTN","FBCHFED",40,0)
 . K FBFDA
"RTN","FBCHFED",41,0)
 . S FBFDA(162.5,FBDA_",",56)=$S(FBFPPSC="":"@",1:FBFPPSC)
"RTN","FBCHFED",42,0)
 . I $D(FBFDA) D FILE^DIE("","FBFDA") D MSG^DIALOG()
"RTN","FBCHFED",43,0)
 . ;
"RTN","FBCHFED",44,0)
 . ; add record to audit log
"RTN","FBCHFED",45,0)
 . K FBFDA
"RTN","FBCHFED",46,0)
 . S FBFDA(163.7,"+1,",.01)=FBDA ; invoice number
"RTN","FBCHFED",47,0)
 . S FBFDA(163.7,"+1,",1)=$$NOW^XLFDT() ; date/time changed
"RTN","FBCHFED",48,0)
 . S FBFDA(163.7,"+1,",2)=162.5 ; file #
"RTN","FBCHFED",49,0)
 . S FBFDA(163.7,"+1,",3)=FBDA_"," ; iens
"RTN","FBCHFED",50,0)
 . S FBFDA(163.7,"+1,",4)=56 ; field #
"RTN","FBCHFED",51,0)
 . S FBFDA(163.7,"+1,",5)=FBFPPSC(0) ; old value
"RTN","FBCHFED",52,0)
 . S FBFDA(163.7,"+1,",6)=FBFPPSC ; new value
"RTN","FBCHFED",53,0)
 . S FBFDA(163.7,"+1,",7)=DUZ ; user
"RTN","FBCHFED",54,0)
 . I $D(FBFDA) D UPDATE^DIE("","FBFDA") D MSG^DIALOG()
"RTN","FBCHFED",55,0)
 ;
"RTN","FBCHFED",56,0)
 ;
"RTN","FBCHFED",57,0)
EDITFL ; edit FPPS Line Item
"RTN","FBCHFED",58,0)
 W !
"RTN","FBCHFED",59,0)
 S FBX=$$FPPSL^FBUTL5(FBFPPSL,1)
"RTN","FBCHFED",60,0)
 I FBX=-1 S FBAAOUT=1 G INVEDX
"RTN","FBCHFED",61,0)
 S FBFPPSL=FBX
"RTN","FBCHFED",62,0)
 ;
"RTN","FBCHFED",63,0)
 ; if FPPS LINE ITEM changed, then update file and audit log
"RTN","FBCHFED",64,0)
 I FBFPPSL'=FBFPPSL(0) D
"RTN","FBCHFED",65,0)
 . ; set invoice changed flag
"RTN","FBCHFED",66,0)
 . S FBINVCHG=1
"RTN","FBCHFED",67,0)
 . ;
"RTN","FBCHFED",68,0)
 . ; file data in 162.5
"RTN","FBCHFED",69,0)
 . K FBFDA
"RTN","FBCHFED",70,0)
 . S FBFDA(162.5,FBDA_",",57)=FBFPPSL
"RTN","FBCHFED",71,0)
 . I $D(FBFDA) D FILE^DIE("","FBFDA") D MSG^DIALOG()
"RTN","FBCHFED",72,0)
 . ;
"RTN","FBCHFED",73,0)
 . ; add record to audit log
"RTN","FBCHFED",74,0)
 . K FBFDA
"RTN","FBCHFED",75,0)
 . S FBFDA(163.7,"+1,",.01)=FBDA ; invoice number
"RTN","FBCHFED",76,0)
 . S FBFDA(163.7,"+1,",1)=$$NOW^XLFDT() ; date/time changed
"RTN","FBCHFED",77,0)
 . S FBFDA(163.7,"+1,",2)=162.5 ; file #
"RTN","FBCHFED",78,0)
 . S FBFDA(163.7,"+1,",3)=FBDA_"," ; iens
"RTN","FBCHFED",79,0)
 . S FBFDA(163.7,"+1,",4)=57 ; field #
"RTN","FBCHFED",80,0)
 . S FBFDA(163.7,"+1,",5)=FBFPPSL(0) ; old value
"RTN","FBCHFED",81,0)
 . S FBFDA(163.7,"+1,",6)=FBFPPSL ; new value
"RTN","FBCHFED",82,0)
 . S FBFDA(163.7,"+1,",7)=DUZ ; user
"RTN","FBCHFED",83,0)
 . I $D(FBFDA) D UPDATE^DIE("","FBFDA") D MSG^DIALOG()
"RTN","FBCHFED",84,0)
 ;
"RTN","FBCHFED",85,0)
INVEDX ; Invoice Edit Exit
"RTN","FBCHFED",86,0)
 ; if invoice changed then queue for retransmit to FPPS
"RTN","FBCHFED",87,0)
 I FBINVCHG D FILEQUE^FBFHLL(FBDA,9)
"RTN","FBCHFED",88,0)
 Q
"RTN","FBCHFED",89,0)
 ;
"RTN","FBCHFED",90,0)
CLEAN K DIC,DIR,DIROUT,DIRUT,DTOUT,DUOUT,X,Y
"RTN","FBCHFED",91,0)
 K FBAAOUT,FBDA,FBFDA,FBFPPSC,FBFPPSL,FBINVCHG,FBX
"RTN","FBCHFED",92,0)
 Q
"RTN","FBCHFED",93,0)
 ;FBCHFED
"RTN","FBCHPET")
0^29^B44036498^B40858494
"RTN","FBCHPET",1,0)
FBCHPET ;AISC/DMK - EDIT ANCILLARY PAYMENT ;10/02/2014
"RTN","FBCHPET",2,0)
 ;;3.5;FEE BASIS;**4,38,61,77,116,108,124,132,123,154**;JAN 30, 1995;Build 12
"RTN","FBCHPET",3,0)
 ;;Per VA Directive 6402, this routine should not be modified.
"RTN","FBCHPET",4,0)
 S FY=$E(DT,1,3)+1700+$S($E(4,5)>9:1,1:0)
"RTN","FBCHPET",5,0)
GETPT I $G(BAT) D
"RTN","FBCHPET",6,0)
 .I '$D(^FBAAC("AC",+BAT)) F I=9,10,11 S $P(^FBAA(161.7,+BAT,0),U,I)=""
"RTN","FBCHPET",7,0)
 .I $D(^FBAAC("AC",+BAT)) D  S $P(^FBAA(161.7,+BAT,0),U,11)=I,$P(^(0),U,9)=$G(FBTOT) K I,FBTOT
"RTN","FBCHPET",8,0)
 ..N J,K,L,M S (I,J,K,L,M,FBTOT)=0
"RTN","FBCHPET",9,0)
 ..F  S J=$O(^FBAAC("AC",+BAT,J)) Q:'J  F  S K=$O(^FBAAC("AC",+BAT,J,K)) Q:'K  F  S L=$O(^FBAAC("AC",+BAT,J,K,L)) Q:'L  F  S M=$O(^FBAAC("AC",+BAT,J,K,L,M)) Q:'M  I $D(^FBAAC(J,1,K,1,L,1,M,0)) S I=I+1,FBTOT=FBTOT+$P(^(0),U,3)
"RTN","FBCHPET",10,0)
 W !! S DIC="^FBAAC(",DIC(0)="AEQM" D ^DIC G END:X="^"!(X=""),GETPT:Y<0 S (DFN,FBDA(3))=+Y
"RTN","FBCHPET",11,0)
 S:'$D(^FBAAC(DFN,1,0)) ^FBAAC(DFN,1,0)="^162.01P^0^0"
"RTN","FBCHPET",12,0)
 S DIC=DIC_DFN_",1,"
"RTN","FBCHPET",13,0)
GETVD W !! S DIC(0)="AEQM" D ^DIC G GETPT:X="^"!(X=""),GETVD:Y<0 S (FBV,FBVD,FBDA(2))=+Y
"RTN","FBCHPET",14,0)
 S:'$D(^FBAAC(DFN,1,FBDA(2),1,0)) ^FBAAC(DFN,1,FBDA(2),1,0)="^162.02DA^0^0"
"RTN","FBCHPET",15,0)
 S DIC=DIC_FBVD_",1,"
"RTN","FBCHPET",16,0)
GETDT S DIC(0)="AEQM",DIC("A")="Date of Service: " D ^DIC K DIC("A") G GETPT:X="^"!(X=""),GETDT:Y<0 S (FBSD,FBSDI,FBDA(1))=+Y,FBAADT=$P(Y,U,2) S:'$D(^FBAAC(DFN,1,FBDA(2),1,FBDA(1),1,0)) ^FBAAC(DFN,1,FBDA(2),1,FBDA(1),1,0)="^162.03A^0^0"
"RTN","FBCHPET",17,0)
 S FBZ=DIC_FBSD_",1,"
"RTN","FBCHPET",18,0)
SERV S DA(3)=FBDA(3),DA(2)=FBDA(2),DA(1)=FBDA(1)
"RTN","FBCHPET",19,0)
 S DIC("W")="N FBX S FBX=$$MODL^FBAAUTL4(""^FBAAC(FBDA(3),1,FBDA(2),1,FBDA(1),1,+Y,""""M"""")"",""E"") W:FBX]"""" ""    CPT Modifier(s): "",FBX Q"
"RTN","FBCHPET",20,0)
 S DIC=FBZ,DIC(0)="AEQMZ"
"RTN","FBCHPET",21,0)
 D
"RTN","FBCHPET",22,0)
 . N ICPTVDT S ICPTVDT=$G(FBAADT) D ^DIC
"RTN","FBCHPET",23,0)
 G GETPT:X="^"!(X=""),SERV:Y<0 S (FBSV,FBAACPI,FBDA)=+Y,BAT=$P(Y(0),U,8),FBDUZ=$P(Y(0),U,7),(FBAACP,FBAACP(0))=$P(Y,U,2),K=$P(Y(0),U,3),FBAAPTC=$P(Y(0),U,20),J(0)=$P(Y(0),U,2)
"RTN","FBCHPET",24,0)
 ;
"RTN","FBCHPET",25,0)
 ; enforce separation of duties
"RTN","FBCHPET",26,0)
 S FTP=$P($G(^FBAAC(FBDA(3),1,FBDA(2),1,FBDA(1),1,FBDA,3)),U,9)
"RTN","FBCHPET",27,0)
 I '$$UOKPAY^FBUTL9(DFN,FTP) D  G GETPT
"RTN","FBCHPET",28,0)
 . W !!,"You cannot process a payment associated with authorization ",DFN,"-",FTP
"RTN","FBCHPET",29,0)
 . W !,"due to separation of duties."
"RTN","FBCHPET",30,0)
 ;
"RTN","FBCHPET",31,0)
 ; set FB1725 true (1) if payment is for a Mill Bill claim
"RTN","FBCHPET",32,0)
 S FB1725=$S($P(Y(0),U,13)["FB583":+$P($G(^FB583(+$P(Y(0),U,13),0)),U,28),1:0)
"RTN","FBCHPET",33,0)
 I FBDUZ'=DUZ&('$D(^XUSEC("FBAA LEVEL 2",DUZ))) W !!,*7,"Sorry,only the clerk who entered the payment or",!," a holder of the FBAA LEVEL 2 key can edit this payment." G GETPT
"RTN","FBCHPET",34,0)
 ;S FBAAMM1=$P($G(^FBAAC(FBDA(3),1,FBDA(2),1,FBDA(1),1,FBDA,2)),U,2)
"RTN","FBCHPET",35,0)
 S FBFSAMT(0)=$P($G(^FBAAC(FBDA(3),1,FBDA(2),1,FBDA(1),1,FBDA,2)),U,12)
"RTN","FBCHPET",36,0)
 ; determine lesser of original fee schedule amount and amount claimed
"RTN","FBCHPET",37,0)
 S FBAMTPD(0)=$S(FBFSAMT(0)="":J(0),FBFSAMT(0)>J(0):J(0),1:FBFSAMT(0))
"RTN","FBCHPET",38,0)
 S FBMODL=$$MODL^FBAAUTL4("^FBAAC("_FBDA(3)_",1,"_FBDA(2)_",1,"_FBDA(1)_",1,"_FBDA_",""M"")")
"RTN","FBCHPET",39,0)
 ; load current adjustment data
"RTN","FBCHPET",40,0)
 D LOADADJ^FBAAFA(FBDA_","_FBDA(1)_","_FBDA(2)_","_FBDA(3)_",",.FBADJ)
"RTN","FBCHPET",41,0)
 ; save adjustment data prior to edit session in sorted list
"RTN","FBCHPET",42,0)
 S FBADJL(0)=$$ADJL^FBUTL2(.FBADJ) ; sorted list of original adjustments
"RTN","FBCHPET",43,0)
 ; load current remittance remark data
"RTN","FBCHPET",44,0)
 D LOADRR^FBAAFR(FBDA_","_FBDA(1)_","_FBDA(2)_","_FBDA(3)_",",.FBRRMK)
"RTN","FBCHPET",45,0)
 ; save remittance remarks prior to edit session in sorted list
"RTN","FBCHPET",46,0)
 S FBRRMKL(0)=$$RRL^FBUTL4(.FBRRMK)
"RTN","FBCHPET",47,0)
 S FBFPPSC(0)=$P($G(^FBAAC(FBDA(3),1,FBDA(2),1,FBDA(1),1,FBDA,3)),U)
"RTN","FBCHPET",48,0)
 S FBFPPSC=FBFPPSC(0)
"RTN","FBCHPET",49,0)
 S FBFPPSL(0)=$P($G(^FBAAC(FBDA(3),1,FBDA(2),1,FBDA(1),1,FBDA,3)),U,2)
"RTN","FBCHPET",50,0)
 S FBFPPSL=FBFPPSL(0)
"RTN","FBCHPET",51,0)
 G:BAT']"" EDIT
"RTN","FBCHPET",52,0)
 ; check batch status
"RTN","FBCHPET",53,0)
 S FBSTAT=$P($G(^FBAA(161.7,BAT,"ST")),U) ; batch status
"RTN","FBCHPET",54,0)
 I FBSTAT="S",'$D(^XUSEC("FBAA LEVEL 2",DUZ)) W !!,*7,"Sorry, only a holder of the FBAA LEVEL 2 key can edit a payment",!," once the batch has been released." G GETPT
"RTN","FBCHPET",55,0)
 I "^T^F^V^"[(U_FBSTAT_U) W !!,*7,"Sorry, you cannot edit a payment when the batch has been sent to Austin." G GETPT
"RTN","FBCHPET",56,0)
 K FBSTAT
"RTN","FBCHPET",57,0)
EDIT S DA=FBSV
"RTN","FBCHPET",58,0)
 ;
"RTN","FBCHPET",59,0)
 ; first edit CPT code and modifiers
"RTN","FBCHPET",60,0)
 D CPTM^FBAALU(FBAADT,DFN,FBAACP(0),FBMODL) I '$G(FBGOT) G GETPT
"RTN","FBCHPET",61,0)
 ; if CPT was changed then update file
"RTN","FBCHPET",62,0)
 I FBAACP'=FBAACP(0) D  I FBAACP="@" G GETPT
"RTN","FBCHPET",63,0)
 . N FBIENS,FBFDA
"RTN","FBCHPET",64,0)
 . S FBIENS=FBDA_","_FBDA(1)_","_FBDA(2)_","_FBDA(3)_","
"RTN","FBCHPET",65,0)
 . S FBFDA(162.03,FBIENS,.01)=FBAACP
"RTN","FBCHPET",66,0)
 . D FILE^DIE("","FBFDA") D MSG^DIALOG()
"RTN","FBCHPET",67,0)
 ; if modifiers changed then update file
"RTN","FBCHPET",68,0)
 I FBMODL'=$$MODL^FBAAUTL4("FBMODA") D REPMOD^FBAAUTL4(FBDA(3),FBDA(2),FBDA(1),FBDA)
"RTN","FBCHPET",69,0)
 ;
"RTN","FBCHPET",70,0)
 ; Check for IPAC data requirements for Federal Vendors (FB*3.5*123)
"RTN","FBCHPET",71,0)
 I '$$IPACEDIT^FBAAPET1(162.03,.FBDA) G SERV
"RTN","FBCHPET",72,0)
 ;
"RTN","FBCHPET",73,0)
 ; now edit remaining fields
"RTN","FBCHPET",74,0)
 S DIE("NO^")=""
"RTN","FBCHPET",75,0)
 S DR="48;47;S FBUNITS=X;42R;S FBZIP=X;S:$$ANES^FBAAFS($$CPT^FBAAUTL4(FBAACP)) Y=""@2"";43///@;S FBTIME=X;S Y=""@3"";@2;43R;S FBTIME=X;@3"
"RTN","FBCHPET",76,0)
 ; fb*3.5*116 remove edit of interest indicator (162.03,34) to prevent different interest indicator values at line item level; interest indicator set at invoice level only;
"RTN","FBCHPET",77,0)
 ;S DR(1,162.03,1)="S FBAAMM=$S(FBAAPTC=""R"":"""",1:1);D PPT^FBAACO1(FBAAMM1);30R;S FBHCFA(30)=X;1;S J=X;Q"
"RTN","FBCHPET",78,0)
 S DR(1,162.03,1)="S FBAAMM=$S(FBAAPTC=""R"":"""",$D(FB583):"""",1:1);D PPT^FBAACO1(FBAAMM1,FBCNTRP,1);54///@;54////^S X=$G(FBCNTRP);30R;S FBHCFA(30)=X;1;S J=X;Q"
"RTN","FBCHPET",79,0)
 S DR(1,162.03,2)="D FEEDT^FBAACO3;44///@;44///^S X=FBFSAMT;45///@;45///^S X=FBFSUSD;S:FBAMTPD'>0!(FBAMTPD=FBAMTPD(0)) Y=""@4"";2///^S X=FBAMTPD;@4;2//^S X=FBAMTPD;S K=X"
"RTN","FBCHPET",80,0)
 ;S DR(1,162.03,3)="3////^S X=$S(J-K:J-K,1:"""");I X S Y=""@11"";4////@;S Y=""@5"";@11;3R;4R;S:X'=4 Y=""@5"";22;K FBADJD;M FBADJD=FBADJ;S FBX=$$ADJ^FBUTL2(J-K,.FBADJ,2,,.FBADJD,1)"
"RTN","FBCHPET",81,0)
 S DR(1,162.03,3)="K FBADJD;M FBADJD=FBADJ;S FBX=$$ADJ^FBUTL2(J-K,.FBADJ,2,,.FBADJD,1)"
"RTN","FBCHPET",82,0)
 S DR(1,162.03,4)="S FBX=$$FPPSC^FBUTL5(1,FBFPPSC);S:FBX=-1 Y=0;S:FBX="""" Y=""@5"";50///^S X=FBX;S FBFPPSC=X;S FBX=$$FPPSL^FBUTL5(FBFPPSL);S:FBX=-1 Y=0;51///^S X=FBX;S FBFPPCL=X;S Y=""@55"";@5;50///@;S FBFPPSC="""";51///@;S FBFPPCL="""";@55"
"RTN","FBCHPET",83,0)
 S DR(1,162.03,5)="@5;K DIE(""NO^"");W !,""Exit ('^') allowed now"";26;S PRC(""SITE"")=X;8;@13;13;I $$BADDATE^FBCHPET(FBAADT,X) S Y=""@13"";Q;33;49"
"RTN","FBCHPET",84,0)
 S DR(1,162.03,6)="15;16;17////^S X=1"
"RTN","FBCHPET",85,0)
 S DR(1,162.03,7)="@7;K FBRRMKD;M FBRRMKD=FBRRMK;S FBX=$$RR^FBUTL4(.FBRRMK,2,,.FBRRMKD)"
"RTN","FBCHPET",86,0)
 S DIE=FBZ
"RTN","FBCHPET",87,0)
 D
"RTN","FBCHPET",88,0)
 . N ICPTVDT,ICDVDT,FB583,FBAAMM,FBAAMM1,FBCNTRA,FBCNTRP,FBVEN,FTP
"RTN","FBCHPET",89,0)
 . S (ICPTVDT,ICDVDT)=$G(FBAADT)
"RTN","FBCHPET",90,0)
 . ; set variables for call to PPT^FBAACO1
"RTN","FBCHPET",91,0)
 . S FBAAMM1=$P($G(^FBAAC(FBDA(3),1,FBDA(2),1,FBDA(1),1,FBDA,2)),U,2)
"RTN","FBCHPET",92,0)
 . S FBCNTRP=$P($G(^FBAAC(FBDA(3),1,FBDA(2),1,FBDA(1),1,FBDA,3)),U,8)
"RTN","FBCHPET",93,0)
 . S X=$P($G(^FBAAC(FBDA(3),1,FBDA(2),1,FBDA(1),1,FBDA,0)),U,13)
"RTN","FBCHPET",94,0)
 . S:X[";FB583(" FB583=+X
"RTN","FBCHPET",95,0)
 . S FTP=$P($G(^FBAAC(FBDA(3),1,FBDA(2),1,FBDA(1),1,FBDA,3)),U,9)
"RTN","FBCHPET",96,0)
 . S FBVEN=$S(FTP:$P($G(^FBAAA(DFN,1,FTP,0)),U,4),1:"")
"RTN","FBCHPET",97,0)
 . S FBCNTRA=$S(FTP:$P($G(^FBAAA(DFN,1,FTP,0)),U,22),1:"")
"RTN","FBCHPET",98,0)
 . D ^DIE
"RTN","FBCHPET",99,0)
 ; if adjustment data changed then file
"RTN","FBCHPET",100,0)
 I $$ADJL^FBUTL2(.FBADJ)'=FBADJL(0) D FILEADJ^FBAAFA(FBDA_","_FBDA(1)_","_FBDA(2)_","_FBDA(3)_",",.FBADJ)
"RTN","FBCHPET",101,0)
 ; if remit remark data changed then file
"RTN","FBCHPET",102,0)
 I $$RRL^FBUTL4(.FBRRMK)'=FBRRMKL(0) D FILERR^FBAAFR(FBDA_","_FBDA(1)_","_FBDA(2)_","_FBDA(3)_",",.FBRRMK)
"RTN","FBCHPET",103,0)
 ; if FPPS CLAIM ID changed, update other line items on invoice
"RTN","FBCHPET",104,0)
 I FBFPPSC'=FBFPPSC(0) D
"RTN","FBCHPET",105,0)
 . N FBAAIN
"RTN","FBCHPET",106,0)
 . S FBAAIN=$$GET1^DIQ(162.03,FBDA_","_FBDA(1)_","_FBDA(2)_","_FBDA(3)_",",14)
"RTN","FBCHPET",107,0)
 . D CKINVEDI^FBAAPET1(FBFPPSC(0),FBFPPSC,FBAAIN,FBDA_","_FBDA(1)_","_FBDA(2)_","_FBDA(3)_",")
"RTN","FBCHPET",108,0)
 K FBSV W !! G SERV
"RTN","FBCHPET",109,0)
 ;
"RTN","FBCHPET",110,0)
BADDATE(FBDOS,INVRCVDT) ;Reject entry if InvRcvDt is Prior to the Date of Service on the Invoice
"RTN","FBCHPET",111,0)
 I INVRCVDT<FBDOS D  Q 1 ;Reject entry
"RTN","FBCHPET",112,0)
 .N SHOWDOS S SHOWDOS=$E(FBDOS,4,5)_"/"_$E(FBDOS,6,7)_"/"_$E(FBDOS,2,3) ;Convert FBDOS into display format for error message
"RTN","FBCHPET",113,0)
 .W *7,!!?5,"*** Invoice Received Date cannot be prior to the",!?8,"Date of Service ("_SHOWDOS_") !!!"
"RTN","FBCHPET",114,0)
 Q 0 ;Accept entry
"RTN","FBCHPET",115,0)
 ;
"RTN","FBCHPET",116,0)
END K DR,DIC,DIE,X,DFN,FBVD,FBSD,BAT,FBSV,DA,FBDA,FBZ,FBDUZ,FBAACP,FBFY,FY,FBAMTPD,J,K,Y,PRC,FBHOLDX,ZZ,FBAADT,FBV,FBSDI,FBAACPI
"RTN","FBCHPET",117,0)
 K FBAAMM,FBAAMM1,FBFSAMT,FBFSUSD,FBMODA,FBZIP,FBTIME,FBHCFA(30)
"RTN","FBCHPET",118,0)
 K FBAAPTC,FB1725
"RTN","FBCHPET",119,0)
 K FBADJ,FBADJD,FBADJL,FBRRMK,FBRRMKD,FBRRMKL,FBX,FBUNITS,FTP
"RTN","FBCHPET",120,0)
 Q
"RTN","FBCHREQ")
0^43^B24998930^B21446375
"RTN","FBCHREQ",1,0)
FBCHREQ ;AISC/DMK - USED FOR FEE NOTIFICATION/REQUEST ;1/22/15  12:14
"RTN","FBCHREQ",2,0)
 ;;3.5;FEE BASIS;**154**;JAN 30, 1995;Build 12
"RTN","FBCHREQ",3,0)
 ;;Per VA Directive 6402, this routine should not be modified.
"RTN","FBCHREQ",4,0)
ADD ;Entry point for entering a notification/request
"RTN","FBCHREQ",5,0)
 D FEE^DGREG G END:'$D(DFN)
"RTN","FBCHREQ",6,0)
 W ! S DIC="^FBAA(162.2,",DIC(0)="AQLMZ",DLAYGO=162.2,DIC("S")="I $P(^(0),U,4)=DFN" D ^DIC K DIC("S")
"RTN","FBCHREQ",7,0)
 G END:X=""!(X="^"),ADD:Y<0 S FBDA=+Y,FBN=$P(Y,"^",3)
"RTN","FBCHREQ",8,0)
 W *7,?55,$$DATX^FBAAUTL($P(Y,"^",2))
"RTN","FBCHREQ",9,0)
 I FBN="",$P(Y(0),U,15)=3 W !,*7,"This notification has a status of complete.  Cannot edit.",! K FBN D END G ADD
"RTN","FBCHREQ",10,0)
 I FBN="" S FBCHVEN=$P(^FBAA(162.2,FBDA,0),"^",2)
"RTN","FBCHREQ",11,0)
 D VENDOR^FBCHREQ1:FBN I '$D(FBCHVEN) S DA=FBDA G EN^FBCHREQ1
"RTN","FBCHREQ",12,0)
 W ! S DIE="^FBAA(162.2,",DA=FBDA,DR="[FBCH ENTER REQUEST]" D ^DIE
"RTN","FBCHREQ",13,0)
 G END:'$D(DA) I FBN G:$D(Y)'=0!($G(FBOUT)) EN^FBCHREQ1
"RTN","FBCHREQ",14,0)
 I FBLG>0 W !,*7,"Admission overlaps another request for this patient.",! G EN^FBCHREQ1
"RTN","FBCHREQ",15,0)
 D
"RTN","FBCHREQ",16,0)
 . N FBTXT,FBX
"RTN","FBCHREQ",17,0)
 . S FBTXT=$S(FBN:"Enter",1:"Edit")_" CH notification."
"RTN","FBCHREQ",18,0)
 . S FBX=$$ADDUA^FBUTL9(162.2,FBDA_",",FBTXT)
"RTN","FBCHREQ",19,0)
 . I 'FBX W !,"Error adding record in User Audit. Please contact IRM."
"RTN","FBCHREQ",20,0)
 I FBUP W !!,?15,"REPORT OF CONTACT INFORMATION",! D ^FBCHROC
"RTN","FBCHREQ",21,0)
 K DIC,DIE,DLAYGO,DA,DR,DFN,FBAUT,FBBEGDT,FBFLAG,FBLG,FBOUT,FBPROG,FBVT,Z,FBN,FBSW,VAL,FBX,HY,FBUP,FBAAPN,FBDA,FBDEL,FBPER,J,VA,X,X1,X2,D,FBCHTEL,FBCHVEN,FBDATE,FBVD,FBZZ,Y,ZZZ,FBDOA
"RTN","FBCHREQ",22,0)
 Q
"RTN","FBCHREQ",23,0)
 ;
"RTN","FBCHREQ",24,0)
LENT ;Entry point for enter/edit legal entitlement
"RTN","FBCHREQ",25,0)
 S DIC("S")="I $P(^(0),U,15)'=3" D ASKV G END:X="^"!(X="") S FBLENT=""
"RTN","FBCHREQ",26,0)
LENT1 S DFN=+$P(^FBAA(162.2,DA,0),"^",4),X=$G(^DPT(DFN,.361))
"RTN","FBCHREQ",27,0)
 I $P(X,"^")="" W !!,?10,"ELIGIBILITY HAS NOT BEEN DETERMINED NOR PENDING",!,?10,"CANNOT ENTER ENTITLEMENT." G END
"RTN","FBCHREQ",28,0)
ELIG I $D(^DPT(DFN,.32)),$P(^(.32),"^",4)=2 W !,?4,"VETERAN HAS A DISHONORABLE DISCHARGE, " S X=$S($D(^(.321)):$P(^(.321),"^",1),1:"") W $S(X="Y":"ONLY ELIGIBLE FOR AGENT ORANGE EXAM.",1:"NOT ELIGIBLE FOR BENEFITS.")
"RTN","FBCHREQ",29,0)
 I "N"[$E(X) S DIR(0)="Y",DIR("A")="Do you want to continue",DIR("B")="NO" D ^DIR K DIR G END:$D(DIRUT) I 'Y D INELI G END
"RTN","FBCHREQ",30,0)
 W !! S DIE=DIC,DR="8;S FBLENT=X;S:FBLENT']"""" Y=0;S:FBLENT=""Y"" Y=9;11///^S X=""N"";12////^S X=DT;14;S:X'=4 Y=9;15;9////^S X=DT;10////^S X=DUZ;100////^S X=$S(FBLENT=""N"":3,1:2)" D ^DIE
"RTN","FBCHREQ",31,0)
 D
"RTN","FBCHREQ",32,0)
 . N FBX
"RTN","FBCHREQ",33,0)
 . S FBX=$$ADDUA^FBUTL9(162.2,DA_",","Legal entitlement.")
"RTN","FBCHREQ",34,0)
 . I 'FBX W !,"Error adding record in User Audit. Please contact IRM."
"RTN","FBCHREQ",35,0)
 G END:FBLENT="N"!(FBLENT="")
"RTN","FBCHREQ",36,0)
 ;
"RTN","FBCHREQ",37,0)
ASK S DIR(0)="Y",DIR("A")="Do you want to determine Medical Entitlement now",DIR("B")="YES" D ^DIR K DIR G END:$D(DIRUT)!'Y,MENT1:Y
"RTN","FBCHREQ",38,0)
 Q
"RTN","FBCHREQ",39,0)
 ;
"RTN","FBCHREQ",40,0)
MENT ;Entry point for enter/edit medical entitlement
"RTN","FBCHREQ",41,0)
 S DIC("S")="S FZ=^(0) I $P(FZ,U,9)=""Y""&($P(FZ,U,17)="""")&($S($P(FZ,U,12)="""":1,$P(FZ,U,12)=""Y"":1,1:0)) K FZ"
"RTN","FBCHREQ",42,0)
 D ASKV G END:X="^"!(X="")
"RTN","FBCHREQ",43,0)
MENT1 S FBMENT="" W !! S DIE=DIC,DR="11;S FBMENT=X;S:FBMENT']"""" Y=0;12////^S X=DT;S:FBMENT=""Y"" Y=13;14;S:X'=4 Y=13;15;13////^S X=DUZ;100////^S X=3" D ^DIE
"RTN","FBCHREQ",44,0)
 D
"RTN","FBCHREQ",45,0)
 . N FBX
"RTN","FBCHREQ",46,0)
 . S FBX=$$ADDUA^FBUTL9(162.2,DA_",","Medical entitlement.")
"RTN","FBCHREQ",47,0)
 . I 'FBX W !,"Error adding record in User Audit. Please contact IRM."
"RTN","FBCHREQ",48,0)
 ;
"RTN","FBCHREQ",49,0)
SETUP I FBMENT="Y" S DIR(0)="Y",DIR("A")="Do you want to setup a 7078 now",DIR("B")="NO" D ^DIR K DIR G END:$D(DIRUT)!'Y,EN^FBCH78:Y
"RTN","FBCHREQ",50,0)
END K DA,FBAUT,FBBEGDT,FBDA,FBOUT,FBFLAG,FBLG,FBPROG,FBVT,Z,FBADA,FBV,FBVT,FBLENT,FBDFN,FBNAME,FBSSN,FBMENT,FBX,DIC,DIE,DR,DLAYGO,D,DFN,VAL,X,Y,FBSUSP,FBUP,FBPHY,FBCHTEL,FBAAPN,FBAADT,DF,FBAUT,FBBEGDT,FBCHVEN,FBDEL,FBFLAG
"RTN","FBCHREQ",51,0)
 K FB,FB1,FBOUT,FBPER,FBPROG,FBSW,FBVD,VAL,D0,S,A,DIRUT,DUOUT,DTOUT,FBDOA,FBADDT
"RTN","FBCHREQ",52,0)
 Q
"RTN","FBCHREQ",53,0)
 ;
"RTN","FBCHREQ",54,0)
ASKV ;Look-Up call by veteran for file 162.2
"RTN","FBCHREQ",55,0)
 W ! S DIC="^FBAA(162.2,",DIC(0)="AEQMZ",DIC("A")="Select Patient: ",D="D" D IX^DIC K DIC("A"),DIC("S"),D Q:X="^"!(X="")  G ASKV:Y<0 S (DA,FBDA)=+Y
"RTN","FBCHREQ",56,0)
 S FBDFN=+$P(Y(0),"^",4) I $D(^DPT(FBDFN,0)) S FBNAME=$P(^(0),"^"),FBSSN=$TR($$SSN^FBAAUTL(FBDFN),"-","") Q
"RTN","FBCHREQ",57,0)
 Q
"RTN","FBCHREQ",58,0)
 ;
"RTN","FBCHREQ",59,0)
CHEK ;Check for another request for same pt. not completed
"RTN","FBCHREQ",60,0)
 S FBVT=DFN I $D(^FB7078("AC","I",FBVT)) S FB7078=$O(^FB7078("AC","I",FBVT,0)),FB7078=$S($D(^FB7078(FB7078,0)):$P(^(0),"^",1),1:"") G KILL
"RTN","FBCHREQ",61,0)
 Q
"RTN","FBCHREQ",62,0)
 ;
"RTN","FBCHREQ",63,0)
KILL W !!,"There is an incomplete 7078 for this patient.",!,"The reference number is "_FB7078 S DIK="^FBAA(162.2," D ^DIK S Y=0 W !!,?19,"< NEW REQUEST DELETED >" K FB7078,FBVT,DFN,DIK,DA,D,FBN Q
"RTN","FBCHREQ",64,0)
 ;
"RTN","FBCHREQ",65,0)
INELI S DIR(0)="162.2,14" D ^DIR G END:$D(DUOUT)!$D(DTOUT)
"RTN","FBCHREQ",66,0)
 S FBSUSP=+Y G END:X=""!(X="^"),INELI:Y<0
"RTN","FBCHREQ",67,0)
 S DIE=DIC,DR="12////^S X=DT;7////^S X=DUZ;8////^S X=""N"";14////^S X=FBSUSP;S:X'=4 Y=9;15;9////^S X=DT;10////^S X=DUZ;11////^S X=""N"";100////^S X=3" D ^DIE Q
"RTN","FBCHREQ",68,0)
 ;
"RTN","FBCHREQ",69,0)
OUTP ;Entry to inquire about a notification/request
"RTN","FBCHREQ",70,0)
 D ASKV G END:X="^"!(X="") W !! S DR="0:99" D EN^DIQ
"RTN","FBCHREQ",71,0)
 G OUTP
"RTN","FBCHREQ1")
0^44^B15968034^B14681978
"RTN","FBCHREQ1",1,0)
FBCHREQ1 ;AISC/DMK - FEE NOTIFICATION CONT ;1/20/2015
"RTN","FBCHREQ1",2,0)
 ;;3.5;FEE BASIS;**103,146,154**;JAN 30, 1995;Build 12
"RTN","FBCHREQ1",3,0)
 ;;Per VA Directive 6402, this routine should not be modified.
"RTN","FBCHREQ1",4,0)
VENDOR ;ASK VENDOR FOR NOTIFICATION
"RTN","FBCHREQ1",5,0)
 W ! K FBCHVEN S DIC="^FBAAV(",DIC(0)="AEQLM",DLAYGO=161.2 D ^DIC G END:X=""!(X="^"),VENDOR:Y<0 S (DA,FBCHVEN)=+Y,DIE=DIC I $P(Y,"^",3)=1 S FBVENEW=1 D NEW^FBAAVD K DIC,DIE,DA,DLAYGO Q
"RTN","FBCHREQ1",6,0)
ASKVOK I '$D(FBVENEW) D EN1^FBAAVD S DIR(0)="Y",DIR("A")="Is this the correct vendor",DIR("B")="YES" D ^DIR K DIR G VENDOR:$D(DIRUT)!'Y
"RTN","FBCHREQ1",7,0)
END K DIC,DIE,DLAYGO
"RTN","FBCHREQ1",8,0)
 Q
"RTN","FBCHREQ1",9,0)
TIMCK ;72 hour time check called from FBAA ENTER REQUEST template
"RTN","FBCHREQ1",10,0)
 S X1=$P(^FBAA(162.2,DA,0),"^",1),X=$P(^(0),"^",19),HY=Y,FBSW=""
"RTN","FBCHREQ1",11,0)
 S Y=$E(X1_"000",9,10)-$E(X_"000",9,10)*60+$E(X1_"00000",11,12)-$E(X_"00000",11,12),X2=X,X=$P(X,".",1)'=$P(X1,".",1) D ^%DTC:X S FBX=X*1440+Y
"RTN","FBCHREQ1",12,0)
SURE I FBX>4320 W *7,!!,"This Authorization From Date exceeds the 72 hour notification period. ",!,?8,"Do you want to continue ? No// " R X:DTIME S:X="" X="N" G HELP:X["^" D VALCK^FBAAUTL1 G SURE:'VAL I "Nn"[$E(X,1) S FBSW=1,Y=HY Q
"RTN","FBCHREQ1",13,0)
 S Y=HY Q
"RTN","FBCHREQ1",14,0)
HELP W !,"Entering an '^' is not allowed.  Please answer 'Yes' or 'No'." G SURE
"RTN","FBCHREQ1",15,0)
EN I $D(DA),DA S FBDA(0)=DA,DIE="^FBAA(162.2,",DIDEL=162.2,DR=".01////@" D ^DIE K DIDEL
"RTN","FBCHREQ1",16,0)
 I '$D(DA)  W *7,!?3,"...request deleted",! I $D(^FBAA(161.5,FBDA(0),0)) S DA=FBDA(0),DIK="^FBAA(161.5," D ^DIK
"RTN","FBCHREQ1",17,0)
 K DIC,DIE,DIK,DA,X,FBDA,DR,DLAYGO,FBDATE,FBLG,FBN,FBUP,FBVT,VA D END^FBCHREQ
"RTN","FBCHREQ1",18,0)
 Q
"RTN","FBCHREQ1",19,0)
EDIT ;EDIT A REQUEST THAT'S NOT COMPLETE
"RTN","FBCHREQ1",20,0)
 S DIC("S")="I $P(^(0),U,15)'=3" D ASKV^FBCHREQ K DIC("S") G Q:X=""!(X="^") S DA=+Y,FB(0)=^FBAA(162.2,DA,0),FBDOA=$P(FB(0),"^",19),FBFRDT=$P(FB(0),"^",5)
"RTN","FBCHREQ1",21,0)
 S FB(1)=$G(^FBAA(162.2,DA,1))
"RTN","FBCHREQ1",22,0)
 ; fb*3.5*103  add REFERRING PROVIDER (162.2,17) to DR string
"RTN","FBCHREQ1",23,0)
 S DIE="^FBAA(162.2,",DR="1;2;3.5;S:X=FBDOA!(X<FBFRDT) Y=""@10"";S FBDOA=X;4////^S X=FBDOA;I 1;@10;4;5;17;I $G(X) W !,""REFERRING PROVIDER NPI: "",$$REFNPI^FBCH78(X);6;S FBCHVEN=X" D ^DIE S FBN(0)=^FBAA(162.2,DA,0)
"RTN","FBCHREQ1",24,0)
 S FBN(1)=$G(^FBAA(162.2,DA,1))
"RTN","FBCHREQ1",25,0)
 I FB(0)'=FBN(0)!(FB(1)'=FBN(1)) D
"RTN","FBCHREQ1",26,0)
 . S DR="7////^S X=DUZ" D ^DIE
"RTN","FBCHREQ1",27,0)
 . N FBX
"RTN","FBCHREQ1",28,0)
 . S FBX=$$ADDUA^FBUTL9(162.2,DA_",","Edit CH notification.")
"RTN","FBCHREQ1",29,0)
 . I 'FBX W !,"Error adding record in User Audit. Please contact IRM."
"RTN","FBCHREQ1",30,0)
 I $D(DA),$D(^FBAA(161.5,DA,0)) D
"RTN","FBCHREQ1",31,0)
 .I FB(0)'=FBN(0) S $P(^FBAA(161.5,DA,0),"^",2)=$P(FBN(0),"^",2),$P(^(0),"^",5)=$P(FBN(0),"^",5),$P(^FBAA(161.5,DA,1),"^",7)=$P(FBN(0),"^",19),$P(^(1),U)=$P(FBN(0),U,6),DIK="^FBAA(161.5," D IX^DIK K DIK
"RTN","FBCHREQ1",32,0)
 .S FBREQED=1,DIC="^FBAA(161.5,",DIC(0)="AEQM" D EN^FBCHROC
"RTN","FBCHREQ1",33,0)
Q K DIE,DIC,DIRUT,DUOUT,DTOUT,X,Y,DR,FB,FBN,FBDA,FBDFN,FBNAME,FBSSN,DA,FBCHVEN,FBREQED,FBDOA,FBFRDT,J
"RTN","FBCHREQ1",34,0)
 Q
"RTN","FBCHREQ1",35,0)
DATCK ;Verify authorized from date is > or = date of admission.
"RTN","FBCHREQ1",36,0)
 I '$D(DFN) I $D(FBDFN) S DFN=FBDFN
"RTN","FBCHREQ1",37,0)
 I '$D(DFN) I $D(FBVET) S DFN=FBVET
"RTN","FBCHREQ1",38,0)
 S FBDOA=$P(^FBAA(162.2,DA,0),"^",19) I $G(FBDOA),X<FBDOA W !,*7,"Authorized From Date must be equal to or greater than the Date of Admission" S FBOUT=1
"RTN","FBCHREQ1",39,0)
 S FBDOB=$P(^DPT(DFN,0),"^",3) I $G(FBDOB),X<FBDOB W !,*7,"Authorized From Date cannot be before the Date of Birth" S FBOUT=1
"RTN","FBCHREQ1",40,0)
 ; Check if this is a Newborn. If Newborn Authorization date can not be after DOB+7
"RTN","FBCHREQ1",41,0)
 N ENTDATE,NOW
"RTN","FBCHREQ1",42,0)
 S ENTDATE=X
"RTN","FBCHREQ1",43,0)
 N X
"RTN","FBCHREQ1",44,0)
 D NOW^%DTC S NOW=X,X=ENTDATE
"RTN","FBCHREQ1",45,0)
 I $$FMDIFF^XLFDT(NOW,FBDOB,1)<365 D  ;PATIENT IS A NEWBORN
"RTN","FBCHREQ1",46,0)
 . I $$FMDIFF^XLFDT(X,FBDOB,1)>7 W !,*7,"Authorized From Date for a Newborn cannot be after DOB+7" S FBOUT=1
"RTN","FBCHREQ1",47,0)
 Q
"RTN","FBCHREQ2")
0^8^B9185141^B9196559
"RTN","FBCHREQ2",1,0)
FBCHREQ2 ;AISC/DMK - RECONSIDER A DENIED NOTIFICATION ;9/19/2014
"RTN","FBCHREQ2",2,0)
 ;;3.5;FEE BASIS;**154**;JAN 30, 1995;Build 12
"RTN","FBCHREQ2",3,0)
 ;;Per VA Directive 6402, this routine should not be modified.
"RTN","FBCHREQ2",4,0)
 Q:'$G(DUZ)
"RTN","FBCHREQ2",5,0)
 ;look-up a request that has been previously denied
"RTN","FBCHREQ2",6,0)
 S DIC("S")="S FBZ=^(0) I $P(FBZ,U,15)=3&($P(FBZ,U,9)=""N""!($P(FBZ,U,12)=""N"")) K FBZ"
"RTN","FBCHREQ2",7,0)
 D ASKV^FBCHREQ G END:X=""!(X="^") K DIC
"RTN","FBCHREQ2",8,0)
 ;display selected request for reconsideration
"RTN","FBCHREQ2",9,0)
 Q:'$G(DA)  W ! S DR="0:99",DIC="^FBAA(162.2," D EN^DIQ K DIC
"RTN","FBCHREQ2",10,0)
 ;ask if correct selection
"RTN","FBCHREQ2",11,0)
 S DIR(0)="Y",DIR("A")="Is this the correct request",DIR("B")="Yes" D ^DIR K DIR G FBCHREQ2:'Y
"RTN","FBCHREQ2",12,0)
 ;continue and determine if legal or medical denial, reset fields
"RTN","FBCHREQ2",13,0)
 S FB=$G(^FBAA(162.2,+FBDA,0)) G END:FB']""
"RTN","FBCHREQ2",14,0)
 S FB1=$S($P(FB,"^",9)="N":1,$P(FB,"^",12)="N":2,1:"") G FBCHREQ2:'FB1
"RTN","FBCHREQ2",15,0)
 S DIE="^FBAA(162.2,",DR="[FBCH REOPEN REQUEST]" D ^DIE K DIE,DR G FBCHREQ2:$D(DTOUT)!($D(DUOUT))
"RTN","FBCHREQ2",16,0)
 D
"RTN","FBCHREQ2",17,0)
 . N FBX
"RTN","FBCHREQ2",18,0)
 . S FBX=$$ADDUA^FBUTL9(162.2,DA_",","Reconsider denied CH notification.")
"RTN","FBCHREQ2",19,0)
 . I 'FBX W !,"Error adding record in User Audit. Please contact IRM."
"RTN","FBCHREQ2",20,0)
 S FBLENT="",DA=FBDA,DIC="^FBAA(162.2,"
"RTN","FBCHREQ2",21,0)
 G @$S(FB1=1:"LENT1^FBCHREQ",FB1=2:"MENT1^FBCHREQ",1:"FBCHREQ2")
"RTN","FBCHREQ2",22,0)
 ;kill variables and exit
"RTN","FBCHREQ2",23,0)
END K DA,FBDA,FBNAME,FBSSN,FB,FB1,FBDFN,DIC,DIE,ZZ
"RTN","FBCHREQ2",24,0)
 Q
"RTN","FBCHREQ2",25,0)
DISPLAY ;display for a data range those requests that have been reconsidered
"RTN","FBCHREQ2",26,0)
 ;ask date range
"RTN","FBCHREQ2",27,0)
 D DATE^FBAAUTL Q:FBPOP
"RTN","FBCHREQ2",28,0)
 S FBBEG=BEGDATE-.1,FBEND=ENDDATE+.9
"RTN","FBCHREQ2",29,0)
 I '$O(^DIA(162.2,"C",0)) W !?5,*7,"No audit data on file.",! G Q
"RTN","FBCHREQ2",30,0)
 ;check Audit file for entries
"RTN","FBCHREQ2",31,0)
 S PGM="START^FBCHREQ2",VAR="FBBEG^FBEND^BEGDATE^ENDDATE" D ZIS^FBAAUTL G Q:FBPOP
"RTN","FBCHREQ2",32,0)
START ;
"RTN","FBCHREQ2",33,0)
 U IO I $E(IOST,1,2)="C-" W @IOF
"RTN","FBCHREQ2",34,0)
 S J=0,QQ="=",$P(QQ,"=",80)="=" D HED
"RTN","FBCHREQ2",35,0)
 F I=FBBEG:0 S I=$O(^DIA(162.2,"C",I)) Q:'I!(I>FBEND)  F  S J=$O(^(I,J)) Q:'J  S FB(1)=$G(^DIA(162.2,+J,0)),FB=$G(^FBAA(162.2,+FB(1),0)) D:FB]""
"RTN","FBCHREQ2",36,0)
 .W !,$$NAME($P(FB,"^",4))," -",$$SSN^FBAAUTL($P(FB,"^",4),1)
"RTN","FBCHREQ2",37,0)
 .W ?50,$$DATX^FBAAUTL($P(FB,"^"))
"RTN","FBCHREQ2",38,0)
 .W !?5,"Field changed: ",$P(^DD(162.2,+$P(FB(1),"^",3),0),"^"),"  By: ",$P($G(^VA(200,+$P(FB(1),"^",4),0)),"^")
"RTN","FBCHREQ2",39,0)
 .W !?10,"Date of Change: ",$$DATX^FBAAUTL($P(FB(1),"^",2))
"RTN","FBCHREQ2",40,0)
 .I $E(IOST,1,2)="C-",$Y+4>IOSL S DIR(0)="E" D ^DIR S:'Y FBOUT=1 I Y W @IOF D HED
"RTN","FBCHREQ2",41,0)
 .E  I $Y+4>IOSL W @IOF D HED
"RTN","FBCHREQ2",42,0)
 I '$D(FBOUT),$E(IOST,1,2)="C-" W ! S DIR(0)="E",DIR("A")="Press RETURN to continue" D ^DIR K DIR
"RTN","FBCHREQ2",43,0)
Q W ! K FB,FBOUT,FBBEG,FBEND,I,J,QQ,Y,DUOUT,DIRUT,DTOUT,BEGDATE,ENDDATE
"RTN","FBCHREQ2",44,0)
 D CLOSE^FBAAUTL Q
"RTN","FBCHREQ2",45,0)
NAME(X) ;
"RTN","FBCHREQ2",46,0)
 ;X=DFN  returns patient name
"RTN","FBCHREQ2",47,0)
 I $D(X),X Q $E($P($G(^DPT(X,0)),"^"),1,40)
"RTN","FBCHREQ2",48,0)
 Q "Unknown"
"RTN","FBCHREQ2",49,0)
HED ;
"RTN","FBCHREQ2",50,0)
 W !?15,"AUDIT on FEE NOTIFICATION ENTITLEMENT CHANGE",!?25,$$DATX^FBAAUTL(BEGDATE)," TO ",$$DATX^FBAAUTL(ENDDATE),!?14,$E(QQ,1,46),!
"RTN","FBCHREQ2",51,0)
 W !,"PATIENT NAME",?49,"DATE/TIME of NOTIFICATION",!?5,"FIELD CHANGED",?39,"SUPERVISOR",!,QQ,!!
"RTN","FBCHREQ2",52,0)
 Q
"RTN","FBCHRR")
0^30^B15446498^B13548321
"RTN","FBCHRR",1,0)
FBCHRR ;AISC/DMK - RE-INITIATE REJECTS FROM PRICER ;1/22/15  12:43
"RTN","FBCHRR",2,0)
 ;;3.5;FEE BASIS;**61,108,123,154**;JAN 30, 1995;Build 12
"RTN","FBCHRR",3,0)
 ;;Per VA Directive 6402, this routine should not be modified.
"RTN","FBCHRR",4,0)
DIC S FBTYPE="B9"
"RTN","FBCHRR",5,0)
 W ! S DIC="^FBAA(161.7,",DIC(0)="AEQMZ",DIC("S")="I $P(^(0),U,15)=""Y""&($P(^(0),U,17)]"""")"_$S($D(^XUSEC("FBAA LEVEL 2",DUZ)):"",1:"&($P(^(0),U,5)=DUZ)"),DIC("A")="Select Batch with Pricer Rejects: " D ^DIC
"RTN","FBCHRR",6,0)
 G END:X="^"!(X=""),DIC:Y<0 S FBN=+Y,FBN(0)=Y(0)
"RTN","FBCHRR",7,0)
 I '$D(^FBAAI("AH",FBN)) W !!,*7,"No items rejected for this batch!",! G DIC
"RTN","FBCHRR",8,0)
DIC1 W !! S DIC="^FBAA(161.7,",DIC(0)="AEQMZ",DIC("A")="Select New Batch Number: ",DIC("S")="I $P(^(0),U,3)=FBTYPE&($P(^(0),U,5)=DUZ)&($P(^(0),U,15)=""Y"")&($G(^(""ST""))=""O"")&($P(^(0),U,18)'[""Y"")"
"RTN","FBCHRR",9,0)
 D ^DIC K DIC G DIC:$E(X)="^"!(X=""),DIC1:Y<0 S FBNB=+Y,FBNB(0)=Y(0)
"RTN","FBCHRR",10,0)
DIC2 W ! S DIC="^FBAAI(",DIC(0)="AEQMZ",DIC("A")="Select Patient: ",D="D",DIC("S")="I $D(^(""FBREJ"")),$P(^(""FBREJ""),U,3)=FBN" D IX^DIC G DIC:$E(X)="^"!(X=""),DIC2:Y<0 S FBI=+Y,FBI(0)=Y(0) G END:'$D(^FBAAI(FBI,0))
"RTN","FBCHRR",11,0)
 S FBLISTC="" D HOME^%ZIS,START^FBCHDI2
"RTN","FBCHRR",12,0)
 ;
"RTN","FBCHRR",13,0)
 ; enforce separation of duties
"RTN","FBCHRR",14,0)
 S FBDFN=$P(FBI(0),U,4)
"RTN","FBCHRR",15,0)
 S FB7078I=$P(FBI(0),U,5)
"RTN","FBCHRR",16,0)
 S FTP=$S(FB7078I]"":$O(^FBAAA("AG",FB7078I,FBDFN,0)),1:"")
"RTN","FBCHRR",17,0)
 I '$$UOKPAY^FBUTL9(FBDFN,FTP) D  G DIC2
"RTN","FBCHRR",18,0)
 . W !!,"You cannot process a payment associated with authorization ",FBDFN,"-",FTP
"RTN","FBCHRR",19,0)
 . W !,"due to separation of duties."
"RTN","FBCHRR",20,0)
 ;
"RTN","FBCHRR",21,0)
ASK S DIR(0)="Y",DIR("A")="Want to re-initiate this payment",DIR("B")="NO" D ^DIR K DIR G END:$D(DIRUT),DIC:'Y
"RTN","FBCHRR",22,0)
 S (DIC,DIE)="^FBAAI(",DIC(0)="AEQM",DA=FBI,DR="20////^S X=FBNB" D ^DIE
"RTN","FBCHRR",23,0)
 K ^FBAAI(FBI,"FBREJ"),^FBAAI("AH",FBN,FBI) S $P(FBNB(0),"^",10)=$P(FBNB(0),"^",10)+1,$P(FBNB(0),"^",11)=$P(FBNB(0),"^",11)+1,$P(FBNB(0),"^",18)="N",^FBAA(161.7,FBNB,0)=FBNB(0)
"RTN","FBCHRR",24,0)
 I '$D(^FBAAI("AH",FBN)) S $P(FBN(0),"^",17)="",^FBAA(161.7,FBN,0)=FBN(0)
"RTN","FBCHRR",25,0)
 I $D(^FBAAI("AH",FBN)) G DIC2
"RTN","FBCHRR",26,0)
EDIT S DIR(0)="Y",DIR("A")="Want to edit payment now",DIR("B")="YES" D ^DIR K DIR G END:$D(DIRUT)!'Y
"RTN","FBCHRR",27,0)
 S FBPRICE=""
"RTN","FBCHRR",28,0)
 ;
"RTN","FBCHRR",29,0)
 ; FB*3.5*123 - edit inpatient invoice - check for IPAC data for Federal Vendors
"RTN","FBCHRR",30,0)
 I '$$IPACEDIT^FBAAPET1(162.5,FBI,.FBIA,.FBDODINV) G DIC2
"RTN","FBCHRR",31,0)
 ;
"RTN","FBCHRR",32,0)
 ; get values of FPPS Claim ID and Line Item
"RTN","FBCHRR",33,0)
 S FBFPPSC=$P($G(^FBAAI(FBI,3)),U)
"RTN","FBCHRR",34,0)
 S FBFPPSL=$P($G(^FBAAI(FBI,3)),U,2)
"RTN","FBCHRR",35,0)
 ; load current adjustment data
"RTN","FBCHRR",36,0)
 D LOADADJ^FBCHFA(FBI_",",.FBADJ)
"RTN","FBCHRR",37,0)
 ; save adjustment data prior to edit session in sorted list
"RTN","FBCHRR",38,0)
 S FBADJL(0)=$$ADJL^FBUTL2(.FBADJ) ; sorted list of original adjustments
"RTN","FBCHRR",39,0)
 ; load current remittance remark data
"RTN","FBCHRR",40,0)
 D LOADRR^FBCHFR(FBI_",",.FBRRMK)
"RTN","FBCHRR",41,0)
 ; save remittance remarks prior to edit session in sorted list
"RTN","FBCHRR",42,0)
 S FBRRMKL(0)=$$RRL^FBUTL4(.FBRRMK)
"RTN","FBCHRR",43,0)
 S LASTDX=$$LAST^FBCHEP1(FBI,"DX"),LASTPROC=$$LAST^FBCHEP1(FBI,"PROC")
"RTN","FBCHRR",44,0)
 S (DIC,DIE)="^FBAAI(",DA=FBI,DR="[FBCH EDIT PAYMENT]"
"RTN","FBCHRR",45,0)
 D  G END:$D(DTOUT)
"RTN","FBCHRR",46,0)
 . N ICDVDT,DFN,FB583,FBAAMM1,FBAAPTC,FBCNTRA,FBCNTRP,FBV,FBVEN,FTP
"RTN","FBCHRR",47,0)
 . S ICDVDT=$$FRDTINV^FBCSV1(DA) ; date for files 80 and 80.1 identifier
"RTN","FBCHRR",48,0)
 . ; get variables for call to PPT^FBAACO1
"RTN","FBCHRR",49,0)
 . S FBAAMM1=$P($G(^FBAAI(DA,2)),U,3)
"RTN","FBCHRR",50,0)
 . S FBCNTRP=$P($G(^FBAAI(DA,5)),U,8)
"RTN","FBCHRR",51,0)
 . S FBV=$P($G(^FBAAI(DA,0)),U,3)
"RTN","FBCHRR",52,0)
 . S DFN=$P($G(^FBAAI(DA,0)),U,4)
"RTN","FBCHRR",53,0)
 . S FBAAPTC=$P($G(^FBAAI(DA,0)),U,13)
"RTN","FBCHRR",54,0)
 . S X=$P($G(^FBAAI(DA,0)),U,5)
"RTN","FBCHRR",55,0)
 . S:X[";FB583(" FB583=+X
"RTN","FBCHRR",56,0)
 . S FTP=$S(X]"":+$O(^FBAAA("AG",X,DFN,0)),1:"")
"RTN","FBCHRR",57,0)
 . S FBVEN=$S(FTP:$P($G(^FBAAA(DFN,1,FTP,0)),U,4),1:"")
"RTN","FBCHRR",58,0)
 . S FBCNTRA=$S(FTP:$P($G(^FBAAA(DFN,1,FTP,0)),U,22),1:"")
"RTN","FBCHRR",59,0)
 . D ^DIE
"RTN","FBCHRR",60,0)
 ; if adjustment data changed then file
"RTN","FBCHRR",61,0)
 I $$ADJL^FBUTL2(.FBADJ)'=FBADJL(0) D FILEADJ^FBCHFA(FBI_",",.FBADJ)
"RTN","FBCHRR",62,0)
 ; if remit remark data changed then file
"RTN","FBCHRR",63,0)
 I $$RRL^FBUTL4(.FBRRMK)'=FBRRMKL(0) D FILERR^FBCHFR(FBI_",",.FBRRMK)
"RTN","FBCHRR",64,0)
 ; remove any gaps in codes
"RTN","FBCHRR",65,0)
 D RMVGAP^FBCHEP1(FBI,1)
"RTN","FBCHRR",66,0)
END K DIC,D,DA,DIRUT,DR,DTOUT,DUOUT,FBPRICE,VAL,DIE,FBI,FBN,FBNB,FBTYPE,I,POP,X,Y,FBLISTC
"RTN","FBCHRR",67,0)
 K FBFPPSC,FBFPPSL,FBADJ,FBADJL,FBRRMK,FBRRMKL
"RTN","FBCHRR",68,0)
 K LASTDX,LASTPROC,FBIA,FBDODINV
"RTN","FBCHRR",69,0)
 D END^FBCHDI
"RTN","FBCHRR",70,0)
 Q
"RTN","FBCHSTA")
0^31^B4547349^B4630411
"RTN","FBCHSTA",1,0)
FBCHSTA ;AISC/DMK - DISPLAYS PENDING INPATIENT DISPOSITIONS ;7/11/14  17:31
"RTN","FBCHSTA",2,0)
 ;;3.5;FEE BASIS;**154**;JAN 30, 1995;Build 12
"RTN","FBCHSTA",3,0)
 ;;Per VA Directive 6402, this routine should not be modified.
"RTN","FBCHSTA",4,0)
 D HOME^%ZIS,^FBAASTA S DIR(0)="E" D ^DIR K DIR Q:'Y  W @IOF
"RTN","FBCHSTA",5,0)
EN D DT^DICRW S FBDT=DT,FBSW=1,CNT=0
"RTN","FBCHSTA",6,0)
 S Q="-",$P(Q,"-",80)="-" D HED
"RTN","FBCHSTA",7,0)
 F I=FBDT:0 S I=$O(^FB7078("AD",6,I)) Q:I'>0  F J=0:0 S J=$O(^FB7078("AD",6,I,J)) Q:J'>0  D TRANS
"RTN","FBCHSTA",8,0)
STAT1 I $D(^FB7078("AC","I")) F I=0:0 S I=$O(^FB7078("AC","I",I)) Q:I'>0  F J=0:0 S J=$O(^FB7078("AC","I",I,J)) Q:J'>0  D TRANS
"RTN","FBCHSTA",9,0)
END W:CNT'>0 !,$S($D(^XUSEC("FBAA LEVEL 2",DUZ)):"There are ",1:"You have "),"no inpatients pending disposition." K CNT,FBAD,FBDT,FBDUZ,FBTYPE,FBVEN,FBVET,I,J,POP,Q,Y,FBFLG Q
"RTN","FBCHSTA",10,0)
TRANS S Y(0)=^FB7078(J,0) Q:$P(Y(0),"^",9)="DC"
"RTN","FBCHSTA",11,0)
 S FBVET=$P(Y(0),"^",3),FBVEN=$P(Y(0),"^",2),FBVEN=$P(FBVEN,";"),FBAD=$P(Y(0),"^",4),FBDUZ=$P(Y(0),"^",8),FBTYPE=$P(Y(0),"^",11)
"RTN","FBCHSTA",12,0)
 Q:FBTYPE'=6
"RTN","FBCHSTA",13,0)
 Q:DUZ'=FBDUZ&('$D(^XUSEC("FBAA LEVEL 2",DUZ)))
"RTN","FBCHSTA",14,0)
 S FBVET=$P(^DPT(FBVET,0),"^",1),FBVEN=$S($D(^FBAAV(FBVEN)):$P(^FBAAV(FBVEN,0),"^",1),1:"UNKNOWN")
"RTN","FBCHSTA",15,0)
 S X1=FBDT,X2=FBAD D D^%DTC
"RTN","FBCHSTA",16,0)
 S FBFLG=$S(X>10:"++",1:""),Y=FBAD D PDF^FBAAUTL S FBAD=Y
"RTN","FBCHSTA",17,0)
 W !,FBFLG,?5,FBVET,?35,FBVEN,?65,FBAD
"RTN","FBCHSTA",18,0)
 S CNT=CNT+1 Q
"RTN","FBCHSTA",19,0)
HED ;S IOP=$S($D(ION):ION,1:"HOME") D ^%ZIS K IOP W @IOF
"RTN","FBCHSTA",20,0)
 W !,?29,"PENDING 7078's",!,?21,"('++' indicates LOS > 10 days)",!,"Veteran",?35,"Vendor",?65,"Admission Date",!,Q Q
"RTN","FBCHVP")
0^9^B23175690^B23931772
"RTN","FBCHVP",1,0)
FBCHVP ;AISC/CMR - VOID & CANCEL VOIDED INPATIENT PAYMENT ;5/16/14  16:17
"RTN","FBCHVP",2,0)
 ;;3.5;FEE BASIS;**55,69,154**;JAN 30, 1995;Build 12
"RTN","FBCHVP",3,0)
 ;;Per VA Directive 6402, this routine should not be modified.
"RTN","FBCHVP",4,0)
 ;Variable 'FBVOID' is set if cancelling a voided payment.
"RTN","FBCHVP",5,0)
 ;Variable 'FBTYPE' is set to 6 for CH or 7 for CNH.
"RTN","FBCHVP",6,0)
 D DT^DICRW
"RTN","FBCHVP",7,0)
RDP ;Get veteran if they have an inpatient invoice (DFN).
"RTN","FBCHVP",8,0)
 K ^TMP($J) W !! S DIC=161,DIC(0)="AEMZ",DIC("S")="I $D(^FBAAI(""AK"",+Y))" D ^DIC K DIC G Q:X=""!($D(DTOUT))!($D(DUOUT)),RDP:Y<0 S DFN=+Y
"RTN","FBCHVP",9,0)
RDV ;Get vendor if an inpatient provider for this patient (FBV).
"RTN","FBCHVP",10,0)
 W !! S DIC=161.2,DIC(0)="AEMZ",DIC("S")="I $D(^FBAAI(""AK"",DFN,+Y))" D ^DIC K DIC G Q:X=""!($D(DTOUT))!($D(DUOUT)),RDV:Y<0 S FBV=+Y
"RTN","FBCHVP",11,0)
 D EN1
"RTN","FBCHVP",12,0)
 I FBCTR=0 W !!?12,*7,"Vendor has no",$S($D(FBVOID):" VOIDED",1:"")," finalized payments ",$S('$D(FBVOID):"to VOID",1:""),!?12,"for this patient under the ",$S(FBTYPE=6:"CIVIL HOSPITAL",1:"COMMUNITY NURSING HOME")," program." G RDV
"RTN","FBCHVP",13,0)
 W !!,"Which payment item(s) would you like to ",$S($D(FBVOID):"Cancel the void on",1:"Void")," ? " S DIR(0)="L^1:"_FBCTR D ^DIR G RDV:$D(DIRUT) S FBX=Y W @IOF D HED
"RTN","FBCHVP",14,0)
 F A=1:1:FBCTR S X=$P(FBX,",",A) Q:X=""  S FBI=+FBI(X),FBINV=^TMP($J,"FBCHVP",FBI),FBVD=$P(FBINV,"^",14) W ! D WRT1 S ^TMP($J,"FBCHVP","VOID",FBI)=""
"RTN","FBCHVP",15,0)
 W ! S DIR(0)="Y",DIR("A")="Are you sure you want to "_$S($D(FBVOID):"Cancel the void on",1:"Void")_" the payment(s)",DIR("B")="No" D ^DIR K DIR G RDP:$D(DIRUT)!'Y
"RTN","FBCHVP",16,0)
 S FBI=0 F  S FBI=$O(^TMP($J,"FBCHVP","VOID",FBI)) Q:FBI'>0  D SETR,CONF W !,?5,".... Done.",!
"RTN","FBCHVP",17,0)
Q K DFN,FBV,FBI,FBTYPE,FBVOID,FBCTR,FBAMTC,FBAMTP,FBBAT,FBDRG,FBFDT,FBINV,FBNUM,FBREIM,FBTDT,FBVD,Q,FBX,VP,^TMP($J,"FBCHVP"),Y,DIE,DR,FBVR,DA
"RTN","FBCHVP",18,0)
 Q
"RTN","FBCHVP",19,0)
EN1 ;Find finalized payments that match FBTYPE and store in ^TMP.
"RTN","FBCHVP",20,0)
 S (FBI,FBCTR)=0,Q="-",$P(Q,"-",80)="-"
"RTN","FBCHVP",21,0)
 S IOP=$S($D(ION):ION,1:"HOME") D ^%ZIS K IOP
"RTN","FBCHVP",22,0)
 F  S FBI=$O(^FBAAI("AK",DFN,FBV,FBI)) Q:FBI'>0  I $D(^FBAAI(FBI,0)),'$D(^("FBREJ")) S FBINV=^(0),FBVD=$P(FBINV,"^",14) I $P(FBINV,"^",16)'=""&($P(FBINV,"^",12)=FBTYPE)&($S($D(FBVOID):(FBVD="VP"),1:(FBVD=""))) D WRT
"RTN","FBCHVP",23,0)
 Q
"RTN","FBCHVP",24,0)
WRT N FBX,FBY2,FBY3,FBCDAYS,FBSCID,FBFPPSC,FBFPPSL,FBADJLR,FBRRMKL
"RTN","FBCHVP",25,0)
 S FBX=$$ADJLRA^FBCHFA(FBI_",")
"RTN","FBCHVP",26,0)
 S FBY2=$G(^FBAAI(FBI,2))
"RTN","FBCHVP",27,0)
 S FBY3=$G(^FBAAI(FBI,3))
"RTN","FBCHVP",28,0)
 S FBCDAYS=$P(FBY2,U,10)  ; covered days
"RTN","FBCHVP",29,0)
 S FBSCID=$P(FBY2,U,11)  ; patient control number
"RTN","FBCHVP",30,0)
 S FBFPPSC=$P(FBY3,U)  ; fpps claim id
"RTN","FBCHVP",31,0)
 S FBFPPSL=$P(FBY3,U,2)  ; fpps line item
"RTN","FBCHVP",32,0)
 S FBRRMKL=$$RRL^FBCHFR(FBI_",")  ; remit remarks
"RTN","FBCHVP",33,0)
 S FBADJLR=$P(FBX,U)  ; adjustment reason
"RTN","FBCHVP",34,0)
 S ^TMP($J,"FBCHVP",FBI)=FBINV
"RTN","FBCHVP",35,0)
 S ^TMP($J,"FBCHVP",FBI,"FBMR")=FBCDAYS_U_FBADJLR_U_FBRRMKL_U_FBSCID_U_FBFPPSC_U_FBFPPSL
"RTN","FBCHVP",36,0)
 I FBCTR=0!($Y+5>IOSL) W @IOF D HED
"RTN","FBCHVP",37,0)
 S FBCTR=FBCTR+1,FBI(FBCTR)=FBI
"RTN","FBCHVP",38,0)
 W !,FBCTR_") " D WRT1 I $D(FBVOID)&($D(^FBAAI(FBI,"R"))) W !?3,"Reason:",!?10,^("R"),!
"RTN","FBCHVP",39,0)
 Q
"RTN","FBCHVP",40,0)
WRT1 N FBMRVP S FBMRVP=^TMP($J,"FBCHVP",FBI,"FBMR")
"RTN","FBCHVP",41,0)
 S FBREIM=$P(FBINV,"^",13),FBFDT=$P(FBINV,"^",6),FBTDT=$P(FBINV,"^",7),FBDRG=$P(FBINV,"^",24),FBAMTC=$P(FBINV,"^",8),FBAMTP=$P(FBINV,"^",9),FBNUM=+FBINV,FBBAT=$P(FBINV,"^",17)
"RTN","FBCHVP",42,0)
 D FBCKI^FBAACCB1(FBI)
"RTN","FBCHVP",43,0)
 W $S(FBREIM="R":"*",1:""),$S(FBVD="VP":"#",1:""),?3,$$DATX^FBAAUTL(FBFDT),?16,$$DATX^FBAAUTL(FBTDT)
"RTN","FBCHVP",44,0)
 W ?26,$S($G(FBDRG):$J($$ICD^FBCSV1(FBDRG,$G(FBFDT)),4),1:""),?35,$J($FN(FBAMTC,",",2),8),?48,$J($FN(FBAMTP,",",2),8),?62,$J(FBNUM,5),?72,$J($P($G(^FBAA(161.7,+FBBAT,0)),"^"),6)
"RTN","FBCHVP",45,0)
 W !,?5,$P(FBMRVP,U),?19,$P(FBMRVP,U,2),?34,$P(FBMRVP,U,3),?54,$P(FBMRVP,U,4)
"RTN","FBCHVP",46,0)
 I $P(FBMRVP,U,5)]"" W !,?5,"FPPS Claim ID: ",$P(FBMRVP,U,5),?33,"FPPS Line Item: ",$P(FBMRVP,U,6)
"RTN","FBCHVP",47,0)
 N A2 S A2=+FBAMTP D PMNT^FBAACCB2
"RTN","FBCHVP",48,0)
 Q
"RTN","FBCHVP",49,0)
HED W !,"Patient Name: ",$P(^DPT(DFN,0),"^"),?50,"Pt.ID ",$$SSN^FBAAUTL(DFN),!!,?2,"VENDOR: ",$P(^FBAAV(FBV,0),"^"),!,?10,"('*' Represents Reimbursement to Patient)",!,?10,"('#' Represents a Voided Payment)"
"RTN","FBCHVP",50,0)
 W !,"   FROM DATE",?16,"TO DATE",?26,"DRG",?33,"AMT CLAIMED",?48,"AMT PAID",?60,"INVOICE #",?72,"BATCH #"
"RTN","FBCHVP",51,0)
 W !,?5,"COV.DAYS",?19,"ADJ CODE",?34,"REMIT REMARKS",?55,"PATIENT CONTROL #"
"RTN","FBCHVP",52,0)
 W !,Q,!
"RTN","FBCHVP",53,0)
 Q
"RTN","FBCHVP",54,0)
SETR ;Set/delete void node on record.
"RTN","FBCHVP",55,0)
 S DA=FBI,VP=$S($D(FBVOID):"",1:"VOID")
"RTN","FBCHVP",56,0)
 I $D(FBVOID) S DR="16///@;16.5///@;17///@"
"RTN","FBCHVP",57,0)
 I '$D(FBVOID) S DR="16///^S X=VP;17////^S X=DUZ"_$S($D(FBVR):";16.5////^S X=FBVR",1:";16.5R;S FBVR=X")
"RTN","FBCHVP",58,0)
 S DIE="^FBAAI(",DIDEL=162.5 D ^DIE K DIDEL
"RTN","FBCHVP",59,0)
 Q
"RTN","FBCHVP",60,0)
CONF ;Print void/cancel void confirmation.
"RTN","FBCHVP",61,0)
 W !,?10,$S($D(FBVOID):"Cancel Voided",1:"Void")," payment for ",$$NAME^FBCHREQ2(DFN),!,*7,"You must adjust control point accordingly through IFCAP!"
"RTN","FBCHVP",62,0)
 Q
"RTN","FBFHLX")
0^32^B59495819^B58317729
"RTN","FBFHLX",1,0)
FBFHLX ;WOIFO/SAB - TRANSMIT HL7 MESSAGES TO FPPS ;7/14/14  16:08
"RTN","FBFHLX",2,0)
 ;;3.5;FEE BASIS;**61,121,122,154**;JUNE 6, 2011;Build 12
"RTN","FBFHLX",3,0)
 ;;Per VA Directive 6402, this routine should not be modified.
"RTN","FBFHLX",4,0)
 Q
"RTN","FBFHLX",5,0)
 ;
"RTN","FBFHLX",6,0)
EN ; Entry Point
"RTN","FBFHLX",7,0)
 ;   may be called by scheduled option as non-interactive task
"RTN","FBFHLX",8,0)
 ;   may be called by user menu option as interactive task
"RTN","FBFHLX",9,0)
 ;
"RTN","FBFHLX",10,0)
 N FBMODE,FBQUIT
"RTN","FBFHLX",11,0)
 S FBQUIT=0
"RTN","FBFHLX",12,0)
 ;
"RTN","FBFHLX",13,0)
 ; Determine Mode - (A)LL PENDING or BY SELECTED (I)NVOICE
"RTN","FBFHLX",14,0)
 I $E(IOST,1,2)'="C-" S FBMODE="A" ; non-interactive is always ALL
"RTN","FBFHLX",15,0)
 I $E(IOST,1,2)="C-" D
"RTN","FBFHLX",16,0)
 . I '$D(^XUSEC("FBAA LEVEL 2",DUZ)) W !!?3,$C(7)_"You must hold the FBAA LEVEL 2 security key to transmit messages." S FBQUIT=1 Q
"RTN","FBFHLX",17,0)
 . ; ask mode
"RTN","FBFHLX",18,0)
 . W !,"This option transmits HL7 messages to FPPS for EDI invoices."
"RTN","FBFHLX",19,0)
 . S DIR(0)="S^I:By Specified Invoice;A:All Pending Invoices"
"RTN","FBFHLX",20,0)
 . S DIR("A")="Select Transmission Option"
"RTN","FBFHLX",21,0)
 . S DIR("?",1)="Enter I to transmit a single invoice or A to transmit"
"RTN","FBFHLX",22,0)
 . S DIR("?",2)="all pending invoices.  If I is entered then you will be"
"RTN","FBFHLX",23,0)
 . S DIR("?",3)="asked to select the invoice."
"RTN","FBFHLX",24,0)
 . S DIR("?",4)=""
"RTN","FBFHLX",25,0)
 . S DIR("?")="Enter a code from the list."
"RTN","FBFHLX",26,0)
 . D ^DIR K DIR I $D(DIRUT) S FBQUIT=1 Q
"RTN","FBFHLX",27,0)
 . S FBMODE=Y
"RTN","FBFHLX",28,0)
 . ; confirm all
"RTN","FBFHLX",29,0)
 . I FBMODE="A" D
"RTN","FBFHLX",30,0)
 . . S DIR(0)="Y",DIR("A")="Transmit all pending invoices now"
"RTN","FBFHLX",31,0)
 . . D ^DIR K DIR I 'Y!$D(DIRUT) S FBQUIT=1 Q
"RTN","FBFHLX",32,0)
 Q:FBQUIT
"RTN","FBFHLX",33,0)
 ;
"RTN","FBFHLX",34,0)
 I FBMODE="A" D ALL
"RTN","FBFHLX",35,0)
 I FBMODE="I" D BYINV
"RTN","FBFHLX",36,0)
 ;
"RTN","FBFHLX",37,0)
 Q
"RTN","FBFHLX",38,0)
 ;
"RTN","FBFHLX",39,0)
ALL ; Transmit All Pending Invoices (interactive and non-interactive)
"RTN","FBFHLX",40,0)
 ; input
"RTN","FBFHLX",41,0)
 ;   FBQUIT - boolean value (0 or 1), true if process should stop
"RTN","FBFHLX",42,0)
 ; output
"RTN","FBFHLX",43,0)
 ;   FBQUIT - may change value
"RTN","FBFHLX",44,0)
 ;
"RTN","FBFHLX",45,0)
 N FBCNT,FBERR,FBHL,FBQDA,FBSTA,FBTTYP,FBXL,FBXMIT,FBFTRACK,HLFS,HLECH  ; FB*3.5*122
"RTN","FBFHLX",46,0)
 ;
"RTN","FBFHLX",47,0)
 ; init
"RTN","FBFHLX",48,0)
 S FBXL=20 ; last line used for message text (save 20 lines for header)
"RTN","FBFHLX",49,0)
 S FBCNT("PENDT")=0 ; count of pending invoices that were transmitted
"RTN","FBFHLX",50,0)
 S FBCNT("PENDE")=0 ; count of pending invoices that had exception
"RTN","FBFHLX",51,0)
 ;
"RTN","FBFHLX",52,0)
 ; save time that process started
"RTN","FBFHLX",53,0)
 S FBXMIT("START")=$$NOW^XLFDT()
"RTN","FBFHLX",54,0)
 I $E(IOST,1,2)="C-" W !!,"Starting Process..."
"RTN","FBFHLX",55,0)
 D TIME^FBFHLX2("START",FBXMIT("START"),.FBFTRACK) I $G(FBFTRACK) Q   ; active job to quit ; FB*3.5*122
"RTN","FBFHLX",56,0)
 ;
"RTN","FBFHLX",57,0)
 ; initialize HL variables
"RTN","FBFHLX",58,0)
 D INIT^HLFNC2("FB FEE TO FPPS EVENT",.FBHL)
"RTN","FBFHLX",59,0)
 I $G(FBHL) D
"RTN","FBFHLX",60,0)
 . S FBQUIT=1
"RTN","FBFHLX",61,0)
 . D PTXT^FBFHLX1(.FBXL,"Error: Unable to initialize HL variables.")
"RTN","FBFHLX",62,0)
 . D PTXT^FBFHLX1(.FBXL,FBHL)
"RTN","FBFHLX",63,0)
 E  D
"RTN","FBFHLX",64,0)
 . S HLFS=FBHL("FS")
"RTN","FBFHLX",65,0)
 . S HLECH=FBHL("ECH")
"RTN","FBFHLX",66,0)
 ;
"RTN","FBFHLX",67,0)
 ; check for transmitted invoices w/o commit ACK
"RTN","FBFHLX",68,0)
 S FBXMIT("ACK")=$$NOW^XLFDT()
"RTN","FBFHLX",69,0)
 I 'FBQUIT,$E(IOST,1,2)="C-" W !!,"Checking for acknowledgements..."
"RTN","FBFHLX",70,0)
 I 'FBQUIT D CHKACK^FBFHLX1
"RTN","FBFHLX",71,0)
 ;
"RTN","FBFHLX",72,0)
 S FBXMIT("SEND")=$$NOW^XLFDT()
"RTN","FBFHLX",73,0)
 ;
"RTN","FBFHLX",74,0)
 I 'FBQUIT,$E(IOST,1,2)="C-" W !!,"Transmitting Pending Invoices..."
"RTN","FBFHLX",75,0)
 ; loop thru pending invoices and transmit
"RTN","FBFHLX",76,0)
 S FBQDA=0 F  S FBQDA=$O(^FBHL(163.5,"AC",0,FBQDA)) Q:'FBQDA!FBQUIT  D
"RTN","FBFHLX",77,0)
 . ; check for taskman quit request
"RTN","FBFHLX",78,0)
 . I $D(ZTQUEUED),$$S^%ZTLOAD S ZTSTOP=1,FBQUIT=1 Q
"RTN","FBFHLX",79,0)
 . S ^XTMP("FBFHLX","IEN")=$H_U_FBQDA_"^XMIT^"        ; FB*3.5*122
"RTN","FBFHLX",80,0)
 . ; try to transmit invoice
"RTN","FBFHLX",81,0)
 . D INVOICE
"RTN","FBFHLX",82,0)
 . ; update counters based on result
"RTN","FBFHLX",83,0)
 . I FBERR S FBCNT("PENDE")=FBCNT("PENDE")+1
"RTN","FBFHLX",84,0)
 . E  S FBCNT("PENDT")=FBCNT("PENDT")+1
"RTN","FBFHLX",85,0)
 . I FBCNT("PENDE")+FBCNT("PENDT")>9999 S (FBCNT("10K"),FBQUIT)=1  ; FB*3.5*121
"RTN","FBFHLX",86,0)
 ;
"RTN","FBFHLX",87,0)
 ; save time that process ended
"RTN","FBFHLX",88,0)
 S FBXMIT("END")=$$NOW^XLFDT()
"RTN","FBFHLX",89,0)
 I $E(IOST,1,2)="C-" W !!,"Process complete. Sending Summary Message to G.FEE..."
"RTN","FBFHLX",90,0)
 D TIME^FBFHLX2("END",FBXMIT("END"))  ; FB*3.5*121
"RTN","FBFHLX",91,0)
 ;
"RTN","FBFHLX",92,0)
 ; build and send summary mail message to G.FEE
"RTN","FBFHLX",93,0)
 D SUMMSG^FBFHLX1
"RTN","FBFHLX",94,0)
 ;
"RTN","FBFHLX",95,0)
 ; clean-up
"RTN","FBFHLX",96,0)
 K ^TMP($J,"FBE"),^TMP($J,"FBNA"),^TMP($J,"FBW"),^TMP($J,"FBX")
"RTN","FBFHLX",97,0)
 ;
"RTN","FBFHLX",98,0)
 Q
"RTN","FBFHLX",99,0)
 ;
"RTN","FBFHLX",100,0)
BYINV ; Transmit Selected Invoices (interactive)
"RTN","FBFHLX",101,0)
 ;
"RTN","FBFHLX",102,0)
 N FBAAIN,FBERR,FBHL,FBQDA,FBSTA,FBTTYP,FBX,HLFS,HLECH
"RTN","FBFHLX",103,0)
 ;
"RTN","FBFHLX",104,0)
 ; initialize HL variables
"RTN","FBFHLX",105,0)
 D INIT^HLFNC2("FB FEE TO FPPS EVENT",.FBHL)
"RTN","FBFHLX",106,0)
 I $G(FBHL) D  Q
"RTN","FBFHLX",107,0)
 . W !,$C(7),"ERROR: Couldn't initialize HL variables!"
"RTN","FBFHLX",108,0)
 . W !,FBHL
"RTN","FBFHLX",109,0)
 S HLFS=FBHL("FS")
"RTN","FBFHLX",110,0)
 S HLECH=FBHL("ECH")
"RTN","FBFHLX",111,0)
 ;
"RTN","FBFHLX",112,0)
 ; select invoice
"RTN","FBFHLX",113,0)
 F  Q:FBQUIT  D
"RTN","FBFHLX",114,0)
 . S DIC="^FBHL(163.5,",DIC(0)="AEQM"
"RTN","FBFHLX",115,0)
 . D ^DIC I Y'>0 S FBQUIT=1 Q
"RTN","FBFHLX",116,0)
 . S FBQDA=+Y
"RTN","FBFHLX",117,0)
 . ;
"RTN","FBFHLX",118,0)
 . ; get invoice number and switch to last entry for invoice
"RTN","FBFHLX",119,0)
 . S FBAAIN=$P($G(^FBHL(163.5,FBQDA,0)),U)
"RTN","FBFHLX",120,0)
 . S FBQDA=$$LAST^FBFHLU(FBAAIN)
"RTN","FBFHLX",121,0)
 . I 'FBQDA W !,"Error, invalid data for invoice ",FBAAIN," in file 163.5" Q
"RTN","FBFHLX",122,0)
 . S FBQY=$G(^FBHL(163.5,FBQDA,0))
"RTN","FBFHLX",123,0)
 . ;
"RTN","FBFHLX",124,0)
 . ; confirm
"RTN","FBFHLX",125,0)
 . S FBX=$S($P(FBQY,U,3)=0:"",1:"re-")
"RTN","FBFHLX",126,0)
 . S DIR(0)="Y"
"RTN","FBFHLX",127,0)
 . S DIR("A")="Do you want to "_FBX_"transmit invoice "_FBAAIN
"RTN","FBFHLX",128,0)
 . D ^DIR K DIR S:$D(DIRUT) FBQUIT=1 I 'Y Q
"RTN","FBFHLX",129,0)
 . ;
"RTN","FBFHLX",130,0)
 . ; if re-transmit then create a new pending entry for invoice
"RTN","FBFHLX",131,0)
 . I FBX="re-" D
"RTN","FBFHLX",132,0)
 . . D FILEQUE^FBFHLL(FBAAIN,$P(FBQY,U,2))
"RTN","FBFHLX",133,0)
 . . S FBQDA=$$LAST^FBFHLU(FBAAIN)
"RTN","FBFHLX",134,0)
 . . I FBQDA S FBQY=$G(^FBHL(163.5,FBQDA,0))
"RTN","FBFHLX",135,0)
 . . E  S FBQY=""
"RTN","FBFHLX",136,0)
 . ;
"RTN","FBFHLX",137,0)
 . ; check that pending entry was added
"RTN","FBFHLX",138,0)
 . I FBX="re-",$P(FBQY,U,3)'=0 D  Q
"RTN","FBFHLX",139,0)
 . . W !,"Error adding entry to file 163.5. Can't re-transmit invoice."
"RTN","FBFHLX",140,0)
 . ;
"RTN","FBFHLX",141,0)
 . ; transmit specified invoice
"RTN","FBFHLX",142,0)
 . D INVOICE
"RTN","FBFHLX",143,0)
 . ;
"RTN","FBFHLX",144,0)
 . ; report success or failure of transmit
"RTN","FBFHLX",145,0)
 . I FBERR=0 W !,"Invoice has been transmitted to the HL7 package.",!!
"RTN","FBFHLX",146,0)
 . I FBERR=1 D
"RTN","FBFHLX",147,0)
 . . N FBL
"RTN","FBFHLX",148,0)
 . . W $C(7),!,"Problems prevented transmission of the invoice."
"RTN","FBFHLX",149,0)
 . . S FBL=0 F  S FBL=$O(^TMP($J,"FBE",FBAAIN,FBL)) Q:'FBL  D
"RTN","FBFHLX",150,0)
 . . . W !,"  ",$G(^TMP($J,"FBE",FBAAIN,FBL))
"RTN","FBFHLX",151,0)
 . . W !
"RTN","FBFHLX",152,0)
 . ;
"RTN","FBFHLX",153,0)
 . ; clean up after transmit
"RTN","FBFHLX",154,0)
 . K ^TMP($J,"FBE",FBAAIN)
"RTN","FBFHLX",155,0)
 . K ^TMP($J,"FBW",FBAAIN)
"RTN","FBFHLX",156,0)
 ;
"RTN","FBFHLX",157,0)
 Q
"RTN","FBFHLX",158,0)
 ;
"RTN","FBFHLX",159,0)
INVOICE ; transmit invoice
"RTN","FBFHLX",160,0)
 ; input
"RTN","FBFHLX",161,0)
 ;   FBQDA - ien of entry in file 163.5 to transmit, required
"RTN","FBFHLX",162,0)
 ; output
"RTN","FBFHLX",163,0)
 ;   FBERR - error flag (0 or 1), true if error prevented transmit
"RTN","FBFHLX",164,0)
 ;   FBSTA  - station number in transmitted message (may be null if err)
"RTN","FBFHLX",165,0)
 ;   FBTTYP - transaction type in transmitted message (may be null)
"RTN","FBFHLX",166,0)
 ;   ^TMP($J,"FBE",invoice number,#) - any exceptions
"RTN","FBFHLX",167,0)
 ;   ^TMP($J,"FBW",invoice number,#) - any warnings
"RTN","FBFHLX",168,0)
 ;
"RTN","FBFHLX",169,0)
 ; N FBAAIN,FBD,FBFILE,FBRESULT,FBQY
"RTN","FBFHLX",170,0)
 ;
"RTN","FBFHLX",171,0)
 ; initialize
"RTN","FBFHLX",172,0)
 S FBERR=0
"RTN","FBFHLX",173,0)
 S FBSTA=""
"RTN","FBFHLX",174,0)
 S FBTTYP=""
"RTN","FBFHLX",175,0)
 ;
"RTN","FBFHLX",176,0)
 ; check for required input
"RTN","FBFHLX",177,0)
 I '$G(FBQDA) S FBERR=1 Q
"RTN","FBFHLX",178,0)
 ;
"RTN","FBFHLX",179,0)
 ; lock record
"RTN","FBFHLX",180,0)
 L +^FBHL(163.5,FBQDA):10
"RTN","FBFHLX",181,0)
 I '$T D  Q
"RTN","FBFHLX",182,0)
 . S FBERR=1
"RTN","FBFHLX",183,0)
 . S FBAAIN=+$P($G(^FBHL(163.5,FBQDA,0)),U)
"RTN","FBFHLX",184,0)
 . I FBAAIN D POST^FBFHLU(FBAAIN,"E","Couldn't Lock Entry "_FBQDA_" in File 163.5.")
"RTN","FBFHLX",185,0)
 ;
"RTN","FBFHLX",186,0)
 ; get invoice number and file number
"RTN","FBFHLX",187,0)
 I 'FBERR D
"RTN","FBFHLX",188,0)
 . N FBQY
"RTN","FBFHLX",189,0)
 . S FBQY=$G(^FBHL(163.5,FBQDA,0))
"RTN","FBFHLX",190,0)
 . S FBAAIN=+$P(FBQY,U)
"RTN","FBFHLX",191,0)
 . I 'FBAAIN D
"RTN","FBFHLX",192,0)
 . . S FBERR=1
"RTN","FBFHLX",193,0)
 . . D POST^FBFHLU(0,"E","Couldn't determine invoice # for entry "_FBQDA_" in file 163.5.")
"RTN","FBFHLX",194,0)
 . Q:FBERR
"RTN","FBFHLX",195,0)
 . S FBFILE=$P(FBQY,U,2)
"RTN","FBFHLX",196,0)
 . I "^3^5^9^"'[(U_FBFILE_U) D
"RTN","FBFHLX",197,0)
 . . S FBERR=1
"RTN","FBFHLX",198,0)
 . . D POST^FBFHLU(FBAAIN,"E","Invalid File # for entry "_FBQDA_" in file 163.5.")
"RTN","FBFHLX",199,0)
 ;
"RTN","FBFHLX",200,0)
 ; gather invoice data
"RTN","FBFHLX",201,0)
 I 'FBERR D @("EN^FBFHLD"_FBFILE) I $D(^TMP($J,"FBE",FBAAIN)) S FBERR=1
"RTN","FBFHLX",202,0)
 S FBTTYP=$P($G(FBD(0,"INV")),U,2)
"RTN","FBFHLX",203,0)
 S FBSTA=$P($G(FBD(0,"INV")),U,3)
"RTN","FBFHLX",204,0)
 ;
"RTN","FBFHLX",205,0)
 ; build HL segments
"RTN","FBFHLX",206,0)
 I 'FBERR D EN^FBFHLS I $D(^TMP($J,"FBE",FBAAIN)) S FBERR=1
"RTN","FBFHLX",207,0)
 ;
"RTN","FBFHLX",208,0)
 ; generate HL message
"RTN","FBFHLX",209,0)
 I 'FBERR D
"RTN","FBFHLX",210,0)
 . K FBRESULT
"RTN","FBFHLX",211,0)
 . D GENERATE^HLMA("FB FEE TO FPPS EVENT","GM",1,.FBRESULT)
"RTN","FBFHLX",212,0)
 . I +$P(FBRESULT,U,2) D
"RTN","FBFHLX",213,0)
 . . S FBERR=1
"RTN","FBFHLX",214,0)
 . . D POST^FBFHLU(FBAAIN,"E","HL ERR:"_$P(FBRESULT,U,3))
"RTN","FBFHLX",215,0)
 ;
"RTN","FBFHLX",216,0)
 ; update file 163.5
"RTN","FBFHLX",217,0)
 I 'FBERR D
"RTN","FBFHLX",218,0)
 . N FBFDA
"RTN","FBFHLX",219,0)
 . S FBFDA(163.5,FBQDA_",",2)="1" ; set status = transmitted
"RTN","FBFHLX",220,0)
 . S FBFDA(163.5,FBQDA_",",3)=$P(FBRESULT,U) ; message ID
"RTN","FBFHLX",221,0)
 . S FBFDA(163.5,FBQDA_",",4)=$$NOW^XLFDT() ; message date/time
"RTN","FBFHLX",222,0)
 . S FBFDA(163.5,FBQDA_",",5)=FBTTYP ; transaction type
"RTN","FBFHLX",223,0)
 . S FBFDA(163.5,FBQDA_",",6)=FBSTA ; station number
"RTN","FBFHLX",224,0)
 . I $D(FBFDA) D FILE^DIE("","FBFDA")
"RTN","FBFHLX",225,0)
 . ;
"RTN","FBFHLX",226,0)
 . ; store HL segments in word-processing field
"RTN","FBFHLX",227,0)
 . D MOVEHL
"RTN","FBFHLX",228,0)
 . D WP^DIE(163.5,FBQDA_",",7,"","^TMP($J,""FBHLSEG"")")
"RTN","FBFHLX",229,0)
 . K ^TMP($J,"FBHLSEG")
"RTN","FBFHLX",230,0)
 ;
"RTN","FBFHLX",231,0)
 ; unlock record
"RTN","FBFHLX",232,0)
 L -^FBHL(163.5,FBQDA)
"RTN","FBFHLX",233,0)
 ;
"RTN","FBFHLX",234,0)
 ; clean-up
"RTN","FBFHLX",235,0)
 K ^TMP("HLS",$J)
"RTN","FBFHLX",236,0)
 Q
"RTN","FBFHLX",237,0)
 ;
"RTN","FBFHLX",238,0)
MOVEHL ; Copy HL segment data into word-processing style array
"RTN","FBFHLX",239,0)
 ; input
"RTN","FBFHLX",240,0)
 ; ^TMP("HLS",$J, array
"RTN","FBFHLX",241,0)
 ; output
"RTN","FBFHLX",242,0)
 ; ^TMP($J,"HLSEG",#)=line of text
"RTN","FBFHLX",243,0)
 ;  there will be a blank line after each segment
"RTN","FBFHLX",244,0)
 ;
"RTN","FBFHLX",245,0)
 N FBI,FBII,FBL
"RTN","FBFHLX",246,0)
 K ^TMP($J,"FBHLSEG")
"RTN","FBFHLX",247,0)
 S FBL=0
"RTN","FBFHLX",248,0)
 S FBI=0 F  S FBI=$O(^TMP("HLS",$J,FBI)) Q:'FBI  D
"RTN","FBFHLX",249,0)
 . S FBL=FBL+1,^TMP($J,"FBHLSEG",FBL)=$G(^TMP("HLS",$J,FBI))
"RTN","FBFHLX",250,0)
 . S FBII=0 F  S FBII=$O(^TMP("HLS",$J,FBI,FBII)) Q:'FBII  D
"RTN","FBFHLX",251,0)
 . . S FBL=FBL+1,^TMP($J,"FBHLSEG",FBL)=$G(^TMP("HLS",$J,FBI,FBII))
"RTN","FBFHLX",252,0)
 . S FBL=FBL+1,^TMP($J,"FBHLSEG",FBL)=""
"RTN","FBFHLX",253,0)
 Q
"RTN","FBFHLX",254,0)
 ;
"RTN","FBFHLX",255,0)
 ;FBFHLX
"RTN","FBLTCAR")
0^65^B22874177^B22371523
"RTN","FBLTCAR",1,0)
FBLTCAR ;WOIFO/SS - LTC AUTHORIZATIONS REPORTS ;5/16/2014
"RTN","FBLTCAR",2,0)
 ;;3.5;FEE BASIS;**49,154**;JAN 30, 1995;Build 12
"RTN","FBLTCAR",3,0)
 ;;Per VA Directive 6402, this routine should not be modified.
"RTN","FBLTCAR",4,0)
 ;
"RTN","FBLTCAR",5,0)
 Q
"RTN","FBLTCAR",6,0)
 ;LTC Ending and Active Authorization Reports
"RTN","FBLTCAR",7,0)
 ;
"RTN","FBLTCAR",8,0)
 ;
"RTN","FBLTCAR",9,0)
EXPO ;entry point for LTC Outpatient Ending Authorization Report
"RTN","FBLTCAR",10,0)
 N FBLTCRT,FBLTCPR
"RTN","FBLTCAR",11,0)
 S FBLTCPR="OUTPATIENT"
"RTN","FBLTCAR",12,0)
 S FBLTCRT=1 ;Ending Expiration report
"RTN","FBLTCAR",13,0)
 D EN^FBLTCAR2
"RTN","FBLTCAR",14,0)
 Q
"RTN","FBLTCAR",15,0)
 ;
"RTN","FBLTCAR",16,0)
EXPC ;entry point for LTC CHN Ending Authorization Report
"RTN","FBLTCAR",17,0)
 N FBLTCRT,FBLTCPR
"RTN","FBLTCAR",18,0)
 S FBLTCPR="CONTRACT NURSING HOME"
"RTN","FBLTCAR",19,0)
 S FBLTCRT=1 ;Ending Expiration report
"RTN","FBLTCAR",20,0)
 D EN^FBLTCAR2
"RTN","FBLTCAR",21,0)
 Q
"RTN","FBLTCAR",22,0)
 ;
"RTN","FBLTCAR",23,0)
ACTO ;entry point for LTC Outpatient Active Authorization Report
"RTN","FBLTCAR",24,0)
 N FBLTCRT,FBLTCPR
"RTN","FBLTCAR",25,0)
 S FBLTCPR="OUTPATIENT"
"RTN","FBLTCAR",26,0)
 S FBLTCRT=2 ;Active authorizations report
"RTN","FBLTCAR",27,0)
 D EN^FBLTCAR2
"RTN","FBLTCAR",28,0)
 Q
"RTN","FBLTCAR",29,0)
ACTC ;entry point for LTC CHN Active Authorization Report
"RTN","FBLTCAR",30,0)
 N FBLTCRT,FBLTCPR
"RTN","FBLTCAR",31,0)
 S FBLTCPR="CONTRACT NURSING HOME"
"RTN","FBLTCAR",32,0)
 S FBLTCRT=2 ;Active authorizations report
"RTN","FBLTCAR",33,0)
 D EN^FBLTCAR2
"RTN","FBLTCAR",34,0)
 Q
"RTN","FBLTCAR",35,0)
 ;
"RTN","FBLTCAR",36,0)
 ;/*
"RTN","FBLTCAR",37,0)
 ;check if exclude/include the aithorization in report
"RTN","FBLTCAR",38,0)
 ;INPUT:
"RTN","FBLTCAR",39,0)
 ;FBAUTHFR - authorization date FROM
"RTN","FBLTCAR",40,0)
 ;FBAUTHTO - authorization date TO
"RTN","FBLTCAR",41,0)
 ;FBRPTFR  - report for date FROM
"RTN","FBLTCAR",42,0)
 ;FBRPTTO  - report for date TO
"RTN","FBLTCAR",43,0)
 ;FBRPTYPE - type of report: 
"RTN","FBLTCAR",44,0)
 ;  1-authorization Ending report
"RTN","FBLTCAR",45,0)
 ;  2-Active authorization report
"RTN","FBLTCAR",46,0)
 ;OUTPUT:
"RTN","FBLTCAR",47,0)
 ;1 - exclude
"RTN","FBLTCAR",48,0)
 ;0 - include
"RTN","FBLTCAR",49,0)
LTCRPT(FBAUTHFR,FBAUTHTO,FBRPTFR,FBRPTTO,FBRPTYPE) ;
"RTN","FBLTCAR",50,0)
 Q:FBRPTYPE=0 0
"RTN","FBLTCAR",51,0)
 ;authorization Ending report
"RTN","FBLTCAR",52,0)
 I FBRPTYPE=1 Q:((FBAUTHTO'<FBRPTFR)&(FBAUTHTO'>FBRPTTO)) 0  Q 1
"RTN","FBLTCAR",53,0)
 ;Active authorization report
"RTN","FBLTCAR",54,0)
 I FBRPTYPE=2 Q:((FBAUTHTO<FBRPTFR)!(FBAUTHFR>FBRPTTO)) 1  Q 0
"RTN","FBLTCAR",55,0)
 Q 0
"RTN","FBLTCAR",56,0)
 ;
"RTN","FBLTCAR",57,0)
 ;
"RTN","FBLTCAR",58,0)
 ;FBPTDFN - patient ien in file #2
"RTN","FBLTCAR",59,0)
 ;FB161P - pointer to multiple in file #161 under the DFN
"RTN","FBLTCAR",60,0)
 ;FBVEND - vendor
"RTN","FBLTCAR",61,0)
 ;FBDTB - begin date of the user specified date range
"RTN","FBLTCAR",62,0)
 ;FBDTE - end date of the user specified date range
"RTN","FBLTCAR",63,0)
 ;FBAUBEG - begin date of authorization
"RTN","FBLTCAR",64,0)
 ;FBAUEND - end date of authorization
"RTN","FBLTCAR",65,0)
 ;
"RTN","FBLTCAR",66,0)
 ;OUTPUT:
"RTN","FBLTCAR",67,0)
 ; string to print
"RTN","FBLTCAR",68,0)
 ;
"RTN","FBLTCAR",69,0)
PRNVIS(FBPTDFN,FB161P,FBVEND,FBDTB,FBDTE,FBAUBEG,FBAUEND) ;
"RTN","FBLTCAR",70,0)
 N FBRET1,FBRETAR,FBVNDR
"RTN","FBLTCAR",71,0)
 S FBRETAR=""
"RTN","FBLTCAR",72,0)
 S FBRET1=$$GETVIS(FBPTDFN,FB161P,FBDTB,$S(FBAUEND>FBDTE:FBDTE,1:FBAUEND),FBAUBEG,.FBRETAR)
"RTN","FBLTCAR",73,0)
 I FBVEND="not specified" D  ;if vendor was not specified in (#161)
"RTN","FBLTCAR",74,0)
 . ;loop thru vendors (#162) under this authorization
"RTN","FBLTCAR",75,0)
 . S FBVNDR="" F  S FBVNDR=$O(FBRETAR(FBVNDR)) Q:FBVNDR=""  D
"RTN","FBLTCAR",76,0)
 . . W !,?6,"Vendor: "_$S(FBVNDR>0:$P($G(^FBAAV(FBVNDR,0)),U),1:"not specified")
"RTN","FBLTCAR",77,0)
 . . W !,?6,"Visits: "_$G(FBRETAR(FBVNDR,1)),?19,"Paid Amt: $"_$G(FBRETAR(FBVNDR,2)),?39,"Cum Visits: "_$G(FBRETAR(FBVNDR,3)),?56,"Cum Paid Amt: $"_$G(FBRETAR(FBVNDR,4))
"RTN","FBLTCAR",78,0)
 . W !,?6,"---"
"RTN","FBLTCAR",79,0)
 W !,?6,"Visits: "_$P(FBRET1,U,1),?19,"Paid Amt: $"_$P(FBRET1,U,2),?39,"Cum Visits: "_$P(FBRET1,U,3),?56,"Cum Paid Amt: $"_$P(FBRET1,U,4)
"RTN","FBLTCAR",80,0)
 Q
"RTN","FBLTCAR",81,0)
 ;
"RTN","FBLTCAR",82,0)
 ;INPUT:
"RTN","FBLTCAR",83,0)
 ;FBPATDFN - patient ien in file #2
"RTN","FBLTCAR",84,0)
 ;FB161 - pointer to multiple in file #161 under the DFN
"RTN","FBLTCAR",85,0)
 ;FBBEG - begin date of the user specified date range
"RTN","FBLTCAR",86,0)
 ;FBEND - end date of the user specified date range 
"RTN","FBLTCAR",87,0)
 ;FBAUTB - begin date of authorization
"RTN","FBLTCAR",88,0)
 ;
"RTN","FBLTCAR",89,0)
 ;OUTPUT:
"RTN","FBLTCAR",90,0)
 ; returns number_of_visits^total amount^cumulative_number_of_visits^cumulative_total amount
"RTN","FBLTCAR",91,0)
 ; FBRET - array with results
"RTN","FBLTCAR",92,0)
GETVIS(FBPATDFN,FB161,FBBEG,FBEND,FBAUTB,FBRET) ;
"RTN","FBLTCAR",93,0)
 N FBVND,FBINDT,FBINITDT,FBCPT,FBAMT,FBCNT,FBCMAMT,FBCMCNT,FBDTCPT,FBBB,FBCPTN,FBAMT1
"RTN","FBLTCAR",94,0)
 ; auth,patient,vendor
"RTN","FBLTCAR",95,0)
 S (FBCNT,FBAMT,FBCMCNT,FBCMAMT)=0
"RTN","FBLTCAR",96,0)
 S FBVND=0 F  S FBVND=$O(^FBAAC("AFN",FB161,FBPATDFN,FBVND)) Q:+FBVND=0  D
"RTN","FBLTCAR",97,0)
 . F FBBB=1:1:4 S FBRET(FBVND,FBBB)=0
"RTN","FBLTCAR",98,0)
 . ;auth,patient,vendor,date
"RTN","FBLTCAR",99,0)
 . S FBINDT=0 F  S FBINDT=$O(^FBAAC("AFN",FB161,FBPATDFN,FBVND,FBINDT)) Q:+FBINDT=0  D
"RTN","FBLTCAR",100,0)
 . . ;determine a date value
"RTN","FBLTCAR",101,0)
 . . S FBINITDT=+$G(^FBAAC(FBPATDFN,1,FBVND,1,FBINDT,0))
"RTN","FBLTCAR",102,0)
 . . Q:FBINITDT=0
"RTN","FBLTCAR",103,0)
 . . I FBINITDT>FBEND Q  ;out of date range
"RTN","FBLTCAR",104,0)
 . . ;auth,patient,vendor,date,service
"RTN","FBLTCAR",105,0)
 . . S FBCPT=0 F  S FBCPT=$O(^FBAAC("AFN",FB161,FBPATDFN,FBVND,FBINDT,FBCPT)) Q:+FBCPT=0  D
"RTN","FBLTCAR",106,0)
 . . . S FBCPTN=+$G(^FBAAC(FBPATDFN,1,FBVND,1,FBINDT,1,FBCPT,0))
"RTN","FBLTCAR",107,0)
 . . . S FBAMT1=+$P($G(^FBAAC(FBPATDFN,1,FBVND,1,FBINDT,1,FBCPT,0)),"^",3)
"RTN","FBLTCAR",108,0)
 . . . ; cumulative (from the begining of authorization till the end of user's date range)
"RTN","FBLTCAR",109,0)
 . . . I FBINITDT'<FBAUTB S FBCMAMT=FBCMAMT+FBAMT1,FBRET(FBVND,4)=FBRET(FBVND,4)+FBAMT1 S:'$D(FBDTCPT(FBINITDT,FBCPTN)) FBCMCNT=FBCMCNT+1,FBRET(FBVND,3)=FBRET(FBVND,3)+1
"RTN","FBLTCAR",110,0)
 . . . ; for user specified date range
"RTN","FBLTCAR",111,0)
 . . . I FBINITDT'<FBBEG S FBAMT=FBAMT+FBAMT1,FBRET(FBVND,2)=FBRET(FBVND,2)+FBAMT1 S:'$D(FBDTCPT(FBINITDT,FBCPTN)) FBCNT=FBCNT+1,FBRET(FBVND,1)=FBRET(FBVND,1)+1
"RTN","FBLTCAR",112,0)
 . . . S:'$D(FBDTCPT(FBINITDT,FBCPTN)) FBDTCPT(FBINITDT,FBCPTN)=""
"RTN","FBLTCAR",113,0)
 S FBRET=FBCNT_"^"_FBAMT_"^"_FBCMCNT_"^"_FBCMAMT
"RTN","FBLTCAR",114,0)
 Q FBRET
"RTN","FBLTCAR",115,0)
 ;
"RTN","FBLTCAR",116,0)
 ;
"RTN","FBLTCAR",117,0)
 ;FBLTCAR
"RTN","FBNHDLAD")
0^45^B7092641^B6656610
"RTN","FBNHDLAD",1,0)
FBNHDLAD ;AISC/GRR - DELETE ADMISSION FOR NURSING HOME ;1/22/15  13:18
"RTN","FBNHDLAD",2,0)
 ;;3.5;FEE BASIS;**82,154**;JAN 30, 1995;Build 12
"RTN","FBNHDLAD",3,0)
 ;;Per VA Directive 6402, this routine should not be modified.
"RTN","FBNHDLAD",4,0)
RD1 D GETVET^FBAAUTL1 G:DFN']"" Q W !
"RTN","FBNHDLAD",5,0)
RD2 S DIC("S")="I $P(^(0),U,3)=""A""&($P(^(0),U,2)=DFN)",DIC="^FBAACNH(",DIE=DIC,DIC(0)="AEQMZ",DLAYGO=162.3,DIC("A")="Select Admission Date/Time: " D ^DIC K DIC,DLAYGO G RD1:X="^"!(X=""),RD2:Y<0 S DA=+Y
"RTN","FBNHDLAD",6,0)
 S FB("ADDT")=$P(Y(0),"^") ; admission date/time
"RTN","FBNHDLAD",7,0)
 S FB(161)=$P(Y(0),"^",10)
"RTN","FBNHDLAD",8,0)
 I $O(^FBAACNH("AC",DA,DA))>0 W !!,*7,"Other movements associated with this admission are still on file.",!,"You cannot delete the admission when other movements exist!" G CKVEIW
"RTN","FBNHDLAD",9,0)
 S DIR("A")="Are you sure you want to delete this admission",DIR(0)="Y",DIR("B")="No" D ^DIR K DIR G Q:$D(DTOUT)!$D(DUOUT),RD1:Y=0
"RTN","FBNHDLAD",10,0)
 I FB(161),$D(^FBAAA(DFN,1,FB(161),0)) S FB(78)=$P($P(^(0),"^",9),";")
"RTN","FBNHDLAD",11,0)
 I $G(FB(78)) S FB(1625)=+$O(^FBAAI("E",FB(78)_";FB7078(",0))
"RTN","FBNHDLAD",12,0)
 I $G(FB(1625)),$D(^FBAAI(FB(1625),0)) W *7,!,"Unable to delete. Payments already made against this admission!",!! G RD1
"RTN","FBNHDLAD",13,0)
 S DIK=DIE D ^DIK K DIK W !?5,"...deleted",!
"RTN","FBNHDLAD",14,0)
 D PTFD^FBUTL6(DFN,FB("ADDT")) ; delete associated PTF record
"RTN","FBNHDLAD",15,0)
 D
"RTN","FBNHDLAD",16,0)
 . N FBX
"RTN","FBNHDLAD",17,0)
 . S FBX=$$ADDUA^FBUTL9(162.4,FB(78)_",","Delete CNH admission.")
"RTN","FBNHDLAD",18,0)
 . I 'FBX W !,"Error adding record in User Audit. Please contact IRM."
"RTN","FBNHDLAD",19,0)
 K FB
"RTN","FBNHDLAD",20,0)
 G RD1
"RTN","FBNHDLAD",21,0)
Q K DIC,DIE,DR,DA,DFN,FBTYPE,FTP,Y,X,FBPROG,FB,FBZZ,ZZZ
"RTN","FBNHDLAD",22,0)
 Q
"RTN","FBNHDLAD",23,0)
CKVEIW S DIR("A")="Want data related to this admission displayed",DIR("B")="No",DIR(0)="Y" D ^DIR K DIR G RD1:$D(DTOUT)!$D(DUOUT)!(Y=0) S IFN=DA D ^FBNHDEC
"RTN","FBNHDLAD",24,0)
 G RD1
"RTN","FBNHDLDI")
0^46^B9276531^B8367852
"RTN","FBNHDLDI",1,0)
FBNHDLDI ;AISC/GRR - DELETE DISCHARGE FOR NURSING HOME ;1/22/15  13:39
"RTN","FBNHDLDI",2,0)
 ;;3.5;FEE BASIS;**154**;JAN 30, 1995;Build 12
"RTN","FBNHDLDI",3,0)
 ;;Per VA Directive 6402, this routine should not be modified.
"RTN","FBNHDLDI",4,0)
RD1 D GETVET^FBAAUTL1 G:DFN']"" Q
"RTN","FBNHDLDI",5,0)
 I $D(^FBAACNH("AD",DFN)) W !!,*7,"Veteran presently has an active admission.",!,"You cannot delete a discharge when there is an active admission!",! G CKVEIW
"RTN","FBNHDLDI",6,0)
RD2 S DIC("S")="I $P(^(0),U,3)=""D""&($P(^(0),U,2)=DFN)",DIC="^FBAACNH(",DIE=DIC,DIC(0)="AEQMZ",DLAYGO=162.3,DIC("A")="Select Discharge Date/Time: " D ^DIC K DIC,DLAYGO G RD1:X="^"!(X=""),RD2:Y<0 S DA=+Y
"RTN","FBNHDLDI",7,0)
 S FBCKDT=+Y(0) I $O(^FBAACNH("AF",DFN,0))<(9999999.9999-FBCKDT) W !!,*7,"There is activity following this discharge date.",!,"You must delete all subsequent activity before deleting this discharge." G RD1
"RTN","FBNHDLDI",8,0)
 S FBDA=$P(^FBAACNH(DA,0),"^",5)
"RTN","FBNHDLDI",9,0)
 S DIR("A")="Are you sure you want to delete this discharge",DIR(0)="Y",DIR("B")="No" D ^DIR K DIR G Q:$D(DTOUT),RD1:$D(DUOUT)!(Y=0)
"RTN","FBNHDLDI",10,0)
 S DIK="^FBAACNH(" D ^DIK S DIE="^FBAACNH(",DR="3////^S X=""Y""",DA=FBDA D ^DIE W !?5,"... deleted" D ALERT
"RTN","FBNHDLDI",11,0)
 I DFN D
"RTN","FBNHDLDI",12,0)
 . N FB,FBX
"RTN","FBNHDLDI",13,0)
 . S FB(161)=$S(FBDA:$P($G(^FBAACNH(FBDA,0)),"^",10),1:"")
"RTN","FBNHDLDI",14,0)
 . Q:'FB(161)
"RTN","FBNHDLDI",15,0)
 . I $D(^FBAAA(DFN,1,FB(161),0)) S FB(78)=+$P(^(0),"^",9)
"RTN","FBNHDLDI",16,0)
 . Q:'$G(FB(78))
"RTN","FBNHDLDI",17,0)
 . S FBX=$$ADDUA^FBUTL9(162.4,FB(78)_",","Delete CNH discharge.")
"RTN","FBNHDLDI",18,0)
 . I 'FBX W !,"Error adding record in User Audit. Please contact IRM."
"RTN","FBNHDLDI",19,0)
 G RD1
"RTN","FBNHDLDI",20,0)
Q K DIC,DIE,DR,DA,DFN,FBTYPE,FTP,Y,X,FBPROG,FBDA,FBCKDT
"RTN","FBNHDLDI",21,0)
 Q
"RTN","FBNHDLDI",22,0)
CKVEIW S DIR("A")="Want data related to active admission displayed",DIR("B")="No",DIR(0)="Y" D ^DIR K DIR G RD1:$D(DTOUT)!$D(DUOUT)!(Y=0) S IFN=$O(^FBAACNH("AD",DFN,0)) D ^FBNHDEC
"RTN","FBNHDLDI",23,0)
 G RD1
"RTN","FBNHDLDI",24,0)
ALERT W !!,*7,"It will be necessary to adjust the 'TO DATE' of this patient's authorization",!,"using the 'EDIT CNH AUTHORIZATION' option."
"RTN","FBNHDLTR")
0^47^B4147651^B3368694
"RTN","FBNHDLTR",1,0)
FBNHDLTR ;AISC/GRR - DELETE TRANSFER FOR NURSING HOME ;1/22/15  14:13
"RTN","FBNHDLTR",2,0)
 ;;3.5;FEE BASIS;**154**;JAN 30, 1995;Build 12
"RTN","FBNHDLTR",3,0)
 ;;Per VA Directive 6402, this routine should not be modified.
"RTN","FBNHDLTR",4,0)
RD1 D GETVET^FBAAUTL1 G:DFN']"" Q
"RTN","FBNHDLTR",5,0)
RD2 S DIC("S")="I $P(^(0),U,3)=""T""&($P(^(0),U,2)=DFN)",DIC="^FBAACNH(",DIE=DIC,DIC(0)="AEQMZ",DLAYGO=162.3,DIC("A")="Select Transfer Date/Time: " D ^DIC K DIC,DLAYGO G RD1:X="^"!(X=""),RD2:Y<0 S DA=+Y
"RTN","FBNHDLTR",6,0)
 S FBDA(0)=Y(0),FBDA=$P(FBDA(0),U,5) D  G Q:$D(FBERR)
"RTN","FBNHDLTR",7,0)
 .I $O(^FBAACNH("AC",FBDA,DA)) W !,*7,"There are movements following this transfer that must be deleted first.",!! S FBERR=1
"RTN","FBNHDLTR",8,0)
 S DIR("A")="Are you sure you want to delete this transfer",DIR(0)="Y",DIR("B")="No" D ^DIR K DIR G Q:$D(DTOUT),RD1:$D(DUOUT)!(Y=0)
"RTN","FBNHDLTR",9,0)
 S DIK="^FBAACNH(" D ^DIK
"RTN","FBNHDLTR",10,0)
 I DFN D
"RTN","FBNHDLTR",11,0)
 . N FB,FBX
"RTN","FBNHDLTR",12,0)
 . S FB(161)=$S(FBDA:$P($G(^FBAACNH(FBDA,0)),"^",10),1:"")
"RTN","FBNHDLTR",13,0)
 . Q:'FB(161)
"RTN","FBNHDLTR",14,0)
 . I $D(^FBAAA(DFN,1,FB(161),0)) S FB(78)=+$P(^(0),"^",9)
"RTN","FBNHDLTR",15,0)
 . Q:'$G(FB(78))
"RTN","FBNHDLTR",16,0)
 . S FBX=$$ADDUA^FBUTL9(162.4,FB(78)_",","Delete CNH transfer.")
"RTN","FBNHDLTR",17,0)
 . I 'FBX W !,"Error adding record in User Audit. Please contact IRM."
"RTN","FBNHDLTR",18,0)
 K FBDA G RD1
"RTN","FBNHDLTR",19,0)
Q K DIC,DIE,DR,DA,DFN,DIR,FBTYPE,FTP,Y,X,FBPROG,FBDA,FBERR
"RTN","FBNHDLTR",20,0)
 Q
"RTN","FBNHEA")
0^48^B10123939^B9476317
"RTN","FBNHEA",1,0)
FBNHEA ;AISC/GRR - ENTER ADMISSION TO NURSING HOME ;1/22/15  14:23
"RTN","FBNHEA",2,0)
 ;;3.5;FEE BASIS;**82,108,154**;JAN 30, 1995;Build 12
"RTN","FBNHEA",3,0)
 ;;Per VA Directive 6402, this routine should not be modified.
"RTN","FBNHEA",4,0)
RD1 D GETVET^FBAAUTL1 G:DFN']"" Q
"RTN","FBNHEA",5,0)
 I $D(^FBAACNH("AD",DFN)) G CKVEIW
"RTN","FBNHEA",6,0)
RD0 S FBPROG="I $P(^(0),U,3)=7" D GETAUTH^FBAAUTL1 G RD1:FTP']"",RD1:$D(DUOUT),Q:$D(DTOUT) I FBTYPE'=7 D WRONGT^FBAAUTL1 G RD0
"RTN","FBNHEA",7,0)
RD2 I $D(^FBAACNH("AD",DFN)) G CKVEIW
"RTN","FBNHEA",8,0)
 S FBLTD=$O(^FBAACNH("AF",DFN,0)) K:FBLTD<1 FBLTD S FBTRT="A",DIR(0)="DA^"_FBAABDT_".000001:"_FBAABDT_".999999:EXR",DIR("A")="Enter Admission Date/Time:  ",DIR("?")="Enter date pt. admitted to CNH facility (time is required)"
"RTN","FBNHEA",9,0)
 D ^DIR K DIR G:$D(DIRUT)!'Y Q S FBY=+Y D DATCK2^FBAAUTL1 G:'$D(X) RD2
"RTN","FBNHEA",10,0)
 S DIR(0)="S^1:AFTER RE-HOSPITALIZATION >15 DAYS;2:TRANSFER FROM OTHER CNH;3:FROM ASIH <15 DAYS;4:ALL OTHER",DIR("A")="Enter Admission Type" D ^DIR K DIR G:$D(DIRUT) Q S FBZ=+Y
"RTN","FBNHEA",11,0)
 K DD,DO S X=FBY,DIC="^FBAACNH(",DIE=DIC,DIC(0)="LM",DLAYGO=162.3 D FILE^DICN G RD1:$D(DUOUT)!($D(DTOUT)),RD2:Y<0 S DA=+Y K DIC,DLAYGO
"RTN","FBNHEA",12,0)
 D
"RTN","FBNHEA",13,0)
 . N FBX,DIE,DA
"RTN","FBNHEA",14,0)
 . S FBX=$$ADDUA^FBUTL9(162.4,FB7078_",","Enter CNH admission.")
"RTN","FBNHEA",15,0)
 . I 'FBX W !,"Error adding record in User Audit. Please contact IRM."
"RTN","FBNHEA",16,0)
 S DR="8////^S X=FBVEN;Q;9////^S X=FTP;1////^S X=DFN;2////^S X=""A"";3////^S X=""Y"";4////^S X=DA;5////^S X=FBZ" D ^DIE I '$D(DTOUT) D PTFC^FBUTL6(DFN,FBY) I '$G(FBRCHK) G RD1
"RTN","FBNHEA",17,0)
Q K DIC,DIE,DR,DA,DFN,FBTYPE,FTP,Y,X,FBPROG,FBVEN,CNT,DAT,F,FB7078,FBAABDT,FBAAEDT,FBAAOUT,FBASSOC,FBAUT,FBDX,FBI,FBLOC,FBPOV,FBPSA,FBPT,I,FBRR,FBTT,PI,PTYPE,T,TA,Z,ZZ,CNT,FBAUT,TA,DIRUT,DUOUT,DTOUT,FBY,FBLTD,FBTRT
"RTN","FBNHEA",18,0)
 K FBZ,FBRCHK
"RTN","FBNHEA",19,0)
 D GETAUTHK^FBAAUTL1
"RTN","FBNHEA",20,0)
 Q
"RTN","FBNHEA",21,0)
CKVEIW W !!,*7,"Veteran already has an active admission, you may use the edit option to edit it.",!
"RTN","FBNHEA",22,0)
 S DIR(0)="Y",DIR("A")="Want data related to active admission displayed",DIR("B")="NO" D ^DIR K DIR I Y S IFN=$O(^FBAACNH("AD",DFN,0)) D ^FBNHDEC
"RTN","FBNHEA",23,0)
 I '$G(FBRCHK) G RD1
"RTN","FBNHEA",24,0)
 Q
"RTN","FBNHEAUT")
0^49^B28883284^B27561875
"RTN","FBNHEAUT",1,0)
FBNHEAUT ;AISC/DMK,GRR - ENTER/EDIT AUTHORIZATION ;1/16/15  13:49
"RTN","FBNHEAUT",2,0)
 ;;3.5;FEE BASIS;**43,103,139,154**;JAN 30, 1995;Build 12
"RTN","FBNHEAUT",3,0)
 ;;Per VA Directive 6402, this routine should not be modified.
"RTN","FBNHEAUT",4,0)
 D SITEP^FBAAUTL Q:FBPOP  S FBAADDYS=+$P(FBSITE(0),"^",13),FBAAASKV=$P(FBSITE(1),"^"),FBPROG=$S($P(FBSITE(1),"^",6)="":"I 1",1:"I $P(^(0),U,3)=7") W !!
"RTN","FBNHEAUT",5,0)
 ;
"RTN","FBNHEAUT",6,0)
 S PRCS("TYPE")="FB",PRCS("A")="Select Obligation Number: " K PRCS("X") D EN1^PRCS58 G:Y<0 NOGOOD^FBNHEAU1 S FBOBN=$P(Y,"^",2) K PRCS("A")
"RTN","FBNHEAUT",7,0)
 ;
"RTN","FBNHEAUT",8,0)
 W !! S DIC="^DPT(",DIC(0)="QEAZM" D ^DIC G END:Y<0 S DFN=+Y
"RTN","FBNHEAUT",9,0)
 I $P($G(^DPT(DFN,.361)),"^")="" W !!,"ELIGIBILITY HAS NOT BEEN DETERMINED NOR PENDING, CANNOT ENTER AN AUTHORIZATION." G FBNHEAUT
"RTN","FBNHEAUT",10,0)
 I $P($G(^DPT(DFN,.32)),"^",4)=2 W !!,"VETERAN HAS A DISHONORABLE DISCHARGE, " S X=$P($G(^(.321)),"^") W $S(X="Y":"ONLY ELIGIBLE FOR AGENT ORANGE.",1:"NOT ELIGIBLE FOR BENEFITS.")
"RTN","FBNHEAUT",11,0)
 I "N"[$E(X) W ! S DIR("A")="Do you want to continue",DIR(0)="Y",DIR("B")="No" D ^DIR K DIR G FBNHEAUT:$S($D(DIRUT):1,'Y:1,1:0)
"RTN","FBNHEAUT",12,0)
 S DA=DFN I '$D(^FBAAA(DFN,0)) K DD,DO S (X,DINUM)=DFN,DIC="^FBAAA(",DIC(0)="LM",DLAYGO=161 D FILE^DICN K DIC,DLAYGO G:Y<0 END
"RTN","FBNHEAUT",13,0)
 S:'$D(^FBAAA(DFN,1,0)) ^(0)="^161.01D^^"
"RTN","FBNHEAUT",14,0)
 D ^FBAADEM ;G FBNHEAUT:FBAAOUT
"RTN","FBNHEAUT",15,0)
 ;
"RTN","FBNHEAUT",16,0)
GETVEN S FBPROG=7 D DATES^FBAAUTL2 G:FBBEGDT="" FBNHEAUT
"RTN","FBNHEAUT",17,0)
 D GETVEN^FBAAUTL1 G END:X="^"!(X=""),GETVEN:IFN="" S FBVEN=IFN,FBPAYDT=FBBEGDT,X=+FBBEGDT D DAYS^FBAAUTL1 S FBDAYS=$S(X>(FBENDDT-FBBEGDT):(FBENDDT-FBBEGDT),1:X)
"RTN","FBNHEAUT",18,0)
 D GETRAT^FBNHEAU2 G:FBERR GETVEN
"RTN","FBNHEAUT",19,0)
 ;CREATE AN ENTRY IN FILE 161
"RTN","FBNHEAUT",20,0)
 K DD,DO S DLAYGO=161,DA(1)=DFN,(DIE,DIC)="^FBAAA("_DA(1)_",1,",DIC(0)="LQ",X=FBBEGDT D FILE^DICN K DLAYGO S DA=+Y,FBAAADA=DA
"RTN","FBNHEAUT",21,0)
 S DIE=DIC,FBPSADF=$S($D(FBSITE(1)):$P(^DIC(4,$P(FBSITE(1),"^",3),0),"^",1),1:"")
"RTN","FBNHEAUT",22,0)
 ; fb*3.5*103  added REFERRING PROVIDER field (161.01,104) to DR string
"RTN","FBNHEAUT",23,0)
 S DR=".02////^S X=FBENDDT;.03////^S X=7;S FBTYPE=7;100////^S X=DUZ;1////^S X=""YES"";.04////^S X=FBVEN;.095////1;101T;104;.065;.07;.021;.097"
"RTN","FBNHEAUT",24,0)
 ; DEM;139 added ICD-10 functionality for ICD-10 Project.
"RTN","FBNHEAUT",25,0)
 N XX1  ;DEM;139 added variable XX1 for ICD-10 Project.
"RTN","FBNHEAUT",26,0)
 S DR(1,161.01,1)="I FBBEGDT<$$IMPDATE^FBCSV1(""10D"") S Y=""@9"""
"RTN","FBNHEAUT",27,0)
 S DR(1,161.01,2)="@10;S EDATE=FBBEGDT;S XX1=-1 S XX1=$$ASKICD10^FBASF(""ICD DIAGNOSIS"","""");I XX1<0 S Y=""@10"";.087////^S X=XX1;K EDATE;S Y=""@999"""
"RTN","FBNHEAUT",28,0)
 S DR(1,161.01,3)="@9;.08;S:X="""" Y="""";.085;S:X="""" Y="""";.086"
"RTN","FBNHEAUT",29,0)
 S DR(1,161.01,4)="@999"
"RTN","FBNHEAUT",30,0)
 D ^DIE
"RTN","FBNHEAUT",31,0)
 I $D(DTOUT)!('$D(Y)=0) S DIC="^FBAAA("_DFN_",1," G DEL
"RTN","FBNHEAUT",32,0)
 ; fb*3.5*103  assignment of REFERRING PROVIDER (161.01,104) for recording at 162.4,15 via the FBNH ENTER 7078 input template
"RTN","FBNHEAUT",33,0)
 S FBRP=$$GET1^DIQ(161.01,FBAAADA_","_DFN,104,"I")
"RTN","FBNHEAUT",34,0)
 S FBVEN=FBVEN_";FBAAV("
"RTN","FBNHEAUT",35,0)
 ;
"RTN","FBNHEAUT",36,0)
 S X=FBPAYDT D DAYS^FBAAUTL1 S FBATODT=$S($E(FBPAYDT,1,5)_"00"+X>FBENDDT:FBENDDT-1,1:$E(FBPAYDT,1,5)_"00"+X)
"RTN","FBNHEAUT",37,0)
 D EST^FBNHEAU2
"RTN","FBNHEAUT",38,0)
 I $G(FBDEFP)'>0 W !,*7,"Unable to determine estimated dollar amount, based on authorization",!,"dates and current vendor contracts.",! S DA=FBAAADA,DA(1)=DFN,DIC="^FBAAA("_DFN_",1," G DEL
"RTN","FBNHEAUT",39,0)
 ;CHECK 1358 and get next point number. create entry in 162.4
"RTN","FBNHEAUT",40,0)
 S X=FBOBN K PRCS("A") S PRCS("TYPE")="FB" D EN1^PRCSUT31 I Y<0 S DIC="^FBAAA("_DFN_",1," D PROB^FBNHEAU1 G DEL
"RTN","FBNHEAUT",41,0)
 S FB7078=$P(FBOBN,"-",2)_"."_Y,FBSEQ=Y,DIC="^FB7078(",DIC(0)="LQ",DLAYGO=162.4,X=""""_FB7078_"""" D ^DIC K DLAYGO I Y<0 S DIC="^FBAAA("_DFN_",1," D PROB2^FBNHEAU1 G DEL
"RTN","FBNHEAUT",42,0)
 S (DA,FBAA78)=+Y
"RTN","FBNHEAUT",43,0)
 D
"RTN","FBNHEAUT",44,0)
 . N FBX
"RTN","FBNHEAUT",45,0)
 . S FBX=$$ADDUA^FBUTL9(162.4,FBAA78_",","Enter CNH 7078 authorization.")
"RTN","FBNHEAUT",46,0)
 . I 'FBX W !,"Error adding record in User Audit. Please contact IRM."
"RTN","FBNHEAUT",47,0)
 S DIE=DIC,DR="[FBNH ENTER 7078]" D ^DIE
"RTN","FBNHEAUT",48,0)
 I $O(^FBAAA(DFN,1,FBAAADA,2,0))>0 S ^FB7078(FBAA78,1,0)=^FBAAA(DFN,1,FBAAADA,2,0) F Z=0:0 S Z=$O(^FBAAA(DFN,1,FBAAADA,2,Z)) Q:Z'>0  S ^FB7078(FBAA78,1,Z,0)=^FBAAA(DFN,1,FBAAADA,2,Z,0)
"RTN","FBNHEAUT",49,0)
 S $P(^FBAAA(DFN,1,FBAAADA,0),"^",9)=FBAA78_";FB7078(",^FBAAA("AG",FBAA78_";FB7078(",DFN,FBAAADA)=""
"RTN","FBNHEAUT",50,0)
 ;call to create entries in file 161.23, time sensitive file
"RTN","FBNHEAUT",51,0)
 ;that will store patient rates
"RTN","FBNHEAUT",52,0)
 S FBERR=0 D FILE^FBNHEAU2 I FBERR W !,"Unable to create entry in Authorization Rate file (161.23).  Contact IRM.",! G ADM
"RTN","FBNHEAUT",53,0)
 ;call to create entry in ifcap 424.
"RTN","FBNHEAUT",54,0)
 S FBMM=$E(FBBEGDT,4,5)
"RTN","FBNHEAUT",55,0)
 S PRCS("TYPE")="FB" K PRCS("A") S FBNAME=$$NAME^FBCHREQ2(DFN),FBSSN=$$SSN^FBAAUTL(DFN) D NOW^%DTC S FBPOSDT=%,X=FBOBN_"^"_FBPOSDT_"^"_FBDEFP_"^^"_FBSEQ_"^"_FBNAME_"  ("_FBSSN_")"_"^"_DFN_";"_FBAA78_";"_$P(FBOBN,"-",2)_";"_FBMM D EN2^PRCS58
"RTN","FBNHEAUT",56,0)
 I +Y=0 W !!,"Error trying to Post to 1358, DID NOT POST. Error was:",!,Y,!?7,"Adjust the 1358 for $",$FN(FBDEFP,",",2)," then use the",!?7,"Post Commitments for Obligation option!",!,*7 G ADM
"RTN","FBNHEAUT",57,0)
 W !!,$J(FBDEFP,7,2),"  Posted to 1358"
"RTN","FBNHEAUT",58,0)
 ;
"RTN","FBNHEAUT",59,0)
 ;
"RTN","FBNHEAUT",60,0)
CHEKP78 S FBNUM=$P(FBSITE(1),"^",5),FBO=$P(FBSITE(1),"^",7),FBT=$P(FBSITE(1),"^",8) D FBO^FBCHP78 G END:$D(DIRUT) S IOP="Q",FB7078=FBAA78 W !
"RTN","FBNHEAUT",61,0)
 D IFCAP^FBAAUTL2
"RTN","FBNHEAUT",62,0)
 I '$D(FBERR(1)) S VAR="FB7078^FBNUM^FBO^FBT^FB(""SITE"")",VAL=FB7078_"^"_FBNUM_"^"_FBO_"^"_FBT_"^"_FB("SITE"),PGM="START^FBCHP78",%ZIS("B")="" W ! D ZIS^FBAAUTL
"RTN","FBNHEAUT",63,0)
 ;
"RTN","FBNHEAUT",64,0)
ADM S DIR(0)="Y",DIR("A")="Do you want to Admit Patient to CNH now",DIR("B")="YES" D ^DIR K DIR I Y S FBVEN=+FBVEN,FTP=FBAAADA,FBAABDT=FBBEGDT,FBAAEDT=FBENDDT,FBEND=1,FBRCHK=1 D RD2^FBNHEA
"RTN","FBNHEAUT",65,0)
 ;
"RTN","FBNHEAUT",66,0)
END D END^FBNHEAU1
"RTN","FBNHEAUT",67,0)
 Q
"RTN","FBNHEAUT",68,0)
 ;
"RTN","FBNHEAUT",69,0)
DEL S DIK=DIC D ^DIK K DIK,DIC D END^FBNHEAU1 G FBNHEAUT
"RTN","FBNHED")
0^50^B11597213^B10924946
"RTN","FBNHED",1,0)
FBNHED ;AISC/GRR - ENTER DISCHARGE FROM NURSING HOME ;1/22/15  14:38
"RTN","FBNHED",2,0)
 ;;3.5;FEE BASIS;**108,154**;JAN 30, 1995;Build 12
"RTN","FBNHED",3,0)
 ;;Per VA Directive 6402, this routine should not be modified.
"RTN","FBNHED",4,0)
RD1 D GETVET^FBAAUTL1 G:DFN']"" Q
"RTN","FBNHED",5,0)
 I '$D(^FBAACNH("AD",DFN)) W !!,*7,"Veteran does NOT have an active admission!" G RD1
"RTN","FBNHED",6,0)
RD0 S FBPROG="I $P(^(0),U,3)=7" D GETAUTH^FBAAUTL1 G RD1:FTP']"",RD1:$D(DUOUT),Q:$D(DTOUT) I FBTYPE'=7 D WRONGT^FBAAUTL1 G RD0
"RTN","FBNHED",7,0)
 S IFN=+$O(^FBAACNH("AD",DFN,0)),FBTRT="D",FB(0)=$G(^FBAACNH(IFN,0)),FBLAD=$P(FB(0),"^",1),FBLTD=$O(^FBAACNH("AF",DFN,0)) D ^FBNHDEC
"RTN","FBNHED",8,0)
RD2 S DIR(0)="DA^::EXR",DIR("A")="Enter Discharge Date/Time:  ",DIR("?")="Enter date of discharge (time is required)" D ^DIR K DIR G:$D(DIRUT)!'Y Q S FBY=+Y D DATCK2^FBAAUTL1 G:'$D(X) RD2
"RTN","FBNHED",9,0)
 ;check to see if enough rate info to date of discharge
"RTN","FBNHED",10,0)
 D DRIV^FBNHRAT(DFN,IFN,.FB,$P(FBY,".")) I $D(FBUNR) D  D Q G RD1
"RTN","FBNHED",11,0)
 .W !!,*7,"Unable to establish rates for the following timeframes:"
"RTN","FBNHED",12,0)
 .S J=0 F  S J=$O(FBUNR(J)) Q:'J  W !?5,$$DATX^FBAAUTL(J)," through ",$$DATX^FBAAUTL($O(FBUNR(J,0)))
"RTN","FBNHED",13,0)
 .W !!,*7,"You can not discharge this patient without sufficient rate information.",!,"Check your contract!"
"RTN","FBNHED",14,0)
 S FBJ=0 F  S FBJ=$O(^FBAACNH("AF",DFN,FBJ)) Q:'FBJ  S FBK=$O(^FBAACNH("AF",DFN,FBJ,0)) I $P($G(^FBAACNH(FBK,0)),"^",5)=IFN D  Q
"RTN","FBNHED",15,0)
 .I $P(^FBAACNH(FBK,0),"^",7)=3 S FBASIH=1
"RTN","FBNHED",16,0)
 S DIR(0)=$S($G(FBASIH):"S^4:ASIH;5:DEATH WHILE ASIH",1:"S^1:REGULAR;2:DEATH;3:TRANSFER TO OTHER CNH;6:REGULAR - PRIVATE PAY"),DIR("A")="Enter Discharge Type:  " D ^DIR K DIR G:$D(DIRUT) Q S FBZ=+Y
"RTN","FBNHED",17,0)
 K DD,DO S X=FBY,DIC="^FBAACNH(",DIE=DIC,DIC(0)="LM",DLAYGO=162.3 D FILE^DICN G RD1:$D(DUOUT)!($D(DTOUT)),RD2:Y<0 S DA=+Y K DIC,DLAYGO
"RTN","FBNHED",18,0)
 S DR="8////^S X=FBVEN;1////^S X=DFN;2////^S X=""D"";4////^S X=IFN;7////^S X=FBZ" D ^DIE K DIE
"RTN","FBNHED",19,0)
 D
"RTN","FBNHED",20,0)
 . N FBX
"RTN","FBNHED",21,0)
 . S FBX=$$ADDUA^FBUTL9(162.4,FB7078_",","Enter CNH discharge.")
"RTN","FBNHED",22,0)
 . I 'FBX W !,"Error adding record in User Audit. Please contact IRM."
"RTN","FBNHED",23,0)
 S DIE="^FBAACNH(",DA=IFN,DR="3///@" D ^DIE
"RTN","FBNHED",24,0)
 D UPDT
"RTN","FBNHED",25,0)
 G RD1
"RTN","FBNHED",26,0)
Q K FBTRT,FBTYPE,FBLAD,FTP,FBPROG,CNT,DAT,DIC,FBAUT,F,FBAAOUT,FBDX,FBI,FBRR,FBXX,I,PI,PTYPE,T,X,Y,Z,ZZ,FBY,FB7078,FBAAAD,FBAABDT,FBAAEDT,FBASSOC,FBAT,FBLOC,FBLTD,FBPDT,FBPOV,FBY1,FBNHED,FBUNR,DFN,IFN,FBASIH,FBJ,FBK
"RTN","FBNHED",27,0)
 K FBPSA,FBPT,FBTT,FBVEN D Q^FBNHRAT D GETAUTHK^FBAAUTL1 Q
"RTN","FBNHED",28,0)
UPDT S DA(1)=DFN,FBY1=$P(FBY,".")
"RTN","FBNHED",29,0)
 S DIE="^FBAAA("_DA(1)_",1,",DR=".02////^S X=FBY1",DA=FTP D ^DIE K DIE,DR
"RTN","FBNHED",30,0)
 K DA S DIE="^FB7078(",DR="4////^S X=FBY1",DA=FB7078 D ^DIE K DIE,DR
"RTN","FBNHED",31,0)
 ;update rate sensitive file since To Date of authorization is changed
"RTN","FBNHED",32,0)
 Q:FBY1>FBAAEDT
"RTN","FBNHED",33,0)
 S (FBO,FBAA(1))=FBAABDT,FB1=FBAAEDT,FBAA(2)=FBY1
"RTN","FBNHED",34,0)
 D UPDATE^FBNHEDA1
"RTN","FBNHED",35,0)
 K FBO,FBAA,FB1,FBZ
"RTN","FBNHED",36,0)
 Q
"RTN","FBNHEDAD")
0^51^B2542752^B1815443
"RTN","FBNHEDAD",1,0)
FBNHEDAD ;AISC/GRR - EDIT ADMISSION TYPE FOR NURSING HOME ;1/22/15  14:49
"RTN","FBNHEDAD",2,0)
 ;;3.5;FEE BASIS;**154**;JAN 30, 1995;Build 12
"RTN","FBNHEDAD",3,0)
 ;;Per VA Directive 6402, this routine should not be modified.
"RTN","FBNHEDAD",4,0)
RD1 D GETVET^FBAAUTL1 G:DFN']"" Q
"RTN","FBNHEDAD",5,0)
RD2 S DIC("S")="I $P(^(0),U,3)=""A""&($P(^(0),U,2)=DFN)",DIC="^FBAACNH(",DIE=DIC,DIC(0)="AEQMZ",DLAYGO=162.3,DIC("A")="Select Admission Date/Time: " D ^DIC K DIC,DLAYGO G RD1:X="^"!(X=""),RD2:Y<0 S DA=+Y
"RTN","FBNHEDAD",6,0)
 S DR="5;8" D ^DIE
"RTN","FBNHEDAD",7,0)
 D
"RTN","FBNHEDAD",8,0)
 . N FB,FBX,DTOUT
"RTN","FBNHEDAD",9,0)
 . S FB(161)=$S(DA:$P($G(^FBAACNH(DA,0)),"^",10),1:"")
"RTN","FBNHEDAD",10,0)
 . Q:'FB(161)
"RTN","FBNHEDAD",11,0)
 . I $D(^FBAAA(DFN,1,FB(161),0)) S FB(78)=+$P(^(0),"^",9)
"RTN","FBNHEDAD",12,0)
 . Q:'$G(FB(78))
"RTN","FBNHEDAD",13,0)
 . S FBX=$$ADDUA^FBUTL9(162.4,FB(78)_",","Edit CNH admission.")
"RTN","FBNHEDAD",14,0)
 . I 'FBX W !,"Error adding record in User Audit. Please contact IRM."
"RTN","FBNHEDAD",15,0)
 G RD1:'$D(DTOUT)
"RTN","FBNHEDAD",16,0)
Q K DIC,DIE,DR,DA,DFN,FBTYPE,FTP,Y,X,FBPROG
"RTN","FBNHEDAD",17,0)
 Q
"RTN","FBNHEDAT")
0^52^B16634471^B15561616
"RTN","FBNHEDAT",1,0)
FBNHEDAT ;AISC/GRR - ENTER/EDIT AUTHORIZATION ;9/19/2014
"RTN","FBNHEDAT",2,0)
 ;;3.5;FEE BASIS;**103,108,139,154**;JAN 30, 1995;Build 12
"RTN","FBNHEDAT",3,0)
 ;;Per VA Directive 6402, this routine should not be modified.
"RTN","FBNHEDAT",4,0)
 D SITEP^FBAAUTL
"RTN","FBNHEDAT",5,0)
RD1 S U="^" D GETVET^FBAAUTL1 G:DFN="" END
"RTN","FBNHEDAT",6,0)
 S FBPROG="I $P(^(0),U,3)=7" D GETAUTH^FBAAUTL1 G RD1:'CNT!(FTP']"")!($D(DIRUT)) S (FBOLD,FBNEW,FBERR)=""
"RTN","FBNHEDAT",7,0)
 K FBAUT,CNT S (DA(1),D0)=DFN,FBOLD=^FBAAA(DFN,1,FTP,0),DA=FTP,FBAAADA=DA,DIE="^FBAAA("_DFN_",1,",FBO=$P(FBOLD,"^"),(FB1,FBAA(2))=$P(FBOLD,"^",2)
"RTN","FBNHEDAT",8,0)
 S FBPROG=7 D DATES^FBAAUTL2 S FBAA(1)=$S($G(FBBEGDT):FBBEGDT,1:FBO),FBAA(2)=$S($G(FBENDDT):FBENDDT,1:FB1)
"RTN","FBNHEDAT",9,0)
DR S DR=".01////^S X=FBAA(1);.02////^S X=FBAA(2)"
"RTN","FBNHEDAT",10,0)
 ; fb*3.5*103  add REFERRING PROVIDER (161.01,104) to DR string
"RTN","FBNHEDAT",11,0)
 ; FB*3.5*139-ICD10 REMEDIATION-jlg - modify original code to process diagnosis code based on ICD version in DR string
"RTN","FBNHEDAT",12,0)
 S DR(1,161.01,1)="@2;.065;.07;.021;S:FBAA(1)'<$$IMPDATE^FBCSV1(""10D"") Y=""@10"";.08;S:X="""" Y=101;.085;S:X="""" Y=101;.086;S Y=101;"
"RTN","FBNHEDAT",13,0)
 S DR(1,161.01,2)="@10;N XX1;S XX1=-1;S FBDFN=DFN;S EDATE=FBAA(1);S XX1=$$ASKICD10^FBASF(""ICD DIAGNOSIS"","""","""",""Y"");S:XX1<1 Y=""@10"";.087////^S X=XX1;101;104;.097" D ^DIE
"RTN","FBNHEDAT",14,0)
 ; End 139
"RTN","FBNHEDAT",15,0)
 S FBNEW=$S('$D(DA):"",'$D(^FBAAA(DFN,1,DA,0)):"",1:^(0)) K DR
"RTN","FBNHEDAT",16,0)
 I $D(Y)>0,FBNEW=""!(FBNEW=FBOLD) G RD1
"RTN","FBNHEDAT",17,0)
 I FBNEW'=FBOLD,$P(FBNEW,"^")>$P(FBNEW,"^",2) S DR=".01////^S X=FBO;.02////^S X=FB1" D ^DIE K DR D ER G DR
"RTN","FBNHEDAT",18,0)
 ;
"RTN","FBNHEDAT",19,0)
 S FBAA78=FB7078 D ^FBNHEDA1 K FBAA78 I FBERR S DA(1)=DFN,DA=FTP,DIE="^FBAAA("_DA(1)_",1,",DR=".01////^S X=FBO;.02////^S X=FB1" D ^DIE G END
"RTN","FBNHEDAT",20,0)
 ; fb*3.5*103  add the REFERRING PROVIDER (162.4,15) to the DR string; stuff with the value stored at 161.01,104
"RTN","FBNHEDAT",21,0)
 S DIE="^FB7078(",DA=FB7078,FBAA78=DA,DR="5;6;15////^S X=$$GET1^DIQ(161.01,FBAAADA_"",""_DFN,104,""I"")" I 'DA W !!,*7,"No 7078 on file!",! G END
"RTN","FBNHEDAT",22,0)
 D:FBOLD'=FBNEW CHANGED
"RTN","FBNHEDAT",23,0)
GO D ^DIE
"RTN","FBNHEDAT",24,0)
 D
"RTN","FBNHEDAT",25,0)
 . N FBX
"RTN","FBNHEDAT",26,0)
 . S FBX=$$ADDUA^FBUTL9(162.4,FBAA78_",","Edit CNH 7078 authorization.")
"RTN","FBNHEDAT",27,0)
 . I 'FBX W !,"Error adding record in User Audit. Please contact IRM."
"RTN","FBNHEDAT",28,0)
 I $O(^FBAAA(DFN,1,FBAAADA,2,0))>0 K ^FB7078(FBAA78,1) S ^FB7078(FBAA78,1,0)=^FBAAA(DFN,1,FBAAADA,2,0) F Z=0:0 S Z=$O(^FBAAA(DFN,1,FBAAADA,2,Z)) Q:Z'>0  S ^FB7078(FBAA78,1,Z,0)=^FBAAA(DFN,1,FBAAADA,2,Z,0)
"RTN","FBNHEDAT",29,0)
RD2 S DIR(0)="Y",DIR("A")="Want to Queue 7078 for printing",DIR("B")=$S(FBOLD=FBNEW:"No",1:"Yes") D ^DIR K DIR G:Y'>0 RD1
"RTN","FBNHEDAT",30,0)
CHEKP78 S FBNUM=$P(FBSITE(1),"^",5),FBO=$P(FBSITE(1),"^",7),FBT=$P(FBSITE(1),"^",8) D FBO^FBCHP78 G END:$D(DIRUT) S IOP="Q",%ZIS("B")="",FB7078=FBAA78,FB("SITE")=$P(FBSITE(1),"^",3) W !
"RTN","FBNHEDAT",31,0)
 S VAR="FB7078^FBNUM^FBO^FBT^FB(""SITE"")",VAL=FB7078_"^"_FBNUM_"^"_FBO_"^"_FBT_"^"_FB("SITE"),PGM="START^FBCHP78" W ! D ZIS^FBAAUTL
"RTN","FBNHEDAT",32,0)
 ;
"RTN","FBNHEDAT",33,0)
END K D0,DA,FBAASKV,FBAADDYS,FBAALT,FBAAP79,FBAATT,FBNUM,FBDEV,FBO,FBT,FB7078,FBAA78,FBCOUNTY,FBDX,FBI,FBRR,FBVEN,FBTYPE,FBXX,I,J,K,PI,FBOLD,FBNEW,FBPSADF,FBAADA,FB1,FBERR,FBOUT,FBIFN,FBZ,FBBEGDT,FBENDDT,FBAUT
"RTN","FBNHEDAT",34,0)
 K DIE,DIR,FBAAADA,FTP,PGM,VAL,VAR,X,Y,Z,DIC,A,FBAABDT,FBAAEDT,FBAAOUT,FBASSOC,FBLOC,FBPOV,FBPROG,FBPSA,FBPT,FBSITE,FBTT,PTYPE,T,ZZ,FB("SITE"),FBPOP,FBAA,FBBDT,FBTDAYS,HOLDX
"RTN","FBNHEDAT",35,0)
 D END^FBNHEAU1
"RTN","FBNHEDAT",36,0)
 D GETAUTHK^FBAAUTL1
"RTN","FBNHEDAT",37,0)
 D CLOSE^FBAAUTL
"RTN","FBNHEDAT",38,0)
 Q
"RTN","FBNHEDAT",39,0)
 ;
"RTN","FBNHEDAT",40,0)
CHANGED S:$P(FBOLD,"^",1)'=$P(FBNEW,"^",1) DR="3////^S X=$P(FBNEW,U,1);"_DR
"RTN","FBNHEDAT",41,0)
 S:$P(FBOLD,"^",2)'=$P(FBNEW,"^",2) DR="4////^S X=$P(FBNEW,U,2);"_DR
"RTN","FBNHEDAT",42,0)
 Q
"RTN","FBNHEDAT",43,0)
 ;
"RTN","FBNHEDAT",44,0)
ER W !,*7,"From Date cannot be greater than the To Date.",!
"RTN","FBNHEDAT",45,0)
 Q
"RTN","FBNHEDAT",46,0)
 ;
"RTN","FBNHEDAT",47,0)
ER1 W !,*7,"This patient has movements after the authorization to date.  You must",!,"edit the patient's movements first.",!
"RTN","FBNHEDAT",48,0)
 Q
"RTN","FBNHEDDI")
0^53^B5681933^B4704875
"RTN","FBNHEDDI",1,0)
FBNHEDDI ;AISC/GRR - EDIT DISCHARGE FOR NURSING HOME ;9/19/2014
"RTN","FBNHEDDI",2,0)
 ;;3.5;FEE BASIS;**154**;JAN 30, 1995;Build 12
"RTN","FBNHEDDI",3,0)
 ;;Per VA Directive 6402, this routine should not be modified.
"RTN","FBNHEDDI",4,0)
RD1 D GETVET^FBAAUTL1 G:DFN']"" Q
"RTN","FBNHEDDI",5,0)
RD2 S DIC("S")="I $P(^(0),U,3)=""D""&($P(^(0),U,2)=DFN)",DIC="^FBAACNH(",DIE=DIC,DIC(0)="AEQMZ",DLAYGO=162.3,DIC("A")="Select Discharge Date/Time: " D ^DIC K DIC,DLAYGO G RD1:X="^"!(X=""),RD2:Y<0 S DA=+Y,FBAADT=$P(Y,U,2)
"RTN","FBNHEDDI",6,0)
 S FBDIST=$P(^FBAACNH(DA,0),U,8)
"RTN","FBNHEDDI",7,0)
 S FBJ=9999999.999999-FBAADT F  S FBJ=$O(^FBAACNH("AF",DFN,FBJ)) Q:'FBJ  S FBK=$O(^FBAACNH("AF",DFN,FBJ,0)) I $P($G(^FBAACNH(FBK,0)),"^",5)=$P(^FBAACNH(DA,0),"^",5) D  Q
"RTN","FBNHEDDI",8,0)
 .I $P(^FBAACNH(FBK,0),"^",7)=3 S FBASIH=1
"RTN","FBNHEDDI",9,0)
 S DIR(0)=$S($G(FBASIH):"S^4:ASIH;5:DEATH WHILE ASIH",1:"S^1:REGULAR;2:DEATH;3:TRANSFER TO OTHER CNH;6:REGULAR - PRIVATE PAY"),DIR("A")="Discharge Type: ",DIR("B")=FBDIST D ^DIR K DIR Q:$D(DIRUT)  S FBZ=+Y
"RTN","FBNHEDDI",10,0)
 S DR="7////^S X=FBZ" D ^DIE
"RTN","FBNHEDDI",11,0)
 D
"RTN","FBNHEDDI",12,0)
 . N FB,FBDA,FBX
"RTN","FBNHEDDI",13,0)
 . S FBDA=$P($G(^FBAACNH(DA,0)),"^",5)
"RTN","FBNHEDDI",14,0)
 . Q:'FBDA
"RTN","FBNHEDDI",15,0)
 . S FB(161)=$S(FBDA:$P($G(^FBAACNH(FBDA,0)),"^",10),1:"")
"RTN","FBNHEDDI",16,0)
 . Q:'FB(161)
"RTN","FBNHEDDI",17,0)
 . I $D(^FBAAA(DFN,1,FB(161),0)) S FB(78)=+$P(^(0),"^",9)
"RTN","FBNHEDDI",18,0)
 . Q:'$G(FB(78))
"RTN","FBNHEDDI",19,0)
 . S FBX=$$ADDUA^FBUTL9(162.4,FB(78)_",","Edit CNH discharge.")
"RTN","FBNHEDDI",20,0)
 . I 'FBX W !,"Error adding record in User Audit. Please contact IRM."
"RTN","FBNHEDDI",21,0)
 G RD1
"RTN","FBNHEDDI",22,0)
Q K DIC,DIE,DR,DA,DFN,FBTYPE,FTP,Y,X,FBPROG,FBASIH,FBK,FBJ,FBAADT,FBDIST,FBZ
"RTN","FBNHEDDI",23,0)
 Q
"RTN","FBNHEDPA")
0^33^B17524026^B15639852
"RTN","FBNHEDPA",1,0)
FBNHEDPA ;AISC/GRR - EDIT PAYMENT FOR COMMUNITY NURSING HOME ;10/7/14  17:55
"RTN","FBNHEDPA",2,0)
 ;;3.5;FEE BASIS;**61,124,132,154**;JAN 30, 1995;Build 12
"RTN","FBNHEDPA",3,0)
 ;;Per VA Directive 6402, this routine should not be modified.
"RTN","FBNHEDPA",4,0)
EDIT ;ENTRY POINT TO EDIT PAYMENT
"RTN","FBNHEDPA",5,0)
 S IOP=$S($D(ION):ION,1:"HOME") D ^%ZIS K IOP
"RTN","FBNHEDPA",6,0)
BT S DIC="^FBAA(161.7,",DIC(0)="AEQMZ",DIC("S")="I $P(^(0),U,3)=""B9""",DIC("S")=$S($D(^XUSEC("FBAA LEVEL 2",DUZ)):DIC("S"),1:DIC("S")_"&($P(^(0),U,5)=DUZ)") D ^DIC
"RTN","FBNHEDPA",7,0)
 G END:X=""!(X="^"),BT:Y<0 S FBN=+Y,FBN(0)=Y(0)
"RTN","FBNHEDPA",8,0)
 S FBSTAT=^FBAA(161.7,FBN,"ST")
"RTN","FBNHEDPA",9,0)
 I FBSTAT="C"&('$D(^XUSEC("FBAA LEVEL 2",DUZ))) W !!,*7,?3,"You must Reopen the batch prior to editing the invoice.",! G END
"RTN","FBNHEDPA",10,0)
 I FBSTAT="S"!(FBSTAT="P")!(FBSTAT="R")&('$D(^XUSEC("FBAA LEVEL 2",DUZ))) W !!,*7,?3,"You must be a holder of the 'FBAA LEVEL 2' security key",!,?3,"to edit this invoice.",! G END
"RTN","FBNHEDPA",11,0)
 I FBSTAT="T"!(FBSTAT="F")!(FBSTAT="V") W !!,?3,"Batch has already been sent to Austin for payment.",! G END
"RTN","FBNHEDPA",12,0)
INV W ! S DIC("A")="Select Invoice Number: ",DIC="^FBAAI(",DIC(0)="AEQMZ",DIC("S")="I $P(^(0),U,17)=FBN" D ^DIC K DIC G BT:X=""!(X="^"),INV:Y<0 S FBI=+Y,FBOLD(0)=Y(0)
"RTN","FBNHEDPA",13,0)
 S FBLISTC="",FBHDI=FBI W @IOF D START^FBCHDI S FBI=FBHDI K FBHDI
"RTN","FBNHEDPA",14,0)
 ;
"RTN","FBNHEDPA",15,0)
 ; enforce separation of duties
"RTN","FBNHEDPA",16,0)
 S DFN=$P(FBOLD(0),U,4)
"RTN","FBNHEDPA",17,0)
 S FB7078I=$P(FBOLD(0),U,5)
"RTN","FBNHEDPA",18,0)
 S FTP=$S(FB7078I]"":$O(^FBAAA("AG",FB7078I,DFN,0)),1:"")
"RTN","FBNHEDPA",19,0)
 I '$$UOKPAY^FBUTL9(DFN,FTP) D  G INV
"RTN","FBNHEDPA",20,0)
 . W !!,"You cannot process a payment associated with authorization ",DFN,"-",FTP
"RTN","FBNHEDPA",21,0)
 . W !,"due to separation of duties."
"RTN","FBNHEDPA",22,0)
 ;
"RTN","FBNHEDPA",23,0)
 K FBHAP,FBAP
"RTN","FBNHEDPA",24,0)
 S (DIE,DIC)="^FBAAI(",DIC(0)="AEQM",DA=FBI,DR="[FBNH EDIT PAYMENT]",DIE("NO^")=""
"RTN","FBNHEDPA",25,0)
 W !
"RTN","FBNHEDPA",26,0)
 N FBHAC
"RTN","FBNHEDPA",27,0)
 ; get values of FPPS Claim ID and Line Item
"RTN","FBNHEDPA",28,0)
 S FBFPPSC=$P($G(^FBAAI(FBI,3)),U)
"RTN","FBNHEDPA",29,0)
 S FBFPPSL=$P($G(^FBAAI(FBI,3)),U,2)
"RTN","FBNHEDPA",30,0)
 ; load current adjustment data
"RTN","FBNHEDPA",31,0)
 D LOADADJ^FBCHFA(FBI_",",.FBADJ)
"RTN","FBNHEDPA",32,0)
 ; save adjustment data prior to edit session in sorted list
"RTN","FBNHEDPA",33,0)
 S FBADJL(0)=$$ADJL^FBUTL2(.FBADJ) ; sorted list of original adjustments
"RTN","FBNHEDPA",34,0)
 ; load current remittance remark data
"RTN","FBNHEDPA",35,0)
 D LOADRR^FBCHFR(FBI_",",.FBRRMK)
"RTN","FBNHEDPA",36,0)
 ; save remittance remarks prior to edit session in sorted list
"RTN","FBNHEDPA",37,0)
 S FBRRMKL(0)=$$RRL^FBUTL4(.FBRRMK)
"RTN","FBNHEDPA",38,0)
 D ^DIE K DIE("NO^")
"RTN","FBNHEDPA",39,0)
 I $D(DTOUT) S DR="5///^S X="_$P(FBOLD(0),U,6)_";6///^S X="_$P(FBOLD(0),U,7) D ^DIE
"RTN","FBNHEDPA",40,0)
 ; if adjustment data changed then file
"RTN","FBNHEDPA",41,0)
 I $$ADJL^FBUTL2(.FBADJ)'=FBADJL(0) D FILEADJ^FBCHFA(FBI_",",.FBADJ)
"RTN","FBNHEDPA",42,0)
 ; if remit remark data changed then file
"RTN","FBNHEDPA",43,0)
 I $$RRL^FBUTL4(.FBRRMK)'=FBRRMKL(0) D FILERR^FBCHFR(FBI_",",.FBRRMK)
"RTN","FBNHEDPA",44,0)
 I $D(FBHAP),$D(FBAP),FBAP-FBHAP S FBDIF=FBAP-FBHAP,$P(^FBAA(161.7,FBN,0),"^",9)=$P(^FBAA(161.7,FBN,0),"^",9)+FBDIF
"RTN","FBNHEDPA",45,0)
END K DA,DFN,DIC,DIE,DR,FBAAOUT,FBDX,FBI,FBIN,FBLISTC,FBN,FBPROC,FBSTAT,FBVEN,FBVID,J,K,L,POP,Q,VA,VADM,X,Y,FBAC,FBAP,FBBAL,FBHAP,FBDIF
"RTN","FBNHEDPA",46,0)
 K FBADJ,FBADJL,FBRRMK,FBRRMKL,FBFPPSC,FBFPPSL,FB7078I,FTP
"RTN","FBNHEDPA",47,0)
 D KILL^FBPAY K FBOLD,FBINODE,FBPAT,FBPRGNAM
"RTN","FBNHEDPA",48,0)
 Q
"RTN","FBNHEDPA",49,0)
 ;
"RTN","FBNHEDPA",50,0)
BADDATE(INVRCVDT,TEMPDA) ;Compare edited Invoice Received Date to Treatment Date, reject if before 
"RTN","FBNHEDPA",51,0)
 I INVRCVDT="" Q 0 ;Inv Date not changed, no check necessary
"RTN","FBNHEDPA",52,0)
 N TDAT,SHODAT S TDAT=$$GET1^DIQ(162.5,TEMPDA_",",6,"I") I TDAT]"" S SHODAT="TO"
"RTN","FBNHEDPA",53,0)
 I TDAT="" S TDAT=$$GET1^DIQ(162.5,TEMPDA_",",5,"I"),SHODAT="FROM"
"RTN","FBNHEDPA",54,0)
 I INVRCVDT<TDAT D  Q 1 ;Reject entered date
"RTN","FBNHEDPA",55,0)
 .N SHOTDAT S SHOTDAT=$E(TDAT,4,5)_"/"_$E(TDAT,6,7)_"/"_$E(TDAT,2,3) ;Convert TDAT into display format for error message
"RTN","FBNHEDPA",56,0)
 .N MSG1,MSG2 S MSG1="*** Invoice Received Date cannot be before",MSG2=" Treatment "_SHODAT_" Date ("_SHOTDAT_") !!!"
"RTN","FBNHEDPA",57,0)
 .W !!?5,*7,MSG1,!?8,MSG2
"RTN","FBNHEDPA",58,0)
 Q 0 ;Date entered is OK
"RTN","FBNHEDPA",59,0)
 ;
"RTN","FBNHEDPA",60,0)
BADTDATE(TDAT,INVRCVDT,SHODAT) ;Compare edited Treatment TO or FROM Date to Invoice Received Date, reject if AFTER 
"RTN","FBNHEDPA",61,0)
 I INVRCVDT<TDAT D  Q 1 ;Reject entered date
"RTN","FBNHEDPA",62,0)
 .N SHOIRDAT S SHOIRDAT=$E(INVRCVDT,4,5)_"/"_$E(INVRCVDT,6,7)_"/"_$E(INVRCVDT,2,3) ;Convert INVRCVDT into display format for error message.
"RTN","FBNHEDPA",63,0)
 .N MSG1,MSG2 S MSG1="*** Treatment "_SHODAT_" Date cannot be after",MSG2=" Invoice Received Date ("_SHOIRDAT_") !!!"
"RTN","FBNHEDPA",64,0)
 .W !!?5,*7,MSG1,!?8,MSG2
"RTN","FBNHEDPA",65,0)
 Q 0 ;Date entered is OK
"RTN","FBNHEDPA",66,0)
 ;
"RTN","FBNHEDTR")
0^54^B7981505^B6827698
"RTN","FBNHEDTR",1,0)
FBNHEDTR ;AISC/GRR - EDIT TRANSFER TYPE FOR NURSING HOME ;9/19/2014
"RTN","FBNHEDTR",2,0)
 ;;3.5;FEE BASIS;**154**;JAN 30, 1995;Build 12
"RTN","FBNHEDTR",3,0)
 ;;Per VA Directive 6402, this routine should not be modified.
"RTN","FBNHEDTR",4,0)
RD1 D GETVET^FBAAUTL1 G:DFN']"" Q
"RTN","FBNHEDTR",5,0)
 ;
"RTN","FBNHEDTR",6,0)
RD2 S DIC("S")="I $P(^(0),U,3)=""T""&($P(^(0),U,2)=DFN)",DIC="^FBAACNH(",DIE=DIC,DIC(0)="AEQMZ",DLAYGO=162.3,DIC("A")="Select Transfer Date/Time: " D ^DIC K DIC,DLAYGO G RD1:X="^"!(X=""),RD2:Y<0 S (DA,IFN)=+Y,FBAADT=$P(Y,U,2)
"RTN","FBNHEDTR",7,0)
 S FBDA=$P(Y(0),U,5) D  I $G(FBERR) D Q G RD1
"RTN","FBNHEDTR",8,0)
 .  I $O(^FBAACNH("AC",FBDA,DA)) W !,*7,"There are movements following this transfer that must be deleted first.",!! S FBERR=1
"RTN","FBNHEDTR",9,0)
 ;
"RTN","FBNHEDTR",10,0)
 S FBTR=$P(Y(0),U,7),FBLTTYP=""
"RTN","FBNHEDTR",11,0)
 S FBJ=9999999.999999-FBAADT F  S FBJ=$O(^FBAACNH("AF",DFN,FBJ)) Q:'FBJ  S FBK=$O(^FBAACNH("AF",DFN,FBJ,0)) I $P($G(^FBAACNH(FBK,0)),"^",5)=$P(^FBAACNH(DA,0),"^",5) D  Q
"RTN","FBNHEDTR",12,0)
 . S FBLTTYP=$P(^FBAACNH(FBK,0),U,7)
"RTN","FBNHEDTR",13,0)
 S DR="@1;6;S FBNTR=X;D CHKTR^FBNHEDTR;6////^S X=FBTR;S Y=""@1"""
"RTN","FBNHEDTR",14,0)
 D ^DIE K DIE G Q:$D(DTOUT)
"RTN","FBNHEDTR",15,0)
 D
"RTN","FBNHEDTR",16,0)
 . N FB,FBX
"RTN","FBNHEDTR",17,0)
 . S FB(161)=$S(FBDA:$P($G(^FBAACNH(FBDA,0)),"^",10),1:"")
"RTN","FBNHEDTR",18,0)
 . Q:'FB(161)
"RTN","FBNHEDTR",19,0)
 . I $D(^FBAAA(DFN,1,FB(161),0)) S FB(78)=+$P(^(0),"^",9)
"RTN","FBNHEDTR",20,0)
 . Q:'$G(FB(78))
"RTN","FBNHEDTR",21,0)
 . S FBX=$$ADDUA^FBUTL9(162.4,FB(78)_",","Edit CNH transfer.")
"RTN","FBNHEDTR",22,0)
 . I 'FBX W !,"Error adding record in User Audit. Please contact IRM."
"RTN","FBNHEDTR",23,0)
 D Q G RD1
"RTN","FBNHEDTR",24,0)
 ;
"RTN","FBNHEDTR",25,0)
Q K DIC,DIE,DR,DA,DFN,FBTYPE,FTP,Y,X,FBPROG,FBTR,FBNTR,IFN,FBAADT,FBJ,FBK,FBASIH,FBDA,FBERR,FBLTTYP
"RTN","FBNHEDTR",26,0)
 Q
"RTN","FBNHEDTR",27,0)
CHKTR ;called from dr string to make sure that the transfer type is
"RTN","FBNHEDTR",28,0)
 ;consistant, that is if the old transfer type (FBTR) is a loss
"RTN","FBNHEDTR",29,0)
 ;then the new transfer type (FBNTR) is also a loss.
"RTN","FBNHEDTR",30,0)
 ;
"RTN","FBNHEDTR",31,0)
 I '$G(FBLTTYP),(FBTR>3&(FBNTR'>3)) D ERROR1 Q
"RTN","FBNHEDTR",32,0)
 I '$G(FBLTTYP),(FBTR<4&(FBNTR'<4)) D ERROR Q
"RTN","FBNHEDTR",33,0)
 S Y=""
"RTN","FBNHEDTR",34,0)
 Q
"RTN","FBNHEDTR",35,0)
 ;
"RTN","FBNHEDTR",36,0)
ERROR ;write inconsistant movement type which will reset the movement type
"RTN","FBNHEDTR",37,0)
 ;to original and allow user to re-edit.
"RTN","FBNHEDTR",38,0)
 ;
"RTN","FBNHEDTR",39,0)
 W !?5,*7,"Movement Type must be consistant. A transfer that is a loss",!?5,"may only be editted to another 'loss' type.",!
"RTN","FBNHEDTR",40,0)
 Q
"RTN","FBNHEDTR",41,0)
ERROR1 ;write inconsistant movement type 'gain', reset transfer type and re-edit
"RTN","FBNHEDTR",42,0)
 ;
"RTN","FBNHEDTR",43,0)
 W !?5,*7,"Movement Type must be consistant.  A transfer that is a gain",!?5,"may only be editted to another 'gain' type.",!
"RTN","FBNHEDTR",44,0)
 Q
"RTN","FBNHEP")
0^55^B35945966^B33126997
"RTN","FBNHEP",1,0)
FBNHEP ;AISC/GRR - ENTER NURSING HOME PAYMENT ;10/07/2014
"RTN","FBNHEP",2,0)
 ;;3.5;FEE BASIS;**25,108,154**;JAN 30, 1995;Build 12
"RTN","FBNHEP",3,0)
 ;;Per VA Directive 6402, this routine should not be modified.
"RTN","FBNHEP",4,0)
 I '$D(^FBAA(161.7,"AB","O",DUZ)) G NOBAT^FBNHEP2
"RTN","FBNHEP",5,0)
 S FBOUT=1 F I=0:0 S I=$O(^FBAA(161.7,"AB","O",DUZ,I)) Q:I'>0  I $D(^FBAA(161.7,I,0)),$P(^(0),"^",3)="B9",$P(^(0),"^",15)="" S FBOUT=0 Q
"RTN","FBNHEP",6,0)
 G:FBOUT NOBAT^FBNHEP2
"RTN","FBNHEP",7,0)
 D GETBAT^FBNHEP2 G Q:FBOUT!('$D(FBBAT)) W !
"RTN","FBNHEP",8,0)
 ;
"RTN","FBNHEP",9,0)
RD S FBAAPTC="V",FBER=0,%DT="AEPMX",%DT("A")="Payments for which Month/Year: " D ^%DT G:X="^"!(X="") Q
"RTN","FBNHEP",10,0)
 S FBPAYDT=$E(+Y,1,5)_"00",FBMM=$E(+Y,4,5),FBYY=$E(+Y,2,3),X=+Y S FBDAYS=$$DAYS^FBNHEP1(X),(FBENDDT,FBPAYEDT)=$E(+Y,1,5)_FBDAYS
"RTN","FBNHEP",11,0)
 ;
"RTN","FBNHEP",12,0)
GETVET K FB,FB7078,FBAABDT,FBAAEDT,FBASSOC,FBAT,FBAUT,FBBEG,FBDEFP,FBEND,FBHI,FBPDT,FBPOV,FBPREV,FBPROG,FBPRTR,FBPSA,FBPT,FBRIFN,FBTRDYS,FBTT,FBTYPE,FBVEN,FBZ,FTP,IFN,FBAAID,FBAAVID
"RTN","FBNHEP",13,0)
 ; check batch for room before next patient added
"RTN","FBNHEP",14,0)
 S FBX=FBAAMPI-$$B9INVC^FBNHEP2(FBBAT)
"RTN","FBNHEP",15,0)
 I FBX'>0 D  G Q
"RTN","FBNHEP",16,0)
 . W !!,"This Batch already has the maximum number of Payments!"
"RTN","FBNHEP",17,0)
 I FBX'>5 D
"RTN","FBNHEP",18,0)
 . W !,$C(7),"Warning, you can only enter ",FBX," more invoices in this batch!",!
"RTN","FBNHEP",19,0)
 K FBX
"RTN","FBNHEP",20,0)
 ;
"RTN","FBNHEP",21,0)
 S FBENDDT=$E(+FBENDDT,1,5)_$$DAYS^FBNHEP1(FBENDDT) D GETVET^FBAAUTL1 G:DFN']"" Q S FBPROG="I $P(^(0),U,3)=7,($P(^(0),U,9)'[""FB583"")" D GETAUTH^FBAAUTL1 G GETVET:FTP']"",GETVET:$D(DIRUT) K FBAAOUT
"RTN","FBNHEP",22,0)
 ;
"RTN","FBNHEP",23,0)
 ; enforce separation of duties
"RTN","FBNHEP",24,0)
 I '$$UOKPAY^FBUTL9(DFN,FTP) D  G GETVET
"RTN","FBNHEP",25,0)
 . W !!,"You cannot process a payment associated with authorization ",DFN,"-",FTP
"RTN","FBNHEP",26,0)
 . W !,"due to separation of duties."
"RTN","FBNHEP",27,0)
 ;
"RTN","FBNHEP",28,0)
 I $E(FBPAYDT,1,5)<$E(FBAABDT,1,5)!($E(FBPAYDT,1,5)>$E(FBAAEDT,1,5)) W !!,*7,"Payment Period is NOT within the veterans authorized dates!" G GETVET
"RTN","FBNHEP",29,0)
 ;
"RTN","FBNHEP",30,0)
GETVEN S FBERR=0,IFN=$G(FBVEN) D:'IFN GETVEN^FBAAUTL1 G:IFN'>0 Q S FBENDFLG=$S(FBAAEDT'>FBENDDT:1,1:""),FBENDDT=$S(FBENDDT>FBAAEDT:FBAAEDT,1:FBENDDT)
"RTN","FBNHEP",31,0)
 I $P($G(^FBAAV(+IFN,"ADEL")),U)="Y" W !!,*7,"Vendor is flagged for Austin deletion!",! G Q
"RTN","FBNHEP",32,0)
 S FBNHARUP="N" ; prevent edit of rate in CKRAT^FBNHEP2 per sep of duty 
"RTN","FBNHEP",33,0)
 K FB D CKRAT^FBNHEP2 G:FBERR GETVET
"RTN","FBNHEP",34,0)
 I $D(^FBAAI("AA",IFN,DFN,$E(FBPAYDT,1,5))) S FBINA=$O(^FBAAI("AA",IFN,DFN,$E(FBPAYDT,1,5),0)) W !!,*7,"Invoice (# ",FBINA,") already exists for treatment provided in the",!,"month and year selected.",! G CHKAHD
"RTN","FBNHEP",35,0)
 ;
"RTN","FBNHEP",36,0)
LETSGO D GETACT G:FBERR GETVET
"RTN","FBNHEP",37,0)
 D:$D(FBNOAC) CALC^FBNHEP2 G:FBERR GETVET
"RTN","FBNHEP",38,0)
 ;
"RTN","FBNHEP",39,0)
ADDMOR I '$D(FBNOAC) D DAYS^FBNHEP2,CALC1^FBNHEP2
"RTN","FBNHEP",40,0)
 I FBTRDYS>0 W !!!,"Amount based on ",FBTRDYS," days of care."
"RTN","FBNHEP",41,0)
 W !!,"    Total Amount calculated is: $",$J(FBDEFP,7,2),!
"RTN","FBNHEP",42,0)
 ;
"RTN","FBNHEP",43,0)
RD3 S DIR(0)="Y",DIR("A")="Want to Continue with Payment Entry",DIR("B")="YES" D ^DIR K DIR G ^FBNHEP1:Y,GETVET
"RTN","FBNHEP",44,0)
 ;
"RTN","FBNHEP",45,0)
GETACT D HED^FBNHDEC S (FBTRDYS,FBTRDYS(2))=0,FBPRTR="",FBNAC=$O(^FBAACNH("AG",DFN,FBVEN,$S(FBAABDT>(FBPAYDT+1):FBAABDT,1:FBPAYDT))) G:FBNAC'>0!($P(FBNAC,".")>FBENDDT) NOAC
"RTN","FBNHEP",46,0)
 ;
"RTN","FBNHEP",47,0)
 S FBRIFN=$O(^FBAACNH("AG",DFN,FBVEN,FBNAC,0)),Z=$G(^FBAACNH(FBRIFN,0)) Q:Z=""
"RTN","FBNHEP",48,0)
 I '$D(FBPNAC),$P(Z,"^",3)="T"&($P(Z,"^",7)<4) D
"RTN","FBNHEP",49,0)
 .S FBHZ=Z D GETPRV S Z=FBPRTR Q:Z=""  D DISPAC S Z=FBHZ,FBPNAC=FBPAYDT+1 D
"RTN","FBNHEP",50,0)
 ..S FBTRDYS=FBTRDYS+(($P(FBNAC,".")-FBPNAC)),FBTRDYS=$S(FBTRDYS>0:FBTRDYS,((FBAABDT<FBAAEDT)&(+$E(FBAAEDT,6,7)=1)):0,1:1)
"RTN","FBNHEP",51,0)
 S FBPNAC=FBNAC,FBCOUNT=$S($P(Z,"^",3)="A":1,$P(Z,"^",3)="T":$S($P(Z,"^",7)>3:1,1:0),1:0) S FBLTT=$P(Z,"^",3) D:FBLTT'="D" DISPAC G:$P(Z,"^",3)'="D" CONT
"RTN","FBNHEP",52,0)
 S FBHZ=Z D GETPRV S Z=FBPRTR G:FBPRTR="" GETVET D DISPAC S Z=FBHZ D DISPAC I $P(FBPRTR,"^",3)="T"&($P(FBPRTR,"^",7)<4) G SKIPC
"RTN","FBNHEP",53,0)
 S FBTRDYS=FBTRDYS+($P(FBNAC,".",1)-FBPAYDT)-1,FBTRDYS=$S(FBTRDYS>0:FBTRDYS,((FBAABDT<FBAAEDT)&(+$E(FBAAEDT,6,7)=1)):0,1:1)
"RTN","FBNHEP",54,0)
 ;
"RTN","FBNHEP",55,0)
SKIPC S FBCOUNT=0
"RTN","FBNHEP",56,0)
 ;
"RTN","FBNHEP",57,0)
CONT F I=0:0 S FBNAC=$O(^FBAACNH("AG",DFN,FBVEN,FBNAC)) Q:FBNAC'>0!($P(FBNAC,".")>FBENDDT)  S FBRIFN=$O(^FBAACNH("AG",DFN,FBVEN,FBNAC,0)) I $D(^FBAACNH(FBRIFN,0)) S Z=^(0),FBLTT=$P(Z,"^",3) D MORE
"RTN","FBNHEP",58,0)
 I FBCOUNT S FBTRDYS=FBTRDYS+(FBENDDT-$P(FBPNAC,".",1))+$S(FBLTT="D":0,FBLTT="T":$S($P(Z,"^",7)<4:0,1:1),1:1),FBTRDYS=$S(FBTRDYS>0:FBTRDYS,((FBAABDT<FBAAEDT)&(+$E(FBAAEDT,6,7)=1)):0,1:1)
"RTN","FBNHEP",59,0)
 G ENDACT
"RTN","FBNHEP",60,0)
 ;
"RTN","FBNHEP",61,0)
MORE D DISPAC S FBTRDYS=FBTRDYS+($P(FBNAC,".",1)-$P(FBPNAC,".",1)+$S(FBLTT="D":0,FBLTT="T":$S($P(Z,"^",7)<4:0,1:1),1:1)),FBTRDYS=$S(FBTRDYS>0:FBTRDYS,((FBAABDT<FBAAEDT)&(+$E(FBAAEDT,6,7)=1)):0,1:1)
"RTN","FBNHEP",62,0)
AHEAD S FBPNAC=FBNAC,FBLTT=$P(Z,"^",3),FBCOUNT=$S(FBLTT="A":1,FBLTT="T":$S($P(Z,"^",7)>3:1,1:0),1:0)
"RTN","FBNHEP",63,0)
 Q
"RTN","FBNHEP",64,0)
ENDACT K FBCOUNT,FBNAC,FBPNAC,FBLTT Q
"RTN","FBNHEP",65,0)
 ;
"RTN","FBNHEP",66,0)
GETPRV S FBPRTR="",FBPREV=$O(^FBAACNH("AF",DFN,(9999999-FBPAYDT))) G:FBPREV'>0 PROB^FBNHEP1 S (FBPIFN,FBRIFN)=$O(^(FBPREV,0)),FBPRTR=$G(^FBAACNH(FBPIFN,0))
"RTN","FBNHEP",67,0)
 Q
"RTN","FBNHEP",68,0)
 ;
"RTN","FBNHEP",69,0)
NOAC D GETPRV G:FBPRTR="" ENDACT S Z=FBPRTR,FBNOAC=1
"RTN","FBNHEP",70,0)
 W !!,"No movements during payment period. Last transaction prior was:",! D DISPAC
"RTN","FBNHEP",71,0)
 I $P(Z,"^",3)="D" W !,*7,"Veteran not provided care during Payment Period!" G ENDACT
"RTN","FBNHEP",72,0)
 I $P(Z,"^",3)="T"&($P(Z,"^",7)<4) W !,*7,"Veteran has not been in Nursing Home during Payment Period" G ENDACT
"RTN","FBNHEP",73,0)
 S FBTRDYS=$E(FBENDDT,6,7)-$G(FBENDFLG) G ENDACT
"RTN","FBNHEP",74,0)
 ;
"RTN","FBNHEP",75,0)
DISPAC S Y=$P(Z,"^"),FBTYPE=$P(Z,"^",3) D PDATE^FBAAUTL,ADD^FBNHDEC:FBTYPE="A",TRAN^FBNHDEC:FBTYPE="T",DIS^FBNHDEC:FBTYPE="D"
"RTN","FBNHEP",76,0)
 S FBZ(FBRIFN)=$P($P(Z,"^"),".")_"^"_$S($P(Z,U,3)="A":1,$P(Z,U,3)="T":$S($P(Z,U,7)>3:1,1:0),1:0)
"RTN","FBNHEP",77,0)
 Q
"RTN","FBNHEP",78,0)
 ;
"RTN","FBNHEP",79,0)
Q K %DT,FBAAAD,FBAT,FBBDT,FBIFN,FBPDT,FBTDAYS,FBPAYEDT,PSA,DIRUT,DUOUT,DTOUT,FBNOAC,FB,FBZ,FBZZ,FBDEFP,FBBEG,FBEND,FBHI,FBX1,FBAMTP,FBNHAC,DFN,FB583,FBENDFLG
"RTN","FBNHEP",80,0)
 K FBAAMPI,FBNHARUP
"RTN","FBNHEP",81,0)
 G Q^FBNHEP2
"RTN","FBNHEP",82,0)
 ;
"RTN","FBNHEP",83,0)
CHKAHD S DIR(0)="Y",DIR("A")="Do you want to continue entering this payment",DIR("B")="No" D ^DIR K DIR G GETVET:Y=0,GETVET:$D(DIRUT),LETSGO
"RTN","FBNHEP",84,0)
 Q
"RTN","FBNHET")
0^56^B9794262^B9055754
"RTN","FBNHET",1,0)
FBNHET ;AISC/GRR - ENTER TRANSFER FOR NURSING HOME ;1/22/15  14:57
"RTN","FBNHET",2,0)
 ;;3.5;FEE BASIS;**108,154**;JAN 30, 1995;Build 12
"RTN","FBNHET",3,0)
 ;;Per VA Directive 6402, this routine should not be modified.
"RTN","FBNHET",4,0)
RD1 D Q,GETVET^FBAAUTL1 G:DFN']"" Q
"RTN","FBNHET",5,0)
 I '$D(^FBAACNH("AD",DFN)) W !!,*7,"Veteran does NOT have an active admission!" G RD1
"RTN","FBNHET",6,0)
RD0 S FBPROG="I $P(^(0),U,3)=7" D GETAUTH^FBAAUTL1 G RD1:FTP']"",RD1:$D(DUOUT),Q:$D(DTOUT) I FBTYPE'=7 D WRONGT^FBAAUTL1 G RD0
"RTN","FBNHET",7,0)
 S IFN=$O(^FBAACNH("AD",DFN,0)),FBTRT="T",FBLTD=$O(^FBAACNH("AF",DFN,0)),FBIFN=$O(^FBAACNH("AF",DFN,FBLTD,0)),FBLTT=$P(^FBAACNH(FBIFN,0),"^",3),FBLTTYP=$S(FBLTT'="T":"",1:$P(^(0),"^",7))
"RTN","FBNHET",8,0)
 ;
"RTN","FBNHET",9,0)
RD2 D ^FBNHDEC
"RTN","FBNHET",10,0)
 W ! S DIR(0)="DA^::EXR",DIR("A")="Enter Transfer Date/Time: ",DIR("?")="Enter date of transfer (time is required)" D ^DIR K DIR G:$D(DIRUT)!('Y) RD1
"RTN","FBNHET",11,0)
 I $D(FBTRT),$D(FBLTD),(9999999.999999-Y)'<FBLTD D  G RD2:'$G(X)
"RTN","FBNHET",12,0)
 .  W !,*7,"The date/time must follow an existing movement.",! H 2
"RTN","FBNHET",13,0)
 .  K X
"RTN","FBNHET",14,0)
 S FBY=+Y
"RTN","FBNHET",15,0)
 S DIR(0)="S^1:TO AUTHORIZED ABSENCE;2:TO UN-AUTHORIZED ABSENCE;3:TO ASIH"
"RTN","FBNHET",16,0)
 S DIR(0)=$S('$G(FBLTTYP):DIR(0),FBLTTYP<4:"S^"_$P($T(TRANS+(3+FBLTTYP)),";;",2),1:DIR(0))
"RTN","FBNHET",17,0)
 S DIR("A")="Enter Transfer Type"
"RTN","FBNHET",18,0)
 I $G(FBLTTYP),FBLTTYP<4 S DIR("B")=$P($P(DIR(0),"^",2),":",2)
"RTN","FBNHET",19,0)
 D ^DIR K DIR
"RTN","FBNHET",20,0)
 G RD1:$D(DIRUT) S FBZ=+Y
"RTN","FBNHET",21,0)
 S (DIC,DIE)="^FBAACNH(",DIC(0)="L",DLAYGO=162.3,X=FBY
"RTN","FBNHET",22,0)
 K DD,DO D FILE^DICN K DLAYGO,DIC G RD1:$D(DIRUT),RD2:Y<0
"RTN","FBNHET",23,0)
 S DA=+Y
"RTN","FBNHET",24,0)
 S DR="8////^S X=FBVEN;Q;1////^S X=DFN;2////^S X=""T"";4////^S X=IFN;6////^S X=FBZ" D ^DIE K DIE I $D(Y)'=0 G DEL
"RTN","FBNHET",25,0)
 D
"RTN","FBNHET",26,0)
 . N FBX
"RTN","FBNHET",27,0)
 . S FBX=$$ADDUA^FBUTL9(162.4,FB7078_",","Enter CNH transfer.")
"RTN","FBNHET",28,0)
 . I 'FBX W !,"Error adding record in User Audit. Please contact IRM."
"RTN","FBNHET",29,0)
 G RD1
"RTN","FBNHET",30,0)
DEL W !!,*7,"Deleting Transfer because of incomplete transaction!" S DIK="^FBAACNH(" D ^DIK K DIK G RD1
"RTN","FBNHET",31,0)
 ;
"RTN","FBNHET",32,0)
Q K FBLTT,FBLTTYP,FBINF,FBTRT,FBLTD,DFN,IFN,DIK,FBPROG,CNT,DAT,DIC,F,FBAUT,FBDX,FBEDT,FBI,FBMULT,FBRR,FBTDT,FBXX,FTP,I,PI,PTYPE,T,X,Z,ZZ,FBAAOUT,Y,FBAABDT,FB7078,FBAAEDT,FBAAOUT,FBASSOC,FBDX,FBI,FBPOV,FBY
"RTN","FBNHET",33,0)
 K FBPSA,FBPT,I,PI,PTYPE,T,TA,VAL,FBTT,FBLOC,FBAAAD,FBAT,FBIFN,FBPDT,FBTYPE,FBVEN,DA,DR,FBASIH,FBJ,FBK,FBZ
"RTN","FBNHET",34,0)
 D GETAUTHK^FBAAUTL1
"RTN","FBNHET",35,0)
 Q
"RTN","FBNHET",36,0)
 ;
"RTN","FBNHET",37,0)
TRANS ;transfer types
"RTN","FBNHET",38,0)
 ;;1:TO AUTHORIZED ABSENCE
"RTN","FBNHET",39,0)
 ;;2:TO UNAUTHORIZED ABSENCE
"RTN","FBNHET",40,0)
 ;;3:TO ASIH
"RTN","FBNHET",41,0)
 ;;4:FROM AUTHORIZED ABSENCE
"RTN","FBNHET",42,0)
 ;;5:FROM UNAUTHORIZED ABSENCE
"RTN","FBNHET",43,0)
 ;;6:FROM ASIH < 15 DAYS
"RTN","FBNHRAT")
0^57^B14005307^B11602601
"RTN","FBNHRAT",1,0)
FBNHRAT ;AISC/CMR - POST NEW RATES FOR VETERAN ;9/19/2014
"RTN","FBNHRAT",2,0)
 ;;3.5;FEE BASIS;**154**;JAN 30, 1995;Build 12
"RTN","FBNHRAT",3,0)
 ;;Per VA Directive 6402, this routine should not be modified.
"RTN","FBNHRAT",4,0)
 S FBRATE=1 K ^TMP($J,"FB")
"RTN","FBNHRAT",5,0)
VENDOR ;select CNH vendor from the fee vendor file (161.2)
"RTN","FBNHRAT",6,0)
 S DIC="^FBAAV(",DIC(0)="AEQM",DIC("A")="Select CNH Vendor:",DIC("S")="I $P(^(0),U,9)=5" D ^DIC K DIC G Q:X=""!(X="^")!(Y<0)  S FBVIEN=+Y
"RTN","FBNHRAT",7,0)
 ;
"RTN","FBNHRAT",8,0)
VETDISP ;get patients in the selected nursing home
"RTN","FBNHRAT",9,0)
 S I=0
"RTN","FBNHRAT",10,0)
 F  S I=$O(^FBAACNH("AD",I)) Q:'I  S J=0 F  S J=+$O(^FBAACNH("AD",I,J)) Q:'J  I $P($G(^FBAACNH(J,0)),U,9)=FBVIEN S FB(0)=$G(^(0)) D DRIV(I,J,.FB) K FBNFDT,FBNTDT
"RTN","FBNHRAT",11,0)
 I '$G(FBFND) W !!,"There are presently no patients that need rates updated for this vendor."
"RTN","FBNHRAT",12,0)
Q K DIC,X,Y,FBVIEN,I,J,FB,FBTYP,FBNFDT,FBNTDT,FBAUTHN,FBAUTH,FBAFDT,FBATDT,FB7078,FBRT1,FBNFDT,FBNTDT,FBRTDT,FBIEN,FBRFDT,FBCFDT,FBI,FBCTDT,FBCNUM,FBRATE,FBFND,FBX,FBNRTDT,FBNRFDT,DUOUT,DTOUT,DIRUT,DR,DIE,FBCHFDT,FBCHTDT,FBRT,FBZ
"RTN","FBNHRAT",13,0)
 K FBRET
"RTN","FBNHRAT",14,0)
 Q
"RTN","FBNHRAT",15,0)
DRIV(I,J,FB,FBDDT) ;identify incomplete rate data for a given authorization
"RTN","FBNHRAT",16,0)
 ;INPUT   I = DFN
"RTN","FBNHRAT",17,0)
 ;        J = ien of active admission from movement file (162.3)
"RTN","FBNHRAT",18,0)
 ;        FB = passing of 0 node of mvmnt(162.3)
"RTN","FBNHRAT",19,0)
 ;        FBDDT (optional) = date of discharge
"RTN","FBNHRAT",20,0)
 ;output  FBFND = if 1 means at least 1 pt. had a rate created
"RTN","FBNHRAT",21,0)
 ;        FBUNR (only set if FBDDT passed) = array containing timeframes
"RTN","FBNHRAT",22,0)
 ;             unable to establish rates for
"RTN","FBNHRAT",23,0)
 N FBVIEN,FBAUTHN,FBAUTH,FBAFDT,FBATDT,FB7078,FBNFDT,FBNTDT,FBIEN,FBRFDT,FBRTDT,FBRT,FBCHFDT,FBCHTDT
"RTN","FBNHRAT",24,0)
 ; FBNHARUP flag (N, 1, or 11)
"RTN","FBNHRAT",25,0)
 ;   when value is true (1 or 11) rates can be changed within
"RTN","FBNHRAT",26,0)
 ;   SET^FBNHRAT1 because calling option can edit 'authorization'
"RTN","FBNHRAT",27,0)
 ;   SET^FBNHRAT1 changes the value from 1 to 11 if a rate is added
"RTN","FBNHRAT",28,0)
 N FBNHARUP
"RTN","FBNHRAT",29,0)
 S FBNHARUP=1
"RTN","FBNHRAT",30,0)
 S FBVIEN=+$P(FB(0),U,9),FBAUTHN=$P(^FBAACNH(J,0),"^",10),FBAUTH=$G(^FBAAA(I,1,FBAUTHN,0)),FBAFDT=+FBAUTH,FBATDT=$P(FBAUTH,"^",2),FB7078=+$P(FBAUTH,"^",9)
"RTN","FBNHRAT",31,0)
 I $G(FBDDT) S FBAFDT=$S($$DTC^FBUCUTL(DT,FBAFDT)>730:$$CDTC^FBUCUTL(DT,-730),1:FBAFDT) Q:FBAFDT>FBDDT
"RTN","FBNHRAT",32,0)
 ;checks rate file, if no rates exist it will create one
"RTN","FBNHRAT",33,0)
 I '$D(^FBAA(161.23,"AC",FB7078)) S FBNFDT=FBAFDT,FBNTDT=$S($G(FBDDT):FBDDT,1:FBATDT) D VENDAT^FBNHRAT1 D:FBNHARUP=11  Q
"RTN","FBNHRAT",34,0)
 . N FBX
"RTN","FBNHRAT",35,0)
 . S FBX=$$ADDUA^FBUTL9(162.4,FB7078_",","Add CNH rate(s).")
"RTN","FBNHRAT",36,0)
 . I 'FBX W !,"Error adding record in User Audit. Please contact IRM."
"RTN","FBNHRAT",37,0)
 ;set up array of existing rates
"RTN","FBNHRAT",38,0)
 K FBRT S FBIEN=0 F  S FBIEN=$O(^FBAA(161.23,"AC",FB7078,FBIEN)) Q:'$G(FBIEN)  S FB(1)=$G(^FBAA(161.23,FBIEN,0)),FBRFDT=+FB(1),FBRT(FBRFDT)=FB(1) K FB(1)
"RTN","FBNHRAT",39,0)
 ;FBCHFDT and FBCHTDT are check dates (initially = to auth fr & to dates,  they are incremented based on existing rates throughout the check)
"RTN","FBNHRAT",40,0)
 S FBCHFDT=FBAFDT,FBCHTDT=$S($G(FBDDT):FBDDT,1:FBATDT),FBRFDT=0 D GETRAT,CKFRDT
"RTN","FBNHRAT",41,0)
 I FBNHARUP=11 D
"RTN","FBNHRAT",42,0)
 . N FBX
"RTN","FBNHRAT",43,0)
 . S FBX=$$ADDUA^FBUTL9(162.4,FB7078_",","Add CNH rate(s).")
"RTN","FBNHRAT",44,0)
 . I 'FBX W !,"Error adding record in User Audit. Please contact IRM."
"RTN","FBNHRAT",45,0)
 Q
"RTN","FBNHRAT",46,0)
GETRAT ;gets next rate from rate array
"RTN","FBNHRAT",47,0)
 S FBRFDT=+$O(FBRT(FBRFDT)) Q:'FBRFDT  S FBRTDT=$P(FBRT(FBRFDT),"^",2) Q
"RTN","FBNHRAT",48,0)
CKFRDT ;comparison of from dates
"RTN","FBNHRAT",49,0)
 Q:FBCHFDT>FBCHTDT
"RTN","FBNHRAT",50,0)
 I FBCHFDT=FBRFDT G CKTODT
"RTN","FBNHRAT",51,0)
 I FBCHFDT<FBRFDT S FBNFDT=FBCHFDT,FBNTDT=$S($$CDTC^FBUCUTL(FBRFDT,-1)>FBCHTDT:FBCHTDT,1:$$CDTC^FBUCUTL(FBRFDT,-1)) D VENDAT^FBNHRAT1 S FBCHFDT=$$CDTC^FBUCUTL(FBNTDT,1) K FBNFDT,FBNTDT G CKFRDT
"RTN","FBNHRAT",52,0)
 I FBCHFDT>FBRFDT Q:FBCHFDT>FBCHTDT  I 'FBRFDT S FBNFDT=FBCHFDT,FBNTDT=FBCHTDT D VENDAT^FBNHRAT1 K FBNFDT,FBNTDT Q
"RTN","FBNHRAT",53,0)
 I FBCHFDT>FBRFDT G CKTODT
"RTN","FBNHRAT",54,0)
 Q
"RTN","FBNHRAT",55,0)
CKTODT ;comparison of to dates
"RTN","FBNHRAT",56,0)
 Q:FBCHTDT=FBRTDT!(FBCHTDT<FBRTDT)
"RTN","FBNHRAT",57,0)
 I FBCHFDT'>FBRTDT S FBCHFDT=$$CDTC^FBUCUTL(FBRTDT,1)
"RTN","FBNHRAT",58,0)
 D GETRAT G CKFRDT
"RTN","FBNHRAT1")
0^58^B7549171^B6737249
"RTN","FBNHRAT1",1,0)
FBNHRAT1 ;AISC/CMR - ENTER RATES CONT. ;9/19/2014
"RTN","FBNHRAT1",2,0)
 ;;3.5;FEE BASIS;**17,154**;JAN 30, 1995;Build 12
"RTN","FBNHRAT1",3,0)
 ;;Per VA Directive 6402, this routine should not be modified.
"RTN","FBNHRAT1",4,0)
VENDAT ;set up rate if contract exists
"RTN","FBNHRAT1",5,0)
 N FBRATE,FBCFDT,FBCTDT,FBI,FBCNUM,FBNRFDT,FBNRTDT
"RTN","FBNHRAT1",6,0)
 S FBCFDT=0
"RTN","FBNHRAT1",7,0)
 I '$O(^FBAA(161.21,"AC",FBVIEN,0)) D:$G(FBDDT) CKSET(FBNFDT,FBNTDT) Q
"RTN","FBNHRAT1",8,0)
VENDAT1 K FBRET
"RTN","FBNHRAT1",9,0)
 S FBCFDT=$O(^FBAA(161.21,"AC",FBVIEN,FBCFDT))
"RTN","FBNHRAT1",10,0)
 I FBCFDT']"" D:$G(FBDDT) CKSET(FBNFDT,FBNTDT) Q
"RTN","FBNHRAT1",11,0)
 S FBI=$O(^FBAA(161.21,"AC",FBVIEN,FBCFDT,0)) I FBI]"" S FBCTDT=$P(^FBAA(161.21,FBI,0),"^",3),FBCNUM=$P(^FBAA(161.21,FBI,0),"^")
"RTN","FBNHRAT1",12,0)
 I FBNFDT=FBCFDT!(FBNFDT>FBCFDT) D  G:$G(FBRET) VENDAT1 Q
"RTN","FBNHRAT1",13,0)
 .I FBNFDT>FBCTDT S FBRET=1 Q
"RTN","FBNHRAT1",14,0)
 .I FBNTDT=FBCTDT D SET(FBNFDT,FBNTDT,I) Q
"RTN","FBNHRAT1",15,0)
 .I FBNTDT<FBCTDT D SET(FBNFDT,FBNTDT,I) Q
"RTN","FBNHRAT1",16,0)
 .I FBNTDT>FBCTDT D SET(FBNFDT,FBCTDT,I) S FBNFDT=$$CDTC^FBUCUTL(FBCTDT,1),FBRET=1 Q
"RTN","FBNHRAT1",17,0)
 I FBNFDT<FBCFDT D  G:$G(FBRET) VENDAT1 Q
"RTN","FBNHRAT1",18,0)
 .I FBNTDT<FBCFDT D:$G(FBDDT) CKSET(FBNFDT,FBNTDT) Q
"RTN","FBNHRAT1",19,0)
 .I FBNTDT'>FBCTDT D:$G(FBDDT) CKSET(FBNFDT,$$CDTC^FBUCUTL(FBCFDT,-1)) S FBNFDT=FBCFDT D SET(FBNFDT,FBNTDT,I) Q
"RTN","FBNHRAT1",20,0)
 .I FBNTDT>FBCTDT D:$G(FBDDT) CKSET(FBNFDT,$$CDTC^FBUCUTL(FBCFDT,-1)) S FBNFDT=FBCFDT D SET(FBNFDT,FBCTDT,I) S FBNFDT=$$CDTC^FBUCUTL(FBCTDT,1),FBRET=1 Q
"RTN","FBNHRAT1",21,0)
 Q
"RTN","FBNHRAT1",22,0)
SET(FBFR,FBTO,FBDFN) ;set up rate array for pt
"RTN","FBNHRAT1",23,0)
 ;FBFR and FBTO are from and to dates to establish rates for
"RTN","FBNHRAT1",24,0)
 ;FBDFN=DFN for pt.
"RTN","FBNHRAT1",25,0)
 ;FBNHARUP (optional)
"RTN","FBNHRAT1",26,0)
 ;  if = "N" the call is during payment and a rate cannot be added
"RTN","FBNHRAT1",27,0)
 ;  if = 1 rates are being monitored and a rate has not been added yet
"RTN","FBNHRAT1",28,0)
 ;  if = 11 rates are being monitored and a rate has been added
"RTN","FBNHRAT1",29,0)
 ;output FBFND=1 to indicate that a gap was found to create a rate for
"RTN","FBNHRAT1",30,0)
 ;       FBNHARUP (optional) changed from 1 to 11 if rate added
"RTN","FBNHRAT1",31,0)
 S FBFND=1
"RTN","FBNHRAT1",32,0)
 W !!,*7,"Patient: ",$$NAME^FBCHREQ2(FBDFN),?40,"SSN: ",$$SSN^FBAAUTL(FBDFN)
"RTN","FBNHRAT1",33,0)
 W !,?5,"Rate must be entered for the following period: ",$$DATX^FBAAUTL(FBFR)," - ",$$DATX^FBAAUTL(FBTO)
"RTN","FBNHRAT1",34,0)
 I $G(FBNHARUP)'="N" S FBRATE=1 ; when not "N" allow rate to be added
"RTN","FBNHRAT1",35,0)
 D DISPLAY^FBAAVD1 K FBX I '$G(FBRATE) D:$G(FBDDT) CKSET(FBFR,FBTO) Q
"RTN","FBNHRAT1",36,0)
 K DD,DO S DIC="^FBAA(161.23,",DIC(0)="L",X=FBFR,DIC("DR")=".02////^S X=FBTO;.03////^S X=FB7078;.04////^S X=FBDFN;.05////^S X=FBRATE;.06////^S X=FBCNUM",DLAYGO=161.23 D FILE^DICN K DLAYGO,DIC,X
"RTN","FBNHRAT1",37,0)
 I $G(FBNHARUP)=1 S FBNHARUP=11 ; let caller know a rate was added
"RTN","FBNHRAT1",38,0)
 Q
"RTN","FBNHRAT1",39,0)
CKSET(FRDT,TODT) ;sets FBUNR array for timeframe unable to establish rate for.
"RTN","FBNHRAT1",40,0)
 ;FBUNR array is only set if variable FBDDT is passed to subroutine
"RTN","FBNHRAT1",41,0)
 ;and the attempt to create a rate (call to VENDAT) was unsuccessful.
"RTN","FBNHRAT1",42,0)
 ;FBUNR array, if defined, is returned to calling program.
"RTN","FBNHRAT1",43,0)
 ;FRDT=from date TODT=to date  of unsuccessful rate setup
"RTN","FBNHRAT1",44,0)
 S FBUNR(FRDT,TODT)=""
"RTN","FBNHRAT1",45,0)
 Q
"RTN","FBNHRC")
0^59^B14502667^B13819457
"RTN","FBNHRC",1,0)
FBNHRC ;AISC/CMR - RATE CHANGE DURING AN AUTHORIZATION ;9/22/2014
"RTN","FBNHRC",2,0)
 ;;3.5;FEE BASIS;**108,154**;JAN 30, 1995;Build 12
"RTN","FBNHRC",3,0)
 ;;Per VA Directive 6402, this routine should not be modified.
"RTN","FBNHRC",4,0)
 S DIC="^FBAAA(",DIC(0)="AEQMZ",DIC("A")="Select Fee Basis Patient: " D ^DIC K DIC G:$D(DTOUT)!($D(DUOUT))!(Y<0) END S DFN=+Y,FBNAME=Y(0,0)
"RTN","FBNHRC",5,0)
 S FBPROG="I $P(^(0),""^"",3)=7" D GETAUTH^FBAAUTL1 G END:'$G(FB7078)
"RTN","FBNHRC",6,0)
 S FBCNT=0 D SORT I FBCNT'>0 W !!,*7,"No rate information on file for this authorization." G END
"RTN","FBNHRC",7,0)
ASK W !! S DIR(0)="DA^"_FBSTART_":"_FBEND_":EX",DIR("A")="Enter effective date of rate change: ",DIR("?")="Date must fall within authorization dates" D ^DIR K DIR
"RTN","FBNHRC",8,0)
 G END:$D(DIRUT)!('Y) S FBEDT=+Y
"RTN","FBNHRC",9,0)
 ;Get rate that will be affected by change
"RTN","FBNHRC",10,0)
 S FBN=0 F  S FBN=$O(^FBAA(161.23,"AC",FB7078,FBN)) Q:'FBN  Q:(FBEDT'>$P($G(^FBAA(161.23,+FBN,0)),"^",2))&($P($G(^FBAA(161.23,+FBN,0)),"^")'>FBEDT)
"RTN","FBNHRC",11,0)
 I FBN S FBRATE=1,FBCNUM=$P(^FBAA(161.23,FBN,0),"^",6),FBVIEN=FBVEN,FBREDT=$P(^(0),"^",2),FBRBDT=$P(^(0),"^") W !! D DISPLAY^FBAAVD1 G END:'$G(FBRATE) I FBRATE'=$P(^FBAA(161.23,FBN,0),"^",5) S (DIC,DIE)="^FBAA(161.23,",DA=FBN D
"RTN","FBNHRC",12,0)
 .I FBRBDT=FBEDT S DR=".05////^S X=FBRATE" D ^DIE
"RTN","FBNHRC",13,0)
 .I FBRBDT'=FBEDT S DR=".02////^S X="_$$CDTC^FBUCUTL(FBEDT,-1) D ^DIE K DIE,DA,DD,DO S DIC(0)="L",DLAYGO=161.23,X=FBEDT,DIC("DR")=".02////^S X=FBREDT;.03////^S X=FB7078;.04////^S X=DFN;.05////^S X=FBRATE;.06////^S X=FBCNUM" D FILE^DICN
"RTN","FBNHRC",14,0)
 . N FBX
"RTN","FBNHRC",15,0)
 . S FBX=$$ADDUA^FBUTL9(162.4,FB7078_",","Change CNH rate.")
"RTN","FBNHRC",16,0)
 . I 'FBX W !,"Error adding record in User Audit. Please contact IRM."
"RTN","FBNHRC",17,0)
 K DIE,DIC,DR,DA,DLAYGO
"RTN","FBNHRC",18,0)
 D SORT
"RTN","FBNHRC",19,0)
 W !! S DIR(0)="Y",DIR("A")="Do you want to change other rates associated with this Authorization",DIR("B")="No" D ^DIR K DIR G:Y ASK
"RTN","FBNHRC",20,0)
END K FBNAME,DFN,FB7078,FBAABDT,FBAAEDT,FBAAOUT,FBASSOC,FBAUT,FBPOV,FBPROG,FBPSA,FBPT,FBTT,FBTYPE,FBVEN,FTP,CNT,FBAR,FBCFD,FBCNT,FBCNUM,FBCTD,FBEDT,FBEND,FBN,FBN1,FBRATE,FBRBDT,FBREDT,FBSTART,FBVIEN,FBX,X,Y,Z,FBAR1
"RTN","FBNHRC",21,0)
 D GETAUTHK^FBAAUTL1
"RTN","FBNHRC",22,0)
 Q
"RTN","FBNHRC",23,0)
SORT D HED
"RTN","FBNHRC",24,0)
 S FBN=0 F  S FBN=$O(^FBAA(161.23,"AC",FB7078,FBN)) Q:'FBN  S FBN1=^FBAA(161.23,FBN,0),FBCNUM=$P(FBN1,"^",6),FBCFD=$P(FBN1,"^"),FBCTD=$P(FBN1,"^",2),FBRATE=$P(FBN1,"^",5) I FBCFD'>FBAAEDT S FBAR(FBCFD)=FBCTD_"^"_FBCNUM_"^"_FBRATE
"RTN","FBNHRC",25,0)
 S (FBCFD,FBAAOUT)=0 F  S FBCFD=$O(FBAR(FBCFD)) Q:'FBCFD!(FBAAOUT)  S FBCNT=FBCNT+1,FBAR1=FBAR(FBCFD) D DISPLAY
"RTN","FBNHRC",26,0)
 I FBCNT'>0 Q
"RTN","FBNHRC",27,0)
 S FBEND=+FBAR1,FBSTART=$O(FBAR(0))
"RTN","FBNHRC",28,0)
 Q
"RTN","FBNHRC",29,0)
DISPLAY ;Write out rates affected by contract
"RTN","FBNHRC",30,0)
 I $Y+5>IOSL S DIR(0)="E" D ^DIR K DIR I 'Y S FBAAOUT=1 Q
"RTN","FBNHRC",31,0)
 I $Y+5>IOSL D HED
"RTN","FBNHRC",32,0)
 W !!?5,$$DATX^FBAAUTL(FBCFD),?25,$$DATX^FBAAUTL(+FBAR1),?40,"$ ",$J($FN($P(FBAR1,"^",3),",",2),8),?55,$P(FBAR1,"^",2)
"RTN","FBNHRC",33,0)
 Q
"RTN","FBNHRC",34,0)
HED W @IOF,!,?20,"CURRENT RATE INFORMATION FOR ",$$NAME^FBCHREQ2(DFN)
"RTN","FBNHRC",35,0)
 W !!!?5,"FROM DATE",?25,"TO DATE",?40,"RATE",?55,"CONTRACT #",! F I=1:1:79 W "_"
"RTN","FBNHRC",36,0)
 Q
"RTN","FBPMRG")
0^66^B47383810^B41268230
"RTN","FBPMRG",1,0)
FBPMRG ;WCIOFO/SAB - FEE BASIS PATIENT MERGE ROUTINE ;6/4/2014
"RTN","FBPMRG",2,0)
 ;;3.5;FEE BASIS;**19,41,59,154**;JAN 30, 1995;Build 12
"RTN","FBPMRG",3,0)
 ;;Per VA Directive 6402, this routine should not be modified.
"RTN","FBPMRG",4,0)
EN(ARRAY) ; Entry point
"RTN","FBPMRG",5,0)
 ; Called during patient (file #2) merge due to AFFECTS RECORD MERGE
"RTN","FBPMRG",6,0)
 ;   in PACKAGE (#9.4) file.
"RTN","FBPMRG",7,0)
 ; Input
"RTN","FBPMRG",8,0)
 ;   ARRAY - name of array with the PATIENT (#2) From IENs and To IENs
"RTN","FBPMRG",9,0)
 ;           format: name(ien_from,ien_to,"ien_from;DPT(","ien_to;DPT(")
"RTN","FBPMRG",10,0)
 ;           example: TEST(1000,500,"1000;DPT(","500;DPT(")=""
"RTN","FBPMRG",11,0)
 ;
"RTN","FBPMRG",12,0)
 N FBFR,FBTO
"RTN","FBPMRG",13,0)
 ; loop thru from ien of patients (file #2) being merged
"RTN","FBPMRG",14,0)
 S FBFR=0 F  S FBFR=$O(@ARRAY@(FBFR)) Q:FBFR'>0  D
"RTN","FBPMRG",15,0)
 . S FBTO=$O(@ARRAY@(FBFR,0)) ; to ien
"RTN","FBPMRG",16,0)
 . ; check/update some Fee Basis files that normal merge can't handle
"RTN","FBPMRG",17,0)
 . D F161
"RTN","FBPMRG",18,0)
 . D F162^FBPMRG1
"RTN","FBPMRG",19,0)
 Q
"RTN","FBPMRG",20,0)
 ;
"RTN","FBPMRG",21,0)
F161 ; File 161 FEE BASIS PATIENT - The .01 field points to and is
"RTN","FBPMRG",22,0)
 ; dinumed with the PATIENT (#2) file
"RTN","FBPMRG",23,0)
 ; input
"RTN","FBPMRG",24,0)
 ;   FBFR - ien of patient (files #2,161) being merged from
"RTN","FBPMRG",25,0)
 ;   FBTO - ien of patient (files #2,161) being merged to
"RTN","FBPMRG",26,0)
 N FBFR1,FBTO1
"RTN","FBPMRG",27,0)
 N DA,DD,DIC,DIK,DINUM,DLAYGO,DO,X,Y
"RTN","FBPMRG",28,0)
 ;
"RTN","FBPMRG",29,0)
 Q:'$D(^FBAAA(FBFR))  ; nothing to merge from
"RTN","FBPMRG",30,0)
 ;
"RTN","FBPMRG",31,0)
 ;
"RTN","FBPMRG",32,0)
IDCARD ; if both records have id card numbers the pairs are removed from merge.
"RTN","FBPMRG",33,0)
 ; all other cases will be handled by merge.
"RTN","FBPMRG",34,0)
 ;
"RTN","FBPMRG",35,0)
 I $P($G(^FBAAA(FBFR,4)),U) D
"RTN","FBPMRG",36,0)
 .I $P($G(^FBAAA(FBTO,4)),U) D
"RTN","FBPMRG",37,0)
 ..; remove pair from merge when there is a id number in the from and to
"RTN","FBPMRG",38,0)
 ..S IENFRM=$O(@ARRAY@(FBFR,FBTO,""))
"RTN","FBPMRG",39,0)
 ..S IENTO=$O(@ARRAY@(FBFR,FBTO,IENFRM,""))
"RTN","FBPMRG",40,0)
 ..S IEN=""
"RTN","FBPMRG",41,0)
 ..S IEN=+$G(@ARRAY@(FBFR,FBTO,IENFRM,IENTO))
"RTN","FBPMRG",42,0)
 ..D RMOVPAIR^XDRDVAL1(FBFR,FBTO,IEN,ARRAY)
"RTN","FBPMRG",43,0)
 ..N XMSUB,XMTEXT
"RTN","FBPMRG",44,0)
 ..S XMSUB="MERGE PAIRS EXCLUDED DUE TO BOTH HAVE FEE BASIS ID CARDS"
"RTN","FBPMRG",45,0)
 ..S ^TMP("DDB",$J,1)="  MERGE PAIR Patient records "_FBFR_" AND "_FBTO_" both have FB ID card numbers.   Please cancel one of the IDs and resubmit the Merge Pair"
"RTN","FBPMRG",46,0)
 ..S XMTEXT="^TMP(""DDB"",$J,"
"RTN","FBPMRG",47,0)
 ..D SENDMESG^XDRDVAL1(XMSUB,XMTEXT)
"RTN","FBPMRG",48,0)
 ..K IEN,IENTO,IENFRM
"RTN","FBPMRG",49,0)
 ;
"RTN","FBPMRG",50,0)
 ;
"RTN","FBPMRG",51,0)
 Q:'$D(^FBAAA(FBTO))  ; if only from ien exists then standard process OK
"RTN","FBPMRG",52,0)
 ;
"RTN","FBPMRG",53,0)
 ; both from ien and to ien are in the FEE BASIS PATIENT file.
"RTN","FBPMRG",54,0)
 ; The AUTHORIZATION multiple and REPORT OF CONTACT multiple can have
"RTN","FBPMRG",55,0)
 ; duplicate .01 values so they need to be handled here since the
"RTN","FBPMRG",56,0)
 ; standard merge would inappropriately combine subfile entries whose
"RTN","FBPMRG",57,0)
 ; .01 values match. Additionally, if the ien of an AUTHORIZATION must
"RTN","FBPMRG",58,0)
 ; be changed when moved from the 'from ien' to the 'to ien', then
"RTN","FBPMRG",59,0)
 ; the free-text pointers that reference that AUTHORIZATION will need
"RTN","FBPMRG",60,0)
 ; to be updated.
"RTN","FBPMRG",61,0)
 ;
"RTN","FBPMRG",62,0)
 ; loop thru authorization multiple in 'from ien'
"RTN","FBPMRG",63,0)
 S FBFR1=0 F  S FBFR1=$O(^FBAAA(FBFR,1,FBFR1)) Q:'FBFR1  D
"RTN","FBPMRG",64,0)
 . ;
"RTN","FBPMRG",65,0)
 . ; create new entry in authorization multiple of 'to ien'
"RTN","FBPMRG",66,0)
 . K DD,DO,DA
"RTN","FBPMRG",67,0)
 . S DIC="^FBAAA("_FBTO_",1,",DIC(0)="L"
"RTN","FBPMRG",68,0)
 . S DA(1)=FBTO
"RTN","FBPMRG",69,0)
 . S X=$P($G(^FBAAA(FBFR,1,FBFR1,0)),U)
"RTN","FBPMRG",70,0)
 . Q:X=""  ; can't add without a from date
"RTN","FBPMRG",71,0)
 . I $D(@(DIC_FBFR1_")"))=0 S DINUM=FBFR1 ; use same ien if available
"RTN","FBPMRG",72,0)
 . S DLAYGO=161.01
"RTN","FBPMRG",73,0)
 . D FILE^DICN K DIC,DINUM,DLAYGO
"RTN","FBPMRG",74,0)
 . Q:$P(Y,U,3)'=1  ; couldn't add new authorization
"RTN","FBPMRG",75,0)
 . S FBTO1=+Y
"RTN","FBPMRG",76,0)
 . ;
"RTN","FBPMRG",77,0)
 . ; move data
"RTN","FBPMRG",78,0)
 . M ^FBAAA(FBTO,1,FBTO1)=^FBAAA(FBFR,1,FBFR1)
"RTN","FBPMRG",79,0)
 . ;
"RTN","FBPMRG",80,0)
 . ; delete 'from authorization'
"RTN","FBPMRG",81,0)
 . S DIK="^FBAAA("_FBFR_",1,"
"RTN","FBPMRG",82,0)
 . S DA(1)=FBFR,DA=FBFR1
"RTN","FBPMRG",83,0)
 . D ^DIK K DA,DIK
"RTN","FBPMRG",84,0)
 . ;
"RTN","FBPMRG",85,0)
 . ; index 'to authorization'
"RTN","FBPMRG",86,0)
 . S DIK="^FBAAA("_FBTO_",1,"
"RTN","FBPMRG",87,0)
 . S DA(1)=FBTO,DA=FBTO1
"RTN","FBPMRG",88,0)
 . D IX1^DIK K DA,DIK
"RTN","FBPMRG",89,0)
 . ;
"RTN","FBPMRG",90,0)
 . ; if authorization ien was changed then update any pointers to it
"RTN","FBPMRG",91,0)
 . I FBFR1'=FBTO1 D UAUTHP
"RTN","FBPMRG",92,0)
 ;
"RTN","FBPMRG",93,0)
 ; loop thru report of contact multiple in 'from ien'
"RTN","FBPMRG",94,0)
 S FBFR1=0 F  S FBFR1=$O(^FBAAA(FBFR,2,FBFR1)) Q:'FBFR1  D
"RTN","FBPMRG",95,0)
 . ;
"RTN","FBPMRG",96,0)
 . ; create new entry in report of contact multiple of 'to ien'
"RTN","FBPMRG",97,0)
 . K DD,DO,DA
"RTN","FBPMRG",98,0)
 . S DIC="^FBAAA("_FBTO_",2,",DIC(0)="L"
"RTN","FBPMRG",99,0)
 . S DA(1)=FBTO
"RTN","FBPMRG",100,0)
 . S X=$P($G(^FBAAA(FBFR,1,FBFR1,0)),U)
"RTN","FBPMRG",101,0)
 . Q:X=""  ; can't add without a date of contact
"RTN","FBPMRG",102,0)
 . I $D(@(DIC_FBFR1_")"))=0 S DINUM=FBFR1 ; use same ien if available
"RTN","FBPMRG",103,0)
 . S DLAYGO=161.02
"RTN","FBPMRG",104,0)
 . D FILE^DICN K DIC,DINUM,DLAYGO
"RTN","FBPMRG",105,0)
 . Q:$P(Y,U,3)'=1  ; couldn't add new report of contact
"RTN","FBPMRG",106,0)
 . S FBTO1=+Y
"RTN","FBPMRG",107,0)
 . ;
"RTN","FBPMRG",108,0)
 . ; move data
"RTN","FBPMRG",109,0)
 . M ^FBAAA(FBTO,2,FBTO1)=^FBAAA(FBFR,2,FBFR1)
"RTN","FBPMRG",110,0)
 . ;
"RTN","FBPMRG",111,0)
 . ; delete 'from report of contact'
"RTN","FBPMRG",112,0)
 . S DIK="^FBAAA("_FBFR_",2,"
"RTN","FBPMRG",113,0)
 . S DA(1)=FBFR,DA=FBFR1
"RTN","FBPMRG",114,0)
 . D ^DIK K DA,DIK
"RTN","FBPMRG",115,0)
 . ;
"RTN","FBPMRG",116,0)
 . ; index 'to report of contact'
"RTN","FBPMRG",117,0)
 . S DIK="^FBAAA("_FBTO_",2,"
"RTN","FBPMRG",118,0)
 . S DA(1)=FBTO,DA=FBTO1
"RTN","FBPMRG",119,0)
 . D IX1^DIK
"RTN","FBPMRG",120,0)
 ;
"RTN","FBPMRG",121,0)
 Q
"RTN","FBPMRG",122,0)
 ;
"RTN","FBPMRG",123,0)
UAUTHP ; Update 'free-text' pointers to authorization
"RTN","FBPMRG",124,0)
 ; input
"RTN","FBPMRG",125,0)
 ;   FBFR  - ien of patient (files #2,161) being merged from
"RTN","FBPMRG",126,0)
 ;   FBFR1 - ien of authorization in FBFR
"RTN","FBPMRG",127,0)
 ;   FBTO  - ien of patient (files #2,161) being merged to
"RTN","FBPMRG",128,0)
 ;   FBTO1 - ien of authorization in FBTO
"RTN","FBPMRG",129,0)
 N AUTHP,DA,DIE,DR,X,X1,Y
"RTN","FBPMRG",130,0)
 ;
"RTN","FBPMRG",131,0)
 Q:FBFR1=FBTO1  ; same value so nothing to update
"RTN","FBPMRG",132,0)
 ;
"RTN","FBPMRG",133,0)
 ; update file 161.26 FEE BASIS PATIENT MRA
"RTN","FBPMRG",134,0)
 ; use "B" x-ref to find patient
"RTN","FBPMRG",135,0)
 K DA S DA=0 F  S DA=$O(^FBAA(161.26,"B",FBFR,DA)) Q:'DA  D
"RTN","FBPMRG",136,0)
 . ; if existing authorization pointer refers to the authorization
"RTN","FBPMRG",137,0)
 . ; that was changed then update it
"RTN","FBPMRG",138,0)
 . S AUTHP=$P($G(^FBAA(161.26,DA,0)),U,3)
"RTN","FBPMRG",139,0)
 . I AUTHP=FBFR1 D
"RTN","FBPMRG",140,0)
 . . S DIE="^FBAA(161.26,"
"RTN","FBPMRG",141,0)
 . . S DR="2////^S X=FBTO1"
"RTN","FBPMRG",142,0)
 . . D ^DIE
"RTN","FBPMRG",143,0)
 ;
"RTN","FBPMRG",144,0)
 ; update file 162 FEE BASIS PAYMENT
"RTN","FBPMRG",145,0)
 ; use "AFN" cross-reference on AUTHORIZATION POINTER (#15.5) field
"RTN","FBPMRG",146,0)
 K DA S DA(3)=FBFR ; patient
"RTN","FBPMRG",147,0)
 ; loop thru vendor IENs
"RTN","FBPMRG",148,0)
 S DA(2)=0 F  S DA(2)=$O(^FBAAC("AFN",FBFR1,DA(3),DA(2))) Q:'DA(2)  D
"RTN","FBPMRG",149,0)
 . ; loop thru initial treatment date IENs
"RTN","FBPMRG",150,0)
 . S DA(1)=0
"RTN","FBPMRG",151,0)
 . F  S DA(1)=$O(^FBAAC("AFN",FBFR1,DA(3),DA(2),DA(1))) Q:'DA(1)  D
"RTN","FBPMRG",152,0)
 . . ; loop thru service provided IENs
"RTN","FBPMRG",153,0)
 . . S DA=0
"RTN","FBPMRG",154,0)
 . . F  S DA=$O(^FBAAC("AFN",FBFR1,DA(3),DA(2),DA(1),DA)) Q:'DA  D
"RTN","FBPMRG",155,0)
 . . . ; update authorization pointer in the service provided multiple
"RTN","FBPMRG",156,0)
 . . . S DIE="^FBAAC("_DA(3)_",1,"_DA(2)_",1,"_DA(1)_",1,"
"RTN","FBPMRG",157,0)
 . . . S DR="15.5////^S X=FBTO1"
"RTN","FBPMRG",158,0)
 . . . D ^DIE
"RTN","FBPMRG",159,0)
 ;
"RTN","FBPMRG",160,0)
 ; update file 162 FEE BASIS PAYMENT - TRAVEL PAYMENT DATE multiple
"RTN","FBPMRG",161,0)
 K DA S DA(1)=FBFR ; patient
"RTN","FBPMRG",162,0)
 ; loop thru travel payments for patient
"RTN","FBPMRG",163,0)
 S DA=0 F  S DA=$O(^FBAAC(DA(1),3,DA)) Q:'DA  D
"RTN","FBPMRG",164,0)
 . ; if existing authorization pointer refers to the authorization
"RTN","FBPMRG",165,0)
 . ; that was changed then update it
"RTN","FBPMRG",166,0)
 . S AUTHP=$P($G(^FBAAC(DA(1),3,DA,1)),U,1)
"RTN","FBPMRG",167,0)
 . I AUTHP=FBFR1 D
"RTN","FBPMRG",168,0)
 . . S DIE="^FBAAC("_DA(1)_",3,"
"RTN","FBPMRG",169,0)
 . . S DR="15////^S X=FBTO1"
"RTN","FBPMRG",170,0)
 . . D ^DIE
"RTN","FBPMRG",171,0)
 ;
"RTN","FBPMRG",172,0)
 ; update file 162.1 FEE BASIS PHARMACY INVOICE
"RTN","FBPMRG",173,0)
 ; use "AD" x-ref to find patient
"RTN","FBPMRG",174,0)
 ; loop thru inverse dates for 'from patient'
"RTN","FBPMRG",175,0)
 K DA S X1="" F  S X1=$O(^FBAA(162.1,"AD",FBFR,X1)) Q:X1=""  D
"RTN","FBPMRG",176,0)
 . ; loop thru invoices
"RTN","FBPMRG",177,0)
 . S DA(1)=0 F  S DA(1)=$O(^FBAA(162.1,"AD",FBFR,X1,DA(1))) Q:'DA(1)  D
"RTN","FBPMRG",178,0)
 . . ; loop thru prescriptions
"RTN","FBPMRG",179,0)
 . . S DA=0 F  S DA=$O(^FBAA(162.1,"AD",FBFR,X1,DA(1),DA)) Q:'DA  D
"RTN","FBPMRG",180,0)
 . . . ; if existing authorization pointer refers to the authorization
"RTN","FBPMRG",181,0)
 . . . ; that was changed then update it
"RTN","FBPMRG",182,0)
 . . . S AUTHP=$P($G(^FBAA(162.1,DA(1),"RX",DA,2)),U,7)
"RTN","FBPMRG",183,0)
 . . . I AUTHP=FBFR1 D
"RTN","FBPMRG",184,0)
 . . . . S DIE="^FBAA(162.1,"_DA(1)_",""RX"","
"RTN","FBPMRG",185,0)
 . . . . S DR="27////^S X=FBTO1"
"RTN","FBPMRG",186,0)
 . . . . D ^DIE
"RTN","FBPMRG",187,0)
 ;
"RTN","FBPMRG",188,0)
 ; update file 162.3 FEE CNH ACTIVITY
"RTN","FBPMRG",189,0)
 ; use "AE" x-ref to find patient
"RTN","FBPMRG",190,0)
 K DA S DA="" F  S DA=$O(^FBAACNH("AE",FBFR,DA)) Q:'DA  D
"RTN","FBPMRG",191,0)
 . ; if existing authorization pointer refers to the authorization
"RTN","FBPMRG",192,0)
 . ; that was changed then update it
"RTN","FBPMRG",193,0)
 . S AUTHP=$P($G(^FBAACNH(DA,0)),U,10)
"RTN","FBPMRG",194,0)
 . I AUTHP=FBFR1 D
"RTN","FBPMRG",195,0)
 . . S DIE="^FBAACNH("
"RTN","FBPMRG",196,0)
 . . S DR="9////^S X=FBTO1"
"RTN","FBPMRG",197,0)
 . . D ^DIE
"RTN","FBPMRG",198,0)
 ;
"RTN","FBPMRG",199,0)
 ; update file 162.7 FEE BASIS UNAUTHORIZED CLAIM
"RTN","FBPMRG",200,0)
 ; using "D" x-ref to find patient
"RTN","FBPMRG",201,0)
 ; loop thru claims for patient
"RTN","FBPMRG",202,0)
 K DA S DA=0 F  S DA=$O(^FB583("D",FBFR,DA)) Q:'DA  D
"RTN","FBPMRG",203,0)
 . ; if existing authorization pointer refers to the authorization
"RTN","FBPMRG",204,0)
 . ; that was changed then update it
"RTN","FBPMRG",205,0)
 . S AUTHP=$P($G(^FB583(DA,0)),U,27)
"RTN","FBPMRG",206,0)
 . I AUTHP=FBFR1 D
"RTN","FBPMRG",207,0)
 . . S DIE="^FB583("
"RTN","FBPMRG",208,0)
 . . S DR="30////^S X=FBTO1"
"RTN","FBPMRG",209,0)
 . . D ^DIE
"RTN","FBPMRG",210,0)
 Q
"RTN","FBPMRG",211,0)
 ;
"RTN","FBPMRG",212,0)
 ;FBPMRG
"RTN","FBRXFED")
0^10^B15191002^B16142590
"RTN","FBRXFED",1,0)
FBRXFED ;WOIFO/SAB - FPPS DATA EDIT PHARMACY INVOICE ;5/16/14  15:15
"RTN","FBRXFED",2,0)
 ;;3.5;FEE BASIS;**61,154**;JAN 30, 1995;Build 12
"RTN","FBRXFED",3,0)
 ;;Per VA Directive 6402, this routine should not be modified.
"RTN","FBRXFED",4,0)
 ;
"RTN","FBRXFED",5,0)
 S FBAAOUT=0
"RTN","FBRXFED",6,0)
 F  D INVED Q:FBAAOUT
"RTN","FBRXFED",7,0)
 D CLEAN
"RTN","FBRXFED",8,0)
 Q
"RTN","FBRXFED",9,0)
 ;
"RTN","FBRXFED",10,0)
INVED ; Invoice Edit
"RTN","FBRXFED",11,0)
 ;
"RTN","FBRXFED",12,0)
ASKINV ; Select Invoice to Edit
"RTN","FBRXFED",13,0)
 W ! S DIC="^FBAA(162.1,",DIC(0)="AEQM",DIC("A")="Select Invoice #: "
"RTN","FBRXFED",14,0)
 ; screen on invoices with completed status and EDI
"RTN","FBRXFED",15,0)
 S DIC("S")="I $P(^(0),U,5)=4&($P(^(0),U,13)]"""")"
"RTN","FBRXFED",16,0)
 D ^DIC K DIC I Y'>0 S FBAAOUT=1 Q
"RTN","FBRXFED",17,0)
 S FBDA=+Y
"RTN","FBRXFED",18,0)
 ;
"RTN","FBRXFED",19,0)
 I $$CKFPPS^FBFHLL(FBDA)'=1 D  G ASKINV
"RTN","FBRXFED",20,0)
 . W !?5,"Invoice ",FBDA," has not been transmitted to FPPS."
"RTN","FBRXFED",21,0)
 ;
"RTN","FBRXFED",22,0)
 ; save FPPS Claim ID data prior to edit session
"RTN","FBRXFED",23,0)
 S (FBFPPSC,FBFPPSC(0))=$P($G(^FBAA(162.1,FBDA,0)),U,13)
"RTN","FBRXFED",24,0)
 S FBINVCHG=0 ; initialize invoice changed flag
"RTN","FBRXFED",25,0)
 ;
"RTN","FBRXFED",26,0)
EDITFC ; edit FPPS CLAIM ID
"RTN","FBRXFED",27,0)
 S FBX=$$FPPSC^FBUTL5(1,FBFPPSC)
"RTN","FBRXFED",28,0)
 I FBX=-1 S FBAAOUT=1 G INVEDX
"RTN","FBRXFED",29,0)
 ; need to verify if following restriction is appropriate
"RTN","FBRXFED",30,0)
 I FBX="" D  G EDITFC
"RTN","FBRXFED",31,0)
 . W !,$C(7),"Can not change EDI from YES to NO on invoice that has been sent to FPPS!"
"RTN","FBRXFED",32,0)
 S FBFPPSC=FBX
"RTN","FBRXFED",33,0)
 ;
"RTN","FBRXFED",34,0)
 ; if FPPS CLAIM ID changed, then update file, audit log, and Rx's
"RTN","FBRXFED",35,0)
 I FBFPPSC'=FBFPPSC(0) D
"RTN","FBRXFED",36,0)
 . ; set invoice changed flag
"RTN","FBRXFED",37,0)
 . S FBINVCHG=1
"RTN","FBRXFED",38,0)
 . ;
"RTN","FBRXFED",39,0)
 . ; file data in 162.1
"RTN","FBRXFED",40,0)
 . K FBFDA
"RTN","FBRXFED",41,0)
 . S FBFDA(162.1,FBDA_",",13)=$S(FBFPPSC="":"@",1:FBFPPSC)
"RTN","FBRXFED",42,0)
 . I $D(FBFDA) D FILE^DIE("","FBFDA") D MSG^DIALOG()
"RTN","FBRXFED",43,0)
 . ;
"RTN","FBRXFED",44,0)
 . ; add record to audit log
"RTN","FBRXFED",45,0)
 . K FBFDA
"RTN","FBRXFED",46,0)
 . S FBFDA(163.7,"+1,",.01)=FBDA ; invoice number
"RTN","FBRXFED",47,0)
 . S FBFDA(163.7,"+1,",1)=$$NOW^XLFDT() ; date/time changed
"RTN","FBRXFED",48,0)
 . S FBFDA(163.7,"+1,",2)=162.1 ; file #
"RTN","FBRXFED",49,0)
 . S FBFDA(163.7,"+1,",3)=FBDA_"," ; iens
"RTN","FBRXFED",50,0)
 . S FBFDA(163.7,"+1,",4)=13 ; field #
"RTN","FBRXFED",51,0)
 . S FBFDA(163.7,"+1,",5)=FBFPPSC(0) ; old value
"RTN","FBRXFED",52,0)
 . S FBFDA(163.7,"+1,",6)=FBFPPSC ; new value
"RTN","FBRXFED",53,0)
 . S FBFDA(163.7,"+1,",7)=DUZ ; user
"RTN","FBRXFED",54,0)
 . I $D(FBFDA) D UPDATE^DIE("","FBFDA") D MSG^DIALOG()
"RTN","FBRXFED",55,0)
 . ;
"RTN","FBRXFED",56,0)
 . ; update Rx's (would only apply if EDI status can change)
"RTN","FBRXFED",57,0)
 . D CKINVEDI^FBAAEPI1(FBFPPSC(0),FBFPPSC,FBDA)
"RTN","FBRXFED",58,0)
 ;
"RTN","FBRXFED",59,0)
ASKRX ; Select Prescription to Edit
"RTN","FBRXFED",60,0)
 W !
"RTN","FBRXFED",61,0)
 S DIC="^FBAA(162.1,"_FBDA_",""RX"",",DIC(0)="AEQM"
"RTN","FBRXFED",62,0)
 S DIC("W")="W ?30,""DATE RX FILLED: "",$E($P(^(0),U,3),4,5)_""/""_$E($P(^(0),U,3),6,7)_""/""_$E($P(^(0),U,3),2,3)"
"RTN","FBRXFED",63,0)
 D ^DIC I $D(DUOUT) S FBAAOUT=1 G INVEDX
"RTN","FBRXFED",64,0)
 I Y'>0 D  G:$D(DIRUT)!(Y=1) INVEDX G ASKRX
"RTN","FBRXFED",65,0)
 . S DIR(0)="Y"
"RTN","FBRXFED",66,0)
 . S DIR("A")="Are you finished editing prescriptions on invoice "_FBDA
"RTN","FBRXFED",67,0)
 . D ^DIR K DIR I $D(DIRUT) S FBAAOUT=1
"RTN","FBRXFED",68,0)
 S FBRXDA=+Y
"RTN","FBRXFED",69,0)
 ;
"RTN","FBRXFED",70,0)
 ; get current value of FPPS LINE ITEM to use as default
"RTN","FBRXFED",71,0)
 S (FBFPPSL(0),FBFPPSL)=$P($G(^FBAA(162.1,FBDA,"RX",FBRXDA,3)),U)
"RTN","FBRXFED",72,0)
 ;
"RTN","FBRXFED",73,0)
EDITFL ; edit FPPS Line Item
"RTN","FBRXFED",74,0)
 S FBX=$$FPPSL^FBUTL5(FBFPPSL)
"RTN","FBRXFED",75,0)
 I FBX=-1 S FBAAOUT=1 G INVEDX
"RTN","FBRXFED",76,0)
 ; need to verify if following restriction is appropriate
"RTN","FBRXFED",77,0)
 S FBFPPSL=FBX
"RTN","FBRXFED",78,0)
 ;
"RTN","FBRXFED",79,0)
 ; if FPPS LINE ITEM changed, then update file and audit log
"RTN","FBRXFED",80,0)
 I FBFPPSL'=FBFPPSL(0) D
"RTN","FBRXFED",81,0)
 . ; set invoice changed flag
"RTN","FBRXFED",82,0)
 . S FBINVCHG=1
"RTN","FBRXFED",83,0)
 . ;
"RTN","FBRXFED",84,0)
 . ; file data in 162.11
"RTN","FBRXFED",85,0)
 . K FBFDA
"RTN","FBRXFED",86,0)
 . S FBFDA(162.11,FBRXDA_","_FBDA_",",36)=FBFPPSL
"RTN","FBRXFED",87,0)
 . I $D(FBFDA) D FILE^DIE("","FBFDA") D MSG^DIALOG()
"RTN","FBRXFED",88,0)
 . ;
"RTN","FBRXFED",89,0)
 . ; add record to audit log
"RTN","FBRXFED",90,0)
 . K FBFDA
"RTN","FBRXFED",91,0)
 . S FBFDA(163.7,"+1,",.01)=FBDA ; invoice number
"RTN","FBRXFED",92,0)
 . S FBFDA(163.7,"+1,",1)=$$NOW^XLFDT() ; date/time changed
"RTN","FBRXFED",93,0)
 . S FBFDA(163.7,"+1,",2)=162.11 ; file #
"RTN","FBRXFED",94,0)
 . S FBFDA(163.7,"+1,",3)=FBRXDA_","_FBDA_"," ; iens
"RTN","FBRXFED",95,0)
 . S FBFDA(163.7,"+1,",4)=36 ; field #
"RTN","FBRXFED",96,0)
 . S FBFDA(163.7,"+1,",5)=FBFPPSL(0) ; old value
"RTN","FBRXFED",97,0)
 . S FBFDA(163.7,"+1,",6)=FBFPPSL ; new value
"RTN","FBRXFED",98,0)
 . S FBFDA(163.7,"+1,",7)=DUZ ; user
"RTN","FBRXFED",99,0)
 . I $D(FBFDA) D UPDATE^DIE("","FBFDA") D MSG^DIALOG()
"RTN","FBRXFED",100,0)
 ;
"RTN","FBRXFED",101,0)
 G ASKRX
"RTN","FBRXFED",102,0)
 ;
"RTN","FBRXFED",103,0)
INVEDX ; Invoice Edit Exit
"RTN","FBRXFED",104,0)
 ; if invoice changed then queue for retransmit to FPPS
"RTN","FBRXFED",105,0)
 I FBINVCHG D FILEQUE^FBFHLL(FBDA,5)
"RTN","FBRXFED",106,0)
 Q
"RTN","FBRXFED",107,0)
 ;
"RTN","FBRXFED",108,0)
CLEAN K DIC,DIR,DIROUT,DIRUT,DTOUT,DUOUT,X,Y
"RTN","FBRXFED",109,0)
 K FBAAOUT,FBDA,FBFDA,FBFPPSC,FBFPPSL,FBINVCHG,FBRXDA,FBX
"RTN","FBRXFED",110,0)
 Q
"RTN","FBRXFED",111,0)
 ;FBRXFED
"RTN","FBUCDD1")
0^67^B12232651^B14731515
"RTN","FBUCDD1",1,0)
FBUCDD1 ;ALBISC/TET - DD UTILITY (cont'd.) ;4/23/2015
"RTN","FBUCDD1",2,0)
 ;;3.5;FEE BASIS;**60,72,127,154**;JAN 30, 1995;Build 12
"RTN","FBUCDD1",3,0)
 ;;Per VA Directive 6402, this routine should not be modified.
"RTN","FBUCDD1",4,0)
DEL(DA) ;del node on .01 field of 162.7, unauthorized claim file
"RTN","FBUCDD1",5,0)
 ;INPUT:  DA = ien of 162.7
"RTN","FBUCDD1",6,0)
 I 1 N FBORDER,FBZ S FBZ=$$FBZ^FBUCUTL(DA) S FBORDER=$$ORDER^FBUCUTL(+$P(FBZ,U,24)) W ! W:FBORDER'<40 "Disposition to Cancel/Withdrawn." W:FBORDER<40 "Use the Delete Unauthorized Claim option." W !
"RTN","FBUCDD1",7,0)
 Q
"RTN","FBUCDD1",8,0)
DEV(X) ;input transform on field 33, UNAUTHORIZED CLAIM PRINTER, file 161.4
"RTN","FBUCDD1",9,0)
 ;check x, and if x is a device, with subtype beginning with p(rinter)
"RTN","FBUCDD1",10,0)
 ;INPUT:  X - FM variable, input
"RTN","FBUCDD1",11,0)
 ;OUTPUT: 1 to kill x (invalid entry), otherwise 0
"RTN","FBUCDD1",12,0)
 Q $S('$D(X):1,'$$DEVICE(X):1,1:0)
"RTN","FBUCDD1",13,0)
 ;
"RTN","FBUCDD1",14,0)
SUBTYPE(X) ;extrinsic call for subtype check
"RTN","FBUCDD1",15,0)
 ;INPUT:  X = internal entry of device
"RTN","FBUCDD1",16,0)
 ;OUTPUT: 1 if subtype is a printer
"RTN","FBUCDD1",17,0)
 N Z1,Z2 S Z1=$S('$D(X):0,'+X:0,1:X),Z2=0 S Z2=+$G(^%ZIS(1,X,"SUBTYPE")),Z2=$P($G(^%ZIS(2,Z2,0)),U)
"RTN","FBUCDD1",18,0)
 Q $S(Z2']"":0,$E(Z2,1)="P":1,1:0)
"RTN","FBUCDD1",19,0)
 ;
"RTN","FBUCDD1",20,0)
DEVICE(X) ;extrinsic call for device ien
"RTN","FBUCDD1",21,0)
 ;INPUT:  X = name
"RTN","FBUCDD1",22,0)
 ;OUTPUT: 1 if device with printer subtype
"RTN","FBUCDD1",23,0)
 N Z1 S Z1=0,Z1=+$O(^%ZIS(1,"B",X,0))
"RTN","FBUCDD1",24,0)
 Q $S('Z1:0,'$$SUBTYPE(Z1):0,1:1)
"RTN","FBUCDD1",25,0)
 ;
"RTN","FBUCDD1",26,0)
XHELP ;executable help from field 33, UNAUTHORIZED CLAIM PRINTER, file 161.4
"RTN","FBUCDD1",27,0)
 ;displays printer selection
"RTN","FBUCDD1",28,0)
 D HOME^%ZIS H 1 W @IOF,!,"Select a printer device name.",!,"NOTE:  This is not a pointer field, the exact name must be entered."
"RTN","FBUCDD1",29,0)
 W !!,?5,"Printer name:",?40,"Location:",!,?5,"-------------",?40,"---------"
"RTN","FBUCDD1",30,0)
 N FBX,FBXZ,FBX1 S FBX=0 F  S FBX=$O(^%ZIS(1,FBX)) Q:'FBX  I $$SUBTYPE(FBX) S FBXZ=$G(^%ZIS(1,FBX,0)),FBX1=$G(^(1)) D  G:$D(DTOUT)!($D(DUOUT)) XHELPQ
"RTN","FBUCDD1",31,0)
 .I ($Y+5)>IOSL S DIR(0)="E" D ^DIR K DIR Q:$D(DTOUT)!($D(DUOUT))  W @IOF,!!,?5,"Printer name:",?40,"Location:",!,?5,"-------------",?40,"---------"
"RTN","FBUCDD1",32,0)
 .W !?5,$P(FBXZ,U),?40,$P(FBX1,U)
"RTN","FBUCDD1",33,0)
XHELPQ W ! K DIR,DTOUT,DUOUT Q
"RTN","FBUCDD1",34,0)
ID(Y) ;display identifiers
"RTN","FBUCDD1",35,0)
 N FBZ S FBZ=$$FBZ^FBUCUTL(+Y)  Q:Y']""  W ?15,$E($$VET^FBUCUTL(+$P(FBZ,U,4)),1,20),?38,$E($$VEN^FBUCUTL(+$P(FBZ,U,3)),1,20)
"RTN","FBUCDD1",36,0)
 W ?61,$E($$PROG^FBUCUTL(+$P(FBZ,U,2)),1,14),!,$E($P($$PTR^FBUCUTL("^FB(162.92,",+$P(FBZ,U,24)),U),1,16)
"RTN","FBUCDD1",37,0)
 W ?19,"TREATMENT FROM: ",$$DATX^FBAAUTL(+$P(FBZ,U,5)),?44,"TREATMENT TO: ",$$DATX^FBAAUTL(+$P(FBZ,U,6))
"RTN","FBUCDD1",38,0)
 W ! Q
"RTN","FBUCDD1",39,0)
 ;
"RTN","FBUCDD1",40,0)
DELA(DA,M) ;delete authorization node
"RTN","FBUCDD1",41,0)
 ;INPUT:  DA = ien of authorization (161.01)
"RTN","FBUCDD1",42,0)
 ;        DA(1)= ien of patient (161)
"RTN","FBUCDD1",43,0)
 ;        M=message (optional) 1 to print;0 to not print
"RTN","FBUCDD1",44,0)
 ;VAR:  M, 2nd piece = message to print:  1 for payments, 2 for 7078/583
"RTN","FBUCDD1",45,0)
 ;OUTPUT: 0 if ok to delete; 1 if should not delete
"RTN","FBUCDD1",46,0)
 ;        message may write explaining why cannot delete
"RTN","FBUCDD1",47,0)
 I $S('$G(DA):1,'$G(DA(1)):1,1:0) G DELAQ
"RTN","FBUCDD1",48,0)
 S:'$G(M) M=0
"RTN","FBUCDD1",49,0)
 N FBI,FBVAR
"RTN","FBUCDD1",50,0)
 S FBVAR=$P($G(^FBAAA(DA(1),1,DA,0)),U,9)
"RTN","FBUCDD1",51,0)
 I $D(^FBAAC("AFN",DA,DA(1))) S $P(M,U,2)=1 ; payments in file 162
"RTN","FBUCDD1",52,0)
 I FBVAR]"",$$PAY^FBUCUTL($P(FBVAR,";"),$P(FBVAR,";",2)) S $P(M,U,2)=1
"RTN","FBUCDD1",53,0)
 I $P(^FBAAA(DA(1),1,DA,0),U,13)=2!($P(^FBAAA(DA(1),1,DA,0),U,13)=3) S $P(M,U,2)=3
"RTN","FBUCDD1",54,0)
 I '$P(M,U,2),FBVAR]"" S $P(M,U,2)=2
"RTN","FBUCDD1",55,0)
 I +M,$P(M,U,2) D
"RTN","FBUCDD1",56,0)
 .D:$P(M,U,2)=1 EN^DDIOL("Cannot delete Authorization because payments already exist!","","!!")
"RTN","FBUCDD1",57,0)
 .D:$P(M,U,2)=2 EN^DDIOL("Cannot delete Authorization because a 7078/583 entry exists!","","!!")
"RTN","FBUCDD1",58,0)
 .D:$P(M,U,2)=3 EN^DDIOL("Cannot delete Authorization, please create a Delete type Veteran MRA!","","!!")
"RTN","FBUCDD1",59,0)
 .D EN^DDIOL(" ")
"RTN","FBUCDD1",60,0)
DELAQ Q $S('+$P($G(M),U,2):0,$P(M,U,2):1,1:0)
"RTN","FBUCED")
0^72^B41181903^B41125299
"RTN","FBUCED",1,0)
FBUCED ;ALBISC/TET - EDIT UNAUTHORIZED CLAIM FILES ;10/07/2014
"RTN","FBUCED",2,0)
 ;;3.5;FEE BASIS;**32,38,154**;JAN 30, 1995;Build 12
"RTN","FBUCED",3,0)
 ;;Per VA Directive 6402, this routine should not be modified.
"RTN","FBUCED",4,0)
EDT ;edit unauthorized claim with order less than 40 (not dispositioned
"RTN","FBUCED",5,0)
 ;or order = 40 if action is reopen (called by REO tag)
"RTN","FBUCED",6,0)
 S:'$D(FBACT) FBACT="EDT" S FBO=$S(FBACT="EDT":"5^10^20^30^",1:"40^")
"RTN","FBUCED",7,0)
 D LOOKUP^FBUCUTL3(FBO) I 'FBOUT S FBDR="[FB UNAUTHORIZED EDIT]" D EDIT^FBUCED0(FBDR,FBACT,.FBOUT,FBARY)
"RTN","FBUCED",8,0)
 G END Q
"RTN","FBUCED",9,0)
REO ;reopen a dispositioned claim (order of 40)
"RTN","FBUCED",10,0)
 S FBACT="REO" G EDT
"RTN","FBUCED",11,0)
 Q
"RTN","FBUCED",12,0)
APL ;appeal a dispostioned claim (order of 40)
"RTN","FBUCED",13,0)
 S FBACT="APL",FBO="40^" D LOOKUP^FBUCUTL3(FBO) I 'FBOUT S FBDR="[FB UNAUTHORIZED APPEAL]" D EDIT^FBUCED0(FBDR,FBACT,.FBOUT,FBARY)
"RTN","FBUCED",14,0)
 G END Q
"RTN","FBUCED",15,0)
AED ;edit an appeal to an unauthorized claim
"RTN","FBUCED",16,0)
 S FBACT="AED",FBO="50^55^60^70^" D LOOKUP^FBUCUTL3(FBO) I 'FBOUT S FBDR="[FB UNAUTHORIZED APPEAL EDIT]" D EDIT^FBUCED0(FBDR,FBACT,.FBOUT,FBARY)
"RTN","FBUCED",17,0)
 G END Q
"RTN","FBUCED",18,0)
COVA ;enter/edit a COVA appeal
"RTN","FBUCED",19,0)
 S FBACT="COVA",FBO="70^80^90^" D LOOKUP^FBUCUTL3(FBO) I 'FBOUT S FBDR="[FB UNAUTHORIZED COVA APPEAL]" D EDIT^FBUCED0(FBDR,FBACT,.FBOUT,FBARY)
"RTN","FBUCED",20,0)
 G END Q
"RTN","FBUCED",21,0)
DIS ;disposition an appeal
"RTN","FBUCED",22,0)
 S FBACT="DIS",FBO=0 D LOOKUP^FBUCUTL3(FBO) I 'FBOUT S FBDR="[FB UNAUTHORIZED DISPOSITION]" D EDIT^FBUCED0(FBDR,FBACT,.FBOUT,FBARY)
"RTN","FBUCED",23,0)
 G END Q
"RTN","FBUCED",24,0)
REC ;receive information which was requested
"RTN","FBUCED",25,0)
 S FBACT="REC",FBO="5^10^50^55^" D LOOKUP^FBUCUTL3(FBO) I 'FBOUT,+$G(FBARY) H:+FBARY=1 1 D EDIT8
"RTN","FBUCED",26,0)
 G END
"RTN","FBUCED",27,0)
REQ ;request information
"RTN","FBUCED",28,0)
 S FBACT="REQ",FBO="5^10^20^30^50^55^" D LOOKUP^FBUCUTL3(FBO) I 'FBOUT,+$G(FBARY) D EDIT8
"RTN","FBUCED",29,0)
 G:$G(FBOUT) END D END W !! G REQ
"RTN","FBUCED",30,0)
LET ;to update date letter printed without printing letter
"RTN","FBUCED",31,0)
 N FBLETDT D DISPNP^FBUCUTL3 ;set array of letters which are waiting to be printed
"RTN","FBUCED",32,0)
 D DISPX^FBUCUTL1(1) ;display array for selection
"RTN","FBUCED",33,0)
 I 'FBOUT,+$G(FBARY) D LETDATE^FBUCUTL3 I 'FBOUT D
"RTN","FBUCED",34,0)
 .N FBDA,FBEXP,FBI,FBLET,FBNODE,FBPL,FBUCA D PARSE^FBUCUTL4(FBARY) S FBI=0,FBLET="@" S FBLETDT=$S('+FBLETDT:DT,1:FBLETDT)
"RTN","FBUCED",35,0)
 .F  S FBI=$O(^TMP("FBARY",$J,FBI)) Q:'FBI  S FBNODE=$G(^(FBI)),FBDA=+FBNODE,FBUCA=$G(^FB583(FBDA,0)),FBEXP=$$EXPIRE^FBUCUTL8(FBDA,FBLETDT,FBUCA,$$ORDER^FBUCUTL($P(FBUCA,U,24))) D EDITL(FBDA,FBEXP,FBLET,FBLETDT)
"RTN","FBUCED",36,0)
 G END
"RTN","FBUCED",37,0)
EXT ;enter extensions for incomplete Mill Bill claims
"RTN","FBUCED",38,0)
 ;
"RTN","FBUCED",39,0)
 ; select mill bill claim(s) with an appropriate status
"RTN","FBUCED",40,0)
 S FBACT="EXT",FBO="5^10^" D LOOKUP^FBUCUTL3(FBO,,"M")
"RTN","FBUCED",41,0)
 Q:'+$G(FBARY)!FBOUT
"RTN","FBUCED",42,0)
 N FBDA,FBI,FBNODE,FBPL,FBW
"RTN","FBUCED",43,0)
 D PARSE^FBUCUTL4(FBARY)
"RTN","FBUCED",44,0)
 ;
"RTN","FBUCED",45,0)
 ; loop through all selected claims
"RTN","FBUCED",46,0)
 S FBI=0 F  S FBI=$O(^TMP("FBARY",$J,FBI)) Q:'FBI  D  Q:FBOUT
"RTN","FBUCED",47,0)
 . S FBNODE=$G(^TMP("FBARY",$J,FBI))
"RTN","FBUCED",48,0)
 . S FBDA=+$P(FBNODE,";")
"RTN","FBUCED",49,0)
 . N DA,DIE,DIR,DR,FBEXP,FBEXT,FBEXTD,FBUCA,FBY,Y
"RTN","FBUCED",50,0)
 . ; if more than one claim selected then display current one
"RTN","FBUCED",51,0)
 . I +$G(FBARY)>1 D LINE^FBUCUTL4(FBNODE,FBI,FBPL,FBW)
"RTN","FBUCED",52,0)
 . ; lock claim
"RTN","FBUCED",53,0)
 . D LOCK^FBUCUTL("^FB583(",FBDA) Q:'FBLOCK
"RTN","FBUCED",54,0)
 . ;
"RTN","FBUCED",55,0)
 . S FBUCA=$G(^FB583(FBDA,0))
"RTN","FBUCED",56,0)
 . ;
"RTN","FBUCED",57,0)
 . ; get current expiration date (if any)
"RTN","FBUCED",58,0)
 . S FBEXP=$P(FBUCA,U,26)
"RTN","FBUCED",59,0)
 . ;
"RTN","FBUCED",60,0)
 . ; get most recent extension (if any)
"RTN","FBUCED",61,0)
 . S FBEXT=$$EXT^FBUCUTL8(FBDA,10)
"RTN","FBUCED",62,0)
 . I FBEXT W !,"Current extension date is "_$$FMTE^XLFDT($P(FBEXT,U,2))
"RTN","FBUCED",63,0)
 . ;
"RTN","FBUCED",64,0)
 . ; prompt for new extension date
"RTN","FBUCED",65,0)
 . S FBEXTD="" F  D  Q:FBEXTD]""!FBOUT
"RTN","FBUCED",66,0)
 . . K DA
"RTN","FBUCED",67,0)
 . . I FBEXT S DA(1)=FBDA,DA=+FBEXT ; use existing value as the default
"RTN","FBUCED",68,0)
 . . S DIR(0)="162.701,.04"
"RTN","FBUCED",69,0)
 . . D ^DIR K DIR I $D(DIRUT) S FBOUT=1 Q
"RTN","FBUCED",70,0)
 . . S FBEXTD=Y
"RTN","FBUCED",71,0)
 . . ; confirm
"RTN","FBUCED",72,0)
 . . S DIR(0)="Y"
"RTN","FBUCED",73,0)
 . . S DIR("A")="Confirm entry of "_$$FMTE^XLFDT(FBEXTD)_" as the new extension date for the claim"
"RTN","FBUCED",74,0)
 . . D ^DIR K DIR I $D(DIRUT) S FBOUT=1 Q
"RTN","FBUCED",75,0)
 . . I 'Y S FBEXTD=""  ; prompt again
"RTN","FBUCED",76,0)
 . . I FBEXTD=$P(FBEXT,U,2) W !,"New extension date is equal to existing extension date. No change made." S FBEXTD=0
"RTN","FBUCED",77,0)
 . ;
"RTN","FBUCED",78,0)
 . I FBEXTD,'FBOUT D
"RTN","FBUCED",79,0)
 . . ; save extension
"RTN","FBUCED",80,0)
 . . K DA,DD,DO,DIC,DIE
"RTN","FBUCED",81,0)
 . . S DA(1)=FBDA
"RTN","FBUCED",82,0)
 . . S DIC="^FB583(DA(1),3,",DIC(0)="L",X=$$NOW^XLFDT()
"RTN","FBUCED",83,0)
 . . S DIC("DR")=".02////^S X=DUZ;.03///INCOMPLETE UNAUTHORIZED CLAIM;.04///^S X=FBEXTD"
"RTN","FBUCED",84,0)
 . . D FILE^DICN I Y'>0 W !,"ERROR ADDING EXTENSION" Q
"RTN","FBUCED",85,0)
 . . S DA=+Y
"RTN","FBUCED",86,0)
 . . ;
"RTN","FBUCED",87,0)
 . . ; prompt for optional comments
"RTN","FBUCED",88,0)
 . . S DIE="^FB583(DA(1),3,",DR=".05" D ^DIE
"RTN","FBUCED",89,0)
 . . ;
"RTN","FBUCED",90,0)
 . . ; recompute expiration date if one already exists and update claim
"RTN","FBUCED",91,0)
 . . I FBEXP D
"RTN","FBUCED",92,0)
 . . . N FBLETDT,FBORDER
"RTN","FBUCED",93,0)
 . . . S FBLETDT=$P(FBUCA,U,19)
"RTN","FBUCED",94,0)
 . . . S FBORDER=$$ORDER^FBUCUTL($P(FBUCA,U,24))
"RTN","FBUCED",95,0)
 . . . S FBEXP=$$EXPIRE^FBUCUTL8(FBDA,FBLETDT,FBUCA,FBORDER)
"RTN","FBUCED",96,0)
 . . . D EDITL^FBUCED(FBDA,FBEXP)
"RTN","FBUCED",97,0)
 . ;
"RTN","FBUCED",98,0)
 . ; unlock claim
"RTN","FBUCED",99,0)
 . L -^FB583(FBDA)
"RTN","FBUCED",100,0)
 ;
"RTN","FBUCED",101,0)
 G END
"RTN","FBUCED",102,0)
REQENT ;enter/edit requested information file, 162.93
"RTN","FBUCED",103,0)
 S DLAYGO=162.93,DIC(0)="AELMQZ",DIC="^FB(162.93," D ^DIC K DLAYGO I +Y>0 S DIE=DIC,DA=+Y,FBDA=DA,DR=".01:1" D LOCK^FBUCUTL(DIE,FBDA,0) I FBLOCK D ^DIE L -^FB(162.93,FBDA) K DIE,DE,DA,DQ,DR,FBDA,FBLOCK W ! G REQENT
"RTN","FBUCED",104,0)
 G END
"RTN","FBUCED",105,0)
DISENT ;enter/edit disapproval reasons file 162.94
"RTN","FBUCED",106,0)
 S DLAYGO=162.94,DIC(0)="AELMQZ",DIC="^FB(162.94," D ^DIC K DLAYGO I +Y>0 S DIE=DIC,DA=+Y,FBDA=DA,DR=".01:1" D LOCK^FBUCUTL(DIE,FBDA,0) I FBLOCK D ^DIE L -^FB(162.94,FBDA) K DIE,DE,DA,DQ,DR,FBDA,FBLOCK W ! G DISENT
"RTN","FBUCED",107,0)
 G END
"RTN","FBUCED",108,0)
DSPENT ;edit disposition file 162.91
"RTN","FBUCED",109,0)
 S DIC(0)="AEMQZ",DIC="^FB(162.91," D ^DIC I +Y>0 S DIE=DIC,DA=+Y,FBDA=DA,DR="1:3" D LOCK^FBUCUTL(DIE,FBDA,0) I FBLOCK D ^DIE L -^FB(162.91,FBDA) K DIE,DE,DA,DQ,DR,FBDA,FBLOCK W ! G DSPENT
"RTN","FBUCED",110,0)
END ;kill and quit
"RTN","FBUCED",111,0)
 K DA,DE,DIC,DIE,DQ,DR,DTOUT,DUOUT,FBACT,FBAR,FBARY,FBDR,FBIEN,FBIX,FBLOCK,FBO,FBOUT,FBUCPDX,X,Y
"RTN","FBUCED",112,0)
 K ^TMP("FBAR",$J),^TMP("FBARY",$J),^TMP("FBPARY",$J) Q
"RTN","FBUCED",113,0)
EDIT8 ;edit file 162.8, call before/after & update
"RTN","FBUCED",114,0)
 N FBDA,FBI,FBNODE,FBP,FBPL,FBUCA,FBUCAA,FBUCP,FBUCPA,FBW D PARSE^FBUCUTL4(FBARY) S %X="^TMP(""FBARY"",$J,",%Y="^TMP(""FBPARY"",$J," D %XY^%RCR K %X,%Y
"RTN","FBUCED",115,0)
 S FBI=0 F  S FBI=$O(^TMP("FBPARY",$J,FBI)) Q:'FBI  S FBNODE=$G(^(FBI)),FBDA=+FBNODE,FBNODE=$P(FBNODE,";",2) D  G:FBOUT END
"RTN","FBUCED",116,0)
 .I +$G(FBPARY)>1 W !! F FBP=1:1:FBPL W ?($P(FBW,U,FBP)),$P(FBNODE,U,FBP)
"RTN","FBUCED",117,0)
 .D PRIOR^FBUCEVT(FBDA,FBACT)
"RTN","FBUCED",118,0)
 .N FBARY D REQ^FBUCPEND:FBACT="REQ",REC^FBUCPEND:FBACT="REC" Q:FBOUT  D FREQ^FBUCPEND:FBACT="REQ",FREC^FBUCPEND:FBACT="REC"
"RTN","FBUCED",119,0)
 .D AFTER^FBUCEVT(FBDA,FBACT),UPDATE^FBUCUPD(FBUCP,FBUCPA,FBUCA,FBUCAA,FBDA,FBACT)
"RTN","FBUCED",120,0)
 Q
"RTN","FBUCED",121,0)
EDITL(FBDA,FBEXP,FBLET,FBLETDT,FBTAMT) ;edit letter sent info,
"RTN","FBUCED",122,0)
 ;may be called to just update expiration, or update print flag, date letter sent &/or expiration, or amount approved
"RTN","FBUCED",123,0)
 ;INPUT:  FBDA = ien of unauthorized claim (# 162.7)
"RTN","FBUCED",124,0)
 ;        FBEXP = expiration date (optional)
"RTN","FBUCED",125,0)
 ;        FBLET = flag for letter printed (optional)
"RTN","FBUCED",126,0)
 ;        FBLETDT = date letter sent (optional)
"RTN","FBUCED",127,0)
 ;        FBLET = '@' to delete letter flag
"RTN","FBUCED",128,0)
 ;        FBEXP = expiration date or 0
"RTN","FBUCED",129,0)
 ;        FBTAMT = amount approved (optional)
"RTN","FBUCED",130,0)
 ;OUTPUT: nothing -  update all or some flds in 162.7:  19,19.5,26,14
"RTN","FBUCED",131,0)
 Q:'+$G(FBDA)
"RTN","FBUCED",132,0)
 S FBEXP=+$G(FBEXP),FBLET=$G(FBLET),FBLETDT=+$G(FBLETDT)
"RTN","FBUCED",133,0)
 S FBTAMT=$G(FBTAMT)
"RTN","FBUCED",134,0)
 I 'FBEXP,FBLET']"",'FBLETDT,FBTAMT']"" Q
"RTN","FBUCED",135,0)
 N FBLOCK,DIE,DA,DR
"RTN","FBUCED",136,0)
 S DIE="^FB583(",DR="[FB UNAUTHORIZED LETTER UPDATE]",DA=FBDA
"RTN","FBUCED",137,0)
 D LOCK^FBUCUTL(DIE,DA,1) I FBLOCK D ^DIE L -^FB583(FBDA) K FBLOCK
"RTN","FBUCED",138,0)
 Q
"RTN","FBUCED0")
0^73^B27953320^B28004736
"RTN","FBUCED0",1,0)
FBUCED0 ;ALBISC/TET - UPDATE UNAUTHORIZED GROUP ;10/07/2014
"RTN","FBUCED0",2,0)
 ;;3.5;FEE BASIS;**27,154**;JAN 30, 1995;Build 12
"RTN","FBUCED0",3,0)
 ;;Per VA Directive 6402, this routine should not be modified.
"RTN","FBUCED0",4,0)
EDIT(FBDR,FBACT,FBOUT,FBARY) ;called from fbuced, edit to 162.7
"RTN","FBUCED0",5,0)
 ;INPUT:  FBDR = template to be edited
"RTN","FBUCED0",6,0)
 ;        FBACT = action on claim (DIS = disposition, REO = reopen, etc)
"RTN","FBUCED0",7,0)
 ;        FBOUT = exit flag, 1 to exit
"RTN","FBUCED0",8,0)
 ;        FBARY = count;positions of output array in tmp(fbary
"RTN","FBUCED0",9,0)
 ;OUTPUT: FBOUT = 1 if exited
"RTN","FBUCED0",10,0)
 ;        update unauthorized claim
"RTN","FBUCED0",11,0)
 ;get fbda from array
"RTN","FBUCED0",12,0)
 Q:'+$G(FBARY)!($G(FBDR)']"")!($G(FBACT)']"")  S FBOUT=+$G(FBOUT)
"RTN","FBUCED0",13,0)
 N FBDIRA,FBDA,FBI,FBNODE,FBPL,FBW D PARSE^FBUCUTL4(FBARY)
"RTN","FBUCED0",14,0)
 S FBI=0 F  S FBI=$O(^TMP("FBARY",$J,FBI)) Q:'FBI  S FBNODE=$G(^(FBI)),FBDA=+$P(FBNODE,";") D  Q:FBOUT
"RTN","FBUCED0",15,0)
 .N DA,DIE,DR,FBALL,FBDISP,FBGROUP,FBUCA,FBUCAA,FBUCP,FBUCPA,FBUCPDX,FBY,Y
"RTN","FBUCED0",16,0)
 .I +$G(FBARY)>1 D LINE^FBUCUTL4(FBNODE,FBI,FBPL,FBW)
"RTN","FBUCED0",17,0)
 .D PRIOR^FBUCEVT(FBDA,FBACT) S:FBACT="EDT"!(FBACT="REO") FBUCPDX=$G(^FB583(FBDA,"DX"))
"RTN","FBUCED0",18,0)
 .I FBACT="DIS",$D(FBUCP),$P($G(FBUCP),"^",3)="" W !,"Vendor information is required for disposition." Q
"RTN","FBUCED0",19,0)
 .I FBACT="DIS",$D(FBUCP),$P($G(FBUCP),"^",10)="" W !,"Patient Type Code is required for disposition." Q
"RTN","FBUCED0",20,0)
 .S DIE="^FB583(",DA=FBDA,DR=FBDR,FBDISP=0 D LOCK^FBUCUTL(DIE,DA,0) I FBLOCK D ^DIE I $D(DTOUT) S FBOUT=1,DR="[FB UNAUTHORIZED PREVIOUS]",DA=FBDA D AFTER^FBUCEVT(DA,FBACT),^DIE L -^FB583(FBDA) K FBLOCK
"RTN","FBUCED0",21,0)
 .I 'FBOUT S FBY=$S($D(Y):1,1:0) D AFTER^FBUCEVT(FBDA,FBACT) L -^FB583(FBDA) K FBLOCK D CKAUTH^FBUCUTL6(FBUCP,.FBUCA,FBDA),UPDATE^FBUCUPD(FBUCP,FBUCPA,FBUCA,FBUCAA,FBDA,FBACT) I FBACT="REO",'FBY&($$EDOK^FBUCUTL3(FBDA)) D
"RTN","FBUCED0",22,0)
 ..;keep authoriziation info in synch for claim being edited via reopen
"RTN","FBUCED0",23,0)
 ..N DA,DIE,DR,FBAIEN,FBAUTH,FBIEN,FBLOCK S FBAUTH=$$AUTH^FBUCUTL6(FBUCP,FBUCA)
"RTN","FBUCED0",24,0)
 ..Q:FBAUTH=1!(FBAUTH=0)  S FBAIEN=+$P(FBUCA,U,27) Q:'FBAIEN  S FBIEN=FBAIEN
"RTN","FBUCED0",25,0)
 ..S DA=+$P(FBUCP,U,4),DIE="^FBAAA(",DR="[FB UNAUTHORIZED EDIT]"
"RTN","FBUCED0",26,0)
 ..D LOCK^FBUCUTL(DIE,DA,0) I FBLOCK D ^DIE L -^FBAAA(+$P(FBUCP,U,4)) S:$D(DTOUT) FBOUT=1 K DTOUT
"RTN","FBUCED0",27,0)
 .;keep veteran & treatment from/to (what constitutes a group) in synch for rest in group
"RTN","FBUCED0",28,0)
 .S FBALL=0 D GROUP^FBUCUTL7(FBUCP,FBDA),DISPLAY^FBUCUTL7(FBDA,.FBGROUP)
"RTN","FBUCED0",29,0)
 .I +$G(FBDISP),$P(FBUCP,U,4,6)'=$P(FBUCA,U,4,6) S FBDIRA="Shall other claims be updated to same veteran & treat. from/to dates" D READ^FBUCUTL7(FBDIRA,.FBOUT,.FBDISP) D  Q:FBOUT
"RTN","FBUCED0",30,0)
 ..I FBOUT S FBALL=0 ;if timeout during read, force an unlink
"RTN","FBUCED0",31,0)
 ..I 'FBALL D UNLINK^FBUCLNK1(.FBGROUP,FBDA,FBUCA) Q  ;unlink claim module
"RTN","FBUCED0",32,0)
 ..I FBALL D
"RTN","FBUCED0",33,0)
 ...N FBDR
"RTN","FBUCED0",34,0)
 ...S FBDR="S:'+$P(FBUCA,U,4) Y=""@1"";2////^S X=+$P(FBUCA,U,4);S Y=3;@1;2///@;S:'+$P(FBUCA,U,5) Y=""@2"";3////^S X=+$P(FBUCA,U,5);S Y=4;@2;3///@;S:'+$P(FBUCA,U,6) Y=""@3"";4////^S X=+$P(FBUCA,U,6);S Y=""@99"";@3;4///@;@99"
"RTN","FBUCED0",35,0)
 ...N FBI,FBLOCK S FBI=0 F  S FBI=$O(FBGROUP(FBI)) Q:'FBI  I FBI'=FBDA D DIE^FBUCUTL2("^FB583(",FBI,FBDR)
"RTN","FBUCED0",36,0)
 .;if reopen or disposition, keep disposition and auth from/to dates in synch for same dispostion for rest in group, also keeps respective authorization in 161.01 in synch
"RTN","FBUCED0",37,0)
 .I $S(FBUCA']"":1,FBACT'="REO"&(FBACT'="DIS")&(FBACT'="EDT"):1,FBACT="EDT"&(+$P(FBGROUP,U,5)):0,+$P(FBUCP,U,11)'=+$P(FBUCA,U,11)!($P(FBUCP,U,13,14)'=$P(FBUCA,U,13,14)):0,1:1) Q
"RTN","FBUCED0",38,0)
 .S FBALL=0 D DISPLAY^FBUCUTL7(FBDA,.FBGROUP,"^"_+$P(FBUCP,U,24)_"^",+$P(FBUCP,U,11)) Q:'+FBDISP
"RTN","FBUCED0",39,0)
 .I +$P(FBUCP,U,11)'=+$P(FBUCA,U,11) S FBDIRA="Shall all other claims be updated to the disposition" S:$P(FBUCP,U,13,14)'=$P(FBUCA,U,13,14) FBDIRA=FBDIRA_" & auth. from/to dates"
"RTN","FBUCED0",40,0)
 .I $P(FBUCP,U,11)=$P(FBUCA,U,11) S FBDIRA="Shall all other claims be updated to the auth. from/to dates"
"RTN","FBUCED0",41,0)
 .D READ^FBUCUTL7(FBDIRA,.FBOUT,.FBDISP) I 'FBALL!(FBOUT) Q
"RTN","FBUCED0",42,0)
 .I +$P(FBUCA,U,11)'=+$P(FBUCP,U,11),('($P(FBUCA,U,11)=1!($P(FBUCA,U,11)=4))) S DIR(0)="Y",DIR("A")="Shall disapproval reason apply to all other claims" D ^DIR K DIR Q:$D(DIRUT)  S FBUCDISR=Y I Y D FBUCDISR(FBDA)
"RTN","FBUCED0",43,0)
 .D  K FBUCDISR
"RTN","FBUCED0",44,0)
 ..N FBDR,FBI,FBODA,FBUCP,FBUCPA
"RTN","FBUCED0",45,0)
 ..S FBDR="S:'+$P(FBUCA,U,13) Y=""@1"";12////^S X=+$P(FBUCA,U,13);S Y=13;@1;12///@;S:'+$P(FBUCA,U,14) Y=""@2"";13////^S X=+$P(FBUCA,U,14);S Y=10;@2;13///@;S:'+$P(FBUCA,U,11) Y=""@3"";10////^S X=+$P(FBUCA,U,11);S Y=""@99"";@3;10///@;@99"
"RTN","FBUCED0",46,0)
 ..S FBODA=FBDA,FBI=0
"RTN","FBUCED0",47,0)
 ..F  S FBI=$O(FBDISP(FBI)) Q:'FBI  I FBI'=FBODA D PRIOR^FBUCEVT(FBI,FBACT) D DIE^FBUCUTL2("^FB583(",FBI,FBDR) N FBUCA,FBUCAA D AFTER^FBUCEVT(FBI,FBACT) S FBDA=FBI D UPDATE^FBUCUPD(FBUCP,FBUCPA,FBUCA,FBUCAA,FBI,FBACT,$G(FBUCDISR))
"RTN","FBUCED0",48,0)
 Q
"RTN","FBUCED0",49,0)
FBUCDISR(FBDA) ;set up fbucdisr with disap. reasons for primary claim
"RTN","FBUCED0",50,0)
 ;INPUT:  ien of unauthorized claim (usually primary)
"RTN","FBUCED0",51,0)
 ;OUTPUT: fbucdisr=1^   (1 indicates user wishes for all linked
"RTN","FBUCED0",52,0)
 ;                 claims to contain same disapproval reason as primary
"RTN","FBUCED0",53,0)
 ;                 pieces following will contain the pointer values
"RTN","FBUCED0",54,0)
 ;                 of the disap. reasons for the primary del by ^
"RTN","FBUCED0",55,0)
 N I
"RTN","FBUCED0",56,0)
 I $D(^FB583(FBDA,"D")) S I=0 F  S I=$O(^FB583(FBDA,"D",I)) Q:'I  S FBUCDISR=FBUCDISR_"^"_+^FB583(FBDA,"D",I,0)
"RTN","FBUCED0",57,0)
 Q
"RTN","FBUCEN")
0^74^B27771069^B27715243
"RTN","FBUCEN",1,0)
FBUCEN ;ALBISC/TET - ENTER UNAUTHORIZED CLAIM ;10/07/2014
"RTN","FBUCEN",2,0)
 ;;3.5;FEE BASIS;**32,61,114,153,154**;JAN 30, 1995;Build 12
"RTN","FBUCEN",3,0)
 ;;Per VA Directive 6402, this routine should not be modified.
"RTN","FBUCEN",4,0)
 ;
"RTN","FBUCEN",5,0)
 ;FB*3.5*153 Insure the response to the Millenium Act 38
"RTN","FBUCEN",6,0)
 ;           U.S.C. 1725 for Y/N is set to 1/0 in field 
"RTN","FBUCEN",7,0)
 ;           #31 of file 162.7.
"RTN","FBUCEN",8,0)
 ;
"RTN","FBUCEN",9,0)
 ;FBUC - unauthorized claims site parameter node
"RTN","FBUCEN",10,0)
 ;FBTRACK - 1 to track incomplete claims, 0 to track complete claims only
"RTN","FBUCEN",11,0)
 ;FBUCP - 0 to not automatically print letters, otherwise default device
"RTN","FBUCEN",12,0)
 ;FBOK - 0 if claim is incomplete, 1 if claim is complete.
"RTN","FBUCEN",13,0)
 ;FBACT - ENT for enter (fbact represents action type)
"RTN","FBUCEN",14,0)
 ;FBINENT = initial entry parameter: 1 if using, 0 if not
"RTN","FBUCEN",15,0)
 S FBOUT=0,FBUC=$$FBUC^FBUCUTL2(1),FBTRACK=+$P(FBUC,U),FBOK=$S('FBTRACK:1,1:0),FBACT="ENT",FBINENT=+$P(FBUC,U,7)
"RTN","FBUCEN",16,0)
GET ;get info on new claim entry
"RTN","FBUCEN",17,0)
 K FBVEN,FBVET
"RTN","FBUCEN",18,0)
VET ;get vet info
"RTN","FBUCEN",19,0)
 N DIR,DA W !! S DIR(0)="162.7,2O",DIR("A")="Select VETERAN" D ^DIR K DIR,DA G END:$D(DIRUT),VET:+Y'>0 S FBVET=+Y
"RTN","FBUCEN",20,0)
VEN ;get vendor info
"RTN","FBUCEN",21,0)
 N DIR,DA S DIR(0)="162.7,1O",DIR("A")="Select FEE VENDOR" D ^DIR K DIR,DA G VET:$D(DUOUT)!($D(DTOUT)),VEN:+Y<0,VEN:+Y=0&('FBINENT) S FBVEN=+Y
"RTN","FBUCEN",22,0)
PROG N DIC,DA S DIC="^FBAA(161.8,",DIC(0)="AEQMZ",DIC("S")="I +$P(^(0),U,3)" D ^DIC K DIC,DA S:$D(DTOUT)!($D(DUOUT)) FBOUT=1 G END:FBOUT,GET:Y<0 S FBPR=+Y D  S:FBOUT FBOUT=0 G VET
"RTN","FBUCEN",23,0)
 .N FBDA,FBMASTER,FBORDER,FBTFROM,FBTTO,FB1725,FBFPPSC
"RTN","FBUCEN",24,0)
 .; ask if claim is an EDI claim (patch *61)
"RTN","FBUCEN",25,0)
 .S FBFPPSC=$$FPPSC^FBUTL5() I FBFPPSC=-1 S FBFPPSC="",FBOUT=1 Q
"RTN","FBUCEN",26,0)
 .; ask if claim is a mill bill emergency care claim (patch *32)
"RTN","FBUCEN",27,0)
 .S DIR(0)="Y"
"RTN","FBUCEN",28,0)
 .S DIR("A")="Is this claim being considered under Millennium Act 38 U.S.C. 1725 (Y/N)"
"RTN","FBUCEN",29,0)
 .D ^DIR K DIR I $D(DIRUT) S FBOUT=1 Q
"RTN","FBUCEN",30,0)
 .S FB1725=+Y     ;FB*3.5*153
"RTN","FBUCEN",31,0)
 .D ASKDT Q:FBOUT  I FBTRACK,'FBINENT D  Q:FBOUT
"RTN","FBUCEN",32,0)
 ..S DIR(0)="Y",DIR("A")="Is the unauthorized claim complete for the FEE PROGRAM" D DIRQ,^DIR K DIR S:$D(DIRUT) FBOUT=1 S:'FBOUT FBOK=Y Q:FBOUT!(FBOK)
"RTN","FBUCEN",33,0)
 ..D REQ^FBUCPEND Q:FBOUT  S FBORDER=10 ;display/select pending information,set status order to incomplete if selected pending items
"RTN","FBUCEN",34,0)
 .;check for duplicates
"RTN","FBUCEN",35,0)
 .I 'FBINENT W !,"Checking for potential duplicates...",! H 1 D ^FBUCDUP
"RTN","FBUCEN",36,0)
 .W !!,"Checking eligibility...",! H 1 S DFN=FBVET D ELIG^VADPT W:VAEL(4)'=1 !,"Patient is not a veteran.",*7 D ELIG^FBAADEM K VAEL,VAERR
"RTN","FBUCEN",37,0)
 .W ! S DIR("A")="Are you sure you wish to enter a new unauthorized claim",DIR(0)="Y" D ^DIR K DIR S:'Y!($D(DIRUT)) FBOUT=1 Q:FBOUT
"RTN","FBUCEN",38,0)
 .;file new claim
"RTN","FBUCEN",39,0)
 .S DIC="^FB583(",DIC(0)="Z",X=DT K DD,DO D FILE^DICN S FBOUT=$S($P(Y,U,3):0,1:1) Q:FBOUT  S FBDA=+Y D PRIOR^FBUCEVT(FBDA,FBACT) D
"RTN","FBUCEN",40,0)
 ..S FBMASTER=FBDA,FBORDER=$S(+$G(FBORDER)=10:10,'FBINENT:30,1:5)
"RTN","FBUCEN",41,0)
 ..S DIE=DIC,DIE("NO^")="BACKOUTOK",DR="[FB UNAUTHORIZED ENTER]",DA=FBDA
"RTN","FBUCEN",42,0)
 ..D LOCK^FBUCUTL(DIE,DA,1) S:'FBLOCK FBOUT=1 Q:FBOUT  D ^DIE L -^FB583(FBDA) K DA,DIE,DQ,DR,FBLOCK I $D(Y)!($D(DTOUT)) S DIK=DIC,DA=FBDA D ^DIK K DIK W !,"... Deleting incomplete record.",*7 S FBOUT=1 Q
"RTN","FBUCEN",43,0)
 ..I FBORDER=10 D FREQ^FBUCPEND ;file requested info
"RTN","FBUCEN",44,0)
 ..K ^TMP("FBARY",$J),^TMP("FBAR",$J)
"RTN","FBUCEN",45,0)
 .D AFTER^FBUCEVT(FBDA,FBACT)
"RTN","FBUCEN",46,0)
 .K FBARY,FBLOCK Q:FBOUT  D ENTER^FBUCLNK1(FBDA,FBUCA,1) K FBARY,^TMP("FBARY",$J),^TMP("FBAR",$J)
"RTN","FBUCEN",47,0)
 .I FBORDER'=10,+$G(FBVEN)>0,+$G(FBTTO)>0 D AFTER^FBUCEVT(FBDA,FBACT),EN^FBUCEN1(FBUCA,FBDA) ;if claim complete, check if group, any in group dispositioned
"RTN","FBUCEN",48,0)
 .;do update
"RTN","FBUCEN",49,0)
 .D AFTER^FBUCEVT(FBDA,FBACT),UPDATE^FBUCUPD(FBUCP,FBUCPA,FBUCA,FBUCAA,FBDA,FBACT)
"RTN","FBUCEN",50,0)
 ;
"RTN","FBUCEN",51,0)
END ;kill and quit
"RTN","FBUCEN",52,0)
 K DA,DFN,DIC,DIE,DIR,DIRUT,DQ,DR,DTOUT,DUOUT,FBACT,FBARY,FBDA,FBDISP,FBINENT,FBLOCK,FBMASTER,FBOK,FBORDER,FBOUT,FBPEND,FBPI,FBPR,FBPROG
"RTN","FBUCEN",53,0)
 K FBSTATUS,FBTFROM,FBTRACK,FBTTO,FBUC,FBUCA,FBUCP,FBUCAA,FBUCP,FBUCPA,FBVEN,FBVET,X,Y,^TMP("FBAR",$J),^TMP("FBARY",$J)
"RTN","FBUCEN",54,0)
 Q
"RTN","FBUCEN",55,0)
ASKDT ;ask treatment from/to dates
"RTN","FBUCEN",56,0)
 S DIR(0)="162.7,3" S:FBPR=6 DIR("A")="ADMISSION DATE" D ^DIR K DIR S:'+Y DIRUT="^" S:$D(DIRUT) FBOUT=1 S:'FBOUT FBTFROM=Y
"RTN","FBUCEN",57,0)
 I 'FBOUT S DIR(0)="162.7,4O" S:FBPR=6 DIR("A")="DISCHARGE DATE" S:FBPR'=6&(FBPR'=7) DIR("B")=$$DATX^FBAAUTL(FBTFROM) D ^DIR K DIR S:$D(DUOUT)!($D(DTOUT)) FBOUT=1 I 'FBOUT,'FBINENT G:+Y'>0!(FBTFROM>Y) ASKDT S FBTTO=Y
"RTN","FBUCEN",58,0)
 I 'FBOUT S FBTTO=+Y
"RTN","FBUCEN",59,0)
 Q
"RTN","FBUCEN",60,0)
HELP ;help text for complete claim question - ??
"RTN","FBUCEN",61,0)
 W !?10,"An unauthorized claim is considered complete (or valid)"
"RTN","FBUCEN",62,0)
 W !?10,"if all the necessary information has been received."
"RTN","FBUCEN",63,0)
 W !?10,"A claim can never be considered complete if it is missing"
"RTN","FBUCEN",64,0)
 W !?10,"form 10-583 or form 10-583 is incomplete."
"RTN","FBUCEN",65,0)
 W !?10,"Some examples of other items which are needed are:"
"RTN","FBUCEN",66,0)
 W !?20,"Copies of actual bills",!?20,"Original paid receipt"
"RTN","FBUCEN",67,0)
 W !?20,"Itemized invoice/UB82",!?20,"Medical records or signature for release"
"RTN","FBUCEN",68,0)
 W !?20,"Diagnostic/Procedure code(s)",!
"RTN","FBUCEN",69,0)
 Q
"RTN","FBUCEN",70,0)
DIRQ ;set dir(?,#)
"RTN","FBUCEN",71,0)
 S DIR("?")="Enter Y(es) if complete, N(o) if incomplete."
"RTN","FBUCEN",72,0)
 S DIR("??")="^D HELP^FBUCEN"
"RTN","FBUCEN",73,0)
 S DIR("?",1)="Enter Y(es) if all required information has been submitted,"
"RTN","FBUCEN",74,0)
 S DIR("?",2)="      N(o)  if the claim is incomplete."
"RTN","FBUCEN",75,0)
 S DIR("?",3)=""
"RTN","FBUCEN",76,0)
 Q
"RTN","FBUCEX")
0^75^B19203515^B19195997
"RTN","FBUCEX",1,0)
FBUCEX ;ALBISC/TET - EXPIRATION UPDATE &/OR OUTPUT ;10/07/2014
"RTN","FBUCEX",2,0)
 ;;3.5;FEE BASIS;**32,154**;JAN 30, 1995;Build 12
"RTN","FBUCEX",3,0)
 ;;Per VA Directive 6402, this routine should not be modified.
"RTN","FBUCEX",4,0)
ABAND ;background update to abandoned if expiration date is met
"RTN","FBUCEX",5,0)
 ;on claims with status order of 10 or 55
"RTN","FBUCEX",6,0)
 N FBDT,FBACT S FBACT="EDT"
"RTN","FBUCEX",7,0)
 S FBO=0 F  S FBO=$O(^FB583("AES",FBO)) Q:'FBO  I "^10^55^"[FBO  S FBDT=-(DT) F  S FBDT=$O(^FB583("AES",FBO,FBDT)) Q:FBDT']""  S FBDA=0 F  S FBDA=$O(^FB583("AES",FBO,FBDT,FBDA)) Q:'FBDA  S FBZ=$G(^FB583(FBDA,0)) I FBZ]"" D
"RTN","FBUCEX",8,0)
 .N FBUCA,FBUCAA,FBUCP,FBUCPA
"RTN","FBUCEX",9,0)
 .D PRIOR^FBUCEVT(FBDA,"EDT") S DIE="^FB583(",DA=FBDA,DR="26///^S X=""@"";10////^S X=5"
"RTN","FBUCEX",10,0)
 .D LOCK^FBUCUTL(DIE,DA,1) I FBLOCK D ^DIE L -^FB583(DA) K DIE,DR,DA
"RTN","FBUCEX",11,0)
 .D AFTER^FBUCEVT(FBDA,"EDT"),UPDATE^FBUCUPD(FBUCP,FBUCPA,FBUCA,FBUCAA,FBDA,"EDT")
"RTN","FBUCEX",12,0)
 .S ^TMP("FBEX",$J,$$VET^FBUCUTL($P(FBZ,U,4))_";"_$P(FBZ,U,4),FBDA)=$E($$VEN^FBUCUTL($P(FBZ,U,3)),1,20)_U_$E($P($$PTR^FBUCUTL("^FB(162.92,",$$STATUS^FBUCUTL(FBO)),U),1,16)_U_$$DATX^FBAAUTL($P(FBZ,U,5))_U_$$DATX^FBAAUTL($P(FBZ,U,6))
"RTN","FBUCEX",13,0)
 .K FBLOCK
"RTN","FBUCEX",14,0)
 G:'$D(^TMP("FBEX")) END S FBHDR="Unauthorized Claims Dispositioned to 'ABANDONED'"
"RTN","FBUCEX",15,0)
PRINT ;print claims which have been dispositioned to abandoned or fall within date range to expire
"RTN","FBUCEX",16,0)
 U IO S FBPG=0,FBCRT=$S($E(IOST,1,2)="C-":1,1:0),FBOUT=0,$P(FBDASH,"=",80)="" D PAGE
"RTN","FBUCEX",17,0)
 S FBVET="" F  S FBVET=$O(^TMP("FBEX",$J,FBVET)) Q:FBVET']""!(FBOUT)  S FBDA=0 F  S FBDA=$O(^TMP("FBEX",$J,FBVET,FBDA)) Q:'FBDA!(FBOUT)  S FBNODE=$G(^TMP("FBEX",$J,FBVET,FBDA)) D  Q:FBOUT
"RTN","FBUCEX",18,0)
 .I IOSL<($Y+5) D PAGE Q:FBOUT
"RTN","FBUCEX",19,0)
 .W !,$E($P(FBVET,";"),1,20),?24,$P(FBNODE,U),?48,$P(FBNODE,U,3),?60,$P(FBNODE,U,4),?72,$E($P(FBNODE,U,2),1,8)
"RTN","FBUCEX",20,0)
END ;kill variables,tmp global and quit
"RTN","FBUCEX",21,0)
 K FBCRT,FBDA,FBDASH,FBDT,FBFR,FBHDR,FBLOCK,FBNODE,FBO,FBOUT,FBPG,FBPOP,FBTO,FBVET,FBZ,BEGDATE,DIR,DIRUT,DTOUT,DUOUT,ENDDATE,PGM,POP,VAL,VAR,^TMP("FBEX",$J),FB1725R
"RTN","FBUCEX",22,0)
 D CLOSE^FBAAUTL
"RTN","FBUCEX",23,0)
 Q
"RTN","FBUCEX",24,0)
PAGE ;write new page
"RTN","FBUCEX",25,0)
 D:FBCRT&(FBPG>0) CR Q:FBOUT
"RTN","FBUCEX",26,0)
HDR W:FBCRT!(FBPG>0) @IOF S FBPG=FBPG+1
"RTN","FBUCEX",27,0)
 W !,FBHDR,!!,?48,"Treatment",?60,"Treatment",!,"Veteran",?24,"Vendor",?51,"FROM",?64,"TO",?72,"Status",!,FBDASH
"RTN","FBUCEX",28,0)
 Q
"RTN","FBUCEX",29,0)
CR ;ask end of page prompt
"RTN","FBUCEX",30,0)
 ;OUTPUT: FBOUT is set if time out or up arrow out
"RTN","FBUCEX",31,0)
 W ! S DIR(0)="E" D ^DIR S:$D(DTOUT)!($D(DUOUT)) FBOUT=1
"RTN","FBUCEX",32,0)
 Q
"RTN","FBUCEX",33,0)
EXPIRE ;called from print option to display/print claims due to expire within date range
"RTN","FBUCEX",34,0)
 ;claim will print if expiration date falls within date range user selected,
"RTN","FBUCEX",35,0)
 ;status order is 10 <incomplete> or 55 <appeal/stmt of case issued>,
"RTN","FBUCEX",36,0)
 ;and has not been abandoned (ck needed?)
"RTN","FBUCEX",37,0)
 ; ask if report for just mill-bill (1725) or just non-mill bill claims
"RTN","FBUCEX",38,0)
 S FB1725R=$$ASKMB^FBUCUTL9 I FB1725R="" G END
"RTN","FBUCEX",39,0)
 W !?3,"Select the date range within which an unauthorized claim will expire." S %DT="AEX" D DATE^FBAAUTL K %DT G:FBPOP END
"RTN","FBUCEX",40,0)
 S VAR="BEGDATE^ENDDATE^FB1725R",VAL=VAR,PGM="DQ^FBUCEX" D ZIS^FBAAUTL G:FBPOP END
"RTN","FBUCEX",41,0)
DQ S FBFR=BEGDATE,FBTO=ENDDATE ;scratch
"RTN","FBUCEX",42,0)
 S FBHDR="Unauthorized"_$S(FB1725R="M":" Mill Bill (1725)",FB1725R="N":" NON-Mill Bill",1:"")_" Claims Due to Expire between "_$$DATX^FBAAUTL(FBFR)_" and "_$$DATX^FBAAUTL(FBTO)
"RTN","FBUCEX",43,0)
 S FBO=0 F  S FBO=$O(^FB583("AES",FBO)) Q:'FBO  I "^10^55^"[FBO S FBDT=-(FBTO-.1) F  S FBDT=$O(^FB583("AES",FBO,FBDT)) Q:FBDT']""!(FBDT>-FBFR)  S FBDA=0 F  S FBDA=$O(^FB583("AES",FBO,FBDT,FBDA)) Q:'FBDA  S FBZ=$G(^FB583(FBDA,0)) I FBZ]"" D
"RTN","FBUCEX",44,0)
 .; if user requested just mill-bill (1725) or non-mill bill claims then
"RTN","FBUCEX",45,0)
 .; check claim and skip when appropriate
"RTN","FBUCEX",46,0)
 .Q:$S(FB1725R="M"&'+$P(FBZ,U,28):1,FB1725R="N"&+$P(FBZ,U,28):1,1:0)
"RTN","FBUCEX",47,0)
 .S ^TMP("FBEX",$J,$$VET^FBUCUTL($P(FBZ,U,4))_";"_$P(FBZ,U,4),FBDA)=$E($$VEN^FBUCUTL($P(FBZ,U,3)),1,20)_U_$E($P($$PTR^FBUCUTL("^FB(162.92,",$$STATUS^FBUCUTL(FBO)),U),1,16)_U_$$DATX^FBAAUTL($P(FBZ,U,5))_U_$$DATX^FBAAUTL($P(FBZ,U,6))
"RTN","FBUCEX",48,0)
 I '$D(^TMP("FBEX")) D  G END
"RTN","FBUCEX",49,0)
 .S FBPG=0,$P(FBDASH,"=",80)="",FBCRT=$S($E(IOST,1,2)="C-":1,1:0)
"RTN","FBUCEX",50,0)
 .S FBOUT=0
"RTN","FBUCEX",51,0)
 .U IO
"RTN","FBUCEX",52,0)
 .D PAGE W !,"No claims will expire within selected date range."
"RTN","FBUCEX",53,0)
 G PRINT
"RTN","FBUCEX",54,0)
 Q
"RTN","FBUCLINK")
0^76^B19446324^B19436173
"RTN","FBUCLINK",1,0)
FBUCLINK ;ALBISC/TET - LINK CLAIM TO A PRIMARY ;10/07/2014
"RTN","FBUCLINK",2,0)
 ;;3.5;FEE BASIS;**154**;JAN 30, 1995;Build 12
"RTN","FBUCLINK",3,0)
 ;;Per VA Directive 6402, this routine should not be modified.
"RTN","FBUCLINK",4,0)
EDIT ;associate claims to a primary ;call from FBUC ASSOCIATE option
"RTN","FBUCLINK",5,0)
 ;INPUT:  none
"RTN","FBUCLINK",6,0)
 ;VAR:    FBLINK = ien of master claim #
"RTN","FBUCLINK",7,0)
 ;OUTPUT:  none; if fblink will update
"RTN","FBUCLINK",8,0)
 N FBACT S FBACT="LNK",FBO=0 D LOOKUP^FBUCUTL3(FBO) G:FBOUT END
"RTN","FBUCLINK",9,0)
 Q:'+$G(FBARY)  N FBDA,FBI,FBNODE,FBPL,FBW D PARSE^FBUCUTL4(FBARY)
"RTN","FBUCLINK",10,0)
 S FBI=0 F  S FBI=$O(^TMP("FBARY",$J,FBI)) Q:'FBI  S FBNODE=$G(^(FBI)),FBDA=+FBNODE D  Q:FBOUT
"RTN","FBUCLINK",11,0)
 .N FBUCA,FBUCAA,FBUCP,FBUCPA,FBZ I +$G(FBARY)>1 D LINE^FBUCUTL4(FBNODE,FBI,FBPL,FBW)
"RTN","FBUCLINK",12,0)
 .D PRIOR^FBUCEVT(FBDA,FBACT)
"RTN","FBUCLINK",13,0)
 .I '$$LINK^FBUCUTL4(FBDA,FBUCP) W !,"This claim has other claims associated with it",!,"and, therefore, can not be associated to another." Q
"RTN","FBUCLINK",14,0)
 .D ASSOC Q:FBOUT  D UPD(FBDA,FBLINK)
"RTN","FBUCLINK",15,0)
 .S FBZ=$$FBZ^FBUCUTL(FBDA) D EN^FBUCEN1(FBZ,FBDA)
"RTN","FBUCLINK",16,0)
 .D AFTER^FBUCEVT(FBDA,FBACT),UPDATE^FBUCUPD(FBUCP,FBUCPA,FBUCA,FBUCAA,FBDA,FBACT)
"RTN","FBUCLINK",17,0)
END ;kill and quit
"RTN","FBUCLINK",18,0)
 K DA,DIE,DIRUT,DR,DTOUT,DUOUT,FBAR,FBARY,FBDCT,FBI,FBLINK,FBO,FBOUT,FBP,FBPL,FBUCP,FBUCPA,FBW,FBX,FBZ,X,Y,^TMP("FBARY",$J) Q
"RTN","FBUCLINK",19,0)
ASSOC ;associate claim to a primary
"RTN","FBUCLINK",20,0)
 ;INPUT:  FBDA = ien of unauthorized claim to be linked
"RTN","FBUCLINK",21,0)
 ;        FBUCP = zero node of fbda
"RTN","FBUCLINK",22,0)
 ;OUTPUT: FBLINK = ien of unauthorized claim to which is linked
"RTN","FBUCLINK",23,0)
 ;        FBOUT = set if timed out or up-arrow entered
"RTN","FBUCLINK",24,0)
 S DIC="^FB583(",DIC(0)="AEMQZ",DIC("A")="Select the unauthorized claim to which this one should be associated: ",DIC("W")="D ID^FBUCUTL4"
"RTN","FBUCLINK",25,0)
 S DIC("S")="N FBZ S FBZ=$$FBZ^FBUCUTL(+Y) I $P(FBZ,U,4)=$P(FBUCP,U,4)&(+Y'=FBDA)&($$LINKTO^FBUCUTL4(+Y,FBZ,FBDA))&($P(FBZ,U,5)=$P(FBUCP,U,5))&($P(FBZ,U,6)=$P(FBUCP,U,6)) K FBZ"
"RTN","FBUCLINK",26,0)
 D ^DIC K DIC S:$D(DTOUT)!($D(DUOUT)) FBOUT=1 G:FBOUT!(Y'>0) ASSOCQ S FBLINK=+Y
"RTN","FBUCLINK",27,0)
ASSOCQ S FBLINK=+$G(FBLINK) K FBZ,Y Q
"RTN","FBUCLINK",28,0)
DISASSOC ;disassociate a claim, interactive, called from option
"RTN","FBUCLINK",29,0)
 N FBARY,FBDA,FBI,FBNODE,FBOUT,FBP,FBPL,FBW ;new variables here
"RTN","FBUCLINK",30,0)
 W !,"This option will allow you to disassociate a claim.",!
"RTN","FBUCLINK",31,0)
 D LOOKUP^FBUCUTL3(0)
"RTN","FBUCLINK",32,0)
 G:'+$G(FBARY) DISASSQ
"RTN","FBUCLINK",33,0)
 S FBOUT=0 D PARSE^FBUCUTL4(FBARY)
"RTN","FBUCLINK",34,0)
 S FBI=0 F  S FBI=$O(^TMP("FBARY",$J,FBI)) Q:'FBI!(FBOUT)  S FBNODE=$G(^(FBI)),FBDA=+$P(FBNODE,";") D  G:FBOUT DISASSQ
"RTN","FBUCLINK",35,0)
 .N FBALL,FBDIRA,FBDISP,FBGROUP,FBZ
"RTN","FBUCLINK",36,0)
 .D LINE^FBUCUTL4(FBNODE,FBI,FBPL,FBW)
"RTN","FBUCLINK",37,0)
 .S FBZ=$G(^FB583(FBDA,0))
"RTN","FBUCLINK",38,0)
 .S FBALL=0 D GROUP^FBUCUTL7(FBZ,FBDA)
"RTN","FBUCLINK",39,0)
 .I +$G(FBGROUP)=1 W !,"This claim is not associated with another claim." Q
"RTN","FBUCLINK",40,0)
 .D DISPLAY^FBUCUTL7(FBDA,.FBGROUP) S FBDIRA="Do you wish to disassociate claim from the above group" D READ^FBUCUTL7(FBDIRA,.FBOUT,.FBDISP) Q:FBOUT!('FBALL)
"RTN","FBUCLINK",41,0)
 .D UNLINK^FBUCLNK1(.FBGROUP,FBDA,FBZ)
"RTN","FBUCLINK",42,0)
DISASSQ K FBARY,^TMP("FBARY",$J) Q
"RTN","FBUCLINK",43,0)
UPD(FBDA,FBLINK) ;update master claim field
"RTN","FBUCLINK",44,0)
 ;INPUT:  FBDA = internal entry number of unauthorized claim for update
"RTN","FBUCLINK",45,0)
 ;        FBLINK = internal entry number of primary claim
"RTN","FBUCLINK",46,0)
 ;OUTPUT: update of MASTER CLAIM field
"RTN","FBUCLINK",47,0)
 N DA,DIE,DR,X,FBLOCK
"RTN","FBUCLINK",48,0)
 Q:'+$G(FBDA)!('+$G(FBLINK))  I +$G(FBLINK) S DA=FBDA,DIE="^FB583(",DR="20////^S X=FBLINK" D LOCK^FBUCUTL(DIE,DA,1) I FBLOCK D ^DIE L -^FB583(FBDA)
"RTN","FBUCLINK",49,0)
 Q
"RTN","FBUCLINK",50,0)
ARSET(FBDA,FBZ) ;set display array
"RTN","FBUCLINK",51,0)
 ;INPUT:  FBDA = ien of unauthorized claim record
"RTN","FBUCLINK",52,0)
 ;        FBZ = zero node of unauthorized claim
"RTN","FBUCLINK",53,0)
 ;OUTPUT: string of data for display
"RTN","FBUCLINK",54,0)
 N FBX I '+$G(FBDA)!($G(FBZ)']"") Q $G(FBX)
"RTN","FBUCLINK",55,0)
 S FBX=FBDA_";"_$S($$PRIME^FBUCUTL4(FBDA,FBZ):"*",1:"  ")_$E($$VET^FBUCUTL(+$P(FBZ,U,4)),1,12)_U_$E($$VEN^FBUCUTL(+$P(FBZ,U,3)),1,12)_U_$E($$PROG^FBUCUTL(+$P(FBZ,U,2)),1,12)_U_$$DATX^FBAAUTL(+$P(FBZ,U))
"RTN","FBUCLINK",56,0)
 S FBX=FBX_U_$E($$PTR^FBUCUTL("^FB(162.92,",+$P(FBZ,U,24)),1,16)
"RTN","FBUCLINK",57,0)
 S FBX=FBX_U_"TREATMENT FROM: "_$$DATX^FBAAUTL(+$P(FBZ,U,5))_U_"TREATMENT TO: "_$$DATX^FBAAUTL(+$P(FBZ,U,6))
"RTN","FBUCLINK",58,0)
 Q $G(FBX)
"RTN","FBUCLINK",59,0)
ASK ;ask if want to associate claim
"RTN","FBUCLINK",60,0)
 ;INPUT:  FBLINK = flag that another entry for vet and episode exists
"RTN","FBUCLINK",61,0)
 ;        FBAR & FBAR( = data for vet/episode of care to display
"RTN","FBUCLINK",62,0)
 ;OUTPUT: FBLINK = 1 is which to associate; 0 to associate to itself
"RTN","FBUCLINK",63,0)
 W !!,"Other claims exist for the same veteran and episode of care." H 1 D DISPX^FBUCUTL1(0,1)
"RTN","FBUCLINK",64,0)
 W ! S DIR("A")="Do you wish to associate this new claim with one from the above listing",DIR("B")="YES",DIR(0)="Y" D ^DIR K DIR S:$D(DIRUT) FBOUT=1  S FBLINK=$S(Y=1:1,1:0)
"RTN","FBUCLINK",65,0)
 Q
"RTN","FBUCLINK",66,0)
SELECT(FBAR) ;select a claim from listing to link
"RTN","FBUCLINK",67,0)
 ;INPUT:  FBAR = (not subscripted), for upper limit
"RTN","FBUCLINK",68,0)
 ;OUTPUT: FBLINK = number of primary master claim or zero
"RTN","FBUCLINK",69,0)
 Q:'+$G(FBAR)  S DIR(0)="N^1:"_FBAR_":0",DIR("A")="Select the claim to which you wish to associate",DIR("??")="^D DISPX^FBUCUTL1(0,1)"
"RTN","FBUCLINK",70,0)
 D ^DIR K DIR S:$D(DIRUT) FBOUT=1 Q:+$G(FBOUT)  S FBLINK=+$G(^TMP("FBAR",$J,+Y))
"RTN","FBUCLINK",71,0)
 Q
"RTN","FBUCPAY")
0^60^B25249019^B23726559
"RTN","FBUCPAY",1,0)
FBUCPAY ;ALBISC/TET - PAYMENT DRIVER ;12/17/2014
"RTN","FBUCPAY",2,0)
 ;;3.5;FEE BASIS;**7,154**;JAN 30, 1995;Build 12
"RTN","FBUCPAY",3,0)
 ;;Per VA Directive 6402, this routine should not be modified.
"RTN","FBUCPAY",4,0)
ASK ;ask to whom payment should be made, vendor and veteran (to narrow selection)
"RTN","FBUCPAY",5,0)
 S DIR(0)="SMO^1:PATIENT;2:VENDOR",DIR("A")="Select to whom payment should be made" D ^DIR K DIR G END:$D(DIRUT),ASK:'+Y!($G(Y(0))']"")
"RTN","FBUCPAY",6,0)
 S FBPAY=+Y ;1 for patient, 2 for vendor
"RTN","FBUCPAY",7,0)
GET ;get claim for payment, only approved dispositioned claims, non cnh program, ven and vet must match
"RTN","FBUCPAY",8,0)
 K FBVEN,FBVET
"RTN","FBUCPAY",9,0)
VET ;get vet info
"RTN","FBUCPAY",10,0)
 S DIR(0)="162.7,2O",DIR("A")="Select VETERAN" D ^DIR K DIR G END:$D(DIRUT),VET:+Y'>0 S FBVET=+Y
"RTN","FBUCPAY",11,0)
VEN ;get vendor info
"RTN","FBUCPAY",12,0)
 S DIR(0)="162.7,1O",DIR("A")="Select FEE VENDOR" D ^DIR K DIR G END:$D(DUOUT)!($D(DTOUT)),VEN:+Y'>0 S FBVEN=+Y
"RTN","FBUCPAY",13,0)
LOOKUP ;select claim
"RTN","FBUCPAY",14,0)
 S FBIX="APMS",FBIEN=FBVET,FBO="40^70^90^" D DISP7^FBUCUTL5(FBIX,FBIEN,FBO) ;lookup by patient, dispostioned claim only
"RTN","FBUCPAY",15,0)
 ;delete entries from array which don't meet criteria:  program=7(cnh), vendor'=fbven, disposition not approved or approved to stabilization
"RTN","FBUCPAY",16,0)
 S (FBCNT,FBI)=0 F  S FBI=$O(^TMP("FBAR",$J,FBI)) Q:'FBI  S FBZ=$G(^FB583(+^(FBI),0)) D
"RTN","FBUCPAY",17,0)
 .I $S($P(FBZ,U,2)=7:1,$P(FBZ,U,3)'=FBVEN:1,$P(FBZ,U,11)'=1&($P(FBZ,U,11)'=4):1,1:0) D:$$GO(FBI)  K ^TMP("FBAR",$J,FBI) S $P(^("FBAR"),";")=+^TMP("FBAR",$J,"FBAR")-1 Q
"RTN","FBUCPAY",18,0)
 ..S FBZ=$P(^(FBI+1),";")_";  "_$$EXTRL^FBMRASVR($P($P(^(FBI),U),";",2))_U_$P($P(^(FBI+1),U),";",2)_U_$P(^(FBI),U,3,8),$P(FBZ,U,7)="  "_$$EXTRL^FBMRASVR($P(FBZ,U,7)),^TMP("FBAR",$J,FBI+1)=FBZ K FBZ
"RTN","FBUCPAY",19,0)
 .S FBCNT=FBCNT+1 I FBI'=FBCNT S ^TMP("FBAR",$J,FBCNT)=^TMP("FBAR",$J,FBI) K ^TMP("FBAR",$J,FBI)
"RTN","FBUCPAY",20,0)
 D DISPX^FBUCUTL1(1,1) ;display/make selection
"RTN","FBUCPAY",21,0)
 K ^TMP("FBAR",$J) G END:FBOUT!('+$G(FBARY)) ;nothing selected so go to end
"RTN","FBUCPAY",22,0)
LOOP ;loop thru selection and make payments
"RTN","FBUCPAY",23,0)
 N FBDA,FBI,FBNODE,FBP,FBPL,FBW,FBZ D PARSE^FBUCUTL4(FBARY)
"RTN","FBUCPAY",24,0)
 S (FBOUT,FBI)=0 F  S FBI=$O(^TMP("FBARY",$J,FBI)) Q:'FBI  S FBNODE=$G(^(FBI)),FBDA=+$P(FBNODE,";"),FBZ=$G(^FB583(FBDA,0)) D  ;D:$D(FBMESS) WRITE G END:FBOUT,ASK
"RTN","FBUCPAY",25,0)
 .I +$G(FBARY)>1 D LINE^FBUCUTL4(FBNODE,FBI,FBPL,FBW)
"RTN","FBUCPAY",26,0)
 .N FBI,FTP,DUOUT,DTOUT S FBOUT=0 D PAY(FBVET,FBPAY,FBZ)
"RTN","FBUCPAY",27,0)
 D END G ASK
"RTN","FBUCPAY",28,0)
 ;
"RTN","FBUCPAY",29,0)
PAY(FBVET,FBPAY,FBZ) ;determine payments
"RTN","FBUCPAY",30,0)
 I '($P(FBZ,U,11)=1!($P(FBZ,U,11)=4)) W *7 S FBMESS="Unauthorized claim must be Approved or Approved to Stabilization" D WRITE S FBMESS=" in order to make a payment." D WRITE S FBOUT=1 Q
"RTN","FBUCPAY",31,0)
 S (DFN,D0)=FBVET,FBPROG(1)=+$P(FBZ,U,2),FBSUBMIT=$P(FBZ,U,23),FBAAPTC=$S(FBPAY=2:"V",1:"R"),FBAIEN=+$P(FBZ,U,27) ;,FBAAPTC=$S(FBSUBMIT["DPT(":"R",FBSUBMIT["FBAAV(":"V",FBSUBMIT["VA(200,":"O",1:0)
"RTN","FBUCPAY",32,0)
 I FBPROG(1)=7 W *7,! S FBMESS="Fee program is community nursing home." D WRITE S FBMESS="Payments should not be authorized." D WRITE S FBOUT=1 Q
"RTN","FBUCPAY",33,0)
 I FBPROG(1)=6 S DIR(0)="YO",DIR("A")="Is this an ancillary payment",DIR("B")="No" D ^DIR K DIR S:$D(DIRUT) FBOUT=1 Q:$G(FBOUT)  S FBANC=+Y
"RTN","FBUCPAY",34,0)
 S FBPROG="I $P(^(0),""^"",9)[""FB583(""&($P(^(0),""^"",3)="_FBPROG(1)_")"
"RTN","FBUCPAY",35,0)
 S X=FBAIEN,CNT=X,CNT(CNT)=X D 2^FBAAUTL1 I $D(DUOUT)!(FTP']"") S FBOUT=1 Q
"RTN","FBUCPAY",36,0)
 ;
"RTN","FBUCPAY",37,0)
 ; enforce separation of duties
"RTN","FBUCPAY",38,0)
 I '$$UOKPAY^FBUTL9(DFN,FTP) D  S FBOUT=1 Q
"RTN","FBUCPAY",39,0)
 . W !!,"You cannot process a payment associated with authorization ",DFN,"-",FTP
"RTN","FBUCPAY",40,0)
 . W !,"due to separation of duties."
"RTN","FBUCPAY",41,0)
 ;
"RTN","FBUCPAY",42,0)
 I 'FBAIEN W *7 S FBMESS="No authorization associated with this 583!" D WRITE S FBOUT=1 Q
"RTN","FBUCPAY",43,0)
 ;I FB583'=FBDA W *7 S FBMESS="Authorization does not pertain to the selected unauthorized claim." D WRITE S FBOUT=1 Q
"RTN","FBUCPAY",44,0)
 I FBTYPE'=FBPROG(1) W *7 S FBMESS="Authorization Fee program differs from Fee program in Unauthorized Claim." D WRITE S FBOUT=1 Q
"RTN","FBUCPAY",45,0)
 S FBV583=FB583_";FB583("
"RTN","FBUCPAY",46,0)
 D CR Q:FBOUT
"RTN","FBUCPAY",47,0)
 D HOME^%ZIS W @IOF,!?25,"< UNAUTHORIZED CLAIM >",!! S DIC="^FB583(",DA=FB583,DR="0:LOG",DIQ(0)="C" D EN^DIQ W ! K DIC,DIQ,DR,DA,CNT,X
"RTN","FBUCPAY",48,0)
 D CR Q:FBOUT
"RTN","FBUCPAY",49,0)
 D  ;G 2:FBPROG(1)=2,3:FBPROG(1)=3,6:FBPROG(1)=6,7:FBPROG(1)=7
"RTN","FBUCPAY",50,0)
 .;payment for outpatinet
"RTN","FBUCPAY",51,0)
 .I FBPROG(1)=2 D EN583^FBAACO Q
"RTN","FBUCPAY",52,0)
 .;payments for pharmacy
"RTN","FBUCPAY",53,0)
 .I FBPROG(1)=3 D ^FBAAPIE Q
"RTN","FBUCPAY",54,0)
 .;payments for civil hospital
"RTN","FBUCPAY",55,0)
 .I FBPROG(1)=6 S FBI7078=FB583_";FB583(",$P(FBZ(0),"^",4)=$P(FBZ,U,5),FBRESUB="" D EN583^FBCHEP:'FBANC,EN583^FBCHCO:FBANC Q
"RTN","FBUCPAY",56,0)
 .;payments for community nursing home
"RTN","FBUCPAY",57,0)
 .I FBPROG(1)=7 W *7,! S FBMESS="Fee program is community nursing home." D WRITE S FBMESS="Payments should not be authorized." D WRITE
"RTN","FBUCPAY",58,0)
 Q
"RTN","FBUCPAY",59,0)
END ;kill variables and quit
"RTN","FBUCPAY",60,0)
 K FB,FBAABDT,FBAAEDT,FBAAOUT,FBAAPTC,FBAIEN,FBANC,FBASSOC,FBARY,FBCNT,FBDA,FBD1,FBFDC,FBI,FBIEN,FBIX,FBI7078,FBMST,FBO,FBOUT
"RTN","FBUCPAY",61,0)
 K FBRESUB,FBTTYPE,FBDMRA,FBMESS,FBPAY,FBPOV,FBPSA,FBPROG,FBPT,FBSUBMIT,FBTP,FBTT,FBTYPE,FBVEN,FBVET,FBV583,FBZ,FB583,FB7078,FTP
"RTN","FBUCPAY",62,0)
 K CNT,DFN,D0,DTOUT,DUOUT,DIC,DIR,DIRUT,DTOUT,DUOUT,TA,X,Y,^TMP("FBARY",$J)
"RTN","FBUCPAY",63,0)
 Q
"RTN","FBUCPAY",64,0)
WRITE ;write message
"RTN","FBUCPAY",65,0)
 W !?5,FBMESS
"RTN","FBUCPAY",66,0)
 Q
"RTN","FBUCPAY",67,0)
CR ;ask carriage return to continue
"RTN","FBUCPAY",68,0)
 S DIR(0)="E" D ^DIR K DIR I $D(DUOUT)!($D(DTOUT)) S FBOUT=1
"RTN","FBUCPAY",69,0)
 Q
"RTN","FBUCPAY",70,0)
 ;
"RTN","FBUCPAY",71,0)
GO(X) ;X=counter from ^TMP("FBAR",$J,X)
"RTN","FBUCPAY",72,0)
 I '$G(X) Q 0
"RTN","FBUCPAY",73,0)
 Q $S($P($G(^TMP("FBAR",$J,X)),U,3,8)']"":0,'$G(^TMP("FBAR",$J,X+1)):0,$P($G(^TMP("FBAR",$J,X+1)),U,3,8)]"":0,1:1)
"RTN","FBUCUPD")
0^61^B26849705^B22231260
"RTN","FBUCUPD",1,0)
FBUCUPD ;ALBISC/TET - UPDATE AFTER EVENT ;9/22/2014
"RTN","FBUCUPD",2,0)
 ;;3.5;FEE BASIS;**8,27,38,154**;JAN 30, 1995;Build 12
"RTN","FBUCUPD",3,0)
 ;;Per VA Directive 6402, this routine should not be modified.
"RTN","FBUCUPD",4,0)
UPDATE(FBUCP,FBUCPA,FBUCA,FBUCAA,FBDA,FBACT,FBUCDISR) ;update if before and after values differ
"RTN","FBUCUPD",5,0)
 ;INPUT:  FBUCP - zero node of 162.7, prior
"RTN","FBUCUPD",6,0)
 ;        FBUCPA- 'A' (appeal)  node of 162.7, prior
"RTN","FBUCUPD",7,0)
 ;        FBUCA - zero node of 162.7, after
"RTN","FBUCUPD",8,0)
 ;        FBUCAA- 'A' (appeal) node of 162.7, after
"RTN","FBUCUPD",9,0)
 ;        FBDA    - IEN of 162.7
"RTN","FBUCUPD",10,0)
 ;        FBACT - action type
"RTN","FBUCUPD",11,0)
 ;        FBUCDISR - (option) exists if disapp.
"RTN","FBUCUPD",12,0)
 ;           1 = denial reasons for gr to be same as prim
"RTN","FBUCUPD",13,0)
 ;           0 = ask denial reason for each claim in gr
"RTN","FBUCUPD",14,0)
 ;VARIABLES:
"RTN","FBUCUPD",15,0)
 ;        FBSTATUS - 0 if no change, or status ien to 162.92
"RTN","FBUCUPD",16,0)
 ;        FBORDER  - order number of status in 162.92
"RTN","FBUCUPD",17,0)
 ;        FBLET    - = 1 if status or disp. changed (letter should be printed)
"RTN","FBUCUPD",18,0)
 ;        FBDISP   - flag if disp. changed to approved from other
"RTN","FBUCUPD",19,0)
 ;                    than approved.  1 to delete disap. reasons
"RTN","FBUCUPD",20,0)
 ;                                    0 no action
"RTN","FBUCUPD",21,0)
 ;        FBDISPDT - date disp. changed, 0 if no change, "@" to delete
"RTN","FBUCUPD",22,0)
 ;        FBEXP    - exp. date, 0 if no change, "@" to delete
"RTN","FBUCUPD",23,0)
 ;                    or new date in internal format
"RTN","FBUCUPD",24,0)
 ;        FBVALID  - valid date claim rec., 0 if no change, "@" to delete
"RTN","FBUCUPD",25,0)
 ;                    or today's date in internal format
"RTN","FBUCUPD",26,0)
 ;        FBORIG   - date of original disp. or "@" to delete
"RTN","FBUCUPD",27,0)
 ;                    to approve.  1 is to set in file 161, 0 is to delete.
"RTN","FBUCUPD",28,0)
 I $S('+$G(FBDA):1,$G(FBACT)']"":1,$G(FBUCA)']"":1,1:0) G END
"RTN","FBUCUPD",29,0)
 ;
"RTN","FBUCUPD",30,0)
 I "^ENT^EDT^DIS^REO^APL^AED^COVA^"[("^"_FBACT_"^") D
"RTN","FBUCUPD",31,0)
 . N FBX,FBTXT
"RTN","FBUCUPD",32,0)
 . S FBTXT=""
"RTN","FBUCUPD",33,0)
 . I FBACT="ENT" S FBTXT="Enter claim."
"RTN","FBUCUPD",34,0)
 . I FBACT="EDT" S FBTXT="Edit claim."
"RTN","FBUCUPD",35,0)
 . I FBACT="DIS" S FBTXT="Disposition claim."
"RTN","FBUCUPD",36,0)
 . I FBACT="REO" S FBTXT="Reopen claim."
"RTN","FBUCUPD",37,0)
 . I FBACT="APL" S FBTXT="Enter appeal."
"RTN","FBUCUPD",38,0)
 . I FBACT="AED" S FBTXT="Edit appeal."
"RTN","FBUCUPD",39,0)
 . I FBACT="COVA" S FBTXT="Enter COVA appeal."
"RTN","FBUCUPD",40,0)
 . S FBX=$$ADDUA^FBUTL9(162.7,FBDA_",",FBTXT)
"RTN","FBUCUPD",41,0)
 . I 'FBX W !,"Error adding record in User Audit. Please contact IRM."
"RTN","FBUCUPD",42,0)
 ;
"RTN","FBUCUPD",43,0)
AUTH ;determine if auth. needs to be updated, based upon disp.
"RTN","FBUCUPD",44,0)
 ;returns variable FBAUTH, may returne FBOUT
"RTN","FBUCUPD",45,0)
 D AUTH^FBUCUPD1(FBUCP,FBUCA,FBDA,FBACT)
"RTN","FBUCUPD",46,0)
 ;
"RTN","FBUCUPD",47,0)
Q ;enter code to task remainder of update here
"RTN","FBUCUPD",48,0)
 ;S ZTRTN="DQ^FBUCUPD",ZTDESC="UPDATE UNAUTH CLAIM",ZTDTH=$H,ZTIO="",ZTSAVE("FBUCP")="",ZTSAVE("FBUCPA")="",ZTSAVE("FBUCA")="",ZTSAVE("FBUCAA")="",ZTSAVE("FBDA")="" S:$D(FBAUTH) ZTSAVE("FBAUTH")=""
"RTN","FBUCUPD",49,0)
 ;D ^%ZTLOAD G END
"RTN","FBUCUPD",50,0)
 ;
"RTN","FBUCUPD",51,0)
DQ ;de-queue tasked job here
"RTN","FBUCUPD",52,0)
 D:$D(XRTL) T0^%ZOSV ;start monitor
"RTN","FBUCUPD",53,0)
 N FBD1,FBD2,FBDISP,FBDISPDT,FBEXP,FBLET,FBORDER,FBORIG,FBST,FBSTATUS,FBUC,FBVALID S (FBDISP,FBDISPDT,FBEXP,FBLET,FBORDER,FBORIG,FBSTATUS,FBVALID)=0,FBUC=$$FBUC^FBUCUTL2(1)
"RTN","FBUCUPD",54,0)
 ;
"RTN","FBUCUPD",55,0)
STATUS ;determine status of claim
"RTN","FBUCUPD",56,0)
 ;FBST=status of claim prior to update;updated to most current
"RTN","FBUCUPD",57,0)
 S FBST=$$ORDER^FBUCUTL(+$P(FBUCA,U,24)) I FBST<40 S FBST=$S($$PEND^FBUCUTL(FBDA):10,$P(FBUC,U,7)&(FBACT="ENT"):5,1:30)
"RTN","FBUCUPD",58,0)
 ;
"RTN","FBUCUPD",59,0)
DISP ;dispostion change
"RTN","FBUCUPD",60,0)
 I $P(FBUCP,U,11)'=$P(FBUCA,U,11),$P(FBUCA,U,11) D
"RTN","FBUCUPD",61,0)
 .S FBST=$S($P(FBUCAA,U,6):90,$P(FBUCAA,U,4):70,1:40)
"RTN","FBUCUPD",62,0)
 .S FBDISPDT=DT,FBORIG=$S('$P(FBUCP,U,11)&(FBST=40):DT,1:0)
"RTN","FBUCUPD",63,0)
 I $P(FBUCP,U,11)'=$P(FBUCA,U,11),'$P(FBUCA,U,11) D
"RTN","FBUCUPD",64,0)
 .N FBO S FBO=$$ORDER^FBUCUTL(+$P(FBUCP,U,24))
"RTN","FBUCUPD",65,0)
 .I FBO=90 S FBST=$S($P(FBUCAA,U,5):80,1:70)
"RTN","FBUCUPD",66,0)
 .I FBO=70 S FBST=$S($P(FBUCAA,U,3):60,$P(FBUCAA,U,2):55,$P(FBUCAA,U):50,1:40)
"RTN","FBUCUPD",67,0)
 .I FBO=40 S FBST=$S($$PEND^FBUCUTL(FBDA):10,1:30)
"RTN","FBUCUPD",68,0)
 .S FBDISPDT="@",FBORIG=$S($$ORDER^FBUCUTL($P(FBUCP,U,24))=40:"@",1:0)
"RTN","FBUCUPD",69,0)
 I $P(FBUCP,U,11)'=$P(FBUCA,U,11) S FBLET=1 S FBD1=$P(FBUCP,U,11),FBD2=$P(FBUCA,U,11) I "^2^3^5^"[FBD1,"^1^4^"[FBD2 S FBDISP=1
"RTN","FBUCUPD",70,0)
 I $P(FBUCP,U,11)=$P(FBUCA,U,11),FBUCPA=FBUCAA S FBST=$S($P(FBUCA,U,11):40,1:FBST)
"RTN","FBUCUPD",71,0)
 ;
"RTN","FBUCUPD",72,0)
APPEAL ;appeal change - check if disposition remains unchanged
"RTN","FBUCUPD",73,0)
 I FBUCAA]""!(FBUCPA'=FBUCAA) D
"RTN","FBUCUPD",74,0)
 .I $P(FBUCAA,U,2)&($P(FBUCA,U,11)=5) S FBST=70 Q
"RTN","FBUCUPD",75,0)
 .S FBST=$S('$P(FBUCAA,U):40,'$P(FBUCAA,U,2):50,'$P(FBUCAA,U,3):55,'$P(FBUCAA,U,4):60,'$P(FBUCAA,U,5):70,'$P(FBUCAA,U,6):80,$P(FBUCAA,U,6):90,$P(FBUCAA,U,5):80,$P(FBUCAA,U,4):70,$P(FBUCAA,U,3):60,$P(FBUCAA,U,2):55,$P(FBUCAA,U):50,1:FBST)
"RTN","FBUCUPD",76,0)
 ;
"RTN","FBUCUPD",77,0)
 S FBORDER=FBST,FBSTATUS=$$STATUS^FBUCUTL(FBORDER) S:FBORIG]"" $P(FBUCA,U,22)=$S(FBORIG="@":"",FBORIG=0:"",1:FBORIG)
"RTN","FBUCUPD",78,0)
 I FBSTATUS,FBSTATUS'=$P(FBUCA,U,24)!(FBUCP']"")!((FBORDER=10)&("^ENT^REQ^"[FBACT)) D
"RTN","FBUCUPD",79,0)
 .S FBLET=$S(FBORDER=10:1,FBORDER=40&(FBACT="ENT"):1,FBORDER=$$ORDER^FBUCUTL(+$P(FBUCA,U,24)):0,1:1) I FBLET S FBLET=$S($$LETTER^FBUCUTL2(FBORDER):1,1:0)
"RTN","FBUCUPD",80,0)
 .S FBVALID=$S(FBORDER>20&('$P(FBUCA,U,8))&('$$PEND^FBUCUTL(FBDA)):DT,FBORDER<20&($P(FBUCA,U,8)):"@",1:0)
"RTN","FBUCUPD",81,0)
 I FBACT="REC" N FBEXPD27 S FBEXPD27=$S(+$P(FBUCA,U,26)>0:0,+$P(FBUCA,U,19)>0:+$P(FBUCA,U,19),1:0)
"RTN","FBUCUPD",82,0)
 S:'FBLET FBEXP=$$EXPIRE^FBUCUTL8(FBDA,$S(FBORDER>$$ORDER^FBUCUTL(+$P(FBUCA,U,24)):$S('$P(FBUCA,U,25):DT,1:+$P(FBUCA,U,25)),FBACT="REC":$S($D(FBEXPD27):FBEXPD27,1:0),FBORDER=55:+$P(FBUCAA,U,2),1:DT),FBUCA,FBORDER)
"RTN","FBUCUPD",83,0)
 ;
"RTN","FBUCUPD",84,0)
DIE ;die update
"RTN","FBUCUPD",85,0)
 I $S(FBSTATUS:1,FBVALID'=0:1,FBEXP'=0:1,FBLET:1,FBORIG'=0:1,FBDISPDT'=0:1,1:0) S DA=FBDA,DIE="^FB583(",DR="[FB UNAUTHORIZED UPDATE]" D
"RTN","FBUCUPD",86,0)
 .D LOCK^FBUCUTL(DIE,DA,1) I FBLOCK D ^DIE D  L -^FB583(FBDA)
"RTN","FBUCUPD",87,0)
 ..I FBUCP'=FBUCA!(FBUCPA'=FBUCAA) S DR="27////^S X=DUZ;28///^S X=DT" D
"RTN","FBUCUPD",88,0)
 ...I $P(FBUCAA,U,2)&($P(FBUCA,U,11)=5) S DR=DR_";53///^S X=DT"
"RTN","FBUCUPD",89,0)
 ...D ^DIE
"RTN","FBUCUPD",90,0)
 .K DIE,DA,DR,DQ,FBLOCK
"RTN","FBUCUPD",91,0)
 .D:FBDISP DELDAP^FBUCUTL3(FBDA)
"RTN","FBUCUPD",92,0)
 .I $G(FBUCDISR)=0!($P($G(FBUCDISR),U)=1) D DISAPR^FBUCUTL8
"RTN","FBUCUPD",93,0)
 S:$D(XRT0) XRTN=$T(+0) D:$D(XRT0) T1^%ZOSV ;stop monitor
"RTN","FBUCUPD",94,0)
 ;
"RTN","FBUCUPD",95,0)
LETTER ;letter denoting change of status or disposition
"RTN","FBUCUPD",96,0)
 N FBLETDT I FBLET,"^1^4^"'[(U_$P(FBUCA,U,11)_U) D AUTO^FBUCLET(FBDA,FBORDER,FBUCA,FBUC) ;print letter/update fields if letter prints
"RTN","FBUCUPD",97,0)
END ;kill variables and quit
"RTN","FBUCUPD",98,0)
 K FBAUTH,FBLOCK,FBUCAA,FBUCP,FBUCPA,XRT0,XRTN,ZTDESC,ZTDTH,ZTIO,ZTRTN,ZTSAVE Q
"RTN","FBUTL9")
0^69^B6528526^n/a
"RTN","FBUTL9",1,0)
FBUTL9 ;WIOFO/SAB - FEE BASIS UTILITY FOR USER AUDIT ;6/18/2014
"RTN","FBUTL9",2,0)
 ;;3.5;FEE BASIS;**154**;JAN 30, 1995;Build 12
"RTN","FBUTL9",3,0)
 ;;Per VA Directive 6402, this routine should not be modified.
"RTN","FBUTL9",4,0)
 Q
"RTN","FBUTL9",5,0)
ADDUA(FBFILE,FBIENS,FBTXT) ; Add record to User Audit multiple
"RTN","FBUTL9",6,0)
 ; input
"RTN","FBUTL9",7,0)
 ;   FBFILE - file being edited
"RTN","FBUTL9",8,0)
 ;   FBIENS - internal entry number of record being edited in file
"RTN","FBUTL9",9,0)
 ;   FBTXT  - (optional) text describing nature of edit, max 60 char
"RTN","FBUTL9",10,0)
 ; returns 1 if record added, 0 if record not added
"RTN","FBUTL9",11,0)
 ;
"RTN","FBUTL9",12,0)
 N FBAFILE,FBAIENS,FBRET
"RTN","FBUTL9",13,0)
 S FBRET=0
"RTN","FBUTL9",14,0)
 ;
"RTN","FBUTL9",15,0)
 S FBFILE=$G(FBFILE)
"RTN","FBUTL9",16,0)
 I FBFILE=161.01 S FBAFILE=161.192
"RTN","FBUTL9",17,0)
 I FBFILE=162.2 S FBAFILE=162.292
"RTN","FBUTL9",18,0)
 I FBFILE=162.4 S FBAFILE=162.492
"RTN","FBUTL9",19,0)
 I FBFILE=162.7 S FBAFILE=162.792
"RTN","FBUTL9",20,0)
 ;
"RTN","FBUTL9",21,0)
 I $G(FBIENS)]"" S FBAIENS="+1,"_FBIENS
"RTN","FBUTL9",22,0)
 ;
"RTN","FBUTL9",23,0)
 I $G(FBAFILE)]"",$G(FBAIENS)]"" D
"RTN","FBUTL9",24,0)
 . N FBFDA,DIERR
"RTN","FBUTL9",25,0)
 . S FBFDA(FBAFILE,FBAIENS,.01)=$$NOW^XLFDT ; DATE/TIME EDITED
"RTN","FBUTL9",26,0)
 . S FBFDA(FBAFILE,FBAIENS,1)=DUZ ; EDITED BY
"RTN","FBUTL9",27,0)
 . S:$G(FBTXT)]"" FBFDA(FBAFILE,FBAIENS,2)=$E(FBTXT,1,60) ; COMMENTS
"RTN","FBUTL9",28,0)
 . D UPDATE^DIE("","FBFDA")
"RTN","FBUTL9",29,0)
 . I $G(DIERR)="" S FBRET=1
"RTN","FBUTL9",30,0)
 Q FBRET
"RTN","FBUTL9",31,0)
 ;
"RTN","FBUTL9",32,0)
UOKPAY(FBDFN,FBAUTHP,FBUSR) ; User OK to Pay
"RTN","FBUTL9",33,0)
 ; inputs
"RTN","FBUTL9",34,0)
 ;   FBDFN   = Patient IEN (file 161 and file 2)
"RTN","FBUTL9",35,0)
 ;   FBAUTHP = Authorization IEN (sub-file 161.01)
"RTN","FBUTL9",36,0)
 ;   FBUSR   = (Optional) User IEN (file 200), defaults to DUZ
"RTN","FBUTL9",37,0)
 ; return
"RTN","FBUTL9",38,0)
 ;   = 1 if OK for user to enter payment associated with authorization
"RTN","FBUTL9",39,0)
 ;   = 0^message if not OK for user to enter payment 
"RTN","FBUTL9",40,0)
 ;
"RTN","FBUTL9",41,0)
 N FBRET
"RTN","FBUTL9",42,0)
 S FBRET=1
"RTN","FBUTL9",43,0)
 I $G(FBUSR)="" S FBUSR=$G(DUZ)
"RTN","FBUTL9",44,0)
 ;
"RTN","FBUTL9",45,0)
 I $G(FBDFN),$G(FBAUTHP) D
"RTN","FBUTL9",46,0)
 . N FB583,FB7078,FBX
"RTN","FBUTL9",47,0)
 . ; check file 161
"RTN","FBUTL9",48,0)
 . I $O(^FBAAA(FBDFN,1,FBAUTHP,"LOG1","AU",FBUSR,0)) S FBRET="0^authorization edited" Q
"RTN","FBUTL9",49,0)
 . ;
"RTN","FBUTL9",50,0)
 . S FBX=$P($G(^FBAAA(FBDFN,1,FBAUTHP,0)),"^",9) ; ASSOCIATED 7078/583
"RTN","FBUTL9",51,0)
 . I FBX[";FB7078(" S FB7078=+FBX
"RTN","FBUTL9",52,0)
 . I FBX[";FB583(" S FB583=+FBX
"RTN","FBUTL9",53,0)
 . ;
"RTN","FBUTL9",54,0)
 . I $G(FB7078) D  Q:FBRET'>0
"RTN","FBUTL9",55,0)
 . . N FBNR
"RTN","FBUTL9",56,0)
 . . ; check file 162.4 when 7078
"RTN","FBUTL9",57,0)
 . . I $O(^FB7078(FB7078,"LOG1","AU",FBUSR,0)) S FBRET="0^7078 edited" Q
"RTN","FBUTL9",58,0)
 . . ; check file 162.2 if notification/request exists for 7078
"RTN","FBUTL9",59,0)
 . . S FBNR=$O(^FBAA(162.2,"AM",FB7078,0))
"RTN","FBUTL9",60,0)
 . . I FBNR,$O(^FBAA(162.2,FBNR,"LOG1","AU",FBUSR,0)) S FBRET="0^CH notification/request edited"
"RTN","FBUTL9",61,0)
 . ;
"RTN","FBUTL9",62,0)
 . ; check file 162.7 when unauthorized claim
"RTN","FBUTL9",63,0)
 . I $G(FB583),$O(^FB583(FB583,"LOG1","AU",FBUSR,0)) S FBRET="0^unauthorized claim edited" Q
"RTN","FBUTL9",64,0)
 ;
"RTN","FBUTL9",65,0)
 Q FBRET
"RTN","FBUTL9",66,0)
 ;
"RTN","FBUTL9",67,0)
 ;FBUTL9
"RTN","FBXIP154")
0^70^B186355971^n/a
"RTN","FBXIP154",1,0)
FBXIP154 ;WOIFO/SAB - PATCH INSTALL ROUTINE ;12/2/2014
"RTN","FBXIP154",2,0)
 ;;3.5;FEE BASIS;**154**;JAN 30, 1995;Build 12
"RTN","FBXIP154",3,0)
 ;;Per VA Directive 6402, this routine should not be modified.
"RTN","FBXIP154",4,0)
 ; 
"RTN","FBXIP154",5,0)
 ; ICRs
"RTN","FBXIP154",6,0)
 ;  #2050   MSG^DIALOG
"RTN","FBXIP154",7,0)
 ;  #2052   $$GET1^DID
"RTN","FBXIP154",8,0)
 ;  #2053   FILE^DIE, UPDATE^DIE
"RTN","FBXIP154",9,0)
 ;  #2056   $$GET1^DIQ
"RTN","FBXIP154",10,0)
 ;  #2343   $$ACTIVE^XUSER()
"RTN","FBXIP154",11,0)
 ;  #10103  $$FMADD^XLFDT
"RTN","FBXIP154",12,0)
 ;  #10141  BMES^XPDUTL, MES^XPDUTL, $$NEWCP^XPDUTL
"RTN","FBXIP154",13,0)
 ;
"RTN","FBXIP154",14,0)
PS ; post-install entry point
"RTN","FBXIP154",15,0)
 ; create KIDS checkpoints with call backs
"RTN","FBXIP154",16,0)
 N FBX,Y
"RTN","FBXIP154",17,0)
 F FBX="USRAUD","AUTHP" D
"RTN","FBXIP154",18,0)
 . S Y=$$NEWCP^XPDUTL(FBX,FBX_"^FBXIP154")
"RTN","FBXIP154",19,0)
 . I 'Y D BMES^XPDUTL("ERROR Creating "_FBX_" Checkpoint.")
"RTN","FBXIP154",20,0)
 Q
"RTN","FBXIP154",21,0)
 ;
"RTN","FBXIP154",22,0)
USRAUD ; populate user audit
"RTN","FBXIP154",23,0)
 N DA,DIERR,FBC,FBCE,FBDT,FBFILE,FBIENS,FBTXT,FBUSR,FBY
"RTN","FBXIP154",24,0)
 D BMES^XPDUTL("    Creating User Audit entries. This may take some time.")
"RTN","FBXIP154",25,0)
 ;
"RTN","FBXIP154",26,0)
 ; populate user audit in file 162.2
"RTN","FBXIP154",27,0)
 D MES^XPDUTL("      processing file 162.2...")
"RTN","FBXIP154",28,0)
 S (FBC,FBCE)=0
"RTN","FBXIP154",29,0)
 S FBFILE=162.292
"RTN","FBXIP154",30,0)
 S FBTXT(1)="Added by FB*3.5*154 based on legal determination."
"RTN","FBXIP154",31,0)
 S FBTXT(2)="Added by FB*3.5*154 based on medical determination."
"RTN","FBXIP154",32,0)
 S FBTXT(3)="Added by FB*3.5*154 based on user entering & install date."
"RTN","FBXIP154",33,0)
 ; loop thru file 162.2
"RTN","FBXIP154",34,0)
 S DA=0 F  S DA=$O(^FBAA(162.2,DA)) Q:'DA  D
"RTN","FBXIP154",35,0)
 . ; skip if user audit already populated
"RTN","FBXIP154",36,0)
 . Q:$O(^FBAA(162.2,DA,"LOG1",0))
"RTN","FBXIP154",37,0)
 . ;
"RTN","FBXIP154",38,0)
 . S FBIENS=DA_","
"RTN","FBXIP154",39,0)
 . S FBY=$G(^FBAA(162.2,DA,0))
"RTN","FBXIP154",40,0)
 . ;
"RTN","FBXIP154",41,0)
 . S FBDT=$P(FBY,U,10) ; DATE OF LEGAL DETERMINATION
"RTN","FBXIP154",42,0)
 . S FBUSR=$P(FBY,U,11) ; USER ENTERING LEGAL DETERM.
"RTN","FBXIP154",43,0)
 . I FBDT,FBUSR D ADDUA(FBFILE,FBIENS,FBDT,FBUSR,FBTXT(1))
"RTN","FBXIP154",44,0)
 . ;
"RTN","FBXIP154",45,0)
 . S FBDT=$P(FBY,U,13) ; DATE OF MEDICAL DETERMINATION
"RTN","FBXIP154",46,0)
 . S FBUSR=$P(FBY,U,14) ; USER ENTERING MEDICAL DETERM.
"RTN","FBXIP154",47,0)
 . I FBDT,FBUSR D ADDUA(FBFILE,FBIENS,FBDT,FBUSR,FBTXT(2))
"RTN","FBXIP154",48,0)
 . ;
"RTN","FBXIP154",49,0)
 . S FBDT=DT ; current (install) date
"RTN","FBXIP154",50,0)
 . S FBUSR=$P(FBY,U,8) ; USER ENTERING NOTIFICATION
"RTN","FBXIP154",51,0)
 . I FBDT,FBUSR D ADDUA(FBFILE,FBIENS,FBDT,FBUSR,FBTXT(3))
"RTN","FBXIP154",52,0)
 D SHOWCNT
"RTN","FBXIP154",53,0)
 ;
"RTN","FBXIP154",54,0)
 ; populate user audit in file 162.4
"RTN","FBXIP154",55,0)
 D MES^XPDUTL("      processing file 162.4...")
"RTN","FBXIP154",56,0)
 S (FBC,FBCE)=0
"RTN","FBXIP154",57,0)
 S FBFILE=162.492
"RTN","FBXIP154",58,0)
 S FBTXT="Added by FB*3.5*154 based on user entering & date of issue."
"RTN","FBXIP154",59,0)
 ; loop thru file 162.4
"RTN","FBXIP154",60,0)
 S DA=0 F  S DA=$O(^FB7078(DA)) Q:'DA  D
"RTN","FBXIP154",61,0)
 . ; skip if user audit already populated
"RTN","FBXIP154",62,0)
 . Q:$O(^FB7078(DA,"LOG1",0))
"RTN","FBXIP154",63,0)
 . ;
"RTN","FBXIP154",64,0)
 . S FBIENS=DA_","
"RTN","FBXIP154",65,0)
 . S FBY=$G(^FB7078(DA,0))
"RTN","FBXIP154",66,0)
 . ;
"RTN","FBXIP154",67,0)
 . S FBDT=$P(FBY,U,10) ; DATE OF ISSUE
"RTN","FBXIP154",68,0)
 . S FBUSR=$P(FBY,U,8) ; USER ENTERING
"RTN","FBXIP154",69,0)
 . I FBDT,FBUSR D ADDUA(FBFILE,FBIENS,FBDT,FBUSR,FBTXT)
"RTN","FBXIP154",70,0)
 D SHOWCNT
"RTN","FBXIP154",71,0)
 ;
"RTN","FBXIP154",72,0)
 ; populate user audit in file 162.7
"RTN","FBXIP154",73,0)
 D MES^XPDUTL("      processing file 162.7...")
"RTN","FBXIP154",74,0)
 S (FBC,FBCE)=0
"RTN","FBXIP154",75,0)
 S FBFILE=162.792
"RTN","FBXIP154",76,0)
 S FBTXT="Added by FB*3.5*154 based on entered/last edited."
"RTN","FBXIP154",77,0)
 ; loop thru file 162.7
"RTN","FBXIP154",78,0)
 S DA=0 F  S DA=$O(^FB583(DA)) Q:'DA  D
"RTN","FBXIP154",79,0)
 . ; skip if user audit already populated
"RTN","FBXIP154",80,0)
 . Q:$O(^FB583(DA,"LOG1",0))
"RTN","FBXIP154",81,0)
 . ;
"RTN","FBXIP154",82,0)
 . S FBIENS=DA_","
"RTN","FBXIP154",83,0)
 . S FBY=$G(^FB583(DA,0))
"RTN","FBXIP154",84,0)
 . ;
"RTN","FBXIP154",85,0)
 . S FBDT=$P(FBY,U,18) ; DATE ENTERED/LAST EDITED
"RTN","FBXIP154",86,0)
 . S FBUSR=$P(FBY,U,17) ; ENTERED/LAST EDITED BY
"RTN","FBXIP154",87,0)
 . I FBDT,FBUSR D ADDUA(FBFILE,FBIENS,FBDT,FBUSR,FBTXT)
"RTN","FBXIP154",88,0)
 D SHOWCNT
"RTN","FBXIP154",89,0)
 ;
"RTN","FBXIP154",90,0)
 ; populate user audit in sub-file 161.01
"RTN","FBXIP154",91,0)
 D MES^XPDUTL("      processing sub-file 161.01...")
"RTN","FBXIP154",92,0)
 S (FBC,FBCE)=0
"RTN","FBXIP154",93,0)
 S FBFILE=161.192
"RTN","FBXIP154",94,0)
 S FBTXT="Added by FB*3.5*154 based on clerk & install date."
"RTN","FBXIP154",95,0)
 ; loop thru file 161
"RTN","FBXIP154",96,0)
 S DA(1)=0 F  S DA(1)=$O(^FBAAA(DA(1))) Q:'DA(1)  D
"RTN","FBXIP154",97,0)
 . ; loop thru sub-file 161.01
"RTN","FBXIP154",98,0)
 . S DA=0 F  S DA=$O(^FBAAA(DA(1),1,DA)) Q:'DA  D
"RTN","FBXIP154",99,0)
 . . N FBX
"RTN","FBXIP154",100,0)
 . . ; skip if user audit already populated
"RTN","FBXIP154",101,0)
 . . Q:$O(^FBAAA(DA(1),1,DA,"LOG1",0))
"RTN","FBXIP154",102,0)
 . . ;
"RTN","FBXIP154",103,0)
 . . S FBIENS=DA_","_DA(1)_","
"RTN","FBXIP154",104,0)
 . . ;
"RTN","FBXIP154",105,0)
 . . S FBDT=DT ; current (install) date
"RTN","FBXIP154",106,0)
 . . S FBUSR=$P($G(^FBAAA(DA(1),1,DA,100)),U) ; CLERK
"RTN","FBXIP154",107,0)
 . . S FBX=$P($G(^FBAAA(DA(1),1,DA,0)),U,9) ; ASSOCIATED 7078/583
"RTN","FBXIP154",108,0)
 . . ;
"RTN","FBXIP154",109,0)
 . . ; skip if 7078 and clerk already in file 162.4 user audit
"RTN","FBXIP154",110,0)
 . . I FBUSR,FBX[";FB7078(",$O(^FB7078(+FBX,"LOG1","AU",FBUSR,0)) Q
"RTN","FBXIP154",111,0)
 . . ;
"RTN","FBXIP154",112,0)
 . . ; skip if U/C and clerk already in file 162.7 user audit
"RTN","FBXIP154",113,0)
 . . I FBUSR,FBX[";FB583(",$O(^FB583(+FBX,"LOG1","AU",FBUSR,0)) Q
"RTN","FBXIP154",114,0)
 . . ;
"RTN","FBXIP154",115,0)
 . . I FBDT,FBUSR D ADDUA(FBFILE,FBIENS,FBDT,FBUSR,FBTXT)
"RTN","FBXIP154",116,0)
 D SHOWCNT
"RTN","FBXIP154",117,0)
 ;
"RTN","FBXIP154",118,0)
 D MES^XPDUTL("    Done creating user audit entries.")
"RTN","FBXIP154",119,0)
 Q
"RTN","FBXIP154",120,0)
 ;
"RTN","FBXIP154",121,0)
ADDUA(FBFILE,FBIENS,FBDT,FBUSR,FBTXT) ; add user audit record
"RTN","FBXIP154",122,0)
 Q:FBDT'?7N  ; invalid date
"RTN","FBXIP154",123,0)
 Q:$$ACTIVE^XUSER(FBUSR)=""  ; no user record found
"RTN","FBXIP154",124,0)
 N FBFDA
"RTN","FBXIP154",125,0)
 S FBIENS="+1,"_FBIENS
"RTN","FBXIP154",126,0)
 S FBFDA(FBFILE,FBIENS,.01)=FBDT ; DATE/TIME EDITED
"RTN","FBXIP154",127,0)
 S FBFDA(FBFILE,FBIENS,1)=FBUSR ; EDITED BY
"RTN","FBXIP154",128,0)
 S FBFDA(FBFILE,FBIENS,2)=FBTXT ; COMMENTS
"RTN","FBXIP154",129,0)
 D UPDATE^DIE("","FBFDA")
"RTN","FBXIP154",130,0)
 I $G(DIERR)="" S FBC=FBC+1
"RTN","FBXIP154",131,0)
 E  D
"RTN","FBXIP154",132,0)
 . S FBCE=FBCE+1
"RTN","FBXIP154",133,0)
 . D MES^XPDUTL("          "_"Error creating record with IENS "_FBIENS)
"RTN","FBXIP154",134,0)
 Q
"RTN","FBXIP154",135,0)
 ;
"RTN","FBXIP154",136,0)
SHOWCNT ; show counts for file
"RTN","FBXIP154",137,0)
 D MES^XPDUTL("        "_FBC_" user audit entries were created.")
"RTN","FBXIP154",138,0)
 D:FBCE MES^XPDUTL("        "_FBCE_" user audit entries not created due to error.")
"RTN","FBXIP154",139,0)
 Q
"RTN","FBXIP154",140,0)
 ;
"RTN","FBXIP154",141,0)
AUTHP ; populate authorization pointer data
"RTN","FBXIP154",142,0)
 N DA,DIERR,FBA,FBAUTHP,FBFE,FBIENS,FBP,FBT,FBX,FBYA,FBYD,FBYP
"RTN","FBXIP154",143,0)
 D MES^XPDUTL("Populating new AUTHORIZATION POINTER field. This may take some time...")
"RTN","FBXIP154",144,0)
 ;
"RTN","FBXIP154",145,0)
 ; init counters
"RTN","FBXIP154",146,0)
 S FBT("TLN")=0 ; total line items
"RTN","FBXIP154",147,0)
 S FBT("TLN","SKIP")=0 ; lines skipped because new field was populated
"RTN","FBXIP154",148,0)
 S FBT("TLN","PROC")=0 ; lines processed
"RTN","FBXIP154",149,0)
 S FBT("NOP")=0 ; processed lines without old authorization pointer
"RTN","FBXIP154",150,0)
 S FBT("NOP","7078C")=0 ; populated based on 7078/583 match
"RTN","FBXIP154",151,0)
 S FBT("NOP","7078U")=0 ; not populated, no 7078/583 match found
"RTN","FBXIP154",152,0)
 S FBT("NOP","POVC")=0 ; populated based on POV match
"RTN","FBXIP154",153,0)
 S FBT("NOP","POVU")=0 ; not populated, no POV match found
"RTN","FBXIP154",154,0)
 S FBT("PTR")=0 ; processed lines with old authorization pointer
"RTN","FBXIP154",155,0)
 S FBT("PTR","7078M")=0 ; populated with same value based on 7078/583
"RTN","FBXIP154",156,0)
 S FBT("PTR","7078C")=0 ; populated with diff value based on 7078/583
"RTN","FBXIP154",157,0)
 S FBT("PTR","7078U")=0 ; populated with same value, no 7078/583 match
"RTN","FBXIP154",158,0)
 S FBT("PTR","POVM")=0 ; populated with same value based on POV
"RTN","FBXIP154",159,0)
 S FBT("PTR","POVC")=0 ; populated with diff value based on POV
"RTN","FBXIP154",160,0)
 S FBT("PTR","POVU")=0 ; populated with same value, no POV match
"RTN","FBXIP154",161,0)
 ;
"RTN","FBXIP154",162,0)
 ; set header for XTMP with purge date in 120 days
"RTN","FBXIP154",163,0)
 S ^XTMP("FB*3.5*154",0)=$$FMADD^XLFDT(DT,120)_"^"_DT_"^From patch FB*3.5*154 post init."
"RTN","FBXIP154",164,0)
 ;
"RTN","FBXIP154",165,0)
 ; determine if old field still exists
"RTN","FBXIP154",166,0)
 S FBFE=$S($$GET1^DID(162.02,3,"","LABEL")="*AUTHORIZATION POINTER":1,1:0)
"RTN","FBXIP154",167,0)
 ;
"RTN","FBXIP154",168,0)
 ; loop thru outpatient and ancillary line items in FEE BASIS PAYMENT
"RTN","FBXIP154",169,0)
 ; loop thru patients
"RTN","FBXIP154",170,0)
 S DA(3)=0
"RTN","FBXIP154",171,0)
 F  S DA(3)=$O(^FBAAC(DA(3))) Q:'DA(3)  D
"RTN","FBXIP154",172,0)
 . ; loop thru vendors
"RTN","FBXIP154",173,0)
 . S DA(2)=0
"RTN","FBXIP154",174,0)
 . F  S DA(2)=$O(^FBAAC(DA(3),1,DA(2))) Q:'DA(2)  D
"RTN","FBXIP154",175,0)
 . . ; loop thru dates of service
"RTN","FBXIP154",176,0)
 . . S DA(1)=0
"RTN","FBXIP154",177,0)
 . . F  S DA(1)=$O(^FBAAC(DA(3),1,DA(2),1,DA(1))) Q:'DA(1)  D
"RTN","FBXIP154",178,0)
 . . . S FBYD=$G(^FBAAC(DA(3),1,DA(2),1,DA(1),0))
"RTN","FBXIP154",179,0)
 . . . S FBP("DOS")=$P(FBYD,U,1) ; date of service
"RTN","FBXIP154",180,0)
 . . . S FBP("FTP")=$S(FBFE:$P(FBYD,U,4),1:"") ; old value
"RTN","FBXIP154",181,0)
 . . . ; don't use old value if authorization does not exist in file 161
"RTN","FBXIP154",182,0)
 . . . I FBP("FTP"),'$D(^FBAAA(DA(3),1,FBP("FTP"),0)) S FBP("FTP")=""
"RTN","FBXIP154",183,0)
 . . . S FBYA=$S(FBP("FTP"):$G(^FBAAA(DA(3),1,FBP("FTP"),0)),1:"")
"RTN","FBXIP154",184,0)
 . . . S FBA("POV")=$P(FBYA,U,7) ; PURPOSE OF VISIT
"RTN","FBXIP154",185,0)
 . . . S FBA("7078")=$P(FBYA,U,9) ; ASSOCIATED 7078/583
"RTN","FBXIP154",186,0)
 . . . ; loop thru service provided
"RTN","FBXIP154",187,0)
 . . . S DA=0
"RTN","FBXIP154",188,0)
 . . . F  S DA=$O(^FBAAC(DA(3),1,DA(2),1,DA(1),1,DA)) Q:'DA  D
"RTN","FBXIP154",189,0)
 . . . . S FBT("TLN")=FBT("TLN")+1
"RTN","FBXIP154",190,0)
 . . . . S FBIENS=DA_","_DA(1)_","_DA(2)_","_DA(3)_","
"RTN","FBXIP154",191,0)
 . . . . ;
"RTN","FBXIP154",192,0)
 . . . . ; skip if already converted (i.e. new field populated)
"RTN","FBXIP154",193,0)
 . . . . I $P($G(^FBAAC(DA(3),1,DA(2),1,DA(1),1,DA,3)),U,9) D  Q
"RTN","FBXIP154",194,0)
 . . . . . S FBT("TLN","SKIP")=FBT("TLN","SKIP")+1
"RTN","FBXIP154",195,0)
 . . . . S FBT("TLN","PROC")=FBT("TLN","PROC")+1
"RTN","FBXIP154",196,0)
 . . . . ;
"RTN","FBXIP154",197,0)
 . . . . S FBYP=$G(^FBAAC(DA(3),1,DA(2),1,DA(1),1,DA,0))
"RTN","FBXIP154",198,0)
 . . . . S FBP("7078")=$P(FBYP,U,13) ; ASSOCIATED 7078/583
"RTN","FBXIP154",199,0)
 . . . . S FBP("POV")=$P(FBYP,U,18) ; PURPOSE OF VISIT
"RTN","FBXIP154",200,0)
 . . . . ;
"RTN","FBXIP154",201,0)
 . . . . I 'FBP("FTP") S FBT("NOP")=FBT("NOP")+1 ; no old pointer
"RTN","FBXIP154",202,0)
 . . . . E  S FBT("PTR")=FBT("PTR")+1 ; old pointer exists
"RTN","FBXIP154",203,0)
 . . . . ;
"RTN","FBXIP154",204,0)
 . . . . ; determine correct authorization pointer for line item
"RTN","FBXIP154",205,0)
 . . . . S FBAUTHP="" ; init new auth pointer value
"RTN","FBXIP154",206,0)
 . . . . ; if payment associated 7078/583 exists then match with that
"RTN","FBXIP154",207,0)
 . . . . I FBP("7078")]"" D
"RTN","FBXIP154",208,0)
 . . . . . ; if pointer exists and 7078/583 matches then copy old value
"RTN","FBXIP154",209,0)
 . . . . . I FBP("FTP"),FBP("7078")=FBA("7078") D  Q:FBAUTHP
"RTN","FBXIP154",210,0)
 . . . . . . S FBAUTHP=FBP("FTP")
"RTN","FBXIP154",211,0)
 . . . . . . S FBT("PTR","7078M")=FBT("PTR","7078M")+1
"RTN","FBXIP154",212,0)
 . . . . . ; if 7078/583 does not match then look for an better auth.
"RTN","FBXIP154",213,0)
 . . . . . I FBP("7078")'=FBA("7078") D  Q:FBAUTHP
"RTN","FBXIP154",214,0)
 . . . . . . S FBX=$$ASSOC(DA(3),FBP("DOS"),FBP("7078"))
"RTN","FBXIP154",215,0)
 . . . . . . Q:'FBX
"RTN","FBXIP154",216,0)
 . . . . . . S FBAUTHP=FBX
"RTN","FBXIP154",217,0)
 . . . . . . I FBP("FTP") S FBT("PTR","7078C")=FBT("PTR","7078C")+1
"RTN","FBXIP154",218,0)
 . . . . . . I 'FBP("FTP") S FBT("NOP","7078C")=FBT("NOP","7078C")+1
"RTN","FBXIP154",219,0)
 . . . . . . S ^XTMP("FB*3.5*154","7078C",FBIENS)=FBP("FTP")_"^"_FBAUTHP
"RTN","FBXIP154",220,0)
 . . . . . I 'FBAUTHP D
"RTN","FBXIP154",221,0)
 . . . . . . ; if better auth. not found use old value when available
"RTN","FBXIP154",222,0)
 . . . . . . I FBP("FTP") S FBAUTHP=FBP("FTP")
"RTN","FBXIP154",223,0)
 . . . . . . I FBP("FTP") S FBT("PTR","7078U")=FBT("PTR","7078U")+1
"RTN","FBXIP154",224,0)
 . . . . . . I 'FBP("FTP") S FBT("NOP","7078U")=FBT("NOP","7078U")+1
"RTN","FBXIP154",225,0)
 . . . . . . S ^XTMP("FB*3.5*154","7078U",FBIENS)=FBP("FTP")_"^"_FBAUTHP
"RTN","FBXIP154",226,0)
 . . . . ;
"RTN","FBXIP154",227,0)
 . . . . ; if payment associated 7078/583 blank then match with POV
"RTN","FBXIP154",228,0)
 . . . . I FBP("7078")="" D
"RTN","FBXIP154",229,0)
 . . . . . ; if pointer exists and POV matches then copy old value
"RTN","FBXIP154",230,0)
 . . . . . I FBP("FTP"),FBP("POV")=FBA("POV") D  Q:FBAUTHP
"RTN","FBXIP154",231,0)
 . . . . . . S FBAUTHP=FBP("FTP")
"RTN","FBXIP154",232,0)
 . . . . . . S FBT("PTR","POVM")=FBT("PTR","POVM")+1
"RTN","FBXIP154",233,0)
 . . . . . ; if POV does not match then look for an better auth.
"RTN","FBXIP154",234,0)
 . . . . . I FBP("POV")'=FBA("POV") D  Q:FBAUTHP
"RTN","FBXIP154",235,0)
 . . . . . . S FBX=$$POV(DA(3),FBP("DOS"),FBP("POV"))
"RTN","FBXIP154",236,0)
 . . . . . . Q:'FBX
"RTN","FBXIP154",237,0)
 . . . . . . S FBAUTHP=FBX
"RTN","FBXIP154",238,0)
 . . . . . . I FBP("FTP") S FBT("PTR","POVC")=FBT("PTR","POVC")+1
"RTN","FBXIP154",239,0)
 . . . . . . I 'FBP("FTP") S FBT("NOP","POVC")=FBT("NOP","POVC")+1
"RTN","FBXIP154",240,0)
 . . . . . . S ^XTMP("FB*3.5*154","POVC",FBIENS)=FBP("FTP")_"^"_FBAUTHP
"RTN","FBXIP154",241,0)
 . . . . . ; if better auth. not found use old value when available
"RTN","FBXIP154",242,0)
 . . . . . I 'FBAUTHP D
"RTN","FBXIP154",243,0)
 . . . . . . I FBP("FTP") S FBAUTHP=FBP("FTP")
"RTN","FBXIP154",244,0)
 . . . . . . I FBP("FTP") S FBT("PTR","POVU")=FBT("PTR","POVU")+1
"RTN","FBXIP154",245,0)
 . . . . . . I 'FBP("FTP") S FBT("NOP","POVU")=FBT("NOP","POVU")+1
"RTN","FBXIP154",246,0)
 . . . . . . S ^XTMP("FB*3.5*154","POVU",FBIENS)=FBP("FTP")_"^"_FBAUTHP
"RTN","FBXIP154",247,0)
 . . . . ;
"RTN","FBXIP154",248,0)
 . . . . ; save authorization pointer value in new field
"RTN","FBXIP154",249,0)
 . . . . I FBAUTHP D
"RTN","FBXIP154",250,0)
 . . . . . N FBFDA
"RTN","FBXIP154",251,0)
 . . . . . S FBFDA(162.03,FBIENS,15.5)=FBAUTHP
"RTN","FBXIP154",252,0)
 . . . . . D FILE^DIE("","FBFDA")
"RTN","FBXIP154",253,0)
 . . . . . I $G(DIERR)'="" D MES^XPDUTL("  Error updating record with IENS "_FBIENS)
"RTN","FBXIP154",254,0)
 ;
"RTN","FBXIP154",255,0)
 ; report results
"RTN","FBXIP154",256,0)
 S FBX=$J($FN(FBT("TLN"),","),10)_" payment line items in FEE BASIS PAYMENT file"
"RTN","FBXIP154",257,0)
 D MES^XPDUTL(FBX)
"RTN","FBXIP154",258,0)
 D MES^XPDUTL("----------")
"RTN","FBXIP154",259,0)
 S FBX=$J($FN(FBT("TLN","SKIP"),","),10)_" lines skipped because new field already populated"
"RTN","FBXIP154",260,0)
 D MES^XPDUTL(FBX)
"RTN","FBXIP154",261,0)
 S FBX=$J($FN(FBT("TLN","PROC"),","),10)_" lines processed"
"RTN","FBXIP154",262,0)
 D MES^XPDUTL(FBX)
"RTN","FBXIP154",263,0)
 ;
"RTN","FBXIP154",264,0)
 S FBX=$J($FN(FBT("NOP"),","),10)_" processed lines without an existing authorization pointer value"
"RTN","FBXIP154",265,0)
 D BMES^XPDUTL(FBX)
"RTN","FBXIP154",266,0)
 D MES^XPDUTL("----------")
"RTN","FBXIP154",267,0)
 S FBX=$J($FN(FBT("NOP","7078C"),","),10)_" lines populated based on 7078/583 match"
"RTN","FBXIP154",268,0)
 D MES^XPDUTL(FBX)
"RTN","FBXIP154",269,0)
 S FBX=$J($FN(FBT("NOP","7078U"),","),10)_" lines not populated because 7078/583 match not found"
"RTN","FBXIP154",270,0)
 D MES^XPDUTL(FBX)
"RTN","FBXIP154",271,0)
 S FBX=$J($FN(FBT("NOP","POVC"),","),10)_" lines populated based on POV match"
"RTN","FBXIP154",272,0)
 D MES^XPDUTL(FBX)
"RTN","FBXIP154",273,0)
 S FBX=$J($FN(FBT("NOP","POVU"),","),10)_" lines not populated because POV match not found"
"RTN","FBXIP154",274,0)
 D MES^XPDUTL(FBX)
"RTN","FBXIP154",275,0)
 ;
"RTN","FBXIP154",276,0)
 S FBX=$J($FN(FBT("PTR"),","),10)_" processed lines with an existing authorization pointer value"
"RTN","FBXIP154",277,0)
 D BMES^XPDUTL(FBX)
"RTN","FBXIP154",278,0)
 D MES^XPDUTL("----------")
"RTN","FBXIP154",279,0)
 S FBX=$J($FN(FBT("PTR","7078M"),","),10)_" lines populated with same value based on 7078/583 match"
"RTN","FBXIP154",280,0)
 D MES^XPDUTL(FBX)
"RTN","FBXIP154",281,0)
 S FBX=$J($FN(FBT("PTR","7078C"),","),10)_" lines populated with different value based on 7078/583 match"
"RTN","FBXIP154",282,0)
 D MES^XPDUTL(FBX)
"RTN","FBXIP154",283,0)
 S FBX=$J($FN(FBT("PTR","7078U"),","),10)_" lines populated with same value since 7078/583 match not found"
"RTN","FBXIP154",284,0)
 D MES^XPDUTL(FBX)
"RTN","FBXIP154",285,0)
 S FBX=$J($FN(FBT("PTR","POVM"),","),10)_" lines populated with same value based on POV match"
"RTN","FBXIP154",286,0)
 D MES^XPDUTL(FBX)
"RTN","FBXIP154",287,0)
 S FBX=$J($FN(FBT("PTR","POVC"),","),10)_" lines populated with different value based on POV match"
"RTN","FBXIP154",288,0)
 D MES^XPDUTL(FBX)
"RTN","FBXIP154",289,0)
 S FBX=$J($FN(FBT("PTR","POVU"),","),10)_" lines populated with same value since POV match not found"
"RTN","FBXIP154",290,0)
 D MES^XPDUTL(FBX)
"RTN","FBXIP154",291,0)
 ;
"RTN","FBXIP154",292,0)
 Q
"RTN","FBXIP154",293,0)
 ;
"RTN","FBXIP154",294,0)
ASSOC(FBDFN,FBDOS,FB7078) ; find authorization for ASSOCIATED 7078/583
"RTN","FBXIP154",295,0)
 ; input
"RTN","FBXIP154",296,0)
 ;   FBDFN - patient (internal, pointer to file 2 and file 161)
"RTN","FBXIP154",297,0)
 ;   FBDOS - date of service (internal, FM date)
"RTN","FBXIP154",298,0)
 ;   FB7078 - associated 7078/583 (internal)
"RTN","FBXIP154",299,0)
 ; returns null value or authorization IEN in file 161 for patient
"RTN","FBXIP154",300,0)
 N FBFTP
"RTN","FBXIP154",301,0)
 S FBFTP=""
"RTN","FBXIP154",302,0)
 I $G(FB7078)]"",$G(FBDFN)]"",$G(FBDOS)]"" D
"RTN","FBXIP154",303,0)
 . N FBDA,FBY
"RTN","FBXIP154",304,0)
 . ; loop thru authorizations for ASSOCIATED 7078/583 and PATIENT
"RTN","FBXIP154",305,0)
 . S FBDA=0
"RTN","FBXIP154",306,0)
 . F  S FBDA=$O(^FBAAA("AG",FB7078,FBDFN,FBDA)) Q:'FBDA  D  Q:FBFTP
"RTN","FBXIP154",307,0)
 . . S FBY=$G(^FBAAA(FBDFN,1,FBDA,0))
"RTN","FBXIP154",308,0)
 . . Q:$P(FBY,U,1)=""  ; invalid data
"RTN","FBXIP154",309,0)
 . . Q:$P(FBY,U,1)>FBDOS  ; auth from date is after date of service
"RTN","FBXIP154",310,0)
 . . Q:$P(FBY,U,2)<FBDOS  ; auth to date is before date of service
"RTN","FBXIP154",311,0)
 . . ; passed all criterion, found matching authorization
"RTN","FBXIP154",312,0)
 . . S FBFTP=FBDA
"RTN","FBXIP154",313,0)
 ;
"RTN","FBXIP154",314,0)
 Q FBFTP
"RTN","FBXIP154",315,0)
 ;
"RTN","FBXIP154",316,0)
POV(FBDFN,FBDOS,FBPOV) ; find authorization for POV
"RTN","FBXIP154",317,0)
 ; input
"RTN","FBXIP154",318,0)
 ;   FBDFN - patient (internal, pointer to file 2 and file 161)
"RTN","FBXIP154",319,0)
 ;   FBDOS - date of service (internal, FM date)
"RTN","FBXIP154",320,0)
 ;   FBPOV - purpose of visit (internal, pointer to 161.82)
"RTN","FBXIP154",321,0)
 ; returns null value or authorization IEN in file 161 for patient
"RTN","FBXIP154",322,0)
 N FBFTP
"RTN","FBXIP154",323,0)
 S FBFTP=""
"RTN","FBXIP154",324,0)
 I $G(FBPOV)]"",$G(FBDFN)]"",$G(FBDOS)]"" D
"RTN","FBXIP154",325,0)
 . N FBDA,FBY
"RTN","FBXIP154",326,0)
 . ; loop thru authorizations for patient
"RTN","FBXIP154",327,0)
 . S FBDA=0
"RTN","FBXIP154",328,0)
 . F  S FBDA=$O(^FBAAA(FBDFN,1,FBDA)) Q:'FBDA  D  Q:FBFTP
"RTN","FBXIP154",329,0)
 . . S FBY=$G(^FBAAA(FBDFN,1,FBDA,0))
"RTN","FBXIP154",330,0)
 . . Q:$P(FBY,U,1)=""  ; invalid data
"RTN","FBXIP154",331,0)
 . . Q:$P(FBY,U,7)'=FBPOV  ; POV does not match input value
"RTN","FBXIP154",332,0)
 . . Q:$P(FBY,U,1)>FBDOS  ; auth from date is after date of service
"RTN","FBXIP154",333,0)
 . . Q:$P(FBY,U,2)<FBDOS  ; auth to date is before date of service
"RTN","FBXIP154",334,0)
 . . ; passed all criterion, found matching authorization
"RTN","FBXIP154",335,0)
 . . S FBFTP=FBDA
"RTN","FBXIP154",336,0)
 ;
"RTN","FBXIP154",337,0)
 Q FBFTP
"RTN","FBXIP154",338,0)
 ;
"RTN","FBXIP154",339,0)
 ;
"RTN","FBXIP154",340,0)
RPT ; report of ^XTMP
"RTN","FBXIP154",341,0)
 W !,"Report of XTMP(""FB*3.5*154"") data"
"RTN","FBXIP154",342,0)
 ;
"RTN","FBXIP154",343,0)
 D LIST("7078C")
"RTN","FBXIP154",344,0)
 D LIST("7078U")
"RTN","FBXIP154",345,0)
 D LIST("POVC")
"RTN","FBXIP154",346,0)
 D LIST("POVU")
"RTN","FBXIP154",347,0)
 Q
"RTN","FBXIP154",348,0)
 ;
"RTN","FBXIP154",349,0)
 ;
"RTN","FBXIP154",350,0)
LIST(FBSUB) ; list lines in subscript
"RTN","FBXIP154",351,0)
 N FBIENS,FBFLD,FBFLDN,FBY
"RTN","FBXIP154",352,0)
 ;
"RTN","FBXIP154",353,0)
 W:FBSUB["C" !,"Lines with pointer changed based on "
"RTN","FBXIP154",354,0)
 W:FBSUB["U" !,"Lines with no matching authorization found using "
"RTN","FBXIP154",355,0)
 W:FBSUB["7078" "associated 7078/583"
"RTN","FBXIP154",356,0)
 W:FBSUB["POV" "POV"
"RTN","FBXIP154",357,0)
 I FBSUB["7078" S FBFLD=27,FBFLDN="  7078/583: "
"RTN","FBXIP154",358,0)
 I FBSUB["POV" S FBFLD=16,FBFLDN="  POV: "
"RTN","FBXIP154",359,0)
 ;
"RTN","FBXIP154",360,0)
 S FBIENS=""
"RTN","FBXIP154",361,0)
 F  S FBIENS=$O(^XTMP("FB*3.5*154",FBSUB,FBIENS)) Q:FBIENS=""  D
"RTN","FBXIP154",362,0)
 . S FBY=$G(^XTMP("FB*3.5*154",FBSUB,FBIENS))
"RTN","FBXIP154",363,0)
 . W !,FBIENS,"  From: ",$P(FBY,U,1),"  To: ",$P(FBY,U,2),FBFLDN,$$GET1^DIQ(162.03,FBIENS,FBFLD,"I")
"RTN","FBXIP154",364,0)
 Q
"RTN","FBXIP154",365,0)
 ;FBXIP154
"UP",161,161.192,-2)
161^1
"UP",161,161.192,-1)
161.01^LOG1
"UP",161,161.192,0)
161.192
"UP",162,162.02,-2)
162^1
"UP",162,162.02,-1)
162.01^1
"UP",162,162.02,0)
162.02
"UP",162,162.03,-3)
162^1
"UP",162,162.03,-2)
162.01^1
"UP",162,162.03,-1)
162.02^1
"UP",162,162.03,0)
162.03
"UP",162,162.04,-1)
162^3
"UP",162,162.04,0)
162.04
"UP",162.2,162.292,-1)
162.2^LOG1
"UP",162.2,162.292,0)
162.292
"UP",162.4,162.492,-1)
162.4^LOG1
"UP",162.4,162.492,0)
162.492
"UP",162.7,162.792,-1)
162.7^LOG1
"UP",162.7,162.792,0)
162.792
"VER")
8.0^22.0
"^DD",161,161.01,292,0)
USER AUDIT^161.192D^^LOG1;0
"^DD",161,161.01,292,21,0)
^.001^5^5^3140507^^^
"^DD",161,161.01,292,21,1,0)
This multiple tracks users that entered or edited the authorization using
"^DD",161,161.01,292,21,2,0)
selected menu options.  Note that some types of authorizations are also
"^DD",161,161.01,292,21,3,0)
associated with a record in other files such as #162.2, #162.4, and
"^DD",161,161.01,292,21,4,0)
#162.7. In such cases the USER AUDIT in those other files must also be
"^DD",161,161.01,292,21,5,0)
reviewed to obtain a complete list of users.
"^DD",161,161.01,292,23,0)
^.001^5^5^3140507^^
"^DD",161,161.01,292,23,1,0)
The USER AUDIT multiple was added by patch FB*3.5*154 and does not reflect
"^DD",161,161.01,292,23,2,0)
actions taken prior to patch installation with one exception. During the 
"^DD",161,161.01,292,23,3,0)
install the patch attempts to create one entry in the multiple for each
"^DD",161,161.01,292,23,4,0)
pre-existing authorization using data from the CLERK (#7) field and the
"^DD",161,161.01,292,23,5,0)
patch install date.
"^DD",161,161.192,0)
USER AUDIT SUB-FIELD^^2^3
"^DD",161,161.192,0,"DT")
3140507
"^DD",161,161.192,0,"IX","B",161.192,.01)

"^DD",161,161.192,0,"NM","USER AUDIT")

"^DD",161,161.192,0,"UP")
161.01
"^DD",161,161.192,.01,0)
DATE/TIME EDITED^DI^^0;1^S %DT="ESTX" D ^%DT S X=Y K:Y<1 X
"^DD",161,161.192,.01,1,0)
^.1
"^DD",161,161.192,.01,1,1,0)
161.192^B
"^DD",161,161.192,.01,1,1,1)
S ^FBAAA(DA(2),1,DA(1),"LOG1","B",$E(X,1,30),DA)=""
"^DD",161,161.192,.01,1,1,2)
K ^FBAAA(DA(2),1,DA(1),"LOG1","B",$E(X,1,30),DA)
"^DD",161,161.192,.01,3)
Enter the date/time the authorization was entered or edited.
"^DD",161,161.192,.01,21,0)
^.001^1^1^3140507^^^
"^DD",161,161.192,.01,21,1,0)
This field is automatically populated by the software.
"^DD",161,161.192,.01,"DT")
3140507
"^DD",161,161.192,1,0)
EDITED BY^P200'I^VA(200,^0;2^Q
"^DD",161,161.192,1,3)
Select the user that entered or edited the authorization.
"^DD",161,161.192,1,21,0)
^.001^1^1^3140507^^
"^DD",161,161.192,1,21,1,0)
This field is automatically populated by the software.
"^DD",161,161.192,1,"DT")
3140203
"^DD",161,161.192,2,0)
COMMENTS^FI^^0;3^K:$L(X)>60!($L(X)<3) X
"^DD",161,161.192,2,3)
Answer must be 3-60 characters in length.
"^DD",161,161.192,2,21,0)
^.001^2^2^3140507^^
"^DD",161,161.192,2,21,1,0)
This field contains optional comments about the nature of the edit. This
"^DD",161,161.192,2,21,2,0)
field is automatically populated by the software.
"^DD",161,161.192,2,"DT")
3140203
"^DD",161.4,161.4,19,0)
*EDIT AUTH. DURING PAYMENT^FXO^^1;4^I $D(X) D YN^FBAAUTL3
"^DD",161.4,161.4,19,2)
S Y(0)=Y D OUTYN^FBAAUTL3
"^DD",161.4,161.4,19,2.1)
D OUTYN^FBAAUTL3
"^DD",161.4,161.4,19,3)
OBSOLETE. Answer 'Yes' or '1' for YES and 'No' or '0' for NO.
"^DD",161.4,161.4,19,21,0)
^^9^9^3140226^
"^DD",161.4,161.4,19,21,1,0)
This field is obsolete with patch FB*3.5*154 and no longer has any impact 
"^DD",161.4,161.4,19,21,2,0)
on the behavior of the payment options. This field may be deleted by a 
"^DD",161.4,161.4,19,21,3,0)
future patch.  The prior field description follows:
"^DD",161.4,161.4,19,21,4,0)
 
"^DD",161.4,161.4,19,21,5,0)
This field is used to indicate that editing of the Authorization Remarks
"^DD",161.4,161.4,19,21,6,0)
field and the 3 DX fields is allowable during the Enter Payment options.
"^DD",161.4,161.4,19,21,7,0)
Normally used for six months immediately after installing Fee system.
"^DD",161.4,161.4,19,21,8,0)
This is because the Remarks and DX data was not available for downloading
"^DD",161.4,161.4,19,21,9,0)
from Central Fee system.
"^DD",161.4,161.4,19,"DT")
3140303
"^DD",162,162.02,3,0)
*AUTHORIZATION POINTER^NJ7,0^^0;4^K:+X'=X!(X>9999999)!(X<1)!(X?.E1"."1.N) X
"^DD",162,162.02,3,1,0)
^.1
"^DD",162,162.02,3,1,1,0)
162^AF
"^DD",162,162.02,3,1,1,1)
S ^FBAAC("AF",$E(X,1,30),DA(2),DA(1),DA)=""
"^DD",162,162.02,3,1,1,2)
K ^FBAAC("AF",$E(X,1,30),DA(2),DA(1),DA)
"^DD",162,162.02,3,1,1,"%D",0)
^^1^1^3021224^
"^DD",162,162.02,3,1,1,"%D",1,0)
the cross-reference is used for active/ending authorization reports
"^DD",162,162.02,3,1,1,"DT")
3021224
"^DD",162,162.02,3,3)
OBSOLETE. Type a number between 1 and 9999999, 0 decimal digits.
"^DD",162,162.02,3,21,0)
^^8^8^3140226^
"^DD",162,162.02,3,21,1,0)
This field is obsolete with patch FB*3.5*154. Data will no longer be saved
"^DD",162,162.02,3,21,2,0)
to this field and the field may be deleted by a future patch. The
"^DD",162,162.02,3,21,3,0)
AUTHORIZATION POINTER in the SERVICE PROVIDED multiple should be 
"^DD",162,162.02,3,21,4,0)
referenced instead of this field.
"^DD",162,162.02,3,21,5,0)
 
"^DD",162,162.02,3,21,6,0)
This field is set to the internal entry number of the appropriate
"^DD",162,162.02,3,21,7,0)
authorization in file 161. It is used to retrieve the appropriate purpose
"^DD",162,162.02,3,21,8,0)
of visit code when payments are sent to Austin.
"^DD",162,162.02,3,"DT")
3140304
"^DD",162,162.03,2,0)
AMOUNT PAID^RNJ9,2X^^0;3^S X=$TR(X,"$") K:+X'=X&(X'?.N.1".".2N)!(X>999999)!(X<0) X
"^DD",162,162.03,2,1,0)
^.1^^0
"^DD",162,162.03,2,3)
Enter the amount to pay in dollars and cents between 0 and 999999.
"^DD",162,162.03,2,21,0)
^.001^1^1^3140921^^^^
"^DD",162,162.03,2,21,1,0)
The amount that the VA is going to pay for this service provided.
"^DD",162,162.03,2,"DT")
3140921
"^DD",162,162.03,15.5,0)
AUTHORIZATION POINTER^NJ7,0^^3;9^K:+X'=X!(X>9999999)!(X<1)!(X?.E1"."1.N) X
"^DD",162,162.03,15.5,1,0)
^.1
"^DD",162,162.03,15.5,1,1,0)
162^AFN
"^DD",162,162.03,15.5,1,1,1)
S ^FBAAC("AFN",$E(X,1,30),DA(3),DA(2),DA(1),DA)=""
"^DD",162,162.03,15.5,1,1,2)
K ^FBAAC("AFN",$E(X,1,30),DA(3),DA(2),DA(1),DA)
"^DD",162,162.03,15.5,1,1,"%D",0)
^^2^2^3140211^
"^DD",162,162.03,15.5,1,1,"%D",1,0)
This cross-reference is used to locate payments that are associated with
"^DD",162,162.03,15.5,1,1,"%D",2,0)
an authorization in the FEE BASIS PATIENT file.
"^DD",162,162.03,15.5,1,1,"DT")
3140211
"^DD",162,162.03,15.5,3)
Enter the internal entry number of the authorization in the FEE BASIS PATIENT file.
"^DD",162,162.03,15.5,21,0)
^^3^3^3140304^
"^DD",162,162.03,15.5,21,1,0)
Type a number between 1 and 9999999, 0 decimal digits. This field is
"^DD",162,162.03,15.5,21,2,0)
automatically populated with the internal entry number of the patient's
"^DD",162,162.03,15.5,21,3,0)
authorization in the Fee Basis Patient file.
"^DD",162,162.03,15.5,23,0)
^^2^2^3140226^
"^DD",162,162.03,15.5,23,1,0)
This field was added by patch FB*3.5*154 to replace the AUTHORIZATION
"^DD",162,162.03,15.5,23,2,0)
POINTER field in the INITIAL TREATMENT DATE multiple.
"^DD",162,162.03,15.5,"DT")
3140304
"^DD",162,162.04,15,0)
AUTHORIZATION POINTER^NJ7,0^^1;1^K:+X'=X!(X>9999999)!(X<1)!(X?.E1"."1.N) X
"^DD",162,162.04,15,3)
Enter the internal entry number of the authorization in the FEE BASIS PATIENT file.
"^DD",162,162.04,15,21,0)
^^3^3^3140304^
"^DD",162,162.04,15,21,1,0)
Type a number between 1 and 9999999, 0 decimal digits. This field is 
"^DD",162,162.04,15,21,2,0)
automatically populated with the internal entry number of the patient's
"^DD",162,162.04,15,21,3,0)
authorization in the Fee Basis Patient file.
"^DD",162,162.04,15,23,0)
^^2^2^3140226^
"^DD",162,162.04,15,23,1,0)
This field was added by patch FB*3.5*154.  It will not be populated for 
"^DD",162,162.04,15,23,2,0)
travel payments created prior to the installation of the patch.
"^DD",162,162.04,15,"DT")
3140304
"^DD",162.2,162.2,292,0)
USER AUDIT^162.292D^^LOG1;0
"^DD",162.2,162.2,292,21,0)
^^1^1^3140203^
"^DD",162.2,162.2,292,21,1,0)
The user audit tracks users that enter or edit the notification.
"^DD",162.2,162.2,292,23,0)
^^7^7^3140226^
"^DD",162.2,162.2,292,23,1,0)
The USER AUDIT multiple was added by patch FB*3.5*154 and does not reflect
"^DD",162.2,162.2,292,23,2,0)
actions taken prior to patch installation with the following exceptions.
"^DD",162.2,162.2,292,23,3,0)
During the install the patch attempts to create up to three entries in the
"^DD",162.2,162.2,292,23,4,0)
multiple for each pre-existing notification using data from the DATE OF
"^DD",162.2,162.2,292,23,5,0)
LEGAL DETERMINATION (#9), USER ENTERING LEGAL DETERM. (#10), DATE OF
"^DD",162.2,162.2,292,23,6,0)
MEDICAL DETERMINATION (#12), USER ENTERING MEDICAL DETERM. (#13) and USER
"^DD",162.2,162.2,292,23,7,0)
ENTERING NOTIFICATION (#7) fields.
"^DD",162.2,162.292,0)
USER AUDIT SUB-FIELD^^2^3
"^DD",162.2,162.292,0,"DT")
3140203
"^DD",162.2,162.292,0,"IX","B",162.292,.01)

"^DD",162.2,162.292,0,"NM","USER AUDIT")

"^DD",162.2,162.292,0,"UP")
162.2
"^DD",162.2,162.292,.01,0)
DATE/TIME EDITED^DI^^0;1^S %DT="ESTX" D ^%DT S X=Y K:X<1 X
"^DD",162.2,162.292,.01,1,0)
^.1
"^DD",162.2,162.292,.01,1,1,0)
162.292^B
"^DD",162.2,162.292,.01,1,1,1)
S ^FBAA(162.2,DA(1),"LOG1","B",$E(X,1,30),DA)=""
"^DD",162.2,162.292,.01,1,1,2)
K ^FBAA(162.2,DA(1),"LOG1","B",$E(X,1,30),DA)
"^DD",162.2,162.292,.01,3)
Enter the date/time the notification was entered or edited.
"^DD",162.2,162.292,.01,21,0)
^^1^1^3140203^
"^DD",162.2,162.292,.01,21,1,0)
This field is automatically populated by the software.
"^DD",162.2,162.292,.01,"DT")
3140203
"^DD",162.2,162.292,1,0)
EDITED BY^P200'I^VA(200,^0;2^Q
"^DD",162.2,162.292,1,3)
Select the user that entered or edited the notification.
"^DD",162.2,162.292,1,21,0)
^^1^1^3140203^
"^DD",162.2,162.292,1,21,1,0)
This field is automatically populated by the software.
"^DD",162.2,162.292,1,"DT")
3140203
"^DD",162.2,162.292,2,0)
COMMENTS^FI^^0;3^K:$L(X)>60!($L(X)<3) X
"^DD",162.2,162.292,2,3)
Answer must be 3-60 characters in length.
"^DD",162.2,162.292,2,21,0)
^^2^2^3140203^
"^DD",162.2,162.292,2,21,1,0)
This field contains optional comments about the nature of the edit. This
"^DD",162.2,162.292,2,21,2,0)
field is automatically populated by the software.
"^DD",162.2,162.292,2,"DT")
3140203
"^DD",162.4,162.4,292,0)
USER AUDIT^162.492D^^LOG1;0
"^DD",162.4,162.4,292,21,0)
^^3^3^3140203^^
"^DD",162.4,162.4,292,21,1,0)
The user audit tracks users that enter or edit the authorization.  This
"^DD",162.4,162.4,292,21,2,0)
includes edits to the authorization rate or patient movements for nursing
"^DD",162.4,162.4,292,21,3,0)
home authorizations.
"^DD",162.4,162.4,292,23,0)
^^5^5^3140226^
"^DD",162.4,162.4,292,23,1,0)
The USER AUDIT multiple was added by patch FB*3.5*154 and does not reflect
"^DD",162.4,162.4,292,23,2,0)
actions taken prior to patch installation with one exception. During the
"^DD",162.4,162.4,292,23,3,0)
install the patch attempts to create an entry in the multiple for each
"^DD",162.4,162.4,292,23,4,0)
pre-existing authorization using data from the DATE OF ISSUE (#10) and
"^DD",162.4,162.4,292,23,5,0)
USER ENTERING (#8) fields.
"^DD",162.4,162.492,0)
USER AUDIT SUB-FIELD^^2^3
"^DD",162.4,162.492,0,"DT")
3140203
"^DD",162.4,162.492,0,"IX","B",162.492,.01)

"^DD",162.4,162.492,0,"NM","USER AUDIT")

"^DD",162.4,162.492,0,"UP")
162.4
"^DD",162.4,162.492,.01,0)
DATE/TIME EDITED^DI^^0;1^S %DT="ESTX" D ^%DT S X=Y K:X<1 X
"^DD",162.4,162.492,.01,1,0)
^.1
"^DD",162.4,162.492,.01,1,1,0)
162.492^B
"^DD",162.4,162.492,.01,1,1,1)
S ^FB7078(DA(1),"LOG1","B",$E(X,1,30),DA)=""
"^DD",162.4,162.492,.01,1,1,2)
K ^FB7078(DA(1),"LOG1","B",$E(X,1,30),DA)
"^DD",162.4,162.492,.01,3)
Enter the date/time the authorization was entered or edited.
"^DD",162.4,162.492,.01,21,0)
^^1^1^3140203^
"^DD",162.4,162.492,.01,21,1,0)
This field is automatically populated by the software.
"^DD",162.4,162.492,.01,"DT")
3140203
"^DD",162.4,162.492,1,0)
EDITED BY^P200'I^VA(200,^0;2^Q
"^DD",162.4,162.492,1,3)
Select the user that entered or edited the authorization.
"^DD",162.4,162.492,1,21,0)
^^1^1^3140203^
"^DD",162.4,162.492,1,21,1,0)
This field is automatically populated by the software.
"^DD",162.4,162.492,1,"DT")
3140203
"^DD",162.4,162.492,2,0)
COMMENTS^FI^^0;3^K:$L(X)>60!($L(X)<3) X
"^DD",162.4,162.492,2,3)
Answer must be 3-60 characters in length.
"^DD",162.4,162.492,2,21,0)
^^2^2^3140203^
"^DD",162.4,162.492,2,21,1,0)
This field contains optional comments about the nature of the edit. This
"^DD",162.4,162.492,2,21,2,0)
field is automatically populated by the software.
"^DD",162.4,162.492,2,"DT")
3140203
"^DD",162.7,162.7,292,0)
USER AUDIT^162.792D^^LOG1;0
"^DD",162.7,162.7,292,21,0)
^^1^1^3140203^
"^DD",162.7,162.7,292,21,1,0)
The user audit tracks users that enter or edit the unauthorized claim.
"^DD",162.7,162.7,292,23,0)
^^5^5^3140226^
"^DD",162.7,162.7,292,23,1,0)
The USER AUDIT multiple was added by patch FB*3.5*154 and does not reflect
"^DD",162.7,162.7,292,23,2,0)
actions taken prior to patch installation with one exception. During the
"^DD",162.7,162.7,292,23,3,0)
install the patch attempts to create one entry in the multiple for each
"^DD",162.7,162.7,292,23,4,0)
pre-existing claim using data from the DATE ENTERED/LAST EDITED (#28) and
"^DD",162.7,162.7,292,23,5,0)
ENTERED/LAST EDITED BY (#27) fields.
"^DD",162.7,162.792,0)
USER AUDIT SUB-FIELD^^2^3
"^DD",162.7,162.792,0,"DT")
3140203
"^DD",162.7,162.792,0,"IX","B",162.792,.01)

"^DD",162.7,162.792,0,"NM","USER AUDIT")

"^DD",162.7,162.792,0,"UP")
162.7
"^DD",162.7,162.792,.01,0)
DATE/TIME EDITED^DI^^0;1^S %DT="ESTX" D ^%DT S X=Y K:X<1 X
"^DD",162.7,162.792,.01,1,0)
^.1
"^DD",162.7,162.792,.01,1,1,0)
162.792^B
"^DD",162.7,162.792,.01,1,1,1)
S ^FB583(DA(1),"LOG1","B",$E(X,1,30),DA)=""
"^DD",162.7,162.792,.01,1,1,2)
K ^FB583(DA(1),"LOG1","B",$E(X,1,30),DA)
"^DD",162.7,162.792,.01,3)
Enter the date/time the claim was entered or edited.
"^DD",162.7,162.792,.01,21,0)
^^1^1^3140203^
"^DD",162.7,162.792,.01,21,1,0)
This field is automatically populated by the software.
"^DD",162.7,162.792,.01,"DT")
3140203
"^DD",162.7,162.792,1,0)
EDITED BY^P200'I^VA(200,^0;2^Q
"^DD",162.7,162.792,1,3)
Select the user that entered or edited the claim.
"^DD",162.7,162.792,1,21,0)
^^1^1^3140203^
"^DD",162.7,162.792,1,21,1,0)
This field is automatically populated by the software.
"^DD",162.7,162.792,1,"DT")
3140203
"^DD",162.7,162.792,2,0)
COMMENTS^FI^^0;3^K:$L(X)>60!($L(X)<3) X
"^DD",162.7,162.792,2,3)
Answer must be 3-60 characters in length.
"^DD",162.7,162.792,2,21,0)
^^2^2^3140203^
"^DD",162.7,162.792,2,21,1,0)
This field contains optional comments about the nature of the edit. This
"^DD",162.7,162.792,2,21,2,0)
field is automatically populated by the software.
"^DD",162.7,162.792,2,"DT")
3140225
"BLD",9633,6)
^142
**END**
**END**

