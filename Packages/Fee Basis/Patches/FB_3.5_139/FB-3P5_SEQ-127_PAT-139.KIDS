Released FB*3.5*139 SEQ #127
Extracted from mail message
**KIDS**:FB*3.5*139^

**INSTALL NAME**
FB*3.5*139
"BLD",8849,0)
FB*3.5*139^FEE BASIS^0^3140917^y
"BLD",8849,1,0)
^^24^24^3130321^
"BLD",8849,1,1,0)
Description:
"BLD",8849,1,2,0)
===========
"BLD",8849,1,3,0)
 
"BLD",8849,1,4,0)
The International Classification of Diseases, Tenth Revision (ICD-10) 
"BLD",8849,1,5,0)
Class 1 Software Remediation project replaces the 30-year-old set of 
"BLD",8849,1,6,0)
diagnosis and procedure codes (ICD-9-CM) that medical personnel use. 
"BLD",8849,1,7,0)
Dates of service, or dates of discharge for inpatients, that occur on or 
"BLD",8849,1,8,0)
after the implementation date will use the ICD-10 code set. Clinical 
"BLD",8849,1,9,0)
Modification (ICD-10-CM) diagnosis codes increase from about 13,000 ICD-9 
"BLD",8849,1,10,0)
codes to more than 68,000. Procedure Coding System (ICD-10-PCS) procedure 
"BLD",8849,1,11,0)
codes increase from about 3,800 ICD-9 codes to nearly 87,000. Both 
"BLD",8849,1,12,0)
systems also expand the number of characters allotted to seven 
"BLD",8849,1,13,0)
alpha-numeric characters. This value does not include the decimal point, 
"BLD",8849,1,14,0)
which follows the third character for the ICD-10-CM code set. There is no 
"BLD",8849,1,15,0)
decimal point in the ICD-10-PCS code set.
"BLD",8849,1,16,0)
 
"BLD",8849,1,17,0)
These code sets have the potential to reveal more about quality of care, 
"BLD",8849,1,18,0)
so that data can be used in a more meaningful way to better understand 
"BLD",8849,1,19,0)
complications, better design clinically robust algorithms, and better 
"BLD",8849,1,20,0)
track the outcomes of care. ICD-10-CM also incorporates greater 
"BLD",8849,1,21,0)
specificity and clinical detail to provide information for clinical 
"BLD",8849,1,22,0)
decision making and outcomes research.
"BLD",8849,1,23,0)
 
"BLD",8849,1,24,0)
This patch is to implement ICD-10 Remediation for Fee Basis.
"BLD",8849,4,0)
^9.64PA^162.7^2
"BLD",8849,4,161,0)
161
"BLD",8849,4,161,2,0)
^9.641^161.01^1
"BLD",8849,4,161,2,161.01,0)
AUTHORIZATION  (sub-file)
"BLD",8849,4,161,2,161.01,1,0)
^9.6411^.087^4
"BLD",8849,4,161,2,161.01,1,.08,0)
DX LINE 1
"BLD",8849,4,161,2,161.01,1,.085,0)
DX LINE 2
"BLD",8849,4,161,2,161.01,1,.086,0)
DX LINE 3
"BLD",8849,4,161,2,161.01,1,.087,0)
ICD DIAGNOSIS
"BLD",8849,4,161,222)
y^y^p^^^^n^^n
"BLD",8849,4,161,224)

"BLD",8849,4,162.7,0)
162.7
"BLD",8849,4,162.7,2,0)
^9.641^162.7^1
"BLD",8849,4,162.7,2,162.7,0)
FEE BASIS UNAUTHORIZED CLAIMS  (File-top level)
"BLD",8849,4,162.7,2,162.7,1,0)
^9.6411^5.1^1
"BLD",8849,4,162.7,2,162.7,1,5.1,0)
ICD DIAGNOSIS
"BLD",8849,4,162.7,222)
y^y^p^^^^n^^n
"BLD",8849,4,162.7,224)

"BLD",8849,4,"APDD",161,161.01)

"BLD",8849,4,"APDD",161,161.01,.08)

"BLD",8849,4,"APDD",161,161.01,.085)

"BLD",8849,4,"APDD",161,161.01,.086)

"BLD",8849,4,"APDD",161,161.01,.087)

"BLD",8849,4,"APDD",162.7,162.7)

"BLD",8849,4,"APDD",162.7,162.7,5.1)

"BLD",8849,4,"B",161,161)

"BLD",8849,4,"B",162.7,162.7)

"BLD",8849,6)
22^
"BLD",8849,6.3)
127
"BLD",8849,"ABPKG")
n
"BLD",8849,"KRN",0)
^9.67PA^779.2^20
"BLD",8849,"KRN",.4,0)
.4
"BLD",8849,"KRN",.401,0)
.401
"BLD",8849,"KRN",.402,0)
.402
"BLD",8849,"KRN",.402,"NM",0)
^9.68A^8^8
"BLD",8849,"KRN",.402,"NM",1,0)
FBAA AUTHORIZATION    FILE #161^161^0
"BLD",8849,"KRN",.402,"NM",2,0)
FBCH ENTER PAYMENT    FILE #162.5^162.5^0
"BLD",8849,"KRN",.402,"NM",3,0)
FBCH EDIT PAYMENT    FILE #162.5^162.5^0
"BLD",8849,"KRN",.402,"NM",4,0)
FB UNAUTHORIZED ENTER    FILE #162.7^162.7^0
"BLD",8849,"KRN",.402,"NM",5,0)
FB UNAUTHORIZED EDIT    FILE #162.7^162.7^0
"BLD",8849,"KRN",.402,"NM",6,0)
FB UNAUTHORIZED UPDATE    FILE #161^161^0
"BLD",8849,"KRN",.402,"NM",7,0)
FB UNAUTHORIZED UPDATE1    FILE #161^161^0
"BLD",8849,"KRN",.402,"NM",8,0)
FB UNAUTHORIZED PREVIOUS    FILE #162.7^162.7^0
"BLD",8849,"KRN",.402,"NM","B","FB UNAUTHORIZED EDIT    FILE #162.7",5)

"BLD",8849,"KRN",.402,"NM","B","FB UNAUTHORIZED ENTER    FILE #162.7",4)

"BLD",8849,"KRN",.402,"NM","B","FB UNAUTHORIZED PREVIOUS    FILE #162.7",8)

"BLD",8849,"KRN",.402,"NM","B","FB UNAUTHORIZED UPDATE    FILE #161",6)

"BLD",8849,"KRN",.402,"NM","B","FB UNAUTHORIZED UPDATE1    FILE #161",7)

"BLD",8849,"KRN",.402,"NM","B","FBAA AUTHORIZATION    FILE #161",1)

"BLD",8849,"KRN",.402,"NM","B","FBCH EDIT PAYMENT    FILE #162.5",3)

"BLD",8849,"KRN",.402,"NM","B","FBCH ENTER PAYMENT    FILE #162.5",2)

"BLD",8849,"KRN",.403,0)
.403
"BLD",8849,"KRN",.5,0)
.5
"BLD",8849,"KRN",.84,0)
.84
"BLD",8849,"KRN",3.6,0)
3.6
"BLD",8849,"KRN",3.8,0)
3.8
"BLD",8849,"KRN",9.2,0)
9.2
"BLD",8849,"KRN",9.8,0)
9.8
"BLD",8849,"KRN",9.8,"NM",0)
^9.68A^28^24
"BLD",8849,"KRN",9.8,"NM",3,0)
FBCSV1^^0^B26775186
"BLD",8849,"KRN",9.8,"NM",4,0)
FBASF^^0^B105506974
"BLD",8849,"KRN",9.8,"NM",5,0)
FBASFL^^0^B38523474
"BLD",8849,"KRN",9.8,"NM",8,0)
FBAACO2^^0^B29842500
"BLD",8849,"KRN",9.8,"NM",9,0)
FBAACO3^^0^B60345007
"BLD",8849,"KRN",9.8,"NM",10,0)
FBAACP^^0^B55546360
"BLD",8849,"KRN",9.8,"NM",11,0)
FBAAMP1^^0^B12344888
"BLD",8849,"KRN",9.8,"NM",12,0)
FBAAPET^^0^B47597707
"BLD",8849,"KRN",9.8,"NM",13,0)
FBASFU^^0^B14602797
"BLD",8849,"KRN",9.8,"NM",14,0)
FBNHEAUT^^0^B27561875
"BLD",8849,"KRN",9.8,"NM",15,0)
FBAAV0^^0^B46795465
"BLD",8849,"KRN",9.8,"NM",16,0)
FBAAV5^^0^B80128865
"BLD",8849,"KRN",9.8,"NM",17,0)
FBCH78^^0^B51567098
"BLD",8849,"KRN",9.8,"NM",18,0)
FBAAEAR^^0^B1712071
"BLD",8849,"KRN",9.8,"NM",19,0)
FBAADEM1^^0^B16400891
"BLD",8849,"KRN",9.8,"NM",20,0)
FBNHEDAT^^0^B15561616
"BLD",8849,"KRN",9.8,"NM",21,0)
FBAA79^^0^B25821677
"BLD",8849,"KRN",9.8,"NM",22,0)
FBCHRJP^^0^B10678988
"BLD",8849,"KRN",9.8,"NM",23,0)
FBPRICE1^^0^B22045052
"BLD",8849,"KRN",9.8,"NM",24,0)
FBICD9^^0^B8835442
"BLD",8849,"KRN",9.8,"NM",25,0)
FBPAY67^^0^B45350790
"BLD",8849,"KRN",9.8,"NM",26,0)
FBICDP^^0^B9560886
"BLD",8849,"KRN",9.8,"NM",27,0)
FBCHEP^^0^B36009923
"BLD",8849,"KRN",9.8,"NM",28,0)
FBCHEP1^^0^B42453076
"BLD",8849,"KRN",9.8,"NM","B","FBAA79",21)

"BLD",8849,"KRN",9.8,"NM","B","FBAACO2",8)

"BLD",8849,"KRN",9.8,"NM","B","FBAACO3",9)

"BLD",8849,"KRN",9.8,"NM","B","FBAACP",10)

"BLD",8849,"KRN",9.8,"NM","B","FBAADEM1",19)

"BLD",8849,"KRN",9.8,"NM","B","FBAAEAR",18)

"BLD",8849,"KRN",9.8,"NM","B","FBAAMP1",11)

"BLD",8849,"KRN",9.8,"NM","B","FBAAPET",12)

"BLD",8849,"KRN",9.8,"NM","B","FBAAV0",15)

"BLD",8849,"KRN",9.8,"NM","B","FBAAV5",16)

"BLD",8849,"KRN",9.8,"NM","B","FBASF",4)

"BLD",8849,"KRN",9.8,"NM","B","FBASFL",5)

"BLD",8849,"KRN",9.8,"NM","B","FBASFU",13)

"BLD",8849,"KRN",9.8,"NM","B","FBCH78",17)

"BLD",8849,"KRN",9.8,"NM","B","FBCHEP",27)

"BLD",8849,"KRN",9.8,"NM","B","FBCHEP1",28)

"BLD",8849,"KRN",9.8,"NM","B","FBCHRJP",22)

"BLD",8849,"KRN",9.8,"NM","B","FBCSV1",3)

"BLD",8849,"KRN",9.8,"NM","B","FBICD9",24)

"BLD",8849,"KRN",9.8,"NM","B","FBICDP",26)

"BLD",8849,"KRN",9.8,"NM","B","FBNHEAUT",14)

"BLD",8849,"KRN",9.8,"NM","B","FBNHEDAT",20)

"BLD",8849,"KRN",9.8,"NM","B","FBPAY67",25)

"BLD",8849,"KRN",9.8,"NM","B","FBPRICE1",23)

"BLD",8849,"KRN",19,0)
19
"BLD",8849,"KRN",19,"NM",0)
^9.68A^^
"BLD",8849,"KRN",19.1,0)
19.1
"BLD",8849,"KRN",19.1,"NM",0)
^9.68A^^
"BLD",8849,"KRN",101,0)
101
"BLD",8849,"KRN",409.61,0)
409.61
"BLD",8849,"KRN",771,0)
771
"BLD",8849,"KRN",779.2,0)
779.2
"BLD",8849,"KRN",870,0)
870
"BLD",8849,"KRN",8989.51,0)
8989.51
"BLD",8849,"KRN",8989.52,0)
8989.52
"BLD",8849,"KRN",8994,0)
8994
"BLD",8849,"KRN","B",.4,.4)

"BLD",8849,"KRN","B",.401,.401)

"BLD",8849,"KRN","B",.402,.402)

"BLD",8849,"KRN","B",.403,.403)

"BLD",8849,"KRN","B",.5,.5)

"BLD",8849,"KRN","B",.84,.84)

"BLD",8849,"KRN","B",3.6,3.6)

"BLD",8849,"KRN","B",3.8,3.8)

"BLD",8849,"KRN","B",9.2,9.2)

"BLD",8849,"KRN","B",9.8,9.8)

"BLD",8849,"KRN","B",19,19)

"BLD",8849,"KRN","B",19.1,19.1)

"BLD",8849,"KRN","B",101,101)

"BLD",8849,"KRN","B",409.61,409.61)

"BLD",8849,"KRN","B",771,771)

"BLD",8849,"KRN","B",779.2,779.2)

"BLD",8849,"KRN","B",870,870)

"BLD",8849,"KRN","B",8989.51,8989.51)

"BLD",8849,"KRN","B",8989.52,8989.52)

"BLD",8849,"KRN","B",8994,8994)

"BLD",8849,"QDEF")
^^^^NO^^^^NO^^NO
"BLD",8849,"QUES",0)
^9.62^^
"BLD",8849,"REQB",0)
^9.611^10^7
"BLD",8849,"REQB",2,0)
ICD*18.0*57^1
"BLD",8849,"REQB",3,0)
LEX*2.0*80^1
"BLD",8849,"REQB",6,0)
FB*3.5*143^1
"BLD",8849,"REQB",7,0)
FB*3.5*132^1
"BLD",8849,"REQB",8,0)
FB*3.5*146^1
"BLD",8849,"REQB",9,0)
FB*3.5*94^1
"BLD",8849,"REQB",10,0)
FB*3.5*135^1
"BLD",8849,"REQB","B","FB*3.5*132",7)

"BLD",8849,"REQB","B","FB*3.5*135",10)

"BLD",8849,"REQB","B","FB*3.5*143",6)

"BLD",8849,"REQB","B","FB*3.5*146",8)

"BLD",8849,"REQB","B","FB*3.5*94",9)

"BLD",8849,"REQB","B","ICD*18.0*57",2)

"BLD",8849,"REQB","B","LEX*2.0*80",3)

"FIA",161)
FEE BASIS PATIENT
"FIA",161,0)
^FBAAA(
"FIA",161,0,0)
161P
"FIA",161,0,1)
y^y^p^^^^n^^n
"FIA",161,0,10)

"FIA",161,0,11)

"FIA",161,0,"RLRO")

"FIA",161,0,"VR")
3.5^FB
"FIA",161,161)
1
"FIA",161,161.01)
1
"FIA",161,161.01,.08)

"FIA",161,161.01,.085)

"FIA",161,161.01,.086)

"FIA",161,161.01,.087)

"FIA",162.7)
FEE BASIS UNAUTHORIZED CLAIMS
"FIA",162.7,0)
^FB583(
"FIA",162.7,0,0)
162.7ID
"FIA",162.7,0,1)
y^y^p^^^^n^^n
"FIA",162.7,0,10)

"FIA",162.7,0,11)

"FIA",162.7,0,"RLRO")

"FIA",162.7,0,"VR")
3.5^FB
"FIA",162.7,162.7)
1
"FIA",162.7,162.7,5.1)

"KRN",.402,1015,-1)
0^1
"KRN",.402,1015,0)
FBAA AUTHORIZATION^3130930.1509^^161^^^3130618
"KRN",.402,1015,"%D",0)
^.4021^1^1^3130529^^^^
"KRN",.402,1015,"%D",1,0)
This template is used for creating new authorizations for Fee Basis.
"KRN",.402,1015,"DIAB",6,1,161.01,3)
101;T
"KRN",.402,1015,"DR",1,161)
S FBPRG="";1;I '$D(FBAATT) S Y="";I FBAATT'=3 S Y="";S HID=$S($D(^FBAAA(DA,4)):$P(^(4),"^"),1:"");.5;S NID=X;.6//^S X="TODAY";S Y=$S(HID="":"",HID=NID:"",NID="":.65,1:.7);.65;.7;S NIDR=X;
"KRN",.402,1015,"DR",2,161.01)
S FBAOLD=^FBAAA(DA(1),1,DA,0),FBAALT=$S($P(FBAOLD,"^",13)=2:"Y",$P(FBAOLD,"^",13)=3:"Y",1:""),FBPRG=$P(FBAOLD,"^",3);I FBPRG,FBPRG'=2 W !!,*7,"You are only allowed to edit an outpatient authorization using this option.",!! S Y="";
"KRN",.402,1015,"DR",2,161.01,1)
@1;.01;S FBTODT=X;S DOB=$P(^DPT(DFN,0),"^",3);D NOW^%DTC;S NOW=X;S X=FBTODT;I $$FMDIFF^XLFDT(NOW,DOB,1)<365 S Y="@3";I $P(FBAOLD,U,2)']"" S Y="@2";I FBTODT'>$P(FBAOLD,U,2) S Y="@2";.01////^S X=+FBAOLD;
"KRN",.402,1015,"DR",2,161.01,2)
W !,*7,"From Date cannot be later than the To Date!";S Y="@1";@2;S:'$D(FBAADDYS) FBAADDYS=0 S X1=FBTODT,X2=FBAADDYS D C^%DTC S FBAAX=X;S FBD1=DA;.02//^S X=$E(FBAAX,4,5)_"-"_$E(FBAAX,6,7)_"-"_($E(FBAAX,1,3)+1700);S FBFRDT=DE(19);
"KRN",.402,1015,"DR",2,161.01,3)
I $$FMDIFF^XLFDT(NOW,DOB,1)<365 S Y="@6";@7;I $P(^FBAAA(DA(1),1,DA,0),"^",7)]"" K DIE("NO^");.03////^S X=$S(FBPRG:FBPRG,1:2);S FBTYPE=$S(FBPRG:FBPRG,1:2);101T~;104;I $G(X) W !,"REFERRING PROVIDER NPI: ",$$REFNPI^FBCH78(X);S Y="@4";
"KRN",.402,1015,"DR",2,161.01,4)
@3;I FBTODT'<DOB&(FBTODT'>$$FMADD^XLFDT(DOB,7)) S Y="@2";W !,*7,"This is a Newborn, From Date must be between DOB and DOB+7";S Y="@1";@6;I FBFRDT'<DOB&(FBFRDT'>$$FMADD^XLFDT(DOB,7)) S Y="@7";
"KRN",.402,1015,"DR",2,161.01,5)
W !,*7,"This is a Newborn, TO Date must be between DOB and DOB+7";S Y="@2";@4;.07;S:$$EXTPV^FBAAUTL5(X)'=55 Y="@5";S:$P($$GETSTAT^DGMSTAPI(DA(1)),U,2)="Y" Y="@5";S DIE("NO^")="";
"KRN",.402,1015,"DR",2,161.01,6)
W !,$C(7),"MST POV can't be selected because veteran's MST status is not YES.";S Y="@4";@5;.065;.095;S FBAATT=X;S FBAALT=$S(X=2:"Y",X=3:"Y",1:"");K DIE("NO^");S ICDSYS=10,IMPDATE=$$IMPDATE^FBCSV1("10D");S EDATE=+FBAOLD;
"KRN",.402,1015,"DR",2,161.01,7)
S:EDATE<IMPDATE ICDSYS=9;I ICDSYS=10,FBAATT=3 S Y="@10";S:ICDSYS=9 Y="@9";S FBDFN=DFN;@8;S XX1=-1 S XX1=$$ASKICD10^FBASF("  ICD DIAGNOSIS","");I XX1<0 W !,"     ICD Diagnosis is required" S Y="@8";.087////^S X=XX1;S Y="@10";@9;.08;
"KRN",.402,1015,"DR",2,161.01,8)
S:X="" Y=.021;.085;S:X="" Y=.021;.086;@10;.021;2;S:'$D(FBAAASKV) FBAAASKV="N";S:FBAAASKV'="y" Y=100;.04;100////^S X=DUZ;W !!;.096;.097//^S X="NO";1//^S X="YES";S FBAAP79=$S(X["Y":"Y",1:"");I X["Y" S Y="";1///^S X="@";
"KRN",.402,1015,"ROU")
^FBCTAU
"KRN",.402,1015,"ROUOLD")
FBCTAU
"KRN",.402,1025,-1)
0^2
"KRN",.402,1025,0)
FBCH ENTER PAYMENT^3140317.1256^^162.5^^^3120530
"KRN",.402,1025,"DIAB",1,0,162.5,9)
35.82;REQ
"KRN",.402,1025,"DIAB",1,0,162.5,12)
36.62;REQ
"KRN",.402,1025,"DIAB",2,0,162.5,5)
32.02;REQ
"KRN",.402,1025,"DIAB",2,0,162.5,6)
35.02;REQ
"KRN",.402,1025,"DIAB",2,0,162.5,7)
35.32;REQ
"KRN",.402,1025,"DIAB",2,0,162.5,10)
36.12;REQ
"KRN",.402,1025,"DIAB",2,0,162.5,13)
36.92;REQ
"KRN",.402,1025,"DIAB",3,0,162.5,8)
35.62;REQ
"KRN",.402,1025,"DIAB",3,0,162.5,11)
36.42;REQ
"KRN",.402,1025,"DIAB",3,0,162.5,14)
31.02;REQ
"KRN",.402,1025,"DIAB",3,0,162.5,17)
35.12;REQ
"KRN",.402,1025,"DIAB",3,0,162.5,19)
35.42;REQ
"KRN",.402,1025,"DIAB",3,0,162.5,21)
35.72;REQ
"KRN",.402,1025,"DIAB",3,0,162.5,23)
36.02;REQ
"KRN",.402,1025,"DIAB",3,0,162.5,25)
36.32;REQ
"KRN",.402,1025,"DIAB",3,0,162.5,27)
36.62;REQ
"KRN",.402,1025,"DIAB",3,0,162.5,29)
36.92;REQ
"KRN",.402,1025,"DIAB",4,0,162.5,15)
33.02;REQ
"KRN",.402,1025,"DIAB",5,0,162.5,9)
35.92;REQ
"KRN",.402,1025,"DIAB",5,0,162.5,12)
36.72;REQ
"KRN",.402,1025,"DIAB",5,0,162.5,18)
35.32;REQ
"KRN",.402,1025,"DIAB",5,0,162.5,20)
35.62;REQ
"KRN",.402,1025,"DIAB",5,0,162.5,22)
35.92;REQ
"KRN",.402,1025,"DIAB",5,0,162.5,24)
36.22;REQ
"KRN",.402,1025,"DIAB",5,0,162.5,26)
36.52;REQ
"KRN",.402,1025,"DIAB",5,0,162.5,28)
36.82;REQ
"KRN",.402,1025,"DIAB",6,0,162.5,4)
30.02;REQ
"KRN",.402,1025,"DIAB",6,0,162.5,5)
33.02;REQ
"KRN",.402,1025,"DIAB",6,0,162.5,6)
35.12;REQ
"KRN",.402,1025,"DIAB",6,0,162.5,7)
35.42;REQ
"KRN",.402,1025,"DIAB",6,0,162.5,10)
36.22;REQ
"KRN",.402,1025,"DIAB",6,0,162.5,16)
35.02;REQ
"KRN",.402,1025,"DIAB",7,0,162.5,8)
35.72;REQ
"KRN",.402,1025,"DIAB",7,0,162.5,11)
36.52;REQ
"KRN",.402,1025,"DIAB",8,0,162.5,13)
30.02;REQ
"KRN",.402,1025,"DIAB",9,0,162.5,9)
36.02;REQ
"KRN",.402,1025,"DIAB",9,0,162.5,12)
36.82;REQ
"KRN",.402,1025,"DIAB",10,0,162.5,4)
31.02;REQ
"KRN",.402,1025,"DIAB",10,0,162.5,5)
34.02;REQ
"KRN",.402,1025,"DIAB",10,0,162.5,6)
35.22;REQ
"KRN",.402,1025,"DIAB",10,0,162.5,7)
35.52;REQ
"KRN",.402,1025,"DIAB",10,0,162.5,10)
36.32;REQ
"KRN",.402,1025,"DIAB",10,0,162.5,14)
32.02;REQ
"KRN",.402,1025,"DIAB",10,0,162.5,17)
35.22;REQ
"KRN",.402,1025,"DIAB",10,0,162.5,19)
35.52;REQ
"KRN",.402,1025,"DIAB",10,0,162.5,21)
35.82;REQ
"KRN",.402,1025,"DIAB",10,0,162.5,23)
36.12;REQ
"KRN",.402,1025,"DIAB",10,0,162.5,25)
36.42;REQ
"KRN",.402,1025,"DIAB",10,0,162.5,27)
36.72;REQ
"KRN",.402,1025,"DIAB",11,0,162.5,15)
34.02;REQ
"KRN",.402,1025,"DR",1,162.5)
1////^S X=FBAAID;46////^S X=FBAAVID;55///^S X=FBCSID;56///^S X=$G(FBFPPSC);85///^S X=$G(FBUCI135);57///^S X=$G(FBFPPSL);47////^S X=FBAAMM1;2////^S X=FBVEN;3////^S X=FBVET;60////^S X=$G(FBCNTRP);4////^S X=FBI7078;5////^S X=FBAABDT;
"KRN",.402,1025,"DR",1,162.5,1)
6////^S X=FBAAEDT;23////^S X=FBPSA;21////^S X=FBPOV;22////^S X=FBPT;11////^S X=FBTYPE;12////^S X=FBAAPTC;20////^S X=FBAABE;W !;6.5;54//^S X=$G(FBCDAYS);6.6;I 1;7;S FBAMTC=X;I $G(FBEXMPT)'="Y" S Y="@25";S:FBI7078'["FB583" Y=8;
"KRN",.402,1025,"DR",1,162.5,2)
S:'$P($G(^FB583(+FBI7078,0)),U,28) Y=8;W !?2,"**Payment is for emergency treatment under 38 U.S.C. 1725.";8;S FBAMTP=X;I FBAMTC=FBAMTP S Y="@25";S FBX=$$ADJ^FBUTL2(FBAMTC-FBAMTP,.FBADJ,1,,,1);@20;I $G(FBEXMPT)="Y" S Y="@25";@26;24;
"KRN",.402,1025,"DR",1,162.5,3)
I $$INPICD^FBCSV1(X,$G(DA),FBAABDT) S Y="@26";@25;6.7;I 1;64;65;66;67;68;69;70;71;72;73;80;81;82;83;74;75;S ICDSYS=10,IMPDATE=$$IMPDATE^FBCSV1("10D");S EDATE=ICDVDT;S EDATEH=EDATE;S:EDATE<IMPDATE ICDSYS=9;S:ICDSYS=9 Y="@30";
"KRN",.402,1025,"DR",1,162.5,4)
S XSP="ICD";S ICDDATE=EDATE;@120;S XX1=$$ASKICD10^FBASF(XSP,1) S:XX1<0 Y="@120";30////^S X=XX1;30.02R~;@121;S XX2=$$ASKICD10^FBASF(XSP,2) S:XX2<0 Y="@59";31////^S X=XX2;31.02R~;@122;S XX3=$$ASKICD10^FBASF(XSP,3) S:XX3<0 Y="@59";
"KRN",.402,1025,"DR",1,162.5,5)
32////^S X=XX3;32.02R~;@123;S XX4=$$ASKICD10^FBASF(XSP,4) S:XX4<0 Y="@59";33////^S X=XX4;33.02R~;@124;S XX5=$$ASKICD10^FBASF(XSP,5) S:XX5<0 Y="@59";34////^S X=XX5;34.02R~;@125;S XX6=$$ASKICD10^FBASF(XSP,6) S:XX6<0 Y="@59";
"KRN",.402,1025,"DR",1,162.5,6)
35////^S X=XX6;35.02R~;@126;S XX7=$$ASKICD10^FBASF(XSP,7) S:XX7<0 Y="@59";35.1////^S X=XX7;35.12R~;@127;S XX8=$$ASKICD10^FBASF(XSP,8) S:XX8<0 Y="@59";35.2////^S X=XX8;35.22R~;@128;S XX9=$$ASKICD10^FBASF(XSP,9) S:XX9<0 Y="@59";
"KRN",.402,1025,"DR",1,162.5,7)
35.3////^S X=XX9;35.32R~;@129;S XX10=$$ASKICD10^FBASF(XSP,10) S:XX10<0 Y="@59";35.4////^S X=XX10;35.42R~;@130;S XX11=$$ASKICD10^FBASF(XSP,11) S:XX11<0 Y="@59";35.5////^S X=XX11;35.52R~;@131;
"KRN",.402,1025,"DR",1,162.5,8)
S XX12=$$ASKICD10^FBASF(XSP,12) S:XX12<0 Y="@59";35.6////^S X=XX12;35.62R~;@132;S XX13=$$ASKICD10^FBASF(XSP,13) S:XX13<0 Y="@59";35.7////^S X=XX13;35.72R~;@133;S XX14=$$ASKICD10^FBASF(XSP,14) S:XX14<0 Y="@59";35.8////^S X=XX14;
"KRN",.402,1025,"DR",1,162.5,9)
35.82R~;@134;S XX15=$$ASKICD10^FBASF(XSP,15) S:XX15<0 Y="@59";35.9////^S X=XX15;35.92R~;@135;S XX16=$$ASKICD10^FBASF(XSP,16) S:XX16<0 Y="@59";36////^S X=XX16;36.02R~;@136;S XX17=$$ASKICD10^FBASF(XSP,17) S:XX17<0 Y="@59";
"KRN",.402,1025,"DR",1,162.5,10)
36.1////^S X=XX17;36.12R~;@137;S XX18=$$ASKICD10^FBASF(XSP,18) S:XX18<0 Y="@59";36.2////^S X=XX18;36.22R~;@138;S XX19=$$ASKICD10^FBASF(XSP,19) S:XX19<0 Y="@59";36.3////^S X=XX19;36.32R~;@139;
"KRN",.402,1025,"DR",1,162.5,11)
S XX20=$$ASKICD10^FBASF(XSP,20) S:XX20<0 Y="@59";36.4////^S X=XX20;36.42R~;@140;S XX21=$$ASKICD10^FBASF(XSP,21) S:XX21<0 Y="@59";36.5////^S X=XX21;36.52R~;@141;S XX22=$$ASKICD10^FBASF(XSP,22) S:XX22<0 Y="@59";36.6////^S X=XX22;
"KRN",.402,1025,"DR",1,162.5,12)
36.62R~;@142;S XX23=$$ASKICD10^FBASF(XSP,23) S:XX23<0 Y="@59";36.7////^S X=XX23;36.72R~;@143;S XX24=$$ASKICD10^FBASF(XSP,24) S:XX24<0 Y="@59";36.8////^S X=XX24;36.82R~;@144;S XX25=$$ASKICD10^FBASF(XSP,25) S:XX25<0 Y="@59";
"KRN",.402,1025,"DR",1,162.5,13)
36.9////^S X=XX25;36.92R~;S Y="@57";@30;S XSP="ICD1";S XX1=$$ENICD9^FBICD9(EDATE,XSP,"N") S:XX1<0 Y="@30";30////^S X=+XX1;30.02R~;@31;S XSP="ICD2";S XX2=$$ENICD9^FBICD9(EDATE,XSP,"N");I XX2<0,$P(XX2,"^",2)["inactive" S Y="@31";
"KRN",.402,1025,"DR",1,162.5,14)
S:XX2<0 Y="@57";31////^S X=+XX2;31.02R~;@32;S XSP="ICD3";S XX3=$$ENICD9^FBICD9(EDATE,XSP,"N");I XX3<0,$P(XX3,"^",2)["inactive" S Y="@32";S:XX3<0 Y="@57";32////^S X=+XX3;32.02R~;@33;S XSP="ICD4";S XX4=$$ENICD9^FBICD9(EDATE,XSP,"N");
"KRN",.402,1025,"DR",1,162.5,15)
I XX4<0,$P(XX4,"^",2)["inactive" S Y="@33";S:XX4<0 Y="@57";33////^S X=+XX4;33.02R~;@34;S XSP="ICD5";S XX5=$$ENICD9^FBICD9(EDATE,XSP,"N");I XX5<0,$P(XX5,"^",2)["inactive" S Y="@34";S:XX5<0 Y="@57";34////^S X=+XX5;34.02R~;@35;
"KRN",.402,1025,"DR",1,162.5,16)
S XSP="ICD6";S XX6=$$ENICD9^FBICD9(EDATE,XSP,"N");I XX6<0,$P(XX6,"^",2)["inactive" S Y="@35";S:XX6<0 Y="@57";35////^S X=+XX6;35.02R~;@36;S XSP="ICD7";S XX7=$$ENICD9^FBICD9(EDATE,XSP,"N");I XX7<0,$P(XX7,"^",2)["inactive" S Y="@36";
"KRN",.402,1025,"DR",1,162.5,17)
S:XX7<0 Y="@57";35.1////^S X=+XX7;35.12R~;@37;S XSP="ICD8";S XX8=$$ENICD9^FBICD9(EDATE,XSP,"N");I XX8<0,$P(XX8,"^",2)["inactive" S Y="@37";S:XX8<0 Y="@57";35.2////^S X=+XX8;35.22R~;@38;S XSP="ICD9";
"KRN",.402,1025,"DR",1,162.5,18)
S XX9=$$ENICD9^FBICD9(EDATE,XSP,"N");I XX9<0,$P(XX9,"^",2)["inactive" S Y="@38";S:XX9<0 Y="@57";35.3////^S X=+XX9;35.32R~;@39;S XSP="ICD10";S XX10=$$ENICD9^FBICD9(EDATE,XSP,"N");I XX10<0,$P(XX10,"^",2)["inactive" S Y="@39";
"KRN",.402,1025,"DR",1,162.5,19)
S:XX10<0 Y="@57";35.4////^S X=+XX10;35.42R~;@40;S XSP="ICD11";S XX11=$$ENICD9^FBICD9(EDATE,XSP,"N");I XX11<0,$P(XX11,"^",2)["inactive" S Y="@40";S:XX11<0 Y="@57";35.5////^S X=+XX11;35.52R~;@41;S XSP="ICD12";
"KRN",.402,1025,"DR",1,162.5,20)
S XX12=$$ENICD9^FBICD9(EDATE,XSP,"N");I XX12<0,$P(XX12,"^",2)["inactive" S Y="@41";S:XX12<0 Y="@57";35.6////^S X=+XX12;35.62R~;@42;S XSP="ICD13";S XX13=$$ENICD9^FBICD9(EDATE,XSP,"N");I XX13<0,$P(XX13,"^",2)["inactive" S Y="@42";
"KRN",.402,1025,"DR",1,162.5,21)
S:XX13<0 Y="@57";35.7////^S X=+XX13;35.72R~;@43;S XSP="ICD14";S XX14=$$ENICD9^FBICD9(EDATE,XSP,"N");I XX14<0,$P(XX14,"^",2)["inactive" S Y="@43";S:XX14<0 Y="@57";35.8////^S X=+XX14;35.82R~;@44;S XSP="ICD15";
"KRN",.402,1025,"DR",1,162.5,22)
S XX15=$$ENICD9^FBICD9(EDATE,XSP,"N");I XX15<0,$P(XX15,"^",2)["inactive" S Y="@44";S:XX15<0 Y="@57";35.9////^S X=+XX15;35.92R~;@45;S XSP="ICD16";S XX16=$$ENICD9^FBICD9(EDATE,XSP,"N");I XX16<0,$P(XX16,"^",2)["inactive" S Y="@45";
"KRN",.402,1025,"DR",1,162.5,23)
S:XX16<0 Y="@57";36////^S X=+XX16;36.02R~;@46;S XSP="ICD17";S XX17=$$ENICD9^FBICD9(EDATE,XSP,"N");I XX17<0,$P(XX17,"^",2)["inactive" S Y="@46";S:XX17<0 Y="@57";36.1////^S X=+XX17;36.12R~;@47;S XSP="ICD18";
"KRN",.402,1025,"DR",1,162.5,24)
S XX18=$$ENICD9^FBICD9(EDATE,XSP,"N");I XX18<0,$P(XX18,"^",2)["inactive" S Y="@47";S:XX18<0 Y="@57";36.2////^S X=+XX18;36.22R~;@48;S XSP="ICD19";S XX19=$$ENICD9^FBICD9(EDATE,XSP,"N");I XX19<0,$P(XX19,"^",2)["inactive" S Y="@48";
"KRN",.402,1025,"DR",1,162.5,25)
S:XX19<0 Y="@57";36.3////^S X=+XX19;36.32R~;@49;S XSP="ICD20";S XX20=$$ENICD9^FBICD9(EDATE,XSP,"N");I XX20<0,$P(XX20,"^",2)["inactive" S Y="@49";S:XX20<0 Y="@57";36.4////^S X=+XX20;36.42R~;@50;S XSP="ICD21";
"KRN",.402,1025,"DR",1,162.5,26)
S XX21=$$ENICD9^FBICD9(EDATE,XSP,"N");I XX21<0,$P(XX21,"^",2)["inactive" S Y="@50";S:XX21<0 Y="@57";36.5////^S X=+XX21;36.52R~;@51;S XSP="ICD22";S XX22=$$ENICD9^FBICD9(EDATE,XSP,"N");I XX22<0,$P(XX22,"^",2)["inactive" S Y="@51";
"KRN",.402,1025,"DR",1,162.5,27)
S:XX22<0 Y="@57";36.6////^S X=+XX22;36.62R~;@52;S XSP="ICD23";S XX23=$$ENICD9^FBICD9(EDATE,XSP,"N");I XX23<0,$P(XX23,"^",2)["inactive" S Y="@52";S:XX23<0 Y="@57";36.7////^S X=+XX23;36.72R~;@53;S XSP="ICD24";
"KRN",.402,1025,"DR",1,162.5,28)
S XX24=$$ENICD9^FBICD9(EDATE,XSP,"N");I XX24<0,$P(XX24,"^",2)["inactive" S Y="@53";S:XX24<0 Y="@57";36.8////^S X=+XX24;36.82R~;@54;S XSP="ICD25";S XX25=$$ENICD9^FBICD9(EDATE,XSP,"N");I XX25<0,$P(XX25,"^",2)["inactive" S Y="@54";
"KRN",.402,1025,"DR",1,162.5,29)
S:XX25<0 Y="@57";36.9////^S X=+XX25;36.92R~;@57;S EDATE=$$FRDTINV^FBCSV1(DA);I EDATE<$$IMPDATE^FBCSV1("10D") S Y="@58";S EDATE=EDATEH,Y="@59";@58;S XSP="ADMITTING DIAGNOSIS";S XXAD=$$ENICD9^FBICD9(EDATE,XSP,"N") S:XXAD<0 Y="@58";
"KRN",.402,1025,"DR",1,162.5,30)
39////^S X=+XXAD;S EDATE=EDATEH;S Y="@60";@59;S XAD=-1 S XAD=$$ASKICD10^FBASF("ADMITTING DIAGNOSIS","");S:XAD<0 Y="@59";39////^S X=XAD;@60;S XSP="PROC1";S XX1=$$ENICD9^FBICDP(EDATE,XSP);I XX1<0,$P(XX1,"^",2)["inactive" S Y="@60";
"KRN",.402,1025,"DR",1,162.5,31)
S:XX1<0 Y="@99";40////^S X=+XX1;@61;S XSP="PROC2";S XX2=$$ENICD9^FBICDP(EDATE,XSP);I XX2<0,$P(XX2,"^",2)["inactive" S Y="@61";S:XX2<0 Y="@99";41////^S X=+XX2;@62;S XSP="PROC3";S XX3=$$ENICD9^FBICDP(EDATE,XSP);
"KRN",.402,1025,"DR",1,162.5,32)
I XX3<0,$P(XX3,"^",2)["inactive" S Y="@62";S:XX3<0 Y="@99";42////^S X=+XX3;@63;S XSP="PROC4";S XX4=$$ENICD9^FBICDP(EDATE,XSP);I XX4<0,$P(XX4,"^",2)["inactive" S Y="@63";S:XX4<0 Y="@99";43////^S X=+XX4;@64;S XSP="PROC5";
"KRN",.402,1025,"DR",1,162.5,33)
S XX5=$$ENICD9^FBICDP(EDATE,XSP);I XX5<0,$P(XX5,"^",2)["inactive" S Y="@64";S:XX5<0 Y="@99";44////^S X=+XX5;@65;S XSP="PROC6";S XX6=$$ENICD9^FBICDP(EDATE,XSP);I XX6<0,$P(XX6,"^",2)["inactive" S Y="@65";S:XX6<0 Y="@99";
"KRN",.402,1025,"DR",1,162.5,34)
44.06////^S X=+XX6;@66;S XSP="PROC7";S XX7=$$ENICD9^FBICDP(EDATE,XSP);I XX7<0,$P(XX7,"^",2)["inactive" S Y="@66";S:XX7<0 Y="@99";44.07////^S X=+XX7;@67;S XSP="PROC8";S XX8=$$ENICD9^FBICDP(EDATE,XSP);
"KRN",.402,1025,"DR",1,162.5,35)
I XX8<0,$P(XX8,"^",2)["inactive" S Y="@67";S:XX8<0 Y="@99";44.08////^S X=+XX8;@68;S XSP="PROC9";S XX9=$$ENICD9^FBICDP(EDATE,XSP);I XX9<0,$P(XX9,"^",2)["inactive" S Y="@68";S:XX9<0 Y="@99";44.09////^S X=+XX9;@69;S XSP="PROC10";
"KRN",.402,1025,"DR",1,162.5,36)
S XX10=$$ENICD9^FBICDP(EDATE,XSP);I XX10<0,$P(XX10,"^",2)["inactive" S Y="@69";S:XX10<0 Y="@99";44.1////^S X=+XX10;@70;S XSP="PROC11";S XX11=$$ENICD9^FBICDP(EDATE,XSP);I XX11<0,$P(XX11,"^",2)["inactive" S Y="@70";S:XX11<0 Y="@99";
"KRN",.402,1025,"DR",1,162.5,37)
44.11////^S X=+XX11;@71;S XSP="PROC12";S XX12=$$ENICD9^FBICDP(EDATE,XSP);I XX12<0,$P(XX12,"^",2)["inactive" S Y="@71";S:XX12<0 Y="@99";44.12////^S X=+XX12;@72;S XSP="PROC13";S XX13=$$ENICD9^FBICDP(EDATE,XSP);
"KRN",.402,1025,"DR",1,162.5,38)
I XX13<0,$P(XX13,"^",2)["inactive" S Y="@72";S:XX13<0 Y="@99";44.13////^S X=+XX13;@73;S XSP="PROC14";S XX14=$$ENICD9^FBICDP(EDATE,XSP);I XX14<0,$P(XX14,"^",2)["inactive" S Y="@73";S:XX14<0 Y="@99";44.14////^S X=+XX14;@74;
"KRN",.402,1025,"DR",1,162.5,39)
S XSP="PROC15";S XX15=$$ENICD9^FBICDP(EDATE,XSP);I XX15<0,$P(XX15,"^",2)["inactive" S Y="@74";S:XX15<0 Y="@99";44.15////^S X=+XX15;@75;S XSP="PROC16";S XX16=$$ENICD9^FBICDP(EDATE,XSP);I XX16<0,$P(XX16,"^",2)["inactive" S Y="@75";
"KRN",.402,1025,"DR",1,162.5,40)
S:XX16<0 Y="@99";44.16////^S X=+XX16;@76;S XSP="PROC17";S XX17=$$ENICD9^FBICDP(EDATE,XSP);I XX17<0,$P(XX17,"^",2)["inactive" S Y="@76";S:XX17<0 Y="@99";44.17////^S X=+XX17;@77;S XSP="PROC18";S XX18=$$ENICD9^FBICDP(EDATE,XSP);
"KRN",.402,1025,"DR",1,162.5,41)
I XX18<0,$P(XX18,"^",2)["inactive" S Y="@77";S:XX18<0 Y="@99";44.18////^S X=+XX18;@78;S XSP="PROC19";S XX19=$$ENICD9^FBICDP(EDATE,XSP);I XX19<0,$P(XX19,"^",2)["inactive" S Y="@78";S:XX19<0 Y="@99";44.19////^S X=+XX19;@79;
"KRN",.402,1025,"DR",1,162.5,42)
S XSP="PROC20";S XX20=$$ENICD9^FBICDP(EDATE,XSP);I XX20<0,$P(XX20,"^",2)["inactive" S Y="@79";S:XX20<0 Y="@99";44.2////^S X=+XX20;@80;S XSP="PROC21";S XX21=$$ENICD9^FBICDP(EDATE,XSP);I XX21<0,$P(XX21,"^",2)["inactive" S Y="@80";
"KRN",.402,1025,"DR",1,162.5,43)
S:XX21<0 Y="@99";44.21////^S X=+XX21;@81;S XSP="PROC22";S XX22=$$ENICD9^FBICDP(EDATE,XSP);I XX22<0,$P(XX22,"^",2)["inactive" S Y="@81";S:XX22<0 Y="@99";44.22////^S X=+XX22;@82;S XSP="PROC23";S XX23=$$ENICD9^FBICDP(EDATE,XSP);
"KRN",.402,1025,"DR",1,162.5,44)
I XX23<0,$P(XX23,"^",2)["inactive" S Y="@82";S:XX23<0 Y="@99";44.23////^S X=+XX23;@83;S XSP="PROC24";S XX24=$$ENICD9^FBICDP(EDATE,XSP);I XX24<0,$P(XX24,"^",2)["inactive" S Y="@83";S:XX24<0 Y="@99";44.24////^S X=+XX24;@84;
"KRN",.402,1025,"DR",1,162.5,45)
S XSP="PROC25";S XX25=$$ENICD9^FBICDP(EDATE,XSP);I XX25<0,$P(XX25,"^",2)["inactive" S Y="@84";S:XX25<0 Y="@99";44.25////^S X=+XX25;@99;
"KRN",.402,1025,"DR",1,162.5,46)
I $D(^FBAAI(DA,"DX")),$P(^("DX"),U)="" W !!,*7,"The 'ICD1' field is a manditory field!",! S Y="@30";S FBX=$$RPROV^FBUTL8(.FBPROV,.FBPROVD);I $G(FBEXMPT)'="Y" S Y="@992";S FBX=$$RR^FBUTL4(.FBRRMK,2);@992;25////^S X=FBRESUB;@999;
"KRN",.402,1026,-1)
0^3
"KRN",.402,1026,0)
FBCH EDIT PAYMENT^3140728.0804^^162.5^^^3120531
"KRN",.402,1026,"DIAB",1,0,162.5,7)
31.02;REQ
"KRN",.402,1026,"DIAB",1,0,162.5,43)
31.02;REQ
"KRN",.402,1026,"DIAB",3,0,162.5,11)
34.02;REQ
"KRN",.402,1026,"DIAB",4,0,162.5,18)
35.42;REQ
"KRN",.402,1026,"DIAB",4,0,162.5,45)
34.02;REQ
"KRN",.402,1026,"DIAB",4,0,162.5,46)
35.02;REQ
"KRN",.402,1026,"DIAB",4,0,162.5,47)
35.12;REQ
"KRN",.402,1026,"DIAB",4,0,162.5,48)
35.22;REQ
"KRN",.402,1026,"DIAB",4,0,162.5,49)
35.32;REQ
"KRN",.402,1026,"DIAB",4,0,162.5,50)
35.42;REQ
"KRN",.402,1026,"DIAB",4,0,162.5,51)
35.52;REQ
"KRN",.402,1026,"DIAB",4,0,162.5,52)
35.62;REQ
"KRN",.402,1026,"DIAB",4,0,162.5,53)
35.72;REQ
"KRN",.402,1026,"DIAB",4,0,162.5,54)
35.82;REQ
"KRN",.402,1026,"DIAB",4,0,162.5,55)
35.92;REQ
"KRN",.402,1026,"DIAB",4,0,162.5,56)
36.02;REQ
"KRN",.402,1026,"DIAB",4,0,162.5,57)
36.12;REQ
"KRN",.402,1026,"DIAB",4,0,162.5,58)
36.22;REQ
"KRN",.402,1026,"DIAB",4,0,162.5,59)
36.32;REQ
"KRN",.402,1026,"DIAB",4,0,162.5,60)
36.42;REQ
"KRN",.402,1026,"DIAB",4,0,162.5,61)
36.52;REQ
"KRN",.402,1026,"DIAB",4,0,162.5,62)
36.62;REQ
"KRN",.402,1026,"DIAB",4,0,162.5,63)
36.72;REQ
"KRN",.402,1026,"DIAB",4,0,162.5,64)
36.82;REQ
"KRN",.402,1026,"DIAB",4,0,162.5,65)
36.92;REQ
"KRN",.402,1026,"DIAB",5,0,162.5,4)
24;REQ
"KRN",.402,1026,"DIAB",5,0,162.5,8)
32.02;REQ
"KRN",.402,1026,"DIAB",5,0,162.5,15)
35.22;REQ
"KRN",.402,1026,"DIAB",5,0,162.5,21)
35.62;REQ
"KRN",.402,1026,"DIAB",5,0,162.5,24)
35.82;REQ
"KRN",.402,1026,"DIAB",5,0,162.5,27)
36.02;REQ
"KRN",.402,1026,"DIAB",5,0,162.5,30)
36.22;REQ
"KRN",.402,1026,"DIAB",5,0,162.5,33)
36.42;REQ
"KRN",.402,1026,"DIAB",5,0,162.5,36)
36.62;REQ
"KRN",.402,1026,"DIAB",5,0,162.5,39)
36.82;REQ
"KRN",.402,1026,"DIAB",6,0,162.5,12)
35.02;REQ
"KRN",.402,1026,"DIAB",7,0,162.5,4)
24.5;REQ
"KRN",.402,1026,"DIAB",7,0,162.5,9)
33.02;REQ
"KRN",.402,1026,"DIAB",7,0,162.5,16)
35.32;REQ
"KRN",.402,1026,"DIAB",7,0,162.5,19)
35.52;REQ
"KRN",.402,1026,"DIAB",7,0,162.5,22)
35.72;REQ
"KRN",.402,1026,"DIAB",7,0,162.5,25)
35.92;REQ
"KRN",.402,1026,"DIAB",7,0,162.5,28)
36.12;REQ
"KRN",.402,1026,"DIAB",7,0,162.5,31)
36.32;REQ
"KRN",.402,1026,"DIAB",7,0,162.5,34)
36.52;REQ
"KRN",.402,1026,"DIAB",7,0,162.5,37)
36.72;REQ
"KRN",.402,1026,"DIAB",7,0,162.5,40)
36.92;REQ
"KRN",.402,1026,"DIAB",7,0,162.5,44)
33.02;REQ
"KRN",.402,1026,"DIAB",8,0,162.5,13)
35.12;REQ
"KRN",.402,1026,"DIAB",8,0,162.5,42)
30.02;REQ
"KRN",.402,1026,"DIAB",10,0,162.5,5)
30.02;REQ
"KRN",.402,1026,"DIAB",11,0,162.5,43)
32.02;REQ
"KRN",.402,1026,"DR",1,162.5)
@1;1;I 1;I $$BADDATE^FBCHEP1(X,DA) S Y="@1";46;55;S FBX=$$FPPSC^FBUTL5(1,FBFPPSC);D EDINPAT^FBUTL136($G(FBX),$G(FBI));S:FBX=-1 Y=0;S:FBX="" Y="@10";56///^S X=FBX;S FBFPPSC=X;S FBX=$$FPPSL^FBUTL5(FBFPPSL,1);S:FBX=-1 Y=0;
"KRN",.402,1026,"DR",1,162.5,1)
57///^S X=FBX;S FBFPPSL=X;S Y="@14";@10;56///@;S FBFPPSC="";57///@;S FBFPPSL="";@14;S FBV=$P($G(^FBAAI(DA,0)),U,3);S FBAAMM=$S($G(FBAAPTC)="R":"",$D(FB583):"",1:1);D PPT^FBAACO1($G(FBAAMM1),$G(FBCNTRP));47////@;47///^S X=FBAAMM1;
"KRN",.402,1026,"DR",1,162.5,2)
60///@;60////^S X=$G(FBCNTRP);6.5;54;6.6;I 1;6.7;64;65;66;67;68;69;70;71;72;73;80;81;82;83;74;75;S DIE("NO^")="NO QUIT";7;S:$D(FBPRICE) Y="@19";S FBJJ=X;I $G(FBEXMPT)="Y" S Y="@16";26;S FBPAMT=X;@16;
"KRN",.402,1026,"DR",1,162.5,3)
W:FB1725 !?2,"**Payment is for emergency treatment under 38 U.S.C. 1725.";W:FB1725&($G(FBPAMT)>0) !?2,"  70% of Pricer Amount = "_$J(.7*FBPAMT,0,2);8;S FBKK=X;K FBADJD;M FBADJD=FBADJ;
"KRN",.402,1026,"DR",1,162.5,4)
S FBX=$$ADJ^FBUTL2(FBJJ-FBKK,.FBADJ,1,,.FBADJD,1);K FBADJD;I $G(FBEXMPT)="Y" S Y="@19";@18;24R~;I $$INPICD^FBCSV1(X,$G(DA)) S Y="@18";24.5R~;@19;S ICDSYS=10,IMPDATE=$$IMPDATE^FBCSV1("10D");S EDATE=ICDVDT;S:EDATE<IMPDATE ICDSYS=9;
"KRN",.402,1026,"DR",1,162.5,5)
S EDATEH=EDATE;S:ICDSYS=10 Y="@210";@20;S XXE1=$P($G(^FBAAI(DA,"DX")),"^",1);S XSP="ICD1";S XX1=$$ENICD9^FBICD9(EDATE,XSP,"N","N","Y",XXE1);I XX1<0,$P(XX1,"^",2)["inactive" S Y="@20";S:XX1<0 XX1=XXE1;30////^S X=+XX1;30.02R~;@22;
"KRN",.402,1026,"DR",1,162.5,6)
S XSP="ICD2";S XXE2=$P($G(^FBAAI(DA,"DX")),"^",2);S XX2=$$ENICD9^FBICD9(EDATE,XSP,"N","Y","N",XXE2);I XX2<0,$P(XX2,"^",2)["inactive" S Y="@22";I XX2<0,XXE2'?1N.N S Y="@70";S:XX2<0 XX2=XXE2;31////^S X=+XX2;I XX2="@" S Y="@23";
"KRN",.402,1026,"DR",1,162.5,7)
31.02R~;S:$G(LASTDX)<2 LASTDX=2;S Y="@24";@23;31.02///@;S:$G(LASTDX)'>2 Y="@70";@24;S XSP="ICD3";S XXE3=$P($G(^FBAAI(DA,"DX")),"^",3);S XX3=$$ENICD9^FBICD9(EDATE,XSP,"N","Y","N",XXE3);I XX3<0,$P(XX3,"^",2)["inactive" S Y="@24";
"KRN",.402,1026,"DR",1,162.5,8)
I XX3<0,XXE3'?1N.N S Y="@70";I XX3<0 S XX3=XXE3;32////^S X=+XX3;I XX3="@" S Y="@25";32.02R~;S:$G(LASTDX)<3 LASTDX=3;S Y="@26";@25;32.02///@;S:$G(LASTDX)'>3 Y="@70";@26;S XSP="ICD4";S XXE4=$P($G(^FBAAI(DA,"DX")),"^",4);
"KRN",.402,1026,"DR",1,162.5,9)
S XX4=$$ENICD9^FBICD9(EDATE,XSP,"N","Y","N",XXE4);I XX4<0,$P(XX4,"^",2)["inactive" S Y="@26";I XX4<0,XXE4'?1N.N S Y="@70";S:XX4<0 XX4=XXE4;33////^S X=+XX4;I XX4="@" S Y="@27";33.02R~;S:$G(LASTDX)<4 LASTDX=4;S Y="@28";@27;33.02///@;
"KRN",.402,1026,"DR",1,162.5,10)
S:$G(LASTDX)'>4 Y="@70";@28;S XSP="ICD5";S XXE5=$P($G(^FBAAI(DA,"DX")),"^",5);S XX5=$$ENICD9^FBICD9(EDATE,XSP,"N","Y","N",XXE5);I XX5<0,$P(XX5,"^",2)["inactive" S Y="@28";I XX5<0,XXE5'?1N.N S Y="@70";S:XX5<0 XX5=XXE5;
"KRN",.402,1026,"DR",1,162.5,11)
34////^S X=+XX5;I XX5="@" S Y="@29";34.02R~;S:$G(LASTDX)<5 LASTDX=5;S Y="@30";@29;34.02///@;S:$G(LASTDX)'>5 Y="@70";@30;S XSP="ICD6";S XXE6=$P($G(^FBAAI(DA,"DX")),"^",6);S XX6=$$ENICD9^FBICD9(EDATE,XSP,"N","Y","N",XXE6);
"KRN",.402,1026,"DR",1,162.5,12)
I XX6<0,$P(XX6,"^",2)["inactive" S Y="@30";I XX6<0,XXE6'?1N.N S Y="@70";S:XX6<0 XX6=XXE6;35////^S X=+XX6;I XX6="@" S Y="@31";35.02R~;S:$G(LASTDX)<6 LASTDX=6;S Y="@32";@31;35.02///@;S:$G(LASTDX)'>6 Y="@70";@32;S XSP="ICD7";
"KRN",.402,1026,"DR",1,162.5,13)
S XXE7=$P($G(^FBAAI(DA,"DX")),"^",7);S XX7=$$ENICD9^FBICD9(EDATE,XSP,"N","Y","N",XXE7);I XX7<0,$P(XX7,"^",2)["inactive" S Y="@32";I XX7<0,XXE7'?1N.N S Y="@70";S:XX7<0 XX7=XXE7;35.1////^S X=+XX7;I XX7="@" S Y="@33";35.12R~;
"KRN",.402,1026,"DR",1,162.5,14)
S:$G(LASTDX)<7 LASTDX=7;S Y="@34";@33;35.12///@;S:$G(LASTDX)'>7 Y="@70";@34;S XSP="ICD8";S XXE8=$P($G(^FBAAI(DA,"DX")),"^",8);S XX8=$$ENICD9^FBICD9(EDATE,XSP,"N","Y","N",XXE8);I XX8<0,$P(XX8,"^",2)["inactive" S Y="@34";
"KRN",.402,1026,"DR",1,162.5,15)
I XX8<0,XXE8'?1N.N S Y="@70";S:XX8<0 XX8=XXE8;35.2////^S X=+XX8;I XX8="@" S Y="@35";35.22R~;S:$G(LASTDX)<8 LASTDX=8;S Y="@36";@35;35.22///@;S:$G(LASTDX)'>8 Y="@70";@36;S XSP="ICD9";S XXE9=$P($G(^FBAAI(DA,"DX")),"^",9);
"KRN",.402,1026,"DR",1,162.5,16)
S XX9=$$ENICD9^FBICD9(EDATE,XSP,"N","Y","N",XXE9);I XX9<0,$P(XX9,"^",2)["inactive" S Y="@36";I XX9<0,XXE9'?1N.N S Y="@70";S:XX9<0 XX9=XXE9;35.3////^S X=+XX9;I XX9="@" S Y="@37";35.32R~;S:$G(LASTDX)<9 LASTDX=9;S Y="@38";@37;
"KRN",.402,1026,"DR",1,162.5,17)
35.32///@;S:$G(LASTDX)'>9 Y="@70";@38;S XSP="ICD10";S XXE10=$P($G(^FBAAI(DA,"DX")),"^",10);S XX10=$$ENICD9^FBICD9(EDATE,XSP,"N","Y","N",XXE10);I XX10<0,$P(XX10,"^",2)["inactive" S Y="@38";I XX10<0,XXE10'?1N.N S Y="@70";
"KRN",.402,1026,"DR",1,162.5,18)
S:XX10<0 XX10=XXE10;35.4////^S X=+XX10;I XX10="@" S Y="@39";35.42R~;S:$G(LASTDX)<10 LASTDX=10;S Y="@40";@39;35.42///@;S:$G(LASTDX)'>10 Y="@70";@40;S XSP="ICD11";S XXE11=$P($G(^FBAAI(DA,"DX")),"^",11);
"KRN",.402,1026,"DR",1,162.5,19)
S XX11=$$ENICD9^FBICD9(EDATE,XSP,"N","Y","N",XXE11);I XX11<0,$P(XX11,"^",2)["inactive" S Y="@40";I XX11<0,XXE11'?1N.N S Y="@70";S:XX11<0 XX11=XXE11;35.5////^S X=+XX11;I XX11="@" S Y="@41";35.52R~;S:$G(LASTDX)<11 LASTDX=11;
"KRN",.402,1026,"DR",1,162.5,20)
S Y="@42";@41;35.52///@;S:$G(LASTDX)'>11 Y="@70";@42;S XSP="ICD12";S XXE12=$P($G(^FBAAI(DA,"DX")),"^",12);S XX12=$$ENICD9^FBICD9(EDATE,XSP,"N","Y","N",XXE12);I XX12<0,$P(XX12,"^",2)["inactive" S Y="@42";
"KRN",.402,1026,"DR",1,162.5,21)
I XX12<0,XXE12'?1N.N S Y="@70";S:XX12<0 XX12=XXE12;35.6////^S X=+XX12;I XX12="@" S Y="@43";35.62R~;S:$G(LASTDX)<12 LASTDX=12;S Y="@44";@43;35.62///@;S:$G(LASTDX)'>12 Y="@70";@44;S XSP="ICD13";S XXE13=$P($G(^FBAAI(DA,"DX")),"^",13);
"KRN",.402,1026,"DR",1,162.5,22)
S XX13=$$ENICD9^FBICD9(EDATE,XSP,"N","Y","N",XXE13);I XX13<0,$P(XX13,"^",2)["inactive" S Y="@44";I XX13<0,XXE13'?1N.N S Y="@70";S:XX13<0 XX13=XXE13;35.7////^S X=+XX13;I XX13="@" S Y="@45";35.72R~;S:$G(LASTDX)<13 LASTDX=13;
"KRN",.402,1026,"DR",1,162.5,23)
S Y="@46";@45;35.72///@;S:$G(LASTDX)'>13 Y="@70";@46;S XSP="ICD14";S XXE14=$P($G(^FBAAI(DA,"DX")),"^",14);S XX14=$$ENICD9^FBICD9(EDATE,XSP,"N","Y","N",XXE14);I XX14<0,$P(XX14,"^",2)["inactive" S Y="@46";
"KRN",.402,1026,"DR",1,162.5,24)
I XX14<0,XXE14'?1N.N S Y="@70";S:XX14<0 XX14=XXE14;35.8////^S X=+XX14;I XX14="@" S Y="@47";35.82R~;S:$G(LASTDX)<14 LASTDX=14;S Y="@48";@47;35.82///@;S:$G(LASTDX)'>14 Y="@70";@48;S XSP="ICD15";S XXE15=$P($G(^FBAAI(DA,"DX")),"^",15);
"KRN",.402,1026,"DR",1,162.5,25)
S XX15=$$ENICD9^FBICD9(EDATE,XSP,"N","Y","N",XXE15);I XX15<0,$P(XX15,"^",2)["inactive" S Y="@48";I XX15<0,XXE15'?1N.N S Y="@70";S:XX15<0 XX15=XXE15;35.9////^S X=+XX15;I XX15="@" S Y="@49";35.92R~;S:$G(LASTDX)<15 LASTDX=15;
"KRN",.402,1026,"DR",1,162.5,26)
S Y="@50";@49;35.92///@;S:$G(LASTDX)'>15 Y="@70";@50;S XSP="ICD16";S XXE16=$P($G(^FBAAI(DA,"DX")),"^",16);S XX16=$$ENICD9^FBICD9(EDATE,XSP,"N","Y","N",XXE16);I XX16<0,$P(XX16,"^",2)["inactive" S Y="@50";
"KRN",.402,1026,"DR",1,162.5,27)
I XX16<0,XXE16'?1N.N S Y="@70";S:XX16<0 XX16=XXE16;36////^S X=+XX16;I XX16="@" S Y="@51";36.02R~;S:$G(LASTDX)<16 LASTDX=16;S Y="@52";@51;36.02///@;S:$G(LASTDX)'>16 Y="@70";@52;S XSP="ICD17";S XXE17=$P($G(^FBAAI(DA,"DX")),"^",17);
"KRN",.402,1026,"DR",1,162.5,28)
S XX17=$$ENICD9^FBICD9(EDATE,XSP,"N","Y","N",XXE17);I XX17<0,$P(XX17,"^",2)["inactive" S Y="@52";I XX17<0,XXE17'?1N.N S Y="@70";S:XX17<0 XX17=XXE17;36.1////^S X=+XX17;I XX17="@" S Y="@53";36.12R~;S:$G(LASTDX)<17 LASTDX=17;
"KRN",.402,1026,"DR",1,162.5,29)
S Y="@54";@53;36.12///@;S:$G(LASTDX)'>17 Y="@70";@54;S XSP="ICD18";S XXE18=$P($G(^FBAAI(DA,"DX")),"^",18);S XX18=$$ENICD9^FBICD9(EDATE,XSP,"N","Y","N",XXE18);I XX18<0,$P(XX18,"^",2)["inactive" S Y="@54";
"KRN",.402,1026,"DR",1,162.5,30)
I XX18<0,XXE18'?1N.N S Y="@70";S:XX18<0 XX18=XXE18;36.2////^S X=+XX18;I XX18="@" S Y="@55";36.22R~;S:$G(LASTDX)<18 LASTDX=18;S Y="@56";@55;36.22///@;S:$G(LASTDX)'>18 Y="@70";@56;S XSP="ICD19";S XXE19=$P($G(^FBAAI(DA,"DX")),"^",19);
"KRN",.402,1026,"DR",1,162.5,31)
S XX19=$$ENICD9^FBICD9(EDATE,XSP,"N","Y","N",XXE19);I XX19<0,$P(XX19,"^",2)["inactive" S Y="@56";I XX19<0,XXE19'?1N.N S Y="@70";S:XX19<0 XX19=XXE19;36.3////^S X=+XX19;I XX19="@" S Y="@57";36.32R~;S:$G(LASTDX)<19 LASTDX=19;
"KRN",.402,1026,"DR",1,162.5,32)
S Y="@58";@57;36.32///@;S:$G(LASTDX)'>19 Y="@70";@58;S XSP="ICD20";S XXE20=$P($G(^FBAAI(DA,"DX")),"^",20);S XX20=$$ENICD9^FBICD9(EDATE,XSP,"N","Y","N",XXE20);I XX20<0,$P(XX20,"^",2)["inactive" S Y="@58";
"KRN",.402,1026,"DR",1,162.5,33)
I XX20<0,XXE20'?1N.N S Y="@70";S:XX20<0 XX20=XXE20;36.4////^S X=+XX20;I XX20="@" S Y="@59";36.42R~;S:$G(LASTDX)<20 LASTDX=20;S Y="@60";@59;36.42///@;S:$G(LASTDX)'>20 Y="@70";@60;S XSP="ICD21";S XXE21=$P($G(^FBAAI(DA,"DX")),"^",21);
"KRN",.402,1026,"DR",1,162.5,34)
S XX21=$$ENICD9^FBICD9(EDATE,XSP,"N","Y","N",XXE21);I XX21<0,$P(XX21,"^",2)["inactive" S Y="@60";I XX21<0,XXE21'?1N.N S Y="@70";S:XX21<0 XX21=XXE21;36.5////^S X=+XX21;I XX21="@" S Y="@61";36.52R~;S:$G(LASTDX)<21 LASTDX=21;
"KRN",.402,1026,"DR",1,162.5,35)
S Y="@62";@61;36.52///@;S:$G(LASTDX)'>21 Y="@70";@62;S XSP="ICD22";S XXE22=$P($G(^FBAAI(DA,"DX")),"^",22);S XX22=$$ENICD9^FBICD9(EDATE,XSP,"N","Y","N",XXE22);I XX22<0,$P(XX22,"^",2)["inactive" S Y="@62";
"KRN",.402,1026,"DR",1,162.5,36)
I XX22<0,XXE22'?1N.N S Y="@70";S:XX22<0 XX22=XXE22;36.6////^S X=+XX22;I XX22="@" S Y="@63";36.62R~;S:$G(LASTDX)<22 LASTDX=22;S Y="@64";@63;36.62///@;S:$G(LASTDX)'>22 Y="@70";@64;S XSP="ICD23";S XXE23=$P($G(^FBAAI(DA,"DX")),"^",23);
"KRN",.402,1026,"DR",1,162.5,37)
S XX23=$$ENICD9^FBICD9(EDATE,XSP,"N","Y","N",XXE23);I XX23<0,$P(XX23,"^",2)["inactive" S Y="@64";I XX23<0,XXE23'?1N.N S Y="@70";S:XX23<0 XX23=XXE23;36.7////^S X=+XX23;I XX23="@" S Y="@65";36.72R~;S:$G(LASTDX)<23 LASTDX=23;
"KRN",.402,1026,"DR",1,162.5,38)
S Y="@66";@65;36.72///@;S:$G(LASTDX)'>23 Y="@70";@66;S XSP="ICD24";S XXE24=$P($G(^FBAAI(DA,"DX")),"^",24);S XX24=$$ENICD9^FBICD9(EDATE,XSP,"N","Y","N",XXE24);I XX24<0,$P(XX24,"^",2)["inactive" S Y="@66";
"KRN",.402,1026,"DR",1,162.5,39)
I XX24<0,XXE24'?1N.N S Y="@70";S:XX24<0 XX24=XXE24;36.8////^S X=+XX24;I XX24="@" S Y="@67";36.82R~;S:$G(LASTDX)<24 LASTDX=24;S Y="@68";@67;36.82///@;S:$G(LASTDX)'>24 Y="@70";@68;S XSP="ICD25";S XXE25=$P($G(^FBAAI(DA,"DX")),"^",25);
"KRN",.402,1026,"DR",1,162.5,40)
S XX25=$$ENICD9^FBICD9(EDATE,XSP,"N","Y","N",XXE25);I XX25<0,$P(XX25,"^",2)["inactive" S Y="@68";I XX25<0,XXE25'?1N.N S Y="@70";S:XX25<0 XX25=XXE25;36.9////^S X=+XX25;I XX25="@" S Y="@69";36.92R~;S:$G(LASTDX)<25 LASTDX=25;
"KRN",.402,1026,"DR",1,162.5,41)
S Y="@70";@69;36.92///@;@70;S XSP="ADMITTING DIAGNOSIS";S XXEAD=$P($G(^FBAAI(DA,5)),"^",9);S XXAD=$$ENICD9^FBICD9(EDATE,XSP,"N","N","Y",XXEAD);I XXAD<0,$P(XXAD,"^",2)["inactive" S Y="@70";I XXAD<0,XXEAD'?1N.N S Y="@70";
"KRN",.402,1026,"DR",1,162.5,42)
S:XXAD<0 XXAD=XXEAD;39////^S X=+XXAD;S Y="@320";@210;S XSP="ICD";S XX1=$$ASKICD10^FBASF(XSP,1) S:XX1<0 Y="@210";30////^S X=XX1;30.02R~;@211;S XX2=$$ASKICD10^FBASF(XSP,2,"","Y") S:XX2<0 Y="@300";31////^S X=XX2;I XX2="@" S Y="@212";
"KRN",.402,1026,"DR",1,162.5,43)
31.02R~;S:$G(LASTDX)<2 LASTDX=2;S Y="@213";@212;31.02///@;S:$G(LASTDX)'>2 Y="@300";@213;S XX3=$$ASKICD10^FBASF(XSP,3,"","Y") S:XX3<0 Y="@300";32////^S X=XX3;I XX3="@" S Y="@214";32.02R~;S:$G(LASTDX)<3 LASTDX=3;S Y="@215";@214;
"KRN",.402,1026,"DR",1,162.5,44)
32.02///@;S:$G(LASTDX)'>3 Y="@300";@215;S XX4=$$ASKICD10^FBASF(XSP,4,"","Y") S:XX4<0 Y="@300";33////^S X=XX4;I XX4="@" S Y="@216";33.02R~;S:$G(LASTDX)<4 LASTDX=4;S Y="@217";@216;33.02///@;S:$G(LASTDX)'>4 Y="@300";@217;
"KRN",.402,1026,"DR",1,162.5,45)
S XX5=$$ASKICD10^FBASF(XSP,5,"","Y") S:XX5<0 Y="@300";34////^S X=XX5;I XX5="@" S Y="@218";34.02R~;S:$G(LASTDX)<5 LASTDX=5;S Y="@219";@218;34.02///@;S:$G(LASTDX)'>5 Y="@300";@219;
"KRN",.402,1026,"DR",1,162.5,46)
S XX6=$$ASKICD10^FBASF(XSP,6,"","Y") S:XX6<0 Y="@300";35////^S X=XX6;I XX6="@" S Y="@220";35.02R~;S:$G(LASTDX)<6 LASTDX=6;S Y="@221";@220;35.02///@;S:$G(LASTDX)'>6 Y="@300";@221;
"KRN",.402,1026,"DR",1,162.5,47)
S XX7=$$ASKICD10^FBASF(XSP,7,"","Y") S:XX7<0 Y="@300";35.1////^S X=XX7;I XX7="@" S Y="@222";35.12R~;S:$G(LASTDX)<7 LASTDX=7;S Y="@223";@222;35.12///@;S:$G(LASTDX)'>7 Y="@300";@223;
"KRN",.402,1026,"DR",1,162.5,48)
S XX8=$$ASKICD10^FBASF(XSP,8,"","Y") S:XX8<0 Y="@300";35.2////^S X=XX8;I XX8="@" S Y="@224";35.22R~;S:$G(LASTDX)<8 LASTDX=8;S Y="@225";@224;35.22///@;S:$G(LASTDX)'>8 Y="@300";@225;
"KRN",.402,1026,"DR",1,162.5,49)
S XX9=$$ASKICD10^FBASF(XSP,9,"","Y") S:XX9<0 Y="@300";35.3////^S X=XX9;I XX9="@" S Y="@226";35.32R~;S:$G(LASTDX)<9 LASTDX=9;S Y="@227";@226;35.32///@;S:$G(LASTDX)'>9 Y="@300";@227;
"KRN",.402,1026,"DR",1,162.5,50)
S XX10=$$ASKICD10^FBASF(XSP,10,"","Y") S:XX10<0 Y="@300";35.4////^S X=XX10;I XX10="@" S Y="@228";35.42R~;S:$G(LASTDX)<10 LASTDX=10;S Y="@229";@228;35.42///@;S:$G(LASTDX)'>10 Y="@300";@229;
"KRN",.402,1026,"DR",1,162.5,51)
S XX11=$$ASKICD10^FBASF(XSP,11,"","Y") S:XX11<0 Y="@300";35.5////^S X=XX11;I XX11="@" S Y="@230";35.52R~;S:$G(LASTDX)<11 LASTDX=11;S Y="@231";@230;35.52///@;S:$G(LASTDX)'>11 Y="@300";@231;
"KRN",.402,1026,"DR",1,162.5,52)
S XX12=$$ASKICD10^FBASF(XSP,12,"","Y") S:XX12<0 Y="@300";35.6////^S X=XX12;I XX12="@" S Y="@232";35.62R~;S:$G(LASTDX)<12 LASTDX=12;S Y="@233";@232;35.62///@;S:$G(LASTDX)'>12 Y="@300";@233;
"KRN",.402,1026,"DR",1,162.5,53)
S XX13=$$ASKICD10^FBASF(XSP,13,"","Y") S:XX13<0 Y="@300";35.7////^S X=XX13;I XX13="@" S Y="@234";35.72R~;S:$G(LASTDX)<13 LASTDX=13;S Y="@235";@234;35.72///@;S:$G(LASTDX)'>13 Y="@300";@235;
"KRN",.402,1026,"DR",1,162.5,54)
S XX14=$$ASKICD10^FBASF(XSP,14,"","Y") S:XX14<0 Y="@300";35.8////^S X=XX14;I XX14="@" S Y="@236";35.82R~;S:$G(LASTDX)<14 LASTDX=14;S Y="@237";@236;35.82///@;S:$G(LASTDX)'>14 Y="@300";@237;
"KRN",.402,1026,"DR",1,162.5,55)
S XX15=$$ASKICD10^FBASF(XSP,15,"","Y") S:XX15<0 Y="@300";35.9////^S X=XX15;I XX15="@" S Y="@238";35.92R~;S:$G(LASTDX)<15 LASTDX=15;S Y="@239";@238;35.92///@;S:$G(LASTDX)'>15 Y="@300";@239;
"KRN",.402,1026,"DR",1,162.5,56)
S XX16=$$ASKICD10^FBASF(XSP,16,"","Y") S:XX16<0 Y="@300";36////^S X=XX16;I XX16="@" S Y="@240";36.02R~;S:$G(LASTDX)<16 LASTDX=16;S Y="@241";@240;36.02///@;S:$G(LASTDX)'>16 Y="@300";@241;
"KRN",.402,1026,"DR",1,162.5,57)
S XX17=$$ASKICD10^FBASF(XSP,17,"","Y") S:XX17<0 Y="@300";36.1////^S X=XX17;I XX17="@" S Y="@242";36.12R~;S:$G(LASTDX)<17 LASTDX=17;S Y="@243";@242;36.12///@;S:$G(LASTDX)'>17 Y="@300";@243;
"KRN",.402,1026,"DR",1,162.5,58)
S XX18=$$ASKICD10^FBASF(XSP,18,"","Y") S:XX18<0 Y="@300";36.2////^S X=XX18;I XX18="@" S Y="@244";36.22R~;S:$G(LASTDX)<18 LASTDX=18;S Y="@245";@244;36.22///@;S:$G(LASTDX)'>18 Y="@300";@245;
"KRN",.402,1026,"DR",1,162.5,59)
S XX19=$$ASKICD10^FBASF(XSP,19,"","Y") S:XX19<0 Y="@300";36.3////^S X=XX19;I XX19="@" S Y="@246";36.32R~;S:$G(LASTDX)<19 LASTDX=19;S Y="@247";@246;36.32///@;S:$G(LASTDX)'>19 Y="@300";@247;
"KRN",.402,1026,"DR",1,162.5,60)
S XX20=$$ASKICD10^FBASF(XSP,20,"","Y") S:XX20<0 Y="@300";36.4////^S X=XX20;I XX20="@" S Y="@248";36.42R~;S:$G(LASTDX)<20 LASTDX=20;S Y="@249";@248;36.42///@;S:$G(LASTDX)'>20 Y="@300";@249;
"KRN",.402,1026,"DR",1,162.5,61)
S XX21=$$ASKICD10^FBASF(XSP,21,"","Y") S:XX21<0 Y="@300";36.5////^S X=XX21;I XX21="@" S Y="@250";36.52R~;S:$G(LASTDX)<21 LASTDX=21;S Y="@251";@250;36.52///@;S:$G(LASTDX)'>21 Y="@300";@251;
"KRN",.402,1026,"DR",1,162.5,62)
S XX22=$$ASKICD10^FBASF(XSP,22,"","Y") S:XX22<0 Y="@300";36.6////^S X=XX22;I XX22="@" S Y="@252";36.62R~;S:$G(LASTDX)<22 LASTDX=22;S Y="@253";@252;36.62///@;S:$G(LASTDX)'>22 Y="@300";@253;
"KRN",.402,1026,"DR",1,162.5,63)
S XX23=$$ASKICD10^FBASF(XSP,23,"","Y") S:XX23<0 Y="@300";36.7////^S X=XX23;I XX23="@" S Y="@254";36.72R~;S:$G(LASTDX)<23 LASTDX=23;S Y="@255";@254;36.72///@;S:$G(LASTDX)'>23 Y="@300";@255;
"KRN",.402,1026,"DR",1,162.5,64)
S XX24=$$ASKICD10^FBASF(XSP,24,"","Y") S:XX24<0 Y="@300";36.8////^S X=XX24;I XX24="@" S Y="@256";36.82R~;S:$G(LASTDX)<24 LASTDX=24;S Y="@257";@256;36.82///@;S:$G(LASTDX)'>24 Y="@300";@257;
"KRN",.402,1026,"DR",1,162.5,65)
S XX25=$$ASKICD10^FBASF(XSP,25,"","Y") S:XX25<0 Y="@300";36.9////^S X=XX25;I XX25="@" S Y="@258";36.92R~;S:$G(LASTDX)<25 LASTDX=25;S Y="@300";@258;36.92///@;@300;S EDATE=$$FRDTINV^FBCSV1(DA);
"KRN",.402,1026,"DR",1,162.5,66)
I EDATE<$$IMPDATE^FBCSV1("10D") S Y="@305";S EDATE=EDATEH,Y="@310";@305;39;S:$$INPICD9^FBCSV1(X,$G(DA)) Y="@305";S EDATE=EDATEH,Y="@320";@310;S XAD=-1 S XAD=$$ASKICD10^FBASF("ADMITTING DIAGNOSIS","");S:XAD<0 Y="@310";
"KRN",.402,1026,"DR",1,162.5,67)
39////^S X=XAD;@320;S ICDCD=31,IMPDATE=$$IMPDATE^FBCSV1("10D");S:EDATE<IMPDATE ICDCD=2;S XSP="PROC1";S XXE1=$P($G(^FBAAI(DA,"PROC")),"^",1);S XX1=$$ENICD9^FBICDP(EDATE,XSP,"N","Y","N",XXE1);
"KRN",.402,1026,"DR",1,162.5,68)
I XX1<0,$P(XX1,"^",2)["inactive" S Y="@320";I XX1<0,XXE1'?1N.N S Y="@99";S:XX1<0 XX1=XXE1;40////^S X=+XX1;@325;S XSP="PROC2";S XXE2=$P($G(^FBAAI(DA,"PROC")),"^",2);S XX2=$$ENICD9^FBICDP(EDATE,XSP,"N","Y","N",XXE2);
"KRN",.402,1026,"DR",1,162.5,69)
I XX2<0,$P(XX2,"^",2)["inactive" S Y="@325";I XX2<0,XXE2'?1N.N S Y="@99";S:XX2<0 XX2=XXE2;41////^S X=+XX2;@326;S XSP="PROC3";S XXE3=$P($G(^FBAAI(DA,"PROC")),"^",3);S XX3=$$ENICD9^FBICDP(EDATE,XSP,"N","Y","N",XXE3);
"KRN",.402,1026,"DR",1,162.5,70)
I XX3<0,$P(XX3,"^",2)["inactive" S Y="@326";I XX3<0,XXE3'?1N.N S Y="@99";S:XX3<0 XX3=XXE3;42////^S X=+XX3;@327;S XSP="PROC4";S XXE4=$P($G(^FBAAI(DA,"PROC")),"^",4);S XX4=$$ENICD9^FBICDP(EDATE,XSP,"N","Y","N",XXE4);
"KRN",.402,1026,"DR",1,162.5,71)
I XX4<0,$P(XX4,"^",2)["inactive" S Y="@327";I XX4<0,XXE4'?1N.N S Y="@99";S:XX4<0 XX4=XXE4;43////^S X=+XX4;@328;S XSP="PROC5";S XXE5=$P($G(^FBAAI(DA,"PROC")),"^",5);S XX5=$$ENICD9^FBICDP(EDATE,XSP,"N","Y","N",XXE5);
"KRN",.402,1026,"DR",1,162.5,72)
I XX5<0,$P(XX5,"^",2)["inactive" S Y="@328";I XX5<0,XXE5'?1N.N S Y="@99";S:XX5<0 XX5=XXE5;44////^S X=+XX5;@329;S XSP="PROC6";S XXE6=$P($G(^FBAAI(DA,"PROC")),"^",6);S XX6=$$ENICD9^FBICDP(EDATE,XSP,"N","Y","N",XXE6);
"KRN",.402,1026,"DR",1,162.5,73)
I XX6<0,$P(XX6,"^",2)["inactive" S Y="@329";I XX6<0,XXE6'?1N.N S Y="@99";S:XX6<0 XX6=XXE6;44.06////^S X=+XX6;@330;S XSP="PROC7";S XXE7=$P($G(^FBAAI(DA,"PROC")),"^",7);S XX7=$$ENICD9^FBICDP(EDATE,XSP,"N","Y","N",XXE7);
"KRN",.402,1026,"DR",1,162.5,74)
I XX7<0,$P(XX7,"^",2)["inactive" S Y="@330";I XX7<0,XXE7'?1N.N S Y="@99";S:XX7<0 XX7=XXE7;44.07////^S X=+XX7;@331;S XSP="PROC8";S XXE8=$P($G(^FBAAI(DA,"PROC")),"^",8);S XX8=$$ENICD9^FBICDP(EDATE,XSP,"N","Y","N",XXE8);
"KRN",.402,1026,"DR",1,162.5,75)
I XX8<0,$P(XX8,"^",2)["inactive" S Y="@331";I XX8<0,XXE8'?1N.N S Y="@99";S:XX8<0 XX8=XXE8;44.08////^S X=+XX8;@332;S XSP="PROC9";S XXE9=$P($G(^FBAAI(DA,"PROC")),"^",9);S XX9=$$ENICD9^FBICDP(EDATE,XSP,"N","Y","N",XXE9);
"KRN",.402,1026,"DR",1,162.5,76)
I XX9<0,$P(XX9,"^",2)["inactive" S Y="@332";I XX9<0,XXE9'?1N.N S Y="@99";S:XX9<0 XX9=XXE9;44.09////^S X=+XX9;@333;S XSP="PROC10";S XXE10=$P($G(^FBAAI(DA,"PROC")),"^",10);S XX10=$$ENICD9^FBICDP(EDATE,XSP,"N","Y","N",XXE10);
"KRN",.402,1026,"DR",1,162.5,77)
I XX10<0,$P(XX10,"^",2)["inactive" S Y="@333";I XX10<0,XXE10'?1N.N S Y="@99";S:XX10<0 XX10=XXE10;44.1////^S X=+XX10;@334;S XSP="PROC11";S XXE11=$P($G(^FBAAI(DA,"PROC")),"^",11);S XX11=$$ENICD9^FBICDP(EDATE,XSP,"N","Y","N",XXE11);
"KRN",.402,1026,"DR",1,162.5,78)
I XX11<0,$P(XX11,"^",2)["inactive" S Y="@334";I XX11<0,XXE11'?1N.N S Y="@99";S:XX11<0 XX11=XXE11;44.11////^S X=+XX11;@335;S XSP="PROC12";S XXE12=$P($G(^FBAAI(DA,"PROC")),"^",12);S XX12=$$ENICD9^FBICDP(EDATE,XSP,"N","Y","N",XXE12);
"KRN",.402,1026,"DR",1,162.5,79)
I XX12<0,$P(XX12,"^",2)["inactive" S Y="@335";I XX12<0,XXE12'?1N.N S Y="@99";S:XX12<0 XX12=XXE12;44.12////^S X=+XX12;@336;S XSP="PROC13";S XXE13=$P($G(^FBAAI(DA,"PROC")),"^",13);S XX13=$$ENICD9^FBICDP(EDATE,XSP,"N","Y","N",XXE13);
"KRN",.402,1026,"DR",1,162.5,80)
I XX13<0,$P(XX13,"^",2)["inactive" S Y="@336";I XX13<0,XXE13'?1N.N S Y="@99";S:XX13<0 XX13=XXE13;44.13////^S X=+XX13;@337;S XSP="PROC14";S XXE14=$P($G(^FBAAI(DA,"PROC")),"^",14);S XX14=$$ENICD9^FBICDP(EDATE,XSP,"N","Y","N",XXE14);
"KRN",.402,1026,"DR",1,162.5,81)
I XX14<0,$P(XX14,"^",2)["inactive" S Y="@337";I XX14<0,XXE14'?1N.N S Y="@99";S:XX14<0 XX14=XXE14;44.14////^S X=+XX14;@338;S XSP="PROC15";S XXE15=$P($G(^FBAAI(DA,"PROC")),"^",15);S XX15=$$ENICD9^FBICDP(EDATE,XSP,"N","Y","N",XXE15);
"KRN",.402,1026,"DR",1,162.5,82)
I XX15<0,$P(XX15,"^",2)["inactive" S Y="@338";I XX15<0,XXE15'?1N.N S Y="@99";S:XX15<0 XX15=XXE15;44.15////^S X=+XX15;@339;S XSP="PROC16";S XXE16=$P($G(^FBAAI(DA,"PROC")),"^",16);S XX16=$$ENICD9^FBICDP(EDATE,XSP,"N","Y","N",XXE16);
"KRN",.402,1026,"DR",1,162.5,83)
I XX16<0,$P(XX16,"^",2)["inactive" S Y="@339";I XX16<0,XXE16'?1N.N S Y="@99";S:XX16<0 XX16=XXE16;44.16////^S X=+XX16;@340;S XSP="PROC17";S XXE17=$P($G(^FBAAI(DA,"PROC")),"^",17);S XX17=$$ENICD9^FBICDP(EDATE,XSP,"N","Y","N",XXE17);
"KRN",.402,1026,"DR",1,162.5,84)
I XX17<0,$P(XX17,"^",2)["inactive" S Y="@340";I XX17<0,XXE17'?1N.N S Y="@99";S:XX17<0 XX17=XXE17;44.17////^S X=+XX17;@341;S XSP="PROC18";S XXE18=$P($G(^FBAAI(DA,"PROC")),"^",18);S XX18=$$ENICD9^FBICDP(EDATE,XSP,"N","Y","N",XXE18);
"KRN",.402,1026,"DR",1,162.5,85)
I XX18<0,$P(XX18,"^",2)["inactive" S Y="@341";I XX18<0,XXE18'?1N.N S Y="@99";S:XX18<0 XX18=XXE18;44.18////^S X=+XX18;@342;S XSP="PROC19";S XXE19=$P($G(^FBAAI(DA,"PROC")),"^",19);S XX19=$$ENICD9^FBICDP(EDATE,XSP,"N","Y","N",XXE19);
"KRN",.402,1026,"DR",1,162.5,86)
I XX19<0,$P(XX19,"^",2)["inactive" S Y="@342";I XX19<0,XXE19'?1N.N S Y="@99";S:XX19<0 XX19=XXE19;44.19////^S X=+XX19;@343;S XSP="PROC20";S XXE20=$P($G(^FBAAI(DA,"PROC")),"^",20);S XX20=$$ENICD9^FBICDP(EDATE,XSP,"N","Y","N",XXE20);
"KRN",.402,1026,"DR",1,162.5,87)
I XX20<0,$P(XX20,"^",2)["inactive" S Y="@343";I XX20<0,XXE20'?1N.N S Y="@99";S:XX20<0 XX20=XXE20;44.2////^S X=+XX20;@344;S XSP="PROC21";S XXE21=$P($G(^FBAAI(DA,"PROC")),"^",21);S XX21=$$ENICD9^FBICDP(EDATE,XSP,"N","Y","N",XXE21);
"KRN",.402,1026,"DR",1,162.5,88)
I XX21<0,$P(XX21,"^",2)["inactive" S Y="@344";I XX21<0,XXE21'?1N.N S Y="@99";S:XX21<0 XX21=XXE21;44.21////^S X=+XX21;@345;S XSP="PROC22";S XXE22=$P($G(^FBAAI(DA,"PROC")),"^",22);S XX22=$$ENICD9^FBICDP(EDATE,XSP,"N","Y","N",XXE22);
"KRN",.402,1026,"DR",1,162.5,89)
I XX22<0,$P(XX22,"^",2)["inactive" S Y="@345";I XX22<0,XXE22'?1N.N S Y="@99";S:XX22<0 XX22=XXE22;44.22////^S X=+XX22;@346;S XSP="PROC23";S XXE23=$P($G(^FBAAI(DA,"PROC")),"^",23);S XX23=$$ENICD9^FBICDP(EDATE,XSP,"N","Y","N",XXE23);
"KRN",.402,1026,"DR",1,162.5,90)
I XX23<0,$P(XX23,"^",2)["inactive" S Y="@346";I XX23<0,XXE23'?1N.N S Y="@99";S:XX23<0 XX23=XXE23;44.23////^S X=+XX23;@347;S XSP="PROC24";S XXE24=$P($G(^FBAAI(DA,"PROC")),"^",24);S XX24=$$ENICD9^FBICDP(EDATE,XSP,"N","Y","N",XXE24);
"KRN",.402,1026,"DR",1,162.5,91)
I XX24<0,$P(XX24,"^",2)["inactive" S Y="@347";I XX24<0,XXE24'?1N.N S Y="@99";S:XX24<0 XX24=XXE24;44.24////^S X=+XX24;@348;S XSP="PROC25";S XXE25=$P($G(^FBAAI(DA,"PROC")),"^",25);S XX25=$$ENICD9^FBICDP(EDATE,XSP,"N","Y","N",XXE25);
"KRN",.402,1026,"DR",1,162.5,92)
I XX25<0,$P(XX25,"^",2)["inactive" S Y="@348";I XX25<0,XXE25'?1N.N S Y="@99";S:XX25<0 XX25=XXE25;44.25////^S X=+XX25;@99;K FBPROVD;M FBPROVD=FBPROV;S FBX=$$RPROV^FBUTL8(.FBPROV,.FBPROVD);K FBPROVD;S:$D(FBPRICE) Y="@992";K FBRRMKD;
"KRN",.402,1026,"DR",1,162.5,93)
M FBRRMKD=FBRRMK;S FBX=$$RR^FBUTL4(.FBRRMK,2,,.FBRRMKD);K FBRRMKD;@992;K FBJJ,FBKK,DIE("NO^"),FBX;
"KRN",.402,1043,-1)
0^4
"KRN",.402,1043,0)
FB UNAUTHORIZED ENTER^3130312.1004^^162.7^^^3130328
"KRN",.402,1043,"%D",0)
^^1^1^2931012^^
"KRN",.402,1043,"%D",1,0)
Enter unauthorized claim
"KRN",.402,1043,"DIAB",1,1,162.715,0)
ALL
"KRN",.402,1043,"DIAB",2,0,162.7,6)
12//^S X=FBX;REQ
"KRN",.402,1043,"DIAB",4,0,162.7,6)
13//^S X=$S(FBDISP=1:FBTTO,1:"");REQ
"KRN",.402,1043,"DIAB",15,0,162.7,4)
6;REQ
"KRN",.402,1043,"DIAB",17,0,162.7,4)
9;T;DUP
"KRN",.402,1043,"DR",1,162.7)
S:'$D(FBVET)!('$D(FBVEN))!('$D(FBMASTER))!('$D(FBORDER))!('$D(FBTFROM))!('$D(FBTTO))!('$D(FBOK))!('$D(FBPR))!('$D(FBDA))!('$D(FBUC))!('$D(FBINENT)) Y="@999";2////^S X=FBVET;S:'FBVEN&(FBINENT) Y="@51";1////^S X=FBVEN;@51;
"KRN",.402,1043,"DR",1,162.7,1)
.5////^S X=FBPR;S:$G(FBFPPSC)="" Y="@513";32///^S X=FBFPPSC;@513;S:FB1725'=1 Y="@515";31////^S X=FB1725;@515;3///^S X=FBTFROM;S:'FBTTO&(FBINENT) Y="@52";4///^S X=FBTTO;@52;24////^S X=$$STATUS^FBUCUTL(FBORDER);20////^S X=FBMASTER;
"KRN",.402,1043,"DR",1,162.7,2)
27////^S X=DUZ;28///^S X=DT;S:'FBOK Y="@1";7///^S X=DT;@1;S:'FBVEN&(FBINENT) Y="@53";23;@53;.01;W:$$DTC^FBUCUTL(X,FBTTO)>90&FB1725 !!,"Warning: Claim > 90 days",!;S:FBPR=7 FBX=3,Y="@4";
"KRN",.402,1043,"DR",1,162.7,3)
S:$$DTC^FBUCUTL(DT,$S(FBPR=6!(FBPR=7):DT,1:FBTFROM))>730&'FB1725 FBX=6,Y="@4";S:$P(FBUC,U,7) Y="@999";S ICDSYS=10,IMPDATE=$$IMPDATE^FBCSV1("10D");S:FBPR=6 EDATE=$$FRDTUC^FBCSV1(FBDA);S:((FBPR=2)!(FBPR=3)) EDATE=FBTTO;
"KRN",.402,1043,"DR",1,162.7,4)
S:'EDATE EDATE=FBTFROM;S:'EDATE EDATE=DT;S:EDATE<IMPDATE ICDSYS=9;S:ICDSYS=9 Y="@85";@80;S XX1=-1;S XX1=$$ASKICD10^FBASF("ICD DIAGNOSIS","");S:XX1=-3 Y="@99";S:XX1=-1 Y="@86";5.1////^S:XX1>0 X=XX1;S Y="@86";@85;5;@86;6R~;8;9d~T~;
"KRN",.402,1043,"DR",1,162.7,5)
S:'FBOK!($D(^FBAA(162.8,"ACD",FBDA))) Y="@99";10;S FBDISP=X;10.5;S:FBDISP FBORDER=40;S Y=$S(FBDISP=1!(FBDISP=4):"@2",FBDISP=2:"@3",1:"@99");@2;S FBZDAYS=$$CDTC^FBUCUTL(+$G(^FB583(DA,0)),-731);
"KRN",.402,1043,"DR",1,162.7,6)
S FBX=$S(FBTTO>FBZDAYS&(FBTFROM<FBZDAYS):FBZDAYS,1:FBTFROM);12R~//^S X=FBX;K FBX,FBZDAYS;13R~//^S X=$S(FBDISP=1:FBTTO,1:"");S Y="@99";@3;15;S Y="@99";@4;D UNTIME^FBUCUTL(FBX);10////^S X=2;D DISAP^FBUCUTL(DA,FBX);S FBORDER=40;@99;
"KRN",.402,1043,"DR",1,162.7,7)
S:FBORDER'=40 Y="@999";24////^S X=$$STATUS^FBUCUTL(FBORDER);@999;K FBDISP,FBX;
"KRN",.402,1043,"DR",2,162.715)
.01
"KRN",.402,1047,-1)
0^6
"KRN",.402,1047,0)
FB UNAUTHORIZED UPDATE^3120910.0558^^161^^^3010719
"KRN",.402,1047,"%D",0)
^^1^1^2931012^
"KRN",.402,1047,"%D",1,0)
Enter authorization based on discharge type of unauthorized claim
"KRN",.402,1047,"DIAB",2,1,161.01,3)
.096;REQ
"KRN",.402,1047,"DIAB",3,1,161.01,3)
.097;REQ
"KRN",.402,1047,"DR",1,161)
S:'$D(FBIEN)!('$D(FBDA))!('$D(FBV))!('$D(FBDCHG))!('$D(FBUCA)) Y="@99";1///^S X="`"_+FBIEN;@99;
"KRN",.402,1047,"DR",2,161.01)
W !,"Entering authorization...",!;S:'+FBDCHG Y="@1";.06////^S X=+FBDCHG;@1;.02///^S X=$P(FBUCA,U,14);.03////^S X=$P(FBUCA,U,2);.04////^S X=$P(FBUCA,U,3);.055////^S X=FBV;.065///^S X=$P(FBUCA,U,10);
"KRN",.402,1047,"DR",2,161.01,1)
.07////^S X=$S(+$P(FBUCA,U,2)=6!(+$P(FBUCA,U,2)=7):$S(+$P(FBUCA,U,28):$$POV^FBAAUTL3(39),1:$$POV^FBAAUTL3(31)),1:$S(+$P(FBUCA,U,28):$$POV^FBAAUTL3(52),1:$$POV^FBAAUTL3("02")));I $P(FBUCA,U,13)<$$IMPDATE^FBCSV1("10D") S Y="@9";@10;
"KRN",.402,1047,"DR",2,161.01,2)
.087///^S X=$P($G(^FB583(FBDA,"DX")),U,2);S Y="@2";@9;.08///^S X=$P($G(^FB583(FBDA,"DX")),U,1);@2;.095////^S X=1;1////^S X="N";100////^S X=DUZ;101////^S X=$P(FBUCA,U,7);
"KRN",.402,1047,"DR",2,161.01,3)
W !?3,"No: ",FBDA,?15,"Treatment From: ",$$DATX^FBAAUTL($P(FBUCA,U,5)) W:$P(FBUCA,U,6) ?40,"Treatment To: ",$$DATX^FBAAUTL($P(FBUCA,U,6));.096R~;.097R~;
"KRN",.402,1048,-1)
0^5
"KRN",.402,1048,0)
FB UNAUTHORIZED EDIT^3130312.1006^@^162.7^^@^3120508
"KRN",.402,1048,"%D",0)
^^1^1^2931012^^
"KRN",.402,1048,"%D",1,0)
Modify/reopen an unauthorized claim
"KRN",.402,1048,"DIAB",1,0,162.7,7)
13;REQ
"KRN",.402,1048,"DIAB",1,1,162.715,0)
ALL
"KRN",.402,1048,"DIAB",2,0,162.7,5)
12;REQ
"KRN",.402,1048,"DR",1,162.7)
S:'$$EDOK^FBUCUTL3(DA,1) Y="@89";S:'$D(FBUCP)!('$D(FBACT)) Y="@99";S DIE("NO^")="BACKOUTOK";S:FBACT'="REO" Y=.01;21///^S X=DT;.01;S Y=$S(FBACT'="REO":"@51",$$PAY^FBUCUTL(DA,"FB583("):"@55",1:"@51");@51;.5;S FBPROG=X;
"KRN",.402,1048,"DR",1,162.7,1)
S FBX=$P($G(^FB583(DA,5)),U);S FBX=$$FPPSC^FBUTL5(1,FBX);S:FBX=-1 Y=0;S:FBX="" Y="@514";32///^S X=FBX;S Y="@516";@514;32///@;@516;K FBX;31;1;S:FBACT="REO" Y="@53";2;@53;23;S DIE("NO^")="BACK";3;4;S:((FBPROG=2)!(FBPROG=3)) EDATE=X;
"KRN",.402,1048,"DR",1,162.7,2)
S:FBPROG=6 EDATE=$$FRDTUC^FBCSV1(DA);S ICDSYS=10,IMPDATE=$$IMPDATE^FBCSV1("10D");S:EDATE<IMPDATE ICDSYS=9;S:ICDSYS=9 Y="@33";@30;S XX1=-1;S XX1=$$ASKICD10^FBASF("ICD DIAGNOSIS","");S:XX1=-1 Y="@37";W "";5.1////^S:XX1>0 X=XX1;
"KRN",.402,1048,"DR",1,162.7,3)
S Y="@37";@33;5;@37;6;8;9;@55;S DIE("NO^")="BACK";S:$$ORDER^FBUCUTL(+$P(FBUCP,U,24))=5 Y="@99";S FBDISP(0)=$G(^FB583(DA,0)),FBDISP("FRTO")=$P(FBDISP(0),U,5,6),FBDISP("FR")=$P(FBDISP("FRTO"),U),FBDISP("TO")=$P(FBDISP("FRTO"),U,2);
"KRN",.402,1048,"DR",1,162.7,4)
10;S FBDISP=X;S Y=$S(FBDISP="":"@99",'(FBDISP=1!(FBDISP=4)):"@1",1:"@10");@10;10.5;S FBZDAYS=$$CDTC^FBUCUTL($P(FBDISP(0),U),-731);S FBX=$S(FBDISP("TO")>FBZDAYS&(FBDISP("FR")<FBZDAYS):FBZDAYS,1:FBDISP("FR"));
"KRN",.402,1048,"DR",1,162.7,5)
12///^S X=$S($P(FBUCP,U,13)&($P(FBUCP,U,13)'>FBDISP("FR")):$P(FBUCP,U,13),1:FBX);12R~;K FBX,FBZDAYS;S Y=$S('$P(FBUCP,U,14):"@13",FBDISP=4&(FBDISP'=$P(FBUCP,U,11)):"@12",FBDISP=4:"@13",1:"@11");@11;
"KRN",.402,1048,"DR",1,162.7,6)
13///^S X=$S($P(FBUCP,U,14)&($P(FBUCP,U,14)'>FBDISP("TO")):$P(FBUCP,U,14),1:FBDISP("TO"));S Y="@13";@12;13///@;@13;13///^S X=$S(FBDISP=1&($P(FBUCP,U,14))&($P(FBUCP,U,14)'>FBDISP("TO")):$P(FBUCP,U,14),FBDISP=1:FBDISP("TO"),1:"");
"KRN",.402,1048,"DR",1,162.7,7)
13R~;@89;S Y="@99";@1;10.5;15;12///@;13///@;14///@;@99;K FBDISP,DIE("NO^");
"KRN",.402,1048,"DR",2,162.715)
.01
"KRN",.402,1053,-1)
0^8
"KRN",.402,1053,0)
FB UNAUTHORIZED PREVIOUS^3120910.0633^@^162.7^^@^2930610
"KRN",.402,1053,"%D",0)
^^1^1^2931012^
"KRN",.402,1053,"%D",1,0)
Return previous values due to incomplete transaction
"KRN",.402,1053,"DR",1,162.7)
S:'$D(FBACT)!('$D(FBUCP))!('$D(FBUCPA))!('$D(FBUCA))!('$D(FBUCAA)) Y="@99";S:FBUCP=FBUCA&(FBUCPA=FBUCAA) Y="@99";S Y=$S(FBACT="EDT"!(FBACT="REO"):"@3",FBACT="APL"!(FBACT="AED"):"@2",FBACT="DIS":"@5",FBACT="BVA":"@1",1:"@99");@1;
"KRN",.402,1053,"DR",1,162.7,1)
S FBX=$S($P(FBUCPA,U,5)]"":$P(FBUCPA,U,5),1:"@");54///^S X=FBX;S FBX=$S($P(FBUCPA,U,6)]"":$P(FBUCPA,U,6),1:"@");55///^S X=FBX;S:$P(FBUCAA,U,6) Y="@5";S Y="@99";@2;S FBX=$S($P(FBUCPA,U)]"":$P(FBUCPA,U),1:"@");50///^S X=FBX;
"KRN",.402,1053,"DR",1,162.7,2)
S FBX=$S($P(FBUCPA,U,2)]"":$P(FBUCPA,U,2),1:"@");51///^S X=FBX;S FBX=$S($P(FBUCPA,U,3)]"":$P(FBUCPA,U,3),1:"@");52///^S X=FBX;S FBX=$S($P(FBUCPA,U,4)]"":$P(FBUCPA,U,4),1:"@");53///^S X=FBX;S:$P(FBUCAA,U,4) Y="@5";S Y="@99";@3;
"KRN",.402,1053,"DR",1,162.7,3)
S FBX=$P(FBUCP,U);.01///^S X=FBX;S FBX=$S($P(FBUCP,U,2)]"":$P(FBUCP,U,2),1:"@");.5////^S X=FBX;S FBX=$S($P(FBUCP,U,3)]"":$P(FBUCP,U,3),1:"@");1////^S X=FBX;S FBX=$S($P(FBUCP,U,4)]"":$P(FBUCP,U,4),1:"@");2////^S X=FBX;
"KRN",.402,1053,"DR",1,162.7,4)
S FBX=$S($P(FBUCP,U,5)]"":$P(FBUCP,U,5),1:"@");3///^S X=FBX;S FBTFRDT=FBX;S FBX=$S($P(FBUCP,U,6)]"":$P(FBUCP,U,6),1:"@");4///^S X=FBX;S:'$D(FBUCPDX) Y="@4";I FBTFRDT<$$IMPDATE^FBCSV1("10D") S Y="@9";@10;S FBX=$P(FBUCPDX,U,2);
"KRN",.402,1053,"DR",1,162.7,5)
S FBX=$S(FBUCPDX]"":FBUCPDX,1:"@");5.1///^S X=FBX;S Y="@4";@9;S FBX=$P(FBUCPDX,U,1);S FBX=$S(FBUCPDX]"":FBUCPDX,1:"@");5///^S X=FBX;@4;S FBX=$S($P(FBUCP,U,7)]"":$P(FBUCP,U,7),1:"@");6////^S X=FBX;
"KRN",.402,1053,"DR",1,162.7,6)
S FBX=$S($P(FBUCP,U,9)]"":$P(FBUCP,U,9),1:"@");8///^S X=FBX;S FBX=$S($P(FBUCP,U,10)]"":$P(FBUCP,U,10),1:"@");9///^S X=FBX;S FBX=$S($P(FBUCP,U,21)]"":$P(FBUCP,U,21),1:"@");21///^S X=FBX;
"KRN",.402,1053,"DR",1,162.7,7)
S FBX=$S($P(FBUCP,U,23)]"":$P(FBUCP,U,23),1:"@");23///^S X=FBX;@5;S:$P(FBUCP,U,11)=$P(FBUCA,U,11) Y="@99";S FBX=$S($P(FBUCP,U,11)]"":$P(FBUCP,U,11),1:"@");10////^S X=FBX;S FBX=$S($P(FBUCP,U,13)]"":$P(FBUCP,U,13),1:"@");
"KRN",.402,1053,"DR",1,162.7,8)
12///^S X=FBX;S FBX=$S($P(FBUCP,U,14)]"":$P(FBUCP,U,14),1:"@");13///^S X=FBX;S:$P(FBUCA,U,11)=1!($P(FBUCA,U,11)=4) Y="@99";D DELDAP^FBUCUTL3(DA);@99;K FBX;
"KRN",.402,1058,-1)
0^7
"KRN",.402,1058,0)
FB UNAUTHORIZED UPDATE1^3120910.0601^^161^^^3010621
"KRN",.402,1058,"%D",0)
^^1^1^2931013^^
"KRN",.402,1058,"%D",1,0)
Update authorization based on changes to unauthorized claim
"KRN",.402,1058,"DR",1,161)
S:'$D(FBIEN)!('$D(FBDA))!('$D(FBV))!('$D(FBUCA)) Y="@99";1///^S X="`"_+FBIEN;@99;
"KRN",.402,1058,"DR",2,161.01)
W !,"Updating authorization...",!;.01///^S X=$P(FBUCA,U,13);.02///^S X=$P(FBUCA,U,14);.03////^S X=$P(FBUCA,U,2);.04////^S X=$P(FBUCA,U,3);.055////^S X=FBV;.065///^S X=$P(FBUCA,U,10);
"KRN",.402,1058,"DR",2,161.01,1)
.07////^S X=$S(+$P(FBUCA,U,2)=6!(+$P(FBUCA,U,2)=7):$S(+$P(FBUCA,U,28):$$POV^FBAAUTL3(39),1:$$POV^FBAAUTL3(31)),1:$S(+$P(FBUCA,U,28):$$POV^FBAAUTL3(52),1:$$POV^FBAAUTL3("02")));I $P(FBUCA,U,13)<$$IMPDATE^FBCSV1("10D") S Y="@9";@10;
"KRN",.402,1058,"DR",2,161.01,2)
.087///^S X=$P($G(^FB583(FBDA,"DX")),U,2);S Y="@2";@9;.08///^S X=$P($G(^FB583(FBDA,"DX")),U,1);@2;.095////^S X=1;1///^S X="N";
"MBREQ")
0
"ORD",7,.402)
.402;7;;;EDEOUT^DIFROMSO(.402,DA,"",XPDA);FPRE^DIFROMSI(.402,"",XPDA);EPRE^DIFROMSI(.402,DA,$E("N",$G(XPDNEW)),XPDA,"",OLDA);;EPOST^DIFROMSI(.402,DA,"",XPDA);DEL^DIFROMSK(.402,"",%)
"ORD",7,.402,0)
INPUT TEMPLATE
"PKG",114,-1)
1^1
"PKG",114,0)
FEE BASIS^FB^Used to pay private vendors
"PKG",114,20,0)
^9.402P^1^1
"PKG",114,20,1,0)
2^^FBPMRG
"PKG",114,20,1,1)

"PKG",114,20,"B",2,1)

"PKG",114,22,0)
^9.49I^1^1
"PKG",114,22,1,0)
3.5^2950130^2960822
"PKG",114,22,1,"PAH",1,0)
139^3140917^123457024
"PKG",114,22,1,"PAH",1,1,0)
^^24^24^3140917
"PKG",114,22,1,"PAH",1,1,1,0)
Description:
"PKG",114,22,1,"PAH",1,1,2,0)
===========
"PKG",114,22,1,"PAH",1,1,3,0)
 
"PKG",114,22,1,"PAH",1,1,4,0)
The International Classification of Diseases, Tenth Revision (ICD-10) 
"PKG",114,22,1,"PAH",1,1,5,0)
Class 1 Software Remediation project replaces the 30-year-old set of 
"PKG",114,22,1,"PAH",1,1,6,0)
diagnosis and procedure codes (ICD-9-CM) that medical personnel use. 
"PKG",114,22,1,"PAH",1,1,7,0)
Dates of service, or dates of discharge for inpatients, that occur on or 
"PKG",114,22,1,"PAH",1,1,8,0)
after the implementation date will use the ICD-10 code set. Clinical 
"PKG",114,22,1,"PAH",1,1,9,0)
Modification (ICD-10-CM) diagnosis codes increase from about 13,000 ICD-9 
"PKG",114,22,1,"PAH",1,1,10,0)
codes to more than 68,000. Procedure Coding System (ICD-10-PCS) procedure 
"PKG",114,22,1,"PAH",1,1,11,0)
codes increase from about 3,800 ICD-9 codes to nearly 87,000. Both 
"PKG",114,22,1,"PAH",1,1,12,0)
systems also expand the number of characters allotted to seven 
"PKG",114,22,1,"PAH",1,1,13,0)
alpha-numeric characters. This value does not include the decimal point, 
"PKG",114,22,1,"PAH",1,1,14,0)
which follows the third character for the ICD-10-CM code set. There is no 
"PKG",114,22,1,"PAH",1,1,15,0)
decimal point in the ICD-10-PCS code set.
"PKG",114,22,1,"PAH",1,1,16,0)
 
"PKG",114,22,1,"PAH",1,1,17,0)
These code sets have the potential to reveal more about quality of care, 
"PKG",114,22,1,"PAH",1,1,18,0)
so that data can be used in a more meaningful way to better understand 
"PKG",114,22,1,"PAH",1,1,19,0)
complications, better design clinically robust algorithms, and better 
"PKG",114,22,1,"PAH",1,1,20,0)
track the outcomes of care. ICD-10-CM also incorporates greater 
"PKG",114,22,1,"PAH",1,1,21,0)
specificity and clinical detail to provide information for clinical 
"PKG",114,22,1,"PAH",1,1,22,0)
decision making and outcomes research.
"PKG",114,22,1,"PAH",1,1,23,0)
 
"PKG",114,22,1,"PAH",1,1,24,0)
This patch is to implement ICD-10 Remediation for Fee Basis.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
24
"RTN","FBAA79")
0^21^B25821677^B22692839
"RTN","FBAA79",1,0)
FBAA79 ;AISC/GRR - PRINT FORM 7079 REQUEST FOR OUTPATIENT MEDICAL SERVICES ;6/5/2009
"RTN","FBAA79",2,0)
 ;;3.5;FEE BASIS;**12,23,101,103,108,139**;JAN 30, 1995;Build 127
"RTN","FBAA79",3,0)
 ;;Per VA Directive 6402, this routine should not be modified. 
"RTN","FBAA79",4,0)
 ;
"RTN","FBAA79",5,0)
 ; Reference to API $$CODEC^ICDEX supported by ICR #5747
"RTN","FBAA79",6,0)
 ;
"RTN","FBAA79",7,0)
 W !,"Print 7079's for: " D DT^DICRW,DATE^FBAAUTL G:FBPOP END D SITEP^FBAAUTL G:FBPOP END
"RTN","FBAA79",8,0)
 I '$D(^FBAAA("AF",2)) W !!,*7,"There are no 7079's to be printed!",! G END
"RTN","FBAA79",9,0)
 S FBAASCR=""
"RTN","FBAA79",10,0)
RDHOW W ! S DIR("A")="Want only those that have not yet been printed",DIR("B")="Yes",DIR(0)="Y" D ^DIR K DIR G END:$D(DIRUT) S:Y FBAASCR="Y"
"RTN","FBAA79",11,0)
 D OUTPUT^FBAAS79
"RTN","FBAA79",12,0)
 S VAR="BEGDATE^ENDDATE^FBAASCR",VAL=BEGDATE_"^"_ENDDATE_"^"_FBAASCR,PGM="START^FBAA79",IOP="Q" D ZIS^FBAAUTL G:FBPOP END
"RTN","FBAA79",13,0)
START D SITEP^FBAAUTL G END:FBPOP
"RTN","FBAA79",14,0)
 S UL="",ULL="----------",FBPG=0 F Z=1:1:12 S UL=UL_ULL
"RTN","FBAA79",15,0)
 U IO S FBAASCR=$S(FBAASCR="":"I 1",FBAASCR="Y":"I $S('$D(^FBAAA(DFN,1,FBK,1)):1,$P(^FBAAA(DFN,1,FBK,1),""^"",2)']"""":1,1:0)",1:"I 1")
"RTN","FBAA79",16,0)
 S FBJ=BEGDATE-.001,(DFN,FBK)=0 F ZZ=0:0 S FBJ=$O(^FBAAA("AF",2,FBJ)) Q:FBJ'>0!(FBJ>ENDDATE)  F  S DFN=$O(^FBAAA("AF",2,FBJ,DFN)) Q:DFN'>0  F  S FBK=$O(^FBAAA("AF",2,FBJ,DFN,FBK)) Q:FBK'>0  X FBAASCR I  D GOT
"RTN","FBAA79",17,0)
END K FBJ,FBK,DFN,Z,FBS,V,FBI,FBPATT,FBPG,FBSITE,UL,ULL,POV,NOV,POS,CC,PSTCD,SSTCD,VSTCD,BEGDATE,ENDDATE,PIDC,REF,VDX,CODE,STATCD,D,FBAASCR,FBDX,FBIDC,FBOUT,FBPDX,FBREM,FBRR,NAME,PGM,POW,VAL,VAR,VFN,VFROM,VTO,YOB,ZZ
"RTN","FBAA79",18,0)
 K FB7078,FBAABDT,FBAAEDT,FBASSOC,FBLOC,FBPOV,FBPSA,FBPT,FBTT,FBTYPE,FBVEN,FTP,CNT,FBAAOUT,FBAUT,FBPROG,I,J,M,PI,Q,SEX,SSN,TA,DATE,S,Y,DA,DIC
"RTN","FBAA79",19,0)
 D GETAUTHK^FBAAUTL1
"RTN","FBAA79",20,0)
 D CLOSE^FBAAUTL Q
"RTN","FBAA79",21,0)
 Q
"RTN","FBAA79",22,0)
 ;
"RTN","FBAA79",23,0)
 ; Utilize new API for Name Standardization
"RTN","FBAA79",24,0)
 ;
"RTN","FBAA79",25,0)
GOT Q:'$D(^DPT(DFN,0))
"RTN","FBAA79",26,0)
 S Y(0)=^DPT(DFN,0)
"RTN","FBAA79",27,0)
 D
"RTN","FBAA79",28,0)
 .N FBNAMES
"RTN","FBAA79",29,0)
 .S FBNAMES("FILE")=2,FBNAMES("IENS")=DFN_",",FBNAMES("FIELD")=.01
"RTN","FBAA79",30,0)
 .S NAME=$$NAMEFMT^XLFNAME(.FBNAMES)
"RTN","FBAA79",31,0)
 S SEX=$P(Y(0),U,2)
"RTN","FBAA79",32,0)
 S SSN=$TR($$SSNL4^FBAAUTL($$SSN^FBAAUTL(DFN)),"-",""),YOB=$S($P(Y(0),U,3)]"":$E($P(Y(0),U,3),1,3)+1700,1:""),POS=$S($D(^DPT(DFN,.32)):$P(^(.32),"^",3),1:""),POS=$S(POS]"":$P(^DIC(21,POS,0),"^",3),1:"")
"RTN","FBAA79",33,0)
 F I=1:1:7 S FBI(I)=""
"RTN","FBAA79",34,0)
 I $D(^DPT(DFN,.11)) F I=1:1:7 S FBI(I)=$P(^(.11),"^",I)
"RTN","FBAA79",35,0)
 S POW=$P($G(^DPT(DFN,.52)),"^",5)
"RTN","FBAA79",36,0)
 Q:'$D(^FBAAA(DFN,1,FBK))  S Y(0)=^(FBK,0),VFROM=$P(Y(0),"^",1),VTO=$P(Y(0),"^",2),VFN=$P(Y(0),"^",4) I $S($P(Y(0),"^",3)=6:1,$P(Y(0),"^",3)=7:1,1:"") Q
"RTN","FBAA79",37,0)
 S VDX=$P(Y(0),"^",8),FBPATT=$P(Y(0),"^",18),POV=$$EXTPV^FBAAUTL5($P(Y(0),"^",7)),CODE=$P(Y(0),"^",13),PIDC=$P(Y(0),"^",12),REF=$P(Y(0),"^",21)
"RTN","FBAA79",38,0)
 S NOV=$P($G(^FBAAA(DFN,1,FBK,1)),"^")
"RTN","FBAA79",39,0)
 ;DEM;139 ICD-10 Project - Set variable VDX=ICD DIAGNOSIS code from ICD DIAGNOSIS FILE (#80).
"RTN","FBAA79",40,0)
 D:$P($G(^FBAAA(DFN,1,FBK,"C")),"^",2)  ;ICD DIAGNOSIS field (POINTER TO ICD DIAGNOSIS FILE (#80)).
"RTN","FBAA79",41,0)
 . S VDX=$P($G(^FBAAA(DFN,1,FBK,"C")),"^",2)  ;ICD DIAGNOSIS field (POINTER TO ICD DIAGNOSIS FILE (#80)).
"RTN","FBAA79",42,0)
 . S VDX=$$CODEC^ICDEX(80,VDX)  ;Diagnosis Code from an IEN.
"RTN","FBAA79",43,0)
 . I +VDX<0 S VDX="" Q  ; -1 ^ message on error.
"RTN","FBAA79",44,0)
 . Q
"RTN","FBAA79",45,0)
 S FBDX=$G(^FBAAA(DFN,1,FBK,3))
"RTN","FBAA79",46,0)
 S FBIDC=$P($G(^FBAAA(DFN,4)),"^")
"RTN","FBAA79",47,0)
 S STATCD=FBI(5),CC=FBI(7) F V=1:1:14 S V(V)=""
"RTN","FBAA79",48,0)
 S CC=$S(CC']"":"",$D(^DIC(5,+STATCD,1,CC,0)):$P(^(0),"^",3),1:"")
"RTN","FBAA79",49,0)
 S Y(0)=$S(VFN']"":"",'$D(^FBAAV(VFN,0)):"",$D(^FBAAV(VFN,0)):^(0),1:"") G:$S(VFN']"":1,'$D(^FBAAV(VFN,0)):1,1:0) OVR
"RTN","FBAA79",50,0)
 F V=2,1,3,14,4,5,6,10 S V(V)=$P(Y(0),"^",V)
"RTN","FBAA79",51,0)
OVR F S=1:1:9 S FBS(S)=$P(FBSITE(0),"^",S)
"RTN","FBAA79",52,0)
 S VSTCD=$S(V(5)']"":"  ",$D(^DIC(5,V(5),0)):$P(^(0),"^",2),1:"  "),SSTCD=$S(FBS(5)']"":"  ",$D(^DIC(5,+FBS(5),0)):$P(^(0),"^",2),1:"  "),PSTCD=$S(FBI(5)']"":"  ",$D(^DIC(5,+FBI(5),0)):$P(^(0),"^",2),1:"  ")
"RTN","FBAA79",53,0)
 W:FBPG @IOF W UL,!,?46,"Department of Veterans Affairs",?100,"ID Card Number: ",FBIDC,!,?35,"R E Q U E S T   F O R   O U T P A T I E N T   S E R V I C E S",!,UL S FBREM=0,FBOUT=0
"RTN","FBAA79",54,0)
 ;
"RTN","FBAA79",55,0)
 W !,"(1) Veterans Name",?31,"|(2) ID Number | Period of Validity",!,?31,"|",?46,"|"
"RTN","FBAA79",56,0)
 W !,NAME,?31,"|",?32,SSN,?46,"|"," FROM: ",$$FMTE^XLFDT(VFROM),"   TO: ",$$FMTE^XLFDT(VTO),!,UL
"RTN","FBAA79",57,0)
 W !,"(3) ADDRESS",?31,"|DATE OF ISSUE",?46,"| CONDITIONS FOR WHICH SERVICES ARE REQUESTED (DESCRIPTION OF DISABILITY)",!,?31,"|",?46,"|"
"RTN","FBAA79",58,0)
 W !,FBI(1),?31,"|",?33,$$FMTE^XLFDT(FBJ),?46,"|","  ",VDX S FBPDX=0
"RTN","FBAA79",59,0)
 I FBI(2)]"" W !,FBI(2),?31,"|",?46,"|","  " S FBPDX=FBPDX+1 W ?48,$P(FBDX,"^",FBPDX)
"RTN","FBAA79",60,0)
 I FBI(3)]"" W !,FBI(3),?31,"|",?46,"|","  " S FBPDX=FBPDX+1 W ?48,$P(FBDX,"^",FBPDX)
"RTN","FBAA79",61,0)
 W !,FBI(4)," ",PSTCD," ",FBI(6),?31,"|",?46,"|" S FBPDX=FBPDX+1 W ?48,$P(FBDX,"^",FBPDX),!,$E(UL,1,45),?46,"|" S FBPDX=FBPDX+1 W ?48,$P(FBDX,"^",FBPDX)
"RTN","FBAA79",62,0)
 W !,"Name and Address of Fee Participant",?46,"|" S FBPDX=FBPDX+1 W ?48,$P(FBDX,"^",FBPDX)
"RTN","FBAA79",63,0)
 W !,?46,"|",!,V(1),?46,"|",!,V(3),?46,"|" W:V(14)]"" !,V(14),?46,"|"
"RTN","FBAA79",64,0)
 ; PRXM/KJH - Patch 103. Add Referring Provider and NPI to the display.
"RTN","FBAA79",65,0)
 W !,V(4)," ",VSTCD," ",V(6),?46,"|","REFERRING PROVIDER: "
"RTN","FBAA79",66,0)
 I REF'="" W $$GET1^DIQ(200,REF,.01)
"RTN","FBAA79",67,0)
 W !,V(2),?46,"|","NPI: ",$$REFNPI^FBCH78(REF,"",1)
"RTN","FBAA79",68,0)
 W !,?46,"|","AUTHORIZATION #: ",DFN,"-",FBK,!,UL,!
"RTN","FBAA79",69,0)
 W ?49,"AUTHORIZATION REMARKS",!,?49,$E(UL,1,21)
"RTN","FBAA79",70,0)
 D ^FBAA79A S $P(^FBAAA(DFN,1,FBK,1),"^",2)=DT,FBPG=1 Q
"RTN","FBAACO2")
0^8^B29842500^B14623021
"RTN","FBAACO2",1,0)
FBAACO2 ;AISC/GRR - PAYMENT PROCESS FOR DUPLICATE ;7/13/2003
"RTN","FBAACO2",2,0)
 ;;3.5;FEE BASIS;**4,55,61,77,116,122,133,108,135,139**;JAN 30, 1995;Build 127
"RTN","FBAACO2",3,0)
 ;;Per VA Directive 6402, this routine should not be modified.
"RTN","FBAACO2",4,0)
RD S DIR(0)="Y",DIR("A")="Want this payment stored as a Medical Denial",DIR("B")="YES",DIR("?")="Enter 'Yes' to store payment entry as a denial and send a Suspension letter.  Enter 'No' to have nothing happen." D ^DIR K DIR Q:$D(DIRUT)!('Y)
"RTN","FBAACO2",5,0)
 S FBDEN=1 Q
"RTN","FBAACO2",6,0)
FILE ;files sp multiple entry
"RTN","FBAACO2",7,0)
 K DR S TP="" I $G(FBDEN) S FBAMTPD=0
"RTN","FBAACO2",8,0)
 S DR="49///^S X=$G(FBCSID);50///^S X=$G(FBFPPSC);81///^S X=$G(FBUCI135);I $G(FBDEN) S Y=1;48;47//1;S FBUNITS=X;S:$G(FBFPPSC)="""" Y=""@11"";S FBX=$$FPPSL^FBUTL5();S:FBX=-1 Y=0;51///^S X=FBX;@11"
"RTN","FBAACO2",9,0)
 ; fb*3.5*116 do not enable different interest indicator values at line item level; interest indicator set at invoice level
"RTN","FBAACO2",10,0)
 ;S DR(1,162.03,1)="D PPT^FBAACO1();34///^S X=$G(FBAAMM1);D POS^FBAACO1;S:'$G(FBHCFA(30)) Y=0;1;S J=X;I $G(FBDEN) S Y=2;D FEE^FBAACO0;44////^S X=FBFSAMT;45///^S X=FBFSUSD;2///^S X=FBAMTPD;S K=X"
"RTN","FBAACO2",11,0)
 S DR(1,162.03,1)="34///^S X=$G(FBAAMM);D POS^FBAACO1;S:'$G(FBHCFA(30)) Y=0;1;S J=X;I $G(FBDEN) S Y=2;D FEE^FBAACO0;44////^S X=FBFSAMT;45///^S X=FBFSUSD;2///^S X=FBAMTPD;S K=X"
"RTN","FBAACO2",12,0)
 ;S DR(1,162.03,2)="S:J-K=0 Y=6;3//^S X=$S(J-K:J-K,1:"""");S:'X Y=6;3.5///^S X=DT;@4;4;I X']"""" D SC^FBAACO3;S:X'=4 Y=6;22;6////^S X=DUZ"
"RTN","FBAACO2",13,0)
 S DR(1,162.03,2)="S FBX=$$ADJ^FBUTL2(J-K,.FBADJ,2);S:FBX=0 Y=0;6////^S X=DUZ"
"RTN","FBAACO2",14,0)
 S DR(1,162.03,3)="7////^S X=FBAABE;8////^S X=BO;13///^S X=FBAAID;14///^S X=FBAAIN;33///^S X=FBAAVID;I $G(FBDEN) S FBTST=1"
"RTN","FBAACO2",15,0)
 I '$G(FBDEN) D
"RTN","FBAACO2",16,0)
 . ; FB*3.5*139-JLG/JAS-ICD10 REMEDIATION - Made modifications to DR strings for ICD-10, added FBDXCHK1 and FBDXCHK2 for this
"RTN","FBAACO2",17,0)
 .N FBCSVSTR S FBCSVSTR="I X]"""" S:$$INPICD9^FBCSV1(X,"""",$G(FBAADT)) Y=""@30"";"
"RTN","FBAACO2",18,0)
 .N FBDXCHK1 S FBDXCHK1=";@20;S XX1=-1 S XX1=$$FBDXCHK^FBAACO2(FBAADT) S:XX1<0 Y=""@20"";28///^S X=XX1;S Y=""@6"";"
"RTN","FBAACO2",19,0)
 .N FBDXCHK2 S FBDXCHK2=";@25;S XX1=-1 S XX1=$$FBDXCHK^FBAACO2(FBAADT) S:XX1<0 Y=""@25"";28///^S X=XX1;S Y=""@35"";@30;"
"RTN","FBAACO2",20,0)
 .S DR(1,162.03,4)="S:$$EXTPV^FBAAUTL5(FBPOV)=""01"" Y=""@1"";S:FB7078]""""!($D(FB583)) Y=30"_FBDXCHK1_"@6;30////^S X=FBHCFA(30);"
"RTN","FBAACO2",21,0)
 .S DR(1,162.03,5)="31;32R;S Y=15;@1"_FBDXCHK2_FBCSVSTR_"@35;30////^S X=FBHCFA(30);31;15///^S X=FBPT;S FBX=$$RR^FBUTL4(.FBRRMK,2);S:FBX=0 Y=0"
"RTN","FBAACO2",22,0)
 . ;end 139
"RTN","FBAACO2",23,0)
 .S DR(1,162.03,6)="16////^S X=FBPOV;17///^S X=FBTT;18///^S X=FBAAPTC;23////^S X=FBTYPE;26////^S X=FBPSA;S:$D(FBV583) Y=""@2"";27////^S X=FB7078;S Y=""@99"";@2;27////^S X=FBV583;@99;S FBTST=1;54////^S X=FBCNTRP"
"RTN","FBAACO2",24,0)
 .S DR(1,162.03,7)="73;74;75;58;59;60;61;62;63;64;65;66;67;76;77;78;79;68;69" ;FB*3.5*122 Line Item Provider information ;FB*3.5*133 Provider Information
"RTN","FBAACO2",25,0)
 S DIE="^FBAAC("_DFN_",1,"_FBV_",1,"_FBSDI_",1,"
"RTN","FBAACO2",26,0)
 S DA(3)=DFN,DA(2)=FBV,DA(1)=FBSDI,DA=FBAACPI
"RTN","FBAACO2",27,0)
 D LOCK^FBUCUTL("^FBAAC("_DFN_",1,"_FBV_",1,"_FBSDI_",1,",FBAACPI,1)
"RTN","FBAACO2",28,0)
 D
"RTN","FBAACO2",29,0)
 . N ICDVDT S ICDVDT=$G(FBAADT) D ^DIE
"RTN","FBAACO2",30,0)
 I '$D(DTOUT),$G(FBTST) D
"RTN","FBAACO2",31,0)
 . D FILEADJ^FBAAFA(FBAACPI_","_FBSDI_","_FBV_","_DFN_",",.FBADJ)
"RTN","FBAACO2",32,0)
 . D FILERR^FBAAFR(FBAACPI_","_FBSDI_","_FBV_","_DFN_",",.FBRRMK)
"RTN","FBAACO2",33,0)
 L -^FBAAC(DFN,1,FBV,1,FBSDI,1,FBAACPI)
"RTN","FBAACO2",34,0)
 I $D(DTOUT) D KILL Q
"RTN","FBAACO2",35,0)
 I '$G(FBTST),$G(DA) S DIR(0)="YA",DIR("A")="Entering an '^' will delete "_$S($G(FBDEN):"denial",1:"payment")_".  Are you sure you want to delete? ",DIR("B")="No" D ^DIR K DIR G FILE:'$D(DIRUT)&('Y) D KILL Q
"RTN","FBAACO2",36,0)
 K FBTST,FBDEN,DIE,DR,DA,FBX
"RTN","FBAACO2",37,0)
 I $D(FBDL) S FBAAOUT=1 Q
"RTN","FBAACO2",38,0)
 Q
"RTN","FBAACO2",39,0)
 ;
"RTN","FBAACO2",40,0)
FBDXCHK(FBAADT) ;DEM;139 Call to ASF if ICD-10.
"RTN","FBAACO2",41,0)
 ;
"RTN","FBAACO2",42,0)
 ; This call checks if the payment diagnosis date to
"RTN","FBAACO2",43,0)
 ; determine if diagnosis code is ICD-9 or ICD-10.
"RTN","FBAACO2",44,0)
 ; If ICD-9, then call ICD-9 code enhanced for inactive code checks.
"RTN","FBAACO2",45,0)
 ; Else, call Advanced Search Functionality (ASF).
"RTN","FBAACO2",46,0)
 ; If user enters "^" to exit, then quit and send calling
"RTN","FBAACO2",47,0)
 ; routine 999 for exit.
"RTN","FBAACO2",48,0)
 ;
"RTN","FBAACO2",49,0)
 ; If no ICD-10 data found, then send calling routine -1 
"RTN","FBAACO2",50,0)
 ; to indicate no data found.
"RTN","FBAACO2",51,0)
 ; If data found, then stuff diagnosis into ICD DIAGNOSIS
"RTN","FBAACO2",52,0)
 ; field, and quit and send the calling routine 10 for ICD-10 code.
"RTN","FBAACO2",53,0)
 ;
"RTN","FBAACO2",54,0)
 ; Input:
"RTN","FBAACO2",55,0)
 ; FBAADT = Date of Interest for FB payments.
"RTN","FBAACO2",56,0)
 ;
"RTN","FBAACO2",57,0)
 ; Output:
"RTN","FBAACO2",58,0)
 ; FB9 = ICD-9 diagnosis
"RTN","FBAACO2",59,0)
 ; FB99 = User entered "^" to exit payment edit.
"RTN","FBAACO2",60,0)
 ; -1 = No ICD-10 data found
"RTN","FBAACO2",61,0)
 ; FB10 = ICD-10 diagnosis 
"RTN","FBAACO2",62,0)
 ;
"RTN","FBAACO2",63,0)
 N ICDSYS,IMPDATE,XX1
"RTN","FBAACO2",64,0)
 S ICDSYS=10,IMPDATE=$$IMPDATE^LEXU("10D")
"RTN","FBAACO2",65,0)
 S:FBAADT<IMPDATE ICDSYS=9
"RTN","FBAACO2",66,0)
 S XX1=-1
"RTN","FBAACO2",67,0)
 I ICDSYS=9 S XX1=$$ASKICD9^FBAACO2(FBAADT) Q XX1  ;ICD-9
"RTN","FBAACO2",68,0)
 S XX1=$$ASKICD10^FBAACO2(FBAADT) Q XX1  ;ICD-10 IEN CODE
"RTN","FBAACO2",69,0)
 ;
"RTN","FBAACO2",70,0)
 ; retrieves existing value in db if exists and prompts user for ICD-9 primary diagnosis 
"RTN","FBAACO2",71,0)
ASKICD9(INDT,FBFREQ) ;FB*3.5*139-JAS-ICD10 REMEDIATION
"RTN","FBAACO2",72,0)
 N DPRMPT,FBDX
"RTN","FBAACO2",73,0)
 S EDATE=INDT  ; edate is the date of interest for ICD10 diagnosis code lookup
"RTN","FBAACO2",74,0)
 I $G(FBFREQ)="" S FBFREQ="N"  ; force field to be required flag
"RTN","FBAACO2",75,0)
 N FBDXIEN
"RTN","FBAACO2",76,0)
 S DPRMPT="PRIMARY DIAGNOSIS"
"RTN","FBAACO2",77,0)
 S FBDXIEN=$P($G(^FBAAC(DFN,1,FBV,1,FBSDI,1,FBAACPI,0)),U,23) ; retrieve existing DX ien 
"RTN","FBAACO2",78,0)
 ;S:FBDXIEN>0 DPRMPT=DPRMPT_": "_$$ICD9^FBCSV1(FBDXIEN,EDATE)_"// "  ;obtain current diagnosis and set as default
"RTN","FBAACO2",79,0)
 S FBDX=-1 S FBDX=$$ENICD9^FBICD9(EDATE,DPRMPT,"Y","","Y",FBDXIEN)
"RTN","FBAACO2",80,0)
 I FBDXIEN>0,FBDX=-1 S FBDX=FBDXIEN W $$ICD9^FBCSV1(FBDXIEN,EDATE) ; return default value if spaces entered
"RTN","FBAACO2",81,0)
 K EDATE,INDT
"RTN","FBAACO2",82,0)
 S FBDX=+FBDX
"RTN","FBAACO2",83,0)
 Q FBDX
"RTN","FBAACO2",84,0)
 ;
"RTN","FBAACO2",85,0)
 ; retrieves existing value in db if exists and prompts user for ICD-10 primary diagnosis 
"RTN","FBAACO2",86,0)
ASKICD10(INDT,FBFREQ) ;FB*3.5*139-JLG-ICD10 REMEDIATION
"RTN","FBAACO2",87,0)
 N DP,DPRMPT,FBDCDA,FBDX
"RTN","FBAACO2",88,0)
 S EDATE=INDT  ; edate is the date of interest for ICD10 diagnosis code lookup
"RTN","FBAACO2",89,0)
 I $G(FBFREQ)="" S FBFREQ="N"  ; force field to be required flag
"RTN","FBAACO2",90,0)
 S DP=162.03   ; file number used to check if diagnosis field is required
"RTN","FBAACO2",91,0)
 S FBDCDA=DA   ; DA equals FBAACPI
"RTN","FBAACO2",92,0)
 N FBDXIEN
"RTN","FBAACO2",93,0)
 S DPRMPT="PRIMARY DIAGNOSIS"
"RTN","FBAACO2",94,0)
 S FBDXIEN=$P($G(^FBAAC(DFN,1,FBV,1,FBSDI,1,FBAACPI,0)),U,23) ; retrieve existing DX ien 
"RTN","FBAACO2",95,0)
 S:FBDXIEN>0 DPRMPT=DPRMPT_": "_$$ICD9^FBCSV1(FBDXIEN,EDATE)_"// "  ;obtain current diagnosis and set as default
"RTN","FBAACO2",96,0)
 S FBDX=-1 S FBDX=$$ASKICD10^FBASF(DPRMPT,"","","",FBFREQ) ; returns -1 or ien of icd10 diagnosis code
"RTN","FBAACO2",97,0)
 I FBDXIEN>0,FBDX=-1 S FBDX=FBDXIEN W $$ICD9^FBCSV1(FBDXIEN,EDATE) ; return default value if spaces entered
"RTN","FBAACO2",98,0)
 K EDATE,INDT
"RTN","FBAACO2",99,0)
 Q FBDX
"RTN","FBAACO2",100,0)
 ;
"RTN","FBAACO2",101,0)
KILL S DIK=DIE D ^DIK K DIE,DIK I '$G(FBCNP) D Q^FBAACO S FBAAOUT=1
"RTN","FBAACO2",102,0)
 W !,"Deleted" Q
"RTN","FBAACO3")
0^9^B60345007^B55803171
"RTN","FBAACO3",1,0)
FBAACO3 ;AISC/GRR - ENTER PAYMENT CONTINUED ;10/31/12 2:56pm
"RTN","FBAACO3",2,0)
 ;;3.5;FEE BASIS;**4,38,55,61,116,122,133,108,124,143,139**;JAN 30, 1995;Build 127
"RTN","FBAACO3",3,0)
 ;;Per VA Directive 6402, this routine should not be modified.
"RTN","FBAACO3",4,0)
DOEDIT ;
"RTN","FBAACO3",5,0)
 N FB1725,FBFPPSC
"RTN","FBAACO3",6,0)
 W ! S FBAACP(0)=FBAACP
"RTN","FBAACO3",7,0)
 S DIC="^FBAAC("_DFN_",1,"_FBV_",1,"_FBSDI_",1,"
"RTN","FBAACO3",8,0)
 S DIC(0)="EQMZ",DA(3)=DFN,DA(2)=FBV,DA(1)=FBSDI
"RTN","FBAACO3",9,0)
 S X=$$CPT^FBAAUTL4(FBAACP)
"RTN","FBAACO3",10,0)
 D ^DIC I Y<0 S FBAAOUT=1 Q
"RTN","FBAACO3",11,0)
 S (DA,FBAACPI)=+Y,K=$P(Y(0),U,3),FBZBN=$P(Y(0),U,8),FBZBS=$S(FBZBN]"":$P($G(^FBAA(161.7,FBZBN,"ST")),U),1:""),FBAAPTC=$P(Y(0),U,20),J(0)=$P(Y(0),U,2)
"RTN","FBAACO3",12,0)
 ; set FB1725 true (1) if payment is for a Mill Bill claim
"RTN","FBAACO3",13,0)
 S FB1725=$S($P(Y(0),U,13)["FB583":+$P($G(^FB583(+$P(Y(0),U,13),0)),U,28),1:0)
"RTN","FBAACO3",14,0)
 S FBAAMM1=$P($G(^FBAAC(DFN,1,FBV,1,FBSDI,1,FBAACPI,2)),U,2)
"RTN","FBAACO3",15,0)
 S FBCNTRP=$P($G(^FBAAC(DFN,1,FBV,1,FBSDI,1,FBAACPI,3)),U,8)
"RTN","FBAACO3",16,0)
 S FBFSAMT(0)=$P($G(^FBAAC(DFN,1,FBV,1,FBSDI,1,FBAACPI,2)),U,12)
"RTN","FBAACO3",17,0)
 ; determine lesser of original fee schedule amount and amount claimed
"RTN","FBAACO3",18,0)
 S FBAMTPD(0)=$S(FBFSAMT(0)="":J(0),FBFSAMT(0)>J(0):J(0),1:FBFSAMT(0))
"RTN","FBAACO3",19,0)
 S FBMODL=$$MODL^FBAAUTL4("^FBAAC("_DFN_",1,"_FBV_",1,"_FBSDI_",1,"_FBAACPI_",""M"")")
"RTN","FBAACO3",20,0)
 ; load current adjustment data
"RTN","FBAACO3",21,0)
 D LOADADJ^FBAAFA(FBAACPI_","_FBSDI_","_FBV_","_DFN_",",.FBADJ)
"RTN","FBAACO3",22,0)
 ; save adjustment data prior to edit session in sorted list
"RTN","FBAACO3",23,0)
 S FBADJL(0)=$$ADJL^FBUTL2(.FBADJ) ; sorted list of original adjustments
"RTN","FBAACO3",24,0)
 ; load current remittance remark data
"RTN","FBAACO3",25,0)
 D LOADRR^FBAAFR(FBAACPI_","_FBSDI_","_FBV_","_DFN_",",.FBRRMK)
"RTN","FBAACO3",26,0)
 ; save remittance remarks prior to edit session in sorted list
"RTN","FBAACO3",27,0)
 S FBRRMKL(0)=$$RRL^FBUTL4(.FBRRMK)
"RTN","FBAACO3",28,0)
 ; load FPPS data
"RTN","FBAACO3",29,0)
 S FBFPPSC=$P($G(^FBAAC(DFN,1,FBV,1,FBSDI,1,FBAACPI,3)),U)
"RTN","FBAACO3",30,0)
 S FBFPPSL=$P($G(^FBAAC(DFN,1,FBV,1,FBSDI,1,FBAACPI,3)),U,2)
"RTN","FBAACO3",31,0)
 I FBZBS=""!(FBZBS="V") D NOGO S FBAAOUT=1 Q
"RTN","FBAACO3",32,0)
 ; first edit CPT code and modifiers
"RTN","FBAACO3",33,0)
 D CPTM^FBAALU(FBAADT,DFN,FBAACP(0),FBMODL) I '$G(FBGOT) S FBAAOUT=1 Q
"RTN","FBAACO3",34,0)
 ; if CPT was changed then update file
"RTN","FBAACO3",35,0)
 I FBAACP'=FBAACP(0) D  I FBAACP="@" S FBAAOUT=1 Q
"RTN","FBAACO3",36,0)
 . N FBIENS,FBFDA
"RTN","FBAACO3",37,0)
 . S FBIENS=FBAACPI_","_FBSDI_","_FBV_","_DFN_","
"RTN","FBAACO3",38,0)
 . S FBFDA(162.03,FBIENS,.01)=FBAACP
"RTN","FBAACO3",39,0)
 . D FILE^DIE("","FBFDA") D MSG^DIALOG()
"RTN","FBAACO3",40,0)
 ; if modifiers changed then update file
"RTN","FBAACO3",41,0)
 I FBMODL'=$$MODL^FBAAUTL4("FBMODA") D REPMOD^FBAAUTL4(DFN,FBV,FBSDI,FBAACPI)
"RTN","FBAACO3",42,0)
 ; now edit remaining fields
"RTN","FBAACO3",43,0)
 D SETO K DR
"RTN","FBAACO3",44,0)
 ;JAS - 09/13/13 - PATCH 139 - Added FBDXCHK1 and FBDXCHK2
"RTN","FBAACO3",45,0)
 N FBDXCHK1 S FBDXCHK1=";S:FBAADT<$$IMPDATE^FBCSV1(""10D"") Y=""@20"";@15;S XX1=-1 S XX1=$$ASKICD10^FBAACO2(FBAADT) S:XX1<0 Y=""@15"";28///^S X=XX1;S Y=""@21"";"
"RTN","FBAACO3",46,0)
 S FBDXCHK1=FBDXCHK1_"@20;S XX1=$$ASKICD9^FBAACO2(FBAADT) S:+XX1<0 Y=""@20"";28////^S X=+XX1;@21;31;32R;S Y=""@7"";"
"RTN","FBAACO3",47,0)
 N FBDXCHK2 S FBDXCHK2=";S:FBAADT<$$IMPDATE^FBCSV1(""10D"") Y=""@26"";@25;S XX1=-1 S XX1=$$ASKICD10^FBAACO2(FBAADT) S:XX1<0 Y=""@25"";28///^S X=XX1;S Y=""@30"";@26;"
"RTN","FBAACO3",48,0)
 S DR="48;47;S FBUNITS=X;42R;S FBZIP=X;S:$$ANES^FBAAFS($$CPT^FBAAUTL4(FBAACP)) Y=""@2"";43///@;S FBTIME=X;S Y=""@3"";@2;43R;S FBTIME=X;@3"
"RTN","FBAACO3",49,0)
 ; fb*3.5*116 remove edit of interest indicator (162.03,34) to prevent different interest indicator values at line item level; interest indicator set at invoice level only
"RTN","FBAACO3",50,0)
 S DR(1,162.03,1)="S FBAAMM=$S(FBAAPTC=""R"":"""",1:1);D PPT^FBAACO1(FBAAMM1,FBCNTRP,1);34///@;34////^S X=FBAAMM1;54///@;54////^S X=FBCNTRP;30R;S FBHCFA(30)=X;1;S J=X;Q"
"RTN","FBAACO3",51,0)
 ;S DR(1,162.03,1)="30R;S FBHCFA(30)=X;1;S J=X;Q"
"RTN","FBAACO3",52,0)
 S DR(1,162.03,2)="D FEEDT^FBAACO3;44///@;44///^S X=FBFSAMT;45///@;45///^S X=FBFSUSD;S:FBAMTPD'>0!(FBAMTPD=FBAMTPD(0)) Y=""@4"";2///^S X=FBAMTPD;@4;2//^S X=FBAMTPD;D CHKIT^FBAACO3;S K=X"
"RTN","FBAACO3",53,0)
 ;S DR(1,162.03,3)="3//^S X=$S(J-K:J-K,1:"""");4;S:X'=4 Y=6;22;6////^S X=DUZ;13;33"
"RTN","FBAACO3",54,0)
 S DR(1,162.03,3)="K FBADJD;M FBADJD=FBADJ;S FBX=$$ADJ^FBUTL2(J-K,.FBADJ,2,,.FBADJD,1)"
"RTN","FBAACO3",55,0)
 S DR(1,162.03,4)="S:FBFPPSC="""" Y=13;W !,""FPPS CLAIM ID: ""_FBFPPSC;S FBX=$$FPPSL^FBUTL5(FBFPPSL,,1);51///^S X=FBX;S FBFPPSL=X;@13;13;I $$BADDATE^FBAACO3(FBAADT,X) S Y=""@13"";33"
"RTN","FBAACO3",56,0)
 ;JAS - 09/13/13 - PATCH 139 - Updated line below for ICD-10
"RTN","FBAACO3",57,0)
 S DR(1,162.03,5)="S:$$EXTPV^FBAAUTL5(FBPOV)=""01"" Y=""@1"";S Y=$S('$D(FB7078):""@5"",FB7078]"""":""@21"",1:""@5"");@5"_FBDXCHK1_"@1"_FBDXCHK2_"S XX1=$$ASKICD9^FBAACO2(FBAADT) S:+XX1<0 Y=""@26"";28////^S X=+XX1;@30;31"
"RTN","FBAACO3",58,0)
 S DR(1,162.03,6)="@7;K FBRRMKD;M FBRRMKD=FBRRMK;S FBX=$$RR^FBUTL4(.FBRRMK,2,,.FBRRMKD)"
"RTN","FBAACO3",59,0)
 S DR(1,162.03,7)="73;74;75;58;59;60;61;62;63;64;65;66;67;76;77;78;79;68;69"
"RTN","FBAACO3",60,0)
 S DIE="^FBAAC("_DFN_",1,"_FBV_",1,"_FBSDI_",1,",DIE("NO^")="",FBOT=1
"RTN","FBAACO3",61,0)
 D LOCK^FBUCUTL("^FBAAC("_DFN_",1,"_FBV_",1,"_FBSDI_",1,",FBAACPI) I 'FBLOCK S FBAAOUT=1 Q
"RTN","FBAACO3",62,0)
 D ^DIE
"RTN","FBAACO3",63,0)
 ; if adjustment data changed then file
"RTN","FBAACO3",64,0)
 I $$ADJL^FBUTL2(.FBADJ)'=FBADJL(0) D FILEADJ^FBAAFA(FBAACPI_","_FBSDI_","_FBV_","_DFN_",",.FBADJ)
"RTN","FBAACO3",65,0)
 ; if remit remark data changed then file
"RTN","FBAACO3",66,0)
 I $$RRL^FBUTL4(.FBRRMK)'=FBRRMKL(0) D FILERR^FBAAFR(FBAACPI_","_FBSDI_","_FBV_","_DFN_",",.FBRRMK)
"RTN","FBAACO3",67,0)
 L -^FBAAC(DFN,1,FBV,1,FBSDI,1,FBAACPI) K FBOT,DIE,DR,DA
"RTN","FBAACO3",68,0)
 Q:$D(FBDL)
"RTN","FBAACO3",69,0)
 I $G(FBAAIN) S FBINTOT=0 D CALC
"RTN","FBAACO3",70,0)
 Q
"RTN","FBAACO3",71,0)
 ;
"RTN","FBAACO3",72,0)
BADDATE(FBDOS,INVRCVDT) ;Reject entry if InvRcvDt is Prior to the Date of Service on the Invoice
"RTN","FBAACO3",73,0)
 I INVRCVDT<FBDOS D  Q 1 ;Reject entry
"RTN","FBAACO3",74,0)
 .N SHOWDOS  S SHOWDOS=$E(FBDOS,4,5)_"/"_$E(FBDOS,6,7)_"/"_$E(FBDOS,2,3) ;Convert FBDOS into display format for error message
"RTN","FBAACO3",75,0)
 .W *7,!!?5,"*** Invoice Received Date cannot be prior to the",!?8," Date of Service ("_SHOWDOS_") !!!"
"RTN","FBAACO3",76,0)
 Q 0 ;Accept entry
"RTN","FBAACO3",77,0)
 ;
"RTN","FBAACO3",78,0)
SETO S FY=$E(FBAADT,1,3)+1700+$S($E(FBAADT,4,5)>9:1,1:0)
"RTN","FBAACO3",79,0)
 Q
"RTN","FBAACO3",80,0)
OUT ;
"RTN","FBAACO3",81,0)
 ; FB*3.5*116 count line items that have 0.00 amount paid
"RTN","FBAACO3",82,0)
 ;I K>0 S Z1=$P(^FBAA(161.7,FBAABE,0),"^",11)+1,$P(^(0),"^",11)=Z1,FBINTOT=FBINTOT+K
"RTN","FBAACO3",83,0)
 S Z1=$P(^FBAA(161.7,FBAABE,0),"^",11)+1,$P(^(0),"^",11)=Z1,FBINTOT=FBINTOT+K
"RTN","FBAACO3",84,0)
 Q
"RTN","FBAACO3",85,0)
CKMAX S (FBAOT,A)=0,O="" F Z=S-.1:0 S Z=$O(^FBAAC(DFN,"AB",Z)) Q:Z'>0!(Z>R)  F Q=0:0 S Q=$O(^FBAAC(DFN,"AB",Z,Q)) Q:Q'>0  S W=$O(^FBAAC(DFN,"AB",Z,Q,0)) I $D(^FBAAC(DFN,1,Q,1,W,0)) D SMORE
"RTN","FBAACO3",86,0)
 I A>$P(FBSITE(1),"^",9) G NO
"RTN","FBAACO3",87,0)
 Q
"RTN","FBAACO3",88,0)
SMORE N FBA,FBB S FBB=$P($G(^FBAAC(+DFN,1,+Q,1,+W,0)),U,4),E=0
"RTN","FBAACO3",89,0)
 F  S E=$O(^FBAAC(DFN,1,Q,1,W,1,E)) Q:'E  S FBA=$G(^(E,0)) I $P(FBA,"^",9)=2,$P(FBA,"^",18)'=1 D
"RTN","FBAACO3",90,0)
 .I $$IDCHK^FBAAUTL3(DFN,FBB) S A=A+$P(FBA,"^",3) Q
"RTN","FBAACO3",91,0)
 .S FBAOT=FBAOT+$P(FBA,U,3)
"RTN","FBAACO3",92,0)
 Q
"RTN","FBAACO3",93,0)
NO W !!,*7,"Warning Patient already at maximum allowed for month of service",! Q
"RTN","FBAACO3",94,0)
WARN W !!,*7,"You have reached the maximum number of payments for a Batch!",!,"You must select another Batch for entering Payments!"
"RTN","FBAACO3",95,0)
CALC ;Calculate Current Invoice Total
"RTN","FBAACO3",96,0)
 F J=0:0 S J=$O(^FBAAC("C",FBAAIN,J)) Q:J'>0  F K=0:0 S K=$O(^FBAAC("C",FBAAIN,J,K)) Q:K'>0  F L=0:0 S L=$O(^FBAAC("C",FBAAIN,J,K,L)) Q:L'>0  F M=0:0 S M=$O(^FBAAC("C",FBAAIN,J,K,L,M)) Q:M'>0  D CALC1
"RTN","FBAACO3",97,0)
 K J,K,L,M,FZNODE Q
"RTN","FBAACO3",98,0)
CALC1 S FZNODE=^FBAAC(J,1,K,1,L,1,M,0),A2=$P(FZNODE,"^",3),FBINTOT=FBINTOT+A2,FBAAID=$P(FZNODE,"^",15),FBAAVID=$P($G(^FBAAC(J,1,K,1,L,1,M,2)),"^")
"RTN","FBAACO3",99,0)
 Q
"RTN","FBAACO3",100,0)
FEEDT ;
"RTN","FBAACO3",101,0)
 ;FB*3.5*143 Adding FB1725 as a parameter to prevent incorrect
"RTN","FBAACO3",102,0)
 ; reductions in local fee schedule pricing.
"RTN","FBAACO3",103,0)
 ; input FB1725 - true (=1) when edited payment is for a Mill BilL claim.
"RTN","FBAACO3",104,0)
 N FBX
"RTN","FBAACO3",105,0)
 D SETO:'$G(FY) S FBFY=FY-1
"RTN","FBAACO3",106,0)
 S (FBFSAMT,FBFSUSD)="",FBAMTPD=$G(FBAMTPD)
"RTN","FBAACO3",107,0)
 S FBX=$$GET^FBAAFS($$CPT^FBAAUTL4(FBAACP),$$MODL^FBAAUTL4("FBMODA","E"),FBAADT,$G(FBZIP),$$FAC^FBAAFS($G(FBHCFA(30))),$G(FBTIME),$G(FB1725))
"RTN","FBAACO3",108,0)
 I '$G(FBAAMM1) D
"RTN","FBAACO3",109,0)
 . S FBFSAMT=$P(FBX,U),FBFSUSD=$P(FBX,U,2)
"RTN","FBAACO3",110,0)
 E  D
"RTN","FBAACO3",111,0)
 . W !,?2,"Payment is for a contracted service so fee schedule does not apply."
"RTN","FBAACO3",112,0)
 I $P($G(FBX),U)]"" D
"RTN","FBAACO3",113,0)
 . W !?2,$S($G(FBAAMM1):"However, f",1:"F")
"RTN","FBAACO3",114,0)
 . W "ee schedule amount is $",$P(FBX,U)," from the "
"RTN","FBAACO3",115,0)
 . W:$P(FBX,U,3)]"" $P(FBX,U,3)," " ; year if returned
"RTN","FBAACO3",116,0)
 . W:$P(FBX,U,2)]"" $$EXTERNAL^DILFD(162.03,45,"",$P(FBX,U,2))
"RTN","FBAACO3",117,0)
 E  W !?2,"Unable to determine a FEE schedule amount."
"RTN","FBAACO3",118,0)
 ;
"RTN","FBAACO3",119,0)
 I FB1725 D
"RTN","FBAACO3",120,0)
 . W !!?2,"**Payment is for emergency treatment under 38 U.S.C. 1725."
"RTN","FBAACO3",121,0)
 . I FBFSAMT D
"RTN","FBAACO3",122,0)
 . . S FBFSAMT=$J(FBFSAMT*.7,0,2)
"RTN","FBAACO3",123,0)
 . . W !?2,"  Therefore, fee schedule amount reduced to $",FBFSAMT," (70%)."
"RTN","FBAACO3",124,0)
 ;
"RTN","FBAACO3",125,0)
 I $G(FBUNITS)>1 D
"RTN","FBAACO3",126,0)
 . W !!?2,"Units Paid = ",FBUNITS
"RTN","FBAACO3",127,0)
 . Q:FBFSAMT'>0
"RTN","FBAACO3",128,0)
 . N FBFSUNIT
"RTN","FBAACO3",129,0)
 . ; determine if fee schedule can be multiplied by units
"RTN","FBAACO3",130,0)
 . S FBFSUNIT=$S(FBFSUSD="R":1,FBFSUSD="F"&(FBAADT>3040930):1,1:0)
"RTN","FBAACO3",131,0)
 . I FBFSUNIT D
"RTN","FBAACO3",132,0)
 . . S FBFSAMT=$J(FBFSAMT*FBUNITS,0,2)
"RTN","FBAACO3",133,0)
 . . W !?2,"  Therefore, fee schedule amount increased to $",FBFSAMT
"RTN","FBAACO3",134,0)
 . E  D
"RTN","FBAACO3",135,0)
 . . W !?2,"  Fee schedule not complied on per unit basis so amount not adjusted by units."
"RTN","FBAACO3",136,0)
 ;
"RTN","FBAACO3",137,0)
 I '$G(FBAAMM1) D
"RTN","FBAACO3",138,0)
 . ; set default amount paid to lesser of amt claimed (J) or fee sched.
"RTN","FBAACO3",139,0)
 . S FBAMTPD=$S(FBFSAMT'>0:J,FBFSAMT>J:J,1:FBFSAMT)
"RTN","FBAACO3",140,0)
 W !
"RTN","FBAACO3",141,0)
 Q
"RTN","FBAACO3",142,0)
CHKIT I X>FBAMTPD&('$D(^XUSEC("FBAASUPERVISOR",DUZ))) W !!,"You must be a holder of the 'FBAASUPERVISOR' security key in order to",!,"exceed the Fee Schedule.",! S $P(^FBAAC(DFN,1,FBV,1,FBSDI,1,FBAACPI,0),"^",3)=K,Y=2 Q
"RTN","FBAACO3",143,0)
 Q
"RTN","FBAACO3",144,0)
NOGO W !!,*7,"This payment CANNOT be edited.  The batch the payment is in",!,"has been Vouchered.  You may void the payment with the Void Payment option.",!
"RTN","FBAACO3",145,0)
 Q
"RTN","FBAACO3",146,0)
 ;
"RTN","FBAACO3",147,0)
SC W *7,!?4,"Suspense code is required!",! S Y="@4" Q
"RTN","FBAACO3",148,0)
 ;
"RTN","FBAACO3",149,0)
DEL ;delete date of service if no service provided entered
"RTN","FBAACO3",150,0)
 I '$O(^FBAAC(DFN,1,FBV,1,FBSDI,1,0)) D
"RTN","FBAACO3",151,0)
 .S DIK="^FBAAC(DFN,1,FBV,1,",DA(2)=DFN,DA(1)=FBV,DA=FBSDI D ^DIK W !!?5,*7,"Incomplete payment entry deleted.",!
"RTN","FBAACO3",152,0)
 K DIK,DA Q
"RTN","FBAACP")
0^10^B55546360^B47546031
"RTN","FBAACP",1,0)
FBAACP ;AISC/CMR - C&P PAYMENT DRIVER ;10/31/12 3:08pm
"RTN","FBAACP",2,0)
 ;;3.5;FEE BASIS;**4,38,55,61,77,108,143,139**;JAN 30, 1995;Build 127
"RTN","FBAACP",3,0)
 ;;Per VA Directive 6402, this routine should not be modified.
"RTN","FBAACP",4,0)
 K FBAAOUT,FBPOP S FBCNP=1 ;C&P flag
"RTN","FBAACP",5,0)
 D SITE^FBAACO G Q:$G(FBPOP) D BT^FBAACO G Q:$G(FBAAOUT)
"RTN","FBAACP",6,0)
1 K FBAR,FBAAOUT,FBDL,FBAAMM D GETVEN1^FBAACO1:$D(FB583),GETVEN^FBAACO1:'$D(FB583) G CLN:$G(FBAAOUT)
"RTN","FBAACP",7,0)
 D GETINV^FBAACO1 G CLN:$G(FBAAOUT)
"RTN","FBAACP",8,0)
 D GETINDT^FBAACO1 G CLN:$G(FBAAOUT)
"RTN","FBAACP",9,0)
 D MMPPT^FBAACP G CLN:$G(FBAAOUT)
"RTN","FBAACP",10,0)
SVDT W !! S %DT="AEXP",%DT("A")="Date of Service: " D ^%DT I X="^" G CLN
"RTN","FBAACP",11,0)
 I Y<0!(Y>FBAAID) W *7,!!,"Enter the date the Vendor provided the service to the Patient.",!,"The date must be prior to the date the invoice is received.",! G SVDT
"RTN","FBAACP",12,0)
 S FBAADT=Y D SETO^FBAACO3,CPTM^FBAALU(FBAADT) I 'FBGOT G CLN
"RTN","FBAACP",13,0)
 ; prompt revenue code
"RTN","FBAACP",14,0)
 S FBAARC=$$ASKREVC^FBUTL5() I FBAARC="^" S FBAAOUT=1 G CLN
"RTN","FBAACP",15,0)
 ; prompt units paid
"RTN","FBAACP",16,0)
 S FBUNITS=$$ASKUNITS^FBUTL5() I FBUNITS="^" S FBAAOUT=1 G CLN
"RTN","FBAACP",17,0)
 D ASKZIP^FBAAFS($G(FBV),$G(FBAADT)) I $G(FBAAOUT)!($G(FBZIP)']"") G CLN
"RTN","FBAACP",18,0)
 I $$ANES^FBAAFS($$CPT^FBAAUTL4(FBAACP)) D ASKTIME^FBAAFS I $G(FBAAOUT)!('$G(FBTIME)) G CLN
"RTN","FBAACP",19,0)
 D HCFA G CLN:$G(FBAAOUT)
"RTN","FBAACP",20,0)
 S FBAAAMT=0 D AMTPD I $G(FBAAOUT)!('$G(FBAAAMT)) G CLN
"RTN","FBAACP",21,0)
 ; prompt for remittance remarks
"RTN","FBAACP",22,0)
 I $$RR^FBUTL4(.FBRRMK,2)=0 S FBAAOUT=1 G CLN
"RTN","FBAACP",23,0)
MULT ;begin unique patient entry
"RTN","FBAACP",24,0)
 W:FBINTOT>0 !,"Invoice: "_FBAAIN_" Totals: $ "_FBINTOT
"RTN","FBAACP",25,0)
 K FBAAOUT,FBDL S (DFN,FTP)="" D SITE^FBAACO G Q:$G(FBPOP) W !!
"RTN","FBAACP",26,0)
 I '$D(FB583) K FBDL D GETVET^FBAAUTL1 G CLN:'DFN K FBDMRA D GETAUTH^FBAAUTL1 G MULT:FTP']""
"RTN","FBAACP",27,0)
 ; check contract
"RTN","FBAACP",28,0)
 I $G(FBAAPTC)'="R",'$D(FB583),$$UCFA^FBUTL7($G(FBV),$G(FBVEN),$G(FBCNTRA)),FBCNTRP'=FBCNTRA D  G MULT
"RTN","FBAACP",29,0)
 . W !,"ERROR: Contract specified for payments (",$S(FBCNTRP:$P($G(^FBAA(161.43,FBCNTRP,0)),U),1:""),") doesn't"
"RTN","FBAACP",30,0)
 . W !,"match contract specified by this authorization (",$S(FBCNTRA:$P($G(^FBAA(161.43,FBCNTRA,0)),U),1:""),")."
"RTN","FBAACP",31,0)
 ; FB*3.5*139 JLG/JAS ICD-10 remediation
"RTN","FBAACP",32,0)
 K FBAAOUT
"RTN","FBAACP",33,0)
 N FBISYS S FBISYS=10 S:FBAADT<$$IMPDATE^FBCSV1("10D") FBISYS=9
"RTN","FBAACP",34,0)
 D:FBISYS=9 ICD9 G Q:$G(FBAAOUT)
"RTN","FBAACP",35,0)
 D:FBISYS=10 ICD10 G Q:$G(FBAAOUT)
"RTN","FBAACP",36,0)
 ; end 139
"RTN","FBAACP",37,0)
 D PAT^FBAACO W !! D FILEV^FBAACO5(DFN,FBV) I $G(FBAAOUT) G Q:$D(FB583),CLN
"RTN","FBAACP",38,0)
 ;check for payments against all linked vendors
"RTN","FBAACP",39,0)
 S DA=+Y D CHK^FBAACO4 K FBAACK1,FBAAOUT,DA,X,Y
"RTN","FBAACP",40,0)
 W !! D GETSVDT^FBAACO5(DFN,FBV,FBASSOC,0,FBAADT) I $G(FBAAOUT) D AUTHQ^FBAACO G MULT
"RTN","FBAACP",41,0)
 D SETO^FBAACO3,CHK2^FBAACO4 I FBJ']"" G SVPR
"RTN","FBAACP",42,0)
CHKE ;determines what action to take on duplicate services entered
"RTN","FBAACP",43,0)
 K FBAAOUT W !!,*7,"Service selected for that date already in system."
"RTN","FBAACP",44,0)
 S DIR(0)="Y",DIR("A")="Do you want to add another service for the SAME DATE",DIR("B")="No" D ^DIR K DIR G SVPR:Y I $D(DIRUT) D DEL^FBAACO3 G Q
"RTN","FBAACP",45,0)
 W !!,*7,"You must use the 'EDIT PAYMENT' option to edit the service previously",!,"entered for that date." D DEL^FBAACO3
"RTN","FBAACP",46,0)
 G MULT
"RTN","FBAACP",47,0)
SVPR K FBAAOUT D SVCPR^FBAACO1 G CHKE:$G(FBAAOUT)
"RTN","FBAACP",48,0)
 D FILE^FBAACP1 I Z1>(FBAAMPI-1) W !!,*7,"You have reached the maximum number of payments for a batch!",!,"You must select another Batch for entering Payments!" G CLN
"RTN","FBAACP",49,0)
 G MULT
"RTN","FBAACP",50,0)
Q ;kill variables and exit
"RTN","FBAACP",51,0)
 D Q^FBAACO
"RTN","FBAACP",52,0)
 Q
"RTN","FBAACP",53,0)
AMTPD ;get amount paid
"RTN","FBAACP",54,0)
 ; FB*3.5*143 - Added FB1725 as a parameter, to prevent inaccurate
"RTN","FBAACP",55,0)
 ; pricing of "Mill-Bill" claims with 75th percentile rates.
"RTN","FBAACP",56,0)
 N FBX
"RTN","FBAACP",57,0)
 S FBFY=FY-1
"RTN","FBAACP",58,0)
 S (FBAMTPD,FBFSAMT,FBFSUSD)=""
"RTN","FBAACP",59,0)
 S FBX=$$GET^FBAAFS($$CPT^FBAAUTL4(FBAACP),$$MODL^FBAAUTL4("FBMODA","E"),FBAADT,$G(FBZIP),$$FAC^FBAAFS($G(FBHCFA(30))),$G(FBTIME),$G(FB1725))
"RTN","FBAACP",60,0)
 ;
"RTN","FBAACP",61,0)
 I '$G(FBAAMM1) D
"RTN","FBAACP",62,0)
 . S FBFSAMT=$P(FBX,U),FBFSUSD=$P(FBX,U,2)
"RTN","FBAACP",63,0)
 E  D
"RTN","FBAACP",64,0)
 . W !,?2,"Payment is for a contracted service so fee schedule does not apply."
"RTN","FBAACP",65,0)
 ;
"RTN","FBAACP",66,0)
 I $P($G(FBX),U)]"" D
"RTN","FBAACP",67,0)
 . W !?2,$S($G(FBAAMM1):"However, f",1:"F")
"RTN","FBAACP",68,0)
 . W "ee schedule amount is $",$P(FBX,U)," from the "
"RTN","FBAACP",69,0)
 . W:$P(FBX,U,3)]"" $P(FBX,U,3)," " ; year if returned
"RTN","FBAACP",70,0)
 . W:$P(FBX,U,2)]"" $$EXTERNAL^DILFD(162.03,45,"",$P(FBX,U,2))
"RTN","FBAACP",71,0)
 E  W !?2,"Unable to determine a FEE schedule amount."
"RTN","FBAACP",72,0)
 ;
"RTN","FBAACP",73,0)
 I $G(FBUNITS)>1 D
"RTN","FBAACP",74,0)
 . W !!?2,"Units Paid = ",FBUNITS
"RTN","FBAACP",75,0)
 . Q:FBFSAMT'>0
"RTN","FBAACP",76,0)
 . N FBFSUNIT
"RTN","FBAACP",77,0)
 . ; determine if fee schedule can be multiplied by units
"RTN","FBAACP",78,0)
 . S FBFSUNIT=$S(FBFSUSD="R":1,FBFSUSD="F"&(FBAADT>3040930):1,1:0)
"RTN","FBAACP",79,0)
 . I FBFSUNIT D
"RTN","FBAACP",80,0)
 . . S FBFSAMT=$J(FBFSAMT*FBUNITS,0,2)
"RTN","FBAACP",81,0)
 . . W !?2,"  Therefore, fee schedule amount increased to $",FBFSAMT
"RTN","FBAACP",82,0)
 . E  D
"RTN","FBAACP",83,0)
 . . W !?2,"  Fee schedule not complied on per unit basis so amount not adjusted by units."
"RTN","FBAACP",84,0)
 ;
"RTN","FBAACP",85,0)
 I '$G(FBAAMM1) S FBAMTPD=FBFSAMT
"RTN","FBAACP",86,0)
 ;
"RTN","FBAACP",87,0)
 I FBAMTPD=0 D  Q:$G(FBAAOUT)
"RTN","FBAACP",88,0)
 . ;if fee schedule = 0 write message and quit
"RTN","FBAACP",89,0)
 . W !,"You must use the Enter Payment option for CPT codes that have a",!,"Fee Schedule set equal to zero."
"RTN","FBAACP",90,0)
 . S FBAAOUT=1
"RTN","FBAACP",91,0)
 W !
"RTN","FBAACP",92,0)
 S DIR(0)="162.03,1",DIR("A")="Enter Amount Paid:  $",DIR("?")="Enter a dollar amount that does not exceed the FEE Schedule" S:FBAMTPD'="" DIR("B")=FBAMTPD D ^DIR K DIR I $D(DIRUT) S FBAAOUT=1 Q
"RTN","FBAACP",93,0)
 I $G(FBAMTPD),+Y>FBAMTPD&('$D(^XUSEC("FBAASUPERVISOR",DUZ))) W !!,*7,"You must be a holder of the 'FBAASUPERVISOR' security key to",!,"exceed the FEE Schedule.  Enter an '^' to quit or accept the default.",! G AMTPD
"RTN","FBAACP",94,0)
 S FBAAAMT=+Y
"RTN","FBAACP",95,0)
 Q
"RTN","FBAACP",96,0)
HCFA ;get HCFA fields
"RTN","FBAACP",97,0)
 F I=28,30,31 S FBHCFA(I)=""
"RTN","FBAACP",98,0)
 W ! F I=30,31 S DIR(0)="P"_$S(I=30:"^353.1",I=31:"O^353.2")_":EMQZ" D DIR Q:$G(FBAAOUT)
"RTN","FBAACP",99,0)
 K DIR Q
"RTN","FBAACP",100,0)
DIR ;generic DIR call for HCFA
"RTN","FBAACP",101,0)
 D ^DIR K DIR I $D(DTOUT)!($D(DUOUT)) S FBAAOUT=1 Q
"RTN","FBAACP",102,0)
 S:Y'=-1 FBHCFA(I)=$P(Y,"^")
"RTN","FBAACP",103,0)
 Q
"RTN","FBAACP",104,0)
CLN G Q:$D(FB583)
"RTN","FBAACP",105,0)
 D Q G FBAACP
"RTN","FBAACP",106,0)
 Q
"RTN","FBAACP",107,0)
ICD9 ;get ICD-9 primary diagnosis - JAS - Patch 139 ICD-10 remediation
"RTN","FBAACP",108,0)
 N FBPD,EDATE,FBXSP K FBAAOUT
"RTN","FBAACP",109,0)
 S EDATE=FBAADT ; edate is the date of interest for ICD9 diagnosis code lookup
"RTN","FBAACP",110,0)
 S FBXSP="PRIMARY DIAGNOSIS"
"RTN","FBAACP",111,0)
 F  D  Q:$G(FBAAOUT)!(FBPD>0)
"RTN","FBAACP",112,0)
 . S FBPD=$$ENICD9^FBICD9(EDATE,FBXSP,"Y")
"RTN","FBAACP",113,0)
 . S:FBPD="^" FBAAOUT=-1
"RTN","FBAACP",114,0)
 Q:$G(FBAAOUT)!(FBPD'>0)
"RTN","FBAACP",115,0)
 S FBHCFA(28)=+FBPD
"RTN","FBAACP",116,0)
 Q
"RTN","FBAACP",117,0)
ICD10 ;get ICD-10 primary diagnosis FB*3.5*139 JLG ICD-10 remediation
"RTN","FBAACP",118,0)
 N FBPD,EDATE K FBAAOUT
"RTN","FBAACP",119,0)
 S EDATE=FBAADT
"RTN","FBAACP",120,0)
 S:'$D(DA) DA=0 ;must be defined prior to running ASF
"RTN","FBAACP",121,0)
 S:'$D(DP) DP=0 ;must be defined prior to running ASF
"RTN","FBAACP",122,0)
 F  D  Q:$G(FBAAOUT)!(FBPD>0)
"RTN","FBAACP",123,0)
 . S FBPD=$$ASKICD10^FBASF("PRIMARY DIAGNOSIS","","Y")
"RTN","FBAACP",124,0)
 . S:FBPD=-3 FBAAOUT=-1
"RTN","FBAACP",125,0)
 Q:$G(FBAAOUT)!(FBPD'>0)
"RTN","FBAACP",126,0)
 S FBHCFA(28)=FBPD
"RTN","FBAACP",127,0)
 Q
"RTN","FBAACP",128,0)
MMPPT ;money management/prompt pay type for multiple payment entry
"RTN","FBAACP",129,0)
 ; input
"RTN","FBAACP",130,0)
 ;   FBAAPTC = payment type code, "R" when patient reimbursement
"RTN","FBAACP",131,0)
 ;   FBV     = vendor being paid (ien)
"RTN","FBAACP",132,0)
 ;   when called from FBAAMP additional variables will be available
"RTN","FBAACP",133,0)
 ;     FBCNTRA = contract ien from authorization
"RTN","FBAACP",134,0)
 ;     FBVEN   = vendor from authorization
"RTN","FBAACP",135,0)
 ;     FB583   = defined when unauthorized claim
"RTN","FBAACP",136,0)
 ; output
"RTN","FBAACP",137,0)
 ;   FBAAMM  = prompt payment, =1 to ask
"RTN","FBAACP",138,0)
 ;   FBAAMM1 = prompt payment type for line
"RTN","FBAACP",139,0)
 ;   FBAAOUT = (optional), = 1 to quit
"RTN","FBAACP",140,0)
 ;   FBCNTRP = contract for line item (ien)
"RTN","FBAACP",141,0)
 ;
"RTN","FBAACP",142,0)
 S (FBAAMM,FBAAMM1,FBCNTRP)=""
"RTN","FBAACP",143,0)
 I $G(FBAAPTC)'="R",'$D(FB583) D
"RTN","FBAACP",144,0)
 . ;
"RTN","FBAACP",145,0)
 . ; check if contract required by authorization
"RTN","FBAACP",146,0)
 . I '$D(FB583),$$UCFA^FBUTL7($G(FBV),$G(FBVEN),$G(FBCNTRA)) D  Q
"RTN","FBAACP",147,0)
 . . W !,"All lines items on this invoice will be considered as contracted services"
"RTN","FBAACP",148,0)
 . . W !,"under Contract ",$P($G(^FBAA(161.43,FBCNTRA,0)),U)," from the authorization."
"RTN","FBAACP",149,0)
 . . S (FBAAMM,FBAAMM1)=1
"RTN","FBAACP",150,0)
 . . S FBCNTRP=FBCNTRA
"RTN","FBAACP",151,0)
 . ;
"RTN","FBAACP",152,0)
 . ; when not forced by authorization ask if contracted service
"RTN","FBAACP",153,0)
 . W !,"The answer to the following will apply to all payments entered via this option."
"RTN","FBAACP",154,0)
 . S DIR(0)="Y"
"RTN","FBAACP",155,0)
 . S DIR("A")="Are payments for contracted services"
"RTN","FBAACP",156,0)
 . S DIR("B")="No"
"RTN","FBAACP",157,0)
 . S DIR("?",1)="Answering no indicates interest will not be paid for any line items."
"RTN","FBAACP",158,0)
 . S DIR("?",2)="Answering yes indicates interest will be paid."
"RTN","FBAACP",159,0)
 . S DIR("?",3)="A fee schedule is not used for contracted services."
"RTN","FBAACP",160,0)
 . S DIR("?")="Enter either 'Y' or 'N'."
"RTN","FBAACP",161,0)
 . D ^DIR K DIR I $D(DIRUT) S FBAAOUT=1 Q
"RTN","FBAACP",162,0)
 . S (FBAAMM,FBAAMM1)=$S(Y:1,1:"")
"RTN","FBAACP",163,0)
 . Q:FBAAMM1=""
"RTN","FBAACP",164,0)
 . ;
"RTN","FBAACP",165,0)
 . ; if contracted service, ask contract
"RTN","FBAACP",166,0)
 . S DIR(0)="PO^161.43:AQEM"
"RTN","FBAACP",167,0)
 . S DIR("A")="CONTRACT"
"RTN","FBAACP",168,0)
 . S DIR("?",1)="If the line item is under a contract then select it."
"RTN","FBAACP",169,0)
 . S DIR("?")="Contract must be active and applicable for the vendor."
"RTN","FBAACP",170,0)
 . S DIR("S")="I $P($G(^(0)),""^"",2)'=""I"",$$VCNTR^FBUTL7($G(FBV),+Y)"
"RTN","FBAACP",171,0)
 . D ^DIR K DIR I $D(DTOUT)!$D(DUOUT) S FBAAOUT=1 Q
"RTN","FBAACP",172,0)
 . S:Y>0 FBCNTRP=+Y
"RTN","FBAACP",173,0)
 Q
"RTN","FBAADEM1")
0^19^B16400891^B14338880
"RTN","FBAADEM1",1,0)
FBAADEM1 ;AISC/DMK - DISPLAY PATIENT DEMOGRAPHICS ;6/5/2009
"RTN","FBAADEM1",2,0)
 ;;3.5;FEE BASIS;**13,51,103,108,139**;JAN 30, 1995;Build 127
"RTN","FBAADEM1",3,0)
 ;;Per VA Directive 6402, this routine should not be modified.
"RTN","FBAADEM1",4,0)
EN N FBDX,FBFDT,FBI,FBRR,FBT,FBTYPE,FBV,FBZ,PSA,FBDC
"RTN","FBAADEM1",5,0)
 S:'$D(FBPROG) FBPROG="I 1"
"RTN","FBAADEM1",6,0)
 ;
"RTN","FBAADEM1",7,0)
 S Y=$G(^FBAAA(DFN,4)) W:$P(Y,"^")]"" !,"Fee ID Card #: ",$P(Y,"^"),?40,"Fee Card Issue Date: " S Y=$P(Y,"^",2) D PDF W Y,!
"RTN","FBAADEM1",8,0)
 ;
"RTN","FBAADEM1",9,0)
 I $O(^FBAAA(DFN,1,0)) D  Q:FBAAOUT
"RTN","FBAADEM1",10,0)
 . D HANG:$Y+5>IOSL Q:FBAAOUT
"RTN","FBAADEM1",11,0)
 . W !,"Patient Name: ",VADM(1),?55,"Pt.ID: ",$P(VADM(2),"^",2)
"RTN","FBAADEM1",12,0)
 . W !!,"AUTHORIZATIONS:",!
"RTN","FBAADEM1",13,0)
 . K FBAUT
"RTN","FBAADEM1",14,0)
 . S FBZ=0,FBFDT="9999999"
"RTN","FBAADEM1",15,0)
 . F  S FBFDT=$O(^FBAAA(DFN,1,"B",FBFDT),-1) Q:'FBFDT  D  Q:FBAAOUT
"RTN","FBAADEM1",16,0)
 . . S FBI=0 F  S FBI=$O(^FBAAA(DFN,1,"B",FBFDT,FBI)) Q:'FBI  I $D(^FBAAA(DFN,1,FBI,0)) X FBPROG I  S FBZ=FBZ+1,X=^(0) D  Q:FBAAOUT
"RTN","FBAADEM1",17,0)
 . . . S Y=+X,PSA=$P(X,"^",5),FBT=$P(X,"^",13),FBV=+$P(X,"^",4) D PDF
"RTN","FBAADEM1",18,0)
 . . . W ?3,"(",FBZ,")",?7,"FR: ",Y,?25,"VENDOR: ",$S($D(^FBAAV(FBV,0)):$P(^(0),"^")_" - "_$P(^(0),"^",2),1:"Not Specified")
"RTN","FBAADEM1",19,0)
 . . . S FBDX=$G(^FBAAA(DFN,1,FBI,3))
"RTN","FBAADEM1",20,0)
 . . . W !?7,"TO: " S Y=$P(X,"^",2) D PDF W Y
"RTN","FBAADEM1",21,0)
 . . . W:$P(X,"^",22) ?25,"Contract: ",$P($G(^FBAA(161.43,$P(X,"^",22),0)),"^")
"RTN","FBAADEM1",22,0)
 . . . W !?25,"Authorization Type: " D
"RTN","FBAADEM1",23,0)
 . . . . S FBTYPE=$P(X,"^",3),FBTYPE=$S(FBTYPE=2:"Outpatient - "_$S(FBT=1:"Short Term",FBT=2:"Home Health",FBT=3:"ID Card",1:""),$D(^FBAA(161.8,+FBTYPE,0)):$P(^(0),"^"),1:"Unknown")
"RTN","FBAADEM1",24,0)
 . . . W FBTYPE W:$P(X,"^",7) !,?11,"Purpose of Visit: ",$P($G(^FBAA(161.82,$P(X,"^",7),0)),"^") I $P(X,"^",9)["FB583(" W !?25,">> Unauthorized Claim <<"
"RTN","FBAADEM1",25,0)
 . . . ; PRXM/KJH - Patch 103. Add Referring Provider and NPI to the display.
"RTN","FBAADEM1",26,0)
 . . . ; JLG-FB*3.5*139-ICD10 REMEDIATION- print proper version of diagnosis code
"RTN","FBAADEM1",27,0)
 . . . ;W !?11,"DX: ",$P(X,"^",8) W ?40,"REF: "
"RTN","FBAADEM1",28,0)
 . . . D DC W !?11,"DX: ",FBDC W ?40,"REF: "
"RTN","FBAADEM1",29,0)
 . . . I $P(X,"^",21)'="" W $$GET1^DIQ(200,$P(X,"^",21),.01)
"RTN","FBAADEM1",30,0)
 . . . W !?11,"REF NPI: ",$$REFNPI^FBCH78($P(X,"^",21)),!
"RTN","FBAADEM1",31,0)
 . . . W:$P(FBDX,"^")]"" !?15,$P(FBDX,"^")
"RTN","FBAADEM1",32,0)
 . . . W:$P(FBDX,"^",2)]"" !?15,$P(FBDX,"^",2)
"RTN","FBAADEM1",33,0)
 . . . S FBAUT($P(X,"^"))=$P(X,"^",2)
"RTN","FBAADEM1",34,0)
 . . . W !?7,"County: ",FBCOUNTY,?40,"PSA: ",$S($D(^DIC(4,+PSA,0)):$P(^(0),"^"),1:"Unknown"),!
"RTN","FBAADEM1",35,0)
 . . . S FBDEL=$G(^FBAAA(DFN,1,FBI,"ADEL")) I FBDEL]"" S Y=$P(FBDEL,"^",2) D PDF W ?12,">> DELETE MRA SENT TO AUSTIN ON - ",Y," >>",!
"RTN","FBAADEM1",36,0)
 . . . I $D(^FBAAA(DFN,1,FBI,2,0)) K ^UTILITY($J,"W") S DIWL=15,DIWR=70,DIWF="W" D HANG:$Y+6>IOSL Q:FBAAOUT  W !?11,"REMARKS:" D
"RTN","FBAADEM1",37,0)
 . . . . S FBRR=0 F  S FBRR=$O(^FBAAA(DFN,1,FBI,2,FBRR)) Q:'FBRR  S (FBXX,X)=^(FBRR,0) D ^DIWP
"RTN","FBAADEM1",38,0)
 . . . D ^DIWW:$D(FBXX) K FBXX W !
"RTN","FBAADEM1",39,0)
 . . . K X,FBDX,FBT,FBTYPE,FBV,PSA D HANG:$Y+5>IOSL
"RTN","FBAADEM1",40,0)
 ;
"RTN","FBAADEM1",41,0)
 D HANG:$Y+5>IOSL Q:FBAAOUT
"RTN","FBAADEM1",42,0)
 ;
"RTN","FBAADEM1",43,0)
 I $O(^FBAAA(DFN,2,0))>0 D  Q:FBAAOUT
"RTN","FBAADEM1",44,0)
 . W !,"VENDOR CONTACTS:"
"RTN","FBAADEM1",45,0)
 . S (FBZ,FBI)=0
"RTN","FBAADEM1",46,0)
 . F  S FBI=$O(^FBAAA(DFN,2,FBI)) Q:'FBI!(FBAAOUT)  S FBZ=FBZ+1,X=$G(^(FBI,0)),Y=+X D PDF D
"RTN","FBAADEM1",47,0)
 . . W !?3,"(",FBZ,")",?7,"DATE: ",Y,?25,"VENDOR: ",$P(X,"^",2),?55,"PHONE: ",$S($P(X,"^",3)]"":$P(X,"^",3),1:"Not Found")
"RTN","FBAADEM1",48,0)
 . . I $D(^FBAAA(DFN,2,FBI,1,0)) K ^UTILITY($J,"W") S DIWL=20,DIWR=70,DIWF="W" D HANG:$Y+5>IOSL Q:FBAAOUT  W !?11,"NARRATIVE:",! D
"RTN","FBAADEM1",49,0)
 . . . S FBRR=0 F  S FBRR=$O(^FBAAA(DFN,2,FBI,1,FBRR)) Q:'FBRR  S FBXX=^(FBRR,0) D HANG:$Y+5>IOSL Q:FBAAOUT  S X=FBXX D ^DIWP
"RTN","FBAADEM1",50,0)
 . . D ^DIWW:$D(FBXX) K FBXX W !
"RTN","FBAADEM1",51,0)
 Q
"RTN","FBAADEM1",52,0)
 ;
"RTN","FBAADEM1",53,0)
DC ; JLG-FB*3.5*139-ICD10 REMEDIATION- determine diagnosis code based on authorization from date
"RTN","FBAADEM1",54,0)
 S FBDC=""
"RTN","FBAADEM1",55,0)
 N FBVERS S FBVERS=$S(FBFDT<$$IMPDATE^FBCSV1("10D"):"9",1:"10")
"RTN","FBAADEM1",56,0)
 S:FBVERS=9 FBDC=$P(X,"^",8)
"RTN","FBAADEM1",57,0)
 S:FBVERS=10 FBDC=$$ICD9^FBCSV1($P($G(^FBAAA(DFN,1,FBI,"C")),"^",2))
"RTN","FBAADEM1",58,0)
 ;per SME requirement do not print ICD-10 diagnosis code for a CIVIL HOSPITAL unauthorized claim.
"RTN","FBAADEM1",59,0)
 S:(FBVERS'=9)&($P(X,"^",3)=6)&($P(X,"^",9)["FB583(") FBDC=""
"RTN","FBAADEM1",60,0)
 K FBVERS
"RTN","FBAADEM1",61,0)
 Q
"RTN","FBAADEM1",62,0)
 ;
"RTN","FBAADEM1",63,0)
HANG I $E(IOST,1,2)="C-" S DIR(0)="E" D ^DIR K DIR S:'Y FBAAOUT=1
"RTN","FBAADEM1",64,0)
 W @IOF I 'FBAAOUT W !,"Patient Name: ",VADM(1),?55,"Pt.ID: ",$P(VADM(2),"^",2),!
"RTN","FBAADEM1",65,0)
 Q
"RTN","FBAADEM1",66,0)
 ;
"RTN","FBAADEM1",67,0)
PDF S:Y Y=$$FMTE^XLFDT(Y,5)  ; TRANSLATE TO DISPLAY DATE
"RTN","FBAADEM1",68,0)
 Q
"RTN","FBAAEAR")
0^18^B1712071^B423775
"RTN","FBAAEAR",1,0)
FBAAEAR ;AISC/GRR - EDIT AUTHORIZATION REMARKS ;05FEB87
"RTN","FBAAEAR",2,0)
 ;;3.5;FEE BASIS;**139**;JAN 30, 1995;Build 127
"RTN","FBAAEAR",3,0)
 ;;Per VA Directive 6402, this routine should not be modified.
"RTN","FBAAEAR",4,0)
 S DA(1)=DFN,DA=FTP,DP=161.01,DIE="^FBAAA("_DFN_",1,"
"RTN","FBAAEAR",5,0)
 N XX1
"RTN","FBAAEAR",6,0)
 S DR=".021"
"RTN","FBAAEAR",7,0)
 S DR(1,161.01,1)="I FBAABDT<$$IMPDATE^FBCSV1(""10D"") S Y=""@9"""
"RTN","FBAAEAR",8,0)
 S DR(1,161.01,2)="@10;I $G(FBTT)=3 S Y=""@999"";S FBDFN=DFN;S EDATE=FBAABDT;S XX1=-1 S XX1=$$ASKICD10^FBASF(""ICD DIAGNOSIS"","""");I XX1<0 S Y=""@10"";.087////^S X=XX1;K EDATE;S Y=""@999"""
"RTN","FBAAEAR",9,0)
 S DR(1,161.01,3)="@9;.08;.085;.086"
"RTN","FBAAEAR",10,0)
 S DR(1,161.01,4)="@999"
"RTN","FBAAEAR",11,0)
 D ^DIE K DIE,DR
"RTN","FBAAEAR",12,0)
 Q
"RTN","FBAAMP1")
0^11^B12344888^B7353018
"RTN","FBAAMP1",1,0)
FBAAMP1 ;AISC/CMR - MULTIPLE PAYMENT ENTRY ;7/6/2003
"RTN","FBAAMP1",2,0)
 ;;3.5;FEE BASIS;**4,55,61,77,139**;JAN 30, 1995;Build 127
"RTN","FBAAMP1",3,0)
 ;;Per VA Directive 6402, this routine should not be modified.
"RTN","FBAAMP1",4,0)
SUSP ;enter suspense data
"RTN","FBAAMP1",5,0)
 N FBX
"RTN","FBAAMP1",6,0)
 ;S DIR(0)="162.5,9",DIR("A")="Amount Suspended: $",DIR("B")=FBJ-FBK,DIR("?")="Press Return if $ "_(FBJ-FBK)_" is Amount Suspended, otherwise enter correct suspension amount" D ^DIR K DIR
"RTN","FBAAMP1",7,0)
 ;I $D(DIRUT) W !!,"Invalid entry, enter a number between .01 and 999999" G SUSP
"RTN","FBAAMP1",8,0)
 ;S FBAAAS=+Y
"RTN","FBAAMP1",9,0)
 ;I +Y'=(FBJ-FBK) S FBAAAS=+Y W ! S DIR("A")="Is $"_FBAAAS_" correct for Amount Suspended",DIR("B")="Yes",DIR(0)="Y" D ^DIR K DIR I $D(DIRUT) S FBAAOUT=1 Q
"RTN","FBAAMP1",10,0)
 ;G SUSP:'Y
"RTN","FBAAMP1",11,0)
 ;W !! S DIC="^FBAA(161.27,",DIC(0)="AEQ" D ^DIC I X["^" S FBAAOUT=1 Q
"RTN","FBAAMP1",12,0)
 ;S FBAASC=+Y
"RTN","FBAAMP1",13,0)
 S FBX=$$ADJ^FBUTL2(FBJ-FBK,.FBADJ,2)
"RTN","FBAAMP1",14,0)
 I FBX=0 S FBAAOUT=1
"RTN","FBAAMP1",15,0)
 Q
"RTN","FBAAMP1",16,0)
SUSP1 I FBAASC=4 K ^TMP($J,"FBWP") W !!,"Suspension Description: " S DIC="^TMP($J,""FBWP"",",DWLW=80,DWPK=1 D EN^DIWE K DIC,DWLW,DWPK I '$O(^TMP($J,"FBWP",0)) W !!,*7,"Description of Suspense is required." G SUSP1
"RTN","FBAAMP1",17,0)
 Q
"RTN","FBAAMP1",18,0)
HCFA N ICDMDE S ICDMDE=10
"RTN","FBAAMP1",19,0)
 I FBMPDT<$$IMPDATE^LEXU("10D") S ICDMDE=9 N XX1 ;FB*3.5*139-JLG-ICD10 REMEDIATION
"RTN","FBAAMP1",20,0)
 F FBSI=28,30,31,32 S FBHCFA(FBSI)=""
"RTN","FBAAMP1",21,0)
 W ! F FBSI=28,30,31 D  Q:$G(FBAAOUT)
"RTN","FBAAMP1",22,0)
 . ;DEM/JLG/JAS FB*3.5*139-JLG-ICD10 REMEDIATION
"RTN","FBAAMP1",23,0)
 . I (FBSI=28)&(ICDMDE=10) F  D  Q:($G(FBAAOUT))!(XX1>0)
"RTN","FBAAMP1",24,0)
 . . S XX1=$$ASKICD10(FBMPDT) S:XX1=-3 FBAAOUT=1
"RTN","FBAAMP1",25,0)
 . . Q:XX1<0
"RTN","FBAAMP1",26,0)
 . . S FBHCFA(28)=XX1
"RTN","FBAAMP1",27,0)
 . . Q
"RTN","FBAAMP1",28,0)
 . Q:($G(FBAAOUT))!((ICDMDE=10)&(FBSI=28))
"RTN","FBAAMP1",29,0)
 . I (FBSI=28)&(ICDMDE=9) F  D  Q:($G(FBAAOUT))!(XX1>0)
"RTN","FBAAMP1",30,0)
 . . S XX1=$$ASKICD9(FBMPDT) S:XX1="^" FBAAOUT=1
"RTN","FBAAMP1",31,0)
 . . Q:XX1<0
"RTN","FBAAMP1",32,0)
 . . S FBHCFA(28)=XX1
"RTN","FBAAMP1",33,0)
 . . Q
"RTN","FBAAMP1",34,0)
 . Q:($G(FBAAOUT))!((ICDMDE=9)&(FBSI=28))
"RTN","FBAAMP1",35,0)
 . ;END 139
"RTN","FBAAMP1",36,0)
 . N ICDVDT S ICDVDT=$G(FBMPDT)
"RTN","FBAAMP1",37,0)
 . ;JAS - 08/23/13 - FB*3.5*139 (ICD10 REMEDIATION) - Modified next line for ICD-10.
"RTN","FBAAMP1",38,0)
 . F  S DIR(0)="P"_$S(FBSI=30:"^353.1",FBSI=31:"O^353.2")_":EMZ" D HCFA1 Q:$G(FBAAOUT)  Q
"RTN","FBAAMP1",39,0)
 Q:$G(FBAAOUT)
"RTN","FBAAMP1",40,0)
 W !
"RTN","FBAAMP1",41,0)
 I $$EXTPV^FBAAUTL5(FBPOV)'="01" D
"RTN","FBAAMP1",42,0)
 . S FBSI=32,DIR(0)="Y",DIR("A")="Service connected condition"
"RTN","FBAAMP1",43,0)
 . S DIR("?")="^W !!,""Respond by answering 'Yes' or 'No'."",! I $G(DFN) W !?1,*7,""Patient:  "",$$NAME^FBCHREQ2(DFN) D DIS^DGRPDB W !!"
"RTN","FBAAMP1",44,0)
 . D HCFA1 I $D(DIRUT) S FBAAOUT=1 Q
"RTN","FBAAMP1",45,0)
 Q
"RTN","FBAAMP1",46,0)
 ;
"RTN","FBAAMP1",47,0)
ASKICD9(FBINDT) ;JAS - 08/23/13 - FB*3.5*139 (ICD10 REMEDIATION)
"RTN","FBAAMP1",48,0)
 N FBDX,EDATE,XSP
"RTN","FBAAMP1",49,0)
 S EDATE=FBINDT ; edate is the date of interest for ICD9 diagnosis code lookup
"RTN","FBAAMP1",50,0)
 S XSP="ICD DIAGNOSIS"
"RTN","FBAAMP1",51,0)
 S FBDX=$$ENICD9^FBICD9(EDATE,XSP,"Y")
"RTN","FBAAMP1",52,0)
 K EDATE,FBINDT
"RTN","FBAAMP1",53,0)
 Q +FBDX
"RTN","FBAAMP1",54,0)
 ; 
"RTN","FBAAMP1",55,0)
ASKICD10(FBINDT) ; FB*3.5*139-JLG-ICD10 REMEDIATION
"RTN","FBAAMP1",56,0)
 N FBDX,EDATE,DA,DP
"RTN","FBAAMP1",57,0)
 S EDATE=FBINDT ; edate is the date of interest for ICD10 diagnosis code lookup
"RTN","FBAAMP1",58,0)
 S DA=DFN,DP=162.03 ; these must be defined prior to calling $$ASKICD10
"RTN","FBAAMP1",59,0)
 S FBDX=-1 S FBDX=$$ASKICD10^FBASF("PRIMARY DIAGNOSIS","","Y") ; returns -1 or ien of icd10 diagnosis code
"RTN","FBAAMP1",60,0)
 K EDATE,FBINDT
"RTN","FBAAMP1",61,0)
 Q FBDX
"RTN","FBAAMP1",62,0)
 ;
"RTN","FBAAMP1",63,0)
HCFA1 D ^DIR I $D(DTOUT)!($D(DUOUT)) S FBAAOUT=1 Q
"RTN","FBAAMP1",64,0)
 I Y'=-1 D
"RTN","FBAAMP1",65,0)
 .I DIR(0)["P" S FBHCFA(FBSI)=$P(Y,"^")
"RTN","FBAAMP1",66,0)
 .I DIR(0)="Y" S FBHCFA(FBSI)=$S(Y=1:"Y",1:"N")
"RTN","FBAAMP1",67,0)
 K DIR Q
"RTN","FBAAMP1",68,0)
DESC N FBJ
"RTN","FBAAMP1",69,0)
 I FBAASC=4,$D(^TMP($J,"FBWP",0)) S ^FBAAC(DFN,1,FBV,1,FBSDI,1,FBAACPI,1,0)=^(0) F FBJ=1:1 Q:'$D(^TMP($J,"FBWP",FBJ,0))  S ^FBAAC(DFN,1,FBV,1,FBSDI,1,FBAACPI,1,FBJ,0)=^(0)
"RTN","FBAAMP1",70,0)
 Q
"RTN","FBAAPET")
0^12^B47597707^B42847501
"RTN","FBAAPET",1,0)
FBAAPET ;AISC/DMK - EDIT PAYMENT ;5/16/12 12:44pm
"RTN","FBAAPET",2,0)
 ;;3.5;FEE BASIS;**4,38,55,61,77,116,122,133,108,124,132,139**;JAN 30, 1995;Build 127
"RTN","FBAAPET",3,0)
 ;;Per VA Directive 6402, this routine should not be modified.
"RTN","FBAAPET",4,0)
 S FBOT=1
"RTN","FBAAPET",5,0)
GETPT I $G(BAT) D
"RTN","FBAAPET",6,0)
 .I '$D(^FBAAC("AC",+BAT)) F I=9,10,11 S $P(^FBAA(161.7,+BAT,0),U,I)=""
"RTN","FBAAPET",7,0)
 .I $D(^FBAAC("AC",+BAT)) D  S $P(^FBAA(161.7,+BAT,0),U,11)=I,$P(^(0),U,9)=$G(FBTOT) K I,FBTOT
"RTN","FBAAPET",8,0)
 ..N J,K,L,M S (I,J,K,L,M,FBTOT)=0
"RTN","FBAAPET",9,0)
 ..F  S J=$O(^FBAAC("AC",+BAT,J)) Q:'J  F  S K=$O(^FBAAC("AC",+BAT,J,K)) Q:'K  F  S L=$O(^FBAAC("AC",+BAT,J,K,L)) Q:'L  F  S M=$O(^FBAAC("AC",+BAT,J,K,L,M)) Q:'M  I $D(^FBAAC(J,1,K,1,L,1,M,0)) S I=I+1,FBTOT=FBTOT+$P(^(0),U,3)
"RTN","FBAAPET",10,0)
 W !! S DIC="^FBAAC(",DIC(0)="AEQM" D ^DIC G END:X="^"!(X=""),GETPT:Y<0 S (DFN,FBDA(3))=+Y
"RTN","FBAAPET",11,0)
 S:'$D(^FBAAC(DFN,1,0)) ^FBAAC(DFN,1,0)="^162.01P^0^0"
"RTN","FBAAPET",12,0)
 S DIC=DIC_DFN_",1,"
"RTN","FBAAPET",13,0)
GETVD W !! S DIC(0)="AEQM" D ^DIC G GETPT:X="^"!(X=""),GETVD:Y<0 S (FBV,FBVD,FBDA(2))=+Y
"RTN","FBAAPET",14,0)
 S:'$D(^FBAAC(DFN,1,FBDA(2),1,0)) ^FBAAC(DFN,1,FBDA(2),1,0)="^162.02DA^0^0"
"RTN","FBAAPET",15,0)
 S DIC=DIC_FBVD_",1,"
"RTN","FBAAPET",16,0)
GETDT S DIC(0)="AEQM",DIC("A")="Date of Service: " D ^DIC K DIC("A") G GETPT:X="^"!(X=""),GETDT:Y<0 S (FBSD,FBSDI,FBDA(1))=+Y,FBAADT=$P(Y,U,2)
"RTN","FBAAPET",17,0)
 S:'$D(^FBAAC(DFN,1,FBDA(2),1,FBDA(1),1,0)) ^FBAAC(DFN,1,FBDA(2),1,FBDA(1),1,0)="^162.03A^0^0"
"RTN","FBAAPET",18,0)
 S FBZ=DIC_FBSD_",1,"
"RTN","FBAAPET",19,0)
SERV S DA(3)=FBDA(3),DA(2)=FBDA(2),DA(1)=FBDA(1)
"RTN","FBAAPET",20,0)
 S DIC("W")="N FBX S FBX=$$MODL^FBAAUTL4(""^FBAAC(FBDA(3),1,FBDA(2),1,FBDA(1),1,+Y,""""M"""")"",""E"") W:FBX]"""" ""    CPT Modifier(s): "",FBX Q"
"RTN","FBAAPET",21,0)
 S DIC=FBZ,DIC(0)="AEQMZ"
"RTN","FBAAPET",22,0)
 D
"RTN","FBAAPET",23,0)
 . N ICPTVDT S ICPTVDT=$G(FBAADT) D ^DIC
"RTN","FBAAPET",24,0)
 G GETPT:X="^"!(X=""),SERV:Y<0 S (FBSV,FBAACPI,FBDA)=+Y,BAT=$P(Y(0),U,8),FBDUZ=$P(Y(0),U,7),(FBAACP,FBAACP(0))=$P(Y,U,2),K=$P(Y(0),U,3),FBAAPTC=$P(Y(0),U,20),J(0)=$P(Y(0),U,2)
"RTN","FBAAPET",25,0)
 ; set FB1725 true (1) if payment is for a Mill Bill claim
"RTN","FBAAPET",26,0)
 S FB1725=$S($P(Y(0),U,13)["FB583":+$P($G(^FB583(+$P(Y(0),U,13),0)),U,28),1:0)
"RTN","FBAAPET",27,0)
 I FBDUZ'=DUZ&('$D(^XUSEC("FBAASUPERVISOR",DUZ))) W !!,*7,"Sorry,only the clerk who entered the payment ",!," or a supervisor can edit this payment." G GETPT
"RTN","FBAAPET",28,0)
 ;S FBAAMM1=$P($G(^FBAAC(FBDA(3),1,FBDA(2),1,FBDA(1),1,FBDA,2)),U,2)
"RTN","FBAAPET",29,0)
 S FBFSAMT(0)=$P($G(^FBAAC(FBDA(3),1,FBDA(2),1,FBDA(1),1,FBDA,2)),U,12)
"RTN","FBAAPET",30,0)
 ; determine lesser of original fee schedule amount and amount claimed
"RTN","FBAAPET",31,0)
 S FBAMTPD(0)=$S(FBFSAMT(0)="":J(0),FBFSAMT(0)>J(0):J(0),1:FBFSAMT(0))
"RTN","FBAAPET",32,0)
 S FBMODL=$$MODL^FBAAUTL4("^FBAAC("_FBDA(3)_",1,"_FBDA(2)_",1,"_FBDA(1)_",1,"_FBDA_",""M"")")
"RTN","FBAAPET",33,0)
 ; load current adjustment data
"RTN","FBAAPET",34,0)
 D LOADADJ^FBAAFA(FBDA_","_FBDA(1)_","_FBDA(2)_","_FBDA(3)_",",.FBADJ)
"RTN","FBAAPET",35,0)
 ; save adjustment data prior to edit session in sorted list
"RTN","FBAAPET",36,0)
 S FBADJL(0)=$$ADJL^FBUTL2(.FBADJ) ; sorted list of original adjustments
"RTN","FBAAPET",37,0)
 ; load current remittance remark data
"RTN","FBAAPET",38,0)
 D LOADRR^FBAAFR(FBDA_","_FBDA(1)_","_FBDA(2)_","_FBDA(3)_",",.FBRRMK)
"RTN","FBAAPET",39,0)
 ; save remittance remarks prior to edit session in sorted list
"RTN","FBAAPET",40,0)
 S FBRRMKL(0)=$$RRL^FBUTL4(.FBRRMK)
"RTN","FBAAPET",41,0)
 ; save FPPS data prior to edit session
"RTN","FBAAPET",42,0)
 S FBFPPSC(0)=$P($G(^FBAAC(FBDA(3),1,FBDA(2),1,FBDA(1),1,FBDA,3)),U)
"RTN","FBAAPET",43,0)
 S FBFPPSC=FBFPPSC(0)
"RTN","FBAAPET",44,0)
 S FBFPPSL(0)=$P($G(^FBAAC(FBDA(3),1,FBDA(2),1,FBDA(1),1,FBDA,3)),U,2)
"RTN","FBAAPET",45,0)
 S FBFPPSL=FBFPPSL(0)
"RTN","FBAAPET",46,0)
 G:BAT']"" EDIT
"RTN","FBAAPET",47,0)
 ; check batch status
"RTN","FBAAPET",48,0)
 S FBSTAT=$P($G(^FBAA(161.7,BAT,"ST")),U) ; batch status
"RTN","FBAAPET",49,0)
 I FBSTAT="S",'$D(^XUSEC("FBAASUPERVISOR",DUZ)) W !!,*7,"Sorry, only the Supervisor can edit a payment once the batch has been released." G GETPT
"RTN","FBAAPET",50,0)
 I "^T^F^V^"[(U_FBSTAT_U) W !!,*7,"Sorry, you cannot edit a payment when the batch has been sent to Austin." G GETPT
"RTN","FBAAPET",51,0)
 K FBSTAT
"RTN","FBAAPET",52,0)
 ;
"RTN","FBAAPET",53,0)
EDIT S DA=FBSV
"RTN","FBAAPET",54,0)
 ;
"RTN","FBAAPET",55,0)
 ; first edit CPT code and modifiers
"RTN","FBAAPET",56,0)
 D CPTM^FBAALU(FBAADT,DFN,FBAACP(0),FBMODL) I '$G(FBGOT) G GETPT
"RTN","FBAAPET",57,0)
 ; if CPT was changed then update file
"RTN","FBAAPET",58,0)
 I FBAACP'=FBAACP(0) D  I FBAACP="@" G GETPT
"RTN","FBAAPET",59,0)
 . N FBIENS,FBFDA
"RTN","FBAAPET",60,0)
 . S FBIENS=FBDA_","_FBDA(1)_","_FBDA(2)_","_FBDA(3)_","
"RTN","FBAAPET",61,0)
 . S FBFDA(162.03,FBIENS,.01)=FBAACP
"RTN","FBAAPET",62,0)
 . D FILE^DIE("","FBFDA") D MSG^DIALOG()
"RTN","FBAAPET",63,0)
 ; if modifiers changed then update file
"RTN","FBAAPET",64,0)
 I FBMODL'=$$MODL^FBAAUTL4("FBMODA") D REPMOD^FBAAUTL4(FBDA(3),FBDA(2),FBDA(1),FBDA)
"RTN","FBAAPET",65,0)
 ;
"RTN","FBAAPET",66,0)
 ; now edit remaining fields
"RTN","FBAAPET",67,0)
 S DIE("NO^")=""
"RTN","FBAAPET",68,0)
 ; FB*3.5*139-JLG-ICD10 REMEDIATION -added FBDXCHK1 and FBDXCHK2
"RTN","FBAAPET",69,0)
 N FBDXCHK1 S FBDXCHK1="S:FBAADT<$$IMPDATE^FBCSV1(""10D"") Y=""@7"";@60;S XX1=-1 S XX1=$$ASKICD10^FBAACO2(FBAADT,""Y"") S:XX1<0 Y=""@60"";28////^S X=XX1;S Y=31;"
"RTN","FBAAPET",70,0)
 N FBDXCHK2 S FBDXCHK2="S:FBAADT<$$IMPDATE^FBCSV1(""10D"") Y=""@8"";@15;S XX1=-1 S XX1=$$ASKICD10^FBAACO2(FBAADT) S:XX1<0 Y=""@15"";28////^S X=XX1;S Y=31;"
"RTN","FBAAPET",71,0)
 S DR="48;47;S FBUNITS=X;42R;S FBZIP=X;S:$$ANES^FBAAFS($$CPT^FBAAUTL4(FBAACP)) Y=""@2"";43///@;S FBTIME=X;S Y=""@3"";@2;43R;S FBTIME=X;@3"
"RTN","FBAAPET",72,0)
 ; fb*3.5*116 remove edit of interest indicator (162.03,34) to prevent different interest indicator values at line item level; interest indicator set at invoice level only; 
"RTN","FBAAPET",73,0)
 S DR(1,162.03,1)="S FBAAMM=$S(FBAAPTC=""R"":"""",1:1);D PPT^FBAACO1(FBAAMM1,FBCNTRP,1);54///@;54////^S X=FBCNTRP;30R;S FBHCFA(30)=X;1;S J=X;Q"
"RTN","FBAAPET",74,0)
 ;S DR(1,162.03,1)="30R;S FBHCFA(30)=X;1;S J=X;Q"
"RTN","FBAAPET",75,0)
 S DR(1,162.03,2)="D FEEDT^FBAACO3;44///@;44///^S X=FBFSAMT;45///@;45///^S X=FBFSUSD;S:FBAMTPD'>0!(FBAMTPD=FBAMTPD(0)) Y=""@4"";2///^S X=FBAMTPD;@4;2//^S X=FBAMTPD;D CHKIT^FBAACO3;S K=X"
"RTN","FBAAPET",76,0)
 ;S DR(1,162.03,3)="3////^S X=$S(J-K:J-K,1:"""");I X S Y=""@11"";4////@;S Y=""@5"";@11;3R;4R;S:X'=4 Y=""@5"";22"
"RTN","FBAAPET",77,0)
 S DR(1,162.03,3)="K FBADJD;M FBADJD=FBADJ;S FBX=$$ADJ^FBUTL2(J-K,.FBADJ,2,,.FBADJD,1)"
"RTN","FBAAPET",78,0)
 S DR(1,162.03,4)="S FBX=$$FPPSC^FBUTL5(1,FBFPPSC);S:FBX=-1 Y=0;S:FBX="""" Y=""@5"";50///^S X=FBX;S FBFPPSC=X;S FBX=$$FPPSL^FBUTL5(FBFPPSL);S:FBX=-1 Y=0;51///^S X=FBX;S FBFPPCL=X;S Y=""@55"";@5;50///@;S FBFPPSC="""";51///@;S FBFPPSL="""";@55"
"RTN","FBAAPET",79,0)
 S DR(1,162.03,5)="K DIE(""NO^"");W !,""Exit ('^') allowed now"";26;S PRC(""SITE"")=X;8;@13;13;I $$BADDATE^FBAAPET(FBAADT,X) S Y=""@13"";Q;33;49"
"RTN","FBAAPET",80,0)
 ;JAS - 09/11/13 - PATCH 139 - Modified next two lines (previously one line) for ICD-10
"RTN","FBAAPET",81,0)
 S DR(1,162.03,6)="15;17;16;S:X=1 Y=""@1"";@6;"_FBDXCHK1_"@7;S FBI9=$$ASKICD9^FBAACO2(FBAADT,""Y"") S:+FBI9<0 Y=""@7"";28////^S X=+FBI9;31;32R;S Y=""@9"";"
"RTN","FBAAPET",82,0)
 S DR(1,162.03,7)="@1;"_FBDXCHK2_"@8;S FBI9=$$ASKICD9^FBAACO2(FBAADT) S:+FBI9<0 Y=""@8"";28////^S X=+FBI9;31"
"RTN","FBAAPET",83,0)
 S DR(1,162.03,8)="@9;K FBRRMKD;M FBRRMKD=FBRRMK;S FBX=$$RR^FBUTL4(.FBRRMK,2,,.FBRRMKD)"
"RTN","FBAAPET",84,0)
 S DR(1,162.03,9)="73;74;75;58;59;60;61;62;63;64;65;66;67;76;77;78;79;68;69" ;FB*3.5*122,FB*3.5*133 edit line item provider fields
"RTN","FBAAPET",85,0)
 S DR(1,162.03,10)="@999;K FBDXCHK1,FBDXCHK2,XX1"  ;DEM;139 ICD-10 ASF
"RTN","FBAAPET",86,0)
 S DIE=FBZ
"RTN","FBAAPET",87,0)
 D
"RTN","FBAAPET",88,0)
 . N ICPTVDT,ICDVDT,FB583,FBAAMM,FBAAMM1,FBCNTRA,FBCNTRP,FBVEN,FTP
"RTN","FBAAPET",89,0)
 . S (ICPTVDT,ICDVDT)=$G(FBAADT)
"RTN","FBAAPET",90,0)
 . ; set variables for call to PPT^FBAACO1
"RTN","FBAAPET",91,0)
 . S FBAAMM1=$P($G(^FBAAC(FBDA(3),1,FBDA(2),1,FBDA(1),1,FBDA,2)),U,2)
"RTN","FBAAPET",92,0)
 . S FBCNTRP=$P($G(^FBAAC(FBDA(3),1,FBDA(2),1,FBDA(1),1,FBDA,3)),U,8)
"RTN","FBAAPET",93,0)
 . S X=$P($G(^FBAAC(FBDA(3),1,FBDA(2),1,FBDA(1),1,FBDA,0)),U,13)
"RTN","FBAAPET",94,0)
 . S:X[";FB583(" FB583=+X
"RTN","FBAAPET",95,0)
 . S FTP=$P($G(^FBAAC(FBDA(3),1,FBDA(2),1,FBDA(1),0)),U,4)
"RTN","FBAAPET",96,0)
 . S FBVEN=$S(FTP:$P($G(^FBAAA(DFN,1,FTP,0)),U,4),1:"")
"RTN","FBAAPET",97,0)
 . S FBCNTRA=$S(FTP:$P($G(^FBAAA(DFN,1,FTP,0)),U,22),1:"")
"RTN","FBAAPET",98,0)
 . D ^DIE
"RTN","FBAAPET",99,0)
 ; if adjustment data changed then file
"RTN","FBAAPET",100,0)
 I $$ADJL^FBUTL2(.FBADJ)'=FBADJL(0) D FILEADJ^FBAAFA(FBDA_","_FBDA(1)_","_FBDA(2)_","_FBDA(3)_",",.FBADJ)
"RTN","FBAAPET",101,0)
 ; if remit remark data changed then file
"RTN","FBAAPET",102,0)
 I $$RRL^FBUTL4(.FBRRMK)'=FBRRMKL(0) D FILERR^FBAAFR(FBDA_","_FBDA(1)_","_FBDA(2)_","_FBDA(3)_",",.FBRRMK)
"RTN","FBAAPET",103,0)
 ; if FPPS CLAIM ID changed, update other line items on invoice
"RTN","FBAAPET",104,0)
 I FBFPPSC'=FBFPPSC(0) D
"RTN","FBAAPET",105,0)
 . N FBAAIN
"RTN","FBAAPET",106,0)
 . S FBAAIN=$$GET1^DIQ(162.03,FBDA_","_FBDA(1)_","_FBDA(2)_","_FBDA(3)_",",14)
"RTN","FBAAPET",107,0)
 . D CKINVEDI^FBAAPET1(FBFPPSC(0),FBFPPSC,FBAAIN,FBDA_","_FBDA(1)_","_FBDA(2)_","_FBDA(3)_",")
"RTN","FBAAPET",108,0)
 K FBSV W !! G SERV
"RTN","FBAAPET",109,0)
 ;
"RTN","FBAAPET",110,0)
BADDATE(FBDOS,INVRCVDT) ;Reject entry if InvRcvDt is Prior to the Date of Service on the Invoice
"RTN","FBAAPET",111,0)
 I INVRCVDT<FBDOS D  Q 1 ;Reject entry
"RTN","FBAAPET",112,0)
 .N SHOWDOS S SHOWDOS=$E(FBDOS,4,5)_"/"_$E(FBDOS,6,7)_"/"_$E(FBDOS,2,3) ;Convert FBDOS into display format for error message
"RTN","FBAAPET",113,0)
 .W *7,!!?5,"*** Invoice Received Date cannot be prior to the",!?8,"Date of Service ("_SHOWDOS_") !!!"
"RTN","FBAAPET",114,0)
 Q 0 ;Accept entry
"RTN","FBAAPET",115,0)
 ;
"RTN","FBAAPET",116,0)
END K DR,DIC,DIE,X,DFN,FBOT,FBVD,FBSD,BAT,FBAADT,FBSV,DA,FBDA,FBZ,FBDUZ,FBAACP,FBFY,FY,FBAMTPD,J,K,Y,ZZ,PRC,FBHOLDX,FBV,FBSDI,FBAACPI
"RTN","FBAAPET",117,0)
 K FBFSAMT,FBFSUSD,FBMODA,FBZIP,FBTIME,FBHCFA(30),FBAAPTC,FB1725,FBADJ,FBADJD,FBADJL(0),FBRRMK,FBRRMKD,FBRRMKL(0),FBX,FBUNITS
"RTN","FBAAPET",118,0)
 Q
"RTN","FBAAV0")
0^15^B46795465^B44344317
"RTN","FBAAV0",1,0)
FBAAV0 ;AISC/GRR - ELECTRONICALLY TRANSMIT FEE DATA ;3/22/2012
"RTN","FBAAV0",2,0)
 ;;3.5;FEE BASIS;**3,4,55,89,98,116,108,132,139**;JAN 30, 1995;Build 127
"RTN","FBAAV0",3,0)
 ;;Per VA Directive 6402, this routine should not be modified.
"RTN","FBAAV0",4,0)
 ;
"RTN","FBAAV0",5,0)
 ; References to API $$CODEABA^ICDEX supported by ICR #5747
"RTN","FBAAV0",6,0)
 ;
"RTN","FBAAV0",7,0)
 K ^TMP($J,"FBAABATCH"),^TMP($J,"FBVADAT") D DT^DICRW
"RTN","FBAAV0",8,0)
 I '$D(^FBAA(161.7,"AC","S")),'$D(^FBAA(161.7,"AC","R")),'$D(^FBAA(161.25,"AE")),$S('$D(^FBAA(161.26,"AC","P")):1,$O(^FBAA(161.26,"AC","P",0))'>0:1,1:0) W !,*7,"There are no transactions requiring transmission",*7 Q
"RTN","FBAAV0",9,0)
 W !!,"This option will transmit all Batches and MRA's ready to be transmitted",!,"to Austin"
"RTN","FBAAV0",10,0)
RD W !! S DIR(0)="Y",DIR("A")="Are you sure you want to continue",DIR("B")="No" D ^DIR K DIR G END:'Y
"RTN","FBAAV0",11,0)
 L +^FBAA(161.7,"AC"):0 G:'$T LOCK^FBAAUTL1
"RTN","FBAAV0",12,0)
 W !!,"The following Batches will be transmitted: " F FBSTAT="S","R" F J=0:0 S J=$O(^FBAA(161.7,"AC",FBSTAT,J)) Q:J'>0  S FBATCH=$G(^FBAA(161.7,J,0)) D
"RTN","FBAAV0",13,0)
 .Q:'+FBATCH
"RTN","FBAAV0",14,0)
 .I (FBSTAT="S"&($P(FBATCH,U,15)="Y"))!(+$P(FBATCH,U,9)) S ^TMP($J,"FBAABATCH",J)="" W !,+FBATCH
"RTN","FBAAV0",15,0)
RTRAN ;Entry from Re-transmit MRA routine
"RTN","FBAAV0",16,0)
 D ADDRESS^FBAAV01 G END:VATERR K VAT
"RTN","FBAAV0",17,0)
 D WAIT^DICD,STATION^FBAAUTL,HD^FBAAUTL I $D(FB("ERROR")) G END
"RTN","FBAAV0",18,0)
 S TOTSTR=0,$P(PAD," ",200)=" "
"RTN","FBAAV0",19,0)
 D ^FBAAV1:$D(^FBAA(161.25,"AE"))
"RTN","FBAAV0",20,0)
 D ^FBAAV4:$D(^FBAA(161.26,"AC","P"))
"RTN","FBAAV0",21,0)
 F J=0:0 S J=$O(^TMP($J,"FBAABATCH",J)) Q:J'>0  I $D(^FBAA(161.7,J,0)) S Y(0)=^(0) D SET1,DET:FBAABT="B3",DETP^FBAAV2:FBAABT="B5",DETT^FBAAV3:FBAABT="B2",^FBAAV5:FBAABT="B9"
"RTN","FBAAV0",22,0)
END L -^FBAA(161.7,"AC") D KILL^FBAAV1 Q
"RTN","FBAAV0",23,0)
SET1 ; build the payment batch header string (used by all four formats)
"RTN","FBAAV0",24,0)
 S FBAABN=$P(Y(0),"^",1),FBAABN=$E("00000",$L(FBAABN)+1,5)_FBAABN
"RTN","FBAAV0",25,0)
 S FBAAON=$E($P(Y(0),"^",2),3,6)
"RTN","FBAAV0",26,0)
 S FBAACD=$$AUSDT^FBAAV3(DT)
"RTN","FBAAV0",27,0)
 S FBAACP=$E($P(Y(0),"^",2),1,2)
"RTN","FBAAV0",28,0)
 S FBAABT=$P(Y(0),"^",3)
"RTN","FBAAV0",29,0)
 S FBAAAP=$$AUSAMT^FBAAV3($P(Y(0),"^",9),11)
"RTN","FBAAV0",30,0)
 S FBSTAT=$P(^FBAA(161.7,J,"ST"),"^")
"RTN","FBAAV0",31,0)
 S FBCHB=$P(Y(0),"^",15)
"RTN","FBAAV0",32,0)
 S FBEXMPT=$P(Y(0),"^",18)
"RTN","FBAAV0",33,0)
 S X=$$SUB^FBAAUTL5(+$P(Y(0),U,8)_"-"_$P(Y(0),U,2))
"RTN","FBAAV0",34,0)
 S FBAASN=$$LJ^XLFSTR($S(X]"":X,1:FBAASN),6," ")
"RTN","FBAAV0",35,0)
 I FBSTAT="R"!(FBSTAT="S"&(FBCHB'["Y"))!(FBSTAT="S"&($G(FBEXMPT)="Y")) S FBSTR=FBHD_$S(FBAABT="B2":"BT",1:FBAABT)_FBAACD_FBAASN_FBAABN_" "_FBAAAP_FBAACP_" $"
"RTN","FBAAV0",36,0)
 Q
"RTN","FBAAV0",37,0)
DET ;entry point to process B3 (outpatient/ancillary) batch
"RTN","FBAAV0",38,0)
 ; input (partial list)
"RTN","FBAAV0",39,0)
 ;   J      - Batch IEN in file 161.7
"RTN","FBAAV0",40,0)
 ;   FBAAON - last 4 of obligation number
"RTN","FBAAV0",41,0)
 ;   FBAASN - station number (formatted)
"RTN","FBAAV0",42,0)
 S FBTXT=0
"RTN","FBAAV0",43,0)
 D CKB3V^FBAAV01 I $G(FBERR) K FBERR Q
"RTN","FBAAV0",44,0)
 ; HIPAA 5010 - line items that have 0.00 amount paid are now required to go to Central Fee
"RTN","FBAAV0",45,0)
 ;F K=0:0 S K=$O(^FBAAC("AC",J,K)) Q:K'>0  F L=0:0 S L=$O(^FBAAC("AC",J,K,L)) Q:L'>0  F M=0:0 S M=$O(^FBAAC("AC",J,K,L,M)) Q:M'>0  F N=0:0 S N=$O(^FBAAC("AC",J,K,L,M,N)) Q:N'>0  S Y(0)=$G(^FBAAC(K,1,L,1,M,1,N,0)) I Y(0)]"",+$P(Y(0),U,3) D
"RTN","FBAAV0",46,0)
 F K=0:0 S K=$O(^FBAAC("AC",J,K)) Q:K'>0  F L=0:0 S L=$O(^FBAAC("AC",J,K,L)) Q:L'>0  F M=0:0 S M=$O(^FBAAC("AC",J,K,L,M)) Q:M'>0  F N=0:0 S N=$O(^FBAAC("AC",J,K,L,M,N)) Q:N'>0  S Y(0)=$G(^FBAAC(K,1,L,1,M,1,N,0)) I Y(0)]"" D
"RTN","FBAAV0",47,0)
 .N FBDTSR1,FBPICN
"RTN","FBAAV0",48,0)
 .S FBDTSR1=+$G(^FBAAC(K,1,L,1,M,0))
"RTN","FBAAV0",49,0)
 .S FBPICN=K_U_L_U_M_U_N
"RTN","FBAAV0",50,0)
 .S FBPICN=$$ORGICN^FBAAVR5(162.03,FBPICN)
"RTN","FBAAV0",51,0)
 .S FBY=$G(^FBAAC(K,1,L,1,M,1,N,2))
"RTN","FBAAV0",52,0)
 .S FBY3=$G(^FBAAC(K,1,L,1,M,1,N,3))
"RTN","FBAAV0",53,0)
 .I 'FBTXT S FBTXT=1 D NEWMSG^FBAAV01,STORE^FBAAV01,UPD
"RTN","FBAAV0",54,0)
 .D GOT
"RTN","FBAAV0",55,0)
 ;
"RTN","FBAAV0",56,0)
 D:FBTXT XMIT^FBAAV01
"RTN","FBAAV0",57,0)
 Q
"RTN","FBAAV0",58,0)
 ;
"RTN","FBAAV0",59,0)
GOT ; process a B3 line item
"RTN","FBAAV0",60,0)
 ;
"RTN","FBAAV0",61,0)
 N DFN,FBADJ,FBADJA1,FBADJA2,FBADJR1,FBADJR2,FBADMIT,FBAUTHF,FBIENS
"RTN","FBAAV0",62,0)
 N FBMOD1,FBMOD2,FBMOD3,FBMOD4,FBPNAMX,FBUNITS,FBX,FBNPI
"RTN","FBAAV0",63,0)
 N FBCSID,FBEDIF,FBCNTRN
"RTN","FBAAV0",64,0)
 ;
"RTN","FBAAV0",65,0)
 S FBIENS=N_","_M_","_L_","_K_","
"RTN","FBAAV0",66,0)
 ;
"RTN","FBAAV0",67,0)
 S FBEDIF=$S($P($G(^FBAAC(K,1,L,1,M,1,N,3)),"^")]"":"Y",1:" ") ;EDI flag
"RTN","FBAAV0",68,0)
 ; get CPT modifiers
"RTN","FBAAV0",69,0)
 D
"RTN","FBAAV0",70,0)
 . N FBMODA,FBMODL
"RTN","FBAAV0",71,0)
 . D MODDATA^FBAAUTL4(K,L,M,N)
"RTN","FBAAV0",72,0)
 . S FBMODL=$$MODL^FBAAUTL4("FBMODA","E")
"RTN","FBAAV0",73,0)
 . S FBMOD1=$$RJ^XLFSTR($P(FBMODL,",",1),5," ")
"RTN","FBAAV0",74,0)
 . S FBMOD2=$$RJ^XLFSTR($P(FBMODL,",",2),5," ")
"RTN","FBAAV0",75,0)
 . S FBMOD3=$$RJ^XLFSTR($P(FBMODL,",",3),5," ")
"RTN","FBAAV0",76,0)
 . S FBMOD4=$$RJ^XLFSTR($P(FBMODL,",",4),5," ")
"RTN","FBAAV0",77,0)
 ;
"RTN","FBAAV0",78,0)
 S FBPAYT=$P(Y(0),"^",20),FBPAYT=$S(FBPAYT]"":FBPAYT,1:"V")
"RTN","FBAAV0",79,0)
 ;
"RTN","FBAAV0",80,0)
 S FBVID=$P($G(^FBAAV(L,0)),U,2)
"RTN","FBAAV0",81,0)
 S FBVID=FBVID_$E(PAD,$L(FBVID)+1,11)
"RTN","FBAAV0",82,0)
 S:FBPAYT="R" FBVID=$E(PAD,1,11)
"RTN","FBAAV0",83,0)
 S FBNPI=$$EN^FBNPILK(L)  ;SET THE NPI TO BE PASSED TO FBAAV01,FBAAV2,FBAAV5
"RTN","FBAAV0",84,0)
 ;
"RTN","FBAAV0",85,0)
 D POV^FBAAUTL2
"RTN","FBAAV0",86,0)
 S POV=$S(POV']"":"",POV="A":6,POV="B":7,POV="C":8,POV="D":9,POV="E":10,1:POV)
"RTN","FBAAV0",87,0)
 S POV=$S(POV']"":99,$D(^FBAA(161.82,POV,0)):$P(^(0),"^",3),1:99)
"RTN","FBAAV0",88,0)
 S FBPOV=POV
"RTN","FBAAV0",89,0)
 S FBTT=$S(FBTT]"":FBTT,1:1)
"RTN","FBAAV0",90,0)
 S FBCPT=$$CPT^FBAAUTL4($P(Y(0),"^")),FBCPT=$S($L(FBCPT)=5:FBCPT,1:"     ")
"RTN","FBAAV0",91,0)
 S FBPSA=$$PSA^FBAAV5(+$P(Y(0),U,12),+FBAASN) I $L(+FBPSA)'=3 S FBPSA=999
"RTN","FBAAV0",92,0)
 S FBPATT=$P(Y(0),"^",17),FBPATT=$S(FBPATT]"":FBPATT,1:10)
"RTN","FBAAV0",93,0)
 S FBTD=$$AUSDT^FBAAV3(FBDTSR1) ; formatted treatment date
"RTN","FBAAV0",94,0)
 S FBSUSP=$P(Y(0),"^",5),FBSUSP=$S(FBSUSP]"":FBSUSP,1:" ")
"RTN","FBAAV0",95,0)
 S FBSUSP=$S(FBSUSP=" ":" ",$D(^FBAA(161.27,+FBSUSP,0)):$P(^(0),"^"),1:" ")
"RTN","FBAAV0",96,0)
 S FBAP=$$AUSAMT^FBAAV3($P(Y(0),"^",3),8) ; amount paid
"RTN","FBAAV0",97,0)
 S FBPOS=+$P(Y(0),"^",25),FBPOS=$S(FBPOS:$P(^IBE(353.1,FBPOS,0),"^"),1:"  ")
"RTN","FBAAV0",98,0)
 S FBHCFA=+$P(Y(0),"^",26),FBHCFA=$S(FBHCFA:$P(^IBE(353.2,FBHCFA,0),"^"),1:""),FBHCFA=$E(PAD,$L(FBHCFA)+1,2)_FBHCFA
"RTN","FBAAV0",99,0)
 S FBVTOS=+$P(Y(0),"^",24),FBVTOS=$S(FBVTOS:$P(^FBAA(163.85,FBVTOS,0),"^",2),1:"  ")
"RTN","FBAAV0",100,0)
 ; FB*3.5*139-DEM-Modifications for ICD-10 remediation
"RTN","FBAAV0",101,0)
 S FBPD=+$P(Y(0),"^",23)
"RTN","FBAAV0",102,0)
 S FBPD=$S(FBPD:$$ICD9^FBCSV1(FBPD,$G(FBDTSR1)),1:"")
"RTN","FBAAV0",103,0)
 ; decimal is stripped only from ICD-10 diagnosis codes.
"RTN","FBAAV0",104,0)
 I FBPD'="",$$CODEABA^ICDEX(FBPD,80,30)>0 S:FBPD["." FBPD=$P(FBPD,".",1)_$P(FBPD,".",2)
"RTN","FBAAV0",105,0)
 S FBPD=$E(PAD,$L(FBPD)+1,7)_FBPD
"RTN","FBAAV0",106,0)
 ; End 139
"RTN","FBAAV0",107,0)
 S FBINVN=$P(Y(0),"^",16)
"RTN","FBAAV0",108,0)
 S FBINVN=$E("000000000",$L(FBINVN)+1,9)_FBINVN
"RTN","FBAAV0",109,0)
 S FBAUTHF=$S($P(Y(0),U,13)["FB583":"U",1:"A") ; auth/unauth flag
"RTN","FBAAV0",110,0)
 S FBDIN=$$AUSDT^FBAAV3($P(Y(0),"^",15)) ; invoice date rec'd
"RTN","FBAAV0",111,0)
 S FBADMIT=$$AUSDT^FBAAV3($$B3ADMIT(FBIENS)) ; formatted admission date
"RTN","FBAAV0",112,0)
 ;
"RTN","FBAAV0",113,0)
 S VAPA("P")=""
"RTN","FBAAV0",114,0)
 S DFN=K
"RTN","FBAAV0",115,0)
 ; Note - before this point Y(0) was the 0 node of subfile #162.03
"RTN","FBAAV0",116,0)
 ;      - after this point Y(0) will be the 0 node of file #2
"RTN","FBAAV0",117,0)
 S Y(0)=$G(^DPT(+K,0)) Q:Y(0)']""
"RTN","FBAAV0",118,0)
 D PAT^FBAAUTL2
"RTN","FBAAV0",119,0)
 ; obtain date of birth, must follow call to PAT^FBAAUTL2 to overwrite 
"RTN","FBAAV0",120,0)
 ; the value returned from it
"RTN","FBAAV0",121,0)
 S FBDOB=$$AUSDT^FBAAV3($P(Y(0),"^",3)) ; date of birth
"RTN","FBAAV0",122,0)
 D ADD^VADPT
"RTN","FBAAV0",123,0)
 S FBPNAMX=$$HL7NAME^FBAAV2(DFN) ; patient name
"RTN","FBAAV0",124,0)
 S FBUNITS=$P(FBY,U,14)
"RTN","FBAAV0",125,0)
 S:FBUNITS<1 FBUNITS=1
"RTN","FBAAV0",126,0)
 S FBUNITS=$$RJ^XLFSTR(FBUNITS,5,0) ; volume indicator (units paid)
"RTN","FBAAV0",127,0)
 S FBCSID=$$LJ^XLFSTR($P(FBY,"^",16),20," ") ; patient acct #
"RTN","FBAAV0",128,0)
 D
"RTN","FBAAV0",129,0)
 . N FBCNTRP
"RTN","FBAAV0",130,0)
 . S FBCNTRP=$P(FBY3,"^",8)
"RTN","FBAAV0",131,0)
 . S FBCNTRN=$S(FBCNTRP:$P($G(^FBAA(161.43,FBCNTRP,0)),"^"),1:"")
"RTN","FBAAV0",132,0)
 . S FBCNTRN=$$LJ^XLFSTR(FBCNTRN,20," ") ; contract number
"RTN","FBAAV0",133,0)
 ;
"RTN","FBAAV0",134,0)
 ; get and format adjustment reason codes and amounts (if any)
"RTN","FBAAV0",135,0)
 D LOADADJ^FBAAFA(FBIENS,.FBADJ)
"RTN","FBAAV0",136,0)
 S FBX=$$ADJL^FBUTL2(.FBADJ)
"RTN","FBAAV0",137,0)
 S FBADJR1=$$RJ^XLFSTR($P(FBX,U,1),5," ")
"RTN","FBAAV0",138,0)
 S FBADJA1=$$AUSAMT^FBAAV3($P(FBX,U,3),9,1)
"RTN","FBAAV0",139,0)
 S FBADJR2=$$RJ^XLFSTR($P(FBX,U,4),5," ")
"RTN","FBAAV0",140,0)
 S FBADJA2=$$AUSAMT^FBAAV3($P(FBX,U,6),9,1)
"RTN","FBAAV0",141,0)
 K FBADJ,FBX
"RTN","FBAAV0",142,0)
 ;
"RTN","FBAAV0",143,0)
 S FBST=$S($P(VAPA(5),"^")="":"  ",$D(^DIC(5,$P(VAPA(5),"^"),0)):$P(^(0),"^",2),1:"  ")
"RTN","FBAAV0",144,0)
 I $L(FBST)>2 S FBST="**"
"RTN","FBAAV0",145,0)
 S:$L(FBST)'=2 FBST=$E(PAD,$L(FBST)+1,2)_FBST
"RTN","FBAAV0",146,0)
 S FBCTY=$S($P(VAPA(7),"^",1)="":"   ",FBST="  ":"   ",$D(^DIC(5,$P(VAPA(5),"^"),1,$P(VAPA(7),"^"),0)):$P(^(0),"^",3),1:"   ")
"RTN","FBAAV0",147,0)
 I $L(FBCTY)'=3 S FBCTY=$E("000",$L(FBCTY)+1,3)_FBCTY
"RTN","FBAAV0",148,0)
 S FBZIP=$S('+$G(VAPA(11)):VAPA(6),+VAPA(11):$P(VAPA(11),U),1:VAPA(6)),FBZIP=$TR(FBZIP,"-","")_$E("000000000",$L(FBZIP)+1,9)
"RTN","FBAAV0",149,0)
 D STRING^FBAAV01
"RTN","FBAAV0",150,0)
 Q
"RTN","FBAAV0",151,0)
 ;
"RTN","FBAAV0",152,0)
UPD ; update the batch file
"RTN","FBAAV0",153,0)
 N Y
"RTN","FBAAV0",154,0)
 S DA=J,(DIC,DIE)="^FBAA(161.7,"
"RTN","FBAAV0",155,0)
 S DR="11////^S X=""T"";12////^S X=DT"
"RTN","FBAAV0",156,0)
 D ^DIE
"RTN","FBAAV0",157,0)
 Q
"RTN","FBAAV0",158,0)
 ;
"RTN","FBAAV0",159,0)
STORE D STORE^FBAAV01 Q
"RTN","FBAAV0",160,0)
 ;
"RTN","FBAAV0",161,0)
B3ADMIT(FBIENS) ; Determine Admission Date for a B3 payment line item
"RTN","FBAAV0",162,0)
 ; input
"RTN","FBAAV0",163,0)
 ;   FBIENS - IENS (FileMan format) for subfile 162.03 entry
"RTN","FBAAV0",164,0)
 ; returns admission date in internal FileMan format or null value
"RTN","FBAAV0",165,0)
 ;
"RTN","FBAAV0",166,0)
 N FB7078,FBRET
"RTN","FBAAV0",167,0)
 S FBRET=""
"RTN","FBAAV0",168,0)
 S FB7078=$$GET1^DIQ(162.03,FBIENS,27,"I") ; associated 7078/583
"RTN","FBAAV0",169,0)
 ; (the unauthorized ancillary claims will have the treatment date
"RTN","FBAAV0",170,0)
 ;  instead of the inpatient admission date so nothing is sent to
"RTN","FBAAV0",171,0)
 ;  Austin for them)
"RTN","FBAAV0",172,0)
 ;
"RTN","FBAAV0",173,0)
 ; if line items points to a 7078 authorization then return a date
"RTN","FBAAV0",174,0)
 I $P(FB7078,";",2)="FB7078(" D
"RTN","FBAAV0",175,0)
 . N FBY
"RTN","FBAAV0",176,0)
 . S FBY=$G(^FB7078(+FB7078,0))
"RTN","FBAAV0",177,0)
 . ; if fee program is civil hospital then return 7078 date of admission
"RTN","FBAAV0",178,0)
 . I $P(FBY,U,11)=6 S FBRET=$P(FBY,U,15)
"RTN","FBAAV0",179,0)
 . ; if fee program is CNH then return 7078 authorized from date
"RTN","FBAAV0",180,0)
 . I $P(FBY,U,11)=7 S FBRET=$P(FBY,U,4)
"RTN","FBAAV0",181,0)
 ;
"RTN","FBAAV0",182,0)
 Q FBRET
"RTN","FBAAV5")
0^16^B80128865^B71438715
"RTN","FBAAV5",1,0)
FBAAV5 ;AISC/GRR - CREATE TRANSACTIONS FOR CH/CNH PAYMENTS ;11 Apr 2006  2:54 PM
"RTN","FBAAV5",2,0)
 ;;3.5;FEE BASIS;**3,55,89,98,116,108,139**;JAN 30, 1995;Build 127
"RTN","FBAAV5",3,0)
 ;;Per VA Directive 6402, this routine should not be modified.
"RTN","FBAAV5",4,0)
 ;
"RTN","FBAAV5",5,0)
 ; Reference to API $$CODEABA^ICDEX supported by ICR #5747
"RTN","FBAAV5",6,0)
 ;
"RTN","FBAAV5",7,0)
 D CKB9V^FBAAV01 I $G(FBERR) K FBERR Q
"RTN","FBAAV5",8,0)
 G:FBSTAT="S"&(FBCHB="Y")&($P(Y(0),"^",18)'="Y") ^FBAAV6
"RTN","FBAAV5",9,0)
DETCH S FBTXT=0
"RTN","FBAAV5",10,0)
 ; HIPAA 5010 - line items that have 0.00 amount paid are now required to go to Central Fee
"RTN","FBAAV5",11,0)
 ;F K=0:0 S K=$O(^FBAAI("AC",J,K)) Q:K'>0  S Y(0)=$G(^FBAAI(K,0)),Y(2)=$G(^(2)) I Y(0)]"",+$P(Y(0),U,9) D
"RTN","FBAAV5",12,0)
 F K=0:0 S K=$O(^FBAAI("AC",J,K)) Q:K'>0  S Y(0)=$G(^FBAAI(K,0)),Y(2)=$G(^(2)),Y(5)=$G(^(5)) I Y(0)]"" D
"RTN","FBAAV5",13,0)
 .N FBPICN,FBY
"RTN","FBAAV5",14,0)
 .S FBPICN=K
"RTN","FBAAV5",15,0)
 .S FBY=$S($P(Y(2),U,2):$P(Y(2),U,2),1:$P(Y(0),U,2))_U_+$P(Y(2),U,3)
"RTN","FBAAV5",16,0)
 .I 'FBTXT S FBTXT=1 D NEWMSG^FBAAV01,STORE^FBAAV01,UPD^FBAAV0
"RTN","FBAAV5",17,0)
 .D GOT
"RTN","FBAAV5",18,0)
 D:FBTXT XMIT^FBAAV01 Q
"RTN","FBAAV5",19,0)
GOT ; process an inpatient invoice
"RTN","FBAAV5",20,0)
 N DFN,FBADJ,FBADJA,FBADJR,FBADMIT,FBAUTHF,FBCDAYS,FBDISDT,FBDISTY,FBNPI
"RTN","FBAAV5",21,0)
 N FBDRG,FBIENS,FBPA,FBPNAMX,FBVMID,FBX
"RTN","FBAAV5",22,0)
 N FB4LN,FBADMTDX,FBCSVDT,FBCSID,FBEDIF,FBCNTRN
"RTN","FBAAV5",23,0)
 S FBIENS=K_","
"RTN","FBAAV5",24,0)
 S FBCSVDT=$$FRDTINV^FBCSV1(K)
"RTN","FBAAV5",25,0)
 I '$L($G(FBAASN)) D STATION^FBAAUTL
"RTN","FBAAV5",26,0)
 S FBPSA=$$PSA(+$P(Y(0),U,20),+$G(FBAASN)) I $L(+FBPSA)'=3 S FBPSA=999
"RTN","FBAAV5",27,0)
 S FBPAYT=$P(Y(0),"^",13),FBPAYT=$S(FBPAYT]"":FBPAYT,1:"V")
"RTN","FBAAV5",28,0)
 S L=$P(Y(0),"^",3)
"RTN","FBAAV5",29,0)
 S FBVID=$S($D(^FBAAV(L,0)):$P(^(0),"^",2),1:"")
"RTN","FBAAV5",30,0)
 S FBNPI=$$EN^FBNPILK(L)
"RTN","FBAAV5",31,0)
 S FBVID=FBVID_$E(PAD,$L(FBVID)+1,11)
"RTN","FBAAV5",32,0)
 S:FBPAYT="R" FBVID=$E(PAD,1,11)
"RTN","FBAAV5",33,0)
 S FBVMID=$S($D(^FBAAV(L,0)):$P(^(0),"^",17),1:"")
"RTN","FBAAV5",34,0)
 S FBVMID=$E(PAD,$L(FBVMID)+1,6)_FBVMID
"RTN","FBAAV5",35,0)
 S POV=$P(Y(0),"^",18)
"RTN","FBAAV5",36,0)
 S POV=$S(POV']"":"",POV="A":6,POV="B":7,POV="C":8,POV="D":9,POV="E":10,1:POV),POV=$S(POV']"":40,$D(^FBAA(161.82,POV,0)):$P(^(0),"^",3),1:40),FBPOV=POV
"RTN","FBAAV5",37,0)
 S FBPATT=$P(Y(0),"^",19),FBPATT=$S(FBPATT]"":FBPATT,1:10)
"RTN","FBAAV5",38,0)
 S FBFTD=$$AUSDT^FBAAV3($P(Y(0),"^",6)) ; from treatment date
"RTN","FBAAV5",39,0)
 S FBTTD=$$AUSDT^FBAAV3($P(Y(0),"^",7)) ; to treatment date
"RTN","FBAAV5",40,0)
 S FBSUSP=$P(Y(0),"^",11),FBSUSP=$S(FBSUSP="":" ",$D(^FBAA(161.27,FBSUSP,0)):$P(^(0),"^",1),1:" ")
"RTN","FBAAV5",41,0)
 S FBINVN=$P(Y(0),"^",1)
"RTN","FBAAV5",42,0)
 S FBINVN=$E("000000000",$L(FBINVN)+1,9)_FBINVN
"RTN","FBAAV5",43,0)
 S FBDIN=$$AUSDT^FBAAV3($P(Y(0),"^",2)) ; invoice date rec'd
"RTN","FBAAV5",44,0)
 S FBAP=$$AUSAMT^FBAAV3($P(Y(0),"^",9),9)
"RTN","FBAAV5",45,0)
 S FBAC=$$AUSAMT^FBAAV3($P(Y(0),"^",8),9)
"RTN","FBAAV5",46,0)
 S FBPA=$$AUSAMT^FBAAV3($P(Y(0),"^",26),9)
"RTN","FBAAV5",47,0)
 S FBDRG=$P(Y(0),"^",24),FBDRG=$E(PAD,$L(FBDRG)+1,4)_FBDRG
"RTN","FBAAV5",48,0)
 S FBAUTHF=$S($P(Y(0),U,5)["FB583":"U",1:"A") ; auth/unauth flag
"RTN","FBAAV5",49,0)
 S FBCSID=$$LJ^XLFSTR($P(Y(2),"^",11),20," ") ; patient acct #
"RTN","FBAAV5",50,0)
 S FBADMTDX=$P(Y(5),"^",9) ; admitting Dx pointer
"RTN","FBAAV5",51,0)
 D
"RTN","FBAAV5",52,0)
 . N FBCNTRP
"RTN","FBAAV5",53,0)
 . S FBCNTRP=$P(Y(5),"^",8)
"RTN","FBAAV5",54,0)
 . S FBCNTRN=$S(FBCNTRP:$P($G(^FBAA(161.43,FBCNTRP,0)),"^"),1:"")
"RTN","FBAAV5",55,0)
 . S FBCNTRN=$$LJ^XLFSTR(FBCNTRN,20," ") ; contract number
"RTN","FBAAV5",56,0)
 S FBEDIF=$S($P($G(^FBAAI(K,3)),"^")]"":"Y",1:" ") ;EDI flag
"RTN","FBAAV5",57,0)
 ;
"RTN","FBAAV5",58,0)
 K FBDX
"RTN","FBAAV5",59,0)
 S FBDX(0)="       " ; initialize admitting Dx transmitted value to 7 spaces
"RTN","FBAAV5",60,0)
 F M=1:1:25 S FBDX(M)="        "  ;8 spaces
"RTN","FBAAV5",61,0)
 I FBADMTDX D
"RTN","FBAAV5",62,0)
 . N FBX
"RTN","FBAAV5",63,0)
 . S FBX=$$ICD9^FBCSV1(FBADMTDX,FBCSVDT)
"RTN","FBAAV5",64,0)
 . Q:FBX=""
"RTN","FBAAV5",65,0)
 . ;DEM;139 ICD-10 Project - decimal is stripped only from ICD-10 diagnosis codes and not ICD-9 diagnosis codes.
"RTN","FBAAV5",66,0)
 . I $$CODEABA^ICDEX(FBX,80,30)>0 S:FBX["." FBX=$P(FBX,".",1)_$P(FBX,".",2)  ;DEM;139 ICD-10 Project
"RTN","FBAAV5",67,0)
 . S FBDX(0)=FBX_$E("       ",$L(FBX)+1,7)
"RTN","FBAAV5",68,0)
 S FBYDX=$G(^FBAAI(K,"DX")),FBYPOA=$G(^FBAAI(K,"POA"))
"RTN","FBAAV5",69,0)
 F M=1:1:25 Q:$P(FBYDX,"^",M)=""  D
"RTN","FBAAV5",70,0)
 . S FBDX(M)=$$DX($P(FBYDX,"^",M),FBCSVDT,$P(FBYPOA,"^",M))
"RTN","FBAAV5",71,0)
 K FBYDX,FBYPOA
"RTN","FBAAV5",72,0)
 ;
"RTN","FBAAV5",73,0)
 K FBPRC
"RTN","FBAAV5",74,0)
 F M=1:1:25 S FBPRC(M)="       "  ;7 SPACES
"RTN","FBAAV5",75,0)
 S FBYPROC=$G(^FBAAI(K,"PROC"))
"RTN","FBAAV5",76,0)
 F M=1:1:25 Q:$P(FBYPROC,"^",M)=""  D
"RTN","FBAAV5",77,0)
 . S FBPRC(M)=$$PROC($P(FBYPROC,"^",M),FBCSVDT)
"RTN","FBAAV5",78,0)
 K FBYPROC
"RTN","FBAAV5",79,0)
 ;
"RTN","FBAAV5",80,0)
 S DFN=$P(Y(0),"^",4)
"RTN","FBAAV5",81,0)
 ; Note: Prior to the following line Y(0) = the 0 node of file 162.5
"RTN","FBAAV5",82,0)
 ;After the line Y(0) will equal the 0 node of file #2
"RTN","FBAAV5",83,0)
 S VAPA("P")="",Y(0)=$S($D(^DPT(DFN,0)):^(0),1:"")
"RTN","FBAAV5",84,0)
 D PAT^FBAAUTL2
"RTN","FBAAV5",85,0)
 ; obtain date of birth, must follow call to PAT^FBAAUTL2 to overwrite 
"RTN","FBAAV5",86,0)
 ; the value returned from it
"RTN","FBAAV5",87,0)
 S FBDOB=$$AUSDT^FBAAV3($P(Y(0),"^",3))
"RTN","FBAAV5",88,0)
 D ADD^VADPT
"RTN","FBAAV5",89,0)
 S FBPNAMX=$$HL7NAME^FBAAV2(DFN) ; patient name
"RTN","FBAAV5",90,0)
 S FBST=$S($P(VAPA(5),"^",1)="":"  ",$D(^DIC(5,$P(VAPA(5),"^",1),0)):$P(^(0),"^",2),1:"  ")
"RTN","FBAAV5",91,0)
 I $L(FBST)>2 S FBST="**"
"RTN","FBAAV5",92,0)
 S:$L(FBST)'=2 FBST=$E(PAD,$L(FBST)+1,2)_FBST
"RTN","FBAAV5",93,0)
 S FBCTY=$S($P(VAPA(7),"^",1)="":"   ",FBST="  ":"   ",$D(^DIC(5,$P(VAPA(5),"^",1),1,$P(VAPA(7),"^",1),0)):$P(^(0),"^",3),1:"   ")
"RTN","FBAAV5",94,0)
 I $L(FBCTY)'=3 S FBCTY=$E("000",$L(FBCTY)+1,3)_FBCTY
"RTN","FBAAV5",95,0)
 S FBZIP=$S('+$G(VAPA(11)):VAPA(6),+VAPA(11):$P(VAPA(11),U),1:VAPA(6)),FBZIP=$TR(FBZIP,"-","")_$E("000000000",$L(FBZIP)+1,9)
"RTN","FBAAV5",96,0)
 S FBADMIT=$$AUSDT^FBAAV3($P($$B9ADMIT(FBIENS),".")) ; admission date
"RTN","FBAAV5",97,0)
 ; get and format discharge date and type
"RTN","FBAAV5",98,0)
 S FBX=$$B9DISCHG(FBIENS)
"RTN","FBAAV5",99,0)
 S FBDISDT=$$AUSDT^FBAAV3($P($P(FBX,U),".")) ; discharge date
"RTN","FBAAV5",100,0)
 S FBDISTY=$$RJ^XLFSTR($P(FBX,U,2),3,0) ; discharge type
"RTN","FBAAV5",101,0)
 K FBX
"RTN","FBAAV5",102,0)
 ; get volume indicator (covered days)
"RTN","FBAAV5",103,0)
 S FBCDAYS=$$RJ^XLFSTR($$GET1^DIQ(162.5,FBIENS,54),5,"0")
"RTN","FBAAV5",104,0)
 ; obtain and format the adjustment codes and amounts
"RTN","FBAAV5",105,0)
 ; get and format adjustment reason codes and amounts (if any)
"RTN","FBAAV5",106,0)
 D LOADADJ^FBCHFA(FBIENS,.FBADJ)
"RTN","FBAAV5",107,0)
 S FBX=$$ADJL^FBUTL2(.FBADJ)
"RTN","FBAAV5",108,0)
 S FBADJR=$$RJ^XLFSTR($P(FBX,U,1),5," ")
"RTN","FBAAV5",109,0)
 S FBADJA=$$AUSAMT^FBAAV3($P(FBX,U,3),10,1)
"RTN","FBAAV5",110,0)
 K FBADJ,FBX
"RTN","FBAAV5",111,0)
 ;
"RTN","FBAAV5",112,0)
 ; determine if 4th line needed (set FB4LN =1 when true)
"RTN","FBAAV5",113,0)
 S FB4LN=1 I FBDX(11)="        ",FBPRC(11)="       " S FB4LN=0
"RTN","FBAAV5",114,0)
 ;
"RTN","FBAAV5",115,0)
 ; build 1st line
"RTN","FBAAV5",116,0)
 S FBSTR=9_FBAASN_FBSSN_FBPAYT_FBPNAMX_FBVID_"  "_FBAP_FBAAON_FBSUSP
"RTN","FBAAV5",117,0)
 S FBSTR=FBSTR_FBPOV_FBPATT_FBFTD_FBTTD_FBDIN_FBINVN_FBVMID
"RTN","FBAAV5",118,0)
 S FBSTR=FBSTR_$E(PAD,1,33)_FBST_FBCTY_FBZIP ; reserved for foreign addr
"RTN","FBAAV5",119,0)
 S FBSTR=FBSTR_FBPSA_$P(FBY,U,2)_$E(PAD,1,14)
"RTN","FBAAV5",120,0)
 F I=1:1:5 S FBSTR=FBSTR_FBDX(I)
"RTN","FBAAV5",121,0)
 S FBSTR=FBSTR_"~"
"RTN","FBAAV5",122,0)
 D STORE^FBAAV01
"RTN","FBAAV5",123,0)
 ;
"RTN","FBAAV5",124,0)
 ; build 2nd line
"RTN","FBAAV5",125,0)
 S FBSTR=$$PADZ^FBAAV01(FBPICN,23)_$$AUSDT^FBAAV3(+FBY)
"RTN","FBAAV5",126,0)
 F I=1:1:5 S FBSTR=FBSTR_FBPRC(I)
"RTN","FBAAV5",127,0)
 S FBSTR=FBSTR_FBAC_FBPA_FBDRG_" "_FBADMIT_FBDISDT_FBDOB_FBDISTY_FBCDAYS_FBAUTHF_FBADJR_FBADJA_FBNPI_FBDX(0)_FBCSID_FBEDIF_FBCNTRN
"RTN","FBAAV5",128,0)
 S FBSTR=FBSTR_$E(PAD,1,32)_"~" ; reserved for IPAC data
"RTN","FBAAV5",129,0)
 D STORE^FBAAV01
"RTN","FBAAV5",130,0)
 ;
"RTN","FBAAV5",131,0)
 ; build 3rd line
"RTN","FBAAV5",132,0)
 S FBSTR=""
"RTN","FBAAV5",133,0)
 F I=6:1:10 S FBSTR=FBSTR_FBDX(I)
"RTN","FBAAV5",134,0)
 F I=6:1:10 S FBSTR=FBSTR_FBPRC(I)
"RTN","FBAAV5",135,0)
 S FBSTR=FBSTR_"~"
"RTN","FBAAV5",136,0)
 S:'FB4LN FBSTR=FBSTR_"$"
"RTN","FBAAV5",137,0)
 D STORE^FBAAV01
"RTN","FBAAV5",138,0)
 ;
"RTN","FBAAV5",139,0)
 ; build 4th line (if needed)
"RTN","FBAAV5",140,0)
 I FB4LN D
"RTN","FBAAV5",141,0)
 . S FBSTR=""
"RTN","FBAAV5",142,0)
 . F I=11:1:25 S FBSTR=FBSTR_FBDX(I)
"RTN","FBAAV5",143,0)
 . F I=11:1:25 S FBSTR=FBSTR_FBPRC(I)
"RTN","FBAAV5",144,0)
 . S FBSTR=FBSTR_"~$"
"RTN","FBAAV5",145,0)
 . D STORE^FBAAV01
"RTN","FBAAV5",146,0)
 Q
"RTN","FBAAV5",147,0)
 ;
"RTN","FBAAV5",148,0)
PSA(X,Y) ;call to set default Primary Service Area (PSA)
"RTN","FBAAV5",149,0)
 ;to send to Austin.
"RTN","FBAAV5",150,0)
 ;X = pointer to the institution file
"RTN","FBAAV5",151,0)
 ;Y = default if unable to determine station number in file 4
"RTN","FBAAV5",152,0)
 ;call returns the 3 digit station number only
"RTN","FBAAV5",153,0)
 ;if Y undef return '0'
"RTN","FBAAV5",154,0)
 I '$G(Y) S Y=0
"RTN","FBAAV5",155,0)
 Q $S('X:+Y,$E($P($G(^DIC(4,+X,99)),U),1,3)'?3N:+Y,1:$E($P($G(^(99)),U),1,3))
"RTN","FBAAV5",156,0)
 ;
"RTN","FBAAV5",157,0)
B9ADMIT(FBIENS) ; Determine Admission Date for a B9 payment
"RTN","FBAAV5",158,0)
 ; input
"RTN","FBAAV5",159,0)
 ;   FBIENS
"RTN","FBAAV5",160,0)
 ; returns admission date in internal FileMan format or null value
"RTN","FBAAV5",161,0)
 N FB7078,FBRET
"RTN","FBAAV5",162,0)
 S FBRET=""  ;NULL
"RTN","FBAAV5",163,0)
 ;
"RTN","FBAAV5",164,0)
 S FB7078=$$GET1^DIQ(162.5,FBIENS,4,"I") ; associated 7078/583
"RTN","FBAAV5",165,0)
 ;
"RTN","FBAAV5",166,0)
 ; if invoice points to a 7078 authorization then get date from the 7078
"RTN","FBAAV5",167,0)
 I $P(FB7078,";",2)="FB7078(" D
"RTN","FBAAV5",168,0)
 . N FBY
"RTN","FBAAV5",169,0)
 . S FBY=$G(^FB7078(+FB7078,0))
"RTN","FBAAV5",170,0)
 . ; if fee program is civil hospital then return 7078 date of admission
"RTN","FBAAV5",171,0)
 . I $P(FBY,U,11)=6 S FBRET=$P(FBY,U,15)
"RTN","FBAAV5",172,0)
 . ; if fee program is CNH then return 7078 authorized from date
"RTN","FBAAV5",173,0)
 . I $P(FBY,U,11)=7 S FBRET=$P(FBY,U,4)
"RTN","FBAAV5",174,0)
 ;
"RTN","FBAAV5",175,0)
 ; if invoice points to an unauthorized claim then use the treatment from
"RTN","FBAAV5",176,0)
 ;   date on the unauthorized claim
"RTN","FBAAV5",177,0)
 I $P(FB7078,";",2)="FB583(" D
"RTN","FBAAV5",178,0)
 . N FBY
"RTN","FBAAV5",179,0)
 . S FBY=$G(^FB583(+FB7078,0))
"RTN","FBAAV5",180,0)
 . S FBRET=$P(FBY,U,5)
"RTN","FBAAV5",181,0)
 ;
"RTN","FBAAV5",182,0)
 ; return the result
"RTN","FBAAV5",183,0)
 Q FBRET
"RTN","FBAAV5",184,0)
 ;
"RTN","FBAAV5",185,0)
B9DISCHG(FBIENS) ; Determine Discharge Date and Type for a B9 payment
"RTN","FBAAV5",186,0)
 ; input
"RTN","FBAAV5",187,0)
 ;   FBIENS - Invoice IEN (file 162.5) with trailing comma
"RTN","FBAAV5",188,0)
 ; returns discharge date in internal FileMan format or null value and
"RTN","FBAAV5",189,0)
 ; discharge type or null value
"RTN","FBAAV5",190,0)
 N FB7078,FBDISDT,FBDISTY
"RTN","FBAAV5",191,0)
 S (FBDISDT,FBDISTY)=""
"RTN","FBAAV5",192,0)
 ;
"RTN","FBAAV5",193,0)
 S FB7078=$$GET1^DIQ(162.5,FBIENS,4,"I") ; associated 7078/583
"RTN","FBAAV5",194,0)
 ;
"RTN","FBAAV5",195,0)
 ; if invoice points to an unauthorized claim then use the treatment to
"RTN","FBAAV5",196,0)
 ;   date on the unauthorized claim
"RTN","FBAAV5",197,0)
 I $P(FB7078,";",2)="FB583(" D
"RTN","FBAAV5",198,0)
 . N FBY
"RTN","FBAAV5",199,0)
 . S FBY=$G(^FB583(+FB7078,0))
"RTN","FBAAV5",200,0)
 . S FBDISDT=$P(FBY,U,6)
"RTN","FBAAV5",201,0)
 . S FBDISTY=$$GET1^DIQ(162.5,FBIENS,"6.5:1") ; discharge type
"RTN","FBAAV5",202,0)
 ;
"RTN","FBAAV5",203,0)
 ; if invoice points to a 7078 authorization then get date from the 7078
"RTN","FBAAV5",204,0)
 I $P(FB7078,";",2)="FB7078(" D
"RTN","FBAAV5",205,0)
 . N FBY
"RTN","FBAAV5",206,0)
 . S FBY=$G(^FB7078(+FB7078,0))
"RTN","FBAAV5",207,0)
 . ;
"RTN","FBAAV5",208,0)
 . ; if fee program is civil hospital then return 7078 date of discharge
"RTN","FBAAV5",209,0)
 . I $P(FBY,U,11)=6 D
"RTN","FBAAV5",210,0)
 . . S FBDISDT=$P(FBY,U,16) ; discharge date
"RTN","FBAAV5",211,0)
 . . S FBDISTY=$$GET1^DIQ(162.5,FBIENS,"6.5:1") ; discharge type
"RTN","FBAAV5",212,0)
 . ;
"RTN","FBAAV5",213,0)
 . ; if fee program is CNH then get date & type from CNH activity file
"RTN","FBAAV5",214,0)
 . I $P(FBY,U,11)=7 D
"RTN","FBAAV5",215,0)
 . . N DFN,FBADMIT,FBADMITR,FBACTA,FBAUTHP,FBDA,FBDTR
"RTN","FBAAV5",216,0)
 . . S DFN=$P(FBY,U,3) ; patient IEN
"RTN","FBAAV5",217,0)
 . . S FBADMIT=$P($P(FBY,U,4),".") ; CNH admission date
"RTN","FBAAV5",218,0)
 . . S FBAUTHP=+$O(^FBAAA("AG",FB7078,DFN,0)) ; authorization 'pointer'
"RTN","FBAAV5",219,0)
 . . ;
"RTN","FBAAV5",220,0)
 . . ; find the admission entry in CNH ACTIVITY file   
"RTN","FBAAV5",221,0)
 . . S FBACTA=0 ; init the admission activity ien
"RTN","FBAAV5",222,0)
 . . S FBADMITR=9999999-FBADMIT ; reverse admission date
"RTN","FBAAV5",223,0)
 . . S FBDTR=9999999-$$FMADD^XLFDT(FBADMIT,1) ; start loop
"RTN","FBAAV5",224,0)
 . . F  S FBDTR=$O(^FBAACNH("AF",DFN,FBDTR)) Q:'FBDTR!($P(FBDTR,".")>FBADMITR)  D  Q:FBACTA
"RTN","FBAAV5",225,0)
 . . . S FBDA=0 F  S FBDA=$O(^FBAACNH("AF",DFN,FBDTR,FBDA)) Q:'FBDA  D
"RTN","FBAAV5",226,0)
 . . . . S FBY=$G(^FBAACNH(FBDA,0))
"RTN","FBAAV5",227,0)
 . . . . I $P(FBY,U,3)="A",$P(FBY,U,10)=FBAUTHP S FBACTA=FBDA ; found it
"RTN","FBAAV5",228,0)
 . . Q:'FBACTA  ; could not find the admission activity
"RTN","FBAAV5",229,0)
 . . ;
"RTN","FBAAV5",230,0)
 . . ; get date from associated discharge (if any) in CNH ACTIVITY file
"RTN","FBAAV5",231,0)
 . . S FBDA=" "
"RTN","FBAAV5",232,0)
 . . F  S FBDA=$O(^FBAACNH("AC",FBACTA,FBDA),-1) Q:FBDA'>0  D  Q:FBDISDT
"RTN","FBAAV5",233,0)
 . . . S FBY=$G(^FBAACNH(FBDA,0))
"RTN","FBAAV5",234,0)
 . . . I $P(FBY,U,3)="D" D
"RTN","FBAAV5",235,0)
 . . . . S FBDISDT=$P($P(FBY,U),".")
"RTN","FBAAV5",236,0)
 . . . . S FBDISTY=$P(FBY,U,8)
"RTN","FBAAV5",237,0)
 . . . . I FBDISTY'="" S FBDISTY=FBDISTY+100
"RTN","FBAAV5",238,0)
 ;
"RTN","FBAAV5",239,0)
 ; return the result
"RTN","FBAAV5",240,0)
 Q FBDISDT_"^"_FBDISTY
"RTN","FBAAV5",241,0)
 ;
"RTN","FBAAV5",242,0)
DX(FBDX,FBDATE,FBPOA) ; format diagnosis & POA for B9
"RTN","FBAAV5",243,0)
 ; Input
"RTN","FBAAV5",244,0)
 ;   FBDX   = pointer to file 80 (ICD diagnosis)
"RTN","FBAAV5",245,0)
 ;   FBDATE = fileman date
"RTN","FBAAV5",246,0)
 ;   FBPOA  = (optional) poiner to file 161.94 (present on admission)
"RTN","FBAAV5",247,0)
 ; Returns formatted string of 8 characters
"RTN","FBAAV5",248,0)
 N FBRET,FBX,FBX2
"RTN","FBAAV5",249,0)
 S FBRET="        "
"RTN","FBAAV5",250,0)
 I FBDX D
"RTN","FBAAV5",251,0)
 . S FBX=$$ICD9^FBCSV1(FBDX,FBDATE)
"RTN","FBAAV5",252,0)
 . Q:FBX=""
"RTN","FBAAV5",253,0)
 . ;DEM;139 ICD-10 Project - decimal is stripped only from ICD-10 diagnosis codes and not ICD-9 diagnosis codes.
"RTN","FBAAV5",254,0)
 . I $$CODEABA^ICDEX(FBX,80,30)>0 S:FBX["." FBX=$P(FBX,".",1)_$P(FBX,".",2)  ;DEM;139 ICD-10 Project
"RTN","FBAAV5",255,0)
 . S FBX=FBX_$E("       ",$L(FBX)+1,7)
"RTN","FBAAV5",256,0)
 . S FBX2=$S($G(FBPOA):$P($G(^FB(161.94,FBPOA,0)),"^"),1:"")
"RTN","FBAAV5",257,0)
 . S:FBX2="" FBX2=" "
"RTN","FBAAV5",258,0)
 . S FBRET=FBX_FBX2
"RTN","FBAAV5",259,0)
 Q FBRET
"RTN","FBAAV5",260,0)
 ;
"RTN","FBAAV5",261,0)
PROC(FBPROC,FBDATE) ; format procedure for B9
"RTN","FBAAV5",262,0)
 ; Input
"RTN","FBAAV5",263,0)
 ;   FBPROC = pointer to file 80.1 (ICD operation/procedure)
"RTN","FBAAV5",264,0)
 ;   FBDATE = fileman date
"RTN","FBAAV5",265,0)
 ; Returns formatted string of 7 characters
"RTN","FBAAV5",266,0)
 N FBRET,FBX
"RTN","FBAAV5",267,0)
 S FBRET="       "
"RTN","FBAAV5",268,0)
 I FBPROC D
"RTN","FBAAV5",269,0)
 . S FBX=$$ICD0^FBCSV1(FBPROC,FBDATE)
"RTN","FBAAV5",270,0)
 . Q:FBX=""
"RTN","FBAAV5",271,0)
 . S FBX=FBX_$E("       ",$L(FBX)+1,7)
"RTN","FBAAV5",272,0)
 . S FBRET=FBX
"RTN","FBAAV5",273,0)
 Q FBRET
"RTN","FBAAV5",274,0)
 ;
"RTN","FBAAV5",275,0)
 ;FBAAV5
"RTN","FBASF")
0^4^B105506974^n/a
"RTN","FBASF",1,0)
FBASF ;AISC/JLG - ICD10 DIAGNOSIS CODE ASF (Advanced Search Functionality) ;3/26/2012
"RTN","FBASF",2,0)
 ;;3.5;FEE BASIS;**139**;JAN 30, 1995;Build 127
"RTN","FBASF",3,0)
 ;;Per VA Directive 6402, this routine should not be modified.
"RTN","FBASF",4,0)
 ;
"RTN","FBASF",5,0)
 ; Reference to API $$CODEN^ICDEX supported by ICR #5747
"RTN","FBASF",6,0)
 ;
"RTN","FBASF",7,0)
 ;Prompt for ICD10 diagnosis entries  
"RTN","FBASF",8,0)
 ; params, 1-Diagnosis prompt
"RTN","FBASF",9,0)
 ;         2-prompt line number (null if no number)
"RTN","FBASF",10,0)
 ;         3-allow up arrow (^) flag (optional) -if this is set to "Y" then the up arrow will be accepted for early exit
"RTN","FBASF",11,0)
 ;         4-allow deletion of DX field? (optional)  -if this is set to "Y", @ is an acceptable entry
"RTN","FBASF",12,0)
 ;         5-allow forcing a field to be required (optional)  -if this is set to "Y", the field will be forced to be required
"RTN","FBASF",13,0)
ASKICD10(DXPRMPT,LNNUM,ALWUPA,ALDEL,ALFREQ) ;
"RTN","FBASF",14,0)
 N FBOUT,FBDC,ICDRET,FBTMP,FBPRMPT  S FBDC=""
"RTN","FBASF",15,0)
 S FBPRMPT=DXPRMPT_LNNUM
"RTN","FBASF",16,0)
 S ICDRET=$$EN(EDATE,FBDC) ; EDATE must be assigned prior to calling this s/r. It represents 'date of interest'
"RTN","FBASF",17,0)
 D EXIT
"RTN","FBASF",18,0)
 Q ICDRET ;returns the value of ien or -1
"RTN","FBASF",19,0)
 ; 
"RTN","FBASF",20,0)
EN(EFFDATE,X) ; -- params 1-date of interest 2-diagnosis code
"RTN","FBASF",21,0)
 N FBQUIT,FBRETV,FBPARAM,FBCSYS,FBOUT,FBDFN
"RTN","FBASF",22,0)
 D SETPARAM(.FBPARAM) ; set screen messages
"RTN","FBASF",23,0)
 S FBDT=EFFDATE,FBFILE=DP,FBIEN=DA,FBDFLT="",FBRETV=0,FBOUT=""
"RTN","FBASF",24,0)
 S:$D(DFN) FBDFN=DFN
"RTN","FBASF",25,0)
 ; 161.01 is the sub-field authorization in fee basis patient file
"RTN","FBASF",26,0)
 S:FBFILE="161.01" FBDFLT=$$GETDC^FBASFU(FBFILE,FBDFN,FBIEN)
"RTN","FBASF",27,0)
 ; 162.7 is the unauthorized claim funds file
"RTN","FBASF",28,0)
 S:FBFILE="162.7" FBDFLT=$$GETDCUC^FBASFU(FBFILE,FBIEN)
"RTN","FBASF",29,0)
 S:FBDFLT']"" FBDFLT=$$GETVAL^FBASFU(FBFILE,FBIEN,FBPARAM("FIELD_NAME")) ; set default value if applicable
"RTN","FBASF",30,0)
 ;
"RTN","FBASF",31,0)
EN1 ; 
"RTN","FBASF",32,0)
 S FBRETV=$$DIAG10(FBDT,FBDFLT,.FBPARAM)
"RTN","FBASF",33,0)
 I (FBRETV']"")!(FBRETV<0) Q FBRETV
"RTN","FBASF",34,0)
 I FBRETV="@" Q FBRETV ; don't print labels for deletions
"RTN","FBASF",35,0)
 S FBRETV=$$PRTICD10^FBASFU(FBRETV) ; prints ICD code and description to the screen
"RTN","FBASF",36,0)
 S FBRETV=$P($P(FBRETV,"^"),";")
"RTN","FBASF",37,0)
 G:FBRETV=-1 EN1
"RTN","FBASF",38,0)
 Q FBRETV ; returns IEN file #80 or -1
"RTN","FBASF",39,0)
 ;//---------
"RTN","FBASF",40,0)
 ;The entry point for ICD-10 diagnosis search functionality
"RTN","FBASF",41,0)
 ;input parameters :
"RTN","FBASF",42,0)
 ; FBDT - date of interest
"RTN","FBASF",43,0)
 ; FBDFLT - default values for the search string (can be a code by default)
"RTN","FBASF",44,0)
 ; FBPARAM - parameters/string constants (see SETPARAM for details)
"RTN","FBASF",45,0)
 ;returns ICD-10 code selected by the user:
"RTN","FBASF",46,0)
 ;  IEN file #80;ICD code value^description
"RTN","FBASF",47,0)
 ; results
"RTN","FBASF",48,0)
 ; or -1 if invalid data(press enter)
"RTN","FBASF",49,0)
 ; "" if not found 
"RTN","FBASF",50,0)
 ; or -2 if time out
"RTN","FBASF",51,0)
 ; or -3 if ^ or ^^
"RTN","FBASF",52,0)
 ; or -4 in ICD10 if the usre answered NO for the question "Do you wish to continue(Y/N)?"
"RTN","FBASF",53,0)
 ; or -5 if deletion of DX field is attempted
"RTN","FBASF",54,0)
 ; 
"RTN","FBASF",55,0)
DIAG10(FBDT,FBDFLT,FBPARAM) ;
"RTN","FBASF",56,0)
 N FBINP,FBTMP,FBREQFLDMP
"RTN","FBASF",57,0)
 S:'$D(ALWUPA) ALWUPA="N" ; up arrow allow flag
"RTN","FBASF",58,0)
 S:'$D(ALDEL) ALDEL="N" ; delete allow flag
"RTN","FBASF",59,0)
 S:'$D(ALFREQ) ALFREQ="N" ; force required allow flag
"RTN","FBASF",60,0)
ASKAGAIN ;
"RTN","FBASF",61,0)
 S FBINP=$$SRCHSTR(FBPARAM("SEARCH_PROMPT"),FBPARAM("HELP ?"),FBPARAM("HELP ??"),FBDFLT)
"RTN","FBASF",62,0)
 ;user should enter at least 2 characters
"RTN","FBASF",63,0)
 I FBINP'<0 I $L($P(FBINP,U,2))'>1 W !!,FBPARAM("ENTER MORE") W:$L(FBPARAM("ENTER MORE2"))>0 !,FBPARAM("ENTER MORE2") W ! G ASKAGAIN
"RTN","FBASF",64,0)
 ; return values from SRCHSTR function ... $D(DTOUT) -2, $D(DUOUT) -3, Y["^" -3, Y="" -1, otherwise 0_U_Y
"RTN","FBASF",65,0)
 Q:FBINP=-2 FBINP ; timed out
"RTN","FBASF",66,0)
 Q:(ALWUPA="Y")&(FBINP=-3) FBINP ; "^" entered
"RTN","FBASF",67,0)
 S FBREQFLD=$$REQFLD^FBASFU(FBFILE,FBPARAM("FIELD_NAME"))
"RTN","FBASF",68,0)
 I ((ALFREQ="Y")&(FBINP=-5)) S FBREQFLD=0
"RTN","FBASF",69,0)
 I ((FBINP=-5)&('FBREQFLD)) W FBPARAM("REQUIRED") G ASKAGAIN
"RTN","FBASF",70,0)
 I ALDEL="Y",FBINP=-5,$G(FBDFLT)="" S ALDEL="N"
"RTN","FBASF",71,0)
 I ALDEL="Y",FBINP=-5 N FBYN D  Q:FBYN=1 "@" G ASKAGAIN
"RTN","FBASF",72,0)
 . S FBYN=$$QUESTION^FBASF(2,"SURE YOU WANT TO DELETE")
"RTN","FBASF",73,0)
 . I FBYN'=1 W FBPARAM("NOTHING DELETED")
"RTN","FBASF",74,0)
 I FBINP=-5 W "??" G ASKAGAIN
"RTN","FBASF",75,0)
 I ((FBREQFLD=-1)&(FBINP=-3)) W !,FBPARAM("EXIT NOT ALLOWED") G ASKAGAIN
"RTN","FBASF",76,0)
 Q:((FBREQFLD=-1)&(FBINP'[U)) FBINP ; if not a required field and NOT a valid search string for icd code
"RTN","FBASF",77,0)
 I FBINP=-1 D   ; if a space is entered for a required field
"RTN","FBASF",78,0)
 . W "??"
"RTN","FBASF",79,0)
 . I FBPARAM("SEARCH_PROMPT")["ADMITTING DIAGNOSIS" W !,FBPARAM("ENTER ADM DIAG")
"RTN","FBASF",80,0)
 I ((FBREQFLD=0)&(FBINP=-1)) G ASKAGAIN ;space entered for required field
"RTN","FBASF",81,0)
 I FBINP=-3 W !,FBPARAM("EXIT NOT ALLOWED") G ASKAGAIN ;^ entered for all ICD fields
"RTN","FBASF",82,0)
 S FBTMP=$$STATCHK^FBASFU($P(FBINP,U,2),FBDT) ; check if icd code is inactive
"RTN","FBASF",83,0)
 G:FBTMP=-1 ASKAGAIN ; If icd code is inactive
"RTN","FBASF",84,0)
 N FBMATCH S FBMATCH=$$ISMATCH($P(FBINP,U,2))
"RTN","FBASF",85,0)
 S FBINP=$$LEXICD10($P(FBINP,U,2),FBDT,.FBPARAM)
"RTN","FBASF",86,0)
 G:FBINP=-4 ASKAGAIN ; if the threshold for the results is reached and user wants to refine search criteria
"RTN","FBASF",87,0)
 I FBINP']"" W !,FBPARAM("NO MATCHES FOUND") I FBPARAM("SEARCH_PROMPT")["ADMITTING DIAGNOSIS" W !,"  ",FBPARAM("ENTER ADM DIAG")
"RTN","FBASF",88,0)
 G:FBINP']"" ASKAGAIN
"RTN","FBASF",89,0)
 G:FBINP=-1 ASKAGAIN
"RTN","FBASF",90,0)
 Q FBINP_"^"_FBMATCH
"RTN","FBASF",91,0)
 ;
"RTN","FBASF",92,0)
 ;input parameter - diagnosis code
"RTN","FBASF",93,0)
 ;Returns 0 (zero) if diagnosis code is an exact match, otherwise return -1
"RTN","FBASF",94,0)
ISMATCH(FBDCDE) ;
"RTN","FBASF",95,0)
 N FBMFLG S FBMFLG=-1 ;set default to -1
"RTN","FBASF",96,0)
 S:$$CODEN^ICDEX(FBDCDE,80)>0 FBMFLG=0
"RTN","FBASF",97,0)
 Q FBMFLG
"RTN","FBASF",98,0)
 ;--------------
"RTN","FBASF",99,0)
 ;The entry point for ICD-10 diagnosis search functionality
"RTN","FBASF",100,0)
 ;can be called from applications directly
"RTN","FBASF",101,0)
 ; Supported ICR 5681 ($$DIAGSRCH^LEX10CS)
"RTN","FBASF",102,0)
 ;input parameters :
"RTN","FBASF",103,0)
 ; FBTXT - search string
"RTN","FBASF",104,0)
 ; FBDATE - date of interest
"RTN","FBASF",105,0)
 ; FBPAR - array with text messages and other string constants
"RTN","FBASF",106,0)
 ;returns ICD-10 code selected by the user:
"RTN","FBASF",107,0)
 ;  IEN file #80;ICD code value^description
"RTN","FBASF",108,0)
 ; or 
"RTN","FBASF",109,0)
 ; "" if not found 
"RTN","FBASF",110,0)
 ; -1 if exit : ^ or ^^
"RTN","FBASF",111,0)
 ; -2 if continue searching
"RTN","FBASF",112,0)
 ;
"RTN","FBASF",113,0)
LEXICD10(FBTXT,FBDATE,FBPAR) ; ICD-10 Search
"RTN","FBASF",114,0)
 N FBLVTXT
"RTN","FBASF",115,0)
 ;parameters check
"RTN","FBASF",116,0)
 S FBDATE=+$G(FBDATE)
"RTN","FBASF",117,0)
 I FBDATE'?7N Q -1
"RTN","FBASF",118,0)
 S FBTXT=$G(FBTXT)
"RTN","FBASF",119,0)
 Q:'$L(FBTXT) -1
"RTN","FBASF",120,0)
 N FBNUMB
"RTN","FBASF",121,0)
 S FBNUMB=$$FREQ^LEXU(FBTXT)
"RTN","FBASF",122,0)
 I FBNUMB>$$MAX^LEXU(30) D  I $$QUESTION(2,FBPARAM("WISH CONTINUE"),FBPARAM("YES OR NO"))'=1 Q -4
"RTN","FBASF",123,0)
 . D FORMWRIT(FBPAR("EXCEEDS MESSAGE1")_FBTXT_FBPAR("EXCEEDS MESSAGE2")_FBNUMB_FBPAR("EXCEEDS MESSAGE3")_FBTXT_""".",0)
"RTN","FBASF",124,0)
 . D FORMWRIT("",2)
"RTN","FBASF",125,0)
 ;new and set variables
"RTN","FBASF",126,0)
 N DIROUT,DUOUT,DTOUT,FBEXIT,FBICDNT
"RTN","FBASF",127,0)
 N FBRETV,FBXX,FBLEVEL
"RTN","FBASF",128,0)
 S FBRETV=""
"RTN","FBASF",129,0)
 S FBEXIT=0
"RTN","FBASF",130,0)
 S FBLEVEL=1,FBLVTXT(FBLEVEL)=FBTXT ;level 1 stores the original search string
"RTN","FBASF",131,0)
 ; main loop
"RTN","FBASF",132,0)
 F  Q:FBEXIT>0  D
"RTN","FBASF",133,0)
 .K FBICDY
"RTN","FBASF",134,0)
 .;get the search string from the current level and call LEX API
"RTN","FBASF",135,0)
 .S FBICDY=$$DIAGSRCH^LEX10CS(FBLVTXT(FBLEVEL),.FBICDY,FBDATE,30)
"RTN","FBASF",136,0)
 .S:$O(FBICDY(" "),-1)>0 FBICDY=+FBICDY
"RTN","FBASF",137,0)
 .; Nothing found
"RTN","FBASF",138,0)
 .I +FBICDY'>0 S FBEXIT=1 S FBXX=-1 Q
"RTN","FBASF",139,0)
 .; Single match found for partial text search
"RTN","FBASF",140,0)
 .I FBMATCH<0,FBLEVEL=1,FBICDY=1 S FBMATCH=0
"RTN","FBASF",141,0)
 .; display the list of items and ask the user to select the item from the list
"RTN","FBASF",142,0)
 .S FBXX=$$SEL^FBASFL(.FBICDY,8)
"RTN","FBASF",143,0)
 .; if ^ was entered 
"RTN","FBASF",144,0)
 .;   if this is on the top level then quit 
"RTN","FBASF",145,0)
 .I FBXX=-2,FBLEVEL'>1 S FBRETV=-1 S FBEXIT=1 Q
"RTN","FBASF",146,0)
 .;   if lower level then go one level up
"RTN","FBASF",147,0)
 .I FBXX=-2,FBLEVEL>1 S:FBLEVEL>1 FBLEVEL=FBLEVEL-1 Q
"RTN","FBASF",148,0)
 .; If timeout, or not selected, or ^^ then quit
"RTN","FBASF",149,0)
 .I FBXX=-1 S FBRETV=-1 S FBEXIT=1 Q
"RTN","FBASF",150,0)
 .; if Code Found and Selected by the user save selection in FBRETV and quit
"RTN","FBASF",151,0)
 .I $P(FBXX,";")'="99:CAT" S FBRETV=FBXX S FBEXIT=1 Q
"RTN","FBASF",152,0)
 .; If Category Found and Selected by the user:  
"RTN","FBASF",153,0)
 .;  go to the next inner level
"RTN","FBASF",154,0)
 .;  change level number 
"RTN","FBASF",155,0)
 .S FBLEVEL=FBLEVEL+1
"RTN","FBASF",156,0)
 .;  set the new level with the new search string
"RTN","FBASF",157,0)
 .;  and repeat 
"RTN","FBASF",158,0)
 .S FBLVTXT(FBLEVEL)=$P($P($G(FBXX),"^"),";",2)
"RTN","FBASF",159,0)
 Q FBRETV
"RTN","FBASF",160,0)
 ;
"RTN","FBASF",161,0)
 ; Look-up help for ?
"RTN","FBASF",162,0)
INPHLP ;
"RTN","FBASF",163,0)
 I $G(X)["???" D INPHLP3 Q
"RTN","FBASF",164,0)
 I $G(X)["??" D INPHLP2 Q
"RTN","FBASF",165,0)
 W !," Enter code or ""text"" for more information." Q
"RTN","FBASF",166,0)
 Q
"RTN","FBASF",167,0)
 ;-----------
"RTN","FBASF",168,0)
 ; Look-up help for ??
"RTN","FBASF",169,0)
INPHLP2 ;
"RTN","FBASF",170,0)
 W !," Enter a ""free text"" term or part of a term such as ""femur fracture""."
"RTN","FBASF",171,0)
 W !!," or "
"RTN","FBASF",172,0)
 W !!," Enter a ""classification code"" (ICD/CPT etc) to find the single term"
"RTN","FBASF",173,0)
 W !," associated with the code."
"RTN","FBASF",174,0)
 W !!," or "
"RTN","FBASF",175,0)
 W !!," Enter a ""partial code"". Include the decimal when a search criterion"
"RTN","FBASF",176,0)
 W !," includes 3 characters or more for code searches."
"RTN","FBASF",177,0)
 Q
"RTN","FBASF",178,0)
 ;--------
"RTN","FBASF",179,0)
 ; Look-up help for ???
"RTN","FBASF",180,0)
INPHLP3 ;
"RTN","FBASF",181,0)
 W !," Number of Code Matches"
"RTN","FBASF",182,0)
 W !," ----------------------"
"RTN","FBASF",183,0)
 W !!," The ICD-10 Diagnosis Code search will show the user the number of matches"
"RTN","FBASF",184,0)
 W !," found, indicate if additional characters in ICD code exist, and the number"
"RTN","FBASF",185,0)
 W !," of codes within the category or subcategory that are available for selection."
"RTN","FBASF",186,0)
 W !," For example:"
"RTN","FBASF",187,0)
 W !!," 14 matches found"
"RTN","FBASF",188,0)
 W !!," M91. - Juvenile osteochondrosis of hip and pelvis (19)"
"RTN","FBASF",189,0)
 W !!," This indicates that 14 unique matches or matching groups have been found"
"RTN","FBASF",190,0)
 W !," and will be displayed."
"RTN","FBASF",191,0)
 W !!," M91. - the ""-"" indicates that there are additional characters that specify"
"RTN","FBASF",192,0)
 W !," unique ICD-10 codes available."
"RTN","FBASF",193,0)
 W !!," (19) Indicates that there are 19 additional ICD-10 codes in the M91 ""family"""
"RTN","FBASF",194,0)
 W !," that are possible selections."
"RTN","FBASF",195,0)
 Q
"RTN","FBASF",196,0)
 ;--------
"RTN","FBASF",197,0)
 ;ask YES/NO questions
"RTN","FBASF",198,0)
 ;input parameters :
"RTN","FBASF",199,0)
 ; FBDFLT- 0/null- not default, 1- yes, 2 -no
"RTN","FBASF",200,0)
 ; FBPROM - prompt string
"RTN","FBASF",201,0)
 ; FBHELP - help text
"RTN","FBASF",202,0)
 ;returns 
"RTN","FBASF",203,0)
 ; 2 - no,
"RTN","FBASF",204,0)
 ; 1 -yes,
"RTN","FBASF",205,0)
 ; 0 - no answer (time out)
"RTN","FBASF",206,0)
 ; -3 - ^ or ^^
"RTN","FBASF",207,0)
 ; 0 - no answer
"RTN","FBASF",208,0)
QUESTION(FBDFLT,FBPROM,FBHELP) ;
"RTN","FBASF",209,0)
 N DIR
"RTN","FBASF",210,0)
 S %=$G(FBDFLT,2)
"RTN","FBASF",211,0)
 S DIR(0)="Y",DIR("A")=FBPROM,DIR("B")=$S(%=1:"Yes",%=2:"No",1:"")
"RTN","FBASF",212,0)
 S:$L($G(FBHELP)) DIR("?")=FBHELP
"RTN","FBASF",213,0)
 D ^DIR
"RTN","FBASF",214,0)
 Q:Y["^" -3
"RTN","FBASF",215,0)
 Q:Y=1 1
"RTN","FBASF",216,0)
 Q:Y=0 2
"RTN","FBASF",217,0)
 Q 0
"RTN","FBASF",218,0)
 ;
"RTN","FBASF",219,0)
 ;------------
"RTN","FBASF",220,0)
 ;get search string
"RTN","FBASF",221,0)
 ;input parameters :
"RTN","FBASF",222,0)
 ; FBPRMT prompt text
"RTN","FBASF",223,0)
 ; FBHLP1 "?" help text
"RTN","FBASF",224,0)
 ; FBHLP2 "??" help text
"RTN","FBASF",225,0)
 ; FBDFLT- default response
"RTN","FBASF",226,0)
 ;returns piece1 ^ piece 2
"RTN","FBASF",227,0)
 ; piece1:
"RTN","FBASF",228,0)
 ; 0 if normal input
"RTN","FBASF",229,0)
 ; or -1 if invalid data
"RTN","FBASF",230,0)
 ; or -2 if time out
"RTN","FBASF",231,0)
 ; or -3 if ^
"RTN","FBASF",232,0)
 ; or -5 if @
"RTN","FBASF",233,0)
 ; piece2: string entered by the user
"RTN","FBASF",234,0)
SRCHSTR(FBPRMT,FBHLP1,FBHLP2,FBDFLT) ;
"RTN","FBASF",235,0)
 N DIR
"RTN","FBASF",236,0)
 S DIR("A")=FBPRMT
"RTN","FBASF",237,0)
 S DIR("?")=FBHLP1
"RTN","FBASF",238,0)
 S DIR("??")=FBHLP2
"RTN","FBASF",239,0)
 I $L($G(FBDFLT)) S DIR("B")=FBDFLT
"RTN","FBASF",240,0)
 S DIR(0)="FAOr^0:245"
"RTN","FBASF",241,0)
 D ^DIR
"RTN","FBASF",242,0)
 Q:$D(DTOUT) -2
"RTN","FBASF",243,0)
 Q:$D(DUOUT) -3
"RTN","FBASF",244,0)
 Q:X="@" -5
"RTN","FBASF",245,0)
 Q:Y["^" -3
"RTN","FBASF",246,0)
 Q:Y="" -1
"RTN","FBASF",247,0)
 Q 0_U_Y
"RTN","FBASF",248,0)
 ;
"RTN","FBASF",249,0)
 ;set parameters
"RTN","FBASF",250,0)
 ;input parameters 
"RTN","FBASF",251,0)
 ; FBPAR - local array to sets and store string constants for your messages and prompts 
"RTN","FBASF",252,0)
SETPARAM(FBPAR) ;
"RTN","FBASF",253,0)
 S FBPAR("ASKDATE")="Date of interest? "
"RTN","FBASF",254,0)
 I FBPRMPT'[":" S FBPRMPT=FBPRMPT_": "
"RTN","FBASF",255,0)
 S FBPAR("SEARCH_PROMPT")=FBPRMPT
"RTN","FBASF",256,0)
 S FBPAR("HELP ?")="^D INPHLP^FBASF"
"RTN","FBASF",257,0)
 S FBPAR("HELP ??")="^D INPHLP2^FBASF"
"RTN","FBASF",258,0)
 S FBPAR("NO DATA FOUND")="  No data found"
"RTN","FBASF",259,0)
 S FBPAR("EXITING")="  Exiting"
"RTN","FBASF",260,0)
 S FBPAR("TRY LATER")="  Try again later"
"RTN","FBASF",261,0)
 S FBPAR("NO DATA SELECTED")="  No data selected"
"RTN","FBASF",262,0)
 S FBPAR("TRY ANOTHER")="Try another"
"RTN","FBASF",263,0)
 S FBPAR("WISH CONTINUE")="Do you wish to continue(Y/N)"
"RTN","FBASF",264,0)
 S FBPAR("EXCEEDS MESSAGE1")="Searching for """
"RTN","FBASF",265,0)
 S FBPAR("EXCEEDS MESSAGE2")=""" requires inspecting "
"RTN","FBASF",266,0)
 S FBPAR("EXCEEDS MESSAGE3")=" records to determine if they match the search criteria.  This could take quite some time.  Suggest refining the search by further specifying """
"RTN","FBASF",267,0)
 S FBPAR("NO MATCHES FOUND")="  No matches found??"
"RTN","FBASF",268,0)
 S FBPAR("ENTER ADM DIAG")="  Enter the admitting diagnosis for this claim."
"RTN","FBASF",269,0)
 S FBPAR("EXIT NOT ALLOWED")="   Exit not allowed??"
"RTN","FBASF",270,0)
 S FBPAR("ENTER MORE")=" Please enter at least the first two characters of the ICD-10 code or code"
"RTN","FBASF",271,0)
 S FBPAR("ENTER MORE2")=" description to start the search."
"RTN","FBASF",272,0)
 S FBPAR("YES OR NO")="Answer 'Y' for 'Yes' or 'N' for 'No'"
"RTN","FBASF",273,0)
 S FBPAR("NOTHING DELETED")="  <NOTHING DELETED>"
"RTN","FBASF",274,0)
 S FBPAR("REQUIRED")="??  Required"
"RTN","FBASF",275,0)
 N FBX S FBX=FBPRMPT
"RTN","FBASF",276,0)
 F  Q:(($E(FBX)'=" ")&($E(FBX)'?1C))  S FBX=$E(FBX,2,99) ; remove leading space or control chars.
"RTN","FBASF",277,0)
 S FBPAR("FIELD_NAME")=$P(FBX,":")
"RTN","FBASF",278,0)
 Q
"RTN","FBASF",279,0)
 ;
"RTN","FBASF",280,0)
 ;
"RTN","FBASF",281,0)
 ;a wrapper for ^DIWP
"RTN","FBASF",282,0)
 ;accumulates a text and then writes it to the device
"RTN","FBASF",283,0)
 ;input parameters :
"RTN","FBASF",284,0)
 ; X - text
"RTN","FBASF",285,0)
 ; FBMODE:
"RTN","FBASF",286,0)
 ;  0 - start
"RTN","FBASF",287,0)
 ;  1 - accumulate 
"RTN","FBASF",288,0)
 ;  2 - write
"RTN","FBASF",289,0)
 ;example:
"RTN","FBASF",290,0)
 ;D FORMWRIT^FBASF("this API is a wrapper for ^DIWP, it accumulates a text and then writes it to the device, you can use it in your application code",0)
"RTN","FBASF",291,0)
 ;D FORMWRIT^FBASF("some more text ",1)
"RTN","FBASF",292,0)
 ;D FORMWRIT^FBASF("",2)
"RTN","FBASF",293,0)
FORMWRIT(X,FBMODE) ;
"RTN","FBASF",294,0)
 N FBLI1
"RTN","FBASF",295,0)
 ;if "start" mode
"RTN","FBASF",296,0)
 I FBMODE=0 K ^UTILITY($J,"W")
"RTN","FBASF",297,0)
 S DIWL=1,DIWR=79
"RTN","FBASF",298,0)
 I $L(X)>0 D ^DIWP
"RTN","FBASF",299,0)
 ;if "write" mode
"RTN","FBASF",300,0)
 I FBMODE=2 D
"RTN","FBASF",301,0)
 . S FBLI1=0 F  S FBLI1=$O(^UTILITY($J,"W",1,FBLI1)) Q:+FBLI1=0  W !,$G(^UTILITY($J,"W",1,FBLI1,0))
"RTN","FBASF",302,0)
 . K ^UTILITY($J,"W")
"RTN","FBASF",303,0)
 Q
"RTN","FBASF",304,0)
 ;
"RTN","FBASF",305,0)
 ; Clean up environment and quit
"RTN","FBASF",306,0)
EXIT ;
"RTN","FBASF",307,0)
 K %,DIC,DIR,DIROUT,DIRUT,DTOUT,DUOUT,X,Y,%Y,FBDT,FBFILE,FBIEN,FBDFLT,FBOUT,FBREQFLD,DXPRMPT,LNNUM,DIWL,DIWR
"RTN","FBASF",308,0)
 Q
"RTN","FBASF",309,0)
 ;
"RTN","FBASFL")
0^5^B38523474^n/a
"RTN","FBASFL",1,0)
FBASFL ;AISC/JLG - Select ICD DIAGNOSIS FROM LEXICON UTILITY LIST ;03/26/2012
"RTN","FBASFL",2,0)
 ;;3.5;FEE BASIS;**139**;JAN 30, 1995;Build 127
"RTN","FBASFL",3,0)
 ;;Per VA Directive 6402, this routine should not be modified.
"RTN","FBASFL",4,0)
 ;
"RTN","FBASFL",5,0)
 ; Input   
"RTN","FBASFL",6,0)
 ; 
"RTN","FBASFL",7,0)
 ;     X     Length of list to display (default 5)
"RTN","FBASFL",8,0)
 ;    .FBSRL   Local array passed by reference
"RTN","FBASFL",9,0)
 ;               
"RTN","FBASFL",10,0)
 ;             FBSRL()   Input Array from ICDSRCH^LEX10CS
"RTN","FBASFL",11,0)
 ;               
"RTN","FBASFL",12,0)
 ;             FBSRL(0)=# found ^ Pruning Indicator
"RTN","FBASFL",13,0)
 ;             FBSRL(1,0)=Code ^ Code IEN ^ date
"RTN","FBASFL",14,0)
 ;             FBSRL(1,"IDL")=ICD-9/10 Description, Long
"RTN","FBASFL",15,0)
 ;             FBSRL(1,"IDL",1)=ICD-9/10 IEN ^ date
"RTN","FBASFL",16,0)
 ;             FBSRL(1,"IDS")=ICD-9/10 Description, Short
"RTN","FBASFL",17,0)
 ;             FBSRL(1,"IDS",1)=ICD-9/10 IEN ^ date
"RTN","FBASFL",18,0)
 ;             FBSRL(1,"LEX")=Lexicon Description
"RTN","FBASFL",19,0)
 ;             FBSRL(1,"LEX",1)=Expression IEN ^ date
"RTN","FBASFL",20,0)
 ;             FBSRL(1,"SYN",1)=Synonym #1
"RTN","FBASFL",21,0)
 ;             FBSRL(1,"SYN",m)=Synonym #m
"RTN","FBASFL",22,0)
 ;             ...
"RTN","FBASFL",23,0)
 ;               
"RTN","FBASFL",24,0)
 ; Output
"RTN","FBASFL",25,0)
 ;               
"RTN","FBASFL",26,0)
 ;    $$SEL  Two Piece "^" delimited string same as
"RTN","FBASFL",27,0)
 ;           Fileman's Y output variable
"RTN","FBASFL",28,0)
 ;               
"RTN","FBASFL",29,0)
 ;             1  Lexicon IEN
"RTN","FBASFL",30,0)
 ;             2  Lexicon Term
"RTN","FBASFL",31,0)
 ;               
"RTN","FBASFL",32,0)
 ;    FBSRL    Local array passed by reference
"RTN","FBASFL",33,0)
 ;               
"RTN","FBASFL",34,0)
 ;             FBSRL(0)=Code ^ Code IEN ^ date
"RTN","FBASFL",35,0)
 ;             FBSRL("IDL")=ICD-9/10 Description, Long
"RTN","FBASFL",36,0)
 ;             FBSRL("IDL",1)=ICD-9/10 IEN ^ date
"RTN","FBASFL",37,0)
 ;             FBSRL("IDS")=ICD-9/10 Description, Short
"RTN","FBASFL",38,0)
 ;             FBSRL("IDS",1)=ICD-9/10 IEN ^ date
"RTN","FBASFL",39,0)
 ;             FBSRL("LEX")=Lexicon Description
"RTN","FBASFL",40,0)
 ;             FBSRL("LEX",1)=Expression IEN ^ date
"RTN","FBASFL",41,0)
 ;               
"RTN","FBASFL",42,0)
 ;    or ^ on error 
"RTN","FBASFL",43,0)
 ;    or -1 for non-selection
"RTN","FBASFL",44,0)
 ;    or -2 if "^" was entered
"RTN","FBASFL",45,0)
 ;               
"RTN","FBASFL",46,0)
SEL(FBSRL,X) ; Select from List
"RTN","FBASFL",47,0)
 N FBGOUP S FBGOUP=0
"RTN","FBASFL",48,0)
 S X=+($G(X))
"RTN","FBASFL",49,0)
 S:X'>0 X=5
"RTN","FBASFL",50,0)
 S X=$$ASK(.FBSRL,X)
"RTN","FBASFL",51,0)
 I FBGOUP=1 Q -2
"RTN","FBASFL",52,0)
 Q X
"RTN","FBASFL",53,0)
 ;
"RTN","FBASFL",54,0)
ASK(FBSRL,X) ; Ask for Selection
"RTN","FBASFL",55,0)
 N DTOUT,DUOUT,DIROUT
"RTN","FBASFL",56,0)
 N FBLIT,FBLL,FBLTOT
"RTN","FBASFL",57,0)
 S FBLL=+($G(X))
"RTN","FBASFL",58,0)
 S:FBLL'>0 FBLL=5
"RTN","FBASFL",59,0)
 S FBLIT=0,FBLTOT=$O(FBSRL(" "),-1)
"RTN","FBASFL",60,0)
 Q:+FBLTOT'>0 "^"
"RTN","FBASFL",61,0)
 K X
"RTN","FBASFL",62,0)
 S:+FBLTOT=1 X=$$ONE(FBLL,.FBSRL)
"RTN","FBASFL",63,0)
 S:+FBLTOT>1 X=$$MUL(.FBSRL,FBLL)
"RTN","FBASFL",64,0)
 S:'$D(DTOUT)&('$D(DUOUT))&('$D(DIROUT))&(+($G(X))'>0) X=-1
"RTN","FBASFL",65,0)
 Q X
"RTN","FBASFL",66,0)
ONE(X,FBSRL) ; One Entry Found
"RTN","FBASFL",67,0)
 Q:+($G(FBLIT))>0 "^^"
"RTN","FBASFL",68,0)
 N DIR,FBLC,FBLEX,FBLFI,FBLIT,FBLSO,FBLNC,FBCNT1
"RTN","FBASFL",69,0)
 N FBLSP,FBLTX,FBLC,Y
"RTN","FBASFL",70,0)
 S FBLFI=$O(FBSRL(0)) Q:+FBLFI'>0 "^"  S FBLSP=$J(" ",11)
"RTN","FBASFL",71,0)
 S FBLSO=$P(FBSRL(1,0),"^",1),FBLNC=$P(FBSRL(1,0),"^",3)
"RTN","FBASFL",72,0)
 S:+FBLNC>0 FBLNC=" ("_FBLNC_")" S FBLEX=$G(FBSRL(1,"MENU"))
"RTN","FBASFL",73,0)
 S FBLC=$S($D(FBSRL(1,"CAT")):"-",1:"")
"RTN","FBASFL",74,0)
 S FBLTX(1)=FBLSO_FBLC_$J(" ",(9-$L(FBLSO)))_" "_FBLEX_FBLNC
"RTN","FBASFL",75,0)
 D PR(.FBLTX,64) S DIR("A",1)=" One match found",DIR("A",2)=" "
"RTN","FBASFL",76,0)
 S DIR("A",3)=" "_$G(FBLTX(1))
"RTN","FBASFL",77,0)
 S FBLC=3
"RTN","FBASFL",78,0)
 F FBCNT1=2:1 Q:$G(FBLTX(FBCNT1))=""  S FBLC=FBLC+1,DIR("A",FBLC)=FBLSP_$G(FBLTX(FBCNT1))
"RTN","FBASFL",79,0)
 S FBLC=FBLC+1,DIR("A",FBLC)=" ",FBLC=FBLC+1
"RTN","FBASFL",80,0)
 S DIR("A")=" OK? (Yes/No) ",DIR("B")="Yes",DIR(0)="YAO" W !
"RTN","FBASFL",81,0)
 S Y=1 ; DEFAULTS TO YES FOR PRECEDING PROMPT.
"RTN","FBASFL",82,0)
 S:X["^^"!($D(DTOUT)) FBLIT=1
"RTN","FBASFL",83,0)
 I X["^^"!(+($G(FBLIT))>0) K FBSRL Q "^^"
"RTN","FBASFL",84,0)
 S X=$S(+Y>0:$$X(1,.FBSRL),1:-1)
"RTN","FBASFL",85,0)
 Q X
"RTN","FBASFL",86,0)
MUL(FBSRL,Y) ; Multiple Entries Found
"RTN","FBASFL",87,0)
 Q:+($G(FBLIT))>0 "^^"
"RTN","FBASFL",88,0)
 N FBSRLE,FBLL,FBLMAX,FBLSS,FBLX,X
"RTN","FBASFL",89,0)
 S (FBLMAX,FBLSS,FBLIT)=0,FBLL=+($G(Y)),U="^" S:+($G(FBLL))'>0 FBLL=5
"RTN","FBASFL",90,0)
 S FBLX=$O(FBSRL(" "),-1),FBLSS=0
"RTN","FBASFL",91,0)
 G:+FBLX=0 MULQ W ! W:+FBLX>1 !," ",FBLX," matches found"
"RTN","FBASFL",92,0)
 F FBSRLE=1:1:FBLX Q:((FBLSS>0)&(FBLSS<(FBSRLE+1)))  Q:FBLIT  D  Q:FBLIT
"RTN","FBASFL",93,0)
 . W:FBSRLE#FBLL=1 ! D MULW
"RTN","FBASFL",94,0)
 . S FBLMAX=FBSRLE W:FBSRLE#FBLL=0 !
"RTN","FBASFL",95,0)
 . S:FBSRLE#FBLL=0 FBLSS=$$MULS(FBLMAX,FBSRLE,.FBSRL) S:FBLSS["^" FBLIT=1
"RTN","FBASFL",96,0)
 I FBSRLE#FBLL'=0,+FBLSS<=0 D
"RTN","FBASFL",97,0)
 . W ! S FBLSS=$$MULS(FBLMAX,FBSRLE,.FBSRL) S:FBLSS["^" FBLIT=1
"RTN","FBASFL",98,0)
 G MULQ
"RTN","FBASFL",99,0)
 Q X
"RTN","FBASFL",100,0)
MULW ; Write Multiple
"RTN","FBASFL",101,0)
 N FBLEX,FBLI1,FBLSO,FBLNC,FBLT2,FBLTX S FBLSO=$P(FBSRL(+FBSRLE,0),"^",1)
"RTN","FBASFL",102,0)
 S FBLNC=$P(FBSRL(+FBSRLE,0),"^",3) S:+FBLNC>0 FBLNC=" ("_FBLNC_")"
"RTN","FBASFL",103,0)
 S FBLEX=$G(FBSRL(+FBSRLE,"MENU")),FBLTX(1)=FBLSO
"RTN","FBASFL",104,0)
 S FBLTX(1)=FBLTX(1)_$S($D(FBSRL(+FBSRLE,"CAT")):"-",1:" ")_$J(" ",(9-$L(FBLSO)))_" "_FBLEX_FBLNC
"RTN","FBASFL",105,0)
 D PR(.FBLTX,60) W !,$J(FBSRLE,5),".  ",$G(FBLTX(1))
"RTN","FBASFL",106,0)
 F FBLI1=2:1:5 S FBLT2=$G(FBLTX(FBLI1)) W:$L(FBLT2) !,$J(" ",19),FBLT2
"RTN","FBASFL",107,0)
 Q
"RTN","FBASFL",108,0)
MULS(X,Y,FBSRL) ; Select from Multiple Entries
"RTN","FBASFL",109,0)
 N DIR,DIRB,FBLFI,FBLHLP,FBLLST,FBLMAX,FBLS1 ;@#$ not sure FBLS1 is  neede here
"RTN","FBASFL",110,0)
 Q:+($G(FBLIT))>0 "^^"  S FBLMAX=+($G(X)),FBLLST=+($G(Y))
"RTN","FBASFL",111,0)
 Q:FBLMAX=0 -1 S FBLFI=$O(FBSRL(0)) Q:+FBLFI'>0 -1
"RTN","FBASFL",112,0)
 I +($O(FBSRL(+FBLLST)))>0 D
"RTN","FBASFL",113,0)
 . S DIR("A")=" Press <RETURN> for more, ""^"" to exit, or Select 1-"
"RTN","FBASFL",114,0)
 . S DIR("A")=DIR("A")_FBLMAX_": "
"RTN","FBASFL",115,0)
 I +($O(FBSRL(+FBLLST)))'>0 D
"RTN","FBASFL",116,0)
 . S DIR("A")=" Select 1-"_FBLMAX_": "
"RTN","FBASFL",117,0)
 S FBLHLP=" Answer must be from 1 to "
"RTN","FBASFL",118,0)
 S FBLHLP=FBLHLP_FBLMAX_", or <Return> to continue"
"RTN","FBASFL",119,0)
 S DIR("PRE")="S:X[""?"" X=""??"""
"RTN","FBASFL",120,0)
 S (DIR("?"),DIR("??"))="^D MULSH^FBASFL"
"RTN","FBASFL",121,0)
 S DIR(0)="NAO^1:"_FBLMAX_":0" D ^DIR
"RTN","FBASFL",122,0)
 S:X="^" FBGOUP=1
"RTN","FBASFL",123,0)
 Q:'$D(DTOUT)&('$D(DUOUT))&('$D(DIROUT))&(+($G(Y))'>0) -1
"RTN","FBASFL",124,0)
 S:X["^^"!($D(DTOUT)) FBLIT=1,X="^^" I X["^^"!(+($G(FBLIT))>0) Q "^^"
"RTN","FBASFL",125,0)
 K DIR Q:$D(DTOUT)!(X[U) "^^"
"RTN","FBASFL",126,0)
 Q $S(+Y>0:+Y,1:"-1")
"RTN","FBASFL",127,0)
MULSH ; Select from Multiple Entries Help
"RTN","FBASFL",128,0)
 I $L($G(FBLHLP)) W !,$G(FBLHLP) Q
"RTN","FBASFL",129,0)
 Q
"RTN","FBASFL",130,0)
MULQ ; Quit Multiple
"RTN","FBASFL",131,0)
 I +FBLSS'>0,$G(FBLSS)="^" Q "^"
"RTN","FBASFL",132,0)
 S X=-1 S:+($G(FBLIT))'>0 X=$$X(+FBLSS,.FBSRL)
"RTN","FBASFL",133,0)
 Q X
"RTN","FBASFL",134,0)
X(X,FBSRL) ; Set X and Output Array
"RTN","FBASFL",135,0)
 N FBLEX,FBSRFI,FBLIEN,FBLN1,FBLNC,FBLNN,FBLRN,FBLS1,FBLSO
"RTN","FBASFL",136,0)
 S FBLS1=+($G(X))
"RTN","FBASFL",137,0)
 S FBSRFI=$O(FBSRL(0)) ;@#$ not used?
"RTN","FBASFL",138,0)
 S FBLSO=$P($G(FBSRL(FBLS1,0)),"^",1),FBLEX=$G(FBSRL(FBLS1,"MENU"))
"RTN","FBASFL",139,0)
 S FBLIEN=$S($D(FBSRL(FBLS1,"CAT")):"99:CAT;"_$P($G(FBSRL(FBLS1,0)),"^"),1:$P($G(FBSRL(FBLS1,"IDS",1)),"^")_";"_$P($G(FBSRL(FBLS1,0)),"^")_";"_$P($G(FBSRL(FBLS1,"LEX",1)),"^")) Q:'$L(FBLSO) "^"
"RTN","FBASFL",140,0)
 Q:'$L(FBLEX) "^"  Q:+FBLIEN'>0 "^" S X=FBLIEN_"^"_FBLEX
"RTN","FBASFL",141,0)
 S FBLNN="FBSRL("_+FBLS1_")",FBLNC="FBSRL("_+FBLS1_","
"RTN","FBASFL",142,0)
 F  S FBLNN=$Q(@FBLNN) Q:'$L(FBLNN)!(FBLNN'[FBLNC)  D
"RTN","FBASFL",143,0)
 . S FBLRN="FBLN1("_$P(FBLNN,"(",2,299) S @FBLRN=@FBLNN
"RTN","FBASFL",144,0)
 K FBSRL S FBLNN="FBLN1("_+FBLS1_")",FBLNC="FBLN1("_+FBLS1_","
"RTN","FBASFL",145,0)
 F  S FBLNN=$Q(@FBLNN) Q:'$L(FBLNN)!(FBLNN'[FBLNC)  D
"RTN","FBASFL",146,0)
 . S FBLRN="FBSRL("_$P(FBLNN,"(",2,299),@FBLRN=@FBLNN
"RTN","FBASFL",147,0)
 Q X
"RTN","FBASFL",148,0)
 ; 
"RTN","FBASFL",149,0)
 ; Miscellaneous
"RTN","FBASFL",150,0)
CL ; Clear
"RTN","FBASFL",151,0)
 K FBLIT
"RTN","FBASFL",152,0)
 Q
"RTN","FBASFL",153,0)
PR(FBSRL,X) ; Parse Array
"RTN","FBASFL",154,0)
 N DIW,DIWF,DIWI,DIWL,DIWR,DIWT,DIWTC,DIWX,DN,I,Z,%,FBLC,FBLI1,FBLL
"RTN","FBASFL",155,0)
 K ^UTILITY($J,"W")
"RTN","FBASFL",156,0)
 Q:'$D(FBSRL)
"RTN","FBASFL",157,0)
 S FBLL=+($G(X))
"RTN","FBASFL",158,0)
 S:+FBLL'>0 FBLL=79
"RTN","FBASFL",159,0)
 S FBLC=+($G(FBSRL))
"RTN","FBASFL",160,0)
 S:+($G(FBLC))'>0 FBLC=$O(FBSRL(" "),-1)
"RTN","FBASFL",161,0)
 Q:+FBLC'>0
"RTN","FBASFL",162,0)
 S DIWL=1,DIWF="C"_+FBLL
"RTN","FBASFL",163,0)
 S FBLI1=0
"RTN","FBASFL",164,0)
 F  S FBLI1=$O(FBSRL(FBLI1)) Q:+FBLI1=0  S X=$G(FBSRL(FBLI1)) D ^DIWP
"RTN","FBASFL",165,0)
 K FBSRL
"RTN","FBASFL",166,0)
 S (FBLC,FBLI1)=0
"RTN","FBASFL",167,0)
 F  S FBLI1=$O(^UTILITY($J,"W",1,FBLI1)) Q:+FBLI1=0  D
"RTN","FBASFL",168,0)
 . S FBSRL(FBLI1)=$$TM($G(^UTILITY($J,"W",1,FBLI1,0))," "),FBLC=FBLC+1
"RTN","FBASFL",169,0)
 S:$L(FBLC) FBSRL=FBLC
"RTN","FBASFL",170,0)
 K ^UTILITY($J,"W")
"RTN","FBASFL",171,0)
 Q
"RTN","FBASFL",172,0)
TM(X,Y) ; Trim Character Y - Default " "
"RTN","FBASFL",173,0)
 S X=$G(X) Q:X="" X S Y=$G(Y) S:'$L(Y) Y=" "
"RTN","FBASFL",174,0)
 F  Q:$E(X,1)'=Y  S X=$E(X,2,$L(X))
"RTN","FBASFL",175,0)
 F  Q:$E(X,$L(X))'=Y  S X=$E(X,1,($L(X)-1))
"RTN","FBASFL",176,0)
 Q X
"RTN","FBASFU")
0^13^B14602797^n/a
"RTN","FBASFU",1,0)
FBASFU ;AISC/JLG - UTILITIES FOR ICD10 DIAGNOSIS CODE ASF (Advanced Search Functionality) ;3/26/2012
"RTN","FBASFU",2,0)
 ;;3.5;FEE BASIS;**139**;JAN 30, 1995;Build 127
"RTN","FBASFU",3,0)
 ;;Per VA Directive 6402, this routine should not be modified.
"RTN","FBASFU",4,0)
 ;
"RTN","FBASFU",5,0)
 ; Reference to API $$CODEC^ICDEX supported by ICR #5747
"RTN","FBASFU",6,0)
 ; Reference to API $$SD^ICDEX supported by ICR #5747
"RTN","FBASFU",7,0)
 ; Reference to API $$STATCHK^ICDEX supported by ICR #5747
"RTN","FBASFU",8,0)
 ;
"RTN","FBASFU",9,0)
 ;checks if field is a required field
"RTN","FBASFU",10,0)
 ;input parameters : File number, Field name
"RTN","FBASFU",11,0)
 ;returns 0 -if true -1 -if false
"RTN","FBASFU",12,0)
REQFLD(FBFILE,FBFLD) N FBFLDNO,FBFLAT S FBFLDNO=""
"RTN","FBASFU",13,0)
 S FBFLDNO=$$FLDNUM^DILFD(FBFILE,FBFLD) ; get field number
"RTN","FBASFU",14,0)
 S FBFLAT=$P($G(^DD(FBFILE,FBFLDNO,0)),U,2)  ;sample ^DD(162.5,30,0)="ICD1^RP80'^ICD9(^DX;1^Q"
"RTN","FBASFU",15,0)
 I FBFLAT["R" Q 0  ; return true if field is required
"RTN","FBASFU",16,0)
 Q -1
"RTN","FBASFU",17,0)
 ;
"RTN","FBASFU",18,0)
 ; returns default value
"RTN","FBASFU",19,0)
 ;    parameters- file number,ien,field name
"RTN","FBASFU",20,0)
 ;    returns value of field
"RTN","FBASFU",21,0)
GETVAL(FBFILE,FBIEN,FBFLD)  N FBFLDNO S FBFLDNO=""
"RTN","FBASFU",22,0)
 I (FBFLD[":") D
"RTN","FBASFU",23,0)
 . I $E(FBFLD,1,3)="ICD" S FBFLD=$TR(FBFLD,": ") ;remove colon from ICDn prompt
"RTN","FBASFU",24,0)
 . I FBFLD["ADMITTING DIAGNOSIS:" S FBFLD="ADMITTING DIAGNOSIS" ; remove colon from ADMITTING DIAGNOSIS prompt
"RTN","FBASFU",25,0)
 . Q
"RTN","FBASFU",26,0)
 Q:((FBFILE="161.01")&('$D(^FBAAA(1,1,FBIEN,"C")))) ""
"RTN","FBASFU",27,0)
 Q:FBFILE="161.01" $$CODEC^ICDEX(80,$P(^FBAAA(1,1,FBIEN,"C"),U,2)) ; Code from an IEN 
"RTN","FBASFU",28,0)
 S FBFLDNO=$$FLDNUM^DILFD(FBFILE,FBFLD)
"RTN","FBASFU",29,0)
 Q:FBFLDNO'>0 ""
"RTN","FBASFU",30,0)
 Q $$GET1^DIQ(FBFILE,FBIEN,FBFLDNO)
"RTN","FBASFU",31,0)
 ;
"RTN","FBASFU",32,0)
 ; returns diagnosis code to use as default
"RTN","FBASFU",33,0)
 ;    parameters- file number,patient ien,other indexed ien (example authorization ien)
"RTN","FBASFU",34,0)
 ;    returns value of field
"RTN","FBASFU",35,0)
GETDC(FBFILE,FBDFN,FBIEN) ;
"RTN","FBASFU",36,0)
 ; 161.01 is the sub-field authorization in fee basis patient file
"RTN","FBASFU",37,0)
 Q:(FBFILE="161.01")&('$D(^FBAAA(FBDFN,1,FBIEN,"C"))) ""
"RTN","FBASFU",38,0)
 Q:(FBFILE="161.01")&($P(^FBAAA(FBDFN,1,FBIEN,"C"),"^",2)<1) "" ; quit if not a valid diagnosic code
"RTN","FBASFU",39,0)
 Q:FBFILE="161.01" $$CODEC^ICDEX(80,$P(^FBAAA(FBDFN,1,FBIEN,"C"),"^",2)) ; Code from an IEN 
"RTN","FBASFU",40,0)
 Q ""
"RTN","FBASFU",41,0)
 ;
"RTN","FBASFU",42,0)
 ; returns diagnosis code from file 162.7 (FB Unauthorized Claims) to use as default
"RTN","FBASFU",43,0)
 ;    parameters- Fee Basis file number, UAC ien
"RTN","FBASFU",44,0)
 ;    returns value of field or spaces
"RTN","FBASFU",45,0)
GETDCUC(FBFILE,FBIEN) ;
"RTN","FBASFU",46,0)
 Q:(FBFILE="162.7")&('$D(^FB583(FBIEN,"DX"))) ""
"RTN","FBASFU",47,0)
 Q:(FBFILE="162.7")&($P(^FB583(FBIEN,"DX"),"^",2)<1) ""  ; quit if not a valid diagnosic code
"RTN","FBASFU",48,0)
 Q:FBFILE="162.7" $$CODEC^ICDEX(80,$P(^FB583(FBIEN,"DX"),"^",2))
"RTN","FBASFU",49,0)
 Q ""
"RTN","FBASFU",50,0)
 ;
"RTN","FBASFU",51,0)
 ; prints inactive to screen if ICD code is inactive and returns a value of -1 
"RTN","FBASFU",52,0)
STATCHK(ICDCODE,ICDDT) ; 
"RTN","FBASFU",53,0)
 N ICDRET,FBPOUT,MYARY
"RTN","FBASFU",54,0)
 S ICDRET=$$STATCHK^ICDEX(ICDCODE,ICDDT,30) ;  3rd param represents coding system ie. ICD-10-CM
"RTN","FBASFU",55,0)
 ; possible results (set 1)  1^IEN^Effective Date     Active Code       (returns 0)
"RTN","FBASFU",56,0)
 ;                  (set 2)  0^IEN^Effective Date     Inactive Code     (returns -1)
"RTN","FBASFU",57,0)
 ;                  (set 3)  0^IEN^Null               Future Activation (pending) (returns -2)
"RTN","FBASFU",58,0)
 ;                  (set 4)  0^-1^Error Message       Code not Found or Error (returns -3)
"RTN","FBASFU",59,0)
 I $P(ICDRET,U)=1 Q 0         ; reference set 1
"RTN","FBASFU",60,0)
 I $P(ICDRET,U,2)<0 Q -3      ; reference set 4
"RTN","FBASFU",61,0)
 I $L($P(ICDRET,U,3))<7 Q -2  ; reference set 3 
"RTN","FBASFU",62,0)
 ; falls into set 2 - inactive code - print icd code, short description and inactive message to the screen
"RTN","FBASFU",63,0)
 S FBIEN=$P(ICDRET,U,2),FBICD=$$CODEC^ICDEX(80,FBIEN)
"RTN","FBASFU",64,0)
 S FBDESC=$$SD^ICDEX(80,FBIEN,ICDDT,.MYARY,60)
"RTN","FBASFU",65,0)
 S FBINAC=FBIEN_";"_FBICD_"^"_FBDESC
"RTN","FBASFU",66,0)
 W ! S FBPOUT=$$PRTICD10(FBINAC)
"RTN","FBASFU",67,0)
 W !,*7," Code is inactive" W:$G(ICDDT)>0 " on "_$$FMTE^XLFDT(ICDDT) ; defaults to set 2
"RTN","FBASFU",68,0)
 K FBICD,FBDESC,FBINAC
"RTN","FBASFU",69,0)
 Q -1
"RTN","FBASFU",70,0)
 ;
"RTN","FBASFU",71,0)
 ; print ICD-10 code and description to the screen
"RTN","FBASFU",72,0)
PRTICD10(ICDREC) ; 
"RTN","FBASFU",73,0)
 N ICDRET,ICDDESC,ICDLEN,PRTLEN,POSREM,SPOS,EPOS,NUMLN,I,PRTLN
"RTN","FBASFU",74,0)
 I ($P(ICDREC,U,3)=0)&(FBDFLT'=$P($P(ICDREC,U,1),";",2)) W !,"One match found",!
"RTN","FBASFU",75,0)
 W !,"  ICD Diagnosis code:         "_$P($P(ICDREC,U,1),";",2)
"RTN","FBASFU",76,0)
 S ICDDESC=$P(ICDREC,U,2),ICDLEN=$L(ICDDESC) ; length of description
"RTN","FBASFU",77,0)
 S PRTLEN=30,POSREM=IOM-PRTLEN,SPOS=1,EPOS=POSREM
"RTN","FBASFU",78,0)
 S NUMLN=(ICDLEN\POSREM)+1
"RTN","FBASFU",79,0)
 F I=1:1:NUMLN D
"RTN","FBASFU",80,0)
 . S PRTLN(I)=$E(ICDDESC,SPOS,EPOS)
"RTN","FBASFU",81,0)
 . I I=1 W !,"  ICD Diagnosis description:  "_PRTLN(I)
"RTN","FBASFU",82,0)
 . I I>1 W !,?PRTLEN,PRTLN(I)
"RTN","FBASFU",83,0)
 . S SPOS=SPOS+POSREM
"RTN","FBASFU",84,0)
 . S EPOS=EPOS+POSREM
"RTN","FBASFU",85,0)
 . K PRTLN(I)
"RTN","FBASFU",86,0)
 N FBYN S FBYN=999
"RTN","FBASFU",87,0)
 I ($P(ICDREC,U,3)=0)&(FBDFLT'=$P($P(ICDREC,U,1),";",2)) D
"RTN","FBASFU",88,0)
 .F FBYN=0!FBYN=1!FBYN=2 S FBYN=$$QUESTION^FBASF(1,"OK?")
"RTN","FBASFU",89,0)
 Q:FBYN=2 -1 ;no entered 
"RTN","FBASFU",90,0)
 Q:FBYN=-3 -1 ;"^" entered
"RTN","FBASFU",91,0)
 S ICDRET=$P(ICDREC,U) ; ien
"RTN","FBASFU",92,0)
 Q ICDRET
"RTN","FBASFU",93,0)
 ;
"RTN","FBCH78")
0^17^B51567098^B50044150
"RTN","FBCH78",1,0)
FBCH78 ;AISC/DMK - SETS UP 7078/AUTHORIZATION FOR CONTRACT HOSPITAL ;08/07/02
"RTN","FBCH78",2,0)
 ;;3.5;FEE BASIS;**43,103,108,146,139**;JAN 30, 1995;Build 127
"RTN","FBCH78",3,0)
 ;;Per VA Directive 6402, this routine should not be modified.
"RTN","FBCH78",4,0)
 S DIC("S")="I $P(^(0),U,15)=3&($P(^(0),U,12)=""Y"")" D ASKV^FBCHREQ G END:$E(X)="^"!($E(X)="")!('$D(FBDA))
"RTN","FBCH78",5,0)
 I $P(^FBAA(162.2,FBDA,0),"^",17)]"" W !!,*7,"There already is a 7078 set up for this request.",!,"The number is ",$P(^FB7078($P(^FBAA(162.2,FBDA,0),"^",17),0),"^")," .",! G END
"RTN","FBCH78",6,0)
EN ;DEM;139 ICD=10 Project - Replaced original line with next two to add condition FBFRDT<$$IMPDATE^FBCSV1("10D")
"RTN","FBCH78",7,0)
 S FBVEN=$P(^FBAA(162.2,FBDA,0),"^",2)_";FBAAV(",FBVET=$P(^(0),"^",4),FBFRDT=$P(^(0),"^",5),FBFRDT=FBFRDT\1,FBDOA=$S($P(^(0),"^",19):$P(^(0),"^",19)\1,1:"")
"RTN","FBCH78",8,0)
 S FBDXS="" S:FBFRDT<$$IMPDATE^FBCSV1("10D") FBDXS=$P(^FBAA(162.2,FBDA,0),"^",6)
"RTN","FBCH78",9,0)
 ;FB*3.5*103 ;added FBRP
"RTN","FBCH78",10,0)
 S FBRP=$P($G(^FBAA(162.2,FBDA,2)),"^") K DA
"RTN","FBCH78",11,0)
 D NBCHK
"RTN","FBCH78",12,0)
 I NEWB=1 W !! S %DT="APEX",%DT("A")="AUTHORIZATION TO DATE: ",%DT("B")=$$DATX^FBAAUTL(FBDOB7) S DOB7=%DT("B") D ^%DT K %DT G END:X="^" S FBTODT=$S(X="":"",1:Y) D DTCHK1 I DTFG=1 G EN
"RTN","FBCH78",13,0)
 I NEWB'=1 W !! S %DT="APEX",%DT("A")="AUTHORIZATION TO DATE: " D ^%DT K %DT G END:X="^" S FBTODT=$S(X="":"",1:Y)
"RTN","FBCH78",14,0)
 I FBTODT]"",FBFRDT>FBTODT W !!,*7,?5,"Authorization To Date must be after Authorization From Date!",! G EN
"RTN","FBCH78",15,0)
 W !! S %DT="APEX",%DT("A")="DATE OF DISCHARGE: ",%DT("B")=$$DATX^FBAAUTL(FBTODT) D ^%DT K %DT G END:X="^" S FBDOD=$S(X="":"",1:Y)
"RTN","FBCH78",16,0)
 I NEWB'=1 I FBDOD]"",FBTODT>FBDOD W !!,*7,?5,"Date of Discharge must not be earlier than the Authorization To Date!",! G EN
"RTN","FBCH78",17,0)
 I FBDOD]"",FBDOB>FBDOD W !!,*7,?5,"Date of Discharge must not be earlier than the Date of Birth!",! G EN
"RTN","FBCH78",18,0)
 S DIR(0)="162.4,5",DIR("A")="ADMITTING AUTHORITY" D ^DIR K DIR
"RTN","FBCH78",19,0)
 G END:$D(DIRUT) S FBADMIT=+Y
"RTN","FBCH78",20,0)
 S DIR(0)="162.4,6" D ^DIR K DIR
"RTN","FBCH78",21,0)
 G END:$D(DIRUT) S FBEST=+Y
"RTN","FBCH78",22,0)
FBPDIS I FBTODT="" S DIR(0)="162.4,12" D ^DIR K DIR G END:$D(DUOUT),END:$D(DTOUT),NULL^FBCH780:X="" S FBPDIS=+Y
"RTN","FBCH78",23,0)
 ;
"RTN","FBCH78",24,0)
ASKPT I FBTODT]"" S DIR(0)="SAO^00:SURGICAL;10:MEDICAL;86:PSYCHIATRY",DIR("A")="BEDSECTION/TREATING SPECIALTY: ",DIR("?")="^D HELP^FBCH780" D ^DIR K DIR D NOUP^FBCHCD:$D(DIRUT) G ASKPT:$D(DIRUT) S FBPT=Y
"RTN","FBCH78",25,0)
7078 S PRCS("A")="Select Obligation Number: ",PRCS("TYPE")="FB" D EN1^PRCS58 G:Y=-1 NOGOOD S (X,FBCHOB)=$P(Y,"^",2) K PRCS("A") S PRCS("TYPE")="FB" D EN1^PRCSUT31 G:Y="" NOGOOD S FB7078=$P(FBCHOB,"-",2)_"."_Y S FBSEQ=Y
"RTN","FBCH78",26,0)
 S DIC="^FB7078(",DIC(0)="LQ",DLAYGO=162.4,X=""""_FB7078_"""" D ^DIC G:Y<0 PROB S (DA,FBAA78)=+Y
"RTN","FBCH78",27,0)
 S DIE="^FBAA(162.2,",DA=FBDA,DR="16////^S X=FBAA78" D ^DIE K DIE,DIC,DA,DR
"RTN","FBCH78",28,0)
SET78 S DIE="^FB7078(",DA=FBAA78,DR="[FBCH ENTER 7078]" D ^DIE K DIC,DIE,DR,DA
"RTN","FBCH78",29,0)
 D ^FBCH780 I $G(FBOUT) W !!,*7,"...deleting 7078." D DEL G END
"RTN","FBCH78",30,0)
 I +Y=0 W !!,*7,Y,!,"...deleting 7078.  Use 'Set-up a 7078' after adjusting 1358.",! D DEL G END
"RTN","FBCH78",31,0)
 K DIE,DIC,DA
"RTN","FBCH78",32,0)
 I $G(FBVET) S:'$G(DFN) DFN=FBVET D PTF^FBCH780
"RTN","FBCH78",33,0)
 G SHOW:FBTODT=""
"RTN","FBCH78",34,0)
AUTH D HOME^%ZIS
"RTN","FBCH78",35,0)
 D:'$D(FBSITE(1)) SITEP^FBAAUTL Q:FBPOP  S FBPSA=$S($P(FBSITE(1),"^",3)="":"",$D(^DIC(4,$P(FBSITE(1),"^",3),0)):$P(^(0),"^"),1:"")
"RTN","FBCH78",36,0)
 S FBVEN=$P(FBVEN,";")
"RTN","FBCH78",37,0)
 I '$D(^FBAAA(FBVET,0)) D  G:Y<0 END
"RTN","FBCH78",38,0)
 . N DINUM
"RTN","FBCH78",39,0)
 . S Y=-1
"RTN","FBCH78",40,0)
 . L +^FBAAA(FBVET):$S($D(DILOCKTM):DILOCKTM,1:5) I $T D
"RTN","FBCH78",41,0)
 . . K DD,DO S (X,DINUM)=FBVET,DIC="^FBAAA(",DIC(0)="LM",DLAYGO=161
"RTN","FBCH78",42,0)
 . . D FILE^DICN
"RTN","FBCH78",43,0)
 . . L -^FBAAA(FBVET)
"RTN","FBCH78",44,0)
 . I Y<0 W !,"ERROR: Unable to create entry in FEE BASIS PATIENT file."
"RTN","FBCH78",45,0)
 K DE,DQ,DR,DIE,DLAYGO
"RTN","FBCH78",46,0)
 ;FB*3.5*108 ask Contract
"RTN","FBCH78",47,0)
 D  G:$D(DTOUT)!$D(DUOUT) END
"RTN","FBCH78",48,0)
 . S FBCNTRA=""
"RTN","FBCH78",49,0)
 . N DIR
"RTN","FBCH78",50,0)
 . S DIR(0)="PO^161.43:AQEM"
"RTN","FBCH78",51,0)
 . S DIR("A")="CONTRACT"
"RTN","FBCH78",52,0)
 . S DIR("?",1)="If the authorization is under a contract then select it."
"RTN","FBCH78",53,0)
 . S DIR("?")="Contract must be active and applicable for the authorized vendor."
"RTN","FBCH78",54,0)
 . S DIR("S")="I $P($G(^(0)),""^"",2)'=""I"",$$VCNTR^FBUTL7(FBVEN,+Y)"
"RTN","FBCH78",55,0)
 . D ^DIR Q:$D(DTOUT)!$D(DUOUT)
"RTN","FBCH78",56,0)
 . I Y>0 S FBCNTRA=+Y
"RTN","FBCH78",57,0)
FBDCHG S DIR(0)="161.01,.06" D ^DIR K DIR G END:$D(DTOUT),END:$D(DUOUT) D NULL1^FBCH780:X="" G FBDCHG:X="" S FBDCHG=+Y
"RTN","FBCH78",58,0)
FBPUR S FBTYPE=6,DIR(0)="161.01,.07" D ^DIR K DIR S FBPUR=+Y
"RTN","FBCH78",59,0)
 G END:$D(DTOUT),END:$D(DUOUT)
"RTN","FBCH78",60,0)
FBPSA S DIR(0)="161.01,101" D ^DIR K DIR G END:$D(DTOUT),END:$D(DUOUT) D NULL1^FBCH780:X="" G FBPSA:X="" S FBPSA=+Y
"RTN","FBCH78",61,0)
 ;file entry in authorization multiple of file 161
"RTN","FBCH78",62,0)
 S DIC="^FBAAA("_FBVET_",1,",DIC(0)="LM",DLAYGO=161,DA(1)=FBVET,X=FBFRDT K DD,DO D FILE^DICN G:Y<0 END S DA=+Y,DIE("NO^")="" ;DA(1)=FBVET
"RTN","FBCH78",63,0)
 S FB78=FBAA78_";FB7078("
"RTN","FBCH78",64,0)
 ;FB*3.5*103 ;added FBRP
"RTN","FBCH78",65,0)
 S DIE=DIC,DR=".02////^S X=FBTODT;.03////^S X=6;100////^S X=DUZ;1////^S X=""YES"";.055////^S X=FB78;.06////^S X=FBDCHG;S FBTYPE=6;.04////^S X=FBVEN;.065////^S X=FBPT;101////^S X=FBPSA"
"RTN","FBCH78",66,0)
 S:$G(FBRP)]"" DR=DR_";104////^S X=FBRP"
"RTN","FBCH78",67,0)
 S DR=DR_";.095////^S X=1"
"RTN","FBCH78",68,0)
 ; DEM/JAS;139 ICD-10 Project - Modified for ICD-10 to add FBFRDT'<$$IMPDATE^FBCSV1(""10D"") condition
"RTN","FBCH78",69,0)
 S DR(1,161.01,1)="I $D(^FB7078(FBAA78,1,0)) S ^FBAAA(DA(1),1,DA,2,0)=^(0) F FBI=1:1 Q:'$D(^FB7078(FBAA78,1,FBI,0))  I $D(^(0)) S ^FBAAA(DA(1),1,DA,2,FBI,0)=^(0);.07////^S X=FBPUR"
"RTN","FBCH78",70,0)
 S DR(1,161.01,2)="I FBFRDT'<$$IMPDATE^FBCSV1(""10D"") S Y=""@10"";@9;.08///^S X=$G(FBDXS);@10;.096;.097//^S X=""N"""
"RTN","FBCH78",71,0)
 I $G(FBCNTRA)]"" S DR(1,161.01,3)="105////^S X=FBCNTRA"
"RTN","FBCH78",72,0)
 ; End 139
"RTN","FBCH78",73,0)
 D ^DIE K DIE,DR
"RTN","FBCH78",74,0)
 S (DIC,DIE)="^FB7078(",DA=FBAA78,DR="9///^S X=""C"";12///^S X=""@""" D ^DIE K DR,DIE,DA,X
"RTN","FBCH78",75,0)
SHOW W !! S DA=FBAA78,DR="0;1",DIC="^FB7078(" D EN^DIQ
"RTN","FBCH78",76,0)
 S X=$$CN7078(FBAA78) I X]"" W ?2,"CONTRACT: ",$P(X,U,2)
"RTN","FBCH78",77,0)
 ;
"RTN","FBCH78",78,0)
 ;FB*3.5*103 ;added FBRP
"RTN","FBCH78",79,0)
END K D,DA,DIC,DIE,DIR,DLAYGO,DR,FBDA,FB7078,FBAA78,FBPT,FBTYPE,FBVEN,FBZ,FBVET,FBFRDT,FBTODT,J,S,POP,X,Y,DFN,FBCHOB,FBCOMM,FBDFN,FBEST,FBI,FBLENT,FBMENT,FBNAME,FBSEQ,FBSSN,FBSW,I,K,PRC,VAL,FB,FBFLG,ZZ,FBPSA,FBSITE,FB78,FBOUT
"RTN","FBCH78",80,0)
 K FBDCHG,FBPUR,FBPDIS,FBADMIT,FBDXS,A,D0,D1,X1,DIRUT,DTOUT,DUOUT,FBDOA,FBDOD,FBPOP,FBZZ,ZZZ,PRCSCPAN,FBRP,FBCNTRA,PRCS,FBDOB,FBDOB7
"RTN","FBCH78",81,0)
 Q
"RTN","FBCH78",82,0)
PROB W !!,"The reference number did not get set up with the",!,"IFCAP software. Contact your package coordinator." G END
"RTN","FBCH78",83,0)
NOGOOD S DIR(0)="Y",DIR("A")="Obligation number selected is invalid or you are not a control point user in the IFCAP package!  Try again",DIR("B")="YES" D ^DIR K DIR G END:$D(DIRUT)!'Y,7078
"RTN","FBCH78",84,0)
 ;
"RTN","FBCH78",85,0)
OUTP ;ENTRY TO DISPLAY A 7078
"RTN","FBCH78",86,0)
 ;FB*3.5*103 ; Display the 0 node fields with computed REFERRING PROVIDER NPI, then 1 node fields
"RTN","FBCH78",87,0)
 S DIC="^FB7078(",DIC(0)="AEQM",D="D",DIC("A")="Select Patient: " D IX^DIC
"RTN","FBCH78",88,0)
 G END:X=""!(X="^")
"RTN","FBCH78",89,0)
 S (DA,FBDA)=+Y,DR="0",DIQ(0)="C" W !! D EN^DIQ K DIQ(0)
"RTN","FBCH78",90,0)
 S DA=FBDA,DR="1" D EN^DIQ
"RTN","FBCH78",91,0)
 S X=$$CN7078(FBDA) I X]"" W ?2,"CONTRACT: ",$P(X,U,2),!
"RTN","FBCH78",92,0)
 I $$DISCH^FBCH780(FBDA)]"" W ?2,"DISCHARGE TYPE: ",$$DISCH^FBCH780(FBDA),!
"RTN","FBCH78",93,0)
 G OUTP
"RTN","FBCH78",94,0)
 ;
"RTN","FBCH78",95,0)
REFNPI(IEN200,IEN162P4,CHKAUTH) ;FB*3.5*103
"RTN","FBCH78",96,0)
 ; a new function that returns the REFERRING PROVIDER NPI if it is Active and the provider has authorized use of the NPI
"RTN","FBCH78",97,0)
 ; If is used in both a Fileman function and in other FB routines.
"RTN","FBCH78",98,0)
 ;
"RTN","FBCH78",99,0)
 ; Input
"RTN","FBCH78",100,0)
 ; IEN200 - IEN to file 200 if known
"RTN","FBCH78",101,0)
 ; IEN162P4 (optional) - IEN to File 162.4 (if ref prov is not known)
"RTN","FBCH78",102,0)
 ; CHKAUTH (optional) - Flag on whether to Chek Authorization in file 200
"RTN","FBCH78",103,0)
 ;
"RTN","FBCH78",104,0)
 ; Output
"RTN","FBCH78",105,0)
 ; A valid/active NPI if one can be determined.  Otherwise, nada.
"RTN","FBCH78",106,0)
 ;
"RTN","FBCH78",107,0)
 ; If neither IEN is passed in, there is no NPI coming out
"RTN","FBCH78",108,0)
 I $G(IEN200)<1,$G(IEN162P4)<1 Q ""
"RTN","FBCH78",109,0)
 ;
"RTN","FBCH78",110,0)
 ; If there is no referrring provider IEN passed in, try getting it from the IEN from 162.4 (VA FORM 10-7078)
"RTN","FBCH78",111,0)
 ; return nothing if you can't
"RTN","FBCH78",112,0)
 I $G(IEN200)<1 S IEN200=$$GET1^DIQ(162.4,IEN162P4_",",15,"I") Q:$G(IEN200)<1 ""
"RTN","FBCH78",113,0)
 ;
"RTN","FBCH78",114,0)
 ; Now that we have an IEN to 200 see if we need authorization and have to display/print NPI
"RTN","FBCH78",115,0)
 ; If the return value is less than 1, then we don't have permission or it was not a valid IEN.
"RTN","FBCH78",116,0)
 ; IA#5070
"RTN","FBCH78",117,0)
 I $G(CHKAUTH) Q:+$$GETRLNPI^XUSNPI(IEN200)<1 ""
"RTN","FBCH78",118,0)
 ;
"RTN","FBCH78",119,0)
 ; Go get the NPI for this IEN
"RTN","FBCH78",120,0)
 N NPI S NPI=$$NPI^XUSNPI("Individual_ID",IEN200)
"RTN","FBCH78",121,0)
 ;
"RTN","FBCH78",122,0)
 ; Make sure it is a valid/Active NPI
"RTN","FBCH78",123,0)
 I +NPI<1!($P(NPI,U,3)="Inactive") Q ""
"RTN","FBCH78",124,0)
 Q +NPI
"RTN","FBCH78",125,0)
 ;
"RTN","FBCH78",126,0)
NBCHK ;Newborn Enhancement check FB*3.5*146
"RTN","FBCH78",127,0)
 N DOB,NOW
"RTN","FBCH78",128,0)
 S NEWB=0,FBDOB7=0,FBDOB=0
"RTN","FBCH78",129,0)
 S DOB=$P(^DPT(FBDFN,0),"^",3)
"RTN","FBCH78",130,0)
 D NOW^%DTC S NOW=X
"RTN","FBCH78",131,0)
 I $$FMDIFF^XLFDT(NOW,DOB,1)>365 Q 
"RTN","FBCH78",132,0)
 S FBDOB=$$F2H^XLFDT(DOB),FBDOB=$$H2F^XLFDT(FBDOB)
"RTN","FBCH78",133,0)
 S NEWB=1,FBDOB7=$$F2H^XLFDT(DOB)+7,FBDOB7=$$H2F^XLFDT(FBDOB7) Q
"RTN","FBCH78",134,0)
 Q
"RTN","FBCH78",135,0)
 ; 
"RTN","FBCH78",136,0)
DTCHK1 ;
"RTN","FBCH78",137,0)
 S DTFG=0
"RTN","FBCH78",138,0)
 I FBTODT]"",FBTODT>FBDOB7 W !!,*7,?5,"Patient is a newborn. Authorization To Date must not be more than 7 days after the Date of Birth",! S DTFG=1 Q
"RTN","FBCH78",139,0)
 I FBTODT]"",FBTODT<FBDOB W !!,*7,?5,"Patient is a newborn. Authorization To Date must not be before the Date of Birth",! S DTFG=1 Q
"RTN","FBCH78",140,0)
 Q
"RTN","FBCH78",141,0)
DEL S DA=FBAA78,DIK="^FB7078(" D ^DIK K DIK S DA=$O(^FBAA(162.2,"AM",+FBAA78,0)) I DA S DIE="^FBAA(162.2,",DR="16///@" D ^DIE
"RTN","FBCH78",142,0)
 Q
"RTN","FBCH78",143,0)
CN7078(FBDA) ; VA FORM 10-7078 Contract
"RTN","FBCH78",144,0)
 ; input FBDA = ien of entry in file 162.4
"RTN","FBCH78",145,0)
 ; returns contract ien^contract number for the 7078 or null
"RTN","FBCH78",146,0)
 N DFN,FBAU,FBCNTRA,FBRET
"RTN","FBCH78",147,0)
 S FBRET=""
"RTN","FBCH78",148,0)
 I $G(FBDA) D
"RTN","FBCH78",149,0)
 . S DFN=$P($G(^FB7078(FBDA,0)),U,3)
"RTN","FBCH78",150,0)
 . Q:'DFN
"RTN","FBCH78",151,0)
 . S FBAU=$O(^FBAAA("AG",FBDA_";FB7078(",DFN,0))
"RTN","FBCH78",152,0)
 . Q:'FBAU
"RTN","FBCH78",153,0)
 . S FBCNTRA=$P($G(^FBAAA(DFN,1,FBAU,0)),U,22)
"RTN","FBCH78",154,0)
 . Q:'FBCNTRA
"RTN","FBCH78",155,0)
 . S FBRET=FBCNTRA_U_$P($G(^FBAA(161.43,FBCNTRA,0)),U)
"RTN","FBCH78",156,0)
 Q FBRET
"RTN","FBCHEP")
0^27^B36009923^B34203582
"RTN","FBCHEP",1,0)
FBCHEP ;AISC/DMK - ENTER PAYMENT FOR CONTRACT HOSPITAL ;8/18/2004
"RTN","FBCHEP",2,0)
 ;;3.5;FEE BASIS;**4,61,77,82,122,108,124,135,139**;JAN 30, 1995;Build 127
"RTN","FBCHEP",3,0)
 ;;Per VA Directive 6402, this routine should not be modified.
"RTN","FBCHEP",4,0)
 S FBAAPTC="V",FBAAOUT=0
"RTN","FBCHEP",5,0)
RD K FBAAID,FBAAVID S FBRESUB="" D GETVET^FBAAUTL1 G:DFN']"" Q
"RTN","FBCHEP",6,0)
 S FBPROG="I $P(^(0),U,3)=6,($P(^(0),U,9)'[""FB583"")" D GETAUTH^FBAAUTL1 G RD:$D(DUOUT),RD:FTP']""
"RTN","FBCHEP",7,0)
 ;W !!,?25,"<  ASSOCIATED 7078  >",!!
"RTN","FBCHEP",8,0)
 ;S DIC="^FB7078(",DA=FB7078,DR="0;1" D EN^DIQ
"RTN","FBCHEP",9,0)
 I FB7078="" W !,*7,"No 7078 on file for this authorization." G RD
"RTN","FBCHEP",10,0)
 S FBI7078=FB7078_";FB7078("
"RTN","FBCHEP",11,0)
 I $D(^FBAAI("E",FBI7078)) S FBAAIN=$O(^FBAAI("E",FBI7078,0)) G OUT
"RTN","FBCHEP",12,0)
SETINV S FBZ(0)=^FB7078(FB7078,0),FBVET=$P(FBZ(0),"^",3),FBVEN=$P(FBZ(0),"^",2),FBVEN=$P(FBVEN,";",1)
"RTN","FBCHEP",13,0)
 ;
"RTN","FBCHEP",14,0)
EN583 ;Entry from 583 enter payment
"RTN","FBCHEP",15,0)
 I FBAAPTC="R" D ^FBAACO0
"RTN","FBCHEP",16,0)
 S DA=FBVEN D EN1^FBAAVD
"RTN","FBCHEP",17,0)
 I $P($G(^FBAAV(FBVEN,"ADEL")),U)="Y" W !!,*7,"Vendor is flagged for Austin deletion!" G Q
"RTN","FBCHEP",18,0)
 D SITEP^FBAAUTL G Q:FBPOP
"RTN","FBCHEP",19,0)
 S FBAAMPI=$P(FBSITE("FBNUM"),U,4)
"RTN","FBCHEP",20,0)
 ;
"RTN","FBCHEP",21,0)
RDV S FBVE="" S:$D(^FBAAV(FBVEN,"AMS")) FBVE=$P(^("AMS"),"^",2) S:$G(FBVE)'="Y" FBVE="N"
"RTN","FBCHEP",22,0)
 I FBVE="Y" W *7,!!,"Vendor is listed as 'exempt from the pricer'." S DIR(0)="Y",DIR("A")="Do you wish to keep this invoice exempt from the pricer",DIR("B")="Yes" D ^DIR K DIR G Q:$D(DIRUT) S FBVE=$S(Y=1:"Y",1:"N")
"RTN","FBCHEP",23,0)
 I $G(FBVE)'="Y",($P($G(^FBAAV(FBVEN,0)),"^",17)']"") W !!,*7,"Medicare ID Number is needed for this Vendor!" S DIE="^FBAAV(",DR=22 D ^DIE K DIE G Q:$D(DTOUT)!('$L(X))
"RTN","FBCHEP",24,0)
 ;
"RTN","FBCHEP",25,0)
BAT S DIC="^FBAA(161.7,",DIC(0)="AEQMZ",DIC("S")="I $P(^(0),U,3)=""B9""&($P(^(0),U,5)=DUZ)&($P(^(0),U,15)=""Y"")&($G(^(""ST""))=""O"")&(FBAAMPI>$P(^(0),U,10))" W ! D ^DIC K DIC
"RTN","FBCHEP",26,0)
 G Q:X="^"!(X=""),BAT:Y<0 S FBAABE=+Y,FBY(0)=Y(0),Z1=$P(FBY(0),"^",11),BO=$P(FBY(0),"^",2),Z2=$P(FBY(0),"^",10),FBSTN=$P(FBY(0),"^",8),FBCHOB=FBSTN_"-"_$P(FBY(0),"^",2),FBEXMPT=$P(FBY(0),"^",18) S FBAAOUT=0 D CHK I FBAAOUT K Y,Y(0),FBAABE G BAT
"RTN","FBCHEP",27,0)
 I FBI7078["FB7078(",BO'=$P($P(FBZ(0),U),".") W !,*7,"Obligation number on batch does not match 1358.",!,"Obligation number on batch must be ",$P($P(FBZ(0),U),"."),".",! G BAT
"RTN","FBCHEP",28,0)
 S FBINC=$S($P(FBY(0),"^",10)="":0,1:$P(FBY(0),"^",10)),FBLN=$S($P(FBY(0),"^",11)="":0,1:$P(FBY(0),"^",11))
"RTN","FBCHEP",29,0)
GETNXI D GETNXI^FBAAUTL
"RTN","FBCHEP",30,0)
 W !!,"Invoice # ",FBAAIN," assigned to this Invoice"
"RTN","FBCHEP",31,0)
RIN S CALLERID="FBCHEP" D GETINDT^FBAACO1 K CALLERID G Q:$G(FBAAOUT)
"RTN","FBCHEP",32,0)
 ; ask patient control number
"RTN","FBCHEP",33,0)
 S FBCSID=$$ASKPCN^FBUTL5() I FBCSID="^" G Q
"RTN","FBCHEP",34,0)
 ; if U/C then get FPPS Claim ID else ask user
"RTN","FBCHEP",35,0)
 I $D(FB583) S FBFPPSC=$P($G(^FB583(FB583,5)),U) W !,"FPPS CLAIM ID: ",$S(FBFPPSC="":"N/A",1:FBFPPSC)
"RTN","FBCHEP",36,0)
 E  S FBFPPSC=$$FPPSC^FBUTL5() I FBFPPSC=-1 G Q
"RTN","FBCHEP",37,0)
 ; Get Unique Claim ID  ; FB*3.5*135
"RTN","FBCHEP",38,0)
 S FBUCI135=$$ENTINPAT^FBUTL136($G(FBSTN),1,,"I",$G(FBFPPSC),$G(FBVEN)) I FBUCI135<1 G Q
"RTN","FBCHEP",39,0)
 ; if EDI claim then ask FPPS line item
"RTN","FBCHEP",40,0)
 I FBFPPSC]"" S FBFPPSL=$$FPPSL^FBUTL5(,1) I FBFPPSL=-1 G Q
"RTN","FBCHEP",41,0)
 ; compute default Covered Days
"RTN","FBCHEP",42,0)
 S FBCDAYS=$$FMDIFF^XLFDT(FBAAEDT,FBAABDT)
"RTN","FBCHEP",43,0)
 I FBCDAYS=0 S FBCDAYS=1
"RTN","FBCHEP",44,0)
 S FBAAMM=$S(FBAAPTC="R":"",$D(FB583):"",1:1) D PPT^FBAACO1()
"RTN","FBCHEP",45,0)
DIC S DIC="^FBAAI(",DIC(0)="LQ",DLAYGO=162.5,X=FBAAIN D ^DIC G Q:Y<0
"RTN","FBCHEP",46,0)
 S DA=+Y,DIE=DIC,DR="[FBCH ENTER PAYMENT]",DIE("NO^")=""
"RTN","FBCHEP",47,0)
 D
"RTN","FBCHEP",48,0)
 . ; JAS - 12/18/13 - PATCH 139 - Modified original code for ICD-10--date of interest must be Auth. To date, if available.
"RTN","FBCHEP",49,0)
 . N ICDVDT S ICDVDT=$G(FBAAEDT)
"RTN","FBCHEP",50,0)
 . I ICDVDT="" S ICDVDT=$G(FBAABDT)
"RTN","FBCHEP",51,0)
 . D ^DIE
"RTN","FBCHEP",52,0)
 . ; End 139
"RTN","FBCHEP",53,0)
 ; file adjustment reasons
"RTN","FBCHEP",54,0)
 D FILEADJ^FBCHFA(DA_",",.FBADJ)
"RTN","FBCHEP",55,0)
 ; file remittance remarks
"RTN","FBCHEP",56,0)
 D FILERR^FBCHFR(DA_",",.FBRRMK)
"RTN","FBCHEP",57,0)
 ; file Line Item Rendering providers
"RTN","FBCHEP",58,0)
 D FILERP^FBUTL8(DA_",",.FBPROV) ;FB*3.5*122
"RTN","FBCHEP",59,0)
 K DIE,DIC,D,DA,DR
"RTN","FBCHEP",60,0)
 S $P(FBY(0),"^",10)=FBINC+1,$P(FBY(0),"^",11)=FBLN+1,$P(FBY(0),"^",18)=FBEXMPT,^FBAA(161.7,FBAABE,0)=FBY(0) ;D:'$D(FBNOPTF) PTF G Q:$D(FB583),RD
"RTN","FBCHEP",61,0)
 D
"RTN","FBCHEP",62,0)
 . N FBX
"RTN","FBCHEP",63,0)
 . S FBX=FBAAMPI-(FBINC+1)
"RTN","FBCHEP",64,0)
 . I FBX<6 W !,$C(7),"Warning, you can only enter ",FBX," more invoices in this batch!",!
"RTN","FBCHEP",65,0)
 D:'$D(FBNOPTF) PTF
"RTN","FBCHEP",66,0)
 G Q:$D(FB583),RD
"RTN","FBCHEP",67,0)
OUT W !!,*7,?3,"Invoice number ",FBAAIN," has already been entered for this authorization.",!,?3,"Use the Contract Hospital 'Invoice Edit' option if needed.",!
"RTN","FBCHEP",68,0)
 ;check if user wants to add a second invoice for this 7078
"RTN","FBCHEP",69,0)
 W ! S DIR("A")="Want to add another invoice for this episode of care",DIR("B")="No",DIR(0)="Y" D ^DIR K DIR I Y S (FBNOPTF,FBRESUB)=1 G SETINV
"RTN","FBCHEP",70,0)
Q K BO,CNT,D,DA,DAT,DIC,DIE,DLAYGO,DR,FB7078,FBAABDT,FBAABE,FBAAEDT,FBAAID,FBAAIN,FBAAOUT,FBAAPTC,FBDX,FBTT,FBTYPE,FBVEN,FBVET,FBXX,FTP,I,J,FBK,PI,FBPOP,PTYPE,S,FBZ,Z1,FBI,FBPROG,FBRR,FBSW,FBPOV,FBPT,FBY,T,Y,Z1,Z2,ZZ,FBPSA,A,FBI7078
"RTN","FBCHEP",71,0)
 K FBCHOB,FBAUT,FBSEQ,X,FBSITE,F,FBSTN,FBASSOC,FBLOC,DUOUT,PSA,FBCOUNTY,DFN,FBNOPTF,DIRUT,FBVE,FBAAOUT,FBEXMPT,FBAAPN,FBAMTC,FBDEL,FBINC,FBLN,FBRESUB
"RTN","FBCHEP",72,0)
 K FBD1,FBFDC,FBMST,FBTTYPE,FB583,FBUCI135
"RTN","FBCHEP",73,0)
 K FBCSID,FBFPPSC,FBFPPSL,FBCDAYS,FBAMTP,FBADJ,FBRRMK,FBAAMPI,FBV
"RTN","FBCHEP",74,0)
 D GETAUTHK^FBAAUTL1
"RTN","FBCHEP",75,0)
 Q
"RTN","FBCHEP",76,0)
PTF I $G(FBVET),$G(FBI7078)["FB583" S:'$G(DFN) DFN=FBVET D PTFC^FBUTL6(DFN,$P(FBZ(0),"^",4))
"RTN","FBCHEP",77,0)
 Q
"RTN","FBCHEP",78,0)
PRBT ;Entry point for patient reimbursement option
"RTN","FBCHEP",79,0)
 ;
"RTN","FBCHEP",80,0)
 S FBAAPTC="R"
"RTN","FBCHEP",81,0)
 G RD
"RTN","FBCHEP",82,0)
CHK ;Check for vendor and batch being exempt from pricer
"RTN","FBCHEP",83,0)
 I $G(FBVE)'="Y"&($G(FBVE)'="N") S FBVE="N"
"RTN","FBCHEP",84,0)
 I $G(FBEXMPT)="Y" Q:FBVE="Y"  G OPEN:FBVE="N"
"RTN","FBCHEP",85,0)
 I $G(FBEXMPT)="N" Q:FBVE="N"  G OPEN:FBVE="Y"
"RTN","FBCHEP",86,0)
 I '$G(FBEXMPT)&($G(Z2)'>0) S FBEXMPT=FBVE Q
"RTN","FBCHEP",87,0)
 I '$G(FBEXMPT)&($G(Z2)>0) S $P(^FBAA(161.7,FBAABE,0),"^",18)="N",FBEXMPT="N" G CHK
"RTN","FBCHEP",88,0)
 Q
"RTN","FBCHEP",89,0)
OPEN W *7,!!,"This Invoice may not be added to Batch # ",+FBY(0),".",!,"***You may not add a ",$S(FBVE="Y":"pricer exempt",1:"non-exempt")," invoice to a ",$S(FBVE="Y":"non-exempt",1:"pricer exempt")," batch.***"
"RTN","FBCHEP",90,0)
 S DIR(0)="Y",DIR("A")="Do you want to open a new batch at this time",DIR("B")="Y" D ^DIR K DIR S:$D(DIRUT)!('Y) FBAAOUT=1 Q:FBAAOUT  D RCHOP^FBAAOB S FBEXMPT=FBVE D
"RTN","FBCHEP",91,0)
 .S FBY(0)=$G(^FBAA(161.7,FBAABE,0)),Z1=$P(FBY(0),"^",11),BO=$P(FBY(0),"^",2),Z2=$P(FBY(0),"^",10),FBSTN=$P(FBY(0),"^",8),FBCHOB=FBSTN_"-"_$P(FBY(0),"^",2)
"RTN","FBCHEP",92,0)
 Q
"RTN","FBCHEP",93,0)
IPAC ;
"RTN","FBCHEP1")
0^28^B42453076^B39885067
"RTN","FBCHEP1",1,0)
FBCHEP1 ;AISC/DMK - EDIT PAYMENT FOR CONTRACT HOSPITAL ;5/16/12 3:31pm
"RTN","FBCHEP1",2,0)
 ;;3.5;FEE BASIS;**38,61,122,133,108,124,132,139**;JAN 30, 1995;Build 127
"RTN","FBCHEP1",3,0)
 ;;Per VA Directive 6402, this routine should not be modified.
"RTN","FBCHEP1",4,0)
EDIT ;ENTRY POINT TO EDIT PAYMENT
"RTN","FBCHEP1",5,0)
 N LASTDX,LASTPROC
"RTN","FBCHEP1",6,0)
 S IOP=$S($D(ION):ION,1:"HOME") D ^%ZIS K IOP
"RTN","FBCHEP1",7,0)
BT W ! S DIC="^FBAA(161.7,",DIC(0)="AEQMZ",DIC("S")="I $P(^(0),U,3)=""B9""&($P(^(0),U,15)=""Y"")",DIC("S")=$S($D(^XUSEC("FBAASUPERVISOR",DUZ)):DIC("S"),1:DIC("S")_"&($P(^(0),U,5)=DUZ)") D ^DIC
"RTN","FBCHEP1",8,0)
 G END:X=""!(X="^"),BT:Y<0 S FBN=+Y,FBN(0)=Y(0)
"RTN","FBCHEP1",9,0)
 S FBEXMPT=$P(FBN(0),"^",18)
"RTN","FBCHEP1",10,0)
 S FBSTAT=^FBAA(161.7,FBN,"ST"),FBBAMT=$S($P(FBN(0),"^",9)="":0,1:$P(FBN(0),"^",9))
"RTN","FBCHEP1",11,0)
 I FBSTAT="C"&('$D(^XUSEC("FBAASUPERVISOR",DUZ))) W !!,*7,?3,"You must Reopen the batch prior to editting the invoice.",! G END
"RTN","FBCHEP1",12,0)
 I FBSTAT="S"!(FBSTAT="P")!(FBSTAT="R")&('$D(^XUSEC("FBAASUPERVISOR",DUZ))) W !!,*7,?3,"You must be a holder of the 'FBAASUPERVISOR' security key",!,?3,"to edit this invoice.",! G END
"RTN","FBCHEP1",13,0)
 I FBSTAT="T"!(FBSTAT="F")!(FBSTAT="V") W !!,?3,"Batch has already been sent to Austin for payment.",! G END
"RTN","FBCHEP1",14,0)
INV W ! S DIC="^FBAAI(",DIC(0)="AEQZ",DIC("S")="I $P(^(0),U,17)=FBN" D ^DIC K DIC("S") G BT:X=""!(X="^"),INV:Y<0 S FBI=+Y
"RTN","FBCHEP1",15,0)
 S FBK=$S($P(^FBAAI(FBI,0),"^",9)="":0,1:$P(^(0),"^",9))
"RTN","FBCHEP1",16,0)
 S FBLISTC="",FBAAI=FBI W @IOF D START^FBCHDI2 S FBI=FBAAI I $P(^FBAAI(FBI,0),"^",9)="" S FBPRICE=""
"RTN","FBCHEP1",17,0)
 ; set FB1725 flag = true if payment for a 38 U.S.C. 1725 claim
"RTN","FBCHEP1",18,0)
 D
"RTN","FBCHEP1",19,0)
 . N FBY
"RTN","FBCHEP1",20,0)
 . S FBY=$G(^FBAAI(FBI,0))
"RTN","FBCHEP1",21,0)
 . S FB1725=$S($P(FBY,U,5)["FB583":+$P($G(^FB583(+$P(FBY,U,5),0)),U,28),1:0)
"RTN","FBCHEP1",22,0)
 ; get values of FPPS Claim ID and Line Item
"RTN","FBCHEP1",23,0)
 S FBFPPSC=$P($G(^FBAAI(FBI,3)),U)
"RTN","FBCHEP1",24,0)
 S FBFPPSL=$P($G(^FBAAI(FBI,3)),U,2)
"RTN","FBCHEP1",25,0)
 ; load current adjustment data
"RTN","FBCHEP1",26,0)
 D LOADADJ^FBCHFA(FBI_",",.FBADJ)
"RTN","FBCHEP1",27,0)
 ; save adjustment data prior to edit session in sorted list
"RTN","FBCHEP1",28,0)
 S FBADJL(0)=$$ADJL^FBUTL2(.FBADJ) ; sorted list of original adjustments
"RTN","FBCHEP1",29,0)
 ; load current remittance remark data
"RTN","FBCHEP1",30,0)
 D LOADRR^FBCHFR(FBI_",",.FBRRMK)
"RTN","FBCHEP1",31,0)
 ; load Item level Rendering provider data
"RTN","FBCHEP1",32,0)
 D LOADRP^FBUTL8(FBI_",",.FBPROV) ;FB*3.5*122
"RTN","FBCHEP1",33,0)
 ; save remittance remarks prior to edit session in sorted list
"RTN","FBCHEP1",34,0)
 S FBRRMKL(0)=$$RRL^FBUTL4(.FBRRMK)
"RTN","FBCHEP1",35,0)
 S LASTDX=$$LAST(FBI,"DX"),LASTPROC=$$LAST(FBI,"PROC")
"RTN","FBCHEP1",36,0)
 S (DIE,DIC)="^FBAAI(",DIC(0)="AEQM",DA=FBI,DR="[FBCH EDIT PAYMENT]" W !
"RTN","FBCHEP1",37,0)
 D
"RTN","FBCHEP1",38,0)
 . N ICDVDT,DFN,FB583,FBAAMM1,FBAAPTC,FBCNTRA,FBCNTRP,FBV,FBVEN,FTP
"RTN","FBCHEP1",39,0)
 . S ICDVDT=$$FRDTINV^FBCSV1(DA) ;date for files 80 and 80.1 identifier
"RTN","FBCHEP1",40,0)
 . ;get variables for cal to PPT^FBAACO1
"RTN","FBCHEP1",41,0)
 . S FBAAMM1=$P($G(^FBAAI(DA,2)),U,3)
"RTN","FBCHEP1",42,0)
 . S FBCNTRP=$P($G(^FBAAI(DA,5)),U,8)
"RTN","FBCHEP1",43,0)
 . S FBV=$P($G(^FBAAI(DA,0)),U,3)
"RTN","FBCHEP1",44,0)
 . S DFN=$P($G(^FBAAI(DA,0)),U,4)
"RTN","FBCHEP1",45,0)
 . S FBAAPTC=$P($G(^FBAAI(DA,0)),U,13)
"RTN","FBCHEP1",46,0)
 . S X=$P($G(^FBAAI(DA,0)),U,5)
"RTN","FBCHEP1",47,0)
 . S:X[";FB583(" FB583=+X
"RTN","FBCHEP1",48,0)
 . S FTP=$S(X]"":+$O(^FBAAA("AG",X,DFN,0)),1:"")
"RTN","FBCHEP1",49,0)
 . S FBVEN=$S(FTP:$P($G(^FBAAA(DFN,1,FTP,0)),U,4),1:"")
"RTN","FBCHEP1",50,0)
 . S FBCNTRA=$S(FTP:$P($G(^FBAAA(DFN,1,FTP,0)),U,22),1:"")
"RTN","FBCHEP1",51,0)
 . D ^DIE
"RTN","FBCHEP1",52,0)
 ; if adjustment data changed then file
"RTN","FBCHEP1",53,0)
 I $$ADJL^FBUTL2(.FBADJ)'=FBADJL(0) D FILEADJ^FBCHFA(FBI_",",.FBADJ)
"RTN","FBCHEP1",54,0)
 ; if remit remark data changed then file
"RTN","FBCHEP1",55,0)
 I $$RRL^FBUTL4(.FBRRMK)'=FBRRMKL(0) D FILERR^FBCHFR(FBI_",",.FBRRMK)
"RTN","FBCHEP1",56,0)
 ; remove any gaps in codes
"RTN","FBCHEP1",57,0)
 D RMVGAP(FBI,1)
"RTN","FBCHEP1",58,0)
 ; if line item rendering providers exist then file FB*3.5*133
"RTN","FBCHEP1",59,0)
 I $D(FBPROV) D FILERP^FBUTL8(FBI_",",.FBPROV)
"RTN","FBCHEP1",60,0)
 K FBAAMM,FBAAMM1
"RTN","FBCHEP1",61,0)
 S FBNK=$P(^FBAAI(FBI,0),"^",9)
"RTN","FBCHEP1",62,0)
 I FBNK-FBK S $P(^FBAA(161.7,FBN,0),"^",9)=FBBAMT+(FBNK-FBK)
"RTN","FBCHEP1",63,0)
END K DA,DFN,DIC,DIE,DR,FBAAOUT,FBDX,FBI,FBIN,FBLISTC,FBN,FBPROC,FBSTAT,FBVEN,FBVID,J,K,L,POP,Q,VA,VADM,X,FBIFN,Y,FBPRICE,FBK,FBNK,FB583,FBAAPN,FBASSOC,FBDEL,FBLOC,DAT
"RTN","FBCHEP1",64,0)
 K CNT,D0,FB7078,FBAABDT,FBAAEDT,FBASSOC,FBAUT,FBLOC,FBPROG,FBPSA,FBPT,FBRR,FBTT,FBTYPE,FBXX,FTP,PI,PTYPE,T,Z,ZZ,F,FBPOV,I,TA,VAL,DUOUT,FBVET,FBBAMT,FBAAI,FBEXMPT,FB1725,FBPAMT
"RTN","FBCHEP1",65,0)
 K FBFPPSC,FBFPPSL,FBADJ,FBADJD,FBRRMK,FBRRMKD
"RTN","FBCHEP1",66,0)
 D END^FBCHDI
"RTN","FBCHEP1",67,0)
 Q
"RTN","FBCHEP1",68,0)
 ;
"RTN","FBCHEP1",69,0)
BADDATE(INVRCVDT,TEMPDA) ;Compare edited Invoice Received Date to Treatment Date, reject if before. Called from [FBCH EDIT PAYMENT] template. 
"RTN","FBCHEP1",70,0)
 I INVRCVDT="" Q 0 ;Inv Date not changed, no check necessary
"RTN","FBCHEP1",71,0)
 N TDAT,SHODAT S TDAT=$$GET1^DIQ(162.5,TEMPDA_",",6,"I") I TDAT]"" S SHODAT="TO"
"RTN","FBCHEP1",72,0)
 I TDAT="" S TDAT=$$GET1^DIQ(162.5,TEMPDA_",",5,"I"),SHODAT="FROM"
"RTN","FBCHEP1",73,0)
 I INVRCVDT<TDAT D  Q 1 ;Reject entered date
"RTN","FBCHEP1",74,0)
 .N SHOTDAT S SHOTDAT=$E(TDAT,4,5)_"/"_$E(TDAT,6,7)_"/"_$E(TDAT,2,3) ;Convert TDAT into display format for error message.
"RTN","FBCHEP1",75,0)
 .N MSG1,MSG2 S MSG1="*** Invoice Received Date cannot be before",MSG2=" Treatment "_SHODAT_" Date ("_SHOTDAT_") !!!"
"RTN","FBCHEP1",76,0)
 .W !!?5,*7,MSG1,!?8,MSG2
"RTN","FBCHEP1",77,0)
 Q 0 ;Date entered is OK
"RTN","FBCHEP1",78,0)
 ;
"RTN","FBCHEP1",79,0)
LAST(FBDA,FBNODE) ; Returns number (0-25) of last code in node for invoice
"RTN","FBCHEP1",80,0)
 D RMVGAP(FBDA,0)  ;Insure that gaps were not created outside normal processes
"RTN","FBCHEP1",81,0)
 N FBI,FBRET,FBX
"RTN","FBCHEP1",82,0)
 S FBRET=0
"RTN","FBCHEP1",83,0)
 I FBDA,"^DX^PROC^"[(U_FBNODE_U) D
"RTN","FBCHEP1",84,0)
 . S FBX=$G(^FBAAI(FBDA,FBNODE))
"RTN","FBCHEP1",85,0)
 . F FBI=25:-1:1 I $P(FBX,"^",FBI)'="" S FBRET=FBI Q
"RTN","FBCHEP1",86,0)
 Q FBRET
"RTN","FBCHEP1",87,0)
 ;
"RTN","FBCHEP1",88,0)
RMVGAP(FBDA,FBWRT) ;  Remove gaps in ICD diagnosis and procedure codes
"RTN","FBCHEP1",89,0)
 ; input
"RTN","FBCHEP1",90,0)
 ;   FBDA  IEN of invoice
"RTN","FBCHEP1",91,0)
 ;   FBWRT (optional) =1 if messages can be written to the screen
"RTN","FBCHEP1",92,0)
 ; remove any gaps
"RTN","FBCHEP1",93,0)
 N DXFLD,FBDX,FBFDA,FBI,FBMOVED,FBN,FBPOA,FBPROC,POAFLD,PROCFLD
"RTN","FBCHEP1",94,0)
 D FLDLIST ; get list of field numbers
"RTN","FBCHEP1",95,0)
 ; check diagnosis and POA codes
"RTN","FBCHEP1",96,0)
 S FBDX=$G(^FBAAI(FBDA,"DX"))
"RTN","FBCHEP1",97,0)
 S FBPOA=$G(^FBAAI(FBDA,"POA"))
"RTN","FBCHEP1",98,0)
 S FBMOVED=0
"RTN","FBCHEP1",99,0)
 S FBN=0
"RTN","FBCHEP1",100,0)
 F FBI=1:1:25 D
"RTN","FBCHEP1",101,0)
 . ; JAS - 03/05/14 - Patch 139 (ICD-10 Project) - Modified next line to also quit if 0
"RTN","FBCHEP1",102,0)
 . Q:(($P(FBDX,U,FBI)="")!($P(FBDX,U,FBI)=0))
"RTN","FBCHEP1",103,0)
 . S FBN=FBN+1 ; increment number of diagnosis codes
"RTN","FBCHEP1",104,0)
 . Q:FBI=FBN  ; no gap
"RTN","FBCHEP1",105,0)
 . ; move diagnosis and POA from slot FBI to slot FBN
"RTN","FBCHEP1",106,0)
 . S FBMOVED=1 ; set flag for message
"RTN","FBCHEP1",107,0)
 . K FBFDA
"RTN","FBCHEP1",108,0)
 . S FBFDA(162.5,FBDA_",",$P(DXFLD,U,FBN))=$P(FBDX,U,FBI)
"RTN","FBCHEP1",109,0)
 . S FBFDA(162.5,FBDA_",",$P(POAFLD,U,FBN))=$P(FBPOA,U,FBI)
"RTN","FBCHEP1",110,0)
 . S FBFDA(162.5,FBDA_",",$P(DXFLD,U,FBI))="@"
"RTN","FBCHEP1",111,0)
 . S FBFDA(162.5,FBDA_",",$P(POAFLD,U,FBI))="@"
"RTN","FBCHEP1",112,0)
 . D FILE^DIE("","FBFDA") D:$G(FBWRT) MSG^DIALOG()
"RTN","FBCHEP1",113,0)
 . S $P(FBDX,U,FBN)=$P(FBDX,U,FBI)
"RTN","FBCHEP1",114,0)
 . S $P(FBPOA,U,FBN)=$P(FBPOA,U,FBI)
"RTN","FBCHEP1",115,0)
 . S $P(FBDX,U,FBI)=""
"RTN","FBCHEP1",116,0)
 . S $P(FBPOA,U,FBI)=""
"RTN","FBCHEP1",117,0)
 I $G(FBWRT),FBMOVED W !,"Diagnosis codes were moved to remove gaps"
"RTN","FBCHEP1",118,0)
 ;
"RTN","FBCHEP1",119,0)
 S FBPROC=$G(^FBAAI(FBDA,"PROC"))
"RTN","FBCHEP1",120,0)
 S FBMOVED=0
"RTN","FBCHEP1",121,0)
 S FBN=0
"RTN","FBCHEP1",122,0)
 F FBI=1:1:25 D
"RTN","FBCHEP1",123,0)
 . ; JAS - 03/05/14 - Patch 139 (ICD-10 Project) - Modified next line to also quit if 0
"RTN","FBCHEP1",124,0)
 . Q:(($P(FBPROC,U,FBI)="")!($P(FBPROC,U,FBI)=0))
"RTN","FBCHEP1",125,0)
 . S FBN=FBN+1 ; increment number of procedure codes
"RTN","FBCHEP1",126,0)
 . Q:FBI=FBN  ; no gap
"RTN","FBCHEP1",127,0)
 . ; move procedure from slot FBI to slot FBN
"RTN","FBCHEP1",128,0)
 . S FBMOVED=1
"RTN","FBCHEP1",129,0)
 . K FBFDA
"RTN","FBCHEP1",130,0)
 . S FBFDA(162.5,FBDA_",",$P(PROCFLD,U,FBN))=$P(FBPROC,U,FBI)
"RTN","FBCHEP1",131,0)
 . S FBFDA(162.5,FBDA_",",$P(PROCFLD,U,FBI))="@"
"RTN","FBCHEP1",132,0)
 . D FILE^DIE("","FBFDA") D:$G(FBWRT) MSG^DIALOG()
"RTN","FBCHEP1",133,0)
 . S $P(FBPROC,U,FBN)=$P(FBPROC,U,FBI)
"RTN","FBCHEP1",134,0)
 . S $P(FBPROC,U,FBI)=""
"RTN","FBCHEP1",135,0)
 I $G(FBWRT),FBMOVED W !,"Procedure codes were moved to remove gaps"
"RTN","FBCHEP1",136,0)
 Q
"RTN","FBCHEP1",137,0)
 ;
"RTN","FBCHEP1",138,0)
FLDLIST ; Provide list of fields for diagnosis, POA, and prodedures
"RTN","FBCHEP1",139,0)
 S DXFLD="30^31^32^33^34^35^35.1^35.2^35.3^35.4^35.5^35.6^35.7^35.8^35.9^36^36.1^36.2^36.3^36.4^36.5^36.6^36.7^36.8^36.9"
"RTN","FBCHEP1",140,0)
 S POAFLD="30.02^31.02^32.02^33.02^34.02^35.02^35.12^35.22^35.32^35.42^35.52^35.62^35.72^35.82^35.92^36.02^36.12^36.22^36.32^36.42^36.52^36.62^36.72^26.82^36.92"
"RTN","FBCHEP1",141,0)
 S PROCFLD="40^41^42^43^44^44.06^44.07^44.08^44.09^44.1^44.11^44.12^44.13^44.14^44.15^44.16^44.17^44.18^44.19^44.2^44.21^44.22^44.23^44.24^44.25"
"RTN","FBCHEP1",142,0)
 Q
"RTN","FBCHRJP")
0^22^B10678988^B10589786
"RTN","FBCHRJP",1,0)
FBCHRJP ;AISC/DMK/CMR - PRINT REJECTED PAYMENTS FROM PRICER ;18APR90
"RTN","FBCHRJP",2,0)
 ;;3.5;FEE BASIS;**58,69,139**;JAN 30, 1995;Build 127
"RTN","FBCHRJP",3,0)
 ;;Per VA Directive 6402, this routine should not be modified.
"RTN","FBCHRJP",4,0)
 I '$D(^FBAAI("AH")) W !,*7,"No payments rejected!",! Q
"RTN","FBCHRJP",5,0)
 S (VAR,VAL)="",PGM="START^FBCHRJP" D ZIS^FBAAUTL G END:FBPOP
"RTN","FBCHRJP",6,0)
START K ^TMP($J,"FB") S (FBAAOUT,FBLISTC)=0,Q="",$P(Q,"=",80)="=",QQ="-",$P(QQ,"-",39)="-" U IO W:$E(IOST,1,2)["C-" @IOF D HED
"RTN","FBCHRJP",7,0)
 F FBA=0:0 S FBA=$O(^FBAAI("AH",FBA)) Q:FBA=""  I $D(^FBAA(161.7,FBA,0)),$P(^(0),"^",15)="Y" S FBN=+^(0) D
"RTN","FBCHRJP",8,0)
 .F FBI=0:0 S FBI=$O(^FBAAI("AH",FBA,FBI)) Q:FBI'>0  I $D(^FBAAI(FBI,0)),$P(^(0),"^",9)="",$D(^FBAAI(FBI,"FBREJ")) D
"RTN","FBCHRJP",9,0)
 ..S FBSORT=1 D VET^FBCHDI,SET^FBPAY67
"RTN","FBCHRJP",10,0)
 S (FBVEN,FBNAME)="",(FBDT,FBI)=0 K FBIN
"RTN","FBCHRJP",11,0)
 F  S FBVEN=$O(^TMP($J,"FB",6,FBVEN)) Q:FBVEN=""!(FBAAOUT)  F  S FBNAME=$O(^TMP($J,"FB",6,FBVEN,FBNAME)) Q:FBNAME=""!(FBAAOUT)  F  S FBDT=$O(^TMP($J,"FB",6,FBVEN,FBNAME,FBDT)) Q:FBDT'>0!(FBAAOUT)  D
"RTN","FBCHRJP",12,0)
 .F  S FBI=$O(^TMP($J,"FB",6,FBVEN,FBNAME,FBDT,FBI)) Q:FBI'>0!(FBAAOUT)  D  D PRINT
"RTN","FBCHRJP",13,0)
 ..F I=1:1:9 S FBIN(I)=$P(^TMP($J,"FB",6,FBVEN,FBNAME,FBDT,FBI),"^",I)
"RTN","FBCHRJP",14,0)
 ..S FB7078=$S($P(^FBAAI(FBI,0),"^",5)["FB7078":$P($G(^FB7078(+$P(^FBAAI(FBI,0),"^",5),0)),"^"),1:"") F I=1:1:3 S FBREJ(I)=$P(^FBAAI(FBI,"FBREJ"),"^",I)
"RTN","FBCHRJP",15,0)
END K DFN,FB,FBA,FBAAOUT,FBDX,FBI,FBIN,FBLISTC,FBN,FBPROC,FBVEN,FBVID,J,K,L,PGM,Q,QQ,VA,VADM,VAL,VAR,Y,FB7078,FBPROC1,FBREJ,FBINV,^TMP($J)
"RTN","FBCHRJP",16,0)
 D CLOSE^FBAAUTL,END^FBCHDI
"RTN","FBCHRJP",17,0)
 Q
"RTN","FBCHRJP",18,0)
PRINT I $Y+5>IOSL,$E(IOST,1,2)["C-" S DIR(0)="E" D ^DIR K DIR I 'Y S FBAAOUT=1 Q
"RTN","FBCHRJP",19,0)
 I $Y+5>IOSL W @IOF D HED
"RTN","FBCHRJP",20,0)
 S FBINV=^TMP($J,"FB",6,FBVEN,FBNAME,FBDT,FBI,"FBINV") ;set by FBPAY67
"RTN","FBCHRJP",21,0)
 ;If adj code found print it, if not then print suspend code
"RTN","FBCHRJP",22,0)
 I $P(FBINV,U,5)]"" S FBIN(4)=$P(FBINV,U,5)
"RTN","FBCHRJP",23,0)
 W !!,"Vendor: ",$P(FBVEN,";"),?41,"Vendor ID: ",+$P(FBVEN,";",2)
"RTN","FBCHRJP",24,0)
 W !,"Patient: ",$P(FBNAME,";"),?41,"Patient ID: ",$$SSN^FBAAUTL($P(FBNAME,";",2))
"RTN","FBCHRJP",25,0)
 W ! W:FBIN(8)["R" "*" W:FBIN(9)]"" "#" W ?3,FBIN(1),?23,FBIN(2),?33,FBIN(3),?42,FBIN(4),?49,FBIN(5),?61,FBIN(6),?72,FBIN(7)
"RTN","FBCHRJP",26,0)
 ;If FPPS Claim ID exists then print it.
"RTN","FBCHRJP",27,0)
 I $P(FBINV,U,3)]"" D
"RTN","FBCHRJP",28,0)
 .W !?3,"FPPS Claim ID: ",$P(FBINV,U,3),"    FPPS Line Item: ",$P(FBINV,U,4)
"RTN","FBCHRJP",29,0)
 ;FB*3.5*139-ICD10 REMEDIATION-jlg- fixed issue with zero being displayed in DX field. Modified next line.
"RTN","FBCHRJP",30,0)
 W !?3,"DX: ",$P($P($G(^TMP($J,"FB",6,FBVEN,FBNAME,FBDT,FBI,"DX")),U,1),"/",1)
"RTN","FBCHRJP",31,0)
 W !?3,"Associated 7078: ",FB7078,!?3,$S(FBREJ(1)="P":"Rejects Pending!",FBREJ(1)="C":"Rejected!",1:""),?23,"Reject Reason: ",FBREJ(2),!?3,"Old Batch #: ",FBREJ(3)
"RTN","FBCHRJP",32,0)
 Q
"RTN","FBCHRJP",33,0)
HED W !?18,"CIVIL HOSPITAL REJECTED PAYMENT HISTORY",!?18,QQ
"RTN","FBCHRJP",34,0)
 W !!?3,"('*' Represents Reimbursement to Patient",?50,"'#' Represents Voided Payment)"
"RTN","FBCHRJP",35,0)
 W !?2,"Inv Date",?23,"Amount",?33," Amount",?42,"Adj",?49,"Invoice",?61,"From",?73,"To"
"RTN","FBCHRJP",36,0)
 W !?23,"Claimed",?35,"Paid",?42,"Code",?53,"Num",?61,"Date",?71,"Date",!,Q
"RTN","FBCHRJP",37,0)
 Q
"RTN","FBCSV1")
0^3^B26775186^B19921855
"RTN","FBCSV1",1,0)
FBCSV1 ;WOIFO/SS - UTILITIES FOR CODE SET VERSIONING ;4/7/2003
"RTN","FBCSV1",2,0)
 ;;3.5;FEE BASIS;**55,77,94,139**;JAN 30, 1995;Build 127
"RTN","FBCSV1",3,0)
 ;;Per VA Directive 6402, this routine should not be modified.
"RTN","FBCSV1",4,0)
 ;
"RTN","FBCSV1",5,0)
 ; References to API $$ICDOP^ICDEX supported by ICR 5747
"RTN","FBCSV1",6,0)
 ; References to API $$ICDDX^ICDEX supported by ICR 5747
"RTN","FBCSV1",7,0)
 ;
"RTN","FBCSV1",8,0)
 ;wrapper for DRG^ICDGTDRG
"RTN","FBCSV1",9,0)
 ;to use instead of direct read of ^ICD(
"RTN","FBCSV1",10,0)
 ;FBIEN - ien of #80.2
"RTN","FBCSV1",11,0)
 ;FBDATE - date of service (optional)
"RTN","FBCSV1",12,0)
 ;returns (#.01) NAME of #80.2 or "" if invalid/error
"RTN","FBCSV1",13,0)
ICD(FBIEN,FBDATE) ;
"RTN","FBCSV1",14,0)
 N FBRET
"RTN","FBCSV1",15,0)
 S FBRET=$$DRG^ICDGTDRG($G(FBIEN),$S(+$G(FBDATE)=0:"",1:FBDATE))
"RTN","FBCSV1",16,0)
 Q:+FBRET<0 ""
"RTN","FBCSV1",17,0)
 Q $P(FBRET,"^",1)
"RTN","FBCSV1",18,0)
 ;
"RTN","FBCSV1",19,0)
 ;wrapper for ICDOP^ICDCODE
"RTN","FBCSV1",20,0)
 ;to use instead of direct read of ^ICD0(
"RTN","FBCSV1",21,0)
 ;FBIEN - ien of #80.1
"RTN","FBCSV1",22,0)
 ;FBDATE - date of service (optional)
"RTN","FBCSV1",23,0)
 ;returns (#.01) NAME of #80.1 or "" if invalid/error
"RTN","FBCSV1",24,0)
ICD0(FBIEN,FBDATE) ;
"RTN","FBCSV1",25,0)
 N FBRET
"RTN","FBCSV1",26,0)
 ;JAS - 4/2/13 - Patch 139 (ICD-10 Project) Modified next line.
"RTN","FBCSV1",27,0)
 S FBRET=$$ICDOP^ICDEX($G(FBIEN),$S(+$G(FBDATE)=0:"",1:FBDATE),"","I")
"RTN","FBCSV1",28,0)
 Q:+FBRET<0 ""
"RTN","FBCSV1",29,0)
 Q $P(FBRET,"^",2)
"RTN","FBCSV1",30,0)
 ;
"RTN","FBCSV1",31,0)
 ;wrapper for ICDDX^ICDCODE
"RTN","FBCSV1",32,0)
 ;to use instead of direct read of ^ICD9(
"RTN","FBCSV1",33,0)
 ;FBIEN - ien of #80
"RTN","FBCSV1",34,0)
 ;FBDATE - date of service (optional)
"RTN","FBCSV1",35,0)
 ;returns (#.01) NAME of #80 or "" if invalid/error
"RTN","FBCSV1",36,0)
ICD9(FBIEN,FBDATE) ;
"RTN","FBCSV1",37,0)
 N FBRET
"RTN","FBCSV1",38,0)
 ; DEM;139 ICD-10 Project - Replaced call to $$ICDDX^ICDCODE with
"RTN","FBCSV1",39,0)
 ;                          call to $$ICDDX^ICDEX.  
"RTN","FBCSV1",40,0)
 S FBRET=$$ICDDX^ICDEX($G(FBIEN),$S(+$G(FBDATE)=0:"",1:FBDATE),"","I")
"RTN","FBCSV1",41,0)
 Q:+FBRET<0 ""
"RTN","FBCSV1",42,0)
 Q $P(FBRET,"^",2)
"RTN","FBCSV1",43,0)
 ;
"RTN","FBCSV1",44,0)
 ;wrapper for ICDDX^ICDCODE with piece #
"RTN","FBCSV1",45,0)
 ;to use instead of direct read of ^ICD9(
"RTN","FBCSV1",46,0)
 ;FBIEN - ien of #80
"RTN","FBCSV1",47,0)
 ;FBPC - piece #
"RTN","FBCSV1",48,0)
 ;FBDATE (optional) - date of service
"RTN","FBCSV1",49,0)
 ;returns piece # FBPC of #80 or "" if invalid/error
"RTN","FBCSV1",50,0)
ICD9P(FBIEN,FBPC,FBDATE) ; Will need to check calls to this tag for FBPC value as it may need to change - DRP 12/22/2011
"RTN","FBCSV1",51,0)
 N FBRET
"RTN","FBCSV1",52,0)
 ;JAS - 4/2/13 - Patch 139 (ICD-10 Project) Modified next line.
"RTN","FBCSV1",53,0)
 S FBRET=$$ICDDX^ICDEX($G(FBIEN),$S(+$G(FBDATE)=0:"",1:FBDATE),"","I")
"RTN","FBCSV1",54,0)
 Q:+FBRET<0 ""
"RTN","FBCSV1",55,0)
 Q $P(FBRET,"^",FBPC+1)
"RTN","FBCSV1",56,0)
 ;
"RTN","FBCSV1",57,0)
 ;extended wrapper for ICDDX^ICDCODE
"RTN","FBCSV1",58,0)
 ;to use instead of direct read of ^ICD9(
"RTN","FBCSV1",59,0)
 ;FBIEN - ien of #80
"RTN","FBCSV1",60,0)
 ;FBPC - piece #
"RTN","FBCSV1",61,0)
 ;FBEXTR - $E parameter
"RTN","FBCSV1",62,0)
 ;FBDATE (optional) - date of service
"RTN","FBCSV1",63,0)
 ;returns piece #FBPC and (#.01) NAME of #80 and or "" if invalid/error
"RTN","FBCSV1",64,0)
ICD9EX(FBIEN,FBPC,FBEXTR,FBDATE) ; Will need to check calls to this tag for FBPC value as it may need to change - DRP 12/22/2011
"RTN","FBCSV1",65,0)
 N FBRET
"RTN","FBCSV1",66,0)
 ;JAS - 4/2/13 - Patch 139 (ICD-10 Project) Modified next line.
"RTN","FBCSV1",67,0)
 S FBRET=$$ICDDX^ICDEX($G(FBIEN),$S(+$G(FBDATE)=0:"",1:FBDATE),"","I")
"RTN","FBCSV1",68,0)
 Q:+FBRET<0 ""
"RTN","FBCSV1",69,0)
 Q $E($P(FBRET,"^",FBPC+1),1,FBEXTR)_" ("_$P(FBRET,"^",2)_")"
"RTN","FBCSV1",70,0)
 ;
"RTN","FBCSV1",71,0)
 ;get FROM date from INVOICE file
"RTN","FBCSV1",72,0)
FRDTINV(FBDA) ;
"RTN","FBCSV1",73,0)
 N FBRETDT
"RTN","FBCSV1",74,0)
 S FBRETDT=$P($$B9DISCHG^FBAAV5(FBDA),"^",1) ; Discharge Date
"RTN","FBCSV1",75,0)
 I FBRETDT="" S FBRETDT=$P($G(^FBAAI(FBDA,0)),"^",7) ; Treatment To DT
"RTN","FBCSV1",76,0)
 I FBRETDT="" S FBRETDT=$P($G(^FBAAI(FBDA,0)),"^",6) ; Treatment Fr DT
"RTN","FBCSV1",77,0)
 Q FBRETDT
"RTN","FBCSV1",78,0)
 ;
"RTN","FBCSV1",79,0)
 ;FB*3.5*139-ICD10 REMEDIATION-jlg- obtain FROM date from Unclaimed funds file (162.7)
"RTN","FBCSV1",80,0)
FRDTUC(FBDA) ;
"RTN","FBCSV1",81,0)
 N FBRETDT
"RTN","FBCSV1",82,0)
 S FBRETDT=$P($G(^FB583(FBDA,0)),"^",6) ; Treatment To DT/Discharge Date
"RTN","FBCSV1",83,0)
 S:FBRETDT="" FBRETDT=$P($G(^FB583(FBDA,0)),"^",5) ; Treatment Fr DT
"RTN","FBCSV1",84,0)
 Q FBRETDT
"RTN","FBCSV1",85,0)
 ;
"RTN","FBCSV1",86,0)
 ;if FBCODE="" returns FBNUM spaces
"RTN","FBCSV1",87,0)
 ;otherwise returns FBCODE
"RTN","FBCSV1",88,0)
SPACES(FBCODE,FBNUM) ;
"RTN","FBCSV1",89,0)
 I $L(FBCODE)=0 S $P(FBCODE," ",FBNUM)=" "
"RTN","FBCSV1",90,0)
 Q FBCODE
"RTN","FBCSV1",91,0)
 ;
"RTN","FBCSV1",92,0)
 ;EVALUATE (sometimes can be used instead of "$S")
"RTN","FBCSV1",93,0)
 ;if FBCODE="" returns FBRETV
"RTN","FBCSV1",94,0)
 ;otherwise returns FBCODE
"RTN","FBCSV1",95,0)
EV(FBCODE,FBRETV) ;
"RTN","FBCSV1",96,0)
 Q:$L(FBCODE)=0 FBRETV
"RTN","FBCSV1",97,0)
 Q FBCODE
"RTN","FBCSV1",98,0)
 ;
"RTN","FBCSV1",99,0)
 ;converts a date to fileman format
"RTN","FBCSV1",100,0)
DT2FMDT(FBDAT) ;
"RTN","FBCSV1",101,0)
 N X,Y
"RTN","FBCSV1",102,0)
 S X=$$TRIM^XLFSTR(FBDAT)
"RTN","FBCSV1",103,0)
 D ^%DT
"RTN","FBCSV1",104,0)
 Q +Y
"RTN","FBCSV1",105,0)
 ;
"RTN","FBCSV1",106,0)
 ;wrapper for ICDDX^ICDCODE
"RTN","FBCSV1",107,0)
 ;to use in prompts (and input templates)of file #162.5 to screen out 
"RTN","FBCSV1",108,0)
 ;  inactive/invalid codes
"RTN","FBCSV1",109,0)
 ;FBICD9 - ien of #80
"RTN","FBCSV1",110,0)
 ;FBINV - ien of the current #162.5 record
"RTN","FBCSV1",111,0)
 ;FBDATE - (optional) date of service
"RTN","FBCSV1",112,0)
 ;returns 0 if code is active, otherwise - nonzero value
"RTN","FBCSV1",113,0)
INPICD9(FBICD9,FBINV,FBDATE) ;
"RTN","FBCSV1",114,0)
 N FBRET
"RTN","FBCSV1",115,0)
 ; FB*3.5*139 Restored original line of code that was incorrectly modified in FB*3.5*94
"RTN","FBCSV1",116,0)
 I '$G(FBDATE) S FBDATE=$$FRDTINV(+$G(FBINV))
"RTN","FBCSV1",117,0)
 ;JAS - 4/2/13 - Patch 139 (ICD-10 Project) Modified next line.
"RTN","FBCSV1",118,0)
 S FBRET=$$ICDDX^ICDEX($G(FBICD9),$S(+$G(FBDATE)=0:"",1:FBDATE),"","I")
"RTN","FBCSV1",119,0)
 I +FBRET<0 W " Invalid Code " Q 2
"RTN","FBCSV1",120,0)
 I $P(FBRET,"^",10)=0 W !," Code is inactive" W:$G(FBDATE)>0 " on "_$$FMTE^XLFDT(FBDATE) Q 1
"RTN","FBCSV1",121,0)
 Q 0
"RTN","FBCSV1",122,0)
 ;
"RTN","FBCSV1",123,0)
 ;wrapper for ICDOP^ICDCODE
"RTN","FBCSV1",124,0)
 ;checks if code is active on the date of service and
"RTN","FBCSV1",125,0)
 ;if active returns CODE NUMBER
"RTN","FBCSV1",126,0)
 ;is inactive returns "" and prints message "ICD O/P Code inactive ..."
"RTN","FBCSV1",127,0)
 ;is invalid/local returns "" and prints message "Invalid ICD O/P Code"
"RTN","FBCSV1",128,0)
CHKICD0(FBIEN,FBDATE) ;
"RTN","FBCSV1",129,0)
 N FBRET
"RTN","FBCSV1",130,0)
 ;JAS - 4/2/13 - Patch 139 (ICD-10 Project) Modified next line.
"RTN","FBCSV1",131,0)
 S FBRET=$$ICDOP^ICDEX($G(FBIEN),$S(+$G(FBDATE)=0:"",1:FBDATE),"","I")
"RTN","FBCSV1",132,0)
 I +FBRET<0 W " Invalid ICD O/P Code " Q ""
"RTN","FBCSV1",133,0)
 I $P(FBRET,"^",10)=0 D  Q ""
"RTN","FBCSV1",134,0)
 . W !," ICD O/P Code "_$P(FBRET,"^",2)_" inactive"
"RTN","FBCSV1",135,0)
 . W:$G(FBDATE) " on date of service (",$$FMTE^XLFDT(FBDATE),")"
"RTN","FBCSV1",136,0)
 Q $P(FBRET,"^",2)
"RTN","FBCSV1",137,0)
 ;
"RTN","FBCSV1",138,0)
 ;wrapper for ICDOP^ICDCODE
"RTN","FBCSV1",139,0)
 ;to use in prompts (and input templates)of file #162.5 to screen out 
"RTN","FBCSV1",140,0)
 ;  inactive/invalid codes
"RTN","FBCSV1",141,0)
 ;FBICD0 - ien of #80.1
"RTN","FBCSV1",142,0)
 ;FBINV - ien of the current #162.5 record
"RTN","FBCSV1",143,0)
 ;FBDATE - (optional) date of service
"RTN","FBCSV1",144,0)
 ;returns 0 if code is active, otherwise - nonzero value
"RTN","FBCSV1",145,0)
INPICD0(FBICD0,FBINV,FBDATE) ;
"RTN","FBCSV1",146,0)
 N FBRET
"RTN","FBCSV1",147,0)
 ; FB*3.5*139 Restored original line of code that was incorrectly modified in FB*3.5*94
"RTN","FBCSV1",148,0)
 I '$G(FBDATE) S FBDATE=$$FRDTINV(+$G(FBINV))
"RTN","FBCSV1",149,0)
 ;JAS - 4/2/13 - Patch 139 (ICD-10 Project) Modified next line.
"RTN","FBCSV1",150,0)
 S FBRET=$$ICDOP^ICDEX($G(FBICD0),$S(+$G(FBDATE)=0:"",1:FBDATE),"","I")
"RTN","FBCSV1",151,0)
 I +FBRET<0 W " Invalid Code " Q 2
"RTN","FBCSV1",152,0)
 I $P(FBRET,"^",10)=0 W !," Code is inactive" W:$G(FBDATE)>0 " on "_$$FMTE^XLFDT(FBDATE) Q 1
"RTN","FBCSV1",153,0)
 Q 0
"RTN","FBCSV1",154,0)
 ;
"RTN","FBCSV1",155,0)
 ;wrapper for DRG^ICDGTDRG
"RTN","FBCSV1",156,0)
 ;to use in prompts (and input templates)of file #162.5 to screen out 
"RTN","FBCSV1",157,0)
 ;  inactive/invalid codes
"RTN","FBCSV1",158,0)
 ;FBICD - ien of #80.2
"RTN","FBCSV1",159,0)
 ;FBINV - ien of the current #162.5 record
"RTN","FBCSV1",160,0)
 ;FBDATE - (optional) date of service
"RTN","FBCSV1",161,0)
 ;returns 0 if code is active, otherwise - nonzero value
"RTN","FBCSV1",162,0)
INPICD(FBICD,FBINV,FBDATE) ;
"RTN","FBCSV1",163,0)
 N FBRET
"RTN","FBCSV1",164,0)
 ; FB*3.5*139 Restored original line of code that was incorrectly modified in FB*3.5*94
"RTN","FBCSV1",165,0)
 I '$G(FBDATE) S FBDATE=$$FRDTINV(+$G(FBINV))
"RTN","FBCSV1",166,0)
 S FBRET=$$DRG^ICDGTDRG($G(FBICD),$S(+$G(FBDATE)=0:"",1:FBDATE))
"RTN","FBCSV1",167,0)
 I +FBRET<0 W " Invalid Code " Q 2
"RTN","FBCSV1",168,0)
 I $P(FBRET,"^",14)=0 W !," Code is inactive" W:$G(FBDATE)>0 " on "_$$FMTE^XLFDT(FBDATE) Q 1
"RTN","FBCSV1",169,0)
 Q 0
"RTN","FBCSV1",170,0)
 ;
"RTN","FBCSV1",171,0)
 ;wrapper for ICDDX^ICDCODE
"RTN","FBCSV1",172,0)
 ;checks if code is inactive on the date of service and 
"RTN","FBCSV1",173,0)
 ;if active returns CODE NUMBER
"RTN","FBCSV1",174,0)
 ;is inactive returns "" and prints message "ICD Dx Code inactive ..."
"RTN","FBCSV1",175,0)
 ;is invalid/local returns "" and prints message "Invalid ICD Dx Code"
"RTN","FBCSV1",176,0)
CHKICD9(FBIEN,FBDATE) ;
"RTN","FBCSV1",177,0)
 N FBRET
"RTN","FBCSV1",178,0)
 ;JAS - 4/2/13 - Patch 139 (ICD-10 Project) Modified next line.
"RTN","FBCSV1",179,0)
 S FBRET=$$ICDDX^ICDEX($G(FBIEN),$S(+$G(FBDATE)=0:"",1:FBDATE),"","I")
"RTN","FBCSV1",180,0)
 I +FBRET<0 W " Invalid ICD Dx Code " Q ""
"RTN","FBCSV1",181,0)
 I $P(FBRET,"^",10)=0 D  Q ""
"RTN","FBCSV1",182,0)
 . W !," ICD Dx Code "_$P(FBRET,"^",2)_" inactive"
"RTN","FBCSV1",183,0)
 . W:$G(FBDATE) " on date of service (",$$FMTE^XLFDT(FBDATE),")"
"RTN","FBCSV1",184,0)
 ;JAS - 7/18/14 - Patch 139 (ICD-10 Project) Added next section for Pending ICD-10 codes.
"RTN","FBCSV1",185,0)
 I $P(FBRET,"^",10)=1,$P(FBRET,"^",17)>FBDATE D  Q ""
"RTN","FBCSV1",186,0)
 . W !," ICD Dx Code "_$P(FBRET,"^",2)_" invalid"
"RTN","FBCSV1",187,0)
 . W:$G(FBDATE) " on date of service (",$$FMTE^XLFDT(FBDATE),")"
"RTN","FBCSV1",188,0)
 Q $P(FBRET,"^",2)
"RTN","FBCSV1",189,0)
 ;
"RTN","FBCSV1",190,0)
 ;
"RTN","FBCSV1",191,0)
 ;convert date as a string like "MMDDYYYY" into FM date like "YYYMMDD"
"RTN","FBCSV1",192,0)
STR2FBDT(FBDTSTR) ;
"RTN","FBCSV1",193,0)
 N X,Y S X=FBDTSTR D ^%DT
"RTN","FBCSV1",194,0)
 Q:Y=-1 ""
"RTN","FBCSV1",195,0)
 Q Y\1
"RTN","FBCSV1",196,0)
 ;
"RTN","FBCSV1",197,0)
IMPDATE(CSYS) ; Return the implementation date for a coding system
"RTN","FBCSV1",198,0)
 Q $$IMPDATE^LEXU($G(CSYS))
"RTN","FBCSV1",199,0)
 ;
"RTN","FBCSV1",200,0)
 ;FBCSV1
"RTN","FBICD9")
0^24^B8835442^n/a
"RTN","FBICD9",1,0)
FBICD9 ;AISC/JLG - ICD-9 DIAGNOSIS CODE UTILITIES ;3/14/2013
"RTN","FBICD9",2,0)
 ;;3.5;FEE BASIS;**139**;JAN 30, 1995;Build 127
"RTN","FBICD9",3,0)
 ;;Per VA Directive 6402, this routine should not be modified.
"RTN","FBICD9",4,0)
 ;
"RTN","FBICD9",5,0)
 ; References to API $$IMPDATE^LEXU supported by ICR #5679
"RTN","FBICD9",6,0)
 ; Reference to API $$FILE^ICDEX supported by ICR #5747
"RTN","FBICD9",7,0)
 ; Reference to API $$ROOT^ICDEX supported by ICR #5747
"RTN","FBICD9",8,0)
 ; Reference to API $$SYS^ICDEX supported by ICR #5747
"RTN","FBICD9",9,0)
 ; Reference to API $$ICDDX^ICDEX supported by ICR #5747
"RTN","FBICD9",10,0)
 ;
"RTN","FBICD9",11,0)
 ; Input - FBIDT= date of interest to check  FBPRMT= user prompt  FBALW= allow user to early exit if set to Y 
"RTN","FBICD9",12,0)
 ;         ALDEL= allow deletion of DX field? (optional)  -if this is set to "Y", @ is an acceptable entry
"RTN","FBICD9",13,0)
 ;         ALFREQ= allow forcing a field to be required (optional)  -if this is set to "Y", the field will be forced to be required
"RTN","FBICD9",14,0)
 ;         FBDFLT= default values for the search string (can be a code by default)
"RTN","FBICD9",15,0)
 ; Output- Y = IEN^ICD9 code OR -1^inactive code"    
"RTN","FBICD9",16,0)
ENICD9(FBIDT,FBPRMT,FBALW,ALDEL,ALFREQ,FBDFLT) ; prompt user for ICD9 diagnosis code and test if code is inactive
"RTN","FBICD9",17,0)
 N X,Y,DIC,DIR
"RTN","FBICD9",18,0)
 S:'$D(FBALW) FBALW="N" ; early exit allow flag
"RTN","FBICD9",19,0)
 S:'$D(ALDEL) ALDEL="N" ; delete allow flag
"RTN","FBICD9",20,0)
 S:'$D(ALFREQ) ALFREQ="N" ; force required allow flag
"RTN","FBICD9",21,0)
SRCH1 ;
"RTN","FBICD9",22,0)
 S Y=$$SEARCH(FBIDT)
"RTN","FBICD9",23,0)
 I (Y>0)&('$$ICD9ACT(+Y,FBIDT)) D
"RTN","FBICD9",24,0)
 . W !!,*7,"ICD Dx Code "_"("_$P(Y,U,2)_")"_" inactive on date of service ("_$$FMTE^XLFDT(FBIDT)_").",!
"RTN","FBICD9",25,0)
 . S Y="-1^inactive code"
"RTN","FBICD9",26,0)
 . Q
"RTN","FBICD9",27,0)
 Q Y
"RTN","FBICD9",28,0)
 ; 
"RTN","FBICD9",29,0)
 ; Input  -FBINDT = ICD versioning date
"RTN","FBICD9",30,0)
 ; Output -Y = IEN^ICD9 code    
"RTN","FBICD9",31,0)
SEARCH(FBINDT) ; 
"RTN","FBICD9",32,0)
 I $G(FBDFLT)>0 S DIR("A")=FBPRMT_": "_$P($$ICDDX^ICDEX(FBDFLT,FBIDT,1,"I"),"^",2)_"// "
"RTN","FBICD9",33,0)
 E  S DIR("A")=FBPRMT_": "
"RTN","FBICD9",34,0)
 S DIR(0)="FAOr^0:245"
"RTN","FBICD9",35,0)
 S DIR("?")="Answer with ICD DIAGNOSIS CODE NUMBER, or DESCRIPTION"
"RTN","FBICD9",36,0)
 D ^DIR K DIR
"RTN","FBICD9",37,0)
 I ((X="@")&(ALFREQ="Y")) W "??  REQUIRED" G SRCH1
"RTN","FBICD9",38,0)
 I X="@",ALDEL="Y",$G(FBDFLT)="" S ALDEL="N"
"RTN","FBICD9",39,0)
 I X="@",ALDEL="Y" N FBYN D  Q:FBYN=1 "@" G SRCH1
"RTN","FBICD9",40,0)
 . S FBYN=$$QUESTION^FBASF(2,"SURE YOU WANT TO DELETE")
"RTN","FBICD9",41,0)
 . I FBYN'=1 W "  <NOTHING DELETED>"
"RTN","FBICD9",42,0)
 I X="@" W "??" G SRCH1
"RTN","FBICD9",43,0)
 I X="^",FBALW="Y" Q -1
"RTN","FBICD9",44,0)
 I X="^" W !,?4,"EXIT NOT ALLOWED ??" G SRCH1
"RTN","FBICD9",45,0)
 N ROOT,FILE,SYS,ICDVDT,FILEID,SCREEN,DISFIL
"RTN","FBICD9",46,0)
 S FILEID=80,SCREEN="I $$CHKVERS^FBICD9(+Y,FBINDT)",DISFIL="EIMQ"
"RTN","FBICD9",47,0)
 S FILE=$$FILE^ICDEX($G(FILEID)) Q:+FILE'>0 -1
"RTN","FBICD9",48,0)
 S (DIC,ROOT)=$$ROOT^ICDEX(FILE) Q:'$L(ROOT) -1
"RTN","FBICD9",49,0)
 S DIC("S")=$S($L($G(SCREEN)):$G(SCREEN),1:"I 1")
"RTN","FBICD9",50,0)
 S:$G(FBINDT) ICDVDT=$G(FBINDT)
"RTN","FBICD9",51,0)
 S SYS=$$SYS^ICDEX(FILE,$G(ICDVDT)) S:+SYS>0 ICDSYS=+SYS
"RTN","FBICD9",52,0)
 S DISFIL=$G(DISFIL,"EMQZ") S DISFIL=$TR(DISFIL,"L","") K DLAYGO
"RTN","FBICD9",53,0)
 S DIC(0)=DISFIL D ^DIC K DIC,ICDSYS,ICDFMT
"RTN","FBICD9",54,0)
 S:+($G(Y))'>0 Y=-1
"RTN","FBICD9",55,0)
 G:((Y=-1)&($L(X)>0)) SRCH1
"RTN","FBICD9",56,0)
 Q Y
"RTN","FBICD9",57,0)
 ;
"RTN","FBICD9",58,0)
 ;Input : Y (ien of file 80), (date of interest)
"RTN","FBICD9",59,0)
 ;Output: 1 (true) or 0 (false)
"RTN","FBICD9",60,0)
CHKVERS(FBDIRY,FBDT) ; return true (1) if diagnosis code is a current versioned ICD code, otherwise return false (0) 
"RTN","FBICD9",61,0)
 N FBICDSYS,FBINF,FBIC9SYS
"RTN","FBICD9",62,0)
 S FBICDSYS=$S(FBDT<$$IMPDATE^LEXU(30):1,1:30)            ; 1 = icd-9 version  30 = icd-10 version
"RTN","FBICD9",63,0)
 S FBIC9SYS=$P($$ICDDX^ICDEX(FBDIRY,FBDT,"","I"),U,20) ; 1 = icd-9 version  30 = icd-10 version
"RTN","FBICD9",64,0)
 Q:FBICDSYS=FBIC9SYS 1 ; returns true
"RTN","FBICD9",65,0)
 Q 0 ; returns false
"RTN","FBICD9",66,0)
 ;
"RTN","FBICD9",67,0)
ICD9ACT(IEN,FBDT) ;Is the given code active for the date? (default-today)
"RTN","FBICD9",68,0)
 N FBINF,FBRES
"RTN","FBICD9",69,0)
 I '$G(FBDT) S FBDT=DT
"RTN","FBICD9",70,0)
 S FBRES=0
"RTN","FBICD9",71,0)
 S FBINF=$$ICDDX^ICDEX(IEN,FBDT,"","I")
"RTN","FBICD9",72,0)
 I FBINF'<0,$P(FBINF,U,10) S FBRES=1
"RTN","FBICD9",73,0)
 Q FBRES
"RTN","FBICD9",74,0)
 ;
"RTN","FBICDP")
0^26^B9560886^n/a
"RTN","FBICDP",1,0)
FBICDP ;AISC/JAS - ICD-9 & 10 PROCEDURE CODE UTILITIES ;9/26/2013
"RTN","FBICDP",2,0)
 ;;3.5;FEE BASIS;**139**;JAN 30, 1995;Build 127
"RTN","FBICDP",3,0)
 ;;Per VA Directive 6402, this routine should not be modified.
"RTN","FBICDP",4,0)
 ;
"RTN","FBICDP",5,0)
 ; References to API $$IMPDATE^LEXU supported by ICR #5679
"RTN","FBICDP",6,0)
 ; Reference to API $$FILE^ICDEX supported by ICR #5747
"RTN","FBICDP",7,0)
 ; Reference to API $$ROOT^ICDEX supported by ICR #5747
"RTN","FBICDP",8,0)
 ; Reference to API $$SYS^ICDEX supported by ICR #5747
"RTN","FBICDP",9,0)
 ; Reference to API $$ICDOP^ICDEX supported by ICR #5747
"RTN","FBICDP",10,0)
 ;
"RTN","FBICDP",11,0)
 ;THIS ROUTINE WAS CLONED FROM FBICD9, BUT HAS BEEN MODIFIED TO BE USED FOR ICD-9 AND ICD-10 PROCEDURE CODES.
"RTN","FBICDP",12,0)
 ; Input - FBIDT= date of interest to check  FBPRMT= user prompt  FBALW= allow user to early exit if set to Y 
"RTN","FBICDP",13,0)
 ;         ALDEL= allow deletion of Proc field? (optional)  -if this is set to "Y", @ is an acceptable entry
"RTN","FBICDP",14,0)
 ;         ALFREQ= allow forcing a field to be required (optional)  -if this is set to "Y", the field will be forced to be required
"RTN","FBICDP",15,0)
 ;         FBDFLT= default values for the search string (can be a code by default)
"RTN","FBICDP",16,0)
 ; Output- Y = IEN^Proc code OR -1^inactive code"
"RTN","FBICDP",17,0)
ENICD9(FBIDT,FBPRMT,FBALW,ALDEL,ALFREQ,FBDFLT) ; prompt user for ICD procedure code and test if code is inactive
"RTN","FBICDP",18,0)
 N Y,DIC,FBICDCD,FBIMPDT K X
"RTN","FBICDP",19,0)
 S:'$D(FBALW) FBALW="N" ; early exit allow flag
"RTN","FBICDP",20,0)
 S:'$D(ALDEL) ALDEL="N" ; delete allow flag
"RTN","FBICDP",21,0)
 S:'$D(ALFREQ) ALFREQ="N" ; force required allow flag
"RTN","FBICDP",22,0)
 S FBICDCD=31,FBIMPDT=$$IMPDATE^FBCSV1("10D")
"RTN","FBICDP",23,0)
 S:FBIDT<FBIMPDT FBICDCD=2
"RTN","FBICDP",24,0)
SRCH1 ;
"RTN","FBICDP",25,0)
 S Y=$$SEARCH(FBIDT)
"RTN","FBICDP",26,0)
 I (Y>0)&('$$ICD9ACT(+Y,FBIDT)) D
"RTN","FBICDP",27,0)
 . W !!,*7,"ICD Proc Code "_"("_$P(Y,U,2)_")"_" inactive on date of service ("_$$FMTE^XLFDT(FBIDT)_").",!
"RTN","FBICDP",28,0)
 . S Y="-1^inactive code"
"RTN","FBICDP",29,0)
 . Q
"RTN","FBICDP",30,0)
 Q Y
"RTN","FBICDP",31,0)
 ; 
"RTN","FBICDP",32,0)
 ; Input  -FBINDT = ICD versioning date
"RTN","FBICDP",33,0)
 ; Output -Y = IEN^Proc code    
"RTN","FBICDP",34,0)
SEARCH(FBINDT) ; 
"RTN","FBICDP",35,0)
 I $G(FBDFLT)>0 S DIR("A")=FBPRMT_": "_$P($$ICDOP^ICDEX(FBDFLT,FBIDT,FBICDCD,"I"),"^",2)_"// "
"RTN","FBICDP",36,0)
 E  S DIR("A")=FBPRMT_": "
"RTN","FBICDP",37,0)
 S DIR(0)="FAOr^0:245"
"RTN","FBICDP",38,0)
 S DIR("?")="Answer with ICD OPERATION/PROCEDURE CODE NUMBER, or DESCRIPTION"
"RTN","FBICDP",39,0)
 D ^DIR K DIR
"RTN","FBICDP",40,0)
 I ((X="@")&(ALFREQ="Y")) W "?? REQUIRED" G SRCH1
"RTN","FBICDP",41,0)
 I X="@",ALDEL="Y",$G(FBDFLT)="" S ALDEL="N"
"RTN","FBICDP",42,0)
 I X="@",ALDEL="Y" N FBYN D  Q:FBYN=1 "@" G SRCH1
"RTN","FBICDP",43,0)
 . S FBYN=$$QUESTION^FBASF(2,"SURE YOU WANT TO DELETE")
"RTN","FBICDP",44,0)
 . I FBYN'=1 W " <NOTHING DELETED>"
"RTN","FBICDP",45,0)
 I X="@" W "??" G SRCH1
"RTN","FBICDP",46,0)
 I X="^",FBALW="Y" Q -1
"RTN","FBICDP",47,0)
 I X="^" W !,?4,"EXIT NOT ALLOWED ??" G SRCH1
"RTN","FBICDP",48,0)
 N ROOT,FILE,SYS,ICDVDT,FILEID,SCREEN,DISFIL
"RTN","FBICDP",49,0)
 S FILEID=80.1,SCREEN="I $$CHKVERS^FBICDP(+Y,FBINDT)",DISFIL="EIMQ"
"RTN","FBICDP",50,0)
 S FILE=$$FILE^ICDEX($G(FILEID)) Q:+FILE'>0 -1
"RTN","FBICDP",51,0)
 S (DIC,ROOT)=$$ROOT^ICDEX(FILE) Q:'$L(ROOT) -1
"RTN","FBICDP",52,0)
 S DIC("S")=$S($L($G(SCREEN)):$G(SCREEN),1:"I 1")
"RTN","FBICDP",53,0)
 S:$G(FBINDT) ICDVDT=$G(FBINDT)
"RTN","FBICDP",54,0)
 S SYS=$$SYS^ICDEX(FILE,$G(ICDVDT)) S:+SYS>0 ICDSYS=+SYS
"RTN","FBICDP",55,0)
 S DISFIL=$G(DISFIL,"EMQZ") S DISFIL=$TR(DISFIL,"L","") K DLAYGO
"RTN","FBICDP",56,0)
 S DIC(0)=DISFIL D ^DIC K DIC,ICDSYS,ICDFMT
"RTN","FBICDP",57,0)
 S:+($G(Y))'>0 Y=-1
"RTN","FBICDP",58,0)
 G:((Y=-1)&($L(X)>0)) SRCH1
"RTN","FBICDP",59,0)
 Q Y
"RTN","FBICDP",60,0)
 ;
"RTN","FBICDP",61,0)
 ;Input : Y (ien of file 80.1), (date of interest)
"RTN","FBICDP",62,0)
 ;Output: 1 (true) or 0 (false)
"RTN","FBICDP",63,0)
CHKVERS(FBDIRY,FBDT) ; return true (1) if procedure code is a current versioned Proc code, otherwise return false (0) 
"RTN","FBICDP",64,0)
 N FBICDSYS,FBINF,FBIC9SYS
"RTN","FBICDP",65,0)
 S FBICDSYS=$S(FBDT<$$IMPDATE^LEXU(31):2,1:31)            ; 2 = icd-9 version  31 = icd-10 version
"RTN","FBICDP",66,0)
 S FBIC9SYS=$P($$ICDOP^ICDEX(FBDIRY,FBDT,"","I"),U,15) ; 2 = icd-9 version  31 = icd-10 version
"RTN","FBICDP",67,0)
 Q:FBICDSYS=FBIC9SYS 1 ; returns true
"RTN","FBICDP",68,0)
 Q 0 ; returns false
"RTN","FBICDP",69,0)
 ;
"RTN","FBICDP",70,0)
ICD9ACT(IEN,FBDT) ;Is the given code active for the date? (default-today)
"RTN","FBICDP",71,0)
 N FBINF,FBRES
"RTN","FBICDP",72,0)
 I '$G(FBDT) S FBDT=DT
"RTN","FBICDP",73,0)
 S FBRES=0
"RTN","FBICDP",74,0)
 S FBINF=$$ICDOP^ICDEX(IEN,FBDT,"","I")
"RTN","FBICDP",75,0)
 I FBINF'<0,$P(FBINF,U,10) S FBRES=1
"RTN","FBICDP",76,0)
 Q FBRES
"RTN","FBICDP",77,0)
 ;
"RTN","FBNHEAUT")
0^14^B27561875^B25443874
"RTN","FBNHEAUT",1,0)
FBNHEAUT ;AISC/DMK,GRR - ENTER/EDIT AUTHORIZATION ;08/07/02
"RTN","FBNHEAUT",2,0)
 ;;3.5;FEE BASIS;**43,103,139**;JAN 30, 1995;Build 127
"RTN","FBNHEAUT",3,0)
 ;;Per VA Directive 6402, this routine should not be modified.
"RTN","FBNHEAUT",4,0)
 D SITEP^FBAAUTL Q:FBPOP  S FBAADDYS=+$P(FBSITE(0),"^",13),FBAAASKV=$P(FBSITE(1),"^"),FBPROG=$S($P(FBSITE(1),"^",6)="":"I 1",1:"I $P(^(0),U,3)=7") W !!
"RTN","FBNHEAUT",5,0)
 ;
"RTN","FBNHEAUT",6,0)
 S PRCS("TYPE")="FB",PRCS("A")="Select Obligation Number: " K PRCS("X") D EN1^PRCS58 G:Y<0 NOGOOD^FBNHEAU1 S FBOBN=$P(Y,"^",2) K PRCS("A")
"RTN","FBNHEAUT",7,0)
 ;
"RTN","FBNHEAUT",8,0)
 W !! S DIC="^DPT(",DIC(0)="QEAZM" D ^DIC G END:Y<0 S DFN=+Y
"RTN","FBNHEAUT",9,0)
 I $P($G(^DPT(DFN,.361)),"^")="" W !!,"ELIGIBILITY HAS NOT BEEN DETERMINED NOR PENDING, CANNOT ENTER AN AUTHORIZATION." G FBNHEAUT
"RTN","FBNHEAUT",10,0)
 I $P($G(^DPT(DFN,.32)),"^",4)=2 W !!,"VETERAN HAS A DISHONORABLE DISCHARGE, " S X=$P($G(^(.321)),"^") W $S(X="Y":"ONLY ELIGIBLE FOR AGENT ORANGE.",1:"NOT ELIGIBLE FOR BENEFITS.")
"RTN","FBNHEAUT",11,0)
 I "N"[$E(X) W ! S DIR("A")="Do you want to continue",DIR(0)="Y",DIR("B")="No" D ^DIR K DIR G FBNHEAUT:$S($D(DIRUT):1,'Y:1,1:0)
"RTN","FBNHEAUT",12,0)
 S DA=DFN I '$D(^FBAAA(DFN,0)) K DD,DO S (X,DINUM)=DFN,DIC="^FBAAA(",DIC(0)="LM",DLAYGO=161 D FILE^DICN K DIC,DLAYGO G:Y<0 END
"RTN","FBNHEAUT",13,0)
 S:'$D(^FBAAA(DFN,1,0)) ^(0)="^161.01D^^"
"RTN","FBNHEAUT",14,0)
 D ^FBAADEM ;G FBNHEAUT:FBAAOUT
"RTN","FBNHEAUT",15,0)
 ;
"RTN","FBNHEAUT",16,0)
GETVEN S FBPROG=7 D DATES^FBAAUTL2 G:FBBEGDT="" FBNHEAUT
"RTN","FBNHEAUT",17,0)
 D GETVEN^FBAAUTL1 G END:X="^"!(X=""),GETVEN:IFN="" S FBVEN=IFN,FBPAYDT=FBBEGDT,X=+FBBEGDT D DAYS^FBAAUTL1 S FBDAYS=$S(X>(FBENDDT-FBBEGDT):(FBENDDT-FBBEGDT),1:X)
"RTN","FBNHEAUT",18,0)
 D GETRAT^FBNHEAU2 G:FBERR GETVEN
"RTN","FBNHEAUT",19,0)
 ;CREATE AN ENTRY IN FILE 161
"RTN","FBNHEAUT",20,0)
 K DD,DO S DLAYGO=161,DA(1)=DFN,(DIE,DIC)="^FBAAA("_DA(1)_",1,",DIC(0)="LQ",X=FBBEGDT D FILE^DICN K DLAYGO S DA=+Y,FBAAADA=DA
"RTN","FBNHEAUT",21,0)
 S DIE=DIC,FBPSADF=$S($D(FBSITE(1)):$P(^DIC(4,$P(FBSITE(1),"^",3),0),"^",1),1:"")
"RTN","FBNHEAUT",22,0)
 ; fb*3.5*103  added REFERRING PROVIDER field (161.01,104) to DR string
"RTN","FBNHEAUT",23,0)
 S DR=".02////^S X=FBENDDT;.03////^S X=7;S FBTYPE=7;100////^S X=DUZ;1////^S X=""YES"";.04////^S X=FBVEN;.095////1;101T;104;.065;.07;.021;.097"
"RTN","FBNHEAUT",24,0)
 ; DEM;139 added ICD-10 functionality for ICD-10 Project.
"RTN","FBNHEAUT",25,0)
 N XX1  ;DEM;139 added variable XX1 for ICD-10 Project.
"RTN","FBNHEAUT",26,0)
 S DR(1,161.01,1)="I FBBEGDT<$$IMPDATE^FBCSV1(""10D"") S Y=""@9"""
"RTN","FBNHEAUT",27,0)
 S DR(1,161.01,2)="@10;S EDATE=FBBEGDT;S XX1=-1 S XX1=$$ASKICD10^FBASF(""ICD DIAGNOSIS"","""");I XX1<0 S Y=""@10"";.087////^S X=XX1;K EDATE;S Y=""@999"""
"RTN","FBNHEAUT",28,0)
 S DR(1,161.01,3)="@9;.08;S:X="""" Y="""";.085;S:X="""" Y="""";.086"
"RTN","FBNHEAUT",29,0)
 S DR(1,161.01,4)="@999"
"RTN","FBNHEAUT",30,0)
 D ^DIE
"RTN","FBNHEAUT",31,0)
 I $D(DTOUT)!('$D(Y)=0) S DIC="^FBAAA("_DFN_",1," G DEL
"RTN","FBNHEAUT",32,0)
 ; fb*3.5*103  assignment of REFERRING PROVIDER (161.01,104) for recording at 162.4,15 via the FBNH ENTER 7078 input template
"RTN","FBNHEAUT",33,0)
 S FBRP=$$GET1^DIQ(161.01,FBAAADA_","_DFN,104,"I")
"RTN","FBNHEAUT",34,0)
 S FBVEN=FBVEN_";FBAAV("
"RTN","FBNHEAUT",35,0)
 ;
"RTN","FBNHEAUT",36,0)
 S X=FBPAYDT D DAYS^FBAAUTL1 S FBATODT=$S($E(FBPAYDT,1,5)_"00"+X>FBENDDT:FBENDDT-1,1:$E(FBPAYDT,1,5)_"00"+X)
"RTN","FBNHEAUT",37,0)
 D EST^FBNHEAU2
"RTN","FBNHEAUT",38,0)
 I $G(FBDEFP)'>0 W !,*7,"Unable to determine estimated dollar amount, based on authorization",!,"dates and current vendor contracts.",! S DA=FBAAADA,DA(1)=DFN,DIC="^FBAAA("_DFN_",1," G DEL
"RTN","FBNHEAUT",39,0)
 ;CHECK 1358 and get next point number. create entry in 162.4
"RTN","FBNHEAUT",40,0)
 S X=FBOBN K PRCS("A") S PRCS("TYPE")="FB" D EN1^PRCSUT31 I Y<0 S DIC="^FBAAA("_DFN_",1," D PROB^FBNHEAU1 G DEL
"RTN","FBNHEAUT",41,0)
 S FB7078=$P(FBOBN,"-",2)_"."_Y,FBSEQ=Y,DIC="^FB7078(",DIC(0)="LQ",DLAYGO=162.4,X=""""_FB7078_"""" D ^DIC K DLAYGO I Y<0 S DIC="^FBAAA("_DFN_",1," D PROB2^FBNHEAU1 G DEL
"RTN","FBNHEAUT",42,0)
 S (DA,FBAA78)=+Y
"RTN","FBNHEAUT",43,0)
 S DIE=DIC,DR="[FBNH ENTER 7078]" D ^DIE
"RTN","FBNHEAUT",44,0)
 I $O(^FBAAA(DFN,1,FBAAADA,2,0))>0 S ^FB7078(FBAA78,1,0)=^FBAAA(DFN,1,FBAAADA,2,0) F Z=0:0 S Z=$O(^FBAAA(DFN,1,FBAAADA,2,Z)) Q:Z'>0  S ^FB7078(FBAA78,1,Z,0)=^FBAAA(DFN,1,FBAAADA,2,Z,0)
"RTN","FBNHEAUT",45,0)
 S $P(^FBAAA(DFN,1,FBAAADA,0),"^",9)=FBAA78_";FB7078(",^FBAAA("AG",FBAA78_";FB7078(",DFN,FBAAADA)=""
"RTN","FBNHEAUT",46,0)
 ;call to create entries in file 161.23, time sensitive file
"RTN","FBNHEAUT",47,0)
 ;that will store patient rates
"RTN","FBNHEAUT",48,0)
 S FBERR=0 D FILE^FBNHEAU2 I FBERR W !,"Unable to create entry in Authorization Rate file (161.23).  Contact IRM.",! G ADM
"RTN","FBNHEAUT",49,0)
 ;call to create entry in ifcap 424.
"RTN","FBNHEAUT",50,0)
 S FBMM=$E(FBBEGDT,4,5)
"RTN","FBNHEAUT",51,0)
 S PRCS("TYPE")="FB" K PRCS("A") S FBNAME=$$NAME^FBCHREQ2(DFN),FBSSN=$$SSN^FBAAUTL(DFN) D NOW^%DTC S FBPOSDT=%,X=FBOBN_"^"_FBPOSDT_"^"_FBDEFP_"^^"_FBSEQ_"^"_FBNAME_"  ("_FBSSN_")"_"^"_DFN_";"_FBAA78_";"_$P(FBOBN,"-",2)_";"_FBMM D EN2^PRCS58
"RTN","FBNHEAUT",52,0)
 I +Y=0 W !!,"Error trying to Post to 1358, DID NOT POST. Error was:",!,Y,!?7,"Adjust the 1358 for $",$FN(FBDEFP,",",2)," then use the",!?7,"Post Commitments for Obligation option!",!,*7 G ADM
"RTN","FBNHEAUT",53,0)
 W !!,$J(FBDEFP,7,2),"  Posted to 1358"
"RTN","FBNHEAUT",54,0)
 ;
"RTN","FBNHEAUT",55,0)
 ;
"RTN","FBNHEAUT",56,0)
CHEKP78 S FBNUM=$P(FBSITE(1),"^",5),FBO=$P(FBSITE(1),"^",7),FBT=$P(FBSITE(1),"^",8) D FBO^FBCHP78 G END:$D(DIRUT) S IOP="Q",FB7078=FBAA78 W !
"RTN","FBNHEAUT",57,0)
 D IFCAP^FBAAUTL2
"RTN","FBNHEAUT",58,0)
 I '$D(FBERR(1)) S VAR="FB7078^FBNUM^FBO^FBT^FB(""SITE"")",VAL=FB7078_"^"_FBNUM_"^"_FBO_"^"_FBT_"^"_FB("SITE"),PGM="START^FBCHP78",%ZIS("B")="" W ! D ZIS^FBAAUTL
"RTN","FBNHEAUT",59,0)
 ;
"RTN","FBNHEAUT",60,0)
ADM S DIR(0)="Y",DIR("A")="Do you want to Admit Patient to CNH now",DIR("B")="YES" D ^DIR K DIR I Y S FBVEN=+FBVEN,FTP=FBAAADA,FBAABDT=FBBEGDT,FBAAEDT=FBENDDT,FBEND=1,FBRCHK=1 D RD2^FBNHEA
"RTN","FBNHEAUT",61,0)
 ;
"RTN","FBNHEAUT",62,0)
END D END^FBNHEAU1
"RTN","FBNHEAUT",63,0)
 Q
"RTN","FBNHEAUT",64,0)
 ;
"RTN","FBNHEAUT",65,0)
DEL S DIK=DIC D ^DIK K DIK,DIC D END^FBNHEAU1 G FBNHEAUT
"RTN","FBNHEDAT")
0^20^B15561616^B13901461
"RTN","FBNHEDAT",1,0)
FBNHEDAT ;AISC/GRR - ENTER/EDIT AUTHORIZATION ;6/5/2009
"RTN","FBNHEDAT",2,0)
 ;;3.5;FEE BASIS;**103,108,139**;JAN 30, 1995;Build 127
"RTN","FBNHEDAT",3,0)
 ;;Per VA Directive 6402, this routine should not be modified.
"RTN","FBNHEDAT",4,0)
 D SITEP^FBAAUTL
"RTN","FBNHEDAT",5,0)
RD1 S U="^" D GETVET^FBAAUTL1 G:DFN="" END
"RTN","FBNHEDAT",6,0)
 S FBPROG="I $P(^(0),U,3)=7" D GETAUTH^FBAAUTL1 G RD1:'CNT!(FTP']"")!($D(DIRUT)) S (FBOLD,FBNEW,FBERR)=""
"RTN","FBNHEDAT",7,0)
 K FBAUT,CNT S (DA(1),D0)=DFN,FBOLD=^FBAAA(DFN,1,FTP,0),DA=FTP,FBAAADA=DA,DIE="^FBAAA("_DFN_",1,",FBO=$P(FBOLD,"^"),(FB1,FBAA(2))=$P(FBOLD,"^",2)
"RTN","FBNHEDAT",8,0)
 S FBPROG=7 D DATES^FBAAUTL2 S FBAA(1)=$S($G(FBBEGDT):FBBEGDT,1:FBO),FBAA(2)=$S($G(FBENDDT):FBENDDT,1:FB1)
"RTN","FBNHEDAT",9,0)
DR S DR=".01////^S X=FBAA(1);.02////^S X=FBAA(2)"
"RTN","FBNHEDAT",10,0)
 ; fb*3.5*103  add REFERRING PROVIDER (161.01,104) to DR string
"RTN","FBNHEDAT",11,0)
 ; FB*3.5*139-ICD10 REMEDIATION-jlg - modify original code to process diagnosis code based on ICD version in DR string
"RTN","FBNHEDAT",12,0)
 S DR(1,161.01,1)="@2;.065;.07;.021;S:FBAA(1)'<$$IMPDATE^FBCSV1(""10D"") Y=""@10"";.08;S:X="""" Y=101;.085;S:X="""" Y=101;.086;S Y=101;"
"RTN","FBNHEDAT",13,0)
 S DR(1,161.01,2)="@10;N XX1;S XX1=-1;S FBDFN=DFN;S EDATE=FBAA(1);S XX1=$$ASKICD10^FBASF(""ICD DIAGNOSIS"","""","""",""Y"");S:XX1<1 Y=""@10"";.087////^S X=XX1;101;104;.097" D ^DIE
"RTN","FBNHEDAT",14,0)
 ; End 139
"RTN","FBNHEDAT",15,0)
 S FBNEW=$S('$D(DA):"",'$D(^FBAAA(DFN,1,DA,0)):"",1:^(0)) K DR
"RTN","FBNHEDAT",16,0)
 I $D(Y)>0,FBNEW=""!(FBNEW=FBOLD) G RD1
"RTN","FBNHEDAT",17,0)
 I FBNEW'=FBOLD,$P(FBNEW,"^")>$P(FBNEW,"^",2) S DR=".01////^S X=FBO;.02////^S X=FB1" D ^DIE K DR D ER G DR
"RTN","FBNHEDAT",18,0)
 ;
"RTN","FBNHEDAT",19,0)
 S FBAA78=FB7078 D ^FBNHEDA1 K FBAA78 I FBERR S DA(1)=DFN,DA=FTP,DIE="^FBAAA("_DA(1)_",1,",DR=".01////^S X=FBO;.02////^S X=FB1" D ^DIE G END
"RTN","FBNHEDAT",20,0)
 ; fb*3.5*103  add the REFERRING PROVIDER (162.4,15) to the DR string; stuff with the value stored at 161.01,104
"RTN","FBNHEDAT",21,0)
 S DIE="^FB7078(",DA=FB7078,FBAA78=DA,DR="5;6;15////^S X=$$GET1^DIQ(161.01,FBAAADA_"",""_DFN,104,""I"")" I 'DA W !!,*7,"No 7078 on file!",! G END
"RTN","FBNHEDAT",22,0)
 D:FBOLD'=FBNEW CHANGED
"RTN","FBNHEDAT",23,0)
GO D ^DIE
"RTN","FBNHEDAT",24,0)
 I $O(^FBAAA(DFN,1,FBAAADA,2,0))>0 K ^FB7078(FBAA78,1) S ^FB7078(FBAA78,1,0)=^FBAAA(DFN,1,FBAAADA,2,0) F Z=0:0 S Z=$O(^FBAAA(DFN,1,FBAAADA,2,Z)) Q:Z'>0  S ^FB7078(FBAA78,1,Z,0)=^FBAAA(DFN,1,FBAAADA,2,Z,0)
"RTN","FBNHEDAT",25,0)
RD2 S DIR(0)="Y",DIR("A")="Want to Queue 7078 for printing",DIR("B")=$S(FBOLD=FBNEW:"No",1:"Yes") D ^DIR K DIR G:Y'>0 RD1
"RTN","FBNHEDAT",26,0)
CHEKP78 S FBNUM=$P(FBSITE(1),"^",5),FBO=$P(FBSITE(1),"^",7),FBT=$P(FBSITE(1),"^",8) D FBO^FBCHP78 G END:$D(DIRUT) S IOP="Q",%ZIS("B")="",FB7078=FBAA78,FB("SITE")=$P(FBSITE(1),"^",3) W !
"RTN","FBNHEDAT",27,0)
 S VAR="FB7078^FBNUM^FBO^FBT^FB(""SITE"")",VAL=FB7078_"^"_FBNUM_"^"_FBO_"^"_FBT_"^"_FB("SITE"),PGM="START^FBCHP78" W ! D ZIS^FBAAUTL
"RTN","FBNHEDAT",28,0)
 ;
"RTN","FBNHEDAT",29,0)
END K D0,DA,FBAASKV,FBAADDYS,FBAALT,FBAAP79,FBAATT,FBNUM,FBDEV,FBO,FBT,FB7078,FBAA78,FBCOUNTY,FBDX,FBI,FBRR,FBVEN,FBTYPE,FBXX,I,J,K,PI,FBOLD,FBNEW,FBPSADF,FBAADA,FB1,FBERR,FBOUT,FBIFN,FBZ,FBBEGDT,FBENDDT,FBAUT
"RTN","FBNHEDAT",30,0)
 K DIE,DIR,FBAAADA,FTP,PGM,VAL,VAR,X,Y,Z,DIC,A,FBAABDT,FBAAEDT,FBAAOUT,FBASSOC,FBLOC,FBPOV,FBPROG,FBPSA,FBPT,FBSITE,FBTT,PTYPE,T,ZZ,FB("SITE"),FBPOP,FBAA,FBBDT,FBTDAYS,HOLDX
"RTN","FBNHEDAT",31,0)
 D END^FBNHEAU1
"RTN","FBNHEDAT",32,0)
 D GETAUTHK^FBAAUTL1
"RTN","FBNHEDAT",33,0)
 D CLOSE^FBAAUTL
"RTN","FBNHEDAT",34,0)
 Q
"RTN","FBNHEDAT",35,0)
 ;
"RTN","FBNHEDAT",36,0)
CHANGED S:$P(FBOLD,"^",1)'=$P(FBNEW,"^",1) DR="3////^S X=$P(FBNEW,U,1);"_DR
"RTN","FBNHEDAT",37,0)
 S:$P(FBOLD,"^",2)'=$P(FBNEW,"^",2) DR="4////^S X=$P(FBNEW,U,2);"_DR
"RTN","FBNHEDAT",38,0)
 Q
"RTN","FBNHEDAT",39,0)
 ;
"RTN","FBNHEDAT",40,0)
ER W !,*7,"From Date cannot be greater than the To Date.",!
"RTN","FBNHEDAT",41,0)
 Q
"RTN","FBNHEDAT",42,0)
 ;
"RTN","FBNHEDAT",43,0)
ER1 W !,*7,"This patient has movements after the authorization to date.  You must",!,"edit the patient's movements first.",!
"RTN","FBNHEDAT",44,0)
 Q
"RTN","FBPAY67")
0^25^B45350790^B41631569
"RTN","FBPAY67",1,0)
FBPAY67 ;AISC/DMK,TET,BPOIFO/MEC - CH/CNH PAYMENT HISTORY SORT ;9/13/12 10:29am
"RTN","FBPAY67",2,0)
 ;;3.5;FEE BASIS;**4,32,55,69,108,143,139**;JAN 30, 1995;Build 127
"RTN","FBPAY67",3,0)
 ;;Per VA Directive 6402, this routine should not be modified.
"RTN","FBPAY67",4,0)
EN ;entry to sort
"RTN","FBPAY67",5,0)
 I FBSORT S DFN=FBIEN,FBPID=FBID,FBPNAME=FBNAME
"RTN","FBPAY67",6,0)
 I 'FBSORT S FBVI=FBIEN,FBVID=FBID,FBVNAME=$E(FBNAME,1,23)
"RTN","FBPAY67",7,0)
FBAAC ;check ^fbaac("an" (file 162)
"RTN","FBPAY67",8,0)
 S FBOUT=0 I $D(^FBAAC("AN",FBPI)) D AN  I $G(FBPIFLG) S FBPI=7 D AN S FBPI=6
"RTN","FBPAY67",9,0)
 S I=FBBEG,FBIX=$S(FBSORT:"AG",1:"AF")
"RTN","FBPAY67",10,0)
SORT ;sort programs 6 & 7 (civil hos & cnh)
"RTN","FBPAY67",11,0)
 F FBM=FBBEG-.1:0 S FBM=$O(^FBAAI(FBIX,FBIEN,FBM)) Q:FBM'>0!(FBM>FBEND)  F FBI=0:0 S FBI=$O(^FBAAI(FBIX,FBIEN,FBM,FBI)) Q:FBI'>0  I $G(^FBAAI(FBI,"FBREJ"))']"" D SET S FBPI=FBPISV
"RTN","FBPAY67",12,0)
KILL ;kill variables set in routine and in FBPAY2, sort/set sections
"RTN","FBPAY67",13,0)
 K A1,A2,A3,D,D2,FBAACPTC,FBBN,FBCNT,FBCP,FBDT,FBDT1,FBDX,FBDX1,FBI,FBIN,FBIX,FBM,FBOB,FBPDX,FBPISV,FBPROC,FBPROC1,FBSC,FBTA,FBVEN,FBVENID,FBVP,I,J,K,L,M,Y,FBDT2,FBPROA,FBPOA,FBADMTDX
"RTN","FBPAY67",14,0)
 K:FBSORT FBVNAME,FBVID K:'FBSORT FBPNAME,FBPID
"RTN","FBPAY67",15,0)
 D KILL^FBPAY2
"RTN","FBPAY67",16,0)
 Q
"RTN","FBPAY67",17,0)
SET ;set string, also called by fbchdi (fblistc or fbaanq set if called by fbchdi)
"RTN","FBPAY67",18,0)
 N FBY2,FBY3,FBY5,FBCDAYS,FBCSID,FBFPPSC,FBFPPSL,FBX,FBADJLR,FBADJLA,FBRRMKL,FBAARCE,FBX,FBADMTDX,P2,FBPOA
"RTN","FBPAY67",19,0)
 S FBPISV=$G(FBPI),FBIN=$G(^FBAAI(FBI,0)) Q:FBIN']""  S FBPI=+$P(FBIN,U,12)
"RTN","FBPAY67",20,0)
 I 'FBPROG,'$D(FBPROG(+$P(FBIN,U,12))) Q
"RTN","FBPAY67",21,0)
 I '$D(FBPIFLG) Q:+$P(FBIN,U,12)'=FBPI
"RTN","FBPAY67",22,0)
 I $D(FBPIFLG),'FBPROG Q:'$D(FBPROG(+$P(FBIN,U,12)))
"RTN","FBPAY67",23,0)
 S FBY2=$G(^FBAAI(FBI,2))
"RTN","FBPAY67",24,0)
 S FBY3=$G(^FBAAI(FBI,3))
"RTN","FBPAY67",25,0)
 S FBY5=$G(^FBAAI(FBI,5))
"RTN","FBPAY67",26,0)
 ; if user wants just mill bill or just non-mill bill then check payment
"RTN","FBPAY67",27,0)
 ;   and skip if associated with an mill bill claim
"RTN","FBPAY67",28,0)
 I "^M^N^"[(U_$G(FB1725R)_U) S FB1725=$S($P(FBIN,U,5)["FB583":+$P($G(^FB583(+$P(FBIN,U,5),0)),U,28),1:0) I $S(FB1725R="M"&'FB1725:1,FB1725R="N"&FB1725:1,1:0) Q
"RTN","FBPAY67",29,0)
 F J=1,2,3,6,7,8,9,10,11,13,14 S FBIN(J)=$P(FBIN,"^",J)
"RTN","FBPAY67",30,0)
 S:FBSORT FBIN(5)=$P(FBIN,U,5) I 'FBSORT S FBIN(4)=$P(FBIN,U,4),DFN=FBIN(4) Q:DFN']""  S FBPID=$$SSN^FBAAUTL(DFN),FBPNAME=$P($G(^DPT(+DFN,0)),U)
"RTN","FBPAY67",31,0)
 I FBSORT S FBVNAME=$G(^FBAAV(FBIN(3),0)) Q:FBVNAME']""  S FBVID=$P(FBVNAME,U,2),FBVNAME=$E($P(FBVNAME,U),1,23)
"RTN","FBPAY67",32,0)
 S FBIN(2)=$$DATX^FBAAUTL(FBIN(2)),FBVEN=FBVNAME_";"_FBVID,FBPAT=FBPNAME_";"_DFN
"RTN","FBPAY67",33,0)
 S FBIN(6)=$$DATX^FBAAUTL(FBIN(6)),FBIN(7)=$$DATX^FBAAUTL(FBIN(7))
"RTN","FBPAY67",34,0)
 D FBCKI^FBAACCB1(FBI)
"RTN","FBPAY67",35,0)
SETTMP S ^TMP($J,"FB",+$P(FBIN,U,12),FBVEN,FBPAT,FBM,FBI)=FBIN(2)_U_$J(FBIN(8),8,2)_U_$J(FBIN(9),8,2)_U_FBIN(11)_U_$J(FBIN(1),8)_U_FBIN(6)_U_FBIN(7)_U_FBIN(13)_U_FBIN(14)_U_FBIN(10)
"RTN","FBPAY67",36,0)
 S ^TMP($J,"FB",+$P(FBIN,U,12),FBVEN,FBPAT,FBM,FBI,"FBCK")="^"_FBCK_"^"_FBCKDT_"^"_FBCANDT_"^"_FBCANR_"^"_FBCAN_"^"_FBDIS_"^"_FBCKINT
"RTN","FBPAY67",37,0)
 S FBCDAYS=$P(FBY2,U,10) ; covered days
"RTN","FBPAY67",38,0)
 S FBCSID=$P(FBY2,U,11) ; patient control number
"RTN","FBPAY67",39,0)
 S FBFPPSC=$P(FBY3,U) ; fpps claim id
"RTN","FBPAY67",40,0)
 S FBFPPSL=$P(FBY3,U,2) ; fpps line item
"RTN","FBPAY67",41,0)
 S FBX=$$ADJLRA^FBCHFA(FBI_",")
"RTN","FBPAY67",42,0)
 S FBADJLR=$P(FBX,U) ;adjustment reason
"RTN","FBPAY67",43,0)
 S FBADJLA=$P(FBX,U,2) ;adjustment amount
"RTN","FBPAY67",44,0)
 S FBRRMKL=$$RRL^FBCHFR(FBI_",") ;remittance remarks
"RTN","FBPAY67",45,0)
 ; FB*3.5*139-ICD10 REMEDIATION-JLG
"RTN","FBPAY67",46,0)
 N FBISYS S FBISYS=10 S:$P($G(FBIN),U,6)<$$IMPDATE^FBCSV1("10D") FBISYS=9
"RTN","FBPAY67",47,0)
 S:FBISYS=9 FBADMTDX=$$ICD9^FBCSV1($P(FBY5,"^",9)) ; admitting diagnosis (icd-9)
"RTN","FBPAY67",48,0)
 S:FBISYS=10 FBADMTDX=$$CODEC^ICDCODE($P(FBY5,"^",9),80) ; admitting diagnosis (icd-10)
"RTN","FBPAY67",49,0)
 I $P(FBADMTDX,"^")=-1 S FBADMTDX=""
"RTN","FBPAY67",50,0)
 ; End 139
"RTN","FBPAY67",51,0)
 S ^TMP($J,"FB",+$P(FBIN,U,12),FBVEN,FBPAT,FBM,FBI,"FBINV")=FBCDAYS_"^"_FBCSID_"^"_FBFPPSC_"^"_FBFPPSL_"^"_FBADJLR_"^"_FBADJLA_"^"_FBRRMKL_"^"_FBADMTDX
"RTN","FBPAY67",52,0)
 S FBDX=$G(^FBAAI(FBI,"DX"))
"RTN","FBPAY67",53,0)
 S FBPOA=$G(^FBAAI(FBI,"POA"))
"RTN","FBPAY67",54,0)
 ;determine which ICD version to use (9 or 10) based on date of service
"RTN","FBPAY67",55,0)
 I FBDX]"" S FBDX1="" F I=1:1:25 D
"RTN","FBPAY67",56,0)
 .N FBPOA1
"RTN","FBPAY67",57,0)
 .Q:$P(FBDX,U,I)=""
"RTN","FBPAY67",58,0)
 .S FBPOA1=$P(FBPOA,U,I)
"RTN","FBPAY67",59,0)
 .; FB*3.5*139-ICD10 REMEDIATION-JLG
"RTN","FBPAY67",60,0)
 .S:FBISYS=10 FBDX1=FBDX1_$$CODEC^ICDCODE($P(FBDX,U,I),80)_"/"
"RTN","FBPAY67",61,0)
 .S:FBISYS=9 FBDX1=FBDX1_$$ICD9^FBCSV1($P(FBDX,U,I),+$P($G(FBIN),U,6))_"/"
"RTN","FBPAY67",62,0)
 .; End 139
"RTN","FBPAY67",63,0)
 .S FBDX1=FBDX1_$S(FBPOA1:$P($G(^FB(161.94,FBPOA1,0)),"^"),1:"")_U
"RTN","FBPAY67",64,0)
 .Q
"RTN","FBPAY67",65,0)
 I FBDX]"" S FBDX1=$P(FBDX1,U,1,($L(FBDX1,U)-1)),^TMP($J,"FB",$P(FBIN,U,12),FBVEN,FBPAT,FBM,FBI,"DX")=FBDX1
"RTN","FBPAY67",66,0)
 S FBPROC=$G(^FBAAI(FBI,"PROC")) I FBPROC]"" S FBPROC1="" F I=1:1:25 S:$P(FBPROC,U,I) FBPROC1=FBPROC1_$$ICD0^FBCSV1($P(FBPROC,U,I),+$P($G(FBIN),U,6))_U
"RTN","FBPAY67",67,0)
 I FBPROC]"" S FBPROC1=$P(FBPROC1,U,1,($L(FBPROC1,U)-1)),^TMP($J,"FB",$P(FBIN,U,12),FBVEN,FBPAT,FBM,FBI,"PROC")=FBPROC1
"RTN","FBPAY67",68,0)
 D ANC(FBM,FBI):FBSORT&($D(^TMP($J,"FB",FBPI,FBVEN,FBPAT,FBM,FBI)))
"RTN","FBPAY67",69,0)
 Q
"RTN","FBPAY67",70,0)
AN ;get data from an xref - called at tag fbaac in pay3 & pay67
"RTN","FBPAY67",71,0)
 I FBSORT G AN1
"RTN","FBPAY67",72,0)
 S FBVEN=FBVNAME_";"_FBVID,DFN=0 F  S DFN=$O(^FBAAC("AN",FBPI,DFN)) Q:'DFN  S FBPAT=$G(^DPT(DFN,0)),FBPNAME=$P(FBPAT,U),FBPID=$$SSN^FBAAUTL(DFN),FBPAT=FBPNAME_";"_DFN D OTH
"RTN","FBPAY67",73,0)
 Q
"RTN","FBPAY67",74,0)
AN1 S FBPAT=FBPNAME_";"_FBPID,FBVI=0 F  S FBVI=$O(^FBAAC("AN",FBPI,DFN,FBVI)) Q:'FBVI  S FBVNAME=$E($$VNAME^FBNHEXP(FBVI),1,23),FBVID=$$VID^FBNHEXP(FBVI),FBVEN=FBVNAME_";"_FBVID D OTH
"RTN","FBPAY67",75,0)
 Q
"RTN","FBPAY67",76,0)
OTH ;other fee programs - if 'fbsort (by vendor)
"RTN","FBPAY67",77,0)
 Q:'$O(^FBAAC("AN",FBPI,DFN,FBVI,0))
"RTN","FBPAY67",78,0)
 N J,K,L,M,Y,FBDT1 S J=DFN,K=FBVI
"RTN","FBPAY67",79,0)
 S L=0 F  S L=$O(^FBAAC("AN",FBPI,J,K,L)) Q:'L  S FBDT1=$P($G(^FBAAC(J,1,K,1,L,0)),U) I FBDT1]""&(FBDT1'<FBBDATE&(FBDT1'>FBEDATE)) D  S:FBOUT FBOUT=0
"RTN","FBPAY67",80,0)
 .S M=0 F  S M=$O(^FBAAC("AN",FBPI,J,K,L,M)) Q:'M  S Y=$G(^FBAAC(J,1,K,1,L,1,M,0)) I Y]"" D
"RTN","FBPAY67",81,0)
 ..S FBOUT=0 D EN1^FBPAY2 Q:FBOUT  D EN^FBPAY21
"RTN","FBPAY67",82,0)
 ..S ^TMP($J,"FB",FBPI_"O",FBVEN,FBPAT,(9999999.9999-FBDT1),L,M)=$G(FBR)_$$DATX^FBAAUTL(FBDT1)_U_FBAACPTC_FBCP_$S($G(FBMODLE)]"":"-"_FBMODLE,1:"")_U_A1_U_A2_U_T_U_FBBN_U_FBIN_U_D2_U_FBSC_U_FBPDX_U_FBOB_U_$G(FBVP)
"RTN","FBPAY67",83,0)
 ..S ^TMP($J,"FB",FBPI_"O",FBVEN,FBPAT,(9999999.9999-FBDT1),L,M,"FBCK")="^"_FBCK_"^"_FBCKDT_"^"_FBCANDT_"^"_FBCANR_"^"_FBCAN_"^"_FBDIS_"^"_FBCKINT
"RTN","FBPAY67",84,0)
 ..S ^TMP($J,"FB",FBPI_"O",FBVEN,FBPAT,(9999999.9999-FBDT1),L,M,"FBADJ")=TAMT_U_FBUNITS_U_FBADJLR_U_FBADJLA_U_FBRRMKL_U_FBCSID_U_FBFPPSC_U_FBFPPSL_U_FBAARCE
"RTN","FBPAY67",85,0)
 Q
"RTN","FBPAY67",86,0)
ANC(FBM,FBI) ;ancillary payments - if fbsort (by patient)
"RTN","FBPAY67",87,0)
 N J,K,L,M,Y,FBDT1,FBVID
"RTN","FBPAY67",88,0)
 N FBCSID,FBADJLA,FBADJLR,FBRRMKL,FBUNITS,TAMT,T,FBADJ,FBFPPSC,FBFPPSL,FBAARCE
"RTN","FBPAY67",89,0)
 S J=FBIEN,FBCNT=0 I J,+FBIN(5),$D(^FBAAC("AM",FBIN(5),J)) D
"RTN","FBPAY67",90,0)
 .F K=0:0 S K=$O(^FBAAC("AM",FBIN(5),J,K)) Q:'K  S L=0 F  S L=$O(^FBAAC("AM",FBIN(5),J,K,L)) Q:'L  D
"RTN","FBPAY67",91,0)
 ..N FBOUT
"RTN","FBPAY67",92,0)
 ..S FBDT1=$P($G(^FBAAC(J,1,K,1,L,0)),U) I FBDT1]"" S FBDT2=(9999999.9999-FBDT1),FBDT1=$$DATX^FBAAUTL(FBDT1)
"RTN","FBPAY67",93,0)
 ..S M=0 F  S M=$O(^FBAAC("AM",FBIN(5),J,K,L,M)) Q:'M  S Y=$G(^FBAAC(J,1,K,1,L,1,M,0)) I Y]"" D
"RTN","FBPAY67",94,0)
 ...D EN1^FBPAY2 Q:'$D(FBAACPTC)!($G(FBOUT))  S FBCNT=FBCNT+1 D EN^FBPAY21
"RTN","FBPAY67",95,0)
 ...S ^TMP($J,"FB",FBPI,FBVEN,FBPAT,"A",K,L,M)=$G(FBR)_FBDT1_U_FBAACPTC_FBCP_$S($G(FBMODLE)]"":"-"_FBMODLE,1:"")_U_A1_U_A2_U_T_U_FBBN_U_FBIN_U_D2_U_FBSC_U_FBPDX_U_FBOB_U_FBVNAME_U_FBVID
"RTN","FBPAY67",96,0)
 ...S ^TMP($J,"FB",FBPI,FBVEN,FBPAT,"A",K,L,M,"FBCK")="^"_FBCK_"^"_FBCKDT_"^"_FBCANDT_"^"_FBCANR_"^"_FBCAN_"^"_FBDIS_"^"_FBCKINT
"RTN","FBPAY67",97,0)
 ...S ^TMP($J,"FB",FBPI,FBVEN,FBPAT,"A",K,L,M,"FBADJ")=TAMT_U_FBUNITS_U_FBADJLR_U_FBADJLA_U_FBRRMKL_U_FBCSID_U_FBFPPSC_U_FBFPPSL_U_FBAARCE
"RTN","FBPAY67",98,0)
 ...I $D(^TMP($J,"FB",FBPI_"O",FBVNAME_";"_FBVID,$P(FBPAT,";")_";"_$$SSN^FBAAUTL($P(FBPAT,";",2)),FBDT2)) K ^TMP($J,"FB",FBPI_"O",FBVNAME_";"_FBVID,$P(FBPAT,";")_";"_$$SSN^FBAAUTL($P(FBPAT,";",2)),FBDT2)
"RTN","FBPAY67",99,0)
 Q
"RTN","FBPRICE1")
0^23^B22045052^B12291028
"RTN","FBPRICE1",1,0)
FBPRICE1 ;AISC/DMK,WOIFO/SAB - GENERIC PRICER INTERFACE CON'T ;9/14/2009
"RTN","FBPRICE1",2,0)
 ;;3.5;FEE BASIS;**56,55,77,108,139**;JAN 30, 1995;Build 127
"RTN","FBPRICE1",3,0)
 ;;Per VA Directive 6402, this routine should not be modified.
"RTN","FBPRICE1",4,0)
 ;
"RTN","FBPRICE1",5,0)
 N FBCDCNT,FBCNT,FBI,FBLNCNT,FBRT,FBTL,FBVAL,XICDVDT,FBISYS
"RTN","FBPRICE1",6,0)
 S XICDVDT=FBCSVDT ; date for file 80 and 80.1 identifier logic
"RTN","FBPRICE1",7,0)
 S FBCNT=0 ; count of codes
"RTN","FBPRICE1",8,0)
 N EDATE,DP,DA S EDATE=XICDVDT,DP=0,DA=0 ; FB*3.5*139 JLG ICD-10 remediation
"RTN","FBPRICE1",9,0)
 S FBISYS=10 S:XICDVDT<$$IMPDATE^FBCSV1("10D") FBISYS=9 ; FB*3.5*139 JLG ICD-10 remediation
"RTN","FBPRICE1",10,0)
 ;
"RTN","FBPRICE1",11,0)
ICD ;ask Dx
"RTN","FBPRICE1",12,0)
 W !
"RTN","FBPRICE1",13,0)
 S FBQUIT=0
"RTN","FBPRICE1",14,0)
 F I=1:1:25 D  Q:((FBISYS=9)&(X=""))!(FBQUIT)!($D(DTOUT))!($D(DUOUT))
"RTN","FBPRICE1",15,0)
 . I FBISYS=9 D  Q:X=""!($D(DTOUT))!($D(DUOUT))
"RTN","FBPRICE1",16,0)
 . . S DIR(0)="PO^80:EIQMZ" ;3/28/13 S DIR(0)="PO^80:EQMZ"
"RTN","FBPRICE1",17,0)
 . . ;JAS - 04/09/13 - Patch 139 - Added next line for screening
"RTN","FBPRICE1",18,0)
 . . S DIR("S")="I $$CHKVERS^FBICD9(+Y,FBCSVDT)"
"RTN","FBPRICE1",19,0)
 . . F  D ^DIR Q:X=""!($D(DTOUT))!($D(DUOUT))  S FBVAL=+Y,FBRT=$$CHKICD9^FBCSV1(FBVAL,FBCSVDT) I FBRT]"" S FBDX(I)=FBVAL,FBCNT=FBCNT+1 Q
"RTN","FBPRICE1",20,0)
 . . K DIR
"RTN","FBPRICE1",21,0)
 . . Q:'$G(FBDX(I))
"RTN","FBPRICE1",22,0)
 . . D POA Q:$D(DTOUT)!$D(DUOUT)
"RTN","FBPRICE1",23,0)
 . I FBISYS=10 D
"RTN","FBPRICE1",24,0)
 . . S FBY=$$ICD10 S X=1
"RTN","FBPRICE1",25,0)
 . . I FBY=-3 S DTOUT=-1 Q  ; -3 means ^ entered by user
"RTN","FBPRICE1",26,0)
 . . I FBY>0 S FBDX(I)=FBY,FBCNT=FBCNT+1 D POA S X=1 Q
"RTN","FBPRICE1",27,0)
 . . S FBQUIT=-1 Q
"RTN","FBPRICE1",28,0)
 I $D(DTOUT)!($D(DUOUT)) G END^FBPRICE
"RTN","FBPRICE1",29,0)
 I (FBISYS=9)&('$G(FBDX(1))) W !,*7,"Must enter at least a primary diagnosis.",! G ICD
"RTN","FBPRICE1",30,0)
 K DIR,I
"RTN","FBPRICE1",31,0)
 ; 
"RTN","FBPRICE1",32,0)
ADMITDX ;ask admitting diagnosis for ICD-9
"RTN","FBPRICE1",33,0)
 I FBISYS=10 G ADMITDX0
"RTN","FBPRICE1",34,0)
 I FBISYS=9 D
"RTN","FBPRICE1",35,0)
 . ;JAS - 04/10/13 - Patch 139 - Altered DIR read for ICD versioning
"RTN","FBPRICE1",36,0)
 . W ! S DIR(0)="PO^80:EIQMZ",DIR("A")="Admitting Diagnosis"
"RTN","FBPRICE1",37,0)
 . S DIR("S")="I $$CHKVERS^FBICD9(+Y,FBCSVDT)"
"RTN","FBPRICE1",38,0)
 . ;END 139
"RTN","FBPRICE1",39,0)
 . D ^DIR K DIR
"RTN","FBPRICE1",40,0)
 . Q:$D(DIRUT)
"RTN","FBPRICE1",41,0)
 . S FBVAL=+Y
"RTN","FBPRICE1",42,0)
 . S FBRT=$$CHKICD9^FBCSV1(FBVAL,FBCSVDT)
"RTN","FBPRICE1",43,0)
 ;JAS - 09/18/13 - PATCH 139 - Modified code to force entry of required Admitting dx field.
"RTN","FBPRICE1",44,0)
 I $D(DIRUT) W !,"This is a required response." G ADMITDX
"RTN","FBPRICE1",45,0)
 I FBRT="" G ADMITDX
"RTN","FBPRICE1",46,0)
 S FBADMTDX=FBVAL
"RTN","FBPRICE1",47,0)
 S FBCNT=FBCNT+1
"RTN","FBPRICE1",48,0)
 ;
"RTN","FBPRICE1",49,0)
ADMITDX0 ; ask admitting diagnosis for ICD-10  ; FB*3.5*139 JLG ICD-10 remediation
"RTN","FBPRICE1",50,0)
 I FBISYS=10 D
"RTN","FBPRICE1",51,0)
 . W ! S FBRT=$$ASKICD10^FBASF("Admitting Diagnosis","","Y")
"RTN","FBPRICE1",52,0)
 . I FBRT'>0 W !,"This is a required response."
"RTN","FBPRICE1",53,0)
 G END^FBPRICE:$D(DIRUT)
"RTN","FBPRICE1",54,0)
 I (FBISYS=10)&(FBRT'>0) G ADMITDX0
"RTN","FBPRICE1",55,0)
 I (FBISYS=10) S FBADMTDX=FBRT S FBCNT=FBCNT+1
"RTN","FBPRICE1",56,0)
 ;
"RTN","FBPRICE1",57,0)
PROC ;ask procedure codes
"RTN","FBPRICE1",58,0)
 W !
"RTN","FBPRICE1",59,0)
 ;JAS - 04/10/13 - Patch 139 - Changed from DIR read to new utility to allow for proper code-set versioning and additional inactive code checks
"RTN","FBPRICE1",60,0)
 F I=1:1:25 D  Q:X=""!($D(DUOUT))!($D(DTOUT))
"RTN","FBPRICE1",61,0)
 . F  S Y=$$ENICD9^FBICDP(FBCSVDT,"Select ICD OPERATION/PROCEDURE") Q:X=""!($D(DUOUT))!($D(DTOUT))!(+Y'>0)  S FBVAL=+Y,FBPRC(I)=FBVAL,FBCNT=FBCNT+1 Q
"RTN","FBPRICE1",62,0)
 ;END 139
"RTN","FBPRICE1",63,0)
 I $D(DTOUT)!($D(DUOUT)) G END^FBPRICE
"RTN","FBPRICE1",64,0)
 K DIR,I
"RTN","FBPRICE1",65,0)
 ;
"RTN","FBPRICE1",66,0)
 W ! S DIR(0)="162.5,6.6",DIR("A")="Billed Charges"
"RTN","FBPRICE1",67,0)
 D ^DIR K DIR G END^FBPRICE:$D(DIRUT)
"RTN","FBPRICE1",68,0)
 S FBBILL=$FN(Y,"",2),FBBILL=$TR(FBBILL,".")
"RTN","FBPRICE1",69,0)
 S FBBILL=$E("000000000",$L(FBBILL)+1,9)_FBBILL
"RTN","FBPRICE1",70,0)
 ;
"RTN","FBPRICE1",71,0)
 S DIR(0)="162.5,6.6",DIR("A")="Amount Claimed"
"RTN","FBPRICE1",72,0)
 D ^DIR K DIR G END^FBPRICE:$D(DIRUT)
"RTN","FBPRICE1",73,0)
 S FBCLAIM=$FN(Y,"",2),FBCLAIM=$TR(FBCLAIM,".")
"RTN","FBPRICE1",74,0)
 S FBCLAIM=$E("000000000",$L(FBCLAIM)+1,9)_FBCLAIM
"RTN","FBPRICE1",75,0)
 ;
"RTN","FBPRICE1",76,0)
 S FBOBL="000000"
"RTN","FBPRICE1",77,0)
 ;
"RTN","FBPRICE1",78,0)
STRING ;set-up message text for pricer
"RTN","FBPRICE1",79,0)
 W ! D WAIT^DICD
"RTN","FBPRICE1",80,0)
 D ADDRESS^FBAAV01 Q:$G(VATERR)  K VAT
"RTN","FBPRICE1",81,0)
 S FBTL=(FBCNT-1)\13+2 ; total number of lines needed
"RTN","FBPRICE1",82,0)
 S FBFLAG=1 D NEWMSG^FBAAV01
"RTN","FBPRICE1",83,0)
 S FBRESUB=2 ; 2 identifies the message as generic pricer
"RTN","FBPRICE1",84,0)
 S FBLNCNT=0 ; init invoice line counter
"RTN","FBPRICE1",85,0)
 D NEWLN^FBAAV6
"RTN","FBPRICE1",86,0)
 S FBSTR=FBSTR_FBTL_FBLNAM_FBFI_FBMI_FBSEX_FBDOB_FBLOS
"RTN","FBPRICE1",87,0)
 S FBSTR=FBSTR_FBDISP_FBBILL_FBCLAIM_FBAUTH_FBPAYT_FBOBL_"Y"
"RTN","FBPRICE1",88,0)
 S FBSTR=FBSTR_FBVID_FBMED_$E(PAD,1,29)_FBTDT_FBSTABR_"  "
"RTN","FBPRICE1",89,0)
 D STORE^FBAAV01
"RTN","FBPRICE1",90,0)
 ;
"RTN","FBPRICE1",91,0)
 D NEWLN^FBAAV6
"RTN","FBPRICE1",92,0)
 S FBCDCNT=1 ; count of codes in the line (=1 for admit dx)
"RTN","FBPRICE1",93,0)
 S FBSTR=FBSTR_$$DX^FBAAV6(FBADMTDX,FBCSVDT,"")
"RTN","FBPRICE1",94,0)
 ; loop thru Dx
"RTN","FBPRICE1",95,0)
 F FBI=1:1:25 Q:'$G(FBDX(FBI))  D
"RTN","FBPRICE1",96,0)
 . S FBCDCNT=FBCDCNT+1
"RTN","FBPRICE1",97,0)
 . I FBCDCNT=14 D
"RTN","FBPRICE1",98,0)
 . . D STORE^FBAAV01
"RTN","FBPRICE1",99,0)
 . . D NEWLN^FBAAV6
"RTN","FBPRICE1",100,0)
 . . S FBCDCNT=1
"RTN","FBPRICE1",101,0)
 . S FBSTR=FBSTR_$$DX^FBAAV6(FBDX(FBI),FBCSVDT,FBPOA(FBI))
"RTN","FBPRICE1",102,0)
 ; loop thru proc
"RTN","FBPRICE1",103,0)
 F FBI=1:1:25 Q:'$G(FBPRC(FBI))  D
"RTN","FBPRICE1",104,0)
 . S FBCDCNT=FBCDCNT+1
"RTN","FBPRICE1",105,0)
 . I FBCDCNT=14 D
"RTN","FBPRICE1",106,0)
 . . D STORE^FBAAV01
"RTN","FBPRICE1",107,0)
 . . D NEWLN^FBAAV6
"RTN","FBPRICE1",108,0)
 . . S FBCDCNT=1
"RTN","FBPRICE1",109,0)
 . S FBSTR=FBSTR_$$PROC^FBAAV6(FBPRC(FBI),FBCSVDT)
"RTN","FBPRICE1",110,0)
 ; pad remainder of last line with spaces and save it
"RTN","FBPRICE1",111,0)
 S FBSTR=$$LJ^XLFSTR(FBSTR,131," ")
"RTN","FBPRICE1",112,0)
 D STORE^FBAAV01
"RTN","FBPRICE1",113,0)
 ;
"RTN","FBPRICE1",114,0)
 D XMIT^FBAAV01 K FBFLAG
"RTN","FBPRICE1",115,0)
 W !,"Case sent to pricer.",!
"RTN","FBPRICE1",116,0)
 Q
"RTN","FBPRICE1",117,0)
 ; 
"RTN","FBPRICE1",118,0)
POA ; ask POA
"RTN","FBPRICE1",119,0)
 N DIR,Y
"RTN","FBPRICE1",120,0)
 S DIR(0)="P^161.94:EQM" D ^DIR K DIR Q:$D(DTOUT)!$D(DUOUT)
"RTN","FBPRICE1",121,0)
 S FBPOA(I)=+Y
"RTN","FBPRICE1",122,0)
 Q
"RTN","FBPRICE1",123,0)
ICD10() ;FB*3.5*139 JLG ICD-10 remediation
"RTN","FBPRICE1",124,0)
 N FBY,FBQUIT
"RTN","FBPRICE1",125,0)
ASK10 ;FB*3.5*139 JLG ICD-10 remediation 
"RTN","FBPRICE1",126,0)
 S FBY=$$ASKICD10^FBASF("Select ICD DIAGNOSIS","","Y")
"RTN","FBPRICE1",127,0)
 Q:(FBY>0)!(FBY=-3) FBY
"RTN","FBPRICE1",128,0)
 I (I>1)&(FBY'>0) S FBQUIT=-1 Q ""
"RTN","FBPRICE1",129,0)
 I '$G(FBDX(1)) W !,*7,"Must enter at least a primary diagnosis.",! G ASK10
"RTN","FBPRICE1",130,0)
 G ASK10
"UP",161,161.01,-1)
161^1
"UP",161,161.01,0)
161.01
"VER")
8.0^22.0
"^DD",161,161.01,.08,0)
DX LINE 1^F^^0;8^K:$L(X)>60!($L(X)<3) X
"^DD",161,161.01,.08,.1)
DIAGNOSIS
"^DD",161,161.01,.08,3)
Answer must be 3-60 characters in length.
"^DD",161,161.01,.08,21,0)
^^3^3^3120326^
"^DD",161,161.01,.08,21,1,0)
Patient's diagnosis for which this authorization is being issued. 
"^DD",161,161.01,.08,21,2,0)
This field is strictly for ICD-9. It may contain free text comments as 
"^DD",161,161.01,.08,21,3,0)
well as ICD-9 codes. 
"^DD",161,161.01,.08,"DT")
3120326
"^DD",161,161.01,.085,0)
DX LINE 2^F^^3;1^K:$L(X)>60!($L(X)<2) X
"^DD",161,161.01,.085,3)
Answer must be 2-60 characters in length.
"^DD",161,161.01,.085,21,0)
^^4^4^3120326^
"^DD",161,161.01,.085,21,1,0)
An additional 60 characters to continue the description of patient's 
"^DD",161,161.01,.085,21,2,0)
diagnosis for which this authorization is being issued. This field is 
"^DD",161,161.01,.085,21,3,0)
strictly for ICD-9. It may contain free text comments as 
"^DD",161,161.01,.085,21,4,0)
well as ICD-9 codes.
"^DD",161,161.01,.085,"DT")
3120326
"^DD",161,161.01,.086,0)
DX LINE 3^F^^3;2^K:$L(X)>60!($L(X)<2) X
"^DD",161,161.01,.086,3)
Answer must be 2-60 characters in length.
"^DD",161,161.01,.086,21,0)
^^4^4^3120323^
"^DD",161,161.01,.086,21,1,0)
An additional 60 characters to continue describing patient's diagnosis.
"^DD",161,161.01,.086,21,2,0)
This is the diagnosis applicable to this authorization. This field is 
"^DD",161,161.01,.086,21,3,0)
strictly for ICD-9. It may contain free text comments as 
"^DD",161,161.01,.086,21,4,0)
well as ICD-9 codes.
"^DD",161,161.01,.086,"DT")
3120326
"^DD",161,161.01,.087,0)
ICD DIAGNOSIS^RP80'^ICD9(^C;2^Q
"^DD",161,161.01,.087,3)
Select the Diagnosis.
"^DD",161,161.01,.087,21,0)
^^2^2^3120323^
"^DD",161,161.01,.087,21,1,0)
Patient's diagnosis for which this authorization is being issued. This 
"^DD",161,161.01,.087,21,2,0)
field is only for ICD-10 and later.
"^DD",161,161.01,.087,"DT")
3120326
"^DD",162.7,162.7,5.1,0)
ICD DIAGNOSIS^P80'^ICD9(^DX;2^Q
"^DD",162.7,162.7,5.1,3)
Select the Diagnosis.
"^DD",162.7,162.7,5.1,21,0)
^^2^2^3120326^
"^DD",162.7,162.7,5.1,21,1,0)
Patient's diagnosis for which this authorization is being issued. This 
"^DD",162.7,162.7,5.1,21,2,0)
field is only for ICD-10 and later.
"^DD",162.7,162.7,5.1,"DT")
3120326
"BLD",8849,6)
^127
**END**
**END**

