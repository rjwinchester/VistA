Released PRCA*4.5*317 SEQ #278
Extracted from mail message
**KIDS**:PRCA*4.5*317^

**INSTALL NAME**
PRCA*4.5*317
"BLD",9532,0)
PRCA*4.5*317^ACCOUNTS RECEIVABLE^0^3170201^y
"BLD",9532,4,0)
^9.64PA^^
"BLD",9532,6.3)
8
"BLD",9532,"KRN",0)
^9.67PA^779.2^20
"BLD",9532,"KRN",.4,0)
.4
"BLD",9532,"KRN",.401,0)
.401
"BLD",9532,"KRN",.402,0)
.402
"BLD",9532,"KRN",.403,0)
.403
"BLD",9532,"KRN",.5,0)
.5
"BLD",9532,"KRN",.84,0)
.84
"BLD",9532,"KRN",3.6,0)
3.6
"BLD",9532,"KRN",3.8,0)
3.8
"BLD",9532,"KRN",9.2,0)
9.2
"BLD",9532,"KRN",9.8,0)
9.8
"BLD",9532,"KRN",9.8,"NM",0)
^9.68A^7^7
"BLD",9532,"KRN",9.8,"NM",1,0)
RCDPE8NZ^^0^B111235321
"BLD",9532,"KRN",9.8,"NM",2,0)
RCDPEWL^^0^B75411625
"BLD",9532,"KRN",9.8,"NM",3,0)
RCDPEWLA^^0^B99700399
"BLD",9532,"KRN",9.8,"NM",4,0)
RCDPEWL0^^0^B221141588
"BLD",9532,"KRN",9.8,"NM",5,0)
RCDPEAA1^^0^B126873645
"BLD",9532,"KRN",9.8,"NM",6,0)
RCDPEWLD^^0^B86108343
"BLD",9532,"KRN",9.8,"NM",7,0)
RCDPESP2^^0^B172938322
"BLD",9532,"KRN",9.8,"NM","B","RCDPE8NZ",1)
 
"BLD",9532,"KRN",9.8,"NM","B","RCDPEAA1",5)
 
"BLD",9532,"KRN",9.8,"NM","B","RCDPESP2",7)
 
"BLD",9532,"KRN",9.8,"NM","B","RCDPEWL",2)
 
"BLD",9532,"KRN",9.8,"NM","B","RCDPEWL0",4)
 
"BLD",9532,"KRN",9.8,"NM","B","RCDPEWLA",3)
 
"BLD",9532,"KRN",9.8,"NM","B","RCDPEWLD",6)
 
"BLD",9532,"KRN",19,0)
19
"BLD",9532,"KRN",19,"NM",0)
^9.68A^2^2
"BLD",9532,"KRN",19,"NM",1,0)
RCDPE UNAPPLIED EFT DEP REPORT^^0^
"BLD",9532,"KRN",19,"NM",2,0)
RCDPE EDI LOCKBOX REPORTS MENU^^2
"BLD",9532,"KRN",19,"NM","B","RCDPE EDI LOCKBOX REPORTS MENU",2)
 
"BLD",9532,"KRN",19,"NM","B","RCDPE UNAPPLIED EFT DEP REPORT",1)
 
"BLD",9532,"KRN",19.1,0)
19.1
"BLD",9532,"KRN",101,0)
101
"BLD",9532,"KRN",409.61,0)
409.61
"BLD",9532,"KRN",771,0)
771
"BLD",9532,"KRN",779.2,0)
779.2
"BLD",9532,"KRN",870,0)
870
"BLD",9532,"KRN",8989.51,0)
8989.51
"BLD",9532,"KRN",8989.52,0)
8989.52
"BLD",9532,"KRN",8994,0)
8994
"BLD",9532,"KRN","B",.4,.4)
 
"BLD",9532,"KRN","B",.401,.401)
 
"BLD",9532,"KRN","B",.402,.402)
 
"BLD",9532,"KRN","B",.403,.403)
 
"BLD",9532,"KRN","B",.5,.5)
 
"BLD",9532,"KRN","B",.84,.84)
 
"BLD",9532,"KRN","B",3.6,3.6)
 
"BLD",9532,"KRN","B",3.8,3.8)
 
"BLD",9532,"KRN","B",9.2,9.2)
 
"BLD",9532,"KRN","B",9.8,9.8)
 
"BLD",9532,"KRN","B",19,19)
 
"BLD",9532,"KRN","B",19.1,19.1)
 
"BLD",9532,"KRN","B",101,101)
 
"BLD",9532,"KRN","B",409.61,409.61)
 
"BLD",9532,"KRN","B",771,771)
 
"BLD",9532,"KRN","B",779.2,779.2)
 
"BLD",9532,"KRN","B",870,870)
 
"BLD",9532,"KRN","B",8989.51,8989.51)
 
"BLD",9532,"KRN","B",8989.52,8989.52)
 
"BLD",9532,"KRN","B",8994,8994)
 
"BLD",9532,"QDEF")
^^^^NO^^^^NO^^NO
"BLD",9532,"QUES",0)
^9.62^^
"BLD",9532,"REQB",0)
^9.611^1^1
"BLD",9532,"REQB",1,0)
PRCA*4.5*304^1
"BLD",9532,"REQB","B","PRCA*4.5*304",1)
 
"KRN",19,9766,-1)
2^2
"KRN",19,9766,0)
RCDPE EDI LOCKBOX REPORTS MENU^EDI Lockbox (ePayments) Reports Menu^^M^123457044^^^^^^^53
"KRN",19,9766,10,0)
^19.01IP^23^23
"KRN",19,9766,10,23,0)
11699^UN^50
"KRN",19,9766,10,23,"^")
RCDPE UNAPPLIED EFT DEP REPORT
"KRN",19,9766,"U")
EDI LOCKBOX (EPAYMENTS) REPORT
"KRN",19,11699,-1)
0^1
"KRN",19,11699,0)
RCDPE UNAPPLIED EFT DEP REPORT^Unapplied EFT Deposits Report^^R^^^^^^^^ACCOUNTS RECEIVABLE
"KRN",19,11699,1,0)
^^3^3^3161202^
"KRN",19,11699,1,1,0)
This option produces a list of EFT deposits that have EFT detail records
"KRN",19,11699,1,2,0)
whose funds have not been applied to bills in A/R.  These funds remain
"KRN",19,11699,1,3,0)
in FUND 5287, REVENUE SOURCE CODE 8NZZ.
"KRN",19,11699,25)
EN^RCDPE8NZ
"KRN",19,11699,"U")
UNAPPLIED EFT DEPOSITS REPORT
"MBREQ")
0
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"PKG",53,-1)
1^1
"PKG",53,0)
ACCOUNTS RECEIVABLE^PRCA^FMS
"PKG",53,20,0)
^9.402P^1^1
"PKG",53,20,1,0)
2^^PRCAMRG
"PKG",53,20,1,1)
 
"PKG",53,20,"B",2,1)
 
"PKG",53,22,0)
^9.49I^1^1
"PKG",53,22,1,0)
4.5^2950913^2960627
"PKG",53,22,1,"PAH",1,0)
317^3170201
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")
 
"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
7
"RTN","RCDPE8NZ")
0^1^B111235321^B102784792
"RTN","RCDPE8NZ",1,0)
RCDPE8NZ ;ALB/TMK/KML/hrubovcak - Unapplied EFT Deposits report ;Jun 06, 2014@19:11:19
"RTN","RCDPE8NZ",2,0)
 ;;4.5;Accounts Receivable;**173,212,208,269,276,283,293,298,317**;Mar 20, 1995;Build 8
"RTN","RCDPE8NZ",3,0)
 ;Per VA Directive 6402, this routine should not be modified.
"RTN","RCDPE8NZ",4,0)
 ;
"RTN","RCDPE8NZ",5,0)
EN ; entry point for Unapplied EFT Deposits Report [RCDPE UNAPPLIED EFT DEP REPORT]
"RTN","RCDPE8NZ",6,0)
 ; ^RCY(344.3,0) = EDI LOCKBOX DEPOSIT^344.3I^
"RTN","RCDPE8NZ",7,0)
 ;
"RTN","RCDPE8NZ",8,0)
 N %ZIS,DIR,RCDISPTY,RCDTRNG,RCENDT,RCHDR,RCLNCNT,RCLSTMGR,RCPGNUM,RCRPLST,RCSTDT,RCTMPND,X,Y
"RTN","RCDPE8NZ",9,0)
 ; RCDISPTY - display taype for Excel
"RTN","RCDPE8NZ",10,0)
 ; RCDTRNG - range of dates
"RTN","RCDPE8NZ",11,0)
 ; RCHDR - report header
"RTN","RCDPE8NZ",12,0)
 ; RCLNCNT - line counter for ^TMP storage
"RTN","RCDPE8NZ",13,0)
 ; RCLSTMGR - ListMan flag
"RTN","RCDPE8NZ",14,0)
 ; RCPGNUM - page number
"RTN","RCDPE8NZ",15,0)
 ; RCRPLST - node for report list in ^TMP
"RTN","RCDPE8NZ",16,0)
 ; RCTMPND - storage node (or null) for SL^RCPEARL
"RTN","RCDPE8NZ",17,0)
 ;
"RTN","RCDPE8NZ",18,0)
 S RCRPLST=$T(+0)_"_EFT"  ; storage for list of entries
"RTN","RCDPE8NZ",19,0)
 S RCLNCNT=0,RCLSTMGR="",RCTMPND=""  ; initial values for ListMan
"RTN","RCDPE8NZ",20,0)
 S RCDTRNG=$$DTRNG^RCDPEM4() G:'(RCDTRNG>0) RPTQ
"RTN","RCDPE8NZ",21,0)
 S RCSTDT=$P(RCDTRNG,U,2),RCENDT=$P(RCDTRNG,U,3)
"RTN","RCDPE8NZ",22,0)
 ; ask if export to excel
"RTN","RCDPE8NZ",23,0)
 S RCDISPTY=$$DISPTY^RCDPEM3() G:RCDISPTY<0 RPTQ
"RTN","RCDPE8NZ",24,0)
 ; for Excel, set ListMan flag to prevent question
"RTN","RCDPE8NZ",25,0)
 I RCDISPTY S RCLSTMGR="^" D INFO^RCDPEM6
"RTN","RCDPE8NZ",26,0)
 I RCLSTMGR="" S RCLSTMGR=$$ASKLM^RCDPEARL G:RCLSTMGR<0 RPTQ
"RTN","RCDPE8NZ",27,0)
 I RCLSTMGR D  G RPTQ  ; send output to ListMan
"RTN","RCDPE8NZ",28,0)
 .S RCTMPND=$T(+0)_"^UNAPPLIED EFT" K ^TMP($J,RCTMPND)  ; clean any residue
"RTN","RCDPE8NZ",29,0)
 .D MKRPRT
"RTN","RCDPE8NZ",30,0)
 .N H,L,HDR S L=0
"RTN","RCDPE8NZ",31,0)
 .S HDR("TITLE")=$$HDRNM
"RTN","RCDPE8NZ",32,0)
 .F H=1:1:7 I $D(RCHDR(H)) S L=H,HDR(H)=RCHDR(H)  ; take first 3 lines of report header
"RTN","RCDPE8NZ",33,0)
 .I $O(RCHDR(L)) D  ; any remaining header lines at top of report
"RTN","RCDPE8NZ",34,0)
 ..N N S N=0,H=L F  S H=$O(RCHDR(H)) Q:'H  S N=N+.001,^TMP($J,RCTMPND,N)=RCHDR(H)
"RTN","RCDPE8NZ",35,0)
 .; invoke ListMan
"RTN","RCDPE8NZ",36,0)
 .D LMRPT^RCDPEARL(.HDR,$NA(^TMP($J,RCTMPND))) ; generate ListMan display
"RTN","RCDPE8NZ",37,0)
 ;
"RTN","RCDPE8NZ",38,0)
 ; Ask device
"RTN","RCDPE8NZ",39,0)
 S %ZIS="QM" D ^%ZIS Q:POP
"RTN","RCDPE8NZ",40,0)
 I $D(IO("Q")) D  Q
"RTN","RCDPE8NZ",41,0)
 .N ZTRTN,ZTSAVE,ZTDESC,POP,ZTSK
"RTN","RCDPE8NZ",42,0)
 .S ZTRTN="MKRPRT^RCDPE8NZ",ZTDESC="AR - List of unlinked EFT deposit payments"
"RTN","RCDPE8NZ",43,0)
 .S ZTSAVE("RC*")=""
"RTN","RCDPE8NZ",44,0)
 .D ^%ZTLOAD
"RTN","RCDPE8NZ",45,0)
 .W !!,$S($G(ZTSK):"Task number "_ZTSK_" was queued.",1:"Unable to queue this task.")
"RTN","RCDPE8NZ",46,0)
 .K ZTSK,IO("Q") D HOME^%ZIS
"RTN","RCDPE8NZ",47,0)
 ;
"RTN","RCDPE8NZ",48,0)
 U IO
"RTN","RCDPE8NZ",49,0)
 D MKRPRT
"RTN","RCDPE8NZ",50,0)
 Q
"RTN","RCDPE8NZ",51,0)
 ;
"RTN","RCDPE8NZ",52,0)
MKRPRT ; Entry point for queued job
"RTN","RCDPE8NZ",53,0)
 N RCTSKCNT,RCARDEP,RCCR,RCDA,RCDATA,RCDT,RCEFT,RCEFTIEN,RCREC,RCSTAT,RCSTOP,RCSUM,RCTOT,RCTR,RCUNAP,RECEXT,Y,Z,ZTSTOP
"RTN","RCDPE8NZ",54,0)
 ;
"RTN","RCDPE8NZ",55,0)
 ;  get list of unlinked EFT deposit data
"RTN","RCDPE8NZ",56,0)
 K ^TMP(RCRPLST,$J) ; subscripts: dep date,EFT ien,EFT det ien
"RTN","RCDPE8NZ",57,0)
 ;  Data is FMS doc indicator^FMS doc #^FMS Doc Status
"RTN","RCDPE8NZ",58,0)
 ;    FMS doc indicator = -1:no receipt  -2:no FMS doc  1:FMS doc exists
"RTN","RCDPE8NZ",59,0)
 ;
"RTN","RCDPE8NZ",60,0)
 S (RCTSKCNT,RCSTOP,RCSUM,RCUNAP)=0
"RTN","RCDPE8NZ",61,0)
 S RCARDEP="" F  S RCARDEP=$O(^RCY(344.3,"ARDEP",RCARDEP)) Q:RCARDEP=""!RCSTOP  S RCDA=0 F  S RCDA=$O(^RCY(344.3,"ARDEP",RCARDEP,RCDA)) Q:'RCDA  D  Q:RCSTOP
"RTN","RCDPE8NZ",62,0)
 . S RCDATA=$G(^RCY(344.3,RCDA,0)),RCDT=$P(RCDATA,U,7),RCTOT=0
"RTN","RCDPE8NZ",63,0)
 . Q:RCDT<RCSTDT  ; Before start date
"RTN","RCDPE8NZ",64,0)
 . Q:RCDT>(RCENDT+.999999)  ; After the end date
"RTN","RCDPE8NZ",65,0)
 . Q:'$P(RCDATA,"^",8)  ; no payment amt
"RTN","RCDPE8NZ",66,0)
 . S RCEFT=0 F  S RCEFT=$O(^RCY(344.31,"B",RCDA,RCEFT)) Q:'RCEFT!RCSTOP  S RCDATA(0)=$G(^RCY(344.31,RCEFT,0)) D  Q:RCSTOP
"RTN","RCDPE8NZ",67,0)
 . . S RCTSKCNT=RCTSKCNT+1
"RTN","RCDPE8NZ",68,0)
 . . I '(RCTSKCNT#100),$D(ZTQUEUED),$$S^%ZTLOAD S (RCSTOP,ZTSTOP)=1 K ZTREQ Q
"RTN","RCDPE8NZ",69,0)
 . . Q:$P($G(^RCY(344.31,RCEFT,3)),U)        ; EFT has been removed   PRCA*4.5*293
"RTN","RCDPE8NZ",70,0)
 . . S RCREC=$$GETREC(RCEFT,RCDATA(0),.RECEXT)
"RTN","RCDPE8NZ",71,0)
 . . Q:RCREC="PURGED"  ; need to prevent processed EFTs that had receipts purged from being generated on the report
"RTN","RCDPE8NZ",72,0)
 . . ;; PRCA276 - need to add EFT entries without a receipt to the total number of unapplied deposits
"RTN","RCDPE8NZ",73,0)
 . . I 'RCREC S RCUNAP=RCUNAP+1,^TMP(RCRPLST,$J,RCDT,RCDA,RCEFT)=-1,RCTOT=RCTOT+$P(RCDATA(0),U,7) Q  ; No receipt therefore no FMS document
"RTN","RCDPE8NZ",74,0)
 . . S RCSTAT=$$FMSSTAT^RCDPUREC(RCREC)
"RTN","RCDPE8NZ",75,0)
 . . I $E($P(RCSTAT,U),1,2)="TR",$P(RCSTAT,U,2)["ACCEPTED" Q
"RTN","RCDPE8NZ",76,0)
 . . S RCUNAP=RCUNAP+1,RCTOT=RCTOT+$P(RCDATA(0),U,7)  ; total unapplied deposits and total dollar amount of unapplied deposits
"RTN","RCDPE8NZ",77,0)
 . . I $P(RCSTAT,U,2)="NOT ENTERED" S ^TMP(RCRPLST,$J,RCDT,RCDA,RCEFT)="-2^^"_$P(RCSTAT,U) Q  ; No FMS doc
"RTN","RCDPE8NZ",78,0)
 . . S ^TMP(RCRPLST,$J,RCDT,RCDA,RCEFT)="1^"_$P(RCSTAT,U,1,2)_"^"_RECEXT
"RTN","RCDPE8NZ",79,0)
 . S:RCTOT ^TMP(RCRPLST,$J,RCDT,RCDA)=RCTOT,RCSUM=RCSUM+RCTOT
"RTN","RCDPE8NZ",80,0)
 ;
"RTN","RCDPE8NZ",81,0)
 D:'RCLSTMGR HDRBLD
"RTN","RCDPE8NZ",82,0)
 D:RCLSTMGR HDRLM
"RTN","RCDPE8NZ",83,0)
 ;
"RTN","RCDPE8NZ",84,0)
 I RCDISPTY D EXCEL Q
"RTN","RCDPE8NZ",85,0)
 ;
"RTN","RCDPE8NZ",86,0)
 D RPT
"RTN","RCDPE8NZ",87,0)
 Q
"RTN","RCDPE8NZ",88,0)
 ;
"RTN","RCDPE8NZ",89,0)
RPT ;  display/print the report using data populated in temporary global array
"RTN","RCDPE8NZ",90,0)
 ;
"RTN","RCDPE8NZ",91,0)
 D:'RCLSTMGR HDRLST^RCDPEARL(.RCSTOP,.RCHDR)  ; initial report header
"RTN","RCDPE8NZ",92,0)
 ;
"RTN","RCDPE8NZ",93,0)
 S RCDT=0
"RTN","RCDPE8NZ",94,0)
 F  S RCDT=$O(^TMP(RCRPLST,$J,RCDT)) Q:'RCDT  D  Q:RCSTOP
"RTN","RCDPE8NZ",95,0)
 .I 'RCLSTMGR,$Y>(IOSL-RCHDR(0)) D HDRLST^RCDPEARL(.RCSTOP,.RCHDR) Q:RCSTOP
"RTN","RCDPE8NZ",96,0)
 .D SL^RCDPEARL(" ",.RCLNCNT,RCTMPND)  ; skip a line
"RTN","RCDPE8NZ",97,0)
 .S Y="DEPOSIT DATE: "_$$FMTE^XLFDT(RCDT,1),Y=$J("",80-$L(Y)\2)_Y D SL^RCDPEARL(Y,.RCLNCNT,RCTMPND)
"RTN","RCDPE8NZ",98,0)
 .S RCARDEP=0 F  S RCARDEP=$O(^TMP(RCRPLST,$J,RCDT,RCARDEP)) Q:'RCARDEP  D
"RTN","RCDPE8NZ",99,0)
 ..D SL^RCDPEARL(" ",.RCLNCNT,RCTMPND)  ; skip a line
"RTN","RCDPE8NZ",100,0)
 ..S RCTSKCNT=RCTSKCNT+1 I 'RCLSTMGR,(RCTSKCNT#100),$D(ZTQUEUED),$$S^%ZTLOAD D  Q  ; stop task
"RTN","RCDPE8NZ",101,0)
 ...S (RCSTOP,ZTSTOP)=1 D SL^RCDPEARL("TASK STOPPED BY USER!!",.RCLNCNT,RCTMPND) K ZTREQ
"RTN","RCDPE8NZ",102,0)
 ..;
"RTN","RCDPE8NZ",103,0)
 ..S RCDATA(0)=$G(^RCY(344.3,RCARDEP,0))
"RTN","RCDPE8NZ",104,0)
 ..I 'RCLSTMGR,$Y>(IOSL-RCHDR(0)) D HDRLST^RCDPEARL(.RCSTOP,.RCHDR) Q:RCSTOP
"RTN","RCDPE8NZ",105,0)
 ..; PRCA*4.5*283 - Change the spaces for DEP # from 10 to 13 to allow 9 digit DEP #
"RTN","RCDPE8NZ",106,0)
 ..; PRCA*4.5*317 Shift line 2 chars to the right
"RTN","RCDPE8NZ",107,0)
 ..S Y="  "_$E($P(RCDATA(0),U,6)_$S('$$HACEFT^RCDPEU(RCARDEP):"",1:"-HAC")_$J("",13),1,13)  ;deposit #
"RTN","RCDPE8NZ",108,0)
 ..S Y=Y_"  "_$E($$FMTE^XLFDT($P(RCDATA(0),U,7),2)_$J("",16),1,16)     ; deposit date
"RTN","RCDPE8NZ",109,0)
 ..S Y=Y_"  "_$E($J(+$P(RCDATA(0),U,8),"",2)_$J("",20),1,20)           ; total amt deposit
"RTN","RCDPE8NZ",110,0)
 ..S Y=Y_"  "_$J(+$G(^TMP(RCRPLST,$J,RCDT,RCARDEP)),"",2)              ; total amt unposted
"RTN","RCDPE8NZ",111,0)
 ..D SL^RCDPEARL(Y,.RCLNCNT,RCTMPND)
"RTN","RCDPE8NZ",112,0)
 ..S RCEFTIEN=0 F  S RCEFTIEN=$O(^TMP(RCRPLST,$J,RCDT,RCARDEP,RCEFTIEN)) Q:'RCEFTIEN  S RCDATA=$G(^(RCEFTIEN)),RCEFT("DEP")=$G(^RCY(344.31,RCEFTIEN,0)) D
"RTN","RCDPE8NZ",113,0)
 ...I 'RCLSTMGR,$Y>(IOSL-RCHDR(0)) D HDRLST^RCDPEARL(.RCSTOP,.RCHDR) Q:RCSTOP
"RTN","RCDPE8NZ",114,0)
 ...N RCPAY S RCPAY=$P(RCEFT("DEP"),U,2) S:RCPAY="" RCPAY="NO PAYER NAME RECEIVED" ; PRCA*4.5*298
"RTN","RCDPE8NZ",115,0)
 ...;
"RTN","RCDPE8NZ",116,0)
 ...; PRCA*4.5*317 Shift line 2 chars to the right
"RTN","RCDPE8NZ",117,0)
 ...S Y="   "_RCPAY_"/"_$P(RCEFT("DEP"),U,3)  D SL^RCDPEARL(Y,.RCLNCNT,RCTMPND)   ; payer/ID
"RTN","RCDPE8NZ",118,0)
 ...; PRCA*4.5*317 Shift line 2 chars to the right
"RTN","RCDPE8NZ",119,0)
 ...S Y="    "_$E($P(RCEFT("DEP"),U,4)_$J("",50),1,50)                ; trace #
"RTN","RCDPE8NZ",120,0)
 ...S Y=Y_" "_$E($J(+$P(RCEFT("DEP"),U,7),"",2)_$J("",12),1,12)       ; payment amt
"RTN","RCDPE8NZ",121,0)
 ...;
"RTN","RCDPE8NZ",122,0)
 ...; PRCA*4.5*317 Shift lines 2 to thr right to allow 12 digit receipt #
"RTN","RCDPE8NZ",123,0)
 ...S Y=Y_" "_$S($P(RCDATA,U,4)'="":$P(RCDATA,U,4),1:"NO RECEIPT")    ; receipt #
"RTN","RCDPE8NZ",124,0)
 ... D SL^RCDPEARL(Y,.RCLNCNT,RCTMPND)
"RTN","RCDPE8NZ",125,0)
 ...; PRCA*4.5*317 Shift line 2 chars to the right
"RTN","RCDPE8NZ",126,0)
 ...S Z=$P(RCEFT("DEP"),U,8)
"RTN","RCDPE8NZ",127,0)
 ...S Y="      "_$E($S('Z:"UNMATCHED",Z=2:"PAPER EOB",1:"MATCHED TO ERA #: "_$P(RCEFT("DEP"),U,10)_$S(Z=-1:" (TOTALS MISMATCH)",1:""))_$J("",40),1,40)_"  "
"RTN","RCDPE8NZ",128,0)
 ...S Y=Y_$S($P(RCDATA,U)=-1:"NO RECEIPT",$P(RCDATA,U)=-2:"NO FMS DOCUMENT",1:$E($P(RCDATA,U,2)_" - "_$P(RCDATA,U,3),1,30))
"RTN","RCDPE8NZ",129,0)
 ...D SL^RCDPEARL(Y,.RCLNCNT,RCTMPND)
"RTN","RCDPE8NZ",130,0)
 ;
"RTN","RCDPE8NZ",131,0)
 I '$D(^TMP(RCRPLST,$J)) D SL^RCDPEARL("*** NO RECORDS TO PRINT ***",.RCLNCNT,RCTMPND)
"RTN","RCDPE8NZ",132,0)
 ;
"RTN","RCDPE8NZ",133,0)
 I 'RCSTOP D SL^RCDPEARL(" ",.RCLNCNT,RCTMPND),SL^RCDPEARL($$ENDORPRT^RCDPEARL,.RCLNCNT,RCTMPND)
"RTN","RCDPE8NZ",134,0)
 I $D(ZTQUEUED) S ZTREQ="@"
"RTN","RCDPE8NZ",135,0)
 D:'$D(ZTQUEUED) ^%ZISC
"RTN","RCDPE8NZ",136,0)
 G:RCSTOP RPTQ
"RTN","RCDPE8NZ",137,0)
 ;
"RTN","RCDPE8NZ",138,0)
 I 'RCLSTMGR,'RCSTOP,$E(IOST,1,2)="C-" D ASK^RCDPEARL(.RCSTOP)
"RTN","RCDPE8NZ",139,0)
 ;
"RTN","RCDPE8NZ",140,0)
RPTQ ;
"RTN","RCDPE8NZ",141,0)
 K ^TMP(RCRPLST,$J)
"RTN","RCDPE8NZ",142,0)
 Q
"RTN","RCDPE8NZ",143,0)
 ;
"RTN","RCDPE8NZ",144,0)
GETREC(EFTDA,EFTDET,RECEXT) ; function,  prca276
"RTN","RCDPE8NZ",145,0)
 ; input - EFTDA - IEN OF 344.31
"RTN","RCDPE8NZ",146,0)
 ; input - EFTDET - data stored at the 0 subscript of the THIRD PARTY EFT DETAIL file (344.31)
"RTN","RCDPE8NZ",147,0)
 ; input - RECEXT passed by reference
"RTN","RCDPE8NZ",148,0)
 ; output - RECEXT populated with the external receipt value that gets generated on the report
"RTN","RCDPE8NZ",149,0)
 ; output - RECEIPT - returns internal value of the receipt that either comes from the EFT file (344.31) or the ERA file (344.4) 
"RTN","RCDPE8NZ",150,0)
 N RECEIPT
"RTN","RCDPE8NZ",151,0)
 S RECEXT=0
"RTN","RCDPE8NZ",152,0)
 S RECEIPT=+$P($G(^RCY(344.4,+$P(EFTDET,U,10),0)),U,8)  ; get receipt off the ERA record
"RTN","RCDPE8NZ",153,0)
 I 'RECEIPT,$P(EFTDET,U,8)=2 S RECEIPT=+$O(^RCY(344,"AEFT",EFTDA,0))  ; EFT processed against paper EOB
"RTN","RCDPE8NZ",154,0)
 I 'RECEIPT S RECEIPT=$P(EFTDET,U,9) ; receipt not posted in payment file so get from EFT detail (unprocessed EFT)
"RTN","RCDPE8NZ",155,0)
 I +RECEIPT,'$D(^RCY(344,RECEIPT)) Q "PURGED"  ; handle purged receipts but broken pointer exists in 344.31; need to handle as a processed EFT 
"RTN","RCDPE8NZ",156,0)
 I +RECEIPT S RECEXT=$P(^RCY(344,RECEIPT,0),U)
"RTN","RCDPE8NZ",157,0)
 Q +RECEIPT
"RTN","RCDPE8NZ",158,0)
 ;
"RTN","RCDPE8NZ",159,0)
 ;
"RTN","RCDPE8NZ",160,0)
HDRBLD ; create the report header
"RTN","RCDPE8NZ",161,0)
 ; returns RCHDR, RCPGNUM, RCSTOP
"RTN","RCDPE8NZ",162,0)
 ;   RCHDR(0) = header text line count
"RTN","RCDPE8NZ",163,0)
 ;   RCHDR("XECUTE") = M code for page number
"RTN","RCDPE8NZ",164,0)
 ;   RCHDR("RUNDATE") = date/time report generated, external format
"RTN","RCDPE8NZ",165,0)
 ;   RCPGNUM - page counter
"RTN","RCDPE8NZ",166,0)
 ;   RCSTOP - flag to exit
"RTN","RCDPE8NZ",167,0)
 ; INPUT: 
"RTN","RCDPE8NZ",168,0)
 ;   RCDISPTY - Display/print/Excel flag
"RTN","RCDPE8NZ",169,0)
 ;   RCRTYP - Report Type (EOB or ERA)
"RTN","RCDPE8NZ",170,0)
 ;   VAUTD
"RTN","RCDPE8NZ",171,0)
 K RCHDR S RCHDR("RUNDATE")=$$NOW^RCDPEARL,RCPGNUM=0,RCSTOP=0
"RTN","RCDPE8NZ",172,0)
 ;
"RTN","RCDPE8NZ",173,0)
 ;
"RTN","RCDPE8NZ",174,0)
 I RCDISPTY D  Q  ; Excel format, xecute code is QUIT, null page number
"RTN","RCDPE8NZ",175,0)
 .S RCHDR(0)=1,RCHDR("XECUTE")="Q",RCPGNUM=""
"RTN","RCDPE8NZ",176,0)
 .S RCHDR(1)="DEPOSIT #^DEPOSIT DATE^TOT AMT DEPOSIT^TOT AMT UNPOSTED^PAYER ID^TRACE #^PAYMENT AMT^RECEIPT #^ERA MATCHED^FMS DOC #/STATUS"
"RTN","RCDPE8NZ",177,0)
 ;
"RTN","RCDPE8NZ",178,0)
 N DIV,HCNT,Y
"RTN","RCDPE8NZ",179,0)
 S HCNT=0  ; header counter
"RTN","RCDPE8NZ",180,0)
 ;
"RTN","RCDPE8NZ",181,0)
 S Y=$$HDRNM,HCNT=1,RCHDR(HCNT)=$J("",80-$L(Y)\2)_Y  ; line 1 will be replaced by XECUTE code below
"RTN","RCDPE8NZ",182,0)
 S RCHDR("XECUTE")="N Y S RCPGNUM=RCPGNUM+1,Y=$$HDRNM^"_$T(+0)_"_$S(RCLSTMGR:"""",1:$J(""Page: ""_RCPGNUM,12)),RCHDR(1)=$J("" "",80-$L(Y)\2)_Y"
"RTN","RCDPE8NZ",183,0)
 S Y="Run Date: "_RCHDR("RUNDATE"),HCNT=HCNT+1,RCHDR(HCNT)=$J("",80-$L(Y)\2)_Y  ; line 1 will be replaced by XECUTE code below
"RTN","RCDPE8NZ",184,0)
 ;
"RTN","RCDPE8NZ",185,0)
 S Y="Date Range: "_$$FMTE^XLFDT(RCSTDT,2)_" - "_$$FMTE^XLFDT(RCENDT,2)_" (Deposit Date)",Y=$J("",80-$L(Y)\2)_Y
"RTN","RCDPE8NZ",186,0)
 S HCNT=HCNT+1,RCHDR(HCNT)=Y
"RTN","RCDPE8NZ",187,0)
 S Y="TOTAL NUMBER OF UNAPPLIED DEPOSITS: "_RCUNAP,HCNT=HCNT+1,RCHDR(HCNT)=$J("",80-$L(Y)\2)_Y
"RTN","RCDPE8NZ",188,0)
 S Y="TOTAL AMOUNT OF UNAPPLIED DEPOSITS: $"_$FN(RCSUM,",",2),HCNT=HCNT+1,RCHDR(HCNT)=$J("",80-$L(Y)\2)_Y
"RTN","RCDPE8NZ",189,0)
 S HCNT=HCNT+1,RCHDR(HCNT)=""
"RTN","RCDPE8NZ",190,0)
 ;
"RTN","RCDPE8NZ",191,0)
 ; PRCA*4.5*317 Shift each line 2 chars to the right
"RTN","RCDPE8NZ",192,0)
 S HCNT=HCNT+1,RCHDR(HCNT)="  DEPOSIT #      DEPOSIT DATE      TOT AMT OF DEPOSIT    TOT AMT UNPOSTED"
"RTN","RCDPE8NZ",193,0)
 S HCNT=HCNT+1,RCHDR(HCNT)="   PAYER/ID"
"RTN","RCDPE8NZ",194,0)
 S HCNT=HCNT+1,RCHDR(HCNT)=$J("",4)_"TRACE #"_$J("",44)_"PAYMENT AMT  RECEIPT #"
"RTN","RCDPE8NZ",195,0)
 S HCNT=HCNT+1,RCHDR(HCNT)=$J("",6)_$E("ERA MATCHED"_$J("",40),1,40)_"  FMS DOC #/STATUS"
"RTN","RCDPE8NZ",196,0)
 ; PRCA*4.5*317 End
"RTN","RCDPE8NZ",197,0)
 S Y="",$P(Y,"=",81)="",HCNT=HCNT+1,RCHDR(HCNT)=Y  ; row of equal signs at bottom
"RTN","RCDPE8NZ",198,0)
 ;
"RTN","RCDPE8NZ",199,0)
 S RCHDR(0)=HCNT  ; header line count
"RTN","RCDPE8NZ",200,0)
 Q
"RTN","RCDPE8NZ",201,0)
 ;
"RTN","RCDPE8NZ",202,0)
HDRLM ; create the report header
"RTN","RCDPE8NZ",203,0)
 ; returns RCHDR
"RTN","RCDPE8NZ",204,0)
 ;   RCHDR(0) = header text line count
"RTN","RCDPE8NZ",205,0)
 ; INPUT: 
"RTN","RCDPE8NZ",206,0)
 ;   RCSTDT - Date Range
"RTN","RCDPE8NZ",207,0)
 K RCHDR
"RTN","RCDPE8NZ",208,0)
 ;
"RTN","RCDPE8NZ",209,0)
 N DIV,HCNT,Y
"RTN","RCDPE8NZ",210,0)
 S HCNT=0  ; header counter
"RTN","RCDPE8NZ",211,0)
 S Y="Date Range: "_$$FMTE^XLFDT(RCSTDT,2)_" - "_$$FMTE^XLFDT(RCENDT,2)_" (Deposit Date)",HCNT=HCNT+1,RCHDR(HCNT)=Y
"RTN","RCDPE8NZ",212,0)
 S Y="TOTAL NUMBER OF UNAPPLIED DEPOSITS: "_RCUNAP,HCNT=HCNT+1,RCHDR(HCNT)=Y
"RTN","RCDPE8NZ",213,0)
 S Y="TOTAL AMOUNT OF UNAPPLIED DEPOSITS: $"_$FN(RCSUM,",",2),HCNT=HCNT+1,RCHDR(HCNT)=Y
"RTN","RCDPE8NZ",214,0)
 ;
"RTN","RCDPE8NZ",215,0)
 ; PRCA*4.5*317 Shift each line 2 chars to the right
"RTN","RCDPE8NZ",216,0)
 S HCNT=HCNT+1,RCHDR(HCNT)="  DEPOSIT #      DEPOSIT DATE      TOT AMT OF DEPOSIT    TOT AMT UNPOSTED"
"RTN","RCDPE8NZ",217,0)
 S HCNT=HCNT+1,RCHDR(HCNT)="   PAYER/ID"
"RTN","RCDPE8NZ",218,0)
 S HCNT=HCNT+1,RCHDR(HCNT)=$J("",4)_"TRACE #"_$J("",44)_"PAYMENT AMT  RECEIPT #"
"RTN","RCDPE8NZ",219,0)
 S HCNT=HCNT+1,RCHDR(HCNT)=$J("",6)_$E("ERA MATCHED"_$J("",40),1,40)_"  FMS DOC #/STATUS"
"RTN","RCDPE8NZ",220,0)
 ; PRCA*4.5*317 End
"RTN","RCDPE8NZ",221,0)
 ;
"RTN","RCDPE8NZ",222,0)
 S RCHDR(0)=HCNT  ; header line count
"RTN","RCDPE8NZ",223,0)
 Q
"RTN","RCDPE8NZ",224,0)
 ;
"RTN","RCDPE8NZ",225,0)
 ; extrinsic variable, name for header PRCA*4.5*298
"RTN","RCDPE8NZ",226,0)
HDRNM() Q "Unapplied EFT Deposits Report"
"RTN","RCDPE8NZ",227,0)
 ;
"RTN","RCDPE8NZ",228,0)
EXCEL ; Print report formatted for export to Excel
"RTN","RCDPE8NZ",229,0)
 N STR1
"RTN","RCDPE8NZ",230,0)
 W !,$G(RCHDR(1)),!
"RTN","RCDPE8NZ",231,0)
 S RCDT=0 F  S RCDT=$O(^TMP(RCRPLST,$J,RCDT)) Q:'RCDT  D  Q:RCSTOP
"RTN","RCDPE8NZ",232,0)
 .S RCARDEP=0 F  S RCARDEP=$O(^TMP(RCRPLST,$J,RCDT,RCARDEP)) Q:'RCARDEP  D
"RTN","RCDPE8NZ",233,0)
 ..S RCDATA(0)=$G(^RCY(344.3,RCARDEP,0))
"RTN","RCDPE8NZ",234,0)
 ..S STR1=$P(RCDATA(0),U,6)_$S('$$HACEFT^RCDPEU(RCARDEP):"",1:"-HAC")_U_$$FMTE^XLFDT($P(RCDATA(0),U,7))_U_$P(RCDATA(0),U,8)_U
"RTN","RCDPE8NZ",235,0)
 ..S STR1=STR1_+$G(^TMP(RCRPLST,$J,RCDT,RCARDEP))_U
"RTN","RCDPE8NZ",236,0)
 ..S RCEFTIEN=0 F  S RCEFTIEN=$O(^TMP(RCRPLST,$J,RCDT,RCARDEP,RCEFTIEN)) Q:'RCEFTIEN  S RCDATA=$G(^(RCEFTIEN)),RCEFT("DEP")=$G(^RCY(344.31,RCEFTIEN,0)) D
"RTN","RCDPE8NZ",237,0)
 ...W STR1 S:$P(RCEFT("DEP"),U,2)="" $P(RCEFT("DEP"),U,2)="NO PAYER NAME RECEIVED" ;PRCA*4.5*298
"RTN","RCDPE8NZ",238,0)
 ...W $P(RCEFT("DEP"),U,2)_"/"_$P(RCEFT("DEP"),U,3)_U_$P(RCEFT("DEP"),U,4)_U
"RTN","RCDPE8NZ",239,0)
 ...W +$P(RCEFT("DEP"),U,7)_U_$S($P(RCDATA,U,4)'="":$P(RCDATA,U,4),1:"NO RECEIPT")_U
"RTN","RCDPE8NZ",240,0)
 ...W $P(RCEFT("DEP"),U,10)_U
"RTN","RCDPE8NZ",241,0)
 ...W $S($P(RCDATA,U)=-1:"NO RECEIPT",$P(RCDATA,U)=-2:"NO FMS DOCUMENT",1:$P(RCDATA,U,2)_" - "_$P(RCDATA,U,3))
"RTN","RCDPE8NZ",242,0)
 ...W !
"RTN","RCDPE8NZ",243,0)
 Q
"RTN","RCDPE8NZ",244,0)
 ;
"RTN","RCDPEAA1")
0^5^B126873645^B79531337
"RTN","RCDPEAA1",1,0)
RCDPEAA1 ;ALB/KML - AUTO POST AWAITING RESOLUTION (APAR) - LIST OF UNPOSTED EEOBS ;Jun 06, 2014@19:11:19
"RTN","RCDPEAA1",2,0)
 ;;4.5;Accounts Receivable;**298,304,317**;Mar 20, 1995;Build 8
"RTN","RCDPEAA1",3,0)
 ;Per VA Directive 6402, this routine should not be modified.
"RTN","RCDPEAA1",4,0)
 Q
"RTN","RCDPEAA1",5,0)
 ;
"RTN","RCDPEAA1",6,0)
EN ; Main entry point
"RTN","RCDPEAA1",7,0)
 N RCQUIT,RCPROG
"RTN","RCDPEAA1",8,0)
 S RCQUIT=0
"RTN","RCDPEAA1",9,0)
 ; Calling Change View API in Menu Option Mode
"RTN","RCDPEAA1",10,0)
 D PARAMS("MO") I RCQUIT G ENQ
"RTN","RCDPEAA1",11,0)
 D EN^VALM("RCDPE APAR EEOB LIST")
"RTN","RCDPEAA1",12,0)
 ;
"RTN","RCDPEAA1",13,0)
ENQ Q
"RTN","RCDPEAA1",14,0)
 ;
"RTN","RCDPEAA1",15,0)
INIT ; Entry point for List template to build the display of EEOBs on APAR
"RTN","RCDPEAA1",16,0)
 ;
"RTN","RCDPEAA1",17,0)
 ; Parameters for selecting EEOBs to be included in the list are
"RTN","RCDPEAA1",18,0)
 ; contained in the global ^TMP("RCDPE_APAR_EEOB_PARAMS",$J,parameter name)
"RTN","RCDPEAA1",19,0)
 ;
"RTN","RCDPEAA1",20,0)
 N FDTTM,RCDA
"RTN","RCDPEAA1",21,0)
 S RCAPAR=1
"RTN","RCDPEAA1",22,0)
 D FULL^VALM1,CLEAN^VALM10
"RTN","RCDPEAA1",23,0)
 K ^TMP($J,"RCDPE_APAR_EEOB_LIST")
"RTN","RCDPEAA1",24,0)
 K ^TMP("RCDPE-APAR_EEOB_WL",$J),^TMP("RCDPE-APAR_EEOB_WLDX",$J)
"RTN","RCDPEAA1",25,0)
 ; get ERAs that are in a 'partial' auto-post status
"RTN","RCDPEAA1",26,0)
 S RCDA=0 F  S RCDA=$O(^RCY(344.4,"E",1,RCDA)) Q:'RCDA  D
"RTN","RCDPEAA1",27,0)
 . I $$FILTER(RCDA)  S RC0=$G(^RCY(344.4,RCDA,0)) S ^TMP($J,"RCDPE_APAR_EEOB_LIST",$$UP^RCDPEARL(+$P(RC0,U,6)),RCDA)=""
"RTN","RCDPEAA1",28,0)
 ; Output the list
"RTN","RCDPEAA1",29,0)
 I $D(^TMP($J,"RCDPE_APAR_EEOB_LIST")) D BLD
"RTN","RCDPEAA1",30,0)
 ; If no EEOBs found display the message below in the list area
"RTN","RCDPEAA1",31,0)
 I '$O(^TMP("RCDPE-APAR_EEOB_WL",$J,0)) D
"RTN","RCDPEAA1",32,0)
 . S ^TMP("RCDPE-APAR_EEOB_WL",$J,1,0)="There are no EEOBs matching your selection criteria" S VALMCNT=1
"RTN","RCDPEAA1",33,0)
 Q
"RTN","RCDPEAA1",34,0)
 ;
"RTN","RCDPEAA1",35,0)
 ;
"RTN","RCDPEAA1",36,0)
BLD ; Build EEOB list to be displayed on APAR screen
"RTN","RCDPEAA1",37,0)
 N PN,RCDA,RCDA1,RCSEQ,RCT,WL490,WL4910,ERA40,ERA44,ERA410,ERA414,ERA415,RCARRY,TOTPOSTD,BALANCE
"RTN","RCDPEAA1",38,0)
 S (RCT,TOTPOSTD,BALANCE,VALMCNT,RCSEQ)=0,PN="",RCPROG="RCDPEAA1"
"RTN","RCDPEAA1",39,0)
 F  S PN=$O(^TMP($J,"RCDPE_APAR_EEOB_LIST",PN),-1) Q:PN=""  S RCDA=0 F  S RCDA=$O(^TMP($J,"RCDPE_APAR_EEOB_LIST",PN,RCDA)) Q:'RCDA  D 
"RTN","RCDPEAA1",40,0)
 . ;retrieve unposted EEOB data
"RTN","RCDPEAA1",41,0)
 . F  S RCSEQ=$O(^RCY(344.49,RCDA,1,"B",RCSEQ)) Q:'RCSEQ  I RCSEQ#1=0 S RCDA1=+$O(^RCY(344.49,RCDA,1,"B",RCSEQ,0)) I RCDA1 D
"RTN","RCDPEAA1",42,0)
 . . S WL490=$G(^RCY(344.49,RCDA,0))  ; data from node 0 of 344.49
"RTN","RCDPEAA1",43,0)
 . . S WL4910=$G(^RCY(344.49,RCDA,1,RCDA1,0))  ;data from 0 node of 344.491
"RTN","RCDPEAA1",44,0)
 . . I +$P(WL4910,U,3)=0 Q  ; ignore zero value lines
"RTN","RCDPEAA1",45,0)
 . . S ERA40=$G(^RCY(344.4,RCDA,0))  ; summary data of ERA
"RTN","RCDPEAA1",46,0)
 . . S ERA44=$G(^RCY(344.4,RCDA,4))  ; ERA auto-post date and status
"RTN","RCDPEAA1",47,0)
 . . S ERA410=$G(^RCY(344.4,RCDA,1,+$P(WL4910,U,9),0)) ; EEOB level data
"RTN","RCDPEAA1",48,0)
 . . S ERA414=$G(^RCY(344.4,RCDA,1,+$P(WL4910,U,9),4))  ; EEOB level data (e.g., receipt# and ECME)
"RTN","RCDPEAA1",49,0)
 . . S ERA415=$G(^RCY(344.4,RCDA,1,+$P(WL4910,U,9),5))  ; EEOB level  - auto-post related data
"RTN","RCDPEAA1",50,0)
 . . S TOTPOSTD=$S($P(ERA414,U,3)]"":+$P(WL4910,U,3)+TOTPOSTD,1:TOTPOSTD) ; if EEOB line item has a receipt,then add 
"RTN","RCDPEAA1",51,0)
 . . ;                                                                     AMOUNT TO POST ON RECEIPT (344.491,.03) to total amount posted (TOTPOSTD)
"RTN","RCDPEAA1",52,0)
 . . S BALANCE=$S($P(ERA414,U,3)']"":$P(WL490,U,3)-TOTPOSTD,1:BALANCE)  ; if EEOB line item does not have a receipt, then calculate the unposted balance
"RTN","RCDPEAA1",53,0)
 . . ;                                                              using the following calculation: TOTAL PAYMENT RECEIVED (344.49, .03) - total amount posted (TOTPOSTD)
"RTN","RCDPEAA1",54,0)
 . . I $P(ERA414,U,3)']"",'$P(ERA415,U,2) D  ; display only EEOB items that do not have a receipt and are not marked for autopost
"RTN","RCDPEAA1",55,0)
 . . . S RCT=RCT+1
"RTN","RCDPEAA1",56,0)
 . . . S RCARRY(RCT)=$P(ERA40,U)_U_+$P(WL4910,U,9)_U_$P(WL4910,U,2)_U_RCDA1 ;RCARRY=ERA#^SEQ^CLAIM#^ien of 344.491                                                                          
"RTN","RCDPEAA1",57,0)
 . I $D(RCARRY) D ERALINES(RCDA,.RCARRY,BALANCE,TOTPOSTD,$P(ERA44,U),$P(ERA40,U,3),$P(ERA40,U,6)) K RCARRY
"RTN","RCDPEAA1",58,0)
 . S (BALANCE,TOTPOSTD)=0
"RTN","RCDPEAA1",59,0)
 Q
"RTN","RCDPEAA1",60,0)
 ;
"RTN","RCDPEAA1",61,0)
ERALINES(RCDA,RCARRY,BALANCE,TOTPOSTD,POSTDT,PAYID,PAYNM) ;  set EEOB line into List Manager arrays
"RTN","RCDPEAA1",62,0)
 ;
"RTN","RCDPEAA1",63,0)
 ;     input - RCDA     = top file ien for files 344.4 and 344.49
"RTN","RCDPEAA1",64,0)
 ;             RCARRY   = array that holds the EEOB data to be displayed
"RTN","RCDPEAA1",65,0)
 ;             BALANCE  = Amount that is left to be posted                                                  
"RTN","RCDPEAA1",66,0)
 ;             TOTPOSTD = Total amount posted thus far against the ERA
"RTN","RCDPEAA1",67,0)
 ;             POSTDT   = latest auto-posted date
"RTN","RCDPEAA1",68,0)
 ;             PAYID    = payer id
"RTN","RCDPEAA1",69,0)
 ;             PAYNM    = payer name
"RTN","RCDPEAA1",70,0)
 N RCT,X
"RTN","RCDPEAA1",71,0)
 S RCT=0
"RTN","RCDPEAA1",72,0)
 F  S RCT=$O(RCARRY(RCT)) Q:'RCT  D 
"RTN","RCDPEAA1",73,0)
 . ; line 1 of displayed EEOB item: selectable line #, ERA reference.EEOB seq#, Claim #
"RTN","RCDPEAA1",74,0)
 . S X=$J(RCT,3)_"   "_$J($P(RCARRY(RCT),U)_"."_$P(RCARRY(RCT),U,2),14)_"   "_$J($P(RCARRY(RCT),U,3),10)
"RTN","RCDPEAA1",75,0)
 . ; cont. line 1 of displayed EEOB item: X_Total posted amt, posted date, Unposted balance
"RTN","RCDPEAA1",76,0)
 . S X=X_"   "_$J(TOTPOSTD,12,2)_"   "_$J($$FMTE^XLFDT(POSTDT,"2D"),8)_"   "_$J(BALANCE,12,2)
"RTN","RCDPEAA1",77,0)
 . D SET(X,RCT,RCDA,$P(RCARRY(RCT),U,4),BALANCE,TOTPOSTD)
"RTN","RCDPEAA1",78,0)
 . ; line 2 of displayed EEOB item: payer name/payer id
"RTN","RCDPEAA1",79,0)
 . S X="      "_PAYNM_"/"_PAYID
"RTN","RCDPEAA1",80,0)
 . D SET(X,RCT,RCDA,$P(RCARRY(RCT),U,4),BALANCE,TOTPOSTD)
"RTN","RCDPEAA1",81,0)
 Q
"RTN","RCDPEAA1",82,0)
 ;
"RTN","RCDPEAA1",83,0)
SET(X,RCSEQ,RCDA,RCDA1,BALANCE,TOTPOSTD) ; -- set ListManager arrays
"RTN","RCDPEAA1",84,0)
 ; X = the data to set into the global
"RTN","RCDPEAA1",85,0)
 ; RCSEQ = the selectable line #
"RTN","RCDPEAA1",86,0)
 ; RCDA = the ien of the entry in file 344.49
"RTN","RCDPEAA1",87,0)
 ; RCDA1 = ien of the entry in file 344.491
"RTN","RCDPEAA1",88,0)
 ; BALANCE = Amount that is left to be posted
"RTN","RCDPEAA1",89,0)
 ; TOTPOSTD = Total amount posted thus far against the ERA
"RTN","RCDPEAA1",90,0)
 S VALMCNT=VALMCNT+1,^TMP("RCDPE-APAR_EEOB_WL",$J,VALMCNT,0)=X
"RTN","RCDPEAA1",91,0)
 S ^TMP("RCDPE-APAR_EEOB_WL",$J,"IDX",VALMCNT,RCSEQ)=RCDA
"RTN","RCDPEAA1",92,0)
 S ^TMP("RCDPE-APAR_EEOB_WLDX",$J,RCSEQ)=VALMCNT_U_RCDA_U_RCDA1_U_$G(BALANCE)_U_$G(TOTPOSTD)
"RTN","RCDPEAA1",93,0)
 Q
"RTN","RCDPEAA1",94,0)
 ;
"RTN","RCDPEAA1",95,0)
HDR ;
"RTN","RCDPEAA1",96,0)
 N RCPAYR,X,LINE,RCMDRX,Y
"RTN","RCDPEAA1",97,0)
 S RCPAYR=$G(^TMP("RCDPE_APAR_EEOB_PARAMS",$J,"RCPAYR"))
"RTN","RCDPEAA1",98,0)
 S RCMDRX=$G(^TMP("RCDPE_APAR_EEOB_PARAMS",$J,"RCMEDRX"))
"RTN","RCDPEAA1",99,0)
 S Y=$S(RCMDRX="M":"MEDICAL",RCMDRX="P":"PHARMACY",1:"MEDICAL + PHARMACY")_" CLAIMS"
"RTN","RCDPEAA1",100,0)
 S X=$S(($P(RCPAYR,U)="A")!(RCPAYR=""):"ALL PAYERS",1:"PAYERS: "_$P(RCPAYR,U,2)_"-"_$P(RCPAYR,U,3))
"RTN","RCDPEAA1",101,0)
 S VALMHDR(1)="Current View:"_$J("",4)_Y_" for "_X
"RTN","RCDPEAA1",102,0)
 S VALMHDR(2)=""
"RTN","RCDPEAA1",103,0)
 S LINE="      "_$$CJ^XLFSTR("ERA#.Seq",14)_"   "_$$CJ^XLFSTR("Claim#",10)_"    "_$$CJ^XLFSTR("Posted Amt",12)
"RTN","RCDPEAA1",104,0)
 S LINE=LINE_"   "_$$CJ^XLFSTR("Post Date",8)_"   "_$$CJ^XLFSTR("Un-posted Bal",12)
"RTN","RCDPEAA1",105,0)
 S VALMHDR(3)=LINE
"RTN","RCDPEAA1",106,0)
 Q
"RTN","RCDPEAA1",107,0)
 ;
"RTN","RCDPEAA1",108,0)
EXIT ; -- Clean up list
"RTN","RCDPEAA1",109,0)
 K ^TMP("RCDPE-APAR_EEOB_WL",$J),^TMP("RCDPE-APAR_EEOB_WLDX",$J),^TMP("RCDPE_APAR_EEOB_PARAMS",$J),^TMP($J,"RCDPE_APAR_EEOB_LIST")
"RTN","RCDPEAA1",110,0)
 K ^TMP("RCDPE_APAR_PVW",$J)
"RTN","RCDPEAA1",111,0)
 K RCAPAR
"RTN","RCDPEAA1",112,0)
 Q
"RTN","RCDPEAA1",113,0)
 ;
"RTN","RCDPEAA1",114,0)
PARAMS(SOURCE) ; Retrieve/Edit/Save View Parameters for APAR EEOB Worklist
"RTN","RCDPEAA1",115,0)
 ; Input:   SOURCE      - "MO" - Called from Menu Option 
"RTN","RCDPEAA1",116,0)
 ;                        "CV" - Called from Change View action
"RTN","RCDPEAA1",117,0)
 ; Output: ^TMP("RCDPE_APAR_EEOB_PARAMS",$J,"RCPAYR") - P1^P2^P3 Where:
"RTN","RCDPEAA1",118,0)
 ;                                                      P1- All Payers/Range of Payers
"RTN","RCDPEAA1",119,0)
 ;                                                          ("A": All/"R":Range of Payers)
"RTN","RCDPEAA1",120,0)
 ;                                                      P2- START WITH PAYER (e.g.,'AET')
"RTN","RCDPEAA1",121,0)
 ;                                                          (Range Limited Only)
"RTN","RCDPEAA1",122,0)
 ;                                                      P3- GO TO PAYER (e.g.,'AETZ')
"RTN","RCDPEAA1",123,0)
 ;                                                         (Range Limited Only)
"RTN","RCDPEAA1",124,0)
 ;         ^TMP("RCDPE_APAR_EEOB_PARAMS",$J,"RCMEDRX")-  (M)edical, (P)harmacy, or (B)
"RTN","RCDPEAA1",125,0)
 ;        
"RTN","RCDPEAA1",126,0)
 ;         ^TMP("RCDPE_APAR_PVW",$J)
"RTN","RCDPEAA1",127,0)
 ;              The ^TMP("RCDPE_APAR_PVW",$J) global contains the sort/filters of the user's preferred
"RTN","RCDPEAA1",128,0)
 ;              view while ^TMP("RCDPE_APAR_EEOB_PARAMS",$J,...)"RCPAYR" & "RCMEDRX" contain the 
"RTN","RCDPEAA1",129,0)
 ;              sort/filters of what is currently displayed.
"RTN","RCDPEAA1",130,0)
 ;
"RTN","RCDPEAA1",131,0)
 ;         Or RCQUIT=1
"RTN","RCDPEAA1",132,0)
 N RCXPAR,USEPVW,XX    ;PRCA*4.5*317 added XX
"RTN","RCDPEAA1",133,0)
 S RCQUIT=0
"RTN","RCDPEAA1",134,0)
 D:SOURCE="MO" GETWLPVW(.RCXPAR)  ;Retrieve user's saved preferred view (if any)
"RTN","RCDPEAA1",135,0)
 ;
"RTN","RCDPEAA1",136,0)
 ;Only ask user if they want to use their preferred view in the following scenarios:
"RTN","RCDPEAA1",137,0)
 ; a) Source is "MO" and user has a preferred view on file
"RTN","RCDPEAA1",138,0)
 ; b) Source is "CV" (change view action), user has a preferred view but is
"RTN","RCDPEAA1",139,0)
 ;    not using the preferred view criteria at this time.
"RTN","RCDPEAA1",140,0)
 S XX=$$PREFVW(SOURCE)
"RTN","RCDPEAA1",141,0)
 I ((XX=1)&(SOURCE="MO"))!((XX=0)&(SOURCE="CV")) D  Q:USEPVW
"RTN","RCDPEAA1",142,0)
 . ;
"RTN","RCDPEAA1",143,0)
 . ; Ask the user if they want to use the preferred view
"RTN","RCDPEAA1",144,0)
 . S USEPVW=$$ASKUVW^RCDPEWL0()
"RTN","RCDPEAA1",145,0)
 . I USEPVW=-1 S RCQUIT=1 Q
"RTN","RCDPEAA1",146,0)
 . Q:'USEPVW
"RTN","RCDPEAA1",147,0)
 . ;
"RTN","RCDPEAA1",148,0)
 . ; Set the Sort/Filtering Criteria from the preferred view 
"RTN","RCDPEAA1",149,0)
 . M ^TMP("RCDPE_APAR_EEOB_PARAMS",$J)=^TMP("RCDPE_APAR_PVW",$J)
"RTN","RCDPEAA1",150,0)
 ;
"RTN","RCDPEAA1",151,0)
 ;Ask the users for the sort/filter criteria
"RTN","RCDPEAA1",152,0)
 D PAYR
"RTN","RCDPEAA1",153,0)
 Q:RCQUIT
"RTN","RCDPEAA1",154,0)
 D CLMTYP
"RTN","RCDPEAA1",155,0)
 Q
"RTN","RCDPEAA1",156,0)
 ;
"RTN","RCDPEAA1",157,0)
GETWLPVW(RCXPAR)  ; Retrieves the preferred view settings for the APAR worklist
"RTN","RCDPEAA1",158,0)
 ; for the user
"RTN","RCDPEAA1",159,0)
 ; PRCA*4.5*317 - Added subroutine
"RTN","RCDPEAA1",160,0)
 ; Input:   None
"RTN","RCDPEAA1",161,0)
 ; Output:  RCXPAR()                        - Array of preferred view sort/filter criteria
"RTN","RCDPEAA1",162,0)
 ;          ^TMP("RCDPE_APAR_EEOB_PARAMS",$)- Global array of preferred view settings
"RTN","RCDPEAA1",163,0)
 N XX
"RTN","RCDPEAA1",164,0)
 K ^TMP("RCDPE_APAR_EEOB_PARAMS",$J)
"RTN","RCDPEAA1",165,0)
 D GETLST^XPAR(.RCXPAR,"USR","RCDPE APAR","I")
"RTN","RCDPEAA1",166,0)
 D:$D(RCXPAR("ALL_PAYERS/RANGE_OF_PAYERS")) PVWSAVE(.RCXPAR)
"RTN","RCDPEAA1",167,0)
 ;
"RTN","RCDPEAA1",168,0)
 S XX=$G(RCXPAR("ALL_PAYERS/RANGE_OF_PAYERS"))
"RTN","RCDPEAA1",169,0)
 S ^TMP("RCDPE_APAR_EEOB_PARAMS",$J,"RCPAYR")=$S(XX'="":$TR(XX,";","^"),1:"A")
"RTN","RCDPEAA1",170,0)
 S XX=$G(RCXPAR("MEDICAL/PHARMACY"))
"RTN","RCDPEAA1",171,0)
 S ^TMP("RCDPE_APAR_EEOB_PARAMS",$J,"RCMEDRX")=$S(XX'="":$TR(XX,";","^"),1:"B")
"RTN","RCDPEAA1",172,0)
 Q
"RTN","RCDPEAA1",173,0)
 ;
"RTN","RCDPEAA1",174,0)
PVWSAVE(RCXPAR) ; Save a copy of the preferred view on file
"RTN","RCDPEAA1",175,0)
 ; PRCA*4.5*317 added subroutine
"RTN","RCDPEAA1",176,0)
 ; Input: RCXPAR - array of preferred view setting for the user
"RTN","RCDPEAA1",177,0)
 ; Output: ^TMP("RCERA_PVW") - a copy of the preferred settings
"RTN","RCDPEAA1",178,0)
 ;
"RTN","RCDPEAA1",179,0)
 K ^TMP("RCDPE_APAR_PVW",$J)
"RTN","RCDPEAA1",180,0)
 ; only continue if we have answers to all APAR related preferred view prompts
"RTN","RCDPEAA1",181,0)
 Q:'$D(RCXPAR("ALL_PAYERS/RANGE_OF_PAYERS"))
"RTN","RCDPEAA1",182,0)
 Q:'$D(RCXPAR("MEDICAL/PHARMACY"))
"RTN","RCDPEAA1",183,0)
 ;
"RTN","RCDPEAA1",184,0)
 S ^TMP("RCDPE_APAR_PVW",$J,"RCPAYR")=$TR(RCXPAR("ALL_PAYERS/RANGE_OF_PAYERS"),";","^")
"RTN","RCDPEAA1",185,0)
 S ^TMP("RCDPE_APAR_PVW",$J,"RCMEDRX")=$TR(RCXPAR("MEDICAL/PHARMACY"),";","^")
"RTN","RCDPEAA1",186,0)
 Q
"RTN","RCDPEAA1",187,0)
 ;
"RTN","RCDPEAA1",188,0)
PREFVW(SOURCE,RCXPAR) ; Checks to see if the user has a preferred view
"RTN","RCDPEAA1",189,0)
 ; PRCA*4.5*317 added subroutine
"RTN","RCDPEAA1",190,0)
 ; When source is 'CV', checks to see if the preferred view is being used
"RTN","RCDPEAA1",191,0)
 ; Input:   SOURCE                         - 'MO' - When called from the Lockbox menu
"RTN","RCDPEAA1",192,0)
 ;                                                  option
"RTN","RCDPEAA1",193,0)
 ;                                           'CV' - When called from the Change View
"RTN","RCDPEAA1",194,0)
 ;                                                  action
"RTN","RCDPEAA1",195,0)
 ;          RCXPAR                        - Array of preferred view values
"RTN","RCDPEAA1",196,0)
 ;          ^TMP("RCDPE_APAR_EEOB_PARAMS")- Global array of currently in use defaults
"RTN","RCDPEAA1",197,0)
 ;          ^TMP("RCDPE_APAR_PVW",$J)     - Global array of preferred view settings
"RTN","RCDPEAA1",198,0)
 ;
"RTN","RCDPEAA1",199,0)
 ; Returns: 1 - User has preferred view if SOURCE is 'MO' or is using
"RTN","RCDPEAA1",200,0)
 ;              their preferred view if SOURCE is 'CV'
"RTN","RCDPEAA1",201,0)
 ;          0 - User is not using their preferred view
"RTN","RCDPEAA1",202,0)
 ;         -1 - User does not have a preferred view
"RTN","RCDPEAA1",203,0)
 ;
"RTN","RCDPEAA1",204,0)
 I SOURCE="MO" Q $S($D(^TMP("RCDPE_APAR_PVW",$J)):1,1:-1)
"RTN","RCDPEAA1",205,0)
 Q:'$D(^TMP("RCDPE_APAR_PVW",$J)) -1      ; No stored preferred view
"RTN","RCDPEAA1",206,0)
 Q:$G(^TMP("RCDPE_APAR_EEOB_PARAMS",$J,"RCPAYR"))'=$G(^TMP("RCDPE_APAR_PVW",$J,"RCPAYR")) 0
"RTN","RCDPEAA1",207,0)
 Q:$G(^TMP("RCDPE_APAR_EEOB_PARAMS",$J,"RCMEDRX"))'=$G(^TMP("RCDPE_APAR_PVW",$J,"RCMEDRX")) 0
"RTN","RCDPEAA1",208,0)
 Q 1
"RTN","RCDPEAA1",209,0)
 ;
"RTN","RCDPEAA1",210,0)
PAYR ; Payer Selection
"RTN","RCDPEAA1",211,0)
 ; Input:   ^TMP("RCDPE_APAR_EEOB_PARAMS",$J,"RCPAYR") - Current payer selection setting
"RTN","RCDPEAA1",212,0)
 ; Output:  ^TMP("RCDPE_APAR_EEOB_PARAMS",$J,"RCPAYR") - Updated  payer selection setting
"RTN","RCDPEAA1",213,0)
 ;          RCQUIT=1 if user ^ or timed out
"RTN","RCDPEAA1",214,0)
 N DIR,DUOUT,DTOUT,RCPAYR,RCPAYRDF,RCXPAR,RCDRLIM,RCERROR,RCAUTOPDF
"RTN","RCDPEAA1",215,0)
 N RCTYPEDF,RCQ,X,XX,Y
"RTN","RCDPEAA1",216,0)
 S RCPAYRDF=$G(^TMP("RCDPE_APAR_EEOB_PARAMS",$J,"RCPAYR"))
"RTN","RCDPEAA1",217,0)
 S RCQUIT=0
"RTN","RCDPEAA1",218,0)
 K DIR
"RTN","RCDPEAA1",219,0)
 S DIR(0)="SA^A:ALL;R:RANGE"
"RTN","RCDPEAA1",220,0)
 S DIR("A")="(A)LL payers, (R)ANGE of payer names: "
"RTN","RCDPEAA1",221,0)
 S DIR("B")="ALL"
"RTN","RCDPEAA1",222,0)
 S DIR("?",1)="Entering ALL will select all payers."
"RTN","RCDPEAA1",223,0)
 S DIR("?")="If RANGE is entered, you will be prompted for a payer range."
"RTN","RCDPEAA1",224,0)
 S:$P(RCPAYRDF,"^")'="" DIR("B")=$P(RCPAYRDF,"^")  ;Stored preferred view, use as default
"RTN","RCDPEAA1",225,0)
 W !
"RTN","RCDPEAA1",226,0)
 D ^DIR
"RTN","RCDPEAA1",227,0)
 I $D(DTOUT)!$D(DUOUT) S RCQUIT=1 Q
"RTN","RCDPEAA1",228,0)
 S RCPAYR=Y
"RTN","RCDPEAA1",229,0)
 I RCPAYR="A" S ^TMP("RCDPE_APAR_EEOB_PARAMS",$J,"RCPAYR")=Y Q
"RTN","RCDPEAA1",230,0)
 I RCPAYR="R" D  Q:RCQUIT
"RTN","RCDPEAA1",231,0)
 . W !,"Names you select here will be the payer names from the ERA, NOT the INS File"
"RTN","RCDPEAA1",232,0)
 . K DIR
"RTN","RCDPEAA1",233,0)
 . S DIR("?")="Enter a name between 1 and 30 characters in UPPERCASE"
"RTN","RCDPEAA1",234,0)
 . S DIR(0)="FA^1:30^K:X'?.U X",DIR("A")="Start with payer name: "
"RTN","RCDPEAA1",235,0)
 . S:$P(RCPAYRDF,"^",2)'="" DIR("B")=$P(RCPAYRDF,"^",2)  ;Stored preferred view, use as default
"RTN","RCDPEAA1",236,0)
 . W !
"RTN","RCDPEAA1",237,0)
 . D ^DIR
"RTN","RCDPEAA1",238,0)
 . I $D(DTOUT)!$D(DUOUT) D  Q
"RTN","RCDPEAA1",239,0)
 . . S RCQUIT=1 Q
"RTN","RCDPEAA1",240,0)
 . . K ^TMP("RCDPE_APAR_EEOB_PARAMS",$J,"RCPAYR")
"RTN","RCDPEAA1",241,0)
 . S RCPAYR("FROM")=Y
"RTN","RCDPEAA1",242,0)
 . K DIR
"RTN","RCDPEAA1",243,0)
 . S DIR("?")="Enter a name between 1 and 30 characters in UPPERCASE"
"RTN","RCDPEAA1",244,0)
 . S DIR(0)="FA^1:30^K:X'?.U X",DIR("A")="Go to payer name: "
"RTN","RCDPEAA1",245,0)
 . S DIR("B")=$E(RCPAYR("FROM"),1,27)_"ZZZ"
"RTN","RCDPEAA1",246,0)
 . W ! D ^DIR K DIR
"RTN","RCDPEAA1",247,0)
 . I $D(DTOUT)!$D(DUOUT) S RCQUIT=1 Q
"RTN","RCDPEAA1",248,0)
 . S ^TMP("RCDPE_APAR_EEOB_PARAMS",$J,"RCPAYR")=RCPAYR_"^"_RCPAYR("FROM")_"^"_Y
"RTN","RCDPEAA1",249,0)
 Q
"RTN","RCDPEAA1",250,0)
 ;
"RTN","RCDPEAA1",251,0)
CLMTYP ; Ask for Medical or Pharmacy (Or Both)
"RTN","RCDPEAA1",252,0)
 ; Input:   ^TMP("RCDPE_APAR_EEOB_PARAMS",$J,"RCMEDRX") - Current Claim Type filter setting
"RTN","RCDPEAA1",253,0)
 ; Output:  ^TMP("RCDPE_APAR_EEOB_PARAMS",$J,"RCMEDRX") - Updated Claim Type filter setting
"RTN","RCDPEAA1",254,0)
 ;          ^TMP("RCDPE_APAR_PVW",$J)                   - Global array of preferred view settings
"RTN","RCDPEAA1",255,0)
 ;                                                        if user saves as preferred view
"RTN","RCDPEAA1",256,0)
 ;          RCQUIT=1  - User ^ or timed out
"RTN","RCDPEAA1",257,0)
 N DEF
"RTN","RCDPEAA1",258,0)
 S DEF=$G(^TMP("RCDPE_APAR_EEOB_PARAMS",$J,"RCMEDRX"))
"RTN","RCDPEAA1",259,0)
 S DEF=$S(DEF="P":"PHARMACY",DEF="M":"MEDICAL",1:"BOTH")
"RTN","RCDPEAA1",260,0)
 S RCQ=$$RTYPE^RCDPESP2(DEF)
"RTN","RCDPEAA1",261,0)
 I RCQ=-1 S RCQUIT=1 Q
"RTN","RCDPEAA1",262,0)
 S ^TMP("RCDPE_APAR_EEOB_PARAMS",$J,"RCMEDRX")=RCQ
"RTN","RCDPEAA1",263,0)
 D SAVEPVW
"RTN","RCDPEAA1",264,0)
 Q
"RTN","RCDPEAA1",265,0)
 ;
"RTN","RCDPEAA1",266,0)
SAVEPVW ; Option to save as User Preferred View
"RTN","RCDPEAA1",267,0)
 ; PRCA*4.5*317 added subroutine
"RTN","RCDPEAA1",268,0)
 ; Input: ^TMP("RCDPE_APAR_EEOB_PARAMS",$J) - Global array of current worklist settings
"RTN","RCDPEAA1",269,0)
 ; Output Current worklist settings set as preferred view (potentially)
"RTN","RCDPEAA1",270,0)
 ;        ^TMP("RCDPE_APAR_PVW",$J)         - Global array of preferred view settings
"RTN","RCDPEAA1",271,0)
 N DIR,DTOUT,DUOUT,RCERROR,XX
"RTN","RCDPEAA1",272,0)
 K DIR
"RTN","RCDPEAA1",273,0)
 W !
"RTN","RCDPEAA1",274,0)
 S DIR(0)="YA",DIR("B")="NO"
"RTN","RCDPEAA1",275,0)
 S DIR("A")="Do you want to save this as your preferred view (Y/N)? "
"RTN","RCDPEAA1",276,0)
 D ^DIR
"RTN","RCDPEAA1",277,0)
 Q:Y'=1
"RTN","RCDPEAA1",278,0)
 S XX=^TMP("RCDPE_APAR_EEOB_PARAMS",$J,"RCPAYR")
"RTN","RCDPEAA1",279,0)
 D EN^XPAR(DUZ_";VA(200,","RCDPE APAR","ALL_PAYERS/RANGE_OF_PAYERS",$TR(XX,"^",";"),.RCERROR)
"RTN","RCDPEAA1",280,0)
 S XX=^TMP("RCDPE_APAR_EEOB_PARAMS",$J,"RCMEDRX")
"RTN","RCDPEAA1",281,0)
 D EN^XPAR(DUZ_";VA(200,","RCDPE APAR","MEDICAL/PHARMACY",$TR(XX,"^",";"),.RCERROR)
"RTN","RCDPEAA1",282,0)
 ;
"RTN","RCDPEAA1",283,0)
 ;Capture new preferred settings for comparison
"RTN","RCDPEAA1",284,0)
 K ^TMP("RCDPE_APAR_PVW",$J)
"RTN","RCDPEAA1",285,0)
 M ^TMP("RCDPE_APAR_PVW",$J)=^TMP("RCDPE_APAR_EEOB_PARAMS",$J)
"RTN","RCDPEAA1",286,0)
 Q
"RTN","RCDPEAA1",287,0)
 ;
"RTN","RCDPEAA1",288,0)
FILTER(RCDA) ; Returns 1 if record in entry 344.4 passes
"RTN","RCDPEAA1",289,0)
 ; the edits for the APAR worklist selection of EEOBs
"RTN","RCDPEAA1",290,0)
 ; Parameters found in ^TMP("RCDPE_APAR_EEOB_PARAMS",$J)
"RTN","RCDPEAA1",291,0)
 ; 
"RTN","RCDPEAA1",292,0)
 ; input - RCDA = IEN OF 344.4
"RTN","RCDPEAA1",293,0)
 ; output - returns 1 or 0
"RTN","RCDPEAA1",294,0)
 N OK,RC0,RCPAYR,RCPAYFR,RCPAYTO,RCIEN,RCECME,RCERATYP
"RTN","RCDPEAA1",295,0)
 S OK=1,RC0=$G(^RCY(344.4,RCDA,0))
"RTN","RCDPEAA1",296,0)
 ;
"RTN","RCDPEAA1",297,0)
 S RCPAYR=$P($G(^TMP("RCDPE_APAR_EEOB_PARAMS",$J,"RCPAYR")),U),RCPAYFR=$P($G(^TMP("RCDPE_APAR_EEOB_PARAMS",$J,"RCPAYR")),U,2),RCPAYTO=$P($G(^TMP("RCDPE_APAR_EEOB_PARAMS",$J,"RCPAYR")),U,3)
"RTN","RCDPEAA1",298,0)
 S RCERATYP=$G(^TMP("RCDPE_APAR_EEOB_PARAMS",$J,"RCMEDRX"))
"RTN","RCDPEAA1",299,0)
 ; Payer name
"RTN","RCDPEAA1",300,0)
 I RCPAYR'="A" D  G:'OK FQ
"RTN","RCDPEAA1",301,0)
 . N Q
"RTN","RCDPEAA1",302,0)
 . S Q=$$UP^RCDPEARL($P(RC0,U,6))
"RTN","RCDPEAA1",303,0)
 . I $S(Q=RCPAYFR:1,Q=RCPAYTO:1,Q]RCPAYFR:RCPAYTO]Q,1:0) Q
"RTN","RCDPEAA1",304,0)
 . S OK=0
"RTN","RCDPEAA1",305,0)
 ; ERA Type (Medical/Pharmacy)
"RTN","RCDPEAA1",306,0)
 I RCERATYP'="B" D
"RTN","RCDPEAA1",307,0)
 . ; Check the first EOB in the ERA to see if it is a Pharmacy or Medical ERA
"RTN","RCDPEAA1",308,0)
 . S RCIEN=$O(^RCY(344.4,RCDA,1,0))
"RTN","RCDPEAA1",309,0)
 . I RCIEN="" S OK=0 Q
"RTN","RCDPEAA1",310,0)
 . S RCECME=$P($G(^RCY(344.4,RCDA,1,RCIEN,4)),U,2)
"RTN","RCDPEAA1",311,0)
 . ; If requested filter is Pharmacy and there is an ECME #, display
"RTN","RCDPEAA1",312,0)
 . I RCECME="",RCERATYP="M" Q
"RTN","RCDPEAA1",313,0)
 . ; If requested filter is Medical and there is no ECME #, display
"RTN","RCDPEAA1",314,0)
 . I RCECME'="",RCERATYP="P" Q
"RTN","RCDPEAA1",315,0)
 . ; Otherwise, not valid on the filter, don't display
"RTN","RCDPEAA1",316,0)
 . S OK=0
"RTN","RCDPEAA1",317,0)
FQ Q OK
"RTN","RCDPEAA1",318,0)
 ;
"RTN","RCDPEAA1",319,0)
ENTEREOB ; Enter the APAR EEOB SCRATCHPAD
"RTN","RCDPEAA1",320,0)
 N X,RCDA,RCDA1,XQORM,RCIENS
"RTN","RCDPEAA1",321,0)
 S RCIENS=$$SEL()
"RTN","RCDPEAA1",322,0)
 I 'RCIENS G EOBQ
"RTN","RCDPEAA1",323,0)
 D EN^VALM("RCDPE APAR SELECTED EEOB")
"RTN","RCDPEAA1",324,0)
EOBQ ;
"RTN","RCDPEAA1",325,0)
 D INIT
"RTN","RCDPEAA1",326,0)
 S VALMBCK="R"
"RTN","RCDPEAA1",327,0)
 Q
"RTN","RCDPEAA1",328,0)
 ;
"RTN","RCDPEAA1",329,0)
SEL() ; Select an item from the APAR list of EEOBs
"RTN","RCDPEAA1",330,0)
 N RCDA,VALMY,RCITEMS
"RTN","RCDPEAA1",331,0)
 D FULL^VALM1
"RTN","RCDPEAA1",332,0)
 D EN^VALM2($G(XQORNOD(0)),"S")
"RTN","RCDPEAA1",333,0)
 S (RCSEQ,RCDA,RCITEMS)=0
"RTN","RCDPEAA1",334,0)
 F  S RCSEQ=$O(VALMY(RCSEQ)) Q:'RCSEQ  S RCITEMS=$P($G(^TMP("RCDPE-APAR_EEOB_WLDX",$J,RCSEQ)),U,2,3)_U_RCSEQ
"RTN","RCDPEAA1",335,0)
 Q RCITEMS
"RTN","RCDPEAA1",336,0)
 ;
"RTN","RCDPEAA1",337,0)
CV ;
"RTN","RCDPEAA1",338,0)
 ; Change View action for APAR pick list
"RTN","RCDPEAA1",339,0)
 D FULL^VALM1 D PARAMS("CV")
"RTN","RCDPEAA1",340,0)
 D HDR,INIT S VALMBCK="R",VALMBG=1
"RTN","RCDPEAA1",341,0)
 Q
"RTN","RCDPESP2")
0^7^B172938322^B171453792
"RTN","RCDPESP2",1,0)
RCDPESP2 ;BIRM/SAB - ePayment Lockbox Parameter Audit and Exclusion Reports ;07/01/15
"RTN","RCDPESP2",2,0)
 ;;4.5;Accounts Receivable;**298,304,317**;Mar 20, 1995;Build 8
"RTN","RCDPESP2",3,0)
 ;Per VA Directive 6402, this routine should not be modified.
"RTN","RCDPESP2",4,0)
 ;
"RTN","RCDPESP2",5,0)
 Q
"RTN","RCDPESP2",6,0)
 ;
"RTN","RCDPESP2",7,0)
RPT1 ; EDI Lockbox Parameters Report [RCDPE SITE PARAMETER REPORT]
"RTN","RCDPESP2",8,0)
 ;
"RTN","RCDPESP2",9,0)
 ; DESCRIPTION: This report is a simple listing of the RCDPE PARAMETER AUDIT file
"RTN","RCDPESP2",10,0)
 ;              including data concerning changes to the RCDPE PPARAMETER file.
"RTN","RCDPESP2",11,0)
 ;
"RTN","RCDPESP2",12,0)
 ; Input:       None
"RTN","RCDPESP2",13,0)
 ;
"RTN","RCDPESP2",14,0)
 ; GLOBALS:     ^RCY(344.7,              RCDPE PARAMETER AUDIT
"RTN","RCDPESP2",15,0)
 ;              ^TMP("RCDPESP2",$J,      TMP FILE FOR LIST^DIC OUTPUT
"RTN","RCDPESP2",16,0)
 ;
"RTN","RCDPESP2",17,0)
 ; GLOBALS:     ^RCY(344.7, - RCDPE PARAMETER AUDIT
"RTN","RCDPESP2",18,0)
 ;
"RTN","RCDPESP2",19,0)
 ; INPUT PARAMETERS: NONE
"RTN","RCDPESP2",20,0)
 ;
"RTN","RCDPESP2",21,0)
 ; LOCAL VARIABLES:
"RTN","RCDPESP2",22,0)
 ;    RCRANGE - RETURN VALUE FOR DATE RANGE FOR THE REPORT
"RTN","RCDPESP2",23,0)
 ;    RCSTDT  - STARTING DATE FOR THE REPORT
"RTN","RCDPESP2",24,0)
 ;    RCENDT  - END DATE FOR THE REPORT
"RTN","RCDPESP2",25,0)
 ;    RCEXCEL - INDIATES IF OUTPUT IS GOING TO EXCEL
"RTN","RCDPESP2",26,0)
 ;    RCSCR   - SCREEN FOR LIST^DIC CALL
"RTN","RCDPESP2",27,0)
 ;    RCFLDS  - FIELDS TO BE CAPTURED IN LIST^DIC CALL
"RTN","RCDPESP2",28,0)
 ;    RCDIGET   - ^TMP GLOBAL RESULTS FROM LIST^DIC CALL
"RTN","RCDPESP2",29,0)
 ;    RCDIERR   - HOLDS ERRORS FROM LIST^DIC
"RTN","RCDPESP2",30,0)
 ;    RCHDR("RUNDATE")   - DATE THE REPORT RAN
"RTN","RCDPESP2",31,0)
 ;    RCHDR("PAGE")  - PAGE COUNTER
"RTN","RCDPESP2",32,0)
 ;    RCSTOP  - STOP DISPLAYING THE REPORT
"RTN","RCDPESP2",33,0)
 ;    RCPARAM - PARAMETER THAT WAS CHANGED
"RTN","RCDPESP2",34,0)
 ;    RCPARAM("OLDVAL")   - OLD PARAMETER VALUE
"RTN","RCDPESP2",35,0)
 ;    RCPARAM("TIME")  - TIME PARAMETER WAS CHANGED
"RTN","RCDPESP2",36,0)
 ;    RCPARAM("NEWVAL")   - NEW PARAMETER VALUE
"RTN","RCDPESP2",37,0)
 ;    RCPARAM("USER")  - USER WHO CHANGED A PARAMETER
"RTN","RCDPESP2",38,0)
 ;    RCTMP   - HOLDS ONE LINE OF DATA FROM LIST^DIC OUTPUT
"RTN","RCDPESP2",39,0)
 ;    RCTYPE  - TYPE OF REPORT TO RUN (MEDICAL, PHARMACY, OR BOTH)
"RTN","RCDPESP2",40,0)
 ;
"RTN","RCDPESP2",41,0)
 N RCDIERR,RCDIGET,RCENDT,RCEXCEL,RCFLDS,RCHDR,RCIEN,RCPARAM,RCRANGE,RCSCR,RCSTDT,RCSTOP,RCTMP,RCTYPE,RCFILE,RCSL
"RTN","RCDPESP2",42,0)
 ; Kernel variables
"RTN","RCDPESP2",43,0)
 N X1,X2,X,Y,%ZIS,POP
"RTN","RCDPESP2",44,0)
 S RCSTOP=0,RCSL=0
"RTN","RCDPESP2",45,0)
 W !!,"EDI Lockbox Parameters Audit Report",!
"RTN","RCDPESP2",46,0)
 ;
"RTN","RCDPESP2",47,0)
 S (RCHDR("PAGE"),RCSTOP,RCHDR,RCEXCEL)=0
"RTN","RCDPESP2",48,0)
 ;
"RTN","RCDPESP2",49,0)
 ; retrieve report type (Medical, Pharmacy, or Both)
"RTN","RCDPESP2",50,0)
 S RCTYPE=$$RTYPE()
"RTN","RCDPESP2",51,0)
 Q:RCTYPE=-1
"RTN","RCDPESP2",52,0)
 S RCHDR("REPORTTYPE")=RCTYPE
"RTN","RCDPESP2",53,0)
 ;
"RTN","RCDPESP2",54,0)
 S RCRANGE=$$DTRNG()
"RTN","RCDPESP2",55,0)
 Q:RCRANGE=0
"RTN","RCDPESP2",56,0)
 S RCSTDT=$P(RCRANGE,U,2),RCENDT=$P(RCRANGE,U,3)
"RTN","RCDPESP2",57,0)
 S RCEXCEL=$$DISPTY^RCDPEM3() Q:+RCEXCEL=-1
"RTN","RCDPESP2",58,0)
 ; Display capture information for Excel
"RTN","RCDPESP2",59,0)
 I RCEXCEL D INFO^RCDPEM6
"RTN","RCDPESP2",60,0)
 ;Select output device
"RTN","RCDPESP2",61,0)
 S %ZIS="M" D ^%ZIS Q:POP  U IO
"RTN","RCDPESP2",62,0)
 ; INPUT PARAMETER:
"RTN","RCDPESP2",63,0)
 ;   RCEXCEL - IF 1 THEN OUTPUT FOR EXCEL
"RTN","RCDPESP2",64,0)
 ;
"RTN","RCDPESP2",65,0)
 S RCHDR("RUNDATE")=$$FMTE^XLFDT($$NOW^XLFDT,"5S")
"RTN","RCDPESP2",66,0)
 S RCHDR("DATERANGE")=$$FMTE^XLFDT(RCSTDT,"5D")_" - "_$$FMTE^XLFDT(RCENDT,"5D")
"RTN","RCDPESP2",67,0)
 ;
"RTN","RCDPESP2",68,0)
 S RCENDT=RCENDT+.999999
"RTN","RCDPESP2",69,0)
 ;S RCSCR="I ($P(^(0),U,5)=344.61)&($P(^(0),U,1)>"_RCSTDT_")&($P(^(0),U,1)<"_RCENDT_")"
"RTN","RCDPESP2",70,0)
 S RCSCR="I ($P(^(0),U,1)>"_RCSTDT_")&($P(^(0),U,1)<"_RCENDT_")"
"RTN","RCDPESP2",71,0)
 S RCFLDS="@;.04;.01I;.07;.06;.03;.05I;.02"
"RTN","RCDPESP2",72,0)
 S RCDIGET=$NA(^TMP("RCDPESP2",$J)) K @RCDIGET
"RTN","RCDPESP2",73,0)
 D LIST^DIC(344.7,,RCFLDS,"P",,,,,RCSCR,,RCDIGET,"RCDIERR")
"RTN","RCDPESP2",74,0)
 I $D(RCDIERR) W !!,"ERROR COLLECTING THE REPORT DATA" D ASK^RCDPEARL() Q
"RTN","RCDPESP2",75,0)
 I '$D(@RCDIGET@("DILIST",1)) D  Q
"RTN","RCDPESP2",76,0)
 . D HDRLPR(RCEXCEL,.RCHDR,.RCSTOP) S RCSL=9
"RTN","RCDPESP2",77,0)
 . W !,"NO PARAMETER AUDIT ENTRIES TO REPORT",!
"RTN","RCDPESP2",78,0)
 . D ASK^RCDPEARL(.RCSTOP)
"RTN","RCDPESP2",79,0)
 S RCIEN=0 F  S RCIEN=$O(@RCDIGET@("DILIST",RCIEN)) Q:RCSTOP!('RCIEN)  D
"RTN","RCDPESP2",80,0)
 . I 'RCHDR("PAGE") D
"RTN","RCDPESP2",81,0)
 . . D HDRLPR(RCEXCEL,.RCHDR,.RCSTOP) S RCSL=9
"RTN","RCDPESP2",82,0)
 . Q:RCSTOP
"RTN","RCDPESP2",83,0)
 . K RCPARAM
"RTN","RCDPESP2",84,0)
 . S RCTMP=$P(@RCDIGET@("DILIST",RCIEN,0),U,2,8)
"RTN","RCDPESP2",85,0)
 . S RCFILE=$P(RCTMP,U,6)
"RTN","RCDPESP2",86,0)
 . ;
"RTN","RCDPESP2",87,0)
 . Q:RCFILE=344.6  ; Excluded payers reported elswhere
"RTN","RCDPESP2",88,0)
 . ;
"RTN","RCDPESP2",89,0)
 . S RCPARAM=$$GET1^DID(RCFILE,$P(RCTMP,U,1),,"LABEL")
"RTN","RCDPESP2",90,0)
 . ;
"RTN","RCDPESP2",91,0)
 . Q:'$$RPTYPE(RCTYPE,RCPARAM)
"RTN","RCDPESP2",92,0)
 . S RCPARAM("TIME")=$$FMTE^XLFDT($P(RCTMP,U,2),"2")
"RTN","RCDPESP2",93,0)
 . S RCPARAM("USER")=$P(RCTMP,U,5)
"RTN","RCDPESP2",94,0)
 . I ($P(RCTMP,U,1)=.02)!($P(RCTMP,U,1)=1.01) D
"RTN","RCDPESP2",95,0)
 . . I RCFILE=344.62 S RCPARAM=RCPARAM_" ("_$S($P(RCTMP,U,7)'="":$P($G(^RCY(RCFILE,$P(RCTMP,U,7),0)),U,1),1:"ERR")_")"
"RTN","RCDPESP2",96,0)
 . . S RCPARAM("OLDVAL")=$S(+$P(RCTMP,U,3)=0:"No",+$P(RCTMP,U,3)=1:"Yes",1:"Err")
"RTN","RCDPESP2",97,0)
 . . S RCPARAM("NEWVAL")=$S(+$P(RCTMP,U,4)=0:"No",+$P(RCTMP,U,4)=1:"Yes",1:"Err")
"RTN","RCDPESP2",98,0)
 . I ($P(RCTMP,U,1)=.03)!($P(RCTMP,U,1)=7.05)!($P(RCTMP,U,1)=7.06) D
"RTN","RCDPESP2",99,0)
 . . S RCPARAM("OLDVAL")=$S($P(RCTMP,U,3):"Yes",1:"No")
"RTN","RCDPESP2",100,0)
 . . S RCPARAM("NEWVAL")=$S($P(RCTMP,U,4):"Yes",1:"No")
"RTN","RCDPESP2",101,0)
 . I (RCFILE=344.62)&($P(RCTMP,U,1)=.06) D
"RTN","RCDPESP2",102,0)
 . . S RCPARAM=RCPARAM_" ("_$S($P(RCTMP,U,7)'="":$P($G(^RCY(RCFILE,$P(RCTMP,U,7),0)),U,1),1:"ERR")_")"
"RTN","RCDPESP2",103,0)
 . I ($P(RCTMP,U,1)'=.02),($P(RCTMP,U,1)'=.03),($P(RCTMP,U,1)'=1.01),($P(RCTMP,U,1)'=7.05),($P(RCTMP,U,1)'=7.06) D
"RTN","RCDPESP2",104,0)
 . . S RCPARAM("OLDVAL")=$P(RCTMP,U,3)
"RTN","RCDPESP2",105,0)
 . . S RCPARAM("NEWVAL")=$P(RCTMP,U,4)
"RTN","RCDPESP2",106,0)
 . I 'RCEXCEL D
"RTN","RCDPESP2",107,0)
 . . W !,RCPARAM,?32,RCPARAM("TIME"),?51,RCPARAM("OLDVAL"),?56,RCPARAM("NEWVAL"),?61,$E(RCPARAM("USER"),1,IOM-61) S RCSL=RCSL+1
"RTN","RCDPESP2",108,0)
 . . I RCSL>=(IOSL-2) D HDRLPR(RCEXCEL,.RCHDR,.RCSTOP) Q:RCSTOP  S RCSL=9
"RTN","RCDPESP2",109,0)
 . I RCEXCEL W !,RCPARAM_U_RCPARAM("TIME")_U_RCPARAM("OLDVAL")_U_RCPARAM("NEWVAL")_U_RCPARAM("USER")
"RTN","RCDPESP2",110,0)
 ;
"RTN","RCDPESP2",111,0)
 ; end of report
"RTN","RCDPESP2",112,0)
 I 'RCSTOP W !!,$$ENDORPRT^RCDPEARL D ASK^RCDPEARL(.RCSTOP)
"RTN","RCDPESP2",113,0)
RPT1Q K @RCDIGET
"RTN","RCDPESP2",114,0)
 Q
"RTN","RCDPESP2",115,0)
 ;
"RTN","RCDPESP2",116,0)
HDRLPR(RCEXCEL,RCHDR,RCSTOP) ; Report header Lockbox Parameter Report
"RTN","RCDPESP2",117,0)
 ;   RCEXCEL - if true output for Excel
"RTN","RCDPESP2",118,0)
 ;   RCHDR("PAGE") - page count, passed by ref.
"RTN","RCDPESP2",119,0)
 ;   RCSTOP  - report exit flag
"RTN","RCDPESP2",120,0)
 ;   RCTYPE  - Type of report to run
"RTN","RCDPESP2",121,0)
 ;
"RTN","RCDPESP2",122,0)
 N RCTYPED
"RTN","RCDPESP2",123,0)
 S RCTYPED=$S(RCHDR("REPORTTYPE")="M":"MEDICAL",RCHDR("REPORTTYPE")="P":"PHARMACY",1:"ALL")
"RTN","RCDPESP2",124,0)
 ;
"RTN","RCDPESP2",125,0)
 I RCEXCEL D  Q  ; Excel header for PARAMETER AUDITS
"RTN","RCDPESP2",126,0)
 .Q:RCHDR("PAGE")
"RTN","RCDPESP2",127,0)
 .W !,"PARAMETER^DATE/TIME EDITED^OLD VALUE^NEW VALUE^USER"
"RTN","RCDPESP2",128,0)
 .S RCHDR("PAGE")=1  ; only print once
"RTN","RCDPESP2",129,0)
 ;
"RTN","RCDPESP2",130,0)
 I 'RCEXCEL D
"RTN","RCDPESP2",131,0)
 .I RCHDR("PAGE") D ASK^RCDPEARL(.RCSTOP) Q:RCSTOP
"RTN","RCDPESP2",132,0)
 .W @IOF
"RTN","RCDPESP2",133,0)
 .S RCHDR("PAGE")=RCHDR("PAGE")+1
"RTN","RCDPESP2",134,0)
 . W $$CNTR("EDI Lockbox Parameter Audit Report"),?IOM-8,"Page: "_RCHDR("PAGE")
"RTN","RCDPESP2",135,0)
 . W !,$$CNTR("RUN DATE: "_RCHDR("RUNDATE"))
"RTN","RCDPESP2",136,0)
 . W !,$$CNTR("DATE RANGE: "_RCHDR("DATERANGE"))
"RTN","RCDPESP2",137,0)
 . W !,$$CNTR("REPORT TYPE: "_RCTYPED)
"RTN","RCDPESP2",138,0)
 . W !!,"LOCKBOX PARAMETER UPDATES"
"RTN","RCDPESP2",139,0)
 . W !,"-------------------------                           Values"
"RTN","RCDPESP2",140,0)
 . W !,"Parameter                       Date/Time Edited   Old  New  User"
"RTN","RCDPESP2",141,0)
 . N I S $P(I,"=",IOM+1)="" W !,I
"RTN","RCDPESP2",142,0)
 Q
"RTN","RCDPESP2",143,0)
 ;
"RTN","RCDPESP2",144,0)
RPT2 ; EDI Lockbox Exclusion Audit Report [RCDPE EXCLUSION AUDIT REPORT]
"RTN","RCDPESP2",145,0)
 ;
"RTN","RCDPESP2",146,0)
 ; DESCRIPTION: This report is a simple listing of the RCDPE PARAMETER AUDIT file
"RTN","RCDPESP2",147,0)
 ;              including data concerning changes to the RCDPE AUTO-PAY EXCLUSION file.
"RTN","RCDPESP2",148,0)
 ;
"RTN","RCDPESP2",149,0)
 ; GLOBALS:     ^RCY(344.7,              RCDPE PARAMETER AUDIT
"RTN","RCDPESP2",150,0)
 ;              ^RCY(344.6,              RCDPE AUTO-PAY EXCLUSION
"RTN","RCDPESP2",151,0)
 ;              ^TMP("RCDPESP2",$J,      TMP FILE FOR LIST DIC OUTPUT
"RTN","RCDPESP2",152,0)
 ;
"RTN","RCDPESP2",153,0)
 ; INPUT PARAMETERS: NONE
"RTN","RCDPESP2",154,0)
 ;
"RTN","RCDPESP2",155,0)
 ; LOCAL VARIABLES:
"RTN","RCDPESP2",156,0)
 ;    RCRANGE - date range for report
"RTN","RCDPESP2",157,0)
 ;    RCSTDT  - report start date
"RTN","RCDPESP2",158,0)
 ;    RCENDT  - report end date
"RTN","RCDPESP2",159,0)
 ;    RCEXCEL - true if report in Excel format
"RTN","RCDPESP2",160,0)
 ;    RCSCR - screening logic for LIST^DIC
"RTN","RCDPESP2",161,0)
 ;    RCFLDS  - fields for LIST^DIC
"RTN","RCDPESP2",162,0)
 ;    RCDIGET - storage for results from LIST^DIC
"RTN","RCDPESP2",163,0)
 ;    RCDIERR - errors from LIST^DIC
"RTN","RCDPESP2",164,0)
 ;    RCHDR("PAGE")  - page counter
"RTN","RCDPESP2",165,0)
 ;    RCHDR("RUNDATE") - date/time report was run 
"RTN","RCDPESP2",166,0)
 ;    RCSTOP  - report exit flag
"RTN","RCDPESP2",167,0)
 ;    RCPARAM - parameter that was changed
"RTN","RCDPESP2",168,0)
 ;    RCPARAM("TIME")   - time parameter changed
"RTN","RCDPESP2",169,0)
 ;    RCPARAM("OLDVAL") - old parameter value
"RTN","RCDPESP2",170,0)
 ;    RCPARAM("NEWVAL") - new parameter value
"RTN","RCDPESP2",171,0)
 ;    RCPARAM("USER")  - USER WHO CHANGED A PARAMETER
"RTN","RCDPESP2",172,0)
 ;    RCTMP - one record from LIST^DIC
"RTN","RCDPESP2",173,0)
 ;    RCFND - flag indicating records returned
"RTN","RCDPESP2",174,0)
 ;    RCTYPE  - TYPE OF REPORT TO RUN (MEDICAL, PHARMACY, OR BOTH)
"RTN","RCDPESP2",175,0)
 ;
"RTN","RCDPESP2",176,0)
 W !!,"   EDI Lockbox Exclusion Audit Report",!
"RTN","RCDPESP2",177,0)
 ;
"RTN","RCDPESP2",178,0)
 N RCENDT,RCEXCEL,RCFLDS,RCFND,RCDIGET,RCHDR,RCIEN,RCDIERR,RCPARAM,RCRANGE,RCSCR,RCSTDT,RCSTOP,RCTMP,RCTYPE,RCSCRTYP,RCDIMED,RCDIRX
"RTN","RCDPESP2",179,0)
 ; Kernel variables
"RTN","RCDPESP2",180,0)
 N X1,X2,X,Y,%ZIS,POP
"RTN","RCDPESP2",181,0)
 ; initialize values
"RTN","RCDPESP2",182,0)
 S (RCHDR("PAGE"),RCSTOP,RCIEN,RCEXCEL,RCFND)=0
"RTN","RCDPESP2",183,0)
 S RCDIGET=$NA(^TMP("RCDPESP2",$J)) K @RCDIGET
"RTN","RCDPESP2",184,0)
 ; PRCA*4.5*304 - Medical and RX audit entries
"RTN","RCDPESP2",185,0)
 S RCDIMED=$NA(^TMP("RCDPESP2-MED",$J)) K @RCDIMED
"RTN","RCDPESP2",186,0)
 S RCDIRX=$NA(^TMP("RCDPESP2-RX",$J)) K @RCDIRX
"RTN","RCDPESP2",187,0)
 ;
"RTN","RCDPESP2",188,0)
 S RCTYPE=$$RTYPE()
"RTN","RCDPESP2",189,0)
 Q:RCTYPE=-1
"RTN","RCDPESP2",190,0)
 S RCHDR("REPORTTYPE")=RCTYPE
"RTN","RCDPESP2",191,0)
 ;
"RTN","RCDPESP2",192,0)
 ; GET DATE RANGES
"RTN","RCDPESP2",193,0)
 S RCRANGE=$$DTRNG()
"RTN","RCDPESP2",194,0)
 Q:RCRANGE=0
"RTN","RCDPESP2",195,0)
 S RCSTDT=$P(RCRANGE,U,2)-.0000001,RCENDT=$P(RCRANGE,U,3)+.9999999
"RTN","RCDPESP2",196,0)
 ;
"RTN","RCDPESP2",197,0)
 ; output fields for LIST^DIC
"RTN","RCDPESP2",198,0)
 S RCFLDS="@;.04;.01I;.06;.03;.08;.02"
"RTN","RCDPESP2",199,0)
 ; .04 - CHANGED FIELD  .01 - TIMESTAMP      .06 - NEW VALUE
"RTN","RCDPESP2",200,0)
 ; .03 - CHANGED BY     .08 - COMMENT        .02 - MODIFIED IEN
"RTN","RCDPESP2",201,0)
 ;
"RTN","RCDPESP2",202,0)
 ; first part of LIST^DIC screening logic
"RTN","RCDPESP2",203,0)
 S RCSCR="I ($P(^(0),U,5)=344.6)&($P(^(0),U,1)>"_RCSTDT_")&($P(^(0),U,1)<"_RCENDT_")"
"RTN","RCDPESP2",204,0)
 ;
"RTN","RCDPESP2",205,0)
 ; OUTPUT TO EXCEL?
"RTN","RCDPESP2",206,0)
 S RCEXCEL=$$DISPTY^RCDPEM3() Q:+RCEXCEL=-1
"RTN","RCDPESP2",207,0)
 I RCEXCEL D INFO^RCDPEM6
"RTN","RCDPESP2",208,0)
 ;
"RTN","RCDPESP2",209,0)
 ;Select output device
"RTN","RCDPESP2",210,0)
 S %ZIS="M" D ^%ZIS Q:POP  U IO
"RTN","RCDPESP2",211,0)
 ;
"RTN","RCDPESP2",212,0)
 S RCHDR("RUNDATE")=$$FMTE^XLFDT($$NOW^XLFDT,"5S")
"RTN","RCDPESP2",213,0)
 ;
"RTN","RCDPESP2",214,0)
 ; PROCESS AUTO-POST EXCLUSIONS
"RTN","RCDPESP2",215,0)
 ;
"RTN","RCDPESP2",216,0)
 ; PRCA*4.5*304 - Get the correct screening logic, based on the type of audit reeport to run
"RTN","RCDPESP2",217,0)
 S RCSCR(.06)=RCSCR_"&($P(^(0),U,4)=.06)" ; screening logic for medical auto-post
"RTN","RCDPESP2",218,0)
 S RCSCR(.07)=RCSCR_"&($P(^(0),U,4)=.07)" ; screening logic for medical auto-decrease
"RTN","RCDPESP2",219,0)
 S RCSCR(.08)=RCSCR_"&($P(^(0),U,4)=.08)" ; screening logic for pharmacy auto-post
"RTN","RCDPESP2",220,0)
 ;
"RTN","RCDPESP2",221,0)
 ;PRCA*4.5*304 - Get the medical and RX audit entries for Auto-Post exclusions
"RTN","RCDPESP2",222,0)
 D LIST^DIC(344.7,,RCFLDS,"P",,,,,RCSCR(.06),,RCDIMED,"RCDIERR")
"RTN","RCDPESP2",223,0)
 ; CHECK FOR AN ERROR
"RTN","RCDPESP2",224,0)
 I $D(RCDIERR) W !!,"Error collecting auto-post report data." D ASK^RCDPEARL(.RCSTOP) Q
"RTN","RCDPESP2",225,0)
 ;
"RTN","RCDPESP2",226,0)
 ; Get the correct screening logic, based on the type of audit to run
"RTN","RCDPESP2",227,0)
 D LIST^DIC(344.7,,RCFLDS,"P",,,,,RCSCR(.07),,RCDIGET,"RCDIERR")
"RTN","RCDPESP2",228,0)
 ;
"RTN","RCDPESP2",229,0)
 ; CHECK FOR AN ERROR
"RTN","RCDPESP2",230,0)
 I $D(RCDIERR) W !!,"Error collecting auto-decrease report data." D ASK^RCDPEARL(.RCSTOP) Q
"RTN","RCDPESP2",231,0)
 ;
"RTN","RCDPESP2",232,0)
 D LIST^DIC(344.7,,RCFLDS,"P",,,,,RCSCR(.08),,RCDIRX,"RCDIERR")
"RTN","RCDPESP2",233,0)
 ; CHECK FOR AN ERROR
"RTN","RCDPESP2",234,0)
 I $D(RCDIERR) W !!,"Error collecting auto-post report data." D ASK^RCDPEARL(.RCSTOP) Q
"RTN","RCDPESP2",235,0)
 ;
"RTN","RCDPESP2",236,0)
 I (RCTYPE="B")!(RCTYPE="M") D  G:RCSTOP RPT2Q
"RTN","RCDPESP2",237,0)
 . D HDRXAR(.06,RCTYPE)  ; complete header
"RTN","RCDPESP2",238,0)
 . ;
"RTN","RCDPESP2",239,0)
 . S RCFND=$D(@RCDIMED@("DILIST",1))  ; CHECK FOR RECORDS RETURNED
"RTN","RCDPESP2",240,0)
 . I 'RCFND W !,"No Auto-post Exclusions to Display",!
"RTN","RCDPESP2",241,0)
 . ;
"RTN","RCDPESP2",242,0)
 . I RCFND S RCIEN=0 D
"RTN","RCDPESP2",243,0)
 .. F  S RCIEN=$O(@RCDIMED@("DILIST",RCIEN)) Q:RCSTOP!('RCIEN)  D
"RTN","RCDPESP2",244,0)
 ... S RCTMP=$P(@RCDIMED@("DILIST",RCIEN,0),U,2,7)
"RTN","RCDPESP2",245,0)
 ... I 'RCEXCEL,$Y+4>IOSL D HDRXAR(.06,RCTYPE) Q:RCSTOP
"RTN","RCDPESP2",246,0)
 ... D DSPXCLSN(RCTMP)
"RTN","RCDPESP2",247,0)
 . ; PROCESS MEDICAL AUTO-DECREASE EXCLUSIONS
"RTN","RCDPESP2",248,0)
 . D  ; complete header or just the section
"RTN","RCDPESP2",249,0)
 .. I $Y+11<IOSL D SECTHDR(.07)  Q  ; just section header
"RTN","RCDPESP2",250,0)
 .. D HDRXAR(.07,RCTYPE)  ; complete header
"RTN","RCDPESP2",251,0)
 . ;
"RTN","RCDPESP2",252,0)
 . S RCFND=$D(@RCDIGET@("DILIST",1))  ; CHECK FOR RECORDS RETURNED
"RTN","RCDPESP2",253,0)
 . I 'RCFND W !,"No Auto-decrease Exclusions to Display",!
"RTN","RCDPESP2",254,0)
 . ; RECORDS RETURNED
"RTN","RCDPESP2",255,0)
 . I RCFND S RCIEN=0 F  S RCIEN=$O(@RCDIGET@("DILIST",RCIEN)) Q:RCSTOP!('RCIEN)  D
"RTN","RCDPESP2",256,0)
 .. S RCTMP=$P(@RCDIGET@("DILIST",RCIEN,0),U,2,7)
"RTN","RCDPESP2",257,0)
 .. I $Y+4>IOSL D HDRXAR(.07,RCTYPE) Q:RCSTOP
"RTN","RCDPESP2",258,0)
 .. D DSPXCLSN(RCTMP)
"RTN","RCDPESP2",259,0)
 ;
"RTN","RCDPESP2",260,0)
 I (RCTYPE="B")!(RCTYPE="P") D  G:RCSTOP RPT2Q
"RTN","RCDPESP2",261,0)
 . I RCTYPE="P" D HDRXAR(.08,RCTYPE)  ; complete header
"RTN","RCDPESP2",262,0)
 . I RCTYPE'="P" D  ; complete header or just the section
"RTN","RCDPESP2",263,0)
 .. I $Y+11<IOSL D SECTHDR(.08)  Q  ; just section header
"RTN","RCDPESP2",264,0)
 .. D HDRXAR(.08,RCTYPE)  ; complete header
"RTN","RCDPESP2",265,0)
 . ;
"RTN","RCDPESP2",266,0)
 . S RCFND=$D(@RCDIRX@("DILIST",1))  ; CHECK FOR RECORDS RETURNED
"RTN","RCDPESP2",267,0)
 . I 'RCFND W !,"No Auto-decrease Exclusions to Display",!
"RTN","RCDPESP2",268,0)
 . ; RECORDS RETURNED
"RTN","RCDPESP2",269,0)
 . I RCFND S RCIEN=0 F  S RCIEN=$O(@RCDIRX@("DILIST",RCIEN)) Q:RCSTOP!('RCIEN)  D
"RTN","RCDPESP2",270,0)
 .. S RCTMP=$P(@RCDIRX@("DILIST",RCIEN,0),U,2,7)
"RTN","RCDPESP2",271,0)
 .. I $Y+4>IOSL D HDRXAR(.08,RCTYPE) Q:RCSTOP
"RTN","RCDPESP2",272,0)
 .. D DSPXCLSN(RCTMP)
"RTN","RCDPESP2",273,0)
 ;
"RTN","RCDPESP2",274,0)
 ; end of report
"RTN","RCDPESP2",275,0)
 W !!,$$ENDORPRT^RCDPEARL
"RTN","RCDPESP2",276,0)
 D ASK^RCDPEARL(.RCSTOP)
"RTN","RCDPESP2",277,0)
 ;
"RTN","RCDPESP2",278,0)
RPT2Q ;
"RTN","RCDPESP2",279,0)
 K @RCDIGET,@RCDIMED,@RCDIRX  ; clean up
"RTN","RCDPESP2",280,0)
 Q
"RTN","RCDPESP2",281,0)
 ;
"RTN","RCDPESP2",282,0)
GETPAYER() ; GET THE PAYER NAME + PAYER ID
"RTN","RCDPESP2",283,0)
 N RCIEN,RCPAYR
"RTN","RCDPESP2",284,0)
 S RCIEN=$P(RCTMP,U,6)
"RTN","RCDPESP2",285,0)
 I '$D(^RCY(344.6,RCIEN)) Q ""
"RTN","RCDPESP2",286,0)
 S RCPAYR=$$GET1^DIQ(344.6,RCIEN_",",.01)_" "_$$GET1^DIQ(344.6,RCIEN_",",.02)
"RTN","RCDPESP2",287,0)
 Q RCPAYR
"RTN","RCDPESP2",288,0)
 ;
"RTN","RCDPESP2",289,0)
HDRXAR(RCTYP,RCTYPD) ; Report header for exclusin auto report
"RTN","RCDPESP2",290,0)
 ;   RCTYP -   .06 = AUTO-POSTING EXCLUSION (medical)
"RTN","RCDPESP2",291,0)
 ;             .07 = AUTO-DECREASE EXCLUSION (medical)
"RTN","RCDPESP2",292,0)
 ;             .08 = AUTO-POSTING EXCLUSION (pharmacy)
"RTN","RCDPESP2",293,0)
 ;   RCTYPD  - M = Medical
"RTN","RCDPESP2",294,0)
 ;             P = Pharmacy
"RTN","RCDPESP2",295,0)
 ;             B = Both
"RTN","RCDPESP2",296,0)
 ;
"RTN","RCDPESP2",297,0)
 N RCTYPED
"RTN","RCDPESP2",298,0)
 S RCTYPED=$S(RCTYPD="M":"MEDICAL",RCTYPD="P":"PHARMACY",1:"ALL")
"RTN","RCDPESP2",299,0)
 ;
"RTN","RCDPESP2",300,0)
 I RCEXCEL D  Q
"RTN","RCDPESP2",301,0)
 .Q:RCHDR("PAGE")
"RTN","RCDPESP2",302,0)
 .; Excel header for parameter audits
"RTN","RCDPESP2",303,0)
 .W !!,"TYPE^CHANGE^PAYER^TIMESTAMP^USER^COMMENT"
"RTN","RCDPESP2",304,0)
 .S RCHDR("PAGE")=1  ; only print it once
"RTN","RCDPESP2",305,0)
 ;
"RTN","RCDPESP2",306,0)
 I RCHDR("PAGE") D ASK^RCDPEARL(.RCSTOP) Q:RCSTOP
"RTN","RCDPESP2",307,0)
 W @IOF
"RTN","RCDPESP2",308,0)
 S RCHDR("PAGE")=RCHDR("PAGE")+1
"RTN","RCDPESP2",309,0)
 ; report header for parameter audits
"RTN","RCDPESP2",310,0)
 W $$CNTR("EDI Lockbox Exclusion Audit Report"),?IOM-8,"Page: "_RCHDR("PAGE")
"RTN","RCDPESP2",311,0)
 W !,$$CNTR("DIVISIONS: ALL")
"RTN","RCDPESP2",312,0)
 W !,$$CNTR("RUN DATE: "_$G(RCHDR("RUNDATE")))
"RTN","RCDPESP2",313,0)
 W !,$$CNTR("DATE RANGE: "_$$FMTE^XLFDT($P(RCRANGE,U,2),"5D")_" - "_$$FMTE^XLFDT($P(RCRANGE,U,3),"5D"))
"RTN","RCDPESP2",314,0)
 W !,$$CNTR("REPORT TYPE: "_RCTYPED)
"RTN","RCDPESP2",315,0)
 D SECTHDR(RCTYP,RCTYPD)
"RTN","RCDPESP2",316,0)
 Q
"RTN","RCDPESP2",317,0)
 ;
"RTN","RCDPESP2",318,0)
SECTHDR(RCTYPE,RCREPT) ; SECTION HEADER
"RTN","RCDPESP2",319,0)
 ;   RCTYP - .06 = AUTO-POSTING EXCLUSION (medical)
"RTN","RCDPESP2",320,0)
 ;           .07 = AUTO-DECREASE EXCLUSION (medical)
"RTN","RCDPESP2",321,0)
 ;           .08 = AUTO-POSTING EXCLUSION (pharmacy)
"RTN","RCDPESP2",322,0)
 ;   RCREPT - "M" = "MEDICAL"
"RTN","RCDPESP2",323,0)
 ;            "P" = "PHARMACY"
"RTN","RCDPESP2",324,0)
 Q:$G(RCEXCEL)
"RTN","RCDPESP2",325,0)
 ;
"RTN","RCDPESP2",326,0)
 I RCTYPE=.06 D
"RTN","RCDPESP2",327,0)
 .W !!,"MEDICAL AUTO-POSTING PAYER EXCLUSION LIST"
"RTN","RCDPESP2",328,0)
 .W !,"-----------------------------------------"
"RTN","RCDPESP2",329,0)
 ;
"RTN","RCDPESP2",330,0)
 I RCTYPE=.07 D
"RTN","RCDPESP2",331,0)
 .W !!,"MEDICAL AUTO-DECREASE PAYER EXCLUSION LIST"
"RTN","RCDPESP2",332,0)
 .W !,"------------------------------------------"
"RTN","RCDPESP2",333,0)
 ;
"RTN","RCDPESP2",334,0)
  I RCTYPE=.08 D
"RTN","RCDPESP2",335,0)
 .W !!,"PHARMACY AUTO-POSTING PAYER EXCLUSION LIST"
"RTN","RCDPESP2",336,0)
 .W !,"------------------------------------------"
"RTN","RCDPESP2",337,0)
 ;
"RTN","RCDPESP2",338,0)
 W !,"Change Payer                            Date/Time Edited   User"
"RTN","RCDPESP2",339,0)
 W !,$TR($J("",IOM-1)," ","=")  ; row of equal signs
"RTN","RCDPESP2",340,0)
 Q
"RTN","RCDPESP2",341,0)
 ;
"RTN","RCDPESP2",342,0)
CNTR(TXT) ; center TXT
"RTN","RCDPESP2",343,0)
 Q $J("",IOM-$L(TXT)\2)_TXT
"RTN","RCDPESP2",344,0)
 ;
"RTN","RCDPESP2",345,0)
DTRNG() ; function, returns date range for the report
"RTN","RCDPESP2",346,0)
 N DIR,DUOUT,RNGFLG,X,Y,RCSTART,RCEND
"RTN","RCDPESP2",347,0)
 S (RCSTART,RCEND)=0 D DATES(.RCSTART,.RCEND)
"RTN","RCDPESP2",348,0)
 Q:RCSTART=-1 0
"RTN","RCDPESP2",349,0)
 Q:RCSTART "1^"_RCSTART_"^"_RCEND
"RTN","RCDPESP2",350,0)
 Q:'RCSTART "0^^"
"RTN","RCDPESP2",351,0)
 Q 0
"RTN","RCDPESP2",352,0)
 ;
"RTN","RCDPESP2",353,0)
DATES(BDATE,EDATE) ; Get a date range, both values passed by ref.
"RTN","RCDPESP2",354,0)
 N DIR,DTOUT,DUOUT,X,Y
"RTN","RCDPESP2",355,0)
 S (BDATE,EDATE)=0
"RTN","RCDPESP2",356,0)
 S DIR("?")="Enter the earliest AUDIT DATE to include on the report"
"RTN","RCDPESP2",357,0)
 S DIR(0)="DAO^:"_DT_":APE",DIR("A")="Report start date: " D ^DIR K DIR
"RTN","RCDPESP2",358,0)
 I $D(DTOUT)!$D(DUOUT)!(Y="") S BDATE=-1 Q
"RTN","RCDPESP2",359,0)
 S BDATE=Y K DIR,X,Y
"RTN","RCDPESP2",360,0)
 S DIR("?")="Enter the latest AUDIT DATE to include on the report"
"RTN","RCDPESP2",361,0)
 S DIR(0)="DAO^"_BDATE_":"_DT_":APE",DIR("A")="Report end date: ",DIR("B")=$$FMTE^XLFDT(DT)
"RTN","RCDPESP2",362,0)
 D ^DIR K DIR
"RTN","RCDPESP2",363,0)
 I $D(DTOUT)!$D(DUOUT)!(Y="") S BDATE=-1 Q
"RTN","RCDPESP2",364,0)
 S EDATE=Y
"RTN","RCDPESP2",365,0)
 Q
"RTN","RCDPESP2",366,0)
 ;
"RTN","RCDPESP2",367,0)
DSPXCLSN(RCX) ; display exclusion
"RTN","RCDPESP2",368,0)
 ; RCX - exclusion value from ^DIC call
"RTN","RCDPESP2",369,0)
 N RCXCLSN
"RTN","RCDPESP2",370,0)
 S RCXCLSN("CHANGE")=$S($P(RCX,U,3):"Added",1:"Removed")
"RTN","RCDPESP2",371,0)
 S RCXCLSN("TIME")=$$FMTE^XLFDT($P(RCX,U,2),"2")
"RTN","RCDPESP2",372,0)
 S RCXCLSN("USER")=$P(RCX,U,4)
"RTN","RCDPESP2",373,0)
 S RCXCLSN("PAYER")=$$GETPAYER
"RTN","RCDPESP2",374,0)
 S RCXCLSN("COMMENT")=$P(RCX,U,5)
"RTN","RCDPESP2",375,0)
 ;
"RTN","RCDPESP2",376,0)
 I 'RCEXCEL D  Q
"RTN","RCDPESP2",377,0)
 .N Y S Y=RCXCLSN("CHANGE"),$E(Y,9)=$E(RCXCLSN("PAYER"),1,30),$E(Y,41)=" "_RCXCLSN("TIME"),Y=Y_" "_RCXCLSN("USER")
"RTN","RCDPESP2",378,0)
 .W !,Y,!,"  Comment: "_RCXCLSN("COMMENT")
"RTN","RCDPESP2",379,0)
 ; Excel format
"RTN","RCDPESP2",380,0)
 S RCXCLSN("LABEL")=$$GET1^DID(344.6,$P(RCX,U,1),,"LABEL")
"RTN","RCDPESP2",381,0)
 W !,RCXCLSN("LABEL")_U_RCXCLSN("CHANGE")_U_RCXCLSN("PAYER")_U_RCXCLSN("TIME")_U_RCXCLSN("USER")_U_RCXCLSN("COMMENT")
"RTN","RCDPESP2",382,0)
 ;
"RTN","RCDPESP2",383,0)
 Q
"RTN","RCDPESP2",384,0)
 ;
"RTN","RCDPESP2",385,0)
 ;Retrieve the parameter for the type of information to display
"RTN","RCDPESP2",386,0)
RTYPE(DEF) ;EP from RCDPEAA1
"RTN","RCDPESP2",387,0)
 ; Input:   DEF     - Value to use a default
"RTN","RCDPESP2",388,0)
 ; Returns: -1      - User ^ or timed out
"RTN","RCDPESP2",389,0)
 ;           M      - User selected MEDICAL
"RTN","RCDPESP2",390,0)
 ;           P      - User selected PHARMACY
"RTN","RCDPESP2",391,0)
 ;           B      - User selected BOTH
"RTN","RCDPESP2",392,0)
 N DA,DIR,DTOUT,DUOUT,X,Y,DIRUT,DIROUT,RCTYPE
"RTN","RCDPESP2",393,0)
 S RCTYPE=""
"RTN","RCDPESP2",394,0)
 S DIR("?")="Enter the type of information to display on the report"
"RTN","RCDPESP2",395,0)
 S DIR(0)="SA^M:MEDICAL;P:PHARMACY;B:BOTH"
"RTN","RCDPESP2",396,0)
 S DIR("A")="(M)EDICAL, (P)HARMACY, or (B)OTH: "    ; PRCA*4.5*317 changed 'OR' to 'or'
"RTN","RCDPESP2",397,0)
 S DIR("B")=$S($G(DEF)'="":DEF,1:"BOTH")
"RTN","RCDPESP2",398,0)
 D ^DIR
"RTN","RCDPESP2",399,0)
 K DIR
"RTN","RCDPESP2",400,0)
 I $D(DTOUT)!$D(DUOUT) Q -1
"RTN","RCDPESP2",401,0)
 Q:Y="" "B"
"RTN","RCDPESP2",402,0)
 Q $E(Y)
"RTN","RCDPESP2",403,0)
 ;
"RTN","RCDPESP2",404,0)
 ;Check to see if the Data element matches the report type
"RTN","RCDPESP2",405,0)
RPTYPE(RCTYPE,RCPARAM) ;
"RTN","RCDPESP2",406,0)
 ; Return 1 if valid to print, 0 otherwise
"RTN","RCDPESP2",407,0)
 N RCDATA,RCMEN,RCREN
"RTN","RCDPESP2",408,0)
 ;
"RTN","RCDPESP2",409,0)
 S (RCMEN,RCREN)=""
"RTN","RCDPESP2",410,0)
 ; Get Auto Decrease parameters
"RTN","RCDPESP2",411,0)
 I RCTYPE="M" S RCMEN=$P($G(^RCY(344.61,1,0)),U,3)
"RTN","RCDPESP2",412,0)
 I RCTYPE="P" S RCREN=$P($G(^RCY(344.61,1,1)),U,2)
"RTN","RCDPESP2",413,0)
 ;
"RTN","RCDPESP2",414,0)
 Q:RCTYPE="B" 1
"RTN","RCDPESP2",415,0)
 Q:(RCTYPE="M")&(RCPARAM["MED") 1       ; Medical Parameters
"RTN","RCDPESP2",416,0)
 Q:(RCTYPE="P")&(RCPARAM["RX") 1        ; Pharmacy parameters
"RTN","RCDPESP2",417,0)
 Q:(RCTYPE="P")&(RCPARAM["PHARM") 1        ; Pharmacy parameters
"RTN","RCDPESP2",418,0)
 Q:(RCTYPE="M")&(RCMEN)&(RCPARAM["DECREASE") 1         ; Auto-decrease for med is on
"RTN","RCDPESP2",419,0)
 Q:(RCTYPE="P")&(RCREN)&(RCPARAM["DECREASE") 1         ; Auto-decrease for pharmacy
"RTN","RCDPESP2",420,0)
 Q 0
"RTN","RCDPEWL")
0^2^B75411625^B68499983
"RTN","RCDPEWL",1,0)
RCDPEWL ;ALB/TMK/KML - ELECTRONIC EOB MESSAGE WORKLIST ;Jun 06, 2014@19:11:19
"RTN","RCDPEWL",2,0)
 ;;4.5;Accounts Receivable;**173,208,269,298,317**;Mar 20, 1995;Build 8
"RTN","RCDPEWL",3,0)
 ;Per VA Directive 6402, this routine should not be modified.
"RTN","RCDPEWL",4,0)
 ; IA for read access to ^IBM(361.1 = 4051
"RTN","RCDPEWL",5,0)
 ;
"RTN","RCDPEWL",6,0)
EN ; Main entry point
"RTN","RCDPEWL",7,0)
 N RCFASTXT,DA,DIC,X,Y,RCERA,RCNOED,RCQUIT  ;PRCA*4.5*317 Added RCQUIT
"RTN","RCDPEWL",8,0)
 D FULL^VALM1
"RTN","RCDPEWL",9,0)
 ;
"RTN","RCDPEWL",10,0)
 S DIR(0)="SA^L:LIST;S:SPECIFIC"
"RTN","RCDPEWL",11,0)
 S DIR("A")="Do you want a (L)IST of ERAs or a (S)PECIFIC one?: "
"RTN","RCDPEWL",12,0)
 S DIR("?",1)="Enter LIST to see a list of ERAs."
"RTN","RCDPEWL",13,0)
 S DIR("?")="Enter SPECIFIC to see a selected ERA."
"RTN","RCDPEWL",14,0)
 S DIR("B")="LIST"
"RTN","RCDPEWL",15,0)
 W !
"RTN","RCDPEWL",16,0)
 D ^DIR
"RTN","RCDPEWL",17,0)
 K DIR
"RTN","RCDPEWL",18,0)
 Q:$D(DTOUT)!$D(DUOUT)
"RTN","RCDPEWL",19,0)
 I Y="S" D  Q
"RTN","RCDPEWL",20,0)
 . S DIC="^RCY(344.4,",DIC(0)="AEMQ"
"RTN","RCDPEWL",21,0)
 . D ^DIC
"RTN","RCDPEWL",22,0)
 . I Y>0 D WL^RCDPEWL7(+Y)
"RTN","RCDPEWL",23,0)
 ;
"RTN","RCDPEWL",24,0)
 ; Calling Preferred View API in Menu Option Mode
"RTN","RCDPEWL",25,0)
 D PARAMS^RCDPEWL0("MO")
"RTN","RCDPEWL",26,0)
 Q:$G(RCQUIT)
"RTN","RCDPEWL",27,0)
 D EN^VALM("RCDPE WORKLIST ERA LIST")
"RTN","RCDPEWL",28,0)
 Q
"RTN","RCDPEWL",29,0)
 ;
"RTN","RCDPEWL",30,0)
DISP(RCERA,RCNOED) ; Entry to worklist from receipt processing
"RTN","RCDPEWL",31,0)
 ;  RCERA = ien of entry in file 344.49
"RTN","RCDPEWL",32,0)
 ; RCNOED = 1 if receipt exists/no editing allowed
"RTN","RCDPEWL",33,0)
 ;        = 2 if no edit and called from receipt processing
"RTN","RCDPEWL",34,0)
 ;  ; prca*4.5*298 - added AUTOPOST input argument
"RTN","RCDPEWL",35,0)
 ; AUTOPOST = "" if ERA is non-autopost
"RTN","RCDPEWL",36,0)
 ;          = 0  if auto-posted ERA is in UNPOSTED status
"RTN","RCDPEWL",37,0)
 ;          = 1 if auto-posted ERA is in PARTIAL posted status
"RTN","RCDPEWL",38,0)
 ;          = 2 if auto-posted ERA is in COMPLETE status
"RTN","RCDPEWL",39,0)
 ;
"RTN","RCDPEWL",40,0)
 N DUOUT,DTOUT,DIC,DIK,X,Y,DIR,RCQUIT,DA,DIE,DR,RCSCR,RC0,RC5,RCDAT,RCUNM
"RTN","RCDPEWL",41,0)
 ;
"RTN","RCDPEWL",42,0)
 S RCSCR("NOEDIT")=+$G(RCNOED)
"RTN","RCDPEWL",43,0)
 S RCQUIT=0,RC0=$G(^RCY(344.4,RCERA,0)),RC5=$G(^RCY(344.4,RCERA,5))
"RTN","RCDPEWL",44,0)
 I 'RCSCR("NOEDIT"),'$O(^RCY(344.49,"B",RCERA,0)) D  G:RCQUIT DISPQ
"RTN","RCDPEWL",45,0)
 . ;allow additional selections
"RTN","RCDPEWL",46,0)
 . S DIR("A",1)="No worklist scratchpad entry exists for this ERA."
"RTN","RCDPEWL",47,0)
 . S DIR("A")="(C)reate scratchpad, (V)iew ERA details or (E)xit:"
"RTN","RCDPEWL",48,0)
 . S DIR(0)="SAO^C:CREATE SCRATCHPAD;V:VIEW ERA DETAILS;E:EXIT"
"RTN","RCDPEWL",49,0)
 . W ! D ^DIR K DIR
"RTN","RCDPEWL",50,0)
 . I (Y'="V")&(Y'="C")&(Y'="E") S RCERA=-1,RCQUIT=1 Q
"RTN","RCDPEWL",51,0)
 . I Y="V" S RCSCR=RCERA D PRERA1^RCDPEWL0 S RCERA=-1,RCQUIT=1  Q
"RTN","RCDPEWL",52,0)
 . I Y="E" S RCERA=-1,RCQUIT=1 Q
"RTN","RCDPEWL",53,0)
 . ; prca*4.5*298  Y is = "C" therefore perform the pre-existing scratchpad creation/editing algorithm
"RTN","RCDPEWL",54,0)
 . I $P(RC0,U,15)'="" W !!,"PAYMENT METHOD CODE REPORTED: "_$P(RC0,U,15),!
"RTN","RCDPEWL",55,0)
 . I $P(RC0,U,15)="" W !!,"NO PAYMENT METHOD CODE REPORTED",!
"RTN","RCDPEWL",56,0)
 . I $P(RC0,U,9)=0,$P(RC5,U,2)="" D  Q:RCQUIT
"RTN","RCDPEWL",57,0)
 .. S RCQUIT=0,RCUNM=0
"RTN","RCDPEWL",58,0)
 .. I +$P(RC0,U,5)=0,"ACH"'[(U_$P(RC0,U,15)_U) D  Q:RCQUIT!RCUNM
"RTN","RCDPEWL",59,0)
 ... S DIR("A",1)="This ERA has no payment associated with it and can be marked as",DIR("A",2)="'MATCH-0 PAYMENT' to remove it from the ERA AGING REPORT if no paper check or",DIR("A",3)="EFT is expected to be received for this ERA"
"RTN","RCDPEWL",60,0)
 ... S DIR("?")="Do NOT respond YES here unless you are sure there will be no EFT or paper",DIR("?",1)=" check to be received for this 0-PAYMENT ERA"
"RTN","RCDPEWL",61,0)
 ... S DIR("A")="Do you want to do this?: "
"RTN","RCDPEWL",62,0)
 ... S DIR(0)="YA"
"RTN","RCDPEWL",63,0)
 ... D ^DIR K DIR
"RTN","RCDPEWL",64,0)
 ... I $D(DTOUT)!$D(DUOUT) S RCQUIT=1 Q
"RTN","RCDPEWL",65,0)
 ... I Y'=1 Q
"RTN","RCDPEWL",66,0)
 ... S DIE="^RCY(344.4,",DR=".09////3;.14////3",DA=RCERA D ^DIE S RCUNM=1
"RTN","RCDPEWL",67,0)
 .. I 'RCUNM D
"RTN","RCDPEWL",68,0)
 ... S DIR("A",1)="This ERA does NOT have a matching EFT",DIR("A")="Enter the number of the paper check you received for this ERA: ",DIR(0)="344.01,.07A"
"RTN","RCDPEWL",69,0)
 ... I $P(RC5,U,2)'="" S DIR("B")=$P(RC5,U,2)
"RTN","RCDPEWL",70,0)
 ... I $G(DIR("B"))="",$P(RC0,U,2)'="" S DIR("B")=$P(RC0,U,2)
"RTN","RCDPEWL",71,0)
 ... W ! D ^DIR K DIR
"RTN","RCDPEWL",72,0)
 ... I $D(DTOUT)!$D(DUOUT)!(Y="") D  S RCQUIT=1 Q
"RTN","RCDPEWL",73,0)
 .... S DIR(0)="EA",DIR("A",1)="There must be either a paper check or an EFT for this ERA",DIR("A")="PRESS RETURN TO CONTINUE " W !!  D ^DIR K DIR
"RTN","RCDPEWL",74,0)
 ... S RCDAT("CHECK#")=Y
"RTN","RCDPEWL",75,0)
 ... S DIR(0)="344.01,.1O",DIR("B")=$$FMTE^XLFDT($P(RC0,U,4),2)
"RTN","RCDPEWL",76,0)
 ... W ! D ^DIR K DIR
"RTN","RCDPEWL",77,0)
 ... I $D(DTOUT)!$D(DUOUT) S RCQUIT=1 Q
"RTN","RCDPEWL",78,0)
 ... S RCDAT("CHECKDT")=Y
"RTN","RCDPEWL",79,0)
 ... S DIR(0)="344.01,.08O"
"RTN","RCDPEWL",80,0)
 ... W ! D ^DIR K DIR
"RTN","RCDPEWL",81,0)
 ... I $D(DTOUT)!$D(DUOUT) S RCQUIT=1 Q
"RTN","RCDPEWL",82,0)
 ... S RCDAT("BANK")=Y
"RTN","RCDPEWL",83,0)
 ... S DIR("A",1)="ERA #"_RCERA_" (TRACE #:"_$P(RC0,U,2)_") matched to paper check "_RCDAT("CHECK#"),DIR("A")="Is this correct?: ",DIR(0)="YA",DIR("B")="YES" W ! D ^DIR K DIR
"RTN","RCDPEWL",84,0)
 ... I Y'=1 S RCQUIT=1 Q
"RTN","RCDPEWL",85,0)
 ... S DIE="^RCY(344.4,",DA=RCERA,DR=".13////"_RCDAT("CHECK#")_";.09////2" D ^DIE
"RTN","RCDPEWL",86,0)
 ;
"RTN","RCDPEWL",87,0)
 S RCSCR=+$O(^RCY(344.49,"B",RCERA,0))
"RTN","RCDPEWL",88,0)
 I 'RCSCR D  ; Build the entry in file 344.49
"RTN","RCDPEWL",89,0)
 . I RCSCR("NOEDIT") D  Q
"RTN","RCDPEWL",90,0)
 .. S DIR("A")="NO worklist entry exists for this ERA - PRESS RETURN TO CONTINUE ",DIR(0)="EA" W ! D ^DIR K DIR
"RTN","RCDPEWL",91,0)
 . ;
"RTN","RCDPEWL",92,0)
 . S RCSCR=+$$ADDREC(RCERA,.RCDAT)
"RTN","RCDPEWL",93,0)
 . I RCSCR D  Q:'RCSCR
"RTN","RCDPEWL",94,0)
 .. F X=1:1:6 L +^RCY(344.4,RCSCR):5 Q:$T  I X=6 D  Q
"RTN","RCDPEWL",95,0)
 ... S DA=RCSCR,DIK="^RCY(344.49," D ^DIK S RCSCR=0
"RTN","RCDPEWL",96,0)
 ... S DIR(0)="EA",DIR("A",1)="Another user has locked this entry - NEW RECORD NOT CREATED",DIR("A")="PRESS RETURN TO CONTINUE " W ! D ^DIR K DIR
"RTN","RCDPEWL",97,0)
 .. Q:'RCSCR
"RTN","RCDPEWL",98,0)
 .. ; prca*4.5*298  per patch requirements, keep code related to 
"RTN","RCDPEWL",99,0)
 .. ; creating/maintaining batches but just remove from execution.
"RTN","RCDPEWL",100,0)
 .. ;D SETBATCH^RCDPEWLB(RCSCR) ; prca*4.5*298
"RTN","RCDPEWL",101,0)
 .. D ADDLINES^RCDPEWLA(RCSCR)
"RTN","RCDPEWL",102,0)
 .. K ^TMP($J,"BATCHES")
"RTN","RCDPEWL",103,0)
 ;
"RTN","RCDPEWL",104,0)
 I RCSCR D  G:'RCSCR DISPQ
"RTN","RCDPEWL",105,0)
 . ; prca*4.5*298  per patch requirements, keep code related to 
"RTN","RCDPEWL",106,0)
 . ; creating/maintaining batches but just remove from execution.
"RTN","RCDPEWL",107,0)
 . ;Q:'$$BAT^RCDPEWL7(RCSCR)
"RTN","RCDPEWL",108,0)
 . ;I 'RCSCR("NOEDIT"),'$G(^TMP("RCBATCH_SELECTED",$J)) L +^RCY(344.4,RCSCR):5 I '$T W !!,"Another user is currently editing this entry",! S DIR(0)="E" D ^DIR K DIR S RCSCR=0 Q
"RTN","RCDPEWL",109,0)
 . I 'RCSCR("NOEDIT") L +^RCY(344.4,RCSCR):5 I '$T W !!,"Another user is currently editing this entry",! S DIR(0)="E" D ^DIR K DIR S RCSCR=0 Q
"RTN","RCDPEWL",110,0)
 . D EN^VALM("RCDPE EOB WORKLIST")
"RTN","RCDPEWL",111,0)
 ;
"RTN","RCDPEWL",112,0)
DISPQ L -^RCY(344.4,+$G(RCERA))
"RTN","RCDPEWL",113,0)
 Q
"RTN","RCDPEWL",114,0)
 ;
"RTN","RCDPEWL",115,0)
INIT ; -- set up initial variables
"RTN","RCDPEWL",116,0)
 N RCQUIT,RCREV
"RTN","RCDPEWL",117,0)
 S VALMCNT=0,VALMBG=1
"RTN","RCDPEWL",118,0)
 S RCQUIT=0
"RTN","RCDPEWL",119,0)
 ; PRCA*4.5*298: Removed functionality for retrieving/storing user preferences in file #344.49
"RTN","RCDPEWL",120,0)
 ; and replaced with the use of parameters handled by PARAMS^RCDPEWLA.
"RTN","RCDPEWL",121,0)
 D PARAMS^RCDPEWLA("MO") I $G(RCQUIT) S VALMQUIT=1 Q
"RTN","RCDPEWL",122,0)
 D BLD^RCDPEWL1($G(^TMP($J,"RC_SORTPARM")))
"RTN","RCDPEWL",123,0)
 Q
"RTN","RCDPEWL",124,0)
 ;
"RTN","RCDPEWL",125,0)
CV ; Change View Action for EEOB Worklist
"RTN","RCDPEWL",126,0)
 D FULL^VALM1
"RTN","RCDPEWL",127,0)
 D PARAMS^RCDPEWLA("CV")
"RTN","RCDPEWL",128,0)
 D BLD^RCDPEWL1($G(^TMP($J,"RC_SORTPARM"))),HDR
"RTN","RCDPEWL",129,0)
 S VALMBCK="R",VALMBG=1
"RTN","RCDPEWL",130,0)
 Q
"RTN","RCDPEWL",131,0)
 ;
"RTN","RCDPEWL",132,0)
ADDREC(RCERA,RCDAT) ; Add a record to file 344.49
"RTN","RCDPEWL",133,0)
 ; RCERA = ien of file 344.4
"RTN","RCDPEWL",134,0)
 ; RCDAT = array containing additional data to add to new entry
"RTN","RCDPEWL",135,0)
 ;
"RTN","RCDPEWL",136,0)
 N DIC,DLAYGO,X,Y,DO,DD,RCY,DINUM
"RTN","RCDPEWL",137,0)
 S RCY=0,DIC("DR")=""
"RTN","RCDPEWL",138,0)
 S DIC(0)="L",DLAYGO=344.49,(DINUM,X)=RCERA,DIC="^RCY(344.49,"
"RTN","RCDPEWL",139,0)
 I $G(RCDAT("CHECK#"))'="" S DIC("DR")=".04////"_RCDAT("CHECK#")_";"
"RTN","RCDPEWL",140,0)
 I $G(RCDAT("CHECKDT"))'="" S DIC("DR")=DIC("DR")_".05////"_RCDAT("CHECKDT")_";"
"RTN","RCDPEWL",141,0)
 I $G(RCDAT("BANK"))'="" S DIC("DR")=DIC("DR")_".06////"_RCDAT("BANK")_";"
"RTN","RCDPEWL",142,0)
 K DD,DO D FILE^DICN K DIC
"RTN","RCDPEWL",143,0)
 I Y>0 S RCY=+Y
"RTN","RCDPEWL",144,0)
 Q RCY
"RTN","RCDPEWL",145,0)
 ;
"RTN","RCDPEWL",146,0)
HDR ; Creates header lines for the selected ERA display
"RTN","RCDPEWL",147,0)
 N X,Z,I,RC,RC5,RC4,RCSORTBY,RCEEOBPU
"RTN","RCDPEWL",148,0)
 F I=1:1:5 S VALMHDR(I)=""
"RTN","RCDPEWL",149,0)
 I '$G(RCSCR) S VALMQUIT=1 Q
"RTN","RCDPEWL",150,0)
 S RC=$G(^RCY(344.4,+RCSCR,0)),RC5=$G(^RCY(344.4,+RCSCR,5))
"RTN","RCDPEWL",151,0)
 S RC4=$G(^RCY(344.4,+RCSCR,4))  ;prca*4.5*298 
"RTN","RCDPEWL",152,0)
 S VALMHDR(1)=$E("ERA Entry #: "_$P(RC,U)_$J("",31),1,31)_"Total Amt Pd: "_$J(+$P(RC,U,5),"",2)
"RTN","RCDPEWL",153,0)
 S VALMHDR(2)="Payer Name/ID: "_$P(RC,U,6)_"/"_$P(RC,U,3)
"RTN","RCDPEWL",154,0)
 S Z=+$O(^RCY(344.31,"AERA",+RCSCR,0))
"RTN","RCDPEWL",155,0)
 I Z S VALMHDR(3)="EFT #/TRACE #: "_$P($G(^RCY(344.3,+$G(^RCY(344.31,Z,0)),0)),U)_"/"_$P(RC,U,2)
"RTN","RCDPEWL",156,0)
 I 'Z,$P(RC5,U,2)'="" S VALMHDR(3)="PAPER CHECK #: "_$P(RC5,U,2)
"RTN","RCDPEWL",157,0)
 ; prca*4.5*298  per patch requirements, keep code related to creating/maintaining
"RTN","RCDPEWL",158,0)
 ; batches but just remove from execution.
"RTN","RCDPEWL",159,0)
 ;I $G(^TMP("RCBATCH_SELECTED",$J)) D
"RTN","RCDPEWL",160,0)
 ;. N Z,Z0
"RTN","RCDPEWL",161,0)
 ;. S Z=+$G(^TMP("RCBATCH_SELECTED",$J)),Z0=$G(^RCY(344.49,RCSCR,3,Z,0))
"RTN","RCDPEWL",162,0)
 ;. S RCT=RCT+1,VALMHDR(RCT)="BATCH: "_Z_"  "_$P(Z0,U,2)_"  "_$$EXTERNAL^DILFD(344.493,.03,"",$P(Z0,U,3))
"RTN","RCDPEWL",163,0)
 I $G(RCSCR("NOEDIT")) D
"RTN","RCDPEWL",164,0)
 . S VALMHDR(4)="*** RECEIPT(S) ALREADY CREATED *** ("_$$RECEIPTS(RCSCR)_")"
"RTN","RCDPEWL",165,0)
 I $P(RC4,U,2)]"" D  ;AUTO-POST STATUS (344.4, 4.02);  if not null, then the selected ERA is designated for auto-post
"RTN","RCDPEWL",166,0)
 . ; Setting the Auto-Post info in the header
"RTN","RCDPEWL",167,0)
 . N AUTOPSTS
"RTN","RCDPEWL",168,0)
 . S AUTOPSTS="Auto-Post Status: "_$S($P(RC4,U,2)=0:"Unposted",$P(RC4,U,2)=1:"Partial",1:"Complete")
"RTN","RCDPEWL",169,0)
 . S AUTOPSTS=AUTOPSTS_"    Auto-Post Date: "_$S($P(RC4,U,2)=2:$$FMTE^XLFDT($P(RC4,U)),1:"")
"RTN","RCDPEWL",170,0)
 . S VALMHDR(5)=AUTOPSTS
"RTN","RCDPEWL",171,0)
 ; Displaying Current View (PRCA*4.5*298)
"RTN","RCDPEWL",172,0)
 S $E(VALMHDR(1),60)="Current View:"
"RTN","RCDPEWL",173,0)
 S RCSORTBY=$G(^TMP($J,"RC_SORTPARM"))
"RTN","RCDPEWL",174,0)
 S $E(VALMHDR(2),60)=$S(RCSORTBY="F":"ZERO-PAYMENTS FIRST",RCSORTBY="L":"ZERO-PAYMENTS LAST",1:"NO SORT ORDER")
"RTN","RCDPEWL",175,0)
 S RCEEOBPU=$G(^TMP($J,"RC_EEOBPOST"))
"RTN","RCDPEWL",176,0)
 S $E(VALMHDR(3),60)=$S(RCEEOBPU="P":"POSTED EEOBs ONLY",RCEEOBPU="U":"UNPOSTED EEOBs ONLY",1:"ALL EEOBS")
"RTN","RCDPEWL",177,0)
 Q
"RTN","RCDPEWL",178,0)
 ;
"RTN","RCDPEWL",179,0)
FNL ; -- Clean up list
"RTN","RCDPEWL",180,0)
 K ^TMP("RCDPE-EOB_WLDX",$J),^TMP("RCDPE-EOB_WL",$J),^TMP($J,"RC_SORTPARM"),^TMP($J,"RC_BILL")
"RTN","RCDPEWL",181,0)
 D CLEAN^VALM10,CLEAR^VALM1
"RTN","RCDPEWL",182,0)
 K RCFASTXT
"RTN","RCDPEWL",183,0)
 Q
"RTN","RCDPEWL",184,0)
 ;
"RTN","RCDPEWL",185,0)
SEL(RCDA) ; Select entry from worklist scratch pad screen
"RTN","RCDPEWL",186,0)
 ; RCDA = array returned if selections made
"RTN","RCDPEWL",187,0)
 ;    RCDA(n)=ien of entry(s) in file 344.41 
"RTN","RCDPEWL",188,0)
 ;            where n = the line # selected  
"RTN","RCDPEWL",189,0)
 K RCDA
"RTN","RCDPEWL",190,0)
 N VALMY
"RTN","RCDPEWL",191,0)
 D EN^VALM2($G(XQORNOD(0)),"S")
"RTN","RCDPEWL",192,0)
 S RCDA=0 F  S RCDA=$O(VALMY(RCDA)) Q:'RCDA  S RCDA(RCDA)=$P($G(^TMP("RCDPE-EOB_WLDX",$J,RCDA)),U,2,5)
"RTN","RCDPEWL",193,0)
 Q
"RTN","RCDPEWL",194,0)
 ;
"RTN","RCDPEWL",195,0)
NOEDIT ; Display no edit allowed if receipt exists
"RTN","RCDPEWL",196,0)
 N DIR,X,Y
"RTN","RCDPEWL",197,0)
 S DIR(0)="EA",DIR("A",1)="This action is NOT available since the ERA already has a receipt."
"RTN","RCDPEWL",198,0)
 S DIR("A")="PRESS RETURN TO CONTINUE "
"RTN","RCDPEWL",199,0)
 W ! D ^DIR K DIR W !
"RTN","RCDPEWL",200,0)
 Q
"RTN","RCDPEWL",201,0)
 ;
"RTN","RCDPEWL",202,0)
NOBATCH ; Display action not allowed if working at batch level not the ERA level
"RTN","RCDPEWL",203,0)
 N DIR,X,Y
"RTN","RCDPEWL",204,0)
 S DIR(0)="EA",DIR("A",1)="This action is NOT valid when in a batch within the ERA."
"RTN","RCDPEWL",205,0)
 S DIR("A")="PRESS RETURN TO CONTINUE "
"RTN","RCDPEWL",206,0)
 W ! D ^DIR K DIR W !
"RTN","RCDPEWL",207,0)
 Q
"RTN","RCDPEWL",208,0)
 ;
"RTN","RCDPEWL",209,0)
RECEIPTS(RCSCR) ; get list of receipts for the ERA 
"RTN","RCDPEWL",210,0)
 ; Input: RCSCR: ERA File (#344.4) IEN
"RTN","RCDPEWL",211,0)
 ; Output: "" - No Receipt / REC# - One Receipt / REC#A-REC#Z - Range of Receipts
"RTN","RCDPEWL",212,0)
 N X,RECEIPT,CTR,RC0
"RTN","RCDPEWL",213,0)
 K ARRAY,STR
"RTN","RCDPEWL",214,0)
 S X=0,CTR=1,(STR,RECEIPT)=""
"RTN","RCDPEWL",215,0)
 F  S X=$O(^RCY(344.4,RCSCR,1,"RECEIPT",X)) Q:'X  D
"RTN","RCDPEWL",216,0)
 . S:X RECEIPT=$P($G(^RCY(344,X,0)),U)  ; get external form of receipt 
"RTN","RCDPEWL",217,0)
 . I RECEIPT]"" S ARRAY(RECEIPT)=""
"RTN","RCDPEWL",218,0)
 ; array of receipts does not exist so this could be a non auto-posted ERA; so only 1 receipt will be assigned; retrieve at 344.4, .08
"RTN","RCDPEWL",219,0)
 I '$D(ARRAY),$$GET1^DIQ(344.4,RCSCR,.08)'="" S ARRAY($$GET1^DIQ(344.4,RCSCR,.08))=""
"RTN","RCDPEWL",220,0)
 ;
"RTN","RCDPEWL",221,0)
 I $O(ARRAY($O(ARRAY(""))))'="" D
"RTN","RCDPEWL",222,0)
 . S STR=$O(ARRAY(""))_"-"_$O(ARRAY(""),-1)
"RTN","RCDPEWL",223,0)
 E  D
"RTN","RCDPEWL",224,0)
 . S STR=$O(ARRAY(""))
"RTN","RCDPEWL",225,0)
 Q STR
"RTN","RCDPEWL0")
0^4^B221141588^B153865640
"RTN","RCDPEWL0",1,0)
RCDPEWL0 ;ALB/TMK/PJH - ELECTRONIC EOB WORKLIST ACTIONS ;Jun 06, 2014@19:11:19
"RTN","RCDPEWL0",2,0)
 ;;4.5;Accounts Receivable;**173,208,252,269,298,317**;Mar 20, 1995;Build 8
"RTN","RCDPEWL0",3,0)
 ;Per VA Directive 6402, this routine should not be modified.
"RTN","RCDPEWL0",4,0)
 Q
"RTN","RCDPEWL0",5,0)
 ;
"RTN","RCDPEWL0",6,0)
PARAMS(SOURCE) ; Retrieve/Edit/Save View Parameters for ERA Worklist
"RTN","RCDPEWL0",7,0)
 ; Input:   SOURCE      - "MO" - Menu Option
"RTN","RCDPEWL0",8,0)
 ;                        "CV" - Change View Action
"RTN","RCDPEWL0",9,0)
 ; Output: Sort/Filtering Criteria for the worklist sent into ^TMP("RCERA_PARAMS",$J)
"RTN","RCDPEWL0",10,0)
 ;         ^TMP("RCERA_PARAMS",$J,"RCPOST") - ERA Posting Status ("P":Posted/"U":Unposted)
"RTN","RCDPEWL0",11,0)
 ;         ^TMP("RCERA_PARAMS",$J,"RCAUTOP")- Auto-Posting Status
"RTN","RCDPEWL0",12,0)
 ;                                            ("A":Auto-Posting/"N":Non Auto-Posting/"B":Both)
"RTN","RCDPEWL0",13,0)
 ;         ^TMP("RCERA_PARAMS",$J,"RCMATCH")- ERA Matching Status ("M":Matched/"U":Unmatched)
"RTN","RCDPEWL0",14,0)
 ;         ^TMP("RCERA_PARAMS",$J,"RCTYPE") - ERA Claim Type ("M":Medical/"P":Pharmacy/"B":Both)
"RTN","RCDPEWL0",15,0)
 ;         ^TMP("RCERA_PARAMS",$J,"RCDT")   - A1^A2 Where:
"RTN","RCDPEWL0",16,0)
 ;                                            A1 - ERA Received EARLIEST DATE (Range Limited Only)
"RTN","RCDPEWL0",17,0)
 ;                                            A2 - ERA Received LATEST DATE (Range Limited Only)
"RTN","RCDPEWL0",18,0)
 ;         ^TMP("RCERA_PARAMS",$J,"RCPAYR") - B1^B2^B3 Where:
"RTN","RCDPEWL0",19,0)
 ;                                            B1 - All Payers/Range of Payers
"RTN","RCDPEWL0",20,0)
 ;                                                 ("A": All/"R":Range of Payers)
"RTN","RCDPEWL0",21,0)
 ;                                            B2 - START WITH PAYER (e.g.,'AET')
"RTN","RCDPEWL0",22,0)
 ;                                                 (Range Limited Only)
"RTN","RCDPEWL0",23,0)
 ;                                            B3 - GO TO PAYER (e.g.,'AETZ') (Range Limited Only)
"RTN","RCDPEWL0",24,0)
 ;
"RTN","RCDPEWL0",25,0)
 ;         ^TMP("RCERA_PVW",$J) - Same layout as ^TMP("RCERA_PARAMS",$J).  This global contains
"RTN","RCDPEWL0",26,0)
 ;                                the sort/filters of the user's preferred view (for ERA main page)
"RTN","RCDPEWL0",27,0)
 ;                                while ^TMP("RCERA_PARAMS",$J) contains the sort/filters of what is
"RTN","RCDPEWL0",28,0)
 ;                                currently displayed.  They may or may not be the same values.
"RTN","RCDPEWL0",29,0)
 ;
"RTN","RCDPEWL0",30,0)
 ;          ^TMP("RCSCRATCH_PVW",$J)   - This global contains the sort/filters of the user's preferred view
"RTN","RCDPEWL0",31,0)
 ;                                for the Scratch Pad.  See PARAMS^RCDPEWLA for the layout.
"RTN","RCDPEWL0",32,0)
 ;
"RTN","RCDPEWL0",33,0)
 ;         RCQUIT=1 if the user exited out, 0 otherwise
"RTN","RCDPEWL0",34,0)
 ;
"RTN","RCDPEWL0",35,0)
 N RCXPAR,USEPVW,X,XX,Y                ; PRCA*4.5*317 Added USEPVW,XX
"RTN","RCDPEWL0",36,0)
 S RCQUIT=0
"RTN","RCDPEWL0",37,0)
 ;
"RTN","RCDPEWL0",38,0)
 ; Ask Date Range Selection when coming straight from the menu option
"RTN","RCDPEWL0",39,0)
 I SOURCE="MO" D  Q:RCQUIT
"RTN","RCDPEWL0",40,0)
 . K ^TMP("RCERA_PARAMS",$J),^TMP("RCERA_PVW",$J),^TMP("RCSCRATCH_PVW",$J)
"RTN","RCDPEWL0",41,0)
 . S RCQUIT=$$DTR()  ; Set date range filter
"RTN","RCDPEWL0",42,0)
 . Q:RCQUIT
"RTN","RCDPEWL0",43,0)
 . ;
"RTN","RCDPEWL0",44,0)
 . ;Retrieve user's saved preferred view (if any)
"RTN","RCDPEWL0",45,0)
 . D GETWLPVW(.RCXPAR)
"RTN","RCDPEWL0",46,0)
 ;
"RTN","RCDPEWL0",47,0)
 ;Only ask user if they want to use their preferred view in the following scenarios:
"RTN","RCDPEWL0",48,0)
 ; a) Source is "MO" and user has a preferred view on file
"RTN","RCDPEWL0",49,0)
 ; b) Source is "CV" (change view action), user has a preferred view but is
"RTN","RCDPEWL0",50,0)
 ;    not using the preferred view criteria at this time.
"RTN","RCDPEWL0",51,0)
 S XX=$$PREFVW(SOURCE)
"RTN","RCDPEWL0",52,0)
 I ((XX=1)&(SOURCE="MO"))!((XX=0)&(SOURCE="CV")) D  Q:USEPVW
"RTN","RCDPEWL0",53,0)
 . ;
"RTN","RCDPEWL0",54,0)
 . ; Ask the user if they want to use the preferred view
"RTN","RCDPEWL0",55,0)
 . S USEPVW=$$ASKUVW()
"RTN","RCDPEWL0",56,0)
 . I USEPVW=-1 S RCQUIT=1 Q
"RTN","RCDPEWL0",57,0)
 . Q:'USEPVW
"RTN","RCDPEWL0",58,0)
 . ;
"RTN","RCDPEWL0",59,0)
 . ; Set the Sort/Filtering Criteria from the preferred view 
"RTN","RCDPEWL0",60,0)
 . M ^TMP("RCERA_PARAMS",$J)=^TMP("RCERA_PVW",$J)
"RTN","RCDPEWL0",61,0)
 ;
"RTN","RCDPEWL0",62,0)
 W !!,"Select parameters for displaying the list of ERAs"
"RTN","RCDPEWL0",63,0)
 S RCQUIT=$$PARAMS2^RCDPEWLD()
"RTN","RCDPEWL0",64,0)
 Q:RCQUIT
"RTN","RCDPEWL0",65,0)
 D SAVEPVW                                  ; Ask if they want to save as preferred view
"RTN","RCDPEWL0",66,0)
 Q
"RTN","RCDPEWL0",67,0)
 ;
"RTN","RCDPEWL0",68,0)
GETWLPVW(RCXPAR) ;  Retrieves the preferred view settings for the ERA worklist
"RTN","RCDPEWL0",69,0)
 ; for the user
"RTN","RCDPEWL0",70,0)
 ; Input:   None
"RTN","RCDPEWL0",71,0)
 ; Output:  RCXPAR()               - Array of preferred view sort/filter criteria
"RTN","RCDPEWL0",72,0)
 ;          ^TMP("RCERA_PARAMS",$J)- Global array of preferred view settings
"RTN","RCDPEWL0",73,0)
 ;          ^TMP("RCERA_PVW")      - A copy of the preferred settings (if any)
"RTN","RCDPEWL0",74,0)
 N XX
"RTN","RCDPEWL0",75,0)
 K RCXPAR
"RTN","RCDPEWL0",76,0)
 D GETLST^XPAR(.RCXPAR,"USR","RCDPE EDI LOCKBOX WORKLIST","I")
"RTN","RCDPEWL0",77,0)
 D:$D(RCXPAR("ERA_POSTING_STATUS")) PVWSAVE(.RCXPAR)
"RTN","RCDPEWL0",78,0)
 ;
"RTN","RCDPEWL0",79,0)
 S XX=$G(RCXPAR("ERA_POSTING_STATUS"))
"RTN","RCDPEWL0",80,0)
 S ^TMP("RCERA_PARAMS",$J,"RCPOST")=$S(XX'="":XX,1:"U")
"RTN","RCDPEWL0",81,0)
 S XX=$G(RCXPAR("ERA_AUTO_POSTING"))
"RTN","RCDPEWL0",82,0)
 S ^TMP("RCERA_PARAMS",$J,"RCAUTOP")=$S(XX'="":XX,1:"B")
"RTN","RCDPEWL0",83,0)
 S XX=$G(RCXPAR("ERA-EFT_MATCH_STATUS"))
"RTN","RCDPEWL0",84,0)
 S ^TMP("RCERA_PARAMS",$J,"RCMATCH")=$S(XX'="":XX,1:"B")
"RTN","RCDPEWL0",85,0)
 S XX=$G(RCXPAR("ERA_CLAIM_TYPE"))
"RTN","RCDPEWL0",86,0)
 S ^TMP("RCERA_PARAMS",$J,"RCTYPE")=$S(XX'="":XX,1:"B")
"RTN","RCDPEWL0",87,0)
 S XX=$G(RCXPAR("ALL_PAYERS/RANGE_OF_PAYERS"))
"RTN","RCDPEWL0",88,0)
 S ^TMP("RCERA_PARAMS",$J,"RCPAYR")=$S(XX'="":$TR(XX,";","^"),1:"A")
"RTN","RCDPEWL0",89,0)
 Q
"RTN","RCDPEWL0",90,0)
 ;
"RTN","RCDPEWL0",91,0)
PVWSAVE(RCXPAR) ; Save a copy of the preferred view on file
"RTN","RCDPEWL0",92,0)
 ; PRCA*4.5*317 added subroutine
"RTN","RCDPEWL0",93,0)
 ; Input:   RCXPAR            - array of preferred view setting for the user
"RTN","RCDPEWL0",94,0)
 ; Output:  ^TMP("RCERA_PVW") - a copy of the preferred settings
"RTN","RCDPEWL0",95,0)
 ;
"RTN","RCDPEWL0",96,0)
 K ^TMP("RCERA_PVW",$J)
"RTN","RCDPEWL0",97,0)
 ; only continue if we have answers to all ERA Worklist related preferred view prompts
"RTN","RCDPEWL0",98,0)
 Q:'$D(RCXPAR("ERA_POSTING_STATUS"))
"RTN","RCDPEWL0",99,0)
 Q:'$D(RCXPAR("ERA_AUTO_POSTING"))
"RTN","RCDPEWL0",100,0)
 Q:'$D(RCXPAR("ERA-EFT_MATCH_STATUS"))
"RTN","RCDPEWL0",101,0)
 Q:'$D(RCXPAR("ERA_CLAIM_TYPE"))
"RTN","RCDPEWL0",102,0)
 Q:'$D(RCXPAR("ALL_PAYERS/RANGE_OF_PAYERS"))
"RTN","RCDPEWL0",103,0)
 ;
"RTN","RCDPEWL0",104,0)
 S ^TMP("RCERA_PVW",$J,"RCPOST")=RCXPAR("ERA_POSTING_STATUS")
"RTN","RCDPEWL0",105,0)
 S ^TMP("RCERA_PVW",$J,"RCAUTOP")=RCXPAR("ERA_AUTO_POSTING")
"RTN","RCDPEWL0",106,0)
 S ^TMP("RCERA_PVW",$J,"RCMATCH")=RCXPAR("ERA-EFT_MATCH_STATUS")
"RTN","RCDPEWL0",107,0)
 S ^TMP("RCERA_PVW",$J,"RCTYPE")=RCXPAR("ERA_CLAIM_TYPE")
"RTN","RCDPEWL0",108,0)
 S ^TMP("RCERA_PVW",$J,"RCPAYR")=$TR(RCXPAR("ALL_PAYERS/RANGE_OF_PAYERS"),";","^")
"RTN","RCDPEWL0",109,0)
 Q
"RTN","RCDPEWL0",110,0)
 ;
"RTN","RCDPEWL0",111,0)
PREFVW(SOURCE) ; Checks to see if the user has a preferred view
"RTN","RCDPEWL0",112,0)
 ; PRCA*4.5*317 added subroutine
"RTN","RCDPEWL0",113,0)
 ; When source is 'CV', checks to see if the preferred view is being used
"RTN","RCDPEWL0",114,0)
 ; Input:   SOURCE                  - 'MO' - When called from the Worklist menu
"RTN","RCDPEWL0",115,0)
 ;                                           option
"RTN","RCDPEWL0",116,0)
 ;                                    'CV' - When called from the Change View
"RTN","RCDPEWL0",117,0)
 ;                                           action
"RTN","RCDPEWL0",118,0)
 ;
"RTN","RCDPEWL0",119,0)
 ;          ^TMP("RCERA_PVW")       - Global array of preferred view settings
"RTN","RCDPEWL0",120,0)
 ;          ^TMP("RCERA_PARAMS")    - Global array of currently in use defaults
"RTN","RCDPEWL0",121,0)
 ; Returns: 1 - User has preferred view if SOURCE is 'MO' or is using
"RTN","RCDPEWL0",122,0)
 ;              their preferred view if SOURCE is 'CV'
"RTN","RCDPEWL0",123,0)
 ;          0 - User is not using their preferred view
"RTN","RCDPEWL0",124,0)
 ;         -1 - User does not have a preferred view 
"RTN","RCDPEWL0",125,0)
 I SOURCE="MO" Q $S($D(^TMP("RCERA_PVW",$J)):1,1:-1)
"RTN","RCDPEWL0",126,0)
 Q:'$D(^TMP("RCERA_PVW",$J)) -1  ; No stored preferred view
"RTN","RCDPEWL0",127,0)
 Q:$G(^TMP("RCERA_PARAMS",$J,"RCPOST"))'=$G(^TMP("RCERA_PVW",$J,"RCPOST")) 0
"RTN","RCDPEWL0",128,0)
 Q:$G(^TMP("RCERA_PARAMS",$J,"RCAUTOP"))'=$G(^TMP("RCERA_PVW",$J,"RCAUTOP")) 0
"RTN","RCDPEWL0",129,0)
 Q:$G(^TMP("RCERA_PARAMS",$J,"RCMATCH"))'=$G(^TMP("RCERA_PVW",$J,"RCMATCH")) 0
"RTN","RCDPEWL0",130,0)
 Q:$G(^TMP("RCERA_PARAMS",$J,"RCTYPE"))'=$G(^TMP("RCERA_PVW",$J,"RCTYPE")) 0
"RTN","RCDPEWL0",131,0)
 Q:$G(^TMP("RCERA_PARAMS",$J,"RCPAYR"))'=$G(^TMP("RCERA_PVW",$J,"RCPAYR")) 0
"RTN","RCDPEWL0",132,0)
 Q 1
"RTN","RCDPEWL0",133,0)
 ;
"RTN","RCDPEWL0",134,0)
ASKUVW() ;EP from PARAMS^RCDPEWLA, PARAMS^RCDPEAA1
"RTN","RCDPEWL0",135,0)
 ; Prompts the user to see if they want to use their preferred view
"RTN","RCDPEWL0",136,0)
 ; PRCA*4.5*317 added function
"RTN","RCDPEWL0",137,0)
 ; Input:   None
"RTN","RCDPEWL0",138,0)
 ; Returns: 1 - User wants to use their preferred view
"RTN","RCDPEWL0",139,0)
 ;          0 - User does not want to use their preferred view
"RTN","RCDPEWL0",140,0)
 ;         -1 - User typed '^'
"RTN","RCDPEWL0",141,0)
 N DIR,DTOUT,DUOUT
"RTN","RCDPEWL0",142,0)
 S DIR(0)="Y"
"RTN","RCDPEWL0",143,0)
 S DIR("A")="Use preferred view"
"RTN","RCDPEWL0",144,0)
 S DIR("B")="N"
"RTN","RCDPEWL0",145,0)
 W !
"RTN","RCDPEWL0",146,0)
 D ^DIR
"RTN","RCDPEWL0",147,0)
 I $D(DTOUT)!$D(DUOUT) Q -1
"RTN","RCDPEWL0",148,0)
 Q:Y 1   ; response is YES
"RTN","RCDPEWL0",149,0)
 Q 0
"RTN","RCDPEWL0",150,0)
 ;
"RTN","RCDPEWL0",151,0)
SAVEPVW ; Option to save as User Preferred View
"RTN","RCDPEWL0",152,0)
 ; PRCA*4.5*317 added subroutine
"RTN","RCDPEWL0",153,0)
 ; Input:   ^TMP("RCERA_PARAMS")    - Global array of current worklist settings
"RTN","RCDPEWL0",154,0)
 ; Output   Current worklist settings set as preferred view (potentially)
"RTN","RCDPEWL0",155,0)
 N DIR,DTOUT,DUOUT,RCERROR,XX
"RTN","RCDPEWL0",156,0)
 K DIR
"RTN","RCDPEWL0",157,0)
 S DIR(0)="YA",DIR("B")="NO"
"RTN","RCDPEWL0",158,0)
 S DIR("A")="Do you want to save this as your preferred view (Y/N)? "
"RTN","RCDPEWL0",159,0)
 W !
"RTN","RCDPEWL0",160,0)
 D ^DIR
"RTN","RCDPEWL0",161,0)
 Q:Y'=1
"RTN","RCDPEWL0",162,0)
 S XX=^TMP("RCERA_PARAMS",$J,"RCPOST")
"RTN","RCDPEWL0",163,0)
 D EN^XPAR(DUZ_";VA(200,","RCDPE EDI LOCKBOX WORKLIST","ERA_POSTING_STATUS",XX,.RCERROR)
"RTN","RCDPEWL0",164,0)
 S XX=^TMP("RCERA_PARAMS",$J,"RCAUTOP")
"RTN","RCDPEWL0",165,0)
 D EN^XPAR(DUZ_";VA(200,","RCDPE EDI LOCKBOX WORKLIST","ERA_AUTO_POSTING",XX,.RCERROR)
"RTN","RCDPEWL0",166,0)
 S XX=^TMP("RCERA_PARAMS",$J,"RCMATCH")
"RTN","RCDPEWL0",167,0)
 D EN^XPAR(DUZ_";VA(200,","RCDPE EDI LOCKBOX WORKLIST","ERA-EFT_MATCH_STATUS",XX,.RCERROR)
"RTN","RCDPEWL0",168,0)
 S XX=^TMP("RCERA_PARAMS",$J,"RCTYPE")
"RTN","RCDPEWL0",169,0)
 D EN^XPAR(DUZ_";VA(200,","RCDPE EDI LOCKBOX WORKLIST","ERA_CLAIM_TYPE",XX,.RCERROR)
"RTN","RCDPEWL0",170,0)
 S XX=$TR(^TMP("RCERA_PARAMS",$J,"RCPAYR"),"^",";")
"RTN","RCDPEWL0",171,0)
 D EN^XPAR(DUZ_";VA(200,","RCDPE EDI LOCKBOX WORKLIST","ALL_PAYERS/RANGE_OF_PAYERS",XX,.RCERROR)
"RTN","RCDPEWL0",172,0)
 ;
"RTN","RCDPEWL0",173,0)
 K ^TMP("RCERA_PVW",$J)
"RTN","RCDPEWL0",174,0)
 M ^TMP("RCERA_PVW",$J)=^TMP("RCERA_PARAMS",$J)  ; capture new preferred settings for comparison
"RTN","RCDPEWL0",175,0)
 Q
"RTN","RCDPEWL0",176,0)
 ;
"RTN","RCDPEWL0",177,0)
DTR() ; Date Range Selection
"RTN","RCDPEWL0",178,0)
 ; Input:   ^TMP("RCERA_PARAMS",$J,"RCDT") - Current selected Date Range (if any)
"RTN","RCDPEWL0",179,0)
 ; Output:  ^TMP("RCERA_PARAMS",$J,"RCDT") - Updated Selected Date Range
"RTN","RCDPEWL0",180,0)
 ; Returns: 1 if user quit or timed out, 0 otherwise
"RTN","RCDPEWL0",181,0)
DTR1 ;
"RTN","RCDPEWL0",182,0)
 N DIR,DTOUT,DTQUIT,DUOUT,Y,FROM,TO,RCDTRNG
"RTN","RCDPEWL0",183,0)
 S ^TMP("RCERA_PARAMS",$J,"RCDT")="0^"_DT
"RTN","RCDPEWL0",184,0)
 K DIR S DIR(0)="YA"
"RTN","RCDPEWL0",185,0)
 S DIR("A")="Limit the selection to a date range when the ERA was received?: "
"RTN","RCDPEWL0",186,0)
 S DIR("B")="NO"
"RTN","RCDPEWL0",187,0)
 S DIR("?")="Enter YES to specify a date range filter."
"RTN","RCDPEWL0",188,0)
 W !
"RTN","RCDPEWL0",189,0)
 D ^DIR
"RTN","RCDPEWL0",190,0)
 I $D(DTOUT)!$D(DUOUT) Q 1
"RTN","RCDPEWL0",191,0)
 I Y D  G:DTQUIT DTR1
"RTN","RCDPEWL0",192,0)
 . S DTQUIT=0
"RTN","RCDPEWL0",193,0)
 . S FROM=$P($G(^TMP("RCERA_PARAMS",$J,"RCDT")),"^",1)
"RTN","RCDPEWL0",194,0)
 . S TO=$P($G(^TMP("RCERA_PARAMS",$J,"RCDT")),"^",2)
"RTN","RCDPEWL0",195,0)
 . W !
"RTN","RCDPEWL0",196,0)
 . S RCDTRNG=$$DTRANGE(FROM,TO)
"RTN","RCDPEWL0",197,0)
 . I RCDTRNG="^" S DTQUIT=1 Q
"RTN","RCDPEWL0",198,0)
 . S ^TMP("RCERA_PARAMS",$J,"RCDT")=RCDTRNG
"RTN","RCDPEWL0",199,0)
 Q 0
"RTN","RCDPEWL0",200,0)
 ;
"RTN","RCDPEWL0",201,0)
DTRANGE(DEFFROM,DEFTO) ; Asks for and returns a Date Range
"RTN","RCDPEWL0",202,0)
 ; Input: DEFFROM - Default FROM date
"RTN","RCDPEWL0",203,0)
 ;        DEFTO   - Default TO date
"RTN","RCDPEWL0",204,0)
 ;Output: From_Date^To_Date (YYYMMDD^YYYDDMM) or "^" (timeout or ^ entered)
"RTN","RCDPEWL0",205,0)
 ;
"RTN","RCDPEWL0",206,0)
 N DIR,Y,DTOUT,DUOUT,RCDFR,START
"RTN","RCDPEWL0",207,0)
 S RCQUIT=0
"RTN","RCDPEWL0",208,0)
 S DIR(0)="DAE^:"_DT_":E"
"RTN","RCDPEWL0",209,0)
 S DIR("A")="Earliest date: "
"RTN","RCDPEWL0",210,0)
 S DIR("?")="Enter the start of the date range."
"RTN","RCDPEWL0",211,0)
 S:($G(DEFFROM)) DIR("B")=$$FMTE^XLFDT(DEFFROM,2)
"RTN","RCDPEWL0",212,0)
 D ^DIR
"RTN","RCDPEWL0",213,0)
 I $D(DTOUT)!$D(DUOUT) Q "^"
"RTN","RCDPEWL0",214,0)
 S RCDFR=Y,START=$$FMTE^XLFDT(RCDFR,"2DZ")
"RTN","RCDPEWL0",215,0)
 K DIR
"RTN","RCDPEWL0",216,0)
 S DIR(0)="DAE^"_RCDFR_":"_DT_":E"
"RTN","RCDPEWL0",217,0)
 S DIR("A")="Latest date: "
"RTN","RCDPEWL0",218,0)
 S DIR("?",1)="Enter the end of the date range. The ending date must be greater than "
"RTN","RCDPEWL0",219,0)
 S DIR("?")="or equal to "_START_"."
"RTN","RCDPEWL0",220,0)
 S:($G(DEFTO)) DIR("B")=$$FMTE^XLFDT(DEFTO,2)
"RTN","RCDPEWL0",221,0)
 D ^DIR
"RTN","RCDPEWL0",222,0)
 I $D(DTOUT)!$D(DUOUT) Q "^"
"RTN","RCDPEWL0",223,0)
 Q (RCDFR_"^"_Y)
"RTN","RCDPEWL0",224,0)
 ;
"RTN","RCDPEWL0",225,0)
FILTER(IEN344P4) ; Returns 1 if record in entry IEN344P4 in 344.4 passes
"RTN","RCDPEWL0",226,0)
 ; the edits for the worklist selection of ERAs
"RTN","RCDPEWL0",227,0)
 ; Parameters found in ^TMP("RCERA_PARAMS",$J)
"RTN","RCDPEWL0",228,0)
 N OK,RCPOST,RCAUTOP,RCMATCH,RCTYPE,RCDFR,RCDTO,RCPAYFR,RCPAYTO,RCPAYR,RC0,RC4
"RTN","RCDPEWL0",229,0)
 S OK=1,RC0=$G(^RCY(344.4,IEN344P4,0)),RC4=$G(^RCY(344.4,IEN344P4,4))
"RTN","RCDPEWL0",230,0)
 ;
"RTN","RCDPEWL0",231,0)
 S RCMATCH=$G(^TMP("RCERA_PARAMS",$J,"RCMATCH")),RCPOST=$G(^TMP("RCERA_PARAMS",$J,"RCPOST"))
"RTN","RCDPEWL0",232,0)
 S RCAUTOP=$G(^TMP("RCERA_PARAMS",$J,"RCAUTOP")),RCTYPE=$G(^TMP("RCERA_PARAMS",$J,"RCTYPE"))
"RTN","RCDPEWL0",233,0)
 S RCDFR=+$P($G(^TMP("RCERA_PARAMS",$J,"RCDT")),U),RCDTO=+$P($G(^TMP("RCERA_PARAMS",$J,"RCDT")),U,2)
"RTN","RCDPEWL0",234,0)
 S RCPAYR=$P($G(^TMP("RCERA_PARAMS",$J,"RCPAYR")),U),RCPAYFR=$P($G(^TMP("RCERA_PARAMS",$J,"RCPAYR")),U,2),RCPAYTO=$P($G(^TMP("RCERA_PARAMS",$J,"RCPAYR")),U,3)
"RTN","RCDPEWL0",235,0)
 ;
"RTN","RCDPEWL0",236,0)
 ; If receipt exists, scratchpad must exist
"RTN","RCDPEWL0",237,0)
 ;I $P(RC0,U,8),'$D(^RCY(344.49,+IEN344P4,0)) S OK=0 G FQ
"RTN","RCDPEWL0",238,0)
 ; Post status
"RTN","RCDPEWL0",239,0)
 I $S(RCPOST="B":0,RCPOST="U":$P(RC0,U,14),1:'$P(RC0,U,14)) S OK=0 G FQ
"RTN","RCDPEWL0",240,0)
 ; Auto-Posting status
"RTN","RCDPEWL0",241,0)
 I $S(RCAUTOP="B":0,RCAUTOP="A":($P(RC4,U,2)=""),1:($P(RC4,U,2)'="")) S OK=0 G FQ
"RTN","RCDPEWL0",242,0)
 ; Match status
"RTN","RCDPEWL0",243,0)
 I $S(RCMATCH="B":0,RCMATCH="N":$P(RC0,U,9),1:'$P(RC0,U,9)) S OK=0 G FQ
"RTN","RCDPEWL0",244,0)
 ; Medical/Pharmacy Claim
"RTN","RCDPEWL0",245,0)
 I $S(RCTYPE="B":0,RCTYPE="M":$$PHARM^RCDPEWLP(IEN344P4),1:'$$PHARM^RCDPEWLP(IEN344P4)) S OK=0 G FQ
"RTN","RCDPEWL0",246,0)
 ; dt rec'd range
"RTN","RCDPEWL0",247,0)
 I $S(RCDFR=0:0,1:$P(RC0,U,7)\1<RCDFR) S OK=0 G FQ
"RTN","RCDPEWL0",248,0)
 I $S(RCDTO=DT:0,1:$P(RC0,U,7)\1>RCDTO) S OK=0 G FQ
"RTN","RCDPEWL0",249,0)
 ; Payer name
"RTN","RCDPEWL0",250,0)
 I RCPAYR'="A" D  G:'OK FQ
"RTN","RCDPEWL0",251,0)
 . N Q
"RTN","RCDPEWL0",252,0)
 . S Q=$$UP^RCDPEARL($P(RC0,U,6))
"RTN","RCDPEWL0",253,0)
 . I $S(Q=RCPAYFR:1,Q=RCPAYTO:1,Q]RCPAYFR:RCPAYTO]Q,1:0) Q
"RTN","RCDPEWL0",254,0)
 . S OK=0
"RTN","RCDPEWL0",255,0)
 ;
"RTN","RCDPEWL0",256,0)
FQ Q OK
"RTN","RCDPEWL0",257,0)
 ;
"RTN","RCDPEWL0",258,0)
SPLIT ; Split line in ERA list
"RTN","RCDPEWL0",259,0)
 ; input - RCSCR = ien of 344.49 and 344.4
"RTN","RCDPEWL0",260,0)
 N RCLINE,RCZ,RCDA,Q,Q0,Z,Z0,DIR,X,Y,CT,L,L1,RCONE,RCQUIT
"RTN","RCDPEWL0",261,0)
 D FULL^VALM1
"RTN","RCDPEWL0",262,0)
 I $S($P($G(^RCY(344.4,RCSCR,4)),U,2)]"":1,1:0) D NOEDIT^RCDPEWLP G SPLITQ   ;prca*4.5*298  auto-posted ERAs cannot enter Split/Edit action
"RTN","RCDPEWL0",263,0)
 I $G(RCSCR("NOEDIT")) D NOEDIT^RCDPEWL G SPLITQ
"RTN","RCDPEWL0",264,0)
 W !!,"Select the entry that has a line you need to Split/Edit",!
"RTN","RCDPEWL0",265,0)
 D SEL^RCDPEWL(.RCDA)
"RTN","RCDPEWL0",266,0)
 S Z=+$O(RCDA(0)) G:'$G(RCDA(Z)) SPLITQ
"RTN","RCDPEWL0",267,0)
 S RCLINE=+RCDA(Z),Z0=+$O(^TMP("RCDPE-EOB_WLDX",$J,Z_".999"),-1)
"RTN","RCDPEWL0",268,0)
 S RCZ=Z F  S RCZ=$O(^TMP("RCDPE-EOB_WLDX",$J,RCZ)) Q:'RCZ!(RCZ\1'=Z)  D
"RTN","RCDPEWL0",269,0)
 . S Q=$P($G(^TMP("RCDPE-EOB_WLDX",$J,RCZ)),U,2)
"RTN","RCDPEWL0",270,0)
 . Q:'Q
"RTN","RCDPEWL0",271,0)
 . S RCZ(RCZ)=Q
"RTN","RCDPEWL0",272,0)
 . S Q0=0 F  S Q0=$O(^RCY(344.49,RCSCR,1,Q,1,Q0)) Q:'Q0  I "01"[$P($G(^(Q0,0)),U,2) K RCZ(RCZ) Q
"RTN","RCDPEWL0",273,0)
 I '$O(RCZ(0)) D  G SPLITQ
"RTN","RCDPEWL0",274,0)
 . S DIR(0)="EA",DIR("A",1)="This entry has no lines available to Edit/Split",DIR("A")="PRESS RETURN TO CONTINUE " W ! D ^DIR K DIR
"RTN","RCDPEWL0",275,0)
 S RCQUIT=0
"RTN","RCDPEWL0",276,0)
 I $P($G(^RCY(344.49,RCSCR,1,RCLINE,0)),U,13) D  G:RCQUIT SPLITQ
"RTN","RCDPEWL0",277,0)
 . S DIR("A",1)="WARNING!  This line has already been VERIFIED",DIR("A")="Are you sure you want to continue?: ",DIR(0)="YA",DIR("B")="NO" W ! D ^DIR K DIR
"RTN","RCDPEWL0",278,0)
 . I Y'=1 S RCQUIT=1
"RTN","RCDPEWL0",279,0)
 S CT=0,CT=CT+1,DIR("?",CT)="Enter the line # that you want to split or edit:",RCONE=1
"RTN","RCDPEWL0",280,0)
 S L=Z F  S L=$O(RCZ(L)) Q:'L  D
"RTN","RCDPEWL0",281,0)
 . S L1=+$G(^TMP("RCDPE-EOB_WLDX",$J,L))
"RTN","RCDPEWL0",282,0)
 . S CT=CT+1
"RTN","RCDPEWL0",283,0)
 . S DIR("?",CT)=$G(^TMP("RCDPE-EOB_WL",$J,L1,0)),CT=CT+1,DIR("?",CT)=$G(^TMP("RCDPE-EOB_WL",$J,L1+1,0)) S RCONE(1)=$S(RCONE:L,1:"") S RCONE=0
"RTN","RCDPEWL0",284,0)
 S DIR("?")=" ",Y=-1
"RTN","RCDPEWL0",285,0)
 I $G(RCONE(1)) S Y=+RCONE(1) K DIR G:'Y SPLITQ
"RTN","RCDPEWL0",286,0)
 I '$G(RCONE(1)) D  K DIR I $D(DTOUT)!$D(DUOUT)!(Y\1'=Z) G SPLITQ
"RTN","RCDPEWL0",287,0)
 . F  S DIR(0)="NAO^"_(Z+.001)_":"_Z0_":3",DIR("A")="Which line of entry "_Z_" do you want to Split/Edit?: " S:$G(RCONE(1))'="" DIR("B")=RCONE(1) D ^DIR Q:'Y!$D(DUOUT)!$D(DTOUT)  D  Q:Y>0
"RTN","RCDPEWL0",288,0)
 .. I '$D(^TMP("RCDPE-EOB_WLDX",$J,Y)) W !!,"Line "_Y_" does NOT exist - TRY AGAIN",! S Y=-1 Q
"RTN","RCDPEWL0",289,0)
 .. I '$D(RCZ(Y)) W !!,"Line "_Y_" has been used in a DISTRIBUTE ADJ action and can't be edited",! S Y=-1 Q
"RTN","RCDPEWL0",290,0)
 .. S Q=+$O(^RCY(344.49,RCSCR,1,"B",Y,0))
"RTN","RCDPEWL0",291,0)
 ;
"RTN","RCDPEWL0",292,0)
 K ^TMP("RCDPE_SPLIT_REBLD",$J)
"RTN","RCDPEWL0",293,0)
 D SPLIT^RCDPEWL3(RCSCR,+Y)
"RTN","RCDPEWL0",294,0)
 I $G(^TMP("RCDPE_SPLIT_REBLD",$J)) K ^TMP("RCDPE_SPLIT_REBLD",$J) D BLD^RCDPEWL1($G(^TMP($J,"RC_SORTPARM")))
"RTN","RCDPEWL0",295,0)
 ;
"RTN","RCDPEWL0",296,0)
SPLITQ S VALMBCK="R"
"RTN","RCDPEWL0",297,0)
 Q
"RTN","RCDPEWL0",298,0)
 ;
"RTN","RCDPEWL0",299,0)
PRTERA ; View/prt
"RTN","RCDPEWL0",300,0)
 N DIC,X,Y,RCSCR
"RTN","RCDPEWL0",301,0)
 S DIC="^RCY(344.4,",DIC(0)="AEMQ" D ^DIC
"RTN","RCDPEWL0",302,0)
 Q:Y'>0
"RTN","RCDPEWL0",303,0)
 S RCSCR=+Y
"RTN","RCDPEWL0",304,0)
 D PRERA1
"RTN","RCDPEWL0",305,0)
 Q
"RTN","RCDPEWL0",306,0)
 ;
"RTN","RCDPEWL0",307,0)
PRERA ; RCSCR is assumed to be defined
"RTN","RCDPEWL0",308,0)
 D FULL^VALM1 ; Protocol entry
"RTN","RCDPEWL0",309,0)
PRERA1 ; Option entry
"RTN","RCDPEWL0",310,0)
 N %ZIS,ZTRTN,ZTSAVE,ZTDESC,POP,DIR,X,Y,RCERADET
"RTN","RCDPEWL0",311,0)
 D EXCWARN^RCDPEWLP(RCSCR)
"RTN","RCDPEWL0",312,0)
 S DIR("?",1)="Including expanded detail will significantly increase the size of this report",DIR("?",2)="IF YOU CHOOSE TO INCLUDE IT, ALL PAYMENT DETAILS FOR EACH EEOB WILL BE"
"RTN","RCDPEWL0",313,0)
 S DIR("?")="listed.  If you want just summary data for each EEOB, do NOT include it."
"RTN","RCDPEWL0",314,0)
 S DIR(0)="YA",DIR("A")="Do you want to include expanded EEOB detail?: ",DIR("B")="NO" W ! D ^DIR K DIR
"RTN","RCDPEWL0",315,0)
 I $D(DUOUT)!$D(DTOUT) G PRERAQ
"RTN","RCDPEWL0",316,0)
 S RCERADET=+Y
"RTN","RCDPEWL0",317,0)
 S %ZIS="QM" D ^%ZIS G:POP PRERAQ
"RTN","RCDPEWL0",318,0)
 I $D(IO("Q")) D  G PRERAQ
"RTN","RCDPEWL0",319,0)
 . S ZTRTN="VPERA^RCDPEWL0("_RCSCR_","_RCERADET_")",ZTDESC="AR - Print ERA From Worklist"
"RTN","RCDPEWL0",320,0)
 . D ^%ZTLOAD
"RTN","RCDPEWL0",321,0)
 . W !!,$S($D(ZTSK):"Your task # "_ZTSK_" has been queued.",1:"Unable to queue this job.")
"RTN","RCDPEWL0",322,0)
 . K ZTSK,IO("Q") D HOME^%ZIS
"RTN","RCDPEWL0",323,0)
 U IO
"RTN","RCDPEWL0",324,0)
 D VPERA(RCSCR,RCERADET)
"RTN","RCDPEWL0",325,0)
 Q
"RTN","RCDPEWL0",326,0)
 ;
"RTN","RCDPEWL0",327,0)
VPERA(RCSCR,RCERADET) ; Queued entry
"RTN","RCDPEWL0",328,0)
 ; RCSCR = ien of entry in file 344.4
"RTN","RCDPEWL0",329,0)
 ; RCERADET = 1 if inclusion of all EOB details from file 361.1 is
"RTN","RCDPEWL0",330,0)
 ;  desired, 0 if not
"RTN","RCDPEWL0",331,0)
 N Z,Z0,RCSTOP,RCZ,RCPG,RCDOT,RCDIQ,RCDIQ1,RCDIQ2,RCXM1,RC,RCSCR1,RC3611
"RTN","RCDPEWL0",332,0)
 K ^TMP($J,"RC_SUMRAW"),^TMP($J,"RC_SUMOUT"),^TMP($J,"RC_SUMALL")
"RTN","RCDPEWL0",333,0)
 S (RCSTOP,RCPG)=0,RCDOT="",$P(RCDOT,".",79)=""
"RTN","RCDPEWL0",334,0)
 D GETS^DIQ(344.4,RCSCR_",","*","IEN","RCDIQ")
"RTN","RCDPEWL0",335,0)
 D TXT0^RCDPEX31(RCSCR,.RCDIQ,.RCXM1,.RC) ; Get top level 0-node captioned flds
"RTN","RCDPEWL0",336,0)
 I $O(^RCY(344.4,RCSCR,2,0)) S RC=RC+1,RCXM1(RC)="  **ERA LEVEL ADJUSTMENTS**"
"RTN","RCDPEWL0",337,0)
 S RCSCR1=0 F  S RCSCR1=$O(^RCY(344.4,RCSCR,2,RCSCR1)) Q:'RCSCR1  D
"RTN","RCDPEWL0",338,0)
 . K RCDIQ2
"RTN","RCDPEWL0",339,0)
 . D GETS^DIQ(344.42,RCSCR1_","_RCSCR_",","*","IEN","RCDIQ2")
"RTN","RCDPEWL0",340,0)
 . D TXT2^RCDPEX31(RCSCR,RCSCR1,.RCDIQ2,.RCXM1,.RC) ; Get top level ERA adjs
"RTN","RCDPEWL0",341,0)
 S RCSCR1=0 F  S RCSCR1=$O(^RCY(344.4,RCSCR,1,RCSCR1)) Q:'RCSCR1  D
"RTN","RCDPEWL0",342,0)
 . K RCDIQ1
"RTN","RCDPEWL0",343,0)
 . D GETS^DIQ(344.41,RCSCR1_","_RCSCR_",","*","IE","RCDIQ1")  ;PRCA*4.5*298  need to retrieve all fields even if null  (changed "IEN" to "IE")
"RTN","RCDPEWL0",344,0)
 . D TXT00^RCDPEX31(RCSCR,RCSCR1,.RCDIQ1,.RCXM1,.RC)
"RTN","RCDPEWL0",345,0)
 . ;HIPAA 5010
"RTN","RCDPEWL0",346,0)
 . N PNAME4
"RTN","RCDPEWL0",347,0)
 . S PNAME4=$$PNM4^RCDPEWL1(RCSCR,RCSCR1)
"RTN","RCDPEWL0",348,0)
 . I $L(PNAME4)<32 D
"RTN","RCDPEWL0",349,0)
 . .S RC=RC+1,RCXM1(RC-1)=$E("PATIENT: "_PNAME4_$J("",41),1,41)_"CLAIM #: "_$$BILLREF^RCDPESR0(RCSCR,RCSCR1),RCXM1(RC)=" "
"RTN","RCDPEWL0",350,0)
 . I $L(PNAME4)>31 D
"RTN","RCDPEWL0",351,0)
 . .S RC=RC+1,RCXM1(RC-1)=$J("",41)_"CLAIM #: "_$$BILLREF^RCDPESR0(RCSCR,RCSCR1)
"RTN","RCDPEWL0",352,0)
 . .S RC=RC+1,RCXM1(RC-1)=$E("PATIENT: "_PNAME4,1,78),RCXM1(RC)=" "
"RTN","RCDPEWL0",353,0)
 . D PROV^RCDPEWLD(RCSCR,RCSCR1,.RCXM1,.RC)
"RTN","RCDPEWL0",354,0)
 . S RC3611=$P($G(^RCY(344.4,RCSCR,1,RCSCR1,0)),U,2)
"RTN","RCDPEWL0",355,0)
 . I RCERADET D
"RTN","RCDPEWL0",356,0)
 .. I 'RC3611 D  Q
"RTN","RCDPEWL0",357,0)
 ... D DISP^RCDPESR0("^RCY(344.4,"_RCSCR_",1,"_RCSCR1_",1)","^TMP($J,""RC_SUMRAW"")",1,"^TMP($J,""RC_SUMOUT"")",75,1)
"RTN","RCDPEWL0",358,0)
 ..;
"RTN","RCDPEWL0",359,0)
 .. E  D  ; Detail record is in 361.1
"RTN","RCDPEWL0",360,0)
 ... K ^TMP("PRCA_EOB",$J)
"RTN","RCDPEWL0",361,0)
 ... D GETEOB^IBCECSA6(RC3611,2)
"RTN","RCDPEWL0",362,0)
 ... I $O(^IBM(361.1,RC3611,"ERR",0)) D GETERR^RCDPEDS(RC3611,+$O(^TMP("PRCA_EOB",$J,RC3611," "),-1)) ; get filing errors
"RTN","RCDPEWL0",363,0)
 ... S Z=0 F  S Z=$O(^TMP("PRCA_EOB",$J,RC3611,Z)) Q:'Z  S RC=RC+1,^TMP($J,"RC_SUMOUT",RC)=$G(^TMP("PRCA_EOB",$J,RC3611,Z))
"RTN","RCDPEWL0",364,0)
 ... S RC=RC+2,^TMP($J,"RC_SUMOUT",RC-1)=" ",^TMP($J,"RC_SUMOUT",RC)=" "
"RTN","RCDPEWL0",365,0)
 ... K ^TMP("PRCA_EOB",$J)
"RTN","RCDPEWL0",366,0)
 . I $D(RCDIQ1(344.41,RCSCR1_","_RCSCR_",",2)) D
"RTN","RCDPEWL0",367,0)
 .. S RC=RC+1,RCXM1(RC)="  **EXCEPTION RESOLUTION LOG DATA**"
"RTN","RCDPEWL0",368,0)
 .. S Z=0 F  S Z=$O(RCDIQ1(344.41,RCSCR1_","_RCSCR_",",2,Z)) Q:'Z  S RC=RC+1,RCXM1(RC)=RCDIQ1(344.41,RCSCR1_","_RCSCR_",",2,Z)
"RTN","RCDPEWL0",369,0)
 . S RC=RC+1,RCXM1(RC)=" "
"RTN","RCDPEWL0",370,0)
 . S Z0=+$O(^TMP($J,"RC_SUMALL"," "),-1)
"RTN","RCDPEWL0",371,0)
 . S Z=0 F  S Z=$O(RCXM1(Z)) Q:'Z  S Z0=Z0+1,^TMP($J,"RC_SUMALL",Z0)=RCXM1(Z)
"RTN","RCDPEWL0",372,0)
 . K RCXM1 S RC=0
"RTN","RCDPEWL0",373,0)
 . S Z=0 F  S Z=$O(^TMP($J,"RC_SUMOUT",Z)) Q:'Z  S Z0=Z0+1,^TMP($J,"RC_SUMALL",Z0)=$G(^TMP($J,"RC_SUMOUT",Z))
"RTN","RCDPEWL0",374,0)
 S RCSTOP=0,Z=""
"RTN","RCDPEWL0",375,0)
 F  S Z=$O(^TMP($J,"RC_SUMALL",Z)) Q:'Z  D  Q:RCSTOP
"RTN","RCDPEWL0",376,0)
 . I $D(ZTQUEUED),$$S^%ZTLOAD S (RCSTOP,ZTSTOP)=1 K ZTREQ I +$G(RCPG) W !!,"***TASK STOPPED BY USER***" Q
"RTN","RCDPEWL0",377,0)
 . I 'RCPG!(($Y+5)>IOSL) D  I RCSTOP Q
"RTN","RCDPEWL0",378,0)
 .. D:RCPG ASK(.RCSTOP) I RCSTOP Q
"RTN","RCDPEWL0",379,0)
 .. D HDR(.RCPG)
"RTN","RCDPEWL0",380,0)
 . W !,$G(^TMP($J,"RC_SUMALL",Z))
"RTN","RCDPEWL0",381,0)
 ;
"RTN","RCDPEWL0",382,0)
 I 'RCSTOP,RCPG D ASK(.RCSTOP)
"RTN","RCDPEWL0",383,0)
 ;
"RTN","RCDPEWL0",384,0)
 I $D(ZTQUEUED) S ZTREQ="@"
"RTN","RCDPEWL0",385,0)
 I '$D(ZTQUEUED) D ^%ZISC
"RTN","RCDPEWL0",386,0)
 ;
"RTN","RCDPEWL0",387,0)
PRERAQ K ^TMP($J,"RC_SUMRAW"),^TMP($J,"RC_SUMOUT"),^TMP($J,"SUMALL")
"RTN","RCDPEWL0",388,0)
 S VALMBCK="R"
"RTN","RCDPEWL0",389,0)
 Q
"RTN","RCDPEWL0",390,0)
 ;
"RTN","RCDPEWL0",391,0)
HDR(RCPG) ;Report hdr
"RTN","RCDPEWL0",392,0)
 ; RCPG = last page #
"RTN","RCDPEWL0",393,0)
 I RCPG!($E(IOST,1,2)="C-") W @IOF,*13
"RTN","RCDPEWL0",394,0)
 S RCPG=$G(RCPG)+1
"RTN","RCDPEWL0",395,0)
 W !,?5,"EDI LOCKBOX WORKLIST - ERA DETAIL",?55,$$FMTE^XLFDT(DT,2),?70,"Page: ",RCPG,!,$TR($J("",IOM)," ","=")
"RTN","RCDPEWL0",396,0)
 Q
"RTN","RCDPEWL0",397,0)
 ;
"RTN","RCDPEWL0",398,0)
ASK(RCSTOP) ;
"RTN","RCDPEWL0",399,0)
 I $E(IOST,1,2)'["C-" Q
"RTN","RCDPEWL0",400,0)
 N DIR,DIROUT,DIRUT,DTOUT,DUOUT
"RTN","RCDPEWL0",401,0)
 S DIR(0)="E" W ! D ^DIR
"RTN","RCDPEWL0",402,0)
 I ($D(DIRUT))!($D(DUOUT)) S RCSTOP=1 Q
"RTN","RCDPEWL0",403,0)
 Q
"RTN","RCDPEWL0",404,0)
 ;
"RTN","RCDPEWLA")
0^3^B99700399^B59960871
"RTN","RCDPEWLA",1,0)
RCDPEWLA ;ALB/TMK - ELECTRONIC EOB MESSAGE WORKLIST ;Jun 06, 2014@19:11:19
"RTN","RCDPEWLA",2,0)
 ;;4.5;Accounts Receivable;**173,208,298,317**;Mar 20, 1995;Build 8
"RTN","RCDPEWLA",3,0)
 ;Per VA Directive 6402, this routine should not be modified.
"RTN","RCDPEWLA",4,0)
ADDLINES(RCSCR) ; Add lines to file 344.49, delete any existing lines
"RTN","RCDPEWLA",5,0)
 ; RCSCR = ien of entry in file 344.49
"RTN","RCDPEWLA",6,0)
 ;
"RTN","RCDPEWLA",7,0)
 N DA,DD,DIC,DIE,DIK,DLAYGO,DO,DR,Q,Q0,Q1,RC0,RCA,RCA0,RCADJ,RCDEC,RCIFN,RCLINE,RCX,X,Y,Z,Z0
"RTN","RCDPEWLA",8,0)
 K ^TMP($J,"RCA")
"RTN","RCDPEWLA",9,0)
 S Z=0 F  S Z=$O(^RCY(344.49,RCSCR,1,Z)) Q:'Z  S DA(1)=RCSCR,DA=Z,DIK="^RCY(344.49,"_DA(1)_",1," D ^DIK
"RTN","RCDPEWLA",10,0)
 ;
"RTN","RCDPEWLA",11,0)
 S RC0=$G(^RCY(344.4,RCSCR,0)) ; Entries are DINUMED
"RTN","RCDPEWLA",12,0)
 I $P(RC0,U,5)'="" S DR=".03////"_$P(RC0,U,5),DIE="^RCY(344.49,",DA=RCSCR D ^DIE
"RTN","RCDPEWLA",13,0)
 ;
"RTN","RCDPEWLA",14,0)
 S Z=0 F  S Z=$O(^RCY(344.4,+RC0,1,Z)) Q:'Z  S RCA0=$G(^(Z,0)) I RCA0'="" D  ; Sort the lines to put adjustments with the payments, check sort order
"RTN","RCDPEWLA",15,0)
 . ; for 0-pays
"RTN","RCDPEWLA",16,0)
 . I $P(RCA0,U,2) S RCIFN=+$G(^IBM(361.1,+$P(RCA0,U,2),0)),RCA=$P($G(^DGCR(399,RCIFN,0)),U) ; IA 4051
"RTN","RCDPEWLA",17,0)
 . I '$P(RCA0,U,2) S RCIFN="0;"_Z,RCA=$P(RCA0,U,5)
"RTN","RCDPEWLA",18,0)
 . I RCA="" S RCA=RCIFN
"RTN","RCDPEWLA",19,0)
 . I $D(^TMP($J,"RCA",RCA,+$P(RCA0,U,14))) D
"RTN","RCDPEWLA",20,0)
 .. F Q0=1:1:999 S Q=RCA_";"_$E(1000+Q0,2,4) I '$D(^TMP($J,"RCA",Q,+$P(RCA0,U,14))) S RCA=Q Q
"RTN","RCDPEWLA",21,0)
 . S ^TMP($J,"RCA",RCA,+$P(RCA0,U,14))=RCIFN_U_Z
"RTN","RCDPEWLA",22,0)
 ;
"RTN","RCDPEWLA",23,0)
 S Z=0 F  S Z=$O(^RCY(344.4,+RC0,2,Z)) Q:'Z  S RCA0=$G(^(Z,0)) I RCA0'="" D  ; Extract ERA level adjs
"RTN","RCDPEWLA",24,0)
 . S RCIFN=$P(RCA0,U),RCA="**ADJ"_Z
"RTN","RCDPEWLA",25,0)
 . S ^TMP($J,"RCA",RCA,1)=RCIFN_U_Z
"RTN","RCDPEWLA",26,0)
 ;
"RTN","RCDPEWLA",27,0)
 I $P(RC0,U,9)=-1 D  ; Check dec adj or additional receipt line needed
"RTN","RCDPEWLA",28,0)
 . S Z=+$O(^RCY(344.31,"AERA",RCSCR,0))
"RTN","RCDPEWLA",29,0)
 . Q:'Z
"RTN","RCDPEWLA",30,0)
 . I $P($G(^RCY(344.31,Z,0)),U,7)-$P(RC0,U,5) D  Q
"RTN","RCDPEWLA",31,0)
 .. S ^TMP($J,"RCA","**ADJ0",1)="TOTALS MISMATCH^^"_($P($G(^RCY(344.31,Z,0)),U,7)-$P(RC0,U,5))
"RTN","RCDPEWLA",32,0)
 ;
"RTN","RCDPEWLA",33,0)
 S Z="" F  S Z=$O(^TMP($J,"RCA",Z)) Q:Z=""  S Z0="" F  S Z0=$O(^TMP($J,"RCA",Z,Z0)) Q:Z0=""  D
"RTN","RCDPEWLA",34,0)
 . S Q=$P(Z,";") ; claim #
"RTN","RCDPEWLA",35,0)
 . S Q0=$S($E(Q,1,2)'="**":$G(^RCY(344.4,+RC0,1,+$P(^TMP($J,"RCA",Z,Z0),U,2),0)),Q["ADJ"&($P(Q,"ADJ",2)):$G(^RCY(344.4,+RC0,2,+$P(^TMP($J,"RCA",Z,Z0),U,2),0)),1:$G(^TMP($J,"RCA",Z,Z0)))
"RTN","RCDPEWLA",36,0)
 . ;
"RTN","RCDPEWLA",37,0)
 . S RCDEC=($P(Q0,U,3)<0) ; is this a decrease
"RTN","RCDPEWLA",38,0)
 . I Z0=0 D  Q  ; Add a payment line from the ERA
"RTN","RCDPEWLA",39,0)
 .. K DO,DD
"RTN","RCDPEWLA",40,0)
 .. S DIC(0)="L",DLAYGO=344.491,DA(1)=RCSCR,DIC="^RCY(344.49,"_DA(1)_",1,"
"RTN","RCDPEWLA",41,0)
 .. S DIC("DR")=".02////"_Q_";.05////"_$P(Q0,U,3)_";.06////"_$P(Q0,U,3)_";.09////"_$P(^TMP($J,"RCA",Z,Z0),U,2)_";.13////0"
"RTN","RCDPEWLA",42,0)
 .. ; prca*4.5*298 per requirements, keep code for creating/maintaining batches but remove from execution
"RTN","RCDPEWLA",43,0)
 .. ;I $G(^TMP($J,"BATCHES")) D  ;prca*4.5*298
"RTN","RCDPEWLA",44,0)
 .. ;.  Assign a batch # here
"RTN","RCDPEWLA",45,0)
 .. ;. S DIC("DR")=DIC("DR")_";.14////"_$$GETBATCH^RCDPEWLB(Q0) ;prca*4.5*298
"RTN","RCDPEWLA",46,0)
 .. F X=$O(^RCY(344.49,RCSCR,1,"ASEQ"," "),-1)+1:1 I '$D(^RCY(344.49,RCSCR,"B",X)) Q
"RTN","RCDPEWLA",47,0)
 .. S RCLINE=X
"RTN","RCDPEWLA",48,0)
 .. D FILE^DICN K DIC,DO,DD
"RTN","RCDPEWLA",49,0)
 .. S ^TMP($J,"RCA",Z)=+Y
"RTN","RCDPEWLA",50,0)
 .. S DIC(0)="L",DLAYGO=344.491,DA(1)=RCSCR,DIC="^RCY(344.49,"_DA(1)_",1,"
"RTN","RCDPEWLA",51,0)
 .. S DIC("DR")=".02////"_Q_";.05////"_$P(Q0,U,3)_";.06////"_$P(Q0,U,3)_$S($P(^TMP($J,"RCA",Z,Z0),U):";.07////"_$P(^TMP($J,"RCA",Z,Z0),U),1:"")
"RTN","RCDPEWLA",52,0)
 .. S X=RCLINE+.001
"RTN","RCDPEWLA",53,0)
 .. D FILE^DICN K DIC,DO,DD,DA
"RTN","RCDPEWLA",54,0)
 .. S $P(^TMP($J,"RCA",Z,0),U,3)=+Y S DA(1)=RCSCR,DA=+^TMP($J,"RCA",Z),DIE="^RCY(344.49,"_DA(1)_",1,",DR=".13////"_+$$VER^RCDPEV(RCSCR,$P(^TMP($J,"RCA",Z,Z0),U),+$P(^TMP($J,"RCA",Z,Z0),U,2)) D ^DIE
"RTN","RCDPEWLA",55,0)
 . ;
"RTN","RCDPEWLA",56,0)
 . I Z0=1,$P($G(^TMP($J,"RCA",Z,0)),U,3) D  Q  ; rev of claim within this ERA
"RTN","RCDPEWLA",57,0)
 .. ; Add adj to line previously added for payment
"RTN","RCDPEWLA",58,0)
 .. K DO,DD
"RTN","RCDPEWLA",59,0)
 .. S DA(2)=RCSCR,DA(1)=+$P($G(^TMP($J,"RCA",Z,0)),U,3),DIC(0)="L",DIC="^RCY(344.49,"_DA(2)_",1,"_DA(1)_",1,",DLAYGO=344.4911,X=+$O(^RCY(344.49,DA(2),1,DA(1),1," "),-1)+1
"RTN","RCDPEWLA",60,0)
 .. S DIC("DR")=".02////"_$S(RCDEC:2,1:4)_";.03////"_$P(Q0,U,3)_";.05////"_$S(RCDEC:"0;.08////1;.06////1",1:"3;.08////0;.06////0")_";.07////"_+Q0_";.13////0"
"RTN","RCDPEWLA",61,0)
 .. D FILE^DICN K DIC,DO,DD,DA
"RTN","RCDPEWLA",62,0)
 .. S Q1=$G(^RCY(344.49,RCSCR,1,+$P($G(^TMP($J,"RCA",Z,0)),U,3),0))
"RTN","RCDPEWLA",63,0)
 .. ; Upd net amt
"RTN","RCDPEWLA",64,0)
 .. S DA(1)=RCSCR,DA=+$P($G(^TMP($J,"RCA",Z,0)),U,3),DIE="^RCY(344.49,"_DA(1)_",1,",DR=".06////"_$J($P(Q1,U,6)+$P(Q0,U,3),"",2)_";.08////"_$J($P(Q1,U,8)+$P(Q0,U,3),"",2) D ^DIE
"RTN","RCDPEWLA",65,0)
 .. ;Upd seq ref,net in 'parent'
"RTN","RCDPEWLA",66,0)
 .. I $G(^TMP($J,"RCA",Z)) D
"RTN","RCDPEWLA",67,0)
 ... S DA(1)=RCSCR,DA=+$G(^TMP($J,"RCA",Z)),DIE="^RCY(344.49,"_DA(1)_",1,",DR=".09////"_($P($G(^RCY(344.49,RCSCR,1,DA,0)),U,9)_","_$P(^TMP($J,"RCA",Z,Z0),U,2))_";.06////"_$J($P($G(^RCY(344.49,DA(1),1,DA,0)),U,6)+$P(Q0,U,3),"",2)
"RTN","RCDPEWLA",68,0)
 ... D ^DIE
"RTN","RCDPEWLA",69,0)
 . ;
"RTN","RCDPEWLA",70,0)
 . I Z0=1 D  Q  ; ERA level adj, no payment for claim lev adj or mismatch
"RTN","RCDPEWLA",71,0)
 .. ;prca*4.5*298 - flag when an ERA level adj exists - cannot auto post ERAs with ERA level adjustments
"RTN","RCDPEWLA",72,0)
 .. S ^TMP($J,"RCDPEWLA","ERA LEVEL ADJUSTMENT EXISTS")=""
"RTN","RCDPEWLA",73,0)
 .. ; Add a line
"RTN","RCDPEWLA",74,0)
 .. K DO,DD
"RTN","RCDPEWLA",75,0)
 .. S RCADJ=$S(Z["**ADJ":1,1:0)
"RTN","RCDPEWLA",76,0)
 .. S DIC(0)="L",DLAYGO=344.491,DA(1)=RCSCR,DIC="^RCY(344.49,"_DA(1)_",1,"
"RTN","RCDPEWLA",77,0)
 .. S DIC("DR")=$S(Q'=0:".02////"_Q_";",1:"")_".03////0.00;.05////0.00;.13////0"
"RTN","RCDPEWLA",78,0)
 .. F X=$O(^RCY(344.49,RCSCR,1,"ASEQ"," "),-1)+1:1 I '$D(^RCY(344.49,RCSCR,"B",X)) L +^RCY(344.49,RCSCR,1,X,0):1 Q:$T
"RTN","RCDPEWLA",79,0)
 .. D FILE^DICN K DIC,DO,DD,DA
"RTN","RCDPEWLA",80,0)
 .. S RCLINE=+$P(Y,U,2),^TMP($J,"RCA",Z)=+Y
"RTN","RCDPEWLA",81,0)
 .. ;
"RTN","RCDPEWLA",82,0)
 .. S DIC(0)="L",DLAYGO=344.491,DA(1)=RCSCR,DIC="^RCY(344.49,"_DA(1)_",1,"
"RTN","RCDPEWLA",83,0)
 .. S DIC("DR")=$S('RCADJ:".02///"_$P(Z,";")_";",1:"")_".03////0.00;.05////0.00;.06////0.00"_$S($P(^TMP($J,"RCA",Z,Z0),U)&'RCADJ:";.07////"_$P(^TMP($J,"RCA",Z,Z0),U),1:"")
"RTN","RCDPEWLA",84,0)
 .. S X=RCLINE+.001
"RTN","RCDPEWLA",85,0)
 .. D FILE^DICN K DIC,DO,DD,DA
"RTN","RCDPEWLA",86,0)
 .. L -^RCY(344.49,RCSCR,1,RCLINE,0)
"RTN","RCDPEWLA",87,0)
 .. S RCLINE=+Y
"RTN","RCDPEWLA",88,0)
 .. ; Add adj record
"RTN","RCDPEWLA",89,0)
 .. S DIC(0)="L",DLAYGO=344.4911,DA(2)=RCSCR,DA(1)=RCLINE,DIC="^RCY(344.49,"_DA(2)_",1,"_DA(1)_",1,"
"RTN","RCDPEWLA",90,0)
 .. S DIC("DR")=".02////"_$S(RCDEC:2+RCADJ,1:4+RCADJ)_";.03////"_$P(Q0,U,3)_";.05////"_$S('RCDEC:"3;.06////0;.08////0",1:"0;.06////1;.08////1")_";.07////"_$S(RCADJ:Z_";.04////"_$P(^TMP($J,"RCA",Z,Z0),U),1:+$P(^TMP($J,"RCA",Z,Z0),U,2))
"RTN","RCDPEWLA",91,0)
 .. F RCX=$O(^RCY(344.49,RCSCR,1,RCLINE,1," "),-1)+1:1 I '$D(^RCY(344.49,RCSCR,1,RCLINE,1,X,0)) L +^RCY(344.49,RCSCR,1,RCLINE,1,RCX,0):1 Q:$T
"RTN","RCDPEWLA",92,0)
 .. S X=RCX
"RTN","RCDPEWLA",93,0)
 .. D FILE^DICN K DIC,DO,DD,DA
"RTN","RCDPEWLA",94,0)
 .. L -^RCY(344.49,RCSCR,1,RCLINE,1,RCX,0)
"RTN","RCDPEWLA",95,0)
 .. S DA(1)=RCSCR,DA=RCLINE,DIE="^RCY(344.49,"_DA(1)_",1,",DR=".06////"_$P(Q0,U,3)_";.08////"_$P(Q0,U,3) D ^DIE
"RTN","RCDPEWLA",96,0)
 .. S Q1=$G(^RCY(344.49,RCSCR,1,RCLINE,0))
"RTN","RCDPEWLA",97,0)
 .. ; Upd seq ref,adj,payment in 'parent'
"RTN","RCDPEWLA",98,0)
 .. I $G(^TMP($J,"RCA",Z)) D
"RTN","RCDPEWLA",99,0)
 ... S DA(1)=RCSCR,DA=+^TMP($J,"RCA",Z),DIE="^RCY(344.49,"_DA(1)_",1,"
"RTN","RCDPEWLA",100,0)
 ... S DR=".09////"_$S(RCADJ:$S($P(Z,"**ADJ",2):$P(Z,"**",2),1:"TOTALS MISMATCH"),1:$P(^TMP($J,"RCA",Z,Z0),U,2))_";.06////"_$J($P($G(^RCY(344.49,DA(1),1,DA,0)),U,6)+$P(Q0,U,3),"",2)_";.08////"_$P(Q0,U,3)
"RTN","RCDPEWLA",101,0)
 ... D ^DIE
"RTN","RCDPEWLA",102,0)
 ;
"RTN","RCDPEWLA",103,0)
 K ^TMP($J,"RCA")
"RTN","RCDPEWLA",104,0)
 Q
"RTN","RCDPEWLA",105,0)
 ;
"RTN","RCDPEWLA",106,0)
TOOOLD(RCDEP) ; Check if deposit in ien RCDPE (file 344.1) is too old to use
"RTN","RCDPEWLA",107,0)
 N RCOLD,Q,DIR,X,Y
"RTN","RCDPEWLA",108,0)
 S Q=$$FMADD^XLFDT(DT,-7),RCOLD=0
"RTN","RCDPEWLA",109,0)
 I $P($G(^RCY(344.1,RCDEP,0)),U,3)<Q D
"RTN","RCDPEWLA",110,0)
 . S DIR("A",1)="This deposit was opened MORE THAN ONE WEEK ago ("_$$FMTE^XLFDT($P($G(^RCY(344.1,RCDEP,0)),U,3),2)_")",DIR("A")="Are you sure you want to use this deposit?: ",DIR("B")="NO",DIR(0)="YA" W ! D ^DIR K DIR
"RTN","RCDPEWLA",111,0)
 . I Y'=1 S RCOLD=1
"RTN","RCDPEWLA",112,0)
 Q RCOLD
"RTN","RCDPEWLA",113,0)
 ;
"RTN","RCDPEWLA",114,0)
PARAMS(SOURCE) ;EP Called from INIT^RCDPEWL
"RTN","RCDPEWLA",115,0)
 ; Retrieve/Edit/Save View Parameters for EEOB Scratchpad Worklist
"RTN","RCDPEWLA",116,0)
 ; Input:   SOURCE      - "MO"   - Select Entry from the worklist
"RTN","RCDPEWLA",117,0)
 ;                        "CV"   - Change View from the scratch pad
"RTN","RCDPEWLA",118,0)
 ; Output: ^TMP($J,"RC_SORTPARM")- Order of Payment
"RTN","RCDPEWLA",119,0)
 ;                                ("N":No Order/"F":Zero-Payments First/"L":Zero-Payments Last)
"RTN","RCDPEWLA",120,0)
 ;         ^TMP($J,"RC_EEOBPOST")- EEOB Posting Status ("P":Posted/"U":Unposted/"B":Both)
"RTN","RCDPEWLA",121,0)
 ;         ^TMP("RCSCRATCH_PVW",$J,"RC_SORTPARM") - Order of Payment (same layout as above) 
"RTN","RCDPEWLA",122,0)
 ;         ^TMP("RCSCRATCH_PVW",$J,"RC_EEOBPOST") - EEOB Posting Status (same layout as above)
"RTN","RCDPEWLA",123,0)
 ; 
"RTN","RCDPEWLA",124,0)
 ;              The ^TMP("RCSCRATCH_PVW",$J) global contains the sort/filters of the user's preferred
"RTN","RCDPEWLA",125,0)
 ;              view while ^TMP($J,"RC_SORTPARM") & ^TMP($J,"RC_EEOBPOST") contain the 
"RTN","RCDPEWLA",126,0)
 ;              sort/filters of what is currently displayed. They may or may not be the same values.
"RTN","RCDPEWLA",127,0)
 ;
"RTN","RCDPEWLA",128,0)
 ;         Or RCQUIT=1
"RTN","RCDPEWLA",129,0)
 ;
"RTN","RCDPEWLA",130,0)
 N DIR,DTOUT,DUOUT,RCPOSTDF
"RTN","RCDPEWLA",131,0)
 N F,RCXPAR,USEPVW,X,XX,Y                   ; PRCA*4.5*317 added USEPVW,XX
"RTN","RCDPEWLA",132,0)
 S RCQUIT=0
"RTN","RCDPEWLA",133,0)
 ;
"RTN","RCDPEWLA",134,0)
 ; Get the Scratch Pad's preferred view settings (if any)
"RTN","RCDPEWLA",135,0)
 D GETLST^XPAR(.RCXPAR,"USR","RCDPE EDI LOCKBOX WORKLIST","I")
"RTN","RCDPEWLA",136,0)
 ;
"RTN","RCDPEWLA",137,0)
 ; PRCA*4.5*317 Save copy of the preferred view on file
"RTN","RCDPEWLA",138,0)
 I $D(RCXPAR("ORDER_OF_PAYMENTS")) D
"RTN","RCDPEWLA",139,0)
 . K ^TMP("RCSCRATCH_PVW",$J)
"RTN","RCDPEWLA",140,0)
 . ; only continue if we have answers to all Scratchpad related preferred view prompts
"RTN","RCDPEWLA",141,0)
 . Q:'$D(RCXPAR("EEOB_POSTING_STATUS"))  ; already checked $D(RCXPAR("ORDER_OF_PAYMENTS")) above
"RTN","RCDPEWLA",142,0)
 . S ^TMP("RCSCRATCH_PVW",$J,"RC_SORTPARM")=RCXPAR("ORDER_OF_PAYMENTS")
"RTN","RCDPEWLA",143,0)
 . S ^TMP("RCSCRATCH_PVW",$J,"RC_EEOBPOST")=RCXPAR("EEOB_POSTING_STATUS")
"RTN","RCDPEWLA",144,0)
 ;
"RTN","RCDPEWLA",145,0)
 ; Setting ^TMP with user's saved parameters or System defaults
"RTN","RCDPEWLA",146,0)
 I '$D(^TMP($J,"RC_SORTPARM")) D
"RTN","RCDPEWLA",147,0)
 . S XX=$G(RCXPAR("ORDER_OF_PAYMENTS"))
"RTN","RCDPEWLA",148,0)
 . S ^TMP($J,"RC_SORTPARM")=$S(XX'="":XX,1:"N")
"RTN","RCDPEWLA",149,0)
 . S XX=$G(RCXPAR("EEOB_POSTING_STATUS"))
"RTN","RCDPEWLA",150,0)
 . S ^TMP($J,"RC_EEOBPOST")=$S(XX'="":XX,1:"U")
"RTN","RCDPEWLA",151,0)
 ;
"RTN","RCDPEWLA",152,0)
 ; PRCA*4.5*317 Start of added lines
"RTN","RCDPEWLA",153,0)
 ; Only ask user if they want to use their preferred view in the following scenarios:
"RTN","RCDPEWLA",154,0)
 ; a) Source is "MO" and user has a preferred view on file
"RTN","RCDPEWLA",155,0)
 ; b) Source is "CV" (change view action), user has a preferred view but is
"RTN","RCDPEWLA",156,0)
 ; not using the preferred view criteria at this time.
"RTN","RCDPEWLA",157,0)
 S XX=$$PREFVW(SOURCE)
"RTN","RCDPEWLA",158,0)
 I ((XX=1)&(SOURCE="MO"))!((XX=0)&(SOURCE="CV")) D  Q:USEPVW
"RTN","RCDPEWLA",159,0)
 . ; Ask the user if they want to use the preferred view
"RTN","RCDPEWLA",160,0)
 . S USEPVW=0
"RTN","RCDPEWLA",161,0)
 . S USEPVW=$$ASKUVW^RCDPEWL0()
"RTN","RCDPEWLA",162,0)
 . I USEPVW=-1 S RCQUIT=1 Q
"RTN","RCDPEWLA",163,0)
 . Q:'USEPVW
"RTN","RCDPEWLA",164,0)
 . ;
"RTN","RCDPEWLA",165,0)
 . ;Set the Sort/Filtering Criteria from the preferred view
"RTN","RCDPEWLA",166,0)
 . S ^TMP($J,"RC_SORTPARM")=^TMP("RCSCRATCH_PVW",$J,"RC_SORTPARM")
"RTN","RCDPEWLA",167,0)
 . S ^TMP($J,"RC_EEOBPOST")=^TMP("RCSCRATCH_PVW",$J,"RC_EEOBPOST")
"RTN","RCDPEWLA",168,0)
 ; PRCA*4.5*317 End of added lines
"RTN","RCDPEWLA",169,0)
 ;
"RTN","RCDPEWLA",170,0)
 S RCQUIT=$$ORDERPAY()  ; Ask Order of Payment Sort
"RTN","RCDPEWLA",171,0)
 Q:RCQUIT
"RTN","RCDPEWLA",172,0)
 S RCQUIT=$$POSTSTAT()  ; Posting Status filter
"RTN","RCDPEWLA",173,0)
 Q:RCQUIT
"RTN","RCDPEWLA",174,0)
 D SAVEPVW              ; Ask to save as preferred view
"RTN","RCDPEWLA",175,0)
 Q
"RTN","RCDPEWLA",176,0)
 ;
"RTN","RCDPEWLA",177,0)
PREFVW(SOURCE) ; Checks to see if the user has a preferred view
"RTN","RCDPEWLA",178,0)
 ; PRCA*4.5*317 added subroutine
"RTN","RCDPEWLA",179,0)
 ; When source is 'CV', checks to see if the preferred view is being used
"RTN","RCDPEWLA",180,0)
 ; Input:   SOURCE                  - 'MO' - When called from the Worklist menu
"RTN","RCDPEWLA",181,0)
 ;                                           option
"RTN","RCDPEWLA",182,0)
 ;                                    'CV' - When called from the Change View
"RTN","RCDPEWLA",183,0)
 ;                                           action
"RTN","RCDPEWLA",184,0)
 ;
"RTN","RCDPEWLA",185,0)
 ;          ^TMP("RCSCRATCH_PVW")   - Global array of preferred view settings
"RTN","RCDPEWLA",186,0)
 ;          ^TMP($J,"RC_SORTPARM")  - Order of Payment (currently displayed)
"RTN","RCDPEWLA",187,0)
 ;          ^TMP($J,"RC_EEOBPOST")  - EEOB Posting Status (currently displayed)
"RTN","RCDPEWLA",188,0)
 ;
"RTN","RCDPEWLA",189,0)
 ; Returns: 1 - User has preferred view if SOURCE is 'MO' or is using
"RTN","RCDPEWLA",190,0)
 ;              their preferred view if SOURCE is 'CV'
"RTN","RCDPEWLA",191,0)
 ;          0 - User is not using their preferred view
"RTN","RCDPEWLA",192,0)
 ;         -1 - User does not have a preferred view 
"RTN","RCDPEWLA",193,0)
 I SOURCE="MO" Q $S($D(^TMP("RCSCRATCH_PVW",$J)):1,1:-1)
"RTN","RCDPEWLA",194,0)
 Q:'$D(^TMP("RCSCRATCH_PVW",$J)) -1  ; No stored preferred view
"RTN","RCDPEWLA",195,0)
 Q:$G(^TMP($J,"RC_SORTPARM"))'=$G(^TMP("RCSCRATCH_PVW",$J,"RC_SORTPARM")) 0
"RTN","RCDPEWLA",196,0)
 Q:$G(^TMP($J,"RC_EEOBPOST"))'=$G(^TMP("RCSCRATCH_PVW",$J,"RC_EEOBPOST")) 0
"RTN","RCDPEWLA",197,0)
 Q 1
"RTN","RCDPEWLA",198,0)
 ;
"RTN","RCDPEWLA",199,0)
ORDERPAY()  ;ORDER OF PAYMENT Sort Selection 
"RTN","RCDPEWLA",200,0)
 ; Input:   ^TMP($J,"RC_SORTPARM")  - Current EEOB Sort Parameter (if any)
"RTN","RCDPEWLA",201,0)
 ; Output:  ^TMP($J,"RC_SORTPARM")  - Updated EEOB Sort Parameter
"RTN","RCDPEWLA",202,0)
 ; Returns: 1 if user quit or timed out, 0 otherwise
"RTN","RCDPEWLA",203,0)
 N DIR,DTOUT,DUOUT,RCSORTBY
"RTN","RCDPEWLA",204,0)
 S RCSORTBY=$G(^TMP($J,"RC_SORTPARM"))
"RTN","RCDPEWLA",205,0)
 K DIR
"RTN","RCDPEWLA",206,0)
 S DIR(0)="SA^N:NO ORDER;F:ZERO-PAYMENTS FIRST;L:ZERO-PAYMENTS LAST"
"RTN","RCDPEWLA",207,0)
 S DIR("A")="Order of Payment: (N)O ORDER, ZERO-PAYMENTS (F)IRST, ZERO-PAYMENTS (L)AST: "
"RTN","RCDPEWLA",208,0)
 S DIR("B")="B"
"RTN","RCDPEWLA",209,0)
 S DIR("?",1)="Enter NO ORDER to not specify a sort."
"RTN","RCDPEWLA",210,0)
 S DIR("?",2)="Enter FIRST to display ERAs with zero payments first."
"RTN","RCDPEWLA",211,0)
 S DIR("?")="Enter LAST to display ERAs with zero payments last."
"RTN","RCDPEWLA",212,0)
 S:RCSORTBY'="" DIR("B")=RCSORTBY    ;Stored preferred view, use as default
"RTN","RCDPEWLA",213,0)
 W !
"RTN","RCDPEWLA",214,0)
 D ^DIR
"RTN","RCDPEWLA",215,0)
 I $D(DTOUT)!$D(DUOUT) Q 1
"RTN","RCDPEWLA",216,0)
 S ^TMP($J,"RC_SORTPARM")=Y
"RTN","RCDPEWLA",217,0)
 Q 0
"RTN","RCDPEWLA",218,0)
 ;
"RTN","RCDPEWLA",219,0)
POSTSTAT()  ; EEOB Posting Status (Posted/Unposted/Both) Selection
"RTN","RCDPEWLA",220,0)
 ; Input:   ^TMP($J,"RC_EEOBPOST")  - Current EEOB Posting Status (if any)
"RTN","RCDPEWLA",221,0)
 ; Output:  ^TMP($J,"RC_EEOBPOST")  - Updated EEOB Posting Status
"RTN","RCDPEWLA",222,0)
 ; Returns: 1 if user quit or timed out, 0 otherwise
"RTN","RCDPEWLA",223,0)
 N DIR,DTOUT,DUOUT,RCPOSTDF
"RTN","RCDPEWLA",224,0)
 S RCPOSTDF=$G(^TMP($J,"RC_EEOBPOST"))
"RTN","RCDPEWLA",225,0)
 K DIR S DIR(0)="SA^U:UNPOSTED;P:POSTED;A:ALL"
"RTN","RCDPEWLA",226,0)
 S DIR("A")="Display for Auto-Posted ERAs: (U)NPOSTED EEOBs, (P)OSTED EEOBs, or (A)LL: "
"RTN","RCDPEWLA",227,0)
 S DIR("B")="U"
"RTN","RCDPEWLA",228,0)
 S DIR("?",1)="Enter UNPOSTED EEOBS to only display EEOBs that were not auto-posted."
"RTN","RCDPEWLA",229,0)
 S DIR("?",2)="Enter POSTED EEOBS to only display EEOBs that were auto-posted."
"RTN","RCDPEWLA",230,0)
 S DIR("?")="Enter ALL to display all EEOBs."
"RTN","RCDPEWLA",231,0)
 S:RCPOSTDF'="" DIR("B")=RCPOSTDF    ;Stored preferred view, use as default
"RTN","RCDPEWLA",232,0)
 W !
"RTN","RCDPEWLA",233,0)
 D ^DIR
"RTN","RCDPEWLA",234,0)
 I $D(DTOUT)!$D(DUOUT) Q 1
"RTN","RCDPEWLA",235,0)
 S ^TMP($J,"RC_EEOBPOST")=Y
"RTN","RCDPEWLA",236,0)
 Q 0
"RTN","RCDPEWLA",237,0)
 ;
"RTN","RCDPEWLA",238,0)
SAVEPVW ; Option to save as User Preferred View for the scratch pad
"RTN","RCDPEWLA",239,0)
 ; PRCA*4.5*317 added subroutine
"RTN","RCDPEWLA",240,0)
 ; Input:   ^TMP($J,"RC_EEOBPOST")  - Current EEOB Posting Status
"RTN","RCDPEWLA",241,0)
 ;          ^TMP($J,"RC_SORTPARM")  - Current EEOB Sort Parameter
"RTN","RCDPEWLA",242,0)
 ; Output   Current worklist scratch pad settings set as preferred view (potentially)
"RTN","RCDPEWLA",243,0)
 N DIR,DTOUT,DUOUT,RCERROR,XX
"RTN","RCDPEWLA",244,0)
 K DIR
"RTN","RCDPEWLA",245,0)
 W !
"RTN","RCDPEWLA",246,0)
 S DIR(0)="YA",DIR("B")="NO"
"RTN","RCDPEWLA",247,0)
 S DIR("A")="Do you want to save this as your preferred view (Y/N)? "
"RTN","RCDPEWLA",248,0)
 D ^DIR
"RTN","RCDPEWLA",249,0)
 Q:Y'=1
"RTN","RCDPEWLA",250,0)
 S XX=^TMP($J,"RC_SORTPARM")
"RTN","RCDPEWLA",251,0)
 D EN^XPAR(DUZ_";VA(200,","RCDPE EDI LOCKBOX WORKLIST","ORDER_OF_PAYMENTS",XX,.RCERROR)
"RTN","RCDPEWLA",252,0)
 S XX=^TMP($J,"RC_EEOBPOST")
"RTN","RCDPEWLA",253,0)
 D EN^XPAR(DUZ_";VA(200,","RCDPE EDI LOCKBOX WORKLIST","EEOB_POSTING_STATUS",XX,.RCERROR)
"RTN","RCDPEWLA",254,0)
 ;
"RTN","RCDPEWLA",255,0)
 ;Capture new preferred settings for comparison
"RTN","RCDPEWLA",256,0)
 K ^TMP("RCSCRATCH_PVW",$J)
"RTN","RCDPEWLA",257,0)
 S ^TMP("RCSCRATCH_PVW",$J,"RC_SORTPARM")=^TMP($J,"RC_SORTPARM")
"RTN","RCDPEWLA",258,0)
 S ^TMP("RCSCRATCH_PVW",$J,"RC_EEOBPOST")=^TMP($J,"RC_EEOBPOST")
"RTN","RCDPEWLA",259,0)
 Q
"RTN","RCDPEWLD")
0^6^B86108343^B28210620
"RTN","RCDPEWLD",1,0)
RCDPEWLD ;ALB/CLT - Continuation of routine RCDPEWL0 ;09 DEC 2016
"RTN","RCDPEWLD",2,0)
 ;;4.5;Accounts Receivable;**252,317**;Mar 20, 1995;Build 8
"RTN","RCDPEWLD",3,0)
 ;Per VA Directive 6402, this routine should not be modified.
"RTN","RCDPEWLD",4,0)
 Q
"RTN","RCDPEWLD",5,0)
 ;
"RTN","RCDPEWLD",6,0)
PROV(RCSCR,RCSCR1,RCXM1,RC) ;Get prov data from ERA (FILE 344.4) and claim (FILE 399)
"RTN","RCDPEWLD",7,0)
 N RCXXX,RCYYY,RCDPEPV,RCCLAIM,RCIEN,RCBILL,RCID,RCBLANK,RCNPI,DIC,X,Y
"RTN","RCDPEWLD",8,0)
 N RCPROV,RCEXP,XUSNPI,RCRTN,RCBNM,RCCOM1,RCCOM2,RCWARN,RCYNODE3
"RTN","RCDPEWLD",9,0)
 ;
"RTN","RCDPEWLD",10,0)
 S RCBLANK="" F X=1:1:30 S RCBLANK=RCBLANK_" "
"RTN","RCDPEWLD",11,0)
 S RC=RC+1 S RCXM1(RC-1)=RCBLANK
"RTN","RCDPEWLD",12,0)
 S RCYNODE3=$G(^RCY(344.4,RCSCR,1,RCSCR1,3))
"RTN","RCDPEWLD",13,0)
 ;
"RTN","RCDPEWLD",14,0)
LKBOX ;Get provider data from ELECTRONIC REMITTANCE ADVICE file (#344.4)
"RTN","RCDPEWLD",15,0)
 S RC=RC+1,RCXM1(RC-1)=$E("**EOB PROVIDER(S)/NPI"_$J(" ",39),1,39)_"CLAIM PROVIDER(S)/NPI**"  ;setting sub-header for worklist
"RTN","RCDPEWLD",16,0)
 S RC=RC+1,RCXM1(RC-1)=$E("---------------------"_$J(" ",39),1,39)_"-----------------------"
"RTN","RCDPEWLD",17,0)
 ;
"RTN","RCDPEWLD",18,0)
 S RCPROV="BILLING",$P(RCYYY(RCPROV),U,3)=0        ; piece 3 initialize for error msgs
"RTN","RCDPEWLD",19,0)
 I $P(RCYNODE3,U)'="" S RCYYY(RCPROV)="/"_$P(RCYNODE3,U)   ; Billing Prov NPI 
"RTN","RCDPEWLD",20,0)
 ;
"RTN","RCDPEWLD",21,0)
 S RCPROV="RENDERING"
"RTN","RCDPEWLD",22,0)
 I $P(RCYNODE3,U,3)=2 S RCPROV="SERVICING"
"RTN","RCDPEWLD",23,0)
 I $P(RCYNODE3,U,3)="",($P(RCYNODE3,U,4)'[","),($P(RCYNODE3,U,4)'="") S RCPROV="SERVICING"
"RTN","RCDPEWLD",24,0)
 I $P(RCYNODE3,U,2)'=""!($P(RCYNODE3,U,4)'="") S RCYYY(RCPROV)=$E($P(RCYNODE3,U,4),1,20)_"/"_$P(RCYNODE3,U,2)
"RTN","RCDPEWLD",25,0)
 S $P(RCYYY(RCPROV),U,3)=0                          ; initialize for error msgs
"RTN","RCDPEWLD",26,0)
 D NPICHK        ; RCPROV has to be "RENDERING" or "SERVICING" when this tag is called !
"RTN","RCDPEWLD",27,0)
 ;
"RTN","RCDPEWLD",28,0)
CLAIM ;Retrieve provider data from the claim
"RTN","RCDPEWLD",29,0)
 S RCCLAIM=$$GET1^DIQ(361.1,$P(^RCY(344.4,RCSCR,1,RCSCR1,0),U,2),.01) ;determine claim num based on entry in 344.4
"RTN","RCDPEWLD",30,0)
 S DIC="^DGCR(399,",DIC(0)="",X=RCCLAIM D ^DIC S RCCLAIM=+Y      ;find ien for file 399
"RTN","RCDPEWLD",31,0)
 D GETS^DIQ(399,RCCLAIM,"222*","IE","RCXXX")         ;retrieve prov information
"RTN","RCDPEWLD",32,0)
 S RCBILL=$$GET1^DIQ(399,RCCLAIM,.22,"I")            ;retrieve default division
"RTN","RCDPEWLD",33,0)
 S RCBNM=$$GET1^DIQ(4,$$GET1^DIQ(40.8,RCBILL,.07,"I"),.01)  ;get name from institution file
"RTN","RCDPEWLD",34,0)
 S RCBILL=$$GET1^DIQ(4,$$GET1^DIQ(40.8,RCBILL,.07,"I"),41.99)  ;get NPI from institution file
"RTN","RCDPEWLD",35,0)
 ;
"RTN","RCDPEWLD",36,0)
 S $P(RCYYY("BILLING"),U,2)=RCBNM_"/"_RCBILL_"^"_0  ;NPI set into local array
"RTN","RCDPEWLD",37,0)
 I $D(RCXXX) S RCPROV="" F  S RCPROV=$O(RCXXX(399.0222,RCPROV)) Q:RCPROV=""  D  ;loop through claim providers
"RTN","RCDPEWLD",38,0)
 . S RCIEN=$P(RCXXX(399.0222,RCPROV,.02,"I"),";",1)
"RTN","RCDPEWLD",39,0)
 . S RCID=$S($P(RCXXX(399.0222,RCPROV,.02,"I"),";",2)["VA(200":"Individual_ID",1:"Non_VA_Provider_ID")
"RTN","RCDPEWLD",40,0)
 . S RCNPI=$$NPI^XUSNPI(RCID,RCIEN)                  ;retrieve provider NPI
"RTN","RCDPEWLD",41,0)
 . S $P(RCYYY(RCXXX(399.0222,RCPROV,.01,"E")),U,2)=$E(RCXXX(399.0222,RCPROV,.02,"E"),1,20)_"/"_$S(+RCNPI=0:"No NPI on file",+RCNPI=-1:"Can't look up NPI",1:+RCNPI)
"RTN","RCDPEWLD",42,0)
 . S:$P(RCYYY(RCXXX(399.0222,RCPROV,.01,"E")),U,3)="" $P(RCYYY(RCXXX(399.0222,RCPROV,.01,"E")),U,3)=0
"RTN","RCDPEWLD",43,0)
LINESET ;SET THE PRINT LINES
"RTN","RCDPEWLD",44,0)
 S (RCWARN,RCPROV)="" F  S RCPROV=$O(RCYYY(RCPROV)) Q:RCPROV=""  D  ;loop through the found provider types
"RTN","RCDPEWLD",45,0)
 . S RC=RC+1                                          ;increment line counter
"RTN","RCDPEWLD",46,0)
 . ; build display detail line
"RTN","RCDPEWLD",47,0)
 . S RCXM1(RC-1)=RCPROV_": "_$P(RCYYY(RCPROV),U,1)
"RTN","RCDPEWLD",48,0)
 . I $L(RCXM1(RC-1))>39 D
"RTN","RCDPEWLD",49,0)
 .. S RCXM1(RC-1)=$E($P(RCXM1(RC-1),"/"),1,27)_"/"_$P(RCXM1(RC-1),"/",2)
"RTN","RCDPEWLD",50,0)
 . S RCXM1(RC-1)=$E(RCXM1(RC-1)_RCBLANK,1,39)_$P(RCYYY(RCPROV),U,2)
"RTN","RCDPEWLD",51,0)
 . I $P(RCYYY(RCPROV),U,3)'=0 S RCWARN=$P(RCYYY(RCPROV),U,3)
"RTN","RCDPEWLD",52,0)
 I RCWARN'="" D
"RTN","RCDPEWLD",53,0)
 . S RC=RC+1,RCXM1(RC-1)=" "                          ;Blank line for separation
"RTN","RCDPEWLD",54,0)
 . S RC=RC+1,RCXM1(RC-1)="Rendering/Servicing Provider NPI Warning:"
"RTN","RCDPEWLD",55,0)
 . S RC=RC+1,RCXM1(RC-1)=RCWARN
"RTN","RCDPEWLD",56,0)
 S RC=RC+1,RCXM1(RC-1)=" "                            ;Blank line to separate from possible comments
"RTN","RCDPEWLD",57,0)
 S RCCOM1=$P(RCYNODE3,U,5),RCCOM2=$P(RCYNODE3,U,6) D  ;Error in NPI format
"RTN","RCDPEWLD",58,0)
 . I $G(RCCOM1)'="" S RC=RC+1,RCXM1(RC-1)=RCCOM1
"RTN","RCDPEWLD",59,0)
 . I $G(RCCOM2)'="" S RC=RC+1,RCXM1(RC-1)=RCCOM2
"RTN","RCDPEWLD",60,0)
 Q
"RTN","RCDPEWLD",61,0)
 ;
"RTN","RCDPEWLD",62,0)
NPICHK ;CHECK THAT THE NPI RETURNED MATCHES THE ENTITY TYPE QUALIFIER
"RTN","RCDPEWLD",63,0)
 S RCEXP="" Q:$P(RCYNODE3,U,3)=""               ; ENTITY TYPE QUALIFIER
"RTN","RCDPEWLD",64,0)
 ;
"RTN","RCDPEWLD",65,0)
 S RCCOM2=$P(RCYNODE3,U,6) ; Ren/Serv comment
"RTN","RCDPEWLD",66,0)
 S XUSNPI=$P(RCYNODE3,U,2)
"RTN","RCDPEWLD",67,0)
 I RCCOM2="",(XUSNPI="") S RCEXP="**NO SERVICING/RENDERING NPI INCLUDED IN 835**" D EXPSET Q
"RTN","RCDPEWLD",68,0)
 S RCRTN=$$QI^XUSNPI(XUSNPI)
"RTN","RCDPEWLD",69,0)
 I $P(RCRTN,U,1)="Individual_ID" D  Q
"RTN","RCDPEWLD",70,0)
 . I $P(RCYNODE3,U,3)'=1 S RCEXP="**NPI from 835 indicated organizational but is associated with an individual**" D EXPSET Q
"RTN","RCDPEWLD",71,0)
 I $P(RCRTN,U,1)="Organization_ID" D  Q
"RTN","RCDPEWLD",72,0)
 . I $P(RCYNODE3,U,3)'=2 S RCEXP="**NPI from 835 indicated individual but is associated with an organization**" D EXPSET Q
"RTN","RCDPEWLD",73,0)
 I $E($P(RCRTN,U,1),1,3)="Non" D  Q
"RTN","RCDPEWLD",74,0)
 . N RCIEN,RCTYPE S RCIEN=$P(RCRTN,U,2),RCTYPE=$$GET1^DIQ(355.93,RCIEN,.02,"I") Q:$G(RCTYPE)=""
"RTN","RCDPEWLD",75,0)
 . I $P(RCYNODE3,U,3)=1,RCTYPE=1 S RCEXP="**NPI from 835 indicated individual but is associated with an organization**" D EXPSET Q
"RTN","RCDPEWLD",76,0)
 . I $P(RCYNODE3,U,3)=2,RCTYPE=2 S RCEXP="**NPI from 835 indicated organizational but is associated with an individual**" D EXPSET Q
"RTN","RCDPEWLD",77,0)
 I RCCOM2="",(+RCRTN=0) S RCEXP="**The NPI returned on the 835 is not associated with this VistA system**" D EXPSET Q
"RTN","RCDPEWLD",78,0)
 Q
"RTN","RCDPEWLD",79,0)
 ;
"RTN","RCDPEWLD",80,0)
EXPSET ;SET THE PRINT LINE WITH THE ERROR AS DEFINED IN RCEXP
"RTN","RCDPEWLD",81,0)
 S $P(RCYYY(RCPROV),U,3)=RCEXP
"RTN","RCDPEWLD",82,0)
 Q
"RTN","RCDPEWLD",83,0)
 ;
"RTN","RCDPEWLD",84,0)
PARAMS(RCQUIT) ;PARAMETERS ENTRY CONTINUED FROM RCDPEWL0
"RTN","RCDPEWLD",85,0)
 I $G(RCQUIT) K ^TMP("RCERA_PARAMS",$J)
"RTN","RCDPEWLD",86,0)
PARMSQ ;
"RTN","RCDPEWLD",87,0)
 Q
"RTN","RCDPEWLD",88,0)
 ;
"RTN","RCDPEWLD",89,0)
PARAMS2() ;EP from RCDPEWL0
"RTN","RCDPEWLD",90,0)
 ; PRCA*4.5*317 - Moved due to routine size issues
"RTN","RCDPEWLD",91,0)
 ; Input:   None
"RTN","RCDPEWLD",92,0)
 ; Returns: RCQUIT  - 1 if user ^ or timed out, 0 otherwise
"RTN","RCDPEWLD",93,0)
 S RCQUIT=$$POSTSTAT()                      ; Ask Posting Status
"RTN","RCDPEWLD",94,0)
 Q:RCQUIT 1
"RTN","RCDPEWLD",95,0)
 S RCQUIT=$$POSTMETH                        ; Ask Posting Method
"RTN","RCDPEWLD",96,0)
 Q:RCQUIT 1
"RTN","RCDPEWLD",97,0)
 S RCQUIT=$$MATCHST                         ; Ask ERA-EFT Matching Status
"RTN","RCDPEWLD",98,0)
 Q:RCQUIT 1
"RTN","RCDPEWLD",99,0)
 S RCQUIT=$$CLAIMTYP()                      ; Ask Claim Type
"RTN","RCDPEWLD",100,0)
 Q:RCQUIT 1
"RTN","RCDPEWLD",101,0)
 S RCQUIT=$$PAYR()                          ; Ask for selected payers
"RTN","RCDPEWLD",102,0)
 Q RCQUIT
"RTN","RCDPEWLD",103,0)
 ;
"RTN","RCDPEWLD",104,0)
POSTSTAT() ; ERA Posting Status (Posted/Unposted/Both) Selection
"RTN","RCDPEWLD",105,0)
 ; Input:   ^TMP("RCERA_PARAMS")            - Global array of preferred values (if any)
"RTN","RCDPEWLD",106,0)
 ; Output:  ^TMP("RCERA_PARAMS",$J,"RCPOST")- ERA Posting Status filter
"RTN","RCDPEWLD",107,0)
 ; Returns: 1 if user quit or timed out, 0 otherwise
"RTN","RCDPEWLD",108,0)
 N DIR,DTOUT,DUOUT,RCPOSTDF
"RTN","RCDPEWLD",109,0)
 S RCPOSTDF=$G(^TMP("RCERA_PARAMS",$J,"RCPOST"))
"RTN","RCDPEWLD",110,0)
 K DIR S DIR(0)="SA^U:UNPOSTED;P:POSTED;B:BOTH"
"RTN","RCDPEWLD",111,0)
 S DIR("A")="ERA posting status: (U)NPOSTED, (P)OSTED, or (B)OTH: "
"RTN","RCDPEWLD",112,0)
 S DIR("B")="U"
"RTN","RCDPEWLD",113,0)
 S DIR("?",1)="Select UNPOSTED to only see ERAs with a status of UNPOSTED."
"RTN","RCDPEWLD",114,0)
 S DIR("?",2)="Select POSTED to only see ERAs with a status of POSTED."
"RTN","RCDPEWLD",115,0)
 S DIR("?")="Select BOTH to see both unposted and posted ERAs."
"RTN","RCDPEWLD",116,0)
 S:RCPOSTDF'="" DIR("B")=RCPOSTDF    ; Stored preferred value, use as default
"RTN","RCDPEWLD",117,0)
 W !
"RTN","RCDPEWLD",118,0)
 D ^DIR
"RTN","RCDPEWLD",119,0)
 I $D(DTOUT)!$D(DUOUT) Q 1
"RTN","RCDPEWLD",120,0)
 S ^TMP("RCERA_PARAMS",$J,"RCPOST")=Y
"RTN","RCDPEWLD",121,0)
 Q 0
"RTN","RCDPEWLD",122,0)
 ;
"RTN","RCDPEWLD",123,0)
POSTMETH()  ; PRCA*4.5*317 moved from RCDPEWL0 because of routine size issues
"RTN","RCDPEWLD",124,0)
 ; ERA Posting Method (Auto-Posting/Non Auto-Posting/Both) Selection
"RTN","RCDPEWLD",125,0)
 ; Input:   ^TMP("RCERA_PARAMS")             - Global array of preferred values (if any)
"RTN","RCDPEWLD",126,0)
 ; Output:  ^TMP("RCERA_PARAMS",$J,"RCAUTOP")- ERA Posting Status filter
"RTN","RCDPEWLD",127,0)
 ; Returns: 1 if user quit or timed out, 0 otherwise
"RTN","RCDPEWLD",128,0)
 N DIR,DTOUT,DUOUT,RCAUTOPDF
"RTN","RCDPEWLD",129,0)
 S RCAUTOPDF=$G(^TMP("RCERA_PARAMS",$J,"RCAUTOP"))
"RTN","RCDPEWLD",130,0)
 K DIR S DIR(0)="SA^A:AUTO-POSTING;N:NON AUTO-POSTING;B:BOTH"
"RTN","RCDPEWLD",131,0)
 S DIR("A")="Display (A)UTO-POSTING, (N)ON AUTO-POSTING, or (B)OTH: "
"RTN","RCDPEWLD",132,0)
 S DIR("B")="B"
"RTN","RCDPEWLD",133,0)
 S DIR("?",1)="Select AUTO-POSTING to only see auto-posted ERAs."
"RTN","RCDPEWLD",134,0)
 S DIR("?",2)="Select NON AUTO-POSTING to only see ERAs that were NOT auto-posted."
"RTN","RCDPEWLD",135,0)
 S DIR("?")="Select BOTH to see both auto-posted and non auto-posted ERAs."
"RTN","RCDPEWLD",136,0)
 S:RCAUTOPDF'="" DIR("B")=RCAUTOPDF    ;Stored preferred value, use as default
"RTN","RCDPEWLD",137,0)
 W !
"RTN","RCDPEWLD",138,0)
 D ^DIR
"RTN","RCDPEWLD",139,0)
 I $D(DTOUT)!$D(DUOUT) Q 1
"RTN","RCDPEWLD",140,0)
 S ^TMP("RCERA_PARAMS",$J,"RCAUTOP")=Y
"RTN","RCDPEWLD",141,0)
 Q 0
"RTN","RCDPEWLD",142,0)
 ;
"RTN","RCDPEWLD",143,0)
MATCHST()  ; ERA-EFT Matching Status(Matched/Unmatched/Both) Selection
"RTN","RCDPEWLD",144,0)
 ; Input:   ^TMP("RCERA_PARAMS")             - Global array of preferred values (if any)
"RTN","RCDPEWLD",145,0)
 ; Output:  ^TMP("RCERA_PARAMS",$J,"RCMATCH")- ERA Posting Status filter
"RTN","RCDPEWLD",146,0)
 ; Returns: 1 if user quit or timed out, 0 otherwise
"RTN","RCDPEWLD",147,0)
 N DIR,DTOUT,DUOUT,RCMATCHD
"RTN","RCDPEWLD",148,0)
 S RCMATCHD=$G(^TMP("RCERA_PARAMS",$J,"RCMATCH"))
"RTN","RCDPEWLD",149,0)
 K DIR S DIR(0)="SA^N:NOT MATCHED;M:MATCHED;B:BOTH"
"RTN","RCDPEWLD",150,0)
 S DIR("A")="ERA-EFT match status: (N)OT MATCHED, (M)ATCHED, or (B)OTH: "
"RTN","RCDPEWLD",151,0)
 S DIR("B")="B"
"RTN","RCDPEWLD",152,0)
 S DIR("?",1)="Select NOT MATCHED to only see unmatched ERAs."
"RTN","RCDPEWLD",153,0)
 S DIR("?",2)="Select MATCHED to only see matched ERAs."
"RTN","RCDPEWLD",154,0)
 S DIR("?")="Select BOTH to see both matched and unmatched ERAs."
"RTN","RCDPEWLD",155,0)
 S:RCMATCHD'="" DIR("B")=RCMATCHD      ;Stored preferred value, use as default
"RTN","RCDPEWLD",156,0)
 W !
"RTN","RCDPEWLD",157,0)
 D ^DIR
"RTN","RCDPEWLD",158,0)
 I $D(DTOUT)!$D(DUOUT) Q 1
"RTN","RCDPEWLD",159,0)
 S ^TMP("RCERA_PARAMS",$J,"RCMATCH")=Y
"RTN","RCDPEWLD",160,0)
 Q 0
"RTN","RCDPEWLD",161,0)
 ;
"RTN","RCDPEWLD",162,0)
CLAIMTYP()  ; Claim Type (Medical/Pharmacy/Both) Selection
"RTN","RCDPEWLD",163,0)
 ; Input:   ^TMP("RCERA_PARAMS")             - Global array of preferred values (if any)
"RTN","RCDPEWLD",164,0)
 ; Output:  ^TMP("RCERA_PARAMS",$J,"RCTYPE") - ERA Posting Status filter
"RTN","RCDPEWLD",165,0)
 ; Returns: 1 if user quit or timed out, 0 otherwise
"RTN","RCDPEWLD",166,0)
 N DIR,DTOUT,DUOUT,RCTYPEDF
"RTN","RCDPEWLD",167,0)
 S RCTYPEDF=$G(^TMP("RCERA_PARAMS",$J,"RCTYPE"))
"RTN","RCDPEWLD",168,0)
 K DIR S DIR(0)="SA^M:MEDICAL;P:PHARMACY;B:BOTH"
"RTN","RCDPEWLD",169,0)
 S DIR("A")="(M)EDICAL, (P)HARMACY, or (B)OTH: "
"RTN","RCDPEWLD",170,0)
 S DIR("B")="B"
"RTN","RCDPEWLD",171,0)
 S DIR("?",1)="Select MEDICAL to only see ERAs with a Claim Type of Medical."
"RTN","RCDPEWLD",172,0)
 S DIR("?",2)="Select PHARMACY to only see ERAs with a Claim Type of Pharmacy."
"RTN","RCDPEWLD",173,0)
 S DIR("?")="Select BOTH to see both medical and pharmacy ERAs"
"RTN","RCDPEWLD",174,0)
 S:RCTYPEDF'="" DIR("B")=RCTYPEDF     ;Stored preferred value, use as default
"RTN","RCDPEWLD",175,0)
 W !
"RTN","RCDPEWLD",176,0)
 D ^DIR
"RTN","RCDPEWLD",177,0)
 I $D(DTOUT)!$D(DUOUT) Q 1
"RTN","RCDPEWLD",178,0)
 S ^TMP("RCERA_PARAMS",$J,"RCTYPE")=Y
"RTN","RCDPEWLD",179,0)
 Q 0
"RTN","RCDPEWLD",180,0)
 ;
"RTN","RCDPEWLD",181,0)
PAYR() ; Payer Selection
"RTN","RCDPEWLD",182,0)
 ; Input:   ^TMP("RCERA_PARAMS",$J)          - Global array of preferred values (if any)
"RTN","RCDPEWLD",183,0)
 ; Output:  ^TMP("RCERA_PARAMS",$J,"RCTYPE") - ERA Posting Status filter
"RTN","RCDPEWLD",184,0)
 ; Returns: 1 if user quit or timed out, 0 otherwise
"RTN","RCDPEWLD",185,0)
 N DIR,DTOUT,DUOUT,PQUIT,RCPAYR,RCPAYRDF
"RTN","RCDPEWLD",186,0)
 S RCPAYRDF=$G(^TMP("RCERA_PARAMS",$J,"RCPAYR"))
"RTN","RCDPEWLD",187,0)
 S RCQUIT=0
"RTN","RCDPEWLD",188,0)
 K DIR S DIR(0)="SA^A:ALL;R:RANGE"
"RTN","RCDPEWLD",189,0)
 S DIR("A")="(A)LL payers, (R)ANGE of payer names: "
"RTN","RCDPEWLD",190,0)
 S DIR("B")="ALL"
"RTN","RCDPEWLD",191,0)
 S DIR("?",1)="Entering ALL will select all payers."
"RTN","RCDPEWLD",192,0)
 S DIR("?")="If RANGE is entered, you will be prompted for a payer range."
"RTN","RCDPEWLD",193,0)
 S:$P(RCPAYRDF,"^")'="" DIR("B")=$P(RCPAYRDF,"^",1)      ;Stored preferred value, use as default
"RTN","RCDPEWLD",194,0)
 W !
"RTN","RCDPEWLD",195,0)
 D ^DIR
"RTN","RCDPEWLD",196,0)
 I $D(DTOUT)!$D(DUOUT) Q 1
"RTN","RCDPEWLD",197,0)
 S RCPAYR=Y
"RTN","RCDPEWLD",198,0)
 I RCPAYR="A" S ^TMP("RCERA_PARAMS",$J,"RCPAYR")=Y       ;All payers selected
"RTN","RCDPEWLD",199,0)
 I RCPAYR="R" D  G:PQUIT PAYR
"RTN","RCDPEWLD",200,0)
 . S PQUIT=0
"RTN","RCDPEWLD",201,0)
 . W !,"Names you select here will be the payer names from the ERA, not the ins. file"
"RTN","RCDPEWLD",202,0)
 . K DIR
"RTN","RCDPEWLD",203,0)
 . S DIR("?")="Enter a name from 1 to 30 characters in UPPER CASE."
"RTN","RCDPEWLD",204,0)
 . S DIR(0)="FA^1:30^K:X'?.U X"
"RTN","RCDPEWLD",205,0)
 . S DIR("A")="Start with payer name: "
"RTN","RCDPEWLD",206,0)
 . S:$P(RCPAYRDF,"^",2)'="" DIR("B")=$P(RCPAYRDF,"^",2)  ;Stored preferred value, use as default
"RTN","RCDPEWLD",207,0)
 . W !
"RTN","RCDPEWLD",208,0)
 . D ^DIR
"RTN","RCDPEWLD",209,0)
 . I $D(DTOUT)!$D(DUOUT) D  Q
"RTN","RCDPEWLD",210,0)
 . . S PQUIT=1
"RTN","RCDPEWLD",211,0)
 . . K ^TMP("RCERA_PARAMS",$J,"RCPAYR")
"RTN","RCDPEWLD",212,0)
 . S RCPAYR("FROM")=Y
"RTN","RCDPEWLD",213,0)
 . K DIR
"RTN","RCDPEWLD",214,0)
 . S DIR("?")="Enter a name from 1 to 30 characters in UPPER CASE."
"RTN","RCDPEWLD",215,0)
 . S DIR(0)="FA^1:30^K:X'?.U X",DIR("A")="Go to payer name: "
"RTN","RCDPEWLD",216,0)
 . S DIR("B")=$E(RCPAYR("FROM"),1,27)_"ZZZ"
"RTN","RCDPEWLD",217,0)
 . S:$P(RCPAYRDF,"^",3)'="" DIR("B")=$P(RCPAYRDF,"^",3)   ;Stored preferred value, use as default
"RTN","RCDPEWLD",218,0)
 . W !
"RTN","RCDPEWLD",219,0)
 . D ^DIR
"RTN","RCDPEWLD",220,0)
 . I $D(DTOUT)!$D(DUOUT) S PQUIT=1 Q
"RTN","RCDPEWLD",221,0)
 . S ^TMP("RCERA_PARAMS",$J,"RCPAYR")=RCPAYR_"^"_RCPAYR("FROM")_"^"_Y
"RTN","RCDPEWLD",222,0)
 Q 0
"RTN","RCDPEWLD",223,0)
 ;
"VER")
8.0^22.0
"BLD",9532,6)
^278
**END**
**END**

