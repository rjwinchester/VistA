EMERGENCY Released PRCA*4.5*306 SEQ #267
Extracted from mail message
**KIDS**:PRCA*4.5*306^

**INSTALL NAME**
PRCA*4.5*306
"BLD",9786,0)
PRCA*4.5*306^ACCOUNTS RECEIVABLE^0^3140911^y
"BLD",9786,1,0)
^^1^1^3140909^
"BLD",9786,1,1,0)
Reverse DMC deposit
"BLD",9786,4,0)
^9.64PA^^
"BLD",9786,6.3)
3
"BLD",9786,"INID")
^n
"BLD",9786,"INIT")
POST^RC45P306
"BLD",9786,"KRN",0)
^9.67PA^779.2^20
"BLD",9786,"KRN",.4,0)
.4
"BLD",9786,"KRN",.401,0)
.401
"BLD",9786,"KRN",.402,0)
.402
"BLD",9786,"KRN",.403,0)
.403
"BLD",9786,"KRN",.5,0)
.5
"BLD",9786,"KRN",.84,0)
.84
"BLD",9786,"KRN",3.6,0)
3.6
"BLD",9786,"KRN",3.8,0)
3.8
"BLD",9786,"KRN",9.2,0)
9.2
"BLD",9786,"KRN",9.8,0)
9.8
"BLD",9786,"KRN",9.8,"NM",0)
^9.68A^2^2
"BLD",9786,"KRN",9.8,"NM",1,0)
RCDPXFIM^^0^B27621316
"BLD",9786,"KRN",9.8,"NM",2,0)
RCDPXFIX^^0^B88290331
"BLD",9786,"KRN",9.8,"NM","B","RCDPXFIM",1)

"BLD",9786,"KRN",9.8,"NM","B","RCDPXFIX",2)

"BLD",9786,"KRN",19,0)
19
"BLD",9786,"KRN",19.1,0)
19.1
"BLD",9786,"KRN",101,0)
101
"BLD",9786,"KRN",409.61,0)
409.61
"BLD",9786,"KRN",771,0)
771
"BLD",9786,"KRN",779.2,0)
779.2
"BLD",9786,"KRN",870,0)
870
"BLD",9786,"KRN",8989.51,0)
8989.51
"BLD",9786,"KRN",8989.52,0)
8989.52
"BLD",9786,"KRN",8994,0)
8994
"BLD",9786,"KRN","B",.4,.4)

"BLD",9786,"KRN","B",.401,.401)

"BLD",9786,"KRN","B",.402,.402)

"BLD",9786,"KRN","B",.403,.403)

"BLD",9786,"KRN","B",.5,.5)

"BLD",9786,"KRN","B",.84,.84)

"BLD",9786,"KRN","B",3.6,3.6)

"BLD",9786,"KRN","B",3.8,3.8)

"BLD",9786,"KRN","B",9.2,9.2)

"BLD",9786,"KRN","B",9.8,9.8)

"BLD",9786,"KRN","B",19,19)

"BLD",9786,"KRN","B",19.1,19.1)

"BLD",9786,"KRN","B",101,101)

"BLD",9786,"KRN","B",409.61,409.61)

"BLD",9786,"KRN","B",771,771)

"BLD",9786,"KRN","B",779.2,779.2)

"BLD",9786,"KRN","B",870,870)

"BLD",9786,"KRN","B",8989.51,8989.51)

"BLD",9786,"KRN","B",8989.52,8989.52)

"BLD",9786,"KRN","B",8994,8994)

"BLD",9786,"QDEF")
^^^^NO^^^^NO^^NO
"BLD",9786,"QUES",0)
^9.62^^
"BLD",9786,"REQB",0)
^9.611^1^1
"BLD",9786,"REQB",1,0)
PRCA*4.5*177^2
"BLD",9786,"REQB","B","PRCA*4.5*177",1)

"INIT")
POST^RC45P306
"MBREQ")
0
"PKG",142,-1)
1^1
"PKG",142,0)
ACCOUNTS RECEIVABLE^PRCA^BILL COLLECTIONS
"PKG",142,20,0)
^9.402P^1^1
"PKG",142,20,1,0)
2^^PRCAMRG
"PKG",142,20,1,1)

"PKG",142,20,"B",2,1)

"PKG",142,22,0)
^9.49I^1^1
"PKG",142,22,1,0)
4.5^^2950320
"PKG",142,22,1,"PAH",1,0)
306^3140911
"PKG",142,22,1,"PAH",1,1,0)
^^1^1^3140911
"PKG",142,22,1,"PAH",1,1,1,0)
Reverse DMC deposit
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
3
"RTN","RC45P306")
0^^B5407158^n/a
"RTN","RC45P306",1,0)
RC45P306 ;OAK/ELZ-POST-INSTALL PRCA*4.5*306 ROLLBACK DEPOSIT ;14-SEP-08
"RTN","RC45P306",2,0)
 ;;4.5;Accounts Receivable;**306**;Mar 20, 1995;Build 3
"RTN","RC45P306",3,0)
 ;;Per VA Directive 6402, this routine should not be modified.
"RTN","RC45P306",4,0)
 ;
"RTN","RC45P306",5,0)
 ;
"RTN","RC45P306",6,0)
POST ;This will find and backout a deposit that needs to be reversed
"RTN","RC45P306",7,0)
 ; the deposit ticket number is 16822 + 3 digit station number
"RTN","RC45P306",8,0)
 ; - explain job
"RTN","RC45P306",9,0)
 ;
"RTN","RC45P306",10,0)
 D BMES^XPDUTL(" Post-install for PRCA*4.5*306 Starting.")
"RTN","RC45P306",11,0)
 ;
"RTN","RC45P306",12,0)
 N RCDPOSIT,RCDPDT,RCDTOP,RCRCPT,RCDATA0,RCMSG,RCMSGC
"RTN","RC45P306",13,0)
 S RCMSGC=0
"RTN","RC45P306",14,0)
 S RCDPOSIT=16822_(+$P($$SITE^VASITE,"^",3))
"RTN","RC45P306",15,0)
 ;
"RTN","RC45P306",16,0)
 ; look up deposit
"RTN","RC45P306",17,0)
 S RCDPDT=$O(^RCY(344.1,"B",RCDPOSIT,0))
"RTN","RC45P306",18,0)
 I 'RCDPDT D  Q
"RTN","RC45P306",19,0)
 . D BMES^XPDUTL("  - Unable to find deposit "_RCDPOSIT_".")
"RTN","RC45P306",20,0)
 . D BMES^XPDUTL(" Nothing done, quitting post-install")
"RTN","RC45P306",21,0)
 ;
"RTN","RC45P306",22,0)
 ; display deposit found.
"RTN","RC45P306",23,0)
 D BMES^XPDUTL("  - Found deposit ticket "_RCDPOSIT_" **REVERSING**")
"RTN","RC45P306",24,0)
 S RCRCPT=0 F  S RCRCPT=$O(^RCY(344,"AD",RCDPDT,RCRCPT))  Q:'RCRCPT  D
"RTN","RC45P306",25,0)
 . S RCDATA0=$G(^RCY(344,RCRCPT,0))
"RTN","RC45P306",26,0)
 . S RCDTOP=$P(RCDATA0,"^",3)
"RTN","RC45P306",27,0)
 . I 'RCDTOP D   Q
"RTN","RC45P306",28,0)
 .. D BMES^XPDUTL("  - AR Batch Payment "_$P(RCDATA0,"^")_"has no date opened!")
"RTN","RC45P306",29,0)
 .. D BMES^XPDUTL("  CANNOT PROCESS IT FURTHER!")
"RTN","RC45P306",30,0)
 . S RCDTOP($P(RCDATA0,"^",3))=""
"RTN","RC45P306",31,0)
 . S RCMSGC=RCMSGC+1,RCMSG(RCMSGC)="  - Date Opened "_$$FMTE^XLFDT(RCDTOP)_" with "_$P($G(^RCY(344,RCRCPT,1,0)),"^",4)_" transactions"
"RTN","RC45P306",32,0)
 D BMES^XPDUTL(.RCMSG) K RCMSG
"RTN","RC45P306",33,0)
 ;
"RTN","RC45P306",34,0)
 ; call to roll back the deposit
"RTN","RC45P306",35,0)
 D BMES^XPDUTL("  - Rolling back deposit(s)...")
"RTN","RC45P306",36,0)
 S RCDTOP=0 F  S RCDTOP=$O(RCDTOP(RCDTOP)) Q:'RCDTOP  D REVERSE^RCDPXFIX(RCDPOSIT,RCDTOP)
"RTN","RC45P306",37,0)
 S RCMSG(1)="  - All done, the members of RCDP PAYMENTS will receive"
"RTN","RC45P306",38,0)
 S RCMSG(2)="    MailMan message(s) of the results."
"RTN","RC45P306",39,0)
 D BMES^XPDUTL(.RCMSG)
"RTN","RC45P306",40,0)
 ;
"RTN","RC45P306",41,0)
 D BMES^XPDUTL(" Post-install for PRCA*4.5*306 Complete.")
"RTN","RC45P306",42,0)
 ;
"RTN","RC45P306",43,0)
 Q
"RTN","RC45P306",44,0)
 ;
"RTN","RCDPXFIM")
0^1^B27621316^B25370977
"RTN","RCDPXFIM",1,0)
RCDPXFIM ;WISC/RFJ-generate mail message for removing duplicate deposit ;22 Mar 02
"RTN","RCDPXFIM",2,0)
 ;;4.5;Accounts Receivable;**177,306**;Mar 20, 1995;Build 3
"RTN","RCDPXFIM",3,0)
 ;;Per VA Directive 6402, this routine should not be modified.
"RTN","RCDPXFIM",4,0)
 Q
"RTN","RCDPXFIM",5,0)
 ;
"RTN","RCDPXFIM",6,0)
 ;
"RTN","RCDPXFIM",7,0)
MAIL(RCDPOSIT,RCTRANDT,RCMESSAG) ;  generate mail message to users
"RTN","RCDPXFIM",8,0)
 ;  RCDPOSIT is the deposit number, example 269296
"RTN","RCDPXFIM",9,0)
 ;  RCTRANDT is the transmission date, example 3001113
"RTN","RCDPXFIM",10,0)
 ;  RCMESSAG is the status of backing out the deposit. this variable
"RTN","RCDPXFIM",11,0)
 ;                  appears on the first line of the message.
"RTN","RCDPXFIM",12,0)
 ;
"RTN","RCDPXFIM",13,0)
 N %,COUNT,DATA,DATE,LINE,PPBILL,PPTRAN1,PPTRANS,RCBILLDA,RCTRAN1,RCTRANDA,TOTAL,TYPE,XMDUN,XMY,XMZ
"RTN","RCDPXFIM",14,0)
 ;
"RTN","RCDPXFIM",15,0)
 ;  generate mailman message to user
"RTN","RCDPXFIM",16,0)
 K ^TMP($J,"RCRJRCORMM")
"RTN","RCDPXFIM",17,0)
 S ^TMP($J,"RCRJRCORMM",1)=RCMESSAG
"RTN","RCDPXFIM",18,0)
 S ^TMP($J,"RCRJRCORMM",2)=" "
"RTN","RCDPXFIM",19,0)
 ;
"RTN","RCDPXFIM",20,0)
 ;**306 replacing this text with more generic text
"RTN","RCDPXFIM",21,0)
 ;S ^TMP($J,"RCRJRCORMM",3)="The following bills need to be reviewed.  Payments for deposit"
"RTN","RCDPXFIM",22,0)
 ;S ^TMP($J,"RCRJRCORMM",4)=RCDPOSIT_" were mailed from Austin to Accounts Receivable twice."
"RTN","RCDPXFIM",23,0)
 ;S ^TMP($J,"RCRJRCORMM",5)="AR has removed the duplicate deposit with a transmission date of"
"RTN","RCDPXFIM",24,0)
 ;S ^TMP($J,"RCRJRCORMM",6)=$E(RCTRANDT,4,5)_"/"_$E(RCTRANDT,6,7)_"/"_$E(RCTRANDT,2,3)_"."
"RTN","RCDPXFIM",25,0)
 ;S ^TMP($J,"RCRJRCORMM",7)=" "
"RTN","RCDPXFIM",26,0)
 ;S ^TMP($J,"RCRJRCORMM",8)="This mailman message shows those bills where payments were"
"RTN","RCDPXFIM",27,0)
 ;S ^TMP($J,"RCRJRCORMM",9)="removed for the duplicate deposit.  The payment transactions"
"RTN","RCDPXFIM",28,0)
 ;S ^TMP($J,"RCRJRCORMM",10)="listed below have been marked incomplete.  You may want to"
"RTN","RCDPXFIM",29,0)
 ;S ^TMP($J,"RCRJRCORMM",11)="review the bills and verify the balances."
"RTN","RCDPXFIM",30,0)
 ;
"RTN","RCDPXFIM",31,0)
 ; **306 new text
"RTN","RCDPXFIM",32,0)
 S ^TMP($J,"RCRJRCORMM",3)="The following bills need to be reviewed.  Payments for"
"RTN","RCDPXFIM",33,0)
 S ^TMP($J,"RCRJRCORMM",4)="deposit "_RCDPOSIT_" were sent from Austin to Accounts"
"RTN","RCDPXFIM",34,0)
 S ^TMP($J,"RCRJRCORMM",5)="Receivable.  AR has removed the deposit."
"RTN","RCDPXFIM",35,0)
 S ^TMP($J,"RCRJRCORMM",6)=""
"RTN","RCDPXFIM",36,0)
 S ^TMP($J,"RCRJRCORMM",7)="This mailman message shows those bills where payments were"
"RTN","RCDPXFIM",37,0)
 S ^TMP($J,"RCRJRCORMM",8)="removed from the deposit.  The payment transactions listed"
"RTN","RCDPXFIM",38,0)
 S ^TMP($J,"RCRJRCORMM",9)="below have been marked incomplete.  You may want to review"
"RTN","RCDPXFIM",39,0)
 S ^TMP($J,"RCRJRCORMM",10)="the bills and verify the balances."
"RTN","RCDPXFIM",40,0)
 S ^TMP($J,"RCRJRCORMM",11)=" "
"RTN","RCDPXFIM",41,0)
 S ^TMP($J,"RCRJRCORMM",12)=" "
"RTN","RCDPXFIM",42,0)
 ;
"RTN","RCDPXFIM",43,0)
 S ^TMP($J,"RCRJRCORMM",13)="BILL                               PAYMENT     TRANS     "_$J("PAYMENT",10)_$J("NEW BILL",10)
"RTN","RCDPXFIM",44,0)
 S ^TMP($J,"RCRJRCORMM",14)="NUMBER       BILL TYPE             TRANS#      DATE      "_$J("AMOUNT",10)_$J("AMOUNT",10)
"RTN","RCDPXFIM",45,0)
 S ^TMP($J,"RCRJRCORMM",15)="-----------------------------------------------------------------------------"
"RTN","RCDPXFIM",46,0)
 S LINE=15
"RTN","RCDPXFIM",47,0)
 ;
"RTN","RCDPXFIM",48,0)
 S TOTAL=0
"RTN","RCDPXFIM",49,0)
 S RCBILLDA=0 F  S RCBILLDA=$O(^TMP("RCDPXFIX",$J,RCBILLDA)) Q:'RCBILLDA  D
"RTN","RCDPXFIM",50,0)
 .   S COUNT=0
"RTN","RCDPXFIM",51,0)
 .   S RCTRANDA=0 F  S RCTRANDA=$O(^TMP("RCDPXFIX",$J,RCBILLDA,RCTRANDA)) Q:'RCTRANDA  D
"RTN","RCDPXFIM",52,0)
 .   .   S RCTRAN1=$G(^PRCA(433,RCTRANDA,1))
"RTN","RCDPXFIM",53,0)
 .   .   S TYPE=$P($G(^PRCA(430.2,+$P($G(^PRCA(430,RCBILLDA,0)),"^",2),0)),"^")
"RTN","RCDPXFIM",54,0)
 .   .   ;
"RTN","RCDPXFIM",55,0)
 .   .   ;  show bill (use count to for showing it different the second time)
"RTN","RCDPXFIM",56,0)
 .   .   S DATA=$E($P(^PRCA(430,RCBILLDA,0),"^")_"                ",1,13)_$E(TYPE_"               ",1,15)
"RTN","RCDPXFIM",57,0)
 .   .   I COUNT=1 S DATA="             "_"               "
"RTN","RCDPXFIM",58,0)
 .   .   S COUNT=1
"RTN","RCDPXFIM",59,0)
 .   .   ;
"RTN","RCDPXFIM",60,0)
 .   .   ;  show as increase or decrease
"RTN","RCDPXFIM",61,0)
 .   .   S %="     "
"RTN","RCDPXFIM",62,0)
 .   .   I TYPE["PREPAY" S %=$S($P(RCTRAN1,"^",2)=1:"INC",1:"DEC")_"  "
"RTN","RCDPXFIM",63,0)
 .   .   S DATA=DATA_%
"RTN","RCDPXFIM",64,0)
 .   .   ;
"RTN","RCDPXFIM",65,0)
 .   .   ;  show transaction number
"RTN","RCDPXFIM",66,0)
 .   .   S DATA=DATA_"  "_$E(RCTRANDA_"               ",1,12)
"RTN","RCDPXFIM",67,0)
 .   .   ;
"RTN","RCDPXFIM",68,0)
 .   .   ;  show transaction date
"RTN","RCDPXFIM",69,0)
 .   .   S DATE=$P(RCTRAN1,"^",9) I DATE="" S DATE="       "
"RTN","RCDPXFIM",70,0)
 .   .   S DATA=DATA_$E(DATE,4,5)_"/"_$E(DATE,6,7)_"/"_$E(DATE,2,3)_"  "
"RTN","RCDPXFIM",71,0)
 .   .   ;
"RTN","RCDPXFIM",72,0)
 .   .   ;  show amount paid (show decrease as negative)
"RTN","RCDPXFIM",73,0)
 .   .   I $P(RCTRAN1,"^",2)=35 S $P(RCTRAN1,"^",5)=-$P(RCTRAN1,"^",5)
"RTN","RCDPXFIM",74,0)
 .   .   S DATA=DATA_$J($P(RCTRAN1,"^",5),10,2)
"RTN","RCDPXFIM",75,0)
 .   .   S TOTAL=TOTAL+$P(RCTRAN1,"^",5)
"RTN","RCDPXFIM",76,0)
 .   .   ;
"RTN","RCDPXFIM",77,0)
 .   .   ;  show new bill balance
"RTN","RCDPXFIM",78,0)
 .   .   S %=$G(^PRCA(430,RCBILLDA,7)) S %=$P(%,"^")+$P(%,"^",2)+$P(%,"^",3)+$P(%,"^",4)+$P(%,"^",5)
"RTN","RCDPXFIM",79,0)
 .   .   S DATA=DATA_$J(%,10,2)
"RTN","RCDPXFIM",80,0)
 .   .   ;
"RTN","RCDPXFIM",81,0)
 .   .   ;  store the line
"RTN","RCDPXFIM",82,0)
 .   .   S LINE=LINE+1,^TMP($J,"RCRJRCORMM",LINE)=DATA
"RTN","RCDPXFIM",83,0)
 .   .   ;
"RTN","RCDPXFIM",84,0)
 .   .   ;  if there is a prepayment transaction on the bill, show that one also
"RTN","RCDPXFIM",85,0)
 .   .   S PPTRANS=$P($G(^PRCA(433,RCTRANDA,5)),"^")
"RTN","RCDPXFIM",86,0)
 .   .   I PPTRANS D
"RTN","RCDPXFIM",87,0)
 .   .   .   S PPTRAN1=$G(^PRCA(433,PPTRANS,1))
"RTN","RCDPXFIM",88,0)
 .   .   .   ;  show bill paid by the prepayment
"RTN","RCDPXFIM",89,0)
 .   .   .   S PPBILL=+$P($G(^PRCA(433,PPTRANS,0)),"^",2)
"RTN","RCDPXFIM",90,0)
 .   .   .   S DATA="             "_$E("PREPAID "_$P($G(^PRCA(430,PPBILL,0)),"^")_"                    ",1,20)
"RTN","RCDPXFIM",91,0)
 .   .   .   S DATA=DATA_"  "_$E(PPTRANS_"            ",1,12)
"RTN","RCDPXFIM",92,0)
 .   .   .   ;
"RTN","RCDPXFIM",93,0)
 .   .   .   ;  show transaction date
"RTN","RCDPXFIM",94,0)
 .   .   .   S DATE=$P(PPTRAN1,"^",9) I DATE="" S DATE="       "
"RTN","RCDPXFIM",95,0)
 .   .   .   S DATA=DATA_$E(DATE,4,5)_"/"_$E(DATE,6,7)_"/"_$E(DATE,2,3)_"  "
"RTN","RCDPXFIM",96,0)
 .   .   .   ;
"RTN","RCDPXFIM",97,0)
 .   .   .   ;  show amount paid
"RTN","RCDPXFIM",98,0)
 .   .   .   S DATA=DATA_$J($P(PPTRAN1,"^",5),10,2)
"RTN","RCDPXFIM",99,0)
 .   .   .   S TOTAL=TOTAL+$P(PPTRAN1,"^",5)
"RTN","RCDPXFIM",100,0)
 .   .   .   ;
"RTN","RCDPXFIM",101,0)
 .   .   .   ;  show new bill balance
"RTN","RCDPXFIM",102,0)
 .   .   .   S %=$G(^PRCA(430,PPBILL,7)) S %=$P(%,"^")+$P(%,"^",2)+$P(%,"^",3)+$P(%,"^",4)+$P(%,"^",5)
"RTN","RCDPXFIM",103,0)
 .   .   .   S DATA=DATA_$J(%,10,2)
"RTN","RCDPXFIM",104,0)
 .   .   .   ;
"RTN","RCDPXFIM",105,0)
 .   .   .   ;  store the line
"RTN","RCDPXFIM",106,0)
 .   .   .   S LINE=LINE+1,^TMP($J,"RCRJRCORMM",LINE)=DATA
"RTN","RCDPXFIM",107,0)
 ;
"RTN","RCDPXFIM",108,0)
 I LINE=15 S ^TMP($J,"RCRJRCORMM",16)="<<No Bills Or Transactions Found For You to Review>>"
"RTN","RCDPXFIM",109,0)
 E  S LINE=LINE+1,^TMP($J,"RCRJRCORMM",LINE)="                                               TOTAL PAID"_$J(TOTAL,10,2)
"RTN","RCDPXFIM",110,0)
 ;
"RTN","RCDPXFIM",111,0)
 ;  send mail message
"RTN","RCDPXFIM",112,0)
 N DIFROM  ;  need to be newed or mailman will not deliver the message
"RTN","RCDPXFIM",113,0)
 S XMY("G.RCDP PAYMENTS")=""
"RTN","RCDPXFIM",114,0)
 S XMY(.5)=""
"RTN","RCDPXFIM",115,0)
 S XMY(DUZ)=""
"RTN","RCDPXFIM",116,0)
 ; **306 removing "duplicate" to make more generic
"RTN","RCDPXFIM",117,0)
 ;S XMZ=$$SENDMSG^RCRJRCOR("AR Duplicate Deposit "_RCDPOSIT_" removed",.XMY)
"RTN","RCDPXFIM",118,0)
 S XMZ=$$SENDMSG^RCRJRCOR("AR Deposit "_RCDPOSIT_" removed",.XMY)
"RTN","RCDPXFIM",119,0)
 K ^TMP($J,"RCRJRCORMM")
"RTN","RCDPXFIM",120,0)
 Q
"RTN","RCDPXFIX")
0^2^B88290331^B78572229
"RTN","RCDPXFIX",1,0)
RCDPXFIX ;WISC/RFJ -fix duplicate deposits (! be careful using this !) ;22 Mar 02
"RTN","RCDPXFIX",2,0)
 ;;4.5;Accounts Receivable;**177,306**;Mar 20, 1995;Build 3
"RTN","RCDPXFIX",3,0)
 ;;Per VA Directive 6402, this routine should not be modified.
"RTN","RCDPXFIX",4,0)
 ;
"RTN","RCDPXFIX",5,0)
 ;  this routine is used to back out a duplicate deposit that has
"RTN","RCDPXFIX",6,0)
 ;  been posted to first party bills.  do not use this routine
"RTN","RCDPXFIX",7,0)
 ;  unless instructed to by software design and development or
"RTN","RCDPXFIX",8,0)
 ;  national verification and support.  
"RTN","RCDPXFIX",9,0)
 Q
"RTN","RCDPXFIX",10,0)
 ;
"RTN","RCDPXFIX",11,0)
 ;
"RTN","RCDPXFIX",12,0)
REVERSE(RCDPOSIT,RCTRANDT) ;  back out deposit RCDPOSIT
"RTN","RCDPXFIX",13,0)
 ;  RCDPOSIT is the deposit number, example 269296
"RTN","RCDPXFIX",14,0)
 ;  RCTRANDT is the transmission date, example 3001113
"RTN","RCDPXFIX",15,0)
 ;
"RTN","RCDPXFIX",16,0)
 ;
"RTN","RCDPXFIX",17,0)
 N %,RCBILLDA,RCDATA0,RCDPDT,RCFTEST,RCMESSAG,RCRCPT,RCTRAN1,RCTRANDA,X
"RTN","RCDPXFIX",18,0)
 K ^TMP("RCDPXFIX",$J)
"RTN","RCDPXFIX",19,0)
 ;
"RTN","RCDPXFIX",20,0)
 ;  this is used for internal testing
"RTN","RCDPXFIX",21,0)
 ;S RCFTEST=0   ;  NO, do not make updates to the database
"RTN","RCDPXFIX",22,0)
 S RCFTEST=1  ;  YES, make changes to the database
"RTN","RCDPXFIX",23,0)
 ;
"RTN","RCDPXFIX",24,0)
 ; **306 removing text that says "duplicate"
"RTN","RCDPXFIX",25,0)
 ;  set default message to send to user
"RTN","RCDPXFIX",26,0)
 ;S RCMESSAG="Duplicate deposit "_RCDPOSIT_" with a transmission date of "_$E(RCTRANDT,4,5)_"/"_$E(RCTRANDT,6,7)_"/"_$E(RCTRANDT,2,3)_" was not found."
"RTN","RCDPXFIX",27,0)
 S RCMESSAG="Deposit "_RCDPOSIT_" with a transmission date of "_$E(RCTRANDT,4,5)_"/"_$E(RCTRANDT,6,7)_"/"_$E(RCTRANDT,2,3)_" was not found."
"RTN","RCDPXFIX",28,0)
 ;
"RTN","RCDPXFIX",29,0)
 ;  find deposit which was posted erroneously, if no date then it is not found
"RTN","RCDPXFIX",30,0)
 S RCDPDT=$O(^RCY(344.1,"B",RCDPOSIT,0)) I 'RCDPDT D MAIL^RCDPXFIM(RCDPOSIT,RCTRANDT,RCMESSAG) Q
"RTN","RCDPXFIX",31,0)
 ;
"RTN","RCDPXFIX",32,0)
 ;  find receipts for deposit
"RTN","RCDPXFIX",33,0)
 S RCRCPT=0 F  S RCRCPT=$O(^RCY(344,"AD",RCDPDT,RCRCPT))  Q:'RCRCPT  D
"RTN","RCDPXFIX",34,0)
 .   S RCDATA0=$G(^RCY(344,RCRCPT,0))
"RTN","RCDPXFIX",35,0)
 .   ;  check to see if the date opened is equal to the transmission date
"RTN","RCDPXFIX",36,0)
 .   I $P(RCDATA0,"^",3)'=RCTRANDT Q
"RTN","RCDPXFIX",37,0)
 .   ;
"RTN","RCDPXFIX",38,0)
 .   ; ** 306, removing "duplicate"
"RTN","RCDPXFIX",39,0)
 .   ;  deposit already backed out (the *end date is set once backed out)
"RTN","RCDPXFIX",40,0)
 .   ;I $P(RCDATA0,"^",10) S RCMESSAG="Duplicate Deposit "_RCDPOSIT_" was previously backed out on "_$E($P(RCDATA0,"^",10),4,5)_"/"_$E($P(RCDATA0,"^",10),6,7)_"/"_$E($P(RCDATA0,"^",10),2,3)_"." Q
"RTN","RCDPXFIX",41,0)
 .   I $P(RCDATA0,"^",10) S RCMESSAG="Deposit "_RCDPOSIT_" was previously backed out on "_$E($P(RCDATA0,"^",10),4,5)_"/"_$E($P(RCDATA0,"^",10),6,7)_"/"_$E($P(RCDATA0,"^",10),2,3)_"." Q
"RTN","RCDPXFIX",42,0)
 .   ;
"RTN","RCDPXFIX",43,0)
 .   ;  found deposit/receipt and it needs to be backed out
"RTN","RCDPXFIX",44,0)
 .   ;S RCMESSAG="Duplicate deposit "_RCDPOSIT_" with a transmission date of "_$E(RCTRANDT,4,5)_"/"_$E(RCTRANDT,6,7)_"/"_$E(RCTRANDT,2,3)_" has been removed."
"RTN","RCDPXFIX",45,0)
 .   S RCMESSAG="Deposit "_RCDPOSIT_" with a transmission date of "_$E(RCTRANDT,4,5)_"/"_$E(RCTRANDT,6,7)_"/"_$E(RCTRANDT,2,3)_" has been removed."
"RTN","RCDPXFIX",46,0)
 .   ;
"RTN","RCDPXFIX",47,0)
 .   ;  loop payments made in transaction 433 file
"RTN","RCDPXFIX",48,0)
 .   S RCTRANDA=0 F  S RCTRANDA=$O(^PRCA(433,"AF",$P(RCDATA0,"^"),RCTRANDA)) Q:'RCTRANDA  D
"RTN","RCDPXFIX",49,0)
 .   .   ;  transaction is already marked incomplete
"RTN","RCDPXFIX",50,0)
 .   .   I $P(^PRCA(433,RCTRANDA,0),"^",4)=1 Q
"RTN","RCDPXFIX",51,0)
 .   .   ;
"RTN","RCDPXFIX",52,0)
 .   .   ;  lock the transaction
"RTN","RCDPXFIX",53,0)
 .   .   L +^PRCA(433,RCTRANDA)
"RTN","RCDPXFIX",54,0)
 .   .   ;
"RTN","RCDPXFIX",55,0)
 .   .   ;  get transaction data
"RTN","RCDPXFIX",56,0)
 .   .   S RCTRAN1=$G(^PRCA(433,RCTRANDA,1))
"RTN","RCDPXFIX",57,0)
 .   .   S RCBILLDA=$P(^PRCA(433,RCTRANDA,0),"^",2)
"RTN","RCDPXFIX",58,0)
 .   .   ;
"RTN","RCDPXFIX",59,0)
 .   .   ;  lock the bill
"RTN","RCDPXFIX",60,0)
 .   .   L +^PRCA(430,RCBILLDA)
"RTN","RCDPXFIX",61,0)
 .   .   ;
"RTN","RCDPXFIX",62,0)
 .   .   ;
"RTN","RCDPXFIX",63,0)
 .   .   ;  transaction type = payment in part (2) or
"RTN","RCDPXFIX",64,0)
 .   .   ;  transaction type = payment in full (34)
"RTN","RCDPXFIX",65,0)
 .   .   I $P(RCTRAN1,"^",2)=2!($P(RCTRAN1,"^",2)=34) D PAYMENT(RCTRANDA,1)
"RTN","RCDPXFIX",66,0)
 .   .   ;
"RTN","RCDPXFIX",67,0)
 .   .   ;
"RTN","RCDPXFIX",68,0)
 .   .   ;  transaction type = prepayment [increase adjustment (1)]
"RTN","RCDPXFIX",69,0)
 .   .   I $P(RCTRAN1,"^",2)=1 D PREPAY
"RTN","RCDPXFIX",70,0)
 .   .   ;
"RTN","RCDPXFIX",71,0)
 .   .   ;  unlock the bill and transaction
"RTN","RCDPXFIX",72,0)
 .   .   L -^PRCA(430,RCBILLDA)
"RTN","RCDPXFIX",73,0)
 .   .   L -^PRCA(433,RCTRANDA)
"RTN","RCDPXFIX",74,0)
 .   ;
"RTN","RCDPXFIX",75,0)
 .   ;  make changes to the payments on the receipt
"RTN","RCDPXFIX",76,0)
 .   D RECEIPT(RCDPOSIT,RCTRANDT,RCRCPT)
"RTN","RCDPXFIX",77,0)
 .   ;
"RTN","RCDPXFIX",78,0)
 .   ;  set piece 10 in receipt to show patch as being installed
"RTN","RCDPXFIX",79,0)
 .   I RCFTEST D NOW^%DTC S $P(^RCY(344,RCRCPT,0),"^",10)=%
"RTN","RCDPXFIX",80,0)
 ;
"RTN","RCDPXFIX",81,0)
 D MAIL^RCDPXFIM(RCDPOSIT,RCTRANDT,RCMESSAG)
"RTN","RCDPXFIX",82,0)
 ;
"RTN","RCDPXFIX",83,0)
 K ^TMP("RCDPXFIX",$J)
"RTN","RCDPXFIX",84,0)
 Q
"RTN","RCDPXFIX",85,0)
 ;
"RTN","RCDPXFIX",86,0)
 ;
"RTN","RCDPXFIX",87,0)
PAYMENT(RCTRANDA,RCFREPRT) ;  mark payment transaction as incomplete and adjust bill
"RTN","RCDPXFIX",88,0)
 ;  pass rcfrept equal to 1 to build mailman report.  since prepayment
"RTN","RCDPXFIX",89,0)
 ;  payments to other bills are already printed on report, pass a zero
"RTN","RCDPXFIX",90,0)
 ;  to stop the setting of the tmp global
"RTN","RCDPXFIX",91,0)
 ;
"RTN","RCDPXFIX",92,0)
 N %,DATA0,FYDA,PIECE,RCBILLDA,RCBILL7,RCCOMMNT,RCREPDA,RCTRAN3
"RTN","RCDPXFIX",93,0)
 ;  amount paid
"RTN","RCDPXFIX",94,0)
 S RCTRAN3=$G(^PRCA(433,RCTRANDA,3))
"RTN","RCDPXFIX",95,0)
 ;  get the bill
"RTN","RCDPXFIX",96,0)
 S RCBILLDA=$P($G(^PRCA(433,RCTRANDA,0)),"^",2)
"RTN","RCDPXFIX",97,0)
 ;
"RTN","RCDPXFIX",98,0)
 ;  reset the 7 node on the bill
"RTN","RCDPXFIX",99,0)
 S RCBILL7=$G(^PRCA(430,RCBILLDA,7))
"RTN","RCDPXFIX",100,0)
 F PIECE=1:1:5 D
"RTN","RCDPXFIX",101,0)
 .   ;  add the payment back to the bills balance
"RTN","RCDPXFIX",102,0)
 .   S $P(RCBILL7,"^",PIECE)=$P(RCBILL7,"^",PIECE)+$P(RCTRAN3,"^",PIECE)
"RTN","RCDPXFIX",103,0)
 .   ;  subtract the payment made for the bill
"RTN","RCDPXFIX",104,0)
 .   S $P(RCBILL7,"^",PIECE+6)=$P(RCBILL7,"^",PIECE+6)-$P(RCTRAN3,"^",PIECE)
"RTN","RCDPXFIX",105,0)
 .   I RCFTEST S ^PRCA(430,RCBILLDA,7)=RCBILL7
"RTN","RCDPXFIX",106,0)
 ;
"RTN","RCDPXFIX",107,0)
 ;  make sure the bill is active (16) if collected/closed (22)
"RTN","RCDPXFIX",108,0)
 I $P(^PRCA(430,RCBILLDA,0),"^",8)=22 I RCFTEST S %=$$EDIT430^RCBEUBIL(RCBILLDA,"8////16;")
"RTN","RCDPXFIX",109,0)
 ;
"RTN","RCDPXFIX",110,0)
 ;  reset the fiscal year multiple
"RTN","RCDPXFIX",111,0)
 S FYDA=$O(^PRCA(430,RCBILLDA,2,999),-1)
"RTN","RCDPXFIX",112,0)
 I $G(^PRCA(430,RCBILLDA,2,+FYDA,0))'="" I RCFTEST S $P(^PRCA(430,RCBILLDA,2,FYDA,0),"^",2)=$P(RCBILL7,"^")
"RTN","RCDPXFIX",113,0)
 ;
"RTN","RCDPXFIX",114,0)
 ;  remove repayment plans
"RTN","RCDPXFIX",115,0)
 S RCREPDA=0 F  S RCREPDA=$O(^PRCA(430,RCBILLDA,5,RCREPDA)) Q:'RCREPDA  D
"RTN","RCDPXFIX",116,0)
 .   S DATA0=$G(^PRCA(430,RCBILLDA,5,RCREPDA,0))
"RTN","RCDPXFIX",117,0)
 .   I $P(DATA0,"^",4)'=RCTRANDA Q
"RTN","RCDPXFIX",118,0)
 .   ;  found one, remove it
"RTN","RCDPXFIX",119,0)
 .   I RCFTEST S ^PRCA(430,RCBILLDA,5,RCREPDA,0)=$P(DATA0,"^")_"^0"
"RTN","RCDPXFIX",120,0)
 ;
"RTN","RCDPXFIX",121,0)
 ;  set the payment transaction to incomplete
"RTN","RCDPXFIX",122,0)
 I RCFTEST S $P(^PRCA(433,RCTRANDA,0),"^",4)=1
"RTN","RCDPXFIX",123,0)
 ;
"RTN","RCDPXFIX",124,0)
 ; **306, removing "dupicate"
"RTN","RCDPXFIX",125,0)
 ;  add comment to transaction
"RTN","RCDPXFIX",126,0)
 ;S RCCOMMNT(1)="Duplicate deposit "_RCDPOSIT_" with transmission date "_$E(RCTRANDT,4,5)_"/"_$E(RCTRANDT,6,7)_"/"_$E(RCTRANDT,2,3)_" removed."
"RTN","RCDPXFIX",127,0)
 S RCCOMMNT(1)="Deposit "_RCDPOSIT_" with transmission date "_$E(RCTRANDT,4,5)_"/"_$E(RCTRANDT,6,7)_"/"_$E(RCTRANDT,2,3)_" removed."
"RTN","RCDPXFIX",128,0)
 I RCFTEST D ADDCOMM^RCBEUTRA(RCTRANDA,.RCCOMMNT)
"RTN","RCDPXFIX",129,0)
 ;
"RTN","RCDPXFIX",130,0)
 ;  build mailman message
"RTN","RCDPXFIX",131,0)
 I RCFREPRT S ^TMP("RCDPXFIX",$J,RCBILLDA,RCTRANDA)=""
"RTN","RCDPXFIX",132,0)
 Q
"RTN","RCDPXFIX",133,0)
 ;
"RTN","RCDPXFIX",134,0)
 ;
"RTN","RCDPXFIX",135,0)
PREPAY ;  fix a prepayment
"RTN","RCDPXFIX",136,0)
 ;  at entry point, rctranda is the increase adjustment to rcbillda
"RTN","RCDPXFIX",137,0)
 ;
"RTN","RCDPXFIX",138,0)
 N RCBILL7,RCDECADJ,RCPAYAMT,PAYTRAN
"RTN","RCDPXFIX",139,0)
 S RCBILL7=$G(^PRCA(430,RCBILLDA,7))
"RTN","RCDPXFIX",140,0)
 ;
"RTN","RCDPXFIX",141,0)
 ;  simple, prepayment has not been used against another bill:
"RTN","RCDPXFIX",142,0)
 ;    get rid of the increase adjustment
"RTN","RCDPXFIX",143,0)
 I $P(RCBILL7,"^")'<$P($G(^PRCA(433,RCTRANDA,1)),"^",5) D PREPAYAD(RCTRANDA) Q
"RTN","RCDPXFIX",144,0)
 ;
"RTN","RCDPXFIX",145,0)
 ;  prepayment has been used against other bills:
"RTN","RCDPXFIX",146,0)
 ;    get rid of the payments to other bills
"RTN","RCDPXFIX",147,0)
 ;    get rid of the decrease adjustments to prepayment bill
"RTN","RCDPXFIX",148,0)
 ;    get rid of the increase adjustment to prepayment bill
"RTN","RCDPXFIX",149,0)
 S RCPAYAMT=$P($G(^PRCA(433,RCTRANDA,1)),"^",5)
"RTN","RCDPXFIX",150,0)
 S RCDECADJ=RCTRANDA F  S RCDECADJ=$O(^PRCA(433,"C",RCBILLDA,RCDECADJ)) Q:'RCDECADJ  D  I 'RCPAYAMT Q
"RTN","RCDPXFIX",151,0)
 .   ;  not a decrease adjustment
"RTN","RCDPXFIX",152,0)
 .   I $P($G(^PRCA(433,RCDECADJ,1)),"^",2)'=35 Q
"RTN","RCDPXFIX",153,0)
 .   ;
"RTN","RCDPXFIX",154,0)
 .   ;  lock the decrease adjustment
"RTN","RCDPXFIX",155,0)
 .   L +^PRCA(433,RCDECADJ)
"RTN","RCDPXFIX",156,0)
 .   ;
"RTN","RCDPXFIX",157,0)
 .   ;  get the payment transaction (433) that goes with decrease
"RTN","RCDPXFIX",158,0)
 .   ;  to prepayment bill
"RTN","RCDPXFIX",159,0)
 .   S PAYTRAN=$P($G(^PRCA(433,RCDECADJ,5)),"^",1)
"RTN","RCDPXFIX",160,0)
 .   ;
"RTN","RCDPXFIX",161,0)
 .   ;  lock the payment transaction
"RTN","RCDPXFIX",162,0)
 .   L +^PRCA(433,PAYTRAN)
"RTN","RCDPXFIX",163,0)
 .   ;
"RTN","RCDPXFIX",164,0)
 .   ;  get rid of the payment transaction, activate bill
"RTN","RCDPXFIX",165,0)
 .   ;  pass a zero so it does not show on mailman report twice
"RTN","RCDPXFIX",166,0)
 .   I PAYTRAN D PAYMENT(PAYTRAN,0)
"RTN","RCDPXFIX",167,0)
 .   ;
"RTN","RCDPXFIX",168,0)
 .   ;  get rid of decrease adjustment
"RTN","RCDPXFIX",169,0)
 .   D PREPAYAD(RCDECADJ)
"RTN","RCDPXFIX",170,0)
 .   ;
"RTN","RCDPXFIX",171,0)
 .   ;  subtract the decrease adjustment from the payment amount
"RTN","RCDPXFIX",172,0)
 .   ;  do this till it reaches zero
"RTN","RCDPXFIX",173,0)
 .   S RCPAYAMT=RCPAYAMT-$P($G(^PRCA(433,RCDECADJ,1)),"^",5)
"RTN","RCDPXFIX",174,0)
 .   ;
"RTN","RCDPXFIX",175,0)
 .   ;  unlock
"RTN","RCDPXFIX",176,0)
 .   L -^PRCA(433,PAYTRAN)
"RTN","RCDPXFIX",177,0)
 .   L -^PRCA(433,RCDECADJ)
"RTN","RCDPXFIX",178,0)
 ;
"RTN","RCDPXFIX",179,0)
 ;  get rid of the increase adjustment to the prepayment bill
"RTN","RCDPXFIX",180,0)
 D PREPAYAD(RCTRANDA)
"RTN","RCDPXFIX",181,0)
 Q
"RTN","RCDPXFIX",182,0)
 ;
"RTN","RCDPXFIX",183,0)
 ;
"RTN","RCDPXFIX",184,0)
PREPAYAD(RCTRANDA) ;  get rid of a transaction on a prepayment bill
"RTN","RCDPXFIX",185,0)
 N FYDA,RCBILL7,RCCOMMNT,RCTRAN1
"RTN","RCDPXFIX",186,0)
 S RCTRAN1=$G(^PRCA(433,RCTRANDA,1))
"RTN","RCDPXFIX",187,0)
 S RCBILL7=$G(^PRCA(430,RCBILLDA,7))
"RTN","RCDPXFIX",188,0)
 ;
"RTN","RCDPXFIX",189,0)
 ;  reset the 7 node on the bill
"RTN","RCDPXFIX",190,0)
 ;  increase: subtract the payment from the bills principal balance
"RTN","RCDPXFIX",191,0)
 I $P(RCTRAN1,"^",2)=1 S $P(RCBILL7,"^")=$P(RCBILL7,"^")-$P(RCTRAN1,"^",5)
"RTN","RCDPXFIX",192,0)
 ;  decrease: add the payment from the bills principal balance
"RTN","RCDPXFIX",193,0)
 I $P(RCTRAN1,"^",2)=35 S $P(RCBILL7,"^")=$P(RCBILL7,"^")+$P(RCTRAN1,"^",5)
"RTN","RCDPXFIX",194,0)
 I RCFTEST S ^PRCA(430,RCBILLDA,7)=RCBILL7
"RTN","RCDPXFIX",195,0)
 ;
"RTN","RCDPXFIX",196,0)
 ;  reset the fiscal year multiple
"RTN","RCDPXFIX",197,0)
 S FYDA=$O(^PRCA(430,RCBILLDA,2,999),-1)
"RTN","RCDPXFIX",198,0)
 I $G(^PRCA(430,RCBILLDA,2,+FYDA,0))'="" I RCFTEST S $P(^PRCA(430,RCBILLDA,2,FYDA,0),"^",2)=$P(RCBILL7,"^")
"RTN","RCDPXFIX",199,0)
 ;
"RTN","RCDPXFIX",200,0)
 ;  if the bills balance is zero, cancel it
"RTN","RCDPXFIX",201,0)
 I '$P(RCBILL7,"^") I RCFTEST S %=$$EDIT430^RCBEUBIL(RCBILLDA,"8////39;")
"RTN","RCDPXFIX",202,0)
 ;
"RTN","RCDPXFIX",203,0)
 ;  set the payment transaction to incomplete
"RTN","RCDPXFIX",204,0)
 I RCFTEST S $P(^PRCA(433,RCTRANDA,0),"^",4)=1
"RTN","RCDPXFIX",205,0)
 ;
"RTN","RCDPXFIX",206,0)
 ; **306, removing "duplicate" to make more generic
"RTN","RCDPXFIX",207,0)
 ;  add comment to transaction
"RTN","RCDPXFIX",208,0)
 ;S RCCOMMNT(1)="Duplicate deposit "_RCDPOSIT_" with transmission date "_$E(RCTRANDT,4,5)_"/"_$E(RCTRANDT,6,7)_"/"_$E(RCTRANDT,2,3)_" removed."
"RTN","RCDPXFIX",209,0)
 S RCCOMMNT(1)="Deposit "_RCDPOSIT_" with transmission date "_$E(RCTRANDT,4,5)_"/"_$E(RCTRANDT,6,7)_"/"_$E(RCTRANDT,2,3)_" removed."
"RTN","RCDPXFIX",210,0)
 I RCFTEST D ADDCOMM^RCBEUTRA(RCTRANDA,.RCCOMMNT)
"RTN","RCDPXFIX",211,0)
 ;
"RTN","RCDPXFIX",212,0)
 ;  build for mailman report
"RTN","RCDPXFIX",213,0)
 S ^TMP("RCDPXFIX",$J,RCBILLDA,RCTRANDA)=""
"RTN","RCDPXFIX",214,0)
 Q
"RTN","RCDPXFIX",215,0)
 ;
"RTN","RCDPXFIX",216,0)
 ;
"RTN","RCDPXFIX",217,0)
RECEIPT(RCDPOSIT,RCTRANDT,RCRCPT) ;  make changes to receipt file
"RTN","RCDPXFIX",218,0)
 N RCACCT,RCBILLDA,RCDEBTDA,RCPAYDA
"RTN","RCDPXFIX",219,0)
 S RCPAYDA=0 F  S RCPAYDA=$O(^RCY(344,RCRCPT,1,RCPAYDA)) Q:'RCPAYDA  D
"RTN","RCDPXFIX",220,0)
 .   ;  add comment to payment in receipt file
"RTN","RCDPXFIX",221,0)
 .   ;**306, removing "duplicate"
"RTN","RCDPXFIX",222,0)
 .   ;I RCFTEST S $P(^RCY(344,RCRCPT,1,RCPAYDA,1),"^",2)="Duplicate deposit "_RCDPOSIT_" with transmission date "_$E(RCTRANDT,4,5)_"/"_$E(RCTRANDT,6,7)_"/"_$E(RCTRANDT,2,3)_" removed."
"RTN","RCDPXFIX",223,0)
 .   I RCFTEST S $P(^RCY(344,RCRCPT,1,RCPAYDA,1),"^",2)="Deposit "_RCDPOSIT_" with transmission date "_$E(RCTRANDT,4,5)_"/"_$E(RCTRANDT,6,7)_"/"_$E(RCTRANDT,2,3)_" removed."
"RTN","RCDPXFIX",224,0)
 .   ;
"RTN","RCDPXFIX",225,0)
 .   ;  if the account is missing on the payment, then zero out the dollar amount
"RTN","RCDPXFIX",226,0)
 .   ;  to prevent it from showing as an unlinked payment
"RTN","RCDPXFIX",227,0)
 .   S RCACCT=$P(^RCY(344,RCRCPT,1,RCPAYDA,0),"^",3)
"RTN","RCDPXFIX",228,0)
 .   I 'RCACCT S:RCFTEST $P(^RCY(344,RCRCPT,1,RCPAYDA,0),"^",4)=0 Q
"RTN","RCDPXFIX",229,0)
 .   ;
"RTN","RCDPXFIX",230,0)
 .   ;  check acct to see if it has prepayments open with active bills.  if so,
"RTN","RCDPXFIX",231,0)
 .   ;  apply the prepayment to the active bill
"RTN","RCDPXFIX",232,0)
 .   S RCDEBTDA=$O(^RCD(340,"B",RCACCT,0)) I 'RCDEBTDA Q
"RTN","RCDPXFIX",233,0)
 .   ;
"RTN","RCDPXFIX",234,0)
 .   ;  no prepayments for account
"RTN","RCDPXFIX",235,0)
 .   I '$O(^PRCA(430,"AS",RCDEBTDA,42,0)) Q
"RTN","RCDPXFIX",236,0)
 .   ;
"RTN","RCDPXFIX",237,0)
 .   ;  no active bills for account
"RTN","RCDPXFIX",238,0)
 .   I '$O(^PRCA(430,"AS",RCDEBTDA,16,0)) Q
"RTN","RCDPXFIX",239,0)
 .   ;
"RTN","RCDPXFIX",240,0)
 .   ;  loop active (16) bills for debtor and apply prepayment
"RTN","RCDPXFIX",241,0)
 .   S RCBILLDA=0 F  S RCBILLDA=$O(^PRCA(430,"AS",RCDEBTDA,16,RCBILLDA)) Q:'RCBILLDA  D
"RTN","RCDPXFIX",242,0)
 .   .   ;  no prepayments left, stop loop
"RTN","RCDPXFIX",243,0)
 .   .   I '$O(^PRCA(430,"AS",RCDEBTDA,42,0)) S RCBILLDA="A" Q
"RTN","RCDPXFIX",244,0)
 .   .   ;
"RTN","RCDPXFIX",245,0)
 .   .   ;  this line is for testing
"RTN","RCDPXFIX",246,0)
 .   .   I 'RCFTEST W !,"Prepayment being applied to bill ",RCBILLDA Q
"RTN","RCDPXFIX",247,0)
 .   .   D PREPAY^RCBEPAYP(RCBILLDA,0)
"RTN","RCDPXFIX",248,0)
 Q
"VER")
8.0^22.0
"BLD",9786,6)
^267
**END**
**END**

