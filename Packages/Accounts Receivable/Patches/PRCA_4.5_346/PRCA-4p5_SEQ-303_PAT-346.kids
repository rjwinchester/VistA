EMERGENCY Released PRCA*4.5*346 SEQ #303
Extracted from mail message
**KIDS**:PRCA*4.5*346^

**INSTALL NAME**
PRCA*4.5*346
"BLD",11365,0)
PRCA*4.5*346^ACCOUNTS RECEIVABLE^0^3190110^y
"BLD",11365,1,0)
^^2^2^3190110^
"BLD",11365,1,1,0)
1. Bad Debt report (Allowance for Bad Debt and Contract Allowance)
"BLD",11365,1,2,0)
   does not print for Fund due to incorrect entry in compiler
"BLD",11365,4,0)
^9.64PA^^
"BLD",11365,6.3)
1
"BLD",11365,"ABPKG")
n
"BLD",11365,"KRN",0)
^9.67PA^1.61^23
"BLD",11365,"KRN",.4,0)
.4
"BLD",11365,"KRN",.401,0)
.401
"BLD",11365,"KRN",.402,0)
.402
"BLD",11365,"KRN",.403,0)
.403
"BLD",11365,"KRN",.5,0)
.5
"BLD",11365,"KRN",.84,0)
.84
"BLD",11365,"KRN",1.6,0)
1.6
"BLD",11365,"KRN",1.61,0)
1.61
"BLD",11365,"KRN",1.62,0)
1.62
"BLD",11365,"KRN",3.6,0)
3.6
"BLD",11365,"KRN",3.8,0)
3.8
"BLD",11365,"KRN",9.2,0)
9.2
"BLD",11365,"KRN",9.8,0)
9.8
"BLD",11365,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",11365,"KRN",9.8,"NM",1,0)
RCRJRBD^^0^B78999395
"BLD",11365,"KRN",9.8,"NM","B","RCRJRBD",1)

"BLD",11365,"KRN",19,0)
19
"BLD",11365,"KRN",19.1,0)
19.1
"BLD",11365,"KRN",101,0)
101
"BLD",11365,"KRN",409.61,0)
409.61
"BLD",11365,"KRN",771,0)
771
"BLD",11365,"KRN",779.2,0)
779.2
"BLD",11365,"KRN",870,0)
870
"BLD",11365,"KRN",8989.51,0)
8989.51
"BLD",11365,"KRN",8989.52,0)
8989.52
"BLD",11365,"KRN",8994,0)
8994
"BLD",11365,"KRN","B",.4,.4)

"BLD",11365,"KRN","B",.401,.401)

"BLD",11365,"KRN","B",.402,.402)

"BLD",11365,"KRN","B",.403,.403)

"BLD",11365,"KRN","B",.5,.5)

"BLD",11365,"KRN","B",.84,.84)

"BLD",11365,"KRN","B",1.6,1.6)

"BLD",11365,"KRN","B",1.61,1.61)

"BLD",11365,"KRN","B",1.62,1.62)

"BLD",11365,"KRN","B",3.6,3.6)

"BLD",11365,"KRN","B",3.8,3.8)

"BLD",11365,"KRN","B",9.2,9.2)

"BLD",11365,"KRN","B",9.8,9.8)

"BLD",11365,"KRN","B",19,19)

"BLD",11365,"KRN","B",19.1,19.1)

"BLD",11365,"KRN","B",101,101)

"BLD",11365,"KRN","B",409.61,409.61)

"BLD",11365,"KRN","B",771,771)

"BLD",11365,"KRN","B",779.2,779.2)

"BLD",11365,"KRN","B",870,870)

"BLD",11365,"KRN","B",8989.51,8989.51)

"BLD",11365,"KRN","B",8989.52,8989.52)

"BLD",11365,"KRN","B",8994,8994)

"BLD",11365,"QDEF")
^^^^NO^^^^^^NO
"BLD",11365,"QUES",0)
^9.62^^
"BLD",11365,"REQB",0)
^9.611^1^1
"BLD",11365,"REQB",1,0)
PRCA*4.5*340^2
"BLD",11365,"REQB","B","PRCA*4.5*340",1)

"MBREQ")
0
"PKG",142,-1)
1^1
"PKG",142,0)
ACCOUNTS RECEIVABLE^PRCA^BILL COLLECTIONS
"PKG",142,22,0)
^9.49I^1^1
"PKG",142,22,1,0)
4.5^^2950320
"PKG",142,22,1,"PAH",1,0)
346^3190110
"PKG",142,22,1,"PAH",1,1,0)
^^2^2^3190110
"PKG",142,22,1,"PAH",1,1,1,0)
1. Bad Debt report (Allowance for Bad Debt and Contract Allowance)
"PKG",142,22,1,"PAH",1,1,2,0)
   does not print for Fund due to incorrect entry in compiler
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","RCRJRBD")
0^1^B78999395^B76750896
"RTN","RCRJRBD",1,0)
RCRJRBD ;WISC/RFJ,TJK-bad debt extractor and report ;10/18/10 9:00am
"RTN","RCRJRBD",2,0)
 ;;4.5;Accounts Receivable;**101,139,170,193,203,215,220,138,239,273,282,310,315,340,346**;Mar 20, 1995;Build 1
"RTN","RCRJRBD",3,0)
 ;;Per VA Directive 6402, this routine should not be modified.
"RTN","RCRJRBD",4,0)
 ; IA 4385 for calls to $$MRATYPE^IBCEMU2 and $$MRADTACT^IBCEMU2
"RTN","RCRJRBD",5,0)
 ;
"RTN","RCRJRBD",6,0)
 ;PRCA*4.5*346 Modify SGL compile code 133.N3 to 133N.3 to
"RTN","RCRJRBD",7,0)
 ;             ensure line item 528713 - 133N dollars are accrued
"RTN","RCRJRBD",8,0)
 ;
"RTN","RCRJRBD",9,0)
 Q
"RTN","RCRJRBD",10,0)
 ;
"RTN","RCRJRBD",11,0)
 ;
"RTN","RCRJRBD",12,0)
START(DATEEND) ;  run bad debt report
"RTN","RCRJRBD",13,0)
 ;  the DATEEND is the last day of the month being run
"RTN","RCRJRBD",14,0)
 ;  from the routine RCRJRCOL which is the data extractor.  The
"RTN","RCRJRBD",15,0)
 ;  current receivable dollars is stored in ^TMP($J,"RCRJRBD",SGL)
"RTN","RCRJRBD",16,0)
 ;  where SGL is the standard general ledger 1319, 1338, or 1339.
"RTN","RCRJRBD",17,0)
 ;
"RTN","RCRJRBD",18,0)
 N ACTDATE,ACTUALCA,ACTUALWO,BEGDATE,BILLDA,CATEGORY
"RTN","RCRJRBD",19,0)
 N COLLECT,CONTRACT,DR,ENDDATE,FUND,PAY,PAYMENT,PRIN,PRINCPAL
"RTN","RCRJRBD",20,0)
 N RCRJFMM,RCRJDATE,SGL,TRANDA,TRANDATE,TRANTYPE,VALUE,WRITEOFF
"RTN","RCRJRBD",21,0)
 N RCPRIN,RCTOMCCF,RCVALUE,RSC,MRATYPE,ARACTDT
"RTN","RCRJRBD",22,0)
 ;
"RTN","RCRJRBD",23,0)
 ;  lock the bad debt file for storing data, lock cannot fail
"RTN","RCRJRBD",24,0)
 ;  this lock can be used to monitor if the report is running
"RTN","RCRJRBD",25,0)
 F  L +^RC(348.1):$S($G(DILOCKTM)>5:DILOCKTM,1:5) Q:$T
"RTN","RCRJRBD",26,0)
 ;
"RTN","RCRJRBD",27,0)
 ;  calculate the base percentages from past data
"RTN","RCRJRBD",28,0)
 ;  example:  DATEEND=2980331  => BEGDATE=2970300
"RTN","RCRJRBD",29,0)
 ;                             => ENDDATE=2980229
"RTN","RCRJRBD",30,0)
 ;   add one day to ending date to go to next month
"RTN","RCRJRBD",31,0)
 S BEGDATE=($E(DATEEND,1,3)-1)_$E(DATEEND,4,5)_"00"
"RTN","RCRJRBD",32,0)
 S ENDDATE=($$FMADD^XLFDT($E(DATEEND,1,5)_"00",-1))+1
"RTN","RCRJRBD",33,0)
 ;  loop bills activated between these dates
"RTN","RCRJRBD",34,0)
 S ACTDATE=BEGDATE
"RTN","RCRJRBD",35,0)
 F  S ACTDATE=$O(^PRCA(430,"ACTDT",ACTDATE)) Q:'ACTDATE!(ACTDATE>ENDDATE)  D
"RTN","RCRJRBD",36,0)
 . S BILLDA=0 F  S BILLDA=$O(^PRCA(430,"ACTDT",ACTDATE,BILLDA)) Q:'BILLDA  D
"RTN","RCRJRBD",37,0)
 . . S CATEGORY=+$P($G(^PRCA(430,BILLDA,0)),"^",2)
"RTN","RCRJRBD",38,0)
 . . ;  do not look at prepayments
"RTN","RCRJRBD",39,0)
 . . I 'CATEGORY!(CATEGORY=26) Q
"RTN","RCRJRBD",40,0)
 . . ;
"RTN","RCRJRBD",41,0)
 . . ;  only look at bills with a 0 principal balance
"RTN","RCRJRBD",42,0)
 . . I $P($G(^PRCA(430,BILLDA,7)),"^") Q
"RTN","RCRJRBD",43,0)
 . . ;
"RTN","RCRJRBD",44,0)
 . . ;  only report fund 528701,03,04,11 and 4032/528709 bills
"RTN","RCRJRBD",45,0)
 . . S FUND=$$GETFUNDB^RCXFMSUF(BILLDA,1)
"RTN","RCRJRBD",46,0)
 . . I '$$PTACCT^PRCAACC(FUND),$E(FUND,1,4)'=4032 Q
"RTN","RCRJRBD",47,0)
 . . ;
"RTN","RCRJRBD",48,0)
 . . ;  determine MRA type of bill, given bill# and bill active date
"RTN","RCRJRBD",49,0)
 . . ;  DBIA #4385 activated on 31-Mar-2004
"RTN","RCRJRBD",50,0)
 . . S MRATYPE=$$MRATYPE^IBCEMU2(BILLDA,ACTDATE)
"RTN","RCRJRBD",51,0)
 . . ;
"RTN","RCRJRBD",52,0)
 . . ;  derive standard general ledger (SGL) from cat/fund/MRA type
"RTN","RCRJRBD",53,0)
 . . S SGL=$$BDRSGL(CATEGORY,FUND,MRATYPE)
"RTN","RCRJRBD",54,0)
 . . ;
"RTN","RCRJRBD",55,0)
 . . ;  determine the original amount of the bill (add increase
"RTN","RCRJRBD",56,0)
 . . ;  adjustments below)
"RTN","RCRJRBD",57,0)
 . . S PRIN=$P($G(^PRCA(430,BILLDA,0)),"^",3)
"RTN","RCRJRBD",58,0)
 . . S PAY=0
"RTN","RCRJRBD",59,0)
 . . ;
"RTN","RCRJRBD",60,0)
 . . ;  get the $ transations for bills
"RTN","RCRJRBD",61,0)
 . . S TRANDA=0
"RTN","RCRJRBD",62,0)
 . . F  S TRANDA=$O(^PRCA(433,"C",BILLDA,TRANDA)) Q:'TRANDA  D
"RTN","RCRJRBD",63,0)
 . . . S TRANTYPE=$P($G(^PRCA(433,TRANDA,1)),"^",2)
"RTN","RCRJRBD",64,0)
 . . . I "^1^73^2^34^43^"'[("^"_TRANTYPE_"^") Q           ; *340 added 73
"RTN","RCRJRBD",65,0)
 . . . S VALUE=$$TRANBAL^RCRJRCOT(TRANDA) I VALUE="" Q
"RTN","RCRJRBD",66,0)
 . . . ;  increase adjustments or re-establish
"RTN","RCRJRBD",67,0)
 . . . I TRANTYPE=1!(TRANTYPE=73)!(TRANTYPE=43) S PRIN=PRIN+$P(VALUE,"^") Q    ; *340 added 73
"RTN","RCRJRBD",68,0)
 . . . ;  payments
"RTN","RCRJRBD",69,0)
 . . . I TRANTYPE=2!(TRANTYPE=34) S PAY=PAY+$P(VALUE,"^") Q
"RTN","RCRJRBD",70,0)
 . . ;
"RTN","RCRJRBD",71,0)
 . . ;  payment cannot be greater than principle
"RTN","RCRJRBD",72,0)
 . . I PAY>PRIN S PAY=PRIN
"RTN","RCRJRBD",73,0)
 . . ;
"RTN","RCRJRBD",74,0)
 . . ;  store the data
"RTN","RCRJRBD",75,0)
 . . S PRINCPAL(SGL)=$G(PRINCPAL(SGL))+PRIN
"RTN","RCRJRBD",76,0)
 . . S PAYMENT(SGL)=$G(PAYMENT(SGL))+PAY
"RTN","RCRJRBD",77,0)
 . . ;
"RTN","RCRJRBD",78,0)
 ;
"RTN","RCRJRBD",79,0)
 ;  calculate the writeoffs from 2/0/98
"RTN","RCRJRBD",80,0)
 ;  2/0/98 is when fms cleared out actual writeoffs and contract adj
"RTN","RCRJRBD",81,0)
 K ^XTMP("PRCABDET")
"RTN","RCRJRBD",82,0)
 S ^XTMP("PRCABDET",0)=$$FMADD^XLFDT(DT,10)_"^"_DT_"^BAD DEBT REPORT AUDIT"
"RTN","RCRJRBD",83,0)
 F TRANTYPE=8,9,10,11,35 D
"RTN","RCRJRBD",84,0)
 . S TRANDATE=2980200
"RTN","RCRJRBD",85,0)
 . ;  do not pick up transactions after the end date
"RTN","RCRJRBD",86,0)
 . F  S TRANDATE=$O(^PRCA(433,"AT",TRANTYPE,TRANDATE)) Q:'TRANDATE!($P(TRANDATE,".")>DATEEND)  D
"RTN","RCRJRBD",87,0)
 . . S TRANDA=0 F  S TRANDA=$O(^PRCA(433,"AT",TRANTYPE,TRANDATE,TRANDA)) Q:'TRANDA  D
"RTN","RCRJRBD",88,0)
 . . . ;  do not look at decrease adj which are not contract adj
"RTN","RCRJRBD",89,0)
 . . . I TRANTYPE=35,'$P($G(^PRCA(433,TRANDA,8)),"^",8) Q
"RTN","RCRJRBD",90,0)
 . . . ;
"RTN","RCRJRBD",91,0)
 . . . S BILLDA=$P($G(^PRCA(433,TRANDA,0)),"^",2)
"RTN","RCRJRBD",92,0)
 . . . I 'BILLDA Q
"RTN","RCRJRBD",93,0)
 . . . S CATEGORY=+$P($G(^PRCA(430,BILLDA,0)),"^",2)
"RTN","RCRJRBD",94,0)
 . . . ;  do not look at prepayments
"RTN","RCRJRBD",95,0)
 . . . I 'CATEGORY!(CATEGORY=26) Q
"RTN","RCRJRBD",96,0)
 . . . ;
"RTN","RCRJRBD",97,0)
 . . . ;  only report fund 528701,03,04,11 and 4032/528709 (ltc) bills
"RTN","RCRJRBD",98,0)
 . . . S FUND=$$GETFUNDB^RCXFMSUF(BILLDA,1)
"RTN","RCRJRBD",99,0)
 . . . I '$$PTACCT^PRCAACC(FUND),$E(FUND,1,4)'=4032 Q
"RTN","RCRJRBD",100,0)
 . . . ;
"RTN","RCRJRBD",101,0)
 . . . ;  get bill active date
"RTN","RCRJRBD",102,0)
 . . . S ARACTDT=+$P($P($G(^PRCA(430,BILLDA,6)),"^",21),".")
"RTN","RCRJRBD",103,0)
 . . . ;  determine MRA type of bill, given bill# and bill active date
"RTN","RCRJRBD",104,0)
 . . . ;  DBIA #4385 activated on 31-Mar-2004
"RTN","RCRJRBD",105,0)
 . . . S MRATYPE=$$MRATYPE^IBCEMU2(BILLDA,ARACTDT)
"RTN","RCRJRBD",106,0)
 . . . ;
"RTN","RCRJRBD",107,0)
 . . . ; derive standard general ledger (SGL) from cat/fund/MRA type
"RTN","RCRJRBD",108,0)
 . . . S SGL=$$BDRSGL(CATEGORY,FUND,MRATYPE)
"RTN","RCRJRBD",109,0)
 . . . ;
"RTN","RCRJRBD",110,0)
 . . . ;  get the principal transaction value
"RTN","RCRJRBD",111,0)
 . . . S RCVALUE=+$P($$TRANBAL^RCRJRCOT(TRANDA),"^")
"RTN","RCRJRBD",112,0)
 . . . ;  temp variable for value (used below)
"RTN","RCRJRBD",113,0)
 . . . S RCPRIN=RCVALUE
"RTN","RCRJRBD",114,0)
 . . . ;
"RTN","RCRJRBD",115,0)
 . . . ;  add actual writeoff amount for fiscal year
"RTN","RCRJRBD",116,0)
 . . . I TRANTYPE'=35 S ACTUALWO(SGL)=$G(ACTUALWO(SGL))+RCVALUE
"RTN","RCRJRBD",117,0)
 . . . ;  add actual contract adjustments for fiscal year
"RTN","RCRJRBD",118,0)
 . . . I TRANTYPE=35 S ACTUALCA(SGL)=$G(ACTUALCA(SGL))+RCVALUE
"RTN","RCRJRBD",119,0)
 . . . S RSC=$$CALCRSC^RCXFMSUR(BILLDA)
"RTN","RCRJRBD",120,0)
 . . . S ^XTMP("PRCABDET",BILLDA,CATEGORY,FUND,RSC,SGL,TRANDA,TRANDATE,TRANTYPE,RCPRIN,RCVALUE,0,0)=""
"RTN","RCRJRBD",121,0)
 ;
"RTN","RCRJRBD",122,0)
 ;  remove all the entries from the bad debt file
"RTN","RCRJRBD",123,0)
 D DELETALL
"RTN","RCRJRBD",124,0)
 ;
"RTN","RCRJRBD",125,0)
 ;  calculate percentages and store them
"RTN","RCRJRBD",126,0)
 F SGL=1319,1319.2,1319.3,1319.4,1319.5,1319.6,1338,1338.2,1338.3,1339,1339.1,"133N","133N.2","133N.3" D   ;PRCA*4.5*346
"RTN","RCRJRBD",127,0)
 . ;  collection %
"RTN","RCRJRBD",128,0)
 . S COLLECT=0 I $G(PRINCPAL(SGL)) S COLLECT=$J($G(PAYMENT(SGL))/PRINCPAL(SGL)*100,0,2)
"RTN","RCRJRBD",129,0)
 . ;  patch PRCA*4.5*138: for the first year from when MRA is activated at a site, there is no collection
"RTN","RCRJRBD",130,0)
 . ;  history for post-MRA non-Medicare bills(SGL 133N). So, to calculate the percentage for SGL 133N, the
"RTN","RCRJRBD",131,0)
 . ;  payment and the principal for SGL 1339 are used in the first year.
"RTN","RCRJRBD",132,0)
 . ;  override the collection value for SGL=133N for the first year from MRA activation.
"RTN","RCRJRBD",133,0)
 . ;;  Re-evaluate the calc. of the percentage for 133N as well as 1339.
"RTN","RCRJRBD",134,0)
 . ;;I SGL="133N",$G(PRINCIPAL(1339)) D  ;
"RTN","RCRJRBD",135,0)
 . ;;. N X1,X2,X,%Y
"RTN","RCRJRBD",136,0)
 . ;;. ;  X2=MRA Activation Date, X1=Today, X=diff in days, %Y=0 invalid dates
"RTN","RCRJRBD",137,0)
 . ;;. ;  DBIA #4385 activated on 31-Mar-2004
"RTN","RCRJRBD",138,0)
 . ;;. S X2=$$MRADTACT^IBCEMU2,X1=$$DT^XLFDT D ^%DTC
"RTN","RCRJRBD",139,0)
 . ;;. I %Y,X'>364.25 S COLLECT=$J($G(PAYMENT(1339))/PRINCPAL(1339)*100,0,2)
"RTN","RCRJRBD",140,0)
 . S DR=".02////"_+COLLECT_";"
"RTN","RCRJRBD",141,0)
 . ;
"RTN","RCRJRBD",142,0)
 . ;  current month receivable (this is built in the routine
"RTN","RCRJRBD",143,0)
 . ;  RCRJRCO1 and is stored in ^TMP($J,"RCRJRBD",SGL))
"RTN","RCRJRBD",144,0)
 . S DR=DR_".07////"_+$G(^TMP($J,"RCRJRBD",SGL))_";"
"RTN","RCRJRBD",145,0)
 . ;
"RTN","RCRJRBD",146,0)
 . ;  calculate allowance estimate for 1319 and 1338
"RTN","RCRJRBD",147,0)
 . ;  .08 allowance estimate = (writeoff % * current receivables)
"RTN","RCRJRBD",148,0)
 . ;  .09 actual writeoffs fytd
"RTN","RCRJRBD",149,0)
 . I SGL=1319!(SGL=1319.2)!(SGL=1319.3)!(SGL=1319.4)!(SGL=1319.5)!(SGL=1319.6)!(SGL=1338)!(SGL=1338.2)!(SGL=1338.3) D
"RTN","RCRJRBD",150,0)
 . . S WRITEOFF=100-COLLECT
"RTN","RCRJRBD",151,0)
 . . S DR=DR_".03////"_WRITEOFF_";"
"RTN","RCRJRBD",152,0)
 . . S DR=DR_".08////"_$J((WRITEOFF/100)*$G(^TMP($J,"RCRJRBD",SGL)),0,2)_";"
"RTN","RCRJRBD",153,0)
 . . S DR=DR_".09////"_+$G(ACTUALWO(SGL))_";"
"RTN","RCRJRBD",154,0)
 . ;  calculate allowance estimate for 1339
"RTN","RCRJRBD",155,0)
 . ;  .08 allowance estimate = (contract % * current receivables)
"RTN","RCRJRBD",156,0)
 . ;  .09 actual contract adjustments fytd
"RTN","RCRJRBD",157,0)
 . I SGL=1339!(SGL=1339.1)!(SGL="133N")!(SGL="133N.2")!(SGL="133N.3") D
"RTN","RCRJRBD",158,0)
 . . S CONTRACT=100-COLLECT
"RTN","RCRJRBD",159,0)
 . . S DR=DR_".04////"_CONTRACT_";"
"RTN","RCRJRBD",160,0)
 . . S DR=DR_".08////"_$J((CONTRACT/100)*$G(^TMP($J,"RCRJRBD",SGL)),0,2)_";"
"RTN","RCRJRBD",161,0)
 . . S DR=DR_".09////"_+$G(ACTUALCA(SGL))_";"
"RTN","RCRJRBD",162,0)
 . ;
"RTN","RCRJRBD",163,0)
 . ;  set changed locally flag to no
"RTN","RCRJRBD",164,0)
 . S DR=DR_".1////0;"
"RTN","RCRJRBD",165,0)
 . D STORE(SGL,DR)
"RTN","RCRJRBD",166,0)
 ;
"RTN","RCRJRBD",167,0)
 L -^RC(348.1)
"RTN","RCRJRBD",168,0)
 ;
"RTN","RCRJRBD",169,0)
 ;   ;  put the report in a mail message (rcrjfmm=1)
"RTN","RCRJRBD",170,0)
 ;   S RCRJFMM=1
"RTN","RCRJRBD",171,0)
 ;   S RCRJDATE=DATEEND
"RTN","RCRJRBD",172,0)
 ;   D DQ^RCRJRBDR
"RTN","RCRJRBD",173,0)
 ;
"RTN","RCRJRBD",174,0)
 ;  transmit the allowances to FMS, and then generate the report.
"RTN","RCRJRBD",175,0)
 D BADDEBT^RCXFMSSV(DATEEND)
"RTN","RCRJRBD",176,0)
 Q
"RTN","RCRJRBD",177,0)
 ;
"RTN","RCRJRBD",178,0)
 ;
"RTN","RCRJRBD",179,0)
STORE(SGL,DR) ;  store data for Standard Ledger Account
"RTN","RCRJRBD",180,0)
 N D0,DA,DD,DI,DIC,DIE,DINUM,DO,DQ,X,Y
"RTN","RCRJRBD",181,0)
 S DIC="^RC(348.1,",DIC(0)="L",X=SGL,DIC("DR")=DR
"RTN","RCRJRBD",182,0)
 D FILE^DICN
"RTN","RCRJRBD",183,0)
 Q
"RTN","RCRJRBD",184,0)
 ;
"RTN","RCRJRBD",185,0)
 ;
"RTN","RCRJRBD",186,0)
DELETALL ;  delete all the entries from the bad debt file
"RTN","RCRJRBD",187,0)
 N %,DA,DIC,DIK,X,Y
"RTN","RCRJRBD",188,0)
 S DIK="^RC(348.1,"
"RTN","RCRJRBD",189,0)
 S DA=0 F  S DA=$O(^RC(348.1,DA)) Q:'DA  D ^DIK
"RTN","RCRJRBD",190,0)
 Q
"RTN","RCRJRBD",191,0)
 ;
"RTN","RCRJRBD",192,0)
 ;
"RTN","RCRJRBD",193,0)
WD3() ;  return the third work day of the month
"RTN","RCRJRBD",194,0)
 N J,P,V,X
"RTN","RCRJRBD",195,0)
 S J=0 F P=$E(DT,1,5)_"01":1 S V=$$DOW^XLFDT(P,1) I V,V<6,'$D(^HOLIDAY("B",P)) S J=J+1 Q:J=3
"RTN","RCRJRBD",196,0)
 S X=+$E(P,6,7)
"RTN","RCRJRBD",197,0)
 Q X
"RTN","RCRJRBD",198,0)
 ;
"RTN","RCRJRBD",199,0)
 ;
"RTN","RCRJRBD",200,0)
PREVMONT(FORDATE) ; return the previous month's date
"RTN","RCRJRBD",201,0)
 N PREVDATE
"RTN","RCRJRBD",202,0)
 S PREVDATE=$E(FORDATE,1,5)-1
"RTN","RCRJRBD",203,0)
 I $E(PREVDATE,4,5)="00" S PREVDATE=($E(PREVDATE,1,3)-1)_12
"RTN","RCRJRBD",204,0)
 Q PREVDATE_"00"
"RTN","RCRJRBD",205,0)
 ;
"RTN","RCRJRBD",206,0)
 ; derive standard general ledger (SGL) from category and fund
"RTN","RCRJRBD",207,0)
SGL(CATEGORY,FUND) ;
"RTN","RCRJRBD",208,0)
 I $G(FUND)=528709 Q 1319.2 ;new long term care fund
"RTN","RCRJRBD",209,0)
 I $E($G(FUND),1,4)=4032 Q 1319.2 ; breakout long term care as a subset
"RTN","RCRJRBD",210,0)
 I $G(FUND)=528711&(CAT=6)!(CAT=7) Q 1319.5  ; breakout pharmacy
"RTN","RCRJRBD",211,0)
 I $G(FUND)=528711&(CAT=9) Q "133N.2"  ; pharmacy reimburs health ins
"RTN","RCRJRBD",212,0)
 I $G(FUND)=528711&(CAT=10) Q 1338.2  ; pharmacy tort feasor
"RTN","RCRJRBD",213,0)
 I CATEGORY=8 Q 1339   ; crime or per. vio.
"RTN","RCRJRBD",214,0)
 I CATEGORY=9 Q 1339   ; reimbursable health insurance
"RTN","RCRJRBD",215,0)
 I CATEGORY=46 Q 1339   ; EMER/HUMAN REIMB INS  ;315
"RTN","RCRJRBD",216,0)
 I CATEGORY=10 Q 1338  ; tort feasor
"RTN","RCRJRBD",217,0)
 I CATEGORY=21 Q 1339  ; medicare
"RTN","RCRJRBD",218,0)
 I CATEGORY=45 Q 1339.1  ; Fee Basis
"RTN","RCRJRBD",219,0)
 Q 1319
"RTN","RCRJRBD",220,0)
 ;
"RTN","RCRJRBD",221,0)
 ;
"RTN","RCRJRBD",222,0)
BDRSGL(CAT,FUND,MRATYPE) ; Calculate SGLs for the BDR process
"RTN","RCRJRBD",223,0)
 ;PRCA*4.5*310/DRF Added fund 528713, Non-VA Reimbursable Insurance
"RTN","RCRJRBD",224,0)
 ;
"RTN","RCRJRBD",225,0)
 ; This API will be used by both the ARDC (routine RCRJRCOC)
"RTN","RCRJRBD",226,0)
 ; and the BDR estimate calculator to associate receivables
"RTN","RCRJRBD",227,0)
 ; with the correct standard general ledger account (SGL).
"RTN","RCRJRBD",228,0)
 ; The following table will be implemented:
"RTN","RCRJRBD",229,0)
 ;
"RTN","RCRJRBD",230,0)
 ; Receivable Type (Category)        Fund      SGL
"RTN","RCRJRBD",231,0)
 ;==================================================
"RTN","RCRJRBD",232,0)
 ; Medical Care Co-payments                 528703    1319
"RTN","RCRJRBD",233,0)
 ;  (plus Inelig, Emerg./Hum. rec.)
"RTN","RCRJRBD",234,0)
 ; Long Term Care Co-payments               528709    1319.2
"RTN","RCRJRBD",235,0)
 ; Medication Co-payments                   528701    1319.3
"RTN","RCRJRBD",236,0)
 ; Crimes of Personal Violence (8),         528704    1319.4
"RTN","RCRJRBD",237,0)
 ;  Medicare (21), No-Fault Auto
"RTN","RCRJRBD",238,0)
 ;  (7), Workman's Comp (6)
"RTN","RCRJRBD",239,0)
 ; Tort Feasor (10)                         528704    1338
"RTN","RCRJRBD",240,0)
 ; RHI (9), pre-MRA                         528704    1339
"RTN","RCRJRBD",241,0)
 ; RHI (9), post-MRA, MRA rec.              528704    133H
"RTN","RCRJRBD",242,0)
 ; RHI (9), post-MRA, non-MRA rec.          528704    133N
"RTN","RCRJRBD",243,0)
 ; Non-VA RHI Tort Feasor                   528713    1338.3
"RTN","RCRJRBD",244,0)
 ; Non-VA RHI (45), pre-MRA                 528713    1339.1
"RTN","RCRJRBD",245,0)
 ; Non-VA RHI (45), post-MRA, MRA rec.      528713    133H.2
"RTN","RCRJRBD",246,0)
 ; Non-VA RHI (45), post-MRA, non-MRA rec.  528713    133N.3
"RTN","RCRJRBD",247,0)
 ; Crimes of Personal Violence (8),         528713    1319.6
"RTN","RCRJRBD",248,0)
 ;  Medicare (21), No-Fault Auto
"RTN","RCRJRBD",249,0)
 ;  (7), Workman's Comp (6)
"RTN","RCRJRBD",250,0)
 ; Pharmacy No Fault Auto(7),               528711    1319.5
"RTN","RCRJRBD",251,0)
 ; Pharmacy Workman's Comp(6)
"RTN","RCRJRBD",252,0)
 ; Pharmacy RHI, non MRA (9)                528711    133N.2
"RTN","RCRJRBD",253,0)
 ; Pharmacy Tort Feasor (10)                528711    1338.2
"RTN","RCRJRBD",254,0)
 ;
"RTN","RCRJRBD",255,0)
 ;  Input:  CAT  --  Pointer to the receivable category in file 430.2
"RTN","RCRJRBD",256,0)
 ;         FUND  --  Receivable fund calculated by routine RCXFMSUF
"RTN","RCRJRBD",257,0)
 ;      MRATYPE  --  Indicator of an MRA (2) or non-MRA (3) receivable
"RTN","RCRJRBD",258,0)
 ;
"RTN","RCRJRBD",259,0)
 ;
"RTN","RCRJRBD",260,0)
 I $G(FUND)=528709 Q 1319.2
"RTN","RCRJRBD",261,0)
 I $E($G(FUND),1,4)=4032 Q 1319.2
"RTN","RCRJRBD",262,0)
 I $G(FUND)=528701 Q 1319.3
"RTN","RCRJRBD",263,0)
 I $G(FUND)=528711&((CAT=6)!(CAT=7)) Q 1319.5
"RTN","RCRJRBD",264,0)
 I $G(FUND)=528711&(CAT=9) Q "133N.2"
"RTN","RCRJRBD",265,0)
 I $G(FUND)=528711&(CAT=10) Q 1338.2
"RTN","RCRJRBD",266,0)
 I $G(FUND)=528713&(CAT=10) Q 1338.3
"RTN","RCRJRBD",267,0)
 I $G(FUND)=528713&(CAT=8!(CAT=21)!(CAT=6)!(CAT=7)) Q 1319.6
"RTN","RCRJRBD",268,0)
 I CAT=8!(CAT=21)!(CAT=7)!(CAT=6) Q 1319.4
"RTN","RCRJRBD",269,0)
 I CAT=10 Q 1338
"RTN","RCRJRBD",270,0)
 I CAT=9 Q $S(MRATYPE=2:"133H",MRATYPE=3:"133N",1:1339)
"RTN","RCRJRBD",271,0)
 I CAT=46 Q $S(MRATYPE=2:"133H",MRATYPE=3:"133N",1:1339)  ;315 
"RTN","RCRJRBD",272,0)
 I CAT=45 Q $S(MRATYPE=2:"133H.2",MRATYPE=3:"133N.3",1:1339.1)
"RTN","RCRJRBD",273,0)
 Q 1319
"VER")
8.0^22.2
"BLD",11365,6)
^303
**END**
**END**

