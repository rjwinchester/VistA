Released PRCA*4.5*265 SEQ #265
Extracted from mail message
**KIDS**:PRCA*4.5*265^

**INSTALL NAME**
PRCA*4.5*265
"BLD",8538,0)
PRCA*4.5*265^ACCOUNTS RECEIVABLE^0^3120424^y
"BLD",8538,1,0)
^^9^9^3110516^
"BLD",8538,1,1,0)
This patch contains three issues. The first issue is about the patient
"BLD",8538,1,2,0)
statements not successfully transmitting in Austin for printing. The 
"BLD",8538,1,3,0)
second issue is regarding some erroneous admission and ending dates
"BLD",8538,1,4,0)
appearing on the patient statements.
"BLD",8538,1,5,0)
 
"BLD",8538,1,6,0)
The third issue concerns an undefined error when running the [RCDPE EOB
"BLD",8538,1,7,0)
TRANSFER REPORTS] option.
"BLD",8538,1,8,0)
 
"BLD",8538,1,9,0)
.
"BLD",8538,4,0)
^9.64PA^^
"BLD",8538,6.3)
5
"BLD",8538,"ABPKG")
n
"BLD",8538,"KRN",0)
^9.67PA^779.2^20
"BLD",8538,"KRN",.4,0)
.4
"BLD",8538,"KRN",.4,"NM",0)
^9.68A^^
"BLD",8538,"KRN",.401,0)
.401
"BLD",8538,"KRN",.402,0)
.402
"BLD",8538,"KRN",.403,0)
.403
"BLD",8538,"KRN",.5,0)
.5
"BLD",8538,"KRN",.84,0)
.84
"BLD",8538,"KRN",3.6,0)
3.6
"BLD",8538,"KRN",3.8,0)
3.8
"BLD",8538,"KRN",9.2,0)
9.2
"BLD",8538,"KRN",9.8,0)
9.8
"BLD",8538,"KRN",9.8,"NM",0)
^9.68A^3^3
"BLD",8538,"KRN",9.8,"NM",1,0)
RCCPCPS^^0^B71404162
"BLD",8538,"KRN",9.8,"NM",2,0)
RCCPCPS1^^0^B37370113
"BLD",8538,"KRN",9.8,"NM",3,0)
RCDPETR^^0^B58559248
"BLD",8538,"KRN",9.8,"NM","B","RCCPCPS",1)

"BLD",8538,"KRN",9.8,"NM","B","RCCPCPS1",2)

"BLD",8538,"KRN",9.8,"NM","B","RCDPETR",3)

"BLD",8538,"KRN",19,0)
19
"BLD",8538,"KRN",19,"NM",0)
^9.68A^^
"BLD",8538,"KRN",19.1,0)
19.1
"BLD",8538,"KRN",19.1,"NM",0)
^9.68A^^
"BLD",8538,"KRN",101,0)
101
"BLD",8538,"KRN",101,"NM",0)
^9.68A^^
"BLD",8538,"KRN",409.61,0)
409.61
"BLD",8538,"KRN",409.61,"NM",0)
^9.68A^^
"BLD",8538,"KRN",771,0)
771
"BLD",8538,"KRN",771,"NM",0)
^9.68A^^
"BLD",8538,"KRN",779.2,0)
779.2
"BLD",8538,"KRN",779.2,"NM",0)
^9.68A^^
"BLD",8538,"KRN",870,0)
870
"BLD",8538,"KRN",870,"NM",0)
^9.68A^^
"BLD",8538,"KRN",8989.51,0)
8989.51
"BLD",8538,"KRN",8989.51,"NM",0)
^9.68A^^
"BLD",8538,"KRN",8989.52,0)
8989.52
"BLD",8538,"KRN",8989.52,"NM",0)
^9.68A^^
"BLD",8538,"KRN",8994,0)
8994
"BLD",8538,"KRN",8994,"NM",0)
^9.68A^^
"BLD",8538,"KRN","B",.4,.4)

"BLD",8538,"KRN","B",.401,.401)

"BLD",8538,"KRN","B",.402,.402)

"BLD",8538,"KRN","B",.403,.403)

"BLD",8538,"KRN","B",.5,.5)

"BLD",8538,"KRN","B",.84,.84)

"BLD",8538,"KRN","B",3.6,3.6)

"BLD",8538,"KRN","B",3.8,3.8)

"BLD",8538,"KRN","B",9.2,9.2)

"BLD",8538,"KRN","B",9.8,9.8)

"BLD",8538,"KRN","B",19,19)

"BLD",8538,"KRN","B",19.1,19.1)

"BLD",8538,"KRN","B",101,101)

"BLD",8538,"KRN","B",409.61,409.61)

"BLD",8538,"KRN","B",771,771)

"BLD",8538,"KRN","B",779.2,779.2)

"BLD",8538,"KRN","B",870,870)

"BLD",8538,"KRN","B",8989.51,8989.51)

"BLD",8538,"KRN","B",8989.52,8989.52)

"BLD",8538,"KRN","B",8994,8994)

"BLD",8538,"QDEF")
^^^^^^^^
"BLD",8538,"QUES",0)
^9.62^^
"BLD",8538,"REQB",0)
^9.611^5^3
"BLD",8538,"REQB",3,0)
PRCA*4.5*192^2
"BLD",8538,"REQB",4,0)
PRCA*4.5*219^2
"BLD",8538,"REQB",5,0)
PRCA*4.5*269^2
"BLD",8538,"REQB","B","PRCA*4.5*192",3)

"BLD",8538,"REQB","B","PRCA*4.5*219",4)

"BLD",8538,"REQB","B","PRCA*4.5*269",5)

"MBREQ")
0
"PKG",142,-1)
1^1
"PKG",142,0)
ACCOUNTS RECEIVABLE^PRCA^BILL COLLECTIONS
"PKG",142,20,0)
^9.402P^1^1
"PKG",142,20,1,0)
2^^PRCAMRG
"PKG",142,20,1,1)

"PKG",142,20,"B",2,1)

"PKG",142,22,0)
^9.49I^1^1
"PKG",142,22,1,0)
4.5^^2950320
"PKG",142,22,1,"PAH",1,0)
265^3120424
"PKG",142,22,1,"PAH",1,1,0)
^^9^9^3120424
"PKG",142,22,1,"PAH",1,1,1,0)
This patch contains three issues. The first issue is about the patient
"PKG",142,22,1,"PAH",1,1,2,0)
statements not successfully transmitting in Austin for printing. The 
"PKG",142,22,1,"PAH",1,1,3,0)
second issue is regarding some erroneous admission and ending dates
"PKG",142,22,1,"PAH",1,1,4,0)
appearing on the patient statements.
"PKG",142,22,1,"PAH",1,1,5,0)
 
"PKG",142,22,1,"PAH",1,1,6,0)
The third issue concerns an undefined error when running the [RCDPE EOB
"PKG",142,22,1,"PAH",1,1,7,0)
TRANSFER REPORTS] option.
"PKG",142,22,1,"PAH",1,1,8,0)
 
"PKG",142,22,1,"PAH",1,1,9,0)
.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
3
"RTN","RCCPCPS")
0^1^B71404162^B71238973
"RTN","RCCPCPS",1,0)
RCCPCPS ;WASH-ISC@ALTOONA,PA/NYB-Build Patient Statement File ;12/19/96  4:14 PM
"RTN","RCCPCPS",2,0)
V ;;4.5;Accounts Receivable;**34,70,80,48,104,116,149,170,181,190,223,237,219,265**;Mar 20,1995;Build 5
"RTN","RCCPCPS",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","RCCPCPS",4,0)
EN N CCPC,CNT,DAT,DEB,DIK,END,INADFL,LDT1,LDT3,PCC,PRN,RCDATE,RCT,SVADM,SVAMT,SVINT,SVOTH,SITE,TXT,VAR,X,%
"RTN","RCCPCPS",5,0)
 N RCINFULL,RCINPART S COMM=0
"RTN","RCCPCPS",6,0)
 K ^RCPS(349.2)
"RTN","RCCPCPS",7,0)
 F X="PA","IS" S RCT=$O(^RCT(349.1,"B",X,0)) Q:'RCT  K ^RCT(349.1,+RCT,4),^RCT(349.1,+RCT,5)
"RTN","RCCPCPS",8,0)
 K ^XTMP("RCCPC")
"RTN","RCCPCPS",9,0)
 D DT^DICRW,SITE^PRCAGU
"RTN","RCCPCPS",10,0)
 I '$D(SITE) W !!,"AR SITE PARAMETER ENTRIES NOT DEFINED!",?50 D NOW^%DTC S Y=% D DD^%DT W Y W !!,"COULD NOT PROCESS AR PATIENT STATEMENTS" Q
"RTN","RCCPCPS",11,0)
 D NOW^%DTC S END=%
"RTN","RCCPCPS",12,0)
 S LDT1=$$FPS^RCAMFN01(DT,-1),RCDATE=DT
"RTN","RCCPCPS",13,0)
 S (CNT,DEB)=0,PRN=1
"RTN","RCCPCPS",14,0)
 F  S DEB=$O(^RCD(340,"AB","DPT(",DEB)) Q:DEB=""  D
"RTN","RCCPCPS",15,0)
 .   N AMT,BBAL,BEG,BN,CAT,DESC,ETY,FC,ND,PAT,PBAL,PC
"RTN","RCCPCPS",16,0)
 .   N PDAT,PEND,ST,SVINT,SVADM,SVOTH,ADDR
"RTN","RCCPCPS",17,0)
 .   I $L(+$$SSN^RCFN01(DEB))<5 Q
"RTN","RCCPCPS",18,0)
 .   ;Check for Emergency Response Indicator (ERI) Flag.
"RTN","RCCPCPS",19,0)
 .   N RCDFN S RCDFN=$P($G(^RCD(340,DEB,0)),"^",1) I $$EMERES^PRCAUTL(+RCDFN)]"" Q
"RTN","RCCPCPS",20,0)
 .   S INADFL=0
"RTN","RCCPCPS",21,0)
 .   S (SVADM,SVAMT,SVINT,SVOTH)=0
"RTN","RCCPCPS",22,0)
 .   N REF,SBAL,SDT,TBAL,TN,TTY,X,Y
"RTN","RCCPCPS",23,0)
 .   K ^TMP("PRCAGT",$J)
"RTN","RCCPCPS",24,0)
 .   S BEG=+$$LST^RCFN01(DEB,2)
"RTN","RCCPCPS",25,0)
 .   S LDT3=$S(BEG>0:$$FPS^RCAMFN01($P(BEG,"."),-3),1:0)
"RTN","RCCPCPS",26,0)
 .   I $P(BEG,".")'<$P(RCDATE,".") Q
"RTN","RCCPCPS",27,0)
 .   D NOW^%DTC S END=%
"RTN","RCCPCPS",28,0)
 .   I BEG<1 S PDAT="",BEG=0,PBAL=0
"RTN","RCCPCPS",29,0)
 .   I BEG S PDAT=BEG,BEG=9999999.999999-BEG,PBAL=0 D PBAL^PRCAGU(DEB,.BEG,.PBAL) ;get prev bal
"RTN","RCCPCPS",30,0)
 .   D EN^PRCAGT(DEB,BEG,.END)
"RTN","RCCPCPS",31,0)
 .   S TBAL=0 D TBAL^PRCAGT(DEB,.TBAL) ;get trans bal
"RTN","RCCPCPS",32,0)
 .   S BBAL=0 D BBAL^PRCAGU(DEB,.BBAL) ;get bill bal
"RTN","RCCPCPS",33,0)
 .   S X=$$PRE^PRCAGU(DEB) S PEND=$P(X,U,2),X=+X I X,BBAL D REF^PRCAGD(DEB,X,$G(REP)) Q
"RTN","RCCPCPS",34,0)
 .   I BBAL=0,PEND,-PEND=PBAL+TBAL Q
"RTN","RCCPCPS",35,0)
 .   I BBAL'=(PBAL+TBAL) D EN^PRCAGD(DEB,BBAL,TBAL,PBAL,BEG,$G(REP)) Q
"RTN","RCCPCPS",36,0)
 .   I BBAL'>0,'$D(^TMP("PRCAGT",$J,DEB)) Q
"RTN","RCCPCPS",37,0)
 .   I BBAL=0,$G(SITE("ZERO")) Q
"RTN","RCCPCPS",38,0)
 .   I BBAL<0,BBAL>-.99 Q
"RTN","RCCPCPS",39,0)
 .   I BBAL'<0,'$D(^XTMP("PRCAGU",$J,DEB)),'COMM Q  ;third letter printed,not comment
"RTN","RCCPCPS",40,0)
 .   S TBAL=TBAL+PBAL
"RTN","RCCPCPS",41,0)
 .   I '$D(^RCPS(349.2,0)) S ^(0)="AR CCPC STATEMENTS RECORDS^349.2I^"
"RTN","RCCPCPS",42,0)
 .   S ^RCPS(349.2,DEB,0)=DEB_"^"_$$SSN^RCFN01(DEB)_"^"
"RTN","RCCPCPS",43,0)
 .   S ADDR=$$DADD^RCAMADD(DEB,1) ;get patient's address, confidential if applicable
"RTN","RCCPCPS",44,0)
 .   S ^RCPS(349.2,DEB,1)=$P(ADDR,"^",1,6)
"RTN","RCCPCPS",45,0)
 .   S ST=$P(ADDR,"^",5)
"RTN","RCCPCPS",46,0)
 .   S ^RCPS(349.2,DEB,7)=$P(^RCD(340,DEB,0),U,7) ;large print
"RTN","RCCPCPS",47,0)
 .   I $G(ST)'="" S ST=$O(^DIC(5,"C",ST,0))
"RTN","RCCPCPS",48,0)
 .   I $G(ST)>90,'$P($G(^DIC(5,ST,0)),"^",6) S FC=$P($G(^DIC(5,ST,0)),"^")
"RTN","RCCPCPS",49,0)
 .   S $P(^RCPS(349.2,DEB,1),"^",7)=$G(FC) S:$G(FC)]"" $P(^RCPS(349.2,DEB,1),"^",5)="FX"
"RTN","RCCPCPS",50,0)
 .   S:$G(FC)]"" $P(^RCPS(349.2,DEB,1),"^",6)=$P(ADDR,"^",8)
"RTN","RCCPCPS",51,0)
 .   D NOW^%DTC S $P(^RCPS(349.2,DEB,0),"^",10)=%
"RTN","RCCPCPS",52,0)
 .   S $P(^RCPS(349.2,DEB,0),"^",3)=$$NAM^RCFN01(DEB)
"RTN","RCCPCPS",53,0)
 .   S $P(^RCPS(349.2,DEB,0),"^",4,7)=$S(TBAL'>0:0,1:TBAL)_"^"_PBAL_"^"_TBAL("CH")_"^"_TBAL("PC"),$P(^(0),"^",8)=PBAL+TBAL("CH")+TBAL("PC")+TBAL("RF")
"RTN","RCCPCPS",54,0)
 .   S $P(^RCPS(349.2,DEB,0),"^",13,17)=BBAL("PB")_"^"_BBAL("INT")_"^"_BBAL("ADM")_"^"_BBAL("MF")_"^"_BBAL("CT")
"RTN","RCCPCPS",55,0)
 .   ;
"RTN","RCCPCPS",56,0)
 .   N RCBILLDA,RCDATA1,RCDEBTDA,RCDESC,RCPSDA,RCTOTAL,RCTRANDA,RCTRDATE,VALUE,RCCOM1,RCCOM2,RCCOM3
"RTN","RCCPCPS",57,0)
 .   S RCDEBTDA=DEB
"RTN","RCCPCPS",58,0)
 .   I '$D(^RCPS(349.2,RCDEBTDA,2,0)) S ^(0)="^349.21DA^^"
"RTN","RCCPCPS",59,0)
 .   ;
"RTN","RCCPCPS",60,0)
 .   S RCCOM1=$E($TR($G(SITE("COM1")),"~|^",""),1,80),(RCCOM2,RCCOM3)=""
"RTN","RCCPCPS",61,0)
 .   ; Add second comment line for the GMT-reduced status
"RTN","RCCPCPS",62,0)
 .   I $$GMT^PRCAGST(RCDEBTDA) S RCCOM2="REDUCTION OF INPATIENT COPAYMENT DUE TO GEOGRAPHIC MEANS TEST STATUS"
"RTN","RCCPCPS",63,0)
 .   I TBAL'>0 S RCCOM3=" *THIS IS NOT A BILL*"
"RTN","RCCPCPS",64,0)
 .   I RCCOM1'="",RCCOM2'="" S $E(RCCOM1,80)=" " ;Make sure GMT message will be printed on separate line.
"RTN","RCCPCPS",65,0)
 .   S ^RCPS(349.2,RCDEBTDA,3)=RCCOM1_RCCOM2_RCCOM3
"RTN","RCCPCPS",66,0)
 .   ;
"RTN","RCCPCPS",67,0)
 .   S RCPSDA=0 ; this variable used to set the description on the PS segment
"RTN","RCCPCPS",68,0)
 .   S RCTRDATE=0 F  S RCTRDATE=$O(^TMP("PRCAGT",$J,RCDEBTDA,RCTRDATE)) Q:'RCTRDATE  S RCBILLDA=0 F  S RCBILLDA=$O(^TMP("PRCAGT",$J,RCDEBTDA,RCTRDATE,RCBILLDA)) Q:'RCBILLDA  D
"RTN","RCCPCPS",69,0)
 .   .   I $P($G(^RCPS(349.2,RCDEBTDA,0)),"^",8)<0 S PC(75)=75
"RTN","RCCPCPS",70,0)
 .   .   I $P($G(^PRCA(430,RCBILLDA,6)),"^",2)]"",($P($G(^PRCA(430,RCBILLDA,7)),"^")>0) S PC(1)="01"
"RTN","RCCPCPS",71,0)
 .   .   S CAT=$P($G(^PRCA(430,RCBILLDA,0)),"^",2)
"RTN","RCCPCPS",72,0)
 .   .   S PC=$P($G(^PRCA(430.2,CAT,0)),"^",14)
"RTN","RCCPCPS",73,0)
 .   .   F X=1:1:100 I $P(PC,",",X)'="" S PCC=$P(PC,",",X),PC(+PCC)=PCC Q:PCC=""
"RTN","RCCPCPS",74,0)
 .   .   S PC="",X=0 F  S X=$O(PC(X)) Q:X=""  I $G(PC(X))'="" S PC=PC_PC(X)
"RTN","RCCPCPS",75,0)
 .   .   S $P(^RCPS(349.2,RCDEBTDA,4),"^")=PC
"RTN","RCCPCPS",76,0)
 .   .   ;
"RTN","RCCPCPS",77,0)
 .   .   I $D(^TMP("PRCAGT",$J,RCDEBTDA,RCTRDATE,RCBILLDA,0)) S AMT=+^(0) I AMT D
"RTN","RCCPCPS",78,0)
 .   .   .   ;  get the description for the bill
"RTN","RCCPCPS",79,0)
 .   .   .   K RCDESC D BILLDESC^RCCPCPS1(RCBILLDA)
"RTN","RCCPCPS",80,0)
 .   .   .   ;
"RTN","RCCPCPS",81,0)
 .   .   .   ;  store the description in file 349.2, PS segment
"RTN","RCCPCPS",82,0)
 .   .   .   S RCPSDA=RCPSDA+1
"RTN","RCCPCPS",83,0)
 .   .   .   S $P(^RCPS(349.2,RCDEBTDA,2,RCPSDA,0),"^",1,4)=$P(RCTRDATE,".")_"^"_$G(RCDESC(1))_"^"_$G(AMT)_"^"_$P(^PRCA(430,RCBILLDA,0),"^")
"RTN","RCCPCPS",84,0)
 .   .   .   F X=2:1 Q:$G(RCDESC(X))=""  S RCPSDA=RCPSDA+1,^RCPS(349.2,RCDEBTDA,2,RCPSDA,0)="^"_RCDESC(X)_"^^"
"RTN","RCCPCPS",85,0)
 .   .   ;
"RTN","RCCPCPS",86,0)
 .   .   S RCTRANDA=0 F  S RCTRANDA=$O(^TMP("PRCAGT",$J,RCDEBTDA,RCTRDATE,RCBILLDA,RCTRANDA)) D:'RCTRANDA NO Q:'RCTRANDA  D
"RTN","RCCPCPS",87,0)
 .   .   .   ;  get the description for the transaction
"RTN","RCCPCPS",88,0)
 .   .   .   K RCDESC D TRANDESC^RCCPCPS1(RCTRANDA),RCDESC
"RTN","RCCPCPS",89,0)
 .   .   .   ;  if it is an interest/admin charge, summarize it below
"RTN","RCCPCPS",90,0)
 .   .   .   I $G(RCDESC(1))["INTEREST" Q
"RTN","RCCPCPS",91,0)
 .   .   .   ;  get the value of the transaction for the statement
"RTN","RCCPCPS",92,0)
 .   .   .   S VALUE=$$TRANVALU^RCDPBTLM(RCTRANDA)
"RTN","RCCPCPS",93,0)
 .   .   .   S VALUE=$P(VALUE,"^",2)+$P(VALUE,"^",3)+$P(VALUE,"^",4)+$P(VALUE,"^",5)+$P(VALUE,"^",6)
"RTN","RCCPCPS",94,0)
 .   .   .   ;  if it is a suspended (47) or unsuspended (46) transaction, show value
"RTN","RCCPCPS",95,0)
 .   .   .   ;  make suspended charges appear as negative
"RTN","RCCPCPS",96,0)
 .   .   .   S RCDATA1=$G(^PRCA(433,RCTRANDA,1))
"RTN","RCCPCPS",97,0)
 .   .   .   I $P(RCDATA1,"^",2)=47!($P(RCDATA1,"^",2)=46) S VALUE=$P(RCDATA1,"^",5) I $P(RCDATA1,"^",2)=47 S VALUE=-VALUE
"RTN","RCCPCPS",98,0)
 .   .   .   ;  if it is an amended bill, show value
"RTN","RCCPCPS",99,0)
 .   .   .   I $P(RCDATA1,"^",2)=33 S VALUE=$P(RCDATA1,"^",5)
"RTN","RCCPCPS",100,0)
 .   .   .   ;  store the description in file 349.2, PS segment
"RTN","RCCPCPS",101,0)
 .   .   .   S RCPSDA=RCPSDA+1
"RTN","RCCPCPS",102,0)
 .   .   .   S $P(^RCPS(349.2,RCDEBTDA,2,RCPSDA,0),"^",1,5)=$P(RCTRDATE,".")_"^"_$G(RCDESC(1))_"^"_VALUE_"^"_$P(^PRCA(430,RCBILLDA,0),"^")
"RTN","RCCPCPS",103,0)
 .   .   .   F X=2:1 Q:$G(RCDESC(X))=""  S RCPSDA=RCPSDA+1,^RCPS(349.2,RCDEBTDA,2,RCPSDA,0)="^"_RCDESC(X)_"^^"
"RTN","RCCPCPS",104,0)
 .   .   .   ;
"RTN","RCCPCPS",105,0)
 .   .   .   ;  for comment transaction ... not sure what this is for ?
"RTN","RCCPCPS",106,0)
 .   .   .   I $P(RCDATA1,"^",2)=45,$P($G(^PRCA(433,RCTRANDA,5)),"^",2)["your waiver rights" S ^RCPS(349.2,+RCDEBTDA,4)="0150"
"RTN","RCCPCPS",107,0)
 .   ;
"RTN","RCCPCPS",108,0)
 .   ;  if interest, admin, or other, add them here
"RTN","RCCPCPS",109,0)
 .   S X=$G(RCTOTAL("INT"))+$G(RCTOTAL("ADM"))+$G(RCTOTAL("OTH"))
"RTN","RCCPCPS",110,0)
 .   I X>0 D
"RTN","RCCPCPS",111,0)
 .   .   S RCDESC="INTEREST/ADM. CHARGE (Int:"_$J($G(RCTOTAL("INT")),1,2)_" Adm:"_$J($G(RCTOTAL("ADM")),1,2)_" Other:"_$J($G(RCTOTAL("OTH")),1,2)_")"
"RTN","RCCPCPS",112,0)
 .   .   S RCPSDA=RCPSDA+1
"RTN","RCCPCPS",113,0)
 .   .   S ^RCPS(349.2,RCDEBTDA,2,RCPSDA,0)="^"_RCDESC_"^"_$J(X,1,2)
"RTN","RCCPCPS",114,0)
 .   .   S ^RCPS(349.2,RCDEBTDA,2,0)="^349.21DA^"_RCPSDA_"^"_RCPSDA
"RTN","RCCPCPS",115,0)
 .   ;
"RTN","RCCPCPS",116,0)
 .   ;  set 0th node
"RTN","RCCPCPS",117,0)
 .   I RCPSDA S ^RCPS(349.2,RCDEBTDA,2,0)="^349.21DA^"_RCPSDA_"^"_RCPSDA
"RTN","RCCPCPS",118,0)
 .   ;
"RTN","RCCPCPS",119,0)
 .   I RCPSDA'<287 S ^XTMP("RCCPC",0)=DT,^XTMP("RCCPC",RCDEBTDA)="" Q
"RTN","RCCPCPS",120,0)
 .   D NO
"RTN","RCCPCPS",121,0)
 ;
"RTN","RCCPCPS",122,0)
 S DIK="^RCPS(349.2," D IXALL^DIK
"RTN","RCCPCPS",123,0)
 S DEB=0 S DEB=$O(^RCPS(349.2,DEB)) Q:DEB=""  S $P(^(DEB,0),"^",18)=1
"RTN","RCCPCPS",124,0)
 K ^XTMP("PRCAGU",$J,DEB),COMM
"RTN","RCCPCPS",125,0)
 ;
"RTN","RCCPCPS",126,0)
OSTM ;Process old statements
"RTN","RCCPCPS",127,0)
 S DIK="^RCPS(349.2,",DA=0 F  S DA=$O(^XTMP("RCCPC",DA)) Q:'DA  D ^DIK
"RTN","RCCPCPS",128,0)
 K DA
"RTN","RCCPCPS",129,0)
 ;
"RTN","RCCPCPS",130,0)
STATMNT ;Print patient statements
"RTN","RCCPCPS",131,0)
 N IOP,ZTIO,ZTSAVE,ZTRTN,ZTDESC,ZTASK,%ZIS,ZTDTH,PRCADEV
"RTN","RCCPCPS",132,0)
 S (IOP,PRCADEV)=$P($G(^RC(342,1,0)),"^",8)
"RTN","RCCPCPS",133,0)
 I IOP]"" D
"RTN","RCCPCPS",134,0)
 .S ZTRTN="STM^RCCPCSTM",ZTDTH=$H,ZTDESC="Print old AR Statements"
"RTN","RCCPCPS",135,0)
 .S %ZIS="N0" D ^%ZIS Q:POP
"RTN","RCCPCPS",136,0)
 .S ZTSAVE("PRCADEV")="" D ^%ZTLOAD,^%ZISC
"RTN","RCCPCPS",137,0)
 Q
"RTN","RCCPCPS",138,0)
 ;
"RTN","RCCPCPS",139,0)
NO ;If there is no activity
"RTN","RCCPCPS",140,0)
 I $G(^RCPS(349.2,+DEB,4))["0150" D
"RTN","RCCPCPS",141,0)
 .S ^RCPS(349.2,+DEB,2,1,0)="^NOTICE: You now have delinquent charges. Please^^"
"RTN","RCCPCPS",142,0)
 .S ^RCPS(349.2,+DEB,2,2,0)="^review Enforcement of Involuntary Collections^^"
"RTN","RCCPCPS",143,0)
 .S ^RCPS(349.2,+DEB,2,3,0)="^on reverse.^^"
"RTN","RCCPCPS",144,0)
 .S ^RCPS(349.2,+DEB,2,0)="^^3^3"
"RTN","RCCPCPS",145,0)
 I $G(^RCPS(349.2,DEB,2,1,0))="" D
"RTN","RCCPCPS",146,0)
 .S ^RCPS(349.2,DEB,2,1,0)="^No Activity in the Last 30 Days!^^"
"RTN","RCCPCPS",147,0)
 .S ^RCPS(349.2,DEB,2,2,0)="^Please refer to previous statement of rights.^^"
"RTN","RCCPCPS",148,0)
 .S ^RCPS(349.2,DEB,2,0)="^^2^2"
"RTN","RCCPCPS",149,0)
 .I $G(^RCPS(349.2,DEB,4))="" S ^(4)="90"
"RTN","RCCPCPS",150,0)
 Q
"RTN","RCCPCPS",151,0)
BUILD ;This is the entry point from the BUILD CCPC file option
"RTN","RCCPCPS",152,0)
 N TDT,QDT,ZTDESC,ZTASK,ZTSK,ZDTDTH,ZTIO,ZTRTN
"RTN","RCCPCPS",153,0)
 S TDT=$O(^RCPS(349.2,0)) I TDT D
"RTN","RCCPCPS",154,0)
 .S TDT=$$ASOF^RCCPCFN($P($G(^RCPS(349.2,+TDT,0)),"^",10))
"RTN","RCCPCPS",155,0)
 .S TDT=$TR($$SLH^RCFN01(TDT),"/","")
"RTN","RCCPCPS",156,0)
 .S TDT("T")=$P($G(^RCT(349,1,0)),"^",10),TDT("T")=$E(TDT("T"),1,4)_$E(TDT("T"),7,8)
"RTN","RCCPCPS",157,0)
 .I TDT("T")=TDT D
"RTN","RCCPCPS",158,0)
 ..W *7,!,"The current file reflects activity as of ",$E(TDT,1,2)_"/"_$E(TDT,3,4)_"/"_$E(TDT,5,8)_".",!
"RTN","RCCPCPS",159,0)
 ..W !,"IT WAS TRANSMITTED ON ",$TR($P($P($G(^RCT(349,1,0)),"^"),".",2,4),".","/"),!
"RTN","RCCPCPS",160,0)
 ..S TDT=$P($G(^RCT(349,1,0)),"^",9)
"RTN","RCCPCPS",161,0)
 ..W !,"For statement date: ",$E(TDT,1,2)_"/"_$E(TDT,3,4)_"/"_$E(TDT,5,8)
"RTN","RCCPCPS",162,0)
 ..W !!,"PLEASE CONTACT CUSTOMER SUPPORT BEFORE PROCEEDING.",!!
"RTN","RCCPCPS",163,0)
TIME S ZTIO="",ZTRTN="EN^RCCPCPS",ZTDESC="Build CCPC Statement File"
"RTN","RCCPCPS",164,0)
 S ZTDTH="" D ^%ZTLOAD Q:$G(ZTSK)=""
"RTN","RCCPCPS",165,0)
 S %H=ZTSK("D") D YMD^%DTC S QDT=X_%
"RTN","RCCPCPS",166,0)
 I (QDT>DT_"."_0800)&(QDT<(DT_"."_1801)) D  G TIME
"RTN","RCCPCPS",167,0)
 .W !!,*7,"You Can Not Queue this Job Between 8:00am and 6:00pm.",!
"RTN","RCCPCPS",168,0)
 .D KILL^%ZTLOAD
"RTN","RCCPCPS",169,0)
 W !,"Queued for Building."
"RTN","RCCPCPS",170,0)
 Q
"RTN","RCCPCPS",171,0)
 ;
"RTN","RCCPCPS",172,0)
RCDESC ;Remove "IN PART" & "IN FULL" from the the bill description
"RTN","RCCPCPS",173,0)
 QUIT:$G(RCDESC(1))=""
"RTN","RCCPCPS",174,0)
 S RCINFULL=" (IN FULL)"
"RTN","RCCPCPS",175,0)
 S RCINPART=" (IN PART)"
"RTN","RCCPCPS",176,0)
 I RCDESC(1)[RCINFULL S RCDESC(1)=$P(RCDESC(1),RCINFULL)_$P(RCDESC(1),RCINFULL,2)
"RTN","RCCPCPS",177,0)
 I RCDESC(1)[RCINPART S RCDESC(1)=$P(RCDESC(1),RCINPART)_$P(RCDESC(1),RCINPART,2)
"RTN","RCCPCPS",178,0)
 Q
"RTN","RCCPCPS1")
0^2^B37370113^B36852341
"RTN","RCCPCPS1",1,0)
RCCPCPS1 ;WISC/RFJ-build description for patient statement ;08 Aug 2001
"RTN","RCCPCPS1",2,0)
 ;;4.5;Accounts Receivable;**34,48,104,170,176,192,265**;Mar 20, 1995;Build 5
"RTN","RCCPCPS1",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","RCCPCPS1",4,0)
 Q
"RTN","RCCPCPS1",5,0)
 ;
"RTN","RCCPCPS1",6,0)
 ;
"RTN","RCCPCPS1",7,0)
TRANDESC(RCTRANDA,RCWIDTH) ;  build the description array for a transaction
"RTN","RCCPCPS1",8,0)
 ;
"RTN","RCCPCPS1",9,0)
 ;  initialize
"RTN","RCCPCPS1",10,0)
 N DESCRIPT,RCBILLDA,RCCATEG,RCCATTXT,RCDATA0,RCDATA1,RCDATA3,RCLINE,TRANTYPE,X
"RTN","RCCPCPS1",11,0)
 I '$G(RCWIDTH) S RCWIDTH=50 ; Default max. width is 50 characters
"RTN","RCCPCPS1",12,0)
 K RCDESC
"RTN","RCCPCPS1",13,0)
 S RCLINE=1,RCDESC(1)=""
"RTN","RCCPCPS1",14,0)
 ;
"RTN","RCCPCPS1",15,0)
 S RCBILLDA=+$P($G(^PRCA(433,RCTRANDA,0)),"^",2) I 'RCBILLDA Q
"RTN","RCCPCPS1",16,0)
 S RCDATA0=^PRCA(430,RCBILLDA,0)
"RTN","RCCPCPS1",17,0)
 S RCCATEG=+$P(RCDATA0,"^",2),RCCATTXT=$P($G(^PRCA(430.2,RCCATEG,0)),"^")
"RTN","RCCPCPS1",18,0)
 S RCDATA1=^PRCA(433,RCTRANDA,1)
"RTN","RCCPCPS1",19,0)
 S TRANTYPE=$P(RCDATA1,"^",2)
"RTN","RCCPCPS1",20,0)
 ;
"RTN","RCCPCPS1",21,0)
 ;  build the first line description
"RTN","RCCPCPS1",22,0)
 ;  if transaction type is an increase or decrease, set description
"RTN","RCCPCPS1",23,0)
 I TRANTYPE=1!(TRANTYPE=35) D
"RTN","RCCPCPS1",24,0)
 .   ;  if c means test, set description to category for c means test
"RTN","RCCPCPS1",25,0)
 .   I RCCATEG=18 S DESCRIPT=$S($P(RCDATA0,"^",16):$P(^PRCA(430.2,$P(RCDATA0,"^",16),0),"^"),1:RCCATTXT) Q
"RTN","RCCPCPS1",26,0)
 .   ;  otherwise, set to category name
"RTN","RCCPCPS1",27,0)
 .   S DESCRIPT=RCCATTXT
"RTN","RCCPCPS1",28,0)
 ;
"RTN","RCCPCPS1",29,0)
 ;  if the bill category is a rx-copay and it is an increase adjustment
"RTN","RCCPCPS1",30,0)
 ;  then set the description to copay
"RTN","RCCPCPS1",31,0)
 I RCCATEG=22!(RCCATEG=23),TRANTYPE=1 S DESCRIPT="COPAY"
"RTN","RCCPCPS1",32,0)
 ;
"RTN","RCCPCPS1",33,0)
 ;  if the bill category is adult day health care, remove health
"RTN","RCCPCPS1",34,0)
 I RCCATEG=33 S DESCRIPT="ADULT DAY CARE"
"RTN","RCCPCPS1",35,0)
 ;
"RTN","RCCPCPS1",36,0)
 ;  if the bill category is respite or geriatric eval,
"RTN","RCCPCPS1",37,0)
 ;  take the 2nd piece removing institutional
"RTN","RCCPCPS1",38,0)
 I RCCATEG=35!(RCCATEG=36)!(RCCATEG=37)!(RCCATEG=38) S DESCRIPT=$P(RCCATTXT,"-")_$S(RCCATEG=35!(RCCATEG=37):" IN",1:" OUT")_"PATIENT"
"RTN","RCCPCPS1",39,0)
 ;
"RTN","RCCPCPS1",40,0)
 ;  if it is a comment transaction
"RTN","RCCPCPS1",41,0)
 I TRANTYPE=45 S DESCRIPT="COMMENT: "_$P($G(^PRCA(433,RCTRANDA,5)),"^",2)
"RTN","RCCPCPS1",42,0)
 ;
"RTN","RCCPCPS1",43,0)
 ;  prepayment bill (1=increase, 35=decrease, otherwise refund)
"RTN","RCCPCPS1",44,0)
 I RCCATEG=26 S DESCRIPT=$S(TRANTYPE=1:"OVERPAYMENT CREDIT",TRANTYPE=35:"OVERPAYMENT CREDIT DECREASE",1:"OVERPAYMENT REFUND")
"RTN","RCCPCPS1",45,0)
 ;
"RTN","RCCPCPS1",46,0)
 ;  if the first line description not set (like payments), set it
"RTN","RCCPCPS1",47,0)
 ;  to the type of transaction
"RTN","RCCPCPS1",48,0)
 I $G(DESCRIPT)="" S DESCRIPT=$P($G(^PRCA(430.3,+$P(RCDATA1,"^",2),0)),"^")
"RTN","RCCPCPS1",49,0)
 ;
"RTN","RCCPCPS1",50,0)
 ;  if the transaction date is different from the process date,
"RTN","RCCPCPS1",51,0)
 ;  show it with the description
"RTN","RCCPCPS1",52,0)
 I $P(RCDATA1,"^"),$P($P(RCDATA1,"^"),".")'=$P($P(RCDATA1,"^",9),".") S DESCRIPT=DESCRIPT_"  ("_$$DATE($P($P(RCDATA1,"^"),"."))_")"
"RTN","RCCPCPS1",53,0)
 ;
"RTN","RCCPCPS1",54,0)
 ;  set the first description line
"RTN","RCCPCPS1",55,0)
 D SETDESC(DESCRIPT)
"RTN","RCCPCPS1",56,0)
 ;
"RTN","RCCPCPS1",57,0)
 ;  if it is a payment transaction, show amount paid interest, admin, other
"RTN","RCCPCPS1",58,0)
 I TRANTYPE=2!(TRANTYPE=34) D
"RTN","RCCPCPS1",59,0)
 .   S RCDATA3=$G(^PRCA(433,RCTRANDA,3))
"RTN","RCCPCPS1",60,0)
 .   ;  if not interest, admin, or other, quit
"RTN","RCCPCPS1",61,0)
 .   I '$P(RCDATA3,"^",2),'$P(RCDATA3,"^",3),'$P(RCDATA3,"^",4),'$P(RCDATA3,"^",5) Q
"RTN","RCCPCPS1",62,0)
 .   ;
"RTN","RCCPCPS1",63,0)
 .   S DESCRIPT="  (Int:"_$J(+$P(RCDATA3,"^",2),1,2)_"  Adm:"_$J(+$P(RCDATA3,"^",3),1,2)
"RTN","RCCPCPS1",64,0)
 .   ;  calculate other
"RTN","RCCPCPS1",65,0)
 .   S X=$P(RCDATA1,"^",5)-$P(RCDATA3,"^")-$P(RCDATA3,"^",2)-$P(RCDATA3,"^",3)
"RTN","RCCPCPS1",66,0)
 .   S DESCRIPT=DESCRIPT_$S(X:" Other:"_$J(X,1,2)_")",1:")")
"RTN","RCCPCPS1",67,0)
 .   D SETDESC(DESCRIPT)
"RTN","RCCPCPS1",68,0)
 ;
"RTN","RCCPCPS1",69,0)
 ;  if it is a admin cost or interest charge, total the amounts
"RTN","RCCPCPS1",70,0)
 I TRANTYPE=13!(TRANTYPE=12) D  Q
"RTN","RCCPCPS1",71,0)
 .   S X=$G(^PRCA(433,RCTRANDA,2)) I X="" Q
"RTN","RCCPCPS1",72,0)
 .   S RCTOTAL("INT")=$G(RCTOTAL("INT"))+$P(X,"^",7)
"RTN","RCCPCPS1",73,0)
 .   S RCTOTAL("ADM")=$G(RCTOTAL("ADM"))+$P(X,"^",8)
"RTN","RCCPCPS1",74,0)
 .   S RCTOTAL("OTH")=$G(RCTOTAL("OTH"))+($P(RCDATA1,"^",5)-$P(X,"^",7)-$P(X,"^",8))
"RTN","RCCPCPS1",75,0)
 ;
"RTN","RCCPCPS1",76,0)
 ;  if not an increase adjustment, quit
"RTN","RCCPCPS1",77,0)
 I TRANTYPE'=1 Q
"RTN","RCCPCPS1",78,0)
 ;
"RTN","RCCPCPS1",79,0)
 ;  increase to c means test, ltc or rx-copay, get data from ib
"RTN","RCCPCPS1",80,0)
 I RCCATEG=18!(RCCATEG=22)!(RCCATEG=23)!((RCCATEG>32)&(RCCATEG<40)) D
"RTN","RCCPCPS1",81,0)
 .   S X="IBRFN1" X ^%ZOSF("TEST") I '$T Q
"RTN","RCCPCPS1",82,0)
 .   K ^TMP("IBRFN1",$J)
"RTN","RCCPCPS1",83,0)
 .   D STMT^IBRFN1(RCTRANDA)
"RTN","RCCPCPS1",84,0)
 .   D IBDATA
"RTN","RCCPCPS1",85,0)
 Q
"RTN","RCCPCPS1",86,0)
 ;
"RTN","RCCPCPS1",87,0)
 ;
"RTN","RCCPCPS1",88,0)
 ;  Returns RCDESC(1..n) array of Bill Description
"RTN","RCCPCPS1",89,0)
BILLDESC(RCBILLDA,RCWIDTH) ;
"RTN","RCCPCPS1",90,0)
 ;  initialize
"RTN","RCCPCPS1",91,0)
 N DESCRIPT,RCCATEG,RCCATTXT,RCDATA0,RCLINE,X
"RTN","RCCPCPS1",92,0)
 I '$G(RCWIDTH) S RCWIDTH=50 ; Default max. width is 50 characters
"RTN","RCCPCPS1",93,0)
 K RCDESC
"RTN","RCCPCPS1",94,0)
 S RCLINE=1,RCDESC(1)=""
"RTN","RCCPCPS1",95,0)
 ;
"RTN","RCCPCPS1",96,0)
 S RCDATA0=^PRCA(430,RCBILLDA,0)
"RTN","RCCPCPS1",97,0)
 S RCCATEG=+$P(RCDATA0,"^",2),RCCATTXT=$P($G(^PRCA(430.2,RCCATEG,0)),"^")
"RTN","RCCPCPS1",98,0)
 ;
"RTN","RCCPCPS1",99,0)
 ;  if category=c means test, set the description and quit
"RTN","RCCPCPS1",100,0)
 I RCCATEG=18 S DESCRIPT=$S($P(RCDATA0,"^",16):$P(^PRCA(430.2,$P(RCDATA0,"^",16),0),"^"),1:RCCATTXT) D SETDESC(DESCRIPT) Q
"RTN","RCCPCPS1",101,0)
 ;
"RTN","RCCPCPS1",102,0)
 ;  set the category description
"RTN","RCCPCPS1",103,0)
 D SETDESC(RCCATTXT)
"RTN","RCCPCPS1",104,0)
 ;
"RTN","RCCPCPS1",105,0)
 ;  if category not champva subsitence and not tricare patient, quit
"RTN","RCCPCPS1",106,0)
 I RCCATEG'=27,RCCATEG'=31 Q
"RTN","RCCPCPS1",107,0)
 ;
"RTN","RCCPCPS1",108,0)
 ;  build description for champva subsistence and tricare patient bills
"RTN","RCCPCPS1",109,0)
 ;  get data from ib
"RTN","RCCPCPS1",110,0)
 S X="IBRFN1" X ^%ZOSF("TEST") I '$T Q
"RTN","RCCPCPS1",111,0)
 K ^TMP("IBRFN1",$J)
"RTN","RCCPCPS1",112,0)
 D STMTB^IBRFN1($P(RCDATA0,"^"))
"RTN","RCCPCPS1",113,0)
 D IBDATA
"RTN","RCCPCPS1",114,0)
 Q
"RTN","RCCPCPS1",115,0)
 ;
"RTN","RCCPCPS1",116,0)
 ;
"RTN","RCCPCPS1",117,0)
IBDATA ;  get data from IB for description
"RTN","RCCPCPS1",118,0)
 N IBDATA,IBJ
"RTN","RCCPCPS1",119,0)
 ;
"RTN","RCCPCPS1",120,0)
 ;  show IB data
"RTN","RCCPCPS1",121,0)
 S IBJ=0 F  S IBJ=$O(^TMP("IBRFN1",$J,IBJ)) Q:'IBJ  S IBDATA=^TMP("IBRFN1",$J,IBJ) D
"RTN","RCCPCPS1",122,0)
 .   ;
"RTN","RCCPCPS1",123,0)
 .   ;  if no drug or bill date returned from IB, then it is outpatient
"RTN","RCCPCPS1",124,0)
 .   I $P(IBDATA,"^",3)="" D:$P(IBDATA,"^",2) SETDESC("VISIT DATE: "_$$DATE($P(IBDATA,"^",2))) Q
"RTN","RCCPCPS1",125,0)
 .   ;
"RTN","RCCPCPS1",126,0)
 .   ;  if no drug quantity returned from ib, then it is inpatient
"RTN","RCCPCPS1",127,0)
 .   I '$P(IBDATA,"^",6) D  Q
"RTN","RCCPCPS1",128,0)
 .   .   I $P(IBDATA,"^",2) D SETDESC("  ADMISSION DATE: "_$$DATE($P(IBDATA,"^",2)))
"RTN","RCCPCPS1",129,0)
 .   .   I $P(IBDATA,"^",3) D SETDESC("  BEGINNING DATE OF BILLING CYCLE: "_$$DATE($P(IBDATA,"^",3)))
"RTN","RCCPCPS1",130,0)
 .   .   I $P(IBDATA,"^",4) D SETDESC("  ENDING DATE OF BILLING CYCLE: "_$$DATE($P(IBDATA,"^",4)))
"RTN","RCCPCPS1",131,0)
 .   .   I $P(IBDATA,"^",5) D SETDESC("  DISCHARGE DATE: "_$$DATE($P(IBDATA,"^",5)))
"RTN","RCCPCPS1",132,0)
 .   ;
"RTN","RCCPCPS1",133,0)
 .   ;  pharmacy
"RTN","RCCPCPS1",134,0)
 .   D:$P(IBDATA,"^",2) SETDESC("RX:"_$P(IBDATA,"^",2))
"RTN","RCCPCPS1",135,0)
 .   D:$P(IBDATA,"^",7) SETDESC("FD:"_$$DATE($P(IBDATA,"^",7)))
"RTN","RCCPCPS1",136,0)
 .   ;
"RTN","RCCPCPS1",137,0)
 .   ;  if not patient statement detail, quit
"RTN","RCCPCPS1",138,0)
 .   I $$DET^RCFN01($P(RCDATA0,"^",9))'=2 Q
"RTN","RCCPCPS1",139,0)
 .   ;
"RTN","RCCPCPS1",140,0)
 .   ;  return pharmacy detail
"RTN","RCCPCPS1",141,0)
 .   I $P(IBDATA,"^",3)'="" D SETDESC(" DRUG:"_$TR($P(IBDATA,"^",3),"|~"))
"RTN","RCCPCPS1",142,0)
 .   I $P(IBDATA,"^",4) D SETDESC(" DAYS:"_$P(IBDATA,"^",4))
"RTN","RCCPCPS1",143,0)
 .   I $P(IBDATA,"^",6) D SETDESC(" QTY:"_$P(IBDATA,"^",6))
"RTN","RCCPCPS1",144,0)
 .   I $P(IBDATA,"^",5)'="" D SETDESC(" PHY:"_$P(IBDATA,"^",5))
"RTN","RCCPCPS1",145,0)
 .   I $P(IBDATA,"^",8) D SETDESC(" CHG:$"_$J($P(IBDATA,"^",8),0,2))
"RTN","RCCPCPS1",146,0)
 ;
"RTN","RCCPCPS1",147,0)
 K ^TMP("IBRFN1",$J)
"RTN","RCCPCPS1",148,0)
 Q
"RTN","RCCPCPS1",149,0)
 ;
"RTN","RCCPCPS1",150,0)
 ;
"RTN","RCCPCPS1",151,0)
 ; Add line to the description, not longer than RCWIDTH
"RTN","RCCPCPS1",152,0)
 ; Input: RCLINE,RCWIDTH
"RTN","RCCPCPS1",153,0)
 ; Output: RCDESC
"RTN","RCCPCPS1",154,0)
SETDESC(DESCRIPT) N LENGTH
"RTN","RCCPCPS1",155,0)
 ;  calculate the length of the description
"RTN","RCCPCPS1",156,0)
 S LENGTH=$L(RCDESC(RCLINE))+$L(DESCRIPT)
"RTN","RCCPCPS1",157,0)
 I RCDESC(RCLINE)'="" S LENGTH=LENGTH+1
"RTN","RCCPCPS1",158,0)
 ;
"RTN","RCCPCPS1",159,0)
 ;  the description line cannot go over RCWIDTH characters
"RTN","RCCPCPS1",160,0)
 I LENGTH<RCWIDTH S RCDESC(RCLINE)=RCDESC(RCLINE)_$S(RCDESC(RCLINE)="":"",1:" ")_DESCRIPT Q
"RTN","RCCPCPS1",161,0)
 ;
"RTN","RCCPCPS1",162,0)
 ; Description line to add is over RCWIDTH
"RTN","RCCPCPS1",163,0)
 ; The given string will be splitted _only_ if the limit is more than 44 characters.
"RTN","RCCPCPS1",164,0)
 I $L(DESCRIPT)>RCWIDTH D  Q
"RTN","RCCPCPS1",165,0)
 .   I RCDESC(RCLINE)'="" S RCLINE=RCLINE+1
"RTN","RCCPCPS1",166,0)
 .   S RCDESC(RCLINE)=$E(DESCRIPT,1,RCWIDTH)
"RTN","RCCPCPS1",167,0)
 .   S RCLINE=RCLINE+1
"RTN","RCCPCPS1",168,0)
 .   S RCDESC(RCLINE)=$E(DESCRIPT,RCWIDTH+1,2*RCWIDTH)
"RTN","RCCPCPS1",169,0)
 ;
"RTN","RCCPCPS1",170,0)
 ;  over RCWIDTH characters, start new line
"RTN","RCCPCPS1",171,0)
 I RCDESC(RCLINE)'="" S RCLINE=RCLINE+1
"RTN","RCCPCPS1",172,0)
 S RCDESC(RCLINE)=DESCRIPT
"RTN","RCCPCPS1",173,0)
 Q
"RTN","RCCPCPS1",174,0)
 ;
"RTN","RCCPCPS1",175,0)
DATE(FMDT) ;  format date mm/dd/yyyy
"RTN","RCCPCPS1",176,0)
 I 'FMDT Q ""
"RTN","RCCPCPS1",177,0)
 N X,Y,%DT S %DT="TX",X=FMDT D ^%DT Q:Y<0 ""
"RTN","RCCPCPS1",178,0)
 Q $E(FMDT,4,5)_"/"_$E(FMDT,6,7)_"/"_(1700+$E(FMDT,1,3))
"RTN","RCDPETR")
0^3^B58559248^B58479252
"RTN","RCDPETR",1,0)
RCDPETR ;ALB/TMK,PJH - EOB TRANSFER IN/TRANSFER OUT REPORTS ; 9/17/10 6:31pm
"RTN","RCDPETR",2,0)
 ;;4.5;Accounts Receivable;**173,269,265**;Mar 20, 1995;Build 5
"RTN","RCDPETR",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","RCDPETR",4,0)
 ; IA for read access to ^IBM(361.1 = 4051
"RTN","RCDPETR",5,0)
 Q
"RTN","RCDPETR",6,0)
 ;
"RTN","RCDPETR",7,0)
RPT ; Transfer In/Out Report
"RTN","RCDPETR",8,0)
 N DIR,X,Y,POP,RCRPT,RCDT1,RCDT2,ZTRTN,ZTSK,ZTDESC,%ZIS
"RTN","RCDPETR",9,0)
 S DIR(0)="SBO^I:TRANSFER IN REPORT;O:TRANSFER OUT REPORT;B:BOTH REPORTS",DIR("A")="SELECT REPORT" D ^DIR K DIR
"RTN","RCDPETR",10,0)
 I $D(DTOUT)!$D(DUOUT)!(Y="") G RPTQ
"RTN","RCDPETR",11,0)
 S RCRPT=Y
"RTN","RCDPETR",12,0)
 S DIR("?")="ENTER THE EARLIEST TRANSFERRED FROM/TO DATE TO INCLUDE ON THE REPORT"
"RTN","RCDPETR",13,0)
 S DIR(0)="DAO^:"_DT_":APE",DIR("A")="START DATE: " D ^DIR K DIR
"RTN","RCDPETR",14,0)
 I $D(DTOUT)!$D(DUOUT)!(Y="") G RPTQ
"RTN","RCDPETR",15,0)
 S RCDT1=Y
"RTN","RCDPETR",16,0)
 S DIR("?")="ENTER THE LATEST TRANSFERRED FROM/TO DATE TO INCLUDE ON THE REPORT"
"RTN","RCDPETR",17,0)
 S DIR(0)="DAO^"_RCDT1_":"_DT_":APE",DIR("A")="END DATE: " D ^DIR K DIR
"RTN","RCDPETR",18,0)
 I $D(DTOUT)!$D(DUOUT)!(Y="") G RPTQ
"RTN","RCDPETR",19,0)
 S RCDT2=Y
"RTN","RCDPETR",20,0)
 ; Ask device
"RTN","RCDPETR",21,0)
 S %ZIS="QM" D ^%ZIS G:POP RPTQ
"RTN","RCDPETR",22,0)
 I $D(IO("Q")) D  G RPTQ
"RTN","RCDPETR",23,0)
 . S ZTRTN="EN^RCDPETR("""_RCRPT_""","""_RCDT1_""","""_RCDT2_""")",ZTDESC="AR - EDI LOCKBOX TRANSFERRED EEOB REPORT"
"RTN","RCDPETR",24,0)
 . D ^%ZTLOAD
"RTN","RCDPETR",25,0)
 . W !!,$S($D(ZTSK):"Your task number "_ZTSK_" has been queued.",1:"Unable to queue this job.")
"RTN","RCDPETR",26,0)
 . K ZTSK,IO("Q") D HOME^%ZIS
"RTN","RCDPETR",27,0)
 U IO
"RTN","RCDPETR",28,0)
 D EN(RCRPT,RCDT1,RCDT2)
"RTN","RCDPETR",29,0)
RPTQ Q
"RTN","RCDPETR",30,0)
 ;
"RTN","RCDPETR",31,0)
EN(RCRPT,RCDT1,RCDT2) ; Entry point for queued job
"RTN","RCDPETR",32,0)
 N Q,Z,Z0,Z1,Z2,ZCT,RCSTOP,RCPG,RCDAT,RCDAT1,RCCT,RCACC,RCNOT,RCRCV,RCNRCV
"RTN","RCDPETR",33,0)
 K ^TMP($J,"RCDPE_TROUT"),^("RCDPE_TRIN")
"RTN","RCDPETR",34,0)
 S (RCSTOP,ZCT)=0
"RTN","RCDPETR",35,0)
 I RCRPT="O"!(RCRPT="B") D  ; Transfer out
"RTN","RCDPETR",36,0)
 . S Z=RCDT1-.0001
"RTN","RCDPETR",37,0)
 . F  S Z=$O(^RCY(344.4,"ATOUT",Z)) Q:'Z!RCSTOP  S Z0=0 F  S Z0=$O(^RCY(344.4,"ATOUT",Z,Z0)) Q:'Z0!(Z0>RCDT2)!RCSTOP  S Z1=0 F  S Z1=$O(^RCY(344.4,"ATOUT",Z,Z0,Z1)) Q:'Z1  D  Q:RCSTOP
"RTN","RCDPETR",38,0)
 .. Q:$$STOP(.ZCT,.RCSTOP,0)
"RTN","RCDPETR",39,0)
 .. ; EOB transferred out was found in date range
"RTN","RCDPETR",40,0)
 .. S ^TMP($J,"RCDPE_TROUT",Z,Z0,Z1)=$G(^RCY(344.4,Z0,1,Z1,0))
"RTN","RCDPETR",41,0)
 .. ; sbscrpts are: date,ien file 344.4,ien file 344.41
"RTN","RCDPETR",42,0)
 ;
"RTN","RCDPETR",43,0)
 I 'RCSTOP,(RCRPT="I"!(RCRPT="B")) D  ; Transfer in
"RTN","RCDPETR",44,0)
 . S Z=RCDT1-.0001 ;  Look for accepted ones
"RTN","RCDPETR",45,0)
 . F  S Z=$O(^IBM(361.1,"ATIN",Z)) Q:'Z!(Z>RCDT2)!RCSTOP  S Z0="" F  S Z0=$O(^IBM(361.1,"ATIN",Z,Z0)) Q:Z0=""!RCSTOP  S Z1=0 F  S Z1=$O(^IBM(361.1,"ATIN",Z,Z0,Z1)) Q:'Z1  D  Q:RCSTOP  ; IA 4051
"RTN","RCDPETR",46,0)
 .. ; EOB transfer in/accepted was found in date range
"RTN","RCDPETR",47,0)
 .. Q:$$STOP(.ZCT,.RCSTOP,0)
"RTN","RCDPETR",48,0)
 .. S ^TMP($J,"RCDPE_TRIN",Z,361.1,Z0,Z1)=$G(^IBM(361.1,Z1,0)) ; IA 4051
"RTN","RCDPETR",49,0)
 .. ;sbscrpts are: date,file,transferred from name,ien file 361.1
"RTN","RCDPETR",50,0)
 .. S ^TMP($J,"RCDPE_TRIN",Z,361.1,Z0,Z1,7)=$G(^IBM(361.1,Z1,7)) ; IA 4051
"RTN","RCDPETR",51,0)
 .. S ^TMP($J,"RCDPE_TRIN",Z,361.1,Z0,Z1,1)=$G(^IBM(361.1,Z1,1)) ; IA 4051
"RTN","RCDPETR",52,0)
 . Q:RCSTOP
"RTN","RCDPETR",53,0)
 . S Z=RCDT1-.0001 ;  Look for pending accept ones
"RTN","RCDPETR",54,0)
 . F  S Z=$O(^RCY(344.5,"ATIN",Z)) Q:Z'!(Z>RCDT2)!RCSTOP  S Z0="" F  S Z0=$O(^RCY(344.5,"ATIN",Z,Z0)) Q:Z0=""!RCSTOP  S Z1=0 F  S Z1=$O(^RCY(344.5,"ATIN",Z,Z0,Z1)) Q:'Z1  D  Q:RCSTOP
"RTN","RCDPETR",55,0)
 .. ; EOB transfer in/pending acceptance was found in date range
"RTN","RCDPETR",56,0)
 .. S ^TMP($J,"RCDPE_TRIN",Z,344.5,Z0,Z1)=$G(^RCY(344.5,Z1,0))
"RTN","RCDPETR",57,0)
 .. ;sbscrpts are: date,file,transferred from name,ien file 344.5
"RTN","RCDPETR",58,0)
 ;
"RTN","RCDPETR",59,0)
 G:RCSTOP ENQ
"RTN","RCDPETR",60,0)
 S (RCPG,RCCT,Z,RCACC,RCNOT,RCRCV,RCNRCV)=0
"RTN","RCDPETR",61,0)
 F  S Z=$O(^TMP($J,"RCDPE_TROUT",Z)) Q:'Z!RCSTOP  S Z0="" F  S Z0=$O(^TMP($J,"RCDPE_TROUT",Z,Z0)) Q:Z0=""!RCSTOP  S Z1=0 F  S Z1=$O(^TMP($J,"RCDPE_TROUT",Z,Z0,Z1)) Q:'Z1  S RCDAT=$G(^(Z1)) D  Q:RCSTOP
"RTN","RCDPETR",62,0)
 . I 'RCPG!(($Y+5)>IOSL) D HDR(.RCCT,.RCPG,.RCSTOP,1,RCDT1,RCDT2) Q:RCSTOP
"RTN","RCDPETR",63,0)
 . S Q=$$SETSTR^VALM1($P(RCDAT,U,5),"",1,11)
"RTN","RCDPETR",64,0)
 . S Q=$$SETSTR^VALM1($$FMTE^XLFDT($P(RCDAT,U,12),"2D"),Q,14,8)
"RTN","RCDPETR",65,0)
 . S Q=$$SETSTR^VALM1($P($G(^DIC(4,+$P(RCDAT,U,11),0)),U),Q,24,20)
"RTN","RCDPETR",66,0)
 . S Q=$$SETSTR^VALM1($$FMTE^XLFDT($P($G(^RCY(344.4,+Z0,0)),U,4),"2D"),Q,46,8)
"RTN","RCDPETR",67,0)
 . S Q=$$SETSTR^VALM1($J(+$P(RCDAT,U,3),"",2),Q,56,12)
"RTN","RCDPETR",68,0)
 . S Q=$$SETSTR^VALM1($S('$P(RCDAT,U,16):"NOT REC'D",$P(RCDAT,U,10)="":"REC'D",$P(RCDAT,U,10)=0:"NOT ACCPTD",1:"ACCPTD"),Q,70,10)
"RTN","RCDPETR",69,0)
 . I '$P(RCDAT,U,16) S RCNRCV=RCNRCV+1
"RTN","RCDPETR",70,0)
 . I $P(RCDAT,U,16)=1,$P(RCDAT,U,10)="" S RCRCV=RCRCV+1
"RTN","RCDPETR",71,0)
 . I $P(RCDAT,U,10) S RCACC=RCACC+1
"RTN","RCDPETR",72,0)
 . I $P(RCDAT,U,10)=0 S RCNOT=RCNOT+1
"RTN","RCDPETR",73,0)
 . D SETLINE(Q,.RCCT)
"RTN","RCDPETR",74,0)
 ;
"RTN","RCDPETR",75,0)
 G:RCSTOP ENQ
"RTN","RCDPETR",76,0)
 ; 
"RTN","RCDPETR",77,0)
 I RCRPT="B"!(RCRPT="O") D
"RTN","RCDPETR",78,0)
 . I '$O(^TMP($J,"RCDPE_TROUT",0)) D  Q
"RTN","RCDPETR",79,0)
 .. D HDR(.RCCT,.RCPG,.RCSTOP,1,RCDT1,RCDT2) Q:RCSTOP
"RTN","RCDPETR",80,0)
 .. D SETLINE("** THERE WERE NO EEOBs TRANSFERRED OUT WITHIN THE DATE RANGE SELECTED",.RCCT)
"RTN","RCDPETR",81,0)
 . I ($Y+5)>IOSL D HDR(.RCCT,.RCPG,.RCSTOP,1,RCDT1,RCDT2) Q:RCSTOP
"RTN","RCDPETR",82,0)
 . D SETLINE(" ",.RCCT)
"RTN","RCDPETR",83,0)
 . D SETLINE(" TOTAL # EEOBs NOT CONFIRMED AS 'RECEIVED' BY OTHER SITES: "_RCNRCV,.RCCT)
"RTN","RCDPETR",84,0)
 . D SETLINE(" TOTAL # EEOBs STILL JUST 'RECEIVED' BY OTHER SITES: "_RCRCV,.RCCT)
"RTN","RCDPETR",85,0)
 . D SETLINE(" TOTAL # EEOBs ACCEPTED BY OTHER SITES: "_RCACC,.RCCT)
"RTN","RCDPETR",86,0)
 . D SETLINE(" TOTAL # EEOBs NOT ACCEPTED BY OTHER SITES: "_RCNOT,.RCCT)
"RTN","RCDPETR",87,0)
 ;
"RTN","RCDPETR",88,0)
 G:RCSTOP ENQ
"RTN","RCDPETR",89,0)
 ;
"RTN","RCDPETR",90,0)
 I RCPG D ASK(.RCSTOP) G:RCSTOP ENQ
"RTN","RCDPETR",91,0)
 S (RCACC,RCNOT,RCPG)=0
"RTN","RCDPETR",92,0)
 S Z=0 F  S Z=$O(^TMP($J,"RCDPE_TRIN",Z)) Q:'Z  S Z0=0 F  S Z0=$O(^TMP($J,"RCDPE_TRIN",Z,Z0)) Q:'Z0  S Z1="" F  S Z1=$O(^TMP($J,"RCDPE_TRIN",Z,Z0,Z1)) Q:Z1=""  S Z2=0 F  S Z2=$O(^TMP($J,"RCDPE_TRIN",Z,Z0,Z1,Z2)) Q:'Z2  D
"RTN","RCDPETR",93,0)
 . S RCDAT=$G(^TMP($J,"RCDPE_TRIN",Z,Z0,Z1,Z2))
"RTN","RCDPETR",94,0)
 . I Z0=361.1 S RCDAT(7)=$G(^TMP($J,"RCDPE_TRIN",Z,Z0,Z1,Z2,7)),RCDAT(1)=$G(^(1))
"RTN","RCDPETR",95,0)
 . I 'RCPG!(($Y+5)>IOSL) D HDR(.RCCT,.RCPG,.RCSTOP,0,RCDT1,RCDT2) Q:RCSTOP
"RTN","RCDPETR",96,0)
 . I Z0=361.1 D
"RTN","RCDPETR",97,0)
 .. S Q=$$SETSTR^VALM1($$BN1^PRCAFN(+RCDAT),"",1,11)
"RTN","RCDPETR",98,0)
 .. S Q=$$SETSTR^VALM1($$FMTE^XLFDT($P(RCDAT,U,5),"2D"),Q,14,8)
"RTN","RCDPETR",99,0)
 .. S Q=$$SETSTR^VALM1($P(RCDAT(7),U),Q,24,20)
"RTN","RCDPETR",100,0)
 .. S Q=$$SETSTR^VALM1($$FMTE^XLFDT($P(RCDAT,U,6),"2D"),Q,46,8)
"RTN","RCDPETR",101,0)
 .. S Q=$$SETSTR^VALM1($J(+$P(RCDAT(1),U),"",2),Q,56,12)
"RTN","RCDPETR",102,0)
 .. S Q=$$SETSTR^VALM1("ACCEPTED",Q,70,10)
"RTN","RCDPETR",103,0)
 .. S RCACC=RCACC+1
"RTN","RCDPETR",104,0)
 . E  D
"RTN","RCDPETR",105,0)
 .. D RAWBILL(Z2,.RCDAT1)
"RTN","RCDPETR",106,0)
 .. S RCDAT1=+$O(RCDAT1(0)),RCDAT1=$G(RCDAT1(RCDAT1))
"RTN","RCDPETR",107,0)
 .. S Q=$$SETSTR^VALM1($P(RCDAT1,U),"",1,11)
"RTN","RCDPETR",108,0)
 .. S Q=$$SETSTR^VALM1($$FMTE^XLFDT($P(RCDAT,U,3),"2D"),Q,14,8)
"RTN","RCDPETR",109,0)
 .. S Q=$$SETSTR^VALM1($P(RCDAT,U,12),Q,24,20)
"RTN","RCDPETR",110,0)
 .. S Q=$$SETSTR^VALM1($S($G(RCDAT1(0)):$E(RCDAT1(0),5,6)_"/"_$E(RCDAT1(0),7,8)_"/"_$E(RCDAT1(0),3,4),1:""),Q,46,8)
"RTN","RCDPETR",111,0)
 .. S Q=$$SETSTR^VALM1($J(+$P(RCDAT1,U,2),"",2),Q,56,12)
"RTN","RCDPETR",112,0)
 .. S Q=$$SETSTR^VALM1("PENDING",Q,70,10)
"RTN","RCDPETR",113,0)
 .. S RCNOT=RCNOT+1
"RTN","RCDPETR",114,0)
 . D SETLINE(Q,.RCCT)
"RTN","RCDPETR",115,0)
 ;
"RTN","RCDPETR",116,0)
 G:RCSTOP ENQ
"RTN","RCDPETR",117,0)
 ; 
"RTN","RCDPETR",118,0)
 I RCRPT="B"!(RCRPT="I") D
"RTN","RCDPETR",119,0)
 . I '$O(^TMP($J,"RCDPE_TRIN",0)) D  Q
"RTN","RCDPETR",120,0)
 .. D HDR(.RCCT,.RCPG,.RCSTOP,0,RCDT1,RCDT2) Q:RCSTOP
"RTN","RCDPETR",121,0)
 .. D SETLINE("** THERE WERE NO EEOBs TRANSFERRED 'IN' WITHIN THE DATE RANGE SELECTED",.RCCT)
"RTN","RCDPETR",122,0)
 . I ($Y+5)>IOSL D HDR(.RCCT,.RCPG,.RCSTOP,0,RCDT1,RCDT2) Q:RCSTOP
"RTN","RCDPETR",123,0)
 . D SETLINE(" ",.RCCT)
"RTN","RCDPETR",124,0)
 . D SETLINE(" TOTAL # EEOBs YOU ACCEPTED: "_RCACC,.RCCT)
"RTN","RCDPETR",125,0)
 . D SETLINE(" TOTAL # EEOBs STILL PENDING: "_RCNOT,.RCCT)
"RTN","RCDPETR",126,0)
 ;
"RTN","RCDPETR",127,0)
ENQ I '$D(ZTQUEUED) D ^%ZISC I 'RCSTOP,RCPG D ASK(.RCSTOP)
"RTN","RCDPETR",128,0)
 I $D(ZTQUEUED) S ZTREQ="@"
"RTN","RCDPETR",129,0)
 K ^TMP($J,"RCDPE_TROUT"),^("RCDPE_TRIN")
"RTN","RCDPETR",130,0)
 Q
"RTN","RCDPETR",131,0)
 ;
"RTN","RCDPETR",132,0)
HDR(RCCT,RCPG,RCSTOP,RCINOUT,RCDT1,RCDT2) ;Prints report heading
"RTN","RCDPETR",133,0)
 ; Function returns RCPG = current page # and RCCT = running line count
"RTN","RCDPETR",134,0)
 ;   and RCSTOP = 1 if user aborted print
"RTN","RCDPETR",135,0)
 ; Parameters must be passed by reference
"RTN","RCDPETR",136,0)
 N Z,Z0
"RTN","RCDPETR",137,0)
 I RCPG!($E(IOST,1,2)="C-") D  Q:RCSTOP
"RTN","RCDPETR",138,0)
 . I RCPG&($E(IOST,1,2)="C-") D ASK(.RCSTOP) Q:RCSTOP
"RTN","RCDPETR",139,0)
 . W @IOF,*13 ; Write form feed
"RTN","RCDPETR",140,0)
 S RCPG=RCPG+1
"RTN","RCDPETR",141,0)
 S Z0="EDI LOCKBOX EEOBs TRANSFERRED "_$S(RCINOUT=1:"OUT",1:"IN")_" REPORT"
"RTN","RCDPETR",142,0)
 S Z=$$SETSTR^VALM1($J("",80-$L(Z0)\2)_Z0,"",1,79)
"RTN","RCDPETR",143,0)
 S Z=$$SETSTR^VALM1("Page: "_RCPG,Z,70,10)
"RTN","RCDPETR",144,0)
 D SETLINE(Z,.RCCT)
"RTN","RCDPETR",145,0)
 S Z0="RUN DATE: "_$$FMTE^XLFDT(DT,2),Z0=$J("",80-$L(Z0)\2)_Z0
"RTN","RCDPETR",146,0)
 S Z=$$SETSTR^VALM1(Z0,"",1,79)
"RTN","RCDPETR",147,0)
 D SETLINE(Z,.RCCT)
"RTN","RCDPETR",148,0)
 D SETLINE(" ",.RCCT)
"RTN","RCDPETR",149,0)
 D SETLINE("DATE RANGE SELECTED: "_$$FMTE^XLFDT(RCDT1,2)_"-"_$$FMTE^XLFDT(RCDT2,2),.RCCT)
"RTN","RCDPETR",150,0)
 D SETLINE(" ",.RCCT)
"RTN","RCDPETR",151,0)
 S Z=$$SETSTR^VALM1($E("BILL #"_$J("",13),1,13)_"TRANS DT"_$J("",2)_$E("TRANS "_$S(RCINOUT=1:"TO",1:"FROM")_$J("",21),1,21)_"EEOB DATE"_$J("",2)_$E("AMT PAID"_$J("",14),1,14)_"STATUS","",1,80)
"RTN","RCDPETR",152,0)
 D SETLINE(Z,.RCCT)
"RTN","RCDPETR",153,0)
 D SETLINE($TR($J("",IOM-1)," ","="),.RCCT)
"RTN","RCDPETR",154,0)
 I $$STOP(99,.RCSTOP,0)
"RTN","RCDPETR",155,0)
 Q
"RTN","RCDPETR",156,0)
 ;
"RTN","RCDPETR",157,0)
SETLINE(Z,RCCT) ; Writes line
"RTN","RCDPETR",158,0)
 ; Z = txt to output
"RTN","RCDPETR",159,0)
 ; RCCT = line counter
"RTN","RCDPETR",160,0)
 S RCCT=RCCT+1
"RTN","RCDPETR",161,0)
 W !,Z
"RTN","RCDPETR",162,0)
 Q
"RTN","RCDPETR",163,0)
 ;
"RTN","RCDPETR",164,0)
ASK(RCSTOP) ; Ask to continue
"RTN","RCDPETR",165,0)
 ; If passed by reference ,RCSTOP is returned as 1 if print is aborted
"RTN","RCDPETR",166,0)
 I $E(IOST,1,2)'["C-" Q
"RTN","RCDPETR",167,0)
 N DIR,DIROUT,DIRUT,DTOUT,DUOUT
"RTN","RCDPETR",168,0)
 S DIR(0)="E" W ! D ^DIR
"RTN","RCDPETR",169,0)
 I ($D(DIRUT))!($D(DUOUT)) S RCSTOP=1 Q
"RTN","RCDPETR",170,0)
 Q
"RTN","RCDPETR",171,0)
 ;
"RTN","RCDPETR",172,0)
STOP(CT,RCSTOP,RCPG) ; Function returns 1 if queued job/user requested forced exit
"RTN","RCDPETR",173,0)
 ; Function returns CT if passed by ref to only check every 100 records
"RTN","RCDPETR",174,0)
 S CT=CT+1
"RTN","RCDPETR",175,0)
 I (CT#100) Q 0
"RTN","RCDPETR",176,0)
 I $D(ZTQUEUED),$$S^%ZTLOAD S (RCSTOP,ZTSTOP)=1 K ZTREQ I +$G(RCPG) W !,"***TASK STOPPED BY USER***" Q 1
"RTN","RCDPETR",177,0)
 Q 0
"RTN","RCDPETR",178,0)
 ;
"RTN","RCDPETR",179,0)
RAWBILL(RC3445,RCDAT) ; Returns bill specific data for entry in file 344.5
"RTN","RCDPETR",180,0)
 ; RC3445 = Ien file 344.5
"RTN","RCDPETR",181,0)
 ; FUNCTION RETURNS RCDAT(SEQ #)=Bill #^amt pd^EOB date  (pass by ref)
"RTN","RCDPETR",182,0)
 N DAT,Z,Z0,RCT
"RTN","RCDPETR",183,0)
 S (RCT,Z)=0 F  S Z=$O(^RCY(344.5,RC3445,2,Z)) Q:'Z  S Z0=$G(^(Z,0)) D
"RTN","RCDPETR",184,0)
 . I +Z0=835 S RCDAT(0)=$P(Z0,U,3) Q
"RTN","RCDPETR",185,0)
 . I +Z0=10 S RCT=RCT+1,RCDAT(RCT)=$P(Z0,U,2)_U_$J($P(Z0,U,11)/100,"",2)
"RTN","RCDPETR",186,0)
 Q
"RTN","RCDPETR",187,0)
 ;
"VER")
8.0^22.0
"BLD",8538,6)
^265
**END**
**END**

