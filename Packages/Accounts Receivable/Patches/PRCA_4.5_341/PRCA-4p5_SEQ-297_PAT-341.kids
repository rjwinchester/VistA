EMERGENCY Released PRCA*4.5*341 SEQ #297
Extracted from mail message
**KIDS**:PRCA*4.5*341^

**INSTALL NAME**
PRCA*4.5*341
"BLD",10470,0)
PRCA*4.5*341^ACCOUNTS RECEIVABLE^0^3180710^y
"BLD",10470,4,0)
^9.64PA^^
"BLD",10470,6.3)
2
"BLD",10470,"ABPKG")
n
"BLD",10470,"KRN",0)
^9.67PA^779.2^20
"BLD",10470,"KRN",.4,0)
.4
"BLD",10470,"KRN",.401,0)
.401
"BLD",10470,"KRN",.402,0)
.402
"BLD",10470,"KRN",.403,0)
.403
"BLD",10470,"KRN",.5,0)
.5
"BLD",10470,"KRN",.84,0)
.84
"BLD",10470,"KRN",3.6,0)
3.6
"BLD",10470,"KRN",3.8,0)
3.8
"BLD",10470,"KRN",9.2,0)
9.2
"BLD",10470,"KRN",9.8,0)
9.8
"BLD",10470,"KRN",9.8,"NM",0)
^9.68A^2^2
"BLD",10470,"KRN",9.8,"NM",1,0)
RCTCSP1^^0^B169151504
"BLD",10470,"KRN",9.8,"NM",2,0)
RCTCSP1A^^0^B44957628
"BLD",10470,"KRN",9.8,"NM","B","RCTCSP1",1)

"BLD",10470,"KRN",9.8,"NM","B","RCTCSP1A",2)

"BLD",10470,"KRN",19,0)
19
"BLD",10470,"KRN",19.1,0)
19.1
"BLD",10470,"KRN",101,0)
101
"BLD",10470,"KRN",409.61,0)
409.61
"BLD",10470,"KRN",771,0)
771
"BLD",10470,"KRN",779.2,0)
779.2
"BLD",10470,"KRN",870,0)
870
"BLD",10470,"KRN",8989.51,0)
8989.51
"BLD",10470,"KRN",8989.52,0)
8989.52
"BLD",10470,"KRN",8994,0)
8994
"BLD",10470,"KRN","B",.4,.4)

"BLD",10470,"KRN","B",.401,.401)

"BLD",10470,"KRN","B",.402,.402)

"BLD",10470,"KRN","B",.403,.403)

"BLD",10470,"KRN","B",.5,.5)

"BLD",10470,"KRN","B",.84,.84)

"BLD",10470,"KRN","B",3.6,3.6)

"BLD",10470,"KRN","B",3.8,3.8)

"BLD",10470,"KRN","B",9.2,9.2)

"BLD",10470,"KRN","B",9.8,9.8)

"BLD",10470,"KRN","B",19,19)

"BLD",10470,"KRN","B",19.1,19.1)

"BLD",10470,"KRN","B",101,101)

"BLD",10470,"KRN","B",409.61,409.61)

"BLD",10470,"KRN","B",771,771)

"BLD",10470,"KRN","B",779.2,779.2)

"BLD",10470,"KRN","B",870,870)

"BLD",10470,"KRN","B",8989.51,8989.51)

"BLD",10470,"KRN","B",8989.52,8989.52)

"BLD",10470,"KRN","B",8994,8994)

"BLD",10470,"QUES",0)
^9.62^^
"BLD",10470,"REQB",0)
^9.611^1^1
"BLD",10470,"REQB",1,0)
PRCA*4.5*339^2
"BLD",10470,"REQB","B","PRCA*4.5*339",1)

"MBREQ")
0
"PKG",53,-1)
1^1
"PKG",53,0)
ACCOUNTS RECEIVABLE^PRCA^FMS
"PKG",53,20,0)
^9.402P^^0
"PKG",53,22,0)
^9.49I^1^1
"PKG",53,22,1,0)
4.5^3051119^2960627
"PKG",53,22,1,"PAH",1,0)
341^3180710
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
2
"RTN","RCTCSP1")
0^1^B169151504^B172072875
"RTN","RCTCSP1",1,0)
RCTCSP1 ;ALBANY/BDB-CROSS-SERVICING TRANSMISSION ;03/15/14 3:34 PM
"RTN","RCTCSP1",2,0)
 ;;4.5;Accounts Receivable;**301,331,315,339,341**;Mar 20, 1995;Build 2
"RTN","RCTCSP1",3,0)
 ;;Per VA Directive 6402, this routine should not be modified.
"RTN","RCTCSP1",4,0)
 ;
"RTN","RCTCSP1",5,0)
 ;PRCA*4.5*331 Modify code to ensure that the debtor address info
"RTN","RCTCSP1",6,0)
 ;             is correct on transmission of foreign veterans 
"RTN","RCTCSP1",7,0)
 ;             debtor/bills to Treasury.
"RTN","RCTCSP1",8,0)
 Q
"RTN","RCTCSP1",9,0)
 ;
"RTN","RCTCSP1",10,0)
BILLREP ;Cross-servicing bill report, prints individual bills that make up a cross-servicing account
"RTN","RCTCSP1",11,0)
 N DIC,DEBTOR,ZTSAVE,ZTDESC,ZTRTN,POP,DTFRMTO,PROMPT,EXCEL
"RTN","RCTCSP1",12,0)
 K ^TMP("RCTCSP1",$J)
"RTN","RCTCSP1",13,0)
 S DIC=340,DIC(0)="AEQM",DIC("S")="I $D(^RCD(340,""TCSP"",+Y))" D ^DIC
"RTN","RCTCSP1",14,0)
 Q:Y<1  S DEBTOR=+Y
"RTN","RCTCSP1",15,0)
 S DTFRMTO=$$DTFRMTO^RCTCSP2 Q:'DTFRMTO  ;Get date range as per PRCA*4.5*315
"RTN","RCTCSP1",16,0)
 S EXCEL=0,PROMPT="CAPTURE Report data to an Excel Document",DIR(0)="Y",DIR("?")="^D HEXC^RCTCSJR"
"RTN","RCTCSP1",17,0)
 S EXCEL=$$SELECT^RCTCSJR(PROMPT,"NO") I "01"'[EXCEL S STOP=1 Q
"RTN","RCTCSP1",18,0)
 I EXCEL=1 D EXCMSG^RCTCSJR ; Display Excel display message
"RTN","RCTCSP1",19,0)
 K IOP,IO("Q") S %ZIS="MQ",%ZIS("B")="" D ^%ZIS G:POP BILLREPQ S IOP=ION_";"_IOM_";"_IOSL
"RTN","RCTCSP1",20,0)
 I $D(IO("Q")) D  G BILLREPQ
"RTN","RCTCSP1",21,0)
 .S ZTSAVE("DEBTOR")="",ZTSAVE("DTFRMTO")="",ZTSAVE("EXCEL")=""
"RTN","RCTCSP1",22,0)
 .S ZTRTN="BILLREPP^RCTCSP1",ZTDESC="CROSS-SERVICING BILL REPORT"
"RTN","RCTCSP1",23,0)
 .D ^%ZTLOAD,HOME^%ZIS
"RTN","RCTCSP1",24,0)
 .I $G(ZTSK) W !!,"Report compilation has started with task# ",ZTSK,".",! S DIR(0)="E" D ^DIR K DIR
"RTN","RCTCSP1",25,0)
 .Q
"RTN","RCTCSP1",26,0)
 ;
"RTN","RCTCSP1",27,0)
BILLREPP ;Call to build array of bills referred
"RTN","RCTCSP1",28,0)
 U IO
"RTN","RCTCSP1",29,0)
 N BILL,B7,B14,B15,B16,D4,FND,BAMT,TAMT,DIRUT,TNM,TID,TDT,DASH,CSTAT,PAGE,DASH,TMP,I,DATE,DTFRM,DTTO,DATDATE
"RTN","RCTCSP1",30,0)
 K ^TMP("RCTCSP1",$J)
"RTN","RCTCSP1",31,0)
 S DASH="",$P(DASH,"-",78)=""  ;(as per PRCA*4.5*315)
"RTN","RCTCSP1",32,0)
 S (DATE,DTFRM)=$$FMADD^XLFDT(+$P(DTFRMTO,U,2)),DTTO=$P(DTFRMTO,U,3)
"RTN","RCTCSP1",33,0)
 S (BAMT,TAMT,BILL,PAGE)=0
"RTN","RCTCSP1",34,0)
 ; rewritten to sort by "TCSP" (#151 date referred to TCSP) not the "AB" xref... PRCA*4.5*315 (TV8)
"RTN","RCTCSP1",35,0)
 F  S BILL=$O(^PRCA(430,"TCSP",BILL)) Q:BILL=""!($D(DIRUT))  D
"RTN","RCTCSP1",36,0)
 .Q:$P($G(^PRCA(430,BILL,0)),U,9)'=DEBTOR
"RTN","RCTCSP1",37,0)
 .Q:'+$G(^PRCA(430,BILL,15))
"RTN","RCTCSP1",38,0)
 .S DATDATE=$P($G(^PRCA(430,BILL,15)),U) Q:DATDATE<DTFRM!(DATDATE>DTTO)
"RTN","RCTCSP1",39,0)
 .S B7=$G(^PRCA(430,BILL,7))
"RTN","RCTCSP1",40,0)
 .S BAMT=0 F I=1:1:5 S BAMT=BAMT+$P(B7,U,I)
"RTN","RCTCSP1",41,0)
 .S TAMT=TAMT+BAMT
"RTN","RCTCSP1",42,0)
 .S ^TMP("RCTCSP1",$J,DEBTOR,BILL)=BAMT
"RTN","RCTCSP1",43,0)
 D BILLREPH
"RTN","RCTCSP1",44,0)
 S DEBTOR="" F  S DEBTOR=$O(^TMP("RCTCSP1",$J,DEBTOR)) Q:'DEBTOR!($D(DIRUT))  D
"RTN","RCTCSP1",45,0)
 . S BILL=0 F  S BILL=$O(^TMP("RCTCSP1",$J,DEBTOR,BILL)) Q:'BILL  D
"RTN","RCTCSP1",46,0)
 ..Q:'+$G(^PRCA(430,BILL,15))
"RTN","RCTCSP1",47,0)
 ..S FND=1 W !,$P(^PRCA(430,BILL,0),U) S CSTAT=$P(^(0),U,8),B7=$G(^(7)),B15=$G(^(15)),B16=$G(^(16))
"RTN","RCTCSP1",48,0)
 ..I 'EXCEL W ?12,$P(^PRCA(430.3,CSTAT,0),U,2)
"RTN","RCTCSP1",49,0)
 ..I EXCEL W U_$P(^PRCA(430.3,CSTAT,0),U,2)
"RTN","RCTCSP1",50,0)
 ..I 'EXCEL W ?15
"RTN","RCTCSP1",51,0)
 ..I EXCEL W U
"RTN","RCTCSP1",52,0)
 ..W $J($P(B16,U,9),8,2)
"RTN","RCTCSP1",53,0)
 ..S BAMT=^TMP("RCTCSP1",$J,DEBTOR,BILL)
"RTN","RCTCSP1",54,0)
 ..I 'EXCEL W ?25
"RTN","RCTCSP1",55,0)
 ..I EXCEL W U
"RTN","RCTCSP1",56,0)
 ..W $J(BAMT,8,2)
"RTN","RCTCSP1",57,0)
 ..I 'EXCEL W $J($P(B7,U,1),9,2),$J($P(B7,U,2),7,2),$J($P(B7,U,3),8,2),$J($P(B7,U,4),8,2)  ;(as per PRCA*4.5*315)
"RTN","RCTCSP1",58,0)
 ..I EXCEL W $J($P(B7,U,1),8,2)_U_$J($P(B7,U,2),7,2)_U_$J($P(B7,U,3),7,2)_U_$J($P(B7,U,4),8,2)
"RTN","RCTCSP1",59,0)
 ..S TMP=$$FMTE^XLFDT($P(B15,U,1),"2Z")  ;Format date to n/n/nn  (as per PRCA*4.5*315)
"RTN","RCTCSP1",60,0)
 ..I 'EXCEL W ?67,TMP  ;$P(TMP,", ",1)_","_$P(TMP,", ",2)  ;
"RTN","RCTCSP1",61,0)
 ..I EXCEL W U_TMP
"RTN","RCTCSP1",62,0)
 ..;check for end of page here, if necessary form feed and print header
"RTN","RCTCSP1",63,0)
 ..I ($Y+3)>IOSL D
"RTN","RCTCSP1",64,0)
 ...I $E(IOST,1,2)="C-" S DIR(0)="E" K DIRUT D ^DIR Q:$D(DIRUT)
"RTN","RCTCSP1",65,0)
 ...D BILLREPH
"RTN","RCTCSP1",66,0)
 I $E(IOST,1,2)="C-" R !!,"END OF REPORT...PRESS RETURN TO CONTINUE",X:DTIME W @IOF
"RTN","RCTCSP1",67,0)
 D ^%ZISC
"RTN","RCTCSP1",68,0)
 S:$D(ZTQUEUED) ZTREQ="@"
"RTN","RCTCSP1",69,0)
 K ^TMP("RCTCSP1",$J)
"RTN","RCTCSP1",70,0)
 K IOP,%ZIS,ZTQUEUED
"RTN","RCTCSP1",71,0)
BILLREPQ Q
"RTN","RCTCSP1",72,0)
 ;
"RTN","RCTCSP1",73,0)
BILLREPH ;header for cross-servicing bill report
"RTN","RCTCSP1",74,0)
 W @IOF
"RTN","RCTCSP1",75,0)
 S PAGE=PAGE+1
"RTN","RCTCSP1",76,0)
 I 'EXCEL W "PAGE "_PAGE,?24,"CROSS-SERVICING BILL REPORT",?60,$$FMTE^XLFDT(DT,"2Z"),!,DASH
"RTN","RCTCSP1",77,0)
 I EXCEL W "PAGE "_PAGE_U_"CROSS-SERVICING BILL REPORT"_U_U_$$FMTE^XLFDT(DT,"2Z")
"RTN","RCTCSP1",78,0)
 N RCHDR,RCSSN
"RTN","RCTCSP1",79,0)
 S RCHDR=$$ACCNTHDR^RCDPAPLM(DEBTOR),RCSSN=$S($P(RCHDR,U,2)["P":$E($P(RCHDR,U,2),7,11),1:$E($P(RCHDR,U,2),6,9))  ;Pseudo SSN shouldn't be allowed but we allowed for it to print
"RTN","RCTCSP1",80,0)
 I 'EXCEL D  Q 
"RTN","RCTCSP1",81,0)
 . W !!,"DEBTOR: ",$E($P(RCHDR,U,1),1,18),?22,"SSN: ",RCSSN,?45,"CURRENT CS DEBT: ",$J(TAMT,8,2),!,DASH
"RTN","RCTCSP1",82,0)
 . W !,"BILL NO.",?12,"ST",?15,"ORIG AMT",?25,"CURR AMT",?38,"PRIN",?46,"INT",?52,"ADMIN",?60,"COURT",?67,"CS REF DT" ;(as per PRCA*4.5*315)
"RTN","RCTCSP1",83,0)
 . W !,"---- ---",?12,"--",?15,"---- ---",?25,"---- ---",?38,"----",?46,"---",?52,"-----",?60,"-----",?67,"-- -------"
"RTN","RCTCSP1",84,0)
 W !,"DEBTOR: "_$E($P(RCHDR,U,1),1,18)_U_U_"SSN: "_RCSSN_U_U_U_"CURRENT CS DEBT: "_$J(TAMT,8,2)
"RTN","RCTCSP1",85,0)
 W !,"BILL NO."_U_"ST"_U_"ORIG AMT"_U_"CURR AMT"_U_"PRIN"_U_"INT"_U_"ADMIN"_U_"COURT"_U_"CS REF DATE"
"RTN","RCTCSP1",86,0)
 Q
"RTN","RCTCSP1",87,0)
 ;
"RTN","RCTCSP1",88,0)
CSRPRT ;Print Cross-Servicing Report, prints sorted individual bills that make up a cross-servicing account
"RTN","RCTCSP1",89,0)
 ;
"RTN","RCTCSP1",90,0)
 K ^TMP("RCTCSP1",$J)
"RTN","RCTCSP1",91,0)
 N DIC,RCSORT,PAGE,DASH,DTOUT,DIRUT,DUOUT,DIROUT,RCIEN,RCDEBTOR,RCREFDT,RCSSN,RCORIG,RCCAMT,RCREFDT,RCBILL,ITEM,DBTR,SDT,SSN,NCIEN,TERMDIG
"RTN","RCTCSP1",92,0)
 S PAGE=0,DASH="",$P(DASH,"-",81)=""
"RTN","RCTCSP1",93,0)
 W !
"RTN","RCTCSP1",94,0)
 S DIR(0)="S^1:Bill Number;2:Debtor Name;3:CS Referred Date",DIR("A")="Sort by" D ^DIR K DIR
"RTN","RCTCSP1",95,0)
 S RCSORT=Y Q:($D(DTOUT)!$D(DUOUT)!$D(DIROUT))
"RTN","RCTCSP1",96,0)
 ; The following sections were rewritten to eliminate using ^DIP - (as per PRCA*4.5*315 reformat dates and SSN)
"RTN","RCTCSP1",97,0)
 S DTFRMTO=$$DTFRMTO^RCTCSP2 Q:'DTFRMTO  ;Get date range as per PRCA*4.5*315
"RTN","RCTCSP1",98,0)
 S (DATE,DTFRM)=$$FMADD^XLFDT(+$P(DTFRMTO,U,2)),DTTO=$P(DTFRMTO,U,3)
"RTN","RCTCSP1",99,0)
 S EXCEL=0,PROMPT="CAPTURE Report data to an Excel Document",DIR(0)="Y",DIR("?")="^D HEXC^RCTCSJR"
"RTN","RCTCSP1",100,0)
 S EXCEL=$$SELECT^RCTCSJR(PROMPT,"NO") I "01"'[EXCEL S STOP=1 Q
"RTN","RCTCSP1",101,0)
 I EXCEL=1 D EXCMSG^RCTCSJR ; Display Excel display message
"RTN","RCTCSP1",102,0)
 K IOP,IO("Q") S %ZIS="MQ",%ZIS("B")="" D ^%ZIS Q:POP  S IOP=ION_";"_IOM_";"_IOSL
"RTN","RCTCSP1",103,0)
 I $D(IO("Q")) D  Q
"RTN","RCTCSP1",104,0)
 .S ZTSAVE("RCSORT")="",ZTSAVE("DTFRMTO")="",ZTSAVE("EXCEL")="",ZTSAVE("PROMPT")="",ZTSAVE("PAGE")="",ZTSAVE("DASH")=""
"RTN","RCTCSP1",105,0)
 .S ZTRTN="CSRPRTR^RCTCSP1",ZTDESC="PRINT CROSS-SERVICING REPORT"
"RTN","RCTCSP1",106,0)
 .D ^%ZTLOAD,HOME^%ZIS
"RTN","RCTCSP1",107,0)
 .I $G(ZTSK) W !!,"Report compilation has started with task# ",ZTSK,".",! S DIR(0)="E" D ^DIR K DIR
"RTN","RCTCSP1",108,0)
 .Q
"RTN","RCTCSP1",109,0)
CSRPRTR ; compile/print job - either foreground or background
"RTN","RCTCSP1",110,0)
 U IO
"RTN","RCTCSP1",111,0)
 K ^TMP("RCTCSP1",$J)
"RTN","RCTCSP1",112,0)
 ;
"RTN","RCTCSP1",113,0)
 I RCSORT=1 D
"RTN","RCTCSP1",114,0)
 . D CSRPRTH1^RCTCSP1A
"RTN","RCTCSP1",115,0)
 . S (DATE,DTFRM)=$$FMADD^XLFDT(+$P(DTFRMTO,U,2)),DTTO=$P(DTFRMTO,U,3)
"RTN","RCTCSP1",116,0)
 . S RCIEN="" F  S RCIEN=$O(^PRCA(430,"TCSP",RCIEN)) Q:RCIEN=""  D
"RTN","RCTCSP1",117,0)
 .. Q:'$D(^PRCA(430,RCIEN,15))   ;cross servicing data fields
"RTN","RCTCSP1",118,0)
 ..Q:$P($G(^PRCA(430,RCIEN,15)),U)<DTFRM!($P($G(^PRCA(430,RCIEN,15)),U)>DTTO)
"RTN","RCTCSP1",119,0)
 ..K LIST,MSG,RCLIST D GETS^DIQ(430,RCIEN_",",".01;9;121,141,161;169;151;11","IE","LIST","MSG") S RCLIST=$NA(LIST(430,RCIEN_","))
"RTN","RCTCSP1",120,0)
 ..;Q:$G(@RCLIST@(141,"E"))'=""   ;Date sent to TOP
"RTN","RCTCSP1",121,0)
 ..S SSN=$E($$SSN^RCFN01(@RCLIST@(9,"I")),6,9) S SSN=$S(SSN'="":SSN,1:"     "),TERMDIG=$E(@RCLIST@(9,"E"),1)_SSN
"RTN","RCTCSP1",122,0)
 ..I EXCEL D  Q 
"RTN","RCTCSP1",123,0)
 ...S ^TMP("RCTCSP1",$J,RCIEN,@RCLIST@(.01,"E"))=@RCLIST@(.01,"E")_U_$E(@RCLIST@(9,"E"),1,19)_U_TERMDIG_U_$J(@RCLIST@(169,"E"),8,2)_U_$$FMTE^XLFDT(@RCLIST@(151,"I"),"2Z")
"RTN","RCTCSP1",124,0)
 ...S ^TMP("RCTCSP1",$J,RCIEN,@RCLIST@(.01,"E"))=^TMP("RCTCSP1",$J,RCIEN,@RCLIST@(.01,"E"))_U_$J(@RCLIST@(11,"E"),8,2)
"RTN","RCTCSP1",125,0)
 ...Q
"RTN","RCTCSP1",126,0)
 ..S ^TMP("RCTCSP1",$J,RCIEN,@RCLIST@(.01,"E"))=@RCLIST@(.01,"E")_U_$E(@RCLIST@(9,"E"),1,19)_U_SSN_U_$J(@RCLIST@(169,"E"),8,2)_U_$$FMTE^XLFDT(@RCLIST@(151,"I"),"2Z")
"RTN","RCTCSP1",127,0)
 ..S ^TMP("RCTCSP1",$J,RCIEN,@RCLIST@(.01,"E"))=^TMP("RCTCSP1",$J,RCIEN,@RCLIST@(.01,"E"))_U_$J(@RCLIST@(11,"E"),8,2)
"RTN","RCTCSP1",128,0)
 .;
"RTN","RCTCSP1",129,0)
 .; print report for sort 1
"RTN","RCTCSP1",130,0)
 .S (NCIEN,ITEM)="" F  S NCIEN=$O(^TMP("RCTCSP1",$J,NCIEN)) Q:NCIEN=""!$D(DIRUT)  F  S ITEM=$O(^TMP("RCTCSP1",$J,NCIEN,ITEM)) Q:ITEM=""!$D(DIRUT)  D  Q:$D(DIRUT)
"RTN","RCTCSP1",131,0)
 ..I EXCEL W !,$P(^TMP("RCTCSP1",$J,NCIEN,ITEM),U)_U_$P(^TMP("RCTCSP1",$J,NCIEN,ITEM),U,2)_U_$P(^TMP("RCTCSP1",$J,NCIEN,ITEM),U,3)
"RTN","RCTCSP1",132,0)
 ..I EXCEL W U_$P(^TMP("RCTCSP1",$J,NCIEN,ITEM),U,4)_U_$P(^TMP("RCTCSP1",$J,NCIEN,ITEM),U,5)_U_$P(^TMP("RCTCSP1",$J,NCIEN,ITEM),U,6)
"RTN","RCTCSP1",133,0)
 ..I EXCEL Q
"RTN","RCTCSP1",134,0)
 ..; non-Excel output
"RTN","RCTCSP1",135,0)
 ..W !,$P(^TMP("RCTCSP1",$J,NCIEN,ITEM),U),?14,$P(^TMP("RCTCSP1",$J,NCIEN,ITEM),U,2),?35,$P(^TMP("RCTCSP1",$J,NCIEN,ITEM),U,3),?43
"RTN","RCTCSP1",136,0)
 ..W $P(^TMP("RCTCSP1",$J,NCIEN,ITEM),U,4),?58,$P(^TMP("RCTCSP1",$J,NCIEN,ITEM),U,5),?68,$P(^TMP("RCTCSP1",$J,NCIEN,ITEM),U,6)
"RTN","RCTCSP1",137,0)
 ..; page break check
"RTN","RCTCSP1",138,0)
 ..I ($Y+3)>IOSL D
"RTN","RCTCSP1",139,0)
 ...I $E(IOST,1,2)="C-" S DIR(0)="E" K DIRUT D ^DIR K DIR Q:$D(DIRUT)
"RTN","RCTCSP1",140,0)
 ...D CSRPRTH1^RCTCSP1A
"RTN","RCTCSP1",141,0)
 ...Q
"RTN","RCTCSP1",142,0)
 ..Q
"RTN","RCTCSP1",143,0)
 .Q
"RTN","RCTCSP1",144,0)
 ;
"RTN","RCTCSP1",145,0)
 I RCSORT=2 D
"RTN","RCTCSP1",146,0)
 . D CSRPRTH2^RCTCSP1A
"RTN","RCTCSP1",147,0)
 . S (DATE,DTFRM)=$$FMADD^XLFDT(+$P(DTFRMTO,U,2),-1),DTTO=$P(DTFRMTO,U,3)
"RTN","RCTCSP1",148,0)
 . S RCIEN="" F  S RCIEN=$O(^PRCA(430,"TCSP",RCIEN)) Q:RCIEN=""  D
"RTN","RCTCSP1",149,0)
 ..Q:'$D(^PRCA(430,RCIEN,15))   ;cross servicing data fields
"RTN","RCTCSP1",150,0)
 ..Q:$P($G(^PRCA(430,RCIEN,15)),U)<DTFRM!($P($G(^PRCA(430,RCIEN,15)),U)>DTTO)
"RTN","RCTCSP1",151,0)
 ..K LIST,MSG,RCLIST D GETS^DIQ(430,RCIEN_",",".01;9;121,141,161;169;151;11","IE","LIST","MSG") S RCLIST=$NA(LIST(430,RCIEN_","))
"RTN","RCTCSP1",152,0)
 ..;Q:$G(@RCLIST@(121,"E"))'=""   ;Date sent to DMC
"RTN","RCTCSP1",153,0)
 ..;Q:$G(@RCLIST@(141,"E"))'=""   ;Date sent to TOP
"RTN","RCTCSP1",154,0)
 ..S SSN=$E($$SSN^RCFN01(@RCLIST@(9,"I")),6,9) S SSN=$S(SSN'="":SSN,1:"     "),TERMDIG=$E(@RCLIST@(9,"E"),1)_SSN
"RTN","RCTCSP1",155,0)
 ..I EXCEL D  Q
"RTN","RCTCSP1",156,0)
 ...S ^TMP("RCTCSP1",$J,@RCLIST@(9,"E"),RCIEN)=$E(@RCLIST@(9,"E"),1,19)_U_@RCLIST@(.01,"E")_U_TERMDIG_U_$J(@RCLIST@(169,"E"),8,2)_U_$$FMTE^XLFDT(@RCLIST@(151,"I"),"2Z")_U_$J(@RCLIST@(11,"E"),8,2) Q
"RTN","RCTCSP1",157,0)
 ..S ^TMP("RCTCSP1",$J,@RCLIST@(9,"E"),RCIEN)=$E(@RCLIST@(9,"E"),1,19)_U_@RCLIST@(.01,"E")_U_SSN_U_$J(@RCLIST@(169,"E"),8,2)_U_$$FMTE^XLFDT(@RCLIST@(151,"I"),"2Z")_U_$J(@RCLIST@(11,"E"),8,2)
"RTN","RCTCSP1",158,0)
 .;
"RTN","RCTCSP1",159,0)
 .; print report for sort 2
"RTN","RCTCSP1",160,0)
 .S (DBTR,NCIEN)="" F  S DBTR=$O(^TMP("RCTCSP1",$J,DBTR)) Q:DBTR=""!$D(DIRUT)  F  S NCIEN=$O(^TMP("RCTCSP1",$J,DBTR,NCIEN)) Q:NCIEN=""!$D(DIRUT)  D  Q:$D(DIRUT)
"RTN","RCTCSP1",161,0)
 ..I EXCEL W !,$P(^TMP("RCTCSP1",$J,DBTR,NCIEN),U,1,4)_U_$P(^TMP("RCTCSP1",$J,DBTR,NCIEN),U,5)_U_$P(^TMP("RCTCSP1",$J,DBTR,NCIEN),U,6)
"RTN","RCTCSP1",162,0)
 ..I EXCEL Q
"RTN","RCTCSP1",163,0)
 ..; non-Excel output
"RTN","RCTCSP1",164,0)
 ..W !,$P(^TMP("RCTCSP1",$J,DBTR,NCIEN),U),?21,$P(^TMP("RCTCSP1",$J,DBTR,NCIEN),U,2),?35,$P(^TMP("RCTCSP1",$J,DBTR,NCIEN),U,3),?43,$P(^TMP("RCTCSP1",$J,DBTR,NCIEN),U,4)
"RTN","RCTCSP1",165,0)
 ..W ?58,$P(^TMP("RCTCSP1",$J,DBTR,NCIEN),U,5),?68,$P(^TMP("RCTCSP1",$J,DBTR,NCIEN),U,6)
"RTN","RCTCSP1",166,0)
 ..; page break check
"RTN","RCTCSP1",167,0)
 ..I ($Y+3)>IOSL D
"RTN","RCTCSP1",168,0)
 ...I $E(IOST,1,2)="C-" S DIR(0)="E" K DIRUT D ^DIR K DIR Q:$D(DIRUT)
"RTN","RCTCSP1",169,0)
 ...D CSRPRTH2^RCTCSP1A
"RTN","RCTCSP1",170,0)
 ...Q
"RTN","RCTCSP1",171,0)
 ..Q
"RTN","RCTCSP1",172,0)
 .Q
"RTN","RCTCSP1",173,0)
 ;
"RTN","RCTCSP1",174,0)
 I RCSORT=3 D
"RTN","RCTCSP1",175,0)
 .D CSRPRTH3^RCTCSP1A
"RTN","RCTCSP1",176,0)
 .S (DATE,DTFRM)=$$FMADD^XLFDT(+$P(DTFRMTO,U,2),-1),DTTO=$P(DTFRMTO,U,3)
"RTN","RCTCSP1",177,0)
 .S RCIEN="" F  S RCIEN=$O(^PRCA(430,"TCSP",RCIEN)) Q:RCIEN=""  D
"RTN","RCTCSP1",178,0)
 ..Q:'$D(^PRCA(430,RCIEN,15))   ;cross servicing data fields
"RTN","RCTCSP1",179,0)
 ..Q:$P(^PRCA(430,RCIEN,15),U)<DTFRM!($P(^PRCA(430,RCIEN,15),U)>DTTO)
"RTN","RCTCSP1",180,0)
 ..K LIST,MSG,RCLIST D GETS^DIQ(430,RCIEN_",",".01;9;121,141,161;169;151;11","IE","LIST","MSG") S RCLIST=$NA(LIST(430,RCIEN_","))
"RTN","RCTCSP1",181,0)
 ..;Q:$G(@RCLIST@(121,"E"))'=""   ;Date sent to DMC
"RTN","RCTCSP1",182,0)
 ..;Q:$G(@RCLIST@(141,"E"))'=""   ;Date sent to TOP
"RTN","RCTCSP1",183,0)
 ..S SSN=$E($$SSN^RCFN01(@RCLIST@(9,"I")),6,9) S SSN=$S(SSN'="":SSN,1:"     "),TERMDIG=$E(@RCLIST@(9,"E"),1)_SSN
"RTN","RCTCSP1",184,0)
 ..I EXCEL S ^TMP("RCTCSP1",$J,@RCLIST@(151,"I"),RCIEN)=$$FMTE^XLFDT(@RCLIST@(151,"I"),"2Z")_U_$E(@RCLIST@(9,"E"),1,19)_U_@RCLIST@(.01,"E")_U_TERMDIG_U_$J(@RCLIST@(169,"E"),8,2)_U_$J(@RCLIST@(11,"E"),8,2)
"RTN","RCTCSP1",185,0)
 ..I 'EXCEL S ^TMP("RCTCSP1",$J,@RCLIST@(151,"I"),RCIEN)=$$FMTE^XLFDT(@RCLIST@(151,"I"),"2Z")_U_$E(@RCLIST@(9,"E"),1,19)_U_@RCLIST@(.01,"E")_U_SSN_U_$J(@RCLIST@(169,"E"),8,2)_U_$J(@RCLIST@(11,"E"),8,2)
"RTN","RCTCSP1",186,0)
 .;
"RTN","RCTCSP1",187,0)
 .; print report for sort 3
"RTN","RCTCSP1",188,0)
 .S (SDT,NCIEN)="" F  S SDT=$O(^TMP("RCTCSP1",$J,SDT)) Q:SDT=""!$D(DIRUT)  F  S NCIEN=$O(^TMP("RCTCSP1",$J,SDT,NCIEN)) Q:NCIEN=""!$D(DIRUT)  D  Q:$D(DIRUT)
"RTN","RCTCSP1",189,0)
 ..I EXCEL W !,$P(^TMP("RCTCSP1",$J,SDT,NCIEN),U)_U_$P(^TMP("RCTCSP1",$J,SDT,NCIEN),U,2)_U_$P(^TMP("RCTCSP1",$J,SDT,NCIEN),U,3)_U_$P(^TMP("RCTCSP1",$J,SDT,NCIEN),U,4)
"RTN","RCTCSP1",190,0)
 ..I EXCEL W U_$P(^TMP("RCTCSP1",$J,SDT,NCIEN),U,5)_U_$P(^TMP("RCTCSP1",$J,SDT,NCIEN),U,6)
"RTN","RCTCSP1",191,0)
 ..I EXCEL Q
"RTN","RCTCSP1",192,0)
 ..; non-Excel output
"RTN","RCTCSP1",193,0)
 ..W !,$P(^TMP("RCTCSP1",$J,SDT,NCIEN),U),?12,$P(^TMP("RCTCSP1",$J,SDT,NCIEN),U,2),?34,$P(^TMP("RCTCSP1",$J,SDT,NCIEN),U,3),?49
"RTN","RCTCSP1",194,0)
 ..W $P(^TMP("RCTCSP1",$J,SDT,NCIEN),U,4),?58,$P(^TMP("RCTCSP1",$J,SDT,NCIEN),U,5),?68,$P(^TMP("RCTCSP1",$J,SDT,NCIEN),U,6)
"RTN","RCTCSP1",195,0)
 ..; page break check
"RTN","RCTCSP1",196,0)
 ..I ($Y+3)>IOSL D
"RTN","RCTCSP1",197,0)
 ...I $E(IOST,1,2)="C-" S DIR(0)="E" K DIRUT D ^DIR K DIR Q:$D(DIRUT)
"RTN","RCTCSP1",198,0)
 ...D CSRPRTH3^RCTCSP1A
"RTN","RCTCSP1",199,0)
 ...Q
"RTN","RCTCSP1",200,0)
 ..Q
"RTN","RCTCSP1",201,0)
 .Q
"RTN","RCTCSP1",202,0)
 ;
"RTN","RCTCSP1",203,0)
 ;end of report
"RTN","RCTCSP1",204,0)
 I $E(IOST,1,2)="C-",'$D(DIRUT) R !!,"END OF REPORT...PRESS RETURN TO CONTINUE",X:DTIME W @IOF
"RTN","RCTCSP1",205,0)
 ;
"RTN","RCTCSP1",206,0)
 K ^TMP("RCTCSP1",$J)          ; kill scratch
"RTN","RCTCSP1",207,0)
 D ^%ZISC                      ; close device
"RTN","RCTCSP1",208,0)
 I $D(ZTQUEUED) S ZTREQ="@"    ; purge the task
"RTN","RCTCSP1",209,0)
 Q
"RTN","RCTCSP1",210,0)
 ;
"RTN","RCTCSP1",211,0)
REC5B ;Create record 5B for Treasury
"RTN","RCTCSP1",212,0)
 ;  trnnum     transaction number file #433 pass in
"RTN","RCTCSP1",213,0)
 ;  trntyp     transaction type pointer to 430.3
"RTN","RCTCSP1",214,0)
 ;  trntypa    aia transaction type  (aio: dmc agency internal offset, abal: decrease adjustment) 
"RTN","RCTCSP1",215,0)
 N REC,KNUM,DEBTNR,DEBTORNB,TAMOUNT,TAMTPBAL,TAMTIBAL,TAMTABAL,TAMTFBAL,TAMTCBAL,AMTRFRRD,TRNTYP,TRNTYPA,TRANSNB
"RTN","RCTCSP1",216,0)
 N AMTPBAL,AMTIBAL,AMTABAL,AMTFBAL,AMTCBAL,TRN3,TRNNUME
"RTN","RCTCSP1",217,0)
 S TRNTYPA="AIO"
"RTN","RCTCSP1",218,0)
 S REC="C5B"_ACTION_"3636001200"_"DM1D "_"L"
"RTN","RCTCSP1",219,0)
 S KNUM=$P($P(B0,U,1),"-",2)
"RTN","RCTCSP1",220,0)
 S DEBTNR=$E(SITE,1,3)_$$RJZF(KNUM,7)_$TR($J(BILL,20)," ",0),REC=REC_DEBTNR
"RTN","RCTCSP1",221,0)
 S DEBTORNB=$E(SITE,1,3)_$TR($J(DEBTOR,12)," ",0)
"RTN","RCTCSP1",222,0)
 S REC=REC_DEBTORNB
"RTN","RCTCSP1",223,0)
 S TRNTYP=$P($G(^PRCA(433,TRNNUM,1)),U,2) I ",35,73,74,"[TRNTYP S TRNTYPA="ABAL"
"RTN","RCTCSP1",224,0)
 S REC=REC_$$LJSF(TRNTYPA,9)
"RTN","RCTCSP1",225,0)
 S TRNNUME=$$RJZF(TRNNUM,10)
"RTN","RCTCSP1",226,0)
 S TRNNUME=$E(TRNNUME,5,10) ;max is 999999
"RTN","RCTCSP1",227,0)
 I TRNNUME="000000" S TRNNUME="000001" ;min is 1
"RTN","RCTCSP1",228,0)
 S REC=REC_$$RJZF(TRNNUME,10)
"RTN","RCTCSP1",229,0)
 S REC=REC_$$DATE8(DT)
"RTN","RCTCSP1",230,0)
 S TRANSNB=$E(SITE,1,3)_$TR($J(TRNNUM,12)," ",0)
"RTN","RCTCSP1",231,0)
 S REC=REC_TRANSNB
"RTN","RCTCSP1",232,0)
 S REC=REC_$$BLANK(9)
"RTN","RCTCSP1",233,0)
 S TRN3=$G(^PRCA(433,TRNNUM,3))
"RTN","RCTCSP1",234,0)
 S TAMTPBAL=$P(TRN3,U,1) ;transaction principle balance
"RTN","RCTCSP1",235,0)
 S TAMTIBAL=$P(TRN3,U,2) ;transaction interest balance
"RTN","RCTCSP1",236,0)
 S TAMTABAL=$P(TRN3,U,3) ;transaction administrative balance
"RTN","RCTCSP1",237,0)
 S TAMTFBAL=$P(TRN3,U,4) ;transaction marshal fee
"RTN","RCTCSP1",238,0)
 S TAMTCBAL=$P(TRN3,U,5) ;transaction court cost
"RTN","RCTCSP1",239,0)
 I (TAMTPBAL+TAMTIBAL+TAMTABAL+TAMTFBAL+TAMTCBAL)=0 S TAMTPBAL=TRNAMT
"RTN","RCTCSP1",240,0)
 S TAMOUNT=$$AMOUNT(TAMTPBAL,TRNTYP)
"RTN","RCTCSP1",241,0)
 S TAMOUNT=TAMOUNT_$$AMOUNT(TAMTIBAL,TRNTYP)
"RTN","RCTCSP1",242,0)
 S TAMOUNT=TAMOUNT_$$AMOUNT(TAMTABAL,TRNTYP)
"RTN","RCTCSP1",243,0)
 S TAMOUNT=TAMOUNT_$$AMOUNT(TAMTFBAL+TAMTCBAL,TRNTYP)
"RTN","RCTCSP1",244,0)
 S REC=REC_TAMOUNT
"RTN","RCTCSP1",245,0)
 S REC=REC_$$AMOUNT(TRNAMT,TRNTYP)
"RTN","RCTCSP1",246,0)
 S REC=REC_$$BLANK(450-$L(REC))
"RTN","RCTCSP1",247,0)
 S AMTPBAL=$P(B7,U,1) ;principle balance
"RTN","RCTCSP1",248,0)
 S AMTIBAL=$P(B7,U,2) ;interest balance
"RTN","RCTCSP1",249,0)
 S AMTABAL=$P(B7,U,3) ;administrative balance
"RTN","RCTCSP1",250,0)
 S AMTFBAL=$P(B7,U,4) ;marshal fee
"RTN","RCTCSP1",251,0)
 S AMTCBAL=$P(B7,U,5) ;court cost
"RTN","RCTCSP1",252,0)
 S AMTRFRRD=AMTPBAL+AMTIBAL+AMTABAL+AMTFBAL+AMTCBAL
"RTN","RCTCSP1",253,0)
 I ACTION="U" S $P(^PRCA(430,BILL,16),U,10)=AMTRFRRD
"RTN","RCTCSP1",254,0)
 S ^XTMP("RCTCSPD",$J,BILL,ACTION,"5B",TRNNUM)=REC
"RTN","RCTCSP1",255,0)
 S ^XTMP("RCTCSPD",$J,"BILL",ACTION,BILL)=$$TAXID(DEBTOR)_"^"_$S(TRNTYP=73!(TRNTYP=74):"",1:"-")_+$E(REC,174,184)_"."_$E(REC,185,186)
"RTN","RCTCSP1",256,0)
 Q
"RTN","RCTCSP1",257,0)
 ;
"RTN","RCTCSP1",258,0)
DATE8(X) ;changes fileman date into 8 digit date yyyymmdd
"RTN","RCTCSP1",259,0)
 I +X S X=X+17000000
"RTN","RCTCSP1",260,0)
 S X=$E(X,1,8)
"RTN","RCTCSP1",261,0)
 Q X
"RTN","RCTCSP1",262,0)
 ;
"RTN","RCTCSP1",263,0)
AMOUNT(X,TT) ;changes amount to zero filled, right justified
"RTN","RCTCSP1",264,0)
 ;Zeroes are positive
"RTN","RCTCSP1",265,0)
 ;Increase adjustment are positive (TT=73,74)
"RTN","RCTCSP1",266,0)
 ;All other tranactions are negative (reduce bill balance)
"RTN","RCTCSP1",267,0)
 S X=$TR($J(X,0,2),".")
"RTN","RCTCSP1",268,0)
 S X=$E($S(+X=0:0,TT=73!(TT=74):0,1:"-")_"00000000000",1,14-$L(X))_X
"RTN","RCTCSP1",269,0)
 Q X
"RTN","RCTCSP1",270,0)
 ;
"RTN","RCTCSP1",271,0)
BLANK(X) ;returns 'x' blank spaces
"RTN","RCTCSP1",272,0)
 N BLANK
"RTN","RCTCSP1",273,0)
 S BLANK="",$P(BLANK," ",X+1)=""
"RTN","RCTCSP1",274,0)
 Q BLANK
"RTN","RCTCSP1",275,0)
 ;
"RTN","RCTCSP1",276,0)
RJZF(X,Y) ;right justify zero fill width Y
"RTN","RCTCSP1",277,0)
 S X=$E("000000000000",1,Y-$L(X))_X
"RTN","RCTCSP1",278,0)
 Q X
"RTN","RCTCSP1",279,0)
 ;
"RTN","RCTCSP1",280,0)
LJSF(X,Y) ;left justified space filled
"RTN","RCTCSP1",281,0)
 S X=$E(X,1,Y)
"RTN","RCTCSP1",282,0)
 S X=X_$$BLANK(Y-$L(X))
"RTN","RCTCSP1",283,0)
 Q X
"RTN","RCTCSP1",284,0)
 ;
"RTN","RCTCSP1",285,0)
TAXID(DEBTOR) ;computes TAXID to place on documents
"RTN","RCTCSP1",286,0)
 N TAXID,DIC,DA,DR,DIQ
"RTN","RCTCSP1",287,0)
 S TAXID=$$SSN^RCFN01(DEBTOR)
"RTN","RCTCSP1",288,0)
 S TAXID=$$LJSF(TAXID,9)
"RTN","RCTCSP1",289,0)
 Q TAXID
"RTN","RCTCSP1",290,0)
 ;
"RTN","RCTCSP1",291,0)
ADDR(RCDFN) ; returns patient file address
"RTN","RCTCSP1",292,0)
 N DFN,ADDRCS,STATEIEN,STATEAB,VAPA
"RTN","RCTCSP1",293,0)
 S DFN=RCDFN
"RTN","RCTCSP1",294,0)
 D ADD^VADPT
"RTN","RCTCSP1",295,0)
 S STATEIEN=+VAPA(5),STATEAB=$$GET1^DIQ(5,STATEIEN,1)
"RTN","RCTCSP1",296,0)
 S ADDRCS=VAPA(1)_U_VAPA(2)_U_VAPA(4)_U_STATEAB_U_VAPA(6)_U_VAPA(8)_U_+VAPA(25)
"RTN","RCTCSP1",297,0)
 I $L(DEBTOR1)>0 I $P(DEBTOR1,U,1,5)'?1"^"."^" D
"RTN","RCTCSP1",298,0)
 .N ADDR340
"RTN","RCTCSP1",299,0)
 .S ADDR340=$P($$DADD^RCAMADD(DEBTOR),U,1,8)
"RTN","RCTCSP1",300,0)
 .I $P(ADDRCS,U,7)>1 S $P(ADDR340,U,6)="     "    ;PRCA*4.5*331
"RTN","RCTCSP1",301,0)
 .S ADDR340=$P(ADDR340,U,1,2)_"^"_$P(ADDR340,U,4,7)_U_$S($P(ADDRCS,U,7)'="":$P(ADDRCS,U,7),1:1)    ;PRCA*4.5*331
"RTN","RCTCSP1",302,0)
 .I $P(ADDR340,U,7)="" S $P(ADDR340,U,7)=$P(ADDRCS,U,7)     ;PRCA*4.5*331
"RTN","RCTCSP1",303,0)
 .I $P(ADDR340,U,7)'=1 S $P(ADDR340,U,4)="  "     ;PRCA*4.5*331
"RTN","RCTCSP1",304,0)
 .S ADDRCS=ADDR340
"RTN","RCTCSP1",305,0)
 Q ADDRCS
"RTN","RCTCSP1",306,0)
 ;
"RTN","RCTCSP1",307,0)
DEM(RCDFN) ; returns patient file gender and dob
"RTN","RCTCSP1",308,0)
 N DFN,VADM
"RTN","RCTCSP1",309,0)
 S DFN=RCDFN
"RTN","RCTCSP1",310,0)
 D DEM^VADPT
"RTN","RCTCSP1",311,0)
 ; return string   sex:m/f ^ dob: yyyymmdd ^ ssn ^ deceased
"RTN","RCTCSP1",312,0)
 Q $P(VADM(5),U,1)_U_$P(VADM(3),U,1)_U_$P(VADM(2),U,1)_U_VADM(6)
"RTN","RCTCSP1",313,0)
 ;
"RTN","RCTCSP1A")
0^2^B44957628^B44615567
"RTN","RCTCSP1A",1,0)
RCTCSP1A ;ALBANY/PAW-CROSS-SERVICING REPORT ;03/15/14 3:34 PM
"RTN","RCTCSP1A",2,0)
 ;;4.5;Accounts Receivable;**315,341**;Mar 20, 1995;Build 2
"RTN","RCTCSP1A",3,0)
 ;;Per VA Directive 6402, this routine should not be modified.
"RTN","RCTCSP1A",4,0)
 ;
"RTN","RCTCSP1A",5,0)
 Q
"RTN","RCTCSP1A",6,0)
 ;
"RTN","RCTCSP1A",7,0)
CSRPRTH1 ;header for cross-servicing print report 1
"RTN","RCTCSP1A",8,0)
 W @IOF
"RTN","RCTCSP1A",9,0)
 S PAGE=PAGE+1,EXCEL=$G(EXCEL)
"RTN","RCTCSP1A",10,0)
 I 'EXCEL D  Q
"RTN","RCTCSP1A",11,0)
 .W !,"PAGE "_PAGE,?16,"BILLS AT CROSS-SERVICING (SORTED BY BILL NO.)",?68,$$FMTE^XLFDT(DT,"2Z")
"RTN","RCTCSP1A",12,0)
 .W !,DASH
"RTN","RCTCSP1A",13,0)
 .W !,"BILL NO.",?14,"DEBTOR",?35,"Pt ID",?43,"ORIG AMT",?55,"CS REF DATE",?67," CURR AMT"  ; limited SSN to 4 char - (as per PRCA*4.5*315)
"RTN","RCTCSP1A",14,0)
 .W !,"---- ---",?14,"------",?35,"-----",?43,"---- ---",?55,"-- --- ----",?67," ---- ---"
"RTN","RCTCSP1A",15,0)
 ;EXCEL FORMAT
"RTN","RCTCSP1A",16,0)
 W !,"PAGE "_PAGE_U_U_"BILLS AT CROSS-SERVICING (SORTED BY BILL NO.)"_U_U_$$FMTE^XLFDT(DT,"2Z")
"RTN","RCTCSP1A",17,0)
 W !,"BILL NO."_U_"DEBTOR"_U_"Pt ID"_U_"ORIG AMT"_U_"CS REF DATE"_U_" CURR AMT"  ; limited SSN to 4 char - (as per PRCA*4.5*315)
"RTN","RCTCSP1A",18,0)
 Q
"RTN","RCTCSP1A",19,0)
 ;
"RTN","RCTCSP1A",20,0)
CSRPRTH2 ;header for cross-servicing print report 2
"RTN","RCTCSP1A",21,0)
 W @IOF
"RTN","RCTCSP1A",22,0)
 S PAGE=PAGE+1,EXCEL=$G(EXCEL)
"RTN","RCTCSP1A",23,0)
 I 'EXCEL D  Q
"RTN","RCTCSP1A",24,0)
 .W !,"PAGE "_PAGE,?16,"BILLS AT CROSS-SERVICING (SORTED BY DEBTOR)",?68,$$FMTE^XLFDT(DT,"2Z")
"RTN","RCTCSP1A",25,0)
 .W !,DASH
"RTN","RCTCSP1A",26,0)
 .W !,"DEBTOR",?21,"BILL NO.",?35,"Pt ID",?43,"ORIG AMT",?55,"CS REF DATE",?67," CURR AMT"  ;limited SSN to 4 char - (as per PRCA*4.5*315)
"RTN","RCTCSP1A",27,0)
 .W !,"------",?21,"---- ---",?35,"-----",?43,"---- ---",?55,"-- --- ----",?67," ---- ---"
"RTN","RCTCSP1A",28,0)
 ;EXCEL FORMAT
"RTN","RCTCSP1A",29,0)
 W !,"PAGE "_PAGE_U_U_"BILLS AT CROSS-SERVICING (SORTED BY DEBTOR)"_U_U_$$FMTE^XLFDT(DT,"2Z")
"RTN","RCTCSP1A",30,0)
 W !,"DEBTOR"_U_"BILL NO."_U_"Pt ID"_U_"ORIG AMT"_U_"CS REF DATE"_U_" CURR AMT"  ; limited SSN to 4 char - (as per PRCA*4.5*315)
"RTN","RCTCSP1A",31,0)
 Q
"RTN","RCTCSP1A",32,0)
 ;
"RTN","RCTCSP1A",33,0)
CSRPRTH3 ;header for cross-servicing print report 3
"RTN","RCTCSP1A",34,0)
 W @IOF
"RTN","RCTCSP1A",35,0)
 S PAGE=PAGE+1,EXCEL=$G(EXCEL)
"RTN","RCTCSP1A",36,0)
 I 'EXCEL D  Q
"RTN","RCTCSP1A",37,0)
 .W !,"PAGE "_PAGE,?11,"BILLS AT CROSS-SERVICING (SORTED BY CS REFERRED DATE)",?68,$$FMTE^XLFDT(DT,"2Z")
"RTN","RCTCSP1A",38,0)
 .W !,DASH
"RTN","RCTCSP1A",39,0)
 .W !,"CS REF DT",?12,"DEBTOR",?34,"BILL NO.",?49,"Pt ID",?58,"ORIG AMT",?67," CURR AMT"  ;limited SSN to 4 char - (as per PRCA*4.5*315)
"RTN","RCTCSP1A",40,0)
 .W !,"-- --- ----",?12,"------",?34,"---- ---",?49,"-----",?58,"---- ---",?67," ---- ---"
"RTN","RCTCSP1A",41,0)
 ;EXCEL FORMAT
"RTN","RCTCSP1A",42,0)
 W !,"PAGE "_PAGE_U_U_"BILLS AT CROSS-SERVICING (SORTED BY CS REFERRED DATE)"_U_U_$$FMTE^XLFDT(DT,"2Z")
"RTN","RCTCSP1A",43,0)
 W !,"CS REF DATE"_U_"DEBTOR"_U_"BILL NO."_U_"Pt ID"_U_"ORIG AMT"_U_" CURR AMT"  ; limited SSN to 4 char - (as per PRCA*4.5*315)
"RTN","RCTCSP1A",44,0)
 Q
"RTN","RCTCSP1A",45,0)
 ;
"RTN","RCTCSP1A",46,0)
COUNTRY(Z) ;
"RTN","RCTCSP1A",47,0)
 N PRCACC
"RTN","RCTCSP1A",48,0)
 ;get treasury country code - moved out of RCTCSP1, due to SACC size limitation error PRCA*4.5*315
"RTN","RCTCSP1A",49,0)
 I Z<3 S PRCACC="US" G COUNTRYQ
"RTN","RCTCSP1A",50,0)
 S PRCACC=$S(Z=4:"AF",Z=5:"AL",Z=7:"DZ",Z=8:"AD",Z=9:"AO",Z=180:"AI",Z=10:"AG",Z=12:"AR",Z=18:"AM",Z=151:"AW",Z=13:"AU",Z=14:"AT",Z=11:"AZ",Z=15:"BS",Z=16:"BH",Z=17:"BD",1:"  ") G:PRCACC'="  " COUNTRYQ
"RTN","RCTCSP1A",51,0)
 S PRCACC=$S(Z=19:"BB",Z=36:"BY",Z=20:"BE",Z=28:"BZ",Z=61:"BJ",Z=21:"BM",Z=22:"BT",Z=23:"BO",Z=24:"BA",Z=25:"BW",Z=27:"BR",Z=29:"IO",Z=32:"BN",Z=33:"BG",Z=223:"Faso",Z=35:"BI",1:"  ") G:PRCACC'="  " COUNTRYQ
"RTN","RCTCSP1A",52,0)
 S PRCACC=$S(Z=37:"KH",Z=38:"CM",Z=39:"CA",Z=40:"CV",Z=41:"KY",Z=42:"CF",Z=44:"TD",Z=45:"CL",Z=46:"CN",Z=50:"CO",Z=51:"KM",Z=53:"CG",Z=54:"CD",Z=55:"CK",Z=56:"CR",Z=109:"CI",1:"  ") G:PRCACC'="  " COUNTRYQ
"RTN","RCTCSP1A",53,0)
 S PRCACC=$S(Z=57:"HR",Z=58:"CU",Z=59:"CY",Z=60:"CZ",Z=115:"KP",Z=62:"DK",Z=80:"DJ",Z=63:"DM",Z=64:"DO",Z=172:"TP",Z=65:"EC",Z=220:"EG",Z=66:"SV",Z=67:"GQ",Z=69:"ER",Z=70:"EE",1:"  ") G:PRCACC'="  " COUNTRYQ
"RTN","RCTCSP1A",54,0)
 S PRCACC=$S(Z=68:"ET",Z=72:"FK",Z=71:"FO",Z=74:"FJ",Z=75:"FI",Z=76:"FR",Z=77:"GF",Z=78:"PF",Z=79:"TF",Z=81:"GA",Z=83:"GM",Z=82:"GE",Z=84:"DE",Z=85:"GH",Z=86:"GI",Z=221:"GB",1:"  ") G:PRCACC'="  " COUNTRYQ
"RTN","RCTCSP1A",55,0)
 S PRCACC=$S(Z=88:"GR",Z=89:"GL",Z=90:"GD",Z=91:"GP",Z=92:"GT",Z=93:"GN",Z=171:"GW",Z=94:"GY",Z=95:"HT",Z=98:"HN",Z=99:"HK",Z=100:"HU",Z=101:"IS",Z=102:"IN",Z=103:"ID",1:"  ") G:PRCACC'="  " COUNTRYQ
"RTN","RCTCSP1A",56,0)
 S PRCACC=$S(Z=105:"IQ",Z=106:"IE",Z=107:"IL",Z=108:"IT",Z=110:"JM",Z=111:"JP",Z=113:"JO",Z=112:"KZ",Z=114:"KE",Z=87:"KI",Z=116:"KR",Z=117:"KW",Z=118:"KG",Z=119:"LA",Z=122:"LV",1:"  ") G:PRCACC'="  " COUNTRYQ
"RTN","RCTCSP1A",57,0)
 S PRCACC=$S(Z=120:"LB",Z=121:"LS",Z=123:"LR",Z=124:"LY",Z=125:"LI",Z=126:"LT",Z=127:"LU",Z=128:"MO",Z=129:"MG",Z=130:"MW",Z=131:"MY",Z=132:"MV",Z=133:"ML",Z=134:"MT",1:"  ") G:PRCACC'="  " COUNTRYQ
"RTN","RCTCSP1A",58,0)
 S PRCACC=$S(Z=999:"MH",Z=135:"MQ",Z=136:"MR",Z=137:"MU",Z=52:"YT",Z=138:"MX",Z=161:"FM",Z=141:"MD",Z=139:"MC",Z=140:"MN",Z=142:"MS",Z=143:"MA",Z=144:"MZ",Z=34:"MM",Z=146:"NA",1:"  ") G:PRCACC'="  " COUNTRYQ
"RTN","RCTCSP1A",59,0)
 S PRCACC=$S(Z=147:"NR",Z=148:"NP",Z=149:"NL",Z=150:"AN",Z=152:"NC",Z=154:"NZ",Z=155:"NI",Z=156:"NE",Z=157:"NG",Z=158:"NU",Z=159:"NF",Z=160:"NO",Z=145:"OM",Z=162:"PK",1:"  ") G:PRCACC'="  " COUNTRYQ
"RTN","RCTCSP1A",60,0)
 S PRCACC=$S(Z=999:"PW",Z=163:"PA",Z=164:"PG",Z=165:"PY",Z=166:"PE",Z=167:"PH",Z=168:"PN",Z=169:"PL",Z=170:"PT",Z=173:"QA",Z=999:"RE",Z=175:"RO",Z=176:"RU",Z=177:"RW",Z=178:"SH",1:"  ") G:PRCACC'="  " COUNTRYQ
"RTN","RCTCSP1A",61,0)
 S PRCACC=$S(Z=179:"KN",Z=181:"LC",Z=183:"VC",Z=999:"WS",Z=184:"SM",Z=185:"ST",Z=186:"SA",Z=187:"SN",Z=188:"SC",Z=189:"SL",Z=190:"SG",Z=191:"SK",Z=193:"SI",Z=30:"SB",1:"  ") G:PRCACC'="  " COUNTRYQ
"RTN","RCTCSP1A",62,0)
 S PRCACC=$S(Z=194:"SO",Z=195:"ZA",Z=197:"ES",Z=43:"LK",Z=199:"SD",Z=200:"SR",Z=201:"SZ",Z=202:"SE",Z=203:"CH",Z=204:"SY",Z=205:"TJ",Z=222:"TZ",Z=182:"PM",Z=206:"TH",Z=219:"MK",1:"  ") G:PRCACC'="  " COUNTRYQ
"RTN","RCTCSP1A",63,0)
 S PRCACC=$S(Z=207:"TG",Z=208:"TK",Z=209:"TO",Z=210:"TT",Z=212:"TN",Z=213:"TR",Z=214:"TM",Z=215:"TC",Z=216:"TV",Z=217:"UG",Z=218:"UA",Z=211:"AE",Z=1:"US",Z=224:"UY",1:"  ") G:PRCACC'="  " COUNTRYQ
"RTN","RCTCSP1A",64,0)
 S PRCACC=$S(Z=104:"IR",Z=225:"UZ",Z=153:"VU",Z=97:"VA",Z=226:"VE",Z=183:"VN",Z=31:"VG",Z=227:"WF",Z=228:"YE",Z=229:"YU",Z=230:"ZM",Z=196:"ZW",1:"  ") G:PRCACC'="  " COUNTRYQ
"RTN","RCTCSP1A",65,0)
COUNTRYQ ;
"RTN","RCTCSP1A",66,0)
 Q PRCACC
"RTN","RCTCSP1A",67,0)
 ;
"RTN","RCTCSP1A",68,0)
HEADER ;
"RTN","RCTCSP1A",69,0)
 ;increment batch sequence number, build new header
"RTN","RCTCSP1A",70,0)
 N RCMSG
"RTN","RCTCSP1A",71,0)
 S SEQ=SEQ+1
"RTN","RCTCSP1A",72,0)
 S CNTLID=$$JD()_$$RJZF^RCTCSP1(SEQ,4)
"RTN","RCTCSP1A",73,0)
 K ^XTMP("RCTCSPD",$J,ACTION,"BUILD",SEQ)
"RTN","RCTCSP1A",74,0)
 ;header is record type H
"RTN","RCTCSP1A",75,0)
 S RCMSG="H"_CNTLID_$$BLANK^RCTCSP1(14)_"3636001200"
"RTN","RCTCSP1A",76,0)
 S RCMSG=RCMSG_$$BLANK^RCTCSP1(450-$L(RCMSG))
"RTN","RCTCSP1A",77,0)
 S REC=REC+1
"RTN","RCTCSP1A",78,0)
 S ^XTMP("RCTCSPD",$J,SEQ,"BUILD",REC)=$E(RCMSG,1,225)_$C(94)
"RTN","RCTCSP1A",79,0)
 S REC=REC+1
"RTN","RCTCSP1A",80,0)
 S ^XTMP("RCTCSPD",$J,SEQ,"BUILD",REC)=$E(RCMSG,226,999)_$C(126)
"RTN","RCTCSP1A",81,0)
 Q
"RTN","RCTCSP1A",82,0)
 ;
"RTN","RCTCSP1A",83,0)
TRAILER ;
"RTN","RCTCSP1A",84,0)
 ;trailer is type Z record
"RTN","RCTCSP1A",85,0)
 N X
"RTN","RCTCSP1A",86,0)
 I REC=0 K ^XTMP("RCTCSPD",$J,SEQ,"BUILD") Q  ;delete batch if no records processed
"RTN","RCTCSP1A",87,0)
 N RCMSG
"RTN","RCTCSP1A",88,0)
 S CNTLID=$$JD()_$$RJZF^RCTCSP1(SEQ,4)
"RTN","RCTCSP1A",89,0)
 S RCMSG="Z"_$$RJZF^RCTCSP1(RECC,8)
"RTN","RCTCSP1A",90,0)
 S X=$TR($J(AMOUNT/100,0,2),".")
"RTN","RCTCSP1A",91,0)
 S X=$E("00000000000",1,14-$L(X))_X ;341/DRF Remove AMOUNT function
"RTN","RCTCSP1A",92,0)
 S RCMSG=RCMSG_X
"RTN","RCTCSP1A",93,0)
 S RCMSG=RCMSG_CNTLID_$$BLANK^RCTCSP1(14)_"3636001200"
"RTN","RCTCSP1A",94,0)
 S RCMSG=RCMSG_$$BLANK^RCTCSP1(450-$L(RCMSG))
"RTN","RCTCSP1A",95,0)
 S REC=REC+1
"RTN","RCTCSP1A",96,0)
 S ^XTMP("RCTCSPD",$J,SEQ,"BUILD",REC)=$E(RCMSG,1,225)_$C(94)
"RTN","RCTCSP1A",97,0)
 S REC=REC+1
"RTN","RCTCSP1A",98,0)
 S ^XTMP("RCTCSPD",$J,SEQ,"BUILD",REC)=$E(RCMSG,226,999)_$C(126)
"RTN","RCTCSP1A",99,0)
 S REC=0,RECC=0,AMOUNT=0
"RTN","RCTCSP1A",100,0)
 Q
"RTN","RCTCSP1A",101,0)
 ;
"RTN","RCTCSP1A",102,0)
JD() ; returns today's Julian date YDOY
"RTN","RCTCSP1A",103,0)
 N XMDDD,XMNOW,XMDT
"RTN","RCTCSP1A",104,0)
 S XMNOW=$$NOW^XLFDT
"RTN","RCTCSP1A",105,0)
 S XMDT=$E(XMNOW,1,7)
"RTN","RCTCSP1A",106,0)
 S XMDDD=$$RJ^XLFSTR($$FMDIFF^XLFDT(XMDT,$E(XMDT,1,3)_"0101",1)+1,3,"0")
"RTN","RCTCSP1A",107,0)
 Q $E(DT,3)_XMDDD
"RTN","RCTCSP1A",108,0)
 ;
"VER")
8.0^22.2
"BLD",10470,6)
^297
**END**
**END**

