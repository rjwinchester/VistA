Released PRCA*4.5*347 SEQ #306
Extracted from mail message
**KIDS**:PRCA*4.5*347^

**INSTALL NAME**
PRCA*4.5*347
"BLD",11399,0)
PRCA*4.5*347^ACCOUNTS RECEIVABLE^0^3190515^y
"BLD",11399,4,0)
^9.64PA^^
"BLD",11399,6.3)
47
"BLD",11399,"KRN",0)
^9.67PA^1.61^23
"BLD",11399,"KRN",.4,0)
.4
"BLD",11399,"KRN",.401,0)
.401
"BLD",11399,"KRN",.402,0)
.402
"BLD",11399,"KRN",.403,0)
.403
"BLD",11399,"KRN",.5,0)
.5
"BLD",11399,"KRN",.84,0)
.84
"BLD",11399,"KRN",1.6,0)
1.6
"BLD",11399,"KRN",1.61,0)
1.61
"BLD",11399,"KRN",1.62,0)
1.62
"BLD",11399,"KRN",3.6,0)
3.6
"BLD",11399,"KRN",3.8,0)
3.8
"BLD",11399,"KRN",9.2,0)
9.2
"BLD",11399,"KRN",9.8,0)
9.8
"BLD",11399,"KRN",9.8,"NM",0)
^9.68A^11^10
"BLD",11399,"KRN",9.8,"NM",1,0)
RCDMCUT1^^0^B47425932
"BLD",11399,"KRN",9.8,"NM",2,0)
RCDMCR4A^^0^B101685386
"BLD",11399,"KRN",9.8,"NM",3,0)
RCDMCR4B^^0^B61391663
"BLD",11399,"KRN",9.8,"NM",5,0)
RCDMCUT2^^0^B70369247
"BLD",11399,"KRN",9.8,"NM",6,0)
RCDMCR5A^^0^B35467262
"BLD",11399,"KRN",9.8,"NM",7,0)
RCDMCR5B^^0^B25961483
"BLD",11399,"KRN",9.8,"NM",8,0)
RCDMCR6A^^0^B29334553
"BLD",11399,"KRN",9.8,"NM",9,0)
RCDMCR7A^^0^B24147917
"BLD",11399,"KRN",9.8,"NM",10,0)
RCDMCR6B^^0^B27513091
"BLD",11399,"KRN",9.8,"NM",11,0)
RCDMCR7B^^0^B26651749
"BLD",11399,"KRN",9.8,"NM","B","RCDMCR4A",2)

"BLD",11399,"KRN",9.8,"NM","B","RCDMCR4B",3)

"BLD",11399,"KRN",9.8,"NM","B","RCDMCR5A",6)

"BLD",11399,"KRN",9.8,"NM","B","RCDMCR5B",7)

"BLD",11399,"KRN",9.8,"NM","B","RCDMCR6A",8)

"BLD",11399,"KRN",9.8,"NM","B","RCDMCR6B",10)

"BLD",11399,"KRN",9.8,"NM","B","RCDMCR7A",9)

"BLD",11399,"KRN",9.8,"NM","B","RCDMCR7B",11)

"BLD",11399,"KRN",9.8,"NM","B","RCDMCUT1",1)

"BLD",11399,"KRN",9.8,"NM","B","RCDMCUT2",5)

"BLD",11399,"KRN",19,0)
19
"BLD",11399,"KRN",19,"NM",0)
^9.68A^16^15
"BLD",11399,"KRN",19,"NM",1,0)
RCDMCR4 0-40 PERC SC CHNG RPT^^0
"BLD",11399,"KRN",19,"NM",2,0)
RCDMCR5 1ST PARTY IB CANC RPT^^0
"BLD",11399,"KRN",19,"NM",4,0)
PRCA RCDMC 90 DAY REPORT^^4^
"BLD",11399,"KRN",19,"NM",5,0)
PRCA RCDMC REFERRED RPT^^4^
"BLD",11399,"KRN",19,"NM",6,0)
PRCA RCDMC LESSER WITHHOLDING^^4^
"BLD",11399,"KRN",19,"NM",7,0)
PRCA RCDMC CANCEL^^4^
"BLD",11399,"KRN",19,"NM",8,0)
RCDMCR1 DEBT VALIDITY REPORT^^4^
"BLD",11399,"KRN",19,"NM",9,0)
RCDMCR2 DEBT VALIDITY MGMT RPT^^4^
"BLD",11399,"KRN",19,"NM",10,0)
RCDMCR3 RD ELIG CHANGE REPORT^^4^
"BLD",11399,"KRN",19,"NM",11,0)
RCDMCEDT ENTER/EDIT DMC DEBT ^^4^
"BLD",11399,"KRN",19,"NM",12,0)
RCDMC EDIT RD # OF DAYS PARAME^^4^
"BLD",11399,"KRN",19,"NM",13,0)
RCDMC EDIT DMC REPORT # OF DAY^^4^
"BLD",11399,"KRN",19,"NM",14,0)
PRCA RCDMC REFERRAL MENU^^0
"BLD",11399,"KRN",19,"NM",15,0)
RCDMCR6 50-100SC EXMPT RPT^^0
"BLD",11399,"KRN",19,"NM",16,0)
RCDMCR7 10-40% COPAY RPT^^0
"BLD",11399,"KRN",19,"NM","B","PRCA RCDMC 90 DAY REPORT",4)

"BLD",11399,"KRN",19,"NM","B","PRCA RCDMC CANCEL",7)

"BLD",11399,"KRN",19,"NM","B","PRCA RCDMC LESSER WITHHOLDING",6)

"BLD",11399,"KRN",19,"NM","B","PRCA RCDMC REFERRAL MENU",14)

"BLD",11399,"KRN",19,"NM","B","PRCA RCDMC REFERRED RPT",5)

"BLD",11399,"KRN",19,"NM","B","RCDMC EDIT DMC REPORT # OF DAY",13)

"BLD",11399,"KRN",19,"NM","B","RCDMC EDIT RD # OF DAYS PARAME",12)

"BLD",11399,"KRN",19,"NM","B","RCDMCEDT ENTER/EDIT DMC DEBT ",11)

"BLD",11399,"KRN",19,"NM","B","RCDMCR1 DEBT VALIDITY REPORT",8)

"BLD",11399,"KRN",19,"NM","B","RCDMCR2 DEBT VALIDITY MGMT RPT",9)

"BLD",11399,"KRN",19,"NM","B","RCDMCR3 RD ELIG CHANGE REPORT",10)

"BLD",11399,"KRN",19,"NM","B","RCDMCR4 0-40 PERC SC CHNG RPT",1)

"BLD",11399,"KRN",19,"NM","B","RCDMCR5 1ST PARTY IB CANC RPT",2)

"BLD",11399,"KRN",19,"NM","B","RCDMCR6 50-100SC EXMPT RPT",15)

"BLD",11399,"KRN",19,"NM","B","RCDMCR7 10-40% COPAY RPT",16)

"BLD",11399,"KRN",19.1,0)
19.1
"BLD",11399,"KRN",101,0)
101
"BLD",11399,"KRN",409.61,0)
409.61
"BLD",11399,"KRN",771,0)
771
"BLD",11399,"KRN",779.2,0)
779.2
"BLD",11399,"KRN",870,0)
870
"BLD",11399,"KRN",8989.51,0)
8989.51
"BLD",11399,"KRN",8989.52,0)
8989.52
"BLD",11399,"KRN",8994,0)
8994
"BLD",11399,"KRN","B",.4,.4)

"BLD",11399,"KRN","B",.401,.401)

"BLD",11399,"KRN","B",.402,.402)

"BLD",11399,"KRN","B",.403,.403)

"BLD",11399,"KRN","B",.5,.5)

"BLD",11399,"KRN","B",.84,.84)

"BLD",11399,"KRN","B",1.6,1.6)

"BLD",11399,"KRN","B",1.61,1.61)

"BLD",11399,"KRN","B",1.62,1.62)

"BLD",11399,"KRN","B",3.6,3.6)

"BLD",11399,"KRN","B",3.8,3.8)

"BLD",11399,"KRN","B",9.2,9.2)

"BLD",11399,"KRN","B",9.8,9.8)

"BLD",11399,"KRN","B",19,19)

"BLD",11399,"KRN","B",19.1,19.1)

"BLD",11399,"KRN","B",101,101)

"BLD",11399,"KRN","B",409.61,409.61)

"BLD",11399,"KRN","B",771,771)

"BLD",11399,"KRN","B",779.2,779.2)

"BLD",11399,"KRN","B",870,870)

"BLD",11399,"KRN","B",8989.51,8989.51)

"BLD",11399,"KRN","B",8989.52,8989.52)

"BLD",11399,"KRN","B",8994,8994)

"BLD",11399,"QDEF")
^^^^NO^^^^YES^^NO
"BLD",11399,"QUES",0)
^9.62^^
"BLD",11399,"REQB",0)
^9.611^1^1
"BLD",11399,"REQB",1,0)
PRCA*4.5*253^1
"BLD",11399,"REQB","B","PRCA*4.5*253",1)

"KRN",19,7187,-1)
4^4
"KRN",19,7187,0)
PRCA RCDMC 90 DAY REPORT
"KRN",19,7188,-1)
4^7
"KRN",19,7188,0)
PRCA RCDMC CANCEL
"KRN",19,7189,-1)
4^6
"KRN",19,7189,0)
PRCA RCDMC LESSER WITHHOLDING
"KRN",19,7190,-1)
0^14
"KRN",19,7190,0)
PRCA RCDMC REFERRAL MENU^DMC Referral Menu^^M^^^^^^^^ACCOUNTS RECEIVABLE
"KRN",19,7190,1,0)
^19.06^2^2^3190124^^^^
"KRN",19,7190,1,1,0)
This menu will be placed on the Supervisor's AR Menu.  It is composed of
"KRN",19,7190,1,2,0)
various options dealing with Debt Management Center (DMC) referral.
"KRN",19,7190,10,0)
^19.01IP^14^14
"KRN",19,7190,10,1,0)
7187^1^1
"KRN",19,7190,10,1,"^")
PRCA RCDMC 90 DAY REPORT
"KRN",19,7190,10,2,0)
7366^2^2
"KRN",19,7190,10,2,"^")
PRCA RCDMC REFERRED RPT
"KRN",19,7190,10,3,0)
7189^3^3
"KRN",19,7190,10,3,"^")
PRCA RCDMC LESSER WITHHOLDING
"KRN",19,7190,10,4,0)
7188^4^4
"KRN",19,7190,10,4,"^")
PRCA RCDMC CANCEL
"KRN",19,7190,10,5,0)
13065^5^5
"KRN",19,7190,10,5,"^")
RCDMCR1 DEBT VALIDITY REPORT
"KRN",19,7190,10,6,0)
13067^6^6
"KRN",19,7190,10,6,"^")
RCDMCR2 DEBT VALIDITY MGMT RPT
"KRN",19,7190,10,7,0)
13069^7^7
"KRN",19,7190,10,7,"^")
RCDMCR3 RD ELIG CHANGE REPORT
"KRN",19,7190,10,8,0)
13064^8^8
"KRN",19,7190,10,8,"^")
RCDMCEDT ENTER/EDIT DMC DEBT 
"KRN",19,7190,10,9,0)
13063^9^9
"KRN",19,7190,10,9,"^")
RCDMC EDIT RD # OF DAYS PARAME
"KRN",19,7190,10,10,0)
13169^10^10
"KRN",19,7190,10,10,"^")
RCDMC EDIT DMC REPORT # OF DAY
"KRN",19,7190,10,11,0)
14386^11^11
"KRN",19,7190,10,11,"^")
RCDMCR4 0-40 PERC SC CHNG RPT
"KRN",19,7190,10,12,0)
14387^12^12
"KRN",19,7190,10,12,"^")
RCDMCR5 1ST PARTY IB CANC RPT
"KRN",19,7190,10,13,0)
14402^14^14
"KRN",19,7190,10,13,"^")
RCDMCR6 50-100SC EXMPT RPT
"KRN",19,7190,10,14,0)
14403^13^13
"KRN",19,7190,10,14,"^")
RCDMCR7 10-40% COPAY RPT
"KRN",19,7190,99)
65106,45111
"KRN",19,7190,"U")
DMC REFERRAL MENU
"KRN",19,7366,-1)
4^5
"KRN",19,7366,0)
PRCA RCDMC REFERRED RPT
"KRN",19,13063,-1)
4^12
"KRN",19,13063,0)
RCDMC EDIT RD # OF DAYS PARAME
"KRN",19,13064,-1)
4^11
"KRN",19,13064,0)
RCDMCEDT ENTER/EDIT DMC DEBT 
"KRN",19,13065,-1)
4^8
"KRN",19,13065,0)
RCDMCR1 DEBT VALIDITY REPORT
"KRN",19,13067,-1)
4^9
"KRN",19,13067,0)
RCDMCR2 DEBT VALIDITY MGMT RPT
"KRN",19,13069,-1)
4^10
"KRN",19,13069,0)
RCDMCR3 RD ELIG CHANGE REPORT
"KRN",19,13169,-1)
4^13
"KRN",19,13169,0)
RCDMC EDIT DMC REPORT # OF DAY
"KRN",19,14386,-1)
0^1
"KRN",19,14386,0)
RCDMCR4 0-40 PERC SC CHNG RPT^0-40 Percent SC Change Reconciliation Report^^R^^^^^^^^
"KRN",19,14386,1,0)
^^45^45^3190405^
"KRN",19,14386,1,1,0)
This report will assist users in reviewing the legitimacy of first party 
"KRN",19,14386,1,2,0)
bills for veterans who received a new or updated change to a 0-40% Service
"KRN",19,14386,1,3,0)
Connected (SC) eligibility factor and received the change in VistA during 
"KRN",19,14386,1,4,0)
the report time frame requested.  This report prints information on 
"KRN",19,14386,1,5,0)
veterans with an A/R Bill Status of Active, Suspended, Open, Write-Off,
"KRN",19,14386,1,6,0)
Collected/Closed or with an IB Bill Status On Hold, for episodes of care
"KRN",19,14386,1,7,0)
within a user selected time frame.
"KRN",19,14386,1,8,0)
 
"KRN",19,14386,1,9,0)
The report does not include bills for:
"KRN",19,14386,1,10,0)
  debtors whose Service Connection is 50% or more, 
"KRN",19,14386,1,11,0)
  debtors who are receiving a VA pension (regardless of their SC%), or 
"KRN",19,14386,1,12,0)
  debtors receiving Aid and Attendance 
"KRN",19,14386,1,13,0)
 
"KRN",19,14386,1,14,0)
The User is prompted to enter a beginning and ending date related to the 
"KRN",19,14386,1,15,0)
rated disabilities/eligibility change, a beginning and ending date for a
"KRN",19,14386,1,16,0)
VistA last status update date range, and a beginning and ending date for
"KRN",19,14386,1,17,0)
an episodes of care date range. Veterans who meet the above criteria, 
"KRN",19,14386,1,18,0)
and whose rated disability eligibility has changed during the selected
"KRN",19,14386,1,19,0)
timeframe will be included in the report.
"KRN",19,14386,1,20,0)
 
"KRN",19,14386,1,21,0)
The report allows users to choose whether to print the report in a 
"KRN",19,14386,1,22,0)
detailed format, a summary format, and in screen or Excel Delimited
"KRN",19,14386,1,23,0)
format. 
"KRN",19,14386,1,24,0)
 
"KRN",19,14386,1,25,0)
It is recommended that report is to be sent to a 132 character wide device.
"KRN",19,14386,1,26,0)
 
"KRN",19,14386,1,27,0)
The report will include the following data elements:
"KRN",19,14386,1,28,0)
   Data Elements                      From File #
"KRN",19,14386,1,29,0)
   -------------------------------    ---------------------------------
"KRN",19,14386,1,30,0)
   Veteran's Name                     #2 (Patient File) 
"KRN",19,14386,1,31,0)
   SSN (9 digits)                     #2
"KRN",19,14386,1,32,0)
   Combined SC Percentage             #2
"KRN",19,14386,1,33,0)
   VistA Last Status Update Date      #430
"KRN",19,14386,1,34,0)
   Rated Disability Name              #390
"KRN",19,14386,1,35,0)
   Original Rated Disability Date     #390
"KRN",19,14386,1,36,0)
   Bill Number                        #430 (Accounts Receivable)
"KRN",19,14386,1,37,0)
   Charge Amount                      #430
"KRN",19,14386,1,38,0)
   Medical Care Date (either Outpatient Visit or Inpatient Discharge)
"KRN",19,14386,1,39,0)
                                      #350 or #409.68 or #45 or #405
"KRN",19,14386,1,40,0)
 
"KRN",19,14386,1,41,0)
   Medication Fill Date               #52 pointed to be File #350
"KRN",19,14386,1,42,0)
   Prescription Number                #52 pointed to be File #350
"KRN",19,14386,1,43,0)
   Prescription Name                  #52 pointed to be File #350
"KRN",19,14386,1,44,0)
   Bill Status                        #430 for AR Status 
"KRN",19,14386,1,45,0)
                                      #350 for IB Status
"KRN",19,14386,25)
MAIN^RCDMCR4A
"KRN",19,14386,"U")
0-40 PERCENT SC CHANGE RECONCI
"KRN",19,14387,-1)
0^2
"KRN",19,14387,0)
RCDMCR5 1ST PARTY IB CANC RPT^First Party Charge IB Cancellation Recon Report^^R^^^^^^^^
"KRN",19,14387,1,0)
^^45^45^3190405^
"KRN",19,14387,1,1,0)
This report will assist users in reviewing first party charges receiving 
"KRN",19,14387,1,2,0)
Integrated Billing (IB) cancellation for potential refund activities or 
"KRN",19,14387,1,3,0)
charge cancellation accuracy, and to identify and monitor cancellation
"KRN",19,14387,1,4,0)
activity productivity so veteran customers can receive refunds due to them
"KRN",19,14387,1,5,0)
for retroactive eligibility exemptions.  The report provides data for
"KRN",19,14387,1,6,0)
first party charges receiving IB cancellation for a user defined bill
"KRN",19,14387,1,7,0)
cancellation date range.
"KRN",19,14387,1,8,0)
 
"KRN",19,14387,1,9,0)
The report provides the option to print only bills with payments or print 
"KRN",19,14387,1,10,0)
all bills within the user specified bill cancellation date range.  If 
"KRN",19,14387,1,11,0)
only bills with payments are printed, the report will include bills with
"KRN",19,14387,1,12,0)
an IB Status of "Cancelled" and an AR Status of "C/C"
"KRN",19,14387,1,13,0)
(Closed/Collected).  If all bills are printed, the report will include
"KRN",19,14387,1,14,0)
bills with an IB Status of "Cancelled" with any AR Status.
"KRN",19,14387,1,15,0)
 
"KRN",19,14387,1,16,0)
The report allows user the option to print the report in screen or Excel
"KRN",19,14387,1,17,0)
Delimited format.
"KRN",19,14387,1,18,0)
 
"KRN",19,14387,1,19,0)
It is recommended that report is to be sent to a 132 character wide device.
"KRN",19,14387,1,20,0)
 
"KRN",19,14387,1,21,0)
Note:  This report does not include bills with third-party AR Category 
"KRN",19,14387,1,22,0)
Types of "Reimbursable" or "Pre-payments".
"KRN",19,14387,1,23,0)
  
"KRN",19,14387,1,24,0)
The report output includes veteran name, SSN, bill number, charge amount, 
"KRN",19,14387,1,25,0)
medical care date, medication fill date, prescription number, 
"KRN",19,14387,1,26,0)
prescription name, IB cancellation date, IB cancellation reason, and
"KRN",19,14387,1,27,0)
cancelled by.
"KRN",19,14387,1,28,0)
 
"KRN",19,14387,1,29,0)
The report will include the following data elements:
"KRN",19,14387,1,30,0)
   Data Elements                      From File #
"KRN",19,14387,1,31,0)
   -------------------------------    ---------------------------------
"KRN",19,14387,1,32,0)
   Veteran's Name                     #2 (Patient File) 
"KRN",19,14387,1,33,0)
   SSN (9 digits)                     #2
"KRN",19,14387,1,34,0)
   Bill Number                        #430 (Accounts Receivable)
"KRN",19,14387,1,35,0)
   Charge Amount                      #430
"KRN",19,14387,1,36,0)
   Medical Care Date (either Outpatient Visit or Inpatient Discharge)
"KRN",19,14387,1,37,0)
                                      #350 or #409.68 or #45 or #405
"KRN",19,14387,1,38,0)
   Medication Fill Date               #52 pointed to be File #350
"KRN",19,14387,1,39,0)
   Prescription Number                #52 pointed to be File #350
"KRN",19,14387,1,40,0)
   Prescription Name                  #52 pointed to be File #350
"KRN",19,14387,1,41,0)
   Bill Status                        #430 for AR Status or
"KRN",19,14387,1,42,0)
                                      #350 for IB Status
"KRN",19,14387,1,43,0)
   IB Cancellation Date               #350
"KRN",19,14387,1,44,0)
   IB Cancellation Reason             #350
"KRN",19,14387,1,45,0)
   Cancelled By                       #350
"KRN",19,14387,25)
MAIN^RCDMCR5A
"KRN",19,14387,"U")
FIRST PARTY CHARGE IB CANCELLA
"KRN",19,14402,-1)
0^15
"KRN",19,14402,0)
RCDMCR6 50-100SC EXMPT RPT^50-100% SC Exempt Charge Reconciliation Report^^R^^^^^^^^
"KRN",19,14402,1,0)
^^9^9^3190408^
"KRN",19,14402,1,1,0)
50-100% SC Exempt Charge Reconciliation Report shows all bills containing
"KRN",19,14402,1,2,0)
charges with a distinct date of service on or after the co-payment
"KRN",19,14402,1,3,0)
exemption effective date for Veterans with Primary or Secondary
"KRN",19,14402,1,4,0)
Eligibility: SC 50-100%
"KRN",19,14402,1,5,0)
 
"KRN",19,14402,1,6,0)
The report captures any charges WITHOUT an IB status of cancelled, and 
"KRN",19,14402,1,7,0)
with an AR Status of Active, Open, Suspended, Write-Off, or Collected/
"KRN",19,14402,1,8,0)
Closed or an IB Status of On-Hold, with a date of service on or
"KRN",19,14402,1,9,0)
after the exemption effective date.
"KRN",19,14402,25)
MAIN^RCDMCR6A
"KRN",19,14402,"U")
50-100% SC EXEMPT CHARGE RECON
"KRN",19,14403,-1)
0^16
"KRN",19,14403,0)
RCDMCR7 10-40% COPAY RPT^10-40% SC Med Care Copay Exempt Chrg Recon Report^^R^^^^^^^^
"KRN",19,14403,1,0)
^^10^10^3190315^
"KRN",19,14403,1,1,0)
10-40% SC Medical Care Copayment Exempt Charge Recon Report shows all
"KRN",19,14403,1,2,0)
medical care copayment bills containing charges with a distinct date of
"KRN",19,14403,1,3,0)
service on or after the copayment exemption effective date for Veterans
"KRN",19,14403,1,4,0)
with SC Percent: 10-40%, and does not show Veterans with 0% SC.  Further,
"KRN",19,14403,1,5,0)
the report does not capture prescription copayment bills.
"KRN",19,14403,1,6,0)
 
"KRN",19,14403,1,7,0)
The report captures any medical care copayment charge WITHOUT an IB 
"KRN",19,14403,1,8,0)
status of cancelled, and WITH an AR Status of Active, Open, Suspended, 
"KRN",19,14403,1,9,0)
Write-Off, or Collected/Closed OR an IB Status of On-Hold, with a date of 
"KRN",19,14403,1,10,0)
service on or after the exemption effective date.
"KRN",19,14403,25)
MAIN^RCDMCR7A
"KRN",19,14403,"U")
10-40% SC MED CARE COPAY EXEMP
"MBREQ")
0
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"PKG",142,-1)
1^1
"PKG",142,0)
ACCOUNTS RECEIVABLE^PRCA^BILL COLLECTIONS
"PKG",142,22,0)
^9.49I^1^1
"PKG",142,22,1,0)
4.5^^2950320
"PKG",142,22,1,"PAH",1,0)
347^3190515^1616
"PKG",142,22,1,"PAH",1,1,0)
^^5^5^3190409
"PKG",142,22,1,"PAH",1,1,1,0)
AR Cross Servicing Patch.   Contains two new reports, 2 new options to 
"PKG",142,22,1,"PAH",1,1,2,0)
run them and 4 new routines
"PKG",142,22,1,"PAH",1,1,3,0)
 
"PKG",142,22,1,"PAH",1,1,4,0)
0-40 Percent SC Change Reconciliation Report (RCDMCR4A and RCDMCR4B)
"PKG",142,22,1,"PAH",1,1,5,0)
First Party Charge IB Cancellation Recon Report (RCDMCR5A and RCDMC5B)
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
10
"RTN","RCDMCR4A")
0^2^B101685386^n/a
"RTN","RCDMCR4A",1,0)
RCDMCR4A ;ALB/YG - 0 - 40 Percent SC Change Reconciliation Report - Input/output; Apr 9, 2019@21:06
"RTN","RCDMCR4A",2,0)
 ;;4.5;Accounts Receivable;**347**;Mar 20, 1995;Build 47
"RTN","RCDMCR4A",3,0)
 ;;Per VA Directive 6402, this routine should not be modified.
"RTN","RCDMCR4A",4,0)
 ;
"RTN","RCDMCR4A",5,0)
 ;This routine is being implemented for the AR Cross-Referencing Project
"RTN","RCDMCR4A",6,0)
 ;It will do the following:
"RTN","RCDMCR4A",7,0)
 ;   Report option in AR to assist users in focusing on reviewing the 
"RTN","RCDMCR4A",8,0)
 ;   legitimacy of bills for veterans who are neither SC 50% to 100% 
"RTN","RCDMCR4A",9,0)
 ;   nor in receipt of a VA Pension benefits (Veterans not included on
"RTN","RCDMCR4A",10,0)
 ;   the "DMC Debt Validity Report"). The report will contain 
"RTN","RCDMCR4A",11,0)
 ;   information on veterans who have bills for episodes of care 
"RTN","RCDMCR4A",12,0)
 ;   within the specified date range, who have a new Rated Disability
"RTN","RCDMCR4A",13,0)
 ;   during a user selected time period, and whose service update date is 
"RTN","RCDMCR4A",14,0)
 ;   within user specified date range 
"RTN","RCDMCR4A",15,0)
 ;
"RTN","RCDMCR4A",16,0)
MAIN ; Initial Interactive Processing
"RTN","RCDMCR4A",17,0)
 S:$G(U)="" U="^"
"RTN","RCDMCR4A",18,0)
 N STOPIT,EXCEL,RCSCR,RDDATE,RCBEGDT,RCENDDT,EOCBEGDT,EOCENDDT,EOCDATE,VLSDATE,VLSBEGDT,VLSENDDT,RPTTYPE
"RTN","RCDMCR4A",19,0)
 W !!,"*** Print the 0-40 Percent SC Change Reconciliation Report ***",!
"RTN","RCDMCR4A",20,0)
 ;
"RTN","RCDMCR4A",21,0)
 S STOPIT=0 ; quit flag
"RTN","RCDMCR4A",22,0)
 ;Prompt user for Date Range for Rated Disability Eligibility Changes
"RTN","RCDMCR4A",23,0)
 S RDDATE=$$DATE2^RCDMCUT2("    Enter the Date Range for Rated Disability Changes.")
"RTN","RCDMCR4A",24,0)
 ;Quit is user up arrowed or timed out
"RTN","RCDMCR4A",25,0)
 Q:RDDATE'>0
"RTN","RCDMCR4A",26,0)
 S RCBEGDT=$P(RDDATE,U,2),RCENDDT=$P(RDDATE,U,3)
"RTN","RCDMCR4A",27,0)
 ;
"RTN","RCDMCR4A",28,0)
 ;Prompt user for Date range for VistA Last Status Date
"RTN","RCDMCR4A",29,0)
 W !
"RTN","RCDMCR4A",30,0)
 S VLSDATE=$$DATE2^RCDMCUT2("Include Bills with VistA Last Status Date that fall within ","the Date Range for Rated Disability Changes:",RCBEGDT,RCENDDT,"VistA Last Status Update")
"RTN","RCDMCR4A",31,0)
 ;Quit if user up arrowed or timed out
"RTN","RCDMCR4A",32,0)
 Q:+VLSDATE'>0
"RTN","RCDMCR4A",33,0)
 S VLSBEGDT=$P(VLSDATE,U,2),VLSENDDT=$P(VLSDATE,U,3)
"RTN","RCDMCR4A",34,0)
 ;
"RTN","RCDMCR4A",35,0)
 ;Prompt user for Date range for Episodes of Care Date
"RTN","RCDMCR4A",36,0)
 W !
"RTN","RCDMCR4A",37,0)
 S EOCDATE=$$DATE2^RCDMCUT2("Include Bills for Episodes of Care within User Selected Date Range:",,2880101,,"Episodes of Care")
"RTN","RCDMCR4A",38,0)
 ;Quit if user up arrowed or timed out
"RTN","RCDMCR4A",39,0)
 Q:+EOCDATE'>0
"RTN","RCDMCR4A",40,0)
 S EOCBEGDT=$P(EOCDATE,U,2),EOCENDDT=$P(EOCDATE,U,3)
"RTN","RCDMCR4A",41,0)
 ; 
"RTN","RCDMCR4A",42,0)
 ; Get Report Type (Detailed/Summary)
"RTN","RCDMCR4A",43,0)
 S STOPIT=0
"RTN","RCDMCR4A",44,0)
 S RPTTYPE=$$GETTYPE2^RCDMCUT2(.STOPIT)
"RTN","RCDMCR4A",45,0)
 Q:STOPIT>0!(RPTTYPE']"")
"RTN","RCDMCR4A",46,0)
 ;
"RTN","RCDMCR4A",47,0)
 ; Prompt user if report will be Excel Delimited format:
"RTN","RCDMCR4A",48,0)
 S EXCEL=$$EXCEL^RCDMCUT2
"RTN","RCDMCR4A",49,0)
 ;Quit is user up arrowed or timed out
"RTN","RCDMCR4A",50,0)
 Q:EXCEL="^"
"RTN","RCDMCR4A",51,0)
 D:EXCEL>0 EXMSG^RCDMCUT2
"RTN","RCDMCR4A",52,0)
 D:EXCEL'>0
"RTN","RCDMCR4A",53,0)
 . W !!,"This report may take a while to process. It is recommended that"
"RTN","RCDMCR4A",54,0)
 . W !,"you Queue this report to a device that is 132 characters wide."
"RTN","RCDMCR4A",55,0)
 ;
"RTN","RCDMCR4A",56,0)
 ; Logic from DEVICE^RCDMCUT2 copied here
"RTN","RCDMCR4A",57,0)
 N %ZIS,ZTSK,ZTRTN,ZTIO,ZTDESC,POP,ZTSAVE
"RTN","RCDMCR4A",58,0)
 S %ZIS="QM"
"RTN","RCDMCR4A",59,0)
 W ! D ^%ZIS
"RTN","RCDMCR4A",60,0)
 I POP S STOPIT=1 Q
"RTN","RCDMCR4A",61,0)
 ; RCSCR is 1 if sent to screen
"RTN","RCDMCR4A",62,0)
 S RCSCR=$S($E($G(IOST),1,2)="C-":1,1:0)
"RTN","RCDMCR4A",63,0)
 ; If report is Queued
"RTN","RCDMCR4A",64,0)
 I $D(IO("Q")) D  Q
"RTN","RCDMCR4A",65,0)
 . S ZTRTN="RUN^RCDMCR4A"
"RTN","RCDMCR4A",66,0)
 . S ZTIO=ION
"RTN","RCDMCR4A",67,0)
 . S ZTSAVE("RCBEGDT")=""
"RTN","RCDMCR4A",68,0)
 . S ZTSAVE("RCENDDT")=""
"RTN","RCDMCR4A",69,0)
 . S ZTSAVE("EOCBEGDT")=""
"RTN","RCDMCR4A",70,0)
 . S ZTSAVE("EOCENDDT")=""
"RTN","RCDMCR4A",71,0)
 . S ZTSAVE("VLSBEGDT")=""
"RTN","RCDMCR4A",72,0)
 . S ZTSAVE("VLSENDDT")=""
"RTN","RCDMCR4A",73,0)
 . S ZTSAVE("RPTTYPE")=""
"RTN","RCDMCR4A",74,0)
 . S ZTSAVE("RCSCR")=""
"RTN","RCDMCR4A",75,0)
 . S ZTSAVE("EXCEL")=""
"RTN","RCDMCR4A",76,0)
 . S ZTDESC="DMC 0-40 Percent SC Change Reconciliation Report Process"
"RTN","RCDMCR4A",77,0)
 . D ^%ZTLOAD
"RTN","RCDMCR4A",78,0)
 . W !!,$S($D(ZTSK):"Request Queued.  TASK = "_ZTSK,1:"REQUEST CANCELLED")
"RTN","RCDMCR4A",79,0)
 . D HOME^%ZIS
"RTN","RCDMCR4A",80,0)
 ;
"RTN","RCDMCR4A",81,0)
 Q:STOPIT>0!($D(ZTQUEUED))
"RTN","RCDMCR4A",82,0)
 D RUN^RCDMCR4A
"RTN","RCDMCR4A",83,0)
 I 'STOPIT D PAUSE2^RCDMCUT2
"RTN","RCDMCR4A",84,0)
 Q
"RTN","RCDMCR4A",85,0)
 ; 
"RTN","RCDMCR4A",86,0)
 ; Currently, Taskman schedulable option is not being planned for this report
"RTN","RCDMCR4A",87,0)
 ; If this is going to change later on, QUERPT^RCDMCR3A would be a good example
"RTN","RCDMCR4A",88,0)
 ; of how to do such an option
"RTN","RCDMCR4A",89,0)
 ;  
"RTN","RCDMCR4A",90,0)
QUERPT ; Initial Taskman Scheduled Queued processing
"RTN","RCDMCR4A",91,0)
 ; Set up parameters
"RTN","RCDMCR4A",92,0)
 ; Run report
"RTN","RCDMCR4A",93,0)
 D RUN^RCDMCR4A
"RTN","RCDMCR4A",94,0)
 Q
"RTN","RCDMCR4A",95,0)
 ;
"RTN","RCDMCR4A",96,0)
RUN ;Get data and Print it out
"RTN","RCDMCR4A",97,0)
 ;If queued ensure you delete it from the TASKS file
"RTN","RCDMCR4A",98,0)
 I $D(ZTQUEUED) S ZTREQ="@"
"RTN","RCDMCR4A",99,0)
 N RCPAGE
"RTN","RCDMCR4A",100,0)
 S STOPIT=0 ; quit flag
"RTN","RCDMCR4A",101,0)
 K ^TMP($J,"RCDMCR4")
"RTN","RCDMCR4A",102,0)
 S RCPAGE=0
"RTN","RCDMCR4A",103,0)
 ; Collect the data in ^TMP($J,"RCDMCR4")
"RTN","RCDMCR4A",104,0)
 D COLLECT^RCDMCR4B(.STOPIT,RCBEGDT,RCENDDT,VLSBEGDT,VLSENDDT,EOCBEGDT,EOCENDDT,RPTTYPE)
"RTN","RCDMCR4A",105,0)
 Q:STOPIT>0
"RTN","RCDMCR4A",106,0)
 U IO
"RTN","RCDMCR4A",107,0)
 ; Print Report using data in ^TMP
"RTN","RCDMCR4A",108,0)
 D REPORT
"RTN","RCDMCR4A",109,0)
 I 'RCSCR W !,@IOF
"RTN","RCDMCR4A",110,0)
 D ^%ZISC
"RTN","RCDMCR4A",111,0)
 K ^TMP($J,"RCDMCR4")
"RTN","RCDMCR4A",112,0)
 K EXCEL,RCSCR
"RTN","RCDMCR4A",113,0)
 Q
"RTN","RCDMCR4A",114,0)
 ;
"RTN","RCDMCR4A",115,0)
REPORT ;Print report
"RTN","RCDMCR4A",116,0)
 N RUNDATE,STATUS,NAME,SSN,CHGDT,RDNAME,RDSEXTRE,BILLNO
"RTN","RCDMCR4A",117,0)
 N SKIP,IBCNT,SCPER
"RTN","RCDMCR4A",118,0)
 S RUNDATE=$$FMTE^XLFDT($$NOW^XLFDT,"9MP")
"RTN","RCDMCR4A",119,0)
 D HDR
"RTN","RCDMCR4A",120,0)
 I +$D(^TMP($J,"RCDMCR4"))'>0 W !,"No data meets the criteria." Q
"RTN","RCDMCR4A",121,0)
 I RPTTYPE="S" D
"RTN","RCDMCR4A",122,0)
 . S NAME=""
"RTN","RCDMCR4A",123,0)
 . F  S NAME=$O(^TMP($J,"RCDMCR4","SUMMARY",NAME)) Q:NAME']""  D  Q:STOPIT
"RTN","RCDMCR4A",124,0)
 . . S SSN=""
"RTN","RCDMCR4A",125,0)
 . . F  S SSN=$O(^TMP($J,"RCDMCR4","SUMMARY",NAME,SSN)) Q:SSN']""  D  Q:STOPIT
"RTN","RCDMCR4A",126,0)
 . . . W !
"RTN","RCDMCR4A",127,0)
 . . . S SCPER=^TMP($J,"RCDMCR4","SUMMARY",NAME,SSN)
"RTN","RCDMCR4A",128,0)
 . . . I EXCEL>0 W NAME,U,SSN,U,+SCPER Q
"RTN","RCDMCR4A",129,0)
 . . . W $E(NAME,1,25) ; Veteran Name
"RTN","RCDMCR4A",130,0)
 . . . W ?27,SSN ; SSN
"RTN","RCDMCR4A",131,0)
 . . . W ?41,$J(+SCPER,2) ; Comb SC%
"RTN","RCDMCR4A",132,0)
 I RPTTYPE="D" D
"RTN","RCDMCR4A",133,0)
 . S NAME=""
"RTN","RCDMCR4A",134,0)
 . F  S NAME=$O(^TMP($J,"RCDMCR4","DETAIL",NAME)) Q:NAME=""  D  Q:STOPIT
"RTN","RCDMCR4A",135,0)
 . . S SSN=""
"RTN","RCDMCR4A",136,0)
 . . F  S SSN=$O(^TMP($J,"RCDMCR4","DETAIL",NAME,SSN)) Q:SSN=""  D  Q:STOPIT
"RTN","RCDMCR4A",137,0)
 . . . S CHGDT=""
"RTN","RCDMCR4A",138,0)
 . . . F  S CHGDT=$O(^TMP($J,"RCDMCR4","DETAIL",NAME,SSN,CHGDT)) Q:CHGDT=""  D  Q:STOPIT
"RTN","RCDMCR4A",139,0)
 . . . . S RDNAME=""
"RTN","RCDMCR4A",140,0)
 . . . . F  S RDNAME=$O(^TMP($J,"RCDMCR4","DETAIL",NAME,SSN,CHGDT,RDNAME)) Q:RDNAME=""  D  Q:STOPIT
"RTN","RCDMCR4A",141,0)
 . . . . . S RDSEXTRE=""
"RTN","RCDMCR4A",142,0)
 . . . . . F  S RDSEXTRE=$O(^TMP($J,"RCDMCR4","DETAIL",NAME,SSN,CHGDT,RDNAME,RDSEXTRE)) Q:RDSEXTRE=""  D  Q:STOPIT
"RTN","RCDMCR4A",143,0)
 . . . . . . S BILLNO=""
"RTN","RCDMCR4A",144,0)
 . . . . . . F  S BILLNO=$O(^TMP($J,"RCDMCR4","DETAIL",NAME,SSN,CHGDT,RDNAME,RDSEXTRE,BILLNO)) Q:BILLNO=""  D  Q:STOPIT
"RTN","RCDMCR4A",145,0)
 . . . . . . . S IBCNT=""
"RTN","RCDMCR4A",146,0)
 . . . . . . . F  S IBCNT=$O(^TMP($J,"RCDMCR4","DETAIL",NAME,SSN,CHGDT,RDNAME,RDSEXTRE,BILLNO,IBCNT)) Q:IBCNT=""  D  Q:STOPIT
"RTN","RCDMCR4A",147,0)
 . . . . . . . . ; (NAME,SSN,RDCHGDT,RDNAME,RDSEXTRE,BILLNO,IBCNT)=RDORGDT_U_RXDT_U_OPTDT_U_DISCHDT_U_DSTATUS_U_SCPER_U_VLSDT_U_CHGAMT_U_$G(RXNUM)_U_$G(RXNAM)
"RTN","RCDMCR4A",148,0)
 . . . . . . . . N NODE,RDORGDT,RXDT,OPTDT,DISCHDT,STATUS,SCPER,VLSDT,CHGAMT,RXNUM,RXNAM
"RTN","RCDMCR4A",149,0)
 . . . . . . . . S NODE=$G(^TMP($J,"RCDMCR4","DETAIL",NAME,SSN,CHGDT,RDNAME,RDSEXTRE,BILLNO,IBCNT))
"RTN","RCDMCR4A",150,0)
 . . . . . . . . S RDORGDT=$P(NODE,U,1)
"RTN","RCDMCR4A",151,0)
 . . . . . . . . S RXDT=$P(NODE,U,2)
"RTN","RCDMCR4A",152,0)
 . . . . . . . . S OPTDT=$P(NODE,U,3)
"RTN","RCDMCR4A",153,0)
 . . . . . . . . S DISCHDT=$P(NODE,U,4)
"RTN","RCDMCR4A",154,0)
 . . . . . . . . S STATUS=$P(NODE,U,5)
"RTN","RCDMCR4A",155,0)
 . . . . . . . . S SCPER=$P(NODE,U,6)
"RTN","RCDMCR4A",156,0)
 . . . . . . . . S VLSDT=$P(NODE,U,7)
"RTN","RCDMCR4A",157,0)
 . . . . . . . . S CHGAMT=$P(NODE,U,8)
"RTN","RCDMCR4A",158,0)
 . . . . . . . . S RXNUM=$P(NODE,U,9)
"RTN","RCDMCR4A",159,0)
 . . . . . . . . S RXNAM=$P(NODE,U,10)
"RTN","RCDMCR4A",160,0)
 . . . . . . . . I EXCEL'>0 D WRLINE Q
"RTN","RCDMCR4A",161,0)
 . . . . . . . . I EXCEL>0 D WRLINE2 Q
"RTN","RCDMCR4A",162,0)
 ;Don't print summary if user ^ out
"RTN","RCDMCR4A",163,0)
 Q:STOPIT
"RTN","RCDMCR4A",164,0)
 I EXCEL'>0 D ULINE^RCDMCUT2("=",48)
"RTN","RCDMCR4A",165,0)
 Q
"RTN","RCDMCR4A",166,0)
 ;
"RTN","RCDMCR4A",167,0)
WRLINE ; Write the data formated report line
"RTN","RCDMCR4A",168,0)
 D CHKP() Q:STOPIT
"RTN","RCDMCR4A",169,0)
 W !
"RTN","RCDMCR4A",170,0)
 ; Disable skip for now (as per direction of customer) with condition :0
"RTN","RCDMCR4A",171,0)
 I (NAME_SSN_+SCPER)'=$G(SKIP(1)) D
"RTN","RCDMCR4A",172,0)
 . W $E(NAME,1,13) ; Veteran Name
"RTN","RCDMCR4A",173,0)
 . W ?14,SSN ; SSN
"RTN","RCDMCR4A",174,0)
 . W ?24,$J(+SCPER,2) ; Comb SC%
"RTN","RCDMCR4A",175,0)
 . K SKIP(2),SKIP(3)
"RTN","RCDMCR4A",176,0)
 . S:0 SKIP(1)=NAME_SSN_+SCPER
"RTN","RCDMCR4A",177,0)
 I VLSDT'=$G(SKIP(2)) S:0 SKIP(2)=VLSDT W ?27,$$STRIP^XLFSTR($$FMTE^XLFDT(VLSDT,"8D")," ") ; Vista CHG Date
"RTN","RCDMCR4A",178,0)
 I RDNAME'=$G(SKIP(3)) S:0 SKIP(3)=RDNAME W ?35,$E(RDNAME,1,13) ; RD Name
"RTN","RCDMCR4A",179,0)
 W ?49,$E(RDSEXTRE,1,2)
"RTN","RCDMCR4A",180,0)
 W ?52,$S(RDORGDT="NODATE":RDORGDT,1:$$STRIP^XLFSTR($$FMTE^XLFDT(RDORGDT,"8D")," ")) ; RD Orig Date
"RTN","RCDMCR4A",181,0)
 W ?60,$P(BILLNO,"/",1) ; Bill Number
"RTN","RCDMCR4A",182,0)
 W:RDORGDT'="NODATE" ?72,$J("$"_$FN(CHGAMT,",",2),11) ; Charge Amount 
"RTN","RCDMCR4A",183,0)
 ; pick the later of OPTDT (outpatient) and DISCHDT (inpatient)
"RTN","RCDMCR4A",184,0)
 I DISCHDT>OPTDT W:DISCHDT>0 ?84,$$STRIP^XLFSTR($$FMTE^XLFDT(DISCHDT,"8D")," ")
"RTN","RCDMCR4A",185,0)
 E  W:OPTDT>0 ?84,$$STRIP^XLFSTR($$FMTE^XLFDT(OPTDT,"8D")," ")
"RTN","RCDMCR4A",186,0)
 W:RXDT>0 ?92,$$STRIP^XLFSTR($$FMTE^XLFDT(RXDT,"8D")," ") ; Med Fill Date
"RTN","RCDMCR4A",187,0)
 W ?100,RXNUM ; RX # 
"RTN","RCDMCR4A",188,0)
 W ?109,$E(RXNAM,1,12) ; RX Name
"RTN","RCDMCR4A",189,0)
 W ?123,$E(STATUS,1,9) ; This will be AR status for most cases, but for some, it will be IB Status ON HOLD
"RTN","RCDMCR4A",190,0)
 Q
"RTN","RCDMCR4A",191,0)
 ;
"RTN","RCDMCR4A",192,0)
WRLINE2 ; Write the Excel report line
"RTN","RCDMCR4A",193,0)
 W !
"RTN","RCDMCR4A",194,0)
 W $$EXOUT(NAME),U
"RTN","RCDMCR4A",195,0)
 W $$EXOUT(SSN),U
"RTN","RCDMCR4A",196,0)
 W +SCPER,U
"RTN","RCDMCR4A",197,0)
 W $$FMTE^XLFDT(VLSDT,"9D"),U
"RTN","RCDMCR4A",198,0)
 W RDNAME,U
"RTN","RCDMCR4A",199,0)
 W RDSEXTRE,U
"RTN","RCDMCR4A",200,0)
 I RDORGDT="NODATE" W "NODATE",U
"RTN","RCDMCR4A",201,0)
 W $S(RDORGDT="NODATE":"NODATE",1:$$FMTE^XLFDT(RDORGDT,"9D")),U
"RTN","RCDMCR4A",202,0)
 W $P(BILLNO,"/",1),U
"RTN","RCDMCR4A",203,0)
 W "$",$FN(CHGAMT,",",2),U
"RTN","RCDMCR4A",204,0)
 I DISCHDT>OPTDT W $$FMTE^XLFDT(DISCHDT,"9D")
"RTN","RCDMCR4A",205,0)
 E  I OPTDT W $$FMTE^XLFDT(OPTDT,"9D")
"RTN","RCDMCR4A",206,0)
 W U
"RTN","RCDMCR4A",207,0)
 I RXDT W $$FMTE^XLFDT(RXDT,"9D")
"RTN","RCDMCR4A",208,0)
 W U
"RTN","RCDMCR4A",209,0)
 W RXNUM,U
"RTN","RCDMCR4A",210,0)
 W RXNAM,U
"RTN","RCDMCR4A",211,0)
 W STATUS
"RTN","RCDMCR4A",212,0)
 Q
"RTN","RCDMCR4A",213,0)
 ;
"RTN","RCDMCR4A",214,0)
CHKP(FOOTER) ;Check for End of Page
"RTN","RCDMCR4A",215,0)
 ;INPUT:
"RTN","RCDMCR4A",216,0)
 ;  FOOTER - Footer value. Optional. Default to 4 if nothing passed
"RTN","RCDMCR4A",217,0)
 I $G(FOOTER)'>0 S FOOTER=4
"RTN","RCDMCR4A",218,0)
 I $Y>(IOSL-FOOTER) D:RCSCR PAUSE^RCDMCUT2 Q:STOPIT  D HDR K SKIP
"RTN","RCDMCR4A",219,0)
 Q
"RTN","RCDMCR4A",220,0)
EXOUT(DATA) ; Format data so Excel won't mess it up.  
"RTN","RCDMCR4A",221,0)
 ; Note - there are other ways Excel mangles data, but they are not expected in this report
"RTN","RCDMCR4A",222,0)
 S DATA=$TR(DATA,"""","")
"RTN","RCDMCR4A",223,0)
 I DATA?1"0".N S DATA=""""_DATA_"""" Q DATA
"RTN","RCDMCR4A",224,0)
 I DATA["," S DATA=""""_DATA_""""
"RTN","RCDMCR4A",225,0)
 Q DATA
"RTN","RCDMCR4A",226,0)
 ;
"RTN","RCDMCR4A",227,0)
HDR ;Print Report Header
"RTN","RCDMCR4A",228,0)
 ; See WRLINE for header positions
"RTN","RCDMCR4A",229,0)
 I EXCEL>0 D  Q
"RTN","RCDMCR4A",230,0)
 . W !,"Veteran Name",U,"SSN",U,"Comb SC %"
"RTN","RCDMCR4A",231,0)
 . I RPTTYPE="S" Q
"RTN","RCDMCR4A",232,0)
 . W U,"VistA Chd Date",U,"RD Name",U,"Ext",U,"RD Orig Date",U,"Bill Number",U,"Charge Amount",U,"Medical Care Date",U,"RXFillDT",U,"RX #",U,"RX Name",U,"Status"
"RTN","RCDMCR4A",233,0)
 S RCPAGE=RCPAGE+1
"RTN","RCDMCR4A",234,0)
 W @IOF,"0-40 Percent SC Change Reconciliation ",$S(RPTTYPE="D":"Detailed",1:"Summary")," Report  -- Run Date: ",RUNDATE," --"
"RTN","RCDMCR4A",235,0)
 W ?122,"Page "_RCPAGE
"RTN","RCDMCR4A",236,0)
 W !?6,"RD Change Dates from ",$$FMTE^XLFDT(RCBEGDT,"9D")," to ",$$FMTE^XLFDT(RCENDDT,"9D")
"RTN","RCDMCR4A",237,0)
 W ?57,"VistA Change Dates from ",$$FMTE^XLFDT(VLSBEGDT,"9D")," to ",$$FMTE^XLFDT(VLSENDDT,"9D")
"RTN","RCDMCR4A",238,0)
 W !,?6,"Episode of Care Dates from ",$$FMTE^XLFDT(EOCBEGDT,"9D")," to ",$$FMTE^XLFDT(EOCENDDT,"9D")
"RTN","RCDMCR4A",239,0)
 W !
"RTN","RCDMCR4A",240,0)
 ;Print to screen or printer
"RTN","RCDMCR4A",241,0)
 I RPTTYPE="S" D
"RTN","RCDMCR4A",242,0)
 . W !,?40,"Comb"
"RTN","RCDMCR4A",243,0)
 . W !,?5,"Veteran Name",?30,"SSN",?40,"SC %"
"RTN","RCDMCR4A",244,0)
 I RPTTYPE="D" D
"RTN","RCDMCR4A",245,0)
 . W !,"                                                                                      Medical"
"RTN","RCDMCR4A",246,0)
 . W !,"                      Comb   VistA                  RD Orig                  Charge     Care"
"RTN","RCDMCR4A",247,0)
 . W !," Veteran Name    SSN  SC % Chd Date    RD Name  Ext  Date    Bill Number     Amount     Date RXFillDT   RX #   RX Name      Status"
"RTN","RCDMCR4A",248,0)
 D ULINE^RCDMCUT2("=",$G(IOM))
"RTN","RCDMCR4A",249,0)
 Q
"RTN","RCDMCR4A",250,0)
 ; Support Utility to find test cases.   Not a part of code executed by users, just by testers 
"RTN","RCDMCR4A",251,0)
 ; This utility is provided since currently there is no way to see data in file 390 anywhere except
"RTN","RCDMCR4A",252,0)
 ; RDEC report, and RDEC is not useful for testers
"RTN","RCDMCR4A",253,0)
 ; 
"RTN","RCDMCR4A",254,0)
 ; As a testers only code, it is not fully coded per usual standards
"RTN","RCDMCR4A",255,0)
RDINFO ;
"RTN","RCDMCR4A",256,0)
 N DR,D,DFN,ND,OCC,PN
"RTN","RCDMCR4A",257,0)
 K ^TMP($J)
"RTN","RCDMCR4A",258,0)
 S DFN=""
"RTN","RCDMCR4A",259,0)
 R !,"Patient Name or SSN: ",PN:99999 Q:PN="^"
"RTN","RCDMCR4A",260,0)
 I PN'="" D
"RTN","RCDMCR4A",261,0)
 . I PN?9N S DFN=$O(^DPT("SSN",PN,"")) I DFN Q
"RTN","RCDMCR4A",262,0)
 . I PN'?9N,$D(^DPT("B",PN)) S DFN=$O(^DPT("B",PN,"")) I DFN Q
"RTN","RCDMCR4A",263,0)
 . I PN'?9N,'DFN S PN=$O(^DPT("B",PN)),DFN=$O(^DPT("B",PN,"")) W !,"Patient ",PN
"RTN","RCDMCR4A",264,0)
 W ! S DR=$$DATE2^RCDMCUT2("    Enter the Date Range for Rated Disability Changes.")
"RTN","RCDMCR4A",265,0)
 I 'DR Q
"RTN","RCDMCR4A",266,0)
 D RDCHG^DGENRDUA(DFN,$P(DR,U,2),$P(DR,U,3))
"RTN","RCDMCR4A",267,0)
 S DFN="" F  S DFN=$O(^TMP($J,"RDCHG",DFN)) Q:DFN=""  D
"RTN","RCDMCR4A",268,0)
 . W !!,"Patient ",DFN," ",$P(^DPT(DFN,0),U)
"RTN","RCDMCR4A",269,0)
 . S D=$P($G(^DPT(DFN,.361)),U,2) W "  Vista Chg DT: " I D W $E(D,4,5),"/",$E(D,6,7),"/",$E(D,1,3)+1700
"RTN","RCDMCR4A",270,0)
 . W !,"  COMB SC%: ",$P($G(^DPT(DFN,.3)),U,2)
"RTN","RCDMCR4A",271,0)
 . S D=$P($G(^DPT(DFN,.3)),U,14)
"RTN","RCDMCR4A",272,0)
 . I D W " EFF. DATE: ",$E(D,4,5),"/",$E(D,6,7),"/",$E(D,1,3)+1700
"RTN","RCDMCR4A",273,0)
 . W !
"RTN","RCDMCR4A",274,0)
 . F OCC=1:1 S ND=$G(^TMP($J,"RDCHG",DFN,OCC)) Q:ND=""  D
"RTN","RCDMCR4A",275,0)
 . . S D=$P(ND,U)
"RTN","RCDMCR4A",276,0)
 . . W !,OCC,?5,"RD Change: " I D W $E(D,4,5),"/",$E(D,6,7),"/",$E(D,1,3)+1700
"RTN","RCDMCR4A",277,0)
 . . W "  RD Name: ",$E($P(ND,U,3),1,30)
"RTN","RCDMCR4A",278,0)
 . . W "  RD %: ",$P(ND,U,4)
"RTN","RCDMCR4A",279,0)
 . . W !,?5
"RTN","RCDMCR4A",280,0)
 . . W "  RD Extremity: ",$P(ND,U,6)
"RTN","RCDMCR4A",281,0)
 . . S D=$P(ND,U,7)
"RTN","RCDMCR4A",282,0)
 . . I D W "  RD Orig: ",$E(D,4,5),"/",$E(D,6,7),"/",$E(D,1,3)+1700
"RTN","RCDMCR4A",283,0)
 Q
"RTN","RCDMCR4B")
0^3^B61391663^n/a
"RTN","RCDMCR4B",1,0)
RCDMCR4B ;ALB/YG - 0 - 40 Percent SC Change Reconciliation Report - Collect Data; Apr 9, 2019@21:06
"RTN","RCDMCR4B",2,0)
 ;;4.5;Accounts Receivable;**347**;Mar 20, 1995;Build 47
"RTN","RCDMCR4B",3,0)
 ;;Per VA Directive 6402, this routine should not be modified.
"RTN","RCDMCR4B",4,0)
 ;
"RTN","RCDMCR4B",5,0)
 ; See RCDMCR4A for detailed description
"RTN","RCDMCR4B",6,0)
 ;
"RTN","RCDMCR4B",7,0)
COLLECT(STOPIT,RDBEGDT,RDENDDT,VLSBEGDT,VLSENDDT,EOCBEGDT,EOCENDDT,RPTTYPE) ; Get the report data
"RTN","RCDMCR4B",8,0)
 ;Input
"RTN","RCDMCR4B",9,0)
 ;   STOPIT - Passed Variable to determine if process is to be terminated
"RTN","RCDMCR4B",10,0)
 ;   BEGDT  - Beginning Date (in past) to get Episode of Care data for.
"RTN","RCDMCR4B",11,0)
 ;            (Required)
"RTN","RCDMCR4B",12,0)
 ;   RDBEGDT - Rated Disability Change Beginning date, (Required)
"RTN","RCDMCR4B",13,0)
 ;   RDENDDT - Rated Disability Change Ending Date, (Required)
"RTN","RCDMCR4B",14,0)
 ;   VLSBEGDT - Vista Last Status Date Beginning date, (Required)
"RTN","RCDMCR4B",15,0)
 ;   VLSENDDT - Vista Last Status Date Ending Date, (Required)
"RTN","RCDMCR4B",16,0)
 ;   EOCBEGDT - Episodes Of Care Beginning date, (Required)
"RTN","RCDMCR4B",17,0)
 ;   EOCENDDT - Episodes Of Care Ending Date, (Required)
"RTN","RCDMCR4B",18,0)
 ;   RPTTYPE - Report Type (Summary / Detailed)
"RTN","RCDMCR4B",19,0)
 ;Output
"RTN","RCDMCR4B",20,0)
 ;   STOPIT - Passed Variable set to 1 if process is to be terminated
"RTN","RCDMCR4B",21,0)
 ;   ^TMP($J,"RCDMCR4") with report data and summary data
"RTN","RCDMCR4B",22,0)
 N RCDFN,DEBTOR,ARIEN,IBIEN,CTR,IBCNT,EOCDT,DFN,DMCELIG,EFFDT,NAME,SSN,VLSDT,SCPER
"RTN","RCDMCR4B",23,0)
 N STATUS,OPTDT,DISCHDT,RXDT,OPTDT,RXDT,CHGAMT,OCC,BILLNO,RXNUM,RXNAM,DSTATUS,IBDATA
"RTN","RCDMCR4B",24,0)
 N VAERR,VADM,VAEL,VAIP
"RTN","RCDMCR4B",25,0)
 ;Quit if passed parameter variables not populated
"RTN","RCDMCR4B",26,0)
 I $G(EOCBEGDT)'>0,$G(EOCENDDT)'>0,$G(VLSBEGDT)'>0,$G(VLSENDDT)'>0,$G(RDBEGDT)'>0,$G(RDENDDT)'>0 Q
"RTN","RCDMCR4B",27,0)
 ;Get Rated Disability Data within passed RD change time frame
"RTN","RCDMCR4B",28,0)
 ;*** call API to get all RD change data for given date period
"RTN","RCDMCR4B",29,0)
 K ^TMP($J,"RDCHG")
"RTN","RCDMCR4B",30,0)
 D RDCHG^DGENRDUA("",RDBEGDT,RDENDDT)
"RTN","RCDMCR4B",31,0)
 S RCDFN=0
"RTN","RCDMCR4B",32,0)
 F  S RCDFN=$O(^TMP($J,"RDCHG",RCDFN)) Q:RCDFN'>0  D  Q:$G(STOPIT)>0
"RTN","RCDMCR4B",33,0)
 . ;Get AR Debtor info from file 340
"RTN","RCDMCR4B",34,0)
 . S DEBTOR=0
"RTN","RCDMCR4B",35,0)
 . F  S DEBTOR=$O(^RCD(340,"B",RCDFN_";DPT(",DEBTOR)) Q:DEBTOR'>0  D  Q:$G(STOPIT)>0
"RTN","RCDMCR4B",36,0)
 . . ;Quit if Veteran is SC 50% to 100% or Receiving VA Pension or A&A
"RTN","RCDMCR4B",37,0)
 . . S DFN=RCDFN
"RTN","RCDMCR4B",38,0)
 . . S DMCELIG=$$DMCELIG^RCDMCUT1(RCDFN)
"RTN","RCDMCR4B",39,0)
 . . Q:DMCELIG>0
"RTN","RCDMCR4B",40,0)
 . . ; From what I can see, these two dates are not obtainable from VADPT calls - YG
"RTN","RCDMCR4B",41,0)
 . . S VLSDT=$$GET1^DIQ(2,DFN_",",.3612,"I")
"RTN","RCDMCR4B",42,0)
 . . ; as per customer, we don't want people who have no VLSDT
"RTN","RCDMCR4B",43,0)
 . . I VLSDT="" Q
"RTN","RCDMCR4B",44,0)
 . . S EFFDT=$$GET1^DIQ(2,DFN_",",.3014,"I")
"RTN","RCDMCR4B",45,0)
 . . I $G(VLSDT)<VLSBEGDT Q
"RTN","RCDMCR4B",46,0)
 . . I $G(VLSDT)>VLSENDDT Q 
"RTN","RCDMCR4B",47,0)
 . . I DFN'>0 D KVAR^VADPT Q
"RTN","RCDMCR4B",48,0)
 . . D DEM^VADPT
"RTN","RCDMCR4B",49,0)
 . . I $G(VAERR)>0 D KVAR^VADPT Q
"RTN","RCDMCR4B",50,0)
 . . S NAME=$G(VADM(1))
"RTN","RCDMCR4B",51,0)
 . . I NAME']"" D KVAR^VADPT Q
"RTN","RCDMCR4B",52,0)
 . . S SSN=$P(VADM(2),U,1)
"RTN","RCDMCR4B",53,0)
 . . ;Get Eligibility Data
"RTN","RCDMCR4B",54,0)
 . . D ELIG^VADPT
"RTN","RCDMCR4B",55,0)
 . . I $G(VAERR)>0 D KVAR^VADPT Q
"RTN","RCDMCR4B",56,0)
 . . S SCPER=$P(VAEL(3),U,2)
"RTN","RCDMCR4B",57,0)
 . . D KVAR^VADPT
"RTN","RCDMCR4B",58,0)
 . . ;Get AR Bill Data that is within the last BEGDT time period
"RTN","RCDMCR4B",59,0)
 . . ;for Bills with a current status of ACTIVE, OPEN, SUSPENDED, WRITE-OFF, COLLECTED/CLOSED, CANCELLATION, or IB Status of ON-HOLD
"RTN","RCDMCR4B",60,0)
 . . K ^TMP($J,"RCDMCR4","ARIB")
"RTN","RCDMCR4B",61,0)
 . . S ARIEN=0
"RTN","RCDMCR4B",62,0)
 . . F  S ARIEN=$O(^PRCA(430,"C",DEBTOR,ARIEN)) Q:ARIEN'>0  D  Q:$G(STOPIT)>0
"RTN","RCDMCR4B",63,0)
 . . . K IBDATA S IBDATA=0
"RTN","RCDMCR4B",64,0)
 . . . S CTR=$G(CTR)+1 ;Counter
"RTN","RCDMCR4B",65,0)
 . . . I CTR#500=0 S STOPIT=$$STOPIT^RCDMCUT2() Q:STOPIT
"RTN","RCDMCR4B",66,0)
 . . . ; only look at 1st party bills 
"RTN","RCDMCR4B",67,0)
 . . . I '$$FIRSTPAR^RCDMCUT1(ARIEN) Q
"RTN","RCDMCR4B",68,0)
 . . . S BILLNO=$$GET1^DIQ(430,ARIEN_",",.01)
"RTN","RCDMCR4B",69,0)
 . . . I BILLNO']"" Q
"RTN","RCDMCR4B",70,0)
 . . . S STATUS=$$GET1^DIQ(430,ARIEN_",",8,"E")
"RTN","RCDMCR4B",71,0)
 . . . I "^ACTIVE^OPEN^SUSPENDED^WRITE-OFF^COLLECTED/CLOSED^CANCELLATION^"'[(U_STATUS_U) Q
"RTN","RCDMCR4B",72,0)
 . . . K IBDATA S IBDATA=0
"RTN","RCDMCR4B",73,0)
 . . . S IBIEN=""
"RTN","RCDMCR4B",74,0)
 . . . F  S IBIEN=$O(^IB("ABIL",BILLNO,IBIEN)) Q:'IBIEN  S OUT=$$GETIB(IBIEN,0) I OUT,$P(OUT,U,5)'=10 S IBDATA=IBDATA+1,IBDATA(IBDATA)=OUT
"RTN","RCDMCR4B",75,0)
 . . . I 'IBDATA Q
"RTN","RCDMCR4B",76,0)
 . . . M ^TMP($J,"RCDMCR4","ARIB",BILLNO,"IBDATA")=IBDATA
"RTN","RCDMCR4B",77,0)
 . . . S ^TMP($J,"RCDMCR4","ARIB",BILLNO,"STATUS")=STATUS
"RTN","RCDMCR4B",78,0)
 . . S IBIEN=""
"RTN","RCDMCR4B",79,0)
 . . F  S IBIEN=$O(^IB("AH",RCDFN,IBIEN)) Q:IBIEN=""  D  Q:$G(STOPIT)>0
"RTN","RCDMCR4B",80,0)
 . . . K IBDATA S IBDATA=0
"RTN","RCDMCR4B",81,0)
 . . . S CTR=$G(CTR)+1 ;Counter
"RTN","RCDMCR4B",82,0)
 . . . I CTR#500=0 S STOPIT=$$STOPIT^RCDMCUT2() Q:STOPIT
"RTN","RCDMCR4B",83,0)
 . . . S BILLNO="/"_IBIEN
"RTN","RCDMCR4B",84,0)
 . . . S OUT=$$GETIB(IBIEN,1) Q:'OUT  Q:$P(OUT,U,5)=10
"RTN","RCDMCR4B",85,0)
 . . . S IBDATA=1,IBDATA(1)=OUT
"RTN","RCDMCR4B",86,0)
 . . . M ^TMP($J,"RCDMCR4","ARIB",BILLNO,"IBDATA")=IBDATA
"RTN","RCDMCR4B",87,0)
 . . . S ^TMP($J,"RCDMCR4","ARIB",BILLNO,"STATUS")="ON HOLD"
"RTN","RCDMCR4B",88,0)
 . . S BILLNO=""
"RTN","RCDMCR4B",89,0)
 . . F  S BILLNO=$O(^TMP($J,"RCDMCR4","ARIB",BILLNO)) Q:BILLNO=""  D
"RTN","RCDMCR4B",90,0)
 . . . K IBDATA M IBDATA=^TMP($J,"RCDMCR4","ARIB",BILLNO,"IBDATA")
"RTN","RCDMCR4B",91,0)
 . . . S STATUS=^TMP($J,"RCDMCR4","ARIB",BILLNO,"STATUS")
"RTN","RCDMCR4B",92,0)
 . . . S OCC=0
"RTN","RCDMCR4B",93,0)
 . . . F  S OCC=$O(^TMP($J,"RDCHG",RCDFN,OCC)) Q:OCC'>0  D
"RTN","RCDMCR4B",94,0)
 . . . . N RDNODE,RDCHGDT,RDNAME,RDSEXTRE,RDORGDT
"RTN","RCDMCR4B",95,0)
 . . . . S RDNODE=$G(^TMP($J,"RDCHG",RCDFN,OCC))
"RTN","RCDMCR4B",96,0)
 . . . . S RDCHGDT=$P($P(RDNODE,U,1),".",1)
"RTN","RCDMCR4B",97,0)
 . . . . S RDNAME=$P(RDNODE,U,3)
"RTN","RCDMCR4B",98,0)
 . . . . S RDSEXTRE=$P(RDNODE,U,5)
"RTN","RCDMCR4B",99,0)
 . . . . S:RDSEXTRE']"" RDSEXTRE=" "
"RTN","RCDMCR4B",100,0)
 . . . . S RDORGDT=$P(RDNODE,U,7)
"RTN","RCDMCR4B",101,0)
 . . . . S EFFDT=RDORGDT
"RTN","RCDMCR4B",102,0)
 . . . . I RDNAME']"" Q
"RTN","RCDMCR4B",103,0)
 . . . . F IBCNT=1:1:IBDATA D
"RTN","RCDMCR4B",104,0)
 . . . . . ;IBDATA - Array of 1 ^ Outpatient Date ^ Discharge Date ^ RX/Refill Date ^ IB Status ^ RX NUM ^ RX Name ^ CHGAMT
"RTN","RCDMCR4B",105,0)
 . . . . . S OPTDT=$P(IBDATA(IBCNT),U,2)
"RTN","RCDMCR4B",106,0)
 . . . . . S DISCHDT=$P(IBDATA(IBCNT),U,3)
"RTN","RCDMCR4B",107,0)
 . . . . . S RXDT=$P(IBDATA(IBCNT),U,4)
"RTN","RCDMCR4B",108,0)
 . . . . . S RXNUM=$P(IBDATA(IBCNT),U,6)
"RTN","RCDMCR4B",109,0)
 . . . . . S RXNAM=$P(IBDATA(IBCNT),U,7)
"RTN","RCDMCR4B",110,0)
 . . . . . S CHGAMT=$P(IBDATA(IBCNT),U,8)
"RTN","RCDMCR4B",111,0)
 . . . . . S DSTATUS=STATUS
"RTN","RCDMCR4B",112,0)
 . . . . . ; Get EOC date and verify that it is later than Patient Effective Date
"RTN","RCDMCR4B",113,0)
 . . . . . S EOCDT=""
"RTN","RCDMCR4B",114,0)
 . . . . . I OPTDT>EOCDT S EOCDT=OPTDT
"RTN","RCDMCR4B",115,0)
 . . . . . I DISCHDT>EOCDT S EOCDT=DISCHDT
"RTN","RCDMCR4B",116,0)
 . . . . . I RXDT>EOCDT S EOCDT=RXDT
"RTN","RCDMCR4B",117,0)
 . . . . . I EFFDT,EOCDT'>EFFDT Q
"RTN","RCDMCR4B",118,0)
 . . . . . ;Skip is current EOC date for IB (OPTDT, DISCHDT or RXDT) is not within EOC date range
"RTN","RCDMCR4B",119,0)
 . . . . . I EOCDT<EOCBEGDT Q
"RTN","RCDMCR4B",120,0)
 . . . . . I EOCDT>EOCENDDT Q
"RTN","RCDMCR4B",121,0)
 . . . . . ; TBD
"RTN","RCDMCR4B",122,0)
 . . . . . I EFFDT="" S ^TMP($J,"RCDMCR4","DETAIL",NAME,SSN," ",RDNAME,RDSEXTRE," ",1)="NODATE"_U_U_U_U_U_SCPER_U_VLSDT Q
"RTN","RCDMCR4B",123,0)
 . . . . . S DSTATUS=$S(DSTATUS="CANCELLATION":"ARCXLD",DSTATUS="COLLECTED/CLOSED":"C/C",1:DSTATUS)
"RTN","RCDMCR4B",124,0)
 . . . . . S ^TMP($J,"RCDMCR4","DETAIL",NAME,SSN,RDCHGDT,RDNAME,RDSEXTRE,BILLNO,IBCNT)=RDORGDT_U_RXDT_U_OPTDT_U_DISCHDT_U_DSTATUS_U_SCPER_U_VLSDT_U_CHGAMT_U_RXNUM_U_RXNAM
"RTN","RCDMCR4B",125,0)
 . . . . . S ^TMP($J,"RCDMCR4","SUMMARY",NAME,SSN)=SCPER
"RTN","RCDMCR4B",126,0)
 K ^TMP($J,"RDCHG")
"RTN","RCDMCR4B",127,0)
 K ^TMP($J,"RCDMCR4","ARIB")
"RTN","RCDMCR4B",128,0)
 Q
"RTN","RCDMCR4B",129,0)
 ;
"RTN","RCDMCR4B",130,0)
GETIB(IBIEN,IBMODE) ; Get all Outpatient Dates, Inpatient Dates and RX Dates/drugs
"RTN","RCDMCR4B",131,0)
 ; Input:
"RTN","RCDMCR4B",132,0)
 ;  IBIEN - IEN of IB entry (File 350, ^IB)
"RTN","RCDMCR4B",133,0)
 ;  IBMODE - 0 if we are in AR mode, 1 if we are in IB mode.
"RTN","RCDMCR4B",134,0)
 ; Output:
"RTN","RCDMCR4B",135,0)
 ;  0 if we don't get anything out of this IB
"RTN","RCDMCR4B",136,0)
 ;  Othewise 1 ^ Outpatient Date ^ Discharge Date ^ RX/Refill Date ^ IB Status ^ RX NUM ^ RX Name ^ CHGAMT
"RTN","RCDMCR4B",137,0)
 N IBDET,IENS,ACTTYPE,RESULT,DTBILLFR,BILGROUP,OPDT,DISCHARG,RXDT,STATUS,OUT,I0,PARENT,PARENTOK,DFN
"RTN","RCDMCR4B",138,0)
 S OUT=0
"RTN","RCDMCR4B",139,0)
 S I0=$G(^IB(IBIEN,0))
"RTN","RCDMCR4B",140,0)
 S DFN=$P(I0,U,2)
"RTN","RCDMCR4B",141,0)
 I 'DFN Q OUT
"RTN","RCDMCR4B",142,0)
 S ACTTYPE=$P(I0,U,3)
"RTN","RCDMCR4B",143,0)
 S DTBILLFR=$P(I0,U,14)
"RTN","RCDMCR4B",144,0)
 S STATUS=$P(I0,U,5)
"RTN","RCDMCR4B",145,0)
 S PARENT=$$PARENTC^RCDMCR5B(IBIEN),CHGAMT=$P($G(^IB(PARENT,0)),U,7)
"RTN","RCDMCR4B",146,0)
 ;S CHGAMT=$$GET1^DIQ(350,$$PARENTC^RCDMCR5B(IBIEN)_",",.07,"I")
"RTN","RCDMCR4B",147,0)
 ; only take parents if running in AR mode?
"RTN","RCDMCR4B",148,0)
 S PARENT=$$PARENTE^RCDMCR5B(IBIEN)
"RTN","RCDMCR4B",149,0)
 I +$G(IBMODE)=0 S PARENTOK=0 D  I 'PARENTOK Q OUT
"RTN","RCDMCR4B",150,0)
 . I IBIEN=PARENT S PARENTOK=1 Q
"RTN","RCDMCR4B",151,0)
 . I $P(I0,U,11),$P(I0,U,11)'=$P(^IB(PARENT,0),U,11) S PARENTOK=1 ; it is OK to take a child IB if parent is not part of same bill.
"RTN","RCDMCR4B",152,0)
 S RESULT=$P(^IB(PARENT,0),U,4)
"RTN","RCDMCR4B",153,0)
 ;Quit if RESULTING FROM field is blank
"RTN","RCDMCR4B",154,0)
 Q:RESULT="" OUT
"RTN","RCDMCR4B",155,0)
 ;Get Billing Group in the IB Action Type File. If internal Set 
"RTN","RCDMCR4B",156,0)
 ;Code value is 4, then this is an Outpatient Visit (From STMT^IBRFN1)
"RTN","RCDMCR4B",157,0)
 ;and can use Date Billed From for the Outpatient Visit Date
"RTN","RCDMCR4B",158,0)
 S BILGROUP=$P($G(^IBE(350.1,+ACTTYPE,0)),U,11)
"RTN","RCDMCR4B",159,0)
 ;Outpatient Event
"RTN","RCDMCR4B",160,0)
 I BILGROUP=4!($P(RESULT,":",1)=44)!($P(RESULT,":",1)=409.68) D
"RTN","RCDMCR4B",161,0)
 . I $P(RESULT,":",1)=44 S OPDT=$P($P(RESULT,";",2),":",2)
"RTN","RCDMCR4B",162,0)
 . I $P(RESULT,":",1)=409.68 S OPDT=$P($G(^SCE(+$P(RESULT,":",2),0)),U)
"RTN","RCDMCR4B",163,0)
 . I $G(OPDT)'>0 S OPDT=DTBILLFR
"RTN","RCDMCR4B",164,0)
 . I OPDT S OUT=1_U_OPDT
"RTN","RCDMCR4B",165,0)
 ;Inpatient Event
"RTN","RCDMCR4B",166,0)
 I $P(RESULT,":",1)=405!($P(RESULT,":",1)=45) D
"RTN","RCDMCR4B",167,0)
 . D KVAR^VADPT
"RTN","RCDMCR4B",168,0)
 . S VAIP("E")=$P($P(RESULT,";",1),":",2)
"RTN","RCDMCR4B",169,0)
 . ;Call to get Inpatient data
"RTN","RCDMCR4B",170,0)
 . D IN5^VADPT
"RTN","RCDMCR4B",171,0)
 . I VAERR>0 D KVAR^VADPT Q
"RTN","RCDMCR4B",172,0)
 . S DISCHARG=$P($G(VAIP(17,1)),U,1)
"RTN","RCDMCR4B",173,0)
 . I DISCHARG S OUT=1_U_U_DISCHARG
"RTN","RCDMCR4B",174,0)
 . D KVAR^VADPT
"RTN","RCDMCR4B",175,0)
 ;RX Event
"RTN","RCDMCR4B",176,0)
 I $P(RESULT,":",1)=52 D
"RTN","RCDMCR4B",177,0)
 . ;Set up for RX Refills
"RTN","RCDMCR4B",178,0)
 . I $P(RESULT,";",2)]"" D
"RTN","RCDMCR4B",179,0)
 . . N RXIEN,RXFIEN
"RTN","RCDMCR4B",180,0)
 . . S RXFIEN=$P($P(RESULT,";",2),":",2),RXIEN=$P($P(RESULT,";",1),":",2)
"RTN","RCDMCR4B",181,0)
 . . S RXDT=$P($G(^PSRX(RXIEN,1,RXFIEN,0)),U,18) ; released data
"RTN","RCDMCR4B",182,0)
 . . S:RXDT="" RXDT=$P($G(^PSRX(RXIEN,1,RXFIEN,0)),U) ; refill date
"RTN","RCDMCR4B",183,0)
 . . S RXNUM=$P($G(^PSRX(RXIEN,0)),U)
"RTN","RCDMCR4B",184,0)
 . . S RXNAM=$P($G(^PSRX(RXIEN,0)),U,6) S:RXNAM RXNAM=$P($G(^PSDRUG(RXNAM,0)),U)
"RTN","RCDMCR4B",185,0)
 . . I RXDT S OUT=1_U_U_U_RXDT_U_U_RXNUM_U_RXNAM
"RTN","RCDMCR4B",186,0)
 . ;Set up for RX Data (No refill)
"RTN","RCDMCR4B",187,0)
 . I $P(RESULT,";",2)']"" D
"RTN","RCDMCR4B",188,0)
 . . N RXIEN
"RTN","RCDMCR4B",189,0)
 . . S RXIEN=$P(RESULT,":",2)
"RTN","RCDMCR4B",190,0)
 . . S RXDT=$P($G(^PSRX(RXIEN,2)),U,13) ; released date
"RTN","RCDMCR4B",191,0)
 . . S:RXDT="" RXDT=$P($G(^PSRX(RXIEN,2)),U,2) ; fill date
"RTN","RCDMCR4B",192,0)
 . . S:RXDT="" RXDT=$P($G(^PSRX(RXIEN,2)),U,5) ; dispensed date
"RTN","RCDMCR4B",193,0)
 . . S RXNUM=$P($G(^PSRX(RXIEN,0)),U)
"RTN","RCDMCR4B",194,0)
 . . S RXNAM=$P($G(^PSRX(RXIEN,0)),U,6) S:RXNAM RXNAM=$P($G(^PSDRUG(RXNAM,0)),U)
"RTN","RCDMCR4B",195,0)
 . . I RXDT S OUT=1_U_U_U_RXDT_U_U_RXNUM_U_RXNAM
"RTN","RCDMCR4B",196,0)
 I 'OUT Q OUT
"RTN","RCDMCR4B",197,0)
 S $P(OUT,U,5)=STATUS
"RTN","RCDMCR4B",198,0)
 S $P(OUT,U,8)=CHGAMT
"RTN","RCDMCR4B",199,0)
 Q OUT
"RTN","RCDMCR5A")
0^6^B35467262^n/a
"RTN","RCDMCR5A",1,0)
RCDMCR5A ;ALB/YG - First Party Charge IB Cancellation Reconciliation Report - Input/output; Apr 9, 2019@21:06
"RTN","RCDMCR5A",2,0)
 ;;4.5;Accounts Receivable;**347**;Mar 20, 1995;Build 47
"RTN","RCDMCR5A",3,0)
 ;;Per VA Directive 6402, this routine should not be modified.
"RTN","RCDMCR5A",4,0)
 ;
"RTN","RCDMCR5A",5,0)
 ;This routine is being implemented for the AR Cross-Referencing Project
"RTN","RCDMCR5A",6,0)
 ;
"RTN","RCDMCR5A",7,0)
 ;This report will assist users in reviewing first party charges receiving
"RTN","RCDMCR5A",8,0)
 ;Integrated Billing (IB) cancellation for potential refund activities or charge
"RTN","RCDMCR5A",9,0)
 ;cancellation accuracy, and to identify and monitor cancellation activity
"RTN","RCDMCR5A",10,0)
 ;productivity so veteran customers can receive refunds due to them for
"RTN","RCDMCR5A",11,0)
 ;retroactive eligibility exemptions.  The report provides data for first party
"RTN","RCDMCR5A",12,0)
 ;charges receiving IB cancellation for a user defined bill cancellation 
"RTN","RCDMCR5A",13,0)
 ;date range.
"RTN","RCDMCR5A",14,0)
MAIN ; Initial Interactive Processing
"RTN","RCDMCR5A",15,0)
 N STOPIT,EXCEL,CANDATE,CANBEGDT,CANENDDT,BILLPAYS,RCSCR
"RTN","RCDMCR5A",16,0)
 W !!,"*** Print the First Party Charge IB Cancellation Reconciliation Report ***",!
"RTN","RCDMCR5A",17,0)
 S STOPIT=0 ; quit flag
"RTN","RCDMCR5A",18,0)
 ;Prompt user for Date Range for Bill Cancellation date range
"RTN","RCDMCR5A",19,0)
 S CANDATE=$$DATE2^RCDMCUT2("    Enter the Bill Cancellation Date Range: ")
"RTN","RCDMCR5A",20,0)
 ;Quit is user up arrowed or timed out
"RTN","RCDMCR5A",21,0)
 Q:CANDATE'>0
"RTN","RCDMCR5A",22,0)
 S CANBEGDT=$P(CANDATE,U,2),CANENDDT=$P(CANDATE,U,3)
"RTN","RCDMCR5A",23,0)
 ; Prompt user for Bills with Payments
"RTN","RCDMCR5A",24,0)
 S BILLPAYS=$$BILLPAYS^RCDMCUT2
"RTN","RCDMCR5A",25,0)
 Q:BILLPAYS="^"
"RTN","RCDMCR5A",26,0)
 ; Prompt user if report will be Excel Delimited format:
"RTN","RCDMCR5A",27,0)
 S EXCEL=$$EXCEL^RCDMCUT2
"RTN","RCDMCR5A",28,0)
 ;Quit is user up arrowed or timed out
"RTN","RCDMCR5A",29,0)
 Q:EXCEL="^"
"RTN","RCDMCR5A",30,0)
 D:EXCEL>0 EXMSG^RCDMCUT2
"RTN","RCDMCR5A",31,0)
 D:EXCEL'>0
"RTN","RCDMCR5A",32,0)
 . W !!,"This report may take a while to process. It is recommended that"
"RTN","RCDMCR5A",33,0)
 . W !,"you Queue this report to a device that is 132 characters wide."
"RTN","RCDMCR5A",34,0)
 ; Logic from DEVICE^RCDMCUT2 copied here
"RTN","RCDMCR5A",35,0)
 N %ZIS,ZTRTN,ZTIO,ZTSAVE,ZTDESK,ZTSK,POP,ZTDESC
"RTN","RCDMCR5A",36,0)
 S %ZIS="QM"
"RTN","RCDMCR5A",37,0)
 W ! D ^%ZIS
"RTN","RCDMCR5A",38,0)
 I POP Q
"RTN","RCDMCR5A",39,0)
 S RCSCR=$S($E($G(IOST),1,2)="C-":1,1:0)
"RTN","RCDMCR5A",40,0)
 ;
"RTN","RCDMCR5A",41,0)
 I $D(IO("Q")) D  S STOPIT=1
"RTN","RCDMCR5A",42,0)
 . S ZTRTN="RUN^RCDMCR5A"
"RTN","RCDMCR5A",43,0)
 . S ZTIO=ION
"RTN","RCDMCR5A",44,0)
 . S ZTSAVE("RCSCR")=""
"RTN","RCDMCR5A",45,0)
 . S ZTSAVE("CANBEGDT")=""
"RTN","RCDMCR5A",46,0)
 . S ZTSAVE("CANENDDT")=""
"RTN","RCDMCR5A",47,0)
 . S ZTSAVE("BILLPAYS")=""
"RTN","RCDMCR5A",48,0)
 . S ZTSAVE("EXCEL")=""
"RTN","RCDMCR5A",49,0)
 . S ZTDESC="DMC 0-40 Percent SC Change Reconciliation Report Process"
"RTN","RCDMCR5A",50,0)
 . D ^%ZTLOAD
"RTN","RCDMCR5A",51,0)
 . W !!,$S($D(ZTSK):"Request Queued.  TASK = "_ZTSK,1:"REQUEST CANCELLED")
"RTN","RCDMCR5A",52,0)
 . D HOME^%ZIS
"RTN","RCDMCR5A",53,0)
 ;
"RTN","RCDMCR5A",54,0)
 Q:STOPIT>0!($D(ZTQUEUED))
"RTN","RCDMCR5A",55,0)
 D RUN^RCDMCR5A
"RTN","RCDMCR5A",56,0)
 I 'STOPIT D PAUSE2^RCDMCUT2
"RTN","RCDMCR5A",57,0)
 Q
"RTN","RCDMCR5A",58,0)
 ; Currently, Taskman schedulable option is not being planned for this report
"RTN","RCDMCR5A",59,0)
 ; If this is going to change later on, QUERPT^RCDMCR3A would be a good example
"RTN","RCDMCR5A",60,0)
 ; of how to do such an option
"RTN","RCDMCR5A",61,0)
QUERPT ; Initial Taskman Scheduled Queued processing
"RTN","RCDMCR5A",62,0)
 Q
"RTN","RCDMCR5A",63,0)
 ;
"RTN","RCDMCR5A",64,0)
RUN ;Get data and Print it out
"RTN","RCDMCR5A",65,0)
 ;If queued ensure you delete it from the TASKS file
"RTN","RCDMCR5A",66,0)
 I $D(ZTQUEUED) S ZTREQ="@"
"RTN","RCDMCR5A",67,0)
 N RCPAGE
"RTN","RCDMCR5A",68,0)
 S STOPIT=0
"RTN","RCDMCR5A",69,0)
 K ^TMP($J,"RCDMCR5")
"RTN","RCDMCR5A",70,0)
 S RCPAGE=0
"RTN","RCDMCR5A",71,0)
 ; Collect the data in ^TMP
"RTN","RCDMCR5A",72,0)
 D COLLECT^RCDMCR5B(.STOPIT,CANBEGDT,CANENDDT,BILLPAYS)
"RTN","RCDMCR5A",73,0)
 Q:$G(STOPIT)>0
"RTN","RCDMCR5A",74,0)
 U IO
"RTN","RCDMCR5A",75,0)
 ; Print Report using data in ^TMP
"RTN","RCDMCR5A",76,0)
 D REPORT
"RTN","RCDMCR5A",77,0)
 I 'RCSCR W !,@IOF
"RTN","RCDMCR5A",78,0)
 D ^%ZISC
"RTN","RCDMCR5A",79,0)
 K ^TMP($J,"RCDMCR5")
"RTN","RCDMCR5A",80,0)
 K EXCEL,RCSCR
"RTN","RCDMCR5A",81,0)
 Q
"RTN","RCDMCR5A",82,0)
 ;
"RTN","RCDMCR5A",83,0)
REPORT ;Print report
"RTN","RCDMCR5A",84,0)
 N RUNDATE,NAME,SSN,BILLNO,IBIEN,SKIP
"RTN","RCDMCR5A",85,0)
 ;
"RTN","RCDMCR5A",86,0)
 S RUNDATE=$$FMTE^XLFDT($$NOW^XLFDT,"9MP")
"RTN","RCDMCR5A",87,0)
 D HDR
"RTN","RCDMCR5A",88,0)
 I +$D(^TMP($J,"RCDMCR5"))'>0 W !,"No data meets the criteria." Q
"RTN","RCDMCR5A",89,0)
 K SKIP
"RTN","RCDMCR5A",90,0)
 S NAME=""
"RTN","RCDMCR5A",91,0)
 F  S NAME=$O(^TMP($J,"RCDMCR5","DETAIL",NAME)) Q:NAME']""  D  Q:STOPIT
"RTN","RCDMCR5A",92,0)
 . S SSN=""
"RTN","RCDMCR5A",93,0)
 . F  S SSN=$O(^TMP($J,"RCDMCR5","DETAIL",NAME,SSN)) Q:SSN']""  D  Q:STOPIT
"RTN","RCDMCR5A",94,0)
 . . S BILLNO=""
"RTN","RCDMCR5A",95,0)
 . . F  S BILLNO=$O(^TMP($J,"RCDMCR5","DETAIL",NAME,SSN,BILLNO)) Q:BILLNO']""  D  Q:STOPIT
"RTN","RCDMCR5A",96,0)
 . . . S IBIEN=""
"RTN","RCDMCR5A",97,0)
 . . . F  S IBIEN=$O(^TMP($J,"RCDMCR5","DETAIL",NAME,SSN,BILLNO,IBIEN)) Q:IBIEN']""  D  Q:STOPIT
"RTN","RCDMCR5A",98,0)
 . . . . N NODE,CHGAMT,SERVDT,RXDT,RXNUM,RXNAM,CANCDT,CANCREAS,CANCUSER
"RTN","RCDMCR5A",99,0)
 . . . . ; S ^TMP($J,"RCDMCR5","DETAIL",NAME,SSN,BILLNO,IBIEN)=SERVDT_U_RXDT_U_CHGAMT_U_RXNUM_U_RXNAM_U_CANCDT_U_CANCREAS_U_CANCUSER
"RTN","RCDMCR5A",100,0)
 . . . . S NODE=$G(^TMP($J,"RCDMCR5","DETAIL",NAME,SSN,BILLNO,IBIEN))
"RTN","RCDMCR5A",101,0)
 . . . . S SERVDT=$P(NODE,U,1)
"RTN","RCDMCR5A",102,0)
 . . . . S RXDT=$P(NODE,U,2)
"RTN","RCDMCR5A",103,0)
 . . . . S CHGAMT=$P(NODE,U,3)
"RTN","RCDMCR5A",104,0)
 . . . . S RXNUM=$P(NODE,U,4)
"RTN","RCDMCR5A",105,0)
 . . . . S RXNAM=$P(NODE,U,5)
"RTN","RCDMCR5A",106,0)
 . . . . S CANCDT=$P(NODE,U,6)
"RTN","RCDMCR5A",107,0)
 . . . . S CANCREAS=$P(NODE,U,7)
"RTN","RCDMCR5A",108,0)
 . . . . S CANCUSER=$P(NODE,U,8)
"RTN","RCDMCR5A",109,0)
 . . . . I EXCEL'>0 D WRLINE Q
"RTN","RCDMCR5A",110,0)
 . . . . I EXCEL>0 D WRLINE2 Q
"RTN","RCDMCR5A",111,0)
 Q
"RTN","RCDMCR5A",112,0)
 ;
"RTN","RCDMCR5A",113,0)
WRLINE ; Write the data formated report line
"RTN","RCDMCR5A",114,0)
 ;If Multiple Bills for Vet only print Name & SSN for 1st record on page
"RTN","RCDMCR5A",115,0)
 ;
"RTN","RCDMCR5A",116,0)
 ; Columns are - position, width, spacing (offset header by)
"RTN","RCDMCR5A",117,0)
 ; Veteran Name - 0, 13, 1 (offset 1)
"RTN","RCDMCR5A",118,0)
 ; SSN - 14, 10, 1 (offset 3)
"RTN","RCDMCR5A",119,0)
 ; Bill Number - 25, 11, 1 (offset 1)
"RTN","RCDMCR5A",120,0)
 ; Charge/Amount - 37, 11, 1 (offset 3,3)
"RTN","RCDMCR5A",121,0)
 ; Medical/Care Date - 49, 8, 1 (offset 1, 0)
"RTN","RCDMCR5A",122,0)
 ; RXFillDT - 58, 9, 1 (offset 0)
"RTN","RCDMCR5A",123,0)
 ; RX # - 68,9,1 (offset 3)
"RTN","RCDMCR5A",124,0)
 ; RX Name - 78,14,1 (offset 3)
"RTN","RCDMCR5A",125,0)
 ; IBCXLDT - 93,7,1 (offset 0)
"RTN","RCDMCR5A",126,0)
 ; IB Cancellation/Reason - 101, 16, 1 (Offset 0, 6)
"RTN","RCDMCR5A",127,0)
 ; Cancelled By - 118, 14 (offset 1)
"RTN","RCDMCR5A",128,0)
 D CHKP() Q:STOPIT
"RTN","RCDMCR5A",129,0)
 ; Disable Skips for now per direction of customer with :0
"RTN","RCDMCR5A",130,0)
 W !
"RTN","RCDMCR5A",131,0)
 I (NAME_SSN)'=$G(SKIP(1)) D
"RTN","RCDMCR5A",132,0)
 . W $E(NAME,1,13) ; Veteran Name
"RTN","RCDMCR5A",133,0)
 . W ?14,SSN ; SSN
"RTN","RCDMCR5A",134,0)
 . S:0 SKIP(1)=NAME_SSN
"RTN","RCDMCR5A",135,0)
 W ?25,BILLNO ; Bill Number
"RTN","RCDMCR5A",136,0)
 W ?37,$J("$"_$FN(CHGAMT,",",2),11)
"RTN","RCDMCR5A",137,0)
 W:SERVDT>0 ?49,$$STRIP^XLFSTR($$FMTE^XLFDT(SERVDT,"8D")," ")
"RTN","RCDMCR5A",138,0)
 W:RXDT>0 ?58,$$STRIP^XLFSTR($$FMTE^XLFDT(RXDT,"8D")," ") ; Med Fill Date
"RTN","RCDMCR5A",139,0)
 W ?68,RXNUM ; RX # 
"RTN","RCDMCR5A",140,0)
 W ?78,$E(RXNAM,1,14) ; RX Name
"RTN","RCDMCR5A",141,0)
 W ?93,$$STRIP^XLFSTR($$FMTE^XLFDT(CANCDT,"8D")," ")
"RTN","RCDMCR5A",142,0)
 W ?101,$E(CANCREAS,1,16)
"RTN","RCDMCR5A",143,0)
 W ?118,$E(CANCUSER,1,14)
"RTN","RCDMCR5A",144,0)
 Q
"RTN","RCDMCR5A",145,0)
 ;
"RTN","RCDMCR5A",146,0)
WRLINE2 ; Write the Excel report line
"RTN","RCDMCR5A",147,0)
 W !
"RTN","RCDMCR5A",148,0)
 W $$EXOUT^RCDMCR4A(NAME),U
"RTN","RCDMCR5A",149,0)
 W $$EXOUT^RCDMCR4A(SSN),U
"RTN","RCDMCR5A",150,0)
 W BILLNO,U
"RTN","RCDMCR5A",151,0)
 W "$",$FN(CHGAMT,",",2),U
"RTN","RCDMCR5A",152,0)
 W $$FMTE^XLFDT(SERVDT,"9D")
"RTN","RCDMCR5A",153,0)
 W U
"RTN","RCDMCR5A",154,0)
 I RXDT W $$FMTE^XLFDT(RXDT,"9D")
"RTN","RCDMCR5A",155,0)
 W U
"RTN","RCDMCR5A",156,0)
 W RXNUM,U
"RTN","RCDMCR5A",157,0)
 W RXNAM,U
"RTN","RCDMCR5A",158,0)
 W $$FMTE^XLFDT(CANCDT,"9D"),U
"RTN","RCDMCR5A",159,0)
 W CANCREAS,U
"RTN","RCDMCR5A",160,0)
 W $$EXOUT^RCDMCR4A(CANCUSER)
"RTN","RCDMCR5A",161,0)
 Q
"RTN","RCDMCR5A",162,0)
 ;
"RTN","RCDMCR5A",163,0)
CHKP(FOOTER) ;Check for End of Page
"RTN","RCDMCR5A",164,0)
 ;INPUT:
"RTN","RCDMCR5A",165,0)
 ;  FOOTER - Footer value. Optional. Default to 4 if nothing passed
"RTN","RCDMCR5A",166,0)
 I $G(FOOTER)'>0 S FOOTER=4
"RTN","RCDMCR5A",167,0)
 I $Y>(IOSL-FOOTER) D:RCSCR PAUSE^RCDMCUT2 Q:STOPIT  D HDR
"RTN","RCDMCR5A",168,0)
 Q
"RTN","RCDMCR5A",169,0)
 ;
"RTN","RCDMCR5A",170,0)
HDR ;Print Report Header
"RTN","RCDMCR5A",171,0)
 ;RUNDATE - Current Date in human readable format
"RTN","RCDMCR5A",172,0)
 I EXCEL>0 D  Q
"RTN","RCDMCR5A",173,0)
 . W !,"Veteran Name",U,"SSN",U,"Bill Number",U,"Charge Amount",U,"Medical Care Date",U,"RXFillDT",U
"RTN","RCDMCR5A",174,0)
 . W "RX #",U,"RX Name",U,"IBCXLDT",U,"IB Cancellation Reason",U,"Cancelled By"
"RTN","RCDMCR5A",175,0)
 S RCPAGE=RCPAGE+1 K SKIP
"RTN","RCDMCR5A",176,0)
 W @IOF,"First Party Charge IB Cancellation Reconciliation Report  -- Run Date: ",RUNDATE," --"
"RTN","RCDMCR5A",177,0)
 W ?122,"Page "_RCPAGE
"RTN","RCDMCR5A",178,0)
 W !?6,"Cancellation Dates from ",$$FMTE^XLFDT(CANBEGDT,"9D")," to ",$$FMTE^XLFDT(CANENDDT,"9D")
"RTN","RCDMCR5A",179,0)
 W !
"RTN","RCDMCR5A",180,0)
 ;Print to screen or printer
"RTN","RCDMCR5A",181,0)
 W !,?39,"Charge",?49,"Medical",?101,"IB Cancellation"
"RTN","RCDMCR5A",182,0)
 W !," Veteran Name",?17,"SSN",?25,"Bill Number",?40,"Amount",?48,"Care Date",?58,"RXFillDT",?71,"RX #",?81,"RX Name",?93,"IBCXLDT",?107,"Reason",?119,"Cancelled By"
"RTN","RCDMCR5A",183,0)
 D ULINE^RCDMCUT2("=",$G(IOM))
"RTN","RCDMCR5A",184,0)
 Q
"RTN","RCDMCR5B")
0^7^B25961483^n/a
"RTN","RCDMCR5B",1,0)
RCDMCR5B ;ALB/YG - First Party Charge IB Cancellation Reconciliation Report - Collect Data; Apr 9, 2019@21:06
"RTN","RCDMCR5B",2,0)
 ;;4.5;Accounts Receivable;**347**;Mar 20, 1995;Build 47
"RTN","RCDMCR5B",3,0)
 ;;Per VA Directive 6402, this routine should not be modified.
"RTN","RCDMCR5B",4,0)
 ;
"RTN","RCDMCR5B",5,0)
 ; See RCDMCR5A for detailed description
"RTN","RCDMCR5B",6,0)
 ;
"RTN","RCDMCR5B",7,0)
COLLECT(STOPIT,CANBEGDT,CANENDDT,BILLPAYS) ; Get the report data
"RTN","RCDMCR5B",8,0)
 ;Input
"RTN","RCDMCR5B",9,0)
 ;   STOPIT - Passed Variable to determine if process is to be terminated
"RTN","RCDMCR5B",10,0)
 ;   CANBEGDT - Cancellation Begin Date
"RTN","RCDMCR5B",11,0)
 ;   CANENDDT - Cancellation End Date
"RTN","RCDMCR5B",12,0)
 ;Output
"RTN","RCDMCR5B",13,0)
 ;   STOPIT - Passed Variable set to 1 if process is to be terminated
"RTN","RCDMCR5B",14,0)
 ;   ^TMP($J,"RCDMCR5") with report data and summary data
"RTN","RCDMCR5B",15,0)
 N DFN,IBIEN,IB0,IB1,CTR,ARIEN,ACTTYPE,BILGROUP,RESULT,IBDATA
"RTN","RCDMCR5B",16,0)
 N SERVDT,RXDT,NAME,SSN,RXDT,CHGAMT,BILLFRDT,PAID,TRIEN
"RTN","RCDMCR5B",17,0)
 N BILLNO,RXNUM,RXNAM,CANCDT,CANCUSER,CANCREAS,PARENTE
"RTN","RCDMCR5B",18,0)
 N VAERR,VADM,VAIP
"RTN","RCDMCR5B",19,0)
 ;Quit if passed parameter variables not populated
"RTN","RCDMCR5B",20,0)
 I $G(CANBEGDT)'>0,$G(CANENDDT)'>0 Q
"RTN","RCDMCR5B",21,0)
 S CANCDT=CANBEGDT-.000001
"RTN","RCDMCR5B",22,0)
 F  S CANCDT=$O(^IB("D",CANCDT)) Q:CANCDT=""  Q:CANCDT>(CANENDDT+1)  D  Q:$G(STOPIT)>0
"RTN","RCDMCR5B",23,0)
 . S IBIEN=""
"RTN","RCDMCR5B",24,0)
 . F  S IBIEN=$O(^IB("D",CANCDT,IBIEN)) Q:IBIEN=""  D  Q:$G(STOPIT)>0
"RTN","RCDMCR5B",25,0)
 . . S IB0=$G(^IB(IBIEN,0)),IB1=$G(^IB(IBIEN,1))
"RTN","RCDMCR5B",26,0)
 . . S ACTTYPE=$P(IB0,U,3)
"RTN","RCDMCR5B",27,0)
 . . I ACTTYPE="" Q
"RTN","RCDMCR5B",28,0)
 . . ; SEQUENCE NUMBER (file 350.1, field .05) of 2 is CANCEL
"RTN","RCDMCR5B",29,0)
 . . I $P($G(^IBE(350.1,ACTTYPE,0)),U,5)'=2 Q
"RTN","RCDMCR5B",30,0)
 . . S DFN=$P(IB0,U,2)
"RTN","RCDMCR5B",31,0)
 . . S CTR=$G(CTR)+1 ;Counter
"RTN","RCDMCR5B",32,0)
 . . I CTR#500=0 S STOPIT=$$STOPIT^RCDMCUT2() Q:STOPIT
"RTN","RCDMCR5B",33,0)
 . . S BILLNO=$P(IB0,U,11)
"RTN","RCDMCR5B",34,0)
 . . I BILLNO="" Q
"RTN","RCDMCR5B",35,0)
 . . S ARIEN=$O(^PRCA(430,"B",BILLNO,""))
"RTN","RCDMCR5B",36,0)
 . . I ARIEN'>0 Q
"RTN","RCDMCR5B",37,0)
 . . ; only look at 1st party bills
"RTN","RCDMCR5B",38,0)
 . . I '$$FIRSTPAR^RCDMCUT1(ARIEN) Q
"RTN","RCDMCR5B",39,0)
 . . ; BILLPAYS of 1 means only bills with an IB Bill Status of Cancelled and an AR status of Closed/Collected
"RTN","RCDMCR5B",40,0)
 . . ; Otherwise, show all bills regardless of the payment status  (IB Cancelled, and with any AR Status)
"RTN","RCDMCR5B",41,0)
 . . ; Note: we no longer check Collected/Closed as per customer.   Instead, we check if any transactions associated
"RTN","RCDMCR5B",42,0)
 . . ; with this bill are payments.
"RTN","RCDMCR5B",43,0)
 . . I BILLPAYS S PAID=0 D  Q:'PAID
"RTN","RCDMCR5B",44,0)
 . . . S TRIEN=""
"RTN","RCDMCR5B",45,0)
 . . . F  S TRIEN=$O(^PRCA(433,"C",ARIEN,TRIEN)) Q:TRIEN=""  I $$GET1^DIQ(433,TRIEN_",",12,"E")?1"PAYMENT (".E S PAID=1 Q
"RTN","RCDMCR5B",46,0)
 . . D DEM^VADPT
"RTN","RCDMCR5B",47,0)
 . . I $G(VAERR)>0 D KVAR^VADPT Q
"RTN","RCDMCR5B",48,0)
 . . S NAME=$G(VADM(1))
"RTN","RCDMCR5B",49,0)
 . . I NAME']"" Q
"RTN","RCDMCR5B",50,0)
 . . S SSN=$P(VADM(2),U,1)
"RTN","RCDMCR5B",51,0)
 . . I SSN']"" Q
"RTN","RCDMCR5B",52,0)
 . . S SERVDT="",RXDT="",RXNUM="",RXNAM="",CANCREAS="",CANCUSER="" K IBDATA
"RTN","RCDMCR5B",53,0)
 . . S IENS=IBIEN_","
"RTN","RCDMCR5B",54,0)
 . . D GETS^DIQ(350,IENS,".1;11","E","IBDATA")
"RTN","RCDMCR5B",55,0)
 . . S BILLFRDT=$P(IB0,U,14)
"RTN","RCDMCR5B",56,0)
 . . S CANCREAS=$G(IBDATA(350,IENS,.1,"E"))
"RTN","RCDMCR5B",57,0)
 . . S CANCUSER=$G(IBDATA(350,IENS,11,"E"))
"RTN","RCDMCR5B",58,0)
 . . I CANCUSER="" S CANCUSER="/"_$P(IB1,U)
"RTN","RCDMCR5B",59,0)
 . . S BILGROUP=$$GET1^DIQ(350.1,+ACTTYPE_",",.11,"I")
"RTN","RCDMCR5B",60,0)
 . . S RESULT=$P(IB0,U,4)
"RTN","RCDMCR5B",61,0)
 . . S CHGAMT=$$GET1^DIQ(350,$$PARENTC(IBIEN)_",",.07)
"RTN","RCDMCR5B",62,0)
 . . S PARENTE=$$PARENTE(IBIEN),RESULT=$$GET1^DIQ(350,PARENTE_",",.04,"I"),IENS=PARENTE_","
"RTN","RCDMCR5B",63,0)
 . . S SERVDT=""
"RTN","RCDMCR5B",64,0)
 . . ;Inpatient Event
"RTN","RCDMCR5B",65,0)
 . . I $P(RESULT,":",1)=405!($P(RESULT,":",1)=45) D
"RTN","RCDMCR5B",66,0)
 . . . S VAIP("E")=$P($P(RESULT,";",1),":",2)
"RTN","RCDMCR5B",67,0)
 . . . ;Call to get Inpatient data
"RTN","RCDMCR5B",68,0)
 . . . D IN5^VADPT
"RTN","RCDMCR5B",69,0)
 . . . Q:VAERR>0
"RTN","RCDMCR5B",70,0)
 . . . S SERVDT=$P($G(VAIP(17,1)),U,1)
"RTN","RCDMCR5B",71,0)
 . . . D KVAR^VADPT
"RTN","RCDMCR5B",72,0)
 . . ;Outpatient Event
"RTN","RCDMCR5B",73,0)
 . . I BILGROUP=4!($P(RESULT,":",1)=44)!($P(RESULT,":",1)=409.68) D
"RTN","RCDMCR5B",74,0)
 . . . I $P(RESULT,":",1)=44 S SERVDT=$P($P(RESULT,";",2),":",2)
"RTN","RCDMCR5B",75,0)
 . . . I $P(RESULT,":",1)=409.68 S SERVDT=$$GET1^DIQ(409.68,+$P(RESULT,":",2)_",",.01,"I")
"RTN","RCDMCR5B",76,0)
 . . . I $G(SERVDT)'>0 S SERVDT=BILLFRDT
"RTN","RCDMCR5B",77,0)
 . . I SERVDT="" S SERVDT=$$GET1^DIQ(350,IENS,.17,"I")
"RTN","RCDMCR5B",78,0)
 . . ;RX Event
"RTN","RCDMCR5B",79,0)
 . . I $P(RESULT,":",1)=52 D
"RTN","RCDMCR5B",80,0)
 . . . N IENS
"RTN","RCDMCR5B",81,0)
 . . . ;Set up for RX Refills
"RTN","RCDMCR5B",82,0)
 . . . I $P(RESULT,";",2)]"" D
"RTN","RCDMCR5B",83,0)
 . . . . S IENS=+$P($P(RESULT,";",2),":",2)_","_+$P($P(RESULT,";",1),":",2)_","
"RTN","RCDMCR5B",84,0)
 . . . . S RXDT=$$GET1^PSODI(52.1,IENS,17,"I")
"RTN","RCDMCR5B",85,0)
 . . . . S:$P(RXDT,U,2)'?7N.E RXDT=$$GET1^PSODI(52.1,IENS,.01,"I")
"RTN","RCDMCR5B",86,0)
 . . . . I 'RXDT S RXDT="^"
"RTN","RCDMCR5B",87,0)
 . . . . S RXNUM=$$GET1^PSODI(52,$P($P(RESULT,";",1),":",2)_",",.01,"I")
"RTN","RCDMCR5B",88,0)
 . . . . I 'RXNUM S RXNUM="^"
"RTN","RCDMCR5B",89,0)
 . . . . S RXNAM=$$GET1^PSODI(52,$P($P(RESULT,";",1),":",2)_",",6,"E")
"RTN","RCDMCR5B",90,0)
 . . . . I 'RXNAM S RXNAM="^"
"RTN","RCDMCR5B",91,0)
 . . . ;Set up for RX Data (No refill)
"RTN","RCDMCR5B",92,0)
 . . . I $P(RESULT,";",2)']"" D
"RTN","RCDMCR5B",93,0)
 . . . . S IENS=+$P($P(RESULT,";",1),":",2)_","
"RTN","RCDMCR5B",94,0)
 . . . . S RXDT=$$GET1^PSODI(52,IENS,31,"I")
"RTN","RCDMCR5B",95,0)
 . . . . S:$P(RXDT,U,2)'?7N.E RXDT=$$GET1^PSODI(52,IENS,22,"I")
"RTN","RCDMCR5B",96,0)
 . . . . I 'RXDT S RXDT="^"
"RTN","RCDMCR5B",97,0)
 . . . . S RXNUM=$$GET1^PSODI(52,IENS,.01,"I")
"RTN","RCDMCR5B",98,0)
 . . . . I 'RXNUM S RXNUM="^"
"RTN","RCDMCR5B",99,0)
 . . . . S RXNAM=$$GET1^PSODI(52,IENS,6,"E")
"RTN","RCDMCR5B",100,0)
 . . . . I 'RXNAM S RXNAM="^"
"RTN","RCDMCR5B",101,0)
 . . S ^TMP($J,"RCDMCR5","DETAIL",NAME,SSN,BILLNO,IBIEN)=SERVDT_U_$P(RXDT,U,2)_U_CHGAMT_U_$P(RXNUM,U,2)_U_$P(RXNAM,U,2)_U_CANCDT_U_CANCREAS_U_CANCUSER
"RTN","RCDMCR5B",102,0)
 Q
"RTN","RCDMCR5B",103,0)
PARENTE(IBIEN) ; Go up the parenting event chain of IBIEN and return the original "parent" 
"RTN","RCDMCR5B",104,0)
 N NZ
"RTN","RCDMCR5B",105,0)
 S NZ=$G(^IB(IBIEN,0))
"RTN","RCDMCR5B",106,0)
 I $P(NZ,U,16)'="" Q $S(IBIEN=$P(NZ,U,16):IBIEN,1:$$PARENTE($P(NZ,U,16)))
"RTN","RCDMCR5B",107,0)
 I $P(NZ,U,9)'="" Q $S(IBIEN=$P(NZ,U,9):IBIEN,1:$$PARENTE($P(NZ,U,9)))
"RTN","RCDMCR5B",108,0)
 I $P(NZ,U,4)?1"350:".E Q $S(IBIEN=(+$P($P(NZ,U,4),":",2)):IBIEN,1:$$PARENTE($P($P(NZ,U,4),":",2)+0))
"RTN","RCDMCR5B",109,0)
 Q IBIEN
"RTN","RCDMCR5B",110,0)
PARENTC(IBIEN) ; Go up the parenting charge chain of IBIEN and return the original "parent" charge
"RTN","RCDMCR5B",111,0)
 N NZ
"RTN","RCDMCR5B",112,0)
 S NZ=$G(^IB(IBIEN,0))
"RTN","RCDMCR5B",113,0)
 I $P(NZ,U,9)'="" Q $S(IBIEN=$P(NZ,U,9):IBIEN,1:$$PARENTC($P(NZ,U,9)))
"RTN","RCDMCR5B",114,0)
 I $P(NZ,U,4)?1"350:".E Q $S(IBIEN=(+$P($P(NZ,U,4),":",2)):IBIEN,1:$$PARENTC($P($P(NZ,U,4),":",2)+0))
"RTN","RCDMCR5B",115,0)
 Q IBIEN
"RTN","RCDMCR6A")
0^8^B29334553^n/a
"RTN","RCDMCR6A",1,0)
RCDMCR6A ;ALB/YG - 50-100 Percent SC Exempt Charge Reconciliation Report - Input/output; Apr 9, 2019@21:06
"RTN","RCDMCR6A",2,0)
 ;;4.5;Accounts Receivable;**347**;Mar 20, 1995;Build 47
"RTN","RCDMCR6A",3,0)
 ;;Per VA Directive 6402, this routine should not be modified.
"RTN","RCDMCR6A",4,0)
 ;
"RTN","RCDMCR6A",5,0)
 ;This routine is being implemented for the AR Cross-Servicing Project
"RTN","RCDMCR6A",6,0)
 ; This report assists users in reviewing all bills containing charges 
"RTN","RCDMCR6A",7,0)
 ; with a distinct date of service on or after the co-payment exemption 
"RTN","RCDMCR6A",8,0)
 ; effective date for Veterans with Primary or Secondary Eligibility equal 
"RTN","RCDMCR6A",9,0)
 ; to 50 to 100% Service Connected
"RTN","RCDMCR6A",10,0)
 ; 
"RTN","RCDMCR6A",11,0)
 ;  The report captures any charges without an IB status of cancelled, and
"RTN","RCDMCR6A",12,0)
 ; with an AR Status of Active, Open, Suspended, Write-Off, or Collected/
"RTN","RCDMCR6A",13,0)
 ; Closed or an IB Status of On-Hold, with a date of service on or after 
"RTN","RCDMCR6A",14,0)
 ; the exemption effective date.
"RTN","RCDMCR6A",15,0)
 ;
"RTN","RCDMCR6A",16,0)
MAIN ; Initial Interactive Processing
"RTN","RCDMCR6A",17,0)
 S:$G(U)="" U="^"
"RTN","RCDMCR6A",18,0)
 ;N STOPIT,EXCEL,RCSCR,RDDATE,RCBEGDT,RCENDDT,EOCBEGDT,EOCENDDT,EOCDATE,VLSDATE,VLSBEGDT,VLSENDDT,RPTTYPE
"RTN","RCDMCR6A",19,0)
 N STOPIT,EXCEL,RCSCR,ARTYPE
"RTN","RCDMCR6A",20,0)
 W !!,"*** Print the 50-100 Percent SC Exempt Charge Reconciliation Report ***",!
"RTN","RCDMCR6A",21,0)
 ;
"RTN","RCDMCR6A",22,0)
 S STOPIT=0 ; quit flag
"RTN","RCDMCR6A",23,0)
 ; Get Status
"RTN","RCDMCR6A",24,0)
 S ARTYPE=$$ARSTAT^RCDMCUT2(.STOPIT)
"RTN","RCDMCR6A",25,0)
 Q:STOPIT>0!(ARTYPE']"")
"RTN","RCDMCR6A",26,0)
 ;
"RTN","RCDMCR6A",27,0)
 ; Prompt user if report will be Excel Delimited format:
"RTN","RCDMCR6A",28,0)
 S EXCEL=$$EXCEL^RCDMCUT2
"RTN","RCDMCR6A",29,0)
 ;Quit is user up arrowed or timed out
"RTN","RCDMCR6A",30,0)
 Q:EXCEL="^"
"RTN","RCDMCR6A",31,0)
 D:EXCEL>0 EXMSG^RCDMCUT2
"RTN","RCDMCR6A",32,0)
 D:EXCEL'>0
"RTN","RCDMCR6A",33,0)
 . W !!,"This report may take a while to process. It is recommended that"
"RTN","RCDMCR6A",34,0)
 . W !,"you Queue this report to a device that is 132 characters wide."
"RTN","RCDMCR6A",35,0)
 ;
"RTN","RCDMCR6A",36,0)
 N %ZIS,ZTSK,ZTRTN,ZTIO,ZTDESC,POP,ZTSAVE
"RTN","RCDMCR6A",37,0)
 S %ZIS="QM"
"RTN","RCDMCR6A",38,0)
 W ! D ^%ZIS
"RTN","RCDMCR6A",39,0)
 I POP S STOPIT=1 Q
"RTN","RCDMCR6A",40,0)
 S RCSCR=$S($E($G(IOST),1,2)="C-":1,1:0)
"RTN","RCDMCR6A",41,0)
 ;
"RTN","RCDMCR6A",42,0)
 I $D(IO("Q")) D  S STOPIT=1
"RTN","RCDMCR6A",43,0)
 . S ZTRTN="RUN^RCDMCR6A"
"RTN","RCDMCR6A",44,0)
 . S ZTIO=ION
"RTN","RCDMCR6A",45,0)
 . S ZTSAVE("RCSCR")=""
"RTN","RCDMCR6A",46,0)
 . S ZTSAVE("ARTYPE")=""
"RTN","RCDMCR6A",47,0)
 . S ZTSAVE("EXCEL")=""
"RTN","RCDMCR6A",48,0)
 . S ZTDESC="50-100 Percent SC Exempt Charge Reconciliation Report Process"
"RTN","RCDMCR6A",49,0)
 . D ^%ZTLOAD
"RTN","RCDMCR6A",50,0)
 . W !!,$S($D(ZTSK):"Request Queued.  TASK = "_ZTSK,1:"REQUEST CANCELLED")
"RTN","RCDMCR6A",51,0)
 . D HOME^%ZIS
"RTN","RCDMCR6A",52,0)
 ;
"RTN","RCDMCR6A",53,0)
 Q:STOPIT>0!($D(ZTQUEUED))
"RTN","RCDMCR6A",54,0)
 D RUN^RCDMCR6A
"RTN","RCDMCR6A",55,0)
 I STOPIT'=2 D PAUSE2^RCDMCUT2
"RTN","RCDMCR6A",56,0)
 Q
"RTN","RCDMCR6A",57,0)
QUERPT ; Initial Taskman Scheduled Queued processing
"RTN","RCDMCR6A",58,0)
 Q
"RTN","RCDMCR6A",59,0)
 ;
"RTN","RCDMCR6A",60,0)
RUN ;Get data and Print it out
"RTN","RCDMCR6A",61,0)
 ;If queued ensure you delete it from the TASKS file
"RTN","RCDMCR6A",62,0)
 I $D(ZTQUEUED) S ZTREQ="@"
"RTN","RCDMCR6A",63,0)
 N RCPAGE
"RTN","RCDMCR6A",64,0)
 K ^TMP($J,"RCDMCR6")
"RTN","RCDMCR6A",65,0)
 S RCPAGE=0,STOPIT=$G(STOPIT)
"RTN","RCDMCR6A",66,0)
 ; Collect the data in ^TMP
"RTN","RCDMCR6A",67,0)
 D COLLECT^RCDMCR6B(.STOPIT,ARTYPE)
"RTN","RCDMCR6A",68,0)
 Q:$G(STOPIT)>0
"RTN","RCDMCR6A",69,0)
 U IO
"RTN","RCDMCR6A",70,0)
 ; Print Report using data in ^TMP
"RTN","RCDMCR6A",71,0)
 D REPORT
"RTN","RCDMCR6A",72,0)
 I 'RCSCR W !,@IOF
"RTN","RCDMCR6A",73,0)
 D ^%ZISC
"RTN","RCDMCR6A",74,0)
 K ^TMP($J,"RCDMCR6")
"RTN","RCDMCR6A",75,0)
 K EXCEL,RCSCR,TESTDATE
"RTN","RCDMCR6A",76,0)
 Q
"RTN","RCDMCR6A",77,0)
 ;
"RTN","RCDMCR6A",78,0)
REPORT ;Print report
"RTN","RCDMCR6A",79,0)
 N RUNDATE,STATUS,NAME,SSN,BILLNO,IBIEN,SKIP
"RTN","RCDMCR6A",80,0)
 ;
"RTN","RCDMCR6A",81,0)
 S RUNDATE=$$FMTE^XLFDT($$NOW^XLFDT,"9MP")
"RTN","RCDMCR6A",82,0)
 D HDR
"RTN","RCDMCR6A",83,0)
 I +$D(^TMP($J,"RCDMCR6"))'>0 W !,"No data meets the criteria." Q
"RTN","RCDMCR6A",84,0)
 K SKIP
"RTN","RCDMCR6A",85,0)
 S NAME=""
"RTN","RCDMCR6A",86,0)
 F  S NAME=$O(^TMP($J,"RCDMCR6","DETAIL",NAME)) Q:NAME']""  D  Q:STOPIT
"RTN","RCDMCR6A",87,0)
 . S SSN=""
"RTN","RCDMCR6A",88,0)
 . F  S SSN=$O(^TMP($J,"RCDMCR6","DETAIL",NAME,SSN)) Q:SSN']""  D  Q:STOPIT
"RTN","RCDMCR6A",89,0)
 . . S BILLNO=""
"RTN","RCDMCR6A",90,0)
 . . F  S BILLNO=$O(^TMP($J,"RCDMCR6","DETAIL",NAME,SSN,BILLNO)) Q:BILLNO']""  D  Q:STOPIT
"RTN","RCDMCR6A",91,0)
 . . . S IBIEN=""
"RTN","RCDMCR6A",92,0)
 . . . F  S IBIEN=$O(^TMP($J,"RCDMCR6","DETAIL",NAME,SSN,BILLNO,IBIEN)) Q:IBIEN']""  D  Q:STOPIT
"RTN","RCDMCR6A",93,0)
 . . . . N NODE,SERVDT,RXDT,ELIG,EXEMPTDT,RXNUM,RXNAM,STATUS
"RTN","RCDMCR6A",94,0)
 . . . . ; S ^TMP($J,"RCDMCR6","DETAIL",NAME,SSN,BILLNO,IBIEN)=SERVDT_U_RXDT_U_ELIG_U_EXEMPTDT_U_RXNUM_U_RXNAM_U_STATUS
"RTN","RCDMCR6A",95,0)
 . . . . S NODE=$G(^TMP($J,"RCDMCR6","DETAIL",NAME,SSN,BILLNO,IBIEN))
"RTN","RCDMCR6A",96,0)
 . . . . S SERVDT=$P(NODE,U,1)
"RTN","RCDMCR6A",97,0)
 . . . . S RXDT=$P(NODE,U,2)
"RTN","RCDMCR6A",98,0)
 . . . . S ELIG=$P(NODE,U,3)
"RTN","RCDMCR6A",99,0)
 . . . . S EXEMPTDT=$P(NODE,U,4)
"RTN","RCDMCR6A",100,0)
 . . . . S RXNUM=$P(NODE,U,5)
"RTN","RCDMCR6A",101,0)
 . . . . S RXNAM=$P(NODE,U,6)
"RTN","RCDMCR6A",102,0)
 . . . . S STATUS=$P(NODE,U,7)
"RTN","RCDMCR6A",103,0)
 . . . . I EXCEL'>0 D WRLINE Q
"RTN","RCDMCR6A",104,0)
 . . . . I EXCEL>0 D WRLINE2 Q
"RTN","RCDMCR6A",105,0)
 Q
"RTN","RCDMCR6A",106,0)
 ;
"RTN","RCDMCR6A",107,0)
WRLINE ; Write the data formated report line
"RTN","RCDMCR6A",108,0)
 ; Columns are - position, width, spacing (offset header by)
"RTN","RCDMCR6A",109,0)
 ;Veteran Name - 0,23,1 
"RTN","RCDMCR6A",110,0)
 ;SSN - 24,10,1
"RTN","RCDMCR6A",111,0)
 ;Eligibility - 35,11,1 
"RTN","RCDMCR6A",112,0)
 ;Bill # - 47,11,1
"RTN","RCDMCR6A",113,0)
 ;EXMPTDT - 59,7,1
"RTN","RCDMCR6A",114,0)
 ;Med Care Date - 67,13,1
"RTN","RCDMCR6A",115,0)
 ;RXFillDT - 81,7,1
"RTN","RCDMCR6A",116,0)
 ;RX # - 89,9,1
"RTN","RCDMCR6A",117,0)
 ;RX Name - 99,22,1 
"RTN","RCDMCR6A",118,0)
 ;AR Status - 122,9
"RTN","RCDMCR6A",119,0)
 D CHKP() Q:STOPIT
"RTN","RCDMCR6A",120,0)
 W !
"RTN","RCDMCR6A",121,0)
 ;If Multiple Bills for Vet only print Name & SSN for 1st record on page
"RTN","RCDMCR6A",122,0)
 ; Disable skip for now (as per direction of customer) with :0
"RTN","RCDMCR6A",123,0)
 I (NAME_SSN)'=$G(SKIP(1)) D
"RTN","RCDMCR6A",124,0)
 . W $E(NAME,1,23) ; Veteran Name
"RTN","RCDMCR6A",125,0)
 . W ?24,SSN ; SSN
"RTN","RCDMCR6A",126,0)
 . S:0 SKIP(1)=NAME_SSN
"RTN","RCDMCR6A",127,0)
 W ?35,ELIG
"RTN","RCDMCR6A",128,0)
 W ?47,$P(BILLNO,"/",1) ; Bill Number
"RTN","RCDMCR6A",129,0)
 I EXEMPTDT="NODATE" W ?59,EXEMPTDT Q
"RTN","RCDMCR6A",130,0)
 W ?59,$$STRIP^XLFSTR($$FMTE^XLFDT(EXEMPTDT,"8D")," ")
"RTN","RCDMCR6A",131,0)
 W:SERVDT>0 ?67,$$STRIP^XLFSTR($$FMTE^XLFDT(SERVDT,"8D")," ")
"RTN","RCDMCR6A",132,0)
 W:RXDT>0 ?81,$$STRIP^XLFSTR($$FMTE^XLFDT(RXDT,"8D")," ") ; Med Fill Date
"RTN","RCDMCR6A",133,0)
 W ?89,RXNUM ; RX # 
"RTN","RCDMCR6A",134,0)
 W ?99,$E(RXNAM,1,22) ; RX Name
"RTN","RCDMCR6A",135,0)
 W ?122,$E(STATUS,1,9)
"RTN","RCDMCR6A",136,0)
 Q
"RTN","RCDMCR6A",137,0)
 ;
"RTN","RCDMCR6A",138,0)
WRLINE2 ; Write the Excel report line
"RTN","RCDMCR6A",139,0)
 W !
"RTN","RCDMCR6A",140,0)
 W NAME,U
"RTN","RCDMCR6A",141,0)
 W SSN,U
"RTN","RCDMCR6A",142,0)
 W ELIG,U
"RTN","RCDMCR6A",143,0)
 W $P(BILLNO,"/",1),U
"RTN","RCDMCR6A",144,0)
 I EXEMPTDT="NODATE" W EXEMPTDT Q
"RTN","RCDMCR6A",145,0)
 W:EXEMPTDT $$FMTE^XLFDT(EXEMPTDT,"9D") W U
"RTN","RCDMCR6A",146,0)
 W:SERVDT $$FMTE^XLFDT(SERVDT,"9D") W U
"RTN","RCDMCR6A",147,0)
 W:RXDT $$FMTE^XLFDT(RXDT,"9D") W U
"RTN","RCDMCR6A",148,0)
 W RXNUM,U
"RTN","RCDMCR6A",149,0)
 W RXNAM,U
"RTN","RCDMCR6A",150,0)
 W STATUS,U
"RTN","RCDMCR6A",151,0)
 Q
"RTN","RCDMCR6A",152,0)
 ;
"RTN","RCDMCR6A",153,0)
CHKP(FOOTER) ;Check for End of Page
"RTN","RCDMCR6A",154,0)
 ;INPUT:
"RTN","RCDMCR6A",155,0)
 ;  FOOTER - Footer value. Optional. Default to 4 if nothing passed
"RTN","RCDMCR6A",156,0)
 I $G(FOOTER)'>0 S FOOTER=4
"RTN","RCDMCR6A",157,0)
 I $Y>(IOSL-FOOTER) D:RCSCR PAUSE^RCDMCUT2 Q:STOPIT  D HDR K SKIP
"RTN","RCDMCR6A",158,0)
 Q
"RTN","RCDMCR6A",159,0)
 ;
"RTN","RCDMCR6A",160,0)
HDR ;Print Report Header
"RTN","RCDMCR6A",161,0)
 I EXCEL>0 D  Q
"RTN","RCDMCR6A",162,0)
 . W !,"Veteran Name",U,"SSN",U,"Eligibility",U,"Bill #",U,"EXMPTDT",U,"Med Care Date",U,"RXFillDT",U,"RX #",U,"RX Name",U,"Status"
"RTN","RCDMCR6A",163,0)
 S RCPAGE=RCPAGE+1
"RTN","RCDMCR6A",164,0)
 W @IOF,"50-100 Percent SC Exempt Charge Reconciliation Report  -- Run Date: ",RUNDATE," --"
"RTN","RCDMCR6A",165,0)
 W ?122,"Page "_RCPAGE
"RTN","RCDMCR6A",166,0)
 W !
"RTN","RCDMCR6A",167,0)
 ;Print to screen or printer
"RTN","RCDMCR6A",168,0)
 W !,"Veteran Name",?24,"SSN",?35,"Eligibility",?47,"Bill #",?59,"EXMPTDT",?67,"Med Care Date",?81,"RXFillDT",?90,"RX #",?99,"RX Name",?122,"Status"
"RTN","RCDMCR6A",169,0)
 D ULINE^RCDMCUT2("=",$G(IOM))
"RTN","RCDMCR6A",170,0)
 Q
"RTN","RCDMCR6B")
0^10^B27513091^n/a
"RTN","RCDMCR6B",1,0)
RCDMCR6B ;ALB/YG - 50-100 Percent SC Exempt Charge Reconciliation Report - Input/output; Apr 9, 2019@21:06
"RTN","RCDMCR6B",2,0)
 ;;4.5;Accounts Receivable;**347**;Mar 20, 1995;Build 47
"RTN","RCDMCR6B",3,0)
 ;;Per VA Directive 6402, this routine should not be modified.
"RTN","RCDMCR6B",4,0)
 ;
"RTN","RCDMCR6B",5,0)
 ; See RCDMCR6A for detailed description
"RTN","RCDMCR6B",6,0)
 ;
"RTN","RCDMCR6B",7,0)
COLLECT(STOPIT,ARTYPE) ; Get the report data
"RTN","RCDMCR6B",8,0)
 ;Input
"RTN","RCDMCR6B",9,0)
 ;   STOPIT - Passed Variable to determine if process is to be terminated
"RTN","RCDMCR6B",10,0)
 ;   ARTYPE - AR Type  1:Active;2:Open;3:Suspended;4:Collected/Closed;5:On-Hold;6:Write Off;7:All
"RTN","RCDMCR6B",11,0)
 ;Output
"RTN","RCDMCR6B",12,0)
 ;   STOPIT - Passed Variable set to 1 if process is to be terminated
"RTN","RCDMCR6B",13,0)
 ;   ^TMP($J,"RCDMCR6") with report data and summary data
"RTN","RCDMCR6B",14,0)
 ;N RCDFN,DEBTOR,ARIEN,IBIEN,CTR,EOCOK,IBCNT,EOCDT,DFN,DMCELIG,EFFDT,NAME,SSN
"RTN","RCDMCR6B",15,0)
 ;N STATUS,OPTDT,DISCHDT,RXDT,OPTDT,RXDT,CHGAMT,OCC,BILLNO,RXNUM,RXNAM,DSTATUS,IBDATA
"RTN","RCDMCR6B",16,0)
 ;Get Rated Disability Data within passed RD change time frame
"RTN","RCDMCR6B",17,0)
 ;*** call API to get all RD change data for given date period
"RTN","RCDMCR6B",18,0)
 N ZR,DEBTPT,WZH,DEBTCNT,DEBTOR,RCDFN,DFN,DMCELIG,ELIG,EXEMPTDT,SZH,VAERR,VADM,ARIEN,CTR
"RTN","RCDMCR6B",19,0)
 N BILLNO,IBDATA,IBCNT,IBIEN,NAME,SSN,OUT,STATUS
"RTN","RCDMCR6B",20,0)
 S DEBTPT=0,WZH=$H*86400+$P($H,",",2)+60,SZH=WZH W !
"RTN","RCDMCR6B",21,0)
 F DEBTCNT=0:1 S DEBTPT=$O(^RCD(340,"B",DEBTPT)) Q:DEBTPT=""  I DEBTPT[";DPT(" D
"RTN","RCDMCR6B",22,0)
 . ;Get AR Debtor info from file 340
"RTN","RCDMCR6B",23,0)
 . S DEBTOR=0,RCDFN=$P(DEBTPT,";")
"RTN","RCDMCR6B",24,0)
 . F  S DEBTOR=$O(^RCD(340,"B",DEBTPT,DEBTOR)) Q:DEBTOR'>0  D  Q:$G(STOPIT)>0
"RTN","RCDMCR6B",25,0)
 . . S DFN=RCDFN
"RTN","RCDMCR6B",26,0)
 . . S DMCELIG=$$DMCELIG^RCDMCUT1(RCDFN)
"RTN","RCDMCR6B",27,0)
 . . Q:'DMCELIG
"RTN","RCDMCR6B",28,0)
 . . S ELIG=$S($P(DMCELIG,U,2)'="":"SC"_$P(DMCELIG,U,2),$P(DMCELIG,U,3)'="":"Pension",$P(DMCELIG,U,4)'="":"A&A",$P(DMCELIG,U,5)'="":"HouseBnd",1:"")
"RTN","RCDMCR6B",29,0)
 . . ; business decision for now is to only show SC%.  A&A, Pension and HB are off the report.
"RTN","RCDMCR6B",30,0)
 . . Q:ELIG'?1"SC".E
"RTN","RCDMCR6B",31,0)
 . . ; business decision is to change from .3012 (SC AWARD DATE) to .3014 (EFF. DATE COMBINED SC% EVAL.)
"RTN","RCDMCR6B",32,0)
 . . S EXEMPTDT=$$GET1^DIQ(2,DFN_",",.3014,"I")
"RTN","RCDMCR6B",33,0)
 . . I DFN'>0 D KVAR^VADPT Q
"RTN","RCDMCR6B",34,0)
 . . D DEM^VADPT
"RTN","RCDMCR6B",35,0)
 . . I $G(VAERR)>0 D KVAR^VADPT Q
"RTN","RCDMCR6B",36,0)
 . . S NAME=$G(VADM(1))
"RTN","RCDMCR6B",37,0)
 . . I NAME']"" D KVAR^VADPT Q
"RTN","RCDMCR6B",38,0)
 . . S SSN=$P(VADM(2),U,1)
"RTN","RCDMCR6B",39,0)
 . . D KVAR^VADPT
"RTN","RCDMCR6B",40,0)
 . . ;I EXEMPTDT="" S ^TMP($J,"RCDMCR6","DETAIL",NAME,SSN," ",1)=U_U_U_"NODATE" Q
"RTN","RCDMCR6B",41,0)
 . . ;Get AR Bill Data that is within the last BEGDT time period
"RTN","RCDMCR6B",42,0)
 . . ;for Bill's with a current status of ACTIVE, OPEN, SUSPENDED, WRITE-OFF, COLLECTED/CLOSED, CANCELLATION or IB Status of ON-HOLD
"RTN","RCDMCR6B",43,0)
 . . K ^TMP($J,"RCDMCR6","ARIB")
"RTN","RCDMCR6B",44,0)
 . . I $H*86400+$P($H,",",2)>WZH S WZH=$H*86400+$P($H,",",2)+30,$X=0 W *13,$FN(DEBTCNT*100/$P(^RCD(340,0),U,4),",",2),"% done in ",WZH-SZH," seconds"
"RTN","RCDMCR6B",45,0)
 . . S ARIEN=0
"RTN","RCDMCR6B",46,0)
 . . I ARTYPE'=5 F  S ARIEN=$O(^PRCA(430,"C",DEBTOR,ARIEN)) Q:ARIEN'>0  D  Q:$G(STOPIT)>0
"RTN","RCDMCR6B",47,0)
 . . . S CTR=$G(CTR)+1 ;Counter
"RTN","RCDMCR6B",48,0)
 . . . I CTR#500=0 S STOPIT=$$STOPIT^RCDMCUT2() Q:STOPIT
"RTN","RCDMCR6B",49,0)
 . . . ; only look at 1st party bills - TBD
"RTN","RCDMCR6B",50,0)
 . . . I '$$FIRSTPAR^RCDMCUT1(ARIEN) Q
"RTN","RCDMCR6B",51,0)
 . . . ;IEN is from calling routine (for file 430)
"RTN","RCDMCR6B",52,0)
 . . . ;Bill Number
"RTN","RCDMCR6B",53,0)
 . . . S BILLNO=$$GET1^DIQ(430,ARIEN_",",.01)
"RTN","RCDMCR6B",54,0)
 . . . I BILLNO']"" Q
"RTN","RCDMCR6B",55,0)
 . . . S STATUS=$$GET1^DIQ(430,ARIEN_",",8,"E")
"RTN","RCDMCR6B",56,0)
 . . . I ARTYPE=1,STATUS'="ACTIVE" Q
"RTN","RCDMCR6B",57,0)
 . . . I ARTYPE=2,STATUS'="OPEN" Q
"RTN","RCDMCR6B",58,0)
 . . . I ARTYPE=3,STATUS'="SUSPENDED" Q
"RTN","RCDMCR6B",59,0)
 . . . I ARTYPE=4,STATUS'="COLLECTED/CLOSED" Q
"RTN","RCDMCR6B",60,0)
 . . . I ARTYPE=6,STATUS'="WRITE-OFF" Q
"RTN","RCDMCR6B",61,0)
 . . . I ARTYPE=7,"^ACTIVE^OPEN^SUSPENDED^WRITE-OFF^COLLECTED/CLOSED^CANCELLATION^"'[(U_STATUS_U) Q
"RTN","RCDMCR6B",62,0)
 . . . K IBDATA S IBDATA=0
"RTN","RCDMCR6B",63,0)
 . . . S IBIEN=""
"RTN","RCDMCR6B",64,0)
 . . . F  S IBIEN=$O(^IB("ABIL",BILLNO,IBIEN)) Q:'IBIEN  S OUT=$$GETIB^RCDMCR4B(IBIEN,0) I OUT,$P(OUT,U,5)'=10 S IBDATA=IBDATA+1,IBDATA(IBDATA)=OUT
"RTN","RCDMCR6B",65,0)
 . . . I 'IBDATA Q
"RTN","RCDMCR6B",66,0)
 . . . M ^TMP($J,"RCDMCR6","ARIB",BILLNO,"IBDATA")=IBDATA
"RTN","RCDMCR6B",67,0)
 . . . S ^TMP($J,"RCDMCR6","ARIB",BILLNO,"STATUS")=STATUS
"RTN","RCDMCR6B",68,0)
 . . S IBIEN=""
"RTN","RCDMCR6B",69,0)
 . . I ARTYPE=5!(ARTYPE=7) F  S IBIEN=$O(^IB("AH",RCDFN,IBIEN)) Q:IBIEN=""  D  Q:$G(STOPIT)>0
"RTN","RCDMCR6B",70,0)
 . . . K IBDATA S IBDATA=0
"RTN","RCDMCR6B",71,0)
 . . . S CTR=$G(CTR)+1 ;Counter
"RTN","RCDMCR6B",72,0)
 . . . I CTR#500=0 S STOPIT=$$STOPIT^RCDMCUT2() Q:STOPIT
"RTN","RCDMCR6B",73,0)
 . . . S BILLNO="/"_IBIEN
"RTN","RCDMCR6B",74,0)
 . . . S OUT=$$GETIB^RCDMCR4B(IBIEN,1) Q:'OUT
"RTN","RCDMCR6B",75,0)
 . . . S IBDATA=1,IBDATA(1)=OUT
"RTN","RCDMCR6B",76,0)
 . . . M ^TMP($J,"RCDMCR6","ARIB",BILLNO,"IBDATA")=IBDATA
"RTN","RCDMCR6B",77,0)
 . . . S ^TMP($J,"RCDMCR6","ARIB",BILLNO,"STATUS")="ON HOLD"
"RTN","RCDMCR6B",78,0)
 . . S BILLNO=""
"RTN","RCDMCR6B",79,0)
 . . F  S BILLNO=$O(^TMP($J,"RCDMCR6","ARIB",BILLNO)) Q:BILLNO=""  D
"RTN","RCDMCR6B",80,0)
 . . . K IBDATA M IBDATA=^TMP($J,"RCDMCR6","ARIB",BILLNO,"IBDATA")
"RTN","RCDMCR6B",81,0)
 . . . S STATUS=^TMP($J,"RCDMCR6","ARIB",BILLNO,"STATUS")
"RTN","RCDMCR6B",82,0)
 . . . F IBCNT=1:1:IBDATA D
"RTN","RCDMCR6B",83,0)
 . . . . N OPTDT,DISCHDT,SERVDT,RXDT,RXNUM,RXNAM,DSTATUS,EOCDT
"RTN","RCDMCR6B",84,0)
 . . . . ;IBDATA - Array of 1 ^ Outpatient Date ^ Discharge Date ^ RX/Refill Date ^ IB Status ^ RX NUM ^ RX Name ^ CHGAMT
"RTN","RCDMCR6B",85,0)
 . . . . S OPTDT=$P(IBDATA(IBCNT),U,2)
"RTN","RCDMCR6B",86,0)
 . . . . S DISCHDT=$P(IBDATA(IBCNT),U,3)
"RTN","RCDMCR6B",87,0)
 . . . . S SERVDT=$S(OPTDT>DISCHDT:OPTDT,DISCHDT>OPTDT:DISCHDT,1:"")
"RTN","RCDMCR6B",88,0)
 . . . . S RXDT=$P(IBDATA(IBCNT),U,4)
"RTN","RCDMCR6B",89,0)
 . . . . ;S IBSTATUS=$P(IBDATA(IBCNT),U,5)
"RTN","RCDMCR6B",90,0)
 . . . . S RXNUM=$P(IBDATA(IBCNT),U,6)
"RTN","RCDMCR6B",91,0)
 . . . . S RXNAM=$P(IBDATA(IBCNT),U,7)
"RTN","RCDMCR6B",92,0)
 . . . . S DSTATUS=STATUS
"RTN","RCDMCR6B",93,0)
 . . . . ; Get EOC date and verify that it is later than Patient Effective Date
"RTN","RCDMCR6B",94,0)
 . . . . S EOCDT=""
"RTN","RCDMCR6B",95,0)
 . . . . I OPTDT>EOCDT S EOCDT=OPTDT
"RTN","RCDMCR6B",96,0)
 . . . . I DISCHDT>EOCDT S EOCDT=DISCHDT
"RTN","RCDMCR6B",97,0)
 . . . . I RXDT>EOCDT S EOCDT=RXDT
"RTN","RCDMCR6B",98,0)
 . . . . I EXEMPTDT="" S ^TMP($J,"RCDMCR6","DETAIL",NAME,SSN," ",1)=U_U_ELIG_U_"NODATE" Q
"RTN","RCDMCR6B",99,0)
 . . . . I EOCDT'>EXEMPTDT Q
"RTN","RCDMCR6B",100,0)
 . . . . S DSTATUS=$S(DSTATUS="CANCELLATION":"ARCXLD",DSTATUS="COLLECTED/CLOSED":"C/C",1:DSTATUS)
"RTN","RCDMCR6B",101,0)
 . . . . S ^TMP($J,"RCDMCR6","DETAIL",NAME,SSN,BILLNO,IBCNT)=SERVDT_U_RXDT_U_ELIG_U_EXEMPTDT_U_RXNUM_U_RXNAM_U_DSTATUS
"RTN","RCDMCR6B",102,0)
 K ^TMP($J,"RCDMCR6","ARIB")
"RTN","RCDMCR6B",103,0)
 Q
"RTN","RCDMCR7A")
0^9^B24147917^n/a
"RTN","RCDMCR7A",1,0)
RCDMCR7A ;ALB/YG - 10-40% SC Medical Care Copayment Exempt Charge Reconciliation Report - Input/output; Apr 9, 2019@21:06
"RTN","RCDMCR7A",2,0)
 ;;4.5;Accounts Receivable;**347**;Jan 29, 2019;Build 47
"RTN","RCDMCR7A",3,0)
 ;;Per VA Directive 6402, this routine should not be modified.
"RTN","RCDMCR7A",4,0)
 ;
"RTN","RCDMCR7A",5,0)
 ;This routine is being implemented for the AR Cross-Servicing Project
"RTN","RCDMCR7A",6,0)
 ;It assists users in reviewing all medical care copayment bills 
"RTN","RCDMCR7A",7,0)
 ; containing charges with a distinct date of service on or after the 
"RTN","RCDMCR7A",8,0)
 ; copayment exemption effective date for Veterans with SC Percent equal 
"RTN","RCDMCR7A",9,0)
 ; to 10 to 40% and does not show prescription copayment bills.
"RTN","RCDMCR7A",10,0)
 ;
"RTN","RCDMCR7A",11,0)
 ; The report captures any medical care copayment charge without an IB 
"RTN","RCDMCR7A",12,0)
 ; status of cancelled, and with an AR Status of Active, Open, Suspended,
"RTN","RCDMCR7A",13,0)
 ; Write-Off, or Collected/Closed OR an IB Status of On-Hold, with a date 
"RTN","RCDMCR7A",14,0)
 ; of service on or after the exemption effective date.
"RTN","RCDMCR7A",15,0)
 ;
"RTN","RCDMCR7A",16,0)
MAIN ; Initial Interactive Processing
"RTN","RCDMCR7A",17,0)
 S:$G(U)="" U="^"
"RTN","RCDMCR7A",18,0)
 ;N STOPIT,EXCEL,RCSCR,RDDATE,RCBEGDT,RCENDDT,EOCBEGDT,EOCENDDT,EOCDATE,VLSDATE,VLSBEGDT,VLSENDDT,RPTTYPE
"RTN","RCDMCR7A",19,0)
 N STOPIT,EXCEL,RCSCR,ARTYPE
"RTN","RCDMCR7A",20,0)
 W !!,"*** Print the 10-40% SC Medical Care Copayment Exempt Charge Recon Report ***",!
"RTN","RCDMCR7A",21,0)
 ;
"RTN","RCDMCR7A",22,0)
 S STOPIT=0 ; quit flag
"RTN","RCDMCR7A",23,0)
 ; Get Status
"RTN","RCDMCR7A",24,0)
 S ARTYPE=$$ARSTAT^RCDMCUT2(.STOPIT)
"RTN","RCDMCR7A",25,0)
 Q:STOPIT>0!(ARTYPE']"")
"RTN","RCDMCR7A",26,0)
 ;
"RTN","RCDMCR7A",27,0)
 ; Prompt user if report will be Excel Delimited format:
"RTN","RCDMCR7A",28,0)
 S EXCEL=$$EXCEL^RCDMCUT2
"RTN","RCDMCR7A",29,0)
 ;Quit is user up arrowed or timed out
"RTN","RCDMCR7A",30,0)
 Q:EXCEL="^"
"RTN","RCDMCR7A",31,0)
 D:EXCEL EXMSG^RCDMCUT2
"RTN","RCDMCR7A",32,0)
 D:'EXCEL
"RTN","RCDMCR7A",33,0)
 . W !!,"This report may take a while to process. It is recommended that"
"RTN","RCDMCR7A",34,0)
 . W !,"you Queue this report to a device that is 132 characters wide."
"RTN","RCDMCR7A",35,0)
 N %ZIS,ZTSK,ZTRTN,ZTIO,ZTDESC,POP,ZTSAVE
"RTN","RCDMCR7A",36,0)
 S %ZIS="QM"
"RTN","RCDMCR7A",37,0)
 W ! D ^%ZIS
"RTN","RCDMCR7A",38,0)
 I POP S STOPIT=1 Q
"RTN","RCDMCR7A",39,0)
 S RCSCR=$S($E($G(IOST),1,2)="C-":1,1:0)
"RTN","RCDMCR7A",40,0)
 ;
"RTN","RCDMCR7A",41,0)
 I $D(IO("Q")) D  S STOPIT=1
"RTN","RCDMCR7A",42,0)
 . S ZTRTN="RUN^RCDMCR7A"
"RTN","RCDMCR7A",43,0)
 . S ZTIO=ION
"RTN","RCDMCR7A",44,0)
 . S ZTSAVE("RCSCR")=""
"RTN","RCDMCR7A",45,0)
 . S ZTSAVE("ARTYPE")=""
"RTN","RCDMCR7A",46,0)
 . S ZTSAVE("EXCEL")=""
"RTN","RCDMCR7A",47,0)
 . S ZTSAVE("STOPIT")=""
"RTN","RCDMCR7A",48,0)
 . S ZTDESC="50-100 Percent SC, A&A, Pension Exempt Charge Reconciliation Report Process"
"RTN","RCDMCR7A",49,0)
 . D ^%ZTLOAD
"RTN","RCDMCR7A",50,0)
 . W !!,$S($D(ZTSK):"Request Queued.  TASK = "_ZTSK,1:"REQUEST CANCELLED")
"RTN","RCDMCR7A",51,0)
 . D HOME^%ZIS
"RTN","RCDMCR7A",52,0)
 ;
"RTN","RCDMCR7A",53,0)
 Q:STOPIT>0!($D(ZTQUEUED))
"RTN","RCDMCR7A",54,0)
 D RUN^RCDMCR7A
"RTN","RCDMCR7A",55,0)
 I STOPIT'=2 D PAUSE2^RCDMCUT2
"RTN","RCDMCR7A",56,0)
 Q
"RTN","RCDMCR7A",57,0)
 ;  
"RTN","RCDMCR7A",58,0)
QUERPT ; Initial Taskman Scheduled Queued processing
"RTN","RCDMCR7A",59,0)
 Q
"RTN","RCDMCR7A",60,0)
 ;
"RTN","RCDMCR7A",61,0)
RUN ;Get data and Print it out
"RTN","RCDMCR7A",62,0)
 ;If queued ensure you delete it from the TASKS file
"RTN","RCDMCR7A",63,0)
 I $D(ZTQUEUED) S ZTREQ="@"
"RTN","RCDMCR7A",64,0)
 N RCPAGE
"RTN","RCDMCR7A",65,0)
 K ^TMP($J,"RCDMCR7")
"RTN","RCDMCR7A",66,0)
 S RCPAGE=0,STOPIT=$G(STOPIT)
"RTN","RCDMCR7A",67,0)
 ; Collect the data in ^TMP
"RTN","RCDMCR7A",68,0)
 D COLLECT^RCDMCR7B(.STOPIT,ARTYPE)
"RTN","RCDMCR7A",69,0)
 Q:$G(STOPIT)>0
"RTN","RCDMCR7A",70,0)
 U IO
"RTN","RCDMCR7A",71,0)
 ; Print Report using data in ^TMP
"RTN","RCDMCR7A",72,0)
 D REPORT
"RTN","RCDMCR7A",73,0)
 I 'RCSCR W !,@IOF
"RTN","RCDMCR7A",74,0)
 D ^%ZISC
"RTN","RCDMCR7A",75,0)
 K ^TMP($J,"RCDMCR7")
"RTN","RCDMCR7A",76,0)
 K EXCEL,RCSCR,TESTDATE
"RTN","RCDMCR7A",77,0)
 Q
"RTN","RCDMCR7A",78,0)
 ;
"RTN","RCDMCR7A",79,0)
REPORT ;Print report
"RTN","RCDMCR7A",80,0)
 N RUNDATE,STATUS,NAME,SSN,BILLNO,IBIEN,SKIP,SCPER
"RTN","RCDMCR7A",81,0)
 ;
"RTN","RCDMCR7A",82,0)
 S RUNDATE=$$FMTE^XLFDT($$NOW^XLFDT,"9MP")
"RTN","RCDMCR7A",83,0)
 D HDR
"RTN","RCDMCR7A",84,0)
 I +$D(^TMP($J,"RCDMCR7"))'>0 W !,"No data meets the criteria." Q
"RTN","RCDMCR7A",85,0)
 K SKIP
"RTN","RCDMCR7A",86,0)
 S NAME=""
"RTN","RCDMCR7A",87,0)
 F  S NAME=$O(^TMP($J,"RCDMCR7","DETAIL",NAME)) Q:NAME']""  D  Q:STOPIT
"RTN","RCDMCR7A",88,0)
 . S SSN=""
"RTN","RCDMCR7A",89,0)
 . F  S SSN=$O(^TMP($J,"RCDMCR7","DETAIL",NAME,SSN)) Q:SSN']""  D  Q:STOPIT
"RTN","RCDMCR7A",90,0)
 . . S BILLNO=""
"RTN","RCDMCR7A",91,0)
 . . F  S BILLNO=$O(^TMP($J,"RCDMCR7","DETAIL",NAME,SSN,BILLNO)) Q:BILLNO']""  D  Q:STOPIT
"RTN","RCDMCR7A",92,0)
 . . . S IBIEN=""
"RTN","RCDMCR7A",93,0)
 . . . F  S IBIEN=$O(^TMP($J,"RCDMCR7","DETAIL",NAME,SSN,BILLNO,IBIEN)) Q:IBIEN']""  D  Q:STOPIT
"RTN","RCDMCR7A",94,0)
 . . . . N NODE,SERVDT,ELIG,EXEMPTDT,RXNUM,RXNAM,STATUS
"RTN","RCDMCR7A",95,0)
 . . . . ; S ^TMP($J,"RCDMCR7","DETAIL",NAME,SSN,BILLNO,IBIEN)=SERVDT_U_SCPER_U_EXEMPTDT_U_STATUS
"RTN","RCDMCR7A",96,0)
 . . . . S NODE=$G(^TMP($J,"RCDMCR7","DETAIL",NAME,SSN,BILLNO,IBIEN))
"RTN","RCDMCR7A",97,0)
 . . . . S SERVDT=$P(NODE,U,1)
"RTN","RCDMCR7A",98,0)
 . . . . S SCPER=$P(NODE,U,2)
"RTN","RCDMCR7A",99,0)
 . . . . S EXEMPTDT=$P(NODE,U,3)
"RTN","RCDMCR7A",100,0)
 . . . . S STATUS=$P(NODE,U,4)
"RTN","RCDMCR7A",101,0)
 . . . . I EXCEL'>0 D WRLINE Q
"RTN","RCDMCR7A",102,0)
 . . . . I EXCEL>0 D WRLINE2 Q
"RTN","RCDMCR7A",103,0)
 Q
"RTN","RCDMCR7A",104,0)
 ;
"RTN","RCDMCR7A",105,0)
WRLINE ; Write the data formated report line
"RTN","RCDMCR7A",106,0)
 ; Columns are - position, width, spacing (offset header by)
"RTN","RCDMCR7A",107,0)
 ;Veteran Name - 0,23,1 
"RTN","RCDMCR7A",108,0)
 ;SSN - 24,10,1
"RTN","RCDMCR7A",109,0)
 ;SC Percent - 35,11,1 
"RTN","RCDMCR7A",110,0)
 ;Bill # - 47,11,1
"RTN","RCDMCR7A",111,0)
 ;EXMPTDT - 59,7,1
"RTN","RCDMCR7A",112,0)
 ;Med Care Date - 67,13,1
"RTN","RCDMCR7A",113,0)
 ;Status - 81,9
"RTN","RCDMCR7A",114,0)
 D CHKP() Q:STOPIT
"RTN","RCDMCR7A",115,0)
 W !
"RTN","RCDMCR7A",116,0)
 ;If Multiple Bills for Vet only print Name & SSN for 1st record on page
"RTN","RCDMCR7A",117,0)
 ; Disable skip for now (as per direction of customer) with :0
"RTN","RCDMCR7A",118,0)
 I (NAME_SSN)'=$G(SKIP(1)) D
"RTN","RCDMCR7A",119,0)
 . W $E(NAME,1,23) ; Veteran Name
"RTN","RCDMCR7A",120,0)
 . W ?24,SSN ; SSN
"RTN","RCDMCR7A",121,0)
 . S:0 SKIP(1)=NAME_SSN
"RTN","RCDMCR7A",122,0)
 W ?38,SCPER,"%"
"RTN","RCDMCR7A",123,0)
 W ?47,$P(BILLNO,"/",1) ; Bill Number
"RTN","RCDMCR7A",124,0)
 W ?59,$$STRIP^XLFSTR($$FMTE^XLFDT(EXEMPTDT,"8D")," ")
"RTN","RCDMCR7A",125,0)
 W:SERVDT>0 ?67,$$STRIP^XLFSTR($$FMTE^XLFDT(SERVDT,"8D")," ")
"RTN","RCDMCR7A",126,0)
 W ?81,$E(STATUS,1,9)
"RTN","RCDMCR7A",127,0)
 Q
"RTN","RCDMCR7A",128,0)
 ;
"RTN","RCDMCR7A",129,0)
WRLINE2 ; Write the Excel report line
"RTN","RCDMCR7A",130,0)
 W !
"RTN","RCDMCR7A",131,0)
 W NAME,U
"RTN","RCDMCR7A",132,0)
 W SSN,U
"RTN","RCDMCR7A",133,0)
 W SCPER,"%",U
"RTN","RCDMCR7A",134,0)
 W $P(BILLNO,"/",1),U
"RTN","RCDMCR7A",135,0)
 W $$FMTE^XLFDT(EXEMPTDT,"9D"),U
"RTN","RCDMCR7A",136,0)
 W $$FMTE^XLFDT(SERVDT,"9D"),U
"RTN","RCDMCR7A",137,0)
 W STATUS,U
"RTN","RCDMCR7A",138,0)
 Q
"RTN","RCDMCR7A",139,0)
 ;
"RTN","RCDMCR7A",140,0)
CHKP(FOOTER) ;Check for End of Page
"RTN","RCDMCR7A",141,0)
 ;INPUT:
"RTN","RCDMCR7A",142,0)
 ;  FOOTER - Footer value. Optional. Default to 4 if nothing passed
"RTN","RCDMCR7A",143,0)
 I $G(FOOTER)'>0 S FOOTER=4
"RTN","RCDMCR7A",144,0)
 I $Y>(IOSL-FOOTER) D:RCSCR PAUSE^RCDMCUT2 Q:STOPIT  D HDR K SKIP
"RTN","RCDMCR7A",145,0)
 Q
"RTN","RCDMCR7A",146,0)
 ;
"RTN","RCDMCR7A",147,0)
HDR ;Print Report Header
"RTN","RCDMCR7A",148,0)
 I EXCEL>0 D  Q
"RTN","RCDMCR7A",149,0)
 . W !,"Veteran Name",U,"SSN",U,"SC Percent",U,"Bill #",U,"EXMPTDT",U,"Med Care Date",U,"Status"
"RTN","RCDMCR7A",150,0)
 S RCPAGE=RCPAGE+1
"RTN","RCDMCR7A",151,0)
 W @IOF,"10-40% SC Medical Care Copayment Exempt Charge Reconciliation Report  -- Run Date: ",RUNDATE," --"
"RTN","RCDMCR7A",152,0)
 W ?122,"Page "_RCPAGE
"RTN","RCDMCR7A",153,0)
 W !
"RTN","RCDMCR7A",154,0)
 ;Print to screen or printer
"RTN","RCDMCR7A",155,0)
 W !,"Veteran Name",?24,"SSN",?35,"SC Percent",?47,"Bill #",?59,"EXMPTDT",?67,"Med Care Date",?81,"Status"
"RTN","RCDMCR7A",156,0)
 D ULINE^RCDMCUT2("=",$G(IOM))
"RTN","RCDMCR7A",157,0)
 Q
"RTN","RCDMCR7B")
0^11^B26651749^n/a
"RTN","RCDMCR7B",1,0)
RCDMCR7B ;ALB/YG - 10-40% SC Medical Care Copayment Exempt Charge Reconciliation Report - Collect Data ;Apr 9, 2019@21:06
"RTN","RCDMCR7B",2,0)
 ;;4.5;Accounts Receivable;**347**;Jan 29, 2019;Build 47
"RTN","RCDMCR7B",3,0)
 ;;Per VA Directive 6402, this routine should not be modified.
"RTN","RCDMCR7B",4,0)
 ;
"RTN","RCDMCR7B",5,0)
 ; See RCDMCR7A for detailed description
"RTN","RCDMCR7B",6,0)
 ;
"RTN","RCDMCR7B",7,0)
COLLECT(STOPIT,ARTYPE) ; Get the report data
"RTN","RCDMCR7B",8,0)
 ;Input
"RTN","RCDMCR7B",9,0)
 ;   STOPIT - Passed Variable to determine if process is to be terminated
"RTN","RCDMCR7B",10,0)
 ;   ARTYPE - AR Type  1:Active;2:Open;3:Suspended;4:Collected/Closed;5:On-Hold;6:Write Off;7:All
"RTN","RCDMCR7B",11,0)
 ;Output
"RTN","RCDMCR7B",12,0)
 ;   STOPIT - Passed Variable set to 1 if process is to be terminated
"RTN","RCDMCR7B",13,0)
 ;   ^TMP($J,"RCDMCR7") with report data and summary data
"RTN","RCDMCR7B",14,0)
 ;N RCDFN,DEBTOR,ARIEN,IBIEN,CTR,EOCOK,IBCNT,EOCDT,DFN,DMCELIG,EFFDT,NAME,SSN
"RTN","RCDMCR7B",15,0)
 ;N STATUS,OPTDT,DISCHDT,RXDT,OPTDT,RXDT,CHGAMT,OCC,BILLNO,RXNUM,RXNAM,DSTATUS,IBDATA
"RTN","RCDMCR7B",16,0)
 ;Get Rated Disability Data within passed RD change time frame
"RTN","RCDMCR7B",17,0)
 ;*** call API to get all RD change data for given date period
"RTN","RCDMCR7B",18,0)
 N ZR,DEBTPT,WZH,DEBTCNT,DEBTOR,RCDFN,DFN,EXEMPTDT,SZH,VAERR,VADM,ARIEN,CTR
"RTN","RCDMCR7B",19,0)
 N BILLNO,IBDATA,IBCNT,IBIEN,NAME,SSN,OUT,STATUS,VAEL,SCPER
"RTN","RCDMCR7B",20,0)
 S DEBTPT=0,WZH=$H*86400+$P($H,",",2)+60,SZH=WZH W !
"RTN","RCDMCR7B",21,0)
 K ^TMP($J,"RCDMCR7","ARIB")
"RTN","RCDMCR7B",22,0)
 F DEBTCNT=0:1 S DEBTPT=$O(^RCD(340,"B",DEBTPT)) Q:DEBTPT=""  I DEBTPT[";DPT(" D
"RTN","RCDMCR7B",23,0)
 . ;Get AR Debtor info from file 340
"RTN","RCDMCR7B",24,0)
 . S DEBTOR=0,RCDFN=$P(DEBTPT,";")
"RTN","RCDMCR7B",25,0)
 . F  S DEBTOR=$O(^RCD(340,"B",DEBTPT,DEBTOR)) Q:DEBTOR'>0  D  Q:$G(STOPIT)>0
"RTN","RCDMCR7B",26,0)
 . . S DFN=RCDFN
"RTN","RCDMCR7B",27,0)
 . . ;Get Eligibility Data
"RTN","RCDMCR7B",28,0)
 . . D ELIG^VADPT
"RTN","RCDMCR7B",29,0)
 . . ;Quit if ^DPT(DFN,0) not defined
"RTN","RCDMCR7B",30,0)
 . . Q:$G(VAERR)>0
"RTN","RCDMCR7B",31,0)
 . . ;Get monetary benefit data
"RTN","RCDMCR7B",32,0)
 . . D MB^VADPT
"RTN","RCDMCR7B",33,0)
 . . ;SERVICE CONNECTED?  
"RTN","RCDMCR7B",34,0)
 . . S SCPER=$P($G(VAEL(3)),U,2)
"RTN","RCDMCR7B",35,0)
 . . I SCPER<10!(SCPER>49) Q
"RTN","RCDMCR7B",36,0)
 . . S EXEMPTDT=$$GET1^DIQ(2,DFN_",",.3014,"I")
"RTN","RCDMCR7B",37,0)
 . . I DFN'>0 D KVAR^VADPT Q
"RTN","RCDMCR7B",38,0)
 . . D DEM^VADPT
"RTN","RCDMCR7B",39,0)
 . . I $G(VAERR)>0 D KVAR^VADPT Q
"RTN","RCDMCR7B",40,0)
 . . S NAME=$G(VADM(1))
"RTN","RCDMCR7B",41,0)
 . . I NAME']"" D KVAR^VADPT Q
"RTN","RCDMCR7B",42,0)
 . . S SSN=$P(VADM(2),U,1)
"RTN","RCDMCR7B",43,0)
 . . D KVAR^VADPT
"RTN","RCDMCR7B",44,0)
 . . ;I EXEMPTDT="" S ^TMP($J,"RCDMCR6","DETAIL",NAME,SSN," ",1)=U_U_U_"NODATE" Q
"RTN","RCDMCR7B",45,0)
 . . ;Get AR Bill Data that is within the last BEGDT time period
"RTN","RCDMCR7B",46,0)
 . . ;for Bill's with a current status of ACTIVE, OPEN, SUSPENDED, WRITE-OFF, COLLECTED/CLOSED, or IB Status of ON-HOLD
"RTN","RCDMCR7B",47,0)
 . . K ^TMP($J,"RCDMCR7","ARIB")
"RTN","RCDMCR7B",48,0)
 . . I $H*86400+$P($H,",",2)>WZH S WZH=$H*86400+$P($H,",",2)+30,$X=0 W *13,$FN(DEBTCNT*100/$P(^RCD(340,0),U,4),",",2),"% done in ",WZH-SZH," seconds"
"RTN","RCDMCR7B",49,0)
 . . S ARIEN=0
"RTN","RCDMCR7B",50,0)
 . . I ARTYPE'=5 F  S ARIEN=$O(^PRCA(430,"C",DEBTOR,ARIEN)) Q:'ARIEN  D  Q:$G(STOPIT)>0
"RTN","RCDMCR7B",51,0)
 . . . S CTR=$G(CTR)+1 ;Counter
"RTN","RCDMCR7B",52,0)
 . . . I CTR#500=0 S STOPIT=$$STOPIT^RCDMCUT2() I STOPIT Q
"RTN","RCDMCR7B",53,0)
 . . . S BILLNO=$$GET1^DIQ(430,ARIEN_",",.01)
"RTN","RCDMCR7B",54,0)
 . . . I BILLNO']"" Q
"RTN","RCDMCR7B",55,0)
 . . . ; only look at 1st party bills - TBD
"RTN","RCDMCR7B",56,0)
 . . . I '$$FIRSTPAR^RCDMCUT1(ARIEN) Q
"RTN","RCDMCR7B",57,0)
 . . . ;IEN is from calling routine (for file 430)
"RTN","RCDMCR7B",58,0)
 . . . S STATUS=$$GET1^DIQ(430,ARIEN_",",8,"E")
"RTN","RCDMCR7B",59,0)
 . . . I ARTYPE=1,STATUS'="ACTIVE" Q
"RTN","RCDMCR7B",60,0)
 . . . I ARTYPE=2,STATUS'="OPEN" Q
"RTN","RCDMCR7B",61,0)
 . . . I ARTYPE=3,STATUS'="SUSPENDED" Q
"RTN","RCDMCR7B",62,0)
 . . . I ARTYPE=4,STATUS'="COLLECTED/CLOSED" Q
"RTN","RCDMCR7B",63,0)
 . . . I ARTYPE=6,STATUS'="WRITE-OFF" Q
"RTN","RCDMCR7B",64,0)
 . . . I ARTYPE=7,"^ACTIVE^OPEN^SUSPENDED^WRITE-OFF^COLLECTED/CLOSED^CANCELLATION^"'[(U_STATUS_U) Q
"RTN","RCDMCR7B",65,0)
 . . . ;S SERDT=$$GETIB(BILLNO,.IBDATA)
"RTN","RCDMCR7B",66,0)
 . . . K IBDATA S IBDATA=0
"RTN","RCDMCR7B",67,0)
 . . . S IBIEN=""
"RTN","RCDMCR7B",68,0)
 . . . F  S IBIEN=$O(^IB("ABIL",BILLNO,IBIEN)) Q:'IBIEN  D
"RTN","RCDMCR7B",69,0)
 . . . . S OUT=$$GETIB^RCDMCR4B(IBIEN,0)
"RTN","RCDMCR7B",70,0)
 . . . . I OUT,$P(OUT,U,5)'=10 S:$P(OUT,U,1,2)'=U IBDATA=IBDATA+1,IBDATA(IBDATA)=OUT
"RTN","RCDMCR7B",71,0)
 . . . I 'IBDATA Q
"RTN","RCDMCR7B",72,0)
 . . . M ^TMP($J,"RCDMCR7","ARIB",BILLNO,"IBDATA")=IBDATA
"RTN","RCDMCR7B",73,0)
 . . . S ^TMP($J,"RCDMCR7","ARIB",BILLNO,"STATUS")=STATUS
"RTN","RCDMCR7B",74,0)
 . . S IBIEN=""
"RTN","RCDMCR7B",75,0)
 . . I ARTYPE=5!(ARTYPE=7) F  S IBIEN=$O(^IB("AH",RCDFN,IBIEN)) Q:IBIEN=""  D  Q:$G(STOPIT)>0
"RTN","RCDMCR7B",76,0)
 . . . K IBDATA S IBDATA=0
"RTN","RCDMCR7B",77,0)
 . . . S CTR=$G(CTR)+1 ;Counter
"RTN","RCDMCR7B",78,0)
 . . . I CTR#500=0 S STOPIT=$$STOPIT^RCDMCUT2() Q:STOPIT
"RTN","RCDMCR7B",79,0)
 . . . S BILLNO="/"_IBIEN
"RTN","RCDMCR7B",80,0)
 . . . S OUT=$$GETIB^RCDMCR4B(IBIEN,1)
"RTN","RCDMCR7B",81,0)
 . . . I 'OUT Q
"RTN","RCDMCR7B",82,0)
 . . . I $P(OUT,U,1,2)=U Q
"RTN","RCDMCR7B",83,0)
 . . . S IBDATA=1,IBDATA(1)=OUT
"RTN","RCDMCR7B",84,0)
 . . . M ^TMP($J,"RCDMCR7","ARIB",BILLNO,"IBDATA")=IBDATA
"RTN","RCDMCR7B",85,0)
 . . . S ^TMP($J,"RCDMCR7","ARIB",BILLNO,"STATUS")="ON HOLD"
"RTN","RCDMCR7B",86,0)
 . . S BILLNO=""
"RTN","RCDMCR7B",87,0)
 . . F  S BILLNO=$O(^TMP($J,"RCDMCR7","ARIB",BILLNO)) Q:BILLNO=""  D
"RTN","RCDMCR7B",88,0)
 . . . K IBDATA M IBDATA=^TMP($J,"RCDMCR7","ARIB",BILLNO,"IBDATA")
"RTN","RCDMCR7B",89,0)
 . . . S STATUS=^TMP($J,"RCDMCR7","ARIB",BILLNO,"STATUS")
"RTN","RCDMCR7B",90,0)
 . . . F IBCNT=1:1:IBDATA D
"RTN","RCDMCR7B",91,0)
 . . . . N DSTATUS,DISCHDT,SERVDT,OPTDT
"RTN","RCDMCR7B",92,0)
 . . . . ;IBDATA - Array of 1 ^ Outpatient Date ^ Discharge Date ^ RX/Refill Date ^ IB Status ^ RX NUM ^ RX Name ^ CHGAMT
"RTN","RCDMCR7B",93,0)
 . . . . S OPTDT=$P(IBDATA(IBCNT),U,2)
"RTN","RCDMCR7B",94,0)
 . . . . S DISCHDT=$P(IBDATA(IBCNT),U,3)
"RTN","RCDMCR7B",95,0)
 . . . . S SERVDT=$S(OPTDT>DISCHDT:OPTDT,DISCHDT>OPTDT:DISCHDT,1:"")
"RTN","RCDMCR7B",96,0)
 . . . . ;S RXDT=$P(IBDATA(IBCNT),U,4)
"RTN","RCDMCR7B",97,0)
 . . . . ;S IBSTATUS=$P(IBDATA(IBCNT),U,5)
"RTN","RCDMCR7B",98,0)
 . . . . ;S RXNUM=$P(IBDATA(IBCNT),U,6)
"RTN","RCDMCR7B",99,0)
 . . . . ;S RXNAM=$P(IBDATA(IBCNT),U,7)
"RTN","RCDMCR7B",100,0)
 . . . . S DSTATUS=STATUS
"RTN","RCDMCR7B",101,0)
 . . . . ; this node will be set over and over again, but it is one node per NODATE debtor
"RTN","RCDMCR7B",102,0)
 . . . . I EXEMPTDT="" S ^TMP($J,"RCDMCR7","DETAIL",NAME,SSN," ",1)=U_SCPER_U_"NODATE" Q
"RTN","RCDMCR7B",103,0)
 . . . . ; Get EOC date and verify that it is later than Patient Effective Date
"RTN","RCDMCR7B",104,0)
 . . . . I SERVDT'>EXEMPTDT Q
"RTN","RCDMCR7B",105,0)
 . . . . S DSTATUS=$S(DSTATUS="CANCELLATION":"ARCXLD",DSTATUS="COLLECTED/CLOSED":"C/C",1:DSTATUS)
"RTN","RCDMCR7B",106,0)
 . . . . S ^TMP($J,"RCDMCR7","DETAIL",NAME,SSN,BILLNO,IBCNT)=SERVDT_U_SCPER_U_EXEMPTDT_U_DSTATUS
"RTN","RCDMCR7B",107,0)
 K ^TMP($J,"RCDMCR7","ARIB")
"RTN","RCDMCR7B",108,0)
 Q
"RTN","RCDMCUT1")
0^1^B47425932^B42349665
"RTN","RCDMCUT1",1,0)
RCDMCUT1 ;HEC/SBW - Utility Functions for Hold Debt to DMC Project ;30/AUG/2007
"RTN","RCDMCUT1",2,0)
 ;;4.5;Accounts Receivable;**253,347**;Mar 20, 1995;Build 47
"RTN","RCDMCUT1",3,0)
 ;;Per VA Directive 6402, this routine should not be modified.
"RTN","RCDMCUT1",4,0)
 ;
"RTN","RCDMCUT1",5,0)
 Q
"RTN","RCDMCUT1",6,0)
 ;
"RTN","RCDMCUT1",7,0)
HOLDCHK(IEN,DFN) ;Check if receivable shouldn't be sent to DMC
"RTN","RCDMCUT1",8,0)
 ;Dont refer receivables for veterans who are (return 1)
"RTN","RCDMCUT1",9,0)
 ;  1. "DMC Debt Valid" field = NULL and
"RTN","RCDMCUT1",10,0)
 ;     SC 50% to 100% or in receipt of VA Pension and "DMC Debt Valid"
"RTN","RCDMCUT1",11,0)
 ;     For this case only update DMC Debt Valid Field to Pending 
"RTN","RCDMCUT1",12,0)
 ;  2. "DMC Debt Valid" is Pending or NO
"RTN","RCDMCUT1",13,0)
 ;Refer receivables for veterans who are (return 0)
"RTN","RCDMCUT1",14,0)
 ;  1. "DMC Debt Valid" is "YES"
"RTN","RCDMCUT1",15,0)
 ;  2. "DMC Debt Valid" is NULL and 
"RTN","RCDMCUT1",16,0)
 ;     not SC 50% to 100% and not in receipt of a VA Pensions
"RTN","RCDMCUT1",17,0)
 ;
"RTN","RCDMCUT1",18,0)
 ;INPUT
"RTN","RCDMCUT1",19,0)
 ;  IEN  - Internal Entry Number for Accounts Recievable File
"RTN","RCDMCUT1",20,0)
 ;  DFN  - Internal Entry Number to Patient (#2) file
"RTN","RCDMCUT1",21,0)
 ;OUTPUT
"RTN","RCDMCUT1",22,0)
 ;   1 - Don't sent the Debt to DMC
"RTN","RCDMCUT1",23,0)
 ;   0 - Debt can be sent to DMC
"RTN","RCDMCUT1",24,0)
 ;
"RTN","RCDMCUT1",25,0)
 N OUT,DMCVALID,DMCELIG
"RTN","RCDMCUT1",26,0)
 S OUT=0
"RTN","RCDMCUT1",27,0)
 ;Quit if invalid IEN or DFN passed
"RTN","RCDMCUT1",28,0)
 Q:$G(IEN)'>0!($G(DFN)'>0) OUT
"RTN","RCDMCUT1",29,0)
 ;Get DMC Debt Valid field
"RTN","RCDMCUT1",30,0)
 S DMCVALID=$$GET1^DIQ(430,+$G(IEN)_",",125,"E")
"RTN","RCDMCUT1",31,0)
 ;If DMC Debt Valid is No or Pending don't refer to DMC
"RTN","RCDMCUT1",32,0)
 S:DMCVALID="NO"!(DMCVALID="PENDING") OUT=1
"RTN","RCDMCUT1",33,0)
 ;If DMC Debt Valid is Yes refer to DMC
"RTN","RCDMCUT1",34,0)
 S:DMCVALID="YES" OUT=0
"RTN","RCDMCUT1",35,0)
 ;Check if Vet is SC 50% to 100% or in Receipt of VA Pension
"RTN","RCDMCUT1",36,0)
 S DMCELIG=+$$DMCELIG^RCDMCUT1(+$G(DFN))
"RTN","RCDMCUT1",37,0)
 ;If DMC Debt Valid is Null & SC 50% to 100% or Receiving VA Pension
"RTN","RCDMCUT1",38,0)
 ;refer to DMC
"RTN","RCDMCUT1",39,0)
 D:DMCVALID=""&(DMCELIG>0)
"RTN","RCDMCUT1",40,0)
 . S OUT=1
"RTN","RCDMCUT1",41,0)
 . ;Update DMC Valid Indicator to Pending
"RTN","RCDMCUT1",42,0)
 . D UPDTDMC^RCDMCUT1(IEN,"P",1)
"RTN","RCDMCUT1",43,0)
 ;If DMC Debt Valid is Null & NOT SC 50%to100% & NOT Receiving VA Pension
"RTN","RCDMCUT1",44,0)
 ;don't refer to DMC
"RTN","RCDMCUT1",45,0)
 S:DMCVALID=""&(DMCELIG'>0) OUT=0
"RTN","RCDMCUT1",46,0)
 Q OUT
"RTN","RCDMCUT1",47,0)
 ;
"RTN","RCDMCUT1",48,0)
DMCELIG(DFN) ;Checks Bill Debtor SC% and Receipt of VA Pension Values
"RTN","RCDMCUT1",49,0)
 ;INPUT:
"RTN","RCDMCUT1",50,0)
 ;   DFN  - Pointer Value to Patient (#2) file
"RTN","RCDMCUT1",51,0)
 ;OUTPUT:
"RTN","RCDMCUT1",52,0)
 ;   Returns 0 if not SC 50% to 100% and not receiving a VA Pension
"RTN","RCDMCUT1",53,0)
 ;   Returns "1^ SC % ^ VA Pension ^ A&A Benefits ^ Housbound Benefits"
"RTN","RCDMCUT1",54,0)
 ;     if SC 50% to 100% or Receiving a VA Pension. 
"RTN","RCDMCUT1",55,0)
 ;     Should also consider Vets who are receiving A&A or
"RTN","RCDMCUT1",56,0)
 ;     Housebound benefits as Receiving VA a VA Pension.
"RTN","RCDMCUT1",57,0)
 ;       The 2nd piece will be the SC % if SC 50% to 100%.
"RTN","RCDMCUT1",58,0)
 ;       The 3rd piece will be a 1 if Receiving a VA Pension.
"RTN","RCDMCUT1",59,0)
 ;     If not SC 50% to 100% or Receiving a VA Pension then
"RTN","RCDMCUT1",60,0)
 ;       The 4th piece will be the A&A Benefits.
"RTN","RCDMCUT1",61,0)
 ;       The 5th piece will be the Housebound Benefits.
"RTN","RCDMCUT1",62,0)
 ;
"RTN","RCDMCUT1",63,0)
 N OUT
"RTN","RCDMCUT1",64,0)
 ;Protect the VADPT variables to prevent errors with ^RCDMC90 routine
"RTN","RCDMCUT1",65,0)
 N VAHOW,VAROOT,VAERR,VAEL,VAMB,VADM,VASV,VAPA,VATEST,VAOA,VAINDT,VAIN
"RTN","RCDMCUT1",66,0)
 N VAIP,VAPD,VARP,VASD,VA,VADMVT
"RTN","RCDMCUT1",67,0)
 S OUT=0
"RTN","RCDMCUT1",68,0)
 ;Quit if no DFN passed
"RTN","RCDMCUT1",69,0)
 Q:$G(DFN)'>0 OUT
"RTN","RCDMCUT1",70,0)
 ;Get Eligibility Data
"RTN","RCDMCUT1",71,0)
 D ELIG^VADPT
"RTN","RCDMCUT1",72,0)
 ;Quit if ^DPT(DFN,0) not defined
"RTN","RCDMCUT1",73,0)
 Q:$G(VAERR)>0 OUT
"RTN","RCDMCUT1",74,0)
 ;Get monetary benefit data
"RTN","RCDMCUT1",75,0)
 D MB^VADPT
"RTN","RCDMCUT1",76,0)
 ;SERVICE CONNECTED?  Field- If SC the SC% returned in the 2nd piece.
"RTN","RCDMCUT1",77,0)
 S:$P($G(VAEL(3)),U,2)>49 $P(OUT,U,1)=1,$P(OUT,U,2)=$P(VAEL(3),U,2)
"RTN","RCDMCUT1",78,0)
 ;RECEIVING A VA PENSION? 
"RTN","RCDMCUT1",79,0)
 S:$P($G(VAMB(4)),U,1)>0 $P(OUT,U,1)=1,$P(OUT,U,3)=$P(VAMB(4),U,1)
"RTN","RCDMCUT1",80,0)
 D:+OUT'>0
"RTN","RCDMCUT1",81,0)
 . ;RECEIVING A&A BENEFITS? 
"RTN","RCDMCUT1",82,0)
 . S:$P($G(VAMB(1)),U,1)>0 $P(OUT,U,1)=1,$P(OUT,U,4)=$P(VAMB(1),U,1)
"RTN","RCDMCUT1",83,0)
 . ;RECEIVING HOUSEBOUND BENEFITS?
"RTN","RCDMCUT1",84,0)
 . S:$P($G(VAMB(2)),U,1)>0 $P(OUT,U,1)=1,$P(OUT,U,5)=$P(VAMB(2),U,1)
"RTN","RCDMCUT1",85,0)
 D KVAR^VADPT
"RTN","RCDMCUT1",86,0)
 Q OUT
"RTN","RCDMCUT1",87,0)
 ;
"RTN","RCDMCUT1",88,0)
UPDTDMC(IEN,VAL,DELBY) ;Update the DMC Debt Valid Field
"RTN","RCDMCUT1",89,0)
 ;INPUT
"RTN","RCDMCUT1",90,0)
 ;  IEN    - Internal Entry Number of Accounts Receivable (#430) file
"RTN","RCDMCUT1",91,0)
 ;  VAL   - DMC Debt Valid Value ("P", "Y", "N" or "@"), 
"RTN","RCDMCUT1",92,0)
 ;          If "@" pass the field will be deleted
"RTN","RCDMCUT1",93,0)
 ;  DELBY - Used to delete the "DMC Debt Valid Edited By" field when
"RTN","RCDMCUT1",94,0)
 ;          updated by the Nightly Background Job
"RTN","RCDMCUT1",95,0)
 ;Output
"RTN","RCDMCUT1",96,0)
 ;  No output
"RTN","RCDMCUT1",97,0)
 ;
"RTN","RCDMCUT1",98,0)
 N DA,DIE,DR,X,Y
"RTN","RCDMCUT1",99,0)
 Q:$G(IEN)'>0
"RTN","RCDMCUT1",100,0)
 Q:"^Y^N^P^@^"'[(U_$G(VAL)_U)
"RTN","RCDMCUT1",101,0)
 L +^PRCA(430,IEN,12.1):30
"RTN","RCDMCUT1",102,0)
 ;Quit if another user is editing this entry
"RTN","RCDMCUT1",103,0)
 I '$T Q
"RTN","RCDMCUT1",104,0)
 S DA=IEN
"RTN","RCDMCUT1",105,0)
 S DIE=430
"RTN","RCDMCUT1",106,0)
 S DR="125////"_VAL
"RTN","RCDMCUT1",107,0)
 S:$G(DELBY)>0 DR=DR_";126///@"
"RTN","RCDMCUT1",108,0)
 D ^DIE
"RTN","RCDMCUT1",109,0)
 L -^PRCA(430,IEN,12.1)
"RTN","RCDMCUT1",110,0)
 Q
"RTN","RCDMCUT1",111,0)
 ;
"RTN","RCDMCUT1",112,0)
GETDEM(DFN) ; Get data from Patient (#2) file
"RTN","RCDMCUT1",113,0)
 ;INPUT:
"RTN","RCDMCUT1",114,0)
 ;   DFN  - Pointer Value to Patient (#2) file
"RTN","RCDMCUT1",115,0)
 ;OUTPUT:
"RTN","RCDMCUT1",116,0)
 ;   DEM^VADPT VADM array as spelled out in PIMS Technical Manual
"RTN","RCDMCUT1",117,0)
 ;
"RTN","RCDMCUT1",118,0)
 ;Calling routines needs to New or Kill following Variables by calling
"RTN","RCDMCUT1",119,0)
 ;  D KVAR^VADPT
"RTN","RCDMCUT1",120,0)
 ; VADM,VAERR,VA
"RTN","RCDMCUT1",121,0)
 ;
"RTN","RCDMCUT1",122,0)
 N OUT,Y
"RTN","RCDMCUT1",123,0)
 S OUT=0
"RTN","RCDMCUT1",124,0)
 ;Quit if no DFN passed
"RTN","RCDMCUT1",125,0)
 Q:$G(DFN)'>0 OUT
"RTN","RCDMCUT1",126,0)
 ;Get Demographic Data
"RTN","RCDMCUT1",127,0)
 D DEM^VADPT
"RTN","RCDMCUT1",128,0)
 ;Quit if ^DPT(DFN,0) not defined
"RTN","RCDMCUT1",129,0)
 Q:$G(VAERR)>0 OUT
"RTN","RCDMCUT1",130,0)
 ;Calls Successful
"RTN","RCDMCUT1",131,0)
 S OUT=1
"RTN","RCDMCUT1",132,0)
 Q OUT
"RTN","RCDMCUT1",133,0)
 ;
"RTN","RCDMCUT1",134,0)
FIRSTPAR(IEN430) ;Check if this is a First Party bill
"RTN","RCDMCUT1",135,0)
 ;INPUT
"RTN","RCDMCUT1",136,0)
 ;  IEN430 - Internal Entry Number for Accounts Receivable File
"RTN","RCDMCUT1",137,0)
 ;OUTPUT
"RTN","RCDMCUT1",138,0)
 ;  Returns a 0 if not First Party Bill
"RTN","RCDMCUT1",139,0)
 ;  Returns a 1 if First Party Bill
"RTN","RCDMCUT1",140,0)
 ;
"RTN","RCDMCUT1",141,0)
 N FLD,FIRST,IEN340
"RTN","RCDMCUT1",142,0)
 ;Set default to zero
"RTN","RCDMCUT1",143,0)
 S FIRST=0
"RTN","RCDMCUT1",144,0)
 S IEN430=+$G(IEN430)
"RTN","RCDMCUT1",145,0)
 ;Get DEBTOR Field Value in Account Receivable File
"RTN","RCDMCUT1",146,0)
 S IEN340=+$P($G(^PRCA(430,IEN430,0)),U,9)
"RTN","RCDMCUT1",147,0)
 ;If .01 field in AR Debtor File points to the Patient file 
"RTN","RCDMCUT1",148,0)
 ;then this is a First Party Debt
"RTN","RCDMCUT1",149,0)
 S FLD=$P($G(^RCD(340,IEN340,0)),U,1)
"RTN","RCDMCUT1",150,0)
 S:FLD["DPT" FIRST=1_U_$P(FLD,";",1)
"RTN","RCDMCUT1",151,0)
 Q FIRST
"RTN","RCDMCUT1",152,0)
 ;
"RTN","RCDMCUT1",153,0)
GETSERDT(BILLNUM) ; Get most recent Outpatient Date, Inpatient Date and RX Date
"RTN","RCDMCUT1",154,0)
 ; from the IB Action (#350) file for the corresponding bill
"RTN","RCDMCUT1",155,0)
 ;INPUT
"RTN","RCDMCUT1",156,0)
 ;   BILLNUM - Bill No. (.01) field in AR (#430) file
"RTN","RCDMCUT1",157,0)
 ;OUTPUT
"RTN","RCDMCUT1",158,0)
 ;   0 - No data
"RTN","RCDMCUT1",159,0)
 ;   1 ^ Outpatient Date ^ Discharge Date ^ RX/Refill Date ^ Status
"RTN","RCDMCUT1",160,0)
 N OUT,IEN
"RTN","RCDMCUT1",161,0)
 S OUT=0,IEN=0
"RTN","RCDMCUT1",162,0)
 ;Quit if a Bill Number wasn't passed
"RTN","RCDMCUT1",163,0)
 Q:$G(BILLNUM)']"" OUT
"RTN","RCDMCUT1",164,0)
 F  S IEN=$O(^IB("ABIL",BILLNUM,IEN)) Q:IEN'>0  D
"RTN","RCDMCUT1",165,0)
 . N IBDATA,IENS,DFN,ACTTYPE,RESULT,DTBILLFR,BILGROUP,OPDT,DISCHARG,RXDT,STATUS,RXNUM,RXNAM
"RTN","RCDMCUT1",166,0)
 . S IENS=IEN_","
"RTN","RCDMCUT1",167,0)
 . D GETS^DIQ(350,IENS,".02;.03;.04;.14","IN","IBDATA")
"RTN","RCDMCUT1",168,0)
 . S DFN=$G(IBDATA(350,IENS,.02,"I"))
"RTN","RCDMCUT1",169,0)
 . S ACTTYPE=$G(IBDATA(350,IENS,.03,"I"))
"RTN","RCDMCUT1",170,0)
 . S RESULT=$G(IBDATA(350,IENS,.04,"I"))
"RTN","RCDMCUT1",171,0)
 . S DTBILLFR=$G(IBDATA(350,IENS,.14,"I"))
"RTN","RCDMCUT1",172,0)
 . S STATUS=$$GET1^DIQ(350,IENS,.05)
"RTN","RCDMCUT1",173,0)
 . ;
"RTN","RCDMCUT1",174,0)
 . ;Child charge. Need to get Parent Charge
"RTN","RCDMCUT1",175,0)
 . I $P(RESULT,":",1)=350 D
"RTN","RCDMCUT1",176,0)
 . . S IENS=+$P(RESULT,":",2)_","
"RTN","RCDMCUT1",177,0)
 . . ;Quit if the entry is the parent
"RTN","RCDMCUT1",178,0)
 . . Q:+IENS=IEN
"RTN","RCDMCUT1",179,0)
 . . D GETS^DIQ(350,IENS,".02;.03;.04;.14","IN","IBDATA")
"RTN","RCDMCUT1",180,0)
 . . S DFN=$G(IBDATA(350,IENS,.02,"I"))
"RTN","RCDMCUT1",181,0)
 . . S ACTTYPE=$G(IBDATA(350,IENS,.03,"I"))
"RTN","RCDMCUT1",182,0)
 . . S RESULT=$G(IBDATA(350,IENS,.04,"I"))
"RTN","RCDMCUT1",183,0)
 . . S DTBILLFR=$G(IBDATA(350,IENS,.14,"I"))
"RTN","RCDMCUT1",184,0)
 . . S STATUS=$$GET1^DIQ(350,IENS,.05)
"RTN","RCDMCUT1",185,0)
 . Q:$G(DFN)']""
"RTN","RCDMCUT1",186,0)
 . ;
"RTN","RCDMCUT1",187,0)
 . ;Get Billing Group in the IB Action Type File. If internal Set 
"RTN","RCDMCUT1",188,0)
 . ;Code value is 4, then this is an Outpatient Visit (From STMT^IBRFN1)
"RTN","RCDMCUT1",189,0)
 . ;and can use Date Billed From for the Outpatient Visit Date
"RTN","RCDMCUT1",190,0)
 . S BILGROUP=$$GET1^DIQ(350.1,+ACTTYPE_",",.11,"I")
"RTN","RCDMCUT1",191,0)
 . ;
"RTN","RCDMCUT1",192,0)
 . ;Outpatient Event
"RTN","RCDMCUT1",193,0)
 . I BILGROUP=4!($P(RESULT,":",1)=44)!($P(RESULT,":",1)=409.68) D  Q
"RTN","RCDMCUT1",194,0)
 . . I $P(RESULT,":",1)=44 S OPDT=$P($P(RESULT,";",2),":",2)
"RTN","RCDMCUT1",195,0)
 . . I $P(RESULT,":",1)=409.68 S OPDT=$$GET1^DIQ(409.68,+$P(RESULT,":",2)_",",.01,"I")
"RTN","RCDMCUT1",196,0)
 . . I $G(OPDT)'>0 S OPDT=DTBILLFR
"RTN","RCDMCUT1",197,0)
 . . I $G(OPDT)>$P(OUT,U,2) S $P(OUT,U,1)=1,$P(OUT,U,2)=OPDT,$P(OUT,U,5)=STATUS
"RTN","RCDMCUT1",198,0)
 . ;
"RTN","RCDMCUT1",199,0)
 . ;Quit if RESULTING FROM field is blank
"RTN","RCDMCUT1",200,0)
 . Q:$G(RESULT)']""
"RTN","RCDMCUT1",201,0)
 . ;
"RTN","RCDMCUT1",202,0)
 . ;Inpatient Event
"RTN","RCDMCUT1",203,0)
 . I $P(RESULT,":",1)=405!($P(RESULT,":",1)=45) D  Q
"RTN","RCDMCUT1",204,0)
 . . S VAIP("E")=$P($P(RESULT,";",1),":",2)
"RTN","RCDMCUT1",205,0)
 . . ;Call to get Inpatient data
"RTN","RCDMCUT1",206,0)
 . . D IN5^VADPT
"RTN","RCDMCUT1",207,0)
 . . Q:VAERR>0
"RTN","RCDMCUT1",208,0)
 . . S DISCHARG=$P($G(VAIP(17,1)),U,1)
"RTN","RCDMCUT1",209,0)
 . . ;Ensure get most current Discharge Date
"RTN","RCDMCUT1",210,0)
 . . I DISCHARG>$P(OUT,U,3) S $P(OUT,U,1)=1,$P(OUT,U,3)=DISCHARG,$P(OUT,U,5)=STATUS
"RTN","RCDMCUT1",211,0)
 . . D KVAR^VADPT
"RTN","RCDMCUT1",212,0)
 . ;
"RTN","RCDMCUT1",213,0)
 . ;RX Event
"RTN","RCDMCUT1",214,0)
 . I $P(RESULT,":",1)=52 D  Q
"RTN","RCDMCUT1",215,0)
 . . N PSOFILE,IENS,FLD
"RTN","RCDMCUT1",216,0)
 . . ;Set up for RX Refills
"RTN","RCDMCUT1",217,0)
 . . I $P(RESULT,";",2)]"" D
"RTN","RCDMCUT1",218,0)
 . . . S PSOFILE=52.1
"RTN","RCDMCUT1",219,0)
 . . . S IENS=+$P($P(RESULT,";",2),":",2)_","_+$P($P(RESULT,";",1),":",2)_","
"RTN","RCDMCUT1",220,0)
 . . . S RXDT=$$GET1^PSODI(PSOFILE,IENS,.01,"I")
"RTN","RCDMCUT1",221,0)
 . . . S RXNAM="1^TBD",RXNUM="1^TBD"
"RTN","RCDMCUT1",222,0)
 . . ;Set up for RX Data (No refill)
"RTN","RCDMCUT1",223,0)
 . . I $P(RESULT,";",2)']"" D
"RTN","RCDMCUT1",224,0)
 . . . S PSOFILE=52
"RTN","RCDMCUT1",225,0)
 . . . S IENS=+$P($P(RESULT,";",1),":",2)_","
"RTN","RCDMCUT1",226,0)
 . . . S RXDT=$$GET1^PSODI(PSOFILE,IENS,1,"I")
"RTN","RCDMCUT1",227,0)
 . . . S RXNUM=$$GET1^PSODI(PSOFILE,IENS,.01,"I")
"RTN","RCDMCUT1",228,0)
 . . . S RXNAM=$$GET1^PSODI(PSOFILE,IENS,6,"E")
"RTN","RCDMCUT1",229,0)
 . . ;Ensure get most current RX/Refill Date
"RTN","RCDMCUT1",230,0)
 . . I RXDT>$P(OUT,U,4) S $P(OUT,U,1)=1,$P(OUT,U,4)=$P(RXDT,U,2),$P(OUT,U,5)=STATUS,$P(OUT,U,6)=$P(RXNUM,U,2),$P(OUT,U,7)=$P(RXNAM,U,2)
"RTN","RCDMCUT1",231,0)
 Q OUT
"RTN","RCDMCUT1",232,0)
 ;
"RTN","RCDMCUT2")
0^5^B70369247^B38071706
"RTN","RCDMCUT2",1,0)
RCDMCUT2 ;HEC/SBW - Utility Functions for Hold Debt to DMC Project ;30/AUG/2007
"RTN","RCDMCUT2",2,0)
 ;;4.5;Accounts Receivable;**253,347**;Mar 20, 1995;Build 47
"RTN","RCDMCUT2",3,0)
 ;;Per VA Directive 6402, this routine should not be modified.
"RTN","RCDMCUT2",4,0)
 ;
"RTN","RCDMCUT2",5,0)
 Q
"RTN","RCDMCUT2",6,0)
 ;
"RTN","RCDMCUT2",7,0)
DEVICE(ROUTINE,DESC,STOPIT,RCSCR,BEGDT,EXCEL,RCTYPE,RCDMC) ;
"RTN","RCDMCUT2",8,0)
 ;INPUT:
"RTN","RCDMCUT2",9,0)
 ;  ROUTINE - Routine Entry to Queue (e.g. MAIN^RDDMCR1)
"RTN","RCDMCUT2",10,0)
 ;  DESC    - Description to use for tasked jobs
"RTN","RCDMCUT2",11,0)
 ;  BEGDT   - Beginning date the report should begin with (required)
"RTN","RCDMCUT2",12,0)
 ;  EXCEL   - If 1 report format will be Excel Delimited (Optional)
"RTN","RCDMCUT2",13,0)
 ;  RCTYPE  - Report Type - D-DETAILED,S-SUMMARY,E-Excel (Optional)
"RTN","RCDMCUT2",14,0)
 ;  RCDMC   - DMC Debt Valid Field Value - A-ALL VALUES,B-BLANK/NULL,
"RTN","RCDMCUT2",15,0)
 ;            Y-YES,N-NO (Optional)
"RTN","RCDMCUT2",16,0)
 ;OUTPUT:
"RTN","RCDMCUT2",17,0)
 ;  STOPIT  - Variable to indicate if process should't continue
"RTN","RCDMCUT2",18,0)
 ;  RCSCR   - Variable to indicate if process is being sent to 
"RTN","RCDMCUT2",19,0)
 ;            the screen or a device. 1 indicate screen
"RTN","RCDMCUT2",20,0)
 ;
"RTN","RCDMCUT2",21,0)
 N %ZIS,ZTSK,ZTRTN,ZTIO,ZTDESC,POP,ZTSAVE
"RTN","RCDMCUT2",22,0)
 I $G(ROUTINE)']"" S STOPIT=1 Q
"RTN","RCDMCUT2",23,0)
 I $G(BEGDT)']"" S STOPIT=1 Q
"RTN","RCDMCUT2",24,0)
 S %ZIS="QM"
"RTN","RCDMCUT2",25,0)
 W ! D ^%ZIS
"RTN","RCDMCUT2",26,0)
 I POP S STOPIT=1 Q
"RTN","RCDMCUT2",27,0)
 S RCSCR=$S($E($G(IOST),1,2)="C-":1,1:0)
"RTN","RCDMCUT2",28,0)
 ;
"RTN","RCDMCUT2",29,0)
 I $D(IO("Q")) D  S STOPIT=1
"RTN","RCDMCUT2",30,0)
 . S ZTRTN=ROUTINE
"RTN","RCDMCUT2",31,0)
 . S ZTIO=ION
"RTN","RCDMCUT2",32,0)
 . S ZTSAVE("RC*")=""
"RTN","RCDMCUT2",33,0)
 . S ZTSAVE("STOPIT")=""
"RTN","RCDMCUT2",34,0)
 . S ZTSAVE("BEGDT")=""
"RTN","RCDMCUT2",35,0)
 . S ZTSAVE("EXCEL")=""
"RTN","RCDMCUT2",36,0)
 . S ZTDESC=$G(DESC)
"RTN","RCDMCUT2",37,0)
 . D ^%ZTLOAD
"RTN","RCDMCUT2",38,0)
 . W !!,$S($D(ZTSK):"Request Queued.  TASK = "_ZTSK,1:"REQUEST CANCELLED")
"RTN","RCDMCUT2",39,0)
 . D HOME^%ZIS
"RTN","RCDMCUT2",40,0)
 Q
"RTN","RCDMCUT2",41,0)
 ;
"RTN","RCDMCUT2",42,0)
STOPIT() ; Checks if user requested task to stop
"RTN","RCDMCUT2",43,0)
 ;Input:
"RTN","RCDMCUT2",44,0)
 ;  No input
"RTN","RCDMCUT2",45,0)
 ;Output
"RTN","RCDMCUT2",46,0)
 ;  Function returns one if the user requested the task to stop
"RTN","RCDMCUT2",47,0)
 ;
"RTN","RCDMCUT2",48,0)
 N RCX,STOPIT
"RTN","RCDMCUT2",49,0)
 S STOPIT=0
"RTN","RCDMCUT2",50,0)
 S RCX=$$S^%ZTLOAD
"RTN","RCDMCUT2",51,0)
 I RCX D  ;
"RTN","RCDMCUT2",52,0)
 . S STOPIT=1
"RTN","RCDMCUT2",53,0)
 . I $G(ZTSK) S ZTSTOP=1
"RTN","RCDMCUT2",54,0)
 Q STOPIT
"RTN","RCDMCUT2",55,0)
 ;
"RTN","RCDMCUT2",56,0)
EXCEL() ; - Returns whether to capture data for Excel report.
"RTN","RCDMCUT2",57,0)
 ;INPUT:
"RTN","RCDMCUT2",58,0)
 ;  None
"RTN","RCDMCUT2",59,0)
 ; Output:
"RTN","RCDMCUT2",60,0)
 ;   Returns 1 - YES (capture data) / 0 - NO (DO NOT capture data) /
"RTN","RCDMCUT2",61,0)
 ;           "^" - Exit report
"RTN","RCDMCUT2",62,0)
 ;
"RTN","RCDMCUT2",63,0)
 N EXCEL,X,Y,DIR,DIRUT,DTOUT,DUOUT,DIROUT
"RTN","RCDMCUT2",64,0)
 ;
"RTN","RCDMCUT2",65,0)
 S EXCEL=0
"RTN","RCDMCUT2",66,0)
 S DIR(0)="Y",DIR("B")="NO",DIR("T")=DTIME W !
"RTN","RCDMCUT2",67,0)
 S DIR("A")="Do you want to capture report data for an Excel document"
"RTN","RCDMCUT2",68,0)
 S DIR("?")="^D HEXC^RCDMCUT2"
"RTN","RCDMCUT2",69,0)
 D ^DIR
"RTN","RCDMCUT2",70,0)
 S:$D(DIRUT)!$D(DTOUT)!$D(DUOUT)!$D(DIROUT) EXCEL="^"
"RTN","RCDMCUT2",71,0)
 S:$G(Y)>0 EXCEL=1
"RTN","RCDMCUT2",72,0)
 ;
"RTN","RCDMCUT2",73,0)
 Q EXCEL
"RTN","RCDMCUT2",74,0)
 ;
"RTN","RCDMCUT2",75,0)
HEXC ; - 'Do you want to capture data...' prompt
"RTN","RCDMCUT2",76,0)
 W !!,"      Enter:  'Y'    -  To capture detail report data to transfer"
"RTN","RCDMCUT2",77,0)
 W !,"                        to an Excel document"
"RTN","RCDMCUT2",78,0)
 W !,"              '<CR>' -  To skip this option"
"RTN","RCDMCUT2",79,0)
 W !,"              '^'    -  To quit this option"
"RTN","RCDMCUT2",80,0)
 Q
"RTN","RCDMCUT2",81,0)
 ;
"RTN","RCDMCUT2",82,0)
EXMSG ; - Displays the message about capturing to an Excel file format
"RTN","RCDMCUT2",83,0)
 ;
"RTN","RCDMCUT2",84,0)
 W !!?5,"This report may take a while to run. It is recommended that you Queue it."
"RTN","RCDMCUT2",85,0)
 W !!?5,"To capture as an Excel format, it is recommended that you queue this"
"RTN","RCDMCUT2",86,0)
 W !?5,"report to a spool device with margins of 256 and page length of 99999"
"RTN","RCDMCUT2",87,0)
 W !?5,"(e.g. spoolname;256;99999). This should help avoid wrapping problems."
"RTN","RCDMCUT2",88,0)
 W !!?5,"Another method would be to set up your terminal to capture the detail"
"RTN","RCDMCUT2",89,0)
 W !?5,"report data. On some terminals, this can be done by clicking on the"
"RTN","RCDMCUT2",90,0)
 W !?5,"'Tools' menu above, then click on 'Capture Incoming Data' to save to"
"RTN","RCDMCUT2",91,0)
 W !?5,"Desktop.  To avoid undesired wrapping of the data saved to the file,"
"RTN","RCDMCUT2",92,0)
 W !?5,"please enter '0;256;99999' at the 'DEVICE:' prompt.",!
"RTN","RCDMCUT2",93,0)
 Q
"RTN","RCDMCUT2",94,0)
 ;
"RTN","RCDMCUT2",95,0)
GETTYPE(STOPIT) ; Choose a (S)ummary or (D)etail or (E)xcel Delimited Report
"RTN","RCDMCUT2",96,0)
 ;INPUT
"RTN","RCDMCUT2",97,0)
 ;   STOPIT  - Variable to be set if user '^' out or time out
"RTN","RCDMCUT2",98,0)
 ;OUTPUT
"RTN","RCDMCUT2",99,0)
 ;   STOPIT  - Variable to be set if user '^' out or time out
"RTN","RCDMCUT2",100,0)
 ;   Function returns the Report Type (D,S,E)
"RTN","RCDMCUT2",101,0)
 ;
"RTN","RCDMCUT2",102,0)
 N Y,X,DIR,DIRUT,DUOUT,DTOUT,DIROUT
"RTN","RCDMCUT2",103,0)
 S DIR(0)="S^D:DETAILED;S:SUMMARY;E:EXCEL DELIMITED"
"RTN","RCDMCUT2",104,0)
 S DIR("A")="Select Type of Report"
"RTN","RCDMCUT2",105,0)
 W !
"RTN","RCDMCUT2",106,0)
 D ^DIR
"RTN","RCDMCUT2",107,0)
 S:$D(DIRUT)!$D(DUOUT)!$D(DTOUT)!$D(DIROUT) STOPIT=1,Y=""
"RTN","RCDMCUT2",108,0)
 Q Y
"RTN","RCDMCUT2",109,0)
GETTYPE2(STOPIT) ; Choose a (S)ummary or (D)etail
"RTN","RCDMCUT2",110,0)
 ;INPUT
"RTN","RCDMCUT2",111,0)
 ;   STOPIT  - Variable to be set if user '^' out or time out
"RTN","RCDMCUT2",112,0)
 ;OUTPUT
"RTN","RCDMCUT2",113,0)
 ;   STOPIT  - Variable to be set if user '^' out or time out
"RTN","RCDMCUT2",114,0)
 ;   Function returns the Report Type (D,S,E)
"RTN","RCDMCUT2",115,0)
 ;
"RTN","RCDMCUT2",116,0)
 N Y,X,DIR,DIRUT,DUOUT,DTOUT,DIROUT
"RTN","RCDMCUT2",117,0)
 S DIR(0)="S^D:DETAILED;S:SUMMARY"
"RTN","RCDMCUT2",118,0)
 S DIR("A")="Select Type of Report"
"RTN","RCDMCUT2",119,0)
 S DIR("B")="DETAILED"
"RTN","RCDMCUT2",120,0)
 W !
"RTN","RCDMCUT2",121,0)
 D ^DIR
"RTN","RCDMCUT2",122,0)
 S:$D(DIRUT)!$D(DUOUT)!$D(DTOUT)!$D(DIROUT) STOPIT=1,Y=""
"RTN","RCDMCUT2",123,0)
 Q $E(Y)
"RTN","RCDMCUT2",124,0)
 ;
"RTN","RCDMCUT2",125,0)
BILLPAYS() ; Do you want to see only bills with payments? 
"RTN","RCDMCUT2",126,0)
 ;INPUT:
"RTN","RCDMCUT2",127,0)
 ;  None
"RTN","RCDMCUT2",128,0)
 ; Output:
"RTN","RCDMCUT2",129,0)
 ;   Returns 1 - YES (Bills with payments) / 0 - NO (All bills) /
"RTN","RCDMCUT2",130,0)
 ;           "^" - Exit report
"RTN","RCDMCUT2",131,0)
 ;
"RTN","RCDMCUT2",132,0)
 N BP,X,Y,DIR,DIRUT,DTOUT,DUOUT,DIROUT
"RTN","RCDMCUT2",133,0)
 ;
"RTN","RCDMCUT2",134,0)
 S BP=0
"RTN","RCDMCUT2",135,0)
 S DIR(0)="Y",DIR("B")="YES",DIR("T")=DTIME W !
"RTN","RCDMCUT2",136,0)
 S DIR("A")="Do you want to see only bills with payments"
"RTN","RCDMCUT2",137,0)
 ;S DIR("?")="^D HEXC^RCDMCUT2"
"RTN","RCDMCUT2",138,0)
 D ^DIR
"RTN","RCDMCUT2",139,0)
 S:$D(DIRUT)!$D(DTOUT)!$D(DUOUT)!$D(DIROUT) BP="^"
"RTN","RCDMCUT2",140,0)
 S:$G(Y)>0 BP=1
"RTN","RCDMCUT2",141,0)
 Q BP
"RTN","RCDMCUT2",142,0)
 ;
"RTN","RCDMCUT2",143,0)
GETDMC(STOPIT) ;Chose DMC Debt Valid field value to include Null, Pending,
"RTN","RCDMCUT2",144,0)
 ; Yes, No and All vallues
"RTN","RCDMCUT2",145,0)
 ;INPUT
"RTN","RCDMCUT2",146,0)
 ;   STOPIT  - Variable to be set if user '^' out or time out
"RTN","RCDMCUT2",147,0)
 ;OUTPUT
"RTN","RCDMCUT2",148,0)
 ;   STOPIT  - Variable to be set if user '^' out or time out
"RTN","RCDMCUT2",149,0)
 ;   Function returns the DMC Debt Valid Field Value (A,B,P,Y,N)
"RTN","RCDMCUT2",150,0)
 ;
"RTN","RCDMCUT2",151,0)
 N Y,X,DIR,DIRUT,DUOUT,DTOUT,DIROUT
"RTN","RCDMCUT2",152,0)
 S DIR(0)="S^A:ALL FIELD VALUES;B:BLANK/NULL;P:PENDING;Y:YES;N:NO"
"RTN","RCDMCUT2",153,0)
 S DIR("A")="Select DMC Debt Valid field value"
"RTN","RCDMCUT2",154,0)
 S DIR("?")=" "
"RTN","RCDMCUT2",155,0)
 S DIR("?",1)="Enter 'A' to list bills of all DMC Debt Valid values"
"RTN","RCDMCUT2",156,0)
 S DIR("?",2)="Enter 'B' to list bills not yet reviewed by the user"
"RTN","RCDMCUT2",157,0)
 S DIR("?",3)="Enter 'P' to list bills excluded by AR nightly background process"
"RTN","RCDMCUT2",158,0)
 S DIR("?",4)="Enter 'Y' to list bills a User determined should be referred to DMC"
"RTN","RCDMCUT2",159,0)
 S DIR("?",5)="Enter 'N' to list bills a User determined should not be referred to DMC"
"RTN","RCDMCUT2",160,0)
 W !
"RTN","RCDMCUT2",161,0)
 D ^DIR
"RTN","RCDMCUT2",162,0)
 S:$D(DIRUT)!$D(DUOUT)!$D(DTOUT)!$D(DIROUT) STOPIT=1,Y=""
"RTN","RCDMCUT2",163,0)
 Q Y
"RTN","RCDMCUT2",164,0)
 ;
"RTN","RCDMCUT2",165,0)
EXTTYPE(TYPE) ;Get Set of Code external format for Report type
"RTN","RCDMCUT2",166,0)
 ;INPUT
"RTN","RCDMCUT2",167,0)
 ;  TYPE  - Internal Report type: D, S, E
"RTN","RCDMCUT2",168,0)
 ;OUTPUT
"RTN","RCDMCUT2",169,0)
 ;  Returns external Report type: D - DETAILED, S - SUMMARY,
"RTN","RCDMCUT2",170,0)
 ;                                E - EXCEL DELIMITED
"RTN","RCDMCUT2",171,0)
 ;
"RTN","RCDMCUT2",172,0)
 S TYPE=$G(TYPE)
"RTN","RCDMCUT2",173,0)
 Q $S(TYPE="D":"DETAILED",TYPE="S":"SUMMARY",TYPE="E":"EXCEL DELIMITED",1:"")
"RTN","RCDMCUT2",174,0)
 ;
"RTN","RCDMCUT2",175,0)
EXTDMC(VAL) ;Get Set of Code external format for DMC Debt Valid field value
"RTN","RCDMCUT2",176,0)
 ;INPUT
"RTN","RCDMCUT2",177,0)
 ;  VAL  - Internal DMC Debt Valid value: A, B, P, Y, N
"RTN","RCDMCUT2",178,0)
 ;OUTPUT
"RTN","RCDMCUT2",179,0)
 ;  Returns external DMC Debt Valid value: A - ALL, B - BLANK/NULL
"RTN","RCDMCUT2",180,0)
 ;                                         P - PENDING, Y - YES, N - NO
"RTN","RCDMCUT2",181,0)
 ;
"RTN","RCDMCUT2",182,0)
 S VAL=$G(VAL)
"RTN","RCDMCUT2",183,0)
 Q $S(VAL="A":"ALL",VAL="B":"BLANK/NULL",VAL="P":"PENDING",VAL="Y":"YES",VAL="N":"NO",1:"")
"RTN","RCDMCUT2",184,0)
 ;
"RTN","RCDMCUT2",185,0)
DATE(PROMPT,PROMPT2,BEG,END,DTYPE) ;Get beginning and Ending dates
"RTN","RCDMCUT2",186,0)
 ;INPUT:
"RTN","RCDMCUT2",187,0)
 ;   PROMPT - Message to display prior to prompting for dates
"RTN","RCDMCUT2",188,0)
 ;   PROMPT2 - (Optional) Message to display on second line
"RTN","RCDMCUT2",189,0)
 ;   BEG - (Optional) default begin date
"RTN","RCDMCUT2",190,0)
 ;   END - (Optional) default end date
"RTN","RCDMCUT2",191,0)
 ;   DTYPE - (Optional) date type
"RTN","RCDMCUT2",192,0)
 ;OUTPUT:
"RTN","RCDMCUT2",193,0)
 ;    1^BEGDT^ENDDT - Data found
"RTN","RCDMCUT2",194,0)
 ;    0             - User up arrowed or timed out
"RTN","RCDMCUT2",195,0)
 ;NOTE:
"RTN","RCDMCUT2",196,0)
 ;    Optional Parameters added by Glaz to support date range from other reports
"RTN","RCDMCUT2",197,0)
 ;
"RTN","RCDMCUT2",198,0)
 N %DT,Y,X,BEGDT,ENDDT,DTOUT,OUT,DIRUT,DUOUT,DIROUT
"RTN","RCDMCUT2",199,0)
 S OUT=0
"RTN","RCDMCUT2",200,0)
 W !,$G(PROMPT)
"RTN","RCDMCUT2",201,0)
 I $G(PROMPT2)'="" W !,$G(PROMPT2)
"RTN","RCDMCUT2",202,0)
 S %DT="AEX"
"RTN","RCDMCUT2",203,0)
 S %DT("A")="Enter "_$S($G(DTYPE)="":"",1:DTYPE_" ")_"Beginning Date: "
"RTN","RCDMCUT2",204,0)
 I $G(BEG)="" S %DT("B")="TODAY"
"RTN","RCDMCUT2",205,0)
 E  S Y=BEG X ^DD("DD") S %DT("B")=Y
"RTN","RCDMCUT2",206,0)
 W !
"RTN","RCDMCUT2",207,0)
 D ^%DT
"RTN","RCDMCUT2",208,0)
 K %DT
"RTN","RCDMCUT2",209,0)
 ;Quit if user time out or didn't enter valid date
"RTN","RCDMCUT2",210,0)
 Q:Y<0 OUT
"RTN","RCDMCUT2",211,0)
 S BEGDT=+Y
"RTN","RCDMCUT2",212,0)
 S %DT="AEX"
"RTN","RCDMCUT2",213,0)
 S %DT("A")="Enter "_$S($G(DTYPE)="":"",1:DTYPE_" ")_"Ending Date: "
"RTN","RCDMCUT2",214,0)
 I $G(END)="" S %DT("B")="TODAY"
"RTN","RCDMCUT2",215,0)
 E  S Y=END X ^DD("DD") S %DT("B")=Y
"RTN","RCDMCUT2",216,0)
 D ^%DT
"RTN","RCDMCUT2",217,0)
 K %DT
"RTN","RCDMCUT2",218,0)
 ;Quit if user time out or didn't enter valid date
"RTN","RCDMCUT2",219,0)
 Q:Y<0 OUT
"RTN","RCDMCUT2",220,0)
 S ENDDT=+Y
"RTN","RCDMCUT2",221,0)
 S OUT=1_U_BEGDT_U_ENDDT
"RTN","RCDMCUT2",222,0)
 ;Switch dates when user enters more recent date for Begin Date
"RTN","RCDMCUT2",223,0)
 ;than End Date
"RTN","RCDMCUT2",224,0)
 S:BEGDT>ENDDT OUT=1_U_ENDDT_U_BEGDT
"RTN","RCDMCUT2",225,0)
 Q OUT
"RTN","RCDMCUT2",226,0)
 ;
"RTN","RCDMCUT2",227,0)
DATE2(PROMPT,PROMPT2,BEG,END,DTYPE) ;Get beginning and Ending dates
"RTN","RCDMCUT2",228,0)
 ;INPUT:
"RTN","RCDMCUT2",229,0)
 ;   PROMPT - Message to display prior to prompting for dates
"RTN","RCDMCUT2",230,0)
 ;   PROMPT2 - (Optional) Message to display on second line
"RTN","RCDMCUT2",231,0)
 ;   BEG - (Optional) default begin date
"RTN","RCDMCUT2",232,0)
 ;   END - (Optional) default end date
"RTN","RCDMCUT2",233,0)
 ;   DTYPE - (Optional) date type
"RTN","RCDMCUT2",234,0)
 ;OUTPUT:
"RTN","RCDMCUT2",235,0)
 ;    1^BEGDT^ENDDT - Data found
"RTN","RCDMCUT2",236,0)
 ;    0             - User up arrowed or timed out
"RTN","RCDMCUT2",237,0)
 ;NOTE:
"RTN","RCDMCUT2",238,0)
 ;    Optional Parameters added to support date range from other reports
"RTN","RCDMCUT2",239,0)
 ;
"RTN","RCDMCUT2",240,0)
 N %DT,Y,X,BEGDT,ENDDT,DTOUT,OUT,DIRUT,DUOUT,DIROUT
"RTN","RCDMCUT2",241,0)
 S OUT=0
"RTN","RCDMCUT2",242,0)
 W !,$G(PROMPT)
"RTN","RCDMCUT2",243,0)
 I $G(PROMPT2)'="" W !,$G(PROMPT2)
"RTN","RCDMCUT2",244,0)
 S %DT="AEX"
"RTN","RCDMCUT2",245,0)
 S %DT("A")="Enter "_$S($G(DTYPE)="":"",1:DTYPE_" ")_"Begin Date: "
"RTN","RCDMCUT2",246,0)
 I $G(BEG)="" S %DT("B")="TODAY"
"RTN","RCDMCUT2",247,0)
 I $G(BEG)'="" S Y=BEG X ^DD("DD") S %DT("B")=Y
"RTN","RCDMCUT2",248,0)
 W !
"RTN","RCDMCUT2",249,0)
 D ^%DT
"RTN","RCDMCUT2",250,0)
 K %DT
"RTN","RCDMCUT2",251,0)
 ;Quit if user time out or didn't enter valid date
"RTN","RCDMCUT2",252,0)
 Q:Y<0 OUT
"RTN","RCDMCUT2",253,0)
 S BEGDT=+Y
"RTN","RCDMCUT2",254,0)
 S %DT="AEX"
"RTN","RCDMCUT2",255,0)
 S %DT("A")="Enter "_$S($G(DTYPE)="":"",1:DTYPE_" ")_"End Date: "
"RTN","RCDMCUT2",256,0)
 I $G(END)="" S %DT("B")="TODAY"
"RTN","RCDMCUT2",257,0)
 I $G(END)'="" S Y=END X ^DD("DD") S %DT("B")=Y
"RTN","RCDMCUT2",258,0)
 D ^%DT
"RTN","RCDMCUT2",259,0)
 K %DT
"RTN","RCDMCUT2",260,0)
 ;Quit if user time out or didn't enter valid date
"RTN","RCDMCUT2",261,0)
 Q:Y<0 OUT
"RTN","RCDMCUT2",262,0)
 S ENDDT=+Y
"RTN","RCDMCUT2",263,0)
 S OUT=1_U_BEGDT_U_ENDDT
"RTN","RCDMCUT2",264,0)
 ;Switch dates when user enters more recent date for Begin Date
"RTN","RCDMCUT2",265,0)
 ;than End Date
"RTN","RCDMCUT2",266,0)
 S:BEGDT>ENDDT OUT=1_U_ENDDT_U_BEGDT
"RTN","RCDMCUT2",267,0)
 Q OUT
"RTN","RCDMCUT2",268,0)
 ;
"RTN","RCDMCUT2",269,0)
GETBEGDT(PROMPT1,PROMPT2,DTPROMPT) ;Get beginning date
"RTN","RCDMCUT2",270,0)
 ;INPUT:
"RTN","RCDMCUT2",271,0)
 ;   PROMPT1 - Message to display prior to prompting for date
"RTN","RCDMCUT2",272,0)
 ;   PROMPT2 - Message to display prior to prompting for date
"RTN","RCDMCUT2",273,0)
 ;  DTPROMPT - Date query verbiage, if defined
"RTN","RCDMCUT2",274,0)
 ;OUTPUT:
"RTN","RCDMCUT2",275,0)
 ;    1^BEGDT - Data found
"RTN","RCDMCUT2",276,0)
 ;    0       - User up arrowed or timed out
"RTN","RCDMCUT2",277,0)
 ;
"RTN","RCDMCUT2",278,0)
 N %DT,Y,X,BEGDT,DTOUT,OUT,DIRUT,DUOUT,DIROUT
"RTN","RCDMCUT2",279,0)
 S OUT=0
"RTN","RCDMCUT2",280,0)
 W !!,$G(PROMPT1)
"RTN","RCDMCUT2",281,0)
 W:$G(PROMPT2)]"" !,PROMPT2
"RTN","RCDMCUT2",282,0)
 S %DT="AEX"
"RTN","RCDMCUT2",283,0)
 S %DT("A")="Enter Beginning Date: " I $G(DTPROMPT)]"" S %DT("A")=DTPROMPT
"RTN","RCDMCUT2",284,0)
 S %DT("B")=$$FMTE^XLFDT($$FMADD^XLFDT(DT,-365,0,0,0),"1D")
"RTN","RCDMCUT2",285,0)
 S %DT(0)=-$$FMADD^XLFDT(DT,-365,0,0,0)
"RTN","RCDMCUT2",286,0)
 W !
"RTN","RCDMCUT2",287,0)
 D ^%DT
"RTN","RCDMCUT2",288,0)
 K %DT
"RTN","RCDMCUT2",289,0)
 ;Quit if user time out or didn't enter valid date
"RTN","RCDMCUT2",290,0)
 Q:Y<0 OUT
"RTN","RCDMCUT2",291,0)
 S BEGDT=+Y
"RTN","RCDMCUT2",292,0)
 S OUT=1_U_BEGDT
"RTN","RCDMCUT2",293,0)
 Q OUT
"RTN","RCDMCUT2",294,0)
ARSTAT(STOPIT) ;Chose AR status
"RTN","RCDMCUT2",295,0)
 ; Yes, No and All vallues
"RTN","RCDMCUT2",296,0)
 ;INPUT
"RTN","RCDMCUT2",297,0)
 ;   STOPIT  - Variable to be set if user '^' out or time out
"RTN","RCDMCUT2",298,0)
 ;OUTPUT
"RTN","RCDMCUT2",299,0)
 ;   STOPIT  - Variable to be set if user '^' out or time out
"RTN","RCDMCUT2",300,0)
 ;   Function returns 1-7 (1:Active;2:Open;3:Suspended;4:Collected/Closed;5:On-Hold;6:Write Off;7:All)
"RTN","RCDMCUT2",301,0)
 ;
"RTN","RCDMCUT2",302,0)
 N Y,X,DIR,DIRUT,DUOUT,DTOUT,DIROUT
"RTN","RCDMCUT2",303,0)
 ;W !,"Report to Include Bills for charges without an IB status of Cancelled, with an"
"RTN","RCDMCUT2",304,0)
 ;W !,"AR Status of Active, Open, Suspended, Write-Off, Collected/Closed, or with IB"
"RTN","RCDMCUT2",305,0)
 ;W !,"Status of On-Hold, and date of service on or after the exemption effective date."
"RTN","RCDMCUT2",306,0)
 S DIR(0)="S^1:Active;2:Open;3:Suspended;4:Collected/Closed;5:On-Hold;6:Write-Off;7:ALL (Includes 1-6 and AR CANCELLATIONS)"
"RTN","RCDMCUT2",307,0)
 S DIR("A")="Select a Status"
"RTN","RCDMCUT2",308,0)
 S DIR("B")=7
"RTN","RCDMCUT2",309,0)
 W !
"RTN","RCDMCUT2",310,0)
 D ^DIR
"RTN","RCDMCUT2",311,0)
 S:$D(DIRUT)!$D(DUOUT)!$D(DTOUT)!$D(DIROUT) STOPIT=1,Y=""
"RTN","RCDMCUT2",312,0)
 Q Y
"RTN","RCDMCUT2",313,0)
 ;
"RTN","RCDMCUT2",314,0)
PAUSE ;If sending report to screen display pause message at screen bottom
"RTN","RCDMCUT2",315,0)
 N X
"RTN","RCDMCUT2",316,0)
 U IO(0)
"RTN","RCDMCUT2",317,0)
 W !!,"Press RETURN to continue, '^' to exit:"
"RTN","RCDMCUT2",318,0)
 R X:DTIME
"RTN","RCDMCUT2",319,0)
 S:'$T X="^"
"RTN","RCDMCUT2",320,0)
 S:X["^" STOPIT=2
"RTN","RCDMCUT2",321,0)
 U IO
"RTN","RCDMCUT2",322,0)
 Q
"RTN","RCDMCUT2",323,0)
 ;
"RTN","RCDMCUT2",324,0)
PAUSE2 ;If sending report to screen display pause message at screen bottom;
"RTN","RCDMCUT2",325,0)
 N X
"RTN","RCDMCUT2",326,0)
 U IO(0)
"RTN","RCDMCUT2",327,0)
 W !!,"Press RETURN to continue:"
"RTN","RCDMCUT2",328,0)
 R X:DTIME
"RTN","RCDMCUT2",329,0)
 S:'$T X="^"
"RTN","RCDMCUT2",330,0)
 S:X["^" STOPIT=2
"RTN","RCDMCUT2",331,0)
 U IO
"RTN","RCDMCUT2",332,0)
 Q
"RTN","RCDMCUT2",333,0)
 ;
"RTN","RCDMCUT2",334,0)
ULINE(X,WIDTH) ;Display line of a given character
"RTN","RCDMCUT2",335,0)
 ;INPUT:
"RTN","RCDMCUT2",336,0)
 ;  X     - Character to display
"RTN","RCDMCUT2",337,0)
 ;  WIDTH - Number of Character to display
"RTN","RCDMCUT2",338,0)
 ;
"RTN","RCDMCUT2",339,0)
 N I
"RTN","RCDMCUT2",340,0)
 S:$G(WIDTH)'>0 WIDTH=80
"RTN","RCDMCUT2",341,0)
 W !
"RTN","RCDMCUT2",342,0)
 F I=1:1:WIDTH W $G(X,"-")
"RTN","RCDMCUT2",343,0)
 Q
"RTN","RCDMCUT2",344,0)
 ;
"VER")
8.0^22.2
"BLD",11399,6)
^306
**END**
**END**

