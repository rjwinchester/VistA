Released PRCA*4.5*348 SEQ #311
Extracted from mail message
**KIDS**:PRCA*4.5*348^

**INSTALL NAME**
PRCA*4.5*348
"BLD",11369,0)
PRCA*4.5*348^ACCOUNTS RECEIVABLE^0^3190813^y
"BLD",11369,1,0)
^^3^3^3190625^^
"BLD",11369,1,1,0)
1. Patient statement compilation issue
"BLD",11369,1,2,0)
 
"BLD",11369,1,3,0)
2. Option 'Build CCPC Transmission batch' queued start time control
"BLD",11369,4,0)
^9.64PA^^
"BLD",11369,6.3)
20
"BLD",11369,"ABPKG")
n
"BLD",11369,"KRN",0)
^9.67PA^1.61^23
"BLD",11369,"KRN",.4,0)
.4
"BLD",11369,"KRN",.401,0)
.401
"BLD",11369,"KRN",.402,0)
.402
"BLD",11369,"KRN",.403,0)
.403
"BLD",11369,"KRN",.5,0)
.5
"BLD",11369,"KRN",.84,0)
.84
"BLD",11369,"KRN",1.6,0)
1.6
"BLD",11369,"KRN",1.61,0)
1.61
"BLD",11369,"KRN",1.62,0)
1.62
"BLD",11369,"KRN",3.6,0)
3.6
"BLD",11369,"KRN",3.8,0)
3.8
"BLD",11369,"KRN",9.2,0)
9.2
"BLD",11369,"KRN",9.8,0)
9.8
"BLD",11369,"KRN",9.8,"NM",0)
^9.68A^3^3
"BLD",11369,"KRN",9.8,"NM",1,0)
RCCPCPS^^0^B85553915
"BLD",11369,"KRN",9.8,"NM",2,0)
RCFN01^^0^B12850449
"BLD",11369,"KRN",9.8,"NM",3,0)
PRCAGU^^0^B13801963
"BLD",11369,"KRN",9.8,"NM","B","PRCAGU",3)

"BLD",11369,"KRN",9.8,"NM","B","RCCPCPS",1)

"BLD",11369,"KRN",9.8,"NM","B","RCFN01",2)

"BLD",11369,"KRN",19,0)
19
"BLD",11369,"KRN",19.1,0)
19.1
"BLD",11369,"KRN",101,0)
101
"BLD",11369,"KRN",409.61,0)
409.61
"BLD",11369,"KRN",771,0)
771
"BLD",11369,"KRN",779.2,0)
779.2
"BLD",11369,"KRN",870,0)
870
"BLD",11369,"KRN",8989.51,0)
8989.51
"BLD",11369,"KRN",8989.52,0)
8989.52
"BLD",11369,"KRN",8994,0)
8994
"BLD",11369,"KRN","B",.4,.4)

"BLD",11369,"KRN","B",.401,.401)

"BLD",11369,"KRN","B",.402,.402)

"BLD",11369,"KRN","B",.403,.403)

"BLD",11369,"KRN","B",.5,.5)

"BLD",11369,"KRN","B",.84,.84)

"BLD",11369,"KRN","B",1.6,1.6)

"BLD",11369,"KRN","B",1.61,1.61)

"BLD",11369,"KRN","B",1.62,1.62)

"BLD",11369,"KRN","B",3.6,3.6)

"BLD",11369,"KRN","B",3.8,3.8)

"BLD",11369,"KRN","B",9.2,9.2)

"BLD",11369,"KRN","B",9.8,9.8)

"BLD",11369,"KRN","B",19,19)

"BLD",11369,"KRN","B",19.1,19.1)

"BLD",11369,"KRN","B",101,101)

"BLD",11369,"KRN","B",409.61,409.61)

"BLD",11369,"KRN","B",771,771)

"BLD",11369,"KRN","B",779.2,779.2)

"BLD",11369,"KRN","B",870,870)

"BLD",11369,"KRN","B",8989.51,8989.51)

"BLD",11369,"KRN","B",8989.52,8989.52)

"BLD",11369,"KRN","B",8994,8994)

"BLD",11369,"QDEF")
^^^^NO^^^^^^NO
"BLD",11369,"QUES",0)
^9.62^^
"BLD",11369,"REQB",0)
^9.611^2^2
"BLD",11369,"REQB",1,0)
PRCA*4.5*184^2
"BLD",11369,"REQB",2,0)
PRCA*4.5*301^2
"BLD",11369,"REQB","B","PRCA*4.5*184",1)

"BLD",11369,"REQB","B","PRCA*4.5*301",2)

"MBREQ")
0
"PKG",142,-1)
1^1
"PKG",142,0)
ACCOUNTS RECEIVABLE^PRCA^BILL COLLECTIONS
"PKG",142,22,0)
^9.49I^1^1
"PKG",142,22,1,0)
4.5^^2950320
"PKG",142,22,1,"PAH",1,0)
348^3190813
"PKG",142,22,1,"PAH",1,1,0)
^^3^3^3190813
"PKG",142,22,1,"PAH",1,1,1,0)
1. Patient statement compilation issue
"PKG",142,22,1,"PAH",1,1,2,0)
 
"PKG",142,22,1,"PAH",1,1,3,0)
2. Option 'Build CCPC Transmission batch' queued start time control
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
3
"RTN","PRCAGU")
0^3^B13801963^B12887006
"RTN","PRCAGU",1,0)
PRCAGU ;WASH-ISC@ALTOONA,PA/CMS-Patient Statement Utility ;8/23/94  8:06 AM
"RTN","PRCAGU",2,0)
V ;;4.5;Accounts Receivable;**181,219,301,348**;Mar 20, 1995;Build 20
"RTN","PRCAGU",3,0)
 ;;Per VA Directive 6402, this routine should not be modified.
"RTN","PRCAGU",4,0)
 ;
"RTN","PRCAGU",5,0)
 ;PRCA*4.5*348 Ensure veterans get a bill even though they
"RTN","PRCAGU",6,0)
 ;             have no last statement (2) event in file 341
"RTN","PRCAGU",7,0)
 ;
"RTN","PRCAGU",8,0)
 Q  ;This routine should not be called from the top
"RTN","PRCAGU",9,0)
SITE ;Set statement variables from Site Parameter File
"RTN","PRCAGU",10,0)
 NEW SP0,SP2
"RTN","PRCAGU",11,0)
 S SP0=$G(^RC(342,1,0)) I SP0="" G SITEQ
"RTN","PRCAGU",12,0)
 S SP2=$G(^RC(342,1,2))
"RTN","PRCAGU",13,0)
 S SITE("SUP")=+$P(SP0,U,2) ;suppres right&oblig
"RTN","PRCAGU",14,0)
 S SITE("DETL")=+$P(SP0,U,5) ;Copay info 1-brief or 2-expanded
"RTN","PRCAGU",15,0)
 S SITE("COM1")=$P($G(SP2),U,1) ;statement comment 1
"RTN","PRCAGU",16,0)
 S SITE("COM2")="" ; statement comment 2 disabled with GMT patch ;($P($G(SP2),U,2))
"RTN","PRCAGU",17,0)
 S SITE("SCAN")=$G(^RC(342,1,5)) ;mark for auto stuffer
"RTN","PRCAGU",18,0)
 S SITE("ZERO")=$P($G(SP0),U,9) ;suppress zero balance
"RTN","PRCAGU",19,0)
SITEQ Q
"RTN","PRCAGU",20,0)
PBAL(DEB,DAT,PBAL,PRCASTMT) ;get previous balance and date of last transaction
"RTN","PRCAGU",21,0)
 N EVN,I,Y G:'DEB PBALQ
"RTN","PRCAGU",22,0)
 S EVN=$O(^RC(341,"AD",DEB,+$O(^RC(341.1,"AC",2,0)),DAT,0))
"RTN","PRCAGU",23,0)
 I '$G(EVN) S:$G(PRCASTMT) DAT=PDAT G PBALQ       ;PRCA*4.5*348
"RTN","PRCAGU",24,0)
 S Y=$G(^RC(341,EVN,1)) F I=1:1:5 S PBAL=PBAL+$P(Y,U,I)
"RTN","PRCAGU",25,0)
 S DAT=$P($G(^RC(341,EVN,0)),U,6)
"RTN","PRCAGU",26,0)
PBALQ Q
"RTN","PRCAGU",27,0)
BBAL(DEB,BBAL) ;get bills balances return array
"RTN","PRCAGU",28,0)
 NEW ADM,AC,BAL,CT,I,INT,MF,OP,PB,PRE,STAT,CS,CSFLAG
"RTN","PRCAGU",29,0)
 S (BBAL,PB,INT,ADM,MF,CT)=0,LET3="",CSFLAG=$D(CSBB)
"RTN","PRCAGU",30,0)
 G:'DEB BBALQ
"RTN","PRCAGU",31,0)
 S AC=+$O(^PRCA(430.3,"AC",102,0)),OP=+$O(^PRCA(430.3,"AC",112,0)),PRE=+$O(^PRCA(430.2,"AC",33,0))
"RTN","PRCAGU",32,0)
 F STAT=AC,OP F BN=0:0 S BN=$O(^PRCA(430,"AS",DEB,STAT,BN)) Q:'BN  D
"RTN","PRCAGU",33,0)
 .S BAL=$G(^PRCA(430,BN,7)),CS=$D(^PRCA(430,"TCSP",BN)) ; set flag for CS bills
"RTN","PRCAGU",34,0)
 .I $D(^PRCA(430,BN,6)) S LET3=$P(^(6),U,3) I LET3="" S ^XTMP("PRCAGU",$J,DEB,BN)=""
"RTN","PRCAGU",35,0)
 .I $P(^PRCA(430,BN,0),U,2)=PRE S PB=PB-BAL Q
"RTN","PRCAGU",36,0)
 .S PB=PB+$P(BAL,U,1),INT=INT+$P(BAL,U,2),ADM=ADM+$P(BAL,U,3),MF=MF+$P(BAL,U,4),CT=CT+$P(BAL,U,5)
"RTN","PRCAGU",37,0)
 .; for CS bills, update the CS bill balance
"RTN","PRCAGU",38,0)
 .I CS S CSBB=$G(CSBB)+$P(BAL,U,1)+$P(BAL,U,2)+$P(BAL,U,3)+$P(BAL,U,4)+$P(BAL,U,5)
"RTN","PRCAGU",39,0)
 S BBAL=PB+INT+ADM+MF+CT
"RTN","PRCAGU",40,0)
 F X="PB","INT","ADM","MF","CT" S BBAL(X)=@X
"RTN","PRCAGU",41,0)
BBALQ I 'CSFLAG K CSBB
"RTN","PRCAGU",42,0)
 Q
"RTN","PRCAGU",43,0)
UPDAT(DEB,DAT) ;update bill file 430 letter fields
"RTN","PRCAGU",44,0)
 NEW BN,DA,DIE,DR,II,LET,NOT,X,Y
"RTN","PRCAGU",45,0)
 G:'DEB UPDATQ
"RTN","PRCAGU",46,0)
 S:$G(DAT)="" DAT=DT S DIE="^PRCA(430,",NOT=0,BN=0
"RTN","PRCAGU",47,0)
 F  S BN=$O(^PRCA(430,"AS",DEB,16,BN)) Q:'BN  S DA=BN D
"RTN","PRCAGU",48,0)
 .S LET=$G(^PRCA(430,BN,6))
"RTN","PRCAGU",49,0)
 .F II=1:1:4 Q:$P(LET,U,II)=DAT  I $P(LET,U,II)="" S NOT=II,DR=$S(II=1:61,II=2:62,II=3:63,1:68)_"////^S X="_DAT_";68.1////^S X="_DAT D ^DIE Q
"RTN","PRCAGU",50,0)
UPDATQ Q
"RTN","PRCAGU",51,0)
BEVN(DEB,DAT) ;set event for non patient letters
"RTN","PRCAGU",52,0)
 NEW BAL,BN,DA,DIE,DR,EVN,I,NOT,X,Y
"RTN","PRCAGU",53,0)
 G:'DEB BEVNQ
"RTN","PRCAGU",54,0)
 S:$G(DAT)="" DAT=DT S DIE="^RC(341,",NOT=0,BN=0
"RTN","PRCAGU",55,0)
 F  S BN=$O(^PRCA(430,"AS",DEB,16,BN)) Q:'BN  D
"RTN","PRCAGU",56,0)
 .F I=1:1:3 I $P($G(^PRCA(430,BN,6)),U,I)=DAT S NOT=I Q
"RTN","PRCAGU",57,0)
 .S:'NOT NOT=4 S BAL=$G(^PRCA(430,BN,7)),ERR="",EVN=""
"RTN","PRCAGU",58,0)
 .D OPEN^RCEVDRV1(10,$P(^RCD(340,DEB,0),U),DAT,DUZ,$$SITE^RCMSITE,.ERR,.EVN,+BAL_U_$P(BAL,U,2)_U_$P(BAL,U,3)_U_$P(BAL,U,4)_U_$P(BAL,U,5))
"RTN","PRCAGU",59,0)
 .I EVN S DA=EVN,DR="5.01////^S X="_BN_";5.02////^S X="_NOT D ^DIE D CLOSE^RCEVDRV1(EVN)
"RTN","PRCAGU",60,0)
BEVNQ Q
"RTN","PRCAGU",61,0)
PRE(DEB) ;check for prepay bills in Refund review or Pending Calm
"RTN","PRCAGU",62,0)
 NEW BAL,BN,PEN,PRE,RR,STAT,Y
"RTN","PRCAGU",63,0)
 S (BAL,Y)=0 G:'DEB PREQ
"RTN","PRCAGU",64,0)
 S RR=+$O(^PRCA(430.3,"AC",113,0)),PEN=+$O(^PRCA(430.3,"AC",107,0)),PRE=+$O(^PRCA(430.2,"AC",33,0))
"RTN","PRCAGU",65,0)
 F STAT=RR,PEN F BN=0:0 S BN=$O(^PRCA(430,"AS",DEB,STAT,BN)) Q:'BN  D
"RTN","PRCAGU",66,0)
 .I $P($G(^PRCA(430,BN,0)),U,2)=PRE S Y=BN,BAL=BAL+$G(^PRCA(430,BN,7))
"RTN","PRCAGU",67,0)
PREQ Q Y_U_BAL
"RTN","PRCAGU",68,0)
LST(DEB,EVN,BDT) ;get last statement date before the statement date sent
"RTN","PRCAGU",69,0)
 NEW BEG,DAT,Y
"RTN","PRCAGU",70,0)
 S BDT=0 I 'DEB G LSTQ
"RTN","PRCAGU",71,0)
 S Y=+$O(^RC(341.1,"AC",2,0)),BEG=$P($G(^RC(341,EVN,0)),U,7) I 'BEG G LSTQ
"RTN","PRCAGU",72,0)
 S BEG=9999999.999999-BEG
"RTN","PRCAGU",73,0)
 F DAT=BEG:0 S DAT=$O(^RC(341,"AD",DEB,Y,DAT)) Q:'DAT  S BDT=DAT Q
"RTN","PRCAGU",74,0)
 ;return BDT in inverse date
"RTN","PRCAGU",75,0)
LSTQ Q
"RTN","RCCPCPS")
0^1^B85553915^B80898915
"RTN","RCCPCPS",1,0)
RCCPCPS ;WASH-ISC@ALTOONA,PA/NYB-Build Patient Statement File ;12/19/96  4:14 PM
"RTN","RCCPCPS",2,0)
V ;;4.5;Accounts Receivable;**34,70,80,48,104,116,149,170,181,190,223,237,219,265,301,348**;Mar 20,1995;Build 20
"RTN","RCCPCPS",3,0)
 ;;Per VA Directive 6402, this routine should not be modified.
"RTN","RCCPCPS",4,0)
 ;
"RTN","RCCPCPS",5,0)
 ;PRCA*4.5*348 Set 'BEG' lookup to handle last statement event
"RTN","RCCPCPS",6,0)
 ;             whether exists or not
"RTN","RCCPCPS",7,0)
 ;
"RTN","RCCPCPS",8,0)
EN N CCPC,CNT,DAT,DEB,DIK,END,INADFL,LDT1,LDT3,PCC,PRN,RCDATE,RCT,SVADM,SVAMT,SVINT,SVOTH,SITE,TXT,VAR,X,%
"RTN","RCCPCPS",9,0)
 N RCINFULL,RCINPART S COMM=0
"RTN","RCCPCPS",10,0)
 K ^RCPS(349.2)
"RTN","RCCPCPS",11,0)
 F X="PA","IS" S RCT=$O(^RCT(349.1,"B",X,0)) Q:'RCT  K ^RCT(349.1,+RCT,4),^RCT(349.1,+RCT,5)
"RTN","RCCPCPS",12,0)
 K ^XTMP("RCCPC")
"RTN","RCCPCPS",13,0)
 D DT^DICRW,SITE^PRCAGU
"RTN","RCCPCPS",14,0)
 I '$D(SITE) W !!,"AR SITE PARAMETER ENTRIES NOT DEFINED!",?50 D NOW^%DTC S Y=% D DD^%DT W Y W !!,"COULD NOT PROCESS AR PATIENT STATEMENTS" Q
"RTN","RCCPCPS",15,0)
 D NOW^%DTC S END=%
"RTN","RCCPCPS",16,0)
 S LDT1=$$FPS^RCAMFN01(DT,-1),RCDATE=DT
"RTN","RCCPCPS",17,0)
 S (CNT,DEB)=0,PRN=1
"RTN","RCCPCPS",18,0)
 F  S DEB=$O(^RCD(340,"AB","DPT(",DEB)) Q:DEB=""  D
"RTN","RCCPCPS",19,0)
 .   N AMT,BBAL,BEG,BN,CAT,DESC,ETY,FC,ND,PAT,PBAL,PC
"RTN","RCCPCPS",20,0)
 .   N PDAT,PEND,ST,SVINT,SVADM,SVOTH,ADDR
"RTN","RCCPCPS",21,0)
 .   I $L(+$$SSN^RCFN01(DEB))<5 Q
"RTN","RCCPCPS",22,0)
 .   ;Check for Emergency Response Indicator (ERI) Flag.
"RTN","RCCPCPS",23,0)
 .   N RCDFN S RCDFN=$P($G(^RCD(340,DEB,0)),"^",1) I $$EMERES^PRCAUTL(+RCDFN)]"" Q
"RTN","RCCPCPS",24,0)
 .   ; initialize variables for CS
"RTN","RCCPCPS",25,0)
 .   N CSBB,CSTCH,CSTPC,CSPREV S (CSBB,CSTCH,CSTPC)=0
"RTN","RCCPCPS",26,0)
 .   S INADFL=0
"RTN","RCCPCPS",27,0)
 .   S (SVADM,SVAMT,SVINT,SVOTH)=0
"RTN","RCCPCPS",28,0)
 .   N REF,SBAL,SDT,TBAL,TN,TTY,X,Y
"RTN","RCCPCPS",29,0)
 .   K ^TMP("PRCAGT",$J)
"RTN","RCCPCPS",30,0)
 .   S BEG=+$$LST^RCFN01(DEB,2,1)
"RTN","RCCPCPS",31,0)
 .   S LDT3=$S(BEG>0:$$FPS^RCAMFN01($P(BEG,"."),-3),1:0)
"RTN","RCCPCPS",32,0)
 .   I $P(BEG,".")'<$P(RCDATE,".") Q
"RTN","RCCPCPS",33,0)
 .   D NOW^%DTC S END=%
"RTN","RCCPCPS",34,0)
 .   I BEG<1 S PDAT="",BEG=0,PBAL=0
"RTN","RCCPCPS",35,0)
 .   I BEG S PDAT=BEG,BEG=9999999.999999-BEG,PBAL=0 D PBAL^PRCAGU(DEB,.BEG,.PBAL,1) ;get prev bal ; PRCA*4.5*348 set statement flag
"RTN","RCCPCPS",36,0)
 .   D EN^PRCAGT(DEB,BEG,.END)
"RTN","RCCPCPS",37,0)
 .   S TBAL=0 D TBAL^PRCAGT(DEB,.TBAL) ;get trans bal
"RTN","RCCPCPS",38,0)
 .   S BBAL=0 D BBAL^PRCAGU(DEB,.BBAL) ;get bill bal
"RTN","RCCPCPS",39,0)
 .   I CSBB,CSBB'<BBAL Q  ; entire account has been referred to CS
"RTN","RCCPCPS",40,0)
 .   S X=$$PRE^PRCAGU(DEB) S PEND=$P(X,U,2),X=+X I X,BBAL D REF^PRCAGD(DEB,X,$G(REP)) Q
"RTN","RCCPCPS",41,0)
 .   I BBAL=0,PEND,-PEND=PBAL+TBAL Q
"RTN","RCCPCPS",42,0)
 .   I BBAL'=(PBAL+TBAL) D EN^PRCAGD(DEB,BBAL,TBAL,PBAL,BEG,$G(REP)) Q
"RTN","RCCPCPS",43,0)
 .   I BBAL'>0,'$D(^TMP("PRCAGT",$J,DEB)) Q
"RTN","RCCPCPS",44,0)
 .   I BBAL=0,$G(SITE("ZERO")) Q
"RTN","RCCPCPS",45,0)
 .   I BBAL<0,BBAL>-.99 Q
"RTN","RCCPCPS",46,0)
 .   I BBAL'<0,'$D(^XTMP("PRCAGU",$J,DEB)),'COMM Q  ;third letter printed,not comment
"RTN","RCCPCPS",47,0)
 .   S TBAL=TBAL+PBAL
"RTN","RCCPCPS",48,0)
 .   ;adjust amounts to be filed in 349.2 for CS bills
"RTN","RCCPCPS",49,0)
 .   S TBAL=TBAL-CSBB ; reduce the total bill balance by CS balance
"RTN","RCCPCPS",50,0)
 .   S CSPREV=CSBB-(CSTCH+CSTPC) ; compute the CS previous balance as the difference between the bill balance and the transaction balance
"RTN","RCCPCPS",51,0)
 .   S PBAL=PBAL-CSPREV ; reduce the previous balance by the CS previous balance
"RTN","RCCPCPS",52,0)
 .   S TBAL("CH")=TBAL("CH")-CSTCH ; reduce total charges by CS charges
"RTN","RCCPCPS",53,0)
 .   S TBAL("PC")=TBAL("PC")-CSTPC ; reduce total credits by CS credits
"RTN","RCCPCPS",54,0)
 .   I '$D(^RCPS(349.2,0)) S ^(0)="AR CCPC STATEMENTS RECORDS^349.2I^"
"RTN","RCCPCPS",55,0)
 .   S ^RCPS(349.2,DEB,0)=DEB_"^"_$$SSN^RCFN01(DEB)_"^"
"RTN","RCCPCPS",56,0)
 .   S ADDR=$$DADD^RCAMADD(DEB,1) ;get patient's address, confidential if applicable
"RTN","RCCPCPS",57,0)
 .   S ^RCPS(349.2,DEB,1)=$P(ADDR,"^",1,6)
"RTN","RCCPCPS",58,0)
 .   S ST=$P(ADDR,"^",5)
"RTN","RCCPCPS",59,0)
 .   S ^RCPS(349.2,DEB,7)=$P(^RCD(340,DEB,0),U,7) ;large print
"RTN","RCCPCPS",60,0)
 .   I $G(ST)'="" S ST=$O(^DIC(5,"C",ST,0))
"RTN","RCCPCPS",61,0)
 .   I $G(ST)>90,'$P($G(^DIC(5,ST,0)),"^",6) S FC=$P($G(^DIC(5,ST,0)),"^")
"RTN","RCCPCPS",62,0)
 .   S $P(^RCPS(349.2,DEB,1),"^",7)=$G(FC) S:$G(FC)]"" $P(^RCPS(349.2,DEB,1),"^",5)="FX"
"RTN","RCCPCPS",63,0)
 .   S:$G(FC)]"" $P(^RCPS(349.2,DEB,1),"^",6)=$P(ADDR,"^",8)
"RTN","RCCPCPS",64,0)
 .   D NOW^%DTC S $P(^RCPS(349.2,DEB,0),"^",10)=%
"RTN","RCCPCPS",65,0)
 .   S $P(^RCPS(349.2,DEB,0),"^",3)=$$NAM^RCFN01(DEB)
"RTN","RCCPCPS",66,0)
 .   S $P(^RCPS(349.2,DEB,0),"^",4,7)=$S(TBAL'>0:0,1:TBAL)_"^"_PBAL_"^"_TBAL("CH")_"^"_TBAL("PC"),$P(^(0),"^",8)=PBAL+TBAL("CH")+TBAL("PC")+TBAL("RF")
"RTN","RCCPCPS",67,0)
 .   S $P(^RCPS(349.2,DEB,0),"^",13,17)=BBAL("PB")_"^"_BBAL("INT")_"^"_BBAL("ADM")_"^"_BBAL("MF")_"^"_BBAL("CT")
"RTN","RCCPCPS",68,0)
 .   ;
"RTN","RCCPCPS",69,0)
 .   N RCBILLDA,RCDATA1,RCDEBTDA,RCDESC,RCPSDA,RCTOTAL,RCTRANDA,RCTRDATE,VALUE,RCCOM1,RCCOM2,RCCOM3
"RTN","RCCPCPS",70,0)
 .   S RCDEBTDA=DEB
"RTN","RCCPCPS",71,0)
 .   I '$D(^RCPS(349.2,RCDEBTDA,2,0)) S ^(0)="^349.21DA^^"
"RTN","RCCPCPS",72,0)
 .   ;
"RTN","RCCPCPS",73,0)
 .   S RCCOM1=$E($TR($G(SITE("COM1")),"~|^",""),1,80),(RCCOM2,RCCOM3)=""
"RTN","RCCPCPS",74,0)
 .   ; Add second comment line for the GMT-reduced status
"RTN","RCCPCPS",75,0)
 .   I $$GMT^PRCAGST(RCDEBTDA) S RCCOM2="REDUCTION OF INPATIENT COPAYMENT DUE TO GEOGRAPHIC MEANS TEST STATUS"
"RTN","RCCPCPS",76,0)
 .   I TBAL'>0 S RCCOM3=" *THIS IS NOT A BILL*"
"RTN","RCCPCPS",77,0)
 .   I RCCOM1'="",RCCOM2'="" S $E(RCCOM1,80)=" " ;Make sure GMT message will be printed on separate line.
"RTN","RCCPCPS",78,0)
 .   S ^RCPS(349.2,RCDEBTDA,3)=RCCOM1_RCCOM2_RCCOM3
"RTN","RCCPCPS",79,0)
 .   ;
"RTN","RCCPCPS",80,0)
 .   S RCPSDA=0 ; this variable used to set the description on the PS segment
"RTN","RCCPCPS",81,0)
 .   S RCTRDATE=0 F  S RCTRDATE=$O(^TMP("PRCAGT",$J,RCDEBTDA,RCTRDATE)) Q:'RCTRDATE  S RCBILLDA=0 F  S RCBILLDA=$O(^TMP("PRCAGT",$J,RCDEBTDA,RCTRDATE,RCBILLDA)) Q:'RCBILLDA  D
"RTN","RCCPCPS",82,0)
 .   .   Q:$D(^PRCA(430,"TCSP",RCBILLDA))  ; skip CS bills/transactions
"RTN","RCCPCPS",83,0)
 .   .   I $P($G(^RCPS(349.2,RCDEBTDA,0)),"^",8)<0 S PC(75)=75
"RTN","RCCPCPS",84,0)
 .   .   I $P($G(^PRCA(430,RCBILLDA,6)),"^",2)]"",($P($G(^PRCA(430,RCBILLDA,7)),"^")>0) S PC(1)="01"
"RTN","RCCPCPS",85,0)
 .   .   S CAT=$P($G(^PRCA(430,RCBILLDA,0)),"^",2)
"RTN","RCCPCPS",86,0)
 .   .   S PC=$P($G(^PRCA(430.2,CAT,0)),"^",14)
"RTN","RCCPCPS",87,0)
 .   .   F X=1:1:100 I $P(PC,",",X)'="" S PCC=$P(PC,",",X),PC(+PCC)=PCC Q:PCC=""
"RTN","RCCPCPS",88,0)
 .   .   S PC="",X=0 F  S X=$O(PC(X)) Q:X=""  I $G(PC(X))'="" S PC=PC_PC(X)
"RTN","RCCPCPS",89,0)
 .   .   S $P(^RCPS(349.2,RCDEBTDA,4),"^")=PC
"RTN","RCCPCPS",90,0)
 .   .   ;
"RTN","RCCPCPS",91,0)
 .   .   I $D(^TMP("PRCAGT",$J,RCDEBTDA,RCTRDATE,RCBILLDA,0)) S AMT=+^(0) I AMT D
"RTN","RCCPCPS",92,0)
 .   .   .   ;  get the description for the bill
"RTN","RCCPCPS",93,0)
 .   .   .   K RCDESC D BILLDESC^RCCPCPS1(RCBILLDA)
"RTN","RCCPCPS",94,0)
 .   .   .   ;
"RTN","RCCPCPS",95,0)
 .   .   .   ;  store the description in file 349.2, PS segment
"RTN","RCCPCPS",96,0)
 .   .   .   S RCPSDA=RCPSDA+1
"RTN","RCCPCPS",97,0)
 .   .   .   S $P(^RCPS(349.2,RCDEBTDA,2,RCPSDA,0),"^",1,4)=$P(RCTRDATE,".")_"^"_$G(RCDESC(1))_"^"_$G(AMT)_"^"_$P(^PRCA(430,RCBILLDA,0),"^")
"RTN","RCCPCPS",98,0)
 .   .   .   F X=2:1 Q:$G(RCDESC(X))=""  S RCPSDA=RCPSDA+1,^RCPS(349.2,RCDEBTDA,2,RCPSDA,0)="^"_RCDESC(X)_"^^"
"RTN","RCCPCPS",99,0)
 .   .   ;
"RTN","RCCPCPS",100,0)
 .   .   S RCTRANDA=0 F  S RCTRANDA=$O(^TMP("PRCAGT",$J,RCDEBTDA,RCTRDATE,RCBILLDA,RCTRANDA)) D:'RCTRANDA NO Q:'RCTRANDA  D
"RTN","RCCPCPS",101,0)
 .   .   .   ;  get the description for the transaction
"RTN","RCCPCPS",102,0)
 .   .   .   K RCDESC D TRANDESC^RCCPCPS1(RCTRANDA),RCDESC
"RTN","RCCPCPS",103,0)
 .   .   .   ;  if it is an interest/admin charge, summarize it below
"RTN","RCCPCPS",104,0)
 .   .   .   I $G(RCDESC(1))["INTEREST" Q
"RTN","RCCPCPS",105,0)
 .   .   .   ;  get the value of the transaction for the statement
"RTN","RCCPCPS",106,0)
 .   .   .   S VALUE=$$TRANVALU^RCDPBTLM(RCTRANDA)
"RTN","RCCPCPS",107,0)
 .   .   .   S VALUE=$P(VALUE,"^",2)+$P(VALUE,"^",3)+$P(VALUE,"^",4)+$P(VALUE,"^",5)+$P(VALUE,"^",6)
"RTN","RCCPCPS",108,0)
 .   .   .   ;  if it is a suspended (47) or unsuspended (46) transaction, show value
"RTN","RCCPCPS",109,0)
 .   .   .   ;  make suspended charges appear as negative
"RTN","RCCPCPS",110,0)
 .   .   .   S RCDATA1=$G(^PRCA(433,RCTRANDA,1))
"RTN","RCCPCPS",111,0)
 .   .   .   I $P(RCDATA1,"^",2)=47!($P(RCDATA1,"^",2)=46) S VALUE=$P(RCDATA1,"^",5) I $P(RCDATA1,"^",2)=47 S VALUE=-VALUE
"RTN","RCCPCPS",112,0)
 .   .   .   ;  if it is an amended bill, show value
"RTN","RCCPCPS",113,0)
 .   .   .   I $P(RCDATA1,"^",2)=33 S VALUE=$P(RCDATA1,"^",5)
"RTN","RCCPCPS",114,0)
 .   .   .   ;  store the description in file 349.2, PS segment
"RTN","RCCPCPS",115,0)
 .   .   .   S RCPSDA=RCPSDA+1
"RTN","RCCPCPS",116,0)
 .   .   .   S $P(^RCPS(349.2,RCDEBTDA,2,RCPSDA,0),"^",1,5)=$P(RCTRDATE,".")_"^"_$G(RCDESC(1))_"^"_VALUE_"^"_$P(^PRCA(430,RCBILLDA,0),"^")
"RTN","RCCPCPS",117,0)
 .   .   .   F X=2:1 Q:$G(RCDESC(X))=""  S RCPSDA=RCPSDA+1,^RCPS(349.2,RCDEBTDA,2,RCPSDA,0)="^"_RCDESC(X)_"^^"
"RTN","RCCPCPS",118,0)
 .   .   .   ;
"RTN","RCCPCPS",119,0)
 .   .   .   ;  for comment transaction ... not sure what this is for ?
"RTN","RCCPCPS",120,0)
 .   .   .   I $P(RCDATA1,"^",2)=45,$P($G(^PRCA(433,RCTRANDA,5)),"^",2)["your waiver rights" S ^RCPS(349.2,+RCDEBTDA,4)="0150"
"RTN","RCCPCPS",121,0)
 .   ;
"RTN","RCCPCPS",122,0)
 .   ;  if interest, admin, or other, add them here
"RTN","RCCPCPS",123,0)
 .   S X=$G(RCTOTAL("INT"))+$G(RCTOTAL("ADM"))+$G(RCTOTAL("OTH"))
"RTN","RCCPCPS",124,0)
 .   I X>0 D
"RTN","RCCPCPS",125,0)
 .   .   S RCDESC="INTEREST/ADM. CHARGE (Int:"_$J($G(RCTOTAL("INT")),1,2)_" Adm:"_$J($G(RCTOTAL("ADM")),1,2)_" Other:"_$J($G(RCTOTAL("OTH")),1,2)_")"
"RTN","RCCPCPS",126,0)
 .   .   S RCPSDA=RCPSDA+1
"RTN","RCCPCPS",127,0)
 .   .   S ^RCPS(349.2,RCDEBTDA,2,RCPSDA,0)="^"_RCDESC_"^"_$J(X,1,2)
"RTN","RCCPCPS",128,0)
 .   .   S ^RCPS(349.2,RCDEBTDA,2,0)="^349.21DA^"_RCPSDA_"^"_RCPSDA
"RTN","RCCPCPS",129,0)
 .   ;
"RTN","RCCPCPS",130,0)
 .   ;  set 0th node
"RTN","RCCPCPS",131,0)
 .   I RCPSDA S ^RCPS(349.2,RCDEBTDA,2,0)="^349.21DA^"_RCPSDA_"^"_RCPSDA
"RTN","RCCPCPS",132,0)
 .   ;  
"RTN","RCCPCPS",133,0)
 .   I RCPSDA'<287 S ^XTMP("RCCPC",0)=DT,^XTMP("RCCPC",RCDEBTDA)="" Q
"RTN","RCCPCPS",134,0)
 .   D NO
"RTN","RCCPCPS",135,0)
 ;
"RTN","RCCPCPS",136,0)
 S DIK="^RCPS(349.2," D IXALL^DIK
"RTN","RCCPCPS",137,0)
 S DEB=0 S DEB=$O(^RCPS(349.2,DEB)) Q:DEB=""  S $P(^(DEB,0),"^",18)=1
"RTN","RCCPCPS",138,0)
 K ^XTMP("PRCAGU",$J,DEB),COMM
"RTN","RCCPCPS",139,0)
 ;
"RTN","RCCPCPS",140,0)
OSTM ;Process old statements
"RTN","RCCPCPS",141,0)
 S DIK="^RCPS(349.2,",DA=0 F  S DA=$O(^XTMP("RCCPC",DA)) Q:'DA  D ^DIK
"RTN","RCCPCPS",142,0)
 K DA
"RTN","RCCPCPS",143,0)
 ;
"RTN","RCCPCPS",144,0)
STATMNT ;Print patient statements
"RTN","RCCPCPS",145,0)
 N IOP,ZTIO,ZTSAVE,ZTRTN,ZTDESC,ZTASK,%ZIS,ZTDTH,PRCADEV
"RTN","RCCPCPS",146,0)
 S (IOP,PRCADEV)=$P($G(^RC(342,1,0)),"^",8)
"RTN","RCCPCPS",147,0)
 I IOP]"" D
"RTN","RCCPCPS",148,0)
 .S ZTRTN="STM^RCCPCSTM",ZTDTH=$H,ZTDESC="Print old AR Statements"
"RTN","RCCPCPS",149,0)
 .S %ZIS="N0" D ^%ZIS Q:POP
"RTN","RCCPCPS",150,0)
 .S ZTSAVE("PRCADEV")="" D ^%ZTLOAD,^%ZISC
"RTN","RCCPCPS",151,0)
 Q
"RTN","RCCPCPS",152,0)
 ;
"RTN","RCCPCPS",153,0)
NO ;If there is no activity
"RTN","RCCPCPS",154,0)
 I $G(^RCPS(349.2,+DEB,4))["0150" D
"RTN","RCCPCPS",155,0)
 .S ^RCPS(349.2,+DEB,2,1,0)="^NOTICE: You now have delinquent charges. Please^^"
"RTN","RCCPCPS",156,0)
 .S ^RCPS(349.2,+DEB,2,2,0)="^review Enforcement of Involuntary Collections^^"
"RTN","RCCPCPS",157,0)
 .S ^RCPS(349.2,+DEB,2,3,0)="^on reverse.^^"
"RTN","RCCPCPS",158,0)
 .S ^RCPS(349.2,+DEB,2,0)="^^3^3"
"RTN","RCCPCPS",159,0)
 I $G(^RCPS(349.2,DEB,2,1,0))="" D
"RTN","RCCPCPS",160,0)
 .S ^RCPS(349.2,DEB,2,1,0)="^No Activity in the Last 30 Days!^^"
"RTN","RCCPCPS",161,0)
 .S ^RCPS(349.2,DEB,2,2,0)="^Please refer to previous statement of rights.^^"
"RTN","RCCPCPS",162,0)
 .S ^RCPS(349.2,DEB,2,0)="^^2^2"
"RTN","RCCPCPS",163,0)
 .I $G(^RCPS(349.2,DEB,4))="" S ^(4)="90"
"RTN","RCCPCPS",164,0)
 Q
"RTN","RCCPCPS",165,0)
BUILD ;This is the entry point from the BUILD CCPC file option
"RTN","RCCPCPS",166,0)
 N TDT,QDT,ZTDESC,ZTASK,ZTSK,ZDTDTH,ZTIO,ZTRTN
"RTN","RCCPCPS",167,0)
 S TDT=$O(^RCPS(349.2,0)) I TDT D
"RTN","RCCPCPS",168,0)
 .S TDT=$$ASOF^RCCPCFN($P($G(^RCPS(349.2,+TDT,0)),"^",10))
"RTN","RCCPCPS",169,0)
 .S TDT=$TR($$SLH^RCFN01(TDT),"/","")
"RTN","RCCPCPS",170,0)
 .S TDT("T")=$P($G(^RCT(349,1,0)),"^",10),TDT("T")=$E(TDT("T"),1,4)_$E(TDT("T"),7,8)
"RTN","RCCPCPS",171,0)
 .I TDT("T")=TDT D
"RTN","RCCPCPS",172,0)
 ..W *7,!,"The current file reflects activity as of ",$E(TDT,1,2)_"/"_$E(TDT,3,4)_"/"_$E(TDT,5,8)_".",!
"RTN","RCCPCPS",173,0)
 ..W !,"IT WAS TRANSMITTED ON ",$TR($P($P($G(^RCT(349,1,0)),"^"),".",2,4),".","/"),!
"RTN","RCCPCPS",174,0)
 ..S TDT=$P($G(^RCT(349,1,0)),"^",9)
"RTN","RCCPCPS",175,0)
 ..W !,"For statement date: ",$E(TDT,1,2)_"/"_$E(TDT,3,4)_"/"_$E(TDT,5,8)
"RTN","RCCPCPS",176,0)
 ..W !!,"PLEASE CONTACT CUSTOMER SUPPORT BEFORE PROCEEDING.",!!
"RTN","RCCPCPS",177,0)
TIME S ZTIO="",ZTRTN="EN^RCCPCPS",ZTDESC="Build CCPC Statement File"
"RTN","RCCPCPS",178,0)
 S ZTDTH="" D ^%ZTLOAD Q:$G(ZTSK)=""
"RTN","RCCPCPS",179,0)
 S %H=ZTSK("D") D YX^%DTC,H^%DTC I %Y=0!(%Y=6) W !,"Queued for Building." Q   ;PRC*4.5*348
"RTN","RCCPCPS",180,0)
 S %H=ZTSK("D") D YMD^%DTC S QDT=X_%
"RTN","RCCPCPS",181,0)
 I (QDT>(X_".0800"))&(QDT<(X_".1801")) D  G TIME   ;PRC*4.5*348
"RTN","RCCPCPS",182,0)
 .W !!,*7,"You Can Not Queue this Job on a weekday Between 8:00am and 6:00pm.",!
"RTN","RCCPCPS",183,0)
 .D KILL^%ZTLOAD
"RTN","RCCPCPS",184,0)
 W !,"Queued for Building."
"RTN","RCCPCPS",185,0)
 Q
"RTN","RCCPCPS",186,0)
 ;
"RTN","RCCPCPS",187,0)
RCDESC ;Remove "IN PART" & "IN FULL" from the the bill description
"RTN","RCCPCPS",188,0)
 QUIT:$G(RCDESC(1))=""
"RTN","RCCPCPS",189,0)
 S RCINFULL=" (IN FULL)"
"RTN","RCCPCPS",190,0)
 S RCINPART=" (IN PART)"
"RTN","RCCPCPS",191,0)
 I RCDESC(1)[RCINFULL S RCDESC(1)=$P(RCDESC(1),RCINFULL)_$P(RCDESC(1),RCINFULL,2)
"RTN","RCCPCPS",192,0)
 I RCDESC(1)[RCINPART S RCDESC(1)=$P(RCDESC(1),RCINPART)_$P(RCDESC(1),RCINPART,2)
"RTN","RCCPCPS",193,0)
 Q
"RTN","RCFN01")
0^2^B12850449^B7441074
"RTN","RCFN01",1,0)
RCFN01 ;WASH-ISC@ALTOONA,PA/RGY-MISCELLANEOUS AR FUNCTIONS ;Mar 20, 1995
"RTN","RCFN01",2,0)
V ;;4.5;Accounts Receivable;**39,65,104,184,348**;Mar 20, 1995;Build 20
"RTN","RCFN01",3,0)
 ;;Per VA Directive 6402, this routine should not be modified.
"RTN","RCFN01",4,0)
 ;
"RTN","RCFN01",5,0)
 ;PRCA*4.5*348 Last statement event handler when no last
"RTN","RCFN01",6,0)
 ;             statement event exists in file 341 
"RTN","RCFN01",7,0)
 ;
"RTN","RCFN01",8,0)
SSN(DEBT) ;Get SSN for debtor
"RTN","RCFN01",9,0)
 ;Input Debtor (340)
"RTN","RCFN01",10,0)
 ;Output: SSN # or null
"RTN","RCFN01",11,0)
 NEW Y
"RTN","RCFN01",12,0)
 S Y=-1 G:'$G(DEBT) Q1
"RTN","RCFN01",13,0)
 S:DEBT?1N.N DEBT=$P($G(^RCD(340,DEBT,0)),"^")
"RTN","RCFN01",14,0)
 I DEBT[";DPT(" S Y=$P($G(^DPT(+DEBT,0)),"^",9)
"RTN","RCFN01",15,0)
 I DEBT[";VA(200," S Y=$P($G(^VA(200,+DEBT,1)),"^",9)
"RTN","RCFN01",16,0)
Q1 Q Y
"RTN","RCFN01",17,0)
SADD(TYPE) ;Get AR Group address
"RTN","RCFN01",18,0)
 ;Input Type of Address (342.1)
"RTN","RCFN01",19,0)
 ;Output: Str1^Str2^Str3^City^State^Zip^Phone
"RTN","RCFN01",20,0)
 NEW X
"RTN","RCFN01",21,0)
 S X="" G:$G(TYPE)="" Q2 I ",1,2,3,4,5,8,"'[(","_TYPE_","),TYPE'?1N.N1";RC(342.1," G Q2
"RTN","RCFN01",22,0)
 I TYPE?1N.N S TYPE=$O(^RC(342.1,"AC",TYPE,0)) G:TYPE="" Q2 S TYPE=TYPE_";RC(342.1,"
"RTN","RCFN01",23,0)
 S X=$P($G(^RC(342.1,+TYPE,1)),"^",1,8)
"RTN","RCFN01",24,0)
 S:$P(X,"^",5) $P(X,"^",5)=$P($G(^DIC(5,+$P(X,"^",5),0)),"^",2) S:$P(X,"^",6)?9N $P(X,"^",6)=$E($P(X,"^",6),1,5)_"-"_$E($P(X,"^",6),6,9)
"RTN","RCFN01",25,0)
Q2 Q X
"RTN","RCFN01",26,0)
NAM(DEBT) ;Get DEBTOR name
"RTN","RCFN01",27,0)
 NEW Y
"RTN","RCFN01",28,0)
 S Y="" G:'$G(DEBT) Q3
"RTN","RCFN01",29,0)
 S:DEBT?1N.N DEBT=$P($G(^RCD(340,DEBT,0)),"^") G:DEBT="" Q3
"RTN","RCFN01",30,0)
 S Y=$P($G(@("^"_$P(DEBT,";",2)_(+DEBT)_",0)")),"^")
"RTN","RCFN01",31,0)
Q3 Q Y
"RTN","RCFN01",32,0)
LST(DEBT,TYPE,PRCASTMT) ;Get last type of event for debtor   PRCA*4.5*348
"RTN","RCFN01",33,0)
 ;PRCASTMT   Set to 1 when called from statement compiler for no event 2 condition handling
"RTN","RCFN01",34,0)
 NEW Y,PRCABIL,PRCATX,PRCADT,PRCATX0,PRCABDT,PRCABLDT     ;PRCA*4.5*348  
"RTN","RCFN01",35,0)
 D NOW^%DTC
"RTN","RCFN01",36,0)
 S Y=-1 G:'$G(DEBT)!'$G(TYPE) Q4
"RTN","RCFN01",37,0)
 S:DEBT?1N.N1";"1A.A1"(" DEBT=$O(^RCD(340,"B",DEBT,0))
"RTN","RCFN01",38,0)
 S TYPE=+$O(^RC(341.1,"AC",TYPE,0))
"RTN","RCFN01",39,0)
 S Y=+$O(^RC(341,"AD",DEBT,TYPE,0)) I 'Y,'$G(PRCASTMT) S Y=-1 G Q4
"RTN","RCFN01",40,0)
 I 'Y,$G(PRCASTMT) D  G Q4
"RTN","RCFN01",41,0)
 . S PRCABIL=0,PRCABLDT=0 F  S PRCABIL=$O(^PRCA(430,"C",DEBT,PRCABIL)) Q:'PRCABIL  D
"RTN","RCFN01",42,0)
 . . I ":16:42:"[(":"_$P($G(^PRCA(430,PRCABIL,0)),"^",8)_":") D
"RTN","RCFN01",43,0)
 . . . S PRCABDT=$P($G(^PRCA(430,PRCABIL,6)),"^",21)
"RTN","RCFN01",44,0)
 . . . I 'PRCABLDT S PRCABLDT=PRCABIL_U_PRCABDT Q
"RTN","RCFN01",45,0)
 . . . I PRCABDT<$P(PRCABLDT,U,2) S PRCABLDT=PRCABIL_U_PRCABDT
"RTN","RCFN01",46,0)
 . S Y=$S(PRCABLDT:$P(PRCABLDT,U,2),1:%) S Y=Y-.000001
"RTN","RCFN01",47,0)
 . F PRCADT=Y:0 S PRCADT=$O(^PRCA(433,"ATD",DEBT,PRCADT)) Q:'PRCADT  F PRCATX=0:0 S PRCATX=$O(^PRCA(433,"ATD",DEBT,PRCADT,PRCATX)) Q:'PRCATX  D
"RTN","RCFN01",48,0)
 . . S PRCATX0=$G(^PRCA(433,PRCATX,0)) Q:'PRCATX0
"RTN","RCFN01",49,0)
 . . S PRCABDT=$P($G(^PRCA(430,$P(PRCATX0,U,2),6)),U,21)
"RTN","RCFN01",50,0)
 . . I PRCABDT,PRCABDT<Y S Y=PRCABDT-.000001,PRCADT=Y,PRCATX="Z"
"RTN","RCFN01",51,0)
 . S Y=Y_"^0",PBAL=0
"RTN","RCFN01",52,0)
 S Y=9999999.999999-Y_"^"_$O(^RC(341,"AD",DEBT,TYPE,Y,0))
"RTN","RCFN01",53,0)
Q4 Q Y
"RTN","RCFN01",54,0)
DET(DEBT) ;Return type of detail for RX info
"RTN","RCFN01",55,0)
 NEW Y
"RTN","RCFN01",56,0)
 S Y=$S($P($G(^RC(342,1,0)),"^",5):$P(^(0),"^",5),1:1) G:'$G(DEBT) Q5
"RTN","RCFN01",57,0)
 S:DEBT?1N.N1";"1A.A1"(" DEBT=$O(^RCD(340,"B",DEBT,""))
"RTN","RCFN01",58,0)
 I $P($G(^RCD(340,DEBT,0)),"^",2) S Y=$P(^(0),"^",2)
"RTN","RCFN01",59,0)
Q5 Q Y
"RTN","RCFN01",60,0)
SLH(DATE,DEL) ;Return date format of mm/dd/yyyy
"RTN","RCFN01",61,0)
 NEW %DT,X,Y,YR
"RTN","RCFN01",62,0)
 S X=$G(DATE),DEL=$S($G(DEL)="":"/",1:DEL),%DT="T" D ^%DT S DATE=Y S:Y<0 DATE="0000000"
"RTN","RCFN01",63,0)
 S YR=$E(($E(DATE,1,3)+1700),1,2)
"RTN","RCFN01",64,0)
Q6 Q $E(DATE,4,5)_DEL_$E(DATE,6,7)_DEL_$G(YR)_$E(DATE,2,3)
"RTN","RCFN01",65,0)
ARPS(BN,DA) ;Determines the purge status of a bill
"RTN","RCFN01",66,0)
 ;Input: Bill no. (BN) and file 442 record IEN (DA)
"RTN","RCFN01",67,0)
 ;Output: Value of 1 (purge) or 0 (don't purge)
"RTN","RCFN01",68,0)
 NEW X,Y
"RTN","RCFN01",69,0)
 I $G(BN)=""!($G(DA)="") Q 0
"RTN","RCFN01",70,0)
 I '$D(^PRCA(430,"B",BN)),'$D(^PRCA(430,"F",DA)) Q 1
"RTN","RCFN01",71,0)
 I $D(^PRCA(430,"B",BN)) S X=+$O(^(BN,0)) I X>0,$D(^PRCA(430.3,"AC",115,+$P(^PRCA(430,X,0),U,8))) Q 1
"RTN","RCFN01",72,0)
 I $D(^PRCA(430,"F",DA)) S Y=+$O(^(DA,0)) I Y>0,$D(^PRCA(430.3,"AC",115,+$P(^PRCA(430,Y,0),U,8))) Q 1
"RTN","RCFN01",73,0)
 Q 0
"RTN","RCFN01",74,0)
FY(DATE) ;Return FY for date, DT is default
"RTN","RCFN01",75,0)
 NEW FY
"RTN","RCFN01",76,0)
 S:$G(DATE)'?7N.E DATE=DT
"RTN","RCFN01",77,0)
 S FY=$E(DATE,2,3) S:$E(DATE,4,5)>9 FY=FY+1 S:FY=100 FY="00"
"RTN","RCFN01",78,0)
 I +$E(DATE,4,5)=9 D
"RTN","RCFN01",79,0)
 .I $E(DATE,6,7)>$E($$LDATE^RCRJR(DATE),6,7) S FY=FY+1
"RTN","RCFN01",80,0)
 .Q
"RTN","RCFN01",81,0)
 S:$L(FY)<2 FY="0"_FY
"RTN","RCFN01",82,0)
 Q FY
"RTN","RCFN01",83,0)
 ;
"RTN","RCFN01",84,0)
INTEG(SITE) ;integrated site
"RTN","RCFN01",85,0)
 N X
"RTN","RCFN01",86,0)
 S X=+$P($G(^RC(342,1,6)),U)
"RTN","RCFN01",87,0)
 Q X
"RTN","RCFN01",88,0)
 ;
"VER")
8.0^22.2
"BLD",11369,6)
^311
**END**
**END**

