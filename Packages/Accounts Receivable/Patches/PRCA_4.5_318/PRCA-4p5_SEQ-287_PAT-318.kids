Released PRCA*4.5*318 SEQ #287
Extracted from mail message
**KIDS**:PRCA*4.5*318^

**INSTALL NAME**
PRCA*4.5*318
"BLD",10470,0)
PRCA*4.5*318^ACCOUNTS RECEIVABLE^0^3170731^y
"BLD",10470,4,0)
^9.64PA^344.31^2
"BLD",10470,4,344.31,0)
344.31
"BLD",10470,4,344.31,2,0)
^9.641^344.31^1
"BLD",10470,4,344.31,2,344.31,0)
EDI THIRD PARTY EFT DETAIL  (File-top level)
"BLD",10470,4,344.31,2,344.31,1,0)
^9.6411^.02^1
"BLD",10470,4,344.31,2,344.31,1,.02,0)
PAYER NAME
"BLD",10470,4,344.31,222)
y^y^p^^^^n^^n
"BLD",10470,4,344.31,224)

"BLD",10470,4,344.4,0)
344.4
"BLD",10470,4,344.4,2,0)
^9.641^344.4^1
"BLD",10470,4,344.4,2,344.4,0)
ELECTRONIC REMITTANCE ADVICE  (File-top level)
"BLD",10470,4,344.4,2,344.4,1,0)
^9.6411^.06^1
"BLD",10470,4,344.4,2,344.4,1,.06,0)
PAYMENT FROM
"BLD",10470,4,344.4,222)
y^y^p^^^^n^^n
"BLD",10470,4,344.4,224)

"BLD",10470,4,"APDD",344.31,344.31)

"BLD",10470,4,"APDD",344.31,344.31,.02)

"BLD",10470,4,"APDD",344.4,344.4)

"BLD",10470,4,"APDD",344.4,344.4,.06)

"BLD",10470,4,"B",344.31,344.31)

"BLD",10470,4,"B",344.4,344.4)

"BLD",10470,6)
14^
"BLD",10470,6.3)
37
"BLD",10470,"INI")
PRE^PRCAP318
"BLD",10470,"INIT")
POST^PRCAP318
"BLD",10470,"KRN",0)
^9.67PA^779.2^20
"BLD",10470,"KRN",.4,0)
.4
"BLD",10470,"KRN",.401,0)
.401
"BLD",10470,"KRN",.402,0)
.402
"BLD",10470,"KRN",.403,0)
.403
"BLD",10470,"KRN",.5,0)
.5
"BLD",10470,"KRN",.84,0)
.84
"BLD",10470,"KRN",3.6,0)
3.6
"BLD",10470,"KRN",3.8,0)
3.8
"BLD",10470,"KRN",9.2,0)
9.2
"BLD",10470,"KRN",9.8,0)
9.8
"BLD",10470,"KRN",9.8,"NM",0)
^9.68A^30^28
"BLD",10470,"KRN",9.8,"NM",1,0)
RCDPESP^^0^B152385902
"BLD",10470,"KRN",9.8,"NM",2,0)
RCDPEAP^^0^B225459503
"BLD",10470,"KRN",9.8,"NM",4,0)
RCDPESP1^^0^B102077824
"BLD",10470,"KRN",9.8,"NM",6,0)
RCDPEDAR^^0^B72692368
"BLD",10470,"KRN",9.8,"NM",7,0)
RCDPEDA2^^0^B97233513
"BLD",10470,"KRN",9.8,"NM",8,0)
RCDPEDA3^^0^B135656232
"BLD",10470,"KRN",9.8,"NM",9,0)
RCDPEAP1^^0^B100161817
"BLD",10470,"KRN",9.8,"NM",10,0)
RCDPEAR2^^0^B111529113
"BLD",10470,"KRN",9.8,"NM",11,0)
RCDPEM^^0^B62343432
"BLD",10470,"KRN",9.8,"NM",12,0)
RCDPEM1^^0^B51446445
"BLD",10470,"KRN",9.8,"NM",13,0)
RCDPEMA^^0^B22956552
"BLD",10470,"KRN",9.8,"NM",14,0)
RCDPEWL^^0^B75628654
"BLD",10470,"KRN",9.8,"NM",15,0)
RCDPEWL7^^0^B100612079
"BLD",10470,"KRN",9.8,"NM",16,0)
PRCAP318^^0^B1842298
"BLD",10470,"KRN",9.8,"NM",17,0)
RCDPE8NZ^^0^B119211699
"BLD",10470,"KRN",9.8,"NM",18,0)
PRCAEXM^^0^B14988614
"BLD",10470,"KRN",9.8,"NM",19,0)
RCDPEWL8^^0^B101993484
"BLD",10470,"KRN",9.8,"NM",20,0)
RCDPEWL6^^0^B85551309
"BLD",10470,"KRN",9.8,"NM",21,0)
RCDPEWL2^^0^B113268275
"BLD",10470,"KRN",9.8,"NM",22,0)
RCDPEWL4^^0^B62916742
"BLD",10470,"KRN",9.8,"NM",23,0)
RCDPEAA2^^0^B118386616
"BLD",10470,"KRN",9.8,"NM",24,0)
RCDPEAA3^^0^B103351099
"BLD",10470,"KRN",9.8,"NM",25,0)
RCDPEAD^^0^B86618636
"BLD",10470,"KRN",9.8,"NM",26,0)
RCDPEAD1^^0^B67869816
"BLD",10470,"KRN",9.8,"NM",27,0)
RCDPEADP^^0^B154275077
"BLD",10470,"KRN",9.8,"NM",28,0)
RCDPEM9^^0^B45658707
"BLD",10470,"KRN",9.8,"NM",29,0)
RCDPELAR^^0^B125782541
"BLD",10470,"KRN",9.8,"NM",30,0)
RCDPELA1^^0^B118391123
"BLD",10470,"KRN",9.8,"NM","B","PRCAEXM",18)

"BLD",10470,"KRN",9.8,"NM","B","PRCAP318",16)

"BLD",10470,"KRN",9.8,"NM","B","RCDPE8NZ",17)

"BLD",10470,"KRN",9.8,"NM","B","RCDPEAA2",23)

"BLD",10470,"KRN",9.8,"NM","B","RCDPEAA3",24)

"BLD",10470,"KRN",9.8,"NM","B","RCDPEAD",25)

"BLD",10470,"KRN",9.8,"NM","B","RCDPEAD1",26)

"BLD",10470,"KRN",9.8,"NM","B","RCDPEADP",27)

"BLD",10470,"KRN",9.8,"NM","B","RCDPEAP",2)

"BLD",10470,"KRN",9.8,"NM","B","RCDPEAP1",9)

"BLD",10470,"KRN",9.8,"NM","B","RCDPEAR2",10)

"BLD",10470,"KRN",9.8,"NM","B","RCDPEDA2",7)

"BLD",10470,"KRN",9.8,"NM","B","RCDPEDA3",8)

"BLD",10470,"KRN",9.8,"NM","B","RCDPEDAR",6)

"BLD",10470,"KRN",9.8,"NM","B","RCDPELA1",30)

"BLD",10470,"KRN",9.8,"NM","B","RCDPELAR",29)

"BLD",10470,"KRN",9.8,"NM","B","RCDPEM",11)

"BLD",10470,"KRN",9.8,"NM","B","RCDPEM1",12)

"BLD",10470,"KRN",9.8,"NM","B","RCDPEM9",28)

"BLD",10470,"KRN",9.8,"NM","B","RCDPEMA",13)

"BLD",10470,"KRN",9.8,"NM","B","RCDPESP",1)

"BLD",10470,"KRN",9.8,"NM","B","RCDPESP1",4)

"BLD",10470,"KRN",9.8,"NM","B","RCDPEWL",14)

"BLD",10470,"KRN",9.8,"NM","B","RCDPEWL2",21)

"BLD",10470,"KRN",9.8,"NM","B","RCDPEWL4",22)

"BLD",10470,"KRN",9.8,"NM","B","RCDPEWL6",20)

"BLD",10470,"KRN",9.8,"NM","B","RCDPEWL7",15)

"BLD",10470,"KRN",9.8,"NM","B","RCDPEWL8",19)

"BLD",10470,"KRN",19,0)
19
"BLD",10470,"KRN",19,"NM",0)
^9.68A^26^25
"BLD",10470,"KRN",19,"NM",2,0)
RCDPE NR MANUAL START^^0
"BLD",10470,"KRN",19,"NM",3,0)
RCDPE NR MANUAL TRANSMIT^^0
"BLD",10470,"KRN",19,"NM",4,0)
RCDPE NR DISABLE/ENABLE^^0
"BLD",10470,"KRN",19,"NM",5,0)
RCDPE AUTO-POST RECEIPT REPORT^^0
"BLD",10470,"KRN",19,"NM",6,0)
RCDPE EDI LOCKBOX REPORTS MENU^^0
"BLD",10470,"KRN",19,"NM",7,0)
RCDPE ACTIVE WITH EEOB REPORT^^4^
"BLD",10470,"KRN",19,"NM",8,0)
RCDPE AUTO-POST REPORT^^4^
"BLD",10470,"KRN",19,"NM",9,0)
RCDPE AUTO-DECREASE REPORT^^4^
"BLD",10470,"KRN",19,"NM",10,0)
RCDPE VIEW/PRINT ERA^^4^
"BLD",10470,"KRN",19,"NM",11,0)
RCDPE REMOVED ERA AUDIT^^4^
"BLD",10470,"KRN",19,"NM",12,0)
RCDPE ERA W/PAPER EOB REPORT^^4^
"BLD",10470,"KRN",19,"NM",13,0)
RCDPE EFT AUDIT REPORT^^4^
"BLD",10470,"KRN",19,"NM",14,0)
RCDPE EEOB MOVE/COPY/RMOVE RPT^^4^
"BLD",10470,"KRN",19,"NM",15,0)
RCDPE PAYER EXCLUSION NAME TIN^^4^
"BLD",10470,"KRN",19,"NM",16,0)
RCDPE CARC/RARC TABLE REPORT^^4^
"BLD",10470,"KRN",19,"NM",17,0)
RCDPE EDI LOCKBOX ACT REPORT^^4^
"BLD",10470,"KRN",19,"NM",18,0)
RCDPE EFT AGING REPORT^^4^
"BLD",10470,"KRN",19,"NM",19,0)
RCDPE ERA AGING REPORT^^4^
"BLD",10470,"KRN",19,"NM",20,0)
RCDPE CARC/RARC QUICK SEARCH^^4^
"BLD",10470,"KRN",19,"NM",21,0)
RCDPE PROVIDER LVL ADJ REPORT^^4^
"BLD",10470,"KRN",19,"NM",22,0)
RCDPE EFT TRANSACTION AUD REP^^4^
"BLD",10470,"KRN",19,"NM",23,0)
RCDPE CARC CODE PAYER REPORT^^4^
"BLD",10470,"KRN",19,"NM",24,0)
RCDPE ERA STATUS CHNG AUD REP^^4^
"BLD",10470,"KRN",19,"NM",25,0)
RCDPE UNAPPLIED EFT DEP REPORT^^4^
"BLD",10470,"KRN",19,"NM",26,0)
RCDP AGENT CASHIER MENU^^2
"BLD",10470,"KRN",19,"NM","B","RCDP AGENT CASHIER MENU",26)

"BLD",10470,"KRN",19,"NM","B","RCDPE ACTIVE WITH EEOB REPORT",7)

"BLD",10470,"KRN",19,"NM","B","RCDPE AUTO-DECREASE REPORT",9)

"BLD",10470,"KRN",19,"NM","B","RCDPE AUTO-POST RECEIPT REPORT",5)

"BLD",10470,"KRN",19,"NM","B","RCDPE AUTO-POST REPORT",8)

"BLD",10470,"KRN",19,"NM","B","RCDPE CARC CODE PAYER REPORT",23)

"BLD",10470,"KRN",19,"NM","B","RCDPE CARC/RARC QUICK SEARCH",20)

"BLD",10470,"KRN",19,"NM","B","RCDPE CARC/RARC TABLE REPORT",16)

"BLD",10470,"KRN",19,"NM","B","RCDPE EDI LOCKBOX ACT REPORT",17)

"BLD",10470,"KRN",19,"NM","B","RCDPE EDI LOCKBOX REPORTS MENU",6)

"BLD",10470,"KRN",19,"NM","B","RCDPE EEOB MOVE/COPY/RMOVE RPT",14)

"BLD",10470,"KRN",19,"NM","B","RCDPE EFT AGING REPORT",18)

"BLD",10470,"KRN",19,"NM","B","RCDPE EFT AUDIT REPORT",13)

"BLD",10470,"KRN",19,"NM","B","RCDPE EFT TRANSACTION AUD REP",22)

"BLD",10470,"KRN",19,"NM","B","RCDPE ERA AGING REPORT",19)

"BLD",10470,"KRN",19,"NM","B","RCDPE ERA STATUS CHNG AUD REP",24)

"BLD",10470,"KRN",19,"NM","B","RCDPE ERA W/PAPER EOB REPORT",12)

"BLD",10470,"KRN",19,"NM","B","RCDPE NR DISABLE/ENABLE",4)

"BLD",10470,"KRN",19,"NM","B","RCDPE NR MANUAL START",2)

"BLD",10470,"KRN",19,"NM","B","RCDPE NR MANUAL TRANSMIT",3)

"BLD",10470,"KRN",19,"NM","B","RCDPE PAYER EXCLUSION NAME TIN",15)

"BLD",10470,"KRN",19,"NM","B","RCDPE PROVIDER LVL ADJ REPORT",21)

"BLD",10470,"KRN",19,"NM","B","RCDPE REMOVED ERA AUDIT",11)

"BLD",10470,"KRN",19,"NM","B","RCDPE UNAPPLIED EFT DEP REPORT",25)

"BLD",10470,"KRN",19,"NM","B","RCDPE VIEW/PRINT ERA",10)

"BLD",10470,"KRN",19.1,0)
19.1
"BLD",10470,"KRN",19.1,"NM",0)
^9.68A^2^2
"BLD",10470,"KRN",19.1,"NM",1,0)
RCDPEAR^^0
"BLD",10470,"KRN",19.1,"NM",2,0)
RCDPEPP^^0
"BLD",10470,"KRN",19.1,"NM","B","RCDPEAR",1)

"BLD",10470,"KRN",19.1,"NM","B","RCDPEPP",2)

"BLD",10470,"KRN",101,0)
101
"BLD",10470,"KRN",101,"NM",0)
^9.68A^24^24
"BLD",10470,"KRN",101,"NM",1,0)
RCDPE EOB WORKLIST MENU^^0
"BLD",10470,"KRN",101,"NM",2,0)
RCDPE EOB WORKLIST SPLIT LINE^^0
"BLD",10470,"KRN",101,"NM",3,0)
RCDPE EOB WORKLIST RESEARCH^^0
"BLD",10470,"KRN",101,"NM",4,0)
RCDPE EOB WL REVIEW^^0
"BLD",10470,"KRN",101,"NM",5,0)
RCDPE EOB WORKLIST CHANGE VIEW^^0
"BLD",10470,"KRN",101,"NM",6,0)
RCDPE EOB WORKLIST DIST ADJ^^0
"BLD",10470,"KRN",101,"NM",7,0)
RCDPE VIEW/PRINT WORKLIST ERA^^0
"BLD",10470,"KRN",101,"NM",8,0)
VALM QUIT^^0
"BLD",10470,"KRN",101,"NM",9,0)
RCDPE EOB WORKLIST RECEIPT PROCESSING^^0
"BLD",10470,"KRN",101,"NM",10,0)
RCDPE EOB WL RECEIPT VIEW^^0
"BLD",10470,"KRN",101,"NM",11,0)
RCDPE EOB WORKLIST MARK FOR AUTO POST^^0
"BLD",10470,"KRN",101,"NM",12,0)
RCDPE EOB WORKLIST VERIFY^^0
"BLD",10470,"KRN",101,"NM",13,0)
RCDPE EOB WORKLIST RESEARCH MENU^^0
"BLD",10470,"KRN",101,"NM",14,0)
RCDPE EOB WORKLIST FULL ACCT PROF^^0
"BLD",10470,"KRN",101,"NM",15,0)
RCDPE EOB WORKLIST TPJI^^0
"BLD",10470,"KRN",101,"NM",16,0)
RCDPE EOB WORKLIST BILL COMMENT^^0
"BLD",10470,"KRN",101,"NM",17,0)
RCDPE EOB WL RESEARCH EXIT^^0
"BLD",10470,"KRN",101,"NM",18,0)
RCDPE EOB WORKLIST REESTABLISH^^0
"BLD",10470,"KRN",101,"NM",19,0)
RCDPE EOB WORKLIST ADMIN COST ADJ^^0
"BLD",10470,"KRN",101,"NM",20,0)
RCDPE APAR EEOB RESEARCH MENU^^0
"BLD",10470,"KRN",101,"NM",21,0)
RCDPE APAR VIEW/PRINT EOB^^0
"BLD",10470,"KRN",101,"NM",22,0)
RCDPE APAR EEOB REVIEW^^0
"BLD",10470,"KRN",101,"NM",23,0)
RCDPE VIEW/PRINT WORKLIST EOB^^0
"BLD",10470,"KRN",101,"NM",24,0)
RCDPE EOB WORKLIST REFRESH^^0
"BLD",10470,"KRN",101,"NM","B","RCDPE APAR EEOB RESEARCH MENU",20)

"BLD",10470,"KRN",101,"NM","B","RCDPE APAR EEOB REVIEW",22)

"BLD",10470,"KRN",101,"NM","B","RCDPE APAR VIEW/PRINT EOB",21)

"BLD",10470,"KRN",101,"NM","B","RCDPE EOB WL RECEIPT VIEW",10)

"BLD",10470,"KRN",101,"NM","B","RCDPE EOB WL RESEARCH EXIT",17)

"BLD",10470,"KRN",101,"NM","B","RCDPE EOB WL REVIEW",4)

"BLD",10470,"KRN",101,"NM","B","RCDPE EOB WORKLIST ADMIN COST ADJ",19)

"BLD",10470,"KRN",101,"NM","B","RCDPE EOB WORKLIST BILL COMMENT",16)

"BLD",10470,"KRN",101,"NM","B","RCDPE EOB WORKLIST CHANGE VIEW",5)

"BLD",10470,"KRN",101,"NM","B","RCDPE EOB WORKLIST DIST ADJ",6)

"BLD",10470,"KRN",101,"NM","B","RCDPE EOB WORKLIST FULL ACCT PROF",14)

"BLD",10470,"KRN",101,"NM","B","RCDPE EOB WORKLIST MARK FOR AUTO POST",11)

"BLD",10470,"KRN",101,"NM","B","RCDPE EOB WORKLIST MENU",1)

"BLD",10470,"KRN",101,"NM","B","RCDPE EOB WORKLIST RECEIPT PROCESSING",9)

"BLD",10470,"KRN",101,"NM","B","RCDPE EOB WORKLIST REESTABLISH",18)

"BLD",10470,"KRN",101,"NM","B","RCDPE EOB WORKLIST REFRESH",24)

"BLD",10470,"KRN",101,"NM","B","RCDPE EOB WORKLIST RESEARCH",3)

"BLD",10470,"KRN",101,"NM","B","RCDPE EOB WORKLIST RESEARCH MENU",13)

"BLD",10470,"KRN",101,"NM","B","RCDPE EOB WORKLIST SPLIT LINE",2)

"BLD",10470,"KRN",101,"NM","B","RCDPE EOB WORKLIST TPJI",15)

"BLD",10470,"KRN",101,"NM","B","RCDPE EOB WORKLIST VERIFY",12)

"BLD",10470,"KRN",101,"NM","B","RCDPE VIEW/PRINT WORKLIST EOB",23)

"BLD",10470,"KRN",101,"NM","B","RCDPE VIEW/PRINT WORKLIST ERA",7)

"BLD",10470,"KRN",101,"NM","B","VALM QUIT",8)

"BLD",10470,"KRN",409.61,0)
409.61
"BLD",10470,"KRN",409.61,"NM",0)
^9.68A^^
"BLD",10470,"KRN",771,0)
771
"BLD",10470,"KRN",779.2,0)
779.2
"BLD",10470,"KRN",870,0)
870
"BLD",10470,"KRN",8989.51,0)
8989.51
"BLD",10470,"KRN",8989.52,0)
8989.52
"BLD",10470,"KRN",8994,0)
8994
"BLD",10470,"KRN","B",.4,.4)

"BLD",10470,"KRN","B",.401,.401)

"BLD",10470,"KRN","B",.402,.402)

"BLD",10470,"KRN","B",.403,.403)

"BLD",10470,"KRN","B",.5,.5)

"BLD",10470,"KRN","B",.84,.84)

"BLD",10470,"KRN","B",3.6,3.6)

"BLD",10470,"KRN","B",3.8,3.8)

"BLD",10470,"KRN","B",9.2,9.2)

"BLD",10470,"KRN","B",9.8,9.8)

"BLD",10470,"KRN","B",19,19)

"BLD",10470,"KRN","B",19.1,19.1)

"BLD",10470,"KRN","B",101,101)

"BLD",10470,"KRN","B",409.61,409.61)

"BLD",10470,"KRN","B",771,771)

"BLD",10470,"KRN","B",779.2,779.2)

"BLD",10470,"KRN","B",870,870)

"BLD",10470,"KRN","B",8989.51,8989.51)

"BLD",10470,"KRN","B",8989.52,8989.52)

"BLD",10470,"KRN","B",8994,8994)

"BLD",10470,"QDEF")
^^^^^^^^YES^^YES
"BLD",10470,"QUES",0)
^9.62^^
"BLD",10470,"REQB",0)
^9.611^4^4
"BLD",10470,"REQB",1,0)
PRCA*4.5*304^1
"BLD",10470,"REQB",2,0)
PRCA*4.5*317^1
"BLD",10470,"REQB",3,0)
PRCA*4.5*301^1
"BLD",10470,"REQB",4,0)
PRCA*4.5*303^1
"BLD",10470,"REQB","B","PRCA*4.5*301",3)

"BLD",10470,"REQB","B","PRCA*4.5*303",4)

"BLD",10470,"REQB","B","PRCA*4.5*304",1)

"BLD",10470,"REQB","B","PRCA*4.5*317",2)

"FIA",344.31)
EDI THIRD PARTY EFT DETAIL
"FIA",344.31,0)
^RCY(344.31,
"FIA",344.31,0,0)
344.31PI
"FIA",344.31,0,1)
y^y^p^^^^n^^n
"FIA",344.31,0,10)

"FIA",344.31,0,11)

"FIA",344.31,0,"RLRO")

"FIA",344.31,0,"VR")
4.5^PRCA
"FIA",344.31,344.31)
1
"FIA",344.31,344.31,.02)

"FIA",344.4)
ELECTRONIC REMITTANCE ADVICE
"FIA",344.4,0)
^RCY(344.4,
"FIA",344.4,0,0)
344.4I
"FIA",344.4,0,1)
y^y^p^^^^n^^n
"FIA",344.4,0,10)

"FIA",344.4,0,11)

"FIA",344.4,0,"RLRO")

"FIA",344.4,0,"VR")
4.5^PRCA
"FIA",344.4,344.4)
1
"FIA",344.4,344.4,.06)

"INI")
PRE^PRCAP318
"INIT")
POST^PRCAP318
"IX",344.31,344.31,"C",0)
344.31^C^Used to look up entries by the full payer name.^R^^F^IR^I^344.31^^^^^LS
"IX",344.31,344.31,"C",.1,0)
^^1^1^3170316^
"IX",344.31,344.31,"C",.1,1,0)
This cross-reference is used for payer names of up to 60 characters.
"IX",344.31,344.31,"C",1)
S ^RCY(344.31,"C",$E(X,1,60),DA)=""
"IX",344.31,344.31,"C",2)
K ^RCY(344.31,"C",$E(X,1,60),DA)
"IX",344.31,344.31,"C",2.5)
K ^RCY(344.31,"C")
"IX",344.31,344.31,"C",11.1,0)
^.114IA^1^1
"IX",344.31,344.31,"C",11.1,1,0)
1^F^344.31^.02^60^1^F
"IX",344.4,344.4,"C",0)
344.4^C^Used to look up entries by the full payer name.^MU^^F^IR^I^344.4^^^^^LS
"IX",344.4,344.4,"C",.1,0)
^^3^3^3170310^
"IX",344.4,344.4,"C",.1,1,0)
This cross-reference is used for payer names of up to 60 characters. 
"IX",344.4,344.4,"C",.1,2,0)
 
"IX",344.4,344.4,"C",.1,3,0)
Do not delete this cross-reference.
"IX",344.4,344.4,"C",1)
S ^RCY(344.4,"C",$$UP^XLFSTR($E(X,1,60)),DA)=""
"IX",344.4,344.4,"C",2)
K ^RCY(344.4,"C",$$UP^XLFSTR($E(X,1,60)),DA)
"IX",344.4,344.4,"C",2.5)
K ^RCY(344.4,"C")
"IX",344.4,344.4,"C",11.1,0)
^.114IA^1^1
"IX",344.4,344.4,"C",11.1,1,0)
1^F^344.4^.06^60^1^F
"KRN",19,2918308,-1)
2^26
"KRN",19,2918308,0)
RCDP AGENT CASHIER MENU^Agent Cashier Menu^^M^568^^^^^^^561
"KRN",19,2918308,10,0)
^19.01IP^19^19
"KRN",19,2918308,10,19,0)
2922451^APR^9.5
"KRN",19,2918308,10,19,"^")
RCDPE AUTO-POST RECEIPT REPORT
"KRN",19,2918308,"U")
AGENT CASHIER MENU
"KRN",19,2919462,-1)
4^18
"KRN",19,2919462,0)
RCDPE EFT AGING REPORT
"KRN",19,2919463,-1)
4^19
"KRN",19,2919463,0)
RCDPE ERA AGING REPORT
"KRN",19,2919468,-1)
4^17
"KRN",19,2919468,0)
RCDPE EDI LOCKBOX ACT REPORT
"KRN",19,2919470,-1)
0^6
"KRN",19,2919470,0)
RCDPE EDI LOCKBOX REPORTS MENU^EDI Lockbox (ePayments) Reports Menu^^M^^^^^^^^ACCOUNTS RECEIVABLE
"KRN",19,2919470,1,0)
2^19.06^2^2^3140224^^^^
"KRN",19,2919470,1,1,0)
This menu allows access to all the reports that can be produced for EDI
"KRN",19,2919470,1,2,0)
Lockbox.
"KRN",19,2919470,10,0)
^19.01IP^23^23
"KRN",19,2919470,10,1,0)
2919468^DA^10
"KRN",19,2919470,10,1,"^")
RCDPE EDI LOCKBOX ACT REPORT
"KRN",19,2919470,10,3,0)
2919462^EFT^30
"KRN",19,2919470,10,3,"^")
RCDPE EFT AGING REPORT
"KRN",19,2919470,10,4,0)
2919463^ERA^40
"KRN",19,2919470,10,4,"^")
RCDPE ERA AGING REPORT
"KRN",19,2919470,10,6,0)
2919477^VP
"KRN",19,2919470,10,6,"^")
RCDPE VIEW/PRINT ERA
"KRN",19,2919470,10,7,0)
2919712^AB^60
"KRN",19,2919470,10,7,"^")
RCDPE ACTIVE WITH EEOB REPORT
"KRN",19,2919470,10,9,0)
2921658^REMR^
"KRN",19,2919470,10,9,"^")
RCDPE REMOVED ERA AUDIT
"KRN",19,2919470,10,10,0)
2921610^POSR^
"KRN",19,2919470,10,10,"^")
RCDPE ERA W/PAPER EOB REPORT
"KRN",19,2919470,10,11,0)
2921611^DUPR
"KRN",19,2919470,10,11,"^")
RCDPE EFT AUDIT REPORT
"KRN",19,2919470,10,12,0)
2922179^MCR
"KRN",19,2919470,10,12,"^")
RCDPE EEOB MOVE/COPY/RMOVE RPT
"KRN",19,2919470,10,13,0)
2922181^AP^80
"KRN",19,2919470,10,13,"^")
RCDPE AUTO-POST REPORT
"KRN",19,2919470,10,14,0)
2922182^AD^70
"KRN",19,2919470,10,14,"^")
RCDPE AUTO-DECREASE REPORT
"KRN",19,2919470,10,15,0)
2922186^PX
"KRN",19,2919470,10,15,"^")
RCDPE PAYER EXCLUSION NAME TIN
"KRN",19,2919470,10,16,0)
2922296^TB
"KRN",19,2919470,10,16,"^")
RCDPE CARC/RARC TABLE REPORT
"KRN",19,2919470,10,17,0)
2922299^QS
"KRN",19,2919470,10,17,"^")
RCDPE CARC/RARC QUICK SEARCH
"KRN",19,2919470,10,18,0)
2922297^PLB
"KRN",19,2919470,10,18,"^")
RCDPE PROVIDER LVL ADJ REPORT
"KRN",19,2919470,10,19,0)
2922298^ETA
"KRN",19,2919470,10,19,"^")
RCDPE EFT TRANSACTION AUD REP
"KRN",19,2919470,10,20,0)
2922295^CR
"KRN",19,2919470,10,20,"^")
RCDPE CARC CODE PAYER REPORT
"KRN",19,2919470,10,21,0)
2922310^ESC
"KRN",19,2919470,10,21,"^")
RCDPE ERA STATUS CHNG AUD REP
"KRN",19,2919470,10,22,0)
2922424^UN^50
"KRN",19,2919470,10,22,"^")
RCDPE UNAPPLIED EFT DEP REPORT
"KRN",19,2919470,10,23,0)
2922451^APR^90
"KRN",19,2919470,10,23,"^")
RCDPE AUTO-POST RECEIPT REPORT
"KRN",19,2919470,99)
64464,36522
"KRN",19,2919470,99.1)
59232,49629
"KRN",19,2919470,"U")
EDI LOCKBOX (EPAYMENTS) REPORT
"KRN",19,2919477,-1)
4^10
"KRN",19,2919477,0)
RCDPE VIEW/PRINT ERA
"KRN",19,2919712,-1)
4^7
"KRN",19,2919712,0)
RCDPE ACTIVE WITH EEOB REPORT
"KRN",19,2921610,-1)
4^12
"KRN",19,2921610,0)
RCDPE ERA W/PAPER EOB REPORT
"KRN",19,2921611,-1)
4^13
"KRN",19,2921611,0)
RCDPE EFT AUDIT REPORT
"KRN",19,2921658,-1)
4^11
"KRN",19,2921658,0)
RCDPE REMOVED ERA AUDIT
"KRN",19,2922179,-1)
4^14
"KRN",19,2922179,0)
RCDPE EEOB MOVE/COPY/RMOVE RPT
"KRN",19,2922181,-1)
4^8
"KRN",19,2922181,0)
RCDPE AUTO-POST REPORT
"KRN",19,2922182,-1)
4^9
"KRN",19,2922182,0)
RCDPE AUTO-DECREASE REPORT
"KRN",19,2922186,-1)
4^15
"KRN",19,2922186,0)
RCDPE PAYER EXCLUSION NAME TIN
"KRN",19,2922295,-1)
4^23
"KRN",19,2922295,0)
RCDPE CARC CODE PAYER REPORT
"KRN",19,2922296,-1)
4^16
"KRN",19,2922296,0)
RCDPE CARC/RARC TABLE REPORT
"KRN",19,2922297,-1)
4^21
"KRN",19,2922297,0)
RCDPE PROVIDER LVL ADJ REPORT
"KRN",19,2922298,-1)
4^22
"KRN",19,2922298,0)
RCDPE EFT TRANSACTION AUD REP
"KRN",19,2922299,-1)
4^20
"KRN",19,2922299,0)
RCDPE CARC/RARC QUICK SEARCH
"KRN",19,2922303,-1)
0^4
"KRN",19,2922303,0)
RCDPE NR DISABLE/ENABLE^Disable-Enable DM Background Job/Reports^^R^^PRCFA SUPERVISOR^^^^^^ACCOUNTS RECEIVABLE
"KRN",19,2922303,1,0)
^^3^3^3150603^
"KRN",19,2922303,1,1,0)
This option allows a user to disable or re-enable the AR National Reports 
"KRN",19,2922303,1,2,0)
background job.  Once a report is disabled, it won't re-queue to run via 
"KRN",19,2922303,1,3,0)
the AR National Reports process.
"KRN",19,2922303,25)
DER^RCDPENRU
"KRN",19,2922303,"U")
DISABLE-ENABLE DM BACKGROUND J
"KRN",19,2922305,-1)
0^2
"KRN",19,2922305,0)
RCDPE NR MANUAL START^Manually Start DM Extract^^R^^PRCFA SUPERVISOR^^^^^^ACCOUNTS RECEIVABLE
"KRN",19,2922305,1,0)
^19.06^2^2^3150603^^
"KRN",19,2922305,1,1,0)
This option allows a user to restart the AR National Reports Extraction 
"KRN",19,2922305,1,2,0)
background job if the report is not running.
"KRN",19,2922305,25)
MAN1^RCDPENRU
"KRN",19,2922305,33)

"KRN",19,2922305,"U")
MANUALLY START DM EXTRACT
"KRN",19,2922306,-1)
0^3
"KRN",19,2922306,0)
RCDPE NR MANUAL TRANSMIT^Manually Transmit DM Extract^^R^^PRCFA SUPERVISOR^^^^^^ACCOUNTS RECEIVABLE
"KRN",19,2922306,1,0)
^19.06^3^3^3150603^^
"KRN",19,2922306,1,1,0)
This option allows a user to retransmit a AR National Report file to 
"KRN",19,2922306,1,2,0)
FORUM for a particular month if that month's report data did not 
"KRN",19,2922306,1,3,0)
successfully transmit the first time.
"KRN",19,2922306,25)
MAN2^RCDPENRU
"KRN",19,2922306,"U")
MANUALLY TRANSMIT DM EXTRACT
"KRN",19,2922310,-1)
4^24
"KRN",19,2922310,0)
RCDPE ERA STATUS CHNG AUD REP
"KRN",19,2922424,-1)
4^25
"KRN",19,2922424,0)
RCDPE UNAPPLIED EFT DEP REPORT
"KRN",19,2922451,-1)
0^5
"KRN",19,2922451,0)
RCDPE AUTO-POST RECEIPT REPORT^Auto-Posted Receipt Report^^R^^^^^^^^ACCOUNTS RECEIVABLE
"KRN",19,2922451,1,0)
^^2^2^3170329^
"KRN",19,2922451,1,1,0)
The Auto-Posted Receipt Report (APR) option displays receipt details
"KRN",19,2922451,1,2,0)
associated with auto-posted ERA/EFT, including totals.
"KRN",19,2922451,25)
EN^RCDPELAR
"KRN",19,2922451,668000,0)
^19.0668^1^1
"KRN",19,2922451,668000,1,0)
APR
"KRN",19,2922451,"U")
AUTO-POSTED RECEIPT REPORT
"KRN",19.1,973,-1)
0^2
"KRN",19.1,973,0)
RCDPEPP^Payment Posting
"KRN",19.1,974,-1)
0^1
"KRN",19.1,974,0)
RCDPEAR^Accounts Receivable
"KRN",101,1697,-1)
0^8
"KRN",101,1697,0)
VALM QUIT^Quit^^A^^^^^^^^
"KRN",101,1697,.1)
 
"KRN",101,1697,1,0)
^^1^1^2911105^
"KRN",101,1697,1,1,0)
This protocol can be used as a generic 'quit' action.
"KRN",101,1697,2,0)
^101.02A^2^2
"KRN",101,1697,2,1,0)
EXIT
"KRN",101,1697,2,2,0)
QUIT
"KRN",101,1697,2,"B","EXIT",1)

"KRN",101,1697,2,"B","QUIT",2)

"KRN",101,1697,15)

"KRN",101,1697,20)
Q
"KRN",101,1697,99)
64464,36521
"KRN",101,6663,-1)
0^1
"KRN",101,6663,0)
RCDPE EOB WORKLIST MENU^EOB WORKLIST MENU^^M^^^^^^^^ACCOUNTS RECEIVABLE
"KRN",101,6663,1,0)
^101.06^2^2^3170328^^^^
"KRN",101,6663,1,1,0)
This is the main menu that contains the actions that can be performed
"KRN",101,6663,1,2,0)
manually on ERAs received.
"KRN",101,6663,4)
26^4
"KRN",101,6663,10,0)
^101.01PA^32^32
"KRN",101,6663,10,6,0)
6672^^100^
"KRN",101,6663,10,6,"^")
RCDPE EOB WORKLIST SPLIT LINE
"KRN",101,6663,10,7,0)
6673^^110^
"KRN",101,6663,10,7,"^")
RCDPE EOB WORKLIST DIST ADJ
"KRN",101,6663,10,17,0)
6761^^230^
"KRN",101,6663,10,17,"^")
RCDPE EOB WORKLIST VERIFY
"KRN",101,6663,10,23,0)
1697^^999^^^EXIT
"KRN",101,6663,10,23,"^")
VALM QUIT
"KRN",101,6663,10,24,0)
6675^ERA^310^
"KRN",101,6663,10,24,"^")
RCDPE VIEW/PRINT WORKLIST ERA
"KRN",101,6663,10,25,0)
6691^^210^
"KRN",101,6663,10,25,"^")
RCDPE EOB WL REVIEW
"KRN",101,6663,10,27,0)
7960^^240^
"KRN",101,6663,10,27,"^")
RCDPE EOB WORKLIST CHANGE VIEW
"KRN",101,6663,10,28,0)
6682^^200^
"KRN",101,6663,10,28,"^")
RCDPE EOB WL RECEIPT VIEW
"KRN",101,6663,10,29,0)
8019^^300^
"KRN",101,6663,10,29,"^")
RCDPE EOB WORKLIST MARK FOR AUTO POST
"KRN",101,6663,10,30,0)
6674^^120^
"KRN",101,6663,10,30,"^")
RCDPE EOB WORKLIST REFRESH
"KRN",101,6663,10,31,0)
8009^RP^320^
"KRN",101,6663,10,31,"^")
RCDPE EOB WORKLIST RECEIPT PROCESSING
"KRN",101,6663,10,32,0)
6678^^130^
"KRN",101,6663,10,32,"^")
RCDPE EOB WORKLIST RESEARCH
"KRN",101,6663,15)
I $G(RCFASTXT) S VALMBCK="Q"
"KRN",101,6663,26)
D SHOW^VALM
"KRN",101,6663,28)
Select Action: 
"KRN",101,6663,99)
64464,36521
"KRN",101,6664,-1)
0^13
"KRN",101,6664,0)
RCDPE EOB WORKLIST RESEARCH MENU^Research Menu^^M^^^^^^^^ACCOUNTS RECEIVABLE
"KRN",101,6664,1,0)
^101.06^2^2^3170327^^^^
"KRN",101,6664,1,1,0)
This is the main menu that contains the actions that can be performed to 
"KRN",101,6664,1,2,0)
research a payment/denial for a claim when reviewing an EOB.
"KRN",101,6664,2,0)
^101.02A^^0
"KRN",101,6664,4)
26^4
"KRN",101,6664,10,0)
^101.01PA^13^13
"KRN",101,6664,10,4,0)
6691^^300^
"KRN",101,6664,10,4,"^")
RCDPE EOB WL REVIEW
"KRN",101,6664,10,5,0)
6688^^200^
"KRN",101,6664,10,5,"^")
RCDPE EOB WORKLIST BILL COMMENT
"KRN",101,6664,10,7,0)
6669^^100^
"KRN",101,6664,10,7,"^")
RCDPE EOB WORKLIST FULL ACCT PROF
"KRN",101,6664,10,8,0)
6677^^310^
"KRN",101,6664,10,8,"^")
RCDPE EOB WL RESEARCH EXIT
"KRN",101,6664,10,9,0)
6666^^130^
"KRN",101,6664,10,9,"^")
RCDPE EOB WORKLIST TPJI
"KRN",101,6664,10,11,0)
6665^^220^
"KRN",101,6664,10,11,"^")
RCDPE VIEW/PRINT WORKLIST EOB
"KRN",101,6664,10,12,0)
6687^^210^
"KRN",101,6664,10,12,"^")
RCDPE EOB WORKLIST REESTABLISH
"KRN",101,6664,10,13,0)
7602^^110^
"KRN",101,6664,10,13,"^")
RCDPE EOB WORKLIST ADMIN COST ADJ
"KRN",101,6664,15)
I $G(RCFASTXT) S VALMBCK="Q"
"KRN",101,6664,26)
D SHOW^VALM
"KRN",101,6664,28)
Select Action: 
"KRN",101,6664,99)
64464,36521
"KRN",101,6665,-1)
0^23
"KRN",101,6665,0)
RCDPE VIEW/PRINT WORKLIST EOB^View/Print EEOB^^A^^^^^^^^ACCOUNTS RECEIVABLE
"KRN",101,6665,1,0)
^101.06^2^2^3030220^^^^
"KRN",101,6665,1,1,0)
This option allows the user to view the detail of a selected EOB from the
"KRN",101,6665,1,2,0)
list of EOB's presented in the Worklist Scratch pad function for an ERA.
"KRN",101,6665,4)
^^^
"KRN",101,6665,20)
D PREOB^RCDPEWL2
"KRN",101,6665,99)
64464,36521
"KRN",101,6666,-1)
0^15
"KRN",101,6666,0)
RCDPE EOB WORKLIST TPJI^TPJI^^A^^^^^^^^ACCOUNTS RECEIVABLE
"KRN",101,6666,1,0)
^101.06^2^2^3021127^^^^
"KRN",101,6666,1,1,0)
This option allows the user access the third party joint inquiry (TPJI)
"KRN",101,6666,1,2,0)
functions for an electronic EOB's claim.
"KRN",101,6666,4)
^^^VP
"KRN",101,6666,20)
D TPJI^RCDPEWL2
"KRN",101,6666,99)
64464,36521
"KRN",101,6669,-1)
0^14
"KRN",101,6669,0)
RCDPE EOB WORKLIST FULL ACCT PROF^Full Acct Prof^^A^^^^^^^^ACCOUNTS RECEIVABLE
"KRN",101,6669,1,0)
^101.06^1^1^3030701^^^^
"KRN",101,6669,1,1,0)
This option allows the user access to the AR function FULL ACCOUNT PROFILE.
"KRN",101,6669,4)
^^^DA
"KRN",101,6669,20)
D FAP^RCDPEWL2
"KRN",101,6669,99)
64464,36521
"KRN",101,6672,-1)
0^2
"KRN",101,6672,0)
RCDPE EOB WORKLIST SPLIT LINE^Split/Edit A Line^^A^^^^^^^^ACCOUNTS RECEIVABLE
"KRN",101,6672,1,0)
^101.06^3^3^3030218^^^^
"KRN",101,6672,1,1,0)
This option allows the user to split the payment and adjustment amounts of
"KRN",101,6672,1,2,0)
a selected line in the ERA to redistribute the funds to more accurately
"KRN",101,6672,1,3,0)
reflect the disposition of the payment/adjustment.
"KRN",101,6672,4)
^^^TB
"KRN",101,6672,20)
D SPLIT^RCDPEWL0
"KRN",101,6672,99)
64464,36521
"KRN",101,6673,-1)
0^6
"KRN",101,6673,0)
RCDPE EOB WORKLIST DIST ADJ^Distribute Adj Amts^^A^^^^^^^^ACCOUNTS RECEIVABLE
"KRN",101,6673,1,0)
^101.06^4^4^3170328^^^^
"KRN",101,6673,1,1,0)
This option allows the user to select an adjustment line that has a
"KRN",101,6673,1,2,0)
negative net payment to allow this amount to be distributed to other
"KRN",101,6673,1,3,0)
lines so the total amount of payments received to post equals the total
"KRN",101,6673,1,4,0)
amount of the deposit.
"KRN",101,6673,4)
^^^TB
"KRN",101,6673,20)
D DISTADJ^RCDPEWL6
"KRN",101,6673,99)
64464,36521
"KRN",101,6674,-1)
0^24
"KRN",101,6674,0)
RCDPE EOB WORKLIST REFRESH^Refresh Scratch Pad^^A^^^^^^^^ACCOUNTS RECEIVABLE
"KRN",101,6674,1,0)
^101.06^3^3^3170328^^^^
"KRN",101,6674,1,1,0)
This option allows the user to 'refresh' the worklist scratch pad entry
"KRN",101,6674,1,2,0)
to remove all previously entered edits/splits/adjustments and restore it
"KRN",101,6674,1,3,0)
to the state it was in before any manual changes were made.
"KRN",101,6674,4)
^^^TB
"KRN",101,6674,20)
D REFRESH^RCDPEWL6
"KRN",101,6674,99)
64464,36521
"KRN",101,6675,-1)
0^7
"KRN",101,6675,0)
RCDPE VIEW/PRINT WORKLIST ERA^View/Print ERA^^A^^^^^^^^ACCOUNTS RECEIVABLE
"KRN",101,6675,1,0)
^101.06^2^2^3030219^^^^
"KRN",101,6675,1,1,0)
This option allows the user to view the summary or summary and detail
"KRN",101,6675,1,2,0)
information for an electronic remittance advice (ERA).
"KRN",101,6675,20)
D PRERA^RCDPEWL0
"KRN",101,6675,99)
64464,36521
"KRN",101,6677,-1)
0^17
"KRN",101,6677,0)
RCDPE EOB WL RESEARCH EXIT^Scratch Pad Menu/Exit^^A^^^^^^^^ACCOUNTS RECEIVABLE
"KRN",101,6677,1,0)
^^1^1^3030219^
"KRN",101,6677,1,1,0)
This option allows the user access to exit back to the ERA display menu
"KRN",101,6677,4)
^^^
"KRN",101,6677,20)
D EXIT^RCDPEWL2
"KRN",101,6677,99)
64464,36521
"KRN",101,6678,-1)
0^3
"KRN",101,6678,0)
RCDPE EOB WORKLIST RESEARCH^Research Menu^^A^^^^^^^^ACCOUNTS RECEIVABLE
"KRN",101,6678,1,0)
^101.06^2^2^3030219^^^^
"KRN",101,6678,1,1,0)
This option allows the user access to the IB options for cancel, edit, add
"KRN",101,6678,1,2,0)
patient charges from within the EDI Lockbox worklist function.
"KRN",101,6678,4)
^^^
"KRN",101,6678,20)
D RESEARCH^RCDPEWL2
"KRN",101,6678,99)
64464,36521
"KRN",101,6682,-1)
0^10
"KRN",101,6682,0)
RCDPE EOB WL RECEIPT VIEW^Look At Receipt^^A^^^^^^^^ACCOUNTS RECEIVABLE
"KRN",101,6682,20)
D VRECPT^RCDPEWL4
"KRN",101,6682,99)
64464,36521
"KRN",101,6687,-1)
0^18
"KRN",101,6687,0)
RCDPE EOB WORKLIST REESTABLISH^Re-establish Bill^^A^^^^^^^^ACCOUNTS RECEIVABLE
"KRN",101,6687,20)
D REEST^RCDPEWL2
"KRN",101,6687,99)
64464,36521
"KRN",101,6688,-1)
0^16
"KRN",101,6688,0)
RCDPE EOB WORKLIST BILL COMMENT^Bill Comment Log^^A^^^^^^^^ACCOUNTS RECEIVABLE
"KRN",101,6688,20)
D BILLCOM^RCDPEWL2
"KRN",101,6688,99)
64464,36521
"KRN",101,6691,-1)
0^4
"KRN",101,6691,0)
RCDPE EOB WL REVIEW^Review Line^^A^^^^^^^^ACCOUNTS RECEIVABLE
"KRN",101,6691,20)
D REVIEW^RCDPEWL5
"KRN",101,6691,99)
64464,36521
"KRN",101,6761,-1)
0^12
"KRN",101,6761,0)
RCDPE EOB WORKLIST VERIFY^Verify^^A^^^^^^^^ACCOUNTS RECEIVABLE
"KRN",101,6761,1,0)
^101.06^3^3^3170328^^^^
"KRN",101,6761,1,1,0)
This option allows the user to access the options for verifying the
"KRN",101,6761,1,2,0)
EEOBs against the data on the VistA system to insure the payments are
"KRN",101,6761,1,3,0)
being made for the correct claim.
"KRN",101,6761,20)
D VERIF^RCDPEWL8
"KRN",101,6761,99)
64464,36521
"KRN",101,7602,-1)
0^19
"KRN",101,7602,0)
RCDPE EOB WORKLIST ADMIN COST ADJ^Admin Cost Adj^^A^^^^^^^^ACCOUNTS RECEIVABLE
"KRN",101,7602,1,0)
^101.06^1^1^3170327^^^
"KRN",101,7602,1,1,0)
Used to adjust the administrative costs, IRS cost, DMV cost, etc
"KRN",101,7602,15)
S VALMBCK="R" K PRCASUP
"KRN",101,7602,20)
S PRCASUP=1 D FULL^VALM1 D ^PRCAEXM K DTOUT
"KRN",101,7602,99)
64464,36521
"KRN",101,7960,-1)
0^5
"KRN",101,7960,0)
RCDPE EOB WORKLIST CHANGE VIEW^Change View^^A^^^^^^^^ACCOUNTS RECEIVABLE
"KRN",101,7960,20)
D CV^RCDPEWL
"KRN",101,7960,99)
64464,36521
"KRN",101,7970,-1)
0^22
"KRN",101,7970,0)
RCDPE APAR EEOB REVIEW^Review Line^^A^^^^^^^^ACCOUNTS RECEIVABLE
"KRN",101,7970,1,0)
^^4^4^3140515^
"KRN",101,7970,1,1,0)
Allows addition of comments or used as a bookmark on a specific EEOB line 
"KRN",101,7970,1,2,0)
in case processing was interrupted, thereby allowing the user to more
"KRN",101,7970,1,3,0)
easily resume where they left off. This option must be turned 'on' each
"KRN",101,7970,1,4,0)
time the user enters the EEOB to enter or view comments.
"KRN",101,7970,20)
D REVIEW^RCDPEAA3(RCIENS)
"KRN",101,7970,99)
64464,36521
"KRN",101,7971,-1)
0^21
"KRN",101,7971,0)
RCDPE APAR VIEW/PRINT EOB^View/Print EEOB^^A^^^^^^^^ACCOUNTS RECEIVABLE
"KRN",101,7971,1,0)
^^2^2^3140516^
"KRN",101,7971,1,1,0)
This option allows the user to view the detail of a selected
"KRN",101,7971,1,2,0)
EOB presented in the APAR Scratch pad screen.
"KRN",101,7971,20)
D PREOB^RCDPEAA3($G(RCIENS))
"KRN",101,7971,99)
64464,36521
"KRN",101,7972,-1)
0^20
"KRN",101,7972,0)
RCDPE APAR EEOB RESEARCH MENU^APAR Research Menu^^M^^^^^^^^ACCOUNTS RECEIVABLE
"KRN",101,7972,1,0)
^101.06^2^2^3170327^^^
"KRN",101,7972,1,1,0)
This is the main menu that contains the actions that can be performed to
"KRN",101,7972,1,2,0)
research a payment/denial for a claim when reviewing an EOB.
"KRN",101,7972,4)
26^4
"KRN",101,7972,10,0)
^101.01PA^9^9
"KRN",101,7972,10,1,0)
6666^^120^
"KRN",101,7972,10,1,"^")
RCDPE EOB WORKLIST TPJI
"KRN",101,7972,10,2,0)
7971^^220^
"KRN",101,7972,10,2,"^")
RCDPE APAR VIEW/PRINT EOB
"KRN",101,7972,10,3,0)
7970^^300^
"KRN",101,7972,10,3,"^")
RCDPE APAR EEOB REVIEW
"KRN",101,7972,10,4,0)
6688^^200^
"KRN",101,7972,10,4,"^")
RCDPE EOB WORKLIST BILL COMMENT
"KRN",101,7972,10,6,0)
6669^^100^
"KRN",101,7972,10,6,"^")
RCDPE EOB WORKLIST FULL ACCT PROF
"KRN",101,7972,10,7,0)
6677^^310^
"KRN",101,7972,10,7,"^")
RCDPE EOB WL RESEARCH EXIT
"KRN",101,7972,10,8,0)
7602^^110^
"KRN",101,7972,10,8,"^")
RCDPE EOB WORKLIST ADMIN COST ADJ
"KRN",101,7972,10,9,0)
6687^^210^
"KRN",101,7972,10,9,"^")
RCDPE EOB WORKLIST REESTABLISH
"KRN",101,7972,15)
I $G(RCFASTXT) S VALMBCK="Q"
"KRN",101,7972,26)
D SHOW^VALM
"KRN",101,7972,28)
Select Action: 
"KRN",101,7972,99)
64464,36521
"KRN",101,8009,-1)
0^9
"KRN",101,8009,0)
RCDPE EOB WORKLIST RECEIPT PROCESSING^Receipt Processing^^A^^^^^^^^ACCOUNTS RECEIVABLE
"KRN",101,8009,1,0)
^101.06^1^1^3170328^^^
"KRN",101,8009,1,1,0)
This option will jump to the receipt profile listmanager
"KRN",101,8009,20)
D RECPROC^RCDPEWL4
"KRN",101,8009,99)
64464,36521
"KRN",101,8019,-1)
0^11
"KRN",101,8019,0)
RCDPE EOB WORKLIST MARK FOR AUTO POST^Mark for Auto Post^^A^^^^^^^^ACCOUNTS RECEIVABLE
"KRN",101,8019,1,0)
^101.06^3^3^3170328^^^^
"KRN",101,8019,1,1,0)
This option allows the user to mark an ERA for auto-posting.  If the ERA
"KRN",101,8019,1,2,0)
passes validation, the ERA will be marked as an auto-post candidate to get
"KRN",101,8019,1,3,0)
posted by the Nightly Background Job.
"KRN",101,8019,20)
D AUTOPOST^RCDPEWL8(2)
"KRN",101,8019,99)
64464,36521
"MBREQ")
0
"ORD",3,19.1)
19.1;3;;;KEY^XPDTA1;KEYF1^XPDIA1;KEYE1^XPDIA1;KEYF2^XPDIA1;;KEYDEL^XPDIA1
"ORD",3,19.1,0)
SECURITY KEY
"ORD",15,101)
101;15;;;PRO^XPDTA;PROF1^XPDIA;PROE1^XPDIA;PROF2^XPDIA;;PRODEL^XPDIA
"ORD",15,101,0)
PROTOCOL
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"PKG",561,-1)
1^1
"PKG",561,0)
ACCOUNTS RECEIVABLE^PRCA^FMS
"PKG",561,20,0)
^9.402P^1^1
"PKG",561,20,1,0)
2^^PRCAMRG
"PKG",561,20,1,1)

"PKG",561,20,"B",2,1)

"PKG",561,22,0)
^9.49I^1^1
"PKG",561,22,1,0)
4.5^2950320^2950331
"PKG",561,22,1,"PAH",1,0)
318^3170731^520824636
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
28
"RTN","PRCAEXM")
0^18^B14988614^B13617982
"RTN","PRCAEXM",1,0)
PRCAEXM ;SF-ISC/YJK-ADMIN.COST CHARGE TRANSACTION ;3/30/94  11:19 AM
"RTN","PRCAEXM",2,0)
 ;;4.5;Accounts Receivable;**67,103,196,301,318**;Mar 20, 1995;Build 37
"RTN","PRCAEXM",3,0)
 ;;Per VA Directive 6402, this routine should not be modified.
"RTN","PRCAEXM",4,0)
 ; Update Int/adm.balanceand Administrative cost charge transaction, is called by
"RTN","PRCAEXM",5,0)
 ; ^PRCAWO.
"RTN","PRCAEXM",6,0)
 ;
"RTN","PRCAEXM",7,0)
EN1 ; Adjustment Interest/admin.cost from an AR - this makes the int/adm. balance
"RTN","PRCAEXM",8,0)
 ; marshal fee and court cost zero,0.
"RTN","PRCAEXM",9,0)
 N PRCAIND,ADMINTOT,PRCAERR,PRCABN0
"RTN","PRCAEXM",10,0)
 I '$D(^XUSEC("RCDPEAR",DUZ)) D  Q  ; PRCA*4.5*318 Added security key check
"RTN","PRCAEXM",11,0)
 . W !!,"This action can only be taken by users that have the RCDPEAR security key.",!
"RTN","PRCAEXM",12,0)
 . S VALMBCK="R"
"RTN","PRCAEXM",13,0)
 . D PAUSE^VALM1
"RTN","PRCAEXM",14,0)
 D BEGIN^PRCAWO G:('$D(PRCABN))!('$D(PRCAEN)) END G:'$D(^PRCA(430,PRCABN,7)) END
"RTN","PRCAEXM",15,0)
 L +^PRCA(430,PRCABN):1 I '$T W !!,*7,"ANOTHER USER IS EDITING THIS BILL" G EN1
"RTN","PRCAEXM",16,0)
 S PRCABN0=PRCABN
"RTN","PRCAEXM",17,0)
 S PRCAIND=$G(^PRCA(430,PRCABN,7))
"RTN","PRCAEXM",18,0)
 S PRCAMT=$P(PRCAIND,U,2)+$P(PRCAIND,U,3)+$P(PRCAIND,U,4)+$P(PRCAIND,U,5)
"RTN","PRCAEXM",19,0)
 S %=$P(^PRCA(430,PRCABN,0),U,2) I "PC"'[$P(^PRCA(430.2,%,0),U,6) W *7,!,"This AR may not be appropriate to charge Interest/Administrative cost.",!,"Please check the category of this AR.",! H 3
"RTN","PRCAEXM",20,0)
 K % W !!,"You may exempt the account from all the interest and administrative cost balances - making those balances zero (0),",!,"or adjust them."
"RTN","PRCAEXM",21,0)
EN011 S %=2 W !!,"Do you want to exempt the account from all the Int/Adm. costs" D YN^DICN I %<0 S PRCACOMM="User Canceled" D DELETE^PRCAWO1 K PRCACOMM G EN1
"RTN","PRCAEXM",22,0)
 I %=1 D EN11,END G EN1
"RTN","PRCAEXM",23,0)
 I %=0 W !,"ANSWER 'YES' OR 'NO' " G EN011
"RTN","PRCAEXM",24,0)
 W !,"Adjusting the administrative/Interest charge ...",!
"RTN","PRCAEXM",25,0)
 I $D(^PRCA(430,"TCSP",PRCABN)) W !,"BILL HAS BEEN REFERRED TO CROSS-SERVICING.",!,"NO MANUAL COST ADJUSTMENTS ARE ALLOWED." G EN1  ;prca*4.5*301
"RTN","PRCAEXM",26,0)
 D DIEEN^PRCAWO1,END G EN1
"RTN","PRCAEXM",27,0)
 ;
"RTN","PRCAEXM",28,0)
 ;  exempt interest and admin charges
"RTN","PRCAEXM",29,0)
EN11 S PRCATYPE=14,DIE="^PRCA(433,",DA=PRCAEN
"RTN","PRCAEXM",30,0)
 S DR=".03////^S X="_PRCABN_";11////^S X="_DT_";12////^S X="_PRCATYPE_";15////^S X="_PRCAMT_";"
"RTN","PRCAEXM",31,0)
 S DR=DR_"27////^S X="_+$P(PRCAIND,U,2)_";"  ;interest
"RTN","PRCAEXM",32,0)
 S DR=DR_"28////^S X="_+$P(PRCAIND,U,3)_";"  ;admin charge
"RTN","PRCAEXM",33,0)
 S DR=DR_"25////^S X="_+$P(PRCAIND,U,4)_";"  ;marshal fee
"RTN","PRCAEXM",34,0)
 S DR=DR_"26////^S X="_+$P(PRCAIND,U,5)_";"  ;court cost
"RTN","PRCAEXM",35,0)
 S DIC=DIE,PRCA("LOCK")=0 D LOCKF^PRCAWO1 Q:PRCA("LOCK")=1  D ^DIE
"RTN","PRCAEXM",36,0)
 I PRCAEN,$D(^PRCA(430,"TCSP",PRCABN)) D DECADJ^RCTCSPU(PRCABN,PRCAEN) ;prca*4.5*301 add cs 5B flag
"RTN","PRCAEXM",37,0)
 S $P(^PRCA(430,PRCABN,7),U,2,5)="0^0^0^0" D TRANST^PRCAWO1 Q
"RTN","PRCAEXM",38,0)
 ;
"RTN","PRCAEXM",39,0)
 ;
"RTN","PRCAEXM",40,0)
EN2 Q:'$D(PRCAEN)  Q:($P(^PRCA(433,PRCAEN,2),U,8)="")&($P(^PRCA(433,PRCAEN,2),U,7)="")
"RTN","PRCAEXM",41,0)
 W !,"MONTHLY ADMIN. CHARGE: ",?25,+$P(^PRCA(433,PRCAEN,2),U,8),?40,"INTEREST CHARGE: ",+$P(^PRCA(433,PRCAEN,2),U,7) Q
"RTN","PRCAEXM",42,0)
 ;
"RTN","PRCAEXM",43,0)
END L -^PRCA(433,+$G(PRCAEN)),-^PRCA(430,+$G(PRCABN))
"RTN","PRCAEXM",44,0)
 S X(1)=0,X=$G(^PRCA(430,+$G(PRCABN0),7)),X(1)=+X,X(1)=$P(X,"^",2)+X(1),X(1)=$P(X,"^",3)+X(1),X(1)=$P(X,"^",4)+X(1),X(1)=$P(X,"^",5)+X(1)
"RTN","PRCAEXM",45,0)
 K PRCA("STATUS")
"RTN","PRCAEXM",46,0)
 I X(1)=0,$G(PRCABN0) D
"RTN","PRCAEXM",47,0)
 .;Check for payment transactions
"RTN","PRCAEXM",48,0)
 .F X=0:0 S X=$O(^PRCA(433,"C",PRCABN0,X)) Q:'X  I ",2,7,20,"[(","_$P($G(^PRCA(430.3,+$P($G(^PRCA(433,X,1)),"^",2),0)),"^",3)_",") S PRCA("STATUS")=$O(^PRCA(430.3,"AC",108,0))
"RTN","PRCAEXM",49,0)
 .S:'$D(PRCA("STATUS")) PRCA("STATUS")=$O(^PRCA(430.3,"AC",111,0))
"RTN","PRCAEXM",50,0)
 .S DA=PRCABN0,DIE="^PRCA(430,",DR="8////"_PRCA("STATUS") D ^DIE
"RTN","PRCAEXM",51,0)
 K PRCATY,PRCA,PRCA2,PRCAD,PRCABN,PRCAEN,PRCATYPE,DA,DIE,DIC,PRCAMT,DR,X,% Q
"RTN","PRCAP318")
0^16^B1842298^n/a
"RTN","PRCAP318",1,0)
PRCAP318 ;BIRM/EWL ALB/PJH - ePayment Lockbox Post-Installation Processing ;Dec 20, 2014@14:08:45
"RTN","PRCAP318",2,0)
 ;;4.5;Accounts Receivable;**318**;Jan 21, 2014;Build 37
"RTN","PRCAP318",3,0)
 ;Per VA Directive 6402, this routine should not be modified.
"RTN","PRCAP318",4,0)
 ;
"RTN","PRCAP318",5,0)
 Q
"RTN","PRCAP318",6,0)
 ;
"RTN","PRCAP318",7,0)
PRE ; pre-installation processing
"RTN","PRCAP318",8,0)
 N DIK
"RTN","PRCAP318",9,0)
 D MES^XPDUTL("Deleting PAYER NAME index on EDI THIRD PARTY EFT DETAIL file (#344.31)")
"RTN","PRCAP318",10,0)
 S DIK="^RCY(344.31,",DIK(1)=".02^C" D ENALL2^DIK
"RTN","PRCAP318",11,0)
 ;
"RTN","PRCAP318",12,0)
 ; IA #6747 allows us to use fileman to touch the field LOCK(#19,3)
"RTN","PRCAP318",13,0)
 D MES^XPDUTL("Removing lock from menu option EDI Diagnostic Measures Reports [RCDPE EDI NATIONAL REPORTS]")
"RTN","PRCAP318",14,0)
 N DA,PRCADA
"RTN","PRCAP318",15,0)
 S DA=$$FIND1^DIC(19,,,"RCDPE EDI NATIONAL REPORTS")
"RTN","PRCAP318",16,0)
 I 'DA G PREEXIT
"RTN","PRCAP318",17,0)
 S PRCADA(19,DA_",",3)="@"
"RTN","PRCAP318",18,0)
 D FILE^DIE("","PRCADA")
"RTN","PRCAP318",19,0)
PREEXIT ; 
"RTN","PRCAP318",20,0)
 Q
"RTN","PRCAP318",21,0)
 ;
"RTN","PRCAP318",22,0)
POST ; PRCA*4.5*318 post-installation processing
"RTN","PRCAP318",23,0)
 N DIK
"RTN","PRCAP318",24,0)
 D MES^XPDUTL("Re-indexing PAYER NAME on EDI THIRD PARTY EFT DETAIL file (#344.31)")
"RTN","PRCAP318",25,0)
 S DIK="^RCY(344.31,",DIK(1)=".02^C" D ENALL^DIK
"RTN","PRCAP318",26,0)
 Q
"RTN","RCDPE8NZ")
0^17^B119211699^B111235321
"RTN","RCDPE8NZ",1,0)
RCDPE8NZ ;ALB/TMK/KML/hrubovcak - Unapplied EFT Deposits report ;Jun 06, 2014@19:11:19
"RTN","RCDPE8NZ",2,0)
 ;;4.5;Accounts Receivable;**173,212,208,269,276,283,293,298,317,318**;Mar 20, 1995;Build 37
"RTN","RCDPE8NZ",3,0)
 ;Per VA Directive 6402, this routine should not be modified.
"RTN","RCDPE8NZ",4,0)
 ;
"RTN","RCDPE8NZ",5,0)
EN ; entry point for Unapplied EFT Deposits Report [RCDPE UNAPPLIED EFT DEP REPORT]
"RTN","RCDPE8NZ",6,0)
 ; ^RCY(344.3,0) = EDI LOCKBOX DEPOSIT^344.3I^
"RTN","RCDPE8NZ",7,0)
 ;
"RTN","RCDPE8NZ",8,0)
 N %ZIS,DIR,RCDISPTY,RCDTRNG,RCENDT,RCHDR,RCLNCNT,RCLSTMGR,RCPGNUM,RCRPLST,RCSTDT,RCTMPND,X,Y
"RTN","RCDPE8NZ",9,0)
 ; RCDISPTY - display type for Excel
"RTN","RCDPE8NZ",10,0)
 ; RCDTRNG - range of dates
"RTN","RCDPE8NZ",11,0)
 ; RCHDR - report header
"RTN","RCDPE8NZ",12,0)
 ; RCLNCNT - line counter for ^TMP storage
"RTN","RCDPE8NZ",13,0)
 ; RCLSTMGR - ListMan flag
"RTN","RCDPE8NZ",14,0)
 ; RCPGNUM - page number
"RTN","RCDPE8NZ",15,0)
 ; RCRPLST - node for report list in ^TMP
"RTN","RCDPE8NZ",16,0)
 ; RCTMPND - storage node (or null) for SL^RCPEARL
"RTN","RCDPE8NZ",17,0)
 ;
"RTN","RCDPE8NZ",18,0)
 S RCRPLST=$T(+0)_"_EFT"  ; storage for list of entries
"RTN","RCDPE8NZ",19,0)
 S RCLNCNT=0,RCLSTMGR="",RCTMPND=""  ; initial values for ListMan
"RTN","RCDPE8NZ",20,0)
 S RCDTRNG=$$DTRNG^RCDPEM4() G:'(RCDTRNG>0) RPTQ
"RTN","RCDPE8NZ",21,0)
 S RCSTDT=$P(RCDTRNG,U,2),RCENDT=$P(RCDTRNG,U,3)
"RTN","RCDPE8NZ",22,0)
 ; ask if export to excel
"RTN","RCDPE8NZ",23,0)
 S RCDISPTY=$$DISPTY^RCDPEM3() G:RCDISPTY<0 RPTQ
"RTN","RCDPE8NZ",24,0)
 ; for Excel, set ListMan flag to prevent question
"RTN","RCDPE8NZ",25,0)
 I RCDISPTY S RCLSTMGR="^" D INFO^RCDPEM6
"RTN","RCDPE8NZ",26,0)
 I RCLSTMGR="" S RCLSTMGR=$$ASKLM^RCDPEARL G:RCLSTMGR<0 RPTQ
"RTN","RCDPE8NZ",27,0)
 I RCLSTMGR D  G RPTQ  ; send output to ListMan
"RTN","RCDPE8NZ",28,0)
 .S RCTMPND=$T(+0)_"^UNAPPLIED EFT" K ^TMP($J,RCTMPND)  ; clean any residue
"RTN","RCDPE8NZ",29,0)
 .D MKRPRT
"RTN","RCDPE8NZ",30,0)
 .N H,L,HDR S L=0
"RTN","RCDPE8NZ",31,0)
 .S HDR("TITLE")=$$HDRNM
"RTN","RCDPE8NZ",32,0)
 .F H=1:1:7 I $D(RCHDR(H)) S L=H,HDR(H)=RCHDR(H)  ; take first 3 lines of report header
"RTN","RCDPE8NZ",33,0)
 .I $O(RCHDR(L)) D  ; any remaining header lines at top of report
"RTN","RCDPE8NZ",34,0)
 ..N N S N=0,H=L F  S H=$O(RCHDR(H)) Q:'H  S N=N+.001,^TMP($J,RCTMPND,N)=RCHDR(H)
"RTN","RCDPE8NZ",35,0)
 .; invoke ListMan
"RTN","RCDPE8NZ",36,0)
 .D LMRPT^RCDPEARL(.HDR,$NA(^TMP($J,RCTMPND))) ; generate ListMan display
"RTN","RCDPE8NZ",37,0)
 ;
"RTN","RCDPE8NZ",38,0)
 ; Ask device
"RTN","RCDPE8NZ",39,0)
 S %ZIS="QM" D ^%ZIS Q:POP
"RTN","RCDPE8NZ",40,0)
 I $D(IO("Q")) D  Q
"RTN","RCDPE8NZ",41,0)
 .N ZTRTN,ZTSAVE,ZTDESC,POP,ZTSK
"RTN","RCDPE8NZ",42,0)
 .S ZTRTN="MKRPRT^RCDPE8NZ",ZTDESC="AR - List of unlinked EFT deposit payments"
"RTN","RCDPE8NZ",43,0)
 .S ZTSAVE("RC*")=""
"RTN","RCDPE8NZ",44,0)
 .D ^%ZTLOAD
"RTN","RCDPE8NZ",45,0)
 .W !!,$S($G(ZTSK):"Task number "_ZTSK_" was queued.",1:"Unable to queue this task.")
"RTN","RCDPE8NZ",46,0)
 .K ZTSK,IO("Q") D HOME^%ZIS
"RTN","RCDPE8NZ",47,0)
 ;
"RTN","RCDPE8NZ",48,0)
 U IO
"RTN","RCDPE8NZ",49,0)
 D MKRPRT
"RTN","RCDPE8NZ",50,0)
 Q
"RTN","RCDPE8NZ",51,0)
 ;
"RTN","RCDPE8NZ",52,0)
MKRPRT ; Entry point for queued job
"RTN","RCDPE8NZ",53,0)
 N RCTSKCNT,RCARDEP,RCCR,RCDA,RCDATA,RCDT,RCEFT,RCEFTIEN,RCREC,RCSTAT,RCSTOP,RCSUM,RCTOT,RCTR,RCUNAP,RECEXT,Y,Z,ZTSTOP
"RTN","RCDPE8NZ",54,0)
 ;
"RTN","RCDPE8NZ",55,0)
 ;  get list of unlinked EFT deposit data
"RTN","RCDPE8NZ",56,0)
 K ^TMP(RCRPLST,$J) ; subscripts: dep date,EFT ien,EFT det ien
"RTN","RCDPE8NZ",57,0)
 ;  Data is FMS doc indicator^FMS doc #^FMS Doc Status
"RTN","RCDPE8NZ",58,0)
 ;    FMS doc indicator = -1:no receipt  -2:no FMS doc  1:FMS doc exists
"RTN","RCDPE8NZ",59,0)
 ;
"RTN","RCDPE8NZ",60,0)
 S (RCTSKCNT,RCSTOP,RCSUM,RCUNAP)=0
"RTN","RCDPE8NZ",61,0)
 S RCARDEP="" F  S RCARDEP=$O(^RCY(344.3,"ARDEP",RCARDEP)) Q:RCARDEP=""!RCSTOP  S RCDA=0 F  S RCDA=$O(^RCY(344.3,"ARDEP",RCARDEP,RCDA)) Q:'RCDA  D  Q:RCSTOP
"RTN","RCDPE8NZ",62,0)
 . S RCDATA=$G(^RCY(344.3,RCDA,0)),RCDT=$P(RCDATA,U,7),RCTOT=0
"RTN","RCDPE8NZ",63,0)
 . Q:RCDT<RCSTDT  ; Before start date
"RTN","RCDPE8NZ",64,0)
 . Q:RCDT>(RCENDT+.999999)  ; After the end date
"RTN","RCDPE8NZ",65,0)
 . Q:'$P(RCDATA,"^",8)  ; no payment amt
"RTN","RCDPE8NZ",66,0)
 . S RCEFT=0 F  S RCEFT=$O(^RCY(344.31,"B",RCDA,RCEFT)) Q:'RCEFT!RCSTOP  S RCDATA(0)=$G(^RCY(344.31,RCEFT,0)) D  Q:RCSTOP
"RTN","RCDPE8NZ",67,0)
 . . S RCTSKCNT=RCTSKCNT+1
"RTN","RCDPE8NZ",68,0)
 . . I '(RCTSKCNT#100),$D(ZTQUEUED),$$S^%ZTLOAD S (RCSTOP,ZTSTOP)=1 K ZTREQ Q
"RTN","RCDPE8NZ",69,0)
 . . Q:$P($G(^RCY(344.31,RCEFT,3)),U)        ; EFT has been removed   PRCA*4.5*293
"RTN","RCDPE8NZ",70,0)
 . . S RCREC=$$GETREC(RCEFT,RCDATA(0),.RECEXT)
"RTN","RCDPE8NZ",71,0)
 . . Q:RCREC="PURGED"  ; need to prevent processed EFTs that had receipts purged from being generated on the report
"RTN","RCDPE8NZ",72,0)
 . . ;; PRCA276 - need to add EFT entries without a receipt to the total number of unapplied deposits
"RTN","RCDPE8NZ",73,0)
 . . I 'RCREC S RCUNAP=RCUNAP+1,^TMP(RCRPLST,$J,RCDT,RCDA,RCEFT)=-1,RCTOT=RCTOT+$P(RCDATA(0),U,7) Q  ; No receipt therefore no FMS document
"RTN","RCDPE8NZ",74,0)
 . . S RCSTAT=$$FMSSTAT^RCDPUREC(RCREC)
"RTN","RCDPE8NZ",75,0)
 . . I $E($P(RCSTAT,U),1,2)="TR",$P(RCSTAT,U,2)["ACCEPTED" Q
"RTN","RCDPE8NZ",76,0)
 . . S RCUNAP=RCUNAP+1,RCTOT=RCTOT+$P(RCDATA(0),U,7)  ; total unapplied deposits and total dollar amount of unapplied deposits
"RTN","RCDPE8NZ",77,0)
 . . I $P(RCSTAT,U,2)="NOT ENTERED" S ^TMP(RCRPLST,$J,RCDT,RCDA,RCEFT)="-2^^"_$P(RCSTAT,U) Q  ; No FMS doc
"RTN","RCDPE8NZ",78,0)
 . . S ^TMP(RCRPLST,$J,RCDT,RCDA,RCEFT)="1^"_$P(RCSTAT,U,1,2)_"^"_RECEXT
"RTN","RCDPE8NZ",79,0)
 . S:RCTOT ^TMP(RCRPLST,$J,RCDT,RCDA)=RCTOT,RCSUM=RCSUM+RCTOT
"RTN","RCDPE8NZ",80,0)
 ;
"RTN","RCDPE8NZ",81,0)
 D:'RCLSTMGR HDRBLD
"RTN","RCDPE8NZ",82,0)
 D:RCLSTMGR HDRLM
"RTN","RCDPE8NZ",83,0)
 ;
"RTN","RCDPE8NZ",84,0)
 I RCDISPTY D EXCEL Q
"RTN","RCDPE8NZ",85,0)
 ;
"RTN","RCDPE8NZ",86,0)
 D RPT
"RTN","RCDPE8NZ",87,0)
 Q
"RTN","RCDPE8NZ",88,0)
 ;
"RTN","RCDPE8NZ",89,0)
RPT ;  display/print the report using data populated in temporary global array
"RTN","RCDPE8NZ",90,0)
 N RCPAYID,RCPAYER,XX,YY,ZZ   ;PRCA*4.5*318
"RTN","RCDPE8NZ",91,0)
 ;
"RTN","RCDPE8NZ",92,0)
 D:'RCLSTMGR HDRLST^RCDPEARL(.RCSTOP,.RCHDR)  ; initial report header
"RTN","RCDPE8NZ",93,0)
 ;
"RTN","RCDPE8NZ",94,0)
 S RCDT=0
"RTN","RCDPE8NZ",95,0)
 F  S RCDT=$O(^TMP(RCRPLST,$J,RCDT)) Q:'RCDT  D  Q:RCSTOP
"RTN","RCDPE8NZ",96,0)
 .I 'RCLSTMGR,$Y>(IOSL-RCHDR(0)) D HDRLST^RCDPEARL(.RCSTOP,.RCHDR) Q:RCSTOP
"RTN","RCDPE8NZ",97,0)
 .D SL^RCDPEARL(" ",.RCLNCNT,RCTMPND)  ; skip a line
"RTN","RCDPE8NZ",98,0)
 .S Y="DEPOSIT DATE: "_$$FMTE^XLFDT(RCDT,1),Y=$J("",80-$L(Y)\2)_Y D SL^RCDPEARL(Y,.RCLNCNT,RCTMPND)
"RTN","RCDPE8NZ",99,0)
 .S RCARDEP=0 F  S RCARDEP=$O(^TMP(RCRPLST,$J,RCDT,RCARDEP)) Q:'RCARDEP  D
"RTN","RCDPE8NZ",100,0)
 ..D SL^RCDPEARL(" ",.RCLNCNT,RCTMPND)  ; skip a line
"RTN","RCDPE8NZ",101,0)
 ..S RCTSKCNT=RCTSKCNT+1 I 'RCLSTMGR,(RCTSKCNT#100),$D(ZTQUEUED),$$S^%ZTLOAD D  Q  ; stop task
"RTN","RCDPE8NZ",102,0)
 ...S (RCSTOP,ZTSTOP)=1 D SL^RCDPEARL("TASK STOPPED BY USER!!",.RCLNCNT,RCTMPND) K ZTREQ
"RTN","RCDPE8NZ",103,0)
 ..;
"RTN","RCDPE8NZ",104,0)
 ..S RCDATA(0)=$G(^RCY(344.3,RCARDEP,0))
"RTN","RCDPE8NZ",105,0)
 ..I 'RCLSTMGR,$Y>(IOSL-RCHDR(0)) D HDRLST^RCDPEARL(.RCSTOP,.RCHDR) Q:RCSTOP
"RTN","RCDPE8NZ",106,0)
 ..; PRCA*4.5*283 - Change the spaces for DEP # from 10 to 13 to allow 9 digit DEP #
"RTN","RCDPE8NZ",107,0)
 ..; PRCA*4.5*317 Shift line 2 chars to the right
"RTN","RCDPE8NZ",108,0)
 ..S Y="  "_$E($P(RCDATA(0),U,6)_$S('$$HACEFT^RCDPEU(RCARDEP):"",1:"-HAC")_$J("",13),1,13)  ;deposit #
"RTN","RCDPE8NZ",109,0)
 ..S Y=Y_"  "_$E($$FMTE^XLFDT($P(RCDATA(0),U,7),2)_$J("",16),1,16)     ; deposit date
"RTN","RCDPE8NZ",110,0)
 ..S Y=Y_"  "_$E($J(+$P(RCDATA(0),U,8),"",2)_$J("",20),1,20)           ; total amt deposit
"RTN","RCDPE8NZ",111,0)
 ..S Y=Y_"  "_$J(+$G(^TMP(RCRPLST,$J,RCDT,RCARDEP)),"",2)              ; total amt unposted
"RTN","RCDPE8NZ",112,0)
 ..D SL^RCDPEARL(Y,.RCLNCNT,RCTMPND)
"RTN","RCDPE8NZ",113,0)
 ..S RCEFTIEN=0 F  S RCEFTIEN=$O(^TMP(RCRPLST,$J,RCDT,RCARDEP,RCEFTIEN)) Q:'RCEFTIEN  S RCDATA=$G(^(RCEFTIEN)),RCEFT("DEP")=$G(^RCY(344.31,RCEFTIEN,0)) D
"RTN","RCDPE8NZ",114,0)
 ...I 'RCLSTMGR,$Y>(IOSL-RCHDR(0)) D HDRLST^RCDPEARL(.RCSTOP,.RCHDR) Q:RCSTOP
"RTN","RCDPE8NZ",115,0)
 ...N RCPAY S RCPAY=$P(RCEFT("DEP"),U,2) S:RCPAY="" RCPAY="NO PAYER NAME RECEIVED" ; PRCA*4.5*298
"RTN","RCDPE8NZ",116,0)
 ...;
"RTN","RCDPE8NZ",117,0)
 ...; PRCA*4.5*317 Shift line 2 chars to the right
"RTN","RCDPE8NZ",118,0)
 ...;S Y="   "_RCPAY_"/"_$P(RCEFT("DEP"),U,3)  D SL^RCDPEARL(Y,.RCLNCNT,RCTMPND)   ; payer/ID
"RTN","RCDPE8NZ",119,0)
 ...; PRCA*4.5*318 Account for payer names of 60 characters and payer ID of 20 characters
"RTN","RCDPE8NZ",120,0)
 ...S RCPAYID=$P(RCEFT("DEP"),U,3)
"RTN","RCDPE8NZ",121,0)
 ...S RCPAYER=RCPAY_"/"_RCPAYID      ; payer/ID
"RTN","RCDPE8NZ",122,0)
 ...I $L(RCPAYER)>77 D
"RTN","RCDPE8NZ",123,0)
 ... . S ZZ=$L(RCPAYER,"/"),XX=$P(RCPAYER,"/",1,ZZ-1),YY=$P(RCPAYER,"/",ZZ)
"RTN","RCDPE8NZ",124,0)
 ... . S XX=$E(XX,1,$L(XX)-($L(RCPAYER)-77)),RCPAYER=XX_"/"_YY
"RTN","RCDPE8NZ",125,0)
 ...S Y="   "_RCPAYER
"RTN","RCDPE8NZ",126,0)
 ...; end of PRCA*4.5*318
"RTN","RCDPE8NZ",127,0)
 ...D SL^RCDPEARL(Y,.RCLNCNT,RCTMPND)   ; payer/ID
"RTN","RCDPE8NZ",128,0)
 ...; PRCA*4.5*317 Shift line 2 chars to the right
"RTN","RCDPE8NZ",129,0)
 ...S Y="    "_$E($P(RCEFT("DEP"),U,4)_$J("",50),1,50)                ; trace #
"RTN","RCDPE8NZ",130,0)
 ...S Y=Y_" "_$E($J(+$P(RCEFT("DEP"),U,7),"",2)_$J("",12),1,12)       ; payment amt
"RTN","RCDPE8NZ",131,0)
 ...;
"RTN","RCDPE8NZ",132,0)
 ...; PRCA*4.5*317 Shift lines 2 to thr right to allow 12 digit receipt #
"RTN","RCDPE8NZ",133,0)
 ...S Y=Y_" "_$S($P(RCDATA,U,4)'="":$P(RCDATA,U,4),1:"NO RECEIPT")    ; receipt #
"RTN","RCDPE8NZ",134,0)
 ... D SL^RCDPEARL(Y,.RCLNCNT,RCTMPND)
"RTN","RCDPE8NZ",135,0)
 ...; PRCA*4.5*317 Shift line 2 chars to the right
"RTN","RCDPE8NZ",136,0)
 ...S Z=$P(RCEFT("DEP"),U,8)
"RTN","RCDPE8NZ",137,0)
 ...S Y="      "_$E($S('Z:"UNMATCHED",Z=2:"PAPER EOB",1:"MATCHED TO ERA #: "_$P(RCEFT("DEP"),U,10)_$S(Z=-1:" (TOTALS MISMATCH)",1:""))_$J("",40),1,40)_"  "
"RTN","RCDPE8NZ",138,0)
 ...S Y=Y_$S($P(RCDATA,U)=-1:"NO RECEIPT",$P(RCDATA,U)=-2:"NO FMS DOCUMENT",1:$E($P(RCDATA,U,2)_" - "_$P(RCDATA,U,3),1,30))
"RTN","RCDPE8NZ",139,0)
 ...D SL^RCDPEARL(Y,.RCLNCNT,RCTMPND)
"RTN","RCDPE8NZ",140,0)
 ;
"RTN","RCDPE8NZ",141,0)
 I '$D(^TMP(RCRPLST,$J)) D SL^RCDPEARL("*** NO RECORDS TO PRINT ***",.RCLNCNT,RCTMPND)
"RTN","RCDPE8NZ",142,0)
 ;
"RTN","RCDPE8NZ",143,0)
 I 'RCSTOP D SL^RCDPEARL(" ",.RCLNCNT,RCTMPND),SL^RCDPEARL($$ENDORPRT^RCDPEARL,.RCLNCNT,RCTMPND)
"RTN","RCDPE8NZ",144,0)
 I $D(ZTQUEUED) S ZTREQ="@"
"RTN","RCDPE8NZ",145,0)
 D:'$D(ZTQUEUED) ^%ZISC
"RTN","RCDPE8NZ",146,0)
 G:RCSTOP RPTQ
"RTN","RCDPE8NZ",147,0)
 ;
"RTN","RCDPE8NZ",148,0)
 I 'RCLSTMGR,'RCSTOP,$E(IOST,1,2)="C-" D ASK^RCDPEARL(.RCSTOP)
"RTN","RCDPE8NZ",149,0)
 ;
"RTN","RCDPE8NZ",150,0)
RPTQ ;
"RTN","RCDPE8NZ",151,0)
 K ^TMP(RCRPLST,$J)
"RTN","RCDPE8NZ",152,0)
 Q
"RTN","RCDPE8NZ",153,0)
 ;
"RTN","RCDPE8NZ",154,0)
GETREC(EFTDA,EFTDET,RECEXT) ; function,  prca276
"RTN","RCDPE8NZ",155,0)
 ; input - EFTDA - IEN OF 344.31
"RTN","RCDPE8NZ",156,0)
 ; input - EFTDET - data stored at the 0 subscript of the THIRD PARTY EFT DETAIL file (344.31)
"RTN","RCDPE8NZ",157,0)
 ; input - RECEXT passed by reference
"RTN","RCDPE8NZ",158,0)
 ; output - RECEXT populated with the external receipt value that gets generated on the report
"RTN","RCDPE8NZ",159,0)
 ; output - RECEIPT - returns internal value of the receipt that either comes from the EFT file (344.31) or the ERA file (344.4) 
"RTN","RCDPE8NZ",160,0)
 N RECEIPT
"RTN","RCDPE8NZ",161,0)
 S RECEXT=0
"RTN","RCDPE8NZ",162,0)
 S RECEIPT=+$P($G(^RCY(344.4,+$P(EFTDET,U,10),0)),U,8)  ; get receipt off the ERA record
"RTN","RCDPE8NZ",163,0)
 I 'RECEIPT,$P(EFTDET,U,8)=2 S RECEIPT=+$O(^RCY(344,"AEFT",EFTDA,0))  ; EFT processed against paper EOB
"RTN","RCDPE8NZ",164,0)
 I 'RECEIPT S RECEIPT=$P(EFTDET,U,9) ; receipt not posted in payment file so get from EFT detail (unprocessed EFT)
"RTN","RCDPE8NZ",165,0)
 I +RECEIPT,'$D(^RCY(344,RECEIPT)) Q "PURGED"  ; handle purged receipts but broken pointer exists in 344.31; need to handle as a processed EFT 
"RTN","RCDPE8NZ",166,0)
 I +RECEIPT S RECEXT=$P(^RCY(344,RECEIPT,0),U)
"RTN","RCDPE8NZ",167,0)
 Q +RECEIPT
"RTN","RCDPE8NZ",168,0)
 ;
"RTN","RCDPE8NZ",169,0)
 ;
"RTN","RCDPE8NZ",170,0)
HDRBLD ; create the report header
"RTN","RCDPE8NZ",171,0)
 ; returns RCHDR, RCPGNUM, RCSTOP
"RTN","RCDPE8NZ",172,0)
 ;   RCHDR(0) = header text line count
"RTN","RCDPE8NZ",173,0)
 ;   RCHDR("XECUTE") = M code for page number
"RTN","RCDPE8NZ",174,0)
 ;   RCHDR("RUNDATE") = date/time report generated, external format
"RTN","RCDPE8NZ",175,0)
 ;   RCPGNUM - page counter
"RTN","RCDPE8NZ",176,0)
 ;   RCSTOP - flag to exit
"RTN","RCDPE8NZ",177,0)
 ; INPUT: 
"RTN","RCDPE8NZ",178,0)
 ;   RCDISPTY - Display/print/Excel flag
"RTN","RCDPE8NZ",179,0)
 ;   RCRTYP - Report Type (EOB or ERA)
"RTN","RCDPE8NZ",180,0)
 ;   VAUTD
"RTN","RCDPE8NZ",181,0)
 K RCHDR S RCHDR("RUNDATE")=$$NOW^RCDPEARL,RCPGNUM=0,RCSTOP=0
"RTN","RCDPE8NZ",182,0)
 ;
"RTN","RCDPE8NZ",183,0)
 ;
"RTN","RCDPE8NZ",184,0)
 I RCDISPTY D  Q  ; Excel format, xecute code is QUIT, null page number
"RTN","RCDPE8NZ",185,0)
 .S RCHDR(0)=1,RCHDR("XECUTE")="Q",RCPGNUM=""
"RTN","RCDPE8NZ",186,0)
 .S RCHDR(1)="DEPOSIT #^DEPOSIT DATE^TOT AMT DEPOSIT^TOT AMT UNPOSTED^PAYER ID^TRACE #^PAYMENT AMT^RECEIPT #^ERA MATCHED^FMS DOC #/STATUS"
"RTN","RCDPE8NZ",187,0)
 ;
"RTN","RCDPE8NZ",188,0)
 N DIV,HCNT,Y
"RTN","RCDPE8NZ",189,0)
 S HCNT=0  ; header counter
"RTN","RCDPE8NZ",190,0)
 ;
"RTN","RCDPE8NZ",191,0)
 S Y=$$HDRNM,HCNT=1,RCHDR(HCNT)=$J("",80-$L(Y)\2)_Y  ; line 1 will be replaced by XECUTE code below
"RTN","RCDPE8NZ",192,0)
 S RCHDR("XECUTE")="N Y S RCPGNUM=RCPGNUM+1,Y=$$HDRNM^"_$T(+0)_"_$S(RCLSTMGR:"""",1:$J(""Page: ""_RCPGNUM,12)),RCHDR(1)=$J("" "",80-$L(Y)\2)_Y"
"RTN","RCDPE8NZ",193,0)
 S Y="Run Date: "_RCHDR("RUNDATE"),HCNT=HCNT+1,RCHDR(HCNT)=$J("",80-$L(Y)\2)_Y  ; line 1 will be replaced by XECUTE code below
"RTN","RCDPE8NZ",194,0)
 ;
"RTN","RCDPE8NZ",195,0)
 S Y="Date Range: "_$$FMTE^XLFDT(RCSTDT,2)_" - "_$$FMTE^XLFDT(RCENDT,2)_" (Deposit Date)",Y=$J("",80-$L(Y)\2)_Y
"RTN","RCDPE8NZ",196,0)
 S HCNT=HCNT+1,RCHDR(HCNT)=Y
"RTN","RCDPE8NZ",197,0)
 S Y="TOTAL NUMBER OF UNAPPLIED DEPOSITS: "_RCUNAP,HCNT=HCNT+1,RCHDR(HCNT)=$J("",80-$L(Y)\2)_Y
"RTN","RCDPE8NZ",198,0)
 S Y="TOTAL AMOUNT OF UNAPPLIED DEPOSITS: $"_$FN(RCSUM,",",2),HCNT=HCNT+1,RCHDR(HCNT)=$J("",80-$L(Y)\2)_Y
"RTN","RCDPE8NZ",199,0)
 S HCNT=HCNT+1,RCHDR(HCNT)=""
"RTN","RCDPE8NZ",200,0)
 ;
"RTN","RCDPE8NZ",201,0)
 ; PRCA*4.5*317 Shift each line 2 chars to the right
"RTN","RCDPE8NZ",202,0)
 S HCNT=HCNT+1,RCHDR(HCNT)="  DEPOSIT #      DEPOSIT DATE      TOT AMT OF DEPOSIT    TOT AMT UNPOSTED"
"RTN","RCDPE8NZ",203,0)
 S HCNT=HCNT+1,RCHDR(HCNT)="   PAYER/ID"
"RTN","RCDPE8NZ",204,0)
 S HCNT=HCNT+1,RCHDR(HCNT)=$J("",4)_"TRACE #"_$J("",44)_"PAYMENT AMT  RECEIPT #"
"RTN","RCDPE8NZ",205,0)
 S HCNT=HCNT+1,RCHDR(HCNT)=$J("",6)_$E("ERA MATCHED"_$J("",40),1,40)_"  FMS DOC #/STATUS"
"RTN","RCDPE8NZ",206,0)
 ; PRCA*4.5*317 End
"RTN","RCDPE8NZ",207,0)
 S Y="",$P(Y,"=",81)="",HCNT=HCNT+1,RCHDR(HCNT)=Y  ; row of equal signs at bottom
"RTN","RCDPE8NZ",208,0)
 ;
"RTN","RCDPE8NZ",209,0)
 S RCHDR(0)=HCNT  ; header line count
"RTN","RCDPE8NZ",210,0)
 Q
"RTN","RCDPE8NZ",211,0)
 ;
"RTN","RCDPE8NZ",212,0)
HDRLM ; create the report header
"RTN","RCDPE8NZ",213,0)
 ; returns RCHDR
"RTN","RCDPE8NZ",214,0)
 ;   RCHDR(0) = header text line count
"RTN","RCDPE8NZ",215,0)
 ; INPUT: 
"RTN","RCDPE8NZ",216,0)
 ;   RCSTDT - Date Range
"RTN","RCDPE8NZ",217,0)
 K RCHDR
"RTN","RCDPE8NZ",218,0)
 ;
"RTN","RCDPE8NZ",219,0)
 N DIV,HCNT,Y
"RTN","RCDPE8NZ",220,0)
 S HCNT=0  ; header counter
"RTN","RCDPE8NZ",221,0)
 S Y="Date Range: "_$$FMTE^XLFDT(RCSTDT,2)_" - "_$$FMTE^XLFDT(RCENDT,2)_" (Deposit Date)",HCNT=HCNT+1,RCHDR(HCNT)=Y
"RTN","RCDPE8NZ",222,0)
 S Y="TOTAL NUMBER OF UNAPPLIED DEPOSITS: "_RCUNAP,HCNT=HCNT+1,RCHDR(HCNT)=Y
"RTN","RCDPE8NZ",223,0)
 S Y="TOTAL AMOUNT OF UNAPPLIED DEPOSITS: $"_$FN(RCSUM,",",2),HCNT=HCNT+1,RCHDR(HCNT)=Y
"RTN","RCDPE8NZ",224,0)
 ;
"RTN","RCDPE8NZ",225,0)
 ; PRCA*4.5*317 Shift each line 2 chars to the right
"RTN","RCDPE8NZ",226,0)
 S HCNT=HCNT+1,RCHDR(HCNT)="  DEPOSIT #      DEPOSIT DATE      TOT AMT OF DEPOSIT    TOT AMT UNPOSTED"
"RTN","RCDPE8NZ",227,0)
 S HCNT=HCNT+1,RCHDR(HCNT)="   PAYER/ID"
"RTN","RCDPE8NZ",228,0)
 S HCNT=HCNT+1,RCHDR(HCNT)=$J("",4)_"TRACE #"_$J("",44)_"PAYMENT AMT  RECEIPT #"
"RTN","RCDPE8NZ",229,0)
 S HCNT=HCNT+1,RCHDR(HCNT)=$J("",6)_$E("ERA MATCHED"_$J("",40),1,40)_"  FMS DOC #/STATUS"
"RTN","RCDPE8NZ",230,0)
 ; PRCA*4.5*317 End
"RTN","RCDPE8NZ",231,0)
 ;
"RTN","RCDPE8NZ",232,0)
 S RCHDR(0)=HCNT  ; header line count
"RTN","RCDPE8NZ",233,0)
 Q
"RTN","RCDPE8NZ",234,0)
 ;
"RTN","RCDPE8NZ",235,0)
 ; extrinsic variable, name for header PRCA*4.5*298
"RTN","RCDPE8NZ",236,0)
HDRNM() Q "Unapplied EFT Deposits Report"
"RTN","RCDPE8NZ",237,0)
 ;
"RTN","RCDPE8NZ",238,0)
EXCEL ; Print report formatted for export to Excel
"RTN","RCDPE8NZ",239,0)
 N STR1
"RTN","RCDPE8NZ",240,0)
 W !,$G(RCHDR(1)),!
"RTN","RCDPE8NZ",241,0)
 S RCDT=0 F  S RCDT=$O(^TMP(RCRPLST,$J,RCDT)) Q:'RCDT  D  Q:RCSTOP
"RTN","RCDPE8NZ",242,0)
 .S RCARDEP=0 F  S RCARDEP=$O(^TMP(RCRPLST,$J,RCDT,RCARDEP)) Q:'RCARDEP  D
"RTN","RCDPE8NZ",243,0)
 ..S RCDATA(0)=$G(^RCY(344.3,RCARDEP,0))
"RTN","RCDPE8NZ",244,0)
 ..S STR1=$P(RCDATA(0),U,6)_$S('$$HACEFT^RCDPEU(RCARDEP):"",1:"-HAC")_U_$$FMTE^XLFDT($P(RCDATA(0),U,7))_U_$P(RCDATA(0),U,8)_U
"RTN","RCDPE8NZ",245,0)
 ..S STR1=STR1_+$G(^TMP(RCRPLST,$J,RCDT,RCARDEP))_U
"RTN","RCDPE8NZ",246,0)
 ..S RCEFTIEN=0 F  S RCEFTIEN=$O(^TMP(RCRPLST,$J,RCDT,RCARDEP,RCEFTIEN)) Q:'RCEFTIEN  S RCDATA=$G(^(RCEFTIEN)),RCEFT("DEP")=$G(^RCY(344.31,RCEFTIEN,0)) D
"RTN","RCDPE8NZ",247,0)
 ...W STR1 S:$P(RCEFT("DEP"),U,2)="" $P(RCEFT("DEP"),U,2)="NO PAYER NAME RECEIVED" ;PRCA*4.5*298
"RTN","RCDPE8NZ",248,0)
 ...W $P(RCEFT("DEP"),U,2)_"/"_$P(RCEFT("DEP"),U,3)_U_$P(RCEFT("DEP"),U,4)_U
"RTN","RCDPE8NZ",249,0)
 ...W +$P(RCEFT("DEP"),U,7)_U_$S($P(RCDATA,U,4)'="":$P(RCDATA,U,4),1:"NO RECEIPT")_U
"RTN","RCDPE8NZ",250,0)
 ...W $P(RCEFT("DEP"),U,10)_U
"RTN","RCDPE8NZ",251,0)
 ...W $S($P(RCDATA,U)=-1:"NO RECEIPT",$P(RCDATA,U)=-2:"NO FMS DOCUMENT",1:$P(RCDATA,U,2)_" - "_$P(RCDATA,U,3))
"RTN","RCDPE8NZ",252,0)
 ...W !
"RTN","RCDPE8NZ",253,0)
 Q
"RTN","RCDPE8NZ",254,0)
 ;
"RTN","RCDPEAA2")
0^23^B118386616^B113400441
"RTN","RCDPEAA2",1,0)
RCDPEAA2 ;ALB/KML - APAR Screen - SELECTED EOB ;Jun 06, 2014@19:11:19
"RTN","RCDPEAA2",2,0)
 ;;4.5;Accounts Receivable;**298,304,318**;Mar 20, 1995;Build 37
"RTN","RCDPEAA2",3,0)
 ;Per VA Directive 6402, this routine should not be modified.
"RTN","RCDPEAA2",4,0)
 Q
"RTN","RCDPEAA2",5,0)
 ;
"RTN","RCDPEAA2",6,0)
INIT(RCIENS) ; Entry point for List template to build the display of the EEOB on APAR
"RTN","RCDPEAA2",7,0)
 ;  
"RTN","RCDPEAA2",8,0)
 ;    Input - RCIENS = ien of entry in file 344.49^ien of 344.491^selectable line item from listman screen
"RTN","RCDPEAA2",9,0)
 ;
"RTN","RCDPEAA2",10,0)
 N FDTTM
"RTN","RCDPEAA2",11,0)
 D CLEAN^VALM10
"RTN","RCDPEAA2",12,0)
 K ^TMP("RCDPE-EOB_WL",$J),^TMP("RCDPE-EOB_WLDX",$J),^TMP("RCS",$J)
"RTN","RCDPEAA2",13,0)
 S VALMCNT=0,VALMBG=1
"RTN","RCDPEAA2",14,0)
 D BLD(RCIENS)
"RTN","RCDPEAA2",15,0)
 Q
"RTN","RCDPEAA2",16,0)
 ;
"RTN","RCDPEAA2",17,0)
 ;
"RTN","RCDPEAA2",18,0)
BLD(RCIENS) ; Display selected EEOB  on APAR screen
"RTN","RCDPEAA2",19,0)
 N RCZ0,RCECME,REASON,V1,RCLI1,TLINE,RCSCR,Z,ZZ,Z0,ZZ1,RC0,RCTL,RCTS,RCCL,RCCL1
"RTN","RCDPEAA2",20,0)
 S RCSCR=$P(RCIENS,U),Z=$P(^RCY(344.49,RCSCR,1,$P(RCIENS,U,2),0),U),RCPROG="RCDPEAA2"
"RTN","RCDPEAA2",21,0)
 I Z#1=0 S ZZ=+$O(^RCY(344.49,RCSCR,1,"B",Z,0)) I ZZ D
"RTN","RCDPEAA2",22,0)
 . S Z0=Z F  S Z0=$O(^RCY(344.49,RCSCR,1,"B",Z0)) Q:((Z0\1)'=(Z\1))  S Z=Z0,ZZ1=+$O(^RCY(344.49,RCSCR,1,"B",Z0,0)) I ZZ1 D
"RTN","RCDPEAA2",23,0)
 .. S ^TMP("RCS",$J,ZZ,ZZ1)=""
"RTN","RCDPEAA2",24,0)
 . S ^TMP("RCS",$J,ZZ)=""
"RTN","RCDPEAA2",25,0)
 S (RCTS,ZZ)=0
"RTN","RCDPEAA2",26,0)
 F  S ZZ=$O(^TMP("RCS",$J,ZZ)) Q:'ZZ  D
"RTN","RCDPEAA2",27,0)
 . S RCZ0=$G(^RCY(344.49,RCSCR,1,ZZ,0))
"RTN","RCDPEAA2",28,0)
 . S RCECME=$P($G(^RCY(344.4,RCSCR,1,+$P(RCZ0,U,9),4)),U,2)  ; ECME # (344.41,.24)
"RTN","RCDPEAA2",29,0)
 . S REASON=$$GET1^DIQ(344.41,$P(RCZ0,U,9)_","_RCSCR_",",5)  ; AUTOPOST REJECTION REASON (344.41,5)
"RTN","RCDPEAA2",30,0)
 . S TLINE=$$TOPLINE(RCZ0)
"RTN","RCDPEAA2",31,0)
 . D SET(TLINE,$P(RCZ0,U),$P(RCZ0,U),ZZ)
"RTN","RCDPEAA2",32,0)
 . ; PRCA*4.5*304 - Add claim comment to screen if it exists for this ERA EEOB detail line
"RTN","RCDPEAA2",33,0)
 . S:$P(RCZ0,U,9)'="" RCCL=$$GET1^DIQ(344.41,$P(RCZ0,U,9)_","_RCSCR_",",4)
"RTN","RCDPEAA2",34,0)
 . D:$G(RCCL)'=""  ; If we have a ERA Detail line comment, display it
"RTN","RCDPEAA2",35,0)
 . . D SLINE(RCCL,"RCCL1",58,76)
"RTN","RCDPEAA2",36,0)
 . . S TLINE=$J("",4)_"Claim Comment: "_RCCL1(1)
"RTN","RCDPEAA2",37,0)
 . . D SET(TLINE,$P(RCZ0,U),$P(RCZ0,U),ZZ)
"RTN","RCDPEAA2",38,0)
 . . ; If we have a second line for the comment then put it on the screen
"RTN","RCDPEAA2",39,0)
 . . I RCCL1>1 D SET($J("",4)_RCCL1(2),$P(RCZ0,U),$P(RCZ0,U),ZZ) I RCCL1=3 D SET($J("",4)_RCCL1(3),$P(RCZ0,U),$P(RCZ0,U),ZZ)
"RTN","RCDPEAA2",40,0)
 . ; **End of *304 modifications**
"RTN","RCDPEAA2",41,0)
 . ; sub-line info (e.g., "n.001")
"RTN","RCDPEAA2",42,0)
 . S ZZ1=0 F  S ZZ1=$O(^TMP("RCS",$J,ZZ,ZZ1)) Q:'ZZ1  D
"RTN","RCDPEAA2",43,0)
 . . S RCZZ0=$G(^RCY(344.49,RCSCR,1,ZZ1,0))
"RTN","RCDPEAA2",44,0)
 . . S RCT=$P(RCZZ0,U),RCTL=$L(RCT)
"RTN","RCDPEAA2",45,0)
 . . S V1=$S($P(RCZZ0,U,2)'["**ADJ":"",$P($P(RCZZ0,U,2),"ADJ",2):"***ADJUSTMENT AT ERA LEVEL",1:"*** ADJUSTMENT LINE FOR TOTALS MISMATCH")
"RTN","RCDPEAA2",46,0)
 . . S RCLI1=$S(V1="":" Claim #: "_$P(RCZZ0,U,2)_" Patient/Last 4: "_$S($P(RCZZ0,U,7):$$PNM4("","",$P(RCZZ0,U,7)),'$P($G(^RCY(344.49,RCSCR,1,ZZ1,2)),U,3):$$PNM4(+$G(^RCY(344.49,RCSCR,0)),ZZ1),1:"??"),1:V1)
"RTN","RCDPEAA2",47,0)
 . . D SET($J("",4)_$P("   ^(V)",U,$P(RCZZ0,U,13)+1)_RCT_RCLI1,RCT,RCT,ZZ1)
"RTN","RCDPEAA2",48,0)
 . . I $P(RCZZ0,U,7) D CLINES(RCZZ0,RCT,ZZ1)
"RTN","RCDPEAA2",49,0)
 . . ;
"RTN","RCDPEAA2",50,0)
 . . D SET($J("",4+RCTL)_"Payment Amt: "_$J(+$P(RCZZ0,U,5),"",2)_"   Total Adjustments: "_$J(+$P(RCZZ0,U,8),"",2)_"  Net: "_$J($P(RCZZ0,U,5)+$P(RCZZ0,U,8),"",2),RCT,RCT,ZZ1)
"RTN","RCDPEAA2",51,0)
 . . ; displaY pharmacy EEOB data  
"RTN","RCDPEAA2",52,0)
 . . I RCECME]"" D RXLINES(RCZZ0,RCECME,RCT,ZZ1)
"RTN","RCDPEAA2",53,0)
 . . I $P(RCZZ0,U,10)'="" D SET($J("",9)_"Receipt Comment: "_$P(RCZZ0,U,10),$P(RCZZ0,U),RCT,ZZ1)
"RTN","RCDPEAA2",54,0)
 . . I $O(^RCY(344.49,RCSCR,1,ZZ1,1,0)) D ADJLINES(RCZZ0,RCT,ZZ1)
"RTN","RCDPEAA2",55,0)
 . . I $G(^TMP($J,"RC_REVIEW")) D REVLINES(RCSCR,RCZZ0,RCT,ZZ1)
"RTN","RCDPEAA2",56,0)
 . . D SET($J("",7)_"APAR Reason: "_REASON,RCT,RCT,ZZ1)
"RTN","RCDPEAA2",57,0)
 . . S A="",$P(A,".",79)="" D SET(A,RCT,RCT,ZZ1)
"RTN","RCDPEAA2",58,0)
 I VALMCNT=0 D SET("THERE ARE NO EEOBs MATCHING YOUR SELECTION CRITERIA")
"RTN","RCDPEAA2",59,0)
 K ^TMP($J,"RCS")
"RTN","RCDPEAA2",60,0)
 Q
"RTN","RCDPEAA2",61,0)
 ;
"RTN","RCDPEAA2",62,0)
SET(X,RCSEQ,RCSEQ1,RCZ9) ; -- set ListManager arrays
"RTN","RCDPEAA2",63,0)
 ; X = the data to set into the global
"RTN","RCDPEAA2",64,0)
 ; RCSEQ = the selectable line #
"RTN","RCDPEAA2",65,0)
 ; RCSEQ1 = = the sub line #
"RTN","RCDPEAA2",66,0)
 ; RCZ9 = reference to the line(s) in file 344.41 or to the subline in
"RTN","RCDPEAA2",67,0)
 ;        file 344.49 for RCSEQ having a decimal
"RTN","RCDPEAA2",68,0)
 S VALMCNT=VALMCNT+1,^TMP("RCDPE-EOB_WL",$J,VALMCNT,0)=X
"RTN","RCDPEAA2",69,0)
 I $G(RCSEQ) S ^TMP("RCDPE-EOB_WL",$J,"IDX",VALMCNT,RCSEQ)=""
"RTN","RCDPEAA2",70,0)
 I $G(RCSEQ1),'$D(^TMP("RCDPE-EOB_WLDX",$J,RCSEQ1)) S ^TMP("RCDPE-EOB_WLDX",$J,RCSEQ1)=VALMCNT_U_$G(RCZ9)
"RTN","RCDPEAA2",71,0)
 Q
"RTN","RCDPEAA2",72,0)
 ;
"RTN","RCDPEAA2",73,0)
TOPLINE(RCZ0) ; Function returns the top line of the EEOB display
"RTN","RCDPEAA2",74,0)
 ; RCZ0 = the 0-node of the whole number entry line for the EEOB
"RTN","RCDPEAA2",75,0)
 N A
"RTN","RCDPEAA2",76,0)
 S A=" "_$S($P(RCZ0,U,13):"(V)",1:"   ")_"EEOB: ERA Seq #"_$S($P(RCZ0,U,9)[",":"'s",1:"")_" "_$S($P(RCZ0,U,9)'="":$P(RCZ0,U,9),1:"None")_"   Net Payment Amt: "_$J(+$P(RCZ0,U,6),"",2)
"RTN","RCDPEAA2",77,0)
 I $G(^TMP($J,"RC_REVIEW")) S A=A_"  Reviewed?: "_$S($P(RCZ0,U,11)="":"NO",1:$$EXTERNAL^DILFD(344.491,.11,,$P(RCZ0,U,11)))
"RTN","RCDPEAA2",78,0)
 Q A
"RTN","RCDPEAA2",79,0)
 ;
"RTN","RCDPEAA2",80,0)
 ;PRCA*4.5*304 - Split long line into printable lenghts
"RTN","RCDPEAA2",81,0)
SLINE(ZIN,ZARR,FLN,SLN) ;
"RTN","RCDPEAA2",82,0)
 ; ZIN - Input string; ZARR - Array output of lines ; FLN - First line length ; SLN - Subsequent line lengths
"RTN","RCDPEAA2",83,0)
 ; Assumes ZIN max length is 132 characters and FLN and SLN variables will make ZIN fit in 3 lines.
"RTN","RCDPEAA2",84,0)
 N ZL,ZI,ZM
"RTN","RCDPEAA2",85,0)
 I $L(ZIN)<(FLN+1) S @ZARR@(1)=ZIN,@ZARR=1 Q
"RTN","RCDPEAA2",86,0)
 ; Otherwise we are spanning more than 1 line
"RTN","RCDPEAA2",87,0)
 S ZL="" F ZI=1:1 Q:($L(ZL)+$L($P(ZIN," ",ZI)))>FLN  S ZL=ZL_$S($L(ZL)>0:" ",1:"")_$P(ZIN," ",ZI)
"RTN","RCDPEAA2",88,0)
 S @ZARR@(1)=ZL,ZL=$P(ZIN," ",ZI,9999)
"RTN","RCDPEAA2",89,0)
 I $L(ZL)<(SLN+1) S @ZARR@(2)=ZL,@ZARR=2 Q
"RTN","RCDPEAA2",90,0)
 ; Spilling onto a third line.
"RTN","RCDPEAA2",91,0)
 S ZM="" F ZI=1:1 Q:($L(ZM)+$L($P(ZL," ",ZI)))>SLN  S ZM=ZM_$S($L(ZM)>0:" ",1:"")_$P(ZL," ",ZI)
"RTN","RCDPEAA2",92,0)
 S @ZARR@(2)=ZM,ZM=$P(ZL," ",ZI,9999)
"RTN","RCDPEAA2",93,0)
 S @ZARR@(3)=ZM,@ZARR=3
"RTN","RCDPEAA2",94,0)
 Q
"RTN","RCDPEAA2",95,0)
 ; **END of *304 changes**
"RTN","RCDPEAA2",96,0)
 ;
"RTN","RCDPEAA2",97,0)
CLINES(RCZZ0,RCT,ZZ1) ;  called from BLD ; set up the claim information lines
"RTN","RCDPEAA2",98,0)
 ; 
"RTN","RCDPEAA2",99,0)
 ;  Input -   RCZZ0 = zero node data at 344.491
"RTN","RCDPEAA2",100,0)
 ;            RCT   = sub line #
"RTN","RCDPEAA2",101,0)
 ;            ZZ1   = reference to the to the subline in
"RTN","RCDPEAA2",102,0)
 ;                    file 344.49 for RCSEQ having a decimal
"RTN","RCDPEAA2",103,0)
 N A,RCX,Q,QQ
"RTN","RCDPEAA2",104,0)
 S A("OA")=$$ORI^PRCAFN(+$P(RCZZ0,U,7)),A("SDT")=$P($G(^DGCR(399,+$P(RCZZ0,U,7),"U")),U),A("DFN")=+$P($G(^(0)),U,2),A("ENRPR")=""
"RTN","RCDPEAA2",105,0)
 ; Find Rx copay status
"RTN","RCDPEAA2",106,0)
 S A("RXCP")=$S('A("SDT"):"",1:$$RXST^IBARXEU(A("DFN"),A("SDT"))),A("RXCP")=$S($P(A("RXCP"),U)'="":$P(A("RXCP"),U,2),1:"UNKNOWN") ;IA #10147
"RTN","RCDPEAA2",107,0)
 ; Find M/T status
"RTN","RCDPEAA2",108,0)
 S RCX=$$LST^DGMTU(A("DFN"),A("SDT")),A("M/T")=$P(RCX,U,4)
"RTN","RCDPEAA2",109,0)
 S A("M/T")=$S('RCX:"??",A("M/T")="P":"PEN",A("M/T")="C":"YES",A("M/T")="G":"GMT",A("M/T")="R":"REQ",1:"NO")
"RTN","RCDPEAA2",110,0)
 S QQ="   Billed Amt: "_$J(A("OA"),"",2)_"   Amt To Post: "_$J(+$P(RCZZ0,U,3),"",2)
"RTN","RCDPEAA2",111,0)
 D SET($J("",4+RCTL)_"Claim Bal: "_$J(+$P($$BILL^RCJIBFN2(+$P(RCZZ0,U,7)),U,3),"",2)_QQ,$P(RCZZ0,U),RCT,ZZ1)
"RTN","RCDPEAA2",112,0)
 S ^TMP("RC_BILL",$J,$P(RCZZ0,U,7),RCT)=QQ
"RTN","RCDPEAA2",113,0)
 S Z3=$J("",4+RCTL)_"Svc Dt: "_$S(A("SDT")'="":$$FMTE^XLFDT(A("SDT"),2),1:"UNKNOWN")
"RTN","RCDPEAA2",114,0)
 S Z3=Z3_"  COB: "_$S($D(^DGCR(399,+$P(RCZZ0,U,7),"I"_($$COBN(+$P(RCZZ0,U,7))+1))):"YES",1:"NO ")
"RTN","RCDPEAA2",115,0)
 D SET(Z3_"  Rx Copay: "_$E(A("RXCP"),1,17)_"  Means Tst: "_A("M/T"),$P(RCZZ0,U),RCT,ZZ1)
"RTN","RCDPEAA2",116,0)
 Q
"RTN","RCDPEAA2",117,0)
 ;
"RTN","RCDPEAA2",118,0)
REVLINES(RCSCR,RCZZ0,RCT,ZZ1) ;called from BLD; set up the reviewed lines
"RTN","RCDPEAA2",119,0)
 ; 
"RTN","RCDPEAA2",120,0)
 ;    Input - RCSCR = ien of 344.49 (and 344.4)
"RTN","RCDPEAA2",121,0)
 ;            RCZZ0 = zero node data at 344.491
"RTN","RCDPEAA2",122,0)
 ;            RCT   = sub line #
"RTN","RCDPEAA2",123,0)
 ;            ZZ1   = reference to the to the subline in
"RTN","RCDPEAA2",124,0)
 ;                    file 344.49 for RCSEQ having a decimal
"RTN","RCDPEAA2",125,0)
 N A,A0,B,B0
"RTN","RCDPEAA2",126,0)
 S A=$J("",10)_"REVIEW STATUS: ("_$S($P(RCZZ0,U,11)="I":"REVIEW IN PROCESS",$P(RCZZ0,U,11)=1:"REVIEWED",1:"NOT REVIEWED")
"RTN","RCDPEAA2",127,0)
 I $P(RCZZ0,U,12) S A=A_"   SET BY: "_$E($P($G(^VA(200,$P(RCZZ0,U,12),0)),U),1,20)
"RTN","RCDPEAA2",128,0)
 D SET(A_")",+$P(RCZZ0,U),RCT,ZZ1)
"RTN","RCDPEAA2",129,0)
 S A=0 F  S A=$O(^RCY(344.49,RCSCR,1,ZZ1,4,A)) Q:'A  S A0=$G(^(A,0)) D
"RTN","RCDPEAA2",130,0)
 . D SET($J("",12)_$$FMTE^XLFDT($P(A0,U),2)_"  "_$P($G(^VA(200,+$P(A0,U,2),0)),U)_$S($P(A0,U,4):"  LAST EDIT: "_$$FMTE^XLFDT($P(A0,U,4),2),1:""),$P(RCZZ0,U),RCT,ZZ1)
"RTN","RCDPEAA2",131,0)
 . S B=0 F  S B=$O(^RCY(344.49,RCSCR,1,ZZ1,4,A,1,B)) Q:'B  S B0=$G(^(B,0)) D
"RTN","RCDPEAA2",132,0)
 . . I $L(B0)>64 D SET($J("",15)_$E(B0,1,64),$P(RCZZ0,U),RCT,ZZ1) S B0="  "_$E(B0,65,$L(B0)) ; Split line if > 64 characters in comment line
"RTN","RCDPEAA2",133,0)
 . . D SET($J("",15)_B0,$P(RCZZ0,U),RCT,ZZ1)
"RTN","RCDPEAA2",134,0)
 Q
"RTN","RCDPEAA2",135,0)
 ;
"RTN","RCDPEAA2",136,0)
ADJLINES(RCZZ0,RCT,ZZ1) ; called from BLD;  set up the adjustment lines
"RTN","RCDPEAA2",137,0)
 ; 
"RTN","RCDPEAA2",138,0)
 ;  Input -   RCZZ0 = zero node data at 344.491
"RTN","RCDPEAA2",139,0)
 ;            RCT   = sub line #
"RTN","RCDPEAA2",140,0)
 ;            ZZ1   = reference to the to the subline in
"RTN","RCDPEAA2",141,0)
 ;                    file 344.49 for RCSEQ having a decimal
"RTN","RCDPEAA2",142,0)
 N RCAZ,RCAZ0,Z3
"RTN","RCDPEAA2",143,0)
 S Z3=""
"RTN","RCDPEAA2",144,0)
 D SET($J("",4+RCTL)_"ADJUSTMENTS:",$P(RCZZ0,U),RCT,ZZ1)
"RTN","RCDPEAA2",145,0)
 S RCAZ=0 F  S RCAZ=$O(^RCY(344.49,RCSCR,1,ZZ1,1,RCAZ)) Q:'RCAZ  S RCAZ0=$G(^(RCAZ,0)) D
"RTN","RCDPEAA2",146,0)
 . S Z3=$J("",6+RCTL)_+RCAZ0_".  ",Q=$L(Z3)
"RTN","RCDPEAA2",147,0)
 . I $P(RCAZ0,U,2)=0 S Z3=Z3_"Distributed adj dec for retraction "_$P(RCAZ0,U,4)_": "_$P(RCAZ0,U,3)
"RTN","RCDPEAA2",148,0)
 . I $P(RCAZ0,U,2)=1 S Z3=Z3_"Adjustment distribution to balance receipt: "_$P(RCAZ0,U,3)
"RTN","RCDPEAA2",149,0)
 . I $P(RCAZ0,U,2)=2!($P(RCAZ0,U,2)=4) D
"RTN","RCDPEAA2",150,0)
 . . S Z3=Z3_"ERA payment adjusted from "_$J($P(RCZZ0,U,5)-$P(RCZZ0,U,6),"",2)_" to "_$J(+$P(RCZZ0,U,5),"",2)_"  NET: "_$J($P(RCZZ0,U,5)+$P(RCAZ0,U,3),"",2)
"RTN","RCDPEAA2",151,0)
 . I $P(RCAZ0,U,2)=5 S Z3=Z3_"Non-specific payment (ref# "_$P(RCAZ0,U,4)_"): "_$P(RCAZ0,U,3)
"RTN","RCDPEAA2",152,0)
 . I $P(RCAZ0,U,2)=3 S Z3=Z3_"Non-specific retraction (ref# "_$P(RCAZ0,U,4)_"): "_$P(RCAZ0,U,3)
"RTN","RCDPEAA2",153,0)
 . D SET(Z3,$P(RCZZ0,U),RCT,ZZ1)
"RTN","RCDPEAA2",154,0)
 . I $P(RCAZ0,U,9)'="" D SET($J("",Q)_$P(RCAZ0,U,9),$P(RCZZ0,U),RCT,ZZ1)
"RTN","RCDPEAA2",155,0)
 Q
"RTN","RCDPEAA2",156,0)
 ;
"RTN","RCDPEAA2",157,0)
 ;
"RTN","RCDPEAA2",158,0)
RXLINES(RCZZ0,RCECME,RCT,ZZ1) ; called from BLD ; set up the Pharmacy lines
"RTN","RCDPEAA2",159,0)
 ;
"RTN","RCDPEAA2",160,0)
 ;  Input -   RCZZ0   = zero node data at 344.491
"RTN","RCDPEAA2",161,0)
 ;            RCECME  = ECME # for Pharmacy claims
"RTN","RCDPEAA2",162,0)
 ;            RCT     = sub line #
"RTN","RCDPEAA2",163,0)
 ;            ZZ1     = reference to the to the subline in
"RTN","RCDPEAA2",164,0)
 ;                      file 344.49 for RCSEQ having a decimal
"RTN","RCDPEAA2",165,0)
 N RXARRAY
"RTN","RCDPEAA2",166,0)
 D GETPHARM^RCDPEWLP($P(RCZZ0,U,7),.RXARRAY)
"RTN","RCDPEAA2",167,0)
 D SET($J("",9)_"ECME #: "_RCECME,$P(RCZZ0,U),RCT,ZZ1)
"RTN","RCDPEAA2",168,0)
 I '$D(RXARRAY) D SET($J("",9)_" Pharmacy data does not exist for this claim",$P(RCZZ0,U),RCT,ZZ1) Q
"RTN","RCDPEAA2",169,0)
 D SET($J("",9)_"Rx/Fill/Release Status: "_RXARRAY("RX")_"/"_RXARRAY("FILL")_"/"_RXARRAY("RELEASED STATUS"),$P(RCZZ0,U),RCT,ZZ1)
"RTN","RCDPEAA2",170,0)
 D SET($J("",9)_"DOS: "_RXARRAY("DOS"),$P(RCZZ0,U),RCT,ZZ1)
"RTN","RCDPEAA2",171,0)
 Q
"RTN","RCDPEAA2",172,0)
 ;
"RTN","RCDPEAA2",173,0)
HDR ; Creates header lines for the selected EEOB display
"RTN","RCDPEAA2",174,0)
 N RC0,RC4,RC5,Z,RCDA,RCSEQ
"RTN","RCDPEAA2",175,0)
 I '$G(RCIENS) S VALMQUIT=1 Q
"RTN","RCDPEAA2",176,0)
 S RCDA=$P(RCIENS,U),RCSEQ=$P(RCIENS,U,3)
"RTN","RCDPEAA2",177,0)
 S RC0=$G(^RCY(344.4,RCDA,0)),RC4=$G(^RCY(344.4,RCDA,4)),RC5=$G(^RCY(344.4,RCDA,5))
"RTN","RCDPEAA2",178,0)
 S VALMHDR(1)=$E("ERA Entry #: "_$P(RC0,U)_$J("",31),1,31)_"Total Amt Pd: "_$J(+$P(RC0,U,5),"",2)
"RTN","RCDPEAA2",179,0)
 I +RCSEQ S VALMHDR(2)=$E("Posted Amt: "_$J($P(^TMP("RCDPE-APAR_EEOB_WLDX",$J,RCSEQ),U,5),"",2)_$J("",31),1,31)
"RTN","RCDPEAA2",180,0)
 S VALMHDR(2)=$G(VALMHDR(2))_"Un-posted balance: "_$J($P(^TMP("RCDPE-APAR_EEOB_WLDX",$J,RCSEQ),U,4),"",2)
"RTN","RCDPEAA2",181,0)
 S VALMHDR(3)="Payer Name/ID: "_$P(RC0,U,6)_"/"_$P(RC0,U,3)
"RTN","RCDPEAA2",182,0)
 S Z=+$O(^RCY(344.31,"AERA",RCDA,0))
"RTN","RCDPEAA2",183,0)
 I Z S VALMHDR(4)="EFT #/TRACE #: "_$P($G(^RCY(344.3,+$G(^RCY(344.31,Z,0)),0)),U)_"/"_$P(RC0,U,2)
"RTN","RCDPEAA2",184,0)
 I 'Z,$P(RC5,U,2)'="" S VALMHDR(4)="PAPER CHECK #: "_$P(RC5,U,2)
"RTN","RCDPEAA2",185,0)
 S VALMHDR(5)="Posted Receipt #(s): "_$$RCPTS(RCDA,RC0)
"RTN","RCDPEAA2",186,0)
 Q
"RTN","RCDPEAA2",187,0)
 ;
"RTN","RCDPEAA2",188,0)
RCPTS(RCDA,RC0) ; pull list of 'other receipt #s
"RTN","RCDPEAA2",189,0)
 ;  input  - RCDA  = ien of entry in 344.4
"RTN","RCDPEAA2",190,0)
 ;           RC0   = data string at zero node of entry in 344.4
"RTN","RCDPEAA2",191,0)
 ;  output - RCPTS = returns list of receipts stored at 344.4,.08 and 344.48 multiple
"RTN","RCDPEAA2",192,0)
 N X,RIEN,RCPTS
"RTN","RCDPEAA2",193,0)
 S X=0
"RTN","RCDPEAA2",194,0)
 S RCPTS=$P($G(^RCY(344,+$P(RC0,U,8),0)),U)
"RTN","RCDPEAA2",195,0)
 I RCPTS="" G RCPTSQ  ; receipt not posted to any of EEOB items
"RTN","RCDPEAA2",196,0)
 S RCPTS=RCPTS_","
"RTN","RCDPEAA2",197,0)
 F  S X=$O(^RCY(344.4,RCDA,8,X)) Q:'X  S RIEN=+^(X,0) S RCPTS=RCPTS_$P($G(^RCY(344,RIEN,0)),U)_","
"RTN","RCDPEAA2",198,0)
 S RCPTS=$$TRIM^XLFSTR(RCPTS,"R",",")  ; remove orphan comma from last receipt number
"RTN","RCDPEAA2",199,0)
RCPTSQ ;
"RTN","RCDPEAA2",200,0)
 Q RCPTS
"RTN","RCDPEAA2",201,0)
 ;
"RTN","RCDPEAA2",202,0)
EXIT ; -- Clean up list
"RTN","RCDPEAA2",203,0)
 K RCFASTXT
"RTN","RCDPEAA2",204,0)
 Q
"RTN","RCDPEAA2",205,0)
 ;
"RTN","RCDPEAA2",206,0)
PNM4(RCIFN,RCDA,RC) ; Returns either the patient name or patient name/last 4
"RTN","RCDPEAA2",207,0)
 ; RCIFN = ien of file 344.4
"RTN","RCDPEAA2",208,0)
 ; RCDA = ien of file 344.41
"RTN","RCDPEAA2",209,0)
 ; RC = the ien of file 430
"RTN","RCDPEAA2",210,0)
 N Z,Z0,Q
"RTN","RCDPEAA2",211,0)
 S Z=""
"RTN","RCDPEAA2",212,0)
 I $G(RCIFN)'="" D
"RTN","RCDPEAA2",213,0)
 . S Z0=$G(^RCY(344.4,RCIFN,1,RCDA,0)),Z=""
"RTN","RCDPEAA2",214,0)
 . I $P(Z0,U,2) S Q=+$P($G(^DGCR(399,+$G(^IBM(361.1,+$P(Z0,U,2),0)),0)),U,2),Z=$P($G(^DPT(Q,0)),U)_"/"_$E($P($G(^(0)),U,9),6,9) ; IA 4051
"RTN","RCDPEAA2",215,0)
 . I $TR(Z,"/")="" S Z=$P(Z0,U,15)
"RTN","RCDPEAA2",216,0)
 I $G(RC)'="" D
"RTN","RCDPEAA2",217,0)
 . S Q=+$P($G(^PRCA(430,RC,0)),U,7)
"RTN","RCDPEAA2",218,0)
 . I Q S Z=$P($G(^DPT(Q,0)),U)_"/"_$E($P($G(^(0)),U,9),6,9)
"RTN","RCDPEAA2",219,0)
 Q Z
"RTN","RCDPEAA2",220,0)
 ;
"RTN","RCDPEAA2",221,0)
COBN(RC,A) ; Return seq # of selected payer
"RTN","RCDPEAA2",222,0)
 ; A = 'PST' or null to get current bill payer seq #
"RTN","RCDPEAA2",223,0)
 I $G(A)="" S A=$P($G(^DGCR(399,RC,0)),U,21) S:A="" A="P" S:"PST"'[A A="P"
"RTN","RCDPEAA2",224,0)
 I 'A S A=$F("PST",A)-1 S:A<1 A=1
"RTN","RCDPEAA2",225,0)
 Q A
"RTN","RCDPEAA2",226,0)
 ;
"RTN","RCDPEAA2",227,0)
COPAY(RCIFN)       ; Returns 1 if any not cancelled 1st party bills exist for
"RTN","RCDPEAA2",228,0)
 ; a 3rd party bill or any bills related to this 3rd party bill
"RTN","RCDPEAA2",229,0)
 ; RCIFN = the 3rd party bill #
"RTN","RCDPEAA2",230,0)
 N FIRST,RCTP0,RCTP1,RCTP2
"RTN","RCDPEAA2",231,0)
 K ^TMP("IBRBF",$J),^TMP($J,"IBRBF")
"RTN","RCDPEAA2",232,0)
 D RELBILL^IBRFN(RCIFN) ; DBIA 3124
"RTN","RCDPEAA2",233,0)
 S RCTP0=0 F  S RCTP0=$O(^TMP("IBRBF",$J,RCIFN,RCTP0)) Q:RCTP0=""  S RCTP1=$G(^(RCTP0)) D
"RTN","RCDPEAA2",234,0)
 . I $P(RCTP1,U,3) K ^TMP("IBRBF",$J,RCIFN,RCTP0) Q  ; IB cancelled
"RTN","RCDPEAA2",235,0)
 . S RCTP2=$O(^PRCA(430,"B",+$P(RCTP1,U,4),0)) I $P($G(^PRCA(430,+RCTP2,0)),U,8)=39 K ^TMP("IBRBF",$J,RCIFN,RCTP0) ; AR cancelled
"RTN","RCDPEAA2",236,0)
 S FIRST=$S($O(^TMP("IBRBF",$J,RCIFN,0)):1,1:0)
"RTN","RCDPEAA2",237,0)
 K ^TMP("IBRBF",$J),^TMP($J,"IBRBF")
"RTN","RCDPEAA2",238,0)
 Q FIRST
"RTN","RCDPEAA2",239,0)
 ;
"RTN","RCDPEAA2",240,0)
MARK(RCIENS) ;EP - Protocol action - RCDPE MARK FOR AUTO POST
"RTN","RCDPEAA2",241,0)
 ; Mark for Auto-Post - EEOB on APAR gets marked for auto-post if it passes
"RTN","RCDPEAA2",242,0)
 ; autoposting validation
"RTN","RCDPEAA2",243,0)
 ; Input:   RCIENS  - Internal IEN of entry in file 344.49^ien of 
"RTN","RCDPEAA2",244,0)
 ;                    344.491^selectable line item from listman screen
"RTN","RCDPEAA2",245,0)
 ;
"RTN","RCDPEAA2",246,0)
 I '$D(^XUSEC("RCDPEPP",DUZ)) D  Q  ; PRCA*4.5*318 Added security key check
"RTN","RCDPEAA2",247,0)
 . D FULL^VALM1
"RTN","RCDPEAA2",248,0)
 . S VALMBCK="R"
"RTN","RCDPEAA2",249,0)
 . W !!,"This action can only be taken by users that have the RCDPEPP security key.",!
"RTN","RCDPEAA2",250,0)
 . D PAUSE^VALM1
"RTN","RCDPEAA2",251,0)
 ;
"RTN","RCDPEAA2",252,0)
 N RESULT,REASON,LINE,DIR,X,Y,RCERROR,XX,ERADA1,RCDFDA
"RTN","RCDPEAA2",253,0)
 S:$G(RCIENS)="" RCIENS=+$$SEL^RCDPEAA1()
"RTN","RCDPEAA2",254,0)
 Q:'RCIENS
"RTN","RCDPEAA2",255,0)
 I '$$VALID^RCDPEAP($P(RCIENS,U),$P(RCIENS,U,2),.RESULT) D  G MARKQ
"RTN","RCDPEAA2",256,0)
 . S LINE=$O(RESULT(""))
"RTN","RCDPEAA2",257,0)
 . S REASON=$TR(RESULT(LINE),U,"-")
"RTN","RCDPEAA2",258,0)
 . S DIR(0)="EA",DIR("A",1)="EEOB cannot be marked for Auto-Post for the following reason:"
"RTN","RCDPEAA2",259,0)
 . S DIR("A",2)=REASON
"RTN","RCDPEAA2",260,0)
 . S DIR("A")="PRESS RETURN TO CONTINUE "
"RTN","RCDPEAA2",261,0)
 . W ! D ^DIR K DIR W !
"RTN","RCDPEAA2",262,0)
 ; EEOB passed validation; ready for Autopost
"RTN","RCDPEAA2",263,0)
 L +^RCY(344.4,$P(RCIENS,U),0):5 I '$T D NOLOCK G MARKQ
"RTN","RCDPEAA2",264,0)
 S ERADA1=$P($G(^RCY(344.49,$P(RCIENS,U),1,$P(RCIENS,U,2),0)),U,9)  ; get 344.41 ien (344.491,.09)
"RTN","RCDPEAA2",265,0)
 S RCDFDA(344.41,ERADA1_","_$P(RCIENS,U)_",",6)=1
"RTN","RCDPEAA2",266,0)
 D FILE^DIE("","RCDFDA")
"RTN","RCDPEAA2",267,0)
 S DIR(0)="EA",DIR("A",1)=$P(RCIENS,U)_"."_ERADA1_" has been marked for auto-post and has been removed from the APAR List."
"RTN","RCDPEAA2",268,0)
 S DIR("A")="PRESS RETURN TO CONTINUE "
"RTN","RCDPEAA2",269,0)
 W ! D ^DIR K DIR W !
"RTN","RCDPEAA2",270,0)
 L -^RCY(344.4,$P(RCIENS,U),0)
"RTN","RCDPEAA2",271,0)
MARKQ ;
"RTN","RCDPEAA2",272,0)
 Q
"RTN","RCDPEAA2",273,0)
 ;
"RTN","RCDPEAA2",274,0)
NOLOCK ; entry cannot be locked
"RTN","RCDPEAA2",275,0)
 N DIR
"RTN","RCDPEAA2",276,0)
 S DIR(0)="EA"
"RTN","RCDPEAA2",277,0)
 S DIR("A",1)="Sorry, another user is editing this ERA entry."
"RTN","RCDPEAA2",278,0)
 S DIR("A",2)="Try again later."
"RTN","RCDPEAA2",279,0)
 S DIR("A",3)=""
"RTN","RCDPEAA2",280,0)
 S DIR("A")="PRESS ENTER TO CONTINUE "
"RTN","RCDPEAA2",281,0)
 D ^DIR
"RTN","RCDPEAA2",282,0)
 Q
"RTN","RCDPEAA2",283,0)
 ;
"RTN","RCDPEAA2",284,0)
VIEWERA(RCIENS) ; View/Print ERA - protocol entry from APAR EEOB List screen and APAR - EEOB ITEM - SCRATCHPAD screen
"RTN","RCDPEAA2",285,0)
 N RCSCR
"RTN","RCDPEAA2",286,0)
 I RCPROG="RCDPEAA2" S RCSCR=$P(RCIENS,U)
"RTN","RCDPEAA2",287,0)
 I RCPROG="RCDPEAA1" S RCSCR=+$$SEL^RCDPEAA1()
"RTN","RCDPEAA2",288,0)
 I RCSCR>0 D PRERA^RCDPEWL0
"RTN","RCDPEAA2",289,0)
 Q
"RTN","RCDPEAA3")
0^24^B103351099^B91778928
"RTN","RCDPEAA3",1,0)
RCDPEAA3 ;ALB/KML - APAR Screen - callable entry points ;Nov 24, 2014@23:32:24
"RTN","RCDPEAA3",2,0)
 ;;4.5;Accounts Receivable;**298,304,318**;Mar 20, 1995;Build 37
"RTN","RCDPEAA3",3,0)
 ;Per VA Directive 6402, this routine should not be modified.
"RTN","RCDPEAA3",4,0)
 Q
"RTN","RCDPEAA3",5,0)
 ;
"RTN","RCDPEAA3",6,0)
SPLIT(RCIENS) ;EP - Protocol action - RCDPE APAR SPLINE LINE
"RTN","RCDPEAA3",7,0)
 ; Split EEOB in APAR
"RTN","RCDPEAA3",8,0)
 ; Input:   RCIENS  - Internal IEN of entry in file 344.49^ien of 
"RTN","RCDPEAA3",9,0)
 ;                    344.491^selectable line item from listman screen
"RTN","RCDPEAA3",10,0)
 N DIR,L,RCQUIT,X
"RTN","RCDPEAA3",11,0)
 S RCQUIT=0
"RTN","RCDPEAA3",12,0)
 D FULL^VALM1
"RTN","RCDPEAA3",13,0)
 I '$D(^XUSEC("RCDPEPP",DUZ)) D  Q  ; PRCA*4.5*318 Added security key check
"RTN","RCDPEAA3",14,0)
 . S VALMBCK="R"
"RTN","RCDPEAA3",15,0)
 . W !!,"This action can only be taken by users that have the RCDPEPP security key.",!
"RTN","RCDPEAA3",16,0)
 . D PAUSE^VALM1
"RTN","RCDPEAA3",17,0)
 S L=0 F  S L=$O(^RCY(344.49,$P(RCIENS,U),1,$P(RCIENS,U,2),1,L)) Q:'L  D
"RTN","RCDPEAA3",18,0)
 . I "01"[$P($G(^(L,0)),U,2) S DIR(0)="EA",DIR("A",1)="THIS EEOB IS NOT AVAILABLE TO EDIT/SPLIT",DIR("A")="PRESS RETURN TO CONTINUE " W ! D ^DIR K DIR G SPLITQ
"RTN","RCDPEAA3",19,0)
 I $P($G(^RCY(344.49,$P(RCIENS,U),1,$P(RCIENS,U,2),0)),U,13) D  G:RCQUIT SPLITQ
"RTN","RCDPEAA3",20,0)
 . S DIR("A",1)="WARNING!  THIS LINE HAS ALREADY BEEN VERIFIED",DIR("A")="ARE YOU SURE YOU WANT TO CONTINUE?: ",DIR(0)="YA",DIR("B")="NO" W ! D ^DIR K DIR
"RTN","RCDPEAA3",21,0)
 . I Y'=1 S RCQUIT=1
"RTN","RCDPEAA3",22,0)
 K ^TMP("RCDPE_SPLIT_REBLD",$J)
"RTN","RCDPEAA3",23,0)
 S X=+$O(^TMP("RCDPE-EOB_WLDX",$J,""),-1)
"RTN","RCDPEAA3",24,0)
 D SPLIT^RCDPEWL3($P(RCIENS,U),X)
"RTN","RCDPEAA3",25,0)
 I $G(^TMP("RCDPE_SPLIT_REBLD",$J)) K ^TMP("RCDPE_SPLIT_REBLD",$J) D INIT^RCDPEAA2(RCIENS)
"RTN","RCDPEAA3",26,0)
 ;
"RTN","RCDPEAA3",27,0)
SPLITQ S VALMBCK="R"
"RTN","RCDPEAA3",28,0)
 Q
"RTN","RCDPEAA3",29,0)
 ;
"RTN","RCDPEAA3",30,0)
REFRESH(RCIENS) ;EP - Protocol action - RCDPE APAR EEOB REFRESH
"RTN","RCDPEAA3",31,0)
 ; Refresh the entry in file 344.49 to remove all user adjustments
"RTN","RCDPEAA3",32,0)
 ;  Input:  RCIENS  - Internal IEN of entry in file 344.49^ien of 
"RTN","RCDPEAA3",33,0)
 ;                    344.491^selectable line item from listman screen
"RTN","RCDPEAA3",34,0)
 N DA,DIK,DIR,X,Y,Z,Z0
"RTN","RCDPEAA3",35,0)
 D FULL^VALM1
"RTN","RCDPEAA3",36,0)
 I '$D(^XUSEC("RCDPEPP",DUZ)) D  Q  ; PRCA*4.5*318 Added security key check
"RTN","RCDPEAA3",37,0)
 . S VALMBCK="R"
"RTN","RCDPEAA3",38,0)
 . W !!,"This action can only be taken by users that have the RCDPEPP security key.",!
"RTN","RCDPEAA3",39,0)
 . D PAUSE^VALM1
"RTN","RCDPEAA3",40,0)
 ;
"RTN","RCDPEAA3",41,0)
 S DIR(0)="YA"
"RTN","RCDPEAA3",42,0)
 S DIR("A",1)="THIS ACTION WILL DELETE AND REBUILD THIS EEOB WORKLIST SCRATCH PAD ENTRY",DIR("A",2)="ALL EDITS/SPLITS/DISTRIBUTE ADJUSTMENTS ENTERED FOR THIS ERA WILL BE ERASED"
"RTN","RCDPEAA3",43,0)
 S DIR("A",3)="AND ALL ENTRIES MARKED AS MANUALLY VERIFIED WILL BE UNMARKED",DIR("A",4)=" "
"RTN","RCDPEAA3",44,0)
 S DIR("A")="ARE YOU SURE YOU WANT TO DO THIS?: "
"RTN","RCDPEAA3",45,0)
 W ! D ^DIR K DIR
"RTN","RCDPEAA3",46,0)
 I Y'=1 G REFQ
"RTN","RCDPEAA3",47,0)
 D ADDLINES^RCDPEWLA($P(RCIENS,U))
"RTN","RCDPEAA3",48,0)
 D INIT^RCDPEAA2(RCIENS)
"RTN","RCDPEAA3",49,0)
REFQ S VALMBG=1,VALMBCK="R"
"RTN","RCDPEAA3",50,0)
 Q
"RTN","RCDPEAA3",51,0)
 ;
"RTN","RCDPEAA3",52,0)
RESEARCH ; Invoke the research menu off APAR
"RTN","RCDPEAA3",53,0)
 ;
"RTN","RCDPEAA3",54,0)
 K ^TMP($J,"RC_VALMBG")
"RTN","RCDPEAA3",55,0)
 S ^TMP($J,"RC_VALMBG")=$G(VALMBG)
"RTN","RCDPEAA3",56,0)
 D FULL^VALM1
"RTN","RCDPEAA3",57,0)
 D EN^VALM("RCDPE APAR EEOB RESEARCH")
"RTN","RCDPEAA3",58,0)
RQ K ^TMP($J,"RC_VALMBG")
"RTN","RCDPEAA3",59,0)
 Q
"RTN","RCDPEAA3",60,0)
 ;
"RTN","RCDPEAA3",61,0)
VRECPT(RCIENS) ;
"RTN","RCDPEAA3",62,0)
 ;  
"RTN","RCDPEAA3",63,0)
 ;    Input - RCIENS = ien of entry in file 344.49^ien of 344.491^selectable line item from listman screen
"RTN","RCDPEAA3",64,0)
 ;
"RTN","RCDPEAA3",65,0)
 D VR^RCDPEWLP($P(RCIENS,U))
"RTN","RCDPEAA3",66,0)
 Q
"RTN","RCDPEAA3",67,0)
REVIEW(RCIENS) ; Enter review information on worklist and turn review display on/off
"RTN","RCDPEAA3",68,0)
 ;  
"RTN","RCDPEAA3",69,0)
 ;    Input - RCIENS = ien of entry in file 344.49^ien of 344.491^selectable line item from listman screen
"RTN","RCDPEAA3",70,0)
 ;
"RTN","RCDPEAA3",71,0)
 ;
"RTN","RCDPEAA3",72,0)
 N Z,RC,RCDA,RCZ,DIC,DA,DIE,DR,X,Y,DIR,REVCHG,RCUSPREF,RCLSTREV,RCREV
"RTN","RCDPEAA3",73,0)
 D FULL^VALM1
"RTN","RCDPEAA3",74,0)
 ;
"RTN","RCDPEAA3",75,0)
 S REVCHG=""
"RTN","RCDPEAA3",76,0)
 S DIR(0)="YA",RC=+$G(^TMP($J,"RC_REVIEW"))
"RTN","RCDPEAA3",77,0)
 S DIR("A",1)="REVIEW DATA DISPLAY IS CURRENTLY TURNED "_$P("OFF^ON",U,RC+1),DIR("A")="DO YOU WANT TO TURN IT "_$P("ON^OFF",U,RC+1)_"?: ",DIR("B")=$S('RC:"YES",1:"NO") W ! D ^DIR K DIR
"RTN","RCDPEAA3",78,0)
 I Y=1 S ^TMP($J,"RC_REVIEW")=((RC+1)#2),REVCHG=1
"RTN","RCDPEAA3",79,0)
 S RCUSPREF=+$O(^RCY(344.49,$P(RCIENS,U),2,"B",DUZ,0))
"RTN","RCDPEAA3",80,0)
 ;
"RTN","RCDPEAA3",81,0)
 I 'RCUSPREF D  ; Add the user pref record
"RTN","RCDPEAA3",82,0)
 . S RCUSPREF=+$$ADDUSER($P(RCIENS,U),DUZ)
"RTN","RCDPEAA3",83,0)
 S RCLSTREV=+$P($G(^RCY(344.49,$P(RCIENS,U),2,RCUSPREF,0)),U,2)
"RTN","RCDPEAA3",84,0)
 S DA(1)=$P(RCIENS,U),DA=RCUSPREF
"RTN","RCDPEAA3",85,0)
 I DA,RCLSTREV'=$G(^TMP($J,"RC_REVIEW")) D  ; Update user pref
"RTN","RCDPEAA3",86,0)
 . S DIE="^RCY(344.49,"_DA(1)_",2,",DR=".02////"_+$G(^TMP($J,"RC_REVIEW")) D ^DIE
"RTN","RCDPEAA3",87,0)
 W !
"RTN","RCDPEAA3",88,0)
 I '$G(^TMP($J,"RC_REVIEW")) G REVIEWQ
"RTN","RCDPEAA3",89,0)
 ;
"RTN","RCDPEAA3",90,0)
 D SEL^RCDPEWL(.RCDA)
"RTN","RCDPEAA3",91,0)
 S RCZ=+$O(RCDA(0)),RCZ=+$G(RCDA(RCZ)) G:'RCZ REVIEWQ
"RTN","RCDPEAA3",92,0)
 ;
"RTN","RCDPEAA3",93,0)
 S RCREV=0
"RTN","RCDPEAA3",94,0)
 I '$O(^RCY(344.49,$P(RCIENS,U),1,"AC",DUZ,RCZ,0)) D
"RTN","RCDPEAA3",95,0)
 . S RCREV=$$NEWREV($P(RCIENS,U),RCZ,DUZ)
"RTN","RCDPEAA3",96,0)
 E  D
"RTN","RCDPEAA3",97,0)
 . N DIR,X,Y
"RTN","RCDPEAA3",98,0)
 . S DIR("A")="(A)DD or (E)DIT A REVIEW COMMENT?: ",DIR("B")="ADD",DIR(0)="SA^A:ADD;E:EDIT" W ! D ^DIR K DIR
"RTN","RCDPEAA3",99,0)
 . I $D(DUOUT)!$D(DTOUT) Q
"RTN","RCDPEAA3",100,0)
 . ;
"RTN","RCDPEAA3",101,0)
 . I Y="E" D  Q  ; Edit a review entry entered by same user
"RTN","RCDPEAA3",102,0)
 .. N DA,DR,DIE,X,Y
"RTN","RCDPEAA3",103,0)
 .. S DA(1)=$P(RCIENS,U),DA=RCZ,DIC="^RCY(344.49,"_DA(1)_",1,"_DA_",4,",DIC(0)="AEMQ",DIC("S")="I $P(^(0),U,2)=DUZ" D ^DIC
"RTN","RCDPEAA3",104,0)
 .. S RCREV=$S(Y>0:+Y,1:0)
"RTN","RCDPEAA3",105,0)
 .. I RCREV S DA(2)=$P(RCIENS,U),DA(1)=RCZ,DA=RCREV,DIE="^RCY(344.49,"_DA(2)_",1,"_DA(1)_",4,",DR=".03;.04////^S X=$$NOW^XLFDT()" D ^DIE
"RTN","RCDPEAA3",106,0)
 . ;
"RTN","RCDPEAA3",107,0)
 . S RCREV=$$NEWREV($P(RCIENS,U),RCZ,DUZ)
"RTN","RCDPEAA3",108,0)
 ;
"RTN","RCDPEAA3",109,0)
 I RCREV S DIE("NO^")="",DA(1)=$P(RCIENS,U),DA=RCZ,DIE="^RCY(344.49,"_DA(1)_",1,",DR=".11R;I X=0 S Y=""@10"";.12////^S X=DUZ;S Y=""@20"";@10;.12///@;@20" D ^DIE K DIE
"RTN","RCDPEAA3",110,0)
 D INIT^RCDPEAA2(RCIENS)
"RTN","RCDPEAA3",111,0)
 S REVCHG=""
"RTN","RCDPEAA3",112,0)
 ;
"RTN","RCDPEAA3",113,0)
REVIEWQ I $G(REVCHG) D INIT^RCDPEAA2(RCIENS)
"RTN","RCDPEAA3",114,0)
 S VALMBCK="R"
"RTN","RCDPEAA3",115,0)
 Q
"RTN","RCDPEAA3",116,0)
 ;
"RTN","RCDPEAA3",117,0)
NEWREV(RCSCR,RCZ,RCDUZ) ; Enter a new review comment
"RTN","RCDPEAA3",118,0)
 ; RCSCR = ien of entry in file 344.49
"RTN","RCDPEAA3",119,0)
 ; RCZ = ien of the EEOB (seq #)
"RTN","RCDPEAA3",120,0)
 ; RCDUZ =DUZ of user entering the comment
"RTN","RCDPEAA3",121,0)
 ; Function returns 0 if no new comment, ien of comment if added
"RTN","RCDPEAA3",122,0)
 N DA,X,Y,DIC,DIK,DLAYGO,DO,DD,RCREV,RCNOW
"RTN","RCDPEAA3",123,0)
 S RCNOW=$$NOW^XLFDT() W !!,"REVIEW DATE/TIME: "_$$FMTE^XLFDT(RCNOW,"2")
"RTN","RCDPEAA3",124,0)
 S DA(2)=RCSCR,DA(1)=RCZ,X=RCNOW,DIC("DR")=".02////"_RCDUZ_";.03",DLAYGO=344.492,DIC(0)="L"
"RTN","RCDPEAA3",125,0)
 S DIC="^RCY(344.49,"_DA(2)_",1,"_DA(1)_",4,"
"RTN","RCDPEAA3",126,0)
 K DO,DD
"RTN","RCDPEAA3",127,0)
 D FILE^DICN K DO,DD,DIC,DLAYGO
"RTN","RCDPEAA3",128,0)
 S RCREV=+Y
"RTN","RCDPEAA3",129,0)
 I RCREV'>0 S RCREV=0 G NEWREVQ
"RTN","RCDPEAA3",130,0)
 I '$O(^RCY(344.49,DA(2),1,DA(1),4,RCREV,0)) S DIK="^RCY(344.49,"_DA(2)_",1,"_DA(1)_",4,",DA=RCREV D ^DIK S RCREV=0 ; No comment - delete entry
"RTN","RCDPEAA3",131,0)
 ;
"RTN","RCDPEAA3",132,0)
NEWREVQ Q RCREV
"RTN","RCDPEAA3",133,0)
 ;
"RTN","RCDPEAA3",134,0)
ADDUSER(RCSCR,RCDUZ) ; Add user record to user preferences multiple in file 344.49 and initialize all preferences
"RTN","RCDPEAA3",135,0)
 ; RCSCR = ien of entry in file 344.49
"RTN","RCDPEAA3",136,0)
 ; RCDUZ  = the ien of the user
"RTN","RCDPEAA3",137,0)
 N DIC,DA,X,Y,DLAYGO,DO,DD
"RTN","RCDPEAA3",138,0)
 S Y=+$O(^RCY(344.49,RCSCR,2,"B",RCDUZ,0))
"RTN","RCDPEAA3",139,0)
 I Y G ADDUQ
"RTN","RCDPEAA3",140,0)
 S DLAYGO=344.492,DA(1)=RCSCR,DIC(0)="L",X=RCDUZ,DIC="^RCY(344.49,"_DA(1)_",2,",DIC("DR")=".02////0;.03////N"
"RTN","RCDPEAA3",141,0)
 D FILE^DICN K DIC,DLAYGO
"RTN","RCDPEAA3",142,0)
ADDUQ Q $S(Y>0:Y,1:0)
"RTN","RCDPEAA3",143,0)
 ;
"RTN","RCDPEAA3",144,0)
PREOB(RCIENS) ; Print/View EOB detail
"RTN","RCDPEAA3",145,0)
 N RCDA,RCDAZ,Z,Z0
"RTN","RCDPEAA3",146,0)
 D FULL^VALM1
"RTN","RCDPEAA3",147,0)
 S RCDA=$P($G(^RCY(344.49,$P(RCIENS,U),1,$P(RCIENS,U,2),0)),U,9)
"RTN","RCDPEAA3",148,0)
 F RCDAZ=1:1:$L(RCDA,",") S RCDAZ(RCDAZ)=$P(RCDA,",",RCDAZ)
"RTN","RCDPEAA3",149,0)
 S Z=0 F  S Z=$O(RCDAZ(Z)) Q:'Z  D
"RTN","RCDPEAA3",150,0)
 . ;
"RTN","RCDPEAA3",151,0)
 . S Z0=RCDAZ(Z)
"RTN","RCDPEAA3",152,0)
 . I $E(Z0,1,3)="ADJ" D  Q
"RTN","RCDPEAA3",153,0)
 .. I $G(^RCY(344.4,RCSCR,2,+$P(Z0,"ADJ",2),0))'="" S RCDAZ(Z)="ADJ^"_+$P(Z0,"ADJ",2)
"RTN","RCDPEAA3",154,0)
 . ;
"RTN","RCDPEAA3",155,0)
 . S Z0=$G(^RCY(344.4,$P(RCIENS,U),1,+Z0,0))
"RTN","RCDPEAA3",156,0)
 . S RCDAZ(Z)=+Z0_U_$S($P(Z0,U,2):$P(Z0,U,2),1:-1) Q
"RTN","RCDPEAA3",157,0)
 ;
"RTN","RCDPEAA3",158,0)
 D VP^RCDPEWL2($P(RCIENS,U),.RCDAZ)
"RTN","RCDPEAA3",159,0)
 ;
"RTN","RCDPEAA3",160,0)
 S VALMBCK="R"
"RTN","RCDPEAA3",161,0)
 Q
"RTN","RCDPEAA3",162,0)
 ;
"RTN","RCDPEAA3",163,0)
VERIF(RCIENS) ;EP - Protocol action RCDPE APAR VERIFY
"RTN","RCDPEAA3",164,0)
 ; Entry point to verification options on APAR worklist
"RTN","RCDPEAA3",165,0)
 ; Input:   RCIENS  - Internal IEN of entry in file 344.49^ien of 
"RTN","RCDPEAA3",166,0)
 ;                    344.491^selectable line item from listman screen
"RTN","RCDPEAA3",167,0)
 N DIR,DIRUT,DTOUT,DUOUT,RCQUIT,X,Y
"RTN","RCDPEAA3",168,0)
 D FULL^VALM1
"RTN","RCDPEAA3",169,0)
 I '$D(^XUSEC("RCDPEPP",DUZ)) D  Q  ; PRCA*4.5*318 Added security key check
"RTN","RCDPEAA3",170,0)
 . S VALMBCK="R"
"RTN","RCDPEAA3",171,0)
 . W !!,"This action can only be taken by users that have the RCDPEPP security key.",!
"RTN","RCDPEAA3",172,0)
 . D PAUSE^VALM1
"RTN","RCDPEAA3",173,0)
 ;
"RTN","RCDPEAA3",174,0)
 W !!!!
"RTN","RCDPEAA3",175,0)
 S RCQUIT=0
"RTN","RCDPEAA3",176,0)
 F  D  Q:RCQUIT
"RTN","RCDPEAA3",177,0)
 . S DIR(0)="SAO^1:MANUAL VERIFICATION;2:REPORT UNVERIFIED DISCREPANCIES;3:QUIT"
"RTN","RCDPEAA3",178,0)
 . S DIR("A",1)="VERIFY EEOBs:"
"RTN","RCDPEAA3",179,0)
 . S DIR("A",2)="   1 MANUALLY MARK AS VERIFIED"
"RTN","RCDPEAA3",180,0)
 . S DIR("A",3)="   2 REPORT OF UNVERIFIED WITH DISCREPANCIES"
"RTN","RCDPEAA3",181,0)
 . S DIR("A",4)="   3 QUIT AND RETURN TO WORKLIST"
"RTN","RCDPEAA3",182,0)
 . S DIR("A")="Select Action: ",DIR("B")="QUIT" W ! D ^DIR K DIR
"RTN","RCDPEAA3",183,0)
 . I Y=3!(Y="")!$D(DUOUT)!$D(DTOUT) S RCQUIT=1 Q
"RTN","RCDPEAA3",184,0)
 . ;
"RTN","RCDPEAA3",185,0)
 . I Y=1 D MVER($P(RCIENS,U)) W !! Q
"RTN","RCDPEAA3",186,0)
 . ;
"RTN","RCDPEAA3",187,0)
 . I Y=2 D RPT^RCDPEV0($P(RCIENS,U)) W !! Q
"RTN","RCDPEAA3",188,0)
 ;
"RTN","RCDPEAA3",189,0)
 S VALMBCK="R"
"RTN","RCDPEAA3",190,0)
 Q
"RTN","RCDPEAA3",191,0)
 ;
"RTN","RCDPEAA3",192,0)
MVER(RCERA) ; Manually mark an EEOB as verified within APAR
"RTN","RCDPEAA3",193,0)
 ; subroutine cloned from the process that VERIFIES EEOBs off the standard worklist (MVER^RCDPEV)
"RTN","RCDPEAA3",194,0)
 ; but with specific changes to support APAR
"RTN","RCDPEAA3",195,0)
 ; this subroutine only needs to VERIFY one EEOB rather than a list of EEOBs
"RTN","RCDPEAA3",196,0)
 N A,CT,DA,DIE,DR,DTOUT,DUOUT,Z,Z0,Z1,RCT,RCY,RCY0,RCZ0,RCLINE,RCYNUM,DIR,X,Y,RESULT,SPLIT,Q,Q0,DT1,DT2
"RTN","RCDPEAA3",197,0)
 N VERIFIED
"RTN","RCDPEAA3",198,0)
 S (VERIFIED,RCT)=0,CT=1,Z0=""
"RTN","RCDPEAA3",199,0)
 ; get the EEOB entry ien to determine if already it's already been verified 
"RTN","RCDPEAA3",200,0)
 S Z1=$O(^TMP("RCDPE-EOB_WLDX",$J,"")) I Z1 S Z=^TMP("RCDPE-EOB_WLDX",$J,Z1)
"RTN","RCDPEAA3",201,0)
 ; grab the data belonging to the EEOB
"RTN","RCDPEAA3",202,0)
 I Z]"" S Z0=$G(^RCY(344.49,RCERA,1,+$P(Z,U,2),0))
"RTN","RCDPEAA3",203,0)
 ; get VERIFY data
"RTN","RCDPEAA3",204,0)
 I Z0'="",$P(Z0,U,13) S VERIFIED=1
"RTN","RCDPEAA3",205,0)
 I VERIFIED D  Q
"RTN","RCDPEAA3",206,0)
 . S DIR(0)="EA",DIR("A",1)="THIS EEOB IS ALREADY VERIFIED",DIR("A")="PRESS RETURN TO CONTINUE: " W ! D ^DIR K DIR
"RTN","RCDPEAA3",207,0)
 S RCY=+$P($G(^TMP("RCDPE-EOB_WLDX",$J,Z1)),U,2),RCLINE=+^(Z1),RCYNUM=Z1
"RTN","RCDPEAA3",208,0)
 S RCY0=$G(^RCY(344.49,RCERA,1,RCY,0))
"RTN","RCDPEAA3",209,0)
 S RCZ0=$G(^RCY(344.4,RCERA,1,+$P(RCY0,U,9),0))
"RTN","RCDPEAA3",210,0)
 I '$P(RCZ0,U,2) D
"RTN","RCDPEAA3",211,0)
 . W !!,"THIS LINE DOES NOT REFERENCE A VALID BILL"
"RTN","RCDPEAA3",212,0)
 E  D
"RTN","RCDPEAA3",213,0)
 . S RESULT=$$VER^RCDPEV(RCERA,+$G(^IBM(361.1,+$P(RCZ0,U,2),0)),+$P(RCY0,U,9),1)
"RTN","RCDPEAA3",214,0)
 . F Z=2:1:9 I $E($P(RESULT,U,Z))="*" S Q=$P(RESULT,U,Z),$E(Q,1)="",$P(RESULT,U,Z)=Q
"RTN","RCDPEAA3",215,0)
 . S SPLIT=$O(^RCY(344.49,RCERA,1,"B",+RCY0_".9999"),-1)'=(+RCY0_".0001")
"RTN","RCDPEAA3",216,0)
 . S Z=$S(SPLIT:"CLAIM #'s: ",1:"  CLAIM #: ")
"RTN","RCDPEAA3",217,0)
 . S Z=Z_$P(RCY0,U,2)_$S('SPLIT:"",1:" (ORIGINAL ERA DATA)")
"RTN","RCDPEAA3",218,0)
 . I SPLIT D
"RTN","RCDPEAA3",219,0)
 .. S Q=+RCY0 F  S Q=$O(^RCY(344.49,RCERA,1,"B",Q)) Q:(Q\1)'=+RCY0  S Q0=+$O(^RCY(344.49,RCERA,1,"B",Q,0)),Q0=$G(^RCY(344.49,RCERA,1,Q0,0)) I $P(Q0,U,2)'="" S Z=Z_" "_$P(Q0,U,2)
"RTN","RCDPEAA3",220,0)
 . W !!!,Z
"RTN","RCDPEAA3",221,0)
 . W !,?13,"PATIENT NAME"_$J("",18)_"  SUBMITTED AMT    SVC DATE(S)"
"RTN","RCDPEAA3",222,0)
 . W !,?13,"------------------------------  ---------------  -----------------"
"RTN","RCDPEAA3",223,0)
 . S DT1=$E($S($P(RESULT,U,7):$$FMTE^XLFDT($P(RESULT,U,7),"2D"),1:"NOTFOUND")_$J("",8),1,8)
"RTN","RCDPEAA3",224,0)
 . S DT2=$E($S($P(RESULT,U,9):"-"_$$FMTE^XLFDT($P(RESULT,U,9),"2D"),1:"-NOTFOUND")_$J("",9),1,9)
"RTN","RCDPEAA3",225,0)
 . W !,"   ERA DATA: ",$E($P(RESULT,U,3)_$J("",30),1,30),"  ",$E($J($P(RESULT,U,5),"",2)_$J("",15),1,15)_"  "_DT1_DT2
"RTN","RCDPEAA3",226,0)
 . W !,?15,$P($G(^RCY(344,RCERA,0)),U,6)
"RTN","RCDPEAA3",227,0)
 . S DT1=$E($S($P(RESULT,U,6):$$FMTE^XLFDT($P(RESULT,U,6),"2D"),1:"NOTFOUND")_$J("",8),1,8)
"RTN","RCDPEAA3",228,0)
 . S DT2=$E($S($P(RESULT,U,8):"-"_$$FMTE^XLFDT($P(RESULT,U,8),"2D"),1:"-NOTFOUND")_$J("",9),1,9)
"RTN","RCDPEAA3",229,0)
 . W !,"  BILL DATA: "_$E($P(RESULT,U,2)_$J("",30),1,30)_"  "_$E($J($P(RESULT,U,4),"",2)_$J("",15),1,15)_"  "_DT1_DT2
"RTN","RCDPEAA3",230,0)
 . W !,?15,$P($G(^DIC(36,+$P(RCZ0,U,4),0)),U),!
"RTN","RCDPEAA3",231,0)
 S DIR(0)="YA",DIR("A")="DO YOU WANT TO MARK THIS LINE VERIFIED? ",DIR("B")="NO" W ! D ^DIR K DIR
"RTN","RCDPEAA3",232,0)
 ;
"RTN","RCDPEAA3",233,0)
 I Y'=1 Q
"RTN","RCDPEAA3",234,0)
 S DA(1)=RCERA,DA=+RCY,DIE="^RCY(344.49,"_DA(1)_",1,",DR=".13////1" D ^DIE
"RTN","RCDPEAA3",235,0)
 S A=$$TOPLINE^RCDPEWL1($G(^RCY(344.49,RCERA,1,+RCY,0)),RCYNUM)
"RTN","RCDPEAA3",236,0)
 S ^TMP("RCDPE-EOB_WL",$J,RCLINE,0)=A
"RTN","RCDPEAA3",237,0)
 Q
"RTN","RCDPEAA3",238,0)
 ;
"RTN","RCDPEAA3",239,0)
 ;PRCA*4.5*304 - add a claim comment to the ERA detail line from APAR
"RTN","RCDPEAA3",240,0)
COMNT ;
"RTN","RCDPEAA3",241,0)
 N IEN,SEQ,DA,DIR,DTOUT,DUOUT,X,Y,DIRUT,DIROUT,ZDA,ZBILL,RCOMMENT,TCOMM
"RTN","RCDPEAA3",242,0)
 S RCOMMENT=0
"RTN","RCDPEAA3",243,0)
 S IEN=+$P(RCIENS,U,1)
"RTN","RCDPEAA3",244,0)
 ; Validate the selection
"RTN","RCDPEAA3",245,0)
 I IEN=0 D  G COMQ
"RTN","RCDPEAA3",246,0)
 . W !,"Cannot comment, no record in file ELECTRONIC REMITTANCE ADVICE file selected." D WAIT^VALM1
"RTN","RCDPEAA3",247,0)
 S SEQ=$P(^RCY(344.49,IEN,1,+$P(RCIENS,U,2),0),U,9) ; Just grab the first sequence number for the comment.
"RTN","RCDPEAA3",248,0)
 I $G(SEQ)="" D  G COMQ
"RTN","RCDPEAA3",249,0)
 . W !,"Cannot comment, no ERA detail record selected." D WAIT^VALM1
"RTN","RCDPEAA3",250,0)
 I $G(^RCY(344.4,IEN,1,SEQ,0))']"" D  G COMQ
"RTN","RCDPEAA3",251,0)
 . W !,"Cannot comment, ERA detail record selected not found." D WAIT^VALM1
"RTN","RCDPEAA3",252,0)
 ;
"RTN","RCDPEAA3",253,0)
 ; Allow user to put comment on this ERA Detail record
"RTN","RCDPEAA3",254,0)
 S ZDA=SEQ,ZDA(1)=IEN,ZBILL=$P($$GETBILL^RCDPESR0(.ZDA),"-",2)
"RTN","RCDPEAA3",255,0)
 W !,"Enter a comment on ERA #"_IEN_"  ERA Detail Seq #",SEQ,"  Bill #",ZBILL,!
"RTN","RCDPEAA3",256,0)
 S DIE="^RCY(344.4,"_IEN_",1,",DA=SEQ,DA(1)=IEN,DR="4Comment" D ^DIE G:$D(DTOUT)!$D(Y) COMQ
"RTN","RCDPEAA3",257,0)
 ; Now file user (DUZ) and DATE
"RTN","RCDPEAA3",258,0)
 K DR
"RTN","RCDPEAA3",259,0)
 ; If DA is not defined then the user deleted the comment with an @,
"RTN","RCDPEAA3",260,0)
 ; Delete the user and date too.
"RTN","RCDPEAA3",261,0)
 S TCOMM=$$GET1^DIQ(344.41,SEQ_","_IEN_",",4,"E")
"RTN","RCDPEAA3",262,0)
 I TCOMM="" S DA=SEQ,DA(1)=IEN,DR="4.01////@;4.02////@;"
"RTN","RCDPEAA3",263,0)
 E  S DR="4.01////"_$$DT^XLFDT_";4.02////"_$G(DUZ)_";"
"RTN","RCDPEAA3",264,0)
 D ^DIE
"RTN","RCDPEAA3",265,0)
 S RCOMMENT=1
"RTN","RCDPEAA3",266,0)
 D WAIT^VALM1
"RTN","RCDPEAA3",267,0)
 ;
"RTN","RCDPEAA3",268,0)
COMQ I RCOMMENT D INIT^RCDPEAA2(RCIENS) ; 
"RTN","RCDPEAA3",269,0)
 S VALMBCK="R"
"RTN","RCDPEAA3",270,0)
 Q
"RTN","RCDPEAD")
0^25^B86618636^B51253087
"RTN","RCDPEAD",1,0)
RCDPEAD ;ALB/PJH - AUTO DECREASE ;Jun 06, 2014@19:11:19
"RTN","RCDPEAD",2,0)
 ;;4.5;Accounts Receivable;**298,304,318**;Mar 20, 1995;Build 37
"RTN","RCDPEAD",3,0)
 ;Per VA Directive 6402, this routine should not be modified.
"RTN","RCDPEAD",4,0)
 ;Read ^IBM(361.1) via Private IA 4051
"RTN","RCDPEAD",5,0)
 ;
"RTN","RCDPEAD",6,0)
EN ;Auto Decrease - applies to auto-posted claims only
"RTN","RCDPEAD",7,0)
 N RCAMT,RCDATE,RCDAY,RCSTART,RCITEM
"RTN","RCDPEAD",8,0)
 N RC344610,RCMDAP,RCMDAD,RCJ,RCK,RCIARR,J
"RTN","RCDPEAD",9,0)
 ;
"RTN","RCDPEAD",10,0)
 ; Quit if medical auto posting is OFF or medical auto decrease is OFF
"RTN","RCDPEAD",11,0)
 Q:'$P($G(^RCY(344.61,1,0)),U,2)  Q:'$P($G(^RCY(344.61,1,0)),U,3)
"RTN","RCDPEAD",12,0)
 ;
"RTN","RCDPEAD",13,0)
 ; Get the RCDPE PARAMETER file #344.61 field.04 AUTO DECREASE MED DAYS DEFAULT value and
"RTN","RCDPEAD",14,0)
 ; calculate process date by subtracting this value from today's date
"RTN","RCDPEAD",15,0)
 S RCDAY=$$FMADD^XLFDT(DT\1,-$P($G(^RCY(344.61,1,0)),U,4))
"RTN","RCDPEAD",16,0)
 ;
"RTN","RCDPEAD",17,0)
 ; PRCA*4.5*304 - removed generic auto-decrease amount. Now auto-decrease is by CARC
"RTN","RCDPEAD",18,0)
 ; Allow for a range of dates in future - currently only checks for RCDAY
"RTN","RCDPEAD",19,0)
 ;
"RTN","RCDPEAD",20,0)
 ; Scan F index for ERA within date range
"RTN","RCDPEAD",21,0)
 S RCDATE=$$FMADD^XLFDT(RCDAY,-1)
"RTN","RCDPEAD",22,0)
 F  S RCDATE=$O(^RCY(344.4,"F",RCDATE)) Q:'RCDATE  Q:(RCDATE\1)>RCDAY  D
"RTN","RCDPEAD",23,0)
 . ;
"RTN","RCDPEAD",24,0)
 . ; Scan "F" index of ERA file for ERA entries with AUTOPOST DATE field #4.03 matching RCDAY
"RTN","RCDPEAD",25,0)
 . D EN2(RCDATE,RCDAY)
"RTN","RCDPEAD",26,0)
 Q
"RTN","RCDPEAD",27,0)
 ;
"RTN","RCDPEAD",28,0)
EN2(RCDATE,RCDAY) ; Scans the 'F' index of the ERA file for ERA entries with an
"RTN","RCDPEAD",29,0)
 ; AUTOPOST DATE field (#4.03) matching RCDAY
"RTN","RCDPEAD",30,0)
 ; Input:   RCDATE      - Current date being search
"RTN","RCDPEAD",31,0)
 ;          RCDAY       - AUTO DECREATES MED DAYS DEFAULT (File 344.61, field .04)
"RTN","RCDPEAD",32,0)
 N PAYID,PAYNAM,RCERA,RCRTYPE
"RTN","RCDPEAD",33,0)
 S RCERA=0
"RTN","RCDPEAD",34,0)
 F  S RCERA=$O(^RCY(344.4,"F",RCDATE,RCERA)) Q:'RCERA  D
"RTN","RCDPEAD",35,0)
 . N RC3446,RCPARM
"RTN","RCDPEAD",36,0)
 . ;
"RTN","RCDPEAD",37,0)
 . ; Quit if ERA is for Pharmacy
"RTN","RCDPEAD",38,0)
 . S RCRTYPE=$$PHARM^RCDPEAP1(RCERA)
"RTN","RCDPEAD",39,0)
 . Q:RCRTYPE
"RTN","RCDPEAD",40,0)
 . ;
"RTN","RCDPEAD",41,0)
 . ; Check payer exclusion file for this ERA's payer
"RTN","RCDPEAD",42,0)
 . S PAYID=$P($G(^RCY(344.4,RCERA,0)),U,3)
"RTN","RCDPEAD",43,0)
 . S PAYNAM=$P($G(^RCY(344.4,RCERA,0)),U,6)
"RTN","RCDPEAD",44,0)
 . I PAYID'="",PAYNAM'="" D
"RTN","RCDPEAD",45,0)
 . . S RCPARM=$O(^RCY(344.6,"CPID",PAYNAM,PAYID,""))
"RTN","RCDPEAD",46,0)
 . . S:RCPARM'="" RC3446=$G(^RCY(344.6,RCPARM,0))
"RTN","RCDPEAD",47,0)
 . ;
"RTN","RCDPEAD",48,0)
 . ; Ignore ERA if EXCLUDE MED CLAIMS POSTING  (#.06) or
"RTN","RCDPEAD",49,0)
 . ; EXCLUDE MED CLAIMS DECREASE (#.07) fields set to 'yes'
"RTN","RCDPEAD",50,0)
 . I $G(RC3446)'="" Q:$P(RC3446,U,6)=1  Q:$P(RC3446,U,7)=1
"RTN","RCDPEAD",51,0)
 . ; 
"RTN","RCDPEAD",52,0)
 . ; Build index to scratchpad for this ERA
"RTN","RCDPEAD",53,0)
 . N RCARRAY
"RTN","RCDPEAD",54,0)
 . D BUILD^RCDPEAP(RCERA,.RCARRAY)
"RTN","RCDPEAD",55,0)
 . ;
"RTN","RCDPEAD",56,0)
 . ; Scan ERA DETAIL entries in #344.41 for auto-posted medical claims
"RTN","RCDPEAD",57,0)
 . D EN3(RCDATE,RCERA)
"RTN","RCDPEAD",58,0)
 Q
"RTN","RCDPEAD",59,0)
 ;
"RTN","RCDPEAD",60,0)
EN3(RCDATE,RCERA) ; Scan ERA DETAIL entries in #344.41 for auto-posted medical claims
"RTN","RCDPEAD",61,0)
 ; Input:   RCDATE      - Current date being search
"RTN","RCDPEAD",62,0)
 ;          RCERA       - ERA number
"RTN","RCDPEAD",63,0)
 N RCADJ,RCDREC,RCLINE
"RTN","RCDPEAD",64,0)
 S RCLINE=0
"RTN","RCDPEAD",65,0)
 F  S RCLINE=$O(^RCY(344.4,"F",RCDATE,RCERA,RCLINE)) Q:'RCLINE  D
"RTN","RCDPEAD",66,0)
 . ; 
"RTN","RCDPEAD",67,0)
 . ; Ignore claim line if already auto decreased
"RTN","RCDPEAD",68,0)
 . Q:$P($G(^RCY(344.4,RCERA,1,RCLINE,5)),U,3)
"RTN","RCDPEAD",69,0)
 . ;
"RTN","RCDPEAD",70,0)
 . ; Get record detail
"RTN","RCDPEAD",71,0)
 . S RCDREC=$G(^RCY(344.4,RCERA,1,RCLINE,0))
"RTN","RCDPEAD",72,0)
 . ;
"RTN","RCDPEAD",73,0)
 . ; Get claim number RCBILL for the ERA line using EOB #361.1 pointer
"RTN","RCDPEAD",74,0)
 . N COMMENT,EOBIEN,RCBAL,RCBILL,RCTRANDA
"RTN","RCDPEAD",75,0)
 . ;
"RTN","RCDPEAD",76,0)
 . ; Get pointer to EOB file #361.1 from ERA DETAIL
"RTN","RCDPEAD",77,0)
 . S EOBIEN=$P($G(^RCY(344.4,RCERA,1,RCLINE,0)),U,2),RCBILL=0
"RTN","RCDPEAD",78,0)
 . ;
"RTN","RCDPEAD",79,0)
 . ; Get ^DGCR(399 pointer (DINUM for #430 file)
"RTN","RCDPEAD",80,0)
 . S:EOBIEN RCBILL=$P($G(^IBM(361.1,EOBIEN,0)),U) Q:'RCBILL
"RTN","RCDPEAD",81,0)
 . ;
"RTN","RCDPEAD",82,0)
 . ; If claim has been split/edit and claim changed in APAR do not auto decrease
"RTN","RCDPEAD",83,0)
 . Q:$$SPLIT(RCERA,RCLINE,RCBILL,.RCARRAY)
"RTN","RCDPEAD",84,0)
 . ;
"RTN","RCDPEAD",85,0)
 . ; Do not auto decrease if claim is referred to General Council
"RTN","RCDPEAD",86,0)
 . Q:$P($G(^PRCA(430,RCBILL,6)),U,4)]""
"RTN","RCDPEAD",87,0)
 . ;
"RTN","RCDPEAD",88,0)
 . ; Claim must be OPEN or ACTIVE
"RTN","RCDPEAD",89,0)
 . N STATUS
"RTN","RCDPEAD",90,0)
 . S STATUS=$P($G(^PRCA(430,RCBILL,0)),"^",8)
"RTN","RCDPEAD",91,0)
 . I STATUS'=42,STATUS'=16 Q 
"RTN","RCDPEAD",92,0)
 . ;
"RTN","RCDPEAD",93,0)
 . ; PRCA*4.5*304 - A CARC must be included and have an auto-decrease limit before auto-decreasing can occur.
"RTN","RCDPEAD",94,0)
 . S RCAMT=$$CARCLMT(EOBIEN)
"RTN","RCDPEAD",95,0)
 . Q:$L(RCAMT)=0         ; No CARCs on EOB were eligible for auto-decrease
"RTN","RCDPEAD",96,0)
 . ;
"RTN","RCDPEAD",97,0)
 . ; Order CARCs for Auto-Decrease in largest to smallest amount order
"RTN","RCDPEAD",98,0)
 . K RCIARR
"RTN","RCDPEAD",99,0)
 . F J=1:1 S RCITEM=$P(RCAMT,U,J) Q:RCITEM=""  S RCIARR(-($P(RCITEM,";",1)),J)=RCITEM
"RTN","RCDPEAD",100,0)
 . Q:$D(RCIARR)<10  ; Quit if CARC adjustment array doesn't have any elements to process
"RTN","RCDPEAD",101,0)
 . ;
"RTN","RCDPEAD",102,0)
 . ; Walk the RCIARR and apply CARC based adjustments to the bill.
"RTN","RCDPEAD",103,0)
 . S RCJ="",RCADJ=0
"RTN","RCDPEAD",104,0)
 . F  S RCJ=$O(RCIARR(RCJ)) Q:RCJ=""  S RCK="" F  S RCK=$O(RCIARR(RCJ,RCK)) Q:RCK=""  D
"RTN","RCDPEAD",105,0)
 . . ; Get current balance on Bill
"RTN","RCDPEAD",106,0)
 . . S RCBAL=$P($G(^PRCA(430,RCBILL,7)),U)
"RTN","RCDPEAD",107,0)
 . . ;
"RTN","RCDPEAD",108,0)
 . . ; Check pending payment amount and bill balance 
"RTN","RCDPEAD",109,0)
 . . N PENDING
"RTN","RCDPEAD",110,0)
 . . S PENDING=$$PENDPAY^RCDPURET(RCBILL)
"RTN","RCDPEAD",111,0)
 . . K ^TMP($J,"RCDPUREC","PP")
"RTN","RCDPEAD",112,0)
 . . Q:(RCBAL-PENDING)<(+$P(RCIARR(RCJ,RCK),";",1))
"RTN","RCDPEAD",113,0)
 . . ;
"RTN","RCDPEAD",114,0)
 . . ; Add comment
"RTN","RCDPEAD",115,0)
 . . S COMMENT(1)="MEDICAL AUTO-DECREASE FOR CARC: "_$P(RCIARR(RCJ,RCK),";",2)_" AMOUNT: "_+$P(RCIARR(RCJ,RCK),";",1)_" (MAX DEC: "_+$P($$ACTCARC($P(RCIARR(RCJ,RCK),";",2)),U,2)_")"
"RTN","RCDPEAD",116,0)
 . . ; If this CARC is expired then add that information to the comment
"RTN","RCDPEAD",117,0)
 . . I $P(RCIARR(RCJ,RCK),";",3)'="" S COMMENT(1)=COMMENT(1)_" CARC expired on "_$$FMTE^XLFDT($P(RCIARR(RCJ,RCK),";",3),"6D")
"RTN","RCDPEAD",118,0)
 . . ; Apply contract adjustment for CARC adjustment amount from claim information
"RTN","RCDPEAD",119,0)
 . . S RCTRANDA=$$INCDEC^RCBEUTR1(RCBILL,-$P(RCIARR(RCJ,RCK),";",1),.COMMENT,"","",1) Q:'RCTRANDA
"RTN","RCDPEAD",120,0)
 . . ; Update total adjustments for line
"RTN","RCDPEAD",121,0)
 . . S RCADJ=RCADJ+$P(RCIARR(RCJ,RCK),";",1)
"RTN","RCDPEAD",122,0)
 . ; Update auto-decrease indicator, auto decrease amount and auto decrease date
"RTN","RCDPEAD",123,0)
 . N DA,DIE,DR S DA(1)=RCERA,DA=RCLINE,DIE="^RCY(344.4,"_DA(1)_",1,",DR="7///1;8///"_RCADJ_";10///"_DT D ^DIE
"RTN","RCDPEAD",124,0)
 . ; PRCA*4.5*304 - End of updates
"RTN","RCDPEAD",125,0)
 . ; Update last auto decrease date on ERA
"RTN","RCDPEAD",126,0)
 . N DA,DIE,DR S DA=RCERA,DIE="^RCY(344.4,",DR="4.03///"_DT D ^DIE
"RTN","RCDPEAD",127,0)
 Q
"RTN","RCDPEAD",128,0)
 ;
"RTN","RCDPEAD",129,0)
SPLIT(RCSCR,RCLINE,RCBILL,RCARRAY) ;Check for SPLIT/EDIT in scratchpad
"RTN","RCDPEAD",130,0)
 ;Input RCSCR - IEN of #344.49
"RTN","RCDPEAD",131,0)
 ;      RCLINE - ERA detail line sequence number
"RTN","RCDPEAD",132,0)
 ;      RCBILL - IEN of #430
"RTN","RCDPEAD",133,0)
 ;      ARRAY - reference to passed array (from BUILD^RCDPEAP)
"RTN","RCDPEAD",134,0)
 ;Output return value 1/0 = Split/Not Split 
"RTN","RCDPEAD",135,0)
 N SUB,SUB1
"RTN","RCDPEAD",136,0)
 ;Find ERA line in scratchpad
"RTN","RCDPEAD",137,0)
 S SUB=$G(RCARRAY(RCLINE)) Q:'SUB 0
"RTN","RCDPEAD",138,0)
 ;Get n.001 line
"RTN","RCDPEAD",139,0)
 S SUB1=$O(^RCY(344.49,RCSCR,1,SUB)) Q:'SUB1 0
"RTN","RCDPEAD",140,0)
 ;Check sequence number is the same
"RTN","RCDPEAD",141,0)
 Q:$P($G(^RCY(344.49,RCSCR,1,SUB1,0)),".")'=$P($G(^RCY(344.49,RCSCR,1,SUB,0)),U) 0
"RTN","RCDPEAD",142,0)
 ;Check that claim number is unchanged from original ERA
"RTN","RCDPEAD",143,0)
 Q:$P($G(^RCY(344.49,RCSCR,1,SUB1,0)),U,7)=RCBILL 0
"RTN","RCDPEAD",144,0)
 ;Otherwise claim was edited (and should not be decreased)
"RTN","RCDPEAD",145,0)
 Q 1
"RTN","RCDPEAD",146,0)
 ;
"RTN","RCDPEAD",147,0)
CARCLMT(RCEOB,FROMADP,ADATE) ;EP from COMPILE^RCDPEADP
"RTN","RCDPEAD",148,0)
 ; PRCA*4.5*304 - Check to see if CARC are included and are eligible
"RTN","RCDPEAD",149,0)
 ; for auto-decrease. Return 0 if not, Max Amount ^ CARC if it is.
"RTN","RCDPEAD",150,0)
 ; Input:   RCEOB   - Internal IEN for the explanation of benefits field (361.1)
"RTN","RCDPEAD",151,0)
 ;          FROMADP - 1 if being called from COMPILE^RCDPEADP, 0 otherwise
"RTN","RCDPEAD",152,0)
 ;                    Optional, default to 0
"RTN","RCDPEAD",153,0)
 ;          ADATE   - Internal Auto-Post Date (only passed if FROMADP=1)
"RTN","RCDPEAD",154,0)
 ; Returns: A1;A2;A3;A4^B1;B2;B3;B4^...^N1;N2;N3;N4 Where:
"RTN","RCDPEAD",155,0)
 ;           A1 - Auto-Decrease amount of the 1st CARC code in the EOB
"RTN","RCDPEAD",156,0)
 ;           A2 - 1st CARC code in the EOB
"RTN","RCDPEAD",157,0)
 ;           A3 - Deactivation Date of the 1st CARC code in the EOB if
"RTN","RCDPEAD",158,0)
 ;                it has one and is less than today AND FROMADP=0
"RTN","RCDPEAD",159,0)
 ;                Otherwise Quantity of the first CARC code in the EOB if
"RTN","RCDPEAD",160,0)
 ;                FROMADP=1
"RTN","RCDPEAD",161,0)
 ;           A4 - Reason of the 1st CARC code in the EOB
"RTN","RCDPEAD",162,0)
 ;                only passed if FROMADP=1
"RTN","RCDPEAD",163,0)
 N I,RCAMT,RCCAMT,RCCODE,RCCODES,RCDATA,RCITEM,RCTAMT,XDT,XIEN
"RTN","RCDPEAD",164,0)
 S:'$D(FROMADP) FROMADP=0
"RTN","RCDPEAD",165,0)
 S RCAMT="",RCCODES=""
"RTN","RCDPEAD",166,0)
 ;
"RTN","RCDPEAD",167,0)
 ; Extract the CARC codes from the EOB.
"RTN","RCDPEAD",168,0)
 ; Returned are ^A1;A2;A3;A4^A1;A2;A3;A4^... Where
"RTN","RCDPEAD",169,0)
 ;                 A1 - CARC code
"RTN","RCDPEAD",170,0)
 ;                 A2 - Auto Decrease Amount
"RTN","RCDPEAD",171,0)
 ;                 A3 - Quantity       (only returned if FROMADP=1)
"RTN","RCDPEAD",172,0)
 ;                 A4 - REASON         (only returned if FROMADP=1)
"RTN","RCDPEAD",173,0)
 D GETCARCS(RCEOB,.RCCODES,FROMADP)
"RTN","RCDPEAD",174,0)
 ;
"RTN","RCDPEAD",175,0)
 ; Loop through all of the CARC codes found.  If none, it will exit.
"RTN","RCDPEAD",176,0)
 F I=2:1:$L(RCCODES,"^") D
"RTN","RCDPEAD",177,0)
 . S RCITEM=$P(RCCODES,"^",I)
"RTN","RCDPEAD",178,0)
 . Q:RCITEM=""
"RTN","RCDPEAD",179,0)
 . S RCCODE=$P(RCITEM,";",1),RCCAMT=$P(RCITEM,";",2)
"RTN","RCDPEAD",180,0)
 . ;
"RTN","RCDPEAD",181,0)
 . ; Quit If the Adjustment amount is a negative amount
"RTN","RCDPEAD",182,0)
 . Q:+RCCAMT<0
"RTN","RCDPEAD",183,0)
 . ;
"RTN","RCDPEAD",184,0)
 . ; Look up code in CARC table and get max adjustment
"RTN","RCDPEAD",185,0)
 . S RCDATA=$$ACTCARC(RCCODE)
"RTN","RCDPEAD",186,0)
 . ;
"RTN","RCDPEAD",187,0)
 . ; Quit If auto decrease is not active on this code
"RTN","RCDPEAD",188,0)
 . Q:+RCDATA=0
"RTN","RCDPEAD",189,0)
 . ;
"RTN","RCDPEAD",190,0)
 . ; Get code inactive date if it exists
"RTN","RCDPEAD",191,0)
 . S XIEN=$$FIND1^DIC(345,,"O",RCCODE)
"RTN","RCDPEAD",192,0)
 . S:$G(XIEN)'="" XDT=$$GET1^DIQ(345,XIEN_",",2,"I")
"RTN","RCDPEAD",193,0)
 . I $G(XDT)'="" S:XDT'<DT XDT=""
"RTN","RCDPEAD",194,0)
 . S RCTAMT=$P(RCDATA,U,2)                  ; Get limit
"RTN","RCDPEAD",195,0)
 . ;
"RTN","RCDPEAD",196,0)
 . ; 11/11/2015: Compare the max adjustment in parameters to the adjustment on EEOB
"RTN","RCDPEAD",197,0)
 . ; Quit if over 
"RTN","RCDPEAD",198,0)
 . ;
"RTN","RCDPEAD",199,0)
 . ; If the CARC payer adjustment <= CARC max adjustment amount, Then add to list
"RTN","RCDPEAD",200,0)
 . ; for possible adjustments.
"RTN","RCDPEAD",201,0)
 . I RCCAMT<(RCTAMT+.01) D
"RTN","RCDPEAD",202,0)
 . . ;
"RTN","RCDPEAD",203,0)
 . . ; If we're being called from the auto-decrease report, return all CARC information
"RTN","RCDPEAD",204,0)
 . . I FROMADP D  Q
"RTN","RCDPEAD",205,0)
 . . . S XX=RCCAMT_";"_RCCODE_";"_$P(RCITEM,";",3,4)
"RTN","RCDPEAD",206,0)
 . . . S RCAMT=$S(RCAMT'[";":XX,1:RCAMT_"^"_XX)
"RTN","RCDPEAD",207,0)
 . . S RCAMT=$S($L(RCAMT)=0:RCCAMT_";"_RCCODE_";"_XDT,1:RCAMT_U_RCCAMT_";"_RCCODE_";"_XDT)
"RTN","RCDPEAD",208,0)
 Q RCAMT
"RTN","RCDPEAD",209,0)
 ;
"RTN","RCDPEAD",210,0)
GETCARCS(RCEOB,RCCODES,FROMADP) ; Extract the CARCs from an EOB at claim and line levels
"RTN","RCDPEAD",211,0)
 ; Input:   RCEOB   - Internal IEN for the explanation of benefits field (361.1)
"RTN","RCDPEAD",212,0)
 ;          FROMADP - 1 if being called from COMPILE^RCDPEAD1, 0 otherwise
"RTN","RCDPEAD",213,0)
 ;                    Optional, default to 0
"RTN","RCDPEAD",214,0)
 ; Output:  RCCODES - ^ delimitted string of CARC code information from the
"RTN","RCDPEAD",215,0)
 ;                      claim and claim ine levels for the specified EOB
"RTN","RCDPEAD",216,0)
 ;                      ^A1;A2;A3;A4^A1;A2;A3;A4^... Where
"RTN","RCDPEAD",217,0)
 ;                        A1 - CARC code
"RTN","RCDPEAD",218,0)
 ;                        A2 - Auto Decrease Amount
"RTN","RCDPEAD",219,0)
 ;                        A3 - Quantity       (only returned if FROMADP=1)
"RTN","RCDPEAD",220,0)
 ;                        A4 - REASON         (only returned if FROMADP=1)
"RTN","RCDPEAD",221,0)
 N IENS,RCAMT,QUANT,REASON,RCCODE,RCI,RCJ,RCL
"RTN","RCDPEAD",222,0)
 S:'$D(FROMADP) FROMADP=0
"RTN","RCDPEAD",223,0)
 S RCI=0,RCCODES=""
"RTN","RCDPEAD",224,0)
 ;
"RTN","RCDPEAD",225,0)
 ; Get to the Codes at the claim level
"RTN","RCDPEAD",226,0)
 F  D  Q:'RCI
"RTN","RCDPEAD",227,0)
 . S RCI=$O(^IBM(361.1,RCEOB,10,RCI))
"RTN","RCDPEAD",228,0)
 . Q:'RCI
"RTN","RCDPEAD",229,0)
 . S RCJ=0
"RTN","RCDPEAD",230,0)
 . F  D  Q:'RCJ
"RTN","RCDPEAD",231,0)
 . . S RCJ=$O(^IBM(361.1,RCEOB,10,RCI,1,RCJ))
"RTN","RCDPEAD",232,0)
 . . Q:'RCJ
"RTN","RCDPEAD",233,0)
 . . S IENS=RCJ_","_RCI_","_RCEOB_","
"RTN","RCDPEAD",234,0)
 . . S RCCODE=$$GET1^DIQ(361.111,IENS,.01,"I") ; CARC Code
"RTN","RCDPEAD",235,0)
 . . Q:RCCODE=""
"RTN","RCDPEAD",236,0)
 . . S RCAMT=$$GET1^DIQ(361.111,IENS,.02,"I")  ; CARC Amount
"RTN","RCDPEAD",237,0)
 . . I 'FROMADP S RCCODES=RCCODES_"^"_RCCODE_";"_RCAMT Q
"RTN","RCDPEAD",238,0)
 . . S QUANT=$$GET1^DIQ(361.111,IENS,.03,"I")  ; CARC Quantity
"RTN","RCDPEAD",239,0)
 . . S REASON=$$GET1^DIQ(361.111,IENS,.04,"I") ; CARC Reason
"RTN","RCDPEAD",240,0)
 . . S:$L(REASON)>30 REASON=$E(REASON,1,27)_"..."
"RTN","RCDPEAD",241,0)
 . . S RCCODES=RCCODES_"^"_RCCODE_";"_RCAMT_";"_QUANT_";"_REASON
"RTN","RCDPEAD",242,0)
 ;
"RTN","RCDPEAD",243,0)
 ; Get Claim Line level CARCs
"RTN","RCDPEAD",244,0)
 S RCL=0
"RTN","RCDPEAD",245,0)
 F  D  Q:+RCL=0
"RTN","RCDPEAD",246,0)
 . S RCL=$O(^IBM(361.1,RCEOB,15,RCL))
"RTN","RCDPEAD",247,0)
 . Q:+RCL=0
"RTN","RCDPEAD",248,0)
 . S RCI=0
"RTN","RCDPEAD",249,0)
 . F  D  Q:+RCI=0
"RTN","RCDPEAD",250,0)
 . . S RCI=$O(^IBM(361.1,RCEOB,15,RCL,1,RCI))
"RTN","RCDPEAD",251,0)
 . . Q:+RCI=0
"RTN","RCDPEAD",252,0)
 . . S RCJ=0
"RTN","RCDPEAD",253,0)
 . . F  D  Q:+RCJ=0
"RTN","RCDPEAD",254,0)
 . . . S RCJ=$O(^IBM(361.1,RCEOB,15,RCL,1,RCI,1,RCJ))
"RTN","RCDPEAD",255,0)
 . . . Q:+RCJ=0
"RTN","RCDPEAD",256,0)
 . . . S IENS=RCJ_","_RCI_","_RCL_","_RCEOB_","
"RTN","RCDPEAD",257,0)
 . . . S RCCODE=$$GET1^DIQ(361.11511,IENS,.01,"I") ; CARC Code
"RTN","RCDPEAD",258,0)
 . . . Q:RCCODE=""
"RTN","RCDPEAD",259,0)
 . . . S RCAMT=$$GET1^DIQ(361.11511,IENS,.02,"I")  ; CARC Amount
"RTN","RCDPEAD",260,0)
 . . . I 'FROMADP S RCCODES=RCCODES_"^"_RCCODE_";"_RCAMT Q
"RTN","RCDPEAD",261,0)
 . . . S QUANT=$$GET1^DIQ(361.11511,IENS,.03,"I")  ; CARC Quantity
"RTN","RCDPEAD",262,0)
 . . . S REASON=$$GET1^DIQ(361.11511,IENS,.04,"I") ; CARC Reason
"RTN","RCDPEAD",263,0)
 . . . S:$L(REASON)>30 REASON=$E(REASON,1,27)_"..."
"RTN","RCDPEAD",264,0)
 . . . S RCCODES=RCCODES_"^"_RCCODE_";"_RCAMT_";"_QUANT_";"_REASON
"RTN","RCDPEAD",265,0)
 Q
"RTN","RCDPEAD",266,0)
 ;
"RTN","RCDPEAD",267,0)
 ; PRCA*4.5*304 - Added function
"RTN","RCDPEAD",268,0)
ACTCARC(CODE) ; Is this CARC an active code for auto-decrease
"RTN","RCDPEAD",269,0)
 ; Input:   CODE    - CARC code being checked
"RTN","RCDPEAD",270,0)
 ; Returns: '0^NOT ACTIVE' if not active
"RTN","RCDPEAD",271,0)
 ;          '1^{amount}' if active and the second peice is the decrease amount
"RTN","RCDPEAD",272,0)
 N AIEN,XX
"RTN","RCDPEAD",273,0)
 I $G(CODE)="" Q "0^NOT ACTIVE"
"RTN","RCDPEAD",274,0)
 S AIEN=$O(^RCY(344.62,"B",CODE,""))
"RTN","RCDPEAD",275,0)
 I AIEN="" Q "0^NOT ACTIVE"
"RTN","RCDPEAD",276,0)
 S XX=$$GET1^DIQ(344.62,AIEN,.02,"I")       ; Quit if auto-decrease is off
"RTN","RCDPEAD",277,0)
 I XX=1 Q "1^"_$$GET1^DIQ(344.62,AIEN,.06)  ; Active code returns maximum allowed decrease amount
"RTN","RCDPEAD",278,0)
 Q "0^NOT ACTIVE"
"RTN","RCDPEAD",279,0)
 ;
"RTN","RCDPEAD1")
0^26^B67869816^n/a
"RTN","RCDPEAD1",1,0)
RCDPEAD1 ;OIFO-BAYPINES/PJH - AUTO-DECREASE REPORT ;Nov 23, 2014@12:48:50
"RTN","RCDPEAD1",2,0)
 ;;4.5;Accounts Receivable;**298,318**;Mar 20, 1995;Build 37
"RTN","RCDPEAD1",3,0)
 ;;Per VA Directive 6402, this routine should not be modified.
"RTN","RCDPEAD1",4,0)
 ;
"RTN","RCDPEAD1",5,0)
CARCS(A1,A2,A3,CARCS) ; Get CARC Auto-Decrease data
"RTN","RCDPEAD1",6,0)
 ; Input:   A1              - "EXCEL" if exporting to excel
"RTN","RCDPEAD1",7,0)
 ;                            Internal fileman date if not exporting to excel
"RTN","RCDPEAD1",8,0)
 ;          A2              - Excel Line Counter if exporting to excel
"RTN","RCDPEAD1",9,0)
 ;                            External Claim number is sorting by claim
"RTN","RCDPEAD1",10,0)
 ;                            External Payer Name if sorting by Payer
"RTN","RCDPEAD1",11,0)
 ;                            External Patient Name if sorting by Patient Name
"RTN","RCDPEAD1",12,0)
 ;          A3              - Record Counter
"RTN","RCDPEAD1",13,0)
 ;          CARCS           - ^ delimited string of CARC information
"RTN","RCDPEAD1",14,0)
 ;                            See SAVE for a complete description
"RTN","RCDPEAD1",15,0)
 ; Output:  ^TMP("RCDPEADP",$J,A1,A2,A3,A4) - C1^C2^C3^C4 Where:
"RTN","RCDPEAD1",16,0)
 ;                          - A1 - "EXCEL" if exporting to excel
"RTN","RCDPEAD1",17,0)
 ;                                  Internal fileman date if not exporting to excel
"RTN","RCDPEAD1",18,0)
 ;                            A2 - Excel Line Counter if exporting to excel
"RTN","RCDPEAD1",19,0)
 ;                                 External Claim number is sorting by claim
"RTN","RCDPEAD1",20,0)
 ;                                 External Payer Name if sorting by Payer
"RTN","RCDPEAD1",21,0)
 ;                                 External Patient Name if sorting by Patient Name
"RTN","RCDPEAD1",22,0)
 ;                            A3 - Record Counter
"RTN","RCDPEAD1",23,0)
 ;                            A4 - CARC Counter
"RTN","RCDPEAD1",24,0)
 ;                            C1 - CARC Code (file 361.111, field .01)
"RTN","RCDPEAD1",25,0)
 ;                            C2 - Decrease Amount (file 361.111, field .02)
"RTN","RCDPEAD1",26,0)
 ;                            C3 - Quantity (file 361.111, field .03)
"RTN","RCDPEAD1",27,0)
 ;                            C4 - Reason (file 361.111, field .04)
"RTN","RCDPEAD1",28,0)
 N AMT,CARC,CCTR,OCARC,QUANT,REASON,XX
"RTN","RCDPEAD1",29,0)
 ;
"RTN","RCDPEAD1",30,0)
 ; Loop through all of the valid CARCs found in the EOB record
"RTN","RCDPEAD1",31,0)
 F CCTR=1:1:$L(CARCS,"^") D
"RTN","RCDPEAD1",32,0)
 . S OCARC=$P(CARCS,"^",CCTR)
"RTN","RCDPEAD1",33,0)
 . S CARC=$P(OCARC,";",2)                   ; CARC Code
"RTN","RCDPEAD1",34,0)
 . S AMT=$P(OCARC,";",1)                    ; Amount
"RTN","RCDPEAD1",35,0)
 . S QUANT=$P(OCARC,";",3)                  ; Quantity
"RTN","RCDPEAD1",36,0)
 . S REASON=$P(OCARC,";",4)                 ; Reason Text
"RTN","RCDPEAD1",37,0)
 . S XX=CARC_"^"_AMT_"^"_QUANT_"^"_REASON
"RTN","RCDPEAD1",38,0)
 . S ^TMP("RCDPEADP",$J,A1,A2,A3,CCTR)=XX
"RTN","RCDPEAD1",39,0)
 Q
"RTN","RCDPEAD1",40,0)
 ;
"RTN","RCDPEAD1",41,0)
COMPILE(INPUTS,RCVAUTD,DTOTAL,GTOTAL) ; EP Generate the Auto-Decrease report ^TMP array
"RTN","RCDPEAD1",42,0)
 ; Input:   INPUTS  - A1^A2^A3^...^An Where:
"RTN","RCDPEAD1",43,0)
 ;                       A1 -  1  - All divisions selected
"RTN","RCDPEAD1",44,0)
 ;                             2  - Selected divisions
"RTN","RCDPEAD1",45,0)
 ;                       A2 -  C  - Sort by Claim
"RTN","RCDPEAD1",46,0)
 ;                             P  - Sort by Payer 
"RTN","RCDPEAD1",47,0)
 ;                             N  - Sort by Patient Name
"RTN","RCDPEAD1",48,0)
 ;                       A3 -  F  - First to Last Sort Order
"RTN","RCDPEAD1",49,0)
 ;                             L  - Last to First Sort Order
"RTN","RCDPEAD1",50,0)
 ;                       A4 -  B1|B2
"RTN","RCDPEAD1",51,0)
 ;                             B1 - Auto-Post Start Date
"RTN","RCDPEAD1",52,0)
 ;                             B2 - Auto-Post End Date
"RTN","RCDPEAD1",53,0)
 ;                       A5 -  1 - Output to Excel
"RTN","RCDPEAD1",54,0)
 ;                             2 - Otherwise
"RTN","RCDPEAD1",55,0)
 ;          RCVAUTD     - Array of selected Divisions
"RTN","RCDPEAD1",56,0)
 ;                        Only passed if A1=2
"RTN","RCDPEAD1",57,0)
 ; Output:  DTOTAL()            - Array of totals by Auto-Post Date
"RTN","RCDPEAD1",58,0)
 ;          GTOTAL              - Grand totals
"RTN","RCDPEAD1",59,0)
 ;          ^TMP("RCDPEADP",$J) - Array of report data
"RTN","RCDPEAD1",60,0)
 ;                                See SAVE for a full description
"RTN","RCDPEAD1",61,0)
 N ADDATE,CARCS,END,ERAIEN,EOBIEN,EXCEL,RCTR,RCRZ,RCSORT,STA,STNAM,STNUM,XX
"RTN","RCDPEAD1",62,0)
 ;
"RTN","RCDPEAD1",63,0)
 S XX=$P(INPUTS,"^",4)                      ; Auto-Post Date range
"RTN","RCDPEAD1",64,0)
 S ADDATE=$$FMADD^XLFDT($P(XX,"|",1),-1)
"RTN","RCDPEAD1",65,0)
 S END=$P(XX,"|",2)                         ; Auto-Post End Date
"RTN","RCDPEAD1",66,0)
 S RCTR=0                                   ; Record counter
"RTN","RCDPEAD1",67,0)
 S EXCEL=$P(INPUTS,"^",5)                   ; 1 output to Excel, 0 otherwise
"RTN","RCDPEAD1",68,0)
 S RCSORT=$P(INPUTS,"^",2)                  ; Sort Type
"RTN","RCDPEAD1",69,0)
 ;
"RTN","RCDPEAD1",70,0)
 ; ^RCY(344.4,0) = "ELECTRONIC REMITTANCE ADVICE^344.4I^"
"RTN","RCDPEAD1",71,0)
 ;                 G cross-ref.   REGULAR    WHOLE FILE (#344.4)
"RTN","RCDPEAD1",72,0)
 ;                 Field:  AUTO-POST DATE  (344.41,9)
"RTN","RCDPEAD1",73,0)
 ; Scan G index for ERA within date range
"RTN","RCDPEAD1",74,0)
 F  S ADDATE=$O(^RCY(344.4,"G",ADDATE)) Q:'ADDATE  Q:(ADDATE\1)>END  D
"RTN","RCDPEAD1",75,0)
 . S ERAIEN=""
"RTN","RCDPEAD1",76,0)
 . F  D  Q:'ERAIEN
"RTN","RCDPEAD1",77,0)
 . . S ERAIEN=$O(^RCY(344.4,"G",ADDATE,ERAIEN))
"RTN","RCDPEAD1",78,0)
 . . Q:'ERAIEN
"RTN","RCDPEAD1",79,0)
 . . D ERASTA(ERAIEN,.STA,.STNUM,.STNAM)        ; Check for valid Division
"RTN","RCDPEAD1",80,0)
 . . I $P(INPUTS,"^",1)=2,'$D(RCVAUTD(STA)) Q   ; Not a valid Division
"RTN","RCDPEAD1",81,0)
 . . ;
"RTN","RCDPEAD1",82,0)
 . . ; Scan index for auto-decreased claim lines within the ERA
"RTN","RCDPEAD1",83,0)
 . . ; and Save claim line detail to ^TMP global
"RTN","RCDPEAD1",84,0)
 . . S RCRZ=""
"RTN","RCDPEAD1",85,0)
 . . F  D  Q:'RCRZ
"RTN","RCDPEAD1",86,0)
 . . . S RCRZ=$O(^RCY(344.4,"G",ADDATE,ERAIEN,RCRZ))
"RTN","RCDPEAD1",87,0)
 . . . Q:'RCRZ
"RTN","RCDPEAD1",88,0)
 . . . S EOBIEN=$$GET1^DIQ(344.41,RCRZ_","_ERAIEN_",",.02,"I")
"RTN","RCDPEAD1",89,0)
 . . . ;
"RTN","RCDPEAD1",90,0)
 . . . ; Find all Claim level and Claim line level CARCs
"RTN","RCDPEAD1",91,0)
 . . . S CARCS=$$CARCLMT^RCDPEAD(EOBIEN,1,ADDATE)
"RTN","RCDPEAD1",92,0)
 . . . Q:+CARCS=0                               ; No CARCs found
"RTN","RCDPEAD1",93,0)
 . . . D SAVE^RCDPEADP(ADDATE,ERAIEN,RCRZ,EXCEL,RCSORT,CARCS,.RCTR,STNAM,STNUM)
"RTN","RCDPEAD1",94,0)
 Q
"RTN","RCDPEAD1",95,0)
 ;
"RTN","RCDPEAD1",96,0)
ERASTA(ERAIEN,STA,STNUM,STNAM) ; Get the station for this ERA
"RTN","RCDPEAD1",97,0)
 ; Input:   ERAIEN  - Internal IEN for file 344.4
"RTN","RCDPEAD1",98,0)
 ; Output:  STA     - Internal Station IEN
"RTN","RCDPEAD1",99,0)
 ;          STNUM   - Station Number
"RTN","RCDPEAD1",100,0)
 ;          STNAM   - Station Name
"RTN","RCDPEAD1",101,0)
 N ERAEOB,ERABILL,STAIEN
"RTN","RCDPEAD1",102,0)
 S (ERAEOB,ERABILL)=""
"RTN","RCDPEAD1",103,0)
 S (STA,STNUM,STNAM)="UNKNOWN"
"RTN","RCDPEAD1",104,0)
 S ERAEOB=$$GET1^DIQ(344.41,"1,"_ERAIEN_",",.02,"I")
"RTN","RCDPEAD1",105,0)
 Q:'ERAEOB
"RTN","RCDPEAD1",106,0)
 S ERABILL=$$GET1^DIQ(361.1,ERAEOB,.01,"I")
"RTN","RCDPEAD1",107,0)
 Q:'ERABILL
"RTN","RCDPEAD1",108,0)
 S STAIEN=$$GET1^DIQ(399,ERABILL,.22,"I")
"RTN","RCDPEAD1",109,0)
 Q:'STAIEN
"RTN","RCDPEAD1",110,0)
 S STA=STAIEN
"RTN","RCDPEAD1",111,0)
 S STNAM=$$EXTERNAL^DILFD(399,.22,,STA)
"RTN","RCDPEAD1",112,0)
 S STNUM=$$GET1^DIQ(40.8,STAIEN,1,"I")
"RTN","RCDPEAD1",113,0)
 Q
"RTN","RCDPEAD1",114,0)
 ;
"RTN","RCDPEAD1",115,0)
HDR(EXCEL,HDRINFO,PAGE,NOLINE) ; Print the report header
"RTN","RCDPEAD1",116,0)
 ; Input:   EXCEL       - 1 if output to Excel, 0 otherwise
"RTN","RCDPEAD1",117,0)
 ;          HDRINFO()   - Array of Header information
"RTN","RCDPEAD1",118,0)
 ;          PAGE        - Current Page Number
"RTN","RCDPEAD1",119,0)
 ;          NOLINE      - 1 to not display Claim line header
"RTN","RCDPEAD1",120,0)
 ;                        Optional, defaults to 0
"RTN","RCDPEAD1",121,0)
 ; Output:  PAGE        - Updated Page Number (if EXCEL=0)
"RTN","RCDPEAD1",122,0)
 N DIV,MSG,SUB,XX,Y,Z0,Z1
"RTN","RCDPEAD1",123,0)
 S:'$D(NOLINE) NOLINE=0
"RTN","RCDPEAD1",124,0)
 I EXCEL D  Q
"RTN","RCDPEAD1",125,0)
 . W !,"STATION^STATION NUMBER^CLAIM #^PATIENT NAME^PAYER^DECREASE AMOUNT^DATE^CARC"
"RTN","RCDPEAD1",126,0)
 . W "^DECREASE AMT^#^REASON"
"RTN","RCDPEAD1",127,0)
 ;
"RTN","RCDPEAD1",128,0)
 S PAGE=PAGE+1
"RTN","RCDPEAD1",129,0)
 W @IOF
"RTN","RCDPEAD1",130,0)
 S MSG(1)="                     EDI Lockbox Auto-Decrease Adjustment Report "
"RTN","RCDPEAD1",131,0)
 S MSG(1)=MSG(1)_"       Page: "_PAGE
"RTN","RCDPEAD1",132,0)
 S MSG(2)="                        Run Date: "_HDRINFO("RUNDATE")
"RTN","RCDPEAD1",133,0)
 S Z0="Divisions: "_HDRINFO("DIVISIONS")
"RTN","RCDPEAD1",134,0)
 S MSG(3)=$S($L(Z0)<75:$J("",75-$L(Z0)\2),1:"")_Z0
"RTN","RCDPEAD1",135,0)
 S XX=" (Date Decrease Applied)"
"RTN","RCDPEAD1",136,0)
 S MSG(4)="               Date Range: "_HDRINFO("START")_" - "_HDRINFO("END")_XX
"RTN","RCDPEAD1",137,0)
 S MSG(5)="                "_HDRINFO("SORT")
"RTN","RCDPEAD1",138,0)
 S MSG(6)=""
"RTN","RCDPEAD1",139,0)
 I 'NOLINE D
"RTN","RCDPEAD1",140,0)
 . S MSG(7)="Claim #       Patient Name          Payer             Decrease Amt  Date    "
"RTN","RCDPEAD1",141,0)
 . S MSG(8)="============================================================================"
"RTN","RCDPEAD1",142,0)
 D EN^DDIOL(.MSG)
"RTN","RCDPEAD1",143,0)
 Q
"RTN","RCDPEAD1",144,0)
 ;
"RTN","RCDPEAD1",145,0)
HINFO(INPUTS,HDRINFO) ;Get header information
"RTN","RCDPEAD1",146,0)
 ; Input:   INPUTS       - See REPORT^RCDPEADP for a complete description
"RTN","RCDPEAD1",147,0)
 ;          HDRINFO      - Return array - passed by reference
"RTN","RCDPEAD1",148,0)
 ; Output:  HDRINFO      - Formatted header array for ListMan
"RTN","RCDPEAD1",149,0)
 N XX
"RTN","RCDPEAD1",150,0)
 S XX=$P(INPUTS,"^",4)                      ; Auto-Post Date range
"RTN","RCDPEAD1",151,0)
 S HDRINFO("START")=$$FMTE^XLFDT($P(XX,"|",1),"2SZ")
"RTN","RCDPEAD1",152,0)
 S HDRINFO("END")=$$FMTE^XLFDT($P(XX,"|",2),"2SZ")
"RTN","RCDPEAD1",153,0)
 S HDRINFO("RUNDATE")=$$FMTE^XLFDT($$NOW^XLFDT,"2SZ")
"RTN","RCDPEAD1",154,0)
 s XX=$P(INPUTS,"^",2)                      ; Sort Type
"RTN","RCDPEAD1",155,0)
 S HDRINFO("SORT")="SORTED BY: "_$S(XX="C":"CLAIM",XX="P":"PAYER",1:"PATIENT NAME")
"RTN","RCDPEAD1",156,0)
 S XX=$S($P(INPUTS,"^",3)="L":"LAST TO FIRST",1:"FIRST TO LAST")
"RTN","RCDPEAD1",157,0)
 S HDRINFO("SORT")=HDRINFO("SORT")_" - "_XX
"RTN","RCDPEAD1",158,0)
 ; Format Division filter
"RTN","RCDPEAD1",159,0)
 S XX=$P(INPUTS,"^",1)                      ; XX=1 - All Divisions, 2- selected
"RTN","RCDPEAD1",160,0)
 S HDRINFO("DIVISIONS")=$S(XX=2:$$LINE^RCDPEADP(.RCVAUTD),1:"ALL")
"RTN","RCDPEAD1",161,0)
 Q
"RTN","RCDPEAD1",162,0)
 ;
"RTN","RCDPEAD1",163,0)
LMAN(DATA,A1,A2,A3,XX) ; Format and save List Manager line
"RTN","RCDPEAD1",164,0)
 ; Input:   DATA - ERA line adjustment total
"RTN","RCDPEAD1",165,0)
 ;          A1,A2,A3 - ^TMP("RCDPEAP") subscripts
"RTN","RCDPEAD1",166,0)
 ;          XX - List Counter for ^TMP("RCDPE_ADP",$J)
"RTN","RCDPEAD1",167,0)
 N CARCAMT,CCTR,DATA1,Y
"RTN","RCDPEAD1",168,0)
 S Y=$E($P(DATA,U,3),1,12)                     ; Claim #
"RTN","RCDPEAD1",169,0)
 S $E(Y,15)=$E($P(DATA,U,4),1,20)              ; Patient Name
"RTN","RCDPEAD1",170,0)
 S $E(Y,37)=$E($P(DATA,U,5),1,19)              ; Payer Name
"RTN","RCDPEAD1",171,0)
 S $E(Y,55)=$J($P(DATA,U,6),12,2)              ; Auto-Decrease  Amount
"RTN","RCDPEAD1",172,0)
 S $E(Y,69)=$P(DATA,U,7)                       ; Auto-Decrease Date
"RTN","RCDPEAD1",173,0)
 S ^TMP("RCDPE_ADP",$J,XX)=Y,XX=XX+1
"RTN","RCDPEAD1",174,0)
 S ^TMP("RCDPE_ADP",$J,XX)=" ",XX=XX+1
"RTN","RCDPEAD1",175,0)
 S ^TMP("RCDPE_ADP",$J,XX)="    CARC                  Decrease Amt    #    Reason",XX=XX+1
"RTN","RCDPEAD1",176,0)
 S ^TMP("RCDPE_ADP",$J,XX)="    --------------------  -------------  ----  -----------------------------",XX=XX+1
"RTN","RCDPEAD1",177,0)
 S CCTR=0
"RTN","RCDPEAD1",178,0)
 F  S CCTR=$O(^TMP("RCDPEADP",$J,A1,A2,A3,CCTR)) Q:'CCTR  D
"RTN","RCDPEAD1",179,0)
 . ;Display a line for each CARC adjustment on the line
"RTN","RCDPEAD1",180,0)
 . S DATA1=$G(^TMP("RCDPEADP",$J,A1,A2,A3,CCTR)),CARCAMT=$P(DATA1,U,2)
"RTN","RCDPEAD1",181,0)
 . S Y="    "_$E($P(DATA1,U,1),1,20)        ; CARC
"RTN","RCDPEAD1",182,0)
 . S $E(Y,27)=$J($P(DATA1,U,2),12,2)        ; Decrease Amount
"RTN","RCDPEAD1",183,0)
 . S $E(Y,42)=$J($P(DATA1,U,3),4)           ; Quantity
"RTN","RCDPEAD1",184,0)
 . S $E(Y,48)=$E($P(DATA1,U,4),1,32)        ; Reason
"RTN","RCDPEAD1",185,0)
 . S ^TMP("RCDPE_ADP",$J,XX)=Y,XX=XX+1
"RTN","RCDPEAD1",186,0)
 S ^TMP("RCDPE_ADP",$J,XX)=" ",XX=XX+1
"RTN","RCDPEAD1",187,0)
 Q
"RTN","RCDPEAD1",188,0)
 ;
"RTN","RCDPEAD1",189,0)
LMOUT(INPUT,RCVAUTD,IO) ; EP Output report to Listman
"RTN","RCDPEAD1",190,0)
 ; Input:   INPUT       - See REPORT for a complete description
"RTN","RCDPEAD1",191,0)
 ;          RCVAUTD     -  Array of selected Divisions
"RTN","RCDPEAD1",192,0)
 ;                         Only passed if A1=2
"RTN","RCDPEAD1",193,0)
 ;          IO          -  Output device array
"RTN","RCDPEAD1",194,0)
 ; Output:  ^TMP("RCDPE_LAR",$J,CTR)=Line - Array of display lines (no headers)
"RTN","RCDPEAD1",195,0)
 ;                                           for output to Listman
"RTN","RCDPEAD1",196,0)
 ;                                           Only set when A7-1
"RTN","RCDPEAD1",197,0)
 N HDR,HDRINFO,XX,Z0
"RTN","RCDPEAD1",198,0)
 D REPORT^RCDPEADP(INPUT,.RCVAUTD,.IO)                    ; Get the lines to be displayed
"RTN","RCDPEAD1",199,0)
 D HINFO(INPUT,.HDRINFO)
"RTN","RCDPEAD1",200,0)
 S HDR("TITLE")="AUTO-DECREASE REPORT"
"RTN","RCDPEAD1",201,0)
 S HDR(1)="                        RUN DATE: "_HDRINFO("RUNDATE")
"RTN","RCDPEAD1",202,0)
 S Z0="DIVISIONS: "_HDRINFO("DIVISIONS")
"RTN","RCDPEAD1",203,0)
 S HDR(2)=$S($L(Z0)<75:$J("",75-$L(Z0)\2),1:"")_Z0
"RTN","RCDPEAD1",204,0)
 S XX=" (DATE DECREASE APPLIED)"
"RTN","RCDPEAD1",205,0)
 S HDR(3)="               DATE RANGE: "_HDRINFO("START")_" - "_HDRINFO("END")_XX
"RTN","RCDPEAD1",206,0)
 S HDR(4)="                "_HDRINFO("SORT")
"RTN","RCDPEAD1",207,0)
 S HDR(5)=""
"RTN","RCDPEAD1",208,0)
 S HDR(6)=""
"RTN","RCDPEAD1",209,0)
 S HDR(7)="CLAIM #       PATIENT NAME          PAYER             DECREASE AMT  DATE    "
"RTN","RCDPEAD1",210,0)
 D LMRPT^RCDPEARL(.HDR,$NA(^TMP("RCDPE_ADP",$J))) ; Generate ListMan display
"RTN","RCDPEAD1",211,0)
 ;
"RTN","RCDPEAD1",212,0)
 K ^TMP("RCDPEADP",$J),^TMP($J,"RCDPEADP"),^TMP("RCDPE_ADP",$J)
"RTN","RCDPEAD1",213,0)
 Q
"RTN","RCDPEAD1",214,0)
 ;
"RTN","RCDPEAD1",215,0)
TOTALD(EXCEL,HDRINFO,PAGE,STOP,DAY,DTOTAL) ; Totals for a single day
"RTN","RCDPEAD1",216,0)
 ; Input:   EXCEL       - 1 if output to Excel, 0 otherwise
"RTN","RCDPEAD1",217,0)
 ;          HDRINFO()   - Array of header information
"RTN","RCDPEAD1",218,0)
 ;          PAGE        - Current Page Number
"RTN","RCDPEAD1",219,0)
 ;          DAY         - Internal Fileman date to display totals for
"RTN","RCDPEAD1",220,0)
 ;          DTOTAL()    - Array of totals by day
"RTN","RCDPEAD1",221,0)
 ;          IOSL        - Page length
"RTN","RCDPEAD1",222,0)
 ; Output:  PAGE        - Updated Page Number (if a new header is displayed)
"RTN","RCDPEAD1",223,0)
 ;          STOP        - 1 if displaying to screen and user asked to stop
"RTN","RCDPEAD1",224,0)
 N DAMT,DCNT,Y
"RTN","RCDPEAD1",225,0)
 I 'EXCEL,$Y>(IOSL-4) D
"RTN","RCDPEAD1",226,0)
 . D ASK^RCDPEADP(.STOP,0)
"RTN","RCDPEAD1",227,0)
 . Q:STOP
"RTN","RCDPEAD1",228,0)
 . D HDR(EXCEL,.HDRINFO,.PAGE)
"RTN","RCDPEAD1",229,0)
 Q:STOP
"RTN","RCDPEAD1",230,0)
 S DCNT=$P(DTOTAL(DAY),U),DAMT=$P(DTOTAL(DAY),U,2)
"RTN","RCDPEAD1",231,0)
 S Y="**Totals for Date: "_$$FMTE^XLFDT(DAY,"2Z")
"RTN","RCDPEAD1",232,0)
 S $E(Y,35)="    # of Decrease Adjustments: "_DCNT
"RTN","RCDPEAD1",233,0)
 W !!,Y
"RTN","RCDPEAD1",234,0)
 S Y="",$E(Y,28)="Total Amount of Decrease Adjustments: $"_$J(DAMT,3,2)
"RTN","RCDPEAD1",235,0)
 W !,Y
"RTN","RCDPEAD1",236,0)
 Q
"RTN","RCDPEAD1",237,0)
 ;
"RTN","RCDPEAD1",238,0)
 ;TOTALS ; Print totals for EXCEL
"RTN","RCDPEAD1",239,0)
 ;N DAY,DAMT,DCNT
"RTN","RCDPEAD1",240,0)
 ;S DAY=""
"RTN","RCDPEAD1",241,0)
 ;F  S DAY=$O(DTOTAL(DAY)) Q:'DAY  D  Q:STOP
"RTN","RCDPEAD1",242,0)
 ;.;Day totals
"RTN","RCDPEAD1",243,0)
 ;.D TOTALD(DAY)
"RTN","RCDPEAD1",244,0)
 ;;Grand totals
"RTN","RCDPEAD1",245,0)
 ;D TOTALG
"RTN","RCDPEAD1",246,0)
 ;Q
"RTN","RCDPEAD1",247,0)
 ;
"RTN","RCDPEAD1",248,0)
TOTALG(EXCEL,HDRINFO,PAGE,GTOTAL,STOP) ; Overall report total
"RTN","RCDPEAD1",249,0)
 ; Input:   EXCEL       - 1 if output to Excel, 0 otherwise
"RTN","RCDPEAD1",250,0)
 ;          HDRINFO()   - Array of header information
"RTN","RCDPEAD1",251,0)
 ;          PAGE        - Current Page Number
"RTN","RCDPEAD1",252,0)
 ;          GTOTAL()    - Grand Totals for report
"RTN","RCDPEAD1",253,0)
 ;          IOSL        - Page length
"RTN","RCDPEAD1",254,0)
 ; Output:  PAGE        - Updated Page Number (if a new header is displayed)
"RTN","RCDPEAD1",255,0)
 N Y
"RTN","RCDPEAD1",256,0)
 I 'EXCEL,$Y>(IOSL-6) D
"RTN","RCDPEAD1",257,0)
 . D ASK^RCDPEADP(.STOP,0)
"RTN","RCDPEAD1",258,0)
 . Q:STOP
"RTN","RCDPEAD1",259,0)
 . D HDR(EXCEL,.HDRINFO,.PAGE)
"RTN","RCDPEAD1",260,0)
 Q:STOP
"RTN","RCDPEAD1",261,0)
 W !!,"**** Totals for Date Range:           # of Decrease Adjustments: "_+$P(GTOTAL,U,1)
"RTN","RCDPEAD1",262,0)
 S Y="",$E(Y,28)="Total Amount of Decrease Adjustments: $"_$J((+$P(GTOTAL,U,2)),3,2)
"RTN","RCDPEAD1",263,0)
 W !,Y,!
"RTN","RCDPEAD1",264,0)
 Q
"RTN","RCDPEAD1",265,0)
 ;
"RTN","RCDPEADP")
0^27^B154275077^B82856652
"RTN","RCDPEADP",1,0)
RCDPEADP ;OIFO-BAYPINES/PJH - AUTO-DECREASE REPORT ;Nov 23, 2014@12:48:50
"RTN","RCDPEADP",2,0)
 ;;4.5;Accounts Receivable;**298,318**;Mar 20, 1995;Build 37
"RTN","RCDPEADP",3,0)
 ;;Per VA Directive 6402, this routine should not be modified.
"RTN","RCDPEADP",4,0)
 ; Read ^DGCR(399)      via Private IA 3820
"RTN","RCDPEADP",5,0)
 ; Read ^DG(40.8)       via Controlled IA 417
"RTN","RCDPEADP",6,0)
 ; Read ^IBM(361.1)     via Private IA 4051
"RTN","RCDPEADP",7,0)
 ; Use DIVISION^VAUTOMA via Controlled IA 664
"RTN","RCDPEADP",8,0)
 ;
"RTN","RCDPEADP",9,0)
RPT ; entry point for Auto-Decrease Adjustment report [RCDPE AUTO-DECREASE REPORT]
"RTN","RCDPEADP",10,0)
 N INPUT,RCVAUTD
"RTN","RCDPEADP",11,0)
 S INPUT=$$STADIV(.RCVAUTD)                   ; Division filter
"RTN","RCDPEADP",12,0)
 Q:'INPUT                                     ; '^' or timeout
"RTN","RCDPEADP",13,0)
 S $P(INPUT,"^",2)=$$ASKSORT()                ; Select Sort Criteria
"RTN","RCDPEADP",14,0)
 Q:$P(INPUT,"^",2)="0"                        ; '^' or timeout
"RTN","RCDPEADP",15,0)
 S $P(INPUT,"^",3)=$$SORTORD($P(INPUT,"^",2)) ; Select Sort Order
"RTN","RCDPEADP",16,0)
 Q:$P(INPUT,"^",3)="0"                        ; '^' or timeout
"RTN","RCDPEADP",17,0)
 S $P(INPUT,"^",4)=$$DTRNG()                  ; Select Date Range for Report
"RTN","RCDPEADP",18,0)
 Q:'$P(INPUT,"^",4)                           ; '^' or timeout
"RTN","RCDPEADP",19,0)
 S $P(INPUT,"^",4)=$P($P(INPUT,"^",4),"|",2,3)
"RTN","RCDPEADP",20,0)
 S $P(INPUT,"^",6)=$$ASKLM^RCDPEARL             ; Ask to Display in Listman Template
"RTN","RCDPEADP",21,0)
 Q:$P(INPUT,"^",6)<0                            ; '^' or timeout
"RTN","RCDPEADP",22,0)
 I $P(INPUT,"^",6)=1 D  Q                       ; Compile data and call listman to display
"RTN","RCDPEADP",23,0)
 . D LMOUT^RCDPEAD1(INPUT,.RCVAUTD,.IO)
"RTN","RCDPEADP",24,0)
 S $P(INPUT,"^",5)=$$DISPTY()                 ; Select Display Type
"RTN","RCDPEADP",25,0)
 Q:$P(INPUT,"^",5)=-1                         ; '^' or timeout
"RTN","RCDPEADP",26,0)
 D:$P(INPUT,"^",5)=1 INFO^RCDPEM6             ; Display capture information for Excel
"RTN","RCDPEADP",27,0)
 Q:'$$DEVICE($P(INPUT,"^",5),.IO)             ; Ask output device
"RTN","RCDPEADP",28,0)
 ;
"RTN","RCDPEADP",29,0)
 ; Compile and Display Report data (queued) - not allowed for EXCEL
"RTN","RCDPEADP",30,0)
 I $P(INPUT,"^",5)'=1,$D(IO("Q")) D  Q
"RTN","RCDPEADP",31,0)
 .N ZTDESC,ZTQUEUED,ZTRTN,ZTSAVE,ZTSK
"RTN","RCDPEADP",32,0)
 .S ZTRTN="REPORT^RCDPEADP(INPUT,.RCVAUTD,.IO)"
"RTN","RCDPEADP",33,0)
 .S ZTDESC="EDI LOCKBOX AUTO-DECREASE REPORT"
"RTN","RCDPEADP",34,0)
 .S ZTSAVE("RC*")="",ZTSAVE("INPUT")="",ZTSAVE("IO*")=""
"RTN","RCDPEADP",35,0)
 .D ^%ZTLOAD
"RTN","RCDPEADP",36,0)
 .I $D(ZTSK) W !!,"Task number "_ZTSK_" has been queued."
"RTN","RCDPEADP",37,0)
 .E  W !!,"Unable to queue this job."
"RTN","RCDPEADP",38,0)
 .K ZTSK,IO("Q")
"RTN","RCDPEADP",39,0)
 .D HOME^%ZIS
"RTN","RCDPEADP",40,0)
 ; Compile and Display Report data (non-queued)
"RTN","RCDPEADP",41,0)
 D REPORT(INPUT,.RCVAUTD,.IO)                     ; Compile and Display Report data
"RTN","RCDPEADP",42,0)
 Q
"RTN","RCDPEADP",43,0)
 ;
"RTN","RCDPEADP",44,0)
STADIV(RCVAUTD) ; Division/Station Filter
"RTN","RCDPEADP",45,0)
 ; Input:   None
"RTN","RCDPEADP",46,0)
 ; Output:  RCVAUTD()   - Array of selected Divisions/Stations if 2 is returned
"RTN","RCDPEADP",47,0)
 ; Returns: 1           - All Divisions/Stations selected
"RTN","RCDPEADP",48,0)
 ;          2           - Specified Divisions/Stations selected
"RTN","RCDPEADP",49,0)
 ;          0           - "^" or timeout
"RTN","RCDPEADP",50,0)
 N DIR,DIROUT,DTOUT,DUOUT,VAUTD,Y
"RTN","RCDPEADP",51,0)
 ;
"RTN","RCDPEADP",52,0)
 ; Division selection - IA 664
"RTN","RCDPEADP",53,0)
 ; RETURNS Y=-1 (quit), VAUTD=1 (for all),VAUTD=0 (selected divisions in VAUTD)
"RTN","RCDPEADP",54,0)
 D DIVISION^VAUTOMA
"RTN","RCDPEADP",55,0)
 Q:Y<0 0
"RTN","RCDPEADP",56,0)
 Q:VAUTD=1 1                                ; All Divisions selected
"RTN","RCDPEADP",57,0)
 M RCVAUTD=VAUTD                            ; Save selected divisions
"RTN","RCDPEADP",58,0)
 Q 2
"RTN","RCDPEADP",59,0)
 ;
"RTN","RCDPEADP",60,0)
ASKSORT() ; Select the sort criteria
"RTN","RCDPEADP",61,0)
 ; Input:   None
"RTN","RCDPEADP",62,0)
 ; Returns: C       - Sort by Claim
"RTN","RCDPEADP",63,0)
 ;          P       - Sort by Payer 
"RTN","RCDPEADP",64,0)
 ;          N       - Sort by Patient Name
"RTN","RCDPEADP",65,0)
 ;          0       - User entered '^' or timed out
"RTN","RCDPEADP",66,0)
 N DIR,DIROUT,DIRUT,DTOUT,DUOUT,XX
"RTN","RCDPEADP",67,0)
 S DIR(0)="SA^C:CLAIM;P:PAYER;N:PATIENT NAME;"
"RTN","RCDPEADP",68,0)
 S DIR("A")="Sort by (C)LAIM #, (P)AYER or PATIENT (N)AME?: "
"RTN","RCDPEADP",69,0)
 S DIR("?",1)="Enter 'C' to sort by Claim Number, 'P' to sort by Payer or 'N' to sort"
"RTN","RCDPEADP",70,0)
 S DIR("?")="by Patient Name."
"RTN","RCDPEADP",71,0)
 S DIR("B")="CLAIM"
"RTN","RCDPEADP",72,0)
 D ^DIR
"RTN","RCDPEADP",73,0)
 Q:$D(DTOUT)!$D(DUOUT) 0
"RTN","RCDPEADP",74,0)
 Q Y
"RTN","RCDPEADP",75,0)
 ;
"RTN","RCDPEADP",76,0)
SORTORD(SORT) ; Select the sort order
"RTN","RCDPEADP",77,0)
 ; Input:   SORT    - 'C' - Sort by Claim Number
"RTN","RCDPEADP",78,0)
 ;                    'P' - Sort by Payer
"RTN","RCDPEADP",79,0)
 ;                    'N' - Sort by Patient Name
"RTN","RCDPEADP",80,0)
 ; Returns: F       - First to Last
"RTN","RCDPEADP",81,0)
 ;          L       - Last to First 
"RTN","RCDPEADP",82,0)
 ;          0       - User entered '^' or timed out
"RTN","RCDPEADP",83,0)
 N DIR,DIROUT,DIRUT,DTOUT,DUOUT,XX,YY
"RTN","RCDPEADP",84,0)
 S XX=" (F)IRST TO LAST or (L)AST TO FIRST?: "
"RTN","RCDPEADP",85,0)
 S YY=$S(SORT="C":"CLAIM",SORT="P":"PAYER",1:"PATIENT NAME")
"RTN","RCDPEADP",86,0)
 S DIR("A")="Sort "_YY_XX
"RTN","RCDPEADP",87,0)
 S DIR(0)="SA^F:FIRST TO LAST;L:LAST TO FIRST"
"RTN","RCDPEADP",88,0)
 S DIR("B")="FIRST TO LAST"
"RTN","RCDPEADP",89,0)
 D ^DIR
"RTN","RCDPEADP",90,0)
 Q:$D(DTOUT)!$D(DUOUT) 0
"RTN","RCDPEADP",91,0)
 Q Y
"RTN","RCDPEADP",92,0)
 ;
"RTN","RCDPEADP",93,0)
DTRNG() ; Get the date range for the report
"RTN","RCDPEADP",94,0)
 ; Input:   None
"RTN","RCDPEADP",95,0)
 ; Returns: A1|A2|A3    - Where:
"RTN","RCDPEADP",96,0)
 ;                          A1 - 0 - User up-arrowed or timed out, 1 otherwise
"RTN","RCDPEADP",97,0)
 ;                          A2 - Auto-Post Start Date
"RTN","RCDPEADP",98,0)
 ;                          A3 - Auto-Post End Date
"RTN","RCDPEADP",99,0)
 N DIR,DIROUT,DIRUT,DTOUT,DUOUT,RCEND,RCSTART,RNGFLG,X,Y
"RTN","RCDPEADP",100,0)
 D DATES(.RCSTART,.RCEND)
"RTN","RCDPEADP",101,0)
 Q:RCSTART=-1 0
"RTN","RCDPEADP",102,0)
 Q:RCSTART "1|"_RCSTART_"|"_RCEND
"RTN","RCDPEADP",103,0)
 Q:'RCSTART "0||"
"RTN","RCDPEADP",104,0)
 Q 0
"RTN","RCDPEADP",105,0)
 ;
"RTN","RCDPEADP",106,0)
DATES(BDATE,EDATE) ; Get a date range.
"RTN","RCDPEADP",107,0)
 ; Input:   None
"RTN","RCDPEADP",108,0)
 ; Output:  BDATE   - Internal Auto-Post Start Date
"RTN","RCDPEADP",109,0)
 ;          EDATE   - Internal Auto-Post End Date
"RTN","RCDPEADP",110,0)
D1 ; looping tag
"RTN","RCDPEADP",111,0)
 S (BDATE,EDATE)=0
"RTN","RCDPEADP",112,0)
 S DIR("?")="Enter the earliest Auto-Posting date to include on the report."
"RTN","RCDPEADP",113,0)
 S DIR(0)="DAO^:"_DT_":APE"
"RTN","RCDPEADP",114,0)
 S DIR("A")="Start Date: "
"RTN","RCDPEADP",115,0)
 D ^DIR
"RTN","RCDPEADP",116,0)
 K DIR
"RTN","RCDPEADP",117,0)
 I $D(DTOUT)!$D(DUOUT)!(Y="") S BDATE=-1 Q
"RTN","RCDPEADP",118,0)
 S BDATE=Y
"RTN","RCDPEADP",119,0)
 S DIR("?")="Enter the latest Auto-Posting date to include on the report."
"RTN","RCDPEADP",120,0)
 S DIR("B")=Y(0)
"RTN","RCDPEADP",121,0)
 S DIR(0)="DAO^"_BDATE_":"_DT_":APE"
"RTN","RCDPEADP",122,0)
 S DIR("A")="End Date: "
"RTN","RCDPEADP",123,0)
 D ^DIR
"RTN","RCDPEADP",124,0)
 K DIR
"RTN","RCDPEADP",125,0)
 I $D(DTOUT)!$D(DUOUT)!(Y="") S BDATE=-1 Q
"RTN","RCDPEADP",126,0)
 S EDATE=Y
"RTN","RCDPEADP",127,0)
 Q
"RTN","RCDPEADP",128,0)
 ;
"RTN","RCDPEADP",129,0)
DISPTY() ; Get display/output type
"RTN","RCDPEADP",130,0)
 ; Input:   None
"RTN","RCDPEADP",131,0)
 ; Returns: 1       - Output to Excel
"RTN","RCDPEADP",132,0)
 ;          0       - Output to paper 
"RTN","RCDPEADP",133,0)
 N DIR,DIROUT,DIRUT,DTOUT,DUOUT,Y
"RTN","RCDPEADP",134,0)
 S DIR(0)="Y"
"RTN","RCDPEADP",135,0)
 S DIR("A")="Export the report to Microsoft Excel"
"RTN","RCDPEADP",136,0)
 S DIR("B")="NO"
"RTN","RCDPEADP",137,0)
 D ^DIR
"RTN","RCDPEADP",138,0)
 I $G(DUOUT) Q -1
"RTN","RCDPEADP",139,0)
 Q Y
"RTN","RCDPEADP",140,0)
 ;
"RTN","RCDPEADP",141,0)
DEVICE(EXCEL,IO) ; Select the output device
"RTN","RCDPEADP",142,0)
 ; Input:   EXCEL   - 1 - Output to Excel, 0 otherwise
"RTN","RCDPEADP",143,0)
 ; Output:  
"RTN","RCDPEADP",144,0)
 ;          IO      - Array of selected output info
"RTN","RCDPEADP",145,0)
 ; Returns: 0       - No device selected, 1 Otherwise
"RTN","RCDPEADP",146,0)
 N POP,%ZIS
"RTN","RCDPEADP",147,0)
 S %ZIS="QM"
"RTN","RCDPEADP",148,0)
 D ^%ZIS
"RTN","RCDPEADP",149,0)
 Q:POP 0
"RTN","RCDPEADP",150,0)
 Q 1
"RTN","RCDPEADP",151,0)
 ;
"RTN","RCDPEADP",152,0)
REPORT(INPUTS,RCVAUTD,IO) ; EP Compile and print report
"RTN","RCDPEADP",153,0)
 ; Input:   INPUTS  - A1^A2^A3^...^An Where:
"RTN","RCDPEADP",154,0)
 ;                       A1 -  1  - All divisions selected
"RTN","RCDPEADP",155,0)
 ;                             2  - Selected divisions
"RTN","RCDPEADP",156,0)
 ;                       A2 -  C  - Sort by Claim
"RTN","RCDPEADP",157,0)
 ;                             P  - Sort by Payer 
"RTN","RCDPEADP",158,0)
 ;                             N  - Sort by Patient Name
"RTN","RCDPEADP",159,0)
 ;                       A3 -  F  - First to Last Sort Order
"RTN","RCDPEADP",160,0)
 ;                             L  - Last to First Sort Order
"RTN","RCDPEADP",161,0)
 ;                       A4 -  B1|B2
"RTN","RCDPEADP",162,0)
 ;                             B1 - Auto-Post Start Date
"RTN","RCDPEADP",163,0)
 ;                             B2 - Auto-Post End Date
"RTN","RCDPEADP",164,0)
 ;                       A5 -  1 - Output to Excel
"RTN","RCDPEADP",165,0)
 ;                             0 - Otherwise
"RTN","RCDPEADP",166,0)
 ;                       A6 -  1 - Output to List Manager
"RTN","RCDPEADP",167,0)
 ;                             0 - Otherwise
"RTN","RCDPEADP",168,0)
 ;          RCVAUTD         -  Array of selected Divisions
"RTN","RCDPEADP",169,0)
 ;                             Only passed if A1=2
"RTN","RCDPEADP",170,0)
 ;          IO      - Output Device
"RTN","RCDPEADP",171,0)
 ; Output:  
"RTN","RCDPEADP",172,0)
 N DTOTAL,GTOTAL,XX,ZTREQ
"RTN","RCDPEADP",173,0)
 U IO
"RTN","RCDPEADP",174,0)
 K ^TMP("RCDPEADP",$J),^TMP("RCDPE_ADP",$J)
"RTN","RCDPEADP",175,0)
 D COMPILE^RCDPEAD1(INPUTS,.RCVAUTD,.DTOTAL,.GTOTAL) ; Scan ERA file for entries in date range
"RTN","RCDPEADP",176,0)
 D DISP(INPUTS,.DTOTAL,.GTOTAL)              ; Display Report
"RTN","RCDPEADP",177,0)
 K ^TMP("RCDPEADP",$J),^TMP("RCSELPAY",$J)  ; Clear TMP global
"RTN","RCDPEADP",178,0)
 D ^%ZISC                                   ; Close device
"RTN","RCDPEADP",179,0)
 Q
"RTN","RCDPEADP",180,0)
 ;
"RTN","RCDPEADP",181,0)
SAVE(ADDATE,ERAIEN,RCRZ,EXCEL,RCSORT,CARCS,RCTR,STNAM,STNUM) ; Put the data into the ^TMP global
"RTN","RCDPEADP",182,0)
 ; Input:   ADDATE              - Current Internal Date being processed
"RTN","RCDPEADP",183,0)
 ;          ERAIEN              - Internal IEN of the ERA record
"RTN","RCDPEADP",184,0)
 ;          RCRZ                - ERA line number
"RTN","RCDPEADP",185,0)
 ;          EXCEL               - 1 output to Excel, 0 otherwise
"RTN","RCDPEADP",186,0)
 ;          RCSORT              - C  - Sort by Claim
"RTN","RCDPEADP",187,0)
 ;                                P  - Sort by Payer 
"RTN","RCDPEADP",188,0)
 ;                                N  - Sort by Patient Name
"RTN","RCDPEADP",189,0)
 ;          CARCS               - ^ delimited string of CARC information found
"RTN","RCDPEADP",190,0)
 ;                                on the EOB record pointed to by the ERA detail record
"RTN","RCDPEADP",191,0)
 ;                                A1;A2;A3;A4^B1;B2;B3;B4^...^N1;N2;N3;N4 Where:
"RTN","RCDPEADP",192,0)
 ;                                  A1 - Auto-Decrease amount of the 1st CARC code
"RTN","RCDPEADP",193,0)
 ;                                  A2 - 1st CARC code
"RTN","RCDPEADP",194,0)
 ;                                  A3 - Quantity of the first CARC code
"RTN","RCDPEADP",195,0)
 ;                                  A4 - Truncated Reason text of the 1st CARC 
"RTN","RCDPEADP",196,0)
 ;          DTOTAL()            - Current Array of totals by Auto-Post Date
"RTN","RCDPEADP",197,0)
 ;          GTOTAL              - Current Grand totals
"RTN","RCDPEADP",198,0)
 ;          RCTR                - Current Record Counter
"RTN","RCDPEADP",199,0)
 ;          STNAM               - Station name
"RTN","RCDPEADP",200,0)
 ;          STNUM               - Station number
"RTN","RCDPEADP",201,0)
 ;          ^TMP("RCDPEADP",$J) - Current report data
"RTN","RCDPEADP",202,0)
 ;                                See DISP for a full description
"RTN","RCDPEADP",203,0)
 ; Output:  DTOTAL()            - Updated Array of totals by Auto-Post Date
"RTN","RCDPEADP",204,0)
 ;          GTOTAL              - Updated Grand totals
"RTN","RCDPEADP",205,0)
 ;          RCTR                - Updated Record Counter
"RTN","RCDPEADP",206,0)
 ;          ^TMP("RCDPEADP",$J,A1,A2,A3) - B1^B2^B3^...^Bn Where:
"RTN","RCDPEADP",207,0)
 ;                          - A1 - "EXCEL" if exporting to excel
"RTN","RCDPEADP",208,0)
 ;                                  Internal fileman date if not exporting to excel
"RTN","RCDPEADP",209,0)
 ;                            A2 - Excel Line Counter if exporting to excel
"RTN","RCDPEADP",210,0)
 ;                                 External Claim number is sorting by claim
"RTN","RCDPEADP",211,0)
 ;                                 External Payer Name if sorting by Payer
"RTN","RCDPEADP",212,0)
 ;                                 External Patient Name if sorting by Patient Name
"RTN","RCDPEADP",213,0)
 ;                            A3 - Record Counter
"RTN","RCDPEADP",214,0)
 ;                            B1 - External Station Name
"RTN","RCDPEADP",215,0)
 ;                            B2 - External Station Number
"RTN","RCDPEADP",216,0)
 ;                            B3 - External Claim Number
"RTN","RCDPEADP",217,0)
 ;                            B4 - External Patient Name
"RTN","RCDPEADP",218,0)
 ;                            B5 - External Payer Name
"RTN","RCDPEADP",219,0)
 ;                            B6 - Auto-Decrease Amount
"RTN","RCDPEADP",220,0)
 ;                            B7 - Auto-Decrease Date
"RTN","RCDPEADP",221,0)
 ;          ^TMP("RCDPEADP",$J,A1,A2,A3,A4) - C1^C2^C3^C4 Where:
"RTN","RCDPEADP",222,0)
 ;                          - A1 - "EXCEL" if exporting to excel
"RTN","RCDPEADP",223,0)
 ;                                  Internal fileman date if not exporting to excel
"RTN","RCDPEADP",224,0)
 ;                            A2 - Excel Line Counter if exporting to excel
"RTN","RCDPEADP",225,0)
 ;                                 External Claim number is sorting by claim
"RTN","RCDPEADP",226,0)
 ;                                 External Payer Name if sorting by Payer
"RTN","RCDPEADP",227,0)
 ;                                 External Patient Name if sorting by Patient Name
"RTN","RCDPEADP",228,0)
 ;                            A3 - Record Counter
"RTN","RCDPEADP",229,0)
 ;                            A4 - CARC Counter
"RTN","RCDPEADP",230,0)
 ;                            C1 - CARC Code (file 361.111, field .01)
"RTN","RCDPEADP",231,0)
 ;                            C2 - Decrease Amount (file 361.111, field .02)
"RTN","RCDPEADP",232,0)
 ;                            C3 - Quantity (file 361.111, field .03)
"RTN","RCDPEADP",233,0)
 ;                            C4 - Reason (file 361.111, field .04)
"RTN","RCDPEADP",234,0)
 N A1,A2,AMOUNT,CARC,CLAIM,DATE,EOBIEN,PAYNAM,PTNAM,XX,Y
"RTN","RCDPEADP",235,0)
 S PAYNAM=$$GET1^DIQ(344.4,ERAIEN,.06,"E")              ; Payer name from ERA record
"RTN","RCDPEADP",236,0)
 S DATE=$$FMTE^XLFDT(ADDATE,"2SZ")                      ; Format Auto-Decrease date
"RTN","RCDPEADP",237,0)
 S AMOUNT=$$GET1^DIQ(344.41,RCRZ_","_ERAIEN_",",8,"I")  ; Auto-Decrease Amount
"RTN","RCDPEADP",238,0)
 Q:+AMOUNT=0
"RTN","RCDPEADP",239,0)
 S EOBIEN=$$GET1^DIQ(344.41,RCRZ_","_ERAIEN_",",.02,"I") ; IEN to file 361.1 - ERA Detail
"RTN","RCDPEADP",240,0)
 S CLAIM=$$CLAIM(EOBIEN)                                ; Claim # 
"RTN","RCDPEADP",241,0)
 S PTNAM=$$PNM4^RCDPEWL1(ERAIEN,RCRZ)                   ; Patient Name from Claim file #399
"RTN","RCDPEADP",242,0)
 S:PTNAM="" PTNAM="(unknown)"
"RTN","RCDPEADP",243,0)
 S RCTR=RCTR+1
"RTN","RCDPEADP",244,0)
 ;
"RTN","RCDPEADP",245,0)
 ; If EXCEL sorting is done in EXCEL
"RTN","RCDPEADP",246,0)
 I EXCEL=1 D
"RTN","RCDPEADP",247,0)
 . S A1="EXCEL",A2=$G(^TMP("RCDPEADP",$J,A1))+1
"RTN","RCDPEADP",248,0)
 . S ^TMP("RCDPEADP",$J,A1)=A2
"RTN","RCDPEADP",249,0)
 ;
"RTN","RCDPEADP",250,0)
 ; Otherwise sort by DATE and selected criteria
"RTN","RCDPEADP",251,0)
 I 'EXCEL D
"RTN","RCDPEADP",252,0)
 . S A1=ADDATE
"RTN","RCDPEADP",253,0)
 . S A2=$S($E(RCSORT)="C":CLAIM,$E(RCSORT)="P":PAYNAM,1:PTNAM)
"RTN","RCDPEADP",254,0)
 ;
"RTN","RCDPEADP",255,0)
 S XX=STNAM_U_STNUM_U_CLAIM_U_PTNAM_U_PAYNAM_U_AMOUNT_U_DATE
"RTN","RCDPEADP",256,0)
 S ^TMP("RCDPEADP",$J,A1,A2,RCTR)=XX                    ; Claim Information
"RTN","RCDPEADP",257,0)
 D CARCS^RCDPEAD1(A1,A2,RCTR,CARCS)                              ; CARC information
"RTN","RCDPEADP",258,0)
 ;
"RTN","RCDPEADP",259,0)
 ; Update totals for individual date
"RTN","RCDPEADP",260,0)
 S $P(DTOTAL(ADDATE),U)=$P($G(DTOTAL(ADDATE)),U)+1
"RTN","RCDPEADP",261,0)
 S $P(DTOTAL(ADDATE),U,2)=$P($G(DTOTAL(ADDATE)),U,2)+AMOUNT
"RTN","RCDPEADP",262,0)
 ;
"RTN","RCDPEADP",263,0)
 ; Update totals for date range
"RTN","RCDPEADP",264,0)
 S $P(GTOTAL,U)=$P($G(GTOTAL),U)+1,$P(GTOTAL,U,2)=$P($G(GTOTAL),U,2)+AMOUNT
"RTN","RCDPEADP",265,0)
 Q
"RTN","RCDPEADP",266,0)
 ;
"RTN","RCDPEADP",267,0)
DISP(INPUTS,DTOTAL,GTOTAL) ; Format the display for screen/printer or MS Excel
"RTN","RCDPEADP",268,0)
 ; Input:   INPUTS  - A1^A2^A3^...^An Where:
"RTN","RCDPEADP",269,0)
 ;                       A1 -  1  - All divisions selected
"RTN","RCDPEADP",270,0)
 ;                             2  - Selected divisions
"RTN","RCDPEADP",271,0)
 ;                       A2 -  C  - Sort by Claim
"RTN","RCDPEADP",272,0)
 ;                             P  - Sort by Payer 
"RTN","RCDPEADP",273,0)
 ;                             N  - Sort by Patient Name
"RTN","RCDPEADP",274,0)
 ;                       A3 -  F  - First to Last Sort Order
"RTN","RCDPEADP",275,0)
 ;                             L  - Last to First Sort Order
"RTN","RCDPEADP",276,0)
 ;                       A4 -  B1|B2
"RTN","RCDPEADP",277,0)
 ;                             B1 - Auto-Post Start Date
"RTN","RCDPEADP",278,0)
 ;                             B2 - Auto-Post End Date
"RTN","RCDPEADP",279,0)
 ;                       A5 -  1 - Output to Excel
"RTN","RCDPEADP",280,0)
 ;                             0 - Otherwise
"RTN","RCDPEADP",281,0)
 ;          IO      - Output Device
"RTN","RCDPEADP",282,0)
 ;          DTOTAL()- Array of totals by Internal Auto-Post date
"RTN","RCDPEADP",283,0)
 ;          GTOTAL  - Grand Totals for the selected date period
"RTN","RCDPEADP",284,0)
 ;          ^TMP("RCDPEADP",$J) - See SAVE for a complete description
"RTN","RCDPEADP",285,0)
 N A1,A2,A3,DATA,EXCEL,HDRINFO,LMAN,LCNT,MODE,PAGE,RCRDNUM,STOP,Y
"RTN","RCDPEADP",286,0)
 U IO                                       ; Use the selected device
"RTN","RCDPEADP",287,0)
 S EXCEL=$P(INPUTS,"^",5),LMAN=$P(INPUTS,U,6)
"RTN","RCDPEADP",288,0)
 ;
"RTN","RCDPEADP",289,0)
 ; Header information
"RTN","RCDPEADP",290,0)
 S XX=$P(INPUTS,"^",4)                      ; Auto-Post Date range
"RTN","RCDPEADP",291,0)
 S HDRINFO("START")=$$FMTE^XLFDT($P(XX,"|",1),"2SZ")
"RTN","RCDPEADP",292,0)
 S HDRINFO("END")=$$FMTE^XLFDT($P(XX,"|",2),"2SZ")
"RTN","RCDPEADP",293,0)
 S HDRINFO("RUNDATE")=$$FMTE^XLFDT($$NOW^XLFDT,"2SZ")
"RTN","RCDPEADP",294,0)
 s XX=$P(INPUTS,"^",2)                      ; Sort Type
"RTN","RCDPEADP",295,0)
 S HDRINFO("SORT")="Sorted By: "_$S(XX="C":"Claim",XX="P":"Payer",1:"Patient Name")
"RTN","RCDPEADP",296,0)
 S XX=$S($P(INPUTS,"^",3)="L":"Last to First",1:"First to Last")
"RTN","RCDPEADP",297,0)
 S HDRINFO("SORT")=HDRINFO("SORT")_" - "_XX
"RTN","RCDPEADP",298,0)
 ;
"RTN","RCDPEADP",299,0)
 ; Format Division filter
"RTN","RCDPEADP",300,0)
 S XX=$P(INPUTS,"^",1)                      ; XX=1 - All Divisions, 2- selected
"RTN","RCDPEADP",301,0)
 S HDRINFO("DIVISIONS")=$S(XX=2:$$LINE(.RCVAUTD),1:"ALL")
"RTN","RCDPEADP",302,0)
 ;
"RTN","RCDPEADP",303,0)
 S A1="",PAGE=0,STOP=0,LCNT=1
"RTN","RCDPEADP",304,0)
 S MODE=$S($P(INPUTS,"^",3)="L":-1,1:1)     ; Mode for $ORDER direction
"RTN","RCDPEADP",305,0)
 F  D  Q:(A1="")!STOP
"RTN","RCDPEADP",306,0)
 . S A1=$O(^TMP("RCDPEADP",$J,A1))
"RTN","RCDPEADP",307,0)
 . Q:A1=""
"RTN","RCDPEADP",308,0)
 . I PAGE D ASK(.STOP,0) Q:STOP             ; Output to screen, quit if user wants to
"RTN","RCDPEADP",309,0)
 . D:'LMAN HDR^RCDPEAD1(EXCEL,.HDRINFO,.PAGE)              ; Display Header
"RTN","RCDPEADP",310,0)
 . ;
"RTN","RCDPEADP",311,0)
 . S A2=""
"RTN","RCDPEADP",312,0)
 . F  D  Q:(A2="")!STOP
"RTN","RCDPEADP",313,0)
 . . S A2=$O(^TMP("RCDPEADP",$J,A1,A2),MODE)
"RTN","RCDPEADP",314,0)
 . . I 'EXCEL,A2="",'LMAN D TOTALD^RCDPEAD1(EXCEL,.HDRINFO,.PAGE,.STOP,A1,.DTOTAL)
"RTN","RCDPEADP",315,0)
 . . Q:A2=""
"RTN","RCDPEADP",316,0)
 . . S A3=0
"RTN","RCDPEADP",317,0)
 . . F  D  Q:'A3!STOP
"RTN","RCDPEADP",318,0)
 . . . S A3=$O(^TMP("RCDPEADP",$J,A1,A2,A3))
"RTN","RCDPEADP",319,0)
 . . . Q:'A3
"RTN","RCDPEADP",320,0)
 . . . S DATA=^TMP("RCDPEADP",$J,A1,A2,A3)           ; Auto-Decreased Claim
"RTN","RCDPEADP",321,0)
 . . . I EXCEL D EXCEL(DATA,A1,A2,A3) Q              ; Output to Excel
"RTN","RCDPEADP",322,0)
 . . . I LMAN D LMAN^RCDPEAD1(DATA,A1,A2,A3,.LCNT) Q
"RTN","RCDPEADP",323,0)
 . . . I $Y>(IOSL-4) D  Q:STOP                       ; End of page
"RTN","RCDPEADP",324,0)
 . . . . D ASK(.STOP,0)
"RTN","RCDPEADP",325,0)
 . . . . Q:STOP
"RTN","RCDPEADP",326,0)
 . . . . D HDR^RCDPEAD1(EXCEL,.HDRINFO,.PAGE)
"RTN","RCDPEADP",327,0)
 . . . S Y=$E($P(DATA,U,3),1,12)                     ; Claim #
"RTN","RCDPEADP",328,0)
 . . . S $E(Y,15)=$E($P(DATA,U,4),1,20)              ; Patient Name
"RTN","RCDPEADP",329,0)
 . . . S $E(Y,37)=$E($P(DATA,U,5),1,19)              ; Payer Name
"RTN","RCDPEADP",330,0)
 . . . S $E(Y,55)=$J($P(DATA,U,6),12,2)              ; Auto-Decrease  Amount
"RTN","RCDPEADP",331,0)
 . . . S $E(Y,69)=$P(DATA,U,7)                       ; Auto-Decrease Date
"RTN","RCDPEADP",332,0)
 . . . W !,Y
"RTN","RCDPEADP",333,0)
 . . . D DCARCS(A1,A2,A3,EXCEL,.HDRINFO,.PAGE,.STOP) ; Display CARCs
"RTN","RCDPEADP",334,0)
 . . . W:'EXCEL !
"RTN","RCDPEADP",335,0)
 ;
"RTN","RCDPEADP",336,0)
 ; Grand totals
"RTN","RCDPEADP",337,0)
 I $D(GTOTAL),'LMAN D
"RTN","RCDPEADP",338,0)
 . I 'STOP,'EXCEL D                                 ; Print grand total if not Excel
"RTN","RCDPEADP",339,0)
 . . D TOTALG^RCDPEAD1(EXCEL,.HDRINFO,.PAGE,GTOTAL,.STOP)
"RTN","RCDPEADP",340,0)
 . I 'STOP D                                        ; Report finished
"RTN","RCDPEADP",341,0)
 . . W !,$$ENDORPRT^RCDPEARL,!
"RTN","RCDPEADP",342,0)
 . . D ASK(.STOP,1)
"RTN","RCDPEADP",343,0)
 ;
"RTN","RCDPEADP",344,0)
 ; Null Report
"RTN","RCDPEADP",345,0)
 I '$D(GTOTAL),'LMAN D
"RTN","RCDPEADP",346,0)
 . D HDR^RCDPEAD1(EXCEL,.HDRINFO,.PAGE)
"RTN","RCDPEADP",347,0)
 . W !!,?26,"*** No Records to Print ***",!
"RTN","RCDPEADP",348,0)
 . W !,$$ENDORPRT^RCDPEARL
"RTN","RCDPEADP",349,0)
 . S:'$D(ZTQUEUED) X=$$ASKSTOP^RCDPELAR()
"RTN","RCDPEADP",350,0)
 ;
"RTN","RCDPEADP",351,0)
 ; List manager
"RTN","RCDPEADP",352,0)
 I LMAN D
"RTN","RCDPEADP",353,0)
 .S:LCNT=1 ^TMP("RCDPE_ADP",$J,LCNT)=$J("",26)_"*** No Records to Print ***",LCNT=LCNT+1
"RTN","RCDPEADP",354,0)
 .S ^TMP("RCDPE_ADP",$J,LCNT)=" ",LCNT=LCNT+1
"RTN","RCDPEADP",355,0)
 .S ^TMP("RCDPE_ADP",$J,LCNT)=$$ENDORPRT^RCDPEARL
"RTN","RCDPEADP",356,0)
 ; Close device
"RTN","RCDPEADP",357,0)
 I '$D(ZTQUEUED) D ^%ZISC
"RTN","RCDPEADP",358,0)
 I $D(ZTQUEUED) S ZTREQ="@"
"RTN","RCDPEADP",359,0)
 Q
"RTN","RCDPEADP",360,0)
 ;
"RTN","RCDPEADP",361,0)
DCARCS(A1,A2,A3,EXCEL,HDRINFO,PAGE,STOP) ; Display detailes CARC information - added as part of PRCA*4.5*318 re-write 
"RTN","RCDPEADP",362,0)
 ; Input:   A1                  - "EXCEL" if exporting to excel
"RTN","RCDPEADP",363,0)
 ;                                Internal fileman date if not exporting to excel
"RTN","RCDPEADP",364,0)
 ;          A2                  - Excel Line Counter if exporting to excel
"RTN","RCDPEADP",365,0)
 ;                                External Claim number is sorting by claim
"RTN","RCDPEADP",366,0)
 ;                                External Payer Name if sorting by Payer
"RTN","RCDPEADP",367,0)
 ;                                External Patient Name if sorting by Patient Name
"RTN","RCDPEADP",368,0)
 ;          A3                  - Record Counter
"RTN","RCDPEADP",369,0)
 ;          EXCEL               - 1 if exporting to Excel, 0 otherwise
"RTN","RCDPEADP",370,0)
 ;          HDRINFO()           - Array of header information
"RTN","RCDPEADP",371,0)
 ;          PAGE                - Current Page number
"RTN","RCDPEADP",372,0)
 ;          ^TMP("RCDPEADP",$J) - Array of report data. See SAVE for details
"RTN","RCDPEADP",373,0)
 ; Output:  PAGE                - Updated Page number
"RTN","RCDPEADP",374,0)
 ;          STOP                - 1 if user aborts display, 0 otherwise
"RTN","RCDPEADP",375,0)
 N A4,DATA,FIRST,XX
"RTN","RCDPEADP",376,0)
 S A4="",FIRST=1
"RTN","RCDPEADP",377,0)
 F  D  Q:(A4="")!STOP
"RTN","RCDPEADP",378,0)
 . S A4=$O(^TMP("RCDPEADP",$J,A1,A2,A3,A4))
"RTN","RCDPEADP",379,0)
 . Q:A4=""
"RTN","RCDPEADP",380,0)
 . S DATA=^TMP("RCDPEADP",$J,A1,A2,A3,A4)
"RTN","RCDPEADP",381,0)
 . I 'EXCEL,$Y>(IOSL-4) D  Q:STOP           ; End of page
"RTN","RCDPEADP",382,0)
 . . D ASK(.STOP,0)
"RTN","RCDPEADP",383,0)
 . . Q:STOP
"RTN","RCDPEADP",384,0)
 . . S FIRST=1
"RTN","RCDPEADP",385,0)
 . . D HDR^RCDPEAD1(EXCEL,.HDRINFO,.PAGE,1)
"RTN","RCDPEADP",386,0)
 . I FIRST D                                ; CARC header
"RTN","RCDPEADP",387,0)
 . . S FIRST=0
"RTN","RCDPEADP",388,0)
 . . I EXCEL D  Q
"RTN","RCDPEADP",389,0)
 . . . W !!,"CARC^Decrease Amt^Quantity^Reason"
"RTN","RCDPEADP",390,0)
 . . W !!,"    CARC                  Decrease Amt    #    Reason"
"RTN","RCDPEADP",391,0)
 . . W !,"    --------------------  -------------  ----  -----------------------------"
"RTN","RCDPEADP",392,0)
 . S XX="    "_$E($P(DATA,U,1),1,20)        ; CARC
"RTN","RCDPEADP",393,0)
 . S $E(XX,27)=$J($P(DATA,U,2),12,2)        ; Decrease Amount
"RTN","RCDPEADP",394,0)
 . S $E(XX,42)=$J($P(DATA,U,3),4)           ; Quantity
"RTN","RCDPEADP",395,0)
 . S $E(XX,48)=$E($P(DATA,U,4),1,32)        ; Reason
"RTN","RCDPEADP",396,0)
 . W !,XX
"RTN","RCDPEADP",397,0)
 Q
"RTN","RCDPEADP",398,0)
 ;
"RTN","RCDPEADP",399,0)
EXCEL(DATA,A1,A2,A3) ; Format EXCEL line
"RTN","RCDPEADP",400,0)
 ; Input:   DATA - ERA line adjustment total
"RTN","RCDPEADP",401,0)
 ;          A1,A2,A3 - ^TMP("RCDPEAP") subscripts
"RTN","RCDPEADP",402,0)
 N CARCAMT,CCTR,DATA1
"RTN","RCDPEADP",403,0)
 S CCTR=0
"RTN","RCDPEADP",404,0)
 F  S CCTR=$O(^TMP("RCDPEADP",$J,A1,A2,A3,CCTR)) Q:'CCTR  D
"RTN","RCDPEADP",405,0)
 . ;Display an EXCEL line for each CARC adjustment on the line
"RTN","RCDPEADP",406,0)
 . S DATA1=$G(^TMP("RCDPEADP",$J,A1,A2,A3,CCTR)),CARCAMT=$P(DATA1,U,2)
"RTN","RCDPEADP",407,0)
 . W !,$P(DATA,U,1,5)_U_CARCAMT_U_$P(DATA,U,7)_U_DATA1
"RTN","RCDPEADP",408,0)
 Q
"RTN","RCDPEADP",409,0)
 ;
"RTN","RCDPEADP",410,0)
LINE(DIV) ; List selected stations
"RTN","RCDPEADP",411,0)
 ; Input:   DIV()       - Array of selected divisions
"RTN","RCDPEADP",412,0)
 ; Returns: Comma delimited list of selected divisions
"RTN","RCDPEADP",413,0)
 N LINE,P,SUB
"RTN","RCDPEADP",414,0)
 S LINE="",SUB="",P=0
"RTN","RCDPEADP",415,0)
 F  D  Q:'SUB
"RTN","RCDPEADP",416,0)
 . S SUB=$O(DIV(SUB))
"RTN","RCDPEADP",417,0)
 . Q:'SUB
"RTN","RCDPEADP",418,0)
 . S P=P+1,$P(LINE,", ",P)=$G(DIV(SUB))
"RTN","RCDPEADP",419,0)
 Q LINE
"RTN","RCDPEADP",420,0)
 ;
"RTN","RCDPEADP",421,0)
ASK(STOP,TYP) ; Ask to continue, if TYP=1 then prompt to finish
"RTN","RCDPEADP",422,0)
 ; Input:   TYP     - 1 - Prompt to finish, 0 Otherwise
"RTN","RCDPEADP",423,0)
 ;          IOST    - Device Type
"RTN","RCDPEADP",424,0)
 ; Output:  STOP    - 1 to abort print, 0 otherwise
"RTN","RCDPEADP",425,0)
 N DIR,DIROUT,DIRUT,DTOUT,DUOUT
"RTN","RCDPEADP",426,0)
 Q:$E(IOST,1,2)'["C-"                               ; Not a terminal
"RTN","RCDPEADP",427,0)
 S:$G(TYP)=1 DIR("A")="Enter RETURN to finish"
"RTN","RCDPEADP",428,0)
 S DIR(0)="E"
"RTN","RCDPEADP",429,0)
 W !
"RTN","RCDPEADP",430,0)
 D ^DIR
"RTN","RCDPEADP",431,0)
 I ($D(DIRUT))!($D(DUOUT)) S STOP=1
"RTN","RCDPEADP",432,0)
 Q
"RTN","RCDPEADP",433,0)
 ;
"RTN","RCDPEADP",434,0)
CLAIM(EOBIEN) ; Gets the claim number from AR
"RTN","RCDPEADP",435,0)
 ; Input:   EOBIEN      - Internal IEN for file 361.1
"RTN","RCDPEADP",436,0)
 ; Returns: External Claim Number
"RTN","RCDPEADP",437,0)
 N CLAIM,CLAIMIEN
"RTN","RCDPEADP",438,0)
 Q:'$G(EOBIEN)>0 "(no EOB IEN)"
"RTN","RCDPEADP",439,0)
 S CLAIMIEN=$$GET1^DIQ(361.1,EOBIEN,.01,"I")    ; IEN for file 399
"RTN","RCDPEADP",440,0)
 Q:'CLAIMIEN "(no Claim IEN)"
"RTN","RCDPEADP",441,0)
 S CLAIM=$$GET1^DIQ(430,CLAIMIEN,.01,"I")
"RTN","RCDPEADP",442,0)
 Q:CLAIM="" "(Claim not found)"
"RTN","RCDPEADP",443,0)
 Q CLAIM                                        ; Return claim (nnn-Knnnnnn)
"RTN","RCDPEADP",444,0)
 ;
"RTN","RCDPEAP")
0^2^B225459503^B218588559
"RTN","RCDPEAP",1,0)
RCDPEAP ;ALB/PJH - AUTO POST MATCHING EFT ERA PAIR ;Oct 15, 2014@12:36:51
"RTN","RCDPEAP",2,0)
 ;;4.5;Accounts Receivable;**298,304,318**;Mar 20, 1995;Build 37
"RTN","RCDPEAP",3,0)
 ;Per VA Directive 6402, this routine should not be modified.
"RTN","RCDPEAP",4,0)
 ;Read ^IBM(361.1) via Private IA 4051
"RTN","RCDPEAP",5,0)
 ;
"RTN","RCDPEAP",6,0)
EN ;Auto-post ERA Receipts
"RTN","RCDPEAP",7,0)
 ;Process newly matched and matched but unprocessed ERAs
"RTN","RCDPEAP",8,0)
 D EN1
"RTN","RCDPEAP",9,0)
 ;Process previously processed ERA's
"RTN","RCDPEAP",10,0)
 D EN2
"RTN","RCDPEAP",11,0)
 Q
"RTN","RCDPEAP",12,0)
 ;
"RTN","RCDPEAP",13,0)
EN1 ;Auto-post newly matched and matched but unprocessed ERA
"RTN","RCDPEAP",14,0)
 N RCRZ,RCEFTDA
"RTN","RCDPEAP",15,0)
 S RCRZ=0
"RTN","RCDPEAP",16,0)
 ;Scan ERA file for auto-post candidates with AUTO-POST STATUS = UNPOSTED
"RTN","RCDPEAP",17,0)
 F  S RCRZ=$O(^RCY(344.4,"E",0,RCRZ)) Q:'RCRZ  D
"RTN","RCDPEAP",18,0)
 .;Get EFT reference
"RTN","RCDPEAP",19,0)
 .S RCEFTDA=$O(^RCY(344.31,"AERA",RCRZ,"")) Q:'RCEFTDA
"RTN","RCDPEAP",20,0)
 .;Check that EFT funds were posted to FMS and Accepted by FMS.  If not, quit and go to next unposted ERA
"RTN","RCDPEAP",21,0)
 .N RCOK,RCDEPTDA,RCRECTDA
"RTN","RCDPEAP",22,0)
 .S RCOK=1
"RTN","RCDPEAP",23,0)
 .I $P($G(^RCY(344.3,+$G(^RCY(344.31,+RCEFTDA,0)),0)),U,8),$P($G(^RCY(344.31,+RCEFTDA,0)),U,7) D  Q:'RCOK
"RTN","RCDPEAP",24,0)
 ..S RCDEPTDA=+$P($G(^RCY(344.3,+$G(^RCY(344.31,+RCEFTDA,0)),0)),U,3),RCRECTDA=+$O(^RCY(344,"AD",+RCDEPTDA,0)) ; Get deposit ticket and EFT receipt (CR - 8NZZ)
"RTN","RCDPEAP",25,0)
 ..I RCRECTDA N Z S Z=$P($$FMSSTAT^RCDPUREC(RCRECTDA),U,2) I $E(Z)="A" Q  ; EFT Accepted by FMS
"RTN","RCDPEAP",26,0)
 ..S RCOK=0
"RTN","RCDPEAP",27,0)
 .;
"RTN","RCDPEAP",28,0)
 .;Auto-Post
"RTN","RCDPEAP",29,0)
 .D AUTOPOST(RCEFTDA,RCRZ)
"RTN","RCDPEAP",30,0)
 Q
"RTN","RCDPEAP",31,0)
 ;
"RTN","RCDPEAP",32,0)
 ; Process ERA
"RTN","RCDPEAP",33,0)
AUTOPOST(RCEFTDA,RCERA) ; 
"RTN","RCDPEAP",34,0)
 ; RCEFTDA = ien of file #344.31
"RTN","RCDPEAP",35,0)
 ; RCERA = ien of file #344.4
"RTN","RCDPEAP",36,0)
 ;
"RTN","RCDPEAP",37,0)
 ;Lock ERA
"RTN","RCDPEAP",38,0)
 L +^RCY(344.4,RCERA):5 Q:'$T
"RTN","RCDPEAP",39,0)
 ;
"RTN","RCDPEAP",40,0)
 ;Build Scratchpad and Verify Lines
"RTN","RCDPEAP",41,0)
 N ALLOK,RCERR,RCLINES,RCRCPTDA,RCSCR,RCTRDA,ZEROBAL ; PRCA*4.5*318 Variables placed in alpha order
"RTN","RCDPEAP",42,0)
 K ^TMP($J,"RCDPEWLA")
"RTN","RCDPEAP",43,0)
 S RCSCR=$$SCRPAD(RCERA)
"RTN","RCDPEAP",44,0)
 ; Re-set AUTO-POST STATUS  if unable to create scratchpad
"RTN","RCDPEAP",45,0)
 I 'RCSCR D SETSTA(RCERA,"@","Auto Posting: Removed from Auto Posting-Unable to create scratchpad") G AUTOQ
"RTN","RCDPEAP",46,0)
 ;
"RTN","RCDPEAP",47,0)
 ; ERA cannot be autoposted; remove any pre-existing value to the AUTO-POST STATUS so ERA can be processed manually in the Worklist
"RTN","RCDPEAP",48,0)
 I $D(^TMP($J,"RCDPEWLA","ERA LEVEL ADJUSTMENT EXISTS")) D SETSTA(RCERA,"@","Auto Posting: Removed from Auto Posting-ERA level Adjustment(s)") G AUTOQ
"RTN","RCDPEAP",49,0)
 ;
"RTN","RCDPEAP",50,0)
 ; If ERA is unbalanced, do not auto-post
"RTN","RCDPEAP",51,0)
 I $$UNBAL^RCDPEAP1(RCERA) D UNLOCKE Q  ; PRCA*4.5*318 Added line 
"RTN","RCDPEAP",52,0)
 ;
"RTN","RCDPEAP",53,0)
 ;Check if all lines can be posted
"RTN","RCDPEAP",54,0)
 S ALLOK=$$ALLOK(RCERA,RCSCR,.ZEROBAL,.RCLINES)
"RTN","RCDPEAP",55,0)
 ;
"RTN","RCDPEAP",56,0)
 ;If $$ALLOK post entire ERA and reset AUTO-POST STATUS = COMPLETE
"RTN","RCDPEAP",57,0)
 I ALLOK D POSTALL(RCERA)
"RTN","RCDPEAP",58,0)
 ;
"RTN","RCDPEAP",59,0)
 ; If 'ALLOK and 'ZEROBAL(matching positive/negative pairs to not balance out to zero), then ERA needs to go to the standard worklist for manual receipt processing
"RTN","RCDPEAP",60,0)
 I 'ALLOK,'ZEROBAL D SETSTA(RCERA,"@","Auto Posting: Removed from Auto Posting-+/- pairs do not balance") G AUTOQ
"RTN","RCDPEAP",61,0)
 ;
"RTN","RCDPEAP",62,0)
 ;If 'ALLOK and some of the lines passed validation then post receipt to summary ERA and set AUTO-POST STATUS = PARTIAL
"RTN","RCDPEAP",63,0)
 ;Un-posted lines fall to APAR list for processing.
"RTN","RCDPEAP",64,0)
 I 'ALLOK D POSTERA(RCERA,.RCLINES)
"RTN","RCDPEAP",65,0)
 ;Unlock ERA
"RTN","RCDPEAP",66,0)
AUTOQ D UNLOCKE
"RTN","RCDPEAP",67,0)
 Q
"RTN","RCDPEAP",68,0)
 ;
"RTN","RCDPEAP",69,0)
EN2 ;Auto-Post Previously Processed ERA
"RTN","RCDPEAP",70,0)
 N AUTORCPT,CLAIM,COMPLETE,EOBIEN,RCERA,RCIFN,RCRCPTDA,RCLINES
"RTN","RCDPEAP",71,0)
 S RCERA=0,AUTORCPT=1 ;Variable AUTORCPT suppresses #344 trigger update to ERA receipt field
"RTN","RCDPEAP",72,0)
 ;Scan ERA file for auto-post candidates with AUTO-POST STATUS = PARTIAL
"RTN","RCDPEAP",73,0)
 F  S RCERA=$O(^RCY(344.4,"E",1,RCERA)) Q:'RCERA  D
"RTN","RCDPEAP",74,0)
 . ;Ignore if it was just partially posted in POSTLNS so we do not process again
"RTN","RCDPEAP",75,0)
 . Q:$D(^TMP("RCDPEAP",$J,RCERA))
"RTN","RCDPEAP",76,0)
 . ;Set receipt variable to null for each ERA so that the receipt number from the previous ERA is not hanging around
"RTN","RCDPEAP",77,0)
 . S RCRCPTDA=""
"RTN","RCDPEAP",78,0)
 . ;Check if there are lines that are set for auto-posting and if they can be posted or have errors.
"RTN","RCDPEAP",79,0)
 . K RCLINES
"RTN","RCDPEAP",80,0)
 . S RCLINES=0
"RTN","RCDPEAP",81,0)
 . D VALID^RCDPEAP1(RCERA,.RCLINES)
"RTN","RCDPEAP",82,0)
 . ;If valid lines found create receipt for those lines (Variable RCLINES is only incremented for valid lines)
"RTN","RCDPEAP",83,0)
 . I RCLINES D
"RTN","RCDPEAP",84,0)
 . . N RCEFTDA,RCDEPTDA,RCRECTDA
"RTN","RCDPEAP",85,0)
 . . ;Get EFT reference
"RTN","RCDPEAP",86,0)
 . . S RCEFTDA=$O(^RCY(344.31,"AERA",RCERA,"")) Q:'RCEFTDA
"RTN","RCDPEAP",87,0)
 . . ;Get deposit ticket and EFT receipt
"RTN","RCDPEAP",88,0)
 . . S RCDEPTDA=+$P($G(^RCY(344.3,+$G(^RCY(344.31,+RCEFTDA,0)),0)),U,3),RCRECTDA=+$O(^RCY(344,"AD",+RCDEPTDA,0))
"RTN","RCDPEAP",89,0)
 . . ;ERA Receipt is created from scratchpad entry - type 14 is EDI Lockbox payment
"RTN","RCDPEAP",90,0)
 . . S RCRCPTDA=$$BLDRCPT^RCDPEMA(RCERA) ; Creates basic receipt for ERA of payment type EDI LOCKBOX; 2nd parameter means an alpha suffix on receipt number
"RTN","RCDPEAP",91,0)
 . . I 'RCRCPTDA Q  ;PRCA*4.5*318 - Problem building receipt header
"RTN","RCDPEAP",92,0)
 . . K RCERR
"RTN","RCDPEAP",93,0)
 . . D RCPTDET^RCDPEMA(RCERA,RCRCPTDA,.RCLINES,.RCERR) ; Adds detail to a receipt based on file 344.49 and RCLINES array
"RTN","RCDPEAP",94,0)
 . . ;;Unable to create receipt - clear scratchpad, reset AUTO-POST STATUS = NULL - PRCA*4.5*318 - replaced following line
"RTN","RCDPEAP",95,0)
 . . ;;I $O(RCERR("")) D CLEAR(RCSCR),SETSTA(RCERA,"@","Auto Posting: Removed from Auto Posting-Unable to create receipt") Q
"RTN","RCDPEAP",96,0)
 . . I $O(RCERR("")) Q  ; PRCA*4.5*318 - Do not attempt to process partially filed receipt
"RTN","RCDPEAP",97,0)
 . . ;Lock ERA receipt and deposit ticket
"RTN","RCDPEAP",98,0)
 . . I '$$LOCKREC^RCDPRPLU(RCRCPTDA) Q
"RTN","RCDPEAP",99,0)
 . . I '$$LOCKDEP^RCDPDPLU(RCDEPTDA) D UNLOCKR Q
"RTN","RCDPEAP",100,0)
 . . ;Process Receipt to FMS
"RTN","RCDPEAP",101,0)
 . . D PROCESS^RCDPURE1(RCRCPTDA,2) I $D(^TMP("RCDPE-RECEIPT-ERROR",$J)) D UNLOCKR Q
"RTN","RCDPEAP",102,0)
 . . ; update 344, .18 ERA REFERENCE field
"RTN","RCDPEAP",103,0)
 . . D ERAREF(RCERA,RCRCPTDA)
"RTN","RCDPEAP",104,0)
 . . ;Unlock deposit ticket and receipt
"RTN","RCDPEAP",105,0)
 . . D UNLOCKR
"RTN","RCDPEAP",106,0)
 . ;Update ERA and ERA detail lines with receipt # or auto-post rejection reason
"RTN","RCDPEAP",107,0)
 . D ERADET^RCDPEAP1(RCERA,RCRCPTDA,.RCLINES)
"RTN","RCDPEAP",108,0)
 . ;Determine if posting complete for this ERA
"RTN","RCDPEAP",109,0)
 . S COMPLETE=$$COMPLETE(RCERA)
"RTN","RCDPEAP",110,0)
 . ;If complete update ERA detail post status to POSTED
"RTN","RCDPEAP",111,0)
 . I COMPLETE S DIE="^RCY(344.4,",DR=".14////1",DA=RCERA D ^DIE
"RTN","RCDPEAP",112,0)
 . ;Update the audit log
"RTN","RCDPEAP",113,0)
 . D AUDITLOG(RCERA,$S(COMPLETE:2,1:1),"Auto Posting: Previously processed ERA posting attempt")
"RTN","RCDPEAP",114,0)
 . ;Set ERA auto-post status and update latest auto-post date
"RTN","RCDPEAP",115,0)
 . S DIE="^RCY(344.4,",DR="4.01////"_DT_";4.02////"_$S(COMPLETE:2,1:1),DA=RCERA D ^DIE
"RTN","RCDPEAP",116,0)
 ;Unlock ERA
"RTN","RCDPEAP",117,0)
 D UNLOCKE
"RTN","RCDPEAP",118,0)
 Q
"RTN","RCDPEAP",119,0)
 ;
"RTN","RCDPEAP",120,0)
 ;Functions/Sub-routines in alpha order
"RTN","RCDPEAP",121,0)
 ;
"RTN","RCDPEAP",122,0)
ACTIVE(EOBIEN) ;Verify claim is active
"RTN","RCDPEAP",123,0)
 ; EOBIEN - IEN of file 361.1
"RTN","RCDPEAP",124,0)
 N RCIFN,RCBILL,RCSTATUS
"RTN","RCDPEAP",125,0)
 ;Get EOB number (implies this is 3rd Party claim)
"RTN","RCDPEAP",126,0)
 I 'EOBIEN Q 0
"RTN","RCDPEAP",127,0)
 ;Get #399 claim number from EOB
"RTN","RCDPEAP",128,0)
 S RCIFN=$P($G(^IBM(361.1,EOBIEN,0)),U) Q:'RCIFN 0
"RTN","RCDPEAP",129,0)
 S RCBILL=$P($G(^DGCR(399,RCIFN,0)),U) Q:RCBILL="" 0  ; IA 4051
"RTN","RCDPEAP",130,0)
 ;Check if bill is cancelled or closed
"RTN","RCDPEAP",131,0)
 S RCSTATUS=$P($G(^DGCR(399,RCIFN,0)),U,13)
"RTN","RCDPEAP",132,0)
 Q $S(RCSTATUS=0:0,RCSTATUS=7:0,1:1)
"RTN","RCDPEAP",133,0)
 ; 
"RTN","RCDPEAP",134,0)
ALLOK(RCERA,RCSCR,ZEROBAL,RCLINES) ;Verify which scratchpad lines are able to auto-post
"RTN","RCDPEAP",135,0)
 ; RCERA - 344.4 ien
"RTN","RCDPEAP",136,0)
 ; RCSCR - 344.49 ien
"RTN","RCDPEAP",137,0)
 ; ZEROBAL - flag that represents if ERA has zero payment balance after processing matched positive/negative pairs, passed by reference
"RTN","RCDPEAP",138,0)
 ; RCLINES - array of ERA line references (passed in by reference)
"RTN","RCDPEAP",139,0)
 ;           NOTE:  ORIGINAL ERA SEQUENCES (344.491, .09) can have multiple ERA line references separated by commas (e.g., 3,4)
"RTN","RCDPEAP",140,0)
 ; returns 0 or 1 (ALLOK)
"RTN","RCDPEAP",141,0)
 N ALLOK,AMT,ERALINE,STATUS,SUB,SUB1,CLAIM,WLINE,VERIFY
"RTN","RCDPEAP",142,0)
 K CLARRAY
"RTN","RCDPEAP",143,0)
 S (ZEROBAL,ALLOK)=1
"RTN","RCDPEAP",144,0)
 S (SUB,RCLINES)=0
"RTN","RCDPEAP",145,0)
 F  S SUB=$O(^RCY(344.49,RCSCR,1,"B",SUB)) Q:SUB=""  D
"RTN","RCDPEAP",146,0)
 . ;Get scratchpad line and data
"RTN","RCDPEAP",147,0)
 . S SUB1=$O(^RCY(344.49,RCSCR,1,"B",SUB,"")) Q:'SUB1  S WLINE=$G(^RCY(344.49,RCSCR,1,SUB1,0)),AMT=$P(WLINE,U,3)
"RTN","RCDPEAP",148,0)
 . ;If integer sequence, get ERA line reference and verify flag and then quit for this sequence and go on to the non-integer sequence to finish validation
"RTN","RCDPEAP",149,0)
 . I $P(WLINE,U)?1N.N S VERIFY=1 S ERALINE=$P(WLINE,U,9) S:'$P(WLINE,U,13) ALLOK=0,RCLINES(ERALINE)="0^^1",VERIFY=0 Q
"RTN","RCDPEAP",150,0)
 . ; ignore zero valued lines
"RTN","RCDPEAP",151,0)
 . Q:AMT=0  Q:AMT="0.00"
"RTN","RCDPEAP",152,0)
 . ;Get claim number from N.001 line - if not found treat as inactive
"RTN","RCDPEAP",153,0)
 . S CLAIM=$P(WLINE,U,7) I 'CLAIM S ALLOK=0,$P(RCLINES(ERALINE),U,3)=2 Q
"RTN","RCDPEAP",154,0)
 . ;Save claim number
"RTN","RCDPEAP",155,0)
 . S $P(RCLINES(ERALINE),U,2)=$P($G(^PRCA(430,CLAIM,0)),U) Q:'VERIFY
"RTN","RCDPEAP",156,0)
 . ;Claim must be OPEN or ACTIVE
"RTN","RCDPEAP",157,0)
 . S STATUS=$P($G(^PRCA(430,CLAIM,0)),"^",8) I STATUS'=42,STATUS'=16 S ALLOK=0,$P(RCLINES(ERALINE),U,3)=2 Q
"RTN","RCDPEAP",158,0)
 . ;Check that payment does not exceed balance and no pending payments (at the time of auto posting)
"RTN","RCDPEAP",159,0)
 . S CLARRAY(CLAIM)=+$G(CLARRAY(CLAIM))+$P(WLINE,U,3) I '$$CHECKPAY(.CLARRAY,CLAIM) S ALLOK=0,$P(RCLINES(ERALINE),U,3)=3 Q
"RTN","RCDPEAP",160,0)
 . ;Check if referred to general council
"RTN","RCDPEAP",161,0)
 . I $P($G(^PRCA(430,CLAIM,6)),U,4)]"" S ALLOK=0,$P(RCLINES(ERALINE),U,3)=4 Q
"RTN","RCDPEAP",162,0)
 . ;Line is potentially postable
"RTN","RCDPEAP",163,0)
 . S $P(RCLINES(ERALINE),U)=1,$P(RCLINES(ERALINE),U,3)=$P(WLINE,U,6),RCLINES=$G(RCLINES)+1
"RTN","RCDPEAP",164,0)
 Q ALLOK
"RTN","RCDPEAP",165,0)
 ;
"RTN","RCDPEAP",166,0)
AUDITLOG(DA,RCNEWST,RCREASON) ;
"RTN","RCDPEAP",167,0)
 ; Update the Auto-post Audit Log
"RTN","RCDPEAP",168,0)
 ;
"RTN","RCDPEAP",169,0)
 I '$G(DA) Q
"RTN","RCDPEAP",170,0)
 I $G(RCREASON)="" Q
"RTN","RCDPEAP",171,0)
 ;
"RTN","RCDPEAP",172,0)
 N RCAUDIT,RCOLDST,DIE,DR,X,Y,DTOUT,DUOUT,DROUT,DIRUT
"RTN","RCDPEAP",173,0)
 ; Get the current status
"RTN","RCDPEAP",174,0)
 S RCOLDST=$$GET1^DIQ(344.4,DA_",",4.02,"I")
"RTN","RCDPEAP",175,0)
 ; If the new status is null, set to old status (no change)
"RTN","RCDPEAP",176,0)
 I $G(RCNEWST)="" S RCNEWST=RCOLDST
"RTN","RCDPEAP",177,0)
 ; File
"RTN","RCDPEAP",178,0)
 S RCAUDIT(344.72,"+1,",.01)=$$NOW^XLFDT ;Date/Time Stamp
"RTN","RCDPEAP",179,0)
 S RCAUDIT(344.72,"+1,",.02)=DUZ         ;User
"RTN","RCDPEAP",180,0)
 S RCAUDIT(344.72,"+1,",.03)=DA          ;ERA #
"RTN","RCDPEAP",181,0)
 S RCAUDIT(344.72,"+1,",.04)=RCOLDST     ;Old Status
"RTN","RCDPEAP",182,0)
 I RCNEWST'="@" S RCAUDIT(344.72,"+1,",.05)=RCNEWST ;New status
"RTN","RCDPEAP",183,0)
 S RCAUDIT(344.72,"+1,",.06)=$E(RCREASON,1,80) ;Reason text
"RTN","RCDPEAP",184,0)
 D UPDATE^DIE(,"RCAUDIT")
"RTN","RCDPEAP",185,0)
 Q
"RTN","RCDPEAP",186,0)
 ;
"RTN","RCDPEAP",187,0)
BUILD(RCSCR,ARRAY) ;Build list of ERA lines
"RTN","RCDPEAP",188,0)
 ;
"RTN","RCDPEAP",189,0)
 ; RCSCR = ien of file 344.49
"RTN","RCDPEAP",190,0)
 ; ARRAY = the array that will hold the list of ERA lines, passed by reference
"RTN","RCDPEAP",191,0)
 ;
"RTN","RCDPEAP",192,0)
 N FOUND,SCRLINE,SUB,SUB1
"RTN","RCDPEAP",193,0)
 K ARRAY
"RTN","RCDPEAP",194,0)
 S SUB=0,ARRAY=0
"RTN","RCDPEAP",195,0)
 F  S SUB=$O(^RCY(344.49,RCSCR,1,"B",SUB)) Q:SUB=""  D:SUB'["."
"RTN","RCDPEAP",196,0)
 . ;Get actual scratchpad ^RCY(344.49,RCSCR,1) node
"RTN","RCDPEAP",197,0)
 . S SUB1=$O(^RCY(344.49,RCSCR,1,"B",SUB,"")) Q:'SUB1
"RTN","RCDPEAP",198,0)
 . ;Ignore zero lines
"RTN","RCDPEAP",199,0)
 . Q:'$P($G(^RCY(344.49,RCSCR,1,SUB1,0)),U,3)
"RTN","RCDPEAP",200,0)
 . ;Index scratchpad line by ERA sequence
"RTN","RCDPEAP",201,0)
 . S ARRAY($P($G(^RCY(344.49,RCSCR,1,SUB1,0)),U,9))=SUB1,ARRAY=$G(ARRAY)+1
"RTN","RCDPEAP",202,0)
 Q
"RTN","RCDPEAP",203,0)
 ;
"RTN","RCDPEAP",204,0)
CHECKPAY(ARRAY,CLAIM) ;Check balance versus payments
"RTN","RCDPEAP",205,0)
 ; ARRAY = array of claim numbers and respective payment amounts
"RTN","RCDPEAP",206,0)
 ;         e.g. ARRAY(430 ien) = 123.04
"RTN","RCDPEAP",207,0)
 ; CLAIM = AR BILL (344.491, .07) - IEN of file 430
"RTN","RCDPEAP",208,0)
 Q:'CLAIM 0
"RTN","RCDPEAP",209,0)
 ; get the payment amount to be posted to the claim
"RTN","RCDPEAP",210,0)
 S AMT=ARRAY(CLAIM)
"RTN","RCDPEAP",211,0)
 ;Payment exceeds principle balance
"RTN","RCDPEAP",212,0)
 Q:AMT>$P($G(^PRCA(430,CLAIM,7)),U) 0
"RTN","RCDPEAP",213,0)
 ;Check pending payments for claim
"RTN","RCDPEAP",214,0)
 N PENDING S PENDING=$$PENDPAY^RCDPURET(CLAIM) K ^TMP($J,"RCDPUREC","PP")
"RTN","RCDPEAP",215,0)
 ;Pending payments is > billed
"RTN","RCDPEAP",216,0)
 I PENDING>AMT Q 0
"RTN","RCDPEAP",217,0)
 ;otherwise OK to post payment
"RTN","RCDPEAP",218,0)
 Q 1
"RTN","RCDPEAP",219,0)
 ; 
"RTN","RCDPEAP",220,0)
CLEAR(DA) ;Clear scratchpad
"RTN","RCDPEAP",221,0)
 N DIK S DIK="^RCY(344.49," D ^DIK
"RTN","RCDPEAP",222,0)
 Q
"RTN","RCDPEAP",223,0)
 ;
"RTN","RCDPEAP",224,0)
COMPLETE(RCSCR) ;Check for non-zero lines without a receipt
"RTN","RCDPEAP",225,0)
 ;
"RTN","RCDPEAP",226,0)
 ; RCSCR = ien of file 344.49
"RTN","RCDPEAP",227,0)
 ; Returns status of check (1 or 0)
"RTN","RCDPEAP",228,0)
 N RCSUB,SCRSUB,COMPLETE,SCRLINE,RCERA
"RTN","RCDPEAP",229,0)
 ;Default to complete
"RTN","RCDPEAP",230,0)
 S SCRSUB=0,COMPLETE=1,RCERA=RCSCR
"RTN","RCDPEAP",231,0)
 ;Scan scratchpad
"RTN","RCDPEAP",232,0)
 F  S SCRSUB=$O(^RCY(344.49,RCSCR,1,SCRSUB)) Q:'SCRSUB  D  Q:'COMPLETE
"RTN","RCDPEAP",233,0)
 . ;Ignore zero and split lines (splitting line should not change balance)
"RTN","RCDPEAP",234,0)
 . S SCRLINE=$G(^RCY(344.49,RCSCR,1,SCRSUB,0)) Q:$P(SCRLINE,U)'?1N.N  Q:$P(SCRLINE,U,3)=0  Q:$P(SCRLINE,U,3)="0.00"
"RTN","RCDPEAP",235,0)
 . ;Check if non-zero line has receipt on ERA, DETAIL line
"RTN","RCDPEAP",236,0)
 . S RCSUB=$P(SCRLINE,U,9) I RCSUB,$P($G(^RCY(344.4,RCERA,1,RCSUB,4)),U,3)]"" Q
"RTN","RCDPEAP",237,0)
 . ;Otherwise more AUTO-posting to do
"RTN","RCDPEAP",238,0)
 . S COMPLETE=0
"RTN","RCDPEAP",239,0)
 Q COMPLETE
"RTN","RCDPEAP",240,0)
 ;
"RTN","RCDPEAP",241,0)
ERAREF(RCSCR,RCRCPTDA) ; update ERA reference and EFT record IEN in file 344
"RTN","RCDPEAP",242,0)
 ; RCSCR - IEN of record in file 344.49
"RTN","RCDPEAP",243,0)
 ; RCRCPTDA - ien of record in file 344 (receipt ien)
"RTN","RCDPEAP",244,0)
 N Z,DR,DIE,DA
"RTN","RCDPEAP",245,0)
 S Z=+$O(^RCY(344.31,"AERA",RCSCR,0))
"RTN","RCDPEAP",246,0)
 S DIE="^RCY(344,",DA=RCRCPTDA,DR=".18////"_RCSCR_$S(Z:";.17////"_Z,1:"") D ^DIE
"RTN","RCDPEAP",247,0)
 Q
"RTN","RCDPEAP",248,0)
 ;
"RTN","RCDPEAP",249,0)
NOTOK(RCSCR) ;Verify all scratchpad lines passed auto verify (V)
"RTN","RCDPEAP",250,0)
 ;
"RTN","RCDPEAP",251,0)
 ; RCSCR = ien of file 344.49
"RTN","RCDPEAP",252,0)
 ; Returns status of check (1 or 0)
"RTN","RCDPEAP",253,0)
 N NOTOK,SUB
"RTN","RCDPEAP",254,0)
 S SUB=0,NOTOK=0
"RTN","RCDPEAP",255,0)
 F  S SUB=$O(^RCY(344.49,RCSCR,1,SUB)) Q:'SUB  D  Q:NOTOK
"RTN","RCDPEAP",256,0)
 . ;Set NOTOK if any single line is unverified
"RTN","RCDPEAP",257,0)
 . S:$P($G(^RCY(344.49,RCSCR,1,SUB,0)),U,13)'=1 NOTOK=1
"RTN","RCDPEAP",258,0)
 Q NOTOK
"RTN","RCDPEAP",259,0)
 ;
"RTN","RCDPEAP",260,0)
POSTALL(RCERA) ; all lines in ERA get posted on first attempt of auto-post
"RTN","RCDPEAP",261,0)
 ;
"RTN","RCDPEAP",262,0)
 ; RCERA = ien of 344.4
"RTN","RCDPEAP",263,0)
 ;
"RTN","RCDPEAP",264,0)
 ;ERA Receipt is created from scratchpad entry - type 14 is EDI Lockbox payment
"RTN","RCDPEAP",265,0)
 S RCRCPTDA=$$BLDRCPT^RCDPUREC(DT,"",+$O(^RC(341.1,"AC",14,0)))  ; Creates basic receipt for ERA of payment type EDI LOCKBOX; 2nd parameter means no alpha suffix on receipt number
"RTN","RCDPEAP",266,0)
 D RCPTDET^RCDPEM(RCSCR,RCRCPTDA,.RCERR) ; Adds detail to a receipt based on file 344.49
"RTN","RCDPEAP",267,0)
 ;
"RTN","RCDPEAP",268,0)
 ;Unable to create receipt - clear scratchpad, reset AUTO-POST STATUS = NULL
"RTN","RCDPEAP",269,0)
 I $O(RCERR("")) D CLEAR(RCSCR),SETSTA(RCERA,"@","Auto Posting: Removed from Auto Posting-Unable to create receipt") Q
"RTN","RCDPEAP",270,0)
 ;
"RTN","RCDPEAP",271,0)
 ;Lock ERA receipt and deposit ticket
"RTN","RCDPEAP",272,0)
 I '$$LOCKREC^RCDPRPLU(RCRCPTDA) Q
"RTN","RCDPEAP",273,0)
 I '$$LOCKDEP^RCDPDPLU(RCDEPTDA) D UNLOCKR Q
"RTN","RCDPEAP",274,0)
 ;
"RTN","RCDPEAP",275,0)
 ;Process Receipt to FMS
"RTN","RCDPEAP",276,0)
 D PROCESS^RCDPURE1(RCRCPTDA,2)
"RTN","RCDPEAP",277,0)
 I $D(^TMP("RCDPE-RECEIPT-ERROR",$J)) D CLEAR(RCSCR),SETSTA(RCERA,"@","Auto Posting: Removed from Auto Posting-Error in receipt processing"),UNLOCKR Q
"RTN","RCDPEAP",278,0)
 ;
"RTN","RCDPEAP",279,0)
 ; update 344, .18 ERA REFERENCE field
"RTN","RCDPEAP",280,0)
 D ERAREF(RCSCR,RCRCPTDA)
"RTN","RCDPEAP",281,0)
 ;
"RTN","RCDPEAP",282,0)
 ;Unlock deposit ticket and receipt
"RTN","RCDPEAP",283,0)
 D UNLOCKR
"RTN","RCDPEAP",284,0)
 ;
"RTN","RCDPEAP",285,0)
 ;Update the audit log
"RTN","RCDPEAP",286,0)
 D AUDITLOG(RCERA,2,"Auto Posting: ERA posted successfully")
"RTN","RCDPEAP",287,0)
 ;Update ERA receipt and detail post status
"RTN","RCDPEAP",288,0)
 S DIE="^RCY(344.4,",DR=".14////1;.08////"_RCRCPTDA,DA=RCERA D ^DIE
"RTN","RCDPEAP",289,0)
 ;Set ERA auto-post status to 'complete' and update latest auto-post date
"RTN","RCDPEAP",290,0)
 S DIE="^RCY(344.4,",DR="4.01////"_DT_";4.02////2",DA=RCERA D ^DIE
"RTN","RCDPEAP",291,0)
 ;Update auto-post date for each claim line
"RTN","RCDPEAP",292,0)
 N RCLINE,RCSCSUB,RCSCD0
"RTN","RCDPEAP",293,0)
 S RCSCSUB=0
"RTN","RCDPEAP",294,0)
 F  S RCSCSUB=$O(^RCY(344.49,RCERA,1,RCSCSUB)) Q:'RCSCSUB  D
"RTN","RCDPEAP",295,0)
 . S RCSCD0=$G(^RCY(344.49,RCERA,1,RCSCSUB,0))
"RTN","RCDPEAP",296,0)
 . ;Ignore if zero value (line not on receipt) otherwise get original ERA line sequence
"RTN","RCDPEAP",297,0)
 . Q:'+$P(RCSCD0,U,3)  S RCLINE=$P(RCSCD0,U,9) Q:'RCLINE
"RTN","RCDPEAP",298,0)
 . ;Update ERA line with receipt number and auto-post date
"RTN","RCDPEAP",299,0)
 . N DA,DIE,DR S DA(1)=RCERA,DA=RCLINE,DIE="^RCY(344.4,"_DA(1)_",1,",DR=".25////"_RCRCPTDA_";9////"_DT D ^DIE
"RTN","RCDPEAP",300,0)
 Q
"RTN","RCDPEAP",301,0)
 ;
"RTN","RCDPEAP",302,0)
POSTERA(RCERA,RCLINES) ; only some of the EEOB lines passed validation on first attempt (DAY 1) of auto-post
"RTN","RCDPEAP",303,0)
 ; therefore assign the receipt number and 'partial' post status to ERA summary
"RTN","RCDPEAP",304,0)
 ;
"RTN","RCDPEAP",305,0)
 ; RCERA = ien of 344.4
"RTN","RCDPEAP",306,0)
 ; RCLINES = array of ERA line references
"RTN","RCDPEAP",307,0)
 ;
"RTN","RCDPEAP",308,0)
 ; no lines passed validation;  at lease 1 EEOB line needs to pass validation before assigning a receipt to the ERA
"RTN","RCDPEAP",309,0)
 I RCLINES=0 S RCRCPTDA="" G POSTERAQ
"RTN","RCDPEAP",310,0)
 ;ERA Receipt is created from scratchpad entry - type 14 is EDI Lockbox payment
"RTN","RCDPEAP",311,0)
 S RCRCPTDA=$$BLDRCPT^RCDPEMA(RCERA) ; Creates basic receipt for ERA of payment type EDI LOCKBOXA
"RTN","RCDPEAP",312,0)
 D RCPTDET^RCDPEMA(RCSCR,RCRCPTDA,.RCLINES,.RCERR) ; Adds detail to a receipt based on file 344.49 and RCLINES array
"RTN","RCDPEAP",313,0)
 ;
"RTN","RCDPEAP",314,0)
 ;Unable to create receipt - clear scratchpad, reset AUTO-POST STATUS = NULL
"RTN","RCDPEAP",315,0)
 I $O(RCERR("")) D CLEAR(RCSCR),SETSTA(RCERA,"@","Auto Posting: Removed from Auto Posting-Unable to create receipt") Q
"RTN","RCDPEAP",316,0)
 ;
"RTN","RCDPEAP",317,0)
 ;Lock ERA receipt and deposit ticket
"RTN","RCDPEAP",318,0)
 I '$$LOCKREC^RCDPRPLU(RCRCPTDA) Q
"RTN","RCDPEAP",319,0)
 I '$$LOCKDEP^RCDPDPLU(RCDEPTDA) D UNLOCKR Q
"RTN","RCDPEAP",320,0)
 ;
"RTN","RCDPEAP",321,0)
 ;Process Receipt to FMS
"RTN","RCDPEAP",322,0)
 D PROCESS^RCDPURE1(RCRCPTDA,2)
"RTN","RCDPEAP",323,0)
 I $D(^TMP("RCDPE-RECEIPT-ERROR",$J)) D CLEAR(RCSCR),SETSTA(RCERA,"@","Auto Posting: Removed from Auto Posting-Error in receipt processing"),UNLOCKR Q
"RTN","RCDPEAP",324,0)
 ;
"RTN","RCDPEAP",325,0)
 ; update 344, .18 ERA REFERENCE field
"RTN","RCDPEAP",326,0)
 D ERAREF(RCSCR,RCRCPTDA)
"RTN","RCDPEAP",327,0)
 ;
"RTN","RCDPEAP",328,0)
 ;Unlock deposit ticket and receipt
"RTN","RCDPEAP",329,0)
 D UNLOCKR
"RTN","RCDPEAP",330,0)
 ;Update ERA receipt and detail post status
"RTN","RCDPEAP",331,0)
 S DIE="^RCY(344.4,",DR=".14////5;.08////"_RCRCPTDA,DA=RCERA D ^DIE
"RTN","RCDPEAP",332,0)
POSTERAQ ;
"RTN","RCDPEAP",333,0)
 D POSTLNS(RCERA,RCRCPTDA,.RCLINES)
"RTN","RCDPEAP",334,0)
 Q
"RTN","RCDPEAP",335,0)
 ;
"RTN","RCDPEAP",336,0)
POSTLNS(RCERA,RCRCPTDA,RCLINES) ; this subroutine should only be called when some of the EEOB lines
"RTN","RCDPEAP",337,0)
 ;                                passed validation on FIRST attempt (DAY 1) of auto-post
"RTN","RCDPEAP",338,0)
 ;
"RTN","RCDPEAP",339,0)
 ; RCERA = ien of ERA entry in 344.4
"RTN","RCDPEAP",340,0)
 ; RCRCPTDA = ien of receipt entry in 344 or undefined if receipt not created since none of the lines passed validation
"RTN","RCDPEAP",341,0)
 ; RCLINES = array of ERA line references
"RTN","RCDPEAP",342,0)
 ;
"RTN","RCDPEAP",343,0)
 ;Mark ERA as processed to prevent reprocessing in EN2^RCDPEAP which runs next
"RTN","RCDPEAP",344,0)
 S ^TMP("RCDPEAP",$J,RCERA)=""
"RTN","RCDPEAP",345,0)
 S RCRCPTDA=$G(RCRCPTDA)
"RTN","RCDPEAP",346,0)
 ;Update individual claim lines on ERA
"RTN","RCDPEAP",347,0)
 N RCLIN,DA,DIE,DR,LNUM,RCI,REJECT
"RTN","RCDPEAP",348,0)
 S RCLIN=0 F  S RCLIN=$O(RCLINES(RCLIN)) Q:'RCLIN  D
"RTN","RCDPEAP",349,0)
 . ; flag the line if it was rejected during validation
"RTN","RCDPEAP",350,0)
 . S REJECT=0 I '$P(RCLINES(RCLIN),U) S REJECT=1
"RTN","RCDPEAP",351,0)
 . ;get all ERA line references (e.g. RCLINES(RCLIN) could have multiple line # references)
"RTN","RCDPEAP",352,0)
 . ;Need to parse out each line reference so that the necessary fields can be updated for the specific line
"RTN","RCDPEAP",353,0)
 . F RCI=1:1 S LNUM=$P(RCLIN,",",RCI) Q:LNUM=""  D
"RTN","RCDPEAP",354,0)
 . . S DA(1)=RCERA,DA=LNUM,DIE="^RCY(344.4,"_DA(1)_",1,"
"RTN","RCDPEAP",355,0)
 . . ;If not posted then the AUTO-POST REJECTION REASON (344.41,5) needs to be updated ;otherwise update line with receipt number and auto-post date
"RTN","RCDPEAP",356,0)
 . . I REJECT S DR="5////"_$P(RCLINES(RCLIN),U,3)
"RTN","RCDPEAP",357,0)
 . . E  S DR=".25////"_RCRCPTDA_";9////"_DT
"RTN","RCDPEAP",358,0)
 . . D ^DIE
"RTN","RCDPEAP",359,0)
 ;Update the Audit Log
"RTN","RCDPEAP",360,0)
 D AUDITLOG(RCERA,1,"Auto Posting: Some of the ERA lines went to APAR")
"RTN","RCDPEAP",361,0)
 ;Set ERA AUTO-POST STATUS = PARTIAL and update auto-post date
"RTN","RCDPEAP",362,0)
 S DIE="^RCY(344.4,",DR="4.01////"_DT_";4.02////1",DA=RCERA D ^DIE
"RTN","RCDPEAP",363,0)
 Q
"RTN","RCDPEAP",364,0)
 ;
"RTN","RCDPEAP",365,0)
SCRPAD(RCERA) ;Build Scratchpad entry in #344.49 for the ERA
"RTN","RCDPEAP",366,0)
 N RC0,RC5,RCSCR,RCDAT,X
"RTN","RCDPEAP",367,0)
 S RC0=$G(^RCY(344.4,RCERA,0)),RC5=$G(^RCY(344.4,RCERA,5))
"RTN","RCDPEAP",368,0)
 ;Ignore is this ERA already has a receipt
"RTN","RCDPEAP",369,0)
 I +$P(RC0,U,8) Q 0
"RTN","RCDPEAP",370,0)
 ;Ignore if this is zero ERA
"RTN","RCDPEAP",371,0)
 I +$P(RC0,U,5)=0 Q 0
"RTN","RCDPEAP",372,0)
 ;Ignore if this is not an ERA for an EFT
"RTN","RCDPEAP",373,0)
 I "^ACH^"'[(U_$P(RC0,U,15)_U) Q 0
"RTN","RCDPEAP",374,0)
 ; Scratchpad already exists
"RTN","RCDPEAP",375,0)
 S RCSCR=+$O(^RCY(344.49,"B",RCERA,0)) I RCSCR G SCRPADX
"RTN","RCDPEAP",376,0)
 ;Create new Scratchpad
"RTN","RCDPEAP",377,0)
 S RCSCR=+$$ADDREC^RCDPEWL(RCERA,.RCDAT) I 'RCSCR Q 0
"RTN","RCDPEAP",378,0)
 ;Add all the ERA lines to the Scratchpad entry
"RTN","RCDPEAP",379,0)
 D ADDLINES^RCDPEWLA(RCSCR)
"RTN","RCDPEAP",380,0)
SCRPADX ;Return Scratchpad IEN
"RTN","RCDPEAP",381,0)
 Q RCSCR
"RTN","RCDPEAP",382,0)
 ;
"RTN","RCDPEAP",383,0)
SETSTA(DA,STATUS,RCREASON) ;Set ERA auto-post status
"RTN","RCDPEAP",384,0)
 ; Log status change
"RTN","RCDPEAP",385,0)
 I '$G(DA) Q
"RTN","RCDPEAP",386,0)
 I $G(STATUS)="" Q
"RTN","RCDPEAP",387,0)
 ;
"RTN","RCDPEAP",388,0)
 D AUDITLOG(DA,STATUS,$G(RCREASON))
"RTN","RCDPEAP",389,0)
 ; Update status
"RTN","RCDPEAP",390,0)
 N DIE,DR
"RTN","RCDPEAP",391,0)
 S DIE="^RCY(344.4,",DR="4.02////"_STATUS D ^DIE
"RTN","RCDPEAP",392,0)
 Q
"RTN","RCDPEAP",393,0)
 ;
"RTN","RCDPEAP",394,0)
 ;
"RTN","RCDPEAP",395,0)
UNLOCKR ;Unlock ERA receipt and deposit ticket
"RTN","RCDPEAP",396,0)
 L -^RCY(344,RCRCPTDA)
"RTN","RCDPEAP",397,0)
 L -^RCY(344.1,RCDEPTDA)
"RTN","RCDPEAP",398,0)
 Q
"RTN","RCDPEAP",399,0)
 ;
"RTN","RCDPEAP",400,0)
UNLOCKE ;Unlock ERA
"RTN","RCDPEAP",401,0)
 L -^RCY(344.4,RCERA)
"RTN","RCDPEAP",402,0)
 Q
"RTN","RCDPEAP",403,0)
 ;
"RTN","RCDPEAP",404,0)
VALID(RCSCR,SCRLINE,RCARRAY) ;Validates Scratchpad line - Used by APAR/Mark for Auto-post
"RTN","RCDPEAP",405,0)
 ;Input
"RTN","RCDPEAP",406,0)
 ;  RCSCR   - #344.4/#344.49 file IEN
"RTN","RCDPEAP",407,0)
 ;  SCRLINE - Subscript of first scratchpad entry for the ERA line
"RTN","RCDPEAP",408,0)
 ;  RCARRAY - Passed reference to result array
"RTN","RCDPEAP",409,0)
 ;Output
"RTN","RCDPEAP",410,0)
 ;  OK      - Boolean 1 or 0
"RTN","RCDPEAP",411,0)
 ;  RCARRAY - Array of claim(s) which fail validation
"RTN","RCDPEAP",412,0)
 ;
"RTN","RCDPEAP",413,0)
 ;            e.g  line number 2
"RTN","RCDPEAP",414,0)
 ;                 RCARRAY(2.001)="K800001^NOT AN ACTIVE CLAIM"
"RTN","RCDPEAP",415,0)
 ;
"RTN","RCDPEAP",416,0)
 ;            e.g. split line number 2
"RTN","RCDPEAP",417,0)
 ;                 RCARRAY(2.001)="K800002^CLAIM REFERRED TO GENERAL COUNCIL"
"RTN","RCDPEAP",418,0)
 ;                 RCARRAY(2.006)="K800003^PAYMENT EXCEEDS CLAIM BALANCE"
"RTN","RCDPEAP",419,0)
 ;
"RTN","RCDPEAP",420,0)
 N CLAIM,DONE,SEQ,SEQ1,SUB,STATUS,WLINE
"RTN","RCDPEAP",421,0)
 K RCARRAY,CLARRAY
"RTN","RCDPEAP",422,0)
 S SUB=SCRLINE,SEQ=$P($G(^RCY(344.49,RCSCR,1,SUB,0)),U),DONE=0
"RTN","RCDPEAP",423,0)
 F  S SUB=$O(^RCY(344.49,RCSCR,1,SUB)) Q:SUB=""  D  Q:DONE
"RTN","RCDPEAP",424,0)
 . ;Get scratchpad N.001 line and data
"RTN","RCDPEAP",425,0)
 . S WLINE=$G(^RCY(344.49,RCSCR,1,SUB,0)),SEQ1=$P(WLINE,".") I SEQ1'=SEQ S DONE=1 Q
"RTN","RCDPEAP",426,0)
 . ;Get claim number from N.00N line - ignore suspense lines
"RTN","RCDPEAP",427,0)
 . S CLAIM=$P(WLINE,U,7) I 'CLAIM Q
"RTN","RCDPEAP",428,0)
 . ;Claim must be OPEN or ACTIVE
"RTN","RCDPEAP",429,0)
 . S STATUS=$P($G(^PRCA(430,CLAIM,0)),"^",8) I STATUS'=42,STATUS'=16 S RCARRAY(SEQ1)=$P(WLINE,U,2)_"^NOT AN ACTIVE CLAIM" Q
"RTN","RCDPEAP",430,0)
 . ;Check that payment does not exceed balance and no pending payments (at the time of auto posting)
"RTN","RCDPEAP",431,0)
 . S CLARRAY(CLAIM)=+$G(CLARRAY(CLAIM))+$P(WLINE,U,3) I '$$CHECKPAY(.CLARRAY,CLAIM) S RCARRAY(SEQ1)=$P(WLINE,U,2)_"^PAYMENT EXCEEDS CLAIM BALANCE" Q
"RTN","RCDPEAP",432,0)
 . ;Check if referred to general council
"RTN","RCDPEAP",433,0)
 . I $P($G(^PRCA(430,CLAIM,6)),U,4)]"" S RCARRAY(SEQ1)=$P(WLINE,U,2)_"^CLAIM REFERRED TO GENERAL COUNCIL" Q
"RTN","RCDPEAP",434,0)
 . ;Check that payment is not negative
"RTN","RCDPEAP",435,0)
 . I $P(WLINE,U,6)<0 S RCARRAY(SEQ1)=$P(WLINE,U,2)_"^PAYMENT AMOUNT IS NEGATIVE" Q
"RTN","RCDPEAP",436,0)
 ;Returns 1 if line is OK
"RTN","RCDPEAP",437,0)
 Q $S($O(RCARRAY(""))]"":0,1:1)
"RTN","RCDPEAP1")
0^9^B100161817^B94067228
"RTN","RCDPEAP1",1,0)
RCDPEAP1 ;ALB/KML - AUTO POST MATCHING EFT ERA PAIR - CONT. ;Jun 06, 2014@19:11:19
"RTN","RCDPEAP1",2,0)
 ;;4.5;Accounts Receivable;**298,304,318**;Mar 20, 1995;Build 37
"RTN","RCDPEAP1",3,0)
 ;Per VA Directive 6402, this routine should not be modified.
"RTN","RCDPEAP1",4,0)
 ;Read ^IBM(361.1) via Private IA 4051
"RTN","RCDPEAP1",5,0)
 ;
"RTN","RCDPEAP1",6,0)
 ;-------------------------------
"RTN","RCDPEAP1",7,0)
 ;RCDPEM0 and RCDPEAP SUBROUTINES
"RTN","RCDPEAP1",8,0)
 ;-------------------------------
"RTN","RCDPEAP1",9,0)
AUTOCHK(RCERA) ;Verify if ERA can be auto-posted - PRE-CHECK USED IN RCDPEM0
"RTN","RCDPEAP1",10,0)
 ; Many checks done by this are also done AUTOCHK2 below so if these are changed, may also need to be changed
"RTN","RCDPEAP1",11,0)
 N NOTOK,RCDSUB,RCD0,RCSCR
"RTN","RCDPEAP1",12,0)
 K ^TMP($J,"RCDPEWLA")
"RTN","RCDPEAP1",13,0)
 ;Check for exceptions
"RTN","RCDPEAP1",14,0)
 S RCDSUB=0,NOTOK=0
"RTN","RCDPEAP1",15,0)
 F  S RCDSUB=$O(^RCY(344.4,RCERA,1,RCDSUB)) Q:'RCDSUB  D  Q:NOTOK
"RTN","RCDPEAP1",16,0)
 . ;Exception exists if INVALID BILL NUMBER field is populated in #344.41
"RTN","RCDPEAP1",17,0)
 . S RCD0=$G(^RCY(344.4,RCERA,1,RCDSUB,0)) S:($P(RCD0,U,5)]"") NOTOK=1
"RTN","RCDPEAP1",18,0)
 ;Cannot auto-post if exceptions exist
"RTN","RCDPEAP1",19,0)
 Q:NOTOK 0
"RTN","RCDPEAP1",20,0)
 ; Ignore ERA if ERA level Adjustments exist
"RTN","RCDPEAP1",21,0)
 I $O(^RCY(344.4,RCERA,2,0)) Q 0
"RTN","RCDPEAP1",22,0)
 ;Create scratchpad
"RTN","RCDPEAP1",23,0)
 S RCSCR=$$SCRPAD^RCDPEAP(RCERA) Q:'RCSCR 0
"RTN","RCDPEAP1",24,0)
 ;Ignore ERA if claim level adjustments without payment exist
"RTN","RCDPEAP1",25,0)
 ;This will only get set if the scratchpad is created, not if it already exists.  Looking at the code, it
"RTN","RCDPEAP1",26,0)
 ;will mainly set if there are ERA level adjustments and may get set for unbalanced pairs, which is found
"RTN","RCDPEAP1",27,0)
 ;by the ZEROBAL function.  So, I think this does not have a real purpose but was not 100% sure.
"RTN","RCDPEAP1",28,0)
 I $D(^TMP($J,"RCDPEWLA","ERA LEVEL ADJUSTMENT EXISTS")) D CLEAR^RCDPEAP(RCSCR) Q 0
"RTN","RCDPEAP1",29,0)
 ; ERA needs to drop to standard worklist if adjustment between matching 
"RTN","RCDPEAP1",30,0)
 ;positive/negative does not create a zero balance
"RTN","RCDPEAP1",31,0)
 I '$$ZEROBAL(RCSCR) D CLEAR^RCDPEAP(RCSCR) Q 0
"RTN","RCDPEAP1",32,0)
 ;Clear scratchpad
"RTN","RCDPEAP1",33,0)
 D CLEAR^RCDPEAP(RCSCR)
"RTN","RCDPEAP1",34,0)
 ;This is valid auto-post - return to MATCH^RCPDEM0
"RTN","RCDPEAP1",35,0)
 Q 1
"RTN","RCDPEAP1",36,0)
 ;
"RTN","RCDPEAP1",37,0)
AUTOCHK2(RCERA) ;
"RTN","RCDPEAP1",38,0)
 ;Check if this entry is an auto-post candidate
"RTN","RCDPEAP1",39,0)
 ;This has the same/similar checks as MATCH^RCDPEM0 and AUTOCHK above.  If those procedures are
"RTN","RCDPEAP1",40,0)
 ;  changed, this may need to updated as well.
"RTN","RCDPEAP1",41,0)
 ;
"RTN","RCDPEAP1",42,0)
 ;Input
"RTN","RCDPEAP1",43,0)
 ;  RCERA: IEN from Electronic Remittance Advice file (#344.4)
"RTN","RCDPEAP1",44,0)
 ;Output
"RTN","RCDPEAP1",45,0)
 ;  1: Auto-Post candidate
"RTN","RCDPEAP1",46,0)
 ;  0^Reason: Not a auto-post candidate and reason
"RTN","RCDPEAP1",47,0)
 ;
"RTN","RCDPEAP1",48,0)
 ; Validate Parameter
"RTN","RCDPEAP1",49,0)
 I '$G(RCERA) Q "0^Invalid Parameter"
"RTN","RCDPEAP1",50,0)
 ;
"RTN","RCDPEAP1",51,0)
 N STATUS,RC0,RCERATYP,RCXCLDE,RCDSUB,NOTOK,RCCREATE,RCSCR
"RTN","RCDPEAP1",52,0)
 K ^TMP($J,"RCDPEWLA")
"RTN","RCDPEAP1",53,0)
 ;
"RTN","RCDPEAP1",54,0)
 ; Check if record exists
"RTN","RCDPEAP1",55,0)
 I '$D(^RCY(344.4,RCERA,0)) Q "0^Invalid ERA record"
"RTN","RCDPEAP1",56,0)
 ;
"RTN","RCDPEAP1",57,0)
 ; Check current status
"RTN","RCDPEAP1",58,0)
 S STATUS=$$GET1^DIQ(344.4,RCERA_",",4.02,"I")
"RTN","RCDPEAP1",59,0)
 I STATUS=0 Q "0^Already marked for Auto-Posting"
"RTN","RCDPEAP1",60,0)
 I STATUS=1 Q "0^Already partially Auto-Posted"
"RTN","RCDPEAP1",61,0)
 I STATUS=2 Q "0^Already completely Auto-Posted"
"RTN","RCDPEAP1",62,0)
 ;
"RTN","RCDPEAP1",63,0)
 ; Check for matching
"RTN","RCDPEAP1",64,0)
 I '$$GET1^DIQ(344.4,RCERA_",",.09,"I") Q "0^ERA not matched"
"RTN","RCDPEAP1",65,0)
 ;
"RTN","RCDPEAP1",66,0)
 ; Check for zero value ERA
"RTN","RCDPEAP1",67,0)
 S RC0=$G(^RCY(344.4,RCERA,0))
"RTN","RCDPEAP1",68,0)
 I +$P(RC0,U,5)=0 Q "0^Zero value ERA"
"RTN","RCDPEAP1",69,0)
 ;
"RTN","RCDPEAP1",70,0)
 ; Determine if ERA should be excluded using the site parameters
"RTN","RCDPEAP1",71,0)
 S RCERATYP=$$PHARM(RCERA)
"RTN","RCDPEAP1",72,0)
 ;
"RTN","RCDPEAP1",73,0)
 ; Check if medical claim and auto-posting is turned off
"RTN","RCDPEAP1",74,0)
 I 'RCERATYP,'$P($G(^RCY(344.61,1,0)),U,2) Q "0^Medical auto-posting off"
"RTN","RCDPEAP1",75,0)
 ;
"RTN","RCDPEAP1",76,0)
 ; Check if pharmacy claim and auto-posting is turned off
"RTN","RCDPEAP1",77,0)
 I RCERATYP,'$P($G(^RCY(344.61,1,1)),U,1) Q "0^Pharmacy auto-posting off"
"RTN","RCDPEAP1",78,0)
 ;
"RTN","RCDPEAP1",79,0)
 ; Check if ERA payer is excluded from autopost
"RTN","RCDPEAP1",80,0)
 S RCXCLDE=0
"RTN","RCDPEAP1",81,0)
 S:'RCERATYP RCXCLDE=$$EXCLUDE(RCERA)
"RTN","RCDPEAP1",82,0)
 S:RCERATYP RCXCLDE=$$EXCLDRX(RCERA)
"RTN","RCDPEAP1",83,0)
 I RCXCLDE Q "0^"_$S(RCERATYP:"Pharmacy",1:"Medical")_" payer excluded"
"RTN","RCDPEAP1",84,0)
 ;
"RTN","RCDPEAP1",85,0)
 ; Check for invalid bill number exception
"RTN","RCDPEAP1",86,0)
 S RCDSUB=0,NOTOK=0
"RTN","RCDPEAP1",87,0)
 F  S RCDSUB=$O(^RCY(344.4,RCERA,1,RCDSUB)) Q:'RCDSUB  D  Q:NOTOK
"RTN","RCDPEAP1",88,0)
 . S RCD0=$G(^RCY(344.4,RCERA,1,RCDSUB,0))
"RTN","RCDPEAP1",89,0)
 . I $P(RCD0,U,5)]"" S NOTOK=1
"RTN","RCDPEAP1",90,0)
 I NOTOK Q "0^Invalid Bill Number Exception(s)"
"RTN","RCDPEAP1",91,0)
 ;
"RTN","RCDPEAP1",92,0)
 ; Check for ERA level Adjustments
"RTN","RCDPEAP1",93,0)
 I $O(^RCY(344.4,RCERA,2,0)) Q "0^ERA level Adjustment(s)"
"RTN","RCDPEAP1",94,0)
 ;
"RTN","RCDPEAP1",95,0)
 ; Check if receipt already created
"RTN","RCDPEAP1",96,0)
 I +$P(RC0,U,8) Q "0^ERA has a receipt"
"RTN","RCDPEAP1",97,0)
 ;
"RTN","RCDPEAP1",98,0)
 ; Check if they is a ACH payment type
"RTN","RCDPEAP1",99,0)
 I "^ACH^"'[(U_$P(RC0,U,15)_U) Q "0^Payment Type is not ACH"
"RTN","RCDPEAP1",100,0)
 ;
"RTN","RCDPEAP1",101,0)
 ; Create scratchpad if needed
"RTN","RCDPEAP1",102,0)
 S RCCREATE=0
"RTN","RCDPEAP1",103,0)
 S RCSCR=+$O(^RCY(344.49,"B",RCERA,0))
"RTN","RCDPEAP1",104,0)
 I 'RCSCR S RCSCR=$$SCRPAD^RCDPEAP(RCERA) S RCCREATE=1
"RTN","RCDPEAP1",105,0)
 I 'RCSCR Q "0^Unable to create scratchpad"
"RTN","RCDPEAP1",106,0)
 ;
"RTN","RCDPEAP1",107,0)
 ; Check if claim level adjustments without payment exist
"RTN","RCDPEAP1",108,0)
 ; Note that PRCA*298 sets this temp global only if the scratchpad is created by the call above ($$SCRPAD^RCDPEAP). If the
"RTN","RCDPEAP1",109,0)
 ;   scratchpad already exists, the TMP global will never get set.   Looking at the code, it will mainly set if there
"RTN","RCDPEAP1",110,0)
 ;   are ERA level adjustments and may get set for unbalanced pairs, which is found by the ZEROBAL function.  So, I think
"RTN","RCDPEAP1",111,0)
 ;   this does not have a real purpose but was not 100% sure and wanted to mimic what AUTOCHK does.
"RTN","RCDPEAP1",112,0)
 I $D(^TMP($J,"RCDPEWLA","ERA LEVEL ADJUSTMENT EXISTS")) D:RCCREATE CLEAR^RCDPEAP(RCSCR) Q "0^Claim Level Adjustments w/o payment"
"RTN","RCDPEAP1",113,0)
 ;
"RTN","RCDPEAP1",114,0)
 ; Check if adjustment between matching positive/negative does not create a zero balance
"RTN","RCDPEAP1",115,0)
 I '$$ZEROBAL(RCSCR) D:RCCREATE CLEAR^RCDPEAP(RCSCR) Q "0^+/- pairs do not balance"
"RTN","RCDPEAP1",116,0)
 ;
"RTN","RCDPEAP1",117,0)
 ; Clear scratchpad if it was created by this function
"RTN","RCDPEAP1",118,0)
 D:RCCREATE CLEAR^RCDPEAP(RCSCR)
"RTN","RCDPEAP1",119,0)
 ;
"RTN","RCDPEAP1",120,0)
 ;If we got this far, this is an autopost candidate so quit with 1
"RTN","RCDPEAP1",121,0)
 Q 1
"RTN","RCDPEAP1",122,0)
 ;
"RTN","RCDPEAP1",123,0)
EXCLUDE(RCERA) ;Verify if auto-posting is allowed for this Payer - PRECHECK USED IN RCDPEM0
"RTN","RCDPEAP1",124,0)
 ;Not allowed if medical auto-posting is switched off
"RTN","RCDPEAP1",125,0)
 Q:'$P($G(^RCY(344.61,1,0)),U,2) 1
"RTN","RCDPEAP1",126,0)
 ;Check if Payer Name and Payer ID from ERA are in auto-posting payer table
"RTN","RCDPEAP1",127,0)
 N RCPNM,RCPID,RCPXDA
"RTN","RCDPEAP1",128,0)
 S RCPNM=$P($G(^RCY(344.4,RCERA,0)),U,6) Q:RCPNM="" 1
"RTN","RCDPEAP1",129,0)
 S RCPID=$P($G(^RCY(344.4,RCERA,0)),U,3) Q:RCPID="" 1
"RTN","RCDPEAP1",130,0)
 ;Auto-post is allowed if this is a new payer (not in table)
"RTN","RCDPEAP1",131,0)
 S RCPXDA=$O(^RCY(344.6,"CPID",RCPNM,RCPID,"")) Q:RCPXDA="" 0
"RTN","RCDPEAP1",132,0)
 ;If payer table entry found check if payer is excluded from medical auto-post
"RTN","RCDPEAP1",133,0)
 Q:$P($G(^RCY(344.6,RCPXDA,0)),U,6)=1 1
"RTN","RCDPEAP1",134,0)
 ;Otherwise it is OK to auto-post
"RTN","RCDPEAP1",135,0)
 Q 0
"RTN","RCDPEAP1",136,0)
 ;
"RTN","RCDPEAP1",137,0)
PHARM(RCERA) ;Check if ERA is for Pharmacy only (ECME number on first line) - CALLED FROM RCDPEM0
"RTN","RCDPEAP1",138,0)
 N SUB S SUB=$O(^RCY(344.4,RCERA,1,0)) Q:'SUB 0
"RTN","RCDPEAP1",139,0)
 Q:$P($G(^RCY(344.4,RCERA,1,SUB,4)),U,2)]"" 1
"RTN","RCDPEAP1",140,0)
 Q 0
"RTN","RCDPEAP1",141,0)
 ;
"RTN","RCDPEAP1",142,0)
ERADET(RCERA,RCRCPTDA,RCLINES) ; called on subsequent attempts of auto-post for a given ERA (DAY 2, DAY 3, ex.)
"RTN","RCDPEAP1",143,0)
 ;  update ERA with receipt or if not posted then update the AUTO-POST REJECTION REASON (#5)
"RTN","RCDPEAP1",144,0)
 ;
"RTN","RCDPEAP1",145,0)
 ; RCERA = ien of entry in file 344.4
"RTN","RCDPEAP1",146,0)
 ; RCRCPTDA = ien of receipt number (344, .01) - optional
"RTN","RCDPEAP1",147,0)
 ; RCLINES = array of ERA line references
"RTN","RCDPEAP1",148,0)
 ;
"RTN","RCDPEAP1",149,0)
 I '$G(RCERA) Q
"RTN","RCDPEAP1",150,0)
 S RCRCPTDA=$G(RCRCPTDA)
"RTN","RCDPEAP1",151,0)
 ;
"RTN","RCDPEAP1",152,0)
 N DA,DIC,DIE,DLAYGO,DO,DR,X
"RTN","RCDPEAP1",153,0)
 ; Update receipt.  If this is the first receipt, put it in the RECEIPT (#08) field.  If not, put in OTHER RECEIPTS multiple (#344.48)
"RTN","RCDPEAP1",154,0)
 I RCRCPTDA D
"RTN","RCDPEAP1",155,0)
 . I $P($G(^RCY(344.4,RCERA,0)),U,8)]"" S DA(1)=RCERA,DIC="^RCY(344.4,"_DA(1)_",8,",DIC(0)="L",X=RCRCPTDA D FILE^DICN I 1
"RTN","RCDPEAP1",156,0)
 . E  S DIE="^RCY(344.4,",DR=".14////1;.08////"_RCRCPTDA,DA=RCERA D ^DIE
"RTN","RCDPEAP1",157,0)
 ;
"RTN","RCDPEAP1",158,0)
 ; Update ERA detail line with Receipt or reject reason as appropriate
"RTN","RCDPEAP1",159,0)
 ; PRCA*4.5*318 begins
"RTN","RCDPEAP1",160,0)
 N RCLIN,REJECT
"RTN","RCDPEAP1",161,0)
 S RCLIN=0
"RTN","RCDPEAP1",162,0)
 F  S RCLIN=$O(RCLINES(RCLIN)) Q:'RCLIN  D
"RTN","RCDPEAP1",163,0)
 . ; Set REJECT to true if the line was rejected during validation
"RTN","RCDPEAP1",164,0)
 . S REJECT=0 I '$P(RCLINES(RCLIN),U) S REJECT=1
"RTN","RCDPEAP1",165,0)
 . ;If not posted then update the AUTO-POST REJECTION REASON (#5)
"RTN","RCDPEAP1",166,0)
 . ;Otherwise update line with receipt number and autopost date
"RTN","RCDPEAP1",167,0)
 . S DA(1)=RCERA,DA=RCLIN,DIE="^RCY(344.4,"_DA(1)_",1,"
"RTN","RCDPEAP1",168,0)
 . I 'REJECT,'RCRCPTDA Q
"RTN","RCDPEAP1",169,0)
 . I REJECT S DR="5///"_$P(RCLINES(RCLIN),U,3)
"RTN","RCDPEAP1",170,0)
 . E  S DR=".25///"_RCRCPTDA_";9///"_DT
"RTN","RCDPEAP1",171,0)
 . D ^DIE
"RTN","RCDPEAP1",172,0)
 ; PRCA*4.5*318 ends
"RTN","RCDPEAP1",173,0)
 Q
"RTN","RCDPEAP1",174,0)
 ;
"RTN","RCDPEAP1",175,0)
ZEROBAL(RCSCR) ;
"RTN","RCDPEAP1",176,0)
 ; per requirements, only positive/negative payment pairs where payment 
"RTN","RCDPEAP1",177,0)
 ; calculates to zero are allowed for auto-post
"RTN","RCDPEAP1",178,0)
 ; if payment ends up less than zero or greater than zero then ERA cannot
"RTN","RCDPEAP1",179,0)
 ;be autoposted.  
"RTN","RCDPEAP1",180,0)
 ; ERA gets sent to the standard worklist for manual receipt processing
"RTN","RCDPEAP1",181,0)
 ; note:  a payment pair represents 2 EEOB sequences with the same claim
"RTN","RCDPEAP1",182,0)
 ;         RCSCR - 344.49 ien
"RTN","RCDPEAP1",183,0)
 ;         X - returns 1 or 0
"RTN","RCDPEAP1",184,0)
 ; 
"RTN","RCDPEAP1",185,0)
 N SUB,SUB1,WLINE,X,ERALINE
"RTN","RCDPEAP1",186,0)
 S SUB=0,X=1,ERALINE=""
"RTN","RCDPEAP1",187,0)
 F  S SUB=$O(^RCY(344.49,RCSCR,1,"B",SUB)) Q:SUB=""  D
"RTN","RCDPEAP1",188,0)
 . ;Get scratchpad line and data 
"RTN","RCDPEAP1",189,0)
 . S SUB1=$O(^RCY(344.49,RCSCR,1,"B",SUB,"")) Q:'SUB1  S WLINE=$G(^RCY(344.49,RCSCR,1,SUB1,0))
"RTN","RCDPEAP1",190,0)
 . ;If integer sequence, get ERA line reference then quit for this sequence and go on to the non-integer sequence to finish validation
"RTN","RCDPEAP1",191,0)
 . I $P(WLINE,U)?1N.N S ERALINE=$P(WLINE,U,9) Q 
"RTN","RCDPEAP1",192,0)
 . ; there are multiple EEOB sequences for the specific bill number so an adjustment took place; 
"RTN","RCDPEAP1",193,0)
 . ; if payment adjustment doesn't generate a zero payment balance at 344.491,.06 then this ERA needs to drop to standard worklist
"RTN","RCDPEAP1",194,0)
 . I ERALINE[",",+$P(WLINE,U,6)'=0 S X=0 Q
"RTN","RCDPEAP1",195,0)
 . ;do not autopost ERA if one of payments is negative amount
"RTN","RCDPEAP1",196,0)
 . I $P(WLINE,U,6)<0 S X=0
"RTN","RCDPEAP1",197,0)
 Q X
"RTN","RCDPEAP1",198,0)
 ;
"RTN","RCDPEAP1",199,0)
 ; Verify if auto-posting is allowed for Pharmacy claims and for the Payer - PRECHECK USED IN RCDPEM0
"RTN","RCDPEAP1",200,0)
EXCLDRX(RCERA) ;
"RTN","RCDPEAP1",201,0)
 ;Not allowed if pharmacy auto-posting is switched off
"RTN","RCDPEAP1",202,0)
 Q:'$P($G(^RCY(344.61,1,1)),U,1) 1
"RTN","RCDPEAP1",203,0)
 ;Check if Payer Name and Payer ID from ERA are in auto-posting payer table
"RTN","RCDPEAP1",204,0)
 N RCPNM,RCPID,RCPXDA
"RTN","RCDPEAP1",205,0)
 S RCPNM=$P($G(^RCY(344.4,RCERA,0)),U,6) Q:RCPNM="" 1
"RTN","RCDPEAP1",206,0)
 S RCPID=$P($G(^RCY(344.4,RCERA,0)),U,3) Q:RCPID="" 1
"RTN","RCDPEAP1",207,0)
 ;Auto-post is allowed if this is a new payer (not in table)
"RTN","RCDPEAP1",208,0)
 S RCPXDA=$O(^RCY(344.6,"CPID",RCPNM,RCPID,"")) Q:RCPXDA="" 0
"RTN","RCDPEAP1",209,0)
 ;If payer table entry found check if payer is excluded from pharmacy auto-post
"RTN","RCDPEAP1",210,0)
 Q:$P($G(^RCY(344.6,RCPXDA,0)),U,8)=1 1
"RTN","RCDPEAP1",211,0)
 ;Otherwise it is OK to auto-post
"RTN","RCDPEAP1",212,0)
 Q 0
"RTN","RCDPEAP1",213,0)
 ;
"RTN","RCDPEAP1",214,0)
VALID(RCERA,RCLINES) ;
"RTN","RCDPEAP1",215,0)
 ;Verify which scratchpad lines are able to auto-post - called by EN2^RCDPEAP
"RTN","RCDPEAP1",216,0)
 ;
"RTN","RCDPEAP1",217,0)
 ; RCERA - Electronic Remittance Advice (#344.4) IEN
"RTN","RCDPEAP1",218,0)
 ; RCLINES - Array of ERA line references (passed in by reference)
"RTN","RCDPEAP1",219,0)
 ;           RCLINES(ERALINE)=1  - ERA line(s) are postable.  Also RCLINES counter is incremented.
"RTN","RCDPEAP1",220,0)
 ;           RCLINES(ERALINE)=0^^Reject Reason Code - ERA line(s) are not postable
"RTN","RCDPEAP1",221,0)
 ;           NOTE: ORIGINAL ERA SEQUENCES (#.09) can have multiple ERA line references separated by commas (e.g.,"3,4")
"RTN","RCDPEAP1",222,0)
 ;
"RTN","RCDPEAP1",223,0)
 ;Check for ScratchPad entry.  If missing (should not happen), quit
"RTN","RCDPEAP1",224,0)
 N RCSCR
"RTN","RCDPEAP1",225,0)
 S RCSCR=$O(^RCY(344.49,"B",+$G(RCERA),""))
"RTN","RCDPEAP1",226,0)
 I RCSCR="" S RCLINES=0 Q
"RTN","RCDPEAP1",227,0)
 ;Loop through scratchpad for this ERA
"RTN","RCDPEAP1",228,0)
 N SUB,SUB1,WLINE,ERALINE,PIECE,SEQ,CLAIM,STATUS,CLARRAY,AUTOPOST
"RTN","RCDPEAP1",229,0)
 S SUB=0 F  S SUB=$O(^RCY(344.49,RCSCR,1,"B",SUB)) Q:SUB=""  D
"RTN","RCDPEAP1",230,0)
 . ;Get scratchpad line and data
"RTN","RCDPEAP1",231,0)
 . S SUB1=$O(^RCY(344.49,RCSCR,1,"B",SUB,""))
"RTN","RCDPEAP1",232,0)
 . I 'SUB1 Q
"RTN","RCDPEAP1",233,0)
 . S WLINE=$G(^RCY(344.49,RCSCR,1,SUB1,0))
"RTN","RCDPEAP1",234,0)
 . ;If integer sequence, get ERA line reference and check for auto-post flag
"RTN","RCDPEAP1",235,0)
 . I $P(WLINE,U)?1N.N D  Q
"RTN","RCDPEAP1",236,0)
 .. S ERALINE=$P(WLINE,U,9)
"RTN","RCDPEAP1",237,0)
 .. ; If ERA reference is missing (should not happen), skip ahead to next integer sequence
"RTN","RCDPEAP1",238,0)
 .. I ERALINE="" S SUB=SUB\1_".999" Q
"RTN","RCDPEAP1",239,0)
 .. ; Check for receipt - PRCA*4.5*318 
"RTN","RCDPEAP1",240,0)
 .. I $$GET1^DIQ(344.41,ERALINE_","_RCERA_",",.25)]"" S SUB=SUB\1_".999" Q  ; PRCA*4.5*318
"RTN","RCDPEAP1",241,0)
 .. S AUTOPOST=1
"RTN","RCDPEAP1",242,0)
 .. F PIECE=1:1 S SEQ=$P(ERALINE,",",PIECE) Q:'SEQ  I '$P($G(^RCY(344.4,RCERA,1,SEQ,5)),U,2) S AUTOPOST=0 Q
"RTN","RCDPEAP1",243,0)
 .. ; Unless all of the associated ERA detail lines are set for auto-post, skip ahead to next integer sequence
"RTN","RCDPEAP1",244,0)
 .. I 'AUTOPOST S SUB=SUB\1_".999" Q
"RTN","RCDPEAP1",245,0)
 . ;If no claim number (suspense), set to autopost but check the rest of the lines for the ERA reference
"RTN","RCDPEAP1",246,0)
 . S CLAIM=$P(WLINE,U,7)
"RTN","RCDPEAP1",247,0)
 . I 'CLAIM S RCLINES(ERALINE)=1 Q
"RTN","RCDPEAP1",248,0)
 . ;Quit with error if claim is not OPEN or ACTIVE
"RTN","RCDPEAP1",249,0)
 . S STATUS=$P($G(^PRCA(430,CLAIM,0)),"^",8)
"RTN","RCDPEAP1",250,0)
 . I STATUS'=42,STATUS'=16 S RCLINES(ERALINE)="0^^5",SUB=SUB\1_".999" Q
"RTN","RCDPEAP1",251,0)
 . ;Quit with error if referred to general council
"RTN","RCDPEAP1",252,0)
 . I $P($G(^PRCA(430,CLAIM,6)),U,4)]"" S RCLINES(ERALINE)="0^^7",SUB=SUB\1_".999" Q
"RTN","RCDPEAP1",253,0)
 . ;Check for negative payment amount
"RTN","RCDPEAP1",254,0)
 . I $P(WLINE,U,6)<0 S RCLINES(ERALINE)="0^^6",SUB=SUB\1_".999" Q
"RTN","RCDPEAP1",255,0)
 . ;Increment claim balance.  If payment exceeds claim balance and no pending payments (at the time of auto posting), quit
"RTN","RCDPEAP1",256,0)
 . ;  with error.  Also deduct the amount from the balance so subsequent, smaller amounts may get posted
"RTN","RCDPEAP1",257,0)
 . S CLARRAY(CLAIM)=+$G(CLARRAY(CLAIM))+$P(WLINE,U,3)
"RTN","RCDPEAP1",258,0)
 . I '$$CHECKPAY^RCDPEAP(.CLARRAY,CLAIM) S RCLINES(ERALINE)="0^^3",SUB=SUB\1_".999",CLARRAY(CLAIM)=+$G(CLARRAY(CLAIM))-$P(WLINE,U,3) Q
"RTN","RCDPEAP1",259,0)
 . ;Line is potentially postable - update flag
"RTN","RCDPEAP1",260,0)
 . S RCLINES(ERALINE)=1
"RTN","RCDPEAP1",261,0)
 ;
"RTN","RCDPEAP1",262,0)
 ;Reset the MARK FOR AUTOPOST flag on ERA lines and return count of auto-postable lines - PRCA*4.5*318
"RTN","RCDPEAP1",263,0)
 N DA,DIE,DR,RCLIN,RCI
"RTN","RCDPEAP1",264,0)
 S RCLIN=0,RCLINES=0 F  S RCLIN=$O(RCLINES(RCLIN)) Q:'RCLIN  D
"RTN","RCDPEAP1",265,0)
 . I +RCLINES(RCLIN) S RCLINES=RCLINES+1
"RTN","RCDPEAP1",266,0)
 . ;Set MARK FOR AUTO-POST (#6) to NO for every line
"RTN","RCDPEAP1",267,0)
 . S DA(1)=RCERA,DA=RCLIN,DIE="^RCY(344.4,"_DA(1)_",1,"
"RTN","RCDPEAP1",268,0)
 . S DR="6///0"
"RTN","RCDPEAP1",269,0)
 . D ^DIE
"RTN","RCDPEAP1",270,0)
 Q
"RTN","RCDPEAP1",271,0)
 ;
"RTN","RCDPEAP1",272,0)
UNBAL(RCERA) ; PRCA*4.5*318 added method
"RTN","RCDPEAP1",273,0)
 ; Determine if the ERA total matches the EFT total for the selected ERA
"RTN","RCDPEAP1",274,0)
 ; Input:   RCERA    - Internal IEN of the selected ERA
"RTN","RCDPEAP1",275,0)
 ; Returns: 1 - ERA is unbalanced, 0 otherwise
"RTN","RCDPEAP1",276,0)
 N RCLTOT,RCSUB,RCTOT
"RTN","RCDPEAP1",277,0)
 ;ERA total balance - on matched ERAs the ERA total balance is the same as the EFT total
"RTN","RCDPEAP1",278,0)
 S RCTOT=+$$GET1^DIQ(344.4,RCERA_",",.05)
"RTN","RCDPEAP1",279,0)
 ;Sum of ERA claim line payments
"RTN","RCDPEAP1",280,0)
 S RCSUB=0,RCLTOT=0
"RTN","RCDPEAP1",281,0)
 F  S RCSUB=$O(^RCY(344.4,RCERA,1,RCSUB)) Q:'RCSUB  D
"RTN","RCDPEAP1",282,0)
 . S RCLTOT=RCLTOT+$$GET1^DIQ(344.41,RCSUB_","_RCERA_",",.03)
"RTN","RCDPEAP1",283,0)
 ;Plus sum of ERA adjustment lines
"RTN","RCDPEAP1",284,0)
 S RCSUB=0
"RTN","RCDPEAP1",285,0)
 F  S RCSUB=$O(^RCY(344.4,RCERA,2,RCSUB)) Q:'RCSUB  D
"RTN","RCDPEAP1",286,0)
 . S RCLTOT=RCLTOT+$$GET1^DIQ(344.42,RCSUB_","_RCERA_",",.03)
"RTN","RCDPEAP1",287,0)
 ;Return 1 if total of ERA lines does not match EFT
"RTN","RCDPEAP1",288,0)
 Q $S(RCTOT=RCLTOT:0,1:1)
"RTN","RCDPEAR2")
0^10^B111529113^B99664049
"RTN","RCDPEAR2",1,0)
RCDPEAR2 ;ALB/TMK/PJH - EFT Unmatched Aging Report - FILE 344.3 ;Nov 24, 2014@18:31:57
"RTN","RCDPEAR2",2,0)
 ;;4.5;Accounts Receivable;**173,269,276,284,283,293,298,318**;Mar 20, 1995;Build 37
"RTN","RCDPEAR2",3,0)
 ;Per VA Directive 6402, this routine should not be modified.
"RTN","RCDPEAR2",4,0)
 Q
"RTN","RCDPEAR2",5,0)
 ;
"RTN","RCDPEAR2",6,0)
 ; PRCA*4.5*298 notes at bottom
"RTN","RCDPEAR2",7,0)
EN1 ; option: EFT Unmatched Aging Report [RCDPE EFT AGING REPORT]
"RTN","RCDPEAR2",8,0)
 N %ZIS,DIC,DIR,DTOUT,DUOUT,POP,RCDISPTY,RCDTRNG,RCEND,RCHDR,RCJOB
"RTN","RCDPEAR2",9,0)
 N RCJOB1,RCLSTMGR,RCNP,RCPYRLST,RCPGNUM,RCSTART,RCTMPND,X,Y
"RTN","RCDPEAR2",10,0)
 ; RCDISPTY = display type
"RTN","RCDPEAR2",11,0)
 ; RCEND = end date
"RTN","RCDPEAR2",12,0)
 ; RCLSTMGR = list manager flag
"RTN","RCDPEAR2",13,0)
 ; RCNP = payer info: "1^first payer^last payer" or "2^^" (for all)
"RTN","RCDPEAR2",14,0)
 ; RCPYRLST - payer list for selected payers
"RTN","RCDPEAR2",15,0)
 ; RCDTRNG= "1^start date^end date"
"RTN","RCDPEAR2",16,0)
 ; RCSTART = start date
"RTN","RCDPEAR2",17,0)
 ; RCTMPND = name of the subscript for ^TMP to use
"RTN","RCDPEAR2",18,0)
 ;
"RTN","RCDPEAR2",19,0)
 S RCLSTMGR=""  ; initial value
"RTN","RCDPEAR2",20,0)
 S RCDTRNG=$$DTRNG^RCDPEM4() G:'(RCDTRNG>0) EN1Q
"RTN","RCDPEAR2",21,0)
 S RCSTART=$P(RCDTRNG,U,2)-1,RCEND=$P(RCDTRNG,U,3)
"RTN","RCDPEAR2",22,0)
 ;Get insurance company to be used as filter
"RTN","RCDPEAR2",23,0)
 ; PRCA*4.5*284 - RCNP (Type of Response(1=Range,2=All,3=Specific)^From name^To name)
"RTN","RCDPEAR2",24,0)
 S RCNP=$$GETPAY^RCDPEM9(344.31) G:RCNP<0 EN1Q
"RTN","RCDPEAR2",25,0)
 ;Get display type
"RTN","RCDPEAR2",26,0)
 S RCDISPTY=$$DISPTY^RCDPEM3() G:RCDISPTY<0 EN1Q
"RTN","RCDPEAR2",27,0)
 ; display device info about Excel format, set ListMan flag to prevent question
"RTN","RCDPEAR2",28,0)
 I RCDISPTY S RCLSTMGR="^" D INFO^RCDPEM6
"RTN","RCDPEAR2",29,0)
 I $D(DUOUT)!$D(DTOUT) G EN1Q
"RTN","RCDPEAR2",30,0)
 S RCJOB=$J  ; needed in RPTOUT
"RTN","RCDPEAR2",31,0)
 ;
"RTN","RCDPEAR2",32,0)
 ; if not output to Excel ask for ListMan display, exit if timeout or '^' - PRCA*4.5*298
"RTN","RCDPEAR2",33,0)
 I RCLSTMGR="" S RCLSTMGR=$$ASKLM^RCDPEARL I RCLSTMGR<0 G EN1Q
"RTN","RCDPEAR2",34,0)
 ; display in ListMan format and exit on return
"RTN","RCDPEAR2",35,0)
 I RCLSTMGR D  G EN1Q
"RTN","RCDPEAR2",36,0)
 .S RCTMPND=$T(+0)_"^EFT UNMATCHED AGING"  K ^TMP($J,RCTMPND)  ; clean any residue
"RTN","RCDPEAR2",37,0)
 .D RPTOUT
"RTN","RCDPEAR2",38,0)
 .N H,L,HDR S L=0
"RTN","RCDPEAR2",39,0)
 .S HDR("TITLE")=$$HDRNM
"RTN","RCDPEAR2",40,0)
 .F H=1:1:7 I $D(RCHDR(H)) S L=H,HDR(H)=RCHDR(H)  ; take first 3 lines of report header
"RTN","RCDPEAR2",41,0)
 .I $O(RCHDR(L)) D  ; any remaining header lines at top of report
"RTN","RCDPEAR2",42,0)
 ..N N S N=0,H=L F  S H=$O(RCHDR(H)) Q:'H  S N=N+.001,^TMP($J,RCTMPND,N)=RCHDR(H)
"RTN","RCDPEAR2",43,0)
 .D LMRPT^RCDPEARL(.HDR,$NA(^TMP($J,RCTMPND))) ; generate ListMan display
"RTN","RCDPEAR2",44,0)
 ;
"RTN","RCDPEAR2",45,0)
 S RCJOB=$J,RCTMPND=""
"RTN","RCDPEAR2",46,0)
 ; Ask device
"RTN","RCDPEAR2",47,0)
 S %ZIS="QM" D ^%ZIS G:POP EN1Q
"RTN","RCDPEAR2",48,0)
 I $D(IO("Q")) D  G EN1Q
"RTN","RCDPEAR2",49,0)
 .N ZTDESC,ZTRTN,ZTSAVE,ZTSTOP
"RTN","RCDPEAR2",50,0)
 .S ZTRTN="RPTOUT^RCDPEAR2",ZTDESC="EFT AGING REPORT"
"RTN","RCDPEAR2",51,0)
 .S ZTSAVE("RC*")="",ZTSAVE("VAUTD")=""
"RTN","RCDPEAR2",52,0)
 .; PRCA*4.5*284 - Because TMP global may be on another server, save off specific payers in local
"RTN","RCDPEAR2",53,0)
 .I +RCNP=3 M RCPYRLST=^TMP("RCSELPAY",$J)
"RTN","RCDPEAR2",54,0)
 .D ^%ZTLOAD
"RTN","RCDPEAR2",55,0)
 .W !!,$S($G(ZTSK):"Task number "_ZTSK_" has been queued.",1:"Unable to queue this task.")
"RTN","RCDPEAR2",56,0)
 .K ZTSK,IO("Q") D HOME^%ZIS
"RTN","RCDPEAR2",57,0)
 ;
"RTN","RCDPEAR2",58,0)
 U IO D RPTOUT
"RTN","RCDPEAR2",59,0)
 ;
"RTN","RCDPEAR2",60,0)
EN1Q ; exit and clean up
"RTN","RCDPEAR2",61,0)
 I 'RCLSTMGR D ^%ZISC
"RTN","RCDPEAR2",62,0)
 K ^TMP("RCSELPAY",$J),^TMP("RCPAYER",$J)
"RTN","RCDPEAR2",63,0)
 Q
"RTN","RCDPEAR2",64,0)
 ;
"RTN","RCDPEAR2",65,0)
RPTOUT ; Entry point for queued job, nightly job
"RTN","RCDPEAR2",66,0)
 ; RCTMPND = name of the subscript for ^TMP to use to return all lines
"RTN","RCDPEAR2",67,0)
 ;         If undefined or null, output is printed
"RTN","RCDPEAR2",68,0)
 ; Return global if RCTMPND not null: ^TMP($J,RCTMPND,line#)=line text
"RTN","RCDPEAR2",69,0)
 N DIC,DUOUT,RC0,RC13,RC3443,RCCT,RCIEN,RCNT,RCOUT,RCPAY,RCPAYER,RCPAYID
"RTN","RCDPEAR2",70,0)
 N RCSTOP,RCTOT,RCZ,X,XX,YY,Z,Z0,ZZ
"RTN","RCDPEAR2",71,0)
 S RCTMPND=$G(RCTMPND)
"RTN","RCDPEAR2",72,0)
 S (RCCT,RCSTOP,RCNT,RCTOT)=0
"RTN","RCDPEAR2",73,0)
 K ^TMP($J,"RCERA_AGED"),^TMP($J,"RCERA_ADJ")
"RTN","RCDPEAR2",74,0)
 ; PRCA*4.5*284 - Queued job needs to reload payer selection list
"RTN","RCDPEAR2",75,0)
 I $G(RCJOB)'="",RCJOB'=$J D
"RTN","RCDPEAR2",76,0)
 .K ^TMP("RCSELPAY",$J)
"RTN","RCDPEAR2",77,0)
 .D RLOAD^RCDPEAR1(344.31)
"RTN","RCDPEAR2",78,0)
 .S RCJOB=$J
"RTN","RCDPEAR2",79,0)
 ; build local payer array here
"RTN","RCDPEAR2",80,0)
 S RCNP=+RCNP
"RTN","RCDPEAR2",81,0)
 D SELPAY^RCDPEAR1(RCNP,RCJOB,.RCPAY)
"RTN","RCDPEAR2",82,0)
 I RCTMPND'="" K ^TMP($J,RCTMPND)
"RTN","RCDPEAR2",83,0)
 ; cross-ref on file #344.31 field #.08 - MATCH STATUS
"RTN","RCDPEAR2",84,0)
 S RCIEN=0 F  S RCIEN=$O(^RCY(344.31,"AMATCH",0,RCIEN)) Q:'RCIEN  D   ;unmatched entries only
"RTN","RCDPEAR2",85,0)
 .Q:$P($G(^RCY(344.31,RCIEN,3)),U)  ; EFT has been removed
"RTN","RCDPEAR2",86,0)
 .Q:$P($G(^RCY(344.31,RCIEN,0)),U,7)=0  ; payment of zero
"RTN","RCDPEAR2",87,0)
 .;
"RTN","RCDPEAR2",88,0)
 .S RC13=$P($G(^RCY(344.31,RCIEN,0)),U,13)  ; date received
"RTN","RCDPEAR2",89,0)
 .; Check for payer match
"RTN","RCDPEAR2",90,0)
 .I '$$CHKPYR^RCDPEDAR(RCIEN,0,RCJOB,RCNP) Q   ;PRCA*4.5*318 passed existing variable RCNP
"RTN","RCDPEAR2",91,0)
 .; Check date range
"RTN","RCDPEAR2",92,0)
 .Q:(RCSTART>RC13)!(RC13>RCEND)
"RTN","RCDPEAR2",93,0)
 .; Passed all the filters - include on report
"RTN","RCDPEAR2",94,0)
 .S ^TMP($J,"RCEFT_AGED",$$FMDIFF^XLFDT(RC13,DT),RCIEN)=0,RCNT=RCNT+1
"RTN","RCDPEAR2",95,0)
 ;
"RTN","RCDPEAR2",96,0)
 D:'RCLSTMGR HDRBLD  ; create header
"RTN","RCDPEAR2",97,0)
 D:RCLSTMGR HDRLM  ; create Listman header
"RTN","RCDPEAR2",98,0)
 ;
"RTN","RCDPEAR2",99,0)
 I RCDISPTY D EXCEL Q
"RTN","RCDPEAR2",100,0)
 ;
"RTN","RCDPEAR2",101,0)
 ; Find total amount of EFTs
"RTN","RCDPEAR2",102,0)
 S RCZ="" F  S RCZ=$O(^TMP($J,"RCEFT_AGED",RCZ)) Q:RCZ=""  S RCIEN=0 F  S RCIEN=$O(^TMP($J,"RCEFT_AGED",RCZ,RCIEN)) Q:'RCIEN  D  G:RCSTOP PRTQ
"RTN","RCDPEAR2",103,0)
 .I $D(ZTQUEUED),$$S^%ZTLOAD S (RCSTOP,ZTSTOP)=1 K ZTREQ I +$G(RCPGNUM) W:RCTMPND="" !!,"***TASK STOPPED BY USER***" Q
"RTN","RCDPEAR2",104,0)
 .S RC0=$G(^RCY(344.31,RCIEN,0)),RC3443=$G(^RCY(344.3,+RC0,0))
"RTN","RCDPEAR2",105,0)
 .S RCTOT=RCTOT+$P(RC0,U,7)
"RTN","RCDPEAR2",106,0)
 ;
"RTN","RCDPEAR2",107,0)
 D:'RCLSTMGR HDRLST^RCDPEARL(.RCSTOP,.RCHDR)  ; initial report header
"RTN","RCDPEAR2",108,0)
 ;
"RTN","RCDPEAR2",109,0)
 S Z=$$SETSTR^VALM1("Totals:","",1,79)
"RTN","RCDPEAR2",110,0)
 D SL^RCDPEARL(Z,.RCCT,RCTMPND)
"RTN","RCDPEAR2",111,0)
 S Z=$$SETSTR^VALM1(" Number Aged Electronic EFT Messages Found: "_RCNT,"",1,79)
"RTN","RCDPEAR2",112,0)
 D SL^RCDPEARL(Z,.RCCT,RCTMPND)
"RTN","RCDPEAR2",113,0)
 S Z=$$SETSTR^VALM1(" Amount Aged Electronic EFT Messages Found: $"_$FN(+RCTOT,",",2),"",1,79)
"RTN","RCDPEAR2",114,0)
 D SL^RCDPEARL(Z,.RCCT,RCTMPND)
"RTN","RCDPEAR2",115,0)
 D SL^RCDPEARL($TR($J("",IOM)," ","="),.RCCT,RCTMPND)
"RTN","RCDPEAR2",116,0)
 ;
"RTN","RCDPEAR2",117,0)
 S RCZ="" F  S RCZ=$O(^TMP($J,"RCEFT_AGED",RCZ)) Q:RCZ=""  S RCIEN=0 F  S RCIEN=$O(^TMP($J,"RCEFT_AGED",RCZ,RCIEN)) Q:'RCIEN  D  G:RCSTOP PRTQ
"RTN","RCDPEAR2",118,0)
 .I $D(ZTQUEUED),$$S^%ZTLOAD S (RCSTOP,ZTSTOP)=1 K ZTREQ I +$G(RCPGNUM) W:RCTMPND="" !!,"***TASK STOPPED BY USER***" Q
"RTN","RCDPEAR2",119,0)
 .I RCPGNUM D SL^RCDPEARL(" ",.RCCT,.RCTMPND) ; On detail list, skip line
"RTN","RCDPEAR2",120,0)
 .I 'RCLSTMGR,$Y>(IOSL-RCHDR(0)) D HDRLST^RCDPEARL(.RCSTOP,.RCHDR) Q:RCSTOP
"RTN","RCDPEAR2",121,0)
 .S RC0=$G(^RCY(344.31,RCIEN,0)),RC3443=$G(^RCY(344.3,+RC0,0))
"RTN","RCDPEAR2",122,0)
 .S RCTOT=RCTOT+$P(RC0,U,7)
"RTN","RCDPEAR2",123,0)
 .S Z=$$SETSTR^VALM1($J(-RCZ,4),"",1,4)
"RTN","RCDPEAR2",124,0)
 .; PRCA*4.5*318 moved deposit date up a row to give more room for payer/payer ID
"RTN","RCDPEAR2",125,0)
 .S Z=$$SETSTR^VALM1("  "_$P(RC0,U,4),Z,5,52)  ;trace#
"RTN","RCDPEAR2",126,0)
 .S Z=$$SETSTR^VALM1($$FMTE^XLFDT($P(RC0,U,12),2),Z,73,8)  ; deposit date
"RTN","RCDPEAR2",127,0)
 .D SL^RCDPEARL(Z,.RCCT,RCTMPND)
"RTN","RCDPEAR2",128,0)
 .N RCPAY S RCPAY=$P(RC0,U,2) S:RCPAY="" RCPAY="NO PAYER NAME RECEIVED" ; PRCA*4.5*298
"RTN","RCDPEAR2",129,0)
 .S RCPAYID=$P(RC0,U,3)                          ; Payer ID    ;PRCA*4.5*298
"RTN","RCDPEAR2",130,0)
 .;PRCA*4.5*318 dynamically display payer name/ID based on length
"RTN","RCDPEAR2",131,0)
 .S RCPAYER=RCPAY_"/"_RCPAYID
"RTN","RCDPEAR2",132,0)
 .I $L(RCPAYER)>76 D
"RTN","RCDPEAR2",133,0)
 . . S ZZ=$L(RCPAYER,"/"),XX=$P(RCPAYER,"/",1,ZZ-1),YY=$P(RCPAYER,"/",ZZ)
"RTN","RCDPEAR2",134,0)
 . . S XX=$E(RCPAYER,1,$L(XX)-($L(RCPAYER)-76)),RCPAYER=XX_"/"_YY
"RTN","RCDPEAR2",135,0)
 .S Z=$$SETSTR^VALM1(RCPAYER,"",5,76) ; PRCA*4.5*298            (payer/payer ID)
"RTN","RCDPEAR2",136,0)
 .;S Z=$$SETSTR^VALM1("  "_$$FMTE^XLFDT($P(RC0,U,12),2),Z,70,10)  ; deposit date
"RTN","RCDPEAR2",137,0)
 .;end of PRCA*4.5*318 display change
"RTN","RCDPEAR2",138,0)
 .D SL^RCDPEARL(Z,.RCCT,RCTMPND)
"RTN","RCDPEAR2",139,0)
 .S Z=$$SETSTR^VALM1($J("",6)_$S($P(RC0,U,13):$$FMTE^XLFDT($P(RC0,U,13),2),1:""),"",1,17)
"RTN","RCDPEAR2",140,0)
 .S Z=$$SETSTR^VALM1("  "_$J($P(RC0,U,7),15,2),Z,18,17)
"RTN","RCDPEAR2",141,0)
 .; PRCA*4.5*283 - change length from 8 to 11 to allow for 9 digit DEP #'s
"RTN","RCDPEAR2",142,0)
 .S Z=$$SETSTR^VALM1("  "_$P(RC3443,U,6),Z,35,11)
"RTN","RCDPEAR2",143,0)
 .S Z=$$SETSTR^VALM1("  "_$S($P(RC3443,U,12):"",1:"NOT ")_"Posted to 8NZZ"_$S($P(RC3443,U,12):" "_$$FMTE^XLFDT($P(RC3443,U,11),2),1:""),Z,47,36)
"RTN","RCDPEAR2",144,0)
 .D SL^RCDPEARL(Z,.RCCT,RCTMPND)
"RTN","RCDPEAR2",145,0)
 .K RCOUT
"RTN","RCDPEAR2",146,0)
 .D GETS^DIQ(344.31,RCIEN_",",2,"E","RCOUT")
"RTN","RCDPEAR2",147,0)
 .Q:'$O(RCOUT(344.31,RCIEN_",",2,0))
"RTN","RCDPEAR2",148,0)
 .D SL^RCDPEARL($J("",8)_"--EXCEPTION NOTES--",.RCCT,RCTMPND)
"RTN","RCDPEAR2",149,0)
 .S Z=0 F  S Z=$O(RCOUT(344.31,RCIEN_",",2,Z)) Q:'Z  D  Q:RCSTOP
"RTN","RCDPEAR2",150,0)
 ..I 'RCLSTMGR,$Y>(IOSL-RCHDR(0)) D HDRLST^RCDPEARL(.RCSTOP,.RCHDR) Q:RCSTOP
"RTN","RCDPEAR2",151,0)
 ..D SL^RCDPEARL($J("",8)_" "_RCOUT(344.31,RCIEN_",",2,Z),.RCCT,RCTMPND)
"RTN","RCDPEAR2",152,0)
 ;
"RTN","RCDPEAR2",153,0)
 ;
"RTN","RCDPEAR2",154,0)
 ; PRCA*4.5*298, put end-of-report into SL^RCDPEARL
"RTN","RCDPEAR2",155,0)
 D SL^RCDPEARL(" ",.RCCT,RCTMPND)  ; skip a line
"RTN","RCDPEAR2",156,0)
 D SL^RCDPEARL($$ENDORPRT^RCDPEARL,.RCCT,RCTMPND)
"RTN","RCDPEAR2",157,0)
 ;
"RTN","RCDPEAR2",158,0)
PRTQ ;
"RTN","RCDPEAR2",159,0)
 ; PRCA*4.5*298, added ListMan check
"RTN","RCDPEAR2",160,0)
 I '$D(ZTQUEUED),'RCLSTMGR,'RCSTOP D ASK^RCDPEARL(.RCSTOP)
"RTN","RCDPEAR2",161,0)
 I $D(ZTQUEUED) S ZTREQ="@"
"RTN","RCDPEAR2",162,0)
 I '$D(ZTQUEUED) D ^%ZISC
"RTN","RCDPEAR2",163,0)
 K ^TMP($J,"RCEFT_AGED"),ZTQUEUED
"RTN","RCDPEAR2",164,0)
 Q
"RTN","RCDPEAR2",165,0)
 ;
"RTN","RCDPEAR2",166,0)
 ; extrinsic variable, text for header PRCA*4.5*298
"RTN","RCDPEAR2",167,0)
HDRNM() Q "EFT UNMATCHED AGING REPORT"
"RTN","RCDPEAR2",168,0)
 ;
"RTN","RCDPEAR2",169,0)
HDRBLD ; create the report header
"RTN","RCDPEAR2",170,0)
 ; returns RCHDR, RCPGNUM, RCSTOP
"RTN","RCDPEAR2",171,0)
 ;   RCHDR(0) = header text line count
"RTN","RCDPEAR2",172,0)
 ;   RCHDR("XECUTE") = M code for page number
"RTN","RCDPEAR2",173,0)
 ;   RCHDR("RUNDATE") = date/time report generated, external format
"RTN","RCDPEAR2",174,0)
 ;   RCPGNUM - page counter
"RTN","RCDPEAR2",175,0)
 ;   RCSTOP - flag to exit
"RTN","RCDPEAR2",176,0)
 ;INPUT:
"RTN","RCDPEAR2",177,0)
 ; RCDTRNG - date range filter value to be printed as part of the header
"RTN","RCDPEAR2",178,0)
 ; RCPAY - Payer filter value(s)
"RTN","RCDPEAR2",179,0)
 ; RCLSTMGR
"RTN","RCDPEAR2",180,0)
 ;
"RTN","RCDPEAR2",181,0)
 K RCHDR S RCHDR("RUNDATE")=$$NOW^RCDPEARL,RCPGNUM=0,RCSTOP=0
"RTN","RCDPEAR2",182,0)
 ;
"RTN","RCDPEAR2",183,0)
 I RCDISPTY D  Q  ; Excel format, xecute code is QUIT, null page number
"RTN","RCDPEAR2",184,0)
 .S RCHDR(0)=1,RCHDR("XECUTE")="Q",RCPGNUM=""
"RTN","RCDPEAR2",185,0)
 .S RCHDR(1)="Aged Days^Trace #^Deposit From/ID^File Date^Deposit Amount^Deposit #^Deposit Post Status^Deposit Date"
"RTN","RCDPEAR2",186,0)
 ;
"RTN","RCDPEAR2",187,0)
 N START,END,MSG,DATE,Y,DIV,HCNT
"RTN","RCDPEAR2",188,0)
 S START=$$FMTE^XLFDT($P(RCDTRNG,U,2),2),END=$$FMTE^XLFDT($P(RCDTRNG,U,3),2)
"RTN","RCDPEAR2",189,0)
 ;
"RTN","RCDPEAR2",190,0)
 S Y=$$HDRNM,HCNT=1,RCHDR(HCNT)=$J("",80-$L(Y)\2)_Y  ; line 1 will be replaced by XECUTE code below
"RTN","RCDPEAR2",191,0)
 S RCHDR("XECUTE")="N Y S RCPGNUM=RCPGNUM+1,Y=$$HDRNM^"_$T(+0)_"_$S(RCLSTMGR:"""",1:$J(""Page: ""_RCPGNUM,12)),RCHDR(1)=$J("" "",80-$L(Y)\2)_Y"
"RTN","RCDPEAR2",192,0)
 S Y="RUN DATE: "_RCHDR("RUNDATE"),HCNT=HCNT+1,RCHDR(HCNT)=$J("",80-$L(Y)\2)_Y  ; line 1 will be replaced by XECUTE code below
"RTN","RCDPEAR2",193,0)
 ;
"RTN","RCDPEAR2",194,0)
 ; Payer(s)
"RTN","RCDPEAR2",195,0)
 S Y="PAYERS: " D
"RTN","RCDPEAR2",196,0)
 .I $D(RCPAY)=1 S Y=Y_RCPAY,HCNT=HCNT+1,RCHDR(HCNT)=$J("",80-$L(Y)\2)_Y Q
"RTN","RCDPEAR2",197,0)
 .N S,X S S=0 F  S S=$O(RCPAY(S)) Q:'S  D
"RTN","RCDPEAR2",198,0)
 ..S X=RCPAY(S)_$S($O(RCPAY(S)):", ",1:"")
"RTN","RCDPEAR2",199,0)
 ..I $L(X)+$L(Y)>80 S HCNT=HCNT+1,RCHDR(HCNT)=Y,Y=$J(" ",8)
"RTN","RCDPEAR2",200,0)
 ..S Y=Y_X
"RTN","RCDPEAR2",201,0)
 .;
"RTN","RCDPEAR2",202,0)
 .S:$TR(Y," ")]"" HCNT=HCNT+1,RCHDR(HCNT)=Y  ; any residual data
"RTN","RCDPEAR2",203,0)
 S Y="DATE RANGE: "_$P($$FMTE^XLFDT(START,2),"@")_" - "_$P($$FMTE^XLFDT(END,2),"@")_" (DATE EFT FILED)"
"RTN","RCDPEAR2",204,0)
 S Y=$J("",80-$L(Y)\2)_Y,HCNT=HCNT+1,RCHDR(HCNT)=Y
"RTN","RCDPEAR2",205,0)
 ;
"RTN","RCDPEAR2",206,0)
 S Y="AGED",HCNT=HCNT+1,RCHDR(HCNT)=Y
"RTN","RCDPEAR2",207,0)
 ; PRCA*4.5*318 moved deposit date up a row
"RTN","RCDPEAR2",208,0)
 S Y="DAYS  TRACE #                                                           DEP DATE",HCNT=HCNT+1,RCHDR(HCNT)=Y
"RTN","RCDPEAR2",209,0)
 S Y="    DEPOSIT FROM/ID",HCNT=HCNT+1,RCHDR(HCNT)=Y
"RTN","RCDPEAR2",210,0)
 S Y="      FILE DATE     DEPOSIT AMOUNT  DEP #       DEPOSIT POST STATUS",HCNT=HCNT+1,RCHDR(HCNT)=Y
"RTN","RCDPEAR2",211,0)
 S Y="",$P(Y,"=",81)="",HCNT=HCNT+1,RCHDR(HCNT)=Y  ; row of equal signs at bottom
"RTN","RCDPEAR2",212,0)
 ;
"RTN","RCDPEAR2",213,0)
 S RCHDR(0)=HCNT
"RTN","RCDPEAR2",214,0)
 ;
"RTN","RCDPEAR2",215,0)
 Q
"RTN","RCDPEAR2",216,0)
 ;
"RTN","RCDPEAR2",217,0)
HDRLM ; create the Listman header section
"RTN","RCDPEAR2",218,0)
 ; returns RCHDR
"RTN","RCDPEAR2",219,0)
 ;   RCHDR(0) = header text line count
"RTN","RCDPEAR2",220,0)
 ;INPUT:
"RTN","RCDPEAR2",221,0)
 ; RCDTRNG - date range filter value to be printed as part of the header
"RTN","RCDPEAR2",222,0)
 ; RCPAY - Payer filter value(s)
"RTN","RCDPEAR2",223,0)
 ;
"RTN","RCDPEAR2",224,0)
 K RCHDR S RCPGNUM=0,RCSTOP=0
"RTN","RCDPEAR2",225,0)
 ;
"RTN","RCDPEAR2",226,0)
 N START,END,MSG,DATE,Y,DIV,HCNT
"RTN","RCDPEAR2",227,0)
 S START=$$FMTE^XLFDT($P(RCDTRNG,U,2),2),END=$$FMTE^XLFDT($P(RCDTRNG,U,3),2)
"RTN","RCDPEAR2",228,0)
 S Y="DATE RANGE: "_$P($$FMTE^XLFDT(START,2),"@")_" - "_$P($$FMTE^XLFDT(END,2),"@")_" (DATE EFT FILED)"
"RTN","RCDPEAR2",229,0)
 S HCNT=1,RCHDR(HCNT)=Y
"RTN","RCDPEAR2",230,0)
 ; Payer(s)
"RTN","RCDPEAR2",231,0)
 S Y="PAYERS: " D
"RTN","RCDPEAR2",232,0)
 .I $D(RCPAY)=1 S Y=Y_RCPAY,HCNT=HCNT+1,RCHDR(HCNT)=Y Q
"RTN","RCDPEAR2",233,0)
 .N S,X S S=0 F  S S=$O(RCPAY(S)) Q:'S  D
"RTN","RCDPEAR2",234,0)
 ..S X=RCPAY(S)_$S($O(RCPAY(S)):", ",1:"")
"RTN","RCDPEAR2",235,0)
 ..I $L(X)+$L(Y)>80 S HCNT=HCNT+1,RCHDR(HCNT)=Y,Y=$J(" ",8)
"RTN","RCDPEAR2",236,0)
 ..S Y=Y_X
"RTN","RCDPEAR2",237,0)
 .;
"RTN","RCDPEAR2",238,0)
 .S:$TR(Y," ")]"" HCNT=HCNT+1,RCHDR(HCNT)=Y  ; any residual data
"RTN","RCDPEAR2",239,0)
 ;
"RTN","RCDPEAR2",240,0)
 S HCNT=HCNT+1,RCHDR(HCNT)=""
"RTN","RCDPEAR2",241,0)
 S Y="AGED",HCNT=HCNT+1,RCHDR(HCNT)=Y
"RTN","RCDPEAR2",242,0)
 ; PRCA*4.5*318 moved deposit date up a row
"RTN","RCDPEAR2",243,0)
 S Y="DAYS TRACE #                                                           DEP DATE",HCNT=HCNT+1,RCHDR(HCNT)=Y
"RTN","RCDPEAR2",244,0)
 S Y="    DEPOSIT FROM/ID",HCNT=HCNT+1,RCHDR(HCNT)=Y
"RTN","RCDPEAR2",245,0)
 S Y="     FILE DATE     DEPOSIT AMOUNT  DEP #       DEPOSIT POST STATUS",HCNT=HCNT+1,RCHDR(HCNT)=Y
"RTN","RCDPEAR2",246,0)
 ;
"RTN","RCDPEAR2",247,0)
 S RCHDR(0)=HCNT
"RTN","RCDPEAR2",248,0)
 ;
"RTN","RCDPEAR2",249,0)
 Q
"RTN","RCDPEAR2",250,0)
 ;
"RTN","RCDPEAR2",251,0)
EXCEL ; Print report to screen, one record per line for export to MS Excel.
"RTN","RCDPEAR2",252,0)
 ; RCTMPND = name of the subscript for ^TMP to use
"RTN","RCDPEAR2",253,0)
 W !!,"Aged Days^Trace #^Deposit From/ID^File Date^Deposit Amount^Deposit #^Deposit Post Status^Deposit Date"
"RTN","RCDPEAR2",254,0)
 S RCZ="" F  S RCZ=$O(^TMP($J,"RCEFT_AGED",RCZ)) Q:RCZ=""  S RCIEN=0 F  S RCIEN=$O(^TMP($J,"RCEFT_AGED",RCZ,RCIEN)) Q:'RCIEN  D  G:RCSTOP PRTQ2
"RTN","RCDPEAR2",255,0)
 .I $D(ZTQUEUED),$$S^%ZTLOAD S (RCSTOP,ZTSTOP)=1 K ZTREQ I +$G(RCPG) W:RCTMPND="" !!,"***TASK STOPPED BY USER***" Q
"RTN","RCDPEAR2",256,0)
 .S RC0=$G(^RCY(344.31,RCIEN,0)),RC3443=$G(^RCY(344.3,+RC0,0))
"RTN","RCDPEAR2",257,0)
 .N RCPAY S RCPAY=$P(RC0,U,2) S:RCPAY="" RCPAY="NO PAYER NAME RECEIVED" ; PRCA*4.5*298
"RTN","RCDPEAR2",258,0)
 .S Z=$J(-RCZ,4)_"^"_$P(RC0,U,4)_"^"_RCPAY_"/"_$P(RC0,U,3)_"^"_$S($P(RC0,U,13):$$FMTE^XLFDT($P(RC0,U,13),2),1:"")_"^" ; PRCA*4.5*298
"RTN","RCDPEAR2",259,0)
 .S Z=Z_$P(RC0,U,7)_"^"_$P(RC3443,U,6)_"^"_$S($P(RC3443,U,12):"",1:"NOT ")_"Posted to 8NZZ"_$S($P(RC3443,U,12):"^"_$$FMTE^XLFDT($P(RC0,U,12),2),1:"")
"RTN","RCDPEAR2",260,0)
 .W !,Z
"RTN","RCDPEAR2",261,0)
 W !!,"*** END OF REPORT ***",!
"RTN","RCDPEAR2",262,0)
 ;
"RTN","RCDPEAR2",263,0)
PRTQ2 ;
"RTN","RCDPEAR2",264,0)
 I $D(ZTQUEUED) S ZTREQ="@"
"RTN","RCDPEAR2",265,0)
 I '$D(ZTQUEUED) D ^%ZISC
"RTN","RCDPEAR2",266,0)
 K ^TMP($J,"RCEFT_AGED"),^TMP("RCSELPAY",$J),^TMP("RCPAYER",$J),^TMP($J,"RCERA_ADJ")
"RTN","RCDPEAR2",267,0)
 Q
"RTN","RCDPEAR2",268,0)
 ;
"RTN","RCDPEAR2",269,0)
 ;PRCA*4.5*298
"RTN","RCDPEAR2",270,0)
 ; removed RCIND local variable
"RTN","RCDPEAR2",271,0)
 ; changed RC00 to RC3443
"RTN","RCDPEAR2",272,0)
 ; replaced SETLINE with SL^RCDPEARL
"RTN","RCDPEAR2",273,0)
 ; added $$HDRNM
"RTN","RCDPEAR2",274,0)
 ; added RCLSTMGR in checks for header
"RTN","RCDPEAR2",275,0)
 ; changed upper case text to mixed case throughout
"RTN","RCDPEAR2",276,0)
 ;
"RTN","RCDPEDA2")
0^7^B97233513^n/a
"RTN","RCDPEDA2",1,0)
RCDPEDA2 ;EDE/DW - ACTIVITY REPORT ;Feb 17, 2017@10:37:00
"RTN","RCDPEDA2",2,0)
 ;;4.5;Accounts Receivable;**318**;Mar 20, 1995;Build 37
"RTN","RCDPEDA2",3,0)
 ;Per VA Directive 6402, this routine should not be modified.
"RTN","RCDPEDA2",4,0)
 Q
"RTN","RCDPEDA2",5,0)
 ;
"RTN","RCDPEDA2",6,0)
RPT2(INPUT) ; Entry point from RCDPEDAR
"RTN","RCDPEDA2",7,0)
 ; Loop through EDI LOCKBOX DEPOSIT entries
"RTN","RCDPEDA2",8,0)
 ; Input:   INPUT                           - A1^A2^A3^...^An Where:
"RTN","RCDPEDA2",9,0)
 ;                                             A1 - 1 - Called by nightly job, 0 otherwise
"RTN","RCDPEDA2",10,0)
 ;                                             A2 - 1 - Display to list manager, 0 otherwise
"RTN","RCDPEDA2",11,0)
 ;                                             A3 - 1 - Detail report, 0 - Summary report
"RTN","RCDPEDA2",12,0)
 ;                                             A4 - Current Page Number
"RTN","RCDPEDA2",13,0)
 ;                                             A5 - Stop Flag
"RTN","RCDPEDA2",14,0)
 ;                                             A6 - Start of Date Range
"RTN","RCDPEDA2",15,0)
 ;                                             A7 - End of Date Range
"RTN","RCDPEDA2",16,0)
 ;                                             A8 - Current Line Number
"RTN","RCDPEDA2",17,0)
 ;                                             A9 - Internal Date being processed
"RTN","RCDPEDA2",18,0)
 ;          ^TMP(B1,$J,B2,B3)               = ""
"RTN","RCDPEDA2",19,0)
 ;          ^TMP(B1,$J,B2,B3,"EFT",B4)      = "" Where:
"RTN","RCDPEDA2",20,0)
 ;                                            B1 - "RCDAILYACT"
"RTN","RCDPEDA2",21,0)
 ;                                            B2 - Internal Date from DATE/TIME ADDED
"RTN","RCDPEDA2",22,0)
 ;                                                 (344.3, .13)
"RTN","RCDPEDA2",23,0)
 ;                                            B3 - Internal IEN for 344.3
"RTN","RCDPEDA2",24,0)
 ;                                            B4 - Internal IEN for file 344.31
"RTN","RCDPEDA2",25,0)
 ; Output:  INPUT                           - A1^A2^A3^...^An - The following pieces 
"RTN","RCDPEDA2",26,0)
 ;                                                              may be updated
"RTN","RCDPEDA2",27,0)
 ;                                             A4 - Updated Page Number
"RTN","RCDPEDA2",28,0)
 ;                                             A5 - Stop Flag
"RTN","RCDPEDA2",29,0)
 ;                                             A6 - Updated Line number
"RTN","RCDPEDA2",30,0)
 ;          ^TMP($J,"TOTALS","DEP",C1)      - Total # of deposits by Internal date (C1)
"RTN","RCDPEDA2",31,0)
 ;          ^TMP($J,"TOTALS","DEPA",C1)     - Total Deposit Amount by Internal date (C1)
"RTN","RCDPEDA2",32,0)
 ;          ^TMP($J,"TOTALS","EFT","D")     - Total Deposit Amount by EFTs for date
"RTN","RCDPEDA2",33,0)
 ;          ^TMP($J,"TOTALS","FMS")         - FMS Document Status or "NO FMS DOC"
"RTN","RCDPEDA2",34,0)
 ;          ^TMP($J,"TOTALS","FMS","D",-1)  - Total Deposit Amount by FMS Document
"RTN","RCDPEDA2",35,0)
 ;          ^TMP($J,"TOTALS","FMS","D",0)   - Total Amount for Error/Rejected documents
"RTN","RCDPEDA2",36,0)
 ;          ^TMP($J,"TOTALS","FMS","D",1")  - Total Amount for 'A','M',"F' or 'T' docs
"RTN","RCDPEDA2",37,0)
 ;          ^TMP($J,"TOTALS","FMS","D",2")  - Total Amount for queued docs
"RTN","RCDPEDA2",38,0)
 ;          ^TMP($J,"TOTALS","FMSTOT")      - Updated Total Deposit Amount for date range
"RTN","RCDPEDA2",39,0)
 ;          ^TMP($J,"TOTALS","MATCH","D")   - Current Total matched EFTs for date
"RTN","RCDPEDA2",40,0)
 N CRDOC,DETL,DTADD,IEN344,IEN3443,IEN34431,TOTDEP,Q,X,XX,YY
"RTN","RCDPEDA2",41,0)
 S DETL=$P(INPUT,"^",3),DTADD=$P(INPUT,"^",9)
"RTN","RCDPEDA2",42,0)
 ;
"RTN","RCDPEDA2",43,0)
 ; Clear the following daily totals
"RTN","RCDPEDA2",44,0)
 K ^TMP($J,"TOTALS","EFT","D")
"RTN","RCDPEDA2",45,0)
 K ^TMP($J,"TOTALS","FMS","D")
"RTN","RCDPEDA2",46,0)
 K ^TMP($J,"TOTALS","MATCH","D")
"RTN","RCDPEDA2",47,0)
 S IEN3443=""
"RTN","RCDPEDA2",48,0)
 F  D  Q:IEN3443=""  Q:$P(INPUT,"^",5)=1
"RTN","RCDPEDA2",49,0)
 . S IEN3443=$O(^TMP("RCDAILYACT",$J,DTADD,IEN3443))
"RTN","RCDPEDA2",50,0)
 . Q:IEN3443=""
"RTN","RCDPEDA2",51,0)
 . S XX=$$GET1^DIQ(344.3,IEN3443,.03,"I")       ; IEN for 344.1
"RTN","RCDPEDA2",52,0)
 . S IEN344=+$O(^RCY(344,"AD",+XX,0))           ; IEN for 344
"RTN","RCDPEDA2",53,0)
 . S XX=$G(^TMP($J,"TOTALS","DEP",DTADD))
"RTN","RCDPEDA2",54,0)
 . S ^TMP($J,"TOTALS","DEP",DTADD)=XX+1         ; # of deposits for day
"RTN","RCDPEDA2",55,0)
 . S TOTDEP=$$GET1^DIQ(344.3,IEN3443,.08,"I")   ; Total Deposit Amount
"RTN","RCDPEDA2",56,0)
 . S XX=$G(^TMP($J,"TOTALS","DEPA",DTADD))
"RTN","RCDPEDA2",57,0)
 . S ^TMP($J,"TOTALS","DEPA",DTADD)=XX+TOTDEP   ; Total Deposit Amount for day
"RTN","RCDPEDA2",58,0)
 . S CRDOC=$$GET1^DIQ(344,IEN344,200,"I")       ; FMS Document Number
"RTN","RCDPEDA2",59,0)
 . S ^TMP($J,"TOTALS","CRDOC",IEN3443)=CRDOC
"RTN","RCDPEDA2",60,0)
 . I CRDOC="" D                                 ; No FMS Document Number
"RTN","RCDPEDA2",61,0)
 . . S YY=$G(^TMP($J,"TOTALS","FMS","D",-1))
"RTN","RCDPEDA2",62,0)
 . . S ^TMP($J,"TOTALS","FMS","D",-1)=YY+TOTDEP
"RTN","RCDPEDA2",63,0)
 . . S ^TMP($J,"TOTALS","FMS")="NO FMS DOC"
"RTN","RCDPEDA2",64,0)
 . I CRDOC'="" D                                ; FMS Document Number found
"RTN","RCDPEDA2",65,0)
 . . S YY=$$STATUS^GECSSGET(CRDOC)              ; Get the status of the doc
"RTN","RCDPEDA2",66,0)
 . . I YY=-1 D  Q                               ; Document wasn't found
"RTN","RCDPEDA2",67,0)
 . . . S XX=$G(^TMP($J,"TOTALS","FMS","D",-1))
"RTN","RCDPEDA2",68,0)
 . . . S ^TMP($J,"TOTALS","FMS","D",-1)=XX+TOTDEP
"RTN","RCDPEDA2",69,0)
 . . . S ^TMP($J,"TOTALS","FMS")="STATUS MISSING"
"RTN","RCDPEDA2",70,0)
 . . S XX=$E($P(YY," "),1,10)                   ; First Word of the status
"RTN","RCDPEDA2",71,0)
 . . S ^TMP($J,"TOTALS","FMS")=XX               ; First Word of the status
"RTN","RCDPEDA2",72,0)
 . . S Q=$E(YY,1)                               ; First Character of the status
"RTN","RCDPEDA2",73,0)
 . . S Q=$S(Q="E"!(Q="R"):0,Q="Q":2,1:1)        ; Q=0 - Reject or Error, 2 - Queued, 1 - good
"RTN","RCDPEDA2",74,0)
 . . S XX=$G(^TMP($J,"TOTALS","FMS","D",Q))
"RTN","RCDPEDA2",75,0)
 . . S ^TMP($J,"TOTALS","FMS","D",Q)=XX+TOTDEP  ; Rej/Err, Queued OR good Amount for day
"RTN","RCDPEDA2",76,0)
 . ;
"RTN","RCDPEDA2",77,0)
 . I DETL D   Q:$P(INPUT,"^",5)=1               ; Display Detail Line
"RTN","RCDPEDA2",78,0)
 . . D DETLN(.INPUT,IEN3443,TOTDEP)
"RTN","RCDPEDA2",79,0)
 . S ^TMP($J,"TOTALS","FMSTOT")=0               ; Initialize FMS total for range
"RTN","RCDPEDA2",80,0)
 . D ERRMSGS(.INPUT,IEN3443)                    ; Display any error messages
"RTN","RCDPEDA2",81,0)
 . Q:$P(INPUT,"^",5)=1
"RTN","RCDPEDA2",82,0)
 . D PROCEFT(.INPUT,IEN3443)                    ; Process EFT records
"RTN","RCDPEDA2",83,0)
 Q
"RTN","RCDPEDA2",84,0)
 ;
"RTN","RCDPEDA2",85,0)
DETLN(INPUT,IEN3443,TOTDEP) ; Display detail line
"RTN","RCDPEDA2",86,0)
 ; Input:   INPUT                           - A1^A2^A3^...^An Where:
"RTN","RCDPEDA2",87,0)
 ;                                              A1 - 1 if called from Nightly Process
"RTN","RCDPEDA2",88,0)
 ;                                                   0 otherwise
"RTN","RCDPEDA2",89,0)
 ;                                              A2 - 1 if displaying to Listman
"RTN","RCDPEDA2",90,0)
 ;                                                   0 otherwise
"RTN","RCDPEDA2",91,0)
 ;                                              A3 - 1 if Detail report
"RTN","RCDPEDA2",92,0)
 ;                                                   0 if summary report
"RTN","RCDPEDA2",93,0)
 ;                                              A4 - Current Page Number
"RTN","RCDPEDA2",94,0)
 ;                                              A5 - Stop Flag
"RTN","RCDPEDA2",95,0)
 ;                                              A6 - Start of Date Range
"RTN","RCDPEDA2",96,0)
 ;                                              A7 - End of Date Range
"RTN","RCDPEDA2",97,0)
 ;                                              A8 - Current Line Counter
"RTN","RCDPEDA2",98,0)
 ;                                              A9 - Internal Date being processed
"RTN","RCDPEDA2",99,0)
 ;          IEN3443                         - Internal IEN for file 344.3
"RTN","RCDPEDA2",100,0)
 ;          TOTDEP                          - Total Deposit Amount (344.3, .08)
"RTN","RCDPEDA2",101,0)
 ;          ^TMP($J,"TOTALS","FMS")         - FMS Document # or "NO FMS DOC"
"RTN","RCDPEDA2",102,0)
 ; Output:  INPUT                           - A1^A2^A3^...^An - The following pieces
"RTN","RCDPEDA2",103,0)
 ;                                            may be updated
"RTN","RCDPEDA2",104,0)
 ;                                              A5 - Updated Page Number
"RTN","RCDPEDA2",105,0)
 ;                                              A6 - Stop Flag
"RTN","RCDPEDA2",106,0)
 ;                                              A8 - Updated Line Counter
"RTN","RCDPEDA2",107,0)
 ;
"RTN","RCDPEDA2",108,0)
 N DTADD,DETL,LSTMAN,NJ,X,XX,YY
"RTN","RCDPEDA2",109,0)
 S LSTMAN=$P(INPUT,"^",2),NJ=$P(INPUT,"^",1)
"RTN","RCDPEDA2",110,0)
 S DETL=$P(INPUT,"^",3)
"RTN","RCDPEDA2",111,0)
 S XX=$$GET1^DIQ(344.3,IEN3443,.06,"I")         ; Deposit Number
"RTN","RCDPEDA2",112,0)
 ;
"RTN","RCDPEDA2",113,0)
 ; PRCA*4.5*283 - change length of DEP # from 6 to 9 to allow for 9 digit DEP #'s
"RTN","RCDPEDA2",114,0)
 S X=$$SETSTR^VALM1(XX,"",1,9)
"RTN","RCDPEDA2",115,0)
 ;
"RTN","RCDPEDA2",116,0)
 ; Change DEPOSIT DT's starting position from 9 to 12
"RTN","RCDPEDA2",117,0)
 S YY=$$GET1^DIQ(344.3,IEN3443,.07,"I")         ; Deposit Date
"RTN","RCDPEDA2",118,0)
 S X=$$SETSTR^VALM1($$FMTE^XLFDT(YY\1,"2Z"),X,12,10)
"RTN","RCDPEDA2",119,0)
 ;
"RTN","RCDPEDA2",120,0)
 ; Change starting position from 21 to 23 & reduce length of spaces from 10 to 8.
"RTN","RCDPEDA2",121,0)
 S X=$$SETSTR^VALM1("",X,23,8)
"RTN","RCDPEDA2",122,0)
 S X=$$SETSTR^VALM1("",X,32,10)
"RTN","RCDPEDA2",123,0)
 S XX=^TMP($J,"TOTALS","FMS")
"RTN","RCDPEDA2",124,0)
 S X=$$SETSTR^VALM1($E($J(TOTDEP,"",2)_$J("",20),1,20)_XX,X,43,37)
"RTN","RCDPEDA2",125,0)
 D SL^RCDPEDA3(.INPUT,X)
"RTN","RCDPEDA2",126,0)
 Q
"RTN","RCDPEDA2",127,0)
 ;
"RTN","RCDPEDA2",128,0)
PROCEFT(INPUT,IEN3443) ; Entry Point from RCDPEDAR
"RTN","RCDPEDA2",129,0)
 ;                       Process EFT records
"RTN","RCDPEDA2",130,0)
 ; Input:   INPUT                           - A1^A2^A3^...^An Where:
"RTN","RCDPEDA2",131,0)
 ;                                              A1 - 1 if called from Nightly Process
"RTN","RCDPEDA2",132,0)
 ;                                                   0 otherwise
"RTN","RCDPEDA2",133,0)
 ;                                              A2 - 1 if displaying to Listman
"RTN","RCDPEDA2",134,0)
 ;                                                   0 otherwise
"RTN","RCDPEDA2",135,0)
 ;                                              A3 - 1 if Detail report
"RTN","RCDPEDA2",136,0)
 ;                                                   0 if summary report
"RTN","RCDPEDA2",137,0)
 ;                                              A4 - Current Page Number
"RTN","RCDPEDA2",138,0)
 ;                                              A5 - Stop Flag
"RTN","RCDPEDA2",139,0)
 ;                                              A6 - Start of Date Range
"RTN","RCDPEDA2",140,0)
 ;                                              A7 - End of Date Range
"RTN","RCDPEDA2",141,0)
 ;                                              A8 - Current Line Counter
"RTN","RCDPEDA2",142,0)
 ;                                              A9 - Internal Date being processed
"RTN","RCDPEDA2",143,0)
 ;          IEN3443                         - Internal IEN for file 344.3
"RTN","RCDPEDA2",144,0)
 ;          ^TMP($J,"TOTALS","EFT","D")     - Current Total Deposit Amount by EFTs for date
"RTN","RCDPEDA2",145,0)
 ;          ^TMP($J,"TOTALS","MATCH","D")   - Current Total matched EFTs for date
"RTN","RCDPEDA2",146,0)
 ;          ^TMP($J,"TOTALS","FMSTOT")      - Current Total Deposit Amount for date range
"RTN","RCDPEDA2",147,0)
 ; Output:  INPUT                           - A1^A2^A3^...^An - The following pieces
"RTN","RCDPEDA2",148,0)
 ;                                                              may be updated
"RTN","RCDPEDA2",149,0)
 ;                                              A5 - Updated Page Number
"RTN","RCDPEDA2",150,0)
 ;                                              A6 - Stop Flag
"RTN","RCDPEDA2",151,0)
 ;                                              A8 - Updated Line Counter
"RTN","RCDPEDA2",152,0)
 ;          ^TMP($J,"TOTALS","FMSTOT")      - Updated Total Deposit Amount for date range
"RTN","RCDPEDA2",153,0)
 ;          ^TMP($J,"TOTALS","EFT","D")     - Updated Total Deposit Amount by EFTs for date
"RTN","RCDPEDA2",154,0)
 ;          ^TMP($J,"TOTALS","MATCH","D")   - Updated Total matched EFTs for date
"RTN","RCDPEDA2",155,0)
 N DETL,DTADD,IEN34431,RCFMS1,TRDOC,X,XX,YY
"RTN","RCDPEDA2",156,0)
 S ^TMP($J,"TOTALS","FMSTOT")=0
"RTN","RCDPEDA2",157,0)
 S DTADD=$P(INPUT,"^",9)
"RTN","RCDPEDA2",158,0)
 S RCFMS1="NO FMS DOC"
"RTN","RCDPEDA2",159,0)
 S DETL=$P(INPUT,"^",3)
"RTN","RCDPEDA2",160,0)
 S IEN34431=""
"RTN","RCDPEDA2",161,0)
 F  D  Q:IEN34431=""  Q:$P(INPUT,"^",5)=1
"RTN","RCDPEDA2",162,0)
 . S IEN34431=$O(^TMP("RCDAILYACT",$J,DTADD,IEN3443,"EFT",IEN34431))
"RTN","RCDPEDA2",163,0)
 . Q:IEN34431=""
"RTN","RCDPEDA2",164,0)
 . S XX=$G(^TMP($J,"TOTALS","EFT","D"))+1
"RTN","RCDPEDA2",165,0)
 . S ^TMP($J,"TOTALS","EFT","D")=XX                ; Total # EFTs for date
"RTN","RCDPEDA2",166,0)
 . S XX=+$$GET1^DIQ(344.31,IEN34431,.09,"I")       ; Receipt # from 344.31
"RTN","RCDPEDA2",167,0)
 . S TRDOC=$$GET1^DIQ(344,XX,200,"I")              ; FMS Document #
"RTN","RCDPEDA2",168,0)
 . S X=$S(TRDOC'="":$$STATUS^GECSSGET(TRDOC),1:"")
"RTN","RCDPEDA2",169,0)
 . I X'="",X'=-1,$E(X,1)'="R",$E(X,1)'="E" D
"RTN","RCDPEDA2",170,0)
 . . S XX=$G(^TMP($J,"TOTALS","FMSTOT"))
"RTN","RCDPEDA2",171,0)
 . . S YY=$$GET1^DIQ(344.31,IEN34431,.07,"I")      ; Amount of Payment
"RTN","RCDPEDA2",172,0)
 . . S ^TMP($J,"TOTALS","FMSTOT")=XX+YY
"RTN","RCDPEDA2",173,0)
 . . S RCFMS1=$S($E(X,1)="Q":"QUEUED TO POST",1:"POSTED")
"RTN","RCDPEDA2",174,0)
 . S XX=$S(X="":"",X=-1:"NO FMS DOC",1:$E($P(X," ",1),1,10))
"RTN","RCDPEDA2",175,0)
 . S RCFMS1(IEN34431)=XX                           ; FMS Document Status for EFT
"RTN","RCDPEDA2",176,0)
 . S XX=$$GET1^DIQ(344.31,IEN34431,.08,"I")        ; Match Status
"RTN","RCDPEDA2",177,0)
 . I XX D
"RTN","RCDPEDA2",178,0)
 . . S XX=$G(^TMP($J,"TOTALS","MATCH","D"))
"RTN","RCDPEDA2",179,0)
 . . S ^TMP($J,"TOTALS","MATCH","D")=XX+1          ; Total Matched EFTS by date
"RTN","RCDPEDA2",180,0)
 . D:DETL EFTDTL(.INPUT,IEN3443,IEN34431,.RCFMS1)
"RTN","RCDPEDA2",181,0)
 . Q:$P(INPUT,"^",5)=1
"RTN","RCDPEDA2",182,0)
 . D:DETL SL^RCDPEDA3(.INPUT," ")
"RTN","RCDPEDA2",183,0)
 Q
"RTN","RCDPEDA2",184,0)
 ;
"RTN","RCDPEDA2",185,0)
EFTDTL(INPUT,IEN3443,IEN34431,RCFMS1) ; Display EFT Detail
"RTN","RCDPEDA2",186,0)
 ; Input:   INPUT                           - A1^A2^A3^...^An Where:
"RTN","RCDPEDA2",187,0)
 ;                                              A1 - 1 if called from Nightly Process
"RTN","RCDPEDA2",188,0)
 ;                                                   0 otherwise
"RTN","RCDPEDA2",189,0)
 ;                                              A2 - 1 if displaying to Listman
"RTN","RCDPEDA2",190,0)
 ;                                                   0 otherwise
"RTN","RCDPEDA2",191,0)
 ;                                              A3 - 1 if Detail report
"RTN","RCDPEDA2",192,0)
 ;                                                   0 if summary report
"RTN","RCDPEDA2",193,0)
 ;                                              A4 - Current Page Number
"RTN","RCDPEDA2",194,0)
 ;                                              A5 - Stop Flag
"RTN","RCDPEDA2",195,0)
 ;                                              A6 - Start of Date Range
"RTN","RCDPEDA2",196,0)
 ;                                              A7 - End of Date Range
"RTN","RCDPEDA2",197,0)
 ;                                              A8 - Current Line Counter
"RTN","RCDPEDA2",198,0)
 ;                                              A9 - Internal Date being processed
"RTN","RCDPEDA2",199,0)
 ;          IEN3443                         - Internal IEN for file 344.3
"RTN","RCDPEDA2",200,0)
 ;          IEN34431                        - Internal IEN for file 344.31
"RTN","RCDPEDA2",201,0)
 ;          RCFMS1(IEN34431)                - FMS Document Status for EFT IEN
"RTN","RCDPEDA2",202,0)
 ; Output:  INPUT                           - A1^A2^A3^...^An - The following pieces
"RTN","RCDPEDA2",203,0)
 ;                                                              may be updated
"RTN","RCDPEDA2",204,0)
 ;                                              A5 - Updated Page Number
"RTN","RCDPEDA2",205,0)
 ;                                              A6 - Stop Flag
"RTN","RCDPEDA2",206,0)
 ;                                              A8 - Updated Line Counter
"RTN","RCDPEDA2",207,0)
 N PAY,PAYER,PAYID,X,XX,YY,ZZ
"RTN","RCDPEDA2",208,0)
 S XX=$$GET1^DIQ(344.31,IEN34431,.01,"I")       ; EFT Transaction IEN
"RTN","RCDPEDA2",209,0)
 S X=$$SETSTR^VALM1(XX,"",3,6)
"RTN","RCDPEDA2",210,0)
 S XX=$$GET1^DIQ(344.31,IEN34431,.12,"I")       ; Date Claims Paid
"RTN","RCDPEDA2",211,0)
 S X=$$SETSTR^VALM1($$FMTE^XLFDT(XX\1,"2Z"),X,31,8)
"RTN","RCDPEDA2",212,0)
 S XX=$$GET1^DIQ(344.31,IEN34431,.07,"I")       ; Amount of Payment
"RTN","RCDPEDA2",213,0)
 S X=$$SETSTR^VALM1($J(XX,"",2),X,41,18)
"RTN","RCDPEDA2",214,0)
 ;
"RTN","RCDPEDA2",215,0)
 ; PRCA*4.5*284, Move to left 3 space (61 to 58) to allow for 10 digit ERA #'s
"RTN","RCDPEDA2",216,0)
 S XX=$$GET1^DIQ(344.31,IEN34431,.08,"I")       ; Match Status
"RTN","RCDPEDA2",217,0)
 S YY=$$GET1^DIQ(344.31,IEN34431,.1,"I")        ; ERA IEN
"RTN","RCDPEDA2",218,0)
 S X=$$SETSTR^VALM1($$EXTERNAL^DILFD(344.31,.08,"",+XX)_$S(XX=1:"/ERA #"_YY,1:""),X,57,20)
"RTN","RCDPEDA2",219,0)
 Q:$P(INPUT,"^",5)=1
"RTN","RCDPEDA2",220,0)
 D SL^RCDPEDA3(.INPUT,X)
"RTN","RCDPEDA2",221,0)
 S XX=$$GET1^DIQ(344.31,IEN34431,.04,"I")       ; Trace Number
"RTN","RCDPEDA2",222,0)
 S X=$$SETSTR^VALM1(XX,"",5,$L(XX))
"RTN","RCDPEDA2",223,0)
 S XX=$G(^TMP($J,"TOTALS","CRDOC",IEN3443))
"RTN","RCDPEDA2",224,0)
 ; PRCA*4.5*318 add CR # to detail rpt
"RTN","RCDPEDA2",225,0)
 S X=$$SETSTR^VALM1(XX,X,54,$L(XX))             ; CR Document Number
"RTN","RCDPEDA2",226,0)
 D SL^RCDPEDA3(.INPUT,X)
"RTN","RCDPEDA2",227,0)
 S PAYER=$$GET1^DIQ(344.31,IEN34431,.02,"I")    ; Payer Name
"RTN","RCDPEDA2",228,0)
 S:PAYER="" PAYER="NO PAYER NAME RECEIVED"      ; PRCA*4.5*298
"RTN","RCDPEDA2",229,0)
 S PAYID=$$GET1^DIQ(344.31,IEN34431,.03,"I")    ; Payer ID
"RTN","RCDPEDA2",230,0)
 S PAY=PAYER_"/"_PAYID
"RTN","RCDPEDA2",231,0)
 I $L(PAY)>74 D                                 ; PRCA*4.5*318 added if statement
"RTN","RCDPEDA2",232,0)
 . S ZZ=$L(PAY,"/"),XX=$P(PAY,"/",1,ZZ-1),YY=$P(PAY,"/",ZZ)
"RTN","RCDPEDA2",233,0)
 . S XX=$E(XX,1,$L(XX)-($L(PAY)-74)),PAY=XX_"/"_YY
"RTN","RCDPEDA2",234,0)
 S XX=$$SETSTR^VALM1(PAY,"",7,74)
"RTN","RCDPEDA2",235,0)
 D SL^RCDPEDA3(.INPUT,XX)
"RTN","RCDPEDA2",236,0)
 ; PRCA*4.5*318 add TR #s to detail rpt
"RTN","RCDPEDA2",237,0)
 D GETTR(IEN34431,.INPUT)    ; Gather & display all TR Doc #s for EFT detail record           
"RTN","RCDPEDA2",238,0)
 S X=""
"RTN","RCDPEDA2",239,0)
 ;
"RTN","RCDPEDA2",240,0)
 ; PRCA*4.5*304 - lengthen receipt number display to 12
"RTN","RCDPEDA2",241,0)
 S XX=$$GET1^DIQ(344.31,IEN34431,.09,"I")       ; Receipt IEN
"RTN","RCDPEDA2",242,0)
 I XX'="" D
"RTN","RCDPEDA2",243,0)
 . S YY=$$GET1^DIQ(344,XX,.01,"I")              ; Receipt Number
"RTN","RCDPEDA2",244,0)
 . S X=$$SETSTR^VALM1(YY,X,46,12)
"RTN","RCDPEDA2",245,0)
 S X=$$SETSTR^VALM1($G(RCFMS1(IEN34431)),X,61,19)
"RTN","RCDPEDA2",246,0)
 D SL^RCDPEDA3(.INPUT,X)
"RTN","RCDPEDA2",247,0)
 Q:$P(INPUT,"^",5)=1
"RTN","RCDPEDA2",248,0)
 D EFTERRS^RCDPEDA3(.INPUT,IEN34431)            ; Display any EFT Errors
"RTN","RCDPEDA2",249,0)
 D DUP(.INPUT,IEN34431)                         ; Check if this was a duplicate EFT
"RTN","RCDPEDA2",250,0)
 Q
"RTN","RCDPEDA2",251,0)
 ;
"RTN","RCDPEDA2",252,0)
GETTR(IEN34431,INPUT) ;Gathers and Displays all TR Doc #s for a specified EFT
"RTN","RCDPEDA2",253,0)
 ; detail record
"RTN","RCDPEDA2",254,0)
 ; PRCA*4.5*318 add TR #s to detail rpt
"RTN","RCDPEDA2",255,0)
 ; Input: IEN34431 - Internal IEN for file #344.31
"RTN","RCDPEDA2",256,0)
 ;        INPUT                           - A1^A2^A3^...^An Where:
"RTN","RCDPEDA2",257,0)
 ;                                              A1 - 1 if called from Nightly Process
"RTN","RCDPEDA2",258,0)
 ;                                                   0 otherwise
"RTN","RCDPEDA2",259,0)
 ;                                              A2 - 1 if displaying to Listman
"RTN","RCDPEDA2",260,0)
 ;                                                   0 otherwise
"RTN","RCDPEDA2",261,0)
 ;                                              A3 - 1 if Detail report
"RTN","RCDPEDA2",262,0)
 ;                                                   0 if summary report
"RTN","RCDPEDA2",263,0)
 ;                                              A4 - Current Page Number
"RTN","RCDPEDA2",264,0)
 ;                                              A5 - Stop Flag
"RTN","RCDPEDA2",265,0)
 ;                                              A6 - Start of Date Range
"RTN","RCDPEDA2",266,0)
 ;                                              A7 - End of Date Range
"RTN","RCDPEDA2",267,0)
 ;                                              A8 - Current Line Counter
"RTN","RCDPEDA2",268,0)
 ;                                              A9 - Internal Date being processed;
"RTN","RCDPEDA2",269,0)
 ;
"RTN","RCDPEDA2",270,0)
 N CTR,IEN3444,IENS,RECEIPT,TRDOC,TRDOCS,XX
"RTN","RCDPEDA2",271,0)
 ; First gather up all the TR Document numbers into as many lines as needed
"RTN","RCDPEDA2",272,0)
 S CTR=1
"RTN","RCDPEDA2",273,0)
 S IEN3444=$$GET1^DIQ(344.31,IEN34431,.1,"I") ; Internal IEN for for 344.4
"RTN","RCDPEDA2",274,0)
 S RECEIPT=$$GET1^DIQ(344.4,IEN3444,.08,"I")  ; Receipt # from 344.4
"RTN","RCDPEDA2",275,0)
 I RECEIPT'="" D
"RTN","RCDPEDA2",276,0)
 . S TRDOC=$TR($$GET1^DIQ(344,RECEIPT,200,"I")," ")    ; FMS Document #
"RTN","RCDPEDA2",277,0)
 . I TRDOC="" Q
"RTN","RCDPEDA2",278,0)
 . S TRDOCS(CTR)=TRDOC
"RTN","RCDPEDA2",279,0)
 . S XX=""
"RTN","RCDPEDA2",280,0)
 . F  D  Q:XX=""
"RTN","RCDPEDA2",281,0)
 .. S XX=$O(^RCY(344.4,IEN3444,8,XX))
"RTN","RCDPEDA2",282,0)
 .. Q:XX=""
"RTN","RCDPEDA2",283,0)
 .. S IENS=XX_","_IEN3444_","
"RTN","RCDPEDA2",284,0)
 .. S RECEIPT=$$GET1^DIQ(344.48,IENS,.01,"I")  ; Other receipt numbers
"RTN","RCDPEDA2",285,0)
 .. I RECEIPT="" Q
"RTN","RCDPEDA2",286,0)
 .. S TRDOC=$TR($$GET1^DIQ(344,RECEIPT,200,"I")," ")   ; FMS Document #
"RTN","RCDPEDA2",287,0)
 .. Q:TRDOC=""
"RTN","RCDPEDA2",288,0)
 .. I $L(TRDOC)+$L($G(TRDOCS(CTR)))+1>73 D  Q
"RTN","RCDPEDA2",289,0)
 .. . S CTR=CTR+1,TRDOCS(CTR)=TRDOC
"RTN","RCDPEDA2",290,0)
 .. S TRDOCS(CTR)=TRDOCS(CTR)_", "_TRDOC
"RTN","RCDPEDA2",291,0)
 ;
"RTN","RCDPEDA2",292,0)
 ; Now display the TR Document numbers
"RTN","RCDPEDA2",293,0)
 I '$D(TRDOCS) D SL^RCDPEDA3(.INPUT," ") Q    ; blank line for TR#s
"RTN","RCDPEDA2",294,0)
 S XX=""
"RTN","RCDPEDA2",295,0)
 F  D  Q:XX=""
"RTN","RCDPEDA2",296,0)
 . S XX=$O(TRDOCS(XX))
"RTN","RCDPEDA2",297,0)
 . Q:XX=""
"RTN","RCDPEDA2",298,0)
 . D SL^RCDPEDA3(.INPUT,$J("",3)_TRDOCS(XX))
"RTN","RCDPEDA2",299,0)
 Q
"RTN","RCDPEDA2",300,0)
 ;
"RTN","RCDPEDA2",301,0)
DUP(INPUT,IEN34431) ; Check to see if the EFT was a duplicate
"RTN","RCDPEDA2",302,0)
 ; Input:   INPUT       - A1^A2^A3^...^An Where:
"RTN","RCDPEDA2",303,0)
 ;                          A1 - 1 if called from Nightly Process, 0 otherwise
"RTN","RCDPEDA2",304,0)
 ;                          A2 - 1 if displaying to Listman, 0 otherwise
"RTN","RCDPEDA2",305,0)
 ;                          A3 - Current Page Number
"RTN","RCDPEDA2",306,0)
 ;                          A1 - 1 if Detail report, 0 if summary report
"RTN","RCDPEDA2",307,0)
 ;                          A5 - Stop Flag
"RTN","RCDPEDA2",308,0)
 ;                          A6 - Start of Date Range
"RTN","RCDPEDA2",309,0)
 ;                          A7 - End of Date Range
"RTN","RCDPEDA2",310,0)
 ;                          A8 - Current Line Counter
"RTN","RCDPEDA2",311,0)
 ;                          A9 - Internal Date being processed
"RTN","RCDPEDA2",312,0)
 ;          IEN34431    - Internal IEN for file 344.31
"RTN","RCDPEDA2",313,0)
 ; Output:  INPUT       - A1^A2^A3^...^An - The following pieces may be updated
"RTN","RCDPEDA2",314,0)
 ;                          A5 - Updated Page Number
"RTN","RCDPEDA2",315,0)
 ;                          A6 - Stop Flag
"RTN","RCDPEDA2",316,0)
 ;                          A8 - Updated Line Counter
"RTN","RCDPEDA2",317,0)
 N XX,YY
"RTN","RCDPEDA2",318,0)
 Q:'$D(^RCY(344.31,IEN34431,3))                 ; Not a duplicate
"RTN","RCDPEDA2",319,0)
 S XX=$$GET1^DIQ(344.31,IEN34431,.18,"I")       ; Date/Time Removed
"RTN","RCDPEDA2",320,0)
 S YY=$$GET1^DIQ(344.31,IEN34431,.17,"I")       ; User who removed it
"RTN","RCDPEDA2",321,0)
 S X="   MARKED AS DUPLICATE: "_$$FMTE^XLFDT(XX)_" "_$$EXTERNAL^DILFD(344.31,.17,,YY)
"RTN","RCDPEDA2",322,0)
 D SL^RCDPEDA3(.INPUT,X)
"RTN","RCDPEDA2",323,0)
 D SL^RCDPEDA3(.INPUT," ")
"RTN","RCDPEDA2",324,0)
 Q
"RTN","RCDPEDA2",325,0)
 ;
"RTN","RCDPEDA2",326,0)
ERRMSGS(INPUT,IEN3443) ; Display any EFT error messages
"RTN","RCDPEDA2",327,0)
 ; Input:   INPUT       - A1^A2^A3^...^An Where:
"RTN","RCDPEDA2",328,0)
 ;                         A1 - 1 if called from Nightly Process, 0 otherwise
"RTN","RCDPEDA2",329,0)
 ;                         A2 - 1 if displaying to Listman, 0 otherwise
"RTN","RCDPEDA2",330,0)
 ;                         A3 - 1 if Detail report, 0 if summary report
"RTN","RCDPEDA2",331,0)
 ;                         A4 - Current Page Number
"RTN","RCDPEDA2",332,0)
 ;                         A5 - Stop Flag
"RTN","RCDPEDA2",333,0)
 ;                         A6 - Start of Date Range
"RTN","RCDPEDA2",334,0)
 ;                         A7 - End of Date Range
"RTN","RCDPEDA2",335,0)
 ;                         A8 - Current Line Counter
"RTN","RCDPEDA2",336,0)
 ;                         A9 - Internal Date being processed
"RTN","RCDPEDA2",337,0)
 ;          IEN3443     - Internal IEN for file 344.3
"RTN","RCDPEDA2",338,0)
 ; Output:  INPUT       - A1^A2^A3^...^An - The following pieces may be updated
"RTN","RCDPEDA2",339,0)
 ;                         A5 - Updated Page Number
"RTN","RCDPEDA2",340,0)
 ;                         A6 - Stop Flag
"RTN","RCDPEDA2",341,0)
 ;                         A8 - Updated Line Counter
"RTN","RCDPEDA2",342,0)
 ;
"RTN","RCDPEDA2",343,0)
 N DETL,ERRS,XX
"RTN","RCDPEDA2",344,0)
 S DETL=$P(INPUT,"^",3)
"RTN","RCDPEDA2",345,0)
 S XX=$$GET1^DIQ(344.3,IEN3443,2,"I","ERRS")    ; Error Message WP field
"RTN","RCDPEDA2",346,0)
 Q:'$D(ERRS)                                    ; No errors
"RTN","RCDPEDA2",347,0)
 Q:$P(INPUT,"^",5)=1
"RTN","RCDPEDA2",348,0)
 D SL^RCDPEDA3(.INPUT,$J("",10)_"ERROR MESSAGES FOR EFT:")
"RTN","RCDPEDA2",349,0)
 S XX=""
"RTN","RCDPEDA2",350,0)
 F  D  Q:XX=""  Q:$P(INPUT,"^",5)=1
"RTN","RCDPEDA2",351,0)
 . S XX=$O(ERRS(XX))
"RTN","RCDPEDA2",352,0)
 . Q:XX=""
"RTN","RCDPEDA2",353,0)
 . Q:$P(INPUT,"^",5)=1
"RTN","RCDPEDA2",354,0)
 . D SL^RCDPEDA3(.INPUT,$J("",12)_ERRS(XX))
"RTN","RCDPEDA2",355,0)
 Q
"RTN","RCDPEDA2",356,0)
 ; 
"RTN","RCDPEDA3")
0^8^B135656232^n/a
"RTN","RCDPEDA3",1,0)
RCDPEDA3 ;EDE/DW - ACTIVITY REPORT ;Feb 17, 2017@10:37:00
"RTN","RCDPEDA3",2,0)
 ;;4.5;Accounts Receivable;**318**;Mar 20, 1995;Build 37
"RTN","RCDPEDA3",3,0)
 ;Per VA Directive 6402, this routine should not be modified.
"RTN","RCDPEDA3",4,0)
 Q
"RTN","RCDPEDA3",5,0)
 ;
"RTN","RCDPEDA3",6,0)
EFTERRS(INPUT,IEN34431) ; Entry Point from RCDPEDA2
"RTN","RCDPEDA3",7,0)
 ;                        Output any EFT Detail errors
"RTN","RCDPEDA3",8,0)
 ;
"RTN","RCDPEDA3",9,0)
 ; Input:   INPUT       - A1^A2^A3^...^An Where:
"RTN","RCDPEDA3",10,0)
 ;                          A1 - 1 if called from Nightly Process, 0 otherwise
"RTN","RCDPEDA3",11,0)
 ;                          A2 - 1 if displaying to Listman, 0 otherwise
"RTN","RCDPEDA3",12,0)
 ;                          A3 - 1 if Detail report, 0 if summary report
"RTN","RCDPEDA3",13,0)
 ;                          A4 - Current Page Number
"RTN","RCDPEDA3",14,0)
 ;                          A5 - Stop Flag
"RTN","RCDPEDA3",15,0)
 ;                          A6 - Start of Date Range
"RTN","RCDPEDA3",16,0)
 ;                          A7 - End of Date Range
"RTN","RCDPEDA3",17,0)
 ;                          A8 - Current Line Counter
"RTN","RCDPEDA3",18,0)
 ;                          A9 - Internal Date being processed
"RTN","RCDPEDA3",19,0)
 ;          IEN34431    - Internal IEN for file 344.31
"RTN","RCDPEDA3",20,0)
 ; Output:  INPUT       - A1^A2^A3^...^An - The following pieces may be updated
"RTN","RCDPEDA3",21,0)
 ;                          A5 - Updated Page Number
"RTN","RCDPEDA3",22,0)
 ;                          A6 - Stop Flag
"RTN","RCDPEDA3",23,0)
 ;                          A8 - Updated Line Counter
"RTN","RCDPEDA3",24,0)
 Q:'$O(^RCY(344.31,IEN34431,2,0))           ; No error message
"RTN","RCDPEDA3",25,0)
 N ERRS,V,XX,YY
"RTN","RCDPEDA3",26,0)
 Q:$P(INPUT,"^",5)=1
"RTN","RCDPEDA3",27,0)
 D SL(.INPUT,$J("",10)_"ERROR MESSAGES FOR EFT DETAIL:")
"RTN","RCDPEDA3",28,0)
 S XX=$$GET1^DIQ(344.31,IEN34431,2,"I","ERRS")
"RTN","RCDPEDA3",29,0)
 S V=""
"RTN","RCDPEDA3",30,0)
 F  D  Q:V=""  Q:$P(INPUT,"^",5)=1
"RTN","RCDPEDA3",31,0)
 . S V=$O(ERRS(V))
"RTN","RCDPEDA3",32,0)
 . Q:V=""
"RTN","RCDPEDA3",33,0)
 . Q:$P(INPUT,"^",5)=1
"RTN","RCDPEDA3",34,0)
 . D SL(.INPUT,$J("",12)_ERRS(V))
"RTN","RCDPEDA3",35,0)
 Q
"RTN","RCDPEDA3",36,0)
 ;
"RTN","RCDPEDA3",37,0)
LMHDR(RCSTOP,RCDET,RCNJ,RCDT1,RCDT2,RCHDR) ; Entry Point from RCDPEDAR      
"RTN","RCDPEDA3",38,0)
 ;                         ListMan report heading
"RTN","RCDPEDA3",39,0)
 ;
"RTN","RCDPEDA3",40,0)
 ; Input:   RCDET       - 1 to display detail, 0 otherwise
"RTN","RCDPEDA3",41,0)
 ;          RCNJ        - Set 1, indicates report was called from the nightly
"RTN","RCDPEDA3",42,0)
 ;                        process OR displaying to listman.  Used to set lines
"RTN","RCDPEDA3",43,0)
 ;                        into a ^TMP array instead of displaying them.
"RTN","RCDPEDA3",44,0)
 ;          RCDT1       - Internal Start Date of date range
"RTN","RCDPEDA3",45,0)
 ;          RCDT2       - Internal End Date of date range
"RTN","RCDPEDA3",46,0)
 ;          RCNP        - Payer Selection flag A1^A2^A3 Where:
"RTN","RCDPEDA3",47,0)
 ;                         A1 - 1 - Range,2 - All,3 -Specific
"RTN","RCDPEDA3",48,0)
 ;                         A2 - From Payer text (only set if A1=1)
"RTN","RCDPEDA3",49,0)
 ;                         A3 - Through text (only set if A1=1)
"RTN","RCDPEDA3",50,0)
 ;          ^TMP("RCSELPAY",$J,B1) - Selected payers to be displayed
"RTN","RCDPEDA3",51,0)
 ; Output:  RCHDR       - Array of listman header lines
"RTN","RCDPEDA3",52,0)
 ;          RCSTOP      - 1 if user stopped 
"RTN","RCDPEDA3",53,0)
 ;
"RTN","RCDPEDA3",54,0)
 N RCCT,X,XX,Y,Z,Z0,Z1
"RTN","RCDPEDA3",55,0)
 S RCCT=0
"RTN","RCDPEDA3",56,0)
 S XX=$S(RCDET:"DETAIL",1:"SUMMARY")_" REPORT"
"RTN","RCDPEDA3",57,0)
 S RCHDR("TITLE")="EDI LOCKBOX EFT DAILY ACTIVITY "_XX
"RTN","RCDPEDA3",58,0)
 S Z1=""
"RTN","RCDPEDA3",59,0)
 I 'VAUTD S Z0=0 F  S Z0=$O(VAUTD(Z0)) Q:'Z0  S Z1=Z1_VAUTD(Z0)_", "
"RTN","RCDPEDA3",60,0)
 S Z="DIVISIONS: "_$S(VAUTD:"ALL",1:$E(Z1,1,$L(Z1)-2))
"RTN","RCDPEDA3",61,0)
 I 'RCDET D
"RTN","RCDPEDA3",62,0)
 . S RCCT=RCCT+1,RCHDR(RCCT)=""
"RTN","RCDPEDA3",63,0)
 S RCCT=RCCT+1,RCHDR(RCCT)=Z
"RTN","RCDPEDA3",64,0)
 ;
"RTN","RCDPEDA3",65,0)
 I 'RCDET D
"RTN","RCDPEDA3",66,0)
 . S RCCT=RCCT+1,RCHDR(RCCT)=""
"RTN","RCDPEDA3",67,0)
 S Z="DATE RANGE: "_$$FMTE^XLFDT(RCDT1,"2Z")_" - "
"RTN","RCDPEDA3",68,0)
 S Z=Z_$$FMTE^XLFDT(RCDT2,"2Z")_" (Date Deposit Added)"
"RTN","RCDPEDA3",69,0)
 I 'RCDET D
"RTN","RCDPEDA3",70,0)
 . S RCCT=RCCT+1,RCHDR(RCCT)=""
"RTN","RCDPEDA3",71,0)
 S RCCT=RCCT+1,RCHDR(RCCT)=Z
"RTN","RCDPEDA3",72,0)
 I RCDET D
"RTN","RCDPEDA3",73,0)
 . S XX="DEP #      DEPOSIT DT  "_$J("",19)
"RTN","RCDPEDA3",74,0)
 . S XX=XX_"DEP AMOUNT          FMS DEPOSIT STAT"
"RTN","RCDPEDA3",75,0)
 . S Z=$$SETSTR^VALM1(XX,"",1,80)
"RTN","RCDPEDA3",76,0)
 . S RCCT=RCCT+1,RCHDR(RCCT)=Z
"RTN","RCDPEDA3",77,0)
 . ; PRCA*4.5*318, Move entire EFT # row to left 1 space to adjust for other rows needing space
"RTN","RCDPEDA3",78,0)
 . S XX=$J("",2)_"EFT #"_$J("",22)_"DATE PD   PAYMENT AMOUNT  ERA MATCH STATUS"
"RTN","RCDPEDA3",79,0)
 . S Z=$$SETSTR^VALM1(XX,"",1,80)
"RTN","RCDPEDA3",80,0)
 . S RCCT=RCCT+1,RCHDR(RCCT)=Z
"RTN","RCDPEDA3",81,0)
 . ; PRCA*4.5*318, Move entire EFT Payer Trace # row to left 6 spaces to adjust for other rows needing space
"RTN","RCDPEDA3",82,0)
 . S Z=$$SETSTR^VALM1($J("",4)_"EFT PAYER TRACE #","",1,30)
"RTN","RCDPEDA3",83,0)
 . ;PRCA*4.5*318 add CR #
"RTN","RCDPEDA3",84,0)
 . S Z=$$SETSTR^VALM1("CR #",Z,54,80)
"RTN","RCDPEDA3",85,0)
 . S RCCT=RCCT+1,RCHDR(RCCT)=Z
"RTN","RCDPEDA3",86,0)
 . ; PRCA*4.5*318, Move entire Payment From row to left 8 spaces to adjust 
"RTN","RCDPEDA3",87,0)
 . ; a possible 60 character Payer Name and 20 character Payer ID
"RTN","RCDPEDA3",88,0)
 . S Z=$$SETSTR^VALM1($J("",6)_"PAYMENT FROM","",1,30)
"RTN","RCDPEDA3",89,0)
 . S Z=$$SETSTR^VALM1($J("",15)_"DEP RECEIPT #",Z,31,30)
"RTN","RCDPEDA3",90,0)
 . S Z=$$SETSTR^VALM1("DEP RECEIPT STATUS",Z,61,19)
"RTN","RCDPEDA3",91,0)
 . S RCCT=RCCT+1,RCHDR(RCCT)=Z
"RTN","RCDPEDA3",92,0)
 . ;PRCA*4.5*318 add TR #s
"RTN","RCDPEDA3",93,0)
 . S Z=$$SETSTR^VALM1("TR #","",1,30)
"RTN","RCDPEDA3",94,0)
 . S RCCT=RCCT+1,RCHDR(RCCT)=Z
"RTN","RCDPEDA3",95,0)
 Q
"RTN","RCDPEDA3",96,0)
 ;
"RTN","RCDPEDA3",97,0)
HDR(INPUT) ; Displays report header
"RTN","RCDPEDA3",98,0)
 ; Input:   INPUT       - A1^A2^A3^...^An Where:
"RTN","RCDPEDA3",99,0)
 ;                         A1 - 1 if called from Nightly Process, 0 otherwise
"RTN","RCDPEDA3",100,0)
 ;                         A2 - 1 if displaying to Listman, 0 otherwise
"RTN","RCDPEDA3",101,0)
 ;                         A3 - 1 if Detail report, 0 if summary report
"RTN","RCDPEDA3",102,0)
 ;                         A4 - Current Page Number
"RTN","RCDPEDA3",103,0)
 ;                         A5 - Stop Flag
"RTN","RCDPEDA3",104,0)
 ;                         A6 - Start of Date Range
"RTN","RCDPEDA3",105,0)
 ;                         A7 - End of Date Range
"RTN","RCDPEDA3",106,0)
 ;                         A9 - Current line count
"RTN","RCDPEDA3",107,0)
 ; Output:  INPUT       - A1^A2^A3^...^An - The following pieces may be updated
"RTN","RCDPEDA3",108,0)
 ;                         A4 - Current Page Number
"RTN","RCDPEDA3",109,0)
 ;                         A5 - Stop Flag
"RTN","RCDPEDA3",110,0)
 ;                         A8 - Updated line count
"RTN","RCDPEDA3",111,0)
 N CURPG,DETL,DTST,DTEND,NJ,STOP,X,XX,Y,Z,Z0,Z1
"RTN","RCDPEDA3",112,0)
 S DETL=$P(INPUT,"^",3)
"RTN","RCDPEDA3",113,0)
 S STOP=$P(INPUT,"^",5)
"RTN","RCDPEDA3",114,0)
 S DTST=$P(INPUT,"^",6)                     ; Date Range Start
"RTN","RCDPEDA3",115,0)
 S DTEND=$P(INPUT,"^",7)                    ; Date Range EndS STOP=0
"RTN","RCDPEDA3",116,0)
 S NJ=$P(INPUT,"^",1),CURPG=$P(INPUT,"^",4)
"RTN","RCDPEDA3",117,0)
 Q:NJ&(CURPG)
"RTN","RCDPEDA3",118,0)
 I CURPG!($E(IOST,1,2)="C-") D
"RTN","RCDPEDA3",119,0)
 . Q:NJ
"RTN","RCDPEDA3",120,0)
 . I CURPG,($E(IOST,1,2)="C-") D ASK(.STOP) Q:STOP
"RTN","RCDPEDA3",121,0)
 . W @IOF ; Write form feed
"RTN","RCDPEDA3",122,0)
 I STOP S $P(INPUT,"^",5)=1 Q
"RTN","RCDPEDA3",123,0)
 S CURPG=CURPG+1,$P(INPUT,"^",4)=CURPG
"RTN","RCDPEDA3",124,0)
 ;
"RTN","RCDPEDA3",125,0)
 ; PRCA276 if coming from nightly job need to define payer selection variable
"RTN","RCDPEDA3",126,0)
 I NJ N RCNP S RCNP=2
"RTN","RCDPEDA3",127,0)
 ;
"RTN","RCDPEDA3",128,0)
 ; PRCA276 if coming from nightly job need to define division selection variable
"RTN","RCDPEDA3",129,0)
 I NJ N VAUTD S VAUTD=1
"RTN","RCDPEDA3",130,0)
 S Z0="EDI LOCKBOX EFT DAILY ACTIVITY "_$S(DETL:"DETAIL",1:"SUMMARY")_" REPORT"
"RTN","RCDPEDA3",131,0)
 S Z=$$SETSTR^VALM1($J("",80-$L(Z0)\2)_Z0,"",1,79)
"RTN","RCDPEDA3",132,0)
 S Z=$$SETSTR^VALM1("Page: "_CURPG,Z,70,10)
"RTN","RCDPEDA3",133,0)
 D SL(.INPUT,Z)
"RTN","RCDPEDA3",134,0)
 S Z="RUN DATE: "_$$FMTE^XLFDT($$NOW^XLFDT(),"2Z"),Z=$J("",80-$L(Z)\2)_Z
"RTN","RCDPEDA3",135,0)
 D SL(.INPUT,Z)
"RTN","RCDPEDA3",136,0)
 ;
"RTN","RCDPEDA3",137,0)
 ; PRCA276 add divisions to header
"RTN","RCDPEDA3",138,0)
 S Z1="" I 'VAUTD S Z0=0 F  S Z0=$O(VAUTD(Z0)) Q:'Z0  S Z1=Z1_VAUTD(Z0)_", "
"RTN","RCDPEDA3",139,0)
 S Z="DIVISIONS: "_$S(VAUTD:"ALL",1:$E(Z1,1,$L(Z1)-2)),Z=$J("",80-$L(Z)\2)_Z
"RTN","RCDPEDA3",140,0)
 D SL(.INPUT,Z)
"RTN","RCDPEDA3",141,0)
 ;
"RTN","RCDPEDA3",142,0)
 ; PRCA276 add payer selection list to header
"RTN","RCDPEDA3",143,0)
 I RCNP'=2 D
"RTN","RCDPEDA3",144,0)
 . S Z0=0,Z1=""
"RTN","RCDPEDA3",145,0)
 . F  D  Q:'Z0
"RTN","RCDPEDA3",146,0)
 . . S Z0=$O(^TMP("RCSELPAY",$J,Z0))
"RTN","RCDPEDA3",147,0)
 . . Q:'Z0
"RTN","RCDPEDA3",148,0)
 . . S Z1=Z1_^TMP("RCSELPAY",$J,Z0)_", "
"RTN","RCDPEDA3",149,0)
 S Z="PAYERS: "_$S(RCNP=2:"ALL",1:$E(Z1,1,$L(Z1)-2)),Z=$J("",80-$L(Z)\2)_Z
"RTN","RCDPEDA3",150,0)
 D SL(.INPUT,Z)
"RTN","RCDPEDA3",151,0)
 ;
"RTN","RCDPEDA3",152,0)
 ; PRCA276  add date filter to header
"RTN","RCDPEDA3",153,0)
 S Z="DATE RANGE: "_$$FMTE^XLFDT(DTST,"2Z")_" - "_$$FMTE^XLFDT(DTEND,"2Z")
"RTN","RCDPEDA3",154,0)
 S Z=Z_" (Date Deposit Added)",Z=$J("",80-$L(Z)\2)_Z
"RTN","RCDPEDA3",155,0)
 D SL(.INPUT,Z)
"RTN","RCDPEDA3",156,0)
 I DETL D
"RTN","RCDPEDA3",157,0)
 . ;
"RTN","RCDPEDA3",158,0)
 . ; PRCA*4.5*283 - Add 3 more spaces between DEP # and DEPOSIT DT 
"RTN","RCDPEDA3",159,0)
 . ; and remove 3 spaces between DEPOSIT DT and DEP AMOUNT to allow for 9 digit DEP #'s
"RTN","RCDPEDA3",160,0)
 . D SL(.INPUT,"")
"RTN","RCDPEDA3",161,0)
 . S XX="DEP #      DEPOSIT DT  "_$J("",19)_"DEP AMOUNT          FMS DEPOSIT STAT"
"RTN","RCDPEDA3",162,0)
 . S Z=$$SETSTR^VALM1(XX,"",1,$L(XX))
"RTN","RCDPEDA3",163,0)
 . D SL(.INPUT,Z)
"RTN","RCDPEDA3",164,0)
 . ;
"RTN","RCDPEDA3",165,0)
 . ; PRCA*4.5*318, Move entire EFT # row to left 1 space to adjust for other rows needing space
"RTN","RCDPEDA3",166,0)
 . ; PRCA*4.5*284, Move Match Status to left 3 space to allow for 10 digit ERA #'s
"RTN","RCDPEDA3",167,0)
 . S XX=$J("",2)_"EFT #"_$J("",22)_"DATE PD   PAYMENT AMOUNT  ERA MATCH STATUS"
"RTN","RCDPEDA3",168,0)
 . S Z=$$SETSTR^VALM1(XX,"",1,$L(XX))
"RTN","RCDPEDA3",169,0)
 . D SL(.INPUT,Z)
"RTN","RCDPEDA3",170,0)
 . ; PRCA*4.5*318, Move entire EFT Payer Trace # row to left 6 spaces to adjust for other rows needing space
"RTN","RCDPEDA3",171,0)
 . S Z=$$SETSTR^VALM1($J("",4)_"EFT PAYER TRACE #","",1,52)
"RTN","RCDPEDA3",172,0)
 . S Z=$$SETSTR^VALM1("CR #",Z,54,4)     ;PRCA*4.5*318 add CR #
"RTN","RCDPEDA3",173,0)
 . D SL(.INPUT,Z)
"RTN","RCDPEDA3",174,0)
 . ; PRCA*4.5*318, Move entire Payment From row to left 8 spaces to adjust 
"RTN","RCDPEDA3",175,0)
 . ; a possible 60 character Payer Name and 20 character Payer ID
"RTN","RCDPEDA3",176,0)
 . S XX=$J("",6)_"PAYMENT FROM"
"RTN","RCDPEDA3",177,0)
 . S Z=$$SETSTR^VALM1(XX,"",1,$L(XX))
"RTN","RCDPEDA3",178,0)
 . D SL(.INPUT,Z)
"RTN","RCDPEDA3",179,0)
 . S XX=$J("",3)_"TR #"                  ;PRCA*4.5*318 add TR #
"RTN","RCDPEDA3",180,0)
 . S Z=$$SETSTR^VALM1(XX,"",1,$L(XX))
"RTN","RCDPEDA3",181,0)
 . D SL(.INPUT,Z)                        ; TR DOC header
"RTN","RCDPEDA3",182,0)
 . S XX=$J("",45)_"DEP RECEIPT #"
"RTN","RCDPEDA3",183,0)
 . S Z=$$SETSTR^VALM1(XX,"",1,$L(XX))
"RTN","RCDPEDA3",184,0)
 . S Z=$$SETSTR^VALM1("DEP RECEIPT STATUS",Z,61,19)
"RTN","RCDPEDA3",185,0)
 . D SL(.INPUT,Z)
"RTN","RCDPEDA3",186,0)
 D SL(.INPUT,$TR($J("",IOM-1)," ","="))
"RTN","RCDPEDA3",187,0)
 Q
"RTN","RCDPEDA3",188,0)
 ;
"RTN","RCDPEDA3",189,0)
TOTSDAY(INPUT) ; Entry Point from RCDPEDAR
"RTN","RCDPEDA3",190,0)
 ;               Display the totals for the specified date
"RTN","RCDPEDA3",191,0)
 ;
"RTN","RCDPEDA3",192,0)
 ; Input:   INPUT       - A1^A2^A3^...^An Where:
"RTN","RCDPEDA3",193,0)
 ;                         A1 - 1 if called from Nightly Process, 0 otherwise
"RTN","RCDPEDA3",194,0)
 ;                         A2 - 1 if displaying to Listman, 0 otherwise
"RTN","RCDPEDA3",195,0)
 ;                         A3 - 1 if Detail report, 0 if summary report
"RTN","RCDPEDA3",196,0)
 ;                         A4 - Current Page Number
"RTN","RCDPEDA3",197,0)
 ;                         A5 - Stop Flag
"RTN","RCDPEDA3",198,0)
 ;                         A6 - Start of Date Range
"RTN","RCDPEDA3",199,0)
 ;                         A7 - End of Date Range
"RTN","RCDPEDA3",200,0)
 ;                         A8 - Current Line Counter
"RTN","RCDPEDA3",201,0)
 ;                         A9 - Internal Date being processed
"RTN","RCDPEDA3",202,0)
 ;          ^TMP($J,"TOTALS","DEP")         - Current Total # of deposits for date range
"RTN","RCDPEDA3",203,0)
 ;          ^TMP($J,"TOTALS","DEP",C1)      - Total # of deposits for Internal date (C1)
"RTN","RCDPEDA3",204,0)
 ;          ^TMP($J,"TOTALS","DEPA")        - Current Total Deposit Amount for date range
"RTN","RCDPEDA3",205,0)
 ;          ^TMP($J,"TOTALS","DEPA",C1)     - Total Deposit Amount for Internal date (C1)
"RTN","RCDPEDA3",206,0)
 ;          ^TMP($J,"TOTALS","EFT","D")     - Total Deposit Amount by EFTs for date
"RTN","RCDPEDA3",207,0)
 ;          ^TMP($J,"TOTALS","EFT","T")     - Current Total Deposit Amount by EFTs for range
"RTN","RCDPEDA3",208,0)
 ;          ^TMP($J,"TOTALS","FMS")         - FMS Document Status or "NO FMS DOC"
"RTN","RCDPEDA3",209,0)
 ;          ^TMP($J,"TOTALS","FMS","D",-1)  - Total Deposit Amount by FMS Document
"RTN","RCDPEDA3",210,0)
 ;          ^TMP($J,"TOTALS","FMS","D",0)   - Total Amount for Error/Rejected documents
"RTN","RCDPEDA3",211,0)
 ;          ^TMP($J,"TOTALS","FMS","D",1")  - Total Amount for 'A','M',"F' or 'T' docs
"RTN","RCDPEDA3",212,0)
 ;          ^TMP($J,"TOTALS","FMS","D",2")  - Total Amount for queued docs
"RTN","RCDPEDA3",213,0)
 ;          ^TMP($J,"TOTALS","FMS","T",-1)  - Total Deposit Amount by FMS Document for range
"RTN","RCDPEDA3",214,0)
 ;          ^TMP($J,"TOTALS","FMS","T",0)   - Total Amount for Error/Rejected docs for range
"RTN","RCDPEDA3",215,0)
 ;          ^TMP($J,"TOTALS","FMS","T",1")  - Total Amount for 'A','M',"F' or 'T' docs range
"RTN","RCDPEDA3",216,0)
 ;          ^TMP($J,"TOTALS","FMS","T",2")  - Total Amount for queued docs for range
"RTN","RCDPEDA3",217,0)
 ;          ^TMP($J,"TOTALS","FMSTOT")      - Updated Total Deposit Amount for date range
"RTN","RCDPEDA3",218,0)
 ;          ^TMP($J,"TOTALS","MATCH","D")   - Current Total matched EFTs for date
"RTN","RCDPEDA3",219,0)
 ;          ^TMP($J,"TOTALS","MATCH","T")   - Current Total matched EFTs for date range
"RTN","RCDPEDA3",220,0)
 ; Output:  INPUT       - A1^A2^A3^...^An - The following pieces may be updated
"RTN","RCDPEDA3",221,0)
 ;                         A4 - Updated Page Number
"RTN","RCDPEDA3",222,0)
 ;                         A5 - Stop Flag
"RTN","RCDPEDA3",223,0)
 ;                         A8 - Updated Line Counter
"RTN","RCDPEDA3",224,0)
 ;          ^TMP($J,"TOTALS","DEP")         - Updated Total # of deposits for date range
"RTN","RCDPEDA3",225,0)
 ;          ^TMP($J,"TOTALS","DEPA")        - Updated Total Deposit Amount for date range
"RTN","RCDPEDA3",226,0)
 ;          ^TMP($J,"TOTALS","EFT","T")     - Updated Total Deposit Amount by EFTs for range
"RTN","RCDPEDA3",227,0)
 ;          ^TMP($J,"TOTALS","FMS","T",-1)  - Updated Deposit Amount by FMS Document for range
"RTN","RCDPEDA3",228,0)
 ;          ^TMP($J,"TOTALS","FMS","T",0)   - Updated Amount for Error/Rejected docs for range
"RTN","RCDPEDA3",229,0)
 ;          ^TMP($J,"TOTALS","FMS","T",1")  - Updated Amount for 'A','M',"F' or 'T' docs range
"RTN","RCDPEDA3",230,0)
 ;          ^TMP($J,"TOTALS","FMS","T",2")  - Updated Amount for queued docs for range
"RTN","RCDPEDA3",231,0)
 ;          ^TMP($J,"TOTALS","MATCH","T")   - Updated Total Matched EFTs for date range
"RTN","RCDPEDA3",232,0)
 N CURPG,DTADD,LSTMAN,NL,Q,XX,YY
"RTN","RCDPEDA3",233,0)
 S LSTMAN=$P(INPUT,"^",2)                   ; Display to Listman flag
"RTN","RCDPEDA3",234,0)
 S NJ=$P(INPUT,"^",1)                       ; Called from Nightly Process flag
"RTN","RCDPEDA3",235,0)
 S CURPG=$P(INPUT,"^",4)                    ; Current Page Counter
"RTN","RCDPEDA3",236,0)
 S DTADD=$P(INPUT,"^",9)                    ; Date to display totals for
"RTN","RCDPEDA3",237,0)
 S XX=$G(^TMP($J,"TOTALS","DEPA"))          ; Current Total Deposit Amount for date range
"RTN","RCDPEDA3",238,0)
 S YY=$G(^TMP($J,"TOTALS","DEPA",DTADD))    ; Total Deposit Amount for date
"RTN","RCDPEDA3",239,0)
 S ^TMP($J,"TOTALS","DEPA")=XX+YY           ; Updated Total for range
"RTN","RCDPEDA3",240,0)
 S XX=$G(^TMP($J,"TOTALS","DEP"))           ; Current Total # of Deposits for date range
"RTN","RCDPEDA3",241,0)
 S YY=$G(^TMP($J,"TOTALS","DEP",DTADD))     ; Total # of Deposits for date
"RTN","RCDPEDA3",242,0)
 S ^TMP($J,"TOTALS","DEP")=XX+YY            ; Updated Total # for range
"RTN","RCDPEDA3",243,0)
 ;
"RTN","RCDPEDA3",244,0)
 S XX=$G(^TMP($J,"TOTALS","EFT","T"))       ; Current Total Amount by EFTs for date range
"RTN","RCDPEDA3",245,0)
 S YY=$G(^TMP($J,"TOTALS","EFT","D"))       ; Total Amount by EFTs for date
"RTN","RCDPEDA3",246,0)
 S ^TMP($J,"TOTALS","EFT","T")=XX+YY        ; Updated Total Amount for range
"RTN","RCDPEDA3",247,0)
 ;
"RTN","RCDPEDA3",248,0)
 S XX=$G(^TMP($J,"TOTALS","MATCH","T"))     ; Current Total # Matched EFTs for date range
"RTN","RCDPEDA3",249,0)
 S YY=$G(^TMP($J,"TOTALS","MATCH","D"))     ; # Matched EFTs for date
"RTN","RCDPEDA3",250,0)
 S ^TMP($J,"TOTALS","MATCH","T")=XX+YY      ; Updated Total # Matched EFTs for date range
"RTN","RCDPEDA3",251,0)
 ;
"RTN","RCDPEDA3",252,0)
 ; Update document status totals for range
"RTN","RCDPEDA3",253,0)
 F Q=-1,0,1,2 D
"RTN","RCDPEDA3",254,0)
 . S XX=$G(^TMP($J,"TOTALS","FMS","T",Q))   ; Current Total # of Q status for date range
"RTN","RCDPEDA3",255,0)
 . S YY=$G(^TMP($J,"TOTALS","FMS","D",Q))   ; # of Q status for date
"RTN","RCDPEDA3",256,0)
 . S ^TMP($J,"TOTALS","FMS","T",Q)=XX+YY    ; Updated Total # of Q status for date range
"RTN","RCDPEDA3",257,0)
 ;
"RTN","RCDPEDA3",258,0)
 ; Display the daily totals
"RTN","RCDPEDA3",259,0)
 D SL(.INPUT," ")
"RTN","RCDPEDA3",260,0)
 I $S('NJ:($Y+5)>IOSL,1:0)!'CURPG D  Q:$P(INPUT,"^",5)=1
"RTN","RCDPEDA3",261,0)
 . D:'LSTMAN HDR(.INPUT)
"RTN","RCDPEDA3",262,0)
 S XX=$E("**TOTALS FOR DATE: "_$$FMTE^XLFDT(DTADD\1,"2Z")_$J("",30),1,30)
"RTN","RCDPEDA3",263,0)
 S YY=$G(^TMP($J,"TOTALS","DEP",DTADD))
"RTN","RCDPEDA3",264,0)
 S XX=XX_"   # OF DEPOSIT TICKETS RECEIVED: "_+YY_$J("",5)
"RTN","RCDPEDA3",265,0)
 D SL(.INPUT,XX)
"RTN","RCDPEDA3",266,0)
 S YY=$G(^TMP($J,"TOTALS","DEPA",DTADD))
"RTN","RCDPEDA3",267,0)
 S XX=$J("",29)_"TOTAL AMOUNT OF DEPOSITS RECEIVED: $"_$J(YY,"",2)
"RTN","RCDPEDA3",268,0)
 D SL(.INPUT,XX)
"RTN","RCDPEDA3",269,0)
 Q:$P(INPUT,"^",5)=1
"RTN","RCDPEDA3",270,0)
 D SL(.INPUT," ")
"RTN","RCDPEDA3",271,0)
 D SL(.INPUT,$J("",20)_"DEPOSIT AMOUNTS SENT TO FMS:")
"RTN","RCDPEDA3",272,0)
 Q:$P(INPUT,"^",5)=1
"RTN","RCDPEDA3",273,0)
 S YY=+$G(^TMP($J,"TOTALS","FMS","D",1))
"RTN","RCDPEDA3",274,0)
 S XX=$J("",39)_"ACCEPTED: $"_$J(YY,"",2)
"RTN","RCDPEDA3",275,0)
 D SL(.INPUT,XX)
"RTN","RCDPEDA3",276,0)
 Q:$P(INPUT,"^",5)=1
"RTN","RCDPEDA3",277,0)
 S YY=+$G(^TMP($J,"TOTALS","FMS","D",2))
"RTN","RCDPEDA3",278,0)
 S XX=$J("",41)_"QUEUED: $"_$J(YY,"",2)
"RTN","RCDPEDA3",279,0)
 D SL(.INPUT,XX)
"RTN","RCDPEDA3",280,0)
 Q:$P(INPUT,"^",5)=1
"RTN","RCDPEDA3",281,0)
 S YY=+$G(^TMP($J,"TOTALS","FMS","D",0))
"RTN","RCDPEDA3",282,0)
 S XX=$J("",35)_"ERROR/REJECT: $"_$J(YY,"",2)
"RTN","RCDPEDA3",283,0)
 D SL(.INPUT,XX)
"RTN","RCDPEDA3",284,0)
 Q:$P(INPUT,"^",5)=1
"RTN","RCDPEDA3",285,0)
 S YY=+$G(^TMP($J,"TOTALS","FMS","D",-1))
"RTN","RCDPEDA3",286,0)
 S XX=$J("",37)_"NOT IN FMS: $"_$J(YY,"",2)
"RTN","RCDPEDA3",287,0)
 D SL(.INPUT,XX)
"RTN","RCDPEDA3",288,0)
 D SL(.INPUT," ")
"RTN","RCDPEDA3",289,0)
 Q:$P(INPUT,"^",5)=1
"RTN","RCDPEDA3",290,0)
 S YY=+$G(^TMP($J,"TOTALS","EFT","D"))
"RTN","RCDPEDA3",291,0)
 S XX=$J("",26)_"# EFT PAYMENT RECORDS: "_YY
"RTN","RCDPEDA3",292,0)
 D SL(.INPUT,XX)
"RTN","RCDPEDA3",293,0)
 Q:$P(INPUT,"^",5)=1
"RTN","RCDPEDA3",294,0)
 S YY=+$G(^TMP($J,"TOTALS","MATCH","D"))
"RTN","RCDPEDA3",295,0)
 S XX=$J("",25)_"# EFT PAYMENTS MATCHED: "_YY
"RTN","RCDPEDA3",296,0)
 D SL(.INPUT,XX)
"RTN","RCDPEDA3",297,0)
 Q:$P(INPUT,"^",5)=1
"RTN","RCDPEDA3",298,0)
 S YY=+$G(^TMP($J,"TOTALS","DEPAP",DTADD))
"RTN","RCDPEDA3",299,0)
 S XX=$J("",18)_"MATCHED PAYMENT AMOUNT POSTED: $"_$J(YY,"",2)
"RTN","RCDPEDA3",300,0)
 D SL(.INPUT,XX)
"RTN","RCDPEDA3",301,0)
 D SL(.INPUT," ")
"RTN","RCDPEDA3",302,0)
 Q
"RTN","RCDPEDA3",303,0)
 ;
"RTN","RCDPEDA3",304,0)
TOTSF(INPUT) ; Entry Point from RCDPEDAR
"RTN","RCDPEDA3",305,0)
 ;             Display Final Totals
"RTN","RCDPEDA3",306,0)
 ;
"RTN","RCDPEDA3",307,0)
 ; Input:   INPUT       - A1^A2^A3^...^An Where:
"RTN","RCDPEDA3",308,0)
 ;                         A1 - 1 if called from Nightly Process, 0 otherwise
"RTN","RCDPEDA3",309,0)
 ;                         A2 - 1 if displaying to Listman, 0 otherwise
"RTN","RCDPEDA3",310,0)
 ;                         A3 - 1 if Detail report, 0 if summary report
"RTN","RCDPEDA3",311,0)
 ;                         A4 - Current Page Number
"RTN","RCDPEDA3",312,0)
 ;                         A5 - Stop Flag
"RTN","RCDPEDA3",313,0)
 ;                         A6 - Start of Date Range
"RTN","RCDPEDA3",314,0)
 ;                         A7 - End of Date Range
"RTN","RCDPEDA3",315,0)
 ;                         A8 - Current Line Counter
"RTN","RCDPEDA3",316,0)
 ;                         A9 - Internal Date being processed
"RTN","RCDPEDA3",317,0)
 ;          ^TMP($J,"TOTALS","DEP")         - Total # of deposits for date range
"RTN","RCDPEDA3",318,0)
 ;          ^TMP($J,"TOTALS","DEPA")        - Total Deposit Amount for date range
"RTN","RCDPEDA3",319,0)
 ;          ^TMP($J,"TOTALS","EFT","T")     - Total Deposit Amount by EFTs for range
"RTN","RCDPEDA3",320,0)
 ;          ^TMP($J,"TOTALS","FMS","T",-1)  - Total Deposit Amount by FMS Document for range
"RTN","RCDPEDA3",321,0)
 ;          ^TMP($J,"TOTALS","FMS","T",0)   - Total Amount for Error/Rejected docs for range
"RTN","RCDPEDA3",322,0)
 ;          ^TMP($J,"TOTALS","FMS","T",1")  - Total Amount for 'A','M',"F' or 'T' docs range
"RTN","RCDPEDA3",323,0)
 ;          ^TMP($J,"TOTALS","FMS","T",2")  - Total Amount for queued docs for range
"RTN","RCDPEDA3",324,0)
 ;          ^TMP($J,"TOTALS","MATCH","T")   - Total Matched EFTs for date range
"RTN","RCDPEDA3",325,0)
 ; Output:  INPUT       - A1^A2^A3^...^An - The following pieces may be updated
"RTN","RCDPEDA3",326,0)
 ;                         A5 - Updated Page Number
"RTN","RCDPEDA3",327,0)
 ;                         A6 - Stop Flag
"RTN","RCDPEDA3",328,0)
 ;                         A8 - Updated Line Counter
"RTN","RCDPEDA3",329,0)
 N LSTMAN,NJ,XX,YY
"RTN","RCDPEDA3",330,0)
 S LSTMAN=$P(INPUT,"^",2),NJ=$P(INPUT,"^",1)
"RTN","RCDPEDA3",331,0)
 ;
"RTN","RCDPEDA3",332,0)
 ; Display header if no output was displayed and not being displayed in listman
"RTN","RCDPEDA3",333,0)
 I '$O(^TMP("RCDAILYACT",$J,0)),'LSTMAN D HDR(.INPUT)
"RTN","RCDPEDA3",334,0)
 ;
"RTN","RCDPEDA3",335,0)
 ; If user quit or (Nightly process flag AND not display to listman) - end here
"RTN","RCDPEDA3",336,0)
 I $P(INPUT,"^",5)=1!(NJ&'LSTMAN) Q
"RTN","RCDPEDA3",337,0)
 D SL(.INPUT," ")
"RTN","RCDPEDA3",338,0)
 S XX=$E("**** TOTALS FOR DATE RANGE:"_$J("",30),1,30)
"RTN","RCDPEDA3",339,0)
 S YY=+$G(^TMP($J,"TOTALS","DEP"))
"RTN","RCDPEDA3",340,0)
 S XX=XX_"   # OF DEPOSIT TICKETS RECEIVED: "_YY_$J("",5)
"RTN","RCDPEDA3",341,0)
 D SL(.INPUT,XX)
"RTN","RCDPEDA3",342,0)
 S YY=+$G(^TMP($J,"TOTALS","DEPA"))
"RTN","RCDPEDA3",343,0)
 S XX=$J("",29)_"TOTAL AMOUNT OF DEPOSITS RECEIVED: $"_$J(YY,"",2)
"RTN","RCDPEDA3",344,0)
 D SL(.INPUT,XX)
"RTN","RCDPEDA3",345,0)
 D SL(.INPUT," ")
"RTN","RCDPEDA3",346,0)
 D SL(.INPUT,$J("",20)_"DEPOSIT AMOUNTS SENT TO FMS:")
"RTN","RCDPEDA3",347,0)
 S YY=+$G(^TMP($J,"TOTALS","FMS","T",1))
"RTN","RCDPEDA3",348,0)
 S XX=$J("",39)_"ACCEPTED: $"_$J(YY,"",2)
"RTN","RCDPEDA3",349,0)
 D SL(.INPUT,XX)
"RTN","RCDPEDA3",350,0)
 S YY=+$G(^TMP($J,"TOTALS","FMS","T",2))
"RTN","RCDPEDA3",351,0)
 S XX=$J("",41)_"QUEUED: $"_$J(YY,"",2)
"RTN","RCDPEDA3",352,0)
 D SL(.INPUT,XX)
"RTN","RCDPEDA3",353,0)
 S YY=+$G(^TMP($J,"TOTALS","FMS","T",0))
"RTN","RCDPEDA3",354,0)
 S XX=$J("",35)_"ERROR/REJECT: $"_$J(YY,"",2)
"RTN","RCDPEDA3",355,0)
 D SL(.INPUT,XX)
"RTN","RCDPEDA3",356,0)
 S YY=+$G(^TMP($J,"TOTALS","FMS","T",-1))
"RTN","RCDPEDA3",357,0)
 S XX=$J("",37)_"NOT IN FMS: $"_$J(YY,"",2)
"RTN","RCDPEDA3",358,0)
 D SL(.INPUT,XX)
"RTN","RCDPEDA3",359,0)
 D SL(.INPUT," ")
"RTN","RCDPEDA3",360,0)
 ;
"RTN","RCDPEDA3",361,0)
 S YY=+$G(^TMP($J,"TOTALS","EFT","T"))
"RTN","RCDPEDA3",362,0)
 S XX=$J("",26)_"# EFT PAYMENT RECORDS: "_YY
"RTN","RCDPEDA3",363,0)
 D SL(.INPUT,XX)
"RTN","RCDPEDA3",364,0)
 S YY=+$G(^TMP($J,"TOTALS","MATCH","T"))
"RTN","RCDPEDA3",365,0)
 S XX=$J("",25)_"# EFT PAYMENTS MATCHED: "_YY
"RTN","RCDPEDA3",366,0)
 D SL(.INPUT,XX)
"RTN","RCDPEDA3",367,0)
 S YY=+$G(^TMP($J,"TOTALS","DEPAP"))
"RTN","RCDPEDA3",368,0)
 S XX=$J("",18)_"MATCHED PAYMENT AMOUNT POSTED: $"_$J(YY,"",2)
"RTN","RCDPEDA3",369,0)
 D SL(.INPUT,XX)
"RTN","RCDPEDA3",370,0)
 D SL(.INPUT," ")
"RTN","RCDPEDA3",371,0)
 D SL(.INPUT," ")
"RTN","RCDPEDA3",372,0)
 Q
"RTN","RCDPEDA3",373,0)
 ;
"RTN","RCDPEDA3",374,0)
ASK(RCSTOP) ; Ask to continue
"RTN","RCDPEDA3",375,0)
 ; If passed by reference ,RCSTOP is returned as 1 if print is aborted
"RTN","RCDPEDA3",376,0)
 I $E(IOST,1,2)'["C-" Q
"RTN","RCDPEDA3",377,0)
 N DIR,DIROUT,DIRUT,DTOUT,DUOUT
"RTN","RCDPEDA3",378,0)
 S DIR(0)="E" W ! D ^DIR
"RTN","RCDPEDA3",379,0)
 I ($D(DIRUT))!($D(DUOUT)) S RCSTOP=1 Q
"RTN","RCDPEDA3",380,0)
 Q
"RTN","RCDPEDA3",381,0)
 ;
"RTN","RCDPEDA3",382,0)
SL(INPUT,Z) ; Entry Point from RCDPEDAR & RCDEPA2
"RTN","RCDPEDA3",383,0)
 ;            Writes or stores line
"RTN","RCDPEDA3",384,0)
 ;
"RTN","RCDPEDA3",385,0)
 ; Input:   INPUT                   - A1^A2^A3^...^An Where:
"RTN","RCDPEDA3",386,0)
 ;                                      A1 - 1 if called from Nightly Process, 0 otherwise
"RTN","RCDPEDA3",387,0)
 ;                                      A2 - 1 if displaying to Listman, 0 otherwise
"RTN","RCDPEDA3",388,0)
 ;                                      A3 - 1 if Detail report, 0 if summary report
"RTN","RCDPEDA3",389,0)
 ;                                      A4 - Current Page Number
"RTN","RCDPEDA3",390,0)
 ;                                      A5 - Stop Flag
"RTN","RCDPEDA3",391,0)
 ;                                      A6 - Start of Date Range
"RTN","RCDPEDA3",392,0)
 ;                                      A7 - End of Date Range
"RTN","RCDPEDA3",393,0)
 ;                                      A8 - Current Line Number
"RTN","RCDPEDA3",394,0)
 ;          Z                       - Data line to write or store
"RTN","RCDPEDA3",395,0)
 ;          RCCT                    - Current line counter
"RTN","RCDPEDA3",396,0)
 ;          RCNJ                    - 1 to set array, 0 to write line
"RTN","RCDPEDA3",397,0)
 ;          ^TMP($J,"RCDPE_DAR")    - Current array of stored lines (if RCNJ=1)
"RTN","RCDPEDA3",398,0)
 ; Output:  INPUT                   - A1^A2^A3^...^An - The following pieces may be updated
"RTN","RCDPEDA3",399,0)
 ;                                      A11 - Updated Line Number
"RTN","RCDPEDA3",400,0)
 ; Output:  
"RTN","RCDPEDA3",401,0)
 ;          ^TMP($J,"RCDPE_DAR")    - Updated array of stored lines (if RCNJ=1)
"RTN","RCDPEDA3",402,0)
 N XX
"RTN","RCDPEDA3",403,0)
 S XX=$P(INPUT,"^",8)+1
"RTN","RCDPEDA3",404,0)
 S $P(INPUT,"^",8)=XX
"RTN","RCDPEDA3",405,0)
 ;
"RTN","RCDPEDA3",406,0)
 ; Called from nightly process
"RTN","RCDPEDA3",407,0)
 I $P(INPUT,"^",1) S ^TMP($J,"RCDPE_DAR",XX)=Z Q
"RTN","RCDPEDA3",408,0)
 W !,Z
"RTN","RCDPEDA3",409,0)
 Q
"RTN","RCDPEDAR")
0^6^B72692368^B196427903
"RTN","RCDPEDAR",1,0)
RCDPEDAR ;ALB/TMK - ACTIVITY REPORT ;Jun 06, 2014@19:11:19
"RTN","RCDPEDAR",2,0)
 ;;4.5;Accounts Receivable;**173,276,284,283,298,304,318**;Mar 20, 1995;Build 37
"RTN","RCDPEDAR",3,0)
 ;Per VA Directive 6402, this routine should not be modified.
"RTN","RCDPEDAR",4,0)
 Q
"RTN","RCDPEDAR",5,0)
 ;
"RTN","RCDPEDAR",6,0)
RPT ; Daily Activity Rpt On Demand
"RTN","RCDPEDAR",7,0)
 N POP,RCDET,RCDIV,RCDT1,RCDT2,RCHDR,RCINC,RCLSTMGR,RCNP,RCNJ
"RTN","RCDPEDAR",8,0)
 N RCPYRSEL,RCRANGE,RCSTOP,RCTMPND,VAUTD,X,XX,Y,%ZIS
"RTN","RCDPEDAR",9,0)
 S RCNJ=0                                   ; Not the nightly job, user interactions
"RTN","RCDPEDAR",10,0)
 D DIVISION^VAUTOMA                         ; IA 664 Select Division/Station - sets VAUTD
"RTN","RCDPEDAR",11,0)
 I 'VAUTD,($D(VAUTD)'=11) Q
"RTN","RCDPEDAR",12,0)
 S RCDET=$$RTYPE()                          ; Select Report Type (Summary/Detail)
"RTN","RCDPEDAR",13,0)
 Q:RCDET=-1
"RTN","RCDPEDAR",14,0)
 S XX=$$DTRANGE(.RCDT1,.RCDT2)              ; Select Date Range to be used
"RTN","RCDPEDAR",15,0)
 Q:'XX
"RTN","RCDPEDAR",16,0)
 ;
"RTN","RCDPEDAR",17,0)
 ; Get insurance company to be used as filter
"RTN","RCDPEDAR",18,0)
 ; PRCA*4.5*284 - RCNP is Type of Response (1=Range,2=All,3=Specific) ^ From Range^ Thru Range
"RTN","RCDPEDAR",19,0)
 S RCNP=$$GETPAY^RCDPEM9(344.31)
"RTN","RCDPEDAR",20,0)
 Q:+RCNP=-1                                 ; No Insurance Company selected
"RTN","RCDPEDAR",21,0)
 S RCLSTMGR=$$ASKLM^RCDPEARL                ; Ask to Display in Listman Template
"RTN","RCDPEDAR",22,0)
 Q:RCLSTMGR<0                               ; '^' or timeout
"RTN","RCDPEDAR",23,0)
 ;
"RTN","RCDPEDAR",24,0)
 I RCLSTMGR=1 D  Q                          ; ListMan Template format, put in array
"RTN","RCDPEDAR",25,0)
 . S RCTMPND="RCDPE_DAR"
"RTN","RCDPEDAR",26,0)
 . K ^TMP($J,RCTMPND)
"RTN","RCDPEDAR",27,0)
 . D EN(RCDET,RCDT1,RCDT2,RCLSTMGR)
"RTN","RCDPEDAR",28,0)
 . D LMHDR^RCDPEDA3(.RCSTOP,RCDET,1,RCDT1,RCDT2,.RCHDR)
"RTN","RCDPEDAR",29,0)
 . D LMRPT^RCDPEARL(.RCHDR,$NA(^TMP($J,RCTMPND))) ; Generate ListMan display
"RTN","RCDPEDAR",30,0)
 . K ^TMP($J,RCTMPND)
"RTN","RCDPEDAR",31,0)
 ;
"RTN","RCDPEDAR",32,0)
 ; Ask device
"RTN","RCDPEDAR",33,0)
 S %ZIS="QM"
"RTN","RCDPEDAR",34,0)
 D ^%ZIS
"RTN","RCDPEDAR",35,0)
 Q:POP
"RTN","RCDPEDAR",36,0)
 ;
"RTN","RCDPEDAR",37,0)
 I $D(IO("Q")) D  Q                         ; Queued Report
"RTN","RCDPEDAR",38,0)
 . N ZTDESC,ZTRTN,ZTSAVE,ZTSK
"RTN","RCDPEDAR",39,0)
 . S ZTRTN="EN^RCDPEDAR("_RCDET_","_RCDT1_","_RCDT2_")"
"RTN","RCDPEDAR",40,0)
 . S ZTDESC="AR - EDI LOCKBOX EFT DAILY ACTIVITY REPORT"
"RTN","RCDPEDAR",41,0)
 . S ZTSAVE("RC*")="",ZTSAVE("VAUTD")=""
"RTN","RCDPEDAR",42,0)
 . ;
"RTN","RCDPEDAR",43,0)
 . ; PRCA*4.5*284 - Because TMP global may be on another server, save off specific payers in local
"RTN","RCDPEDAR",44,0)
 . M RCPYRSEL=^TMP("RCSELPAY",$J)
"RTN","RCDPEDAR",45,0)
 . D ^%ZTLOAD
"RTN","RCDPEDAR",46,0)
 . W !!,$S($D(ZTSK):"Task number "_ZTSK_" was queued.",1:"Unable to queue this task.")
"RTN","RCDPEDAR",47,0)
 . K ZTSK,IO("Q")
"RTN","RCDPEDAR",48,0)
 . D HOME^%ZIS
"RTN","RCDPEDAR",49,0)
 ;
"RTN","RCDPEDAR",50,0)
 U IO
"RTN","RCDPEDAR",51,0)
 D EN(RCDET,RCDT1,RCDT2,RCLSTMGR)
"RTN","RCDPEDAR",52,0)
 Q
"RTN","RCDPEDAR",53,0)
 ;
"RTN","RCDPEDAR",54,0)
RTYPE() ; Allows the user to select the report type (Summary/Detail)
"RTN","RCDPEDAR",55,0)
 ; Input:   None
"RTN","RCDPEDAR",56,0)
 ; Returns: 0       - Summary Display
"RTN","RCDPEDAR",57,0)
 ;          1       - Detail Display
"RTN","RCDPEDAR",58,0)
 ;         -1       - User up-arrowed or timed out
"RTN","RCDPEDAR",59,0)
 N DIR,DTOUT,DUOUT
"RTN","RCDPEDAR",60,0)
 S DIR("A")="(S)UMMARY OR (D)ETAIL?: "
"RTN","RCDPEDAR",61,0)
 S DIR(0)="SA^S:SUMMARY TOTALS ONLY;D:DETAIL AND TOTALS"
"RTN","RCDPEDAR",62,0)
 S DIR("B")="D"
"RTN","RCDPEDAR",63,0)
 D ^DIR
"RTN","RCDPEDAR",64,0)
 I $D(DTOUT)!$D(DUOUT)!(Y="") Q -1
"RTN","RCDPEDAR",65,0)
 Q Y="D"
"RTN","RCDPEDAR",66,0)
 ;
"RTN","RCDPEDAR",67,0)
DTRANGE(STDATE,ENDDATE) ; Allows the user to select the date range to by used
"RTN","RCDPEDAR",68,0)
 ; Input:   None
"RTN","RCDPEDAR",69,0)
 ; Output:  STDATE  = Internal Fileman Date to start at
"RTN","RCDPEDAR",70,0)
 ;          ENDDATE - Internal Fileman Date to end at
"RTN","RCDPEDAR",71,0)
 ; Returns: 0 - User up-arrowed or timed out, 1 otherwise
"RTN","RCDPEDAR",72,0)
 N DIR,DTOUT,DUOUT
"RTN","RCDPEDAR",73,0)
 S DIR("?")="Enter the earliest date of receipt of deposit to include on the report."
"RTN","RCDPEDAR",74,0)
 S DIR(0)="DAO^:"_DT_":APE"
"RTN","RCDPEDAR",75,0)
 S DIR("A")="START DATE: "
"RTN","RCDPEDAR",76,0)
 D ^DIR
"RTN","RCDPEDAR",77,0)
 Q:$D(DTOUT)!$D(DUOUT)!(Y="") 0
"RTN","RCDPEDAR",78,0)
 S STDATE=Y
"RTN","RCDPEDAR",79,0)
 K DIR
"RTN","RCDPEDAR",80,0)
 S DIR("?")="Enter the latest date of receipt of deposit to include on the report."
"RTN","RCDPEDAR",81,0)
 S DIR("B")=Y(0)
"RTN","RCDPEDAR",82,0)
 S DIR(0)="DAO^"_RCDT1_":"_DT_":APE",DIR("A")="END DATE: "
"RTN","RCDPEDAR",83,0)
 D ^DIR
"RTN","RCDPEDAR",84,0)
 Q:$D(DTOUT)!$D(DUOUT)!(Y="") 0
"RTN","RCDPEDAR",85,0)
 S ENDDATE=Y
"RTN","RCDPEDAR",86,0)
 Q 1
"RTN","RCDPEDAR",87,0)
 ;
"RTN","RCDPEDAR",88,0)
EN(RCDET,RCDT1,RCDT2,RCLSTMGR) ; Entry point for report, might be queued
"RTN","RCDPEDAR",89,0)
 ; Input:   RCDET       - 1 - Detail Report, 0 - Summary
"RTN","RCDPEDAR",90,0)
 ;          RCDT1       - Internal Fileman Start date
"RTN","RCDPEDAR",91,0)
 ;          RCDT2       - Internal Fileman End date
"RTN","RCDPEDAR",92,0)
 ;          RCLSTMGR    - 1 display in list manager, 0 otherwise
"RTN","RCDPEDAR",93,0)
 ;                        Optional, defaults to 0
"RTN","RCDPEDAR",94,0)
 ;          RCNP        - A1^A2^A3 Where:
"RTN","RCDPEDAR",95,0)
 ;                           A1 - 1 - Range of Payers
"RTN","RCDPEDAR",96,0)
 ;                                2 - All Payers selected
"RTN","RCDPEDAR",97,0)
 ;                                3 - Specific payers
"RTN","RCDPEDAR",98,0)
 ;                           A2 - From Range (When a from/thru range is selected by user)
"RTN","RCDPEDAR",99,0)
 ;                           A3 - Thru Range (When a from/thru range is selected by user)
"RTN","RCDPEDAR",100,0)
 ;          RCPYRSEL    - Array of selected payers (Only present if A1=3 above
"RTN","RCDPEDAR",101,0)
 ;          VAUTD       - 1 - All selected divisions OR an array of selected divisions
"RTN","RCDPEDAR",102,0)
 N DTADD,IEN3443,IEN34431,INPUT,RCFLG,RCJOB,RCT,XX,Z
"RTN","RCDPEDAR",103,0)
 N:$G(ZTSK) ZTSTOP                          ; Job was tasked, ZTSTOP = flag to stop
"RTN","RCDPEDAR",104,0)
 S:'$D(RCLSTMGR) RCLSTMGR=0
"RTN","RCDPEDAR",105,0)
 ;
"RTN","RCDPEDAR",106,0)
 ; PRCA*4.5*284 - Queued job needs to reload payer selection list
"RTN","RCDPEDAR",107,0)
 I $D(RCPYRSEL) D
"RTN","RCDPEDAR",108,0)
 . K ^TMP("RCSELPAY",$J)
"RTN","RCDPEDAR",109,0)
 . M ^TMP("RCSELPAY",$J)=RCPYRSEL
"RTN","RCDPEDAR",110,0)
 ;
"RTN","RCDPEDAR",111,0)
 S XX=$S(RCLSTMGR:1,1:0)
"RTN","RCDPEDAR",112,0)
 S INPUT=XX_"^"_RCLSTMGR_"^"_+RCDET
"RTN","RCDPEDAR",113,0)
 S RCNP=+RCNP,RCJOB=$J
"RTN","RCDPEDAR",114,0)
 K ^TMP("RCDAILYACT",$J)
"RTN","RCDPEDAR",115,0)
 K ^TMP($J,"TOTALS")                        ; Initialize Totals temp workspace
"RTN","RCDPEDAR",116,0)
 ;
"RTN","RCDPEDAR",117,0)
 ; Loop through all of the EDI LOCKBOX DEPOSIT records in the selected date
"RTN","RCDPEDAR",118,0)
 ; range and add any that pass the payer and division filters into ^TMP
"RTN","RCDPEDAR",119,0)
 ; by the internal date added
"RTN","RCDPEDAR",120,0)
 S DTADD=RCDT1-.0001,RCT=0
"RTN","RCDPEDAR",121,0)
 S $P(INPUT,"^",4)=0                        ; Current Page Number
"RTN","RCDPEDAR",122,0)
 S $P(INPUT,"^",5)=0                        ; Stop Flag
"RTN","RCDPEDAR",123,0)
 F  D  Q:'DTADD  Q:DTADD>(RCDT2_".9999")  Q:$P(INPUT,"^",5)=1
"RTN","RCDPEDAR",124,0)
 . S DTADD=$O(^RCY(344.3,"ARECDT",DTADD))
"RTN","RCDPEDAR",125,0)
 . Q:'DTADD
"RTN","RCDPEDAR",126,0)
 . Q:DTADD>(RCDT2_".9999")
"RTN","RCDPEDAR",127,0)
 . S IEN3443=0
"RTN","RCDPEDAR",128,0)
 . F  D  Q:'IEN3443  Q:$P(INPUT,"^",5)=1
"RTN","RCDPEDAR",129,0)
 . . S IEN3443=$O(^RCY(344.3,"ARECDT",DTADD,IEN3443))
"RTN","RCDPEDAR",130,0)
 . . Q:'IEN3443
"RTN","RCDPEDAR",131,0)
 . . S IEN34431="",RCFLG=0
"RTN","RCDPEDAR",132,0)
 . . F  D  Q:IEN34431=""
"RTN","RCDPEDAR",133,0)
 . . . S IEN34431=$O(^RCY(344.31,"B",IEN3443,IEN34431))
"RTN","RCDPEDAR",134,0)
 . . . Q:IEN34431=""
"RTN","RCDPEDAR",135,0)
 . . . Q:'$$CHKPYR(IEN34431,0,RCJOB,RCNP)   ; Not a selected payer PRCA*4.5(318 added ,RCNP
"RTN","RCDPEDAR",136,0)
 . . . Q:'$$CHKDIV(IEN34431,0,.VAUTD)       ; Not a selected station/division
"RTN","RCDPEDAR",137,0)
 . . . S RCFLG=1
"RTN","RCDPEDAR",138,0)
 . . . S ^TMP("RCDAILYACT",$J,DTADD\1,IEN3443,"EFT",IEN34431)=""
"RTN","RCDPEDAR",139,0)
 . . ;
"RTN","RCDPEDAR",140,0)
 . . S:RCFLG ^TMP("RCDAILYACT",$J,DTADD\1,IEN3443)=""
"RTN","RCDPEDAR",141,0)
 . . S RCT=RCT+1                            ; Current Record Count
"RTN","RCDPEDAR",142,0)
 . . ;
"RTN","RCDPEDAR",143,0)
 . . ; Check for user stopped every 100 records
"RTN","RCDPEDAR",144,0)
 . . I '(RCT#100),$D(ZTQUEUED),$$S^%ZTLOAD D  Q
"RTN","RCDPEDAR",145,0)
 . . . S ZTSTOP=1
"RTN","RCDPEDAR",146,0)
 . . . S $P(INPUT,"^",5)=1                  ; Stop now
"RTN","RCDPEDAR",147,0)
 . . . K ZTREQ
"RTN","RCDPEDAR",148,0)
 ;
"RTN","RCDPEDAR",149,0)
 I '$P(INPUT,"^",5) D
"RTN","RCDPEDAR",150,0)
 . S $P(INPUT,"^",6)=RCDT1                  ; Start of Date Range
"RTN","RCDPEDAR",151,0)
 . S $P(INPUT,"^",7)=RCDT2                  ; End of Date Range
"RTN","RCDPEDAR",152,0)
 . D RPT1(.INPUT)
"RTN","RCDPEDAR",153,0)
 D ENQ(INPUT)
"RTN","RCDPEDAR",154,0)
 Q
"RTN","RCDPEDAR",155,0)
 ;
"RTN","RCDPEDAR",156,0)
ENQ(INPUT) ; Clean up
"RTN","RCDPEDAR",157,0)
 ; Input:   INPUT       - A1^A2^A3^...^A8 Where:
"RTN","RCDPEDAR",158,0)
 ;                         A1 - 1 if Detail report, 0 if summary report
"RTN","RCDPEDAR",159,0)
 ;                         A2 - 1 if displaying to Listman, 0 otherwise
"RTN","RCDPEDAR",160,0)
 ;                         A3 - 0 if NOT called from Nightly Process, 1 otherwise
"RTN","RCDPEDAR",161,0)
 ;                         A4 - Current Page Number
"RTN","RCDPEDAR",162,0)
 ;                         A5 - Stop Flag
"RTN","RCDPEDAR",163,0)
 ;                         A6 - Start of Date Range
"RTN","RCDPEDAR",164,0)
 ;                         A7 - End of Date Range
"RTN","RCDPEDAR",165,0)
 ;          ZTQUEUED    - Defined if Joh was queued
"RTN","RCDPEDAR",166,0)
 ; Output:  ZTREQ       - "@" Only returned if ZTQUEUED is defined
"RTN","RCDPEDAR",167,0)
 N XX,YY,ZZ
"RTN","RCDPEDAR",168,0)
 K ^TMP("RCDAILYACT",$J),^TMP("RCSELPAY",$J)
"RTN","RCDPEDAR",169,0)
 K ^TMP($J,"TOTALS")
"RTN","RCDPEDAR",170,0)
 I '$D(ZTQUEUED) D
"RTN","RCDPEDAR",171,0)
 . D ^%ZISC
"RTN","RCDPEDAR",172,0)
 . S XX=$P(INPUT,"^",1)                     ; Nightly Process Flag
"RTN","RCDPEDAR",173,0)
 . S YY=$P(INPUT,"^",5)                     ; Stop Flag
"RTN","RCDPEDAR",174,0)
 . S ZZ=$P(INPUT,"^",4)                     ; Current Page Number
"RTN","RCDPEDAR",175,0)
 . I 'XX,'YY,ZZ D
"RTN","RCDPEDAR",176,0)
 . . S XX=""
"RTN","RCDPEDAR",177,0)
 . . D ASK^RCDPEARL(.XX)
"RTN","RCDPEDAR",178,0)
 I $D(ZTQUEUED) S ZTREQ="@"
"RTN","RCDPEDAR",179,0)
 Q
"RTN","RCDPEDAR",180,0)
 ;
"RTN","RCDPEDAR",181,0)
RPT1(INPUT) ;EP from RCDPEM1 (Nightly Process)
"RTN","RCDPEDAR",182,0)
 ; Output the report
"RTN","RCDPEDAR",183,0)
 ; Input:   INPUT       - A1^A2^A3^...^An Where:
"RTN","RCDPEDAR",184,0)
 ;                         A1 - 1 if called from Nightly Process, 0 otherwise
"RTN","RCDPEDAR",185,0)
 ;                         A2 - 1 if displaying to Listman, 0 otherwise
"RTN","RCDPEDAR",186,0)
 ;                         A4 - Current Page Number
"RTN","RCDPEDAR",187,0)
 ;                         A5 - Stop Flag
"RTN","RCDPEDAR",188,0)
 ;                         A6 - Start of Date Range
"RTN","RCDPEDAR",189,0)
 ;                         A7 - End of Date Range
"RTN","RCDPEDAR",190,0)
 ;          ^TMP(B1,$J,B2,B3)          = "" - Array of record IENs in 344.3 in date range
"RTN","RCDPEDAR",191,0)
 ;                                            and for selected payer(s) and division(s)
"RTN","RCDPEDAR",192,0)
 ;          ^TMP(B1,$J,B2,B3,"EFT",B4) = "" - Array of record IENS in 344.31 for above Where:
"RTN","RCDPEDAR",193,0)
 ;                        B1 - "RCDAILYACT"
"RTN","RCDPEDAR",194,0)
 ;                        B2 - Internal Date from DATE/TIME ADDED (344.3, .13)
"RTN","RCDPEDAR",195,0)
 ;                        B3 - Internal IEN for 344.3
"RTN","RCDPEDAR",196,0)
 ;                        B4 - Internal IEN for file 344.31
"RTN","RCDPEDAR",197,0)
 ; Output:  INPUT       - A1^A2^A3^...^An - The following pieces may be updated
"RTN","RCDPEDAR",198,0)
 ;                         A4 - Current Page Number
"RTN","RCDPEDAR",199,0)
 ;                         A5 - Stop Flag
"RTN","RCDPEDAR",200,0)
 ;
"RTN","RCDPEDAR",201,0)
 N CURPG,DETL,DTADD,DTEND,DTST,HDR1,LSTMAN,NJ
"RTN","RCDPEDAR",202,0)
 S DETL=$P(INPUT,"^",3)                     ; Detail Report flag
"RTN","RCDPEDAR",203,0)
 S LSTMAN=$P(INPUT,"^",2)                   ; Listman flag
"RTN","RCDPEDAR",204,0)
 S NJ=$P(INPUT,"^",1)                       ; Nightly Process flag
"RTN","RCDPEDAR",205,0)
 S CURPG=$P(INPUT,"^",4)                    ; Current Page Number
"RTN","RCDPEDAR",206,0)
 S DTST=$P(INPUT,"^",6)                     ; Date Range Start
"RTN","RCDPEDAR",207,0)
 S DTEND=$P(INPUT,"^",7)                    ; Date Range End
"RTN","RCDPEDAR",208,0)
 S $P(INPUT,"^",8)=0                        ; Current line counter
"RTN","RCDPEDAR",209,0)
 S DTADD=""
"RTN","RCDPEDAR",210,0)
 F  D  Q:DTADD=""  Q:$P(INPUT,"^",5)=1
"RTN","RCDPEDAR",211,0)
 . S DTADD=$O(^TMP("RCDAILYACT",$J,DTADD))
"RTN","RCDPEDAR",212,0)
 . Q:DTADD=""
"RTN","RCDPEDAR",213,0)
 . ;
"RTN","RCDPEDAR",214,0)
 . ; If not being displayed in the list manager and either this is the initial
"RTN","RCDPEDAR",215,0)
 . ; page header (RCPG=0) OR this wasn't called by the nightly job and we have
"RTN","RCDPEDAR",216,0)
 . ; reached the end of the page, then print a page header
"RTN","RCDPEDAR",217,0)
 . I 'LSTMAN,'CURPG!$S('NJ:($Y+5)>IOSL,1:0) D  Q:$P(INPUT,"^",5)=1
"RTN","RCDPEDAR",218,0)
 . . D HDR^RCDPEDA3(.INPUT)
"RTN","RCDPEDAR",219,0)
 . S HDR1="DATE EFT DEPOSIT RECEIVED: "_$$FMTE^XLFDT(DTADD,"2Z")
"RTN","RCDPEDAR",220,0)
 . S HDR1=$J("",80-$L(HDR1)\2)_HDR1         ; Center it
"RTN","RCDPEDAR",221,0)
 . Q:$P(INPUT,"^",5)=1                      ; User quit
"RTN","RCDPEDAR",222,0)
 . I DETL D                                 ; Detail Report
"RTN","RCDPEDAR",223,0)
 . . D SL^RCDPEDA3(.INPUT,HDR1)
"RTN","RCDPEDAR",224,0)
 . . D SL^RCDPEDA3(.INPUT," ")
"RTN","RCDPEDAR",225,0)
 . S $P(INPUT,"^",9)=DTADD
"RTN","RCDPEDAR",226,0)
 . D RPT2^RCDPEDA2(.INPUT)                  ; Process all 344.3 records found
"RTN","RCDPEDAR",227,0)
 . Q:$P(INPUT,"^",5)=1                      ; User quit
"RTN","RCDPEDAR",228,0)
 . D TOTSDAY^RCDPEDA3(.INPUT)                        ; Display Totals for Date
"RTN","RCDPEDAR",229,0)
 ;
"RTN","RCDPEDAR",230,0)
 Q:$P(INPUT,"^",5)=1                        ; User quit
"RTN","RCDPEDAR",231,0)
 D TOTSF^RCDPEDA3(.INPUT)                            ; Display Final Totals
"RTN","RCDPEDAR",232,0)
 D SL^RCDPEDA3(.INPUT,$$ENDORPRT^RCDPEARL)           ; Display End of Report
"RTN","RCDPEDAR",233,0)
 Q
"RTN","RCDPEDAR",234,0)
 ;
"RTN","RCDPEDAR",235,0)
CHKPYR(IEN,FLG,RCJOB,RCNP) ;EP from RCDPEAR2 PRCA*4.5*318 added RCNP parameter
"RTN","RCDPEDAR",236,0)
 ; Checks to be sure the specified payer has been selected
"RTN","RCDPEDAR",237,0)
 ; Input:   IEN     - Internal IEN into file 344.31 (EDI THIRD PARTY EFT DETAI) OR
"RTN","RCDPEDAR",238,0)
 ;                                      file 344.4  (ELECTRONIC REMITTANCE ADVICE)
"RTN","RCDPEDAR",239,0)
 ;                    Used to retrieve the payer
"RTN","RCDPEDAR",240,0)
 ;          FLG     - 0 if IEN contains ien in file 344.31
"RTN","RCDPEDAR",241,0)
 ;                    1 if IEN contains ien in file 344.4
"RTN","RCDPEDAR",242,0)
 ;          RCJOB   - $J
"RTN","RCDPEDAR",243,0)
 ;          RCNP    - 0 - Not passed
"RTN","RCDPEDAR",244,0)
 ;                    1 - Range of Payers
"RTN","RCDPEDAR",245,0)
 ;                    2 - All Payers selected
"RTN","RCDPEDAR",246,0)
 ;                    3 - Specific payers
"RTN","RCDPEDAR",247,0)
 ;                    Optional, defaults to 0
"RTN","RCDPEDAR",248,0)
 ;          ^TMP("RCSELPAY",$J,CNT)=A1 Where:
"RTN","RCDPEDAR",249,0)
 ;                                   CNT - Counter of the number of payers 1-n
"RTN","RCDPEDAR",250,0)
 ;                                   A1  - Payer Name
"RTN","RCDPEDAR",251,0)
 ; Returns: 1 if payer in 344.31/.02 or 344.4/.06 is in the list of selected payers
"RTN","RCDPEDAR",252,0)
 ;            ^TMP("RCSELPAY",$J)
"RTN","RCDPEDAR",253,0)
 ;          0 otherwise
"RTN","RCDPEDAR",254,0)
 N RCPAY,RES,Z
"RTN","RCDPEDAR",255,0)
 S:'$D(RCNP) RCNP=0                                 ; PRCA*4.5*318 added line
"RTN","RCDPEDAR",256,0)
 S RCPAY=""
"RTN","RCDPEDAR",257,0)
 I IEN D
"RTN","RCDPEDAR",258,0)
 . I FLG S RCPAY=$$GET1^DIQ(344.4,IEN,.06,"I") Q    ; PAYMENT FROM field
"RTN","RCDPEDAR",259,0)
 . S RCPAY=$$GET1^DIQ(344.31,IEN,.02,"I")           ; PAYER NAME field
"RTN","RCDPEDAR",260,0)
 ;
"RTN","RCDPEDAR",261,0)
 ; Include EFT with null Payer Names in reports for ALL payers - PRCA*4.5*298 
"RTN","RCDPEDAR",262,0)
 I FLG=0,RCNP=2,RCPAY="" Q 1
"RTN","RCDPEDAR",263,0)
 Q:RCPAY="" 0                                       ; No Payer to compare, invalid
"RTN","RCDPEDAR",264,0)
 S Z=0,RES=0
"RTN","RCDPEDAR",265,0)
 F  D  Q:Z=""  Q:RES
"RTN","RCDPEDAR",266,0)
 . S Z=$O(^TMP("RCSELPAY",RCJOB,Z))
"RTN","RCDPEDAR",267,0)
 . Q:Z=""
"RTN","RCDPEDAR",268,0)
 . S:RCPAY=$G(^TMP("RCSELPAY",RCJOB,Z)) RES=1
"RTN","RCDPEDAR",269,0)
 Q RES
"RTN","RCDPEDAR",270,0)
 ;
"RTN","RCDPEDAR",271,0)
CHKDIV(IEN,FLG,VAUTD) ;
"RTN","RCDPEDAR",272,0)
 ; IEN - ien in file 344.31 or 344.4
"RTN","RCDPEDAR",273,0)
 ; FLG - 0 if IEN contains ien in file 344.31, 1 if IEN contains ien in file 344.4
"RTN","RCDPEDAR",274,0)
 ; VAUTD - array of selected divisions from DIVISION^VAUTOMA API call
"RTN","RCDPEDAR",275,0)
 ; returns 1 if division associated with an entry in 344.31 is on the list in VAUTD
"RTN","RCDPEDAR",276,0)
 ; returns 0 otherwise
"RTN","RCDPEDAR",277,0)
 N ERA,I,NAME,RCSTA,RES
"RTN","RCDPEDAR",278,0)
 S RES=0
"RTN","RCDPEDAR",279,0)
 I VAUTD=1 S RES=1 G CHKDIVX
"RTN","RCDPEDAR",280,0)
 I 'IEN G CHKDIVX
"RTN","RCDPEDAR",281,0)
 S ERA=$S(FLG:IEN,1:$P($G(^RCY(344.31,IEN,0)),U,10))
"RTN","RCDPEDAR",282,0)
 S RCSTA=$$ERASTA^RCDPEM3(ERA),NAME=$P(RCSTA,U)
"RTN","RCDPEDAR",283,0)
 I NAME="UNKNOWN" G CHKDIVX
"RTN","RCDPEDAR",284,0)
 S I=0 I 'VAUTD F  S I=$O(VAUTD(I)) Q:'I!RES  I NAME=VAUTD(I) S RES=1
"RTN","RCDPEDAR",285,0)
CHKDIVX ;
"RTN","RCDPEDAR",286,0)
 Q RES
"RTN","RCDPELA1")
0^30^B118391123^n/a
"RTN","RCDPELA1",1,0)
RCDPELA1 ;EDE/FA - LIST ALL AUTO-POSTED RECEIPTS REPORT ;Nov 17, 2016
"RTN","RCDPELA1",2,0)
 ;;4.5;Accounts Receivable;**318**;Mar 20, 1995;Build 37
"RTN","RCDPELA1",3,0)
 ;Per VA Directive 6402, this routine should not be modified.
"RTN","RCDPELA1",4,0)
 ;
"RTN","RCDPELA1",5,0)
 Q   ; no direct entry
"RTN","RCDPELA1",6,0)
 ;
"RTN","RCDPELA1",7,0)
RPTOUT(INPUT) ; Output the report to paper/screen, listman or excel
"RTN","RCDPELA1",8,0)
 ; Input:   INPUT   - See REPORT for a complete description
"RTN","RCDPELA1",9,0)
 ;          ^TMP($J,A1,"SEL",A2,A3,A4,A5)="" - if record passed filters Where:
"RTN","RCDPELA1",10,0)
 ;                                 A1 - "RCDPE_LAR"
"RTN","RCDPELA1",11,0)
 ;                                 A2 - Uppercased Payer Name (primary sort)
"RTN","RCDPELA1",12,0)
 ;                                 A3 - Secondary Sort Value
"RTN","RCDPELA1",13,0)
 ;                                 A4 - Internal IEN for file 344.4
"RTN","RCDPELA1",14,0)
 ;                                 A5 - Internal IEN for file 344.41
"RTN","RCDPELA1",15,0)
 ; Output:  ^TMP("RCDPE_LAR",$J,CTR)=Line - Array of display lines (no headers)
"RTN","RCDPELA1",16,0)
 ;                                          for output to Listman
"RTN","RCDPELA1",17,0)
 ;                                          Only set when A7-1
"RTN","RCDPELA1",18,0)
 ;
"RTN","RCDPELA1",19,0)
 ;         ^TMP($J,A1,"ZERO",A3,A4)="" - List of EEOBs with zero balance  Where:
"RTN","RCDPELA1",20,0)
 ;                                 A1 - "RCDPE_LAR"
"RTN","RCDPELA1",21,0)
 ;                                 A3 - IEN of #344.4 (ERA #)
"RTN","RCDPELA1",22,0)
 ;                                 A4 - IEN of #344.41 (original sequence #)
"RTN","RCDPELA1",23,0)
 ;
"RTN","RCDPELA1",24,0)
 N A1,DATA,EXCEL,FIRST,IEN3444,LNCNT,LSTMAN
"RTN","RCDPELA1",25,0)
 N ONEERA,OUTTYP,PAGE,PAYER,STOP,SVAL
"RTN","RCDPELA1",26,0)
 S (LNCNT,PAGE)=0                           ; Initialize Line/Page counters
"RTN","RCDPELA1",27,0)
 S $P(INPUT,"^",9)=0                        ; Line Counter for Listman output
"RTN","RCDPELA1",28,0)
 S EXCEL=$P(INPUT,"^",8)
"RTN","RCDPELA1",29,0)
 S LSTMAN=$P(INPUT,"^",7)
"RTN","RCDPELA1",30,0)
 S DATA=0
"RTN","RCDPELA1",31,0)
 S OUTYPE=$S(EXCEL:2,LSTMAN:1,1:0)
"RTN","RCDPELA1",32,0)
 I OUTYPE=2 D                               ; Excel Ouput
"RTN","RCDPELA1",33,0)
 . S XX="Payer^ERA^Date Received^Date Posted^Receipt^Trace #"
"RTN","RCDPELA1",34,0)
 . S XX=XX_"^Receipt Total^ERA Total^Missing Receipts^User^Amount^FMS Doc #"
"RTN","RCDPELA1",35,0)
 . W !,XX
"RTN","RCDPELA1",36,0)
 . ;
"RTN","RCDPELA1",37,0)
 S A1="RCDPE_LAR",PAYER="",STOP=0
"RTN","RCDPELA1",38,0)
 S FIRST=$O(^TMP($J,A1,"SEL",""))           ; First payer on the report
"RTN","RCDPELA1",39,0)
 F  D  Q:PAYER=""  Q:STOP
"RTN","RCDPELA1",40,0)
 . S PAYER=$O(^TMP($J,A1,"SEL",PAYER))
"RTN","RCDPELA1",41,0)
 . Q:PAYER=""
"RTN","RCDPELA1",42,0)
 . S DATA=1                                 ; found data
"RTN","RCDPELA1",43,0)
 . ;
"RTN","RCDPELA1",44,0)
 . I OUTYPE=1 D                             ; Listman Output
"RTN","RCDPELA1",45,0)
 . . S XX=$P(INPUT,"^",9)+1
"RTN","RCDPELA1",46,0)
 . . S $P(INPUT,"^",9)=XX
"RTN","RCDPELA1",47,0)
 . . S ^TMP(A1,$J,XX)=PAYER
"RTN","RCDPELA1",48,0)
 . ;
"RTN","RCDPELA1",49,0)
 . I OUTYPE=0 D  Q:STOP                     ; Paper/Screen output
"RTN","RCDPELA1",50,0)
 . . S:PAGE>1!(PAYER'=FIRST) STOP=$$ASKSTOP^RCDPELAR()
"RTN","RCDPELA1",51,0)
 . . Q:STOP
"RTN","RCDPELA1",52,0)
 . . S LNCNT=0
"RTN","RCDPELA1",53,0)
 . . D HEADER(INPUT,.LNCNT,.PAGE)
"RTN","RCDPELA1",54,0)
 . . D:'EXCEL ERAHDR(PAYER,.LNCNT,PAGE)
"RTN","RCDPELA1",55,0)
 . S SVAL=""
"RTN","RCDPELA1",56,0)
 . F  D  Q:SVAL=""  Q:STOP
"RTN","RCDPELA1",57,0)
 . . S SVAL=$O(^TMP($J,A1,"SEL",PAYER,SVAL))
"RTN","RCDPELA1",58,0)
 . . Q:SVAL=""
"RTN","RCDPELA1",59,0)
 . . S IEN3444=""
"RTN","RCDPELA1",60,0)
 . . F  D  Q:IEN3444=""  Q:STOP
"RTN","RCDPELA1",61,0)
 . . . S IEN3444=$O(^TMP($J,A1,"SEL",PAYER,SVAL,IEN3444))
"RTN","RCDPELA1",62,0)
 . . . Q:IEN3444=""
"RTN","RCDPELA1",63,0)
 . . . D ZEROBAL(IEN3444)  ; determine which IEN34441 lines are zero balance
"RTN","RCDPELA1",64,0)
 . . . K ONEERA
"RTN","RCDPELA1",65,0)
 . . . S XX=$$GET1^DIQ(344.4,IEN3444,.05,"I") ; Total Amount Paid
"RTN","RCDPELA1",66,0)
 . . . S XX=$J(XX,12,2)
"RTN","RCDPELA1",67,0)
 . . . S ONEERA="0^"_XX_"^0^0"                ; Initial ERA values
"RTN","RCDPELA1",68,0)
 . . . S IEN34441=""
"RTN","RCDPELA1",69,0)
 . . . F  D  Q:IEN34441=""  Q:STOP
"RTN","RCDPELA1",70,0)
 . . . . S IEN34441=$O(^TMP($J,A1,"SEL",PAYER,SVAL,IEN3444,IEN34441))
"RTN","RCDPELA1",71,0)
 . . . . Q:IEN34441=""
"RTN","RCDPELA1",72,0)
 . . . . ;
"RTN","RCDPELA1",73,0)
 . . . . Q:$D(^TMP($J,A1,"ZERO",IEN3444,IEN34441))  ; eliminates reversals
"RTN","RCDPELA1",74,0)
 . . . . ;
"RTN","RCDPELA1",75,0)
 . . . . ; Get all the detail lines needed to output one ERA record
"RTN","RCDPELA1",76,0)
 . . . . D ONEDLN(OUTYPE,IEN3444,IEN34441,.ONEERA)
"RTN","RCDPELA1",77,0)
 . . . D ADDERAH(OUTYPE,.ONEERA,IEN3444)      ; Add the ERA Header lines
"RTN","RCDPELA1",78,0)
 . . . ;
"RTN","RCDPELA1",79,0)
 . . . ; Output all the lines for one ERA
"RTN","RCDPELA1",80,0)
 . . . S STOP=$$OUTERA(.INPUT,OUTYPE,PAYER,.ONEERA,.LNCNT,.PAGE)
"RTN","RCDPELA1",81,0)
 I 'DATA,'EXCEL,'LSTMAN D
"RTN","RCDPELA1",82,0)
 . D HEADER(INPUT,.LNCNT,.PAGE)
"RTN","RCDPELA1",83,0)
 . D ERAHDR(PAYER,.LNCNT,PAGE)
"RTN","RCDPELA1",84,0)
 I 'EXCEL D
"RTN","RCDPELA1",85,0)
 . S XX=$$ENDORPRT^RCDPEARL
"RTN","RCDPELA1",86,0)
 . I OUTYPE=1 D  Q
"RTN","RCDPELA1",87,0)
 . . S YY=$P(INPUT,"^",9)+1
"RTN","RCDPELA1",88,0)
 . . S $P(INPUT,"^",9)=YY
"RTN","RCDPELA1",89,0)
 . . S ^TMP(A1,$J,YY)=XX
"RTN","RCDPELA1",90,0)
 . W !,XX
"RTN","RCDPELA1",91,0)
 . I 'STOP S STOP=$$ASKSTOP^RCDPELAR()
"RTN","RCDPELA1",92,0)
 . Q:STOP
"RTN","RCDPELA1",93,0)
 Q
"RTN","RCDPELA1",94,0)
 ;
"RTN","RCDPELA1",95,0)
ZEROBAL(IEN3444)    ; Is it a zero value EEOB
"RTN","RCDPELA1",96,0)
 ; Those EEOB with reversals will have a zero value.  This builds
"RTN","RCDPELA1",97,0)
 ; an array of them.
"RTN","RCDPELA1",98,0)
 ; Input:   IEN3444     - Internal IEN for file 344.4
"RTN","RCDPELA1",99,0)
 ; Output:
"RTN","RCDPELA1",100,0)
 ;         ^TMP($J,A1,"ZERO",A3,A4)="" - List of EEOBs with zero balance  Where:
"RTN","RCDPELA1",101,0)
 ;                                 A1 - "RCDPE_LAR"
"RTN","RCDPELA1",102,0)
 ;                                 A3 - IEN of #344.4 (ERA #)
"RTN","RCDPELA1",103,0)
 ;                                 A4 - IEN of #344.41 (original sequence #)
"RTN","RCDPELA1",104,0)
 ;
"RTN","RCDPELA1",105,0)
 N A1,A2,AMTPOST,IENS,ORIGSEQ,RCSEQ,RCDA1,XX
"RTN","RCDPELA1",106,0)
 K ^TMP($J,"RCDPE_LAR","ZERO",IEN3444)
"RTN","RCDPELA1",107,0)
 ;
"RTN","RCDPELA1",108,0)
 S A1="RCDPE_LAR",A2="ZERO"
"RTN","RCDPELA1",109,0)
 S RCSEQ=0
"RTN","RCDPELA1",110,0)
 F  S RCSEQ=$O(^RCY(344.49,IEN3444,1,"B",RCSEQ)) Q:'RCSEQ  D
"RTN","RCDPELA1",111,0)
 . Q:RCSEQ#1'=0 
"RTN","RCDPELA1",112,0)
 . S RCDA1=+$O(^RCY(344.49,IEN3444,1,"B",RCSEQ,0))
"RTN","RCDPELA1",113,0)
 . Q:'RCDA1
"RTN","RCDPELA1",114,0)
 . S IENS=RCDA1_","_IEN3444_","
"RTN","RCDPELA1",115,0)
 . S AMTPOST=$$GET1^DIQ(344.491,IENS,.03,"I")  ; Amount to post on receipt
"RTN","RCDPELA1",116,0)
 . I AMTPOST>0 Q                               ; Not zero value line
"RTN","RCDPELA1",117,0)
 . S ORIGSEQ=$$GET1^DIQ(344.491,IENS,.09,"I")  ; list of original seq #s with zero balance
"RTN","RCDPELA1",118,0)
 . S XX=0
"RTN","RCDPELA1",119,0)
 . F XX=1:1 Q:$P(ORIGSEQ,",",XX)=""  S ^TMP($J,A1,A2,IEN3444,($P(ORIGSEQ,",",XX)))=""
"RTN","RCDPELA1",120,0)
 Q
"RTN","RCDPELA1",121,0)
 ;
"RTN","RCDPELA1",122,0)
ONEDLN(OUTYPE,IEN3444,IEN34441,ONEERA) ; Gather all of the ERA Detail lines to display
"RTN","RCDPELA1",123,0)
 ; one ERA record
"RTN","RCDPELA1",124,0)
 ; Input:   OUTYPE      - O - Output to Screen or paper
"RTN","RCDPELA1",125,0)
 ;                        1 - Output to Listman
"RTN","RCDPELA1",126,0)
 ;                        2 - Output to Excel
"RTN","RCDPELA1",127,0)
 ;          IEN3444     - Internal IEN for file 344.4
"RTN","RCDPELA1",128,0)
 ;          IEN34441    - Internal IEN for sub file 344.41 of the ERA detail
"RTN","RCDPELA1",129,0)
 ;                        line being processed
"RTN","RCDPELA1",130,0)
 ;          ONEERA      - A1^A2^A3^A4 Where:
"RTN","RCDPELA1",131,0)
 ;                         A1 - Current Number of lines in the ERA display
"RTN","RCDPELA1",132,0)
 ;                         A2 - ERA Total for the ERA (formatted)
"RTN","RCDPELA1",133,0)
 ;                         A3 - Current Receipt Total for the ERA (formatted)
"RTN","RCDPELA1",134,0)
 ;                         A4 - 1 if ERA contains at least one detail record 
"RTN","RCDPELA1",135,0)
 ;                                with a missing receipt.
"RTN","RCDPELA1",136,0)
 ;                              0 otherwise
"RTN","RCDPELA1",137,0)
 ;          ONEERA(LN)=A4- Where
"RTN","RCDPELA1",138,0)
 ;                         LN - Line number for ERA Display
"RTN","RCDPELA1",139,0)
 ;                         A4 - Actual display line
"RTN","RCDPELA1",140,0)
 ; Ouput:   ONEERA     - A1^A2^A3^A4 Where:
"RTN","RCDPELA1",141,0)
 ;                         A1 - Updated Number of lines in the ERA display
"RTN","RCDPELA1",142,0)
 ;                         A2 - ERA Total for the ERA (formatted)
"RTN","RCDPELA1",143,0)
 ;                         A3 - Updated Receipt Total for the ERA (formatted)
"RTN","RCDPELA1",144,0)
 ;                         A4 - 1 if ERA contains at least one detail record 
"RTN","RCDPELA1",145,0)
 ;                                with a missing receipt.
"RTN","RCDPELA1",146,0)
 ;                              0 otherwise
"RTN","RCDPELA1",147,0)
 ;          ONEERA(LN)=A4- Where
"RTN","RCDPELA1",148,0)
 ;                         LN - Line number for ERA Display
"RTN","RCDPELA1",149,0)
 ;                         A4 - Actual display line
"RTN","RCDPELA1",150,0)
 N AMT,DTPOST,DTREC,LCNT,IENS,LN,PAYER,RECEIPT,TRDOC,USER,XX,YY
"RTN","RCDPELA1",151,0)
 S IENS=IEN34441_","_IEN3444_","
"RTN","RCDPELA1",152,0)
 S LCNT=$P(ONEERA,"^",1)+1
"RTN","RCDPELA1",153,0)
 S $P(ONEERA,"^",1)=LCNT                    ; ERA Line counter
"RTN","RCDPELA1",154,0)
 ;
"RTN","RCDPELA1",155,0)
 ; Build detail line for ERA Detail record being process
"RTN","RCDPELA1",156,0)
 S XX=$$GET1^DIQ(344.4,IEN3444,.07,"I")     ; ERA Date Received
"RTN","RCDPELA1",157,0)
 S DTREC=$$FMTE^XLFDT(XX,"2DZ")
"RTN","RCDPELA1",158,0)
 S XX=$$GET1^DIQ(344.41,IENS,9,"I")         ; Auto-Post Date
"RTN","RCDPELA1",159,0)
 S DTPOST=$$FMTE^XLFDT(XX,"2DZ")
"RTN","RCDPELA1",160,0)
 S XX=$$GET1^DIQ(344.41,IENS,.25,"I")       ; Receipt Pointer
"RTN","RCDPELA1",161,0)
 S RECEIPT=$$GET1^DIQ(344,XX,.01,"I")       ; Receipt Number
"RTN","RCDPELA1",162,0)
 S TRDOC=$$GET1^DIQ(344,XX,200,"I")         ; FMS Document #
"RTN","RCDPELA1",163,0)
 I RECEIPT="" D
"RTN","RCDPELA1",164,0)
 . S $P(ONEERA,"^",4)=1
"RTN","RCDPELA1",165,0)
 . S RECEIPT="* Missing *"
"RTN","RCDPELA1",166,0)
 S XX=$O(^RCY(344.72,"E",IEN3444,""))       ; IEN of the Auto-Post Audit File entry
"RTN","RCDPELA1",167,0)
 S USER=$$GET1^DIQ(344.72,XX,.02,"I")       ; User IEN who marked for Auto-Post
"RTN","RCDPELA1",168,0)
 S USER=$$GET1^DIQ(200,USER,1,"I")          ; Initials of User who marked for Auto-Post
"RTN","RCDPELA1",169,0)
 S AMT=$$GET1^DIQ(344.41,IENS,.03,"I")      ; Amount Paid
"RTN","RCDPELA1",170,0)
 I RECEIPT'="* Missing *" D
"RTN","RCDPELA1",171,0)
 . S YY=$P(ONEERA,"^",3)                    ; Current Receipt Total
"RTN","RCDPELA1",172,0)
 . S $P(ONEERA,"^",3)=AMT+YY                ; Updated Receipt Total
"RTN","RCDPELA1",173,0)
 S AMT=$J(AMT,12,2)                         ; Formatted Paid
"RTN","RCDPELA1",174,0)
 I OUTYPE=2 D  Q                            ; Output to Excel
"RTN","RCDPELA1",175,0)
 . S LN=$$GET1^DIQ(344.4,IEN3444,.06,"I")   ; Payment From
"RTN","RCDPELA1",176,0)
 . S LN=LN_"^"_IEN3444_"^"_DTREC_"^"_DTPOST_"^"_RECEIPT
"RTN","RCDPELA1",177,0)
 . S $P(LN,"^",10)=USER
"RTN","RCDPELA1",178,0)
 . S $P(LN,"^",11)=AMT
"RTN","RCDPELA1",179,0)
 . S $P(LN,"^",12)=TRDOC
"RTN","RCDPELA1",180,0)
 . S ONEERA(LCNT)=LN
"RTN","RCDPELA1",181,0)
 ;
"RTN","RCDPELA1",182,0)
 S LN="       "
"RTN","RCDPELA1",183,0)
 S LN=$$SETSTR^VALM1(DTREC,LN,9,10)
"RTN","RCDPELA1",184,0)
 S LN=$$SETSTR^VALM1(DTPOST,LN,19,10)
"RTN","RCDPELA1",185,0)
 S LN=$$SETSTR^VALM1(RECEIPT,LN,30,$L(RECEIPT))
"RTN","RCDPELA1",186,0)
 S LN=$$SETSTR^VALM1(USER,LN,43,$L(USER))
"RTN","RCDPELA1",187,0)
 S LN=$$SETSTR^VALM1(AMT,LN,50,$L(AMT))
"RTN","RCDPELA1",188,0)
 S LN=$$SETSTR^VALM1(TRDOC,LN,65,$L(TRDOC))
"RTN","RCDPELA1",189,0)
 S ONEERA(LCNT)=LN
"RTN","RCDPELA1",190,0)
 Q
"RTN","RCDPELA1",191,0)
 ;
"RTN","RCDPELA1",192,0)
ADDERAH(OUTYPE,ONEERA,IEN3444) ; Add the header lines to ERA output array
"RTN","RCDPELA1",193,0)
 ; Input:   OUTYPE      - O - Output to Screen or paper
"RTN","RCDPELA1",194,0)
 ;                        1 - Output to Listman
"RTN","RCDPELA1",195,0)
 ;                        2 - Output to Excel
"RTN","RCDPELA1",196,0)
 ;          ONEERA      - A1^A2^A3^A4 Where:
"RTN","RCDPELA1",197,0)
 ;                        A1 - Number of lines in the ERA display
"RTN","RCDPELA1",198,0)
 ;                        A2 - Total Receipt amount for the ERA (formatted)
"RTN","RCDPELA1",199,0)
 ;                        A3 - Total Amount paid for the ERA (formatted)
"RTN","RCDPELA1",200,0)
 ;                        A4 - 1 if ERA contains at least one detail record 
"RTN","RCDPELA1",201,0)
 ;                               with a missing receipt.
"RTN","RCDPELA1",202,0)
 ;                             0 otherwise
"RTN","RCDPELA1",203,0)
 ;          ONEERA(LN)=A4- Where
"RTN","RCDPELA1",204,0)
 ;                        LN - Line number for ERA Display
"RTN","RCDPELA1",205,0)
 ;                        A4 - Actual display line
"RTN","RCDPELA1",206,0)
 ;          IEN3444     - Internal IEN for file 344.4
"RTN","RCDPELA1",207,0)
 ; Ouput:   ONEERA      - Receipt Total Formatted, ERA Lines 1-4 added
"RTN","RCDPELA1",208,0)
 N LN,MISSINGR,TOTERA,TOTREC,TRACE,XX
"RTN","RCDPELA1",209,0)
 S XX=$P(ONEERA,"^",3)                      ; Final Receipt Total
"RTN","RCDPELA1",210,0)
 S TOTREC=$J(XX,12,2)                       ; Formatted total
"RTN","RCDPELA1",211,0)
 S TOTERA=$P(ONEERA,"^",2)                  ; Formatted ERA Total
"RTN","RCDPELA1",212,0)
 S XX=$$COMPLETE^RCDPELAR(IEN3444)
"RTN","RCDPELA1",213,0)
 S MISSINGR=$S(XX=0:"* Missing Receipts *",1:"")
"RTN","RCDPELA1",214,0)
 S TRACE=$$GET1^DIQ(344.4,IEN3444,.02,"I")  ; Trace Number
"RTN","RCDPELA1",215,0)
 I OUTYPE=2 D  Q                            ; Excel output
"RTN","RCDPELA1",216,0)
 . S XX=""
"RTN","RCDPELA1",217,0)
 . F  D  Q:XX=""
"RTN","RCDPELA1",218,0)
 . . S XX=$O(ONEERA(XX))
"RTN","RCDPELA1",219,0)
 . . Q:XX=""
"RTN","RCDPELA1",220,0)
 . . S $P(ONEERA(XX),"^",6)=TRACE            ; Formatted Receipt Total
"RTN","RCDPELA1",221,0)
 . . S $P(ONEERA(XX),"^",7)=TOTREC           ; Formatted Receipt Total
"RTN","RCDPELA1",222,0)
 . . S $P(ONEERA(XX),"^",8)=$P(ONEERA,"^",2) ; Formatted ERA Total
"RTN","RCDPELA1",223,0)
 . . S $P(ONEERA(XX),"^",9)=MISSINGR
"RTN","RCDPELA1",224,0)
 ;
"RTN","RCDPELA1",225,0)
 ; 1st Main ERA display line
"RTN","RCDPELA1",226,0)
 S LN="ERA: "
"RTN","RCDPELA1",227,0)
 S LN=$$SETSTR^VALM1(IEN3444,LN,6,$L(IEN3444))
"RTN","RCDPELA1",228,0)
 S LN=$$SETSTR^VALM1("ERA Total: ",LN,20,11)
"RTN","RCDPELA1",229,0)
 S LN=$$SETSTR^VALM1(TOTERA,LN,32,$L(TOTERA))
"RTN","RCDPELA1",230,0)
 S LN=$$SETSTR^VALM1(MISSINGR,LN,53,$L(MISSINGR))
"RTN","RCDPELA1",231,0)
 S XX=$P(ONEERA,"^",1)+1
"RTN","RCDPELA1",232,0)
 S $P(ONEERA,"^",1)=XX                       ; Update Line counter
"RTN","RCDPELA1",233,0)
 S ONEERA(.1)=LN
"RTN","RCDPELA1",234,0)
 ;
"RTN","RCDPELA1",235,0)
 ; 2nd Main ERA display line
"RTN","RCDPELA1",236,0)
 S LN="                Receipt Total:"
"RTN","RCDPELA1",237,0)
 S LN=$$SETSTR^VALM1(TOTREC,LN,32,$L(TOTREC))
"RTN","RCDPELA1",238,0)
 S XX=$P(ONEERA,"^",1)+1
"RTN","RCDPELA1",239,0)
 S $P(ONEERA,"^",1)=XX                       ; Update Line counter
"RTN","RCDPELA1",240,0)
 S ONEERA(.2)=LN
"RTN","RCDPELA1",241,0)
 ;
"RTN","RCDPELA1",242,0)
 ; 3rd Main ERA display line
"RTN","RCDPELA1",243,0)
 S LN="                      Trace #:"
"RTN","RCDPELA1",244,0)
 S XX=$$GET1^DIQ(344.4,IEN3444,.02,"I")     ; Trace Number
"RTN","RCDPELA1",245,0)
 S LN=$$SETSTR^VALM1(XX,LN,32,$L(XX))
"RTN","RCDPELA1",246,0)
 S XX=$P(ONEERA,"^",1)+1
"RTN","RCDPELA1",247,0)
 S $P(ONEERA,"^",1)=XX                      ; Update Line counter
"RTN","RCDPELA1",248,0)
 S ONEERA(.3)=LN
"RTN","RCDPELA1",249,0)
 Q
"RTN","RCDPELA1",250,0)
 ;
"RTN","RCDPELA1",251,0)
OUTERA(INPUT,OUTYPE,PAYER,ONEERA,LNCNT,PAGE) ; Output the display lines for one ERA
"RTN","RCDPELA1",252,0)
 ; Input:   INPUT   - See REPORT for a complete description
"RTN","RCDPELA1",253,0)
 ;          OUTYPE      - O - Output to Screen or paper
"RTN","RCDPELA1",254,0)
 ;                        1 - Output to Listman
"RTN","RCDPELA1",255,0)
 ;                        2 - Output to Excel
"RTN","RCDPELA1",256,0)
 ;          PAYER       - Payer Name
"RTN","RCDPELA1",257,0)
 ;          ONEERA      - Array of lines to display for one ERA
"RTN","RCDPELA1",258,0)
 ;          LNCNT       - Current Line Count
"RTN","RCDPELA1",259,0)
 ;          PAGE        - Current Page Count
"RTN","RCDPELA1",260,0)
 ; Output:  LNCNT       - Updated Line Count
"RTN","RCDPELA1",261,0)
 ;          PAGE        - Updated Page Count
"RTN","RCDPELA1",262,0)
 ;          A9          - Part of Input above
"RTN","RCDPELA1",263,0)
 ;                        Updated Line counter for Listman Output
"RTN","RCDPELA1",264,0)
 ;          ^TMP("RCDPE_LAR",$J,CTR)=Line - Array of display lines (no headers)
"RTN","RCDPELA1",265,0)
 ;                                          for output to Listman
"RTN","RCDPELA1",266,0)
 ;                                          Only set when A7-1
"RTN","RCDPELA1",267,0)
 ; Returns: 1 if user quit, 0 otherwise
"RTN","RCDPELA1",268,0)
 N LN,STOP,XX
"RTN","RCDPELA1",269,0)
 S STOP=0
"RTN","RCDPELA1",270,0)
 S XX=LNCNT-4+$P(ONEERA,"^",1)                ; LNCNT + # of lines to display
"RTN","RCDPELA1",271,0)
 I 'OUTYPE,(XX>(IOSL-3)) D  Q:STOP 1
"RTN","RCDPELA1",272,0)
 . S STOP=$$ASKSTOP^RCDPELAR()
"RTN","RCDPELA1",273,0)
 . Q:STOP
"RTN","RCDPELA1",274,0)
 . S LNCNT=0
"RTN","RCDPELA1",275,0)
 . D HEADER(INPUT,.LNCNT,.PAGE)
"RTN","RCDPELA1",276,0)
 . D ERAHDR(PAYER,.LNCNT,.PAGE)
"RTN","RCDPELA1",277,0)
 S LN=""
"RTN","RCDPELA1",278,0)
 F  D  Q:LN=""  Q:STOP
"RTN","RCDPELA1",279,0)
 . S LN=$O(ONEERA(LN))
"RTN","RCDPELA1",280,0)
 . Q:LN=""
"RTN","RCDPELA1",281,0)
 . S LNCNT=LNCNT+1
"RTN","RCDPELA1",282,0)
 . I OUTYPE=1 D  Q
"RTN","RCDPELA1",283,0)
 . . S XX=$P(INPUT,"^",9)+1
"RTN","RCDPELA1",284,0)
 . . S $P(INPUT,"^",9)=XX
"RTN","RCDPELA1",285,0)
 . . S ^TMP("RCDPE_LAR",$J,XX)=ONEERA(LN)
"RTN","RCDPELA1",286,0)
 . W !,ONEERA(LN)
"RTN","RCDPELA1",287,0)
 S LNCNT=LNCNT+1
"RTN","RCDPELA1",288,0)
 W:OUTYPE=0 !
"RTN","RCDPELA1",289,0)
 I OUTYPE=1 D
"RTN","RCDPELA1",290,0)
 . S XX=$P(INPUT,"^",9)+1
"RTN","RCDPELA1",291,0)
 . S $P(INPUT,"^",9)=XX
"RTN","RCDPELA1",292,0)
 . S ^TMP("RCDPE_LAR",$J,XX)=" "
"RTN","RCDPELA1",293,0)
 Q STOP
"RTN","RCDPELA1",294,0)
 ;
"RTN","RCDPELA1",295,0)
HEADER(INPUT,LNCNT,PAGE) ; Display a Page Header
"RTN","RCDPELA1",296,0)
 ; Input:   INPUT   - See REPORT for a complete description
"RTN","RCDPELA1",297,0)
 ;          LNCNT   - Current Line Count
"RTN","RCDPELA1",298,0)
 ;          PAGE    - Current Page Count
"RTN","RCDPELA1",299,0)
 ; Output:  LNCNT   - Updated Line Count
"RTN","RCDPELA1",300,0)
 ;          PAGE    - Updated Page Count
"RTN","RCDPELA1",301,0)
 N XX,YY,ZZ
"RTN","RCDPELA1",302,0)
 S YY="AUTO-POSTED RECEIPT REPORT",PAGE=PAGE+1
"RTN","RCDPELA1",303,0)
 S XX=$$NOW^XLFDT(),XX=$$FMTE^XLFDT(XX)
"RTN","RCDPELA1",304,0)
 S XX=$$SETSTR^VALM1(XX,YY,40,21)
"RTN","RCDPELA1",305,0)
 S YY="Page: "_$J(PAGE,3)
"RTN","RCDPELA1",306,0)
 S XX=$$SETSTR^VALM1(YY,XX,72,$L(YY))
"RTN","RCDPELA1",307,0)
 S LNCNT=LNCNT+1
"RTN","RCDPELA1",308,0)
 W @IOF,XX
"RTN","RCDPELA1",309,0)
 ;
"RTN","RCDPELA1",310,0)
 S LNCNT=LNCNT+1
"RTN","RCDPELA1",311,0)
 S XX=$$HDRLN2(INPUT)
"RTN","RCDPELA1",312,0)
 W !,XX
"RTN","RCDPELA1",313,0)
 ;
"RTN","RCDPELA1",314,0)
 S LNCNT=LNCNT+1
"RTN","RCDPELA1",315,0)
 S XX=$$HDRLN3(INPUT)
"RTN","RCDPELA1",316,0)
 W !,XX
"RTN","RCDPELA1",317,0)
 ;
"RTN","RCDPELA1",318,0)
 S LNCNT=LNCNT+1
"RTN","RCDPELA1",319,0)
 W !                                        ; Blank line
"RTN","RCDPELA1",320,0)
 Q
"RTN","RCDPELA1",321,0)
 ;
"RTN","RCDPELA1",322,0)
HDRLN2(INPUT) ; Build the 2nd header line
"RTN","RCDPELA1",323,0)
 ; Input:   INPUT   - See REPORT for a complete description
"RTN","RCDPELA1",324,0)
 ; Returns: Text for 2nd header line
"RTN","RCDPELA1",325,0)
 N XX,YY,ZZ
"RTN","RCDPELA1",326,0)
 S XX=" FILTERS: "_$S($P(INPUT,"^",1)=1:"All",1:"Selected")_" Divs;"
"RTN","RCDPELA1",327,0)
 S XX=XX_$S($P(INPUT,"^",5)=1:" All",1:" Selected")_" Payers;"
"RTN","RCDPELA1",328,0)
 S XX=XX_$S($P(INPUT,"^",2)=1:" Auto-Post Date",1:" ERA Dt Received")
"RTN","RCDPELA1",329,0)
 S YY=$P($P(INPUT,"^",3),"|",1),YY=$$FMTE^XLFDT(YY,"2Z")
"RTN","RCDPELA1",330,0)
 S ZZ=$P($P(INPUT,"^",3),"|",2),ZZ=$$FMTE^XLFDT(ZZ,"2Z")
"RTN","RCDPELA1",331,0)
 S XX=XX_" "_YY_" to "_ZZ
"RTN","RCDPELA1",332,0)
 Q XX
"RTN","RCDPELA1",333,0)
 ;
"RTN","RCDPELA1",334,0)
HDRLN3(INPUT) ; Build the 2nd header line
"RTN","RCDPELA1",335,0)
 ; Input:   INPUT   - A1^A2^A3^...^An Where:
"RTN","RCDPELA1",336,0)
 ;                       A1 - 1 - All divisions selected
"RTN","RCDPELA1",337,0)
 ;                            2 - Selected divisions
"RTN","RCDPELA1",338,0)
 ;                       A2 - 1 - Filter by Auto-Post date range
"RTN","RCDPELA1",339,0)
 ;                            2 - Filter by ERA Date Received date range
"RTN","RCDPELA1",340,0)
 ;                       A3 - B1|B2   - Where:
"RTN","RCDPELA1",341,0)
 ;                             B1 - ERA Date Received Start Date if A2=2
"RTN","RCDPELA1",342,0)
 ;                                  Auto-Post Start Date of A2=1
"RTN","RCDPELA1",343,0)
 ;                             B2 - ERA Date Received End Date if A2=2
"RTN","RCDPELA1",344,0)
 ;                                  Auto-Post End Date of A2=1
"RTN","RCDPELA1",345,0)
 ;                       A4 - 1 - Posted/Completed Receipts
"RTN","RCDPELA1",346,0)
 ;                            2 - Only ERAs with Missing Receipts
"RTN","RCDPELA1",347,0)
 ;                            3 - Both Posted/Completed and Missing Receipts
"RTN","RCDPELA1",348,0)
 ;                       A5 - 1 - All insurance companies selected
"RTN","RCDPELA1",349,0)
 ;                            2 - Selected insurance companies chosen
"RTN","RCDPELA1",350,0)
 ;                       A6 - 1 - Auto-Post Date/ERA Date Received Sort
"RTN","RCDPELA1",351,0)
 ;                            2 - Payer sort
"RTN","RCDPELA1",352,0)
 ;                            3 - Missing Receipts
"RTN","RCDPELA1",353,0)
 ;                       A7 - 0 - Do not display in a listman template
"RTN","RCDPELA1",354,0)
 ;                            1 - Display in a listman template
"RTN","RCDPELA1",355,0)
 ;                       A8 - 0 - Output to paper
"RTN","RCDPELA1",356,0)
 ;                            1 - Output to Excel
"RTN","RCDPELA1",357,0)
 ;                       A9 - Line counter for Listman output  
"RTN","RCDPELA1",358,0)
 ; Returns: Text for 2nd header line
"RTN","RCDPELA1",359,0)
 N XX,YY,ZZ
"RTN","RCDPELA1",360,0)
 S YY=$P(INPUT,"^",4)
"RTN","RCDPELA1",361,0)
 S:YY=1 ZZ="Posted/Completed Receipts"      ; Receipt filter
"RTN","RCDPELA1",362,0)
 S:YY=2 ZZ="Missing Receipts Only"
"RTN","RCDPELA1",363,0)
 S:YY=3 ZZ="All Receipts"
"RTN","RCDPELA1",364,0)
 S XX=" ERA: "_ZZ
"RTN","RCDPELA1",365,0)
 S XX=$$SETSTR^VALM1("SORT: ",XX,40,6)
"RTN","RCDPELA1",366,0)
 S YY=$P(INPUT,"^",6)                       ; Selected Sort
"RTN","RCDPELA1",367,0)
 I YY=1,$P(INPUT,"^",2)=1 S ZZ="Auto-Post Date"
"RTN","RCDPELA1",368,0)
 I YY=1,$P(INPUT,"^",2)=2 S ZZ="ERA Date Received"
"RTN","RCDPELA1",369,0)
 I YY=2 S ZZ="Payer"
"RTN","RCDPELA1",370,0)
 I YY=3 S ZZ="Missing Receipts"
"RTN","RCDPELA1",371,0)
 S XX=$$SETSTR^VALM1(ZZ,XX,46,$L(ZZ))
"RTN","RCDPELA1",372,0)
 Q XX
"RTN","RCDPELA1",373,0)
 ;
"RTN","RCDPELA1",374,0)
ERAHDR(PAYER,LNCNT,PAGE) ; Display ERA Header Lines
"RTN","RCDPELA1",375,0)
 ; Input:   PAYER   - Payer Name
"RTN","RCDPELA1",376,0)
 ;          LNCNT   - Current Line Count
"RTN","RCDPELA1",377,0)
 ;          PAGE    - Current Page Count
"RTN","RCDPELA1",378,0)
 ; Output:  LNCNT   - Updated Line Count
"RTN","RCDPELA1",379,0)
 ;          PAGE    - Updated Page Count
"RTN","RCDPELA1",380,0)
 N XX,YY,ZZ
"RTN","RCDPELA1",381,0)
 S LNCNT=LNCNT+1
"RTN","RCDPELA1",382,0)
 S XX="        DATE      DATE"
"RTN","RCDPELA1",383,0)
 W !,XX
"RTN","RCDPELA1",384,0)
 ;
"RTN","RCDPELA1",385,0)
 S LNCNT=LNCNT+1
"RTN","RCDPELA1",386,0)
 S XX=$$ERAHDR2()
"RTN","RCDPELA1",387,0)
 W !,XX
"RTN","RCDPELA1",388,0)
 ;
"RTN","RCDPELA1",389,0)
 S LNCNT=LNCNT+1
"RTN","RCDPELA1",390,0)
 S XX=$J("",80),XX=$TR(XX," ","-")
"RTN","RCDPELA1",391,0)
 W !,XX
"RTN","RCDPELA1",392,0)
 ;
"RTN","RCDPELA1",393,0)
 S LNCNT=LNCNT+1
"RTN","RCDPELA1",394,0)
 W !,"Payer: ",PAYER
"RTN","RCDPELA1",395,0)
 Q
"RTN","RCDPELA1",396,0)
 ;
"RTN","RCDPELA1",397,0)
ERAHDR2() ; Build the 2nd ERA header line
"RTN","RCDPELA1",398,0)
 ; Input:   None
"RTN","RCDPELA1",399,0)
 ; Returns: Text for 2nd ERA header line
"RTN","RCDPELA1",400,0)
 N XX
"RTN","RCDPELA1",401,0)
 S XX="        " ;RECEIVED  POSTED     RECEIPT"
"RTN","RCDPELA1",402,0)
 S XX=$$SETSTR^VALM1("RECEIVED",XX,9,8)
"RTN","RCDPELA1",403,0)
 S XX=$$SETSTR^VALM1("POSTED",XX,19,6)
"RTN","RCDPELA1",404,0)
 S XX=$$SETSTR^VALM1("RECEIPT",XX,30,7)
"RTN","RCDPELA1",405,0)
 S XX=$$SETSTR^VALM1("USER",XX,43,4)
"RTN","RCDPELA1",406,0)
 S XX=$$SETSTR^VALM1("      AMOUNT",XX,50,12)
"RTN","RCDPELA1",407,0)
 S XX=$$SETSTR^VALM1("FMS DOC",XX,65,7)
"RTN","RCDPELA1",408,0)
 Q XX
"RTN","RCDPELA1",409,0)
 ;
"RTN","RCDPELAR")
0^29^B125782541^n/a
"RTN","RCDPELAR",1,0)
RCDPELAR ;EDE/FA - LIST ALL AUTO-POSTED RECEIPTS REPORT ;Nov 17, 2016
"RTN","RCDPELAR",2,0)
 ;;4.5;Accounts Receivable;**318**;Mar 20, 1995;Build 37
"RTN","RCDPELAR",3,0)
 ;Per VA Directive 6402, this routine should not be modified.
"RTN","RCDPELAR",4,0)
 ;
"RTN","RCDPELAR",5,0)
EN ; Main entry point
"RTN","RCDPELAR",6,0)
 N INPUT,RCVAUTD,XX,YY
"RTN","RCDPELAR",7,0)
 K ^TMP($J,"RCDPE_LAR"),^TMP("RCDPE_LAR",$J)
"RTN","RCDPELAR",8,0)
 K ^TMP("RCSELPAY",$J),^TMP($J,"SELPAYER")
"RTN","RCDPELAR",9,0)
 ;
"RTN","RCDPELAR",10,0)
 S INPUT=$$STADIV(.RCVAUTD)                     ; Division filter
"RTN","RCDPELAR",11,0)
 Q:'INPUT                                       ; '^' or timeout
"RTN","RCDPELAR",12,0)
 S $P(INPUT,"^",2)=$$APORERA()                  ; Filter by Auto-Post Date or ERA Date Received
"RTN","RCDPELAR",13,0)
 Q:'$P(INPUT,"^",2)                             ; '^' or timeout
"RTN","RCDPELAR",14,0)
 S $P(INPUT,"^",3)=$$DTRNG(0)                   ; Start Date|End date
"RTN","RCDPELAR",15,0)
 Q:'$P(INPUT,"^",3)                             ; '^' or timeout
"RTN","RCDPELAR",16,0)
 S $P(INPUT,"^",4)=$$SELERA()                   ; Select type of ERAS to be displayed
"RTN","RCDPELAR",17,0)
 Q:'$P(INPUT,"^",4)                             ; '^' or timeout
"RTN","RCDPELAR",18,0)
 S XX=+$$GETPAY^RCDPEM9(344.4,1,0)              ; Insurance Company filter
"RTN","RCDPELAR",19,0)
 S XX=$S(XX=-1:-1,XX=2:1,1:2)
"RTN","RCDPELAR",20,0)
 S $P(INPUT,"^",5)=XX                           ; Insurance Company filter
"RTN","RCDPELAR",21,0)
 Q:$P(INPUT,"^",5)<0                            ; '^' or timeout
"RTN","RCDPELAR",22,0)
 S XX=$P(INPUT,"^",2),YY=$P(INPUT,"^",4)
"RTN","RCDPELAR",23,0)
 S $P(INPUT,"^",6)=$$RPTSORT(XX,YY)             ; Select Secondary sort
"RTN","RCDPELAR",24,0)
 Q:'$P(INPUT,"^",6)                             ; '^' or timeout
"RTN","RCDPELAR",25,0)
 S $P(INPUT,"^",7)=$$ASKLM^RCDPEARL             ; Ask to Display in Listman Template
"RTN","RCDPELAR",26,0)
 Q:$P(INPUT,"^",7)<0                            ; '^' or timeout
"RTN","RCDPELAR",27,0)
 I $P(INPUT,"^",7)=1 D  Q                       ; Compile data and call listman to display
"RTN","RCDPELAR",28,0)
 . D LMOUT(INPUT,.RCVAUTD,.IO)
"RTN","RCDPELAR",29,0)
 S $P(INPUT,"^",8)=$$EXCEL()                    ; Ask to output to Excel
"RTN","RCDPELAR",30,0)
 Q:$P(INPUT,"^",8)=-1                           ; '^' or timeout
"RTN","RCDPELAR",31,0)
 D:$P(INPUT,"^",8)=1 INFO^RCDPEM6               ; Display capture information for Excel
"RTN","RCDPELAR",32,0)
 S $P(INPUT,"^",9)=$$DEVICE($P(INPUT,"^",8),.IO)    ; Ask output device
"RTN","RCDPELAR",33,0)
 Q:'$P(INPUT,"^",9)
"RTN","RCDPELAR",34,0)
 ;
"RTN","RCDPELAR",35,0)
 ; Option to queue
"RTN","RCDPELAR",36,0)
 I $D(IO("Q")) D  Q
"RTN","RCDPELAR",37,0)
 . N JOB S JOB=$J
"RTN","RCDPELAR",38,0)
 . N ZTDESC,ZTRTN,ZTSAVE,ZTSK
"RTN","RCDPELAR",39,0)
 . S ZTRTN="REPORT^RCDPELAR(INPUT,.RCVAUTD,.IO,JOB)"
"RTN","RCDPELAR",40,0)
 . S ZTDESC="LIST ALL AUTO-POSTED RECEIPTS REPORT"
"RTN","RCDPELAR",41,0)
 . M RCPYRSEL=^TMP("RCSELPAY",$J)
"RTN","RCDPELAR",42,0)
 . S ZTSAVE("RC*")="",ZTSAVE("VAUTD")="",ZTSAVE("IO*")=""
"RTN","RCDPELAR",43,0)
 . S ZTSAVE("INPUT")="",ZTSAVE("JOB")=""
"RTN","RCDPELAR",44,0)
 . D ^%ZTLOAD
"RTN","RCDPELAR",45,0)
 . W !!,$S($D(ZTSK):"Task number "_ZTSK_" was queued.",1:"Unable to queue this task.")
"RTN","RCDPELAR",46,0)
 . K ZTSK,IO("Q")
"RTN","RCDPELAR",47,0)
 . D HOME^%ZIS
"RTN","RCDPELAR",48,0)
 ;
"RTN","RCDPELAR",49,0)
 D REPORT(INPUT,.RCVAUTD,.IO)           ; Compile and Display Report data
"RTN","RCDPELAR",50,0)
 Q
"RTN","RCDPELAR",51,0)
 ;
"RTN","RCDPELAR",52,0)
LMOUT(INPUT,RCVAUTD,IO) ; Output report to Listman
"RTN","RCDPELAR",53,0)
 ; Input:   INPUT       - See REPORT for a complete description
"RTN","RCDPELAR",54,0)
 ;          RCVAUTD     -  Array of selected Divisions
"RTN","RCDPELAR",55,0)
 ;                         Only passed if A1=2
"RTN","RCDPELAR",56,0)
 ; Output:  ^TMP("RCDPE_LAR",$J,CTR)=Line - Array of display lines (no headers)
"RTN","RCDPELAR",57,0)
 ;                                           for output to Listman
"RTN","RCDPELAR",58,0)
 ;                                           Only set when A7-1
"RTN","RCDPELAR",59,0)
 N HDR
"RTN","RCDPELAR",60,0)
 S $P(INPUT,"^",9)=0                             ; Initial listman line counter
"RTN","RCDPELAR",61,0)
 D REPORT(INPUT,.RCVAUTD,.IO)                    ; Get the lines to be displayed
"RTN","RCDPELAR",62,0)
 S HDR("TITLE")="AUTO-POSTED RECEIPT REPORT"
"RTN","RCDPELAR",63,0)
 S HDR(1)=$$HDRLN2^RCDPELA1(INPUT)
"RTN","RCDPELAR",64,0)
 S HDR(2)=$$HDRLN3^RCDPELA1(INPUT)
"RTN","RCDPELAR",65,0)
 S HDR(3)=""
"RTN","RCDPELAR",66,0)
 S HDR(4)=""
"RTN","RCDPELAR",67,0)
 S HDR(5)="PAYER"
"RTN","RCDPELAR",68,0)
 S HDR(6)="        DATE      DATE"
"RTN","RCDPELAR",69,0)
 S HDR(7)=$$ERAHDR2^RCDPELA1()
"RTN","RCDPELAR",70,0)
 D LMRPT^RCDPEARL(.HDR,$NA(^TMP("RCDPE_LAR",$J))) ; Generate ListMan display
"RTN","RCDPELAR",71,0)
 ;
"RTN","RCDPELAR",72,0)
 D ^%ZISC                                       ; Close the device
"RTN","RCDPELAR",73,0)
 K ^TMP("RCDPE_LAR",$J),^TMP($J,"RCDPE_LAR")
"RTN","RCDPELAR",74,0)
 K ^TMP("RCSELPAY",$J),^TMP($J,"SELPAYER")
"RTN","RCDPELAR",75,0)
 Q
"RTN","RCDPELAR",76,0)
 ;
"RTN","RCDPELAR",77,0)
STADIV(RCVAUTD) ; Division/Station Filter
"RTN","RCDPELAR",78,0)
 ; Input:   None
"RTN","RCDPELAR",79,0)
 ; Output:  RCVAUTD     - Array of selected divisions, if 1 is returned
"RTN","RCDPELAR",80,0)
 ; Returns: 0           - User up-arrowed or timed out
"RTN","RCDPELAR",81,0)
 ;          1           - All divisions selected
"RTN","RCDPELAR",82,0)
 ;          2           - Selected Divisions
"RTN","RCDPELAR",83,0)
 N DIR,DIROUT,DIRUT,DTOUT,DUOUT,VAUTD,X,Y
"RTN","RCDPELAR",84,0)
 D DIVISION^VAUTOMA                         ; IA #664 allows this
"RTN","RCDPELAR",85,0)
 Q:Y<0 0                                    ; User up-arrowed or timed out
"RTN","RCDPELAR",86,0)
 Q:VAUTD=1 1                                ; All divisions selected
"RTN","RCDPELAR",87,0)
 M RCVAUTD=VAUTD                            ; Save selected divisions (if any)
"RTN","RCDPELAR",88,0)
 Q 2
"RTN","RCDPELAR",89,0)
 ;
"RTN","RCDPELAR",90,0)
APORERA() ; Ask the user if they want to filter by Auto-Post Date or ERA Date
"RTN","RCDPELAR",91,0)
 ; received
"RTN","RCDPELAR",92,0)
 ; Input:   None
"RTN","RCDPELAR",93,0)
 ; Returns: 0       - User up-arrowed or timed out
"RTN","RCDPELAR",94,0)
 ;          1       - Filter by Auto-Post date range
"RTN","RCDPELAR",95,0)
 ;          2       - Filter by ERA Date Received
"RTN","RCDPELAR",96,0)
 N DIR,DIROUT,DIRUT,DTOUT,DUOUT,X,Y
"RTN","RCDPELAR",97,0)
 S DIR("A")="(A)uto-Post Date or (E)RA Date Received? (A/E): "
"RTN","RCDPELAR",98,0)
 S DIR(0)="SA^A:Auto-Post Date;E:ERA Date Received"
"RTN","RCDPELAR",99,0)
 S DIR("?",1)="Enter 'A' to filter by an Auto-Post Date Range."
"RTN","RCDPELAR",100,0)
 S DIR("?")="Enter 'E' to filter by an ERA Date Received Date Range."
"RTN","RCDPELAR",101,0)
 S DIR("B")="A"
"RTN","RCDPELAR",102,0)
 D ^DIR
"RTN","RCDPELAR",103,0)
 I $D(DTOUT)!$D(DUOUT)!(Y="") Q 0
"RTN","RCDPELAR",104,0)
 Q:Y="A" 1
"RTN","RCDPELAR",105,0)
 Q 2
"RTN","RCDPELAR",106,0)
 ;
"RTN","RCDPELAR",107,0)
DTRNG(WHICH) ; Allows the user to select the Auto-Post OR ERA Received
"RTN","RCDPELAR",108,0)
 ; date range to be used
"RTN","RCDPELAR",109,0)
 ; Input:   WHICH   - 0 - Auto-Post Date Range
"RTN","RCDPELAR",110,0)
 ;                    1 - ERA Date Received Date Range
"RTN","RCDPELAR",111,0)
 ; Returns: 0       - User up-arrowed or timed out, 1 otherwise
"RTN","RCDPELAR",112,0)
 ;          A1^A2   - Where:
"RTN","RCDPELAR",113,0)
 ;                    A1 - Aut-Post Start Date
"RTN","RCDPELAR",114,0)
 ;                    A2 - Auto-Post End Date
"RTN","RCDPELAR",115,0)
 N DIR,DIROUT,DIRUT,DTOUT,DUOUT,RANGE,START,X,XX,Y
"RTN","RCDPELAR",116,0)
 S DIR(0)="DAO^:"_DT_":APE"
"RTN","RCDPELAR",117,0)
 S DIR("A")="Start Date: "
"RTN","RCDPELAR",118,0)
 S XX="Enter the earliest "_$S(WHICH=0:"Auto-Post date",1:"ERA Date Received")
"RTN","RCDPELAR",119,0)
 S XX=XX_" for receipts to include on the report"
"RTN","RCDPELAR",120,0)
 S DIR("?")=XX
"RTN","RCDPELAR",121,0)
 D ^DIR
"RTN","RCDPELAR",122,0)
 Q:$D(DTOUT)!$D(DUOUT)!(Y="") 0
"RTN","RCDPELAR",123,0)
 S START=Y
"RTN","RCDPELAR",124,0)
ENDDT ; Prompt for end date
"RTN","RCDPELAR",125,0)
 K DIR
"RTN","RCDPELAR",126,0)
 S DIR("B")=Y(0)
"RTN","RCDPELAR",127,0)
 S DIR(0)="DAO^"_START_":"_DT_":APE"
"RTN","RCDPELAR",128,0)
 S DIR("A")="End Date: "
"RTN","RCDPELAR",129,0)
 S XX="Enter the latest "_$S(WHICH=0:"Auto-Post date",1:"ERA Date Received")
"RTN","RCDPELAR",130,0)
 S XX=XX_" for receipts to include on the report"
"RTN","RCDPELAR",131,0)
 S DIR("?")=XX
"RTN","RCDPELAR",132,0)
 D ^DIR
"RTN","RCDPELAR",133,0)
 Q:$D(DTOUT)!$D(DUOUT)!(Y="") 0
"RTN","RCDPELAR",134,0)
 I Y<START D  G ENDDT
"RTN","RCDPELAR",135,0)
 . S XX=$$FMTE^XLFDT(START,"2ZD") ;****
"RTN","RCDPELAR",136,0)
 . W !,*7,"Enter an End date that is not less than "_XX
"RTN","RCDPELAR",137,0)
 S RANGE=START_"|"_Y
"RTN","RCDPELAR",138,0)
 Q RANGE
"RTN","RCDPELAR",139,0)
 ;
"RTN","RCDPELAR",140,0)
SELERA() ; Ask the user which types of ERA the want to see on the report
"RTN","RCDPELAR",141,0)
 ; Input:   None
"RTN","RCDPELAR",142,0)
 ; Returns: 0       - User up-arrowed or timed out
"RTN","RCDPELAR",143,0)
 ;          1       - Posted/Completed Receipts
"RTN","RCDPELAR",144,0)
 ;          2       - Only ERAs with Missing Receipts
"RTN","RCDPELAR",145,0)
 ;          3       - Both Posted/Completed and Missing Receipts
"RTN","RCDPELAR",146,0)
 N DIR,DIROUT,DIRUT,DTOUT,DUOUT,X,Y
"RTN","RCDPELAR",147,0)
 S DIR("A")="Select ERAs to be Displayed: "
"RTN","RCDPELAR",148,0)
 S DIR(0)="SA^1:Posted/Completed Receipts;2:Missing Receipts;3:Both"
"RTN","RCDPELAR",149,0)
 S DIR("B")="Both"
"RTN","RCDPELAR",150,0)
 S DIR("?",1)="Enter 1 to only display Posted Receipts."
"RTN","RCDPELAR",151,0)
 S DIR("?",2)="Enter 2 to only display ERAs with missing receipts."
"RTN","RCDPELAR",152,0)
 S DIR("?")="Enter 3 to display all receipts."
"RTN","RCDPELAR",153,0)
 D ^DIR
"RTN","RCDPELAR",154,0)
 I $D(DTOUT)!$D(DUOUT)!(Y="") Q 0
"RTN","RCDPELAR",155,0)
 Q Y
"RTN","RCDPELAR",156,0)
 ;
"RTN","RCDPELAR",157,0)
RPTSORT(WHICH,ERASEL) ; Ask the user how they want to sort the data
"RTN","RCDPELAR",158,0)
 ; Input:   WHICH   - 1- Filtering by Auto-Post Date
"RTN","RCDPELAR",159,0)
 ;                    2 - Filtering by ERA Date Received 
"RTN","RCDPELAR",160,0)
 ;          ERASEL  - ERA Filter          
"RTN","RCDPELAR",161,0)
 ;                    1 - Posted/Completed Receipts
"RTN","RCDPELAR",162,0)
 ;                    2 - Only ERAs with Missing Receipts
"RTN","RCDPELAR",163,0)
 ;                    3 - Both Posted/Completed and Missing Receipts
"RTN","RCDPELAR",164,0)
 ; Returns: 0       - User up-arrowed or timed out
"RTN","RCDPELAR",165,0)
 ;          1       - Auto-Post Date sort
"RTN","RCDPELAR",166,0)
 ;          2       - Missing Receipts
"RTN","RCDPELAR",167,0)
 N DIR,DIROUT,DIRUT,DTOUT,DUOUT,X,XX,Y
"RTN","RCDPELAR",168,0)
 ;
"RTN","RCDPELAR",169,0)
 ; If the user is only showing Posted/Completed Receipts OR 
"RTN","RCDPELAR",170,0)
 ; Missing Receipts then the only possible sort value is by date
"RTN","RCDPELAR",171,0)
 I ERASEL'=3 Q 1
"RTN","RCDPELAR",172,0)
 S DIR("A")="Sort by (D)ate or (M)issing Receipts: "
"RTN","RCDPELAR",173,0)
 S DIR(0)="SA^D:Date;M:Missing Receipts"
"RTN","RCDPELAR",174,0)
 S DIR("B")="D"
"RTN","RCDPELAR",175,0)
 S XX=$S(WHICH=1:"Auto-Post date.",1:"ERA Date Received.")
"RTN","RCDPELAR",176,0)
 S DIR("?",1)="Enter 'D' to sort by "_XX
"RTN","RCDPELAR",177,0)
 S DIR("?")="Enter 'M' to display Missing Receipts first."
"RTN","RCDPELAR",178,0)
 D ^DIR
"RTN","RCDPELAR",179,0)
 I $D(DTOUT)!$D(DUOUT)!(Y="") Q 0
"RTN","RCDPELAR",180,0)
 S XX=$S(Y="D":1,Y="P":2,1:3)
"RTN","RCDPELAR",181,0)
 Q XX
"RTN","RCDPELAR",182,0)
 ;
"RTN","RCDPELAR",183,0)
EXCEL() ; Ask the user if they want to export to Excel
"RTN","RCDPELAR",184,0)
 ; Input:   None
"RTN","RCDPELAR",185,0)
 ; Returns: -1      - User up-arrowed or timed out
"RTN","RCDPELAR",186,0)
 ;           0      - Output to paper
"RTN","RCDPELAR",187,0)
 ;           1      - Output to Excel
"RTN","RCDPELAR",188,0)
 N DIR,DIROUT,DIRUT,DTOUT,DUOUT,X,Y
"RTN","RCDPELAR",189,0)
 S DIR(0)="Y"
"RTN","RCDPELAR",190,0)
 S DIR("A")="Export the report to Microsoft Excel"
"RTN","RCDPELAR",191,0)
 S DIR("B")="NO"
"RTN","RCDPELAR",192,0)
 S DIR("?")="Enter 'YES' to output to Excel. Otherwise enter 'NO'"
"RTN","RCDPELAR",193,0)
 D ^DIR
"RTN","RCDPELAR",194,0)
 I $G(DUOUT) Q -1
"RTN","RCDPELAR",195,0)
 Q Y
"RTN","RCDPELAR",196,0)
 ;
"RTN","RCDPELAR",197,0)
DEVICE(EXCEL,IO) ; Select the output device
"RTN","RCDPELAR",198,0)
 ; Input:   EXCEL   - 1 - Ouput to Excel, 0 otherwise
"RTN","RCDPELAR",199,0)
 ; Output:  %ZIS    - Selected device
"RTN","RCDPELAR",200,0)
 ;          IO      - Array of selected output info
"RTN","RCDPELAR",201,0)
 ; Returns: 0       - No device selected, 1 otherwise
"RTN","RCDPELAR",202,0)
 N POP,RCPYRSEL,%ZIS
"RTN","RCDPELAR",203,0)
 S %ZIS="QM"
"RTN","RCDPELAR",204,0)
 D ^%ZIS
"RTN","RCDPELAR",205,0)
 Q:POP 0
"RTN","RCDPELAR",206,0)
 Q:EXCEL 1                  ; Output to Excel, no queueing
"RTN","RCDPELAR",207,0)
 ;
"RTN","RCDPELAR",208,0)
 Q 1
"RTN","RCDPELAR",209,0)
 ;
"RTN","RCDPELAR",210,0)
REPORT(INPUT,RCVAUTD,IO,JOB) ; Compile and run the report
"RTN","RCDPELAR",211,0)
 ; Expects ZTQUEUED to be defined already if queued
"RTN","RCDPELAR",212,0)
 ; Input:   INPUT   - A1^A2^A3^...^An Where:
"RTN","RCDPELAR",213,0)
 ;                       A1 - 1 - All divisions selected
"RTN","RCDPELAR",214,0)
 ;                            2 - Selected divisions
"RTN","RCDPELAR",215,0)
 ;                       A2 - 1 - Filter by Auto-Post date range
"RTN","RCDPELAR",216,0)
 ;                            2 - Filter by ERA Date Received date range
"RTN","RCDPELAR",217,0)
 ;                       A3 - B1|B2   - Where:
"RTN","RCDPELAR",218,0)
 ;                             B1 - ERA Date Received Start Date if A2=2
"RTN","RCDPELAR",219,0)
 ;                                  Auto-Post Start Date of A2=1
"RTN","RCDPELAR",220,0)
 ;                             B2 - ERA Date Received End Date if A2=2
"RTN","RCDPELAR",221,0)
 ;                                  Auto-Post End Date of A2=1
"RTN","RCDPELAR",222,0)
 ;                       A4 - 1 - Posted/Completed Receipts
"RTN","RCDPELAR",223,0)
 ;                            2 - Only ERAs with Missing Receipts
"RTN","RCDPELAR",224,0)
 ;                            3 - Both Posted/Completed and Missing Receipts
"RTN","RCDPELAR",225,0)
 ;                       A5 - 1 - All insurance companies selected
"RTN","RCDPELAR",226,0)
 ;                            2 - Selected insurance companies chosen
"RTN","RCDPELAR",227,0)
 ;                       A6 - 1 - Auto-Post Date/ERA Date Received Sort
"RTN","RCDPELAR",228,0)
 ;                            2 - Payer sort
"RTN","RCDPELAR",229,0)
 ;                            3 - Missing Receipts
"RTN","RCDPELAR",230,0)
 ;                       A7 - 0 - Do not display in a listman template
"RTN","RCDPELAR",231,0)
 ;                            1 - Display in a listman template
"RTN","RCDPELAR",232,0)
 ;                       A8 - 0 - Output to paper
"RTN","RCDPELAR",233,0)
 ;                            1 - Output to Excel
"RTN","RCDPELAR",234,0)
 ;                       A9 - Line counter for Listman output  
"RTN","RCDPELAR",235,0)
 ;           RCVAUTD -  Array of selected Divisions
"RTN","RCDPELAR",236,0)
 ;                      Only passed if A1=2
"RTN","RCDPELAR",237,0)
 ;           IO      - Interface device
"RTN","RCDPELAR",238,0)
 ;           JOB     - $J (optional, only passed in when report is queued)
"RTN","RCDPELAR",239,0)
 ;           ^TMP("RCSELPAY",$J)- Global Array of selected insurance companies
"RTN","RCDPELAR",240,0)
 ; Output:   ^TMP("RCDPE_LAR",$J,CTR)=Line - Array of display lines (no headers)
"RTN","RCDPELAR",241,0)
 ;                                           for output to Listman
"RTN","RCDPELAR",242,0)
 ;                                           Only set when A7-1
"RTN","RCDPELAR",243,0)
 N CURDT,DIVFLT,DTEND,DTSTART,ERAFILT,WHICH,XX,SORT,STOP
"RTN","RCDPELAR",244,0)
 K ^TMP("RCDPE_LAR",$J),^TMP($J,"RCDPE_LAR")
"RTN","RCDPELAR",245,0)
 I '$G(JOB) S JOB=""
"RTN","RCDPELAR",246,0)
 U IO
"RTN","RCDPELAR",247,0)
 D PAYERS(JOB)                              ; Rearrange payer global for easier use
"RTN","RCDPELAR",248,0)
 S DIVFLT=$P(INPUT,"^",1)                   ; Division filter
"RTN","RCDPELAR",249,0)
 S WHICH=$P(INPUT,"^",2)                    ; 1 - Auto-Post date, 2 - ERA Date Received
"RTN","RCDPELAR",250,0)
 S SORT=$P(INPUT,"^",6)                     ; Type of secondary sort
"RTN","RCDPELAR",251,0)
 S DTEND=$P($P(INPUT,"^",3),"|",2)_".9999"  ; End of Date Range
"RTN","RCDPELAR",252,0)
 S DTSTART=$P($P(INPUT,"^",3),"|",1)        ; End of Date Range
"RTN","RCDPELAR",253,0)
 S ERAFILT=$P(INPUT,"^",4)                  ; ERA Filter
"RTN","RCDPELAR",254,0)
 ;
"RTN","RCDPELAR",255,0)
 ; First filter and sort the report
"RTN","RCDPELAR",256,0)
 S CURDT=DTSTART-1
"RTN","RCDPELAR",257,0)
 F  D  Q:'CURDT  Q:CURDT>(DTEND)
"RTN","RCDPELAR",258,0)
 . S:WHICH=1 CURDT=$O(^RCY(344.4,"F",CURDT))
"RTN","RCDPELAR",259,0)
 . S:WHICH=2 CURDT=$O(^RCY(344.4,"AFD",CURDT))
"RTN","RCDPELAR",260,0)
 . Q:'CURDT
"RTN","RCDPELAR",261,0)
 . Q:CURDT>(DTEND)
"RTN","RCDPELAR",262,0)
 . I WHICH=2 D RPTE(DIVFLT,CURDT,SORT,ERAFILT,.RCVAUTD) Q
"RTN","RCDPELAR",263,0)
 . D RPTA(DIVFLT,CURDT,SORT,ERAFILT,.RCVAUTD)
"RTN","RCDPELAR",264,0)
 ;
"RTN","RCDPELAR",265,0)
 D RPTOUT^RCDPELA1(INPUT)                ; Output the report
"RTN","RCDPELAR",266,0)
 ;
"RTN","RCDPELAR",267,0)
 ; Quit if Listman - clean up of ^TMP & device is handled in LMOUT^RCDPELAR
"RTN","RCDPELAR",268,0)
 I $P(INPUT,"^",7)=1 Q
"RTN","RCDPELAR",269,0)
 ;
"RTN","RCDPELAR",270,0)
 ; Close device
"RTN","RCDPELAR",271,0)
 I '$D(ZTQUEUED) D ^%ZISC
"RTN","RCDPELAR",272,0)
 I $D(ZTQUEUED) S ZTREQ="@"
"RTN","RCDPELAR",273,0)
 K ^TMP("RCDPE_LAR",$J),^TMP($J,"RCDPE_LAR")
"RTN","RCDPELAR",274,0)
 K ^TMP("RCSELPAY",$J),^TMP($J,"SELPAYER")
"RTN","RCDPELAR",275,0)
 K ZTQUEUED
"RTN","RCDPELAR",276,0)
 Q
"RTN","RCDPELAR",277,0)
 ;
"RTN","RCDPELAR",278,0)
PAYERS(JOB) ; Rearrange payer global for easier use
"RTN","RCDPELAR",279,0)
 ; Input:   ^TMP("RCSELPAY",$J,nn)=Payer Name - Global Array of selected
"RTN","RCDPELAR",280,0)
 ;                                              insurance companies
"RTN","RCDPELAR",281,0)
 ; Output   ^TMP($J,"SELPAYER",Payer Name)="" - Global Array of selected
"RTN","RCDPELAR",282,0)
 ;                                    insurance rearranged for easier checks
"RTN","RCDPELAR",283,0)
 I JOB="" S JOB=$J
"RTN","RCDPELAR",284,0)
 N PAYER,XX
"RTN","RCDPELAR",285,0)
 K ^TMP($J,"SELPAYER")
"RTN","RCDPELAR",286,0)
 S XX=""
"RTN","RCDPELAR",287,0)
 F  D  Q:XX=""
"RTN","RCDPELAR",288,0)
 . S XX=$O(^TMP("RCSELPAY",JOB,XX))
"RTN","RCDPELAR",289,0)
 . Q:XX=""
"RTN","RCDPELAR",290,0)
 . S PAYER=$$UP^XLFSTR(^TMP("RCSELPAY",JOB,XX))
"RTN","RCDPELAR",291,0)
 . S ^TMP($J,"SELPAYER",PAYER)=""
"RTN","RCDPELAR",292,0)
 K ^TMP("RCSELPAY",JOB)
"RTN","RCDPELAR",293,0)
 Q
"RTN","RCDPELAR",294,0)
 ;
"RTN","RCDPELAR",295,0)
RPTE(DIVFLT,CURDT,SORT,ERAFILT,VAUTD) ; Use the ERA Date Received index and filter out
"RTN","RCDPELAR",296,0)
 ; divisions, payers that weren't selected
"RTN","RCDPELAR",297,0)
 ; Input:   DIVFLT              - 1 - All Divisions selected, 2 otherwise
"RTN","RCDPELAR",298,0)
 ;          CURDT               - Date being processed
"RTN","RCDPELAR",299,0)
 ;          SORT                - 1 - Auto-Post Date Sort
"RTN","RCDPELAR",300,0)
 ;                                2 - Missing Receipts
"RTN","RCDPELAR",301,0)
 ;          ERAFILT             - 1 - Posted/Completed Receipts
"RTN","RCDPELAR",302,0)
 ;                                2 - Only ERAs with Missing Receipts
"RTN","RCDPELAR",303,0)
 ;                                3 - Both Posted/Completed and Missing Receipts
"RTN","RCDPELAR",304,0)
 ;          VAUTD               - Array of selected divisions
"RTN","RCDPELAR",305,0)
 ;         ^TMP("RCSELPAY",$J)  - Global Array of selected insurance companies
"RTN","RCDPELAR",306,0)
 ; Output: ^TMP($J,A1,"SEL",A2,A3,A4,A5)="" - if record passed filters Where:
"RTN","RCDPELAR",307,0)
 ;                                 A1 - "RCDPE_LAR"
"RTN","RCDPELAR",308,0)
 ;                                 A2 - Uppercased Payer Name (primary sort)
"RTN","RCDPELAR",309,0)
 ;                                 A3 - Secondary Sort Value
"RTN","RCDPELAR",310,0)
 ;                                 A4 - Internal IEN for file 344.4
"RTN","RCDPELAR",311,0)
 ;                                 A5 - Internal IEN for sub file 344.41
"RTN","RCDPELAR",312,0)
 N COMPLETE,IEN3444,IEN34441,IENS,PAYER,RECEIPT,SVAL,XX
"RTN","RCDPELAR",313,0)
 S IEN3444=0
"RTN","RCDPELAR",314,0)
 F  D  Q:'IEN3444
"RTN","RCDPELAR",315,0)
 . S IEN3444=$O(^RCY(344.4,"AFD",CURDT,IEN3444))
"RTN","RCDPELAR",316,0)
 . Q:'IEN3444
"RTN","RCDPELAR",317,0)
 . S PAYER=$$GET1^DIQ(344.4,IEN3444,.06,"I")            ; Payment From field
"RTN","RCDPELAR",318,0)
 . S PAYER=$$UP^XLFSTR(PAYER)
"RTN","RCDPELAR",319,0)
 . Q:'$D(^TMP($J,"SELPAYER",PAYER))                     ; Not a selected payer
"RTN","RCDPELAR",320,0)
 . I DIVFLT'=1 Q:'$$CHKDIV^RCDPEDAR(IEN3444,1,.VAUTD)   ; Not a selected Division
"RTN","RCDPELAR",321,0)
 . S XX=$$GET1^DIQ(344.4,IEN3444,4.01,"I")              ; Auto-Post date on ERA
"RTN","RCDPELAR",322,0)
 . Q:'XX                                                ; skip if not auto-posted ERA
"RTN","RCDPELAR",323,0)
 . S COMPLETE=$$COMPLETE(IEN3444)                       ; Check for missing receipts
"RTN","RCDPELAR",324,0)
 . I ERAFILT=1,'COMPLETE Q                              ; Missing Receipt
"RTN","RCDPELAR",325,0)
 . I ERAFILT=2,COMPLETE Q                               ; Not a Missing Receipt
"RTN","RCDPELAR",326,0)
 . ;
"RTN","RCDPELAR",327,0)
 . ; Just showing missing receipts and this ERA doesn't have any
"RTN","RCDPELAR",328,0)
 . I ERAFILT=2,COMPLETE Q
"RTN","RCDPELAR",329,0)
 . S IEN34441=0
"RTN","RCDPELAR",330,0)
 . F  D  Q:'IEN34441
"RTN","RCDPELAR",331,0)
 . . S IEN34441=$O(^RCY(344.4,IEN3444,1,IEN34441))
"RTN","RCDPELAR",332,0)
 . . Q:'IEN34441
"RTN","RCDPELAR",333,0)
 . . S IENS=IEN34441_","_IEN3444_","
"RTN","RCDPELAR",334,0)
 . . S SVAL=$S(SORT=1:CURDT,1:COMPLETE)                 ; Get the sort value
"RTN","RCDPELAR",335,0)
 . . S ^TMP($J,"RCDPE_LAR","SEL",PAYER,SVAL,IEN3444,IEN34441)=""
"RTN","RCDPELAR",336,0)
 Q
"RTN","RCDPELAR",337,0)
 ;
"RTN","RCDPELAR",338,0)
RPTA(DIVFLT,CURDT,SORT,ERAFILT,VAUTD) ; Use the Auto-Post Date index and filter out
"RTN","RCDPELAR",339,0)
 ; divisions, payers that weren't selected
"RTN","RCDPELAR",340,0)
 ; Input:   DIVFLT              - 1 - All Divisions selected, 2 otherwise
"RTN","RCDPELAR",341,0)
 ;          CURDT               - Date being processed
"RTN","RCDPELAR",342,0)
 ;          SORT                - 1 - Auto-Post Date Sort
"RTN","RCDPELAR",343,0)
 ;                                2 - Missing Receipts
"RTN","RCDPELAR",344,0)
 ;          ERAFILT             - 1 - Posted/Completed Receipts
"RTN","RCDPELAR",345,0)
 ;                                2 - Only ERAs with Missing Receipts
"RTN","RCDPELAR",346,0)
 ;                                3 - Both Posted/Completed and Missing Receipts
"RTN","RCDPELAR",347,0)
 ;          VAUTD               - Array of selected divisions
"RTN","RCDPELAR",348,0)
 ;         ^TMP("RCSELPAY",$J)  - Global Array of selected insurance companies
"RTN","RCDPELAR",349,0)
 ;         ^TMP($J,"RCDPE_LAR","ERA") - see output for definition
"RTN","RCDPELAR",350,0)
 ; Output: ^TMP($J,A1,"SEL",A2,A3,A4,A5)="" - if record passed filters Where:
"RTN","RCDPELAR",351,0)
 ;                                 A1 - "RCDPE_LAR"
"RTN","RCDPELAR",352,0)
 ;                                 A2 - Uppercased Payer Name (primary sort)
"RTN","RCDPELAR",353,0)
 ;                                 A3 - Secondary Sort Value
"RTN","RCDPELAR",354,0)
 ;                                 A4 - Internal IEN for file 344.4
"RTN","RCDPELAR",355,0)
 ;                                 A5 - Internal IEN for sub file 344.41
"RTN","RCDPELAR",356,0)
 ;        ^TMP($J,A1,"ERA",A2)="" - List of ERAs that were already pulled Where:
"RTN","RCDPELAR",357,0)
 ;                                 A1 - "RCDPE_LAR"
"RTN","RCDPELAR",358,0)
 ;                                 A2 - IEN of #344.4 (ERA #)
"RTN","RCDPELAR",359,0)
 ;
"RTN","RCDPELAR",360,0)
 N COMPLETE,IEN3444,IEN3441,PAYER,SVAL
"RTN","RCDPELAR",361,0)
 S IEN3444=0
"RTN","RCDPELAR",362,0)
 F  D  Q:'IEN3444
"RTN","RCDPELAR",363,0)
 . S IEN3444=$O(^RCY(344.4,"F",CURDT,IEN3444))
"RTN","RCDPELAR",364,0)
 . Q:'IEN3444
"RTN","RCDPELAR",365,0)
 . I DIVFLT'=1 Q:'$$CHKDIV^RCDPEDAR(IEN3444,1,.VAUTD)  ; Not a selected Division
"RTN","RCDPELAR",366,0)
 . S COMPLETE=$$COMPLETE(IEN3444)
"RTN","RCDPELAR",367,0)
 . I ERAFILT=1,'COMPLETE Q                             ; Missing Receipt
"RTN","RCDPELAR",368,0)
 . I ERAFILT=2,COMPLETE Q                              ; Not a Missing Receipt
"RTN","RCDPELAR",369,0)
 . S PAYER=$$GET1^DIQ(344.4,IEN3444,.06,"I")           ; Payment From field
"RTN","RCDPELAR",370,0)
 . S PAYER=$$UP^XLFSTR(PAYER)
"RTN","RCDPELAR",371,0)
 . Q:'$D(^TMP($J,"SELPAYER",PAYER))                    ; Not a selected payer
"RTN","RCDPELAR",372,0)
 . Q:$D(^TMP($J,"RCDPE_LAR","ERA",IEN3444))            ; Already pulled this ERA
"RTN","RCDPELAR",373,0)
 . ;
"RTN","RCDPELAR",374,0)
 . S ^TMP($J,"RCDPE_LAR","ERA",IEN3444)=""
"RTN","RCDPELAR",375,0)
 . S IEN34441=0
"RTN","RCDPELAR",376,0)
 . F  D  Q:'IEN34441
"RTN","RCDPELAR",377,0)
 . . S IEN34441=$O(^RCY(344.4,IEN3444,1,IEN34441))
"RTN","RCDPELAR",378,0)
 . . Q:'IEN34441
"RTN","RCDPELAR",379,0)
 . . S SVAL=$S(SORT=1:CURDT,1:COMPLETE)                ; Get the sort value
"RTN","RCDPELAR",380,0)
 . . S ^TMP($J,"RCDPE_LAR","SEL",PAYER,SVAL,IEN3444,IEN34441)=""
"RTN","RCDPELAR",381,0)
 Q
"RTN","RCDPELAR",382,0)
 ;
"RTN","RCDPELAR",383,0)
COMPLETE(IEN3444) ; Checks an ERA for missing receipts
"RTN","RCDPELAR",384,0)
 ; Input:   IEN3444   - ERA to be checked
"RTN","RCDPELAR",385,0)
 ; Returns: 0 if at least one detail line of the ERA has a missing receipt
"RTN","RCDPELAR",386,0)
 ;          1 otherwise
"RTN","RCDPELAR",387,0)
 N XX
"RTN","RCDPELAR",388,0)
 S XX=$$GET1^DIQ(344.4,IEN3444,4.02,"I")    ; Auto-Post Status field
"RTN","RCDPELAR",389,0)
 I XX=2 Q 1                                 ; Complete ERA
"RTN","RCDPELAR",390,0)
 Q 0
"RTN","RCDPELAR",391,0)
 ;
"RTN","RCDPELAR",392,0)
ASKSTOP() ; Ask to continue
"RTN","RCDPELAR",393,0)
 ; Input:   IOST    - Device Type 
"RTN","RCDPELAR",394,0)
 ; Returns: 1 - User wants to quit, 0 otherwise
"RTN","RCDPELAR",395,0)
 N DIR,DIROUT,DIRUT,DTOUT,DUOUT
"RTN","RCDPELAR",396,0)
 Q:$E(IOST,1,2)'["C-" 0                     ; Not a terminal
"RTN","RCDPELAR",397,0)
 S DIR(0)="E"
"RTN","RCDPELAR",398,0)
 W ! D ^DIR
"RTN","RCDPELAR",399,0)
 I ($D(DIRUT))!($D(DUOUT)) Q 1
"RTN","RCDPELAR",400,0)
 Q 0
"RTN","RCDPELAR",401,0)
 ;
"RTN","RCDPEM")
0^11^B62343432^B61473456
"RTN","RCDPEM",1,0)
RCDPEM ;ALB/TMK/PJH - POST EFT, ERA MATCHING TO EFT ;Jun 06, 2014@19:11:19
"RTN","RCDPEM",2,0)
 ;;4.5;Accounts Receivable;**173,255,269,276,283,298,304,318**;Mar 20, 1995;Build 37
"RTN","RCDPEM",3,0)
 ;Per VA Directive 6402, this routine should not be modified.
"RTN","RCDPEM",4,0)
 ; IA 4050 covers call to SPL1^IBCEOBAR
"RTN","RCDPEM",5,0)
 ; Note - keep processing in line with RCDPXPAP 
"RTN","RCDPEM",6,0)
EN ; Post EFT deposits, auto-match EFT's and ERA's 
"RTN","RCDPEM",7,0)
 ;
"RTN","RCDPEM",8,0)
 K ^TMP($J,"RCDPETOT"),^TMP("RCDPEAP",$J)
"RTN","RCDPEM",9,0)
 ; ^TMP($J,"RCDPETOT",344.3 or 344.31,file ien)=
"RTN","RCDPEM",10,0)
 ;  (1) match (0/1/-1)   (2) total $   (3) posted (0/1)  (4) error ref
"RTN","RCDPEM",11,0)
 ;  (5) EFT deposit ien 344.1 if added for EFT
"RTN","RCDPEM",12,0)
 ;
"RTN","RCDPEM",13,0)
 N RCZ,RCSUM,RCDEP,RECTDA,RC0,RCER,RCDUZ,Z,Z0,Z1,DA,X,Y,DIE,DR
"RTN","RCDPEM",14,0)
 M RCDUZ=DUZ
"RTN","RCDPEM",15,0)
 N DUZ S DUZ=+$O(^VA(200,"B","EDILOCKBOX,AUTOMATIC",0)),DUZ(0)="" S:'DUZ DUZ=.5
"RTN","RCDPEM",16,0)
 K ^TMP($J,"RCXM"),^TMP($J,"RCTOT")
"RTN","RCDPEM",17,0)
 S ZTREQ="@"
"RTN","RCDPEM",18,0)
 L +^RCY(344.3,"ALOCK"):5 I '$T D  G ENQ ; Lock record
"RTN","RCDPEM",19,0)
 . ; Send bulletin that job could not be run
"RTN","RCDPEM",20,0)
 . S ^TMP($J,"RCXM",1)="The nightly job to post EFT deposits and match EFTs to ERAs could not be run",^TMP($J,"RCXM",2)="Another match process was already running (lock on ^RCY(344.3,""ALOCK"") )"
"RTN","RCDPEM",21,0)
 . D SENDBULL^RCDPEM1
"RTN","RCDPEM",22,0)
 ;
"RTN","RCDPEM",23,0)
 ; Post deposits for any unposted EFTs in file 344.3
"RTN","RCDPEM",24,0)
 ; 'Unposted' EFTs have a 0 in AMOUNT POSTED field
"RTN","RCDPEM",25,0)
 S ^TMP($J,"RCTOT","EFT_DEP")=0
"RTN","RCDPEM",26,0)
 S RCZ=0 F  S RCZ=$O(^RCY(344.3,"APOST",0,RCZ)) Q:'RCZ  S RC0=$G(^RCY(344.3,RCZ,0))  I RC0'="",$P(RC0,U,8) D
"RTN","RCDPEM",27,0)
 . S ^TMP($J,"RCTOT","EFT_DEP")=^TMP($J,"RCTOT","EFT_DEP")+1
"RTN","RCDPEM",28,0)
 . ; Verify check sums
"RTN","RCDPEM",29,0)
 . S RCSUM=$$CHKSUM^RCDPESR3(RCZ)
"RTN","RCDPEM",30,0)
 . I RCSUM'=$P(RC0,U,9) D  Q
"RTN","RCDPEM",31,0)
 .. ; Bulletin that check sums do not match
"RTN","RCDPEM",32,0)
 .. ; Update record error list and checksum error field
"RTN","RCDPEM",33,0)
 .. S RCER(1)=$$SETERR^RCDPEM0(2)
"RTN","RCDPEM",34,0)
 .. S RCER(2)="  Checksum is invalid and the EFT deposit record is corrupted.",RCER(3)="  Stored Checksum = "_$P(RC0,U,9)_" Calculated Checksum: "_RCSUM,RCER(4)="  This EFT deposit cannot be sent to FMS.  You must ask for it to be"
"RTN","RCDPEM",35,0)
 .. S RCER(5)="   retransmitted to your site."
"RTN","RCDPEM",36,0)
 .. D BULL^RCDPEM1(344.3,RC0,.RCER)
"RTN","RCDPEM",37,0)
 .. S $P(^TMP($J,"RCDPETOT",344.3,RCZ),U,4)=+$G(^TMP($J,"RCXM",0))
"RTN","RCDPEM",38,0)
 .. D STORERR^RCDPEM0(RCZ,.RCER)
"RTN","RCDPEM",39,0)
 .. S DIE="^RCY(344.3,",DA=RCZ,DR=".1////1" D ^DIE
"RTN","RCDPEM",40,0)
 .. S ^TMP($J,"RCTOT","CSUM")=$G(^TMP($J,"RCTOT","CSUM"))+1
"RTN","RCDPEM",41,0)
 . ;
"RTN","RCDPEM",42,0)
 . S RCDEP=+$P(RC0,U,3),RECTDA=+$O(^RCY(344,"AD",RCDEP,0))
"RTN","RCDPEM",43,0)
 . I RCDEP D LOCKDEP(RCDEP,1)
"RTN","RCDPEM",44,0)
 . I 'RCDEP!'RECTDA D  ;  Add deposit and/or receipt to files 344.1, 344
"RTN","RCDPEM",45,0)
 .. I 'RCDEP D  ; Add dep record RCDEP, update field .03 with the pointer
"RTN","RCDPEM",46,0)
 ... S RCDEP=+$$ADDDEP^RCDPEM0($P(RC0,U,6),$P(RC0,U,7),RCZ)
"RTN","RCDPEM",47,0)
 ... S ^TMP($J,"RCTOT","DEPOSIT")=$G(^TMP($J,"RCTOT","DEPOSIT"))+1
"RTN","RCDPEM",48,0)
 .. ;
"RTN","RCDPEM",49,0)
 .. I 'RECTDA,RCDEP D  ; Add receipt record, post to rev source cd 8NZZ
"RTN","RCDPEM",50,0)
 ... S RECTDA=+$$ADDREC^RCDPEM0(RCDEP,RCZ)
"RTN","RCDPEM",51,0)
 .. ;
"RTN","RCDPEM",52,0)
 . I RCDEP D LOCKDEP(RCDEP,0)
"RTN","RCDPEM",53,0)
 . ;
"RTN","RCDPEM",54,0)
 . I 'RCDEP!'RECTDA D  Q  ; Could not add entry to file 344.1 or 344 
"RTN","RCDPEM",55,0)
 .. ; Send a bulletin, update error text
"RTN","RCDPEM",56,0)
 .. S RCER(1)=$$SETERR^RCDPEM0(2),RCER(2)="  "_$S('RCDEP:"Neither a deposit nor a receipt were able",1:"A receipt was not able")_" to be added - no match attempted"
"RTN","RCDPEM",57,0)
 .. I RCDEP,'RECTDA S RCER(3)="  Deposit Ticket # created: "_$P($G(^RCY(344.1,+$P(RC0,U,3),0)),U)
"RTN","RCDPEM",58,0)
 .. S RCER($O(RCER(""),-1)+1)="This EFT deposit can't be sent to FMS.  You must ask Austin to retransmit"
"RTN","RCDPEM",59,0)
 .. D BULL^RCDPEM1(344.3,RC0,.RCER)
"RTN","RCDPEM",60,0)
 .. S $P(^TMP($J,"RCDPETOT",344.3,RCZ),U,4)=+$G(^TMP($J,"RCXM",0))
"RTN","RCDPEM",61,0)
 .. D STORERR^RCDPEM0(RCZ,.RCER)
"RTN","RCDPEM",62,0)
 .. S ^TMP($J,"RCTOT","ERR")=$G(^TMP($J,"RCTOT","ERR"))+1
"RTN","RCDPEM",63,0)
 . ;
"RTN","RCDPEM",64,0)
 . S DIE="^RCY(344.31," S Z=0 F  S Z=$O(^RCY(344.31,"B",RCZ,Z)) Q:'Z  S DA=Z,DR=".11////1" D ^DIE
"RTN","RCDPEM",65,0)
 ;
"RTN","RCDPEM",66,0)
 ;Update payer table for new payers - PRCA*4.5*298
"RTN","RCDPEM",67,0)
 D NEWPYR^RCDPESP
"RTN","RCDPEM",68,0)
 ;Scan Non-Released Rx Exceptions for released Rx - PRCA*4.5*298
"RTN","RCDPEM",69,0)
 D EN^RCDPEX4
"RTN","RCDPEM",70,0)
 ;
"RTN","RCDPEM",71,0)
 D MATCH(0,1)
"RTN","RCDPEM",72,0)
 ;
"RTN","RCDPEM",73,0)
 ;Auto Post - PRCA*4.5*298
"RTN","RCDPEM",74,0)
 D EN^RCDPEAP
"RTN","RCDPEM",75,0)
 ;Auto Decrease - PRCA*4.5*298
"RTN","RCDPEM",76,0)
 D EN^RCDPEAD
"RTN","RCDPEM",77,0)
 ;
"RTN","RCDPEM",78,0)
 L -^RCY(344.3,"ALOCK")
"RTN","RCDPEM",79,0)
ENQ K ^TMP($J,"RCDPETOT"),^TMP("RCDPEAP",$J)
"RTN","RCDPEM",80,0)
 ;
"RTN","RCDPEM",81,0)
 ;ePayments 5010 part II enhancements
"RTN","RCDPEM",82,0)
 ;Create Bulletins of EEOB Moved or Copied today
"RTN","RCDPEM",83,0)
 D EN^RCDPEM8
"RTN","RCDPEM",84,0)
 Q
"RTN","RCDPEM",85,0)
 ;
"RTN","RCDPEM",86,0)
MATCH(RCMAN,RCPROC) ; match unmatched EFTs with ERAs
"RTN","RCDPEM",87,0)
 ; RCMAN = 1 if job run manually, outside of nightly processing
"RTN","RCDPEM",88,0)
 ; RCPROC = 1 if called from EFT-EOB automatch, 0 if from manual match
"RTN","RCDPEM",89,0)
 ;
"RTN","RCDPEM",90,0)
 N RC0,RCER,RCZ,RCHAC
"RTN","RCDPEM",91,0)
 I '$O(^RCY(344.31,"AMATCH",0,0)) D  G MATCHQ
"RTN","RCDPEM",92,0)
 . ; Send bulletin - no unmatched EFTs found
"RTN","RCDPEM",93,0)
 . N RCT
"RTN","RCDPEM",94,0)
 . S RCT=+$O(^TMP($J,"RCXM"," "),-1)+1
"RTN","RCDPEM",95,0)
 . S ^TMP($J,"RCXM",RCT)=$S('$G(RCMAN):"The nightly job",1:"The manual option")_" to match EFTs has found no EFTs are currently unmatched on your system"
"RTN","RCDPEM",96,0)
 . I $G(RCMAN) S ^TMP($J,"RCXM",RCT+1)="The action was initiated by "_$P($G(^VA(200,DUZ,0)),U)
"RTN","RCDPEM",97,0)
 . D SENDBULL^RCDPEM1
"RTN","RCDPEM",98,0)
 ;
"RTN","RCDPEM",99,0)
 S RCZ=0 F  S RCZ=$O(^RCY(344.31,"AMATCH",0,RCZ)) Q:'RCZ  D
"RTN","RCDPEM",100,0)
 . K RCER
"RTN","RCDPEM",101,0)
 . S RC0=$G(^RCY(344.31,RCZ,0)),RCHAC=($E($P($G(^RCY(344.3,+RC0,0)),U,6),1,3)="HAC")
"RTN","RCDPEM",102,0)
 . Q:RC0=""  ; Bad xref
"RTN","RCDPEM",103,0)
 . Q:$S('RCHAC:'$P(RC0,U,11),1:0)  ; EFT deposit must have been recorded
"RTN","RCDPEM",104,0)
 . S ^TMP($J,"RCTOT","EFT")=$G(^TMP($J,"RCTOT","EFT"))+1
"RTN","RCDPEM",105,0)
 . I RCHAC S ^TMP($J,"RCTOT","EFT_HAC")=$G(^TMP($J,"RCTOT","EFT_HAC"))+1
"RTN","RCDPEM",106,0)
 . S ^TMP($J,"RCDPETOT",344.31,RCZ)=""
"RTN","RCDPEM",107,0)
 . ;
"RTN","RCDPEM",108,0)
 . D MATCH^RCDPEM0(RCZ,RCPROC)
"RTN","RCDPEM",109,0)
 ;
"RTN","RCDPEM",110,0)
 I '$O(^TMP($J,"RCXM",0)) K RCER S RCER(1)="",RCER(2)="NO EXCEPTIONS WHILE MATCHING EFTs-ERAs OR IN RECORDING THE DEPOSITS TO FMS" D BULL^RCDPEM1("","",.RCER) K RCER
"RTN","RCDPEM",111,0)
 D EN2^RCDPEM1,BULL^RCDPEM1("","",.RCER)
"RTN","RCDPEM",112,0)
 D SENDBULL^RCDPEM1
"RTN","RCDPEM",113,0)
 ;
"RTN","RCDPEM",114,0)
MATCHQ K ^TMP($J,"RCDPETOT"),^TMP($J,"RCTOT")
"RTN","RCDPEM",115,0)
 Q
"RTN","RCDPEM",116,0)
 ;
"RTN","RCDPEM",117,0)
LOCKDEP(RCDEP,LOCK) ; Lock/confirm deposit ien RCDEP file 341.1
"RTN","RCDPEM",118,0)
 ; If LOCK = 1 lock deposit
"RTN","RCDPEM",119,0)
 ; If LOCK = 0 unlock deposit
"RTN","RCDPEM",120,0)
 I $G(LOCK) D
"RTN","RCDPEM",121,0)
 . L +^RCY(344.1,RCDEP,0):DILOCKTM
"RTN","RCDPEM",122,0)
 . D CONFIRM^RCDPUDEP(RCDEP) ; confirm to prevent changes
"RTN","RCDPEM",123,0)
 I '$G(LOCK) L -^RCY(344.1,RCDEP,0)
"RTN","RCDPEM",124,0)
 Q
"RTN","RCDPEM",125,0)
 ;
"RTN","RCDPEM",126,0)
RCPTDET(RCRZ,RECTDA1,RCER) ; Adds detail to a receipt based on file 344.49
"RTN","RCDPEM",127,0)
 ; RCRZ = ien of ERA entry in file 344.49
"RTN","RCDPEM",128,0)
 ; RECTDA1 = ien of receipt entry in file 344
"RTN","RCDPEM",129,0)
 ; RCER = error array returned if passed by reference
"RTN","RCDPEM",130,0)
 ;
"RTN","RCDPEM",131,0)
 N DA,DIE,DR,Q,RCR,RCSPL,RCZ0,RCTRANDA,RCQ,X,Y,Z0,Z1,Z ; PRCA*4.5*318
"RTN","RCDPEM",132,0)
 ;
"RTN","RCDPEM",133,0)
 S RCR=0 F  S RCR=$O(^RCY(344.49,RCRZ,1,RCR)) Q:'RCR  D
"RTN","RCDPEM",134,0)
 . S RCZ0=$G(^RCY(344.49,RCRZ,1,RCR,0))
"RTN","RCDPEM",135,0)
 . I $P(RCZ0,U)'["." S RCSPL(+RCZ0)=$P(RCZ0,U,9) Q
"RTN","RCDPEM",136,0)
 . I $S(+$P(RCZ0,U,3)=0:$P($G(^RCY(344.49,RCRZ,0)),U,3),1:$P(RCZ0,U,3)<0) S RCSPL(RCZ0\1,+RCZ0)=RCZ0 Q
"RTN","RCDPEM",137,0)
 . S RCTRANDA=$$ADDTRAN^RCDPURET(RECTDA1)
"RTN","RCDPEM",138,0)
 . ;
"RTN","RCDPEM",139,0)
 . I RCTRANDA'>0 D  Q  ; Error adding receipt detail - PRCA*4.5*318
"RTN","RCDPEM",140,0)
 .. S RCER(1)=$$SETERR^RCDPEM0(1) ; PRCA*4.5*318 - pass RCPROC value to $$SETERR
"RTN","RCDPEM",141,0)
 .. S RCER($O(RCER(""),-1)+1)="  NO DETAIL LINE ADDED TO RECEIPT "_$P($G(^RCY(344,RECTDA1,0)),U)_" FOR LINE #"_$P(RCZ0,U)_" IN EEOB WORKLIST SCRATCH PAD"
"RTN","RCDPEM",142,0)
 . ;
"RTN","RCDPEM",143,0)
 . ;Store receipt line detail
"RTN","RCDPEM",144,0)
 . D DET(RCRZ,RCR,RECTDA1,RCTRANDA)
"RTN","RCDPEM",145,0)
 . S RCSPL(RCZ0\1,+RCZ0)=RCZ0
"RTN","RCDPEM",146,0)
 S Z=0 F  S Z=$O(RCSPL(Z)) Q:'Z  S RCQ=+$G(RCSPL(Z)) I RCQ D
"RTN","RCDPEM",147,0)
 .;;Move EEOB if one claim entered-changed 10/19/11-see +25^RCDPEWL8
"RTN","RCDPEM",148,0)
 . S Z1=$O(RCSPL(Z,"")) Q:Z1=""
"RTN","RCDPEM",149,0)
 . I $O(RCSPL(Z,""),-1)=Z1,'$$SPLIT(Z,Z1,RCERA) Q  ; No split occurred
"RTN","RCDPEM",150,0)
 . S Z1=0 F  S Z1=$O(RCSPL(Z,Z1)) Q:'Z1  S Z0=$G(RCSPL(Z,Z1)) D
"RTN","RCDPEM",151,0)
 .. S Q=+$P($G(^RCY(344.4,RCRZ,1,RCQ,0)),U,2) ; EOB detail rec
"RTN","RCDPEM",152,0)
 .. Q:'Q
"RTN","RCDPEM",153,0)
 .. I '$P(Z0,U,7)!($P(Z0,U,2)="") D  ; Suspensed
"RTN","RCDPEM",154,0)
 ... D SPL1^IBCEOBAR(Q,$S($P(Z0,U,2)="":"NO BILL",1:$P(Z0,U,2)),"",$P(Z0,U,6)) ; IA 4050
"RTN","RCDPEM",155,0)
 .. E  D
"RTN","RCDPEM",156,0)
 ... D SPL1^IBCEOBAR(Q,$P(Z0,U,2),$P(Z0,U,7),$P(Z0,U,6)) ; Add the split bill # ; IA 4050
"RTN","RCDPEM",157,0)
 ;
"RTN","RCDPEM",158,0)
 Q
"RTN","RCDPEM",159,0)
SPLIT(Z,Z1,RCERA) ;Check if worklist was split but to to single claim
"RTN","RCDPEM",160,0)
 N SUB,NBILL,OBILL
"RTN","RCDPEM",161,0)
 ;Find split line in scratchpad
"RTN","RCDPEM",162,0)
 S SUB=$O(^RCY(344.49,RCERA,1,"B",Z1,"")) Q:'SUB 0
"RTN","RCDPEM",163,0)
 ;Get original claim number from scratchpad
"RTN","RCDPEM",164,0)
 S OBILL=$P($G(^RCY(344.49,RCERA,1,SUB-1,0)),U,2)
"RTN","RCDPEM",165,0)
 ;New claim number
"RTN","RCDPEM",166,0)
 S NBILL=$P(RCSPL(Z,Z1),U,2)
"RTN","RCDPEM",167,0)
 ;If new and old claim are not the same this is a move via split
"RTN","RCDPEM",168,0)
 I OBILL'="",OBILL'=NBILL Q 1
"RTN","RCDPEM",169,0)
 ;Otherwise this is not a split
"RTN","RCDPEM",170,0)
 Q 0
"RTN","RCDPEM",171,0)
 ;
"RTN","RCDPEM",172,0)
DET(RCZ,RCR,RECTDA1,RCTRANDA) ; Store receipt detail
"RTN","RCDPEM",173,0)
 ; RCZ = ien of entry file 344.49
"RTN","RCDPEM",174,0)
 ; RCR = ien of entry in file 344.491
"RTN","RCDPEM",175,0)
 ; RCPROC = Function calling this subroutine
"RTN","RCDPEM",176,0)
 ;        = 1 EFT match to ERA   = 0 manual add receipt
"RTN","RCDPEM",177,0)
 ; RECTDA1 = ien of entry in file 344
"RTN","RCDPEM",178,0)
 ; RCTRANDA = ien of entry in subfile 344.01
"RTN","RCDPEM",179,0)
 ;
"RTN","RCDPEM",180,0)
 N DIE,DA,DR,X,Y,Z,RCUP,RCCOM,RCZ0,RC0
"RTN","RCDPEM",181,0)
 S RC0=$G(^RCY(344.49,RCZ,0))
"RTN","RCDPEM",182,0)
 S RCZ0=$G(^RCY(344.49,RCZ,1,RCR,0))
"RTN","RCDPEM",183,0)
 S DR="",RCUP=+$O(^RCY(344.49,RCZ,1,"B",+RCZ0/1,0)),RCUP=$G(^RCY(344.49,RCZ,1,RCUP,0))
"RTN","RCDPEM",184,0)
 I $P(RCZ0,U,7) S DR=".09////^S X="_+$P(RCZ0,U,7)_"_$C(59)_""PRCA(430,"";"
"RTN","RCDPEM",185,0)
 S DR=DR_".04////"_(+$P(RCZ0,U,3))_";.27////"_RCR_";"
"RTN","RCDPEM",186,0)
 I $P(RC0,U,5)'="" S DR=DR_".1////"_$P(RC0,U,5)_";"
"RTN","RCDPEM",187,0)
 I $P(RC0,U,6)'="" S DR=DR_".08////"_$P(RC0,U,6)_";"
"RTN","RCDPEM",188,0)
 S Z=0 F  S Z=$O(^RCY(344.49,RCZ,1,RCR,1,Z)) Q:'Z  I $P($G(^(Z,0)),U,5)=1 S DR=DR_".28////1;" Q  ; Update receipt line with dec adj flag
"RTN","RCDPEM",189,0)
 S RCCOM=$P(RCZ0,U,10)
"RTN","RCDPEM",190,0)
 I $P(RCUP,U,2)["**ADJ" S RCCOM=RCCOM_$S(RCCOM'="":"/",1:"")_$S($P($P(RCUP,U,2),"ADJ",2):"ERA adjustment - no bill referenced",1:"Total of EFT mismatched to ERA")
"RTN","RCDPEM",191,0)
 I RCCOM]"" S DR=DR_"1.02////"_$E(RCCOM,1,60)_";"
"RTN","RCDPEM",192,0)
 I $P($G(^RCY(344.49,RCZ,0)),U,4)'="" S DR=DR_".07////"_$P($G(^RCY(344.49,RCZ,0)),U,4)_";"
"RTN","RCDPEM",193,0)
 S DA(1)=RECTDA1,DA=RCTRANDA,DIE="^RCY(344,"_DA(1)_",1,"
"RTN","RCDPEM",194,0)
 D ^DIE
"RTN","RCDPEM",195,0)
 Q
"RTN","RCDPEM",196,0)
 ;
"RTN","RCDPEM1")
0^12^B51446445^B50720523
"RTN","RCDPEM1",1,0)
RCDPEM1 ;ALB/TMK,DWA,PJH - ERA MATCH TO EFT (cont) ; 5/5/11 1:25pm
"RTN","RCDPEM1",2,0)
 ;;4.5;Accounts Receivable;**173,269,318**;Mar 20, 1995;Build 37
"RTN","RCDPEM1",3,0)
 ;;Per VA Directive 6402, this routine should not be modified.
"RTN","RCDPEM1",4,0)
 Q
"RTN","RCDPEM1",5,0)
 ;
"RTN","RCDPEM1",6,0)
BULL(RCFILE,RC0,RCER) ; Add the error to the bulletin text array
"RTN","RCDPEM1",7,0)
 ; RCFILE = null, 344.3 or 344.31, depending on the file being worked
"RTN","RCDPEM1",8,0)
 ; RC0 = the 0-node of the RCFILE entry
"RTN","RCDPEM1",9,0)
 ; RCER = the error text to be placed in the bulletin (passed by ref)
"RTN","RCDPEM1",10,0)
 ;
"RTN","RCDPEM1",11,0)
 N RCHCT,CT,Z
"RTN","RCDPEM1",12,0)
 I '$O(^TMP($J,"RCXM",0)) S ^TMP($J,"RCXM",1)="The following exceptions were encountered attempting",^TMP($J,"RCXM",2)="to post EFT deposits OR to match EFT's with ERA's:",^TMP($J,"RCXM",3)=" "
"RTN","RCDPEM1",13,0)
 S (RCHCT,CT)=+$O(^TMP($J,"RCXM",""),-1)
"RTN","RCDPEM1",14,0)
 S ^TMP($J,"RCXM",0)=$G(^TMP($J,"RCXM",0))+1
"RTN","RCDPEM1",15,0)
 I RC0'="" D
"RTN","RCDPEM1",16,0)
 . D BLD("^TMP($J,""RCXM"")",.CT,RCFILE,RC0)
"RTN","RCDPEM1",17,0)
 . S RCER=$G(RCER)+1,RCHCT=RCHCT+1
"RTN","RCDPEM1",18,0)
 . S ^TMP($J,"RCXM",RCHCT)=$E(^TMP($J,"RCXM",0)_$J("",4),1,4)_$G(^TMP($J,"RCXM",RCHCT))
"RTN","RCDPEM1",19,0)
 S Z=1 F  S Z=$O(RCER(Z)) Q:'Z  S CT=CT+1,^TMP($J,"RCXM",CT)="  "_RCER(Z)
"RTN","RCDPEM1",20,0)
 S CT=CT+1,^TMP($J,"RCXM",CT)="  "
"RTN","RCDPEM1",21,0)
 Q
"RTN","RCDPEM1",22,0)
 ;
"RTN","RCDPEM1",23,0)
SENDBULL ; Sends the bulletin when all processing is complete
"RTN","RCDPEM1",24,0)
 N XMBODY,XMB,XMINSTR,XMTYPE,XMFULL,XMTO,XMZ,XMERR,XMSUBJ
"RTN","RCDPEM1",25,0)
 S XMTO("I:G.RCDPE PAYMENTS")=""
"RTN","RCDPEM1",26,0)
 S XMBODY="^TMP($J,""RCXM"")"
"RTN","RCDPEM1",27,0)
 S XMSUBJ="EDI LBOX "_$$FMTE^XLFDT(DT,2)_" EXCEPTIONS EFT DEP/MATCH EFTs TO ERAs"
"RTN","RCDPEM1",28,0)
 D  ;
"RTN","RCDPEM1",29,0)
 . N DUZ
"RTN","RCDPEM1",30,0)
 . S DUZ=.5,DUZ(0)="@"
"RTN","RCDPEM1",31,0)
 . D SENDMSG^XMXAPI(.5,XMSUBJ,XMBODY,.XMTO,,.XMZ)
"RTN","RCDPEM1",32,0)
 K ^TMP($J,"RCXM")
"RTN","RCDPEM1",33,0)
 Q
"RTN","RCDPEM1",34,0)
 ;
"RTN","RCDPEM1",35,0)
BLD(RCARRAY,RCT,RCFILE,RC0) ; Build the array for entry 344.31 detail
"RTN","RCDPEM1",36,0)
 ; RCARRAY = the name of the array to be set
"RTN","RCDPEM1",37,0)
 ; RCT = the # of lines already output into this array
"RTN","RCDPEM1",38,0)
 ; RCFILE = 344.3 or 344.31
"RTN","RCDPEM1",39,0)
 ; RC0 = the 0-node of the entry in RCFILE
"RTN","RCDPEM1",40,0)
 ;
"RTN","RCDPEM1",41,0)
 N Z,RC00
"RTN","RCDPEM1",42,0)
 I RCFILE=344.31 D
"RTN","RCDPEM1",43,0)
 . S RC00=$G(^RCY(344.3,+RC0,0))
"RTN","RCDPEM1",44,0)
 . S Z=$$SETSTR^VALM1("  TRACE #: "_$P(RC0,U,4),"",1,61) ; Expand Trace # to 50 characters
"RTN","RCDPEM1",45,0)
 . S RCT=RCT+1,@RCARRAY@(RCT)=Z ; for Ins. Co. below
"RTN","RCDPEM1",46,0)
 . S Z=$$SETSTR^VALM1("  INS CO: "_$E($P(RC0,U,2),1,22)_"/"_$P(RC0,U,3),"",1,76)
"RTN","RCDPEM1",47,0)
 . S RCT=RCT+1,@RCARRAY@(RCT)=Z
"RTN","RCDPEM1",48,0)
 . S Z=$$SETSTR^VALM1("  DEPOSIT DATE: "_$$FMTE^XLFDT($P(RC00,U,7),2),"",1,24)
"RTN","RCDPEM1",49,0)
 . S Z=$$SETSTR^VALM1("  DATE REC'D: "_$S($P(RC00,U,13):$$FMTE^XLFDT($P(RC00,U,13)\1,2),1:""),Z,25,22)
"RTN","RCDPEM1",50,0)
 . S Z=$$SETSTR^VALM1("  PAYMENT AMT: "_$TR($J($P(RC0,U,7),15,2)," "),Z,47,30)
"RTN","RCDPEM1",51,0)
 . S RCT=RCT+1,@RCARRAY@(RCT)=Z
"RTN","RCDPEM1",52,0)
 ;
"RTN","RCDPEM1",53,0)
 I RCFILE=344.3 D
"RTN","RCDPEM1",54,0)
 . S Z=$$SETSTR^VALM1("  DEPOSIT #: "_$P(RC0,U,6),"",1,13)
"RTN","RCDPEM1",55,0)
 . S Z=$$SETSTR^VALM1("  DEPOSIT DATE: "_$$FMTE^XLFDT($P(RC0,U,7),2),Z,16,24)
"RTN","RCDPEM1",56,0)
 . S RCT=RCT+1,@RCARRAY@(RCT)=Z
"RTN","RCDPEM1",57,0)
 . S Z=$$SETSTR^VALM1("  DATE REC'D: "_$S($P(RC0,U,13):$$FMTE^XLFDT($P(RC0,U,13)\1,2),1:""),"",25,22)
"RTN","RCDPEM1",58,0)
 . S Z=$$SETSTR^VALM1("  DEPOSIT AMT: "_$TR($J($P(RC0,U,8),15,2)," "),Z,47,30)
"RTN","RCDPEM1",59,0)
 . S RCT=RCT+1,@RCARRAY@(RCT)=Z
"RTN","RCDPEM1",60,0)
 ;
"RTN","RCDPEM1",61,0)
 Q
"RTN","RCDPEM1",62,0)
 ;
"RTN","RCDPEM1",63,0)
EN1 ; Queue match job for run on demand
"RTN","RCDPEM1",64,0)
 N DIR,X,Y,ZTIO,ZTRTN,ZTSK,ZTDESC,ZTDTH
"RTN","RCDPEM1",65,0)
 S DIR(0)="YA",DIR("A",1)="THIS OPTION QUEUES THE JOB TO MATCH EFTs TO ELECTRONIC ERAs"
"RTN","RCDPEM1",66,0)
 S DIR("A")="ARE YOU SURE YOU WANT TO RUN THIS JOB?: ",DIR("B")="NO"
"RTN","RCDPEM1",67,0)
 W ! D ^DIR K DIR
"RTN","RCDPEM1",68,0)
 I Y'=1 G EN1Q
"RTN","RCDPEM1",69,0)
 L +^RCY(344.3,"ALOCK"):5 I '$T D  G EN1Q
"RTN","RCDPEM1",70,0)
 . S DIR(0)="EA",DIR("A",1)="This job is currently running ... try again later",DIR("A")="Press ENTER to continue: " D ^DIR K DIR
"RTN","RCDPEM1",71,0)
 S ZTIO="",ZTDTH=$$NOW^XLFDT()
"RTN","RCDPEM1",72,0)
 S ZTRTN="MATCH^RCDPEM(1,1)",ZTDESC="AR - MANUAL EFT-ERA MATCH EDI LOCKBOX"
"RTN","RCDPEM1",73,0)
 D ^%ZTLOAD
"RTN","RCDPEM1",74,0)
 W !!,$S($D(ZTSK):"Your job has been queued - task number "_ZTSK,1:"Unable to queue this job.")
"RTN","RCDPEM1",75,0)
 U IO
"RTN","RCDPEM1",76,0)
EN1Q L -^RCY(344.3,"ALOCK")
"RTN","RCDPEM1",77,0)
 Q
"RTN","RCDPEM1",78,0)
 ;
"RTN","RCDPEM1",79,0)
EN2 ; Entrypoint from nightly job to put Nightly and Daily Activity Report
"RTN","RCDPEM1",80,0)
 ; data into the nightly job's status bulletin
"RTN","RCDPEM1",81,0)
 N CT,DATA,Z,Z0,RCHD,T,T0
"RTN","RCDPEM1",82,0)
 S CT=+$O(^TMP($J,"RCXM",""),-1)
"RTN","RCDPEM1",83,0)
 S CT=CT+1,^TMP($J,"RCXM",CT)=""
"RTN","RCDPEM1",84,0)
 I $D(^TMP($J,"RCTOT","EFT_DEP")) D
"RTN","RCDPEM1",85,0)
 . S CT=CT+1,^TMP($J,"RCXM",CT)=$J("",12)_"********** TOTALS **********"
"RTN","RCDPEM1",86,0)
 . S CT=CT+1,^TMP($J,"RCXM",CT)="DEPOSITS"
"RTN","RCDPEM1",87,0)
 . S CT=CT+1,^TMP($J,"RCXM",CT)="  TOTAL # UNPOSTED EFT DEPOSITS FOUND: "_+$G(^TMP($J,"RCTOT","EFT_DEP"))
"RTN","RCDPEM1",88,0)
 . S CT=CT+1,^TMP($J,"RCXM",CT)="  TOTAL # NEW EFT DEPOSITS CREATED: "_+$G(^TMP($J,"RCTOT","DEPOSIT"))
"RTN","RCDPEM1",89,0)
 . S CT=CT+1,^TMP($J,"RCXM",CT)="  TOTAL # NEW EFT DEPOSIT RECEIPTS CREATED: "_+$G(^TMP($J,"RCTOT","EFT_RECPT"))
"RTN","RCDPEM1",90,0)
 . S CT=CT+1,^TMP($J,"RCXM",CT)="  TOTAL # EFT DEPOSITS WITH CHECK SUM ERRORS: "_+$G(^TMP($J,"RCTOT","CSUM"))
"RTN","RCDPEM1",91,0)
 . S CT=CT+1,^TMP($J,"RCXM",CT)="  TOTAL # EFT DEPOSITS WITH OTHER ERRORS: "_+$G(^TMP($J,"RCTOT","ERR"))
"RTN","RCDPEM1",92,0)
 . S CT=CT+1,^TMP($J,"RCXM",CT)="  TOTAL EFT DEPOSIT AMOUNT POSTED TO REV SRC CD 8NZZ: "_$J(+$G(^TMP($J,"RCTOT","SUSPAMT")),"",2)
"RTN","RCDPEM1",93,0)
 . S CT=CT+1,^TMP($J,"RCXM",CT)=""
"RTN","RCDPEM1",94,0)
 S CT=CT+1,^TMP($J,"RCXM",CT)="EFT-ERA MATCHES"
"RTN","RCDPEM1",95,0)
 S CT=CT+1,^TMP($J,"RCXM",CT)="  TOTAL # UNMATCHED ERAs CHECKED: "_+$G(^TMP($J,"RCTOT","EFT"))
"RTN","RCDPEM1",96,0)
 S CT=CT+1,^TMP($J,"RCXM",CT)="  TOTAL # ERAs MATCHED TO EFTs: "_+$G(^TMP($J,"RCTOT","MATCH"))_$S($G(^TMP($J,"RCTOT","MATCH"))&$G(^TMP($J,"RCTOT","TOTMIS")):" INCLUDING "_+$G(^TMP($J,"RCTOT","TOTMIS"))_" WITH MISMATCHED TOTALS",1:"")
"RTN","RCDPEM1",97,0)
 S CT=CT+1,^TMP($J,"RCXM",CT)="  TOTAL # ERAs STILL UNMATCHED: "_+$G(^TMP($J,"RCTOT","NO_MATCH"))
"RTN","RCDPEM1",98,0)
 S CT=CT+1,^TMP($J,"RCXM",CT)=""
"RTN","RCDPEM1",99,0)
 K ^TMP("RCDAILYACT",$J),^TMP($J,"RC1")
"RTN","RCDPEM1",100,0)
 ;
"RTN","RCDPEM1",101,0)
 S Z=0 F  S Z=$O(^TMP($J,"RCDPETOT",344.31,Z)) Q:'Z  S Z0=$G(^RCY(344.31,Z,0)) I Z0 S ^TMP($J,"RC1",+Z0,Z)=Z0
"RTN","RCDPEM1",102,0)
 ;
"RTN","RCDPEM1",103,0)
 S (RCHD,Z)=0 F  S Z=$O(^TMP($J,"RCDPETOT",344.3,Z)) Q:'Z  S DATA=$G(^(Z)) D
"RTN","RCDPEM1",104,0)
 . I 'RCHD D HDR(.CT,.RCHD) ; Add headers
"RTN","RCDPEM1",105,0)
 . S Z0=$G(^RCY(344.3,Z,0))
"RTN","RCDPEM1",106,0)
 . S CT=CT+1
"RTN","RCDPEM1",107,0)
 . S ^TMP($J,"RCXM",CT)=""
"RTN","RCDPEM1",108,0)
 . I '$G(DATA) D
"RTN","RCDPEM1",109,0)
 .. S CT=CT+1
"RTN","RCDPEM1",110,0)
 .. S ^TMP($J,"RCXM",CT)=^TMP($J,"RCXM",CT)_"  "_$E($P($G(^RCY(344.1,+$P(Z0,U,3),0)),U)_$J("",15),1,15)_"  "_$E($P($G(^RCY(344,+$O(^RCY(344,"AD",+$P(Z0,U,3),0)),0)),U)_$J("",15),1,15)_"  "
"RTN","RCDPEM1",111,0)
 .. S ^TMP($J,"RCXM",CT)=^TMP($J,"RCXM",CT)_$J(+$P(Z0,U,12),"",2)
"RTN","RCDPEM1",112,0)
 . I $G(DATA) D
"RTN","RCDPEM1",113,0)
 .. S ^TMP($J,"RCXM",CT)=^TMP($J,"RCXM",CT)_"  "_$E($P($G(^RCY(344.1,+$P(DATA,U,5),0)),U)_$J("",15),1,15)_"  "_$E($S($P(DATA,U,5):$P($G(^RCY(344,+DATA,0)),U),1:"")_$J("",15),1,15)_"  "
"RTN","RCDPEM1",114,0)
 .. S ^TMP($J,"RCXM",CT)=^TMP($J,"RCXM",CT)_$J($S($P(DATA,U,3):+$P(DATA,U,2),1:0),"",2)
"RTN","RCDPEM1",115,0)
 . I $P(DATA,U,4) S CT=CT+1,^TMP($J,"RCXM",CT)="    ERROR # REFERENCED ABOVE : "_$P(DATA,U,4)
"RTN","RCDPEM1",116,0)
 . S T=0 F  S T=$O(^TMP($J,"RC1",Z,T)) Q:'T  S T0=$G(^(T)) D
"RTN","RCDPEM1",117,0)
 .. S CT=CT+1
"RTN","RCDPEM1",118,0)
 .. S ^TMP($J,"RCXM",CT)=$J("",5)_$P(T0,U,4)
"RTN","RCDPEM1",119,0)
 .. S CT=CT+1 ; separate TRACE # above from PAYER NAME/ID below
"RTN","RCDPEM1",120,0)
 .. S ^TMP($J,"RCXM",CT)=$J("",5)_$P(T0,U,2)_"/"_$P(T0,U,3)
"RTN","RCDPEM1",121,0)
 .. S CT=CT+1,^TMP($J,"RCXM",CT)=$J("",10)_"PAYMENT AMOUNT: "_$J(+$P(T0,U,7),"",2)_"  MATCH STATUS: "_$$EXTERNAL^DILFD(344.31,.08,,$P(T0,U,8))
"RTN","RCDPEM1",122,0)
 .. S:$O(^TMP($J,"RCDPETOT",344.3,Z)) CT=CT+1,^TMP($J,"RCXM",CT)=" "
"RTN","RCDPEM1",123,0)
 . I $P(DATA,U,3) S ^TMP("RCDAILYACT",$J,DT,Z)=Z0
"RTN","RCDPEM1",124,0)
 ;
"RTN","RCDPEM1",125,0)
 K ^TMP($J,"RC1")
"RTN","RCDPEM1",126,0)
 I $O(^TMP("RCDAILYACT",$J,0)) D  ; Daily activity rep automatic bulletin
"RTN","RCDPEM1",127,0)
 . N XMBODY,XMB,XMINSTR,XMTYPE,XMFULL,XMTO,XMZ,XMERR,XMSUBJ
"RTN","RCDPEM1",128,0)
 . K ^TMP($J,"RCDPE_DAR")
"RTN","RCDPEM1",129,0)
 . D RPT1^RCDPEDAR("1^0^0^0^0^"_DT_"^"_DT)  ;PRCA*4.5*318, changed the parameters
"RTN","RCDPEM1",130,0)
 . K ^TMP("RCDAILYACT",$J)
"RTN","RCDPEM1",131,0)
 . Q:'$O(^TMP($J,"RCDPE_DAR",0))
"RTN","RCDPEM1",132,0)
 . S XMTO("I:G.RCDPE PAYMENTS")=""
"RTN","RCDPEM1",133,0)
 . S XMBODY="^TMP($J,""RCDPE_DAR"")"
"RTN","RCDPEM1",134,0)
 . S XMSUBJ="EDI LBOX - AUTO DAILY ACTIVITY SUMMARY - "_$$FMTE^XLFDT(DT,2)
"RTN","RCDPEM1",135,0)
 . D  ;
"RTN","RCDPEM1",136,0)
 .. N DUZ
"RTN","RCDPEM1",137,0)
 .. S DUZ=.5,DUZ(0)="@"
"RTN","RCDPEM1",138,0)
 .. D SENDMSG^XMXAPI(.5,XMSUBJ,XMBODY,.XMTO,,.XMZ)
"RTN","RCDPEM1",139,0)
 . K ^TMP($J,"RCDPE_DAR")
"RTN","RCDPEM1",140,0)
 Q
"RTN","RCDPEM1",141,0)
 ;
"RTN","RCDPEM1",142,0)
HDR(CT,HD) ; Header array set
"RTN","RCDPEM1",143,0)
 ; CT = line count, passed by reference
"RTN","RCDPEM1",144,0)
 ; HD = flag returned as 1 so the header is only output once
"RTN","RCDPEM1",145,0)
 N Q
"RTN","RCDPEM1",146,0)
 S CT=CT+1,^TMP($J,"RCXM",CT)=" "
"RTN","RCDPEM1",147,0)
 S CT=CT+1,^TMP($J,"RCXM",CT)=$J("",20)_"********** EFT DEPOSIT RECORDS **********"
"RTN","RCDPEM1",148,0)
 S CT=CT+1,^TMP($J,"RCXM",CT)="  EFT DEPOSIT      EFT RECEIPT      POSTED AMOUNT"
"RTN","RCDPEM1",149,0)
 S CT=CT+1,^TMP($J,"RCXM",CT)=" "
"RTN","RCDPEM1",150,0)
 S CT=CT+1,^TMP($J,"RCXM",CT)="     TRACE #"
"RTN","RCDPEM1",151,0)
 S CT=CT+1,^TMP($J,"RCXM",CT)="     PAYER NAME/ID"
"RTN","RCDPEM1",152,0)
 S CT=CT+1,Q="",$P(Q,"=",79)="",^TMP($J,"RCXM",CT)=Q
"RTN","RCDPEM1",153,0)
 S HD=1
"RTN","RCDPEM1",154,0)
 Q
"RTN","RCDPEM1",155,0)
 ;
"RTN","RCDPEM9")
0^28^B45658707^B27056813
"RTN","RCDPEM9",1,0)
RCDPEM9 ;OIFO-BAYPINES/PJH - PAYER SELECTION ;10/18/11 6:17pm
"RTN","RCDPEM9",2,0)
 ;;4.5;Accounts Receivable;**276,284,318**;Mar 20, 1995;Build 37
"RTN","RCDPEM9",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","RCDPEM9",4,0)
 ;
"RTN","RCDPEM9",5,0)
 ; PRCA*4.5*318 - Added parameters MIXED and BLANKLN
"RTN","RCDPEM9",6,0)
GETPAY(FILE,MIXED,BLANKLN) ; Let user select payer for filter
"RTN","RCDPEM9",7,0)
 ; Input: FILE    - File to retrieve Payers from either #344.4 OR ##344.31
"RTN","RCDPEM9",8,0)
 ;        MIXED   - 1 to display prompts in mixed case
"RTN","RCDPEM9",9,0)
 ;                  Optional, defaults to 0
"RTN","RCDPEM9",10,0)
 ;        BLANKLN - 0 skip initial blank line
"RTN","RCDPEM9",11,0)
 ;                  Optional, defaults to 1
"RTN","RCDPEM9",12,0)
 ;
"RTN","RCDPEM9",13,0)
 ; Returned RTNFLG value
"RTN","RCDPEM9",14,0)
 ;
"RTN","RCDPEM9",15,0)
 ; PRCA*4.5*284 - Added pieces 2 & 3 to provide background jobs information to re-calculate payer list.
"RTN","RCDPEM9",16,0)
 ;
"RTN","RCDPEM9",17,0)
 ; Piece 1: -1 = none selected
"RTN","RCDPEM9",18,0)
 ;           1 = range of payers
"RTN","RCDPEM9",19,0)
 ;           2 = all payers selected
"RTN","RCDPEM9",20,0)
 ;           3 = specific payers
"RTN","RCDPEM9",21,0)
 ; Piece 2: From Range (When a from/thru range is selected by user)
"RTN","RCDPEM9",22,0)
 ; Piece 3: Thru Range (When a from/thru range is selected by user)
"RTN","RCDPEM9",23,0)
 ;
"RTN","RCDPEM9",24,0)
 ; Payers selected are returned in ^TMP("RCSELPAY",$J
"RTN","RCDPEM9",25,0)
 ;
"RTN","RCDPEM9",26,0)
 N RCPAY,RCINC,CNT,RTNFLG,I,RCANS,INDX,X,RCANS2,DIR,Y,DTOUT,DUOUT,RCINSF
"RTN","RCDPEM9",27,0)
 N RCINST,RNG1,RNG2
"RTN","RCDPEM9",28,0)
 S:'$D(MIXED) MIXED=0   ; PRCA*4.5*318 - Added logic for MIXED and BLANKLN
"RTN","RCDPEM9",29,0)
 S:'$D(BLANKLN) BLANKLN=1
"RTN","RCDPEM9",30,0)
 ;
"RTN","RCDPEM9",31,0)
 S RTNFLG=0,INDX=1,RNG1="",RNG2=""
"RTN","RCDPEM9",32,0)
 ;
"RTN","RCDPEM9",33,0)
 ;Clear list of selected payers
"RTN","RCDPEM9",34,0)
 K ^TMP("RCSELPAY",$J)
"RTN","RCDPEM9",35,0)
 ;
"RTN","RCDPEM9",36,0)
 ;Select option required (All, Selected or Range)
"RTN","RCDPEM9",37,0)
 S DIR(0)="SA^A:ALL;S:SPECIFIC;R:RANGE"
"RTN","RCDPEM9",38,0)
 S DIR("A")="RUN REPORT FOR (A)LL, (S)PECIFIC, OR (R)ANGE OF INSURANCE COMPANIES?: "
"RTN","RCDPEM9",39,0)
 S DIR("B")="ALL"
"RTN","RCDPEM9",40,0)
 S DIR("?",1)="Enter 'ALL' to select all Insurance Companies."
"RTN","RCDPEM9",41,0)
 S DIR("?",2)="Enter 'RANGE' to select an Insurance Company range."
"RTN","RCDPEM9",42,0)
 S DIR("?")="Enter 'SPECIFIC' to select specific Insurance Companies."
"RTN","RCDPEM9",43,0)
 I MIXED D           ; PRCA*4.5*318 - Added logic for MIXED and BLANKLN
"RTN","RCDPEM9",44,0)
 . N XX
"RTN","RCDPEM9",45,0)
 . S XX="Run Report for (A)LL, (S)PECIFIC, or (R)ANGE of Insurance Companies?: "
"RTN","RCDPEM9",46,0)
 . S DIR(0)="SA^A:ALL;S:SPECIFIC;R:RANGE"
"RTN","RCDPEM9",47,0)
 . S DIR("A")=XX,DIR("B")="ALL"
"RTN","RCDPEM9",48,0)
 W:BLANKLN !         ; PRCA*4.5*318 - Added condition for BLANKLN
"RTN","RCDPEM9",49,0)
 D ^DIR K DIR
"RTN","RCDPEM9",50,0)
 ;
"RTN","RCDPEM9",51,0)
 ;Abort on ^ exit or timeout
"RTN","RCDPEM9",52,0)
 I $D(DTOUT)!$D(DUOUT) S RTNFLG=-1 Q RTNFLG
"RTN","RCDPEM9",53,0)
 ;
"RTN","RCDPEM9",54,0)
 ;ALL payers
"RTN","RCDPEM9",55,0)
 I Y="A" D
"RTN","RCDPEM9",56,0)
 .; Build list of ALL stations
"RTN","RCDPEM9",57,0)
 .S CNT=0,RCPAY="",RTNFLG=2
"RTN","RCDPEM9",58,0)
 .F  S RCPAY=$O(^RCY(FILE,"C",RCPAY)) Q:RCPAY=""  D
"RTN","RCDPEM9",59,0)
 ..S CNT=CNT+1,^TMP("RCSELPAY",$J,CNT)=RCPAY
"RTN","RCDPEM9",60,0)
 ;
"RTN","RCDPEM9",61,0)
 ;Selected Payers
"RTN","RCDPEM9",62,0)
 I Y="S" D
"RTN","RCDPEM9",63,0)
 .D GLIST(FILE),GETPAYS(CNT,MIXED)  ; PRCA*4.5*318 - Added parameter MIXED
"RTN","RCDPEM9",64,0)
 ;
"RTN","RCDPEM9",65,0)
 ;Range of Payers
"RTN","RCDPEM9",66,0)
 I Y="R" D
"RTN","RCDPEM9",67,0)
 .D GLIST(FILE),GETPAYR(MIXED,BLANKLN)  ; PRCA*4.5*318 - Added parameters MIXED and BLANKLN
"RTN","RCDPEM9",68,0)
 ;
"RTN","RCDPEM9",69,0)
 ;Clear list of all payers
"RTN","RCDPEM9",70,0)
 K:RTNFLG'=2 ^TMP("RCPAYER",$J)
"RTN","RCDPEM9",71,0)
 ;If aborting also clear any selected payers
"RTN","RCDPEM9",72,0)
 K:RTNFLG=-1 ^TMP("RCSELPAY",$J)
"RTN","RCDPEM9",73,0)
 ;
"RTN","RCDPEM9",74,0)
 ;Return value
"RTN","RCDPEM9",75,0)
 ; PRCA*4.5*284 - Update return value to include from/thru range. See above for documentation
"RTN","RCDPEM9",76,0)
 Q RTNFLG_"^"_RNG1_"^"_RNG2
"RTN","RCDPEM9",77,0)
 ;
"RTN","RCDPEM9",78,0)
GLIST(FILE) ;Build list for this file
"RTN","RCDPEM9",79,0)
 ;
"RTN","RCDPEM9",80,0)
 ;Clear workfile
"RTN","RCDPEM9",81,0)
 K ^TMP("RCPAYER",$J)
"RTN","RCDPEM9",82,0)
 ;
"RTN","RCDPEM9",83,0)
 ; Build list of available stations
"RTN","RCDPEM9",84,0)
 S CNT=0,RCPAY=""
"RTN","RCDPEM9",85,0)
 F  S RCPAY=$O(^RCY(FILE,"C",RCPAY)) Q:RCPAY=""  D
"RTN","RCDPEM9",86,0)
 .S CNT=CNT+1
"RTN","RCDPEM9",87,0)
 .S ^TMP("RCPAYER",$J,CNT)=RCPAY
"RTN","RCDPEM9",88,0)
 .S ^TMP("RCPAYER",$J,"B",RCPAY,CNT)=""
"RTN","RCDPEM9",89,0)
 ;
"RTN","RCDPEM9",90,0)
 Q
"RTN","RCDPEM9",91,0)
 ;
"RTN","RCDPEM9",92,0)
 ; PRCA*4.5*318 - Added parameter & logic for MIXED
"RTN","RCDPEM9",93,0)
GETPAYS(CNT,MIXED) ;select payer for filter, specific
"RTN","RCDPEM9",94,0)
 ; Input: CNT   - Number of Payers
"RTN","RCDPEM9",95,0)
 ;        MIXED - 1 to display prompts in mixed case
"RTN","RCDPEM9",96,0)
 ;                Optional, defaults to 0
"RTN","RCDPEM9",97,0)
 ;
"RTN","RCDPEM9",98,0)
 S:'$D(MIXED) MIXED=0
"RTN","RCDPEM9",99,0)
 ;
"RTN","RCDPEM9",100,0)
 N PNAME
"RTN","RCDPEM9",101,0)
 ;
"RTN","RCDPEM9",102,0)
 K ^TMP("RCDPEM9",$J)
"RTN","RCDPEM9",103,0)
 ;
"RTN","RCDPEM9",104,0)
 F  Q:RTNFLG'=0  D
"RTN","RCDPEM9",105,0)
 .N DIR,X,Y,DTOUT,DUOUT,DIRUT,DIROUT
"RTN","RCDPEM9",106,0)
 .S DIR("A")="SELECT INSURANCE COMPANY"
"RTN","RCDPEM9",107,0)
 .S:MIXED DIR("A")="Select Insurance Company"   ; PRCA*4.5*318
"RTN","RCDPEM9",108,0)
 .S DIR(0)="FO^1:30"
"RTN","RCDPEM9",109,0)
 .S DIR("?")="ENTER THE NAME OF THE PAYER OR '??' TO LIST PAYERS"
"RTN","RCDPEM9",110,0)
 .; PRCA*4.5*318 - Added MIXED
"RTN","RCDPEM9",111,0)
 .S:MIXED DIR("?")="Enter the name of the payer or '??' to list payers"
"RTN","RCDPEM9",112,0)
 .S DIR("??")="^D LIST^RCDPEM9(CNT)"
"RTN","RCDPEM9",113,0)
 .D ^DIR K DIR
"RTN","RCDPEM9",114,0)
 .;User pressed ENTER
"RTN","RCDPEM9",115,0)
 .I Y="",'$D(DTOUT) S RTNFLG=$S($D(^TMP("RCSELPAY")):3,1:-1) Q
"RTN","RCDPEM9",116,0)
 .;First check for exits
"RTN","RCDPEM9",117,0)
 .I $D(DUOUT)!$D(DTOUT)!$D(DIRUT)!$D(DIROUT) S RTNFLG=-1 Q
"RTN","RCDPEM9",118,0)
 .;Check for help
"RTN","RCDPEM9",119,0)
 .S (RCANS,RCANS2)=""
"RTN","RCDPEM9",120,0)
 .S RCANS=Y
"RTN","RCDPEM9",121,0)
 .; Now check for exotic user input
"RTN","RCDPEM9",122,0)
 .I '(RCANS?.N) S RCANS2=$O(^TMP("RCPAYER",$J,"B",RCANS,RCANS2)) D:'RCANS2 PART Q:'$G(RCANS2)
"RTN","RCDPEM9",123,0)
 .S:$G(RCANS2) RCANS=RCANS2 I RCANS="" W "  ??" Q
"RTN","RCDPEM9",124,0)
 .I RCANS?.N&((+RCANS<1)!(+RCANS>CNT)) W "  ??" Q
"RTN","RCDPEM9",125,0)
 .I RCANS'?.N W "  ??" Q
"RTN","RCDPEM9",126,0)
 .I $D(^TMP("RCDPEM9",$J,RCANS)) W "  ?? PAYER ALREADY SELECTED" Q
"RTN","RCDPEM9",127,0)
 .S ^TMP("RCDPEM9",$J,RCANS)=""
"RTN","RCDPEM9",128,0)
 .S PNAME=$G(^TMP("RCPAYER",$J,RCANS))
"RTN","RCDPEM9",129,0)
 .W "  "_PNAME
"RTN","RCDPEM9",130,0)
 .S ^TMP("RCSELPAY",$J,INDX)=$G(^TMP("RCPAYER",$J,RCANS))
"RTN","RCDPEM9",131,0)
 .S INDX=INDX+1
"RTN","RCDPEM9",132,0)
 ;
"RTN","RCDPEM9",133,0)
 K ^TMP("RCDPEM9",$J)
"RTN","RCDPEM9",134,0)
 Q
"RTN","RCDPEM9",135,0)
 ;
"RTN","RCDPEM9",136,0)
LIST(CNT) ;
"RTN","RCDPEM9",137,0)
 ; Prompt users for stations to be used for filtering
"RTN","RCDPEM9",138,0)
 N I
"RTN","RCDPEM9",139,0)
 F I=1:1:CNT D
"RTN","RCDPEM9",140,0)
 .W !,I,".",?5,$G(^TMP("RCPAYER",$J,I))
"RTN","RCDPEM9",141,0)
 Q
"RTN","RCDPEM9",142,0)
 ;
"RTN","RCDPEM9",143,0)
PART ;
"RTN","RCDPEM9",144,0)
 N RCPAR,CNT,IEN
"RTN","RCDPEM9",145,0)
 S RCPAR=0,CNT=0
"RTN","RCDPEM9",146,0)
 F  S RCPAR=$O(^TMP("RCPAYER",$J,"B",RCPAR)) Q:RCPAR=""  D
"RTN","RCDPEM9",147,0)
 .S IEN=$O(^TMP("RCPAYER",$J,"B",RCPAR,""))
"RTN","RCDPEM9",148,0)
 .I $E(RCPAR,1,$L(RCANS))[RCANS W !,?10,IEN,".",^TMP("RCPAYER",$J,IEN) S CNT=1
"RTN","RCDPEM9",149,0)
 I 'CNT W "  ??"
"RTN","RCDPEM9",150,0)
 Q
"RTN","RCDPEM9",151,0)
 ;
"RTN","RCDPEM9",152,0)
 ; PRCA*4.5*318 - Added parameters & logic for MIXED & BLANKLN
"RTN","RCDPEM9",153,0)
GETPAYR(MIXED,BLANKLN) ;select payer for filter, range
"RTN","RCDPEM9",154,0)
 ; called from ^RCDPEAR1
"RTN","RCDPEM9",155,0)
 ; Input: MIXED   - 1 to display prompts in mixed case
"RTN","RCDPEM9",156,0)
 ;                  Optional, defaults to 0
"RTN","RCDPEM9",157,0)
 ;        BLANKLN - 0 skip initial blank line
"RTN","RCDPEM9",158,0)
 ;                  Optional, defaults to 1 
"RTN","RCDPEM9",159,0)
 ;
"RTN","RCDPEM9",160,0)
 S:'$D(MIXED) MIXED=0           ; PRCA*4.5*318
"RTN","RCDPEM9",161,0)
 S:'$D(BLANKLN) BLANKLN=1
"RTN","RCDPEM9",162,0)
 ;
"RTN","RCDPEM9",163,0)
 N DIR,DTOUT,DUOUT,DIRUT,DIROUT,INDX,X,Y,RCINSF,RCINST,NUM
"RTN","RCDPEM9",164,0)
 S DIR("?")="ENTER THE NAME OF THE PAYER OR '??' TO LIST PAYERS"
"RTN","RCDPEM9",165,0)
 S DIR("??")="^D LIST^RCDPEM9(CNT)"
"RTN","RCDPEM9",166,0)
 S DIR(0)="FA^1:30^K:X'?1.U.E X"
"RTN","RCDPEM9",167,0)
 S DIR("A")="START WITH INSURANCE COMPANY NAME: "
"RTN","RCDPEM9",168,0)
 S DIR("B")=$E($O(^TMP("RCPAYER",$J,"B","")),1,30)
"RTN","RCDPEM9",169,0)
 I MIXED D         ;PRCA*4.5*318
"RTN","RCDPEM9",170,0)
 . S DIR("?")="Enter the name of the payer or '??' to list payers"
"RTN","RCDPEM9",171,0)
 . S DIR("A")="Start with Insurance Company name: "
"RTN","RCDPEM9",172,0)
 D ^DIR K DIR
"RTN","RCDPEM9",173,0)
 I $D(DTOUT)!$D(DUOUT)!$D(DIRUT)!$D(DIROUT)!(Y="") S RTNFLG=-1 Q
"RTN","RCDPEM9",174,0)
 S RCINSF=Y
"RTN","RCDPEM9",175,0)
 S DIR("?")="ENTER THE NAME OF THE PAYER OR '??' TO LIST PAYERS"
"RTN","RCDPEM9",176,0)
 S DIR("??")="^D LIST^RCDPEM9(CNT)"
"RTN","RCDPEM9",177,0)
 S DIR(0)="FA^1:30^K:X'?1.U.E X"
"RTN","RCDPEM9",178,0)
 S DIR("A")="GO TO INSURANCE COMPANY NAME: "
"RTN","RCDPEM9",179,0)
 I MIXED D         ;PRCA*4.5*318
"RTN","RCDPEM9",180,0)
 . S DIR("?")="Enter the name of the payer or '??' to list payers"
"RTN","RCDPEM9",181,0)
 . S DIR("A")="Go to Insurance Company name: "
"RTN","RCDPEM9",182,0)
 S DIR("B")=$E($O(^TMP("RCPAYER",$J,"B",""),-1),1,30)
"RTN","RCDPEM9",183,0)
 ; PRCA*4.5*318 - added conditional for MIXED & BLANKLN
"RTN","RCDPEM9",184,0)
 F  W:BLANKLN ! D ^DIR Q:$S($D(DTOUT)!$D(DUOUT):1,1:RCINSF']Y)  D
"RTN","RCDPEM9",185,0)
 . W:'MIXED !,"'GO TO' NAME MUST COME AFTER 'START WITH' NAME"
"RTN","RCDPEM9",186,0)
 . W:MIXED !,"'GO TO' name must come after 'START WITH' name"
"RTN","RCDPEM9",187,0)
 K DIR
"RTN","RCDPEM9",188,0)
 I $D(DTOUT)!$D(DUOUT)!$D(DIRUT)!$D(DIROUT)!(Y="") S RTNFLG=-1 Q
"RTN","RCDPEM9",189,0)
 S RCINST=Y_"Z"  ;entry of "ABC" will pick up "ABC INSURANCE" if "Z" is appended
"RTN","RCDPEM9",190,0)
 ;If the first name is an exact match, back up to the previous entry
"RTN","RCDPEM9",191,0)
 I $D(^TMP("RCPAYER",$J,"B",RCINSF)) S RCINSF=$O(^TMP("RCPAYER",$J,"B",RCINSF),-1)
"RTN","RCDPEM9",192,0)
 ; PRCA*4.5*284 - Save from/thru user responses in RNG1 & RNG2 to rebuild after report is queued. Will be returned to the calling program.
"RTN","RCDPEM9",193,0)
 S RNG1=RCINSF,RNG2=RCINST
"RTN","RCDPEM9",194,0)
 S INDX=1 F  S RCINSF=$O(^TMP("RCPAYER",$J,"B",RCINSF)) Q:RCINSF=""  Q:RCINSF]RCINST  D
"RTN","RCDPEM9",195,0)
 . S NUM=$O(^TMP("RCPAYER",$J,"B",RCINSF,""))
"RTN","RCDPEM9",196,0)
 . S ^TMP("RCSELPAY",$J,INDX)=$G(^TMP("RCPAYER",$J,NUM))
"RTN","RCDPEM9",197,0)
 . S INDX=INDX+1
"RTN","RCDPEM9",198,0)
 ;Set return value
"RTN","RCDPEM9",199,0)
 I INDX=1 S RTNFLG=-1 Q  ; no entries in selected range
"RTN","RCDPEM9",200,0)
 S RTNFLG=1
"RTN","RCDPEM9",201,0)
 Q
"RTN","RCDPEMA")
0^13^B22956552^B22680742
"RTN","RCDPEMA",1,0)
RCDPEMA ;ALB/PJH - AUTO-POSTING RECEIPT CREATION ;Oct 15, 2014@12:37:52
"RTN","RCDPEMA",2,0)
 ;;4.5;Accounts Receivable;**298,304,318**;Mar 20, 1995;Build 37
"RTN","RCDPEMA",3,0)
 ;Per VA Directive 6402, this routine should not be modified.
"RTN","RCDPEMA",4,0)
 ;
"RTN","RCDPEMA",5,0)
RCPTDET(RCRZ,RECTDA1,RCLINES,RCER) ; Adds detail to a receipt based on file 344.49 and exceptions in array RCLINES
"RTN","RCDPEMA",6,0)
 ; RCRZ = ien of ERA entry in file 344.49
"RTN","RCDPEMA",7,0)
 ; RECTDA1 = ien of receipt entry in file 344
"RTN","RCDPEMA",8,0)
 ; RCER = error array returned if passed by reference
"RTN","RCDPEMA",9,0)
 ; RCLINES = array to indicate which scratchpad lines can be posted (assigned a receipt)
"RTN","RCDPEMA",10,0)
 ;
"RTN","RCDPEMA",11,0)
 N DA,DIE,DR,Q,RCLINE,RCQ,RCR,RCSPL,RCTRANDA,RCZ0,SEQLINES,RCSEQ,X,Y,Z,Z0,Z1
"RTN","RCDPEMA",12,0)
 ;
"RTN","RCDPEMA",13,0)
 S RCR=0 F  S RCR=$O(^RCY(344.49,RCRZ,1,RCR)) Q:'RCR  D
"RTN","RCDPEMA",14,0)
 . S RCZ0=$G(^RCY(344.49,RCRZ,1,RCR,0)),RCSEQ=$P(RCZ0,U)
"RTN","RCDPEMA",15,0)
 . ;Check first line for prefix to see if ERA line is valid for auto-post
"RTN","RCDPEMA",16,0)
 . I RCSEQ?1N.N,$P(RCZ0,U,9),$P($G(RCLINES($P(RCZ0,U,9))),U) S SEQLINES(RCSEQ)=""
"RTN","RCDPEMA",17,0)
 . ;Skip WORKLIST lines that do not need associated receipt detail
"RTN","RCDPEMA",18,0)
 . Q:'$D(SEQLINES(RCSEQ\1))
"RTN","RCDPEMA",19,0)
 . I RCSEQ'["." S RCSPL(+RCZ0)=$P(RCZ0,U,9) Q
"RTN","RCDPEMA",20,0)
 . I $S(+$P(RCZ0,U,3)=0:$P($G(^RCY(344.49,RCRZ,0)),U,3),1:$P(RCZ0,U,3)<0) S RCSPL(RCZ0\1,+RCZ0)=RCZ0 Q
"RTN","RCDPEMA",21,0)
 . S RCTRANDA=$$ADDTRAN^RCDPURET(RECTDA1)
"RTN","RCDPEMA",22,0)
 . ;
"RTN","RCDPEMA",23,0)
 . I RCTRANDA'>0 D  Q  ; Error adding receipt detail - PRCA*4.5*318
"RTN","RCDPEMA",24,0)
 .. S RCER(1)=$$SETERR^RCDPEM0(1) ; PRCA*4.5*318 - pass RCPROC value to $$SETERR 
"RTN","RCDPEMA",25,0)
 .. S RCER($O(RCER(""),-1)+1)="  NO DETAIL LINE ADDED TO RECEIPT "_$P($G(^RCY(344,RECTDA1,0)),U)_" FOR LINE #"_$P(RCZ0,U)_" IN EEOB WORKLIST SCRATCH PAD"
"RTN","RCDPEMA",26,0)
 . ;
"RTN","RCDPEMA",27,0)
 . ;Store receipt line detail
"RTN","RCDPEMA",28,0)
 . D DET(RCRZ,RCR,RECTDA1,RCTRANDA)
"RTN","RCDPEMA",29,0)
 . S RCSPL(RCZ0\1,+RCZ0)=RCZ0
"RTN","RCDPEMA",30,0)
 S Z=0 F  S Z=$O(RCSPL(Z)) Q:'Z  S RCQ=+$G(RCSPL(Z)) I RCQ D
"RTN","RCDPEMA",31,0)
 .; Move EEOB if one claim entered-changed 10/19/11-see +25^RCDPEWL8
"RTN","RCDPEMA",32,0)
 . S Z1=$O(RCSPL(Z,"")) Q:Z1=""
"RTN","RCDPEMA",33,0)
 . I $O(RCSPL(Z,""),-1)=Z1,'$$SPLIT(Z,Z1,RCERA) Q  ; No split occurred
"RTN","RCDPEMA",34,0)
 . S Z1=0 F  S Z1=$O(RCSPL(Z,Z1)) Q:'Z1  S Z0=$G(RCSPL(Z,Z1)) D
"RTN","RCDPEMA",35,0)
 .. S Q=+$P($G(^RCY(344.4,RCRZ,1,RCQ,0)),U,2) ; EOB detail rec
"RTN","RCDPEMA",36,0)
 .. Q:'Q
"RTN","RCDPEMA",37,0)
 .. I '$P(Z0,U,7)!($P(Z0,U,2)="") D  ; Suspense
"RTN","RCDPEMA",38,0)
 ... D SPL1^IBCEOBAR(Q,$S($P(Z0,U,2)="":"NO BILL",1:$P(Z0,U,2)),"",$P(Z0,U,6)) ; IA 4050
"RTN","RCDPEMA",39,0)
 .. E  D
"RTN","RCDPEMA",40,0)
 ... D SPL1^IBCEOBAR(Q,$P(Z0,U,2),$P(Z0,U,7),$P(Z0,U,6)) ; Add the split bill # ; IA 4050
"RTN","RCDPEMA",41,0)
 ;
"RTN","RCDPEMA",42,0)
 Q
"RTN","RCDPEMA",43,0)
 ;
"RTN","RCDPEMA",44,0)
SPLIT(Z,Z1,RCERA) ;Check if worklist was split to single claim
"RTN","RCDPEMA",45,0)
 N SUB,NBILL,OBILL
"RTN","RCDPEMA",46,0)
 ;Find split line in scratchpad
"RTN","RCDPEMA",47,0)
 S SUB=$O(^RCY(344.49,RCERA,1,"B",Z1,"")) Q:'SUB 0
"RTN","RCDPEMA",48,0)
 ;Get original claim number from scratchpad
"RTN","RCDPEMA",49,0)
 S OBILL=$P($G(^RCY(344.49,RCERA,1,SUB-1,0)),U,2)
"RTN","RCDPEMA",50,0)
 ;New claim number
"RTN","RCDPEMA",51,0)
 S NBILL=$P(RCSPL(Z,Z1),U,2)
"RTN","RCDPEMA",52,0)
 ;If new and old claim are not the same this is a move via split
"RTN","RCDPEMA",53,0)
 I OBILL'="",OBILL'=NBILL Q 1
"RTN","RCDPEMA",54,0)
 ;Otherwise this is not a split
"RTN","RCDPEMA",55,0)
 Q 0
"RTN","RCDPEMA",56,0)
 ;
"RTN","RCDPEMA",57,0)
DET(RCZ,RCR,RECTDA1,RCTRANDA) ; Store receipt detail
"RTN","RCDPEMA",58,0)
 ; RCZ = ien of entry file 344.49
"RTN","RCDPEMA",59,0)
 ; RCR = ien of entry in file 344.491
"RTN","RCDPEMA",60,0)
 ; RECTDA1 = ien of entry in file 344
"RTN","RCDPEMA",61,0)
 ; RCTRANDA = ien of entry in subfile 344.01
"RTN","RCDPEMA",62,0)
 ;
"RTN","RCDPEMA",63,0)
 N DIE,DA,DR,X,Y,Z,RCUP,RCCOM,RCZ0,RC0
"RTN","RCDPEMA",64,0)
 S RC0=$G(^RCY(344.49,RCZ,0))
"RTN","RCDPEMA",65,0)
 S RCZ0=$G(^RCY(344.49,RCZ,1,RCR,0))
"RTN","RCDPEMA",66,0)
 S DR="",RCUP=+$O(^RCY(344.49,RCZ,1,"B",+RCZ0/1,0)),RCUP=$G(^RCY(344.49,RCZ,1,RCUP,0))
"RTN","RCDPEMA",67,0)
 I $P(RCZ0,U,7) S DR=".09////^S X="_+$P(RCZ0,U,7)_"_$C(59)_""PRCA(430,"";"
"RTN","RCDPEMA",68,0)
 S DR=DR_".04////"_(+$P(RCZ0,U,3))_";.27////"_RCR_";"
"RTN","RCDPEMA",69,0)
 I $P(RC0,U,5)'="" S DR=DR_".1////"_$P(RC0,U,5)_";"
"RTN","RCDPEMA",70,0)
 I $P(RC0,U,6)'="" S DR=DR_".08////"_$P(RC0,U,6)_";"
"RTN","RCDPEMA",71,0)
 S Z=0 F  S Z=$O(^RCY(344.49,RCZ,1,RCR,1,Z)) Q:'Z  I $P($G(^(Z,0)),U,5)=1 S DR=DR_".28////1;" Q  ; Update receipt line with dec adj flag
"RTN","RCDPEMA",72,0)
 S RCCOM=$P(RCZ0,U,10)
"RTN","RCDPEMA",73,0)
 I $P(RCUP,U,2)["**ADJ" S RCCOM=RCCOM_$S(RCCOM'="":"/",1:"")_$S($P($P(RCUP,U,2),"ADJ",2):"ERA adjustment - no bill referenced",1:"Total of EFT mismatched to ERA")
"RTN","RCDPEMA",74,0)
 I RCCOM]"" S DR=DR_"1.02////"_$E(RCCOM,1,60)_";"
"RTN","RCDPEMA",75,0)
 I $P($G(^RCY(344.49,RCZ,0)),U,4)'="" S DR=DR_".07////"_$P($G(^RCY(344.49,RCZ,0)),U,4)_";"
"RTN","RCDPEMA",76,0)
 S DA(1)=RECTDA1,DA=RCTRANDA,DIE="^RCY(344,"_DA(1)_",1,"
"RTN","RCDPEMA",77,0)
 D ^DIE
"RTN","RCDPEMA",78,0)
 Q
"RTN","RCDPEMA",79,0)
 ;
"RTN","RCDPEMA",80,0)
BLDRCPT(RCERA) ; Create a receipt for Auto Posting ERA with multiple Receipts - alpha char at the 10th character
"RTN","RCDPEMA",81,0)
 ; LAYGO new entry to AR BATCH PAYMENT file (#344)
"RTN","RCDPEMA",82,0)
 ; input - RCERA = Pointer to 344.4
"RTN","RCDPEMA",83,0)
 ; returns new IEN on success, else zero
"RTN","RCDPEMA",84,0)
 ; called by auto-post process (RCDPEAP)
"RTN","RCDPEMA",85,0)
 ;
"RTN","RCDPEMA",86,0)
 N RECEIPT,TYPE,LASTREC
"RTN","RCDPEMA",87,0)
 S TYPE=$E($G(^RC(341.1,+$O(^RC(341.1,"AC",14,0)),0)))  ; ^RC(341.1,0) = AR EVENT TYPE
"RTN","RCDPEMA",88,0)
 ; retrieve the last receipt recorded on the ERA (if it exists)
"RTN","RCDPEMA",89,0)
 S LASTREC=$$GETREC(RCERA)
"RTN","RCDPEMA",90,0)
 ; Make sure last receipt for the ERA is 10-chars long and the last char is between A - Y (can't be Z),
"RTN","RCDPEMA",91,0)
 ; Otherwise grab a new number and append "A"
"RTN","RCDPEMA",92,0)
 I LASTREC'="",$L(LASTREC)=10,$A($E(LASTREC,10))>64,$A($E(LASTREC,10))<90 D
"RTN","RCDPEMA",93,0)
 . S RECEIPT=$E(LASTREC,1,9)_$C($A($E(LASTREC,10))+1)
"RTN","RCDPEMA",94,0)
 E  D
"RTN","RCDPEMA",95,0)
 . S RECEIPT=$$NEXT^RCDPUREC(TYPE_$E(DT,2,7))_"A"
"RTN","RCDPEMA",96,0)
 ;
"RTN","RCDPEMA",97,0)
 ; Prevents duplicate Receipt # entries from being filed
"RTN","RCDPEMA",98,0)
 F  Q:'$D(^RCY(344,"B",RECEIPT))  D
"RTN","RCDPEMA",99,0)
 . S RECEIPT=$E(RECEIPT,1)_$E(1000001+$E(RECEIPT,2,7),2,7)_$E(RECEIPT,8,9)_"A"
"RTN","RCDPEMA",100,0)
 ;
"RTN","RCDPEMA",101,0)
 L +^RCY(344,"B",RECEIPT):DILOCKTM E  Q 0  ; if LOCK timeout return zero
"RTN","RCDPEMA",102,0)
 ;
"RTN","RCDPEMA",103,0)
 ; add entry to AR BATCH PAYMENT file (#344)
"RTN","RCDPEMA",104,0)
 N %,%DT,D0,DA,DD,DI,DIC,DIE,DLAYGO,DO,DQ,DR,X,Y
"RTN","RCDPEMA",105,0)
 S DIC="^RCY(344,",DIC(0)="L",DLAYGO=344
"RTN","RCDPEMA",106,0)
 ;  .02 = opened by                  .03 = date opened = transmission dt
"RTN","RCDPEMA",107,0)
 ;  .04 = type of payment           
"RTN","RCDPEMA",108,0)
 ;  .14 = status (set to 1:open)
"RTN","RCDPEMA",109,0)
 S DIC("DR")=".02////"_DUZ_";.03///"_DT_";.04////14;.14////1;"
"RTN","RCDPEMA",110,0)
 S X=RECEIPT
"RTN","RCDPEMA",111,0)
 D FILE^DICN
"RTN","RCDPEMA",112,0)
 L -^RCY(344,"B",RECEIPT)
"RTN","RCDPEMA",113,0)
 I Y>0 Q +Y  ; Y set by DICN, return new IEN
"RTN","RCDPEMA",114,0)
 Q 0  ; entry not created
"RTN","RCDPEMA",115,0)
 ;
"RTN","RCDPEMA",116,0)
GETREC(RCERA) ; returns the receipt number
"RTN","RCDPEMA",117,0)
 ; input - RCERA = ien of entry in 344.4
"RTN","RCDPEMA",118,0)
 ; output - returns the receipt number in external form
"RTN","RCDPEMA",119,0)
 N X,RECEIPT
"RTN","RCDPEMA",120,0)
 S RECEIPT=""
"RTN","RCDPEMA",121,0)
 S X=$O(^RCY(344.4,RCERA,1,"RECEIPT",""),-1)  ; get last RECEIPT ien from 344.41 subfile
"RTN","RCDPEMA",122,0)
 S:X RECEIPT=$P($G(^RCY(344,X,0)),U)  ; get external form of receipt  
"RTN","RCDPEMA",123,0)
 Q RECEIPT
"RTN","RCDPESP")
0^1^B152385902^B152385563
"RTN","RCDPESP",1,0)
RCDPESP ;BIRM/EWL - ePayment Lockbox Site Parameters Definition - Files 344.61 & 344.6 ;Nov 19, 2014@15:26:16
"RTN","RCDPESP",2,0)
 ;;4.5;Accounts Receivable;**298,304,318**;Mar 20, 1995;Build 37
"RTN","RCDPESP",3,0)
 ;;Per VA Directive 6402, this routine should not be modified.
"RTN","RCDPESP",4,0)
 ;
"RTN","RCDPESP",5,0)
EN ; entry point for EDI Lockbox Parameters [RCDPE EDI LOCKBOX PARAMETERS]
"RTN","RCDPESP",6,0)
 N DA,DIC,DIE,DIR,DIRUT,DLAYGO,DR,DTOUT,DUOUT,X,Y  ; FileMan variables
"RTN","RCDPESP",7,0)
 ;
"RTN","RCDPESP",8,0)
 W !," Update AR Site Parameters",!
"RTN","RCDPESP",9,0)
 ;
"RTN","RCDPESP",10,0)
 S X="RCDPE AUTO DEC" I '$D(^XUSEC(X,DUZ)) W !!,"You do not hold the "_X_" security key." Q
"RTN","RCDPESP",11,0)
 ; Lock the parameter file
"RTN","RCDPESP",12,0)
 L +^RCY(344.61,1):DILOCKTM E  D  Q
"RTN","RCDPESP",13,0)
 .W !!," Another user is currently using the AR Site Parameters option."
"RTN","RCDPESP",14,0)
 .W !," Please try again later."
"RTN","RCDPESP",15,0)
 ;
"RTN","RCDPESP",16,0)
 ; Check parameter file
"RTN","RCDPESP",17,0)
 N FDAEDI,FDAPAYER,IEN,IENS,RCQUIT
"RTN","RCDPESP",18,0)
 ; FDAPAYER - FDA array for RCDPE AUTO-PAY EXCLUSION file (#344.6)
"RTN","RCDPESP",19,0)
 ; FDAEDI - FDA array for RCDPE PARAMETER file (#344.61)
"RTN","RCDPESP",20,0)
 ; RCAUDVAL - audit data for RCDPE PARAMETER AUDIT file (#344.7)
"RTN","RCDPESP",21,0)
 ; IEN - entry #
"RTN","RCDPESP",22,0)
 ; IENS - IEN_comma
"RTN","RCDPESP",23,0)
 ; RCQUIT - exit flag
"RTN","RCDPESP",24,0)
 ;
"RTN","RCDPESP",25,0)
 ; function returns 1 on success
"RTN","RCDPESP",26,0)
 S Y=$$EDILOCK^RCMSITE  ; Update EDI Lockbox site parameters
"RTN","RCDPESP",27,0)
 I 'Y G ABORT  ; user entered '^'
"RTN","RCDPESP",28,0)
 ;
"RTN","RCDPESP",29,0)
 ;----------------------------------------------
"RTN","RCDPESP",30,0)
 ; prca*4.5*304
"RTN","RCDPESP",31,0)
 ; Enable/disable auto-auditing of paper bills
"RTN","RCDPESP",32,0)
 ;----------------------------------------------
"RTN","RCDPESP",33,0)
 ;
"RTN","RCDPESP",34,0)
 S RCQUIT=0 W !
"RTN","RCDPESP",35,0)
 S RCQUIT=$$AUDIT^RCDPESP5
"RTN","RCDPESP",36,0)
 Q:RCQUIT
"RTN","RCDPESP",37,0)
 ;
"RTN","RCDPESP",38,0)
 W !
"RTN","RCDPESP",39,0)
 I '$D(^RCY(344.61,1,0)) W !,"There is a problem with the RCDPE PARAMETER file (#344.61)." G EXIT
"RTN","RCDPESP",40,0)
 ;
"RTN","RCDPESP",41,0)
 ;----------------------------------------------
"RTN","RCDPESP",42,0)
 ; Enable/disable auto-posting of medical claims
"RTN","RCDPESP",43,0)
 ;----------------------------------------------
"RTN","RCDPESP",44,0)
 N APMC,APMCT
"RTN","RCDPESP",45,0)
 ;PRCA*4.5*304 Move from Medical Auto decrease section below
"RTN","RCDPESP",46,0)
 N ADMC  ; ^DD(344.61,.03,0)="AUTO-DECREASE MED ENABLED^S^0:No;1:Yes;^0;3^Q"
"RTN","RCDPESP",47,0)
 S ADMC=""  ; Init in case Medical Auto Posting is turned off.
"RTN","RCDPESP",48,0)
 ;end PRCA*4.5*304
"RTN","RCDPESP",49,0)
 ; APMC=AUTO POSTING OF MEDICAL CLAIMS ENABLED
"RTN","RCDPESP",50,0)
 ; APMCT=TEMP APMC
"RTN","RCDPESP",51,0)
 S APMCT=$$GET1^DIQ(344.61,"1,",.02,"I"),APMC=$S(APMCT=1:"Yes",APMCT=0:"No",1:"")
"RTN","RCDPESP",52,0)
 K DIR S DIR(0)="YA",DIR("B")=$S(APMC="":"Y",1:APMC)
"RTN","RCDPESP",53,0)
 S DIR("A")=$$GET1^DID(344.61,.02,,"TITLE")
"RTN","RCDPESP",54,0)
 S DIR("?")=$$GET1^DID(344.61,.02,,"HELP-PROMPT")
"RTN","RCDPESP",55,0)
 D ^DIR I $D(DTOUT)!$D(DUOUT) G ABORT
"RTN","RCDPESP",56,0)
 I APMCT'=Y D  ; user updated value
"RTN","RCDPESP",57,0)
 .S FDAEDI(344.61,"1,",.02)=Y D FILE^DIE(,"FDAEDI") K FDAEDI
"RTN","RCDPESP",58,0)
 .D NOTIFY($S(Y=1:"Yes",Y=0:"No",1:"*missing*"))
"RTN","RCDPESP",59,0)
 .S RCAUDVAL(1)="344.61^.02^1^"_Y_U_('Y) D AUDIT(.RCAUDVAL) K RCAUDVAL
"RTN","RCDPESP",60,0)
 ;
"RTN","RCDPESP",61,0)
 I Y=0 G RXPARMS
"RTN","RCDPESP",62,0)
 ;
"RTN","RCDPESP",63,0)
 ; Set/Reset payer exclusions for medical claim posting
"RTN","RCDPESP",64,0)
 D EXCLLIST(1) ; Display the exclusion list
"RTN","RCDPESP",65,0)
 D SETEXCL(1) I $G(RCQUIT) G ABORT ; SET/RESET exclusions
"RTN","RCDPESP",66,0)
 D EXCLLIST(1) ; Display the exclusion list
"RTN","RCDPESP",67,0)
 W !
"RTN","RCDPESP",68,0)
 ;
"RTN","RCDPESP",69,0)
 ; Enable/disable auto-decrease of medical claims
"RTN","RCDPESP",70,0)
 K FDAEDI  ; used for FILE^DIE call
"RTN","RCDPESP",71,0)
 S ADMC=$$GET1^DIQ(344.61,"1,",.03,"I") ; get current value
"RTN","RCDPESP",72,0)
 K DIR S DIR(0)="YA",DIR("B")=$S(ADMC=""!(ADMC=1):"Yes",1:"No")
"RTN","RCDPESP",73,0)
 S DIR("A")=$$GET1^DID(344.61,.03,,"TITLE")
"RTN","RCDPESP",74,0)
 S DIR("?")=$$GET1^DID(344.61,.03,,"HELP-PROMPT")
"RTN","RCDPESP",75,0)
 D ^DIR I $D(DTOUT)!$D(DUOUT) G ABORT
"RTN","RCDPESP",76,0)
 ; if user changed value, update and audit
"RTN","RCDPESP",77,0)
 S:ADMC'=Y FDAEDI(344.61,"1,",.03)=Y,RCAUDVAL(1)="344.61^.03^1^"_Y_U_ADMC
"RTN","RCDPESP",78,0)
 I Y=0 D  G RXPARMS  ; value set to No, update (if needed), go to Pharmacy params.
"RTN","RCDPESP",79,0)
 . D:$D(FDAEDI) FILE^DIE(,"FDAEDI"),AUDIT(.RCAUDVAL) K RCAUDVAL
"RTN","RCDPESP",80,0)
 ;
"RTN","RCDPESP",81,0)
 ; If auto-decrease (medical for now) on, ask about CARC/RARC auto-decrease setup
"RTN","RCDPESP",82,0)
 W !
"RTN","RCDPESP",83,0)
 S RCQUIT=0
"RTN","RCDPESP",84,0)
 D CARC^RCDPESP5
"RTN","RCDPESP",85,0)
 W !
"RTN","RCDPESP",86,0)
 ; If no active CARCs Turn medical auto-decrease off, Then go to Pharacy params
"RTN","RCDPESP",87,0)
 I ($$COUNT(1)=0)&($$GET1^DIQ(344.61,"1,",.03,"I")=1) D  G RXPARMS
"RTN","RCDPESP",88,0)
 . K FDAEDI,RCAUDVAL
"RTN","RCDPESP",89,0)
 . S ADMC=$$GET1^DIQ(344.61,"1,",.03,"I")
"RTN","RCDPESP",90,0)
 . S FDAEDI(344.61,"1,",.03)=0,RCAUDVAL(1)="344.61^.03^1^"_0_U_ADMC_U_"SYSTEM disabled Medical Auto-decrease, there are NO active CARCs"
"RTN","RCDPESP",91,0)
 . D FILE^DIE(,"FDAEDI"),AUDIT(.RCAUDVAL) K RCAUDVAL
"RTN","RCDPESP",92,0)
 . W !,"*** System has DISABLED Medical Auto-decrease, there are NO active CARCs.",!
"RTN","RCDPESP",93,0)
 . D PAUSE
"RTN","RCDPESP",94,0)
 Q:RCQUIT
"RTN","RCDPESP",95,0)
 ;
"RTN","RCDPESP",96,0)
 ; Set number of days to wait before auto-decrease amount
"RTN","RCDPESP",97,0)
 N ADMT ; ^DD(344.61,.04,0) = AUTO-DECREASE MED DAYS DEFAULT
"RTN","RCDPESP",98,0)
 S ADMT=$$GET1^DIQ(344.61,"1,",.04)
"RTN","RCDPESP",99,0)
 K DIR S:ADMT]"" DIR("B")=ADMT
"RTN","RCDPESP",100,0)
 S (DIR("?"),DIR("??"))=$$GET1^DID(344.61,.04,,"HELP-PROMPT")
"RTN","RCDPESP",101,0)
 S DIR(0)="NA^0:7:0",DIR("A")=$$GET1^DID(344.61,.04,,"TITLE")
"RTN","RCDPESP",102,0)
 D ^DIR I $D(DTOUT)!$D(DUOUT) G ABORT
"RTN","RCDPESP",103,0)
 S:ADMT'=Y FDAEDI(344.61,"1,",.04)=Y,RCAUDVAL(2)="344.61^.04^1^"_Y_U_ADMT
"RTN","RCDPESP",104,0)
 ;
"RTN","RCDPESP",105,0)
 ; PRCA*4.5*304 - removed general auto-decrease amount in favor of auto-decrease by CARC
"RTN","RCDPESP",106,0)
 ;
"RTN","RCDPESP",107,0)
 ; file changes to medical auto-post and auto-decrease parameters
"RTN","RCDPESP",108,0)
 D FILE^DIE(,"FDAEDI")
"RTN","RCDPESP",109,0)
 D:$D(RCAUDVAL) AUDIT(.RCAUDVAL)
"RTN","RCDPESP",110,0)
 K RCAUDVAL
"RTN","RCDPESP",111,0)
 ;
"RTN","RCDPESP",112,0)
 ; Set/Reset payer exclusions for medical claim decrease
"RTN","RCDPESP",113,0)
 D EXCLLIST(2) ; Display the exclusion list
"RTN","RCDPESP",114,0)
 D SETEXCL(2) I $G(RCQUIT) G ABORT ; SET/RESET exclusions
"RTN","RCDPESP",115,0)
 D EXCLLIST(2) ; Display the exclusion list
"RTN","RCDPESP",116,0)
 W !
"RTN","RCDPESP",117,0)
 ;
"RTN","RCDPESP",118,0)
 ; code falls through
"RTN","RCDPESP",119,0)
 ;
"RTN","RCDPESP",120,0)
RXPARMS ; branch here from above
"RTN","RCDPESP",121,0)
 ;----------------------------------------------
"RTN","RCDPESP",122,0)
 ; Enable/disable auto-posting of pharmacy claims
"RTN","RCDPESP",123,0)
 ;----------------------------------------------
"RTN","RCDPESP",124,0)
 N APPC,APPCT
"RTN","RCDPESP",125,0)
 ; APPC=AUTO POSTING OF PHARMACY CLAIMS ENABLED
"RTN","RCDPESP",126,0)
 ; APPCT=TEMP APMC
"RTN","RCDPESP",127,0)
 S APPCT=$$GET1^DIQ(344.61,"1,",1.01,"I"),APPC=$S(APPCT=1:"Yes",APPCT=0:"No",1:"")
"RTN","RCDPESP",128,0)
 K DIR S DIR(0)="YA",DIR("B")=$S(APPC="":"Yes",1:APPC)
"RTN","RCDPESP",129,0)
 S DIR("A")=$$GET1^DID(344.61,1.01,,"TITLE")
"RTN","RCDPESP",130,0)
 S DIR("?")=$$GET1^DID(344.61,1.01,,"HELP-PROMPT")
"RTN","RCDPESP",131,0)
 D ^DIR I $D(DTOUT)!$D(DUOUT) G ABORT
"RTN","RCDPESP",132,0)
 I APPCT'=Y D  ; user updated value
"RTN","RCDPESP",133,0)
 .S FDAEDI(344.61,"1,",1.01)=Y D FILE^DIE(,"FDAEDI") K FDAEDI
"RTN","RCDPESP",134,0)
 .D NOTIFY($S(Y=1:"Yes",Y=0:"No",1:"*missing*"),1)
"RTN","RCDPESP",135,0)
 .S RCAUDVAL(1)="344.61^1.01^1^"_Y_U_('Y) D AUDIT(.RCAUDVAL) K RCAUDVAL
"RTN","RCDPESP",136,0)
 ;
"RTN","RCDPESP",137,0)
 ; If yes, set/Reset payer exclusions for pharmacy claims posting
"RTN","RCDPESP",138,0)
 I Y=1 D  G:$G(RCQUIT)=1 ABORT
"RTN","RCDPESP",139,0)
 . D EXCLLIST(3) ; Display the exclusion list
"RTN","RCDPESP",140,0)
 . D SETEXCL(3) Q:$G(RCQUIT)  ; SET/RESET exclusions
"RTN","RCDPESP",141,0)
 . D EXCLLIST(3) ; Display the exclusion list
"RTN","RCDPESP",142,0)
 . W !
"RTN","RCDPESP",143,0)
 . ;
"RTN","RCDPESP",144,0)
 ;
"RTN","RCDPESP",145,0)
 ; Show Pharmacy prompt but don't allow change
"RTN","RCDPESP",146,0)
 D:$$GET1^DIQ(344.61,"1,",1.01,"I")=1  G:$G(RCQUIT)=1 ABORT
"RTN","RCDPESP",147,0)
 . W !,"ENABLE AUTO-DECREASE OF PHARMACY CLAIMS (Y/N): NO//"
"RTN","RCDPESP",148,0)
 . W !,"   Determines if auto-decrease of pharmacy claims are enabled for this site."
"RTN","RCDPESP",149,0)
 . W !,"   NOTE:  Not editable and set to Disabled until further notice.",!
"RTN","RCDPESP",150,0)
 . K DIR S DIR(0)="EA"
"RTN","RCDPESP",151,0)
 . S DIR("A")="Press Enter to continue: "
"RTN","RCDPESP",152,0)
 . D ^DIR I $D(DTOUT)!$D(DUOUT) S RCQUIT=1
"RTN","RCDPESP",153,0)
 . W !
"RTN","RCDPESP",154,0)
 ;
"RTN","RCDPESP",155,0)
 ; set MEDICAL EFT OVERRIDE ^DD(344.61,.06,0) = MEDICAL EFT POST PREVENT DAYS
"RTN","RCDPESP",156,0)
 N MEO S MEO=$$GET1^DIQ(344.61,"1,",.06)
"RTN","RCDPESP",157,0)
 K DIR S:MEO]"" DIR("B")=MEO
"RTN","RCDPESP",158,0)
 S DIR("?")=$$GET1^DID(344.61,.06,,"HELP-PROMPT")
"RTN","RCDPESP",159,0)
 S DIR(0)="NA^14:99:0",DIR("A")=$$GET1^DID(344.61,.06,,"TITLE")
"RTN","RCDPESP",160,0)
 D ^DIR I $D(DTOUT)!$D(DUOUT) G ABORT
"RTN","RCDPESP",161,0)
 I MEO'=Y D  ; update and audit
"RTN","RCDPESP",162,0)
 .S RCAUDVAL(1)="344.61^.06^1^"_Y_U_MEO
"RTN","RCDPESP",163,0)
 .S FDAEDI(344.61,"1,",.06)=Y D FILE^DIE(,"FDAEDI")
"RTN","RCDPESP",164,0)
 .D AUDIT(.RCAUDVAL) K RCAUDVAL
"RTN","RCDPESP",165,0)
 ;
"RTN","RCDPESP",166,0)
 ;----------------------------------------------
"RTN","RCDPESP",167,0)
 ; Set PHARMACY EFT OVERRIDE
"RTN","RCDPESP",168,0)
 ;----------------------------------------------
"RTN","RCDPESP",169,0)
 N PEO S PEO=$$GET1^DIQ(344.61,"1,",.07)
"RTN","RCDPESP",170,0)
 K DIR S:PEO]"" DIR("B")=PEO
"RTN","RCDPESP",171,0)
 S DIR("?")=$$GET1^DID(344.61,.07,,"HELP-PROMPT")
"RTN","RCDPESP",172,0)
 S DIR(0)="NA^21:999:0",DIR("A")=$$GET1^DID(344.61,.07,,"TITLE")
"RTN","RCDPESP",173,0)
 D ^DIR I $D(DTOUT)!$D(DUOUT) G ABORT
"RTN","RCDPESP",174,0)
 I PEO'=Y D  ; update and audit
"RTN","RCDPESP",175,0)
 .S RCAUDVAL(1)="344.61^.07^1^"_Y_U_PEO
"RTN","RCDPESP",176,0)
 .S FDAEDI(344.61,"1,",.07)=Y D FILE^DIE(,"FDAEDI")
"RTN","RCDPESP",177,0)
 .D AUDIT(.RCAUDVAL) K RCAUDVAL
"RTN","RCDPESP",178,0)
 ;
"RTN","RCDPESP",179,0)
 G EXIT
"RTN","RCDPESP",180,0)
 ;
"RTN","RCDPESP",181,0)
ABORT ; Called when user enters a '^' or times out
"RTN","RCDPESP",182,0)
 ; fall through to EXIT
"RTN","RCDPESP",183,0)
 ;
"RTN","RCDPESP",184,0)
EXIT ; unLOCK, ask user to press return, exit
"RTN","RCDPESP",185,0)
 L -^RCY(344.61,1)
"RTN","RCDPESP",186,0)
 D PAUSE
"RTN","RCDPESP",187,0)
 Q
"RTN","RCDPESP",188,0)
 ;
"RTN","RCDPESP",189,0)
PAUSE ; prompt user to press return
"RTN","RCDPESP",190,0)
 W ! N DIR
"RTN","RCDPESP",191,0)
 S DIR("T")=3,DIR(0)="E",DIR("A")="Press RETURN to continue" D ^DIR
"RTN","RCDPESP",192,0)
 Q
"RTN","RCDPESP",193,0)
 ;
"RTN","RCDPESP",194,0)
COUNT(TYPE) ; Count active CARCs in file 344.62 (RCDPE CARC-RARC AUTO DEC)
"RTN","RCDPESP",195,0)
 N NUM,I
"RTN","RCDPESP",196,0)
 I (TYPE'=1)&(TYPE'=0) Q 0  ; If TYPE is not active (1) or in-active (0) quit with count = 0
"RTN","RCDPESP",197,0)
 S NUM=0
"RTN","RCDPESP",198,0)
 S I="" F  S I=$O(^RCY(344.62,"ACTV",TYPE,I)) Q:I=""  S NUM=NUM+1
"RTN","RCDPESP",199,0)
 Q NUM
"RTN","RCDPESP",200,0)
 ;
"RTN","RCDPESP",201,0)
EXCLLIST(TYP) ; CHOICE determines which exclusions to list
"RTN","RCDPESP",202,0)
 ; TYP - TYPE OF EXLUSION - REQUIRED
"RTN","RCDPESP",203,0)
 ; IX - which index to use
"RTN","RCDPESP",204,0)
 ; IEN - points to an excluded payer for the selected choice
"RTN","RCDPESP",205,0)
 Q:'("^1^2^3^"[(U_$G(TYP)_U))  ; one or two only
"RTN","RCDPESP",206,0)
 N IX,IEN,CT,LIST S (IEN,CT)=0 W !
"RTN","RCDPESP",207,0)
 S IX=$S(TYP=1:"EXMDPOST",TYP=2:"EXMDDECR",TYP=3:"EXRXPOST",1:"") ;,TYP=4:"EXRXDECR",1:"")
"RTN","RCDPESP",208,0)
 S LIST=$S(TYP=1:"",TYP=3:"",1:"** Additional ")_"Payers excluded from "_$S(TYP=1:"Medical Auto-Posting:",TYP=3:"Pharmacy Auto-Posting",1:"Medical Auto-Decrease:")
"RTN","RCDPESP",209,0)
 F  S IEN=$O(^RCY(344.6,IX,1,IEN)) Q:'IEN  D
"RTN","RCDPESP",210,0)
 . S CT=CT+1
"RTN","RCDPESP",211,0)
 . W:CT=1 !,LIST
"RTN","RCDPESP",212,0)
 . W !,"  "_$P(^RCY(344.6,IEN,0),U,1)_" "_$P(^RCY(344.6,IEN,0),U,2)
"RTN","RCDPESP",213,0)
 ;
"RTN","RCDPESP",214,0)
 I TYP=2 W !,"All payers excluded from Auto-Posting are also excluded from Auto-Decrease."
"RTN","RCDPESP",215,0)
 W:CT=0 !,"   No "_$S(TYP=2:"additional ",1:"")_"payers excluded from "_$S(TYP=1:"Medical Auto-Posting:",TYP=3:"Pharmacy Auto-Posting",1:"Medical Auto-Decrease:")
"RTN","RCDPESP",216,0)
 ; if list is for auto-decrease and there are exclusions write a message
"RTN","RCDPESP",217,0)
 Q
"RTN","RCDPESP",218,0)
 ;
"RTN","RCDPESP",219,0)
SETEXCL(TYP) ; LOOP FOR SETTING PAYER EXCLUSIONS
"RTN","RCDPESP",220,0)
 ; TYP - TYPE OF EXLUSION - REQUIRED
"RTN","RCDPESP",221,0)
 N FDAPAYER,IEN,DONE,CT,X,Y,FLD,RTYP,DIC,DIR,RCAUDVAL,PREC,CMT
"RTN","RCDPESP",222,0)
 ; FDAPAYER - FDA FOR FILE 344.6
"RTN","RCDPESP",223,0)
 ; FLD - FIELD BEING MODIFIED
"RTN","RCDPESP",224,0)
 ; RTYP - STRING REPRESENTING FIELD
"RTN","RCDPESP",225,0)
 ; DONE - INDICATOR TO LEAVE LOOP
"RTN","RCDPESP",226,0)
 ; RCAUDVAL - ARRAY FOR AUDITING
"RTN","RCDPESP",227,0)
 ; PREC - HOLDER FOR Y(0) AFTER ^DIC CALL
"RTN","RCDPESP",228,0)
 ;         FILE NUMBER^FIELD NUMBER^IEN^NEW VALUE^OLD VALUE,COMMENT
"RTN","RCDPESP",229,0)
 I $G(TYP)=1 S FLD=.06,CMT=1,RTYP="MEDICAL CLAIMS POSTING"
"RTN","RCDPESP",230,0)
 I $G(TYP)=2 S FLD=.07,CMT=2,RTYP="MEDICAL CLAIMS DECREASE"
"RTN","RCDPESP",231,0)
 I $G(TYP)=3 S FLD=.08,CMT=3,RTYP="PHARMACY CLAIMS POSTING"
"RTN","RCDPESP",232,0)
 I '$D(FLD) Q 
"RTN","RCDPESP",233,0)
 ;
"RTN","RCDPESP",234,0)
 W !!,"Select a Payer to add or remove from the exclusion list.",!
"RTN","RCDPESP",235,0)
 S (RCQUIT,CT,DONE)=0 F  Q:DONE!RCQUIT  D
"RTN","RCDPESP",236,0)
 . S DIC="^RCY(344.6,",DIC(0)="AEMQZ",DIC("A")="Payer: " D ^DIC I X="^" S RCQUIT=1 Q
"RTN","RCDPESP",237,0)
 . I +$G(Y)<1 S DONE=1 Q
"RTN","RCDPESP",238,0)
 . S CT=CT+1,IEN=+Y,IENS=IEN_",",PREC=Y(0)
"RTN","RCDPESP",239,0)
 . K FDAPAYER
"RTN","RCDPESP",240,0)
 . N COMMENT,STAT
"RTN","RCDPESP",241,0)
 . S COMMENT=""
"RTN","RCDPESP",242,0)
 . S STAT='$$GET1^DIQ(344.6,IENS,FLD,"I")
"RTN","RCDPESP",243,0)
 . S FDAPAYER(344.6,IENS,FLD)=STAT
"RTN","RCDPESP",244,0)
 . ; GET COMMENT HERE
"RTN","RCDPESP",245,0)
 . K Y S DIR("A")="COMMENT: ",DIR(0)="FA^3:72"
"RTN","RCDPESP",246,0)
 . S DIR("PRE")="S X=$$TRIM^XLFSTR(X,""LR"")" ; comment required and should be significant
"RTN","RCDPESP",247,0)
 . S DIR("?")="Enter an explanation for "_$S(STAT:"adding the payer to",1:"removing the payer from")_" the list of Excluded Payers."
"RTN","RCDPESP",248,0)
 . D ^DIR I $D(DTOUT)!$D(DUOUT)!(Y="") S RCQUIT=1 Q
"RTN","RCDPESP",249,0)
 . S COMMENT=Y
"RTN","RCDPESP",250,0)
 . I COMMENT]"" D
"RTN","RCDPESP",251,0)
 . . I STAT S FDAPAYER(344.6,IENS,CMT)=COMMENT
"RTN","RCDPESP",252,0)
 . . E  S FDAPAYER(344.6,IENS,CMT)=""
"RTN","RCDPESP",253,0)
 . . W !,$P(PREC,U,1)_" "_$P(PREC,U,2)_" has been "
"RTN","RCDPESP",254,0)
 . . W $S(STAT:"added to",1:"removed from")_" the list of Excluded Payers"
"RTN","RCDPESP",255,0)
 . . I TYP=1 D
"RTN","RCDPESP",256,0)
 . . . W !,"If medical auto-decrease is turned on, "
"RTN","RCDPESP",257,0)
 . . . I STAT W "this payer will be excluded from medical auto-decrease too."
"RTN","RCDPESP",258,0)
 . . . I 'STAT,'$$GET1^DIQ(344.6,IEN_",",.07,"I") W "this payer will no longer be excluded from Medical Auto-Decrease."
"RTN","RCDPESP",259,0)
 . . . I 'STAT,$$GET1^DIQ(344.6,IEN_",",.07,"I") W "Medical Auto-Decrease is set to be excluded for this payer."
"RTN","RCDPESP",260,0)
 . . K RCAUDVAL
"RTN","RCDPESP",261,0)
 . . D FILE^DIE(,"FDAPAYER")
"RTN","RCDPESP",262,0)
 . . S RCAUDVAL(1)="344.6"_U_FLD_U_IEN_U_STAT_U_('STAT)_U_COMMENT
"RTN","RCDPESP",263,0)
 . . D AUDIT(.RCAUDVAL) K RCAUDVAL
"RTN","RCDPESP",264,0)
 Q
"RTN","RCDPESP",265,0)
 ;
"RTN","RCDPESP",266,0)
NOTIFY(VAL,TYPE) ; Notify CBO team of change to Site Parameters
"RTN","RCDPESP",267,0)
 N GLB,GLO,MSG,SITE,SUBJ,XMINSTR,XMTO
"RTN","RCDPESP",268,0)
 S SITE=$$SITE^VASITE
"RTN","RCDPESP",269,0)
 S TYPE=+$G(TYPE)  ;init optional parameter
"RTN","RCDPESP",270,0)
 ; limit subject to 65 chars.
"RTN","RCDPESP",271,0)
 S SUBJ=$E("Site Parameter edit, Station #"_$P(SITE,U,3)_" - "_$P(SITE,U,2),1,65)
"RTN","RCDPESP",272,0)
 S MSG(1)=" "
"RTN","RCDPESP",273,0)
 S MSG(2)="        Site: "_$P(SITE,U,2)
"RTN","RCDPESP",274,0)
 S MSG(3)="   Station #: "_$P(SITE,U,3)
"RTN","RCDPESP",275,0)
 S MSG(4)="      Domain: "_$G(^XMB("NETNAME"))
"RTN","RCDPESP",276,0)
 S MSG(5)="   Date/Time: "_$$FMTE^XLFDT($$NOW^XLFDT,"5ZPM")
"RTN","RCDPESP",277,0)
 S MSG(6)="  Changed by: "_$P($G(^VA(200,DUZ,0)),U)
"RTN","RCDPESP",278,0)
 S MSG(7)=" "
"RTN","RCDPESP",279,0)
 S MSG(8)="  ENABLE AUTO-POSTING OF "_$S(TYPE=1:"PHARMACY",1:"MEDICAL")_" CLAIMS = "_VAL
"RTN","RCDPESP",280,0)
 S MSG(9)=" "
"RTN","RCDPESP",281,0)
 ;Copy message to ePayments CBO team
"RTN","RCDPESP",282,0)
 S XMTO(DUZ)=""
"RTN","RCDPESP",283,0)
 S:$$PROD^XUPROD XMTO("VHAEPAYMENTS@DOMAIN.EXT")=""
"RTN","RCDPESP",284,0)
 ;
"RTN","RCDPESP",285,0)
 K ^TMP("XMERR",$J)
"RTN","RCDPESP",286,0)
 D SENDMSG^XMXAPI(DUZ,SUBJ,"MSG",.XMTO,.XMINSTR)
"RTN","RCDPESP",287,0)
 ;
"RTN","RCDPESP",288,0)
 I $D(^TMP("XMERR",$J)) D
"RTN","RCDPESP",289,0)
 .D MES^XPDUTL("MailMan reported a problem trying to send the notification message.")
"RTN","RCDPESP",290,0)
 .D MES^XPDUTL("  ")
"RTN","RCDPESP",291,0)
 .S (GLO,GLB)="^TMP(""XMERR"","_$J
"RTN","RCDPESP",292,0)
 .S GLO=GLO_")"
"RTN","RCDPESP",293,0)
 .F  S GLO=$Q(@GLO) Q:GLO'[GLB  D MES^XPDUTL("   "_GLO_" = "_$G(@GLO))
"RTN","RCDPESP",294,0)
 .D MES^XPDUTL("  ")
"RTN","RCDPESP",295,0)
 Q
"RTN","RCDPESP",296,0)
 ;
"RTN","RCDPESP",297,0)
AUDIT(INP) ; WRITE AUDIT RECORD(S)
"RTN","RCDPESP",298,0)
 ; INP = audit value in this format:
"RTN","RCDPESP",299,0)
 ;       FILE NUMBER^FIELD NUMBER^IEN^NEW VALUE^OLD VALUE^COMMENT
"RTN","RCDPESP",300,0)
 Q:'$O(INP(0))   ; nothing to audit
"RTN","RCDPESP",301,0)
 N FDAUDT  ; FileMan FDA array for audits
"RTN","RCDPESP",302,0)
 N IDX S IDX=0
"RTN","RCDPESP",303,0)
 F  S IDX=$O(INP(IDX)) Q:'IDX  D
"RTN","RCDPESP",304,0)
 . K FDAUDT
"RTN","RCDPESP",305,0)
 . S FDAUDT(344.7,"+1,",.01)=$$NOW^XLFDT
"RTN","RCDPESP",306,0)
 . S FDAUDT(344.7,"+1,",.02)=$P(INP(IDX),U,3) ; IEN
"RTN","RCDPESP",307,0)
 . S FDAUDT(344.7,"+1,",.03)=DUZ  ; user
"RTN","RCDPESP",308,0)
 . S FDAUDT(344.7,"+1,",.04)=$P(INP(IDX),U,2) ; FIELD NUMBER
"RTN","RCDPESP",309,0)
 . S FDAUDT(344.7,"+1,",.05)=$P(INP(IDX),U,1) ; FILE NUMBER
"RTN","RCDPESP",310,0)
 . S FDAUDT(344.7,"+1,",.06)=$P(INP(IDX),U,4) ; NEW VALUE
"RTN","RCDPESP",311,0)
 . S FDAUDT(344.7,"+1,",.07)=$P(INP(IDX),U,5) ; OLD VALUE
"RTN","RCDPESP",312,0)
 . S FDAUDT(344.7,"+1,",.08)=$P(INP(IDX),U,6) ; COMMENT
"RTN","RCDPESP",313,0)
 . D UPDATE^DIE(,"FDAUDT")
"RTN","RCDPESP",314,0)
 Q
"RTN","RCDPESP",315,0)
 ;
"RTN","RCDPESP",316,0)
 ; *************************************************************
"RTN","RCDPESP",317,0)
 ; CALLS RELATED TO CREATING EPAYMENT PAYER EXCLUSION PARAMETERS
"RTN","RCDPESP",318,0)
 ; *************************************************************
"RTN","RCDPESP",319,0)
 ;
"RTN","RCDPESP",320,0)
NEWPYR ;Add new payers to payer table - called from AR Nightly Job (EN^RCDPEM)
"RTN","RCDPESP",321,0)
 N RCDATE,RCERA,RCUPD
"RTN","RCDPESP",322,0)
 ;Get date/time of last run otherwise start at previous day
"RTN","RCDPESP",323,0)
 S RCDATE=$P($G(^RCY(344.61,1,0)),U,8) S:RCDATE="" RCDATE=$$FMADD^XLFDT($$NOW^XLFDT\1,-1)
"RTN","RCDPESP",324,0)
 F  S RCDATE=$O(^RCY(344.4,"AFD",RCDATE)) Q:'RCDATE  D
"RTN","RCDPESP",325,0)
 .S RCERA="" F  S RCERA=$O(^RCY(344.4,"AFD",RCDATE,RCERA)) Q:'RCERA  S RCUPD=$$PAYRINIT(RCERA)
"RTN","RCDPESP",326,0)
 ;Update last run date
"RTN","RCDPESP",327,0)
 S $P(^RCY(344.61,1,0),U,8)=$$NOW^XLFDT
"RTN","RCDPESP",328,0)
 Q
"RTN","RCDPESP",329,0)
 ;
"RTN","RCDPESP",330,0)
PAYERPRM(IEN,EXMDPOST,EXMDDECR) ; USED TO UPDATE A NEW PAYER
"RTN","RCDPESP",331,0)
 ; CHECK IEN FOR VALID INPUT
"RTN","RCDPESP",332,0)
 Q:'$G(IEN)!('$D(^RCY(344.4,+$G(IEN),0))) 0
"RTN","RCDPESP",333,0)
 N PFDA,PAYER,ID,CPAYERID,PIENS
"RTN","RCDPESP",334,0)
 S PAYER=$E($$GET1^DIQ(344.4,IEN_",",.06),1,35)
"RTN","RCDPESP",335,0)
 Q:PAYER="" 0
"RTN","RCDPESP",336,0)
 S ID=$E($$GET1^DIQ(344.4,IEN_",",.03),1,30)
"RTN","RCDPESP",337,0)
 I '$D(^RCY(344.6,"CPID",PAYER,ID)) Q 0
"RTN","RCDPESP",338,0)
 ; FILE CURRENT SETTINGS
"RTN","RCDPESP",339,0)
 S PIENS=$O(^RCY(344.6,"CPID",PAYER,ID,0))_","
"RTN","RCDPESP",340,0)
 S PFDA(344.6,PIENS,.04)=DUZ
"RTN","RCDPESP",341,0)
 S PFDA(344.6,PIENS,.05)=$$NOW^XLFDT
"RTN","RCDPESP",342,0)
 S PFDA(344.6,PIENS,.06)=+$G(EXMDPOST)
"RTN","RCDPESP",343,0)
 S PFDA(344.6,PIENS,.07)=+$G(EXMDDECR)
"RTN","RCDPESP",344,0)
 D FILE^DIE(,"PFDA")
"RTN","RCDPESP",345,0)
 Q 1
"RTN","RCDPESP",346,0)
 ;
"RTN","RCDPESP",347,0)
PAYRINIT(IEN) ; Add Payer Name and Payer ID to Payer table #344.6 
"RTN","RCDPESP",348,0)
 ;
"RTN","RCDPESP",349,0)
 N PFDA,PAYER,ID,PIENS,ERADATE
"RTN","RCDPESP",350,0)
 ;
"RTN","RCDPESP",351,0)
 Q:'$G(IEN)!('$D(^RCY(344.4,+$G(IEN)))) 0
"RTN","RCDPESP",352,0)
 S PAYER=$P($G(^RCY(344.4,IEN,0)),U,6) Q:PAYER="" 0
"RTN","RCDPESP",353,0)
 S ID=$P($G(^RCY(344.4,IEN,0)),U,3) Q:ID="" 0
"RTN","RCDPESP",354,0)
 I $D(^RCY(344.6,"CPID",PAYER,ID)) Q 1
"RTN","RCDPESP",355,0)
 S ERADATE=$P($G(^RCY(344.4,IEN,0)),U,7)
"RTN","RCDPESP",356,0)
 ; UPDATE PAYER PARAMETERS
"RTN","RCDPESP",357,0)
 S PIENS="+1,"
"RTN","RCDPESP",358,0)
 S PFDA(344.6,PIENS,.01)=PAYER
"RTN","RCDPESP",359,0)
 S PFDA(344.6,PIENS,.02)=ID
"RTN","RCDPESP",360,0)
 S PFDA(344.6,PIENS,.03)=ERADATE
"RTN","RCDPESP",361,0)
 S PFDA(344.6,PIENS,.04)=.5
"RTN","RCDPESP",362,0)
 S PFDA(344.6,PIENS,.05)=$$NOW^XLFDT
"RTN","RCDPESP",363,0)
 S PFDA(344.6,PIENS,.06)=0
"RTN","RCDPESP",364,0)
 S PFDA(344.6,PIENS,.07)=0
"RTN","RCDPESP",365,0)
 D UPDATE^DIE(,"PFDA")
"RTN","RCDPESP",366,0)
 Q 1
"RTN","RCDPESP1")
0^4^B102077824^B102077824
"RTN","RCDPESP1",1,0)
RCDPESP1 ;BIRM/SAB,hrubovcak - ePayment Lockbox Site Parameter Reports ;7/1/15
"RTN","RCDPESP1",2,0)
 ;;4.5;Accounts Receivable;**298,304,318**;Mar 20, 1995;Build 37
"RTN","RCDPESP1",3,0)
 ;Per VA Directive 6402, this routine should not be modified.
"RTN","RCDPESP1",4,0)
 ;
"RTN","RCDPESP1",5,0)
 Q
"RTN","RCDPESP1",6,0)
 ;
"RTN","RCDPESP1",7,0)
RPT ; EDI Lockbox Parameters Report [RCDPE SITE PARAMETER REPORT]
"RTN","RCDPESP1",8,0)
 ; report data from:
"RTN","RCDPESP1",9,0)
 ;    AR SITE PARAMETER file (#342)
"RTN","RCDPESP1",10,0)
 ;    RCDPE PARAMETER file (#344.61)
"RTN","RCDPESP1",11,0)
 ;    RCDPE AUTO-PAY EXCLUSION file (#344.6)
"RTN","RCDPESP1",12,0)
 ;
"RTN","RCDPESP1",13,0)
 ; LOCAL VARIABLES:
"RTN","RCDPESP1",14,0)
 ;    RTYPE - Type of Report to run (Medical, Pharmacy, or Both)
"RTN","RCDPESP1",15,0)
 ;
"RTN","RCDPESP1",16,0)
 N RCTYPE
"RTN","RCDPESP1",17,0)
 W !,$$HDRLN,!
"RTN","RCDPESP1",18,0)
 ;
"RTN","RCDPESP1",19,0)
 S RCTYPE=$$RTYPE^RCDPESP2() G:RCTYPE=-1 RPTQ
"RTN","RCDPESP1",20,0)
 W !!   ;Spacing before the next prompt
"RTN","RCDPESP1",21,0)
 ;
"RTN","RCDPESP1",22,0)
 N %ZIS,POP S %ZIS="QM" D ^%ZIS Q:POP
"RTN","RCDPESP1",23,0)
 I $D(IO("Q")) D  Q
"RTN","RCDPESP1",24,0)
 .N ZTDESC,ZTQUEUED,ZTRTN,ZTSAVE,ZTSK
"RTN","RCDPESP1",25,0)
 .S ZTRTN="SPRPT^RCDPESP1",ZTDESC=$$HDRLN,ZTSAVE("RC*")=""
"RTN","RCDPESP1",26,0)
 .D ^%ZTLOAD
"RTN","RCDPESP1",27,0)
 .W !!,$S($G(ZTSK):"Task number "_ZTSK_" has been queued.",1:"Unable to queue this task.")
"RTN","RCDPESP1",28,0)
 .K IO("Q") D HOME^%ZIS
"RTN","RCDPESP1",29,0)
 ;
"RTN","RCDPESP1",30,0)
 D SPRPT
"RTN","RCDPESP1",31,0)
RPTQ Q
"RTN","RCDPESP1",32,0)
 ;
"RTN","RCDPESP1",33,0)
SPRPT ; site parameter report entry point
"RTN","RCDPESP1",34,0)
 ; RCNTR - counter
"RTN","RCDPESP1",35,0)
 ; RCFLD - DD field number
"RTN","RCDPESP1",36,0)
 ; RCHDR - header information
"RTN","RCDPESP1",37,0)
 ; RCPARM - parameters
"RTN","RCDPESP1",38,0)
 ; RCSTOP - exit flag
"RTN","RCDPESP1",39,0)
 N J,RCNTR,RCFLD,RCGLB,RCHDR,RCPARM,RCSTOP,V,X,Y,RCSTRING
"RTN","RCDPESP1",40,0)
 N RCDATA,RCCODE,RCDESC,RCSTAT,RCI,RCCARCD,RCCIEN,RCITEM,RCACTV
"RTN","RCDPESP1",41,0)
 ;
"RTN","RCDPESP1",42,0)
 S X="RC" F  S X=$O(^TMP($J,X)) Q:'($E(X,1,2)="RC")  K ^TMP($J,X) ; clear out old data
"RTN","RCDPESP1",43,0)
 ;
"RTN","RCDPESP1",44,0)
 ; RCGLB - ^TMP global storage locations
"RTN","RCDPESP1",45,0)
 ;     ^TMP($J,"RC342") - AR SITE PARAMETER file (#342)
"RTN","RCDPESP1",46,0)
 ;   ^TMP($J,"RC344.6") - RCDPE AUTO-PAY EXCLUSION file (#344.6)
"RTN","RCDPESP1",47,0)
 ;  ^TMP($J,"RC344.61") - RCDPE PARAMETER file (#344.61)
"RTN","RCDPESP1",48,0)
 F J=342,344.6,344.61 S RCGLB(J)=$NA(^TMP($J,"RC"_J)) K @RCGLB(J)
"RTN","RCDPESP1",49,0)
 ;
"RTN","RCDPESP1",50,0)
 S RCHDR("RUNDATE")=$$FMTE^XLFDT($$NOW^XLFDT,"10S")
"RTN","RCDPESP1",51,0)
 S RCHDR("PGNMBR")=0  ; page number
"RTN","RCDPESP1",52,0)
 ;
"RTN","RCDPESP1",53,0)
 ; AR SITE PARAMETER file (#342)
"RTN","RCDPESP1",54,0)
 D GETS^DIQ(342,"1,",".01;7.02;7.03;7.04;7.05;7.06","E",RCGLB(342))
"RTN","RCDPESP1",55,0)
 ; add site to header data
"RTN","RCDPESP1",56,0)
 S RCHDR("SITE")="Site: "_@RCGLB(342)@(342,"1,",.01,"E")
"RTN","RCDPESP1",57,0)
 ;
"RTN","RCDPESP1",58,0)
 F RCFLD=7.02,7.03,7.04,7.05,7.06 S RCITEM=$S(RCFLD=7.05:"TITLE",RCFLD=7.06:"TITLE",1:"LABEL") D  ; EFT and ERA days unmatched
"RTN","RCDPESP1",59,0)
 . Q:(RCFLD=7.05)&(RCTYPE="P")  ; Dont display if only showing Pharmacy parameters
"RTN","RCDPESP1",60,0)
 . Q:(RCFLD=7.06)&(RCTYPE="M")  ; Dont display if only showing medical parameters
"RTN","RCDPESP1",61,0)
 . S Y=$$GET1^DID(342,RCFLD,,RCITEM)_": "_@RCGLB(342)@(342,"1,",RCFLD,"E")
"RTN","RCDPESP1",62,0)
 . I RCFLD=7.05 D AD2RPT(" ")
"RTN","RCDPESP1",63,0)
 . I (RCFLD=7.06)&(RCTYPE="P") D AD2RPT(" ")
"RTN","RCDPESP1",64,0)
 . D AD2RPT(Y)
"RTN","RCDPESP1",65,0)
 ;
"RTN","RCDPESP1",66,0)
 D AD2RPT(" ")
"RTN","RCDPESP1",67,0)
 ;
"RTN","RCDPESP1",68,0)
 ; Display Medical Parameters
"RTN","RCDPESP1",69,0)
 ; RCDPE PARAMETER file (#344.61)
"RTN","RCDPESP1",70,0)
 D GETS^DIQ(344.61,"1,",".02;.03;.04;.05;.06;.07;1.01;1.02","E",RCGLB(344.61))
"RTN","RCDPESP1",71,0)
 ; get auto-post and auto-decrease settings, save zero node
"RTN","RCDPESP1",72,0)
 S X=$G(^RCY(344.61,1,0)),RCPARM("AUTO-POST")=$P(X,U,2),RCPARM("AUTO-DECREASE")=$P(X,U,3),RCPARM(344.61,0)=X
"RTN","RCDPESP1",73,0)
 S RCPARM("RX AUTO-POST")=$P($G(^RCY(344.61,1,1)),U)
"RTN","RCDPESP1",74,0)
 ;
"RTN","RCDPESP1",75,0)
 ; RCDPE AUTO-PAY EXCLUSION file (#344.6)
"RTN","RCDPESP1",76,0)
 ;   screening logic: ^DD(344.6,.06,0)="EXCLUDE MED CLAIMS POSTING^S^0:No;1:Yes;^0;6^Q"
"RTN","RCDPESP1",77,0)
 D LIST^DIC(344.6,,"@;.01;.02;.06;1","P",,,,,"I $P(^(0),U,6)=1",,RCGLB(344.6))
"RTN","RCDPESP1",78,0)
 ;
"RTN","RCDPESP1",79,0)
 ; PRCA*4.5*304 - Print Medical Claim Parameters
"RTN","RCDPESP1",80,0)
 I RCTYPE'="P" D
"RTN","RCDPESP1",81,0)
 .; RCDPE PARAMETER file (#344.61), auto-posting of medical claims
"RTN","RCDPESP1",82,0)
 .S X=$$GET1^DID(344.61,.02,,"TITLE"),V=" (Y/N)" S:X[V X=$P(X,V)_$P(X,V,2)  ; remove yes/no prompt
"RTN","RCDPESP1",83,0)
 .S Y=X_" "_@RCGLB(344.61)@(344.61,"1,",.02,"E")
"RTN","RCDPESP1",84,0)
 .D AD2RPT(Y)
"RTN","RCDPESP1",85,0)
 .;
"RTN","RCDPESP1",86,0)
 .I (RCPARM("AUTO-POST")!RCPARM("AUTO-DECREASE")) D  ; list auto-post excluded payers
"RTN","RCDPESP1",87,0)
 ..I '$D(@RCGLB(344.6)@("DILIST",1,0)) D  Q
"RTN","RCDPESP1",88,0)
 ...S X="     No payers excluded from medical auto-posting." D AD2RPT($J(" ",80-$L(X)\2)_X)
"RTN","RCDPESP1",89,0)
 ..;
"RTN","RCDPESP1",90,0)
 ..D AD2RPT("   Excluded Payer                      Comment")
"RTN","RCDPESP1",91,0)
 ..S RCNTR=0
"RTN","RCDPESP1",92,0)
 ..F  S RCNTR=$O(@RCGLB(344.6)@("DILIST",RCNTR)) Q:'RCNTR  D
"RTN","RCDPESP1",93,0)
 ...S V=@RCGLB(344.6)@("DILIST",RCNTR,0),X=$E($P(V,U,2),1,35)
"RTN","RCDPESP1",94,0)
 ...S Y="   "_X_$J(" ",36-$L(X))_$P(V,U,5)
"RTN","RCDPESP1",95,0)
 ...D AD2RPT($E(Y,1,IOM))
"RTN","RCDPESP1",96,0)
 .;
"RTN","RCDPESP1",97,0)
 .I RCPARM("AUTO-POST") D AD2RPT(" ")  ; blank line
"RTN","RCDPESP1",98,0)
 .;
"RTN","RCDPESP1",99,0)
 .K @RCGLB(344.6)  ; delete old data
"RTN","RCDPESP1",100,0)
 .; RCDPE AUTO-PAY EXCLUSION file (#344.6)
"RTN","RCDPESP1",101,0)
 .;   screening logic: ^DD(344.6,.07,0)="EXCLUDE MED CLAIMS DECREASE^S^0:No;1:Yes;^0;7^Q"
"RTN","RCDPESP1",102,0)
 .D LIST^DIC(344.6,,"@;.01;.02;.07;2","P",,,,,"I $P(^(0),U,7)=1",,RCGLB(344.6))
"RTN","RCDPESP1",103,0)
 .;
"RTN","RCDPESP1",104,0)
 .; RCDPE PARAMETER file (#344.61), auto-decrease of medical claims
"RTN","RCDPESP1",105,0)
 .S X=$$GET1^DID(344.61,.03,,"TITLE"),V=" (Y/N): ",V=" (Y/N)" S:X[V X=$P(X,V)_$P(X,V,2)  ; remove yes/no prompt
"RTN","RCDPESP1",106,0)
 .S Y=$J(X,45)_@RCGLB(344.61)@(344.61,"1,",.03,"E")
"RTN","RCDPESP1",107,0)
 .D AD2RPT(Y) ; ,AD2RPT(" ")
"RTN","RCDPESP1",108,0)
 .; PRCA*4.5*304 - Removed because auto-decrease amounts are based on CARCs
"RTN","RCDPESP1",109,0)
 .;I RCPARM("AUTO-DECREASE") D  ; list these 2 fields only if auto-decrease enabled
"RTN","RCDPESP1",110,0)
 .;.D AD2RPT("NUMBER OF DAYS TO WAIT BEFORE AUTO-DECREASE: "_(+$P(RCPARM(344.61,0),U,4)))
"RTN","RCDPESP1",111,0)
 .;.D AD2RPT("     MAXIMUM DOLLAR AMOUNT TO AUTO-DECREASE: "_"$"_(+$P(RCPARM(344.61,0),U,5)))
"RTN","RCDPESP1",112,0)
 .;
"RTN","RCDPESP1",113,0)
 .; PRCA*4.5*304 - Print the CARC Auto-decrease parameters
"RTN","RCDPESP1",114,0)
 . I $$CARCCHK(RCTYPE,"M") D
"RTN","RCDPESP1",115,0)
 .. D AD2RPT(" "),AD2RPT("     AUTO-DECREASE MEDICAL CLAIMS FOR THE FOLLOWING CARC/AMOUNTS ONLY:"),AD2RPT(" ")
"RTN","RCDPESP1",116,0)
 .. S RCSTRING=$TR($J("",70)," ","-"),RCI=0
"RTN","RCDPESP1",117,0)
 .. D AD2RPT("     CARC  Description                                             Max. Amt")
"RTN","RCDPESP1",118,0)
 .. D AD2RPT("     "_RCSTRING)
"RTN","RCDPESP1",119,0)
 .. ;
"RTN","RCDPESP1",120,0)
 .. ; Loop and print entries
"RTN","RCDPESP1",121,0)
 .. F  S RCI=$O(^RCY(344.62,RCI)) Q:'RCI  D
"RTN","RCDPESP1",122,0)
 .. . S RCDATA=$G(^RCY(344.62,RCI,0)),Y=""
"RTN","RCDPESP1",123,0)
 .. . Q:RCDATA=""
"RTN","RCDPESP1",124,0)
 .. . S RCCODE=$P(RCDATA,U),RCCIEN=$O(^RC(345,"B",RCCODE,""))
"RTN","RCDPESP1",125,0)
 .. . S RCDESC=$G(^RC(345,RCCIEN,1,1,0))
"RTN","RCDPESP1",126,0)
 .. . S RCSTAT=$P(RCDATA,U,2)
"RTN","RCDPESP1",127,0)
 .. . Q:RCSTAT'=1
"RTN","RCDPESP1",128,0)
 .. . I $L(RCDESC)>50 S RCDESC=$E(RCDESC,1,50)_" ..."
"RTN","RCDPESP1",129,0)
 .. . D GETCODES^RCDPCRR(RCCODE,"","A",$$DT^XLFDT,"RCCARCD","1^70")
"RTN","RCDPESP1",130,0)
 .. . S Y="     "_$J(RCCODE,4)_"  "
"RTN","RCDPESP1",131,0)
 .. . S Y=Y_$E(RCDESC,1,53) S:$L(RCDESC)<53 Y=Y_$J("",(53-$L(RCDESC))) S Y=Y_$J($P(RCDATA,U,6),10,0)
"RTN","RCDPESP1",132,0)
 .. . I '$$ACT^RCDPRU(345,RCCODE,) S Y=Y_" (I)"  ; if inactive, display (i)
"RTN","RCDPESP1",133,0)
 .. . D AD2RPT(Y)
"RTN","RCDPESP1",134,0)
 .. ;
"RTN","RCDPESP1",135,0)
 ..D AD2RPT(" ")  ; blank line
"RTN","RCDPESP1",136,0)
 .I (RCPARM("AUTO-POST")!RCPARM("AUTO-DECREASE")) D  ; list excluded auto-decrease payers
"RTN","RCDPESP1",137,0)
 .. S X=$P($$GET1^DID(344.61,.04,,"TITLE")," (",1)_": "
"RTN","RCDPESP1",138,0)
 .. S Y=$J(X,50)_@RCGLB(344.61)@(344.61,"1,",.04,"E")
"RTN","RCDPESP1",139,0)
 .. D AD2RPT(Y),AD2RPT(" ")
"RTN","RCDPESP1",140,0)
 .. D AD2RPT("     All payers excluded from Auto-Posting are excluded from Auto-Decrease.")
"RTN","RCDPESP1",141,0)
 .. Q:'RCPARM("AUTO-DECREASE")
"RTN","RCDPESP1",142,0)
 .. I '$D(@RCGLB(344.6)@("DILIST",1,0)) D  Q
"RTN","RCDPESP1",143,0)
 ... S X="       No additional payers excluded from Medical Auto-Decrease." D AD2RPT($J(" ",80-$L(X)\2)_X)
"RTN","RCDPESP1",144,0)
 ..;
"RTN","RCDPESP1",145,0)
 .. D AD2RPT("     Additional Excluded Payer           Comment")
"RTN","RCDPESP1",146,0)
 .. S RCNTR=0
"RTN","RCDPESP1",147,0)
 .. F  S RCNTR=$O(@RCGLB(344.6)@("DILIST",RCNTR)) Q:'RCNTR  D
"RTN","RCDPESP1",148,0)
 ... S V=@RCGLB(344.6)@("DILIST",RCNTR,0),X=$E($P(V,U,2),1,35)
"RTN","RCDPESP1",149,0)
 ... S Y="     "_X_$J(" ",36-$L(X))_$P(V,U,5)
"RTN","RCDPESP1",150,0)
 ... D AD2RPT($E(Y,1,IOM))
"RTN","RCDPESP1",151,0)
 .;
"RTN","RCDPESP1",152,0)
 .D AD2RPT(" ")  ; blank line
"RTN","RCDPESP1",153,0)
 ;
"RTN","RCDPESP1",154,0)
 K @RCGLB(344.6)  ; delete old data
"RTN","RCDPESP1",155,0)
 ; RCDPE AUTO-PAY EXCLUSION file (#344.6)
"RTN","RCDPESP1",156,0)
 ;   screening logic: ^DD(344.6,.06,0)="EXCLUDE MED CLAIMS POSTING^S^0:No;1:Yes;^0;6^Q"
"RTN","RCDPESP1",157,0)
 D LIST^DIC(344.6,,"@;.01;.02;.08;3","P",,,,,"I $P(^(0),U,8)=1",,RCGLB(344.6))
"RTN","RCDPESP1",158,0)
 ;
"RTN","RCDPESP1",159,0)
 ; PRCA*4.5*304 - Print Pharmacy Claim Parameters
"RTN","RCDPESP1",160,0)
 I RCTYPE'="M" D
"RTN","RCDPESP1",161,0)
 .; RCDPE PARAMETER file (#344.61), auto-posting of pharmacy claims
"RTN","RCDPESP1",162,0)
 .S X=$$GET1^DID(344.61,1.01,,"TITLE"),V=" (Y/N)" S:X[V X=$P(X,V)_$P(X,V,2)  ; remove yes/no prompt
"RTN","RCDPESP1",163,0)
 .S Y=X_" "_@RCGLB(344.61)@(344.61,"1,",1.01,"E")
"RTN","RCDPESP1",164,0)
 .D AD2RPT(Y)
"RTN","RCDPESP1",165,0)
 .;
"RTN","RCDPESP1",166,0)
 . I RCPARM("RX AUTO-POST") D  ; list auto-post excluded payers
"RTN","RCDPESP1",167,0)
 .. I '$D(@RCGLB(344.6)@("DILIST",1,0)) D  Q
"RTN","RCDPESP1",168,0)
 ... S X="     No payers excluded from pharmacy auto-posting." D AD2RPT($J(" ",80-$L(X)\2)_X)
"RTN","RCDPESP1",169,0)
 ..;
"RTN","RCDPESP1",170,0)
 .. D AD2RPT("   Excluded Payer                      Comment")
"RTN","RCDPESP1",171,0)
 .. S RCNTR=0
"RTN","RCDPESP1",172,0)
 .. F  S RCNTR=$O(@RCGLB(344.6)@("DILIST",RCNTR)) Q:'RCNTR  D
"RTN","RCDPESP1",173,0)
 ... S V=@RCGLB(344.6)@("DILIST",RCNTR,0),X=$E($P(V,U,2),1,35)
"RTN","RCDPESP1",174,0)
 ... S Y="   "_X_$J(" ",36-$L(X))_$P(V,U,5)
"RTN","RCDPESP1",175,0)
 ... D AD2RPT($E(Y,1,IOM))
"RTN","RCDPESP1",176,0)
 .. S X=$P($$GET1^DID(344.61,1.02,,"TITLE")," (",1)_": "  ; remove yes/no prompt
"RTN","RCDPESP1",177,0)
 .. S Y="     "_X_" "_$S(@RCGLB(344.61)@(344.61,"1,",1.02,"E")="":"No",1:@RCGLB(344.61)@(344.61,"1,",1.02,"E"))
"RTN","RCDPESP1",178,0)
 .. D AD2RPT(" "),AD2RPT(Y)
"RTN","RCDPESP1",179,0)
 .;
"RTN","RCDPESP1",180,0)
 .I RCPARM("RX AUTO-POST") D AD2RPT(" ")  ; blank line
"RTN","RCDPESP1",181,0)
 .;
"RTN","RCDPESP1",182,0)
 .K @RCGLB(344.6)  ; delete old data
"RTN","RCDPESP1",183,0)
 .;
"RTN","RCDPESP1",184,0)
 .; PRCA*4.5*304 - Print the CARC Auto-decrease parameters
"RTN","RCDPESP1",185,0)
 . I $$CARCCHK(RCTYPE,"P") D
"RTN","RCDPESP1",186,0)
 .. S RCSTRING=$TR($J("",73)," ","-"),RCI=0
"RTN","RCDPESP1",187,0)
 .. D AD2RPT("  CARC  Description                                             Max. Amt")
"RTN","RCDPESP1",188,0)
 .. D AD2RPT(RCSTRING)
"RTN","RCDPESP1",189,0)
 .. ;
"RTN","RCDPESP1",190,0)
 .. ; Loop and print entries
"RTN","RCDPESP1",191,0)
 .. F  S RCI=$O(^RCY(344.62,RCI)) Q:'RCI  D
"RTN","RCDPESP1",192,0)
 .. . S RCDATA=$G(^RCY(344.62,RCI,0)),Y=""
"RTN","RCDPESP1",193,0)
 .. . Q:RCDATA=""
"RTN","RCDPESP1",194,0)
 .. . S RCCODE=$P(RCDATA,U),RCCIEN=$O(^RC(345,"B",RCCODE,""))
"RTN","RCDPESP1",195,0)
 .. . S RCDESC=$G(^RC(345,RCCIEN,1,1,0))
"RTN","RCDPESP1",196,0)
 .. . S RCSTAT=$P(RCDATA,U,2)
"RTN","RCDPESP1",197,0)
 .. . Q:RCSTAT'=1
"RTN","RCDPESP1",198,0)
 .. . I $L(RCDESC)>50 S RCDESC=$E(RCDESC,1,50)_" ..."
"RTN","RCDPESP1",199,0)
 .. . D GETCODES^RCDPCRR(RCCODE,"","A",$$DT^XLFDT,"RCCARCD","1^70")
"RTN","RCDPESP1",200,0)
 .. . S Y="  "_$E(RCCODE,1,4)_"  "
"RTN","RCDPESP1",201,0)
 .. . S Y=Y_$E(RCDESC,1,55)_$J($P(RCDATA,U,6),10,0)
"RTN","RCDPESP1",202,0)
 .. . I '$$ACT^RCDPRU(345,RCCODE,) S Y=Y_" (I)"  ; if inactive, display (i)
"RTN","RCDPESP1",203,0)
 .. . D AD2RPT(Y)
"RTN","RCDPESP1",204,0)
 ;
"RTN","RCDPESP1",205,0)
 ; RCDPE PARAMETER file (#344.61)
"RTN","RCDPESP1",206,0)
 F RCFLD=.06,.07 D
"RTN","RCDPESP1",207,0)
 . Q:(RCFLD=.06)&(RCTYPE="P")  ; Dont display if only showing Pharmacy parameters
"RTN","RCDPESP1",208,0)
 . Q:(RCFLD=.07)&(RCTYPE="M")  ; Dont display if only showing medical parameters
"RTN","RCDPESP1",209,0)
 . S Y=$$GET1^DID(344.61,RCFLD,,"TITLE")_" "_@RCGLB(344.61)@(344.61,"1,",RCFLD,"E")
"RTN","RCDPESP1",210,0)
 . D AD2RPT(Y)
"RTN","RCDPESP1",211,0)
 ;
"RTN","RCDPESP1",212,0)
 D AD2RPT(" "),AD2RPT($$ENDORPRT^RCDPEARL)
"RTN","RCDPESP1",213,0)
 ;
"RTN","RCDPESP1",214,0)
 S RCSTOP=0 U IO D SPHDR(.RCHDR)
"RTN","RCDPESP1",215,0)
 S J=0 F  S J=$O(^TMP($J,"RC SP REPORT",J)) Q:'J!RCSTOP  S Y=^TMP($J,"RC SP REPORT",J,0) D
"RTN","RCDPESP1",216,0)
 .W !,Y Q:'$O(^TMP($J,"RC SP REPORT",J))  ; quit if last line
"RTN","RCDPESP1",217,0)
 .I '$G(ZTSK),$E(IOST,1,2)="C-",$Y+3>IOSL D ASK^RCDPEARL(.RCSTOP) I 'RCSTOP D SPHDR(.RCHDR) Q
"RTN","RCDPESP1",218,0)
 .Q:RCSTOP  Q:$Y+2<IOSL
"RTN","RCDPESP1",219,0)
 .D SPHDR(.RCHDR)
"RTN","RCDPESP1",220,0)
 ;
"RTN","RCDPESP1",221,0)
 I '$G(ZTSK),$E(IOST,1,2)="C-",'RCSTOP D ASK^RCDPEARL(.RCSTOP)
"RTN","RCDPESP1",222,0)
 ;
"RTN","RCDPESP1",223,0)
 ; close device
"RTN","RCDPESP1",224,0)
 U IO(0) D ^%ZISC
"RTN","RCDPESP1",225,0)
 ;
"RTN","RCDPESP1",226,0)
 S X="RC" F  S X=$O(^TMP($J,X)) Q:'($E(X,1,2)="RC")  K ^TMP($J,X) ; clean up
"RTN","RCDPESP1",227,0)
 ;
"RTN","RCDPESP1",228,0)
 Q
"RTN","RCDPESP1",229,0)
 ;
"RTN","RCDPESP1",230,0)
SPHDR(HDR) ; HDR passed by ref.
"RTN","RCDPESP1",231,0)
 ; HDR("RUNDATE") - run date, external format
"RTN","RCDPESP1",232,0)
 ;  HDR("PGNMBR") - page number
"RTN","RCDPESP1",233,0)
 ;    HDR("SITE") - site name
"RTN","RCDPESP1",234,0)
 N P,X,Y
"RTN","RCDPESP1",235,0)
 S P=$G(HDR("PGNMBR"))+1,HDR("PGNMBR")=P  ; increment page count
"RTN","RCDPESP1",236,0)
 ; 
"RTN","RCDPESP1",237,0)
 S X=$$HDRLN
"RTN","RCDPESP1",238,0)
 S P=IOM-($L(X)+10)\2,Y=$J(" ",P)_X_$J(" ",P)_" Page: "_HDR("PGNMBR")
"RTN","RCDPESP1",239,0)
 W @IOF,Y
"RTN","RCDPESP1",240,0)
 S X="   Run Date: "_HDR("RUNDATE"),Y=X_$J(HDR("SITE"),IOM-($L(X)+1))
"RTN","RCDPESP1",241,0)
 W !,Y
"RTN","RCDPESP1",242,0)
 S Y=" "_$TR($J("",IOM-2)," ","-")  ; space_row of hyphens
"RTN","RCDPESP1",243,0)
 W !,Y
"RTN","RCDPESP1",244,0)
 Q
"RTN","RCDPESP1",245,0)
 ;
"RTN","RCDPESP1",246,0)
AD2RPT(A) ; add line to report
"RTN","RCDPESP1",247,0)
 Q:$G(A)=""
"RTN","RCDPESP1",248,0)
 N C S C=$G(^TMP($J,"RC SP REPORT",0))+1,^TMP($J,"RC SP REPORT",0)=C
"RTN","RCDPESP1",249,0)
 S ^TMP($J,"RC SP REPORT",C,0)=A Q
"RTN","RCDPESP1",250,0)
 ;
"RTN","RCDPESP1",251,0)
HDRLN() Q "EDI Lockbox Parameters Report"_$S($G(RCTYPE)="B":" - ALL",$G(RCTYPE)="M":" - MEDICAL",$G(RCTYPE)="P":" - PHARMACY",1:"")  ; extrinsic variable
"RTN","RCDPESP1",252,0)
 ;
"RTN","RCDPESP1",253,0)
 ;Function to check to see if the CARC parameters are to appear on the report
"RTN","RCDPESP1",254,0)
CARCCHK(RCTYPE,TYPE) ;
"RTN","RCDPESP1",255,0)
 ;
"RTN","RCDPESP1",256,0)
 N RCMEN,RCREN
"RTN","RCDPESP1",257,0)
 ;
"RTN","RCDPESP1",258,0)
 ; Return 1 if valid to print, 0 otherwise
"RTN","RCDPESP1",259,0)
 ;
"RTN","RCDPESP1",260,0)
 Q:RCTYPE="B"&($G(TYPE)="M") +$P($G(^RCY(344.61,1,0)),U,3)  ;User wants all parameters and we are checking for medical auto decrease
"RTN","RCDPESP1",261,0)
 ;
"RTN","RCDPESP1",262,0)
 Q:RCTYPE="B"&($G(TYPE)="P") +$P($G(^RCY(344.61,1,1)),U,2)  ;User wants all parameters and we are checking for Pharmacy auto decrease
"RTN","RCDPESP1",263,0)
 ;
"RTN","RCDPESP1",264,0)
 S (RCMEN,RCREN)=""
"RTN","RCDPESP1",265,0)
 ;
"RTN","RCDPESP1",266,0)
 ;Print if Report type is medical and auto-decrease for medical is on
"RTN","RCDPESP1",267,0)
 I RCTYPE="M" S RCMEN=+$P($G(^RCY(344.61,1,0)),U,3) Q RCMEN
"RTN","RCDPESP1",268,0)
 ;
"RTN","RCDPESP1",269,0)
 ;Print if Report type is pharmacy and auto-decrease for pharmacy is on
"RTN","RCDPESP1",270,0)
 I RCTYPE="P" S RCREN=+$P($G(^RCY(344.61,1,1)),U,2) Q RCREN
"RTN","RCDPESP1",271,0)
 ;
"RTN","RCDPESP1",272,0)
 Q 0  ;Don't print the CARCs
"RTN","RCDPESP1",273,0)
 ;
"RTN","RCDPEWL")
0^14^B75628654^B75411625
"RTN","RCDPEWL",1,0)
RCDPEWL ;ALB/TMK/KML - ELECTRONIC EOB MESSAGE WORKLIST ;Jun 06, 2014@19:11:19
"RTN","RCDPEWL",2,0)
 ;;4.5;Accounts Receivable;**173,208,269,298,317,318**;Mar 20, 1995;Build 37
"RTN","RCDPEWL",3,0)
 ;Per VA Directive 6402, this routine should not be modified.
"RTN","RCDPEWL",4,0)
 ; IA for read access to ^IBM(361.1 = 4051
"RTN","RCDPEWL",5,0)
 ;
"RTN","RCDPEWL",6,0)
EN ; Main entry point
"RTN","RCDPEWL",7,0)
 N RCFASTXT,DA,DIC,X,Y,RCERA,RCNOED,RCQUIT  ;PRCA*4.5*317 Added RCQUIT
"RTN","RCDPEWL",8,0)
 D FULL^VALM1
"RTN","RCDPEWL",9,0)
 ;
"RTN","RCDPEWL",10,0)
 S DIR(0)="SA^L:LIST;S:SPECIFIC"
"RTN","RCDPEWL",11,0)
 S DIR("A")="Do you want a (L)IST of ERAs or a (S)PECIFIC one?: "
"RTN","RCDPEWL",12,0)
 S DIR("?",1)="Enter LIST to see a list of ERAs."
"RTN","RCDPEWL",13,0)
 S DIR("?")="Enter SPECIFIC to see a selected ERA."
"RTN","RCDPEWL",14,0)
 S DIR("B")="LIST"
"RTN","RCDPEWL",15,0)
 W !
"RTN","RCDPEWL",16,0)
 D ^DIR
"RTN","RCDPEWL",17,0)
 K DIR
"RTN","RCDPEWL",18,0)
 Q:$D(DTOUT)!$D(DUOUT)
"RTN","RCDPEWL",19,0)
 I Y="S" D  Q
"RTN","RCDPEWL",20,0)
 . S DIC="^RCY(344.4,",DIC(0)="AEMQ"
"RTN","RCDPEWL",21,0)
 . D ^DIC
"RTN","RCDPEWL",22,0)
 . I Y>0 D WL^RCDPEWL7(+Y)
"RTN","RCDPEWL",23,0)
 ;
"RTN","RCDPEWL",24,0)
 ; Calling Preferred View API in Menu Option Mode
"RTN","RCDPEWL",25,0)
 D PARAMS^RCDPEWL0("MO")
"RTN","RCDPEWL",26,0)
 Q:$G(RCQUIT)
"RTN","RCDPEWL",27,0)
 D EN^VALM("RCDPE WORKLIST ERA LIST")
"RTN","RCDPEWL",28,0)
 Q
"RTN","RCDPEWL",29,0)
 ;
"RTN","RCDPEWL",30,0)
DISP(RCERA,RCNOED) ; Entry to worklist from receipt processing
"RTN","RCDPEWL",31,0)
 ;  RCERA = ien of entry in file 344.49
"RTN","RCDPEWL",32,0)
 ; RCNOED = 1 if receipt exists/no editing allowed
"RTN","RCDPEWL",33,0)
 ;        = 2 if no edit and called from receipt processing
"RTN","RCDPEWL",34,0)
 ;  ; prca*4.5*298 - added AUTOPOST input argument
"RTN","RCDPEWL",35,0)
 ; AUTOPOST = "" if ERA is non-autopost
"RTN","RCDPEWL",36,0)
 ;          = 0  if auto-posted ERA is in UNPOSTED status
"RTN","RCDPEWL",37,0)
 ;          = 1 if auto-posted ERA is in PARTIAL posted status
"RTN","RCDPEWL",38,0)
 ;          = 2 if auto-posted ERA is in COMPLETE status
"RTN","RCDPEWL",39,0)
 ;
"RTN","RCDPEWL",40,0)
 N DUOUT,DTOUT,DIC,DIK,X,Y,DIR,RCQUIT,DA,DIE,DR,RCSCR,RC0,RC5,RCDAT,RCUNM
"RTN","RCDPEWL",41,0)
 ;
"RTN","RCDPEWL",42,0)
 S RCSCR("NOEDIT")=+$G(RCNOED)
"RTN","RCDPEWL",43,0)
 S RCQUIT=0,RC0=$G(^RCY(344.4,RCERA,0)),RC5=$G(^RCY(344.4,RCERA,5))
"RTN","RCDPEWL",44,0)
 I 'RCSCR("NOEDIT"),'$O(^RCY(344.49,"B",RCERA,0)) D  G:RCQUIT DISPQ
"RTN","RCDPEWL",45,0)
 . ;allow additional selections
"RTN","RCDPEWL",46,0)
 . S DIR("A",1)="No worklist scratchpad entry exists for this ERA."
"RTN","RCDPEWL",47,0)
 . S DIR("A")="(C)reate scratchpad, (V)iew ERA details or (E)xit:"
"RTN","RCDPEWL",48,0)
 . S DIR(0)="SAO^C:CREATE SCRATCHPAD;V:VIEW ERA DETAILS;E:EXIT"
"RTN","RCDPEWL",49,0)
 . W ! D ^DIR K DIR
"RTN","RCDPEWL",50,0)
 . I (Y'="V")&(Y'="C")&(Y'="E") S RCERA=-1,RCQUIT=1 Q
"RTN","RCDPEWL",51,0)
 . I Y="V" S RCSCR=RCERA D PRERA1^RCDPEWL0 S RCERA=-1,RCQUIT=1  Q
"RTN","RCDPEWL",52,0)
 . I Y="E" S RCERA=-1,RCQUIT=1 Q
"RTN","RCDPEWL",53,0)
 . ; prca*4.5*298  Y is = "C" therefore perform the pre-existing scratchpad creation/editing algorithm
"RTN","RCDPEWL",54,0)
 . I $P(RC0,U,15)'="" W !!,"PAYMENT METHOD CODE REPORTED: "_$P(RC0,U,15),!
"RTN","RCDPEWL",55,0)
 . I $P(RC0,U,15)="" W !!,"NO PAYMENT METHOD CODE REPORTED",!
"RTN","RCDPEWL",56,0)
 . I $P(RC0,U,9)=0,$P(RC5,U,2)="" D  Q:RCQUIT
"RTN","RCDPEWL",57,0)
 .. S RCQUIT=0,RCUNM=0
"RTN","RCDPEWL",58,0)
 .. I +$P(RC0,U,5)=0,"ACH"'[(U_$P(RC0,U,15)_U) D  Q:RCQUIT!RCUNM
"RTN","RCDPEWL",59,0)
 ... S DIR("A",1)="This ERA has no payment associated with it and can be marked as",DIR("A",2)="'MATCH-0 PAYMENT' to remove it from the ERA AGING REPORT if no paper check or",DIR("A",3)="EFT is expected to be received for this ERA"
"RTN","RCDPEWL",60,0)
 ... S DIR("?")="Do NOT respond YES here unless you are sure there will be no EFT or paper",DIR("?",1)=" check to be received for this 0-PAYMENT ERA"
"RTN","RCDPEWL",61,0)
 ... S DIR("A")="Do you want to do this?: "
"RTN","RCDPEWL",62,0)
 ... S DIR(0)="YA"
"RTN","RCDPEWL",63,0)
 ... D ^DIR K DIR
"RTN","RCDPEWL",64,0)
 ... I $D(DTOUT)!$D(DUOUT) S RCQUIT=1 Q
"RTN","RCDPEWL",65,0)
 ... I Y'=1 Q
"RTN","RCDPEWL",66,0)
 ... S DIE="^RCY(344.4,",DR=".09////3;.14////3",DA=RCERA D ^DIE S RCUNM=1
"RTN","RCDPEWL",67,0)
 .. I 'RCUNM D
"RTN","RCDPEWL",68,0)
 ... S DIR("A",1)="This ERA does NOT have a matching EFT",DIR("A")="Enter the number of the paper check you received for this ERA: ",DIR(0)="344.01,.07A"
"RTN","RCDPEWL",69,0)
 ... I $P(RC5,U,2)'="" S DIR("B")=$P(RC5,U,2)
"RTN","RCDPEWL",70,0)
 ... I $G(DIR("B"))="",$P(RC0,U,2)'="" S DIR("B")=$P(RC0,U,2)
"RTN","RCDPEWL",71,0)
 ... W ! D ^DIR K DIR
"RTN","RCDPEWL",72,0)
 ... I $D(DTOUT)!$D(DUOUT)!(Y="") D  S RCQUIT=1 Q
"RTN","RCDPEWL",73,0)
 .... S DIR(0)="EA",DIR("A",1)="There must be either a paper check or an EFT for this ERA",DIR("A")="PRESS RETURN TO CONTINUE " W !!  D ^DIR K DIR
"RTN","RCDPEWL",74,0)
 ... S RCDAT("CHECK#")=Y
"RTN","RCDPEWL",75,0)
 ... S DIR(0)="344.01,.1O",DIR("B")=$$FMTE^XLFDT($P(RC0,U,4),2)
"RTN","RCDPEWL",76,0)
 ... W ! D ^DIR K DIR
"RTN","RCDPEWL",77,0)
 ... I $D(DTOUT)!$D(DUOUT) S RCQUIT=1 Q
"RTN","RCDPEWL",78,0)
 ... S RCDAT("CHECKDT")=Y
"RTN","RCDPEWL",79,0)
 ... S DIR(0)="344.01,.08O"
"RTN","RCDPEWL",80,0)
 ... W ! D ^DIR K DIR
"RTN","RCDPEWL",81,0)
 ... I $D(DTOUT)!$D(DUOUT) S RCQUIT=1 Q
"RTN","RCDPEWL",82,0)
 ... S RCDAT("BANK")=Y
"RTN","RCDPEWL",83,0)
 ... S DIR("A",1)="ERA #"_RCERA_" (TRACE #:"_$P(RC0,U,2)_") matched to paper check "_RCDAT("CHECK#"),DIR("A")="Is this correct?: ",DIR(0)="YA",DIR("B")="YES" W ! D ^DIR K DIR
"RTN","RCDPEWL",84,0)
 ... I Y'=1 S RCQUIT=1 Q
"RTN","RCDPEWL",85,0)
 ... S DIE="^RCY(344.4,",DA=RCERA,DR=".13////"_RCDAT("CHECK#")_";.09////2" D ^DIE
"RTN","RCDPEWL",86,0)
 ;
"RTN","RCDPEWL",87,0)
 S RCSCR=+$O(^RCY(344.49,"B",RCERA,0))
"RTN","RCDPEWL",88,0)
 I 'RCSCR D  ; Build the entry in file 344.49
"RTN","RCDPEWL",89,0)
 . I RCSCR("NOEDIT") D  Q
"RTN","RCDPEWL",90,0)
 .. S DIR("A")="NO worklist entry exists for this ERA - PRESS RETURN TO CONTINUE ",DIR(0)="EA" W ! D ^DIR K DIR
"RTN","RCDPEWL",91,0)
 . ;
"RTN","RCDPEWL",92,0)
 . S RCSCR=+$$ADDREC(RCERA,.RCDAT)
"RTN","RCDPEWL",93,0)
 . I RCSCR D  Q:'RCSCR
"RTN","RCDPEWL",94,0)
 .. F X=1:1:6 L +^RCY(344.4,RCSCR):5 Q:$T  I X=6 D  Q
"RTN","RCDPEWL",95,0)
 ... S DA=RCSCR,DIK="^RCY(344.49," D ^DIK S RCSCR=0
"RTN","RCDPEWL",96,0)
 ... S DIR(0)="EA",DIR("A",1)="Another user has locked this entry - NEW RECORD NOT CREATED",DIR("A")="PRESS RETURN TO CONTINUE " W ! D ^DIR K DIR
"RTN","RCDPEWL",97,0)
 .. Q:'RCSCR
"RTN","RCDPEWL",98,0)
 .. ; prca*4.5*298  per patch requirements, keep code related to 
"RTN","RCDPEWL",99,0)
 .. ; creating/maintaining batches but just remove from execution.
"RTN","RCDPEWL",100,0)
 .. ;D SETBATCH^RCDPEWLB(RCSCR) ; prca*4.5*298
"RTN","RCDPEWL",101,0)
 .. D ADDLINES^RCDPEWLA(RCSCR)
"RTN","RCDPEWL",102,0)
 .. K ^TMP($J,"BATCHES")
"RTN","RCDPEWL",103,0)
 ;
"RTN","RCDPEWL",104,0)
 I RCSCR D  G:'RCSCR DISPQ
"RTN","RCDPEWL",105,0)
 . ; prca*4.5*298  per patch requirements, keep code related to 
"RTN","RCDPEWL",106,0)
 . ; creating/maintaining batches but just remove from execution.
"RTN","RCDPEWL",107,0)
 . ;Q:'$$BAT^RCDPEWL7(RCSCR)
"RTN","RCDPEWL",108,0)
 . ;I 'RCSCR("NOEDIT"),'$G(^TMP("RCBATCH_SELECTED",$J)) L +^RCY(344.4,RCSCR):5 I '$T W !!,"Another user is currently editing this entry",! S DIR(0)="E" D ^DIR K DIR S RCSCR=0 Q
"RTN","RCDPEWL",109,0)
 . I 'RCSCR("NOEDIT") L +^RCY(344.4,RCSCR):5 I '$T W !!,"Another user is currently editing this entry",! S DIR(0)="E" D ^DIR K DIR S RCSCR=0 Q
"RTN","RCDPEWL",110,0)
 . D EN^VALM("RCDPE EOB WORKLIST")
"RTN","RCDPEWL",111,0)
 ;
"RTN","RCDPEWL",112,0)
DISPQ L -^RCY(344.4,+$G(RCERA))
"RTN","RCDPEWL",113,0)
 Q
"RTN","RCDPEWL",114,0)
 ;
"RTN","RCDPEWL",115,0)
INIT ; -- set up initial variables
"RTN","RCDPEWL",116,0)
 N RCQUIT,RCREV
"RTN","RCDPEWL",117,0)
 S VALMCNT=0,VALMBG=1
"RTN","RCDPEWL",118,0)
 S RCQUIT=0
"RTN","RCDPEWL",119,0)
 ; PRCA*4.5*298: Removed functionality for retrieving/storing user preferences in file #344.49
"RTN","RCDPEWL",120,0)
 ; and replaced with the use of parameters handled by PARAMS^RCDPEWLA.
"RTN","RCDPEWL",121,0)
 D PARAMS^RCDPEWLA("MO") I $G(RCQUIT) S VALMQUIT=1 Q
"RTN","RCDPEWL",122,0)
 D BLD^RCDPEWL1($G(^TMP($J,"RC_SORTPARM")))
"RTN","RCDPEWL",123,0)
 Q
"RTN","RCDPEWL",124,0)
 ;
"RTN","RCDPEWL",125,0)
CV ; Change View Action for EEOB Worklist
"RTN","RCDPEWL",126,0)
 D FULL^VALM1
"RTN","RCDPEWL",127,0)
 D PARAMS^RCDPEWLA("CV")
"RTN","RCDPEWL",128,0)
 D BLD^RCDPEWL1($G(^TMP($J,"RC_SORTPARM"))),HDR
"RTN","RCDPEWL",129,0)
 S VALMBCK="R",VALMBG=1
"RTN","RCDPEWL",130,0)
 Q
"RTN","RCDPEWL",131,0)
 ;
"RTN","RCDPEWL",132,0)
ADDREC(RCERA,RCDAT) ; Add a record to file 344.49
"RTN","RCDPEWL",133,0)
 ; RCERA = ien of file 344.4
"RTN","RCDPEWL",134,0)
 ; RCDAT = array containing additional data to add to new entry
"RTN","RCDPEWL",135,0)
 ;
"RTN","RCDPEWL",136,0)
 N DIC,DLAYGO,X,Y,DO,DD,RCY,DINUM
"RTN","RCDPEWL",137,0)
 S RCY=0,DIC("DR")=""
"RTN","RCDPEWL",138,0)
 S DIC(0)="L",DLAYGO=344.49,(DINUM,X)=RCERA,DIC="^RCY(344.49,"
"RTN","RCDPEWL",139,0)
 I $G(RCDAT("CHECK#"))'="" S DIC("DR")=".04////"_RCDAT("CHECK#")_";"
"RTN","RCDPEWL",140,0)
 I $G(RCDAT("CHECKDT"))'="" S DIC("DR")=DIC("DR")_".05////"_RCDAT("CHECKDT")_";"
"RTN","RCDPEWL",141,0)
 I $G(RCDAT("BANK"))'="" S DIC("DR")=DIC("DR")_".06////"_RCDAT("BANK")_";"
"RTN","RCDPEWL",142,0)
 K DD,DO D FILE^DICN K DIC
"RTN","RCDPEWL",143,0)
 I Y>0 S RCY=+Y
"RTN","RCDPEWL",144,0)
 Q RCY
"RTN","RCDPEWL",145,0)
 ;
"RTN","RCDPEWL",146,0)
HDR ; Creates header lines for the selected ERA display
"RTN","RCDPEWL",147,0)
 N X,Z,I,RC,RC5,RC4,RCSORTBY,RCEEOBPU
"RTN","RCDPEWL",148,0)
 F I=1:1:5 S VALMHDR(I)=""
"RTN","RCDPEWL",149,0)
 I '$G(RCSCR) S VALMQUIT=1 Q
"RTN","RCDPEWL",150,0)
 S RC=$G(^RCY(344.4,+RCSCR,0)),RC5=$G(^RCY(344.4,+RCSCR,5))
"RTN","RCDPEWL",151,0)
 S RC4=$G(^RCY(344.4,+RCSCR,4))  ;prca*4.5*298 
"RTN","RCDPEWL",152,0)
 S VALMHDR(1)=$E("ERA Entry #: "_$P(RC,U)_$J("",31),1,31)_"Total Amt Pd: "_$J(+$P(RC,U,5),"",2)
"RTN","RCDPEWL",153,0)
 S VALMHDR(2)="Payer Name/ID: "_$P(RC,U,6)_"/"_$P(RC,U,3)
"RTN","RCDPEWL",154,0)
 S Z=+$O(^RCY(344.31,"AERA",+RCSCR,0))
"RTN","RCDPEWL",155,0)
 I Z S VALMHDR(3)="EFT #/TRACE #: "_$P($G(^RCY(344.3,+$G(^RCY(344.31,Z,0)),0)),U)_"/"_$P(RC,U,2)
"RTN","RCDPEWL",156,0)
 I 'Z,$P(RC5,U,2)'="" S VALMHDR(3)="PAPER CHECK #: "_$P(RC5,U,2)
"RTN","RCDPEWL",157,0)
 ; prca*4.5*298  per patch requirements, keep code related to creating/maintaining
"RTN","RCDPEWL",158,0)
 ; batches but just remove from execution.
"RTN","RCDPEWL",159,0)
 ;I $G(^TMP("RCBATCH_SELECTED",$J)) D
"RTN","RCDPEWL",160,0)
 ;. N Z,Z0
"RTN","RCDPEWL",161,0)
 ;. S Z=+$G(^TMP("RCBATCH_SELECTED",$J)),Z0=$G(^RCY(344.49,RCSCR,3,Z,0))
"RTN","RCDPEWL",162,0)
 ;. S RCT=RCT+1,VALMHDR(RCT)="BATCH: "_Z_"  "_$P(Z0,U,2)_"  "_$$EXTERNAL^DILFD(344.493,.03,"",$P(Z0,U,3))
"RTN","RCDPEWL",163,0)
 I $G(RCSCR("NOEDIT")) D
"RTN","RCDPEWL",164,0)
 . S VALMHDR(4)="*** RECEIPT(S) ALREADY CREATED *** ("_$$RECEIPTS(RCSCR)_")"
"RTN","RCDPEWL",165,0)
 I $P(RC4,U,2)]"" D  ;AUTO-POST STATUS (344.4, 4.02);  if not null, then the selected ERA is designated for auto-post
"RTN","RCDPEWL",166,0)
 . ; Setting the Auto-Post info in the header
"RTN","RCDPEWL",167,0)
 . N AUTOPSTS
"RTN","RCDPEWL",168,0)
 . S AUTOPSTS="Auto-Post Status: "_$S($P(RC4,U,2)=0:"Unposted",$P(RC4,U,2)=1:"Partial",1:"Complete")
"RTN","RCDPEWL",169,0)
 . S AUTOPSTS=AUTOPSTS_"    Auto-Post Date: "_$S($P(RC4,U,2)>0:$$FMTE^XLFDT($P(RC4,U)),1:"") ; PRCA*4.5*318
"RTN","RCDPEWL",170,0)
 . S VALMHDR(5)=AUTOPSTS
"RTN","RCDPEWL",171,0)
 ; Displaying Current View (PRCA*4.5*298)
"RTN","RCDPEWL",172,0)
 S $E(VALMHDR(1),60)="Current View:"
"RTN","RCDPEWL",173,0)
 S RCSORTBY=$G(^TMP($J,"RC_SORTPARM"))
"RTN","RCDPEWL",174,0)
 S $E(VALMHDR(2),60)=$S(RCSORTBY="F":"ZERO-PAYMENTS FIRST",RCSORTBY="L":"ZERO-PAYMENTS LAST",1:"NO SORT ORDER")
"RTN","RCDPEWL",175,0)
 S RCEEOBPU=$G(^TMP($J,"RC_EEOBPOST"))
"RTN","RCDPEWL",176,0)
 S $E(VALMHDR(3),60)=$S(RCEEOBPU="P":"POSTED EEOBs ONLY",RCEEOBPU="U":"UNPOSTED EEOBs ONLY",1:"ALL EEOBS")
"RTN","RCDPEWL",177,0)
 Q
"RTN","RCDPEWL",178,0)
 ;
"RTN","RCDPEWL",179,0)
FNL ; -- Clean up list
"RTN","RCDPEWL",180,0)
 K ^TMP("RCDPE-EOB_WLDX",$J),^TMP("RCDPE-EOB_WL",$J),^TMP($J,"RC_SORTPARM"),^TMP($J,"RC_BILL")
"RTN","RCDPEWL",181,0)
 D CLEAN^VALM10,CLEAR^VALM1
"RTN","RCDPEWL",182,0)
 K RCFASTXT
"RTN","RCDPEWL",183,0)
 Q
"RTN","RCDPEWL",184,0)
 ;
"RTN","RCDPEWL",185,0)
SEL(RCDA) ; Select entry from worklist scratch pad screen
"RTN","RCDPEWL",186,0)
 ; RCDA = array returned if selections made
"RTN","RCDPEWL",187,0)
 ;    RCDA(n)=ien of entry(s) in file 344.41 
"RTN","RCDPEWL",188,0)
 ;            where n = the line # selected  
"RTN","RCDPEWL",189,0)
 K RCDA
"RTN","RCDPEWL",190,0)
 N VALMY
"RTN","RCDPEWL",191,0)
 D EN^VALM2($G(XQORNOD(0)),"S")
"RTN","RCDPEWL",192,0)
 S RCDA=0 F  S RCDA=$O(VALMY(RCDA)) Q:'RCDA  S RCDA(RCDA)=$P($G(^TMP("RCDPE-EOB_WLDX",$J,RCDA)),U,2,5)
"RTN","RCDPEWL",193,0)
 Q
"RTN","RCDPEWL",194,0)
 ;
"RTN","RCDPEWL",195,0)
NOEDIT ; Display no edit allowed if receipt exists
"RTN","RCDPEWL",196,0)
 N DIR,X,Y
"RTN","RCDPEWL",197,0)
 S DIR(0)="EA",DIR("A",1)="This action is NOT available since the ERA already has a receipt."
"RTN","RCDPEWL",198,0)
 S DIR("A")="PRESS RETURN TO CONTINUE "
"RTN","RCDPEWL",199,0)
 W ! D ^DIR K DIR W !
"RTN","RCDPEWL",200,0)
 Q
"RTN","RCDPEWL",201,0)
 ;
"RTN","RCDPEWL",202,0)
NOBATCH ; Display action not allowed if working at batch level not the ERA level
"RTN","RCDPEWL",203,0)
 N DIR,X,Y
"RTN","RCDPEWL",204,0)
 S DIR(0)="EA",DIR("A",1)="This action is NOT valid when in a batch within the ERA."
"RTN","RCDPEWL",205,0)
 S DIR("A")="PRESS RETURN TO CONTINUE "
"RTN","RCDPEWL",206,0)
 W ! D ^DIR K DIR W !
"RTN","RCDPEWL",207,0)
 Q
"RTN","RCDPEWL",208,0)
 ;
"RTN","RCDPEWL",209,0)
RECEIPTS(RCSCR) ; get list of receipts for the ERA 
"RTN","RCDPEWL",210,0)
 ; Input: RCSCR: ERA File (#344.4) IEN
"RTN","RCDPEWL",211,0)
 ; Output: "" - No Receipt / REC# - One Receipt / REC#A-REC#Z - Range of Receipts
"RTN","RCDPEWL",212,0)
 N X,RECEIPT,CTR,RC0
"RTN","RCDPEWL",213,0)
 K ARRAY,STR
"RTN","RCDPEWL",214,0)
 S X=0,CTR=1,(STR,RECEIPT)=""
"RTN","RCDPEWL",215,0)
 F  S X=$O(^RCY(344.4,RCSCR,1,"RECEIPT",X)) Q:'X  D
"RTN","RCDPEWL",216,0)
 . S:X RECEIPT=$P($G(^RCY(344,X,0)),U)  ; get external form of receipt 
"RTN","RCDPEWL",217,0)
 . I RECEIPT]"" S ARRAY(RECEIPT)=""
"RTN","RCDPEWL",218,0)
 ; array of receipts does not exist so this could be a non auto-posted ERA; so only 1 receipt will be assigned; retrieve at 344.4, .08
"RTN","RCDPEWL",219,0)
 I '$D(ARRAY),$$GET1^DIQ(344.4,RCSCR,.08)'="" S ARRAY($$GET1^DIQ(344.4,RCSCR,.08))=""
"RTN","RCDPEWL",220,0)
 ;
"RTN","RCDPEWL",221,0)
 I $O(ARRAY($O(ARRAY(""))))'="" D
"RTN","RCDPEWL",222,0)
 . S STR=$O(ARRAY(""))_"-"_$O(ARRAY(""),-1)
"RTN","RCDPEWL",223,0)
 E  D
"RTN","RCDPEWL",224,0)
 . S STR=$O(ARRAY(""))
"RTN","RCDPEWL",225,0)
 Q STR
"RTN","RCDPEWL2")
0^21^B113268275^B108949020
"RTN","RCDPEWL2",1,0)
RCDPEWL2 ;ALB/TMK/KML - ELECTRONIC EOB WORKLIST ACTIONS ;7/7/10 6:43pm
"RTN","RCDPEWL2",2,0)
 ;;4.5;Accounts Receivable;**173,208,269,298,303,318**;Mar 20, 1995;Build 37
"RTN","RCDPEWL2",3,0)
 ;;Per VA Directive 6402, this routine should not be modified.
"RTN","RCDPEWL2",4,0)
 ; IA for call to OPTION^IBJTLA = 4121
"RTN","RCDPEWL2",5,0)
 ; IA for call to ASK^IBRREL = 306
"RTN","RCDPEWL2",6,0)
 ; IA call for EN1AR^IBECEA = 4047
"RTN","RCDPEWL2",7,0)
 ; IA call for MAIN^IBOHPT1 = 4048
"RTN","RCDPEWL2",8,0)
 ; IA for read access to ^IBM(361.1 = 4051
"RTN","RCDPEWL2",9,0)
 Q
"RTN","RCDPEWL2",10,0)
 ;
"RTN","RCDPEWL2",11,0)
VP(RCSCR,RCDAZ) ; View/Print EOB Detail data from file 361.1
"RTN","RCDPEWL2",12,0)
 ; RCSCR = ien of entry in file 344.4
"RTN","RCDPEWL2",13,0)
 ; RCDAZ = array subscripted by a sequential # and
"RTN","RCDPEWL2",14,0)
 ;   RCDAZ(n) = one of 3 formats
"RTN","RCDPEWL2",15,0)
 ;     ERA level adjustments
"RTN","RCDPEWL2",16,0)
 ;          ADJ^the ien of the adj in 344.42
"RTN","RCDPEWL2",17,0)
 ;     EOB exists in file 361.1:
"RTN","RCDPEWL2",18,0)
 ;          ien of line in 344.41^ien of 361.1
"RTN","RCDPEWL2",19,0)
 ;     EOB doesn't exist in 361.1:
"RTN","RCDPEWL2",20,0)
 ;          ien of line in 344.41^-1
"RTN","RCDPEWL2",21,0)
 ;
"RTN","RCDPEWL2",22,0)
 N RCDA,%ZIS,ZTRTN,ZTSAVE,ZTDESC,POP
"RTN","RCDPEWL2",23,0)
 ; Ask device
"RTN","RCDPEWL2",24,0)
 S %ZIS="QM" D ^%ZIS G:POP VPQ
"RTN","RCDPEWL2",25,0)
 I $D(IO("Q")) D  G VPQ
"RTN","RCDPEWL2",26,0)
 . S ZTRTN="VPOUT^RCDPEWL2",ZTDESC="AR - Print EEOB Detail from Worklist"
"RTN","RCDPEWL2",27,0)
 . S ZTSAVE("RC*")=""
"RTN","RCDPEWL2",28,0)
 . D ^%ZTLOAD
"RTN","RCDPEWL2",29,0)
 . W !!,$S($D(ZTSK):"Your task number "_ZTSK_" has been queued.",1:"Unable to queue this job.")
"RTN","RCDPEWL2",30,0)
 . K ZTSK,IO("Q") D HOME^%ZIS
"RTN","RCDPEWL2",31,0)
 U IO
"RTN","RCDPEWL2",32,0)
 ;
"RTN","RCDPEWL2",33,0)
VPOUT ; Entrypoint for queued job
"RTN","RCDPEWL2",34,0)
 N Z,Z0,RCSTOP,RCPG,RCREF,RC3611,RCDASH,RCDT,RC1,RC3444,RCZ,RCZ0
"RTN","RCDPEWL2",35,0)
 ;
"RTN","RCDPEWL2",36,0)
 K ^TMP("PRCA_EOB",$J),^TMP("PRCA_EOB1",$J)
"RTN","RCDPEWL2",37,0)
 S RCDT=DT,(RCSTOP,RCPG)=0,RC3444=RCSCR,RCDASH="",$P(RCDASH,"-",71)=""
"RTN","RCDPEWL2",38,0)
 I '$O(RCDAZ(0)) G VPQ
"RTN","RCDPEWL2",39,0)
 S RCZ=0 F  S RCZ=$O(RCDAZ(RCZ)) Q:'RCZ  D
"RTN","RCDPEWL2",40,0)
 . S RCREF=$P(RCDAZ(RCZ),U),RC3611=+$P(RCDAZ(RCZ),U,2)
"RTN","RCDPEWL2",41,0)
 . K ^TMP("PRCA_EOB1",$J,RC3611)
"RTN","RCDPEWL2",42,0)
 . ;
"RTN","RCDPEWL2",43,0)
 . I $E(RCREF,1,3)["ADJ" D  Q
"RTN","RCDPEWL2",44,0)
 .. ;Display ERA level adj
"RTN","RCDPEWL2",45,0)
 .. S RCZ0=$G(^RCY(344.4,RCSCR,2,RC3611,0))
"RTN","RCDPEWL2",46,0)
 .. S ^TMP("PRCA_EOB",$J,"ADJ",1)="ERA LEVEL ADJUSTMENT #"_RC3611
"RTN","RCDPEWL2",47,0)
 .. S ^TMP("PRCA_EOB",$J,"ADJ",2)="   ADJUSTMENT REFERENCE #: "_$P(RCZ0,U)
"RTN","RCDPEWL2",48,0)
 .. S ^TMP("PRCA_EOB",$J,"ADJ",3)="   ADJUSTMENT REASON CODE: "_$P(RCZ0,U,2)
"RTN","RCDPEWL2",49,0)
 .. S ^TMP("PRCA_EOB",$J,"ADJ",4)="        ADJUSTMENT AMOUNT: "_$J(+$P(RCZ0,U,3),"",2)
"RTN","RCDPEWL2",50,0)
 .. S ^TMP("PRCA_EOB",$J,"ADJ",5)=RCDASH
"RTN","RCDPEWL2",51,0)
 . ;
"RTN","RCDPEWL2",52,0)
 . I $P(RCDAZ(RCZ),U,2)'>0 D  Q
"RTN","RCDPEWL2",53,0)
 .. ;Display formatted raw data - no EOB data in 361.1
"RTN","RCDPEWL2",54,0)
 .. K ^TMP($J,"RC_SUMRAW")
"RTN","RCDPEWL2",55,0)
 .. D DISP^RCDPESR0("^RCY(344.4,"_RCSCR_",1,"_+RCDAZ(RCZ)_",1)","^TMP($J,""RC_SUMRAW"")",1,"^TMP(""PRCA_EOB"",$J,0)")
"RTN","RCDPEWL2",56,0)
 .. S ^TMP("PRCA_EOB1",$J,RC3611,1)="CLAIM #: "_$$BILLREF^RCDPESR0(RCSCR,+RCDAZ(RCZ))_"*** NOT IDENTIFIED IN A/R ****"_$S($P($G(^RCY(344.4,RCSCR,1,+RCDAZ(RCZ),0)),U,14):" (REVERSAL)",1:"")
"RTN","RCDPEWL2",57,0)
 .. K ^TMP($J,"RC_SUMRAW")
"RTN","RCDPEWL2",58,0)
 .. S ^TMP("PRCA_EOB",$J,+$O(^TMP("PRCA_EOB",$J,""),-1)+1)=RCDASH
"RTN","RCDPEWL2",59,0)
 . ;
"RTN","RCDPEWL2",60,0)
 . K ^TMP("PRCA_EOB1",$J,RC3611)
"RTN","RCDPEWL2",61,0)
 . S ^TMP("PRCA_EOB1",$J,RC3611,1)="CLAIM #: "_$$BILLREF^RCDPESR0(RCSCR,+RCDAZ(RCZ))_$S($P($G(^RCY(344.4,RCSCR,1,+RCDAZ(RCZ),0)),U,14):" (REVERSAL)",1:"")
"RTN","RCDPEWL2",62,0)
 . D GETEOB^IBCECSA6(RC3611,2)
"RTN","RCDPEWL2",63,0)
 . I $O(^IBM(361.1,RC3611,"ERR",0)) D GETERR^RCDPEDS(RC3611,+$O(^TMP("PRCA_EOB",$J,RC3611," "),-1)) ; get filing errors
"RTN","RCDPEWL2",64,0)
 . S ^TMP("PRCA_EOB",$J,+$O(^TMP("PRCA_EOB",$J,""),-1)+1)=RCDASH
"RTN","RCDPEWL2",65,0)
 . ;
"RTN","RCDPEWL2",66,0)
 S RC3611="" F  S RC3611=$O(^TMP("PRCA_EOB",$J,RC3611)) Q:RC3611=""!RCSTOP  D
"RTN","RCDPEWL2",67,0)
 . S RC1=1
"RTN","RCDPEWL2",68,0)
 . S Z0=0 F  S Z0=$O(^TMP("PRCA_EOB",$J,RC3611,Z0)) Q:'Z0  D  Q:RCSTOP
"RTN","RCDPEWL2",69,0)
 .. I $D(ZTQUEUED),$$S^%ZTLOAD S (RCSTOP,ZTSTOP)=1 K ZTREQ I +$G(RCPG) W !,"***TASK STOPPED BY USER***" Q
"RTN","RCDPEWL2",70,0)
 .. I 'RCPG!(($Y+5)>IOSL) D  I RCSTOP Q
"RTN","RCDPEWL2",71,0)
 ... D:RCPG ASK(.RCSTOP) I RCSTOP Q
"RTN","RCDPEWL2",72,0)
 ... D RHDR(RCSCR,RCDT,.RCPG)
"RTN","RCDPEWL2",73,0)
 .. I RC1 W !!,$G(^TMP("PRCA_EOB1",$J,RC3611,1)) S RC1=0
"RTN","RCDPEWL2",74,0)
 .. W !,$G(^TMP("PRCA_EOB",$J,RC3611,Z0))
"RTN","RCDPEWL2",75,0)
 I 'RCSTOP,RCPG D ASK(.RCSTOP)
"RTN","RCDPEWL2",76,0)
 ;
"RTN","RCDPEWL2",77,0)
 I $D(ZTQUEUED) S ZTREQ="@"
"RTN","RCDPEWL2",78,0)
 I '$D(ZTQUEUED) D ^%ZISC
"RTN","RCDPEWL2",79,0)
 ;
"RTN","RCDPEWL2",80,0)
VPQ K ^TMP("PRCA_EOB",$J),^TMP("PRCA_EOB1",$J)
"RTN","RCDPEWL2",81,0)
 S VALMBCK="R"
"RTN","RCDPEWL2",82,0)
 Q
"RTN","RCDPEWL2",83,0)
 ;
"RTN","RCDPEWL2",84,0)
TPJI ; Jump to Third Party Joint Inquiry for the claim
"RTN","RCDPEWL2",85,0)
 D FULL^VALM1
"RTN","RCDPEWL2",86,0)
 I $G(RCSCR("NOEDIT"))=2 D NOTAV G TPJIQ
"RTN","RCDPEWL2",87,0)
 M ^TMP("RC_SAVE_TMP",$J)=^TMP($J)
"RTN","RCDPEWL2",88,0)
 D OPTION^IBJTLA ; IA 4121
"RTN","RCDPEWL2",89,0)
 D RESTMP^RCDPEWL6
"RTN","RCDPEWL2",90,0)
 ;
"RTN","RCDPEWL2",91,0)
TPJIQ S VALMBCK="R"
"RTN","RCDPEWL2",92,0)
 Q
"RTN","RCDPEWL2",93,0)
 ;
"RTN","RCDPEWL2",94,0)
FAP ; Jump to Full Account Profile
"RTN","RCDPEWL2",95,0)
 D FULL^VALM1
"RTN","RCDPEWL2",96,0)
 ;
"RTN","RCDPEWL2",97,0)
 I $G(RCSCR("NOEDIT"))=2 D NOTAV G FAPQ
"RTN","RCDPEWL2",98,0)
 ;
"RTN","RCDPEWL2",99,0)
 M ^TMP("RC_SAVE_TMP",$J)=^TMP($J)
"RTN","RCDPEWL2",100,0)
 D EN^PRCAAPR("ALL"),RET K DTOUT
"RTN","RCDPEWL2",101,0)
 D RESTMP^RCDPEWL6
"RTN","RCDPEWL2",102,0)
 ;
"RTN","RCDPEWL2",103,0)
FAPQ S VALMBCK="R"
"RTN","RCDPEWL2",104,0)
 Q
"RTN","RCDPEWL2",105,0)
 ;
"RTN","RCDPEWL2",106,0)
RELHOLD ; Jump to Release Hold function
"RTN","RCDPEWL2",107,0)
 N DIR,X,Y,RCDA,RCSCR
"RTN","RCDPEWL2",108,0)
 D FULL^VALM1
"RTN","RCDPEWL2",109,0)
 ;
"RTN","RCDPEWL2",110,0)
 I $G(RCSCR("NOEDIT"))=2 D NOTAV G RELHQ
"RTN","RCDPEWL2",111,0)
 ;
"RTN","RCDPEWL2",112,0)
 M ^TMP("RC_SAVE_TMP",$J)=^TMP($J)
"RTN","RCDPEWL2",113,0)
 D ^IBRREL,RET ; IA = 306
"RTN","RCDPEWL2",114,0)
 D RESTMP^RCDPEWL6
"RTN","RCDPEWL2",115,0)
 ;
"RTN","RCDPEWL2",116,0)
RELHQ S VALMBCK="R"
"RTN","RCDPEWL2",117,0)
 Q
"RTN","RCDPEWL2",118,0)
 ;
"RTN","RCDPEWL2",119,0)
CMRPT ; Jump to claims matching report
"RTN","RCDPEWL2",120,0)
 N DIR,X,Y,RCIBY
"RTN","RCDPEWL2",121,0)
 D FULL^VALM1
"RTN","RCDPEWL2",122,0)
 ;
"RTN","RCDPEWL2",123,0)
 I $G(RCSCR("NOEDIT"))=2 D NOTAV G CMQ
"RTN","RCDPEWL2",124,0)
 ;
"RTN","RCDPEWL2",125,0)
 M ^TMP("RC_SAVE_TMP",$J)=^TMP($J)
"RTN","RCDPEWL2",126,0)
 D ^RCDPRTP,RET
"RTN","RCDPEWL2",127,0)
 D RESTMP^RCDPEWL6
"RTN","RCDPEWL2",128,0)
 ;
"RTN","RCDPEWL2",129,0)
CMQ S VALMBCK="R"
"RTN","RCDPEWL2",130,0)
 Q
"RTN","RCDPEWL2",131,0)
 ;
"RTN","RCDPEWL2",132,0)
CHGMNT ; Jump to charge maintenance
"RTN","RCDPEWL2",133,0)
 N DIR,X,Y,RCSCR
"RTN","RCDPEWL2",134,0)
 D FULL^VALM1
"RTN","RCDPEWL2",135,0)
 ;
"RTN","RCDPEWL2",136,0)
 I $G(RCSCR("NOEDIT"))=2 D NOTAV G CHMQ
"RTN","RCDPEWL2",137,0)
 ;
"RTN","RCDPEWL2",138,0)
 I $D(^XUSEC("PRCA EDI LOCKBOX CHARGES",DUZ)) D
"RTN","RCDPEWL2",139,0)
 . M ^TMP("RC_SAVE_TMP",$J)=^TMP($J)
"RTN","RCDPEWL2",140,0)
 . D EN1AR^IBECEA ; IA 4047
"RTN","RCDPEWL2",141,0)
 . D RESTMP^RCDPEWL6
"RTN","RCDPEWL2",142,0)
 E  D
"RTN","RCDPEWL2",143,0)
 . S DIR(0)="EA",DIR("A",1)="YOU DO NOT HAVE THE KEY NEEDED TO ACCESS THIS OPTION.",DIR("A")="PRESS RETURN TO CONTINUE " W ! D ^DIR K DIR
"RTN","RCDPEWL2",144,0)
 ;
"RTN","RCDPEWL2",145,0)
 S VALMBCK="R"
"RTN","RCDPEWL2",146,0)
CHMQ Q
"RTN","RCDPEWL2",147,0)
 ;
"RTN","RCDPEWL2",148,0)
LSTHLD ; Jump to list current/on hold charges
"RTN","RCDPEWL2",149,0)
 N DIR,X,Y,RCIBY
"RTN","RCDPEWL2",150,0)
 D FULL^VALM1
"RTN","RCDPEWL2",151,0)
 ;
"RTN","RCDPEWL2",152,0)
 I $G(RCSCR("NOEDIT"))=2 D NOTAV G LHQ
"RTN","RCDPEWL2",153,0)
 ;
"RTN","RCDPEWL2",154,0)
 M ^TMP("RC_SAVE_TMP",$J)=^TMP($J)
"RTN","RCDPEWL2",155,0)
 D MAIN^IBOHPT1,RET ; IA 4048
"RTN","RCDPEWL2",156,0)
 D RESTMP^RCDPEWL6
"RTN","RCDPEWL2",157,0)
 ;
"RTN","RCDPEWL2",158,0)
 S VALMBCK="R"
"RTN","RCDPEWL2",159,0)
LHQ Q
"RTN","RCDPEWL2",160,0)
 ;
"RTN","RCDPEWL2",161,0)
REEST ;EP - Protocol action - RCDPE EOB WORKLIST REESTABLISH
"RTN","RCDPEWL2",162,0)
 ; Jump to re-establish bill
"RTN","RCDPEWL2",163,0)
 N PRC
"RTN","RCDPEWL2",164,0)
 D FULL^VALM1
"RTN","RCDPEWL2",165,0)
 I '$D(^XUSEC("RCDPEAR",DUZ)) D  Q  ; PRCA*4.5*318 Added security key check
"RTN","RCDPEWL2",166,0)
 . W !!,"This action can only be taken by users that have the RCDPEAR security key.",!
"RTN","RCDPEWL2",167,0)
 . D PAUSE^VALM1
"RTN","RCDPEWL2",168,0)
 . S VALMBCK="R"
"RTN","RCDPEWL2",169,0)
 ;
"RTN","RCDPEWL2",170,0)
 I $G(RCSCR("NOEDIT"))=2 D NOTAV G REESTQ
"RTN","RCDPEWL2",171,0)
 ;
"RTN","RCDPEWL2",172,0)
 M ^TMP("RC_SAVE_TMP",$J)=^TMP($J)
"RTN","RCDPEWL2",173,0)
 D ^PRCAWREA K DTOUT
"RTN","RCDPEWL2",174,0)
 D RESTMP^RCDPEWL6
"RTN","RCDPEWL2",175,0)
 D RET
"RTN","RCDPEWL2",176,0)
 ;
"RTN","RCDPEWL2",177,0)
REESTQ S VALMBCK="R"
"RTN","RCDPEWL2",178,0)
 Q
"RTN","RCDPEWL2",179,0)
 ;
"RTN","RCDPEWL2",180,0)
BILLCOM ; Jump to bill comment log
"RTN","RCDPEWL2",181,0)
 D FULL^VALM1
"RTN","RCDPEWL2",182,0)
 ;
"RTN","RCDPEWL2",183,0)
 I $G(RCSCR("NOEDIT"))=2 D NOTAV G BILLCOMQ
"RTN","RCDPEWL2",184,0)
 ;
"RTN","RCDPEWL2",185,0)
 M ^TMP("RC_SAVE_TMP",$J)=^TMP($J)
"RTN","RCDPEWL2",186,0)
 D ^PRCACM K DTOUT
"RTN","RCDPEWL2",187,0)
 D RET
"RTN","RCDPEWL2",188,0)
 D RESTMP^RCDPEWL6
"RTN","RCDPEWL2",189,0)
 ;
"RTN","RCDPEWL2",190,0)
BILLCOMQ S VALMBCK="R"
"RTN","RCDPEWL2",191,0)
 Q
"RTN","RCDPEWL2",192,0)
 ;
"RTN","RCDPEWL2",193,0)
ASK(RCSTOP) ;
"RTN","RCDPEWL2",194,0)
 I $E(IOST,1,2)'["C-" Q
"RTN","RCDPEWL2",195,0)
 N DIR,DIROUT,DIRUT,DTOUT,DUOUT
"RTN","RCDPEWL2",196,0)
 S DIR(0)="E" W ! D ^DIR
"RTN","RCDPEWL2",197,0)
 I ($D(DIRUT))!($D(DUOUT)) S RCSTOP=1 Q
"RTN","RCDPEWL2",198,0)
 Q
"RTN","RCDPEWL2",199,0)
 ;
"RTN","RCDPEWL2",200,0)
RHDR(RCSCR,RCDT,RCPG) ;Prints EOB detail report heading
"RTN","RCDPEWL2",201,0)
 N Z
"RTN","RCDPEWL2",202,0)
 S Z=$G(^RCY(344.4,RCSCR,0))
"RTN","RCDPEWL2",203,0)
 I RCPG!($E(IOST,1,2)="C-") W @IOF,*13
"RTN","RCDPEWL2",204,0)
 S RCPG=RCPG+1
"RTN","RCDPEWL2",205,0)
 W !,?15,"EDI LOCKBOX EEOB DETAIL FROM WORKLIST",?55,$$FMTE^XLFDT(RCDT,2),?70,"Page: ",RCPG
"RTN","RCDPEWL2",206,0)
 ; HIPAA 5010 - TRACE # increased in length from 30 to 50 characters therefore it needs to be displayed on its own line
"RTN","RCDPEWL2",207,0)
 W !!,$E(" ERA NUMBER: "_RCSCR_$J("",25),1,25)_"ERA DATE: "_$$FMTE^XLFDT($P(Z,U,4)),!,"INS COMPANY: "_$P(Z,U,6)_"/"_$P(Z,U,3)
"RTN","RCDPEWL2",208,0)
 W !,"ERA TRACE #: "_$P(Z,U,2)
"RTN","RCDPEWL2",209,0)
 W !,$TR($J("",IOM)," ","=")
"RTN","RCDPEWL2",210,0)
 Q
"RTN","RCDPEWL2",211,0)
 ;
"RTN","RCDPEWL2",212,0)
RET ; Pause before returning to list
"RTN","RCDPEWL2",213,0)
 N DIR,X,Y
"RTN","RCDPEWL2",214,0)
 S DIR(0)="EA",DIR("A")="RETURN TO CONTINUE" W ! D ^DIR K DIR
"RTN","RCDPEWL2",215,0)
 Q
"RTN","RCDPEWL2",216,0)
 ;
"RTN","RCDPEWL2",217,0)
NOWAY ; Msg for unidentified bill
"RTN","RCDPEWL2",218,0)
 N DIR,X,Y
"RTN","RCDPEWL2",219,0)
 S DIR(0)="EA",DIR("A",1)="THIS BILL IS NOT IDENTIFIED IN YOUR A/R",DIR("A")="THIS FUNCTION IS NOT AVAILABLE ... RETURN TO CONTINUE " W ! D ^DIR K DIR
"RTN","RCDPEWL2",220,0)
 Q
"RTN","RCDPEWL2",221,0)
 ;
"RTN","RCDPEWL2",222,0)
NOWAY1 ; Msg for ERA level Adjustment 
"RTN","RCDPEWL2",223,0)
 N DIR,X,Y
"RTN","RCDPEWL2",224,0)
 S DIR(0)="EA",DIR("A",1)="THIS IS AN ERA LEVEL ADJUSTMENT - NO DATA EXISTS FOR IT IN YOUR AR",DIR("A")="PRESS ENTER TO CONTINUE" W ! D ^DIR K DIR
"RTN","RCDPEWL2",225,0)
 Q
"RTN","RCDPEWL2",226,0)
 ;
"RTN","RCDPEWL2",227,0)
SET1(RCIBY,RCDA,RCDA1,RC3444,RCREF) ; Set up variables for receipt/ERA
"RTN","RCDPEWL2",228,0)
 S RCDA1=+RCIBY("IBEOB"),RCDA=+$P(RCIBY("IBEOB"),U,2),RC3444=+$P(RCIBY("IBEOB"),U,3),RCREF=+$P(RCIBY("IBEOB"),U,4)
"RTN","RCDPEWL2",229,0)
 Q
"RTN","RCDPEWL2",230,0)
 ;
"RTN","RCDPEWL2",231,0)
CHKFILE ; If the user leaves the split line screen without filing - double check
"RTN","RCDPEWL2",232,0)
 ; that they didn't want to file it.
"RTN","RCDPEWL2",233,0)
 N DIR,X,Y
"RTN","RCDPEWL2",234,0)
 D FULL^VALM1 W !!
"RTN","RCDPEWL2",235,0)
 I $G(^TMP("RCDPE_EOB_SPLIT_OK",$J)),$O(RCSPLIT(0)) D
"RTN","RCDPEWL2",236,0)
 . S DIR(0)="YA",DIR("B")="NO",DIR("A",1)="YOU HAVE NOT FILED THESE CHANGES",DIR("A")="DO YOU WANT TO FILE THEM BEFORE YOU EXIT?: " D ^DIR K DIR
"RTN","RCDPEWL2",237,0)
 . I Y=1 D FILESP^RCDPEWL8
"RTN","RCDPEWL2",238,0)
 K ^TMP($J,"RCDPE_SPLIT_FILE")
"RTN","RCDPEWL2",239,0)
 Q
"RTN","RCDPEWL2",240,0)
 ;
"RTN","RCDPEWL2",241,0)
EDITSP ; Action that edits the split lines
"RTN","RCDPEWL2",242,0)
 ; RCLINE,RCSCR must already exist
"RTN","RCDPEWL2",243,0)
 N DA,RCEDIT,RCDONE,RCDEF,RCSAVE,RCSAVE1
"RTN","RCDPEWL2",244,0)
 D FULL^VALM1
"RTN","RCDPEWL2",245,0)
 ;
"RTN","RCDPEWL2",246,0)
 I $G(RCSCR("NOEDIT"))=2 D NOTAV G EDITQ
"RTN","RCDPEWL2",247,0)
 ;
"RTN","RCDPEWL2",248,0)
 D SEL(.RCEDIT)
"RTN","RCDPEWL2",249,0)
 G:'RCEDIT EDITQ
"RTN","RCDPEWL2",250,0)
 S RCDONE=0
"RTN","RCDPEWL2",251,0)
 M RCSAVE=RCSPLIT,RCSAVE1=RCDIR S RCDEF=$G(RCSPLIT(RCEDIT)),RCSPLIT=RCEDIT
"RTN","RCDPEWL2",252,0)
 D EDIT^RCDPEWL3(RCSCR,RCLINE,.RCDIR,.RCSPLIT,RCDEF,.RCDONE)
"RTN","RCDPEWL2",253,0)
 I '$D(RCSPLIT(RCSAVE)) K RCSPLIT M RCSPLIT=RCSAVE K RCDIR M RCDIR=RCSAVE1
"RTN","RCDPEWL2",254,0)
 D INIT^RCDPEWL3
"RTN","RCDPEWL2",255,0)
EDITQ S VALMBCK="R"
"RTN","RCDPEWL2",256,0)
 Q
"RTN","RCDPEWL2",257,0)
 ;
"RTN","RCDPEWL2",258,0)
PREOB ; Print/View EOB detail
"RTN","RCDPEWL2",259,0)
 N RCDA,RCDAZ,Z,Z0
"RTN","RCDPEWL2",260,0)
 D FULL^VALM1
"RTN","RCDPEWL2",261,0)
 D SEL^RCDPEWL(.RCDA)
"RTN","RCDPEWL2",262,0)
 S RCDA=+$O(RCDA(0)),RCDA=$G(RCDA(RCDA))
"RTN","RCDPEWL2",263,0)
 I RCDA="" G PREOBQ
"RTN","RCDPEWL2",264,0)
 S RCDA=$P($G(^RCY(344.49,RCSCR,1,+RCDA,0)),U,9)
"RTN","RCDPEWL2",265,0)
 F RCDAZ=1:1:$L(RCDA,",") S RCDAZ(RCDAZ)=$P(RCDA,",",RCDAZ)
"RTN","RCDPEWL2",266,0)
 S Z=0 F  S Z=$O(RCDAZ(Z)) Q:'Z  D
"RTN","RCDPEWL2",267,0)
 . ;
"RTN","RCDPEWL2",268,0)
 . S Z0=RCDAZ(Z)
"RTN","RCDPEWL2",269,0)
 . I $E(Z0,1,3)="ADJ" D  Q
"RTN","RCDPEWL2",270,0)
 .. I $G(^RCY(344.4,RCSCR,2,+$P(Z0,"ADJ",2),0))'="" S RCDAZ(Z)="ADJ^"_+$P(Z0,"ADJ",2)
"RTN","RCDPEWL2",271,0)
 . ;
"RTN","RCDPEWL2",272,0)
 . S Z0=$G(^RCY(344.4,RCSCR,1,+Z0,0))
"RTN","RCDPEWL2",273,0)
 . S RCDAZ(Z)=+Z0_U_$S($P(Z0,U,2):$P(Z0,U,2),1:-1) Q
"RTN","RCDPEWL2",274,0)
 ;
"RTN","RCDPEWL2",275,0)
 D VP(RCSCR,.RCDAZ)
"RTN","RCDPEWL2",276,0)
 ;
"RTN","RCDPEWL2",277,0)
PREOBQ S VALMBCK="R"
"RTN","RCDPEWL2",278,0)
 Q
"RTN","RCDPEWL2",279,0)
 ;
"RTN","RCDPEWL2",280,0)
RESEARCH ; Invoke the research menu
"RTN","RCDPEWL2",281,0)
 ;
"RTN","RCDPEWL2",282,0)
 K ^TMP($J,"RC_VALMBG")
"RTN","RCDPEWL2",283,0)
 S ^TMP($J,"RC_VALMBG")=$G(VALMBG)
"RTN","RCDPEWL2",284,0)
 D FULL^VALM1
"RTN","RCDPEWL2",285,0)
 I $G(RCSCR("NOEDIT"))=2 D NOTAV G RQ
"RTN","RCDPEWL2",286,0)
 ;
"RTN","RCDPEWL2",287,0)
 D EN^VALM("RCDPE EOB RESEARCH")
"RTN","RCDPEWL2",288,0)
 ;
"RTN","RCDPEWL2",289,0)
RQ K ^TMP($J,"RC_VALMBG")
"RTN","RCDPEWL2",290,0)
 Q
"RTN","RCDPEWL2",291,0)
 ;
"RTN","RCDPEWL2",292,0)
SEL(RCEDIT) ;
"RTN","RCDPEWL2",293,0)
 N VALMY
"RTN","RCDPEWL2",294,0)
 D EN^VALM2($G(XQORNOD(0)),"S")
"RTN","RCDPEWL2",295,0)
 S RCEDIT=+$O(VALMY(0))
"RTN","RCDPEWL2",296,0)
 Q
"RTN","RCDPEWL2",297,0)
 ;
"RTN","RCDPEWL2",298,0)
EXIT ; Exits back to ERA menu actions from research
"RTN","RCDPEWL2",299,0)
 S VALMBCK="Q"
"RTN","RCDPEWL2",300,0)
 Q
"RTN","RCDPEWL2",301,0)
 ;
"RTN","RCDPEWL2",302,0)
WL(RCRCPT) ; Entrypoint to the ERA Worklist from Receipt Processing
"RTN","RCDPEWL2",303,0)
 ;RCRCPT = ien of entry in file 344
"RTN","RCDPEWL2",304,0)
 N DIR,X,Y,Z
"RTN","RCDPEWL2",305,0)
 D FULL^VALM1
"RTN","RCDPEWL2",306,0)
 ; if not at ERA summary level (344.4,.08), get a receipt match using the cross-reference at the ERA detail (RECEIPT (344.41, .25) 
"RTN","RCDPEWL2",307,0)
 S Z=$S($O(^RCY(344.4,"AREC",RCRCPT,0)):+$O(^RCY(344.4,"AREC",RCRCPT,0)),1:+$O(^RCY(344.4,"H",RCRCPT,0)))
"RTN","RCDPEWL2",308,0)
 I 'Z D  G WLQ
"RTN","RCDPEWL2",309,0)
 . S DIR("A")="THIS RECEIPT IS NOT ASSOCIATED WITH AN ERA RECORD - PRESS RETURN TO CONTINUE ",DIR(0)="EA" W ! D ^DIR K DIR
"RTN","RCDPEWL2",310,0)
 ;
"RTN","RCDPEWL2",311,0)
 I '$D(^RCY(344.49,Z,0)) D  G WLQ
"RTN","RCDPEWL2",312,0)
 . S DIR("A")="NO ERA WORKLIST SCRATCHPAD EXISTS FOR THIS ERA - PRESS RETURN TO CONTINUE ",DIR(0)="EA" W ! D ^DIR K DIR
"RTN","RCDPEWL2",313,0)
 ;
"RTN","RCDPEWL2",314,0)
 D DISP^RCDPEWL(Z,2)
"RTN","RCDPEWL2",315,0)
 ;
"RTN","RCDPEWL2",316,0)
WLQ S VALMBCK="R"
"RTN","RCDPEWL2",317,0)
 Q
"RTN","RCDPEWL2",318,0)
 ;
"RTN","RCDPEWL2",319,0)
NOTAV ; Display not available msg
"RTN","RCDPEWL2",320,0)
 N DIR,X,Y
"RTN","RCDPEWL2",321,0)
 ;
"RTN","RCDPEWL2",322,0)
 S DIR(0)="EA",DIR("A")="THIS ACTION NOT CURRENTLY AVAILABLE - PRESS RETURN TO CONTINUE " W ! D ^DIR K DIR
"RTN","RCDPEWL2",323,0)
 S VALMBCK="R"
"RTN","RCDPEWL2",324,0)
 Q
"RTN","RCDPEWL2",325,0)
 ;
"RTN","RCDPEWL2",326,0)
 ;PRCA*4.5*303 - Add jump to ECME Information from the ERA Worklist Research
"RTN","RCDPEWL2",327,0)
 ; IA 1992 - BILL/CLAIMS file (#399)
"RTN","RCDPEWL2",328,0)
 ; RCIENS exists before this code is called if coming from APAR
"RTN","RCDPEWL2",329,0)
 ; RCERA, RCSCR are assumed to exist before this code is called
"RTN","RCDPEWL2",330,0)
GOECME ; Select an EEOB and then jump to the [IBJT ECME RESP INFO SCREEN]
"RTN","RCDPEWL2",331,0)
 N RCDA,RCDAZ,RCDG,Z,Z0,IBIFN,DFN,RCAPAR
"RTN","RCDPEWL2",332,0)
 S RCAPAR=0
"RTN","RCDPEWL2",333,0)
 I '$D(RCSCR) S RCAPAR=1,(RCERA,RCSCR)=$P($G(RCIENS),U,1) ; From APAR RCSCR & RCERA not defined
"RTN","RCDPEWL2",334,0)
 G:($G(RCERA)="")!($G(RCSCR)="") GOEBQ
"RTN","RCDPEWL2",335,0)
 D FULL^VALM1
"RTN","RCDPEWL2",336,0)
 D SEL^RCDPEWL(.RCDA)
"RTN","RCDPEWL2",337,0)
 S RCDA=+$O(RCDA(0)),RCDA=$G(RCDA(RCDA))
"RTN","RCDPEWL2",338,0)
 I RCDA="" G GOEBQ
"RTN","RCDPEWL2",339,0)
 S RCDA=$P($G(^RCY(344.49,RCSCR,1,+RCDA,0)),U,9)
"RTN","RCDPEWL2",340,0)
 S IBIFN=$P($G(^RCY(344.4,RCERA,1,RCDA,0)),U,2) S:+IBIFN'=0 RCDG=$P($G(^IBM(361.1,IBIFN,0)),U,1)
"RTN","RCDPEWL2",341,0)
 I $G(RCDG)="" W !!,"Problem with Bill IEN: "_IBIFN_", ERA: "_RCERA_" Please report this issue." D PAUSE^VALM1 G GOEBQ
"RTN","RCDPEWL2",342,0)
 S DFN=$P($G(^DGCR(399,RCDG,0)),U,2)
"RTN","RCDPEWL2",343,0)
 I RCAPAR S IBIFN=RCDG
"RTN","RCDPEWL2",344,0)
 I '$$ISRX^IBCEF1(IBIFN) W !!,"Not available. This is not a Pharmacy Claim." D PAUSE^VALM1 G GOEBQ
"RTN","RCDPEWL2",345,0)
 I $$ECME^IBTRE(IBIFN)="" W !!,"Not available. This is a Pharmacy Claim, but not an ECME Claim." D PAUSE^VALM1 G GOEBQ
"RTN","RCDPEWL2",346,0)
 D EN^VALM("IBJT ECME RESP INFO")
"RTN","RCDPEWL2",347,0)
 ;
"RTN","RCDPEWL2",348,0)
GOEBQ S VALMBCK="R"
"RTN","RCDPEWL2",349,0)
 I RCAPAR K RCSCR,RCERA ; Clean up if we are in APAR
"RTN","RCDPEWL2",350,0)
 Q
"RTN","RCDPEWL4")
0^22^B62916742^B57740502
"RTN","RCDPEWL4",1,0)
RCDPEWL4 ;ALB/TMK/PJH - ELECTRONIC EOB WORKLIST ACTIONS ;Jun 06, 2014@19:11:19
"RTN","RCDPEWL4",2,0)
 ;;4.5;Accounts Receivable;**173,208,269,298,303,318**;Mar 20, 1995;Build 37
"RTN","RCDPEWL4",3,0)
 ;;Per VA Directive 6402, this routine should not be modified.
"RTN","RCDPEWL4",4,0)
 ; RCSCR variable must be defined for this routine
"RTN","RCDPEWL4",5,0)
 Q
"RTN","RCDPEWL4",6,0)
 ;
"RTN","RCDPEWL4",7,0)
DISTADJ(RCFR,RCTO,RCAMT,RCCOM) ; Action that distributes an adjustment amount
"RTN","RCDPEWL4",8,0)
 ; against another line item's payment
"RTN","RCDPEWL4",9,0)
 ; Assumes RCSCR = ien of the entry in file 344.49
"RTN","RCDPEWL4",10,0)
 ; RCFR = ien of entry in 344.491 that has a negative net
"RTN","RCDPEWL4",11,0)
 ; RCTO = ien of entry in 344.491 that will be decremented
"RTN","RCDPEWL4",12,0)
 ; RCAMT = the amount being adjusted (positive #)
"RTN","RCDPEWL4",13,0)
 ; RCCOM = the comment to place on the decrease adjustment
"RTN","RCDPEWL4",14,0)
 ;
"RTN","RCDPEWL4",15,0)
 N RCFRX,RCREF,RCFR0,RCFR1,RCFR10,RCTO0,RCTO1,RCTO10,RCY,DIK,DA,DR,DIC,X,Y,DLAYGO,DD,DO,DIE,DIR
"RTN","RCDPEWL4",16,0)
 I $G(^TMP("RCBATCH_SELECTED",$J)) D NOBATCH^RCDPEWL Q
"RTN","RCDPEWL4",17,0)
 S RCFR0=$G(^RCY(344.49,RCSCR,1,RCFR,0)),RCTO0=$G(^RCY(344.49,RCSCR,1,RCTO,0)),RCFRX=+$O(^RCY(344.49,RCSCR,1,"B",RCFR0\1,0)),RCFRX=$G(^RCY(344.49,RCSCR,1,RCFRX,0))
"RTN","RCDPEWL4",18,0)
 S RCREF=$P($P(RCFRX,U,2),"**ADJ",2),RCREF=$S(RCREF="":"",RCREF=0:$P(RCFRX,U,9),1:$P($G(^RCY(344.4,RCSCR,2,+RCREF,0)),U))
"RTN","RCDPEWL4",19,0)
 S RCFR1=+$O(^RCY(344.49,RCSCR,1,"B",RCFR0\1,0)),RCTO1=+$O(^RCY(344.49,RCSCR,1,"B",RCTO0\1,0))
"RTN","RCDPEWL4",20,0)
 S RCFR10=$G(^RCY(344.49,RCSCR,1,RCFR1,0)),RCTO10=$G(^RCY(344.49,RCSCR,1,RCTO1,0))
"RTN","RCDPEWL4",21,0)
 S RCFR0=$G(^RCY(344.49,RCSCR,1,RCFR,0)),RCTO0=$G(^RCY(344.49,RCSCR,1,RCTO,0))
"RTN","RCDPEWL4",22,0)
 S DA(2)=RCSCR,DA(1)=RCFR
"RTN","RCDPEWL4",23,0)
 S DIC("DR")=".02////1;.03////"_RCAMT_";.04////"_$S($P(RCTO0,U,2)'="":$P(RCTO0,U,2),RCREF'="":RCREF,1:"UNKNOWN")
"RTN","RCDPEWL4",24,0)
 S DIC("DR")=DIC("DR")_";.05////0;.06////0;.09////RETRACTED FUNDS DEDUCTED FROM OTHER PAYMENT ON THIS ERA",DIC="^RCY(344.49,"_DA(2)_",1,"_DA(1)_",1,"
"RTN","RCDPEWL4",25,0)
 S DLAYGO=344.4911,DIC(0)="L",X=+$O(^RCY(344.49,RCSCR,1,RCFR,1,"B",""),-1)+1
"RTN","RCDPEWL4",26,0)
 D FILE^DICN K DIC,DD,DO,DLAYGO
"RTN","RCDPEWL4",27,0)
 S RCY=+Y
"RTN","RCDPEWL4",28,0)
 I RCY'>0 D  Q
"RTN","RCDPEWL4",29,0)
 . S DIR(0)="EA",DIR("A",1)="PROBLEM ADDING ADJUSTMENT - NO DISTRIBUTION PERFORMED",DIR("A")="PRESS RETURN TO CONTINUE " D ^DIR K DIR
"RTN","RCDPEWL4",30,0)
 ;
"RTN","RCDPEWL4",31,0)
 S DA(2)=RCSCR,DA(1)=RCTO
"RTN","RCDPEWL4",32,0)
 S DIC("DR")=".02////0;.03////"_$J(-RCAMT,"",2)
"RTN","RCDPEWL4",33,0)
 S DIC("DR")=DIC("DR")_";.04////"_$S($P(RCFR0,U,2)'="":$P(RCFR0,U,2),RCREF'="":RCREF,1:"UNKNOWN")_";.05////"_$S($P($G(^RCY(344.49,RCSCR,1,RCTO1,0)),U,2)'["**ADJ":"1;.08////0",1:0)_";.06////0"_$S(RCCOM'="":";.09////"_RCCOM,1:"")
"RTN","RCDPEWL4",34,0)
 S DIC="^RCY(344.49,"_DA(2)_",1,"_DA(1)_",1,"
"RTN","RCDPEWL4",35,0)
 S DLAYGO=344.4911,DIC(0)="L",X=+$O(^RCY(344.49,RCSCR,1,RCTO,1,"B",""),-1)+1
"RTN","RCDPEWL4",36,0)
 D FILE^DICN K DIC,DD,DO,DLAYGO
"RTN","RCDPEWL4",37,0)
 S RCY=+Y
"RTN","RCDPEWL4",38,0)
 ;
"RTN","RCDPEWL4",39,0)
 I RCY'>0 D  Q
"RTN","RCDPEWL4",40,0)
 . N DA
"RTN","RCDPEWL4",41,0)
 . S DA(2)=RCSCR,DA(1)=RCFR,DA=RCY,DIK="^RCY(344.49,"_DA(2)_",1,"_DA(1)_",1," D ^DIK
"RTN","RCDPEWL4",42,0)
 . S DIR(0)="EA",DIR("A",1)="PROBLEM ADDING ADJUSTMENT - NO DISTRIBUTION PERFORMED",DIR("A")="PRESS RETURN TO CONTINUE " D ^DIR K DIR
"RTN","RCDPEWL4",43,0)
 ;
"RTN","RCDPEWL4",44,0)
 S DA(1)=RCSCR,DA=RCFR,DIE="^RCY(344.49,"_DA(1)_",1,",DR=".06////"_$J($P(RCFR0,U,6)+RCAMT,"",2)_";.08////"_$J($P(RCFR0,U,8)+RCAMT,"",2) D ^DIE
"RTN","RCDPEWL4",45,0)
 S DA=RCFR1,DIE="^RCY(344.49,"_DA(1)_",1,",DR=".06////"_$J($P(RCFR10,U,6)+RCAMT,"",2) D ^DIE
"RTN","RCDPEWL4",46,0)
 S DA(1)=RCSCR,DA=RCTO,DIE="^RCY(344.49,"_DA(1)_",1,",DR=".06////"_$J($P(RCTO0,U,6)-RCAMT,"",2)_";.03////"_$J($P(RCTO0,U,3)-RCAMT,"",2)_";.08////"_$J($P(RCTO0,U,8)-RCAMT,"",2) D ^DIE
"RTN","RCDPEWL4",47,0)
 S DA(1)=RCSCR,DA=RCTO1,DIE="^RCY(344.49,"_DA(1)_",1,",DR=".06////"_$J($P(RCTO10,U,6)-RCAMT,"",2)_";.03////"_$J($P(RCTO10,U,3)-RCAMT,"",2)_";.08////"_$J($P(RCTO10,U,8)-RCAMT,"",2) D ^DIE
"RTN","RCDPEWL4",48,0)
 D BLD^RCDPEWL1($G(^TMP($J,"RC_SORTPARM")))
"RTN","RCDPEWL4",49,0)
 Q
"RTN","RCDPEWL4",50,0)
 ;
"RTN","RCDPEWL4",51,0)
NEWREC ; Create a new receipt from scratch pad entry
"RTN","RCDPEWL4",52,0)
 N Z,Z0,RCOK,RCRECTDA,RCSTOP,DIR,X,Y,RECTDA,CT,DIE,DA,DR,RCER,RCPAYTY,RCHAC,RCDEP,DIC
"RTN","RCDPEWL4",53,0)
 D FULL^VALM1
"RTN","RCDPEWL4",54,0)
 I $G(RCSCR("NOEDIT"))=2 D NOTAV^RCDPEWL2 G NEWRECQ
"RTN","RCDPEWL4",55,0)
 S (RCSTOP,RCOK)=0,VALMBCK="R"
"RTN","RCDPEWL4",56,0)
 S RECTDA=$P($G(^RCY(344.49,RCSCR,0)),U,2)
"RTN","RCDPEWL4",57,0)
 I 'RECTDA S RECTDA=$P($G(^RCY(344.4,RCSCR,0)),U,8)
"RTN","RCDPEWL4",58,0)
 ; PRCA*4.5*303 - Corrected receipt number display to use RECTDA in the DIR("A",1) variable
"RTN","RCDPEWL4",59,0)
 I RECTDA D  G NEWRECQ
"RTN","RCDPEWL4",60,0)
 . S DIR(0)="EA",DIR("A",1)="THIS ERA ALREADY HAS A RECEIPT - "_$P($G(^RCY(344,RECTDA,0)),U)_" - NO RECEIPT CREATED",DIR("A")="PRESS RETURN TO CONTINUE" W ! D ^DIR K DIR
"RTN","RCDPEWL4",61,0)
 S DIR("A",1)="THIS ACTION WILL CREATE THE RECEIPT FOR THIS ERA.  ONCE THE RECEIPT IS",DIR("A",2)=" CREATED HERE, NO MORE AUTOMATIC ADJUSTMENTS MAY BE MADE FOR THIS ERA.",DIR("A",3)=" "
"RTN","RCDPEWL4",62,0)
 S DIR("A")="ARE YOU SURE YOU ARE READY TO CREATE THIS RECEIPT?: ",DIR("B")="NO",DIR(0)="YA"
"RTN","RCDPEWL4",63,0)
 W ! D ^DIR K DIR W !
"RTN","RCDPEWL4",64,0)
 I Y'=1 S DIR(0)="EA",DIR("A")="NO RECEIPT CREATED - PRESS RETURN TO CONTINUE" W ! D ^DIR K DIR G NEWRECQ
"RTN","RCDPEWL4",65,0)
 I $$HASADJ^RCDPEWL8(RCSCR,.RCOK) D  G NEWRECQ
"RTN","RCDPEWL4",66,0)
 . S DIR(0)="EA",DIR("A",1)="AT LEAST ONE LINE ITEM WAS FOUND WITH A NEGATIVE PAYMENT AMOUNT",DIR("A")="NO RECEIPT CAN BE CREATED - PRESS RETURN TO CONTINUE " D ^DIR K DIR S RCSTOP=1
"RTN","RCDPEWL4",67,0)
 I 'RCOK S DIR(0)="EA",DIR("A")="NO RECEIPT CAN BE CREATED - NO POSTABLE LINE ITEMS WERE FOUND" W ! D ^DIR K DIR G NEWRECQ
"RTN","RCDPEWL4",68,0)
 ;
"RTN","RCDPEWL4",69,0)
 S RCHAC=$$HACERA^RCDPEU(RCSCR)
"RTN","RCDPEWL4",70,0)
 S RCPAYTY=$S(RCHAC:8,$P($G(^RCY(344.4,+RCSCR,5)),U,2)="":14,1:4)
"RTN","RCDPEWL4",71,0)
 S RCDEP=""
"RTN","RCDPEWL4",72,0)
 I RCPAYTY=4 D
"RTN","RCDPEWL4",73,0)
 . N RCOK1
"RTN","RCDPEWL4",74,0)
 . F  D  Q:RCOK1
"RTN","RCDPEWL4",75,0)
 .. S RCOK1=1
"RTN","RCDPEWL4",76,0)
 .. S DIC="^RCY(344.1,",DIC("S")="I $P(^(0),U,12)=1",DIC(0)="AEMQ" D ^DIC
"RTN","RCDPEWL4",77,0)
 .. Q:Y'>0
"RTN","RCDPEWL4",78,0)
 .. S RCDEP=+Y
"RTN","RCDPEWL4",79,0)
 .. I RCDEP,$$TOOOLD^RCDPEWLA(RCDEP) S RCOK1=0,RCDEP=""
"RTN","RCDPEWL4",80,0)
 S RECTDA=$$BLDRCPT^RCDPUREC(DT,+RCDEP_$S(RCPAYTY=4:"ERACHK",1:""),+$O(^RC(341.1,"AC",+RCPAYTY,0))) ; Note:ERA with paper check is type 4, but receipt needs to start with an 'E'
"RTN","RCDPEWL4",81,0)
 I 'RECTDA W ! S DIR(0)="EA",DIR("A",1)="A PROBLEM WAS ENCOUNTERED ADDING THE RECEIPT - NO RECEIPT ADDED",DIR("A")="PRESS RETURN TO CONTINUE" W ! D ^DIR K DIR G NEWRECQ
"RTN","RCDPEWL4",82,0)
 ;
"RTN","RCDPEWL4",83,0)
 D RCPTDET^RCDPEM(RCSCR,RECTDA,.RCER)
"RTN","RCDPEWL4",84,0)
 ;
"RTN","RCDPEWL4",85,0)
 S DIE="^RCY(344.49,",DA=RCSCR,DR=".02////"_RECTDA D ^DIE
"RTN","RCDPEWL4",86,0)
 S DIE="^RCY(344.4,",DA=RCSCR,DR=".08////"_RECTDA D ^DIE
"RTN","RCDPEWL4",87,0)
 S Z=+$O(^RCY(344.31,"AERA",RCSCR,0))
"RTN","RCDPEWL4",88,0)
 S DIE="^RCY(344,",DA=RECTDA,DR=".18////"_RCSCR_$S(Z:";.17////"_Z,1:"")_$S(RCPAYTY=4:";.06////"_RCDEP,1:"")_$S($P($G(^RCY(344.31,Z,0)),U,15)'="":";.16////"_$P(^RCY(344.31,Z,0),U,15),1:"") D ^DIE
"RTN","RCDPEWL4",89,0)
 ;
"RTN","RCDPEWL4",90,0)
 I $O(RCER(0)) D
"RTN","RCDPEWL4",91,0)
 . S CT=1,DIR(0)="EA",DIR("A",1)="THE FOLLOWING PROBLEMS OCCURRED WHILE ADDING THE RECEIPT: "
"RTN","RCDPEWL4",92,0)
 . S Z=0 F  S Z=$O(RCER(Z)) Q:'Z  S CT=CT+1,DIR("A",CT)=RCER(Z)
"RTN","RCDPEWL4",93,0)
 . S DIR("A")="PRESS RETURN TO CONTINUE "
"RTN","RCDPEWL4",94,0)
 . W ! D ^DIR K DIR
"RTN","RCDPEWL4",95,0)
 ;
"RTN","RCDPEWL4",96,0)
 S DIR(0)="YA",DIR("A")="DO YOU WANT TO GO TO RECEIPT PROCESSING NOW? ",DIR("A",1)=" ",DIR("A",2)="RECEIPT "_$P($G(^RCY(344,+RECTDA,0)),U)_" HAS BEEN CREATED FOR THIS ERA",DIR("B")="YES" W ! D ^DIR K DIR
"RTN","RCDPEWL4",97,0)
 I Y=1 S RCRECTDA=RECTDA D EN^VALM("RCDP RECEIPT PROFILE")
"RTN","RCDPEWL4",98,0)
 S RCSCR=0
"RTN","RCDPEWL4",99,0)
 S VALMBCK="Q"
"RTN","RCDPEWL4",100,0)
 ;
"RTN","RCDPEWL4",101,0)
NEWRECQ Q
"RTN","RCDPEWL4",102,0)
 ;
"RTN","RCDPEWL4",103,0)
VRECPT ;EP - Protocol action - RCDPE EOB WL RECEIPT VIEW
"RTN","RCDPEWL4",104,0)
 ; Preview receipt lines
"RTN","RCDPEWL4",105,0)
 ; Assume RCSCR = ien from file 344.49 (and 344.4)
"RTN","RCDPEWL4",106,0)
 N DIR,RCOK,RCZ,X,Y,Z,Z0
"RTN","RCDPEWL4",107,0)
 D FULL^VALM1
"RTN","RCDPEWL4",108,0)
 S VALMBCK="R"
"RTN","RCDPEWL4",109,0)
 I '$D(^XUSEC("RCDPEPP",DUZ)) D  Q  ; PRCA*4.5*318 Added security key check
"RTN","RCDPEWL4",110,0)
 . W !!,"This action can only be taken by users that have the RCDPEPP security key.",!
"RTN","RCDPEWL4",111,0)
 . D PAUSE^VALM1
"RTN","RCDPEWL4",112,0)
 I $S($P($G(^RCY(344.4,RCSCR,4)),U,2)]"":1,1:0) D VR^RCDPEWLP(RCSCR) G VRECPTQ   ; prca*4.5*298  auto-posted ERAs are handled differently
"RTN","RCDPEWL4",113,0)
 ;
"RTN","RCDPEWL4",114,0)
 ;
"RTN","RCDPEWL4",115,0)
 ; prca*4.5*298  per patch requirements, keep code related to creating/maintaining
"RTN","RCDPEWL4",116,0)
 ; batches but just remove from execution.
"RTN","RCDPEWL4",117,0)
 ; I $G(^TMP("RCBATCH_SELECTED",$J)) D NOBATCH^RCDPEWL Q
"RTN","RCDPEWL4",118,0)
 ;I $O(^RCY(344.49,RCSCR,3,0)) D  Q:'RCOK
"RTN","RCDPEWL4",119,0)
 ;. S RCOK=1
"RTN","RCDPEWL4",120,0)
 ;. S Z=0 F  S Z=$O(^RCY(344.49,RCSCR,3,Z)) Q:'Z  I '$P($G(^(Z,0)),U,3) S RCOK=0 Q
"RTN","RCDPEWL4",121,0)
 ;. I 'RCOK S DIR(0)="EA",DIR("A",1)="A RECEIPT CANNOT BE PREVIEWED UNTIL ALL BATCHES FOR THIS ERA ARE MARKED AS",DIR("A",2)="'READY TO POST'",DIR("A")="PRESS RETURN TO CONTINUE " W ! D ^DIR K DIR
"RTN","RCDPEWL4",122,0)
 ; end of prca*4.5*298
"RTN","RCDPEWL4",123,0)
 S Z=0 F  S Z=$O(^RCY(344.49,RCSCR,1,Z)) Q:'Z  I $P(Z,".",2) S Z0=$G(^(Z,0)) I $P(Z0,U,6)<0 S RCZ($P(Z0,U))=$P(Z0,U,2)_U_$P(Z0,U,6)
"RTN","RCDPEWL4",124,0)
 I $O(RCZ(""))'="" D
"RTN","RCDPEWL4",125,0)
 . W !,"THE FOLLOWING LINES HAVE A NET PAYMENT LESS THAN 0.  THESE LINES MUST HAVE",!,"THIS NEGATIVE AMOUNT DISTRIBUTED TO OTHER LINE(S) IN THE ERA BEFORE A",!,"RECEIPT CAN BE CREATED."
"RTN","RCDPEWL4",126,0)
 . S Z="" F  S Z=$O(RCZ(Z)) Q:Z=""  W !,$J("",5)_$J(Z,10)_"  "_$E($P(RCZ(Z),U)_$J("",15),1,15)_"  "_$J(+$P(RCZ(Z),U,2),"",2)
"RTN","RCDPEWL4",127,0)
 . W !
"RTN","RCDPEWL4",128,0)
 . S DIR(0)="E" D ^DIR K DIR
"RTN","RCDPEWL4",129,0)
 ;
"RTN","RCDPEWL4",130,0)
 D EN^VALM("RCDPE EOB RECEIPT PREVIEW")
"RTN","RCDPEWL4",131,0)
VRECPTQ ;
"RTN","RCDPEWL4",132,0)
 S VALMBCK=$S('$G(RCSCR):"Q",1:"R")
"RTN","RCDPEWL4",133,0)
 Q
"RTN","RCDPEWL4",134,0)
 ;
"RTN","RCDPEWL4",135,0)
 ; PRCA*4.5*303 - Receipt Processing 
"RTN","RCDPEWL4",136,0)
RECPROC ;EP - Protocol action -  RCDPE EON WORKLIST RECEIPT PROCESSING
"RTN","RCDPEWL4",137,0)
 ; Receipt Processing
"RTN","RCDPEWL4",138,0)
 ; Called by RCDPE EOB WORKLIST RECEIPT PROCESSING protocol
"RTN","RCDPEWL4",139,0)
 ; Assume RCSCR is the IEN from file 344.49 (and 344.4)
"RTN","RCDPEWL4",140,0)
 ; Variable RCRECTDA is needed by RECEIPT PROFILE so is not newed
"RTN","RCDPEWL4",141,0)
 ; Variable RCDPFXIT is used by RCDPLPLM for immediate exit so newed it here so that does not happen
"RTN","RCDPEWL4",142,0)
 ;
"RTN","RCDPEWL4",143,0)
 N ARRAY,RECIEN,RECEIPT,CNT,DIR,X,Y,DTOUT,DUOUT,DROUT,DIRUT,I,LIST,RCDPFXIT
"RTN","RCDPEWL4",144,0)
 D FULL^VALM1
"RTN","RCDPEWL4",145,0)
 S VALMBCK="R"
"RTN","RCDPEWL4",146,0)
 I '$D(^XUSEC("RCDPEPP",DUZ)) D  Q  ; PRCA*4.5*318 Added security key check
"RTN","RCDPEWL4",147,0)
 . W !!,"This action can only be taken by users that have the RCDPEPP security key.",!
"RTN","RCDPEWL4",148,0)
 . D PAUSE^VALM1
"RTN","RCDPEWL4",149,0)
 ;
"RTN","RCDPEWL4",150,0)
 ; Get list of receipts from the ERA detail multiple
"RTN","RCDPEWL4",151,0)
 S RECIEN=0,CNT=0
"RTN","RCDPEWL4",152,0)
 F  S RECIEN=$O(^RCY(344.4,RCSCR,1,"RECEIPT",RECIEN)) Q:'RECIEN  D
"RTN","RCDPEWL4",153,0)
 . S RECEIPT=$P($G(^RCY(344,RECIEN,0)),U)
"RTN","RCDPEWL4",154,0)
 . I RECEIPT]"" S CNT=CNT+1,ARRAY(CNT)=RECEIPT_"^"_RECIEN
"RTN","RCDPEWL4",155,0)
 ;
"RTN","RCDPEWL4",156,0)
 ; The array of receipts does not exist, this could be a non auto-posted ERA; so only 1 receipt will be assigned; retrieve at 344.4, .08
"RTN","RCDPEWL4",157,0)
 I '$D(ARRAY),$$GET1^DIQ(344.4,RCSCR_",",.08)'="" S CNT=1,ARRAY(1)=$$GET1^DIQ(344.4,RCSCR_",",.08,"E")_"^"_$$GET1^DIQ(344.4,RCSCR_",",.08,"I")
"RTN","RCDPEWL4",158,0)
 ;
"RTN","RCDPEWL4",159,0)
 ; No receipt - display mesage and quit
"RTN","RCDPEWL4",160,0)
 I CNT=0 K DIR S DIR("A",1)="No receipts exist for this ERA." G RECPROCQ
"RTN","RCDPEWL4",161,0)
 ;
"RTN","RCDPEWL4",162,0)
 ; One receipt - Use it
"RTN","RCDPEWL4",163,0)
 I CNT=1 S RCRECTDA=$P(ARRAY(1),U,2) G RECPROC1
"RTN","RCDPEWL4",164,0)
 ;
"RTN","RCDPEWL4",165,0)
 ; Multiple receipts - User needs to select
"RTN","RCDPEWL4",166,0)
 W !
"RTN","RCDPEWL4",167,0)
 S LIST=""
"RTN","RCDPEWL4",168,0)
 F I=1:1:CNT S LIST=LIST_$S(LIST]"":";",1:"")_I_":"_$P(ARRAY(I),U,1)
"RTN","RCDPEWL4",169,0)
 S DIR(0)="SO^"_LIST,DIR("A")="Select Receipt"
"RTN","RCDPEWL4",170,0)
 D ^DIR
"RTN","RCDPEWL4",171,0)
 I Y<1!(Y>CNT) K DIR S DIR("A",1)="No selection made" G RECPROCQ
"RTN","RCDPEWL4",172,0)
 S RCRECTDA=$P(ARRAY(Y),U,2)
"RTN","RCDPEWL4",173,0)
RECPROC1 ;
"RTN","RCDPEWL4",174,0)
 D EN^VALM("RCDP RECEIPT PROFILE")
"RTN","RCDPEWL4",175,0)
 ; If RCDPFXIT is set, exit option entirely was selected so quit back to the menu
"RTN","RCDPEWL4",176,0)
 I $G(RCDPFXIT) S VALMBCK="Q"
"RTN","RCDPEWL4",177,0)
 Q
"RTN","RCDPEWL4",178,0)
 ;
"RTN","RCDPEWL4",179,0)
RECPROCQ ;
"RTN","RCDPEWL4",180,0)
 ; Display the message in DIR("A",1) and then press enter
"RTN","RCDPEWL4",181,0)
 S DIR(0)="EA",DIR("A")="Press ENTER to continue: "
"RTN","RCDPEWL4",182,0)
 W ! D ^DIR K DIR
"RTN","RCDPEWL4",183,0)
 Q
"RTN","RCDPEWL6")
0^20^B85551309^B81815547
"RTN","RCDPEWL6",1,0)
RCDPEWL6 ;ALB/TMK/KML - ELECTRONIC EOB WORKLIST ACTIONS ;Jun 06, 2014@19:11:19
"RTN","RCDPEWL6",2,0)
 ;;4.5;Accounts Receivable;**173,208,222,276,298,303,318**;Mar 20, 1995;Build 37
"RTN","RCDPEWL6",3,0)
 ;;Per VA Directive 6402, this routine should not be modified.
"RTN","RCDPEWL6",4,0)
 Q
"RTN","RCDPEWL6",5,0)
 ;
"RTN","RCDPEWL6",6,0)
DISTADJ ;EP - Protocol action - RCDPE EOB WORKLIST DIST ADJ
"RTN","RCDPEWL6",7,0)
 ; Distribute an adjustment that retracts a payment to other bill(s)
"RTN","RCDPEWL6",8,0)
 ; NOTE: RCSCR is assumed to be the IEN of the ERA entry in file 344.49
"RTN","RCDPEWL6",9,0)
 N RCDA,RCDA1,RCAMT,RCADJ,RCQUIT,Z,Z0,Z1,DIR,X,Y,CT,RCZ,RCZ1,RCZ2,RCADJOK,TOT,DTOUT,DUOUT
"RTN","RCDPEWL6",10,0)
 N RCNONSP,RCACTIVE,RCZZ1,RCZZ2,RCADJSTR  ; prca276 - variables used to establish non-specific payment adjustments and AR BILL claim status (fix to negative claim balance issue)
"RTN","RCDPEWL6",11,0)
 D FULL^VALM1
"RTN","RCDPEWL6",12,0)
 I $S($P($G(^RCY(344.4,RCSCR,4)),U,2)]"":1,1:0) D NOEDIT^RCDPEWLP G DISTQ   ;prca*4.5*298  auto-posted ERAs cannot enter dISTRIBUTE ADJ AMTS action      
"RTN","RCDPEWL6",13,0)
 I $G(RCSCR("NOEDIT")) D NOEDIT^RCDPEWL G DISTQ
"RTN","RCDPEWL6",14,0)
 I $G(^TMP("RCBATCH_SELECTED",$J)) D NOBATCH^RCDPEWL G DISTQ
"RTN","RCDPEWL6",15,0)
 ;
"RTN","RCDPEWL6",16,0)
 S Z=0,RCADJOK="" F  S Z=$O(^TMP("RCDPE-EOB_WLDX",$J,Z)) Q:'Z  S Z1=+$P($G(^(Z)),U,2),Z0=$G(^RCY(344.49,RCSCR,1,Z1,0)) D
"RTN","RCDPEWL6",17,0)
 . I $P(Z0,U)'["." S RCADJOK=($P(Z0,U,2)["**ADJ") Q
"RTN","RCDPEWL6",18,0)
 . I '$P(Z0,U,7),'RCADJOK Q  ; Suspense item cannot be used to adjust
"RTN","RCDPEWL6",19,0)
 . I $P(Z0,U,6)<0 S RCZ(Z)=$P(Z0,U,6)_U_Z1 Q
"RTN","RCDPEWL6",20,0)
 . I $P(Z0,U,6)>0 D  Q
"RTN","RCDPEWL6",21,0)
 .. N Q,ONHLD,IBA
"RTN","RCDPEWL6",22,0)
 .. S ONHLD=0
"RTN","RCDPEWL6",23,0)
 .. I $P(Z0,U,7) I $$IB^IBRUTL(+$P(Z0,U,7),1) S Q=0 F  S Q=$O(IBA(Q)) Q:'Q  I $P($G(^IB(+IBA(Q),0)),U,5)=8 S ONHLD=1 Q
"RTN","RCDPEWL6",24,0)
 .. S RCZ1(+$P(Z0,U,6),Z)=Z1_U_ONHLD,RCZ2(Z)=Z1_U_$P(Z0,U,6)_U_ONHLD Q
"RTN","RCDPEWL6",25,0)
 ;
"RTN","RCDPEWL6",26,0)
 I $O(RCZ(0))="" D  G DISTQ
"RTN","RCDPEWL6",27,0)
 . S DIR(0)="EA",DIR("A",1)="NO LINES EXIST NEEDING ADJUSTMENT DISTRIBUTION",DIR("A")="PRESS RETURN TO CONTINUE" W ! D ^DIR K DIR
"RTN","RCDPEWL6",28,0)
 ;
"RTN","RCDPEWL6",29,0)
 I $O(RCZ1(0))="" D  G DISTQ
"RTN","RCDPEWL6",30,0)
 . S DIR(0)="EA",DIR("A",1)="NO VALID LINES EXIST ON THIS ERA WHERE A DISTRIBUTION CAN BE MADE",DIR("A",2)=$$WHAT(RCSCR),DIR("A")="PRESS RETURN TO CONTINUE" W ! D ^DIR K DIR
"RTN","RCDPEWL6",31,0)
 ;
"RTN","RCDPEWL6",32,0)
 S RCQUIT=0
"RTN","RCDPEWL6",33,0)
 F  S DIR(0)="NA^1:9999:3",DIR("A")="SELECT A LINE THAT NEEDS AN ADJUSTMENT AMOUNT DISTRIBUTED: " D  Q:RCQUIT
"RTN","RCDPEWL6",34,0)
 . S DIR("?",1)="THE FOLLOWING LINE(S) HAVE AN ADJUSTMENT THAT CAUSED A NEGATIVE NET PAYMENT.",DIR("?",2)="IN ORDER TO BALANCE THE RECEIPT AND THE DEPOSIT, THESE AMOUNTS WILL NEED TO",DIR("?",3)="  BE DISTRIBUTED TO OTHER LINE(S)",CT=3
"RTN","RCDPEWL6",35,0)
 . S Z=0
"RTN","RCDPEWL6",36,0)
 . F  S Z=$O(RCZ(Z)) Q:'Z  S CT=CT+1,DIR("?",CT)="  "_$J(Z,8)_"  "_$J($P(RCZ(Z),U),15,2)
"RTN","RCDPEWL6",37,0)
 . S DIR("?")=" "
"RTN","RCDPEWL6",38,0)
 . I $O(RCZ(0))=$O(RCZ(""),-1) S DIR("B")=$O(RCZ(0))
"RTN","RCDPEWL6",39,0)
 . W ! D ^DIR K DIR
"RTN","RCDPEWL6",40,0)
 . I $D(DUOUT)!$D(DTOUT)!(Y="") S RCQUIT=1,RCDA="" Q
"RTN","RCDPEWL6",41,0)
 . I '$D(^TMP("RCDPE-EOB_WLDX",$J,Y)) W !,"THIS LINE DOES NOT EXIST FOR THIS ERA" W ! Q
"RTN","RCDPEWL6",42,0)
 . I '$D(RCZ(Y)) D  Q:Y=""
"RTN","RCDPEWL6",43,0)
 .. I Y'[".",$D(RCZ(Y_".001")),$O(RCZ(Y+1),-1)=(Y_".001") S Y=Y_".001" Q
"RTN","RCDPEWL6",44,0)
 .. W !,$S(Y["."!($O(RCZ(Y))\1'=(Y\1)):"THIS LINE DOESN'T NEED AN ADJUSTMENT DISTRIBUTION",1:"PLEASE ENTER THE ENTIRE LINE # (Such as: 1.001)") W !
"RTN","RCDPEWL6",45,0)
 .. S Y=""
"RTN","RCDPEWL6",46,0)
 . W !,"  LINE #: "_+Y_"  AMOUNT NEEDED TO DISTRIBUTE: "_$J(+RCZ(Y),"",2),!
"RTN","RCDPEWL6",47,0)
 . ; RCDA = the ien of the line in file 344.491
"RTN","RCDPEWL6",48,0)
 . ; RCDA(1) = the line #        RCDA(2) = the amount to be adjusted (+)
"RTN","RCDPEWL6",49,0)
 . S RCDA=$P(RCZ(Y),U,2),RCDA(1)=Y,RCQUIT=1,RCDA(2)=-$P(RCZ(Y),U)
"RTN","RCDPEWL6",50,0)
 ;
"RTN","RCDPEWL6",51,0)
 G:$G(RCDA)="" DISTQ
"RTN","RCDPEWL6",52,0)
 ;
"RTN","RCDPEWL6",53,0)
 S RCQUIT=0
"RTN","RCDPEWL6",54,0)
 ;
"RTN","RCDPEWL6",55,0)
 ; PRCA*4.5*303 - May miss if multiple amounts are equal, changed calculation to use RCZ2 instead of RCZ1 
"RTN","RCDPEWL6",56,0)
 ; Old code: S (TOT,Z)=0 F  S Z=$O(RCZ1(Z)) Q:'Z  S TOT=TOT+Z
"RTN","RCDPEWL6",57,0)
 S (TOT,Z)=0 F  S Z=$O(RCZ2(Z)) Q:'Z  S TOT=TOT+$P(RCZ2(Z),U,2)
"RTN","RCDPEWL6",58,0)
 I TOT<RCDA(2) D  G DISTQ
"RTN","RCDPEWL6",59,0)
 . S DIR(0)="EA",DIR("A",1)="THE ERA DOES NOT HAVE ENOUGH VALID PAYMENTS TO OFFSET THIS DISTRIBUTION",DIR("A",2)=$$WHAT(RCSCR),DIR("A")="PRESS RETURN TO CONTINUE" W ! D ^DIR K DIR
"RTN","RCDPEWL6",60,0)
 F  S DIR(0)="NA^1:9999:3",DIR("A")="SELECT A LINE TO DISTRIBUTE THE ADJUSTMENT AMOUNT TO: " D  Q:RCQUIT
"RTN","RCDPEWL6",61,0)
 . S DIR("?",1)="THE FOLLOWING LINE(S) HAVE A NET PAYMENT THAT CAN BE USED TO OFFSET THE",DIR("?",2)="  NEGATIVE NET PAYMENT FOR LINE "_RCDA(1)_" ("_$J(+$P(RCZ(RCDA(1)),U),"",2)_"):",CT=2
"RTN","RCDPEWL6",62,0)
 . S Z="" F  S Z=$O(RCZ1(Z),-1) Q:'Z  S Z0=0 F  S Z0=$O(RCZ1(Z,Z0)) Q:'Z0  S CT=CT+1,DIR("?",CT)="  "_$J(Z0,8)_"  "_$J(+Z,15,2)_$S($P(RCZ1(Z,Z0),U,2):" On hold exists",1:"")
"RTN","RCDPEWL6",63,0)
 . S DIR("?")=" "
"RTN","RCDPEWL6",64,0)
 . I $O(RCZ2(0))=$O(RCZ2(""),-1) S DIR("B")=$O(RCZ2(0))
"RTN","RCDPEWL6",65,0)
 . W ! D ^DIR K DIR
"RTN","RCDPEWL6",66,0)
 . I $D(DUOUT)!$D(DTOUT)!(Y="") S RCQUIT=1,RCDA1="" Q
"RTN","RCDPEWL6",67,0)
 . I '$D(^TMP("RCDPE-EOB_WLDX",$J,Y)) W !,"THIS LINE DOES NOT EXIST FOR THIS ERA" W ! Q
"RTN","RCDPEWL6",68,0)
 . I '$D(RCZ2(Y)) D  Q:Y=""
"RTN","RCDPEWL6",69,0)
 .. I Y'[".",$D(RCZ2(Y_".001")),$O(RCZ2(Y+1),-1)=(Y_".001") S Y=Y_".001" Q
"RTN","RCDPEWL6",70,0)
 .. I Y'[".",$O(RCZ2(Y))\1'=Y S Y=Y_"."
"RTN","RCDPEWL6",71,0)
 .. W !,$S(Y[".":"THIS LINE CANNOT BE USED FOR AN ADJUSTMENT DISTRIBUTION",1:"PLEASE ENTER THE ENTIRE LINE # (Such as: 1.001)") W !
"RTN","RCDPEWL6",72,0)
 .. S Y=""
"RTN","RCDPEWL6",73,0)
 . ; prca276 - next few lines represent the a fix to prevent distributions agains collected/closed claims (claim balance = zero dollars)
"RTN","RCDPEWL6",74,0)
 . ;distributions should only occur on line items that have specific payments against active claims 
"RTN","RCDPEWL6",75,0)
 . S RCZZ1=$P(^TMP("RCDPE-EOB_WLDX",$J,Y),U,2) ; get line item sequence # off the VIEW order before accessing the scratchpad
"RTN","RCDPEWL6",76,0)
 . S (RCZZ2,RCNONSP)=0 F  S RCZZ2=$O(^RCY(344.49,RCSCR,1,RCZZ1,1,RCZZ2)) Q:'RCZZ2  Q:RCNONSP  S RCADJSTR=$G(^(RCZZ2,0)) S RCNONSP=$S($P(RCADJSTR,U,2)=3:1,$P(RCADJSTR,U,2)=5:1,1:0)    ;identify if non-specific payment adjustments exist
"RTN","RCDPEWL6",77,0)
 . ; do not evaluate claim status for non-specific payment adjustments
"RTN","RCDPEWL6",78,0)
 . I 'RCNONSP D  Q:'RCACTIVE
"RTN","RCDPEWL6",79,0)
 . . S RCACTIVE=$$GET1^DIQ(430,$P(^RCY(344.49,RCSCR,1,RCZZ1,0),U,7),8)
"RTN","RCDPEWL6",80,0)
 . . I (RCACTIVE'="ACTIVE")&(RCACTIVE'="OPEN") S RCACTIVE=0 W !,"THIS IS NOT AN ACTIVE BILL !",!,"CANNOT PERFORM DISTRIBUTION TO THIS CLAIM",! Q
"RTN","RCDPEWL6",81,0)
 . . S RCACTIVE=1
"RTN","RCDPEWL6",82,0)
 . I $P(RCZ2(Y),U,3) W !,"Warning - on-hold exists for this claim",!
"RTN","RCDPEWL6",83,0)
 . W !,"  LINE #: "_+Y_"  LINE BALANCE: "_$J(+$P(RCZ2(Y),U,2),"",2),!
"RTN","RCDPEWL6",84,0)
 . ; RCDA1 = the ien of the line in file 344.491
"RTN","RCDPEWL6",85,0)
 . ; RCDA1(1) = the line # in the display
"RTN","RCDPEWL6",86,0)
 . S RCDA1(1)=Y,RCDA1=+$G(RCZ2(Y)),RCQUIT=1
"RTN","RCDPEWL6",87,0)
 . S Z=$O(^RCY(344.49,RCSCR,1,"B",RCDA1(1)\1,0))
"RTN","RCDPEWL6",88,0)
 . S RCADJ=0
"RTN","RCDPEWL6",89,0)
 . I $P($G(^RCY(344.49,RCSCR,1,Z,0)),U,2)["**ADJ" S RCADJ=1 W !,"THE LINE SELECTED IS AN ADDITIONAL PAYMENT LINE, NOT SPECIFIC TO A CLAIM",!,"THE AMT WILL BE DISTRIBUTED, BUT A DECREASE ADJUSTMENT WILL NOT BE PERFORMED",!
"RTN","RCDPEWL6",90,0)
 ;
"RTN","RCDPEWL6",91,0)
 G:'$G(RCDA1) DISTQ
"RTN","RCDPEWL6",92,0)
 ;
"RTN","RCDPEWL6",93,0)
 S DIR("B")=$S(RCDA(2)<$P(RCZ2(RCDA1(1)),U,2):$J(RCDA(2),"",2),1:$J($P(RCZ2(+RCDA1(1)),U,2),"",2))
"RTN","RCDPEWL6",94,0)
 S DIR(0)="NA^.01:"_DIR("B")_":2",DIR("A")="ADJUSTMENT AMOUNT TO DISTRIBUTE: "
"RTN","RCDPEWL6",95,0)
 S DIR("?",1)="THIS IS THE AMOUNT OF THE ADJUSTMENT THAT SHOULD BE APPLIED TO THIS",DIR("?")="PAYMENT LINE.  THE AMT ENTERED MUST BE BETWEEN .01 AND "_$J(DIR("B"),"",2)
"RTN","RCDPEWL6",96,0)
 D ^DIR K DIR
"RTN","RCDPEWL6",97,0)
 ;
"RTN","RCDPEWL6",98,0)
 I $D(DUOUT)!$D(DTOUT)!'Y D  G DISTQ
"RTN","RCDPEWL6",99,0)
 . S DIR(0)="EA",DIR("A",1)="NO AMOUNT WAS ENTERED - TRY AGAIN LATER",DIR("A")="PRESS RETURN TO CONTINUE " D ^DIR K DIR
"RTN","RCDPEWL6",100,0)
 S RCAMT=$J(Y,"",2)
"RTN","RCDPEWL6",101,0)
 ;
"RTN","RCDPEWL6",102,0)
 D ^DIR K DIR
"RTN","RCDPEWL6",103,0)
 I $D(DUOUT)!$D(DTOUT) D  G DISTQ
"RTN","RCDPEWL6",104,0)
 . S DIR(0)="EA",DIR("A")="USER ABORT - PRESS RETURN TO CONTINUE " D ^DIR K DIR
"RTN","RCDPEWL6",105,0)
 ;
"RTN","RCDPEWL6",106,0)
 S Y=""
"RTN","RCDPEWL6",107,0)
 I 'RCADJ D  G:'$D(RCDA) DISTQ
"RTN","RCDPEWL6",108,0)
 . N Z,RCA
"RTN","RCDPEWL6",109,0)
 . S RCA=0,Z1=+$P($G(^TMP("RCDPE-EOB_WLDX",$J,RCDA(1)\1)),U,2),Z=$G(^RCY(344.49,RCSCR,1,Z1,0)),RCA("#")=+$P($P(Z,U,2),"**ADJ",2)
"RTN","RCDPEWL6",110,0)
 . I $P(Z,U,2)["**ADJ" D
"RTN","RCDPEWL6",111,0)
 .. S RCA=1
"RTN","RCDPEWL6",112,0)
 .. S RCA("REF")=$S(RCA("#"):$P($G(^RCY(344.4,RCSCR,2,RCA("#"),0)),U),1:$P(Z,U,9))
"RTN","RCDPEWL6",113,0)
 . S Z=$S(RCA:RCA("#"),1:$G(^RCY(344.49,RCSCR,1,RCDA,0)))
"RTN","RCDPEWL6",114,0)
 . S DIR(0)="FAO^1:60",DIR("A")="  > ",DIR("A",1)="DECREASE ADJ COMMENT (1-60 CHARACTERS): "
"RTN","RCDPEWL6",115,0)
 . S DIR("B")="RETRACTED FOR "
"RTN","RCDPEWL6",116,0)
 . S DIR("B")=DIR("B")_$S(RCA:"ERA ADJ #"_Z_" Ref: "_RCA("REF"),1:"CLAIM "_$S($P(Z,U,2)'="":$P(Z,U,2),1:"UNKNOWN"))
"RTN","RCDPEWL6",117,0)
 . I $L(DIR("B"))>60 S DIR("B")=$E(DIR("B"),1,60)
"RTN","RCDPEWL6",118,0)
 . D ^DIR K DIR
"RTN","RCDPEWL6",119,0)
 . ;
"RTN","RCDPEWL6",120,0)
 . I $D(DUOUT)!$D(DTOUT) D  Q
"RTN","RCDPEWL6",121,0)
 .. K RCDA
"RTN","RCDPEWL6",122,0)
 .. S DIR(0)="EA",DIR("A")="USER ABORT - PRESS RETURN TO CONTINUE " D ^DIR K DIR
"RTN","RCDPEWL6",123,0)
 ;
"RTN","RCDPEWL6",124,0)
 D DISTADJ^RCDPEWL4(RCDA,RCDA1,RCAMT,Y)
"RTN","RCDPEWL6",125,0)
 ;
"RTN","RCDPEWL6",126,0)
DISTQ S VALMBCK="R"
"RTN","RCDPEWL6",127,0)
 Q
"RTN","RCDPEWL6",128,0)
 ;
"RTN","RCDPEWL6",129,0)
REFRESH ;EP - Protocol action - RCDPE EOB WORKLIST REFRESH
"RTN","RCDPEWL6",130,0)
 ; Refresh the entry in file 344.49 to remove all user adjustments
"RTN","RCDPEWL6",131,0)
 N DA,DIK,DIR,RCQUIT,RCREDEF,X,Y,Z,Z0
"RTN","RCDPEWL6",132,0)
 D FULL^VALM1
"RTN","RCDPEWL6",133,0)
 I '$D(^XUSEC("RCDPEPP",DUZ)) D  Q  ; PRCA*4.5*318 Added security key check
"RTN","RCDPEWL6",134,0)
 . W !!,"This action can only be taken by users that have the RCDPEPP security key.",!
"RTN","RCDPEWL6",135,0)
 . D PAUSE^VALM1
"RTN","RCDPEWL6",136,0)
 . S VALMBCK="R"
"RTN","RCDPEWL6",137,0)
 I $S($P($G(^RCY(344.4,RCSCR,4)),U,2)]"":1,1:0) D NOEDIT^RCDPEWLP G REFQ   ;prca*4.5*298  auto-posted ERAs cannot enter REFRESH SCRATCHPAD action      
"RTN","RCDPEWL6",138,0)
 I $G(RCSCR("NOEDIT")) D NOEDIT^RCDPEWL G REFQ
"RTN","RCDPEWL6",139,0)
 ; prca*4.5*298  per patch requirements, keep code related to creating/maintaining
"RTN","RCDPEWL6",140,0)
 ; batches but just remove from execution
"RTN","RCDPEWL6",141,0)
 ;I $G(^TMP("RCBATCH_SELECTED",$J)) D NOBATCH^RCDPEWL G REFQ  ;prca*4.5*298
"RTN","RCDPEWL6",142,0)
 S DIR(0)="YA"
"RTN","RCDPEWL6",143,0)
 S DIR("A",1)="THIS ACTION WILL DELETE AND REBUILD THIS EEOB WORKLIST SCRATCH PAD ENTRY",DIR("A",2)="ALL EDITS/SPLITS/DISTRIBUTE ADJUSTMENTS ENTERED FOR THIS ERA WILL BE ERASED"
"RTN","RCDPEWL6",144,0)
 S DIR("A",3)="AND ALL ENTRIES MARKED AS MANUALLY VERIFIED WILL BE UNMARKED",DIR("A",4)=" "
"RTN","RCDPEWL6",145,0)
 S DIR("A")="ARE YOU SURE YOU WANT TO DO THIS?: "
"RTN","RCDPEWL6",146,0)
 W ! D ^DIR K DIR
"RTN","RCDPEWL6",147,0)
 I Y'=1 G REFQ
"RTN","RCDPEWL6",148,0)
 ; prca*4.5*298  per patch requirements, keep code related to creating/maintaining
"RTN","RCDPEWL6",149,0)
 ; batches but just remove from execution
"RTN","RCDPEWL6",150,0)
 ;I $O(^RCY(344.49,RCSCR,3,0)) S RCQUIT=0 D  I RCQUIT G REFQ
"RTN","RCDPEWL6",151,0)
 ;. S DIR(0)="YA",DIR("A")="DO YOU WANT TO REDEFINE YOUR BATCHES TOO?: ",DIR("B")="NO" W ! D ^DIR K DIR
"RTN","RCDPEWL6",152,0)
 ;. I $D(DTOUT)!$D(DUOUT) S RCQUIT=1 Q
"RTN","RCDPEWL6",153,0)
 ;. S RCREDEF=+Y
"RTN","RCDPEWL6",154,0)
 ;. K ^TMP($J,"BATCHES")
"RTN","RCDPEWL6",155,0)
 ;. S Z=0 F  S Z=$O(^RCY(344.49,RCSCR,3,Z)) Q:'Z  S Z0=$G(^(Z,0)) D
"RTN","RCDPEWL6",156,0)
 ;.. I RCREDEF S DA=Z,DA(1)=RCSCR,DIK="^RCY(344.49,"_DA(1)_",3," D ^DIK Q
"RTN","RCDPEWL6",157,0)
 ;.. S ^TMP($J,"BATCHES",+$P(Z0,U,6),$P(Z0,U,7))=+Z0_U_$P(Z0,U,8)
"RTN","RCDPEWL6",158,0)
 ;. I 'RCREDEF S ^TMP($J,"BATCHES")=+$O(^TMP($J,"BATCHES",0))
"RTN","RCDPEWL6",159,0)
 ;. I RCREDEF D SETBATCH^RCDPEWLB(RCSCR)
"RTN","RCDPEWL6",160,0)
 D ADDLINES^RCDPEWLA(RCSCR)
"RTN","RCDPEWL6",161,0)
 D BLD^RCDPEWL1($G(^TMP($J,"RC_SORTPARM")))
"RTN","RCDPEWL6",162,0)
 K ^TMP($J,"BATCHES")
"RTN","RCDPEWL6",163,0)
REFQ S VALMBG=1,VALMBCK="R"
"RTN","RCDPEWL6",164,0)
 Q
"RTN","RCDPEWL6",165,0)
 ;
"RTN","RCDPEWL6",166,0)
WHAT(RCSCR) ; Text for what to do if not enough funds found for dist adj
"RTN","RCDPEWL6",167,0)
 Q $S($O(^RCY(344.31,"AERA",+RCSCR,0)):"THIS ERA MUST BE MOVED TO SUSPENSE",1:"THIS ERA'S RECEIPT MUST BE ENTERED MANUALLY")
"RTN","RCDPEWL6",168,0)
 ;
"RTN","RCDPEWL6",169,0)
ADJUST ; Allow entry into increase/decrease adjustment functions
"RTN","RCDPEWL6",170,0)
 N DIR,X,Y,RCTYP,RCY,DIC
"RTN","RCDPEWL6",171,0)
 D FULL^VALM1
"RTN","RCDPEWL6",172,0)
 ;
"RTN","RCDPEWL6",173,0)
 I $G(RCSCR("NOEDIT"))=2 D NOTAV^RCDPEWL2 G ADJUSTQ
"RTN","RCDPEWL6",174,0)
 ; PRCA*4.5*276 - check for authorized user
"RTN","RCDPEWL6",175,0)
 I '$D(^XUSEC("PRCADJ",DUZ)) D  Q
"RTN","RCDPEWL6",176,0)
 .S DIR(0)="EA",DIR("A",1)="The Adjust (Inc/Dec) Action is locked."
"RTN","RCDPEWL6",177,0)
 .S DIR("A",2)="Please speak to your Supervisor to request the key."
"RTN","RCDPEWL6",178,0)
 .S DIR("A")="PRESS RETURN TO CONTINUE" W ! D ^DIR K DIR
"RTN","RCDPEWL6",179,0)
 ; PRCA*4.5*276 - end of changes
"RTN","RCDPEWL6",180,0)
 ;
"RTN","RCDPEWL6",181,0)
 S DIR(0)="SA^D:DECREASE ADJUSTMENT;I:INCREASE ADJUSTMENT",DIR("B")="DECREASE ADJUSTMENT",DIR("A")="TYPE OF ADJUSTMENT: "
"RTN","RCDPEWL6",182,0)
 W ! D ^DIR K DIR
"RTN","RCDPEWL6",183,0)
 M ^TMP("RC_SAVE_TMP",$J)=^TMP($J)
"RTN","RCDPEWL6",184,0)
 I $D(DUOUT)!$D(DTOUT)!(Y="") G ADJUSTQ
"RTN","RCDPEWL6",185,0)
 ;
"RTN","RCDPEWL6",186,0)
 S RCTYP=$S(Y="D":"DECREASE",1:"INCREASE")
"RTN","RCDPEWL6",187,0)
 F  S RCY=$$GETABILL^RCBEUBIL Q:RCY<0!(RCY'<1)
"RTN","RCDPEWL6",188,0)
 G:RCY<1 ADJUSTQ
"RTN","RCDPEWL6",189,0)
 D ADJUST^RCBEADJ(RCTYP,RCY_";"_RCSCR)
"RTN","RCDPEWL6",190,0)
 I $D(^TMP("RC_BILL",$J,RCY)) D
"RTN","RCDPEWL6",191,0)
 . D UPDBAL(RCY)
"RTN","RCDPEWL6",192,0)
 . W !,"Claim balance is now: ",$J(+$P($$BILL^RCJIBFN2(RCY),U,3),"",2)
"RTN","RCDPEWL6",193,0)
 ;
"RTN","RCDPEWL6",194,0)
ADJUSTQ D RESTMP
"RTN","RCDPEWL6",195,0)
 D RET^RCDPEWL2
"RTN","RCDPEWL6",196,0)
 S VALMBCK="R"
"RTN","RCDPEWL6",197,0)
 Q
"RTN","RCDPEWL6",198,0)
 ;
"RTN","RCDPEWL6",199,0)
RESTMP ;
"RTN","RCDPEWL6",200,0)
 I $D(^TMP("RC_SAVE_TMP",$J)) M ^TMP($J)=^TMP("RC_SAVE_TMP",$J) K ^TMP("RC_SAVE_TMP")
"RTN","RCDPEWL6",201,0)
 Q
"RTN","RCDPEWL6",202,0)
 ;
"RTN","RCDPEWL6",203,0)
UPDBAL(RCY) ; Updates the claim balance if bill exists in list
"RTN","RCDPEWL6",204,0)
 ; RCY = ien of bill in file 430
"RTN","RCDPEWL6",205,0)
 ;
"RTN","RCDPEWL6",206,0)
 N X,Y,Z,Z0,Z1
"RTN","RCDPEWL6",207,0)
 S Z0=$J(+$P($$BILL^RCJIBFN2(RCY),U,3),"",2)
"RTN","RCDPEWL6",208,0)
 S Z=0 F  S Z=$O(^TMP("RC_BILL",$J,RCY,Z)) Q:'Z  D
"RTN","RCDPEWL6",209,0)
 . S X=+$G(^TMP("RCDPE-EOB_WLDX",$J,Z))
"RTN","RCDPEWL6",210,0)
 . Q:'X
"RTN","RCDPEWL6",211,0)
 . S Y=$G(^TMP("RCDPE-EOB_WL",$J,X+1,0))
"RTN","RCDPEWL6",212,0)
 . I Y["Claim Bal: " S Z1=$P(Y,"Claim Bal: ")_"Claim Bal: "_Z0_$G(^TMP("RC_BILL",$J,RCY,Z)),^TMP("RCDPE-EOB_WL",$J,X+1,0)=Z1
"RTN","RCDPEWL6",213,0)
 Q
"RTN","RCDPEWL6",214,0)
 ;
"RTN","RCDPEWL7")
0^15^B100612079^B98845066
"RTN","RCDPEWL7",1,0)
RCDPEWL7 ;ALB/TMK/KML - EDI LOCKBOX WORKLIST ERA DISPLAY SCREEN ;Jun 06, 2014@19:11:19
"RTN","RCDPEWL7",2,0)
 ;;4.5;Accounts Receivable;**208,222,269,276,298,304,318**;Mar 20, 1995;Build 37
"RTN","RCDPEWL7",3,0)
 ;Per VA Directive 6402, this routine should not be modified.
"RTN","RCDPEWL7",4,0)
 Q
"RTN","RCDPEWL7",5,0)
 ;
"RTN","RCDPEWL7",6,0)
BLD(RCSORT) ; Build list with sort criteria
"RTN","RCDPEWL7",7,0)
 ; RCSORT = the sort levels to use to display the data in ^ pieces
"RTN","RCDPEWL7",8,0)
 ;  piece 1 = the codes for the first level sort (sort code;null or -)
"RTN","RCDPEWL7",9,0)
 ;  piece 2 = the codes for the second level sort
"RTN","RCDPEWL7",10,0)
 ;     sort code is the type of data to sort by;- indicates reverse order
"RTN","RCDPEWL7",11,0)
 N Z,Z1,RCT,RCZ
"RTN","RCDPEWL7",12,0)
 S (RCT,VALMCNT)=0
"RTN","RCDPEWL7",13,0)
 I '$D(^TMP($J,"RCERA_LIST")) D
"RTN","RCDPEWL7",14,0)
 . S Z=0 F  S Z=$O(^TMP("RCDPE-ERA_WLDX",$J,Z)) Q:'Z  S RCZ=$P($G(^(Z)),U,2) D
"RTN","RCDPEWL7",15,0)
 .. I $$FILTER^RCDPEWL0(RCZ) S ^TMP($J,"RCERA_LIST",$$SL(RCZ,$P(RCSORT,U)),$$SL(RCZ,$P(RCSORT,U,2)),RCZ)=""
"RTN","RCDPEWL7",16,0)
 . K ^TMP("RCDPE-ERA_WLDX",$J),^TMP("RCDPE-ERA_WL",$J)
"RTN","RCDPEWL7",17,0)
 ;
"RTN","RCDPEWL7",18,0)
 S Z=""
"RTN","RCDPEWL7",19,0)
 I RCSORT'["PN;-" D
"RTN","RCDPEWL7",20,0)
 . F  S Z=$O(^TMP($J,"RCERA_LIST",Z)) Q:Z=""  S Z1="" F  S Z1=$O(^TMP($J,"RCERA_LIST",Z,Z1)) Q:Z1=""  D EXTRACT(Z,Z1,.RCT)
"RTN","RCDPEWL7",21,0)
 ;
"RTN","RCDPEWL7",22,0)
 I $P(RCSORT,U)["PN;-" D
"RTN","RCDPEWL7",23,0)
 . F  S Z=$O(^TMP($J,"RCERA_LIST",Z),-1) Q:Z=""  S Z1="" F  S Z1=$O(^TMP($J,"RCERA_LIST",Z,Z1)) Q:Z1=""  D EXTRACT(Z,Z1,.RCT)
"RTN","RCDPEWL7",24,0)
 ;
"RTN","RCDPEWL7",25,0)
 I $P(RCSORT,U,2)["PN;-" D
"RTN","RCDPEWL7",26,0)
 . F  S Z=$O(^TMP($J,"RCERA_LIST",Z)) Q:Z=""  S Z1="" F  S Z1=$O(^TMP($J,"RCERA_LIST",Z,Z1),-1) Q:Z1=""  D EXTRACT(Z,Z1,.RCT)
"RTN","RCDPEWL7",27,0)
 ;
"RTN","RCDPEWL7",28,0)
 I '$O(^TMP($J,"RCERA_LIST",0)) D SET("No ERAs left for your selection criteria")
"RTN","RCDPEWL7",29,0)
 K ^TMP($J,"RCERA_LIST")
"RTN","RCDPEWL7",30,0)
 S ^TMP("RCERA_PARAMS",$J,"SORT")=RCSORT
"RTN","RCDPEWL7",31,0)
 Q
"RTN","RCDPEWL7",32,0)
 ;
"RTN","RCDPEWL7",33,0)
EXTRACT(RCSRT1,RCSRT2,RCT) ; Extract the data
"RTN","RCDPEWL7",34,0)
 ; RCSRT1 = data value at 1st sort level
"RTN","RCDPEWL7",35,0)
 ; RCSRT2 = data value at 2nd sort level
"RTN","RCDPEWL7",36,0)
 ; RCT = running entry counter - returned if passed by ref
"RTN","RCDPEWL7",37,0)
 N AUTOCOMP,FIRST,RC0,RCEFT,RCEXCEP,RCPOST,RCSTAT,RCZ,X,XX,Z,Z0 ;PRCA*4.5*318 Variable XX added
"RTN","RCDPEWL7",38,0)
 S RCZ=0 F  S RCZ=$O(^TMP($J,"RCERA_LIST",RCSRT1,RCSRT2,RCZ)) Q:'RCZ  D
"RTN","RCDPEWL7",39,0)
 . S RCT=RCT+1,RC0=$G(^RCY(344.4,RCZ,0))
"RTN","RCDPEWL7",40,0)
 . S RCEFT=+$O(^RCY(344.31,"AERA",RCZ,0))
"RTN","RCDPEWL7",41,0)
 . S RCEXCEP=$$XCEPT^RCDPEWLP(RCZ)  ; prca*4.5*298  assignment of ERA exception flag
"RTN","RCDPEWL7",42,0)
 . S AUTOCOMP=$S($P($G(^RCY(344.4,RCZ,4)),U,2)=2:"A",1:"")   ;prca*4.5*298  AUTO-POSTED COMPLETE indicator ("A")
"RTN","RCDPEWL7",43,0)
 . S RCSTAT=$S('RCEFT:U_$S($P(RC0,U,15)="CHK":"(CHECK PAYMENT EXPECTED)",$P(RC0,U,15)="NON":"(NO PAYMENT EXPECTED)",$P(RC0,U,9)=2:"(CHECK PAYMENT CHOSEN)",1:"N/A"),1:$$FMSSTAT^RCDPUREC(+$P($G(^RCY(344.31,RCEFT,0)),U,9)))
"RTN","RCDPEWL7",44,0)
 . S RCPOST=$S(RCEFT:"EFT RECEIPT STATUS: ",1:"")_$P(RCSTAT,U,2)
"RTN","RCDPEWL7",45,0)
 . ;prca*4.5*298 include Auto-Post Complete indicator and ERA exception flag in $SELECT statement
"RTN","RCDPEWL7",46,0)
 . S X=$E(RCT_$J("",5),1,5)_"  "_$S(RCEXCEP]"":RCEXCEP,AUTOCOMP]"":AUTOCOMP,$D(^RCY(344.49,RCZ)):" ",1:"-")_$E($P(RC0,U)_$J("",10),1,10)_"  "_$E($P(RC0,U,2)_$J("",50),1,50)
"RTN","RCDPEWL7",47,0)
 . D SET(X,RCT,RCZ)
"RTN","RCDPEWL7",48,0)
 . S X=$J("",40)_$J($$FMTE^XLFDT($P(RC0,U,7),"2D"),8)_$J("",5)_$J(+$P(RC0,U,5),12,2)
"RTN","RCDPEWL7",49,0)
 . S $E(X,73,80)=$$FMTE^XLFDT($P(RC0,U,7),"2D")
"RTN","RCDPEWL7",50,0)
 . D SET(X,RCT,RCZ)
"RTN","RCDPEWL7",51,0)
 . S X=$J("",12)_$E($P(RC0,U,6)_$J("",30),1,30)_"  APPROX # EEOBs: "_+$$CTEEOB^RCDPEWLB(RCZ)
"RTN","RCDPEWL7",52,0)
 . D SET(X,RCT,RCZ)
"RTN","RCDPEWL7",53,0)
 . S XX=$$EXTERNAL^DILFD(344.4,.09,"",$P(RC0,U,9))
"RTN","RCDPEWL7",54,0)
 . S:$$UNBAL^RCDPEAP1(RCZ) XX=XX_" - UNBALANCED" ;PRCA*4.5*318 added line 
"RTN","RCDPEWL7",55,0)
 . S X=$J("",12)_$E(XX_$J("",30),1,30)_"  "_RCPOST ;PRCA*4.5*318 modified line 
"RTN","RCDPEWL7",56,0)
 . D SET(X,RCT)
"RTN","RCDPEWL7",57,0)
 . D SET(" ",RCT)
"RTN","RCDPEWL7",58,0)
 ;.; prca*4.5*298  per patch requirements, keep code related to
"RTN","RCDPEWL7",59,0)
 ;. ; creating/maintaining batches but just remove from execution.
"RTN","RCDPEWL7",60,0)
 ;. ;I $G(^TMP("RCERA_PARAMS",$J,"BATCHON")) D
"RTN","RCDPEWL7",61,0)
 ;.. ;S Z=0 F  S Z=$O(^RCY(344.49,RCZ,3,Z)) Q:'Z  S Z0=$G(^(Z,0)) I Z0'="" D
"RTN","RCDPEWL7",62,0)
 ;...; S X=$J("",12)_$E("- BATCH #"_$P(Z0,U)_$J("",4),1,13)_" "_$E($P(Z0,U,2)_$J("",30),1,30)_"  "_$S('$P(Z0,U,3):"NOT ",1:"")_"READY TO POST"
"RTN","RCDPEWL7",63,0)
 ;... ;D SET(X,RCT)
"RTN","RCDPEWL7",64,0)
 ;
"RTN","RCDPEWL7",65,0)
 S VALMSG="|'-' No scratchpad|'x' EXC |'A' autopost complete"
"RTN","RCDPEWL7",66,0)
 ;
"RTN","RCDPEWL7",67,0)
 Q
"RTN","RCDPEWL7",68,0)
 ;
"RTN","RCDPEWL7",69,0)
SL(Y,SORT) ; Returns data for sort level from entry Y in file 344.4
"RTN","RCDPEWL7",70,0)
 ; SORT = the sort data in ';' delimited pieces
"RTN","RCDPEWL7",71,0)
 ;    pc 1 = code for sort data
"RTN","RCDPEWL7",72,0)
 ;    pc 2 = the order requested (- or null)
"RTN","RCDPEWL7",73,0)
 ;
"RTN","RCDPEWL7",74,0)
 N RC0,DAT,SORT1,SORT2
"RTN","RCDPEWL7",75,0)
 S SORT1=$P(SORT,";"),SORT2=$P(SORT,";",2)
"RTN","RCDPEWL7",76,0)
 S RC0=$G(^RCY(344.4,Y,0)),DAT=" "
"RTN","RCDPEWL7",77,0)
 ; No sort
"RTN","RCDPEWL7",78,0)
 I SORT="" G SLQ
"RTN","RCDPEWL7",79,0)
 ; Amt paid
"RTN","RCDPEWL7",80,0)
 I SORT1="AP" D  G SLQ
"RTN","RCDPEWL7",81,0)
 . S DAT=SORT2_+$P(RC0,U,5)
"RTN","RCDPEWL7",82,0)
 ; ERA date pd
"RTN","RCDPEWL7",83,0)
 I SORT1="DP" D  G SLQ
"RTN","RCDPEWL7",84,0)
 . S DAT=SORT2_($P(RC0,U,4)\1)
"RTN","RCDPEWL7",85,0)
 ; Payer name
"RTN","RCDPEWL7",86,0)
 I SORT1="PN" D  G SLQ
"RTN","RCDPEWL7",87,0)
 . S DAT=$$UP^RCDPEARL($P(RC0,U,6))
"RTN","RCDPEWL7",88,0)
 ; ERA date received
"RTN","RCDPEWL7",89,0)
 I SORT1="DR" D  G SLQ
"RTN","RCDPEWL7",90,0)
 . S DAT=SORT2_($P(RC0,U,7)\1)
"RTN","RCDPEWL7",91,0)
 ;
"RTN","RCDPEWL7",92,0)
SLQ Q $S(DAT'="":DAT,1:" ")
"RTN","RCDPEWL7",93,0)
 ;
"RTN","RCDPEWL7",94,0)
INIT ; Entry point for List template to build the display of ERAs
"RTN","RCDPEWL7",95,0)
 ;
"RTN","RCDPEWL7",96,0)
 ; Parameters for selecting ERAs to be included in the list are
"RTN","RCDPEWL7",97,0)
 ; contained in the global ^TMP("RCERA_PARAMS",$J,parameter name)
"RTN","RCDPEWL7",98,0)
 ;
"RTN","RCDPEWL7",99,0)
 N RCZ,RC0,RCT,RCTT,RCQUIT,RCDTFR,RCDTTO,DTOUT,DUOUT,DIR,X,Y,Z,Z1,RCPOST,RCEFT,RCINDX,QFLG
"RTN","RCDPEWL7",100,0)
 D CLEAN^VALM10
"RTN","RCDPEWL7",101,0)
 K ^TMP("RCDPE-ERA_WL",$J),^TMP("RCDPE-ERA_WLDX",$J),^TMP($J,"RCERA_LIST")
"RTN","RCDPEWL7",102,0)
 ;
"RTN","RCDPEWL7",103,0)
 S (RCT,RCTT,RCQUIT)=0
"RTN","RCDPEWL7",104,0)
 ;
"RTN","RCDPEWL7",105,0)
 S RCDTFR=+$P($G(^TMP("RCERA_PARAMS",$J,"RCDT")),U),RCDTTO=$S($P($G(^TMP("RCERA_PARAMS",$J,"RCDT")),U,2):$P(^("RCDT"),U,2),1:DT)
"RTN","RCDPEWL7",106,0)
 ;
"RTN","RCDPEWL7",107,0)
 S RCINDX=$S(RCDTFR:RCDTFR-.00000001,1:0)
"RTN","RCDPEWL7",108,0)
 W !!,"SEARCHING, PLEASE STANDBY (PRESS '^' TO QUIT SEARCH)",!!
"RTN","RCDPEWL7",109,0)
 F  S RCINDX=$O(^RCY(344.4,"AFD",RCINDX)) Q:'RCINDX!(RCINDX\1>RCDTTO)!RCQUIT  S RCZ=0 F  S RCZ=$O(^RCY(344.4,"AFD",RCINDX,RCZ)) Q:'RCZ  D  Q:RCQUIT
"RTN","RCDPEWL7",110,0)
 . S RCTT=RCTT+1
"RTN","RCDPEWL7",111,0)
 . I (RCTT#10000=0) D  Q:RCQUIT=1
"RTN","RCDPEWL7",112,0)
 . . S RCTT=0
"RTN","RCDPEWL7",113,0)
 . . D WAIT^DICD
"RTN","RCDPEWL7",114,0)
 . . D INITKB^XGF ; supported by DBIA 3173
"RTN","RCDPEWL7",115,0)
 . . S QFLG=$$READ^XGF(1,1)
"RTN","RCDPEWL7",116,0)
 . . Q:$G(DTOUT)
"RTN","RCDPEWL7",117,0)
 . . S:QFLG="^" RCQUIT=1 Q
"RTN","RCDPEWL7",118,0)
 . . I $D(DUOUT)!(Y=0) S RCQUIT=1 Q
"RTN","RCDPEWL7",119,0)
 . . D RESETKB^XGF
"RTN","RCDPEWL7",120,0)
 . ;
"RTN","RCDPEWL7",121,0)
 . S RC0=$G(^RCY(344.4,RCZ,0))
"RTN","RCDPEWL7",122,0)
 . I $$FILTER^RCDPEWL0(RCZ) S ^TMP($J,"RCERA_LIST",$$SL(RCZ,"DR"),$$SL(RCZ,""),RCZ)=""
"RTN","RCDPEWL7",123,0)
 ;
"RTN","RCDPEWL7",124,0)
 ; Output the list
"RTN","RCDPEWL7",125,0)
 I 'RCQUIT D
"RTN","RCDPEWL7",126,0)
 . D:$D(^TMP($J,"RCERA_LIST")) BLD("DR^N")
"RTN","RCDPEWL7",127,0)
 . ; If no ERAs found display the message below in the list area
"RTN","RCDPEWL7",128,0)
 . I '$O(^TMP("RCDPE-ERA_WL",$J,0)) D
"RTN","RCDPEWL7",129,0)
 . . S ^TMP("RCDPE-ERA_WL",$J,1,0)="THERE ARE NO ERAs MATCHING YOUR SELECTION CRITERIA" S VALMCNT=2
"RTN","RCDPEWL7",130,0)
 I RCQUIT K ^TMP("RCDPE-ERA_WL",$J),^TMP("RCDPE-ERA_WLDX",$J),^TMP($J,"RCERA_LIST") S VALMQUIT=""
"RTN","RCDPEWL7",131,0)
 Q
"RTN","RCDPEWL7",132,0)
 ;
"RTN","RCDPEWL7",133,0)
HDR ; Header for ERA Worklist (List user Current Screen View selections)
"RTN","RCDPEWL7",134,0)
 N X
"RTN","RCDPEWL7",135,0)
 S X=$G(^TMP("RCERA_PARAMS",$J,"RCMATCH"))
"RTN","RCDPEWL7",136,0)
 S VALMHDR(1)="SELECTED MATCH STATUS: "_$S(X="N":"NOT MATCHED",X="M":"MATCHED",1:"BOTH")
"RTN","RCDPEWL7",137,0)
 S X=$G(^TMP("RCERA_PARAMS",$J,"RCPOST"))
"RTN","RCDPEWL7",138,0)
 S $E(VALMHDR(1),42)="POST STATUS     : "_$S(X="U":"UNPOSTED",X="P":"POSTED",1:"BOTH")
"RTN","RCDPEWL7",139,0)
 S X=$G(^TMP("RCERA_PARAMS",$J,"RCDT"))
"RTN","RCDPEWL7",140,0)
 S VALMHDR(2)=$J("",11)_"DATE RANGE: "_$S($P(X,U):$$FMTE^XLFDT($P(X,U),2)_$S($P(X,U,2):"-"_$$FMTE^XLFDT($P(X,U,2),2),1:""),1:"NONE SELECTED")
"RTN","RCDPEWL7",141,0)
 S X=$G(^TMP("RCERA_PARAMS",$J,"RCAUTOP"))
"RTN","RCDPEWL7",142,0)
 S $E(VALMHDR(2),42)="AUTO-POSTING    : "_$S(X="A":"AUTO-POSTING ONLY",X="N":"NON AUTO-POSTING ONLY",1:"BOTH")
"RTN","RCDPEWL7",143,0)
 S X=$G(^TMP("RCERA_PARAMS",$J,"RCPAYR"))
"RTN","RCDPEWL7",144,0)
 S VALMHDR(3)=$J("",10)_$S($P(X,U)="A"!(X=""):"ALL PAYERS",1:"PAYERS: "_$P(X,U,2)_"-"_$P(X,U,3))
"RTN","RCDPEWL7",145,0)
 S X=$G(^TMP("RCERA_PARAMS",$J,"RCTYPE"))
"RTN","RCDPEWL7",146,0)
 S $E(VALMHDR(3),42)="PHARMACY/MEDICAL: "_$S(X="M":"MEDICAL ONLY",X="P":"PHARMACY ONLY",1:"BOTH")
"RTN","RCDPEWL7",147,0)
 S X=$G(^TMP("RCERA_PARAMS",$J,"RCERA_TRACE#"))
"RTN","RCDPEWL7",148,0)
 S VALMHDR(4)="#       ERA #            Trace#"
"RTN","RCDPEWL7",149,0)
 Q
"RTN","RCDPEWL7",150,0)
 ;
"RTN","RCDPEWL7",151,0)
FNL ; -- Clean up list
"RTN","RCDPEWL7",152,0)
 K ^TMP("RCDPE-ERA_WL",$J),^TMP("RCDPE-ERA_WLDX",$J),^TMP("RCERA_PARAMS",$J),^TMP($J,"RCERA_LIST")
"RTN","RCDPEWL7",153,0)
 Q
"RTN","RCDPEWL7",154,0)
 ;
"RTN","RCDPEWL7",155,0)
SET(X,RCSEQ,RCSEQ1) ; -- set arrays
"RTN","RCDPEWL7",156,0)
 ; X = the data to set into the global
"RTN","RCDPEWL7",157,0)
 ; RCSEQ = the selectable line #
"RTN","RCDPEWL7",158,0)
 ; RCSEQ1 = the ien of the entry in file 344.4
"RTN","RCDPEWL7",159,0)
 S VALMCNT=VALMCNT+1,^TMP("RCDPE-ERA_WL",$J,VALMCNT,0)=X
"RTN","RCDPEWL7",160,0)
 I $G(RCSEQ) S ^TMP("RCDPE-ERA_WL",$J,"IDX",VALMCNT,RCSEQ)=$G(RCSEQ1)
"RTN","RCDPEWL7",161,0)
 I $G(RCSEQ1) S ^TMP("RCDPE-ERA_WLDX",$J,RCSEQ)=VALMCNT_U_RCSEQ1
"RTN","RCDPEWL7",162,0)
 Q
"RTN","RCDPEWL7",163,0)
 ;
"RTN","RCDPEWL7",164,0)
ENTERWL ; Enter the worklist with an ERA
"RTN","RCDPEWL7",165,0)
 D WL($$SEL())
"RTN","RCDPEWL7",166,0)
 D BLD($G(^TMP("RCERA_PARAMS",$J,"SORT")))
"RTN","RCDPEWL7",167,0)
 S VALMBCK="R"
"RTN","RCDPEWL7",168,0)
 Q
"RTN","RCDPEWL7",169,0)
 ;
"RTN","RCDPEWL7",170,0)
SEL() ; Select an ERA from the ERA list
"RTN","RCDPEWL7",171,0)
 N RCDA,VALMY
"RTN","RCDPEWL7",172,0)
 D FULL^VALM1
"RTN","RCDPEWL7",173,0)
 D EN^VALM2($G(XQORNOD(0)),"S")
"RTN","RCDPEWL7",174,0)
 S RCERA=0
"RTN","RCDPEWL7",175,0)
 S RCDA=0 F  S RCDA=$O(VALMY(RCDA)) Q:'RCDA  S RCERA=+$P($G(^TMP("RCDPE-ERA_WLDX",$J,RCDA)),U,2)
"RTN","RCDPEWL7",176,0)
 ;
"RTN","RCDPEWL7",177,0)
 Q RCERA
"RTN","RCDPEWL7",178,0)
 ;
"RTN","RCDPEWL7",179,0)
WL(RCERA) ; Enter worklist
"RTN","RCDPEWL7",180,0)
 ;
"RTN","RCDPEWL7",181,0)
 ;             input - RCERA = ien of the ERA entry in file 344.4
"RTN","RCDPEWL7",182,0)
 ;
"RTN","RCDPEWL7",183,0)
 N DA,DIE,DIR,DR,DTOUT,DUOUT,I,PREVENT,RC0,RCNOED,RCQUIT,RCSORT,RCEXC,RETCODES,STATE,TYPE,X,Y
"RTN","RCDPEWL7",184,0)
 Q:RCERA'>0
"RTN","RCDPEWL7",185,0)
 ; PRCA*4.5*304 - Reentry if we cleared exceptions
"RTN","RCDPEWL7",186,0)
WL1 ; retest to make sure this ERA does not have an exception
"RTN","RCDPEWL7",187,0)
 S TYPE=$S($$PHARM^RCDPEWLP(RCERA):"P",1:"M"),RCEXC=0
"RTN","RCDPEWL7",188,0)
 ; PRCA*4.5*304 - see if we have the ERA and go to WL1 to retest.
"RTN","RCDPEWL7",189,0)
 I ($$XCEPT^RCDPEWLP(RCERA)]"")&(TYPE="M") D EXCDENY^RCDPEWLP Q  ;cannot process MEDICAL ERA if exception exists then fall back to Worklist.
"RTN","RCDPEWL7",190,0)
 ; PRCA*4.5*304 - Removed the G:($G(RCERA)'="")&&($G(RCEXC)=1) WL1 from above so it falls back to the worklist instead of going forward to the "Select ERA"
"RTN","RCDPEWL7",191,0)
 ; I ($$XCEPT^RCDPEWLP(RCERA)]"")&(TYPE="M") D EXCDENY^RCDPEWLP G:($G(RCERA)'="")&&($G(RCEXC)=1) WL1 Q
"RTN","RCDPEWL7",192,0)
 S (RCQUIT,RCNOED,PREVENT)=0,RC0=$G(^RCY(344.4,RCERA,0)),RCSORT=""
"RTN","RCDPEWL7",193,0)
 I $P(RC0,U,8) D
"RTN","RCDPEWL7",194,0)
 . I '$D(^RCY(344.49,RCERA,0)) D  Q
"RTN","RCDPEWL7",195,0)
 .. S RCQUIT=1
"RTN","RCDPEWL7",196,0)
 .. W ! S DIR(0)="EA",DIR("A",1)="A SCRATCH PAD WAS NOT CREATED FOR THIS ERA BEFORE POSTING",DIR("A",2)="USE THE VIEW/PRINT ERA OPTION TO SEE ITS DETAIL",DIR("A")="Press ENTER to continue: " D ^DIR K DIR Q
"RTN","RCDPEWL7",197,0)
 . ;
"RTN","RCDPEWL7",198,0)
 . S RCNOED=+$P(RC0,U,8)
"RTN","RCDPEWL7",199,0)
 . S DIR(0)="EA",DIR("A",1)="THIS ERA ALREADY HAS A RECEIPT - YOU MAY ONLY VIEW ITS SCRATCH PAD",DIR("A")="Press ENTER to continue: "
"RTN","RCDPEWL7",200,0)
 . W ! D ^DIR K DIR W !
"RTN","RCDPEWL7",201,0)
 G:RCQUIT WLQ
"RTN","RCDPEWL7",202,0)
 G:RCNOED WLD   ; already has a receipt so no need to check for older unposted EFTs
"RTN","RCDPEWL7",203,0)
 ; function $$AGEDEFTS - search for any UNPOSTED EFTs older than 14 days (medical) or 30 days (pharmacy)
"RTN","RCDPEWL7",204,0)
 ; return value of 0, 2, or 3 represent that entry into scratchpad can occur
"RTN","RCDPEWL7",205,0)
 S RETCODES=$$AGEDEFTS^RCDPEWLP(RCERA,TYPE)
"RTN","RCDPEWL7",206,0)
 F I=1:1 S STATE=$P(RETCODES,U,I) Q:STATE=""  S PREVENT=$S($E(STATE,1)=1:1,1:0)
"RTN","RCDPEWL7",207,0)
 Q:PREVENT   ; prevent user from entering scratchpad; there are older EFTs on the system that need to be worked.
"RTN","RCDPEWL7",208,0)
WLD ;
"RTN","RCDPEWL7",209,0)
 D DISP^RCDPEWL(RCERA,RCNOED)
"RTN","RCDPEWL7",210,0)
 ;
"RTN","RCDPEWL7",211,0)
 ; prca*4.5*298  per patch requirements, keep code related to 
"RTN","RCDPEWL7",212,0)
 ; creating/maintaining batches but just remove from execution.
"RTN","RCDPEWL7",213,0)
 ;I 'RCQUIT,$G(^TMP("RCBATCH_SELECTED",$J)) D
"RTN","RCDPEWL7",214,0)
 ;. S DA(1)=RCERA,DA=+$G(^TMP("RCBATCH_SELECTED",$J)),DR=".05////0",DIE="^RCY(344.49,"_DA(1)_",3," D ^DIE
"RTN","RCDPEWL7",215,0)
 ;. L -^RCY(344.49,DA(1),3,DA,0)
"RTN","RCDPEWL7",216,0)
 ;. K ^TMP("RCBATCH_SELECTED",$J)
"RTN","RCDPEWL7",217,0)
 ;E  D
"RTN","RCDPEWL7",218,0)
 ;L -^RCY(344.4,RCERA,0)
"RTN","RCDPEWL7",219,0)
WLQ ;
"RTN","RCDPEWL7",220,0)
 L -^RCY(344.4,RCERA,0)
"RTN","RCDPEWL7",221,0)
 Q
"RTN","RCDPEWL7",222,0)
 ;
"RTN","RCDPEWL7",223,0)
PRERA ; View/Print ERA from ERA list menu
"RTN","RCDPEWL7",224,0)
 N RCSCR
"RTN","RCDPEWL7",225,0)
 S RCSCR=$$SEL()
"RTN","RCDPEWL7",226,0)
 I RCSCR>0 D PRERA^RCDPEWL0
"RTN","RCDPEWL7",227,0)
 S VALMBCK="R"
"RTN","RCDPEWL7",228,0)
 Q
"RTN","RCDPEWL7",229,0)
 ;
"RTN","RCDPEWL7",230,0)
BAT(RCERA) ; Select batch, if needed
"RTN","RCDPEWL7",231,0)
 ; Returns 1 if batch selected OK or no batch needed
"RTN","RCDPEWL7",232,0)
 ; RCERA = ien of entry in file 344.49
"RTN","RCDPEWL7",233,0)
 N RCINUSE,RCQUIT,RCADJ,RC0,RCOK,DIR,DTOUT,DUOUT,X,Y,Z
"RTN","RCDPEWL7",234,0)
 K ^TMP("RCBATCH_SELECTED",$J)
"RTN","RCDPEWL7",235,0)
 S RCOK=1
"RTN","RCDPEWL7",236,0)
 I '$O(^RCY(344.49,RCERA,3,0)) G BATQ
"RTN","RCDPEWL7",237,0)
 S RC0=$G(^RCY(344.4,RCERA,0))
"RTN","RCDPEWL7",238,0)
 S (RCQUIT,RCADJ)=0
"RTN","RCDPEWL7",239,0)
 I $$HASADJ^RCDPEWL8(RCERA) D
"RTN","RCDPEWL7",240,0)
 . S RCADJ=1
"RTN","RCDPEWL7",241,0)
 . S DIR("A",1)="THIS ERA HAS NEGATIVE ADJUSTMENTS THAT NEED TO BE DISTRIBUTED TO OTHER",DIR("A",2)="PAYMENTS ON THE ERA.  YOU CANNOT SELECT ANY INDIVIDUAL BATCHES UNTIL",DIR("A",3)="THE DISTRIBUTIONS ARE COMPLETE."
"RTN","RCDPEWL7",242,0)
 . S DIR("A")="Press ENTER to continue: ",DIR(0)="EA" W ! D ^DIR K DIR
"RTN","RCDPEWL7",243,0)
 S RCINUSE=+$O(^RCY(344.49,"AINUSE",1,RCERA,0))
"RTN","RCDPEWL7",244,0)
 I RCINUSE D
"RTN","RCDPEWL7",245,0)
 . N OK,Z
"RTN","RCDPEWL7",246,0)
 . Q:RCADJ!$P(RC0,U,8)
"RTN","RCDPEWL7",247,0)
 . S OK=0 S Z=0 F  S Z=$O(^RCY(344.49,RCERA,3,Z)) Q:'Z  I '$P($G(^RCY(344.49,RCERA,3,Z,0)),U,5) S OK=1 Q
"RTN","RCDPEWL7",248,0)
 . I 'OK D  Q
"RTN","RCDPEWL7",249,0)
 .. S DIR("A",1)="ALL BATCHES WITHIN THIS ERA ARE CURRENTLY IN USE - TRY AGAIN LATER",DIR("A")="Press ENTER to continue: ",DIR(0)="EA" W ! D ^DIR K DIR S RCQUIT=1,RCOK=0 Q
"RTN","RCDPEWL7",250,0)
 . W !!,"AT LEAST 1 BATCH WITHIN THIS ERA IS CURRENTLY IN USE",!,"AT THIS TIME, YOU CAN ONLY ACCESS INDIVIDUAL BATCHES",!
"RTN","RCDPEWL7",251,0)
 . D SELBAT^RCDPEWL8(RCERA,.RCQUIT)
"RTN","RCDPEWL7",252,0)
 . I RCQUIT S RCOK=0
"RTN","RCDPEWL7",253,0)
 E  D
"RTN","RCDPEWL7",254,0)
 . Q:$P(RC0,U,8)!RCADJ  ; Always require the entire ERA be used
"RTN","RCDPEWL7",255,0)
 . S DIR(0)="SA^E:(E)NTIRE ERA;B:(B)ATCH",DIR("A")="DO YOU WANT THE (E)NTIRE ERA OR JUST A (B)ATCH?: " W ! D ^DIR K DIR
"RTN","RCDPEWL7",256,0)
 . I $D(DTOUT)!$D(DUOUT) S RCQUIT=1,RCOK=0 Q
"RTN","RCDPEWL7",257,0)
 . I Y="E" D  Q
"RTN","RCDPEWL7",258,0)
 .. S RCQUIT=1 F Z=1:1:2 L +^RCY(344.4,RCERA,0):5 I $T S RCQUIT=0 Q
"RTN","RCDPEWL7",259,0)
 .. I RCQUIT S RCOK=0,DIR(0)="EA",DIR("A",1)="ANOTHER USER IS CURRENTLY USING THIS ERA, TRY AGAIN LATER",DIR("A")="Press ENTER to continue: " W ! D ^DIR K DIR Q
"RTN","RCDPEWL7",260,0)
 . D SELBAT^RCDPEWL8(RCERA,.RCQUIT)
"RTN","RCDPEWL7",261,0)
 . I RCQUIT S RCOK=0
"RTN","RCDPEWL7",262,0)
 ;
"RTN","RCDPEWL7",263,0)
BATQ Q RCOK
"RTN","RCDPEWL7",264,0)
 ;
"RTN","RCDPEWL7",265,0)
HELP ; -- help code
"RTN","RCDPEWL7",266,0)
 S X="?" D DISP^XQORM1 W !!
"RTN","RCDPEWL7",267,0)
 Q
"RTN","RCDPEWL7",268,0)
 ;
"RTN","RCDPEWL8")
0^19^B101993484^B93821264
"RTN","RCDPEWL8",1,0)
RCDPEWL8 ;ALB/TMK/PJH - EDI LOCKBOX WORKLIST ERA LEVEL ;Jun 06, 2014@19:11:19
"RTN","RCDPEWL8",2,0)
 ;;4.5;Accounts Receivable;**208,269,276,298,304,318**;Mar 20, 1995;Build 37
"RTN","RCDPEWL8",3,0)
 ;;Per VA Directive 6402, this routine should not be modified.
"RTN","RCDPEWL8",4,0)
 Q
"RTN","RCDPEWL8",5,0)
 ;
"RTN","RCDPEWL8",6,0)
FILESP ; Action that files the split lines
"RTN","RCDPEWL8",7,0)
 ; Assumes RCDIR,RCLINE,RCSCR,RCSPLIT array defined
"RTN","RCDPEWL8",8,0)
 N RCTOT,Z,RCZ0,RCZ1,DTOUT,DUOUT,DIR,X,Y,DIE,DA,DR,DIC,DD,DO,DLAYGO,RCZ,RCZZ,RCZT,VALBCK
"RTN","RCDPEWL8",9,0)
 D FULL^VALM1
"RTN","RCDPEWL8",10,0)
 I '$G(^TMP("RCDPE_EOB_SPLIT_OK",$J)) D  Q
"RTN","RCDPEWL8",11,0)
 . S VALMBCK="R"
"RTN","RCDPEWL8",12,0)
 . F Z=2,3 S RCTOT(Z)=$$TOT^RCDPEWL3(Z,.RCSPLIT)
"RTN","RCDPEWL8",13,0)
 . S DIR(0)="EA"
"RTN","RCDPEWL8",14,0)
 . S DIR("A",1)="TOTAL "_$S(+RCTOT(2)'=+$P(RCDIR,U,2):"PAYMENTS",1:"ADJUSTMENTS")_$S(+RCTOT(3)=+$P(RCDIR,U,3):"",+RCTOT(2)'=+$P(RCDIR,U,2):" AND ADJUSTMENTS",1:"")_" DO NOT MATCH THE ORIGINAL AMOUNT(s):"
"RTN","RCDPEWL8",15,0)
 . S DIR("A",2)=$E("  ORIG PAY AMT: "_$J(+$P(RCDIR,U,2),"",2)_$J("",35),1,35)_" ORIG ADJ AMT: "_$J(+$P(RCDIR,U,3),"",2)
"RTN","RCDPEWL8",16,0)
 . S DIR("A",3)=$E("   AMT ENTERED: "_$J(+RCTOT(2),"",2)_$J("",35),1,35)_"  AMT ENTERED: "_$J(+RCTOT(3),"",2)
"RTN","RCDPEWL8",17,0)
 . S DIR("A")="PRESS RETURN TO CONTINUE " W ! D ^DIR K DIR
"RTN","RCDPEWL8",18,0)
 S DA(1)=RCSCR
"RTN","RCDPEWL8",19,0)
 S RCZ0=+$P(RCLINE,U,2),RCZZ=+$G(^RCY(344.49,DA(1),1,RCZ0,0)),RCZZ(1)=""
"RTN","RCDPEWL8",20,0)
 S RCZ=+$O(RCSPLIT(0))
"RTN","RCDPEWL8",21,0)
 ;
"RTN","RCDPEWL8",22,0)
 ;Option to move/copy EOB
"RTN","RCDPEWL8",23,0)
 I RCZ D  Q:$G(VALMBCK)="Q"
"RTN","RCDPEWL8",24,0)
 .;;Move/Copy removed 10/19/11-now in receipt creation +136^RCDPEM
"RTN","RCDPEWL8",25,0)
 .;;Q:$$UPDWL^RCDPEM5($P(RCDIR,U),.RCSPLIT,RCERA)
"RTN","RCDPEWL8",26,0)
 .;;User abort
"RTN","RCDPEWL8",27,0)
 .;;K ^TMP($J,"RCDPE_SPLIT_FILE") S VALMBCK="Q"
"RTN","RCDPEWL8",28,0)
 ;
"RTN","RCDPEWL8",29,0)
 I RCZ D
"RTN","RCDPEWL8",30,0)
 . S DIE="^RCY(344.49,"_DA(1)_",1,",DA=RCZ0,RCZT=$P(RCSPLIT(RCZ),U,2)+$P(RCSPLIT(RCZ),U,3)
"RTN","RCDPEWL8",31,0)
 . S DR=".02////"_$P(RCSPLIT(RCZ),U)_";.05////"_$J(+$P(RCSPLIT(RCZ),U,2),"",2)_";.06////"_$J(+RCZT,"",2)_";.08////"_$J($P(RCSPLIT(RCZ),U,3),"",2)
"RTN","RCDPEWL8",32,0)
 . S DR=DR_";.07///"_$S($P(RCSPLIT(RCZ),U,5):"/"_$P(RCSPLIT(RCZ),U,5),1:"@")_";.03////"_$S(RCZT'<0:$J(+RCZT,"",2),1:"0.00")_$S($P(RCSPLIT(RCZ),U,6)'="":";.1///"_$S($P(RCSPLIT(RCZ),U,6)'="@":"/^S X=$P(RCSPLIT(RCZ),U,6)",1:"@"),1:"")
"RTN","RCDPEWL8",33,0)
 . D ^DIE,UPD^RCDPEWL3(DA(1),DA)
"RTN","RCDPEWL8",34,0)
 . I $P(RCDIR,U,3) D
"RTN","RCDPEWL8",35,0)
 .. N DA
"RTN","RCDPEWL8",36,0)
 .. S DA(2)=RCSCR,DA(1)=RCZ0,DA=1,DIE="^RCY(344.49,"_DA(2)_",1,"_DA(1)_",1,"
"RTN","RCDPEWL8",37,0)
 .. S RCZZ(1)=$G(^RCY(344.49,DA(2),1,DA(1),1,1,0))
"RTN","RCDPEWL8",38,0)
 .. S DR=".03////"_$J(+$P(RCSPLIT(RCZ),U,3),"",2)_$S($P(RCSPLIT(RCZ),U,4)'="":".09////"_$P(RCSPLIT(RCZ),U,4),1:"")
"RTN","RCDPEWL8",39,0)
 .. D ^DIE
"RTN","RCDPEWL8",40,0)
 F  S RCZ=$O(RCSPLIT(RCZ)) Q:'RCZ  D
"RTN","RCDPEWL8",41,0)
 . S DIC(0)="L",DLAYGO=344.491,DIC="^RCY(344.49,"_DA(1)_",1,",X=+$O(^RCY(344.49,RCSCR,1,"B",RCZZ\1+.999),-1)+.001
"RTN","RCDPEWL8",42,0)
 . S DIC("DR")=".02////"_$P(RCSPLIT(RCZ),U)_";.05////"_$J(+$P(RCSPLIT(RCZ),U,2),"",2)_";.08////"_$J(+$P(RCSPLIT(RCZ),U,3),"",2)_";.06////"_$J($P(RCSPLIT(RCZ),U,2)+$P(RCSPLIT(RCZ),U,3),"",2)
"RTN","RCDPEWL8",43,0)
 . I $P(RCSPLIT(RCZ),U,6)'="" S DIC("DR")=DIC("DR")_";.1///"_$S($P(RCSPLIT(RCZ),U,6)'="@":"/^S X=$P(RCSPLIT(RCZ),U,6)",1:"@")
"RTN","RCDPEWL8",44,0)
 . I $P(RCSPLIT(RCZ),U,5) S DIC("DR")=DIC("DR")_";.07////"_$P(RCSPLIT(RCZ),U,5)
"RTN","RCDPEWL8",45,0)
 . K DD,DO D FILE^DICN K DIC,DLAYGO,DD,DO
"RTN","RCDPEWL8",46,0)
 . S RCZ1=+Y
"RTN","RCDPEWL8",47,0)
 . I Y D UPD^RCDPEWL3(RCSCR,RCZ1)
"RTN","RCDPEWL8",48,0)
 . I Y,$P(RCDIR,U,3) D
"RTN","RCDPEWL8",49,0)
 .. N DA
"RTN","RCDPEWL8",50,0)
 .. S DA(2)=RCSCR,DA(1)=RCZ1,X=1,DIC(0)="L",DIC="^RCY(344.49,"_DA(2)_",1,"_DA(1)_",1,"
"RTN","RCDPEWL8",51,0)
 .. S DIC("DR")=".02////"_$P(RCZZ(1),U,2)_";.03////"_$J(+$P(RCSPLIT(RCZ),U,3),"",2)_$S($P(RCSPLIT(RCZ),U,4)'="":";.09////"_$P(RCSPLIT(RCZ),U,4),$P(RCZZ(1),U,9)'="":";.09////"_$P(RCZZ(1),U,9),1:"")
"RTN","RCDPEWL8",52,0)
 .. F Z=4:1:8 I $P(RCZZ(1),U,Z)'="" S DIC("DR")=DIC("DR")_";"_(Z/100)_"////"_$P(RCZZ(1),U,Z)
"RTN","RCDPEWL8",53,0)
 .. D FILE^DICN K DIC,DLAYGO,DD,DO
"RTN","RCDPEWL8",54,0)
 K ^TMP($J,"RCDPE_SPLIT_FILE")
"RTN","RCDPEWL8",55,0)
 S VALMBCK="Q"
"RTN","RCDPEWL8",56,0)
 Q
"RTN","RCDPEWL8",57,0)
 ;
"RTN","RCDPEWL8",58,0)
SELBAT(RCERA,RCQUIT) ; Select a batch
"RTN","RCDPEWL8",59,0)
 ; If batch is selected, global ^TMP("RCBATCH_SELECTED",$J) is set = 
"RTN","RCDPEWL8",60,0)
 ;   batch ien selected
"RTN","RCDPEWL8",61,0)
 ; RCQUIT = 1 if selection not made
"RTN","RCDPEWL8",62,0)
 ; prca*4.5*298 per requirements, keep code for creating/maintaining batches but remove from execution
"RTN","RCDPEWL8",63,0)
 Q  ;prca*4.5*298
"RTN","RCDPEWL8",64,0)
 N DA,DIC,DIE,DIR,DR,DTOUT,DUOUT,RCBAT,X,Y
"RTN","RCDPEWL8",65,0)
 S RCQUIT=0
"RTN","RCDPEWL8",66,0)
 S DA(1)=RCERA,DIC(0)="AEMQ",DIC="^RCY(344.49,"_DA(1)_",3,",DIC("S")="I '$P(^(0),U,5)" D ^DIC
"RTN","RCDPEWL8",67,0)
 I Y'>0 S RCQUIT=1 Q
"RTN","RCDPEWL8",68,0)
 S RCBAT=+Y
"RTN","RCDPEWL8",69,0)
 L +^RCY(344.4,RCERA,0):5 I '$T S DIR("A",1)="ANOTHER USER HAS JUST ACCESSED THE ENTIRE ERA - TRY AGAIN LATER",DIR("A")="PRESS RETURN TO CONTINUE ",DIR(0)="EA" W ! D ^DIR K DIR S RCQUIT=1 Q
"RTN","RCDPEWL8",70,0)
 L +^RCY(344.49,RCERA,3,RCBAT,0):5 I '$T!$P($G(^(0)),U,5) S DIR("A",1)="ANOTHER USER HAS JUST OPENED THIS BATCH - TRY AGAIN LATER",DIR("A")="PRESS RETURN TO CONTINUE ",DIR(0)=-"EA" W ! D ^DIR K DIR S RCQUIT=1 Q
"RTN","RCDPEWL8",71,0)
 S DA=RCBAT,DA(1)=RCERA,DIE="^RCY(344.49,"_DA(1)_",3,",DR=".05////1" D ^DIE L -^RCY(344.49,RCERA,3,RCBAT,0)
"RTN","RCDPEWL8",72,0)
 I $P($G(^RCY(344.49,RCERA,3,RCBAT,0)),U,3) D
"RTN","RCDPEWL8",73,0)
 . S DIR(0)="EA",DIR("A",1)="** WARNING - THIS BATCH HAS BEEN FLAGGED AS READY TO POST",DIR("A")="PRESS RETURN TO CONTINUE " W ! D ^DIR K DIR
"RTN","RCDPEWL8",74,0)
 S ^TMP("RCBATCH_SELECTED",$J)=RCBAT
"RTN","RCDPEWL8",75,0)
 L -^RCY(344.4,RCERA,0)
"RTN","RCDPEWL8",76,0)
 Q
"RTN","RCDPEWL8",77,0)
 ;
"RTN","RCDPEWL8",78,0)
SORT ; Select a new sort for the list of ERAs
"RTN","RCDPEWL8",79,0)
 D FULL^VALM1
"RTN","RCDPEWL8",80,0)
 N RCSORT,DUOUT,DTOUT,DIR,X,Y,RCS1,RCS2,RCORD
"RTN","RCDPEWL8",81,0)
 S VALMBCK="R"
"RTN","RCDPEWL8",82,0)
 S DIR("L",1)="  SELECT A FIRST LEVEL SORT",DIR("L",2)=" "
"RTN","RCDPEWL8",83,0)
 S DIR("L",3)="    A  AMOUNT PAID      E  ERA PAID DATE"
"RTN","RCDPEWL8",84,0)
 S DIR("L")="    P  PAYER NAME       D  DATE ERA RECEIVED"
"RTN","RCDPEWL8",85,0)
 S DIR(0)="S^A:AMOUNT PAID;E:ERA PAID DATE;P:PAYER NAME;D:DATE ERA RECEIVED",DIR("B")=$P($P(DIR(0),"D:",2),";")
"RTN","RCDPEWL8",86,0)
 W ! D ^DIR K DIR
"RTN","RCDPEWL8",87,0)
 I $D(DTOUT)!$D(DUOUT) Q
"RTN","RCDPEWL8",88,0)
 S RCS1=$S(Y="A":"AP",Y="E":"DP",Y="P":"PN",1:"DR")
"RTN","RCDPEWL8",89,0)
 S RCORD=$$ORD(.RCS1)
"RTN","RCDPEWL8",90,0)
 Q:'$D(RCS1)
"RTN","RCDPEWL8",91,0)
 S $P(RCSORT,U)=(RCS1_";"_RCORD)
"RTN","RCDPEWL8",92,0)
 K X
"RTN","RCDPEWL8",93,0)
 S X(1)=$S(RCS1'="AP":"A:AMOUNT PAID",1:"E:ERA PAID DATE")
"RTN","RCDPEWL8",94,0)
 S X(2)=$S(RCS1'="AP"&(RCS1'="DP"):"E:ERA PAID DATE",1:"P:PAYER NAME")
"RTN","RCDPEWL8",95,0)
 S X(3)=$S(RCS1="DR":"P:PAYER NAME",1:"D:DATE ERA RECEIVED")
"RTN","RCDPEWL8",96,0)
 S DIR(0)="S^N:NONE;"_X(1)_";"_X(2)_";"_X(3)
"RTN","RCDPEWL8",97,0)
 S DIR("B")="NONE"
"RTN","RCDPEWL8",98,0)
 S DIR("L",1)="  SELECT A SECOND LEVEL SORT",DIR("L",2)=" "
"RTN","RCDPEWL8",99,0)
 S DIR("L",3)="    N  NONE"_$J("",13)_$P(X(1),":")_"  "_$P(X(1),":",2)
"RTN","RCDPEWL8",100,0)
 S DIR("L")="    "_$E($P(X(2),":")_"  "_$P(X(2),":",2)_$J("",20),1,20)_$P(X(3),":")_"  "_$P(X(3),":",2)
"RTN","RCDPEWL8",101,0)
 K X W ! D ^DIR K DIR
"RTN","RCDPEWL8",102,0)
 I $D(DTOUT)!$D(DUOUT) Q
"RTN","RCDPEWL8",103,0)
 S RCS2=$S(Y="N":"N",Y="A":"AP",Y="E":"DP",Y="P":"PN",1:"DR")
"RTN","RCDPEWL8",104,0)
 S RCORD=$$ORD(.RCS2)
"RTN","RCDPEWL8",105,0)
 Q:'$D(RCS2)
"RTN","RCDPEWL8",106,0)
 S $P(RCSORT,U,2)=(RCS2_";"_RCORD)
"RTN","RCDPEWL8",107,0)
 K ^TMP($J,"RCERA_LIST") D BLD^RCDPEWL7(RCSORT)
"RTN","RCDPEWL8",108,0)
 Q
"RTN","RCDPEWL8",109,0)
 ;
"RTN","RCDPEWL8",110,0)
ORD(RCS) ; Select an order for the sorted field code in RCS
"RTN","RCDPEWL8",111,0)
 ; Kill RCS if nothing selected, passed by reference
"RTN","RCDPEWL8",112,0)
 ; Returns '-' if reverse order selected
"RTN","RCDPEWL8",113,0)
 N DIR,X,Y,ORD,RCQUIT
"RTN","RCDPEWL8",114,0)
 S RCQUIT=0,ORD=""
"RTN","RCDPEWL8",115,0)
 I RCS="N" G ORDQ
"RTN","RCDPEWL8",116,0)
 I RCS="PN" D  G ORDQ
"RTN","RCDPEWL8",117,0)
 . S DIR(0)="SA^F:FIRST TO LAST;L:LAST TO FIRST"
"RTN","RCDPEWL8",118,0)
 . S DIR("B")=$P($P(DIR(0),"F:",2),";")
"RTN","RCDPEWL8",119,0)
 . S DIR("A")="  SORT (F)IRST TO LAST OR (L)AST TO FIRST?: "
"RTN","RCDPEWL8",120,0)
 . D ^DIR K DIR
"RTN","RCDPEWL8",121,0)
 . I $D(DUOUT)!$D(DTOUT) S RCQUIT=1 Q
"RTN","RCDPEWL8",122,0)
 . S ORD=$S(Y="F":"",1:"-")
"RTN","RCDPEWL8",123,0)
 ;
"RTN","RCDPEWL8",124,0)
 I RCS="AP" D  G ORDQ
"RTN","RCDPEWL8",125,0)
 . S DIR("A")="  SORT (L)OWEST TO HIGHEST OR (H)IGHEST TO LOWEST?: "
"RTN","RCDPEWL8",126,0)
 . S DIR(0)="SA^L:LOWEST TO HIGHEST;H:HIGHEST TO LOWEST"
"RTN","RCDPEWL8",127,0)
 . S DIR("B")=$P($P(DIR(0),"L:",2),";")
"RTN","RCDPEWL8",128,0)
 . D ^DIR K DIR
"RTN","RCDPEWL8",129,0)
 . I $D(DUOUT)!$D(DTOUT) S RCQUIT=1 Q
"RTN","RCDPEWL8",130,0)
 . S ORD=$S(Y="L":"",1:"-")
"RTN","RCDPEWL8",131,0)
 ;
"RTN","RCDPEWL8",132,0)
 I RCS="DP"!(RCS="DR") D  G ORDQ
"RTN","RCDPEWL8",133,0)
 . S DIR("A")="  SORT (E)ARLIEST TO LATEST OR (L)ATEST TO EARLIEST?: "
"RTN","RCDPEWL8",134,0)
 . S DIR(0)="SA^E:EARLIEST TO LATEST;L:LATEST TO EARLIEST"
"RTN","RCDPEWL8",135,0)
 . S DIR("B")=$P($P(DIR(0),"E:",2),";")
"RTN","RCDPEWL8",136,0)
 . D ^DIR K DIR
"RTN","RCDPEWL8",137,0)
 . I $D(DUOUT)!$D(DTOUT) S RCQUIT=1 Q
"RTN","RCDPEWL8",138,0)
 . S ORD=$S(Y="E":"",1:"-")
"RTN","RCDPEWL8",139,0)
 ;
"RTN","RCDPEWL8",140,0)
 ; Invalid sort code
"RTN","RCDPEWL8",141,0)
 S RCQUIT=1
"RTN","RCDPEWL8",142,0)
 ;
"RTN","RCDPEWL8",143,0)
ORDQ I RCQUIT K RCS
"RTN","RCDPEWL8",144,0)
 Q ORD
"RTN","RCDPEWL8",145,0)
 ;
"RTN","RCDPEWL8",146,0)
BATDSP ; Ask Display/Hide batch info on ERA list screen
"RTN","RCDPEWL8",147,0)
 ; prca*4.5*298 per requirements, keep code for creating/maintaining batches but remove from execution
"RTN","RCDPEWL8",148,0)
 Q  ;prca*4.5*298
"RTN","RCDPEWL8",149,0)
 N DIR,DTOUT,DUOUT,RCZ,X,Y
"RTN","RCDPEWL8",150,0)
 D FULL^VALM1
"RTN","RCDPEWL8",151,0)
 S RCZ=+$G(^TMP("RCERA_PARAMS",$J,"BATCHON"))
"RTN","RCDPEWL8",152,0)
 S DIR("A",1)="BATCH INFO DISPLAY IS CURRENTLY TURNED "_$S('RCZ:"OFF",1:"ON"),DIR("A")="DO YOU WANT TO TURN IT "_$S('RCZ:"ON",1:"OFF")_" NOW?: "
"RTN","RCDPEWL8",153,0)
 S DIR(0)="YA",DIR("B")="YES" W ! D ^DIR K DIR
"RTN","RCDPEWL8",154,0)
 S VALMBCK="R"
"RTN","RCDPEWL8",155,0)
 Q:$D(DUOUT)!$D(DTOUT)!'Y
"RTN","RCDPEWL8",156,0)
 S ^TMP("RCERA_PARAMS",$J,"BATCHON")=$S(RCZ:0,1:1)
"RTN","RCDPEWL8",157,0)
 D BLD^RCDPEWL7($G(^TMP("RCERA_PARAMS",$J,"SORT")))
"RTN","RCDPEWL8",158,0)
 Q
"RTN","RCDPEWL8",159,0)
 ;
"RTN","RCDPEWL8",160,0)
HASADJ(RCSCR,RCOK) ; Function=1 if WL entry has any adj not yet distributed
"RTN","RCDPEWL8",161,0)
 ; RCSCR = ien of entry in file 344.49
"RTN","RCDPEWL8",162,0)
 ; RCOK = if passed by reference, returns 1 if ANY postable lines exist
"RTN","RCDPEWL8",163,0)
 N Z,Z0,RCSTOP
"RTN","RCDPEWL8",164,0)
 S RCSTOP=0,RCOK=0
"RTN","RCDPEWL8",165,0)
 S Z=0 F  S Z=$O(^RCY(344.49,RCSCR,1,Z)) Q:'Z  S Z0=$G(^(Z,0)) D  Q:RCSTOP
"RTN","RCDPEWL8",166,0)
 . ;HIPAA 5010 - negative value now takes precedence over adjustment
"RTN","RCDPEWL8",167,0)
 . I $P(Z0,U,6)>0!$O(^RCY(344.49,RCSCR,1,Z,1,0)) S RCOK=1
"RTN","RCDPEWL8",168,0)
 . I $P(Z0,U,6)<0 S RCSTOP=1
"RTN","RCDPEWL8",169,0)
 Q RCSTOP
"RTN","RCDPEWL8",170,0)
 ;
"RTN","RCDPEWL8",171,0)
VERIF ;EP - Protocol action - RCDPE EOB WORKLIST VERIFY
"RTN","RCDPEWL8",172,0)
 ; Entrypoint to verification options
"RTN","RCDPEWL8",173,0)
 N DIR,X,Y,RCQUIT,DTOUT,DUOUT
"RTN","RCDPEWL8",174,0)
 D FULL^VALM1
"RTN","RCDPEWL8",175,0)
 I '$D(^XUSEC("RCDPEPP",DUZ)) D  Q  ; PRCA*4.5*318 Added security key check
"RTN","RCDPEWL8",176,0)
 . W !!,"This action can only be taken by users that have the RCDPEPP security key.",!
"RTN","RCDPEWL8",177,0)
 . D PAUSE^VALM1
"RTN","RCDPEWL8",178,0)
 . S VALMBCK="R"
"RTN","RCDPEWL8",179,0)
 I $S($P($G(^RCY(344.4,RCSCR,4)),U,2)]"":1,1:0) D NOEDIT^RCDPEWLP G VERIFQ   ;prca*4.5*298  auto-posted ERAs cannot enter VERIFY action        
"RTN","RCDPEWL8",180,0)
 ;
"RTN","RCDPEWL8",181,0)
 W !!!!
"RTN","RCDPEWL8",182,0)
 S RCQUIT=0
"RTN","RCDPEWL8",183,0)
 F  D  Q:RCQUIT
"RTN","RCDPEWL8",184,0)
 . W !,"VERIFY EEOBs:",!,?10,"1",$J("",5),"MANUALLY MARK AS VERIFIED",!,?10,"2",$J("",5),"REPORT OF UNVERIFIED WITH DISCREPANCIES",!,?10,"3",$J("",5),"QUIT AND RETURN TO WORKLIST"
"RTN","RCDPEWL8",185,0)
 . S DIR(0)="SAO^1:MANUAL VERIFICATION;2:REPORT UNVERIFIED DISCREPANCIES;3:QUIT"
"RTN","RCDPEWL8",186,0)
 . S DIR("A")="Select Action: ",DIR("B")="QUIT" W ! D ^DIR K DIR
"RTN","RCDPEWL8",187,0)
 . I Y=3!(Y="")!$D(DUOUT)!$D(DTOUT) S RCQUIT=1 Q
"RTN","RCDPEWL8",188,0)
 . ;
"RTN","RCDPEWL8",189,0)
 . I Y=1 D MVER^RCDPEV(RCERA) W !! Q
"RTN","RCDPEWL8",190,0)
 . ;
"RTN","RCDPEWL8",191,0)
 . I Y=2 D RPT^RCDPEV0(RCERA) W !! Q
"RTN","RCDPEWL8",192,0)
 ;
"RTN","RCDPEWL8",193,0)
VERIFQ S VALMBCK="R"
"RTN","RCDPEWL8",194,0)
 Q
"RTN","RCDPEWL8",195,0)
 ;
"RTN","RCDPEWL8",196,0)
BATED ; Entry point to batch edit options
"RTN","RCDPEWL8",197,0)
 ; prca*4.5*298  per requirements, keep code for creating/maintaining batches but remove from execution
"RTN","RCDPEWL8",198,0)
 Q  ; prca*4.5*298
"RTN","RCDPEWL8",199,0)
 N DA,DIC,DIR,DTOUT,DUOUT,RCQUIT,X,Y
"RTN","RCDPEWL8",200,0)
 D FULL^VALM1
"RTN","RCDPEWL8",201,0)
 ;
"RTN","RCDPEWL8",202,0)
 W !!!!
"RTN","RCDPEWL8",203,0)
 S RCQUIT=0
"RTN","RCDPEWL8",204,0)
 I '$O(^RCY(344.49,RCERA,3,0)) W !,"***** THERE ARE CURRENTLY NO BATCHES DEFINED FOR THIS ERA *****",!
"RTN","RCDPEWL8",205,0)
 ; No menu if entering from a batch level
"RTN","RCDPEWL8",206,0)
 I $G(^TMP("RCBATCH_SELECTED",$J)) W !,"EDITING BATCH #"_+^TMP("RCBATCH_SELECTED",$J) D EDIT^RCDPEWLB(RCERA,+^TMP("RCBATCH_SELECTED",$J)) G BATEDQ
"RTN","RCDPEWL8",207,0)
 F  D  Q:RCQUIT
"RTN","RCDPEWL8",208,0)
 . I '$D(^XUSEC("PRCA ERA BATCH MAINT",DUZ)) D  Q
"RTN","RCDPEWL8",209,0)
 .. S RCQUIT=1
"RTN","RCDPEWL8",210,0)
 .. S DIR(0)="EA",DIR("A")="YOU DO NOT HAVE SECURITY ACCESS TO THIS ACTION - Press ENTER to continue: " W ! D ^DIR K DIR
"RTN","RCDPEWL8",211,0)
 .;
"RTN","RCDPEWL8",212,0)
 . W !,"BATCH MAINTENANCE:",!,?10,"1",$J("",5),"EDIT BATCH",!,?10,"2",$J("",5),"NEW BATCH ASSIGNMENT",!,?10,"3",$J("",5),"MARK ALL READY TO POST",!,?10,"4",$J("",5),"BATCH SUMMARY REPORT",!,?10,"5",$J("",5),"QUIT AND RETURN TO WORKLIST"
"RTN","RCDPEWL8",213,0)
 . S DIR(0)="SAO^1:EDIT BATCH;2:NEW BATCHES;3:MARK ALL;4:BATCH SUMMARY;5:QUIT"
"RTN","RCDPEWL8",214,0)
 . S DIR("A")="Select Action: ",DIR("B")="Quit" W ! D ^DIR K DIR
"RTN","RCDPEWL8",215,0)
 . I Y="5"!(Y="")!$D(DUOUT)!$D(DTOUT) S RCQUIT=1 Q
"RTN","RCDPEWL8",216,0)
 . ;
"RTN","RCDPEWL8",217,0)
 . I Y=1 D  W !! Q
"RTN","RCDPEWL8",218,0)
 .. I '$O(^RCY(344.49,RCERA,3,0)) D NOTSET^RCDPEWLC Q
"RTN","RCDPEWL8",219,0)
 .. S DIR("B")="ONE",DIR(0)="SA^A:ALL;O:ONE",DIR("A")="EDIT(A)LL or (O)NE BATCH?: " W ! D ^DIR K DIR
"RTN","RCDPEWL8",220,0)
 .. I $D(DTOUT)!$D(DUOUT) Q
"RTN","RCDPEWL8",221,0)
 .. I Y="A" D EDITALL^RCDPEWLB(RCERA) Q
"RTN","RCDPEWL8",222,0)
 .. S DA(1)=RCERA,DIC="^RCY(344.49,"_DA(1)_",3,",DIC(0)="AEMQ" D ^DIC
"RTN","RCDPEWL8",223,0)
 .. Q:Y'>0
"RTN","RCDPEWL8",224,0)
 .. D EDIT^RCDPEWLB(RCERA,+Y)
"RTN","RCDPEWL8",225,0)
 . ;
"RTN","RCDPEWL8",226,0)
 . I Y=2 D REBATCH^RCDPEWLB(RCERA) W !! Q
"RTN","RCDPEWL8",227,0)
 . ;
"RTN","RCDPEWL8",228,0)
 . I Y=3 D MARKALL^RCDPEWLB(RCERA) W !! Q
"RTN","RCDPEWL8",229,0)
 . ;
"RTN","RCDPEWL8",230,0)
 . I Y=4 D SUMRPT^RCDPEWLC(RCERA) W !! Q
"RTN","RCDPEWL8",231,0)
 ;
"RTN","RCDPEWL8",232,0)
BATEDQ S VALMBCK="R"
"RTN","RCDPEWL8",233,0)
 Q
"RTN","RCDPEWL8",234,0)
 ;
"RTN","RCDPEWL8",235,0)
AUTOPOST(SOURCE) ;EP Protocol action - RCDPE EOB WORKLIST MARK FOR AUTO POST
"RTN","RCDPEWL8",236,0)
 ; Input:
"RTN","RCDPEWL8",237,0)
 ;   SOURCE
"RTN","RCDPEWL8",238,0)
 ;      1:Called by Worklist (RCDPE WORKLIST ERA MARK FOR AUTO POST)
"RTN","RCDPEWL8",239,0)
 ;      2:Called by Scratchpad (RCDPE WORKLIST EOB MARK FOR AUTO POST)
"RTN","RCDPEWL8",240,0)
 ;   If SOURCE=2, RCSCR will be set to the IEN of 344.4
"RTN","RCDPEWL8",241,0)
 ;
"RTN","RCDPEWL8",242,0)
 D FULL^VALM1
"RTN","RCDPEWL8",243,0)
 I '$D(^XUSEC("RCDPEPP",DUZ)) D  Q  ; PRCA*4.5*318 Added security key check
"RTN","RCDPEWL8",244,0)
 . W !!,"This action can only be taken by users that have the RCDPEPP security key.",!
"RTN","RCDPEWL8",245,0)
 . D PAUSE^VALM1
"RTN","RCDPEWL8",246,0)
 . S VALMBCK="R"
"RTN","RCDPEWL8",247,0)
 ;
"RTN","RCDPEWL8",248,0)
 ; If called by Worklist (SOURCE=1), then ask which ERA
"RTN","RCDPEWL8",249,0)
 ; If called by Scratchpad (SOURCE=2), ERA is already in variable RCSCR
"RTN","RCDPEWL8",250,0)
 N RCERA
"RTN","RCDPEWL8",251,0)
 I SOURCE=1 S RCERA=$$SEL^RCDPEWL7()
"RTN","RCDPEWL8",252,0)
 I SOURCE=2 S RCERA=$G(RCSCR)
"RTN","RCDPEWL8",253,0)
 I 'RCERA S VALMBCK="R" Q
"RTN","RCDPEWL8",254,0)
 ;
"RTN","RCDPEWL8",255,0)
 N AUTOPOST
"RTN","RCDPEWL8",256,0)
 S AUTOPOST=$$AUTOCHK2^RCDPEAP1(RCERA)
"RTN","RCDPEWL8",257,0)
 I AUTOPOST D
"RTN","RCDPEWL8",258,0)
 . D SETSTA^RCDPEAP(RCERA,0,"Worklist: Marked as Auto-Post Candidate")
"RTN","RCDPEWL8",259,0)
 . W !,"ERA has been successfully Marked as an Auto-Post CANDIDATE"
"RTN","RCDPEWL8",260,0)
 I 'AUTOPOST D
"RTN","RCDPEWL8",261,0)
 . D AUDITLOG^RCDPEAP(RCERA,"","Worklist: Not Marked as Auto-Post Candidate-"_$P(AUTOPOST,U,2))
"RTN","RCDPEWL8",262,0)
 . W !,"ERA was NOT Marked as an Auto-Post CANDIDATE - ",$P(AUTOPOST,U,2)
"RTN","RCDPEWL8",263,0)
 ;
"RTN","RCDPEWL8",264,0)
AUTOPSTQ ;
"RTN","RCDPEWL8",265,0)
 K DIR
"RTN","RCDPEWL8",266,0)
 S DIR(0)="E" D ^DIR
"RTN","RCDPEWL8",267,0)
 S VALMBCK="R"
"RTN","RCDPEWL8",268,0)
 Q
"VER")
8.0^22.2
"^DD",344.31,344.31,.02,0)
PAYER NAME^FJ60^^0;2^K:$L(X)>60!($L(X)<1) X
"^DD",344.31,344.31,.02,1,0)
^.1^^0
"^DD",344.31,344.31,.02,3)
Answer must be 1-60 characters in length.
"^DD",344.31,344.31,.02,21,0)
^.001^1^1^3100621^^^
"^DD",344.31,344.31,.02,21,1,0)
This is the insurance co name as reported for the payment on the EFT.
"^DD",344.31,344.31,.02,"DT")
3170310
"^DD",344.4,344.4,.06,0)
PAYMENT FROM^FJ60^^0;6^K:$L(X)>60!($L(X)<1) X
"^DD",344.4,344.4,.06,1,0)
^.1^^0
"^DD",344.4,344.4,.06,3)
Answer must be 1-60 characters in length.
"^DD",344.4,344.4,.06,21,0)
^.001^1^1^3141217^^
"^DD",344.4,344.4,.06,21,1,0)
This is the name of the insurance co as returned on the ERA.
"^DD",344.4,344.4,.06,"DT")
3170310
"BLD",10470,6)
^287
**END**
**END**

