Released PRCA*4.5*339 SEQ #294
Extracted from mail message
**KIDS**:PRCA*4.5*339^

**INSTALL NAME**
PRCA*4.5*339
"BLD",10361,0)
PRCA*4.5*339^ACCOUNTS RECEIVABLE^0^3180423^y
"BLD",10361,4,0)
^9.64PA^^
"BLD",10361,6.3)
2
"BLD",10361,"ABPKG")
n
"BLD",10361,"KRN",0)
^9.67PA^779.2^20
"BLD",10361,"KRN",.4,0)
.4
"BLD",10361,"KRN",.401,0)
.401
"BLD",10361,"KRN",.402,0)
.402
"BLD",10361,"KRN",.403,0)
.403
"BLD",10361,"KRN",.5,0)
.5
"BLD",10361,"KRN",.84,0)
.84
"BLD",10361,"KRN",3.6,0)
3.6
"BLD",10361,"KRN",3.8,0)
3.8
"BLD",10361,"KRN",9.2,0)
9.2
"BLD",10361,"KRN",9.8,0)
9.8
"BLD",10361,"KRN",9.8,"NM",0)
^9.68A^12^12
"BLD",10361,"KRN",9.8,"NM",1,0)
RCDPRTEX^^0^B61987931
"BLD",10361,"KRN",9.8,"NM",1,99999999)
520824648^3180419.093048
"BLD",10361,"KRN",9.8,"NM",2,0)
RCDPRTP^^0^B14083064
"BLD",10361,"KRN",9.8,"NM",2,99999999)
520824648^3180419.093048
"BLD",10361,"KRN",9.8,"NM",3,0)
RCDPRTP0^^0^B54155958
"BLD",10361,"KRN",9.8,"NM",3,99999999)
520824648^3180419.093048
"BLD",10361,"KRN",9.8,"NM",4,0)
RCDPRTP1^^0^B48815425
"BLD",10361,"KRN",9.8,"NM",4,99999999)
520824648^3180419.093048
"BLD",10361,"KRN",9.8,"NM",5,0)
RCTCSJR^^0^B124960188
"BLD",10361,"KRN",9.8,"NM",5,99999999)
520824648^3180419.093048
"BLD",10361,"KRN",9.8,"NM",6,0)
RCTCSP1^^0^B172072875
"BLD",10361,"KRN",9.8,"NM",6,99999999)
520824648^3180419.093048
"BLD",10361,"KRN",9.8,"NM",7,0)
RCTCSP2^^0^B136606046
"BLD",10361,"KRN",9.8,"NM",7,99999999)
520824648^3180419.093048
"BLD",10361,"KRN",9.8,"NM",8,0)
RCTCSP4^^0^B221716971
"BLD",10361,"KRN",9.8,"NM",8,99999999)
520824648^3180419.093048
"BLD",10361,"KRN",9.8,"NM",9,0)
RCTCSP5^^0^B102095526
"BLD",10361,"KRN",9.8,"NM",9,99999999)
520824648^3180419.093048
"BLD",10361,"KRN",9.8,"NM",10,0)
RCTCSPD4^^0^B88898329
"BLD",10361,"KRN",9.8,"NM",10,99999999)
520824648^3180419.093048
"BLD",10361,"KRN",9.8,"NM",11,0)
RCTCSPD5^^0^B19943104
"BLD",10361,"KRN",9.8,"NM",11,99999999)
520824648^3180419.093048
"BLD",10361,"KRN",9.8,"NM",12,0)
RCTCSWL1^^0^B54064527
"BLD",10361,"KRN",9.8,"NM",12,99999999)
520824648^3180419.093048
"BLD",10361,"KRN",9.8,"NM","B","RCDPRTEX",1)

"BLD",10361,"KRN",9.8,"NM","B","RCDPRTP",2)

"BLD",10361,"KRN",9.8,"NM","B","RCDPRTP0",3)

"BLD",10361,"KRN",9.8,"NM","B","RCDPRTP1",4)

"BLD",10361,"KRN",9.8,"NM","B","RCTCSJR",5)

"BLD",10361,"KRN",9.8,"NM","B","RCTCSP1",6)

"BLD",10361,"KRN",9.8,"NM","B","RCTCSP2",7)

"BLD",10361,"KRN",9.8,"NM","B","RCTCSP4",8)

"BLD",10361,"KRN",9.8,"NM","B","RCTCSP5",9)

"BLD",10361,"KRN",9.8,"NM","B","RCTCSPD4",10)

"BLD",10361,"KRN",9.8,"NM","B","RCTCSPD5",11)

"BLD",10361,"KRN",9.8,"NM","B","RCTCSWL1",12)

"BLD",10361,"KRN",19,0)
19
"BLD",10361,"KRN",19.1,0)
19.1
"BLD",10361,"KRN",101,0)
101
"BLD",10361,"KRN",409.61,0)
409.61
"BLD",10361,"KRN",771,0)
771
"BLD",10361,"KRN",779.2,0)
779.2
"BLD",10361,"KRN",870,0)
870
"BLD",10361,"KRN",8989.51,0)
8989.51
"BLD",10361,"KRN",8989.52,0)
8989.52
"BLD",10361,"KRN",8994,0)
8994
"BLD",10361,"KRN","B",.4,.4)

"BLD",10361,"KRN","B",.401,.401)

"BLD",10361,"KRN","B",.402,.402)

"BLD",10361,"KRN","B",.403,.403)

"BLD",10361,"KRN","B",.5,.5)

"BLD",10361,"KRN","B",.84,.84)

"BLD",10361,"KRN","B",3.6,3.6)

"BLD",10361,"KRN","B",3.8,3.8)

"BLD",10361,"KRN","B",9.2,9.2)

"BLD",10361,"KRN","B",9.8,9.8)

"BLD",10361,"KRN","B",19,19)

"BLD",10361,"KRN","B",19.1,19.1)

"BLD",10361,"KRN","B",101,101)

"BLD",10361,"KRN","B",409.61,409.61)

"BLD",10361,"KRN","B",771,771)

"BLD",10361,"KRN","B",779.2,779.2)

"BLD",10361,"KRN","B",870,870)

"BLD",10361,"KRN","B",8989.51,8989.51)

"BLD",10361,"KRN","B",8989.52,8989.52)

"BLD",10361,"KRN","B",8994,8994)

"BLD",10361,"QUES",0)
^9.62^^
"BLD",10361,"REQB",0)
^9.611^1^1
"BLD",10361,"REQB",1,0)
PRCA*4.5*315^2
"BLD",10361,"REQB","B","PRCA*4.5*315",1)

"MBREQ")
0
"PKG",261,-1)
1^1
"PKG",261,0)
ACCOUNTS RECEIVABLE^PRCA^FMS
"PKG",261,20,0)
^9.402P^1^1
"PKG",261,20,1,0)
2^^PRCAMRG
"PKG",261,20,1,1)

"PKG",261,20,"B",2,1)

"PKG",261,22,0)
^9.49I^1^1
"PKG",261,22,1,0)
4.5^2950320^2960503
"PKG",261,22,1,"PAH",1,0)
339^3180423
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
12
"RTN","RCDPRTEX")
0^1^B61987931^B59632459
"RTN","RCDPRTEX",1,0)
RCDPRTEX ;ALB/LMH - Claims Matching Report for Excel ;30-SEP 2016
"RTN","RCDPRTEX",2,0)
 ;;4.5;Accounts Receivable;**315,339**;Mar 20, 1995;Build 2
"RTN","RCDPRTEX",3,0)
 ;;Per VA Directive 6402, this routine should not be modified.
"RTN","RCDPRTEX",4,0)
 ;
"RTN","RCDPRTEX",5,0)
 Q
"RTN","RCDPRTEX",6,0)
 ;
"RTN","RCDPRTEX",7,0)
PRINT ; Entry point for printing the Excel version of the report (either in foreground or background)
"RTN","RCDPRTEX",8,0)
 ; Input: 
"RTN","RCDPRTEX",9,0)
 ;    RCEXCEL=1 here
"RTN","RCDPRTEX",10,0)
 ; Output: 
"RTN","RCDPRTEX",11,0)
 ;    Report is printed in text format for Excel (turn on logging)
"RTN","RCDPRTEX",12,0)
 ; 
"RTN","RCDPRTEX",13,0)
 U IO
"RTN","RCDPRTEX",14,0)
 K ^TMP("RCDPRTPB",$J),^TMP("IBRBT",$J),^TMP("IBRBF",$J)
"RTN","RCDPRTEX",15,0)
 N DAT,RCBIL,RCBIL0,RCNAM,RCPAY,RCPAY1,RCREC,RCREC1,RCRECTDA,RCSSN,RCTYP,CRT,DIR,DIROUT,DIRUT,DTOUT,DUOUT
"RTN","RCDPRTEX",16,0)
 N RCSTOP,PAGE,SEPLINE,X,XX,Y,RCNO
"RTN","RCDPRTEX",17,0)
 S CRT=$S(IOST["C-":1,1:0) ; 1 - Print to Screen, 0 - Otherwise
"RTN","RCDPRTEX",18,0)
 I '$D(ZTQUEUED) U 0 W !!?5,"Compiling Claims Matching Report for Excel output. Please wait ... " U IO
"RTN","RCDPRTEX",19,0)
 ;
"RTN","RCDPRTEX",20,0)
 ; build the initial ^TMP("RCDPRTPB",$J) scratch global
"RTN","RCDPRTEX",21,0)
 D @($S(RCSORT=1:"PAT",RCSORT=2:"BILL",RCSORT=3:"DATE",RCSORT=4:"REC",RCSORT=5:"TYPE")_"^RCDPRTP0")
"RTN","RCDPRTEX",22,0)
 ;
"RTN","RCDPRTEX",23,0)
 S IOSL=999999 ; Long screen length for Excel output
"RTN","RCDPRTEX",24,0)
 S PAGE=0,RCSTOP=0,$P(SEPLINE,"-",81)=""
"RTN","RCDPRTEX",25,0)
 ;
"RTN","RCDPRTEX",26,0)
 I '$D(^TMP("RCDPRTPB",$J)) D  Q
"RTN","RCDPRTEX",27,0)
 . W:CRT @IOF W:'CRT $C(13)    ; initial form feed or page reset for no data found
"RTN","RCDPRTEX",28,0)
 . W !!?5,"No data found for this report."
"RTN","RCDPRTEX",29,0)
 . I CRT,'$D(ZTQUEUED) S DIR(0)="E" D ^DIR K DIR
"RTN","RCDPRTEX",30,0)
 . D ^%ZISC
"RTN","RCDPRTEX",31,0)
 . Q
"RTN","RCDPRTEX",32,0)
 ;
"RTN","RCDPRTEX",33,0)
START ;
"RTN","RCDPRTEX",34,0)
 N RCPAT0,NAME,BILLNUM,BILLFROM,BILLTO,RXCOV,RCIBFN,DOB,AMT,CHGTYP,STATUS
"RTN","RCDPRTEX",35,0)
 N RCH,AMT1,PAYOR,PST,FILLFROM,FILLTO,ONHOLD,RCAMT,RCAMT1,RCIBDAT,STRING,RCBILL0
"RTN","RCDPRTEX",36,0)
 N RCQ,RCSSN,RCTP,RCEXNAM,ELIG,FPCBILL,POSTDATE,RCDOB,RCFLAG,BAL,DATE,DEBTOR,RCDATE,RCDEBTOR,RCNAME
"RTN","RCDPRTEX",37,0)
 D EXCELHD
"RTN","RCDPRTEX",38,0)
 ;
"RTN","RCDPRTEX",39,0)
 S RCNAM="" F  S RCNAM=$O(^TMP("RCDPRTPB",$J,RCNAM)) Q:RCNAM=""  D
"RTN","RCDPRTEX",40,0)
 .S RCBILL=0 F  S RCBILL=$O(^TMP("RCDPRTPB",$J,RCNAM,RCBILL)) Q:'RCBILL  D
"RTN","RCDPRTEX",41,0)
 ..D DEMOG
"RTN","RCDPRTEX",42,0)
 ..D PROC^RCDPRTP1 ;    Process each third party bill for a patient.
"RTN","RCDPRTEX",43,0)
 ..K ^TMP("IBRBT",$J),^TMP("IBRBF",$J)
"RTN","RCDPRTEX",44,0)
 ;
"RTN","RCDPRTEX",45,0)
 D ^%ZISC
"RTN","RCDPRTEX",46,0)
 K ^TMP("RCDPRTPB",$J)
"RTN","RCDPRTEX",47,0)
 Q
"RTN","RCDPRTEX",48,0)
 ;
"RTN","RCDPRTEX",49,0)
DEMOG ; Demographic data for third party bills &  
"RTN","RCDPRTEX",50,0)
 ;        first party charges detail line header 
"RTN","RCDPRTEX",51,0)
 ; 
"RTN","RCDPRTEX",52,0)
 S RCPAT0=$G(^TMP("RCDPRTPB",$J,RCNAM))
"RTN","RCDPRTEX",53,0)
 S DATE=$G(^TMP("RCDPRTPB",$J,RCNAM,RCBILL))
"RTN","RCDPRTEX",54,0)
 S RCNAME=$P(RCNAM,"^")
"RTN","RCDPRTEX",55,0)
 S RCBILL0=$G(^PRCA(430,RCBILL,0))
"RTN","RCDPRTEX",56,0)
 S RCDFN=$P($G(^PRCA(430,RCBILL,0)),U,7)
"RTN","RCDPRTEX",57,0)
 S RCDOB=$P($G(^DPT(RCDFN,0)),U,3)
"RTN","RCDPRTEX",58,0)
 S DOB=$$FMTE^XLFDT(RCDOB,"5Z")
"RTN","RCDPRTEX",59,0)
 S DEBTOR=$P($G(RCBILL0),U,9)
"RTN","RCDPRTEX",60,0)
 S RCDEBTOR=$O(^RCD(340,"B",RCDFN_";DPT(",0)) Q:'RCDEBTOR
"RTN","RCDPRTEX",61,0)
 S RCSSN=$$SSN^RCFN01($G(RCDEBTOR))
"RTN","RCDPRTEX",62,0)
 S ELIG=$P($G(RCPAT0),U,2)
"RTN","RCDPRTEX",63,0)
 Q
"RTN","RCDPRTEX",64,0)
 ;
"RTN","RCDPRTEX",65,0)
PRNTPAT ; setup & print third party bills (called by PROC^RCDPRTP1 for Excel output only)
"RTN","RCDPRTEX",66,0)
 S RCTP=RCBILL,RCIBDAT=$G(^TMP("IBRBT",$J,RCBILL,RCBILL))
"RTN","RCDPRTEX",67,0)
 S STATUS=$$STAT^RCDPRTP2(RCTP) Q:STATUS="CN"!(STATUS="CB")  ;Added a last minute check for cancelled third party bills
"RTN","RCDPRTEX",68,0)
 S RXCOV=$S('$G(^TMP("IBRBT",$J,RCBILL)):"NO",1:"YES")
"RTN","RCDPRTEX",69,0)
 S BILLNUM=$P(RCIBDAT,U,4) ; BILL #
"RTN","RCDPRTEX",70,0)
 S PST=$P(RCIBDAT,U,5) ; P/S/T
"RTN","RCDPRTEX",71,0)
 S BILLFROM=$$DATE^RCDPRTP2($P(RCIBDAT,U)) ; bill date from
"RTN","RCDPRTEX",72,0)
 S BILLTO=$$DATE^RCDPRTP2($P(RCIBDAT,U,2)) ; bill date to
"RTN","RCDPRTEX",73,0)
 S RCDATE=$S($G(RCTP(RCTP)):RCTP(RCTP),$G(^TMP("RCDPRTPB",$J,RCNAM,RCBILL)):^(RCBILL),1:"") I RCTP=RCBILL!($D(RCTP(RCTP))) S POSTDATE=$$DATE^RCDPRTP2(RCDATE)
"RTN","RCDPRTEX",74,0)
 S RCIBFN=RCTP
"RTN","RCDPRTEX",75,0)
 S RCDATE=$P($G(^PRCA(430,+RCTP,0)),U,14)
"RTN","RCDPRTEX",76,0)
 S POSTDATE=$S(RCDATE=DATE:$$DATE^RCDPRTP2(RCDATE),RCDATE'=DATE:"^")
"RTN","RCDPRTEX",77,0)
 S PAYOR=$P(RCIBDAT,U,7) ; payor
"RTN","RCDPRTEX",78,0)
 S RCAMT=$P($G(^PRCA(430,+RCTP,0)),"^",3) ; amt billed
"RTN","RCDPRTEX",79,0)
 S RCAMT1=$P($G(^PRCA(430,+RCTP,7)),"^",7) ; amt paid
"RTN","RCDPRTEX",80,0)
 S RCTYPE=$$TYP^IBRFN(RCTP) ;Third party bill type of care
"RTN","RCDPRTEX",81,0)
 S RCTYPE=$S(RCTYPE="":-1,RCTYPE="PR":"P",RCTYPE="PH":"R",1:RCTYPE)
"RTN","RCDPRTEX",82,0)
 S RCFLAG=RCTYPE
"RTN","RCDPRTEX",83,0)
 S RCTP=RCBILL
"RTN","RCDPRTEX",84,0)
 D EXCELPAT
"RTN","RCDPRTEX",85,0)
 ;
"RTN","RCDPRTEX",86,0)
EXCELTPB ; print other assoc. third party bills
"RTN","RCDPRTEX",87,0)
 S RCTP=0 F  S RCTP=$O(^TMP("IBRBT",$J,RCBILL,RCTP)) Q:'RCTP  D
"RTN","RCDPRTEX",88,0)
 .S STATUS=$$STAT^RCDPRTP2(RCTP) Q:STATUS="CN"!(STATUS="CB")  ;Added a last minute check for cancelled third party bills
"RTN","RCDPRTEX",89,0)
 .I RCBILL=RCTP Q  ; don't reprint the bill that was paid.
"RTN","RCDPRTEX",90,0)
 .S RCIBDAT=$G(^TMP("IBRBT",$J,RCBILL,RCTP))
"RTN","RCDPRTEX",91,0)
 .I 'RCAN,($P(RCIBDAT,"^",3)) Q  ; exclude cancelled bills
"RTN","RCDPRTEX",92,0)
 .D DEMOG
"RTN","RCDPRTEX",93,0)
 .S RXCOV=$S('$G(^TMP("IBRBT",$J,RCBILL)):"NO",1:"YES")
"RTN","RCDPRTEX",94,0)
 .S BILLNUM=$P(RCIBDAT,U,4) ; BILL #
"RTN","RCDPRTEX",95,0)
 .S PST=$P(RCIBDAT,U,5) ; P/S/T
"RTN","RCDPRTEX",96,0)
 .S BILLFROM=$$DATE^RCDPRTP2($P(RCIBDAT,U)) ; bill date from
"RTN","RCDPRTEX",97,0)
 .S BILLTO=$$DATE^RCDPRTP2($P(RCIBDAT,U,2)) ; bill date to
"RTN","RCDPRTEX",98,0)
 .S RCDATE=$P($G(^PRCA(430,+RCTP,0)),U,14)
"RTN","RCDPRTEX",99,0)
 .S POSTDATE=$S(RCDATE=DATE:$$DATE^RCDPRTP2(RCDATE),RCDATE'=DATE:"^")
"RTN","RCDPRTEX",100,0)
 .S RCIBFN=RCTP
"RTN","RCDPRTEX",101,0)
 .S PAYOR=$P(RCIBDAT,U,7) ; payor 
"RTN","RCDPRTEX",102,0)
 .S RCAMT=$P($G(^PRCA(430,+RCTP,0)),"^",3) ; amt billed
"RTN","RCDPRTEX",103,0)
 .S RCAMT1=$P($G(^PRCA(430,+RCTP,7)),"^",7) ; amt paid
"RTN","RCDPRTEX",104,0)
 .S RCTYPE=$$TYP^IBRFN(RCTP) ;Third party bill type of care
"RTN","RCDPRTEX",105,0)
 .S RCTYPE=$S(RCTYPE="":-1,RCTYPE="PR":"P",RCTYPE="PH":"R",1:RCTYPE)
"RTN","RCDPRTEX",106,0)
 .D EXCELPAT
"RTN","RCDPRTEX",107,0)
 ;
"RTN","RCDPRTEX",108,0)
PRNTFPC ; print associated first party charges
"RTN","RCDPRTEX",109,0)
 ; This code screens entries from file 350.1 returned by API - RELBILL^IBRFN
"RTN","RCDPRTEX",110,0)
 N RCACTYP,I,J    ;Do the next section of code only if Care Types were selected - Stored in RCTYPE([care type])
"RTN","RCDPRTEX",111,0)
 ; We must loop through all Bills and First party charges for this screening
"RTN","RCDPRTEX",112,0)
 I $D(RCTYPE)>1 S I=0 F  S I=$O(^TMP("IBRBF",$J,I)) Q:'I  S J=0 F  S J=$O(^TMP("IBRBF",$J,I,J)) Q:'J  D
"RTN","RCDPRTEX",113,0)
 . S RCACTYP=$P(^TMP("IBRBF",$J,I,J),U,6) Q:RCACTYP=""  ;6th piece is Action Type
"RTN","RCDPRTEX",114,0)
 . I RCACTYP["TRICARE"!(RCACTYP["CHAMPA") Q  ;Not needed for screening 1st party charges
"RTN","RCDPRTEX",115,0)
 . I RCACTYP["RX" S RCTYP="R" D KILFPTY^RCDPRTP1 Q
"RTN","RCDPRTEX",116,0)
 . I RCACTYP["OPT"!(RCACTYP["OBSERV") S RCTYP="O" D KILFPTY^RCDPRTP1 Q
"RTN","RCDPRTEX",117,0)
 . I RCACTYP["INPT"!(RCACTYP["NHCU")!(RCACTYP["ADMIS")!(RCACTYP["MEDICARE DECUCTIBLE") S RCTYP="I" D KILFPTY^RCDPRTP1 Q
"RTN","RCDPRTEX",118,0)
 . Q
"RTN","RCDPRTEX",119,0)
 ;
"RTN","RCDPRTEX",120,0)
 S RCTP(0)=0 F  S RCTP(0)=$O(^TMP("IBRBF",$J,RCTP(0))) Q:'RCTP(0)!$G(RCQ)  D
"RTN","RCDPRTEX",121,0)
 .S RCTP=0 F  S RCTP=$O(^TMP("IBRBF",$J,RCTP(0),RCTP)) Q:'RCTP!$G(RCQ)  D 
"RTN","RCDPRTEX",122,0)
 ..S RCNO=1
"RTN","RCDPRTEX",123,0)
 ..S RCIBDAT=$G(^TMP("IBRBF",$J,RCTP(0),RCTP))
"RTN","RCDPRTEX",124,0)
 ..S RCIBFN=$P(RCIBDAT,U,4) I RCIBFN S RCIBFN=$O(^PRCA(430,"B",RCIBFN,0))
"RTN","RCDPRTEX",125,0)
 ..D DEMOG
"RTN","RCDPRTEX",126,0)
 ..S RXCOV=$S('$G(^TMP("IBRBT",$J,RCBILL)):"NO",1:"YES")
"RTN","RCDPRTEX",127,0)
 ..S FILLFROM=$$DATE^RCDPRTP2(+RCIBDAT) ; Bill from
"RTN","RCDPRTEX",128,0)
 ..S FILLTO=$$DATE^RCDPRTP2($P(RCIBDAT,U,2)) ; Bill to
"RTN","RCDPRTEX",129,0)
 ..S CHGTYP=$P(RCIBDAT,U,6)
"RTN","RCDPRTEX",130,0)
 ..S RCIBFN=$P(RCIBDAT,"^",4) I RCIBFN S RCIBFN=$O(^PRCA(430,"B",RCIBFN,0))
"RTN","RCDPRTEX",131,0)
 ..S FPCBILL=$P(RCIBDAT,U,4)
"RTN","RCDPRTEX",132,0)
 ..S STATUS=$$STAT^RCDPRTP2(RCIBFN) ; Status
"RTN","RCDPRTEX",133,0)
 ..S ONHOLD=$P(RCIBDAT,U,7) ; # Days On Hold
"RTN","RCDPRTEX",134,0)
 ..S AMT=$P(RCIBDAT,U,5) ; Amount billed
"RTN","RCDPRTEX",135,0)
 ..S BAL=$S($G(^PRCA(430,+RCIBFN,7)):+($P(^(7),"^")+$P(^(7),"^",2)+$P(^(7),"^",3)+$P(^(7),"^",4)+$P(^(7),"^",4)),1:0)
"RTN","RCDPRTEX",136,0)
 ..D EXCELFPC
"RTN","RCDPRTEX",137,0)
 .Q
"RTN","RCDPRTEX",138,0)
 Q
"RTN","RCDPRTEX",139,0)
 ;
"RTN","RCDPRTEX",140,0)
EXCELHD ; Print an Excel CSV header record
"RTN","RCDPRTEX",141,0)
 ;
"RTN","RCDPRTEX",142,0)
 ; Input: None
"RTN","RCDPRTEX",143,0)
 ; Output: Header line printed for CSV format (excel)
"RTN","RCDPRTEX",144,0)
 ;
"RTN","RCDPRTEX",145,0)
 W:CRT @IOF W:'CRT $C(13)    ; initial form feed or page reset for Excel header line
"RTN","RCDPRTEX",146,0)
 N RCH
"RTN","RCDPRTEX",147,0)
 S STRING=""
"RTN","RCDPRTEX",148,0)
 S RCH=$$CSV("","Patient")
"RTN","RCDPRTEX",149,0)
 S RCH=$$CSV(RCH,"SSN")
"RTN","RCDPRTEX",150,0)
 S RCH=$$CSV(RCH,"DOB")
"RTN","RCDPRTEX",151,0)
 S RCH=$$CSV(RCH,"Prim. Elig")
"RTN","RCDPRTEX",152,0)
 S RCH=$$CSV(RCH,"RX Cvg")
"RTN","RCDPRTEX",153,0)
 S RCH=$$CSV(RCH,"Bill Type")
"RTN","RCDPRTEX",154,0)
 S RCH=$$CSV(RCH,"Bill#")
"RTN","RCDPRTEX",155,0)
 S RCH=$$CSV(RCH,"P/S/T")
"RTN","RCDPRTEX",156,0)
 S RCH=$$CSV(RCH,"Chg Type")
"RTN","RCDPRTEX",157,0)
 S RCH=$$CSV(RCH,"Status")
"RTN","RCDPRTEX",158,0)
 S RCH=$$CSV(RCH,"Bill From")
"RTN","RCDPRTEX",159,0)
 S RCH=$$CSV(RCH,"Bill To")
"RTN","RCDPRTEX",160,0)
 S RCH=$$CSV(RCH,"Posted")
"RTN","RCDPRTEX",161,0)
 S RCH=$$CSV(RCH,"Amt Billed")
"RTN","RCDPRTEX",162,0)
 S RCH=$$CSV(RCH,"Amt Pd")
"RTN","RCDPRTEX",163,0)
 S RCH=$$CSV(RCH,"Bal")
"RTN","RCDPRTEX",164,0)
 S RCH=$$CSV(RCH,"Care Type")
"RTN","RCDPRTEX",165,0)
 S RCH=$$CSV(RCH,"On Hold")
"RTN","RCDPRTEX",166,0)
 S RCH=$$CSV(RCH,"Payor")
"RTN","RCDPRTEX",167,0)
 W RCH
"RTN","RCDPRTEX",168,0)
 Q
"RTN","RCDPRTEX",169,0)
 ;
"RTN","RCDPRTEX",170,0)
EXCELPAT ; Print patient third party bills
"RTN","RCDPRTEX",171,0)
 ;
"RTN","RCDPRTEX",172,0)
 ; Input: None
"RTN","RCDPRTEX",173,0)
 ; Output: Detail line printed for CSV format (excel)
"RTN","RCDPRTEX",174,0)
 ;
"RTN","RCDPRTEX",175,0)
 N RCD
"RTN","RCDPRTEX",176,0)
 S STRING=""
"RTN","RCDPRTEX",177,0)
 S RCD=$$CSV("",RCNAME)_"^"_$E(RCNAME,1)_$E(RCSSN,6,9)
"RTN","RCDPRTEX",178,0)
 S RCD=$$CSV(RCD,DOB)
"RTN","RCDPRTEX",179,0)
 S RCD=$$CSV(RCD,ELIG)
"RTN","RCDPRTEX",180,0)
 S RCD=$$CSV(RCD,RXCOV)
"RTN","RCDPRTEX",181,0)
 S RCD=$$CSV(RCD,"Third Party Bill")
"RTN","RCDPRTEX",182,0)
 S RCD=$$CSV(RCD,BILLNUM)
"RTN","RCDPRTEX",183,0)
 S RCD=$$CSV(RCD,PST)
"RTN","RCDPRTEX",184,0)
 S RCD=$$CSV(RCD,"^")
"RTN","RCDPRTEX",185,0)
 S RCD=$$CSV(RCD,STATUS)
"RTN","RCDPRTEX",186,0)
 S RCD=$$CSV(RCD,BILLFROM)
"RTN","RCDPRTEX",187,0)
 S RCD=$$CSV(RCD,BILLTO)
"RTN","RCDPRTEX",188,0)
 S RCD=$$CSV(RCD,POSTDATE)
"RTN","RCDPRTEX",189,0)
 S RCD=$$CSV(RCD,RCAMT)
"RTN","RCDPRTEX",190,0)
 S RCD=$$CSV(RCD,RCAMT1)
"RTN","RCDPRTEX",191,0)
 S RCD=$$CSV(RCD,"^")
"RTN","RCDPRTEX",192,0)
 S RCD=$$CSV(RCD,RCTYPE)
"RTN","RCDPRTEX",193,0)
 S RCD=$$CSV(RCD,"^")
"RTN","RCDPRTEX",194,0)
 S RCD=$$CSV(RCD,PAYOR)
"RTN","RCDPRTEX",195,0)
 W !,RCD
"RTN","RCDPRTEX",196,0)
 K RCTP(RCTP)
"RTN","RCDPRTEX",197,0)
 Q
"RTN","RCDPRTEX",198,0)
 ;
"RTN","RCDPRTEX",199,0)
EXCELFPC ; Print patient first party charges
"RTN","RCDPRTEX",200,0)
 ;
"RTN","RCDPRTEX",201,0)
 ; Input: None
"RTN","RCDPRTEX",202,0)
 ; Output: Detail line printed for CSV format (excel)
"RTN","RCDPRTEX",203,0)
 ;
"RTN","RCDPRTEX",204,0)
 N RCB
"RTN","RCDPRTEX",205,0)
 S STRING=""
"RTN","RCDPRTEX",206,0)
 S RCB=$$CSV("",RCNAME)_"^"_$E(RCNAME,1)_$E(RCSSN,6,9)
"RTN","RCDPRTEX",207,0)
 S RCB=$$CSV(RCB,DOB)
"RTN","RCDPRTEX",208,0)
 S RCB=$$CSV(RCB,ELIG)
"RTN","RCDPRTEX",209,0)
 S RCB=$$CSV(RCB,"^")
"RTN","RCDPRTEX",210,0)
 S RCB=$$CSV(RCB,"First Party Charge")
"RTN","RCDPRTEX",211,0)
 S RCB=$$CSV(RCB,FPCBILL)
"RTN","RCDPRTEX",212,0)
 S RCB=$$CSV(RCB,"^")
"RTN","RCDPRTEX",213,0)
 S RCB=$$CSV(RCB,CHGTYP)
"RTN","RCDPRTEX",214,0)
 S RCB=$$CSV(RCB,STATUS)
"RTN","RCDPRTEX",215,0)
 S RCB=$$CSV(RCB,FILLFROM)
"RTN","RCDPRTEX",216,0)
 S RCB=$$CSV(RCB,FILLTO)
"RTN","RCDPRTEX",217,0)
 S RCB=$$CSV(RCB,"^")
"RTN","RCDPRTEX",218,0)
 S RCB=$$CSV(RCB,AMT)
"RTN","RCDPRTEX",219,0)
 S RCB=$$CSV(RCB,"^")
"RTN","RCDPRTEX",220,0)
 S RCB=$$CSV(RCB,BAL)
"RTN","RCDPRTEX",221,0)
 S RCB=$$CSV(RCB,"^")
"RTN","RCDPRTEX",222,0)
 S RCB=$$CSV(RCB,ONHOLD)
"RTN","RCDPRTEX",223,0)
 W !,RCB
"RTN","RCDPRTEX",224,0)
 Q
"RTN","RCDPRTEX",225,0)
 ;
"RTN","RCDPRTEX",226,0)
CSV(STRING,DATA) ; Build the Excel data string for CSV format
"RTN","RCDPRTEX",227,0)
 ; Input: STRING - Current string being built or ""
"RTN","RCDPRTEX",228,0)
 ; DATA - New data to be added to the string
"RTN","RCDPRTEX",229,0)
 ; Returns: STRING - Updated string with DATA added
"RTN","RCDPRTEX",230,0)
 ; 
"RTN","RCDPRTEX",231,0)
 S DATA=""_$TR(DATA,$C(94))
"RTN","RCDPRTEX",232,0)
 S STRING=$S(STRING="":DATA,1:STRING_"^"_DATA)
"RTN","RCDPRTEX",233,0)
 Q STRING
"RTN","RCDPRTEX",234,0)
 ;
"RTN","RCDPRTP")
0^2^B14083064^B13526370
"RTN","RCDPRTP",1,0)
RCDPRTP  ;ALB/LDB-CLAIMS MATCHING REPORT ;1/11/01  2:03 PM
"RTN","RCDPRTP",2,0)
 ;;4.5;Accounts Receivable;**151,186,315,339**;Mar 20, 1995;Build 2
"RTN","RCDPRTP",3,0)
 ;;Per VA Directive 6402, this routine should not be modified.
"RTN","RCDPRTP",4,0)
 ;
"RTN","RCDPRTP",5,0)
EN ;
"RTN","RCDPRTP",6,0)
 N DATEEND,DATESTRT,DIC,DIR,DIRUT,POP,RCBILL,RCDEBT,RCDFN,RCPT,RCSORT,RCQUIT,%ZIS,ZTDESC,ZTSAVE,ZTRTN,Y,RCAN,DIOEND,ZTIO,RCTYPE
"RTN","RCDPRTP",7,0)
 W !
"RTN","RCDPRTP",8,0)
 K DIRUT S DIR(0)="S^1:Patient;2:Bill Number;3:Payment dates;4:Receipt Number;5:Care Types",DIR("A")="Sort by" D ^DIR K DIR Q:$D(DIRUT)
"RTN","RCDPRTP",9,0)
 S RCSORT=Y,RCQUIT=""
"RTN","RCDPRTP",10,0)
 D @RCSORT Q:RCQUIT  W !
"RTN","RCDPRTP",11,0)
 K DIRUT S DIR(0)="Y",DIR("A")="Include cancelled bills",DIR("B")="NO" D ^DIR S RCAN=+Y Q:$D(DIRUT)
"RTN","RCDPRTP",12,0)
 ;
"RTN","RCDPRTP",13,0)
 ; if user wants Excel output, then call the device question for Excel and then quit
"RTN","RCDPRTP",14,0)
 I $$FORMAT^RCDPRTP0(.RCEXCEL) D DEVICE^RCDPRTP0 Q   ; exit point for Excel output
"RTN","RCDPRTP",15,0)
 Q:RCQUIT
"RTN","RCDPRTP",16,0)
 ;
"RTN","RCDPRTP",17,0)
 ; At this point, the user wants non-Excel output.  Ask device question for non-Excel output.
"RTN","RCDPRTP",18,0)
 W !!,"This report requires 132 columns.",!!
"RTN","RCDPRTP",19,0)
 K IOP,IO("Q") S %ZIS="MQ",%ZIS("B")="" D ^%ZIS Q:POP
"RTN","RCDPRTP",20,0)
 I $D(IO("Q")) D  Q
"RTN","RCDPRTP",21,0)
 .S ZTDESC="Claims Matching Report",ZTRTN="DQ^RCDPRTP"
"RTN","RCDPRTP",22,0)
 .S ZTSAVE("RCSORT")=""
"RTN","RCDPRTP",23,0)
 . I RCSORT=1 S ZTSAVE("RCDEBT")="",ZTSAVE("RCDFN")="",ZTSAVE("RCTYPE*")=""
"RTN","RCDPRTP",24,0)
 . I RCSORT=2 S ZTSAVE("RCBILL")="",ZTSAVE("RCDFN")="",ZTSAVE("RCDEBT")=""
"RTN","RCDPRTP",25,0)
 . I RCSORT=4 S ZTSAVE("RCPT")=""
"RTN","RCDPRTP",26,0)
 . I RCSORT=5 S ZTSAVE("RCTYPE*")=""
"RTN","RCDPRTP",27,0)
 . S ZTSAVE("RCAN")="",ZTSAVE("ZTREQ")="@",ZTSAVE("^TMP(""RCDPRTPB"",$J,")=""
"RTN","RCDPRTP",28,0)
 . S ZTSAVE("DATEEND")="",ZTSAVE("DATESTRT")="",ZTSAVE("RCQUIT")="",ZTSAVE("RCSORT")="",ZTSAVE("RCEXCEL")=""
"RTN","RCDPRTP",29,0)
 . S ZTIO=ION_";"_IOST_";"_IOM_";"_IOSL
"RTN","RCDPRTP",30,0)
 . S DIOEND="K ^TMP(""RCDPRTPB"",$J)"
"RTN","RCDPRTP",31,0)
 .D ^%ZTLOAD,HOME^%ZIS K IO("Q") W !,"Task# ",ZTSK
"RTN","RCDPRTP",32,0)
 W !!,?20,"<*> please wait <*>"
"RTN","RCDPRTP",33,0)
DQ     ;  queued report starts here
"RTN","RCDPRTP",34,0)
 U IO
"RTN","RCDPRTP",35,0)
 K ^TMP("RCDPRTPB",$J),^TMP("IBRBT",$J),^TMP("IBRBF",$J)
"RTN","RCDPRTP",36,0)
 N DAT,RCBIL,RCBIL0,RCNAM,RCPAY,RCPAY1,RCREC,RCREC1,RCRECTDA,RCSSN,RCTYP
"RTN","RCDPRTP",37,0)
 D @($S(RCSORT=1:"PAT",RCSORT=2:"BILL",RCSORT=3:"DATE",RCSORT=4:"REC",RCSORT=5:"TYPE")_"^RCDPRTP0")
"RTN","RCDPRTP",38,0)
 Q:RCQUIT
"RTN","RCDPRTP",39,0)
 D EN^RCDPRTP1
"RTN","RCDPRTP",40,0)
 W !!,?20,"<End of report>",!
"RTN","RCDPRTP",41,0)
 K DATESTRT,DATEEND,^TMP("RCDPRTPB",$J),RCTYPE
"RTN","RCDPRTP",42,0)
 D ^%ZISC
"RTN","RCDPRTP",43,0)
 Q
"RTN","RCDPRTP",44,0)
 ;
"RTN","RCDPRTP",45,0)
1 ; 
"RTN","RCDPRTP",46,0)
 S DIC(0)="QEAMZ",DIC=340,DIC("S")="I ^RCD(340,+Y,0)[""DPT""",DIC("A")="Patient name: " D ^DIC I Y<0 S RCQUIT=1 Q
"RTN","RCDPRTP",47,0)
 S RCDEBT=+Y,RCDFN=+$P(Y,"^",2)
"RTN","RCDPRTP",48,0)
 D TYPEPIC^RCDPRTP0(.RCTYPE) I '$D(RCTYPE) S RCQUIT=1 Q
"RTN","RCDPRTP",49,0)
 D DATESEL^RCRJRTRA("Payment")
"RTN","RCDPRTP",50,0)
 I '$G(DATESTRT)!('$G(DATEEND)) S RCQUIT=1
"RTN","RCDPRTP",51,0)
 Q
"RTN","RCDPRTP",52,0)
 ;
"RTN","RCDPRTP",53,0)
3 ; 
"RTN","RCDPRTP",54,0)
 D DATESEL^RCRJRTRA("Payment")
"RTN","RCDPRTP",55,0)
 I '$G(DATESTRT)!('$G(DATEEND)) S RCQUIT=1
"RTN","RCDPRTP",56,0)
 Q
"RTN","RCDPRTP",57,0)
 ;
"RTN","RCDPRTP",58,0)
2 ; 
"RTN","RCDPRTP",59,0)
 N DIC,DUOUT
"RTN","RCDPRTP",60,0)
 K ^TMP("IBRBF",$J)
"RTN","RCDPRTP",61,0)
 S DIC(0)="QEAM",DIC=430,DIC("S")="I $P(^(0),U,2)=9" D ^DIC I Y<0 S RCQUIT=1 Q
"RTN","RCDPRTP",62,0)
 S RCBILL=+Y,RCDFN=$P($G(^PRCA(430,+RCBILL,0)),"^",7) Q:'RCDFN
"RTN","RCDPRTP",63,0)
 S RCDEBT=$O(^RCD(340,"B",RCDFN_";DPT(",0))
"RTN","RCDPRTP",64,0)
 I (RCDFN="")!(RCDEBT="") W !,"This bill has no matching first party bills." G 2
"RTN","RCDPRTP",65,0)
 D RELBILL^IBRFN(RCBILL)
"RTN","RCDPRTP",66,0)
 I '$O(^TMP("IBRBF",$J,RCBILL,0)) W !,"This bill has no matching first party debts." K ^TMP("IBRBF",$J) G 2
"RTN","RCDPRTP",67,0)
 K ^TMP("IBRBF",$J)
"RTN","RCDPRTP",68,0)
 Q
"RTN","RCDPRTP",69,0)
 ;
"RTN","RCDPRTP",70,0)
4 ;  
"RTN","RCDPRTP",71,0)
 N DIC,X,Y
"RTN","RCDPRTP",72,0)
 S DIC(0)="QEAM",DIC=344 D ^DIC I Y<0 S RCQUIT=1 Q
"RTN","RCDPRTP",73,0)
 S RCPT=$P(Y,"^",2)
"RTN","RCDPRTP",74,0)
 Q
"RTN","RCDPRTP",75,0)
 ;
"RTN","RCDPRTP",76,0)
5 ; Select care type - added in patch 315
"RTN","RCDPRTP",77,0)
 D TYPEPIC^RCDPRTP0(.RCTYPE) I '$D(RCTYPE) S RCQUIT=1 Q
"RTN","RCDPRTP",78,0)
 Q:RCQUIT
"RTN","RCDPRTP",79,0)
 D DATESEL^RCRJRTRA("Payment")
"RTN","RCDPRTP",80,0)
 I '$G(DATESTRT)!('$G(DATEEND)) S RCQUIT=1
"RTN","RCDPRTP",81,0)
 Q
"RTN","RCDPRTP",82,0)
 ;
"RTN","RCDPRTP",83,0)
EXIT ;  
"RTN","RCDPRTP",84,0)
 K DATESTRT,DATEEND,RCEXCEL,^TMP("RCDPRTPB",$J),^TMP("IBRBT",$J)
"RTN","RCDPRTP",85,0)
 K ^TMP("IBRBT1",$J),^TMP("IBRBF",$J),^TMP("IBRBF1",$J),RCTYPE
"RTN","RCDPRTP",86,0)
 Q
"RTN","RCDPRTP",87,0)
 ;
"RTN","RCDPRTP0")
0^3^B54155958^B47346688
"RTN","RCDPRTP0",1,0)
RCDPRTP0 ;ALB/LDB - CLAIMS MATCHING REPORT ;5/24/00 10:48 AM
"RTN","RCDPRTP0",2,0)
 ;;4.5;Accounts Receivable;**151,315,339**;Mar 20, 1995;Build 2
"RTN","RCDPRTP0",3,0)
 ;;Per VA Directive 6402, this routine should not be modified.
"RTN","RCDPRTP0",4,0)
 ;
"RTN","RCDPRTP0",5,0)
PAT      ;find patient bills
"RTN","RCDPRTP0",6,0)
 S RCNAM=$$NAM^RCFN01(RCDEBT)
"RTN","RCDPRTP0",7,0)
 S RCSSN=$$SSN^RCFN01(RCDEBT)
"RTN","RCDPRTP0",8,0)
 S RCBIL=0 F  S RCBIL=$O(^PRCA(430,"E",RCDFN,RCBIL)) Q:'RCBIL  D
"RTN","RCDPRTP0",9,0)
 .I $P($G(^PRCA(430,+RCBIL,0)),"^",2)'=9 Q
"RTN","RCDPRTP0",10,0)
 .S RCPAY=0 F  S RCPAY=$O(^PRCA(433,"C",RCBIL,RCPAY)) Q:'RCPAY  D
"RTN","RCDPRTP0",11,0)
 ..S RCPAY1=$G(^PRCA(433,+RCPAY,1)) Q:RCPAY1=""
"RTN","RCDPRTP0",12,0)
 ..I "^2^34^"[("^"_$P(RCPAY1,"^",2)_"^"),($P(RCPAY1,"^",9)'<DATESTRT),($P(RCPAY1,"^",9)<(DATEEND_".999999")) D
"RTN","RCDPRTP0",13,0)
 ...S DFN=RCDFN D DEM^VADPT,ELIG^VADPT
"RTN","RCDPRTP0",14,0)
 ...S RCTYPE=$$TYP^IBRFN(RCBIL) ; added care type - 315
"RTN","RCDPRTP0",15,0)
 ...S RCTYPE=$S(RCTYPE="":-1,RCTYPE="PR":"P",RCTYPE="PH":"R",1:RCTYPE)
"RTN","RCDPRTP0",16,0)
 ...I $D(RCTYPE(RCTYPE)) D  Q:'RCTYPE
"RTN","RCDPRTP0",17,0)
 ....S ^TMP("RCDPRTPB",$J,RCNAM)=$P($G(VADM(3)),"^",2)_"^"_$P($G(VAEL(1)),"^",2)_"^"_RCSSN
"RTN","RCDPRTP0",18,0)
 ....S ^TMP("RCDPRTPB",$J,RCNAM,RCBIL)=$P($P(RCPAY1,"^",9),".")
"RTN","RCDPRTP0",19,0)
 ....K DFN,VA,VADM,VAEL,VAERR
"RTN","RCDPRTP0",20,0)
 K RCDFN,RCDEBT
"RTN","RCDPRTP0",21,0)
 Q
"RTN","RCDPRTP0",22,0)
 ;
"RTN","RCDPRTP0",23,0)
DATE     ;find third party bills by date of payments
"RTN","RCDPRTP0",24,0)
 N RCDFN,RCDEBT
"RTN","RCDPRTP0",25,0)
 F RCTYP=2,34 S DAT=$$FMADD^XLFDT(DATESTRT,-1)_".999999" F  S DAT=$O(^PRCA(433,"AT",RCTYP,DAT)) Q:'DAT!(DAT>(DATEEND_".999999"))  D
"RTN","RCDPRTP0",26,0)
 .S RCPAY=0 F  S RCPAY=$O(^PRCA(433,"AT",RCTYP,DAT,RCPAY)) Q:'RCPAY  D
"RTN","RCDPRTP0",27,0)
 ..S RCBIL=$P($G(^PRCA(433,+RCPAY,0)),"^",2)
"RTN","RCDPRTP0",28,0)
 ..S RCBIL0=$G(^PRCA(430,+RCBIL,0)) Q:RCBIL0=""
"RTN","RCDPRTP0",29,0)
 ..Q:$P(RCBIL0,"^",2)'=9
"RTN","RCDPRTP0",30,0)
 ..S RCDFN=$P(RCBIL0,"^",7)
"RTN","RCDPRTP0",31,0)
 ..S RCDEBT=$O(^RCD(340,"B",RCDFN_";DPT(",0)) Q:'RCDEBT
"RTN","RCDPRTP0",32,0)
 ..S RCNAM=$$NAM^RCFN01(RCDEBT)
"RTN","RCDPRTP0",33,0)
 ..S RCSSN=$$SSN^RCFN01(RCDEBT)
"RTN","RCDPRTP0",34,0)
 ..S DFN=RCDFN D DEM^VADPT,ELIG^VADPT
"RTN","RCDPRTP0",35,0)
 ..S ^TMP("RCDPRTPB",$J,RCNAM_"^"_RCDEBT)=$P($G(VADM(3)),"^",2)_"^"_$P($G(VAEL(1)),"^",2)_"^"_RCSSN
"RTN","RCDPRTP0",36,0)
 ..S ^TMP("RCDPRTPB",$J,RCNAM_"^"_RCDEBT,RCBIL)=$P(DAT,".")
"RTN","RCDPRTP0",37,0)
 ..K DFN,VA,VADM,VAEL,VAERR
"RTN","RCDPRTP0",38,0)
 Q
"RTN","RCDPRTP0",39,0)
 ;
"RTN","RCDPRTP0",40,0)
TYPE     ;find third party bills by care type PRCA*4.5*315
"RTN","RCDPRTP0",41,0)
 N RCDFN,RCDEBT,RCTYP
"RTN","RCDPRTP0",42,0)
 F RCTYP=2,34 S DAT=$$FMADD^XLFDT(DATESTRT,-1)_".999999" F  S DAT=$O(^PRCA(433,"AT",RCTYP,DAT)) Q:'DAT!(DAT>(DATEEND_".999999"))  D
"RTN","RCDPRTP0",43,0)
 .S RCPAY=0 F  S RCPAY=$O(^PRCA(433,"AT",RCTYP,DAT,RCPAY)) Q:'RCPAY  D
"RTN","RCDPRTP0",44,0)
 ..S RCBIL=$P($G(^PRCA(433,+RCPAY,0)),"^",2)
"RTN","RCDPRTP0",45,0)
 ..S RCBIL0=$G(^PRCA(430,+RCBIL,0)) Q:RCBIL0=""
"RTN","RCDPRTP0",46,0)
 ..Q:$P(RCBIL0,"^",2)'=9
"RTN","RCDPRTP0",47,0)
 ..S RCDFN=$P(RCBIL0,"^",7)
"RTN","RCDPRTP0",48,0)
 ..S RCDEBT=$O(^RCD(340,"B",RCDFN_";DPT(",0)) Q:'RCDEBT
"RTN","RCDPRTP0",49,0)
 ..S RCNAM=$$NAM^RCFN01(RCDEBT)
"RTN","RCDPRTP0",50,0)
 ..S RCSSN=$$SSN^RCFN01(RCDEBT)
"RTN","RCDPRTP0",51,0)
 ..S DFN=RCDFN D DEM^VADPT,ELIG^VADPT
"RTN","RCDPRTP0",52,0)
 ..S RCTYPE=$$TYP^IBRFN(RCBIL)
"RTN","RCDPRTP0",53,0)
 ..S RCTYPE=$S(RCTYPE="":-1,RCTYPE="PR":"P",RCTYPE="PH":"R",1:RCTYPE)
"RTN","RCDPRTP0",54,0)
 ..I $D(RCTYPE(RCTYPE)) D  Q:'RCTYPE
"RTN","RCDPRTP0",55,0)
 ...S ^TMP("RCDPRTPB",$J,RCNAM_"^"_RCDEBT)=$P($G(VADM(3)),"^",2)_"^"_$P($G(VAEL(1)),"^",2)_"^"_RCSSN
"RTN","RCDPRTP0",56,0)
 ...S ^TMP("RCDPRTPB",$J,RCNAM_"^"_RCDEBT,RCBIL)=$P(DAT,".")
"RTN","RCDPRTP0",57,0)
 ...K DFN,VA,VADM,VAEL,VAERR
"RTN","RCDPRTP0",58,0)
 Q
"RTN","RCDPRTP0",59,0)
BILL     ;set TMP array
"RTN","RCDPRTP0",60,0)
 S RCDEBT=$O(^RCD(340,"B",RCDFN_";DPT(",0)) Q:'RCDEBT
"RTN","RCDPRTP0",61,0)
 S RCNAM=$$NAM^RCFN01(RCDEBT)
"RTN","RCDPRTP0",62,0)
 S RCSSN=$$SSN^RCFN01(RCDEBT)
"RTN","RCDPRTP0",63,0)
 S DFN=+$G(^RCD(340,RCDEBT,0))
"RTN","RCDPRTP0",64,0)
 D DEM^VADPT,ELIG^VADPT
"RTN","RCDPRTP0",65,0)
 S RCTP=0 F  S RCTP=$O(^PRCA(433,"C",RCBILL,RCTP)) Q:'RCTP  I "^2^34^"[("^"_$P($G(^PRCA(433,+RCTP,1)),"^",2)_"^") S RCTP(0)=$P($P($G(^PRCA(433,+RCTP,1)),"^",9),".")
"RTN","RCDPRTP0",66,0)
 S ^TMP("RCDPRTPB",$J,RCNAM)=$P($G(VADM(3)),"^",2)_"^"_$P($G(VAEL(1)),"^",2)_"^"_RCSSN
"RTN","RCDPRTP0",67,0)
 S ^TMP("RCDPRTPB",$J,RCNAM,RCBILL)=RCTP
"RTN","RCDPRTP0",68,0)
 K DFN,VA,VADM,VAEL,VAERR,RCBILL,RCTP
"RTN","RCDPRTP0",69,0)
 Q
"RTN","RCDPRTP0",70,0)
 ;
"RTN","RCDPRTP0",71,0)
REC      ;find receipt payments
"RTN","RCDPRTP0",72,0)
 N RCDEBT,RCDFN,RCREC1,RCPAY1,RCBIL,RCBIL0,RCDFN,RCDEBT,RCSSN
"RTN","RCDPRTP0",73,0)
 S RCREC1=0 F  S RCREC1=$O(^PRCA(433,"AF",RCPT,RCREC1)) Q:'RCREC1  D
"RTN","RCDPRTP0",74,0)
 .S RCPAY1=$G(^PRCA(433,+RCREC1,1)) Q:RCPAY1=""
"RTN","RCDPRTP0",75,0)
 .S RCBIL=0 I "^2^34^"[("^"_$P(RCPAY1,"^",2)_"^") S RCBIL=$P($G(^PRCA(433,+RCREC1,0)),"^",2)
"RTN","RCDPRTP0",76,0)
 .Q:'RCBIL
"RTN","RCDPRTP0",77,0)
 .S RCBIL0=$G(^PRCA(430,+RCBIL,0))
"RTN","RCDPRTP0",78,0)
 .Q:$P(RCBIL0,"^",2)'=9
"RTN","RCDPRTP0",79,0)
 .S RCDFN=$P(RCBIL0,"^",7) Q:'RCDFN
"RTN","RCDPRTP0",80,0)
 .S RCDEBT=$O(^RCD(340,"B",RCDFN_";DPT(",0)) Q:'RCDEBT
"RTN","RCDPRTP0",81,0)
 .S RCSSN=$$SSN^RCFN01(RCDEBT)
"RTN","RCDPRTP0",82,0)
 .S RCNAM=$$NAM^RCFN01(RCDEBT)
"RTN","RCDPRTP0",83,0)
 .S DFN=RCDFN D DEM^VADPT,ELIG^VADPT
"RTN","RCDPRTP0",84,0)
 .S ^TMP("RCDPRTPB",$J,RCNAM_"^"_RCDEBT)=$P($G(VADM(3)),"^",2)_"^"_$P($G(VAEL(1)),"^",2)_"^"_RCSSN
"RTN","RCDPRTP0",85,0)
 .K DFN,VA,VADM,VAEL,VAERR
"RTN","RCDPRTP0",86,0)
 .S ^TMP("RCDPRTPB",$J,RCNAM_"^"_RCDEBT,RCBIL)=$P($P($G(^PRCA(433,+RCREC1,1)),"^",9),".")
"RTN","RCDPRTP0",87,0)
 Q
"RTN","RCDPRTP0",88,0)
 ;
"RTN","RCDPRTP0",89,0)
TYPEPIC(RCTYPE) ; function for user selection of care types PRCA*4.5*315
"RTN","RCDPRTP0",90,0)
 ; RCTYPE is an output array, pass by reference
"RTN","RCDPRTP0",91,0)
 ; RCTYPE(type)="" where type can be (I)npatient, (O)utpatient,(P)rosthetics or (R)x (Prescription)
"RTN","RCDPRTP0",92,0)
 ; Function value is 1 if at least 1 care type was selected, 0 otherwise
"RTN","RCDPRTP0",93,0)
 ; User can select one, all or a combination of care types.
"RTN","RCDPRTP0",94,0)
 ;
"RTN","RCDPRTP0",95,0)
 N DIR,X,Y,OK,DTOUT,DUOUT,DIRUT,DIROUT,RC
"RTN","RCDPRTP0",96,0)
 K RCTYPE
"RTN","RCDPRTP0",97,0)
 S OK=1 ; all OK default
"RTN","RCDPRTP0",98,0)
 S DIR(0)="S"
"RTN","RCDPRTP0",99,0)
 S RC=";I:Inpatient"
"RTN","RCDPRTP0",100,0)
 S RC=RC_";O:Outpatient"
"RTN","RCDPRTP0",101,0)
 S RC=RC_";P:Prosthetic"
"RTN","RCDPRTP0",102,0)
 S RC=RC_";R:Prescription"
"RTN","RCDPRTP0",103,0)
 S RC=RC_";ALL:All"
"RTN","RCDPRTP0",104,0)
 S $P(DIR(0),U,2)=RC,DIR("B")="ALL"
"RTN","RCDPRTP0",105,0)
 S DIR("A")="Select a Care Type"
"RTN","RCDPRTP0",106,0)
 W ! D ^DIR K DIR
"RTN","RCDPRTP0",107,0)
 I (Y["A") D  Q  ; all types selected so set & quit
"RTN","RCDPRTP0",108,0)
 . F X="I","O","P","R" S RCTYPE(X)=""
"RTN","RCDPRTP0",109,0)
 . Q
"RTN","RCDPRTP0",110,0)
 I $D(DIRUT)!(Y="") Q
"RTN","RCDPRTP0",111,0)
 S X=$$UP^XLFSTR(X)
"RTN","RCDPRTP0",112,0)
 S RCTYPE(X)=""                 ; Toggle back on
"RTN","RCDPRTP0",113,0)
 ; Select another type
"RTN","RCDPRTP0",114,0)
 I (Y'["A") F  D  Q:X=""!(RCQUIT)
"RTN","RCDPRTP0",115,0)
 . I ($G(DIRUT)'="") S OK=0,RCQUIT=1 Q
"RTN","RCDPRTP0",116,0)
 . S DIR(0)="SBO^I:Inpatient;O:Outpatient;P:Prosthetic;R:Prescription"
"RTN","RCDPRTP0",117,0)
 . S DIR("A")="Select another Care Type" D ^DIR K DIR
"RTN","RCDPRTP0",118,0)
 . I $G(DUOUT) W !!,"User exited with '^', quitting",! S RCQUIT=1 Q
"RTN","RCDPRTP0",119,0)
 . I $D(DIRUT) S OK=0 Q
"RTN","RCDPRTP0",120,0)
 . I (X="") Q
"RTN","RCDPRTP0",121,0)
 . S X=$$UP^XLFSTR(X)
"RTN","RCDPRTP0",122,0)
 . S RCTYPE(X)=""
"RTN","RCDPRTP0",123,0)
 . Q
"RTN","RCDPRTP0",124,0)
 I $D(DUOUT)!$D(DTOUT) S OK=0 ; exit if "^" or time-out
"RTN","RCDPRTP0",125,0)
 I '$D(RCTYPE) S OK=0 W $C(7)
"RTN","RCDPRTP0",126,0)
 Q OK
"RTN","RCDPRTP0",127,0)
 ;
"RTN","RCDPRTP0",128,0)
FORMAT(RCEXCEL) ; capture the report format from the user (normal or CSV output) PRCA*4.5*315
"RTN","RCDPRTP0",129,0)
 ; RCEXCEL=0 for normal output
"RTN","RCDPRTP0",130,0)
 ; RCEXCEL=1 (^ separated values) for Excel output
"RTN","RCDPRTP0",131,0)
 ; pass parameter by reference
"RTN","RCDPRTP0",132,0)
 ;
"RTN","RCDPRTP0",133,0)
 N DIR,X,Y,DTOUT,DUOUT,DIRUT,DIROUT
"RTN","RCDPRTP0",134,0)
 S RCEXCEL=0
"RTN","RCDPRTP0",135,0)
 S DIR("A")="Do you want to capture report data for an Excel document"
"RTN","RCDPRTP0",136,0)
 S DIR("B")="NO"
"RTN","RCDPRTP0",137,0)
 S DIR(0)="Y"
"RTN","RCDPRTP0",138,0)
 S DIR("?",1)="If you want to capture the output from this report in a ^-separated"
"RTN","RCDPRTP0",139,0)
 S DIR("?",2)="values (Excel) format, then answer YES here."
"RTN","RCDPRTP0",140,0)
 S DIR("?",3)=" "
"RTN","RCDPRTP0",141,0)
 S DIR("?")="If you just want a normal report output, then answer NO here."
"RTN","RCDPRTP0",142,0)
 W ! D ^DIR K DIR
"RTN","RCDPRTP0",143,0)
 I $D(DIRUT) S RCQUIT=1 Q 0     ; get out
"RTN","RCDPRTP0",144,0)
 S RCEXCEL=Y
"RTN","RCDPRTP0",145,0)
 Q RCEXCEL
"RTN","RCDPRTP0",146,0)
 ;
"RTN","RCDPRTP0",147,0)
DEVICE ; Device Selection for Excel output PRCA*4.5*315
"RTN","RCDPRTP0",148,0)
 ; RCEXCEL=1 for Excel ('^' separated values) output
"RTN","RCDPRTP0",149,0)
 ;
"RTN","RCDPRTP0",150,0)
 N ZTRTN,ZTDESC,ZTSAVE,POP,ZTSK,DIR,X,Y,DIRUT,DTOUT,DUOUT,DIROUT
"RTN","RCDPRTP0",151,0)
 D EXMSG
"RTN","RCDPRTP0",152,0)
 ;
"RTN","RCDPRTP0",153,0)
 S ZTRTN="PRINT^RCDPRTEX"
"RTN","RCDPRTP0",154,0)
 S ZTDESC="Claims Matching Excel Report"
"RTN","RCDPRTP0",155,0)
 S ZTSAVE("DATEEND")="",ZTSAVE("DATESTRT")="",ZTSAVE("RCQUIT")="",ZTSAVE("RCSORT")="",ZTSAVE("RCEXCEL")=""
"RTN","RCDPRTP0",156,0)
 S ZTSAVE("RCAN")="",ZTSAVE("ZTREQ")="@",ZTSAVE("^TMP(""RCDPRTPB"",$J,")=""
"RTN","RCDPRTP0",157,0)
 I RCSORT=1 S ZTSAVE("RCDEBT")="",ZTSAVE("RCDFN")="",ZTSAVE("RCTYPE*")=""
"RTN","RCDPRTP0",158,0)
 I RCSORT=2 S ZTSAVE("RCBILL")="",ZTSAVE("RCDFN")="",ZTSAVE("RCDEBT")=""
"RTN","RCDPRTP0",159,0)
 I RCSORT=4 S ZTSAVE("RCPT")=""
"RTN","RCDPRTP0",160,0)
 I RCSORT=5 S ZTSAVE("RCTYPE*")="",ZTSAVE("DATE*")=""
"RTN","RCDPRTP0",161,0)
 ;
"RTN","RCDPRTP0",162,0)
 D EN^XUTMDEVQ(ZTRTN,ZTDESC,.ZTSAVE,"QM",1) Q:POP
"RTN","RCDPRTP0",163,0)
 I $G(ZTSK) W !!,"Report compilation has started with task# ",ZTSK,".",! S DIR(0)="E" D ^DIR K DIR
"RTN","RCDPRTP0",164,0)
 Q
"RTN","RCDPRTP0",165,0)
 ;
"RTN","RCDPRTP0",166,0)
EXMSG ; - Displays the message about capturing to an Excel file format
"RTN","RCDPRTP0",167,0)
 ;
"RTN","RCDPRTP0",168,0)
 W !!?5,"This report may take a while to run. It is recommended that you Queue it."
"RTN","RCDPRTP0",169,0)
 W !!?5,"To capture as an Excel format, it is recommended that you queue this"
"RTN","RCDPRTP0",170,0)
 W !?5,"report to a spool device with margins of 256 and page length of 99999"
"RTN","RCDPRTP0",171,0)
 W !?5,"(e.g. spoolname;256;99999). This should help avoid wrapping problems."
"RTN","RCDPRTP0",172,0)
 W !!?5,"Another method would be to set up your terminal to capture the detail"
"RTN","RCDPRTP0",173,0)
 W !?5,"report data. On some terminals, this can be done by clicking on the"
"RTN","RCDPRTP0",174,0)
 W !?5,"'Tools' menu above, then click on 'Capture Incoming Data' to save to"
"RTN","RCDPRTP0",175,0)
 W !?5,"Desktop.  To avoid undesired wrapping of the data saved to the file,"
"RTN","RCDPRTP0",176,0)
 W !?5,"please enter '0;256;99999' at the 'DEVICE:' prompt.",!
"RTN","RCDPRTP0",177,0)
 Q
"RTN","RCDPRTP0",178,0)
 ;
"RTN","RCDPRTP1")
0^4^B48815425^B49619894
"RTN","RCDPRTP1",1,0)
RCDPRTP1  ;ALB/LDB - CLAIMS MATCHING REPORT (PRINT) ;1/26/01  2:56 PM
"RTN","RCDPRTP1",2,0)
 ;;4.5;Accounts Receivable;**151,169,276,284,315,339**;Mar 20, 1995;Build 2
"RTN","RCDPRTP1",3,0)
 ;;Per VA Directive 6402, this routine should not be modified.
"RTN","RCDPRTP1",4,0)
 ;
"RTN","RCDPRTP1",5,0)
EN       ; Entry point to print the Claims Matching Report.
"RTN","RCDPRTP1",6,0)
 N %,DATEDIS1,DATEDIS2,NOW,PG,RCBILL,RCAMT,RCAMT1,RCIBDAT,RCIBFN,RCNAM,RCNAM1,RCNO,RCNOW,RCDLINE,RCLINE,RCPHIT
"RTN","RCDPRTP1",7,0)
 ; PRCA*4.5*284 - Remove RCPT 'new' as this is the receipt # from user entry
"RTN","RCDPRTP1",8,0)
 N RCQ,RCSSN,RCSTAT,RCTP,X,Y
"RTN","RCDPRTP1",9,0)
 ;
"RTN","RCDPRTP1",10,0)
 ; - initialize report header variables
"RTN","RCDPRTP1",11,0)
 S PG=0
"RTN","RCDPRTP1",12,0)
 Q:RCQUIT
"RTN","RCDPRTP1",13,0)
 I RCSORT'=2,(RCSORT'=4) D
"RTN","RCDPRTP1",14,0)
 .S Y=$P(DATESTRT,".") D DD^%DT S DATEDIS1=Y
"RTN","RCDPRTP1",15,0)
 .S Y=$P(DATEEND,".") D DD^%DT S DATEDIS2=Y
"RTN","RCDPRTP1",16,0)
 D NOW^%DTC S Y=% D DD^%DT S RCNOW=$E(Y,1,18)
"RTN","RCDPRTP1",17,0)
 S RCDLINE=$TR($J("",80)," ","-")
"RTN","RCDPRTP1",18,0)
 S RCLINE=$TR($J("",80)," ","*")
"RTN","RCDPRTP1",19,0)
 ;
"RTN","RCDPRTP1",20,0)
 ; - main report loop
"RTN","RCDPRTP1",21,0)
 K ^TMP($J)
"RTN","RCDPRTP1",22,0)
 ;
"RTN","RCDPRTP1",23,0)
 I 'RCEXCEL D HDR ; initial header
"RTN","RCDPRTP1",24,0)
 S RCNO=0 ; flag to indicate at least one matching claim
"RTN","RCDPRTP1",25,0)
 ;
"RTN","RCDPRTP1",26,0)
 S RCNAM="" F  S RCNAM=$O(^TMP("RCDPRTPB",$J,RCNAM)) Q:RCNAM=""!$G(RCQ)  D
"RTN","RCDPRTP1",27,0)
 .S RCBILL=0 F  S RCBILL=$O(^TMP("RCDPRTPB",$J,RCNAM,RCBILL)) Q:'RCBILL!$G(RCQ)  D
"RTN","RCDPRTP1",28,0)
 ..S RCPHIT=0 ; flag that requires patient info to print
"RTN","RCDPRTP1",29,0)
 ..D PROC ;     process a single third party bill
"RTN","RCDPRTP1",30,0)
 ..K ^TMP("IBRBT",$J),^TMP("IBRBF",$J)
"RTN","RCDPRTP1",31,0)
 ;
"RTN","RCDPRTP1",32,0)
 I $G(RCQ) G ENQ
"RTN","RCDPRTP1",33,0)
 ;
"RTN","RCDPRTP1",34,0)
 I $O(^TMP("RCDPRTPB",$J,0))="" W !!,?18,"No matching debts." Q
"RTN","RCDPRTP1",35,0)
 ;I 'RCNO W !!,?18,"No matching debts."
"RTN","RCDPRTP1",36,0)
ENQ      ;
"RTN","RCDPRTP1",37,0)
 Q
"RTN","RCDPRTP1",38,0)
 ;
"RTN","RCDPRTP1",39,0)
 ;
"RTN","RCDPRTP1",40,0)
PROC     ; Process each third party bill for a patient.
"RTN","RCDPRTP1",41,0)
 D RELBILL^IBRFN(RCBILL)
"RTN","RCDPRTP1",42,0)
 S RCQUIT=0  ;added for care type check
"RTN","RCDPRTP1",43,0)
 ;Add code to check ^TMP("IBRBT",$J  -------------------------------------------------------------------------------for third party charges
"RTN","RCDPRTP1",44,0)
 I $D(RCTYPE)>1,$D(^TMP("IBRBT",$J)) N J S J=0 F  S J=$O(^TMP("IBRBT",$J,RCBILL,J)) Q:'J  D
"RTN","RCDPRTP1",45,0)
 . S RCTYP=$$TYP^IBRFN(J),RCTYP=$S(RCTYP="":-1,RCTYP="PR":"P",RCTYP="PH":"R",1:RCTYP)
"RTN","RCDPRTP1",46,0)
 . I '$D(RCTYPE(RCTYP)) K ^TMP("IBRBT",$J,RCBILL,J)  ;    Verify that the type is one of the selected type, if not delete the ^TMP global node for that claim
"RTN","RCDPRTP1",47,0)
 ; - quit if there are no associated first party bills
"RTN","RCDPRTP1",48,0)
 I '$O(^TMP("IBRBF",$J,0)) K ^TMP("RCDPRTPB",$J,RCNAM,RCBILL) G PROCQ
"RTN","RCDPRTP1",49,0)
 ;
"RTN","RCDPRTP1",50,0)
 S (RCAMT(0),RCAMT(1))=0
"RTN","RCDPRTP1",51,0)
 S RCTP(0)=0 F  S RCTP(0)=$O(^TMP("IBRBF",$J,RCTP(0))) Q:'RCTP(0)  S RCTP(1)=0 F  S RCTP(1)=$O(^TMP("IBRBF",$J,RCTP(0),RCTP(1))) Q:'RCTP(1)  S ^TMP($J,"IBRBF",RCTP(1),RCTP(0))=""
"RTN","RCDPRTP1",52,0)
 ; PRCA*4.5*284 - Change typo of RCPT(0)=0 to RCTP(0)=0
"RTN","RCDPRTP1",53,0)
 S RCTP(0)=0 F  S RCTP(0)=$O(^TMP($J,"IBRBF",RCTP(0))) Q:'RCTP(0)  S RCTP(1)=0 F  S RCTP(1)=$O(^TMP($J,"IBRBF",RCTP(0),RCTP(1))) Q:'RCTP(1)  D
"RTN","RCDPRTP1",54,0)
 .I RCTP(1)=RCBILL Q
"RTN","RCDPRTP1",55,0)
 .I $D(^TMP($J,"IBRBF",RCTP(0),RCBILL))!(RCTP(1)'=$O(^TMP($J,"IBRBF",RCTP(0),0))) K ^TMP("IBRBF",$J,RCTP(1),RCTP(0)),^TMP($J,"IBRBF",RCTP(0),RCTP(1)) I '$O(^TMP("IBRBF",$J,RCTP(1),0)) K ^TMP("IBRBF",$J,RCTP(1))
"RTN","RCDPRTP1",56,0)
 ;
"RTN","RCDPRTP1",57,0)
 S RCTP(0)="" F  S RCTP(0)=$O(^TMP("IBRBT",$J,RCBILL,RCTP(0))) Q:RCTP(0)=""  D
"RTN","RCDPRTP1",58,0)
 .;if associated third party has had payment also do not list twice
"RTN","RCDPRTP1",59,0)
 .I $D(^TMP("RCDPRTPB",$J,RCNAM,RCTP(0))),(RCBILL'=RCTP(0)) S RCTP(RCTP(0))=^TMP("RCDPRTPB",$J,RCNAM,RCTP(0)) K ^(RCTP(0))
"RTN","RCDPRTP1",60,0)
 .;if no prescription coverage exclude associated rx co-pay charges
"RTN","RCDPRTP1",61,0)
 .I '$P(^TMP("IBRBT",$J,RCBILL),"^") D
"RTN","RCDPRTP1",62,0)
 ..S RCTP(1)=0 F  S RCTP(1)=$O(^TMP("IBRBF",$J,RCTP(0),RCTP(1))) Q:RCTP(1)=""  I $G(^TMP("IBRBF",$J,RCTP(0),RCTP(1)))["RX" K ^TMP("IBRBF",$J,RCTP(0),RCTP(1)) I '$O(^TMP("IBRBF",$J,RCTP(0),"")) K ^TMP("IBRBF",$J,RCTP(0))
"RTN","RCDPRTP1",63,0)
 .;if duplicate charges exclude them from report
"RTN","RCDPRTP1",64,0)
 S RCTP(0)=0 F  S RCTP(0)=$O(^TMP("IBRBF",$J,RCTP(0))) Q:RCTP(0)=""  S RCTP(1)=0 F  S RCTP(1)=$O(^TMP("IBRBF",$J,RCTP(0),RCTP(1))) Q:'RCTP(1)  D
"RTN","RCDPRTP1",65,0)
 .I RCTP(0)'=RCBILL,($D(^TMP("IBRBF",$J,RCBILL,RCTP(1)))) K ^TMP("IBRBF",$J,RCTP(0),RCTP(1)) K:'$O(^TMP("IBRBF",$J,RCTP(0),0)) ^TMP("IBRBF",$J,RCTP(0))
"RTN","RCDPRTP1",66,0)
 ;
"RTN","RCDPRTP1",67,0)
 ;exclude cancelled charges if not selected to be on report
"RTN","RCDPRTP1",68,0)
 I 'RCAN D
"RTN","RCDPRTP1",69,0)
 .S RCTP(0)=0 F  S RCTP(0)=$O(^TMP("IBRBF",$J,RCTP(0))) Q:RCTP(0)=""  S RCTP(1)=0 F  S RCTP(1)=$O(^TMP("IBRBF",$J,RCTP(0),RCTP(1))) Q:'RCTP(1)  D
"RTN","RCDPRTP1",70,0)
 ..I $P(^TMP("IBRBF",$J,RCTP(0),RCTP(1)),"^",3) K ^TMP("IBRBF",$J,RCTP(0),RCTP(1)) Q
"RTN","RCDPRTP1",71,0)
 ..S RCPT(2)=$O(^PRCA(430,"B",+$P(^TMP("IBRBF",$J,RCTP(0),RCTP(1)),"^",4),0)) I ($P($G(^PRCA(430,+RCPT(2),0)),"^",8)=39)!($P($G(^PRCA(430,+RCPT(2),0)),"^",8)=26) K ^TMP("IBRBF",$J,RCTP(0),RCTP(1))
"RTN","RCDPRTP1",72,0)
 ..I '$O(^TMP("IBRBF",$J,RCTP(0),"")) K ^TMP("IBRBF",$J,RCTP(0))
"RTN","RCDPRTP1",73,0)
 I '$O(^TMP("IBRBF",$J,RCBILL,0)) K ^TMP("RCDPRTPB",$J,RCNAM,RCBILL) G PROCQ
"RTN","RCDPRTP1",74,0)
 ;
"RTN","RCDPRTP1",75,0)
 I RCEXCEL D PRNTPAT^RCDPRTEX K ^TMP($J) Q    ;Print in claims in excel format and quit
"RTN","RCDPRTP1",76,0)
 ;
"RTN","RCDPRTP1",77,0)
 ;  - print patient detail line
"RTN","RCDPRTP1",78,0)
 I 'RCPHIT S RCPHIT=1 D PRINT3^RCDPRTP2 G:$G(RCQ) PROCQ
"RTN","RCDPRTP1",79,0)
 ;
"RTN","RCDPRTP1",80,0)
 ; - print third party bills
"RTN","RCDPRTP1",81,0)
 ;    o  print the header first; need room for the header and
"RTN","RCDPRTP1",82,0)
 ;       the bill that was paid.
"RTN","RCDPRTP1",83,0)
 ;    o  print the bill that was paid.
"RTN","RCDPRTP1",84,0)
 S RCTP=RCBILL,RCIBDAT=$G(^TMP("IBRBT",$J,RCBILL,RCBILL))
"RTN","RCDPRTP1",85,0)
 I $Y>(IOSL-7) D PAUSE^RCDPRTP2 G:$G(RCQ) PROCQ D HDR
"RTN","RCDPRTP1",86,0)
 D HDR1^RCDPRTP2,PRINT1^RCDPRTP2 G:$G(RCQ) PROCQ
"RTN","RCDPRTP1",87,0)
 ;
"RTN","RCDPRTP1",88,0)
 ; PRCA*4.5*284, corrected typo of 'assoicated' to 'associated'
"RTN","RCDPRTP1",89,0)
 ; - print the other associated third party bills
"RTN","RCDPRTP1",90,0)
 S RCTP=0 F  S RCTP=$O(^TMP("IBRBT",$J,RCBILL,RCTP)) Q:'RCTP!$G(RCQ)  D
"RTN","RCDPRTP1",91,0)
 .I RCBILL=RCTP Q  ; don't reprint the bill that was paid.
"RTN","RCDPRTP1",92,0)
 .S RCIBDAT=$G(^TMP("IBRBT",$J,RCBILL,RCTP))
"RTN","RCDPRTP1",93,0)
 .I 'RCAN,($P(RCIBDAT,"^",3)) Q  ; exclude cancelled claims
"RTN","RCDPRTP1",94,0)
 .D PRINT1^RCDPRTP2
"RTN","RCDPRTP1",95,0)
 G:$G(RCQ) PROCQ
"RTN","RCDPRTP1",96,0)
 ;
"RTN","RCDPRTP1",97,0)
 ; - print the third party totals
"RTN","RCDPRTP1",98,0)
 ; PRCA*4.5*276 - adjusted header to make room for EEOB indicator '%'
"RTN","RCDPRTP1",99,0)
 I $Y>(IOSL-2) D PAUSE^RCDPRTP2 G:$G(RCQ) PROCQ D HDR W !
"RTN","RCDPRTP1",100,0)
 W !,?63,"----------",?75,"----------"
"RTN","RCDPRTP1",101,0)
 W !,?64,$J(RCAMT(0),9,2),?76,$J(RCAMT(1),9,2)
"RTN","RCDPRTP1",102,0)
 ;
"RTN","RCDPRTP1",103,0)
 ; - print the associated first party charges
"RTN","RCDPRTP1",104,0)
 ; 
"RTN","RCDPRTP1",105,0)
 ; PRCA*4.5*315  new screen for first party charges by (CARE TYPES)
"RTN","RCDPRTP1",106,0)
 ; check global node ^TMP("IBRBF",$J, all bills, all charges) --
"RTN","RCDPRTP1",107,0)
 N RCACTYP,I,J    ;Do the next section of code only if Care Types were selected - Stored in RCTYPE([care type])
"RTN","RCDPRTP1",108,0)
 ; We must loop through all Bills and First party charges for this screening
"RTN","RCDPRTP1",109,0)
 I $D(RCTYPE)>1 S I=0 F  S I=$O(^TMP("IBRBF",$J,I)) Q:'I  S J=0 F  S J=$O(^TMP("IBRBF",$J,I,J)) Q:'J  D
"RTN","RCDPRTP1",110,0)
 . S RCACTYP=$P(^TMP("IBRBF",$J,I,J),U,6) Q:RCACTYP=""  ;6th piece is Action Type
"RTN","RCDPRTP1",111,0)
 . I RCACTYP["TRICARE"!(RCACTYP["CHAMPA") Q  ;Not needed for screening 1st party charges
"RTN","RCDPRTP1",112,0)
 . I RCACTYP["RX" S RCTYP="R" D KILFPTY Q
"RTN","RCDPRTP1",113,0)
 . I RCACTYP["OPT"!(RCACTYP["OBSERV") S RCTYP="O" D KILFPTY Q
"RTN","RCDPRTP1",114,0)
 . I RCACTYP["INPT"!(RCACTYP["NHCU")!(RCACTYP["ADMIS")!(RCACTYP["MEDICARE DECUCTIBLE") S RCTYP="I" D KILFPTY Q
"RTN","RCDPRTP1",115,0)
 . Q
"RTN","RCDPRTP1",116,0)
 ;
"RTN","RCDPRTP1",117,0)
 S RCTP(0)=0 F  S RCTP(0)=$O(^TMP("IBRBF",$J,RCTP(0))) Q:'RCTP(0)!$G(RCQ)  D
"RTN","RCDPRTP1",118,0)
 .I RCTP(0)=$O(^TMP("IBRBF",$J,0)) Q:$D(^TMP("IBRBF",$J,RCTP(0)))<10  D   ;New code - quit if ^TMP("IBRBF" has no sub nodes
"RTN","RCDPRTP1",119,0)
 ..I $Y>(IOSL-5) D PAUSE^RCDPRTP2 Q:$G(RCQ)  D HDR
"RTN","RCDPRTP1",120,0)
 ..; - print the header for the first charge
"RTN","RCDPRTP1",121,0)
 ..D HDR2^RCDPRTP2
"RTN","RCDPRTP1",122,0)
 .S RCTP=0 F  S RCTP=$O(^TMP("IBRBF",$J,RCTP(0),RCTP)) Q:'RCTP!$G(RCQ)  D
"RTN","RCDPRTP1",123,0)
 ..S RCNO=1 ; set flag for at least one match
"RTN","RCDPRTP1",124,0)
 ..S RCIBDAT=$G(^TMP("IBRBF",$J,RCTP(0),RCTP))
"RTN","RCDPRTP1",125,0)
 ..; - print the patient detail line
"RTN","RCDPRTP1",126,0)
 ..I RCNO D PRINT2^RCDPRTP2
"RTN","RCDPRTP1",127,0)
 ;.
"RTN","RCDPRTP1",128,0)
 ; PRCA*4.5*284, cleanup ^TMP($J) only
"RTN","RCDPRTP1",129,0)
PROCQ  ;
"RTN","RCDPRTP1",130,0)
 K ^TMP($J) Q
"RTN","RCDPRTP1",131,0)
 ;
"RTN","RCDPRTP1",132,0)
 ;
"RTN","RCDPRTP1",133,0)
HDR      ; Print the main report header.
"RTN","RCDPRTP1",134,0)
 S PG=PG+1 I PG'=1!($E(IOST,1,2)="C-") W @IOF
"RTN","RCDPRTP1",135,0)
 W !,?5,"THIRD PARTY CLAIMS W/MATCHING FIRST PARTY DEBTS  ",RCNOW," PAGE ",PG
"RTN","RCDPRTP1",136,0)
 I RCSORT'=2,(RCSORT'=4) W !,?18,"FOR THE PAYMENT DATES: ",DATEDIS1,"  TO  ",DATEDIS2
"RTN","RCDPRTP1",137,0)
 I RCSORT=4 W !,?18,"RECEIPT NUMBER ",RCPT
"RTN","RCDPRTP1",138,0)
 W !,RCDLINE
"RTN","RCDPRTP1",139,0)
 I PG=1 D
"RTN","RCDPRTP1",140,0)
 .W !!,"Remember that any actions taken to decrease the first party receivables must"
"RTN","RCDPRTP1",141,0)
 .W !,"consider any applicable deductibles or coinsurance amounts specified on the EOB."
"RTN","RCDPRTP1",142,0)
 Q
"RTN","RCDPRTP1",143,0)
 ;
"RTN","RCDPRTP1",144,0)
 ;PRCA*4.5*315
"RTN","RCDPRTP1",145,0)
KILFPTY ;KILL 1st party associated claim from ^TMP("IBRBF", $J), used to screen out unwanted 1st party bills (wrong Care Type)
"RTN","RCDPRTP1",146,0)
 ;Verify that the type is one of the selected care types, if not delete the ^TMP global node for that charge
"RTN","RCDPRTP1",147,0)
 I '$D(RCTYPE(RCTYP)) K ^TMP("IBRBF",$J,I,J)
"RTN","RCDPRTP1",148,0)
 Q
"RTN","RCDPRTP1",149,0)
 ;
"RTN","RCTCSJR")
0^5^B124960188^B123788872
"RTN","RCTCSJR",1,0)
RCTCSJR ;ALBANY/LEG-CS DEBT REFERRAL REJECT REPORTING ;07/15/14 3:34 PM
"RTN","RCTCSJR",2,0)
 ;;4.5;Accounts Receivable;**301,315,339**;Mar 20, 1995;Build 2
"RTN","RCTCSJR",3,0)
 ;;Per VA Directive 6402, this routine should not be modified.
"RTN","RCTCSJR",4,0)
 ;
"RTN","RCTCSJR",5,0)
 Q
"RTN","RCTCSJR",6,0)
ECLIST ; prints IAI Error Codes List
"RTN","RCTCSJR",7,0)
 S DIC="^RC(348.5,",BY=.01
"RTN","RCTCSJR",8,0)
 S (FR,TO)=""
"RTN","RCTCSJR",9,0)
 S FLDS="[TCS IAI ERROR CODES LIST]"
"RTN","RCTCSJR",10,0)
 S DHD="TCS IAI ERROR CODES LIST"
"RTN","RCTCSJR",11,0)
 S DIOBEG="W !!"
"RTN","RCTCSJR",12,0)
 D EN1^DIP
"RTN","RCTCSJR",13,0)
 Q
"RTN","RCTCSJR",14,0)
 ; 
"RTN","RCTCSJR",15,0)
RJRPT ; for CS REJECT REPORT processing
"RTN","RCTCSJR",16,0)
 D INIT S STOP=0
"RTN","RCTCSJR",17,0)
 D PROMPTS Q:POP
"RTN","RCTCSJR",18,0)
 Q:STOP
"RTN","RCTCSJR",19,0)
 D HEADING,GETRECS,PRTRECS
"RTN","RCTCSJR",20,0)
 K %ZIS,ACTN,ASCDES,BILLID,BILLIEN,BLNKS,BY,CD,CDIEN,CDREC,CDSH,CHDR,CHDRS,CNTR,COLDASH,COLHDRS,COLWIDTH1,COLWIDTH2,COLWIDTH3,CWID,DASH,DATA,DATAITMS,DATE,DEBTIDX,DEBTIEN,DEBTOR,DEBTREC,DEBTREF,DEFAULT,DESC,DHD,DIOBEG
"RTN","RCTCSJR",21,0)
 K DTFRM,DTFRMTO,DTFROM,DTTO,ECDS,EXCEL,FIELD,FLDS,FR,GROUPBD,HDTITLE,I,INCLUDE,INDATE,L,LEV1,LEV2,LEV3,LEV4,LN,OUTDATE,PAGE,POP,QUIT,RPTITEMS,RPTREC,SEQ,SRC,SSN,STOP,STR,TO,TYP,UPDN,RECW1,RECW2,EXCOLH,EXSSN,CDREC1
"RTN","RCTCSJR",22,0)
 Q
"RTN","RCTCSJR",23,0)
 ;
"RTN","RCTCSJR",24,0)
INIT ;
"RTN","RCTCSJR",25,0)
 K ^TMP("RCTCSJR",$J),REC
"RTN","RCTCSJR",26,0)
 S DASH="",$P(DASH,"-",78)=""  ; (as per PRCA*4.5*315)
"RTN","RCTCSJR",27,0)
 S BLNKS="",$P(BLNKS," ",71)=""
"RTN","RCTCSJR",28,0)
 S DATAITMS="DATE^SRC^ECD(1)^ECD(2)^ECD(3)^ECD(4)^ECD(5)^ECD(6)^ECD(7)^ECD(8)^ECD(9)^TYP^ACTN"
"RTN","RCTCSJR",29,0)
 S RPTITEMS="BILLID^DEBTOR^SSN^TYP^ACTN^OUTDATE^SRC^ECDS"
"RTN","RCTCSJR",30,0)
 I $G(EXCEL) S RPTITEMS="BILLID^DEBTOR^EXSSN^TYP^ACTN^OUTDATE^SRC^ECDS^RECDET"  ;PRCA*4.5*315
"RTN","RCTCSJR",31,0)
 Q
"RTN","RCTCSJR",32,0)
 ;
"RTN","RCTCSJR",33,0)
GETRECS ;
"RTN","RCTCSJR",34,0)
 N PC,RECDET
"RTN","RCTCSJR",35,0)
 K ^TMP("RCTCSJR",$J)
"RTN","RCTCSJR",36,0)
 S (DATE,DTFRM)=$$FMADD^XLFDT(+$P(DTFRMTO,U,2),-1),DTTO=$P(DTFRMTO,U,3)
"RTN","RCTCSJR",37,0)
 F  S DATE=$O(^PRCA(430,"AB",DATE)),BILLIEN=0 Q:DATE>DTTO!'DATE  D  ;
"RTN","RCTCSJR",38,0)
 . S INDATE=DATE,OUTDATE=$$FMTE^XLFDT(DATE,"2Z")  ;Standardize dates (as per PRCA*4.5*315)
"RTN","RCTCSJR",39,0)
 . F  S BILLIEN=$O(^PRCA(430,"AB",DATE,BILLIEN)),SEQ=0 Q:BILLIEN=""  D  ;
"RTN","RCTCSJR",40,0)
 .. S BILLID=$P(^PRCA(430,BILLIEN,0),U)
"RTN","RCTCSJR",41,0)
 .. S DEBTIEN=$P(^PRCA(430,BILLIEN,0),U,9) ;33460
"RTN","RCTCSJR",42,0)
 .. S DEBTIDX=$P($G(^RCD(340,DEBTIEN,0)),U) ;777706050;DPT(
"RTN","RCTCSJR",43,0)
 .. Q:$G(DEBTIDX)=""
"RTN","RCTCSJR",44,0)
 .. S DEBTREF="^"_$P(DEBTIDX,";",2)_$P(DEBTIDX,";")_",0)"
"RTN","RCTCSJR",45,0)
 .. S DEBTREC=@(DEBTREF)
"RTN","RCTCSJR",46,0)
 .. S DEBTOR=$E($P(DEBTREC,U),1,19),SSN=$E($$SSN^RCFN01($P($G(^RCD(340,DEBTIEN,0)),"^")),6,9)  ;Last 4 of SSN only (as per PRCA*4.5*315)
"RTN","RCTCSJR",47,0)
 .. S SSN=$E($$SSN^RCFN01($P($G(^RCD(340,DEBTIEN,0)),"^")),6,9)  ;Last 4 of SSN if Excel PRCA*4.5*315
"RTN","RCTCSJR",48,0)
 .. S EXSSN=$E(DEBTOR)_$S(SSN'="":SSN,1:"    ")  ; 1st init last name, last 4 of SSN if not Excel PRCA*4.5*315
"RTN","RCTCSJR",49,0)
 .. F  S SEQ=$O(^PRCA(430,"AB",DATE,BILLIEN,SEQ)) Q:SEQ=""  D  ;
"RTN","RCTCSJR",50,0)
 ... S DATA=$G(^PRCA(430,BILLIEN,18,SEQ,0))
"RTN","RCTCSJR",51,0)
 ... Q:'$L(DATA)  ; in the event the X-REF is out of sync due to test clearing
"RTN","RCTCSJR",52,0)
 ... F PC=2,12,13 S CD=$P(DATA,U,PC),X=$P(DATAITMS,U,PC)_"="""_$S(CD="":CD,PC=2:CD,PC=12:$P($G(^RC(348.7,CD,0)),U),PC=13:$P($G(^RC(348.6,CD,0)),U),1:"")_"""",@X
"RTN","RCTCSJR",53,0)
 ... K ECD
"RTN","RCTCSJR",54,0)
 ... S ECDS=""
"RTN","RCTCSJR",55,0)
 ... F PC=3:1:11 S CD=$P(DATA,U,PC) Q:'$L(CD)  S CD=$S('$D(^RC(348.5,CD,0)):CD,1:$P(^RC(348.5,CD,0),U)) S X="S "_$P(DATAITMS,U,PC)_"="""_CD_"""" D  ;
"RTN","RCTCSJR",56,0)
 .... Q:'$D(^RC(348.5,$P(DATA,U,PC),0))!(CD="ZZ")  ; quits just in case bad error code got thru
"RTN","RCTCSJR",57,0)
 .... X X
"RTN","RCTCSJR",58,0)
 .... S ECDS=ECDS_$S(PC>3:";",1:"")_ECD(PC-2) ;Error codes new delimiter ";"
"RTN","RCTCSJR",59,0)
 ... ;  gets record layout based on RPTTYP and places into RPTTYP sorting sequence
"RTN","RCTCSJR",60,0)
 ... D @RPTTYP ;1=BILL NO.  2=DEBTOR  3=REJECT DATE
"RTN","RCTCSJR",61,0)
 ... Q  ;
"RTN","RCTCSJR",62,0)
 ... ;
"RTN","RCTCSJR",63,0)
 S LEV1="",CNTR=0
"RTN","RCTCSJR",64,0)
 K REC
"RTN","RCTCSJR",65,0)
 S UPDN=$S(ASCDES="D":-1,1:1) ; determines ASCending or DeSCending direction
"RTN","RCTCSJR",66,0)
 F  S LEV1=$O(^TMP("RCTCSJR",$J,"RPT",LEV1),UPDN),LEV2="" Q:LEV1=""  D  ;
"RTN","RCTCSJR",67,0)
 . F  S LEV2=$O(^TMP("RCTCSJR",$J,"RPT",LEV1,LEV2),UPDN),LEV3="" Q:LEV2=""  D  ;
"RTN","RCTCSJR",68,0)
 .. F  S LEV3=$O(^TMP("RCTCSJR",$J,"RPT",LEV1,LEV2,LEV3),UPDN),LEV4="" Q:LEV3=""  D  ;
"RTN","RCTCSJR",69,0)
 ... F  S LEV4=$O(^TMP("RCTCSJR",$J,"RPT",LEV1,LEV2,LEV3,LEV4),UPDN) Q:LEV4=""  D  ;
"RTN","RCTCSJR",70,0)
 .... S RPTREC=^TMP("RCTCSJR",$J,"RPT",LEV1,LEV2,LEV3,LEV4)
"RTN","RCTCSJR",71,0)
 .... I 'EXCEL S SRC=$E(RPTREC,65)
"RTN","RCTCSJR",72,0)
 .... I EXCEL S SRC=$P(RPTREC,U,7)
"RTN","RCTCSJR",73,0)
 .... I INCLUDE'="ALL",INCLUDE'=SRC Q  ; unwanted source
"RTN","RCTCSJR",74,0)
 .... S CNTR=CNTR+1
"RTN","RCTCSJR",75,0)
 .... S REC(CNTR)=$P(RPTREC,";",1,$S(EXCEL:10,1:4))
"RTN","RCTCSJR",76,0)
 .... I EXCEL S RECW1=$E(REC(CNTR),1,70),RECW2=$TR($E(REC(CNTR),71,999),"^","-"),REC(CNTR)=RECW1_RECW2
"RTN","RCTCSJR",77,0)
 .... ;Q:EXCEL  ;     only needs single line string if in Excel format
"RTN","RCTCSJR",78,0)
 .... I 'EXCEL S RECW1=$E(REC(CNTR),1,70),RECW2=$TR($E(REC(CNTR),71,999),"^",";"),REC(CNTR)=RECW1_RECW2
"RTN","RCTCSJR",79,0)
 .... I 'EXCEL,$L($P(RPTREC,";",5,8)) D
"RTN","RCTCSJR",80,0)
 ..... S CNTR=CNTR+1,REC(CNTR)=$E(BLNKS,1,67)_$P(RPTREC,";",5,8)
"RTN","RCTCSJR",81,0)
 .... I 'EXCEL,$L($P(RPTREC,";",9)) D
"RTN","RCTCSJR",82,0)
 ..... S CNTR=CNTR+1,REC(CNTR)=$E(BLNKS,1,67)_$P(RPTREC,";",9)
"RTN","RCTCSJR",83,0)
 .... I GROUPBD="D" D  ;
"RTN","RCTCSJR",84,0)
 ..... K ECD
"RTN","RCTCSJR",85,0)
 ..... S ECDS=$E(RPTREC,68,100)
"RTN","RCTCSJR",86,0)
 ..... F I=1:1:9 S ECD(I)=$P(ECDS,";",I) Q:'$L(ECD(I))  D
"RTN","RCTCSJR",87,0)
 ...... S CD=$P(ECDS,";",I),CDIEN=$O(^RC(348.5,"B",CD,0))
"RTN","RCTCSJR",88,0)
 ...... S (CDREC,CDREC1)="" I CDIEN,$D(^RC(348.5,CDIEN)) S CDREC=^RC(348.5,CDIEN,0),CDREC1=$G(^RC(348.5,CDIEN,1))
"RTN","RCTCSJR",89,0)
 ...... S (X,DESC,RECDET)="  "_CD_" - "_CDREC1
"RTN","RCTCSJR",90,0)
 ...... I $L(DESC)<81 S CNTR=CNTR+1,REC(CNTR)=X
"RTN","RCTCSJR",91,0)
 ...... ;  splits line if > 80 chars
"RTN","RCTCSJR",92,0)
 ...... I $L(DESC)>80 D  ;
"RTN","RCTCSJR",93,0)
 ....... F  S STR=$E(X,1,80) D  Q:'$L(X)  ;
"RTN","RCTCSJR",94,0)
 ........ I $L(X)<81 S CNTR=CNTR+1 S REC(CNTR)=X,X="" Q
"RTN","RCTCSJR",95,0)
 ........ F L=$L(STR):-1:1 I $F(STR," ",L) D  Q  ;
"RTN","RCTCSJR",96,0)
 ......... S CNTR=CNTR+1
"RTN","RCTCSJR",97,0)
 ......... S REC(CNTR)=$E(X,1,L),X=$E(X,L+1,999)
"RTN","RCTCSJR",98,0)
 ......... I $L(X) S X="     "_X
"RTN","RCTCSJR",99,0)
 ......... Q  ;
"RTN","RCTCSJR",100,0)
 M ^TMP("RCTCSJR",$J,"REC")=REC
"RTN","RCTCSJR",101,0)
 Q
"RTN","RCTCSJR",102,0)
 ;
"RTN","RCTCSJR",103,0)
1 ; for report by 1) Bill Number
"RTN","RCTCSJR",104,0)
 S QUIT=0
"RTN","RCTCSJR",105,0)
 I 'EXCEL D  Q:QUIT  ;
"RTN","RCTCSJR",106,0)
 . S RPTREC=""
"RTN","RCTCSJR",107,0)
 . F PC=1:1:7 D  Q:QUIT  ;
"RTN","RCTCSJR",108,0)
 .. S FIELD=$P(RPTITEMS,U,PC)
"RTN","RCTCSJR",109,0)
 .. I PC=7,INCLUDE'="ALL",@FIELD'=INCLUDE S QUIT=1 Q  ;
"RTN","RCTCSJR",110,0)
 .. S RPTREC=RPTREC_$E(@FIELD_BLNKS,1,$P(COLWIDTH1,U,PC))
"RTN","RCTCSJR",111,0)
 . F PC=8 S RPTREC=RPTREC_@$P(RPTITEMS,U,PC)
"RTN","RCTCSJR",112,0)
 I EXCEL S RPTREC=BILLID_U_DEBTOR_U_EXSSN_U_TYP_U_ACTN_U_OUTDATE_U_SRC_U_ECDS  ; PRCA*4.5*315
"RTN","RCTCSJR",113,0)
 S ^TMP("RCTCSJR",$J,"RPT",BILLID,INDATE,DEBTOR,SEQ)=RPTREC
"RTN","RCTCSJR",114,0)
 Q
"RTN","RCTCSJR",115,0)
2 ; for report by 2) Debtor Name
"RTN","RCTCSJR",116,0)
 S QUIT=0
"RTN","RCTCSJR",117,0)
 I EXCEL S RPTREC=DEBTOR_U_BILLID_U_EXSSN_U_TYP_U_ACTN_U_OUTDATE_U_SRC_U_ECDS  ; PRCA*4.5*315
"RTN","RCTCSJR",118,0)
 I 'EXCEL D  Q:QUIT  ;
"RTN","RCTCSJR",119,0)
 . S RPTREC=""
"RTN","RCTCSJR",120,0)
 . F PC=2,1,3:1:7 D  Q:QUIT  ;
"RTN","RCTCSJR",121,0)
 .. S FIELD=$P(RPTITEMS,U,PC)
"RTN","RCTCSJR",122,0)
 .. I PC=7,INCLUDE'="ALL",@FIELD'=INCLUDE S QUIT=1 Q  ;
"RTN","RCTCSJR",123,0)
 .. S RPTREC=RPTREC_$E(@FIELD_BLNKS,1,$P(COLWIDTH2,U,PC))
"RTN","RCTCSJR",124,0)
 . F PC=8 S RPTREC=RPTREC_@$P(RPTITEMS,U,PC)
"RTN","RCTCSJR",125,0)
 S ^TMP("RCTCSJR",$J,"RPT",DEBTOR,BILLID,INDATE,SEQ)=RPTREC
"RTN","RCTCSJR",126,0)
 Q
"RTN","RCTCSJR",127,0)
3 ; for report by 3) CS Reject Date
"RTN","RCTCSJR",128,0)
 S QUIT=0
"RTN","RCTCSJR",129,0)
 I EXCEL S RPTREC=OUTDATE_U_BILLID_U_DEBTOR_U_EXSSN_U_TYP_U_ACTN_U_SRC_U_ECDS  ; PRCA*4.5*315
"RTN","RCTCSJR",130,0)
 I 'EXCEL D  Q:QUIT  ;
"RTN","RCTCSJR",131,0)
 . S RPTREC=""
"RTN","RCTCSJR",132,0)
 . F PC=6,1:1:5,7 D  Q:QUIT  ;
"RTN","RCTCSJR",133,0)
 .. S FIELD=$P(RPTITEMS,U,PC)
"RTN","RCTCSJR",134,0)
 .. I PC=7,INCLUDE'="ALL",@FIELD'=INCLUDE S QUIT=1 Q  ;
"RTN","RCTCSJR",135,0)
 .. S RPTREC=RPTREC_$E(@$P(RPTITEMS,U,PC)_BLNKS,1,$P(COLWIDTH3,U,PC))
"RTN","RCTCSJR",136,0)
 . F PC=8 S RPTREC=RPTREC_@$P(RPTITEMS,U,PC)
"RTN","RCTCSJR",137,0)
 S ^TMP("RCTCSJR",$J,"RPT",INDATE,BILLID,DEBTOR,SEQ)=RPTREC
"RTN","RCTCSJR",138,0)
 Q
"RTN","RCTCSJR",139,0)
QRPT ;if queued
"RTN","RCTCSJR",140,0)
 D HEADING,GETRECS,PRTRECS
"RTN","RCTCSJR",141,0)
 Q
"RTN","RCTCSJR",142,0)
 ;
"RTN","RCTCSJR",143,0)
PRTRECS ; prints report
"RTN","RCTCSJR",144,0)
 S PAGE=0
"RTN","RCTCSJR",145,0)
 K DIRUT,DUOUT,DTOUT
"RTN","RCTCSJR",146,0)
 D HEADING,REJREPH
"RTN","RCTCSJR",147,0)
 S LN=0 F LN=1:1 Q:'$D(^TMP("RCTCSJR",$J,"REC",LN))  D  Q:$D(DIRUT)!$D(DUOUT)!$D(DTOUT)
"RTN","RCTCSJR",148,0)
 . W ^TMP("RCTCSJR",$J,"REC",LN),!
"RTN","RCTCSJR",149,0)
 . ;    check for end of page here, if necessary form feed and print header
"RTN","RCTCSJR",150,0)
 . I $Y+3>IOSL D
"RTN","RCTCSJR",151,0)
 .. I $E(IOST,1,2)="C-" S DIR(0)="E" K DIRUT D ^DIR Q:$D(DIRUT)!$D(DUOUT)!$D(DTOUT)
"RTN","RCTCSJR",152,0)
 .. D REJREPH
"RTN","RCTCSJR",153,0)
 . Q
"RTN","RCTCSJR",154,0)
 I $E(IOST,1,2)="C-" R !!,"END OF REPORT...PRESS RETURN TO CONTINUE",X:DTIME W @IOF
"RTN","RCTCSJR",155,0)
 D ^%ZISC
"RTN","RCTCSJR",156,0)
 K ^TMP("RCTCSJR",$J)
"RTN","RCTCSJR",157,0)
 I $D(ZTQUEUED) S ZTREQ="@"    ; purge the task
"RTN","RCTCSJR",158,0)
 Q
"RTN","RCTCSJR",159,0)
REJREPH ;
"RTN","RCTCSJR",160,0)
 U IO W @IOF S PAGE=PAGE+1
"RTN","RCTCSJR",161,0)
 W "PAGE "_PAGE,?10,HDTITLE,?68,$$FMTE^XLFDT(DT,"2Z")   ;Standardize the date
"RTN","RCTCSJR",162,0)
 I EXCEL W !,$TR(CHDR," ",""),! Q
"RTN","RCTCSJR",163,0)
 W !,DASH,!,CHDR,!,CDSH,! Q
"RTN","RCTCSJR",164,0)
 Q
"RTN","RCTCSJR",165,0)
COLHDR ; sets report line based on type of report
"RTN","RCTCSJR",166,0)
 S CHDR=CHDR_$P(COLHDRS,U,PC)_$S(EXCEL:"^",1:"")
"RTN","RCTCSJR",167,0)
 S CDSH=CDSH_$P(COLDASH,U,PC)_$S(EXCEL:"^",1:"")
"RTN","RCTCSJR",168,0)
 Q
"RTN","RCTCSJR",169,0)
HEADING ;  compiles info for Heading and titles for cross-servicing reject report
"RTN","RCTCSJR",170,0)
 S HDTITLE="DEBT REFERRAL REJECT REPORT (SORTED BY "_$P("BILL NO.^DEBTOR^REJ DATE",U,RPTTYP)
"RTN","RCTCSJR",171,0)
 S HDTITLE=HDTITLE_" <"_$S(ASCDES="D":"DSC",1:"ASC")_">)"
"RTN","RCTCSJR",172,0)
 ;
"RTN","RCTCSJR",173,0)
 S COLWIDTH1="12^20^9^5^5^13^3^11"  ;Change SSN to last initial last 4 only (as per PRCA*4.5*315)
"RTN","RCTCSJR",174,0)
 S COLWIDTH2="12^20^9^5^5^13^3^8",COLWIDTH3="12^20^9^5^6^12^3^11"
"RTN","RCTCSJR",175,0)
 S EXCOLH="BILL NO.^DEBTOR^Pt ID^TYP ^ACTNCD ^REJECT DATE ^SRC ^ERR CODES"
"RTN","RCTCSJR",176,0)
 S COLHDRS="BILL NO.    ^DEBTOR              ^Pt ID   ^TYP ^ACTNCD ^REJECT DATE ^SRC ^ERR CODES"
"RTN","RCTCSJR",177,0)
 S COLDASH="----------- ^------------------- ^-----   ^--- ^------ ^----------- ^--- ^---------"
"RTN","RCTCSJR",178,0)
 S (CHDR,CDSH,CWID)=""
"RTN","RCTCSJR",179,0)
 I RPTTYP=1 S CWID=COLWIDTH1,CHDR=$S(EXCEL:COLHDRS,1:$TR(COLHDRS,"^","")),CDSH=$S(EXCEL:COLDASH,1:$TR(COLDASH,"^",""))
"RTN","RCTCSJR",180,0)
 I RPTTYP=2 F PC=2,1,3:1:8 D COLHDR
"RTN","RCTCSJR",181,0)
 I RPTTYP=3 F PC=6,1:1:5,7,8 D COLHDR
"RTN","RCTCSJR",182,0)
 Q
"RTN","RCTCSJR",183,0)
PROMPTS S U="^"
"RTN","RCTCSJR",184,0)
 S STOP=0,PROMPT="*** DEBT REFERRAL REJECT REPORT ***"
"RTN","RCTCSJR",185,0)
 S DTFRMTO=$$DTFRMTO(PROMPT) I 'DTFRMTO S (STOP,POP)=1 Q
"RTN","RCTCSJR",186,0)
 ;
"RTN","RCTCSJR",187,0)
 S PROMPT="Group Error Codes:  Brief or Detail"
"RTN","RCTCSJR",188,0)
 S DIR(0)="SB^B:Brief;D:Detail"
"RTN","RCTCSJR",189,0)
 S GROUPBD=$$SELECT(PROMPT,"B") I "BD"'[GROUPBD S (STOP,POP)=1 Q
"RTN","RCTCSJR",190,0)
 ;
"RTN","RCTCSJR",191,0)
 S SET="S^1:Bill Number;2:Debtor Name;3:CS Reject Date"
"RTN","RCTCSJR",192,0)
 S RPTTYP=$$RPTTYP("Select One of the Following:",SET) I 'RPTTYP S (STOP,POP)=1 Q
"RTN","RCTCSJR",193,0)
 ;
"RTN","RCTCSJR",194,0)
 S PROMPT="Include Only: AITC, DMC, TREASURY or 'ALL'"
"RTN","RCTCSJR",195,0)
 S DIR(0)="SB^A:AITC;D:DMC;T:TREASURY;ALL:ALL",DIR("L")=PROMPT
"RTN","RCTCSJR",196,0)
 S INCLUDE=$$SELECT(PROMPT,"ALL") I "ADT"'[$E(INCLUDE) S (STOP,POP)=1 Q
"RTN","RCTCSJR",197,0)
 ;
"RTN","RCTCSJR",198,0)
 S PROMPT="Sort ASCENDING or DESCENDING",DIR(0)="SB^A:ASCENDING;D:DESCENDING"
"RTN","RCTCSJR",199,0)
 S DIR("L")=PROMPT
"RTN","RCTCSJR",200,0)
 S ASCDES=$$SELECT(PROMPT,"A") I "AD"'[ASCDES S (STOP,POP)=1 Q
"RTN","RCTCSJR",201,0)
 ;
"RTN","RCTCSJR",202,0)
 S EXCEL=0
"RTN","RCTCSJR",203,0)
 I GROUPBD="B" D
"RTN","RCTCSJR",204,0)
 . S PROMPT="CAPTURE Report data to an Excel Document"
"RTN","RCTCSJR",205,0)
 . S DIR(0)="Y",DIR("?")="^D HEXC^RCTCSJR"
"RTN","RCTCSJR",206,0)
 . S EXCEL=$$SELECT(PROMPT,"NO") I "01"'[EXCEL S (POP,STOP)=1 Q
"RTN","RCTCSJR",207,0)
 I EXCEL=1 D EXCMSG^RCTCSJR ; Display Excel display message
"RTN","RCTCSJR",208,0)
 ; 
"RTN","RCTCSJR",209,0)
 K IOP,IO("Q") S %ZIS="MQ",%ZIS("B")="" D ^%ZIS I POP S STOP=1 Q
"RTN","RCTCSJR",210,0)
 I $D(IO("Q")) D  Q
"RTN","RCTCSJR",211,0)
 .S ZTSAVE("DEBTOR")="",ZTSAVE("DTFRMTO")="",ZTSAVE("EXCEL")="",ZTSAVE("PROMPT")="",ZTSAVE("DASH")="",ZTSAVE("BLNKS")="",ZTSAVE("DATAITMS")="",ZTSAVE("RPTITEMS")=""
"RTN","RCTCSJR",212,0)
 .S ZTSAVE("GROUPBD")="",ZTSAVE("RPTTYP")="",ZTSAVE("INCLUDE")="",ZTSAVE("ASCDES")="",ZTSAVE("CHDR")="",ZTSAVE("CDSH")="",ZTSAVE("ZTASK")=""
"RTN","RCTCSJR",213,0)
 .S ZTRTN="QRPT^RCTCSJR",ZTDESC="CROSS-SERVICING BILL REPORT"
"RTN","RCTCSJR",214,0)
 .D ^%ZTLOAD,^%ZISC S (STOP,POP)=1
"RTN","RCTCSJR",215,0)
 .I $G(ZTSK) W !!,"Report compilation has started with task# ",ZTSK,".",! S DIR(0)="E" D ^DIR K DIR
"RTN","RCTCSJR",216,0)
 .Q
"RTN","RCTCSJR",217,0)
 Q  ; PROMPTS
"RTN","RCTCSJR",218,0)
 ;
"RTN","RCTCSJR",219,0)
SELECT(PROMPT,DEFAULT) ; prompts for a selection
"RTN","RCTCSJR",220,0)
 ;INPUT:
"RTN","RCTCSJR",221,0)
 ;   PROMPT - Message to display prior to prompting for dates
"RTN","RCTCSJR",222,0)
 ;OUTPUT:
"RTN","RCTCSJR",223,0)
 ;    1^BEGDT^ENDDT - Data found
"RTN","RCTCSJR",224,0)
 ;    0             - User up arrowed or timed out
"RTN","RCTCSJR",225,0)
 N Y,X,DTOUT,OUT,DIRUT,DUOUT,DIROUT
"RTN","RCTCSJR",226,0)
 S OUT=0
"RTN","RCTCSJR",227,0)
 W !
"RTN","RCTCSJR",228,0)
 S DIR("A")=PROMPT,DIR("B")=DEFAULT
"RTN","RCTCSJR",229,0)
 D ^DIR K DIR
"RTN","RCTCSJR",230,0)
 ;Quit if user time out or didn't enter valid date
"RTN","RCTCSJR",231,0)
 Q:Y<0 OUT
"RTN","RCTCSJR",232,0)
 Q Y
"RTN","RCTCSJR",233,0)
 ;
"RTN","RCTCSJR",234,0)
RPTTYP(PROMPT,SET) ;PRINT CROSS-SERVICING REPORT; print cross-servicing report, prints sorted individual bills that make up a cross-servicing account
"RTN","RCTCSJR",235,0)
 N DIC,ZTSAVE,ZTDESC,ZTRTN,RCSORT
"RTN","RCTCSJR",236,0)
 S OUT=0
"RTN","RCTCSJR",237,0)
 W !
"RTN","RCTCSJR",238,0)
 S DIR(0)=SET ;"S^1:Bill Number;2:Debtor Name;3:CS Reject Date"
"RTN","RCTCSJR",239,0)
 S DIR("A")="Sort by",DIR("B")=1 D ^DIR K DIR
"RTN","RCTCSJR",240,0)
 Q:Y<0 OUT
"RTN","RCTCSJR",241,0)
 Q Y
"RTN","RCTCSJR",242,0)
 ;
"RTN","RCTCSJR",243,0)
DTFRMTO(PROMPT) ;Get from and to dates
"RTN","RCTCSJR",244,0)
 ;INPUT:
"RTN","RCTCSJR",245,0)
 ;   PROMPT - Message to display prior to prompting for dates
"RTN","RCTCSJR",246,0)
 ;OUTPUT:
"RTN","RCTCSJR",247,0)
 ;    1^BEGDT^ENDDT - Data found
"RTN","RCTCSJR",248,0)
 ;    0             - User up arrowed or timed out
"RTN","RCTCSJR",249,0)
 ;
"RTN","RCTCSJR",250,0)
 N %DT,Y,X,BEGDT,ENDDT,DTOUT,OUT,DIRUT,DUOUT,DIROUT
"RTN","RCTCSJR",251,0)
 S OUT=0
"RTN","RCTCSJR",252,0)
 W !,$G(PROMPT)
"RTN","RCTCSJR",253,0)
 S %DT="AEX",%DT("A")="Date Range: FROM: " ;Enter Beginning Date: "
"RTN","RCTCSJR",254,0)
 S %DT("B")="T-7"
"RTN","RCTCSJR",255,0)
 W !
"RTN","RCTCSJR",256,0)
 D ^%DT K %DT
"RTN","RCTCSJR",257,0)
 Q:Y<0 OUT  ;Quit if user time out or didn't enter valid date
"RTN","RCTCSJR",258,0)
 S DTFROM=+Y
"RTN","RCTCSJR",259,0)
 S %DT="AEX"
"RTN","RCTCSJR",260,0)
 S %DT("A")="              TO:   ",%DT("B")="T" ;"TODAY"
"RTN","RCTCSJR",261,0)
 D ^%DT K %DT
"RTN","RCTCSJR",262,0)
 ;Quit if user time out or didn't enter valid date
"RTN","RCTCSJR",263,0)
 Q:Y<0 OUT
"RTN","RCTCSJR",264,0)
 S DTTO=+Y,OUT=1_U_DTFROM_U_DTTO
"RTN","RCTCSJR",265,0)
 ;Switch dates if Begin Date is more recent than End Date
"RTN","RCTCSJR",266,0)
 S:DTFROM>DTTO OUT=1_U_DTTO_U_DTFROM
"RTN","RCTCSJR",267,0)
 Q OUT
"RTN","RCTCSJR",268,0)
 ;
"RTN","RCTCSJR",269,0)
HEXC ; - 'Do you want to capture data to EXCEL' prompt
"RTN","RCTCSJR",270,0)
 W !!,"      Enter:  'Y'   -  To capture detail report data to transfer",!,"                        to an Excel document"
"RTN","RCTCSJR",271,0)
 W !,"              '<CR>' -  To skip this option",!,"              '^'    -  To quit this option"
"RTN","RCTCSJR",272,0)
 Q
"RTN","RCTCSJR",273,0)
 ;
"RTN","RCTCSJR",274,0)
EXCMSG ; - Displays the message about capturing to an Excel file format
"RTN","RCTCSJR",275,0)
 ;
"RTN","RCTCSJR",276,0)
 W !!?5,"To capture as an Excel format, it is recommended that you queue this"
"RTN","RCTCSJR",277,0)
 W !?5,"report to a spool device with margins of 256 and page length of 99999"
"RTN","RCTCSJR",278,0)
 W !?5,"(e.g. 0;256;99999). This should help avoid wrapping problems."
"RTN","RCTCSJR",279,0)
 W !!?5,"Another method would be to set up your terminal to capture the detail"
"RTN","RCTCSJR",280,0)
 W !?5,"report data. On some terminals, this can be done by invoking 'Logging'"
"RTN","RCTCSJR",281,0)
 W !?5,"or clicking on the 'Tools' menu above, then click on 'Capture Incoming "
"RTN","RCTCSJR",282,0)
 W !?5,"Data' to save to Desktop. To avoid undesired wrapping of the data saved"
"RTN","RCTCSJR",283,0)
 W !?5,"to the file, change the DISPLAY screen width size to 132 and you can"
"RTN","RCTCSJR",284,0)
 W !?5,"enter '0;256;99999' at the 'DEVICE:' prompt.",!
"RTN","RCTCSJR",285,0)
 Q
"RTN","RCTCSJR",286,0)
 ; ========================================================================
"RTN","RCTCSP1")
0^6^B172072875^B168089833
"RTN","RCTCSP1",1,0)
RCTCSP1 ;ALBANY/BDB-CROSS-SERVICING TRANSMISSION ;03/15/14 3:34 PM
"RTN","RCTCSP1",2,0)
 ;;4.5;Accounts Receivable;**301,331,315,339**;Mar 20, 1995;Build 2
"RTN","RCTCSP1",3,0)
 ;;Per VA Directive 6402, this routine should not be modified.
"RTN","RCTCSP1",4,0)
 ;
"RTN","RCTCSP1",5,0)
 ;PRCA*4.5*331 Modify code to ensure that the debtor address info
"RTN","RCTCSP1",6,0)
 ;             is correct on transmission of foreign veterans 
"RTN","RCTCSP1",7,0)
 ;             debtor/bills to Treasury.
"RTN","RCTCSP1",8,0)
 Q
"RTN","RCTCSP1",9,0)
 ;
"RTN","RCTCSP1",10,0)
BILLREP ;Cross-servicing bill report, prints individual bills that make up a cross-servicing account
"RTN","RCTCSP1",11,0)
 N DIC,DEBTOR,ZTSAVE,ZTDESC,ZTRTN,POP,DTFRMTO,PROMPT,EXCEL
"RTN","RCTCSP1",12,0)
 K ^TMP("RCTCSP1",$J)
"RTN","RCTCSP1",13,0)
 S DIC=340,DIC(0)="AEQM",DIC("S")="I $D(^RCD(340,""TCSP"",+Y))" D ^DIC
"RTN","RCTCSP1",14,0)
 Q:Y<1  S DEBTOR=+Y
"RTN","RCTCSP1",15,0)
 S DTFRMTO=$$DTFRMTO^RCTCSP2 Q:'DTFRMTO  ;Get date range as per PRCA*4.5*315
"RTN","RCTCSP1",16,0)
 S EXCEL=0,PROMPT="CAPTURE Report data to an Excel Document",DIR(0)="Y",DIR("?")="^D HEXC^RCTCSJR"
"RTN","RCTCSP1",17,0)
 S EXCEL=$$SELECT^RCTCSJR(PROMPT,"NO") I "01"'[EXCEL S STOP=1 Q
"RTN","RCTCSP1",18,0)
 I EXCEL=1 D EXCMSG^RCTCSJR ; Display Excel display message
"RTN","RCTCSP1",19,0)
 K IOP,IO("Q") S %ZIS="MQ",%ZIS("B")="" D ^%ZIS G:POP BILLREPQ S IOP=ION_";"_IOM_";"_IOSL
"RTN","RCTCSP1",20,0)
 I $D(IO("Q")) D  G BILLREPQ
"RTN","RCTCSP1",21,0)
 .S ZTSAVE("DEBTOR")="",ZTSAVE("DTFRMTO")="",ZTSAVE("EXCEL")=""
"RTN","RCTCSP1",22,0)
 .S ZTRTN="BILLREPP^RCTCSP1",ZTDESC="CROSS-SERVICING BILL REPORT"
"RTN","RCTCSP1",23,0)
 .D ^%ZTLOAD,HOME^%ZIS
"RTN","RCTCSP1",24,0)
 .I $G(ZTSK) W !!,"Report compilation has started with task# ",ZTSK,".",! S DIR(0)="E" D ^DIR K DIR
"RTN","RCTCSP1",25,0)
 .Q
"RTN","RCTCSP1",26,0)
 ;
"RTN","RCTCSP1",27,0)
BILLREPP ;Call to build array of bills referred
"RTN","RCTCSP1",28,0)
 U IO
"RTN","RCTCSP1",29,0)
 N BILL,B7,B14,B15,B16,D4,FND,BAMT,TAMT,DIRUT,TNM,TID,TDT,DASH,CSTAT,PAGE,DASH,TMP,I,DATE,DTFRM,DTTO,DATDATE
"RTN","RCTCSP1",30,0)
 K ^TMP("RCTCSP1",$J)
"RTN","RCTCSP1",31,0)
 S DASH="",$P(DASH,"-",78)=""  ;(as per PRCA*4.5*315)
"RTN","RCTCSP1",32,0)
 S (DATE,DTFRM)=$$FMADD^XLFDT(+$P(DTFRMTO,U,2)),DTTO=$P(DTFRMTO,U,3)
"RTN","RCTCSP1",33,0)
 S (BAMT,TAMT,BILL,PAGE)=0
"RTN","RCTCSP1",34,0)
 ; rewritten to sort by "TCSP" (#151 date referred to TCSP) not the "AB" xref... PRCA*4.5*315 (TV8)
"RTN","RCTCSP1",35,0)
 F  S BILL=$O(^PRCA(430,"TCSP",BILL)) Q:BILL=""!($D(DIRUT))  D
"RTN","RCTCSP1",36,0)
 .Q:$P($G(^PRCA(430,BILL,0)),U,9)'=DEBTOR
"RTN","RCTCSP1",37,0)
 .Q:'+$G(^PRCA(430,BILL,15))
"RTN","RCTCSP1",38,0)
 .S DATDATE=$P($G(^PRCA(430,BILL,15)),U) Q:DATDATE<DTFRM!(DATDATE>DTTO)
"RTN","RCTCSP1",39,0)
 .S B7=$G(^PRCA(430,BILL,7))
"RTN","RCTCSP1",40,0)
 .S BAMT=0 F I=1:1:5 S BAMT=BAMT+$P(B7,U,I)
"RTN","RCTCSP1",41,0)
 .S TAMT=TAMT+BAMT
"RTN","RCTCSP1",42,0)
 .S ^TMP("RCTCSP1",$J,DEBTOR,BILL)=BAMT
"RTN","RCTCSP1",43,0)
 D BILLREPH
"RTN","RCTCSP1",44,0)
 S DEBTOR="" F  S DEBTOR=$O(^TMP("RCTCSP1",$J,DEBTOR)) Q:'DEBTOR!($D(DIRUT))  D
"RTN","RCTCSP1",45,0)
 . S BILL=0 F  S BILL=$O(^TMP("RCTCSP1",$J,DEBTOR,BILL)) Q:'BILL  D
"RTN","RCTCSP1",46,0)
 ..Q:'+$G(^PRCA(430,BILL,15))
"RTN","RCTCSP1",47,0)
 ..S FND=1 W !,$P(^PRCA(430,BILL,0),U) S CSTAT=$P(^(0),U,8),B7=$G(^(7)),B15=$G(^(15)),B16=$G(^(16))
"RTN","RCTCSP1",48,0)
 ..I 'EXCEL W ?12,$P(^PRCA(430.3,CSTAT,0),U,2)
"RTN","RCTCSP1",49,0)
 ..I EXCEL W U_$P(^PRCA(430.3,CSTAT,0),U,2)
"RTN","RCTCSP1",50,0)
 ..I 'EXCEL W ?15
"RTN","RCTCSP1",51,0)
 ..I EXCEL W U
"RTN","RCTCSP1",52,0)
 ..W $J($P(B16,U,9),8,2)
"RTN","RCTCSP1",53,0)
 ..S BAMT=^TMP("RCTCSP1",$J,DEBTOR,BILL)
"RTN","RCTCSP1",54,0)
 ..I 'EXCEL W ?25
"RTN","RCTCSP1",55,0)
 ..I EXCEL W U
"RTN","RCTCSP1",56,0)
 ..W $J(BAMT,8,2)
"RTN","RCTCSP1",57,0)
 ..I 'EXCEL W $J($P(B7,U,1),9,2),$J($P(B7,U,2),7,2),$J($P(B7,U,3),8,2),$J($P(B7,U,4),8,2)  ;(as per PRCA*4.5*315)
"RTN","RCTCSP1",58,0)
 ..I EXCEL W $J($P(B7,U,1),8,2)_U_$J($P(B7,U,2),7,2)_U_$J($P(B7,U,3),7,2)_U_$J($P(B7,U,4),8,2)
"RTN","RCTCSP1",59,0)
 ..S TMP=$$FMTE^XLFDT($P(B15,U,1),"2Z")  ;Format date to n/n/nn  (as per PRCA*4.5*315)
"RTN","RCTCSP1",60,0)
 ..I 'EXCEL W ?67,TMP  ;$P(TMP,", ",1)_","_$P(TMP,", ",2)  ;
"RTN","RCTCSP1",61,0)
 ..I EXCEL W U_TMP
"RTN","RCTCSP1",62,0)
 ..;check for end of page here, if necessary form feed and print header
"RTN","RCTCSP1",63,0)
 ..I ($Y+3)>IOSL D
"RTN","RCTCSP1",64,0)
 ...I $E(IOST,1,2)="C-" S DIR(0)="E" K DIRUT D ^DIR Q:$D(DIRUT)
"RTN","RCTCSP1",65,0)
 ...D BILLREPH
"RTN","RCTCSP1",66,0)
 I $E(IOST,1,2)="C-" R !!,"END OF REPORT...PRESS RETURN TO CONTINUE",X:DTIME W @IOF
"RTN","RCTCSP1",67,0)
 D ^%ZISC
"RTN","RCTCSP1",68,0)
 S:$D(ZTQUEUED) ZTREQ="@"
"RTN","RCTCSP1",69,0)
 K ^TMP("RCTCSP1",$J)
"RTN","RCTCSP1",70,0)
 K IOP,%ZIS,ZTQUEUED
"RTN","RCTCSP1",71,0)
BILLREPQ Q
"RTN","RCTCSP1",72,0)
 ;
"RTN","RCTCSP1",73,0)
BILLREPH ;header for cross-servicing bill report
"RTN","RCTCSP1",74,0)
 W @IOF
"RTN","RCTCSP1",75,0)
 S PAGE=PAGE+1
"RTN","RCTCSP1",76,0)
 I 'EXCEL W "PAGE "_PAGE,?24,"CROSS-SERVICING BILL REPORT",?60,$$FMTE^XLFDT(DT,"2Z"),!,DASH
"RTN","RCTCSP1",77,0)
 I EXCEL W "PAGE "_PAGE_U_"CROSS-SERVICING BILL REPORT"_U_U_$$FMTE^XLFDT(DT,"2Z")
"RTN","RCTCSP1",78,0)
 N RCHDR,RCSSN
"RTN","RCTCSP1",79,0)
 S RCHDR=$$ACCNTHDR^RCDPAPLM(DEBTOR),RCSSN=$S($P(RCHDR,U,2)["P":$E($P(RCHDR,U,2),7,11),1:$E($P(RCHDR,U,2),6,9))  ;Pseudo SSN shouldn't be allowed but we allowed for it to print
"RTN","RCTCSP1",80,0)
 I 'EXCEL D  Q 
"RTN","RCTCSP1",81,0)
 . W !!,"DEBTOR: ",$E($P(RCHDR,U,1),1,18),?22,"SSN: ",RCSSN,?45,"CURRENT CS DEBT: ",$J(TAMT,8,2),!,DASH
"RTN","RCTCSP1",82,0)
 . W !,"BILL NO.",?12,"ST",?15,"ORIG AMT",?25,"CURR AMT",?38,"PRIN",?46,"INT",?52,"ADMIN",?60,"COURT",?67,"CS REF DT" ;(as per PRCA*4.5*315)
"RTN","RCTCSP1",83,0)
 . W !,"---- ---",?12,"--",?15,"---- ---",?25,"---- ---",?38,"----",?46,"---",?52,"-----",?60,"-----",?67,"-- -------"
"RTN","RCTCSP1",84,0)
 W !,"DEBTOR: "_$E($P(RCHDR,U,1),1,18)_U_U_"SSN: "_RCSSN_U_U_U_"CURRENT CS DEBT: "_$J(TAMT,8,2)
"RTN","RCTCSP1",85,0)
 W !,"BILL NO."_U_"ST"_U_"ORIG AMT"_U_"CURR AMT"_U_"PRIN"_U_"INT"_U_"ADMIN"_U_"COURT"_U_"CS REF DATE"
"RTN","RCTCSP1",86,0)
 Q
"RTN","RCTCSP1",87,0)
 ;
"RTN","RCTCSP1",88,0)
CSRPRT ;Print Cross-Servicing Report, prints sorted individual bills that make up a cross-servicing account
"RTN","RCTCSP1",89,0)
 ;
"RTN","RCTCSP1",90,0)
 K ^TMP("RCTCSP1",$J)
"RTN","RCTCSP1",91,0)
 N DIC,RCSORT,PAGE,DASH,DTOUT,DIRUT,DUOUT,DIROUT,RCIEN,RCDEBTOR,RCREFDT,RCSSN,RCORIG,RCCAMT,RCREFDT,RCBILL,ITEM,DBTR,SDT,SSN,NCIEN,TERMDIG
"RTN","RCTCSP1",92,0)
 S PAGE=0,DASH="",$P(DASH,"-",81)=""
"RTN","RCTCSP1",93,0)
 W !
"RTN","RCTCSP1",94,0)
 S DIR(0)="S^1:Bill Number;2:Debtor Name;3:CS Referred Date",DIR("A")="Sort by" D ^DIR K DIR
"RTN","RCTCSP1",95,0)
 S RCSORT=Y Q:($D(DTOUT)!$D(DUOUT)!$D(DIROUT))
"RTN","RCTCSP1",96,0)
 ; The following sections were rewritten to eliminate using ^DIP - (as per PRCA*4.5*315 reformat dates and SSN)
"RTN","RCTCSP1",97,0)
 S DTFRMTO=$$DTFRMTO^RCTCSP2 Q:'DTFRMTO  ;Get date range as per PRCA*4.5*315
"RTN","RCTCSP1",98,0)
 S (DATE,DTFRM)=$$FMADD^XLFDT(+$P(DTFRMTO,U,2)),DTTO=$P(DTFRMTO,U,3)
"RTN","RCTCSP1",99,0)
 S EXCEL=0,PROMPT="CAPTURE Report data to an Excel Document",DIR(0)="Y",DIR("?")="^D HEXC^RCTCSJR"
"RTN","RCTCSP1",100,0)
 S EXCEL=$$SELECT^RCTCSJR(PROMPT,"NO") I "01"'[EXCEL S STOP=1 Q
"RTN","RCTCSP1",101,0)
 I EXCEL=1 D EXCMSG^RCTCSJR ; Display Excel display message
"RTN","RCTCSP1",102,0)
 K IOP,IO("Q") S %ZIS="MQ",%ZIS("B")="" D ^%ZIS Q:POP  S IOP=ION_";"_IOM_";"_IOSL
"RTN","RCTCSP1",103,0)
 I $D(IO("Q")) D  Q
"RTN","RCTCSP1",104,0)
 .S ZTSAVE("RCSORT")="",ZTSAVE("DTFRMTO")="",ZTSAVE("EXCEL")="",ZTSAVE("PROMPT")="",ZTSAVE("PAGE")="",ZTSAVE("DASH")=""
"RTN","RCTCSP1",105,0)
 .S ZTRTN="CSRPRTR^RCTCSP1",ZTDESC="PRINT CROSS-SERVICING REPORT"
"RTN","RCTCSP1",106,0)
 .D ^%ZTLOAD,HOME^%ZIS
"RTN","RCTCSP1",107,0)
 .I $G(ZTSK) W !!,"Report compilation has started with task# ",ZTSK,".",! S DIR(0)="E" D ^DIR K DIR
"RTN","RCTCSP1",108,0)
 .Q
"RTN","RCTCSP1",109,0)
CSRPRTR ; compile/print job - either foreground or background
"RTN","RCTCSP1",110,0)
 U IO
"RTN","RCTCSP1",111,0)
 K ^TMP("RCTCSP1",$J)
"RTN","RCTCSP1",112,0)
 ;
"RTN","RCTCSP1",113,0)
 I RCSORT=1 D
"RTN","RCTCSP1",114,0)
 . D CSRPRTH1^RCTCSP1A
"RTN","RCTCSP1",115,0)
 . S (DATE,DTFRM)=$$FMADD^XLFDT(+$P(DTFRMTO,U,2)),DTTO=$P(DTFRMTO,U,3)
"RTN","RCTCSP1",116,0)
 . S RCIEN="" F  S RCIEN=$O(^PRCA(430,"TCSP",RCIEN)) Q:RCIEN=""  D
"RTN","RCTCSP1",117,0)
 .. Q:'$D(^PRCA(430,RCIEN,15))   ;cross servicing data fields
"RTN","RCTCSP1",118,0)
 ..Q:$P($G(^PRCA(430,RCIEN,15)),U)<DTFRM!($P($G(^PRCA(430,RCIEN,15)),U)>DTTO)
"RTN","RCTCSP1",119,0)
 ..K LIST,MSG,RCLIST D GETS^DIQ(430,RCIEN_",",".01;9;121,141,161;169;151;11","IE","LIST","MSG") S RCLIST=$NA(LIST(430,RCIEN_","))
"RTN","RCTCSP1",120,0)
 ..;Q:$G(@RCLIST@(141,"E"))'=""   ;Date sent to TOP
"RTN","RCTCSP1",121,0)
 ..S SSN=$E($$SSN^RCFN01(@RCLIST@(9,"I")),6,9) S SSN=$S(SSN'="":SSN,1:"     "),TERMDIG=$E(@RCLIST@(9,"E"),1)_SSN
"RTN","RCTCSP1",122,0)
 ..I EXCEL D  Q 
"RTN","RCTCSP1",123,0)
 ...S ^TMP("RCTCSP1",$J,RCIEN,@RCLIST@(.01,"E"))=@RCLIST@(.01,"E")_U_$E(@RCLIST@(9,"E"),1,19)_U_TERMDIG_U_$J(@RCLIST@(169,"E"),8,2)_U_$$FMTE^XLFDT(@RCLIST@(151,"I"),"2Z")
"RTN","RCTCSP1",124,0)
 ...S ^TMP("RCTCSP1",$J,RCIEN,@RCLIST@(.01,"E"))=^TMP("RCTCSP1",$J,RCIEN,@RCLIST@(.01,"E"))_U_$J(@RCLIST@(11,"E"),8,2)
"RTN","RCTCSP1",125,0)
 ...Q
"RTN","RCTCSP1",126,0)
 ..S ^TMP("RCTCSP1",$J,RCIEN,@RCLIST@(.01,"E"))=@RCLIST@(.01,"E")_U_$E(@RCLIST@(9,"E"),1,19)_U_SSN_U_$J(@RCLIST@(169,"E"),8,2)_U_$$FMTE^XLFDT(@RCLIST@(151,"I"),"2Z")
"RTN","RCTCSP1",127,0)
 ..S ^TMP("RCTCSP1",$J,RCIEN,@RCLIST@(.01,"E"))=^TMP("RCTCSP1",$J,RCIEN,@RCLIST@(.01,"E"))_U_$J(@RCLIST@(11,"E"),8,2)
"RTN","RCTCSP1",128,0)
 .;
"RTN","RCTCSP1",129,0)
 .; print report for sort 1
"RTN","RCTCSP1",130,0)
 .S (NCIEN,ITEM)="" F  S NCIEN=$O(^TMP("RCTCSP1",$J,NCIEN)) Q:NCIEN=""!$D(DIRUT)  F  S ITEM=$O(^TMP("RCTCSP1",$J,NCIEN,ITEM)) Q:ITEM=""!$D(DIRUT)  D  Q:$D(DIRUT)
"RTN","RCTCSP1",131,0)
 ..I EXCEL W !,$P(^TMP("RCTCSP1",$J,NCIEN,ITEM),U)_U_$P(^TMP("RCTCSP1",$J,NCIEN,ITEM),U,2)_U_$P(^TMP("RCTCSP1",$J,NCIEN,ITEM),U,3)
"RTN","RCTCSP1",132,0)
 ..I EXCEL W U_$P(^TMP("RCTCSP1",$J,NCIEN,ITEM),U,4)_U_$P(^TMP("RCTCSP1",$J,NCIEN,ITEM),U,5)_U_$P(^TMP("RCTCSP1",$J,NCIEN,ITEM),U,6)
"RTN","RCTCSP1",133,0)
 ..I EXCEL Q
"RTN","RCTCSP1",134,0)
 ..; non-Excel output
"RTN","RCTCSP1",135,0)
 ..W !,$P(^TMP("RCTCSP1",$J,NCIEN,ITEM),U),?14,$P(^TMP("RCTCSP1",$J,NCIEN,ITEM),U,2),?35,$P(^TMP("RCTCSP1",$J,NCIEN,ITEM),U,3),?43
"RTN","RCTCSP1",136,0)
 ..W $P(^TMP("RCTCSP1",$J,NCIEN,ITEM),U,4),?58,$P(^TMP("RCTCSP1",$J,NCIEN,ITEM),U,5),?68,$P(^TMP("RCTCSP1",$J,NCIEN,ITEM),U,6)
"RTN","RCTCSP1",137,0)
 ..; page break check
"RTN","RCTCSP1",138,0)
 ..I ($Y+3)>IOSL D
"RTN","RCTCSP1",139,0)
 ...I $E(IOST,1,2)="C-" S DIR(0)="E" K DIRUT D ^DIR K DIR Q:$D(DIRUT)
"RTN","RCTCSP1",140,0)
 ...D CSRPRTH1^RCTCSP1A
"RTN","RCTCSP1",141,0)
 ...Q
"RTN","RCTCSP1",142,0)
 ..Q
"RTN","RCTCSP1",143,0)
 .Q
"RTN","RCTCSP1",144,0)
 ;
"RTN","RCTCSP1",145,0)
 I RCSORT=2 D
"RTN","RCTCSP1",146,0)
 . D CSRPRTH2^RCTCSP1A
"RTN","RCTCSP1",147,0)
 . S (DATE,DTFRM)=$$FMADD^XLFDT(+$P(DTFRMTO,U,2),-1),DTTO=$P(DTFRMTO,U,3)
"RTN","RCTCSP1",148,0)
 . S RCIEN="" F  S RCIEN=$O(^PRCA(430,"TCSP",RCIEN)) Q:RCIEN=""  D
"RTN","RCTCSP1",149,0)
 ..Q:'$D(^PRCA(430,RCIEN,15))   ;cross servicing data fields
"RTN","RCTCSP1",150,0)
 ..Q:$P($G(^PRCA(430,RCIEN,15)),U)<DTFRM!($P($G(^PRCA(430,RCIEN,15)),U)>DTTO)
"RTN","RCTCSP1",151,0)
 ..K LIST,MSG,RCLIST D GETS^DIQ(430,RCIEN_",",".01;9;121,141,161;169;151;11","IE","LIST","MSG") S RCLIST=$NA(LIST(430,RCIEN_","))
"RTN","RCTCSP1",152,0)
 ..;Q:$G(@RCLIST@(121,"E"))'=""   ;Date sent to DMC
"RTN","RCTCSP1",153,0)
 ..;Q:$G(@RCLIST@(141,"E"))'=""   ;Date sent to TOP
"RTN","RCTCSP1",154,0)
 ..S SSN=$E($$SSN^RCFN01(@RCLIST@(9,"I")),6,9) S SSN=$S(SSN'="":SSN,1:"     "),TERMDIG=$E(@RCLIST@(9,"E"),1)_SSN
"RTN","RCTCSP1",155,0)
 ..I EXCEL D  Q
"RTN","RCTCSP1",156,0)
 ...S ^TMP("RCTCSP1",$J,@RCLIST@(9,"E"),RCIEN)=$E(@RCLIST@(9,"E"),1,19)_U_@RCLIST@(.01,"E")_U_TERMDIG_U_$J(@RCLIST@(169,"E"),8,2)_U_$$FMTE^XLFDT(@RCLIST@(151,"I"),"2Z")_U_$J(@RCLIST@(11,"E"),8,2) Q
"RTN","RCTCSP1",157,0)
 ..S ^TMP("RCTCSP1",$J,@RCLIST@(9,"E"),RCIEN)=$E(@RCLIST@(9,"E"),1,19)_U_@RCLIST@(.01,"E")_U_SSN_U_$J(@RCLIST@(169,"E"),8,2)_U_$$FMTE^XLFDT(@RCLIST@(151,"I"),"2Z")_U_$J(@RCLIST@(11,"E"),8,2)
"RTN","RCTCSP1",158,0)
 .;
"RTN","RCTCSP1",159,0)
 .; print report for sort 2
"RTN","RCTCSP1",160,0)
 .S (DBTR,NCIEN)="" F  S DBTR=$O(^TMP("RCTCSP1",$J,DBTR)) Q:DBTR=""!$D(DIRUT)  F  S NCIEN=$O(^TMP("RCTCSP1",$J,DBTR,NCIEN)) Q:NCIEN=""!$D(DIRUT)  D  Q:$D(DIRUT)
"RTN","RCTCSP1",161,0)
 ..I EXCEL W !,$P(^TMP("RCTCSP1",$J,DBTR,NCIEN),U,1,4)_U_$P(^TMP("RCTCSP1",$J,DBTR,NCIEN),U,5)_U_$P(^TMP("RCTCSP1",$J,DBTR,NCIEN),U,6)
"RTN","RCTCSP1",162,0)
 ..I EXCEL Q
"RTN","RCTCSP1",163,0)
 ..; non-Excel output
"RTN","RCTCSP1",164,0)
 ..W !,$P(^TMP("RCTCSP1",$J,DBTR,NCIEN),U),?21,$P(^TMP("RCTCSP1",$J,DBTR,NCIEN),U,2),?35,$P(^TMP("RCTCSP1",$J,DBTR,NCIEN),U,3),?43,$P(^TMP("RCTCSP1",$J,DBTR,NCIEN),U,4)
"RTN","RCTCSP1",165,0)
 ..W ?58,$P(^TMP("RCTCSP1",$J,DBTR,NCIEN),U,5),?68,$P(^TMP("RCTCSP1",$J,DBTR,NCIEN),U,6)
"RTN","RCTCSP1",166,0)
 ..; page break check
"RTN","RCTCSP1",167,0)
 ..I ($Y+3)>IOSL D
"RTN","RCTCSP1",168,0)
 ...I $E(IOST,1,2)="C-" S DIR(0)="E" K DIRUT D ^DIR K DIR Q:$D(DIRUT)
"RTN","RCTCSP1",169,0)
 ...D CSRPRTH2^RCTCSP1A
"RTN","RCTCSP1",170,0)
 ...Q
"RTN","RCTCSP1",171,0)
 ..Q
"RTN","RCTCSP1",172,0)
 .Q
"RTN","RCTCSP1",173,0)
 ;
"RTN","RCTCSP1",174,0)
 I RCSORT=3 D
"RTN","RCTCSP1",175,0)
 .D CSRPRTH3^RCTCSP1A
"RTN","RCTCSP1",176,0)
 .S (DATE,DTFRM)=$$FMADD^XLFDT(+$P(DTFRMTO,U,2),-1),DTTO=$P(DTFRMTO,U,3)
"RTN","RCTCSP1",177,0)
 .S RCIEN="" F  S RCIEN=$O(^PRCA(430,"TCSP",RCIEN)) Q:RCIEN=""  D
"RTN","RCTCSP1",178,0)
 ..Q:'$D(^PRCA(430,RCIEN,15))   ;cross servicing data fields
"RTN","RCTCSP1",179,0)
 ..Q:$P(^PRCA(430,RCIEN,15),U)<DTFRM!($P(^PRCA(430,RCIEN,15),U)>DTTO)
"RTN","RCTCSP1",180,0)
 ..K LIST,MSG,RCLIST D GETS^DIQ(430,RCIEN_",",".01;9;121,141,161;169;151;11","IE","LIST","MSG") S RCLIST=$NA(LIST(430,RCIEN_","))
"RTN","RCTCSP1",181,0)
 ..;Q:$G(@RCLIST@(121,"E"))'=""   ;Date sent to DMC
"RTN","RCTCSP1",182,0)
 ..;Q:$G(@RCLIST@(141,"E"))'=""   ;Date sent to TOP
"RTN","RCTCSP1",183,0)
 ..S SSN=$E($$SSN^RCFN01(@RCLIST@(9,"I")),6,9) S SSN=$S(SSN'="":SSN,1:"     "),TERMDIG=$E(@RCLIST@(9,"E"),1)_SSN
"RTN","RCTCSP1",184,0)
 ..I EXCEL S ^TMP("RCTCSP1",$J,@RCLIST@(151,"I"),RCIEN)=$$FMTE^XLFDT(@RCLIST@(151,"I"),"2Z")_U_$E(@RCLIST@(9,"E"),1,19)_U_@RCLIST@(.01,"E")_U_TERMDIG_U_$J(@RCLIST@(169,"E"),8,2)_U_$J(@RCLIST@(11,"E"),8,2)
"RTN","RCTCSP1",185,0)
 ..I 'EXCEL S ^TMP("RCTCSP1",$J,@RCLIST@(151,"I"),RCIEN)=$$FMTE^XLFDT(@RCLIST@(151,"I"),"2Z")_U_$E(@RCLIST@(9,"E"),1,19)_U_@RCLIST@(.01,"E")_U_SSN_U_$J(@RCLIST@(169,"E"),8,2)_U_$J(@RCLIST@(11,"E"),8,2)
"RTN","RCTCSP1",186,0)
 .;
"RTN","RCTCSP1",187,0)
 .; print report for sort 3
"RTN","RCTCSP1",188,0)
 .S (SDT,NCIEN)="" F  S SDT=$O(^TMP("RCTCSP1",$J,SDT)) Q:SDT=""!$D(DIRUT)  F  S NCIEN=$O(^TMP("RCTCSP1",$J,SDT,NCIEN)) Q:NCIEN=""!$D(DIRUT)  D  Q:$D(DIRUT)
"RTN","RCTCSP1",189,0)
 ..I EXCEL W !,$P(^TMP("RCTCSP1",$J,SDT,NCIEN),U)_U_$P(^TMP("RCTCSP1",$J,SDT,NCIEN),U,2)_U_$P(^TMP("RCTCSP1",$J,SDT,NCIEN),U,3)_U_$P(^TMP("RCTCSP1",$J,SDT,NCIEN),U,4)
"RTN","RCTCSP1",190,0)
 ..I EXCEL W U_$P(^TMP("RCTCSP1",$J,SDT,NCIEN),U,5)_U_$P(^TMP("RCTCSP1",$J,SDT,NCIEN),U,6)
"RTN","RCTCSP1",191,0)
 ..I EXCEL Q
"RTN","RCTCSP1",192,0)
 ..; non-Excel output
"RTN","RCTCSP1",193,0)
 ..W !,$P(^TMP("RCTCSP1",$J,SDT,NCIEN),U),?12,$P(^TMP("RCTCSP1",$J,SDT,NCIEN),U,2),?34,$P(^TMP("RCTCSP1",$J,SDT,NCIEN),U,3),?49
"RTN","RCTCSP1",194,0)
 ..W $P(^TMP("RCTCSP1",$J,SDT,NCIEN),U,4),?58,$P(^TMP("RCTCSP1",$J,SDT,NCIEN),U,5),?68,$P(^TMP("RCTCSP1",$J,SDT,NCIEN),U,6)
"RTN","RCTCSP1",195,0)
 ..; page break check
"RTN","RCTCSP1",196,0)
 ..I ($Y+3)>IOSL D
"RTN","RCTCSP1",197,0)
 ...I $E(IOST,1,2)="C-" S DIR(0)="E" K DIRUT D ^DIR K DIR Q:$D(DIRUT)
"RTN","RCTCSP1",198,0)
 ...D CSRPRTH3^RCTCSP1A
"RTN","RCTCSP1",199,0)
 ...Q
"RTN","RCTCSP1",200,0)
 ..Q
"RTN","RCTCSP1",201,0)
 .Q
"RTN","RCTCSP1",202,0)
 ;
"RTN","RCTCSP1",203,0)
 ;end of report
"RTN","RCTCSP1",204,0)
 I $E(IOST,1,2)="C-",'$D(DIRUT) R !!,"END OF REPORT...PRESS RETURN TO CONTINUE",X:DTIME W @IOF
"RTN","RCTCSP1",205,0)
 ;
"RTN","RCTCSP1",206,0)
 K ^TMP("RCTCSP1",$J)          ; kill scratch
"RTN","RCTCSP1",207,0)
 D ^%ZISC                      ; close device
"RTN","RCTCSP1",208,0)
 I $D(ZTQUEUED) S ZTREQ="@"    ; purge the task
"RTN","RCTCSP1",209,0)
 Q
"RTN","RCTCSP1",210,0)
 ;
"RTN","RCTCSP1",211,0)
REC5B ;Create record 5B for Treasury
"RTN","RCTCSP1",212,0)
 ;  trnnum     transaction number file #433 pass in
"RTN","RCTCSP1",213,0)
 ;  trntyp     transaction type pointer to 430.3
"RTN","RCTCSP1",214,0)
 ;  trntypa    aia transaction type  (aio: dmc agency internal offset, abal: decrease adjustment) 
"RTN","RCTCSP1",215,0)
 N REC,KNUM,DEBTNR,DEBTORNB,TAMOUNT,TAMTPBAL,TAMTIBAL,TAMTABAL,TAMTFBAL,TAMTCBAL,AMTRFRRD,TRNTYP,TRNTYPA,TRANSNB
"RTN","RCTCSP1",216,0)
 N AMTPBAL,AMTIBAL,AMTABAL,AMTFBAL,AMTCBAL,TRN3,TRNNUME
"RTN","RCTCSP1",217,0)
 S TRNTYPA="AIO"
"RTN","RCTCSP1",218,0)
 S REC="C5B"_ACTION_"3636001200"_"DM1D "_"L"
"RTN","RCTCSP1",219,0)
 S KNUM=$P($P(B0,U,1),"-",2)
"RTN","RCTCSP1",220,0)
 S DEBTNR=$E(SITE,1,3)_$$RJZF(KNUM,7)_$TR($J(BILL,20)," ",0),REC=REC_DEBTNR
"RTN","RCTCSP1",221,0)
 S DEBTORNB=$E(SITE,1,3)_$TR($J(DEBTOR,12)," ",0)
"RTN","RCTCSP1",222,0)
 S REC=REC_DEBTORNB
"RTN","RCTCSP1",223,0)
 S TRNTYP=$P($G(^PRCA(433,TRNNUM,1)),U,2) I ",35,73,74,"[TRNTYP S TRNTYPA="ABAL"
"RTN","RCTCSP1",224,0)
 S REC=REC_$$LJSF(TRNTYPA,9)
"RTN","RCTCSP1",225,0)
 S TRNNUME=$$RJZF(TRNNUM,10)
"RTN","RCTCSP1",226,0)
 S TRNNUME=$E(TRNNUME,5,10) ;max is 999999
"RTN","RCTCSP1",227,0)
 I TRNNUME="000000" S TRNNUME="000001" ;min is 1
"RTN","RCTCSP1",228,0)
 S REC=REC_$$RJZF(TRNNUME,10)
"RTN","RCTCSP1",229,0)
 S REC=REC_$$DATE8(DT)
"RTN","RCTCSP1",230,0)
 S TRANSNB=$E(SITE,1,3)_$TR($J(TRNNUM,12)," ",0)
"RTN","RCTCSP1",231,0)
 S REC=REC_TRANSNB
"RTN","RCTCSP1",232,0)
 S REC=REC_$$BLANK(9)
"RTN","RCTCSP1",233,0)
 S TRN3=$G(^PRCA(433,TRNNUM,3))
"RTN","RCTCSP1",234,0)
 S TAMTPBAL=$P(TRN3,U,1) ;transaction principle balance
"RTN","RCTCSP1",235,0)
 S TAMTIBAL=$P(TRN3,U,2) ;transaction interest balance
"RTN","RCTCSP1",236,0)
 S TAMTABAL=$P(TRN3,U,3) ;transaction administrative balance
"RTN","RCTCSP1",237,0)
 S TAMTFBAL=$P(TRN3,U,4) ;transaction marshal fee
"RTN","RCTCSP1",238,0)
 S TAMTCBAL=$P(TRN3,U,5) ;transaction court cost
"RTN","RCTCSP1",239,0)
 I (TAMTPBAL+TAMTIBAL+TAMTABAL+TAMTFBAL+TAMTCBAL)=0 S TAMTPBAL=TRNAMT
"RTN","RCTCSP1",240,0)
 S TAMOUNT=$$AMOUNT(TAMTPBAL,TRNTYP)
"RTN","RCTCSP1",241,0)
 S TAMOUNT=TAMOUNT_$$AMOUNT(TAMTIBAL,TRNTYP)
"RTN","RCTCSP1",242,0)
 S TAMOUNT=TAMOUNT_$$AMOUNT(TAMTABAL,TRNTYP)
"RTN","RCTCSP1",243,0)
 S TAMOUNT=TAMOUNT_$$AMOUNT(TAMTFBAL+TAMTCBAL,TRNTYP)
"RTN","RCTCSP1",244,0)
 S REC=REC_TAMOUNT
"RTN","RCTCSP1",245,0)
 S REC=REC_$$AMOUNT(TRNAMT,TRNTYP) ;315/DRF Make minus sign conditional on transaction
"RTN","RCTCSP1",246,0)
 S REC=REC_$$BLANK(450-$L(REC))
"RTN","RCTCSP1",247,0)
 S AMTPBAL=$P(B7,U,1) ;principle balance
"RTN","RCTCSP1",248,0)
 S AMTIBAL=$P(B7,U,2) ;interest balance
"RTN","RCTCSP1",249,0)
 S AMTABAL=$P(B7,U,3) ;administrative balance
"RTN","RCTCSP1",250,0)
 S AMTFBAL=$P(B7,U,4) ;marshal fee
"RTN","RCTCSP1",251,0)
 S AMTCBAL=$P(B7,U,5) ;court cost
"RTN","RCTCSP1",252,0)
 S AMTRFRRD=AMTPBAL+AMTIBAL+AMTABAL+AMTFBAL+AMTCBAL
"RTN","RCTCSP1",253,0)
 I ACTION="U" S $P(^PRCA(430,BILL,16),U,10)=AMTRFRRD
"RTN","RCTCSP1",254,0)
 S ^XTMP("RCTCSPD",$J,BILL,ACTION,"5B",TRNNUM)=REC
"RTN","RCTCSP1",255,0)
 S ^XTMP("RCTCSPD",$J,"BILL",ACTION,BILL)=$$TAXID(DEBTOR)_"^"_$S(TRNTYP=35:"-",1:"")_+$E(REC,174,184)_"."_$E(REC,185,186)
"RTN","RCTCSP1",256,0)
 Q
"RTN","RCTCSP1",257,0)
 ;
"RTN","RCTCSP1",258,0)
DATE8(X) ;changes fileman date into 8 digit date yyyymmdd
"RTN","RCTCSP1",259,0)
 I +X S X=X+17000000
"RTN","RCTCSP1",260,0)
 S X=$E(X,1,8)
"RTN","RCTCSP1",261,0)
 Q X
"RTN","RCTCSP1",262,0)
 ;
"RTN","RCTCSP1",263,0)
AMOUNT(X,TT) ;changes amount to zero filled, right justified
"RTN","RCTCSP1",264,0)
 N SIGN
"RTN","RCTCSP1",265,0)
 S X=$$SIGN(X,TT)
"RTN","RCTCSP1",266,0)
 S SIGN=$S(X<0:-1,1:1)
"RTN","RCTCSP1",267,0)
 I X<0 S X=-X
"RTN","RCTCSP1",268,0)
 S X=$TR($J(X,0,2),".")
"RTN","RCTCSP1",269,0)
 S X=$E($S(SIGN<0:"-",1:0)_"00000000000",1,14-$L(X))_X
"RTN","RCTCSP1",270,0)
 Q X
"RTN","RCTCSP1",271,0)
 ;
"RTN","RCTCSP1",272,0)
SIGN(X,TT) ;Sets sign based on value and transaction type
"RTN","RCTCSP1",273,0)
 I X=0 Q 0
"RTN","RCTCSP1",274,0)
 I X,TT=35 S X=-X
"RTN","RCTCSP1",275,0)
 Q X
"RTN","RCTCSP1",276,0)
 ;
"RTN","RCTCSP1",277,0)
BLANK(X) ;returns 'x' blank spaces
"RTN","RCTCSP1",278,0)
 N BLANK
"RTN","RCTCSP1",279,0)
 S BLANK="",$P(BLANK," ",X+1)=""
"RTN","RCTCSP1",280,0)
 Q BLANK
"RTN","RCTCSP1",281,0)
 ;
"RTN","RCTCSP1",282,0)
RJZF(X,Y) ;right justify zero fill width Y
"RTN","RCTCSP1",283,0)
 S X=$E("000000000000",1,Y-$L(X))_X
"RTN","RCTCSP1",284,0)
 Q X
"RTN","RCTCSP1",285,0)
 ;
"RTN","RCTCSP1",286,0)
LJSF(X,Y) ;left justified space filled
"RTN","RCTCSP1",287,0)
 S X=$E(X,1,Y)
"RTN","RCTCSP1",288,0)
 S X=X_$$BLANK(Y-$L(X))
"RTN","RCTCSP1",289,0)
 Q X
"RTN","RCTCSP1",290,0)
 ;
"RTN","RCTCSP1",291,0)
TAXID(DEBTOR) ;computes TAXID to place on documents
"RTN","RCTCSP1",292,0)
 N TAXID,DIC,DA,DR,DIQ
"RTN","RCTCSP1",293,0)
 S TAXID=$$SSN^RCFN01(DEBTOR)
"RTN","RCTCSP1",294,0)
 S TAXID=$$LJSF(TAXID,9)
"RTN","RCTCSP1",295,0)
 Q TAXID
"RTN","RCTCSP1",296,0)
 ;
"RTN","RCTCSP1",297,0)
ADDR(RCDFN) ; returns patient file address
"RTN","RCTCSP1",298,0)
 N DFN,ADDRCS,STATEIEN,STATEAB,VAPA
"RTN","RCTCSP1",299,0)
 S DFN=RCDFN
"RTN","RCTCSP1",300,0)
 D ADD^VADPT
"RTN","RCTCSP1",301,0)
 S STATEIEN=+VAPA(5),STATEAB=$$GET1^DIQ(5,STATEIEN,1)
"RTN","RCTCSP1",302,0)
 S ADDRCS=VAPA(1)_U_VAPA(2)_U_VAPA(4)_U_STATEAB_U_VAPA(6)_U_VAPA(8)_U_+VAPA(25)
"RTN","RCTCSP1",303,0)
 I $L(DEBTOR1)>0 I $P(DEBTOR1,U,1,5)'?1"^"."^" D
"RTN","RCTCSP1",304,0)
 .N ADDR340
"RTN","RCTCSP1",305,0)
 .S ADDR340=$P($$DADD^RCAMADD(DEBTOR),U,1,8)
"RTN","RCTCSP1",306,0)
 .I $P(ADDRCS,U,7)>1 S $P(ADDR340,U,6)="     "    ;PRCA*4.5*331
"RTN","RCTCSP1",307,0)
 .S ADDR340=$P(ADDR340,U,1,2)_"^"_$P(ADDR340,U,4,7)_U_$S($P(ADDRCS,U,7)'="":$P(ADDRCS,U,7),1:1)    ;PRCA*4.5*331
"RTN","RCTCSP1",308,0)
 .I $P(ADDR340,U,7)="" S $P(ADDR340,U,7)=$P(ADDRCS,U,7)     ;PRCA*4.5*331
"RTN","RCTCSP1",309,0)
 .I $P(ADDR340,U,7)'=1 S $P(ADDR340,U,4)="  "     ;PRCA*4.5*331
"RTN","RCTCSP1",310,0)
 .S ADDRCS=ADDR340
"RTN","RCTCSP1",311,0)
 Q ADDRCS
"RTN","RCTCSP1",312,0)
 ;
"RTN","RCTCSP1",313,0)
DEM(RCDFN) ; returns patient file gender and dob
"RTN","RCTCSP1",314,0)
 N DFN,VADM
"RTN","RCTCSP1",315,0)
 S DFN=RCDFN
"RTN","RCTCSP1",316,0)
 D DEM^VADPT
"RTN","RCTCSP1",317,0)
 ; return string   sex:m/f ^ dob: yyyymmdd ^ ssn ^ deceased
"RTN","RCTCSP1",318,0)
 Q $P(VADM(5),U,1)_U_$P(VADM(3),U,1)_U_$P(VADM(2),U,1)_U_VADM(6)
"RTN","RCTCSP1",319,0)
 ;
"RTN","RCTCSP2")
0^7^B136606046^B136461756
"RTN","RCTCSP2",1,0)
RCTCSP2 ;ALBANY/BDB-CROSS-SERVICING TRANSMISSION ;03/15/14 3:34 PM
"RTN","RCTCSP2",2,0)
 ;;4.5;Accounts Receivable;**301,315,339**;Mar 20, 1995;Build 2
"RTN","RCTCSP2",3,0)
 ;;Per VA Directive 6402, this routine should not be modified.
"RTN","RCTCSP2",4,0)
 ;
"RTN","RCTCSP2",5,0)
 Q
"RTN","RCTCSP2",6,0)
 ;
"RTN","RCTCSP2",7,0)
COMPILE ;
"RTN","RCTCSP2",8,0)
 N RCMSG,BCNTR,REC,RECC,AMOUNT,RCNTR,ACTION,SEQ
"RTN","RCTCSP2",9,0)
 S BCNTR=0,REC=0,RECC=0,AMOUNT=0,SEQ=0
"RTN","RCTCSP2",10,0)
 F  S BCNTR=$O(^XTMP("RCTCSPD",$J,BCNTR)) Q:+BCNTR'>0  D
"RTN","RCTCSP2",11,0)
 .I REC>50 D
"RTN","RCTCSP2",12,0)
 ..D TRAILER^RCTCSP1A
"RTN","RCTCSP2",13,0)
 ..D AITCMSG
"RTN","RCTCSP2",14,0)
 ..S REC=0,RECC=0
"RTN","RCTCSP2",15,0)
 ..Q
"RTN","RCTCSP2",16,0)
 .S ACTION="" F  S ACTION=$O(^XTMP("RCTCSPD",$J,BCNTR,ACTION)) Q:ACTION=""  D
"RTN","RCTCSP2",17,0)
 ..I REC=0 D HEADER^RCTCSP1A
"RTN","RCTCSP2",18,0)
 ..F RCNTR=1,2,"2A","2C",3 I $D(^XTMP("RCTCSPD",$J,BCNTR,ACTION,RCNTR)) D
"RTN","RCTCSP2",19,0)
 ...S REC=REC+1
"RTN","RCTCSP2",20,0)
 ...S RECC=RECC+1 ;record count for 'c' records on trailer record
"RTN","RCTCSP2",21,0)
 ...S ^XTMP("RCTCSPD",$J,SEQ,"BUILD",REC)=$E(^XTMP("RCTCSPD",$J,BCNTR,ACTION,RCNTR),1,225)_$C(94)
"RTN","RCTCSP2",22,0)
 ...S REC=REC+1
"RTN","RCTCSP2",23,0)
 ...S ^XTMP("RCTCSPD",$J,SEQ,"BUILD",REC)=$E(^XTMP("RCTCSPD",$J,BCNTR,ACTION,RCNTR),226,999)_$C(126)
"RTN","RCTCSP2",24,0)
 ...I $E(^XTMP("RCTCSPD",$J,BCNTR,ACTION,RCNTR),2)="1" S AMOUNT=AMOUNT+$E(^(RCNTR),91,104)
"RTN","RCTCSP2",25,0)
 ...Q
"RTN","RCTCSP2",26,0)
 ..I $D(^XTMP("RCTCSPD",$J,BCNTR,ACTION,"5B")) D
"RTN","RCTCSP2",27,0)
 ...N TRNNUM
"RTN","RCTCSP2",28,0)
 ...S TRNNUM=0
"RTN","RCTCSP2",29,0)
 ...F  S TRNNUM=$O(^XTMP("RCTCSPD",$J,BCNTR,ACTION,"5B",TRNNUM)) Q:TRNNUM'?1N.N  D
"RTN","RCTCSP2",30,0)
 ....S REC=REC+1
"RTN","RCTCSP2",31,0)
 ....S RECC=RECC+1 ;record count for 'c' records on trailer record
"RTN","RCTCSP2",32,0)
 ....S ^XTMP("RCTCSPD",$J,SEQ,"BUILD",REC)=$E(^XTMP("RCTCSPD",$J,BCNTR,ACTION,"5B",TRNNUM),1,225)_$C(94)
"RTN","RCTCSP2",33,0)
 ....S REC=REC+1
"RTN","RCTCSP2",34,0)
 ....S ^XTMP("RCTCSPD",$J,SEQ,"BUILD",REC)=$E(^XTMP("RCTCSPD",$J,BCNTR,ACTION,"5B",TRNNUM),226,999)_$C(126)
"RTN","RCTCSP2",35,0)
 ....S AMOUNT=AMOUNT+$TR($E(^XTMP("RCTCSPD",$J,BCNTR,ACTION,"5B",TRNNUM),173,186),"-")
"RTN","RCTCSP2",36,0)
 ....Q
"RTN","RCTCSP2",37,0)
 ...Q
"RTN","RCTCSP2",38,0)
 ..Q
"RTN","RCTCSP2",39,0)
 .Q
"RTN","RCTCSP2",40,0)
 D TRAILER^RCTCSP1A
"RTN","RCTCSP2",41,0)
 D AITCMSG
"RTN","RCTCSP2",42,0)
 D USRMSG
"RTN","RCTCSP2",43,0)
 Q
"RTN","RCTCSP2",44,0)
 ;
"RTN","RCTCSP2",45,0)
RCLLCHK(BILL) ;
"RTN","RCTCSP2",46,0)
 N TOTAL
"RTN","RCTCSP2",47,0)
 I $P(B15,U,7) Q 0 ;check stop tcsp referral flag
"RTN","RCTCSP2",48,0)
 I $P(B15,U,2),'$P(B15,U,3) D  ;recall bill
"RTN","RCTCSP2",49,0)
 .N ACTION,BILLCSL
"RTN","RCTCSP2",50,0)
 .S ACTION="L"
"RTN","RCTCSP2",51,0)
 .S $P(^PRCA(430,BILL,15),U,1)="" ;clear the date referred
"RTN","RCTCSP2",52,0)
 .S $P(^PRCA(430,BILL,15),U,3)=DT ;set the recall date
"RTN","RCTCSP2",53,0)
 .S $P(^PRCA(430,BILL,15),U,5)=$$GET1^DIQ(430,BILL,11) ;set the recall amount to the current amount
"RTN","RCTCSP2",54,0)
 .S B15=^PRCA(430,BILL,15)
"RTN","RCTCSP2",55,0)
 .S BILLCSL=BILL ;last cs bill
"RTN","RCTCSP2",56,0)
 .D REC1^RCTCSPD
"RTN","RCTCSP2",57,0)
 .K ^PRCA(430,"TCSP",BILL) ;set the bill to not sent to cross-servicing
"RTN","RCTCSP2",58,0)
 .D RCLL^RCTCSPD4 ; set bill recall non-financial transaction PRCA*4.5*315
"RTN","RCTCSP2",59,0)
 ;
"RTN","RCTCSP2",60,0)
 ;recall bill if total <$25
"RTN","RCTCSP2",61,0)
 S TOTAL=$P(B7,U)+$P(B7,U,2)+$P(B7,U,3)+$P(B7,U,4)+$P(B7,U,5)
"RTN","RCTCSP2",62,0)
 I TOTAL<25 D  Q 0
"RTN","RCTCSP2",63,0)
 .N X1,X2,P366DT,X,PRCAEN,I,RECALL
"RTN","RCTCSP2",64,0)
 .S RECALL=0
"RTN","RCTCSP2",65,0)
 .S X1=DT,X2=-366 D C^%DTC S P366DT=X
"RTN","RCTCSP2",66,0)
 .S PRCAEN=0 F I=0:0 S PRCAEN=$O(^PRCA(433,"C",BILL,PRCAEN)) Q:'PRCAEN  S:$P($G(^PRCA(433,PRCAEN,1)),U,1)>P366DT RECALL=1
"RTN","RCTCSP2",67,0)
 .I RECALL=0 D  Q
"RTN","RCTCSP2",68,0)
 ..S ACTION="L"
"RTN","RCTCSP2",69,0)
 ..S $P(^PRCA(430,BILL,15),U,1)="" ;clear the date referred
"RTN","RCTCSP2",70,0)
 ..S $P(^PRCA(430,BILL,15),U,2)=1 ;set the recall flag
"RTN","RCTCSP2",71,0)
 ..S $P(^PRCA(430,BILL,15),U,3)=DT ;set the recall date
"RTN","RCTCSP2",72,0)
 ..S $P(^PRCA(430,BILL,15),U,4)="07" ;set the recall reason
"RTN","RCTCSP2",73,0)
 ..S $P(^PRCA(430,BILL,15),U,5)=$P($G(^PRCA(430,BILL,16)),U,10) ;set the recall amount to the current tcsp amount
"RTN","RCTCSP2",74,0)
 ..S $P(^PRCA(430,BILL,15),U,7)=1 ;set the stop flag
"RTN","RCTCSP2",75,0)
 ..S $P(^PRCA(430,BILL,15),U,8)=DT ;set the stop date
"RTN","RCTCSP2",76,0)
 ..S $P(^PRCA(430,BILL,15),U,9)="O" ;set the stop date
"RTN","RCTCSP2",77,0)
 ..S $P(^PRCA(430,BILL,15),U,10)="AUTORECALL <$25" ;set the stop reason
"RTN","RCTCSP2",78,0)
 ..S B15=^PRCA(430,BILL,15)
"RTN","RCTCSP2",79,0)
 ..D REC1^RCTCSPD,RCLL^RCTCSPD4 ; set CS Bill Recall transaction PRCA*4.5*315
"RTN","RCTCSP2",80,0)
 ..K ^PRCA(430,"TCSP",BILL) ;set the bill to not sent to cross-servicing
"RTN","RCTCSP2",81,0)
 ..S $P(^PRCA(430,BILL,19),U,10)=1 ;stop interest admin calc
"RTN","RCTCSP2",82,0)
 ..S B19=$G(^PRCA(430,BILL,19))
"RTN","RCTCSP2",83,0)
 ..Q
"RTN","RCTCSP2",84,0)
 .Q
"RTN","RCTCSP2",85,0)
 Q 0
"RTN","RCTCSP2",86,0)
 ;
"RTN","RCTCSP2",87,0)
RCRPRT ;Reconciliation report
"RTN","RCTCSP2",88,0)
 N ZTDESC,ZTRTN,POP,%ZIS,DTFRMTO,DTFRM,DTTO,PROMPT,EXCEL,DATE
"RTN","RCTCSP2",89,0)
 S DTFRMTO=$$DTFRMTO Q:'DTFRMTO  ;Get date range as per PRCA*4.5*315
"RTN","RCTCSP2",90,0)
 S (DATE,DTFRM)=$$FMADD^XLFDT(+$P(DTFRMTO,U,2),-1),DTTO=$P(DTFRMTO,U,3),CURDT=0
"RTN","RCTCSP2",91,0)
 S EXCEL=0,PROMPT="CAPTURE Report data to an Excel Document",DIR(0)="Y",DIR("?")="^D HEXC^RCTCSJR"
"RTN","RCTCSP2",92,0)
 S EXCEL=$$SELECT^RCTCSJR(PROMPT,"NO") I "01"'[EXCEL S STOP=1 Q
"RTN","RCTCSP2",93,0)
 I EXCEL=1 D EXCMSG^RCTCSJR ; Display Excel display message
"RTN","RCTCSP2",94,0)
 K IOP,IO("Q") S %ZIS="MQ",%ZIS("B")="" D ^%ZIS Q:POP  S IOP=ION_";"_IOM_";"_IOSL
"RTN","RCTCSP2",95,0)
 I $D(IO("Q")) D  Q  ;
"RTN","RCTCSP2",96,0)
 .S ZTSAVE("DTFRMTO")="",ZTSAVE("EXCEL")=""
"RTN","RCTCSP2",97,0)
 .S ZTRTN="RCRPRTP^RCTCSP2",ZTDESC="RECONCILIATION REPORT"
"RTN","RCTCSP2",98,0)
 .D ^%ZTLOAD,HOME^%ZIS
"RTN","RCTCSP2",99,0)
 .I $G(ZTSK) W !!,"Report compilation has started with task# ",ZTSK,".",! S DIR(0)="E" D ^DIR K DIR
"RTN","RCTCSP2",100,0)
 .Q
"RTN","RCTCSP2",101,0)
 ;
"RTN","RCTCSP2",102,0)
RCRPRTP ;print the - reconciliation report, call to build array of bills returned
"RTN","RCTCSP2",103,0)
 U IO
"RTN","RCTCSP2",104,0)
 N DASH,PAGE,DBTR,DBTRN,RCOUT,CURDT,RC18,RCRTCD,BILLIEN,DATE
"RTN","RCTCSP2",105,0)
 K ^TMP("RCTCSP2",$J)
"RTN","RCTCSP2",106,0)
 S (DATE,DTFRM)=$$FMADD^XLFDT(+$P(DTFRMTO,U,2),-1),DTTO=$P(DTFRMTO,U,3),CURDT=0
"RTN","RCTCSP2",107,0)
 F  S DATE=$O(^PRCA(430,"AN",DATE)),BILLIEN=0 Q:DATE=""!(DATE>DTTO)  D  ;Use new AN xref PRCA*4.5*315
"RTN","RCTCSP2",108,0)
 . F  S BILLIEN=$O(^PRCA(430,"AN",DATE,BILLIEN)) Q:BILLIEN=""  D
"RTN","RCTCSP2",109,0)
 ..I +$P($G(^PRCA(430,BILLIEN,30)),U,1)=0 Q   ;Returned date is NULL
"RTN","RCTCSP2",110,0)
 ..S DBTR=$P($G(^PRCA(430,BILLIEN,0)),U,9),DBTRN=$$GET1^DIQ(430,BILLIEN,9)
"RTN","RCTCSP2",111,0)
 ..Q:DBTRN']""
"RTN","RCTCSP2",112,0)
 ..S ^TMP("RCTCSP2",$J,DBTRN,DBTR)=""   ; store scratch by Debtor Name, Debtor IEN
"RTN","RCTCSP2",113,0)
 S PAGE=0,RCOUT=0
"RTN","RCTCSP2",114,0)
 S DASH="",$P(DASH,"-",78)=""
"RTN","RCTCSP2",115,0)
 D RCRPRTH2
"RTN","RCTCSP2",116,0)
 ;
"RTN","RCTCSP2",117,0)
 ;New fields added in PRCA*4.5*315:
"RTN","RCTCSP2",118,0)
 ;AMTREF:(#310) REC ORIGINAL TCSP AMOUNT stored in ^PRCA(430,BILL,30), piece 10
"RTN","RCTCSP2",119,0)
 ;AMTPD:AMTREF - (#311) REC CURRENT TCSP AMOUNT stored in ^PRCA(430,BILL,30), piece 11
"RTN","RCTCSP2",120,0)
 ;AMTFEE:(#74) MARSHAL FEE
"RTN","RCTCSP2",121,0)
 ;CORDT:(#312) REC TCSP RECALL EFF. DATE stored in ^PRCA(430,BILL,30), piece 12
"RTN","RCTCSP2",122,0)
 ;DTREJ: (#172) REJECT DATE (multiple)
"RTN","RCTCSP2",123,0)
 ;See RCTCSPRS for more information on these fields
"RTN","RCTCSP2",124,0)
 ;
"RTN","RCTCSP2",125,0)
 S DBTRN=0
"RTN","RCTCSP2",126,0)
 F  S DBTRN=$O(^TMP("RCTCSP2",$J,DBTRN)) Q:DBTRN=""!RCOUT  S DBTR=0 F  S DBTR=$O(^TMP("RCTCSP2",$J,DBTRN,DBTR)) Q:'DBTR!RCOUT  D  Q:RCOUT
"RTN","RCTCSP2",127,0)
 .S BILL=0
"RTN","RCTCSP2",128,0)
 .F  S BILL=$O(^PRCA(430,"C",DBTR,BILL)) Q:BILL'?1N.N  D  Q:RCOUT
"RTN","RCTCSP2",129,0)
 ..N B0,B30,AMTREF,AMTPD,AMTFEE,DTRET,CORDT,SSN
"RTN","RCTCSP2",130,0)
 ..S B0=$G(^PRCA(430,BILL,0)),B30=$G(^PRCA(430,BILL,30))
"RTN","RCTCSP2",131,0)
 ..S AMTREF=$P(B30,U,10),AMTPD=AMTREF-$P(B30,U,11)
"RTN","RCTCSP2",132,0)
 ..I 'EXCEL S AMTFEE=$J($P($G(^PRCA(430,BILL,7)),U,4),8,2)
"RTN","RCTCSP2",133,0)
 ..I EXCEL S AMTFEE=$J($P($G(^PRCA(430,BILL,7)),U,4),5,2)
"RTN","RCTCSP2",134,0)
 ..I 'EXCEL S AMTREF=$J(AMTREF,8,2),AMTPD=$J(AMTPD,8,2)
"RTN","RCTCSP2",135,0)
 ..I EXCEL S AMTREF=$J(AMTREF,7,2),AMTPD=$J(AMTPD,7,2)
"RTN","RCTCSP2",136,0)
 ..S DEBTOR=$P(B0,U,9),SSN=$$SSN^RCFN01($P(^RCD(340,DEBTOR,0),"^")),SSN=$E(SSN,6,9)
"RTN","RCTCSP2",137,0)
 ..S CORDT=$$FMTE^XLFDT($P(B30,U,12),"2Z"),DTRET=""
"RTN","RCTCSP2",138,0)
 ..S DTRET=$P(B30,U) I DTRET S DTRET=$$FMTE^XLFDT(DTRET,"2Z")
"RTN","RCTCSP2",139,0)
 ..I +$P(B30,U,1)=0 Q
"RTN","RCTCSP2",140,0)
 ..I 'EXCEL W $E($$GET1^DIQ(430,BILL,9),1,16)
"RTN","RCTCSP2",141,0)
 ..I EXCEL W !,$E($$GET1^DIQ(430,BILL,9),1,14)
"RTN","RCTCSP2",142,0)
 ..I 'EXCEL W ?17,$P(B0,U,1),?29,SSN,?33,AMTREF,?41,AMTPD,?47,AMTFEE,?59,CORDT,?69,DTRET,!
"RTN","RCTCSP2",143,0)
 ..I EXCEL W U_$P($P(B0,U,1),"-",2)_U_SSN_U_AMTREF_U_AMTPD_U_AMTFEE_U_CORDT_U_DTRET
"RTN","RCTCSP2",144,0)
 ..S RCRTCD=$P(B30,U,2)
"RTN","RCTCSP2",145,0)
 ..I 'EXCEL D
"RTN","RCTCSP2",146,0)
 ...D  ;Display return reason code
"RTN","RCTCSP2",147,0)
 ....I RCRTCD="" W ?6,"NO RETURN REASON CODE",! Q
"RTN","RCTCSP2",148,0)
 ....W:$D(^PRCA(430.5,RCRTCD,0)) ?6,$P(^PRCA(430.5,RCRTCD,0),U,2),!
"RTN","RCTCSP2",149,0)
 ....W:'$D(^PRCA(430.5,RCRTCD,0)) ?6,"UNKNOWN RETURN REASON CODE: ",RCRTCD,!
"RTN","RCTCSP2",150,0)
 ....W:RCRTCD=14 ?7,"Compromise, Please write this bill off by the manual process",!,?8,"Amount (not collected): "_$J($P(B30,U,4),9,2),!  ;Added PRCA*4.5*315
"RTN","RCTCSP2",151,0)
 ....W:RCRTCD=2 ?8,"Date of Death:  "_$$FMTE^XLFDT($P(B30,U,7),"2Z"),!  ;date type (as per PRCA*4.5*315)
"RTN","RCTCSP2",152,0)
 ....W:RCRTCD=3 ?8,"Bankruptcy Date:  "_$$FMTE^XLFDT($P(B30,U,6),"2Z"),!
"RTN","RCTCSP2",153,0)
 ...W:+$P(B30,U,8) ?6,"Date of Dissolution:  "_$$FMTE^XLFDT($P(B30,U,8),"2Z"),!
"RTN","RCTCSP2",154,0)
 ..I EXCEL D
"RTN","RCTCSP2",155,0)
 ...I RCRTCD=14 W U_$P(^PRCA(430.5,RCRTCD,0),U,2)_U_"AMT NOT COLL"_U_$P(B30,U,4)
"RTN","RCTCSP2",156,0)
 ...I $P(B30,U,3)="Y" W U_"CP"_U_$J($P(B30,U,4),4,2) Q
"RTN","RCTCSP2",157,0)
 ...I RCRTCD=2 W U_$P(^PRCA(430.5,RCRTCD,0),U,2)_" "_$$FMTE^XLFDT($P(B30,U,7),"2Z") Q
"RTN","RCTCSP2",158,0)
 ...I RCRTCD=3 W U_$P(^PRCA(430.5,RCRTCD,0),U,2)_" "_$$FMTE^XLFDT($P(B30,U,6),"2Z") Q
"RTN","RCTCSP2",159,0)
 ...I RCRTCD]"" W U_$S($D(^PRCA(430.5,RCRTCD,0)):$$GET1^DIQ(430.5,RCRTCD,1),1:RCRTCD) Q
"RTN","RCTCSP2",160,0)
 ..;check for end of page here, if necessary form feed and print header
"RTN","RCTCSP2",161,0)
 ..I 'EXCEL W ! I ($Y+5)>IOSL D
"RTN","RCTCSP2",162,0)
 ...I $E(IOST,1,2)="C-" S DIR(0)="E" K DIRUT D ^DIR K DIR I $D(DTOUT)!($D(DUOUT)) S RCOUT=1 K X,Y,DIRUT,DTOUT,DUOUT,DIROUT Q
"RTN","RCTCSP2",163,0)
 ...D RCRPRTH2
"RTN","RCTCSP2",164,0)
 I $E(IOST,1,2)="C-" R !!,"END OF REPORT...PRESS RETURN TO CONTINUE",X:DTIME W @IOF
"RTN","RCTCSP2",165,0)
 D ^%ZISC
"RTN","RCTCSP2",166,0)
 S:$D(ZTQUEUED) ZTREQ="@"
"RTN","RCTCSP2",167,0)
 K IOP,%ZIS,ZTQUEUED
"RTN","RCTCSP2",168,0)
 K ^TMP("RCTCSP2",$J)
"RTN","RCTCSP2",169,0)
 Q
"RTN","RCTCSP2",170,0)
 ;
"RTN","RCTCSP2",171,0)
RCRPRTH2 ;header for reconciliation report print report 2
"RTN","RCTCSP2",172,0)
 W @IOF
"RTN","RCTCSP2",173,0)
 S PAGE=PAGE+1
"RTN","RCTCSP2",174,0)
 I 'EXCEL W "PAGE "_PAGE,?12,"RECONCILIATION REPORT ",?65,$$FMTE^XLFDT(DT,"2Z")
"RTN","RCTCSP2",175,0)
 I 'EXCEL D  Q 
"RTN","RCTCSP2",176,0)
 .W !,DASH
"RTN","RCTCSP2",177,0)
 .W !,"DEBTOR",?17,"BILL NO.",?29,"SSN",?34,"Amount",?42,"Amount",?51,"Amount",?59,"Recall",?69,"Date",!
"RTN","RCTCSP2",178,0)
 .W ?34,"Refer",?42,"Paid",?51,"of Fee",?59,"Eff. Dt",?69,"Return"
"RTN","RCTCSP2",179,0)
 .W !,"----------------",?17,"-----------",?29,"----",?34,"-------",?42,"-------",?51,"------",?59,"--------",?69,"--------",!
"RTN","RCTCSP2",180,0)
 ;EXCEL FORMAT
"RTN","RCTCSP2",181,0)
 W "PAGE "_PAGE_U_"RECONCILIATION REPORT "_U_$$FMTE^XLFDT(DT,"2Z")
"RTN","RCTCSP2",182,0)
 W !,"DEBTOR"_U_"BILL #"_U_"Pt ID"_U_"AMT REF"_U_"AMT PD"_U_"AMT FEE"_U_"DT RPT"_U_"DT RET"_U_"COMMENT"
"RTN","RCTCSP2",183,0)
 Q
"RTN","RCTCSP2",184,0)
 ;
"RTN","RCTCSP2",185,0)
AITCMSG ;
"RTN","RCTCSP2",186,0)
 N XMY,XMDUZ,XMSUB,XMTEXT,CNTLID,SYSTYP
"RTN","RCTCSP2",187,0)
 S SYSTYP=$$PROD^XUPROD(1)
"RTN","RCTCSP2",188,0)
 S CNTLID=$$JD^RCTCSP1A()_$$RJZF^RCTCSP1(SEQ,4)
"RTN","RCTCSP2",189,0)
 S XMDUZ="AR PACKAGE"
"RTN","RCTCSP2",190,0)
 I SYSTYP S XMY("XXX@Q-TPC.DOMAIN.EXT")=""
"RTN","RCTCSP2",191,0)
 I 'SYSTYP S XMY("XXX@Q-TXC.DOMAIN.EXT")=""
"RTN","RCTCSP2",192,0)
 S XMY("G.TCSP")=""
"RTN","RCTCSP2",193,0)
 S XMSUB=SITE_"/CS TRANSMISSION/BATCH#: "_CNTLID
"RTN","RCTCSP2",194,0)
 S XMTEXT="^XTMP(""RCTCSPD"","_$J_","""_SEQ_""",""BUILD"","
"RTN","RCTCSP2",195,0)
 D ^XMD
"RTN","RCTCSP2",196,0)
 Q
"RTN","RCTCSP2",197,0)
 ;
"RTN","RCTCSP2",198,0)
USRMSG ;sends mailman message of documents sent to user
"RTN","RCTCSP2",199,0)
 N XMY,XMDUZ,XMSUB,XMTEXT,X,RCNT,RCDAT1,RCDAT2
"RTN","RCTCSP2",200,0)
 S ACTION="" F  S ACTION=$O(^XTMP("RCTCSPD",$J,"BILL",ACTION)) Q:ACTION=""  D
"RTN","RCTCSP2",201,0)
 .K ^XTMP("RCTCSPD",$J,"BILL","MSG")
"RTN","RCTCSP2",202,0)
 .S XMDUZ="AR PACKAGE"
"RTN","RCTCSP2",203,0)
 .S XMY("G.TCSP")=""
"RTN","RCTCSP2",204,0)
 .S XMSUB="CS "_$S(ACTION="A":"ADD REFERRAL",ACTION="U":"UPDATES",ACTION="L":"RECALLS",ACTION="B":"EXISTING DEBTOR",1:"UNKNOWN")_" SENT ON "_$E(DT,4,5)_"/"_$E(DT,6,7)_"/"_$E(DT,2,3)_" BATCH ID: "_CNTLID
"RTN","RCTCSP2",205,0)
 .S ^XTMP("RCTCSPD",$J,"BILL","MSG",1)="Bill#                             TIN        TYPE       AMOUNT"
"RTN","RCTCSP2",206,0)
 .S ^XTMP("RCTCSPD",$J,"BILL","MSG",2)="-----                             ---        ----       ------"
"RTN","RCTCSP2",207,0)
 .S X=0,RCNT=2 F  S X=$O(^XTMP("RCTCSPD",$J,"BILL",ACTION,X)) Q:X=""  D
"RTN","RCTCSP2",208,0)
 ..S RCNT=RCNT+1
"RTN","RCTCSP2",209,0)
 ..S RCDAT1=$P(^XTMP("RCTCSPD",$J,"BILL",ACTION,X),U,1)
"RTN","RCTCSP2",210,0)
 ..S RCDAT2=$P(^XTMP("RCTCSPD",$J,"BILL",ACTION,X),U,2)
"RTN","RCTCSP2",211,0)
 ..S ^XTMP("RCTCSPD",$J,"BILL","MSG",RCNT)=$$RJZF($P($G(^PRCA(430,X,0)),U,1),7)_$$BLANK(22)_RCDAT1_"     "_ACTION_"        "_$S(RCDAT2]"":RCDAT2,1:"")
"RTN","RCTCSP2",212,0)
 ..Q
"RTN","RCTCSP2",213,0)
 .S ^XTMP("RCTCSPD",$J,"BILL","MSG",RCNT+1)="Total Bills: "_(RCNT-2)
"RTN","RCTCSP2",214,0)
 .S XMTEXT="^XTMP(""RCTCSPD"","_$J_",""BILL"",""MSG"","
"RTN","RCTCSP2",215,0)
 .D ^XMD
"RTN","RCTCSP2",216,0)
 .K ^XTMP("RCTCSPD",$J,"BILL","MSG")
"RTN","RCTCSP2",217,0)
 Q
"RTN","RCTCSP2",218,0)
 ;
"RTN","RCTCSP2",219,0)
THIRD ;sends mailman message to user if no third letter found
"RTN","RCTCSP2",220,0)
 Q:'$D(^XTMP("RCTCSPD",$J,"THIRD"))
"RTN","RCTCSP2",221,0)
 N XMY,XMDUZ,XMSUB,XMTEXT
"RTN","RCTCSP2",222,0)
 S XMDUZ="AR PACKAGE"
"RTN","RCTCSP2",223,0)
 S XMY("G.TCSP")=""
"RTN","RCTCSP2",224,0)
 N TCT,TDEB,TDEB0,TBIL,TSP,FST
"RTN","RCTCSP2",225,0)
 S XMSUB="TCSP QUALIFIED/NO 3RD LETTER SENT ON "_$E(DT,4,5)_"/"_$E(DT,6,7)_"/"_$E(DT,2,3)
"RTN","RCTCSP2",226,0)
 S ^XTMP("RCTCSPD",$J,"THIRD",1)="The following list of debtor bills were not sent to TCSP."
"RTN","RCTCSP2",227,0)
 S ^XTMP("RCTCSPD",$J,"THIRD",2)="Please review debtor's account to determine why the third"
"RTN","RCTCSP2",228,0)
 S ^XTMP("RCTCSPD",$J,"THIRD",3)="notice letter has not been sent:"
"RTN","RCTCSP2",229,0)
 S ^XTMP("RCTCSPD",$J,"THIRD",4)="Name                               Bill #"
"RTN","RCTCSP2",230,0)
 S ^XTMP("RCTCSPD",$J,"THIRD",5)="----                               ------"
"RTN","RCTCSP2",231,0)
 S TCT=6,TSP=0,TDEB=""
"RTN","RCTCSP2",232,0)
 F  S TDEB=$O(^XTMP("RCTCSPD",$J,"THIRD",TDEB)) Q:TDEB=""  D
"RTN","RCTCSP2",233,0)
 .S FST=1,TBIL=""
"RTN","RCTCSP2",234,0)
 .I FST,TCT'=6 S ^XTMP("RCTCSPD",$J,"THIRD",TCT)="",TCT=TCT+1,TSP=TSP+1
"RTN","RCTCSP2",235,0)
 .F  S TBIL=$O(^XTMP("RCTCSPD",$J,"THIRD",TDEB,TBIL)) Q:TBIL=""  D
"RTN","RCTCSP2",236,0)
 ..S TDEB0=$S(FST:TDEB,1:"")
"RTN","RCTCSP2",237,0)
 ..S ^XTMP("RCTCSPD",$J,"THIRD",TCT)=TDEB0_$J(" ",35-$L(TDEB0))_TBIL
"RTN","RCTCSP2",238,0)
 ..S TCT=TCT+1,FST=0
"RTN","RCTCSP2",239,0)
 S ^XTMP("RCTCSPD",$J,"THIRD",TCT)="Total records: "_(TCT-(6+TSP))
"RTN","RCTCSP2",240,0)
 S XMTEXT="^XTMP(""RCTCSPD"","_$J_",""THIRD"","
"RTN","RCTCSP2",241,0)
 D ^XMD
"RTN","RCTCSP2",242,0)
 K ^XTMP("RCTCSPD",$J,"THIRD")
"RTN","RCTCSP2",243,0)
THIRDQ Q
"RTN","RCTCSP2",244,0)
 ;
"RTN","RCTCSP2",245,0)
REC3 ;
"RTN","RCTCSP2",246,0)
 N REC,KNUM,DEBTNR,DEBTORNB
"RTN","RCTCSP2",247,0)
 S REC="C3 "_ACTION_"3636001200"_"DM1D "
"RTN","RCTCSP2",248,0)
 S KNUM=$P($P(B0,U,1),"-",2)
"RTN","RCTCSP2",249,0)
 S DEBTNR=$E(SITE,1,3)_$$LJZF(KNUM,7)_$TR($J(BILL,20)," ",0),REC=REC_DEBTNR
"RTN","RCTCSP2",250,0)
 S DEBTORNB=$E(SITE,1,3)_$TR($J(DEBTOR,12)," ",0)
"RTN","RCTCSP2",251,0)
 S REC=REC_DEBTORNB
"RTN","RCTCSP2",252,0)
 S REC=REC_$S(ACTION="L":"15",1:"  ")
"RTN","RCTCSP2",253,0)
 S REC=REC_"SLF"
"RTN","RCTCSP2",254,0)
 S REC=REC_$$BLANK(8)
"RTN","RCTCSP2",255,0)
 S REC=REC_$$AMOUNT(0)
"RTN","RCTCSP2",256,0)
 S REC=REC_$$BLANK(16)
"RTN","RCTCSP2",257,0)
 S REC=REC_"SLFIND"
"RTN","RCTCSP2",258,0)
 S REC=REC_$$BLANK(450-$L(REC))
"RTN","RCTCSP2",259,0)
 S ^XTMP("RCTCSPD",$J,BILL,ACTION,3)=REC
"RTN","RCTCSP2",260,0)
 S $P(^XTMP("RCTCSPD",$J,"BILL",ACTION,BILL),U,1)=$$TAXID(DEBTOR)
"RTN","RCTCSP2",261,0)
 Q
"RTN","RCTCSP2",262,0)
 ;
"RTN","RCTCSP2",263,0)
DATE8(X) ;changes fileman date into 8 digit date yyyymmdd
"RTN","RCTCSP2",264,0)
 I +X S X=X+17000000
"RTN","RCTCSP2",265,0)
 S X=$E(X,1,8)
"RTN","RCTCSP2",266,0)
 Q X
"RTN","RCTCSP2",267,0)
 ;
"RTN","RCTCSP2",268,0)
AMOUNT(X) ;changes amount to zero filled, right justified
"RTN","RCTCSP2",269,0)
 S:X<0 X=-X
"RTN","RCTCSP2",270,0)
 S X=$TR($J(X,0,2),".")
"RTN","RCTCSP2",271,0)
 S X=$E("000000000000",1,14-$L(X))_X
"RTN","RCTCSP2",272,0)
 Q X
"RTN","RCTCSP2",273,0)
 ;
"RTN","RCTCSP2",274,0)
BLANK(X) ;returns 'x' blank spaces
"RTN","RCTCSP2",275,0)
 N BLANK
"RTN","RCTCSP2",276,0)
 S BLANK="",$P(BLANK," ",X+1)=""
"RTN","RCTCSP2",277,0)
 Q BLANK
"RTN","RCTCSP2",278,0)
 ;
"RTN","RCTCSP2",279,0)
RJZF(X,Y) ;right justify zero fill width Y
"RTN","RCTCSP2",280,0)
 S X=$E("000000000000",1,Y-$L(X))_X
"RTN","RCTCSP2",281,0)
 Q X
"RTN","RCTCSP2",282,0)
 ;
"RTN","RCTCSP2",283,0)
LJSF(X,Y) ;left justified space filled
"RTN","RCTCSP2",284,0)
 S X=$E(X,1,Y)
"RTN","RCTCSP2",285,0)
 S X=X_$$BLANK(Y-$L(X))
"RTN","RCTCSP2",286,0)
 Q X
"RTN","RCTCSP2",287,0)
 ;
"RTN","RCTCSP2",288,0)
LJZF(X,Y) ;x left justified, y zero filled
"RTN","RCTCSP2",289,0)
 S X=X_"0000000000"
"RTN","RCTCSP2",290,0)
 S X=$E(X,X,Y)
"RTN","RCTCSP2",291,0)
 Q X
"RTN","RCTCSP2",292,0)
 ;
"RTN","RCTCSP2",293,0)
TAXID(DEBTOR) ;computes TAXID to place on documents
"RTN","RCTCSP2",294,0)
 N TAXID,DIC,DA,DR,DIQ
"RTN","RCTCSP2",295,0)
 S TAXID=$$SSN^RCFN01(DEBTOR)
"RTN","RCTCSP2",296,0)
 S TAXID=$$LJSF(TAXID,9)
"RTN","RCTCSP2",297,0)
 Q TAXID
"RTN","RCTCSP2",298,0)
 ;
"RTN","RCTCSP2",299,0)
DTFRMTO(PROMPT) ;Get from and to dates  (added as per PRCA*4.5*315 to be able to sort by dates for reports)
"RTN","RCTCSP2",300,0)
 ;INPUT:
"RTN","RCTCSP2",301,0)
 ;   PROMPT - Message to display prior to prompting for dates
"RTN","RCTCSP2",302,0)
 ;OUTPUT:
"RTN","RCTCSP2",303,0)
 ;    1^BEGDT^ENDDT - Data found
"RTN","RCTCSP2",304,0)
 ;    0             - User up arrowed or timed out
"RTN","RCTCSP2",305,0)
 ;
"RTN","RCTCSP2",306,0)
 N %DT,Y,X,BEGDT,ENDDT,DTOUT,OUT,DIRUT,DUOUT,DIROUT,DTFROM,DTTO
"RTN","RCTCSP2",307,0)
 S OUT=0
"RTN","RCTCSP2",308,0)
 W !,$G(PROMPT)
"RTN","RCTCSP2",309,0)
 S %DT="AEX"
"RTN","RCTCSP2",310,0)
 S %DT("A")="Date Range: FROM: " ;Enter Beginning Date: "
"RTN","RCTCSP2",311,0)
 S %DT("B")="T-30"
"RTN","RCTCSP2",312,0)
 W !
"RTN","RCTCSP2",313,0)
 D ^%DT
"RTN","RCTCSP2",314,0)
 K %DT
"RTN","RCTCSP2",315,0)
 Q:Y<0 OUT  ;Quit if user time out or didn't enter valid date
"RTN","RCTCSP2",316,0)
 S DTFROM=+Y
"RTN","RCTCSP2",317,0)
 S %DT="AEX"
"RTN","RCTCSP2",318,0)
 S %DT("A")="              TO:   ",%DT("B")="T" ;"TODAY"
"RTN","RCTCSP2",319,0)
 D ^%DT
"RTN","RCTCSP2",320,0)
 K %DT
"RTN","RCTCSP2",321,0)
 ;Quit if user time out or didn't enter valid date
"RTN","RCTCSP2",322,0)
 Q:Y<0 OUT
"RTN","RCTCSP2",323,0)
 S DTTO=+Y
"RTN","RCTCSP2",324,0)
 S OUT=1_U_DTFROM_U_DTTO
"RTN","RCTCSP2",325,0)
 ;Switch dates if Begin Date is more recent than End Date
"RTN","RCTCSP2",326,0)
 S:DTFROM>DTTO OUT=1_U_DTTO_U_DTFROM
"RTN","RCTCSP2",327,0)
 Q OUT
"RTN","RCTCSP2",328,0)
 ;
"RTN","RCTCSP4")
0^8^B221716971^B223432725
"RTN","RCTCSP4",1,0)
RCTCSP4 ;ALB/ESG - CS Debt Referral Stop Reactivate Report ;6/1/2017
"RTN","RCTCSP4",2,0)
 ;;4.5;Accounts Receivable;**315,339**;Mar 20, 1995;Build 2
"RTN","RCTCSP4",3,0)
 ;;Per VA Directive 6402, this routine should not be modified.
"RTN","RCTCSP4",4,0)
 ;
"RTN","RCTCSP4",5,0)
 Q
"RTN","RCTCSP4",6,0)
 ;
"RTN","RCTCSP4",7,0)
EN ; main report entry point
"RTN","RCTCSP4",8,0)
 ;
"RTN","RCTCSP4",9,0)
 N RCTCFLG,RCTCDEBT1,RCTCDEBT2,RCTCDATE,RCTCEXCEL
"RTN","RCTCSP4",10,0)
 ;
"RTN","RCTCSP4",11,0)
P1 I '$$FLAGGED(.RCTCFLG) G EX                ; currently flagged/reactivated/both
"RTN","RCTCSP4",12,0)
P2 I '$$DEBTFR(.RCTCDEBT1) G EX:$$STOP,P1     ; start with debtor
"RTN","RCTCSP4",13,0)
P3 I '$$DEBTTO(.RCTCDEBT2) G EX:$$STOP,P2     ; go to debtor
"RTN","RCTCSP4",14,0)
P4 I '$$DATES(.RCTCDATE) G EX:$$STOP,P3       ; all dates or a date range; from and thru dates
"RTN","RCTCSP4",15,0)
P5 I '$$FORMAT(.RCTCEXCEL) G EX:$$STOP,P4     ; output format (standard or Excel)
"RTN","RCTCSP4",16,0)
P6 I '$$DEVICE() G EX:$$STOP,P5               ; output device/queueing
"RTN","RCTCSP4",17,0)
 ;
"RTN","RCTCSP4",18,0)
EX ; main report exit point
"RTN","RCTCSP4",19,0)
 Q
"RTN","RCTCSP4",20,0)
 ;
"RTN","RCTCSP4",21,0)
STOP() ; Determine if user wants to exit out of the option entirely
"RTN","RCTCSP4",22,0)
 ; 1=yes, get out entirely
"RTN","RCTCSP4",23,0)
 ; 0=no, just go back to the previous question
"RTN","RCTCSP4",24,0)
 ;
"RTN","RCTCSP4",25,0)
 N DIR,X,Y,DTOUT,DUOUT,DIRUT,DIROUT
"RTN","RCTCSP4",26,0)
 ;
"RTN","RCTCSP4",27,0)
 S DIR(0)="Y"
"RTN","RCTCSP4",28,0)
 S DIR("A")="Do you want to exit out of this option entirely"
"RTN","RCTCSP4",29,0)
 S DIR("B")="YES"
"RTN","RCTCSP4",30,0)
 S DIR("?",1)="  Enter YES to immediately exit out of this option."
"RTN","RCTCSP4",31,0)
 S DIR("?")="  Enter NO to return to the previous question."
"RTN","RCTCSP4",32,0)
 W ! D ^DIR K DIR
"RTN","RCTCSP4",33,0)
 I $D(DIRUT) S Y=1
"RTN","RCTCSP4",34,0)
 Q Y
"RTN","RCTCSP4",35,0)
 ;
"RTN","RCTCSP4",36,0)
FLAGGED(RCTCFLG) ; capture if the user wants bills with a current flag, reactivated, or both
"RTN","RCTCSP4",37,0)
 ; RCTCFLG=C meaning data is currently present in the STOP TCSP REFERRAL FLAG field (430,157)
"RTN","RCTCSP4",38,0)
 ; RCTCFLG=R meaning data is currently blank in the STOP TCSP REFERRAL FLAG field (430,157)
"RTN","RCTCSP4",39,0)
 ; RCTCFLG=B meaning either is wanted
"RTN","RCTCSP4",40,0)
 ; pass parameter by reference
"RTN","RCTCSP4",41,0)
 ;
"RTN","RCTCSP4",42,0)
 N RET,DIR,X,Y,DTOUT,DUOUT,DIRUT,DIROUT
"RTN","RCTCSP4",43,0)
 S RCTCFLG="",RET=1
"RTN","RCTCSP4",44,0)
 S DIR(0)="S"
"RTN","RCTCSP4",45,0)
 S $P(DIR(0),U,2)="C:Currently Flagged;R:Reactivated;B:Both"
"RTN","RCTCSP4",46,0)
 S DIR("A")="Run the Report for"
"RTN","RCTCSP4",47,0)
 S DIR("B")="B"
"RTN","RCTCSP4",48,0)
 S DIR("?",1)="Select 'Currently Flagged' to see bills which currently have the Cross-"
"RTN","RCTCSP4",49,0)
 S DIR("?",2)="Servicing activity stop flag set."
"RTN","RCTCSP4",50,0)
 S DIR("?",3)="Select 'Reactivated' to see bills in which the stop flag is not currently"
"RTN","RCTCSP4",51,0)
 S DIR("?",4)="set, but was once set in the past."
"RTN","RCTCSP4",52,0)
 S DIR("?")="Select 'Both' to see bills of both types."
"RTN","RCTCSP4",53,0)
 W ! D ^DIR K DIR
"RTN","RCTCSP4",54,0)
 I $D(DIRUT)!(Y="") S RET=0 W $C(7) G FLX
"RTN","RCTCSP4",55,0)
 S RCTCFLG=Y
"RTN","RCTCSP4",56,0)
FLX ;
"RTN","RCTCSP4",57,0)
 Q RET
"RTN","RCTCSP4",58,0)
 ;
"RTN","RCTCSP4",59,0)
DEBTFR(RCTCDEBT1) ; start with debtor
"RTN","RCTCSP4",60,0)
 N RET,DIR,X,Y,DTOUT,DUOUT,DIRUT,DIROUT
"RTN","RCTCSP4",61,0)
 S RCTCDEBT1="",RET=1
"RTN","RCTCSP4",62,0)
 S DIR(0)="F^1:75"
"RTN","RCTCSP4",63,0)
 S DIR("A")="Start with Debtor"
"RTN","RCTCSP4",64,0)
 S DIR("B")="FIRST"
"RTN","RCTCSP4",65,0)
 S DIR("?",1)="If you want to specify a range of AR debtor names, enter the beginning"
"RTN","RCTCSP4",66,0)
 S DIR("?",2)="debtor name here. If you want to include all debtors, accept the default"
"RTN","RCTCSP4",67,0)
 S DIR("?")="value of FIRST here."
"RTN","RCTCSP4",68,0)
 W ! D ^DIR K DIR
"RTN","RCTCSP4",69,0)
 I $D(DIRUT)!(Y="") S RET=0 W $C(7) G DFX
"RTN","RCTCSP4",70,0)
 S RCTCDEBT1=Y
"RTN","RCTCSP4",71,0)
DFX ;
"RTN","RCTCSP4",72,0)
 Q RET
"RTN","RCTCSP4",73,0)
 ;
"RTN","RCTCSP4",74,0)
DEBTTO(RCTCDEBT2) ; go to debtor
"RTN","RCTCSP4",75,0)
 N RET,DIR,X,Y,DTOUT,DUOUT,DIRUT,DIROUT
"RTN","RCTCSP4",76,0)
DBT1 S RCTCDEBT2="",RET=1
"RTN","RCTCSP4",77,0)
 S DIR(0)="F^1:75"
"RTN","RCTCSP4",78,0)
 S DIR("A")="     Go to Debtor"
"RTN","RCTCSP4",79,0)
 S DIR("B")="LAST"
"RTN","RCTCSP4",80,0)
 S DIR("?",1)="If you want to specify a range of AR debtor names, enter the ending debtor"
"RTN","RCTCSP4",81,0)
 S DIR("?",2)="name here. If you want to include all debtors, accept the default value of"
"RTN","RCTCSP4",82,0)
 S DIR("?")="LAST here."
"RTN","RCTCSP4",83,0)
 D ^DIR K DIR
"RTN","RCTCSP4",84,0)
 I $D(DIRUT)!(Y="") S RET=0 W $C(7) G DTX
"RTN","RCTCSP4",85,0)
 S RCTCDEBT2=Y
"RTN","RCTCSP4",86,0)
 I RCTCDEBT1'="FIRST",RCTCDEBT2'="LAST",RCTCDEBT1]RCTCDEBT2 W $C(7),!!,"You must enter something after '",RCTCDEBT1,"'!",! G DBT1
"RTN","RCTCSP4",87,0)
DTX ;
"RTN","RCTCSP4",88,0)
 Q RET
"RTN","RCTCSP4",89,0)
 ;
"RTN","RCTCSP4",90,0)
DATES(RCTCDATE) ; all dates or a date range - also capture from and thru dates
"RTN","RCTCSP4",91,0)
 ; RCTCDATE="A" or "R" if user wants All Dates or to select a Date Range
"RTN","RCTCSP4",92,0)
 ; RCTCDATE("BEGIN")=starting FM date
"RTN","RCTCSP4",93,0)
 ; RCTCDATE("END")=ending FM date
"RTN","RCTCSP4",94,0)
 ;
"RTN","RCTCSP4",95,0)
 N RET,DIR,X,Y,DTOUT,DUOUT,DIRUT,DIROUT
"RTN","RCTCSP4",96,0)
 K RCTCDATE
"RTN","RCTCSP4",97,0)
 S RET=1
"RTN","RCTCSP4",98,0)
 S DIR(0)="S^A:All Dates;R:Date Range"
"RTN","RCTCSP4",99,0)
 S DIR("A")="Include All Dates or Select by Date Range"
"RTN","RCTCSP4",100,0)
 S DIR("B")="Date Range"
"RTN","RCTCSP4",101,0)
 S DIR("?",1)="If you want to include all transaction entered dates, please select 'A' -"
"RTN","RCTCSP4",102,0)
 S DIR("?",2)="All Dates here.  But if you want to specify a date range for the"
"RTN","RCTCSP4",103,0)
 S DIR("?",3)="transaction entered dates, then enter 'R' here and then choose the from and"
"RTN","RCTCSP4",104,0)
 S DIR("?")="through dates."
"RTN","RCTCSP4",105,0)
 W ! D ^DIR K DIR
"RTN","RCTCSP4",106,0)
 I $D(DIRUT)!(Y="") S RET=0 W $C(7) G DATESX
"RTN","RCTCSP4",107,0)
 S RCTCDATE=Y
"RTN","RCTCSP4",108,0)
 I RCTCDATE="A" G DATESX
"RTN","RCTCSP4",109,0)
 ;
"RTN","RCTCSP4",110,0)
 S DIR(0)="DA^:DT:EX"
"RTN","RCTCSP4",111,0)
 S DIR("A")="Date Entered From: "
"RTN","RCTCSP4",112,0)
 S DIR("?",1)="The From and To dates for this report refer to the date that the AR"
"RTN","RCTCSP4",113,0)
 S DIR("?")="transaction was entered."
"RTN","RCTCSP4",114,0)
 W ! D ^DIR K DIR
"RTN","RCTCSP4",115,0)
 I $D(DIRUT)!'Y S RET=0 W $C(7) K RCTCDATE G DATESX
"RTN","RCTCSP4",116,0)
 S RCTCDATE("BEGIN")=Y
"RTN","RCTCSP4",117,0)
 ;
"RTN","RCTCSP4",118,0)
 S DIR(0)="DA^"_RCTCDATE("BEGIN")_":DT:EX"
"RTN","RCTCSP4",119,0)
 S DIR("A")="  Date Entered To: "
"RTN","RCTCSP4",120,0)
 S DIR("B")="T"
"RTN","RCTCSP4",121,0)
 S DIR("?",1)="The From and To dates for this report refer to the date that the AR"
"RTN","RCTCSP4",122,0)
 S DIR("?")="transaction was entered."
"RTN","RCTCSP4",123,0)
 D ^DIR K DIR
"RTN","RCTCSP4",124,0)
 I $D(DIRUT)!'Y S RET=0 W $C(7) K RCTCDATE G DATESX
"RTN","RCTCSP4",125,0)
 S RCTCDATE("END")=Y
"RTN","RCTCSP4",126,0)
DATESX ;
"RTN","RCTCSP4",127,0)
 Q RET
"RTN","RCTCSP4",128,0)
 ;
"RTN","RCTCSP4",129,0)
FORMAT(RCTCEXCEL) ; output format is Excel format or normal report output
"RTN","RCTCSP4",130,0)
 ; RCTCEXCEL=0 for normal report output
"RTN","RCTCSP4",131,0)
 ; RCTCEXCEL=1 for Excel output
"RTN","RCTCSP4",132,0)
 ; pass parameter by reference
"RTN","RCTCSP4",133,0)
 ;
"RTN","RCTCSP4",134,0)
 N RET,DIR,X,Y,DTOUT,DUOUT,DIRUT,DIROUT
"RTN","RCTCSP4",135,0)
 S RCTCEXCEL=0,RET=1
"RTN","RCTCSP4",136,0)
 S DIR(0)="Y"
"RTN","RCTCSP4",137,0)
 S DIR("A")="Do you want to capture the output in Excel format"
"RTN","RCTCSP4",138,0)
 S DIR("B")="NO"
"RTN","RCTCSP4",139,0)
 S DIR("?",1)="If you want to capture the output from this report in a format which can"
"RTN","RCTCSP4",140,0)
 S DIR("?",2)="easily be imported into Excel, then answer YES here."
"RTN","RCTCSP4",141,0)
 S DIR("?",3)=" "
"RTN","RCTCSP4",142,0)
 S DIR("?")="If you just want a normal report output, then answer NO here."
"RTN","RCTCSP4",143,0)
 W ! D ^DIR K DIR
"RTN","RCTCSP4",144,0)
 I $D(DIRUT) S RET=0 W $C(7) G FMX
"RTN","RCTCSP4",145,0)
 S RCTCEXCEL=Y
"RTN","RCTCSP4",146,0)
FMX ;
"RTN","RCTCSP4",147,0)
 Q RET
"RTN","RCTCSP4",148,0)
 ;
"RTN","RCTCSP4",149,0)
DEVICE() ; Device Selection
"RTN","RCTCSP4",150,0)
 N ZTRTN,ZTDESC,ZTSAVE,POP,RET,ZTSK,DIR,X,Y
"RTN","RCTCSP4",151,0)
 S RET=1
"RTN","RCTCSP4",152,0)
 I 'RCTCEXCEL W !!,"This report is 132 characters wide.  Please choose an appropriate device.",!
"RTN","RCTCSP4",153,0)
 I RCTCEXCEL D
"RTN","RCTCSP4",154,0)
 . W !!,"For Excel output, turn logging or capture on now."
"RTN","RCTCSP4",155,0)
 . W !,"To avoid undesired wrapping of the data saved to the file,"
"RTN","RCTCSP4",156,0)
 . W !,"please enter ""0;256;99999"" at the ""DEVICE:"" prompt.",!
"RTN","RCTCSP4",157,0)
 ;
"RTN","RCTCSP4",158,0)
 S ZTRTN="COMPILE^RCTCSP4"
"RTN","RCTCSP4",159,0)
 S ZTDESC="RCTC AR Cross-Servicing Stop Reactivate Report"
"RTN","RCTCSP4",160,0)
 S ZTSAVE("RCTCFLG")=""
"RTN","RCTCSP4",161,0)
 S ZTSAVE("RCTCDEBT1")=""
"RTN","RCTCSP4",162,0)
 S ZTSAVE("RCTCDEBT2")=""
"RTN","RCTCSP4",163,0)
 S ZTSAVE("RCTCDATE")=""
"RTN","RCTCSP4",164,0)
 S ZTSAVE("RCTCDATE(")=""
"RTN","RCTCSP4",165,0)
 S ZTSAVE("RCTCEXCEL")=""
"RTN","RCTCSP4",166,0)
 D EN^XUTMDEVQ(ZTRTN,ZTDESC,.ZTSAVE,"QM",1)
"RTN","RCTCSP4",167,0)
 I POP S RET=0
"RTN","RCTCSP4",168,0)
 I $G(ZTSK) W !!,"Report compilation has started with task# ",ZTSK,".",! S DIR(0)="E" D ^DIR K DIR
"RTN","RCTCSP4",169,0)
 Q RET
"RTN","RCTCSP4",170,0)
 ;
"RTN","RCTCSP4",171,0)
 ;
"RTN","RCTCSP4",172,0)
COMPILE ; entry point for the report compile to build the scratch global
"RTN","RCTCSP4",173,0)
 ; may be a background task if job queued
"RTN","RCTCSP4",174,0)
 ;
"RTN","RCTCSP4",175,0)
 K ^TMP("RCTCSP4",$J)             ; kill scratch at start
"RTN","RCTCSP4",176,0)
 I '$D(ZTQUEUED) W !!,"Compiling Cross-Servicing Stop Reactivate Report.  Please wait ... "
"RTN","RCTCSP4",177,0)
 ;
"RTN","RCTCSP4",178,0)
 D COMP                           ; build scratch global
"RTN","RCTCSP4",179,0)
 D PRINT                          ; print the report
"RTN","RCTCSP4",180,0)
 D ^%ZISC                         ; close the device
"RTN","RCTCSP4",181,0)
 K ^TMP("RCTCSP4",$J)             ; kill scratch global at end
"RTN","RCTCSP4",182,0)
 I $D(ZTQUEUED) S ZTREQ="@"       ; purge the task
"RTN","RCTCSP4",183,0)
COMIPLX ;
"RTN","RCTCSP4",184,0)
 Q
"RTN","RCTCSP4",185,0)
 ;
"RTN","RCTCSP4",186,0)
COMP ; compile data into scratch global
"RTN","RCTCSP4",187,0)
 N ARTTIEN,RCTCTT,RCTCDTENT,RC433,P0,RCIBN,USER,RCTTNAME,RC340,DEBTNAME,FLAG,RCDEBTOR,RCBILLNUM
"RTN","RCTCSP4",188,0)
 ;
"RTN","RCTCSP4",189,0)
 ; first identify the AR Transaction types eligible for this report (CS STOP PLACED or CS STOP DELETED)
"RTN","RCTCSP4",190,0)
 ; load into the RCTCTT local array
"RTN","RCTCSP4",191,0)
 S ARTTIEN=0 F  S ARTTIEN=$O(^PRCA(430.3,ARTTIEN)) Q:'ARTTIEN  I $P($G(^PRCA(430.3,ARTTIEN,0)),U,1)["CS STOP" S RCTCTT(ARTTIEN)=""
"RTN","RCTCSP4",192,0)
 ;
"RTN","RCTCSP4",193,0)
 ; if no end date specified then assume all dates are OK
"RTN","RCTCSP4",194,0)
 I '$G(RCTCDATE("END")) S RCTCDATE("END")=9999999
"RTN","RCTCSP4",195,0)
 ;
"RTN","RCTCSP4",196,0)
 ; start loop
"RTN","RCTCSP4",197,0)
 S ARTTIEN=0 F  S ARTTIEN=$O(RCTCTT(ARTTIEN)) Q:'ARTTIEN  D
"RTN","RCTCSP4",198,0)
 . ;
"RTN","RCTCSP4",199,0)
 . ; determine date to start looping based on if the user specified a start date or not
"RTN","RCTCSP4",200,0)
 . S RCTCDTENT=0
"RTN","RCTCSP4",201,0)
 . I $G(RCTCDATE("BEGIN")) S RCTCDTENT=$O(^PRCA(433,"AT",ARTTIEN,RCTCDATE("BEGIN")),-1)   ; get one day earlier to start
"RTN","RCTCSP4",202,0)
 . ;
"RTN","RCTCSP4",203,0)
 . F  S RCTCDTENT=$O(^PRCA(433,"AT",ARTTIEN,RCTCDTENT)) Q:'RCTCDTENT!(RCTCDTENT>RCTCDATE("END"))  D
"RTN","RCTCSP4",204,0)
 .. S RC433=0 F  S RC433=$O(^PRCA(433,"AT",ARTTIEN,RCTCDTENT,RC433)) Q:'RC433  D
"RTN","RCTCSP4",205,0)
 ... S P0=$G(^PRCA(433,RC433,0))
"RTN","RCTCSP4",206,0)
 ... S RCIBN=+$P(P0,U,2) Q:'RCIBN                 ; bill# ien
"RTN","RCTCSP4",207,0)
 ... S USER=$P($G(^VA(200,+$P(P0,U,9),0)),U,1)    ; processed by user
"RTN","RCTCSP4",208,0)
 ... S RCTTNAME=$$GET1^DIQ(433,RC433,12)          ; trans type name
"RTN","RCTCSP4",209,0)
 ... ;
"RTN","RCTCSP4",210,0)
 ... ; now get some bill data from 430
"RTN","RCTCSP4",211,0)
 ... S RC340=+$P($G(^PRCA(430,RCIBN,0)),U,9)      ; ar debtor ien
"RTN","RCTCSP4",212,0)
 ... Q:'RC340
"RTN","RCTCSP4",213,0)
 ... S DEBTNAME=$$GET1^DIQ(340,RC340,.01)         ; external ar debtor name
"RTN","RCTCSP4",214,0)
 ... Q:DEBTNAME=""
"RTN","RCTCSP4",215,0)
 ... ;
"RTN","RCTCSP4",216,0)
 ... ; check report filter on debtor name
"RTN","RCTCSP4",217,0)
 ... I RCTCDEBT1'="FIRST",RCTCDEBT1'=DEBTNAME,RCTCDEBT1]DEBTNAME Q    ; before name range
"RTN","RCTCSP4",218,0)
 ... I RCTCDEBT2'="LAST",RCTCDEBT2'=DEBTNAME,DEBTNAME]RCTCDEBT2 Q     ; after name range
"RTN","RCTCSP4",219,0)
 ... ;
"RTN","RCTCSP4",220,0)
 ... ; get the current flag value and check report filter
"RTN","RCTCSP4",221,0)
 ... S FLAG=+$P($G(^PRCA(430,RCIBN,15)),U,7)      ; stop tcsp referral flag field (430,157)  1:flag set
"RTN","RCTCSP4",222,0)
 ... I RCTCFLG="R",FLAG Q                         ; user wants only Reactivated bills and this one is still flagged
"RTN","RCTCSP4",223,0)
 ... I RCTCFLG="C",'FLAG Q                        ; user wants only currently flagged bills and this flag is clear
"RTN","RCTCSP4",224,0)
 ... ;
"RTN","RCTCSP4",225,0)
 ... S RCDEBTOR=DEBTNAME_U_RC340                  ; debtor name^debtor ien (used in subscript)
"RTN","RCTCSP4",226,0)
 ... S RCBILLNUM=$$GET1^DIQ(430,RCIBN,.01)        ; bill#
"RTN","RCTCSP4",227,0)
 ... Q:RCBILLNUM=""
"RTN","RCTCSP4",228,0)
 ... ;
"RTN","RCTCSP4",229,0)
 ... ; store data at the debtor level if not already there
"RTN","RCTCSP4",230,0)
 ... I '$D(^TMP("RCTCSP4",$J,RCDEBTOR)) D
"RTN","RCTCSP4",231,0)
 .... N RCDV,SSN,PTID
"RTN","RCTCSP4",232,0)
 .... S (SSN,PTID)=""
"RTN","RCTCSP4",233,0)
 .... S SSN=$$SSN^RCFN01(RC340)
"RTN","RCTCSP4",234,0)
 .... S PTID=$E(DEBTNAME,1)_$S(SSN'="":$E(SSN,6,9),1:"0000")            ; patient id
"RTN","RCTCSP4",235,0)
 .... S ^TMP("RCTCSP4",$J,RCDEBTOR)=PTID_U_DEBTNAME          ; save into scratch
"RTN","RCTCSP4",236,0)
 .... Q
"RTN","RCTCSP4",237,0)
 ... ;
"RTN","RCTCSP4",238,0)
 ... ; store data at the bill# level if not already there
"RTN","RCTCSP4",239,0)
 ... I '$D(^TMP("RCTCSP4",$J,RCDEBTOR,RCBILLNUM)) D
"RTN","RCTCSP4",240,0)
 .... N RCX,CAT
"RTN","RCTCSP4",241,0)
 .... S RCX=RCBILLNUM                                        ; bill#
"RTN","RCTCSP4",242,0)
 .... S $P(RCX,U,2)=$$GET1^DIQ(430,RCIBN,11)                 ; current balance
"RTN","RCTCSP4",243,0)
 .... S $P(RCX,U,3)=$$GET1^DIQ(430,RCIBN,8)                  ; current ar status name
"RTN","RCTCSP4",244,0)
 .... S $P(RCX,U,4)=$$GET1^DIQ(430,RCIBN,2)                  ; ar category name
"RTN","RCTCSP4",245,0)
 .... S $P(RCX,U,5)=$$GET1^DIQ(430,RCIBN,61,"I")             ; letter1 date FM format
"RTN","RCTCSP4",246,0)
 .... S $P(RCX,U,6)=$$GET1^DIQ(430,RCIBN,158,"I")            ; stop tcsp referral eff. date FM format
"RTN","RCTCSP4",247,0)
 .... S $P(RCX,U,7)=$$GET1^DIQ(430,RCIBN,159)                ; stop tcsp referral reason desc
"RTN","RCTCSP4",248,0)
 .... S CAT=+$P($G(^PRCA(430,RCIBN,0)),U,2)                  ; ar category ien
"RTN","RCTCSP4",249,0)
 .... S $P(RCX,U,8)=$$GET1^DIQ(430.2,CAT,1)                  ; ar category abbreviation
"RTN","RCTCSP4",250,0)
 .... S ^TMP("RCTCSP4",$J,RCDEBTOR,RCBILLNUM)=RCX
"RTN","RCTCSP4",251,0)
 ... ;
"RTN","RCTCSP4",252,0)
 ... ; now we can store the AR transaction data
"RTN","RCTCSP4",253,0)
 ... S ^TMP("RCTCSP4",$J,RCDEBTOR,RCBILLNUM,RC433)=RCTTNAME_U_RCTCDTENT_U_USER
"RTN","RCTCSP4",254,0)
 . Q
"RTN","RCTCSP4",255,0)
 ;
"RTN","RCTCSP4",256,0)
 ;
"RTN","RCTCSP4",257,0)
COMPX ;
"RTN","RCTCSP4",258,0)
 Q
"RTN","RCTCSP4",259,0)
 ;
"RTN","RCTCSP4",260,0)
 ;
"RTN","RCTCSP4",261,0)
PRINT ; entry point for printing the report
"RTN","RCTCSP4",262,0)
 N CRT,PAGE,RCTCSTOP,SEPLINE,DIR,DIROUT,DIRUT,DTOUT,DUOUT,X,Y,RCD,DEBTDATA,BILL,BILLDATA,RC433,TRANDATA
"RTN","RCTCSP4",263,0)
 S CRT=$S(IOST["C-":1,1:0)
"RTN","RCTCSP4",264,0)
 I RCTCEXCEL S IOSL=999999        ; long screen length for Excel output
"RTN","RCTCSP4",265,0)
 S PAGE=0,RCTCSTOP=0,$P(SEPLINE,"-",133)=""
"RTN","RCTCSP4",266,0)
 ;
"RTN","RCTCSP4",267,0)
 I '$D(^TMP("RCTCSP4",$J)) D HDR W !!?5,"No data found for this report." G PX
"RTN","RCTCSP4",268,0)
 I $G(ZTSTOP) D HDR W !!?5,"This report was halted during compilation by TaskManager Request." G PX
"RTN","RCTCSP4",269,0)
 ;
"RTN","RCTCSP4",270,0)
 D HDR I RCTCSTOP G PX        ; display headers first for both types of output
"RTN","RCTCSP4",271,0)
 ;
"RTN","RCTCSP4",272,0)
 ; loop thru scratch, check for RCTCSTOP as we go
"RTN","RCTCSP4",273,0)
 S RCD="" F  S RCD=$O(^TMP("RCTCSP4",$J,RCD)) Q:RCD=""!RCTCSTOP  D
"RTN","RCTCSP4",274,0)
 . S DEBTDATA=$G(^TMP("RCTCSP4",$J,RCD))
"RTN","RCTCSP4",275,0)
 . S BILL="" F  S BILL=$O(^TMP("RCTCSP4",$J,RCD,BILL)) Q:BILL=""!RCTCSTOP  D
"RTN","RCTCSP4",276,0)
 .. S BILLDATA=$G(^TMP("RCTCSP4",$J,RCD,BILL))
"RTN","RCTCSP4",277,0)
 .. S RC433=0 F  S RC433=$O(^TMP("RCTCSP4",$J,RCD,BILL,RC433)) Q:'RC433!RCTCSTOP  D
"RTN","RCTCSP4",278,0)
 ... S TRANDATA=$G(^TMP("RCTCSP4",$J,RCD,BILL,RC433))
"RTN","RCTCSP4",279,0)
 ... D RPTLN
"RTN","RCTCSP4",280,0)
 ... Q
"RTN","RCTCSP4",281,0)
 .. Q
"RTN","RCTCSP4",282,0)
 . Q
"RTN","RCTCSP4",283,0)
 ;
"RTN","RCTCSP4",284,0)
 I RCTCSTOP G PRINTX       ; get out right away if stop flag is set
"RTN","RCTCSP4",285,0)
 ;
"RTN","RCTCSP4",286,0)
 I $Y+3>IOSL D HDR I RCTCSTOP G PRINTX
"RTN","RCTCSP4",287,0)
 W !!?5,"*** End of Report ***"
"RTN","RCTCSP4",288,0)
 ;
"RTN","RCTCSP4",289,0)
PX ;
"RTN","RCTCSP4",290,0)
 I CRT,'$D(ZTQUEUED) S DIR(0)="E" D ^DIR K DIR
"RTN","RCTCSP4",291,0)
PRINTX ;
"RTN","RCTCSP4",292,0)
 Q
"RTN","RCTCSP4",293,0)
 ;
"RTN","RCTCSP4",294,0)
RPTLN ; display one line on the report - either normal or Excel
"RTN","RCTCSP4",295,0)
 N TT
"RTN","RCTCSP4",296,0)
 ;
"RTN","RCTCSP4",297,0)
 ; for Excel output, print a line and get out
"RTN","RCTCSP4",298,0)
 I RCTCEXCEL D EXCELN G RPTLNX
"RTN","RCTCSP4",299,0)
 ;
"RTN","RCTCSP4",300,0)
 ; page break check
"RTN","RCTCSP4",301,0)
 I $Y+3>IOSL D HDR I RCTCSTOP G RPTLNX
"RTN","RCTCSP4",302,0)
 ;
"RTN","RCTCSP4",303,0)
 ; write a line of report data
"RTN","RCTCSP4",304,0)
 W !,$E($P(DEBTDATA,U,2),1,18)                               ; debtor name
"RTN","RCTCSP4",305,0)
 W ?20,$P(DEBTDATA,U,1)                                      ; Pt ID
"RTN","RCTCSP4",306,0)
 W ?27,$P($P(BILLDATA,U,1),"-",2)                            ; bill#
"RTN","RCTCSP4",307,0)
 W ?34,$$RJ^XLFSTR($FN($P(BILLDATA,U,2),"",2),10)            ; current balance
"RTN","RCTCSP4",308,0)
 W ?46,$E($P(BILLDATA,U,3),1,16)                             ; current status
"RTN","RCTCSP4",309,0)
 W ?64,$P(BILLDATA,U,8)                                      ; category abbr
"RTN","RCTCSP4",310,0)
 W ?68,$$FMTE^XLFDT($P(BILLDATA,U,5),"2Z")                   ; letter 1 date
"RTN","RCTCSP4",311,0)
 W ?78,$$FMTE^XLFDT($P(BILLDATA,U,6),"2Z")                   ; stop date
"RTN","RCTCSP4",312,0)
 W ?88,$E($P(BILLDATA,U,7),1,10)                             ; stop reason
"RTN","RCTCSP4",313,0)
 S TT=$P(TRANDATA,U,1)
"RTN","RCTCSP4",314,0)
 W ?100,$S(TT["DELETED":"DEL",TT["PLACED":"ADD",1:"UNK")     ; transaction type
"RTN","RCTCSP4",315,0)
 W ?105,$$FMTE^XLFDT($P(TRANDATA,U,2),"2Z")                  ; date entered
"RTN","RCTCSP4",316,0)
 W ?115,$E($P(TRANDATA,U,3),1,17)                            ; user
"RTN","RCTCSP4",317,0)
 ;
"RTN","RCTCSP4",318,0)
RPTLNX ;
"RTN","RCTCSP4",319,0)
 Q
"RTN","RCTCSP4",320,0)
 ;
"RTN","RCTCSP4",321,0)
HDR ; report header
"RTN","RCTCSP4",322,0)
 ;
"RTN","RCTCSP4",323,0)
 N DIR,DIROUT,DIRUT,DTOUT,DUOUT,X,Y
"RTN","RCTCSP4",324,0)
 ;
"RTN","RCTCSP4",325,0)
 ; Do an end of page reader call if page# exists and device is the screen
"RTN","RCTCSP4",326,0)
 I PAGE,CRT S DIR(0)="E" D ^DIR K DIR I 'Y S RCTCSTOP=1 G HDRX
"RTN","RCTCSP4",327,0)
 ;
"RTN","RCTCSP4",328,0)
 ; If screen output or page# exists, do a form feed
"RTN","RCTCSP4",329,0)
 I PAGE!CRT W @IOF
"RTN","RCTCSP4",330,0)
 ;
"RTN","RCTCSP4",331,0)
 ; First printer/file page - do a left margin reset
"RTN","RCTCSP4",332,0)
 I 'PAGE,'CRT W $C(13)
"RTN","RCTCSP4",333,0)
 ;
"RTN","RCTCSP4",334,0)
 S PAGE=PAGE+1    ; increment page#
"RTN","RCTCSP4",335,0)
 ;
"RTN","RCTCSP4",336,0)
 ; For Excel format, display the column headers only
"RTN","RCTCSP4",337,0)
 I RCTCEXCEL D EXCELHD G HDRX
"RTN","RCTCSP4",338,0)
 ;
"RTN","RCTCSP4",339,0)
 ; Display the report headers
"RTN","RCTCSP4",340,0)
 W "Debtor Range: "
"RTN","RCTCSP4",341,0)
 I RCTCDEBT1="FIRST",RCTCDEBT2="LAST" W "ALL"
"RTN","RCTCSP4",342,0)
 E  D
"RTN","RCTCSP4",343,0)
 . W $S(RCTCDEBT1="FIRST":"FIRST",1:($C(34)_$E(RCTCDEBT1,1,10)_$C(34)))," - "
"RTN","RCTCSP4",344,0)
 . W $S(RCTCDEBT2="LAST":"LAST",1:($C(34)_$E(RCTCDEBT2,1,10)_$C(34)))
"RTN","RCTCSP4",345,0)
 . Q
"RTN","RCTCSP4",346,0)
 ;
"RTN","RCTCSP4",347,0)
 W ?47,"Cross-Servicing Stop Reactivate Report",?122,"Page: ",PAGE
"RTN","RCTCSP4",348,0)
 ;
"RTN","RCTCSP4",349,0)
 W !?2,"Date Range: "
"RTN","RCTCSP4",350,0)
 I RCTCDATE="A" W "ALL"
"RTN","RCTCSP4",351,0)
 E  D
"RTN","RCTCSP4",352,0)
 . W $$FMTE^XLFDT($G(RCTCDATE("BEGIN")),"2Z")," - "
"RTN","RCTCSP4",353,0)
 . W $$FMTE^XLFDT($G(RCTCDATE("END")),"2Z")
"RTN","RCTCSP4",354,0)
 . Q
"RTN","RCTCSP4",355,0)
 ;
"RTN","RCTCSP4",356,0)
 W ?44,"Currently Flagged, Reactivated, or Both: "
"RTN","RCTCSP4",357,0)
 W $S(RCTCFLG="C":"Currently Flagged",RCTCFLG="R":"Reactivated",1:"Both")
"RTN","RCTCSP4",358,0)
 W ?111,$$FMTE^XLFDT($$NOW^XLFDT)
"RTN","RCTCSP4",359,0)
 ;
"RTN","RCTCSP4",360,0)
 W !,SEPLINE
"RTN","RCTCSP4",361,0)
 W !,"Debtor Name",?20,"Pt ID",?27,"Bill#",?37,"Balance",?46,"Status",?63,"Cat",?68,"Letter1",?78,"StopDate"
"RTN","RCTCSP4",362,0)
 W ?88,"Reason",?97,"CS STOP",?106,"Entered",?115,"User"
"RTN","RCTCSP4",363,0)
 W !,SEPLINE
"RTN","RCTCSP4",364,0)
 ;
"RTN","RCTCSP4",365,0)
 ; check for a TaskManager stop request
"RTN","RCTCSP4",366,0)
 I $D(ZTQUEUED),$$S^%ZTLOAD() D  G HDRX
"RTN","RCTCSP4",367,0)
 . S (ZTSTOP,RCTCSTOP)=1
"RTN","RCTCSP4",368,0)
 . W !!!?5,"*** Report Halted by TaskManager Request ***"
"RTN","RCTCSP4",369,0)
 . Q
"RTN","RCTCSP4",370,0)
 ;
"RTN","RCTCSP4",371,0)
HDRX ;
"RTN","RCTCSP4",372,0)
 Q
"RTN","RCTCSP4",373,0)
 ;
"RTN","RCTCSP4",374,0)
EXCELHD ; print an Excel header record (only 1 Excel header should print for the whole report)
"RTN","RCTCSP4",375,0)
 N RCH
"RTN","RCTCSP4",376,0)
 S RCH=$$CSV("","Debtor Name")
"RTN","RCTCSP4",377,0)
 S RCH=$$CSV(RCH,"Patient ID")
"RTN","RCTCSP4",378,0)
 S RCH=$$CSV(RCH,"Bill Number")
"RTN","RCTCSP4",379,0)
 S RCH=$$CSV(RCH,"Current Balance")
"RTN","RCTCSP4",380,0)
 S RCH=$$CSV(RCH,"Current Status")
"RTN","RCTCSP4",381,0)
 S RCH=$$CSV(RCH,"Category Name")
"RTN","RCTCSP4",382,0)
 S RCH=$$CSV(RCH,"Category Abbr")
"RTN","RCTCSP4",383,0)
 S RCH=$$CSV(RCH,"Letter1 Date")
"RTN","RCTCSP4",384,0)
 S RCH=$$CSV(RCH,"Stop Date")
"RTN","RCTCSP4",385,0)
 S RCH=$$CSV(RCH,"Stop Reason")
"RTN","RCTCSP4",386,0)
 S RCH=$$CSV(RCH,"Transaction Type")
"RTN","RCTCSP4",387,0)
 S RCH=$$CSV(RCH,"Transaction Date Entered")
"RTN","RCTCSP4",388,0)
 S RCH=$$CSV(RCH,"Transaction Processed By")
"RTN","RCTCSP4",389,0)
 W RCH
"RTN","RCTCSP4",390,0)
 Q
"RTN","RCTCSP4",391,0)
 ;
"RTN","RCTCSP4",392,0)
EXCELN ; write a line of Excel data
"RTN","RCTCSP4",393,0)
 N RCZ
"RTN","RCTCSP4",394,0)
 S RCZ=$$CSV("",$P(DEBTDATA,U,2))                         ; AR Debtor Name
"RTN","RCTCSP4",395,0)
 S RCZ=$$CSV(RCZ,$P(DEBTDATA,U,1))                        ; patient ID
"RTN","RCTCSP4",396,0)
 S RCZ=$$CSV(RCZ,$P(BILLDATA,U,1))                        ; bill#
"RTN","RCTCSP4",397,0)
 S RCZ=$$CSV(RCZ,+$P(BILLDATA,U,2))                       ; current balance
"RTN","RCTCSP4",398,0)
 S RCZ=$$CSV(RCZ,$P(BILLDATA,U,3))                        ; AR status name
"RTN","RCTCSP4",399,0)
 S RCZ=$$CSV(RCZ,$P(BILLDATA,U,4))                        ; AR category name
"RTN","RCTCSP4",400,0)
 S RCZ=$$CSV(RCZ,$P(BILLDATA,U,8))                        ; AR category abbr
"RTN","RCTCSP4",401,0)
 S RCZ=$$CSV(RCZ,$$FMTE^XLFDT($P(BILLDATA,U,5),"2Z"))     ; letter1 date
"RTN","RCTCSP4",402,0)
 S RCZ=$$CSV(RCZ,$$FMTE^XLFDT($P(BILLDATA,U,6),"2Z"))     ; stop flag effective date
"RTN","RCTCSP4",403,0)
 S RCZ=$$CSV(RCZ,$P(BILLDATA,U,7))                        ; stop flag reason
"RTN","RCTCSP4",404,0)
 S RCZ=$$CSV(RCZ,$P(TRANDATA,U,1))                        ; ar transaction type desc
"RTN","RCTCSP4",405,0)
 S RCZ=$$CSV(RCZ,$$FMTE^XLFDT($P(TRANDATA,U,2),"2Z"))     ; transaction date entered
"RTN","RCTCSP4",406,0)
 S RCZ=$$CSV(RCZ,$P(TRANDATA,U,3))                        ; trans user
"RTN","RCTCSP4",407,0)
 W !,RCZ
"RTN","RCTCSP4",408,0)
 Q
"RTN","RCTCSP4",409,0)
 ;
"RTN","RCTCSP4",410,0)
CSV(STRING,DATA) ; build the Excel data string format
"RTN","RCTCSP4",411,0)
 S STRING=$S(STRING="":DATA,1:STRING_U_DATA)
"RTN","RCTCSP4",412,0)
 Q STRING
"RTN","RCTCSP4",413,0)
 ;
"RTN","RCTCSP5")
0^9^B102095526^B97137563
"RTN","RCTCSP5",1,0)
RCTCSP5 ;ALBANY/PAW-CROSS-SERVICING RECALL REPORT ;03/15/14 3:34 PM
"RTN","RCTCSP5",2,0)
 ;;4.5;Accounts Receivable;**315,339**;Mar 20, 1995;Build 2
"RTN","RCTCSP5",3,0)
 ;;Per VA Directive 6402, this routine should not be modified.
"RTN","RCTCSP5",4,0)
 ;
"RTN","RCTCSP5",5,0)
 Q
"RTN","RCTCSP5",6,0)
 ;
"RTN","RCTCSP5",7,0)
CSRCLRT ;cross-servicing recall report, prints sorted individual bills that make up a cross-servicing account
"RTN","RCTCSP5",8,0)
 N RCSORT,PAGE,DASH,DTOUT,DUOUT,DIROUT,VALUE,SSN,PROMPT,EXCEL,RCIEN,BILLN,RCDTV,RCUSER,RCTRAN,RCDATE,TERMDIG,CURDT,DATE,DBTR
"RTN","RCTCSP5",9,0)
 N DTFRM,DTTO,DTFRMTO,POP,ZTDESC,ZTREQ,ZTSAVE,ZTRTN,ZTSK,X,Y,DIRUT,STOP,FLAG,TRANTYP
"RTN","RCTCSP5",10,0)
 S PAGE=0,DASH="",$P(DASH,"-",78)="",SSN=0000
"RTN","RCTCSP5",11,0)
 W !
"RTN","RCTCSP5",12,0)
 K ^TMP("RCTCSP5",$J)
"RTN","RCTCSP5",13,0)
 S DIR(0)="S^1:Bill Number;2:Debtor Name",DIR("A")="Sort by",DIR("B")=2 D ^DIR K DIR
"RTN","RCTCSP5",14,0)
 S RCSORT=Y Q:($D(DTOUT)!$D(DUOUT)!$D(DIROUT))
"RTN","RCTCSP5",15,0)
 S DTFRMTO=$$DTFRMTO^RCTCSP2 Q:'DTFRMTO  ;Get date range as per PRCA*4.5*315
"RTN","RCTCSP5",16,0)
 S (DATE,DTFRM)=$$FMADD^XLFDT(+$P(DTFRMTO,U,2)),DTTO=$P(DTFRMTO,U,3),CURDT=0
"RTN","RCTCSP5",17,0)
 S EXCEL=0,PROMPT="CAPTURE Report data to an Excel Document",DIR(0)="Y",DIR("?")="^D HEXC^RCTCSJR"
"RTN","RCTCSP5",18,0)
 S EXCEL=$$SELECT^RCTCSJR(PROMPT,"NO") I "01"'[EXCEL S STOP=1 Q
"RTN","RCTCSP5",19,0)
 I EXCEL=1 D EXCMSG^RCTCSJR ; Display Excel display message
"RTN","RCTCSP5",20,0)
 K IOP,IO("Q") S %ZIS="MQ",%ZIS("B")="" D ^%ZIS Q:POP
"RTN","RCTCSP5",21,0)
 I $D(IO("Q")) D  Q
"RTN","RCTCSP5",22,0)
 .S ZTSAVE("RCSORT")="",ZTSAVE("EXCEL")="",ZTSAVE("DTFRM")="",ZTSAVE("DTTO")=""
"RTN","RCTCSP5",23,0)
 .S ZTSAVE("PAGE")="",ZTSAVE("SSN")="",ZTSAVE("DASH")=""
"RTN","RCTCSP5",24,0)
 .S ZTRTN="PRTSORT^RCTCSP5",ZTDESC="CROSS-SERVICING RECALL REPORT"
"RTN","RCTCSP5",25,0)
 .D ^%ZTLOAD,^%ZISC
"RTN","RCTCSP5",26,0)
 .I $G(ZTSK) W !!,"Report compilation has started with task# ",ZTSK,".",! S DIR(0)="E" D ^DIR K DIR
"RTN","RCTCSP5",27,0)
 .Q
"RTN","RCTCSP5",28,0)
 ;
"RTN","RCTCSP5",29,0)
 I $E(IOST,1,2)="C-" W !!,"Compiling Cross-Servicing Recall Report.  Please wait ... ",!
"RTN","RCTCSP5",30,0)
 ;
"RTN","RCTCSP5",31,0)
PRTSORT ;loop through all bills, find recall bills and corrsponding tranactions
"RTN","RCTCSP5",32,0)
 K ^TMP("RCTCSP5",$J)
"RTN","RCTCSP5",33,0)
 S (RCIEN)=0 F  S RCIEN=$O(^PRCA(430,RCIEN)) Q:'RCIEN  D
"RTN","RCTCSP5",34,0)
 .S FLAG=0
"RTN","RCTCSP5",35,0)
 .Q:('+$P($G(^PRCA(430,RCIEN,15)),U,2))  ;QUIT if 'TCSP RECALL FLAG' is Null
"RTN","RCTCSP5",36,0)
 .I $P($G(^PRCA(430,RCIEN,15)),U,3)'="" Q:$P($G(^PRCA(430,RCIEN,15)),U,3)<DTFRM!($P($G(^PRCA(430,RCIEN,15)),U,3)>DTTO)  ;If using "recall effective date" to screen
"RTN","RCTCSP5",37,0)
 .K RCLIST,LIST,MSG D GETS^DIQ(430,RCIEN_",",".01;9;155;151;153;154","IE","LIST","MSG") Q:$D(LIST)<10  S RCLIST=$NA(LIST(430,RCIEN_","))
"RTN","RCTCSP5",38,0)
 .S DEBTOR=$P($G(^PRCA(430,RCIEN,0)),U,9)
"RTN","RCTCSP5",39,0)
 .I '$D(^RCD(340,DEBTOR,0)) S SSN="    "  ;set SSN to blank if not VA employee or Patient
"RTN","RCTCSP5",40,0)
 .I $D(^RCD(340,DEBTOR,0)) S SSN=$E($$SSN^RCFN01($P($G(^RCD(340,DEBTOR,0)),"^")),6,9) S TERMDIG=$E(@RCLIST@(9,"E"),1)_$S(SSN'="":SSN,1:"     ")
"RTN","RCTCSP5",41,0)
 .;
"RTN","RCTCSP5",42,0)
 .;locate recall transaction - loop thru backwards, getting the most recent transaction. stop when we find one.
"RTN","RCTCSP5",43,0)
 .S RCUSER="",RCTRAN=""
"RTN","RCTCSP5",44,0)
 .;
"RTN","RCTCSP5",45,0)
 .; TCSP RECALL EFFECTIVE DATE is not there
"RTN","RCTCSP5",46,0)
 .I $P(^PRCA(430,RCIEN,15),U,3)="" D
"RTN","RCTCSP5",47,0)
 ..F  S RCTRAN=$O(^PRCA(433,"C",RCIEN,RCTRAN),-1) Q:RCTRAN=""  D  Q:FLAG
"RTN","RCTCSP5",48,0)
 ...S TRANTYP=$$GET1^DIQ(433,RCTRAN,12)   ; transaction type description
"RTN","RCTCSP5",49,0)
 ...I $F(".CS BILL RECALL.CS CASE RECALL.CS DEBTOR RECALL.CS RECALL PLACED.","."_TRANTYP_".") D
"RTN","RCTCSP5",50,0)
 ....S RCUSER=$E($$GET1^DIQ(433,RCTRAN,42),1,10),FLAG=1
"RTN","RCTCSP5",51,0)
 .;
"RTN","RCTCSP5",52,0)
 .; TCSP RECALL EFFECTIVE DATE exists
"RTN","RCTCSP5",53,0)
 .I $P(^PRCA(430,RCIEN,15),U,3)'="" D
"RTN","RCTCSP5",54,0)
 ..F  S RCTRAN=$O(^PRCA(433,"C",RCIEN,RCTRAN),-1) Q:RCTRAN=""  D  Q:FLAG
"RTN","RCTCSP5",55,0)
 ...S TRANTYP=$$GET1^DIQ(433,RCTRAN,12)   ; transaction type description
"RTN","RCTCSP5",56,0)
 ...I $F(".CS BILL RECALL.CS CASE RECALL.CS DEBTOR RECALL.","."_TRANTYP_".") D
"RTN","RCTCSP5",57,0)
 ....S RCUSER=$E($$GET1^DIQ(433,RCTRAN,42),1,10),FLAG=1
"RTN","RCTCSP5",58,0)
 .;
"RTN","RCTCSP5",59,0)
 .;We want to sort by date, but when the date is NULL we need to use alternate
"RTN","RCTCSP5",60,0)
 .;data field, so if a date is present use negative value otherwise use RCIEN 
"RTN","RCTCSP5",61,0)
 .;that allows us to sort by date (newest first).  When we print if the number
"RTN","RCTCSP5",62,0)
 .;is longer than 8 (negative date) char print "Pending".
"RTN","RCTCSP5",63,0)
 .S RCDTV=@RCLIST@(153,"I"),RCDTV=$S(RCDTV'="":-RCDTV,1:RCIEN)
"RTN","RCTCSP5",64,0)
 .I RCDTV>0 S RCDTV=-RCDTV D
"RTN","RCTCSP5",65,0)
 ..I $L(RCDTV)<10 S RCDTV=$E(-99999999,1,(11-$L(RCDTV)))_$E(RCDTV,2,9) Q  ;Ensure that entries that use IEN are 9 characters, this makes empty dates float to the top
"RTN","RCTCSP5",66,0)
 ..I $E(RCDTV,2)<3 S $E(RCDTV,1,4)=-999  ;If IEN is long we need to assure that the first 4 characters are -999 , so that null dates float to the top
"RTN","RCTCSP5",67,0)
 .;
"RTN","RCTCSP5",68,0)
 .;write records to ^TMP
"RTN","RCTCSP5",69,0)
 .I RCSORT=1 D
"RTN","RCTCSP5",70,0)
 ..S ^TMP("RCTCSP5",$J,@RCLIST@(.01,"E"),RCDTV)=@RCLIST@(.01,"E")_U_$E(@RCLIST@(9,"E"),1,17)_U_TERMDIG
"RTN","RCTCSP5",71,0)
 ..S ^TMP("RCTCSP5",$J,@RCLIST@(.01,"E"),RCDTV)=^TMP("RCTCSP5",$J,@RCLIST@(.01,"E"),RCDTV)_U_$J(@RCLIST@(155,"E"),9,2)_U_$S($L(RCDTV)=8:$$FMTE^XLFDT(-RCDTV,"2Z"),1:"Pending")_U_@RCLIST@(154,"I")_"-"_$E(@RCLIST@(154,"E"),1,7)_U_RCUSER
"RTN","RCTCSP5",72,0)
 .I RCSORT=2 D  ; rewrite for EXCEL and faster processing, added User ID (as per PRCA*4.5*315)
"RTN","RCTCSP5",73,0)
 .. I EXCEL D  Q
"RTN","RCTCSP5",74,0)
 ...S ^TMP("RCTCSP5",$J,@RCLIST@(9,"E"),RCIEN,RCDTV)=$E(@RCLIST@(9,"E"),1,16)_U_@RCLIST@(.01,"E")_U_TERMDIG_U_$J(@RCLIST@(155,"E"),9,2)_U
"RTN","RCTCSP5",75,0)
 ...S ^TMP("RCTCSP5",$J,@RCLIST@(9,"E"),RCIEN,RCDTV)=^TMP("RCTCSP5",$J,@RCLIST@(9,"E"),RCIEN,RCDTV)_$S($L(RCDTV)=8:$$FMTE^XLFDT(-RCDTV,"2Z"),1:"Pending")_U_@RCLIST@(154,"I")_"-"_$E(@RCLIST@(154,"E"),1,7)_U_RCUSER Q
"RTN","RCTCSP5",76,0)
 ..I 'EXCEL D  Q
"RTN","RCTCSP5",77,0)
 ...S ^TMP("RCTCSP5",$J,@RCLIST@(9,"E"),RCIEN,RCDTV)=$E(@RCLIST@(9,"E"),1,16)_U_@RCLIST@(.01,"E")_U_SSN_U_$J(@RCLIST@(155,"E"),9,2)_U_$S($L(RCDTV)=8:$$FMTE^XLFDT(-RCDTV,"2Z"),1:"Pending")
"RTN","RCTCSP5",78,0)
 ...S ^TMP("RCTCSP5",$J,@RCLIST@(9,"E"),RCIEN,RCDTV)=^TMP("RCTCSP5",$J,@RCLIST@(9,"E"),RCIEN,RCDTV)_U_@RCLIST@(154,"I")_"-"_$E(@RCLIST@(154,"E"),1,7)_U_RCUSER
"RTN","RCTCSP5",79,0)
 ;
"RTN","RCTCSP5",80,0)
 ;^TMP global loaded, now print report
"RTN","RCTCSP5",81,0)
 U IO
"RTN","RCTCSP5",82,0)
 I RCSORT=1 D  ;Print bill number sort
"RTN","RCTCSP5",83,0)
 .D CSRCLH1
"RTN","RCTCSP5",84,0)
 .S (BILLN,RCDTV)="" F  S BILLN=$O(^TMP("RCTCSP5",$J,BILLN)) Q:BILLN=""!$D(DIRUT)  F  S RCDTV=$O(^TMP("RCTCSP5",$J,BILLN,RCDTV)) Q:RCDTV=""!$D(DIRUT)  D  Q:$D(DIRUT)
"RTN","RCTCSP5",85,0)
 ..I EXCEL W !,$P(^TMP("RCTCSP5",$J,BILLN,RCDTV),U,1,4)_U_$S($L(RCDTV)=8:$$FMTE^XLFDT(-RCDTV,"2Z"),1:"Pending")_U_$P(^TMP("RCTCSP5",$J,BILLN,RCDTV),U,6,10) Q
"RTN","RCTCSP5",86,0)
 .. ; non-Excel output
"RTN","RCTCSP5",87,0)
 ..W !,$P(^TMP("RCTCSP5",$J,BILLN,RCDTV),U),?13,$P(^TMP("RCTCSP5",$J,BILLN,RCDTV),U,2),?31,$P(^TMP("RCTCSP5",$J,BILLN,RCDTV),U,3)
"RTN","RCTCSP5",88,0)
 ..W ?33,$P(^TMP("RCTCSP5",$J,BILLN,RCDTV),U,4),?47,$P(^TMP("RCTCSP5",$J,BILLN,RCDTV),U,5)
"RTN","RCTCSP5",89,0)
 ..W ?56,$P(^TMP("RCTCSP5",$J,BILLN,RCDTV),U,6),?67,$P(^TMP("RCTCSP5",$J,BILLN,RCDTV),U,7)
"RTN","RCTCSP5",90,0)
 .. ; check for page breaks
"RTN","RCTCSP5",91,0)
 .. I ($Y+3)>IOSL D
"RTN","RCTCSP5",92,0)
 ... I $E(IOST,1,2)="C-" S DIR(0)="E" K DIRUT D ^DIR K DIR Q:$D(DIRUT)
"RTN","RCTCSP5",93,0)
 ... D CSRCLH1
"RTN","RCTCSP5",94,0)
 ;
"RTN","RCTCSP5",95,0)
 I RCSORT=2 D  ;Print debtor sort
"RTN","RCTCSP5",96,0)
 .D CSRCLH2
"RTN","RCTCSP5",97,0)
 .S (DBTR,RCDTV,RCIEN)="" F  S DBTR=$O(^TMP("RCTCSP5",$J,DBTR)) Q:DBTR=""!$D(DIRUT)  F  S RCIEN=$O(^TMP("RCTCSP5",$J,DBTR,RCIEN)) Q:RCIEN=""!$D(DIRUT)  F  S RCDTV=$O(^TMP("RCTCSP5",$J,DBTR,RCIEN,RCDTV)) Q:RCDTV=""!$D(DIRUT)  D  Q:$D(DIRUT)
"RTN","RCTCSP5",98,0)
 ..I EXCEL W !,^TMP("RCTCSP5",$J,DBTR,RCIEN,RCDTV) Q
"RTN","RCTCSP5",99,0)
 .. ; non-Excel output
"RTN","RCTCSP5",100,0)
 ..W !,$P(^TMP("RCTCSP5",$J,DBTR,RCIEN,RCDTV),U),?18,$P(^TMP("RCTCSP5",$J,DBTR,RCIEN,RCDTV),U,2)
"RTN","RCTCSP5",101,0)
 ..W ?31,$P(^TMP("RCTCSP5",$J,DBTR,RCIEN,RCDTV),U,3),?36,$P(^TMP("RCTCSP5",$J,DBTR,RCIEN,RCDTV),U,4)
"RTN","RCTCSP5",102,0)
 ..W ?47,$P(^TMP("RCTCSP5",$J,DBTR,RCIEN,RCDTV),U,5),?56,$P(^TMP("RCTCSP5",$J,DBTR,RCIEN,RCDTV),U,6)
"RTN","RCTCSP5",103,0)
 ..W ?67,$P(^TMP("RCTCSP5",$J,DBTR,RCIEN,RCDTV),U,7)
"RTN","RCTCSP5",104,0)
 .. ; check for page breaks
"RTN","RCTCSP5",105,0)
 .. I ($Y+3)>IOSL D
"RTN","RCTCSP5",106,0)
 ... I $E(IOST,1,2)="C-" S DIR(0)="E" K DIRUT D ^DIR K DIR Q:$D(DIRUT)
"RTN","RCTCSP5",107,0)
 ... D CSRCLH2
"RTN","RCTCSP5",108,0)
 ;
"RTN","RCTCSP5",109,0)
 ;Finish up report
"RTN","RCTCSP5",110,0)
 I '$D(^TMP("RCTCSP5",$J)) W !,"No records found",!!
"RTN","RCTCSP5",111,0)
 K ^TMP("RCTCSP5",$J)
"RTN","RCTCSP5",112,0)
 I $E(IOST,1,2)="C-",'$D(DIRUT) R !!,"END OF REPORT...PRESS RETURN TO CONTINUE",X:DTIME W @IOF
"RTN","RCTCSP5",113,0)
 D ^%ZISC
"RTN","RCTCSP5",114,0)
 S:$D(ZTQUEUED) ZTREQ="@"
"RTN","RCTCSP5",115,0)
 K IOP,%ZIS,ZTQUEUED
"RTN","RCTCSP5",116,0)
 Q
"RTN","RCTCSP5",117,0)
 ;
"RTN","RCTCSP5",118,0)
CSRCLH1 ;header for cross-servicing recall report 1
"RTN","RCTCSP5",119,0)
 S PAGE=PAGE+1
"RTN","RCTCSP5",120,0)
 I 'EXCEL D  Q
"RTN","RCTCSP5",121,0)
 .W @IOF
"RTN","RCTCSP5",122,0)
 .W !,"PAGE "_PAGE,?12,"CROSS-SERVICING RECALL REPORT (SORTED BY BILL NUMBER)",?68,$$FMTE^XLFDT(DT,"2Z")
"RTN","RCTCSP5",123,0)
 .W !,DASH
"RTN","RCTCSP5",124,0)
 .W !,"BILL NO.",?13,"DEBTOR",?31,"Pt ID",?37,"RECL AMT",?47,"RECL DT",?56,"RECALL RSN",?67,"USER ID"
"RTN","RCTCSP5",125,0)
 .W !,"--------",?13,"------",?31,"-----",?37,"--------",?47,"-------",?56,"----------",?67,"-------"
"RTN","RCTCSP5",126,0)
 ;EXCEL FORM
"RTN","RCTCSP5",127,0)
 W !,"PAGE "_PAGE_U_U_"CS RECALL RPT (BILL)"_U_U_$$FMTE^XLFDT(DT,"2Z")
"RTN","RCTCSP5",128,0)
 W !,"BILL NO."_U_"DEBTOR"_U_"Pt ID"_U_"RECL AMT"_U_"RECALL DT"_U_"RECALL RSN"_U_"USER ID"
"RTN","RCTCSP5",129,0)
 Q
"RTN","RCTCSP5",130,0)
 ;
"RTN","RCTCSP5",131,0)
CSRCLH2 ;header for cross-servicing recall report 2
"RTN","RCTCSP5",132,0)
 S PAGE=PAGE+1
"RTN","RCTCSP5",133,0)
 I 'EXCEL D  Q
"RTN","RCTCSP5",134,0)
 .W @IOF
"RTN","RCTCSP5",135,0)
 .W !,"PAGE "_PAGE,?14,"CROSS-SERVICING RECALL REPORT (SORTED BY DEBTOR)",?68,$$FMTE^XLFDT(DT,"2Z")
"RTN","RCTCSP5",136,0)
 .W !,DASH
"RTN","RCTCSP5",137,0)
 .W !,"DEBTOR",?18,"BILL NO.",?31,"Pt ID",?37,"RECL AMT",?47,"RECL DT",?56,"RECALL RSN",?67,"USER ID"
"RTN","RCTCSP5",138,0)
 .W !,"------",?18,"--------",?31,"-----",?37,"--------",?47,"-------",?56,"----------",?67,"-------"
"RTN","RCTCSP5",139,0)
 ;EXCEL FORMAT
"RTN","RCTCSP5",140,0)
 W !,"PAGE "_PAGE_U_U_"CS RECALL RPT (DEBTOR)"_U_U_$$FMTE^XLFDT(DT,"2Z")
"RTN","RCTCSP5",141,0)
 W !,"DEBTOR"_U_"BILL NO."_U_"Pt ID"_U_"RECL AMT"_U_"RECALL DT"_U_"RECALL RSN"_U_"USER ID"
"RTN","RCTCSP5",142,0)
 Q
"RTN","RCTCSP5",143,0)
 ;
"RTN","RCTCSP5",144,0)
IAIRPT ;Treasury Cross-Servicing IAI Report
"RTN","RCTCSP5",145,0)
 ;This report displays a record of current VHA bills at Treasury. It is a tool that can be used to identify bills erroneously 
"RTN","RCTCSP5",146,0)
 ;listed in a referral status in VistA when reconciled with the Print Cross-Servicing Report.
"RTN","RCTCSP5",147,0)
 ;
"RTN","RCTCSP5",148,0)
 N RDATES,RDGBL,NODE,PAGE,DASH,EXCEL,DEBTOR,BILLDA,RCBILL,CNT,CURDT,POP,RCNAME,ZTDESC,ZTREQ,ZTSAVE,ZTSK,ZTRTN,X,Y,STOP,DIRUT
"RTN","RCTCSP5",149,0)
 S PAGE=0,DASH="",$P(DASH,"-",78)=""
"RTN","RCTCSP5",150,0)
 ;Get available report dates
"RTN","RCTCSP5",151,0)
 S RDGBL="RCTCSP6",CNT=1 F  S RDGBL=$O(^XTMP(RDGBL),-1) Q:RDGBL=""!($E(RDGBL,1)="Q")  I RDGBL["RCTCSP5" D
"RTN","RCTCSP5",152,0)
 . I $P(RDGBL," - ",2)="" S VALUE="No report data to print" Q
"RTN","RCTCSP5",153,0)
 . S RDATES(CNT)=$P(RDGBL," - ",2)_U_$$FMTE^XLFDT($P(RDGBL," - ",2),"2Z"),RDGBL(CNT)=RDGBL,CNT=CNT+1
"RTN","RCTCSP5",154,0)
 . Q
"RTN","RCTCSP5",155,0)
 I '$D(RDATES(1)) W !,?5,"There is no data available for the report, quitting.",! Q
"RTN","RCTCSP5",156,0)
 ; Show dates sorted by newest first and only show the last two report dates if they exist
"RTN","RCTCSP5",157,0)
 I '$D(RDATES(2)) S DIR(0)="S^1:"_$P(RDATES(1),U,2),DIR("A")="Print date?",DIR("B")=1 D ^DIR K DIR
"RTN","RCTCSP5",158,0)
 I $D(RDATES(2)) S DIR(0)="S^1:"_$P(RDATES(1),U,2)_";2:"_$P(RDATES(2),U,2),DIR("A")="     Print IAI report date?",DIR("B")=1 D ^DIR K DIR
"RTN","RCTCSP5",159,0)
 Q:$G(DUOUT)
"RTN","RCTCSP5",160,0)
 S NODE=RDGBL(Y),RDATES=+RDATES(Y)
"RTN","RCTCSP5",161,0)
 S EXCEL=0,PROMPT="CAPTURE Report data to an Excel Document",DIR(0)="Y",DIR("?")="^D HEXC^RCTCSJR"
"RTN","RCTCSP5",162,0)
 S EXCEL=$$SELECT^RCTCSJR(PROMPT,"NO") I "01"'[EXCEL S STOP=1 Q
"RTN","RCTCSP5",163,0)
 I EXCEL=1 D EXCMSG^RCTCSJR ; Display Excel display message
"RTN","RCTCSP5",164,0)
 ;
"RTN","RCTCSP5",165,0)
 K IOP,IO("Q") S %ZIS="MQ",%ZIS("B")="" D ^%ZIS Q:POP
"RTN","RCTCSP5",166,0)
 I $D(IO("Q")) D  Q
"RTN","RCTCSP5",167,0)
 .S ZTSAVE("NODE")="",ZTSAVE("EXCEL")="",ZTSAVE("RDATES")=""
"RTN","RCTCSP5",168,0)
 .S ZTRTN="IAIPRNT^RCTCSP5",ZTDESC="CROSS-SERVICING IAI REPORT"
"RTN","RCTCSP5",169,0)
 .D ^%ZTLOAD,^%ZISC
"RTN","RCTCSP5",170,0)
 .I $G(ZTSK) W !!,"Report compilation has started with task# ",ZTSK,".",!
"RTN","RCTCSP5",171,0)
 .Q
"RTN","RCTCSP5",172,0)
 .;
"RTN","RCTCSP5",173,0)
IAIPRNT ;
"RTN","RCTCSP5",174,0)
 N GETNM,GETBL,GLO
"RTN","RCTCSP5",175,0)
 S PAGE=0
"RTN","RCTCSP5",176,0)
 S GLO=$NA(^TMP("RCTCSP5",$J)) K @GLO
"RTN","RCTCSP5",177,0)
 U IO
"RTN","RCTCSP5",178,0)
 D IAIHDR
"RTN","RCTCSP5",179,0)
 ;
"RTN","RCTCSP5",180,0)
 ; report compile
"RTN","RCTCSP5",181,0)
 S DEBTOR=0 F  S DEBTOR=$O(^XTMP(NODE,DEBTOR)) Q:'DEBTOR  D
"RTN","RCTCSP5",182,0)
 . S BILLDA="" F  S BILLDA=$O(^XTMP(NODE,DEBTOR,BILLDA)) Q:'BILLDA  D
"RTN","RCTCSP5",183,0)
 ..S RCBILL=$P($G(^PRCA(430,BILLDA,0)),U),RCNAME=$E($$GET1^DIQ(430,BILLDA,9),1,20)
"RTN","RCTCSP5",184,0)
 ..S SSN=$S($P($G(^RCD(340,DEBTOR,0)),U)'="":$$SSN^RCFN01($P(^RCD(340,DEBTOR,0),"^")),1:"None")
"RTN","RCTCSP5",185,0)
 ..I SSN<1 S SSN="None"
"RTN","RCTCSP5",186,0)
 ..S @GLO@(RCNAME,RCBILL)=RCBILL_U_RCNAME_U_SSN Q
"RTN","RCTCSP5",187,0)
 ;
"RTN","RCTCSP5",188,0)
 ; report print
"RTN","RCTCSP5",189,0)
 S GETNM="" F  S GETNM=$O(@GLO@(GETNM)) Q:GETNM=""!$D(DIRUT)  S GETBL="" F  S GETBL=$O(@GLO@(GETNM,GETBL)) Q:GETBL=""!$D(DIRUT)  D  Q:$D(DIRUT)
"RTN","RCTCSP5",190,0)
 .I 'EXCEL W $P(@GLO@(GETNM,GETBL),U),?15,$P(@GLO@(GETNM,GETBL),U,2),?40,$P(@GLO@(GETNM,GETBL),U,3),!
"RTN","RCTCSP5",191,0)
 .I EXCEL W @GLO@(GETNM,GETBL),!
"RTN","RCTCSP5",192,0)
 .;check for end of page here, if necessary form feed and print header
"RTN","RCTCSP5",193,0)
 .I 'EXCEL,($Y+3)>IOSL D
"RTN","RCTCSP5",194,0)
 ..I $E(IOST,1,2)="C-" S DIR(0)="E" K DIRUT D ^DIR Q:$D(DIRUT)
"RTN","RCTCSP5",195,0)
 ..D IAIHDR
"RTN","RCTCSP5",196,0)
 I 'EXCEL,'$D(DIRUT),$E(IOST,1,2)="C-" R !!,"END OF REPORT...PRESS RETURN TO CONTINUE",X:DTIME W @IOF
"RTN","RCTCSP5",197,0)
 K @GLO
"RTN","RCTCSP5",198,0)
 D ^%ZISC
"RTN","RCTCSP5",199,0)
 S:$D(ZTQUEUED) ZTREQ="@"
"RTN","RCTCSP5",200,0)
 Q
"RTN","RCTCSP5",201,0)
 ;
"RTN","RCTCSP5",202,0)
IAIHDR ;
"RTN","RCTCSP5",203,0)
 S PAGE=PAGE+1
"RTN","RCTCSP5",204,0)
 I 'EXCEL D  Q
"RTN","RCTCSP5",205,0)
 .W @IOF
"RTN","RCTCSP5",206,0)
 .W ?10,"Treasury Cross-Servicing IAI Report",!!,"IAI data compiled date: ",$$FMTE^XLFDT(RDATES,"2Z"),?50,"Page ",PAGE
"RTN","RCTCSP5",207,0)
 .W !!,"Bill Number",?20,"Debtor",?43,"SSN"
"RTN","RCTCSP5",208,0)
 .W !,"-----------",?15,"-----------------------",?40,"---------",!
"RTN","RCTCSP5",209,0)
 ;EXCEL FORMAT
"RTN","RCTCSP5",210,0)
 W !,"PAGE "_PAGE_U_U_"Treasury Cross-Servicing IAI Report"_U_U_$$FMTE^XLFDT(RDATES,"2Z")
"RTN","RCTCSP5",211,0)
 W !,"Bill Number"_U_"Debtor"_U_"SSN",!
"RTN","RCTCSP5",212,0)
 Q
"RTN","RCTCSPD4")
0^10^B88898329^B88942969
"RTN","RCTCSPD4",1,0)
RCTCSPD4 ;ALB/LMH-CROSS-SERVICING NON-FINANCIAL TRANSACTIONS ;03/15/14 3:34 PM
"RTN","RCTCSPD4",2,0)
 ;;4.5;Accounts Receivable;**315,339**;Mar 20, 1995;Build 2
"RTN","RCTCSPD4",3,0)
 ;;Per VA Directive 6402, this routine should not be modified.
"RTN","RCTCSPD4",4,0)
 ;
"RTN","RCTCSPD4",5,0)
 Q 
"RTN","RCTCSPD4",6,0)
 ;
"RTN","RCTCSPD4",7,0)
STOP ; CS stop placed non-financial tx
"RTN","RCTCSPD4",8,0)
 N PRCAEN,PRCAA1,DR,DIE,DA,D0,PRCAD,RCASK,PRCAA2,PRCA,PRCATY,RCUSER
"RTN","RCTCSPD4",9,0)
 S PRCABN=BILL
"RTN","RCTCSPD4",10,0)
 D SETTR^PRCAUTL,PATTR^PRCAUTL Q:'$D(PRCAEN)
"RTN","RCTCSPD4",11,0)
 S PRCAA1=$S($D(^PRCA(433,PRCAEN,4,0)):+$P(^(0),U,4),1:0)
"RTN","RCTCSPD4",12,0)
 Q:PRCAA1'>0  S PRCAA2=$P(^(0),U,3)
"RTN","RCTCSPD4",13,0)
 S DIE="^PRCA(433,",DA=PRCAEN
"RTN","RCTCSPD4",14,0)
 S DR=".03///"_PRCABN ;Bill Number
"RTN","RCTCSPD4",15,0)
 S DR=DR_";3///0" ;Calm Code Done
"RTN","RCTCSPD4",16,0)
 S DR=DR_";12///"_$O(^PRCA(430.3,"AC",33,0)) ;Transaction Type
"RTN","RCTCSPD4",17,0)
 S DR=DR_";15///0" ;Transaction Amount
"RTN","RCTCSPD4",18,0)
 S DR=DR_";42///"_DUZ ;Processed by user
"RTN","RCTCSPD4",19,0)
 S DR=DR_";11///"_DT ;Transaction date
"RTN","RCTCSPD4",20,0)
 S DR=DR_";4///2" ;Transaction status (complete)
"RTN","RCTCSPD4",21,0)
 S DR=DR_";5.02///CS STOP PLACED" D ^DIE
"RTN","RCTCSPD4",22,0)
 Q
"RTN","RCTCSPD4",23,0)
 ;
"RTN","RCTCSPD4",24,0)
DELSTOP ; CS delete stop non-financial tx
"RTN","RCTCSPD4",25,0)
 N PRCAEN,PRCAA1,DR,DIE,DA,D0,PRCAD,RCASK,PRCAA2,PRCA,PRCATY,RCUSER
"RTN","RCTCSPD4",26,0)
 S PRCABN=BILL
"RTN","RCTCSPD4",27,0)
 D SETTR^PRCAUTL,PATTR^PRCAUTL Q:'$D(PRCAEN)
"RTN","RCTCSPD4",28,0)
 S PRCAA1=$S($D(^PRCA(433,PRCAEN,4,0)):+$P(^(0),U,4),1:0)
"RTN","RCTCSPD4",29,0)
 Q:PRCAA1'>0  S PRCAA2=$P(^(0),U,3)
"RTN","RCTCSPD4",30,0)
 S DIE="^PRCA(433,",DA=PRCAEN
"RTN","RCTCSPD4",31,0)
 S DR=".03///"_PRCABN ;Bill Number
"RTN","RCTCSPD4",32,0)
 S DR=DR_";3///0" ;Calm Code Done
"RTN","RCTCSPD4",33,0)
 S DR=DR_";12///"_$O(^PRCA(430.3,"AC",36,0)) ;Transaction Type
"RTN","RCTCSPD4",34,0)
 S DR=DR_";15///0" ;Transaction Amount
"RTN","RCTCSPD4",35,0)
 S DR=DR_";42///"_DUZ ;Processed by user
"RTN","RCTCSPD4",36,0)
 S DR=DR_";11///"_DT ;Transaction date
"RTN","RCTCSPD4",37,0)
 S DR=DR_";4///2" ;Transaction status (complete)
"RTN","RCTCSPD4",38,0)
 S DR=DR_";5.02///CS STOP DELETED" D ^DIE
"RTN","RCTCSPD4",39,0)
 Q
"RTN","RCTCSPD4",40,0)
 ;
"RTN","RCTCSPD4",41,0)
RCLL ; Recall from Cross-Servicing non-financial tx
"RTN","RCTCSPD4",42,0)
 N PRCAEN,PRCAA1,DR,DIE,DA,D0,PRCAD,RCASK,PRCAA2,PRCA,PRCATY,RCUSER,DUZ
"RTN","RCTCSPD4",43,0)
 ;DUZ is reserved, but in this case DUZ may be undefined due to batch background job
"RTN","RCTCSPD4",44,0)
 S PRCABN=BILL,DUZ=.5,DUZ(0)="@",DUZ(2)=1 ; Server has no DUZ, use Postmaster
"RTN","RCTCSPD4",45,0)
 D SETTR^PRCAUTL,PATTR^PRCAUTL Q:'$D(PRCAEN)
"RTN","RCTCSPD4",46,0)
 S PRCAA1=$S($D(^PRCA(433,PRCAEN,4,0)):+$P(^(0),U,4),1:0)
"RTN","RCTCSPD4",47,0)
 Q:PRCAA1'>0  S PRCAA2=$P(^(0),U,3)
"RTN","RCTCSPD4",48,0)
 S DIE="^PRCA(433,",DA=PRCAEN
"RTN","RCTCSPD4",49,0)
 S DR=".03///"_PRCABN ;Bill Number
"RTN","RCTCSPD4",50,0)
 S DR=DR_";3///0" ;Calm Code Done
"RTN","RCTCSPD4",51,0)
 S DR=DR_";12///"_$O(^PRCA(430.3,"AC",34,0)) ;Transaction Type
"RTN","RCTCSPD4",52,0)
 S DR=DR_";15///0" ;Transaction Amount
"RTN","RCTCSPD4",53,0)
 S DR=DR_";42///"_DUZ ;Processed by user
"RTN","RCTCSPD4",54,0)
 S DR=DR_";11///"_DT ;Transaction date
"RTN","RCTCSPD4",55,0)
 S DR=DR_";4///2" ;Transaction status (complete)
"RTN","RCTCSPD4",56,0)
 S DR=DR_";5.02///CS BILL RECALL" D ^DIE
"RTN","RCTCSPD4",57,0)
 Q
"RTN","RCTCSPD4",58,0)
 ;
"RTN","RCTCSPD4",59,0)
DELRCLL ; Cross-Servicing Delete Bill Recall non-financial tx
"RTN","RCTCSPD4",60,0)
 ;
"RTN","RCTCSPD4",61,0)
 N PRCAEN,PRCAA1,DR,DIE,DA,D0,PRCAD,RCASK,PRCAA2,PRCA,PRCATY,RCUSER
"RTN","RCTCSPD4",62,0)
 S PRCABN=BILL
"RTN","RCTCSPD4",63,0)
 D SETTR^PRCAUTL,PATTR^PRCAUTL Q:'$D(PRCAEN)
"RTN","RCTCSPD4",64,0)
 S PRCAA1=$S($D(^PRCA(433,PRCAEN,4,0)):+$P(^(0),U,4),1:0)
"RTN","RCTCSPD4",65,0)
 Q:PRCAA1'>0  S PRCAA2=$P(^(0),U,3)
"RTN","RCTCSPD4",66,0)
 S DIE="^PRCA(433,",DA=PRCAEN
"RTN","RCTCSPD4",67,0)
 S DR=".03///"_PRCABN ;Bill Number
"RTN","RCTCSPD4",68,0)
 S DR=DR_";3///0" ;Calm Code Done
"RTN","RCTCSPD4",69,0)
 S DR=DR_";12///"_$O(^PRCA(430.3,"AC",37,0)) ;Transaction Type
"RTN","RCTCSPD4",70,0)
 S DR=DR_";15///0" ;Transaction Amount
"RTN","RCTCSPD4",71,0)
 S DR=DR_";42///"_DUZ ;Processed by user
"RTN","RCTCSPD4",72,0)
 S DR=DR_";11///"_DT ;Transaction date
"RTN","RCTCSPD4",73,0)
 S DR=DR_";4///2" ;Transaction status (complete)
"RTN","RCTCSPD4",74,0)
 S DR=DR_";5.02///CS DEL BILL RECALL" D ^DIE
"RTN","RCTCSPD4",75,0)
 Q
"RTN","RCTCSPD4",76,0)
 ;
"RTN","RCTCSPD4",77,0)
NEWDEBTR ; CS add new debtor non-financial tx
"RTN","RCTCSPD4",78,0)
 ;         Called by RCTCSPD
"RTN","RCTCSPD4",79,0)
 N PRCAEN,PRCAA1,DR,DIE,DA,D0,PRCAD,RCASK,PRCAA2,PRCA,PRCATY,RCUSER,X,PRCABN
"RTN","RCTCSPD4",80,0)
 S PRCABN=BILL,DUZ=.5,DUZ(0)="@",DUZ(2)=1 ; Server has no DUZ, use Postmaster
"RTN","RCTCSPD4",81,0)
 D SETTR^PRCAUTL,PATTR^PRCAUTL Q:'$D(PRCAEN)
"RTN","RCTCSPD4",82,0)
 S PRCAA1=$S($D(^PRCA(433,PRCAEN,4,0)):+$P(^(0),U,4),1:0)
"RTN","RCTCSPD4",83,0)
 Q:PRCAA1'>0  S PRCAA2=$P(^(0),U,3)
"RTN","RCTCSPD4",84,0)
 S DIE="^PRCA(433,",DA=PRCAEN
"RTN","RCTCSPD4",85,0)
 S DR=".03///"_PRCABN ;Bill Number
"RTN","RCTCSPD4",86,0)
 S DR=DR_";3///0" ;Calm Code Done
"RTN","RCTCSPD4",87,0)
 S DR=DR_";12///"_$O(^PRCA(430.3,"AC",48,0)) ;Transaction Type
"RTN","RCTCSPD4",88,0)
 S DR=DR_";15///0" ;Transaction Amount
"RTN","RCTCSPD4",89,0)
 S DR=DR_";42///"_DUZ ;Processed by user
"RTN","RCTCSPD4",90,0)
 S DR=DR_";11///"_DT ;Transaction date
"RTN","RCTCSPD4",91,0)
 S DR=DR_";4///2" ;Transaction status (complete)
"RTN","RCTCSPD4",92,0)
 S DR=DR_";5.02///CS NEW DBTR NEW BILL" D ^DIE
"RTN","RCTCSPD4",93,0)
 Q
"RTN","RCTCSPD4",94,0)
 ;
"RTN","RCTCSPD4",95,0)
RCRSD ; CS Debtor Recall non-financial tx
"RTN","RCTCSPD4",96,0)
 ; Set this debtor for Recall from Cross-Servicing
"RTN","RCTCSPD4",97,0)
 N PRCAEN,PRCAA1,DR,DIE,DA,D0,PRCAD,RCASK,PRCAA2,PRCA,PRCATY,RCUSER,X
"RTN","RCTCSPD4",98,0)
 ;DUZ is reserved, but in this case DUZ may be undefined due to batch background job
"RTN","RCTCSPD4",99,0)
 S PRCABN=BILL,DUZ=.5,DUZ(0)="@",DUZ(2)=1 ; Server has no DUZ, use Postmaster
"RTN","RCTCSPD4",100,0)
 D SETTR^PRCAUTL,PATTR^PRCAUTL Q:'$D(PRCAEN)
"RTN","RCTCSPD4",101,0)
 S PRCAA1=$S($D(^PRCA(433,PRCAEN,4,0)):+$P(^(0),U,4),1:0)
"RTN","RCTCSPD4",102,0)
 Q:PRCAA1'>0  S PRCAA2=$P(^(0),U,3)
"RTN","RCTCSPD4",103,0)
 S DIE="^PRCA(433,",DA=PRCAEN
"RTN","RCTCSPD4",104,0)
 S DR=".03///"_PRCABN ; BILL NUMBER
"RTN","RCTCSPD4",105,0)
 S DR=DR_";3///0" ;Calm Code Done
"RTN","RCTCSPD4",106,0)
 S DR=DR_";12///"_$O(^PRCA(430.3,"AC",35,0)) ;Transaction Type
"RTN","RCTCSPD4",107,0)
 S DR=DR_";15///0" ;Transaction Amount
"RTN","RCTCSPD4",108,0)
 S DR=DR_";42///"_DUZ ;Processed by user
"RTN","RCTCSPD4",109,0)
 S DR=DR_";11///"_DT ;Transaction date
"RTN","RCTCSPD4",110,0)
 S DR=DR_";4///2" ;Transaction status (complete)
"RTN","RCTCSPD4",111,0)
 S DR=DR_";5.02///CS DEBTOR RECALL" D ^DIE
"RTN","RCTCSPD4",112,0)
 Q
"RTN","RCTCSPD4",113,0)
 ;
"RTN","RCTCSPD4",114,0)
DELSETD(BILL) ; CS Delete Debtor Recall non-financial tx
"RTN","RCTCSPD4",115,0)
 N PRCAEN,PRCAA1,DR,DIE,DA,D0,PRCAD,RCASK,PRCAA2,PRCA,PRCATY,RCUSERX
"RTN","RCTCSPD4",116,0)
 S PRCABN=BILL
"RTN","RCTCSPD4",117,0)
 D SETTR^PRCAUTL,PATTR^PRCAUTL Q:'$D(PRCAEN)
"RTN","RCTCSPD4",118,0)
 S PRCAA1=$S($D(^PRCA(433,PRCAEN,4,0)):+$P(^(0),U,4),1:0)
"RTN","RCTCSPD4",119,0)
 Q:PRCAA1'>0  S PRCAA2=$P(^(0),U,3)
"RTN","RCTCSPD4",120,0)
 S DIE="^PRCA(433,",DA=PRCAEN
"RTN","RCTCSPD4",121,0)
 S DR=".03///"_PRCABN ;Bill Number
"RTN","RCTCSPD4",122,0)
 S DR=DR_";3///0" ;Calm Code Done
"RTN","RCTCSPD4",123,0)
 S DR=DR_";12///"_$O(^PRCA(430.3,"AC",38,0)) ;Transaction Type
"RTN","RCTCSPD4",124,0)
 S DR=DR_";15///0" ;Transaction Amount
"RTN","RCTCSPD4",125,0)
 S DR=DR_";42///"_DUZ ;Processed by user
"RTN","RCTCSPD4",126,0)
 S DR=DR_";11///"_DT ;Transaction date
"RTN","RCTCSPD4",127,0)
 S DR=DR_";4///2" ;Transaction status (complete)
"RTN","RCTCSPD4",128,0)
 S DR=DR_";5.02///CS DEL DEBTOR RECALL" D ^DIE
"RTN","RCTCSPD4",129,0)
 Q
"RTN","RCTCSPD4",130,0)
 ;
"RTN","RCTCSPD4",131,0)
DEBTOR ; CS New Bill Existing Debtor non-financial tx
"RTN","RCTCSPD4",132,0)
 ;
"RTN","RCTCSPD4",133,0)
 N PRCAEN,PRCAA1,DR,DIE,DA,D0,PRCAD,RCASK,PRCAA2,PRCA,PRCATY,RCUSER,PRCABN
"RTN","RCTCSPD4",134,0)
 S PRCABN=BILL,DUZ=.5,DUZ(0)="@",DUZ(2)=1 ; Server has no DUZ, use Postmaster
"RTN","RCTCSPD4",135,0)
 D SETTR^PRCAUTL,PATTR^PRCAUTL Q:'$D(PRCAEN)
"RTN","RCTCSPD4",136,0)
 S PRCAA1=$S($D(^PRCA(433,PRCAEN,4,0)):+$P(^(0),U,4),1:0)
"RTN","RCTCSPD4",137,0)
 Q:PRCAA1'>0  S PRCAA2=$P(^(0),U,3)
"RTN","RCTCSPD4",138,0)
 S DIE="^PRCA(433,",DA=PRCAEN
"RTN","RCTCSPD4",139,0)
 S DR=".03///"_PRCABN ;Bill Number
"RTN","RCTCSPD4",140,0)
 S DR=DR_";3///0" ;Calm Code Done
"RTN","RCTCSPD4",141,0)
 S DR=DR_";12///"_$O(^PRCA(430.3,"AC",39,0)) ;Transaction Type
"RTN","RCTCSPD4",142,0)
 S DR=DR_";15///0" ;Transaction Amount
"RTN","RCTCSPD4",143,0)
 S DR=DR_";42///"_DUZ ;Processed by user
"RTN","RCTCSPD4",144,0)
 S DR=DR_";11///"_DT ;Transaction date
"RTN","RCTCSPD4",145,0)
 S DR=DR_";4///2" ;Transaction status (complete)
"RTN","RCTCSPD4",146,0)
 S DR=DR_";5.02///CS DEBTOR NEW BILL" D ^DIE ; Revised as requested
"RTN","RCTCSPD4",147,0)
 Q
"RTN","RCTCSPD4",148,0)
 ;
"RTN","RCTCSPD4",149,0)
CSCASE ;  Add Case Info non-financial tx 
"RTN","RCTCSPD4",150,0)
 N PRCAEN,PRCAA1,DR,DIE,DA,D0,PRCAD,RCASK,PRCAA2,PRCA,PRCATY,RCUSER
"RTN","RCTCSPD4",151,0)
 S PRCABN=BILL,DUZ=.5,DUZ(0)="@",DUZ(2)=1 ; Server has no DUZ, use Postmaster
"RTN","RCTCSPD4",152,0)
 D SETTR^PRCAUTL,PATTR^PRCAUTL Q:'$D(PRCAEN)
"RTN","RCTCSPD4",153,0)
 S PRCAA1=$S($D(^PRCA(433,PRCAEN,4,0)):+$P(^(0),U,4),1:0)
"RTN","RCTCSPD4",154,0)
 Q:PRCAA1'>0  S PRCAA2=$P(^(0),U,3)
"RTN","RCTCSPD4",155,0)
 S DIE="^PRCA(433,",DA=PRCAEN
"RTN","RCTCSPD4",156,0)
 S DR=".03///"_PRCABN ;Bill Number
"RTN","RCTCSPD4",157,0)
 S DR=DR_";3///0" ;Calm Code Done
"RTN","RCTCSPD4",158,0)
 S DR=DR_";12///"_$O(^PRCA(430.3,"AC",47,0)) ;Transaction Type
"RTN","RCTCSPD4",159,0)
 S DR=DR_";15///0" ;Transaction Amount
"RTN","RCTCSPD4",160,0)
 S DR=DR_";42///"_DUZ ;Processed by user
"RTN","RCTCSPD4",161,0)
 S DR=DR_";11///"_DT ;Transaction date
"RTN","RCTCSPD4",162,0)
 S DR=DR_";4///2" ;Transaction status (complete)
"RTN","RCTCSPD4",163,0)
 S DR=DR_";5.02///CS ADD CASE INFO" D ^DIE
"RTN","RCTCSPD4",164,0)
 Q
"RTN","RCTCSPD4",165,0)
 ;
"RTN","RCTCSPD4",166,0)
DELSETC ; Cross-Servicing delete case recall non-financial tx
"RTN","RCTCSPD4",167,0)
 N PRCAEN,PRCAA1,DR,DIE,DA,D0,PRCAD,RCASK,PRCAA2,PRCA,PRCATY,RCUSER
"RTN","RCTCSPD4",168,0)
 S PRCABN=BILL
"RTN","RCTCSPD4",169,0)
 D SETTR^PRCAUTL,PATTR^PRCAUTL Q:'$D(PRCAEN)
"RTN","RCTCSPD4",170,0)
 S PRCAA1=$S($D(^PRCA(433,PRCAEN,4,0)):+$P(^(0),U,4),1:0)
"RTN","RCTCSPD4",171,0)
 Q:PRCAA1'>0  S PRCAA2=$P(^(0),U,3)
"RTN","RCTCSPD4",172,0)
 S DIE="^PRCA(433,",DA=PRCAEN
"RTN","RCTCSPD4",173,0)
 S DR=".03///"_PRCABN ;Bill Number
"RTN","RCTCSPD4",174,0)
 S DR=DR_";3///0" ;Calm Code Done
"RTN","RCTCSPD4",175,0)
 S DR=DR_";12///"_$O(^PRCA(430.3,"AC",46,0)) ;Transaction Type
"RTN","RCTCSPD4",176,0)
 S DR=DR_";15///0" ;Transaction Amount
"RTN","RCTCSPD4",177,0)
 S DR=DR_";42///"_DUZ ;Processed by user
"RTN","RCTCSPD4",178,0)
 S DR=DR_";11///"_DT ;Transaction date
"RTN","RCTCSPD4",179,0)
 S DR=DR_";4///2" ;Transaction status (complete)
"RTN","RCTCSPD4",180,0)
 S DR=DR_";5.02///CS DEL CASE RECALL" D ^DIE
"RTN","RCTCSPD4",181,0)
 Q
"RTN","RCTCSPD4",182,0)
 ;
"RTN","RCTCSPD4",183,0)
DECADJ ; non-financial decrease adjustment transaction for 5b cross-servicing record
"RTN","RCTCSPD4",184,0)
 N PRCAEN,PRCAA1,DR,DIE,DA,D0,PRCAD,RCASK,PRCAA2,PRCA,PRCATY,RCUSER
"RTN","RCTCSPD4",185,0)
 S PRCABN=BILL
"RTN","RCTCSPD4",186,0)
 D SETTR^PRCAUTL,PATTR^PRCAUTL Q:'$D(PRCAEN)
"RTN","RCTCSPD4",187,0)
 S PRCAA1=$S($D(^PRCA(433,PRCAEN,4,0)):+$P(^(0),U,4),1:0)
"RTN","RCTCSPD4",188,0)
 Q:PRCAA1'>0  S PRCAA2=$P(^(0),U,3)
"RTN","RCTCSPD4",189,0)
 S DIE="^PRCA(433,",DA=PRCAEN
"RTN","RCTCSPD4",190,0)
 S DR=".03///"_PRCABN ;Bill Number
"RTN","RCTCSPD4",191,0)
 S DR=DR_";3///0" ;Calm Code Done
"RTN","RCTCSPD4",192,0)
 S DR=DR_";12///"_$O(^PRCA(430.3,"AC",49,0)) ;Transaction Type
"RTN","RCTCSPD4",193,0)
 S DR=DR_";15///0" ;Transaction Amount
"RTN","RCTCSPD4",194,0)
 S DR=DR_";42///"_DUZ ;Processed by user
"RTN","RCTCSPD4",195,0)
 S DR=DR_";11///"_DT ;Transaction date
"RTN","RCTCSPD4",196,0)
 S DR=DR_";4///2" ;Transaction status (complete)
"RTN","RCTCSPD4",197,0)
 S DR=DR_";5.02///CS DECREASE ADJ" D ^DIE
"RTN","RCTCSPD4",198,0)
 Q 
"RTN","RCTCSPD4",199,0)
 ;
"RTN","RCTCSPD4",200,0)
DECADJ0 ; decrease adjustment transaction deletes cs date
"RTN","RCTCSPD4",201,0)
 ; 5B tx takes bal. of bill to 0 
"RTN","RCTCSPD4",202,0)
 ; if node 7 balances = 0.  Called by RCTCSPD
"RTN","RCTCSPD4",203,0)
 N PRCAEN,PRCAA1,DR,DIE,DA,D0,PRCAD,RCASK,PRCAA2,PRCA,PRCATY,RCUSER
"RTN","RCTCSPD4",204,0)
 S PRCABN=BILL
"RTN","RCTCSPD4",205,0)
 D SETTR^PRCAUTL,PATTR^PRCAUTL Q:'$D(PRCAEN)
"RTN","RCTCSPD4",206,0)
 S PRCAA1=$S($D(^PRCA(433,PRCAEN,4,0)):+$P(^(0),U,4),1:0)
"RTN","RCTCSPD4",207,0)
 Q:PRCAA1'>0  S PRCAA2=$P(^(0),U,3)
"RTN","RCTCSPD4",208,0)
 S DIE="^PRCA(433,",DA=PRCAEN
"RTN","RCTCSPD4",209,0)
 S DR=".03///"_PRCABN ;Bill Number
"RTN","RCTCSPD4",210,0)
 S DR=DR_";3///0" ;Calm Code Done
"RTN","RCTCSPD4",211,0)
 S DR=DR_";12///"_$O(^PRCA(430.3,"AC",40,0)) ;Transaction Type
"RTN","RCTCSPD4",212,0)
 S DR=DR_";15///0" ;Transaction Amount
"RTN","RCTCSPD4",213,0)
 S DR=DR_";42///"_DUZ ;Processed by user
"RTN","RCTCSPD4",214,0)
 S DR=DR_";11///"_DT ;Transaction date
"RTN","RCTCSPD4",215,0)
 S DR=DR_";4///2" ;Transaction status (complete)
"RTN","RCTCSPD4",216,0)
 S DR=DR_";5.02///CS DECR ADJ NOT APP" D ^DIE
"RTN","RCTCSPD4",217,0)
 D CHKS
"RTN","RCTCSPD4",218,0)
 Q 
"RTN","RCTCSPD4",219,0)
 ;
"RTN","RCTCSPD4",220,0)
RCRSC ; Cross-Servicing case recall non-financial tx
"RTN","RCTCSPD4",221,0)
 N PRCAEN,PRCAA1,DR,DIE,DA,D0,PRCAD,RCASK,PRCAA2,PRCA,PRCATY,RCUSER
"RTN","RCTCSPD4",222,0)
 ;DUZ is reserved, but in this case DUZ may be undefined due to batch background job
"RTN","RCTCSPD4",223,0)
 S PRCABN=BILL,DUZ=.5,DUZ(0)="@",DUZ(2)=1 ; Server has no DUZ, use Postmaster
"RTN","RCTCSPD4",224,0)
 D SETTR^PRCAUTL,PATTR^PRCAUTL Q:'$D(PRCAEN)
"RTN","RCTCSPD4",225,0)
 S PRCAA1=$S($D(^PRCA(433,PRCAEN,4,0)):+$P(^(0),U,4),1:0)
"RTN","RCTCSPD4",226,0)
 Q:PRCAA1'>0  S PRCAA2=$P(^(0),U,3)
"RTN","RCTCSPD4",227,0)
 S DIE="^PRCA(433,",DA=PRCAEN
"RTN","RCTCSPD4",228,0)
 S DR=".03///"_PRCABN ;Bill Number
"RTN","RCTCSPD4",229,0)
 S DR=DR_";3///0" ;Calm Code Done
"RTN","RCTCSPD4",230,0)
 S DR=DR_";12///"_$O(^PRCA(430.3,"AC",45,0)) ;Transaction Type
"RTN","RCTCSPD4",231,0)
 S DR=DR_";15///0" ;Transaction Amount
"RTN","RCTCSPD4",232,0)
 S DR=DR_";42///"_DUZ ;Processed by user
"RTN","RCTCSPD4",233,0)
 S DR=DR_";11///"_DT ;Transaction date
"RTN","RCTCSPD4",234,0)
 S DR=DR_";4///2" ;Transaction status (complete)
"RTN","RCTCSPD4",235,0)
 S DR=DR_";5.02///CS CASE RECALL" D ^DIE
"RTN","RCTCSPD4",236,0)
 Q
"RTN","RCTCSPD4",237,0)
 ;
"RTN","RCTCSPD4",238,0)
CHKS ;Leave validation checks in place
"RTN","RCTCSPD4",239,0)
 I $P($G(^PRCA(433,PRCAEN,5)),"^",2)=""!'$P(^PRCA(433,PRCAEN,1),"^") S PRCACOMM="TRANSACTION INCOMPLETE" D DELETE^PRCAWO1 K PRCACOMM Q
"RTN","RCTCSPD4",240,0)
 I '$D(PRCAD("DELETE")) S RCASK=1 D TRANUP^PRCAUTL,UPPRIN^PRCADJ
"RTN","RCTCSPD4",241,0)
 I $P($G(^RCD(340,+$P(^PRCA(430,PRCABN,0),"^",9),0)),"^")[";DPT(" D
"RTN","RCTCSPD4",242,0)
 .;Ensure comment does not appear on patient statement
"RTN","RCTCSPD4",243,0)
 .S $P(^PRCA(433,PRCAEN,0),"^",10)=1
"RTN","RCTCSPD4",244,0)
 Q
"RTN","RCTCSPD4",245,0)
 ; End of RCTCSPD4
"RTN","RCTCSPD5")
0^11^B19943104^B19971041
"RTN","RCTCSPD5",1,0)
RCTCSPD5 ;ALB/LMH-CROSS-SERVICING NON-FINANCIAL TRANSACTIONS ;03/15/14 3:34 PM
"RTN","RCTCSPD5",2,0)
 ;;4.5;Accounts Receivable;**315,339**;Mar 20, 1995;Build 2
"RTN","RCTCSPD5",3,0)
 ;;Per VA Directive 6402, this routine should not be modified.
"RTN","RCTCSPD5",4,0)
 ;
"RTN","RCTCSPD5",5,0)
 Q
"RTN","RCTCSPD5",6,0)
 ;
"RTN","RCTCSPD5",7,0)
CSATRY ; Cross-Servicing Admin Adj Treasury Rev? Yes non-financial tx
"RTN","RCTCSPD5",8,0)
 N PRCAEN,PRCAA1,DR,DIE,DA,D0,PRCAD,RCASK,PRCAA2,PRCA,PRCATY,RCUSER,X
"RTN","RCTCSPD5",9,0)
 D SETTR^PRCAUTL,PATTR^PRCAUTL Q:'$D(PRCAEN)
"RTN","RCTCSPD5",10,0)
 S PRCAA1=$S($D(^PRCA(433,PRCAEN,4,0)):+$P(^(0),U,4),1:0)
"RTN","RCTCSPD5",11,0)
 Q:PRCAA1'>0  S PRCAA2=$P(^(0),U,3)
"RTN","RCTCSPD5",12,0)
 S DIE="^PRCA(433,",DA=PRCAEN
"RTN","RCTCSPD5",13,0)
 S DR=".03///"_PRCABN ;Bill Number
"RTN","RCTCSPD5",14,0)
 S DR=DR_";3///0" ;Calm Code Done
"RTN","RCTCSPD5",15,0)
 S DR=DR_";12///"_$O(^PRCA(430.3,"AC",53,0)) ;Transaction Type
"RTN","RCTCSPD5",16,0)
 S DR=DR_";15///0" ;Transaction Amount
"RTN","RCTCSPD5",17,0)
 S DR=DR_";42///"_DUZ ;Processed by user
"RTN","RCTCSPD5",18,0)
 S DR=DR_";11///"_DT ;Transaction date
"RTN","RCTCSPD5",19,0)
 S DR=DR_";4///2" ;Transaction status (complete)
"RTN","RCTCSPD5",20,0)
 S DR=DR_";5.02///CS ADMIN ADJ TR REV?Y" D ^DIE
"RTN","RCTCSPD5",21,0)
 Q
"RTN","RCTCSPD5",22,0)
 ;
"RTN","RCTCSPD5",23,0)
CSATRN ; Cross-Servicing Admin Adj Treasury Rev? No non-financial tx
"RTN","RCTCSPD5",24,0)
 N PRCAEN,PRCAA1,DR,DIE,DA,D0,PRCAD,RCASK,PRCAA2,PRCA,PRCATY,RCUSER,X
"RTN","RCTCSPD5",25,0)
 D SETTR^PRCAUTL,PATTR^PRCAUTL Q:'$D(PRCAEN)
"RTN","RCTCSPD5",26,0)
 S PRCAA1=$S($D(^PRCA(433,PRCAEN,4,0)):+$P(^(0),U,4),1:0)
"RTN","RCTCSPD5",27,0)
 Q:PRCAA1'>0  S PRCAA2=$P(^(0),U,3)
"RTN","RCTCSPD5",28,0)
 S DIE="^PRCA(433,",DA=PRCAEN
"RTN","RCTCSPD5",29,0)
 S DR=".03///"_PRCABN ;Bill Number
"RTN","RCTCSPD5",30,0)
 S DR=DR_";3///0" ;Calm Code Done
"RTN","RCTCSPD5",31,0)
 S DR=DR_";12///"_$O(^PRCA(430.3,"AC",54,0)) ;Transaction Type
"RTN","RCTCSPD5",32,0)
 S DR=DR_";15///0" ;Transaction Amount
"RTN","RCTCSPD5",33,0)
 S DR=DR_";42///"_DUZ ;Processed by user
"RTN","RCTCSPD5",34,0)
 S DR=DR_";11///"_DT ;Transaction date
"RTN","RCTCSPD5",35,0)
 S DR=DR_";4///2" ;Transaction status (complete)
"RTN","RCTCSPD5",36,0)
 S DR=DR_";5.02///CS ADMIN ADJ TR REV?N" D ^DIE
"RTN","RCTCSPD5",37,0)
 Q
"RTN","RCTCSPD5",38,0)
 ;
"RTN","RCTCSPD5",39,0)
CSITRY ; Cross-Servicing Incr Adj Treasury Rev? Yes non-financial tx
"RTN","RCTCSPD5",40,0)
 N PRCAEN,PRCAA1,DR,DIE,DA,D0,PRCAD,RCASK,PRCAA2,PRCA,PRCATY,RCUSER,X
"RTN","RCTCSPD5",41,0)
 D SETTR^PRCAUTL,PATTR^PRCAUTL Q:'$D(PRCAEN)
"RTN","RCTCSPD5",42,0)
 S PRCAA1=$S($D(^PRCA(433,PRCAEN,4,0)):+$P(^(0),U,4),1:0)
"RTN","RCTCSPD5",43,0)
 Q:PRCAA1'>0  S PRCAA2=$P(^(0),U,3)
"RTN","RCTCSPD5",44,0)
 S DIE="^PRCA(433,",DA=PRCAEN
"RTN","RCTCSPD5",45,0)
 S DR=".03///"_PRCABN ;Bill Number
"RTN","RCTCSPD5",46,0)
 S DR=DR_";3///0" ;Calm Code Done
"RTN","RCTCSPD5",47,0)
 S DR=DR_";12///"_$O(^PRCA(430.3,"AC",57,0)) ;Transaction Type
"RTN","RCTCSPD5",48,0)
 S DR=DR_";15///0" ;Transaction Amount
"RTN","RCTCSPD5",49,0)
 S DR=DR_";42///"_DUZ ;Processed by user
"RTN","RCTCSPD5",50,0)
 S DR=DR_";11///"_DT ;Transaction date
"RTN","RCTCSPD5",51,0)
 S DR=DR_";4///2" ;Transaction status (complete)
"RTN","RCTCSPD5",52,0)
 S DR=DR_";5.02///CS INC ADJ TR REV?Y" D ^DIE
"RTN","RCTCSPD5",53,0)
 Q
"RTN","RCTCSPD5",54,0)
 ;
"RTN","RCTCSPD5",55,0)
CSITRN ; Cross-Servicing Incr Adj Treasury Rev? No non-financial tx
"RTN","RCTCSPD5",56,0)
 N PRCAEN,PRCAA1,DR,DIE,DA,D0,PRCAD,RCASK,PRCAA2,PRCA,PRCATY,RCUSER,X
"RTN","RCTCSPD5",57,0)
 D SETTR^PRCAUTL,PATTR^PRCAUTL Q:'$D(PRCAEN)
"RTN","RCTCSPD5",58,0)
 S PRCAA1=$S($D(^PRCA(433,PRCAEN,4,0)):+$P(^(0),U,4),1:0)
"RTN","RCTCSPD5",59,0)
 Q:PRCAA1'>0  S PRCAA2=$P(^(0),U,3)
"RTN","RCTCSPD5",60,0)
 S DIE="^PRCA(433,",DA=PRCAEN
"RTN","RCTCSPD5",61,0)
 S DR=".03///"_PRCABN ;Bill Number
"RTN","RCTCSPD5",62,0)
 S DR=DR_";3///0" ;Calm Code Done
"RTN","RCTCSPD5",63,0)
 S DR=DR_";12///"_$O(^PRCA(430.3,"AC",58,0)) ;Transaction Type
"RTN","RCTCSPD5",64,0)
 S DR=DR_";15///0" ;Transaction Amount
"RTN","RCTCSPD5",65,0)
 S DR=DR_";42///"_DUZ ;Processed by user
"RTN","RCTCSPD5",66,0)
 S DR=DR_";11///"_DT ;Transaction date
"RTN","RCTCSPD5",67,0)
 S DR=DR_";4///2" ;Transaction status (complete)
"RTN","RCTCSPD5",68,0)
 S DR=DR_";5.02///CS INC ADJ TR REV?N" D ^DIE
"RTN","RCTCSPD5",69,0)
 Q
"RTN","RCTCSPD5",70,0)
 ;
"RTN","RCTCSPD5",71,0)
CSPRTR ; Cross-Servicing PENDING RECONCILIATION non-financial tx  
"RTN","RCTCSPD5",72,0)
 ;       Called by R1^RCTCSPRS
"RTN","RCTCSPD5",73,0)
 N PRCAEN,PRCAA1,DR,DIE,DA,D0,PRCAD,RCASK,PRCAA2,PRCA,PRCATY,RCUSER,DUZ
"RTN","RCTCSPD5",74,0)
 ; DUZ is reserved, but in this case DUZ may be undefined due to a server background job, but we don't want to overwrite DUZ if it exists
"RTN","RCTCSPD5",75,0)
 S PRCABN=BILL,DUZ=.5,DUZ(0)="@",DUZ(2)=1 ; Server has no DUZ, use Postmaster
"RTN","RCTCSPD5",76,0)
 D SETTR^PRCAUTL,PATTR^PRCAUTL Q:'$D(PRCAEN)
"RTN","RCTCSPD5",77,0)
 S PRCAA1=$S($D(^PRCA(433,PRCAEN,4,0)):+$P(^(0),U,4),1:0)
"RTN","RCTCSPD5",78,0)
 Q:PRCAA1'>0  S PRCAA2=$P(^(0),U,3)
"RTN","RCTCSPD5",79,0)
 S DIE="^PRCA(433,",DA=PRCAEN
"RTN","RCTCSPD5",80,0)
 S DR=".03///"_PRCABN ;Bill Number
"RTN","RCTCSPD5",81,0)
 S DR=DR_";3///0" ;Calm Code Done
"RTN","RCTCSPD5",82,0)
 S DR=DR_";12///"_$O(^PRCA(430.3,"AC",61,0)) ;Transaction Type
"RTN","RCTCSPD5",83,0)
 S DR=DR_";15///0" ;Transaction Amount
"RTN","RCTCSPD5",84,0)
 S DR=DR_";42///"_DUZ ;Processed by user
"RTN","RCTCSPD5",85,0)
 S DR=DR_";11///"_DT ;Transaction date
"RTN","RCTCSPD5",86,0)
 S DR=DR_";4///2" ;Transaction status (complete)
"RTN","RCTCSPD5",87,0)
 S DR=DR_";5.02///CS PEND RECON" D ^DIE
"RTN","RCTCSPD5",88,0)
 Q
"RTN","RCTCSPD5",89,0)
 ;
"RTN","RCTCSPD5",90,0)
CSRCLPL ; CS RECALL placed non-financial tx
"RTN","RCTCSPD5",91,0)
 N PRCAEN,PRCAA1,DR,DIE,DA,D0,PRCAD,RCASK,PRCAA2,PRCA,PRCATY,RCUSER
"RTN","RCTCSPD5",92,0)
 S PRCABN=BILL
"RTN","RCTCSPD5",93,0)
 D SETTR^PRCAUTL,PATTR^PRCAUTL Q:'$D(PRCAEN)
"RTN","RCTCSPD5",94,0)
 S PRCAA1=$S($D(^PRCA(433,PRCAEN,4,0)):+$P(^(0),U,4),1:0)
"RTN","RCTCSPD5",95,0)
 Q:PRCAA1'>0  S PRCAA2=$P(^(0),U,3)
"RTN","RCTCSPD5",96,0)
 S DIE="^PRCA(433,",DA=PRCAEN
"RTN","RCTCSPD5",97,0)
 S DR=".03///"_PRCABN ;Bill Number
"RTN","RCTCSPD5",98,0)
 S DR=DR_";3///0" ;Calm Code Done
"RTN","RCTCSPD5",99,0)
 S DR=DR_";12///"_$O(^PRCA(430.3,"AC",62,0)) ;Transaction Type
"RTN","RCTCSPD5",100,0)
 S DR=DR_";15///0" ;Transaction Amount
"RTN","RCTCSPD5",101,0)
 S DR=DR_";42///"_DUZ ;Processed by user
"RTN","RCTCSPD5",102,0)
 S DR=DR_";11///"_DT ;Transaction date
"RTN","RCTCSPD5",103,0)
 S DR=DR_";4///2" ;Transaction status (complete)
"RTN","RCTCSPD5",104,0)
 S DR=DR_";5.02///CS RECALL PLACED" D ^DIE
"RTN","RCTCSPD5",105,0)
 Q
"RTN","RCTCSPD5",106,0)
 ; End of RCTCSPD5
"RTN","RCTCSWL1")
0^12^B54064527^B54202527
"RTN","RCTCSWL1",1,0)
RCTCSWL1 ;ALB/PAW-Cross Servicing Worklist ;30-SEP-2015
"RTN","RCTCSWL1",2,0)
 ;;4.5;ACCOUNTS RECEIVABLE;**315,339**;Mar 20, 1995;Build 2
"RTN","RCTCSWL1",3,0)
 ;;Per VA Directive 6402, this routine should not be modified.
"RTN","RCTCSWL1",4,0)
 ;
"RTN","RCTCSWL1",5,0)
GETRPT(RCRPT) ; Create patient report based upon report selection
"RTN","RCTCSWL1",6,0)
 ; required input RCRPT (see comments below for number/report correlation)
"RTN","RCTCSWL1",7,0)
 ; output ^TMP("RCTCSWL",$J), containing auths for group queue
"RTN","RCTCSWL1",8,0)
 N RCBILLEX,RCDATE,RCDEBTOR,RCDFN,RCBILL,RCDBTRN,RCDFN,RCFND1,RCTRAN,RCRTCD,RCRTCDX,RCUNC,RCPIF,RCSPA,RCDIV,RCDIVX
"RTN","RCTCSWL1",9,0)
 ; Loop through ACCOUNTS RECEIVABLE File (#430) Cross-Servicing Index
"RTN","RCTCSWL1",10,0)
 S RCDATE="" F  S RCDATE=$O(^PRCA(430,"AN",RCDATE)) Q:RCDATE=""  D
"RTN","RCTCSWL1",11,0)
 .S RCBILL="" F  S RCBILL=$O(^PRCA(430,"AN",RCDATE,RCBILL)) Q:RCBILL=""  D
"RTN","RCTCSWL1",12,0)
 ..I +$P($G(^PRCA(430,RCBILL,30)),U,9) Q  ;Bill has been removed from CS Reconciliation Worklist
"RTN","RCTCSWL1",13,0)
 ..S RCDEBTOR=$P($G(^PRCA(430,RCBILL,0)),U,9)  ;Debtor in File 340
"RTN","RCTCSWL1",14,0)
 ..I $P($G(^RCD(340,RCDEBTOR,0)),U,1)["DPT" S RCDFN=+$P($G(^RCD(340,RCDEBTOR,0)),U,1)
"RTN","RCTCSWL1",15,0)
 ..S RCRTCD=$P($G(^PRCA(430,RCBILL,30)),U,2)
"RTN","RCTCSWL1",16,0)
 ..I RCRTCD="" Q
"RTN","RCTCSWL1",17,0)
 ..S RCRTCDX=$P(^PRCA(430.5,RCRTCD,0),U)
"RTN","RCTCSWL1",18,0)
 ..S RCBILLEX=$P(^PRCA(430,RCBILL,0),U)
"RTN","RCTCSWL1",19,0)
 ..; Check if running for specific Division - MEDICAL CENTER DIVISION File #40.8
"RTN","RCTCSWL1",20,0)
 ..S RCDIV=$P(RCBILLEX,"-")
"RTN","RCTCSWL1",21,0)
 ..S RCDIVX="" I VAUTD=0 I '$D(VAUTD(RCDIV)) Q
"RTN","RCTCSWL1",22,0)
 ..; Check if running for specific Patient
"RTN","RCTCSWL1",23,0)
 ..I $P(FILTERS(0),U,3)=1 I '$D(RCDFN) Q
"RTN","RCTCSWL1",24,0)
 ..I $P(FILTERS(0),U,3)=1 I '$D(FILTERS(2,RCDFN)) Q
"RTN","RCTCSWL1",25,0)
 ..; Specific checks for each type of report
"RTN","RCTCSWL1",26,0)
 ..I RCRPT=1 I RCRTCDX'="B" Q  ;Bankruptcy Return Reason code B
"RTN","RCTCSWL1",27,0)
 ..I RCRPT=2 I RCRTCDX'="D" Q  ;Death Return Reason Code D
"RTN","RCTCSWL1",28,0)
 ..I RCRPT=3 I RCRTCDX'="Z" Q  ;Uncollectable Return Reason Code Z
"RTN","RCTCSWL1",29,0)
 ..I RCRPT=4 I RCRTCDX'="F" Q  ;Payment in Full - Return Reason Code = F
"RTN","RCTCSWL1",30,0)
 ..I RCRPT=5 I RCRTCDX'="P" Q  ;Satisfied PA - Return Reason Code = P, but nothing in Compromise Field
"RTN","RCTCSWL1",31,0)
 ..I RCRPT=6 I RCRTCDX'="S" Q  ;Compromise Field set to Y
"RTN","RCTCSWL1",32,0)
 ..I RCRPT=7 I RCRTCDX="" Q  ;Any Return Reason Code
"RTN","RCTCSWL1",33,0)
 ..D BLDTMP
"RTN","RCTCSWL1",34,0)
 Q
"RTN","RCTCSWL1",35,0)
 ;
"RTN","RCTCSWL1",36,0)
BLDTMP ; Build ^TMP("RCTCSWL",$J) for the main list screen
"RTN","RCTCSWL1",37,0)
 N A1,A2,PRCA3,DFN,RCBAL,RCBILLEX,RCNAME,RCPTID,RCRTRSN,RCLINE,VA,VADM,VAERR,TRTYP,RCBIND
"RTN","RCTCSWL1",38,0)
 I $D(RCDFN) D
"RTN","RCTCSWL1",39,0)
 . S DFN=RCDFN
"RTN","RCTCSWL1",40,0)
 . D DEM^VADPT
"RTN","RCTCSWL1",41,0)
 . I VAERR K VADM
"RTN","RCTCSWL1",42,0)
 . S RCNAME=VADM(1)
"RTN","RCTCSWL1",43,0)
 . S RCPTID=$E(RCNAME,1)_VA("BID")
"RTN","RCTCSWL1",44,0)
 S A1=$P(^RCD(340,RCDEBTOR,0),";",1),A2=$P($P(^(0),U,1),";",2),PRCA3=U_A2_A1_",0)",RCNAME=$S($D(@PRCA3):$P(^(0),U,1),1:"")
"RTN","RCTCSWL1",45,0)
 S RCBAL=$$GET1^DIQ(430,RCBILL_",",11)
"RTN","RCTCSWL1",46,0)
 S RCBILLEX=$P($G(^PRCA(430,RCBILL,0)),U,1)  ;External Bill Number
"RTN","RCTCSWL1",47,0)
 ; Set historical indicator "y" when returned from Treasury
"RTN","RCTCSWL1",48,0)
 I $D(^PRCA(430,"AN",RCDATE,RCBILL)) S RCBIND="y"
"RTN","RCTCSWL1",49,0)
 S RCLINE=$G(RCNAME)_U_$G(RCPTID)_U_$G(RCBAL)_U_$G(DFN)_U_$G(RCBIND)_$G(RCBILLEX)_U_RCDEBTOR_U_RCBILL_U_RCDATE_U_RCRTCDX
"RTN","RCTCSWL1",50,0)
 ; Sort by Patient Name
"RTN","RCTCSWL1",51,0)
 I SORTBY=1 S ^TMP("RCTCSWL",$J,RCNAME,RCBILLEX)=RCLINE
"RTN","RCTCSWL1",52,0)
 ; Sort by Bill Number
"RTN","RCTCSWL1",53,0)
 I SORTBY=2 S ^TMP("RCTCSWL",$J,RCBILLEX,RCNAME)=RCLINE
"RTN","RCTCSWL1",54,0)
 ; Sort by Return Reason Code
"RTN","RCTCSWL1",55,0)
 I SORTBY=3 S ^TMP("RCTCSWL",$J,RCRTCDX,RCBILLEX)=RCLINE
"RTN","RCTCSWL1",56,0)
 ;
"RTN","RCTCSWL1",57,0)
BLDWL ; Format main list screen data lines
"RTN","RCTCSWL1",58,0)
 ; build display lines
"RTN","RCTCSWL1",59,0)
 K ^TMP("RCTCSWLX",$J)
"RTN","RCTCSWL1",60,0)
 N RCBILL,RCBILLEX,RCDATE,RCDEBTOR,RCDFN,RCNAME,RCPATNAM,RCPTID,RCRRSN,RCXX,RCY,RCYY,FIRST,LINE,VCNT
"RTN","RCTCSWL1",61,0)
 S (VALMCNT,FIRST,VCNT)=0
"RTN","RCTCSWL1",62,0)
 S RCY="" F  S RCY=$O(^TMP("RCTCSWL",$J,RCY)) Q:RCY=""  D
"RTN","RCTCSWL1",63,0)
 .S RCYY="" F  S RCYY=$O(^TMP("RCTCSWL",$J,RCY,RCYY)) Q:RCYY=""  D
"RTN","RCTCSWL1",64,0)
 ..S VCNT=VCNT+1
"RTN","RCTCSWL1",65,0)
 ..S LINE=$$LJ^XLFSTR(VCNT,6) ;line #
"RTN","RCTCSWL1",66,0)
 ..S RCXX=^TMP("RCTCSWL",$J,RCY,RCYY)
"RTN","RCTCSWL1",67,0)
 ..S RCPATNAM=$P(RCXX,U)
"RTN","RCTCSWL1",68,0)
 ..S RCPTID=$P(RCXX,U,2)
"RTN","RCTCSWL1",69,0)
 ..S RCDFN=$P(RCXX,U,4)
"RTN","RCTCSWL1",70,0)
 ..S RCBILLEX=$P(RCXX,U,5)
"RTN","RCTCSWL1",71,0)
 ..S RCDEBTOR=$P(RCXX,U,6)
"RTN","RCTCSWL1",72,0)
 ..S RCBILL=$P(RCXX,U,7)
"RTN","RCTCSWL1",73,0)
 ..S RCDATE=$P(RCXX,U,8)
"RTN","RCTCSWL1",74,0)
 ..S RCRRSN=$P(RCXX,U,9)
"RTN","RCTCSWL1",75,0)
 ..I SORTBY=1 D
"RTN","RCTCSWL1",76,0)
 ...;Patient^Patient ID^Bill No.^Balance^Ret Rsn
"RTN","RCTCSWL1",77,0)
 ...S LINE=$$SETL(LINE,$P(RCXX,U),"",4,27)
"RTN","RCTCSWL1",78,0)
 ...S LINE=$$SETL(LINE,$P(RCXX,U,2),"",32,5)
"RTN","RCTCSWL1",79,0)
 ...S LINE=$$SETL(LINE,$P(RCXX,U,5),"",40,12)
"RTN","RCTCSWL1",80,0)
 ...S LINE=$$SETL(LINE,$J($P(RCXX,U,3),10,2),"",55,12)
"RTN","RCTCSWL1",81,0)
 ...S LINE=$$SETL(LINE,$P(RCXX,U,9),"",67,3)
"RTN","RCTCSWL1",82,0)
 ..I SORTBY=2 D
"RTN","RCTCSWL1",83,0)
 ...;Bill No.^Patient ID^Patient^Balance^Ret Rsn
"RTN","RCTCSWL1",84,0)
 ...S LINE=$$SETL(LINE,$P(RCXX,U,5),"",4,12)
"RTN","RCTCSWL1",85,0)
 ...S LINE=$$SETL(LINE,$P(RCXX,U,2),"",17,5)
"RTN","RCTCSWL1",86,0)
 ...S LINE=$$SETL(LINE,$P(RCXX,U),"",24,27)
"RTN","RCTCSWL1",87,0)
 ...S LINE=$$SETL(LINE,$J($P(RCXX,U,3),10,2),"",55,12)
"RTN","RCTCSWL1",88,0)
 ...S LINE=$$SETL(LINE,$P(RCXX,U,9),"",67,3)
"RTN","RCTCSWL1",89,0)
 ..I SORTBY=3 D
"RTN","RCTCSWL1",90,0)
 ...;Ret Rsn^Bill No.^Pt ID^Patient^Balance  
"RTN","RCTCSWL1",91,0)
 ...S LINE=$$SETL(LINE,$P(RCXX,U,9),"",4,7)
"RTN","RCTCSWL1",92,0)
 ...S LINE=$$SETL(LINE,$P(RCXX,U,5),"",12,12)
"RTN","RCTCSWL1",93,0)
 ...S LINE=$$SETL(LINE,$P(RCXX,U,2),"",25,5)
"RTN","RCTCSWL1",94,0)
 ...S LINE=$$SETL(LINE,$P(RCXX,U),"",32,27)
"RTN","RCTCSWL1",95,0)
 ...S LINE=$$SETL(LINE,$J($P(RCXX,U,2),10,2),"",64,12)
"RTN","RCTCSWL1",96,0)
 ..S VALMCNT=VALMCNT+1
"RTN","RCTCSWL1",97,0)
 ..D SET^VALM10(VALMCNT,LINE,VCNT)
"RTN","RCTCSWL1",98,0)
 ..S ^TMP("RCTCSWLX",$J,VCNT)=RCDFN_U_RCPATNAM_U_RCPTID_U_RCDEBTOR_U_RCBILL_U_RCBILLEX_U_RCDATE_U_RCRRSN  ;This is set for ACTIONS
"RTN","RCTCSWL1",99,0)
 Q
"RTN","RCTCSWL1",100,0)
 ;
"RTN","RCTCSWL1",101,0)
SETL(LINE,DATA,LABEL,COL,LNG) ; Creates a line of data to be set into the body
"RTN","RCTCSWL1",102,0)
 ; of the worklist
"RTN","RCTCSWL1",103,0)
 ; Input: LINE - Current line being created
"RTN","RCTCSWL1",104,0)
 ; DATA - Information to be added to the end of the current line
"RTN","RCTCSWL1",105,0)
 ; LABEL - Label to describe the information being added
"RTN","RCTCSWL1",106,0)
 ; COL - Column position in line to add information add
"RTN","RCTCSWL1",107,0)
 ; LNG - Maximum length of data information to include on the line
"RTN","RCTCSWL1",108,0)
 ; Returns: Line updated with added information
"RTN","RCTCSWL1",109,0)
 S LINE=LINE_$J("",(COL-$L(LABEL)-$L(LINE)))_LABEL_$E(DATA,1,LNG)
"RTN","RCTCSWL1",110,0)
 Q LINE
"RTN","RCTCSWL1",111,0)
 ;
"RTN","RCTCSWL1",112,0)
EXCEL ;Format and Print EXCEL file
"RTN","RCTCSWL1",113,0)
 W @IOF
"RTN","RCTCSWL1",114,0)
 N RCX,RCXX,RCY,RCYY,RCZ,RCAMT
"RTN","RCTCSWL1",115,0)
 S RCX=$P(FILTERS(0),U,1)
"RTN","RCTCSWL1",116,0)
 S RCXX=$S(RCX=1:"Bankruptcy",RCX=2:"Deaths",RCX=3:"Uncollectible",RCX=4:"Payment in Full",1:"")
"RTN","RCTCSWL1",117,0)
 I $G(RCXX)="" S RCXX=$S(RCX=5:"Satisfied PA",RCX=6:"Compromise",RCX=7:"All Returns",1:"")
"RTN","RCTCSWL1",118,0)
 W !,RCXX_" Report"
"RTN","RCTCSWL1",119,0)
 I SORTBY=1 W !,"Patient Name^Patient ID^Bill Number^Current Amount^Rt Rsn Code"
"RTN","RCTCSWL1",120,0)
 I SORTBY=2 W !,"Bill Number^Patient ID^Patient Name^Current Amount^Rt Rsn Code"
"RTN","RCTCSWL1",121,0)
 I SORTBY=3 W !,"Rt Rsn Code^Bill Number^Patient ID^Patient Name^Current Amount"
"RTN","RCTCSWL1",122,0)
 S RCY="" F  S RCY=$O(^TMP("RCTCSWL",$J,RCY)) Q:RCY=""  D
"RTN","RCTCSWL1",123,0)
 .S RCYY="" F  S RCYY=$O(^TMP("RCTCSWL",$J,RCY,RCYY)) Q:RCYY=""  D
"RTN","RCTCSWL1",124,0)
 ..S RCZ=^TMP("RCTCSWL",$J,RCY,RCYY)
"RTN","RCTCSWL1",125,0)
 ..;Reformat Excel line, based upon sort
"RTN","RCTCSWL1",126,0)
 ..;Input from RCZ: PtName_U_PtID_U_CurBal_U_DFN_U_Bill No_U_Debtor_U_InternalBill_U_Date_U_ReturnReasonCode
"RTN","RCTCSWL1",127,0)
 ..S RCAMT=$P(RCZ,U,3)
"RTN","RCTCSWL1",128,0)
 ..I RCAMT="" S RCAMT=0
"RTN","RCTCSWL1",129,0)
 ..S RCAMT=$J(RCAMT,10,2)
"RTN","RCTCSWL1",130,0)
 ..I SORTBY=1 W !,$P(RCZ,U)_"^",$P(RCZ,U,2)_"^"_$P(RCZ,U,5)_"^"_RCAMT_"^"_$P(RCZ,U,9)
"RTN","RCTCSWL1",131,0)
 ..I SORTBY=2 W !,$P(RCZ,U,5)_"^",$P(RCZ,U,2)_"^"_$P(RCZ,U)_"^"_RCAMT_"^"_$P(RCZ,U,9)
"RTN","RCTCSWL1",132,0)
 ..I SORTBY=3 W !,$P(RCZ,U,9)_"^",$P(RCZ,U,5)_"^"_$P(RCZ,U,2)_"^"_$P(RCZ,U)_"^"_RCAMT
"RTN","RCTCSWL1",133,0)
 I $E(IOST,1,2)="C-",'EXCEL R !!,"END OF REPORT...PRESS RETURN TO CONTINUE",X:DTIME W @IOF
"RTN","RCTCSWL1",134,0)
 D ^%ZISC
"RTN","RCTCSWL1",135,0)
 S:$D(ZTQUEUED) ZTREQ="@"
"RTN","RCTCSWL1",136,0)
 K IOP,%ZIS,ZTQUEUED
"RTN","RCTCSWL1",137,0)
 Q
"RTN","RCTCSWL1",138,0)
 ;
"RTN","RCTCSWL1",139,0)
 ;RCDIV() N DIC,DIR,DIRUT,DTOUT,DUOUT,X,Y
"RTN","RCTCSWL1",140,0)
 ;
"RTN","RCTCSWL1",141,0)
 ;Reset RCDIV array
"RTN","RCTCSWL1",142,0)
 K RCDIV
"RTN","RCTCSWL1",143,0)
 ;
"RTN","RCTCSWL1",144,0)
 ;First see if they want to enter individual divisions or ALL
"RTN","RCTCSWL1",145,0)
 S DIR(0)="S^D:DIVISION;A:ALL"
"RTN","RCTCSWL1",146,0)
 S DIR("A")="Select Certain (D)ivisions or (A)LL"
"RTN","RCTCSWL1",147,0)
 S DIR("L",1)="Select one of the following:"
"RTN","RCTCSWL1",148,0)
 S DIR("L",2)=""
"RTN","RCTCSWL1",149,0)
 S DIR("L",3)="     D         DIVISION"
"RTN","RCTCSWL1",150,0)
 S DIR("L",4)="     A         ALL"
"RTN","RCTCSWL1",151,0)
 D ^DIR K DIR
"RTN","RCTCSWL1",152,0)
 ;
"RTN","RCTCSWL1",153,0)
 ;Check for "^" or timeout, otherwise define BPPHARM
"RTN","RCTCSWL1",154,0)
 I ($G(DUOUT)=1)!($G(DTOUT)=1) S Y="^"
"RTN","RCTCSWL1",155,0)
 E  S RCDIV=$S(Y="A":0,1:1)
"RTN","RCTCSWL1",156,0)
 ;
"RTN","RCTCSWL1",157,0)
 ;If division selected, ask prompt
"RTN","RCTCSWL1",158,0)
 I $G(RCDIV)=1 F  D  Q:Y="^"!(Y="") 
"RTN","RCTCSWL1",159,0)
 .;
"RTN","RCTCSWL1",160,0)
 .;Prompt for entry
"RTN","RCTCSWL1",161,0)
 .K X S DIC(0)="QEAM",DIC=40.8,DIC("A")="Select Division(s): "
"RTN","RCTCSWL1",162,0)
 .W ! D ^DIC
"RTN","RCTCSWL1",163,0)
 .;
"RTN","RCTCSWL1",164,0)
 .;Check for "^" or timeout 
"RTN","RCTCSWL1",165,0)
 .I ($G(DUOUT)=1)!($G(DTOUT)=1) K RCDIV S Y="^" Q
"RTN","RCTCSWL1",166,0)
 .;
"RTN","RCTCSWL1",167,0)
 .;Check for blank entry, quit if no previous selections
"RTN","RCTCSWL1",168,0)
 .I $G(X)="" S Y=$S($D(RCDIV)>9:"",1:"^") K:Y="^" RCDIV Q
"RTN","RCTCSWL1",169,0)
 .;
"RTN","RCTCSWL1",170,0)
 .;Handle Deletes
"RTN","RCTCSWL1",171,0)
 .I $D(RCDIV(+Y)) D  Q:Y="^"  I 1
"RTN","RCTCSWL1",172,0)
 ..N P
"RTN","RCTCSWL1",173,0)
 ..S P=Y  ;Save Original Value
"RTN","RCTCSWL1",174,0)
 ..S DIR(0)="S^Y:YES;N:NO",DIR("A")="Delete "_$P(P,U,2)_" from your list?"
"RTN","RCTCSWL1",175,0)
 ..S DIR("B")="NO" D ^DIR
"RTN","RCTCSWL1",176,0)
 ..I ($G(DUOUT)=1)!($G(DTOUT)=1) K RCDIV S Y="^" Q
"RTN","RCTCSWL1",177,0)
 ..I Y="Y" K RCDIV(+P),RCDIV("B",$P(P,U,2),+P)
"RTN","RCTCSWL1",178,0)
 ..S Y=P  ;Restore Original Value
"RTN","RCTCSWL1",179,0)
 ..K P
"RTN","RCTCSWL1",180,0)
 .E  D
"RTN","RCTCSWL1",181,0)
 ..;Define new entries in RCDIV array
"RTN","RCTCSWL1",182,0)
 ..S VAUTD(+Y)=Y
"RTN","RCTCSWL1",183,0)
 ..S RCDIV("B",$P(Y,U,2),+Y)=""
"RTN","RCTCSWL1",184,0)
 .;
"RTN","RCTCSWL1",185,0)
 .;Display a list of selected divisions
"RTN","RCTCSWL1",186,0)
 .I $D(RCDIV)>9 D
"RTN","RCTCSWL1",187,0)
 ..N X
"RTN","RCTCSWL1",188,0)
 ..W !,?2,"Selected:"
"RTN","RCTCSWL1",189,0)
 ..S X="" F  S X=$O(RCDIV("B",X)) Q:X=""  W !,?10,X
"RTN","RCTCSWL1",190,0)
 ..K X
"RTN","RCTCSWL1",191,0)
 .Q
"RTN","RCTCSWL1",192,0)
 ;
"RTN","RCTCSWL1",193,0)
 K RCDIV("B")
"RTN","RCTCSWL1",194,0)
 Q Y
"RTN","RCTCSWL1",195,0)
 ;
"RTN","RCTCSWL1",196,0)
CSTOP(BILL) ;
"RTN","RCTCSWL1",197,0)
 ; Input:
"RTN","RCTCSWL1",198,0)
 ; BILL - Bill number from #430 - External Value (.01), not IEN
"RTN","RCTCSWL1",199,0)
 ; Output:
"RTN","RCTCSWL1",200,0)
 ; CSTOP - Cross-serviced status (blank = not found, 0 = not stopped, 1 = stopped)
"RTN","RCTCSWL1",201,0)
 ;
"RTN","RCTCSWL1",202,0)
 N CSTOP,IEN
"RTN","RCTCSWL1",203,0)
 I BILL="" Q ""  ;no bill #
"RTN","RCTCSWL1",204,0)
 I '$D(^PRCA(430,"TCSP",BILL)) Q ""
"RTN","RCTCSWL1",205,0)
 S CSTOP=$$GET1^DIQ(430,BILL,"157,","IE")
"RTN","RCTCSWL1",206,0)
 Q CSTOP
"VER")
8.0^22.2
"BLD",10361,6)
^294
**END**
**END**

