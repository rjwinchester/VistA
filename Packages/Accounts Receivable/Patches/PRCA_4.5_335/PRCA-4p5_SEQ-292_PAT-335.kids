Released PRCA*4.5*335 SEQ #292
Extracted from mail message
**KIDS**:PRCA*4.5*335^

**INSTALL NAME**
PRCA*4.5*335
"BLD",10475,0)
PRCA*4.5*335^ACCOUNTS RECEIVABLE^0^3171218^y
"BLD",10475,4,0)
^9.64PA^430.7^1
"BLD",10475,4,430.7,0)
430.7
"BLD",10475,4,430.7,222)
y^y^f^^^^n
"BLD",10475,4,"B",430.7,430.7)

"BLD",10475,6.3)
8
"BLD",10475,"ABPKG")
n
"BLD",10475,"INI")
PRE^PRCAP335
"BLD",10475,"INID")
^^y
"BLD",10475,"KRN",0)
^9.67PA^779.2^20
"BLD",10475,"KRN",.4,0)
.4
"BLD",10475,"KRN",.401,0)
.401
"BLD",10475,"KRN",.402,0)
.402
"BLD",10475,"KRN",.403,0)
.403
"BLD",10475,"KRN",.5,0)
.5
"BLD",10475,"KRN",.84,0)
.84
"BLD",10475,"KRN",3.6,0)
3.6
"BLD",10475,"KRN",3.8,0)
3.8
"BLD",10475,"KRN",9.2,0)
9.2
"BLD",10475,"KRN",9.8,0)
9.8
"BLD",10475,"KRN",9.8,"NM",0)
^9.68A^3^3
"BLD",10475,"KRN",9.8,"NM",1,0)
RCRJRCOU^^0^B133028607
"BLD",10475,"KRN",9.8,"NM",2,0)
RCRJRCOC^^0^B61570527
"BLD",10475,"KRN",9.8,"NM",3,0)
RCRJROIG^^0^B27320049
"BLD",10475,"KRN",9.8,"NM","B","RCRJRCOC",2)

"BLD",10475,"KRN",9.8,"NM","B","RCRJRCOU",1)

"BLD",10475,"KRN",9.8,"NM","B","RCRJROIG",3)

"BLD",10475,"KRN",19,0)
19
"BLD",10475,"KRN",19,"NM",0)
^9.68A^3^3
"BLD",10475,"KRN",19,"NM",1,0)
PRCA ARDC MONTHLY REPORT^^0
"BLD",10475,"KRN",19,"NM",2,0)
PRCAD RECONCILE MENU^^2
"BLD",10475,"KRN",19,"NM",3,0)
PRCAT USER^^2
"BLD",10475,"KRN",19,"NM","B","PRCA ARDC MONTHLY REPORT",1)

"BLD",10475,"KRN",19,"NM","B","PRCAD RECONCILE MENU",2)

"BLD",10475,"KRN",19,"NM","B","PRCAT USER",3)

"BLD",10475,"KRN",19.1,0)
19.1
"BLD",10475,"KRN",101,0)
101
"BLD",10475,"KRN",409.61,0)
409.61
"BLD",10475,"KRN",771,0)
771
"BLD",10475,"KRN",779.2,0)
779.2
"BLD",10475,"KRN",870,0)
870
"BLD",10475,"KRN",8989.51,0)
8989.51
"BLD",10475,"KRN",8989.52,0)
8989.52
"BLD",10475,"KRN",8994,0)
8994
"BLD",10475,"KRN","B",.4,.4)

"BLD",10475,"KRN","B",.401,.401)

"BLD",10475,"KRN","B",.402,.402)

"BLD",10475,"KRN","B",.403,.403)

"BLD",10475,"KRN","B",.5,.5)

"BLD",10475,"KRN","B",.84,.84)

"BLD",10475,"KRN","B",3.6,3.6)

"BLD",10475,"KRN","B",3.8,3.8)

"BLD",10475,"KRN","B",9.2,9.2)

"BLD",10475,"KRN","B",9.8,9.8)

"BLD",10475,"KRN","B",19,19)

"BLD",10475,"KRN","B",19.1,19.1)

"BLD",10475,"KRN","B",101,101)

"BLD",10475,"KRN","B",409.61,409.61)

"BLD",10475,"KRN","B",771,771)

"BLD",10475,"KRN","B",779.2,779.2)

"BLD",10475,"KRN","B",870,870)

"BLD",10475,"KRN","B",8989.51,8989.51)

"BLD",10475,"KRN","B",8989.52,8989.52)

"BLD",10475,"KRN","B",8994,8994)

"BLD",10475,"QUES",0)
^9.62^^
"BLD",10475,"REQB",0)
^9.611^3^3
"BLD",10475,"REQB",1,0)
PRCA*4.5*334^2
"BLD",10475,"REQB",2,0)
PRCA*4.5*320^2
"BLD",10475,"REQB",3,0)
PRCA*4.5*270^2
"BLD",10475,"REQB","B","PRCA*4.5*270",3)

"BLD",10475,"REQB","B","PRCA*4.5*320",2)

"BLD",10475,"REQB","B","PRCA*4.5*334",1)

"FIA",430.7)
AR DEBT COLLECTOR DATA
"FIA",430.7,0)
^PRCA(430.7,
"FIA",430.7,0,0)
430.7D
"FIA",430.7,0,1)
y^y^f^^^^n
"FIA",430.7,0,10)

"FIA",430.7,0,11)

"FIA",430.7,0,"RLRO")

"FIA",430.7,0,"VR")
4.5^PRCA
"FIA",430.7,430.7)
0
"FIA",430.7,430.71)
0
"INI")
PRE^PRCAP335
"KRN",19,1432,-1)
2^3
"KRN",19,1432,0)
PRCAT USER^AR - Accounts Receivable Menu^^M^.5^^^^^^^142^^^
"KRN",19,1432,10,0)
^19.01IP^22^10
"KRN",19,1432,10,22,0)
14125
"KRN",19,1432,10,22,"^")
PRCA ARDC MONTHLY REPORT
"KRN",19,1432,"U")
AR - ACCOUNTS RECEIVABLE MENU
"KRN",19,1450,-1)
2^2
"KRN",19,1450,0)
PRCAD RECONCILE MENU^Reconciliation Reports^^M^13202^^^^^^^
"KRN",19,1450,10,0)
^19.01IP^18^10
"KRN",19,1450,10,18,0)
14125
"KRN",19,1450,10,18,"^")
PRCA ARDC MONTHLY REPORT
"KRN",19,1450,"U")
RECONCILIATION REPORTS
"KRN",19,14125,-1)
0^1
"KRN",19,14125,0)
PRCA ARDC MONTHLY REPORT^ARDC Monthly Reconciliation Report^^R^^^^^^^^ACCOUNTS RECEIVABLE
"KRN",19,14125,1,0)
^^3^3^3171116^
"KRN",19,14125,1,1,0)
This report will provide a capture of the data that was sent to FMS and 
"KRN",19,14125,1,2,0)
OIG on the monthly roll up but in detail of the bills included and their 
"KRN",19,14125,1,3,0)
associated data at the time the roll up was done.
"KRN",19,14125,25)
EN^RCRJRCOU
"KRN",19,14125,"U")
ARDC MONTHLY RECONCILIATION RE
"MBREQ")
0
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"PKG",142,-1)
1^1
"PKG",142,0)
ACCOUNTS RECEIVABLE^PRCA^BILL COLLECTIONS
"PKG",142,20,0)
^9.402P^1^1
"PKG",142,20,1,0)
2^^PRCAMRG
"PKG",142,20,1,1)

"PKG",142,20,"B",2,1)

"PKG",142,22,0)
^9.49I^1^1
"PKG",142,22,1,0)
4.5^^2950320
"PKG",142,22,1,"PAH",1,0)
335^3171218
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
4
"RTN","PRCAP335")
0^^B2959437^n/a
"RTN","PRCAP335",1,0)
PRCAP335 ;OAK/ELZ - Pre-install routine for patch PRCA*4.5*335 ;11/15/2017
"RTN","PRCAP335",2,0)
 ;;4.5;Accounts Receivable;**335**;Mar 20, 1995;Build 8
"RTN","PRCAP335",3,0)
 ;;Per VA Directive 6402, this routine should not be modified.
"RTN","PRCAP335",4,0)
 ;
"RTN","PRCAP335",5,0)
 ; This pre-install is a double check that an old AR file that should have been deleted
"RTN","PRCAP335",6,0)
 ; a long time ago is actually not there before install of a new file (same number 430.7)
"RTN","PRCAP335",7,0)
 ; 
"RTN","PRCAP335",8,0)
 ;
"RTN","PRCAP335",9,0)
PRE ; Entry point to check for an old file and if there remove it
"RTN","PRCAP335",10,0)
 ; before the install starts
"RTN","PRCAP335",11,0)
 ;
"RTN","PRCAP335",12,0)
 N PRCAX
"RTN","PRCAP335",13,0)
 I $P($G(^PRCA(430.7,0)),"^")="AR BILLING ERROR HANDLING" D
"RTN","PRCAP335",14,0)
 . N DU,DA,DIK
"RTN","PRCAP335",15,0)
 . D MES^XPDUTL("  It appears you have an old 430.7 file that shouldn't be there.")
"RTN","PRCAP335",16,0)
 . D MES^XPDUTL("  - deleting before install.")
"RTN","PRCAP335",17,0)
 . ; just because the data clean up doesn't work well, there are not that many entries anyway
"RTN","PRCAP335",18,0)
 . S PRCAX=0 F  S PRCAX=$O(^PRCA(430.7,PRCAX)) Q:'PRCAX  S DIK="^PRCA(430.7,",DA=PRCAX D ^DIK
"RTN","PRCAP335",19,0)
 . S DU="^PRCA(430.7,",DU(0)="DET"
"RTN","PRCAP335",20,0)
 . D EN^DIU2
"RTN","PRCAP335",21,0)
 . D MES^XPDUTL("  Finished old file cleaned up.")
"RTN","PRCAP335",22,0)
 S PRCAX=$O(^PRCA(430.7,0)) I PRCAX,'$G(^PRCA(430.7,PRCAX,0)) D
"RTN","PRCAP335",23,0)
 . D MES^XPDUTL("  Need to clean up some old data...")
"RTN","PRCAP335",24,0)
 . K ^PRCA(430.7)
"RTN","PRCAP335",25,0)
 . S ^PRCA(430.7,0)="AR DEBT COLLECTOR DATA^430.7D^^0"
"RTN","PRCAP335",26,0)
 . D MES^XPDUTL("  Finished cleaning up old data.")
"RTN","PRCAP335",27,0)
 Q
"RTN","RCRJRCOC")
0^2^B61570527^B59180713
"RTN","RCRJRCOC",1,0)
RCRJRCOC ;WISC/RFJ/BGJ-count current receivables ; 11/2/10 10:53am
"RTN","RCRJRCOC",2,0)
 ;;4.5;Accounts Receivable;**156,170,182,203,220,138,239,272,273,334,335**;Mar 20, 1995;Build 8
"RTN","RCRJRCOC",3,0)
 ;;Per VA Directive 6402, this routine should not be modified.
"RTN","RCRJRCOC",4,0)
 ; IA 4385 for call to $$MRATYPE^IBCEMU2
"RTN","RCRJRCOC",5,0)
 Q
"RTN","RCRJRCOC",6,0)
 ;
"RTN","RCRJRCOC",7,0)
 ;
"RTN","RCRJRCOC",8,0)
CURRENT(RCBILLDA,RCVALUE) ;  count current bills balance
"RTN","RCRJRCOC",9,0)
 ;  rcvalue = prin ^ int ^ admin ^ mf ^ cc
"RTN","RCRJRCOC",10,0)
 ;
"RTN","RCRJRCOC",11,0)
 N %,RCFUND,RCRSC,RCTOHSIF,RCTOMCCF,SGL,TYPE,MRATYPE,ARACTDT,CATEGORY
"RTN","RCRJRCOC",12,0)
 ;
"RTN","RCRJRCOC",13,0)
 ;  calculate the rsc for the bill.  the rsc is only used for
"RTN","RCRJRCOC",14,0)
 ;  mccf bills
"RTN","RCRJRCOC",15,0)
 S RCRSC=""
"RTN","RCRJRCOC",16,0)
 I $$ACCK^PRCAACC(RCBILLDA) S RCRSC=$$CALCRSC^RCXFMSUR(RCBILLDA)
"RTN","RCRJRCOC",17,0)
 ;
"RTN","RCRJRCOC",18,0)
 ;  calculate the amount that goes to mccf and hsif
"RTN","RCRJRCOC",19,0)
 D MCCFHSIF(RCBILLDA,RCVALUE,RCRSC,DATEEND+1)
"RTN","RCRJRCOC",20,0)
 ;
"RTN","RCRJRCOC",21,0)
 ;  store the data for the ndb, if a 0 is returned by the function,
"RTN","RCRJRCOC",22,0)
 ;  then the bill has already been counted as a current receivable,quit
"RTN","RCRJRCOC",23,0)
 I '$$NDBSTORE(RCBILLDA,RCVALUE,1) Q
"RTN","RCRJRCOC",24,0)
 ;
"RTN","RCRJRCOC",25,0)
 ;  store results for FMS SV document for accrued bills only
"RTN","RCRJRCOC",26,0)
 ;  do not include prepayments (26)
"RTN","RCRJRCOC",27,0)
 I $$ACCK^PRCAACC(RCBILLDA),$P($G(^PRCA(430,RCBILLDA,0)),"^",2)'=26 D
"RTN","RCRJRCOC",28,0)
 .   ;  get the bills fund and category
"RTN","RCRJRCOC",29,0)
 .   S RCFUND=$$GETFUNDB^RCXFMSUF(RCBILLDA)
"RTN","RCRJRCOC",30,0)
 .   S RCFUND=$$ADJFUND^RCRJRCO(RCFUND) ; may remove the line after 10/1/03
"RTN","RCRJRCOC",31,0)
 .   S CATEGORY=+$P($G(^PRCA(430,RCBILLDA,0)),"^",2)
"RTN","RCRJRCOC",32,0)
 .   ;
"RTN","RCRJRCOC",33,0)
 .   ;  ----- this code is used to set up the SV code sheet -----
"RTN","RCRJRCOC",34,0)
 .   S TYPE=21
"RTN","RCRJRCOC",35,0)
 .   ;  special type for tort feasor
"RTN","RCRJRCOC",36,0)
 .   I $E(RCRSC,1,2)=86!($E(RCRSC,1,2)="8S") S TYPE="2A"
"RTN","RCRJRCOC",37,0)
 .   ;
"RTN","RCRJRCOC",38,0)
 .   ;  Get ARACTDT=AR Date Active for bill
"RTN","RCRJRCOC",39,0)
 .   S ARACTDT=+$P($P($G(^PRCA(430,RCBILLDA,6)),"^",21),".")
"RTN","RCRJRCOC",40,0)
 .   ;  determine Receivable Type: 1=pre-MRA, 2=post-MRA Medicre, 3=post-MRA non-Medicare
"RTN","RCRJRCOC",41,0)
 .   ;  DBIA #4385 activated on 31-Mar-2004
"RTN","RCRJRCOC",42,0)
 .   S MRATYPE=$$MRATYPE^IBCEMU2(RCBILLDA,ARACTDT)
"RTN","RCRJRCOC",43,0)
 .   ;  set TYPE to 2F for post-MRA Medicare bills or to 2L for
"RTN","RCRJRCOC",44,0)
 .   ;  post-MRA non-Medicare bills (for RHI receivables only)
"RTN","RCRJRCOC",45,0)
 .   I $E(RCRSC,1,2)=85!($E(RCRSC,1,2)="8R"),MRATYPE>1 S TYPE=$S(MRATYPE=2:"2F",1:"2L")
"RTN","RCRJRCOC",46,0)
 .   ;
"RTN","RCRJRCOC",47,0)
 .   ;  store dollars to mccf and hsif
"RTN","RCRJRCOC",48,0)
 .   I RCTOMCCF S ^TMP($J,"RCRJRCOLSV",TYPE,RCFUND,RCRSC)=$G(^TMP($J,"RCRJRCOLSV",TYPE,RCFUND,RCRSC))+RCTOMCCF
"RTN","RCRJRCOC",49,0)
 .   I RCTOHSIF S ^TMP($J,"RCRJRCOLSV",21,5358.1,$S(RCRSC="8BZZ":"8B1Z",1:"8C1Z"))=$G(^TMP($J,"RCRJRCOLSV",21,5358.1,$S(RCRSC="8BZZ":"8B1Z",1:"8C1Z")))+RCTOHSIF
"RTN","RCRJRCOC",50,0)
 .   ;
"RTN","RCRJRCOC",51,0)
 .   ;  ----- this code is used to build the user report
"RTN","RCRJRCOC",52,0)
 .   S %=+$P($P($G(^PRCA(430,RCBILLDA,6)),"^",21),".")
"RTN","RCRJRCOC",53,0)
 .   S ^TMP($J,"RCRJRCOLREPORT",%,RCBILLDA)=$P(RCVALUE,"^")_"^"_($P(RCVALUE,"^",2)+$P(RCVALUE,"^",3)+$P(RCVALUE,"^",4)+$P(RCVALUE,"^",5))_"^SV"_TYPE
"RTN","RCRJRCOC",54,0)
 .   I RCTOMCCF D STORE^RCRJRCOU(BILLDA,DATEBEG,DATEEND,ARACTDT,CATEGORY,"SV"_TYPE,RCFUND,RCRSC,RCVALUE)
"RTN","RCRJRCOC",55,0)
 .   I RCTOHSIF D STORE^RCRJRCOU(BILLDA,DATEBEG,DATEEND,ARACTDT,CATEGORY,"SV21","5358.1",$S(RCRSC="8BZZ":"8B1Z",1:"8C1Z"),RCVALUE)
"RTN","RCRJRCOC",56,0)
 .   ;
"RTN","RCRJRCOC",57,0)
 .   ;  ----- this code is used to build the OIG extract, piece 3 = GL acct
"RTN","RCRJRCOC",58,0)
 .   S ^TMP($J,"RCRJROIG",RCBILLDA)=$P(RCVALUE,"^")_"^"_($P(RCVALUE,"^",2)+$P(RCVALUE,"^",3)+$P(RCVALUE,"^",4)+$P(RCVALUE,"^",5))_"^"_$S(TYPE="2A":1333,TYPE="2F":"13H1",TYPE="2L":"13N1",1:1311)
"RTN","RCRJRCOC",59,0)
 .   ;
"RTN","RCRJRCOC",60,0)
 .   ;  ----- this code is used to set up medicare supplemental SVs
"RTN","RCRJRCOC",61,0)
 .   S %=$G(^PRCA(430,RCBILLDA,13))
"RTN","RCRJRCOC",62,0)
 .   ;  medicare contract adjustment field 131 for bills activated in AR during the month the ARDC is running
"RTN","RCRJRCOC",63,0)
 .   I $P(%,"^",1),ARACTDT'<DATEBEG D  ;
"RTN","RCRJRCOC",64,0)
 .   .   S ^TMP($J,"RCRJRCOLSV",17)=$G(^TMP($J,"RCRJRCOLSV",17))+$P(%,"^",1)
"RTN","RCRJRCOC",65,0)
 .   .   S ^TMP($J,"RCRJRCOLSV",17,RCFUND,RCRSC)=$G(^TMP($J,"RCRJRCOLSV",17,RCFUND,RCRSC))+$P(%,"^",1)
"RTN","RCRJRCOC",66,0)
 .   ;  medicare unreimbursable medicare expense field 132 for bills activated in AR during the month the ARDC is running
"RTN","RCRJRCOC",67,0)
 .   I $P(%,"^",2),ARACTDT'<DATEBEG D  ;
"RTN","RCRJRCOC",68,0)
 .   .   S ^TMP($J,"RCRJRCOLSV",18)=$G(^TMP($J,"RCRJRCOLSV",18))+$P(%,"^",2)
"RTN","RCRJRCOC",69,0)
 .   .   S ^TMP($J,"RCRJRCOLSV",18,RCFUND,RCRSC)=$G(^TMP($J,"RCRJRCOLSV",18,RCFUND,RCRSC))+$P(%,"^",2)
"RTN","RCRJRCOC",70,0)
 .   ;
"RTN","RCRJRCOC",71,0)
 .   ;  ----- this code is used to set up the bad debt report -----
"RTN","RCRJRCOC",72,0)
 .   S SGL=$$BDRSGL^RCRJRBD(CATEGORY,RCFUND,MRATYPE)
"RTN","RCRJRCOC",73,0)
 .   ;  store dollars to mccf and hsif.  both are sgl 1319 so 1319.1 is
"RTN","RCRJRCOC",74,0)
 .   ;  used to put hsif in a subset of 1319
"RTN","RCRJRCOC",75,0)
 .   I RCTOMCCF S ^TMP($J,"RCRJRBD",SGL)=$G(^TMP($J,"RCRJRBD",SGL))+RCTOMCCF
"RTN","RCRJRCOC",76,0)
 .   I RCTOHSIF S ^TMP($J,"RCRJRBD",1319.1)=$G(^TMP($J,"RCRJRBD",1319.1))+RCTOHSIF
"RTN","RCRJRCOC",77,0)
 ;
"RTN","RCRJRCOC",78,0)
 ;  store the interest, admin, mf, cc on the SV code sheet
"RTN","RCRJRCOC",79,0)
 ;  interest (type P2; fund 1435; rsc 8047)
"RTN","RCRJRCOC",80,0)
 I $P(RCVALUE,"^",2) S ^TMP($J,"RCRJRCOLSV","P2",1435,8047)=$G(^TMP($J,"RCRJRCOLSV","P2",1435,8047))+$P(RCVALUE,"^",2)
"RTN","RCRJRCOC",81,0)
 ;  admin (type P2; fund 3220; rsc 8046)
"RTN","RCRJRCOC",82,0)
 I $P(RCVALUE,"^",3) S ^TMP($J,"RCRJRCOLSV","P2",3220,8046)=$G(^TMP($J,"RCRJRCOLSV","P2",3220,8046))+$P(RCVALUE,"^",3)
"RTN","RCRJRCOC",83,0)
 ;  mf + cc (type P2; fund 0869; rsc 8048)
"RTN","RCRJRCOC",84,0)
 S %=$P(RCVALUE,"^",4)+$P(RCVALUE,"^",5)
"RTN","RCRJRCOC",85,0)
 I % S ^TMP($J,"RCRJRCOLSV","P2","0869",8048)=$G(^TMP($J,"RCRJRCOLSV","P2","0869",8048))+%
"RTN","RCRJRCOC",86,0)
 Q
"RTN","RCRJRCOC",87,0)
 ;
"RTN","RCRJRCOC",88,0)
 ;
"RTN","RCRJRCOC",89,0)
WRITEOFF(RCBILLDA,RCVALUE,RCRITER2) ;  count write offs
"RTN","RCRJRCOC",90,0)
 ;  rcvalue = prin ^ int ^ admin ^ mf ^ cc
"RTN","RCRJRCOC",91,0)
 ;  rcriter2 = write off criteria tracked in ndb
"RTN","RCRJRCOC",92,0)
 ;
"RTN","RCRJRCOC",93,0)
 N %,RCFUND,RCRSC,RCTOHSIF,RCTOMCCF,TYPE,MRATYPE,ARACTDT
"RTN","RCRJRCOC",94,0)
 ;
"RTN","RCRJRCOC",95,0)
 ;  calculate the rsc for the bill.  the rsc is only used for
"RTN","RCRJRCOC",96,0)
 ;  mccf bills
"RTN","RCRJRCOC",97,0)
 S RCRSC=""
"RTN","RCRJRCOC",98,0)
 I $$ACCK^PRCAACC(RCBILLDA) S RCRSC=$$CALCRSC^RCXFMSUR(RCBILLDA)
"RTN","RCRJRCOC",99,0)
 ;
"RTN","RCRJRCOC",100,0)
 ;  calculate the amount that goes to mccf and hsif
"RTN","RCRJRCOC",101,0)
 D MCCFHSIF(RCBILLDA,RCVALUE,RCRSC,DATEEND+1)
"RTN","RCRJRCOC",102,0)
 ;
"RTN","RCRJRCOC",103,0)
 ;  store the data for the ndb, if a 0 is returned by the function,
"RTN","RCRJRCOC",104,0)
 ;  then the bill has already been counted as a current receivable,quit
"RTN","RCRJRCOC",105,0)
 I '$$NDBSTORE(RCBILLDA,RCVALUE,RCRITER2) Q
"RTN","RCRJRCOC",106,0)
 ;
"RTN","RCRJRCOC",107,0)
 ;  store results for FMS WR document
"RTN","RCRJRCOC",108,0)
 ;  do not include prepayments (26)
"RTN","RCRJRCOC",109,0)
 I $$ACCK^PRCAACC(RCBILLDA),$P($G(^PRCA(430,RCBILLDA,0)),"^",2)'=26 D
"RTN","RCRJRCOC",110,0)
 .   ;  get the bills fund
"RTN","RCRJRCOC",111,0)
 .   S RCFUND=$$GETFUNDB^RCXFMSUF(RCBILLDA)
"RTN","RCRJRCOC",112,0)
 .   S RCFUND=$$ADJFUND^RCRJRCO(RCFUND) ; may remove the line after 10/1/03
"RTN","RCRJRCOC",113,0)
 .   ;
"RTN","RCRJRCOC",114,0)
 .   S TYPE=37
"RTN","RCRJRCOC",115,0)
 .   ;  special type for tort feasor
"RTN","RCRJRCOC",116,0)
 .   I $E(RCRSC,1,2)=86!($E(RCRSC,1,2)="8S") S TYPE=39
"RTN","RCRJRCOC",117,0)
 .   S ARACTDT=+$P($P($G(^PRCA(430,RCBILLDA,6)),"^",21),".")
"RTN","RCRJRCOC",118,0)
 .   ;  DBIA #4385 activated on 31-Mar-2004
"RTN","RCRJRCOC",119,0)
 .   S MRATYPE=$$MRATYPE^IBCEMU2(RCBILLDA,ARACTDT)
"RTN","RCRJRCOC",120,0)
 .   ;  for contract adjustments (criter2=22), the type is 38 for pre-
"RTN","RCRJRCOC",121,0)
 .   ;  MRA, 4N for post-MRA non-Medicare and 08 for post-MRA Medicare
"RTN","RCRJRCOC",122,0)
 .   I RCRITER2=22 S TYPE=$S(MRATYPE=1:38,MRATYPE=2:"08",1:"4N")   ;Aging bucket increase modified in PRCA*4.5*334
"RTN","RCRJRCOC",123,0)
 .   ;  store dollars to mccf and hsif
"RTN","RCRJRCOC",124,0)
 .   I RCTOMCCF S ^TMP($J,"RCRJRCOLWR",TYPE,RCFUND,RCRSC)=$G(^TMP($J,"RCRJRCOLWR",TYPE,RCFUND,RCRSC))+RCTOMCCF
"RTN","RCRJRCOC",125,0)
 .   I RCTOHSIF S ^TMP($J,"RCRJRCOLWR",TYPE,5358.1,$S(RCRSC="8BZZ":"8B1Z",1:"8C1Z"))=$G(^TMP($J,"RCRJRCOLWR",TYPE,5358.1,$S(RCRSC="8BZZ":"8B1Z",1:"8C1Z")))+RCTOHSIF
"RTN","RCRJRCOC",126,0)
 ;
"RTN","RCRJRCOC",127,0)
 ;  store the interest, admin, mf, cc on the WR code sheet
"RTN","RCRJRCOC",128,0)
 ;  interest (type P4; fund 1435; rsc 8047)
"RTN","RCRJRCOC",129,0)
 I $P(RCVALUE,"^",2) S ^TMP($J,"RCRJRCOLWR","P4",1435,8047)=$G(^TMP($J,"RCRJRCOLWR","P4",1435,8047))+$P(RCVALUE,"^",2)
"RTN","RCRJRCOC",130,0)
 ;  admin (type P4; fund 3220; rsc 8046)
"RTN","RCRJRCOC",131,0)
 I $P(RCVALUE,"^",3) S ^TMP($J,"RCRJRCOLWR","P4",3220,8046)=$G(^TMP($J,"RCRJRCOLWR","P4",3220,8046))+$P(RCVALUE,"^",3)
"RTN","RCRJRCOC",132,0)
 ;  mf + cc (type P4; fund 0869; rsc 8048)
"RTN","RCRJRCOC",133,0)
 S %=$P(RCVALUE,"^",4)+$P(RCVALUE,"^",5)
"RTN","RCRJRCOC",134,0)
 I % S ^TMP($J,"RCRJRCOLWR","P4","0869",8048)=$G(^TMP($J,"RCRJRCOLWR","P4","0869",8048))+%
"RTN","RCRJRCOC",135,0)
 Q
"RTN","RCRJRCOC",136,0)
 ;
"RTN","RCRJRCOC",137,0)
 ;
"RTN","RCRJRCOC",138,0)
NDBSTORE(RCBILLDA,RCVALUE,RCRITER2) ;  store the data for the NDB
"RTN","RCRJRCOC",139,0)
 ;  returns a 1 if the bill has not been counted
"RTN","RCRJRCOC",140,0)
 ;  returns a 0 if the bill has been counted
"RTN","RCRJRCOC",141,0)
 N %,CRITERIA
"RTN","RCRJRCOC",142,0)
 ;
"RTN","RCRJRCOC",143,0)
 ;  this line of code will prevent duplicate counts if a sites cross
"RTN","RCRJRCOC",144,0)
 ;  references in file 430 (actdt and asdt) are duplicated (incorrect)
"RTN","RCRJRCOC",145,0)
 I RCRITER2<15,$D(^TMP($J,"RCRJRCOL","COUNT",RCBILLDA,RCRITER2)) Q 0  ; Aging bucket increase modified in PRCA*4.5*334
"RTN","RCRJRCOC",146,0)
 ;
"RTN","RCRJRCOC",147,0)
 ;  get a bills criteria 1,3,4,5
"RTN","RCRJRCOC",148,0)
 S CRITERIA=$G(^TMP($J,"RCRJRCOL","CRITERIA",RCBILLDA))
"RTN","RCRJRCOC",149,0)
 I CRITERIA="" S CRITERIA=$$CRITERIA^RCRJRCOL(RCBILLDA),^TMP($J,"RCRJRCOL","CRITERIA",RCBILLDA)=CRITERIA
"RTN","RCRJRCOC",150,0)
 S $P(CRITERIA,"-",2)=RCRITER2
"RTN","RCRJRCOC",151,0)
 ;
"RTN","RCRJRCOC",152,0)
 ;  store results for ndb
"RTN","RCRJRCOC",153,0)
 S %=$G(@DATASTOR)
"RTN","RCRJRCOC",154,0)
 S $P(%,"^")=$P(%,"^")+1
"RTN","RCRJRCOC",155,0)
 S $P(%,"^",2)=$P(%,"^",2)+$P(RCVALUE,"^")
"RTN","RCRJRCOC",156,0)
 S $P(%,"^",3)=$P(%,"^",3)+$P(RCVALUE,"^",2)+$P(RCVALUE,"^",3)+$P(RCVALUE,"^",4)+$P(RCVALUE,"^",5)
"RTN","RCRJRCOC",157,0)
 S @DATASTOR=%
"RTN","RCRJRCOC",158,0)
 ;
"RTN","RCRJRCOC",159,0)
 ;  keep a count of current receivables counted
"RTN","RCRJRCOC",160,0)
 S ^TMP($J,"RCRJRCOL","COUNT",RCBILLDA,RCRITER2)=""
"RTN","RCRJRCOC",161,0)
 S ^TMP($J,"RCRJRCOL","CRIT2",RCRITER2,RCBILLDA)=""
"RTN","RCRJRCOC",162,0)
 Q 1
"RTN","RCRJRCOC",163,0)
 ;
"RTN","RCRJRCOC",164,0)
 ;
"RTN","RCRJRCOC",165,0)
MCCFHSIF(RCBILLDA,RCVALUE,RCRSC,ASOFDATE) ;  calculate the amount that goes
"RTN","RCRJRCOC",166,0)
 ;
"RTN","RCRJRCOC",167,0)
 ;  to mccf and hsif
"RTN","RCRJRCOC",168,0)
 ;
"RTN","RCRJRCOC",169,0)
 ;  returns RCTOMCCF and RCTOHSIF as the outstanding balance to mccf
"RTN","RCRJRCOC",170,0)
 ;  and the outstanding balance to hsif
"RTN","RCRJRCOC",171,0)
 N MCCFHSIF
"RTN","RCRJRCOC",172,0)
 ;
"RTN","RCRJRCOC",173,0)
 S RCTOMCCF=$P(RCVALUE,"^"),RCTOHSIF=0
"RTN","RCRJRCOC",174,0)
 ;
"RTN","RCRJRCOC",175,0)
 I $$NOHSIF^RCRJRCO() Q  ; disabled HSIF
"RTN","RCRJRCOC",176,0)
 ;
"RTN","RCRJRCOC",177,0)
 ; if revenue source code is not 8BZZ or 8CZZ then it all goes to mccf
"RTN","RCRJRCOC",178,0)
 I RCRSC="8BZZ"!(RCRSC="8CZZ") D
"RTN","RCRJRCOC",179,0)
 .   ;  get the amount for each fund mccf and hsif
"RTN","RCRJRCOC",180,0)
 .   ;  this call returns the total amount owed to mccf (piece 1),
"RTN","RCRJRCOC",181,0)
 .   ;  total amount owed to hsif (piece 2), total amount paid
"RTN","RCRJRCOC",182,0)
 .   ;  to mccf (piece 3), total amount paid to hsif (piece 4).
"RTN","RCRJRCOC",183,0)
 .   ;  for outstanding balance you must subtract the payment in
"RTN","RCRJRCOC",184,0)
 .   ;  pieces 3 and 4 which are returned as negative amounts.
"RTN","RCRJRCOC",185,0)
 .   S MCCFHSIF=$$BILLFUND^RCBMILLC(RCBILLDA,ASOFDATE)
"RTN","RCRJRCOC",186,0)
 .   S RCTOMCCF=$P(MCCFHSIF,"^",1)+$P(MCCFHSIF,"^",3)
"RTN","RCRJRCOC",187,0)
 .   S RCTOHSIF=$P(MCCFHSIF,"^",2)+$P(MCCFHSIF,"^",4)
"RTN","RCRJRCOC",188,0)
 Q
"RTN","RCRJRCOU")
0^1^B133028607^B76712573
"RTN","RCRJRCOU",1,0)
RCRJRCOU ;WISC/RFJ-ar data collector summary report ;1 Mar 97
"RTN","RCRJRCOU",2,0)
 ;;4.5;Accounts Receivable;**103,320,335**;Mar 20, 1995;Build 8
"RTN","RCRJRCOU",3,0)
 ;;Per VA Directive 6402, this routine should not be modified.
"RTN","RCRJRCOU",4,0)
 Q
"RTN","RCRJRCOU",5,0)
 ; IA - 4398        FIRST^VAUTOMA
"RTN","RCRJRCOU",6,0)
 ;       4385        $$MRATYPE^IBCEMU2
"RTN","RCRJRCOU",7,0)
 ; 
"RTN","RCRJRCOU",8,0)
 ; 
"RTN","RCRJRCOU",9,0)
 ;ARDC detailed report - Modified to print directly as per  PRCA*4.5*320 (HAPE FY16 RRE)
"RTN","RCRJRCOU",10,0)
 ;  a MailMan message is no longer generated by this routine !
"RTN","RCRJRCOU",11,0)
 ; Called by VistA Option - PRCA ARDC REPORT       (ARDC Detail Report)
"RTN","RCRJRCOU",12,0)
 ;
"RTN","RCRJRCOU",13,0)
START ;  Entry point from the Option
"RTN","RCRJRCOU",14,0)
 N VAUTSTR,VAUTNI,DIC,Y,SCREEN,EXCEL,VAUTC,QUIT,DTFRMTO,BGDT,RCSTDT
"RTN","RCRJRCOU",15,0)
 ;
"RTN","RCRJRCOU",16,0)
 S QUIT=0
"RTN","RCRJRCOU",17,0)
 N TXT,MSG F TXT=1:1:12 S MSG=$T(MENU+TXT) W !,?5,$P(MSG,";;",2)
"RTN","RCRJRCOU",18,0)
 S SCREEN="^16^18^32^33^40^42^",DIC="^PRCA(430.3,",VAUTNI=2,VAUTSTR="Status",VAUTVB="VAUTC",DIC("S")="I SCREEN[(U_Y_U)" D FIRST^VAUTOMA
"RTN","RCRJRCOU",19,0)
 I VAUTC=1 F I=2:1:7 S VAUTC($P(SCREEN,U,I))=$P(^PRCA(430.3,$P(SCREEN,U,I),0),U)  ;set array equal to the screen if ALL was selected
"RTN","RCRJRCOU",20,0)
 Q:'$D(VAUTC)!(Y=-1)
"RTN","RCRJRCOU",21,0)
 N TXT,MSG W ! F TXT=1:1:12 S MSG=$T(DESCTEXT+TXT) W !,?3,$P(MSG,";;",2)
"RTN","RCRJRCOU",22,0)
 W !!,?10,"<< Checking available dates.  Please wait >>"
"RTN","RCRJRCOU",23,0)
 D FIRST  ;Get earliest date for selected Status
"RTN","RCRJRCOU",24,0)
 W !!,"The earliest date on file for selected status is:  ",$G(BGDT)
"RTN","RCRJRCOU",25,0)
 S DTFRMTO=$$DTFRMTO Q:'DTFRMTO  ;Get date range for report
"RTN","RCRJRCOU",26,0)
 S EXCEL=0,PROMPT="CAPTURE Report data to an Excel Document?",DIR(0)="Y",DIR("?")="^D HEXC^RCRJRCOU"
"RTN","RCRJRCOU",27,0)
 S EXCEL=$$SELECT^RCTCSJR(PROMPT,"NO") I "01"'[EXCEL Q
"RTN","RCRJRCOU",28,0)
 I EXCEL=1 D EXCMSG^RCTCSJR ; Display Excel display message
"RTN","RCRJRCOU",29,0)
 I 'EXCEL W !!,"This report requires 132 characters",!
"RTN","RCRJRCOU",30,0)
 K IOP,IO("Q") S %ZIS="MQ",%ZIS("B")="" D ^%ZIS Q:POP
"RTN","RCRJRCOU",31,0)
 I $D(IO("Q")) D  Q
"RTN","RCRJRCOU",32,0)
 .S ZTDESC="ARDC Detail Report",ZTRTN="DQ^RCRJRCOU"
"RTN","RCRJRCOU",33,0)
 .S ZTSAVE("VAUTC*")="",ZTSAVE("RCRET")="",ZTSAVE("DTFRMTO")="",ZTSAVE("ZTREQ")="@",ZTSAVE("EXCEL")=""
"RTN","RCRJRCOU",34,0)
 .D ^%ZTLOAD,HOME^%ZIS S QUIT=1
"RTN","RCRJRCOU",35,0)
 W !!,"<*> please wait <*>"
"RTN","RCRJRCOU",36,0)
 ;
"RTN","RCRJRCOU",37,0)
DQ ;  generate user detailed report
"RTN","RCRJRCOU",38,0)
 N DATEEND,RCDATE,BILLDA,DATA,RCLINE,REPTDATA,Y,RCBILLN,RCDTAC,RCCAT,RCSTAT,TRANTYP,RCTOT,RCPRIN,RCRSC,PRCASITE,VAUTVB,XMNOW
"RTN","RCRJRCOU",39,0)
 N STAT,BILLDA,RCRSC,RECORD,RCBAL,ARACTDT,DATEMOYR,MRATYPE,POP,RCFUND,RCOTHER,TYPE,RCOUT,CURDT,DTFRM,DTFROM,DTTO,RCRET,LIST,ERR
"RTN","RCRJRCOU",40,0)
 ;
"RTN","RCRJRCOU",41,0)
 S (RCDATE,DTFRM)=$$FMADD^XLFDT(+$P(DTFRMTO,U,2)),DTTO=$P(DTFRMTO,U,3),CURDT=0
"RTN","RCRJRCOU",42,0)
 S XMNOW=$$NOW^XLFDT  ;Capture the date and time the report was started for the header
"RTN","RCRJRCOU",43,0)
 S DATEEND=$$LDATE^RCRJR(DT),DATEMOYR=$E(DATEEND,1,5)_"00"
"RTN","RCRJRCOU",44,0)
 S PRCASITE=$$SITE^RCMSITE
"RTN","RCRJRCOU",45,0)
 S RCRET=$NA(^TMP($J,"RCRJRCOU")) K @RCRET
"RTN","RCRJRCOU",46,0)
 ; 
"RTN","RCRJRCOU",47,0)
 S (RCLINE,STAT)=0 F  S STAT=$O(VAUTC(STAT)) Q:'STAT  S RCDATE=DTFRM D
"RTN","RCRJRCOU",48,0)
 . S BILLDA=0 F  S BILLDA=$O(^PRCA(430,"AC",STAT,BILLDA)) Q:'BILLDA  D
"RTN","RCRJRCOU",49,0)
 ..Q:$P(^PRCA(430,BILLDA,0),U,10)=""
"RTN","RCRJRCOU",50,0)
 ..Q:$P(^PRCA(430,BILLDA,0),U,8)'=STAT  ;Quit if the Current Status from the xref is incorrect
"RTN","RCRJRCOU",51,0)
 ..S RCDATE=$P(^PRCA(430,BILLDA,0),U,10)
"RTN","RCRJRCOU",52,0)
 ..Q:RCDATE<DTFRM!(RCDATE>DTTO)
"RTN","RCRJRCOU",53,0)
 .. ;As per email from the VA - We need to see all bills, not just accrued bills.
"RTN","RCRJRCOU",54,0)
 .. ;I $$ACCK^PRCAACC(BILLDA),$P($G(^PRCA(430,BILLDA,0)),"^",2)'=26 D   ;from CURRENT^RCRJRCOC 
"RTN","RCRJRCOU",55,0)
 .. ;
"RTN","RCRJRCOU",56,0)
 .. I $P($G(^PRCA(430,BILLDA,0)),"^",2)'=26 D   ;from CURRENT^RCRJRCOC 
"RTN","RCRJRCOU",57,0)
 ... S DATA=$G(^PRCA(430,BILLDA,0)) Q:'DATA
"RTN","RCRJRCOU",58,0)
 ... S (TYPE,TRANTYP,RCRSC,RCFUND,RCPRIN)="",RCBAL=0
"RTN","RCRJRCOU",59,0)
 ... ;  bill number
"RTN","RCRJRCOU",60,0)
 ... ;S RCBILLN=$P($P(DATA,"^"),"-",2)
"RTN","RCRJRCOU",61,0)
 ... S RCBILLN=$P(DATA,"^")
"RTN","RCRJRCOU",62,0)
 ... ;  date activated
"RTN","RCRJRCOU",63,0)
 ... S RCDTAC=$$FMTE^XLFDT(RCDATE,"2Z")
"RTN","RCRJRCOU",64,0)
 ... ;  category
"RTN","RCRJRCOU",65,0)
 ... S RCCAT=$P($G(^PRCA(430.2,+$P(DATA,"^",2),0)),"^")
"RTN","RCRJRCOU",66,0)
 ... ;  status
"RTN","RCRJRCOU",67,0)
 ... S RCSTAT=$P($G(^PRCA(430.3,+$P(DATA,"^",8),0)),"^")
"RTN","RCRJRCOU",68,0)
 ... S TYPE="SV21" I $$ACCK^PRCAACC(BILLDA) S RCRSC=$$CALCRSC^RCXFMSUR(BILLDA) ;                     (as per CURRENT^RCRJRCOC)
"RTN","RCRJRCOU",69,0)
 ... I $E(RCRSC,1,2)=86!($E(RCRSC,1,2)="8S") S TYPE="2A"
"RTN","RCRJRCOU",70,0)
 ... ;  Get AR Date Active for bill
"RTN","RCRJRCOU",71,0)
 ... S ARACTDT=+$P($P($G(^PRCA(430,BILLDA,6)),"^",21),".")  ;                          (as per START^RCRJRBD)
"RTN","RCRJRCOU",72,0)
 ...  ;  determine Receivable Type: 1=pre-MRA, 2=post-MRA Medicre, 3=post-MRA non-Medicare
"RTN","RCRJRCOU",73,0)
 ... ;  fms report type - TRANTYP variable
"RTN","RCRJRCOU",74,0)
 ... S MRATYPE=$$MRATYPE^IBCEMU2(BILLDA,ARACTDT) ;                                     (as per CURRENT^RCRJRCOC)
"RTN","RCRJRCOU",75,0)
 ... ;  set TYPE to 2F for post-MRA Medicare bills or to 2L for post-MRA non-Medicare bills (for RHI receivables only)
"RTN","RCRJRCOU",76,0)
 ... I $E(RCRSC,1,2)=85!($E(RCRSC,1,2)="8R"),MRATYPE>1 S TYPE=$S(MRATYPE=2:"2F",1:"2L")
"RTN","RCRJRCOU",77,0)
 ... I $E(RCRSC,1,2)=86!($E(RCRSC,1,2)="8S") S TYPE="SV21"
"RTN","RCRJRCOU",78,0)
 ... S TRANTYP=$G(TYPE),REPTDATA=""
"RTN","RCRJRCOU",79,0)
 ... K LIST D FIND^DIC(430,,"@;71;11;IX","M","`"_BILLDA,,,,,"LIST","ERR")
"RTN","RCRJRCOU",80,0)
 ... S RCPRIN=$G(LIST("DILIST","ID",1,71)),RCBAL=$G(LIST("DILIST","ID",1,11))
"RTN","RCRJRCOU",81,0)
 ... I RCBAL'>0 Q  ;Don't show if current balance not greater than $0
"RTN","RCRJRCOU",82,0)
 ... S RCPRIN=$J(RCPRIN,9,2),RCBAL=$J(RCBAL,10,2)
"RTN","RCRJRCOU",83,0)
 ... ;Revenue Service Code  
"RTN","RCRJRCOU",84,0)
 ... S RCRSC="" I $$ACCK^PRCAACC(BILLDA) S RCRSC=$$CALCRSC^RCXFMSUR(BILLDA) ;          (as per CURRENT^RCRJRCOC)
"RTN","RCRJRCOU",85,0)
 ... ;Fund
"RTN","RCRJRCOU",86,0)
 ... S RCFUND=$$GETFUNDB^RCXFMSUF(BILLDA,1)
"RTN","RCRJRCOU",87,0)
 ... S RCLINE=RCLINE+1  ;(record counter)
"RTN","RCRJRCOU",88,0)
 ... S @RCRET@(RCLINE)=RCBILLN_U_RCDTAC_U_RCCAT_U_RCSTAT_U_TRANTYP_U_RCFUND_U_RCRSC_U_RCPRIN_U_RCBAL
"RTN","RCRJRCOU",89,0)
 ; end of gathering data
"RTN","RCRJRCOU",90,0)
 ;
"RTN","RCRJRCOU",91,0)
 I RCLINE=0 W !!,"***The report found no receivables that match your selection***",!! G EXIT
"RTN","RCRJRCOU",92,0)
 ;
"RTN","RCRJRCOU",93,0)
 D PRINT
"RTN","RCRJRCOU",94,0)
 ;
"RTN","RCRJRCOU",95,0)
EXIT ;commom exit point
"RTN","RCRJRCOU",96,0)
 D ^%ZISC
"RTN","RCRJRCOU",97,0)
 K ^TMP($J,"RCRJRCOU")
"RTN","RCRJRCOU",98,0)
 Q
"RTN","RCRJRCOU",99,0)
 ;
"RTN","RCRJRCOU",100,0)
HDR ;Set the header
"RTN","RCRJRCOU",101,0)
 ;
"RTN","RCRJRCOU",102,0)
 S PAGE=PAGE+1 U IO W @IOF
"RTN","RCRJRCOU",103,0)
 I 'EXCEL W ?14,"ARDC Detailed Report",?50,"Run Date: ",$$FMTE^XLFDT(XMNOW,"2Z"),?107,"Page:",PAGE,!
"RTN","RCRJRCOU",104,0)
 I EXCEL W U_"ARDC Detailed Report"_U_U_"Run Date: "_$$FMTE^XLFDT(XMNOW,"2Z")_U_U_U_U_"Page:"_PAGE,!
"RTN","RCRJRCOU",105,0)
 N I F I=1:1:120 W "-"
"RTN","RCRJRCOU",106,0)
 I 'EXCEL W !,"Bill#",?14,"Create",?26,"AR Category",?50,"Bill",?68,"FMS",?75,"Fund",?84,"RSC",?93,"Principal",?107,"Current"
"RTN","RCRJRCOU",107,0)
 I 'EXCEL W !,?14,"Date",?50,"Status",?75,"Type",?96,"Amount",?107,"Balance",!
"RTN","RCRJRCOU",108,0)
 I EXCEL W !,"Bill#"_U_"Create"_U_"AR Category"_U_"Bill"_U_"FMS"_U_"Fund"_U_"RSC"_U_"Principal"_U_"Current"
"RTN","RCRJRCOU",109,0)
 I EXCEL W !,U_"Date"_U_U_"Status"_U_U_"Type"_U_U_"Amount"_U_"Balance",!
"RTN","RCRJRCOU",110,0)
 N I F I=1:1:120 W "-"
"RTN","RCRJRCOU",111,0)
 Q
"RTN","RCRJRCOU",112,0)
 ;
"RTN","RCRJRCOU",113,0)
PRINT ; print records to screen or printer
"RTN","RCRJRCOU",114,0)
 N PAGE S (RCOUT,PAGE)=0,RECORD=0
"RTN","RCRJRCOU",115,0)
 F  S RECORD=$O(@RCRET@(RECORD)) Q:'RECORD!(RCOUT)  D
"RTN","RCRJRCOU",116,0)
 . I RECORD=1 D HDR
"RTN","RCRJRCOU",117,0)
 . I 'EXCEL,$Y+3>IOSL I ($E(IOST,1,2)="C-")&(IO=IO(0)) S DIR(0)="E" D ^DIR K DIR D
"RTN","RCRJRCOU",118,0)
 .. I $D(DTOUT)!($D(DUOUT)) S RCOUT=1 G EXIT
"RTN","RCRJRCOU",119,0)
 .. D HDR
"RTN","RCRJRCOU",120,0)
 . Q:RCOUT
"RTN","RCRJRCOU",121,0)
 . I 'EXCEL W !,$P(@RCRET@(RECORD),U),?14,$P(@RCRET@(RECORD),U,2),?26,$E($P(@RCRET@(RECORD),U,3),1,20),?50,$E($P(@RCRET@(RECORD),U,4),1,15),?68,$P(@RCRET@(RECORD),U,5)
"RTN","RCRJRCOU",122,0)
 . I 'EXCEL W ?75,$P(@RCRET@(RECORD),U,6),?84,$P(@RCRET@(RECORD),U,7),?92,$P(@RCRET@(RECORD),U,8),?104,$P(@RCRET@(RECORD),U,9)
"RTN","RCRJRCOU",123,0)
 . I EXCEL W !,$P(@RCRET@(RECORD),U)_U_$P(@RCRET@(RECORD),U,2)_U_$P(@RCRET@(RECORD),U,3)_U_$P(@RCRET@(RECORD),U,4)_U_$P(@RCRET@(RECORD),U,5)
"RTN","RCRJRCOU",124,0)
 . I EXCEL W U_$P(@RCRET@(RECORD),U,6)_U_$P(@RCRET@(RECORD),U,7)_U_$P(@RCRET@(RECORD),U,8)_U_$P(@RCRET@(RECORD),U,9)
"RTN","RCRJRCOU",125,0)
 I 'EXCEL,$E(IOST,1,2)="C-" R !!,"END OF REPORT...PRESS RETURN TO CONTINUE",X:DTIME W @IOF
"RTN","RCRJRCOU",126,0)
 Q
"RTN","RCRJRCOU",127,0)
 ;
"RTN","RCRJRCOU",128,0)
DTFRMTO(PROMPT) ;Get from and to dates  (added as per PRCA*4.5*320 to be able to sort by dates for reports)
"RTN","RCRJRCOU",129,0)
 N %DT,Y,X,BEGDT,ENDDT,DTOUT,OUT,DIRUT,DUOUT,DIROUT,STATUS,BDT,STDT,STATUS
"RTN","RCRJRCOU",130,0)
 ;INPUT ;   PROMPT - Message to display prior to prompting for dates
"RTN","RCRJRCOU",131,0)
 ;OUTPUT:     1^BEGDT^ENDDT - Data found
"RTN","RCRJRCOU",132,0)
 ;            0             - User up arrowed or timed out
"RTN","RCRJRCOU",133,0)
 ;If they want to show first available date for that set of Status, use this sub
"RTN","RCRJRCOU",134,0)
 S OUT=0
"RTN","RCRJRCOU",135,0)
 ;W !,$G(PROMPT)
"RTN","RCRJRCOU",136,0)
 S %DT="AEX",%DT("A")="Date Range: FROM: " ;Enter Beginning Date: "
"RTN","RCRJRCOU",137,0)
 W ! D ^%DT K %DT
"RTN","RCRJRCOU",138,0)
 I Y<0 W !!,"No Date selected, quitting. ",!! Q OUT  ;Quit if user time out or didn't enter valid date
"RTN","RCRJRCOU",139,0)
 S DTFROM=+Y,%DT="AEX",%DT("A")="              TO:   ",%DT("B")="T" ;"TODAY"
"RTN","RCRJRCOU",140,0)
 D ^%DT
"RTN","RCRJRCOU",141,0)
 K %DT
"RTN","RCRJRCOU",142,0)
 ;Quit if user time out or didn't enter valid date
"RTN","RCRJRCOU",143,0)
 I Y<0 W !!,"No Date selected, quitting. ",!! Q OUT
"RTN","RCRJRCOU",144,0)
 S DTTO=+Y,OUT=1_U_DTFROM_U_DTTO
"RTN","RCRJRCOU",145,0)
 ;Switch dates if Begin Date is more recent than End Date
"RTN","RCRJRCOU",146,0)
 S:DTFROM>DTTO OUT=1_U_DTTO_U_DTFROM
"RTN","RCRJRCOU",147,0)
 Q OUT
"RTN","RCRJRCOU",148,0)
 ;
"RTN","RCRJRCOU",149,0)
HEXC ; - 'Do you want to capture data to EXCEL' prompt
"RTN","RCRJRCOU",150,0)
 W !!,"      Enter:  'Y'   -  To capture detail report data to transfer"
"RTN","RCRJRCOU",151,0)
 W !,"                        to an Excel document"
"RTN","RCRJRCOU",152,0)
 W !,"              '<CR>' -  To skip this option"
"RTN","RCRJRCOU",153,0)
 W !,"              '^'    -  To quit this option"
"RTN","RCRJRCOU",154,0)
 Q
"RTN","RCRJRCOU",155,0)
FIRST ; Get 1st available date for selected status
"RTN","RCRJRCOU",156,0)
 N RCBILL
"RTN","RCRJRCOU",157,0)
 S STATUS=0,(RCBILL,BDT)="" F  S STATUS=$O(VAUTC(STATUS)) Q:STATUS=""  D
"RTN","RCRJRCOU",158,0)
 . S RCBILL=0 F  S RCBILL=$O(^PRCA(430,"AC",STATUS,RCBILL)) Q:'RCBILL  D
"RTN","RCRJRCOU",159,0)
 .. Q:$P($G(^PRCA(430,RCBILL,0)),U,10)=""
"RTN","RCRJRCOU",160,0)
 .. S RCSTDT=$P($G(^PRCA(430,RCBILL,0)),U,10)
"RTN","RCRJRCOU",161,0)
 .. I $G(BDT)="" S BDT=RCSTDT Q
"RTN","RCRJRCOU",162,0)
 .. I RCSTDT<+BDT S BDT=RCSTDT_U_STATUS ;Use earliest available date
"RTN","RCRJRCOU",163,0)
 ;
"RTN","RCRJRCOU",164,0)
 S BGDT=$S(BDT'="":$$FMTE^XLFDT(+BDT,"Z2"),1:"No records on file")
"RTN","RCRJRCOU",165,0)
 Q
"RTN","RCRJRCOU",166,0)
MENU ; Selection menu
"RTN","RCRJRCOU",167,0)
 ;;
"RTN","RCRJRCOU",168,0)
 ;;
"RTN","RCRJRCOU",169,0)
 ;;ARDC Detail Report, please select the status desired below:
"RTN","RCRJRCOU",170,0)
 ;;
"RTN","RCRJRCOU",171,0)
 ;;     AC - ACTIVE(16)
"RTN","RCRJRCOU",172,0)
 ;;     N  - NEW BILL(18)
"RTN","RCRJRCOU",173,0)
 ;;     R  - RETURNED FOR AMENDMENT(32)
"RTN","RCRJRCOU",174,0)
 ;;     AM - AMENDED BILL(33)
"RTN","RCRJRCOU",175,0)
 ;;     S  - SUSPENDED(40)
"RTN","RCRJRCOU",176,0)
 ;;     O  - OPEN(42)
"RTN","RCRJRCOU",177,0)
 ;;     ALL of the above (Default, press enter) 
"RTN","RCRJRCOU",178,0)
 ;;
"RTN","RCRJRCOU",179,0)
 Q
"RTN","RCRJRCOU",180,0)
DESCTEXT ;
"RTN","RCRJRCOU",181,0)
 ;; This report was originally generated from the monthly background
"RTN","RCRJRCOU",182,0)
 ;; process and generated a MailMan message.  It can now only be run
"RTN","RCRJRCOU",183,0)
 ;; manually through this option. The new data does not contain bills
"RTN","RCRJRCOU",184,0)
 ;; that have been previously closed out. Note that when running the
"RTN","RCRJRCOU",185,0)
 ;; new report, only specific AR current status are available.  
"RTN","RCRJRCOU",186,0)
 ;; There will be a note that displays the oldest bill in VistA 
"RTN","RCRJRCOU",187,0)
 ;; associated with these statuses for users to know which date 
"RTN","RCRJRCOU",188,0)
 ;; MUST be entered into the "FROM:" prompt for monthly
"RTN","RCRJRCOU",189,0)
 ;; reconciliation reporting.  
"RTN","RCRJRCOU",190,0)
 ;; Different dates can be entered for other types of audits.
"RTN","RCRJRCOU",191,0)
 ;; 
"RTN","RCRJRCOU",192,0)
 ;; Please run after hours when possible.
"RTN","RCRJRCOU",193,0)
 ;; 
"RTN","RCRJRCOU",194,0)
 Q
"RTN","RCRJRCOU",195,0)
 ;
"RTN","RCRJRCOU",196,0)
STORE(BILLDA,DATEBEG,DATEEND,ARACTDT,CATEGORY,TYPE,RCFUND,RSC,RCVALUE,SCREEN) ; 
"RTN","RCRJRCOU",197,0)
 ;called by ^RCRJRCOC to store the bills in the AR DEBT COLLECTOR DATA (430.7) file.
"RTN","RCRJRCOU",198,0)
 ; BILLDA - IEN of 430
"RTN","RCRJRCOU",199,0)
 ; DATEBEG - Beginning date of accounting month
"RTN","RCRJRCOU",200,0)
 ; DATEEND - Ending date of accouting month
"RTN","RCRJRCOU",201,0)
 ; ARACTDT - Date account activitated
"RTN","RCRJRCOU",202,0)
 ; CATEGORY - Category of bill (pointer)
"RTN","RCRJRCOU",203,0)
 ; TYPE - FMS Document Type (include SV or whatever)
"RTN","RCRJRCOU",204,0)
 ; RCFUND - Fund
"RTN","RCRJRCOU",205,0)
 ; RCRSC - Revenue Source Code
"RTN","RCRJRCOU",206,0)
 ; RCVALUE - value of bill prin ^ int ^ admin ^ mf ^ cc
"RTN","RCRJRCOU",207,0)
 ; SCREEN - data from OIG routine needs to be screened
"RTN","RCRJRCOU",208,0)
 ; 
"RTN","RCRJRCOU",209,0)
 N RCREPORT,RCDR,RCZERO,RCLIST,DIE,DR,DA,X,Y,RCDA,RCSTAT
"RTN","RCRJRCOU",210,0)
 ;
"RTN","RCRJRCOU",211,0)
 Q:'$G(DATEBEG)!('$G(DATEEND))!('$G(BILLDA))
"RTN","RCRJRCOU",212,0)
 S RCSTAT=$P(^PRCA(430,BILLDA,0),"^",8)
"RTN","RCRJRCOU",213,0)
 I $G(SCREEN) Q:RCSTAT'=16&(RCSTAT'=40)  ; only active and suspended
"RTN","RCRJRCOU",214,0)
 ;
"RTN","RCRJRCOU",215,0)
 ; Add .01 top file level entry if it doesn't exist
"RTN","RCRJRCOU",216,0)
 S RCREPORT=$O(^PRCA(430.7,"B",$E(DATEEND,1,5)_"00",0)) I 'RCREPORT D
"RTN","RCRJRCOU",217,0)
 . N DO,DIC,X,Y,RCKEEP,RCPURGE
"RTN","RCRJRCOU",218,0)
 . S DIC="^PRCA(430.7,",DIC(0)="",X=$E(DATEEND,1,5)_"00"
"RTN","RCRJRCOU",219,0)
 . S DIC("DR")=.02_"////"_DATEBEG_";.03////"_DATEEND
"RTN","RCRJRCOU",220,0)
 . D FILE^DICN
"RTN","RCRJRCOU",221,0)
 . S RCREPORT=+Y
"RTN","RCRJRCOU",222,0)
 . ; purge any reports more than 3 months old
"RTN","RCRJRCOU",223,0)
 . S RCKEEP=$E($$FMADD^XLFDT(DATEEND,-65),1,5)_"00",RCPURGE=0
"RTN","RCRJRCOU",224,0)
 . F  S RCPURGE=$O(^PRCA(430.7,"B",RCPURGE)) Q:'RCPURGE!(RCPURGE'<RCKEEP)  D
"RTN","RCRJRCOU",225,0)
 .. N DIK,DA
"RTN","RCRJRCOU",226,0)
 .. S DIK="^PRCA(430.7,",DA=$O(^PRCA(430.7,"B",RCPURGE,0))
"RTN","RCRJRCOU",227,0)
 .. D ^DIK
"RTN","RCRJRCOU",228,0)
 ; update last date
"RTN","RCRJRCOU",229,0)
 S DIE="^PRCA(430.7,",DA=RCREPORT,DR=".04////"_$$NOW^XLFDT D ^DIE
"RTN","RCRJRCOU",230,0)
 ;
"RTN","RCRJRCOU",231,0)
 ; determine data for the bill
"RTN","RCRJRCOU",232,0)
 S RCDR(.02)=ARACTDT ; date bill activitated
"RTN","RCRJRCOU",233,0)
 S RCDR(.03)=CATEGORY ; AR Cateogry
"RTN","RCRJRCOU",234,0)
 S RCDR(.04)=RCSTAT ; AR Status
"RTN","RCRJRCOU",235,0)
 S:TYPE'="" RCDR(.05)=TYPE ; fms type
"RTN","RCRJRCOU",236,0)
 S RCDR(.06)=RCFUND ; Fund Type
"RTN","RCRJRCOU",237,0)
 S RCDR(.07)=RCRSC ; Revenue Source Code
"RTN","RCRJRCOU",238,0)
 S RCDR(.08)=+RCVALUE ; Principal Amount
"RTN","RCRJRCOU",239,0)
 S RCDR(.09)=RCVALUE+$P(RCVALUE,"^",2)+$P(RCVALUE,"^",3)+$P(RCVALUE,"^",4)+$P(RCVALUE,"^",5) ; Current Balance
"RTN","RCRJRCOU",240,0)
 ;
"RTN","RCRJRCOU",241,0)
 ; Check for new or update entry
"RTN","RCRJRCOU",242,0)
 S RCDA=$O(^PRCA(430.7,RCREPORT,1,"B",BILLDA,0))
"RTN","RCRJRCOU",243,0)
 I 'RCDA D  Q
"RTN","RCRJRCOU",244,0)
 . ; add new entry
"RTN","RCRJRCOU",245,0)
 . N DO,DIC,X,Y,DA
"RTN","RCRJRCOU",246,0)
 . S DIC="^PRCA(430.7,"_RCREPORT_",1,",DIC(0)="",DA(1)=RCREPORT,X=BILLDA
"RTN","RCRJRCOU",247,0)
 . S DIC("DR")="",X=0
"RTN","RCRJRCOU",248,0)
 . F  S X=$O(RCDR(X)) Q:'X  S DIC("DR")=DIC("DR")_X_"////"_RCDR(X)_";"
"RTN","RCRJRCOU",249,0)
 . S DIC("DR")=$E(DIC("DR"),1,$L(DIC("DR"))-1)
"RTN","RCRJRCOU",250,0)
 . S X=BILLDA
"RTN","RCRJRCOU",251,0)
 . D FILE^DICN
"RTN","RCRJRCOU",252,0)
 ;
"RTN","RCRJRCOU",253,0)
 ; update entry (if it already exited)
"RTN","RCRJRCOU",254,0)
 S DIE="^PRCA(430.7,"_RCREPORT_",1,",DA=RCDA,DA(1)=RCREPORT
"RTN","RCRJRCOU",255,0)
 S DR="",X=0
"RTN","RCRJRCOU",256,0)
 F  S X=$O(RCDR(X)) Q:'X  S DR=DR_X_"////"_RCDR(X)_";"
"RTN","RCRJRCOU",257,0)
 S DR=$E(DR,1,$L(DR)-1) D:'$G(SCREEN) ^DIE
"RTN","RCRJRCOU",258,0)
 Q
"RTN","RCRJRCOU",259,0)
 ;
"RTN","RCRJRCOU",260,0)
EN ; option entry point to run the report
"RTN","RCRJRCOU",261,0)
 N RCREPORT,EXCEL,RCPROMPT,X,Y,DTOUT,DUOUT,DIR,ZTDESC,ZTSAVE,ZTRTN,ZTSK
"RTN","RCRJRCOU",262,0)
 ;
"RTN","RCRJRCOU",263,0)
 W !,"Select which accounting month/year for the ARDC Report"
"RTN","RCRJRCOU",264,0)
 S DIC="^PRCA(430.7,",DIC(0)="AEMNQ" D ^DIC Q:Y<1
"RTN","RCRJRCOU",265,0)
 S RCREPORT=+Y
"RTN","RCRJRCOU",266,0)
 S EXCEL=0,RCPROMPT="CAPTURE Report data to an Excel Document?",DIR(0)="Y",DIR("?")="^D HEXC^RCRJRCOU"
"RTN","RCRJRCOU",267,0)
 S EXCEL=$$SELECT^RCTCSJR(RCPROMPT,"NO") I "01"'[EXCEL Q
"RTN","RCRJRCOU",268,0)
 I EXCEL=1 D EXCMSG^RCTCSJR ; Display Excel display message
"RTN","RCRJRCOU",269,0)
 I 'EXCEL W !!,"This report requires 132 characters",!
"RTN","RCRJRCOU",270,0)
 K IOP,IO("Q") S %ZIS="MQ",%ZIS("B")="" D ^%ZIS Q:POP
"RTN","RCRJRCOU",271,0)
 I $D(IO("Q")) D  Q
"RTN","RCRJRCOU",272,0)
 .S ZTDESC="ARDC Detail Report",ZTRTN="DQQ^RCRJRCOU"
"RTN","RCRJRCOU",273,0)
 .S (ZTSAVE("RC*"),ZTSAVE("EXCEL"))="",ZTSAVE("ZTREQ")="@"
"RTN","RCRJRCOU",274,0)
 .D ^%ZTLOAD,HOME^%ZIS S QUIT=1
"RTN","RCRJRCOU",275,0)
 ;
"RTN","RCRJRCOU",276,0)
DQQ ; Print the report
"RTN","RCRJRCOU",277,0)
 N XMNOW,PAGE,RCOUT,RCREC,RCSP
"RTN","RCRJRCOU",278,0)
 S XMNOW=$$NOW^XLFDT  ;Capture the date and time the report was started for the header
"RTN","RCRJRCOU",279,0)
 S (RCOUT,PAGE)=0
"RTN","RCRJRCOU",280,0)
 S RCREC=0 F  S RCREC=$O(^PRCA(430.7,RCREPORT,1,RCREC)) Q:'RCREC!(RCOUT)  D
"RTN","RCRJRCOU",281,0)
 . N RCARRAY
"RTN","RCRJRCOU",282,0)
 . I PAGE<1 D HDR
"RTN","RCRJRCOU",283,0)
 . I 'EXCEL,$Y+3>IOSL I ($E(IOST,1,2)="C-")&(IO=IO(0)) S DIR(0)="E" D ^DIR K DIR D
"RTN","RCRJRCOU",284,0)
 .. I $D(DTOUT)!($D(DUOUT)) S RCOUT=1 G EXIT
"RTN","RCRJRCOU",285,0)
 .. D HDR
"RTN","RCRJRCOU",286,0)
 . Q:RCOUT
"RTN","RCRJRCOU",287,0)
 . ; extract data from file in external form
"RTN","RCRJRCOU",288,0)
 . D GETS^DIQ(430.71,RCREC_","_RCREPORT_",","*","","RCARRAY")
"RTN","RCRJRCOU",289,0)
 . S RCSP="0^14^26^50^68^75^84^92^104"
"RTN","RCRJRCOU",290,0)
 . W ! F X=.01:.01:.09 D
"RTN","RCRJRCOU",291,0)
 .. W:'EXCEL @("?"_$P(RCSP,"^",X*100))
"RTN","RCRJRCOU",292,0)
 .. S Y=$S(X=.03:20,X=.04:15,1:999)
"RTN","RCRJRCOU",293,0)
 .. W $E($G(RCARRAY(430.71,RCREC_","_RCREPORT_",",X)),1,Y)
"RTN","RCRJRCOU",294,0)
 .. I EXCEL,X'=.09 W "^"
"RTN","RCRJRCOU",295,0)
 ;
"RTN","RCRJRCOU",296,0)
 Q
"RTN","RCRJRCOU",297,0)
 ;
"RTN","RCRJROIG")
0^3^B27320049^B25716906
"RTN","RCRJROIG",1,0)
RCRJROIG ;WISC/RFJ-send data for oig extract ;1 Jul 99
"RTN","RCRJROIG",2,0)
 ;;4.5;Accounts Receivable;**103,174,203,205,220,270,335**;Mar 20, 1995;Build 8
"RTN","RCRJROIG",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","RCRJROIG",4,0)
 Q
"RTN","RCRJROIG",5,0)
 ;
"RTN","RCRJROIG",6,0)
 ;
"RTN","RCRJROIG",7,0)
NONMCCF(DATEEND) ;  build the non-mccf bills for user report and submission to oig
"RTN","RCRJROIG",8,0)
 N BILLDA,DATE,DATA7,OTHER,PRINCPAL
"RTN","RCRJROIG",9,0)
 S BILLDA=0 F  S BILLDA=$O(^PRCA(430,BILLDA)) Q:'BILLDA  D
"RTN","RCRJROIG",10,0)
 .   N FUND,RCRSC
"RTN","RCRJROIG",11,0)
 .   ;  if already stored, then it is a current receivable
"RTN","RCRJROIG",12,0)
 .   I $D(^TMP($J,"RCRJROIG",BILLDA)) Q
"RTN","RCRJROIG",13,0)
 .   ;  calculate principal and other (int + admin) balance
"RTN","RCRJROIG",14,0)
 .   S DATA7=$G(^PRCA(430,BILLDA,7))
"RTN","RCRJROIG",15,0)
 .   S PRINCPAL=+$P(DATA7,"^")
"RTN","RCRJROIG",16,0)
 .   S OTHER=$P(DATA7,"^",2)+$P(DATA7,"^",3)+$P(DATA7,"^",4)+$P(DATA7,"^",5)
"RTN","RCRJROIG",17,0)
 .   ;  in some bills, the principal and other balance may cancel
"RTN","RCRJROIG",18,0)
 .   ;  each other.  for example principal .08 + interest -.08 = 0
"RTN","RCRJROIG",19,0)
 .   I (PRINCPAL+OTHER)'>0 Q
"RTN","RCRJROIG",20,0)
 .   ;  store the data for submission to oig
"RTN","RCRJROIG",21,0)
 .   S ^TMP($J,"RCRJROIG",BILLDA)=PRINCPAL_"^"_OTHER
"RTN","RCRJROIG",22,0)
 .   ;  store the data for the user report (only if bill activated)
"RTN","RCRJROIG",23,0)
 .   S DATE=+$P($P($G(^PRCA(430,BILLDA,6)),"^",21),".") I 'DATE Q
"RTN","RCRJROIG",24,0)
 .   S ^TMP($J,"RCRJRCOLREPORT",DATE,BILLDA)=PRINCPAL_"^"_OTHER
"RTN","RCRJROIG",25,0)
 .   S FUND=$$GETFUNDB^RCXFMSUF(BILLDA,1),RCRSC=$$GETRSC(BILLDA,FUND)
"RTN","RCRJROIG",26,0)
 .   D STORE^RCRJRCOU(BILLDA,DATEBEG,DATEEND,DATE,$P(^PRCA(430,BILLDA,0),"^",2),"",FUND,RCRSC,$P(DATA7,"^",1,5),1)
"RTN","RCRJROIG",27,0)
 Q
"RTN","RCRJROIG",28,0)
 ;
"RTN","RCRJROIG",29,0)
 ;
"RTN","RCRJROIG",30,0)
OIG(DATEEND) ;  send data to the OIG
"RTN","RCRJROIG",31,0)
 N BILLDA,COUNT,DATA,DATA0,FUND,FYQ,OIGDATA,SEQUENCE,SITE,TOTALAMT
"RTN","RCRJROIG",32,0)
 N TOTALCNT,TOTALMSG,X,X1
"RTN","RCRJROIG",33,0)
 ;
"RTN","RCRJROIG",34,0)
 ;  get previous fiscal year quarter for mail message header
"RTN","RCRJROIG",35,0)
 S FYQ=$E(DATEEND,4,5),FYQ=$S(FYQ<4:1,FYQ<7:2,FYQ<10:3,1:4)
"RTN","RCRJROIG",36,0)
 S SITE=$$SITE^RCMSITE()
"RTN","RCRJROIG",37,0)
 ;
"RTN","RCRJROIG",38,0)
 ;  calculate the number of messages to be sent
"RTN","RCRJROIG",39,0)
 S (X,X1)=0 F  S X=$O(^TMP($J,"RCRJROIG",X)) Q:'X  S X1=X1+1
"RTN","RCRJROIG",40,0)
 S TOTALMSG=X1\272 I X1#272 S TOTALMSG=TOTALMSG+1
"RTN","RCRJROIG",41,0)
        ;
"RTN","RCRJROIG",42,0)
 ;  build the extract for oig
"RTN","RCRJROIG",43,0)
 S COUNT=0     ;  used to count bills to be sent in a single mail msg
"RTN","RCRJROIG",44,0)
 S SEQUENCE=0  ;  used to count mail messages sent (in mail subject)
"RTN","RCRJROIG",45,0)
 S TOTALCNT=0  ;  used to count total bills sent all mail messages
"RTN","RCRJROIG",46,0)
 S TOTALAMT=0  ;  used to calculate total dollars all mail messages
"RTN","RCRJROIG",47,0)
 K ^TMP($J,"RCRJROIGMM")
"RTN","RCRJROIG",48,0)
 S BILLDA=0 F  S BILLDA=$O(^TMP($J,"RCRJROIG",BILLDA)) Q:'BILLDA  D
"RTN","RCRJROIG",49,0)
 .   S DATA=^TMP($J,"RCRJROIG",BILLDA)
"RTN","RCRJROIG",50,0)
 .   S DATA0=^PRCA(430,BILLDA,0)
"RTN","RCRJROIG",51,0)
 .   ;  bill number, position 1-11
"RTN","RCRJROIG",52,0)
 .   S OIGDATA=$E($$LJ^XLFSTR($P(DATA0,"^"),11),1,11)  ; WCJ;PRCA*4.5*270
"RTN","RCRJROIG",53,0)
 .   ;  category, position 12-36
"RTN","RCRJROIG",54,0)
 .   S OIGDATA=OIGDATA_$$LJ^XLFSTR($E($P($G(^PRCA(430.2,+$P(DATA0,"^",2),0)),"^"),1,25),25)
"RTN","RCRJROIG",55,0)
 .   ;  status, position 37-56
"RTN","RCRJROIG",56,0)
 .   S OIGDATA=OIGDATA_$$LJ^XLFSTR($E($P($G(^PRCA(430.3,+$P(DATA0,"^",8),0)),"^"),1,20),20)
"RTN","RCRJROIG",57,0)
 .   ;  principal balance, position 57-65 (example 000000110 for 1.10)
"RTN","RCRJROIG",58,0)
 .   S OIGDATA=OIGDATA_$TR($J($P(DATA,"^"),10,2)," .","0")
"RTN","RCRJROIG",59,0)
 .   ;  date status last updated, position 66-76 (example APR 08,1999)
"RTN","RCRJROIG",60,0)
 .   S OIGDATA=OIGDATA_$$DATE($P(DATA0,"^",14))
"RTN","RCRJROIG",61,0)
 .   ;  fms fund, position 77-82
"RTN","RCRJROIG",62,0)
 .   S FUND=$$GETFUNDB^RCXFMSUF(BILLDA,1)
"RTN","RCRJROIG",63,0)
 .   S FUND=$$ADJFUND^RCRJRCO(FUND) ; may delete this line after 10/1/03
"RTN","RCRJROIG",64,0)
 .   S OIGDATA=OIGDATA_$J(FUND,6)
"RTN","RCRJROIG",65,0)
 .   ;  revenue source code, position 83-86
"RTN","RCRJROIG",66,0)
 .   S OIGDATA=OIGDATA_$J($$GETRSC(BILLDA,FUND),4)
"RTN","RCRJROIG",67,0)
 .   ;  general ledger account number, position 87-90
"RTN","RCRJROIG",68,0)
 .   S OIGDATA=OIGDATA_$J($P(DATA,"^",3),4)
"RTN","RCRJROIG",69,0)
 .   ;  date bill entered, position 91-101 (example APR 08,1999)
"RTN","RCRJROIG",70,0)
 .   S OIGDATA=OIGDATA_$$DATE($P(DATA0,"^",10))
"RTN","RCRJROIG",71,0)
 .   ;  interest + admin balance, position 102-110
"RTN","RCRJROIG",72,0)
 .   S OIGDATA=OIGDATA_$TR($J($P(DATA,"^",2),10,2)," .","0")_"$"
"RTN","RCRJROIG",73,0)
 .   ;
"RTN","RCRJROIG",74,0)
 .   ;  total count and dollars for bills sent
"RTN","RCRJROIG",75,0)
 .   S TOTALCNT=TOTALCNT+1
"RTN","RCRJROIG",76,0)
 .   S TOTALAMT=TOTALAMT+$P(DATA,"^")
"RTN","RCRJROIG",77,0)
 .   ;
"RTN","RCRJROIG",78,0)
 .   ;  store data for transmission
"RTN","RCRJROIG",79,0)
 .   S COUNT=COUNT+1
"RTN","RCRJROIG",80,0)
 .   S ^TMP($J,"RCRJROIGMM",COUNT)=OIGDATA
"RTN","RCRJROIG",81,0)
 .   ;  only send message with 272 bills
"RTN","RCRJROIG",82,0)
 .   I COUNT'=272 Q
"RTN","RCRJROIG",83,0)
 .   ;  if there are no more bills, do not send message until the
"RTN","RCRJROIG",84,0)
 .   ;  totals are placed at the end
"RTN","RCRJROIG",85,0)
 .   I '$O(^TMP($J,"RCRJROIG",BILLDA)) Q
"RTN","RCRJROIG",86,0)
 .   ;
"RTN","RCRJROIG",87,0)
 .   ;  send current code sheets
"RTN","RCRJROIG",88,0)
 .   S SEQUENCE=SEQUENCE+1
"RTN","RCRJROIG",89,0)
 .   D MAILIT(SITE,FYQ,SEQUENCE)
"RTN","RCRJROIG",90,0)
 .   S COUNT=0
"RTN","RCRJROIG",91,0)
 .   K ^TMP($J,"RCRJROIGMM")
"RTN","RCRJROIG",92,0)
 ;
"RTN","RCRJROIG",93,0)
 ;  mail last message with totals at the end
"RTN","RCRJROIG",94,0)
 S COUNT=COUNT+1
"RTN","RCRJROIG",95,0)
 S ^TMP($J,"RCRJROIGMM",COUNT)="END OF TRANSMISSION FOR SITE# "_SITE_":  TOTAL RECORDS: "_TOTALCNT_"  TOTAL AMOUNT: "_TOTALAMT
"RTN","RCRJROIG",96,0)
 S SEQUENCE=SEQUENCE+1
"RTN","RCRJROIG",97,0)
 D MAILIT(SITE,FYQ,SEQUENCE)
"RTN","RCRJROIG",98,0)
 ;
"RTN","RCRJROIG",99,0)
 K ^TMP($J,"RCRJROIGMM")
"RTN","RCRJROIG",100,0)
 K ^TMP($J,"RCRJROIG")
"RTN","RCRJROIG",101,0)
 Q
"RTN","RCRJROIG",102,0)
 ;
"RTN","RCRJROIG",103,0)
 ;
"RTN","RCRJROIG",104,0)
MAILIT(SITE,FYQ,SEQUENCE) ;  send code sheets to oig
"RTN","RCRJROIG",105,0)
 N %,%H,%Z,X,XCNP,XMDUZ,XMSCR,XMSUB,XMY,XMZ,Y
"RTN","RCRJROIG",106,0)
 ;
"RTN","RCRJROIG",107,0)
 ;  set a header record in each file to be transmitted
"RTN","RCRJROIG",108,0)
 S ^TMP($J,"RCRJROIGMM",.5)="OH$"_$$RJ^XLFSTR(SEQUENCE,5,0)_"$"_$$RJ^XLFSTR(TOTALMSG,5,0)_"$|"
"RTN","RCRJROIG",109,0)
 ;
"RTN","RCRJROIG",110,0)
 I TOTALCNT=0 S XMY("G.RC AR DATA COLLECTOR")=""
"RTN","RCRJROIG",111,0)
 S XMY("XXX@Q-OIG.DOMAIN.EXT")=""
"RTN","RCRJROIG",112,0)
 S XMDUZ="AR PACKAGE"
"RTN","RCRJROIG",113,0)
 S %H=$H D YX^%DTC
"RTN","RCRJROIG",114,0)
 S XMSUB=SITE_"/BILL/"_FYQ_"/SEQ#: "_SEQUENCE_"/"_Y
"RTN","RCRJROIG",115,0)
 S XMTEXT="^TMP($J,""RCRJROIGMM"","
"RTN","RCRJROIG",116,0)
 D ^XMD
"RTN","RCRJROIG",117,0)
 Q
"RTN","RCRJROIG",118,0)
 ;
"RTN","RCRJROIG",119,0)
 ;
"RTN","RCRJROIG",120,0)
DATE(DATE) ;  format date
"RTN","RCRJROIG",121,0)
 ;  example input=2990408, output=APR 08,1999
"RTN","RCRJROIG",122,0)
 I DATE D
"RTN","RCRJROIG",123,0)
 .   S Y=DATE D DD^%DT
"RTN","RCRJROIG",124,0)
 .   S DATE=$E(Y,1,3)_" "_$E(DATE,6,7)_","_(1700+$E(DATE,1,3))
"RTN","RCRJROIG",125,0)
 Q $$LJ^XLFSTR(DATE,11)
"RTN","RCRJROIG",126,0)
 ;
"RTN","RCRJROIG",127,0)
 ;
"RTN","RCRJROIG",128,0)
GETRSC(BILLDA,FUND) ;  return the rsc for a bill
"RTN","RCRJROIG",129,0)
 I '$$PTACCT^PRCAACC(FUND),FUND'=4032 Q $P($G(^PRCA(430,BILLDA,11)),"^",6)
"RTN","RCRJROIG",130,0)
 ;  check missing patient for reimbursable health insurance
"RTN","RCRJROIG",131,0)
 I $P(^PRCA(430,BILLDA,0),"^",2)=9,'$P(^PRCA(430,BILLDA,0),"^",7) Q "    "
"RTN","RCRJROIG",132,0)
 Q $$CALCRSC^RCXFMSUR(BILLDA)
"SEC","^DIC",430.7,430.7,0,"AUDIT")
@
"SEC","^DIC",430.7,430.7,0,"DD")
@
"SEC","^DIC",430.7,430.7,0,"DEL")
@
"SEC","^DIC",430.7,430.7,0,"LAYGO")
@
"SEC","^DIC",430.7,430.7,0,"RD")
@
"SEC","^DIC",430.7,430.7,0,"WR")
@
"VER")
8.0^22.2
"^DD",430.7,430.7,0)
FIELD^^.04^5
"^DD",430.7,430.7,0,"DT")
3171115
"^DD",430.7,430.7,0,"IX","B",430.7,.01)

"^DD",430.7,430.7,0,"NM","AR DEBT COLLECTOR DATA")

"^DD",430.7,430.7,.01,0)
REPORT MONTH/YEAR^RD^^0;1^S %DT="E" D ^%DT S X=Y K:X<1 X
"^DD",430.7,430.7,.01,1,0)
^.1
"^DD",430.7,430.7,.01,1,1,0)
430.7^B
"^DD",430.7,430.7,.01,1,1,1)
S ^PRCA(430.7,"B",$E(X,1,30),DA)=""
"^DD",430.7,430.7,.01,1,1,2)
K ^PRCA(430.7,"B",$E(X,1,30),DA)
"^DD",430.7,430.7,.01,3)
Enter the Month/Year of the report.
"^DD",430.7,430.7,.01,21,0)
^^2^2^3171115^
"^DD",430.7,430.7,.01,21,1,0)
This is the Month/Year of the report.  It will be the accounting 
"^DD",430.7,430.7,.01,21,2,0)
month/year that was transmitted to AITC.
"^DD",430.7,430.7,.01,"DT")
3171115
"^DD",430.7,430.7,.02,0)
REPORT START DATE^D^^0;2^S %DT="EX" D ^%DT S X=Y K:X<1 X
"^DD",430.7,430.7,.02,3)
Enter the starting date of the report month.
"^DD",430.7,430.7,.02,21,0)
^^2^2^3171106^
"^DD",430.7,430.7,.02,21,1,0)
This is the starting date of the report month.  It will be the start of
"^DD",430.7,430.7,.02,21,2,0)
the accounting month that was transmitted to AITC.
"^DD",430.7,430.7,.02,"DT")
3171106
"^DD",430.7,430.7,.03,0)
REPORT END DATE^D^^0;3^S %DT="EX" D ^%DT S X=Y K:X<1 X
"^DD",430.7,430.7,.03,3)
Enter the ending date of the accounting month.
"^DD",430.7,430.7,.03,21,0)
^^2^2^3171115^
"^DD",430.7,430.7,.03,21,1,0)
This is the date the accounting month ended.  It is the accounting month
"^DD",430.7,430.7,.03,21,2,0)
of data that was sent to the AITC.
"^DD",430.7,430.7,.03,"DT")
3171115
"^DD",430.7,430.7,.04,0)
DATE REPORT UPDATED^D^^0;4^S %DT="ESTXR" D ^%DT S X=Y K:X<1 X
"^DD",430.7,430.7,.04,3)
Enter the date/time the report was added or updated.
"^DD",430.7,430.7,.04,21,0)
^^1^1^3171106^
"^DD",430.7,430.7,.04,21,1,0)
This is the last date/time the report was updated (or initially added).
"^DD",430.7,430.7,.04,"DT")
3171106
"^DD",430.7,430.7,1,0)
AR BILL NUMBER^430.71P^^1;0
"^DD",430.7,430.7,1,21,0)
^^2^2^3171027^
"^DD",430.7,430.7,1,21,1,0)
This multiple contains all the AR Bills that were included in the 
"^DD",430.7,430.7,1,21,2,0)
documents sent to AITC.
"^DD",430.7,430.71,0)
AR BILL NUMBER SUB-FIELD^^.09^9
"^DD",430.7,430.71,0,"DT")
3171115
"^DD",430.7,430.71,0,"IX","AC",430.71,.02)

"^DD",430.7,430.71,0,"IX","B",430.71,.01)

"^DD",430.7,430.71,0,"NM","AR BILL NUMBER")

"^DD",430.7,430.71,0,"UP")
430.7
"^DD",430.7,430.71,.01,0)
AR BILL NUMBER^P430'^PRCA(430,^0;1^Q
"^DD",430.7,430.71,.01,1,0)
^.1
"^DD",430.7,430.71,.01,1,1,0)
430.71^B
"^DD",430.7,430.71,.01,1,1,1)
S ^PRCA(430.7,DA(1),1,"B",$E(X,1,30),DA)=""
"^DD",430.7,430.71,.01,1,1,2)
K ^PRCA(430.7,DA(1),1,"B",$E(X,1,30),DA)
"^DD",430.7,430.71,.01,3)
Enter an Accounts Receivable Bill Number associated with this report.
"^DD",430.7,430.71,.01,21,0)
^^2^2^3171024^
"^DD",430.7,430.71,.01,21,1,0)
This is an Accounts Receivable Bill Number associated with the report 
"^DD",430.7,430.71,.01,21,2,0)
that was transmitted to AITC.
"^DD",430.7,430.71,.01,"DT")
3171024
"^DD",430.7,430.71,.02,0)
DATE ACTIVATED^DO^^0;2^S %DT="EX" D ^%DT S X=Y K:X<1 X
"^DD",430.7,430.71,.02,1,0)
^.1
"^DD",430.7,430.71,.02,1,1,0)
430.71^AC
"^DD",430.7,430.71,.02,1,1,1)
S ^PRCA(430.7,DA(1),1,"AC",$E(X,1,30),DA)=""
"^DD",430.7,430.71,.02,1,1,2)
K ^PRCA(430.7,DA(1),1,"AC",$E(X,1,30),DA)
"^DD",430.7,430.71,.02,1,1,"%D",0)
^^2^2^3171115^
"^DD",430.7,430.71,.02,1,1,"%D",1,0)
This cross reference is used to sort the bills for printing the ARDC 
"^DD",430.7,430.71,.02,1,1,"%D",2,0)
Report.
"^DD",430.7,430.71,.02,1,1,"DT")
3171115
"^DD",430.7,430.71,.02,2)
S Y(0)=Y S Y=$$FMTE^XLFDT(Y,"2Z")
"^DD",430.7,430.71,.02,2.1)
S Y=$$FMTE^XLFDT(Y,"2Z")
"^DD",430.7,430.71,.02,3)
Enter the date the AR Bill was made active
"^DD",430.7,430.71,.02,21,0)
^^2^2^3171103^
"^DD",430.7,430.71,.02,21,1,0)
This is the date the AR bill became active.  It is determined from the 
"^DD",430.7,430.71,.02,21,2,0)
date the bill was prepared and captured based on what was sent to AITC.
"^DD",430.7,430.71,.02,"DT")
3171115
"^DD",430.7,430.71,.03,0)
AR CATEGORY^P430.2'^PRCA(430.2,^0;3^Q
"^DD",430.7,430.71,.03,3)
Enter the category for the bill that was sent to AITC
"^DD",430.7,430.71,.03,21,0)
^^2^2^3171027^
"^DD",430.7,430.71,.03,21,1,0)
This is the Accounts Receivable Category for the bill that was sent to 
"^DD",430.7,430.71,.03,21,2,0)
AITC.
"^DD",430.7,430.71,.03,"DT")
3171027
"^DD",430.7,430.71,.04,0)
AR STATUS^P430.3'^PRCA(430.3,^0;4^Q
"^DD",430.7,430.71,.04,3)
Enter the status of the AR bill.
"^DD",430.7,430.71,.04,21,0)
^^2^2^3171027^
"^DD",430.7,430.71,.04,21,1,0)
This is the status of the bill at the time the documents were sent to 
"^DD",430.7,430.71,.04,21,2,0)
AITC.
"^DD",430.7,430.71,.04,"DT")
3171027
"^DD",430.7,430.71,.05,0)
FMS TYPE^FJ10^^0;5^K:$L(X)>10!($L(X)<1) X
"^DD",430.7,430.71,.05,3)
Enter the FMS Report (Document) Type 1-10 characters.
"^DD",430.7,430.71,.05,21,0)
^^2^2^3171027^
"^DD",430.7,430.71,.05,21,1,0)
This is the FMS document type that was sent to AITC associated with this 
"^DD",430.7,430.71,.05,21,2,0)
receivable.
"^DD",430.7,430.71,.05,"DT")
3171027
"^DD",430.7,430.71,.06,0)
FUND TYPE^FJ10^^0;6^K:$L(X)>10!($L(X)<2) X
"^DD",430.7,430.71,.06,3)
Enter the bill's FMS fund code (2-10 characters).
"^DD",430.7,430.71,.06,21,0)
^^1^1^3171027^
"^DD",430.7,430.71,.06,21,1,0)
This is the fund type (code) that was transmitted to AITC.
"^DD",430.7,430.71,.06,"DT")
3171027
"^DD",430.7,430.71,.07,0)
REVENUE SOURCE CODE^FJ10^^0;7^K:$L(X)>10!($L(X)<2) X
"^DD",430.7,430.71,.07,3)
Enter the bill's Revenue Source Code (2-10 characters).
"^DD",430.7,430.71,.07,21,0)
^^1^1^3171027^
"^DD",430.7,430.71,.07,21,1,0)
This is the receivable's revenue source code that was transmitted to AITC.
"^DD",430.7,430.71,.07,"DT")
3171027
"^DD",430.7,430.71,.08,0)
PRINCIPAL AMOUNT^NJ10,2O^^0;8^S:X["$" X=$P(X,"$",2) K:X'?."-".N.1".".2N!(X>9999999.99)!(X<-999999.99)!(X?.E1"."3.N) X
"^DD",430.7,430.71,.08,2)
S Y(0)=Y S Y=$J(Y,9,2)
"^DD",430.7,430.71,.08,2.1)
S Y=$J(Y,9,2)
"^DD",430.7,430.71,.08,3)
Enter the dollar amount of the original bill (between -999999.99 and 9999999.99)
"^DD",430.7,430.71,.08,21,0)
^^2^2^3171103^
"^DD",430.7,430.71,.08,21,1,0)
This field is set to the original amount when a new bill is established.  
"^DD",430.7,430.71,.08,21,2,0)
It is the value that was transmitted to AITC.
"^DD",430.7,430.71,.08,"DT")
3171103
"^DD",430.7,430.71,.09,0)
CURRENT BALANCE^NJ10,2O^^0;9^S:X["$" X=$P(X,"$",2) K:X'?."-".N.1".".2N!(X>9999999.99)!(X<-999999.99)!(X?.E1"."3.N) X
"^DD",430.7,430.71,.09,2)
S Y(0)=Y S Y=$J(Y,10,2)
"^DD",430.7,430.71,.09,2.1)
S Y=$J(Y,10,2)
"^DD",430.7,430.71,.09,3)
Enter the current balance of the receivable (between -999999.99 and 9999999.99)
"^DD",430.7,430.71,.09,21,0)
^^2^2^3171027^
"^DD",430.7,430.71,.09,21,1,0)
This is the bill's current balance as of the time data was sent to the 
"^DD",430.7,430.71,.09,21,2,0)
AITC.
"^DD",430.7,430.71,.09,"DT")
3171027
"^DIC",430.7,430.7,0)
AR DEBT COLLECTOR DATA^430.7
"^DIC",430.7,430.7,0,"GL")
^PRCA(430.7,
"^DIC",430.7,430.7,"%",0)
^1.005^^
"^DIC",430.7,430.7,"%D",0)
^^6^6^3171103^
"^DIC",430.7,430.7,"%D",1,0)
Per VA Directive 6402, this file should not be modified.
"^DIC",430.7,430.7,"%D",2,0)
 
"^DIC",430.7,430.7,"%D",3,0)
This file will store the detailed data of which a summary is sent monthly 
"^DIC",430.7,430.7,"%D",4,0)
to the AITC.  This will allow sites to reconcile the data that was sent.  
"^DIC",430.7,430.7,"%D",5,0)
It will only store up to 3 months back and will be purged of any prior 
"^DIC",430.7,430.7,"%D",6,0)
month's data when the AR Data Collector runs.
"^DIC",430.7,"B","AR DEBT COLLECTOR DATA",430.7)

"BLD",10475,6)
^292
**END**
**END**

