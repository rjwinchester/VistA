Released PRCA*4.5*340 SEQ #298
Extracted from mail message
**KIDS**:PRCA*4.5*340^

**INSTALL NAME**
PRCA*4.5*340
"BLD",10468,0)
PRCA*4.5*340^ACCOUNTS RECEIVABLE^0^3180802^y
"BLD",10468,4,0)
^9.64PA^^
"BLD",10468,6.3)
9
"BLD",10468,"ABPKG")
n
"BLD",10468,"KRN",0)
^9.67PA^779.2^20
"BLD",10468,"KRN",.4,0)
.4
"BLD",10468,"KRN",.401,0)
.401
"BLD",10468,"KRN",.402,0)
.402
"BLD",10468,"KRN",.403,0)
.403
"BLD",10468,"KRN",.5,0)
.5
"BLD",10468,"KRN",.84,0)
.84
"BLD",10468,"KRN",3.6,0)
3.6
"BLD",10468,"KRN",3.8,0)
3.8
"BLD",10468,"KRN",9.2,0)
9.2
"BLD",10468,"KRN",9.8,0)
9.8
"BLD",10468,"KRN",9.8,"NM",0)
^9.68A^12^11
"BLD",10468,"KRN",9.8,"NM",1,0)
RCTCSP2^^0^B128258214
"BLD",10468,"KRN",9.8,"NM",2,0)
PRCARPM^^0^B50280653
"BLD",10468,"KRN",9.8,"NM",3,0)
PRCARPU^^0^B254883295
"BLD",10468,"KRN",9.8,"NM",5,0)
PRCAGT^^0^B22402514
"BLD",10468,"KRN",9.8,"NM",6,0)
PRCAHIS^^0^B26384958
"BLD",10468,"KRN",9.8,"NM",7,0)
RCRJRCOT^^0^B16117128
"BLD",10468,"KRN",9.8,"NM",8,0)
RCRJRBD^^0^B76750896
"BLD",10468,"KRN",9.8,"NM",9,0)
RCRJRCO1^^0^B24338424
"BLD",10468,"KRN",9.8,"NM",10,0)
RCRJRCOB^^0^B22540099
"BLD",10468,"KRN",9.8,"NM",11,0)
RCRJRTR1^^0^B42250765
"BLD",10468,"KRN",9.8,"NM",12,0)
RCRJRTRA^^0^B30416869
"BLD",10468,"KRN",9.8,"NM","B","PRCAGT",5)

"BLD",10468,"KRN",9.8,"NM","B","PRCAHIS",6)

"BLD",10468,"KRN",9.8,"NM","B","PRCARPM",2)

"BLD",10468,"KRN",9.8,"NM","B","PRCARPU",3)

"BLD",10468,"KRN",9.8,"NM","B","RCRJRBD",8)

"BLD",10468,"KRN",9.8,"NM","B","RCRJRCO1",9)

"BLD",10468,"KRN",9.8,"NM","B","RCRJRCOB",10)

"BLD",10468,"KRN",9.8,"NM","B","RCRJRCOT",7)

"BLD",10468,"KRN",9.8,"NM","B","RCRJRTR1",11)

"BLD",10468,"KRN",9.8,"NM","B","RCRJRTRA",12)

"BLD",10468,"KRN",9.8,"NM","B","RCTCSP2",1)

"BLD",10468,"KRN",19,0)
19
"BLD",10468,"KRN",19.1,0)
19.1
"BLD",10468,"KRN",101,0)
101
"BLD",10468,"KRN",409.61,0)
409.61
"BLD",10468,"KRN",771,0)
771
"BLD",10468,"KRN",779.2,0)
779.2
"BLD",10468,"KRN",870,0)
870
"BLD",10468,"KRN",8989.51,0)
8989.51
"BLD",10468,"KRN",8989.52,0)
8989.52
"BLD",10468,"KRN",8994,0)
8994
"BLD",10468,"KRN","B",.4,.4)

"BLD",10468,"KRN","B",.401,.401)

"BLD",10468,"KRN","B",.402,.402)

"BLD",10468,"KRN","B",.403,.403)

"BLD",10468,"KRN","B",.5,.5)

"BLD",10468,"KRN","B",.84,.84)

"BLD",10468,"KRN","B",3.6,3.6)

"BLD",10468,"KRN","B",3.8,3.8)

"BLD",10468,"KRN","B",9.2,9.2)

"BLD",10468,"KRN","B",9.8,9.8)

"BLD",10468,"KRN","B",19,19)

"BLD",10468,"KRN","B",19.1,19.1)

"BLD",10468,"KRN","B",101,101)

"BLD",10468,"KRN","B",409.61,409.61)

"BLD",10468,"KRN","B",771,771)

"BLD",10468,"KRN","B",779.2,779.2)

"BLD",10468,"KRN","B",870,870)

"BLD",10468,"KRN","B",8989.51,8989.51)

"BLD",10468,"KRN","B",8989.52,8989.52)

"BLD",10468,"KRN","B",8994,8994)

"BLD",10468,"QDEF")
^^^^NO^^^^NO^^NO
"BLD",10468,"QUES",0)
^9.62^^
"BLD",10468,"REQB",0)
^9.611^3^3
"BLD",10468,"REQB",1,0)
PRCA*4.5*339^2
"BLD",10468,"REQB",2,0)
PRCA*4.5*168^2
"BLD",10468,"REQB",3,0)
PRCA*4.5*320^2
"BLD",10468,"REQB","B","PRCA*4.5*168",2)

"BLD",10468,"REQB","B","PRCA*4.5*320",3)

"BLD",10468,"REQB","B","PRCA*4.5*339",1)

"MBREQ")
0
"PKG",53,-1)
1^1
"PKG",53,0)
ACCOUNTS RECEIVABLE^PRCA^FMS
"PKG",53,20,0)
^9.402P^1^1
"PKG",53,20,1,0)
2^^PRCAMRG
"PKG",53,20,1,1)

"PKG",53,20,"B",2,1)

"PKG",53,22,0)
^9.49I^1^1
"PKG",53,22,1,0)
4.5^3051119^2960627
"PKG",53,22,1,"PAH",1,0)
340^3180802
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
11
"RTN","PRCAGT")
0^5^B22402514^B22272453
"RTN","PRCAGT",1,0)
PRCAGT ;WASH-ISC@ALTOONA,PA/CMS-Patient Statement Build Tran List ;8/19/93
"RTN","PRCAGT",2,0)
V ;;4.5;Accounts Receivable;**100,162,165,169,219,301,340**;Mar 20, 1995;Build 9
"RTN","PRCAGT",3,0)
 ;;Per VA Directive 6402, this routine should not be modified.
"RTN","PRCAGT",4,0)
 ;SEND (DEB=340-IFN,BEG,END,TRANTYPE=430.3-IFN)
"RTN","PRCAGT",5,0)
 ;BUILD ^TMP("PRCAGT",$J,DEB,DATE,BILL,TN)=TAMT^TTY
"RTN","PRCAGT",6,0)
 ;IF (TN,TTY)=0 TAMT=BILL'S ORIG AMT
"RTN","PRCAGT",7,0)
 ;CALLER MUST KILL ^TMP
"RTN","PRCAGT",8,0)
EN(DEB,BEG,END,TTY) ;*CALLER MUST KILL ^TMP("PRCAGT",$J)
"RTN","PRCAGT",9,0)
 NEW Y K ^TMP("PRCAGT",$J)
"RTN","PRCAGT",10,0)
 S:$G(BEG)="" BEG=0 I $G(END)="" D NOW^%DTC S END=%
"RTN","PRCAGT",11,0)
 S TTY=$G(TTY) I TTY="" D F430
"RTN","PRCAGT",12,0)
 D F433
"RTN","PRCAGT",13,0)
Q Q
"RTN","PRCAGT",14,0)
F430 ;
"RTN","PRCAGT",15,0)
 NEW DAT,BN
"RTN","PRCAGT",16,0)
 S DAT=BEG F  S DAT=$O(^PRCA(430,"ATD",DEB,DAT)) Q:('DAT)!(DAT>END)  S BN=0 F  S BN=$O(^PRCA(430,"ATD",DEB,DAT,BN)) Q:'BN  D
"RTN","PRCAGT",17,0)
 .;Q:$D(^PRCA(430,"TCSP",BN))  ;prca*4.5*301
"RTN","PRCAGT",18,0)
 .I $P(^PRCA(430,BN,0),U,3) S ^TMP("PRCAGT",$J,DEB,DAT,BN,0)=$P(^PRCA(430,BN,0),"^",3)_"^0"
"RTN","PRCAGT",19,0)
 Q
"RTN","PRCAGT",20,0)
F433 ;
"RTN","PRCAGT",21,0)
 NEW DAT,TN,TN0,TN1 S COMM=0
"RTN","PRCAGT",22,0)
 F DAT=BEG:0 S DAT=$O(^PRCA(433,"ATD",DEB,DAT)) Q:('DAT)!(DAT>END)  F TN=0:0 S TN=$O(^PRCA(433,"ATD",DEB,DAT,TN)) Q:'TN  D
"RTN","PRCAGT",23,0)
 .S TN0=$G(^PRCA(433,TN,0)) Q:TN0=""  S TN1=$G(^PRCA(433,TN,1))
"RTN","PRCAGT",24,0)
 .I $P(TN1,U,2)=45 S COMM=1
"RTN","PRCAGT",25,0)
 .I $G(TTY)'="" Q:TTY'=$P(TN1,U,2)
"RTN","PRCAGT",26,0)
 .I TTY="",",3,4,5,6,7,24,25,30,"[(","_$P(TN1,U,2)_",") Q
"RTN","PRCAGT",27,0)
 .I ($P(TN0,U,2)="")!($P(TN0,U,4)'=2) Q
"RTN","PRCAGT",28,0)
 .I $G(PRCAHIST)="THIST",$P(TN1,U,2)=45 G F433A
"RTN","PRCAGT",29,0)
 .I $P(TN0,U,10)=1 Q
"RTN","PRCAGT",30,0)
 .;
"RTN","PRCAGT",31,0)
 .;  if transaction type not 46 (unsuspended) and not 47 (suspended)
"RTN","PRCAGT",32,0)
 .;  then check to see if the bill was suspended or unsuspended at the
"RTN","PRCAGT",33,0)
 .;  time the transaction was entered.  if the bill is suspended, then
"RTN","PRCAGT",34,0)
 .;  the transaction should not be counted.  if the bill is unsuspended
"RTN","PRCAGT",35,0)
 .;  then the transaction should be counted.
"RTN","PRCAGT",36,0)
 .I $P(TN1,"^",2)'=46,$P(TN1,"^",2)'=47 D  I TN1="" Q
"RTN","PRCAGT",37,0)
 .   .   N RCTRANDA,RCSTOP,TRANTYPE
"RTN","PRCAGT",38,0)
 .   .   ;  check to see if bill was unsuspended when transaction was created
"RTN","PRCAGT",39,0)
 .   .   ;  if so, count the transaction
"RTN","PRCAGT",40,0)
 .   .   S RCSTOP=0
"RTN","PRCAGT",41,0)
 .   .   S RCTRANDA=TN F  S RCTRANDA=$O(^PRCA(433,"C",+$P(TN0,"^",2),RCTRANDA),-1) Q:'RCTRANDA  D  I RCSTOP Q
"RTN","PRCAGT",42,0)
 .   .   .   ;  transaction not complete
"RTN","PRCAGT",43,0)
 .   .   .   I $P($G(^PRCA(433,RCTRANDA,0)),"^",4)'=2 Q
"RTN","PRCAGT",44,0)
 .   .   .   S TRANTYPE=$P($G(^PRCA(433,RCTRANDA,1)),"^",2)
"RTN","PRCAGT",45,0)
 .   .   .   ;  transaction type is unsuspended (46) meaning the bill
"RTN","PRCAGT",46,0)
 .   .   .   ;  was unsuspended when the transaction was created.  the
"RTN","PRCAGT",47,0)
 .   .   .   ;  transaction should be counted.
"RTN","PRCAGT",48,0)
 .   .   .   I TRANTYPE=46 S RCSTOP=1 Q
"RTN","PRCAGT",49,0)
 .   .   .   ;  transaction type is suspended (47) meaning the bill
"RTN","PRCAGT",50,0)
 .   .   .   ;  was suspended when the transaction was created.  the
"RTN","PRCAGT",51,0)
 .   .   .   ;  transaction should not be counted.
"RTN","PRCAGT",52,0)
 .   .   .   I TRANTYPE=47 S RCSTOP=1,TN1="" Q
"RTN","PRCAGT",53,0)
 .;
"RTN","PRCAGT",54,0)
 .I TTY="",+$P(TN1,U,5)=0,$P(TN1,U,2)'=45 Q
"RTN","PRCAGT",55,0)
F433A .S ^TMP("PRCAGT",$J,DEB,DAT,$P(TN0,U,2),TN)=+$P(TN1,U,5)_U_$P(TN1,U,2)
"RTN","PRCAGT",56,0)
 S DAT=0 F  S DAT=$O(^TMP("PRCAGT",$J,DEB,DAT)) Q:'DAT  S END=DAT
"RTN","PRCAGT",57,0)
 Q
"RTN","PRCAGT",58,0)
TBAL(DEB,TBAL) ;get balance of transactions
"RTN","PRCAGT",59,0)
 NEW BN,CH,DAT,PC,RF,RR,TAMT,TN,TTY,CS,CSFLAG
"RTN","PRCAGT",60,0)
 S RR=+$O(^PRCA(430.2,"AC",33,0)),(CH,RF,PC)=0,CSFLAG=$D(CSTCH)
"RTN","PRCAGT",61,0)
 I '$D(^TMP("PRCAGT",$J,DEB)) G TBALQ
"RTN","PRCAGT",62,0)
 F DAT=0:0 S DAT=$O(^TMP("PRCAGT",$J,DEB,DAT)) Q:'DAT  F BN=0:0 S BN=$O(^TMP("PRCAGT",$J,DEB,DAT,BN)) Q:'BN  D
"RTN","PRCAGT",63,0)
 .S CS=$D(^PRCA(430,"TCSP",BN)) ; set flag for CS bills
"RTN","PRCAGT",64,0)
 .I $D(^TMP("PRCAGT",$J,DEB,DAT,BN,0)) S CH=CH+^(0) S:CS CSTCH=$G(CSTCH)+^(0)
"RTN","PRCAGT",65,0)
 .F TN=0:0 S TN=$O(^TMP("PRCAGT",$J,DEB,DAT,BN,TN)) Q:'TN  S TAMT=^(TN),TTY=$P(TAMT,U,2) I TTY'=45 D
"RTN","PRCAGT",66,0)
 ..I TTY=12!(TTY=74) S:TAMT<0 PC=PC+TAMT S:TAMT'<0 CH=CH+TAMT S:TAMT<0&CS CSTPC=$G(CSTPC)+TAMT S:TAMT'<0 CSTCH=$G(CSTCH)+TAMT
"RTN","PRCAGT",67,0)
 ..;  interest and admin charges may be negative
"RTN","PRCAGT",68,0)
 ..;  this was added in patch 165
"RTN","PRCAGT",69,0)
 ..I TTY'=13 S TAMT=$TR(+TAMT,"-")
"RTN","PRCAGT",70,0)
 ..I $P(^PRCA(430,BN,0),U,2)=RR S:TTY=1 PC=PC-TAMT S:TTY=35 CH=CH+TAMT S:TTY=41 RF=RF+TAMT Q
"RTN","PRCAGT",71,0)
 ..I ",2,8,9,10,11,14,19,47,34,35,29,"[(","_TTY_",") S PC=PC-TAMT S:CS CSTPC=$G(CSTPC)-TAMT Q
"RTN","PRCAGT",72,0)
 ..I ",1,13,46,43,73,"[(","_TTY_",") S CH=CH+TAMT S:CS CSTCH=$G(CSTCH)+TAMT
"RTN","PRCAGT",73,0)
 ;
"RTN","PRCAGT",74,0)
TBALQ S TBAL("RF")=RF,TBAL("CH")=CH,TBAL("PC")=PC,TBAL=RF+CH+PC
"RTN","PRCAGT",75,0)
 I 'CSFLAG K CSTCH,CSTPC
"RTN","PRCAGT",76,0)
 Q
"RTN","PRCAGT",77,0)
ACT(DEB,DAT) ;Quit 1 if debtor has activity other than interest
"RTN","PRCAGT",78,0)
 NEW BN,DATT,TN,TN0,TN1
"RTN","PRCAGT",79,0)
 S TN=0 F DATT=$P($G(DAT),"."):0 S DATT=$O(^PRCA(430,"ATD",DEB,DATT)) Q:'DATT!(TN)  F BN=0:0 S BN=$O(^PRCA(430,"ATD",DEB,DATT,BN)) Q:'BN!(TN)  S TN=1 Q
"RTN","PRCAGT",80,0)
 I TN=1 G Q1
"RTN","PRCAGT",81,0)
 S BN=0 F DATT=$P($G(DAT),"."):0 S DATT=$O(^PRCA(433,"ATD",DEB,DATT)) Q:'DATT!(BN)  F TN=0:0 S TN=$O(^PRCA(433,"ATD",DEB,DATT,TN)) Q:'TN!(BN)  D
"RTN","PRCAGT",82,0)
 .S TN0=$G(^PRCA(433,TN,0)) Q:TN0=""  S TN1=$G(^PRCA(433,TN,1))
"RTN","PRCAGT",83,0)
 .I ($P(TN0,U,4)=1)!($P(TN0,U,10)=1) Q
"RTN","PRCAGT",84,0)
 .I +$P(TN1,U,5)=0,$P(TN1,U,2)'=45 Q
"RTN","PRCAGT",85,0)
 .I +$P(TN1,U,2)'=13 S BN=1 Q
"RTN","PRCAGT",86,0)
 I BN=1 G Q1
"RTN","PRCAGT",87,0)
Q0 Q 0
"RTN","PRCAGT",88,0)
Q1 Q 1
"RTN","PRCAHIS")
0^6^B26384958^B26002669
"RTN","PRCAHIS",1,0)
PRCAHIS ;WASH-ISC@ALTOONA,PA/LDB-Transaction History Report ;9/27/93  4:32 PM
"RTN","PRCAHIS",2,0)
V ;;4.5;Accounts Receivable;**110,198,233,315,340**;Mar 20, 1995;Build 9
"RTN","PRCAHIS",3,0)
 ;;Per VA Directive 6402, this routine should not be modified.
"RTN","PRCAHIS",4,0)
 ;
"RTN","PRCAHIS",5,0)
EN ;Ask debtor and date range for transaction history
"RTN","PRCAHIS",6,0)
 K DIR S POP=0
"RTN","PRCAHIS",7,0)
 N DPTNOFZY,DPTNOFZK S (DPTNOFZY,DPTNOFZK)=1
"RTN","PRCAHIS",8,0)
 S DIR(0)="PO^340:QEAMZ",DIR("A")="Select Patient ",DIR("?")="Enter a Patient name" D ^DIR
"RTN","PRCAHIS",9,0)
 I $D(DIRUT)!(Y="") G EXIT1
"RTN","PRCAHIS",10,0)
 I $P($G(^RCD(340,+Y,0)),U)'["DPT" W *7 G EN
"RTN","PRCAHIS",11,0)
 S DEB=+Y K DIR
"RTN","PRCAHIS",12,0)
 I '$D(^PRCA(433,"ATD",DEB)),'$D(^PRCA(430,"ATD",DEB)),'$D(^RC(341,"AD",DEB)) W !,"This patient has no activity." Q
"RTN","PRCAHIS",13,0)
 S BDATE=$O(^PRCA(433,"ATD",+DEB,0)),DIR(0)="DO" S:'BDATE BDATE=2910101
"RTN","PRCAHIS",14,0)
 S DIR("A")="History beginning",DIR("B")=$$FMTE^XLFDT(BDATE,"1D")
"RTN","PRCAHIS",15,0)
 S DIR("?")="The default date is either the last statement day or T-30, but any date may be entered."
"RTN","PRCAHIS",16,0)
 D ^DIR
"RTN","PRCAHIS",17,0)
 S:Y'="" BDATE=Y I $D(DIRUT)&'Y G EXIT1 Q
"RTN","PRCAHIS",18,0)
 K DIR,X,Y
"RTN","PRCAHIS",19,0)
 S DIR(0)="DO^"_BDATE_":DT"
"RTN","PRCAHIS",20,0)
 S DIR("A")="History ending",DIR("B")=$$FMTE^XLFDT(DT,"1D")
"RTN","PRCAHIS",21,0)
 D ^DIR S:Y="" Y=DT I $D(DIRUT)&'Y G EXIT1 Q
"RTN","PRCAHIS",22,0)
 S EDATE=Y
"RTN","PRCAHIS",23,0)
 K DIR
"RTN","PRCAHIS",24,0)
TYPE S DIC="^PRCA(430.3,",DIC(0)="QEMZ",DIC("S")="I +Y,(+Y<15!(""^25^29^34^35^40^41^43^45^47^51^53^54^55^56^57^60^64^65^66^67^68^70^71^72^73^74^75^76^79^80^83^84^85^""[(""^""_+Y_""^"")))"
"RTN","PRCAHIS",25,0)
 S Y=0 R !,"TRANSACTION TYPE: ALL//",X:DTIME I '$T!(X="^") Q
"RTN","PRCAHIS",26,0)
 I X]"",X'="ALL" D ^DIC
"RTN","PRCAHIS",27,0)
 I X["?" W !!,"Enter 'ALL' for all types of transactions in the AR TRANSACTION TYPE FILE",!,"including COMMENTS and STATEMENT DATES.",! G TYPE
"RTN","PRCAHIS",28,0)
 G:Y<0 EXIT1  S TYP=$S(+Y:+Y,1:X)
"RTN","PRCAHIS",29,0)
 I $P($G(^PRCA(430.3,+Y,0)),"^",3)>100 W !!,"This is STATUS. Enter a transaction type only." G TYPE
"RTN","PRCAHIS",30,0)
 S %ZIS="AEQ" D ^%ZIS G:POP EXIT1
"RTN","PRCAHIS",31,0)
 I $D(IO("Q")) D  Q
"RTN","PRCAHIS",32,0)
 .S ZTSAVE("DEB")="",ZTSAVE("BDATE")="",ZTSAVE("EDATE")="",ZTSAVE("TYP")="",ZTRTN="DQ^PRCAHIS",ZTDESC="Patient Transaction History Report"
"RTN","PRCAHIS",33,0)
 .D ^%ZTLOAD,^%ZISC,EXIT1 K ZTSAVE,ZTRTN Q
"RTN","PRCAHIS",34,0)
 ;
"RTN","PRCAHIS",35,0)
DQ ;Call to build array of payment transactions
"RTN","PRCAHIS",36,0)
 ;
"RTN","PRCAHIS",37,0)
 U IO
"RTN","PRCAHIS",38,0)
 D TRANS^PRCAHIS1
"RTN","PRCAHIS",39,0)
 I '$D(^TMP("PRCAGT",$J)) W !!,"This patient has no activity during this time period."
"RTN","PRCAHIS",40,0)
 I $D(^TMP("PRCAGT",$J)) D HDR,PRINT
"RTN","PRCAHIS",41,0)
 ;
"RTN","PRCAHIS",42,0)
EXIT1 K AMT,BDATE,BN,BN0,CAT,CATCARE,EDATE,EVNTT,DAT1,DAT2,DATE,DEB,DIC,DIR,DIWL,DIWF,DIWR,DIWT,DUOUT,DX,DY,EVNT,EVNTT,LINE,PG,PNODE,TBAL,TOTPRIN,TOTTRAN,TTYP,TYP,TN,TN0,X,Y,Z,ZTSK,^TMP("PRCAGT",$J),^UTILITY($J)
"RTN","PRCAHIS",43,0)
 I $D(DIRUT)!POP K DIRUT,POP Q
"RTN","PRCAHIS",44,0)
 ;end of routine
"RTN","PRCAHIS",45,0)
EXIT2 I $E(IOST,1,2)'="C-" W @IOF D ^%ZISC Q
"RTN","PRCAHIS",46,0)
 I $E(IOST,1,2)="C-" W ! D ENS^%ZISS S DY=IOM-1,DX=0 X IOXY D KILL^%ZISS K DIR,X,Y,^UTILITY($J) S DIR(0)="E" D ^DIR
"RTN","PRCAHIS",47,0)
 I $D(DIRUT) K DIRUT Q
"RTN","PRCAHIS",48,0)
 D ^%ZISC
"RTN","PRCAHIS",49,0)
 G EN
"RTN","PRCAHIS",50,0)
 ;
"RTN","PRCAHIS",51,0)
 ;
"RTN","PRCAHIS",52,0)
PRINT ;Print transactions
"RTN","PRCAHIS",53,0)
 K DIRUT
"RTN","PRCAHIS",54,0)
 S DATE=0 F  S DATE=$O(^TMP("PRCAGT",$J,DEB,DATE)) Q:'DATE  Q:$D(DIRUT)  D
"RTN","PRCAHIS",55,0)
 .S BN="" F  S BN=$O(^TMP("PRCAGT",$J,DEB,DATE,BN)) Q:BN=""!($D(DIRUT))  D SCRN D
"RTN","PRCAHIS",56,0)
 ..I $D(^TMP("PRCAGT",$J,DEB,DATE,0)) S (BN0,PNODE)=^(0) D
"RTN","PRCAHIS",57,0)
 ...W !,$$FMTE^XLFDT($P(DATE,".")),?16
"RTN","PRCAHIS",58,0)
 ...S TYP=$P(BN0,"^",2) W $S(TYP=1:"COMMENT",1:"PATIENT STATEMENT PRINTED") I TYP=1 S EVNT=$P(BN0,"^",3) D
"RTN","PRCAHIS",59,0)
 ....W:$D(^RC(341,+EVNT,4)) !,?16,$P(^(4),"^")
"RTN","PRCAHIS",60,0)
 ....I $O(^RC(341,+EVNT,2,0)) S EVNTT=0 F  S EVNTT=$O(^RC(341,+EVNT,2,EVNTT)) Q:'EVNTT  I $D(^(EVNTT,0)) S X=^(0) D  Q:$D(DIRUT)  D ^DIWW
"RTN","PRCAHIS",61,0)
 .....S DIWL=17,DIWF="WC63" D ^DIWP
"RTN","PRCAHIS",62,0)
 .....D SCRN
"RTN","PRCAHIS",63,0)
 ..Q:(BN=0)  S TN="" F  S TN=$O(^TMP("PRCAGT",$J,DEB,DATE,BN,TN)) Q:TN=""  Q:$D(DIRUT)  D SCRN D
"RTN","PRCAHIS",64,0)
 ...I 'TN,$D(^TMP("PRCAGT",$J,DEB,DATE,BN,0)) S PNODE=^(0),BN0=$G(^PRCA(430,+BN,0)) W !!,$$FMTE^XLFDT($P(DATE,".")) D
"RTN","PRCAHIS",65,0)
 ....S CAT=$P(BN0,"^",2),CAT=$S(CAT=24&$P(BN0,"^",16):$P(^PRCA(430.2,$P(BN0,"^",16),0),"^"),1:$P($G(^PRCA(430.2,+CAT,0)),"^"))
"RTN","PRCAHIS",66,0)
 ....W ?16,CAT," BILL",?56,$P($G(^PRCA(430,+BN,0)),"^"),?69,$J(+PNODE,10,2)
"RTN","PRCAHIS",67,0)
 ....W !,?16,$P($G(^PRCA(430.3,+$P(BN0,"^",8),0)),"^")
"RTN","PRCAHIS",68,0)
 ...I TN S PNODE=^TMP("PRCAGT",$J,DEB,DATE,BN,TN) W !!,$$FMTE^XLFDT(DATE,"1D"),?16 S TYP=$P($G(^PRCA(433,+TN,1)),"^",2),TTYP=$P($G(^PRCA(430.3,+TYP,0)),U) W TTYP D
"RTN","PRCAHIS",69,0)
 ....S CAT=$P($G(^PRCA(430,+BN,0)),"^",2),CAT=$P($G(^PRCA(430.2,+CAT,0)),"^")
"RTN","PRCAHIS",70,0)
 ....S CATCARE=$P($G(^PRCA(430,+BN,0)),"^",16),CATCARE=$P($G(^PRCA(430.2,+$P(^(0),"^",16),0)),"^")
"RTN","PRCAHIS",71,0)
 ...I TN W ?56,$P($G(^PRCA(430,+BN,0)),"^") W:+TYP'=45 ?69,$J(+PNODE,10,2)
"RTN","PRCAHIS",72,0)
 ...I TN W !?16,CAT W:CATCARE]"" !,?16,CATCARE
"RTN","PRCAHIS",73,0)
 ...I TN,(+TYP=45) D
"RTN","PRCAHIS",74,0)
 ....I $D(^PRCA(433,+TN,5)) W !?16,$P(^(5),"^",2)
"RTN","PRCAHIS",75,0)
 ....I $O(^PRCA(433,+TN,7,0)) S TN0=0 F  S TN0=$O(^PRCA(433,+TN,7,TN0)) Q:'TN0  I $D(^(TN0,0)) S X=^(0) D  Q:$D(DIRUT)  D ^DIWW
"RTN","PRCAHIS",76,0)
 .....S DIWL=17,DIWF="C63W" D ^DIWP
"RTN","PRCAHIS",77,0)
 ...D SCRN
"RTN","PRCAHIS",78,0)
 ..Q
"RTN","PRCAHIS",79,0)
 .Q
"RTN","PRCAHIS",80,0)
 Q
"RTN","PRCAHIS",81,0)
 ;
"RTN","PRCAHIS",82,0)
SCRN ;Check for screen
"RTN","PRCAHIS",83,0)
 N X,Y K DIR I ($Y+5)>IOSL D
"RTN","PRCAHIS",84,0)
 .I $E(IOST,1,2)="C-" S DIR(0)="E" D ^DIR Q:$D(DIRUT)
"RTN","PRCAHIS",85,0)
 .D HDR
"RTN","PRCAHIS",86,0)
 Q
"RTN","PRCAHIS",87,0)
 ;
"RTN","PRCAHIS",88,0)
HDR ;Heading for report
"RTN","PRCAHIS",89,0)
 S PG=PG+1
"RTN","PRCAHIS",90,0)
 W @IOF,!,?20,"Patient Transaction History Report",?70,"Page ",PG
"RTN","PRCAHIS",91,0)
 W !,?20,"-------------------------------------"
"RTN","PRCAHIS",92,0)
 W !!,?18,"For Patient: ",$$NAM^RCFN01(DEB),!,?25,"SSN : ",$$SSN^RCFN01(DEB)
"RTN","PRCAHIS",93,0)
 W !,?20,"For dates: ",$$FMTE^XLFDT(BDATE,"1D"),"-",$$FMTE^XLFDT(EDATE,"1D")
"RTN","PRCAHIS",94,0)
 W !!," DATE",?16,"ACTIVITY",?56,"BILL #",?73,"AMOUNT",!,LINE
"RTN","PRCARPM")
0^2^B50280653^B37026153
"RTN","PRCARPM",1,0)
PRCARPM ;ALB/DRF-CREATE MULTIPLE ACCOUNT REPAYMENT DATE SCHEDULE ;08/09/2016  4:40 PM
"RTN","PRCARPM",2,0)
 ;;4.5;Accounts Receivable;**315,340**;Mar 20, 1995;Build 9
"RTN","PRCARPM",3,0)
 ;;Per VA Directive 6402, this routine should not be modified.
"RTN","PRCARPM",4,0)
 ;
"RTN","PRCARPM",5,0)
BEGIN ;Start here
"RTN","PRCARPM",6,0)
 N ACT,ADD,ALL,D0,DEL,DIC,DIR,LIST,LSTDATE,MULTI,NON,PAYDATE,PLN,PLNAMT,PLNDAY,PLNDT
"RTN","PRCARPM",7,0)
 N PLNFRST,PLNLST,PLNNXT,PLNRMN,PLNTDUE,PRCA,PRCADAY,PRCADT,PRCAFP,PRCAFPD,PRCAMT
"RTN","PRCARPM",8,0)
 N PRCANPAY,PRCAPB,PRCAREM,QUIT,SUCCESS,SURE,T,TOTAL,TOTDUE,X,Y
"RTN","PRCARPM",9,0)
 S QUIT=0
"RTN","PRCARPM",10,0)
 I $G(DEBTOR)]"" L -^RCD(340,+DEBTOR) ;Release previous debtor lock
"RTN","PRCARPM",11,0)
 S DEBTOR=$$DEBTOR^PRCARPU()
"RTN","PRCARPM",12,0)
 I $G(DEBTOR)="" K DEBTOR Q
"RTN","PRCARPM",13,0)
 W "  ",$$NAM^RCFN01(+DEBTOR)
"RTN","PRCARPM",14,0)
 L +^RCD(340,+DEBTOR):1 I '$T W !,"Another user is editing this record",!! D PAUSE^PRCARPU G BEGIN
"RTN","PRCARPM",15,0)
 D ACCOUNTS^PRCARPU(+DEBTOR,.ALL,.PLN,.NON,.ACT)
"RTN","PRCARPM",16,0)
 I ACT=0 W !,"No active bills for this debtor",!! D PAUSE^PRCARPU G BEGIN
"RTN","PRCARPM",17,0)
 I PLN=0 G NOPLAN ;No current plan
"RTN","PRCARPM",18,0)
 S MULTI=$$MULTI^PRCARPU(.PLN) I MULTI G MULTPLN ;Multiple existing plans
"RTN","PRCARPM",19,0)
 I PLN G PLAN ;Single existing plan
"RTN","PRCARPM",20,0)
 G BEGIN
"RTN","PRCARPM",21,0)
 ;
"RTN","PRCARPM",22,0)
PLAN ;There is an existing Repayment Plan
"RTN","PRCARPM",23,0)
 S DIR(0)="SA^E:EDIT;D:DELETE;V:VIEW^",DIR("B")="V"
"RTN","PRCARPM",24,0)
 S DIR("A")="This Debtor has a Repayment Plan - (D)elete, (E)dit or (V)iew it? "
"RTN","PRCARPM",25,0)
 D ^DIR
"RTN","PRCARPM",26,0)
 I Y="V" G VIEW
"RTN","PRCARPM",27,0)
 I Y="D" G DELETE
"RTN","PRCARPM",28,0)
 I Y="E",NON G EDITADD
"RTN","PRCARPM",29,0)
 I Y="E",NON=0 G EDIT
"RTN","PRCARPM",30,0)
 G BEGIN
"RTN","PRCARPM",31,0)
 ;
"RTN","PRCARPM",32,0)
MULTPLN ;There is more than one existing Repayment Plan
"RTN","PRCARPM",33,0)
 S DIR(0)="Y"
"RTN","PRCARPM",34,0)
 S DIR("A")="This Debtor has multiple plans - view them"
"RTN","PRCARPM",35,0)
 S DIR("?")="Enter Y to view multiple Repayment Plans"
"RTN","PRCARPM",36,0)
 D ^DIR I $D(DUOUT)!($D(DTOUT)) G BEGIN
"RTN","PRCARPM",37,0)
 I 'Y G BEGIN
"RTN","PRCARPM",38,0)
 D DSMPLNS^PRCARPU(DEBTOR,.PLN)
"RTN","PRCARPM",39,0)
 I QUIT G BEGIN
"RTN","PRCARPM",40,0)
 S DIR(0)="Y"
"RTN","PRCARPM",41,0)
 S DIR("A")="This Debtor has multiple plans - consolidate them"
"RTN","PRCARPM",42,0)
 S DIR("?")="Enter Y to consolidate multiple Repayment Plans into one"
"RTN","PRCARPM",43,0)
 D ^DIR I $D(DUOUT)!($D(DTOUT)) G BEGIN
"RTN","PRCARPM",44,0)
 I 'Y G MLTDEL
"RTN","PRCARPM",45,0)
 S TOTDUE=$$DUEARR^PRCARPU(.PLN) ;New total amount due
"RTN","PRCARPM",46,0)
 S SUCCESS=$$INQPLAN^PRCARPU(TOTDUE,PLNDT)
"RTN","PRCARPM",47,0)
 I 'SUCCESS W !! G BEGIN
"RTN","PRCARPM",48,0)
 D RPDEL^PRCARPU(.PLN,0)
"RTN","PRCARPM",49,0)
 D ADDPLAN^PRCARPU(.PLN,PRCAMT,PRCADAY,PRCAFPD,PRCADT,0)
"RTN","PRCARPM",50,0)
 W !,"The Repayment Plan has been consolidated.",!
"RTN","PRCARPM",51,0)
 D SCRNCHK^PRCARPU I QUIT G BEGIN
"RTN","PRCARPM",52,0)
 D ACCOUNTS^PRCARPU(+DEBTOR,.ALL,.PLN,.NON,.ACT) ;Reload accounts after change is filed
"RTN","PRCARPM",53,0)
 I NON G EDITADD
"RTN","PRCARPM",54,0)
 D RPDIS^PRCARPU(DEBTOR,.PLN)
"RTN","PRCARPM",55,0)
 S T=$$DISPLAY^PRCARPU(.PLN,0,.QUIT) I QUIT G BEGIN
"RTN","PRCARPM",56,0)
 D SCRNCHK^PRCARPU I QUIT G BEGIN
"RTN","PRCARPM",57,0)
 D PAYDISP^PRCARPU(+DEBTOR,PLNDT,.QUIT) I QUIT G BEGIN
"RTN","PRCARPM",58,0)
 D CMTENTR^PRCARPU(+DEBTOR)
"RTN","PRCARPM",59,0)
 D PAUSE^PRCARPU
"RTN","PRCARPM",60,0)
 G BEGIN
"RTN","PRCARPM",61,0)
 ;
"RTN","PRCARPM",62,0)
DELETE ;Delete a Repayment Plan
"RTN","PRCARPM",63,0)
 D RPDIS^PRCARPU(DEBTOR,.PLN)
"RTN","PRCARPM",64,0)
 S T=$$DISPLAY^PRCARPU(.PLN,0,.QUIT) I QUIT G BEGIN
"RTN","PRCARPM",65,0)
 S SURE=$$CORRECT^PRCARPU()
"RTN","PRCARPM",66,0)
 I '+SURE G BEGIN
"RTN","PRCARPM",67,0)
 D RPDEL^PRCARPU(.PLN,1)
"RTN","PRCARPM",68,0)
 W !!,"The Repayment Plan for "_$P(DEBTOR,U,2)_" has been Deleted.",!
"RTN","PRCARPM",69,0)
 D SCRNCHK^PRCARPU I QUIT G BEGIN
"RTN","PRCARPM",70,0)
 D CMTENTR^PRCARPU(+DEBTOR)
"RTN","PRCARPM",71,0)
 D PAUSE^PRCARPU
"RTN","PRCARPM",72,0)
 G BEGIN
"RTN","PRCARPM",73,0)
 ;
"RTN","PRCARPM",74,0)
EDITADD ;Edit a Repayment Plan with new bills
"RTN","PRCARPM",75,0)
 D RPDIS^PRCARPU(DEBTOR,.PLN)
"RTN","PRCARPM",76,0)
 S T=$$DISPLAY^PRCARPU(.PLN,0,.QUIT) I QUIT G BEGIN
"RTN","PRCARPM",77,0)
 K DEL M DEL=PLN ;PRCA*4.5*340/DRF Always kill previous plan from bills
"RTN","PRCARPM",78,0)
 D PAYDISP^PRCARPU(+DEBTOR,PLNDT,.QUIT) I QUIT G BEGIN
"RTN","PRCARPM",79,0)
 D SCRNCHK^PRCARPU I QUIT G BEGIN
"RTN","PRCARPM",80,0)
 W !,"Bills not in Repayment Plan:",!
"RTN","PRCARPM",81,0)
 D SCRNCHK^PRCARPU I QUIT G BEGIN
"RTN","PRCARPM",82,0)
 S TOTAL=$$DISPLAY^PRCARPU(.NON,1,.QUIT) I QUIT G BEGIN
"RTN","PRCARPM",83,0)
 I TOTAL=0 G NOBILLS
"RTN","PRCARPM",84,0)
 K ADD
"RTN","PRCARPM",85,0)
 D SCRNCHK^PRCARPU I QUIT G BEGIN
"RTN","PRCARPM",86,0)
 S LIST=$$SELECT^PRCARPU(.NON)
"RTN","PRCARPM",87,0)
 I LIST="" W !,"  No Bills selected",! D PAUSE^PRCARPU G:QUIT BEGIN G NOBILLS
"RTN","PRCARPM",88,0)
 D SUMM^PRCARPU(.NON,LIST,.ADD)
"RTN","PRCARPM",89,0)
 S TOTDUE=$$DUEARR^PRCARPU(.ADD) ;Amount being added
"RTN","PRCARPM",90,0)
 W !!,"Total amount chosen is $",$J(TOTDUE,8,2),!
"RTN","PRCARPM",91,0)
 D SCRNCHK^PRCARPU I QUIT G BEGIN
"RTN","PRCARPM",92,0)
 S SURE=$$CORRECT^PRCARPU()
"RTN","PRCARPM",93,0)
 I 'SURE W !! G BEGIN
"RTN","PRCARPM",94,0)
 D MERGE^PRCARPU(.PLN,.ADD)
"RTN","PRCARPM",95,0)
NOBILLS ;No new bill were chosen
"RTN","PRCARPM",96,0)
 S TOTDUE=$$DUEARR^PRCARPU(.PLN) ;New total amount due
"RTN","PRCARPM",97,0)
 D SCRNCHK^PRCARPU I QUIT G BEGIN
"RTN","PRCARPM",98,0)
 S SUCCESS=$$INQPLAN^PRCARPU(TOTDUE,PLNDT)
"RTN","PRCARPM",99,0)
 I 'SUCCESS W !! G BEGIN
"RTN","PRCARPM",100,0)
 D RPDEL^PRCARPU(.DEL,0)
"RTN","PRCARPM",101,0)
 K DEL
"RTN","PRCARPM",102,0)
 D ADDPLAN^PRCARPU(.PLN,PRCAMT,PRCADAY,PRCAFPD,PRCADT,0)
"RTN","PRCARPM",103,0)
 I $G(ADD) D ADDTRAN^PRCARPU(.ADD) ;Add a 433 transaction entry to the new bills being added to the plan
"RTN","PRCARPM",104,0)
 W !!,"The Repayment Plan has been updated.",!
"RTN","PRCARPM",105,0)
 D SCRNCHK^PRCARPU I QUIT G BEGIN
"RTN","PRCARPM",106,0)
 K ADD
"RTN","PRCARPM",107,0)
 D ACCOUNTS^PRCARPU(+DEBTOR,.ALL,.PLN,.NON,.ACT) ;Reload accounts after change is filed 
"RTN","PRCARPM",108,0)
 D RPDIS^PRCARPU(DEBTOR,.PLN)
"RTN","PRCARPM",109,0)
 S T=$$DISPLAY^PRCARPU(.PLN,0,.QUIT) I QUIT G BEGIN
"RTN","PRCARPM",110,0)
 D SCRNCHK^PRCARPU I QUIT G BEGIN
"RTN","PRCARPM",111,0)
 D CMTENTR^PRCARPU(+DEBTOR)
"RTN","PRCARPM",112,0)
 D PAUSE^PRCARPU
"RTN","PRCARPM",113,0)
 G BEGIN
"RTN","PRCARPM",114,0)
 ;
"RTN","PRCARPM",115,0)
EDIT ;Edit a Repayment Plan, no new bills
"RTN","PRCARPM",116,0)
 D RPDIS^PRCARPU(DEBTOR,.PLN)
"RTN","PRCARPM",117,0)
 S T=$$DISPLAY^PRCARPU(.PLN,0,.QUIT) I QUIT G BEGIN
"RTN","PRCARPM",118,0)
 D SCRNCHK^PRCARPU I QUIT G BEGIN
"RTN","PRCARPM",119,0)
 W !,"There are no new bills to be added.",!
"RTN","PRCARPM",120,0)
 D SCRNCHK^PRCARPU I QUIT G BEGIN
"RTN","PRCARPM",121,0)
 D PAYDISP^PRCARPU(+DEBTOR,PLNDT,.QUIT) I QUIT G BEGIN
"RTN","PRCARPM",122,0)
 D SCRNCHK^PRCARPU I QUIT G BEGIN
"RTN","PRCARPM",123,0)
 S SUCCESS=$$INQPLAN^PRCARPU(PLNTDUE,PLNDT)
"RTN","PRCARPM",124,0)
 I 'SUCCESS W ! G BEGIN
"RTN","PRCARPM",125,0)
 D RPDEL^PRCARPU(.PLN,0)
"RTN","PRCARPM",126,0)
 D ADDPLAN^PRCARPU(.PLN,PRCAMT,PRCADAY,PRCAFPD,PRCADT,0)
"RTN","PRCARPM",127,0)
 D SCRNCHK^PRCARPU I QUIT G BEGIN
"RTN","PRCARPM",128,0)
 W !,"The Repayment Plan has been updated.",!
"RTN","PRCARPM",129,0)
 D SCRNCHK^PRCARPU I QUIT G BEGIN
"RTN","PRCARPM",130,0)
 D ACCOUNTS^PRCARPU(+DEBTOR,.ALL,.PLN,.NON,.ACT) ;Reload accounts after change is filed 
"RTN","PRCARPM",131,0)
 D RPDIS^PRCARPU(DEBTOR,.PLN)
"RTN","PRCARPM",132,0)
 D SCRNCHK^PRCARPU I QUIT G BEGIN
"RTN","PRCARPM",133,0)
 S T=$$DISPLAY^PRCARPU(.PLN,0,.QUIT) I QUIT G BEGIN
"RTN","PRCARPM",134,0)
 D SCRNCHK^PRCARPU I QUIT G BEGIN
"RTN","PRCARPM",135,0)
 D CMTENTR^PRCARPU(+DEBTOR)
"RTN","PRCARPM",136,0)
 D PAUSE^PRCARPU
"RTN","PRCARPM",137,0)
 G BEGIN
"RTN","PRCARPM",138,0)
 ;
"RTN","PRCARPM",139,0)
NOPLAN ;Debtor has no Repayment Plan
"RTN","PRCARPM",140,0)
 W !,"This Debtor does not have a Repayment Plan",!!,"List of Active Bills:",!!
"RTN","PRCARPM",141,0)
 S TOTAL=$$DISPLAY^PRCARPU(.NON,1,.QUIT) I QUIT G BEGIN
"RTN","PRCARPM",142,0)
 S LIST=$$SELECT^PRCARPU(.NON)
"RTN","PRCARPM",143,0)
 I LIST="" W !! G BEGIN
"RTN","PRCARPM",144,0)
 D SUMM^PRCARPU(.NON,LIST,.ADD)
"RTN","PRCARPM",145,0)
 S TOTDUE=$$DUEARR^PRCARPU(.ADD)
"RTN","PRCARPM",146,0)
 W !!,"Total amount chosen is $",$J(TOTDUE,8,2),!
"RTN","PRCARPM",147,0)
 S SURE=$$CORRECT^PRCARPU()
"RTN","PRCARPM",148,0)
 I 'SURE W !! G BEGIN
"RTN","PRCARPM",149,0)
 S SUCCESS=$$INQPLAN^PRCARPU(TOTDUE)
"RTN","PRCARPM",150,0)
 I 'SUCCESS W !! G BEGIN
"RTN","PRCARPM",151,0)
 D ADDPLAN^PRCARPU(.ADD,PRCAMT,PRCADAY,PRCAFPD,PRCADT,1)
"RTN","PRCARPM",152,0)
 W !,"The Repayment Plan has been established.",!
"RTN","PRCARPM",153,0)
 D SCRNCHK^PRCARPU I QUIT G BEGIN
"RTN","PRCARPM",154,0)
 D ACCOUNTS^PRCARPU(+DEBTOR,.ALL,.PLN,.NON,.ACT) ;Reload accounts after change is filed
"RTN","PRCARPM",155,0)
 D RPDIS^PRCARPU(DEBTOR,.PLN)
"RTN","PRCARPM",156,0)
 S T=$$DISPLAY^PRCARPU(.PLN,0,.QUIT) I QUIT G BEGIN
"RTN","PRCARPM",157,0)
 D SCRNCHK^PRCARPU I QUIT G BEGIN
"RTN","PRCARPM",158,0)
 D CMTENTR^PRCARPU(+DEBTOR)
"RTN","PRCARPM",159,0)
 D PAUSE^PRCARPU
"RTN","PRCARPM",160,0)
 G BEGIN
"RTN","PRCARPM",161,0)
 ;
"RTN","PRCARPM",162,0)
MLTDEL ;Delete all multiple plans
"RTN","PRCARPM",163,0)
 S DIR(0)="Y"
"RTN","PRCARPM",164,0)
 S DIR("A")="Delete ALL current Repayment Plans for this Debtor"
"RTN","PRCARPM",165,0)
 S DIR("?")="Enter Y to delete ALL current Repayment Plans"
"RTN","PRCARPM",166,0)
 D ^DIR I $D(DUOUT)!($D(DTOUT)) G BEGIN
"RTN","PRCARPM",167,0)
 I 'Y G BEGIN
"RTN","PRCARPM",168,0)
 D RPDEL^PRCARPU(.PLN,1)
"RTN","PRCARPM",169,0)
 W !,"All Repayment Plans have been deleted.",!
"RTN","PRCARPM",170,0)
 D PAUSE^PRCARPU
"RTN","PRCARPM",171,0)
 G BEGIN
"RTN","PRCARPM",172,0)
 ;
"RTN","PRCARPM",173,0)
VIEW ;View a Repayment Plan
"RTN","PRCARPM",174,0)
 D RPDIS^PRCARPU(DEBTOR,.PLN)
"RTN","PRCARPM",175,0)
 S T=$$DISPLAY^PRCARPU(.PLN,0,.QUIT) I QUIT G BEGIN
"RTN","PRCARPM",176,0)
 D SCRNCHK^PRCARPU I QUIT G BEGIN
"RTN","PRCARPM",177,0)
 D PAYDISP^PRCARPU(+DEBTOR,PLNDT,.QUIT) I QUIT G BEGIN
"RTN","PRCARPM",178,0)
 D SCRNCHK^PRCARPU I QUIT G BEGIN
"RTN","PRCARPM",179,0)
 W !,"Bills not in Repayment Plan:",!
"RTN","PRCARPM",180,0)
 S TOTAL=$$DISPLAY^PRCARPU(.NON,1,.QUIT) I QUIT G BEGIN
"RTN","PRCARPM",181,0)
 D PAUSE^PRCARPU
"RTN","PRCARPM",182,0)
 G BEGIN
"RTN","PRCARPU")
0^3^B254883295^B188846893
"RTN","PRCARPU",1,0)
PRCARPU  ;ALB/DRF-CREATE MULTIPLE ACCOUNT REPAYMENT DATE SCHEDULE FUNCTIONS;08/09/2016  4:40 PM
"RTN","PRCARPU",2,0)
 ;;4.5;Accounts Receivable;**315,340**;Mar 20, 1995;Build 9
"RTN","PRCARPU",3,0)
 ;;Per VA Directive 6402, this routine should not be modified.
"RTN","PRCARPU",4,0)
 ;
"RTN","PRCARPU",5,0)
 Q
"RTN","PRCARPU",6,0)
 ;
"RTN","PRCARPU",7,0)
DEBTOR() ;Look up debtor by name or bill #
"RTN","PRCARPU",8,0)
 N DIC,X,Y,DEBT,DEBTOR,DIC,PRCADB,DTOUT,DUOUT
"RTN","PRCARPU",9,0)
 W @IOF
"RTN","PRCARPU",10,0)
 W "Enter/Edit Repayment Plan",!!
"RTN","PRCARPU",11,0)
 R "Select DEBTOR NAME or BILL NUMBER: ",X:DTIME
"RTN","PRCARPU",12,0)
 I X["^"!(X="") Q ""
"RTN","PRCARPU",13,0)
 S X=$$UPPER^VALM1(X)
"RTN","PRCARPU",14,0)
 S Y=$S($O(^PRCA(430,"B",X,0)):$O(^(0)),$O(^PRCA(430,"D",X,0)):$O(^(0)),1:-1)
"RTN","PRCARPU",15,0)
 I Y>0 S DEBT=$P($G(^PRCA(430,Y,0)),"^",9) I DEBT D  Q DEBT  ;If found by bill number
"RTN","PRCARPU",16,0)
 . S PRCADB=$P($G(^RCD(340,DEBT,0)),"^")
"RTN","PRCARPU",17,0)
 . S ^DISV(DUZ,"^RCD(340,")=DEBT
"RTN","PRCARPU",18,0)
 . S $P(DEBT,"^",2)=$$NAM^RCFN01(DEBT)
"RTN","PRCARPU",19,0)
 S DIC="^RCD(340,",DIC(0)="EX" D ^DIC W ! I Y<0 Q 0
"RTN","PRCARPU",20,0)
 I $D(DTOUT)!($D(DUOUT)) Q 0
"RTN","PRCARPU",21,0)
 S ^DISV(DUZ,"^RCD(340,")=+Y,PRCADB=$P(Y,"^",2),DEBTOR=+Y_"^"_$P(@("^"_$P(PRCADB,";",2)_+PRCADB_",0)"),"^")
"RTN","PRCARPU",22,0)
 Q DEBTOR  ;If looked up by debtor name
"RTN","PRCARPU",23,0)
 ;
"RTN","PRCARPU",24,0)
ACCOUNTS(DEBTOR,ARRALL,ARRPLN,ARRNON,ACT) ;Find all active accounts for a debtor
"RTN","PRCARPU",25,0)
 ; DEBTOR  - Pointer to #340
"RTN","PRCARPU",26,0)
 ; ARRALL  - Name of array (passed by reference) that holds all the accounts for this debtor
"RTN","PRCARPU",27,0)
 ;   Ordered by date in the format ARRAY(1,xxxxxxx)="",ARRAY(2,xxxxxx)=""...
"RTN","PRCARPU",28,0)
 ; ARRPLN  - Name of array (passed by reference) that holds the accounts for this debtor
"RTN","PRCARPU",29,0)
 ;   that are part of a current payment plan
"RTN","PRCARPU",30,0)
 ;   Ordered by date in the format ARRAY(1,xxxxxxx)="",ARRAY(2,xxxxxx)=""...
"RTN","PRCARPU",31,0)
 ;   Check for ARRPLN>0 to see if there is an existing plan for this debtor
"RTN","PRCARPU",32,0)
 ; ARRNON  - Name of array (passed by reference) that holds the accounts for this debtor
"RTN","PRCARPU",33,0)
 ;   that are NOT part of a current payment plan
"RTN","PRCARPU",34,0)
 ;   Ordered by date in the format ARRAY(1,xxxxxxx)="",ARRAY(2,xxxxxx)=""...
"RTN","PRCARPU",35,0)
 ; ACT     - Variable that tracks the number of active accounts for the debtor. ARRALL displays
"RTN","PRCARPU",36,0)
 ;   Cross-Serviced accounts, but they are not active for the purposes of repayment plans
"RTN","PRCARPU",37,0)
 ;
"RTN","PRCARPU",38,0)
 ; Returns: ARRAY(COUNTER,PRCABN)=BILL#^PART OF A PAYMENT PLAN=1^IN CROSS SERVICING=1^BALANCE DUE^DOS^STATUS^CATEGORY^PLAN DATE
"RTN","PRCARPU",39,0)
 ;
"RTN","PRCARPU",40,0)
 N AMT,BILL,CS,D0,D4,D7,DOS,PLNDT,PP,PRCABN,PRCAT,PRCS15,STAT
"RTN","PRCARPU",41,0)
 K ARRALL,ARRPLN,ARRNON,ACT
"RTN","PRCARPU",42,0)
 S (ARRALL,ARRPLN,ARRNON,ACT)=0
"RTN","PRCARPU",43,0)
 S STAT=+$O(^PRCA(430.3,"AC",102,0))     ; get active status iens
"RTN","PRCARPU",44,0)
 S PRCABN=0 F  S PRCABN=$O(^PRCA(430,"AS",DEBTOR,STAT,PRCABN)) Q:'PRCABN  D
"RTN","PRCARPU",45,0)
 . S D0=$G(^PRCA(430,PRCABN,0))
"RTN","PRCARPU",46,0)
 . S D4=$G(^PRCA(430,PRCABN,4)),D7=$G(^PRCA(430,PRCABN,7))
"RTN","PRCARPU",47,0)
 . S AMT=$S(+D7:$P(D7,U,1)+$P(D7,U,2)+$P(D7,U,3)+$P(D7,U,4)+$P(D7,U,5),1:$P(D0,U,3)),DOS=$P(D0,U,10)
"RTN","PRCARPU",48,0)
 . S BILL=$P(D0,U,1),PRCAT=$P(D0,U,2),PLNDT=$P(D4,U,1)
"RTN","PRCARPU",49,0)
 . S PP=0 I PLNDT]"" S PP=1 ;Part of a payment plan?
"RTN","PRCARPU",50,0)
 . S CS=0 I $D(^PRCA(430,"TCSP",PRCABN)) S CS=1 ;Bill is in cross-servicing
"RTN","PRCARPU",51,0)
 . I 'CS S ACT=ACT+1
"RTN","PRCARPU",52,0)
 . I ARRALL]"" S ARRALL=ARRALL+1,ARRALL(ARRALL,PRCABN)=BILL_U_PP_U_CS_U_AMT_U_DOS_U_STAT_U_PRCAT_U_PLNDT
"RTN","PRCARPU",53,0)
 . I PP,ARRPLN]"" S ARRPLN=ARRPLN+1,ARRPLN(ARRPLN,PRCABN)=BILL_U_PP_U_CS_U_AMT_U_DOS_U_STAT_U_PRCAT_U_PLNDT Q
"RTN","PRCARPU",54,0)
 . I 'PP,ARRNON]"" S ARRNON=ARRNON+1,ARRNON(ARRNON,PRCABN)=BILL_U_PP_U_CS_U_AMT_U_DOS_U_STAT_U_PRCAT Q
"RTN","PRCARPU",55,0)
 Q
"RTN","PRCARPU",56,0)
 ;
"RTN","PRCARPU",57,0)
DISPLAY(ARR,NUM,QUIT) ;Display accounts in ARR
"RTN","PRCARPU",58,0)
 ; ARR - An array of bills
"RTN","PRCARPU",59,0)
 ; NUM - Display selection numbers in left column (defaults to no (0))
"RTN","PRCARPU",60,0)
 ; QUIT - User requests exit = 1, default = 0
"RTN","PRCARPU",61,0)
 ;
"RTN","PRCARPU",62,0)
 N AMT,BILL,CS,CSMSG,DOS,I,PLN,PLNMSG,PRCABN,PRCAT,PRCATN,STAT,STATN,TAMT,Y
"RTN","PRCARPU",63,0)
 S NUM=+$G(NUM)
"RTN","PRCARPU",64,0)
 S TAMT=0,PLNMSG=0,CSMSG=0,QUIT=0
"RTN","PRCARPU",65,0)
 F I=1:1:ARR D  Q:QUIT
"RTN","PRCARPU",66,0)
 . S PRCABN=$O(ARR(I,0)),BILL=$P(ARR(I,PRCABN),U,1),PLN=$P(ARR(I,PRCABN),U,2),CS=$P(ARR(I,PRCABN),U,3)
"RTN","PRCARPU",67,0)
 . S AMT=$P(ARR(I,PRCABN),U,4),DOS=$P(ARR(I,PRCABN),U,5),STAT=$P(ARR(I,PRCABN),U,6),PRCAT=$P(ARR(I,PRCABN),U,7)
"RTN","PRCARPU",68,0)
 . I $G(CS)=0 S TAMT=TAMT+AMT
"RTN","PRCARPU",69,0)
 . I PLN,'PLNMSG S PLNMSG=1
"RTN","PRCARPU",70,0)
 . I CS,'CSMSG S CSMSG=1
"RTN","PRCARPU",71,0)
 . S PRCATN=$P($G(^PRCA(430.2,PRCAT,0)),U,1),STATN=$P($G(^PRCA(430.3,STAT,0)),U,1)
"RTN","PRCARPU",72,0)
 . I $Y+3>IOSL S $Y=0 D PAUSE W ! I QUIT Q
"RTN","PRCARPU",73,0)
 . W $S(NUM:I,1:""),?5,BILL,$S(PLN:"**",CS:"#",1:""),?24,PRCATN,?50,$$MDY(DOS,"-"),?61,STATN,?70,"$",$J(AMT,8,2),!
"RTN","PRCARPU",74,0)
 I QUIT Q 0
"RTN","PRCARPU",75,0)
 W !
"RTN","PRCARPU",76,0)
 I PLNMSG W "** Bill is currently in Repayment Plan",!
"RTN","PRCARPU",77,0)
 I CSMSG W "# Bill is currently in Cross Servicing",!
"RTN","PRCARPU",78,0)
 Q TAMT
"RTN","PRCARPU",79,0)
 ;
"RTN","PRCARPU",80,0)
MDY(DATE,DEL) ;Return date format of mm-dd-yy
"RTN","PRCARPU",81,0)
 ; DATE - Date in FileMan format
"RTN","PRCARPU",82,0)
 ; DEL - Delimiter used to separate month, day, year
"RTN","PRCARPU",83,0)
 ;
"RTN","PRCARPU",84,0)
 ; Returns: Date in mmddyy format delimited by DEL
"RTN","PRCARPU",85,0)
 N %DT,X,Y
"RTN","PRCARPU",86,0)
 S X=$G(DATE),DEL=$S($G(DEL)="":"-",1:DEL),%DT="T"
"RTN","PRCARPU",87,0)
 D ^%DT S DATE=Y S:Y<0 DATE="0000000"
"RTN","PRCARPU",88,0)
 Q $E(DATE,4,5)_DEL_$E(DATE,6,7)_DEL_$E(DATE,2,3)
"RTN","PRCARPU",89,0)
 ;
"RTN","PRCARPU",90,0)
SELECT(ARR) ;Select items up to number ARR
"RTN","PRCARPU",91,0)
 ; ARR - The upper limit that can be chosen
"RTN","PRCARPU",92,0)
 ; This function will eliminate duplicates and return choices in numerical error
"RTN","PRCARPU",93,0)
 ; regardless of input order.
"RTN","PRCARPU",94,0)
 ; Returns: comma delimited list of pointers to file #430 in ascending date order
"RTN","PRCARPU",95,0)
 ;
"RTN","PRCARPU",96,0)
 N CNT,DIR,ERR,FIRST,I,J,LAST,LIST,OK,PC,PRCABN,STR,X,Y
"RTN","PRCARPU",97,0)
 S OK=0 F CNT=1:1 I 'OK D  Q:OK
"RTN","PRCARPU",98,0)
 . I CNT>1 W "   Select bills using the following formats:(A)ll or (N)one or 1,2,3 and/or 1-3",!
"RTN","PRCARPU",99,0)
 . S DIR(0)="FO^^"
"RTN","PRCARPU",100,0)
 . S DIR("A")="Choose Bills to Add to Repayment Plan: "
"RTN","PRCARPU",101,0)
 . S DIR("B")="ALL"
"RTN","PRCARPU",102,0)
 . S DIR("?")="Select bills using the following formats:(A)ll or (N)one or 1,2,3 and/or 1-3"
"RTN","PRCARPU",103,0)
 . D ^DIR
"RTN","PRCARPU",104,0)
 . I $D(DTOUT)!$D(DUOUT) S LIST="",OK=1 Q
"RTN","PRCARPU",105,0)
 . S X=$$UPPER^VALM1(X)
"RTN","PRCARPU",106,0)
 . I $E("NONE",1,$L(X))=X S LIST="",OK=1 Q
"RTN","PRCARPU",107,0)
 . K STR S ERR=""
"RTN","PRCARPU",108,0)
 . I $E("ALL",1,$L(X))=X D  Q:OK
"RTN","PRCARPU",109,0)
 .. F I=1:1:ARR S STR(I)=""
"RTN","PRCARPU",110,0)
 .. S OK=1
"RTN","PRCARPU",111,0)
 . F I=1:1:$L(X,",") S PC=$P(X,",",I) D  Q:ERR]""
"RTN","PRCARPU",112,0)
 .. I PC'?1.N,PC'?1.N1"-"1.N S ERR="Invalid response" Q
"RTN","PRCARPU",113,0)
 .. I PC'>0!(PC>ARR) S ERR="Number out of range" Q
"RTN","PRCARPU",114,0)
 .. I PC?1.N,PC>0,PC'>ARR S STR(PC)="" Q
"RTN","PRCARPU",115,0)
 .. I PC?1.N1"-"1.N D  Q:ERR]""
"RTN","PRCARPU",116,0)
 ... S FIRST=$P(PC,"-",1),LAST=$P(PC,"-",2)
"RTN","PRCARPU",117,0)
 ... I FIRST'>0!(FIRST>ARR)!(LAST'>0)!(LAST>ARR) S ERR="Number out of range" Q
"RTN","PRCARPU",118,0)
 ... I FIRST>0,FIRST'>ARR,LAST>0,LAST'>ARR F J=FIRST:1:LAST S STR(J)=""
"RTN","PRCARPU",119,0)
 . I ERR="" S OK=1 Q
"RTN","PRCARPU",120,0)
 . S OK=0 W "  "_ERR,!
"RTN","PRCARPU",121,0)
 S I=0,LIST="" F  S I=$O(STR(I)) Q:I=""  D
"RTN","PRCARPU",122,0)
 . S PRCABN=$O(ARR(I,0))
"RTN","PRCARPU",123,0)
 . I $P(ARR(I,PRCABN),U,3) W !,I_". "_$P(ARR(I,PRCABN),U,1)_" is in Cross Servicing" Q
"RTN","PRCARPU",124,0)
 . I $P(ARR(I,PRCABN),U,2) W !,I_". "_$P(ARR(I,PRCABN),U,1)_" is in a Payment Plan" Q
"RTN","PRCARPU",125,0)
 . S LIST=LIST_$S(LIST="":"",1:",")_I
"RTN","PRCARPU",126,0)
 Q LIST
"RTN","PRCARPU",127,0)
 ;
"RTN","PRCARPU",128,0)
RPDIS(DEBTOR,PLN) ;Display Repayment Plan
"RTN","PRCARPU",129,0)
 ; DEBTOR  - Pointer to #340
"RTN","PRCARPU",130,0)
 ; PLN - An array of bills
"RTN","PRCARPU",131,0)
 ;
"RTN","PRCARPU",132,0)
 D PLNDTL(.PLN)
"RTN","PRCARPU",133,0)
 W !,"Summary of Current Repayment Plan for AR Debtor: ",$P(DEBTOR,U,2),!
"RTN","PRCARPU",134,0)
 W "------------------------------------------------------------------",!
"RTN","PRCARPU",135,0)
 W "Monthly Repayment Amount:",?32,"$",$J(PLNAMT,0,2)
"RTN","PRCARPU",136,0)
 W ?45,"Day of Month Payment Due:",?72,PLNDAY,!
"RTN","PRCARPU",137,0)
 W "Number of Payments Remaining:",?32,PLNRMN
"RTN","PRCARPU",138,0)
 W ?45,"Due Date of First Payment:",?72,PLNFRST,!
"RTN","PRCARPU",139,0)
 W "Current Total Due:",?32,"$",$J(PLNTDUE,0,2)
"RTN","PRCARPU",140,0)
 W ?45,"Last Payment Due:",?72,PLNLST,!
"RTN","PRCARPU",141,0)
 W "Plan Date:",?32,$$MDY(PLNDT)
"RTN","PRCARPU",142,0)
 W ?45,"Next Payment Due:",?72,$S(PLNNXT="00/00/00":"DEFAULT",1:PLNNXT),!!
"RTN","PRCARPU",143,0)
 W "Bills in Repayment Plan:",!
"RTN","PRCARPU",144,0)
 Q
"RTN","PRCARPU",145,0)
 ;
"RTN","PRCARPU",146,0)
RPDEL(PLN,TRAN) ;Delete repayment plan
"RTN","PRCARPU",147,0)
 ; PLN - An array of bills
"RTN","PRCARPU",148,0)
 ;
"RTN","PRCARPU",149,0)
 N I,PRCABN,PRCAPB,X
"RTN","PRCARPU",150,0)
 I $G(TRAN)="" S TRAN=1 ; The default is to file a transaction
"RTN","PRCARPU",151,0)
 F I=1:1:PLN D
"RTN","PRCARPU",152,0)
 . S PRCABN=$O(PLN(I,0))
"RTN","PRCARPU",153,0)
 . S X=PLN(I,PRCABN)
"RTN","PRCARPU",154,0)
 . K ^PRCA(430,PRCABN,4),^PRCA(430,PRCABN,5)
"RTN","PRCARPU",155,0)
 . I TRAN D TRANDEL
"RTN","PRCARPU",156,0)
 Q
"RTN","PRCARPU",157,0)
 ;
"RTN","PRCARPU",158,0)
DBTCOM(DEBTOR,TEXT) ;Add DEBTOR comments
"RTN","PRCARPU",159,0)
 ; DEBTOR  - Pointer to #340
"RTN","PRCARPU",160,0)
 ; TEXT - Comment text
"RTN","PRCARPU",161,0)
 ;
"RTN","PRCARPU",162,0)
 N DIC,X,Y
"RTN","PRCARPU",163,0)
 I $G(TEXT)="" Q
"RTN","PRCARPU",164,0)
 S DIC="^RCD(340,"_DEBTOR_",2,",DIC(0)="L",X=TEXT
"RTN","PRCARPU",165,0)
 D FILE^DICN
"RTN","PRCARPU",166,0)
 Q
"RTN","PRCARPU",167,0)
 ;
"RTN","PRCARPU",168,0)
PLNDTL(ARR) ;Gather existing plan details
"RTN","PRCARPU",169,0)
 ; ARR - An array of bills
"RTN","PRCARPU",170,0)
 ;
"RTN","PRCARPU",171,0)
 N BILL,PLAN,DA,D0,D1,D4,D7,I,PRCABN,PYMT,TODAY,LSTDATE
"RTN","PRCARPU",172,0)
 S PLNRMN=0,PLNTDUE=0,PLNNXT=0,LSTDATE=0
"RTN","PRCARPU",173,0)
 D DT^DILF("","T",.TODAY)
"RTN","PRCARPU",174,0)
 F I=1:1:ARR D
"RTN","PRCARPU",175,0)
 . S PRCABN=$O(ARR(I,0)),X=ARR(I,PRCABN)
"RTN","PRCARPU",176,0)
 . S D4=$G(^PRCA(430,PRCABN,4))
"RTN","PRCARPU",177,0)
 . S BILL=$P(X,U,1)
"RTN","PRCARPU",178,0)
 . S PLNTDUE=PLNTDUE+$P(X,U,4)
"RTN","PRCARPU",179,0)
 . I I=1 S PLNDT=$P(D4,U,1),PLNDAY=$P(D4,U,2),PLNAMT=$P(D4,U,3)
"RTN","PRCARPU",180,0)
 . S PYMT=0 F  S PYMT=$O(^PRCA(430,PRCABN,5,PYMT)) Q:'PYMT  D
"RTN","PRCARPU",181,0)
 .. S D1=^PRCA(430,PRCABN,5,PYMT,0)
"RTN","PRCARPU",182,0)
 .. I I=1,PYMT=1 S PLNFRST=$P(D1,U,1)
"RTN","PRCARPU",183,0)
 .. I $P(D1,U,1)>TODAY,$P(D1,U,1)>LSTDATE S PLNRMN=PLNRMN+1,LSTDATE=$P(D1,U,1)
"RTN","PRCARPU",184,0)
 .. I 'PLNNXT,($P(D1,U,1)>TODAY) S PLNNXT=$P(D1,U,1)
"RTN","PRCARPU",185,0)
 .. S PLNLST=$P(D1,U,1)
"RTN","PRCARPU",186,0)
 S PLNFRST=$S($G(PLNFRST):$$MDY(PLNFRST,"/"),1:"N/A")    ; p340 - if no 5-node data on file
"RTN","PRCARPU",187,0)
 S PLNNXT=$$MDY(PLNNXT,"/")
"RTN","PRCARPU",188,0)
 S PLNLST=$S($G(PLNLST):$$MDY(PLNLST,"/"),1:"N/A")       ; p340 - if no 5-node data on file
"RTN","PRCARPU",189,0)
 Q
"RTN","PRCARPU",190,0)
 ;
"RTN","PRCARPU",191,0)
SUMM(ARR,LIST,ADD) ;List bills from ARR to plan, new or existing
"RTN","PRCARPU",192,0)
 ; ARR - An array of bills
"RTN","PRCARPU",193,0)
 ; LIST - A comma delimited list of bills to be added
"RTN","PRCARPU",194,0)
 ; ADD - An array of bills
"RTN","PRCARPU",195,0)
 ;
"RTN","PRCARPU",196,0)
 N I,J,PRCABN
"RTN","PRCARPU",197,0)
 F J=1:1 S I=$P(LIST,",",J) Q:I=""  D  S ADD=J
"RTN","PRCARPU",198,0)
 . S PRCABN=$O(ARR(I,""))
"RTN","PRCARPU",199,0)
 . S ADD(J,PRCABN)=ARR(I,PRCABN)
"RTN","PRCARPU",200,0)
 Q
"RTN","PRCARPU",201,0)
 ;
"RTN","PRCARPU",202,0)
CORRECT() ;Are you sure this is correct?
"RTN","PRCARPU",203,0)
 ; Return: 1 for Yes
"RTN","PRCARPU",204,0)
 ;         0 for No
"RTN","PRCARPU",205,0)
 ;
"RTN","PRCARPU",206,0)
 N DIR,X,Y
"RTN","PRCARPU",207,0)
 S DIR(0)="Y",DIR("B")="YES",DIR("A")="Are you sure this is correct"
"RTN","PRCARPU",208,0)
 D ^DIR
"RTN","PRCARPU",209,0)
 Q Y
"RTN","PRCARPU",210,0)
 ;
"RTN","PRCARPU",211,0)
INQPLAN(DUE,PLNDT) ;Prompt for plan details
"RTN","PRCARPU",212,0)
 ; DUE - Total amount due for the current plan
"RTN","PRCARPU",213,0)
 ; Returns: 1 if completed
"RTN","PRCARPU",214,0)
 ;
"RTN","PRCARPU",215,0)
 N DIR,OK,X,Y,NPAY
"RTN","PRCARPU",216,0)
 ;
"RTN","PRCARPU",217,0)
 ;Repayment amount
"RTN","PRCARPU",218,0)
 S DIR(0)="NA^.01:999999:2" ;PRCA*4.5*340/DRF Allow two decimals, prevent zeroes
"RTN","PRCARPU",219,0)
 S DIR("A")="Repayment Amount Due: "
"RTN","PRCARPU",220,0)
 S DIR("?")="This is the amount the debtor will pay each month"
"RTN","PRCARPU",221,0)
 S OK=0,QUIT=0 F  D  Q:OK!(QUIT)
"RTN","PRCARPU",222,0)
 . D ^DIR
"RTN","PRCARPU",223,0)
 . I $D(DIRUT) S OK=1 Q
"RTN","PRCARPU",224,0)
 . S PRCAMT=Y
"RTN","PRCARPU",225,0)
 . S NPAY=DUE\PRCAMT I DUE#PRCAMT>0 S NPAY=NPAY+1
"RTN","PRCARPU",226,0)
 . W !!,"Number of Payments will be ",NPAY,!
"RTN","PRCARPU",227,0)
 . I NPAY>60 D  Q
"RTN","PRCARPU",228,0)
 .. W "The number of payments cannot exceed 60. Please re-enter the payment amount.",!
"RTN","PRCARPU",229,0)
 . I NPAY>36 D  Q:QUIT
"RTN","PRCARPU",230,0)
 .. W "The number of payments exceeds 36 payments. Ensure you have Supervisor Approval",!
"RTN","PRCARPU",231,0)
 .. W "and enter Supervisor approval in the Expanded Comment.",!
"RTN","PRCARPU",232,0)
 .. D PAUSE
"RTN","PRCARPU",233,0)
 . S OK=1
"RTN","PRCARPU",234,0)
 I $D(DIRUT) Q 0
"RTN","PRCARPU",235,0)
 I QUIT Q 0
"RTN","PRCARPU",236,0)
 ;
"RTN","PRCARPU",237,0)
 ;Repayment plan date
"RTN","PRCARPU",238,0)
 S PLNDT=$G(PLNDT)
"RTN","PRCARPU",239,0)
 I PLNDT="" S %DT="AEFX",%DT("A")="Repayment Plan Date:  ",%DT("B")="T" D ^%DT K %DT I Y=-1!($D(DTOUT)) Q 0
"RTN","PRCARPU",240,0)
 S PRCADT=$S(PLNDT]"":PLNDT,1:Y) ;Plan Date
"RTN","PRCARPU",241,0)
 ;
"RTN","PRCARPU",242,0)
 ;Day of month
"RTN","PRCARPU",243,0)
 S DIR(0)="N"
"RTN","PRCARPU",244,0)
 S DIR("A")="Day of Month Payment Due"
"RTN","PRCARPU",245,0)
 S DIR("?")="Enter the day of the month (1-28) that the payment will be due."
"RTN","PRCARPU",246,0)
 S OK=0 F  D  Q:OK
"RTN","PRCARPU",247,0)
 . D ^DIR
"RTN","PRCARPU",248,0)
 . I $D(DIRUT) S OK=1 Q
"RTN","PRCARPU",249,0)
 . I Y>0,Y<29 S OK=1 Q
"RTN","PRCARPU",250,0)
 . W "  Enter the day of the month (1-28) that the payment will be due.",!
"RTN","PRCARPU",251,0)
 I $D(DIRUT) Q 0
"RTN","PRCARPU",252,0)
 S PRCADAY=Y
"RTN","PRCARPU",253,0)
 ;
"RTN","PRCARPU",254,0)
 ;Date of first payment
"RTN","PRCARPU",255,0)
 S %DT="AEFX",%DT(0)="NOW",%DT("A")="Due Date of First Payment:  " D ^%DT K %DT
"RTN","PRCARPU",256,0)
 I Y=-1!($D(DTOUT)) Q 0
"RTN","PRCARPU",257,0)
 S PRCAFPD=Y ;First payment date
"RTN","PRCARPU",258,0)
 Q 1
"RTN","PRCARPU",259,0)
 ;
"RTN","PRCARPU",260,0)
DUEARR(ARR) ;Total outstanding balance for array ARR returned in PLNTDUE
"RTN","PRCARPU",261,0)
 ; ARR - An array of bills
"RTN","PRCARPU",262,0)
 ;
"RTN","PRCARPU",263,0)
 ; Returns: Outstanding balance of Bills in ARR
"RTN","PRCARPU",264,0)
 N PLNTDUE,I,PRCABN
"RTN","PRCARPU",265,0)
 S PLNTDUE=0
"RTN","PRCARPU",266,0)
 F I=1:1:ARR S PRCABN=$O(ARR(I,0)),PLNTDUE=PLNTDUE+$P(ARR(I,PRCABN),U,4)
"RTN","PRCARPU",267,0)
 Q PLNTDUE
"RTN","PRCARPU",268,0)
 ;
"RTN","PRCARPU",269,0)
ADDPLAN(ADD,PRCAMT,PRCADAY,PRCAFPD,PRCADT,TRAN) ;Record plan on bills
"RTN","PRCARPU",270,0)
 ; ADD - An array of bills to add to the repayment plan
"RTN","PRCARPU",271,0)
 ; PRCAMT - Monthly amount the debtor will pay
"RTN","PRCARPU",272,0)
 ; PRCADAY - Day of the month payment will be made
"RTN","PRCARPU",273,0)
 ; PRCAFPD - Date of first payment
"RTN","PRCARPU",274,0)
 ; PRCADT - Date plan is established
"RTN","PRCARPU",275,0)
 ; TRAN - Flag to file a transaction for new plan
"RTN","PRCARPU",276,0)
 ;
"RTN","PRCARPU",277,0)
 N BILL,FP,PAYDATE,PRCAPB,PRCABN,X,XX,PRCANPAY,PRCAFP,PRCAREM,PRCA,PAY
"RTN","PRCARPU",278,0)
 I $G(TRAN)="" S TRAN=1 ; the default action is to file a transaction
"RTN","PRCARPU",279,0)
 S FP=PRCAMT,PAYDATE=PRCAFPD
"RTN","PRCARPU",280,0)
 F BILL=1:1:ADD D
"RTN","PRCARPU",281,0)
 . S PRCABN=$O(ADD(BILL,0))
"RTN","PRCARPU",282,0)
 . S X=ADD(BILL,PRCABN)
"RTN","PRCARPU",283,0)
 . S PRCAPB=$P(X,U,4)
"RTN","PRCARPU",284,0)
 . K ^PRCA(430,PRCABN,5)
"RTN","PRCARPU",285,0)
 . S XX=$$PAYMENTS(PRCAPB,FP,PRCAMT),PRCANPAY=$P(XX,U,1),PRCAFP=$P(XX,U,2),PRCAREM=$P(XX,U,3)
"RTN","PRCARPU",286,0)
 . F PAY=1:1:PRCANPAY D
"RTN","PRCARPU",287,0)
 .. S PAYDATE=$S(BILL=1&(PAY=1):PRCAFPD,PAY=1&(FP<PRCAMT):PAYDATE,1:$$INCDATE(PAYDATE,PRCADAY)) ;If remainder from previous bill, file on same date
"RTN","PRCARPU",288,0)
 .. S ^PRCA(430,PRCABN,5,PAY,0)=PAYDATE_U_"0"
"RTN","PRCARPU",289,0)
 . S ^PRCA(430,PRCABN,5,0)="^430.051DA^"_PRCANPAY_"^"_PRCANPAY
"RTN","PRCARPU",290,0)
 . S (DIC,DIE)="^PRCA(430,",DA=PRCABN,DR="41///"_PRCADT_";42///"_PRCADAY_";43///"_PRCAMT_";44///"_PRCANPAY
"RTN","PRCARPU",291,0)
 . S PRCA("LOCK")=0 D LOCKF^PRCAWO1 D:PRCA("LOCK")=0 ^DIE
"RTN","PRCARPU",292,0)
 . K DA,DIC,DIE,DR
"RTN","PRCARPU",293,0)
 . I TRAN D TRAN
"RTN","PRCARPU",294,0)
 . D IXDIK
"RTN","PRCARPU",295,0)
 . L -^PRCA(430,+$G(PRCABN))
"RTN","PRCARPU",296,0)
 . S FP=$S(PRCAREM:PRCAREM,1:PRCAMT)
"RTN","PRCARPU",297,0)
 Q
"RTN","PRCARPU",298,0)
 ;
"RTN","PRCARPU",299,0)
ADDTRAN(ADD)    ;Add transaction to bills being added to an exist repayment plan
"RTN","PRCARPU",300,0)
 N BILL,PRCABN,PRCAPB,X
"RTN","PRCARPU",301,0)
 F BILL=1:1:ADD D
"RTN","PRCARPU",302,0)
 . S PRCABN=$O(ADD(BILL,0))
"RTN","PRCARPU",303,0)
 . S X=ADD(BILL,PRCABN)
"RTN","PRCARPU",304,0)
 . S PRCAPB=$P(X,U,4)
"RTN","PRCARPU",305,0)
 . D TRAN
"RTN","PRCARPU",306,0)
 Q
"RTN","PRCARPU",307,0)
 ;
"RTN","PRCARPU",308,0)
IXDIK    ;Reindex 5 node in 430
"RTN","PRCARPU",309,0)
 N DA,DIK
"RTN","PRCARPU",310,0)
 S DIK="^PRCA(430,"_PRCABN_",5,",DA(1)=PRCABN
"RTN","PRCARPU",311,0)
 D IXALL^DIK
"RTN","PRCARPU",312,0)
 Q
"RTN","PRCARPU",313,0)
 ;
"RTN","PRCARPU",314,0)
TRAN     ;File plan add transaction in 433
"RTN","PRCARPU",315,0)
 N DIE,DA,DR,PRCAEN,PRCAKTY
"RTN","PRCARPU",316,0)
 S PRCAKTY=$O(^PRCA(430.3,"AC",16,""))
"RTN","PRCARPU",317,0)
 S PRCAEN=-1 D SETTR^PRCAUTL Q:PRCAEN<0  S DA=PRCAEN
"RTN","PRCARPU",318,0)
 S DIE="^PRCA(433,",DR=".03////"_PRCABN_";11///"_DT_";12///"_PRCAKTY_";15///"_PRCAPB_"" D ^DIE
"RTN","PRCARPU",319,0)
 S $P(^PRCA(433,PRCAEN,0),U,4)=2
"RTN","PRCARPU",320,0)
 Q
"RTN","PRCARPU",321,0)
 ;
"RTN","PRCARPU",322,0)
TRANDEL  ;File plan delete transaction in 433
"RTN","PRCARPU",323,0)
 N DIE,DA,DR,PRCAEN,PRCAKTY
"RTN","PRCARPU",324,0)
 S PRCAKTY=$O(^PRCA(430.3,"AC",31,""))
"RTN","PRCARPU",325,0)
 S PRCAEN=-1 D SETTR^PRCAUTL Q:PRCAEN<0  S DA=PRCAEN
"RTN","PRCARPU",326,0)
 S DIE="^PRCA(433,",DR=".03////"_PRCABN_";11///"_DT_";12///"_PRCAKTY_";15///"_0_"" D ^DIE
"RTN","PRCARPU",327,0)
 S $P(^PRCA(433,PRCAEN,0),U,4)=2
"RTN","PRCARPU",328,0)
 Q
"RTN","PRCARPU",329,0)
 ;
"RTN","PRCARPU",330,0)
PAYMENTS(AMT,FP,PAY) ;How many payments?
"RTN","PRCARPU",331,0)
 ; AMT - TOTAL DUE ON BILL
"RTN","PRCARPU",332,0)
 ; FP - FIRST PAYMENT AMOUNT
"RTN","PRCARPU",333,0)
 ; PAY - AMOUNT DEBTOR AGREES TO MONTHLY
"RTN","PRCARPU",334,0)
 ;
"RTN","PRCARPU",335,0)
 ; Returns:
"RTN","PRCARPU",336,0)
 ;  NP - Number of payments for this bill
"RTN","PRCARPU",337,0)
 ;  FP - First payment
"RTN","PRCARPU",338,0)
 ;  REM - Remainder of payment to be applied
"RTN","PRCARPU",339,0)
 ;
"RTN","PRCARPU",340,0)
 N NP,RAMT,REM
"RTN","PRCARPU",341,0)
 I FP'<AMT S NP=1,REM=FP-AMT,FP=AMT Q NP_U_FP_U_REM ;The first payment pays the bill
"RTN","PRCARPU",342,0)
 I AMT>FP S RAMT=AMT-FP ;The first payment does not pay the bill. RAMT=remaining balance after first payment
"RTN","PRCARPU",343,0)
 S NP=(RAMT\PAY)+1 ;The number of payments for RAMT plus the first payment
"RTN","PRCARPU",344,0)
 S REM=$S(RAMT#PAY=0:0,PAY>RAMT:PAY-RAMT,1:PAY-(RAMT#PAY)) ;How much of the payment is left?
"RTN","PRCARPU",345,0)
 I REM S NP=NP+1 ;If remainder add last payment
"RTN","PRCARPU",346,0)
 Q NP_U_FP_U_REM
"RTN","PRCARPU",347,0)
 ;
"RTN","PRCARPU",348,0)
INCDATE(DATE,PRCADAY) ;Increment payment date
"RTN","PRCARPU",349,0)
 ; DATE - Today's date in FileMan format
"RTN","PRCARPU",350,0)
 ; PRCADAY - Day of the month payment is due
"RTN","PRCARPU",351,0)
 ;
"RTN","PRCARPU",352,0)
 ; Returns: Next payment date
"RTN","PRCARPU",353,0)
 ;
"RTN","PRCARPU",354,0)
 N PRCAYR,PRCAMON
"RTN","PRCARPU",355,0)
 S PRCAYR=$E(DATE,1,3),PRCAMON=$E(DATE,4,5)
"RTN","PRCARPU",356,0)
 I $L(PRCADAY)=1 S PRCADAY="0"_PRCADAY
"RTN","PRCARPU",357,0)
 S PRCAMON=PRCAMON+1
"RTN","PRCARPU",358,0)
 I PRCAMON=13 S PRCAMON=1,PRCAYR=PRCAYR+1
"RTN","PRCARPU",359,0)
 Q PRCAYR_$S((PRCAMON<10&($E(PRCAMON,1)'=0)):0_PRCAMON,1:PRCAMON)_PRCADAY
"RTN","PRCARPU",360,0)
 ;
"RTN","PRCARPU",361,0)
PAYDISP(DEBTOR,PLNDT,QUIT) ;Display all payments for Debtor since Repayment Plan effective date
"RTN","PRCARPU",362,0)
 ; DEBTOR  - Pointer to #340
"RTN","PRCARPU",363,0)
 ; PLNDT - Effective date of repayment plan
"RTN","PRCARPU",364,0)
 ; QUIT - User requests exit = 1, default = 0 
"RTN","PRCARPU",365,0)
 ;
"RTN","PRCARPU",366,0)
 N DEBTYP
"RTN","PRCARPU",367,0)
 W "Payments Since Plan Date",!
"RTN","PRCARPU",368,0)
 I $G(DEBTOR)="" W "None",! Q
"RTN","PRCARPU",369,0)
 S DEBTYP=$P($P($G(^RCD(340,DEBTOR,0)),U),";",2) I DEBTYP="" W "None",! Q
"RTN","PRCARPU",370,0)
 I $G(PLNDT)="" W "None",! Q
"RTN","PRCARPU",371,0)
 I DEBTYP="DPT(" D PAYDISPP Q
"RTN","PRCARPU",372,0)
 D PAYDISPO Q
"RTN","PRCARPU",373,0)
 Q
"RTN","PRCARPU",374,0)
 ;
"RTN","PRCARPU",375,0)
PAYDISPP ;Display all payments for a patient debtor
"RTN","PRCARPU",376,0)
 N PAY,DAT,TN,TXD0,TXD1
"RTN","PRCARPU",377,0)
 S PAY=0,QUIT=0
"RTN","PRCARPU",378,0)
 I '$D(^PRCA(433,"ATD",DEBTOR)) W "None",!! Q
"RTN","PRCARPU",379,0)
 S DAT=PLNDT F  S DAT=$O(^PRCA(433,"ATD",DEBTOR,DAT)) Q:'DAT!(QUIT)  D
"RTN","PRCARPU",380,0)
 . S TN="" F  S TN=$O(^PRCA(433,"ATD",DEBTOR,DAT,TN)) Q:'TN!(QUIT)  D
"RTN","PRCARPU",381,0)
 .. S TXD0=$G(^PRCA(433,TN,0)),TXD1=$G(^PRCA(433,TN,1))
"RTN","PRCARPU",382,0)
 .. I '$F(".2.34.41.","."_$P(TXD1,U,2)_".") Q    ; Transaction type must be a payment or refunded
"RTN","PRCARPU",383,0)
 .. I $P(TXD0,U,4)'=2 Q  ; Transaction status must be complete (2)
"RTN","PRCARPU",384,0)
 .. W $$MDY($P(DAT,".",1),"/"),"  ",$$GET1^DIQ(433,TN,.03),"  ",$J($P(TXD1,U,5),10,2),!
"RTN","PRCARPU",385,0)
 .. I $Y+3>IOSL S $Y=0 D PAUSE W ! I QUIT Q
"RTN","PRCARPU",386,0)
 .. S PAY=PAY+1
"RTN","PRCARPU",387,0)
 I 'PAY W "None",!
"RTN","PRCARPU",388,0)
 Q
"RTN","PRCARPU",389,0)
 ;
"RTN","PRCARPU",390,0)
PAYDISPO ;Display all payments for a vendor, employee, ex-employee or other debtor
"RTN","PRCARPU",391,0)
 N PAY,TN,PRCBN,TXD0,TXD1,BDT,LN,DAT
"RTN","PRCARPU",392,0)
 S PAY=0,QUIT=0
"RTN","PRCARPU",393,0)
 S PRCBN=0 F  S PRCBN=$O(^PRCA(430,"C",DEBTOR,PRCBN)) Q:'PRCBN  D
"RTN","PRCARPU",394,0)
 . S TN=0 F  S TN=$O(^PRCA(433,"C",PRCBN,TN)) Q:'TN  D
"RTN","PRCARPU",395,0)
 .. S TXD0=$G(^PRCA(433,TN,0)),TXD1=$G(^PRCA(433,TN,1))
"RTN","PRCARPU",396,0)
 .. I $P(TXD1,U,9)<PLNDT Q       ; Date entered is before repayment plan effective date so skip this one
"RTN","PRCARPU",397,0)
 .. I '$F(".2.34.41.","."_$P(TXD1,U,2)_".") Q    ; Transaction type must be a payment or refunded
"RTN","PRCARPU",398,0)
 .. I $P(TXD0,U,4)'=2 Q  ; Transaction status must be complete (2)
"RTN","PRCARPU",399,0)
 .. S BDT=$$MDY($P(TXD1,U,9)\1,"/")
"RTN","PRCARPU",400,0)
 .. S PAY=PAY+1,PAY($P(TXD1,U,9),TN)=BDT_U_$$GET1^DIQ(433,TN,.03)_U_$J($P(TXD1,U,5),10,2)
"RTN","PRCARPU",401,0)
 I PAY D  Q:QUIT
"RTN","PRCARPU",402,0)
 . S DAT=0 F  S DAT=$O(PAY(DAT)) Q:'DAT  D  Q:QUIT
"RTN","PRCARPU",403,0)
 .. S TN=0 F  S TN=$O(PAY(DAT,TN)) Q:'TN  D  Q:QUIT
"RTN","PRCARPU",404,0)
 ... S LN=PAY(DAT,TN)
"RTN","PRCARPU",405,0)
 ... W $P(LN,U,1),"  ",$P(LN,U,2),"  ",$P(LN,U,3),!
"RTN","PRCARPU",406,0)
 ... I $Y+3>IOSL S $Y=0 D PAUSE W ! I QUIT Q
"RTN","PRCARPU",407,0)
 I 'PAY W "None",!
"RTN","PRCARPU",408,0)
 Q
"RTN","PRCARPU",409,0)
 ;
"RTN","PRCARPU",410,0)
MERGE(PLN,ADD) ;Add ADD to PLN
"RTN","PRCARPU",411,0)
 ; PLN - An array of bills
"RTN","PRCARPU",412,0)
 ; ADD - An array of bills
"RTN","PRCARPU",413,0)
 ;
"RTN","PRCARPU",414,0)
 N TMP,OLD,X,CNT,I,PRCABN
"RTN","PRCARPU",415,0)
 M OLD=PLN K PLN
"RTN","PRCARPU",416,0)
 F CNT=1:1:OLD D
"RTN","PRCARPU",417,0)
 . S PRCABN=$O(OLD(CNT,0))
"RTN","PRCARPU",418,0)
 . S X=OLD(CNT,PRCABN),TMP(PRCABN)=X
"RTN","PRCARPU",419,0)
 F CNT=1:1:ADD D
"RTN","PRCARPU",420,0)
 . S PRCABN=$O(ADD(CNT,0))
"RTN","PRCARPU",421,0)
 . S X=ADD(CNT,PRCABN),TMP(PRCABN)=X
"RTN","PRCARPU",422,0)
 S PRCABN=0 F I=1:1 S PRCABN=$O(TMP(PRCABN)) Q:'PRCABN  D
"RTN","PRCARPU",423,0)
 . S PLN(I,PRCABN)=TMP(PRCABN),PLN=I
"RTN","PRCARPU",424,0)
 Q
"RTN","PRCARPU",425,0)
 ;
"RTN","PRCARPU",426,0)
MULTI(PLN) ;Multiple Repayment Plans?
"RTN","PRCARPU",427,0)
 ; PLN - An array of bills
"RTN","PRCARPU",428,0)
 ;
"RTN","PRCARPU",429,0)
 ; Returns: 1 if multiple Repayment Plans, 0 if single plan
"RTN","PRCARPU",430,0)
 N I,FIRDT,MULT,PRCABN,X
"RTN","PRCARPU",431,0)
 S FIRDT=0,MULT=0
"RTN","PRCARPU",432,0)
 F I=1:1:PLN D  Q:MULT
"RTN","PRCARPU",433,0)
 . S PRCABN=$O(PLN(I,0))
"RTN","PRCARPU",434,0)
 . S X=PLN(I,PRCABN),PLNDT=$P(X,U,8)
"RTN","PRCARPU",435,0)
 . I 'FIRDT S FIRDT=PLNDT
"RTN","PRCARPU",436,0)
 . I PLNDT'=FIRDT S MULT=1
"RTN","PRCARPU",437,0)
 Q MULT
"RTN","PRCARPU",438,0)
 ;
"RTN","PRCARPU",439,0)
PAUSE    ;Press Return to Continue
"RTN","PRCARPU",440,0)
 N DIR,DUOUT,DTOUT,DIRUT
"RTN","PRCARPU",441,0)
 S DIR(0)="E" D ^DIR
"RTN","PRCARPU",442,0)
 I $D(DIRUT) S QUIT=1
"RTN","PRCARPU",443,0)
 Q
"RTN","PRCARPU",444,0)
 ;
"RTN","PRCARPU",445,0)
CMTMULT(DEBTOR) ;Enter multiple line comment
"RTN","PRCARPU",446,0)
 ; DEBTOR  - Pointer to #340
"RTN","PRCARPU",447,0)
 ;
"RTN","PRCARPU",448,0)
 N TYPE
"RTN","PRCARPU",449,0)
 S TYPE=1
"RTN","PRCARPU",450,0)
 D ADJ(DEBTOR,TYPE)
"RTN","PRCARPU",451,0)
 Q
"RTN","PRCARPU",452,0)
 ;
"RTN","PRCARPU",453,0)
CMTENTR(DEBTOR) ;Enter comments question
"RTN","PRCARPU",454,0)
 ; DEBTOR  - Pointer to #340
"RTN","PRCARPU",455,0)
 ;
"RTN","PRCARPU",456,0)
 N DIR,ANS
"RTN","PRCARPU",457,0)
 S DIR(0)="Y",DIR("B")="YES",DIR("A")="Do you wish to enter Debtor comments"
"RTN","PRCARPU",458,0)
 D ^DIR
"RTN","PRCARPU",459,0)
 S ANS=$S($E(X)="Y":1,$E(X)="y":1,$E(X)="N":0,1:0)
"RTN","PRCARPU",460,0)
 I ANS W !! D CMTMULT(DEBTOR)
"RTN","PRCARPU",461,0)
 Q
"RTN","PRCARPU",462,0)
 ;
"RTN","PRCARPU",463,0)
ADJ(DEBT,TYPE) ;Adjust an account for DEBT (340 entry)
"RTN","PRCARPU",464,0)
 N DA,DIC,DIE,DR,ERR,EVN,SITE,X,Y
"RTN","PRCARPU",465,0)
 S SITE=$$SITE^RCMSITE() G:SITE'>0 Q2
"RTN","PRCARPU",466,0)
 S DEBT=$P($G(^RCD(340,+$G(DEBT),0)),"^") G:'DEBT Q2
"RTN","PRCARPU",467,0)
 D OPEN^RCEVDRV1(TYPE,DEBT,DT,DUZ,SITE,.ERR,.EVN)
"RTN","PRCARPU",468,0)
 I ERR]""!(EVN<0) W !,"Error (",ERR,") trying to open a new event",! G Q2
"RTN","PRCARPU",469,0)
 W !,"Reference number assigned: ",$P(^RC(341,EVN,0),"^"),!
"RTN","PRCARPU",470,0)
EDT S DR=$P($G(^RC(341.1,$O(^RC(341.1,"AC",TYPE,0)),1)),"^"),DIE="^RC(341,",DA=EVN D:DR]"" ^DIE
"RTN","PRCARPU",471,0)
 S X=$$OK(EVN) G:X=0 EDT I X<0!(X["^") D DEL^RCEVDRV1(EVN) W " ... Deleted",! G Q2
"RTN","PRCARPU",472,0)
 D CLOSE^RCEVDRV1(EVN,.ERR)
"RTN","PRCARPU",473,0)
 I ERR]"" W !,"Error ("_ERR_")",!,"...  trying to close this event"
"RTN","PRCARPU",474,0)
Q2 Q
"RTN","PRCARPU",475,0)
 ;
"RTN","PRCARPU",476,0)
OK(EVN)  ;OK an event or delete it
"RTN","PRCARPU",477,0)
 NEW L,FLDS,BY,TO,DIC,IOP,DIR,DIRUT,DIROUT,DUOUT,Y
"RTN","PRCARPU",478,0)
 W ! S DIR(0)="YA",DIR("B")="YES",DIR("A")="Is this OK? " D ^DIR K DIR
"RTN","PRCARPU",479,0)
 S:$D(DTOUT) Y=-1
"RTN","PRCARPU",480,0)
 Q Y
"RTN","PRCARPU",481,0)
 ;
"RTN","PRCARPU",482,0)
DSMPLNS(DEBTOR,PLN) ;Display multiple plans
"RTN","PRCARPU",483,0)
 ; DEBTOR  - Pointer to #340
"RTN","PRCARPU",484,0)
 ; PLN - An array of bills
"RTN","PRCARPU",485,0)
 ;
"RTN","PRCARPU",486,0)
 N CNT,J,OLDPLN,PLANDAT,PRCABN,TMP,X
"RTN","PRCARPU",487,0)
 F CNT=1:1:PLN D
"RTN","PRCARPU",488,0)
 . S PRCABN=$O(PLN(CNT,0))
"RTN","PRCARPU",489,0)
 . S X=PLN(CNT,PRCABN),PLANDAT=$P(X,U,8)
"RTN","PRCARPU",490,0)
 . S TMP(PLANDAT,CNT,PRCABN)=X
"RTN","PRCARPU",491,0)
 S PLANDAT="" F  S PLANDAT=$O(TMP(PLANDAT)) Q:PLANDAT=""  D  Q:QUIT
"RTN","PRCARPU",492,0)
 . K OLDPLN
"RTN","PRCARPU",493,0)
 . S J=0
"RTN","PRCARPU",494,0)
 . S CNT=0 F  S CNT=$O(TMP(PLANDAT,CNT)) Q:CNT=""  D
"RTN","PRCARPU",495,0)
 .. S PRCABN="" F  S PRCABN=$O(TMP(PLANDAT,CNT,PRCABN)) Q:PRCABN=""  D
"RTN","PRCARPU",496,0)
 ... S J=J+1
"RTN","PRCARPU",497,0)
 ... S X=TMP(PLANDAT,CNT,PRCABN),OLDPLN(J,PRCABN)=X
"RTN","PRCARPU",498,0)
 . S OLDPLN=J
"RTN","PRCARPU",499,0)
 . D RPDIS(DEBTOR,.OLDPLN)
"RTN","PRCARPU",500,0)
 . S T=$$DISPLAY(.OLDPLN,0,.QUIT) I QUIT Q
"RTN","PRCARPU",501,0)
 . D PAUSE I QUIT Q
"RTN","PRCARPU",502,0)
 Q
"RTN","PRCARPU",503,0)
 ;
"RTN","PRCARPU",504,0)
SCRNCHK ;Check to see if we need to pause the screen
"RTN","PRCARPU",505,0)
 I $Y+3>IOSL S $Y=0 D PAUSE W !
"RTN","PRCARPU",506,0)
 Q
"RTN","RCRJRBD")
0^8^B76750896^B76289018
"RTN","RCRJRBD",1,0)
RCRJRBD ;WISC/RFJ,TJK-bad debt extractor and report ;10/18/10 9:00am
"RTN","RCRJRBD",2,0)
 ;;4.5;Accounts Receivable;**101,139,170,193,203,215,220,138,239,273,282,310,315,340**;Mar 20, 1995;Build 9
"RTN","RCRJRBD",3,0)
 ;;Per VA Directive 6402, this routine should not be modified.
"RTN","RCRJRBD",4,0)
 ; IA 4385 for calls to $$MRATYPE^IBCEMU2 and $$MRADTACT^IBCEMU2
"RTN","RCRJRBD",5,0)
 Q
"RTN","RCRJRBD",6,0)
 ;
"RTN","RCRJRBD",7,0)
 ;
"RTN","RCRJRBD",8,0)
START(DATEEND) ;  run bad debt report
"RTN","RCRJRBD",9,0)
 ;  the DATEEND is the last day of the month being run
"RTN","RCRJRBD",10,0)
 ;  from the routine RCRJRCOL which is the data extractor.  The
"RTN","RCRJRBD",11,0)
 ;  current receivable dollars is stored in ^TMP($J,"RCRJRBD",SGL)
"RTN","RCRJRBD",12,0)
 ;  where SGL is the standard general ledger 1319, 1338, or 1339.
"RTN","RCRJRBD",13,0)
 ;
"RTN","RCRJRBD",14,0)
 N ACTDATE,ACTUALCA,ACTUALWO,BEGDATE,BILLDA,CATEGORY
"RTN","RCRJRBD",15,0)
 N COLLECT,CONTRACT,DR,ENDDATE,FUND,PAY,PAYMENT,PRIN,PRINCPAL
"RTN","RCRJRBD",16,0)
 N RCRJFMM,RCRJDATE,SGL,TRANDA,TRANDATE,TRANTYPE,VALUE,WRITEOFF
"RTN","RCRJRBD",17,0)
 N RCPRIN,RCTOMCCF,RCVALUE,RSC,MRATYPE,ARACTDT
"RTN","RCRJRBD",18,0)
 ;
"RTN","RCRJRBD",19,0)
 ;  lock the bad debt file for storing data, lock cannot fail
"RTN","RCRJRBD",20,0)
 ;  this lock can be used to monitor if the report is running
"RTN","RCRJRBD",21,0)
 F  L +^RC(348.1):$S($G(DILOCKTM)>5:DILOCKTM,1:5) Q:$T
"RTN","RCRJRBD",22,0)
 ;
"RTN","RCRJRBD",23,0)
 ;  calculate the base percentages from past data
"RTN","RCRJRBD",24,0)
 ;  example:  DATEEND=2980331  => BEGDATE=2970300
"RTN","RCRJRBD",25,0)
 ;                             => ENDDATE=2980229
"RTN","RCRJRBD",26,0)
 ;   add one day to ending date to go to next month
"RTN","RCRJRBD",27,0)
 S BEGDATE=($E(DATEEND,1,3)-1)_$E(DATEEND,4,5)_"00"
"RTN","RCRJRBD",28,0)
 S ENDDATE=($$FMADD^XLFDT($E(DATEEND,1,5)_"00",-1))+1
"RTN","RCRJRBD",29,0)
 ;  loop bills activated between these dates
"RTN","RCRJRBD",30,0)
 S ACTDATE=BEGDATE
"RTN","RCRJRBD",31,0)
 F  S ACTDATE=$O(^PRCA(430,"ACTDT",ACTDATE)) Q:'ACTDATE!(ACTDATE>ENDDATE)  D
"RTN","RCRJRBD",32,0)
 . S BILLDA=0 F  S BILLDA=$O(^PRCA(430,"ACTDT",ACTDATE,BILLDA)) Q:'BILLDA  D
"RTN","RCRJRBD",33,0)
 . . S CATEGORY=+$P($G(^PRCA(430,BILLDA,0)),"^",2)
"RTN","RCRJRBD",34,0)
 . . ;  do not look at prepayments
"RTN","RCRJRBD",35,0)
 . . I 'CATEGORY!(CATEGORY=26) Q
"RTN","RCRJRBD",36,0)
 . . ;
"RTN","RCRJRBD",37,0)
 . . ;  only look at bills with a 0 principal balance
"RTN","RCRJRBD",38,0)
 . . I $P($G(^PRCA(430,BILLDA,7)),"^") Q
"RTN","RCRJRBD",39,0)
 . . ;
"RTN","RCRJRBD",40,0)
 . . ;  only report fund 528701,03,04,11 and 4032/528709 bills
"RTN","RCRJRBD",41,0)
 . . S FUND=$$GETFUNDB^RCXFMSUF(BILLDA,1)
"RTN","RCRJRBD",42,0)
 . . I '$$PTACCT^PRCAACC(FUND),$E(FUND,1,4)'=4032 Q
"RTN","RCRJRBD",43,0)
 . . ;
"RTN","RCRJRBD",44,0)
 . . ;  determine MRA type of bill, given bill# and bill active date
"RTN","RCRJRBD",45,0)
 . . ;  DBIA #4385 activated on 31-Mar-2004
"RTN","RCRJRBD",46,0)
 . . S MRATYPE=$$MRATYPE^IBCEMU2(BILLDA,ACTDATE)
"RTN","RCRJRBD",47,0)
 . . ;
"RTN","RCRJRBD",48,0)
 . . ;  derive standard general ledger (SGL) from cat/fund/MRA type
"RTN","RCRJRBD",49,0)
 . . S SGL=$$BDRSGL(CATEGORY,FUND,MRATYPE)
"RTN","RCRJRBD",50,0)
 . . ;
"RTN","RCRJRBD",51,0)
 . . ;  determine the original amount of the bill (add increase
"RTN","RCRJRBD",52,0)
 . . ;  adjustments below)
"RTN","RCRJRBD",53,0)
 . . S PRIN=$P($G(^PRCA(430,BILLDA,0)),"^",3)
"RTN","RCRJRBD",54,0)
 . . S PAY=0
"RTN","RCRJRBD",55,0)
 . . ;
"RTN","RCRJRBD",56,0)
 . . ;  get the $ transations for bills
"RTN","RCRJRBD",57,0)
 . . S TRANDA=0
"RTN","RCRJRBD",58,0)
 . . F  S TRANDA=$O(^PRCA(433,"C",BILLDA,TRANDA)) Q:'TRANDA  D
"RTN","RCRJRBD",59,0)
 . . . S TRANTYPE=$P($G(^PRCA(433,TRANDA,1)),"^",2)
"RTN","RCRJRBD",60,0)
 . . . I "^1^73^2^34^43^"'[("^"_TRANTYPE_"^") Q           ; *340 added 73
"RTN","RCRJRBD",61,0)
 . . . S VALUE=$$TRANBAL^RCRJRCOT(TRANDA) I VALUE="" Q
"RTN","RCRJRBD",62,0)
 . . . ;  increase adjustments or re-establish
"RTN","RCRJRBD",63,0)
 . . . I TRANTYPE=1!(TRANTYPE=73)!(TRANTYPE=43) S PRIN=PRIN+$P(VALUE,"^") Q    ; *340 added 73
"RTN","RCRJRBD",64,0)
 . . . ;  payments
"RTN","RCRJRBD",65,0)
 . . . I TRANTYPE=2!(TRANTYPE=34) S PAY=PAY+$P(VALUE,"^") Q
"RTN","RCRJRBD",66,0)
 . . ;
"RTN","RCRJRBD",67,0)
 . . ;  payment cannot be greater than principle
"RTN","RCRJRBD",68,0)
 . . I PAY>PRIN S PAY=PRIN
"RTN","RCRJRBD",69,0)
 . . ;
"RTN","RCRJRBD",70,0)
 . . ;  store the data
"RTN","RCRJRBD",71,0)
 . . S PRINCPAL(SGL)=$G(PRINCPAL(SGL))+PRIN
"RTN","RCRJRBD",72,0)
 . . S PAYMENT(SGL)=$G(PAYMENT(SGL))+PAY
"RTN","RCRJRBD",73,0)
 . . ;
"RTN","RCRJRBD",74,0)
 ;
"RTN","RCRJRBD",75,0)
 ;  calculate the writeoffs from 2/0/98
"RTN","RCRJRBD",76,0)
 ;  2/0/98 is when fms cleared out actual writeoffs and contract adj
"RTN","RCRJRBD",77,0)
 K ^XTMP("PRCABDET")
"RTN","RCRJRBD",78,0)
 S ^XTMP("PRCABDET",0)=$$FMADD^XLFDT(DT,10)_"^"_DT_"^BAD DEBT REPORT AUDIT"
"RTN","RCRJRBD",79,0)
 F TRANTYPE=8,9,10,11,35 D
"RTN","RCRJRBD",80,0)
 . S TRANDATE=2980200
"RTN","RCRJRBD",81,0)
 . ;  do not pick up transactions after the end date
"RTN","RCRJRBD",82,0)
 . F  S TRANDATE=$O(^PRCA(433,"AT",TRANTYPE,TRANDATE)) Q:'TRANDATE!($P(TRANDATE,".")>DATEEND)  D
"RTN","RCRJRBD",83,0)
 . . S TRANDA=0 F  S TRANDA=$O(^PRCA(433,"AT",TRANTYPE,TRANDATE,TRANDA)) Q:'TRANDA  D
"RTN","RCRJRBD",84,0)
 . . . ;  do not look at decrease adj which are not contract adj
"RTN","RCRJRBD",85,0)
 . . . I TRANTYPE=35,'$P($G(^PRCA(433,TRANDA,8)),"^",8) Q
"RTN","RCRJRBD",86,0)
 . . . ;
"RTN","RCRJRBD",87,0)
 . . . S BILLDA=$P($G(^PRCA(433,TRANDA,0)),"^",2)
"RTN","RCRJRBD",88,0)
 . . . I 'BILLDA Q
"RTN","RCRJRBD",89,0)
 . . . S CATEGORY=+$P($G(^PRCA(430,BILLDA,0)),"^",2)
"RTN","RCRJRBD",90,0)
 . . . ;  do not look at prepayments
"RTN","RCRJRBD",91,0)
 . . . I 'CATEGORY!(CATEGORY=26) Q
"RTN","RCRJRBD",92,0)
 . . . ;
"RTN","RCRJRBD",93,0)
 . . . ;  only report fund 528701,03,04,11 and 4032/528709 (ltc) bills
"RTN","RCRJRBD",94,0)
 . . . S FUND=$$GETFUNDB^RCXFMSUF(BILLDA,1)
"RTN","RCRJRBD",95,0)
 . . . I '$$PTACCT^PRCAACC(FUND),$E(FUND,1,4)'=4032 Q
"RTN","RCRJRBD",96,0)
 . . . ;
"RTN","RCRJRBD",97,0)
 . . . ;  get bill active date
"RTN","RCRJRBD",98,0)
 . . . S ARACTDT=+$P($P($G(^PRCA(430,BILLDA,6)),"^",21),".")
"RTN","RCRJRBD",99,0)
 . . . ;  determine MRA type of bill, given bill# and bill active date
"RTN","RCRJRBD",100,0)
 . . . ;  DBIA #4385 activated on 31-Mar-2004
"RTN","RCRJRBD",101,0)
 . . . S MRATYPE=$$MRATYPE^IBCEMU2(BILLDA,ARACTDT)
"RTN","RCRJRBD",102,0)
 . . . ;
"RTN","RCRJRBD",103,0)
 . . . ; derive standard general ledger (SGL) from cat/fund/MRA type
"RTN","RCRJRBD",104,0)
 . . . S SGL=$$BDRSGL(CATEGORY,FUND,MRATYPE)
"RTN","RCRJRBD",105,0)
 . . . ;
"RTN","RCRJRBD",106,0)
 . . . ;  get the principal transaction value
"RTN","RCRJRBD",107,0)
 . . . S RCVALUE=+$P($$TRANBAL^RCRJRCOT(TRANDA),"^")
"RTN","RCRJRBD",108,0)
 . . . ;  temp variable for value (used below)
"RTN","RCRJRBD",109,0)
 . . . S RCPRIN=RCVALUE
"RTN","RCRJRBD",110,0)
 . . . ;
"RTN","RCRJRBD",111,0)
 . . . ;  add actual writeoff amount for fiscal year
"RTN","RCRJRBD",112,0)
 . . . I TRANTYPE'=35 S ACTUALWO(SGL)=$G(ACTUALWO(SGL))+RCVALUE
"RTN","RCRJRBD",113,0)
 . . . ;  add actual contract adjustments for fiscal year
"RTN","RCRJRBD",114,0)
 . . . I TRANTYPE=35 S ACTUALCA(SGL)=$G(ACTUALCA(SGL))+RCVALUE
"RTN","RCRJRBD",115,0)
 . . . S RSC=$$CALCRSC^RCXFMSUR(BILLDA)
"RTN","RCRJRBD",116,0)
 . . . S ^XTMP("PRCABDET",BILLDA,CATEGORY,FUND,RSC,SGL,TRANDA,TRANDATE,TRANTYPE,RCPRIN,RCVALUE,0,0)=""
"RTN","RCRJRBD",117,0)
 ;
"RTN","RCRJRBD",118,0)
 ;  remove all the entries from the bad debt file
"RTN","RCRJRBD",119,0)
 D DELETALL
"RTN","RCRJRBD",120,0)
 ;
"RTN","RCRJRBD",121,0)
 ;  calculate percentages and store them
"RTN","RCRJRBD",122,0)
 F SGL=1319,1319.2,1319.3,1319.4,1319.5,1319.6,1338,1338.2,1338.3,1339,1339.1,"133N","133N.2","133.N3" D
"RTN","RCRJRBD",123,0)
 . ;  collection %
"RTN","RCRJRBD",124,0)
 . S COLLECT=0 I $G(PRINCPAL(SGL)) S COLLECT=$J($G(PAYMENT(SGL))/PRINCPAL(SGL)*100,0,2)
"RTN","RCRJRBD",125,0)
 . ;  patch PRCA*4.5*138: for the first year from when MRA is activated at a site, there is no collection
"RTN","RCRJRBD",126,0)
 . ;  history for post-MRA non-Medicare bills(SGL 133N). So, to calculate the percentage for SGL 133N, the
"RTN","RCRJRBD",127,0)
 . ;  payment and the principal for SGL 1339 are used in the first year.
"RTN","RCRJRBD",128,0)
 . ;  override the collection value for SGL=133N for the first year from MRA activation.
"RTN","RCRJRBD",129,0)
 . ;;  Re-evaluate the calc. of the percentage for 133N as well as 1339.
"RTN","RCRJRBD",130,0)
 . ;;I SGL="133N",$G(PRINCIPAL(1339)) D  ;
"RTN","RCRJRBD",131,0)
 . ;;. N X1,X2,X,%Y
"RTN","RCRJRBD",132,0)
 . ;;. ;  X2=MRA Activation Date, X1=Today, X=diff in days, %Y=0 invalid dates
"RTN","RCRJRBD",133,0)
 . ;;. ;  DBIA #4385 activated on 31-Mar-2004
"RTN","RCRJRBD",134,0)
 . ;;. S X2=$$MRADTACT^IBCEMU2,X1=$$DT^XLFDT D ^%DTC
"RTN","RCRJRBD",135,0)
 . ;;. I %Y,X'>364.25 S COLLECT=$J($G(PAYMENT(1339))/PRINCPAL(1339)*100,0,2)
"RTN","RCRJRBD",136,0)
 . S DR=".02////"_+COLLECT_";"
"RTN","RCRJRBD",137,0)
 . ;
"RTN","RCRJRBD",138,0)
 . ;  current month receivable (this is built in the routine
"RTN","RCRJRBD",139,0)
 . ;  RCRJRCO1 and is stored in ^TMP($J,"RCRJRBD",SGL))
"RTN","RCRJRBD",140,0)
 . S DR=DR_".07////"_+$G(^TMP($J,"RCRJRBD",SGL))_";"
"RTN","RCRJRBD",141,0)
 . ;
"RTN","RCRJRBD",142,0)
 . ;  calculate allowance estimate for 1319 and 1338
"RTN","RCRJRBD",143,0)
 . ;  .08 allowance estimate = (writeoff % * current receivables)
"RTN","RCRJRBD",144,0)
 . ;  .09 actual writeoffs fytd
"RTN","RCRJRBD",145,0)
 . I SGL=1319!(SGL=1319.2)!(SGL=1319.3)!(SGL=1319.4)!(SGL=1319.5)!(SGL=1319.6)!(SGL=1338)!(SGL=1338.2)!(SGL=1338.3) D
"RTN","RCRJRBD",146,0)
 . . S WRITEOFF=100-COLLECT
"RTN","RCRJRBD",147,0)
 . . S DR=DR_".03////"_WRITEOFF_";"
"RTN","RCRJRBD",148,0)
 . . S DR=DR_".08////"_$J((WRITEOFF/100)*$G(^TMP($J,"RCRJRBD",SGL)),0,2)_";"
"RTN","RCRJRBD",149,0)
 . . S DR=DR_".09////"_+$G(ACTUALWO(SGL))_";"
"RTN","RCRJRBD",150,0)
 . ;  calculate allowance estimate for 1339
"RTN","RCRJRBD",151,0)
 . ;  .08 allowance estimate = (contract % * current receivables)
"RTN","RCRJRBD",152,0)
 . ;  .09 actual contract adjustments fytd
"RTN","RCRJRBD",153,0)
 . I SGL=1339!(SGL=1339.1)!(SGL="133N")!(SGL="133N.2")!(SGL="133N.3") D
"RTN","RCRJRBD",154,0)
 . . S CONTRACT=100-COLLECT
"RTN","RCRJRBD",155,0)
 . . S DR=DR_".04////"_CONTRACT_";"
"RTN","RCRJRBD",156,0)
 . . S DR=DR_".08////"_$J((CONTRACT/100)*$G(^TMP($J,"RCRJRBD",SGL)),0,2)_";"
"RTN","RCRJRBD",157,0)
 . . S DR=DR_".09////"_+$G(ACTUALCA(SGL))_";"
"RTN","RCRJRBD",158,0)
 . ;
"RTN","RCRJRBD",159,0)
 . ;  set changed locally flag to no
"RTN","RCRJRBD",160,0)
 . S DR=DR_".1////0;"
"RTN","RCRJRBD",161,0)
 . D STORE(SGL,DR)
"RTN","RCRJRBD",162,0)
 ;
"RTN","RCRJRBD",163,0)
 L -^RC(348.1)
"RTN","RCRJRBD",164,0)
 ;
"RTN","RCRJRBD",165,0)
 ;   ;  put the report in a mail message (rcrjfmm=1)
"RTN","RCRJRBD",166,0)
 ;   S RCRJFMM=1
"RTN","RCRJRBD",167,0)
 ;   S RCRJDATE=DATEEND
"RTN","RCRJRBD",168,0)
 ;   D DQ^RCRJRBDR
"RTN","RCRJRBD",169,0)
 ;
"RTN","RCRJRBD",170,0)
 ;  transmit the allowances to FMS, and then generate the report.
"RTN","RCRJRBD",171,0)
 D BADDEBT^RCXFMSSV(DATEEND)
"RTN","RCRJRBD",172,0)
 Q
"RTN","RCRJRBD",173,0)
 ;
"RTN","RCRJRBD",174,0)
 ;
"RTN","RCRJRBD",175,0)
STORE(SGL,DR) ;  store data for Standard Ledger Account
"RTN","RCRJRBD",176,0)
 N D0,DA,DD,DI,DIC,DIE,DINUM,DO,DQ,X,Y
"RTN","RCRJRBD",177,0)
 S DIC="^RC(348.1,",DIC(0)="L",X=SGL,DIC("DR")=DR
"RTN","RCRJRBD",178,0)
 D FILE^DICN
"RTN","RCRJRBD",179,0)
 Q
"RTN","RCRJRBD",180,0)
 ;
"RTN","RCRJRBD",181,0)
 ;
"RTN","RCRJRBD",182,0)
DELETALL ;  delete all the entries from the bad debt file
"RTN","RCRJRBD",183,0)
 N %,DA,DIC,DIK,X,Y
"RTN","RCRJRBD",184,0)
 S DIK="^RC(348.1,"
"RTN","RCRJRBD",185,0)
 S DA=0 F  S DA=$O(^RC(348.1,DA)) Q:'DA  D ^DIK
"RTN","RCRJRBD",186,0)
 Q
"RTN","RCRJRBD",187,0)
 ;
"RTN","RCRJRBD",188,0)
 ;
"RTN","RCRJRBD",189,0)
WD3() ;  return the third work day of the month
"RTN","RCRJRBD",190,0)
 N J,P,V,X
"RTN","RCRJRBD",191,0)
 S J=0 F P=$E(DT,1,5)_"01":1 S V=$$DOW^XLFDT(P,1) I V,V<6,'$D(^HOLIDAY("B",P)) S J=J+1 Q:J=3
"RTN","RCRJRBD",192,0)
 S X=+$E(P,6,7)
"RTN","RCRJRBD",193,0)
 Q X
"RTN","RCRJRBD",194,0)
 ;
"RTN","RCRJRBD",195,0)
 ;
"RTN","RCRJRBD",196,0)
PREVMONT(FORDATE) ; return the previous month's date
"RTN","RCRJRBD",197,0)
 N PREVDATE
"RTN","RCRJRBD",198,0)
 S PREVDATE=$E(FORDATE,1,5)-1
"RTN","RCRJRBD",199,0)
 I $E(PREVDATE,4,5)="00" S PREVDATE=($E(PREVDATE,1,3)-1)_12
"RTN","RCRJRBD",200,0)
 Q PREVDATE_"00"
"RTN","RCRJRBD",201,0)
 ;
"RTN","RCRJRBD",202,0)
 ; derive standard general ledger (SGL) from category and fund
"RTN","RCRJRBD",203,0)
SGL(CATEGORY,FUND) ;
"RTN","RCRJRBD",204,0)
 I $G(FUND)=528709 Q 1319.2 ;new long term care fund
"RTN","RCRJRBD",205,0)
 I $E($G(FUND),1,4)=4032 Q 1319.2 ; breakout long term care as a subset
"RTN","RCRJRBD",206,0)
 I $G(FUND)=528711&(CAT=6)!(CAT=7) Q 1319.5  ; breakout pharmacy
"RTN","RCRJRBD",207,0)
 I $G(FUND)=528711&(CAT=9) Q "133N.2"  ; pharmacy reimburs health ins
"RTN","RCRJRBD",208,0)
 I $G(FUND)=528711&(CAT=10) Q 1338.2  ; pharmacy tort feasor
"RTN","RCRJRBD",209,0)
 I CATEGORY=8 Q 1339   ; crime or per. vio.
"RTN","RCRJRBD",210,0)
 I CATEGORY=9 Q 1339   ; reimbursable health insurance
"RTN","RCRJRBD",211,0)
 I CATEGORY=46 Q 1339   ; EMER/HUMAN REIMB INS  ;315
"RTN","RCRJRBD",212,0)
 I CATEGORY=10 Q 1338  ; tort feasor
"RTN","RCRJRBD",213,0)
 I CATEGORY=21 Q 1339  ; medicare
"RTN","RCRJRBD",214,0)
 I CATEGORY=45 Q 1339.1  ; Fee Basis
"RTN","RCRJRBD",215,0)
 Q 1319
"RTN","RCRJRBD",216,0)
 ;
"RTN","RCRJRBD",217,0)
 ;
"RTN","RCRJRBD",218,0)
BDRSGL(CAT,FUND,MRATYPE) ; Calculate SGLs for the BDR process
"RTN","RCRJRBD",219,0)
 ;PRCA*4.5*310/DRF Added fund 528713, Non-VA Reimbursable Insurance
"RTN","RCRJRBD",220,0)
 ;
"RTN","RCRJRBD",221,0)
 ; This API will be used by both the ARDC (routine RCRJRCOC)
"RTN","RCRJRBD",222,0)
 ; and the BDR estimate calculator to associate receivables
"RTN","RCRJRBD",223,0)
 ; with the correct standard general ledger account (SGL).
"RTN","RCRJRBD",224,0)
 ; The following table will be implemented:
"RTN","RCRJRBD",225,0)
 ;
"RTN","RCRJRBD",226,0)
 ; Receivable Type (Category)        Fund      SGL
"RTN","RCRJRBD",227,0)
 ;==================================================
"RTN","RCRJRBD",228,0)
 ; Medical Care Co-payments                 528703    1319
"RTN","RCRJRBD",229,0)
 ;  (plus Inelig, Emerg./Hum. rec.)
"RTN","RCRJRBD",230,0)
 ; Long Term Care Co-payments               528709    1319.2
"RTN","RCRJRBD",231,0)
 ; Medication Co-payments                   528701    1319.3
"RTN","RCRJRBD",232,0)
 ; Crimes of Personal Violence (8),         528704    1319.4
"RTN","RCRJRBD",233,0)
 ;  Medicare (21), No-Fault Auto
"RTN","RCRJRBD",234,0)
 ;  (7), Workman's Comp (6)
"RTN","RCRJRBD",235,0)
 ; Tort Feasor (10)                         528704    1338
"RTN","RCRJRBD",236,0)
 ; RHI (9), pre-MRA                         528704    1339
"RTN","RCRJRBD",237,0)
 ; RHI (9), post-MRA, MRA rec.              528704    133H
"RTN","RCRJRBD",238,0)
 ; RHI (9), post-MRA, non-MRA rec.          528704    133N
"RTN","RCRJRBD",239,0)
 ; Non-VA RHI Tort Feasor                   528713    1338.3
"RTN","RCRJRBD",240,0)
 ; Non-VA RHI (45), pre-MRA                 528713    1339.1
"RTN","RCRJRBD",241,0)
 ; Non-VA RHI (45), post-MRA, MRA rec.      528713    133H.2
"RTN","RCRJRBD",242,0)
 ; Non-VA RHI (45), post-MRA, non-MRA rec.  528713    133N.3
"RTN","RCRJRBD",243,0)
 ; Crimes of Personal Violence (8),         528713    1319.6
"RTN","RCRJRBD",244,0)
 ;  Medicare (21), No-Fault Auto
"RTN","RCRJRBD",245,0)
 ;  (7), Workman's Comp (6)
"RTN","RCRJRBD",246,0)
 ; Pharmacy No Fault Auto(7),               528711    1319.5
"RTN","RCRJRBD",247,0)
 ; Pharmacy Workman's Comp(6)
"RTN","RCRJRBD",248,0)
 ; Pharmacy RHI, non MRA (9)                528711    133N.2
"RTN","RCRJRBD",249,0)
 ; Pharmacy Tort Feasor (10)                528711    1338.2
"RTN","RCRJRBD",250,0)
 ;
"RTN","RCRJRBD",251,0)
 ;  Input:  CAT  --  Pointer to the receivable category in file 430.2
"RTN","RCRJRBD",252,0)
 ;         FUND  --  Receivable fund calculated by routine RCXFMSUF
"RTN","RCRJRBD",253,0)
 ;      MRATYPE  --  Indicator of an MRA (2) or non-MRA (3) receivable
"RTN","RCRJRBD",254,0)
 ;
"RTN","RCRJRBD",255,0)
 ;
"RTN","RCRJRBD",256,0)
 I $G(FUND)=528709 Q 1319.2
"RTN","RCRJRBD",257,0)
 I $E($G(FUND),1,4)=4032 Q 1319.2
"RTN","RCRJRBD",258,0)
 I $G(FUND)=528701 Q 1319.3
"RTN","RCRJRBD",259,0)
 I $G(FUND)=528711&((CAT=6)!(CAT=7)) Q 1319.5
"RTN","RCRJRBD",260,0)
 I $G(FUND)=528711&(CAT=9) Q "133N.2"
"RTN","RCRJRBD",261,0)
 I $G(FUND)=528711&(CAT=10) Q 1338.2
"RTN","RCRJRBD",262,0)
 I $G(FUND)=528713&(CAT=10) Q 1338.3
"RTN","RCRJRBD",263,0)
 I $G(FUND)=528713&(CAT=8!(CAT=21)!(CAT=6)!(CAT=7)) Q 1319.6
"RTN","RCRJRBD",264,0)
 I CAT=8!(CAT=21)!(CAT=7)!(CAT=6) Q 1319.4
"RTN","RCRJRBD",265,0)
 I CAT=10 Q 1338
"RTN","RCRJRBD",266,0)
 I CAT=9 Q $S(MRATYPE=2:"133H",MRATYPE=3:"133N",1:1339)
"RTN","RCRJRBD",267,0)
 I CAT=46 Q $S(MRATYPE=2:"133H",MRATYPE=3:"133N",1:1339)  ;315 
"RTN","RCRJRBD",268,0)
 I CAT=45 Q $S(MRATYPE=2:"133H.2",MRATYPE=3:"133N.3",1:1339.1)
"RTN","RCRJRBD",269,0)
 Q 1319
"RTN","RCRJRCO1")
0^9^B24338424^B23580968
"RTN","RCRJRCO1",1,0)
RCRJRCO1 ;WISC/RFJ/BGJ-continuation of ar data collector ;1 Mar 97
"RTN","RCRJRCO1",2,0)
 ;;4.5;Accounts Receivable;**68,96,101,120,103,153,156,170,182,203,320,340**;Mar 20, 1995;Build 9
"RTN","RCRJRCO1",3,0)
 ;;Per VA Directive 6402, this routine should not be modified.
"RTN","RCRJRCO1",4,0)
 Q
"RTN","RCRJRCO1",5,0)
 ;
"RTN","RCRJRCO1",6,0)
 ;
"RTN","RCRJRCO1",7,0)
START ;  calculate ndb values from file 433 transactions
"RTN","RCRJRCO1",8,0)
 ;  needs datebeg, dateend
"RTN","RCRJRCO1",9,0)
 ;  total is total by category
"RTN","RCRJRCO1",10,0)
 ;
"RTN","RCRJRCO1",11,0)
 N ADMIN,BILLDA,DATE,INTEREST,PRINBAL,TRANDA,TRANTYPE,VALUE,RCNOHSIF
"RTN","RCRJRCO1",12,0)
 ;
"RTN","RCRJRCO1",13,0)
 S RCNOHSIF=$$NOHSIF^RCRJRCO() ; no HSIF (disabled)
"RTN","RCRJRCO1",14,0)
 ;
"RTN","RCRJRCO1",15,0)
 F TRANTYPE=1,2,3,8,9,10,11,12,13,14,34,35,41,43,73,74 D             ; *340 added 73 and 74
"RTN","RCRJRCO1",16,0)
 .   S DATE=DATEBEG-1
"RTN","RCRJRCO1",17,0)
 .   F  S DATE=$O(^PRCA(433,"AT",TRANTYPE,DATE)) Q:'DATE!(DATE>DATEEND)  D
"RTN","RCRJRCO1",18,0)
 .   .   S TRANDA=0
"RTN","RCRJRCO1",19,0)
 .   .   F  S TRANDA=$O(^PRCA(433,"AT",TRANTYPE,DATE,TRANDA)) Q:'TRANDA  D
"RTN","RCRJRCO1",20,0)
 .   .   .   S BILLDA=+$P($G(^PRCA(433,TRANDA,0)),"^",2) I 'BILLDA Q
"RTN","RCRJRCO1",21,0)
 .   .   .   ;  bill not linked to a site
"RTN","RCRJRCO1",22,0)
 .   .   .   I '$P($G(^PRCA(430,BILLDA,0)),"^",12) Q
"RTN","RCRJRCO1",23,0)
 .   .   .   ;
"RTN","RCRJRCO1",24,0)
 .   .   .   ;  get a transactions balance
"RTN","RCRJRCO1",25,0)
 .   .   .   S VALUE=$$TRANBAL^RCRJRCOT(TRANDA) I VALUE="" Q
"RTN","RCRJRCO1",26,0)
 .   .   .   S PRINBAL=$P(VALUE,"^"),INTEREST=$P(VALUE,"^",2),ADMIN=$P(VALUE,"^",3)+$P(VALUE,"^",4)+$P(VALUE,"^",5)
"RTN","RCRJRCO1",27,0)
 .   .   .   ;
"RTN","RCRJRCO1",28,0)
 .   .   .   D @TRANTYPE
"RTN","RCRJRCO1",29,0)
 Q
"RTN","RCRJRCO1",30,0)
 ;
"RTN","RCRJRCO1",31,0)
 ;
"RTN","RCRJRCO1",32,0)
1 ;  increase adjustments
"RTN","RCRJRCO1",33,0)
 ;D SETTOTAL(14,PRINBAL,0)
"RTN","RCRJRCO1",34,0)
 D SETTOTAL(16,PRINBAL,0)   ;PRCA*4.5*320 Increease aging buckets by 2
"RTN","RCRJRCO1",35,0)
 Q
"RTN","RCRJRCO1",36,0)
 ;
"RTN","RCRJRCO1",37,0)
 ;
"RTN","RCRJRCO1",38,0)
2 ;  payment in partial
"RTN","RCRJRCO1",39,0)
 N CATEGORY
"RTN","RCRJRCO1",40,0)
 ;  prepayment transaction (field #20)
"RTN","RCRJRCO1",41,0)
 I $P($G(^PRCA(433,TRANDA,5)),"^") D  Q
"RTN","RCRJRCO1",42,0)
 . ;D SETTOTAL(21,PRINBAL,0)
"RTN","RCRJRCO1",43,0)
 . D SETTOTAL(23,PRINBAL,0)   ;PRCA*4.5*320 Increease aging buckets by 2
"RTN","RCRJRCO1",44,0)
 . ;I INTEREST D SETTOTAL(38,INTEREST,0)
"RTN","RCRJRCO1",45,0)
 . I INTEREST D SETTOTAL(40,INTEREST,0)
"RTN","RCRJRCO1",46,0)
 . ;I ADMIN D SETTOTAL(39,ADMIN,0)
"RTN","RCRJRCO1",47,0)
 . I ADMIN D SETTOTAL(41,ADMIN,0)
"RTN","RCRJRCO1",48,0)
 ;
"RTN","RCRJRCO1",49,0)
 ;  check to see if payment is rx copay and is split between
"RTN","RCRJRCO1",50,0)
 ;  mccf and hsif.  if the bill has been run through the
"RTN","RCRJRCO1",51,0)
 ;  calculator, do it now and report the mccf split to the ndb.
"RTN","RCRJRCO1",52,0)
 ;  the amount owed to mccf is in piece 3 and is returned negative
"RTN","RCRJRCO1",53,0)
 S CATEGORY=$P(^PRCA(430,BILLDA,0),"^",2)
"RTN","RCRJRCO1",54,0)
 I 'RCNOHSIF,PRINBAL,(CATEGORY=22!(CATEGORY=23)),'$D(^TMP($J,"RCBMILLDATA",BILLDA,TRANDA)) D
"RTN","RCRJRCO1",55,0)
 . S %=$$BILLFUND^RCBMILLC(BILLDA)
"RTN","RCRJRCO1",56,0)
 ;
"RTN","RCRJRCO1",57,0)
 ; changed by patch PRCA*4.5*182 to no longer separate the mccf and
"RTN","RCRJRCO1",58,0)
 ; hsif components.  the entire amount is now reported to the ndb.
"RTN","RCRJRCO1",59,0)
 ;
"RTN","RCRJRCO1",60,0)
 ;.   S PRINBAL=-$P($G(^TMP($J,"RCBMILLDATA",BILLDA,TRANDA)),"^",3)
"RTN","RCRJRCO1",61,0)
 ;
"RTN","RCRJRCO1",62,0)
 ;  partial payments (trantype=2), full payments (trantype=34)
"RTN","RCRJRCO1",63,0)
 ;D SETTOTAL($S(TRANTYPE=2:19,1:18),PRINBAL,0)
"RTN","RCRJRCO1",64,0)
 D SETTOTAL($S(TRANTYPE=2:21,1:20),PRINBAL,0)
"RTN","RCRJRCO1",65,0)
 ;I INTEREST D SETTOTAL(38,INTEREST,0)
"RTN","RCRJRCO1",66,0)
 I INTEREST D SETTOTAL(40,INTEREST,0)
"RTN","RCRJRCO1",67,0)
 ;I ADMIN D SETTOTAL(39,ADMIN,0)
"RTN","RCRJRCO1",68,0)
 I ADMIN D SETTOTAL(41,ADMIN,0)
"RTN","RCRJRCO1",69,0)
 ;
"RTN","RCRJRCO1",70,0)
 ;  irs, district counsel, dept of justice (#7)
"RTN","RCRJRCO1",71,0)
 S %=$P($G(^PRCA(433,TRANDA,0)),"^",7) I %="" Q
"RTN","RCRJRCO1",72,0)
 ;I %="IRS" D SETTOTAL(28,PRINBAL,0) Q
"RTN","RCRJRCO1",73,0)
 I %="IRS" D SETTOTAL(30,PRINBAL,0) Q    ;PRCA*4.5*320 Increease aging buckets by 2 (on several lines below)
"RTN","RCRJRCO1",74,0)
 ;I %="DC" D SETTOTAL(31,PRINBAL,0) Q
"RTN","RCRJRCO1",75,0)
 I %="DC" D SETTOTAL(33,PRINBAL,0) Q
"RTN","RCRJRCO1",76,0)
 ;I %="DOJ" D SETTOTAL(34,PRINBAL,0) Q
"RTN","RCRJRCO1",77,0)
 I %="DOJ" D SETTOTAL(36,PRINBAL,0) Q
"RTN","RCRJRCO1",78,0)
 Q
"RTN","RCRJRCO1",79,0)
 ;
"RTN","RCRJRCO1",80,0)
 ;
"RTN","RCRJRCO1",81,0)
3 ;  refer to district counsel
"RTN","RCRJRCO1",82,0)
 ;D SETTOTAL(30,PRINBAL,0)
"RTN","RCRJRCO1",83,0)
 D SETTOTAL(32,PRINBAL,0)
"RTN","RCRJRCO1",84,0)
 Q
"RTN","RCRJRCO1",85,0)
 ;
"RTN","RCRJRCO1",86,0)
 ;
"RTN","RCRJRCO1",87,0)
8 ;  terminate by fiscal officer
"RTN","RCRJRCO1",88,0)
 ;D WRITEOFF^RCRJRCOC(BILLDA,VALUE,$S(TRANTYPE=8:25,1:24))
"RTN","RCRJRCO1",89,0)
 D WRITEOFF^RCRJRCOC(BILLDA,VALUE,$S(TRANTYPE=8:27,1:26))
"RTN","RCRJRCO1",90,0)
 ;  decrease in number of debts
"RTN","RCRJRCO1",91,0)
 ;I '$D(^TMP($J,"RCRJRCOL","COUNT",BILLDA,17)) D SETTOTAL(17,0,0)
"RTN","RCRJRCO1",92,0)
 I '$D(^TMP($J,"RCRJRCOL","COUNT",BILLDA,19)) D SETTOTAL(19,0,0)
"RTN","RCRJRCO1",93,0)
 Q
"RTN","RCRJRCO1",94,0)
 ;
"RTN","RCRJRCO1",95,0)
 ;
"RTN","RCRJRCO1",96,0)
9 ;  terminate by compromise
"RTN","RCRJRCO1",97,0)
 D 8
"RTN","RCRJRCO1",98,0)
 Q
"RTN","RCRJRCO1",99,0)
 ;
"RTN","RCRJRCO1",100,0)
 ;
"RTN","RCRJRCO1",101,0)
10 ;  payment waived in full
"RTN","RCRJRCO1",102,0)
 ;D WRITEOFF^RCRJRCOC(BILLDA,VALUE,22)
"RTN","RCRJRCO1",103,0)
 D WRITEOFF^RCRJRCOC(BILLDA,VALUE,24)
"RTN","RCRJRCO1",104,0)
 Q
"RTN","RCRJRCO1",105,0)
 ;
"RTN","RCRJRCO1",106,0)
 ;
"RTN","RCRJRCO1",107,0)
11 ;  payment waived in partial
"RTN","RCRJRCO1",108,0)
 ;D WRITEOFF^RCRJRCOC(BILLDA,VALUE,23)
"RTN","RCRJRCO1",109,0)
 D WRITEOFF^RCRJRCOC(BILLDA,VALUE,25)
"RTN","RCRJRCO1",110,0)
 Q
"RTN","RCRJRCO1",111,0)
 ;
"RTN","RCRJRCO1",112,0)
 ;
"RTN","RCRJRCO1",113,0)
12 ;  admin cost / charge
"RTN","RCRJRCO1",114,0)
 ;  interest/admin added
"RTN","RCRJRCO1",115,0)
 ;I INTEREST>0 D SETTOTAL(40,INTEREST,0)
"RTN","RCRJRCO1",116,0)
 I INTEREST>0 D SETTOTAL(42,INTEREST,0)
"RTN","RCRJRCO1",117,0)
 ;I ADMIN>0 D SETTOTAL(41,ADMIN,0)
"RTN","RCRJRCO1",118,0)
 I ADMIN>0 D SETTOTAL(43,ADMIN,0)
"RTN","RCRJRCO1",119,0)
 ;  interest/admin cost exempt
"RTN","RCRJRCO1",120,0)
 ;I INTEREST<0 D SETTOTAL(42,-INTEREST,0)
"RTN","RCRJRCO1",121,0)
 I INTEREST<0 D SETTOTAL(44,-INTEREST,0)
"RTN","RCRJRCO1",122,0)
 ;I ADMIN<0 D SETTOTAL(42,-ADMIN,0)
"RTN","RCRJRCO1",123,0)
 I ADMIN<0 D SETTOTAL(44,-ADMIN,0)
"RTN","RCRJRCO1",124,0)
 Q
"RTN","RCRJRCO1",125,0)
 ;
"RTN","RCRJRCO1",126,0)
 ;
"RTN","RCRJRCO1",127,0)
13 ;  interest / admin charge
"RTN","RCRJRCO1",128,0)
 D 12
"RTN","RCRJRCO1",129,0)
 Q
"RTN","RCRJRCO1",130,0)
 ;
"RTN","RCRJRCO1",131,0)
 ;
"RTN","RCRJRCO1",132,0)
14 ;  exempt interest / admin cost
"RTN","RCRJRCO1",133,0)
 ;D SETTOTAL(42,INTEREST,0)
"RTN","RCRJRCO1",134,0)
 D SETTOTAL(44,INTEREST,0)
"RTN","RCRJRCO1",135,0)
 Q
"RTN","RCRJRCO1",136,0)
 ;
"RTN","RCRJRCO1",137,0)
 ;
"RTN","RCRJRCO1",138,0)
34 ;  payment in full
"RTN","RCRJRCO1",139,0)
 D 2
"RTN","RCRJRCO1",140,0)
 ;  decrease in number of debts
"RTN","RCRJRCO1",141,0)
 ;I '$D(^TMP($J,"RCRJRCOL","COUNT",BILLDA,17)) D SETTOTAL(17,0,0)
"RTN","RCRJRCO1",142,0)
 I '$D(^TMP($J,"RCRJRCOL","COUNT",BILLDA,19)) D SETTOTAL(19,0,0)
"RTN","RCRJRCO1",143,0)
 Q
"RTN","RCRJRCO1",144,0)
 ;
"RTN","RCRJRCO1",145,0)
 ;
"RTN","RCRJRCO1",146,0)
35 ;  decrease adjustment
"RTN","RCRJRCO1",147,0)
 N CONTRACT
"RTN","RCRJRCO1",148,0)
 ;  contractual adjustment (field #88)
"RTN","RCRJRCO1",149,0)
 S CONTRACT=$P($G(^PRCA(433,TRANDA,8)),"^",8)
"RTN","RCRJRCO1",150,0)
 ;I CONTRACT D WRITEOFF^RCRJRCOC(BILLDA,VALUE,20) Q
"RTN","RCRJRCO1",151,0)
 I CONTRACT D WRITEOFF^RCRJRCOC(BILLDA,VALUE,22) Q
"RTN","RCRJRCO1",152,0)
 ;D SETTOTAL(16,PRINBAL,0)
"RTN","RCRJRCO1",153,0)
 D SETTOTAL(18,PRINBAL,0)
"RTN","RCRJRCO1",154,0)
 Q
"RTN","RCRJRCO1",155,0)
 ;
"RTN","RCRJRCO1",156,0)
 ;
"RTN","RCRJRCO1",157,0)
41 ;  refund
"RTN","RCRJRCO1",158,0)
 ;D SETTOTAL(43,PRINBAL,0)
"RTN","RCRJRCO1",159,0)
 D SETTOTAL(45,PRINBAL,0)
"RTN","RCRJRCO1",160,0)
 Q
"RTN","RCRJRCO1",161,0)
 ;
"RTN","RCRJRCO1",162,0)
 ;
"RTN","RCRJRCO1",163,0)
43 ;  re-establishment
"RTN","RCRJRCO1",164,0)
 ;D SETTOTAL(13,PRINBAL,INTEREST+ADMIN)
"RTN","RCRJRCO1",165,0)
 D SETTOTAL(15,PRINBAL,INTEREST+ADMIN)
"RTN","RCRJRCO1",166,0)
 Q
"RTN","RCRJRCO1",167,0)
 ;
"RTN","RCRJRCO1",168,0)
 ;
"RTN","RCRJRCO1",169,0)
73 ;  cs increase adjustment - added with *340
"RTN","RCRJRCO1",170,0)
 D 1
"RTN","RCRJRCO1",171,0)
 Q
"RTN","RCRJRCO1",172,0)
 ;
"RTN","RCRJRCO1",173,0)
 ;
"RTN","RCRJRCO1",174,0)
74 ;  cs admin.cost charge - added with *340
"RTN","RCRJRCO1",175,0)
 D 12
"RTN","RCRJRCO1",176,0)
 Q
"RTN","RCRJRCO1",177,0)
 ;
"RTN","RCRJRCO1",178,0)
 ;
"RTN","RCRJRCO1",179,0)
SETTOTAL(CRITER2,AMOUNT,INTEREST) ;  store results
"RTN","RCRJRCO1",180,0)
 N RSC,TYPE
"RTN","RCRJRCO1",181,0)
 ;
"RTN","RCRJRCO1",182,0)
 ;  this line of code will prevent duplicate counts if a sites cross
"RTN","RCRJRCO1",183,0)
 ;  references in file 430 (actdt and asdt) are duplicated (incorrect)
"RTN","RCRJRCO1",184,0)
 ;I CRITER2<13,$D(^TMP($J,"RCRJRCOL","COUNT",BILLDA,CRITER2)) Q
"RTN","RCRJRCO1",185,0)
 I CRITER2<15,$D(^TMP($J,"RCRJRCOL","COUNT",BILLDA,CRITER2)) Q
"RTN","RCRJRCO1",186,0)
 ;
"RTN","RCRJRCO1",187,0)
 ;  get a bills criteria 1,3,4,5
"RTN","RCRJRCO1",188,0)
 S CRITERIA=$G(^TMP($J,"RCRJRCOL","CRITERIA",BILLDA))
"RTN","RCRJRCO1",189,0)
 I CRITERIA="" S CRITERIA=$$CRITERIA^RCRJRCOL(BILLDA),^TMP($J,"RCRJRCOL","CRITERIA",BILLDA)=CRITERIA
"RTN","RCRJRCO1",190,0)
 ;
"RTN","RCRJRCO1",191,0)
 ;  store for ndb
"RTN","RCRJRCO1",192,0)
 S $P(CRITERIA,"-",2)=CRITER2
"RTN","RCRJRCO1",193,0)
 ;
"RTN","RCRJRCO1",194,0)
 ;  store results for ndb
"RTN","RCRJRCO1",195,0)
 S %=$G(@DATASTOR)
"RTN","RCRJRCO1",196,0)
 S $P(%,"^")=$P(%,"^")+1
"RTN","RCRJRCO1",197,0)
 S $P(%,"^",2)=$P(%,"^",2)+AMOUNT
"RTN","RCRJRCO1",198,0)
 S $P(%,"^",3)=$P(%,"^",3)+INTEREST
"RTN","RCRJRCO1",199,0)
 S @DATASTOR=%
"RTN","RCRJRCO1",200,0)
 ;
"RTN","RCRJRCO1",201,0)
 ;  keep a count of which category (criter2) a bill is counted in
"RTN","RCRJRCO1",202,0)
 S ^TMP($J,"RCRJRCOL","COUNT",BILLDA,CRITER2)=""
"RTN","RCRJRCO1",203,0)
 S ^TMP($J,"RCRJRCOL","CRIT2",CRITER2,BILLDA)=""
"RTN","RCRJRCO1",204,0)
 ;
"RTN","RCRJRCO1",205,0)
 ;  pick up bills with activity which may not have been picked up as
"RTN","RCRJRCO1",206,0)
 ;  a current receivable because of the wrong status date
"RTN","RCRJRCO1",207,0)
 ;I CRITER2>13,CRITER2'=17,'$D(^TMP($J,"RCRJRCOL","COUNT",BILLDA,1)),'$D(^TMP($J,"RCRJRCOL","COUNT",BILLDA,17)) D CURRENT^RCRJRCOB(BILLDA,DATEEND,AYEAROLD)
"RTN","RCRJRCO1",208,0)
 I CRITER2>15,CRITER2'=19,'$D(^TMP($J,"RCRJRCOL","COUNT",BILLDA,1)),'$D(^TMP($J,"RCRJRCOL","COUNT",BILLDA,19)) D CURRENT^RCRJRCOB(BILLDA,DATEEND,AYEAROLD)
"RTN","RCRJRCO1",209,0)
 Q
"RTN","RCRJRCOB")
0^10^B22540099^B22183979
"RTN","RCRJRCOB",1,0)
RCRJRCOB ;WISC/RFJ-calculate a bills balance ;1 Mar 97
"RTN","RCRJRCOB",2,0)
 ;;4.5;Accounts Receivable;**68,96,103,153,156,320,340**;Mar 20, 1995;Build 9
"RTN","RCRJRCOB",3,0)
 ;;Per VA Directive 6402, this routine should not be modified.
"RTN","RCRJRCOB",4,0)
 Q
"RTN","RCRJRCOB",5,0)
 ;
"RTN","RCRJRCOB",6,0)
 ;
"RTN","RCRJRCOB",7,0)
BILLBAL(BILLDA,DATEEND) ;  find bills balance on dateend
"RTN","RCRJRCOB",8,0)
 ;  returns principal ^ interest ^ admin ^ mf ^ cc
"RTN","RCRJRCOB",9,0)
 N ACTDATE,ADMIN,CC,DATA1,DATA7,INTEREST,LASTTRAN,MF,PRINBAL,TRANDA,TYPE,VALUE
"RTN","RCRJRCOB",10,0)
 ;
"RTN","RCRJRCOB",11,0)
 ;  bill activated after dateend
"RTN","RCRJRCOB",12,0)
 S ACTDATE=$P($P($G(^PRCA(430,BILLDA,6)),"^",21),".")
"RTN","RCRJRCOB",13,0)
 I 'ACTDATE!(ACTDATE>DATEEND) Q "^^^^"
"RTN","RCRJRCOB",14,0)
 ;
"RTN","RCRJRCOB",15,0)
 ;  this lock cannot fail and must be executed to prevent bill
"RTN","RCRJRCOB",16,0)
 ;  activity during the calculation of the bills balance
"RTN","RCRJRCOB",17,0)
 F  L +^PRCA(430,BILLDA):$S($G(DILOCKTM)>5:DILOCKTM,1:5) Q:$T  H 2
"RTN","RCRJRCOB",18,0)
 ;
"RTN","RCRJRCOB",19,0)
 ;  try and find last 433 transaction
"RTN","RCRJRCOB",20,0)
 S LASTTRAN=999999999999 F  S LASTTRAN=$O(^PRCA(433,"C",BILLDA,LASTTRAN),-1) Q:'LASTTRAN  S DATA1=$G(^PRCA(433,LASTTRAN,1)) I $P($P(DATA1,"^",9),".")'>DATEEND,$P(DATA1,"^",2)'=45 Q
"RTN","RCRJRCOB",21,0)
 ;
"RTN","RCRJRCOB",22,0)
 ;  there are no transactions in file 433
"RTN","RCRJRCOB",23,0)
 I 'LASTTRAN  D  G UNLOCK
"RTN","RCRJRCOB",24,0)
 .   S PRINBAL=+$P($G(^PRCA(430,BILLDA,0)),"^",3)
"RTN","RCRJRCOB",25,0)
 .   S (INTEREST,ADMIN,MF,CC)=0
"RTN","RCRJRCOB",26,0)
 ;
"RTN","RCRJRCOB",27,0)
 ;  the last transaction may not be in date order
"RTN","RCRJRCOB",28,0)
 S TRANDA=LASTTRAN F  S TRANDA=$O(^PRCA(433,"C",BILLDA,TRANDA)) Q:'TRANDA  I $P($P($G(^PRCA(433,TRANDA,1)),"^",9),".")'>DATEEND S LASTTRAN=TRANDA
"RTN","RCRJRCOB",29,0)
 ;
"RTN","RCRJRCOB",30,0)
 ;  the last transaction was during time period, use bill balance
"RTN","RCRJRCOB",31,0)
 I '$O(^PRCA(433,"C",BILLDA,LASTTRAN)) D  G UNLOCK
"RTN","RCRJRCOB",32,0)
 .   S DATA7=$G(^PRCA(430,BILLDA,7))
"RTN","RCRJRCOB",33,0)
 .   S PRINBAL=+$P(DATA7,"^")
"RTN","RCRJRCOB",34,0)
 .   S INTEREST=+$P(DATA7,"^",2)
"RTN","RCRJRCOB",35,0)
 .   S ADMIN=$P(DATA7,"^",3)
"RTN","RCRJRCOB",36,0)
 .   S MF=$P(DATA7,"^",4)
"RTN","RCRJRCOB",37,0)
 .   S CC=$P(DATA7,"^",5)
"RTN","RCRJRCOB",38,0)
 ;
"RTN","RCRJRCOB",39,0)
 ;  calculate balance
"RTN","RCRJRCOB",40,0)
 S DATA7=$G(^PRCA(430,BILLDA,7))
"RTN","RCRJRCOB",41,0)
 S PRINBAL=+$P(DATA7,"^")
"RTN","RCRJRCOB",42,0)
 S INTEREST=+$P(DATA7,"^",2)
"RTN","RCRJRCOB",43,0)
 S ADMIN=$P(DATA7,"^",3)
"RTN","RCRJRCOB",44,0)
 S MF=$P(DATA7,"^",4)
"RTN","RCRJRCOB",45,0)
 S CC=$P(DATA7,"^",5)
"RTN","RCRJRCOB",46,0)
 ;
"RTN","RCRJRCOB",47,0)
 ;  if the bill's status is write-off, balance and int = 0
"RTN","RCRJRCOB",48,0)
 I $P($G(^PRCA(430,BILLDA,0)),"^",8)=23 S (PRINBAL,INTEREST,ADMIN,MF,CC)=0
"RTN","RCRJRCOB",49,0)
 ;
"RTN","RCRJRCOB",50,0)
 S TRANDA=LASTTRAN
"RTN","RCRJRCOB",51,0)
 F  S TRANDA=$O(^PRCA(433,"C",BILLDA,TRANDA)) Q:'TRANDA  I $P($G(^PRCA(433,TRANDA,0)),"^",4)=2 D
"RTN","RCRJRCOB",52,0)
 .   S VALUE=$$TRANBAL^RCRJRCOT(TRANDA) I VALUE="" Q
"RTN","RCRJRCOB",53,0)
 .   ;
"RTN","RCRJRCOB",54,0)
 .   S TYPE=$P($G(^PRCA(433,TRANDA,1)),"^",2)
"RTN","RCRJRCOB",55,0)
 .   I TYPE=1!(TYPE=12)!(TYPE=13)!(TYPE=43)!(TYPE=73)!(TYPE=74) D  Q     ; *340 added 73 and 74
"RTN","RCRJRCOB",56,0)
 .   .   S PRINBAL=PRINBAL-$P(VALUE,"^")
"RTN","RCRJRCOB",57,0)
 .   .   S INTEREST=INTEREST-$P(VALUE,"^",2)
"RTN","RCRJRCOB",58,0)
 .   .   S ADMIN=ADMIN-$P(VALUE,"^",3)
"RTN","RCRJRCOB",59,0)
 .   .   S MF=MF-$P(VALUE,"^",4)
"RTN","RCRJRCOB",60,0)
 .   .   S CC=CC-$P(VALUE,"^",5)
"RTN","RCRJRCOB",61,0)
 .   I TYPE=2!(TYPE=8)!(TYPE=9)!(TYPE=10)!(TYPE=11)!(TYPE=14)!(TYPE=29)!(TYPE=34)!(TYPE=35)!(TYPE=41) D  Q
"RTN","RCRJRCOB",62,0)
 .   .   S PRINBAL=PRINBAL+$P(VALUE,"^")
"RTN","RCRJRCOB",63,0)
 .   .   S INTEREST=INTEREST+$P(VALUE,"^",2)
"RTN","RCRJRCOB",64,0)
 .   .   S ADMIN=ADMIN+$P(VALUE,"^",3)
"RTN","RCRJRCOB",65,0)
 .   .   S MF=MF+$P(VALUE,"^",4)
"RTN","RCRJRCOB",66,0)
 .   .   S CC=CC+$P(VALUE,"^",5)
"RTN","RCRJRCOB",67,0)
 ;
"RTN","RCRJRCOB",68,0)
 ;  do not allow balances to be negative
"RTN","RCRJRCOB",69,0)
 I PRINBAL<0 S PRINBAL=0
"RTN","RCRJRCOB",70,0)
 ;  for transaction type 2,11,16, admin could not be broken out separate
"RTN","RCRJRCOB",71,0)
 ;  if its negative, add it to interest
"RTN","RCRJRCOB",72,0)
 I ADMIN<0 S INTEREST=INTEREST+ADMIN,ADMIN=0
"RTN","RCRJRCOB",73,0)
 I INTEREST<0 S ADMIN=ADMIN+INTEREST,INTEREST=0
"RTN","RCRJRCOB",74,0)
 ;
"RTN","RCRJRCOB",75,0)
UNLOCK ;  come here to unlock global and return results  
"RTN","RCRJRCOB",76,0)
 L -^PRCA(430,BILLDA)
"RTN","RCRJRCOB",77,0)
 ;
"RTN","RCRJRCOB",78,0)
 Q PRINBAL_"^"_INTEREST_"^"_ADMIN_"^"_MF_"^"_CC
"RTN","RCRJRCOB",79,0)
 ;
"RTN","RCRJRCOB",80,0)
 ;
"RTN","RCRJRCOB",81,0)
CURRENT(BILLDA,DATEEND,AYEAROLD) ; finds a bills balance and age
"RTN","RCRJRCOB",82,0)
 N DA,DATA4,COUNTCUR,CURRAMT,FUTURAMT,INTEREST,NONCURR,PRINBAL,RCVALUE,TOTREPAY
"RTN","RCRJRCOB",83,0)
 ;
"RTN","RCRJRCOB",84,0)
 ;  find a bills balance
"RTN","RCRJRCOB",85,0)
 S RCVALUE=$$BILLBAL(BILLDA,DATEEND)
"RTN","RCRJRCOB",86,0)
 ;
"RTN","RCRJRCOB",87,0)
 ;  count as a current receivable
"RTN","RCRJRCOB",88,0)
 D CURRENT^RCRJRCOC(BILLDA,RCVALUE)
"RTN","RCRJRCOB",89,0)
 ;
"RTN","RCRJRCOB",90,0)
 S PRINBAL=$P(RCVALUE,"^"),INTEREST=$P(RCVALUE,"^",2)+$P(RCVALUE,"^",3)+$P(RCVALUE,"^",4)+$P(RCVALUE,"^",5)
"RTN","RCRJRCOB",91,0)
 ;  if no repay plan date or its greater than date range or no amt due
"RTN","RCRJRCOB",92,0)
 S DATA4=$G(^PRCA(430,BILLDA,4))
"RTN","RCRJRCOB",93,0)
 I '$P(DATA4,"^")!($P($P(DATA4,"^"),".")>DATEEND)!('$P(DATA4,"^",3)) D SETTOTAL^RCRJRCO1(2,PRINBAL,INTEREST),AGE Q
"RTN","RCRJRCOB",94,0)
 ;
"RTN","RCRJRCOB",95,0)
 ;  total number of repayment due dates
"RTN","RCRJRCOB",96,0)
 S TOTREPAY=$P($G(^PRCA(430,BILLDA,5,0)),"^",3)
"RTN","RCRJRCOB",97,0)
 I 'TOTREPAY D SETTOTAL^RCRJRCO1(2,PRINBAL,INTEREST),AGE Q
"RTN","RCRJRCOB",98,0)
 ;
"RTN","RCRJRCOB",99,0)
 ;  count the number of current repayments (less than yr old)
"RTN","RCRJRCOB",100,0)
 S DA=0 F COUNTCUR=0:1 S DA=$O(^PRCA(430,BILLDA,5,DA)) Q:'DA!($P($G(^(DA,0)),"^")>AYEAROLD)
"RTN","RCRJRCOB",101,0)
 ;
"RTN","RCRJRCOB",102,0)
 ;  how many repayments are non-current
"RTN","RCRJRCOB",103,0)
 S NONCURR=TOTREPAY-COUNTCUR
"RTN","RCRJRCOB",104,0)
 ;  all are current
"RTN","RCRJRCOB",105,0)
 I 'NONCURR D SETTOTAL^RCRJRCO1(2,PRINBAL,INTEREST),AGE Q
"RTN","RCRJRCOB",106,0)
 ;
"RTN","RCRJRCOB",107,0)
 ;  future amount = noncurrent bills * repayment amount due
"RTN","RCRJRCOB",108,0)
 S FUTURAMT=NONCURR*$P(DATA4,"^",3),CURRAMT=PRINBAL-FUTURAMT
"RTN","RCRJRCOB",109,0)
 ;  no current amt (all future)
"RTN","RCRJRCOB",110,0)
 ;I 'CURRAMT D SETTOTAL^RCRJRCO1(12,FUTURAMT,INTEREST),AGE Q
"RTN","RCRJRCOB",111,0)
 ; PRCA*4.5*320 - FY16 HAPE RRE (TROR)changes to buckets as per buckets added incrimented the CRITER2 IENS
"RTN","RCRJRCOB",112,0)
 I 'CURRAMT D SETTOTAL^RCRJRCO1(14,FUTURAMT,INTEREST),AGE Q
"RTN","RCRJRCOB",113,0)
 ;
"RTN","RCRJRCOB",114,0)
 D SETTOTAL^RCRJRCO1(2,CURRAMT,INTEREST)
"RTN","RCRJRCOB",115,0)
 ;D SETTOTAL^RCRJRCO1(12,FUTURAMT,0)
"RTN","RCRJRCOB",116,0)
 ;PRCA*4.5*320 - FY16 HAPE RRE (TROR) changes to buckets as per buckets added incrimented the CRITER2 IENS
"RTN","RCRJRCOB",117,0)
 D SETTOTAL^RCRJRCO1(14,FUTURAMT,0)
"RTN","RCRJRCOB",118,0)
 D AGE
"RTN","RCRJRCOB",119,0)
 Q
"RTN","RCRJRCOB",120,0)
 ;
"RTN","RCRJRCOB",121,0)
 ;
"RTN","RCRJRCOB",122,0)
AGE ;  finds the age of delinquents
"RTN","RCRJRCOB",123,0)
 ;  the date the 2nd letter was sent
"RTN","RCRJRCOB",124,0)
 N DAYSDIFF,LETRDATE
"RTN","RCRJRCOB",125,0)
 S LETRDATE=$P($P($G(^PRCA(430,BILLDA,6)),"^",2),".")
"RTN","RCRJRCOB",126,0)
 I 'LETRDATE!(LETRDATE>DATEEND) Q
"RTN","RCRJRCOB",127,0)
 ;
"RTN","RCRJRCOB",128,0)
 S DAYSDIFF=$$FMDIFF^XLFDT(DATEEND,LETRDATE,1)
"RTN","RCRJRCOB",129,0)
 ;  pass criteria 2 based on days difference
"RTN","RCRJRCOB",130,0)
 ;PRCA*4.5*320 FY16 HAPE RRE (TROR); reset aging buckets which adds two buckets, requiring adjustments in multiple instances
"RTN","RCRJRCOB",131,0)
 ;            3  DELINQUENT 1 - 30 Days
"RTN","RCRJRCOB",132,0)
 ;            4  DELINQUENT 31 - 60 Days
"RTN","RCRJRCOB",133,0)
 ;            5  DELINQUENT 61 - 90 Days
"RTN","RCRJRCOB",134,0)
 ;            6  DELINQUENT 91 - 120 Days
"RTN","RCRJRCOB",135,0)
 ;            7  DELINQUENT 121 - 150 Days
"RTN","RCRJRCOB",136,0)
 ;            8  DELINQUENT 151 - 180 Days
"RTN","RCRJRCOB",137,0)
 ;            9  DELINQUENT 181 - 365 Days
"RTN","RCRJRCOB",138,0)
 ;           10  DELINQUENT 1 - 2 Years
"RTN","RCRJRCOB",139,0)
 ;           11  DELINQUENT 2 - 6 Years
"RTN","RCRJRCOB",140,0)
 ;           12  DELINQUENT 6 - 10 Years
"RTN","RCRJRCOB",141,0)
 ;           13  DELINQUENT Over 10 Years
"RTN","RCRJRCOB",142,0)
 ;D SETTOTAL^RCRJRCO1($S(DAYSDIFF<31:3,DAYSDIFF<61:4,DAYSDIFF<91:5,DAYSDIFF<121:6,DAYSDIFF<181:7,DAYSDIFF<366:8,DAYSDIFF<731:9,DAYSDIFF<1096:10,1:11),PRINBAL,INTEREST)
"RTN","RCRJRCOB",143,0)
 D SETTOTAL^RCRJRCO1($S(DAYSDIFF<31:3,DAYSDIFF<61:4,DAYSDIFF<91:5,DAYSDIFF<121:6,DAYSDIFF<151:7,DAYSDIFF<181:8,DAYSDIFF<366:9,DAYSDIFF<731:10,DAYSDIFF<2193:11,DAYSDIFF<3655:12,1:13),PRINBAL,INTEREST)
"RTN","RCRJRCOB",144,0)
 Q
"RTN","RCRJRCOT")
0^7^B16117128^B15500184
"RTN","RCRJRCOT",1,0)
RCRJRCOT ;WISC/RFJ-calculate a transactions balance ;1 Mar 97
"RTN","RCRJRCOT",2,0)
 ;;4.5;Accounts Receivable;**68,134,103,153,168,340**;Mar 20, 1995;Build 9
"RTN","RCRJRCOT",3,0)
 ;;Per VA Directive 6402, this routine should not be modified.
"RTN","RCRJRCOT",4,0)
 Q
"RTN","RCRJRCOT",5,0)
 ;
"RTN","RCRJRCOT",6,0)
 ;
"RTN","RCRJRCOT",7,0)
TRANBAL(TRANDA)    ;  gets a transactions balance
"RTN","RCRJRCOT",8,0)
 ;  returns principal ^ interest ^ admin cost ^ mf ^ cc
"RTN","RCRJRCOT",9,0)
 N ADMIN,COURT,DATA1,DATA2,DATA3,DATA8,INTEREST,MARSHAL,PRINBAL,TRANTYPE
"RTN","RCRJRCOT",10,0)
 ;  transaction not valid
"RTN","RCRJRCOT",11,0)
 I '$$VALID(TRANDA) Q ""
"RTN","RCRJRCOT",12,0)
 S DATA1=$G(^PRCA(433,TRANDA,1))
"RTN","RCRJRCOT",13,0)
 S PRINBAL=$P(DATA1,"^",5),INTEREST="",ADMIN="",MARSHAL="",COURT=""
"RTN","RCRJRCOT",14,0)
 ;
"RTN","RCRJRCOT",15,0)
 S TRANTYPE=+$P(DATA1,"^",2)
"RTN","RCRJRCOT",16,0)
 I $T(@TRANTYPE)'="" D @TRANTYPE
"RTN","RCRJRCOT",17,0)
 ;
"RTN","RCRJRCOT",18,0)
 Q PRINBAL_"^"_INTEREST_"^"_ADMIN_"^"_MARSHAL_"^"_COURT
"RTN","RCRJRCOT",19,0)
 ;
"RTN","RCRJRCOT",20,0)
 ;
"RTN","RCRJRCOT",21,0)
 ;
"RTN","RCRJRCOT",22,0)
 ;
"RTN","RCRJRCOT",23,0)
1 ;  increase adjustment
"RTN","RCRJRCOT",24,0)
 S PRINBAL=+$P(DATA1,"^",5),(INTEREST,ADMIN,MARSHAL,COURT)=""
"RTN","RCRJRCOT",25,0)
 Q
"RTN","RCRJRCOT",26,0)
 ;
"RTN","RCRJRCOT",27,0)
 ;
"RTN","RCRJRCOT",28,0)
2 ;  payment
"RTN","RCRJRCOT",29,0)
 S DATA3=$G(^PRCA(433,TRANDA,3))
"RTN","RCRJRCOT",30,0)
 S PRINBAL=+$P(DATA3,"^")
"RTN","RCRJRCOT",31,0)
 S INTEREST=+$P(DATA3,"^",2)
"RTN","RCRJRCOT",32,0)
 S ADMIN=+$P(DATA3,"^",3)
"RTN","RCRJRCOT",33,0)
 S MARSHAL=+$P(DATA3,"^",4)
"RTN","RCRJRCOT",34,0)
 S COURT=+$P(DATA3,"^",5)
"RTN","RCRJRCOT",35,0)
 Q
"RTN","RCRJRCOT",36,0)
 ;
"RTN","RCRJRCOT",37,0)
 ;
"RTN","RCRJRCOT",38,0)
3 ;  refer to district counsel
"RTN","RCRJRCOT",39,0)
 S PRINBAL=+$P(DATA1,"^",5),(INTEREST,ADMIN,MARSHAL,COURT)=""
"RTN","RCRJRCOT",40,0)
 Q
"RTN","RCRJRCOT",41,0)
 ;
"RTN","RCRJRCOT",42,0)
 ;
"RTN","RCRJRCOT",43,0)
8 ;  terminate by fiscal officer
"RTN","RCRJRCOT",44,0)
 S DATA8=$G(^PRCA(433,TRANDA,8))
"RTN","RCRJRCOT",45,0)
 S PRINBAL=+$P(DATA8,"^")
"RTN","RCRJRCOT",46,0)
 S INTEREST=+$P(DATA8,"^",2)
"RTN","RCRJRCOT",47,0)
 S ADMIN=+$P(DATA8,"^",3)
"RTN","RCRJRCOT",48,0)
 S MARSHAL=+$P(DATA8,"^",4)
"RTN","RCRJRCOT",49,0)
 S COURT=+$P(DATA8,"^",5)
"RTN","RCRJRCOT",50,0)
 ;
"RTN","RCRJRCOT",51,0)
 ;  if data8 node not defined, lookup on bill
"RTN","RCRJRCOT",52,0)
 ;  once patch 146 gets out, this can be removed
"RTN","RCRJRCOT",53,0)
 I $TR($P(DATA8,"^",1,5),"^0")="" D
"RTN","RCRJRCOT",54,0)
 .   N BILLDA,DATA7
"RTN","RCRJRCOT",55,0)
 .   S BILLDA=+$P(^PRCA(433,TRANDA,0),"^",2)
"RTN","RCRJRCOT",56,0)
 .   S DATA7=$P($G(^PRCA(430,BILLDA,7)),"^",1,5)
"RTN","RCRJRCOT",57,0)
 .   S PRINBAL=+$P(DATA7,"^")
"RTN","RCRJRCOT",58,0)
 .   S INTEREST=+$P(DATA7,"^",2)
"RTN","RCRJRCOT",59,0)
 .   S ADMIN=+$P(DATA7,"^",3)
"RTN","RCRJRCOT",60,0)
 .   S MARSHAL=+$P(DATA7,"^",4)
"RTN","RCRJRCOT",61,0)
 .   S COURT=+$P(DATA7,"^",5)
"RTN","RCRJRCOT",62,0)
 Q
"RTN","RCRJRCOT",63,0)
 ;
"RTN","RCRJRCOT",64,0)
 ;
"RTN","RCRJRCOT",65,0)
9 ;  terminate by compromise
"RTN","RCRJRCOT",66,0)
 D 8
"RTN","RCRJRCOT",67,0)
 Q
"RTN","RCRJRCOT",68,0)
 ;
"RTN","RCRJRCOT",69,0)
 ;
"RTN","RCRJRCOT",70,0)
10 ;  payment waived in full
"RTN","RCRJRCOT",71,0)
 D 8
"RTN","RCRJRCOT",72,0)
 Q
"RTN","RCRJRCOT",73,0)
 ;
"RTN","RCRJRCOT",74,0)
 ;
"RTN","RCRJRCOT",75,0)
11 ;  payment waived in partial
"RTN","RCRJRCOT",76,0)
 D 8
"RTN","RCRJRCOT",77,0)
 Q
"RTN","RCRJRCOT",78,0)
 ;
"RTN","RCRJRCOT",79,0)
 ;
"RTN","RCRJRCOT",80,0)
12 ;  admin cost / charge
"RTN","RCRJRCOT",81,0)
 S DATA2=$G(^PRCA(433,TRANDA,2))
"RTN","RCRJRCOT",82,0)
 S PRINBAL=""
"RTN","RCRJRCOT",83,0)
 S INTEREST=+$P(DATA2,"^",7)
"RTN","RCRJRCOT",84,0)
 S ADMIN=$P(DATA2,"^")+$P(DATA2,"^",2)+$P(DATA2,"^",3)+$P(DATA2,"^",4)+$P(DATA2,"^",8)+$P(DATA2,"^",9)
"RTN","RCRJRCOT",85,0)
 S MARSHAL=+$P(DATA2,"^",5)
"RTN","RCRJRCOT",86,0)
 S COURT=+$P(DATA2,"^",6)
"RTN","RCRJRCOT",87,0)
 Q
"RTN","RCRJRCOT",88,0)
 ;
"RTN","RCRJRCOT",89,0)
 ;
"RTN","RCRJRCOT",90,0)
13 ;  interest / admin charge
"RTN","RCRJRCOT",91,0)
 D 12
"RTN","RCRJRCOT",92,0)
 Q
"RTN","RCRJRCOT",93,0)
 ;
"RTN","RCRJRCOT",94,0)
 ;
"RTN","RCRJRCOT",95,0)
14 ;  exempt interest / admin cost
"RTN","RCRJRCOT",96,0)
 S PRINBAL=""
"RTN","RCRJRCOT",97,0)
 S DATA2=$G(^PRCA(433,TRANDA,2))
"RTN","RCRJRCOT",98,0)
 S INTEREST=$P(DATA2,"^",7)
"RTN","RCRJRCOT",99,0)
 S ADMIN=$P(DATA2,"^")+$P(DATA2,"^",2)+$P(DATA2,"^",3)+$P(DATA2,"^",4)+$P(DATA2,"^",8)+$P(DATA2,"^",9)
"RTN","RCRJRCOT",100,0)
 S MARSHAL=+$P(DATA2,"^",5)
"RTN","RCRJRCOT",101,0)
 S COURT=+$P(DATA2,"^",6)
"RTN","RCRJRCOT",102,0)
 ;  prior to patch 103, exempt interest and admin charges could
"RTN","RCRJRCOT",103,0)
 ;  not be broken out
"RTN","RCRJRCOT",104,0)
 I (INTEREST+ADMIN+MARSHAL+COURT)'=$P(DATA1,"^",5) S INTEREST=$P(DATA1,"^",5),ADMIN="",MARSHAL="",COURT=""
"RTN","RCRJRCOT",105,0)
 Q
"RTN","RCRJRCOT",106,0)
 ;
"RTN","RCRJRCOT",107,0)
 ;
"RTN","RCRJRCOT",108,0)
29 ;  terminate by rc/doj
"RTN","RCRJRCOT",109,0)
 D 8
"RTN","RCRJRCOT",110,0)
 Q
"RTN","RCRJRCOT",111,0)
 ;
"RTN","RCRJRCOT",112,0)
 ;
"RTN","RCRJRCOT",113,0)
34 ;  payment in full
"RTN","RCRJRCOT",114,0)
 D 2
"RTN","RCRJRCOT",115,0)
 Q
"RTN","RCRJRCOT",116,0)
 ;
"RTN","RCRJRCOT",117,0)
 ;
"RTN","RCRJRCOT",118,0)
35 ;  decrease adjustment
"RTN","RCRJRCOT",119,0)
 S PRINBAL=+$P(DATA1,"^",5),(INTEREST,ADMIN,MARSHAL,COURT)=""
"RTN","RCRJRCOT",120,0)
 ;  make negative amounts positive
"RTN","RCRJRCOT",121,0)
 I PRINBAL<0 S PRINBAL=-PRINBAL
"RTN","RCRJRCOT",122,0)
 Q
"RTN","RCRJRCOT",123,0)
 ;
"RTN","RCRJRCOT",124,0)
 ;
"RTN","RCRJRCOT",125,0)
41 ;  refund
"RTN","RCRJRCOT",126,0)
 S PRINBAL=+$P(DATA1,"^",5),(INTEREST,ADMIN,MARSHAL,COURT)=""
"RTN","RCRJRCOT",127,0)
 ;  make negative amounts positive
"RTN","RCRJRCOT",128,0)
 I PRINBAL<0 S PRINBAL=-PRINBAL
"RTN","RCRJRCOT",129,0)
 Q
"RTN","RCRJRCOT",130,0)
 ;
"RTN","RCRJRCOT",131,0)
 ;
"RTN","RCRJRCOT",132,0)
43 ;  re-establishment
"RTN","RCRJRCOT",133,0)
 S DATA8=$G(^PRCA(433,TRANDA,8))
"RTN","RCRJRCOT",134,0)
 S PRINBAL=+$P(DATA8,"^")
"RTN","RCRJRCOT",135,0)
 S INTEREST=+$P(DATA8,"^",2)
"RTN","RCRJRCOT",136,0)
 S ADMIN=+$P(DATA8,"^",3)
"RTN","RCRJRCOT",137,0)
 S MARSHAL=+$P(DATA8,"^",4)
"RTN","RCRJRCOT",138,0)
 S COURT=+$P(DATA8,"^",5)
"RTN","RCRJRCOT",139,0)
 Q
"RTN","RCRJRCOT",140,0)
 ;
"RTN","RCRJRCOT",141,0)
 ;
"RTN","RCRJRCOT",142,0)
46 ;  unsuspended
"RTN","RCRJRCOT",143,0)
 S DATA8=$G(^PRCA(433,TRANDA,8))
"RTN","RCRJRCOT",144,0)
 S PRINBAL=+$P(DATA8,"^")
"RTN","RCRJRCOT",145,0)
 S INTEREST=+$P(DATA8,"^",2)
"RTN","RCRJRCOT",146,0)
 S ADMIN=+$P(DATA8,"^",3)
"RTN","RCRJRCOT",147,0)
 S MARSHAL=+$P(DATA8,"^",4)
"RTN","RCRJRCOT",148,0)
 S COURT=+$P(DATA8,"^",5)
"RTN","RCRJRCOT",149,0)
 Q
"RTN","RCRJRCOT",150,0)
 ;
"RTN","RCRJRCOT",151,0)
 ;
"RTN","RCRJRCOT",152,0)
47 ;  suspended
"RTN","RCRJRCOT",153,0)
 D 46
"RTN","RCRJRCOT",154,0)
 Q
"RTN","RCRJRCOT",155,0)
 ;
"RTN","RCRJRCOT",156,0)
 ;
"RTN","RCRJRCOT",157,0)
73 ; cs increase adjustment - added with *340
"RTN","RCRJRCOT",158,0)
 D 1
"RTN","RCRJRCOT",159,0)
 Q
"RTN","RCRJRCOT",160,0)
 ;
"RTN","RCRJRCOT",161,0)
 ;
"RTN","RCRJRCOT",162,0)
74 ; cs admin.cost charge - added with *340
"RTN","RCRJRCOT",163,0)
 D 12
"RTN","RCRJRCOT",164,0)
 Q
"RTN","RCRJRCOT",165,0)
 ;
"RTN","RCRJRCOT",166,0)
 ;
"RTN","RCRJRCOT",167,0)
TRANAMT(TRANDA) ;  calculate transaction amount for transaction tranda
"RTN","RCRJRCOT",168,0)
 N %,AMT
"RTN","RCRJRCOT",169,0)
 S AMT=0
"RTN","RCRJRCOT",170,0)
 S %=0 F  S %=$O(^PRCA(433,TRANDA,4,%)) Q:'%  S AMT=AMT+$P($G(^(%,0)),"^",5)
"RTN","RCRJRCOT",171,0)
 Q AMT
"RTN","RCRJRCOT",172,0)
 ;
"RTN","RCRJRCOT",173,0)
 ;
"RTN","RCRJRCOT",174,0)
VALID(TRANDA) ;  test to see if a transaction is valid
"RTN","RCRJRCOT",175,0)
 ;  return 1 if it is, 0 if not
"RTN","RCRJRCOT",176,0)
 ;  date entered is not set (this is the processed date)
"RTN","RCRJRCOT",177,0)
 I '$P($G(^PRCA(433,TRANDA,1)),"^",9) Q 0
"RTN","RCRJRCOT",178,0)
 N DATA0
"RTN","RCRJRCOT",179,0)
 S DATA0=$G(^PRCA(433,TRANDA,0))
"RTN","RCRJRCOT",180,0)
 ;  transaction status is not complete (2)
"RTN","RCRJRCOT",181,0)
 I $P(DATA0,"^",4)'=2 Q 0
"RTN","RCRJRCOT",182,0)
 ;  incomplete transaction flag set (invalid transaction)
"RTN","RCRJRCOT",183,0)
 ;I $P(DATA0,"^",10) Q 0
"RTN","RCRJRCOT",184,0)
 Q 1
"RTN","RCRJRTR1")
0^11^B42250765^B39004257
"RTN","RCRJRTR1",1,0)
RCRJRTR1 ;WISC/RFJ-transaction report (print) ;1 Mar 97
"RTN","RCRJRTR1",2,0)
 ;;4.5;Accounts Receivable;**68,340**;Mar 20, 1995;Build 9
"RTN","RCRJRTR1",3,0)
 ;;Per VA Directive 6402, this routine should not be modified.
"RTN","RCRJRTR1",4,0)
 Q
"RTN","RCRJRTR1",5,0)
 ;
"RTN","RCRJRTR1",6,0)
 ;
"RTN","RCRJRTR1",7,0)
PRINT ;  print the report
"RTN","RCRJRTR1",8,0)
 N %I,DATA,DATEDIS1,DATEDIS2,INTTOTAL,NDB,NDBFLAG,NOW,PAGE,PRINTOTL,RCRJFLAG,RCRJLINE,SCREEN,SIGN,TOTALC,TOTALT,X,Y
"RTN","RCRJRTR1",9,0)
 ;
"RTN","RCRJRTR1",10,0)
 ;  calculate new receivables from bills and store in 43C
"RTN","RCRJRTR1",11,0)
 I $D(TRANTYPE(43)) S NDB("43C",2)=$P($$GETNEW^RCRJRCOL(DATESTRT,DATEEND,0),"^",2)
"RTN","RCRJRTR1",12,0)
 ;
"RTN","RCRJRTR1",13,0)
 S Y=$P(DATESTRT,".") D DD^%DT S DATEDIS1=Y
"RTN","RCRJRTR1",14,0)
 S Y=$P(DATEEND,".") D DD^%DT S DATEDIS2=Y
"RTN","RCRJRTR1",15,0)
 D NOW^%DTC S Y=% D DD^%DT S NOW=Y
"RTN","RCRJRTR1",16,0)
 S PAGE=1,RCRJLINE="",$P(RCRJLINE,"-",81)=""
"RTN","RCRJRTR1",17,0)
 S SCREEN=0 I '$D(ZTQUEUED),IO=IO(0),$E(IOST)="C" S SCREEN=1
"RTN","RCRJRTR1",18,0)
 U IO D H
"RTN","RCRJRTR1",19,0)
 ;
"RTN","RCRJRTR1",20,0)
 S TRANTYPE="" F  S TRANTYPE=$O(^TMP($J,"RCRJRTRA",TRANTYPE)) Q:TRANTYPE=""!($G(RCRJFLAG))  D
"RTN","RCRJRTR1",21,0)
 .   I $Y>(IOSL-6) D:SCREEN PAUSE Q:$G(RCRJFLAG)  D H
"RTN","RCRJRTR1",22,0)
 .   S TYPE=$TR(TRANTYPE," ")
"RTN","RCRJRTR1",23,0)
 .   W !!,"TRANSACTION TYPE: ",TYPE,"  ",$P($G(^PRCA(430.3,+TYPE,0)),"^")
"RTN","RCRJRTR1",24,0)
 .   I TYPE="12A"!(TYPE="74A") W "  [ADDED]"              ; *340 added 74A
"RTN","RCRJRTR1",25,0)
 .   I TYPE="12E"!(TYPE="74E") W "  [EXEMPT]"             ; *340 added 74E
"RTN","RCRJRTR1",26,0)
 .   I TYPE="35C" W "  [CONTRACTUAL ADJUSTMENTS]"
"RTN","RCRJRTR1",27,0)
 .   I TYPE="34P" W "  [PRE-PAYMENTS]"
"RTN","RCRJRTR1",28,0)
 .   ;
"RTN","RCRJRTR1",29,0)
 .   K TOTALT
"RTN","RCRJRTR1",30,0)
 .   S CATDA=0 F  S CATDA=$O(^TMP($J,"RCRJRTRA",TRANTYPE,CATDA)) Q:'CATDA!($G(RCRJFLAG))  D
"RTN","RCRJRTR1",31,0)
 .   .   I $Y>(IOSL-6) D:SCREEN PAUSE Q:$G(RCRJFLAG)  D H
"RTN","RCRJRTR1",32,0)
 .   .   W !?5,"CATEGORY: ",$E($S($L(CATDA)=1:" ",1:"")_CATDA_"  "_$P($G(^PRCA(430.2,CATDA,0)),"^"),1,20),?36
"RTN","RCRJRTR1",33,0)
 .   .   ;
"RTN","RCRJRTR1",34,0)
 .   .   K TOTALC
"RTN","RCRJRTR1",35,0)
 .   .   S BILLDA=0 F  S BILLDA=$O(^TMP($J,"RCRJRTRA",TRANTYPE,CATDA,BILLDA)) Q:'BILLDA!($G(RCRJFLAG))  D
"RTN","RCRJRTR1",36,0)
 .   .   .   ;
"RTN","RCRJRTR1",37,0)
 .   .   .   S DA=0 F  S DA=$O(^TMP($J,"RCRJRTRA",TRANTYPE,CATDA,BILLDA,DA)) Q:'DA!($G(RCRJFLAG))  S DATA=^(DA) D
"RTN","RCRJRTR1",38,0)
 .   .   .   .   I $Y>(IOSL-5) D:SCREEN PAUSE Q:$G(RCRJFLAG)  D H
"RTN","RCRJRTR1",39,0)
 .   .   .   .   I RCRJSUMM=2 W !?10,$P($G(^PRCA(430,BILLDA,0)),"^"),?28,$P($G(^PRCA(433,DA,0)),"^"),?36
"RTN","RCRJRTR1",40,0)
 .   .   .   .   F %=1:1:4 D:RCRJSUMM=2 WRITE($P(DATA,"^",%)) I $P(DATA,"^",%)'="" S TOTALC(%)=$G(TOTALC(%))+$P(DATA,"^",%)
"RTN","RCRJRTR1",41,0)
 .   .   I $G(RCRJFLAG) Q
"RTN","RCRJRTR1",42,0)
 .   .   I RCRJSUMM=2 W !?10,$E($TR(RCRJLINE,"-","."),11,80),!?10,"TOTALS FOR CATEGORY ...",?36
"RTN","RCRJRTR1",43,0)
 .   .   F %=1:1:4 D WRITE($G(TOTALC(%))) I $G(TOTALC(%))'="" S TOTALT(%)=$G(TOTALT(%))+TOTALC(%)
"RTN","RCRJRTR1",44,0)
 .   .   I $Y>(IOSL-6) D:SCREEN PAUSE Q:$G(RCRJFLAG)  D H
"RTN","RCRJRTR1",45,0)
 .   ;
"RTN","RCRJRTR1",46,0)
 .   I $G(RCRJFLAG) Q
"RTN","RCRJRTR1",47,0)
 .   W !?5,$E($TR(RCRJLINE,"-","."),6,80),!?5,"TOTALS FOR TRANSACTION TYPE ...",?36
"RTN","RCRJRTR1",48,0)
 .   F %=1:1:4 D WRITE($G(TOTALT(%))) I $G(TOTALT(%))'="" S NDB(TYPE,%)=$G(NDB(TYPE,%))+TOTALT(%)
"RTN","RCRJRTR1",49,0)
 .   I $Y>(IOSL-6) D:SCREEN PAUSE Q:$G(RCRJFLAG)  D H
"RTN","RCRJRTR1",50,0)
 ;
"RTN","RCRJRTR1",51,0)
 I $G(RCRJFLAG) Q
"RTN","RCRJRTR1",52,0)
 ;
"RTN","RCRJRTR1",53,0)
 ;  set ndbflag to change header for ndb totals (see H)
"RTN","RCRJRTR1",54,0)
 S NDBFLAG=1
"RTN","RCRJRTR1",55,0)
 D:SCREEN PAUSE Q:$G(RCRJFLAG)  D H
"RTN","RCRJRTR1",56,0)
 ;
"RTN","RCRJRTR1",57,0)
 ;  print national database totals
"RTN","RCRJRTR1",58,0)
 S PRINTOTL=0,INTTOTAL=0
"RTN","RCRJRTR1",59,0)
 W !!,"NATIONAL DATABASE TOTALS (VALUES FROM THE REPORT) ...",!
"RTN","RCRJRTR1",60,0)
 ;
"RTN","RCRJRTR1",61,0)
 ; 7/6/18 - *340 - updated the NDB bucket numbers in accordance with the changes made in patches 320 and 334
"RTN","RCRJRTR1",62,0)
 ;
"RTN","RCRJRTR1",63,0)
 D NDB(15,43,2)
"RTN","RCRJRTR1",64,0)
 D NDB(15,"43C",2)
"RTN","RCRJRTR1",65,0)
 D NDB(15,43,3)
"RTN","RCRJRTR1",66,0)
 D NDB(15,43,4)
"RTN","RCRJRTR1",67,0)
 D NDB(16,1,2),NDB(16,73,2)        ; *340 added 73 - cs increase adjustments
"RTN","RCRJRTR1",68,0)
 D NDB(18,35,2)
"RTN","RCRJRTR1",69,0)
 D NDB(20,34,2)
"RTN","RCRJRTR1",70,0)
 D NDB(21,2,2)
"RTN","RCRJRTR1",71,0)
 D NDB(22,"35C",2)
"RTN","RCRJRTR1",72,0)
 D NDB(23,"34P",2)
"RTN","RCRJRTR1",73,0)
 D NDB(24,10,2),NDB(24,10,3),NDB(24,10,4)
"RTN","RCRJRTR1",74,0)
 D NDB(25,11,2),NDB(25,11,3),NDB(25,11,4)
"RTN","RCRJRTR1",75,0)
 D NDB(26,9,2),NDB(26,9,3),NDB(26,9,4)
"RTN","RCRJRTR1",76,0)
 D NDB(27,8,2),NDB(27,8,3),NDB(27,8,4)
"RTN","RCRJRTR1",77,0)
 D NDB(40,34,3),NDB(40,"34P",3),NDB(40,2,3)
"RTN","RCRJRTR1",78,0)
 D NDB(41,34,4),NDB(41,2,4)
"RTN","RCRJRTR1",79,0)
 D NDB(42,"12A",3),NDB(42,"74A",3),NDB(42,13,3)     ; *340 added 74A and 74E - cs admin.cost charges
"RTN","RCRJRTR1",80,0)
 D NDB(43,"12A",4),NDB(43,"74A",4),NDB(43,13,4)
"RTN","RCRJRTR1",81,0)
 D NDB(44,"12E",3),NDB(44,"12E",4),NDB(44,"74E",3),NDB(44,"74E",4),NDB(44,14,3)
"RTN","RCRJRTR1",82,0)
 D NDB(45,41,2)
"RTN","RCRJRTR1",83,0)
 W !,$E(RCRJLINE,1,80),!,"BALANCE GAINS/LOSSES FOR DATE RANGE",?42,"+/-",$J(PRINTOTL,13,2),$J(INTTOTAL,11,2)
"RTN","RCRJRTR1",84,0)
 ;
"RTN","RCRJRTR1",85,0)
 W !!,"  The following formula can be used to balance the values in the national"
"RTN","RCRJRTR1",86,0)
 W !,"  database.  Note: This report must be run for the entire month and all"
"RTN","RCRJRTR1",87,0)
 W !,"  transaction types must be selected.  Also, this will only balance for"
"RTN","RCRJRTR1",88,0)
 W !,"  the months following the installation of this patch."
"RTN","RCRJRTR1",89,0)
 W !,"                                                           Principal     Int/Adm",!
"RTN","RCRJRTR1",90,0)
 W !,"Previous months receivables from NDB (category 1)    + __________.__  _______.__"
"RTN","RCRJRTR1",91,0)
 W !,"Current months gains/losses from this report       +/-",$J(PRINTOTL,14,2),$J(INTTOTAL,12,2)
"RTN","RCRJRTR1",92,0)
 W !,$E(RCRJLINE,1,80)
"RTN","RCRJRTR1",93,0)
 W !,"Current months receivables from NDB (category 1)     = __________.__  _______.__"
"RTN","RCRJRTR1",94,0)
 ;
"RTN","RCRJRTR1",95,0)
 Q
"RTN","RCRJRTR1",96,0)
 ;
"RTN","RCRJRTR1",97,0)
 ;
"RTN","RCRJRTR1",98,0)
NDB(NDBTYPE,TRANTYPE,NODE)      ;  write ndb totals and calc end total
"RTN","RCRJRTR1",99,0)
 I +$G(NDB(TRANTYPE,NODE))=0 Q
"RTN","RCRJRTR1",100,0)
 ;
"RTN","RCRJRTR1",101,0)
 W !,"(",NDBTYPE,") ",$$NDBCATEG(NDBTYPE),?36
"RTN","RCRJRTR1",102,0)
 ;
"RTN","RCRJRTR1",103,0)
 S SIGN="-"
"RTN","RCRJRTR1",104,0)
 I $F(".1.73.12A.74A.13.43.43C.46.","."_TRANTYPE_".") S SIGN="+"      ; *340 added 73 and 74A here
"RTN","RCRJRTR1",105,0)
 W $J(SIGN_"  ",11),$J($G(NDB(TRANTYPE,NODE)),$S(NODE=2:11,1:22),2)
"RTN","RCRJRTR1",106,0)
 W ?75,"(",$J(TRANTYPE,3),")"
"RTN","RCRJRTR1",107,0)
 ;
"RTN","RCRJRTR1",108,0)
 I NODE=2 S PRINTOTL=PRINTOTL+$S(SIGN="+":$G(NDB(TRANTYPE,NODE)),1:-$G(NDB(TRANTYPE,NODE)))
"RTN","RCRJRTR1",109,0)
 I NODE=3!(NODE=4) S INTTOTAL=INTTOTAL+$S(SIGN="+":$G(NDB(TRANTYPE,NODE)),1:-$G(NDB(TRANTYPE,NODE)))
"RTN","RCRJRTR1",110,0)
 Q
"RTN","RCRJRTR1",111,0)
 ;
"RTN","RCRJRTR1",112,0)
 ;
"RTN","RCRJRTR1",113,0)
NDBCATEG(NDBTYPE)  ;  return ndb category
"RTN","RCRJRTR1",114,0)
 ;
"RTN","RCRJRTR1",115,0)
 ; 7/6/18 - *340 - updated the NDB bucket numbers in accordance with the changes made in patches 320 and 334
"RTN","RCRJRTR1",116,0)
 ; 
"RTN","RCRJRTR1",117,0)
 I NDBTYPE=15 Q "NEW RECEIVABLES"
"RTN","RCRJRTR1",118,0)
 I NDBTYPE=16 Q "TOTAL INCREASE ADJUSTMENTS"
"RTN","RCRJRTR1",119,0)
 I NDBTYPE=18 Q "TOTAL DECREASE ADJUSTMENTS"
"RTN","RCRJRTR1",120,0)
 I NDBTYPE=20 Q "COLLECTIONS - FULL PAYMENT"
"RTN","RCRJRTR1",121,0)
 I NDBTYPE=21 Q "COLLECTIONS - PART PAYMENT"
"RTN","RCRJRTR1",122,0)
 I NDBTYPE=22 Q "COLLECTIONS - CONTRACT ADJ"
"RTN","RCRJRTR1",123,0)
 I NDBTYPE=23 Q "COLLECTIONS - PREPAYMENTS"
"RTN","RCRJRTR1",124,0)
 I NDBTYPE=24 Q "COLLECTIONS - WAIVED IN FULL"
"RTN","RCRJRTR1",125,0)
 I NDBTYPE=25 Q "COLLECTIONS - WAIVED IN PART"
"RTN","RCRJRTR1",126,0)
 I NDBTYPE=26 Q "COLLECTIONS - TERM COMPROMISE"
"RTN","RCRJRTR1",127,0)
 I NDBTYPE=27 Q "COLLECTIONS - TERM FISCAL OFF"
"RTN","RCRJRTR1",128,0)
 I NDBTYPE=40 Q "COLLECTIONS - INTEREST"
"RTN","RCRJRTR1",129,0)
 I NDBTYPE=41 Q "COLLECTIONS - ADMIN"
"RTN","RCRJRTR1",130,0)
 I NDBTYPE=42 Q "INTEREST ADDED"
"RTN","RCRJRTR1",131,0)
 I NDBTYPE=43 Q "ADMINISTRATIVE COST ADDED"
"RTN","RCRJRTR1",132,0)
 I NDBTYPE=44 Q "INTEREST/ADMIN COST EXEMPT"
"RTN","RCRJRTR1",133,0)
 I NDBTYPE=45 Q "REFUNDS"
"RTN","RCRJRTR1",134,0)
 Q "UNKNOWN"
"RTN","RCRJRTR1",135,0)
 ;
"RTN","RCRJRTR1",136,0)
 ;
"RTN","RCRJRTR1",137,0)
WRITE(VALUE)       ;  write value
"RTN","RCRJRTR1",138,0)
 I VALUE="" W $J(VALUE,11) Q
"RTN","RCRJRTR1",139,0)
 W $J(VALUE,11,2)
"RTN","RCRJRTR1",140,0)
 Q
"RTN","RCRJRTR1",141,0)
 ;
"RTN","RCRJRTR1",142,0)
 ;
"RTN","RCRJRTR1",143,0)
PAUSE ;  pause at end of page
"RTN","RCRJRTR1",144,0)
 N X U IO(0) W !,"Press RETURN to continue, '^' to exit:" R X:DTIME S:'$T X="^" S:X["^" RCRJFLAG=1 U IO Q
"RTN","RCRJRTR1",145,0)
 ;
"RTN","RCRJRTR1",146,0)
 ;
"RTN","RCRJRTR1",147,0)
H ;  header
"RTN","RCRJRTR1",148,0)
 S %=NOW_"  PAGE "_PAGE,PAGE=PAGE+1 I PAGE'=2!(SCREEN) W @IOF
"RTN","RCRJRTR1",149,0)
 W $C(13),"AR TRANSACTION LISTING REPORT",?(80-$L(%)),%
"RTN","RCRJRTR1",150,0)
 W !,"  FOR THE DATE RANGE: ",DATEDIS1,"  TO  ",DATEDIS2,?65,$J("TYPE: "_$S(RCRJSUMM=1:"SUMMARY",1:"DETAILED"),15)
"RTN","RCRJRTR1",151,0)
 ;
"RTN","RCRJRTR1",152,0)
 I '$G(NDBFLAG) W !?26,$J("TRANSACTION AMOUNT",21),$J("PRINCIPAL",11),$J("INTEREST",11),$J("ADMIN",11)
"RTN","RCRJRTR1",153,0)
 I $G(NDBFLAG) W !,"NATIONAL DATABASE CATEGORY",?26,$J("ADD (+)/SUB (-)",21),$J("PRINCIPAL",11),$J("INT/ADM",11),$J("TRANSTYPE",11)
"RTN","RCRJRTR1",154,0)
 ;
"RTN","RCRJRTR1",155,0)
 W !,RCRJLINE
"RTN","RCRJRTR1",156,0)
 Q
"RTN","RCRJRTRA")
0^12^B30416869^B28869958
"RTN","RCRJRTRA",1,0)
RCRJRTRA ;WISC/RFJ-transaction report ;1 Mar 97
"RTN","RCRJRTRA",2,0)
 ;;4.5;Accounts Receivable;**68,153,340**;Mar 20, 1995;Build 9
"RTN","RCRJRTRA",3,0)
 ;;Per VA Directive 6402, this routine should not be modified.
"RTN","RCRJRTRA",4,0)
 ;
"RTN","RCRJRTRA",5,0)
 N DATEEND,DATESTRT,RCRJSUMM,TRANTYPE
"RTN","RCRJRTRA",6,0)
 ;
"RTN","RCRJRTRA",7,0)
 ;  select date range
"RTN","RCRJRTRA",8,0)
 D DATESEL("AR TRANSACTIONS") I '$G(DATEEND) Q
"RTN","RCRJRTRA",9,0)
 S DATEEND=DATEEND+.99
"RTN","RCRJRTRA",10,0)
 ;
"RTN","RCRJRTRA",11,0)
 ;  select transaction types
"RTN","RCRJRTRA",12,0)
 D TRANTYPE(DATESTRT,DATEEND) I '$O(TRANTYPE(0)) W !,"NO transaction types selected." Q
"RTN","RCRJRTRA",13,0)
 ;
"RTN","RCRJRTRA",14,0)
 S RCRJSUMM=$$SUMMARY I 'RCRJSUMM Q
"RTN","RCRJRTRA",15,0)
 ;
"RTN","RCRJRTRA",16,0)
 ;  select device
"RTN","RCRJRTRA",17,0)
 W ! S %ZIS="Q" D ^%ZIS Q:POP
"RTN","RCRJRTRA",18,0)
 I $D(IO("Q")) D  D ^%ZTLOAD K IO("Q"),ZTSK Q
"RTN","RCRJRTRA",19,0)
 .   S ZTDESC="AR Transaction Listing Report",ZTRTN="DQ^RCRJRTRA"
"RTN","RCRJRTRA",20,0)
 .   S ZTSAVE("DATE*")="",ZTSAVE("RCRJ*")="",ZTSAVE("TRANTYPE*")="",ZTSAVE("ZTREQ")="@"
"RTN","RCRJRTRA",21,0)
 W !!,"<*> please wait <*>"
"RTN","RCRJRTRA",22,0)
 ;
"RTN","RCRJRTRA",23,0)
DQ ;  report (queue) starts here
"RTN","RCRJRTRA",24,0)
 N ADM,BILLDA,CATDA,DA,DATA0,DATE,INT,PRIN,TYPE,VALUE,X,Y
"RTN","RCRJRTRA",25,0)
 K ^TMP($J,"RCRJRTRA")
"RTN","RCRJRTRA",26,0)
 ;
"RTN","RCRJRTRA",27,0)
 S TRANTYPE=0 F  S TRANTYPE=$O(TRANTYPE(TRANTYPE)) Q:'TRANTYPE  I $D(^PRCA(433,"AT",TRANTYPE)) D
"RTN","RCRJRTRA",28,0)
 .   S DATE=DATESTRT-.01 F  S DATE=$O(^PRCA(433,"AT",TRANTYPE,DATE)) Q:'DATE!(DATE>DATEEND)  D
"RTN","RCRJRTRA",29,0)
 .   .   S DA=0 F  S DA=$O(^PRCA(433,"AT",TRANTYPE,DATE,DA)) Q:'DA  D
"RTN","RCRJRTRA",30,0)
 .   .   .   S DATA0=$G(^PRCA(433,DA,0))
"RTN","RCRJRTRA",31,0)
 .   .   .   ;
"RTN","RCRJRTRA",32,0)
 .   .   .   S BILLDA=+$P(DATA0,"^",2)
"RTN","RCRJRTRA",33,0)
 .   .   .   ;  bill not linked to a site
"RTN","RCRJRTRA",34,0)
 .   .   .   I '$P($G(^PRCA(430,BILLDA,0)),"^",12) Q
"RTN","RCRJRTRA",35,0)
 .   .   .   ;
"RTN","RCRJRTRA",36,0)
 .   .   .   S CATDA=+$P($G(^PRCA(430,BILLDA,0)),"^",2)
"RTN","RCRJRTRA",37,0)
 .   .   .   I 'CATDA Q
"RTN","RCRJRTRA",38,0)
 .   .   .   ;
"RTN","RCRJRTRA",39,0)
 .   .   .   S VALUE=$$TRANBAL^RCRJRCOT(DA) I VALUE="" Q
"RTN","RCRJRTRA",40,0)
 .   .   .   S PRIN=$P(VALUE,"^"),INT=$P(VALUE,"^",2),ADM=$P(VALUE,"^",3)+$P(VALUE,"^",4)+$P(VALUE,"^",5)
"RTN","RCRJRTRA",41,0)
 .   .   .   ;
"RTN","RCRJRTRA",42,0)
 .   .   .   S TYPE=TRANTYPE
"RTN","RCRJRTRA",43,0)
 .   .   .   ;  contract adjustment
"RTN","RCRJRTRA",44,0)
 .   .   .   I TYPE=35,$P($G(^PRCA(433,DA,8)),"^",8) S TYPE="35C"
"RTN","RCRJRTRA",45,0)
 .   .   .   ;  pre-payments
"RTN","RCRJRTRA",46,0)
 .   .   .   I (TYPE=2!(TYPE=34)),$P($G(^PRCA(433,DA,5)),"^") S TYPE="34P"
"RTN","RCRJRTRA",47,0)
 .   .   .   ;
"RTN","RCRJRTRA",48,0)
 .   .   .   I TYPE'=12,TYPE'=74 D SETVALUE(TYPE,PRIN,INT,ADM) Q         ; *340 added 74 - cs admin.cost charge
"RTN","RCRJRTRA",49,0)
 .   .   .   ;
"RTN","RCRJRTRA",50,0)
 .   .   .   ;  if trans is 12 or 74, breakout charges added + and exempt -
"RTN","RCRJRTRA",51,0)
 .   .   .   ;  both +, charges added
"RTN","RCRJRTRA",52,0)
 .   .   .   I INT'<0,ADM'<0 D SETVALUE(TYPE_"A","",INT,ADM) Q
"RTN","RCRJRTRA",53,0)
 .   .   .   ;  both -, charges exempt
"RTN","RCRJRTRA",54,0)
 .   .   .   I INT<0,ADM<0 D SETVALUE(TYPE_"E","",-INT,-ADM) Q
"RTN","RCRJRTRA",55,0)
 .   .   .   ;  one is + and the other -
"RTN","RCRJRTRA",56,0)
 .   .   .   I INT<0 D:ADM SETVALUE(TYPE_"A","","",ADM) D SETVALUE(TYPE_"E","",-INT,"") Q
"RTN","RCRJRTRA",57,0)
 .   .   .   I ADM<0 D:INT SETVALUE(TYPE_"A","",INT,"") D SETVALUE(TYPE_"E","","",-ADM) Q
"RTN","RCRJRTRA",58,0)
 ;
"RTN","RCRJRTRA",59,0)
 D PRINT^RCRJRTR1
"RTN","RCRJRTRA",60,0)
 ;
"RTN","RCRJRTRA",61,0)
 D ^%ZISC
"RTN","RCRJRTRA",62,0)
 K ^TMP($J,"RCRJRTRA")
"RTN","RCRJRTRA",63,0)
 Q
"RTN","RCRJRTRA",64,0)
 ;
"RTN","RCRJRTRA",65,0)
 ;
"RTN","RCRJRTRA",66,0)
SETVALUE(TYPE,PRIN,INT,ADM) ;  store value in tmp global for printing
"RTN","RCRJRTRA",67,0)
 ;  =  trans amt ^ prin amt ^ int amt ^ adm amt
"RTN","RCRJRTRA",68,0)
 ;  add spaces to type for sorting in numerical order
"RTN","RCRJRTRA",69,0)
 S TYPE=" "_$S($L(+TYPE)=1:" ",1:"")_TYPE
"RTN","RCRJRTRA",70,0)
 S ^TMP($J,"RCRJRTRA",TYPE,CATDA,BILLDA,DA)=(PRIN+INT+ADM)_"^"_PRIN_"^"_INT_"^"_ADM
"RTN","RCRJRTRA",71,0)
 Q
"RTN","RCRJRTRA",72,0)
 ;
"RTN","RCRJRTRA",73,0)
 ;
"RTN","RCRJRTRA",74,0)
DATESEL(DESCR) ;  select starting and ending dates in days
"RTN","RCRJRTRA",75,0)
 ;  returns datestrt and dateend
"RTN","RCRJRTRA",76,0)
 N %,%DT,%H,%I,DEFAULT,X,Y
"RTN","RCRJRTRA",77,0)
 K DATEEND,DATESTRT
"RTN","RCRJRTRA",78,0)
START S Y=$E(DT,1,5)_"01" D DD^%DT S DEFAULT=Y
"RTN","RCRJRTRA",79,0)
 S %DT("A")="Start with "_$S(DESCR'="":DESCR_" ",1:"")_"Date: ",%DT("B")=DEFAULT,%DT="AEP",%DT(0)=-DT D ^%DT I Y<0 Q
"RTN","RCRJRTRA",80,0)
 I $E(Y,6,7)="00" S Y=$E(Y,1,5)_"01"
"RTN","RCRJRTRA",81,0)
 S DATESTRT=Y
"RTN","RCRJRTRA",82,0)
 S Y=DT D DD^%DT S DEFAULT=Y
"RTN","RCRJRTRA",83,0)
 S %DT("A")="  End with "_$S(DESCR'="":DESCR_" ",1:"")_"Date: ",%DT("B")=DEFAULT,%DT="AEP",%DT(0)=-DT D ^%DT I Y<0 Q
"RTN","RCRJRTRA",84,0)
 I $E(Y,6,7)="00" S Y=$E(Y,1,5)_"01"
"RTN","RCRJRTRA",85,0)
 I Y<DATESTRT W !,"END DATE MUST BE GREATER THAN OR EQUAL TO THE START DATE.",! G START
"RTN","RCRJRTRA",86,0)
 S DATEEND=Y,Y=DATESTRT D DD^%DT
"RTN","RCRJRTRA",87,0)
 W !?5,"***  Selected date range from ",Y," to " S Y=DATEEND D DD^%DT W Y,"  ***"
"RTN","RCRJRTRA",88,0)
 Q
"RTN","RCRJRTRA",89,0)
 ;
"RTN","RCRJRTRA",90,0)
 ;
"RTN","RCRJRTRA",91,0)
TRANTYPE(DATESTRT,DATEEND)          ;  select transaction types
"RTN","RCRJRTRA",92,0)
 ;  requires datestrt and dateend for date range         
"RTN","RCRJRTRA",93,0)
 ;  returns TRANTYPE(#) for selected entries
"RTN","RCRJRTRA",94,0)
 N %,COUNT,DATE,DIR,DIRUT,RCRJFLAG,TRANLIST,X,Y
"RTN","RCRJRTRA",95,0)
 K TRANTYPE
"RTN","RCRJRTRA",96,0)
 ;
"RTN","RCRJRTRA",97,0)
 ;  compile a list of available transactions in date range
"RTN","RCRJRTRA",98,0)
 S TRANLIST="",DATE=DATESTRT-.01
"RTN","RCRJRTRA",99,0)
 S TRANTYPE=0 F  S TRANTYPE=$O(^PRCA(433,"AT",TRANTYPE)) Q:'TRANTYPE  S %=+$O(^PRCA(433,"AT",TRANTYPE,DATE)) I %,%<DATEEND D
"RTN","RCRJRTRA",100,0)
 .   I TRANTYPE=45 Q  ;do not look at comments
"RTN","RCRJRTRA",101,0)
 .   S %=$P($G(^PRCA(430.3,TRANTYPE,0)),"^")
"RTN","RCRJRTRA",102,0)
 .   S TRANLIST(TRANTYPE)=%
"RTN","RCRJRTRA",103,0)
 .   S TRANLIST=TRANLIST_TRANTYPE_":"_$E(%,1,10)_";"
"RTN","RCRJRTRA",104,0)
 I TRANLIST="" W !,"There are NO transactions within the date range." Q
"RTN","RCRJRTRA",105,0)
 S TRANLIST=TRANLIST_"*:ALL transactions;-:NO transactions;"
"RTN","RCRJRTRA",106,0)
 ;
"RTN","RCRJRTRA",107,0)
 F  D  Q:$G(RCRJFLAG)
"RTN","RCRJRTRA",108,0)
 .   D SHOWLIST
"RTN","RCRJRTRA",109,0)
 .   S DIR(0)="SOA^"_TRANLIST,DIR("A")="Select TRANSACTION TYPE: "
"RTN","RCRJRTRA",110,0)
 .   D ^DIR
"RTN","RCRJRTRA",111,0)
 .   I $D(DIRUT) S RCRJFLAG=1 Q
"RTN","RCRJRTRA",112,0)
 .   I Y="*" S %=0 F  S %=$O(TRANLIST(%)) Q:'%  S TRANTYPE(%)=""
"RTN","RCRJRTRA",113,0)
 .   I Y="-" K TRANTYPE Q
"RTN","RCRJRTRA",114,0)
 .   S Y=+Y
"RTN","RCRJRTRA",115,0)
 .   I $D(TRANLIST(Y)) D
"RTN","RCRJRTRA",116,0)
 .   .   I $D(TRANTYPE(Y)) K TRANTYPE(Y) W "  un-selected" Q
"RTN","RCRJRTRA",117,0)
 .   .   S TRANTYPE(Y)="" W "  selected"
"RTN","RCRJRTRA",118,0)
 Q
"RTN","RCRJRTRA",119,0)
 ;
"RTN","RCRJRTRA",120,0)
 ;
"RTN","RCRJRTRA",121,0)
SHOWLIST ;  show list of available/selected transaction types
"RTN","RCRJRTRA",122,0)
 W !!,"The following is a list of available transactions within the date range.",!,"Asterisks (**) next to the transaction indicates it has been selected",!,"for the report."
"RTN","RCRJRTRA",123,0)
 S %=0 F COUNT=1:1 S %=$O(TRANLIST(%)) Q:'%  D
"RTN","RCRJRTRA",124,0)
 .   I (COUNT#2)'=0 W !
"RTN","RCRJRTRA",125,0)
 .   E  W ?40
"RTN","RCRJRTRA",126,0)
 .   W $S($D(TRANTYPE(%)):"**",1:"  ")," "
"RTN","RCRJRTRA",127,0)
 .   W $S($L(%)=1:" ",1:""),%,"  ",TRANLIST(%)
"RTN","RCRJRTRA",128,0)
 Q
"RTN","RCRJRTRA",129,0)
 ;
"RTN","RCRJRTRA",130,0)
 ;
"RTN","RCRJRTRA",131,0)
SUMMARY() ;  ask to print detailed or summary report
"RTN","RCRJRTRA",132,0)
 N DIR,DIRUT,X,Y
"RTN","RCRJRTRA",133,0)
 S DIR(0)="SOA^D:detailed;S:summary;",DIR("A")="Type of report to print: ",DIR("B")="summary"
"RTN","RCRJRTRA",134,0)
 W ! D ^DIR
"RTN","RCRJRTRA",135,0)
 I $D(DIRUT) Q 0
"RTN","RCRJRTRA",136,0)
 Q $S(Y="S":1,Y="D":2,1:0)
"RTN","RCTCSP2")
0^1^B128258214^B136606046
"RTN","RCTCSP2",1,0)
RCTCSP2  ;ALBANY/BDB-CROSS-SERVICING TRANSMISSION ;03/15/14 3:34 PM
"RTN","RCTCSP2",2,0)
 ;;4.5;Accounts Receivable;**301,315,339,340**;Mar 20, 1995;Build 9
"RTN","RCTCSP2",3,0)
 ;;Per VA Directive 6402, this routine should not be modified.
"RTN","RCTCSP2",4,0)
 ;
"RTN","RCTCSP2",5,0)
 Q
"RTN","RCTCSP2",6,0)
 ;
"RTN","RCTCSP2",7,0)
COMPILE ;
"RTN","RCTCSP2",8,0)
 N RCMSG,BCNTR,REC,RECC,AMOUNT,RCNTR,ACTION,SEQ
"RTN","RCTCSP2",9,0)
 S BCNTR=0,REC=0,RECC=0,AMOUNT=0,SEQ=0
"RTN","RCTCSP2",10,0)
 F  S BCNTR=$O(^XTMP("RCTCSPD",$J,BCNTR)) Q:+BCNTR'>0  D
"RTN","RCTCSP2",11,0)
 .I REC>50 D
"RTN","RCTCSP2",12,0)
 ..D TRAILER^RCTCSP1A
"RTN","RCTCSP2",13,0)
 ..D AITCMSG
"RTN","RCTCSP2",14,0)
 ..S REC=0,RECC=0
"RTN","RCTCSP2",15,0)
 ..Q
"RTN","RCTCSP2",16,0)
 .S ACTION="" F  S ACTION=$O(^XTMP("RCTCSPD",$J,BCNTR,ACTION)) Q:ACTION=""  D
"RTN","RCTCSP2",17,0)
 ..I REC=0 D HEADER^RCTCSP1A
"RTN","RCTCSP2",18,0)
 ..F RCNTR=1,2,"2A","2C",3 I $D(^XTMP("RCTCSPD",$J,BCNTR,ACTION,RCNTR)) D
"RTN","RCTCSP2",19,0)
 ...S REC=REC+1
"RTN","RCTCSP2",20,0)
 ...S RECC=RECC+1 ;record count for 'c' records on trailer record
"RTN","RCTCSP2",21,0)
 ...S ^XTMP("RCTCSPD",$J,SEQ,"BUILD",REC)=$E(^XTMP("RCTCSPD",$J,BCNTR,ACTION,RCNTR),1,225)_$C(94)
"RTN","RCTCSP2",22,0)
 ...S REC=REC+1
"RTN","RCTCSP2",23,0)
 ...S ^XTMP("RCTCSPD",$J,SEQ,"BUILD",REC)=$E(^XTMP("RCTCSPD",$J,BCNTR,ACTION,RCNTR),226,999)_$C(126)
"RTN","RCTCSP2",24,0)
 ...I $E(^XTMP("RCTCSPD",$J,BCNTR,ACTION,RCNTR),2)="1" S AMOUNT=AMOUNT+$E(^(RCNTR),91,104)
"RTN","RCTCSP2",25,0)
 ...Q
"RTN","RCTCSP2",26,0)
 ..I $D(^XTMP("RCTCSPD",$J,BCNTR,ACTION,"5B")) D
"RTN","RCTCSP2",27,0)
 ...N TRNNUM
"RTN","RCTCSP2",28,0)
 ...S TRNNUM=0
"RTN","RCTCSP2",29,0)
 ...F  S TRNNUM=$O(^XTMP("RCTCSPD",$J,BCNTR,ACTION,"5B",TRNNUM)) Q:TRNNUM'?1N.N  D
"RTN","RCTCSP2",30,0)
 ....S REC=REC+1
"RTN","RCTCSP2",31,0)
 ....S RECC=RECC+1 ;record count for 'c' records on trailer record
"RTN","RCTCSP2",32,0)
 ....S ^XTMP("RCTCSPD",$J,SEQ,"BUILD",REC)=$E(^XTMP("RCTCSPD",$J,BCNTR,ACTION,"5B",TRNNUM),1,225)_$C(94)
"RTN","RCTCSP2",33,0)
 ....S REC=REC+1
"RTN","RCTCSP2",34,0)
 ....S ^XTMP("RCTCSPD",$J,SEQ,"BUILD",REC)=$E(^XTMP("RCTCSPD",$J,BCNTR,ACTION,"5B",TRNNUM),226,999)_$C(126)
"RTN","RCTCSP2",35,0)
 ....S AMOUNT=AMOUNT+$TR($E(^XTMP("RCTCSPD",$J,BCNTR,ACTION,"5B",TRNNUM),173,186),"-")
"RTN","RCTCSP2",36,0)
 ....Q
"RTN","RCTCSP2",37,0)
 ...Q
"RTN","RCTCSP2",38,0)
 ..Q
"RTN","RCTCSP2",39,0)
 .Q
"RTN","RCTCSP2",40,0)
 D TRAILER^RCTCSP1A
"RTN","RCTCSP2",41,0)
 D AITCMSG
"RTN","RCTCSP2",42,0)
 D USRMSG
"RTN","RCTCSP2",43,0)
 Q
"RTN","RCTCSP2",44,0)
 ;
"RTN","RCTCSP2",45,0)
RCLLCHK(BILL) ;
"RTN","RCTCSP2",46,0)
 N TOTAL
"RTN","RCTCSP2",47,0)
 I $P(B15,U,7) Q 0 ;check stop tcsp referral flag
"RTN","RCTCSP2",48,0)
 I $P(B15,U,2),'$P(B15,U,3) D  ;recall bill
"RTN","RCTCSP2",49,0)
 .N ACTION,BILLCSL
"RTN","RCTCSP2",50,0)
 .S ACTION="L"
"RTN","RCTCSP2",51,0)
 .S $P(^PRCA(430,BILL,15),U,1)="" ;clear the date referred
"RTN","RCTCSP2",52,0)
 .S $P(^PRCA(430,BILL,15),U,3)=DT ;set the recall date
"RTN","RCTCSP2",53,0)
 .S $P(^PRCA(430,BILL,15),U,5)=$$GET1^DIQ(430,BILL,11) ;set the recall amount to the current amount
"RTN","RCTCSP2",54,0)
 .S B15=^PRCA(430,BILL,15)
"RTN","RCTCSP2",55,0)
 .S BILLCSL=BILL ;last cs bill
"RTN","RCTCSP2",56,0)
 .D REC1^RCTCSPD
"RTN","RCTCSP2",57,0)
 .K ^PRCA(430,"TCSP",BILL) ;set the bill to not sent to cross-servicing
"RTN","RCTCSP2",58,0)
 .D RCLL^RCTCSPD4 ; set bill recall non-financial transaction PRCA*4.5*315
"RTN","RCTCSP2",59,0)
 ;
"RTN","RCTCSP2",60,0)
 ;recall bill if total <$25
"RTN","RCTCSP2",61,0)
 S TOTAL=$P(B7,U)+$P(B7,U,2)+$P(B7,U,3)+$P(B7,U,4)+$P(B7,U,5)
"RTN","RCTCSP2",62,0)
 I TOTAL<25 D  Q 0
"RTN","RCTCSP2",63,0)
 .N X1,X2,P366DT,X,PRCAEN,I,RECALL
"RTN","RCTCSP2",64,0)
 .S RECALL=0
"RTN","RCTCSP2",65,0)
 .S X1=DT,X2=-366 D C^%DTC S P366DT=X
"RTN","RCTCSP2",66,0)
 .S PRCAEN=0 F I=0:0 S PRCAEN=$O(^PRCA(433,"C",BILL,PRCAEN)) Q:'PRCAEN  S:$P($G(^PRCA(433,PRCAEN,1)),U,1)>P366DT RECALL=1
"RTN","RCTCSP2",67,0)
 .I RECALL=0 D  Q
"RTN","RCTCSP2",68,0)
 ..S ACTION="L"
"RTN","RCTCSP2",69,0)
 ..S $P(^PRCA(430,BILL,15),U,1)="" ;clear the date referred
"RTN","RCTCSP2",70,0)
 ..S $P(^PRCA(430,BILL,15),U,2)=1 ;set the recall flag
"RTN","RCTCSP2",71,0)
 ..S $P(^PRCA(430,BILL,15),U,3)=DT ;set the recall date
"RTN","RCTCSP2",72,0)
 ..S $P(^PRCA(430,BILL,15),U,4)="07" ;set the recall reason
"RTN","RCTCSP2",73,0)
 ..S $P(^PRCA(430,BILL,15),U,5)=$P($G(^PRCA(430,BILL,16)),U,10) ;set the recall amount to the current tcsp amount
"RTN","RCTCSP2",74,0)
 ..S $P(^PRCA(430,BILL,15),U,7)=1 ;set the stop flag
"RTN","RCTCSP2",75,0)
 ..S $P(^PRCA(430,BILL,15),U,8)=DT ;set the stop date
"RTN","RCTCSP2",76,0)
 ..S $P(^PRCA(430,BILL,15),U,9)="O" ;set the stop date
"RTN","RCTCSP2",77,0)
 ..S $P(^PRCA(430,BILL,15),U,10)="AUTORECALL <$25" ;set the stop reason
"RTN","RCTCSP2",78,0)
 ..S B15=^PRCA(430,BILL,15)
"RTN","RCTCSP2",79,0)
 ..D REC1^RCTCSPD,RCLL^RCTCSPD4 ; set CS Bill Recall transaction PRCA*4.5*315
"RTN","RCTCSP2",80,0)
 ..K ^PRCA(430,"TCSP",BILL) ;set the bill to not sent to cross-servicing
"RTN","RCTCSP2",81,0)
 ..S $P(^PRCA(430,BILL,19),U,10)=1 ;stop interest admin calc
"RTN","RCTCSP2",82,0)
 ..S B19=$G(^PRCA(430,BILL,19))
"RTN","RCTCSP2",83,0)
 ..Q
"RTN","RCTCSP2",84,0)
 .Q
"RTN","RCTCSP2",85,0)
 Q 0
"RTN","RCTCSP2",86,0)
 ;
"RTN","RCTCSP2",87,0)
RCRPRT ;Reconciliation report
"RTN","RCTCSP2",88,0)
 N ZTDESC,ZTRTN,POP,%ZIS,DTFRMTO,DTFRM,DTTO,PROMPT,EXCEL,DATE
"RTN","RCTCSP2",89,0)
 S DTFRMTO=$$DTFRMTO Q:'DTFRMTO  ;Get date range as per PRCA*4.5*315
"RTN","RCTCSP2",90,0)
 S (DATE,DTFRM)=$$FMADD^XLFDT(+$P(DTFRMTO,U,2),-1),DTTO=$P(DTFRMTO,U,3),CURDT=0
"RTN","RCTCSP2",91,0)
 S EXCEL=0,PROMPT="CAPTURE Report data to an Excel Document",DIR(0)="Y",DIR("?")="^D HEXC^RCTCSJR"
"RTN","RCTCSP2",92,0)
 S EXCEL=$$SELECT^RCTCSJR(PROMPT,"NO") I "01"'[EXCEL S STOP=1 Q
"RTN","RCTCSP2",93,0)
 I EXCEL=1 D EXCMSG^RCTCSJR ; Display Excel display message
"RTN","RCTCSP2",94,0)
 K IOP,IO("Q") S %ZIS="MQ",%ZIS("B")="" D ^%ZIS Q:POP
"RTN","RCTCSP2",95,0)
 I $D(IO("Q")) D  Q  ;
"RTN","RCTCSP2",96,0)
 .S ZTSAVE("DTFRMTO")="",ZTSAVE("EXCEL")=""
"RTN","RCTCSP2",97,0)
 .S ZTRTN="RCRPRTP^RCTCSP2",ZTDESC="RECONCILIATION REPORT"
"RTN","RCTCSP2",98,0)
 .D ^%ZTLOAD,HOME^%ZIS
"RTN","RCTCSP2",99,0)
 .I $G(ZTSK) W !!,"Report compilation has started with task# ",ZTSK,".",! S DIR(0)="E" D ^DIR K DIR
"RTN","RCTCSP2",100,0)
 .Q
"RTN","RCTCSP2",101,0)
 ;
"RTN","RCTCSP2",102,0)
RCRPRTP ;print the - reconciliation report, call to build array of bills returned
"RTN","RCTCSP2",103,0)
 U IO
"RTN","RCTCSP2",104,0)
 N DASH,PAGE,DBTR,DBTRN,RCOUT,CURDT,RC18,RCRTCD,BILLIEN,DATE
"RTN","RCTCSP2",105,0)
 K ^TMP("RCTCSP2",$J)
"RTN","RCTCSP2",106,0)
 S (DATE,DTFRM)=$$FMADD^XLFDT(+$P(DTFRMTO,U,2),-1),DTTO=$P(DTFRMTO,U,3),CURDT=0
"RTN","RCTCSP2",107,0)
 F  S DATE=$O(^PRCA(430,"AN",DATE)),BILLIEN=0 Q:DATE=""!(DATE>DTTO)  D  ;Use new AN xref PRCA*4.5*315
"RTN","RCTCSP2",108,0)
 . F  S BILLIEN=$O(^PRCA(430,"AN",DATE,BILLIEN)) Q:BILLIEN=""  D
"RTN","RCTCSP2",109,0)
 ..I +$P($G(^PRCA(430,BILLIEN,30)),U,1)=0 Q   ;Returned date is NULL
"RTN","RCTCSP2",110,0)
 ..S DBTR=$P($G(^PRCA(430,BILLIEN,0)),U,9),DBTRN=$$GET1^DIQ(430,BILLIEN,9)
"RTN","RCTCSP2",111,0)
 ..Q:DBTRN']""
"RTN","RCTCSP2",112,0)
 ..S ^TMP("RCTCSP2",$J,DBTRN,DBTR)=""   ; store scratch by Debtor Name, Debtor IEN
"RTN","RCTCSP2",113,0)
 S PAGE=0,RCOUT=0
"RTN","RCTCSP2",114,0)
 S DASH="",$P(DASH,"-",78)=""
"RTN","RCTCSP2",115,0)
 D RCRPRTH2
"RTN","RCTCSP2",116,0)
 ;
"RTN","RCTCSP2",117,0)
 ;New fields added in PRCA*4.5*315:
"RTN","RCTCSP2",118,0)
 ;AMTREF:(#310) REC ORIGINAL TCSP AMOUNT stored in ^PRCA(430,BILL,30), piece 10
"RTN","RCTCSP2",119,0)
 ;CORDT:(#312) REC TCSP RECALL EFF. DATE stored in ^PRCA(430,BILL,30), piece 12
"RTN","RCTCSP2",120,0)
 ;DTREJ: (#172) REJECT DATE (multiple)
"RTN","RCTCSP2",121,0)
 ;See RCTCSPRS for more information on these fields
"RTN","RCTCSP2",122,0)
 ;
"RTN","RCTCSP2",123,0)
 S DBTRN=0
"RTN","RCTCSP2",124,0)
 F  S DBTRN=$O(^TMP("RCTCSP2",$J,DBTRN)) Q:DBTRN=""!RCOUT  S DBTR=0 F  S DBTR=$O(^TMP("RCTCSP2",$J,DBTRN,DBTR)) Q:'DBTR!RCOUT  D  Q:RCOUT
"RTN","RCTCSP2",125,0)
 .S BILL=0
"RTN","RCTCSP2",126,0)
 .F  S BILL=$O(^PRCA(430,"C",DBTR,BILL)) Q:BILL'?1N.N  D  Q:RCOUT
"RTN","RCTCSP2",127,0)
 ..N B0,B30,AMTREF,DTRET,CORDT,SSN
"RTN","RCTCSP2",128,0)
 ..S B0=$G(^PRCA(430,BILL,0)),B30=$G(^PRCA(430,BILL,30))
"RTN","RCTCSP2",129,0)
 ..S AMTREF=$J($P(B30,U,10),8,2)
"RTN","RCTCSP2",130,0)
 ..S DEBTOR=$P(B0,U,9),SSN=$$SSN^RCFN01($P(^RCD(340,DEBTOR,0),"^")),SSN=$S(SSN=-1:"",1:$E(DBTRN))_$E(SSN,6,9)
"RTN","RCTCSP2",131,0)
 ..S CORDT=$$FMTE^XLFDT($P(B30,U,12),"2Z"),DTRET=""
"RTN","RCTCSP2",132,0)
 ..S DTRET=$P(B30,U) I DTRET S DTRET=$$FMTE^XLFDT(DTRET,"2Z")
"RTN","RCTCSP2",133,0)
 ..I +$P(B30,U,1)=0 Q
"RTN","RCTCSP2",134,0)
 ..I 'EXCEL W $E(DBTRN,1,16)
"RTN","RCTCSP2",135,0)
 ..I EXCEL W !,$E(DBTRN,1,14)
"RTN","RCTCSP2",136,0)
 ..I 'EXCEL W ?17,$P(B0,U,1),?29,SSN,?35,AMTREF,?44,CORDT,?53,DTRET,!
"RTN","RCTCSP2",137,0)
 ..I EXCEL W U_$P($P(B0,U,1),"-",2)_U_SSN_U_AMTREF_U_CORDT_U_DTRET
"RTN","RCTCSP2",138,0)
 ..S RCRTCD=$P(B30,U,2)
"RTN","RCTCSP2",139,0)
 ..I 'EXCEL D
"RTN","RCTCSP2",140,0)
 ...D  ;Display return reason code
"RTN","RCTCSP2",141,0)
 ....I RCRTCD="" W ?6,"NO RETURN REASON CODE",! Q
"RTN","RCTCSP2",142,0)
 ....W:$D(^PRCA(430.5,RCRTCD,0)) ?6,$P(^PRCA(430.5,RCRTCD,0),U,2),!
"RTN","RCTCSP2",143,0)
 ....W:'$D(^PRCA(430.5,RCRTCD,0)) ?6,"UNKNOWN RETURN REASON CODE: ",RCRTCD,!
"RTN","RCTCSP2",144,0)
 ....W:RCRTCD=14 ?7,"Compromise, Please write this bill off by the manual process",!,?8,"Amount (not collected): "_$J($P(B30,U,4),9,2),!  ;Added PRCA*4.5*315
"RTN","RCTCSP2",145,0)
 ....W:RCRTCD=2 ?8,"Date of Death:  "_$$FMTE^XLFDT($P(B30,U,7),"2Z"),!  ;date type (as per PRCA*4.5*315)
"RTN","RCTCSP2",146,0)
 ....W:RCRTCD=3 ?8,"Bankruptcy Date:  "_$$FMTE^XLFDT($P(B30,U,6),"2Z"),!
"RTN","RCTCSP2",147,0)
 ...W:+$P(B30,U,8) ?6,"Date of Dissolution:  "_$$FMTE^XLFDT($P(B30,U,8),"2Z"),!
"RTN","RCTCSP2",148,0)
 ..I EXCEL D
"RTN","RCTCSP2",149,0)
 ...I RCRTCD=14 W U_$P(^PRCA(430.5,RCRTCD,0),U,2)_U_"AMT NOT COLL"_U_$P(B30,U,4)
"RTN","RCTCSP2",150,0)
 ...I $P(B30,U,3)="Y" W U_"CP"_U_$J($P(B30,U,4),4,2) Q
"RTN","RCTCSP2",151,0)
 ...I RCRTCD=2 W U_$P(^PRCA(430.5,RCRTCD,0),U,2)_" "_$$FMTE^XLFDT($P(B30,U,7),"2Z") Q
"RTN","RCTCSP2",152,0)
 ...I RCRTCD=3 W U_$P(^PRCA(430.5,RCRTCD,0),U,2)_" "_$$FMTE^XLFDT($P(B30,U,6),"2Z") Q
"RTN","RCTCSP2",153,0)
 ...I RCRTCD]"" W U_$S($D(^PRCA(430.5,RCRTCD,0)):$$GET1^DIQ(430.5,RCRTCD,1),1:RCRTCD) Q
"RTN","RCTCSP2",154,0)
 ..;check for end of page here, if necessary form feed and print header
"RTN","RCTCSP2",155,0)
 ..I 'EXCEL W ! I ($Y+5)>IOSL D
"RTN","RCTCSP2",156,0)
 ...I $E(IOST,1,2)="C-" S DIR(0)="E" K DIRUT D ^DIR K DIR I $D(DTOUT)!($D(DUOUT)) S RCOUT=1 K X,Y,DIRUT,DTOUT,DUOUT,DIROUT Q
"RTN","RCTCSP2",157,0)
 ...D RCRPRTH2
"RTN","RCTCSP2",158,0)
 I $E(IOST,1,2)="C-" R !!,"END OF REPORT...PRESS RETURN TO CONTINUE",X:DTIME W @IOF
"RTN","RCTCSP2",159,0)
 D ^%ZISC
"RTN","RCTCSP2",160,0)
 S:$D(ZTQUEUED) ZTREQ="@"
"RTN","RCTCSP2",161,0)
 K IOP,%ZIS,ZTQUEUED
"RTN","RCTCSP2",162,0)
 K ^TMP("RCTCSP2",$J)
"RTN","RCTCSP2",163,0)
 Q
"RTN","RCTCSP2",164,0)
 ;
"RTN","RCTCSP2",165,0)
RCRPRTH2 ;header for reconciliation report print report 2
"RTN","RCTCSP2",166,0)
 W @IOF
"RTN","RCTCSP2",167,0)
 S PAGE=PAGE+1
"RTN","RCTCSP2",168,0)
 I 'EXCEL W "PAGE "_PAGE,?12,"RECONCILIATION REPORT ",?65,$$FMTE^XLFDT(DT,"2Z")
"RTN","RCTCSP2",169,0)
 I 'EXCEL D  Q
"RTN","RCTCSP2",170,0)
 .W !,DASH
"RTN","RCTCSP2",171,0)
 .W !,"DEBTOR",?17,"BILL NO.",?29,"Pt ID",?35,"Amount",?44,"Recall",?53,"Date",!
"RTN","RCTCSP2",172,0)
 .W ?35,"Refer",?44,"Eff. Dt",?53,"Return"
"RTN","RCTCSP2",173,0)
 .W !,"----------------",?17,"-----------",?29,"-----",?35,"--------",?44,"--------",?53,"--------",!
"RTN","RCTCSP2",174,0)
 ;EXCEL FORMAT
"RTN","RCTCSP2",175,0)
 W "PAGE "_PAGE_U_"RECONCILIATION REPORT "_U_$$FMTE^XLFDT(DT,"2Z")
"RTN","RCTCSP2",176,0)
 W !,"DEBTOR"_U_"BILL #"_U_"PT ID"_U_"AMT REF"_U_"DT RCL"_U_"DT RET"_U_"COMMENT"
"RTN","RCTCSP2",177,0)
 Q
"RTN","RCTCSP2",178,0)
 ;
"RTN","RCTCSP2",179,0)
AITCMSG ;
"RTN","RCTCSP2",180,0)
 N XMY,XMDUZ,XMSUB,XMTEXT,CNTLID,SYSTYP
"RTN","RCTCSP2",181,0)
 S SYSTYP=$$PROD^XUPROD(1)
"RTN","RCTCSP2",182,0)
 S CNTLID=$$JD^RCTCSP1A()_$$RJZF^RCTCSP1(SEQ,4)
"RTN","RCTCSP2",183,0)
 S XMDUZ="AR PACKAGE"
"RTN","RCTCSP2",184,0)
 I SYSTYP S XMY("XXX@Q-TPC.DOMAIN.EXT")=""
"RTN","RCTCSP2",185,0)
 I 'SYSTYP S XMY("XXX@Q-TXC.DOMAIN.EXT")=""
"RTN","RCTCSP2",186,0)
 S XMY("G.TCSP")=""
"RTN","RCTCSP2",187,0)
 S XMSUB=SITE_"/CS TRANSMISSION/BATCH#: "_CNTLID
"RTN","RCTCSP2",188,0)
 S XMTEXT="^XTMP(""RCTCSPD"","_$J_","""_SEQ_""",""BUILD"","
"RTN","RCTCSP2",189,0)
 D ^XMD
"RTN","RCTCSP2",190,0)
 Q
"RTN","RCTCSP2",191,0)
 ;
"RTN","RCTCSP2",192,0)
USRMSG ;sends mailman message of documents sent to user
"RTN","RCTCSP2",193,0)
 N XMY,XMDUZ,XMSUB,XMTEXT,X,RCNT,RCDAT1,RCDAT2
"RTN","RCTCSP2",194,0)
 S ACTION="" F  S ACTION=$O(^XTMP("RCTCSPD",$J,"BILL",ACTION)) Q:ACTION=""  D
"RTN","RCTCSP2",195,0)
 .K ^XTMP("RCTCSPD",$J,"BILL","MSG")
"RTN","RCTCSP2",196,0)
 .S XMDUZ="AR PACKAGE"
"RTN","RCTCSP2",197,0)
 .S XMY("G.TCSP")=""
"RTN","RCTCSP2",198,0)
 .S XMSUB="CS "_$S(ACTION="A":"ADD REFERRAL",ACTION="U":"UPDATES",ACTION="L":"RECALLS",ACTION="B":"EXISTING DEBTOR",1:"UNKNOWN")_" SENT ON "_$E(DT,4,5)_"/"_$E(DT,6,7)_"/"_$E(DT,2,3)_" BATCH ID: "_CNTLID
"RTN","RCTCSP2",199,0)
 .S ^XTMP("RCTCSPD",$J,"BILL","MSG",1)="Bill#     TIN        TYPE       AMOUNT"
"RTN","RCTCSP2",200,0)
 .S ^XTMP("RCTCSPD",$J,"BILL","MSG",2)="-----     ---        ----       ------"
"RTN","RCTCSP2",201,0)
 .S X=0,RCNT=2 F  S X=$O(^XTMP("RCTCSPD",$J,"BILL",ACTION,X)) Q:X=""  D
"RTN","RCTCSP2",202,0)
 ..S RCNT=RCNT+1
"RTN","RCTCSP2",203,0)
 ..S RCDAT1=$P(^XTMP("RCTCSPD",$J,"BILL",ACTION,X),U,1)
"RTN","RCTCSP2",204,0)
 ..S RCDAT2=$P(^XTMP("RCTCSPD",$J,"BILL",ACTION,X),U,2)
"RTN","RCTCSP2",205,0)
 ..S ^XTMP("RCTCSPD",$J,"BILL","MSG",RCNT)=$$RJZF($P($G(^PRCA(430,X,0)),U,1),7)_$$BLANK(22)_RCDAT1_"     "_ACTION_"        "_$S(RCDAT2]"":RCDAT2,1:"")
"RTN","RCTCSP2",206,0)
 ..Q
"RTN","RCTCSP2",207,0)
 .S ^XTMP("RCTCSPD",$J,"BILL","MSG",RCNT+1)="Total Bills: "_(RCNT-2)
"RTN","RCTCSP2",208,0)
 .S XMTEXT="^XTMP(""RCTCSPD"","_$J_",""BILL"",""MSG"","
"RTN","RCTCSP2",209,0)
 .D ^XMD
"RTN","RCTCSP2",210,0)
 .K ^XTMP("RCTCSPD",$J,"BILL","MSG")
"RTN","RCTCSP2",211,0)
 Q
"RTN","RCTCSP2",212,0)
 ;
"RTN","RCTCSP2",213,0)
THIRD ;sends mailman message to user if no third letter found
"RTN","RCTCSP2",214,0)
 Q:'$D(^XTMP("RCTCSPD",$J,"THIRD"))
"RTN","RCTCSP2",215,0)
 N XMY,XMDUZ,XMSUB,XMTEXT
"RTN","RCTCSP2",216,0)
 S XMDUZ="AR PACKAGE"
"RTN","RCTCSP2",217,0)
 S XMY("G.TCSP")=""
"RTN","RCTCSP2",218,0)
 N TCT,TDEB,TDEB0,TBIL,TSP,FST
"RTN","RCTCSP2",219,0)
 S XMSUB="TCSP QUALIFIED/NO 3RD LETTER SENT ON "_$E(DT,4,5)_"/"_$E(DT,6,7)_"/"_$E(DT,2,3)
"RTN","RCTCSP2",220,0)
 S ^XTMP("RCTCSPD",$J,"THIRD",1)="The following list of debtor bills were not sent to TCSP."
"RTN","RCTCSP2",221,0)
 S ^XTMP("RCTCSPD",$J,"THIRD",2)="Please review debtor's account to determine why the third"
"RTN","RCTCSP2",222,0)
 S ^XTMP("RCTCSPD",$J,"THIRD",3)="notice letter has not been sent:"
"RTN","RCTCSP2",223,0)
 S ^XTMP("RCTCSPD",$J,"THIRD",4)="Name       Bill #"
"RTN","RCTCSP2",224,0)
 S ^XTMP("RCTCSPD",$J,"THIRD",5)="----       ------"
"RTN","RCTCSP2",225,0)
 S TCT=6,TSP=0,TDEB=""
"RTN","RCTCSP2",226,0)
 F  S TDEB=$O(^XTMP("RCTCSPD",$J,"THIRD",TDEB)) Q:TDEB=""  D
"RTN","RCTCSP2",227,0)
 .S FST=1,TBIL=""
"RTN","RCTCSP2",228,0)
 .I FST,TCT'=6 S ^XTMP("RCTCSPD",$J,"THIRD",TCT)="",TCT=TCT+1,TSP=TSP+1
"RTN","RCTCSP2",229,0)
 .F  S TBIL=$O(^XTMP("RCTCSPD",$J,"THIRD",TDEB,TBIL)) Q:TBIL=""  D
"RTN","RCTCSP2",230,0)
 ..S TDEB0=$S(FST:TDEB,1:"")
"RTN","RCTCSP2",231,0)
 ..S ^XTMP("RCTCSPD",$J,"THIRD",TCT)=TDEB0_$J(" ",35-$L(TDEB0))_TBIL
"RTN","RCTCSP2",232,0)
 ..S TCT=TCT+1,FST=0
"RTN","RCTCSP2",233,0)
 S ^XTMP("RCTCSPD",$J,"THIRD",TCT)="Total records: "_(TCT-(6+TSP))
"RTN","RCTCSP2",234,0)
 S XMTEXT="^XTMP(""RCTCSPD"","_$J_",""THIRD"","
"RTN","RCTCSP2",235,0)
 D ^XMD
"RTN","RCTCSP2",236,0)
 K ^XTMP("RCTCSPD",$J,"THIRD")
"RTN","RCTCSP2",237,0)
THIRDQ Q
"RTN","RCTCSP2",238,0)
 ;
"RTN","RCTCSP2",239,0)
REC3 ;
"RTN","RCTCSP2",240,0)
 N REC,KNUM,DEBTNR,DEBTORNB
"RTN","RCTCSP2",241,0)
 S REC="C3 "_ACTION_"3636001200"_"DM1D "
"RTN","RCTCSP2",242,0)
 S KNUM=$P($P(B0,U,1),"-",2)
"RTN","RCTCSP2",243,0)
 S DEBTNR=$E(SITE,1,3)_$$LJZF(KNUM,7)_$TR($J(BILL,20)," ",0),REC=REC_DEBTNR
"RTN","RCTCSP2",244,0)
 S DEBTORNB=$E(SITE,1,3)_$TR($J(DEBTOR,12)," ",0)
"RTN","RCTCSP2",245,0)
 S REC=REC_DEBTORNB
"RTN","RCTCSP2",246,0)
 S REC=REC_$S(ACTION="L":"15",1:"  ")
"RTN","RCTCSP2",247,0)
 S REC=REC_"SLF"
"RTN","RCTCSP2",248,0)
 S REC=REC_$$BLANK(8)
"RTN","RCTCSP2",249,0)
 S REC=REC_$$AMOUNT(0)
"RTN","RCTCSP2",250,0)
 S REC=REC_$$BLANK(16)
"RTN","RCTCSP2",251,0)
 S REC=REC_"SLFIND"
"RTN","RCTCSP2",252,0)
 S REC=REC_$$BLANK(450-$L(REC))
"RTN","RCTCSP2",253,0)
 S ^XTMP("RCTCSPD",$J,BILL,ACTION,3)=REC
"RTN","RCTCSP2",254,0)
 S $P(^XTMP("RCTCSPD",$J,"BILL",ACTION,BILL),U,1)=$$TAXID(DEBTOR)
"RTN","RCTCSP2",255,0)
 Q
"RTN","RCTCSP2",256,0)
 ;
"RTN","RCTCSP2",257,0)
DATE8(X) ;changes fileman date into 8 digit date yyyymmdd
"RTN","RCTCSP2",258,0)
 I +X S X=X+17000000
"RTN","RCTCSP2",259,0)
 S X=$E(X,1,8)
"RTN","RCTCSP2",260,0)
 Q X
"RTN","RCTCSP2",261,0)
 ;
"RTN","RCTCSP2",262,0)
AMOUNT(X) ;changes amount to zero filled, right justified
"RTN","RCTCSP2",263,0)
 S:X<0 X=-X
"RTN","RCTCSP2",264,0)
 S X=$TR($J(X,0,2),".")
"RTN","RCTCSP2",265,0)
 S X=$E("000000000000",1,14-$L(X))_X
"RTN","RCTCSP2",266,0)
 Q X
"RTN","RCTCSP2",267,0)
 ;
"RTN","RCTCSP2",268,0)
BLANK(X) ;returns 'x' blank spaces
"RTN","RCTCSP2",269,0)
 N BLANK
"RTN","RCTCSP2",270,0)
 S BLANK="",$P(BLANK," ",X+1)=""
"RTN","RCTCSP2",271,0)
 Q BLANK
"RTN","RCTCSP2",272,0)
 ;
"RTN","RCTCSP2",273,0)
RJZF(X,Y) ;right justify zero fill width Y
"RTN","RCTCSP2",274,0)
 S X=$E("000000000000",1,Y-$L(X))_X
"RTN","RCTCSP2",275,0)
 Q X
"RTN","RCTCSP2",276,0)
 ;
"RTN","RCTCSP2",277,0)
LJSF(X,Y) ;left justified space filled
"RTN","RCTCSP2",278,0)
 S X=$E(X,1,Y)
"RTN","RCTCSP2",279,0)
 S X=X_$$BLANK(Y-$L(X))
"RTN","RCTCSP2",280,0)
 Q X
"RTN","RCTCSP2",281,0)
 ;
"RTN","RCTCSP2",282,0)
LJZF(X,Y) ;x left justified, y zero filled
"RTN","RCTCSP2",283,0)
 S X=X_"0000000000"
"RTN","RCTCSP2",284,0)
 S X=$E(X,X,Y)
"RTN","RCTCSP2",285,0)
 Q X
"RTN","RCTCSP2",286,0)
 ;
"RTN","RCTCSP2",287,0)
TAXID(DEBTOR) ;computes TAXID to place on documents
"RTN","RCTCSP2",288,0)
 N TAXID,DIC,DA,DR,DIQ
"RTN","RCTCSP2",289,0)
 S TAXID=$$SSN^RCFN01(DEBTOR)
"RTN","RCTCSP2",290,0)
 S TAXID=$$LJSF(TAXID,9)
"RTN","RCTCSP2",291,0)
 Q TAXID
"RTN","RCTCSP2",292,0)
 ;
"RTN","RCTCSP2",293,0)
DTFRMTO(PROMPT) ;Get from and to dates  (added as per PRCA*4.5*315 to be able to sort by dates for reports)
"RTN","RCTCSP2",294,0)
 ;INPUT:
"RTN","RCTCSP2",295,0)
 ;   PROMPT - Message to display prior to prompting for dates
"RTN","RCTCSP2",296,0)
 ;OUTPUT:
"RTN","RCTCSP2",297,0)
 ;    1^BEGDT^ENDDT - Data found
"RTN","RCTCSP2",298,0)
 ;    0     - User up arrowed or timed out
"RTN","RCTCSP2",299,0)
 ;
"RTN","RCTCSP2",300,0)
 N %DT,Y,X,BEGDT,ENDDT,DTOUT,OUT,DIRUT,DUOUT,DIROUT,DTFROM,DTTO
"RTN","RCTCSP2",301,0)
 S OUT=0
"RTN","RCTCSP2",302,0)
 W !,$G(PROMPT)
"RTN","RCTCSP2",303,0)
 S %DT="AEX"
"RTN","RCTCSP2",304,0)
 S %DT("A")="Date Range: FROM: " ;Enter Beginning Date: "
"RTN","RCTCSP2",305,0)
 S %DT("B")="T-30"
"RTN","RCTCSP2",306,0)
 W !
"RTN","RCTCSP2",307,0)
 D ^%DT
"RTN","RCTCSP2",308,0)
 K %DT
"RTN","RCTCSP2",309,0)
 Q:Y<0 OUT  ;Quit if user time out or didn't enter valid date
"RTN","RCTCSP2",310,0)
 S DTFROM=+Y
"RTN","RCTCSP2",311,0)
 S %DT="AEX"
"RTN","RCTCSP2",312,0)
 S %DT("A")="      TO:   ",%DT("B")="T" ;"TODAY"
"RTN","RCTCSP2",313,0)
 D ^%DT
"RTN","RCTCSP2",314,0)
 K %DT
"RTN","RCTCSP2",315,0)
 ;Quit if user time out or didn't enter valid date
"RTN","RCTCSP2",316,0)
 Q:Y<0 OUT
"RTN","RCTCSP2",317,0)
 S DTTO=+Y
"RTN","RCTCSP2",318,0)
 S OUT=1_U_DTFROM_U_DTTO
"RTN","RCTCSP2",319,0)
 ;Switch dates if Begin Date is more recent than End Date
"RTN","RCTCSP2",320,0)
 S:DTFROM>DTTO OUT=1_U_DTTO_U_DTFROM
"RTN","RCTCSP2",321,0)
 Q OUT
"RTN","RCTCSP2",322,0)
 ;
"VER")
8.0^22.2
"BLD",10468,6)
^298
**END**
**END**

