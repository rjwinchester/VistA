EMERGENCY Released LEX*2*110 SEQ #99
Extracted from mail message
**KIDS**:LEX*2.0*110^

**INSTALL NAME**
LEX*2.0*110
"BLD",9933,0)
LEX*2.0*110^LEXICON UTILITY^0^3161213^y
"BLD",9933,1,0)
^^2^2^3161117^
"BLD",9933,1,1,0)
Please see the National Patch Module for details of the enhancements
"BLD",9933,1,2,0)
included in this patch.
"BLD",9933,4,0)
^9.64PA^^
"BLD",9933,6)
3^
"BLD",9933,6.3)
6
"BLD",9933,"INIT")
POST^LEX2110P
"BLD",9933,"KRN",0)
^9.67PA^779.2^20
"BLD",9933,"KRN",.4,0)
.4
"BLD",9933,"KRN",.401,0)
.401
"BLD",9933,"KRN",.402,0)
.402
"BLD",9933,"KRN",.403,0)
.403
"BLD",9933,"KRN",.5,0)
.5
"BLD",9933,"KRN",.84,0)
.84
"BLD",9933,"KRN",3.6,0)
3.6
"BLD",9933,"KRN",3.8,0)
3.8
"BLD",9933,"KRN",9.2,0)
9.2
"BLD",9933,"KRN",9.8,0)
9.8
"BLD",9933,"KRN",9.8,"NM",0)
^9.68A^5^5
"BLD",9933,"KRN",9.8,"NM",1,0)
LEX10CS^^0^B73860312
"BLD",9933,"KRN",9.8,"NM",2,0)
LEXSRC2^^0^B52722809
"BLD",9933,"KRN",9.8,"NM",3,0)
LEX10DBC^^0^B10828160
"BLD",9933,"KRN",9.8,"NM",4,0)
LEX10DBT^^0^B9864492
"BLD",9933,"KRN",9.8,"NM",5,0)
LEX2110P^^0^B756041
"BLD",9933,"KRN",9.8,"NM","B","LEX10CS",1)

"BLD",9933,"KRN",9.8,"NM","B","LEX10DBC",3)

"BLD",9933,"KRN",9.8,"NM","B","LEX10DBT",4)

"BLD",9933,"KRN",9.8,"NM","B","LEX2110P",5)

"BLD",9933,"KRN",9.8,"NM","B","LEXSRC2",2)

"BLD",9933,"KRN",19,0)
19
"BLD",9933,"KRN",19.1,0)
19.1
"BLD",9933,"KRN",101,0)
101
"BLD",9933,"KRN",409.61,0)
409.61
"BLD",9933,"KRN",771,0)
771
"BLD",9933,"KRN",779.2,0)
779.2
"BLD",9933,"KRN",870,0)
870
"BLD",9933,"KRN",8989.51,0)
8989.51
"BLD",9933,"KRN",8989.52,0)
8989.52
"BLD",9933,"KRN",8994,0)
8994
"BLD",9933,"KRN","B",.4,.4)

"BLD",9933,"KRN","B",.401,.401)

"BLD",9933,"KRN","B",.402,.402)

"BLD",9933,"KRN","B",.403,.403)

"BLD",9933,"KRN","B",.5,.5)

"BLD",9933,"KRN","B",.84,.84)

"BLD",9933,"KRN","B",3.6,3.6)

"BLD",9933,"KRN","B",3.8,3.8)

"BLD",9933,"KRN","B",9.2,9.2)

"BLD",9933,"KRN","B",9.8,9.8)

"BLD",9933,"KRN","B",19,19)

"BLD",9933,"KRN","B",19.1,19.1)

"BLD",9933,"KRN","B",101,101)

"BLD",9933,"KRN","B",409.61,409.61)

"BLD",9933,"KRN","B",771,771)

"BLD",9933,"KRN","B",779.2,779.2)

"BLD",9933,"KRN","B",870,870)

"BLD",9933,"KRN","B",8989.51,8989.51)

"BLD",9933,"KRN","B",8989.52,8989.52)

"BLD",9933,"KRN","B",8994,8994)

"BLD",9933,"QDEF")
^^^^NO^^^^^^NO
"BLD",9933,"QUES",0)
^9.62^^
"BLD",9933,"REQB",0)
^9.611^1^1
"BLD",9933,"REQB",1,0)
LEX*2.0*80^2
"BLD",9933,"REQB","B","LEX*2.0*80",1)

"INIT")
POST^LEX2110P
"MBREQ")
0
"PKG",167,-1)
1^1
"PKG",167,0)
LEXICON UTILITY^LEX^Medical and Biomedical Terminology System.^^^3030115
"PKG",167,20,0)
^9.402P^^
"PKG",167,22,0)
^9.49I^1^1
"PKG",167,22,1,0)
2.0^2950923^2950923^3
"PKG",167,22,1,"PAH",1,0)
110^3161213^123456789078
"PKG",167,22,1,"PAH",1,1,0)
^^2^2^3161213
"PKG",167,22,1,"PAH",1,1,1,0)
Please see the National Patch Module for details of the enhancements
"PKG",167,22,1,"PAH",1,1,2,0)
included in this patch.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
5
"RTN","LEX10CS")
0^1^B73860312^B72383021
"RTN","LEX10CS",1,0)
LEX10CS ;ISL/KER - ICD-10 Code Set ;11/16/2016
"RTN","LEX10CS",2,0)
 ;;2.0;LEXICON UTILITY;**80,110**;Sep 23, 1996;Build 6
"RTN","LEX10CS",3,0)
 ;               
"RTN","LEX10CS",4,0)
 ; Global Variables
"RTN","LEX10CS",5,0)
 ;    ^LEX(757.033        N/A
"RTN","LEX10CS",6,0)
 ;    ^TMP("LEXDX")       SACC 2.3.2.5.1
"RTN","LEX10CS",7,0)
 ;               
"RTN","LEX10CS",8,0)
 ; External References
"RTN","LEX10CS",9,0)
 ;    $$DTBR^ICDEX        ICR   5747
"RTN","LEX10CS",10,0)
 ;    $$ICDOP^ICDEX       ICR   5747
"RTN","LEX10CS",11,0)
 ;    $$LD^ICDEX          ICR   5747
"RTN","LEX10CS",12,0)
 ;    $$DT^XLFDT          ICR  10103
"RTN","LEX10CS",13,0)
 ;               
"RTN","LEX10CS",14,0)
ICDSRCH(X,LEXDATA,LEXD,LEXL,LEXF) ; ICD Diagnosis Search
"RTN","LEX10CS",15,0)
 ;
"RTN","LEX10CS",16,0)
 ; Input
"RTN","LEX10CS",17,0)
 ;
"RTN","LEX10CS",18,0)
 ;   X           Search Text (Required)
"RTN","LEX10CS",19,0)
 ;  .LEXDATA     Local Array (by Ref, Required)
"RTN","LEX10CS",20,0)
 ;   LEXD        Search Date (Optional,Default TODAY)
"RTN","LEX10CS",21,0)
 ;   LEXL        List Length (Optional, Default 30)
"RTN","LEX10CS",22,0)
 ;   LEXF        Filter (Optional, Default 10D)
"RTN","LEX10CS",23,0)
 ;
"RTN","LEX10CS",24,0)
 ;   LEXDATA()   Output Array of codes
"RTN","LEX10CS",25,0)
 ;
"RTN","LEX10CS",26,0)
 ;       LEXDATA(0)=# found ^ Pruning Indicator
"RTN","LEX10CS",27,0)
 ;       LEXDATA(1)=CODE ^ date
"RTN","LEX10CS",28,0)
 ;       LEXDATA(1,"IDL")=ICD-9/10 Description, Long
"RTN","LEX10CS",29,0)
 ;       LEXDATA(1,"IDL",1)=ICD-9/10 IEN ^ date
"RTN","LEX10CS",30,0)
 ;       LEXDATA(1,"IDS")=ICD-9/10 Description, Short
"RTN","LEX10CS",31,0)
 ;       LEXDATA(1,"IDS",1)=ICD-9/10 IEN ^ date
"RTN","LEX10CS",32,0)
 ;       LEXDATA(1,"LEX")=Lexicon Description
"RTN","LEX10CS",33,0)
 ;       LEXDATA(1,"LEX",1)=Expression IEN ^ date
"RTN","LEX10CS",34,0)
 ;       LEXDATA(1,"SYN",1)=Synonym #1
"RTN","LEX10CS",35,0)
 ;       LEXDATA(1,"SYN",m)=Synonym #m
"RTN","LEX10CS",36,0)
 ;       LEXDATA(n,0)=
"RTN","LEX10CS",37,0)
 ;
"RTN","LEX10CS",38,0)
 ;       Category or Subcategory
"RTN","LEX10CS",39,0)
 ;       LEXDATA(n,0)=Category Code
"RTN","LEX10CS",40,0)
 ;       LEXDATA(n,"CAT")=Category Name
"RTN","LEX10CS",41,0)
 ;       
"RTN","LEX10CS",42,0)
 ;   $$ICDSRCH
"RTN","LEX10CS",43,0)
 ;
"RTN","LEX10CS",44,0)
 ;     A variable defining success/error conditions
"RTN","LEX10CS",45,0)
 ;
"RTN","LEX10CS",46,0)
 ;        Positive number for success
"RTN","LEX10CS",47,0)
 ;
"RTN","LEX10CS",48,0)
 ;        Negative number for error or condition
"RTN","LEX10CS",49,0)
 ;
"RTN","LEX10CS",50,0)
 ;          "-1^No codes found"
"RTN","LEX10CS",51,0)
 ;          "-2^Too many items found, please refine search"
"RTN","LEX10CS",52,0)
 ;
"RTN","LEX10CS",53,0)
 K LEXDATA
"RTN","LEX10CS",54,0)
 N LEX,LEXX,LEXVDT,LEXCS,LEXFI,LEXFIL,LEXLEN,LEXTMP,LEXOK,LEXOUT,LEXTOT
"RTN","LEX10CS",55,0)
 N LEXPR,ICD10,LEXINC S LEXX=$$UP^XLFSTR($G(X))
"RTN","LEX10CS",56,0)
 Q:'$L(LEXX) "-1^No search string passed"
"RTN","LEX10CS",57,0)
 S ICD10=$$IMPDATE^LEXU("10D") I $L(LEXX)'>2 D  Q X
"RTN","LEX10CS",58,0)
 . S X="-1^Invalid search string passed, minimum of 3 characters"
"RTN","LEX10CS",59,0)
 S LEXVDT=$P($G(LEXD),".",1),LEXFIL=$G(LEXF) I LEXVDT'<ICD10 D  Q X
"RTN","LEX10CS",60,0)
 . S LEXCS=30,X=$$DIAGSRCH($G(LEXX),.LEXDATA,LEXVDT,$G(LEXL),$G(LEXF))
"RTN","LEX10CS",61,0)
 S LEXLEN=$G(LEXL) S:+LEXLEN'>0 LEXLEN=30
"RTN","LEX10CS",62,0)
 S:'$L(LEXFIL) LEXFIL="I $$SO^LEXU(Y,""ICD"",+($G(LEXVDT)))"
"RTN","LEX10CS",63,0)
 K LEXOUT S LEXCS=1 D I9T^LEX10DX(LEXX,.LEXOUT,LEXVDT,LEXLEN,LEXFIL)
"RTN","LEX10CS",64,0)
 S LEXTOT=$G(LEXOUT(0)),LEXPR=+($P($G(LEXTOT),"^",2)),LEXTOT=+LEXTOT
"RTN","LEX10CS",65,0)
 S LEXFI=80 D DXARY^LEX10DU K LEX,LEXOUT S:+LEXTOT'>0 LEXOUT="-1^No codes found"
"RTN","LEX10CS",66,0)
 I +LEXTOT>0&(LEXPR>0) D
"RTN","LEX10CS",67,0)
 . S LEXOUT="-2^Too many items found, please refine search"
"RTN","LEX10CS",68,0)
 S:+LEXTOT>0&(LEXPR'>0) LEXOUT=LEXTOT S X=LEXOUT
"RTN","LEX10CS",69,0)
 Q X
"RTN","LEX10CS",70,0)
 ;
"RTN","LEX10CS",71,0)
DIAGSRCH(X,LEXDATA,LEXD,LEXL,LEXF) ; ICD-10 Diagnosis Search
"RTN","LEX10CS",72,0)
 ;
"RTN","LEX10CS",73,0)
 ; Input
"RTN","LEX10CS",74,0)
 ;
"RTN","LEX10CS",75,0)
 ;   X           Search Text (Required)
"RTN","LEX10CS",76,0)
 ;  .LEXDATA     Local Array (by Ref, Required)
"RTN","LEX10CS",77,0)
 ;   LEXD        Search Date (Optional, Default TODAY)
"RTN","LEX10CS",78,0)
 ;   LEXL        List Length (Optional, Default 30)
"RTN","LEX10CS",79,0)
 ;   LEXF        Filter (Optional, Default 10D - must be executable M code)
"RTN","LEX10CS",80,0)
 ;
"RTN","LEX10CS",81,0)
 ; Output
"RTN","LEX10CS",82,0)
 ;
"RTN","LEX10CS",83,0)
 ;   LEXDATA()   Output Array of codes/categories found
"RTN","LEX10CS",84,0)
 ;
"RTN","LEX10CS",85,0)
 ;       LEXDATA(0)=# found ^ Pruning Indicator
"RTN","LEX10CS",86,0)
 ;       
"RTN","LEX10CS",87,0)
 ;       Code
"RTN","LEX10CS",88,0)
 ;       LEXDATA(1)=CODE ^ date
"RTN","LEX10CS",89,0)
 ;       LEXDATA(1,"IDL")=ICD-9/10 Description, Long
"RTN","LEX10CS",90,0)
 ;       LEXDATA(1,"IDL",1)=ICD-9/10 IEN ^ date
"RTN","LEX10CS",91,0)
 ;       LEXDATA(1,"IDS")=ICD-9/10 Description, Short
"RTN","LEX10CS",92,0)
 ;       LEXDATA(1,"IDS",1)=ICD-9/10 IEN ^ date
"RTN","LEX10CS",93,0)
 ;       LEXDATA(1,"LEX")=Lexicon Description
"RTN","LEX10CS",94,0)
 ;       LEXDATA(1,"LEX",1)=Expression IEN ^ date
"RTN","LEX10CS",95,0)
 ;       LEXDATA(1,"SYN",1)=Synonym #1
"RTN","LEX10CS",96,0)
 ;       LEXDATA(1,"SYN",m)=Synonym #m
"RTN","LEX10CS",97,0)
 ;       LEXDATA(1,"MENU")=Menu Text
"RTN","LEX10CS",98,0)
 ;       LEXDATA(1,"MSG")=Message (unversioned only)
"RTN","LEX10CS",99,0)
 ;       LEXDATA(n,0)=
"RTN","LEX10CS",100,0)
 ;
"RTN","LEX10CS",101,0)
 ;       Category or Subcategory
"RTN","LEX10CS",102,0)
 ;       LEXDATA(n,0)=Category Code
"RTN","LEX10CS",103,0)
 ;       LEXDATA(n,"CAT")=Category Name
"RTN","LEX10CS",104,0)
 ;
"RTN","LEX10CS",105,0)
 ;   $$DIAGSRCH  
"RTN","LEX10CS",106,0)
 ;
"RTN","LEX10CS",107,0)
 ;     A variable defining success/error conditions
"RTN","LEX10CS",108,0)
 ;
"RTN","LEX10CS",109,0)
 ;        Positive number for success
"RTN","LEX10CS",110,0)
 ;
"RTN","LEX10CS",111,0)
 ;        Negative number for error or condition
"RTN","LEX10CS",112,0)
 ;
"RTN","LEX10CS",113,0)
 ;          "-1^No codes found"
"RTN","LEX10CS",114,0)
 ;          "-2^Too many items found, please refine search"
"RTN","LEX10CS",115,0)
 ;          
"RTN","LEX10CS",116,0)
 K LEXDATA,^TMP("LEXDX",$J)
"RTN","LEX10CS",117,0)
 N LEX,LEXX,LEXVDT,LEXFI,LEXFIL,LEXLEN,LEXTMP,LEXOK,LEXOUT
"RTN","LEX10CS",118,0)
 N LEXTOT,LEXPR,LEXCS,LEXTLX,LEXIS,LEXINC
"RTN","LEX10CS",119,0)
 N ICDVDT,ICDSYS,ICDFMT
"RTN","LEX10CS",120,0)
 S X=$G(X) F  Q:$E(X,$L(X))'="+"  S X=$E(X,1,($L(X)-1))
"RTN","LEX10CS",121,0)
 S LEXX=$$UP^XLFSTR($G(X)),LEXVDT=$P($G(LEXD),".",1),LEXCS=30,LEXFIL=$G(LEXF)
"RTN","LEX10CS",122,0)
 Q:'$L(LEXX) "-1^No search string passed"
"RTN","LEX10CS",123,0)
 Q:$L(LEXX)'>1 "-1^Invalid search string passed"
"RTN","LEX10CS",124,0)
 I $L(LEXX)=2,LEXX?1A.1N D MAJ^LEX10DBR($$UP^XLFSTR(LEXX),.LEXOUT,LEXVDT) G OUT
"RTN","LEX10CS",125,0)
 S LEXLEN=$G(LEXL) S:+LEXLEN'>0 LEXLEN=30 S:+LEXLEN'>7 LEXLEN=8
"RTN","LEX10CS",126,0)
 S LEXIS=$$ISCAT^LEX10DU(LEXX)
"RTN","LEX10CS",127,0)
 ; Input is a category with no categories
"RTN","LEX10CS",128,0)
 ; and code exceeds max, expand the max
"RTN","LEX10CS",129,0)
 I +LEXIS>0,+($P(LEXIS,"^",2))'>0,+($P(LEXIS,"^",3))>LEXLEN S LEXLEN=99999
"RTN","LEX10CS",130,0)
 S:'$L(LEXFIL)&(LEXVDT?7N) LEXFIL="I $$SO^LEXU(Y,""10D"",+($G(LEXVDT)))"
"RTN","LEX10CS",131,0)
 S:'$L(LEXFIL)&(LEXVDT'?7N) LEXFIL="I $L($$D10^LEX10CS(+Y))"
"RTN","LEX10CS",132,0)
 S LEXTMP=LEXX S:$L(LEXTMP)=3&(LEXTMP'[".") LEXTMP=LEXTMP_"."
"RTN","LEX10CS",133,0)
 S LEXOK=0 I $L(LEXTMP)>3,$L(LEXTMP)'>8,LEXTMP["." D
"RTN","LEX10CS",134,0)
 . N LEXTK S:$D(^LEX(757.02,"ADX",(LEXTMP_" "))) LEXOK=1 Q:LEXOK
"RTN","LEX10CS",135,0)
 . S:$O(^LEX(757.02,"ADX",(LEXTMP_" ")))[LEXTMP LEXOK=1 Q:LEXOK
"RTN","LEX10CS",136,0)
 . S LEXTK=$$WDS(LEXTMP) S:$E(LEXTMP,1,4)'?1A2N1"."&(LEXTK'>0) LEXOK=-1
"RTN","LEX10CS",137,0)
 . S:$E(LEXTMP,1,4)?1A2N1"."&(LEXTK'>0) LEXOK=-1
"RTN","LEX10CS",138,0)
 K LEXOUT Q:LEXOK<0 "-1^Search string does not appear to be a code or text"
"RTN","LEX10CS",139,0)
 I LEXOK D I10C^LEX10DBC(LEXTMP,.LEXOUT,LEXVDT,LEXLEN,LEXFIL)
"RTN","LEX10CS",140,0)
 I 'LEXOK D I10T^LEX10DBT(LEXX,.LEXOUT,LEXVDT,LEXLEN,LEXFIL)
"RTN","LEX10CS",141,0)
OUT ; Out Array
"RTN","LEX10CS",142,0)
 K ^TMP("LEXDX",$J) I +($G(LEXOUT(0)))=-1 Q LEXOUT(0)
"RTN","LEX10CS",143,0)
 I +($G(LEXOUT(0)))=-2 Q -2_U_"final pruned list exceeds specified limit"
"RTN","LEX10CS",144,0)
 S LEXTOT=$G(LEXOUT(0)),LEXPR=+($P($G(LEXTOT),"^",2)),LEXTOT=+LEXTOT
"RTN","LEX10CS",145,0)
 S LEXTLX=$G(LEXOUT(0)) S LEXFI=80 D DXARY^LEX10DU
"RTN","LEX10CS",146,0)
 S LEXOUT=LEXTLX
"RTN","LEX10CS",147,0)
 S:+LEXTLX>0&(+LEXTLX=+($G(LEXDATA(0)))) LEXDATA(0)=LEXTLX
"RTN","LEX10CS",148,0)
 S:+LEXTOT'>0 LEXOUT="-1^No codes found"
"RTN","LEX10CS",149,0)
 S X=LEXOUT
"RTN","LEX10CS",150,0)
 Q X
"RTN","LEX10CS",151,0)
WDS(X) ; Words in String
"RTN","LEX10CS",152,0)
 S X=$G(X) Q:'$L(X) 0  K ^TMP("LEXTKN",$J) D PTX^LEXTOKN
"RTN","LEX10CS",153,0)
 N LEXI,LEXT,LEXC S (LEXI,LEXC)=0 F  S LEXI=$O(^TMP("LEXTKN",$J,LEXI)) Q:+LEXI'>0  D
"RTN","LEX10CS",154,0)
 . S LEXT="" F  S LEXT=$O(^TMP("LEXTKN",$J,LEXI,LEXT)) Q:'$L(LEXT)  D
"RTN","LEX10CS",155,0)
 . . S:$D(^LEX(757.01,"AWRD",LEXT)) LEXC=LEXC+1
"RTN","LEX10CS",156,0)
 S X=LEXC K ^TMP("LEXTKN",$J)
"RTN","LEX10CS",157,0)
 Q X
"RTN","LEX10CS",158,0)
 ;
"RTN","LEX10CS",159,0)
PCSDIG(X,LEXD) ; Return ICD-10 Codes Expanding On Input
"RTN","LEX10CS",160,0)
 ;
"RTN","LEX10CS",161,0)
 ; Input
"RTN","LEX10CS",162,0)
 ;
"RTN","LEX10CS",163,0)
 ;   X           Search code (partial, Required)
"RTN","LEX10CS",164,0)
 ;   LEXD        Search Date (Optional, Default TODAY)
"RTN","LEX10CS",165,0)
 ;
"RTN","LEX10CS",166,0)
 ; Output
"RTN","LEX10CS",167,0)
 ;
"RTN","LEX10CS",168,0)
 ;   LEXDATA()   Output Array containing the characters found
"RTN","LEX10CS",169,0)
 ;
"RTN","LEX10CS",170,0)
 ;       LEXDATA("NEXLEV",<next character>,"DESC")= Description
"RTN","LEX10CS",171,0)
 ;
"RTN","LEX10CS",172,0)
 ;       Output based on user input of "00P"
"RTN","LEX10CS",173,0)
 ;
"RTN","LEX10CS",174,0)
 ;          LEXPCDAT("NEXLEV",0,"DESC")="Brain"
"RTN","LEX10CS",175,0)
 ;          LEXPCDAT("NEXLEV",6,"DESC")="Cerebral Ventricle"
"RTN","LEX10CS",176,0)
 ;          LEXPCDAT("NEXLEV","E","DESC")="Cranial Nerve"
"RTN","LEX10CS",177,0)
 ;          LEXPCDAT("NEXLEV","U","DESC")="Spinal Canal"
"RTN","LEX10CS",178,0)
 ;          LEXPCDAT("NEXLEV","V",DESC)="Spinal Cord"
"RTN","LEX10CS",179,0)
 ;
"RTN","LEX10CS",180,0)
 ;       Output based on user input of "03120A1"
"RTN","LEX10CS",181,0)
 ;
"RTN","LEX10CS",182,0)
 ;          LEXPCDAT("PCSDESC")="BYPASS INNOMINATE ARTERY TO 
"RTN","LEX10CS",183,0)
 ;             LEFT UPPER ARM ARTERY ITH AUTOLOGOUS ARTERIAL 
"RTN","LEX10CS",184,0)
 ;             TISSUE, OPEN APPROACH"
"RTN","LEX10CS",185,0)
 ;          LEXPCDAT("STATUS")="1^Date"
"RTN","LEX10CS",186,0)
 ;
"RTN","LEX10CS",187,0)
 ;   $$PCSDIG  "1" - If input code fragment is valid or null
"RTN","LEX10CS",188,0)
 ;             "0" - If input code fragment is invalid
"RTN","LEX10CS",189,0)
 ;
"RTN","LEX10CS",190,0)
 K LEXPCDAT
"RTN","LEX10CS",191,0)
 N LEX,LEXI,LEXII,LEXCTL,LEXPCS,LEXEXIT,LEXLEN,LEXNXT,LEXCD,LELXI
"RTN","LEX10CS",192,0)
 S:$L($G(X)) X=$$UP^XLFSTR(X) S:$L($G(LEXD)) LEXD=$P($G(LEXD),".",1)
"RTN","LEX10CS",193,0)
 I $D(X),X'?."",('$D(^LEX(757.033,"B","10P"_X))) Q 0
"RTN","LEX10CS",194,0)
 S:'$D(X) LEXLEN=0,X=""
"RTN","LEX10CS",195,0)
 S:$D(X) LEXLEN=$L(X)
"RTN","LEX10CS",196,0)
 I LEXLEN>6 G PCSALL
"RTN","LEX10CS",197,0)
 S (LEXI,LEXEXIT)=0
"RTN","LEX10CS",198,0)
 F  S LEXI=$O(^LEX(757.033,"AFRAG",LEXI)) Q:'LEXI!LEXEXIT  D
"RTN","LEX10CS",199,0)
 . S:$D(^LEX(757.03,"ASAB","10P",LEXI)) LEXEXIT=1,LEXII=LEXI
"RTN","LEX10CS",200,0)
 S LEXCTL=X,LEXPCS=X_" ",LEXEXIT=0
"RTN","LEX10CS",201,0)
 F  S LEXPCS=$O(^LEX(757.033,"AFRAG",LEXII,LEXPCS)) Q:'$D(LEXPCS)!LEXEXIT  D
"RTN","LEX10CS",202,0)
 . I X'=$E(LEXPCS,1,LEXLEN)!(LEXPCS="") S LEXEXIT=1 Q
"RTN","LEX10CS",203,0)
 . N LEXOK S LEXOK=$$PCSOK(LEXPCS,$G(LEXD)) Q:LEXOK'>0
"RTN","LEX10CS",204,0)
 . S LEXNXT=$E(LEXPCS,LEXLEN+1)
"RTN","LEX10CS",205,0)
 . I '$D(LEXPCDAT("NEXLEV",LEXNXT,"DESC")) D
"RTN","LEX10CS",206,0)
 . . N LEXF,LEXFA
"RTN","LEX10CS",207,0)
 . . S LEXI="",LEXI=$O(^LEX(757.033,"B",("10P"_X_LEXNXT),LEXI))
"RTN","LEX10CS",208,0)
 . . S LEXF=$$FIN^LEX10PR(LEXI,$G(LEXD),.LEXFA)
"RTN","LEX10CS",209,0)
 . . S:$L($G(LEXFA(2))) LEXPCDAT("NEXLEV",LEXNXT,"DESC")=$G(LEXFA(2))
"RTN","LEX10CS",210,0)
 . . S:$L($G(LEXFA(3))) LEXPCDAT("NEXLEV",LEXNXT,"META","Definition")=$G(LEXFA(3))
"RTN","LEX10CS",211,0)
 . . S:$L($G(LEXFA(4))) LEXPCDAT("NEXLEV",LEXNXT,"META","Explanation")=$G(LEXFA(4))
"RTN","LEX10CS",212,0)
 . . S LEXF=0 F  S LEXF=$O(LEXFA(5,LEXF)) Q:+LEXF'>0  D
"RTN","LEX10CS",213,0)
 . . . S:$L($G(LEXFA(5,+LEXF))) LEXPCDAT("NEXLEV",LEXNXT,"META","Includes/Examples",LEXF)=$G(LEXFA(5,+LEXF))
"RTN","LEX10CS",214,0)
 . S LEXPCS=LEXCTL_LEXNXT_"~ "
"RTN","LEX10CS",215,0)
 S LEXPCDAT=1
"RTN","LEX10CS",216,0)
 Q 1
"RTN","LEX10CS",217,0)
PCSALL ; Return PCS data for full 7 digit code
"RTN","LEX10CS",218,0)
 N LEXLD,LEXA S LEXD=$P($G(LEXD),".",1) S:LEXD'?7N LEXD=$G(DT)
"RTN","LEX10CS",219,0)
 S:LEXD'?7N LEXD=$$DT^XLFDT S LEXD=$$DTBR^ICDEX(LEXD,0,31)
"RTN","LEX10CS",220,0)
 S LEXCD=$$ICDOP^ICDEX(X,LEXD,31,"E")
"RTN","LEX10CS",221,0)
 I $P(LEXCD,"^",1)="-1" Q 0
"RTN","LEX10CS",222,0)
 S:$P(LEXCD,"^",10)>0 LEXPCDAT("STATUS")=$P(LEXCD,"^",10)_"^"_$P(LEXCD,"^",13)
"RTN","LEX10CS",223,0)
 S:$P(LEXCD,"^",10)'>0 LEXPCDAT("STATUS")=$P(LEXCD,"^",10)_"^"_$P(LEXCD,"^",12)
"RTN","LEX10CS",224,0)
 S LEXLD=$$LD^ICDEX(80.1,+LEXCD,LEXD,.LEXA)
"RTN","LEX10CS",225,0)
 S LEXPCDAT("PCSDESC")=$G(LEXA(1))
"RTN","LEX10CS",226,0)
 Q 1
"RTN","LEX10CS",227,0)
PCSOK(X,LEXD) ; PCS data is OK
"RTN","LEX10CS",228,0)
 N LEXF,LEXO,LEXC,LEXN,LEXI,LEXS,LEXK S (LEXC,LEXF)=$TR($G(X)," ","") Q:'$L(LEXC) 0
"RTN","LEX10CS",229,0)
 S X=0,LEXD=$P($G(LEXD),".",1),LEXI=$$IMPDATE^LEXU(31) S:+LEXI>+LEXD LEXD=LEXI
"RTN","LEX10CS",230,0)
 S LEXO=$E(LEXF,1,($L(LEXF)-1))_$C($A($E(LEXF,$L(LEXF)))-1)_"~ "
"RTN","LEX10CS",231,0)
 F  S LEXO=$O(^LEX(757.02,"APR",LEXO)) Q:'$L(LEXO)  Q:$E(LEXO,1,$L(LEXC))'=LEXC  D  Q:X>0
"RTN","LEX10CS",232,0)
 . N LEXEF S LEXEF=$O(^LEX(757.02,"APR",LEXO,(LEXD+.001)),-1) Q:'$L(LEXEF)
"RTN","LEX10CS",233,0)
 . S:'$D(^LEX(757.02,"APR",LEXO,LEXEF,0)) X=1
"RTN","LEX10CS",234,0)
 Q X
"RTN","LEX10CS",235,0)
 ;
"RTN","LEX10CS",236,0)
CODELIST(X,LEXSPEC,LEXSUB,LEXD,LEXL,LEXF) ;
"RTN","LEX10CS",237,0)
 ; NOTE:  Routine split due to SACC Limits on size, see LEX10CS2
"RTN","LEX10CS",238,0)
 Q $$CODELIST^LEX10CS2($G(X),$G(LEXSPEC),$G(LEXSUB),$P($G(LEXD),".",1),$G(LEXL),$G(LEXF))
"RTN","LEX10CS",239,0)
TAX(X,LEXSRC,LEXDT,LEXSUB,LEXVER) ; Taxonomies
"RTN","LEX10CS",240,0)
 Q $$TAX^LEX10TAX($G(X),$G(LEXSRC),$P($G(LEXDT),".",1),$G(LEXSUB),$G(LEXVER))
"RTN","LEX10CS",241,0)
D10(LEX) ; Get One Code (unversioned)
"RTN","LEX10CS",242,0)
 N LEXA,LEXCD,LEXEF,LEXIEN,LEXSAB,LEXSIEN,LEXVDT
"RTN","LEX10CS",243,0)
 S LEXVDT="",LEXSAB="10D",LEXIEN=$G(LEX) Q:+($G(LEXIEN))'>0 ""
"RTN","LEX10CS",244,0)
 Q:$P($G(^LEX(757.01,LEXIEN,1)),"^",5)>0 ""
"RTN","LEX10CS",245,0)
 S LEXSIEN=0 F  S LEXSIEN=$O(^LEX(757.02,"B",LEXIEN,LEXSIEN)) Q:+LEXSIEN'>0  D
"RTN","LEX10CS",246,0)
 . N LEXEF,LEXCD Q:'$D(^LEX(757.02,"ASRC",LEXSAB,LEXSIEN))
"RTN","LEX10CS",247,0)
 . Q:$P($G(^LEX(757.02,LEXSIEN,0)),"^",7)'>0
"RTN","LEX10CS",248,0)
 . S LEXCD=$P($G(^LEX(757.02,+LEXSIEN,0)),"^",2) Q:'$L(LEXCD)
"RTN","LEX10CS",249,0)
 . S LEXEF=$O(^LEX(757.02,LEXSIEN,4,"B",(9999999+.001)),-1) Q:'$L(LEXEF)
"RTN","LEX10CS",250,0)
 . S LEXA(LEXEF,LEXCD)=""
"RTN","LEX10CS",251,0)
 S LEXEF=$O(LEXA((9999999+.001)),-1) Q:'$L(LEXEF) ""
"RTN","LEX10CS",252,0)
 S LEX=$O(LEXA(LEXEF,""),-1) Q:'$L(LEX) ""
"RTN","LEX10CS",253,0)
 Q LEX
"RTN","LEX10DBC")
0^3^B10828160^B9636063
"RTN","LEX10DBC",1,0)
LEX10DBC ;ISL/KER - ICD-10 Diagnosis Lookup by Code ;11/16/2016
"RTN","LEX10DBC",2,0)
 ;;2.0;LEXICON UTILITY;**80,110**;Sep 23, 1996;Build 6
"RTN","LEX10DBC",3,0)
 ;               
"RTN","LEX10DBC",4,0)
 ; Global Variables
"RTN","LEX10DBC",5,0)
 ;    ^TMP("LEXDX")       SACC 2.3.2.5.1
"RTN","LEX10DBC",6,0)
 ;               
"RTN","LEX10DBC",7,0)
 ; External References
"RTN","LEX10DBC",8,0)
 ;    ^DIM                ICR  10016
"RTN","LEX10DBC",9,0)
 ;    $$DT^XLFDT          ICR  10103
"RTN","LEX10DBC",10,0)
 ;               
"RTN","LEX10DBC",11,0)
I10C(LEXC,LEXA,LEXD,LEXN,LEXF) ; Lookup by Code, Return Pruned List
"RTN","LEX10DBC",12,0)
 ;
"RTN","LEX10DBC",13,0)
 ; Input
"RTN","LEX10DBC",14,0)
 ;   LEXC    ICD-10 DX Code       Required
"RTN","LEX10DBC",15,0)
 ;  .LEXA    Local Array (by Ref) Required
"RTN","LEX10DBC",16,0)
 ;   LEXD    Date (FM Format)     Optional (Default TODAY)
"RTN","LEX10DBC",17,0)
 ;   LEXL    Maximum to Return    Optional (Default = 30)
"RTN","LEX10DBC",18,0)
 ;   LEXF    Filter               Optional (Default 10D)
"RTN","LEX10DBC",19,0)
 ;  
"RTN","LEX10DBC",20,0)
 ; Output
"RTN","LEX10DBC",21,0)
 ; 
"RTN","LEX10DBC",22,0)
 ;   Code is found:
"RTN","LEX10DBC",23,0)
 ;   
"RTN","LEX10DBC",24,0)
 ;      LEXA(0)=# ^ PI  No to exceed lenght where possible
"RTN","LEX10DBC",25,0)
 ;      LEXA(#)=<code ien>_"^"_<code>_"^"_<activation date>
"RTN","LEX10DBC",26,0)
 ;      LEXA(#,0)=<expression ien>_"^"_<expression>
"RTN","LEX10DBC",27,0)
 ;   
"RTN","LEX10DBC",28,0)
 ;   No Code, Category is Returned:
"RTN","LEX10DBC",29,0)
 ;
"RTN","LEX10DBC",30,0)
 ;      LEXA(#)=<NULL>_"^"_<category>_"^"_<activation date> ^
"RTN","LEX10DBC",31,0)
 ;              <number of codes in the category>
"RTN","LEX10DBC",32,0)
 ;      LEXA(#,0)=<NULL>_"^"_<category name>
"RTN","LEX10DBC",33,0)
 ;   
"RTN","LEX10DBC",34,0)
 ;   Note:  Second piece of LEXA(0) is the pruning 
"RTN","LEX10DBC",35,0)
 ;          indicator and set to "1" if pruning
"RTN","LEX10DBC",36,0)
 ;          occurred
"RTN","LEX10DBC",37,0)
 ; 
"RTN","LEX10DBC",38,0)
 ; See WD^LEX10DP for DX Text Lookup by Keywords (Pruned)
"RTN","LEX10DBC",39,0)
 ; 
"RTN","LEX10DBC",40,0)
 K ^TMP("LEXDX",$J),LEXA N LEXSO,LEXCDT,LEXCT,LEXFIL,LEXNUM,LEXUSE
"RTN","LEX10DBC",41,0)
 N LEXFND,LEXTOT S LEXSO=$G(LEXC),LEXCDT=$G(LEXD),LEXNUM=+($G(LEXN))
"RTN","LEX10DBC",42,0)
 S LEXFIL=$G(LEXF) S LEXUSE=0 Q:'$L(LEXSO)
"RTN","LEX10DBC",43,0)
 S:$L(LEXSO)=3&(LEXSO'[".") LEXSO=LEXSO_"."
"RTN","LEX10DBC",44,0)
 S LEXA(0)=-1
"RTN","LEX10DBC",45,0)
 S:'$L(LEXFIL) LEXFIL="I $$SO^LEXU(Y,""10D"",+($G(LEXVDT)))"
"RTN","LEX10DBC",46,0)
 S:LEXNUM'>0 LEXNUM=30 S (LEXFND,LEXCT)=$$FIND(LEXSO,LEXCDT,LEXFIL)
"RTN","LEX10DBC",47,0)
 D REDUCE^LEX10DU(LEXNUM) D ARY^LEX10DU
"RTN","LEX10DBC",48,0)
 S LEXTOT=+($O(LEXA(" "),-1))
"RTN","LEX10DBC",49,0)
 S:LEXTOT>0&(LEXTOT<LEXFND) $P(LEXA(0),"^",2)=1
"RTN","LEX10DBC",50,0)
 K ^TMP("LEXDX",$J)
"RTN","LEX10DBC",51,0)
 Q
"RTN","LEX10DBC",52,0)
 ; Code Search
"RTN","LEX10DBC",53,0)
FIND(LEXC,LEXD,LEXF) ;   Find All Codes
"RTN","LEX10DBC",54,0)
 N LEX1,LEX2,LEXVDT,LEXCT,LEXFIL,LEXLEN,LEXNC,LEXNN,LEXOR,LEXPRE
"RTN","LEX10DBC",55,0)
 S LEXFIL=$G(LEXF) S:'$L(LEXFIL) LEXFIL="I 1"
"RTN","LEX10DBC",56,0)
 S LEXSO=$G(LEXC),LEXVDT=$G(LEXD)
"RTN","LEX10DBC",57,0)
 S LEXOR=$E(LEXSO,1,($L(LEXSO)-1))_$C($A($E(LEXSO,$L(LEXSO)))-1)_"~"
"RTN","LEX10DBC",58,0)
 S LEXNN="^LEX(757.02,""ADX"","""_LEXOR_" "")"
"RTN","LEX10DBC",59,0)
 S LEXNC="^LEX(757.02,""ADX"","""_LEXSO
"RTN","LEX10DBC",60,0)
 S (LEXPRE,LEXLEN,LEXCT)=0
"RTN","LEX10DBC",61,0)
 F  S LEXNN=$Q(@LEXNN) Q:'$L(LEXNN)!(LEXNN'[LEXNC)  D
"RTN","LEX10DBC",62,0)
 . N LEXC,LEXD,LEXE,LEXS,LEX1,LEX2
"RTN","LEX10DBC",63,0)
 . S LEXC=$P(LEXNN,",",3),LEXC=$TR(LEXC,"""",""),LEXC=$$TM(LEXC)
"RTN","LEX10DBC",64,0)
 . S LEXD=+($P(LEXNN,",",4)) Q:LEXD'?7N  Q:LEXVDT?7N&((LEXVDT+.001)'>LEXD)
"RTN","LEX10DBC",65,0)
 . S LEXS=+($P(LEXNN,",",5)) Q:LEXS'?1N  I LEXS="0" D  Q:LEXS'=1
"RTN","LEX10DBC",66,0)
 . . I LEXVDT?7N,(LEXVDT+.001)>+($G(LEXD)) D
"RTN","LEX10DBC",67,0)
 . . . S:$D(^TMP("LEXDX",$J,(LEXC_" "))) LEXCT=LEXCT-1 K ^TMP("LEXDX",$J,(LEXC_" "))
"RTN","LEX10DBC",68,0)
 . S LEX1=+($P(LEXNN,",",6)) Q:LEX1'?1N.N  Q:LEX1'>0
"RTN","LEX10DBC",69,0)
 . Q:$P($G(^LEX(757.02,+LEX1,0)),"^",5)'>0
"RTN","LEX10DBC",70,0)
 . S LEXE=+($G(^LEX(757.02,+LEX1,0))) Q:LEXE'?1N.N  Q:LEXE'>0
"RTN","LEX10DBC",71,0)
 . Q:$$SCR(LEXFIL,LEXE)'>0
"RTN","LEX10DBC",72,0)
 . S LEX2=+($P(LEXNN,",",7)) Q:LEX1'?1N.N  Q:LEX2'>0
"RTN","LEX10DBC",73,0)
 . Q:$P($G(^LEX(757.01,+LEXE,1)),"^",5)>0
"RTN","LEX10DBC",74,0)
 . S:$L(LEXC)>LEXLEN LEXPRE=LEXLEN,LEXLEN=$L(LEXC)
"RTN","LEX10DBC",75,0)
 . S:LEXPRE=0 LEXPRE=$L(LEXC) S:$L(LEXC)=(LEXLEN-1) LEXPRE=$L(LEXC)
"RTN","LEX10DBC",76,0)
 . S LEXCT=LEXCT+1,^TMP("LEXDX",$J,(LEXC_" "))=LEX1_"^"_LEXD
"RTN","LEX10DBC",77,0)
 Q LEXCT
"RTN","LEX10DBC",78,0)
 ; 
"RTN","LEX10DBC",79,0)
 ; Miscellaneous
"RTN","LEX10DBC",80,0)
SCR(X,Y) ;   Screen
"RTN","LEX10DBC",81,0)
 S Y=+($G(Y)) Q:+Y'>0 0  Q:'$D(^LEX(757.01,+Y,0)) 0
"RTN","LEX10DBC",82,0)
 N LEXFIL S LEXFIL=$G(X) Q:'$L(LEXFIL) 1  D ^DIM Q:'$D(X) 1
"RTN","LEX10DBC",83,0)
 X LEXFIL S X=$T
"RTN","LEX10DBC",84,0)
 Q X
"RTN","LEX10DBC",85,0)
TM(X,Y) ;   Trim Character Y - Default " "
"RTN","LEX10DBC",86,0)
 S X=$G(X) Q:X="" X  S Y=$G(Y) S:'$L(Y) Y=" "
"RTN","LEX10DBC",87,0)
 F  Q:$E(X,1)'=Y  S X=$E(X,2,$L(X))
"RTN","LEX10DBC",88,0)
 F  Q:$E(X,$L(X))'=Y  S X=$E(X,1,($L(X)-1))
"RTN","LEX10DBC",89,0)
 Q X
"RTN","LEX10DBT")
0^4^B9864492^B9014801
"RTN","LEX10DBT",1,0)
LEX10DBT ;ISL/KER - ICD-10 Diagnosis Lookup by Text ;11/30/2016
"RTN","LEX10DBT",2,0)
 ;;2.0;LEXICON UTILITY;**80,110**;Sep 23, 1996;Build 6
"RTN","LEX10DBT",3,0)
 ;               
"RTN","LEX10DBT",4,0)
 ; Global Variables
"RTN","LEX10DBT",5,0)
 ;    ^TMP("LEXDX"        SACC 2.3.2.5.1
"RTN","LEX10DBT",6,0)
 ;    ^TMP("LEXFND"       SACC 2.3.2.5.1
"RTN","LEX10DBT",7,0)
 ;    ^TMP("LEXHIT"       SACC 2.3.2.5.1
"RTN","LEX10DBT",8,0)
 ;    ^TMP("LEXSCH"       SACC 2.3.2.5.1
"RTN","LEX10DBT",9,0)
 ;               
"RTN","LEX10DBT",10,0)
 ; External References
"RTN","LEX10DBT",11,0)
 ;    $$DT^XLFDT          ICR  10103
"RTN","LEX10DBT",12,0)
 ;    $$FMDIFF^XLFDT      ICR  10103
"RTN","LEX10DBT",13,0)
 ;    $$NOW^XLFDT         ICR  10103
"RTN","LEX10DBT",14,0)
 ;               
"RTN","LEX10DBT",15,0)
 Q
"RTN","LEX10DBT",16,0)
I10T(X,LEXA,LEXD,LEXL,LEXF) ; Lookup by Text, Return Pruned List
"RTN","LEX10DBT",17,0)
 K ^TMP("LEXSCH",$J),^TMP("LEXFND",$J),^TMP("LEXHIT",$J)
"RTN","LEX10DBT",18,0)
 N DIC,LEXCT,LEXFIL,LEXLEN,LEXLI,LEXCDT,LEXVDT,LEXX,LEXPR,LEXPRL
"RTN","LEX10DBT",19,0)
 N LEXFND,LEXTOT,LEXPFL,LEXLV,LEXGV,LEXBG1,LEXEND,LEXBG2,LEXELP
"RTN","LEX10DBT",20,0)
 S LEXA(0)="-1" S LEXX=$G(X) Q:'$L(LEXX)
"RTN","LEX10DBT",21,0)
 S (LEXCDT,LEXVDT)=$G(LEXD),LEXFIL=$G(LEXF)
"RTN","LEX10DBT",22,0)
 S LEXLEN=1,LEXPR=0
"RTN","LEX10DBT",23,0)
 S LEXPRL=$G(LEXL) S:LEXPRL="" LEXPRL=30
"RTN","LEX10DBT",24,0)
 K ^TMP("LEXSCH",$J) D CONFIG^LEXSET("10D","10D")
"RTN","LEX10DBT",25,0)
 S ^TMP("LEXSCH",$J,"FIL",1)="Diagnosis"
"RTN","LEX10DBT",26,0)
 S ^TMP("LEXSCH",$J,"DIS",0)="ICD/10D/DS4/SCC/NAN/SCT"
"RTN","LEX10DBT",27,0)
 S ^TMP("LEXSCH",$J,"DIS",1)="Diagnosis"
"RTN","LEX10DBT",28,0)
 S ^TMP("LEXSCH",$J,"ADF",0)=1,LEXVDT=LEXCDT
"RTN","LEX10DBT",29,0)
 I LEXCDT'?7N D
"RTN","LEX10DBT",30,0)
 . S (DIC("S"),LEXFIL)="I $L($$D10^LEX10CS(+Y))",^TMP("LEXSCH",$J,"FIL",0)=LEXFIL
"RTN","LEX10DBT",31,0)
 . S ^TMP("LEXSCH",$J,"FIL",1)="Unversioned Diagnosis"
"RTN","LEX10DBT",32,0)
 . S ^TMP("LEXSCH",$J,"APP",0)=1 K ^TMP("LEXSCH",$J,"VDT") S LEXVDT=LEXCDT
"RTN","LEX10DBT",33,0)
 . S ^TMP("LEXSCH",$J,"DIS",0)="10D"
"RTN","LEX10DBT",34,0)
 . S ^TMP("LEXSCH",$J,"DIS",1)="ICD-10 Diagnosis"
"RTN","LEX10DBT",35,0)
 ;S:'$L(LEXFIL) LEXFIL="I $$SO^LEXU(Y,""10D"",+($G(LEXVDT)))"
"RTN","LEX10DBT",36,0)
 K LEX D LOOK^LEXA(LEXX,"10D",LEXLEN,"10D",LEXVDT)
"RTN","LEX10DBT",37,0)
 S LEXLV=+($G(LEX("LIST",0)))
"RTN","LEX10DBT",38,0)
 S LEXGV=$O(^TMP("LEXFND",$J,0),-1)
"RTN","LEX10DBT",39,0)
 S:+($G(LEX("LIST",0)))=LEXLEN&($O(^TMP("LEXFND",$J,0),-1)<0) LEXPR=1
"RTN","LEX10DBT",40,0)
 S LEXA(0)="-1^No matches found" Q:LEX=0
"RTN","LEX10DBT",41,0)
 ;S LEXA(0)="-1^Too many matches, please refine search" Q:+LEX>+LEXLEN
"RTN","LEX10DBT",42,0)
 S LEXA(0)=-1
"RTN","LEX10DBT",43,0)
 N LEXO,LEXN K ^TMP("LEXDX",$J)
"RTN","LEX10DBT",44,0)
 S LEXCT=0 S LEXN=0 F  S LEXN=$O(LEX("LIST",LEXN)) Q:+LEXN'>0  D
"RTN","LEX10DBT",45,0)
 . N LEXX,LEXIEN S LEXX=LEX("LIST",LEXN),LEXIEN=$P(LEXX,"^",1) D ADDDX
"RTN","LEX10DBT",46,0)
 S LEXO="" F  S LEXO=$O(^TMP("LEXFND",$J,LEXO)) Q:'$L(LEXO)  D
"RTN","LEX10DBT",47,0)
 . N LEXIEN S LEXIEN=0 F  S LEXIEN=$O(^TMP("LEXFND",$J,LEXO,LEXIEN)) Q:+LEXIEN'>0  D
"RTN","LEX10DBT",48,0)
 . . Q:+LEXO'<0  D ADDDX
"RTN","LEX10DBT",49,0)
 K ^TMP("LEXSCH",$J),^TMP("LEXFND",$J),^TMP("LEXHIT",$J)
"RTN","LEX10DBT",50,0)
 S LEXFND=+($G(LEXCT))
"RTN","LEX10DBT",51,0)
 D REDUCE^LEX10DU(LEXPRL)
"RTN","LEX10DBT",52,0)
 D ARY^LEX10DU
"RTN","LEX10DBT",53,0)
 S LEXTOT=+($O(LEXA(" "),-1))
"RTN","LEX10DBT",54,0)
 S:LEXTOT>0&(LEXTOT<LEXFND) $P(LEXA(0),"^",2)=1
"RTN","LEX10DBT",55,0)
 K ^TMP("LEXDX",$J)
"RTN","LEX10DBT",56,0)
 Q
"RTN","LEX10DBT",57,0)
ADDDX ; Add DX
"RTN","LEX10DBT",58,0)
 Q:+($G(LEXIEN))'>0  Q:'$D(^LEX(757.01,+($G(LEXIEN)),0))
"RTN","LEX10DBT",59,0)
 N LEXSO,LEXSTA,LEXEIEN,LEXSIEN,LEXSEFF S LEXSO=$$D10ONE^LEXU(+LEXIEN,LEXVDT)
"RTN","LEX10DBT",60,0)
 S:'$L(LEXSO)&($G(LEXCDT)'?7N) LEXSO=$$D10^LEX10CS(+LEXIEN) Q:'$L(LEXSO)
"RTN","LEX10DBT",61,0)
 S LEXSTA=$$STATCHK^LEXSRC2(LEXSO,LEXVDT,,30)
"RTN","LEX10DBT",62,0)
 Q:$G(LEXCDT)?7N&(+LEXSTA'>0)  S LEXSIEN=$P(LEXSTA,"^",2)
"RTN","LEX10DBT",63,0)
 S LEXSEFF=$P($P(LEXSTA,"^",3),".",1) Q:$G(LEXCDT)?7N&(LEXSEFF'?7N)
"RTN","LEX10DBT",64,0)
 Q:+($P($G(^LEX(757.02,+LEXSIEN,0)),"^",5))'>0
"RTN","LEX10DBT",65,0)
 S LEXEIEN=+($G(^LEX(757.02,+LEXSIEN,0))) Q:LEXEIEN'?1N.N
"RTN","LEX10DBT",66,0)
 Q:$P($G(^LEX(757.01,+LEXEIEN,1)),"^",5)>0
"RTN","LEX10DBT",67,0)
 S ^TMP("LEXDX",$J,(LEXSO_" "))=LEXSIEN_"^"_LEXSEFF
"RTN","LEX10DBT",68,0)
 S LEXCT=LEXCT+1
"RTN","LEX10DBT",69,0)
 Q
"RTN","LEX2110P")
0^5^B756041^n/a
"RTN","LEX2110P",1,0)
LEX2110P ;ISL/KER - LEX*2.0*110 Post Install ;09/06/2016
"RTN","LEX2110P",2,0)
 ;;2.0;LEXICON UTILITY;**110**;Sep 23, 1996;Build 6
"RTN","LEX2110P",3,0)
 ;               
"RTN","LEX2110P",4,0)
 ;               
"RTN","LEX2110P",5,0)
 ; Global Variables
"RTN","LEX2110P",6,0)
 ;    None
"RTN","LEX2110P",7,0)
 ;               
"RTN","LEX2110P",8,0)
 ; External References
"RTN","LEX2110P",9,0)
 ;    None
"RTN","LEX2110P",10,0)
 ;             
"RTN","LEX2110P",11,0)
 Q
"RTN","LEX2110P",12,0)
POST ; Post-Install
"RTN","LEX2110P",13,0)
 N LEXBUILD,LEXFY,LEXIGHF,LEXLREV,LEXMSG,LEXPTYPE,LEXQTR
"RTN","LEX2110P",14,0)
 N LEXREQP,LEXSHORT,LEXSUBH S LEXPTYPE="Code Set/API Fixes"
"RTN","LEX2110P",15,0)
 S LEXLREV=110,LEXBUILD="LEX*2.0*110",LEXIGHF="",LEXFY=""
"RTN","LEX2110P",16,0)
 S LEXQTR="",LEXSHORT="",LEXMSG="",LEXSUBH="Lexicon Fixes"
"RTN","LEX2110P",17,0)
 D POST^LEXXFI
"RTN","LEX2110P",18,0)
 Q
"RTN","LEXSRC2")
0^2^B52722809^B52534156
"RTN","LEXSRC2",1,0)
LEXSRC2 ;ISL/KER - Classification Code Source Util ;11/16/2016
"RTN","LEXSRC2",2,0)
 ;;2.0;LEXICON UTILITY;**25,28,73,80,110**;Sep 23, 1996;Build 6
"RTN","LEXSRC2",3,0)
 ;               
"RTN","LEXSRC2",4,0)
 ; Global Variables
"RTN","LEXSRC2",5,0)
 ;    None
"RTN","LEXSRC2",6,0)
 ;               
"RTN","LEXSRC2",7,0)
 ; External References
"RTN","LEXSRC2",8,0)
 ;    $$STATCHK^ICDEX     ICR   5747
"RTN","LEXSRC2",9,0)
 ;    $$SYS^ICDEX         ICR   5747
"RTN","LEXSRC2",10,0)
 ;    $$STATCHK^ICPTAPIU  ICR   1997
"RTN","LEXSRC2",11,0)
 ;    $$DT^XLFDT          ICR  10103
"RTN","LEXSRC2",12,0)
 ;    $$FMADD^XLFDT       ICR  10103
"RTN","LEXSRC2",13,0)
 ;               
"RTN","LEXSRC2",14,0)
 Q
"RTN","LEXSRC2",15,0)
CPT(LEXC,LEXVDT) ; Return Pointer to Active CPT
"RTN","LEXSRC2",16,0)
 ;                 
"RTN","LEXSRC2",17,0)
 ; Input  CPT Code
"RTN","LEXSRC2",18,0)
 ; Output IEN file 81 of Active Codes only
"RTN","LEXSRC2",19,0)
 S LEXC=$G(LEXC) Q:'$L(LEXC) ""  S LEXVDT=$G(LEXVDT) S:+LEXVDT'>0 LEXVDT=$$DT^XLFDT
"RTN","LEXSRC2",20,0)
 S LEXC=$$STATCHK^ICPTAPIU(LEXC,LEXVDT) Q:+LEXC'>0 ""  S LEXC=$P(LEXC,"^",2) Q:+LEXC'>0 ""
"RTN","LEXSRC2",21,0)
 Q +LEXC
"RTN","LEXSRC2",22,0)
 ;                
"RTN","LEXSRC2",23,0)
ICD(LEXC,LEXVDT) ; Return Pointer to Active ICD/ICP
"RTN","LEXSRC2",24,0)
 ;                 
"RTN","LEXSRC2",25,0)
 ; Input ICD Diagnosis or Procedure
"RTN","LEXSRC2",26,0)
 ; Output IEN file 80 or 80.1 of Active Codes only
"RTN","LEXSRC2",27,0)
 N LEXS S LEXC=$G(LEXC) Q:'$L(LEXC) ""  S LEXVDT=$G(LEXVDT) S:+LEXVDT'>0 LEXVDT=$$DT^XLFDT
"RTN","LEXSRC2",28,0)
 S LEXS=$$SYS^ICDEX(LEXC,LEXVDT),LEXC=$$STATCHK^ICDEX(LEXC,LEXVDT,$G(LEXS))
"RTN","LEXSRC2",29,0)
 Q:+LEXC'>0 ""  S LEXC=$P(LEXC,"^",2) Q:+LEXC'>0 ""
"RTN","LEXSRC2",30,0)
 Q +LEXC
"RTN","LEXSRC2",31,0)
 ;                
"RTN","LEXSRC2",32,0)
STATCHK(CODE,CDT,LEX,SAB) ; Check Status of a Code
"RTN","LEXSRC2",33,0)
 ;                      
"RTN","LEXSRC2",34,0)
 ; Input:
"RTN","LEXSRC2",35,0)
 ;   CODE - Any Code (ICD/CPT/DSM etc) (Required)
"RTN","LEXSRC2",36,0)
 ;   CDT  - Date to screen against (Optional, default TODAY)
"RTN","LEXSRC2",37,0)
 ;   LEX  - Output Array, passed by reference (Optional)
"RTN","LEXSRC2",38,0)
 ;   SAB  - Source Abbreviation or pointer to 757.03 (Optional)
"RTN","LEXSRC2",39,0)
 ;                      
"RTN","LEXSRC2",40,0)
 ; Output:
"RTN","LEXSRC2",41,0)
 ;                      
"RTN","LEXSRC2",42,0)
 ;   2, 3 or 4 Piece String containing the code's status,
"RTN","LEXSRC2",43,0)
 ;   the IEN, and if the status exist, the effective
"RTN","LEXSRC2",44,0)
 ;   date, else -1 in lieu of the IEN.
"RTN","LEXSRC2",45,0)
 ;           
"RTN","LEXSRC2",46,0)
 ;   The following are possible outputs:
"RTN","LEXSRC2",47,0)
 ;           
"RTN","LEXSRC2",48,0)
 ;       1 ^ IEN ^ Active Date   ^ Initial Date    Active Code
"RTN","LEXSRC2",49,0)
 ;       1 ^ IEN ^ Revision Date ^ Initial Date    Revised Code
"RTN","LEXSRC2",50,0)
 ;       0 ^ IEN ^ Effective Date                  Inactive Code
"RTN","LEXSRC2",51,0)
 ;       0 ^ IEN                                   Not Yet Active
"RTN","LEXSRC2",52,0)
 ;       0 ^ -1                                    Code not Found
"RTN","LEXSRC2",53,0)
 ;                      
"RTN","LEXSRC2",54,0)
 ;   ASTM Triplet in array LEX passed by reference (optional)
"RTN","LEXSRC2",55,0)
 ;                      
"RTN","LEXSRC2",56,0)
 ;   ASTM Triplet with Major Concept Map and Semantic
"RTN","LEXSRC2",57,0)
 ;   Map in array LEX passed by reference (optional)
"RTN","LEXSRC2",58,0)
 ;                    
"RTN","LEXSRC2",59,0)
 ;
"RTN","LEXSRC2",60,0)
 ;     LEX(0)  =  Code, a 2 Piece String containing:
"RTN","LEXSRC2",61,0)
 ;
"RTN","LEXSRC2",62,0)
 ;         1 - IEN in the CODES file #757.02
"RTN","LEXSRC2",63,0)
 ;         2 - the code (external)
"RTN","LEXSRC2",64,0)
 ;                    
"RTN","LEXSRC2",65,0)
 ;     LEX(1)  =  Expression, a 2 Piece String containing:
"RTN","LEXSRC2",66,0)
 ;
"RTN","LEXSRC2",67,0)
 ;         1 - IEN in the EXPRESSION file #757.01
"RTN","LEXSRC2",68,0)
 ;         2 - the code expression (external)
"RTN","LEXSRC2",69,0)
 ;
"RTN","LEXSRC2",70,0)
 ;     LEX(2)  =  Coding System, a 4 Piece String containing:
"RTN","LEXSRC2",71,0)
 ;
"RTN","LEXSRC2",72,0)
 ;         1 - IEN in the CODING SYSTEMS file #757.03
"RTN","LEXSRC2",73,0)
 ;         2 - Source Abbreviation (i.e., ICD or CPT)
"RTN","LEXSRC2",74,0)
 ;         3 - Source Nomenclature (i.e., ICD-9-CM or CPT-4)
"RTN","LEXSRC2",75,0)
 ;         4 - Source Full Name
"RTN","LEXSRC2",76,0)
 ;                    
"RTN","LEXSRC2",77,0)
 ;     LEX(3)  =  Major Concept, a 3 Piece String containing:
"RTN","LEXSRC2",78,0)
 ;
"RTN","LEXSRC2",79,0)
 ;         1 - IEN in the MAJOR CONCEPT MAP file #757
"RTN","LEXSRC2",80,0)
 ;         2 - IEN in the EXPRESSIONS file #757.01
"RTN","LEXSRC2",81,0)
 ;         3 - The Major Concept expression, which may be
"RTN","LEXSRC2",82,0)
 ;             different from the code's expression in LEX(1)
"RTN","LEXSRC2",83,0)
 ;                    
"RTN","LEXSRC2",84,0)
 ;     LEX(4,#)=  Semantics (multiple), a 5 Piece String:
"RTN","LEXSRC2",85,0)
 ;
"RTN","LEXSRC2",86,0)
 ;         1 - IEN in the SEMANTIC MAP file #757.1
"RTN","LEXSRC2",87,0)
 ;         2 - IEN in the SEMANTIC CLASS file #757.11
"RTN","LEXSRC2",88,0)
 ;         3 - IEN in the SEMANTIC TYPE file #757.12
"RTN","LEXSRC2",89,0)
 ;         4 - External Semantic Class
"RTN","LEXSRC2",90,0)
 ;         5 - External Semantic Type 
"RTN","LEXSRC2",91,0)
 ;     
"RTN","LEXSRC2",92,0)
 ; This API requires the ACT Cross-Reference
"RTN","LEXSRC2",93,0)
 ;       ^LEX(757.02,"ACT",<code>,<status>,<date>,<ien>)
"RTN","LEXSRC2",94,0)
 ;
"RTN","LEXSRC2",95,0)
 ; Variables used
"RTN","LEXSRC2",96,0)
 ;   LEXC      Code     from input parameter
"RTN","LEXSRC2",97,0)
 ;   LEXDT     Date     from input parameter
"RTN","LEXSRC2",98,0)
 ;   LEXSAB    Source   from input parameter (patch 57)
"RTN","LEXSRC2",99,0)
 ;   LEXAE     Last Activation IEN for SAB
"RTN","LEXSRC2",100,0)
 ;   LEXAP     Last Activation Date for SAB
"RTN","LEXSRC2",101,0)
 ;   LEXIE     Last Inactivation IEN for SAB
"RTN","LEXSRC2",102,0)
 ;   LEXIP     Last Inactivation Date for SAB
"RTN","LEXSRC2",103,0)
 ;   LEXED     Earliest Date Possible for SAB
"RTN","LEXSRC2",104,0)
 ;   LEXEE     Earliest Date IEN for SAB
"RTN","LEXSRC2",105,0)
 ;   LEXE      Counter (for Earliest loop)
"RTN","LEXSRC2",106,0)
 ;   LEXI      Counter (for IEN loop)
"RTN","LEXSRC2",107,0)
 ;   LEXMR     Most Recent Date
"RTN","LEXSRC2",108,0)
 ;   LEXMRI    IEN for Most Recent Date for SAB
"RTN","LEXSRC2",109,0)
 ;   LEXN      Data Node
"RTN","LEXSRC2",110,0)
 ;   LEXO      Temporary Value for $O Loops
"RTN","LEXSRC2",111,0)
 ;   LEXSTAT   Status
"RTN","LEXSRC2",112,0)
 ;   LEXTDT    Input Date Offset
"RTN","LEXSRC2",113,0)
 ;   X         Output
"RTN","LEXSRC2",114,0)
 ;   LEX       Output Array (when passed)
"RTN","LEXSRC2",115,0)
 ;   
"RTN","LEXSRC2",116,0)
 ; Integration Agreement
"RTN","LEXSRC2",117,0)
 ;   4083     $$STATCHK^LEXSRC2()
"RTN","LEXSRC2",118,0)
 ;              
"RTN","LEXSRC2",119,0)
 N LEXAE,LEXAP,LEXC,LEXDT,LEXE,LEXED,LEXEE,LEXI,LEXIE,LEXIP,LEXMR
"RTN","LEXSRC2",120,0)
 N LEXMRI,LEXN,LEXINIT,LEXO,LEXSAB,LEXSTAT,LEXTDT,X
"RTN","LEXSRC2",121,0)
 S LEXC=$G(CODE) I '$L(LEXC) S (LEX,X)="0^-1" D UPD Q X
"RTN","LEXSRC2",122,0)
 S LEXDT=$P($G(CDT),".",1),LEXDT=$S(+LEXDT>0:LEXDT,1:$$DT^XLFDT)
"RTN","LEXSRC2",123,0)
 S LEXSAB=$$SAB($G(SAB)),LEXTDT=LEXDT+.00001
"RTN","LEXSRC2",124,0)
 ; Find preceding active date/IEN for SAB           LEXAP/LEXAE
"RTN","LEXSRC2",125,0)
 ;   and earliest possible active date/IEN for SAB  LEXED/LEXEE
"RTN","LEXSRC2",126,0)
 S (LEXED,LEXEE,LEXAE,LEXAP)="",LEXO=LEXTDT F  S LEXO=$O(^LEX(757.02,"ACT",(LEXC_" "),3,LEXO),-1) D  Q:+LEXO'>0
"RTN","LEXSRC2",127,0)
 . I '$L(LEXO)!(+LEXO'>0) D  Q
"RTN","LEXSRC2",128,0)
 . . N LEXE S LEXE=LEXTDT F  S LEXE=$O(^LEX(757.02,"ACT",(LEXC_" "),1,LEXE)) Q:+LEXE'>0  D  Q:+LEXED>0&(+LEXEE>0)
"RTN","LEXSRC2",129,0)
 . . . N LEXI S LEXI=0 F  S LEXI=$O(^LEX(757.02,"ACT",(LEXC_" "),1,LEXE,LEXI)) Q:+LEXI'>0  D  Q:+LEXED>0&(+LEXEE>0)
"RTN","LEXSRC2",130,0)
 . . . . Q:+LEXED>0&(+LEXEE>0)  N LEXN S LEXN=$G(^LEX(757.02,+LEXI,0)) Q:+LEXSAB>0&($P(LEXN,"^",3)'=+LEXSAB)
"RTN","LEXSRC2",131,0)
 . . . . S:'$L(LEXED) LEXED=LEXE S:'$L(LEXEE) LEXEE=LEXI
"RTN","LEXSRC2",132,0)
 . N LEXI S LEXI=" " F  S LEXI=$O(^LEX(757.02,"ACT",(LEXC_" "),3,LEXO,LEXI),-1) Q:+LEXI'>0  D
"RTN","LEXSRC2",133,0)
 . . N LEXN S LEXN=$G(^LEX(757.02,+LEXI,0)) Q:+LEXSAB>0&($P(LEXN,"^",3)'=+LEXSAB)
"RTN","LEXSRC2",134,0)
 . . S:'$L(LEXAP) LEXAP=LEXO S:'$L(LEXAE) LEXAE=LEXI
"RTN","LEXSRC2",135,0)
 ; Find preceding inactive date/IEN for SAB         LEXIP/LEXIE
"RTN","LEXSRC2",136,0)
 N LEXO,LEXIP,LEXIE S (LEXIE,LEXIP)="",LEXO=LEXTDT F  S LEXO=$O(^LEX(757.02,"ACT",LEXC_" ",2,LEXO),-1) Q:+LEXO'>0  D
"RTN","LEXSRC2",137,0)
 . N LEXI S LEXI=" " F  S LEXI=$O(^LEX(757.02,"ACT",LEXC_" ",2,LEXO,LEXI),-1) Q:+LEXI'>0  D
"RTN","LEXSRC2",138,0)
 . . N LEXN S LEXN=$G(^LEX(757.02,+LEXI,0)) Q:+LEXSAB>0&($P(LEXN,"^",3)'=+LEXSAB)
"RTN","LEXSRC2",139,0)
 . . S:'$L(LEXIP) LEXIP=LEXO S:'$L(LEXIE) LEXIE=LEXI
"RTN","LEXSRC2",140,0)
 ; Quit if input date is before earliest date
"RTN","LEXSRC2",141,0)
 I +LEXAP'>0,+LEXIP'>0,+LEXEE>0,+LEXED>0,LEXED?7N,LEXED>LEXDT S X="0^"_LEXEE D UPD Q X
"RTN","LEXSRC2",142,0)
 ; Quit if both active/inactive dates are zero
"RTN","LEXSRC2",143,0)
 I +LEXAP=0,+LEXIP=0 S (LEX,X)="0^-1" D UPD Q X
"RTN","LEXSRC2",144,0)
 ; Find the most recent date/IEN/Status LEXMR/LEXMRI/LEXSTAT
"RTN","LEXSRC2",145,0)
 S:LEXAP>LEXIP!(LEXAP=LEXIP) LEXMR=LEXAP,LEXMRI=LEXAE,LEXSTAT=1
"RTN","LEXSRC2",146,0)
 S:LEXAP<LEXIP LEXMR=LEXIP,LEXMRI=LEXIE,LEXSTAT=0
"RTN","LEXSRC2",147,0)
 ; Check for difficulties from date errors for SAB
"RTN","LEXSRC2",148,0)
 D ADJ
"RTN","LEXSRC2",149,0)
 S LEXINIT="" I LEXMR?7N,LEXSTAT>0 S LEXINIT=$$INIT(LEXC,LEXMR)
"RTN","LEXSRC2",150,0)
 ; Quit with status, code IEN and effective date
"RTN","LEXSRC2",151,0)
 S (LEX,X)=LEXSTAT_"^"_LEXMRI_"^"_LEXMR D UPD
"RTN","LEXSRC2",152,0)
 S:(LEXMR?7N)&(LEXSTAT>0)&(LEXINIT?7N)&(LEXMR'=LEXINIT) $P(LEX,"^",4)=LEXINIT,X=LEX
"RTN","LEXSRC2",153,0)
 Q X
"RTN","LEXSRC2",154,0)
SAB(X) ; Resolve SAB
"RTN","LEXSRC2",155,0)
 N Y S Y=$G(X) Q:'$L($G(Y)) ""  S X=+($O(^LEX(757.03,"ASAB",$E($G(Y),1,3),0))) Q:+X>0 X  S X=+Y Q:$D(^LEX(757.03,+Y,0)) X
"RTN","LEXSRC2",156,0)
 Q ""
"RTN","LEXSRC2",157,0)
ADJ ; Do we have adjacent dates for SAB
"RTN","LEXSRC2",158,0)
 N LEXND,LEXNI,LEXNS,LEXNO,LEXN S LEXND=$$FMADD^XLFDT($G(LEXMR),1)
"RTN","LEXSRC2",159,0)
 S LEXNO='LEXSTAT,LEXNS=2+LEXNO Q:LEXND'?7N
"RTN","LEXSRC2",160,0)
 S LEXNI=$O(^LEX(757.02,"ACT",(LEXC_" "),LEXNS,LEXND," "),-1)
"RTN","LEXSRC2",161,0)
 Q:+LEXNI'>0  S LEXN=$G(^LEX(757.02,+LEXMRI,0))
"RTN","LEXSRC2",162,0)
 I +($G(LEXSAB))>0&($P(LEXN,"^",3)=+($G(LEXSAB))) S LEXSTAT=LEXNO,LEXMR=LEXND,LEXMRI=LEXNI
"RTN","LEXSRC2",163,0)
 Q
"RTN","LEXSRC2",164,0)
INIT(X,Y) ; Inital Activation Dates (revised codes only)
"RTN","LEXSRC2",165,0)
 N LEXA,LEXC,LEXI,LEXOFF,LEXMR S LEXC=$G(X),LEXMR=$P($G(Y),".",1),X="" Q:'$L($G(LEXC)) ""  Q:$G(LEXMR)'?7N ""
"RTN","LEXSRC2",166,0)
 S:'$D(^LEX(757.02,"ACT",(LEXC_" "),1,LEXMR)) LEXMR=$O(^LEX(757.02,"ACT",(LEXC_" "),1,LEXMR),-1) Q:$G(LEXMR)'?7N ""
"RTN","LEXSRC2",167,0)
 S LEXA=(LEXMR-.001) S LEXOFF=$$FMADD^XLFDT(LEXMR,-1)
"RTN","LEXSRC2",168,0)
 F  S LEXA=$O(^LEX(757.02,"ACT",(LEXC_" "),1,LEXA),-1) Q:LEXA'?7N  D
"RTN","LEXSRC2",169,0)
 . S LEXI=$O(^LEX(757.02,"ACT",(LEXC_" "),0,LEXA))
"RTN","LEXSRC2",170,0)
 . I LEXI>LEXA,LEXI?7N,LEXI'<LEXOFF S X=LEXA
"RTN","LEXSRC2",171,0)
 S:'$L(X)&(LEXMR?7N) X=LEXMR
"RTN","LEXSRC2",172,0)
 Q X
"RTN","LEXSRC2",173,0)
UPD ; Update Array
"RTN","LEXSRC2",174,0)
 N LEXI,LEXC,LEXN,LEXM,LEXE,LEXS,LEXC S LEXI=+($P($G(X),"^",2)) Q:+LEXI'>0
"RTN","LEXSRC2",175,0)
 S LEXN=$G(^LEX(757.02,+LEXI,0)),LEXE=+LEXN,LEXC=$P(LEXN,"^",2)
"RTN","LEXSRC2",176,0)
 S LEXS=+($P(LEXN,"^",3)),LEXM=+($P(LEXN,"^",4)),LEX(0)=+LEXI_"^"_LEXC
"RTN","LEXSRC2",177,0)
 S LEX(1)=LEXE_"^"_$P($G(^LEX(757.01,+LEXE,0)),"^",1)
"RTN","LEXSRC2",178,0)
 S LEX(2)=LEXS_"^"_$P($G(^LEX(757.03,+LEXS,0)),"^",1,3)
"RTN","LEXSRC2",179,0)
 S LEX(3)=LEXM_"^"_$P($G(^LEX(757,+LEXM,0)),"^",1)_"^"_$G(^LEX(757.01,+($P($G(^LEX(757,+LEXM,0)),"^",1)),0))
"RTN","LEXSRC2",180,0)
 S (LEXI,LEXS)=0 F  S LEXS=$O(^LEX(757.1,"B",+LEXM,LEXS)) Q:+LEXS'>0  D
"RTN","LEXSRC2",181,0)
 . N LEXN,LEXC,LEXT,LEXCT,LEXTT S LEXN=$G(^LEX(757.1,+LEXS,0)),LEXC=$P(LEXN,"^",2),LEXT=$P(LEXN,"^",3)
"RTN","LEXSRC2",182,0)
 . S LEXCT=$P($G(^LEX(757.11,+LEXC,0)),"^",2),LEXTT=$P($G(^LEX(757.12,+LEXT,0)),"^",2)
"RTN","LEXSRC2",183,0)
 . I LEXC>0,LEXT>0,$L(LEXCT),$L(LEXTT)  D
"RTN","LEXSRC2",184,0)
 . . S LEXI=LEXI+1,LEX(4,LEXI)=LEXS_"^"_LEXC_"^"_LEXT_"^"_LEXCT_"^"_LEXTT
"RTN","LEXSRC2",185,0)
 Q
"RTN","LEXSRC2",186,0)
PI(X) ; Preferred IEN for code X
"RTN","LEXSRC2",187,0)
 N LEXE,LEXLA,LEXA,LEXS,LEXC,LEXP,LEXPF,LEXF,LEXI,LEXC,LEXFL
"RTN","LEXSRC2",188,0)
 S LEXC=$G(X) Q:'$L(LEXC) ""  S (LEXP,LEXF,LEXI)=0,LEXPF(0)=LEXC
"RTN","LEXSRC2",189,0)
 F  S LEXI=$O(^LEX(757.02,"CODE",(LEXC_" "),LEXI)) Q:+LEXI=0!(LEXP>0)  D
"RTN","LEXSRC2",190,0)
 . S:+LEXF'>0 LEXF=LEXI S LEXFL=$S(+($P($G(^LEX(757.02,+LEXI,0)),"^",5))>0:1,1:0)
"RTN","LEXSRC2",191,0)
 . S LEXE=0,LEXLA="" F  S LEXE=$O(^LEX(757.02,+LEXI,4,LEXE)) Q:+LEXE=0  D
"RTN","LEXSRC2",192,0)
 . . S LEXS=$P($G(^LEX(757.02,+LEXI,4,LEXE,0)),"^",2) Q:+LEXS'>0
"RTN","LEXSRC2",193,0)
 . . S LEXA=$P($G(^LEX(757.02,+LEXI,4,LEXE,0)),"^",1)
"RTN","LEXSRC2",194,0)
 . . S:+LEXA>+LEXLA LEXLA=+LEXA
"RTN","LEXSRC2",195,0)
 . S:+LEXLA>0 LEXPF(LEXFL,LEXLA,LEXI)=""
"RTN","LEXSRC2",196,0)
 S X="" I $D(LEXPF(1)) S X=$O(LEXPF(1," "),-1),X=$O(LEXPF(1,+X," "),-1)
"RTN","LEXSRC2",197,0)
 I '$D(LEXPF(1)),$D(LEXPF(0)) S X=$O(LEXPF(0," "),-1),X=$O(LEXPF(0,+X," "),-1)
"RTN","LEXSRC2",198,0)
 Q X
"VER")
8.0^22.0
"BLD",9933,6)
^99
**END**
**END**

