Released LEX*2*114 SEQ #107
Extracted from mail message
**KIDS**:LEX*2.0*114^

**INSTALL NAME**
LEX*2.0*114
"BLD",10213,0)
LEX*2.0*114^LEXICON UTILITY^0^3171010^y
"BLD",10213,1,0)
^^2^2^3170907^
"BLD",10213,1,1,0)
Please see the National Patch Module for details of the enhancements 
"BLD",10213,1,2,0)
included in this patch.
"BLD",10213,4,0)
^9.64PA^^
"BLD",10213,6)
1^
"BLD",10213,6.3)
1
"BLD",10213,"INIT")
POST^LEX2114
"BLD",10213,"KRN",0)
^9.67PA^779.2^20
"BLD",10213,"KRN",.4,0)
.4
"BLD",10213,"KRN",.401,0)
.401
"BLD",10213,"KRN",.402,0)
.402
"BLD",10213,"KRN",.403,0)
.403
"BLD",10213,"KRN",.5,0)
.5
"BLD",10213,"KRN",.84,0)
.84
"BLD",10213,"KRN",3.6,0)
3.6
"BLD",10213,"KRN",3.8,0)
3.8
"BLD",10213,"KRN",9.2,0)
9.2
"BLD",10213,"KRN",9.8,0)
9.8
"BLD",10213,"KRN",9.8,"NM",0)
^9.68A^7^7
"BLD",10213,"KRN",9.8,"NM",1,0)
LEXXMC^^0^B208378117
"BLD",10213,"KRN",9.8,"NM",2,0)
LEXQIDA^^0^B53902820
"BLD",10213,"KRN",9.8,"NM",3,0)
LEXQIPA^^0^B5203203
"BLD",10213,"KRN",9.8,"NM",4,0)
LEX2114^^0^B43529314
"BLD",10213,"KRN",9.8,"NM",5,0)
LEXQIL^^0^B98232990
"BLD",10213,"KRN",9.8,"NM",6,0)
LEXQID^^0^B63365392
"BLD",10213,"KRN",9.8,"NM",7,0)
LEXQIP^^0^B97355385
"BLD",10213,"KRN",9.8,"NM","B","LEX2114",4)

"BLD",10213,"KRN",9.8,"NM","B","LEXQID",6)

"BLD",10213,"KRN",9.8,"NM","B","LEXQIDA",2)

"BLD",10213,"KRN",9.8,"NM","B","LEXQIL",5)

"BLD",10213,"KRN",9.8,"NM","B","LEXQIP",7)

"BLD",10213,"KRN",9.8,"NM","B","LEXQIPA",3)

"BLD",10213,"KRN",9.8,"NM","B","LEXXMC",1)

"BLD",10213,"KRN",19,0)
19
"BLD",10213,"KRN",19.1,0)
19.1
"BLD",10213,"KRN",101,0)
101
"BLD",10213,"KRN",409.61,0)
409.61
"BLD",10213,"KRN",771,0)
771
"BLD",10213,"KRN",779.2,0)
779.2
"BLD",10213,"KRN",870,0)
870
"BLD",10213,"KRN",8989.51,0)
8989.51
"BLD",10213,"KRN",8989.52,0)
8989.52
"BLD",10213,"KRN",8994,0)
8994
"BLD",10213,"KRN","B",.4,.4)

"BLD",10213,"KRN","B",.401,.401)

"BLD",10213,"KRN","B",.402,.402)

"BLD",10213,"KRN","B",.403,.403)

"BLD",10213,"KRN","B",.5,.5)

"BLD",10213,"KRN","B",.84,.84)

"BLD",10213,"KRN","B",3.6,3.6)

"BLD",10213,"KRN","B",3.8,3.8)

"BLD",10213,"KRN","B",9.2,9.2)

"BLD",10213,"KRN","B",9.8,9.8)

"BLD",10213,"KRN","B",19,19)

"BLD",10213,"KRN","B",19.1,19.1)

"BLD",10213,"KRN","B",101,101)

"BLD",10213,"KRN","B",409.61,409.61)

"BLD",10213,"KRN","B",771,771)

"BLD",10213,"KRN","B",779.2,779.2)

"BLD",10213,"KRN","B",870,870)

"BLD",10213,"KRN","B",8989.51,8989.51)

"BLD",10213,"KRN","B",8989.52,8989.52)

"BLD",10213,"KRN","B",8994,8994)

"BLD",10213,"PRE")
LEX2114
"BLD",10213,"QDEF")
^^^^NO^^^^^^NO
"BLD",10213,"QUES",0)
^9.62^^
"BLD",10213,"REQB",0)
^9.611^2^2
"BLD",10213,"REQB",1,0)
LEX*2.0*103^2
"BLD",10213,"REQB",2,0)
LEX*2.0*113^2
"BLD",10213,"REQB","B","LEX*2.0*103",1)

"BLD",10213,"REQB","B","LEX*2.0*113",2)

"INIT")
POST^LEX2114
"MBREQ")
0
"PKG",167,-1)
1^1
"PKG",167,0)
LEXICON UTILITY^LEX^Medical and Biomedical Terminology System.^^^3030115
"PKG",167,20,0)
^9.402P^^
"PKG",167,22,0)
^9.49I^1^1
"PKG",167,22,1,0)
2.0^2950923^2950923^3
"PKG",167,22,1,"PAH",1,0)
114^3171010^123456789211
"PKG",167,22,1,"PAH",1,1,0)
^^2^2^3171010
"PKG",167,22,1,"PAH",1,1,1,0)
Please see the National Patch Module for details of the enhancements 
"PKG",167,22,1,"PAH",1,1,2,0)
included in this patch.
"PRE")
LEX2114
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
7
"RTN","LEX2114")
0^4^B43529314^n/a
"RTN","LEX2114",1,0)
LEX2114 ;ISL/KER - LEX*2.0*114 Env Check ;10/10/2017
"RTN","LEX2114",2,0)
 ;;2.0;LEXICON UTILITY;**114**;Sep 23, 1996;Build 1
"RTN","LEX2114",3,0)
 ;               
"RTN","LEX2114",4,0)
 ; Global Variables
"RTN","LEX2114",5,0)
 ;    None
"RTN","LEX2114",6,0)
 ;               
"RTN","LEX2114",7,0)
 ; External References
"RTN","LEX2114",8,0)
 ;    FIND^DIC            ICR   2051
"RTN","LEX2114",9,0)
 ;    $$IENS^DILF         ICR   2054
"RTN","LEX2114",10,0)
 ;    EN^DIQ1             ICR  10015
"RTN","LEX2114",11,0)
 ;    $$FMTE^XLFDT        ICR  10103
"RTN","LEX2114",12,0)
 ;    $$PATCH^XPDUTL      ICR  10141
"RTN","LEX2114",13,0)
 ;    $$PKG^XPDUTL        ICR  10141
"RTN","LEX2114",14,0)
 ;    $$VERSION^XPDUTL    ICR  10141
"RTN","LEX2114",15,0)
 ;    $$VER^XPDUTL        ICR  10141
"RTN","LEX2114",16,0)
 ;    BMES^XPDUTL         ICR  10141
"RTN","LEX2114",17,0)
 ;    MES^XPDUTL          ICR  10141
"RTN","LEX2114",18,0)
 ;               
"RTN","LEX2114",19,0)
 ; Local Variables NEWed or KILLed by Kernel Installation
"RTN","LEX2114",20,0)
 ; and Distribution System (KIDS):
"RTN","LEX2114",21,0)
 ; 
"RTN","LEX2114",22,0)
 ;     XPDABORT,XPDDIQ,XPDQUIT
"RTN","LEX2114",23,0)
 ;               
"RTN","LEX2114",24,0)
 ;     see Kernel Developer Guide, Chapter 14, 
"RTN","LEX2114",25,0)
 ;     KIDS Developer Tools, Advanced Build Techniques
"RTN","LEX2114",26,0)
 ;     
"RTN","LEX2114",27,0)
ENV ; Environment Check
"RTN","LEX2114",28,0)
 N LEXPTYPE,LEXLREV,LEXREQP,LEXBUILD,LEXIGHF,LEXFY,LEXQTR,LEXG,LEXB,LEXE,LEXR,LEXSTR,LEXOK D IMP
"RTN","LEX2114",29,0)
 K XPDDIQ("XPZ1","B"),XPDDIQ("XPI1","B") S XPDDIQ("XPZ1","B")="NO",XPDDIQ("XPI1","B")="NO",XPDNOQUE=1
"RTN","LEX2114",30,0)
 S LEXSTR=$G(LEXPTYPE) S:$L($G(LEXFY))&($L($G(LEXQTR))) LEXSTR=LEXSTR_" for "_$G(LEXFY)_" "_$G(LEXQTR)_" Quarter"
"RTN","LEX2114",31,0)
 D BM(LEXSTR)
"RTN","LEX2114",32,0)
 S U="^"
"RTN","LEX2114",33,0)
 ;   No user
"RTN","LEX2114",34,0)
 D:+($$UR)'>0 ET("User not defined (DUZ)")
"RTN","LEX2114",35,0)
 ;   No IO
"RTN","LEX2114",36,0)
 D:+($$SY)'>0 ET("Undefined IO variable(s)")
"RTN","LEX2114",37,0)
 I $D(LEXE) D ABRT Q
"RTN","LEX2114",38,0)
 ;   XPDENV = 0 Environment Check during Load
"RTN","LEX2114",39,0)
 ;   Check Version (2.0)
"RTN","LEX2114",40,0)
 I $$VERSION^XPDUTL("LEX")'="2.0" D  D ABRT Q
"RTN","LEX2114",41,0)
 . D ET("Version 2.0 not found.  Please install Lexicon Utility v 2.0")
"RTN","LEX2114",42,0)
 N LEXOK,LEXG,LEXR,LEXB
"RTN","LEX2114",43,0)
 ;   Check Required Patches
"RTN","LEX2114",44,0)
 D:$O(LEXREQP(0))'>0 IMP I $O(LEXREQP(0))>0 D
"RTN","LEX2114",45,0)
 . W ! N LEXPAT,LEXI,LEXPN,LEXP,LEXR,LEXC,LEXO,LEXC1,LEXC2,LEXC3,LEXC4,LEX
"RTN","LEX2114",46,0)
 . S (LEXR,LEXC)=0 S LEXC1=3,LEXC2=24,LEXC3=27,LEXC4=41
"RTN","LEX2114",47,0)
 . S LEXI=0  F  S LEXI=$O(LEXREQP(LEXI)) Q:+LEXI'>0  D
"RTN","LEX2114",48,0)
 . . S LEXC=LEXC+1,LEXPAT=$G(LEXREQP(LEXI))
"RTN","LEX2114",49,0)
 . S LEXI=0  F  S LEXI=$O(LEXREQP(LEXI)) Q:+LEXI'>0  D
"RTN","LEX2114",50,0)
 . . N LEXPAT,LEXREL,LEXINS,LEXCOM,LEXPAR,LEXINE,LEXREQ,LEXTX S LEXREQ=$G(LEXREQP(LEXI))
"RTN","LEX2114",51,0)
 . . S LEXPAT=$P(LEXREQ,"^",1),LEXREL=$P(LEXREQ,"^",2),LEXCOM=$P(LEXREQ,"^",3)
"RTN","LEX2114",52,0)
 . . S LEXPN=$$INS(LEXPAT),LEXINS=$$INSD(LEXPAT),LEXINE=$P(LEXINS,"^",2),LEXPAR=""
"RTN","LEX2114",53,0)
 . . S:LEXPN'>0&('$L(LEXINE)) LEXINE="    ??    "
"RTN","LEX2114",54,0)
 . . I LEXI=1 D
"RTN","LEX2114",55,0)
 . . . W !,?LEXC1,"Checking for ",!
"RTN","LEX2114",56,0)
 . . . W !,?LEXC1,"Patch",?LEXC2,"",?LEXC3,"Installed",?LEXC4,"Content"
"RTN","LEX2114",57,0)
 . . S LEXTX=$J(" ",LEXC1)_LEXPAT
"RTN","LEX2114",58,0)
 . . S LEXTX=LEXTX_$J(" ",(LEXC2-$L(LEXTX)))
"RTN","LEX2114",59,0)
 . . S LEXTX=LEXTX_$J(" ",(LEXC3-$L(LEXTX)))
"RTN","LEX2114",60,0)
 . . I +LEXPN>0 D
"RTN","LEX2114",61,0)
 . . . S LEXO=+($G(LEXO))+1 S:$L($G(LEXINE)) LEXTX=LEXTX_LEXINE
"RTN","LEX2114",62,0)
 . . . S LEXTX=LEXTX_$J(" ",(LEXC4-$L(LEXTX)))
"RTN","LEX2114",63,0)
 . . . S:$L(LEXCOM) LEXTX=LEXTX_LEXCOM
"RTN","LEX2114",64,0)
 . . I +LEXPN'>0,$L(LEXINE) S LEXTX=LEXTX_LEXINE
"RTN","LEX2114",65,0)
 . . D M(LEXTX)
"RTN","LEX2114",66,0)
 . . I +LEXPN'>0 D
"RTN","LEX2114",67,0)
 . . . N LEXP I LEXPAT["VA FileMan",$L(LEXPAR) D  Q
"RTN","LEX2114",68,0)
 . . . . S LEXP=$G(LEXPAT) S:LEXP[" SEQ"&($L($P(LEXP," SEQ",1))) LEXP=$P(LEXP," SEQ",1)
"RTN","LEX2114",69,0)
 . . . . D ET((LEXP_LEXPAR_" not found, please install "_LEXP)),ET("before continuing")
"RTN","LEX2114",70,0)
 . . . S LEXP=$G(LEXPAT) S:LEXP[" SEQ"&($L($P(LEXP," SEQ",1))) LEXP=$P(LEXP," SEQ",1)
"RTN","LEX2114",71,0)
 . . . D ET((LEXP_" not found, please install "_LEXP_" before continuing"))
"RTN","LEX2114",72,0)
 . W:+($G(LEXO))'=LEXC !
"RTN","LEX2114",73,0)
 I $D(LEXE) D ABRT Q
"RTN","LEX2114",74,0)
 I '$D(LEXFULL)&(+($G(XPDENV))'=1) D QUIT Q
"RTN","LEX2114",75,0)
QUIT ;   Quit   Passed Environment Check
"RTN","LEX2114",76,0)
 K LEXFULL D OK
"RTN","LEX2114",77,0)
 Q
"RTN","LEX2114",78,0)
ABRT ;   Abort  Failed Environment Check, KILL the distribution
"RTN","LEX2114",79,0)
 D:$D(LEXE) ED S XPDABORT=1,XPDQUIT=1 S:$L($G(LEXBUILD)) XPDQUIT(LEXBUILD)=1
"RTN","LEX2114",80,0)
 K LEXE,LEXFULL
"RTN","LEX2114",81,0)
 Q
"RTN","LEX2114",82,0)
POST ; Post-Install
"RTN","LEX2114",83,0)
 D MSG
"RTN","LEX2114",84,0)
 Q
"RTN","LEX2114",85,0)
MSG ; Install Message
"RTN","LEX2114",86,0)
 N LEXBUILD,LEXFILES,LEXEFFDT S LEXBUILD="LEX*2.0*114",LEXFILES="",LEXEFFDT="" D MSG^LEXXGI(LEXBUILD,LEXFILES,LEXEFFDT)
"RTN","LEX2114",87,0)
 Q
"RTN","LEX2114",88,0)
T1 ;   Environment Check #1 (for testing only)
"RTN","LEX2114",89,0)
 K XPDENV D ENV
"RTN","LEX2114",90,0)
 Q
"RTN","LEX2114",91,0)
T2 ;   Environment Check #2 (for testing only)
"RTN","LEX2114",92,0)
 N XPDENV S XPDENV=1 D ENV
"RTN","LEX2114",93,0)
 Q
"RTN","LEX2114",94,0)
 ;               
"RTN","LEX2114",95,0)
 ; Error Checks/Messages
"RTN","LEX2114",96,0)
INS(X) ;   Installed
"RTN","LEX2114",97,0)
 N LEX,LEXP,LEXV,LEXI,LEXS S LEX=$P($G(X)," ",1) I $L(LEX,"*")=3 S X=$$PATCH^XPDUTL(LEX) Q X
"RTN","LEX2114",98,0)
 S LEXP=$$PKG^XPDUTL(LEX),LEXV=$$VER^XPDUTL(LEX),LEXI=$$VERSION^XPDUTL(LEXP)
"RTN","LEX2114",99,0)
 Q:+LEXV>0&(LEXV=LEXI) 1
"RTN","LEX2114",100,0)
 Q 0
"RTN","LEX2114",101,0)
INSD(X)  ;   Installed on
"RTN","LEX2114",102,0)
 N DA,LEX,LEXDA,LEXE,LEXI,LEXMSG,LEXNS,LEXOUT,LEXPI,LEXPN,LEXSCR,LEXVI,LEXVD,LEXVI,LEXVR S LEX=$G(X)
"RTN","LEX2114",103,0)
 S LEXNS=$$PKG^XPDUTL(LEX),LEXVR=$$VER^XPDUTL(LEX),LEXPN=$P(X,"*",3)
"RTN","LEX2114",104,0)
 Q:'$L(LEXNS) ""  S LEXVR=+LEXVR Q:LEXVR'>0 ""  S LEXPN=+LEXPN S:LEXVR'["." LEXVR=LEXVR_".0"
"RTN","LEX2114",105,0)
 S LEXSCR="I $G(^DIC(9.4,+($G(Y)),""VERSION""))="""_LEXVR_""""
"RTN","LEX2114",106,0)
 D FIND^DIC(9.4,,.01,"O",LEXNS,10,"C",LEXSCR,,"LEXOUT","LEXMSG")
"RTN","LEX2114",107,0)
 S LEXPI=$G(LEXOUT("DILIST",2,1)) K LEXOUT,LEXMSG Q:+LEXPI'>0 ""  Q:'$D(@("^DIC(9.4,"_LEXPI_",22)")) ""
"RTN","LEX2114",108,0)
 K DA S DA(1)=LEXPI S LEXDA=$$IENS^DILF(.DA)
"RTN","LEX2114",109,0)
 D FIND^DIC(9.49,LEXDA,".01;1I;2I","O",LEXVR,10,"B",,,"LEXOUT","LEXMSG")
"RTN","LEX2114",110,0)
 S LEXVD=$G(LEXOUT("DILIST","ID",1,2)) I $E(LEXVD,1,7)?7N&(+LEXPN'>0) D  Q X
"RTN","LEX2114",111,0)
 . S X=$E(LEXVD,1,7)_"^"_$TR($$FMTE^XLFDT($E(LEXVD,1,7),"5DZ"),"@"," ")
"RTN","LEX2114",112,0)
 S:$E(LEXVD,1,7)'?7N LEXVD=$G(LEXOUT("DILIST","ID",1,1)) I $E(LEXVD,1,7)?7N&(+LEXPN'>0) D  Q X
"RTN","LEX2114",113,0)
 . S X=$E(LEXVD,1,7)_"^"_$TR($$FMTE^XLFDT($E(LEXVD,1,7),"5DZ"),"@"," ")
"RTN","LEX2114",114,0)
 Q:+LEXPN'>0 ""  S LEXVI=$G(LEXOUT("DILIST",2,1)) K LEXOUT,LEXMSG
"RTN","LEX2114",115,0)
 Q:+LEXVI'>0 ""  Q:'$D(@("^DIC(9.4,"_LEXPI_",22,"_LEXVI_",""PAH"")")) ""
"RTN","LEX2114",116,0)
 K DA S DA(2)=LEXPI,DA(1)=LEXVI S LEXDA=$$IENS^DILF(.DA)
"RTN","LEX2114",117,0)
 S LEXSCR="I $G(^DIC(9.4,"_LEXPI_",22,"_LEXVI_",""PAH"",+($G(Y)),0))[""SEQ #"""
"RTN","LEX2114",118,0)
 D FIND^DIC(9.4901,LEXDA,".01;.02I",,LEXPN,10,"B",LEXSCR,,"LEXOUT","LEXMSG")
"RTN","LEX2114",119,0)
 S LEXI=$G(LEXOUT("DILIST","ID",1,.02)) I '$L(LEXI) D
"RTN","LEX2114",120,0)
 . S LEXSCR="" D FIND^DIC(9.4901,LEXDA,".01;.02I",,LEXPN,10,"B",LEXSCR,,"LEXOUT","LEXMSG")
"RTN","LEX2114",121,0)
 . S LEXI=$G(LEXOUT("DILIST","ID",1,.02))
"RTN","LEX2114",122,0)
 Q:'$L(LEXI) ""  Q:$P(LEXI,".",1)'?7N ""  S LEXE=$TR($$FMTE^XLFDT(LEXI,"5DZ"),"@"," ")
"RTN","LEX2114",123,0)
 Q:'$L(LEXE) ""  S X=LEXI_"^"_LEXE
"RTN","LEX2114",124,0)
 Q X
"RTN","LEX2114",125,0)
SY(X) ;   Check System variables
"RTN","LEX2114",126,0)
 Q:'$D(IO)!('$D(IOF))!('$D(IOM))!('$D(ION))!('$D(IOSL))!('$D(IOST)) 0
"RTN","LEX2114",127,0)
 Q 1
"RTN","LEX2114",128,0)
UR(X) ;   Check User variables
"RTN","LEX2114",129,0)
 Q:'$L($G(DUZ(0))) 0
"RTN","LEX2114",130,0)
 Q:+($G(DUZ))=0!($$NOTDEF(+$G(DUZ))) 0
"RTN","LEX2114",131,0)
 Q 1
"RTN","LEX2114",132,0)
ET(X) ;   Error Text
"RTN","LEX2114",133,0)
 N LEXI S LEXI=+($G(LEXE(0))),LEXI=LEXI+1,LEXE(LEXI)="   "_$G(X),LEXE(0)=LEXI
"RTN","LEX2114",134,0)
 Q
"RTN","LEX2114",135,0)
ED ;   Error Display
"RTN","LEX2114",136,0)
 N LEXI S LEXI=0 F  S LEXI=$O(LEXE(LEXI)) Q:+LEXI=0  D M(LEXE(LEXI))
"RTN","LEX2114",137,0)
 D M(" ") K LEXE Q
"RTN","LEX2114",138,0)
 ;                   
"RTN","LEX2114",139,0)
 ; Miscellaneous
"RTN","LEX2114",140,0)
NOTDEF(IEN) ;   Check to see if user is defined
"RTN","LEX2114",141,0)
 N DA,DR,DIQ,LEX,DIC S DA=IEN,DR=.01,DIC=200,DIQ="LEX" D EN^DIQ1 Q '$D(LEX)
"RTN","LEX2114",142,0)
OK ;   Environment is OK
"RTN","LEX2114",143,0)
 N LEXPTYPE,LEXLREV,LEXREQP,LEXBUILD,LEXIGHF,LEXFY,LEXQTR,LEXT
"RTN","LEX2114",144,0)
 D IMP S LEXT=" Environment "_$S($L(LEXBUILD):("for patch/build "_LEXBUILD_" "),1:"")_"is ok"
"RTN","LEX2114",145,0)
 D BM(LEXT),M(" ")
"RTN","LEX2114",146,0)
 Q
"RTN","LEX2114",147,0)
BM(X) ;   Blank Line with Message
"RTN","LEX2114",148,0)
 S X=$G(X) S:$E(X,1)'=" " X=" "_X D BMES^XPDUTL(X) Q
"RTN","LEX2114",149,0)
M(X) ;   Message
"RTN","LEX2114",150,0)
 S X=$G(X) S:$E(X,1)'=" " X=" "_X D MES^XPDUTL(X) Q
"RTN","LEX2114",151,0)
TRIM(X) ;   Trim Spaces
"RTN","LEX2114",152,0)
 S X=$G(X) F  Q:$E(X,1)'=" "  S X=$E(X,2,$L(X))
"RTN","LEX2114",153,0)
 F  Q:$E(X,$L(X))'=" "  S X=$E(X,1,($L(X)-1))
"RTN","LEX2114",154,0)
 Q X
"RTN","LEX2114",155,0)
IMP ;   Import names
"RTN","LEX2114",156,0)
 N XPDABORT,XPDDIQ,XPDQUIT,XPDNOQUE
"RTN","LEX2114",157,0)
 S LEXPTYPE="Code Set SDM Ticket Fixes"
"RTN","LEX2114",158,0)
 S LEXPTYPE="Code Set Update"
"RTN","LEX2114",159,0)
 S LEXPTYPE="Lexicon Defect Repair"
"RTN","LEX2114",160,0)
 ;     Revision
"RTN","LEX2114",161,0)
 S LEXLREV=114
"RTN","LEX2114",162,0)
 ;     Required Builds Array
"RTN","LEX2114",163,0)
 ;        LEX(1)=build SEQ #^released date^subject
"RTN","LEX2114",164,0)
 ;        LEX(n)=build SEQ #^released date^subject
"RTN","LEX2114",165,0)
 S LEXREQP(1)="LEX*2.0*103 SEQ #102^3170726^Lexicon API/DD Updates"
"RTN","LEX2114",166,0)
 S LEXREQP(2)="LEX*2.0*113 SEQ #104^3171005^Code Set FY18 1st Qtr Update"
"RTN","LEX2114",167,0)
 ;     This Build Name
"RTN","LEX2114",168,0)
 S LEXBUILD="LEX*2.0*114"
"RTN","LEX2114",169,0)
 ;     This Build's Export Global Host Filename
"RTN","LEX2114",170,0)
 S LEXIGHF=""
"RTN","LEX2114",171,0)
 ;     Fiscal Year
"RTN","LEX2114",172,0)
 S LEXFY=""
"RTN","LEX2114",173,0)
 ;     Quarter
"RTN","LEX2114",174,0)
 S LEXQTR=""
"RTN","LEX2114",175,0)
 Q
"RTN","LEXQID")
0^6^B63365392^B62789436
"RTN","LEXQID",1,0)
LEXQID ;ISL/KER - Query - ICD Diagnosis - Extract ;10/10/2017
"RTN","LEXQID",2,0)
 ;;2.0;LEXICON UTILITY;**62,73,80,103,114**;Sep 23, 1996;Build 1
"RTN","LEXQID",3,0)
 ;               
"RTN","LEXQID",4,0)
 ; Global Variables
"RTN","LEXQID",5,0)
 ;    ^TMP("LEXQID")      SACC 2.3.2.5.1
"RTN","LEXQID",6,0)
 ;    ^TMP("LEXQIDA"      SACC 2.3.2.5.1
"RTN","LEXQID",7,0)
 ;    ^TMP("LEXQIDC"      SACC 2.3.2.5.1
"RTN","LEXQID",8,0)
 ;    ^TMP("LEXQIDN"      SACC 2.3.2.5.1
"RTN","LEXQID",9,0)
 ;    ^TMP("LEXQIDO"      SACC 2.3.2.5.1
"RTN","LEXQID",10,0)
 ;    ^TMP("LEXQIDR"      SACC 2.3.2.5.1
"RTN","LEXQID",11,0)
 ;               
"RTN","LEXQID",12,0)
 ; External References
"RTN","LEXQID",13,0)
 ;    $$CODEC^ICDEX       ICR   5747
"RTN","LEXQID",14,0)
 ;    $$CSI^ICDEX         ICR   5747
"RTN","LEXQID",15,0)
 ;    $$DTBR^ICDEX        ICR   5747
"RTN","LEXQID",16,0)
 ;    $$EXIST^ICDEX       ICR   5747
"RTN","LEXQID",17,0)
 ;    $$HIST^ICDEX        ICR   5747
"RTN","LEXQID",18,0)
 ;    $$ICDDX^ICDEX       ICR   5747
"RTN","LEXQID",19,0)
 ;    $$LA^ICDEX          ICR   5747
"RTN","LEXQID",20,0)
 ;    $$SD^ICDEX          ICR   5747
"RTN","LEXQID",21,0)
 ;    $$SYS^ICDEX         ICR   5747
"RTN","LEXQID",22,0)
 ;    $$DT^XLFDT          ICR  10103
"RTN","LEXQID",23,0)
 ;               
"RTN","LEXQID",24,0)
 ; Local Variables NEWed or KILLed Elsewhere
"RTN","LEXQID",25,0)
 ;    LEXIIEN             Include IENs flag
"RTN","LEXQID",26,0)
 ;    
"RTN","LEXQID",27,0)
EN ; Main Entry Point
"RTN","LEXQID",28,0)
 N LEXENV S LEXENV=$$EV^LEXQM Q:+LEXENV'>0
"RTN","LEXQID",29,0)
 N DIC,DIR,DIRB,DIROUT,DIRUT,DTOUT,DO,DUOUT,EXD,ICDFMT,ICDSYS,ICDVDT,LEX,LEX1,LEX2,LEX3,LEXAD,LEXBOD,LEXBRD,LEXBRW,LEXC,LEXCC,LEXCCD,LEXCCE,LEXCCI,LEXCDT
"RTN","LEXQID",30,0)
 N LEXCT,LEXCTE,LEXD,LEXDAT,LEXDDD,LEXDDE,LEXDDI,LEXDDT,LEXDEF,LEXDRG,LEXDRG1,LEXDRG2,LEXDRGC,LEXDRGD,LEXDRP,LEXDTXT,LEXDX,LEXE,LEXEDT,LEXEE,LEXEF
"RTN","LEXQID",31,0)
 N LEXEFF,LEXELDT,LEXENV,LEXES,LEXEVDT,LEXEXIT,LEXFA,LEXFUL,LEXGET,LEXH,LEXHIS,LEXI,LEXIA,LEXICD,LEXICDC,LEXID,LEXIEN,LEXIENS,LEXINC,LEXINCC
"RTN","LEXQID",32,0)
 N LEXINOT,LEXIREQ,LEXISO,LEXL,LEXLA,LEXLAST,LEXLD,LEXLDD,LEXLDR,LEXLDT,LEXLEF,LEXLEN,LEXLHI,LEXLHS,LEXLS,LEXLSD,LEXLSO,LEXLST,LEXLTXT,LEXLX,LEXM
"RTN","LEXQID",33,0)
 N LEXMC,LEXMD,LEXMDC,LEXMH,LEXN,LEXN0,LEXNAM,LEXNCC,LEXO,LEXOD,LEXODD,LEXP,LEXPF,LEXPIE,LEXR,LEXREF,LEXS,LEXSAB,LEXSD,LEXSDD,LEXSDT,LEXSIEN,LEXSO
"RTN","LEXQID",34,0)
 N LEXST,LEXSTA,LEXSTAT,LEXSTR,LEXSY,LEXSYS,LEXT,LEXTMP,LEXU,LEXVDT,LEXVTMP,LEXVTXT,LEXW,LEXWN,LEXX,TXT,TX1,TX2,I,X,Y,Z S LEXEXIT=0
"RTN","LEXQID",35,0)
 K ^TMP("LEXQID",$J),^TMP("LEXQIDO",$J),^TMP("LEXQIDA",$J),^TMP("LEXQIDN",$J),^TMP("LEXQIDR",$J),^TMP("LEXQIDC",$J)
"RTN","LEXQID",36,0)
 W ! F  S LEXCDT=$$AD^LEXQM,LEXAD=LEXCDT Q:'$L(LEXCDT)  S LEXEDT=$P(LEXCDT,"^",1),LEXCDT=$P(LEXCDT,"^",2) Q:LEXCDT'?7N  D LOOK Q:LEXCDT'?7N  Q:+LEXEXIT>0
"RTN","LEXQID",37,0)
 K ^TMP("LEXQID",$J),^TMP("LEXQIDO",$J),^TMP("LEXQIDA",$J),^TMP("LEXQIDN",$J),^TMP("LEXQIDR",$J),^TMP("LEXQIDC",$J)
"RTN","LEXQID",38,0)
 Q
"RTN","LEXQID",39,0)
IEN ; Display with IENs
"RTN","LEXQID",40,0)
 N LEXIIEN S LEXIIEN=1 D EN
"RTN","LEXQID",41,0)
 Q
"RTN","LEXQID",42,0)
LOOK ; ICD Lookup Loop
"RTN","LEXQID",43,0)
 N LEXGET,LEXST,LEXSD,LEXLD,LEXMD,LEXLX,LEXWN,LEXCC,LEXMC,LEXICD,LEXICDC
"RTN","LEXQID",44,0)
 S LEXCDT=$G(LEXCDT),LEXEDT=$$ED^LEXQM(LEXCDT) I LEXCDT'?7N S LEXCDT="" Q
"RTN","LEXQID",45,0)
 S LEXLEN=62 F  S LEXICD=$$ICD^LEXQIL D  Q:LEXICD="^"!(LEXICD="^^")
"RTN","LEXQID",46,0)
 . S:$E(LEXICD,1,2)="^^" LEXICD="^^",LEXEXIT=1 Q:+($G(LEXEXIT))>0!(LEXICD="^^")
"RTN","LEXQID",47,0)
 . S:$E(LEXICD,1)="^" LEXICD="^" Q:LEXICD="^"
"RTN","LEXQID",48,0)
 . K LEXGET,LEXST,LEXSD,LEXLD,LEXMD,LEXLX,LEXWN,LEXCC,LEXMC,^TMP("LEXQID",$J)
"RTN","LEXQID",49,0)
 . N LEXIEN,LEXLDT,LEXELDT,LEXINC,LEXINOT,LEXIREQ,LEXINCC,LEXFA
"RTN","LEXQID",50,0)
 . S LEXIEN=+($G(LEXICD)),LEXLDT=+($G(LEXCDT)),LEXFA=$$FA(+LEXIEN) Q:+LEXIEN'>0  Q:LEXLDT'?7N
"RTN","LEXQID",51,0)
 . S LEXELDT=$$SD^LEXQM(LEXLDT) Q:'$L(LEXELDT)
"RTN","LEXQID",52,0)
 . S (LEXINOT,LEXIREQ,LEXINCC)=0
"RTN","LEXQID",53,0)
 . ;I LEXFA?7N,LEXCDT?7N,LEXFA'>LEXCDT D
"RTN","LEXQID",54,0)
 . ;. S LEXINOT=$$EXIST^ICDEX(+($G(LEXIEN)),20) S:+LEXINOT>0 LEXINOT=$$NOT^LEXQIDA(+($G(LEXIEN))) S:LEXINOT["^^" LEXEXIT=1 Q:LEXINOT["^"
"RTN","LEXQID",55,0)
 . ;. S LEXIREQ=$$EXIST^ICDEX(+($G(LEXIEN)),30) S:+LEXIREQ>0 LEXIREQ=$$REQ^LEXQIDA(+($G(LEXIEN))) S:LEXIREQ["^^" LEXEXIT=1 Q:LEXIREQ["^"
"RTN","LEXQID",56,0)
 . ;. S LEXINCC=$$EXIST^ICDEX(+($G(LEXIEN)),40) S:LEXINCC>0 LEXINCC=$$NCC^LEXQIDA(+($G(LEXIEN))) S:LEXINCC["^^" LEXEXIT=1 Q:LEXINCC["^"
"RTN","LEXQID",57,0)
 . D CSV,EN^LEXQID4
"RTN","LEXQID",58,0)
 Q
"RTN","LEXQID",59,0)
CSV ; Code Set Versioning Display
"RTN","LEXQID",60,0)
 N LEXEDT,LEXIEN,LEXIENS,LEXLTXT,LEXSTAT,LEXDAT
"RTN","LEXQID",61,0)
 S LEXCDT=$G(LEXCDT),LEXEDT=$$ED^LEXQM(LEXCDT) I LEXCDT'?7N S (LEXICD,LEXCDT)="" Q
"RTN","LEXQID",62,0)
 S LEXIEN=+($G(LEXICD)),LEXSO=$$CODEC^ICDEX(80,+LEXIEN)
"RTN","LEXQID",63,0)
 S LEXLTXT=$P($G(LEXICD),"^",3) S LEXSYS=$$CSI^ICDEX(80,+LEXIEN)
"RTN","LEXQID",64,0)
 Q:+LEXIEN'>0  Q:'$L(LEXSO)  Q:+LEXSYS'>0
"RTN","LEXQID",65,0)
 S LEXDAT=$$ICDDX^ICDEX(LEXSO,LEXCDT,LEXSYS,"E")
"RTN","LEXQID",66,0)
 S LEXSO=$P(LEXDAT,"^",2),LEXNAM=$P(LEXDAT,"^",4)
"RTN","LEXQID",67,0)
 I '$L(LEXNAM) D
"RTN","LEXQID",68,0)
 . N LEXLA S LEXLA=$$LA^ICDEX(80,+LEXIEN,9999999)
"RTN","LEXQID",69,0)
 . S LEXNAM=$$SD^ICDEX(80,+LEXIEN,LEXLA)
"RTN","LEXQID",70,0)
 Q:'$L($G(LEXNAM))
"RTN","LEXQID",71,0)
 ; 
"RTN","LEXQID",72,0)
 ; Get the "Versioned" Fields
"RTN","LEXQID",73,0)
 ;            
"RTN","LEXQID",74,0)
 ;   Date/Status          80.066  (66)
"RTN","LEXQID",75,0)
 S LEXST=$$EF(+($G(LEXIEN)),+LEXCDT),LEXSTAT=+($P(LEXST,"^",2))
"RTN","LEXQID",76,0)
 ;   Diagnosis Name       80.067  (67)
"RTN","LEXQID",77,0)
 D SDS(+($G(LEXIEN)),+LEXCDT,.LEXSD,62,LEXSTAT)
"RTN","LEXQID",78,0)
 ;   Description          80.068  (68)
"RTN","LEXQID",79,0)
 D LDS^LEXQID2(+($G(LEXIEN)),+LEXCDT,.LEXLD,62,LEXSTAT)
"RTN","LEXQID",80,0)
 ;   Lexicon Expression          
"RTN","LEXQID",81,0)
 D LX^LEXQID2(+($G(LEXIEN)),+LEXCDT,.LEXLX,62,LEXSTAT)
"RTN","LEXQID",82,0)
 ;   Warning Message
"RTN","LEXQID",83,0)
 D WN^LEXQID2(+LEXCDT,.LEXWN,62)
"RTN","LEXQID",84,0)
 ;   DRG Groups           80.071  (71)
"RTN","LEXQID",85,0)
 ;D DRG^LEXQID3(+LEXIEN,+LEXCDT,LEXLEN)
"RTN","LEXQID",86,0)
 ;   CC                   80.0103 (103)
"RTN","LEXQID",87,0)
 ;D CC^LEXQID3(+($G(LEXIEN)),+LEXCDT,.LEXCC)
"RTN","LEXQID",88,0)
 ;   MDC                  80.072  (72)
"RTN","LEXQID",89,0)
 ;D MDC^LEXQID2(+($G(LEXIEN)),LEXCDT,.LEXMC)
"RTN","LEXQID",90,0)
 ;            
"RTN","LEXQID",91,0)
 ; Get the "Asked for" Fields
"RTN","LEXQID",92,0)
 ;            
"RTN","LEXQID",93,0)
 ;   Codes not to use     80.01   (20) 
"RTN","LEXQID",94,0)
 ;D:+($G(LEXINOT))>0 NOT^LEXQID3(+LEXIEN,+LEXCDT,LEXLEN)
"RTN","LEXQID",95,0)
 ;   Codes required with  80.02   (30) 
"RTN","LEXQID",96,0)
 ;D:+($G(LEXIREQ))>0 REQ^LEXQID3(+LEXIEN,+LEXCDT,LEXLEN)
"RTN","LEXQID",97,0)
 ;   Codes not CC with    80.03   (40)
"RTN","LEXQID",98,0)
 ;D:+($G(LEXINCC))>0 NCC^LEXQID3(+LEXIEN,+LEXCDT,LEXLEN)
"RTN","LEXQID",99,0)
 Q
"RTN","LEXQID",100,0)
 ; 
"RTN","LEXQID",101,0)
EF(X,LEXCDT) ; Effective Dates
"RTN","LEXQID",102,0)
 N LEX,LEXAD,LEXBRD,LEXBRW,LEXEE,LEXEF,LEXES,LEXFA,LEXH,LEXI,LEXID,LEXIEN,LEXLS,LEXSO,LEXST,LEXSY S LEXIEN=+($G(X)),LEXCDT=+($G(LEXCDT))
"RTN","LEXQID",103,0)
 Q:+LEXIEN'>0 "^^"  Q:LEXCDT'?7N "^^"  S LEXSO=$$CODEC^ICDEX(80,+LEXIEN),LEXSY=$$SYS^ICDEX(LEXSO,LEXCDT),LEX=$$ICDDX^ICDEX(LEXSO,LEXCDT,LEXSY,"E")
"RTN","LEXQID",104,0)
 S LEXFA=$$FA(+LEXIEN),(LEXLS,LEXST)=$P(LEX,"^",10),LEXID=$P(LEX,"^",12),LEXBRD=$$IMPDATE^LEXU("ICD"),LEXBRW=""
"RTN","LEXQID",105,0)
 I LEXCDT<LEXBRD&(+LEXFA=LEXBRD) D
"RTN","LEXQID",106,0)
 . S LEXBRW="Warning:  The 'Based on Date' provided precedes the initial Code Set Business Rule date of "
"RTN","LEXQID",107,0)
 . S LEXBRW=LEXBRW_$$SD^LEXQM(LEXBRD)_", the Effective date may be inaccurate."
"RTN","LEXQID",108,0)
 S LEXAD=$P(LEX,"^",17),LEXES=$S(+LEXST>0:"Active",1:"Inactive")
"RTN","LEXQID",109,0)
 S:+LEXST'>0&(+LEXAD'>0) LEXES="Not Applicable",LEXLS=-1
"RTN","LEXQID",110,0)
 S:+LEXFA>0&(+LEXCDT>0)&(LEXFA>LEXCDT) LEXES="Pending",LEXLS=-1,LEXST=0,LEXBRW=""
"RTN","LEXQID",111,0)
 S:LEXST>0 LEXEF=LEXAD S:LEXST'>0 LEXEF=LEXID
"RTN","LEXQID",112,0)
 S:LEXST'>0&(+LEXID'>0) LEXEF=LEXFA S LEXEE=$$SD^LEXQM(LEXEF)
"RTN","LEXQID",113,0)
 I LEXST'>0,+LEXID'>0,$L(LEXEE),+LEXEF>LEXCDT S LEXEE="(future activation of "_LEXEE_")",LEXEF=""
"RTN","LEXQID",114,0)
 S X=LEXLS_"^"_LEXST_"^"_LEXEF_"^"_LEXES_"^"_LEXEE S:$L(LEXBRW) $P(X,"^",6)=LEXBRW
"RTN","LEXQID",115,0)
 Q X
"RTN","LEXQID",116,0)
 ; 
"RTN","LEXQID",117,0)
SDS(X,LEXVDT,LEX,LEXLEN,LEXSTA) ; Diagnosis (short description)
"RTN","LEXQID",118,0)
 ; 
"RTN","LEXQID",119,0)
 ; LEX=# of Lines
"RTN","LEXQID",120,0)
 ; LEX(0)=External Date of Diagnosis Name
"RTN","LEXQID",121,0)
 ; LEX(#)=Diagnosis Name
"RTN","LEXQID",122,0)
 ; 
"RTN","LEXQID",123,0)
 N LEXBRD,LEXBRW,LEXC,LEXD,LEXDDT,LEXE,LEXEE,LEXEFF,LEXFA
"RTN","LEXQID",124,0)
 N LEXHIS,LEXI,LEXIA,LEXIEN,LEXAIEN,LEXSIEN,LEXL,LEXLA,LEXLAST
"RTN","LEXQID",125,0)
 N LEXLEF,LEXLHI,LEXLSD,LEXM,LEXOD,LEXODD,LEXR,LEXS,LEXSD,LEXSDD
"RTN","LEXQID",126,0)
 N LEXSDT,LEXSO,LEXSY,LEXT S LEXIEN=$G(X) Q:+LEXIEN'>0
"RTN","LEXQID",127,0)
 S LEXVDT=+($G(LEXVDT)) S:LEXVDT'?7N LEXVDT=$$DT^XLFDT
"RTN","LEXQID",128,0)
 S LEXSTA=+($G(LEXSTA)) S LEXSO=$$CODEC^ICDEX(80,+LEXIEN)
"RTN","LEXQID",129,0)
 S LEXSY=$$CSI^ICDEX(80,+LEXIEN)
"RTN","LEXQID",130,0)
 S LEXLA=$$LA^ICDEX(80,+LEXIEN,9999999),LEXFA=$$FA(+LEXIEN)
"RTN","LEXQID",131,0)
 S LEXLAST=$$ICDDX^ICDEX(LEXSO,LEXLA,LEXSY,"E")
"RTN","LEXQID",132,0)
 S LEXLSD=$P(LEXLAST,"^",5),LEXBRD=$$DTBR^ICDEX(LEXVDT,0,LEXSY),LEXBRW=""
"RTN","LEXQID",133,0)
 S LEXSD=$$SD^ICDEX(80,+LEXIEN,LEXVDT,.LEXS)
"RTN","LEXQID",134,0)
 S LEXSD=$G(LEXS(1)),LEXSDD=$P($G(LEXS(0)),"^",2)
"RTN","LEXQID",135,0)
 S:'$L(LEXSD) LEXSDD="--/--/----" S LEXM=""
"RTN","LEXQID",136,0)
 I $P(LEXSD,"^",1)="-1"!('$L(LEXSD)) D
"RTN","LEXQID",137,0)
 . S LEXM="Diagnosis Short Name is not available."
"RTN","LEXQID",138,0)
 . I (LEXVDT'?7N!(LEXFA'?7N)),LEXVDT<LEXFA D
"RTN","LEXQID",139,0)
 . . S LEXM=LEXM_"  The date provided precedes the initial activation of the code"
"RTN","LEXQID",140,0)
 . I LEXVDT?7N&(LEXFA?7N),LEXVDT<LEXFA D
"RTN","LEXQID",141,0)
 . . S LEXM=LEXM_"  The date provided ("_$$ED^LEXQM(LEXVDT)_") precedes the initial activation ("_$$ED^LEXQM(LEXFA)_") of the code"
"RTN","LEXQID",142,0)
 . S:$L(LEXM) LEXM="NOTE:  "_LEXM S LEXOD=LEXLSD,LEXODD="--/--/----"
"RTN","LEXQID",143,0)
 S LEXAIEN=LEXIEN,LEXSIEN="" I $L(LEXSD)&($P(LEXSD,"^",1)'="-1") D
"RTN","LEXQID",144,0)
 . S:LEXSDD?7N LEXSIEN=$O(@("^ICD9("_LEXIEN_",67,""B"","_LEXSDD_",0)"))
"RTN","LEXQID",145,0)
 . S:LEXSIEN>0 LEXAIEN=LEXAIEN_";"_LEXSIEN
"RTN","LEXQID",146,0)
 . S LEXM="" S LEXOD=LEXSD S:$L(LEXOD)&($D(LEXIIEN)) LEXOD=LEXOD_" (IEN "_LEXAIEN_")"
"RTN","LEXQID",147,0)
 . S LEXODD=$S(LEXSDD?7N:$$ED^LEXQM(LEXSDD),1:"--/--/----")
"RTN","LEXQID",148,0)
 S:'$L(LEXOD) LEXOD="Diagnosis Short Name not found"
"RTN","LEXQID",149,0)
 S:'$L(LEXODD) LEXODD="--/--/----"
"RTN","LEXQID",150,0)
 K LEX,LEXT S LEXT(1)=LEXOD D PR^LEXU(.LEXT,(LEXLEN-7))
"RTN","LEXQID",151,0)
 S LEXI=0 F  S LEXI=$O(LEXT(LEXI)) Q:+LEXI'>0  S LEXT=$G(LEXT(LEXI)) S LEX(LEXI)=LEXT
"RTN","LEXQID",152,0)
 I $L($G(LEXM)) D
"RTN","LEXQID",153,0)
 . K LEX,LEXT N LEXC S LEXT(1)=LEXM D PR^LEXU(.LEXT,(LEXLEN-7))
"RTN","LEXQID",154,0)
 . S LEXI=0 F  S LEXI=$O(LEXT(LEXI)) Q:+LEXI'>0  S LEXT=$G(LEXT(LEXI)) S LEXC=$O(LEX(" "),-1)+1,LEX(LEXC)=LEXT
"RTN","LEXQID",155,0)
 S:$D(LEX(1)) LEX(0)=LEXODD
"RTN","LEXQID",156,0)
 Q
"RTN","LEXQID",157,0)
 ; 
"RTN","LEXQID",158,0)
 ; Miscellaneous
"RTN","LEXQID",159,0)
FA(X) ;   First Activation
"RTN","LEXQID",160,0)
 N LEXFA,LEXH,LEXI,LEXIEN,LEXSO,LEXSY
"RTN","LEXQID",161,0)
 S LEXIEN=+($G(X)) S X="",LEXSO=$$CODEC^ICDEX(80,+LEXIEN),LEXSY=$$CSI^ICDEX(80,+LEXIEN)
"RTN","LEXQID",162,0)
 K LEXH S X=$$HIST^ICDEX(LEXSO,.LEXH,LEXSY) S LEXFA="",LEXI=0
"RTN","LEXQID",163,0)
 F  S LEXI=$O(LEXH(LEXI)) Q:+LEXI'>0!($L(LEXFA))  S:+($G(LEXH(LEXI)))>0&(LEXI?7N) LEXFA=LEXI Q:$L(LEXFA)
"RTN","LEXQID",164,0)
 S X=LEXFA
"RTN","LEXQID",165,0)
 Q X
"RTN","LEXQID",166,0)
IA(X,Y) ;   Inaccurate
"RTN","LEXQID",167,0)
 N LEXBRD,LEXVDT,LEXIEN,LEXSYS S LEXVDT=+($G(X)),LEXIEN=+($G(Y)) Q:+LEXIEN'>0 0
"RTN","LEXQID",168,0)
 S LEXSYS=$$CSI^ICDEX(80,+LEXIEN) Q:+LEXSYS'>0 0  S:'$L(LEXVDT) LEXVDT=$$DT^XLFDT
"RTN","LEXQID",169,0)
 S:LEXVDT#10000=0 LEXVDT=LEXVDT+101 S:LEXVDT#100=0 LEXVDT=LEXVDT+1
"RTN","LEXQID",170,0)
 S LEXBRD=$$DTBR^ICDEX(LEXVDT,0,LEXSYS) S X=$S(LEXVDT<LEXBRD:1,1:0)
"RTN","LEXQID",171,0)
 Q X
"RTN","LEXQIDA")
0^2^B53902820^B52951726
"RTN","LEXQIDA",1,0)
LEXQIDA ;ISL/KER - Query - ICD Diagnosis - Ask ;10/10/2017
"RTN","LEXQIDA",2,0)
 ;;2.0;LEXICON UTILITY;**62,80,103,114**;Sep 23, 1996;Build 1
"RTN","LEXQIDA",3,0)
 ;               
"RTN","LEXQIDA",4,0)
 ; Global Variables
"RTN","LEXQIDA",5,0)
 ;    None
"RTN","LEXQIDA",6,0)
 ;               
"RTN","LEXQIDA",7,0)
 ; External References
"RTN","LEXQIDA",8,0)
 ;    ^DIC                ICR  10006
"RTN","LEXQIDA",9,0)
 ;    ^DIR                ICR  10026
"RTN","LEXQIDA",10,0)
 ;    $$CODEC^ICDEX       ICR   5747
"RTN","LEXQIDA",11,0)
 ;    $$ICDDX^ICDEX       ICR   5747
"RTN","LEXQIDA",12,0)
 ;    $$NCC^ICDEX         ICR   5747
"RTN","LEXQIDA",13,0)
 ;    $$NOT^ICDEX         ICR   5747
"RTN","LEXQIDA",14,0)
 ;    $$REQ^ICDEX         ICR   5747
"RTN","LEXQIDA",15,0)
 ;    $$ROOT^ICDEX        ICR   5747
"RTN","LEXQIDA",16,0)
 ;    $$SYS^ICDEX         ICR   5747
"RTN","LEXQIDA",17,0)
 ;    $$DT^XLFDT          ICR  10103
"RTN","LEXQIDA",18,0)
 ;    $$FMTE^XLFDT        ICR  10103
"RTN","LEXQIDA",19,0)
 ;    $$UP^XLFSTR         ICR  10104
"RTN","LEXQIDA",20,0)
 ;               
"RTN","LEXQIDA",21,0)
 ; Local Variables NEWed or KILLed in LEXQID
"RTN","LEXQIDA",22,0)
 ;    LEXCDT              Code Set Date
"RTN","LEXQIDA",23,0)
 ;    LEXEXIT             Exit Flag
"RTN","LEXQIDA",24,0)
 ;               
"RTN","LEXQIDA",25,0)
ICD(X) ; ICD DX Code
"RTN","LEXQIDA",26,0)
 Q:+($G(LEXEXIT))>0 "^^"  N DIC,DICB,DTOUT,DUOUT,LEXDX,LEXSO,LEXVDT,LEXDTXT,LEXVTXT,Y,ICDVDT,ICDSYS,ICDFMT
"RTN","LEXQIDA",27,0)
 S DICB=$G(X),ICDFMT=2 S:$P($G(LEXCDT),"^",2)?7N (LEXVDT,ICDVDT)=$P($G(LEXCDT),"^",2)
"RTN","LEXQIDA",28,0)
 S:'$L($G(LEXVDT))&($P($G(LEXCDT),"^",1)?7N) (LEXVDT,ICDVDT)=$P($G(LEXCDT),"^",1)
"RTN","LEXQIDA",29,0)
 S DIC(0)="AEQMZ",DIC=$$ROOT^ICDEX(80) S:$D(LEXQUIET) DIC(0)="MZ" I $L(DIC) D
"RTN","LEXQIDA",30,0)
 . N ICDVDT,VDT S VDT=$$LUPD^LEXU("10D") S:VDT?7N VDT=$$FMADD^XLFDT(VDT,740) S:VDT?7N ICDVDT=VDT
"RTN","LEXQIDA",31,0)
 . S DIC("A")=" Select an ICD Diagnosis code:  " S:$L($G(DICB)) (X,DIC("B"))=$G(DICB) W ! D ^DIC
"RTN","LEXQIDA",32,0)
 N LEXQUIET S:$G(X)["^^"!($D(DTOUT)) LEXEXIT=1 Q:$G(X)["^^"!(+($G(LEXEXIT))>0) "^^"
"RTN","LEXQIDA",33,0)
 Q:$G(X)="^" "^"  Q:$G(X)["^^" "^^"  Q:$D(DTOUT)!($D(DUOUT)) "^"  S LEXSO=$P($G(Y),"^",2) S X="" I +Y>0,$L(LEXSO) D
"RTN","LEXQIDA",34,0)
 . N LEXSYS S LEXSYS=$$SYS^ICDEX(LEXSO) S:+LEXSYS'>0 LEXSYS="" S LEXVDT=$G(LEXCDT) S:LEXVDT'?7N LEXVDT=$$DT^XLFDT
"RTN","LEXQIDA",35,0)
 . S X=Y,LEXDTXT=$P($G(Y(0)),"^",2),LEXDX=$$ICDDX^ICDEX(LEXSO,LEXVDT,LEXSYS,"E")
"RTN","LEXQIDA",36,0)
 . S:$L($G(LEXDTXT)) LEXDTXT=LEXDTXT_" (Text not Versioned)" S LEXVTXT=$P(LEXDX,"^",4) S:'$L(LEXVTXT) LEXVTXT=LEXDTXT
"RTN","LEXQIDA",37,0)
 . S X=+Y_"^"_LEXSO S:$L(LEXVTXT) X=X_"^"_LEXVTXT
"RTN","LEXQIDA",38,0)
 S X=$$UP^XLFSTR(X) Q:'$L(X) "^"
"RTN","LEXQIDA",39,0)
 Q X
"RTN","LEXQIDA",40,0)
 ;          
"RTN","LEXQIDA",41,0)
NOT(X) ; Include ICD Codes not to use with ***.**
"RTN","LEXQIDA",42,0)
 Q:+($G(LEXEXIT))>0 "^^"  N DIR,DIRUT,DIROUT,DTOUT,DUOUT,Y,DIRB,LEXIEN,LEXLSO,LEXCT,LEXCTE,LEXI S LEXIEN=+($G(X))
"RTN","LEXQIDA",43,0)
 S LEXCT=$$NOT^ICDEX(+LEXIEN,,0) Q:LEXCT'>0 0  S LEXLSO=$$CODEC^ICDEX(80,+LEXIEN)
"RTN","LEXQIDA",44,0)
 S LEXCTE=$S(LEXCT=1:"one",LEXCT=2:"two",LEXCT=3:"three",LEXCT=4:"four",LEXCT=5:"five",LEXCT=6:"six",LEXCT=7:"seven",LEXCT=8:"eight",LEXCT=9:"nine",1:LEXCT)
"RTN","LEXQIDA",45,0)
 S DIRB=$$RET^LEXQD("LEXQIDA","NOT",+($G(DUZ)),"Include ICD Codes not to use with") S:'$L(DIRB) DIRB="No"
"RTN","LEXQIDA",46,0)
 S DIR(0)="YAO" S:LEXCT=1 DIR("A")=" Include the single ICD Code that can not be used with "_LEXLSO_"?  (Y/N)  "
"RTN","LEXQIDA",47,0)
 S:LEXCT>1 DIR("A")=" Include the "_LEXCTE_" ICD Codes that can not be used with "_LEXLSO_"?  (Y/N)  "
"RTN","LEXQIDA",48,0)
 S:"^YES^NO^Yes^No^"[("^"_DIRB_"^") DIR("B")=DIRB
"RTN","LEXQIDA",49,0)
 S DIR("PRE")="S:X[""?"" X=""??""" S (DIR("?"),DIR("??"))="^D NOTH^LEXQIDA"
"RTN","LEXQIDA",50,0)
 W ! D ^DIR S:X["^^"!($D(DTOUT)) LEXEXIT=1 Q:X["^^"!(+($G(LEXEXIT))>0) "^^"  Q:$D(DIRUT)!($D(DIROUT))!($D(DTOUT))!($D(DUOUT)) "^" S DIRB=$S(Y=1:"Yes",Y=0:"No",X["^":"",1:"")
"RTN","LEXQIDA",51,0)
 D:$L(DIRB) SAV^LEXQD("LEXQIDA","NOT",+($G(DUZ)),"Include ICD Codes not to use with",$G(DIRB)) S X=+Y
"RTN","LEXQIDA",52,0)
 Q X
"RTN","LEXQIDA",53,0)
NOTH ;   Include NOT Help
"RTN","LEXQIDA",54,0)
 W:'$L($G(LEXLSO)) !,?5,"Answer 'Yes' to include in the display all ICD Code(s) that can",!,?5,"not be used with the selected ICD code.  Answer 'No' to exclude",!,?5,"codes that can not not be used with the selected ICD code."
"RTN","LEXQIDA",55,0)
 W:$L($G(LEXLSO)) !,?5,"Answer 'Yes' to include all ICD Code(s) that can not be used with",!,?5,"ICD Code "_$G(LEXLSO)_".  Answer 'No' to exclude codes that can not be",!,?5,"used with ICD code "_$G(LEXLSO)_"."
"RTN","LEXQIDA",56,0)
 Q
"RTN","LEXQIDA",57,0)
 ;          
"RTN","LEXQIDA",58,0)
REQ(X) ; Include ICD Codes required with ***.**
"RTN","LEXQIDA",59,0)
 Q:+($G(LEXEXIT))>0 "^^"  N DIR,DIRUT,DIROUT,DTOUT,DUOUT,Y,DIRB,LEXIEN,LEXLSO,LEXCT,LEXCTE,LEXI S LEXIEN=+($G(X))
"RTN","LEXQIDA",60,0)
 S LEXCT=$$REQ^ICDEX(+LEXIEN,,0) Q:LEXCT'>0 0  S LEXLSO=$$CODEC^ICDEX(80,+LEXIEN)
"RTN","LEXQIDA",61,0)
 S LEXCTE=$S(LEXCT=1:"one",LEXCT=2:"two",LEXCT=3:"three",LEXCT=4:"four",LEXCT=5:"five",LEXCT=6:"six",LEXCT=7:"seven",LEXCT=8:"eight",LEXCT=9:"nine",1:LEXCT)
"RTN","LEXQIDA",62,0)
 S DIRB=$$RET^LEXQD("LEXQIDA","REQ",+($G(DUZ)),"Include ICD Required with") S:'$L(DIRB) DIRB="No"
"RTN","LEXQIDA",63,0)
 S DIR(0)="YAO" S:LEXCT=1 DIR("A")=" Include the one ICD Code that is required with "_LEXLSO_"?  (Y/N)  "
"RTN","LEXQIDA",64,0)
 S:LEXCT>1 DIR("A")=" Include the "_LEXCTE_" ICD Codes that are required with "_LEXLSO_"?  (Y/N)  "
"RTN","LEXQIDA",65,0)
 S:"^YES^NO^Yes^No^"[("^"_DIRB_"^") DIR("B")=DIRB
"RTN","LEXQIDA",66,0)
 S DIR("PRE")="S:X[""?"" X=""??""" S (DIR("?"),DIR("??"))="^D REQH^LEXQIDA"
"RTN","LEXQIDA",67,0)
 W ! D ^DIR S:X["^^"!($D(DTOUT)) LEXEXIT=1 Q:X["^^"!(+($G(LEXEXIT))>0) "^^"  Q:$D(DIRUT)!($D(DIROUT))!($D(DTOUT))!($D(DUOUT)) "^" S DIRB=$S(Y=1:"Yes",Y=0:"No",X["^":"",1:"")
"RTN","LEXQIDA",68,0)
 D:$L(DIRB) SAV^LEXQD("LEXQIDA","REQ",+($G(DUZ)),"Include ICD Required with",$G(DIRB)) S X=+Y
"RTN","LEXQIDA",69,0)
 Q X
"RTN","LEXQIDA",70,0)
REQH ;   Include REQ Help
"RTN","LEXQIDA",71,0)
 W:'$L($G(LEXLSO)) !,?5,"Answer 'Yes' to include in the display all ICD Code(s) that are",!,?5,"required with the selected ICD code.  Answer 'No' to exclude",!,?5,"codes that are required with the selected ICD code."
"RTN","LEXQIDA",72,0)
 W:$L($G(LEXLSO)) !,?5,"Answer 'Yes' to include all ICD Code(s) that are required with",!,?5,"ICD Code "_$G(LEXLSO)_".  Answer 'No' to exclude codes that are requried",!,?5,"with ICD code "_$G(LEXLSO)_"."
"RTN","LEXQIDA",73,0)
 Q
"RTN","LEXQIDA",74,0)
 Q
"RTN","LEXQIDA",75,0)
 ;          
"RTN","LEXQIDA",76,0)
NCC(X) ; Include the codes that ***.** is not CC with
"RTN","LEXQIDA",77,0)
 Q:+($G(LEXEXIT))>0 "^^"  N DIR,DIRUT,DIROUT,DTOUT,DUOUT,Y,DIRB,LEXIEN,LEXLSO,LEXCT,LEXCTE,LEXI,LEXNCC S LEXIEN=+($G(X))
"RTN","LEXQIDA",78,0)
 S LEXCT=$$NCC^ICDEX(+LEXIEN,,0) Q:LEXCT'>0 0  S LEXLSO=$$CODEC^ICDEX(80,+LEXIEN)
"RTN","LEXQIDA",79,0)
 S LEXCTE=$S(LEXCT=1:"one",LEXCT=2:"two",LEXCT=3:"three",LEXCT=4:"four",LEXCT=5:"five",LEXCT=6:"six",LEXCT=7:"seven",LEXCT=8:"eight",LEXCT=9:"nine",1:LEXCT)
"RTN","LEXQIDA",80,0)
 S DIRB=$$RET^LEXQD("LEXQIDA","NCC",+($G(DUZ)),"Include Codes not CC with") S:'$L(DIRB) DIRB="No"
"RTN","LEXQIDA",81,0)
 S DIR(0)="YAO" S:LEXCT=1 DIR("A")=" Include the one ICD Code that "_LEXLSO_" is not CC with?  (Y/N)  "
"RTN","LEXQIDA",82,0)
 S:LEXCT>1 DIR("A")=" Include the "_LEXCTE_" ICD Codes that "_LEXLSO_" are not CC with?  (Y/N)  "
"RTN","LEXQIDA",83,0)
 S:"^YES^NO^Yes^No^"[("^"_DIRB_"^") DIR("B")=DIRB
"RTN","LEXQIDA",84,0)
 S DIR("PRE")="S:X[""?"" X=""??""" S (DIR("?"),DIR("??"))="^D NCCH^LEXQIDA"
"RTN","LEXQIDA",85,0)
 W ! D ^DIR S:X["^^"!($D(DTOUT)) LEXEXIT=1 Q:X["^^"!(+($G(LEXEXIT))>0) "^^"  Q:$D(DIRUT)!($D(DIROUT))!($D(DTOUT))!($D(DUOUT)) "^" S DIRB=$S(Y=1:"Yes",Y=0:"No",X["^":"",1:"")
"RTN","LEXQIDA",86,0)
 D:$L(DIRB) SAV^LEXQD("LEXQIDA","NCC",+($G(DUZ)),"Include Codes not CC with",$G(DIRB)) S X=+Y
"RTN","LEXQIDA",87,0)
 Q X
"RTN","LEXQIDA",88,0)
NCCH ;   Include NCC Help
"RTN","LEXQIDA",89,0)
 I $L($G(LEXLSO)),$L($G(LEXCT)) D
"RTN","LEXQIDA",90,0)
 . W !,?5,"Code ",LEXLSO," is not considered as Complication/Comorbidity (CC)"
"RTN","LEXQIDA",91,0)
 . W !,?5,"with ",$S(+($G(LEXCT))>1:"some codes.",1:"one code."),"  Answer 'Yes' to include "
"RTN","LEXQIDA",92,0)
 . I +($G(LEXCT))>1 W "these codes.  Answer",!,?5,"'No' to exclude these codes."
"RTN","LEXQIDA",93,0)
 . I +($G(LEXCT))'>1 W "this code.  Answer 'No'",!,?5,"to exclude this code."
"RTN","LEXQIDA",94,0)
 . Q
"RTN","LEXQIDA",95,0)
 . W $S(+($G(LEXCT))>1:"these codes.  Answer 'No'",1:"this code.  Answer 'No'")
"RTN","LEXQIDA",96,0)
 . W $S(+($G(LEXCT))>1:"these codes.  Answer 'No'",1:"this code.  Answer 'No'")
"RTN","LEXQIDA",97,0)
 I $L($G(LEXLSO)),'$L($G(LEXCT)) D
"RTN","LEXQIDA",98,0)
 . W !,?5,"Code "_LEXLSO_" is not considered as Complication/Comorbidity (CC)"
"RTN","LEXQIDA",99,0)
 . W !,?5,"with some codes.  Answer 'Yes' to include these codes.  Answer",!,?5,"'No' to exclude these codes."
"RTN","LEXQIDA",100,0)
 I '$L($G(LEXLSO)),'$L($G(LEXCT)) D
"RTN","LEXQIDA",101,0)
 . W !,?5,"This code is not considered as Complication/Comorbidity (CC)"
"RTN","LEXQIDA",102,0)
 . W !,?5,"with some codes.  Answer 'Yes' to include these codes.  Answer ",!,?5,"'No' to exclude these codes."
"RTN","LEXQIDA",103,0)
 Q
"RTN","LEXQIDA",104,0)
 ;          
"RTN","LEXQIDA",105,0)
SD(X) ; Short Date
"RTN","LEXQIDA",106,0)
 Q $TR($$FMTE^XLFDT(+($G(X)),"5DZ"),"@"," ")
"RTN","LEXQIL")
0^5^B98232990^n/a
"RTN","LEXQIL",1,0)
LEXQIL ;ISL/KER - Query - ICD Non-Versioned Lookup ;10/10/2017
"RTN","LEXQIL",2,0)
 ;;2.0;LEXICON UTILITY;**114**;Sep 23, 1996;Build 1
"RTN","LEXQIL",3,0)
 ;               
"RTN","LEXQIL",4,0)
 ; Global Variables
"RTN","LEXQIL",5,0)
 ;    ^TMP("LEXQIL"        SACC 2.3.2.5.1
"RTN","LEXQIL",6,0)
 ;               
"RTN","LEXQIL",7,0)
 ; External References
"RTN","LEXQIL",8,0)
 ;    ^DIR                ICR  10026
"RTN","LEXQIL",9,0)
 ;    $$CODEC^ICDEX       ICR   5747
"RTN","LEXQIL",10,0)
 ;    $$CSI^ICDEX         ICR   5747
"RTN","LEXQIL",11,0)
 ;    $$ICDDX^ICDEX       ICR   5747
"RTN","LEXQIL",12,0)
 ;    $$ICDOP^ICDEX       ICR   5747
"RTN","LEXQIL",13,0)
 ;    $$ROOT^ICDEX        ICR   5747
"RTN","LEXQIL",14,0)
 ;    TOKEN^ICDEX         ICR   5747
"RTN","LEXQIL",15,0)
 ;    $$DT^XLFDT          ICR  10103
"RTN","LEXQIL",16,0)
 ;    $$UP^XLFSTR         ICR  10103
"RTN","LEXQIL",17,0)
 ;               
"RTN","LEXQIL",18,0)
 ; Main Entry Points ICD/ICP
"RTN","LEXQIL",19,0)
ICD(X) ;   ICD DX Lookup
"RTN","LEXQIL",20,0)
 N LEXFI,LEXINP,LEXOUT,LEXDIRB S LEXDIRB=$$TM($G(X)),X="^",LEXFI=80
"RTN","LEXQIL",21,0)
 S:$L($G(LEXDIRB)) LEXINP=LEXDIRB S:'$L($G(LEXDIRB)) LEXINP=$$INP Q:$E(LEXINP,1)="^" "^"  Q:$E(LEXINP,1,2)="^^" "^^"
"RTN","LEXQIL",22,0)
 K ^TMP("LEXQIL",$J) D BC($G(LEXINP),$G(LEXFI)) I +($G(^TMP("LEXQIL",$J,0)))=1 D  Q X
"RTN","LEXQIL",23,0)
 . N OUT S LEXFI=80 S LEXOUT=$$ONE,X=-1 S:$E(LEXOUT,1)["^" X="^" S:+LEXOUT>0 X=$G(LEXOUT)
"RTN","LEXQIL",24,0)
 I +($G(^TMP("LEXQIL",$J,0)))>1 D  Q X
"RTN","LEXQIL",25,0)
 . N OUT S LEXFI=80 S LEXOUT=$$MUL,X=-1 S:$E(LEXOUT,1)["^" X="^" S:+LEXOUT>0 X=$G(LEXOUT)
"RTN","LEXQIL",26,0)
 K ^TMP("LEXQIL",$J) D BT($G(LEXINP),$G(LEXFI)) I +($G(^TMP("LEXQIL",$J,0)))=1 D  Q X
"RTN","LEXQIL",27,0)
 . N OUT S LEXFI=80 S LEXOUT=$$ONE,X=-1 S:$E(LEXOUT,1)["^" X="^" S:+LEXOUT>0 X=$G(LEXOUT)
"RTN","LEXQIL",28,0)
 I +($G(^TMP("LEXQIL",$J,0)))>1 D  Q X
"RTN","LEXQIL",29,0)
 . N OUT S LEXFI=80 S LEXOUT=$$MUL,X=-1 S:$E(LEXOUT,1)["^" X="^" S:+LEXOUT>0 X=$G(LEXOUT)
"RTN","LEXQIL",30,0)
 Q X
"RTN","LEXQIL",31,0)
ICP(X) ;   ICD PR Lookup
"RTN","LEXQIL",32,0)
 N LEXFI,LEXINP,LEXOUT,LEXDIRB S LEXDIRB=$$TM($G(X)),X="^",LEXFI=80.1
"RTN","LEXQIL",33,0)
 S:$L($G(LEXDIRB)) LEXINP=LEXDIRB S:'$L($G(LEXDIRB)) LEXINP=$$INP Q:$E(LEXINP,1)="^" "^"  Q:$E(LEXINP,1,2)="^^" "^^"
"RTN","LEXQIL",34,0)
 K ^TMP("LEXQIL",$J) D BC($G(LEXINP),$G(LEXFI)) I +($G(^TMP("LEXQIL",$J,0)))=1 D  Q X
"RTN","LEXQIL",35,0)
 . N OUT S LEXFI=80.1 S LEXOUT=$$ONE,X=-1 S:$E(LEXOUT,1)["^" X="^" S:+LEXOUT>0 X=$G(LEXOUT)
"RTN","LEXQIL",36,0)
 I +($G(^TMP("LEXQIL",$J,0)))>1 D  Q X
"RTN","LEXQIL",37,0)
 . N OUT S LEXFI=80.1 S LEXOUT=$$MUL,X=-1 S:$E(LEXOUT,1)["^" X="^" S:+LEXOUT>0 X=$G(LEXOUT)
"RTN","LEXQIL",38,0)
 K ^TMP("LEXQIL",$J) D BT($G(LEXINP),$G(LEXFI)) I +($G(^TMP("LEXQIL",$J,0)))=1 D  Q X
"RTN","LEXQIL",39,0)
 . N OUT S LEXFI=80.1 S LEXOUT=$$ONE,X=-1 S:$E(LEXOUT,1)["^" X="^" S:+LEXOUT>0 X=$G(LEXOUT)
"RTN","LEXQIL",40,0)
 I +($G(^TMP("LEXQIL",$J,0)))>1 D  Q X
"RTN","LEXQIL",41,0)
 . N OUT S LEXFI=80.1 S LEXOUT=$$MUL,X=-1 S:$E(LEXOUT,1)["^" X="^" S:+LEXOUT>0 X=$G(LEXOUT)
"RTN","LEXQIL",42,0)
 Q X
"RTN","LEXQIL",43,0)
 ;
"RTN","LEXQIL",44,0)
 ; Selections
"RTN","LEXQIL",45,0)
ONE(X) ;   One Entry Found
"RTN","LEXQIL",46,0)
 Q:"^80^80.1^"'[("^"_$G(LEXFI)_"^") "^^"  Q:+($G(LEXEXIT))>0 "^^"
"RTN","LEXQIL",47,0)
 N DIR,DIROUT,DIRUT,DTOUT,DUOUT,LEX,LEXC,LEXCT,LEXIEN,LEXTX,LEXX,Y
"RTN","LEXQIL",48,0)
 S LEXTX=$G(^TMP("LEXQIL",$J,1)),LEXIEN=+LEXTX,LEXTX=$P(LEXTX,U,2),LEX(1)=LEXTX D PR^LEXU(.LEX,70)
"RTN","LEXQIL",49,0)
 S DIR("A",1)=" One code found",DIR("A",2)=" ",DIR("A",3)="     "_$G(LEX(1)),LEXC=3 K LEX(1) D:$O(LEX(0))>0 PR^LEXU(.LEX,64)
"RTN","LEXQIL",50,0)
 S:$L($G(LEX(1))) LEXC=LEXC+1,DIR("A",LEXC)="                "_$G(LEX(1))
"RTN","LEXQIL",51,0)
 S:$L($G(LEX(2))) LEXC=LEXC+1,DIR("A",LEXC)="                "_$G(LEX(2))
"RTN","LEXQIL",52,0)
 S LEXC=LEXC+1,DIR("A",LEXC)=" ",LEXC=LEXC+1,DIR("A")="   OK?  (Yes/No)  ",DIR("B")="Yes",DIR(0)="YAO" W:'$D(LEXQUIET) !
"RTN","LEXQIL",53,0)
 S (X,Y)="" D:'$D(LEXQUIET) ^DIR S:$D(LEXQUIET) Y=1 S:X["^^"!($D(DTOUT)) LEXEXIT=1,X="^^"
"RTN","LEXQIL",54,0)
 I X["^^"!(+($G(LEXEXIT))>0)!($D(DIROUT)) K ^TMP("LEXQIL",$J) S LEXEXIT=1 Q "^^"
"RTN","LEXQIL",55,0)
 S X=-1 S:+Y'>0 X=-1  S:+Y>0 X=$$X(+($G(LEXIEN)),+($G(LEXFI)))
"RTN","LEXQIL",56,0)
 Q X
"RTN","LEXQIL",57,0)
MUL(X) ;   Multiple Entries Found
"RTN","LEXQIL",58,0)
 Q:"^80^80.1^"'[("^"_$G(LEXFI)_"^") "^^"  Q:+($G(LEXEXIT))>0 "^^"
"RTN","LEXQIL",59,0)
 N LEXENT,LEXI,LEXIEN,LEXIT,LEXMAX,LEXSS,LEXSTR,LEXT1,LEXTTT,Y
"RTN","LEXQIL",60,0)
 S (LEXMAX,LEXI,LEXSS,LEXIT)=0 S U="^",LEXTTT=$G(^TMP("LEXQIL",$J,0)),LEXSS=0
"RTN","LEXQIL",61,0)
 G:+LEXTTT=0 MULQ W ! W:+LEXTTT>1 !," ",LEXTTT," matches found"
"RTN","LEXQIL",62,0)
 F LEXI=1:1:LEXTTT Q:((LEXSS>0)&(LEXSS<LEXI+1))  Q:LEXIT  D  Q:LEXIT
"RTN","LEXQIL",63,0)
 . S LEXENT=$G(^TMP("LEXQIL",$J,LEXI))
"RTN","LEXQIL",64,0)
 . S LEXIEN=$P(LEXENT,U,1) Q:'$L($P(LEXENT,"^",2))  S LEXMAX=LEXI W:LEXI#5=1 ! D MULW
"RTN","LEXQIL",65,0)
 . W:LEXI#5=0 ! S:LEXI#5=0 LEXSS=$$MULS(LEXMAX,LEXI) S:LEXSS["^" LEXIT=1
"RTN","LEXQIL",66,0)
 I LEXI#5'=0,+LEXSS=0 W ! S LEXSS=$$MULS(LEXMAX,LEXI) S:LEXSS["^" LEXIT=1
"RTN","LEXQIL",67,0)
 G MULQ
"RTN","LEXQIL",68,0)
 Q X
"RTN","LEXQIL",69,0)
MULW ;     Write Multiple
"RTN","LEXQIL",70,0)
 N LEX,LEXIEN,LEXJ,LEXK,LEXTX S LEXK=+($G(LEXI)) N LEXI S LEXTX=$P(LEXENT,U,2),LEXIEN=+LEXENT
"RTN","LEXQIL",71,0)
 K LEX S LEX(1)=LEXTX D PR^LEXU(.LEX,70) W !,$J(LEXK,5),".  ",$G(LEX(1)) K LEX(1) D:$O(LEX(0))>0 PR^LEXU(.LEX,59)
"RTN","LEXQIL",72,0)
 F LEXJ=1:1:5 S LEXTX=$G(LEX(LEXJ)) W:$L(LEXTX) !,"                   ",LEXTX
"RTN","LEXQIL",73,0)
 Q
"RTN","LEXQIL",74,0)
MULS(X,Y) ;     Select Multiple
"RTN","LEXQIL",75,0)
 Q:+($G(LEXEXIT))>0 "^^"
"RTN","LEXQIL",76,0)
 N DIR,DIRB,DIROUT,DIRUT,DTOUT,DUOUT,LEXI,LEXLAST,LEXMAX,LEXS,LEXTQ,Y
"RTN","LEXQIL",77,0)
 S (LEXS,LEXMAX)=+($G(X)),(LEXI,LEXLAST)=+($G(Y)) Q:LEXMAX=0 -1
"RTN","LEXQIL",78,0)
 S:+($O(^TMP("LEXQIL",$J,+LEXLAST)))>0 DIR("A")=" Press <RETURN> for more, '^' to exit, or Select 1-"_LEXMAX_":  "
"RTN","LEXQIL",79,0)
 S:+($O(^TMP("LEXQIL",$J,+LEXLAST)))'>0 DIR("A")=" Select 1-"_LEXMAX_":  "
"RTN","LEXQIL",80,0)
 S LEXTQ="    Answer must be from 1 to "_LEXMAX_", or <Return> to continue"
"RTN","LEXQIL",81,0)
 S DIR("PRE")="S:X[""?"" X=""??""",(DIR("?"),DIR("??"))="^D MULSH^LEXQL"
"RTN","LEXQIL",82,0)
 S DIR(0)="NAO^1:"_LEXMAX_":0" D ^DIR S:X["^^"!($D(DTOUT)) LEXEXIT=1,X="^^" I X["^^"!(+($G(LEXEXIT))>0) K ^TMP("LEXQIL",$J) Q "^^"
"RTN","LEXQIL",83,0)
 S LEXS=+Y S:$D(DTOUT)!(X[U) LEXS=U K DIR
"RTN","LEXQIL",84,0)
 Q LEXS
"RTN","LEXQIL",85,0)
MULSH ;     Select Multiple Help
"RTN","LEXQIL",86,0)
 I $L($G(LEXTQ)) W !,$G(LEXTQ) Q
"RTN","LEXQIL",87,0)
 Q
"RTN","LEXQIL",88,0)
MULQ ;     Quit Multiple
"RTN","LEXQIL",89,0)
 Q:+LEXSS'>0 -1  S X=-1 Q:"^80^80.1^"'[("^"_$G(LEXFI)_"^") X I +LEXSS>0 D
"RTN","LEXQIL",90,0)
 . N LEXIEN S LEXIEN=+($G(^TMP("LEXQIL",$J,+LEXSS))) S:+LEXIEN>0 X=$$X(+($G(LEXIEN)),+($G(LEXFI)))
"RTN","LEXQIL",91,0)
 Q X
"RTN","LEXQIL",92,0)
 ; 
"RTN","LEXQIL",93,0)
 ; Lookups
"RTN","LEXQIL",94,0)
BC(X,Y) ;   Lookup by Code
"RTN","LEXQIL",95,0)
 K ^TMP("LEXQIL",$J) N LEXFI,LEXCTL,LEXIEN,LEXINP,LEXORD,LEXRT,LEXSY S LEXFI=+($G(Y)) Q:"^80^80.1^"'[("^"_$G(LEXFI)_"^")
"RTN","LEXQIL",96,0)
 S LEXINP=$G(X) Q:'$L(X)  S LEXRT=$$ROOT^ICDEX(LEXFI)
"RTN","LEXQIL",97,0)
 S LEXORD=$E(LEXINP,1,($L(LEXINP)-1))_$C($A($E(LEXINP,$L(LEXINP)))-1)_"~",LEXCTL=LEXINP
"RTN","LEXQIL",98,0)
 F  S LEXORD=$O(@(LEXRT_"""BA"","""_LEXORD_""")")) Q:'$L(LEXORD)  Q:LEXORD'[LEXCTL  D
"RTN","LEXQIL",99,0)
 . N LEXIEN S LEXIEN=0,LEXTMP=LEXRT_"""BA"","""_LEXORD_""","_LEXIEN_")"
"RTN","LEXQIL",100,0)
 . F  S LEXIEN=$O(@(LEXRT_"""BA"","""_LEXORD_""","_LEXIEN_")")) Q:+LEXIEN'>0  D
"RTN","LEXQIL",101,0)
 . . I +LEXIEN>0&($D(@(LEXRT_+LEXIEN_",0)"))) D
"RTN","LEXQIL",102,0)
 . . . N LEXCODE,LEXCOM,LEXCT,LEXEFF,LEXHIS,LEXLAS,LEXSPC,LEXSR,LEXSTA,LEXSTR,LEXTD,LEXTXT,LEXTY S LEXTD=$$DT^XLFDT
"RTN","LEXQIL",103,0)
 . . . S LEXCODE=$P($G(@(LEXRT_LEXIEN_",0)")),"^",1),LEXSR=$P($G(@(LEXRT_LEXIEN_",1)")),"^",1)
"RTN","LEXQIL",104,0)
 . . . S:"^1^30^"[("^"_LEXSR_"^") LEXTY="Diagnosis" S:"^2^31^"[("^"_LEXSR_"^") LEXTY="Procedure"
"RTN","LEXQIL",105,0)
 . . . S LEXEFF=$O(@(LEXRT_LEXIEN_",66,""B"","_(LEXTD+.0001)_")"),-1)
"RTN","LEXQIL",106,0)
 . . . S LEXHIS=0 S:LEXEFF?7N LEXHIS=$O(@(LEXRT_LEXIEN_",66,""B"","_+LEXEFF_","" "")"),-1)
"RTN","LEXQIL",107,0)
 . . . S LEXSTA=0 S:LEXHIS>0 LEXSTA=$P($G(@(LEXRT_LEXIEN_",66,"_+LEXHIS_",0)")),"^",2)
"RTN","LEXQIL",108,0)
 . . . S LEXLAS=$O(@(LEXRT_LEXIEN_",66,""B"","" "")"),-1)
"RTN","LEXQIL",109,0)
 . . . S LEXHIS=$O(@(LEXRT_LEXIEN_",68,""B"","" "")"),-1)
"RTN","LEXQIL",110,0)
 . . . S:LEXHIS?7N LEXHIS=$O(@(LEXRT_LEXIEN_",68,""B"","_+LEXHIS_","" "")"),-1)
"RTN","LEXQIL",111,0)
 . . . S LEXTXT="" S:+LEXHIS>0 LEXTXT=$P($G(@(LEXRT_LEXIEN_",68,"_+LEXHIS_",1)")),"^",1)
"RTN","LEXQIL",112,0)
 . . . S:LEXEFF=""&(LEXLAS?7N) LEXCOM="Pending"
"RTN","LEXQIL",113,0)
 . . . S:LEXEFF?7N&(+LEXSTA'>0) LEXCOM="Inactive"
"RTN","LEXQIL",114,0)
 . . . S:LEXSR'>29&($L($G(LEXCOM))) LEXCOM=$G(LEXCOM)_", ICD-9"
"RTN","LEXQIL",115,0)
 . . . S:LEXSR>29&($L($G(LEXCOM))) LEXCOM=$G(LEXCOM)_", ICD-10"
"RTN","LEXQIL",116,0)
 . . . S:$L($G(LEXTY))&($L($G(LEXCOM))) LEXCOM=LEXCOM_" "_LEXTY
"RTN","LEXQIL",117,0)
 . . . S LEXSPC=$S(LEXFI=80:$J(" ",(11-$L($G(LEXCODE)))),1:$J(" ",(10-$L($G(LEXCODE)))))
"RTN","LEXQIL",118,0)
 . . . S LEXSTR=$G(LEXCODE)_LEXSPC_LEXTXT S:$L($G(LEXCOM)) LEXSTR=LEXSTR_" ("_$G(LEXCOM)_")"
"RTN","LEXQIL",119,0)
 . . . I $D(LEXQUIET),$L($G(LEXDIRB)) D  Q
"RTN","LEXQIL",120,0)
 . . . . I $G(LEXDIRB)=LEXCODE S ^TMP("LEXQIL",$J,0)=1,^TMP("LEXQIL",$J,1)=(LEXIEN_"^"_LEXSTR)
"RTN","LEXQIL",121,0)
 . . . S LEXCT=$O(^TMP("LEXQIL",$J," "),-1)+1
"RTN","LEXQIL",122,0)
 . . . S ^TMP("LEXQIL",$J,0)=LEXCT
"RTN","LEXQIL",123,0)
 . . . S ^TMP("LEXQIL",$J,LEXCT)=(LEXIEN_"^"_LEXSTR)
"RTN","LEXQIL",124,0)
 Q
"RTN","LEXQIL",125,0)
BT(X,Y) ;   Lookup by Text
"RTN","LEXQIL",126,0)
 N LEXFI,LEXINP,LEXRT S LEXINP=$G(X) Q:'$L(X)  S LEXFI=+($G(Y)) Q:"^80^80.1^"'[("^"_LEXFI_"^")  S LEXRT=$$ROOT^ICDEX(LEXFI) D BLD(LEXINP,LEXFI)
"RTN","LEXQIL",127,0)
 Q
"RTN","LEXQIL",128,0)
BLD(X,Y) ;     Build Selection Array
"RTN","LEXQIL",129,0)
 K ^TMP("LEXQIL",$J) Q:'$L($G(X))!('$L($G(Y))) "^^"  N LEXFI,LEXINP,LEXRT,LEXSY,LEXTOK K LEXTOK
"RTN","LEXQIL",130,0)
 S LEXINP=$$UP^XLFSTR($G(X)),LEXFI=+($G(Y)),LEXRT=$$ROOT^ICDEX(LEXFI) D PAR(LEXINP,LEXFI,.LEXTOK) D GET(LEXFI,.LEXTOK)
"RTN","LEXQIL",131,0)
 Q
"RTN","LEXQIL",132,0)
PAR(X,Y,LEX) ;     Parse text into tokens
"RTN","LEXQIL",133,0)
 N LEXFI,LEXI,LEXINP,LEXRT,LEXSY,LEXTK,LEXTMP S LEXINP=$G(X),LEXFI=+($G(Y)),LEXRT=$$ROOT^ICDEX(LEXFI),LEXSY="" K LEX
"RTN","LEXQIL",134,0)
 Q:'$L(LEXINP)  Q:'$D(LEXRT)  D TOKEN^ICDEX($G(LEXINP),$G(LEXRT),$G(LEXSY),.LEXTMP)
"RTN","LEXQIL",135,0)
 S LEXI=0 F  S LEXI=$O(LEXTMP(LEXI)) Q:+LEXI'>0  D
"RTN","LEXQIL",136,0)
 . N LEXTK S LEXTK=$G(LEXTMP(LEXI)) Q:'$L(LEXTK)  Q:'$D(@(LEXRT_"""D"","""_LEXTK_""")"))
"RTN","LEXQIL",137,0)
 . S LEX(0)=+($G(LEX(0)))+1,LEX(+($G(LEX(0))))=LEXTK
"RTN","LEXQIL",138,0)
 K LEXTMP
"RTN","LEXQIL",139,0)
 Q
"RTN","LEXQIL",140,0)
GET(X,LEX) ;     Get Entries
"RTN","LEXQIL",141,0)
 N LEXFI,LEXRT,LEXORD,LEXORG,LEXIEN,LEXTD S LEXFI=+($G(X)),LEXRT=$$ROOT^ICDEX(LEXFI),LEXORG=$G(LEX(1)) Q:'$L(LEXORG)  S LEXTD=$$DT^XLFDT
"RTN","LEXQIL",142,0)
 S LEXIEN=0 F  S LEXIEN=$O(@(LEXRT_"""D"","""_LEXORG_""","_+LEXIEN_")")) Q:+LEXIEN'>0  D
"RTN","LEXQIL",143,0)
 . N LEXOK,LEXI S LEXOK=1 S LEXI=1 F  S LEXI=$O(LEX(LEXI)) Q:+LEXI'>0  D  Q:'LEXOK
"RTN","LEXQIL",144,0)
 . . N LEXORD S LEXORD=$G(LEX(LEXI)) I '$D(@(LEXRT_"""D"","""_LEXORD_""","_+LEXIEN_")")) S LEXOK=0 Q
"RTN","LEXQIL",145,0)
 . I LEXOK D
"RTN","LEXQIL",146,0)
 . . N LEXCODE,LEXCOM,LEXEFF,LEXHIS,LEXLAS,LEXSPC,LEXSR,LEXSTA,LEXSTR,LEXTXT,LEXTY
"RTN","LEXQIL",147,0)
 . . S LEXCODE=$P($G(@(LEXRT_LEXIEN_",0)")),"^",1)
"RTN","LEXQIL",148,0)
 . . S LEXSR=$P($G(@(LEXRT_LEXIEN_",1)")),"^",1)
"RTN","LEXQIL",149,0)
 . . S:"^1^30^"[("^"_LEXSR_"^") LEXTY="Diagnosis"
"RTN","LEXQIL",150,0)
 . . S:"^2^31^"[("^"_LEXSR_"^") LEXTY="Procedure"
"RTN","LEXQIL",151,0)
 . . S LEXEFF=$O(@(LEXRT_LEXIEN_",66,""B"","_(LEXTD+.0001)_")"),-1)
"RTN","LEXQIL",152,0)
 . . S LEXHIS=0 S:LEXEFF?7N LEXHIS=$O(@(LEXRT_LEXIEN_",66,""B"","_+LEXEFF_","" "")"),-1)
"RTN","LEXQIL",153,0)
 . . S LEXSTA=0 S:LEXHIS>0 LEXSTA=$P($G(@(LEXRT_LEXIEN_",66,"_+LEXHIS_",0)")),"^",2)
"RTN","LEXQIL",154,0)
 . . S LEXLAS=$O(@(LEXRT_LEXIEN_",66,""B"","" "")"),-1)
"RTN","LEXQIL",155,0)
 . . S LEXHIS=$O(@(LEXRT_LEXIEN_",68,""B"","" "")"),-1)
"RTN","LEXQIL",156,0)
 . . S:LEXHIS?7N LEXHIS=$O(@(LEXRT_LEXIEN_",68,""B"","_+LEXHIS_","" "")"),-1)
"RTN","LEXQIL",157,0)
 . . S LEXTXT="" S:+LEXHIS>0 LEXTXT=$P($G(@(LEXRT_LEXIEN_",68,"_+LEXHIS_",1)")),"^",1)
"RTN","LEXQIL",158,0)
 . . S:LEXEFF=""&(LEXLAS?7N) LEXCOM="Pending"
"RTN","LEXQIL",159,0)
 . . S:LEXEFF?7N&(+LEXSTA'>0) LEXCOM="Inactive"
"RTN","LEXQIL",160,0)
 . . S:LEXSR'>29&($L($G(LEXCOM))) LEXCOM=$G(LEXCOM)_", ICD-9"
"RTN","LEXQIL",161,0)
 . . S:LEXSR>29&($L($G(LEXCOM))) LEXCOM=$G(LEXCOM)_", ICD-10"
"RTN","LEXQIL",162,0)
 . . S:$L($G(LEXTY))&($L($G(LEXCOM))) LEXCOM=LEXCOM_" "_LEXTY
"RTN","LEXQIL",163,0)
 . . S LEXSPC=$S(LEXFI=80:$J(" ",(11-$L($G(LEXCODE)))),1:$J(" ",(10-$L($G(LEXCODE)))))
"RTN","LEXQIL",164,0)
 . . S LEXSTR=$G(LEXCODE)_LEXSPC_LEXTXT S:$L($G(LEXCOM)) LEXSTR=LEXSTR_" ("_$G(LEXCOM)_")"
"RTN","LEXQIL",165,0)
 . . S ^TMP("LEXQIL",$J,"ORD",(LEXCODE_" "))=(LEXIEN_"^"_LEXSTR)
"RTN","LEXQIL",166,0)
 S LEXORD="" F  S LEXORD=$O(^TMP("LEXQIL",$J,"ORD",LEXORD)) Q:'$L(LEXORD)  D
"RTN","LEXQIL",167,0)
 . N LEXCT,LEXVAL S LEXVAL=$G(^TMP("LEXQIL",$J,"ORD",LEXORD)) Q:+LEXVAL'>0  Q:'$L($P(LEXVAL,"^",2))
"RTN","LEXQIL",168,0)
 . S LEXCT=$O(^TMP("LEXQIL",$J," "),-1)+1,^TMP("LEXQIL",$J,LEXCT)=LEXVAL,^TMP("LEXQIL",$J,0)=LEXCT
"RTN","LEXQIL",169,0)
 K ^TMP("LEXQIL",$J,"ORD")
"RTN","LEXQIL",170,0)
 Q
"RTN","LEXQIL",171,0)
 ; 
"RTN","LEXQIL",172,0)
 ; Miscellaneous
"RTN","LEXQIL",173,0)
INP(X) ;   Input
"RTN","LEXQIL",174,0)
 Q:"^80^80.1^"'[("^"_$G(LEXFI)_"^") "^^"  Q:+($G(LEXEXIT))>0 "^^"
"RTN","LEXQIL",175,0)
 N DIR,DIROUT,DIRUT,DTOUT,DUOUT,LEXTD,Y,LEX,LEXIT S:LEXFI=80 DIR("A")=" Enter a Diagnosis Code or Term:  "
"RTN","LEXQIL",176,0)
 S:LEXFI=80.1 DIR("A")=" Enter a Procedure Code or Term:  " Q:'$L($G(DIR("A"))) "^^"  S DIR(0)="FAO^1:70"
"RTN","LEXQIL",177,0)
 S DIR("PRE")="S:X[""?"" X=""??""",(DIR("?"),DIR("??"))="^D INPH^LEXQIL" W ! D ^DIR
"RTN","LEXQIL",178,0)
 Q:X="^^"!($D(DTOUT))!(+($G(LEXEXIT))) "^^"  S:$D(DIROUT)!($D(DIRUT))!($D(DTOUT))!($D(DUOUT)) X="^" Q:$E(X,1)="^" X
"RTN","LEXQIL",179,0)
 S X="^" S:$L(Y) X=$$UP^XLFSTR(Y)
"RTN","LEXQIL",180,0)
 Q X
"RTN","LEXQIL",181,0)
INPH ;   Input Help
"RTN","LEXQIL",182,0)
 I +($G(LEXFI))=80 D  Q
"RTN","LEXQIL",183,0)
 . W !,"     Enter an ICD Diagnosis code or a term, or '^' to exit",!
"RTN","LEXQIL",184,0)
 I +($G(LEXFI))=80.1 D  Q
"RTN","LEXQIL",185,0)
 . W !,"     Enter an ICD Procedure code or a term, or '^' to exit",!
"RTN","LEXQIL",186,0)
 W !,"     Enter an ICD code or a term, or '^' to exit",!
"RTN","LEXQIL",187,0)
 Q
"RTN","LEXQIL",188,0)
X(X,Y) ;   Get X Return Value
"RTN","LEXQIL",189,0)
 N LEXIEN,LEXFI S LEXIEN=+X,X=-1,LEXFI=$G(Y) Q:"^80^80.1^"'[("^"_LEXFI_"^") -1 I +LEXIEN>0 D
"RTN","LEXQIL",190,0)
 . N LEXFD,LEXSO,LEXSY,LEXDX,LEXTX,LEXTD S LEXFD=$$FD,LEXTD=$$DT^XLFDT,LEXSO=$$CODEC^ICDEX(LEXFI,LEXIEN)
"RTN","LEXQIL",191,0)
 . S LEXSY=$$CSI^ICDEX(LEXFI,LEXIEN)
"RTN","LEXQIL",192,0)
 . I LEXFI=80 S LEXDX=$$ICDDX^ICDEX(LEXSO,LEXFD,LEXSY,"E"),LEXTX=$P(LEXDX,"^",4)
"RTN","LEXQIL",193,0)
 . I LEXFI=80.1 S LEXDX=$$ICDOP^ICDEX(LEXSO,LEXFD,LEXSY,"E"),LEXTX=$P(LEXDX,"^",5)
"RTN","LEXQIL",194,0)
 . S X=LEXIEN_"^"_LEXSO_"^"_LEXTX
"RTN","LEXQIL",195,0)
 S X=$$UP^XLFSTR(X)
"RTN","LEXQIL",196,0)
 Q X
"RTN","LEXQIL",197,0)
FD(X) ;   Get Future Date
"RTN","LEXQIL",198,0)
 S X=$$DT^XLFDT,X=($E(X,1,3)+1)_"1001" N LEXEXIT
"RTN","LEXQIL",199,0)
 Q X
"RTN","LEXQIL",200,0)
TM(X,Y) ;   Trim Character Y - Default " "
"RTN","LEXQIL",201,0)
 S X=$G(X) Q:X="" X  S Y=$G(Y) S:'$L(Y) Y=" "
"RTN","LEXQIL",202,0)
 F  Q:$E(X,1)'=Y  S X=$E(X,2,$L(X))
"RTN","LEXQIL",203,0)
 F  Q:$E(X,$L(X))'=Y  S X=$E(X,1,($L(X)-1))
"RTN","LEXQIL",204,0)
 Q X
"RTN","LEXQIP")
0^7^B97355385^B96505280
"RTN","LEXQIP",1,0)
LEXQIP ;ISL/KER - Query - ICD Procedure - Extract ;10/10/2017
"RTN","LEXQIP",2,0)
 ;;2.0;LEXICON UTILITY;**62,73,80,86,103,114**;Sep 23, 1996;Build 1
"RTN","LEXQIP",3,0)
 ;               
"RTN","LEXQIP",4,0)
 ; Global Variables
"RTN","LEXQIP",5,0)
 ;    ^TMP("LEXQIP")      SACC 2.3.2.5.1
"RTN","LEXQIP",6,0)
 ;    ^TMP("LEXQIPA")     SACC 2.3.2.5.1
"RTN","LEXQIP",7,0)
 ;    ^TMP("LEXQIPO")     SACC 2.3.2.5.1
"RTN","LEXQIP",8,0)
 ;               
"RTN","LEXQIP",9,0)
 ; External References
"RTN","LEXQIP",10,0)
 ;    GETS^DIQ            ICR   2056
"RTN","LEXQIP",11,0)
 ;    $$CODEC^ICDEX       ICR   5747
"RTN","LEXQIP",12,0)
 ;    $$CSI^ICDEX         ICR   5747
"RTN","LEXQIP",13,0)
 ;    $$DTBR^ICDEX        ICR   5747
"RTN","LEXQIP",14,0)
 ;    $$HIST^ICDEX        ICR   5747
"RTN","LEXQIP",15,0)
 ;    $$ICDOP^ICDEX       ICR   5747
"RTN","LEXQIP",16,0)
 ;    $$LA^ICDEX          ICR   5747
"RTN","LEXQIP",17,0)
 ;    $$LD^ICDEX          ICR   5747
"RTN","LEXQIP",18,0)
 ;    $$MOR^ICDEX         ICR   5747
"RTN","LEXQIP",19,0)
 ;    $$ROOT^ICDEX        ICR   5747
"RTN","LEXQIP",20,0)
 ;    $$SD^ICDEX          ICR   5747
"RTN","LEXQIP",21,0)
 ;    $$DT^XLFDT          ICR  10103
"RTN","LEXQIP",22,0)
 ;    $$UP^XLFSTR         ICR  10104
"RTN","LEXQIP",23,0)
 ;               
"RTN","LEXQIP",24,0)
 ; Local Variables NEWed or KILLed Elsewhere
"RTN","LEXQIP",25,0)
 ;    LEXIIEN             Include IENs flag
"RTN","LEXQIP",26,0)
 ;    
"RTN","LEXQIP",27,0)
EN ; Main Entry Point
"RTN","LEXQIP",28,0)
 N LEXENV S LEXENV=$$EV^LEXQM Q:+LEXENV'>0  N DIC,DTOUT,DUOUT,DO,ICDFMT,ICDSYS,ICDVDT,LEX,LEX1,LEX2,LEX3,LEXAD,LEXBOD,LEXBRD
"RTN","LEXQIP",29,0)
 N LEXBRW,LEXC,LEXCC,LEXCDT,LEXCHR,LEXD,LEXDAT,LEXDDT,LEXDG,LEXDI,LEXDR,LEXDRG,LEXDRG1,LEXDRG2,LEXDRGC,LEXDRGD,LEXDRGI
"RTN","LEXQIP",30,0)
 N LEXDRI,LEXDTXT,LEXDX,LEXE,LEXEDT,LEXEE,LEXEF,LEXEFF,LEXELDT,LEXENV,LEXES,LEXEXIT,LEXFA,LEXFUL,LEXH,LEXHDR,LEXHIS,LEXHR
"RTN","LEXQIP",31,0)
 N LEXI,LEXI1,LEXI2,LEXIA,LEXICP,LEXICPC,LEXID,LEXIDI,LEXIEN,LEXIENS,LEXINC,LEXINCC,LEXINOT,LEXINT,LEXIREQ,LEXL,LEXLA
"RTN","LEXQIP",32,0)
 N LEXLAST,LEXLC,LEXLD,LEXLDD,LEXLDT,LEXLEF,LEXLEN,LEXLHI,LEXLS,LEXLSD,LEXLTXT,LEXLX,LEXM,LEXMC,LEXMDCC,LEXMDCE,LEXMDCI,LEXMI
"RTN","LEXQIP",33,0)
 N LEXMOR,LEXMR,LEXMSG,LEXN,LEXNAM,LEXOD,LEXODD,LEXPC,LEXR,LEXREF,LEXRT,LEXS,LEXSD,LEXSDD,LEXSDT,LEXSO,LEXST,LEXSTA
"RTN","LEXQIP",34,0)
 N LEXSTAT,LEXSTR,LEXSY,LEXSYS,LEXT,LEXTEST,LEXTMP,LEXUD,LEXUM,LEXVDT,LEXVTXT,LEXW,LEXWN,LEXX,TXT,TX1,TX2,I,X,Y,Z
"RTN","LEXQIP",35,0)
 S LEXEXIT=0,LEXCDT="" K ^TMP("LEXQIP",$J),^TMP("LEXQIPO",$J),^TMP("LEXQIPA",$J)
"RTN","LEXQIP",36,0)
 F  S LEXCDT=$$AD^LEXQM,LEXAD=LEXCDT Q:'$L(LEXCDT)  Q:+($G(LEXEXIT))>0  S LEXEDT=$P(LEXCDT,"^",1),LEXCDT=$P(LEXCDT,"^",2) Q:LEXCDT'?7N  D LOOK Q:LEXCDT'?7N  Q:+($G(LEXEXIT))>0
"RTN","LEXQIP",37,0)
 K ^TMP("LEXQIP",$J),^TMP("LEXQIPO",$J),^TMP("LEXQIPA",$J)
"RTN","LEXQIP",38,0)
 Q
"RTN","LEXQIP",39,0)
IEN ; Display with IENs
"RTN","LEXQIP",40,0)
 N LEXIIEN S LEXIIEN=1 D EN
"RTN","LEXQIP",41,0)
 Q
"RTN","LEXQIP",42,0)
LOOK ; ICD Lookup Loop
"RTN","LEXQIP",43,0)
 N LEXDG,LEXST,LEXSD,LEXLD,LEXMOR,LEXWN,LEXCC,LEXMC,LEXICP,LEXICPC
"RTN","LEXQIP",44,0)
 S LEXCDT=$G(LEXCDT),LEXEDT=$$ED^LEXQM(LEXCDT) I LEXCDT'?7N S LEXCDT="" Q
"RTN","LEXQIP",45,0)
 S LEXLEN=62 F  S LEXICP=$$ICP^LEXQIL D  Q:LEXICP="^"!(LEXICP="^^")
"RTN","LEXQIP",46,0)
 . S:$E(LEXICP,1,2)="^^" LEXICP="^^",LEXEXIT=1 Q:+($G(LEXEXIT))>0!(LEXICP="^^")
"RTN","LEXQIP",47,0)
 . S:$E(LEXICP,1)="^" LEXICP="^" Q:LEXICP="^"
"RTN","LEXQIP",48,0)
 . K LEXST,LEXSD,LEXLD,LEXWN,LEXCC,LEXMOR,LEXMC,^TMP("LEXQIP",$J)
"RTN","LEXQIP",49,0)
 . N LEXIEN,LEXLDT,LEXELDT,LEXINC,LEXINOT,LEXIREQ,LEXINCC,LEXSO,LEXNAM
"RTN","LEXQIP",50,0)
 . S LEXIEN=+($G(LEXICP)),LEXLDT=+($G(LEXCDT)) Q:+LEXIEN'>0  Q:LEXLDT'?7N
"RTN","LEXQIP",51,0)
 . S LEXELDT=$$SD^LEXQM(LEXLDT) Q:'$L(LEXELDT)
"RTN","LEXQIP",52,0)
 . D CSV,EN^LEXQIP3
"RTN","LEXQIP",53,0)
 Q
"RTN","LEXQIP",54,0)
CSV ; Code Set Versioning Display
"RTN","LEXQIP",55,0)
 N LEXEDT,LEXIEN,LEXIENS,LEXLTXT,LEXSTAT,LEXSYS,LEXMSG,LEXDAT
"RTN","LEXQIP",56,0)
 N LEXT,LEXTMP S LEXCDT=$G(LEXCDT),LEXEDT=$$ED^LEXQM(LEXCDT)
"RTN","LEXQIP",57,0)
 I LEXCDT'?7N S (LEXICP,LEXCDT)="" Q
"RTN","LEXQIP",58,0)
 S LEXIEN=+($G(LEXICP)),LEXSO=$$CODEC^ICDEX(80.1,+LEXIEN)
"RTN","LEXQIP",59,0)
 S LEXLTXT=$P($G(LEXICP),"^",3) S LEXSYS=$$CSI^ICDEX(80.1,+LEXIEN)
"RTN","LEXQIP",60,0)
 Q:+LEXIEN'>0  Q:'$L(LEXSO)  Q:+LEXSYS'>0
"RTN","LEXQIP",61,0)
 S LEXDAT=$$ICDOP^ICDEX(LEXSO,LEXCDT,LEXSYS,"E")
"RTN","LEXQIP",62,0)
 S LEXSO=$P(LEXDAT,"^",2),LEXNAM=$P(LEXDAT,"^",5)
"RTN","LEXQIP",63,0)
 I '$L(LEXNAM)!($P(LEXNAM,"^",1)=-1) D
"RTN","LEXQIP",64,0)
 . N LEXLA S LEXLA=$$LA^ICDEX(80.1,+LEXIEN,9999999)
"RTN","LEXQIP",65,0)
 . S LEXNAM=$$SD^ICDEX(80.1,+LEXIEN,LEXLA)
"RTN","LEXQIP",66,0)
 Q:'$L($G(LEXNAM))
"RTN","LEXQIP",67,0)
 ;
"RTN","LEXQIP",68,0)
 ; "Unversioned" Fields
"RTN","LEXQIP",69,0)
 ; 
"RTN","LEXQIP",70,0)
 ;   ,01   Code
"RTN","LEXQIP",71,0)
 ;   1.1   Coding System
"RTN","LEXQIP",72,0)
 ;   1.2   Identifier
"RTN","LEXQIP",73,0)
 ;   1.4   MDC24
"RTN","LEXQIP",74,0)
 ;   1.7   ICD Expanded
"RTN","LEXQIP",75,0)
 ;   1.8   Exclude from Lookup
"RTN","LEXQIP",76,0)
 ;   20    MAJOR O.R. PROC
"RTN","LEXQIP",77,0)
 ;   
"RTN","LEXQIP",78,0)
 S LEXTMP=$$MOR^ICDEX(+LEXIEN) D:$L(LEXTMP) OR^LEXQIP2(LEXTMP,.LEXMOR)
"RTN","LEXQIP",79,0)
 ;            
"RTN","LEXQIP",80,0)
 ; Get the "Versioned" Fields
"RTN","LEXQIP",81,0)
 ;            
"RTN","LEXQIP",82,0)
 ;   Date/Status          80.166  (66)
"RTN","LEXQIP",83,0)
 S LEXST=$$EF(+($G(LEXIEN)),+LEXCDT),LEXSTAT=+($P(LEXST,"^",2))
"RTN","LEXQIP",84,0)
 ;   Procedure Name       80.167  (67)
"RTN","LEXQIP",85,0)
 D SDS(+($G(LEXIEN)),+LEXCDT,.LEXSD,62,LEXSTAT)
"RTN","LEXQIP",86,0)
 ;   Description          80.168  (68)
"RTN","LEXQIP",87,0)
 D LDS(+($G(LEXIEN)),+LEXCDT,.LEXLD,62,LEXSTAT)
"RTN","LEXQIP",88,0)
 ;   Lexicon Expression
"RTN","LEXQIP",89,0)
 D LX^LEXQIP2(+($G(LEXIEN)),+LEXCDT,.LEXLX,62,LEXSTAT)
"RTN","LEXQIP",90,0)
 ;   Warning Message
"RTN","LEXQIP",91,0)
 D WN(+LEXCDT,.LEXWN,62)
"RTN","LEXQIP",92,0)
 ;   MDC/DRG Groups       80.171  (71)
"RTN","LEXQIP",93,0)
 ;D MDCDRG^LEXQIP2(+LEXIEN,+LEXCDT,.LEXDG,LEXLEN)
"RTN","LEXQIP",94,0)
 Q
"RTN","LEXQIP",95,0)
 ;      
"RTN","LEXQIP",96,0)
EF(X,LEXCDT) ; Effective Dates
"RTN","LEXQIP",97,0)
 N LEX,LEXAD,LEXBRD,LEXBRW,LEXEE,LEXEF,LEXES,LEXFA,LEXH,LEXI,LEXID,LEXIEN,LEXRT,LEXLS,LEXSO,LEXSYS,LEXST S LEXIEN=+($G(X)),LEXCDT=+($G(LEXCDT))
"RTN","LEXQIP",98,0)
 S LEXRT=$$ROOT^ICDEX(80.1) Q:+LEXIEN'>0 "^^"  S LEXSO=$$CODEC^ICDEX(80.1,+LEXIEN) Q:'$L(LEXSO)!($P(LEXSO,"^",1)="-1")  Q:LEXCDT'?7N "^^"
"RTN","LEXQIP",99,0)
 S LEXSYS=$$CSI^ICDEX(80.1,+LEXIEN),LEX=$$ICDOP^ICDEX(LEXSO,LEXCDT,LEXSYS,"E")
"RTN","LEXQIP",100,0)
 S LEXFA=$$FA(+LEXIEN),(LEXLS,LEXST)=$P(LEX,"^",10),LEXID=$P(LEX,"^",12),LEXAD=$P(LEX,"^",13),LEXBRD=2781001,LEXBRW=""
"RTN","LEXQIP",101,0)
 I LEXCDT<LEXBRD&(+LEXFA=LEXBRD) D
"RTN","LEXQIP",102,0)
 . S LEXBRW="Warning:  The 'Based on Date' provided precedes the initial Code Set Business Rule date of "
"RTN","LEXQIP",103,0)
 . S LEXBRW=LEXBRW_$$SD^LEXQM(LEXBRD)_", the Effective date may be inaccurate."
"RTN","LEXQIP",104,0)
 S LEXES=$S(+LEXST>0:"Active",1:"Inactive")
"RTN","LEXQIP",105,0)
 S:+LEXST'>0&(+LEXAD'>0) LEXES="Not Applicable",LEXLS=-1
"RTN","LEXQIP",106,0)
 S:+LEXFA>0&(+LEXCDT>0)&(LEXFA>LEXCDT) LEXES="Pending",LEXLS=-1,LEXST=0,LEXBRW=""
"RTN","LEXQIP",107,0)
 S:LEXST>0 LEXEF=LEXAD S:LEXST'>0 LEXEF=LEXID
"RTN","LEXQIP",108,0)
 S:LEXST'>0&(+LEXID'>0) LEXEF=LEXFA S LEXEE=$$SD^LEXQM(LEXEF)
"RTN","LEXQIP",109,0)
 I LEXST'>0,+LEXID'>0,$L(LEXEE),+LEXEF>LEXCDT S LEXEE="(future activation of "_LEXEE_")",LEXEF=""
"RTN","LEXQIP",110,0)
 S X=LEXLS_"^"_LEXST_"^"_LEXEF_"^"_LEXES_"^"_LEXEE S:$L(LEXBRW) $P(X,"^",6)=LEXBRW
"RTN","LEXQIP",111,0)
 Q X
"RTN","LEXQIP",112,0)
 ; 
"RTN","LEXQIP",113,0)
SDS(X,LEXVDT,LEX,LEXLEN,LEXSTA) ; Operation/Procedure (short description)
"RTN","LEXQIP",114,0)
 ; 
"RTN","LEXQIP",115,0)
 ; LEX=# of Lines
"RTN","LEXQIP",116,0)
 ; LEX(0)=External Date of Operation/Procedure Name
"RTN","LEXQIP",117,0)
 ; LEX(#)=Operation/Procedure Name
"RTN","LEXQIP",118,0)
 ; 
"RTN","LEXQIP",119,0)
 N LEXBRD,LEXBRW,LEXC,LEXD,LEXDDT,LEXE,LEXEE,LEXEFF,LEXFA
"RTN","LEXQIP",120,0)
 N LEXHIS,LEXI,LEXIA,LEXIEN,LEXAIEN,LEXSIEN,LEXL,LEXLA,LEXLAST
"RTN","LEXQIP",121,0)
 N LEXLEF,LEXLHI,LEXLSD,LEXM,LEXOD,LEXODD,LEXR,LEXS,LEXSD,LEXSDD
"RTN","LEXQIP",122,0)
 N LEXSDT,LEXSO,LEXSY,LEXT S LEXIEN=$G(X) Q:+LEXIEN'>0
"RTN","LEXQIP",123,0)
 S LEXVDT=+($G(LEXVDT)) S:LEXVDT'?7N LEXVDT=$$DT^XLFDT
"RTN","LEXQIP",124,0)
 S LEXSTA=+($G(LEXSTA)) S LEXSO=$$CODEC^ICDEX(80.1,+LEXIEN)
"RTN","LEXQIP",125,0)
 S LEXSY=$$CSI^ICDEX(80.1,+LEXIEN)
"RTN","LEXQIP",126,0)
 S LEXLA=$$LA^ICDEX(80.1,+LEXIEN,9999999),LEXFA=$$FA(+LEXIEN)
"RTN","LEXQIP",127,0)
 S LEXLAST=$$ICDOP^ICDEX(LEXSO,LEXLA,LEXSY,"E")
"RTN","LEXQIP",128,0)
 S LEXLSD=$P(LEXLAST,"^",5),LEXBRD=$$DTBR^ICDEX(LEXVDT,0,LEXSY),LEXBRW=""
"RTN","LEXQIP",129,0)
 S LEXSD=$$SD^ICDEX(80.1,+LEXIEN,LEXVDT,.LEXS)
"RTN","LEXQIP",130,0)
 S LEXSD=$G(LEXS(1)),LEXSDD=$P($G(LEXS(0)),"^",2)
"RTN","LEXQIP",131,0)
 S:'$L(LEXSD) LEXSDD="--/--/----" S LEXM=""
"RTN","LEXQIP",132,0)
 I $P(LEXSD,"^",1)="-1"!('$L(LEXSD)) D
"RTN","LEXQIP",133,0)
 . S LEXM="Operation/Procedure Short Name is not available."
"RTN","LEXQIP",134,0)
 . I (LEXVDT'?7N!(LEXFA'?7N)),LEXVDT<LEXFA D
"RTN","LEXQIP",135,0)
 . . S LEXM=LEXM_"  The date provided precedes the initial activation of the code"
"RTN","LEXQIP",136,0)
 . I LEXVDT?7N&(LEXFA?7N),LEXVDT<LEXFA D
"RTN","LEXQIP",137,0)
 . . S LEXM=LEXM_"  The date provided ("_$$ED^LEXQM(LEXVDT)_") precedes the initial activation ("_$$ED^LEXQM(LEXFA)_") of the code"
"RTN","LEXQIP",138,0)
 . S:$L(LEXM) LEXM="NOTE:  "_LEXM S LEXOD=LEXLSD,LEXODD="--/--/----"
"RTN","LEXQIP",139,0)
 S LEXAIEN=LEXIEN,LEXSIEN="" I $L(LEXSD)&($P(LEXSD,"^",1)'="-1") D
"RTN","LEXQIP",140,0)
 . S:LEXSDD?7N LEXSIEN=$O(@("^ICD0("_+LEXIEN_",67,""B"","_+LEXSDD_",0)"))
"RTN","LEXQIP",141,0)
 . S:+LEXSIEN>0 LEXAIEN=LEXAIEN_";"_LEXSIEN
"RTN","LEXQIP",142,0)
 . S LEXM="" S LEXOD=LEXSD S:$D(LEXIIEN) LEXOD=LEXOD_" (IEN "_LEXAIEN_")"
"RTN","LEXQIP",143,0)
 . S LEXODD=$S(LEXSDD?7N:$$ED^LEXQM(LEXSDD),1:"--/--/----")
"RTN","LEXQIP",144,0)
 S:'$L(LEXOD) LEXOD="Operation/Procedure Short Name not found"
"RTN","LEXQIP",145,0)
 S:'$L(LEXODD) LEXODD="--/--/----"
"RTN","LEXQIP",146,0)
 K LEX,LEXT S LEXT(1)=LEXOD D PR^LEXU(.LEXT,(LEXLEN-7))
"RTN","LEXQIP",147,0)
 S LEXI=0 F  S LEXI=$O(LEXT(LEXI)) Q:+LEXI'>0  S LEXT=$G(LEXT(LEXI)) S LEX(LEXI)=LEXT
"RTN","LEXQIP",148,0)
 I $L($G(LEXM)) D
"RTN","LEXQIP",149,0)
 . K LEX,LEXT N LEXC S LEXT(1)=LEXM D PR^LEXU(.LEXT,(LEXLEN-7))
"RTN","LEXQIP",150,0)
 . S LEXI=0 F  S LEXI=$O(LEXT(LEXI)) Q:+LEXI'>0  S LEXT=$G(LEXT(LEXI)) S LEXC=$O(LEX(" "),-1)+1,LEX(LEXC)=LEXT
"RTN","LEXQIP",151,0)
 S:$D(LEX(1)) LEX(0)=LEXODD
"RTN","LEXQIP",152,0)
 Q
"RTN","LEXQIP",153,0)
LDS(X,LEXVDT,LEX,LEXLEN,LEXSTA) ; Operation/Procedure (short description)
"RTN","LEXQIP",154,0)
 ; 
"RTN","LEXQIP",155,0)
 ; LEX=# of Lines
"RTN","LEXQIP",156,0)
 ; LEX(0)=External Date of Operation/Procedure Name
"RTN","LEXQIP",157,0)
 ; LEX(#)=Operation/Procedure Name
"RTN","LEXQIP",158,0)
 ; 
"RTN","LEXQIP",159,0)
 N LEXBRD,LEXBRW,LEXC,LEXD,LEXDDT,LEXE,LEXEE,LEXEFF,LEXFA
"RTN","LEXQIP",160,0)
 N LEXHIS,LEXI,LEXIA,LEXIEN,LEXAIEN,LEXSIEN,LEXL,LEXLA,LEXLAST
"RTN","LEXQIP",161,0)
 N LEXLEF,LEXLHI,LEXLSD,LEXM,LEXOD,LEXODD,LEXR,LEXS,LEXLD,LEXLDD
"RTN","LEXQIP",162,0)
 N LEXSDT,LEXSO,LEXSY,LEXT S LEXIEN=$G(X) Q:+LEXIEN'>0
"RTN","LEXQIP",163,0)
 S LEXVDT=+($G(LEXVDT)) S:LEXVDT'?7N LEXVDT=$$DT^XLFDT
"RTN","LEXQIP",164,0)
 S LEXSTA=+($G(LEXSTA)) S LEXSO=$$CODEC^ICDEX(80.1,+LEXIEN)
"RTN","LEXQIP",165,0)
 S LEXSY=$$CSI^ICDEX(80.1,+LEXIEN)
"RTN","LEXQIP",166,0)
 S LEXLA=$$LA^ICDEX(80.1,+LEXIEN,9999999),LEXFA=$$FA(+LEXIEN)
"RTN","LEXQIP",167,0)
 S LEXLSD=$$LD^ICDEX(80.1,+LEXIEN,LEXLA)
"RTN","LEXQIP",168,0)
 S LEXBRD=$$DTBR^ICDEX(LEXVDT,0,LEXSY),LEXBRW=""
"RTN","LEXQIP",169,0)
 S LEXLD=$$LD^ICDEX(80.1,+LEXIEN,LEXVDT,.LEXS,245)
"RTN","LEXQIP",170,0)
 S LEXLD=$G(LEXS(1)),LEXLDD=$P($G(LEXS(0)),"^",2)
"RTN","LEXQIP",171,0)
 S:'$L(LEXLD) LEXLDD="--/--/----" S LEXM=""
"RTN","LEXQIP",172,0)
 I $P(LEXLD,"^",1)="-1"!('$L(LEXLD)) D
"RTN","LEXQIP",173,0)
 . S LEXM="Operation/Procedure Description is not available."
"RTN","LEXQIP",174,0)
 . I (LEXVDT'?7N!(LEXFA'?7N)),LEXVDT<LEXFA D
"RTN","LEXQIP",175,0)
 . . S LEXM=LEXM_"  The date provided precedes the initial activation of the code"
"RTN","LEXQIP",176,0)
 . I LEXVDT?7N&(LEXFA?7N),LEXVDT<LEXFA D
"RTN","LEXQIP",177,0)
 . . S LEXM=LEXM_"  The date provided ("_$$ED^LEXQM(LEXVDT)_") precedes the initial activation ("_$$ED^LEXQM(LEXFA)_") of the code"
"RTN","LEXQIP",178,0)
 . S:$L(LEXM) LEXM="NOTE:  "_LEXM S LEXOD=LEXLSD,LEXODD="--/--/----"
"RTN","LEXQIP",179,0)
 S LEXAIEN=LEXIEN,LEXSIEN=""
"RTN","LEXQIP",180,0)
 I $L(LEXLD)&($P(LEXLD,"^",1)'="-1") D
"RTN","LEXQIP",181,0)
 . S:LEXLDD?7N LEXSIEN=$O(@("^ICD0("_+LEXIEN_",68,""B"","_+LEXLDD_",0)"))
"RTN","LEXQIP",182,0)
 . S:+LEXSIEN>0 LEXAIEN=LEXAIEN_";"_LEXSIEN
"RTN","LEXQIP",183,0)
 . S LEXM="" S LEXOD=LEXLD S:$D(LEXIIEN) LEXOD=LEXOD_" (IEN "_LEXAIEN_")"
"RTN","LEXQIP",184,0)
 . S LEXODD=$S(LEXLDD?7N:$$ED^LEXQM(LEXLDD),1:"--/--/----")
"RTN","LEXQIP",185,0)
 S:'$L(LEXOD) LEXOD="Operation/Procedure Description not found"
"RTN","LEXQIP",186,0)
 S:'$L(LEXODD) LEXODD="--/--/----"
"RTN","LEXQIP",187,0)
 K LEX,LEXT S LEXT(1)=LEXOD D PR^LEXU(.LEXT,(LEXLEN-7))
"RTN","LEXQIP",188,0)
 S LEXI=0 F  S LEXI=$O(LEXT(LEXI)) Q:+LEXI'>0  S LEXT=$G(LEXT(LEXI)) S LEX(LEXI)=LEXT
"RTN","LEXQIP",189,0)
 I $L($G(LEXM)) D
"RTN","LEXQIP",190,0)
 . K LEX,LEXT N LEXC S LEXT(1)=LEXM D PR^LEXU(.LEXT,(LEXLEN-7))
"RTN","LEXQIP",191,0)
 . S LEXI=0 F  S LEXI=$O(LEXT(LEXI)) Q:+LEXI'>0  S LEXT=$G(LEXT(LEXI)) S LEXC=$O(LEX(" "),-1)+1,LEX(LEXC)=LEXT
"RTN","LEXQIP",192,0)
 S:$D(LEX(1)) LEX(0)=LEXODD
"RTN","LEXQIP",193,0)
 Q
"RTN","LEXQIP",194,0)
 ;
"RTN","LEXQIP",195,0)
WN(X,LEX,LEXLEN) ; Warning
"RTN","LEXQIP",196,0)
 ;            
"RTN","LEXQIP",197,0)
 ; LEX=# of Lines
"RTN","LEXQIP",198,0)
 ; LEX(0)=External Date
"RTN","LEXQIP",199,0)
 ; LEX(#)=Warning
"RTN","LEXQIP",200,0)
 ;            
"RTN","LEXQIP",201,0)
 N LEXVDT,LEXREF,LEXIA,LEXTMP K LEX S LEXVDT=$G(X) Q:LEXVDT'?7N  S LEXLEN=+$G(LEXLEN) S LEXIA=$$IA(LEXVDT,LEXIEN) Q:+LEXIA'>0  S:+LEXLEN>62 LEXLEN=62
"RTN","LEXQIP",202,0)
 S LEXTMP(1)="Warning:  The 'Based on Date' provided precedes Code Set Versioning.  The Operation/Procedure (Short Name) and Description may be inaccurate for "_$$SD^LEXQM(LEXVDT)
"RTN","LEXQIP",203,0)
 D PR^LEXU(.LEXTMP,LEXLEN) K LEX S LEXI=0 F  S LEXI=$O(LEXTMP(LEXI)) Q:+LEXI'>0  S LEX(LEXI)=$G(LEXTMP(LEXI))
"RTN","LEXQIP",204,0)
 S LEX=$O(LEX(" "),-1),LEX(0)=$$SD^LEXQM(LEXVDT)
"RTN","LEXQIP",205,0)
 Q
"RTN","LEXQIP",206,0)
 ; Miscellaneous
"RTN","LEXQIP",207,0)
FA(X) ;   First Activation
"RTN","LEXQIP",208,0)
 N LEXFA,LEXH,LEXI,LEXIEN,LEXSO,LEXSY
"RTN","LEXQIP",209,0)
 S LEXIEN=+($G(X)) S X="",LEXSO=$$CODEC^ICDEX(80.1,+LEXIEN),LEXSY=$$CSI^ICDEX(80.1,+LEXIEN)
"RTN","LEXQIP",210,0)
 K LEXH S X=$$HIST^ICDEX(LEXSO,.LEXH,LEXSY) S LEXFA="",LEXI=0
"RTN","LEXQIP",211,0)
 F  S LEXI=$O(LEXH(LEXI)) Q:+LEXI'>0!($L(LEXFA))  S:+($G(LEXH(LEXI)))>0&(LEXI?7N) LEXFA=LEXI Q:$L(LEXFA)
"RTN","LEXQIP",212,0)
 S X=LEXFA
"RTN","LEXQIP",213,0)
 Q X
"RTN","LEXQIP",214,0)
IA(X,Y) ;   Inaccurate
"RTN","LEXQIP",215,0)
 N LEXBRD,LEXVDT,LEXIEN,LEXSYS S LEXVDT=+($G(X)),LEXIEN=+($G(Y)) Q:+LEXIEN'>0 0
"RTN","LEXQIP",216,0)
 S LEXSYS=$$CSI^ICDEX(80.1,+LEXIEN) Q:+LEXSYS'>0 0  S:'$L(LEXVDT) LEXVDT=$$DT^XLFDT
"RTN","LEXQIP",217,0)
 S:LEXVDT#10000=0 LEXVDT=LEXVDT+101 S:LEXVDT#100=0 LEXVDT=LEXVDT+1
"RTN","LEXQIP",218,0)
 S LEXBRD=$$DTBR^ICDEX(LEXVDT,0,LEXSYS) S X=$S(LEXVDT<LEXBRD:1,1:0)
"RTN","LEXQIP",219,0)
 Q X
"RTN","LEXQIPA")
0^3^B5203203^B4552153
"RTN","LEXQIPA",1,0)
LEXQIPA ;ISL/KER - Query - ICD Procedure - Ask ;10/10/2017
"RTN","LEXQIPA",2,0)
 ;;2.0;LEXICON UTILITY;**62,80,103,114**;Sep 23, 1996;Build 1
"RTN","LEXQIPA",3,0)
 ;               
"RTN","LEXQIPA",4,0)
 ; Global Variables
"RTN","LEXQIPA",5,0)
 ;    None
"RTN","LEXQIPA",6,0)
 ;               
"RTN","LEXQIPA",7,0)
 ; External References
"RTN","LEXQIPA",8,0)
 ;    ^DIC                ICR  10006
"RTN","LEXQIPA",9,0)
 ;    $$CSI^ICDEX         ICR   5747
"RTN","LEXQIPA",10,0)
 ;    $$ICDOP^ICDEX       ICR   5747
"RTN","LEXQIPA",11,0)
 ;    $$ROOT^ICDEX        ICR   5747
"RTN","LEXQIPA",12,0)
 ;    $$DT^XLFDT          ICR  10103
"RTN","LEXQIPA",13,0)
 ;    $$UP^XLFSTR         ICR  10104
"RTN","LEXQIPA",14,0)
 ;               
"RTN","LEXQIPA",15,0)
 ; Local Variables NEWed or KILLed in LEXQIP
"RTN","LEXQIPA",16,0)
 ;     LEXCDT,LEXEXIT
"RTN","LEXQIPA",17,0)
 ;               
"RTN","LEXQIPA",18,0)
 Q
"RTN","LEXQIPA",19,0)
ICP(X)   ; ICD PR Code
"RTN","LEXQIPA",20,0)
 Q:+($G(LEXEXIT))>0 "^^"  N DIC,DICB,DTOUT,DUOUT,LEXDX,LEXSO,LEXDTXT,LEXVTXT,LEXVDT,Y,ICDVDT,ICDSYS,ICDFMT
"RTN","LEXQIPA",21,0)
 S DICB=$G(X),ICDFMT=2 S:$P($G(LEXCDT),"^",2)?7N (LEXVDT,ICDVDT)=$P($G(LEXCDT),"^",2)
"RTN","LEXQIPA",22,0)
 S:'$L($G(LEXVDT))&($P($G(LEXCDT),"^",1)?7N) (LEXVDT,ICDVDT)=$P($G(LEXCDT),"^",1)
"RTN","LEXQIPA",23,0)
 S DIC(0)="AEQMZ",DIC=$$ROOT^ICDEX(80.1) S:$D(LEXQUIET) DIC(0)="MZ" I $L(DIC) D
"RTN","LEXQIPA",24,0)
 . N ICDVDT,VDT S VDT=$O(^LEX(757.02,"AUPD","10P"," "),-1)
"RTN","LEXQIPA",25,0)
 . S:VDT?7N VDT=$$FMADD^XLFDT(VDT,740) S:VDT?7N ICDVDT=VDT
"RTN","LEXQIPA",26,0)
 . S DIC("A")=" Select an ICD Procedure code:  " S:$L($G(DICB)) DIC("B")=$G(DICB) W ! D ^DIC
"RTN","LEXQIPA",27,0)
 S X=$G(X),Y=$G(Y) S:$G(X)["^^"!($D(DTOUT)) LEXEXIT=1 Q:$G(X)["^^"!(+($G(LEXEXIT))>0) "^^"
"RTN","LEXQIPA",28,0)
 Q:$G(X)="^" "^"  Q:$G(X)["^^" "^^"  Q:$D(DTOUT)!($D(DUOUT)) "^"  S LEXSO=$P($G(Y),"^",2) S X="" I +Y>0,$L(LEXSO) D
"RTN","LEXQIPA",29,0)
 . N LEXSYS S LEXSYS=$$CSI^ICDEX(80.1,+Y),LEXVDT=$G(LEXCDT) S:LEXVDT'?7N LEXVDT=$$DT^XLFDT S X=Y,LEXDTXT=$P($G(Y(0)),"^",2)
"RTN","LEXQIPA",30,0)
 . S LEXDX=$$ICDOP^ICDEX(LEXSO,LEXVDT,LEXSYS,"E") S:$L($G(LEXDTXT)) LEXDTXT=LEXDTXT_" (Text not Versioned)"
"RTN","LEXQIPA",31,0)
 . S LEXVTXT=$P(LEXDX,"^",5) S:'$L(LEXVTXT) LEXVTXT=LEXDTXT
"RTN","LEXQIPA",32,0)
 . S X=+Y_"^"_LEXSO S:$L(LEXVTXT) X=X_"^"_LEXVTXT
"RTN","LEXQIPA",33,0)
 S X=$$UP^XLFSTR(X) Q:'$L(X) "^"
"RTN","LEXQIPA",34,0)
 Q X
"RTN","LEXXMC")
0^1^B208378117^B200466634
"RTN","LEXXMC",1,0)
LEXXMC ;ISL/KER - Convert Text to Mix Case ;10/10/2017
"RTN","LEXXMC",2,0)
 ;;2.0;Lexicon Utility;**103,114**;Sep 23, 1996;Build 1
"RTN","LEXXMC",3,0)
 ;               
"RTN","LEXXMC",4,0)
 ; Global Variables
"RTN","LEXXMC",5,0)
 ;    ^LEX(757.07          SACC 1.3
"RTN","LEXXMC",6,0)
 ;               
"RTN","LEXXMC",7,0)
 ; External References
"RTN","LEXXMC",8,0)
 ;    None
"RTN","LEXXMC",9,0)
 ;               
"RTN","LEXXMC",10,0)
 ; Replaces Integrated Control Registration #5781 $$MIX^LEXXM(X)
"RTN","LEXXMC",11,0)
 ; (released in LEX*2.0*80, Jun 17, 2014) which converts UPPERCASE
"RTN","LEXXMC",12,0)
 ; to Mix Case Text.
"RTN","LEXXMC",13,0)
 ; 
"RTN","LEXXMC",14,0)
 ; Old API                    New API
"RTN","LEXXMC",15,0)
 ; $$MIX^LEXXM(X)             $$MIX^LEXXMC(X)
"RTN","LEXXMC",16,0)
 ; Hard Coded Rules           Database of Rules
"RTN","LEXXMC",17,0)
 ; Extremely hard to update   Update in Quarterly patch
"RTN","LEXXMC",18,0)
 ; Rules in LEXXM*            Rules in ^LEX(757.07)
"RTN","LEXXMC",19,0)
 ; 
"RTN","LEXXMC",20,0)
 ; The old API $$MIX^LEXXM will be re-directed to $$MIX^LEXXMC
"RTN","LEXXMC",21,0)
 ;
"RTN","LEXXMC",22,0)
MIX(TEXT) ; Mixed Case Expression
"RTN","LEXXMC",23,0)
 ;
"RTN","LEXXMC",24,0)
 ;   Input
"RTN","LEXXMC",25,0)
 ;
"RTN","LEXXMC",26,0)
 ;     TEXT     Text, any case (Required)
"RTN","LEXXMC",27,0)
 ;
"RTN","LEXXMC",28,0)
 ;   Output
"RTN","LEXXMC",29,0)
 ;
"RTN","LEXXMC",30,0)
 ;     $$MIX    Text, Mixed Case
"RTN","LEXXMC",31,0)
 ;               
"RTN","LEXXMC",32,0)
 N AAA,ABR,AFTER,AR,ARRAY,ARY,ASC,BEFORE,C,CAS,CC,CCTR,CH,CHR,COND,CT,CTL,CUR,DIFF,EXEC,EXP,FULL,HA,HN,I,L,LD,LEX,LEX2
"RTN","LEXXMC",33,0)
 N LEXR1,LEXR2,LEXT,LEXW,ND,NPT,NXT,OIEN,ORG,OUT,P1,P2,PC,PPT,PRE,PS,PSN,REP,RP,RUL,RULE,S,SPC,ST,TA,TC,TEST,TIEN,TK
"RTN","LEXXMC",34,0)
 N TKN,TOKEN,TR,TRUE,TXT,UEX,WI,WIT,WT,X,Y K:$D(TOKEN) RULE,FULL Q:'$L($G(TEXT)) ""
"RTN","LEXXMC",35,0)
 S TEXT=$$DBLS($TR($G(TEXT),"""","'")),TEXT=$$CTL($G(TEXT)),TEXT=$$SPELL(TEXT),(ORG,EXP)=$$IEEG($G(TEXT))
"RTN","LEXXMC",36,0)
 I '$L($G(EXP)) S TEXT=ORG Q $TR(TEXT,"""","'")
"RTN","LEXXMC",37,0)
 ;  Save Before Expression
"RTN","LEXXMC",38,0)
 S BEFORE=ORG,UEX=$$UP(ORG)
"RTN","LEXXMC",39,0)
 ;  Parse
"RTN","LEXXMC",40,0)
 K TA D PR(EXP,.TA)
"RTN","LEXXMC",41,0)
 ;  Loop through Words
"RTN","LEXXMC",42,0)
 S TC=0 F  S TC=$O(TA(TC)) Q:+TC'>0  D
"RTN","LEXXMC",43,0)
 . N CUR,CTL,PRE,NXT,PPT,NPT,TIEN,TRUE S TRUE=0
"RTN","LEXXMC",44,0)
 . ;     Current Word
"RTN","LEXXMC",45,0)
 . S CUR=$G(TA(TC)),CTL=$$UP(CUR) Q:'$L(CTL)
"RTN","LEXXMC",46,0)
 . ;     Previous Word
"RTN","LEXXMC",47,0)
 . S PRE=$G(TA((TC-1)))
"RTN","LEXXMC",48,0)
 . ;     Next Word
"RTN","LEXXMC",49,0)
 . S NXT=$G(TA((TC+1)))
"RTN","LEXXMC",50,0)
 . ;     Previous Punctuation
"RTN","LEXXMC",51,0)
 . S PPT=$O(TA((TC-1),"B"," "),-1)
"RTN","LEXXMC",52,0)
 . S PPT=$S(+PPT>0:$G(TA((TC-1),"B",+PPT)),1:"")
"RTN","LEXXMC",53,0)
 . ;     Special condition for the letter S and ' or (
"RTN","LEXXMC",54,0)
 . S:CTL="S" PPT=$G(TA((TC-1),"B",1))
"RTN","LEXXMC",55,0)
 . ;     Next Punctuation
"RTN","LEXXMC",56,0)
 . S NPT=$G(TA(TC,"B",1))
"RTN","LEXXMC",57,0)
 . ;     Token IEN
"RTN","LEXXMC",58,0)
 . S TIEN=$O(^LEX(757.07,"B",CTL,0))
"RTN","LEXXMC",59,0)
 . ;     Token not found, use mask/mix case
"RTN","LEXXMC",60,0)
 . I '$D(^LEX(757.07,"B",CTL))!(TIEN'>0) D  Q
"RTN","LEXXMC",61,0)
 . . D TOK S:+($G(TRUE))>0&($L($G(OUT))) TA(TC)=OUT S:+($G(TRUE))'>0 TA(TC)=$$MX(CUR)
"RTN","LEXXMC",62,0)
 . D DSP1
"RTN","LEXXMC",63,0)
 . I +($G(TRUE))'>0,+($G(TIEN))>0 D
"RTN","LEXXMC",64,0)
 . . ;     Loop through Rules
"RTN","LEXXMC",65,0)
 . . N AAA,OIEN,OUT S OUT=CUR
"RTN","LEXXMC",66,0)
 . . S (OIEN,TRUE)=0 F  S OIEN=$O(^LEX(757.07,TIEN,1,OIEN)) Q:OIEN'>0  Q:TRUE>0  D  Q:TRUE>0
"RTN","LEXXMC",67,0)
 . . . Q:+($G(TRUE))>0  N COND,CCTR,CAS,SPC S CCTR=0
"RTN","LEXXMC",68,0)
 . . . S CAS=$P($G(^LEX(757.07,+TIEN,1,+OIEN,0)),"^",2)
"RTN","LEXXMC",69,0)
 . . . S SPC=$P($G(^LEX(757.07,+TIEN,1,+OIEN,0)),"^",3)
"RTN","LEXXMC",70,0)
 . . . S:$G(CAS)="S" TA(TC,"S")=""
"RTN","LEXXMC",71,0)
 . . . ;       1st Condition - Based on Expression
"RTN","LEXXMC",72,0)
 . . . D EXP Q:+($G(TRUE))>0
"RTN","LEXXMC",73,0)
 . . . ;       2nd Condition - Based on Previous Word
"RTN","LEXXMC",74,0)
 . . . D PRE Q:+($G(TRUE))>0
"RTN","LEXXMC",75,0)
 . . . ;       3rd Condition - Based on Next Word
"RTN","LEXXMC",76,0)
 . . . D NXT Q:+($G(TRUE))>0
"RTN","LEXXMC",77,0)
 . . . ;       No Conditions
"RTN","LEXXMC",78,0)
 . . . D NON Q:+($G(TRUE))>0
"RTN","LEXXMC",79,0)
 . . . ;       Token
"RTN","LEXXMC",80,0)
 . . . D TOK Q:+($G(TRUE))>0
"RTN","LEXXMC",81,0)
 . . ;     Default Mix Case
"RTN","LEXXMC",82,0)
 . . S:TRUE'>0&(OUT=CUR) OUT=$$MX(CUR)
"RTN","LEXXMC",83,0)
 . . D DSP4("END")
"RTN","LEXXMC",84,0)
 . . S TA(TC)=OUT
"RTN","LEXXMC",85,0)
 ;  Special Conditions - Pre-Assmebly
"RTN","LEXXMC",86,0)
 D PREA
"RTN","LEXXMC",87,0)
 ;  Assemble After Expression
"RTN","LEXXMC",88,0)
 D ASEM,DSP2
"RTN","LEXXMC",89,0)
 S TEXT=$G(AFTER) S:'$L(TEXT) TEXT=ORG S TEXT=$$PS(TEXT)
"RTN","LEXXMC",90,0)
 Q $TR(TEXT,"""","'")
"RTN","LEXXMC",91,0)
 ;
"RTN","LEXXMC",92,0)
EXP ; Expression Rules
"RTN","LEXXMC",93,0)
 ;   
"RTN","LEXXMC",94,0)
 ;   Example:   If an expression contains the words "OPERATING
"RTN","LEXXMC",95,0)
 ;              ROOM" then the word "OR" will be in uppercase.
"RTN","LEXXMC",96,0)
 Q:'$L($G(CUR))  Q:'$L($G(CAS))  Q:'$L($G(SPC))  Q:+($G(TIEN))'>0  Q:+($G(OIEN))'>0  Q:'$L($G(EXP))
"RTN","LEXXMC",97,0)
 N COND S COND=$G(^LEX(757.07,+($G(TIEN)),1,+($G(OIEN)),1)) S:$L(COND) CCTR=+($G(CCTR))+1
"RTN","LEXXMC",98,0)
 I $L($G(EXP)),$L(COND) D  Q:+($G(TRUE))>0
"RTN","LEXXMC",99,0)
 . N EXEC,X S X=$$UP($G(EXP)) X COND S TRUE=$T
"RTN","LEXXMC",100,0)
 . I +($G(TRUE))>0 S OUT=$$CAS($G(CUR),$G(CAS),$G(SPC))
"RTN","LEXXMC",101,0)
 . D DSP3("EXP")
"RTN","LEXXMC",102,0)
 Q
"RTN","LEXXMC",103,0)
 ;
"RTN","LEXXMC",104,0)
PRE ; Previous Word Rules
"RTN","LEXXMC",105,0)
 ;   
"RTN","LEXXMC",106,0)
 ;   Example:   If the previous word is numeric or "PER" 
"RTN","LEXXMC",107,0)
 ;              then the word "OZ" will be in lower case.
"RTN","LEXXMC",108,0)
 Q:'$L($G(CUR))  Q:'$L($G(CAS))  Q:'$L($G(SPC))  Q:+($G(TIEN))'>0  Q:+($G(OIEN))'>0  Q:'$L(($G(PRE)_$G(PPT)))
"RTN","LEXXMC",109,0)
 N COND S COND=$G(^LEX(757.07,+($G(TIEN)),1,+($G(OIEN)),2)) S:$L(COND) CCTR=+($G(CCTR))+1
"RTN","LEXXMC",110,0)
 I $L($G(PRE)),$L(COND) D  Q:TRUE>0
"RTN","LEXXMC",111,0)
 . N EXEC,X S X=$$UP($G(PRE)) X COND S TRUE=$T
"RTN","LEXXMC",112,0)
 . I +($G(TRUE))>0 S OUT=$$CAS($G(CUR),$G(CAS),$G(SPC))
"RTN","LEXXMC",113,0)
 . D DSP3("PRE")
"RTN","LEXXMC",114,0)
 I $L($G(PPT)),$L(COND) D  Q:TRUE>0
"RTN","LEXXMC",115,0)
 . N EXEC,X S X=$G(PPT) X COND S TRUE=$T
"RTN","LEXXMC",116,0)
 . I +($G(TRUE))>0 S OUT=$$CAS($G(CUR),$G(CAS),$G(SPC))
"RTN","LEXXMC",117,0)
 . D DSP3("PPT")
"RTN","LEXXMC",118,0)
 Q
"RTN","LEXXMC",119,0)
 ;
"RTN","LEXXMC",120,0)
NXT ; Next Word Rules
"RTN","LEXXMC",121,0)
 ;
"RTN","LEXXMC",122,0)
 ;   Example:   If the next word contains "POSITIVE" or
"RTN","LEXXMC",123,0)
 ;              "NEGATIVE" then the word "ABL" will be 
"RTN","LEXXMC",124,0)
 ;              in uppercase.
"RTN","LEXXMC",125,0)
 Q:'$L($G(CUR))  Q:'$L($G(CAS))  Q:'$L($G(SPC))  Q:+($G(TIEN))'>0  Q:+($G(OIEN))'>0
"RTN","LEXXMC",126,0)
 N COND S COND=$G(^LEX(757.07,+($G(TIEN)),1,+($G(OIEN)),3)) S:$L(COND) CCTR=+($G(CCTR))+1
"RTN","LEXXMC",127,0)
 Q:'$L(($G(NXT)_$G(NPT)))  I $L($G(NXT)),$L(COND) D  Q:TRUE>0
"RTN","LEXXMC",128,0)
 . N EXEC,X S X=$$UP($G(NXT)) X COND S TRUE=$T
"RTN","LEXXMC",129,0)
 . I +($G(TRUE))>0 S OUT=$$CAS($G(CUR),$G(CAS),$G(SPC))
"RTN","LEXXMC",130,0)
 . D DSP3("NXT")
"RTN","LEXXMC",131,0)
 I $L($G(NPT)),$L(COND) D  Q:TRUE>0
"RTN","LEXXMC",132,0)
 . N EXEC,X S X=$G(NPT) X COND S TRUE=$T
"RTN","LEXXMC",133,0)
 . I +($G(TRUE))>0 S OUT=$$CAS($G(CUR),$G(CAS),$G(SPC))
"RTN","LEXXMC",134,0)
 . D DSP3("NPT")
"RTN","LEXXMC",135,0)
 Q
"RTN","LEXXMC",136,0)
 ;
"RTN","LEXXMC",137,0)
NON ; No Rules (default)
"RTN","LEXXMC",138,0)
 ;
"RTN","LEXXMC",139,0)
 ;   Example:   If the rules for the expression, the previous
"RTN","LEXXMC",140,0)
 ;              word and the next word fail (false) and there
"RTN","LEXXMC",141,0)
 ;              is a default case value then that case will 
"RTN","LEXXMC",142,0)
 ;              be used.
"RTN","LEXXMC",143,0)
 ;             
"RTN","LEXXMC",144,0)
 ;                U   UPPERCASE      COPD
"RTN","LEXXMC",145,0)
 ;                L   lower case     between
"RTN","LEXXMC",146,0)
 ;                M   Mixed Case     Diabetes
"RTN","LEXXMC",147,0)
 ;                S   Special Case   IgE
"RTN","LEXXMC",148,0)
 Q:+($G(TRUE))>0  Q:+($G(CCTR))>0  Q:'$L($G(CUR))  Q:'$L($G(CAS))  Q:'$L($G(SPC))
"RTN","LEXXMC",149,0)
 N EXEC S OUT=$$CAS($G(CUR),$G(CAS),$G(SPC))
"RTN","LEXXMC",150,0)
 S TRUE=1 D DSP3("NON")
"RTN","LEXXMC",151,0)
 Q
"RTN","LEXXMC",152,0)
 ;
"RTN","LEXXMC",153,0)
TOK ; Token/Word Rules
"RTN","LEXXMC",154,0)
 ;
"RTN","LEXXMC",155,0)
 ;   Examples:  If a word is an ordinal number (1st, 2nd, etc.)
"RTN","LEXXMC",156,0)
 ;              then the word will be in lower case.
"RTN","LEXXMC",157,0)
 ;             
"RTN","LEXXMC",158,0)
 ;              If a word is alpha numeric then the word will
"RTN","LEXXMC",159,0)
 ;              be in upper case.
"RTN","LEXXMC",160,0)
 ;             
"RTN","LEXXMC",161,0)
 ;              If a word is preceded or followed by a dash "-"
"RTN","LEXXMC",162,0)
 ;              then the word will be upper case.
"RTN","LEXXMC",163,0)
 Q:+($G(TRUE))>0  Q:'$L($G(CUR))
"RTN","LEXXMC",164,0)
 N AAA,CAS,COND,OIEN,SPC,TIEN,HA,HN,CH S (HA,HN)=0,AAA=$$RP("*",$L(CUR)) Q:AAA'["*"
"RTN","LEXXMC",165,0)
 F CH=1:1:$L(CUR) S:$E(CUR,CH)?1A HA=1 S:$E(CUR,CH)?1N HN=1
"RTN","LEXXMC",166,0)
 S TIEN=$O(^LEX(757.07,"B",AAA,0)) I TIEN'>0,HA>0,HN>0 S OUT=$$UP(CUR),TRUE=1 Q
"RTN","LEXXMC",167,0)
 Q:TIEN'>0  S (TRUE,OIEN)=0
"RTN","LEXXMC",168,0)
 F  S OIEN=$O(^LEX(757.07,TIEN,1,OIEN)) Q:+OIEN'>0  Q:TRUE>0  D  Q:TRUE>0
"RTN","LEXXMC",169,0)
 . N COND,CAS,EXEC,SPC S CAS=$P($G(^LEX(757.07,+TIEN,1,+OIEN,0)),"^",2),SPC=$P($G(^LEX(757.07,+TIEN,1,+OIEN,0)),"^",3)
"RTN","LEXXMC",170,0)
 . S COND=$G(^LEX(757.07,+TIEN,1,+OIEN,1)),X=$$UP(CUR)
"RTN","LEXXMC",171,0)
 . I $L(COND) X COND S TRUE=$T
"RTN","LEXXMC",172,0)
 . I TRUE>0 S OUT=$$CAS(CUR,CAS,SPC)
"RTN","LEXXMC",173,0)
 . D DSP3("TOK")
"RTN","LEXXMC",174,0)
 Q
"RTN","LEXXMC",175,0)
 ; Displays used for testing Case Rules
"RTN","LEXXMC",176,0)
DSP1 ;   Display Components
"RTN","LEXXMC",177,0)
 Q:'$D(TEST)  Q:$D(TOKEN)  Q:$D(ARRAY)  Q:'$D(FULL)
"RTN","LEXXMC",178,0)
 W !!,"CUR:  ",$G(CUR),!,"PRE:  ",$G(PRE),!,"NXT:  ",$G(NXT),!,"PPT:  ",$G(PPT),!,"NPT:  ",$G(NPT) N FULL,DIFF,ARRAY
"RTN","LEXXMC",179,0)
 Q
"RTN","LEXXMC",180,0)
DSP2 ;   Display Changes (Differences)
"RTN","LEXXMC",181,0)
 Q:'$D(TEST)  N EXEC I $D(FULL),$D(ARRAY) D
"RTN","LEXXMC",182,0)
 . N AR S AR="TA(0)" F  S AR=$Q(@AR) Q:'$L(AR)!($E(AR,1,2)'="TA")  W AR,"=",@AR,!
"RTN","LEXXMC",183,0)
 I '$D(DIFF),'$D(ARRAY) W !!,"Before:  ",BEFORE,!,"After:   ",AFTER
"RTN","LEXXMC",184,0)
 I $D(DIFF),'$D(ARRAY),BEFORE'=AFTER W !!,"Before:  ",BEFORE,!,"After:   ",AFTER
"RTN","LEXXMC",185,0)
 W:$D(ARRAY) !,AFTER N ARRAY,DIFF,FULL,TEST
"RTN","LEXXMC",186,0)
 Q
"RTN","LEXXMC",187,0)
DSP3(X) ;   Display Conditions #1
"RTN","LEXXMC",188,0)
 Q:'$D(TEST)  Q:'$D(RULE)  Q:$D(TOKEN)
"RTN","LEXXMC",189,0)
 W !!,"X:     ",$G(X),!,"CUR:   ",$G(CUR),!,"CAS:   ",$G(CAS),!,"SPC:   ",$G(SPC),!,"TRUE:  ",$G(PPT),!,"OUT:   ",$G(OUT),!
"RTN","LEXXMC",190,0)
 N TEST,RULE,TOKEN
"RTN","LEXXMC",191,0)
 Q
"RTN","LEXXMC",192,0)
DSP4(X) ;   Display Conditions #2
"RTN","LEXXMC",193,0)
 Q:'$D(TEST)  Q:'$D(RULE)  Q:$D(TOKEN)  W !!,"X:     ",$G(X),!,"TRUE:  ",$G(PPT),!,"OUT:   ",$G(OUT),!
"RTN","LEXXMC",194,0)
 N TEST,RULE,TOKEN
"RTN","LEXXMC",195,0)
 Q
"RTN","LEXXMC",196,0)
 ; 
"RTN","LEXXMC",197,0)
 ; Spelling
"RTN","LEXXMC",198,0)
SPELL(X) ;   Known Spelling Errors
"RTN","LEXXMC",199,0)
 F Y="Pe-ripheral^Peripheral","us-ing^using","Intralu-minal^Intraluminal","Ap-proach^Approach","Endo-scopic^Endoscopic" S:$$SP(X,Y)>0 X=$$SW(X,Y)
"RTN","LEXXMC",200,0)
 F Y="Technolo-gy^Technology","CR (E)St^CREST","CR(E)St^CREST" S:$$SP(X,Y)>0 X=$$SW(X,Y)
"RTN","LEXXMC",201,0)
 Q X
"RTN","LEXXMC",202,0)
SP(X,Y) ;   Contains Spelling Error
"RTN","LEXXMC",203,0)
 Q:'$L($G(X)) 0  S Y=$P($G(Y),"^",1) Q:'$L($G(Y)) 0
"RTN","LEXXMC",204,0)
 Q:$$UP^XLFSTR(X)[$$UP^XLFSTR(Y) 1
"RTN","LEXXMC",205,0)
 Q 0
"RTN","LEXXMC",206,0)
SW(X,Y) ;   Swap Spelling
"RTN","LEXXMC",207,0)
 N TXT,RP,WT S TXT=$G(X),RP=$G(Y),WT=$P(RP,"^",2),RP=$P(RP,"^",1) S X=TXT Q:'$L(RP) X  Q:'$L(WT) X
"RTN","LEXXMC",208,0)
 S RP=$$UP^XLFSTR($E(RP,1))_$$LOW^XLFSTR($E(RP,2,$L(RP))) S WT=$$UP^XLFSTR($E(WT,1))_$$LOW^XLFSTR($E(WT,2,$L(WT)))
"RTN","LEXXMC",209,0)
 F  Q:TXT'[RP  S TXT=$P(TXT,RP,1)_WT_$P(TXT,RP,2,4000)
"RTN","LEXXMC",210,0)
 S RP=$$UP^XLFSTR(RP),WT=$$UP^XLFSTR(WT) F  Q:TXT'[RP  S TXT=$P(TXT,RP,1)_WT_$P(TXT,RP,2,4000)
"RTN","LEXXMC",211,0)
 S RP=$$LOW^XLFSTR(RP),WT=$$LOW^XLFSTR(WT) F  Q:TXT'[RP  S TXT=$P(TXT,RP,1)_WT_$P(TXT,RP,2,4000)
"RTN","LEXXMC",212,0)
 S X=TXT
"RTN","LEXXMC",213,0)
 Q X
"RTN","LEXXMC",214,0)
 ; 
"RTN","LEXXMC",215,0)
 ; Assembly
"RTN","LEXXMC",216,0)
PREA ;   Pre-assembly
"RTN","LEXXMC",217,0)
 N Y,TC S TC=0 F  S TC=$O(TA(TC)) Q:+TC'>0  D
"RTN","LEXXMC",218,0)
 . I $$UP($G(TA(TC)))="PRE" S:$G(TA(TC,"B",1))="-"&($E($G(TA((TC+1))),1)?1U) TA(TC)=$$MX($G(TA(TC)))
"RTN","LEXXMC",219,0)
 Q:'$L($G(UEX))  F Y="ACTINIUM^Actinium","ALUMINUM^Aluminum","ANTIMONY^Antimony","ARSENIC^Arsenic","BARIUM^Barium","BERYLLIUM^Beryllium","BISMUTH^Bismuth" D:UEX[$P(Y,"^",1) PRES(Y)
"RTN","LEXXMC",220,0)
 F Y="BROMINE^Bromine","BUDESONIDE^Budesonide","CADMIUM^Cadmium","CALCIUM^Calcium","CARBON^Carbon","CESIUM^Cesium","CHLORINE^Chlorine" D:UEX[$P(Y,"^",1) PRES(Y)
"RTN","LEXXMC",221,0)
 F Y="CHROMIUM^Chromium","COBALT^Cobalt","COPPER^Copper","GALLIUM^Gallium","GERMANIUM^Germanium","HAFNIUM^Hafnium","INDIUM^Indium" D:UEX[$P(Y,"^",1) PRES(Y)
"RTN","LEXXMC",222,0)
 F Y="IODINE^Iodine","IRIDIUM^Iridium","KRYPTON^Krypton","LEAD^Lead","LUTETIUM^Lutetium","MANGANESE^Manganese","MERCURY^Mercury","NICKEL^Nickel" D:UEX[$P(Y,"^",1) PRES(Y)
"RTN","LEXXMC",223,0)
 F Y="OSMIUM^Osmium","OXYGEN^Oxygen","PLATINUM^Platinum","POTASSIUM^Potassium","RADON^Radon","RHODIUM^Rhodium","RUBIDIUM^Rubidium","RUTHENIUM^Ruthenium" D:UEX[$P(Y,"^",1) PRES(Y)
"RTN","LEXXMC",224,0)
 F Y="SELENIUM^Selenium","SILICON^Silicon","SILVER^Silver","SODIUM^Sodium","STRONTIUM^Strontium","SULFUR^Sulfur","TANTALUM^Tantalum","THALLIUM^Thallium" D:UEX[$P(Y,"^",1) PRES(Y)
"RTN","LEXXMC",225,0)
 F Y="THORIUM^Thorium","TITANIUM^Titanium","TUNGSTEN^Tungsten","URANIUM^Uranium","VANADIUM^Vanadium","XENON^Xenon","YTTRIUM^Yttrium","ZIRCONIUM^Zirconium" D:UEX[$P(Y,"^",1) PRES(Y)
"RTN","LEXXMC",226,0)
 Q
"RTN","LEXXMC",227,0)
PRES(X) ;   Pre-assembly Swap text
"RTN","LEXXMC",228,0)
 N RP,WI,TC S RP=$P($G(X),"^",1),WI=$P($G(X),"^",2) Q:'$L(RP)  S TC=0 F  S TC=$O(TA(TC)) Q:+TC'>0  D
"RTN","LEXXMC",229,0)
 . N X S X=$G(TA(TC)) Q:X'[RP  Q:$L(X)'>3  F  Q:X'[RP  S X=$P(X,RP,1)_WI_$P(X,RP,2,4000)
"RTN","LEXXMC",230,0)
 . S TA(TC)=X
"RTN","LEXXMC",231,0)
 Q
"RTN","LEXXMC",232,0)
ASEM ;   Final Assembly
"RTN","LEXXMC",233,0)
 S AFTER="" S TC=0 F  S TC=$O(TA(TC)) Q:+TC'>0  D
"RTN","LEXXMC",234,0)
 . S AFTER=AFTER_$G(TA(TC))
"RTN","LEXXMC",235,0)
 . N CC S CC=0 F  S CC=$O(TA(TC,"B",CC)) Q:+CC'>0  D
"RTN","LEXXMC",236,0)
 . . S AFTER=AFTER_$G(TA(TC,"B",CC))
"RTN","LEXXMC",237,0)
 S:'$D(TA(1,"S")) AFTER=$$UP($E(AFTER,1))_$E(AFTER,2,$L(AFTER))
"RTN","LEXXMC",238,0)
 F Y="CR (E)St^CR(E)ST","CR (E)ST^CREST","CR(E)ST^CREST","  ^ ","Vertebra (E)^Vertebra(e)" I AFTER[$P(Y,"^",1) D
"RTN","LEXXMC",239,0)
 . N RP,WI S RP=$P($G(Y),"^",1),WI=$P($G(Y),"^",2) Q:'$L(RP)
"RTN","LEXXMC",240,0)
 . F  Q:AFTER'[RP  S AFTER=$P(AFTER,RP,1)_WI_$P(AFTER,RP,2,4000)
"RTN","LEXXMC",241,0)
 I $E(AFTER,$L(AFTER))="a",$E(AFTER,($L(AFTER)-1))=" " D
"RTN","LEXXMC",242,0)
 . S AFTER=$E(AFTER,1,($L(AFTER)-2))_" A"
"RTN","LEXXMC",243,0)
 Q
"RTN","LEXXMC",244,0)
 ;
"RTN","LEXXMC",245,0)
 ; Miscellaneous
"RTN","LEXXMC",246,0)
IEEG(X) ;   I.E. and E.G.
"RTN","LEXXMC",247,0)
 S X=$G(X) N TK F TK="IE^ie","I.E.^ie","I.E^ie","I.e.^ie","I.e^ie","i.e.^ie","i.e^ie","E.G.^eg","E.G^eg","E.g.^eg","E.g^eg","e.g.^eg","e.g^eg" D
"RTN","LEXXMC",248,0)
 . N RP,WI S RP=$P(TK,"^",1),WI=$P(TK,"^",2) F  Q:X'[RP  S X=$P(X,RP,1)_WI_$P(X,RP,2,4000)
"RTN","LEXXMC",249,0)
 Q X
"RTN","LEXXMC",250,0)
AABR(X) ;   Abbreviation
"RTN","LEXXMC",251,0)
 N TIEN,OIEN,ABR,TKN S TIEN=+($G(X)),ABR="",OIEN=0
"RTN","LEXXMC",252,0)
 S TKN=$P($G(^LEX(757.07,+TIEN,0)),"^",1) Q:$E(TKN,1)="*" 0  Q:$E(TKN,1)?1N 0  Q:$L(TKN)'>1 0
"RTN","LEXXMC",253,0)
 F  S OIEN=$O(^LEX(757.07,+TIEN,1,OIEN)) Q:+OIEN'>0  D
"RTN","LEXXMC",254,0)
 . N ND,CAS,RUL S ND=$G(^LEX(757.07,+TIEN,1,+OIEN,0)),CAS=$P(ND,"^",2) Q:CAS="L"
"RTN","LEXXMC",255,0)
 . S RUL=$G(^LEX(757.07,+TIEN,1,+OIEN,1)) Q:$L(RUL)
"RTN","LEXXMC",256,0)
 . S RUL=$G(^LEX(757.07,+TIEN,1,+OIEN,2)) Q:$L(RUL)
"RTN","LEXXMC",257,0)
 . S RUL=$G(^LEX(757.07,+TIEN,1,+OIEN,3)) Q:$L(RUL)
"RTN","LEXXMC",258,0)
 . S ABR=ABR_CAS
"RTN","LEXXMC",259,0)
 S X=0 S:ABR["U"!(ABR["S") X=1
"RTN","LEXXMC",260,0)
 Q X
"RTN","LEXXMC",261,0)
PR(X,ARY) ;   Parse Expression into Tokens
"RTN","LEXXMC",262,0)
 N CTL,EXP,CUR,PRE,TC,CT,OUT,P1,ST,P2,PC S EXP=$G(X) K ARY
"RTN","LEXXMC",263,0)
 S CTL="^ ^!^@^#^$^%^^^&^*^(^)^_^+^-^=^{^}^|^[^]^\^:^""^;^'^<^>^?^,^.^/^"
"RTN","LEXXMC",264,0)
 S (CUR,PRE)="",TC=1,CT=0,(OUT,P1,ST,P2)="" F PC=1:1:$L(EXP) D
"RTN","LEXXMC",265,0)
 . N CHR S (CUR,CHR)=$E(EXP,PC)
"RTN","LEXXMC",266,0)
 . I CTL'[("^"_CHR_"^") D  Q
"RTN","LEXXMC",267,0)
 . . S ARY(+TC)=$G(ARY(+TC))_CHR S PRE=CUR
"RTN","LEXXMC",268,0)
 . I CTL[("^"_CHR_"^") D  Q
"RTN","LEXXMC",269,0)
 . . N CC,NXT S CC=$O(ARY(+TC,"B"," "),-1)+1
"RTN","LEXXMC",270,0)
 . . S ARY(+TC,"B",CC)=CHR
"RTN","LEXXMC",271,0)
 . . S NXT=$E(EXP,(PC+1))
"RTN","LEXXMC",272,0)
 . . I $L(NXT),CTL'[("^"_NXT_"^") S TC=TC+1
"RTN","LEXXMC",273,0)
 . . S PRE=CUR
"RTN","LEXXMC",274,0)
 S TC=0 F  S TC=$O(ARY(TC)) Q:+TC'>0  D
"RTN","LEXXMC",275,0)
 . N TKN S TKN=$G(ARY(TC)) S:$L(TKN) ARY(TC,"O")=TKN
"RTN","LEXXMC",276,0)
 Q
"RTN","LEXXMC",277,0)
 ;
"RTN","LEXXMC",278,0)
CAS(X,Y,S) ;   Case
"RTN","LEXXMC",279,0)
 S X=$G(X),Y=$G(Y),S=$G(S)
"RTN","LEXXMC",280,0)
 S:Y="L" X=$$LO(X) S:Y="U" X=$$UP(X) S:Y="M" X=$$MX(X) S:Y="S" X=S
"RTN","LEXXMC",281,0)
 Q X
"RTN","LEXXMC",282,0)
MX(X) ;   Mix Case
"RTN","LEXXMC",283,0)
 Q $$UP($E($G(X),1))_$$LO($E($G(X),2,$L($G(X))))
"RTN","LEXXMC",284,0)
PS(X) ;   Period Space
"RTN","LEXXMC",285,0)
 S X=$G(X) Q:$D(A5ALEX) X I X[". " F I=1:1:($L(X,". ")-1) D
"RTN","LEXXMC",286,0)
 . N LD,TR,PS S PS=". ",LD=$P(X,PS,1,I),TR=$$TM($P(X,PS,(I+1),$L(X)))
"RTN","LEXXMC",287,0)
 . S X=LD_". "_$$UP($E($G(TR),1))_$E($G(TR),2,$L($G(TR)))
"RTN","LEXXMC",288,0)
 N A5ALEX
"RTN","LEXXMC",289,0)
 Q X
"RTN","LEXXMC",290,0)
UP(X) ;   Uppercase
"RTN","LEXXMC",291,0)
 Q $TR(X,"abcdefghijklmnopqrstuvwxyz","ABCDEFGHIJKLMNOPQRSTUVWXYZ")
"RTN","LEXXMC",292,0)
LO(X) ;   Lower Case
"RTN","LEXXMC",293,0)
 Q $TR(X,"ABCDEFGHIJKLMNOPQRSTUVWXYZ","abcdefghijklmnopqrstuvwxyz")
"RTN","LEXXMC",294,0)
TM(X,Y) ;   Trim Character Y - Default " "
"RTN","LEXXMC",295,0)
 S X=$G(X) Q:X="" X  S Y=$G(Y) S:'$L(Y) Y=" " F  Q:$E(X,1)'=Y  S X=$E(X,2,$L(X))
"RTN","LEXXMC",296,0)
 F  Q:$E(X,$L(X))'=Y  S X=$E(X,1,($L(X)-1))
"RTN","LEXXMC",297,0)
 Q X
"RTN","LEXXMC",298,0)
RP(X,Y) ;   Repeat
"RTN","LEXXMC",299,0)
 N C,L S C=$G(X),L=+($G(Y)) Q:$L(C)*L>245 ""  S X="",$P(X,C,$G(L)+1)=""
"RTN","LEXXMC",300,0)
 Q X
"RTN","LEXXMC",301,0)
CTL(X) ;   Remove/Replace Control Characters
"RTN","LEXXMC",302,0)
 S X=$G(X) Q:'$L(X) ""  N OUT,PSN,CHR,ASC,REP,WIT
"RTN","LEXXMC",303,0)
 ;     Curved Apostrophe
"RTN","LEXXMC",304,0)
 F CHR=145,146 S REP=$C(CHR),WIT="'" S X=$$CTLR(X,REP,WIT)
"RTN","LEXXMC",305,0)
 ;     Accented letter e
"RTN","LEXXMC",306,0)
 F CHR=130,136,137,138 S REP=$C(CHR),WIT="e" S X=$$CTLR(X,REP,WIT)
"RTN","LEXXMC",307,0)
 ;     Accented letter c 
"RTN","LEXXMC",308,0)
 F CHR=128,135 S REP=$C(CHR),WIT="c" S X=$$CTLR(X,REP,WIT)
"RTN","LEXXMC",309,0)
 ;     Accented letter u 
"RTN","LEXXMC",310,0)
 F CHR=129,151,163 S REP=$C(CHR),WIT="u" S X=$$CTLR(X,REP,WIT)
"RTN","LEXXMC",311,0)
 ;     Accented letter a 
"RTN","LEXXMC",312,0)
 F CHR=131,132,133,134,143,145,160,166 S REP=$C(CHR),WIT="a" S X=$$CTLR(X,REP,WIT)
"RTN","LEXXMC",313,0)
 ;     Accented letter i
"RTN","LEXXMC",314,0)
 F CHR=139,140,141 S REP=$C(CHR),WIT="i" S X=$$CTLR(X,REP,WIT)
"RTN","LEXXMC",315,0)
 ;     Accented letter o 
"RTN","LEXXMC",316,0)
 F CHR=147,148,149,153,162 S REP=$C(CHR),WIT="o" S X=$$CTLR(X,REP,WIT)
"RTN","LEXXMC",317,0)
 ;     En dash
"RTN","LEXXMC",318,0)
 S REP=$C(150),WIT="o" S X=$$CTLR(X,REP,WIT)
"RTN","LEXXMC",319,0)
 ;     Inverted exclamation mark
"RTN","LEXXMC",320,0)
 S REP=$C(161),WIT="a" S X=$$CTLR(X,REP,WIT)
"RTN","LEXXMC",321,0)
 ;     Currency sign
"RTN","LEXXMC",322,0)
 S REP=$C(164),WIT="a" S X=$$CTLR(X,REP,WIT)
"RTN","LEXXMC",323,0)
 ;     Section Sing (double S)
"RTN","LEXXMC",324,0)
 S REP=$C(167),WIT="c" S X=$$CTLR(X,REP,WIT)
"RTN","LEXXMC",325,0)
 ;     Spacing diaeresis - umlaut
"RTN","LEXXMC",326,0)
 S REP=$C(168),WIT="e" S X=$$CTLR(X,REP,WIT)
"RTN","LEXXMC",327,0)
 ;     Copyright sign
"RTN","LEXXMC",328,0)
 S REP=$C(169),WIT="e" S X=$$CTLR(X,REP,WIT)
"RTN","LEXXMC",329,0)
 ;     Left double angle quotes
"RTN","LEXXMC",330,0)
 S REP=$C(171),WIT="e" S X=$$CTLR(X,REP,WIT)
"RTN","LEXXMC",331,0)
 ;     Pilcrow sign - paragraph sign
"RTN","LEXXMC",332,0)
 S REP=$C(182),WIT="o" S X=$$CTLR(X,REP,WIT)
"RTN","LEXXMC",333,0)
 ;     Spacing cedilla
"RTN","LEXXMC",334,0)
 S REP=$C(184),WIT="o" S X=$$CTLR(X,REP,WIT)
"RTN","LEXXMC",335,0)
 ;     One Fourth Fraction
"RTN","LEXXMC",336,0)
 S REP=$C(188),WIT="u" S X=$$CTLR(X,REP,WIT)
"RTN","LEXXMC",337,0)
 ;     Small letter a with circumflex
"RTN","LEXXMC",338,0)
 S REP=$C(226),WIT="o" S X=$$CTLR(X,REP,WIT)
"RTN","LEXXMC",339,0)
 ;     HTML En Dash
"RTN","LEXXMC",340,0)
 S REP=$C(8211),WIT="o" S X=$$CTLR(X,REP,WIT)
"RTN","LEXXMC",341,0)
 ;     Extended ASCII Vowels
"RTN","LEXXMC",342,0)
 S REP=$C(142),WIT="Z" S X=$$CTLR(X,REP,WIT)
"RTN","LEXXMC",343,0)
 S REP=$C(156),WIT="oe" S X=$$CTLR(X,REP,WIT)
"RTN","LEXXMC",344,0)
 S REP=$C(158),WIT="z" S X=$$CTLR(X,REP,WIT)
"RTN","LEXXMC",345,0)
 S REP=$C(159),WIT="Y" S X=$$CTLR(X,REP,WIT)
"RTN","LEXXMC",346,0)
 F CHR=192,193,194,195,196,197 S REP=$C(CHR),WIT="A" S X=$$CTLR(X,REP,WIT)
"RTN","LEXXMC",347,0)
 S REP=$C(198),WIT="AE" S X=$$CTLR(X,REP,WIT)
"RTN","LEXXMC",348,0)
 S REP=$C(199),WIT="C" S X=$$CTLR(X,REP,WIT)
"RTN","LEXXMC",349,0)
 F CHR=200,201,202,203 S REP=$C(CHR),WIT="E" S X=$$CTLR(X,REP,WIT)
"RTN","LEXXMC",350,0)
 F CHR=204,205,206,207 S REP=$C(CHR),WIT="I" S X=$$CTLR(X,REP,WIT)
"RTN","LEXXMC",351,0)
 S REP=$C(208),WIT="ETH" S X=$$CTLR(X,REP,WIT)
"RTN","LEXXMC",352,0)
 S REP=$C(209),WIT="N" S X=$$CTLR(X,REP,WIT)
"RTN","LEXXMC",353,0)
 F CHR=210,211,212,213,214,216 S REP=$C(CHR),WIT="O" S X=$$CTLR(X,REP,WIT)
"RTN","LEXXMC",354,0)
 F CHR=217,218,219,220 S REP=$C(CHR),WIT="U" S X=$$CTLR(X,REP,WIT)
"RTN","LEXXMC",355,0)
 S REP=$C(221),WIT="Y" S X=$$CTLR(X,REP,WIT)
"RTN","LEXXMC",356,0)
 F CHR=154,223 S REP=$C(CHR),WIT="s" S X=$$CTLR(X,REP,WIT)
"RTN","LEXXMC",357,0)
 F CHR=224,225,226,227,228,229 S REP=$C(CHR),WIT="a" S X=$$CTLR(X,REP,WIT)
"RTN","LEXXMC",358,0)
 S REP=$C(230),WIT="ae" S X=$$CTLR(X,REP,WIT)
"RTN","LEXXMC",359,0)
 S REP=$C(231),WIT="c" S X=$$CTLR(X,REP,WIT)
"RTN","LEXXMC",360,0)
 F CHR=232,233,234,235 S REP=$C(CHR),WIT="e" S X=$$CTLR(X,REP,WIT)
"RTN","LEXXMC",361,0)
 F CHR=236,237,238,239 S REP=$C(CHR),WIT="i" S X=$$CTLR(X,REP,WIT)
"RTN","LEXXMC",362,0)
 S REP=$C(240),WIT="eth" S X=$$CTLR(X,REP,WIT)
"RTN","LEXXMC",363,0)
 S REP=$C(241),WIT="n" S X=$$CTLR(X,REP,WIT)
"RTN","LEXXMC",364,0)
 F CHR=242,243,244,245,246,248 S REP=$C(CHR),WIT="o" S X=$$CTLR(X,REP,WIT)
"RTN","LEXXMC",365,0)
 F CHR=249,250,251,252 S REP=$C(CHR),WIT="u" S X=$$CTLR(X,REP,WIT)
"RTN","LEXXMC",366,0)
 F CHR=253,255 S REP=$C(CHR),WIT="y" S X=$$CTLR(X,REP,WIT)
"RTN","LEXXMC",367,0)
 ;     All others (remove)
"RTN","LEXXMC",368,0)
 S OUT="" F PSN=1:1:$L(X) S CHR=$E(X,PSN),ASC=$A(CHR) S:ASC>31&(ASC<127) OUT=OUT_CHR
"RTN","LEXXMC",369,0)
 ;     Uppercase leading character
"RTN","LEXXMC",370,0)
 S X=$$UP^XLFSTR($E(OUT,1))_$E(OUT,2,$L(OUT))
"RTN","LEXXMC",371,0)
 Q X
"RTN","LEXXMC",372,0)
DBLS(X) ;   Double Space/Special Characters
"RTN","LEXXMC",373,0)
 S X=$G(X) Q:(X'["  ")&(X'["^") X
"RTN","LEXXMC",374,0)
 F  S X=$P(X,"  ",1)_" "_$P(X,"  ",2,300) Q:X'["  "
"RTN","LEXXMC",375,0)
 F  S X=$P(X,"^",1)_" "_$P(X,"^",2,300) Q:X'["^"
"RTN","LEXXMC",376,0)
 F  Q:$E(X,1)'=" "  S X=$E(X,2,$L(X))
"RTN","LEXXMC",377,0)
 F  Q:$E(X,$L(X))'=" "  S X=$E(X,1,($L(X)-1))
"RTN","LEXXMC",378,0)
 Q X
"RTN","LEXXMC",379,0)
CTLR(LEX,X,Y) ;   Control Character Replace
"RTN","LEXXMC",380,0)
 N LEXT,LEXR1,LEXR2,LEX2,LEXW S LEXT=$G(LEX) Q:'$L(LEXT) ""  S LEXR1=$G(X) S X=LEXT Q:'$L(LEXR1) X  Q:LEXT'[LEXR1 X
"RTN","LEXXMC",381,0)
 S LEXW=$G(Y),LEXR2=$C(195)_LEXR1
"RTN","LEXXMC",382,0)
 I LEXT[LEXR2 F  Q:LEXT'[LEXR2  S LEXT=$P(LEXT,LEXR2,1)_LEXW_$P(LEXT,LEXR2,2,4000)
"RTN","LEXXMC",383,0)
 I LEXT[LEXR1 F  Q:LEXT'[LEXR1  S LEXT=$P(LEXT,LEXR1,1)_LEXW_$P(LEXT,LEXR1,2,4000)
"RTN","LEXXMC",384,0)
 S X=LEXT
"RTN","LEXXMC",385,0)
 Q X
"VER")
8.0^22.2
"BLD",10213,6)
^107
**END**
**END**

