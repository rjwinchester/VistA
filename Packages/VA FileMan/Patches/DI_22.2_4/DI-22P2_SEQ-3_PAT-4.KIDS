Released DI*22.2*4 SEQ #3
Extracted from mail message
**KIDS**:DI*22.2*4^

**INSTALL NAME**
DI*22.2*4
"BLD",9891,0)
DI*22.2*4^VA FILEMAN^0^3161122^y
"BLD",9891,1,0)
^^1^1^3161120^
"BLD",9891,1,1,0)
Patch DI*22.2*4 will repair VA FileMan 22.2 defects.
"BLD",9891,4,0)
^9.64PA^^
"BLD",9891,6.3)
5
"BLD",9891,"ABPKG")
n
"BLD",9891,"KRN",0)
^9.67PA^779.2^20
"BLD",9891,"KRN",.4,0)
.4
"BLD",9891,"KRN",.401,0)
.401
"BLD",9891,"KRN",.402,0)
.402
"BLD",9891,"KRN",.403,0)
.403
"BLD",9891,"KRN",.5,0)
.5
"BLD",9891,"KRN",.84,0)
.84
"BLD",9891,"KRN",3.6,0)
3.6
"BLD",9891,"KRN",3.8,0)
3.8
"BLD",9891,"KRN",9.2,0)
9.2
"BLD",9891,"KRN",9.8,0)
9.8
"BLD",9891,"KRN",9.8,"NM",0)
^9.68A^5^5
"BLD",9891,"KRN",9.8,"NM",1,0)
DDWT1^^0^B55752080
"BLD",9891,"KRN",9.8,"NM",2,0)
DICU2^^0^B34361274
"BLD",9891,"KRN",9.8,"NM",3,0)
DIL0^^0^B13217829
"BLD",9891,"KRN",9.8,"NM",4,0)
DIL11^^0^B12038687
"BLD",9891,"KRN",9.8,"NM",5,0)
DIR^^0^B39110200
"BLD",9891,"KRN",9.8,"NM","B","DDWT1",1)

"BLD",9891,"KRN",9.8,"NM","B","DICU2",2)

"BLD",9891,"KRN",9.8,"NM","B","DIL0",3)

"BLD",9891,"KRN",9.8,"NM","B","DIL11",4)

"BLD",9891,"KRN",9.8,"NM","B","DIR",5)

"BLD",9891,"KRN",19,0)
19
"BLD",9891,"KRN",19.1,0)
19.1
"BLD",9891,"KRN",101,0)
101
"BLD",9891,"KRN",409.61,0)
409.61
"BLD",9891,"KRN",771,0)
771
"BLD",9891,"KRN",779.2,0)
779.2
"BLD",9891,"KRN",870,0)
870
"BLD",9891,"KRN",8989.51,0)
8989.51
"BLD",9891,"KRN",8989.52,0)
8989.52
"BLD",9891,"KRN",8994,0)
8994
"BLD",9891,"KRN","B",.4,.4)

"BLD",9891,"KRN","B",.401,.401)

"BLD",9891,"KRN","B",.402,.402)

"BLD",9891,"KRN","B",.403,.403)

"BLD",9891,"KRN","B",.5,.5)

"BLD",9891,"KRN","B",.84,.84)

"BLD",9891,"KRN","B",3.6,3.6)

"BLD",9891,"KRN","B",3.8,3.8)

"BLD",9891,"KRN","B",9.2,9.2)

"BLD",9891,"KRN","B",9.8,9.8)

"BLD",9891,"KRN","B",19,19)

"BLD",9891,"KRN","B",19.1,19.1)

"BLD",9891,"KRN","B",101,101)

"BLD",9891,"KRN","B",409.61,409.61)

"BLD",9891,"KRN","B",771,771)

"BLD",9891,"KRN","B",779.2,779.2)

"BLD",9891,"KRN","B",870,870)

"BLD",9891,"KRN","B",8989.51,8989.51)

"BLD",9891,"KRN","B",8989.52,8989.52)

"BLD",9891,"KRN","B",8994,8994)

"MBREQ")
0
"PKG",1,-1)
1^1
"PKG",1,0)
VA FILEMAN^DI^FM INIT
"PKG",1,20,0)
^9.402P^^
"PKG",1,22,0)
^9.49I^1^1
"PKG",1,22,1,0)
22.2^3160105^3161117^520736440
"PKG",1,22,1,"PAH",1,0)
4^3161122
"PKG",1,22,1,"PAH",1,1,0)
^^1^1^3161122
"PKG",1,22,1,"PAH",1,1,1,0)
Patch DI*22.2*4 will repair VA FileMan 22.2 defects.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
5
"RTN","DDWT1")
0^1^B55752080^B53373348
"RTN","DDWT1",1,0)
DDWT1 ;SFISC/PD KELTZ,MKO - READ AND PROCESS ;9NOV2016
"RTN","DDWT1",2,0)
 ;;22.2;VA FileMan;**4**;Jan 05, 2016;Build 5
"RTN","DDWT1",3,0)
 ;;Per VA Directive 6402, this routine should not be modified.
"RTN","DDWT1",4,0)
 ;;Submitted to OSEHRA 5 January 2015 by the VISTA Expertise Network.
"RTN","DDWT1",5,0)
 ;;Based on Medsphere Systems Corporation's MSC FileMan 1051.
"RTN","DDWT1",6,0)
 ;;Licensed under the terms of the Apache License, Version 2.0.
"RTN","DDWT1",7,0)
 ;;GFT;**18,1000,1004,1005,1045,1049,1053,1056**;Mar 30, 1999
"RTN","DDWT1",8,0)
 ;
"RTN","DDWT1",9,0)
 ;Called from DDW ROUTINE
"RTN","DDWT1",10,0)
 D LOAD^DDW1 K DUOUT
"RTN","DDWT1",11,0)
 I '$G(DDWRWSET) D BOT^DDW3 I $L(DDWN) D BREAK^DDW5() ;GFT -- GO TO BOTTOM OF TEXT
"RTN","DDWT1",12,0)
 F  D GETIN Q:$D(DDWFIN)
"RTN","DDWT1",13,0)
 Q
"RTN","DDWT1",14,0)
 ;
"RTN","DDWT1",15,0)
GETIN ;Get input
"RTN","DDWT1",16,0)
 I DDWC'>DDWRMAR,DDWC-DDWOFS<IOM,DDWC>$L(DDWN)!DDWREP,'$D(DDWMARK) D
"RTN","DDWT1",17,0)
 . N DDWANS
"RTN","DDWT1",18,0)
 . D PREAD($$MIN(DDWRMAR,IOM-1+DDWOFS)-DDWC+1,DDWTO,.DDWANS,.DDWQ)
"RTN","DDWT1",19,0)
 . I DDWANS]"" D
"RTN","DDWT1",20,0)
 .. S DDWED=1
"RTN","DDWT1",21,0)
 .. I DDWSTAT,DDWQ="TO",DDWTO<DTIME S DDWQ=""
"RTN","DDWT1",22,0)
 .. S $E(DDWN,DDWC,DDWC+$L(DDWANS)-1)=DDWANS,DDWL(DDWRW)=DDWN
"RTN","DDWT1",23,0)
 .. S DDWC=DDWC+$L(DDWANS)
"RTN","DDWT1",24,0)
 E  D
"RTN","DDWT1",25,0)
 . D READ(DDWTO,.DDWQ)
"RTN","DDWT1",26,0)
 . D:$L(DDWQ)=1 DISPL
"RTN","DDWT1",27,0)
 ;
"RTN","DDWT1",28,0)
 I DDWSTAT D
"RTN","DDWT1",29,0)
 . I DDWQ="TO" D
"RTN","DDWT1",30,0)
 .. I $G(DDWTC) S:$$HDIFF(DDWTC,$H)+1<DTIME DDWQ=""
"RTN","DDWT1",31,0)
 .. E  S DDWTC=$H,DDWQ="" D:DDWSTAT STATUS
"RTN","DDWT1",32,0)
 . E  K DDWTC
"RTN","DDWT1",33,0)
 ;
"RTN","DDWT1",34,0)
 I $G(DDWAUTO),DDWQ'="TO",$$HDIFF(DDWAUTO("H"),$H)'<DDWAUTO("S") D AUTOSV^DDW1
"RTN","DDWT1",35,0)
 ;
"RTN","DDWT1",36,0)
 I $L(DDWQ)>1 D @DDWQ D:DDWSTAT STATUS
"RTN","DDWT1",37,0)
 Q
"RTN","DDWT1",38,0)
 ;
"RTN","DDWT1",39,0)
DISPL ;Display char
"RTN","DDWT1",40,0)
 I DDWC>245 W $C(7) Q
"RTN","DDWT1",41,0)
 ;
"RTN","DDWT1",42,0)
 S DDWED=1
"RTN","DDWT1",43,0)
 I $D(DDWMARK),DDWRW+DDWA'>$P(DDWMARK,U,3) D UNMARK^DDW7
"RTN","DDWT1",44,0)
 S:DDWC-1>$L(DDWN) DDWN=DDWN_$J("",DDWC-$L(DDWN)-1)
"RTN","DDWT1",45,0)
 S (DDWN,DDWL(DDWRW))=$E(DDWN,1,DDWC-1)_DDWQ_$E(DDWN,DDWC+DDWREP,999)
"RTN","DDWT1",46,0)
 S DDWC=DDWC+1
"RTN","DDWT1",47,0)
 ;
"RTN","DDWT1",48,0)
 I DDWREP W DDWQ
"RTN","DDWT1",49,0)
 E  D
"RTN","DDWT1",50,0)
IC . I 0  ;$P(DDGLED,DDGLDEL,5)]"" W $P(DDGLED,DDGLDEL,5)_DDWQ   GFT --  DON'T USE "INSERT CHARACTER"  IT SEEMS NOT TO WORK
"RTN","DDWT1",51,0)
 . E  W DDWQ_$E(DDWN,DDWC,IOM+DDWOFS)
"RTN","DDWT1",52,0)
 D POS(DDWRW,DDWC,"R")
"RTN","DDWT1",53,0)
 D:$L(DDWN)>DDWRMAR WRAP^DDW5
"RTN","DDWT1",54,0)
 Q
"RTN","DDWT1",55,0)
 ;
"RTN","DDWT1",56,0)
RUB ;COME HERE ON BACKSPACE
"RTN","DDWT1",57,0)
 N DDWX
"RTN","DDWT1",58,0)
 I DDWN="" S DDWCNT=DDWCNT-1  ;if current line is null  --Bill Eash
"RTN","DDWT1",59,0)
 S DDWED=1
"RTN","DDWT1",60,0)
 I $D(DDWMARK) D CHKDEL^DDW9(.DDWX) Q:DDWX
"RTN","DDWT1",61,0)
 ;
"RTN","DDWT1",62,0)
 I DDWC=1 D
"RTN","DDWT1",63,0)
 . I DDWRW=1 D
"RTN","DDWT1",64,0)
 .. I 'DDWA W $C(7)
"RTN","DDWT1",65,0)
 .. E  D MVBCK^DDW3(1),POS(1,"E","R")
"RTN","DDWT1",66,0)
 . E  D POS(DDWRW-1,"E","RN")
"RTN","DDWT1",67,0)
 E  D
"RTN","DDWT1",68,0)
 . S DDWC=DDWC-1,$E(DDWN,DDWC)="",DDWL(DDWRW)=DDWN
"RTN","DDWT1",69,0)
 . S DDWX=$E(DDWN,IOM+DDWOFS)
"RTN","DDWT1",70,0)
 . I DDWC-DDWOFS>0 D
"RTN","DDWT1",71,0)
 .. D CUP(DDWRW,DDWC-DDWOFS)
"RTN","DDWT1",72,0)
 .. I $P(DDGLED,DDGLDEL,6)]"" D
"RTN","DDWT1",73,0)
 ... W $P(DDGLED,DDGLDEL,6)
"RTN","DDWT1",74,0)
 ... I DDWX]" " D CUP(DDWRW,IOM) W DDWX D CUP(DDWRW,DDWC-DDWOFS)
"RTN","DDWT1",75,0)
 .. E  W $E(DDWN_" ",DDWC,IOM+DDWOFS) D CUP(DDWRW,DDWC-DDWOFS)
"RTN","DDWT1",76,0)
 . E  D POS(DDWRW,DDWC)
"RTN","DDWT1",77,0)
 Q
"RTN","DDWT1",78,0)
 ;
"RTN","DDWT1",79,0)
DEL N DDWX
"RTN","DDWT1",80,0)
 S DDWED=1
"RTN","DDWT1",81,0)
 I $D(DDWMARK) D CHKDEL^DDW9(.DDWX) Q:DDWX
"RTN","DDWT1",82,0)
 ;
"RTN","DDWT1",83,0)
 I DDWC>$L(DDWN) D  Q
"RTN","DDWT1",84,0)
 . I DDWN?." " D
"RTN","DDWT1",85,0)
 .. N DDWLAST
"RTN","DDWT1",86,0)
 .. S DDWLAST=DDWRW+DDWA=DDWCNT
"RTN","DDWT1",87,0)
 .. D XLINE^DDW5()
"RTN","DDWT1",88,0)
 .. D:DDWLAST POS(DDWRW,"E","R")
"RTN","DDWT1",89,0)
 . E  D
"RTN","DDWT1",90,0)
 .. N DDWY,DDWX
"RTN","DDWT1",91,0)
 .. S DDWY=DDWRW+DDWA,DDWX=DDWC
"RTN","DDWT1",92,0)
 .. D JOIN^DDW6
"RTN","DDWT1",93,0)
 .. D POS(DDWY-DDWA,DDWX,"RN")
"RTN","DDWT1",94,0)
 ;
"RTN","DDWT1",95,0)
 S $E(DDWN,DDWC)="",DDWL(DDWRW)=DDWN,DDWX=$E(DDWN,IOM+DDWOFS)
"RTN","DDWT1",96,0)
 I $P(DDGLED,DDGLDEL,6)]"" D
"RTN","DDWT1",97,0)
 . W $P(DDGLED,DDGLDEL,6)
"RTN","DDWT1",98,0)
 . I DDWX]" " D CUP(DDWRW,IOM) W DDWX D CUP(DDWRW,DDWC-DDWOFS)
"RTN","DDWT1",99,0)
 E  D
"RTN","DDWT1",100,0)
 . W $E(DDWN_" ",DDWC,IOM+DDWOFS)
"RTN","DDWT1",101,0)
 . D CUP(DDWRW,DDWC-DDWOFS)
"RTN","DDWT1",102,0)
 Q
"RTN","DDWT1",103,0)
 ;
"RTN","DDWT1",104,0)
STATUS N DDWX,DDWS
"RTN","DDWT1",105,0)
 S DDWS="Scr "_(DDWA+DDWRW-1\DDWMR+1)_" of "_(DDWCNT-1\DDWMR+1)
"RTN","DDWT1",106,0)
 S DDWX="Ln "_(DDWA+DDWRW)_" of "_DDWCNT
"RTN","DDWT1",107,0)
 S $E(DDWS,IOM\2+1-($L(DDWX)\2),999)=DDWX
"RTN","DDWT1",108,0)
 S DDWX="Col "_DDWC
"RTN","DDWT1",109,0)
 S $E(DDWS,IOM-$L(DDWX),999)=DDWX
"RTN","DDWT1",110,0)
 D CUP(DDWMR+2,1) W $P(DDGLCLR,DDGLDEL)_DDWS
"RTN","DDWT1",111,0)
 D POS(DDWRW,DDWC)
"RTN","DDWT1",112,0)
 Q
"RTN","DDWT1",113,0)
 ;
"RTN","DDWT1",114,0)
UP I DDWRW>1 D
"RTN","DDWT1",115,0)
 . D POS(DDWRW-1,DDWC,"RN")
"RTN","DDWT1",116,0)
 E  I DDWA D
"RTN","DDWT1",117,0)
 . D MVBCK^DDW3(1)
"RTN","DDWT1",118,0)
 E  W $C(7)
"RTN","DDWT1",119,0)
 I DDWC>246,$L(DDWN)<246 D POS(DDWRW,246,"R")
"RTN","DDWT1",120,0)
 Q
"RTN","DDWT1",121,0)
DN I DDWN="",DDWA+DDWRW>DDWCNT W $C(7) Q  ;**GFT  DOWN-ARROW: ALLOW GOING TO ENDING BLANK LINE
"RTN","DDWT1",122,0)
 I DDWRW<DDWMR D
"RTN","DDWT1",123,0)
 . D POS(DDWRW+1,DDWC,"RN")
"RTN","DDWT1",124,0)
 E  I DDWSTB D
"RTN","DDWT1",125,0)
 . D MVFWD^DDW3(1)
"RTN","DDWT1",126,0)
 E  W $C(7) Q
"RTN","DDWT1",127,0)
 I DDWC>246,$L(DDWN)<246 D POS(DDWRW,246,"R")
"RTN","DDWT1",128,0)
 Q
"RTN","DDWT1",129,0)
RT I DDWC>245,DDWC>$L(DDWN) W $C(7)
"RTN","DDWT1",130,0)
 E  D POS(DDWRW,DDWC+1,"R")
"RTN","DDWT1",131,0)
 Q
"RTN","DDWT1",132,0)
LT I DDWC=1 D
"RTN","DDWT1",133,0)
 . I DDWRW=1,'DDWA W $C(7)
"RTN","DDWT1",134,0)
 . E  D UP,POS(DDWRW,"E","R")
"RTN","DDWT1",135,0)
 E  D POS(DDWRW,DDWC-1,"R")
"RTN","DDWT1",136,0)
 Q
"RTN","DDWT1",137,0)
 ;
"RTN","DDWT1",138,0)
SV K DDWED G SV^DDW1
"RTN","DDWT1",139,0)
SW D SAVE^DDW1 S DDWFIN="",DIWESW=1 Q
"RTN","DDWT1",140,0)
EX D SAVE^DDW1 S DDWFIN="" Q
"RTN","DDWT1",141,0)
QT S DUOUT=1 G QUIT^DDW1 ;GFT
"RTN","DDWT1",142,0)
TO D SAVE^DDW1 S DTOUT=1,DDWFIN="" W $C(7) Q
"RTN","DDWT1",143,0)
HLP D HLP^DDWH,POS(DDWRW,DDWC) Q
"RTN","DDWT1",144,0)
AUT G AUTOTM^DDW1
"RTN","DDWT1",145,0)
 ;
"RTN","DDWT1",146,0)
TST G TSET^DDW2
"RTN","DDWT1",147,0)
TSALL G TSALL^DDW2
"RTN","DDWT1",148,0)
LST G LSET^DDW2
"RTN","DDWT1",149,0)
RST G RSET^DDW2
"RTN","DDWT1",150,0)
WRM G WRAPM^DDW2
"RTN","DDWT1",151,0)
RPM G REPLM^DDW2
"RTN","DDWT1",152,0)
ST G STAT^DDW2
"RTN","DDWT1",153,0)
 ;
"RTN","DDWT1",154,0)
TOP G TOP^DDW3
"RTN","DDWT1",155,0)
BOT G BOT^DDW3
"RTN","DDWT1",156,0)
 ;
"RTN","DDWT1",157,0)
PDN G PGDN^DDW4
"RTN","DDWT1",158,0)
PUP G PGUP^DDW4
"RTN","DDWT1",159,0)
TAB G TAB^DDW4
"RTN","DDWT1",160,0)
JLT G JLEFT^DDW4
"RTN","DDWT1",161,0)
JRT G JRIGHT^DDW4
"RTN","DDWT1",162,0)
LB G LBEG^DDW4
"RTN","DDWT1",163,0)
LE G LEND^DDW4
"RTN","DDWT1",164,0)
WRT G WORDR^DDW4
"RTN","DDWT1",165,0)
WLT G WORDL^DDW4
"RTN","DDWT1",166,0)
DLW S DDWED=1 G DELW^DDW4
"RTN","DDWT1",167,0)
DEOL S DDWED=1 G DEOL^DDW4
"RTN","DDWT1",168,0)
 ;
"RTN","DDWT1",169,0)
BRK ;I 'DDWREP,$G(DDWCNT)>1,$G(DDWN)="",$G(DDWL(DDWRW-1))="",DDWA+DDWRW'<DDWCNT D SAVE^DDW1 S DDWFIN="",DDWCNT=DDWCNT-1 Q  ;**GFT  GET OUT WITH TWO RETURNS AT BOTTOM
"RTN","DDWT1",170,0)
 S DDWED=1 D BREAK^DDW5() Q
"RTN","DDWT1",171,0)
XLN S DDWED=1 D XLINE^DDW5() D:DDWC'=1 POS(DDWRW,1,"R") Q
"RTN","DDWT1",172,0)
 ;
"RTN","DDWT1",173,0)
JN S DDWED=1 G JOIN^DDW6
"RTN","DDWT1",174,0)
RFT S DDWED=1 G REFMT^DDW6
"RTN","DDWT1",175,0)
 ;
"RTN","DDWT1",176,0)
MRK G MARK^DDW7
"RTN","DDWT1",177,0)
UMK G UNMARK^DDW7
"RTN","DDWT1",178,0)
 ;
"RTN","DDWT1",179,0)
CPY D COPY^DDW8() Q
"RTN","DDWT1",180,0)
CUT D CUT^DDW8() Q
"RTN","DDWT1",181,0)
PST D PASTE^DDW8() Q
"RTN","DDWT1",182,0)
 ;
"RTN","DDWT1",183,0)
FND G FIND^DDWF
"RTN","DDWT1",184,0)
 ;
"RTN","DDWT1",185,0)
NXT G NEXT^DDWF
"RTN","DDWT1",186,0)
GTO G GOTO^DDWG
"RTN","DDWT1",187,0)
CHG G CHG^DDWC
"RTN","DDWT1",188,0)
 Q
"RTN","DDWT1",189,0)
 ;
"RTN","DDWT1",190,0)
READ(DDWTO,Y) ;Out: Y = Char or mnemonic
"RTN","DDWT1",191,0)
 F  D  Q:Y'=-1
"RTN","DDWT1",192,0)
 . R *Y:DDWTO
"RTN","DDWT1",193,0)
 . I Y>127 D HS(.Y)
"RTN","DDWT1",194,0)
 . I Y>31,Y<127 S Y=$C(Y) Q
"RTN","DDWT1",195,0)
 . I Y<0 S Y="TO" Q
"RTN","DDWT1",196,0)
 . D MNE(.Y)
"RTN","DDWT1",197,0)
 Q
"RTN","DDWT1",198,0)
 ;
"RTN","DDWT1",199,0)
PREAD(DDWLEN,DDWTO,DDWST,Y) ;
"RTN","DDWT1",200,0)
 ;In:  DDWLEN = # chars to read
"RTN","DDWT1",201,0)
 ;Out:  DDWST = String
"RTN","DDWT1",202,0)
 ;          Y = Mnemonic, Null if DDWLEN chars read or invalid
"RTN","DDWT1",203,0)
 X DDGLZOSF("EON")
"RTN","DDWT1",204,0)
 R DDWST#DDWLEN:DDWTO E  S Y="TO" Q
"RTN","DDWT1",205,0)
 X DDGLZOSF("EOFF"),DDGLZOSF("TRMRD")
"RTN","DDWT1",206,0)
 ;
"RTN","DDWT1",207,0)
 D:DDWST?.E1.C.E H(.DDWST)
"RTN","DDWT1",208,0)
 ;
"RTN","DDWT1",209,0)
 I $C(Y)?1C,Y D
"RTN","DDWT1",210,0)
 . D MNE(.Y)
"RTN","DDWT1",211,0)
 . I Y=-1 S Y=""
"RTN","DDWT1",212,0)
 . E  I $L(Y)=1 W Y S DDWST=DDWST_Y,Y=""
"RTN","DDWT1",213,0)
 E  S Y=""
"RTN","DDWT1",214,0)
 Q
"RTN","DDWT1",215,0)
 ;
"RTN","DDWT1",216,0)
MNE(Y) ;In:  Y = Ascii value of first character
"RTN","DDWT1",217,0)
 ;Out: Y = Mnemonic, or -1 if invalid
"RTN","DDWT1",218,0)
 N S,F,T
"RTN","DDWT1",219,0)
 I Y=13 S DDWHLOG=$P($H,",",2)
"RTN","DDWT1",220,0)
 E  I Y=10,$D(DDWHLOG)#2,$P($H,",",2)-DDWHLOG<1 K DDWHLOG S Y=-1 Q
"RTN","DDWT1",221,0)
 E  K DDWHLOG
"RTN","DDWT1",222,0)
 S S="",F=0,T="DDW(""IN"")" ;We are looking in DDW("IN") for a string of characters, which we translate to something in DDW("OT")
"RTN","DDWT1",223,0)
 F  D MNELOOP(.S,.Y,.T,.F) Q:F
"RTN","DDWT1",224,0)
 Q
"RTN","DDWT1",225,0)
 ;
"RTN","DDWT1",226,0)
MNELOOP(S,Y,T,F) ;Read more
"RTN","DDWT1",227,0)
 ;In/Out:
"RTN","DDWT1",228,0)
 ;  S = string of input chars
"RTN","DDWT1",229,0)
 ;  Y = ascii of current char
"RTN","DDWT1",230,0)
 ;  T = table under consideration
"RTN","DDWT1",231,0)
 ;Out:
"RTN","DDWT1",232,0)
 ;  Y = mnemonic, or -1
"RTN","DDWT1",233,0)
 ;  F = 1 : done
"RTN","DDWT1",234,0)
 ;
"RTN","DDWT1",235,0)
 N E
"RTN","DDWT1",236,0)
 S S=S_$C(Y)
"RTN","DDWT1",237,0)
 I @T'[(U_S) D
"RTN","DDWT1",238,0)
 . I $C(Y)?1L D
"RTN","DDWT1",239,0)
 .. S $E(S,$L(S))=$$UP^DILIBF($C(Y)) ;GEKY --INTERNATIONALIZATION  artf16804
"RTN","DDWT1",240,0)
 .. S:@T'[(U_S_U) E=1
"RTN","DDWT1",241,0)
 . E  S E=1
"RTN","DDWT1",242,0)
 I $T,$G(E) D  Q
"RTN","DDWT1",243,0)
 . S T=$Q(@T)
"RTN","DDWT1",244,0)
 . I T]"" S $E(S,$L(S))=""
"RTN","DDWT1",245,0)
 . E  D FLUSH S F=1,Y=-1
"RTN","DDWT1",246,0)
 ;
"RTN","DDWT1",247,0)
 I @T[(U_S_U),S'=$C(27) D  Q
"RTN","DDWT1",248,0)
 . S Y=$P(@$TR(T,"IN","OT"),U,$L($P(@T,U_S_U),U)),F=1 ;We"ve got Y as the place to go to
"RTN","DDWT1",249,0)
 ;
"RTN","DDWT1",250,0)
 R *Y:5 I Y=-1 D FLUSH S F=1
"RTN","DDWT1",251,0)
 Q
"RTN","DDWT1",252,0)
 ;
"RTN","DDWT1",253,0)
H(DDWST) ;
"RTN","DDWT1",254,0)
 S DDWST=$TR(DDWST,$C(145,146,147,148),"''""""")
"RTN","DDWT1",255,0)
 I DDWST?.E1.C.E D
"RTN","DDWT1",256,0)
 . N DDWCON,DDWI
"RTN","DDWT1",257,0)
 . S DDWCON=""
"RTN","DDWT1",258,0)
 . F DDWI=128:1:255 S DDWCON=DDWCON_$C(DDWI)
"RTN","DDWT1",259,0)
 . S DDWST=$TR(DDWST,DDWCON,$J(" ",128))
"RTN","DDWT1",260,0)
 D POS(DDWRW,DDWC)
"RTN","DDWT1",261,0)
 W DDWST
"RTN","DDWT1",262,0)
 Q
"RTN","DDWT1",263,0)
 ;
"RTN","DDWT1",264,0)
HS(Y) ;
"RTN","DDWT1",265,0)
 I Y>144,Y<149 S Y=$A($E("''""""",Y-144))
"RTN","DDWT1",266,0)
 E  S Y=32
"RTN","DDWT1",267,0)
 Q
"RTN","DDWT1",268,0)
 ;
"RTN","DDWT1",269,0)
FLUSH ;
"RTN","DDWT1",270,0)
 N DDWX
"RTN","DDWT1",271,0)
 W $C(7) F  R *DDWX:0 E  Q
"RTN","DDWT1",272,0)
 Q
"RTN","DDWT1",273,0)
 ;
"RTN","DDWT1",274,0)
CUP(Y,X) ;
"RTN","DDWT1",275,0)
 S DY=IOTM+Y-2,DX=X-1 X IOXY
"RTN","DDWT1",276,0)
 Q
"RTN","DDWT1",277,0)
 ;
"RTN","DDWT1",278,0)
POS(R,C,F) ;Pos cursor based on char pos C
"RTN","DDWT1",279,0)
 N DDWX
"RTN","DDWT1",280,0)
 S:$G(C)="E" C=$L($G(DDWL(R)))+1
"RTN","DDWT1",281,0)
 S:$G(F)["N" DDWN=$G(DDWL(R))
"RTN","DDWT1",282,0)
 S:$G(F)["R" DDWRW=R,DDWC=C
"RTN","DDWT1",283,0)
 ;
"RTN","DDWT1",284,0)
 S DDWX=C-DDWOFS
"RTN","DDWT1",285,0)
 I DDWX>IOM!(DDWX<1) D SHIFT^DDW3(C,.DDWOFS)
"RTN","DDWT1",286,0)
 S DY=IOTM+R-2,DX=C-DDWOFS-1 X IOXY
"RTN","DDWT1",287,0)
 Q
"RTN","DDWT1",288,0)
 ;
"RTN","DDWT1",289,0)
MIN(X,Y) ;
"RTN","DDWT1",290,0)
 Q $S(X<Y:X,1:Y)
"RTN","DDWT1",291,0)
 ;
"RTN","DDWT1",292,0)
HDIFF(H1,H2) ;# seconds between two $H's
"RTN","DDWT1",293,0)
 Q (H2-H1)*86400+$P(H2,",",2)-$P(H1,",",2)
"RTN","DICU2")
0^2^B34361274^B33741056
"RTN","DICU2",1,0)
DICU2 ;SEA/TOAD,SF/TKW - VA FileMan: Lookup Tools, Return IDs ;5OCT2016
"RTN","DICU2",2,0)
 ;;22.2;VA FileMan;**4**;Jan 05, 2015;Build 5
"RTN","DICU2",3,0)
 ;;Per VA Directive 6402, this routine should not be modified.
"RTN","DICU2",4,0)
 ;;Submitted to OSEHRA 5 January 2015 by the VISTA Expertise Network.
"RTN","DICU2",5,0)
 ;;Based on Medsphere Systems Corporation's MSC Fileman 1051.
"RTN","DICU2",6,0)
 ;;Licensed under the terms of the Apache License, Version 2.0.
"RTN","DICU2",7,0)
 ;;GFT;**126,165,1032,1041,GFT,1042,1045**
"RTN","DICU2",8,0)
 ;
"RTN","DICU2",9,0)
IDS(DIFILE,DIEN,DIFLAGS,DINDEX,DICOUNT,DIDENT,DILIST,DI0NODE) ;
"RTN","DICU2",10,0)
 ;
"RTN","DICU2",11,0)
 ; ENTRY POINT--add an entry's identifiers to output
"RTN","DICU2",12,0)
 ;
"RTN","DICU2",13,0)
I1 ; setup 0-node and ID array interface, and output IEN
"RTN","DICU2",14,0)
 ;
"RTN","DICU2",15,0)
 I DIFLAGS["h" N F,N,I M F=DIFILE S N=$G(DI0NODE),I=+$G(DIEN) N DIFILE,DI0NODE,DIEN M DIFILE=F S DIEN=I S:N]"" DI0NODE=N K F,N,I
"RTN","DICU2",16,0)
 I '$D(DI0NODE) S DI0NODE=$G(@DIFILE(DIFILE)@(+DIEN,0))
"RTN","DICU2",17,0)
 N DID,DIDVAL
"RTN","DICU2",18,0)
 I DIFLAGS["P" N DINODE S DINODE=+DIEN
"RTN","DICU2",19,0)
 E  S @DILIST@(2,DICOUNT)=+DIEN
"RTN","DICU2",20,0)
 ;
"RTN","DICU2",21,0)
I1A ; output primary value (index for Lister, .01 for Finder)
"RTN","DICU2",22,0)
 ;
"RTN","DICU2",23,0)
 I DIFLAGS'["P",$D(DIDENT(-2)) D
"RTN","DICU2",24,0)
 . N DIOUT S DIOUT=$NA(@DILIST@(1,DICOUNT))
"RTN","DICU2",25,0)
 . I DIFLAGS[3 N DISUB D  Q
"RTN","DICU2",26,0)
 . . F DISUB=0:0 S DISUB=$O(DIDENT(0,-2,DISUB)) Q:'DISUB  D
"RTN","DICU2",27,0)
 . . . I DINDEX("#")'>1 D SET(0,-2,DISUB,DIOUT,.DINDEX,.DIFILE) Q
"RTN","DICU2",28,0)
 . . . N I S I=$NA(@DIOUT@(DISUB)) D SET(0,-2,DISUB,I,.DINDEX,.DIFILE)
"RTN","DICU2",29,0)
 . I $D(DIDENT(0,-2,.01)) D SET(0,-2,.01,DIOUT,"",.DIFILE)
"RTN","DICU2",30,0)
 . Q
"RTN","DICU2",31,0)
 ;
"RTN","DICU2",32,0)
I2 ; start loop: loop through output values
"RTN","DICU2",33,0)
 ;
"RTN","DICU2",34,0)
 I DIFLAGS["P" N DILENGTH S DILENGTH=$L(DINODE)
"RTN","DICU2",35,0)
 N DICODE,DICRSR,DIOUT,DISUB S DICRSR=-1
"RTN","DICU2",36,0)
 F  S DICRSR=$O(DIDENT(DICRSR)) Q:DICRSR=""!($G(DIERR))  S DID="" F  S DID=$O(DIDENT(DICRSR,DID)) Q:DID=""!($G(DIERR))  S DISUB="" F  D  Q:DISUB=""!$G(DIERR)
"RTN","DICU2",37,0)
 . I DIFLAGS'["P",DID=-2 Q
"RTN","DICU2",38,0)
 . S DISUB=$O(DIDENT(DICRSR,DID,DISUB)) Q:DISUB=""
"RTN","DICU2",39,0)
 . K DIDVAL
"RTN","DICU2",40,0)
I20 . ; output indexed field if "IX" was in FIELDS parameter
"RTN","DICU2",41,0)
 . I DID=0 D  Q
"RTN","DICU2",42,0)
 . . D SET(DICRSR,DID,DISUB,"DIDVAL",.DINDEX,.DIFILE)
"RTN","DICU2",43,0)
 . . I DIFLAGS["P" D ADD(.DIFLAGS,.DINODE,.DILENGTH,DIDVAL,DIEN,DILIST) Q
"RTN","DICU2",44,0)
 . . M @DILIST@("ID",DICOUNT,0,DISUB)=DIDVAL Q
"RTN","DICU2",45,0)
 .
"RTN","DICU2",46,0)
I3 . ; output field
"RTN","DICU2",47,0)
 . ; distinguish between computed and value fields
"RTN","DICU2",48,0)
 .
"RTN","DICU2",49,0)
 . I DID D  Q:$G(DIERR)
"RTN","DICU2",50,0)
 . . ; process fields that are not computed.
"RTN","DICU2",51,0)
 . . I DIFLAGS["E" N DIERR ;ERROR IN DATA WILL NOT STOP THE LISTING  --GFT
"RTN","DICU2",52,0)
 . . I $G(DIDENT(DICRSR,DID,0,"TYPE"))'="C" D
"RTN","DICU2",53,0)
 . . . D SET(DICRSR,DID,DISUB,"DIDVAL",.DINDEX,.DIFILE) Q
"RTN","DICU2",54,0)
 . .
"RTN","DICU2",55,0)
I4 . . ; computed fields
"RTN","DICU2",56,0)
 . . E  D
"RTN","DICU2",57,0)
 . . . N %,%H,%T,A,B,C,D,DFN,I,X,X1,X2,Y,Z,Z0,Z1
"RTN","DICU2",58,0)
 . . . N DA D DA^DILF(DIEN,.DA) ;M DA=DIEN S DA=$P(DIEN,",")  PATCH 165 MAY,2011
"RTN","DICU2",59,0)
 . . . N DIARG S DIARG="D0"
"RTN","DICU2",60,0)
 . . . N DIMAX S DIMAX=+$O(DA(""),-1)
"RTN","DICU2",61,0)
 . . . N DIDVAR F DIDVAR=1:1:DIMAX S DIARG=DIARG_",D"_DIDVAR
"RTN","DICU2",62,0)
 . . . N @DIARG F DIDVAR=0:1:DIMAX-1 S @("D"_DIDVAR)=DA(DIMAX-DIDVAR)
"RTN","DICU2",63,0)
 . . . S @("D"_DIMAX)=DA
"RTN","DICU2",64,0)
 . . . X DIDENT(DICRSR,DID,0) S DIDVAL=$G(X)
"RTN","DICU2",65,0)
COMPDT . . .I $P($G(^DD(DIFILE,DID,0)),U,2)["D",$O(DIDENT(-3,DID,""))'["I" N Y S Y=DIDVAL X:Y ^DD("DD") S DIDVAL=Y
"RTN","DICU2",66,0)
 . .
"RTN","DICU2",67,0)
I5 . . ; set field into array or pack node
"RTN","DICU2",68,0)
 . .
"RTN","DICU2",69,0)
 . . I DIFLAGS'["P" M @DILIST@("ID",DICOUNT,DID)=DIDVAL
"RTN","DICU2",70,0)
 . . E  D ADD(.DIFLAGS,.DINODE,.DILENGTH,DIDVAL,DIEN,DILIST)
"RTN","DICU2",71,0)
 .
"RTN","DICU2",72,0)
I6 . ; output display-only identifier
"RTN","DICU2",73,0)
 .
"RTN","DICU2",74,0)
 . E  D
"RTN","DICU2",75,0)
 . . N %,D,DIC,X,Y,Y1
"RTN","DICU2",76,0)
 . . S D=DINDEX
"RTN","DICU2",77,0)
 . . S DIC=DIFILE(DIFILE,"O")
"RTN","DICU2",78,0)
 . . S DIC(0)=$TR(DIFLAGS,"2^fglpqtuv104")
"RTN","DICU2",79,0)
 . . M Y=DIEN S Y=$P(DIEN,",")
"RTN","DICU2",80,0)
 . . S Y1=$G(@DIFILE(DIFILE)@(+DIEN,0)),Y1=DIEN
"RTN","DICU2",81,0)
 . .
"RTN","DICU2",82,0)
I7 . . ; execute the identifier's code
"RTN","DICU2",83,0)
 . .
"RTN","DICU2",84,0)
 . . N DIX S DIX=DIDENT(DICRSR,DID,0)
"RTN","DICU2",85,0)
 . . X DIX
"RTN","DICU2",86,0)
 . . I $G(DIERR) D  Q
"RTN","DICU2",87,0)
 . . . N DICONTXT I DID="ZZZ ID" S DICONTXT="Identifier parameter"
"RTN","DICU2",88,0)
 . . . E  S DICONTXT="MUMPS Identifier"
"RTN","DICU2",89,0)
 . . . D ERR^DICF4(120,DIFILE,DIEN,"",DICONTXT)
"RTN","DICU2",90,0)
 . .
"RTN","DICU2",91,0)
I8 . . ; set output from identifier into output array or pack node
"RTN","DICU2",92,0)
 . . N DIGFT S DIGFT=$NA(@DILIST@("ID","WRITE",DICOUNT)) I DID?1"C"1.2N S DIGFT=$NA(@DILIST@("ID",DICOUNT,DID)) ;**GFT
"RTN","DICU2",93,0)
 . . N DI,DILINE,DIEND S DI="" S:DIFLAGS'["P" DIEND=$O(@DIGFT@("z"),-1)
"RTN","DICU2",94,0)
 . . I $O(^TMP("DIMSG",$J,""))="" S ^TMP("DIMSG",$J,1)=""
"RTN","DICU2",95,0)
 . . F  D  Q:DI=""!$G(DIERR)
"RTN","DICU2",96,0)
 . . . S DI=$O(^TMP("DIMSG",$J,DI)) Q:DI=""
"RTN","DICU2",97,0)
 . . . S DILINE=$G(^TMP("DIMSG",$J,DI))
"RTN","DICU2",98,0)
 . . . I DIFLAGS["P" D ADD(.DIFLAGS,.DINODE,.DILENGTH,DILINE,DIEN,DILIST,DI) Q
"RTN","DICU2",99,0)
 . . . S DIEND=DIEND+1,@DIGFT@(DIEND)=DILINE
"RTN","DICU2",100,0)
 . . . Q
"RTN","DICU2",101,0)
 . . K DIMSG,^TMP("DIMSG",$J)
"RTN","DICU2",102,0)
 ;
"RTN","DICU2",103,0)
I9 ; for packed output, set pack node into output array
"RTN","DICU2",104,0)
 ;
"RTN","DICU2",105,0)
 I '$G(DIERR),DIFLAGS["P" S @DILIST@(DICOUNT,0)=DINODE
"RTN","DICU2",106,0)
 Q
"RTN","DICU2",107,0)
 ;
"RTN","DICU2",108,0)
 ;
"RTN","DICU2",109,0)
SET(DICRSR,DIFID,DISUB,DIOUT,DINDEX,DIFILE) ; Move data to DIOUT.
"RTN","DICU2",110,0)
 N F1,F2 M F1=DIFILE N DIFILE M DIFILE=F1
"RTN","DICU2",111,0)
 S F1=$O(DIDENT(DICRSR,DIFID,DISUB,"")),F2=$O(DIDENT(DICRSR,DIFID,DISUB,F1))
"RTN","DICU2",112,0)
 F F1=F1,F2 D:F1]""
"RTN","DICU2",113,0)
 . I DIDENT(DICRSR,DIFID,DISUB,F1)["DIVAL" N DIVAL S @DINDEX(DISUB,"GET")
"RTN","DICU2",114,0)
 . N X S @("X="_DIDENT(DICRSR,DIFID,DISUB,F1))
"RTN","DICU2",115,0)
 . I $G(DIERR),DIFLAGS["h" K DIERR,^TMP("DIERR",$J) S X=DINDEX(DISUB)
"RTN","DICU2",116,0)
 . I X["""" S X=$$CONVQQ^DILIBF(X)
"RTN","DICU2",117,0)
 . I +$P(X,"E")'=X S X=""""_X_""""
"RTN","DICU2",118,0)
 . I F2="" S @(DIOUT_"="_X) Q
"RTN","DICU2",119,0)
 . S O=$NA(@DIOUT@(F1)),@(O_"="_X) Q
"RTN","DICU2",120,0)
 Q
"RTN","DICU2",121,0)
 ;
"RTN","DICU2",122,0)
TRANOUT(DISUB,DIVL) ; Execute TRANSFORM FOR DISPLAY on index value
"RTN","DICU2",123,0)
 N X S X=DIVL
"RTN","DICU2",124,0)
 N DICODE S DICODE=$G(DINDEX(DISUB,"TRANOUT"))
"RTN","DICU2",125,0)
 I DICODE]"" X DICODE
"RTN","DICU2",126,0)
 Q X
"RTN","DICU2",127,0)
 ;
"RTN","DICU2",128,0)
ADD(DIFLAGS,DINODE,DILENGTH,DINEW,DIEN,DILIST,DILCNT) ;
"RTN","DICU2",129,0)
 ;
"RTN","DICU2",130,0)
 ; for Packed output, add DINEW to DINODE, erroring if overflow
"RTN","DICU2",131,0)
 ; xform if it contains ^
"RTN","DICU2",132,0)
 ;
"RTN","DICU2",133,0)
A1 N DINEWLEN,DELIM S DINEWLEN=$L(DINEW),DELIM=$S($G(DILCNT)'>1:"^",1:"~")
"RTN","DICU2",134,0)
 S DILENGTH=DILENGTH+1+DINEWLEN
"RTN","DICU2",135,0)
 I DILENGTH>$G(^DD("STRING_LIMIT"),255) D ERR^DICF4(206,"","","",+DIEN) Q  ;**HERE IS WHERE A PACKED STRING WAS FORCED TO BE ONLY 255 CHARACTERS LONG
"RTN","DICU2",136,0)
 I DIFLAGS'[2,DINEW[U S DIFLAGS="2^"_DIFLAGS D ENCODE(DILIST,.DINODE)
"RTN","DICU2",137,0)
 I DIFLAGS[2,DINEW[U!(DINEW["&") S DINEW=$$HTML^DILF(DINEW) Q:$G(DIERR)
"RTN","DICU2",138,0)
 S DINODE=DINODE_DELIM_DINEW
"RTN","DICU2",139,0)
 Q
"RTN","DICU2",140,0)
 ;
"RTN","DICU2",141,0)
ENCODE(DILIST,DINODE) ;
"RTN","DICU2",142,0)
 ;
"RTN","DICU2",143,0)
 ; ADD: HTML encode records already output (we found an embedded ^)
"RTN","DICU2",144,0)
 ; procedure: loop through list encoding &s
"RTN","DICU2",145,0)
 ;
"RTN","DICU2",146,0)
E1 N DILINE,DIRULE S DIRULE(1,"&")="&amp;"
"RTN","DICU2",147,0)
 N DIREC S DIREC=0 F  S DIREC=$O(@DILIST@(DIREC)) Q:'DIREC  D
"RTN","DICU2",148,0)
 . S DILINE=@DILIST@(DIREC,0) Q:DILINE'["&"
"RTN","DICU2",149,0)
 . S @DILIST@(DIREC,0)=$$TRANSL8^DILF(DILINE,.DIRULE)
"RTN","DICU2",150,0)
 I DINODE["&" S DINODE=$$TRANSL8^DILF(DINODE,.DIRULE)
"RTN","DICU2",151,0)
 Q
"RTN","DICU2",152,0)
 ;
"RTN","DIL0")
0^3^B13217829^B12098388
"RTN","DIL0",1,0)
DIL0 ;SFISC/GFT - TURN PRINT FLDS INTO CODE ;4NOV2016
"RTN","DIL0",2,0)
 ;;22.2;VA FileMan;**4**;Jan 05, 2016;Build 5
"RTN","DIL0",3,0)
 ;;Per VA Directive 6402, this routine should not be modified.
"RTN","DIL0",4,0)
 ;;Submitted to OSEHRA 5 January 2015 by the VISTA Expertise Network.
"RTN","DIL0",5,0)
 ;;Based on Medsphere Systems Corporation's MSC FileMan 1051.
"RTN","DIL0",6,0)
 ;;Licensed under the terms of the Apache License, Version 2.0.
"RTN","DIL0",7,0)
 ;;GFT;**91,102,999,1005,1012,1056**
"RTN","DIL0",8,0)
 ;CALLED FROM ^DIL
"RTN","DIL0",9,0)
 D XDUY S %=$P(X,U,2) S:%["Cm"&(W[";W") %="w"_% G WP:%["W",M:%["m",STATS^DIL1:$D(DCL(DP_U_+W)),N:W[";N"
"RTN","DIL0",10,0)
 I W[";W" D  S D1=$S(%["C":Y,1:$P(" S Y=",U,Y'?1" ".E)_Y_" S X=Y") D W S Y=Y_D1_" D ^DIWP" Q
"RTN","DIL0",11,0)
 .N %,DNP S DNP=1 D EN^DILL(DP,+W,1)
"RTN","DIL0",12,0)
 D EN^DILL(DP,+W,1)
"RTN","DIL0",13,0)
DN ;
"RTN","DIL0",14,0)
 I W[";X" D  Q
"RTN","DIL0",15,0)
 .S DE=$S(W[";C"!(W[";S"):DE,$A(Y)-32:" W ?0",1:"")
"RTN","DIL0",16,0)
 .I $L(DE)+$L(Y)>250 D
"RTN","DIL0",17,0)
 ..S %=Y,Y=DE,DE=% D PX^DIL S Y=DE
"RTN","DIL0",18,0)
 .E  S Y=DE_Y
"RTN","DIL0",19,0)
 .I $D(DIWR(DM)) D DIWR
"RTN","DIL0",20,0)
DNW D H:DHD!$G(DIOSUBHD) I DG+DLN>IOM,DG K ^UTILITY("DIL",$J,DG) S DG='%*DM*2+2,DE=$P(W,";C",2),DG=$S(DE>0:DE-1,DE<0:IOM+DE,DG+DLN'>IOM!(W[";W"):DG,DLN>IOM:0,1:IOM-DLN),DE=" D T Q:'DN  W ?"_DG D W^DIL,H:DHD!$G(DIOSUBHD)
"RTN","DIL0",21,0)
 S DG=2+DLN+DG Q:$D(DNP)  I $L(DE)+$L(Y)>250 S %=Y,Y=DE,DE=% D PX^DIL S Y=DE Q
"RTN","DIL0",22,0)
 S Y=DE_Y Q
"RTN","DIL0",23,0)
 ;
"RTN","DIL0",24,0)
H S V=$P(X,U),Z=99,I=$F(W,";""") I I>0 Q:$E(W,I-4,I)=";Z;"""""  S I=$P(W,";""",2),V=$$CONVQQ^DILIBF($P(I,"""",1,$L(I,"""")-1)) ;V will be COLUMN HEADER
"RTN","DIL0",25,0)
HEAD Q:V=""  S I=$P(V," ") I $L(I)>DLN S DLN=$L(I) ;Grab the next 'word'.  Column width may have to be increased for a long word
"RTN","DIL0",26,0)
XD S V=$P(V," ",2,99),D=$P(V," ") I D]"",$L(I)+$L(D)<DLN S I=I_" "_D G XD
"RTN","DIL0",27,0)
 S ^UTILITY("DIL",$J,DG,Z)=$J(I,DRJ*DLN),V(Z)="",Z=Z-1 G HEAD
"RTN","DIL0",28,0)
 ;
"RTN","DIL0",29,0)
XDUY ;
"RTN","DIL0",30,0)
 I '$D(^DD(DP,+W,0)) S X="",DU=0,Y=0 Q
"RTN","DIL0",31,0)
 S X=^(0),DU=$P(X,U,4),Y=$P(DU,";",2),DU=$P(DU,";") I W[";T",$D(^(.1)) S X=^(.1)_U_$P(X,U,2,99)
"RTN","DIL0",32,0)
EGP E  S $P(X,U)=$$LABEL^DIALOGZ(DP,+W) ;**FIELD LABEL FOR OUTPUT HEADING
"RTN","DIL0",33,0)
 S:+DU'=DU DU=""""_DU_""""
"RTN","DIL0",34,0)
 I Y S Y="$P(X,U,"_Y_")" Q
"RTN","DIL0",35,0)
 I Y="" S Y="D"_DM Q
"RTN","DIL0",36,0)
 S Y=$E(Y,2,9) S:$P(Y,",",2)=+Y Y=+Y S Y="$E(X,"_Y_")" Q
"RTN","DIL0",37,0)
 ;
"RTN","DIL0",38,0)
WR ;
"RTN","DIL0",39,0)
 K DLN D W^DILL
"RTN","DIL0",40,0)
W S DRJ=0,DIWL=DIWL+1 I '$D(DLN) S %=IOM-DG,DLN=$S(%>20:%,1:IOM)-2
"RTN","DIL0",41,0)
 S:W[";X" $P(X,U)="" D DNW S %=$P(DE,"W ?",2)+1,Y=DLN+%-1,DIO=2,%=" S DIWL="_%_",DIWR="_$S(IOM<Y:IOM,1:Y),Y=$P(DE," W ?")_% Q
"RTN","DIL0",42,0)
 ;
"RTN","DIL0",43,0)
WP S DN=%["L"_U D WR ;COME HERE FOR A W-P TYPE FIELD
"RTN","DIL0",44,0)
 S DIO=3,Y=%_" D ^DIWP",X=F(DM-1) I DHT<0 S I=$E(^UTILITY("DIPZ",$J,X),2,999) D WPX S ^UTILITY("DIPZ",$J,X)=" "_I Q
"RTN","DIL0",45,0)
 I $D(^UTILITY($J,99,X)) S I=^(X) D WPX S ^UTILITY($J,99,X)=I Q
"RTN","DIL0",46,0)
WPX ;from DIPZ1
"RTN","DIL0",47,0)
 S:DN I=^DD("FUNC",38,1)_" "_I ;'NOWRAP' FUNCTION
"RTN","DIL0",48,0)
 I DE]"" S I=DE_" "_I ;GFT
"RTN","DIL0",49,0)
 Q
"RTN","DIL0",50,0)
 ;
"RTN","DIL0",51,0)
M S D1=" S DICMX=""D "_$E("L",%'["w")_"^DIWP"" "_$P(X,U,5,99) D WR S Y=Y_D1 Q
"RTN","DIL0",52,0)
 ;
"RTN","DIL0",53,0)
N ;
"RTN","DIL0",54,0)
 S DCL=DCL+1,DXS="Y",D=",Y=$$DITTO^DIO2("_DCL_",Y)",DITTO(DCL)="",I=""
"RTN","DIL0",55,0)
 I %["C" S X=X_" S Y=X"_D_" S X=Y" G Z
"RTN","DIL0",56,0)
 S Y=" S Y="_Y_D
"RTN","DIL0",57,0)
Z D EN^DILL(DP,+W) G DN
"RTN","DIL0",58,0)
 ;
"RTN","DIL0",59,0)
DIWR ;CALLED FROM ^DIL
"RTN","DIL0",60,0)
 G DIWR^DIPZ1:DHT I $D(DIWR(DM)),DX=DIWR(DM) S ^UTILITY($J,99,DX)="D A^DIWW" G K
"RTN","DIL0",61,0)
 I $D(DIWR(DM)) F DX=DX+1:1 I '$D(^UTILITY($J,99,DX)) S ^(DX)="D ^DIWW" D DX^DIL(DX) G K
"RTN","DIL0",62,0)
 D  S ^UTILITY($J,99,I)="D ^DIWW "_^UTILITY($J,99,I)
"RTN","DIL0",63,0)
 .F I=DM-1:-1:0 I $D(DIWR(I)) K DIWR(I) Q
"RTN","DIL0",64,0)
 .I I S I=F(I)
"RTN","DIL0",65,0)
 .E  F I=1:1 Q:'$D(^UTILITY($J,99,I+1))
"RTN","DIL0",66,0)
K K DIWR(DM) Q
"RTN","DIL11")
0^4^B12038687^B11509462
"RTN","DIL11",1,0)
DIL11 ;SFISC/GFT - TURN PRINT FLDS INTO CODE ;10NOV2016
"RTN","DIL11",2,0)
 ;;22.2;VA FileMan;**4**;Jan 05, 2016;Build 5
"RTN","DIL11",3,0)
 ;;Per VA Directive 6402, this routine should not be modified.
"RTN","DIL11",4,0)
 ;;Submitted to OSEHRA 5 January 2015 by the VISTA Expertise Network.
"RTN","DIL11",5,0)
 ;;Based on Medsphere Systems Corporation's MSC FileMan 1051.
"RTN","DIL11",6,0)
 ;;Licensed under the terms of the Apache License, Version 2.0.
"RTN","DIL11",7,0)
 ;;GFT;**152,1037,1056**
"RTN","DIL11",8,0)
 ;
"RTN","DIL11",9,0)
DOWN ;INTO A MULTIPLE
"RTN","DIL11",10,0)
 I W>0,'$D(^DD(DP,+W,0)) Q  ;IN CASE FIELD IS NOW GONE FOR SOME REASON!
"RTN","DIL11",11,0)
 S DN=-6,DY(DM)=DY,DP(DM)=DP,DI(DM)=DI I W>0 D M G D^DIL
"RTN","DIL11",12,0)
F ;
"RTN","DIL11",13,0)
 S DP=-W,X=$P(W,U,2),DD=DD+1,M(DP)=1,DIL(DM)=DIL,DIL(DM,0)=DIL0,Y=0,DIL0=DIL0+100,%=X["(" I % S (X,DI)=U_X,DIL=DIL0
"RTN","DIL11",14,0)
 E  S DI=DI(DM)_","""_X_""",",DIL=DIL+101
"RTN","DIL11",15,0)
QT S Y=$F(X,"""",Y) I Y S X=$E(X,1,Y-1)_$E(X,Y-1,999),Y=Y+1 G QT
"RTN","DIL11",16,0)
 S Y=" S I("_DIL_")="""_X_""",J("_DIL_")="_DP
"RTN","DIL11",17,0)
 S X=" "_$P($P(W,U,4,99),";")
"RTN","DIL11",18,0)
 S DY="D"_(DIL-DIL0),DI=DI_DY,DIL=DIL-1 I $P(W,U,3)="" S W=+W,Y=Y_X_" S D0=D(0) I D0>0" G D^DIL
"RTN","DIL11",19,0)
 S %="I("_(DIL0-100)_",0)=D0" I X'[% S X=","_%_X
"RTN","DIL11",20,0)
 I DHT=-1 D DREL^DIPZ1 G END ;WE'RE COMPILING A PRINT TEMPLATE
"RTN","DIL11",21,0)
 F %=900:1 I '$D(^UTILITY($J,99,%)) S ^(%)="I 1 X:$D(DSC("_DP_")) DSC("_DP_") I  D T:$X>"_DG_" Q:'DN "_Y,Y=" S (DIXX,DIXX("_(DM+1)_"))="_%_X,W=+W D D^DIL K R(DX) Q
"RTN","DIL11",22,0)
END S (F(DM-1),DX)=%,R(%)=DP(DM-1),R(%,1)=M(DP(DM-1))
"RTN","DIL11",23,0)
 Q
"RTN","DIL11",24,0)
 ;
"RTN","DIL11",25,0)
 ;
"RTN","DIL11",26,0)
M N %,DILEVEL,DIB1,DIBO,D,DY,X ;BUILD A "Y" STRING
"RTN","DIL11",27,0)
 S DILEVEL=DIL-DIL0+1
"RTN","DIL11",28,0)
 S X=^DD(DP,+W,0),DU=$P($P(X,U,4),";") S:+DU'=DU DU=""""_DU_""""
"RTN","DIL11",29,0)
 S DI=DI_","_DU_",",DY="D"_DILEVEL
"RTN","DIL11",30,0)
B I W'[";B" S %=":0 Q:$O("_DI_DY_"))'>0 ",DIB1=""
"RTN","DIL11",31,0)
 E  S DIB1="DIB"_DIL,DIBO="$O("_DI_"""B"","_DIB1,DIB1=" N "_DIB1_" S "_DIB1_"="""" F  S "_DIB1_"="_DIBO_")) Q:"_DIB1_"=""""  Q:'DN  ",%=":0 Q:"_DIBO_","_DY_"))'>0 "
"RTN","DIL11",32,0)
 S DI=DI_DY
"RTN","DIL11",33,0)
 S DP=+$P(X,U,2),M(DP)=1,D=$P("""""",U,+DU'=DU),D=" S I("_(DIL+1)_")="_D_DU_D_",J("_(DIL+1)_")="_DP_DIB1,Y=" S "_DY_"=$O(^("_DY_"))"
"RTN","DIL11",34,0)
 ;XML I $G(DDXPFFNO) S D=D_$$WOPEN^DIXML($P(X,U))
"RTN","DIL11",35,0)
 ;
"RTN","DIL11",36,0)
W S W=$P(W,",") I $P(^DD(DP,.01,0),U,2)["W" D:$P(^(0),U,2)["x"!($P(^(0),U,2)["X")  G P ;**DI*22*152**
"RTN","DIL11",37,0)
 .S D=D_",D"_(DIL+1)_"=$G(DIWF) N DIWF S DIWF=D"_(DIL+1)_"_""X"""
"RTN","DIL11",38,0)
 I DHT+1 F X=1:1 G P:X>DPP,DPP:+DPP(X)=DP!$D(DPP(X,DP))
"RTN","DIL11",39,0)
DPP S Y=Y_" Q:"_DY_"'>0 "
"RTN","DIL11",40,0)
 I DIB1="" S Y=" X $G(DSC("_DP_")) "_Y ;DSC will switch the naked reference, so we can get thru the subentries faster!
"RTN","DIL11",41,0)
 I DIB1]"" S Y=Y_" I 1 X $G(DSC("_DP_")) I " ;DSC will do an IF
"RTN","DIL11",42,0)
 I DHT+1,"@"[$P(DPP(X),U,4),$P(DPP(X),U,2)=0 S DPP(X,U)="" G R:$D(DPP(X,"F"))
"RTN","DIL11",43,0)
 S Y=Y_" "
"RTN","DIL11",44,0)
P S Y=D_" F "_DY_"=0"_%_Y_$S($D(DIARP(DP)):" X DIARP("_DP_") I $T",1:"")
"RTN","DIL11",45,0)
 G S
"RTN","DIL11",46,0)
 ;
"RTN","DIL11",47,0)
R S V=$P(DPP(X,"T"),U),Y=D_" F "_DY_"="_$P(DPP(X,"F"),U)_%_Y ;RANGE "F"ROM AND "T"O SORTING BY SUB-IEN
"RTN","DIL11",48,0)
 I V S:Y?.E1"'>0 " Y=$E(Y,1,$L(Y)-1) S Y=Y_"!("_DY_">"_V_")" ;_$S(V:"!("_DY_">"_V_") ",1:" ")
"RTN","DIL11",49,0)
 S Y=Y_" "
"RTN","DIL11",50,0)
S S:($G(DDXP)'=4) %=" D:$X>"_DG,Y=Y_%_$S($D(DIWR):" NX^DIWW",1:" T Q:'DN ") ;ADD A LINE FEED UNLESS WE ARE 'EXPORTING'
"RTN","DIL11",51,0)
 I DHT>0 S ^UTILITY($J,DV)="I "_DY_"'>0 S "_DY_"=0 "_$P(Y,"  ",2,99),DV=DV+1 ;HEADER TEMPLATE
"RTN","DIL11",52,0)
 Q
"RTN","DIR")
0^5^B39110200^B37985105
"RTN","DIR",1,0)
DIR ;SFISC/XAK - READER, HELP ;16NOV2016
"RTN","DIR",2,0)
 ;;22.2;VA FileMan;**4**;Jan 05, 2016;Build 5
"RTN","DIR",3,0)
 ;;Per VA Directive 6402, this routine should not be modified.
"RTN","DIR",4,0)
 ;;Submitted to OSEHRA 5 January 2015 by the VISTA Expertise Network.
"RTN","DIR",5,0)
 ;;Based on Medsphere Systems Corporation's MSC FileMan 1051.
"RTN","DIR",6,0)
 ;;Licensed under the terms of the Apache License, Version 2.0.
"RTN","DIR",7,0)
 ;;GFT;**30,170,999,1004,1037,1038,1044,1056**;
"RTN","DIR",8,0)
 ;
"RTN","DIR",9,0)
 N %,%A,%B,%B1,%B2,%B3,%BA,%C,%E,%G,%H,%I,%J,%N,%P,%S,%T,%W,%X,%Y,A0,C,D,DD,DDH,DDQ,DDSV,DG,DH,DIC,DIFLD,DIRO,DO,DP,DQ,DU,DZ,X1,XQH,DIX,DIY,DISYS,%BU,%J1,%A0,%W0,%D1,%D2,%DT,%K,%M,DIRCOUNT
"RTN","DIR",10,0)
 S:$D(DDH)[0 DDH=0 Q:'$D(DIR(0))  D ^DIR2 G Q:%T=""
"RTN","DIR",11,0)
 I $D(DIR("V"))#2 D ^DIR1 S DDER=%E G Q
"RTN","DIR",12,0)
A I $D(DDM) K:DDM DDQ S:'DDM DDQ=$G(DDSHBX,IOSL-7) ;**
"RTN","DIR",13,0)
 I $G(DDH) D LIST^DDSU
"RTN","DIR",14,0)
 D W:%A'["V" I $D(DDS),$D(DIR0) S DDACT=Y I DDO=.5 S DDM=1 G Q
"RTN","DIR",15,0)
TOOMANY S DIRCOUNT=$G(DIRCOUNT)+1 I DIRCOUNT>49 S (X,Y)=U,(DUOUT,DIRUT)=1 G Q
"RTN","DIR",16,0)
 I %A'["V",%E D QUES S A0="" D MSG D:$G(DDH) LIST^DDSU G A
"RTN","DIR",17,0)
 I $D(DTOUT) K Y S DIRUT=1,Y="" G Q
"RTN","DIR",18,0)
 I %T'="E",X?1."^".E K Y S (DUOUT,DIRUT)=1,Y=X S:X="^^" DIROUT=1 S:%T="Y" %=-1 G Q
"RTN","DIR",19,0)
 I %T'="E","@"[X,%A["O" S Y="",DIRUT=1 S:%T="P" Y=-1 G Q
"RTN","DIR",20,0)
 I %A'["O","@"[X,%T'="E" S A0=$C(7)_%A0 D MSG G A
"RTN","DIR",21,0)
 I $D(DDS),$D(DIR0),DIR0N G Q
"RTN","DIR",22,0)
 I $D(%G),$D(DIR("B")),X=DIR("B") S Y=%G G Q
"RTN","DIR",23,0)
X I X'?1."?" K DDQ D ^DIR1 D
"RTN","DIR",24,0)
 .I $D(DICQRETA) S DIR0N=1,%E=0,X="",DDACT=DICQRETA K DICQRETA Q
"RTN","DIR",25,0)
 .I '%E,$P(DIR(0),U,3)]"" S %X=X D  S:'$D(X) %E=1 S X=%X ;^DIR1 will evaluate input
"RTN","DIR",26,0)
 ..N %A,%B,%B1,%B2,%B3,%E,%N,%P,%T,%X,%W,%W0
"RTN","DIR",27,0)
 ..X $P(DIR(0),U,3,99) ;INPUT TRANSFORM if any
"RTN","DIR",28,0)
 I %A["V" K:%E Y G Q
"RTN","DIR",29,0)
 I X'?1."?",'%E G Q ;If no error or "?", quit
"RTN","DIR",30,0)
 D QUES:%E'<0&'$G(DUOUT)&'$G(DTOUT) S A0="" D MSG D:$G(DDH) LIST^DDSU ;**170
"RTN","DIR",31,0)
 I $D(DICQRETV) S (X,DIR0A)=DICQRETV,DDSREPNT=1,DDACT="" K DICQRETV,DICQRETA G X ;RETURN VALUE from drop-down list is sent back for evaluation (and echoing)
"RTN","DIR",32,0)
 I $D(DICQRETA) S DIR0N=1,DDACT=DICQRETA K DICQRETA G Q
"RTN","DIR",33,0)
 G A
"RTN","DIR",34,0)
 ;
"RTN","DIR",35,0)
 ;
"RTN","DIR",36,0)
 ;
"RTN","DIR",37,0)
W ; write the prompt and read the user's response
"RTN","DIR",38,0)
 S %W=%W0,%N=$E(%W)=U
"RTN","DIR",39,0)
SCREEN K DTOUT,DUOUT,DIRUT,DIROUT S %E=0 I $D(DDS),$D(DIR0) D ^DIR0 Q:'$D(DIR("PRE"))  X DIR("PRE") S:'$D(X) %E=1,X="" Q  ;READ in DIR01 via DIR0
"RTN","DIR",40,0)
 I %T="S",%A'["A",%A'["B" D S
"RTN","DIR",41,0)
 I $D(DIR("A"))=11 F %=0:0 S %=$O(DIR("A",%)) Q:%'>0  W !,DIR("A",%)
"RTN","DIR",42,0)
 W ! W:$L(%P) %P
"RTN","DIR",43,0)
 I $L($G(DIR("B")))>19,%A'["r",%T'="D",%T'="S",(%B'["D"&%T)!'%T,%B'["P"!'$P(%A,",",2) W DIR("B") S Y=DIR("B") D RW^DIR2 S:X="" X=DIR("B") Q
"RTN","DIR",44,0)
DIRB N DIRB I $D(DIR("B")) S DIRB=DIR("B") D  W DIRB_"// " ;**
"RTN","DIR",45,0)
 .I %T="Y",$G(DUZ("LANG"))>1,$G(%B)]"" N X S X=$F("YN",$$UP^DILIBF($E(DIRB))) S:X DIRB=$P($P(%B,";",X-1),":",2) ;YES/NO in FOREIGN LANGUAGE
"RTN","DIR",46,0)
 R X:$S($D(DIR("T")):DIR("T"),'$D(DTIME):300,1:DTIME) I '$T S DTOUT=1
"RTN","DIR",47,0)
 I $D(DIR("PRE")) X DIR("PRE") I '$D(X) S %E=1,X="" Q
"RTN","DIR",48,0)
 I X="",$D(DIRB) S X=DIRB I %T'="D",%B'["D"&%T W X
"RTN","DIR",49,0)
 I X'?.ANP S X="?"
"RTN","DIR",50,0)
 Q
"RTN","DIR",51,0)
 ;
"RTN","DIR",52,0)
QU I %E!(X="?")!($O(^DD(%B1,%B2,21,0))'>0) K %Y S A0="" D MSG S X1=$$HELP^DIALOGZ(%B1,%B2) D   I $D(^DD(%B1,%B2,12)) S X1=^(12) D  ;** FIELD HELP FOR A FIELD-TYPE QUESTION
"RTN","DIR",53,0)
 .S %J=75,%Y=1 D W1
"RTN","DIR",54,0)
 I $D(^DD(%B1,%B2,4)) S A0=^(4),A0(0)=1 D MSG
"RTN","DIR",55,0)
 I X?1"??".E D
"RTN","DIR",56,0)
 . I $D(DDS) N DDC,DDSQ S DDC=7
"RTN","DIR",57,0)
 . S A0="" D MSG S %C=0
"RTN","DIR",58,0)
 . F  S %C=$O(^DD(%B1,%B2,21,%C)) Q:'%C!$D(DDSQ)  S A0=^(%C,0) D
"RTN","DIR",59,0)
 .. I $D(DDS),$G(DDH),'(DDH#DDC) D LIST^DDSU Q:$D(DDSQ)
"RTN","DIR",60,0)
 .. D MSG
"RTN","DIR",61,0)
 I %B["P" K DO S DIC=U_$P(%B3,U,3),DIC(0)="M"_$E("L",%B'["'") D AST:%B["*",DQ
"RTN","DIR",62,0)
 I %B["D" S %DT=$P($P($P(%B3,U,5,99),"%DT=""",2),"""",1) D HELP^%DTC
"RTN","DIR",63,0)
FLDSET I %B["S" D
"RTN","DIR",64,0)
 .D SETSCR(%B1,%B2) S A0=$$EZBLD^DIALOG(8068)_" " D MSG
"RTN","DIR",65,0)
 .I $D(^DD(%B1,%B2,0)),$G(DUZ("LANG"))>1 N %B3 S $P(%B3,U,3)=$$SETIN^DIALOGZ
"RTN","DIR",66,0)
 .F %C=1:1 S Y=$P($P(%B3,U,3),";",%C) Q:Y=""  D
"RTN","DIR",67,0)
 ..S %I=$P(Y,":",2),Y=$P(Y,":") I 1 X:$D(DIC("S")) DIC("S") E  Q
"RTN","DIR",68,0)
 ..I $G(DDS),$G(DDSMOUSY) S DDH=$G(DDH)+1,DDH(DDH,"XT")="W ! D WRITMOUS("""_Y_""") W ""    "" D WRITMOUS("""_%I_""")" Q  ;MOUSE REMEMBERS SET VALUES
"RTN","DIR",69,0)
 ..S A0=Y_$E("         ",$L(Y)+1,999)_%I D MSG
"RTN","DIR",70,0)
 I %B["V" S A0="" D MSG S X1=X,DU=%B1,D=%B2,DZ=X D V^DIEQ S X=X1
"RTN","DIR",71,0)
 Q
"RTN","DIR",72,0)
 ;
"RTN","DIR",73,0)
AST F %=" D ^DIC"," D IX^DIC"," D MIX^DIC1" S Y=$F(%B3,%),%=$L(%)+1 Q:Y
"RTN","DIR",74,0)
 Q:'Y
"RTN","DIR",75,0)
 I $D(DDS) S A0=" " D MSG
"RTN","DIR",76,0)
 X $P($E(%B3,1,Y-%),U,5,99)
"RTN","DIR",77,0)
 Q
"RTN","DIR",78,0)
 ;
"RTN","DIR",79,0)
SETSCR(DIRFIL,DIRFLD) ;SET UP DIC("S")
"RTN","DIR",80,0)
 Q:'$D(^DD(DIRFIL,DIRFLD,12.1))
"RTN","DIR",81,0)
 X ^(12.1)
"RTN","DIR",82,0)
 Q:$G(DUZ("LANG"))'>1!'$D(DIC("S"))
"RTN","DIR",83,0)
 S DIC("S",1.007)=$P(^DD(DIRFIL,DIRFLD,0),U,3),DIC("S",0)=";"_$$SETIN^DIALOGZ,DIC("S",2.007)=DIC("S")
"RTN","DIR",84,0)
 S DIC("S")="N S,I S S=DIC(""S"",0),I=$L($E(S,1,$F(S,"";""_Y_"":"")),"";"")-1,S=$P($P(DIC(""S"",1.007),"";"",I),"":"") N Y S Y=S X DIC(""S"",2.007)"
"RTN","DIR",85,0)
 Q
"RTN","DIR",86,0)
 ;
"RTN","DIR",87,0)
 ;
"RTN","DIR",88,0)
DQ N %W K DICQRETV
"RTN","DIR",89,0)
 S:$D(D)[0 D="B" S (X1,DZ)=X D DQ^DICQ S DDSV=DIC K DD,% S:$D(X1) X=X1
"RTN","DIR",90,0)
 Q
"RTN","DIR",91,0)
 ;
"RTN","DIR",92,0)
QUES ;
"RTN","DIR",93,0)
 I %T D QU I $D(DICQRETV)!$D(DICQRETA) Q
"RTN","DIR",94,0)
 I X="??",$D(DIR("??")) D:$P(DIR("??"),U)]"" HF S:$P(DIR("??"),U,2)]"" A0(0)=1,A0=$P(DIR("??"),U,2,99) D:$P(DIR("??"),U,2)]"" MSG Q
"RTN","DIR",95,0)
 I X="??",%T="D" D  Q
"RTN","DIR",96,0)
 . N DIHELP,DIJUNK,DILINE,DIROOT
"RTN","DIR",97,0)
 . D DT^DILF(%DT,"?",.DIJUNK,"","DIROOT")
"RTN","DIR",98,0)
 . S A0="" D MSG
"RTN","DIR",99,0)
 . F DILINE=1:1:DIHELP S A0=DIROOT("DIHELP",DILINE) D MSG
"RTN","DIR",100,0)
 I %T="P" S DIC=%B1,DIC(0)=%B2 S:$D(DIR("S"))#2 DIC("S")=DIR("S") D DQ K DIC("S")
"RTN","DIR",101,0)
 I '%N S A0="" D MSG
"RTN","DIR",102,0)
 I X'["?" W $C(7)
"RTN","DIR",103,0)
 I %N S A0(0)=1,A0=$E(%W,2,999) D MSG
"RTN","DIR",104,0)
 D:'%N WRAP:%W]"" I %T["S",(%A["A"!(%A["B")) D S
"RTN","DIR",105,0)
 Q
"RTN","DIR",106,0)
 ;
"RTN","DIR",107,0)
WRAP I $D(DIR("?"))=11 F %I=1:1 Q:'$D(DIR("?",%I))  S A0=DIR("?",%I) D MSG
"RTN","DIR",108,0)
 K %Y S %J=$S($G(IOM,80)>6:$G(IOM,80)-6,IOM>1:IOM,1:2),%Y=1 S X1=$S(($D(DIR("?"))&'%N):DIR("?"),1:%W)
"RTN","DIR",109,0)
 I '%N,$D(DIR("?"))'=11,$E(X1,$L(X1))'="." S X1=X1_"."
"RTN","DIR",110,0)
W1 I $L(X1)<%J S %Y(%Y)=X1
"RTN","DIR",111,0)
 E  D  G W1
"RTN","DIR",112,0)
 . I $E(X1,1,%J-1)'?.E1P.E S %I=%J-1
"RTN","DIR",113,0)
 . E  F %I=%J-1:-1:1 Q:$E(X1,%I)?1P
"RTN","DIR",114,0)
 . S %Y(%Y)=$E(X1,1,%I),X1=$E(X1,%I+1,999),%Y=%Y+1
"RTN","DIR",115,0)
 F %I=1:1:%Y S A0=%Y(%I) D MSG
"RTN","DIR",116,0)
 I $D(DDS),%T="S" D
"RTN","DIR",117,0)
SET . S A0=$$EZBLD^DIALOG(8068) D MSG
"RTN","DIR",118,0)
 . F %I=1:1 Q:$P(%B,";",%I,999)=""  D
"RTN","DIR",119,0)
 .. S %Y=$P(%B,";",%I),Y=$P(%Y,":") Q:Y=""
"RTN","DIR",120,0)
 .. I $D(DIR("S"))#2 X DIR("S") E  Q
"RTN","DIR",121,0)
 ..I $G(DDS),$G(DDSMOUSY) S DDH=$G(DDH)+1,DDH(DDH,"XT")="D WRITMOUS("""_Y_""") W ""   "" D WRITMOUS("""_$P(%Y,":",2)_""")" Q  ;MOUSE REMEMBERS FORM-ONLY SET VALUE!
"RTN","DIR",122,0)
 .. S A0=Y_$J("",9-$L(Y))_$P(%Y,":",2) D MSG
"RTN","DIR",123,0)
 K %Y,%,X1
"RTN","DIR",124,0)
 Q
"RTN","DIR",125,0)
HF S XQH=$P(DIR("??"),U) N %A,%B,%E,DIR D EN1^XQH
"RTN","DIR",126,0)
 Q
"RTN","DIR",127,0)
MSG ;
"RTN","DIR",128,0)
 I $D(DDS),A0]"" D
"RTN","DIR",129,0)
 . S DDH=$G(DDH)+1
"RTN","DIR",130,0)
 . I $D(A0)>9 S DDH(DDH,"T")="",DDH=DDH+1,DDH(DDH,"X")=A0
"RTN","DIR",131,0)
 . E  S DDH(DDH,"T")=A0
"RTN","DIR",132,0)
 I '$D(DDS),$D(A0)>9 W:$X ! X A0
"RTN","DIR",133,0)
 I '$D(DDS),$D(A0)=1 W !,A0
"RTN","DIR",134,0)
 K A0
"RTN","DIR",135,0)
 Q
"RTN","DIR",136,0)
S W:$G(X)'?1."?"!(%A["A") !
"RTN","DIR",137,0)
 I $D(DIR("L"))#2 D
"RTN","DIR",138,0)
 . I $D(DIR("L"))=11 F %=0:0 S %=$O(DIR("L",%)) Q:%'>0  W !,DIR("L",%)
"RTN","DIR",139,0)
 . W !,DIR("L")
"RTN","DIR",140,0)
 E  I %B'[":",$O(DIR("C",""))]"" D
"RTN","DIR",141,0)
 . W !?5,$$EZBLD^DIALOG(8046),! ;**
"RTN","DIR",142,0)
 . S %I="" F  S %I=$O(DIR("C",%I)) Q:%I=""  D
"RTN","DIR",143,0)
 .. S Y=$P(DIR("C",%I),":")
"RTN","DIR",144,0)
 .. I $D(DIR("S"))#2 X DIR("S") E  Q
"RTN","DIR",145,0)
 .. W !?10,Y,?20,$P(DIR("C",%I),":",2)
"RTN","DIR",146,0)
 E  D
"RTN","DIR",147,0)
 . W !?5,$$EZBLD^DIALOG(8046),! ;**
"RTN","DIR",148,0)
 . F %I=1:1 Q:$P(%B,";",%I,999)=""  D
"RTN","DIR",149,0)
 .. S Y=$P($P(%B,";",%I),":") Q:'$L($P(%B,";",%I,999))
"RTN","DIR",150,0)
 .. I $D(DIR("S"))#2 X DIR("S") E  Q
"RTN","DIR",151,0)
 .. W !?10,Y,?20,$P($P(%B,";",%I),":",2)
"RTN","DIR",152,0)
 W:%A'["A" !
"RTN","DIR",153,0)
 Q
"RTN","DIR",154,0)
Q G ^DIRQ
"RTN","DIR",155,0)
 ;
"RTN","DIR",156,0)
 ;#8068  Choose from
"VER")
8.0^22.2
"BLD",9891,6)
^3
**END**
**END**

