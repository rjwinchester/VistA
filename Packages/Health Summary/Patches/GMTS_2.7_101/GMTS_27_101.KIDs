KIDS Distribution saved on Dec 12, 2013@08:43:34
GMTS*2.7*101
**KIDS**:GMTS*2.7*101^

**INSTALL NAME**
GMTS*2.7*101
"BLD",8329,0)
GMTS*2.7*101^HEALTH SUMMARY^0^3131212^y
"BLD",8329,4,0)
^9.64PA^^
"BLD",8329,6.3)
12
"BLD",8329,"ABPKG")
n
"BLD",8329,"KRN",0)
^9.67PA^779.2^20
"BLD",8329,"KRN",.4,0)
.4
"BLD",8329,"KRN",.401,0)
.401
"BLD",8329,"KRN",.402,0)
.402
"BLD",8329,"KRN",.403,0)
.403
"BLD",8329,"KRN",.5,0)
.5
"BLD",8329,"KRN",.84,0)
.84
"BLD",8329,"KRN",3.6,0)
3.6
"BLD",8329,"KRN",3.8,0)
3.8
"BLD",8329,"KRN",9.2,0)
9.2
"BLD",8329,"KRN",9.8,0)
9.8
"BLD",8329,"KRN",9.8,"NM",0)
^9.68A^7^7
"BLD",8329,"KRN",9.8,"NM",1,0)
GMTSDGA^^0^B11914941
"BLD",8329,"KRN",9.8,"NM",2,0)
GMTSDGC1^^0^B15467864
"BLD",8329,"KRN",9.8,"NM",3,0)
GMTSPXU1^^0^B17119835
"BLD",8329,"KRN",9.8,"NM",4,0)
GMTSPXOP^^0^B51940559
"BLD",8329,"KRN",9.8,"NM",5,0)
GMTSDGC2^^0^B7198971
"BLD",8329,"KRN",9.8,"NM",6,0)
GMTSDGP^^0^B12132145
"BLD",8329,"KRN",9.8,"NM",7,0)
GMTSPLST^^0^B49938082
"BLD",8329,"KRN",9.8,"NM","B","GMTSDGA",1)

"BLD",8329,"KRN",9.8,"NM","B","GMTSDGC1",2)

"BLD",8329,"KRN",9.8,"NM","B","GMTSDGC2",5)

"BLD",8329,"KRN",9.8,"NM","B","GMTSDGP",6)

"BLD",8329,"KRN",9.8,"NM","B","GMTSPLST",7)

"BLD",8329,"KRN",9.8,"NM","B","GMTSPXOP",4)

"BLD",8329,"KRN",9.8,"NM","B","GMTSPXU1",3)

"BLD",8329,"KRN",19,0)
19
"BLD",8329,"KRN",19,"NM",0)
^9.68A^^
"BLD",8329,"KRN",19.1,0)
19.1
"BLD",8329,"KRN",101,0)
101
"BLD",8329,"KRN",409.61,0)
409.61
"BLD",8329,"KRN",771,0)
771
"BLD",8329,"KRN",779.2,0)
779.2
"BLD",8329,"KRN",870,0)
870
"BLD",8329,"KRN",8989.51,0)
8989.51
"BLD",8329,"KRN",8989.52,0)
8989.52
"BLD",8329,"KRN",8994,0)
8994
"BLD",8329,"KRN","B",.4,.4)

"BLD",8329,"KRN","B",.401,.401)

"BLD",8329,"KRN","B",.402,.402)

"BLD",8329,"KRN","B",.403,.403)

"BLD",8329,"KRN","B",.5,.5)

"BLD",8329,"KRN","B",.84,.84)

"BLD",8329,"KRN","B",3.6,3.6)

"BLD",8329,"KRN","B",3.8,3.8)

"BLD",8329,"KRN","B",9.2,9.2)

"BLD",8329,"KRN","B",9.8,9.8)

"BLD",8329,"KRN","B",19,19)

"BLD",8329,"KRN","B",19.1,19.1)

"BLD",8329,"KRN","B",101,101)

"BLD",8329,"KRN","B",409.61,409.61)

"BLD",8329,"KRN","B",771,771)

"BLD",8329,"KRN","B",779.2,779.2)

"BLD",8329,"KRN","B",870,870)

"BLD",8329,"KRN","B",8989.51,8989.51)

"BLD",8329,"KRN","B",8989.52,8989.52)

"BLD",8329,"KRN","B",8994,8994)

"BLD",8329,"QUES",0)
^9.62^^
"BLD",8329,"REQB",0)
^9.611^8^8
"BLD",8329,"REQB",1,0)
ICD*18.0*57^2
"BLD",8329,"REQB",2,0)
LEX*2.0*80^2
"BLD",8329,"REQB",3,0)
DG*5.3*850^2
"BLD",8329,"REQB",4,0)
PX*1.0*199^2
"BLD",8329,"REQB",5,0)
SR*3.0*177^2
"BLD",8329,"REQB",6,0)
GMPL*2.0*42^2
"BLD",8329,"REQB",7,0)
GMTS*2.7*86^2
"BLD",8329,"REQB",8,0)
GMTS*2.7*76^2
"BLD",8329,"REQB","B","DG*5.3*850",3)

"BLD",8329,"REQB","B","GMPL*2.0*42",6)

"BLD",8329,"REQB","B","GMTS*2.7*76",8)

"BLD",8329,"REQB","B","GMTS*2.7*86",7)

"BLD",8329,"REQB","B","ICD*18.0*57",1)

"BLD",8329,"REQB","B","LEX*2.0*80",2)

"BLD",8329,"REQB","B","PX*1.0*199",4)

"BLD",8329,"REQB","B","SR*3.0*177",5)

"MBREQ")
0
"PKG",160,-1)
1^1
"PKG",160,0)
HEALTH SUMMARY^GMTS^Integrated Health Summary Tools
"PKG",160,20,0)
^9.402P^^
"PKG",160,22,0)
^9.49I^1^1
"PKG",160,22,1,0)
2.7^2951020^2951219
"PKG",160,22,1,"PAH",1,0)
101^3131212^48
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
7
"RTN","GMTSDGA")
0^1^B11914941
"RTN","GMTSDGA",1,0)
GMTSDGA ; SLC/MKB,KER/NDBI - Admissions for HS ;12/12/13  08:40
"RTN","GMTSDGA",2,0)
 ;;2.7;Health Summary;**28,49,71,101**;Oct 20, 1995;Build 12
"RTN","GMTSDGA",3,0)
 ;
"RTN","GMTSDGA",4,0)
 ; External Reference
"RTN","GMTSDGA",5,0)
 ;   DBIA  3390  $$ICDDX^ICDCODE
"RTN","GMTSDGA",6,0)
 ;   DBIA    17  ^DGPM("ATID"
"RTN","GMTSDGA",7,0)
 ;   DBIA  1372  ^DGPT(
"RTN","GMTSDGA",8,0)
 ;   DBIA 10082  ^ICD9(
"RTN","GMTSDGA",9,0)
 ;   DBIA  2929  DSP^A7RHSM
"RTN","GMTSDGA",10,0)
 ;   DBIA  2929  LST^A7RHSM
"RTN","GMTSDGA",11,0)
 ;   DBIA   512  ^DGPMLOS
"RTN","GMTSDGA",12,0)
 ;   DBIA 10061  IN5^VADPT
"RTN","GMTSDGA",13,0)
 ;   DBIA 10061  KVAR^VADPT
"RTN","GMTSDGA",14,0)
 ;
"RTN","GMTSDGA",15,0)
ENAD ; Gets Admission Information
"RTN","GMTSDGA",16,0)
 S TT=1,FLGDX=0,FLGDC=0
"RTN","GMTSDGA",17,0)
 D PATINFO Q
"RTN","GMTSDGA",18,0)
ENDC ; Discharge Information
"RTN","GMTSDGA",19,0)
 S TT=3,FLGDC=1,FLGDX=0
"RTN","GMTSDGA",20,0)
 D PATINFO Q
"RTN","GMTSDGA",21,0)
ENDX ; PTF Discharge Diagnosis
"RTN","GMTSDGA",22,0)
 S TT=3,FLGDX=1,FLGDC=0
"RTN","GMTSDGA",23,0)
 D PATINFO Q
"RTN","GMTSDGA",24,0)
ENTS ; Treating Speciality Information
"RTN","GMTSDGA",25,0)
 S TT=6,FLGDX=0,FLGDC=0
"RTN","GMTSDGA",26,0)
 D PATINFO Q
"RTN","GMTSDGA",27,0)
ENTR ; Transfers
"RTN","GMTSDGA",28,0)
 S TT=2,FLGDX=0,FLGDC=0
"RTN","GMTSDGA",29,0)
 D PATINFO Q
"RTN","GMTSDGA",30,0)
PATINFO ; Patient Information
"RTN","GMTSDGA",31,0)
 S VA200=1 K DIQ
"RTN","GMTSDGA",32,0)
 I $D(GMTSNDM),GMTSNDM>0 S CNTR=GMTSNDM
"RTN","GMTSDGA",33,0)
 E  S CNTR=100
"RTN","GMTSDGA",34,0)
 S GMC=-1,GMN="",ADM=GMTS1,FLAG=0
"RTN","GMTSDGA",35,0)
 I TT=1 D FADM^GMTSDGA2
"RTN","GMTSDGA",36,0)
 D:$$ROK^GMTSU("A7RHSM")&($$NDBI^GMTSU) LST^A7RHSM(DFN,.A7RHS)
"RTN","GMTSDGA",37,0)
 F  S ADM=$O(^DGPM("ATID"_TT,DFN,ADM)) D:$$ROK^GMTSU("A7RHSM")&($$NDBI^GMTSU) DSP^A7RHSM(ADM) Q:('ADM!(ADM>GMTS2)!($D(GMTSQIT)))  D GET Q:$D(GMTSQIT)!($G(CNTR)<0)
"RTN","GMTSDGA",38,0)
 D KILLADM K:$$NDBI^GMTSU A7RHS
"RTN","GMTSDGA",39,0)
 Q
"RTN","GMTSDGA",40,0)
GET ; Admission Data
"RTN","GMTSDGA",41,0)
 N VAHOW
"RTN","GMTSDGA",42,0)
 S ADA=$O(^DGPM("ATID"_TT,DFN,ADM,0)) Q:'ADA
"RTN","GMTSDGA",43,0)
 S CNTR=CNTR-1 I CNTR<0 Q
"RTN","GMTSDGA",44,0)
 S VAIP("E")=ADA D IN5^VADPT
"RTN","GMTSDGA",45,0)
 S (X,ADATE)=+VAIP(3) D REGDT4^GMTSU S ADT=X
"RTN","GMTSDGA",46,0)
 K DGPMIFN S:TT=1 DGPMIFN=ADA S:TT'=1 DGPMIFN=VAIP(13)
"RTN","GMTSDGA",47,0)
 S GMC=2
"RTN","GMTSDGA",48,0)
 D CONTGET
"RTN","GMTSDGA",49,0)
 S LIN=$S(TT=2:"TROUT^GMTSDGA1",FLGDX:"DXOUT^GMTSDGA1",FLGDC:"DCOUT^GMTSDGA1",TT=6:"TSOUT^GMTSDGA2",TT=1:"ADOUT^GMTSDGA1") D @LIN
"RTN","GMTSDGA",50,0)
 K ICD(ADM)
"RTN","GMTSDGA",51,0)
 Q
"RTN","GMTSDGA",52,0)
CONTGET ; ICD and LOS info only needed for certain MAS components
"RTN","GMTSDGA",53,0)
 Q:TT=2  Q:TT=6  N ICDX,ICDI I DGPMIFN D ^DGPMLOS S LOS=+X
"RTN","GMTSDGA",54,0)
 N GMTSDATE S GMTSDATE=9999999.9999999-ADM
"RTN","GMTSDGA",55,0)
 S PTF=$S($D(VAIP(12)):VAIP(12),1:"") Q:PTF=""  Q:'$D(^DGPT(PTF,70))
"RTN","GMTSDGA",56,0)
 S ICD=^DGPT(PTF,70)
"RTN","GMTSDGA",57,0)
 S ICDI=+$P(ICD,U,11) I ICDI>0 D
"RTN","GMTSDGA",58,0)
 . ;S ICDX=$$ICDDX^ICDCODE(ICDI)
"RTN","GMTSDGA",59,0)
 . S ICDX=$$ICDDATA^ICDXCODE("DIAG",ICDI,GMTSDATE)
"RTN","GMTSDGA",60,0)
 . S ICD(ADM,1,80,ICDI,.01)=$P(ICDX,"^",2)_"("_$$GETICDCD^GMTSPXU1(GMTSDATE,"DIAG")_")"
"RTN","GMTSDGA",61,0)
 . S ICD(ADM,1,80,ICDI,3)=$P(ICDX,"^",4)
"RTN","GMTSDGA",62,0)
 S ICDI=+$P(ICD,U,10) I ICDI>0 D
"RTN","GMTSDGA",63,0)
 . ;S ICDX=$$ICDDX^ICDCODE(ICDI)
"RTN","GMTSDGA",64,0)
 . S ICDX=$$ICDDATA^ICDXCODE("DIAG",ICDI,GMTSDATE)
"RTN","GMTSDGA",65,0)
 . S ICD(ADM,2,80,ICDI,.01)=$P(ICDX,"^",2)_"("_$$GETICDCD^GMTSPXU1(GMTSDATE,"DIAG")_")"
"RTN","GMTSDGA",66,0)
 . S ICD(ADM,2,80,ICDI,3)=$P(ICDX,"^",4)
"RTN","GMTSDGA",67,0)
 F GMTSI=16:1:24 S ICDI=+$P(ICD,U,GMTSI) I ICDI>0 D
"RTN","GMTSDGA",68,0)
 . ;S ICDX=$$ICDDX^ICDCODE(ICDI)
"RTN","GMTSDGA",69,0)
 . S ICDX=$$ICDDATA^ICDXCODE("DIAG",ICDI,GMTSDATE)
"RTN","GMTSDGA",70,0)
 . S ICD(ADM,(GMTSI-13),80,ICDI,.01)=$P(ICDX,"^",2)_"("_$$GETICDCD^GMTSPXU1(GMTSDATE,"DIAG")_")"
"RTN","GMTSDGA",71,0)
 . S ICD(ADM,(GMTSI-13),80,ICDI,3)=$P(ICDX,"^",4)
"RTN","GMTSDGA",72,0)
 Q
"RTN","GMTSDGA",73,0)
KILLADM ; Kill Admission variables
"RTN","GMTSDGA",74,0)
 D KVAR^VADPT
"RTN","GMTSDGA",75,0)
 K ADA,ADATE,ADT,BD,BDSC,DA,DIC,DDT,DP,DSPL,GMJ,GMJ1,OP,OPTR,FLAG,FLGDX,FLGDC,X,DR,GMI,GMTO,GMTNO,GMTSI,GMX,ADM,CNTR,GMC,GMZ,GMN,ICD,PTF,PTF70,PTFLG,LOS,II,DGPMIFN,IN,LIN,TI,TT,TS,SPEC
"RTN","GMTSDGA",76,0)
 Q
"RTN","GMTSDGC1")
0^2^B15467864
"RTN","GMTSDGC1",1,0)
GMTSDGC1 ; SLC/KER/SBW - Subroutines for Ext ADT Hist    ;03/15/12  08:27
"RTN","GMTSDGC1",2,0)
 ;;2.7;Health Summary;**5,35,47,71,101**;Oct 20, 1995;Build 12
"RTN","GMTSDGC1",3,0)
 ;
"RTN","GMTSDGC1",4,0)
 ; External References
"RTN","GMTSDGC1",5,0)
 ;   DBIA  3390  $$ICDDX^ICDCODE
"RTN","GMTSDGC1",6,0)
 ;   DBIA    17  ^DGPM(
"RTN","GMTSDGC1",7,0)
 ;   DBIA  1372  ^DGPT( fields 71,73,75 Read w/Fileman
"RTN","GMTSDGC1",8,0)
 ;   DBIA   512  ^DGPMLOS
"RTN","GMTSDGC1",9,0)
 ;   DBIA 10015  EN^DIQ1 (file #45)
"RTN","GMTSDGC1",10,0)
 ;   DBIA 10011  ^DIWP
"RTN","GMTSDGC1",11,0)
 ;
"RTN","GMTSDGC1",12,0)
OTHER(DFN,PTF,CODE,GMVAIP,MDA) ; Additional data to include
"RTN","GMTSDGC1",13,0)
 N LOS,ICD,DGPMIFN,GMI,GMX,NODIAG,GMTO,GMTNO,BD,BDSC,ATTN,WARD,AWS
"RTN","GMTSDGC1",14,0)
 N DP,DSPL,OP,OPTR
"RTN","GMTSDGC1",15,0)
 I CODE=1 D  Q  ;Other data for Admission entries
"RTN","GMTSDGC1",16,0)
 . Q:$G(GMVAIP("DN",1))'=""
"RTN","GMTSDGC1",17,0)
 . D GETDATA
"RTN","GMTSDGC1",18,0)
 . I $G(GMVAIP("MF"))]"" D CKP^GMTSUP Q:$D(GMTSQIT)  W ?12,"Adm. Diag: ",GMVAIP("MF")
"RTN","GMTSDGC1",19,0)
 . W ?64,"LOS: ",LOS,!
"RTN","GMTSDGC1",20,0)
 . Q:'$D(ICD)
"RTN","GMTSDGC1",21,0)
 . S GMI=0
"RTN","GMTSDGC1",22,0)
 . F  S GMI=$O(ICD(GMI)) Q:'GMI  D CKP^GMTSUP Q:$D(GMTSQIT)  S GMX="" F  S GMX=$O(ICD(GMI,80,GMX)) Q:'GMX  D NXTICD
"RTN","GMTSDGC1",23,0)
 I CODE=2 D  Q  ;Other data for Transfer entries
"RTN","GMTSDGC1",24,0)
 . N TRFAC
"RTN","GMTSDGC1",25,0)
 . S TRFAC=$P(^DGPM(MDA,0),U,5)
"RTN","GMTSDGC1",26,0)
 . I $P($G(GMVAIP("WL")),U,2)]"" D CKP^GMTSUP Q:$D(GMTSQIT)  W ?19,$S($P(VAIP("MT"),U,2)'["TO":"To ",1:""),$P(VAIP("WL"),U,2),$S($L(TRFAC):"  at "_TRFAC,1:""),!
"RTN","GMTSDGC1",27,0)
 I CODE=3 D  Q  ;Other data for Discharge entries
"RTN","GMTSDGC1",28,0)
 . ; Discharge data
"RTN","GMTSDGC1",29,0)
 . D GETDATA
"RTN","GMTSDGC1",30,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  W ?11,"Bedsection: ",BDSC,?64,"LOS: ",LOS,!
"RTN","GMTSDGC1",31,0)
 . S NODIAG=1,GMI=0
"RTN","GMTSDGC1",32,0)
 . F  S GMI=$O(ICD(GMI)) Q:GMI'>0  S GMX=0 F  S GMX=$O(ICD(GMI,80,GMX)) Q:GMX'>0  D NXTICD
"RTN","GMTSDGC1",33,0)
 . I NODIAG D CKP^GMTSUP Q:$D(GMTSQIT)  D
"RTN","GMTSDGC1",34,0)
 . . W ?7,"Principal Diag: No discharge diagnosis available.",!
"RTN","GMTSDGC1",35,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  W ?4,"Disposition Place: ",DSPL,!
"RTN","GMTSDGC1",36,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  W ?4,"Outpat. Treatment: ",OPTR,!
"RTN","GMTSDGC1",37,0)
 . I 'GMTSNPG D CKP^GMTSUP Q:$D(GMTSQIT)  W !
"RTN","GMTSDGC1",38,0)
 I CODE=6 D  Q  ;Other data for Treating Specialty entries
"RTN","GMTSDGC1",39,0)
 . N DIWL,DIWF,DIWR,GMJ,GMJ1
"RTN","GMTSDGC1",40,0)
 . K ^UTILITY($J,"W")
"RTN","GMTSDGC1",41,0)
 . S DIWL=22,DIWR=78,DIWF="C56"
"RTN","GMTSDGC1",42,0)
 . I $D(^DGPM(MDA,"DX")) D
"RTN","GMTSDGC1",43,0)
 . . F GMJ=1:1:$P(^DGPM(MDA,"DX",0),"^",4) S X=^DGPM(MDA,"DX",GMJ,0) D ^DIWP
"RTN","GMTSDGC1",44,0)
 . I $D(^UTILITY($J,"W")) D
"RTN","GMTSDGC1",45,0)
 . . S GMJ=$O(^UTILITY($J,"W",0)) Q:'GMJ
"RTN","GMTSDGC1",46,0)
 . . D CKP^GMTSUP Q:$D(GMTSQIT)  W ?14,"TS Diag: "
"RTN","GMTSDGC1",47,0)
 . . S GMJ1=0
"RTN","GMTSDGC1",48,0)
 . . F  S GMJ1=$O(^UTILITY($J,"W",GMJ,GMJ1)) Q:'GMJ1  D CKP^GMTSUP Q:$D(GMTSQIT)  W ?23,^UTILITY($J,"W",GMJ,GMJ1,0),!
"RTN","GMTSDGC1",49,0)
 . K ^UTILITY($J,"W")
"RTN","GMTSDGC1",50,0)
 Q
"RTN","GMTSDGC1",51,0)
GETDATA ; Gets LOS, ICD and bedsection data
"RTN","GMTSDGC1",52,0)
 N DIC,DR,DA,DIQ,GMTSI,X,PTFA,GMTSDATE
"RTN","GMTSDGC1",53,0)
 S DGPMIFN=$G(GMVAIP("AN"))
"RTN","GMTSDGC1",54,0)
 I DGPMIFN D ^DGPMLOS S LOS=+X
"RTN","GMTSDGC1",55,0)
 I '$D(^DGPT(PTF,70)) D  Q
"RTN","GMTSDGC1",56,0)
 . S (BDSC,DSPL,OPTR)="UNKNOWN"
"RTN","GMTSDGC1",57,0)
 S DIC=45,DA=+PTF,DR="71;73;75;",DIQ="PTFA(" D EN^DIQ1
"RTN","GMTSDGC1",58,0)
 S BDSC=$S(PTFA(45,+DA,71)]"":PTFA(45,+DA,71),1:"UNKNOWN")
"RTN","GMTSDGC1",59,0)
 S OPTR=$S(PTFA(45,+DA,73)]"":PTFA(45,+DA,73),1:"UNKNOWN")
"RTN","GMTSDGC1",60,0)
 S DSPL=$S(PTFA(45,+DA,75)]"":PTFA(45,+DA,75),1:"UNKNOWN")
"RTN","GMTSDGC1",61,0)
 S ICD=^DGPT(PTF,70),DIC=80,DR=".01;3"
"RTN","GMTSDGC1",62,0)
 S GMTSDATE=$P(ICD,U)
"RTN","GMTSDGC1",63,0)
 S ICDI=+$P(ICD,U,10) I +ICDI>0 D
"RTN","GMTSDGC1",64,0)
 . ;S ICDX=$$ICDDX^ICDCODE(ICDI)
"RTN","GMTSDGC1",65,0)
 . S ICDX=$$ICDDATA^ICDXCODE("DIAG",ICDI,GMTSDATE)
"RTN","GMTSDGC1",66,0)
 . S ICD(1,80,ICDI,.01)=$P(ICDX,"^",2)_"("_$$GETICDCD^GMTSPXU1(GMTSDATE,"DIAG")_")"
"RTN","GMTSDGC1",67,0)
 . S ICD(1,80,ICDI,3)=$P(ICDX,"^",4)
"RTN","GMTSDGC1",68,0)
 S ICDI=+$P(ICD,U,11) Q:+ICDI'>0
"RTN","GMTSDGC1",69,0)
 ;S ICDX=$$ICDDX^ICDCODE(ICDI)
"RTN","GMTSDGC1",70,0)
 S ICDX=$$ICDDATA^ICDXCODE("DIAG",ICDI,GMTSDATE)
"RTN","GMTSDGC1",71,0)
 S ICD(2,80,ICDI,.01)=$P(ICDX,"^",2)_"("_$$GETICDCD^GMTSPXU1(GMTSDATE,"DIAG")_")"
"RTN","GMTSDGC1",72,0)
 S ICD(2,80,ICDI,3)=$P(ICDX,"^",4)
"RTN","GMTSDGC1",73,0)
 F GMTSI=16:1:24 S ICDI=+$P(ICD,U,GMTSI) I ICDI>0 D
"RTN","GMTSDGC1",74,0)
 . ;S ICDX=$$ICDDX^ICDCODE(ICDI)
"RTN","GMTSDGC1",75,0)
 . S ICDX=$$ICDDATA^ICDXCODE("DIAG",ICDI,GMTSDATE)
"RTN","GMTSDGC1",76,0)
 . S ICD((GMTSI-13),80,ICDI,.01)=$P(ICDX,"^",2)_"("_$$GETICDCD^GMTSPXU1(GMTSDATE,"DIAG")_")"
"RTN","GMTSDGC1",77,0)
 . S ICD((GMTSI-13),80,ICDI,3)=$P(ICDX,"^",4)
"RTN","GMTSDGC1",78,0)
 Q
"RTN","GMTSDGC1",79,0)
NXTICD ; Print the next ICD
"RTN","GMTSDGC1",80,0)
 S (GMTO,GMTNO)="" S GMTO=$G(ICD(GMI,80,GMX,3)),GMTNO=$G(ICD(GMI,80,GMX,.01))
"RTN","GMTSDGC1",81,0)
 W:GMI=1 ?7,"Principal Diag: "
"RTN","GMTSDGC1",82,0)
 W:GMI=2 ?17,"DXLS: "
"RTN","GMTSDGC1",83,0)
 W:GMI=3 ?15,"ICD DX: "
"RTN","GMTSDGC1",84,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W ?23,GMTO,?65,GMTNO,!
"RTN","GMTSDGC1",85,0)
 S NODIAG=0
"RTN","GMTSDGC1",86,0)
 Q
"RTN","GMTSDGC2")
0^5^B7198971
"RTN","GMTSDGC2",1,0)
GMTSDGC2 ; SLC/SBW,KER - Extended ADT Hist (cont) ;09/20/12  09:55
"RTN","GMTSDGC2",2,0)
 ;;2.7;Health Summary;**28,49,71,101**;Oct 20, 1995;Build 12
"RTN","GMTSDGC2",3,0)
 ;
"RTN","GMTSDGC2",4,0)
 ; External References
"RTN","GMTSDGC2",5,0)
 ;   DBIA  1372  ^DGPT(
"RTN","GMTSDGC2",6,0)
 ;   DBIA  3390  $$ICDOP^ICDCODE
"RTN","GMTSDGC2",7,0)
 ;
"RTN","GMTSDGC2",8,0)
ICDP(DFN,PTF) ; Module For History of PTF Procedures
"RTN","GMTSDGC2",9,0)
 Q:'$D(^DGPT(PTF,"P"))
"RTN","GMTSDGC2",10,0)
 N II,PRX,X,IX,GMP,GTA,O,O1,LN1
"RTN","GMTSDGC2",11,0)
 S II=0
"RTN","GMTSDGC2",12,0)
 F  S II=$O(^DGPT(PTF,"P",II)) Q:'II  S PRX=^DGPT(PTF,"P",II,0),X=$P(PRX,U,1),IX=9999999-X D REGDT4^GMTSU D
"RTN","GMTSDGC2",13,0)
 . N GMTSDATE S GMTSDATE=$P(PRX,U,1)
"RTN","GMTSDGC2",14,0)
 . S GMP(IX)="Procedure "_X F GTA=5:1:9 D
"RTN","GMTSDGC2",15,0)
 . . N ICDP,ICDI,ICDX Q:$P(PRX,U,GTA)=""
"RTN","GMTSDGC2",16,0)
 . . S ICDI=+($P(PRX,U,GTA)) Q:+ICDI'>0
"RTN","GMTSDGC2",17,0)
 . . ;S ICDX=$$ICDOP^ICDCODE(+ICDI)
"RTN","GMTSDGC2",18,0)
 . . S ICDX=$$ICDDATA^ICDXCODE("PROC",+ICDI,GMTSDATE)
"RTN","GMTSDGC2",19,0)
 . . S ICDP(80.1,ICDI,.01)=$P(ICDX,"^",2)
"RTN","GMTSDGC2",20,0)
 . . S ICDP(80.1,ICDI,4)=$P(ICDX,"^",5)
"RTN","GMTSDGC2",21,0)
 . . I $D(ICDP(80.1,ICDI)) D
"RTN","GMTSDGC2",22,0)
 . . . S GMP(IX,GTA)=$E(ICDP(80.1,ICDI,4),1,45)_U_ICDP(80.1,ICDI,.01)_"("_$$GETICDCD^GMTSPXU1(GMTSDATE,"PROC")_")"
"RTN","GMTSDGC2",23,0)
 I $D(GMP) S O=0 F  S O=$O(GMP(O)) Q:O=""  D
"RTN","GMTSDGC2",24,0)
 . S O1=0,LN1=1
"RTN","GMTSDGC2",25,0)
 . F  S O1=$O(GMP(O,O1)) Q:O1=""  D CKP^GMTSUP Q:$D(GMTSQIT)  S:GMTSNPG LN1=1 W:LN1 ?2,GMP(O) W ?23,$P(GMP(O,O1),U),?68,$P(GMP(O,O1),U,2),! S LN1=0
"RTN","GMTSDGC2",26,0)
 Q
"RTN","GMTSDGC2",27,0)
ICDS(DFN,PTF) ; Module for history of PTF surgery episodes
"RTN","GMTSDGC2",28,0)
 Q:'$D(^DGPT(PTF,"S"))
"RTN","GMTSDGC2",29,0)
 N II,SURG,X,IX,GMS,GMA,O,O1,LN1
"RTN","GMTSDGC2",30,0)
 S II=0
"RTN","GMTSDGC2",31,0)
 F  S II=$O(^DGPT(PTF,"S",II)) Q:'II  S SURG=^DGPT(PTF,"S",II,0),X=$P(SURG,U,1),IX=9999999-X D REGDT4^GMTSU D
"RTN","GMTSDGC2",32,0)
 . N GMTSDATE S GMTSDATE=$P(SURG,U,1)
"RTN","GMTSDGC2",33,0)
 . ;   Load Surgery entries into GMS array in inverted sequence
"RTN","GMTSDGC2",34,0)
 . S GMS(IX)="  Surgery "_X F GMA=8:1:12 D
"RTN","GMTSDGC2",35,0)
 . . ;   Surgery Line
"RTN","GMTSDGC2",36,0)
 . . N ICDS,ICDI,ICDX
"RTN","GMTSDGC2",37,0)
 . . S ICDI=+($P(SURG,U,GMA)) Q:+ICDI'>0
"RTN","GMTSDGC2",38,0)
 . . ;S ICDX=$$ICDOP^ICDCODE(+ICDI)
"RTN","GMTSDGC2",39,0)
 . . S ICDX=$$ICDDATA^ICDXCODE("PROC",+ICDI,GMTSDATE)
"RTN","GMTSDGC2",40,0)
 . . S ICDS(80.1,ICDI,.01)=$P(ICDX,"^",2)_"("_$$GETICDCD^GMTSPXU1(GMTSDATE,"PROC")_")"
"RTN","GMTSDGC2",41,0)
 . . S ICDS(80.1,ICDI,4)=$P(ICDX,"^",5)
"RTN","GMTSDGC2",42,0)
 . . I $D(ICDS(80.1,ICDI)) S GMS(IX,GMA)=$E(ICDS(80.1,ICDI,4),1,45)_U_ICDS(80.1,ICDI,.01)
"RTN","GMTSDGC2",43,0)
 I $D(GMS) S O=0 F  S O=$O(GMS(O)) Q:O=""  D
"RTN","GMTSDGC2",44,0)
 . S O1=0,LN1=1
"RTN","GMTSDGC2",45,0)
 . F  S O1=$O(GMS(O,O1)) Q:O1=""  D CKP^GMTSUP Q:$D(GMTSQIT)  S:GMTSNPG LN1=1 W:LN1 ?2,GMS(O) W ?23,$P(GMS(O,O1),U),?65,$P(GMS(O,O1),U,2),! S LN1=0
"RTN","GMTSDGC2",46,0)
 Q
"RTN","GMTSDGP")
0^6^B12132145
"RTN","GMTSDGP",1,0)
GMTSDGP ; SLC/TRS,KER/NDBI - PTF Surgeries/Procedures ;09/20/12  09:45
"RTN","GMTSDGP",2,0)
 ;;2.7;Health Summary;**28,49,60,71,101**;Oct 20, 1995;Build 12
"RTN","GMTSDGP",3,0)
 ;
"RTN","GMTSDGP",4,0)
 ; External References
"RTN","GMTSDGP",5,0)
 ;   DBIA  3390  $$ICDOP^ICDCODE
"RTN","GMTSDGP",6,0)
 ;   DBIA  1372  ^DGPT(
"RTN","GMTSDGP",7,0)
 ;   DBIA  1372  ^DGPT("B"
"RTN","GMTSDGP",8,0)
 ;   DBIA  2929  OPC^A7RHSM
"RTN","GMTSDGP",9,0)
 ;   DBIA  2929  PRC^A7RHSM
"RTN","GMTSDGP",10,0)
 ;
"RTN","GMTSDGP",11,0)
ENS ; Module For History of PTF Surgery Episodes
"RTN","GMTSDGP",12,0)
 I $D(GMTSNDM),GMTSNDM>0 S CNTR=GMTSNDM
"RTN","GMTSDGP",13,0)
 E  S CNTR=100
"RTN","GMTSDGP",14,0)
 S T1=GMTSEND,T2=GMTSBEG,GMCZ=0
"RTN","GMTSDGP",15,0)
 S PTF=0
"RTN","GMTSDGP",16,0)
 F  S PTF=$O(^DGPT("B",DFN,PTF)) Q:PTF=""  D ICDS
"RTN","GMTSDGP",17,0)
 D:$$ROK^GMTSU("A7RHSM")&($$NDBI^GMTSU) OPC^A7RHSM
"RTN","GMTSDGP",18,0)
 I $D(GMS) S O=0 F I=1:1 S O=$O(GMS(O)) Q:O=""  Q:'CNTR  S CNTR=CNTR-1 S O1=0,LN1=1 F I=1:1 S O1=$O(GMS(O,O1)) Q:O1=""  D CKP^GMTSUP Q:$D(GMTSQIT)  S:GMTSNPG LN1=1 W:LN1 GMS(O) W ?21,$P(GMS(O,O1),U),?60,$P(GMS(O,O1),U,2),! S LN1=0
"RTN","GMTSDGP",19,0)
 D KILLADM Q
"RTN","GMTSDGP",20,0)
ICDS ;   ICD Surgery
"RTN","GMTSDGP",21,0)
 N GMCZ,GMA,D0,DA,DR,DIC,II,IX,SURG,ZI Q:'$D(^DGPT(PTF,"S"))
"RTN","GMTSDGP",22,0)
 S II=0 F ZI=1:1 S II=$O(^DGPT(PTF,"S",II)) Q:'II  S SURG=^DGPT(PTF,"S",II,0),X=$P(SURG,U,1),IX=9999999-X I X>T2&(X<T1) D REGDT4^GMTSU D ICDS1
"RTN","GMTSDGP",23,0)
 Q
"RTN","GMTSDGP",24,0)
ICDS1 ;   Load Surgery entries into GMS array (inverted)
"RTN","GMTSDGP",25,0)
 S GMCZ=2 S GMS(IX)="  Surgery  "_X F GMA=8:1:12 D SGY
"RTN","GMTSDGP",26,0)
 Q
"RTN","GMTSDGP",27,0)
SGY ;   Surgery Line
"RTN","GMTSDGP",28,0)
 N ICDP,ICDI,ICDX
"RTN","GMTSDGP",29,0)
 S ICDI=+$P(SURG,U,GMA) Q:ICDI'>0
"RTN","GMTSDGP",30,0)
 ;S ICDX=$$ICDOP^ICDCODE(+ICDI)
"RTN","GMTSDGP",31,0)
 S ICDX=$$ICDDATA^ICDXCODE("PROC",+ICDI,+SURG)
"RTN","GMTSDGP",32,0)
 S ICDS(80.1,ICDI,.01)=$P(ICDX,"^",2)
"RTN","GMTSDGP",33,0)
 S ICDS(80.1,ICDI,4)=$P(ICDX,"^",5)
"RTN","GMTSDGP",34,0)
 I $D(ICDS(80.1,ICDI)) D
"RTN","GMTSDGP",35,0)
 . S GMS(IX,GMA)=$E($G(ICDS(80.1,ICDI,4)),1,37)_U_$G(ICDS(80.1,ICDI,.01))_"("_$$GETICDCD^GMTSPXU1(+SURG,"PROC")_")"
"RTN","GMTSDGP",36,0)
 Q
"RTN","GMTSDGP",37,0)
 ;
"RTN","GMTSDGP",38,0)
ENP ; Module For History of PTF Procedures
"RTN","GMTSDGP",39,0)
 I $D(GMTSNDM),GMTSNDM>0 S CNTR=GMTSNDM
"RTN","GMTSDGP",40,0)
 E  S CNTR=100
"RTN","GMTSDGP",41,0)
 S T1=GMTSEND,T2=GMTSBEG,GMCZ=0
"RTN","GMTSDGP",42,0)
 S PTF=0
"RTN","GMTSDGP",43,0)
 F  S PTF=$O(^DGPT("B",DFN,PTF)) Q:PTF=""  D ICDP
"RTN","GMTSDGP",44,0)
 D:$$ROK^GMTSU("A7RHSM")&($$NDBI^GMTSU) PRC^A7RHSM
"RTN","GMTSDGP",45,0)
 I $D(GMP) S O=0 F I=1:1 S O=$O(GMP(O)) Q:O=""  Q:'CNTR  S CNTR=CNTR-1 S O1=0,LN1=1 F I=1:1 S O1=$O(GMP(O,O1)) Q:O1=""  D CKP^GMTSUP Q:$D(GMTSQIT)  S:GMTSNPG LN1=1 W:LN1 GMP(O) W ?21,$P(GMP(O,O1),U),?60,$P(GMP(O,O1),U,2),! S LN1=0
"RTN","GMTSDGP",46,0)
 D KILLADM Q
"RTN","GMTSDGP",47,0)
 Q
"RTN","GMTSDGP",48,0)
ICDP ;   ICD Procedures
"RTN","GMTSDGP",49,0)
 N D0,DA,DIC,DR,GMCZ,GTA,II,IX,PRX,ZI Q:'$D(^DGPT(PTF,"P"))
"RTN","GMTSDGP",50,0)
 S II=0 F ZI=1:1 S II=$O(^DGPT(PTF,"P",II)) Q:'II  S PRX=^DGPT(PTF,"P",II,0),X=$P(PRX,U,1),IX=9999999-X I X>T2&(X<T1) D REGDT4^GMTSU D ICDP1
"RTN","GMTSDGP",51,0)
 Q
"RTN","GMTSDGP",52,0)
ICDP1 ;   Load Procedure entries into GMP array (inverted)
"RTN","GMTSDGP",53,0)
 S GMCZ=2 S GMP(IX)="Procedure  "_X F GTA=5:1:9 D PXGY
"RTN","GMTSDGP",54,0)
 Q
"RTN","GMTSDGP",55,0)
PXGY ;   Procedure Line
"RTN","GMTSDGP",56,0)
 N ICDP,ICDI,ICDX
"RTN","GMTSDGP",57,0)
 S ICDI=+$P(PRX,U,GTA) Q:ICDI'>0
"RTN","GMTSDGP",58,0)
 ;S ICDX=$$ICDOP^ICDCODE(+ICDI)
"RTN","GMTSDGP",59,0)
 S ICDX=$$ICDDATA^ICDXCODE("PROC",+ICDI,+PRX)
"RTN","GMTSDGP",60,0)
 S ICDP(80.1,ICDI,.01)=$P(ICDX,"^",2)
"RTN","GMTSDGP",61,0)
 S ICDP(80.1,ICDI,4)=$P(ICDX,"^",5)
"RTN","GMTSDGP",62,0)
 I $D(ICDP(80.1,ICDI)) D
"RTN","GMTSDGP",63,0)
 . S GMP(IX,GTA)=$E($G(ICDP(80.1,ICDI,4)),1,37)_U_$G(ICDP(80.1,ICDI,.01))_"("_$$GETICDCD^GMTSPXU1(+PRX,"PROC")_")"
"RTN","GMTSDGP",64,0)
 Q
"RTN","GMTSDGP",65,0)
 ;
"RTN","GMTSDGP",66,0)
KILLADM ; Kills Admission variables
"RTN","GMTSDGP",67,0)
 K CNTR,GMCZ,LN1,IX,X,ZA,N,ICD,ICD0,PTF,GMC,O,O1,GMS,T1,T2,SURG,SURGY,PRX,PRXY,DATE,D1,I,IMT,GMA,GTA,II,ZI,GMP
"RTN","GMTSDGP",68,0)
 K ICDP,ICDS
"RTN","GMTSDGP",69,0)
 Q
"RTN","GMTSPLST")
0^7^B49938082
"RTN","GMTSPLST",1,0)
GMTSPLST ; SLC/JER,KER,TC - Problem List ;07/02/13  09:56
"RTN","GMTSPLST",2,0)
 ;;2.7;Health Summary;**28,35,52,86,101**;Oct 20, 1995;Build 12
"RTN","GMTSPLST",3,0)
 ;
"RTN","GMTSPLST",4,0)
 ; External References
"RTN","GMTSPLST",5,0)
 ;   DBIA 10011  ^DIWP
"RTN","GMTSPLST",6,0)
 ;   DBIA  1183  GETLIST^GMPLHS
"RTN","GMTSPLST",7,0)
 ;   DBIA  1573  $$DSMONE^LEXU
"RTN","GMTSPLST",8,0)
 ;
"RTN","GMTSPLST",9,0)
 ; Variable NEWed/KILLed Elsewhere
"RTN","GMTSPLST",10,0)
 ;    DFN, GMPXICDF, GMPXNARR, GMTSNPG, GMTSQIT
"RTN","GMTSPLST",11,0)
 ;
"RTN","GMTSPLST",12,0)
ACTIVE ; Get Active Problems
"RTN","GMTSPLST",13,0)
 N STATUS S STATUS="A" D MAIN Q
"RTN","GMTSPLST",14,0)
INACT ; Get Inactive Problems
"RTN","GMTSPLST",15,0)
 N STATUS S STATUS="I" D MAIN Q
"RTN","GMTSPLST",16,0)
ALL ; Get All Problems (Active and Inactive)
"RTN","GMTSPLST",17,0)
 N STATUS S STATUS="ALL" D MAIN Q
"RTN","GMTSPLST",18,0)
MAIN ; Driver
"RTN","GMTSPLST",19,0)
 D GETLIST^GMPLHS(DFN,STATUS) Q:'$D(^TMP("GMPLHS",$J))  D SUBHDR D WRT K ^TMP("GMPLHS",$J) Q
"RTN","GMTSPLST",20,0)
 ;
"RTN","GMTSPLST",21,0)
WRT ;   Writes Problem List Component,X
"RTN","GMTSPLST",22,0)
 ;
"RTN","GMTSPLST",23,0)
 ;     ^TMP("GMPLHS",$J,#,0)=
"RTN","GMTSPLST",24,0)
 ;         Piece 1:  Diagnosis
"RTN","GMTSPLST",25,0)
 ;               2:  Date Last Modified
"RTN","GMTSPLST",26,0)
 ;               3:  Site
"RTN","GMTSPLST",27,0)
 ;               4:  Date Entered
"RTN","GMTSPLST",28,0)
 ;               5:  Status
"RTN","GMTSPLST",29,0)
 ;               6:  Date of Onset
"RTN","GMTSPLST",30,0)
 ;               7:  Responsible Provider
"RTN","GMTSPLST",31,0)
 ;               8:  Service
"RTN","GMTSPLST",32,0)
 ;               9:  Service Abbreviation
"RTN","GMTSPLST",33,0)
 ;              10:  Date Resolved
"RTN","GMTSPLST",34,0)
 ;              11:  Clinic
"RTN","GMTSPLST",35,0)
 ;              12:  Date Recorded
"RTN","GMTSPLST",36,0)
 ;              13:  Problem - Lexicon Term
"RTN","GMTSPLST",37,0)
 ;              14:  Exposure Combined String
"RTN","GMTSPLST",38,0)
 ;              15:  SNOMED-CT Concept Code
"RTN","GMTSPLST",39,0)
 ;              16:  SNOMED-CT Preferred Text
"RTN","GMTSPLST",40,0)
 ;              17:  ICD-9-CM Code
"RTN","GMTSPLST",41,0)
 ;              18:  ICD-9-CM Description
"RTN","GMTSPLST",42,0)
 ;              19:  VHAT Concept Code
"RTN","GMTSPLST",43,0)
 ;              20:  VHAT Preferred Text
"RTN","GMTSPLST",44,0)
 ;              21:  Date of Interest
"RTN","GMTSPLST",45,0)
 ;              22:  Coding System (of Primary diagnosis)
"RTN","GMTSPLST",46,0)
 ;
"RTN","GMTSPLST",47,0)
 ;     ^TMP("GMPLHS",$J,#,#,"ICD9")      Other multiple mapped ICD-9-CM codes
"RTN","GMTSPLST",48,0)
 ;     ^TMP("GMPLHS",$J,#,"L")           Lexicon Term
"RTN","GMTSPLST",49,0)
 ;     ^TMP("GMPLHS",$J,#,"N")           Provider Narrative
"RTN","GMTSPLST",50,0)
 ;     ^TMP("GMPLHS",$J,#,"C",LOC,#,0))  Comments
"RTN","GMTSPLST",51,0)
 ;
"RTN","GMTSPLST",52,0)
 N GMREC,GMTSICL,GMTAB,LINE1,DIWL,GMTSTXTF
"RTN","GMTSPLST",53,0)
 S GMTSICL=32,DIWL=0,GMTAB=0,GMREC=0,GMTSTXTF=0
"RTN","GMTSPLST",54,0)
 F  S GMREC=$O(^TMP("GMPLHS",$J,GMREC)) Q:GMREC'>0  D  Q:$D(GMTSQIT)
"RTN","GMTSPLST",55,0)
 . N GMNODE,GMDIAG,GMDIAC,GMDIAT,GMDIAS,LASTMDT,STAT,ONSETDT,PROV,SERV,GMSCT,GMVHAT,GMTSDINT,GMTSCSYS
"RTN","GMTSPLST",56,0)
 . N RESDT,NARR,GMICD,GMDSM,GMDSMS,CODE,LEXI,LEX,PLIFN,ADDINFO,EXP,GMTSX,X,GMDIAC,GMDIAT,GMTSILBL
"RTN","GMTSPLST",57,0)
 . S (GMDIAC,GMDIAT)=""
"RTN","GMTSPLST",58,0)
 . S GMNODE=$G(^TMP("GMPLHS",$J,GMREC,0))
"RTN","GMTSPLST",59,0)
 . Q:GMNODE']""
"RTN","GMTSPLST",60,0)
 . S GMDIAG=$P(GMNODE,U),LASTMDT=$P(GMNODE,U,2),STAT=$P(GMNODE,U,5)
"RTN","GMTSPLST",61,0)
 . S GMTSDINT=$P(GMNODE,U,21),GMTSCSYS=$P(GMNODE,U,22),GMTSILBL=$S($G(GMTSCSYS)="ICD":"ICD-9-CM ",1:"ICD-10-CM ")
"RTN","GMTSPLST",62,0)
 . S X=LASTMDT D REGDT4^GMTSU S LASTMDT=X
"RTN","GMTSPLST",63,0)
 . S ONSETDT=$P(GMNODE,U,6),PROV=$P(GMNODE,U,7)
"RTN","GMTSPLST",64,0)
 . S RESDT=$P(GMNODE,U,10),GMICD="",GMSCT=$P(GMNODE,U,15),GMVHAT=$P(GMNODE,U,19)
"RTN","GMTSPLST",65,0)
 . S EXP=$P(GMNODE,U,14) S:$L(EXP) EXP=" ("_EXP_")"
"RTN","GMTSPLST",66,0)
 . I STAT="A",+ONSETDT S X=ONSETDT D REGDT4^GMTSU S ADDINFO="Onset "_X
"RTN","GMTSPLST",67,0)
 . I STAT="I",+RESDT S X=RESDT D REGDT4^GMTSU S ADDINFO="Resolved "_X
"RTN","GMTSPLST",68,0)
 . S GMPXICDF=$$UP($G(GMPXICDF))
"RTN","GMTSPLST",69,0)
 . S GMTSTXTF=$S(($G(GMPXICDF)="T")!($G(GMPXICDF)["TEXT ONLY"):1,1:0)
"RTN","GMTSPLST",70,0)
 . I $G(GMPXICDF)]"",($G(GMPXICDF)'="N")!($G(GMPXICDF)["NONE"),GMDIAG]"" D
"RTN","GMTSPLST",71,0)
 . . D GETICDDX^GMTSPXU1(.GMDIAG,$G(GMPXICDF),"",GMTSDINT,GMTSCSYS) S GMICD=GMDIAG
"RTN","GMTSPLST",72,0)
 . I $G(GMTSTXTF)=0 S GMDIAC=$P($G(GMICD),"-",1),GMDIAT=$P($G(GMICD),"-",2,299)
"RTN","GMTSPLST",73,0)
 . S LEX=$G(^TMP("GMPLHS",$J,GMREC,"L"))
"RTN","GMTSPLST",74,0)
 . S NARR=""
"RTN","GMTSPLST",75,0)
 . S:$G(GMPXNARR)'="N"!(LEX["Unresolved") NARR=$G(^TMP("GMPLHS",$J,GMREC,"N"))
"RTN","GMTSPLST",76,0)
 . S LEXI=+LEX,LEX=$P(LEX,"^",2) S:$$UP(LEX)["UNRESOLVED"!(+LEXI'>1) (LEXI,LEX)=""
"RTN","GMTSPLST",77,0)
 . S (CODE,GMDIAS,GMDSMS,GMDSM)="" S:+LEXI>0 GMDSM=$$DSMONE^LEXU(+LEXI)
"RTN","GMTSPLST",78,0)
 . S:GMDIAC["799.9" GMDSM=""
"RTN","GMTSPLST",79,0)
 . S:$L(GMDSM)>2&(GMDSM'[".") GMDSM=GMDSM_"."
"RTN","GMTSPLST",80,0)
 . S:$L(GMDIAC) GMDIAS="("_GMTSILBL_GMDIAC_")"
"RTN","GMTSPLST",81,0)
 . S:$L(GMDSM) GMDSMS="(DSM "_GMDSM_")"
"RTN","GMTSPLST",82,0)
 . S:$L(GMDIAC)&($L(GMDSM))&(GMDIAC=GMDSM) GMDIAS=GMDIAC,GMDSMS=""
"RTN","GMTSPLST",83,0)
 . I $G(^TMP("GMPLHS",$J,GMREC,0,"ICD9"))="" D
"RTN","GMTSPLST",84,0)
 . . S:$L(GMDIAC)&$S($L(GMSCT):1,$L(GMVHAT):1,1:0) GMDIAS=$S($L(GMSCT):"(SCT ",1:"(VHAT ")_GMSCT_") ("_GMTSILBL_GMDIAC_")"
"RTN","GMTSPLST",85,0)
 . E  I $L(GMDIAC)&$S($L(GMSCT):1,$L(GMVHAT):1,1:0) D
"RTN","GMTSPLST",86,0)
 . . S GMDIAS=$S($L(GMSCT):"(SCT ",1:"(VHAT ")_GMSCT_") ("_GMTSILBL_GMDIAC
"RTN","GMTSPLST",87,0)
 . . N T S T=0 F  S T=$O(^TMP("GMPLHS",$J,GMREC,T)) Q:'+T  D
"RTN","GMTSPLST",88,0)
 . . . S GMDIAS=GMDIAS_"/"_$P($G(^TMP("GMPLHS",$J,GMREC,T,"ICD9")),U,1)
"RTN","GMTSPLST",89,0)
 . . S GMDIAS=GMDIAS_")"
"RTN","GMTSPLST",90,0)
 . S:$L(GMDIAS) CODE=GMDIAS S:$L(GMDSMS) CODE=CODE_" "_GMDSMS F  Q:$E(CODE,1)'=" "  S CODE=$E(CODE,2,$L(CODE))
"RTN","GMTSPLST",91,0)
 . S:$L(LEX)&($L(CODE)) LEX=LEX_" "_CODE
"RTN","GMTSPLST",92,0)
 . S:$L(GMDIAT)&($L(CODE)) GMICD=GMDIAT_" "_CODE
"RTN","GMTSPLST",93,0)
 . ; Unresolved or Unspecified
"RTN","GMTSPLST",94,0)
 . I GMDIAC["799.9",$L($G(NARR)) D
"RTN","GMTSPLST",95,0)
 . . N UNARR S UNARR=$$UP(NARR)
"RTN","GMTSPLST",96,0)
 . . I UNARR["UNKNOWN AND UNSPECIFIED"!(UNARR["UNKNOWN OR UNSPECIFIED")!(UNARR["MORBIDITY OR MORTALITY") D  Q
"RTN","GMTSPLST",97,0)
 . . . S GMICD=GMDIAT_" "_CODE,NARR=""
"RTN","GMTSPLST",98,0)
 . . S GMICD=$$UP($E(NARR,1))_$E(NARR,2,$L(NARR))_" "_CODE
"RTN","GMTSPLST",99,0)
 . . S:$L(LEX) GMICD=LEX S NARR=""
"RTN","GMTSPLST",100,0)
 . ; Specified by Lexicon
"RTN","GMTSPLST",101,0)
 . I GMDIAC'["799.9",$L($G(LEX)) D
"RTN","GMTSPLST",102,0)
 . . S GMICD=LEX,NARR=""
"RTN","GMTSPLST",103,0)
 . ; Specified by Provider Narrative
"RTN","GMTSPLST",104,0)
 . I GMDIAC'["799.9",'$L($G(LEX)) D
"RTN","GMTSPLST",105,0)
 . . S:$L(NARR)&($$UP(GMDIAT)'=$$UP(NARR)) GMICD=$S($$UP($G(GMPXICDF))="C"!($$UP($G(GMPXICDF))="CODE ONLY"):"("_GMTSILBL_GMICD_"); ",$L($G(GMDIAT))<1:"",1:GMICD_"; ")_NARR S NARR=""
"RTN","GMTSPLST",106,0)
 . S:$G(IOST)["P-"&(EXP["MST") EXT=$$RM(EXP)
"RTN","GMTSPLST",107,0)
 . S:$L(GMICD)&($L(EXP)) GMICD=GMICD_EXP
"RTN","GMTSPLST",108,0)
 . S:$L(GMICD) GMICD=GMICD_$S($G(ADDINFO)]"":", "_ADDINFO,1:""),NARR=""
"RTN","GMTSPLST",109,0)
 . S GMICD=$$RF(GMICD)
"RTN","GMTSPLST",110,0)
 . D TXTFMT^GMTSPXU1(GMICD,$G(NARR),GMTSICL,GMTAB,DIWL)
"RTN","GMTSPLST",111,0)
 . I '$D(^UTILITY($J,"W")) Q
"RTN","GMTSPLST",112,0)
 . S GMTSX=0,LINE1=1
"RTN","GMTSPLST",113,0)
 . F  S GMTSX=$O(^UTILITY($J,"W",DIWL,GMTSX)) Q:GMTSX'>0!$D(GMTSQIT)  D
"RTN","GMTSPLST",114,0)
 . . D:LINE1 L1 D:'LINE1 LN S LINE1=0
"RTN","GMTSPLST",115,0)
 . D DC
"RTN","GMTSPLST",116,0)
 . K ^UTILITY($J,"W")
"RTN","GMTSPLST",117,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  D:GMTSNPG SUBHDR2 W !
"RTN","GMTSPLST",118,0)
 Q
"RTN","GMTSPLST",119,0)
L1 ;     Line #1 Problem, date, provider
"RTN","GMTSPLST",120,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  D:GMTSNPG SUBHDR2 W:STATUS="ALL" STAT W ?3,$G(^UTILITY($J,"W",DIWL,GMTSX,0)),?53,LASTMDT,?65,$E(PROV,1,15),! Q
"RTN","GMTSPLST",121,0)
LN ;     Line >1 Problem (other)
"RTN","GMTSPLST",122,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  D:GMTSNPG SUBHDR2 W ?3,$G(^UTILITY($J,"W",DIWL,GMTSX,0)),! Q
"RTN","GMTSPLST",123,0)
 ;
"RTN","GMTSPLST",124,0)
DC ; Comments are displayed if there are any
"RTN","GMTSPLST",125,0)
 N LOC,GMR,NODE,DATE,X,UCNT,CNT,CMT,T,I S LOC="",CNT=0
"RTN","GMTSPLST",126,0)
 F  S LOC=$O(^TMP("GMPLHS",$J,GMREC,"C",LOC)) Q:LOC']""  D  Q:$D(GMTSQIT)
"RTN","GMTSPLST",127,0)
 . S (CNT,UCNT)=0 S:+($O(^TMP("GMPLHS",$J,GMREC,"C",LOC," "),-1))>1 UCNT=1
"RTN","GMTSPLST",128,0)
 . S GMR=0 F  S GMR=$O(^TMP("GMPLHS",$J,GMREC,"C",LOC,GMR)) Q:+GMR'>0  D  Q:$D(GMTSQIT)
"RTN","GMTSPLST",129,0)
 . . S NODE=$G(^TMP("GMPLHS",$J,GMREC,"C",LOC,GMR,0)) Q:NODE']""
"RTN","GMTSPLST",130,0)
 . . S CMT=$P(NODE,U) I $L($G(CMT)) D LC
"RTN","GMTSPLST",131,0)
 Q
"RTN","GMTSPLST",132,0)
LC ;   List Comments (unnumbered and numbered)
"RTN","GMTSPLST",133,0)
 S CNT=CNT+1 K ^UTILITY($J,"W") D:UCNT CF(CNT,CMT) D:'UCNT CF(0,CMT)
"RTN","GMTSPLST",134,0)
 I $D(^UTILITY($J,"W",0)) N I,T S I=0 F  S I=$O(^UTILITY($J,"W",0,I)) Q:+I=0  D
"RTN","GMTSPLST",135,0)
 . S T=$$RT($G(^UTILITY($J,"W",0,I,0))) Q:'$L(T)  D CKP^GMTSUP Q:$D(GMTSQIT)  D:GMTSNPG SUBHDR2 W:I=1 ?3 W:I>1 ?7 W $G(T),!
"RTN","GMTSPLST",136,0)
 Q
"RTN","GMTSPLST",137,0)
CF(GMC,GMT) ;   Formats GMC (count) and GMT (text) together
"RTN","GMTSPLST",138,0)
 S GMC=+($G(GMC)),GMT=$G(GMT) Q:'$L(GMT)  S GMT=$$LD(GMT)
"RTN","GMTSPLST",139,0)
 N GMCOL,DIWL,DIWR,DIWF,X S GMCOL=34,DIWL=0,DIWR=80-(GMCOL) K ^UTILITY($J,"W")
"RTN","GMTSPLST",140,0)
 S:+($G(GMC))=0 X="    "_GMT S:+($G(GMC))>0 X=$J(GMC,2)_". "_GMT D:$G(X)]"" ^DIWP
"RTN","GMTSPLST",141,0)
 Q
"RTN","GMTSPLST",142,0)
 ;
"RTN","GMTSPLST",143,0)
SUBHDR ; Subheader for Problem List Component
"RTN","GMTSPLST",144,0)
 N NUM,TOT,NODE S NODE=$G(^TMP("GMPLHS",$J,STATUS,0)) S NUM=$P(NODE,U),TOT=$P(NODE,U,2)
"RTN","GMTSPLST",145,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  S:TOT>NUM NUM=NUM_" of "_TOT W ?50,NUM_$S(STATUS="A":" Active",STATUS="I":" Inactive",1:"")_" Problems",!
"RTN","GMTSPLST",146,0)
SUBHDR2 ; Will be written on new pages
"RTN","GMTSPLST",147,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W:STATUS="ALL" "ST" W ?3,"PROBLEM",?53,"LAST MOD",?65,"PROVIDER",! Q
"RTN","GMTSPLST",148,0)
 ;
"RTN","GMTSPLST",149,0)
RM(X) ; Remove MST
"RTN","GMTSPLST",150,0)
 S X=$G(X) F  Q:X'["MST"  S X=$P(X,"MST",1)_$P(X,"MST",2)
"RTN","GMTSPLST",151,0)
 F  Q:X'["//"  S X=$P(X,"//",1)_"/"_$P(X,"//",2)
"RTN","GMTSPLST",152,0)
 F  Q:$E(X,$L(X))'="/"  S X=$E(X,1,($L(X)-1))
"RTN","GMTSPLST",153,0)
 F  Q:$E(X,1)'="/"  S X=$E(X,2,$L(X))
"RTN","GMTSPLST",154,0)
 Q X
"RTN","GMTSPLST",155,0)
RF(X) ; Remove Leading Spaces/Punctuation
"RTN","GMTSPLST",156,0)
 F  Q:$E(X,1)'=" "  S X=$E(X,2,$L(X))
"RTN","GMTSPLST",157,0)
 F  Q:$E(X,1)'=";"  S X=$E(X,2,$L(X))
"RTN","GMTSPLST",158,0)
 F  Q:$E(X,1)'=" "  S X=$E(X,2,$L(X))
"RTN","GMTSPLST",159,0)
 S X=$$LD(X) Q X
"RTN","GMTSPLST",160,0)
LD(X) ; Uppercase Leading Character
"RTN","GMTSPLST",161,0)
 Q $TR($E(X,1),"abcdefghijklmnopqrstuvwxyz","ABCDEFGHIJKLMNOPQRSTUVWXYZ")_$E(X,2,$L(X))
"RTN","GMTSPLST",162,0)
RT(X) ; Right Trim Spaces
"RTN","GMTSPLST",163,0)
 S X=$G(X) F  Q:$E(X,$L(X))'=" "  S X=$E(X,1,($L(X)-1))
"RTN","GMTSPLST",164,0)
 Q X
"RTN","GMTSPLST",165,0)
UP(X) ; Uppercase
"RTN","GMTSPLST",166,0)
 Q $TR(X,"abcdefghijklmnopqrstuvwxyz","ABCDEFGHIJKLMNOPQRSTUVWXYZ")
"RTN","GMTSPXOP")
0^4^B51940559
"RTN","GMTSPXOP",1,0)
GMTSPXOP ; SLC/SBW,KER - PCE Outpatient Encounter comp ;07/19/13  11:48
"RTN","GMTSPXOP",2,0)
 ;;2.7;Health Summary;**8,10,28,37,47,49,76,101**;Oct 20, 1995;Build 12
"RTN","GMTSPXOP",3,0)
 ;
"RTN","GMTSPXOP",4,0)
 ; External References
"RTN","GMTSPXOP",5,0)
 ;    DBIA  1238  VISIT^PXRHS01
"RTN","GMTSPXOP",6,0)
 ;    DBIA  1996  $$MOD^ICPTMOD
"RTN","GMTSPXOP",7,0)
 ;    DBIA 10103  $$DT^XLFDT
"RTN","GMTSPXOP",8,0)
 ;    DBIA 10011  ^DIWP
"RTN","GMTSPXOP",9,0)
 ;
"RTN","GMTSPXOP",10,0)
PURPOSE ; Encounters with ICD9 and providers
"RTN","GMTSPXOP",11,0)
 N DTYPE S DTYPE="DP" D MAIN Q
"RTN","GMTSPXOP",12,0)
OUTPT ; Encounters with ICD9, CPT, and providers
"RTN","GMTSPXOP",13,0)
 N DTYPE S DTYPE="CDP" D MAIN Q
"RTN","GMTSPXOP",14,0)
MAIN ; Entry for Purpose of Visit and Outpatient Encounters
"RTN","GMTSPXOP",15,0)
 N GMTSIVD,GMTSDAT,GMTSDTU,GMTSOVT,GMTSLOC,DIWL,GMTAB,GMTSN,GMCKP,GMTSX
"RTN","GMTSPXOP",16,0)
 N GMTSITE,GMTSINS,GMTSEVT,GMTSHIS,GMTSICL,GMTSLOC,GMTSELIG,X,GMTSVDF
"RTN","GMTSPXOP",17,0)
 N GMTSCPTM,GMICL
"RTN","GMTSPXOP",18,0)
 ;
"RTN","GMTSPXOP",19,0)
 ; GMTSCPTM    Component uses CPT Modifiers 1 yes 0 no
"RTN","GMTSPXOP",20,0)
 S GMTSCPTM=+($$CPT^GMTSU(+($G(GMTSEGN)))) S:$G(GMPXCMOD)="N" GMTSCPTM=0
"RTN","GMTSPXOP",21,0)
 ; GMTSICL     # of blank left columns for support data of a visit
"RTN","GMTSPXOP",22,0)
 S GMTSICL=14
"RTN","GMTSPXOP",23,0)
 ; DIWL        Used in TXTFMT call & to print returned data
"RTN","GMTSPXOP",24,0)
 S DIWL=0
"RTN","GMTSPXOP",25,0)
 ; GMTAB       Used to offset data from TXTFMT call after 1st line
"RTN","GMTSPXOP",26,0)
 S GMTAB=2
"RTN","GMTSPXOP",27,0)
 ; GMTSOVT     This is the set of Service Categories for AICTSORE
"RTN","GMTSPXOP",28,0)
 ;
"RTN","GMTSPXOP",29,0)
 ;                A  Ambulatory
"RTN","GMTSPXOP",30,0)
 ;                I  Inpatient
"RTN","GMTSPXOP",31,0)
 ;                C  Chart Review
"RTN","GMTSPXOP",32,0)
 ;                T  Telecommunications
"RTN","GMTSPXOP",33,0)
 ;                S  Day Surgery
"RTN","GMTSPXOP",34,0)
 ;                O  Observation
"RTN","GMTSPXOP",35,0)
 ;                R  Nursing Home Encounters
"RTN","GMTSPXOP",36,0)
 ;                E  Event (Historical)
"RTN","GMTSPXOP",37,0)
 ;
"RTN","GMTSPXOP",38,0)
 ;            Note:  Hospitalization and Ancillary
"RTN","GMTSPXOP",39,0)
 ;                   encounters are not included
"RTN","GMTSPXOP",40,0)
 S GMTSOVT="AICTSORE"
"RTN","GMTSPXOP",41,0)
 ;
"RTN","GMTSPXOP",42,0)
 D VISIT^PXRHS01(DFN,GMTSEND,GMTSBEG,GMTSNDM,GMTSOVT,DTYPE,1)
"RTN","GMTSPXOP",43,0)
 Q:'$D(^TMP("PXHSV",$J))
"RTN","GMTSPXOP",44,0)
 S GMTSIVD=0
"RTN","GMTSPXOP",45,0)
 F  S GMTSIVD=$O(^TMP("PXHSV",$J,GMTSIVD)) Q:GMTSIVD']""  D  Q:$D(GMTSQIT)
"RTN","GMTSPXOP",46,0)
 . S GMTSVDF=0
"RTN","GMTSPXOP",47,0)
 . F  S GMTSVDF=$O(^TMP("PXHSV",$J,GMTSIVD,GMTSVDF)) Q:GMTSVDF'>0  D  Q:$D(GMTSQIT)
"RTN","GMTSPXOP",48,0)
 . . S GMTSN=$G(^TMP("PXHSV",$J,GMTSIVD,GMTSVDF,0))
"RTN","GMTSPXOP",49,0)
 . . S GMTSEVT=$P(GMTSN,U,4),GMTSHIS=$S(GMTSEVT["HISTORICAL":1,1:0)
"RTN","GMTSPXOP",50,0)
 . . S X=$P(GMTSN,U,1) D REGDT4^GMTSU S GMTSDAT=X
"RTN","GMTSPXOP",51,0)
 . . S GMTSDTU=0,(GMTSITE,GMTSLOC)=""
"RTN","GMTSPXOP",52,0)
 . . S GMTSINS=$S($P(GMTSN,U,3)]"":$E($P(GMTSN,U,3),1,10),$P(GMTSN,U,8)]"":$E($P(GMTSN,U,8),1,10),1:""),GMTSITE=GMTSINS
"RTN","GMTSPXOP",53,0)
 . . I $G(GMPXHLOC)'="N" S GMTSLOC=$E($P(GMTSN,U,6),1,30)
"RTN","GMTSPXOP",54,0)
 . . I '$L(GMTSLOC) S GMTSLOC=$P(GMTSN,U,9)
"RTN","GMTSPXOP",55,0)
 . . S GMTSELIG=$E($P(GMTSN,U,12),1,17)
"RTN","GMTSPXOP",56,0)
 . . S:GMTSITE=""&('GMTSHIS) GMTSLOC=""
"RTN","GMTSPXOP",57,0)
 . . I GMTSHIS D
"RTN","GMTSPXOP",58,0)
 . . . S:GMTSLOC'=""&(GMTSITE'="") GMTSLOC=GMTSLOC_" (Historical Event)"
"RTN","GMTSPXOP",59,0)
 . . . S:GMTSLOC=""&(GMTSITE'="") GMTSITE=GMTSITE_" (Historical Event)"
"RTN","GMTSPXOP",60,0)
 . . . S:GMTSLOC'=""&(GMTSITE="") GMTSITE=GMTSLOC_" (Historical Event)",GMTSLOC=""
"RTN","GMTSPXOP",61,0)
 . . . S:GMTSLOC=""&(GMTSITE="") GMTSITE="Historical Event"
"RTN","GMTSPXOP",62,0)
 . . D CKP^GMTSUP Q:$D(GMTSQIT)  D DSPVIS,DSPPROV Q:$D(GMTSQIT)
"RTN","GMTSPXOP",63,0)
 . . D DSPPOV Q:$D(GMTSQIT)  D DSPCPT W !
"RTN","GMTSPXOP",64,0)
 K ^TMP("PXHSV",$J)
"RTN","GMTSPXOP",65,0)
 Q
"RTN","GMTSPXOP",66,0)
 ;
"RTN","GMTSPXOP",67,0)
DSPPOV ; Display Purpose of visit
"RTN","GMTSPXOP",68,0)
 Q:$O(^TMP("PXHSV",$J,GMTSIVD,GMTSVDF,"D",""))=""
"RTN","GMTSPXOP",69,0)
 Q:$G(GMPXICDF)="N"&($G(GMPXNARR)="N")
"RTN","GMTSPXOP",70,0)
 N GMTSN,GMTSMOD,GMTSICD,GMTSNARR,GMTSPDN,GMTS,GMTSQTY,GMTSPRI,COMMENT,GMTSICDT
"RTN","GMTSPXOP",71,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  D DSPVIS W ?3,"Diagnosis:"
"RTN","GMTSPXOP",72,0)
 S GMCKP=0,GMTSPDN="",GMTSQTY=""
"RTN","GMTSPXOP",73,0)
 F  S GMTSPDN=$O(^TMP("PXHSV",$J,GMTSIVD,GMTSVDF,"D",GMTSPDN)) Q:GMTSPDN'>0  D  Q:$D(GMTSQIT)
"RTN","GMTSPXOP",74,0)
 . S GMTSICDT=$P(^TMP("PXHSV",$J,GMTSIVD,GMTSVDF,0),U)
"RTN","GMTSPXOP",75,0)
 . S GMTSN=$G(^TMP("PXHSV",$J,GMTSIVD,GMTSVDF,"D",GMTSPDN))
"RTN","GMTSPXOP",76,0)
 . S GMTSMOD=$P(GMTSN,U,2)
"RTN","GMTSPXOP",77,0)
 . S GMTSICD=$P(GMTSN,U) D GETICDDX^GMTSPXU1(.GMTSICD,$G(GMPXICDF),GMTSMOD,GMTSICDT,"DIAG")
"RTN","GMTSPXOP",78,0)
 . S GMTSNARR=""
"RTN","GMTSPXOP",79,0)
 . S:$G(GMPXNARR)'="N" GMTSNARR=$G(^TMP("PXHSV",$J,GMTSIVD,GMTSVDF,"D",GMTSPDN,"N"))
"RTN","GMTSPXOP",80,0)
 . I $P(GMTSICD,"-",2,10)=$G(GMTSNARR) S GMTSNARR=""
"RTN","GMTSPXOP",81,0)
 . S GMTSPRI="" I $P(GMTSN,U,5)]"",$E($P(GMTSN,U,5),1)="P" S GMTSPRI=" (P)"
"RTN","GMTSPXOP",82,0)
 . S GMTSICD=$P(GMTSICD,"-",2,10)_" ("_$$GETICDCD^GMTSPXU1(GMTSICDT,"DIAG")_"-CM "_$P(GMTSICD,"-",1)_")"
"RTN","GMTSPXOP",83,0)
 . D TXTFMT^GMTSPXU1(GMTSICD,$G(GMTSNARR),GMTSICL,GMTAB,DIWL,GMTSQTY,GMTSPRI)
"RTN","GMTSPXOP",84,0)
 . I '$D(^UTILITY($J,"W")) Q
"RTN","GMTSPXOP",85,0)
 . S GMTSX=0
"RTN","GMTSPXOP",86,0)
 . F  S GMTSX=$O(^UTILITY($J,"W",DIWL,GMTSX)) Q:GMTSX'>0!$D(GMTSQIT)  D
"RTN","GMTSPXOP",87,0)
 . . I GMCKP>0 D CKP^GMTSUP Q:$D(GMTSQIT)  D DSPVIS
"RTN","GMTSPXOP",88,0)
 . . S GMCKP=1
"RTN","GMTSPXOP",89,0)
 . . W ?GMTSICL+$S(GMTSX>1:GMTAB,1:0),$G(^UTILITY($J,"W",DIWL,GMTSX,0)),!
"RTN","GMTSPXOP",90,0)
 . S COMMENT="",COMMENT=$P($G(^TMP("PXHSV",$J,GMTSIVD,GMTSVDF,"D",GMTSPDN,"COM")),U)
"RTN","GMTSPXOP",91,0)
 . I COMMENT]"" S GMICL=20,GMTAB=2 D FORMAT I $D(^UTILITY($J,"W")) D
"RTN","GMTSPXOP",92,0)
 . . F GMTSLN=1:1:^UTILITY($J,"W",DIWL) D LINE Q:$D(GMTSQIT)
"RTN","GMTSPXOP",93,0)
 Q
"RTN","GMTSPXOP",94,0)
DSPCPT ; Display Procedures performed during the visit
"RTN","GMTSPXOP",95,0)
 Q:$O(^TMP("PXHSV",$J,GMTSIVD,GMTSVDF,"C",""))=""
"RTN","GMTSPXOP",96,0)
 N GMTSNARR,GMTSPDN,GMTSN,GMTSICD,GMTSNARR,GMTSCPT,GMTSQTY,GMTSPRIM,GMTSPRI,GMTSFLG,GMTSICDT
"RTN","GMTSPXOP",97,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  D DSPVIS W ?3,"Procedure:"
"RTN","GMTSPXOP",98,0)
 S GMCKP=0,GMTSPDN="",GMTSPRI=""
"RTN","GMTSPXOP",99,0)
 F  S GMTSPDN=$O(^TMP("PXHSV",$J,GMTSIVD,GMTSVDF,"C",GMTSPDN)) Q:GMTSPDN'>0  D  Q:$D(GMTSQIT)
"RTN","GMTSPXOP",100,0)
 . S GMTSICDT=$P(^TMP("PXHSV",$J,GMTSIVD,GMTSVDF,0),U)
"RTN","GMTSPXOP",101,0)
 . S GMTSN=$G(^TMP("PXHSV",$J,GMTSIVD,GMTSVDF,"C",GMTSPDN))
"RTN","GMTSPXOP",102,0)
 . S GMTSNARR=$P(GMTSN,U,2),GMTSQTY=$P(GMTSN,U,3),GMTSPRIM=$P(GMTSN,U,4)
"RTN","GMTSPXOP",103,0)
 . S GMTSCPT=$$GETCPT^GMTSPXU1($P(GMTSN,U)) I $P(GMTSCPT,"-",2,10)=GMTSNARR S GMTSNARR=""
"RTN","GMTSPXOP",104,0)
 . S GMTSPRI="" S:$G(GMTSQTY)]"" GMTSQTY=" ("_GMTSQTY_")" S:$G(GMTSPRIM)="Y" GMTSPRI="(P)"
"RTN","GMTSPXOP",105,0)
 . S GMTSFLG=1
"RTN","GMTSPXOP",106,0)
 . D TXTFMT^GMTSPXU1(GMTSCPT,GMTSNARR,GMTSICL,GMTAB,DIWL,GMTSQTY,GMTSPRI)
"RTN","GMTSPXOP",107,0)
 . Q:'$D(^UTILITY($J,"W"))  D DCPT
"RTN","GMTSPXOP",108,0)
 Q
"RTN","GMTSPXOP",109,0)
DCPT ; Display CPT Comments
"RTN","GMTSPXOP",110,0)
 N GMTSLN,GMTSMOK,GMTSX S (GMTSMOK,GMTSX)=0
"RTN","GMTSPXOP",111,0)
 F  S GMTSX=$O(^UTILITY($J,"W",DIWL,GMTSX)) Q:GMTSX'>0  D  Q:$D(GMTSQIT)
"RTN","GMTSPXOP",112,0)
 . I GMCKP>0 D CKP^GMTSUP Q:$D(GMTSQIT)  D DSPVIS Q:$D(GMTSQIT)
"RTN","GMTSPXOP",113,0)
 . S (GMTSMOK,GMCKP)=1 W ?GMTSICL+$S(GMTSX>1:GMTAB,1:0)
"RTN","GMTSPXOP",114,0)
 . W $G(^UTILITY($J,"W",DIWL,GMTSX,0))
"RTN","GMTSPXOP",115,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  W !
"RTN","GMTSPXOP",116,0)
 Q:DTYPE="DP"
"RTN","GMTSPXOP",117,0)
 S COMMENT=$P($G(^TMP("PXHSV",$J,GMTSIVD,GMTSVDF,"C",GMTSPDN,"COM")),U)
"RTN","GMTSPXOP",118,0)
 I COMMENT]"" S GMICL=20,GMTAB=2 D FORMAT I $D(^UTILITY($J,"W")) D
"RTN","GMTSPXOP",119,0)
 . F GMTSLN=1:1:^UTILITY($J,"W",DIWL) D  Q:$D(GMTSQIT)
"RTN","GMTSPXOP",120,0)
 . . I GMTSFLG=1 W !,?10,"Comments:" S GMTSFLG=0
"RTN","GMTSPXOP",121,0)
 . . D LINE
"RTN","GMTSPXOP",122,0)
 S:+($G(GMTSCPTM))=0 GMTSMOK=0 D:GMTSMOK DMOD
"RTN","GMTSPXOP",123,0)
 Q
"RTN","GMTSPXOP",124,0)
DMOD ; Display CPT Modifier Comments
"RTN","GMTSPXOP",125,0)
 N GMTSM S GMTSM=""
"RTN","GMTSPXOP",126,0)
 W !
"RTN","GMTSPXOP",127,0)
 F  S GMTSM=$O(^TMP("PXHSV",$J,GMTSIVD,GMTSVDF,"C",GMTSPDN,GMTSM)) Q:GMTSM=""  D  Q:$D(GMTSQIT)
"RTN","GMTSPXOP",128,0)
 . I GMTSM="COM" Q
"RTN","GMTSPXOP",129,0)
 . N COMMENT S COMMENT=$$FCM(GMTSM) Q:'$L(COMMENT)
"RTN","GMTSPXOP",130,0)
 . S GMICL=26,GMTAB=2 D FORMAT I $D(^UTILITY($J,"W")) D
"RTN","GMTSPXOP",131,0)
 . . F GMTSLN=1:1:^UTILITY($J,"W",DIWL) D LINE2 Q:$D(GMTSQIT)
"RTN","GMTSPXOP",132,0)
 Q
"RTN","GMTSPXOP",133,0)
DSPPROV ; Display Providers for visit
"RTN","GMTSPXOP",134,0)
 Q:$O(^TMP("PXHSV",$J,GMTSIVD,GMTSVDF,"P",""))=""
"RTN","GMTSPXOP",135,0)
 N GMCNT,GMPROV
"RTN","GMTSPXOP",136,0)
 D ORDERPRO^GMTSPXU1(.GMPROV,20)
"RTN","GMTSPXOP",137,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  D DSPVIS W ?3," Provider:"
"RTN","GMTSPXOP",138,0)
 S GMCNT=0
"RTN","GMTSPXOP",139,0)
 F  S GMCNT=$O(GMPROV(GMCNT)) Q:GMCNT'>0  D  Q:GMCNT'>0!$D(GMTSQIT)
"RTN","GMTSPXOP",140,0)
 . I GMCNT>1 D CKP^GMTSUP Q:$D(GMTSQIT)  D DSPVIS
"RTN","GMTSPXOP",141,0)
 . W ?GMTSICL,GMPROV(GMCNT) S GMCNT=$O(GMPROV(GMCNT)) Q:GMCNT'>0
"RTN","GMTSPXOP",142,0)
 . W ?37,GMPROV(GMCNT) S GMCNT=$O(GMPROV(GMCNT)) Q:GMCNT'>0
"RTN","GMTSPXOP",143,0)
 . W ?60,GMPROV(GMCNT)
"RTN","GMTSPXOP",144,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  W:$O(GMPROV(GMCNT)) !
"RTN","GMTSPXOP",145,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W !
"RTN","GMTSPXOP",146,0)
 Q
"RTN","GMTSPXOP",147,0)
DSPVIS ; Display outpatient visit data
"RTN","GMTSPXOP",148,0)
 Q:GMTSNPG'>0&(GMTSDTU>0)  D:GMTSNPG HDR I GMTSNPG!(+GMTSDTU'>0) D
"RTN","GMTSPXOP",149,0)
 . W GMTSDAT,?14,GMTSITE,?29,GMTSLOC,?61,GMTSELIG
"RTN","GMTSPXOP",150,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  W !
"RTN","GMTSPXOP",151,0)
 . S GMTSDTU=1
"RTN","GMTSPXOP",152,0)
 Q
"RTN","GMTSPXOP",153,0)
HDR ; Display header
"RTN","GMTSPXOP",154,0)
 W ?3,"Date",?14,"Facility",?29,"Hospital Location",?61,"Encounter Elig.",!!
"RTN","GMTSPXOP",155,0)
 Q
"RTN","GMTSPXOP",156,0)
FORMAT ; Formats Diagnosis/Procedure line of text
"RTN","GMTSPXOP",157,0)
 N DIWR,DIWF,X S DIWL=3,DIWR=80-(GMICL+GMTAB) K ^UTILITY($J,"W") S X=COMMENT D ^DIWP
"RTN","GMTSPXOP",158,0)
 Q
"RTN","GMTSPXOP",159,0)
FCM(X) ; Format CPT Modifier comment
"RTN","GMTSPXOP",160,0)
 N Y,%,%H,GMTSIEN,GMTSC,GMTSS,GMTST S GMTSIEN=$G(X) Q:GMTSIEN="" ""
"RTN","GMTSPXOP",161,0)
 S:'$D(DT)!(+($G(DT))=0) DT=$$DT^XLFDT
"RTN","GMTSPXOP",162,0)
 S X=$$MOD^ICPTMOD(GMTSIEN,"E",) Q:'$D(X)
"RTN","GMTSPXOP",163,0)
 S GMTSC=$P(X,"^",2),GMTSS=$P(X,"^",3)
"RTN","GMTSPXOP",164,0)
 S GMTST=$$EN2^GMTSUMX(GMTSS) S Y=""
"RTN","GMTSPXOP",165,0)
 S:$L(GMTST)&($L(GMTSC)) Y=GMTSC_"-"_GMTST
"RTN","GMTSPXOP",166,0)
 S:'$L(GMTST)&($L(GMTSS))&($L(GMTSC)) Y=GMTSC_"-"_GMTSS
"RTN","GMTSPXOP",167,0)
 S:'$L(GMTST)&('$L(GMTSS))&($L(GMTSC)) Y=GMTSC
"RTN","GMTSPXOP",168,0)
 S:Y["-" Y="Modifier "_Y S X=Y
"RTN","GMTSPXOP",169,0)
 Q X
"RTN","GMTSPXOP",170,0)
LINE ; Writes formatted lines
"RTN","GMTSPXOP",171,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W ?20,^UTILITY($J,"W",DIWL,GMTSLN,0),! Q
"RTN","GMTSPXOP",172,0)
LINE2 ; Writes indented formatted lines
"RTN","GMTSPXOP",173,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  N GMTST S GMTST=20 S:+($G(GMTSLN))>1 GMTST=31 W ?GMTST,^UTILITY($J,"W",DIWL,GMTSLN,0),! Q
"RTN","GMTSPXU1")
0^3^B17119835
"RTN","GMTSPXU1",1,0)
GMTSPXU1 ; SLC/SBW,TC - PCE Utilities sub-routines ;07/19/13  11:05
"RTN","GMTSPXU1",2,0)
 ;;2.7;Health Summary;**10,37,71,86,101**;Oct 20, 1995;Build 12
"RTN","GMTSPXU1",3,0)
 ;
"RTN","GMTSPXU1",4,0)
 ; External References
"RTN","GMTSPXU1",5,0)
 ;   DBIA  3390  $$ICDDX^ICDCODE
"RTN","GMTSPXU1",6,0)
 ;   DBIA  3390  $$ICDOP^ICDCODE
"RTN","GMTSPXU1",7,0)
 ;   DBIA  3390  $$ICDD^ICDCODE
"RTN","GMTSPXU1",8,0)
 ;   DBIA  1995  $$CPT^ICPTCOD
"RTN","GMTSPXU1",9,0)
 ;   DBIA 10026  ^DIR
"RTN","GMTSPXU1",10,0)
 ;   DBIA 10011  ^DIWP
"RTN","GMTSPXU1",11,0)
 ;
"RTN","GMTSPXU1",12,0)
GETICDDX(GMTSICD,GMTSICF,GMMOD,GMTSDATE,GMTSCSYS) ; Entry point to get ICD data
"RTN","GMTSPXU1",13,0)
 N REC,CODE,NAME,DESC,ICDX,ICDI,GMTSICDA
"RTN","GMTSPXU1",14,0)
 S GMTSICD=$G(GMTSICD),GMTSICF=$G(GMTSICF),GMMOD=$G(GMMOD),GMTSDATE=$G(GMTSDATE,DT),GMTSCSYS=$G(GMTSCSYS)
"RTN","GMTSPXU1",15,0)
 S ICDX=$$ICDDATA^ICDXCODE(GMTSCSYS,+GMTSICD,GMTSDATE,"I")
"RTN","GMTSPXU1",16,0)
 S REC(80,GMTSICD,.01,"E")=$P(ICDX,"^",2)
"RTN","GMTSPXU1",17,0)
 S REC(80,GMTSICD,.01,"I")=$P(ICDX,"^",2)
"RTN","GMTSPXU1",18,0)
 S REC(80,GMTSICD,3,"E")=$P(ICDX,"^",4)
"RTN","GMTSPXU1",19,0)
 S REC(80,GMTSICD,3,"I")=$P(ICDX,"^",4)
"RTN","GMTSPXU1",20,0)
 S ICDI=$$ICDDESC^ICDXCODE(GMTSCSYS,$P(ICDX,"^",2),GMTSDATE,.GMTSICDA)
"RTN","GMTSPXU1",21,0)
 S REC(80,GMTSICD,10,"E")=$G(GMTSICDA(1))
"RTN","GMTSPXU1",22,0)
 S REC(80,GMTSICD,10,"I")=$G(GMTSICDA(1))
"RTN","GMTSPXU1",23,0)
 S CODE=REC(80,GMTSICD,.01,"I")
"RTN","GMTSPXU1",24,0)
 S NAME=REC(80,GMTSICD,3,"E")
"RTN","GMTSPXU1",25,0)
 S DESC=REC(80,GMTSICD,10,"E")
"RTN","GMTSPXU1",26,0)
 S:GMTSICF="L"!(GMTSICF["LONG TEXT")!(GMTSICF="") GMTSICD=CODE_"-"_DESC
"RTN","GMTSPXU1",27,0)
 S:GMTSICF="S"!(GMTSICF["SHORT TEXT") GMTSICD=CODE_"-"_NAME
"RTN","GMTSPXU1",28,0)
 S:GMTSICF="C"!(GMTSICF["CODE ONLY") GMTSICD=CODE
"RTN","GMTSPXU1",29,0)
 S:GMTSICF="T"!(GMTSICF["TEXT ONLY") GMTSICD=DESC
"RTN","GMTSPXU1",30,0)
 I $G(GMMOD)]"" S GMMOD=$P(GMMOD,","),GMTSICD=GMMOD_" "_GMTSICD
"RTN","GMTSPXU1",31,0)
 S:GMTSICF="N"!(GMTSICF["NONE") GMTSICD=""
"RTN","GMTSPXU1",32,0)
 Q
"RTN","GMTSPXU1",33,0)
 ;
"RTN","GMTSPXU1",34,0)
GETICDOP(GMTSICD,GMTSICF,GMMOD,GMTSDATE,GMTSSHCS) ; Entry point to get ICD data
"RTN","GMTSPXU1",35,0)
 S GMTSICD=$G(GMTSICD),GMTSICF=$G(GMTSICF),GMMOD=$G(GMMOD),GMTSDATE=$G(GMTSDATE,DT),GMTSSHCS=$G(GMTSSHCS,0)
"RTN","GMTSPXU1",36,0)
 N REC,CODE,NAME,DESC,ICDX,ICDI,GMTSICDA
"RTN","GMTSPXU1",37,0)
 S ICDX=$$ICDDATA^ICDXCODE("PROC",+GMTSICD,GMTSDATE)
"RTN","GMTSPXU1",38,0)
 S REC(80.1,GMTSICD,.01,"E")=$P(ICDX,"^",2)
"RTN","GMTSPXU1",39,0)
 S REC(80.1,GMTSICD,.01,"I")=$P(ICDX,"^",2)
"RTN","GMTSPXU1",40,0)
 S REC(80.1,GMTSICD,4,"E")=$P(ICDX,"^",5)
"RTN","GMTSPXU1",41,0)
 S REC(80.1,GMTSICD,4,"I")=$P(ICDX,"^",5)
"RTN","GMTSPXU1",42,0)
 S ICDI=$$ICDDESC^ICDXCODE("PROC",$P(ICDX,"^",2),GMTSDATE,.GMTSICDA)
"RTN","GMTSPXU1",43,0)
 S REC(80.1,GMTSICD,10,"E")=$G(GMTSICDA(1))
"RTN","GMTSPXU1",44,0)
 S REC(80.1,GMTSICD,10,"I")=$G(GMTSICDA(1))
"RTN","GMTSPXU1",45,0)
 S CODE=REC(80.1,GMTSICD,.01,"I")
"RTN","GMTSPXU1",46,0)
 S NAME=REC(80.1,GMTSICD,4,"E")
"RTN","GMTSPXU1",47,0)
 S DESC=REC(80.1,GMTSICD,10,"E")
"RTN","GMTSPXU1",48,0)
 I GMTSSHCS S CODE=CODE_"("_$$GETICDCD(GMTSDATE,"PROC")_")"
"RTN","GMTSPXU1",49,0)
 S:GMTSICF="L"!(GMTSICF="") GMTSICD=CODE_"-"_DESC
"RTN","GMTSPXU1",50,0)
 S:GMTSICF="S" GMTSICD=CODE_"-"_NAME
"RTN","GMTSPXU1",51,0)
 S:GMTSICF="C" GMTSICD=CODE
"RTN","GMTSPXU1",52,0)
 S:GMTSICF="T" GMTSICD=DESC
"RTN","GMTSPXU1",53,0)
 S:GMTSICF="N" GMTSICD=""
"RTN","GMTSPXU1",54,0)
 Q
"RTN","GMTSPXU1",55,0)
 ;
"RTN","GMTSPXU1",56,0)
GETCPT(GMTSCPT) ; Entry point to get CPT data
"RTN","GMTSPXU1",57,0)
 N ICPT S GMTSCPT=+($G(GMTSCPT)) Q:GMTSCPT=0 ""
"RTN","GMTSPXU1",58,0)
 S ICPT=$$CPT^ICPTCOD(+GMTSCPT),ICPT=$P(ICPT,"^",2)_"-"_$P(ICPT,"^",3)
"RTN","GMTSPXU1",59,0)
 Q ICPT
"RTN","GMTSPXU1",60,0)
 ;
"RTN","GMTSPXU1",61,0)
TXTFMT(GMTSICD,GMTSNARR,GMICL,GMTAB,DIWL,GMTSQTY,GMTSPRIM) ; Formats GMTSICD & GMTSNARR together
"RTN","GMTSPXU1",62,0)
 I GMTSICD="",GMTSNARR="" Q
"RTN","GMTSPXU1",63,0)
 N DIWR,DIWF,X
"RTN","GMTSPXU1",64,0)
 S DIWR=80-(GMICL+GMTAB)
"RTN","GMTSPXU1",65,0)
 K ^UTILITY($J,"W")
"RTN","GMTSPXU1",66,0)
 I $G(GMTSICD)]"" S X=GMTSICD S:$G(GMTSNARR)]"" X=X_"; "
"RTN","GMTSPXU1",67,0)
 I $G(GMTSNARR)]"" S X=$G(X)_GMTSNARR D
"RTN","GMTSPXU1",68,0)
 . I $G(GMTSPRIM)]"" S X=X_GMTSPRIM
"RTN","GMTSPXU1",69,0)
 . I $G(GMTSQTY)]"" S X=X_GMTSQTY
"RTN","GMTSPXU1",70,0)
 . D ^DIWP
"RTN","GMTSPXU1",71,0)
 I $G(GMTSNARR)']"" D
"RTN","GMTSPXU1",72,0)
 . I $G(GMTSQTY)]"" S X=$G(X)_GMTSQTY
"RTN","GMTSPXU1",73,0)
 . I $G(GMTSPRIM)]"" S X=X_GMTSPRIM
"RTN","GMTSPXU1",74,0)
 . D ^DIWP
"RTN","GMTSPXU1",75,0)
 Q
"RTN","GMTSPXU1",76,0)
 ;
"RTN","GMTSPXU1",77,0)
ORDERPRO(GMPROV,GMLEN) ; Re-order and format providers for visit
"RTN","GMTSPXU1",78,0)
 N GMCNT,GMTSP,GMNODE,GMP
"RTN","GMTSPXU1",79,0)
 S GMCNT=0
"RTN","GMTSPXU1",80,0)
 F GMP="P","S","Z" S GMTSP="" F  S GMTSP=$O(^TMP("PXHSV",$J,GMTSIVD,GMTSVDF,"P",GMP,GMTSP)) Q:GMTSP'>0  D
"RTN","GMTSPXU1",81,0)
 . S GMNODE=^TMP("PXHSV",$J,GMTSIVD,GMTSVDF,"P",GMP,GMTSP)
"RTN","GMTSPXU1",82,0)
 . Q:GMNODE']""
"RTN","GMTSPXU1",83,0)
 . S GMCNT=GMCNT+1
"RTN","GMTSPXU1",84,0)
 . S GMPROV(GMCNT)=$E($P(GMNODE,U),1,GMLEN-4)_$S(GMP="P"!(GMP="S"):" ("_GMP_")",1:"")
"RTN","GMTSPXU1",85,0)
 Q
"RTN","GMTSPXU1",86,0)
 ;
"RTN","GMTSPXU1",87,0)
 ; The following code segments are called from "ROUTINE" type
"RTN","GMTSPXU1",88,0)
 ; Menu Options to display items in a file
"RTN","GMTSPXU1",89,0)
 ;
"RTN","GMTSPXU1",90,0)
LM ;   Entry Point - for GMTS Measurement Panel
"RTN","GMTSPXU1",91,0)
 S GMTSLST="^GMT(142.7," G DSPLST
"RTN","GMTSPXU1",92,0)
 ;
"RTN","GMTSPXU1",93,0)
DSPLST ;   Common code for Health Summary MNX Lists
"RTN","GMTSPXU1",94,0)
 K DIR
"RTN","GMTSPXU1",95,0)
 I '$D(@(GMTSLST_"""B"")")) W !,"NO ",$P(@(GMTSLST_"0)"),U),"S DEFINED.",! Q
"RTN","GMTSPXU1",96,0)
 W @IOF,!!,"Existing ",$P(@(GMTSLST_"0)"),U),"S:",! S GMTSCNT=""
"RTN","GMTSPXU1",97,0)
CONT ;   Continue
"RTN","GMTSPXU1",98,0)
 F  S GMTSCNT=$O(@(GMTSLST_"""B"",GMTSCNT)")) Q:GMTSCNT=""  D  G:1'[$G(Y)&($L($G(Y))) QUIT
"RTN","GMTSPXU1",99,0)
 . N DIR K Y W !,?5,GMTSCNT I (IOSL-3)<$Y S DIR(0)="E" D
"RTN","GMTSPXU1",100,0)
 . . D ^DIR W @IOF
"RTN","GMTSPXU1",101,0)
 K DIR S DIR(0)="E" D ^DIR W !
"RTN","GMTSPXU1",102,0)
QUIT ;   Quit
"RTN","GMTSPXU1",103,0)
 K DIR,X,Y,GMTSLST,GMTSCNT
"RTN","GMTSPXU1",104,0)
 Q
"RTN","GMTSPXU1",105,0)
GETICDCD(DATE,TYPE) ;
"RTN","GMTSPXU1",106,0)
 ; TYPE is either "PROC" or "DIAG"
"RTN","GMTSPXU1",107,0)
 ; DATE is the date you want to check the coding system for
"RTN","GMTSPXU1",108,0)
 N RET,OUT
"RTN","GMTSPXU1",109,0)
 I TYPE="DIAG" S TYPE="10D",RET="ICD-"
"RTN","GMTSPXU1",110,0)
 I TYPE="PROC" S TYPE="10P",RET="ICP-"
"RTN","GMTSPXU1",111,0)
 S OUT=10
"RTN","GMTSPXU1",112,0)
 I DATE<$$IMPDATE^LEXU(TYPE) S OUT=9
"RTN","GMTSPXU1",113,0)
 S RET=RET_OUT
"RTN","GMTSPXU1",114,0)
 Q RET
"VER")
8.0^22.0
**END**
**END**
