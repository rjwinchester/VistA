Released GMTS*2.7*127 SEQ #116
Extracted from mail message
**KIDS**:GMTS*2.7*127^

**INSTALL NAME**
GMTS*2.7*127
"BLD",11058,0)
GMTS*2.7*127^HEALTH SUMMARY^0^3190510^y
"BLD",11058,1,0)
^^6^6^3190131^
"BLD",11058,1,1,0)
This patch will resolve the following issues in the Health summary 
"BLD",11058,1,2,0)
package:
"BLD",11058,1,3,0)
 
"BLD",11058,1,4,0)
1. INC3453605 - If a user attempts to use the Health Summary component 
"BLD",11058,1,5,0)
Med Reconciliation (MRR1) on a patient with a quick order with the 
"BLD",11058,1,6,0)
quantity missing the error <SUBSCRIPT>OPTDISP+11^GMTSPST1 occurs
"BLD",11058,4,0)
^9.64PA^^
"BLD",11058,6.3)
4
"BLD",11058,"ABPKG")
n
"BLD",11058,"KRN",0)
^9.67PA^1.61^23
"BLD",11058,"KRN",.4,0)
.4
"BLD",11058,"KRN",.401,0)
.401
"BLD",11058,"KRN",.402,0)
.402
"BLD",11058,"KRN",.403,0)
.403
"BLD",11058,"KRN",.5,0)
.5
"BLD",11058,"KRN",.84,0)
.84
"BLD",11058,"KRN",1.6,0)
1.6
"BLD",11058,"KRN",1.61,0)
1.61
"BLD",11058,"KRN",1.62,0)
1.62
"BLD",11058,"KRN",3.6,0)
3.6
"BLD",11058,"KRN",3.8,0)
3.8
"BLD",11058,"KRN",9.2,0)
9.2
"BLD",11058,"KRN",9.8,0)
9.8
"BLD",11058,"KRN",9.8,"NM",0)
^9.68A^2^2
"BLD",11058,"KRN",9.8,"NM",1,0)
GMTSPSTN^^0^B185619877
"BLD",11058,"KRN",9.8,"NM",2,0)
GMTSPST1^^0^B172187216
"BLD",11058,"KRN",9.8,"NM","B","GMTSPST1",2)

"BLD",11058,"KRN",9.8,"NM","B","GMTSPSTN",1)

"BLD",11058,"KRN",19,0)
19
"BLD",11058,"KRN",19.1,0)
19.1
"BLD",11058,"KRN",101,0)
101
"BLD",11058,"KRN",409.61,0)
409.61
"BLD",11058,"KRN",771,0)
771
"BLD",11058,"KRN",779.2,0)
779.2
"BLD",11058,"KRN",870,0)
870
"BLD",11058,"KRN",8989.51,0)
8989.51
"BLD",11058,"KRN",8989.52,0)
8989.52
"BLD",11058,"KRN",8994,0)
8994
"BLD",11058,"KRN","B",.4,.4)

"BLD",11058,"KRN","B",.401,.401)

"BLD",11058,"KRN","B",.402,.402)

"BLD",11058,"KRN","B",.403,.403)

"BLD",11058,"KRN","B",.5,.5)

"BLD",11058,"KRN","B",.84,.84)

"BLD",11058,"KRN","B",1.6,1.6)

"BLD",11058,"KRN","B",1.61,1.61)

"BLD",11058,"KRN","B",1.62,1.62)

"BLD",11058,"KRN","B",3.6,3.6)

"BLD",11058,"KRN","B",3.8,3.8)

"BLD",11058,"KRN","B",9.2,9.2)

"BLD",11058,"KRN","B",9.8,9.8)

"BLD",11058,"KRN","B",19,19)

"BLD",11058,"KRN","B",19.1,19.1)

"BLD",11058,"KRN","B",101,101)

"BLD",11058,"KRN","B",409.61,409.61)

"BLD",11058,"KRN","B",771,771)

"BLD",11058,"KRN","B",779.2,779.2)

"BLD",11058,"KRN","B",870,870)

"BLD",11058,"KRN","B",8989.51,8989.51)

"BLD",11058,"KRN","B",8989.52,8989.52)

"BLD",11058,"KRN","B",8994,8994)

"BLD",11058,"QDEF")
^^^^NO^^^^NO^^NO
"BLD",11058,"QUES",0)
^9.62^^
"BLD",11058,"REQB",0)
^9.611^1^1
"BLD",11058,"REQB",1,0)
GMTS*2.7*94^1
"BLD",11058,"REQB","B","GMTS*2.7*94",1)

"MBREQ")
0
"PKG",240,-1)
1^1
"PKG",240,0)
HEALTH SUMMARY^GMTS^Integrated Health Summary Tools
"PKG",240,22,0)
^9.49I^1^1
"PKG",240,22,1,0)
2.7^2951020^2960313
"PKG",240,22,1,"PAH",1,0)
127^3190510
"PKG",240,22,1,"PAH",1,1,0)
^^6^6^3190510
"PKG",240,22,1,"PAH",1,1,1,0)
This patch will resolve the following issues in the Health summary 
"PKG",240,22,1,"PAH",1,1,2,0)
package:
"PKG",240,22,1,"PAH",1,1,3,0)
 
"PKG",240,22,1,"PAH",1,1,4,0)
1. INC3453605 - If a user attempts to use the Health Summary component 
"PKG",240,22,1,"PAH",1,1,5,0)
Med Reconciliation (MRR1) on a patient with a quick order with the 
"PKG",240,22,1,"PAH",1,1,6,0)
quantity missing the error <SUBSCRIPT>OPTDISP+11^GMTSPST1 occurs
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
2
"RTN","GMTSPST1")
0^2^B172187216^B167015680
"RTN","GMTSPST1",1,0)
GMTSPST1 ;BIR/RMS - MED RECON TOOL #1 (MED REC PROFILE) ;May 14, 2018@20:50
"RTN","GMTSPST1",2,0)
 ;;2.7;Health Summary;**94,127**;Oct 20, 1995;Build 4
"RTN","GMTSPST1",3,0)
 ;Reference to COVER^ORWPS supported by IA 4926
"RTN","GMTSPST1",4,0)
 ;References to ^ORRDI1 supported by IA 4659
"RTN","GMTSPST1",5,0)
 ;Reference to ^XTMP("ORRDI","PSOO" supported by IA 4660
"RTN","GMTSPST1",6,0)
 ;Reference to ^XTMP("ORRDI","OUTAGE INFO" supported by IA 5440
"RTN","GMTSPST1",7,0)
 ;Reference to ^PSOHCSUM supported by IA 330
"RTN","GMTSPST1",8,0)
 ;Reference to $$ISCLIN^ORUTL1 supported by IA 5691
"RTN","GMTSPST1",9,0)
 ;Reference to ^PS(51 supported by IA 1980
"RTN","GMTSPST1",10,0)
 ;Reference to file 53.1 supported by IA 534
"RTN","GMTSPST1",11,0)
 ;Reference to TEXT^ORQ12 supported by IA 4202
"RTN","GMTSPST1",12,0)
 ;Reference to $$PKGID^ORX8 supported by IA 3071
"RTN","GMTSPST1",13,0)
 ;Reference to BCMALG^PSJUTL2 supported by IA 5057
"RTN","GMTSPST1",14,0)
TOOL1 ;ENTRY POINT FOR HEALTH SUMMARY
"RTN","GMTSPST1",15,0)
 N ALPHA,DRUGNM,EXPDAYS,IND1,LIST,ORDER,PSNUM,RPC,RPCT,RPCNODE,SAVE,SAVERD
"RTN","GMTSPST1",16,0)
 D ADD^GMTSPSTR("GMTSPST1")
"RTN","GMTSPST1",17,0)
 S IND1=7,EXPDAYS=90
"RTN","GMTSPST1",18,0)
 D COVER^ORWPS(.RPC,DFN)
"RTN","GMTSPST1",19,0)
 S RPCT=0 F  S RPCT=$O(RPC(RPCT)) Q:'+RPCT  D
"RTN","GMTSPST1",20,0)
 . S RPCNODE=RPC(RPCT)
"RTN","GMTSPST1",21,0)
 . S PSNUM=$P(RPCNODE,U)
"RTN","GMTSPST1",22,0)
 . S DRUGNM=$$UP^XLFSTR($P(RPCNODE,U,2))
"RTN","GMTSPST1",23,0)
 . S ORDER=+$P(RPCNODE,U,3)
"RTN","GMTSPST1",24,0)
 . Q:DRUGNM']""!(ORDER=0)!(PSNUM']"")
"RTN","GMTSPST1",25,0)
 . S SAVERD=9999999-$$LRD(+$G(^OR(100,ORDER,4)))
"RTN","GMTSPST1",26,0)
 . S SAVE(DRUGNM,SAVERD,ORDER,PSNUM)=""
"RTN","GMTSPST1",27,0)
 . Q:("ACTIVE^ACTIVE/SUSP^ACTIVE/PARKED^HOLD^PENDING^ON CALL"'[$P(RPCNODE,U,4))&($P(PSNUM,";")["N")
"RTN","GMTSPST1",28,0)
 . S ALPHA(1,DRUGNM,ORDER,PSNUM)=$P(RPCNODE,U,4)
"RTN","GMTSPST1",29,0)
 D ADDREM
"RTN","GMTSPST1",30,0)
 D HEADER
"RTN","GMTSPST1",31,0)
 S LIST=1 D OUTPUT
"RTN","GMTSPST1",32,0)
 D CKP Q:$D(GMTSQIT)  W !
"RTN","GMTSPST1",33,0)
 D CKP Q:$D(GMTSQIT)  W !,$$REPEAT^XLFSTR("-",IOM-8)
"RTN","GMTSPST1",34,0)
 D CKP Q:$D(GMTSQIT)  W !,$$CJ^XLFSTR("SUPPLIES",IOM-8)
"RTN","GMTSPST1",35,0)
 D CKP Q:$D(GMTSQIT)  W !,$$REPEAT^XLFSTR("-",IOM-8)
"RTN","GMTSPST1",36,0)
 D CKP Q:$D(GMTSQIT)  W !
"RTN","GMTSPST1",37,0)
 S LIST=2 D OUTPUT
"RTN","GMTSPST1",38,0)
 D FOOTER
"RTN","GMTSPST1",39,0)
 Q
"RTN","GMTSPST1",40,0)
 ;
"RTN","GMTSPST1",41,0)
ADDREM ;USES RDI - REMOTE DATA INTEROPERABILITY TO INCORPORATE OUTSIDE MEDS
"RTN","GMTSPST1",42,0)
 N DOWN,MED,RDI,RNAM,RNUM,STAT,ISSUE
"RTN","GMTSPST1",43,0)
 Q:'$$HAVEHDR^ORRDI1
"RTN","GMTSPST1",44,0)
 D  Q:$G(DOWN)  ;Check for outage of RDI
"RTN","GMTSPST1",45,0)
 . I $D(^XTMP("ORRDI","OUTAGE INFO","DOWN")) H $$GET^XPAR("ALL","ORRDI PING FREQ")/2
"RTN","GMTSPST1",46,0)
 . I $D(^XTMP("ORRDI","OUTAGE INFO","DOWN")) S DOWN=1 D  Q:$D(GMTSQIT)
"RTN","GMTSPST1",47,0)
 .. D CKP Q:$D(GMTSQIT)
"RTN","GMTSPST1",48,0)
 .. W !,"WARNING: Connection to Remote Data Currently Down",!
"RTN","GMTSPST1",49,0)
 .. D CKP
"RTN","GMTSPST1",50,0)
 Q:$D(GMTSQIT)
"RTN","GMTSPST1",51,0)
 ;Get data for HFS file structure
"RTN","GMTSPST1",52,0)
 D SAVDEV^%ZISUTL("GMTSHFS")
"RTN","GMTSPST1",53,0)
 S RDI=$$GET^ORRDI1(DFN,"PSOO")
"RTN","GMTSPST1",54,0)
 D USE^%ZISUTL("GMTSHFS")
"RTN","GMTSPST1",55,0)
 D RMDEV^%ZISUTL("GMTSHFS")
"RTN","GMTSPST1",56,0)
 ;
"RTN","GMTSPST1",57,0)
 H 1 ;One extra second to allow ^XTMP replication across nodes
"RTN","GMTSPST1",58,0)
 I +RDI=-1 D  Q:$D(GMTSQIT)
"RTN","GMTSPST1",59,0)
 . D CKP Q:$D(GMTSQIT)
"RTN","GMTSPST1",60,0)
 . W !,"WARNING: Connection to Remote Data Not Available",!
"RTN","GMTSPST1",61,0)
 . D CKP
"RTN","GMTSPST1",62,0)
 Q:'$D(^XTMP("ORRDI","PSOO",DFN))
"RTN","GMTSPST1",63,0)
 S MED=0 F  S MED=$O(^XTMP("ORRDI","PSOO",DFN,MED)) Q:'+MED  D
"RTN","GMTSPST1",64,0)
 . S STAT=$G(^XTMP("ORRDI","PSOO",DFN,MED,5,0))
"RTN","GMTSPST1",65,0)
 . Q:STAT']""
"RTN","GMTSPST1",66,0)
 . Q:"ACTIVE^SUSPENDED^HOLD"'[STAT
"RTN","GMTSPST1",67,0)
 . Q:$G(^XTMP("ORRDI","PSOO",DFN,MED,7,0))']""  ;DoD:quit if there is no exp. date
"RTN","GMTSPST1",68,0)
 . D  Q:ISSUE<$$FMADD^XLFDT(DT,-366)  ;DoD: quit if ISSUE DATE > 1Y ago
"RTN","GMTSPST1",69,0)
 .. N %DT,X,Y
"RTN","GMTSPST1",70,0)
 .. S X=$G(^XTMP("ORRDI","PSOO",DFN,MED,8,0))
"RTN","GMTSPST1",71,0)
 .. D ^%DT
"RTN","GMTSPST1",72,0)
 .. S ISSUE=+Y
"RTN","GMTSPST1",73,0)
 . S RNAM=$G(^XTMP("ORRDI","PSOO",DFN,MED,2,0),"Unknown Drug")
"RTN","GMTSPST1",74,0)
 . S RNUM=$G(^XTMP("ORRDI","PSOO",DFN,MED,4,0))
"RTN","GMTSPST1",75,0)
 . Q:RNAM']""!(RNUM']"")
"RTN","GMTSPST1",76,0)
 . S ALPHA(1,RNAM,RNUM,MED_"X;R")=""
"RTN","GMTSPST1",77,0)
 Q
"RTN","GMTSPST1",78,0)
HEADER ;
"RTN","GMTSPST1",79,0)
 N NVADT,REPEAT
"RTN","GMTSPST1",80,0)
 S NVADT=$$NVADT
"RTN","GMTSPST1",81,0)
 D TEXTPRNT("HEADTXT1")
"RTN","GMTSPST1",82,0)
 D CKP Q:$D(GMTSQIT)
"RTN","GMTSPST1",83,0)
 W !,"Non-VA Meds Last Documented On: "
"RTN","GMTSPST1",84,0)
 W $S(+NVADT:$$FMTE^XLFDT(NVADT,"D"),1:"** Data not found **")
"RTN","GMTSPST1",85,0)
 D CKP Q:$D(GMTSQIT)
"RTN","GMTSPST1",86,0)
 W !,$$REPEAT^XLFSTR("*",IOM-8)
"RTN","GMTSPST1",87,0)
 D CKP Q:$D(GMTSQIT)  W !
"RTN","GMTSPST1",88,0)
 D CKP Q:$D(GMTSQIT)
"RTN","GMTSPST1",89,0)
 D TEXTPRNT("HEADTXT2")
"RTN","GMTSPST1",90,0)
 F REPEAT=1,2 D CKP Q:$D(GMTSQIT)  W !
"RTN","GMTSPST1",91,0)
 D CKP Q:$D(GMTSQIT)
"RTN","GMTSPST1",92,0)
 W !,$$REPEAT^XLFSTR("-",IOM-8)
"RTN","GMTSPST1",93,0)
 D CKP Q:$D(GMTSQIT)
"RTN","GMTSPST1",94,0)
 Q
"RTN","GMTSPST1",95,0)
TEXTPRNT(TEXTLOC) ;PRINT LINES OF TEXT FROM A LINE LABEL, ENDS WITH $$END
"RTN","GMTSPST1",96,0)
 N LINE,TLINE,LINETEXT
"RTN","GMTSPST1",97,0)
 S LINE=0 F  S LINE=LINE+1,TLINE=TEXTLOC_"+"_LINE S:TEXTLOC="FOOTER1" TLINE=TLINE_"^GMTSGLOS" S LINETEXT=$T(@TLINE) S LINETEXT=$E(LINETEXT,4,$L(LINETEXT)) Q:LINETEXT="$$END"  D
"RTN","GMTSPST1",98,0)
 . D CKP Q:$D(GMTSQIT)
"RTN","GMTSPST1",99,0)
 . W !,LINETEXT
"RTN","GMTSPST1",100,0)
 Q
"RTN","GMTSPST1",101,0)
OUTPUT N DRUGNM,ORDER,PSNUM
"RTN","GMTSPST1",102,0)
 N PACK,PACKREF,SIGLINE,ORDNUM
"RTN","GMTSPST1",103,0)
 N LASTACT,OTLINE
"RTN","GMTSPST1",104,0)
 S DRUGNM="" F  S DRUGNM=$O(ALPHA(LIST,DRUGNM)) Q:DRUGNM']""  D  K SAVE(DRUGNM) Q:$D(GMTSQIT)
"RTN","GMTSPST1",105,0)
 . S ORDER="" F  S ORDER=$O(ALPHA(LIST,DRUGNM,ORDER)) Q:ORDER']""  D  Q:$D(GMTSQIT)
"RTN","GMTSPST1",106,0)
 .. S PSNUM="" F  S PSNUM=$O(ALPHA(LIST,DRUGNM,ORDER,PSNUM)) Q:PSNUM']""  D  Q:$D(GMTSQIT)
"RTN","GMTSPST1",107,0)
 ... S PACK=$P(PSNUM,";",2),ORDNUM=$P(PSNUM,";")
"RTN","GMTSPST1",108,0)
 ... I $$ISSUPPLY(,DRUGNM) S ALPHA(2,DRUGNM,ORDER,PSNUM)=ALPHA(LIST,DRUGNM,ORDER,PSNUM) Q
"RTN","GMTSPST1",109,0)
 ... I PACK="I" D INPDISP W ! Q:$D(GMTSQIT)
"RTN","GMTSPST1",110,0)
 ... I PACK="O" D OPTDISP W ! Q:$D(GMTSQIT)
"RTN","GMTSPST1",111,0)
 ... I PACK="R" D RDIDISP W ! Q:$D(GMTSQIT)
"RTN","GMTSPST1",112,0)
 Q
"RTN","GMTSPST1",113,0)
INPDISP ;Display an Inpatient or Clinic Meds Entry
"RTN","GMTSPST1",114,0)
 N GMTSPST1,OALINE,ORIG,ORVP,PSIFN,WLINE,DIWL,DIWR,DIWF,TYPE,X,LASTBCMA,STATUS
"RTN","GMTSPST1",115,0)
 N DDNUM,DRUGDISP,ORY
"RTN","GMTSPST1",116,0)
 K ^UTILITY($J,"W")
"RTN","GMTSPST1",117,0)
 D CKP Q:$D(GMTSQIT)
"RTN","GMTSPST1",118,0)
 S STATUS=$G(ALPHA(LIST,DRUGNM,ORDER,PSNUM))
"RTN","GMTSPST1",119,0)
 S STATUS=$S(STATUS["ACTIVE":"Active",STATUS["HOLD":"On Hold",STATUS["PENDING":"Pending",STATUS["DISCONTINUED":"Discontinued",1:STATUS)
"RTN","GMTSPST1",120,0)
 ;W !,$S($$ISCLIN^ORUTL1(ORDER):"CLIN ",1:"INPT ")_DRUGNM_" (Status="_STATUS_")"
"RTN","GMTSPST1",121,0)
 D DRUGDSP^GMTSPSTN
"RTN","GMTSPST1",122,0)
 D IMOOD^ORIMO(.ORY,ORDER)
"RTN","GMTSPST1",123,0)
 W !,$S(ORY:"CLIN ",1:"INPT ")_DRUGDISP_" (Status="_STATUS_")"
"RTN","GMTSPST1",124,0)
 D CKP Q:$D(GMTSQIT)
"RTN","GMTSPST1",125,0)
 D DRGDSP2^GMTSPSTN
"RTN","GMTSPST1",126,0)
 D TEXT^ORQ12(.GMTSPST1,ORDER,80)
"RTN","GMTSPST1",127,0)
 S DIWL=IND1,DIWR=60,ORIG=$S(PSNUM["U":2,$$GET1^DIQ(53.1,+PSNUM,4,"I")="U":2,1:1)
"RTN","GMTSPST1",128,0)
 D:$E(GMTSPST1(1),1,7)="Change "
"RTN","GMTSPST1",129,0)
 . F OALINE=2:1:$O(GMTSPST1(":"),-1) I $E(GMTSPST1(OALINE),1,3)="to " S ORIG=OALINE,$E(GMTSPST1(OALINE),1,3)="" Q
"RTN","GMTSPST1",130,0)
 F OALINE=ORIG:1:$O(GMTSPST1(":"),-1) D
"RTN","GMTSPST1",131,0)
 . S X=$$LSIG($G(GMTSPST1(OALINE)))
"RTN","GMTSPST1",132,0)
 .; S X=$G(GMTSPST1(OALINE))
"RTN","GMTSPST1",133,0)
 . D ^DIWP
"RTN","GMTSPST1",134,0)
 S WLINE=0 F  S WLINE=$O(^UTILITY($J,"W",DIWL,WLINE)) Q:'+WLINE  D  Q:$D(GMTSQIT)
"RTN","GMTSPST1",135,0)
 . W !?DIWL,$G(^UTILITY($J,"W",DIWL,WLINE,0))
"RTN","GMTSPST1",136,0)
 . D CKP
"RTN","GMTSPST1",137,0)
 Q:$D(GMTSQIT)
"RTN","GMTSPST1",138,0)
 S LASTBCMA=$$BCMALG^PSJUTL2(DFN,ORDNUM)
"RTN","GMTSPST1",139,0)
 I LASTBCMA'="" W !?IND1,$$BCMALG^PSJUTL2(DFN,ORDNUM) D CKP Q:$D(GMTSQIT)
"RTN","GMTSPST1",140,0)
 Q
"RTN","GMTSPST1",141,0)
 ;
"RTN","GMTSPST1",142,0)
OPTDISP ;Display an Outpatient Prescription Entry
"RTN","GMTSPST1",143,0)
 N EXPDT,REFILLS,STATUS,DIWL,DIWR,PENDMED,GMTSPSTP,ORQLN,CANCELDT
"RTN","GMTSPST1",144,0)
 N ORDTYP,ORIGRX,QDFLAG
"RTN","GMTSPST1",145,0)
 K ^TMP($J,"GMTSPST1"),^UTILITY($J,"W")
"RTN","GMTSPST1",146,0)
 S PACKREF=$$PKGID^ORX8(ORDER)
"RTN","GMTSPST1",147,0)
 I PACKREF["S" D  Q
"RTN","GMTSPST1",148,0)
 . D PEN^PSO5241(DFN,"GMTSPST1",+PACKREF,ORDER)
"RTN","GMTSPST1",149,0)
 . D CKP Q:$D(GMTSQIT)
"RTN","GMTSPST1",150,0)
 . W !,"OUTPT "_DRUGNM_" (Status = Pending)"
"RTN","GMTSPST1",151,0)
 . D CKP Q:$D(GMTSQIT)
"RTN","GMTSPST1",152,0)
 . D TEXT^ORQ12(.GMTSPSTP,ORDER,60)
"RTN","GMTSPST1",153,0)
 . ;p127 mwa stopped previous instructions from showing, stopped subscript error, and leading space error
"RTN","GMTSPST1",154,0)
 . S ORQLN=1 F  S ORQLN=$O(GMTSPSTP(ORQLN)) Q:'+ORQLN  Q:$E(GMTSPSTP(ORQLN),1,3+$L($P(DRUGNM," ")))=("to "_$P(DRUGNM," ")) 
"RTN","GMTSPST1",155,0)
 . S:ORQLN="" ORQLN=1
"RTN","GMTSPST1",156,0)
 . F  S ORQLN=$O(GMTSPSTP(ORQLN)) Q:'+ORQLN  Q:(GMTSPSTP(ORQLN)?." "1"Quantity: ".E)  D
"RTN","GMTSPST1",157,0)
 .. W !?IND1,GMTSPSTP(ORQLN)
"RTN","GMTSPST1",158,0)
 .. D CKP Q:$D(GMTSQIT)
"RTN","GMTSPST1",159,0)
 . S ORIGRX=$P($G(^TMP($J,"GMTSPST1",DFN,+PACKREF,22.1)),U,2)
"RTN","GMTSPST1",160,0)
 . S ORDTYP=$P($G(^TMP($J,"GMTSPST1",DFN,+PACKREF,2)),U,1)
"RTN","GMTSPST1",161,0)
 . S QDFLAG=0 I ORIGRX]"",ORDTYP="RNW" D
"RTN","GMTSPST1",162,0)
 .. W !?10,"Renewed from Rx# "_ORIGRX
"RTN","GMTSPST1",163,0)
 .. D CKP Q:$D(QMTSQIT)
"RTN","GMTSPST1",164,0)
 .. W ?50,"Qty/Days Supply: "_$G(^TMP($J,"GMTSPST1",DFN,+PACKREF,12))_"/"_$G(^TMP($J,"GMTSPST1",DFN,+PACKREF,101))
"RTN","GMTSPST1",165,0)
 .. S QDFLAG=1 D CKP Q:$D(GMTSQIT)
"RTN","GMTSPST1",166,0)
 . W !?10,"Login Date: "_$$FMTE^XLFDT(+$G(^TMP($J,"GMTSPST1",DFN,+PACKREF,15)),"2D")
"RTN","GMTSPST1",167,0)
 . D CKP Q:$D(GMTSQIT)
"RTN","GMTSPST1",168,0)
 . I 'QDFLAG D
"RTN","GMTSPST1",169,0)
 .. W ?50,"Qty/Days Supply: "_$G(^TMP($J,"GMTSPST1",DFN,+PACKREF,12))_"/"_$G(^TMP($J,"GMTSPST1",DFN,+PACKREF,101))
"RTN","GMTSPST1",170,0)
 .. D CKP Q:$D(GMTSQIT)
"RTN","GMTSPST1",171,0)
 . W:'QDFLAG ! W ?50,"Refills Ordered: "_$G(^TMP($J,"GMTSPST1",DFN,+PACKREF,13))
"RTN","GMTSPST1",172,0)
 . D CKP Q:$D(GMTSQIT)
"RTN","GMTSPST1",173,0)
 D RX^PSO52API(DFN,"GMTSPST1",PACKREF)
"RTN","GMTSPST1",174,0)
 S EXPDT=$G(^TMP($J,"GMTSPST1",DFN,PACKREF,26))
"RTN","GMTSPST1",175,0)
 S CANCELDT=$G(^TMP($J,"GMTSPST1",DFN,PACKREF,26.1))
"RTN","GMTSPST1",176,0)
 S REFILLS=$G(^TMP($J,"GMTSPST1",DFN,PACKREF,9))-$S($G(^TMP($J,"GMTSPST1",DFN,PACKREF,"RF",0))>0:$G(^TMP($J,"GMTSPST1",DFN,PACKREF,"RF",0)),1:0)  ;need to make sure this is as accurate as the previous method in PSOQ0076
"RTN","GMTSPST1",177,0)
 S LASTREL=$$LRD(PACKREF)
"RTN","GMTSPST1",178,0)
 I $P(PSNUM,";")["N" G NVADISP
"RTN","GMTSPST1",179,0)
 I EXPDT Q:$$FMDIFF^XLFDT(DT,$P(EXPDT,U))>EXPDAYS
"RTN","GMTSPST1",180,0)
 I CANCELDT Q:$$FMDIFF^XLFDT(DT,$P(CANCELDT,U))>EXPDAYS
"RTN","GMTSPST1",181,0)
 S STATUS=$P($G(^TMP($J,"GMTSPST1",DFN,PACKREF,100)),U,2)
"RTN","GMTSPST1",182,0)
 S STATUS=$S(STATUS["ACTIVE":"Active",STATUS["SUSPENDED":"Active/Suspended",STATUS["HOLD":"On Hold",STATUS["DISCONTINUED":"Discontinued",1:STATUS)
"RTN","GMTSPST1",183,0)
 D CKP Q:$D(GMTSQIT)
"RTN","GMTSPST1",184,0)
 W !,"OUTPT "_DRUGNM_" (Status = "_STATUS_")"
"RTN","GMTSPST1",185,0)
 S DIWL=IND1,DIWR=72
"RTN","GMTSPST1",186,0)
 S SIGLINE=0 F  S SIGLINE=$O(^TMP($J,"GMTSPST1",DFN,PACKREF,"M",SIGLINE)) Q:'+SIGLINE  D  Q:$D(GMTSQIT)
"RTN","GMTSPST1",187,0)
 . S X=$G(^TMP($J,"GMTSPST1",DFN,PACKREF,"M",SIGLINE,0))
"RTN","GMTSPST1",188,0)
 . D ^DIWP
"RTN","GMTSPST1",189,0)
 S WLINE=0 F  S WLINE=$O(^UTILITY($J,"W",DIWL,WLINE)) Q:'+WLINE!($D(GMTSQIT))  D  Q:$D(GMTSQIT)
"RTN","GMTSPST1",190,0)
 . W !?DIWL,$G(^UTILITY($J,"W",DIWL,WLINE,0))
"RTN","GMTSPST1",191,0)
 . D CKP
"RTN","GMTSPST1",192,0)
 Q:$D(GMTSQIT)
"RTN","GMTSPST1",193,0)
 W !?10,"Rx# "_$G(^TMP($J,"GMTSPST1",DFN,PACKREF,.01))_" Last Released: "_$$FMTE^XLFDT(LASTREL,"2D"),?50,"Qty/Days Supply: "_$G(^TMP($J,"GMTSPST1",DFN,PACKREF,7))_"/"_$G(^TMP($J,"GMTSPST1",DFN,PACKREF,8)) D CKP Q:$D(GMTSQIT)
"RTN","GMTSPST1",194,0)
 W !?10,"Rx Expiration Date: ",$$FMTE^XLFDT(EXPDT,"2D"),?50,"Refills Remaining: ",REFILLS D CKP Q:$D(GMTSQIT)
"RTN","GMTSPST1",195,0)
 W ! D CKP
"RTN","GMTSPST1",196,0)
 Q
"RTN","GMTSPST1",197,0)
 ;
"RTN","GMTSPST1",198,0)
ISSUPPLY(DRUG,DRUGNAME) ;
"RTN","GMTSPST1",199,0)
 ; Function returns '1' if drug is a SUPPLY, '0' otherwise
"RTN","GMTSPST1",200,0)
 Q:LIST=2 0 ;Only check during regular med list, not in supply list
"RTN","GMTSPST1",201,0)
 N VACLASS,DEAHDLG
"RTN","GMTSPST1",202,0)
 K ^TMP($J,"GMTSPST1D")
"RTN","GMTSPST1",203,0)
 I +$G(DRUG) D DATA^PSS50(DRUG,,,,,"GMTSPST1D")
"RTN","GMTSPST1",204,0)
 E  D DATA^PSS50(,DRUGNAME,,,,"GMTSPST1D") S DRUG=$O(^TMP($J,"GMTSPST1D",0))
"RTN","GMTSPST1",205,0)
 I 'DRUG Q 0
"RTN","GMTSPST1",206,0)
 S VACLASS=$G(^TMP($J,"GMTSPST1D",DRUG,2))
"RTN","GMTSPST1",207,0)
 S DEAHDLG=$G(^TMP($J,"GMTSPST1D",DRUG,3))
"RTN","GMTSPST1",208,0)
 Q:$E(VACLASS,1,2)="XA" 1
"RTN","GMTSPST1",209,0)
 Q:$E(VACLASS,1,2)="XX" 1
"RTN","GMTSPST1",210,0)
 Q:(VACLASS="DX900")&(DEAHDLG["S") 1
"RTN","GMTSPST1",211,0)
 Q 0
"RTN","GMTSPST1",212,0)
 ;
"RTN","GMTSPST1",213,0)
RDIDISP ;Display a Remote Meds Entry
"RTN","GMTSPST1",214,0)
 D CKP Q:$D(GMTSQIT)
"RTN","GMTSPST1",215,0)
 W !,"Remote ",?IND1,DRUGNM D CKP Q:$D(GMTSQIT)
"RTN","GMTSPST1",216,0)
 N STATUS,DIWL,DIWR,DIWF,X,WLINE
"RTN","GMTSPST1",217,0)
 K ^UTILITY($J,"W")
"RTN","GMTSPST1",218,0)
 S X=$G(^XTMP("ORRDI","PSOO",DFN,+ORDNUM,14,0)),DIWL=IND1,DIWR=60
"RTN","GMTSPST1",219,0)
 D ^DIWP
"RTN","GMTSPST1",220,0)
 S WLINE=0 F  S WLINE=$O(^UTILITY($J,"W",DIWL,WLINE)) Q:'+WLINE  D  Q:$D(GMTSQIT)
"RTN","GMTSPST1",221,0)
 . D CKP Q:$D(GMTSQIT)
"RTN","GMTSPST1",222,0)
 . W !?DIWL,$G(^UTILITY($J,"W",DIWL,WLINE,0))
"RTN","GMTSPST1",223,0)
 D CKP Q:$D(GMTSQIT)
"RTN","GMTSPST1",224,0)
 S STATUS=$G(^XTMP("ORRDI","PSOO",DFN,+ORDNUM,5,0))
"RTN","GMTSPST1",225,0)
 S STATUS=$S(STATUS["ACTIVE":"Active",STATUS["SUSPENDED":"Active/Suspended",STATUS["HOLD":"Hold",1:"Unknown")
"RTN","GMTSPST1",226,0)
 W !?10,"Last Filled: "_$G(^XTMP("ORRDI","PSOO",DFN,+ORDNUM,9,0))_" ("_STATUS_" at "_$G(^XTMP("ORRDI","PSOO",DFN,+ORDNUM,1,0))_") "
"RTN","GMTSPST1",227,0)
 W !?10,"Rx Expiration Date: ",$G(^XTMP("ORRDI","PSOO",DFN,+ORDNUM,7,0)),?55,"Days Supply: "_$P($P($G(^XTMP("ORRDI","PSOO",DFN,+ORDNUM,6,0)),";",2),"D",2)
"RTN","GMTSPST1",228,0)
 Q
"RTN","GMTSPST1",229,0)
 ;
"RTN","GMTSPST1",230,0)
NVADISP ;Display a Non-VA Medication Entry
"RTN","GMTSPST1",231,0)
 N GMTSPST1,OALINE,ORIG,WLINE,DIWL,DIWR,DIWF,X
"RTN","GMTSPST1",232,0)
 K ^UTILITY($J,"W")
"RTN","GMTSPST1",233,0)
 D CKP Q:$D(GMTSQIT)
"RTN","GMTSPST1",234,0)
 W !,"Non-VA "_DRUGNM D CKP Q:$D(GMTSQIT)
"RTN","GMTSPST1",235,0)
 D TEXT^ORQ12(.GMTSPST1,ORDER,80)
"RTN","GMTSPST1",236,0)
 S DIWL=IND1,DIWR=60,ORIG=2
"RTN","GMTSPST1",237,0)
 D:$E(GMTSPST1(1),1,7)="Change "
"RTN","GMTSPST1",238,0)
 . F OALINE=2:1:$O(GMTSPST1(":"),-1) I $E(GMTSPST1(OALINE),1,3)="to " S ORIG=OALINE+1 Q
"RTN","GMTSPST1",239,0)
 F OALINE=ORIG:1:$O(GMTSPST1(":"),-1) D
"RTN","GMTSPST1",240,0)
 . S X=$$LSIG($G(GMTSPST1(OALINE)))
"RTN","GMTSPST1",241,0)
 . D ^DIWP
"RTN","GMTSPST1",242,0)
 S WLINE=0 F  S WLINE=$O(^UTILITY($J,"W",DIWL,WLINE)) Q:'+WLINE  D  Q:$D(GMTSQIT)
"RTN","GMTSPST1",243,0)
 . W !?DIWL,$G(^UTILITY($J,"W",DIWL,WLINE,0))
"RTN","GMTSPST1",244,0)
 . D CKP
"RTN","GMTSPST1",245,0)
 W ! D CKP Q:$D(GMTSQIT)
"RTN","GMTSPST1",246,0)
 Q
"RTN","GMTSPST1",247,0)
FOOTER ;Report footer for older medication entries
"RTN","GMTSPST1",248,0)
 D CKP Q:$D(GMTSQIT)  W !
"RTN","GMTSPST1",249,0)
 D TEXTPRNT("FOOTER1")
"RTN","GMTSPST1",250,0)
 Q
"RTN","GMTSPST1",251,0)
OPTFOOT ;Actual display for outpatient footer
"RTN","GMTSPST1",252,0)
 N LASTREL,FOOTTXT,DAYSSUPP,STATUS
"RTN","GMTSPST1",253,0)
 K ^TMP($J,"GMTSPST1")
"RTN","GMTSPST1",254,0)
 S PACKREF=$$PKGID^ORX8(ORDER)
"RTN","GMTSPST1",255,0)
 S LASTREL=$$LRD(PACKREF)
"RTN","GMTSPST1",256,0)
 Q:LASTREL<$$FMADD^XLFDT(DT,-365)
"RTN","GMTSPST1",257,0)
 Q:$P(PSNUM,";")["N"
"RTN","GMTSPST1",258,0)
 D CKP Q:$D(GMTSQIT)
"RTN","GMTSPST1",259,0)
 W !,"OPT "_DRUGNM D CKP Q:$D(GMTSQIT)
"RTN","GMTSPST1",260,0)
 D RX^PSO52API(DFN,"GMTSPST1",PACKREF)
"RTN","GMTSPST1",261,0)
 S STATUS=$P($G(^TMP($J,"GMTSPST1",DFN,PACKREF,100)),U,2)
"RTN","GMTSPST1",262,0)
 S DAYSSUPP=$G(^TMP($J,"GMTSPST1",DFN,PACKREF,8))
"RTN","GMTSPST1",263,0)
 S FOOTTXT="("_STATUS_"/"_DAYSSUPP_" Days Supply Last Released: "_$$FMTE^XLFDT(LASTREL,"2D")_")"
"RTN","GMTSPST1",264,0)
 W $$RJ^XLFSTR(FOOTTXT,74) D CKP Q:$D(GMTSQIT)
"RTN","GMTSPST1",265,0)
 S SIGLINE=0 F  S SIGLINE=$O(^TMP($J,"GMTSPST1",DFN,PACKREF,"M",SIGLINE)) Q:'+SIGLINE  D  Q:$D(GMTSQIT)
"RTN","GMTSPST1",266,0)
 . W !?IND1,$G(^TMP($J,"GMTSPST1",DFN,PACKREF,"M",SIGLINE,0))
"RTN","GMTSPST1",267,0)
 . D CKP
"RTN","GMTSPST1",268,0)
 D CKP
"RTN","GMTSPST1",269,0)
 Q
"RTN","GMTSPST1",270,0)
NVADT() ;Replaces call previously in ^PSOQCF04
"RTN","GMTSPST1",271,0)
 N NVAL,NVARR
"RTN","GMTSPST1",272,0)
 D ^PSOHCSUM
"RTN","GMTSPST1",273,0)
 Q:'$D(^TMP("PSOO",$J,"NVA")) ""
"RTN","GMTSPST1",274,0)
 S NVAL=0 F  S NVAL=$O(^TMP("PSOO",$J,"NVA",NVAL)) Q:'+NVAL  D
"RTN","GMTSPST1",275,0)
 . S NVADT=9999999-$P($G(^TMP("PSOO",$J,"NVA",NVAL,0)),"^",5)
"RTN","GMTSPST1",276,0)
 . S NVARR(NVADT)=""
"RTN","GMTSPST1",277,0)
 S NVADT=$O(NVARR(0)) Q:NVADT=9999999 ""
"RTN","GMTSPST1",278,0)
 Q 9999999-NVADT
"RTN","GMTSPST1",279,0)
LSIG(SIG) ;Expand a SIG
"RTN","GMTSPST1",280,0)
 N P,SGY,X
"RTN","GMTSPST1",281,0)
 S SGY="" F P=1:1:$L(SIG," ") S X=$P(SIG," ",P) D:X]""  ;
"RTN","GMTSPST1",282,0)
 .I $D(^PS(51,"A",X)) S %=^(X),X=$P(%,"^") I $P(%,"^",2)]"" S Y=$P(SIG," ",P-1),Y=$E(Y,$L(Y)) S:Y>1 X=$P(%,"^",2)
"RTN","GMTSPST1",283,0)
 .S SGY=SGY_X_" "
"RTN","GMTSPST1",284,0)
 Q SGY
"RTN","GMTSPST1",285,0)
LRD(PACKREF) ;Calculate LAST RELEASE DATE as latest of original + refill relDates
"RTN","GMTSPST1",286,0)
 N RELDT,REFDT,CTR,ANS
"RTN","GMTSPST1",287,0)
 K ^TMP($J,"GMTSLRD")
"RTN","GMTSPST1",288,0)
 S ANS=""
"RTN","GMTSPST1",289,0)
 D RX^PSO52API(DFN,"GMTSLRD",PACKREF,,"3,R")
"RTN","GMTSPST1",290,0)
 S RELDT=$G(^TMP($J,"GMTSLRD",DFN,PACKREF,31))
"RTN","GMTSPST1",291,0)
 S ANS=RELDT
"RTN","GMTSPST1",292,0)
 S CTR=0 F  S CTR=$O(^TMP($J,"GMTSLRD",DFN,PACKREF,"RF",CTR)) Q:'+CTR  D  ;
"RTN","GMTSPST1",293,0)
 . S REFDT=$G(^TMP($J,"GMTSLRD",DFN,PACKREF,"RF",CTR,17))
"RTN","GMTSPST1",294,0)
 . I REFDT>ANS S ANS=REFDT
"RTN","GMTSPST1",295,0)
 K ^TMP($J,"GMTSLRD")
"RTN","GMTSPST1",296,0)
 Q ANS
"RTN","GMTSPST1",297,0)
 ;
"RTN","GMTSPST1",298,0)
CKP D CKP^GMTSUP Q
"RTN","GMTSPST1",299,0)
 ;
"RTN","GMTSPST1",300,0)
HEADTXT1 ;;
"RTN","GMTSPST1",301,0)
 ;;INCLUDED IN THIS LIST:  Alphabetical list of active outpatient
"RTN","GMTSPST1",302,0)
 ;;prescriptions dispensed from this VA (local) and dispensed from another
"RTN","GMTSPST1",303,0)
 ;;VA or DoD facility (remote) as well as inpatient orders (local pending and
"RTN","GMTSPST1",304,0)
 ;;active), local clinic medications, locally documented non-VA medications,
"RTN","GMTSPST1",305,0)
 ;;and local prescriptions that have expired or been discontinued in the past
"RTN","GMTSPST1",306,0)
 ;;90 days.
"RTN","GMTSPST1",307,0)
 ;;
"RTN","GMTSPST1",308,0)
 ;;$$END
"RTN","GMTSPST1",309,0)
HEADTXT2 ;;
"RTN","GMTSPST1",310,0)
 ;;***NOTE*** The display of VA prescriptions dispensed from another VA or
"RTN","GMTSPST1",311,0)
 ;;DoD facility (remote) is limited to active outpatient prescription entries
"RTN","GMTSPST1",312,0)
 ;;matched to National Drug File at the originating site and may not include
"RTN","GMTSPST1",313,0)
 ;;some items such as investigational drugs, compounds, etc.
"RTN","GMTSPST1",314,0)
 ;;
"RTN","GMTSPST1",315,0)
 ;;NOT INCLUDED IN THIS LIST: Medications self-entered by the patient into
"RTN","GMTSPST1",316,0)
 ;;personal health records (i.e. My HealtheVet) are NOT included in this
"RTN","GMTSPST1",317,0)
 ;;list. Non-VA medications documented outside this VA, remote inpatient
"RTN","GMTSPST1",318,0)
 ;;orders (regardless of status) and remote clinic medications are NOT
"RTN","GMTSPST1",319,0)
 ;;included in this list. The patient and provider must always discuss
"RTN","GMTSPST1",320,0)
 ;;medications the patient is taking, regardless of where the medication was
"RTN","GMTSPST1",321,0)
 ;;dispensed or obtained.
"RTN","GMTSPST1",322,0)
 ;;$$END
"RTN","GMTSPSTN")
0^1^B185619877^B180171627
"RTN","GMTSPSTN",1,0)
GMTSPSTN ;BIR/RMS - MED RECON TOOL #1 NO GLOSSARY (MED REC PROFILE) ;May 14, 2018@20:52
"RTN","GMTSPSTN",2,0)
 ;;2.7;Health Summary;**94,127**;Oct 20, 1995;Build 4
"RTN","GMTSPSTN",3,0)
 ;Reference to COVER^ORWPS supported by IA 4926
"RTN","GMTSPSTN",4,0)
 ;References to ^ORRDI1 supported by IA 4659
"RTN","GMTSPSTN",5,0)
 ;Reference to ^XTMP("ORRDI","PSOO" supported by IA 4660
"RTN","GMTSPSTN",6,0)
 ;Reference to ^XTMP("ORRDI","OUTAGE INFO" supported by IA 5440
"RTN","GMTSPSTN",7,0)
 ;Reference to ^PSOHCSUM supported by IA 330
"RTN","GMTSPSTN",8,0)
 ;Reference to $$ISCLIN^ORUTL1 supported by IA 5691
"RTN","GMTSPSTN",9,0)
 ;Reference to ^PS(51 supported by IA 1980
"RTN","GMTSPSTN",10,0)
 ;Reference to file 53.1 supported by IA 534
"RTN","GMTSPSTN",11,0)
 ;Reference to TEXT^ORQ12 supported by IA 4202
"RTN","GMTSPSTN",12,0)
 ;Reference to $$PKGID^ORX8 supported by IA 3071
"RTN","GMTSPSTN",13,0)
 ;Reference to BCMALG^PSJUTL2 supported by IA 5057
"RTN","GMTSPSTN",14,0)
 ;Reference to OEL^PSOORRL supported by IA 2400
"RTN","GMTSPSTN",15,0)
TOOL1 ;ENTRY POINT FOR HEALTH SUMMARY
"RTN","GMTSPSTN",16,0)
 N ALPHA,DRUGNM,EXPDAYS,IND1,LIST,ORDER,PSNUM,RPC,RPCT,RPCNODE,SAVE,SAVERD
"RTN","GMTSPSTN",17,0)
 D ADD^GMTSPSTR("GMTSPSTN")
"RTN","GMTSPSTN",18,0)
 S IND1=7,EXPDAYS=90
"RTN","GMTSPSTN",19,0)
 D COVER^ORWPS(.RPC,DFN)
"RTN","GMTSPSTN",20,0)
 S RPCT=0 F  S RPCT=$O(RPC(RPCT)) Q:'+RPCT  D
"RTN","GMTSPSTN",21,0)
 . S RPCNODE=RPC(RPCT)
"RTN","GMTSPSTN",22,0)
 . S PSNUM=$P(RPCNODE,U)
"RTN","GMTSPSTN",23,0)
 . S DRUGNM=$$UP^XLFSTR($P(RPCNODE,U,2))
"RTN","GMTSPSTN",24,0)
 . S ORDER=+$P(RPCNODE,U,3)
"RTN","GMTSPSTN",25,0)
 . Q:DRUGNM']""!(ORDER=0)!(PSNUM']"")
"RTN","GMTSPSTN",26,0)
 . S SAVERD=9999999-$$LRD(+$G(^OR(100,ORDER,4)))
"RTN","GMTSPSTN",27,0)
 . S SAVE(DRUGNM,SAVERD,ORDER,PSNUM)=""
"RTN","GMTSPSTN",28,0)
 . Q:("ACTIVE^ACTIVE/SUSP^ACTIVE/PARKED^HOLD^PENDING^ON CALL"'[$P(RPCNODE,U,4))&($P(PSNUM,";")["N")
"RTN","GMTSPSTN",29,0)
 . S ALPHA(1,DRUGNM,ORDER,PSNUM)=$P(RPCNODE,U,4)
"RTN","GMTSPSTN",30,0)
 D ADDREM
"RTN","GMTSPSTN",31,0)
 D HEADER
"RTN","GMTSPSTN",32,0)
 S LIST=1 D OUTPUT
"RTN","GMTSPSTN",33,0)
 D CKP Q:$D(GMTSQIT)  W !
"RTN","GMTSPSTN",34,0)
 D CKP Q:$D(GMTSQIT)  W !,$$REPEAT^XLFSTR("-",IOM-8)
"RTN","GMTSPSTN",35,0)
 D CKP Q:$D(GMTSQIT)  W !,$$CJ^XLFSTR("SUPPLIES",IOM-8)
"RTN","GMTSPSTN",36,0)
 D CKP Q:$D(GMTSQIT)  W !,$$REPEAT^XLFSTR("-",IOM-8)
"RTN","GMTSPSTN",37,0)
 D CKP Q:$D(GMTSQIT)  W !
"RTN","GMTSPSTN",38,0)
 S LIST=2 D OUTPUT
"RTN","GMTSPSTN",39,0)
 Q
"RTN","GMTSPSTN",40,0)
 ;
"RTN","GMTSPSTN",41,0)
ADDREM ;USES RDI - REMOTE DATA INTEROPERABILITY TO INCORPORATE OUTSIDE MEDS
"RTN","GMTSPSTN",42,0)
 N DOWN,MED,RDI,RNAM,RNUM,STAT,ISSUE
"RTN","GMTSPSTN",43,0)
 Q:'$$HAVEHDR^ORRDI1
"RTN","GMTSPSTN",44,0)
 D  Q:$G(DOWN)  ;Check for outage of RDI
"RTN","GMTSPSTN",45,0)
 . I $D(^XTMP("ORRDI","OUTAGE INFO","DOWN")) H $$GET^XPAR("ALL","ORRDI PING FREQ")/2
"RTN","GMTSPSTN",46,0)
 . I $D(^XTMP("ORRDI","OUTAGE INFO","DOWN")) S DOWN=1 D  Q:$D(GMTSQIT)
"RTN","GMTSPSTN",47,0)
 .. D CKP Q:$D(GMTSQIT)
"RTN","GMTSPSTN",48,0)
 .. W !,"WARNING: Connection to Remote Data Currently Down",!
"RTN","GMTSPSTN",49,0)
 .. D CKP
"RTN","GMTSPSTN",50,0)
 Q:$D(GMTSQIT)
"RTN","GMTSPSTN",51,0)
 ;Get data for HFS file structure
"RTN","GMTSPSTN",52,0)
 D SAVDEV^%ZISUTL("GMTSHFS")
"RTN","GMTSPSTN",53,0)
 S RDI=$$GET^ORRDI1(DFN,"PSOO")
"RTN","GMTSPSTN",54,0)
 D USE^%ZISUTL("GMTSHFS")
"RTN","GMTSPSTN",55,0)
 D RMDEV^%ZISUTL("GMTSHFS")
"RTN","GMTSPSTN",56,0)
 ;
"RTN","GMTSPSTN",57,0)
 H 1 ;One extra second to allow ^XTMP replication across nodes
"RTN","GMTSPSTN",58,0)
 I +RDI=-1 D  Q:$D(GMTSQIT)
"RTN","GMTSPSTN",59,0)
 . D CKP Q:$D(GMTSQIT)
"RTN","GMTSPSTN",60,0)
 . W !,"WARNING: Connection to Remote Data Not Available",!
"RTN","GMTSPSTN",61,0)
 . D CKP
"RTN","GMTSPSTN",62,0)
 Q:'$D(^XTMP("ORRDI","PSOO",DFN))
"RTN","GMTSPSTN",63,0)
 S MED=0 F  S MED=$O(^XTMP("ORRDI","PSOO",DFN,MED)) Q:'+MED  D
"RTN","GMTSPSTN",64,0)
 . S STAT=$G(^XTMP("ORRDI","PSOO",DFN,MED,5,0))
"RTN","GMTSPSTN",65,0)
 . Q:STAT']""
"RTN","GMTSPSTN",66,0)
 . Q:"ACTIVE^SUSPENDED^HOLD"'[STAT
"RTN","GMTSPSTN",67,0)
 . Q:$G(^XTMP("ORRDI","PSOO",DFN,MED,7,0))']""  ;DoD:quit if there is no exp. date
"RTN","GMTSPSTN",68,0)
 . D  Q:ISSUE<$$FMADD^XLFDT(DT,-366)  ;DoD: quit if ISSUE DATE > 1Y ago
"RTN","GMTSPSTN",69,0)
 .. N %DT,X,Y
"RTN","GMTSPSTN",70,0)
 .. S X=$G(^XTMP("ORRDI","PSOO",DFN,MED,8,0))
"RTN","GMTSPSTN",71,0)
 .. D ^%DT
"RTN","GMTSPSTN",72,0)
 .. S ISSUE=+Y
"RTN","GMTSPSTN",73,0)
 . S RNAM=$G(^XTMP("ORRDI","PSOO",DFN,MED,2,0),"Unknown Drug")
"RTN","GMTSPSTN",74,0)
 . S RNUM=$G(^XTMP("ORRDI","PSOO",DFN,MED,4,0))
"RTN","GMTSPSTN",75,0)
 . Q:RNAM']""!(RNUM']"")
"RTN","GMTSPSTN",76,0)
 . S ALPHA(1,RNAM,RNUM,MED_"X;R")=""
"RTN","GMTSPSTN",77,0)
 Q
"RTN","GMTSPSTN",78,0)
HEADER ;
"RTN","GMTSPSTN",79,0)
 N NVADT,REPEAT
"RTN","GMTSPSTN",80,0)
 S NVADT=$$NVADT
"RTN","GMTSPSTN",81,0)
 D TEXTPRNT("HEADTXT1")
"RTN","GMTSPSTN",82,0)
 D CKP Q:$D(GMTSQIT)
"RTN","GMTSPSTN",83,0)
 W !,"Non-VA Meds Last Documented On: "
"RTN","GMTSPSTN",84,0)
 W $S(+NVADT:$$FMTE^XLFDT(NVADT,"D"),1:"** Data not found **")
"RTN","GMTSPSTN",85,0)
 D CKP Q:$D(GMTSQIT)
"RTN","GMTSPSTN",86,0)
 W !,$$REPEAT^XLFSTR("*",IOM-8)
"RTN","GMTSPSTN",87,0)
 D CKP Q:$D(GMTSQIT)  W !
"RTN","GMTSPSTN",88,0)
 D CKP Q:$D(GMTSQIT)
"RTN","GMTSPSTN",89,0)
 D TEXTPRNT("HEADTXT2")
"RTN","GMTSPSTN",90,0)
 F REPEAT=1,2 D CKP Q:$D(GMTSQIT)  W !
"RTN","GMTSPSTN",91,0)
 D CKP Q:$D(GMTSQIT)
"RTN","GMTSPSTN",92,0)
 W !,$$REPEAT^XLFSTR("-",IOM-8)
"RTN","GMTSPSTN",93,0)
 D CKP Q:$D(GMTSQIT)
"RTN","GMTSPSTN",94,0)
 Q
"RTN","GMTSPSTN",95,0)
TEXTPRNT(TEXTLOC) ;PRINT LINES OF TEXT FROM A LINE LABEL, ENDS WITH $$END
"RTN","GMTSPSTN",96,0)
 N LINE,TLINE,LINETEXT
"RTN","GMTSPSTN",97,0)
 S LINE=0 F  S LINE=LINE+1,TLINE=TEXTLOC_"+"_LINE,LINETEXT=$T(@TLINE) S LINETEXT=$E(LINETEXT,4,$L(LINETEXT)) Q:LINETEXT="$$END"  D
"RTN","GMTSPSTN",98,0)
 . D CKP Q:$D(GMTSQIT)
"RTN","GMTSPSTN",99,0)
 . W !,LINETEXT
"RTN","GMTSPSTN",100,0)
 Q
"RTN","GMTSPSTN",101,0)
OUTPUT N DRUGNM,ORDER,PSNUM
"RTN","GMTSPSTN",102,0)
 N PACK,PACKREF,SIGLINE,ORDNUM
"RTN","GMTSPSTN",103,0)
 N LASTACT,OTLINE
"RTN","GMTSPSTN",104,0)
 S DRUGNM="" F  S DRUGNM=$O(ALPHA(LIST,DRUGNM)) Q:DRUGNM']""  D  K SAVE(DRUGNM) Q:$D(GMTSQIT)
"RTN","GMTSPSTN",105,0)
 . S ORDER="" F  S ORDER=$O(ALPHA(LIST,DRUGNM,ORDER)) Q:ORDER']""  D  Q:$D(GMTSQIT)
"RTN","GMTSPSTN",106,0)
 .. S PSNUM="" F  S PSNUM=$O(ALPHA(LIST,DRUGNM,ORDER,PSNUM)) Q:PSNUM']""  D  Q:$D(GMTSQIT)
"RTN","GMTSPSTN",107,0)
 ... S PACK=$P(PSNUM,";",2),ORDNUM=$P(PSNUM,";")
"RTN","GMTSPSTN",108,0)
 ... I $$ISSUPPLY(,DRUGNM) S ALPHA(2,DRUGNM,ORDER,PSNUM)=ALPHA(LIST,DRUGNM,ORDER,PSNUM) Q
"RTN","GMTSPSTN",109,0)
 ... I PACK="I" D INPDISP W ! Q:$D(GMTSQIT)
"RTN","GMTSPSTN",110,0)
 ... I PACK="O" D OPTDISP W ! Q:$D(GMTSQIT)
"RTN","GMTSPSTN",111,0)
 ... I PACK="R" D RDIDISP W ! Q:$D(GMTSQIT)
"RTN","GMTSPSTN",112,0)
 Q
"RTN","GMTSPSTN",113,0)
INPDISP ;Display an Inpatient or Clinic Meds Entry
"RTN","GMTSPSTN",114,0)
 N GMTSPSTN,OALINE,OR0,ORIG,ORVP,PSIFN,WLINE,DIWL,DIWR,DIWF,TYPE,X,LASTBCMA,STATUS
"RTN","GMTSPSTN",115,0)
 N DDNUM,DRUGDISP,ORY
"RTN","GMTSPSTN",116,0)
 K ^UTILITY($J,"W")
"RTN","GMTSPSTN",117,0)
 D CKP Q:$D(GMTSQIT)
"RTN","GMTSPSTN",118,0)
 S STATUS=$G(ALPHA(LIST,DRUGNM,ORDER,PSNUM))
"RTN","GMTSPSTN",119,0)
 S STATUS=$S(STATUS["ACTIVE":"Active",STATUS["HOLD":"On Hold",STATUS["PENDING":"Pending",STATUS["DISCONTINUED":"Discontinued",1:STATUS)
"RTN","GMTSPSTN",120,0)
 ;W !,$S($$ISCLIN^ORUTL1(ORDER):"CLIN ",1:"INPT ")_DRUGNM_" (Status="_STATUS_")"
"RTN","GMTSPSTN",121,0)
 D DRUGDSP
"RTN","GMTSPSTN",122,0)
 D IMOOD^ORIMO(.ORY,ORDER)
"RTN","GMTSPSTN",123,0)
 W !,$S(ORY:"CLIN ",1:"INPT ")_DRUGDISP_" (Status="_STATUS_")"
"RTN","GMTSPSTN",124,0)
 D CKP Q:$D(GMTSQIT)
"RTN","GMTSPSTN",125,0)
 D DRGDSP2
"RTN","GMTSPSTN",126,0)
 D TEXT^ORQ12(.GMTSPSTN,ORDER,80)
"RTN","GMTSPSTN",127,0)
 S DIWL=IND1,DIWR=60,ORIG=$S(PSNUM["U":2,$$GET1^DIQ(53.1,+PSNUM,4,"I")="U":2,1:1)
"RTN","GMTSPSTN",128,0)
 D:$E(GMTSPSTN(1),1,7)="Change "
"RTN","GMTSPSTN",129,0)
 . F OALINE=2:1:$O(GMTSPSTN(":"),-1) I $E(GMTSPSTN(OALINE),1,3)="to " S ORIG=OALINE,$E(GMTSPSTN(OALINE),1,3)="" Q
"RTN","GMTSPSTN",130,0)
 F OALINE=ORIG:1:$O(GMTSPSTN(":"),-1) D
"RTN","GMTSPSTN",131,0)
 . S X=$$LSIG($G(GMTSPSTN(OALINE)))
"RTN","GMTSPSTN",132,0)
 .; S X=$G(GMTSPSTN(OALINE))
"RTN","GMTSPSTN",133,0)
 . D ^DIWP
"RTN","GMTSPSTN",134,0)
 S WLINE=0 F  S WLINE=$O(^UTILITY($J,"W",DIWL,WLINE)) Q:'+WLINE  D  Q:$D(GMTSQIT)
"RTN","GMTSPSTN",135,0)
 . W !?DIWL,$G(^UTILITY($J,"W",DIWL,WLINE,0))
"RTN","GMTSPSTN",136,0)
 . D CKP
"RTN","GMTSPSTN",137,0)
 Q:$D(GMTSQIT)
"RTN","GMTSPSTN",138,0)
 S LASTBCMA=$$BCMALG^PSJUTL2(DFN,ORDNUM)
"RTN","GMTSPSTN",139,0)
 I LASTBCMA'="" W !?IND1,$$BCMALG^PSJUTL2(DFN,ORDNUM) D CKP Q:$D(GMTSQIT)
"RTN","GMTSPSTN",140,0)
 Q
"RTN","GMTSPSTN",141,0)
 ;
"RTN","GMTSPSTN",142,0)
DRUGDSP ; Get Medication with Dosage
"RTN","GMTSPSTN",143,0)
 S PSIFN=$G(^OR(100,ORDER,4)),OR0=$G(^OR(100,ORDER,0)),TYPE=$P(OR0,U,12)
"RTN","GMTSPSTN",144,0)
 S ORVP=$P(OR0,U,2) K ^TMP("PS",$J)
"RTN","GMTSPSTN",145,0)
 D OEL^PSOORRL(+ORVP,PSIFN_";"_TYPE)   ; IA 2400
"RTN","GMTSPSTN",146,0)
 S DRUGDISP="" I $P($G(^TMP("PS",$J,"DD",1,0)),U,1)]"" D
"RTN","GMTSPSTN",147,0)
 . S DRUGDISP=$$GET1^DIQ(50,+$P(^TMP("PS",$J,"DD",1,0),U,1)_",",.01)
"RTN","GMTSPSTN",148,0)
 S DRUGDISP=$S(DRUGDISP]"":DRUGDISP,1:DRUGNM)
"RTN","GMTSPSTN",149,0)
 Q
"RTN","GMTSPSTN",150,0)
 ;
"RTN","GMTSPSTN",151,0)
DRGDSP2 ; Display other multiple information for medications/dosages
"RTN","GMTSPSTN",152,0)
 S DDNUM=1 F  S DDNUM=$O(^TMP("PS",$J,"DD",DDNUM)) Q:DDNUM=""  D  Q:$D(GMTSQIT)
"RTN","GMTSPSTN",153,0)
 . S DRUGDISP=$$GET1^DIQ(50,+$P(^TMP("PS",$J,"DD",DDNUM,0),U,1)_",",.01)
"RTN","GMTSPSTN",154,0)
 . I DRUGDISP]"" W !,"     ",DRUGDISP D CKP
"RTN","GMTSPSTN",155,0)
 Q
"RTN","GMTSPSTN",156,0)
 ;
"RTN","GMTSPSTN",157,0)
OPTDISP ;Display an Outpatient Prescription Entry
"RTN","GMTSPSTN",158,0)
 N EXPDT,REFILLS,STATUS,DIWL,DIWR,PENDMED,GMTSPSTP,ORQLN,CANCELDT
"RTN","GMTSPSTN",159,0)
 N ORDTYP,ORIGRX,QDFLAG
"RTN","GMTSPSTN",160,0)
 K ^TMP($J,"GMTSPSTN"),^UTILITY($J,"W")
"RTN","GMTSPSTN",161,0)
 S PACKREF=$$PKGID^ORX8(ORDER)
"RTN","GMTSPSTN",162,0)
 I PACKREF["S" D  Q
"RTN","GMTSPSTN",163,0)
 . D PEN^PSO5241(DFN,"GMTSPSTN",+PACKREF,ORDER)
"RTN","GMTSPSTN",164,0)
 . D CKP Q:$D(GMTSQIT)
"RTN","GMTSPSTN",165,0)
 . W !,"OUTPT "_DRUGNM_" (Status = Pending)"
"RTN","GMTSPSTN",166,0)
 . D CKP Q:$D(GMTSQIT)
"RTN","GMTSPSTN",167,0)
 . D TEXT^ORQ12(.GMTSPSTP,ORDER,60)
"RTN","GMTSPSTN",168,0)
 . ;p127 mwa stopped previous instructions from showing, stopped subscript error, and leading space error
"RTN","GMTSPSTN",169,0)
 . S ORQLN=1 F  S ORQLN=$O(GMTSPSTP(ORQLN)) Q:'+ORQLN  Q:$E(GMTSPSTP(ORQLN),1,3+$L($P(DRUGNM," ")))=("to "_$P(DRUGNM," ")) 
"RTN","GMTSPSTN",170,0)
 . S:ORQLN="" ORQLN=1
"RTN","GMTSPSTN",171,0)
 . F  S ORQLN=$O(GMTSPSTP(ORQLN)) Q:'+ORQLN  Q:(GMTSPSTP(ORQLN)?." "1"Quantity: ".E)  D
"RTN","GMTSPSTN",172,0)
 .. W !?IND1,GMTSPSTP(ORQLN)
"RTN","GMTSPSTN",173,0)
 .. D CKP Q:$D(GMTSQIT)
"RTN","GMTSPSTN",174,0)
 . S ORIGRX=$P($G(^TMP($J,"GMTSPSTN",DFN,+PACKREF,22.1)),U,2)
"RTN","GMTSPSTN",175,0)
 . S ORDTYP=$P($G(^TMP($J,"GMTSPSTN",DFN,+PACKREF,2)),U,1)
"RTN","GMTSPSTN",176,0)
 . S QDFLAG=0 I ORIGRX]"",ORDTYP="RNW" D
"RTN","GMTSPSTN",177,0)
 .. W !?10,"Renewed from Rx# "_ORIGRX
"RTN","GMTSPSTN",178,0)
 .. D CKP Q:$D(QMTSQIT)
"RTN","GMTSPSTN",179,0)
 .. W ?50,"Qty/Days Supply: "_$G(^TMP($J,"GMTSPSTN",DFN,+PACKREF,12))_"/"_$G(^TMP($J,"GMTSPSTN",DFN,+PACKREF,101))
"RTN","GMTSPSTN",180,0)
 .. S QDFLAG=1 D CKP Q:$D(GMTSQIT)
"RTN","GMTSPSTN",181,0)
 . W !?10,"Login Date: "_$$FMTE^XLFDT(+$G(^TMP($J,"GMTSPSTN",DFN,+PACKREF,15)),"2D")
"RTN","GMTSPSTN",182,0)
 . D CKP Q:$D(GMTSQIT)
"RTN","GMTSPSTN",183,0)
 . I 'QDFLAG D
"RTN","GMTSPSTN",184,0)
 .. W ?50,"Qty/Days Supply: "_$G(^TMP($J,"GMTSPSTN",DFN,+PACKREF,12))_"/"_$G(^TMP($J,"GMTSPSTN",DFN,+PACKREF,101))
"RTN","GMTSPSTN",185,0)
 .. D CKP Q:$D(GMTSQIT)
"RTN","GMTSPSTN",186,0)
 . W:'QDFLAG ! W ?50,"Refills Ordered: "_$G(^TMP($J,"GMTSPSTN",DFN,+PACKREF,13))
"RTN","GMTSPSTN",187,0)
 . D CKP Q:$D(GMTSQIT)
"RTN","GMTSPSTN",188,0)
 . W !
"RTN","GMTSPSTN",189,0)
 D RX^PSO52API(DFN,"GMTSPSTN",PACKREF)
"RTN","GMTSPSTN",190,0)
 S EXPDT=$G(^TMP($J,"GMTSPSTN",DFN,PACKREF,26))
"RTN","GMTSPSTN",191,0)
 S CANCELDT=$G(^TMP($J,"GMTSPSTN",DFN,PACKREF,26.1))
"RTN","GMTSPSTN",192,0)
 S REFILLS=$G(^TMP($J,"GMTSPSTN",DFN,PACKREF,9))-$S($G(^TMP($J,"GMTSPSTN",DFN,PACKREF,"RF",0))>0:$G(^TMP($J,"GMTSPSTN",DFN,PACKREF,"RF",0)),1:0)  ;need to make sure this is as accurate as the previous method in PSOQ0076
"RTN","GMTSPSTN",193,0)
 S LASTREL=$$LRD(PACKREF)
"RTN","GMTSPSTN",194,0)
 I $P(PSNUM,";")["N" G NVADISP
"RTN","GMTSPSTN",195,0)
 I EXPDT Q:$$FMDIFF^XLFDT(DT,$P(EXPDT,U))>EXPDAYS
"RTN","GMTSPSTN",196,0)
 I CANCELDT Q:$$FMDIFF^XLFDT(DT,$P(CANCELDT,U))>EXPDAYS
"RTN","GMTSPSTN",197,0)
 S STATUS=$P($G(^TMP($J,"GMTSPSTN",DFN,PACKREF,100)),U,2)
"RTN","GMTSPSTN",198,0)
 S STATUS=$S(STATUS["ACTIVE":"Active",STATUS["SUSPENDED":"Active/Suspended",STATUS["HOLD":"On Hold",STATUS["DISCONTINUED":"Discontinued",1:STATUS)
"RTN","GMTSPSTN",199,0)
 D CKP Q:$D(GMTSQIT)
"RTN","GMTSPSTN",200,0)
 W !,"OUTPT "_DRUGNM_" (Status = "_STATUS_")"
"RTN","GMTSPSTN",201,0)
 S DIWL=IND1,DIWR=72
"RTN","GMTSPSTN",202,0)
 S SIGLINE=0 F  S SIGLINE=$O(^TMP($J,"GMTSPSTN",DFN,PACKREF,"M",SIGLINE)) Q:'+SIGLINE  D  Q:$D(GMTSQIT)
"RTN","GMTSPSTN",203,0)
 . S X=$G(^TMP($J,"GMTSPSTN",DFN,PACKREF,"M",SIGLINE,0))
"RTN","GMTSPSTN",204,0)
 . D ^DIWP
"RTN","GMTSPSTN",205,0)
 S WLINE=0 F  S WLINE=$O(^UTILITY($J,"W",DIWL,WLINE)) Q:'+WLINE!($D(GMTSQIT))  D  Q:$D(GMTSQIT)
"RTN","GMTSPSTN",206,0)
 . W !?DIWL,$G(^UTILITY($J,"W",DIWL,WLINE,0))
"RTN","GMTSPSTN",207,0)
 . D CKP
"RTN","GMTSPSTN",208,0)
 Q:$D(GMTSQIT)
"RTN","GMTSPSTN",209,0)
 W !?10,"Rx# "_$G(^TMP($J,"GMTSPSTN",DFN,PACKREF,.01))_" Last Released: "_$$FMTE^XLFDT(LASTREL,"2D"),?50,"Qty/Days Supply: "_$G(^TMP($J,"GMTSPSTN",DFN,PACKREF,7))_"/"_$G(^TMP($J,"GMTSPSTN",DFN,PACKREF,8)) D CKP Q:$D(GMTSQIT)
"RTN","GMTSPSTN",210,0)
 W !?10,"Rx Expiration Date: ",$$FMTE^XLFDT(EXPDT,"2D"),?50,"Refills Remaining: ",REFILLS D CKP Q:$D(GMTSQIT)
"RTN","GMTSPSTN",211,0)
 W ! D CKP
"RTN","GMTSPSTN",212,0)
 Q
"RTN","GMTSPSTN",213,0)
 ;
"RTN","GMTSPSTN",214,0)
ISSUPPLY(DRUG,DRUGNAME) ;
"RTN","GMTSPSTN",215,0)
 ; Function returns '1' if drug is a SUPPLY, '0' otherwise
"RTN","GMTSPSTN",216,0)
 Q:LIST=2 0 ;Only check during regular med list, not in supply list
"RTN","GMTSPSTN",217,0)
 N VACLASS,DEAHDLG
"RTN","GMTSPSTN",218,0)
 K ^TMP($J,"GMTSPSTND")
"RTN","GMTSPSTN",219,0)
 I +$G(DRUG) D DATA^PSS50(DRUG,,,,,"GMTSPSTND")
"RTN","GMTSPSTN",220,0)
 E  D DATA^PSS50(,DRUGNAME,,,,"GMTSPSTND") S DRUG=$O(^TMP($J,"GMTSPSTND",0))
"RTN","GMTSPSTN",221,0)
 I 'DRUG Q 0
"RTN","GMTSPSTN",222,0)
 S VACLASS=$G(^TMP($J,"GMTSPSTND",DRUG,2))
"RTN","GMTSPSTN",223,0)
 S DEAHDLG=$G(^TMP($J,"GMTSPSTND",DRUG,3))
"RTN","GMTSPSTN",224,0)
 Q:$E(VACLASS,1,2)="XA" 1
"RTN","GMTSPSTN",225,0)
 Q:$E(VACLASS,1,2)="XX" 1
"RTN","GMTSPSTN",226,0)
 Q:(VACLASS="DX900")&(DEAHDLG["S") 1
"RTN","GMTSPSTN",227,0)
 Q 0
"RTN","GMTSPSTN",228,0)
 ;
"RTN","GMTSPSTN",229,0)
RDIDISP ;Display a Remote Meds Entry
"RTN","GMTSPSTN",230,0)
 D CKP Q:$D(GMTSQIT)
"RTN","GMTSPSTN",231,0)
 W !,"Remote ",?IND1,DRUGNM D CKP Q:$D(GMTSQIT)
"RTN","GMTSPSTN",232,0)
 N STATUS,DIWL,DIWR,DIWF,X,WLINE
"RTN","GMTSPSTN",233,0)
 K ^UTILITY($J,"W")
"RTN","GMTSPSTN",234,0)
 S X=$G(^XTMP("ORRDI","PSOO",DFN,+ORDNUM,14,0)),DIWL=IND1,DIWR=60
"RTN","GMTSPSTN",235,0)
 D ^DIWP
"RTN","GMTSPSTN",236,0)
 S WLINE=0 F  S WLINE=$O(^UTILITY($J,"W",DIWL,WLINE)) Q:'+WLINE  D  Q:$D(GMTSQIT)
"RTN","GMTSPSTN",237,0)
 . D CKP Q:$D(GMTSQIT)
"RTN","GMTSPSTN",238,0)
 . W !?DIWL,$G(^UTILITY($J,"W",DIWL,WLINE,0))
"RTN","GMTSPSTN",239,0)
 D CKP Q:$D(GMTSQIT)
"RTN","GMTSPSTN",240,0)
 S STATUS=$G(^XTMP("ORRDI","PSOO",DFN,+ORDNUM,5,0))
"RTN","GMTSPSTN",241,0)
 S STATUS=$S(STATUS["ACTIVE":"Active",STATUS["SUSPENDED":"Active/Suspended",STATUS["HOLD":"Hold",1:"Unknown")
"RTN","GMTSPSTN",242,0)
 W !?10,"Last Filled: "_$G(^XTMP("ORRDI","PSOO",DFN,+ORDNUM,9,0))_" ("_STATUS_" at "_$G(^XTMP("ORRDI","PSOO",DFN,+ORDNUM,1,0))_") "
"RTN","GMTSPSTN",243,0)
 W !?10,"Rx Expiration Date: ",$G(^XTMP("ORRDI","PSOO",DFN,+ORDNUM,7,0)),?55,"Days Supply: "_$P($P($G(^XTMP("ORRDI","PSOO",DFN,+ORDNUM,6,0)),";",2),"D",2)
"RTN","GMTSPSTN",244,0)
 Q
"RTN","GMTSPSTN",245,0)
 ;
"RTN","GMTSPSTN",246,0)
NVADISP ;Display a Non-VA Medication Entry
"RTN","GMTSPSTN",247,0)
 N GMTSPSTN,OALINE,ORIG,WLINE,DIWL,DIWR,DIWF,X
"RTN","GMTSPSTN",248,0)
 K ^UTILITY($J,"W")
"RTN","GMTSPSTN",249,0)
 D CKP Q:$D(GMTSQIT)
"RTN","GMTSPSTN",250,0)
 W !,"Non-VA "_DRUGNM D CKP Q:$D(GMTSQIT)
"RTN","GMTSPSTN",251,0)
 D TEXT^ORQ12(.GMTSPSTN,ORDER,80)
"RTN","GMTSPSTN",252,0)
 S DIWL=IND1,DIWR=60,ORIG=2
"RTN","GMTSPSTN",253,0)
 D:$E(GMTSPSTN(1),1,7)="Change "
"RTN","GMTSPSTN",254,0)
 . F OALINE=2:1:$O(GMTSPSTN(":"),-1) I $E(GMTSPSTN(OALINE),1,3)="to " S ORIG=OALINE+1 Q
"RTN","GMTSPSTN",255,0)
 F OALINE=ORIG:1:$O(GMTSPSTN(":"),-1) D
"RTN","GMTSPSTN",256,0)
 . S X=$$LSIG($G(GMTSPSTN(OALINE)))
"RTN","GMTSPSTN",257,0)
 . D ^DIWP
"RTN","GMTSPSTN",258,0)
 S WLINE=0 F  S WLINE=$O(^UTILITY($J,"W",DIWL,WLINE)) Q:'+WLINE  D  Q:$D(GMTSQIT)
"RTN","GMTSPSTN",259,0)
 . W !?DIWL,$G(^UTILITY($J,"W",DIWL,WLINE,0))
"RTN","GMTSPSTN",260,0)
 . D CKP
"RTN","GMTSPSTN",261,0)
 W ! D CKP Q:$D(GMTSQIT)
"RTN","GMTSPSTN",262,0)
 Q
"RTN","GMTSPSTN",263,0)
FOOTER ;Report footer for older medication entries
"RTN","GMTSPSTN",264,0)
 D CKP Q:$D(GMTSQIT)  W !
"RTN","GMTSPSTN",265,0)
 D TEXTPRNT("FOOTER1")
"RTN","GMTSPSTN",266,0)
 Q
"RTN","GMTSPSTN",267,0)
OPTFOOT ;Actual display for outpatient footer
"RTN","GMTSPSTN",268,0)
 N LASTREL,FOOTTXT,DAYSSUPP,STATUS
"RTN","GMTSPSTN",269,0)
 K ^TMP($J,"GMTSPSTN")
"RTN","GMTSPSTN",270,0)
 S PACKREF=$$PKGID^ORX8(ORDER)
"RTN","GMTSPSTN",271,0)
 S LASTREL=$$LRD(PACKREF)
"RTN","GMTSPSTN",272,0)
 Q:LASTREL<$$FMADD^XLFDT(DT,-365)
"RTN","GMTSPSTN",273,0)
 Q:$P(PSNUM,";")["N"
"RTN","GMTSPSTN",274,0)
 D CKP Q:$D(GMTSQIT)
"RTN","GMTSPSTN",275,0)
 W !,"OPT "_DRUGNM D CKP Q:$D(GMTSQIT)
"RTN","GMTSPSTN",276,0)
 D RX^PSO52API(DFN,"GMTSPSTN",PACKREF)
"RTN","GMTSPSTN",277,0)
 S STATUS=$P($G(^TMP($J,"GMTSPSTN",DFN,PACKREF,100)),U,2)
"RTN","GMTSPSTN",278,0)
 S DAYSSUPP=$G(^TMP($J,"GMTSPSTN",DFN,PACKREF,8))
"RTN","GMTSPSTN",279,0)
 S FOOTTXT="("_STATUS_"/"_DAYSSUPP_" Days Supply Last Released: "_$$FMTE^XLFDT(LASTREL,"2D")_")"
"RTN","GMTSPSTN",280,0)
 W $$RJ^XLFSTR(FOOTTXT,74) D CKP Q:$D(GMTSQIT)
"RTN","GMTSPSTN",281,0)
 S SIGLINE=0 F  S SIGLINE=$O(^TMP($J,"GMTSPSTN",DFN,PACKREF,"M",SIGLINE)) Q:'+SIGLINE  D  Q:$D(GMTSQIT)
"RTN","GMTSPSTN",282,0)
 . W !?IND1,$G(^TMP($J,"GMTSPSTN",DFN,PACKREF,"M",SIGLINE,0))
"RTN","GMTSPSTN",283,0)
 . D CKP
"RTN","GMTSPSTN",284,0)
 D CKP
"RTN","GMTSPSTN",285,0)
 Q
"RTN","GMTSPSTN",286,0)
NVADT() ;Replaces call previously in ^PSOQCF04
"RTN","GMTSPSTN",287,0)
 N NVAL,NVARR
"RTN","GMTSPSTN",288,0)
 D ^PSOHCSUM
"RTN","GMTSPSTN",289,0)
 Q:'$D(^TMP("PSOO",$J,"NVA")) ""
"RTN","GMTSPSTN",290,0)
 S NVAL=0 F  S NVAL=$O(^TMP("PSOO",$J,"NVA",NVAL)) Q:'+NVAL  D
"RTN","GMTSPSTN",291,0)
 . S NVADT=9999999-$P($G(^TMP("PSOO",$J,"NVA",NVAL,0)),"^",5)
"RTN","GMTSPSTN",292,0)
 . S NVARR(NVADT)=""
"RTN","GMTSPSTN",293,0)
 S NVADT=$O(NVARR(0)) Q:NVADT=9999999 ""
"RTN","GMTSPSTN",294,0)
 Q 9999999-NVADT
"RTN","GMTSPSTN",295,0)
LSIG(SIG) ;Expand a SIG
"RTN","GMTSPSTN",296,0)
 N P,SGY,X
"RTN","GMTSPSTN",297,0)
 S SGY="" F P=1:1:$L(SIG," ") S X=$P(SIG," ",P) D:X]""  ;
"RTN","GMTSPSTN",298,0)
 .I $D(^PS(51,"A",X)) S %=^(X),X=$P(%,"^") I $P(%,"^",2)]"" S Y=$P(SIG," ",P-1),Y=$E(Y,$L(Y)) S:Y>1 X=$P(%,"^",2)
"RTN","GMTSPSTN",299,0)
 .S SGY=SGY_X_" "
"RTN","GMTSPSTN",300,0)
 Q SGY
"RTN","GMTSPSTN",301,0)
LRD(PACKREF) ;Calculate LAST RELEASE DATE as latest of original + refill relDates
"RTN","GMTSPSTN",302,0)
 N RELDT,REFDT,CTR,ANS
"RTN","GMTSPSTN",303,0)
 K ^TMP($J,"GMTSLRD")
"RTN","GMTSPSTN",304,0)
 S ANS=""
"RTN","GMTSPSTN",305,0)
 D RX^PSO52API(DFN,"GMTSLRD",PACKREF,,"3,R")
"RTN","GMTSPSTN",306,0)
 S RELDT=$G(^TMP($J,"GMTSLRD",DFN,PACKREF,31))
"RTN","GMTSPSTN",307,0)
 S ANS=RELDT
"RTN","GMTSPSTN",308,0)
 S CTR=0 F  S CTR=$O(^TMP($J,"GMTSLRD",DFN,PACKREF,"RF",CTR)) Q:'+CTR  D  ;
"RTN","GMTSPSTN",309,0)
 . S REFDT=$G(^TMP($J,"GMTSLRD",DFN,PACKREF,"RF",CTR,17))
"RTN","GMTSPSTN",310,0)
 . I REFDT>ANS S ANS=REFDT
"RTN","GMTSPSTN",311,0)
 K ^TMP($J,"GMTSLRD")
"RTN","GMTSPSTN",312,0)
 Q ANS
"RTN","GMTSPSTN",313,0)
 ;
"RTN","GMTSPSTN",314,0)
CKP D CKP^GMTSUP Q
"RTN","GMTSPSTN",315,0)
 ;
"RTN","GMTSPSTN",316,0)
HEADTXT1 ;;
"RTN","GMTSPSTN",317,0)
 ;;INCLUDED IN THIS LIST:  Alphabetical list of active outpatient
"RTN","GMTSPSTN",318,0)
 ;;prescriptions dispensed from this VA (local) and dispensed from another
"RTN","GMTSPSTN",319,0)
 ;;VA or DoD facility (remote) as well as inpatient orders (local pending and
"RTN","GMTSPSTN",320,0)
 ;;active), local clinic medications, locally documented non-VA medications,
"RTN","GMTSPSTN",321,0)
 ;;and local prescriptions that have expired or been discontinued in the past
"RTN","GMTSPSTN",322,0)
 ;;90 days.
"RTN","GMTSPSTN",323,0)
 ;;
"RTN","GMTSPSTN",324,0)
 ;;$$END
"RTN","GMTSPSTN",325,0)
HEADTXT2 ;;
"RTN","GMTSPSTN",326,0)
 ;;***NOTE*** The display of VA prescriptions dispensed from another VA or
"RTN","GMTSPSTN",327,0)
 ;;DoD facility (remote) is limited to active outpatient prescription entries
"RTN","GMTSPSTN",328,0)
 ;;matched to National Drug File at the originating site and may not include
"RTN","GMTSPSTN",329,0)
 ;;some items such as investigational drugs, compounds, etc.
"RTN","GMTSPSTN",330,0)
 ;;
"RTN","GMTSPSTN",331,0)
 ;;NOT INCLUDED IN THIS LIST: Medications self-entered by the patient into
"RTN","GMTSPSTN",332,0)
 ;;personal health records (i.e. My HealtheVet) are NOT included in this
"RTN","GMTSPSTN",333,0)
 ;;list. Non-VA medications documented outside this VA, remote inpatient
"RTN","GMTSPSTN",334,0)
 ;;orders (regardless of status) and remote clinic medications are NOT
"RTN","GMTSPSTN",335,0)
 ;;included in this list. The patient and provider must always discuss
"RTN","GMTSPSTN",336,0)
 ;;medications the patient is taking, regardless of where the medication was
"RTN","GMTSPSTN",337,0)
 ;;dispensed or obtained.
"RTN","GMTSPSTN",338,0)
 ;;$$END
"VER")
8.0^22.2
"BLD",11058,6)
^116
**END**
**END**

