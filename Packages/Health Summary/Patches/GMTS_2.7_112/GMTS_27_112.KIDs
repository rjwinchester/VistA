KIDS Distribution saved on Mar 26, 2015@07:01:24
GMTS*2.7*112
**KIDS**:GMTS*2.7*112^

**INSTALL NAME**
GMTS*2.7*112
"BLD",9225,0)
GMTS*2.7*112^HEALTH SUMMARY^0^3150326^y
"BLD",9225,4,0)
^9.64PA^^
"BLD",9225,6.3)
3
"BLD",9225,"ABPKG")
n
"BLD",9225,"INID")
^n
"BLD",9225,"INIT")
POST^GMTSP112
"BLD",9225,"KRN",0)
^9.67PA^779.2^20
"BLD",9225,"KRN",.4,0)
.4
"BLD",9225,"KRN",.401,0)
.401
"BLD",9225,"KRN",.402,0)
.402
"BLD",9225,"KRN",.403,0)
.403
"BLD",9225,"KRN",.5,0)
.5
"BLD",9225,"KRN",.84,0)
.84
"BLD",9225,"KRN",3.6,0)
3.6
"BLD",9225,"KRN",3.8,0)
3.8
"BLD",9225,"KRN",9.2,0)
9.2
"BLD",9225,"KRN",9.8,0)
9.8
"BLD",9225,"KRN",9.8,"NM",0)
^9.68A^3^3
"BLD",9225,"KRN",9.8,"NM",1,0)
GMTSCNB^^0^B49123943
"BLD",9225,"KRN",9.8,"NM",2,0)
GMTSP112^^0^B4270408
"BLD",9225,"KRN",9.8,"NM",3,0)
GMTSLROE^^0^B13446109
"BLD",9225,"KRN",9.8,"NM","B","GMTSCNB",1)

"BLD",9225,"KRN",9.8,"NM","B","GMTSLROE",3)

"BLD",9225,"KRN",9.8,"NM","B","GMTSP112",2)

"BLD",9225,"KRN",19,0)
19
"BLD",9225,"KRN",19.1,0)
19.1
"BLD",9225,"KRN",101,0)
101
"BLD",9225,"KRN",409.61,0)
409.61
"BLD",9225,"KRN",771,0)
771
"BLD",9225,"KRN",779.2,0)
779.2
"BLD",9225,"KRN",870,0)
870
"BLD",9225,"KRN",8989.51,0)
8989.51
"BLD",9225,"KRN",8989.52,0)
8989.52
"BLD",9225,"KRN",8994,0)
8994
"BLD",9225,"KRN","B",.4,.4)

"BLD",9225,"KRN","B",.401,.401)

"BLD",9225,"KRN","B",.402,.402)

"BLD",9225,"KRN","B",.403,.403)

"BLD",9225,"KRN","B",.5,.5)

"BLD",9225,"KRN","B",.84,.84)

"BLD",9225,"KRN","B",3.6,3.6)

"BLD",9225,"KRN","B",3.8,3.8)

"BLD",9225,"KRN","B",9.2,9.2)

"BLD",9225,"KRN","B",9.8,9.8)

"BLD",9225,"KRN","B",19,19)

"BLD",9225,"KRN","B",19.1,19.1)

"BLD",9225,"KRN","B",101,101)

"BLD",9225,"KRN","B",409.61,409.61)

"BLD",9225,"KRN","B",771,771)

"BLD",9225,"KRN","B",779.2,779.2)

"BLD",9225,"KRN","B",870,870)

"BLD",9225,"KRN","B",8989.51,8989.51)

"BLD",9225,"KRN","B",8989.52,8989.52)

"BLD",9225,"KRN","B",8994,8994)

"BLD",9225,"QUES",0)
^9.62^^
"BLD",9225,"REQB",0)
^9.611^2^2
"BLD",9225,"REQB",1,0)
GMTS*2.7*90^2
"BLD",9225,"REQB",2,0)
GMTS*2.7*96^2
"BLD",9225,"REQB","B","GMTS*2.7*90",1)

"BLD",9225,"REQB","B","GMTS*2.7*96",2)

"INIT")
POST^GMTSP112
"MBREQ")
0
"PKG",160,-1)
1^1
"PKG",160,0)
HEALTH SUMMARY^GMTS^Integrated Health Summary Tools
"PKG",160,20,0)
^9.402P^^
"PKG",160,22,0)
^9.49I^1^1
"PKG",160,22,1,0)
2.7^2951020^2951219
"PKG",160,22,1,"PAH",1,0)
112^3150326
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
3
"RTN","GMTSCNB")
0^1^B49123943
"RTN","GMTSCNB",1,0)
GMTSCNB ; SLC/KER - Consults Components Brief          ;03/26/15  05:28
"RTN","GMTSCNB",2,0)
 ;;2.7;Health Summary;**46,47,58,90,112**;Oct 20, 1995;Build 3
"RTN","GMTSCNB",3,0)
 ;
"RTN","GMTSCNB",4,0)
 ; External References
"RTN","GMTSCNB",5,0)
 ;   DBIA  3358  ^GMR(123,
"RTN","GMTSCNB",6,0)
 ;   DBIA 10040  ^SC(
"RTN","GMTSCNB",7,0)
 ;   DBIA 10104  $$UP^XLFSTR
"RTN","GMTSCNB",8,0)
 ;   DBIA  2056  $$GET1^DIQ     (file 123.1, 44)
"RTN","GMTSCNB",9,0)
 ;   DBIA  2056  GETS^DIQ       (file 123)
"RTN","GMTSCNB",10,0)
 ;   DBIA  2051  LIST^DIC       (file 123.02)
"RTN","GMTSCNB",11,0)
 ;
"RTN","GMTSCNB",12,0)
 ; Delete this line: test of perforce/eclipse
"RTN","GMTSCNB",13,0)
 ;
"RTN","GMTSCNB",14,0)
 Q
"RTN","GMTSCNB",15,0)
MAIN ; Consults - Brief
"RTN","GMTSCNB",16,0)
 K ^TMP("GMTSCN",$J)
"RTN","GMTSCNB",17,0)
 N GMTSMAX,GMTSNMC,GMTSI,GMTSDFN S GMTSDFN=+($G(DFN))
"RTN","GMTSCNB",18,0)
 S:'$L($G(GMTS1)) GMTS1=6666666 S:'$L($G(GMTS2)) GMTS2=9999999
"RTN","GMTSCNB",19,0)
 S GMTS1=+($G(GMTS1)),GMTS2=+($G(GMTS2)),GMTSMAX=+($G(GMTSNDM)) S:GMTSMAX'>0 GMTSMAX=999999999
"RTN","GMTSCNB",20,0)
 S GMTSDFN=+($G(GMTSDFN)) Q:GMTSDFN=0  Q:'$D(^GMR(123,"AD",GMTSDFN))
"RTN","GMTSCNB",21,0)
 S:GMTS2>GMTS1 GMTSI=GMTS1,GMTS1=GMTS2,GMTS2=GMTSI S GMTSI=GMTS2-.00000001
"RTN","GMTSCNB",22,0)
 F  S GMTSI=$O(^GMR(123,"AD",GMTSDFN,GMTSI)) Q:+GMTSI=0!(GMTSI>GMTS1)  D  Q:$D(GMTSQIT)
"RTN","GMTSCNB",23,0)
 . S GMTSIEN=0 F  S GMTSIEN=$O(^GMR(123,"AD",GMTSDFN,GMTSI,GMTSIEN)) Q:+GMTSIEN=0  D  Q:$D(GMTSQIT)
"RTN","GMTSCNB",24,0)
 . . Q:+($G(GMTSNMC))>+($G(GMTSMAX))  K ^TMP("GMTSCN",$J)
"RTN","GMTSCNB",25,0)
 . . D EXT(GMTSIEN,GMTSI) Q:$D(GMTSQIT)  D BCD Q:$D(GMTSQIT)
"RTN","GMTSCNB",26,0)
 Q
"RTN","GMTSCNB",27,0)
BCD ;   Brief Consults Display
"RTN","GMTSCNB",28,0)
 Q:'$D(^TMP("GMTSCN",$J))  S GMTSNMC=+($G(GMTSNMC))+1
"RTN","GMTSCNB",29,0)
 D:GMTSNMC=1 BHDR Q:$D(GMTSQIT)
"RTN","GMTSCNB",30,0)
 N GMTSID,GMTSFI,GMTSIE S GMTSID=0
"RTN","GMTSCNB",31,0)
 F  S GMTSID=$O(^TMP("GMTSCN",$J,GMTSID)) Q:+GMTSID=0  D  Q:$D(GMTSQIT)
"RTN","GMTSCNB",32,0)
 . S GMTSFI=123,GMTSIE="" F  S GMTSIE=$O(^TMP("GMTSCN",$J,GMTSID,GMTSFI,GMTSIE)) Q:GMTSIE=""  D  Q:$D(GMTSQIT)
"RTN","GMTSCNB",33,0)
 . . N GMTSNB,GMTSRD,GMTSTO,GMTSVC,GMTSFM,GMTSLA,GMTSAD,GMTSED
"RTN","GMTSCNB",34,0)
 . . S GMTSNB=+($G(GMTSIE)) S:+GMTSNB=0 GMTSNB="?"
"RTN","GMTSCNB",35,0)
 . . S GMTSRD=$G(^TMP("GMTSCN",$J,GMTSID,GMTSFI,GMTSIE,3,"I"))
"RTN","GMTSCNB",36,0)
 . . S GMTSRD=$$UP^XLFSTR($S(+GMTSRD>0:$$ED^GMTSU(+GMTSRD),1:"UNKNOWN"))
"RTN","GMTSCNB",37,0)
 . . S GMTSFM=$$UP^XLFSTR($G(^TMP("GMTSCN",$J,GMTSID,GMTSFI,GMTSIE,2,"E")))
"RTN","GMTSCNB",38,0)
 . . S GMTSED=$G(^TMP("GMTSCN",$J,GMTSID,GMTSFI,GMTSIE,17,"I"))
"RTN","GMTSCNB",39,0)
    . . S GMTSED=$$UP^XLFSTR($S(+GMTSED>0:$$ED^GMTSU(+GMTSED),1:"UNKNOWN"))
"RTN","GMTSCNB",40,0)
 . . S GMTSTO=$$UP^XLFSTR($G(^TMP("GMTSCN",$J,GMTSID,GMTSFI,GMTSIE,1,"E")))
"RTN","GMTSCNB",41,0)
 . . S GMTSLA=$$UP^XLFSTR($G(^TMP("GMTSCN",$J,GMTSID,GMTSFI,GMTSIE,40,1,1,"E")))
"RTN","GMTSCNB",42,0)
 . . S GMTSLD=$G(^TMP("GMTSCN",$J,GMTSID,GMTSFI,GMTSIE,40,1,2,"I"))
"RTN","GMTSCNB",43,0)
 . . S GMTSLD=$$UP^XLFSTR($S(+GMTSLD>0:$$ED^GMTSU(+GMTSLD),1:"UNKNOWN"))
"RTN","GMTSCNB",44,0)
 . . D WRT
"RTN","GMTSCNB",45,0)
 Q
"RTN","GMTSCNB",46,0)
BHDR ;   Brief Header
"RTN","GMTSCNB",47,0)
 N GMTSL S $P(GMTSL,"-",79)=""
"RTN","GMTSCNB",48,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W !,"Request Date/",?15,"Request From",?52,"Clinically Ind. Date"
"RTN","GMTSCNB",49,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W !,"Number",?15,"Request To",?52,"Last Action",?67,"Action Date"
"RTN","GMTSCNB",50,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W !,GMTSL
"RTN","GMTSCNB",51,0)
 Q
"RTN","GMTSCNB",52,0)
WRT ;   Write Brief Consult
"RTN","GMTSCNB",53,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W !,$E(GMTSRD,1,10),?15,GMTSFM,?52,$E(GMTSED,1,10)
"RTN","GMTSCNB",54,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W !,GMTSNB,?15,GMTSTO,?52,GMTSLA,?67,GMTSLD
"RTN","GMTSCNB",55,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W !
"RTN","GMTSCNB",56,0)
 Q
"RTN","GMTSCNB",57,0)
EXT(X,Y) ; Extract Consults
"RTN","GMTSCNB",58,0)
 K ^TMP("GMTSCN",$J),^UTILITY("DIQ1",$J) N DIC,DIQ,DR,GMTSFM,GMTSI
"RTN","GMTSCNB",59,0)
 N GMTSIEN,GMTSIENS,GMTSLA,GMTSRT,GMTSTY,GMTSVC
"RTN","GMTSCNB",60,0)
 S GMTSIEN=+($G(X)) Q:GMTSIEN=0  S GMTSI=+($G(Y))
"RTN","GMTSCNB",61,0)
 S DIC=123,GMTSIENS=+($G(GMTSIEN))_","
"RTN","GMTSCNB",62,0)
 S GMTSRT="^TMP(""GMTSCN"","_$J_","_GMTSI_")"
"RTN","GMTSCNB",63,0)
 S DIQ(0)="IE",DR=".01;1;2;3;9;17" D GETS^DIQ(123,GMTSIENS,DR,"EI",GMTSRT,"MSG")
"RTN","GMTSCNB",64,0)
 S GMTSFM=+($G(^TMP("GMTSCN",$J,GMTSI,123,GMTSIENS,2,"I"))) S:+GMTSFM=0 GMTSFM=""
"RTN","GMTSCNB",65,0)
 S GMTSVC="" S:+GMTSFM>0 GMTSVC=$$GET1^DIQ(44,GMTSFM,9,"E") S:$G(GMTSVC)="NONE" GMTSVC=""
"RTN","GMTSCNB",66,0)
 S:$L(GMTSVC) ^TMP("GMTSCN",$J,GMTSI,123,GMTSIENS,2,"SVC")=GMTSVC
"RTN","GMTSCNB",67,0)
 S GMTSTY="" S:+GMTSFM>0 GMTSTY=$$GET1^DIQ(44,GMTSFM,2,"E")
"RTN","GMTSCNB",68,0)
 S GMTSFM=$$FM(($G(^TMP("GMTSCN",$J,GMTSI,123,GMTSIENS,2,"E"))_"^"_GMTSTY_"^"_GMTSVC))
"RTN","GMTSCNB",69,0)
 S ^TMP("GMTSCN",$J,GMTSI,123,GMTSIENS,2,"E")=GMTSFM
"RTN","GMTSCNB",70,0)
 S GMTSLA=+($G(^TMP("GMTSCN",$J,GMTSI,DIC,GMTSIENS,9,"I")))
"RTN","GMTSCNB",71,0)
 S:+GMTSLA'>9 ^TMP("GMTSCN",$J,GMTSI,DIC,GMTSIENS,9,"E")=""
"RTN","GMTSCNB",72,0)
 I +GMTSLA>0 D
"RTN","GMTSCNB",73,0)
 . S GMTSLA=$$GET1^DIQ(123.1,GMTSLA,7,"E")
"RTN","GMTSCNB",74,0)
 . S ^TMP("GMTSCN",$J,GMTSI,DIC,GMTSIENS,9,"E")=GMTSLA
"RTN","GMTSCNB",75,0)
 S ^TMP("GMTSCN",$J,GMTSI,DIC,GMTSIENS,0)=(9999999-GMTSI)_"^"_$S(GMTSI>0:$$EDT^GMTSU((9999999-GMTSI)),1:"")
"RTN","GMTSCNB",76,0)
 D ACT
"RTN","GMTSCNB",77,0)
 Q
"RTN","GMTSCNB",78,0)
FM(X) ; From Service/Ward
"RTN","GMTSCNB",79,0)
 S X=$G(X) N GMTSTY,GMTSV S GMTSTY=$P(X,"^",2),GMTSV=$P(X,"^",3),X=$P(X,"^",1)
"RTN","GMTSCNB",80,0)
 I $L(X) S:+X>0&(GMTSTY="WARD")&(X'["WARD") X="WARD "_X S:+X'>0&(GMTSTY="WARD")&(X'["WARD") X=X_" WARD"
"RTN","GMTSCNB",81,0)
 S:($L(X)+$L(GMTSV)+3)'>30&($L(GMTSV))&(X'[GMTSV) X=X_" ("_GMTSV_")"
"RTN","GMTSCNB",82,0)
 S X=$$UP^XLFSTR(X)
"RTN","GMTSCNB",83,0)
 Q X
"RTN","GMTSCNB",84,0)
ACT ; Activity
"RTN","GMTSCNB",85,0)
 N GMTSL,GMTSFL,GMTSFLA,GMTSFLD,GMTSLA,GMTSLD,GMTSLR,GMTSAM,GMTSLM,GMTSC,GMTSDI,Y,DR,GMTSIENL,GMTSIENS,GMTSMSG K ^TMP("DILIST",$J)
"RTN","GMTSCNB",86,0)
 S GMTSIENS=+GMTSIEN_",",GMTSIENL=","_GMTSIENS,DR="1I;2I;9;10"
"RTN","GMTSCNB",87,0)
 D LIST^DIC(123.02,GMTSIENL,DR,,"*",,,,,,.GMTSDI,"GMTSMSG")
"RTN","GMTSCNB",88,0)
 K:+($G(^TMP("DILIST",$J,0)))=0 ^TMP("DILIST",$J) Q:+($G(^TMP("DILIST",$J,0)))=0
"RTN","GMTSCNB",89,0)
 S GMTSLA="",GMTSLD=0,GMTSLR="",GMTSAM="",GMTSC=0
"RTN","GMTSCNB",90,0)
 S GMTSL=0
"RTN","GMTSCNB",91,0)
 F  S GMTSL=$O(^TMP("DILIST",$J,"ID",GMTSL)) Q:+GMTSL=0  D
"RTN","GMTSCNB",92,0)
 . I +($G(^TMP("DILIST",$J,"ID",GMTSL,2)))'<GMTSLD,+($G(^TMP("DILIST",$J,"ID",GMTSL,2)))>0 D
"RTN","GMTSCNB",93,0)
 . . S GMTSLA=+($G(^TMP("DILIST",$J,"ID",GMTSL,1)))
"RTN","GMTSCNB",94,0)
 . . S GMTSLD=+($G(^TMP("DILIST",$J,"ID",GMTSL,2)))
"RTN","GMTSCNB",95,0)
 . . S GMTSLR=$G(^TMP("DILIST",$J,"ID",GMTSL,9))
"RTN","GMTSCNB",96,0)
 . . S GMTSLM=$G(^TMP("DILIST",$J,"ID",GMTSL,10))
"RTN","GMTSCNB",97,0)
 I +($G(GMTSFLA))>0,+($G(GMTSFLD))>0,+($G(GMTSFL))>0,+($G(GMTSR))'>0 S GMTSC=0,GMTSLA=GMTSFLA,GMTSLD=GMTSFLA D AAC
"RTN","GMTSCNB",98,0)
 I GMTSLA>0,GMTSLD>0 S GMTSC=1 D AAC
"RTN","GMTSCNB",99,0)
 K ^TMP("DILIST",$J)
"RTN","GMTSCNB",100,0)
 Q
"RTN","GMTSCNB",101,0)
AAC ;   Add Activity
"RTN","GMTSCNB",102,0)
 N GMTSEA,GMTSEP,GMTSEL,GMTSOR,GMTSW,I S GMTSC=+($G(GMTSC))
"RTN","GMTSCNB",103,0)
 S GMTSOR=$$UP^XLFSTR($$GET1^DIQ(123.1,GMTSLA,1,"I"))
"RTN","GMTSCNB",104,0)
 S GMTSEP=$$UP^XLFSTR($$GET1^DIQ(123.1,GMTSLA,7,"E"))
"RTN","GMTSCNB",105,0)
 S GMTSEA=$$UP^XLFSTR($$GET1^DIQ(123.1,GMTSLA,.01,"E"))
"RTN","GMTSCNB",106,0)
 S GMTSEL=$$AL(GMTSEA,GMTSEP) Q:'$L(GMTSEL)
"RTN","GMTSCNB",107,0)
 S GMTSEA=$$AN(GMTSEA,GMTSEP) Q:'$L(GMTSEA)
"RTN","GMTSCNB",108,0)
 I GMTSC>0 D
"RTN","GMTSCNB",109,0)
 . S ^TMP("GMTSCN",$J,GMTSI,123,GMTSIENS,40,GMTSC,1,"I")=GMTSLA,^TMP("GMTSCN",$J,GMTSI,123,GMTSIENS,40,GMTSC,1,"E")=GMTSEA,^TMP("GMTSCN",$J,GMTSI,123,GMTSIENS,40,GMTSC,1,"L")=GMTSEL
"RTN","GMTSCNB",110,0)
 . S ^TMP("GMTSCN",$J,GMTSI,123,GMTSIENS,40,GMTSC,2,"I")=GMTSLD,^TMP("GMTSCN",$J,GMTSI,123,GMTSIENS,40,GMTSC,2,"E")=$$EDT^GMTSU(GMTSLD)
"RTN","GMTSCNB",111,0)
 I GMTSC'>0 D
"RTN","GMTSCNB",112,0)
 . S ^TMP("GMTSCN",$J,GMTSI,123,GMTSIENS,40,"LA","I")=GMTSLA,^TMP("GMTSCN",$J,GMTSI,123,GMTSIENS,40,"LA","E")=GMTSEA,^TMP("GMTSCN",$J,GMTSI,123,GMTSIENS,40,"LA","L")=GMTSEL
"RTN","GMTSCNB",113,0)
 . S ^TMP("GMTSCN",$J,GMTSI,123,GMTSIENS,40,"LD","I")=GMTSLD,^TMP("GMTSCN",$J,GMTSI,123,GMTSIENS,40,"LD","E")=$$EDT^GMTSU(GMTSLD)
"RTN","GMTSCNB",114,0)
 . S ^TMP("GMTSCN",$J,GMTSI,123,GMTSIENS,40,"WR","E")=$G(^TMP("DILIST",$J,"ID",GMTSFL,3))
"RTN","GMTSCNB",115,0)
 Q
"RTN","GMTSCNB",116,0)
AN(X,Y) ;   Activity Name
"RTN","GMTSCNB",117,0)
 N GMTSW,GMTSP,GMTSA S GMTSA=$G(X),GMTSP=$G(Y) S X=$$SN((GMTSA_" "_GMTSP)) S X=$E(X,1,11) Q X
"RTN","GMTSCNB",118,0)
AL(X,Y) ;   Activity Name
"RTN","GMTSCNB",119,0)
 N GMTSP,GMTSA S GMTSA=$G(X),GMTSP=$G(Y) S:GMTSA["RECEIVE" (GMTSA,GMTSP)="RECEIVED"
"RTN","GMTSCNB",120,0)
 S:GMTSA="ENTERED IN CPRS"!(GMTSA["CPRS RELEASED") (GMTSA,GMTSP)="DATA ENTRY" S:GMTSA="EDIT BEFORE RELEASE" (GMTSA,GMTSP)="EDITED"
"RTN","GMTSCNB",121,0)
 S X="" S:$L(GMTSA)&($L(GMTSP)) X=$S($L(GMTSP)>$L(GMTSA):GMTSP,1:GMTSA) S:'$L(GMTSA)!('$L(GMTSP)) X=$S('$L(GMTSP)&($L(GMTSA)):GMTSA,$L(GMTSP)&('$L(GMTSA)):GMTSP,1:"")
"RTN","GMTSCNB",122,0)
 Q X
"RTN","GMTSCNB",123,0)
SN(X) ;
"RTN","GMTSCNB",124,0)
 S X=$G(X) Q:X="" "UNKNOWN" Q:X["ENTERED"!(X["RELEASED") "ENTERED" Q:X["STATUS" "STAT CHG"
"RTN","GMTSCNB",125,0)
 Q:X["SIGNIF" "SIG FIND" Q:X["DISCONT" "DISCONT'D" Q:X["SCHEDUL" "SCHEDULED" Q:X["INCOMPL" "INCOMPLETE" Q:X["COMPLET" "COMPLETE"
"RTN","GMTSCNB",126,0)
 Q:X["EDIT" "EDITED" Q:X["DISASSO" "DISASSOC'D" Q:X["ADDENDUM" "ADDENDUM" Q:X["NEW NOTE" "NEW NOTE"
"RTN","GMTSCNB",127,0)
 Q:X["SERVICE" "SVC ENTER" Q:X["FORWARD" "FORWARDED" Q:X["CANCELLED" "CANCELLED" Q:X["COMMENT" "COMMENT" Q:X["RECEIVED" "RECEIVED" Q:X["PRINTED" "PRINTED"
"RTN","GMTSCNB",128,0)
 Q "UNKNOWN"
"RTN","GMTSLROE")
0^3^B13446109
"RTN","GMTSLROE",1,0)
GMTSLROE ; SLC/JER,KER - Lab Orders Extract Routine ; 09/21/2001
"RTN","GMTSLROE",2,0)
 ;;2.7;Health Summary;**9,28,47,96,112**;Oct 20, 1995;Build 3
"RTN","GMTSLROE",3,0)
 ;
"RTN","GMTSLROE",4,0)
 ; External References
"RTN","GMTSLROE",5,0)
 ;   DBIA 10035  ^DPT(
"RTN","GMTSLROE",6,0)
 ;   DBIA   525  ^LR(
"RTN","GMTSLROE",7,0)
 ;   DBIA   532  ^LRO(69,
"RTN","GMTSLROE",8,0)
 ;   DBIA   524  ^LAB(61,
"RTN","GMTSLROE",9,0)
 ;   DBIA    67  ^LAB(60
"RTN","GMTSLROE",10,0)
 ;   DBIA   530  ^LAB(62.05,
"RTN","GMTSLROE",11,0)
 ;   DBIA   531  ^LRO(68,
"RTN","GMTSLROE",12,0)
 ;   DBIA  5466  ^LRJWLST
"RTN","GMTSLROE",13,0)
 ;   DBIA 10142  $$VERSION^XPDUTL
"RTN","GMTSLROE",14,0)
 ;                 
"RTN","GMTSLROE",15,0)
XTRCT ; Gets lab orders and loads them into GMTSLRO local array
"RTN","GMTSLROE",16,0)
 N LRDFN,GMI,CD,ID,SN,TN K ^TMP("LROI",$J)
"RTN","GMTSLROE",17,0)
 K ^TMP("LRO",$J)
"RTN","GMTSLROE",18,0)
 Q:'$D(^DPT(DFN,"LR"))  S LRDFN=+^DPT(DFN,"LR") Q:'$D(^LR(LRDFN))
"RTN","GMTSLROE",19,0)
 S CD=GMTSBEG-.1
"RTN","GMTSLROE",20,0)
 F  S CD=$O(^LRO(69,"D",LRDFN,CD)) Q:CD'>0!(CD>GMTSEND)  S SN=0 F  S SN=$O(^LRO(69,"D",LRDFN,CD,SN)) Q:SN'>0  S TN=0 F  S TN=$O(^LRO(69,CD,1,SN,2,TN)) Q:TN'>0  S ^TMP("LROI",$J,9999999-CD,SN,TN)=""
"RTN","GMTSLROE",21,0)
 S (GMI,ID)=0 F  S ID=$O(^TMP("LROI",$J,ID)) Q:ID'>0!(GMI=MAX)  S CD=9999999-ID,SN=0 F  S SN=$O(^TMP("LROI",$J,ID,SN)) Q:SN'>0!(GMI=MAX)  S TN=0 F  S TN=$O(^TMP("LROI",$J,ID,SN,TN)) Q:TN'>0!(GMI=MAX)  D SET
"RTN","GMTSLROE",22,0)
 K ^TMP("LROI",$J)
"RTN","GMTSLROE",23,0)
 Q
"RTN","GMTSLROE",24,0)
SET ; Sets ^TMP("LRO",$J, w/appropriate data
"RTN","GMTSLROE",25,0)
 N SPST,CST,OS,CDT,SPST,FST,RDT,SITE,SPEC,TST,IDT,COLL,ODT,MD,CS,URG,ACC
"RTN","GMTSLROE",26,0)
 N RL,TEST
"RTN","GMTSLROE",27,0)
 I $D(^LRO(69,CD,1,SN,0)) S SPST=^(0) D ORDER
"RTN","GMTSLROE",28,0)
 I $D(^LRO(69,CD,1,SN,1)) S CST=^(1) D COLLECT I 1
"RTN","GMTSLROE",29,0)
 E  S OS="ORDERED",X=$P(^LRO(69,CD,1,SN,0),U,8),IDT=9999999-X D REGDTM4^GMTSU S CDT=X K X
"RTN","GMTSLROE",30,0)
 I $D(^LRO(69,CD,1,SN,3)) S FST=^(3) D RESULT I 1
"RTN","GMTSLROE",31,0)
 E  S RDT="UNKNOWN"
"RTN","GMTSLROE",32,0)
 S SITE=+$G(^LRO(69,CD,1,SN,4,+$O(^LRO(69,CD,1,SN,4,0)),0)),SPEC=$S(SITE>0:SITE_";"_$P(^LAB(61,SITE,0),U),1:";UNKNOWN")
"RTN","GMTSLROE",33,0)
 I $D(^LRO(69,CD,1,SN,2,TN,0)) S TST=^(0) S:$P(TST,"^",9)="CA" OS="CANCELED" D TEST
"RTN","GMTSLROE",34,0)
 I $D(BADTEST) K BADTEST Q
"RTN","GMTSLROE",35,0)
 I $D(IDT),$D(SN),$D(TN) S ^TMP("LRO",$J,IDT,SN_TN)=CDT_U_TEST_U_SPEC_U_URG_U_OS_U_MD_U_ODT_U_ACC_U_RDT_U_COLL_U_CD_U_$P(TST,U,7),GMI=GMI+1
"RTN","GMTSLROE",36,0)
 Q
"RTN","GMTSLROE",37,0)
ORDER ; Get Orders
"RTN","GMTSLROE",38,0)
 N IFN,FNF,FILE,NM,NSPACE,PKG,X
"RTN","GMTSLROE",39,0)
 S COLL=$S($L($P(SPST,U,4)):$P(SPST,U,4),1:"UNKNOWN")
"RTN","GMTSLROE",40,0)
 S:"LW"[COLL COLL=$S(COLL="L":"LAB",1:"WARD")
"RTN","GMTSLROE",41,0)
 S X=$P(SPST,U,5) D REGDTM4^GMTSU S ODT=X
"RTN","GMTSLROE",42,0)
 S (MD,IFN)=$P(SPST,U,6),FNF=0,NSPACE="LR"
"RTN","GMTSLROE",43,0)
 S PKG=$$VERSION^XPDUTL(NSPACE),FILE=$S($G(PKG)<5.2:6,1:200)
"RTN","GMTSLROE",44,0)
 S NM=$$NAME^GMTSU(MD,0,10) S MD=MD_";"_NM
"RTN","GMTSLROE",45,0)
 S RL=$P(SPST,U,7) Q
"RTN","GMTSLROE",46,0)
COLLECT ; Collection Date and Time
"RTN","GMTSLROE",47,0)
 N X S X=$P(CST,U),IDT=9999999-X D REGDTM4^GMTSU S CDT=X,CS=$P(CST,U,4),OS="COLLECTED"
"RTN","GMTSLROE",48,0)
 S X=CS,OS=$S(X="C":"COLLECTED",X="U":"CANCELED",1:"On Collection List")
"RTN","GMTSLROE",49,0)
 Q
"RTN","GMTSLROE",50,0)
RESULT ; Result Date and Time
"RTN","GMTSLROE",51,0)
 N X S X=$P(FST,U,2) D REGDTM4^GMTSU S RDT=X
"RTN","GMTSLROE",52,0)
 I X S OS="COMPLETED"
"RTN","GMTSLROE",53,0)
 Q
"RTN","GMTSLROE",54,0)
TEST ; Lab Test Ordered
"RTN","GMTSLROE",55,0)
 N TPTR,UPTR,ACCD,ACCA,ACCN
"RTN","GMTSLROE",56,0)
 S TPTR=+TST,UPTR=$P(TST,U,2),ACCD=$P(TST,U,3)
"RTN","GMTSLROE",57,0)
 I $D(TPTR),(TPTR'>0) S BADTEST=1 Q
"RTN","GMTSLROE",58,0)
 S ACCA=$P(TST,U,4),ACCN=$P(TST,U,5)
"RTN","GMTSLROE",59,0)
 S TEST=TPTR_";"_$S($L($P(^LAB(60,TPTR,0),U))<21:$P(^(0),U),1:$P(^(.1),U))
"RTN","GMTSLROE",60,0)
 S URG=$E($S($D(^LAB(62.05,+UPTR,0)):$P(^(0),U),1:""),1,7)
"RTN","GMTSLROE",61,0)
 I $S('$D(ACCD):1,'$L(ACCA):1,'$L(ACCD):1,1:0) S ACC="NONE" Q
"RTN","GMTSLROE",62,0)
 S ACC=$S($D(^LRO(68,+ACCA,1,+ACCD,1,+ACCN,.2)):^(.2),1:"NONE")
"RTN","GMTSLROE",63,0)
 I $T(GETACC^LRJWLST)]"" D
"RTN","GMTSLROE",64,0)
 . N OACC
"RTN","GMTSLROE",65,0)
 . S OACC=$P($G(^LRO(69,CD,1,SN,2,TN,64.91)),"^",3)
"RTN","GMTSLROE",66,0)
 . I OACC]"" S ACC=OACC
"RTN","GMTSLROE",67,0)
 I $D(^LRO(68,+ACCA,1,+ACCD,1,+ACCN,4,TPTR,0)) S X=$P(^(0),U,5) I $G(OS)'="CANCELED",$G(OS)'="On Collection List" S OS=$S('$L(X):"PROCESSING",1:"COMPLETED")
"RTN","GMTSLROE",68,0)
 Q
"RTN","GMTSP112")
0^2^B4270408
"RTN","GMTSP112",1,0)
GMTSP112 ;BP/WAT - Pre/Post Init GMTS*2.7*112 ;03/26/15  05:27
"RTN","GMTSP112",2,0)
 ;;2.7;Health Summary;**112**;Oct 20, 1995;Build 3
"RTN","GMTSP112",3,0)
 ;post-install routine to add HS Components released in GMTS*2.7*99 to the PDX exchange process
"RTN","GMTSP112",4,0)
 ;ICR reference
"RTN","GMTSP112",5,0)
 ;2053, WP^DIE
"RTN","GMTSP112",6,0)
 ;10141 B/MES^XPDUTL
"RTN","GMTSP112",7,0)
 ;
"RTN","GMTSP112",8,0)
POST ; do post
"RTN","GMTSP112",9,0)
 D DOPDX
"RTN","GMTSP112",10,0)
 D WPDIE
"RTN","GMTSP112",11,0)
 Q
"RTN","GMTSP112",12,0)
 ;
"RTN","GMTSP112",13,0)
DOPDX ;add to PDX
"RTN","GMTSP112",14,0)
 N GMTSNAME,GMTSTIML,GMTSOCCL,GMTSLIST,GMTSCNTR
"RTN","GMTSP112",15,0)
 S GMTSLIST="MAS CONTACTS^MAS MH CLINIC VISITS FUTURE^MH HIGH RISK PRF HX^MH TREATMENT COORDINATOR^"
"RTN","GMTSP112",16,0)
 F GMTSCNTR=1:1:4 D
"RTN","GMTSP112",17,0)
 .S GMTSNAME=$P(GMTSLIST,U,GMTSCNTR),GMTSTIML="",GMTSOCCL="" D PDX^GMTSXPD5(GMTSNAME,GMTSTIML,GMTSOCCL)
"RTN","GMTSP112",18,0)
 Q
"RTN","GMTSP112",19,0)
 ;
"RTN","GMTSP112",20,0)
WPDIE ;udpate CNB description field
"RTN","GMTSP112",21,0)
 ;OLD DESCRIPTION:   This component displays Consults in a brief format, to include
"RTN","GMTSP112",22,0)
 ;the consult number, request date, requesting service, last action, last action
"RTN","GMTSP112",23,0)
 ;date, and the consult "TO" service.
"RTN","GMTSP112",24,0)
 D BMES^XPDUTL("Updating the DESCRIPTION for the CNB component...")
"RTN","GMTSP112",25,0)
 N FILE,IENS,FIELD,GMTSERR
"RTN","GMTSP112",26,0)
 S FILE="142.1",IENS="240,",FIELD="3.5"
"RTN","GMTSP112",27,0)
 K ^TMP($J,"CNB")
"RTN","GMTSP112",28,0)
 S ^TMP($J,"CNB",1)="This component displays Consults in a brief format, to include the consult "
"RTN","GMTSP112",29,0)
 S ^TMP($J,"CNB",2)="number, request date, requesting service, last action, clinically indicated "
"RTN","GMTSP112",30,0)
 S ^TMP($J,"CNB",3)="date, last action date, and the consult ""TO"" service."
"RTN","GMTSP112",31,0)
 D WP^DIE(FILE,IENS,FIELD,,"^TMP($J,""CNB"")")
"RTN","GMTSP112",32,0)
 I $D(^TMP("DIERR",$J,1,"TEXT"))=10 D  Q
"RTN","GMTSP112",33,0)
 .D BMES^XPDUTL("Recording an error has ocurred")
"RTN","GMTSP112",34,0)
 .D MES^XPDUTL(^TMP("DIERR",$J,1,"TEXT",1))
"RTN","GMTSP112",35,0)
 D BMES^XPDUTL("Update completed...")
"RTN","GMTSP112",36,0)
 Q
"VER")
8.0^22.0
**END**
**END**
