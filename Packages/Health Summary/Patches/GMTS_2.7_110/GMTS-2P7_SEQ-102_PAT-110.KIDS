Released GMTS*2.7*110 SEQ #102
Extracted from mail message
**KIDS**:GMTS*2.7*110^

**INSTALL NAME**
GMTS*2.7*110
"BLD",9609,0)
GMTS*2.7*110^HEALTH SUMMARY^0^3140205^y
"BLD",9609,4,0)
^9.64PA^^
"BLD",9609,6.3)
2
"BLD",9609,"ABPKG")
n
"BLD",9609,"KRN",0)
^9.67PA^779.2^20
"BLD",9609,"KRN",.4,0)
.4
"BLD",9609,"KRN",.401,0)
.401
"BLD",9609,"KRN",.402,0)
.402
"BLD",9609,"KRN",.403,0)
.403
"BLD",9609,"KRN",.5,0)
.5
"BLD",9609,"KRN",.84,0)
.84
"BLD",9609,"KRN",3.6,0)
3.6
"BLD",9609,"KRN",3.8,0)
3.8
"BLD",9609,"KRN",9.2,0)
9.2
"BLD",9609,"KRN",9.8,0)
9.8
"BLD",9609,"KRN",9.8,"NM",0)
^9.68A^3^3
"BLD",9609,"KRN",9.8,"NM",1,0)
GMTSADH5^^0^B46673093
"BLD",9609,"KRN",9.8,"NM",2,0)
GMTSPXFP^^0^B19319385
"BLD",9609,"KRN",9.8,"NM",3,0)
GMTSMHCI^^0^B11159676
"BLD",9609,"KRN",9.8,"NM","B","GMTSADH5",1)

"BLD",9609,"KRN",9.8,"NM","B","GMTSMHCI",3)

"BLD",9609,"KRN",9.8,"NM","B","GMTSPXFP",2)

"BLD",9609,"KRN",19,0)
19
"BLD",9609,"KRN",19.1,0)
19.1
"BLD",9609,"KRN",101,0)
101
"BLD",9609,"KRN",409.61,0)
409.61
"BLD",9609,"KRN",771,0)
771
"BLD",9609,"KRN",779.2,0)
779.2
"BLD",9609,"KRN",870,0)
870
"BLD",9609,"KRN",8989.51,0)
8989.51
"BLD",9609,"KRN",8989.52,0)
8989.52
"BLD",9609,"KRN",8994,0)
8994
"BLD",9609,"KRN","B",.4,.4)

"BLD",9609,"KRN","B",.401,.401)

"BLD",9609,"KRN","B",.402,.402)

"BLD",9609,"KRN","B",.403,.403)

"BLD",9609,"KRN","B",.5,.5)

"BLD",9609,"KRN","B",.84,.84)

"BLD",9609,"KRN","B",3.6,3.6)

"BLD",9609,"KRN","B",3.8,3.8)

"BLD",9609,"KRN","B",9.2,9.2)

"BLD",9609,"KRN","B",9.8,9.8)

"BLD",9609,"KRN","B",19,19)

"BLD",9609,"KRN","B",19.1,19.1)

"BLD",9609,"KRN","B",101,101)

"BLD",9609,"KRN","B",409.61,409.61)

"BLD",9609,"KRN","B",771,771)

"BLD",9609,"KRN","B",779.2,779.2)

"BLD",9609,"KRN","B",870,870)

"BLD",9609,"KRN","B",8989.51,8989.51)

"BLD",9609,"KRN","B",8989.52,8989.52)

"BLD",9609,"KRN","B",8994,8994)

"BLD",9609,"QDEF")
^^^^NO^^^^NO^^NO
"BLD",9609,"QUES",0)
^9.62^^
"BLD",9609,"REQB",0)
^9.611^2^2
"BLD",9609,"REQB",1,0)
GMTS*2.7*82^1
"BLD",9609,"REQB",2,0)
GMTS*2.7*99^1
"BLD",9609,"REQB","B","GMTS*2.7*82",1)

"BLD",9609,"REQB","B","GMTS*2.7*99",2)

"MBREQ")
0
"PKG",229,-1)
1^1
"PKG",229,0)
HEALTH SUMMARY^GMTS^Integrated Health Summary Tools
"PKG",229,20,0)
^9.402P^^
"PKG",229,22,0)
^9.49I^1^1
"PKG",229,22,1,0)
2.7^2951020^2960805
"PKG",229,22,1,"PAH",1,0)
110^3140205
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
3
"RTN","GMTSADH5")
0^1^B46673093^B43046802
"RTN","GMTSADH5",1,0)
GMTSADH5 ; SLC/DCM,KER - Health Summary Ad Hoc RPC's ; 02/27/2002
"RTN","GMTSADH5",2,0)
 ;;2.7;Health Summary;**36,35,37,49,63,110**;Oct 20, 1995;Build 2
"RTN","GMTSADH5",3,0)
 ;                     
"RTN","GMTSADH5",4,0)
 ; External References
"RTN","GMTSADH5",5,0)
 ;   DBIA  1268  ^AUTTHF(
"RTN","GMTSADH5",6,0)
 ;   DBIA  1268  ^AUTTHF("B"
"RTN","GMTSADH5",7,0)
 ;   DBIA    67  ^LAB(60
"RTN","GMTSADH5",8,0)
 ;   DBIA  1256  ^PXD(811.9
"RTN","GMTSADH5",9,0)
 ;   DBIA  3059  ^TIU(8925.1
"RTN","GMTSADH5",10,0)
 ;   DBIA 10006  ^DIC
"RTN","GMTSADH5",11,0)
 ;   DBIA  2052  $$GET1^DID
"RTN","GMTSADH5",12,0)
 ;   DBIA  3058  $$ISA^TIULX
"RTN","GMTSADH5",13,0)
 ;                   
"RTN","GMTSADH5",14,0)
COMP(Y) ; Get ADHOC sub components (FILE 142.1)
"RTN","GMTSADH5",15,0)
 ;
"RTN","GMTSADH5",16,0)
 ;  Y(i)=(1)I;IFN^(2)Component Name [Abb]^(3)Occ Limit^
"RTN","GMTSADH5",17,0)
 ;       (4)Time Limit^(5)Header Name^(6)Hosp Loc Disp^
"RTN","GMTSADH5",18,0)
 ;       (7)ICD Text Disp^(8)Prov Narr Disp^
"RTN","GMTSADH5",19,0)
 ;       (9)CPT Modifier Disp^(10)Summary Order
"RTN","GMTSADH5",20,0)
 ;
"RTN","GMTSADH5",21,0)
 N GMTSI,GMTSII,GMTSIFN,GMTSC,X,X1
"RTN","GMTSADH5",22,0)
 S Y(1)=$O(^GMT(142,"B","GMTS HS ADHOC OPTION",0))
"RTN","GMTSADH5",23,0)
 I 'Y(1) S Y(1)=-1 Q  ; Error, no ADHOC type defined
"RTN","GMTSADH5",24,0)
 S (GMTSC,GMTSI)=0,GMTSII=Y(1)
"RTN","GMTSADH5",25,0)
 F  S GMTSI=$O(^GMT(142,GMTSII,1,GMTSI)) Q:'GMTSI  S X=^(GMTSI,0) D
"RTN","GMTSADH5",26,0)
 . S GMTSIFN=$P(X,"^",2),X1=$G(^GMT(142.1,+GMTSIFN,0))
"RTN","GMTSADH5",27,0)
 . Q:'$L(X1)  Q:$P(X1,"^",6)="P"  S GMTSC=GMTSC+1
"RTN","GMTSADH5",28,0)
 . S Y(GMTSC)=GMTSI_";"_GMTSIFN
"RTN","GMTSADH5",29,0)
 . S Y(GMTSC)=Y(GMTSC)_"^"_$P(X1,"^")_" ["_$P(X1,"^",4)_"]"
"RTN","GMTSADH5",30,0)
 . S Y(GMTSC)=Y(GMTSC)_"^"_$S($P(X1,"^",5)="Y":$P(X,"^",3),1:"")
"RTN","GMTSADH5",31,0)
 . S Y(GMTSC)=Y(GMTSC)_"^"_$S($P(X1,"^",3)="Y":$P(X,"^",4),1:"")
"RTN","GMTSADH5",32,0)
 . S Y(GMTSC)=Y(GMTSC)_"^"_$S($L($P(X1,"^",9)):$P(X1,"^",9),1:$P(X,"^",5))
"RTN","GMTSADH5",33,0)
 . S Y(GMTSC)=Y(GMTSC)_"^"_$S($P(X1,"^",10)="Y":$P(X,"^",6),1:"")
"RTN","GMTSADH5",34,0)
 . S Y(GMTSC)=Y(GMTSC)_"^"_$S($P(X1,"^",11)="Y":$P(X,"^",7),1:"")
"RTN","GMTSADH5",35,0)
 . S Y(GMTSC)=Y(GMTSC)_"^"_$S($P(X1,"^",12)="Y":$P(X,"^",8),1:"")
"RTN","GMTSADH5",36,0)
 . S Y(GMTSC)=Y(GMTSC)_"^"_$P(X,"^")
"RTN","GMTSADH5",37,0)
 Q
"RTN","GMTSADH5",38,0)
 ;
"RTN","GMTSADH5",39,0)
COMPSUB(Y,GMTSUB) ; Get subcomponents from a predefined ADHOC component
"RTN","GMTSADH5",40,0)
 ; GMTSUB=desired Adhoc subcomponent
"RTN","GMTSADH5",41,0)
 ; Y(i)=ifn of pointed to file entry^name
"RTN","GMTSADH5",42,0)
 Q:'$G(GMTSUB)
"RTN","GMTSADH5",43,0)
 N GMTSI,GMTSII,GMTSIFN,GMTSC,X,X1
"RTN","GMTSADH5",44,0)
 S X=$O(^GMT(142,"B","GMTS HS ADHOC OPTION",0))
"RTN","GMTSADH5",45,0)
 I 'X Q  ; Error, no ADHOC type defined
"RTN","GMTSADH5",46,0)
 S (GMTSC,GMTSI)=0,GMTSII=X
"RTN","GMTSADH5",47,0)
 F  S GMTSI=$O(^GMT(142,GMTSII,1,GMTSUB,1,GMTSI)) Q:'GMTSI  S X=^(GMTSI,0) D
"RTN","GMTSADH5",48,0)
 . S GMTSIFN=+X,X1=$P(X,";",2)
"RTN","GMTSADH5",49,0)
 . I '$D(@("^"_X1_+X_",0)")) Q
"RTN","GMTSADH5",50,0)
 . S X=@("^"_X1_+X_",0)"),GMTSC=GMTSC+1,Y(GMTSC)=GMTSIFN_"^"_$P(X,"^")
"RTN","GMTSADH5",51,0)
 Q
"RTN","GMTSADH5",52,0)
 ;                 
"RTN","GMTSADH5",53,0)
FILES(Y,GMTSCP) ; Get Files to select from for a component
"RTN","GMTSADH5",54,0)
 Q:'$G(GMTSCP)  Q:'$D(^GMT(142.1,GMTSCP,1))
"RTN","GMTSADH5",55,0)
 N GMTSGEC,GMTSI,GMTSC,X
"RTN","GMTSADH5",56,0)
 S (GMTSGEC,GMTSI,GMTSC)=0
"RTN","GMTSADH5",57,0)
 I $P($G(^GMT(142.1,GMTSCP,0)),U,4)="GECH" S GMTSGEC=1
"RTN","GMTSADH5",58,0)
 F  S GMTSI=$O(^GMT(142.1,GMTSCP,1,GMTSI)) Q:'GMTSI  D
"RTN","GMTSADH5",59,0)
 .S X=^(GMTSI,0),GMTSC=GMTSC+1 S:GMTSGEC=1 X=X_"G"
"RTN","GMTSADH5",60,0)
 .S Y(GMTSC)=GMTSI_"^"_$$FNAM^GMTSU(+X)_"^"_X
"RTN","GMTSADH5",61,0)
 Q
"RTN","GMTSADH5",62,0)
 ;                     
"RTN","GMTSADH5",63,0)
FILESEL(GMTSRT,GMTSFI,GMTSFM,DIR) ; Get file entries
"RTN","GMTSADH5",64,0)
 Q:'$G(GMTSFI)
"RTN","GMTSADH5",65,0)
 K ^TMP("ORDATA",$J)
"RTN","GMTSADH5",66,0)
 N GMTSI,GMTSJ,GMTSC,X,GMTSGL,GMTSGLB,GMTSCNT,HFC
"RTN","GMTSADH5",67,0)
 S GMTSI=$G(GMTSFM),GMTSCNT=44,GMTSC=0,GMTSRT=$NA(^TMP("ORDATA",$J,1))
"RTN","GMTSADH5",68,0)
 S:'$D(DIR) DIR=1
"RTN","GMTSADH5",69,0)
 I GMTSFI=60 D  Q
"RTN","GMTSADH5",70,0)
 . F  Q:GMTSC'<GMTSCNT  S GMTSI=$O(^LAB(60,"B",GMTSI),DIR) Q:GMTSI=""  S GMTSJ=0 F  S GMTSJ=$O(^LAB(60,"B",GMTSI,GMTSJ)) Q:'GMTSJ  D
"RTN","GMTSADH5",71,0)
 . . I $D(^LAB(60,GMTSJ,0)) S X=^(0) I $P(X,"^",4)="CH","BO"[$P(X,"^",3) S GMTSC=GMTSC+1,^TMP("ORDATA",$J,1,GMTSC)=GMTSJ_"^"_GMTSI
"RTN","GMTSADH5",72,0)
 I GMTSFI="9999999.64G" D  Q
"RTN","GMTSADH5",73,0)
 . F  Q:GMTSC'<GMTSCNT  S GMTSI=$O(^AUTTHF("B",GMTSI),DIR) Q:GMTSI=""  S GMTSJ=0 F  S GMTSJ=$O(^AUTTHF("B",GMTSI,GMTSJ)) Q:'GMTSJ  I $D(^AUTTHF(GMTSJ,0)) S X=^(0) D
"RTN","GMTSADH5",74,0)
 ..I (($P(^(0),U,10)="C")&(+$P(^(0),U,11)'=1))&($P(^(0)," ",1)="GEC") D
"RTN","GMTSADH5",75,0)
 ...S GMTSC=GMTSC+1
"RTN","GMTSADH5",76,0)
 ...S HFC=$S($P($G(X),U,10)="F":"Factor",$P($G(X),U,10)="C":"Category")
"RTN","GMTSADH5",77,0)
 ...S ^TMP("ORDATA",$J,1,GMTSC)=GMTSJ_U_GMTSI_" ("_HFC_")"
"RTN","GMTSADH5",78,0)
 I GMTSFI=9999999.64 D  Q
"RTN","GMTSADH5",79,0)
 . F  Q:GMTSC'<GMTSCNT  S GMTSI=$O(^AUTTHF("B",GMTSI),DIR) Q:GMTSI=""  S GMTSJ=0 F  S GMTSJ=$O(^AUTTHF("B",GMTSI,GMTSJ)) Q:'GMTSJ  I $D(^AUTTHF(GMTSJ,0)) S X=^(0) D
"RTN","GMTSADH5",80,0)
 ..I +$P(X,U,11)'=1 D
"RTN","GMTSADH5",81,0)
 ...S GMTSC=GMTSC+1
"RTN","GMTSADH5",82,0)
 ...S HFC=$S($P($G(X),U,10)="F":"Factor",$P($G(X),U,10)="C":"Category")
"RTN","GMTSADH5",83,0)
 ...S ^TMP("ORDATA",$J,1,GMTSC)=GMTSJ_U_GMTSI_" ("_HFC_")"
"RTN","GMTSADH5",84,0)
 I GMTSFI=811.9 D  Q
"RTN","GMTSADH5",85,0)
 . F  Q:GMTSC'<GMTSCNT  S GMTSI=$O(^PXD(811.9,"B",GMTSI),DIR) Q:GMTSI=""  S GMTSJ=0 F  S GMTSJ=$O(^PXD(811.9,"B",GMTSI,GMTSJ)) Q:'GMTSJ  I $D(^PXD(811.9,GMTSJ,0)) S X=^(0) D
"RTN","GMTSADH5",86,0)
 . . I $P(X,"^",6)'=1 S GMTSC=GMTSC+1,^TMP("ORDATA",$J,1,GMTSC)=GMTSJ_"^"_GMTSI
"RTN","GMTSADH5",87,0)
 I GMTSFI=8925.1 D  Q
"RTN","GMTSADH5",88,0)
 . F  Q:GMTSC'<GMTSCNT  S GMTSI=$O(^TIU(8925.1,"B",GMTSI),DIR) Q:GMTSI=""  S GMTSJ=0 F  S GMTSJ=$O(^TIU(8925.1,"B",GMTSI,GMTSJ)) Q:'GMTSJ  I $D(^TIU(8925.1,GMTSJ,0)) S X=^(0) D
"RTN","GMTSADH5",89,0)
 . . I $P(X,"^",4)="DOC",$$ISA^TIULX(GMTSJ,3) S GMTSC=GMTSC+1,^TMP("ORDATA",$J,1,GMTSC)=GMTSJ_"^"_GMTSI
"RTN","GMTSADH5",90,0)
 ; KDM 1/28/2014  GMTS*2.7*110
"RTN","GMTSADH5",91,0)
 ;     Added code for the 81 file (CPT code) to list in logical sort order using the "BA" indexed file
"RTN","GMTSADH5",92,0)
 I GMTSFI=81 D  Q
"RTN","GMTSADH5",93,0)
 . S GMTSGL=$$FCLR^GMTSU(+GMTSFI) I $L(GMTSGL) S GMTSGLB=$$FLOC^GMTSU(+GMTSFI)_"""BA"")" D
"RTN","GMTSADH5",94,0)
 .. F  Q:GMTSC'<GMTSCNT  S GMTSI=$O(@GMTSGLB@(GMTSI),DIR) Q:GMTSI=""  S GMTSJ=0 F  S GMTSJ=$O(@GMTSGLB@(GMTSI,GMTSJ)) Q:'GMTSJ  I $D(@GMTSGL@(GMTSJ,0)) S X=^(0) D
"RTN","GMTSADH5",95,0)
 ... S GMTSC=GMTSC+1,^TMP("ORDATA",$J,1,GMTSC)=GMTSJ_"^"_GMTSI
"RTN","GMTSADH5",96,0)
 S GMTSGL=$$FCLR^GMTSU(+GMTSFI) I $L(GMTSGL) S GMTSGLB=$$FLOC^GMTSU(+GMTSFI)_"""B"")" D
"RTN","GMTSADH5",97,0)
 . F  Q:GMTSC'<GMTSCNT  S GMTSI=$O(@GMTSGLB@(GMTSI),DIR) Q:GMTSI=""  S GMTSJ=0 F  S GMTSJ=$O(@GMTSGLB@(GMTSI,GMTSJ)) Q:'GMTSJ  I $D(@GMTSGL@(GMTSJ,0)) S X=^(0) D
"RTN","GMTSADH5",98,0)
 . . S GMTSC=GMTSC+1,^TMP("ORDATA",$J,1,GMTSC)=GMTSJ_"^"_GMTSI
"RTN","GMTSADH5",99,0)
 Q
"RTN","GMTSADH5",100,0)
 ;                     
"RTN","GMTSADH5",101,0)
REPORT(GMTSEG,GMTSEGC,GMTSEGI,GMTSCPS,DFN) ; Build Report
"RTN","GMTSADH5",102,0)
 ; Uses array of Components passed in GMTSCPS()
"RTN","GMTSADH5",103,0)
 ;   GMTSCPS(i)=array of subcomponents chosen,
"RTN","GMTSADH5",104,0)
 ;   value is pointer at ^GMT(142,DA(1),1,DA)
"RTN","GMTSADH5",105,0)
 Q:'$G(DFN)
"RTN","GMTSADH5",106,0)
 N GMTSCNT,DIC,DIZ,DIW,DIWI,DIWT,DIWTC,X,GMTSI,GMTSJ,GMTSK,GMTSTYP,GMTSTITL
"RTN","GMTSADH5",107,0)
 S X="GMTS HS ADHOC",DIC=142,DIZ(0)="ZF"
"RTN","GMTSADH5",108,0)
 D ^DIC Q:'Y
"RTN","GMTSADH5",109,0)
 S GMTSTYP=+Y,GMTSTITL="AD HOC",(GMTSJ,GMTSI)=0,GMTSEGC=$O(GMTSCPS(99999999),-1)
"RTN","GMTSADH5",110,0)
 F  S GMTSI=$O(GMTSCPS(GMTSI)) Q:'GMTSI  D
"RTN","GMTSADH5",111,0)
 . N GMTSREC,GMTSS2,GMTSSJ,GMTSEL
"RTN","GMTSADH5",112,0)
 . S GMTSREC=^GMT(142,GMTSTYP,1,+GMTSCPS(GMTSI),0),GMTSJ=GMTSJ+1
"RTN","GMTSADH5",113,0)
 . S GMTSEG(GMTSJ)=GMTSREC,GMTSEGI($P(GMTSREC,U,2))=GMTSJ,GMTSS2=0,GMTSSJ=GMTSJ
"RTN","GMTSADH5",114,0)
 . S $P(GMTSEG(GMTSJ),"^",3)=$P(GMTSCPS(GMTSI),"^",2)
"RTN","GMTSADH5",115,0)
 . S $P(GMTSEG(GMTSJ),"^",4)=$P(GMTSCPS(GMTSI),"^",3)
"RTN","GMTSADH5",116,0)
 . I $L($P(GMTSCPS(GMTSI),"^",4)) S $P(GMTSEG(GMTSJ),"^",5)=$P(GMTSCPS(GMTSI),"^",4)
"RTN","GMTSADH5",117,0)
 . I $L($P(GMTSCPS(GMTSI),"^",5)) S $P(GMTSEG(GMTSJ),"^",6)=$P(GMTSCPS(GMTSI),"^",5)
"RTN","GMTSADH5",118,0)
 . S $P(GMTSEG(GMTSJ),"^",7)=$P(GMTSCPS(GMTSI),"^",6)
"RTN","GMTSADH5",119,0)
 . I $L($P(GMTSCPS(GMTSI),"^",7)) S $P(GMTSEG(GMTSJ),"^",8)=$P(GMTSCPS(GMTSI),"^",7)
"RTN","GMTSADH5",120,0)
 . S (GMTSCNT,GMTSK)=0
"RTN","GMTSADH5",121,0)
 . F  S GMTSK=$O(GMTSCPS(GMTSK)) Q:'GMTSK  D
"RTN","GMTSADH5",122,0)
 . .I $P($G(GMTSCPS(GMTSK)),U,9)="9999999.64G" S $P(GMTSCPS(GMTSK),U,9)="9999999.64"
"RTN","GMTSADH5",123,0)
 . .I +GMTSCPS(GMTSI)=+GMTSCPS(GMTSK),$P(GMTSCPS(GMTSK),"^",9),$P(GMTSCPS(GMTSK),"^",10) D
"RTN","GMTSADH5",124,0)
 . . . S GMTSCNT=GMTSCNT+1
"RTN","GMTSADH5",125,0)
 . . . S:'$D(GMTSEG(GMTSJ,$P(GMTSCPS(GMTSK),"^",9),0)) GMTSEG(GMTSJ,$P(GMTSCPS(GMTSK),"^",9),0)=$$GET1^DID($P(GMTSCPS(GMTSK),"^",9),,,"GLOBAL NAME")
"RTN","GMTSADH5",126,0)
 . . . S GMTSEG(GMTSJ,$P(GMTSCPS(GMTSK),"^",9),GMTSCNT)=$P(GMTSCPS(GMTSK),"^",10)
"RTN","GMTSADH5",127,0)
 . . . K GMTSCPS(GMTSK)
"RTN","GMTSADH5",128,0)
 Q
"RTN","GMTSADH5",129,0)
 ;                     
"RTN","GMTSADH5",130,0)
SUBITEM(Y,GMTSTEST) ; Get Subitems for a Test Panel
"RTN","GMTSADH5",131,0)
 Q:'$G(GMTSTEST)  N GMTSCNT S GMTSCNT=0
"RTN","GMTSADH5",132,0)
 I '$L($P(^LAB(60,GMTSTEST,0),"^",5)),$O(^LAB(60,GMTSTEST,2,0)) D COMPILE(GMTSTEST,GMTSCNT)
"RTN","GMTSADH5",133,0)
 Q
"RTN","GMTSADH5",134,0)
 ;                     
"RTN","GMTSADH5",135,0)
COMPILE(GMTSTEST,GMTSCNT) ; Expand lab panels
"RTN","GMTSADH5",136,0)
 N GMTSI,GMTSJ,GMTSRT S GMTSI=0
"RTN","GMTSADH5",137,0)
 F  S GMTSI=$O(^LAB(60,GMTSTEST,2,GMTSI)) Q:GMTSI'>0  D
"RTN","GMTSADH5",138,0)
 . S GMTSJ=+$G(^LAB(60,GMTSTEST,2,+GMTSI,0))
"RTN","GMTSADH5",139,0)
 . S GMTSRT=$G(^LAB(60,+GMTSJ,0))
"RTN","GMTSADH5",140,0)
 . I $L($P(GMTSRT,U,5)),("BO"[$P(GMTSRT,U,3)) D
"RTN","GMTSADH5",141,0)
 . . S GMTSCNT=GMTSCNT+1
"RTN","GMTSADH5",142,0)
 . . S Y(GMTSCNT)=+GMTSJ_"^"_GMTSRT
"RTN","GMTSADH5",143,0)
 . E  D
"RTN","GMTSADH5",144,0)
 . . D COMPILE(+$G(^LAB(60,GMTSTEST,2,GMTSI,0)),GMTSCNT)
"RTN","GMTSADH5",145,0)
 Q
"RTN","GMTSMHCI")
0^3^B11159676^B11062334
"RTN","GMTSMHCI",1,0)
GMTSMHCI ;SLC/WAT - HRMH PATIENT CONTACT INFO ;06/13/11  11:58
"RTN","GMTSMHCI",2,0)
 ;;2.7;Health Summary;**99,110**;Oct 20, 1995;Build 2
"RTN","GMTSMHCI",3,0)
 ;
"RTN","GMTSMHCI",4,0)
 ;EXTERNAL CALLS
"RTN","GMTSMHCI",5,0)
 ;ADD/OAD/KVA ^VADPT 10061
"RTN","GMTSMHCI",6,0)
 ;Field # .134 PHONE NUMBER [CELLULAR] from Patient file 10035
"RTN","GMTSMHCI",7,0)
 ;$$GET1^DIQ 2056
"RTN","GMTSMHCI",8,0)
 ;
"RTN","GMTSMHCI",9,0)
 ;
"RTN","GMTSMHCI",10,0)
 ;Get contact data to display in TIU HS object.  The object is used in reminder dialog that MH professionals
"RTN","GMTSMHCI",11,0)
 ;will use to f/u on missed patient apptointments.
"RTN","GMTSMHCI",12,0)
 ;DATA PULLED BY THIS COMPONENT.
"RTN","GMTSMHCI",13,0)
 ;patient phone numbers
"RTN","GMTSMHCI",14,0)
 ;        cell
"RTN","GMTSMHCI",15,0)
 ;        home
"RTN","GMTSMHCI",16,0)
 ;        work
"RTN","GMTSMHCI",17,0)
 ;
"RTN","GMTSMHCI",18,0)
 ;;emergency contact: name, relationship, phone number
"RTN","GMTSMHCI",19,0)
 ;;secondary emergency contact: name, relationship, phone number
"RTN","GMTSMHCI",20,0)
 ;;secondary next of kin contact: name, relationship, phone number
"RTN","GMTSMHCI",21,0)
 ;
"RTN","GMTSMHCI",22,0)
PRINT  ;MAIN
"RTN","GMTSMHCI",23,0)
 K ^TMP($J,"GMTS CONTACT INFO")
"RTN","GMTSMHCI",24,0)
 N CNT,HMPHON,TAB,NODATA S CNT=0
"RTN","GMTSMHCI",25,0)
 S NODATA="No data available"
"RTN","GMTSMHCI",26,0)
 S ^TMP($J,"GMTS CONTACT INFO",CNT)="  Patient Phone Numbers:",CNT=CNT+1
"RTN","GMTSMHCI",27,0)
 S TAB="        " ;8 SPACES
"RTN","GMTSMHCI",28,0)
 D CELL
"RTN","GMTSMHCI",29,0)
 D HOME
"RTN","GMTSMHCI",30,0)
 D WORK
"RTN","GMTSMHCI",31,0)
 S ^TMP($J,"GMTS CONTACT INFO",CNT)="",CNT=CNT+1
"RTN","GMTSMHCI",32,0)
 D EMERGNOK
"RTN","GMTSMHCI",33,0)
 D REPORT
"RTN","GMTSMHCI",34,0)
 D KVA^VADPT
"RTN","GMTSMHCI",35,0)
 Q
"RTN","GMTSMHCI",36,0)
 ;
"RTN","GMTSMHCI",37,0)
CELL ;GET CELL #
"RTN","GMTSMHCI",38,0)
 N GMTSCELL S GMTSCELL=""
"RTN","GMTSMHCI",39,0)
 S GMTSCELL=$$GET1^DIQ(2,DFN,.134)
"RTN","GMTSMHCI",40,0)
 S ^TMP($J,"GMTS CONTACT INFO",CNT)=TAB_"Cell: "_$S($G(GMTSCELL)>0:GMTSCELL,1:NODATA),CNT=CNT+1
"RTN","GMTSMHCI",41,0)
 Q
"RTN","GMTSMHCI",42,0)
 ;
"RTN","GMTSMHCI",43,0)
WORK ;work ph #
"RTN","GMTSMHCI",44,0)
 ; KDM 1/28/2014 GMTS*2.7*110 
"RTN","GMTSMHCI",45,0)
 ;     Replaced OAD^VADPT call with OPD^VADPT to return correct patient work phone number
"RTN","GMTSMHCI",46,0)
 N VAPD,WORK D OPD^VADPT
"RTN","GMTSMHCI",47,0)
 I $G(VAERR)=1 S ^TMP($J,"GMTS CONTACT INFO",CNT)="PATIENT NOT FOUND",CNT=CNT+1 Q
"RTN","GMTSMHCI",48,0)
 S ^TMP($J,"GMTS CONTACT INFO",CNT)=TAB_"Work: "_$S($G(VAPD(8))'="":VAPD(8),1:NODATA),CNT=CNT+1
"RTN","GMTSMHCI",49,0)
 Q
"RTN","GMTSMHCI",50,0)
 ;
"RTN","GMTSMHCI",51,0)
HOME ;home phone
"RTN","GMTSMHCI",52,0)
 N VAPA,VAERR,HOME D ADD^VADPT
"RTN","GMTSMHCI",53,0)
 I $G(VAERR)=1 S ^TMP($J,"GMTS CONTACT INFO",CNT)="PATIENT NOT FOUND",CNT=CNT+1 Q
"RTN","GMTSMHCI",54,0)
 S ^TMP($J,"GMTS CONTACT INFO",CNT)=TAB_"Home: "_$S($G(VAPA(8))'="":VAPA(8),1:NODATA),CNT=CNT+1
"RTN","GMTSMHCI",55,0)
 Q
"RTN","GMTSMHCI",56,0)
 ;
"RTN","GMTSMHCI",57,0)
EMERGNOK ; emergency and NOK contacts.
"RTN","GMTSMHCI",58,0)
 N I,VAOA,VAERR
"RTN","GMTSMHCI",59,0)
 ;S:$G(VAERR)=1 ^TMP($J,"GMTS CONTACT INFO",CNT)="PATIENT NOT FOUND",CNT=CNT+1 Q
"RTN","GMTSMHCI",60,0)
 F I=1,4,3 D
"RTN","GMTSMHCI",61,0)
 .S VAOA("A")=I D OAD^VADPT Q:$G(VAERR)=1
"RTN","GMTSMHCI",62,0)
 .S ^TMP($J,"GMTS CONTACT INFO",CNT)=$S(VAOA("A")=1:"  Emergency Contact: ",VAOA("A")=4:"  Secondary Emergency Contact: ",VAOA("A")=3:"  Secondary Next of Kin Contact"),CNT=CNT+1
"RTN","GMTSMHCI",63,0)
 .S ^TMP($J,"GMTS CONTACT INFO",CNT)=TAB_"Name: "_$S($G(VAOA(9))'="":VAOA(9),1:NODATA),CNT=CNT+1
"RTN","GMTSMHCI",64,0)
 .S ^TMP($J,"GMTS CONTACT INFO",CNT)=TAB_"Relationship: "_$S($G(VAOA(10))'="":VAOA(10),1:NODATA),CNT=CNT+1
"RTN","GMTSMHCI",65,0)
 .S ^TMP($J,"GMTS CONTACT INFO",CNT)=TAB_"Phone: "_$S($G(VAOA(8))'="":VAOA(8),1:NODATA),CNT=CNT+1
"RTN","GMTSMHCI",66,0)
 .S ^TMP($J,"GMTS CONTACT INFO",CNT)="",CNT=CNT+1
"RTN","GMTSMHCI",67,0)
 Q
"RTN","GMTSMHCI",68,0)
 ;
"RTN","GMTSMHCI",69,0)
REPORT ;write to screen
"RTN","GMTSMHCI",70,0)
 N LINE S LINE=""
"RTN","GMTSMHCI",71,0)
 F  S LINE=$O(^TMP($J,"GMTS CONTACT INFO",LINE)) D  Q:LINE=""
"RTN","GMTSMHCI",72,0)
 .Q:LINE=""
"RTN","GMTSMHCI",73,0)
 .D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSMHCI",74,0)
 .W:LINE=0 ^TMP($J,"GMTS CONTACT INFO",LINE)
"RTN","GMTSMHCI",75,0)
 .W:LINE>0 !,^TMP($J,"GMTS CONTACT INFO",LINE)
"RTN","GMTSMHCI",76,0)
 Q
"RTN","GMTSPXFP")
0^2^B19319385^B19095007
"RTN","GMTSPXFP",1,0)
GMTSPXFP ; SLC/SBW,KER - PCE Health Factors Component ; 2/22/07 1:52pm
"RTN","GMTSPXFP",2,0)
 ;;2.7;Health Summary;**8,10,28,56,58,62,69,82,110**;Oct 20, 1995;Build 2
"RTN","GMTSPXFP",3,0)
 ;
"RTN","GMTSPXFP",4,0)
 ; External References
"RTN","GMTSPXFP",5,0)
 ;   DBIA   1243  HF^PXRHS07
"RTN","GMTSPXFP",6,0)
 ;   DBIA   4295  $$GET1^DIQ  (file #9999999.64, .01)
"RTN","GMTSPXFP",7,0)
 ;   DBIA   4295  $$GET1^DIQ  (file #9999999.64, .03)
"RTN","GMTSPXFP",8,0)
 ;   DBIA   4295  $$GET1^DIQ  (file #9999999.64, .08)
"RTN","GMTSPXFP",9,0)
 ;   DBIA   4295  $$GET1^DIQ  (file #9999999.64), .1)
"RTN","GMTSPXFP",10,0)
 ;   DBIA   4295  ^AUTTHF("AC")
"RTN","GMTSPXFP",11,0)
 ;   DBIA  10011  ^DIWP
"RTN","GMTSPXFP",12,0)
 ;                    
"RTN","GMTSPXFP",13,0)
HFSEL ; Health Factors Selected
"RTN","GMTSPXFP",14,0)
 N HFSEG,GMTSFC,GMW,GMTSHFO Q:$O(GMTSEG(GMTSEGN,9999999.64,0))'>0
"RTN","GMTSPXFP",15,0)
 S GMTSFC=0,GMW=0 K ^TMP("PXF",$J),^TMP("GMTSPXO",$J)
"RTN","GMTSPXFP",16,0)
 F  S GMTSFC=$O(GMTSEG(GMTSEGN,9999999.64,GMTSFC)) Q:'GMTSFC  D
"RTN","GMTSPXFP",17,0)
 . S HFSEG(GMTSEG(GMTSEGN,9999999.64,GMTSFC))=""
"RTN","GMTSPXFP",18,0)
 K ^TMP("PXF",$J) D HF^PXRHS07(DFN,GMTSEND,GMTSBEG,GMTSNDM,.HFSEG)
"RTN","GMTSPXFP",19,0)
 Q:'$D(^TMP("PXF",$J))  D REORD D CKP^GMTSUP Q:$D(GMTSQIT)  D SELECT
"RTN","GMTSPXFP",20,0)
 Q
"RTN","GMTSPXFP",21,0)
REORD ; Re-Order Selected Health Factors
"RTN","GMTSPXFP",22,0)
 N GMTSI,GMTSHFI,GMTSCAT,GMTSHFT,GMTSMCAT,GMTSHF,GMTSHFC K GMTSHFO
"RTN","GMTSPXFP",23,0)
 S GMTSI=0 F  S GMTSI=$O(GMTSEG(GMTSEGN,9999999.64,GMTSI)) Q:+GMTSI=0  D
"RTN","GMTSPXFP",24,0)
 . S GMTSHFI=$G(GMTSEG(GMTSEGN,9999999.64,GMTSI))
"RTN","GMTSPXFP",25,0)
 . S GMTSCAT=$$GET1^DIQ(9999999.64,(GMTSHFI_","),.03)
"RTN","GMTSPXFP",26,0)
 . S GMTSHFT=$$GET1^DIQ(9999999.64,(GMTSHFI_","),.1,"I") Q:'$L(GMTSHFT)
"RTN","GMTSPXFP",27,0)
 . I GMTSHFT="C" D  Q
"RTN","GMTSPXFP",28,0)
 . . N GMTSCAT,GMTSMCAT S GMTSMCAT=GMTSHFI N GMTSHFI
"RTN","GMTSPXFP",29,0)
 . . S GMTSCAT=$$GET1^DIQ(9999999.64,(GMTSMCAT_","),.01) Q:'$L(GMTSCAT)
"RTN","GMTSPXFP",30,0)
 . . S GMTSHFI=0 F  S GMTSHFI=$O(^AUTTHF("AC",+GMTSMCAT,GMTSHFI)) Q:+GMTSHFI=0  D
"RTN","GMTSPXFP",31,0)
 . . . S GMTSHF=$$GET1^DIQ(9999999.64,(GMTSHFI_","),.01) Q:'$L(GMTSHF)
"RTN","GMTSPXFP",32,0)
 . . . S GMTSHFC=+($O(^TMP("GMTSPXO",$J," "),-1))+1,^TMP("GMTSPXO",$J,GMTSHFC,GMTSCAT,GMTSHF)=""
"RTN","GMTSPXFP",33,0)
 . Q:'$L(GMTSCAT)  S GMTSHF=$$GET1^DIQ(9999999.64,(GMTSHFI_","),.01) Q:'$L(GMTSHF)
"RTN","GMTSPXFP",34,0)
 . S GMTSHFC=+($O(^TMP("GMTSPXO",$J," "),-1))+1,^TMP("GMTSPXO",$J,GMTSHFC,GMTSCAT,GMTSHF)=""
"RTN","GMTSPXFP",35,0)
 Q
"RTN","GMTSPXFP",36,0)
HFACT ; Control Health Factor retrieval and display
"RTN","GMTSPXFP",37,0)
 K ^TMP("PXF",$J) D HF^PXRHS07(DFN,GMTSEND,GMTSBEG,GMTSNDM) Q:'$D(^TMP("PXF",$J))
"RTN","GMTSPXFP",38,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  D HFMAIN
"RTN","GMTSPXFP",39,0)
 Q
"RTN","GMTSPXFP",40,0)
HFMAIN ; Display Health Factors
"RTN","GMTSPXFP",41,0)
 N GMHFC,GMHF,GMDT,GMIFN,GMN0,GMW,X,GMTSDAT,HF,LEVEL,PHFC,COMMENT,GMICL,GMTAB,GMTSLN,GMTSFRST S GMHFC="",GMW=0,GMTSFRST=0
"RTN","GMTSPXFP",42,0)
 F  S GMHFC=$O(^TMP("PXF",$J,GMHFC)) Q:GMHFC=""  D  Q:$D(GMTSQIT)
"RTN","GMTSPXFP",43,0)
 . S GMHF="" F  S GMHF=$O(^TMP("PXF",$J,GMHFC,GMHF)) Q:GMHF=""  D  Q:$D(GMTSQIT)
"RTN","GMTSPXFP",44,0)
 . . D BYDT
"RTN","GMTSPXFP",45,0)
 K ^TMP("PXF",$J),^TMP("GMTSPXO",$J) W:GMTSFRST=0 " No data available",!
"RTN","GMTSPXFP",46,0)
 Q
"RTN","GMTSPXFP",47,0)
SELECT ; Display Selected Health Factors
"RTN","GMTSPXFP",48,0)
 N GMO,GMHFC,GMHF,GMDT,GMIFN,GMN0,GMW,X,GMTSDAT,HF,LEVEL,PHFC,COMMENT,GMICL,GMTAB,GMTSLN,GMTSFRST S GMHFC="",GMW=0,PHFC="",GMTSFRST=0
"RTN","GMTSPXFP",49,0)
 S GMO=0 F  S GMO=$O(^TMP("GMTSPXO",$J,GMO)) Q:+GMO=0  D  Q:$D(GMTSQIT)
"RTN","GMTSPXFP",50,0)
 . S GMHFC="" F  S GMHFC=$O(^TMP("GMTSPXO",$J,GMO,GMHFC)) Q:'$L(GMHFC)  D  Q:$D(GMTSQIT)
"RTN","GMTSPXFP",51,0)
 . . S GMHF="" F  S GMHF=$O(^TMP("GMTSPXO",$J,GMO,GMHFC,GMHF)) Q:'$L(GMHF)  D  Q:$D(GMTSQIT)
"RTN","GMTSPXFP",52,0)
 . . . D BYDT
"RTN","GMTSPXFP",53,0)
 K ^TMP("PXF",$J),^TMP("GMTSPXO",$J) W:GMTSFRST=0 " No Data Available",!
"RTN","GMTSPXFP",54,0)
 Q
"RTN","GMTSPXFP",55,0)
BYDT ; Display Health Factors by Date
"RTN","GMTSPXFP",56,0)
 N GMDT,GMIFN S GMDT=0 F  S GMDT=$O(^TMP("PXF",$J,GMHFC,GMHF,GMDT)) Q:GMDT'>0  D  Q:$D(GMTSQIT)
"RTN","GMTSPXFP",57,0)
 . S GMIFN=0 F  S GMIFN=$O(^TMP("PXF",$J,GMHFC,GMHF,GMDT,GMIFN)) Q:GMIFN'>0  D  Q:$D(GMTSQIT)
"RTN","GMTSPXFP",58,0)
 . . D HFDSP Q:$D(GMTSQIT)
"RTN","GMTSPXFP",59,0)
 Q
"RTN","GMTSPXFP",60,0)
HDR ; Display Header
"RTN","GMTSPXFP",61,0)
 ; KDM 1/28/2014 GMTS*2.7*110 
"RTN","GMTSPXFP",62,0)
 ;     Change header from "Visit Date" to "Event/Visit Date" to reduce ambiguity as it can be either date.
"RTN","GMTSPXFP",63,0)
 N GMTSRN Q:$D(GMTSOBJ)  Q:$D(GMTSQIT)
"RTN","GMTSPXFP",64,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W "Category",!
"RTN","GMTSPXFP",65,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W "  Health Factor ",?50,"Event/Visit Date",! W:GMTSFRST=1 !
"RTN","GMTSPXFP",66,0)
 Q
"RTN","GMTSPXFP",67,0)
HFDSP ; Display Data
"RTN","GMTSPXFP",68,0)
 N GMTSRN,GMTSIEN
"RTN","GMTSPXFP",69,0)
 ;VMP/RJT -- HD67936 -- HEALTH FACTORS 'DISPLAY ON HEALTH SUMMARY' PARAMETER CHECK
"RTN","GMTSPXFP",70,0)
 S GMTSIEN=$$FIND1^DIC(9999999.64,"","X",GMHF,"B",""),GMTSRN=$$GET1^DIQ(9999999.64,GMTSIEN,.08,"I")
"RTN","GMTSPXFP",71,0)
 Q:GMTSRN'="Y"
"RTN","GMTSPXFP",72,0)
 I GMTSFRST=0 D HDR S GMTSFRST=1
"RTN","GMTSPXFP",73,0)
 S GMN0=$G(^TMP("PXF",$J,GMHFC,GMHF,GMDT,GMIFN,0))
"RTN","GMTSPXFP",74,0)
 Q:GMN0']""
"RTN","GMTSPXFP",75,0)
 S X=$P(GMN0,U,2) D REGDT4^GMTSU S GMTSDAT=X
"RTN","GMTSPXFP",76,0)
 S HF=$P(GMN0,U),LEVEL=$P(GMN0,U,4)
"RTN","GMTSPXFP",77,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  D:GMTSNPG HDR D
"RTN","GMTSPXFP",78,0)
 . I GMHFC'=$G(PHFC)!GMTSNPG D
"RTN","GMTSPXFP",79,0)
 . . I '$D(GMTSOBJ),$G(PHFC)="",'GMTSNPG W ! D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSPXFP",80,0)
 . . W GMHFC,! S PHFC=GMHFC
"RTN","GMTSPXFP",81,0)
 . S GMW=1
"RTN","GMTSPXFP",82,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSPXFP",83,0)
 W ?2,HF
"RTN","GMTSPXFP",84,0)
 W:LEVEL]"" " (",LEVEL,")"
"RTN","GMTSPXFP",85,0)
 W ?50,GMTSDAT,!
"RTN","GMTSPXFP",86,0)
 S COMMENT="",COMMENT=$P(^TMP("PXF",$J,GMHFC,GMHF,GMDT,GMIFN,"COM"),U)
"RTN","GMTSPXFP",87,0)
 I COMMENT]"" S GMICL=13,GMTAB=2 D FORMAT I $D(^UTILITY($J,"W")) D CKP^GMTSUP Q:$D(GMTSQIT)  D
"RTN","GMTSPXFP",88,0)
 . F GMTSLN=1:1:^UTILITY($J,"W",DIWL) D LINE Q:$D(GMTSQIT)
"RTN","GMTSPXFP",89,0)
 Q
"RTN","GMTSPXFP",90,0)
FORMAT ; Format Line
"RTN","GMTSPXFP",91,0)
 N DIWR,DIWF,X
"RTN","GMTSPXFP",92,0)
 S DIWL=3,DIWR=80-(GMICL+GMTAB)
"RTN","GMTSPXFP",93,0)
 K ^UTILITY($J,"W")
"RTN","GMTSPXFP",94,0)
 S X=COMMENT D ^DIWP
"RTN","GMTSPXFP",95,0)
 Q
"RTN","GMTSPXFP",96,0)
LINE ; Write Line
"RTN","GMTSPXFP",97,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W ?13,^UTILITY($J,"W",DIWL,GMTSLN,0),!
"RTN","GMTSPXFP",98,0)
 Q
"VER")
8.0^22.0
"BLD",9609,6)
^102
**END**
**END**

