Released DG*5.3*955 SEQ #842
Extracted from mail message
**KIDS**:DG*5.3*955^

**INSTALL NAME**
DG*5.3*955
"BLD",3325,0)
DG*5.3*955^REGISTRATION^0^3180425^y
"BLD",3325,1,0)
^^3^3^3180425^
"BLD",3325,1,1,0)
MASTER VETERAN INDEX VISTA ENHANCEMENTS - ACTIVE DUAL CONSUMER (ADC) 
"BLD",3325,1,2,0)
Refer to patch DG*5.3*955 in the FORUM Patch Module for a complete
"BLD",3325,1,3,0)
description.
"BLD",3325,4,0)
^9.64PA^^
"BLD",3325,6.3)
1
"BLD",3325,"KRN",0)
^9.67PA^779.2^20
"BLD",3325,"KRN",.4,0)
.4
"BLD",3325,"KRN",.401,0)
.401
"BLD",3325,"KRN",.402,0)
.402
"BLD",3325,"KRN",.403,0)
.403
"BLD",3325,"KRN",.5,0)
.5
"BLD",3325,"KRN",.84,0)
.84
"BLD",3325,"KRN",3.6,0)
3.6
"BLD",3325,"KRN",3.8,0)
3.8
"BLD",3325,"KRN",9.2,0)
9.2
"BLD",3325,"KRN",9.8,0)
9.8
"BLD",3325,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",3325,"KRN",9.8,"NM",1,0)
VAFCPTAD^^0^B73211296
"BLD",3325,"KRN",9.8,"NM","B","VAFCPTAD",1)

"BLD",3325,"KRN",19,0)
19
"BLD",3325,"KRN",19.1,0)
19.1
"BLD",3325,"KRN",101,0)
101
"BLD",3325,"KRN",409.61,0)
409.61
"BLD",3325,"KRN",771,0)
771
"BLD",3325,"KRN",779.2,0)
779.2
"BLD",3325,"KRN",870,0)
870
"BLD",3325,"KRN",8989.51,0)
8989.51
"BLD",3325,"KRN",8989.52,0)
8989.52
"BLD",3325,"KRN",8994,0)
8994
"BLD",3325,"KRN","B",.4,.4)

"BLD",3325,"KRN","B",.401,.401)

"BLD",3325,"KRN","B",.402,.402)

"BLD",3325,"KRN","B",.403,.403)

"BLD",3325,"KRN","B",.5,.5)

"BLD",3325,"KRN","B",.84,.84)

"BLD",3325,"KRN","B",3.6,3.6)

"BLD",3325,"KRN","B",3.8,3.8)

"BLD",3325,"KRN","B",9.2,9.2)

"BLD",3325,"KRN","B",9.8,9.8)

"BLD",3325,"KRN","B",19,19)

"BLD",3325,"KRN","B",19.1,19.1)

"BLD",3325,"KRN","B",101,101)

"BLD",3325,"KRN","B",409.61,409.61)

"BLD",3325,"KRN","B",771,771)

"BLD",3325,"KRN","B",779.2,779.2)

"BLD",3325,"KRN","B",870,870)

"BLD",3325,"KRN","B",8989.51,8989.51)

"BLD",3325,"KRN","B",8989.52,8989.52)

"BLD",3325,"KRN","B",8994,8994)

"BLD",3325,"QUES",0)
^9.62^^
"BLD",3325,"REQB",0)
^9.611^1^1
"BLD",3325,"REQB",1,0)
DG*5.3*950^2
"BLD",3325,"REQB","B","DG*5.3*950",1)

"MBREQ")
0
"PKG",5,-1)
1^1
"PKG",5,0)
REGISTRATION^DG^PATIENT REGISTRATION, ADMISSION, DISCHARGE, EMBOSSER 
"PKG",5,22,0)
^9.49I^1^1
"PKG",5,22,1,0)
5.3^2930813^2970721^12541
"PKG",5,22,1,"PAH",1,0)
955^3180425
"PKG",5,22,1,"PAH",1,1,0)
^^3^3^3180425
"PKG",5,22,1,"PAH",1,1,1,0)
MASTER VETERAN INDEX VISTA ENHANCEMENTS - ACTIVE DUAL CONSUMER (ADC) 
"PKG",5,22,1,"PAH",1,1,2,0)
Refer to patch DG*5.3*955 in the FORUM Patch Module for a complete
"PKG",5,22,1,"PAH",1,1,3,0)
description.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","VAFCPTAD")
0^1^B73211296^B72347771
"RTN","VAFCPTAD",1,0)
VAFCPTAD ; ISA/RJS,Zoltan;BIR/PTD,CKN - ADD NEW PATIENT ENTRY ; 8/14/14 6:07pm
"RTN","VAFCPTAD",2,0)
 ;;5.3;Registration;**149,800,876,944,950,955**;Aug 13, 1993;Build 1
"RTN","VAFCPTAD",3,0)
 ;
"RTN","VAFCPTAD",4,0)
ADD(RETURN,PARAM) ;Add an entry to the PATIENT (#2) file for VOA
"RTN","VAFCPTAD",5,0)
 ;
"RTN","VAFCPTAD",6,0)
 ;Input
"RTN","VAFCPTAD",7,0)
 ;  PARAM = List of data to be used for the creation of a VistA
"RTN","VAFCPTAD",8,0)
 ;          PATIENT (#2) record at the Preferred Facility.
"RTN","VAFCPTAD",9,0)
 ;  
"RTN","VAFCPTAD",10,0)
 ;Required elements include:
"RTN","VAFCPTAD",11,0)
 ;  PARAM("PRFCLTY")=PREFERRED FACILITY
"RTN","VAFCPTAD",12,0)
 ;  PARAM("NAME")=NAME (last name minimal; recommend full name)
"RTN","VAFCPTAD",13,0)
 ;  PARAM("GENDER")=SEX
"RTN","VAFCPTAD",14,0)
 ;  PARAM("DOB")=DATE OF BIRTH
"RTN","VAFCPTAD",15,0)
 ;  PARAM("SSN")=SOCIAL SECURITY NUMBER OR NULL IF NONE
"RTN","VAFCPTAD",16,0)
 ;  PARAM("SRVCNCTD")=SERVICE CONNECTED?
"RTN","VAFCPTAD",17,0)
 ;  PARAM("TYPE")=TYPE
"RTN","VAFCPTAD",18,0)
 ;  PARAM("VET")=VETERAN (Y/N)?
"RTN","VAFCPTAD",19,0)
 ;  PARAM("FULLICN")=INTEGRATION CONTROL NUMBER AND CHECKSUM
"RTN","VAFCPTAD",20,0)
 ;
"RTN","VAFCPTAD",21,0)
 ;Optional elements include:
"RTN","VAFCPTAD",22,0)
 ;  PARAM("POBCTY")=PLACE OF BIRTH [CITY]
"RTN","VAFCPTAD",23,0)
 ;  PARAM("POBST")=PLACE OF BIRTH [STATE]
"RTN","VAFCPTAD",24,0)
 ;  PARAM("MMN")=MOTHER'S MAIDEN NAME
"RTN","VAFCPTAD",25,0)
 ;  PARAM("MBI")=MULTIPLE BIRTH INDICATOR
"RTN","VAFCPTAD",26,0)
 ;  PARAM("ALIAS",#)=ALIAS NAME(last^first^middle^suffix)^ALIAS SSN
"RTN","VAFCPTAD",27,0)
 ;
"RTN","VAFCPTAD",28,0)
 ;Output:
"RTN","VAFCPTAD",29,0)
 ;  On Failure:  -1^error text - record add failed
"RTN","VAFCPTAD",30,0)
 ;  On Success:   1^DFN of new PATIENT (#2) record
"RTN","VAFCPTAD",31,0)
 ;
"RTN","VAFCPTAD",32,0)
EN1 ;Check value of all required fields
"RTN","VAFCPTAD",33,0)
 D NOW^%DTC
"RTN","VAFCPTAD",34,0)
 N ALSERR,DIERR,DPTIDS,DPTX,ERROR,FLG,FDA,FN,LN,MN,RESULT,RGRSICN,SFX,VAL,VAFCA08,X,Y
"RTN","VAFCPTAD",35,0)
 N VAFCDFN,VAFCDOB,VAFCICN,VAFCMMN,VAFCNAM,VAFCPF,VAFCPOBC,VAFCPOBS
"RTN","VAFCPTAD",36,0)
 N VAFCRSN,VAFCSRV,VAFCSSN,VAFCSUM,VAFCSX,VAFCTYP,VAFCVET,VAFCMBI
"RTN","VAFCPTAD",37,0)
 K RETURN
"RTN","VAFCPTAD",38,0)
 S (RGRSICN,VAFCA08)=1 S FLG=0 ;allow update to ICN; prevent triggering of messages
"RTN","VAFCPTAD",39,0)
 ;
"RTN","VAFCPTAD",40,0)
 ;PREFERRED FACILITY
"RTN","VAFCPTAD",41,0)
 I $G(PARAM("PRFCLTY"))="" S RETURN(1)="-1^PREFERRED FACILITY is a required field." Q
"RTN","VAFCPTAD",42,0)
 ;**955 (cmc) Story 699475 don't require perferred facility to be this site if this is station 200
"RTN","VAFCPTAD",43,0)
 I $P($$SITE^VASITE(),"^",3)'=200 I $G(PARAM("PRFCLTY"))'=$P($$SITE^VASITE(),"^",3) S RETURN(1)="-1^PREFERRED FACILITY is not the station to which the RPC was sent." Q
"RTN","VAFCPTAD",44,0)
 I $G(PARAM("PRFCLTY"))'="" S VAL=$G(PARAM("PRFCLTY")) D CHK^DIE(2,27.02,,VAL,.RESULT) I RESULT="^" S RETURN(1)="-1^"_^TMP("DIERR",$J,1,"TEXT",1) Q
"RTN","VAFCPTAD",45,0)
 S VAFCPF=VAL,FLG=1
"RTN","VAFCPTAD",46,0)
 ;
"RTN","VAFCPTAD",47,0)
 ;INTEGRATION CONTROL NUMBER and ICN CHECKSUM
"RTN","VAFCPTAD",48,0)
 I $G(PARAM("FULLICN"))="" S RETURN(1)="-1^Full INTEGRATION CONTROL NUMBER with ICN CHECKSUM is required." Q
"RTN","VAFCPTAD",49,0)
 I $G(PARAM("FULLICN"))'["V" S RETURN(1)="-1^Full INTEGRATION CONTROL NUMBER with ICN CHECKSUM is required." Q
"RTN","VAFCPTAD",50,0)
 I $G(PARAM("FULLICN"))'="" D
"RTN","VAFCPTAD",51,0)
 .S PARAM("ICN")=$P(PARAM("FULLICN"),"V")
"RTN","VAFCPTAD",52,0)
 .S PARAM("CHKSUM")=$P(PARAM("FULLICN"),"V",2)
"RTN","VAFCPTAD",53,0)
 I $G(PARAM("ICN"))'="" S VAL=$G(PARAM("ICN")) D CHK^DIE(2,991.01,,VAL,.RESULT) I RESULT="^" S RETURN(1)="-1^"_^TMP("DIERR",$J,1,"TEXT",1) Q
"RTN","VAFCPTAD",54,0)
 S VAFCICN=VAL,FLG=1
"RTN","VAFCPTAD",55,0)
 I $G(PARAM("CHKSUM"))'="" S VAL=$G(PARAM("CHKSUM")) D CHK^DIE(2,991.02,,VAL,.RESULT) I RESULT="^" S RETURN(1)="-1^"_^TMP("DIERR",$J,1,"TEXT",1) Q
"RTN","VAFCPTAD",56,0)
 S VAFCSUM=VAL,FLG=1
"RTN","VAFCPTAD",57,0)
 ;Has patient already been created at this facility?  If so get DFN and quit.
"RTN","VAFCPTAD",58,0)
 I $O(^DPT("AICN",PARAM("ICN"),0)) S RETURN(1)="1^"_$O(^DPT("AICN",PARAM("ICN"),0)) Q
"RTN","VAFCPTAD",59,0)
 ;
"RTN","VAFCPTAD",60,0)
 ;NAME INPUT AS:LAST^FIRST^MIDDLE^SUFFIX; MUST BE FORMATTED FOR VISTA INPUT
"RTN","VAFCPTAD",61,0)
 I $G(PARAM("NAME"))="" S RETURN(1)="-1^Patient NAME is a required field." Q
"RTN","VAFCPTAD",62,0)
 S LN=$P($G(PARAM("NAME")),"^"),FN=$P($G(PARAM("NAME")),"^",2),MN=$P($G(PARAM("NAME")),"^",3),SFX=$P($G(PARAM("NAME")),"^",4)
"RTN","VAFCPTAD",63,0)
 S PARAM("NAME")=LN_","
"RTN","VAFCPTAD",64,0)
 I FN'="" S PARAM("NAME")=PARAM("NAME")_FN
"RTN","VAFCPTAD",65,0)
 I MN'="" S PARAM("NAME")=PARAM("NAME")_" "_MN
"RTN","VAFCPTAD",66,0)
 I SFX'="" S PARAM("NAME")=PARAM("NAME")_" "_SFX
"RTN","VAFCPTAD",67,0)
 I $G(PARAM("NAME"))'="" S VAL=$G(PARAM("NAME")) D CHK^DIE(2,.01,,VAL,.RESULT) I RESULT="^" S RETURN(1)="-1^"_^TMP("DIERR",$J,1,"TEXT",1) Q
"RTN","VAFCPTAD",68,0)
 S VAFCNAM=VAL,FLG=1
"RTN","VAFCPTAD",69,0)
 S DPTX=VAL ;variable used by SSN input transform
"RTN","VAFCPTAD",70,0)
 ;
"RTN","VAFCPTAD",71,0)
 ;DATE OF BIRTH
"RTN","VAFCPTAD",72,0)
 I $G(PARAM("DOB"))="" S RETURN(1)="-1^DATE OF BIRTH is a required field." Q
"RTN","VAFCPTAD",73,0)
 I $G(PARAM("DOB"))'="" S VAL=$G(PARAM("DOB")) D CHK^DIE(2,.03,,VAL,.RESULT) I RESULT="^" S RETURN(1)="-1^"_^TMP("DIERR",$J,1,"TEXT",1) Q
"RTN","VAFCPTAD",74,0)
 S VAFCDOB=VAL,FLG=1
"RTN","VAFCPTAD",75,0)
 S DPTIDS(.03)=RESULT ;variable used by PSEUDO-SSN code
"RTN","VAFCPTAD",76,0)
 ;
"RTN","VAFCPTAD",77,0)
 ;SOCIAL SECURITY NUMBER not equal null; valid 9-digit number
"RTN","VAFCPTAD",78,0)
 I '$D(PARAM("SSN")) S RETURN(1)="-1^SOCIAL SECURITY NUMBER is a required field.  A null value may be sent." Q
"RTN","VAFCPTAD",79,0)
 I $G(PARAM("SSN"))'="" S VAL=$G(PARAM("SSN")) D CHK^DIE(2,.09,,VAL,.RESULT) I RESULT="^" S RETURN(1)="-1^"_^TMP("DIERR",$J,1,"TEXT",1) Q
"RTN","VAFCPTAD",80,0)
 I $G(PARAM("SSN"))'="" S VAFCSSN=VAL,FLG=1
"RTN","VAFCPTAD",81,0)
 I $G(PARAM("SSN"))="" D  ;SSN null, set PSEUDO SSN REASON=SSN UNKNOWN/FOLLOW-UP
"RTN","VAFCPTAD",82,0)
 .S PARAM("SSN")="P" ;PSEUDO SSN
"RTN","VAFCPTAD",83,0)
 .S PARAM("PSEUDO")="S" ;PSEUDO SSN REASON
"RTN","VAFCPTAD",84,0)
 .S VAFCSSN=$G(PARAM("SSN")),FLG=1
"RTN","VAFCPTAD",85,0)
 .;If SSN null, set PSEUDO SSN REASON (#.0906) =SSN UNKNOWN/FOLLOW-UP
"RTN","VAFCPTAD",86,0)
 .S VAFCRSN=$G(PARAM("PSEUDO")),FLG=1
"RTN","VAFCPTAD",87,0)
 ;
"RTN","VAFCPTAD",88,0)
 ;SEX
"RTN","VAFCPTAD",89,0)
 I $G(PARAM("GENDER"))="" S RETURN(1)="-1^GENDER is a required field." Q
"RTN","VAFCPTAD",90,0)
 I $G(PARAM("GENDER"))'="" S VAL=$G(PARAM("GENDER")) D CHK^DIE(2,.02,,VAL,.RESULT) I RESULT="^" S RETURN(1)="-1^"_^TMP("DIERR",$J,1,"TEXT",1) Q
"RTN","VAFCPTAD",91,0)
 S VAFCSX=VAL,FLG=1
"RTN","VAFCPTAD",92,0)
 ;
"RTN","VAFCPTAD",93,0)
 ;SERVICE CONNECTED?
"RTN","VAFCPTAD",94,0)
 I $G(PARAM("SRVCNCTD"))="" S RETURN(1)="-1^'SERVICE CONNECTED?' is a required field." Q
"RTN","VAFCPTAD",95,0)
 ;input set to either YES or NO on the MPI before RPC call; skip CHK^DIE
"RTN","VAFCPTAD",96,0)
 ;here as it resulted in error; expected DFN variable which is not yet set.
"RTN","VAFCPTAD",97,0)
 I $G(PARAM("SRVCNCTD"))'="" S VAFCSRV=$G(PARAM("SRVCNCTD"))
"RTN","VAFCPTAD",98,0)
 ;
"RTN","VAFCPTAD",99,0)
 ;TYPE
"RTN","VAFCPTAD",100,0)
 I $G(PARAM("TYPE"))="" S RETURN(1)="-1^Patient TYPE is a required field." Q
"RTN","VAFCPTAD",101,0)
 I $G(PARAM("TYPE"))'="" S VAL=$G(PARAM("TYPE")) D CHK^DIE(2,391,,VAL,.RESULT) I RESULT="^" S RETURN(1)="-1^"_^TMP("DIERR",$J,1,"TEXT",1) Q
"RTN","VAFCPTAD",102,0)
 S VAFCTYP=VAL,FLG=1
"RTN","VAFCPTAD",103,0)
 ;
"RTN","VAFCPTAD",104,0)
 ;VETERAN Y/N?
"RTN","VAFCPTAD",105,0)
 I $G(PARAM("VET"))="" S RETURN(1)="-1^'VETERAN Y/N?' is a required field." Q
"RTN","VAFCPTAD",106,0)
 ;input set to either YES or NO on the MPI before RPC call; skip CHK^DIE
"RTN","VAFCPTAD",107,0)
 ;here as it resulted in error; expected DFN variable which is not yet set.
"RTN","VAFCPTAD",108,0)
 I $G(PARAM("VET"))'="" S VAFCVET=$E($G(PARAM("VET")),1),FLG=1 ;internal format
"RTN","VAFCPTAD",109,0)
 ;
"RTN","VAFCPTAD",110,0)
 ;Optional - POB CITY
"RTN","VAFCPTAD",111,0)
 I $D(PARAM("POBCTY")) S VAL=$G(PARAM("POBCTY")) D CHK^DIE(2,.092,,VAL,.RESULT) I RESULT="^" S RETURN(1)="-1^"_^TMP("DIERR",$J,1,"TEXT",1) Q
"RTN","VAFCPTAD",112,0)
 I $D(PARAM("POBCTY")) S VAFCPOBC=VAL,FLG=1
"RTN","VAFCPTAD",113,0)
 ;
"RTN","VAFCPTAD",114,0)
 ;Optional - POB STATE
"RTN","VAFCPTAD",115,0)
 N STIEN,UNDEF S UNDEF=0
"RTN","VAFCPTAD",116,0)
 I $D(PARAM("POBST")) D  I UNDEF S RETURN(1)="-1^The value passed for PLACE OF BIRTH [STATE], "_PARAM("POBST")_", is not a valid STATE (#5) file entry." Q
"RTN","VAFCPTAD",117,0)
 .;Convert STATE ABBREVIATION into STATE NAME
"RTN","VAFCPTAD",118,0)
 .S STIEN=$O(^DIC(5,"C",PARAM("POBST"),0))
"RTN","VAFCPTAD",119,0)
 .I STIEN="" S UNDEF=1 Q
"RTN","VAFCPTAD",120,0)
 .I STIEN'="" S PARAM("POBST")=$P($G(^DIC(5,STIEN,0)),"^")
"RTN","VAFCPTAD",121,0)
 .S VAL=$G(PARAM("POBST"))
"RTN","VAFCPTAD",122,0)
 .D CHK^DIE(2,.093,,VAL,.RESULT) I RESULT="^" S RETURN(1)="-1^"_^TMP("DIERR",$J,1,"TEXT",1) Q
"RTN","VAFCPTAD",123,0)
 .S VAFCPOBS=VAL,FLG=1
"RTN","VAFCPTAD",124,0)
 ;
"RTN","VAFCPTAD",125,0)
 ;Optional - MOTHER'S MAIDEN NAME
"RTN","VAFCPTAD",126,0)
 I $D(PARAM("MMN")) S VAL=$G(PARAM("MMN")) D CHK^DIE(2,.2403,,VAL,.RESULT) I RESULT="^" S RETURN(1)="-1^"_^TMP("DIERR",$J,1,"TEXT",1) Q
"RTN","VAFCPTAD",127,0)
 I $D(PARAM("MMN")) S VAFCMMN=VAL,FLG=1
"RTN","VAFCPTAD",128,0)
 ;
"RTN","VAFCPTAD",129,0)
 ;**876 - MVI_2788 (ckn) - Add MBI
"RTN","VAFCPTAD",130,0)
 ;Optional - MULTIPLE BIRTH INDICATOR
"RTN","VAFCPTAD",131,0)
 I $D(PARAM("MBI")) S VAL=$G(PARAM("MBI")) D CHK^DIE(2,994,,VAL,.RESULT) I RESULT="^" S RETURN(1)="-1^"_^TMP("DIERR",$J,1,"TEXT",1) Q
"RTN","VAFCPTAD",132,0)
 I $G(PARAM("MBI"))'="" S VAFCMBI=VAL,FLG=1
"RTN","VAFCPTAD",133,0)
 ;
"RTN","VAFCPTAD",134,0)
 I FLG=0 S RETURN(1)="-1^Required information is missing; please check input and try again." Q
"RTN","VAFCPTAD",135,0)
 ;Else ok to file entry
"RTN","VAFCPTAD",136,0)
FILE ;Call FILE^DICN to add new entry to PATIENT (#2) file
"RTN","VAFCPTAD",137,0)
 N DA,DIC,DR,FULLICN K DD,DO
"RTN","VAFCPTAD",138,0)
 S DIC="^DPT(",DIC(0)="FLZ",DLAYGO=2,X=VAFCNAM
"RTN","VAFCPTAD",139,0)
 ;**876 MVI_2788 (ckn) - Remove four slash use for field 1901
"RTN","VAFCPTAD",140,0)
 ;**944 Story #557843 (cml) add code to update FULL ICN (#991.1), WHO ENTERED PATIENT (#.096), and DATE ENTERED INTO FILE (#.097) fields
"RTN","VAFCPTAD",141,0)
 S FULLICN=VAFCICN_"V"_VAFCSUM
"RTN","VAFCPTAD",142,0)
 S DIC("DR")=".09///"_VAFCSSN_";.03///"_VAFCDOB_";.02///"_VAFCSX_";391///"_VAFCTYP_";1901///"_VAFCVET_";.301///"_VAFCSRV_";991.01///"_VAFCICN_";991.02///"_VAFCSUM_";991.1///"_FULLICN
"RTN","VAFCPTAD",143,0)
 I VAFCSSN="P" S DIC("DR")=DIC("DR")_";.0906///"_VAFCRSN
"RTN","VAFCPTAD",144,0)
 I $G(VAFCPOBC)'="" S DIC("DR")=DIC("DR")_";.092///"_VAFCPOBC
"RTN","VAFCPTAD",145,0)
 I $G(VAFCPOBS)'="" S DIC("DR")=DIC("DR")_";.093///"_VAFCPOBS
"RTN","VAFCPTAD",146,0)
 I $G(VAFCMMN)'="" S DIC("DR")=DIC("DR")_";.2403///"_VAFCMMN
"RTN","VAFCPTAD",147,0)
 ;**876 - MVI_2788 (ckn)
"RTN","VAFCPTAD",148,0)
 I $G(VAFCMBI)'="" S DIC("DR")=DIC("DR")_";994///"_VAFCMBI
"RTN","VAFCPTAD",149,0)
 L +^DPT(0):10
"RTN","VAFCPTAD",150,0)
 D FILE^DICN K DA,DIC,DD,DLAYGO,DO,DR
"RTN","VAFCPTAD",151,0)
 L -^DPT(0)
"RTN","VAFCPTAD",152,0)
 ;If record creation/update fails, return a -1^error text
"RTN","VAFCPTAD",153,0)
 I $P(Y,U,3)'=1 S RETURN(1)="-1^"_"Attempt to add patient "_VAFCNAM_" to the PATIENT (#2) file at station number "_$P($$SITE^VASITE,"^",3)_" failed." Q
"RTN","VAFCPTAD",154,0)
 S VAFCDFN=+Y
"RTN","VAFCPTAD",155,0)
 ; file Who and When if not already done
"RTN","VAFCPTAD",156,0)
 N DGZ
"RTN","VAFCPTAD",157,0)
 S DGZ=$G(^DPT(VAFCDFN,0))
"RTN","VAFCPTAD",158,0)
 S:'$P(DGZ,"^",15) FDA(2,VAFCDFN_",",.096)=DUZ
"RTN","VAFCPTAD",159,0)
 S:'$P(DGZ,"^",16) FDA(2,VAFCDFN_",",.097)=DT
"RTN","VAFCPTAD",160,0)
 D:$D(FDA) FILE^DIE("","FDA")
"RTN","VAFCPTAD",161,0)
 ;
"RTN","VAFCPTAD",162,0)
 ;File ALIAS multiple
"RTN","VAFCPTAD",163,0)
 I $D(PARAM("ALIAS")) D ALIAS  ;If ALIAS data is passed, call ALIAS module
"RTN","VAFCPTAD",164,0)
 I $G(ALSERR)="" S RETURN(1)="1^"_VAFCDFN  ;No errors for ALIAS, return DFN
"RTN","VAFCPTAD",165,0)
 I $G(ALSERR)'="" S RETURN(1)=ALSERR
"RTN","VAFCPTAD",166,0)
 Q
"RTN","VAFCPTAD",167,0)
 ;
"RTN","VAFCPTAD",168,0)
 ;
"RTN","VAFCPTAD",169,0)
ALIAS ;Optional - Add ALIAS and ALIAS SSN data for entry
"RTN","VAFCPTAD",170,0)
 ;Only occurs for a NEW record; there is no previous ALIAS data
"RTN","VAFCPTAD",171,0)
 I '$D(PARAM("ALIAS")) Q
"RTN","VAFCPTAD",172,0)
 ;ALIAS input comes in as: LAST^FIRST^MIDDLE^SUFFIX^SSN
"RTN","VAFCPTAD",173,0)
 N AFN,ALN,AMN,ASFX,ASSN,ERR,FDA,I,LOC,NUM
"RTN","VAFCPTAD",174,0)
 S (I,NUM)=0 F  S NUM=$O(PARAM("ALIAS",NUM)) Q:'NUM  D
"RTN","VAFCPTAD",175,0)
 .S ALN=$P($G(PARAM("ALIAS",NUM)),"^") Q:ALN=""  ;Last name minimal input
"RTN","VAFCPTAD",176,0)
 .S AFN=$P($G(PARAM("ALIAS",NUM)),"^",2)
"RTN","VAFCPTAD",177,0)
 .S AMN=$P($G(PARAM("ALIAS",NUM)),"^",3)
"RTN","VAFCPTAD",178,0)
 .S ASFX=$P($G(PARAM("ALIAS",NUM)),"^",4)
"RTN","VAFCPTAD",179,0)
 .S ASSN=$P($G(PARAM("ALIAS",NUM)),"^",5)
"RTN","VAFCPTAD",180,0)
 .;Change format for VistA input: LAST,FIRST MIDDLE SUFFIX^SSN
"RTN","VAFCPTAD",181,0)
 .S LOC(NUM)=ALN_","
"RTN","VAFCPTAD",182,0)
 .I AFN'="" S LOC(NUM)=LOC(NUM)_AFN
"RTN","VAFCPTAD",183,0)
 .I AMN'="" S LOC(NUM)=LOC(NUM)_" "_AMN
"RTN","VAFCPTAD",184,0)
 .I ASFX'="" S LOC(NUM)=LOC(NUM)_" "_ASFX
"RTN","VAFCPTAD",185,0)
 .S LOC(NUM)=LOC(NUM)_"^"
"RTN","VAFCPTAD",186,0)
 .I ASSN'="" S LOC(NUM)=LOC(NUM)_ASSN
"RTN","VAFCPTAD",187,0)
 .;Set FDA nodes
"RTN","VAFCPTAD",188,0)
 .S I=I+1 ;Unique sequence number for add to ALIAS SUB-FILE (#2.01
"RTN","VAFCPTAD",189,0)
 .S FDA(2.01,"+"_I_","_VAFCDFN_",",.01)=$P(LOC(NUM),"^") ; (#.01) ALIAS (name)
"RTN","VAFCPTAD",190,0)
 .I ASSN'="" S FDA(2.01,"+"_I_","_VAFCDFN_",",1)=$P(LOC(NUM),"^",2) ; (#1) ALIAS SSN
"RTN","VAFCPTAD",191,0)
 ;Update ALIAS multiple with new entries
"RTN","VAFCPTAD",192,0)
 I $D(FDA) D  ;We have ALIAS data to add
"RTN","VAFCPTAD",193,0)
 .S ALSERR=""
"RTN","VAFCPTAD",194,0)
 .L +^DPT(VAFCDFN):10
"RTN","VAFCPTAD",195,0)
 .D UPDATE^DIE("E","FDA",,"ERR")
"RTN","VAFCPTAD",196,0)
 .L -^DPT(VAFCDFN)
"RTN","VAFCPTAD",197,0)
 .I $D(ERR("DIERR")) S ALSERR="1^"_VAFCDFN_"^Patient "_PARAM("NAME")_" was successfully added at "_$P($$SITE^VASITE,"^",3)_".  However, the ALIAS data failed to update. Error message: "_$G(ERR("DIERR","1","TEXT",1)) Q
"RTN","VAFCPTAD",198,0)
 Q
"RTN","VAFCPTAD",199,0)
 ;
"VER")
8.0^22.2
"BLD",3325,6)
^842
**END**
**END**

