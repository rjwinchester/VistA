Released DG*5.3*902 SEQ #797
Extracted from mail message
**KIDS**:DG*5.3*902^

**INSTALL NAME**
DG*5.3*902
"BLD",3012,0)
DG*5.3*902^REGISTRATION^0^3141222^y
"BLD",3012,1,0)
^9.61A^3^3^3141222^^^
"BLD",3012,1,1,0)
MASTER VETERAN INDEX VISTA ISSUES - ITERATION 13
"BLD",3012,1,2,0)
Refer to patch DG*5.3*902 in the FORUM Patch Module for a complete
"BLD",3012,1,3,0)
description.
"BLD",3012,4,0)
^9.64PA^2^1
"BLD",3012,4,2,0)
2
"BLD",3012,4,2,2,0)
^9.641^2.0991^2
"BLD",3012,4,2,2,2,0)
PATIENT  (File-top level)
"BLD",3012,4,2,2,2,1,0)
^9.6411^.355^3
"BLD",3012,4,2,2,2,1,.354,0)
DATE OF DEATH LAST UPDATED
"BLD",3012,4,2,2,2,1,.355,0)
LAST EDITED BY
"BLD",3012,4,2,2,2,1,991.1,0)
FULL ICN
"BLD",3012,4,2,2,2.0991,0)
FULL ICN HISTORY  (sub-file)
"BLD",3012,4,2,2,2.0991,1,0)
^9.6411^^
"BLD",3012,4,2,222)
y^y^p^^^^n^^n
"BLD",3012,4,2,224)

"BLD",3012,4,"APDD",2,2)

"BLD",3012,4,"APDD",2,2,.354)

"BLD",3012,4,"APDD",2,2,.355)

"BLD",3012,4,"APDD",2,2,991.1)

"BLD",3012,4,"APDD",2,2.0991)

"BLD",3012,4,"B",2,2)

"BLD",3012,6.3)
2
"BLD",3012,"ABPKG")
n
"BLD",3012,"INID")
^n
"BLD",3012,"INIT")
DG902PST
"BLD",3012,"KRN",0)
^9.67PA^779.2^20
"BLD",3012,"KRN",.4,0)
.4
"BLD",3012,"KRN",.401,0)
.401
"BLD",3012,"KRN",.402,0)
.402
"BLD",3012,"KRN",.403,0)
.403
"BLD",3012,"KRN",.5,0)
.5
"BLD",3012,"KRN",.84,0)
.84
"BLD",3012,"KRN",3.6,0)
3.6
"BLD",3012,"KRN",3.8,0)
3.8
"BLD",3012,"KRN",9.2,0)
9.2
"BLD",3012,"KRN",9.8,0)
9.8
"BLD",3012,"KRN",9.8,"NM",0)
^9.68A^6^6
"BLD",3012,"KRN",9.8,"NM",1,0)
VAFCHIS^^0^B14349143
"BLD",3012,"KRN",9.8,"NM",2,0)
DG902PST^^0^B25954935
"BLD",3012,"KRN",9.8,"NM",3,0)
VAFCTR^^0^B4435550
"BLD",3012,"KRN",9.8,"NM",4,0)
VAFCPDAT^^0^B52424341
"BLD",3012,"KRN",9.8,"NM",5,0)
VAFCQRY^^0^B23196961
"BLD",3012,"KRN",9.8,"NM",6,0)
VAFCSB^^0^B32788021
"BLD",3012,"KRN",9.8,"NM","B","DG902PST",2)

"BLD",3012,"KRN",9.8,"NM","B","VAFCHIS",1)

"BLD",3012,"KRN",9.8,"NM","B","VAFCPDAT",4)

"BLD",3012,"KRN",9.8,"NM","B","VAFCQRY",5)

"BLD",3012,"KRN",9.8,"NM","B","VAFCSB",6)

"BLD",3012,"KRN",9.8,"NM","B","VAFCTR",3)

"BLD",3012,"KRN",19,0)
19
"BLD",3012,"KRN",19,"NM",0)
^9.68A^^0
"BLD",3012,"KRN",19.1,0)
19.1
"BLD",3012,"KRN",101,0)
101
"BLD",3012,"KRN",409.61,0)
409.61
"BLD",3012,"KRN",771,0)
771
"BLD",3012,"KRN",779.2,0)
779.2
"BLD",3012,"KRN",870,0)
870
"BLD",3012,"KRN",8989.51,0)
8989.51
"BLD",3012,"KRN",8989.52,0)
8989.52
"BLD",3012,"KRN",8994,0)
8994
"BLD",3012,"KRN","B",.4,.4)

"BLD",3012,"KRN","B",.401,.401)

"BLD",3012,"KRN","B",.402,.402)

"BLD",3012,"KRN","B",.403,.403)

"BLD",3012,"KRN","B",.5,.5)

"BLD",3012,"KRN","B",.84,.84)

"BLD",3012,"KRN","B",3.6,3.6)

"BLD",3012,"KRN","B",3.8,3.8)

"BLD",3012,"KRN","B",9.2,9.2)

"BLD",3012,"KRN","B",9.8,9.8)

"BLD",3012,"KRN","B",19,19)

"BLD",3012,"KRN","B",19.1,19.1)

"BLD",3012,"KRN","B",101,101)

"BLD",3012,"KRN","B",409.61,409.61)

"BLD",3012,"KRN","B",771,771)

"BLD",3012,"KRN","B",779.2,779.2)

"BLD",3012,"KRN","B",870,870)

"BLD",3012,"KRN","B",8989.51,8989.51)

"BLD",3012,"KRN","B",8989.52,8989.52)

"BLD",3012,"KRN","B",8994,8994)

"BLD",3012,"QDEF")
^^^^^^^^^^YES
"BLD",3012,"QUES",0)
^9.62^^
"BLD",3012,"REQB",0)
^9.611^3^3
"BLD",3012,"REQB",1,0)
DG*5.3*711^2
"BLD",3012,"REQB",2,0)
DG*5.3*863^2
"BLD",3012,"REQB",3,0)
DG*5.3*876^2
"BLD",3012,"REQB","B","DG*5.3*711",1)

"BLD",3012,"REQB","B","DG*5.3*863",2)

"BLD",3012,"REQB","B","DG*5.3*876",3)

"FIA",2)
PATIENT
"FIA",2,0)
^DPT(
"FIA",2,0,0)
2I
"FIA",2,0,1)
y^y^p^^^^n^^n
"FIA",2,0,10)

"FIA",2,0,11)

"FIA",2,0,"RLRO")

"FIA",2,0,"VR")
5.3^DG
"FIA",2,2)
1
"FIA",2,2,.354)

"FIA",2,2,.355)

"FIA",2,2,991.1)

"FIA",2,2,991.91)

"FIA",2,2.0991)
0
"INIT")
DG902PST
"MBREQ")
0
"PKG",5,-1)
1^1
"PKG",5,0)
REGISTRATION^DG^PATIENT REGISTRATION, ADMISSION, DISCHARGE, EMBOSSER 
"PKG",5,20,0)
^9.402P^^
"PKG",5,22,0)
^9.49I^1^1
"PKG",5,22,1,0)
5.3^2930813^2970721^12541
"PKG",5,22,1,"PAH",1,0)
902^3141222
"PKG",5,22,1,"PAH",1,1,0)
^^3^3^3141222
"PKG",5,22,1,"PAH",1,1,1,0)
MASTER VETERAN INDEX VISTA ISSUES - ITERATION 13
"PKG",5,22,1,"PAH",1,1,2,0)
Refer to patch DG*5.3*902 in the FORUM Patch Module for a complete
"PKG",5,22,1,"PAH",1,1,3,0)
description.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
6
"RTN","DG902PST")
0^2^B25954935^n/a
"RTN","DG902PST",1,0)
DG902PST ;BIR/JFW - PATCH DG*5.3*902 POST INSTALLATION ROUTINE ; 10/20/14 4:45pm
"RTN","DG902PST",2,0)
 ;;5.3;Registration;**902**;Aug 13, 1993;Build 2
"RTN","DG902PST",3,0)
 ;
"RTN","DG902PST",4,0)
 ; IA #4397 (Supported) for call to TURNON^DIAUTL
"RTN","DG902PST",5,0)
POST ;Post init
"RTN","DG902PST",6,0)
 N DGI,DGFLDS
"RTN","DG902PST",7,0)
 ;  Modifying the following field(s) in the PATIENT File #2:
"RTN","DG902PST",8,0)
 ;     - .352 DEATH ENTERED BY
"RTN","DG902PST",9,0)
 ;     - .353 SOURCE OF NOTIFICATION
"RTN","DG902PST",10,0)
 ;     - .354 DATE OF DEATH LAST UPDATED
"RTN","DG902PST",11,0)
 ;     - .355 LAST EDITED BY
"RTN","DG902PST",12,0)
 S DGFLDS=".352,.353,.354,.355"
"RTN","DG902PST",13,0)
 ;File cross references for the field(s) (TRIGGERS)
"RTN","DG902PST",14,0)
 F DGI=1:1:$L(DGFLDS,",")  D XR(2,$P(DGFLDS,",",DGI))
"RTN","DG902PST",15,0)
 ;Re-Compile Templates for field(s) (if applicable)
"RTN","DG902PST",16,0)
 D TEMPL(2,DGFLDS,"PATIENT")
"RTN","DG902PST",17,0)
 ;Turning on AUDITING for field(s)
"RTN","DG902PST",18,0)
 F DGI=1:1:$L(DGFLDS,",")  D AUDIT(2,$P(DGFLDS,",",DGI),"Patient")
"RTN","DG902PST",19,0)
 Q
"RTN","DG902PST",20,0)
 ;
"RTN","DG902PST",21,0)
XR(DGFILE,DGFLD) ;File index type cross references
"RTN","DG902PST",22,0)
 ;
"RTN","DG902PST",23,0)
 N DGFDA,DGIEN,DGWP,DGERR,DGXR,DGVAL,DGOUT,DIERR
"RTN","DG902PST",24,0)
 ;Set up the cross-reference
"RTN","DG902PST",25,0)
 I '$D(DGXR) S DGXR=$S(DGFLD[".":"AVAFC"_$P(DGFLD,".",2),1:"AVAFC"_DGFLD)
"RTN","DG902PST",26,0)
 ;Check for existing cross-reference
"RTN","DG902PST",27,0)
 S DGVAL(1)=DGFILE,DGVAL(2)=DGXR
"RTN","DG902PST",28,0)
 D FIND^DIC(.11,"","@;IXIE","KP",.DGVAL,"","","","","DGOUT")
"RTN","DG902PST",29,0)
 I $D(DGOUT("DILIST",1)) D  Q
"RTN","DG902PST",30,0)
 .D MES^XPDUTL("   >> Cross reference "_DGXR_" already exists, nothing filed.")
"RTN","DG902PST",31,0)
 .Q
"RTN","DG902PST",32,0)
 ;Create filer array
"RTN","DG902PST",33,0)
 S DGFDA(.11,"+1,",.01)=DGFILE                      ;FILE
"RTN","DG902PST",34,0)
 S DGFDA(.11,"+1,",.02)=DGXR                        ;NAME
"RTN","DG902PST",35,0)
 S DGFDA(.11,"+1,",.11)="This x-ref calls the DG FIELD MONITOR event point."  ;SHORT DESCRIPTION
"RTN","DG902PST",36,0)
 S DGFDA(.11,"+1,",.2)="MU"                         ;TYPE
"RTN","DG902PST",37,0)
 S DGFDA(.11,"+1,",.4)="F"                          ;EXECUTION
"RTN","DG902PST",38,0)
 S DGFDA(.11,"+1,",.41)="I"                         ;ACTIVITY
"RTN","DG902PST",39,0)
 S DGFDA(.11,"+1,",.5)="I"                          ;ROOT TYPE
"RTN","DG902PST",40,0)
 S DGFDA(.11,"+1,",.51)=DGFILE                      ;ROOT FILE
"RTN","DG902PST",41,0)
 S DGFDA(.11,"+1,",.42)="A"                         ;USE
"RTN","DG902PST",42,0)
 S DGFDA(.11,"+1,",1.1)="D FC^DGFCPROT(.DA,"_DGFILE_","_DGFLD_",""SET"",$H,$G(DUZ),.X,.X1,.X2,$G(XQY0)) Q"  ;SET LOGIC
"RTN","DG902PST",43,0)
 S DGFDA(.11,"+1,",2.1)="D FC^DGFCPROT(.DA,"_DGFILE_","_DGFLD_",""KILL"",$H,$G(DUZ),.X,.X1,.X2,$G(XQY0)) Q"  ;KILL LOGIC
"RTN","DG902PST",44,0)
 ;CROSS REFERENCE VALUES
"RTN","DG902PST",45,0)
 S DGFDA(.114,"+2,+1,",.01)=1                       ;ORDER NUMBER
"RTN","DG902PST",46,0)
 S DGFDA(.114,"+2,+1,",1)="F"                       ;TYPE OF VALUE
"RTN","DG902PST",47,0)
 S DGFDA(.114,"+2,+1,",2)=DGFILE                    ;FILE NUMBER
"RTN","DG902PST",48,0)
 S DGFDA(.114,"+2,+1,",3)=DGFLD                     ;FIELD NUMBER
"RTN","DG902PST",49,0)
 S DGFDA(.114,"+2,+1,",7)="F"                       ;COLLATION
"RTN","DG902PST",50,0)
 ;DESCRIPTION
"RTN","DG902PST",51,0)
 S DGWP(1)="This cross-reference activates the DG FIELD MONITOR event point."
"RTN","DG902PST",52,0)
 S DGWP(2)="Applications that wish to monitor edit activity related to this field may"
"RTN","DG902PST",53,0)
 S DGWP(3)="subscribe to that event point and take action as indicated by the changes"
"RTN","DG902PST",54,0)
 S DGWP(4)="that occur.  Refer to the DG FIELD MONITOR protocol for a description of"
"RTN","DG902PST",55,0)
 S DGWP(5)="the information available at the time of the event."
"RTN","DG902PST",56,0)
 ;File INDEX record
"RTN","DG902PST",57,0)
 D UPDATE^DIE("","DGFDA","DGIEN","DGERR")
"RTN","DG902PST",58,0)
 I $D(DIERR) D  Q
"RTN","DG902PST",59,0)
 .N DGI S DGI=""
"RTN","DG902PST",60,0)
 .D BMES^XPDUTL("   >> A problem has occurred during the filing of x-ref "_DGXR_"!")
"RTN","DG902PST",61,0)
 .D MES^XPDUTL("      Please contact Customer Support.")
"RTN","DG902PST",62,0)
 .F  S DGI=$O(DGERR("DIERR",1,"TEXT",DGI)) Q:DGI=""  D
"RTN","DG902PST",63,0)
 ..D MES^XPDUTL(DGERR("DIERR",1,"TEXT",DGI))
"RTN","DG902PST",64,0)
 ..Q
"RTN","DG902PST",65,0)
 .Q
"RTN","DG902PST",66,0)
 D MES^XPDUTL("   >> "_DGXR_" cross-reference filed.")
"RTN","DG902PST",67,0)
 ;File DESCRIPTION field
"RTN","DG902PST",68,0)
 D WP^DIE(.11,DGIEN(1)_",",.1,"","DGWP")
"RTN","DG902PST",69,0)
 Q
"RTN","DG902PST",70,0)
 ;
"RTN","DG902PST",71,0)
TEMPL(DGFILE,DGFLDS,DGFNAME) ;Determine templates on the file to be compiled.
"RTN","DG902PST",72,0)
 N DGI
"RTN","DG902PST",73,0)
 D BMES^XPDUTL("Beginning to compile templates on the "_DGFNAME_" (#"_DGFILE_") file.")
"RTN","DG902PST",74,0)
 ;
"RTN","DG902PST",75,0)
 F DGI=1:1:$L(DGFLDS,",")  D LOOP($P(DGFLDS,",",DGI),DGFILE)
"RTN","DG902PST",76,0)
 W !!
"RTN","DG902PST",77,0)
 S (X,Y)=""
"RTN","DG902PST",78,0)
 D:$D(CFIELD)
"RTN","DG902PST",79,0)
 .D BMES^XPDUTL("The following routine namespace was compiled:")
"RTN","DG902PST",80,0)
 .F  S X=$O(CFIELD(X)) Q:X=""  S Y=$G(Y)+1 S PRINT(Y)=" "_X_"*"
"RTN","DG902PST",81,0)
 .D MES^XPDUTL(.PRINT)
"RTN","DG902PST",82,0)
 D:'$D(CFIELD)
"RTN","DG902PST",83,0)
 .D BMES^XPDUTL("No routine namespaces were needed to be compiled.")
"RTN","DG902PST",84,0)
 K X,Y,PRINT,CFIELD
"RTN","DG902PST",85,0)
 Q
"RTN","DG902PST",86,0)
LOOP(FIELD,FILE) ;Compile templates.
"RTN","DG902PST",87,0)
 N GLOBAL,TEMPLATP,TEMPLATN,X,Y,DMAX
"RTN","DG902PST",88,0)
 F GLOBAL="^DIE","^DIPT" DO
"RTN","DG902PST",89,0)
 .I $D(@GLOBAL@("AF",FILE,FIELD)) D
"RTN","DG902PST",90,0)
 ..S TEMPLATP=0
"RTN","DG902PST",91,0)
 ..F  S TEMPLATP=$O(@GLOBAL@("AF",FILE,FIELD,TEMPLATP)) Q:'TEMPLATP  DO
"RTN","DG902PST",92,0)
 ...S TEMPLATN=$P($G(@GLOBAL@(TEMPLATP,0)),"^",1)
"RTN","DG902PST",93,0)
 ...I TEMPLATN="" D BMES^XPDUTL("Could not compile template "_TEMPLATN_$C(13,10)_"Please review!") Q
"RTN","DG902PST",94,0)
 ...S X=$P($G(@GLOBAL@(TEMPLATP,"ROUOLD")),"^")
"RTN","DG902PST",95,0)
 ...I X=""&($D(@GLOBAL@(TEMPLATP,"ROU"))'=0) D BMES^XPDUTL("Could not find routine for template "_TEMPLATN_$C(13,10)_"Please review!") Q
"RTN","DG902PST",96,0)
 ...I X=""&($D(@GLOBAL@(TEMPLATP,"ROU"))=0) Q
"RTN","DG902PST",97,0)
 ...I $D(CFIELD(X)) Q  ;already compiled
"RTN","DG902PST",98,0)
 ...S CFIELD(X)="" ;  remember the template was compiled
"RTN","DG902PST",99,0)
 ...S Y=TEMPLATP ;  set up the call for FileMan
"RTN","DG902PST",100,0)
 ...S DMAX=$$ROUSIZE^DILF
"RTN","DG902PST",101,0)
 ...I GLOBAL="^DIE" D BMES^XPDUTL(" "),BMES^XPDUTL("   Compiling Input Templates") D EN^DIEZ Q
"RTN","DG902PST",102,0)
 ...I GLOBAL="^DIPT" D BMES^XPDUTL(" "),BMES^XPDUTL("   Compiling Print Templates") D EN^DIPZ Q
"RTN","DG902PST",103,0)
 Q
"RTN","DG902PST",104,0)
 ;
"RTN","DG902PST",105,0)
AUDIT(DGFILE,DGFLD,DGFNAME) ;Turn on Auditing for Field in File
"RTN","DG902PST",106,0)
 D TURNON^DIAUTL(DGFILE,DGFLD) W !,"Adding AUDIT to file "_DGFILE_" "_DGFNAME_", field #"_DGFLD
"RTN","DG902PST",107,0)
 Q
"RTN","VAFCHIS")
0^1^B14349143^B12925674
"RTN","VAFCHIS",1,0)
VAFCHIS ;SF/CMC-TESTING CROSS REFERENCE ;11/20/97
"RTN","VAFCHIS",2,0)
 ;;5.3;Registration;**149,255,307,711,902**;Aug 13, 1993;Build 2
"RTN","VAFCHIS",3,0)
 ;
"RTN","VAFCHIS",4,0)
 ; Integration Agreements Utilized:
"RTN","VAFCHIS",5,0)
 ;    CHECKDG^MPIFSPC - #3158
"RTN","VAFCHIS",6,0)
 ;
"RTN","VAFCHIS",7,0)
ICN(OLD,ENT) ;
"RTN","VAFCHIS",8,0)
 ;
"RTN","VAFCHIS",9,0)
 I '$D(OLD)!('$D(ENT)) Q
"RTN","VAFCHIS",10,0)
 N NEWICN,DIC,Y
"RTN","VAFCHIS",11,0)
 ;checking that CIRN PD/MPI is installed
"RTN","VAFCHIS",12,0)
 N X S X="MPIF001" X ^%ZOSF("TEST") Q:'$T
"RTN","VAFCHIS",13,0)
 N X S X="MPIFAPI" X ^%ZOSF("TEST") Q:'$T
"RTN","VAFCHIS",14,0)
 N X S X="MPIFMER" X ^%ZOSF("TEST") Q:'$T
"RTN","VAFCHIS",15,0)
 S NEWICN=+$$GETICN^MPIF001(ENT)
"RTN","VAFCHIS",16,0)
 Q:OLD=NEWICN!(OLD="")
"RTN","VAFCHIS",17,0)
 ; ^ UPDATE ICN WITH SAME ICN DON'T PUT IT IN HISTORY
"RTN","VAFCHIS",18,0)
 ;
"RTN","VAFCHIS",19,0)
 S OLDDA=DA,OLDX=OLD
"RTN","VAFCHIS",20,0)
 N DA,CKOLD
"RTN","VAFCHIS",21,0)
 ;
"RTN","VAFCHIS",22,0)
 D NOW^%DTC
"RTN","VAFCHIS",23,0)
 S HAP=%
"RTN","VAFCHIS",24,0)
 ;S NODE=$$MPINODE^MPIFAPI(ENT) **711
"RTN","VAFCHIS",25,0)
 S X=OLD
"RTN","VAFCHIS",26,0)
 S DIC="^DPT("_ENT_",""MPIFHIS"",",DIC(0)="L"
"RTN","VAFCHIS",27,0)
 I '$D(^DPT(ENT,"MPIFHIS",0)) S ^DPT(ENT,"MPIFHIS",0)="^2.0992A^0^0"
"RTN","VAFCHIS",28,0)
 S DIC("P")=$P(^DPT(ENT,"MPIFHIS",0),"^",2)
"RTN","VAFCHIS",29,0)
 S DA(1)=ENT
"RTN","VAFCHIS",30,0)
 D ^DIC
"RTN","VAFCHIS",31,0)
 ;**711 change setting of checksum and CMOR ensure correct data stored
"RTN","VAFCHIS",32,0)
 ;**902 save correct old checksum to store in FULL ICN history also
"RTN","VAFCHIS",33,0)
 ;S $P(^DPT(ENT,"MPIFHIS",+Y,0),"^",2)=$$CHECKDG^MPIFSPC(OLD)
"RTN","VAFCHIS",34,0)
 S CKOLD=$$CHECKDG^MPIFSPC(OLD)
"RTN","VAFCHIS",35,0)
 S $P(^DPT(ENT,"MPIFHIS",+Y,0),"^",2)=CKOLD
"RTN","VAFCHIS",36,0)
 S $P(^DPT(ENT,"MPIFHIS",+Y,0),"^",3)=$P($G(^DPT(ENT,"MPI")),"^",3)
"RTN","VAFCHIS",37,0)
 S $P(^DPT(ENT,"MPIFHIS",+Y,0),"^",4)=HAP
"RTN","VAFCHIS",38,0)
 ;
"RTN","VAFCHIS",39,0)
 ;**902 set FULL ICN history
"RTN","VAFCHIS",40,0)
 K DA,DIC
"RTN","VAFCHIS",41,0)
 S X=OLD_"V"_CKOLD
"RTN","VAFCHIS",42,0)
 S DIC="^DPT("_ENT_",""MPIFICNHIS"",",DIC(0)="L"
"RTN","VAFCHIS",43,0)
 S DA(1)=ENT
"RTN","VAFCHIS",44,0)
 D ^DIC
"RTN","VAFCHIS",45,0)
 ;
"RTN","VAFCHIS",46,0)
 S ^DPT("AICN",OLD,ENT)=""
"RTN","VAFCHIS",47,0)
 K NODE,%,HAP
"RTN","VAFCHIS",48,0)
 S X=OLDX,DA=OLDDA
"RTN","VAFCHIS",49,0)
 K OLDX,OLDDA
"RTN","VAFCHIS",50,0)
 ;**REPLACED BY LINK MSGS MPIF*1.0*21 changes MER^MPIFMER call to quit
"RTN","VAFCHIS",51,0)
 ;Send "Merge" (change) ICN message to all subscribers
"RTN","VAFCHIS",52,0)
 ;N ERROR,FLG
"RTN","VAFCHIS",53,0)
 ;S FLG=1
"RTN","VAFCHIS",54,0)
 ;I $P($$GETICN^MPIF001(DA),"^")'="" D MER^MPIFMER(DA,X,.ERROR,FLG)
"RTN","VAFCHIS",55,0)
 Q
"RTN","VAFCHIS",56,0)
CMOR(OLD,RGDFN) ;ALS 6/23/00
"RTN","VAFCHIS",57,0)
 ; Create CMOR History node
"RTN","VAFCHIS",58,0)
 I '$D(OLD)!('$D(RGDFN)) Q
"RTN","VAFCHIS",59,0)
 N NEWCMOR
"RTN","VAFCHIS",60,0)
 S NEWCMOR=$$GETVCCI^MPIF001(RGDFN)
"RTN","VAFCHIS",61,0)
 Q:OLD=NEWCMOR!(OLD="")
"RTN","VAFCHIS",62,0)
 ;
"RTN","VAFCHIS",63,0)
 D NOW^%DTC
"RTN","VAFCHIS",64,0)
 S CHGDT=%
"RTN","VAFCHIS",65,0)
 S NODE=$$MPINODE^MPIFAPI(RGDFN)
"RTN","VAFCHIS",66,0)
 S X=OLD
"RTN","VAFCHIS",67,0)
 S DIC="^DPT("_RGDFN_",""MPICMOR"",",DIC(0)="L"
"RTN","VAFCHIS",68,0)
 I '$D(^DPT(RGDFN,"MPICMOR",0)) S ^DPT(RGDFN,"MPICMOR",0)="^2.0993A^0^0"
"RTN","VAFCHIS",69,0)
 S DIC("P")=$P(^DPT(RGDFN,"MPICMOR",0),"^",2)
"RTN","VAFCHIS",70,0)
 S DA(1)=RGDFN
"RTN","VAFCHIS",71,0)
 D ^DIC
"RTN","VAFCHIS",72,0)
 ; add CMOR activity score and calculation date to node
"RTN","VAFCHIS",73,0)
 S $P(^DPT(RGDFN,"MPICMOR",+Y,0),"^",2)=$P(NODE,"^",6)
"RTN","VAFCHIS",74,0)
 S $P(^DPT(RGDFN,"MPICMOR",+Y,0),"^",3)=$P(NODE,"^",7)
"RTN","VAFCHIS",75,0)
 S $P(^DPT(RGDFN,"MPICMOR",+Y,0),"^",4)=CHGDT
"RTN","VAFCHIS",76,0)
 ;
"RTN","VAFCHIS",77,0)
 K NODE,%,Y,DIC,CHGDT
"RTN","VAFCHIS",78,0)
 Q
"RTN","VAFCHIS",79,0)
GETICNH(MDFN,ARRAY) ; **711 added API
"RTN","VAFCHIS",80,0)
 ; Returns ICN History in ARRAY 
"RTN","VAFCHIS",81,0)
 ;Input:  MDFN is the IEN in file 2
"RTN","VAFCHIS",82,0)
 ;ARRAY is passed by reference and will return from ICN History nodes: ICN 'V' ICN Checksum ^ deprecated date
"RTN","VAFCHIS",83,0)
 ;If there is a problem ARRAY will equal -1^error message
"RTN","VAFCHIS",84,0)
 K ARRAY
"RTN","VAFCHIS",85,0)
 S ARRAY=1
"RTN","VAFCHIS",86,0)
 I MDFN=""!(MDFN<1) S ARRAY="-1^No such DFN" Q
"RTN","VAFCHIS",87,0)
 I '$D(^DPT(MDFN)) S ARRAY="-1^No such DFN" Q
"RTN","VAFCHIS",88,0)
 I '$D(^DPT(MDFN,"MPIFHIS")) S ARRAY="-1^No ICN History" Q
"RTN","VAFCHIS",89,0)
 N CHK,HISTDT,HIST,CNT,VAFCHMN S HIST=0,CNT=1
"RTN","VAFCHIS",90,0)
 F  S HIST=$O(^DPT(MDFN,"MPIFHIS",HIST)) Q:'HIST  D
"RTN","VAFCHIS",91,0)
 .S VAFCHMN=$G(^DPT(MDFN,"MPIFHIS",HIST,0))
"RTN","VAFCHIS",92,0)
 .S HISTDT=$P(VAFCHMN,"^",4) D
"RTN","VAFCHIS",93,0)
 ..;due to a timing issue if checksum and D/T of deprication of ICN is not present hang two seconds and try again if still not able to get ICN set D/T to DT
"RTN","VAFCHIS",94,0)
 ..I $G(HISTDT)="" H 2 S VAFCHMN=^DPT(MDFN,"MPIFHIS",HIST,0) S HISTDT=$P(VAFCHMN,"^",4) I HISTDT="" S $P(VAFCHMN,"^",4)=DT
"RTN","VAFCHIS",95,0)
 .;verify checksum is correct, if not update it and return the updated value
"RTN","VAFCHIS",96,0)
 .S CHK=$$CHECKDG^MPIFSPC($P(VAFCHMN,"^"))
"RTN","VAFCHIS",97,0)
 .I CHK'=$P(VAFCHMN,"^",2) S $P(^DPT(MDFN,"MPIFHIS",HIST,0),"^",2)=CHK,$P(VAFCHMN,"^",2)=CHK
"RTN","VAFCHIS",98,0)
 .S ARRAY(CNT)=$P(VAFCHMN,"^")_"V"_$P(VAFCHMN,"^",2)_"^"_HISTDT,CNT=CNT+1
"RTN","VAFCHIS",99,0)
 I $O(ARRAY(0))="" S ARRAY="-1^No ICN History"
"RTN","VAFCHIS",100,0)
 Q
"RTN","VAFCPDAT")
0^4^B52424341^B52025374
"RTN","VAFCPDAT",1,0)
VAFCPDAT ;BIR/CML/ALS-DISPLAY MPI/PD INFORMATION FOR SELECTED PATIENT ;10/24/02  13:13
"RTN","VAFCPDAT",2,0)
 ;;5.3;Registration;**333,414,474,505,707,712,837,863,876,902**;Aug 13, 1993;Build 2
"RTN","VAFCPDAT",3,0)
 ;Registration has IA #3299 for MPI/PD to call START^VAFCPDAT
"RTN","VAFCPDAT",4,0)
 ;
"RTN","VAFCPDAT",5,0)
 ;variable DFN is not NEWed or KILLed in this routine as that variable is passed in
"RTN","VAFCPDAT",6,0)
 ;
"RTN","VAFCPDAT",7,0)
MAIN ; Entry point with device call
"RTN","VAFCPDAT",8,0)
 S NOTRPC=1
"RTN","VAFCPDAT",9,0)
 K ZTSAVE S ZTSAVE("DFN")=""
"RTN","VAFCPDAT",10,0)
 D EN^XUTMDEVQ("START^VAFCPDAT","Print MPI/PD Patient Data",.ZTSAVE)
"RTN","VAFCPDAT",11,0)
 K NOTRPC
"RTN","VAFCPDAT",12,0)
 Q
"RTN","VAFCPDAT",13,0)
 ;
"RTN","VAFCPDAT",14,0)
START ;Entry point without device call, used for RPC calls
"RTN","VAFCPDAT",15,0)
 N X S X="MPIF001" X ^%ZOSF("TEST") I '$T W !,"MPI not installed." G QUIT  ;**863 - MVI_2351 (ptd)
"RTN","VAFCPDAT",16,0)
 S $P(LN,"=",80)="",$P(LN2,"=",60)="",QFLG=0
"RTN","VAFCPDAT",17,0)
 D NOW^%DTC S HDT=$$FMTE^XLFDT($E(%,1,12))
"RTN","VAFCPDAT",18,0)
 S SITE=$$SITE^VASITE(),SITENAM=$P(SITE,"^",2),SITENUM=$P(SITE,"^",3),SITEIEN=$P(SITE,"^")
"RTN","VAFCPDAT",19,0)
 I +DFN<0 D  Q
"RTN","VAFCPDAT",20,0)
 .I $D(NOTRPC) W @IOF,!," "
"RTN","VAFCPDAT",21,0)
 .W !,"ICN ",$G(ICN)," does not exist at ",SITENAM,"."
"RTN","VAFCPDAT",22,0)
 .W !,"Search date: ",HDT,!,LN
"RTN","VAFCPDAT",23,0)
 S DIC=2,DR=".01;.02;.03;.09;.111;.112;.113;.114;.115;.1112;.131;.313;.351;994;.0907;.0906;.121;.1171;.1172;.1173;.024",DA=DFN,DIQ(0)="EI",DIQ="DNODE"  ;**707,712,863,876
"RTN","VAFCPDAT",24,0)
 N NAME,SSN,DOB,SEX,CLAIM,DOD,ICN,STR1,STR2,STR3,CTY,ST,ZIP,PHN,MBI,SSNVER,PREAS,BAI,TIN,FIN,COUNTRY,CCODE,CNAME,PROVINCE,POSTCODE,SIGEN ;**707,712,837,863,876
"RTN","VAFCPDAT",25,0)
 D EN^DIQ1 K DIC,DR,DA,DIQ
"RTN","VAFCPDAT",26,0)
 S NAME=$G(DNODE(2,DFN,.01,"E")),SSN=$G(DNODE(2,DFN,.09,"E"))
"RTN","VAFCPDAT",27,0)
 S DOB=$$FMTE^XLFDT($G(DNODE(2,DFN,.03,"I")))
"RTN","VAFCPDAT",28,0)
 S MBI=$G(DNODE(2,DFN,994,"I")),MBI=$S(MBI="Y":"YES",MBI="N":"NO",1:"NULL")  ;**707
"RTN","VAFCPDAT",29,0)
 S SEX=$G(DNODE(2,DFN,.02,"E")),SIGEN=$G(DNODE(2,DFN,.024,"E")),DOD=$G(DNODE(2,DFN,.351,"E"))  ;**876 - MVI_3432 (cml)
"RTN","VAFCPDAT",30,0)
 S CLAIM=$G(DNODE(2,DFN,.313,"E")) S:CLAIM="" CLAIM="None"
"RTN","VAFCPDAT",31,0)
 S BAI=$G(DNODE(2,DFN,.121,"E"))  ;**712
"RTN","VAFCPDAT",32,0)
 S STR1=$G(DNODE(2,DFN,.111,"E")),STR2=$G(DNODE(2,DFN,.112,"E")),STR3=$G(DNODE(2,DFN,.113,"E"))
"RTN","VAFCPDAT",33,0)
 S CTY=$G(DNODE(2,DFN,.114,"E")),ST=$G(DNODE(2,DFN,.115,"E")),ZIP=$G(DNODE(2,DFN,.1112,"E"))
"RTN","VAFCPDAT",34,0)
 S COUNTRY=$G(DNODE(2,DFN,.1173,"I")),(CCODE,CNAME)="" I COUNTRY]"" S CCODE=$$GET1^DIQ(779.004,+COUNTRY_",",.01),CNAME=$$GET1^DIQ(779.004,+COUNTRY_",",1.3)  ;**863 - MVI_1902 (ptd)
"RTN","VAFCPDAT",35,0)
 S PROVINCE=$G(DNODE(2,DFN,.1171,"E")),POSTCODE=$G(DNODE(2,DFN,.1172,"E"))
"RTN","VAFCPDAT",36,0)
 S PHN=$G(DNODE(2,DFN,.131,"E"))
"RTN","VAFCPDAT",37,0)
 S SSNVER=$G(DNODE(2,DFN,.0907,"E"))  ;**707
"RTN","VAFCPDAT",38,0)
 S PREAS=$G(DNODE(2,DFN,.0906,"E"))  ;**707
"RTN","VAFCPDAT",39,0)
 S MNODE=$$MPINODE^MPIFAPI(DFN) I +MNODE=-1 S MNODE="^^^^^^^^"
"RTN","VAFCPDAT",40,0)
 S (ICN,SCN,SCORE,SCRDT,DIFF,TIN,FIN)=""   ;**837, MVI_883
"RTN","VAFCPDAT",41,0)
 S ICN=$$GETICN^MPIF001(DFN) S:(+ICN=-1) ICN="None" ;**863 - MVI_2351 (ptd)
"RTN","VAFCPDAT",42,0)
 ;S CMOR=$$GET1^DIQ(4,+$P($G(MNODE),"^",3)_",",.01) S:CMOR="" CMOR="None"    ;removed for **837, MVI_918
"RTN","VAFCPDAT",43,0)
 I $E(ICN,1,3)=SITENUM S GOT=0 D
"RTN","VAFCPDAT",44,0)
 . I $P($G(MNODE),"^",4)=""!('$D(^DPT("AICNL",1,DFN))) S ICN=ICN_"**"
"RTN","VAFCPDAT",45,0)
 S TIN=$P($G(MNODE),"^",8),FIN=$P($G(MNODE),"^",9)   ;**837, MVI_883
"RTN","VAFCPDAT",46,0)
 ;
"RTN","VAFCPDAT",47,0)
 I $D(NOTRPC) W @IOF,!
"RTN","VAFCPDAT",48,0)
 W !,"MPI/PD Data for: ",NAME,"  (DFN #",DFN,")"
"RTN","VAFCPDAT",49,0)
 ; check for patient sensitivity and user security
"RTN","VAFCPDAT",50,0)
 N RESULT,RGSENS,SENSTV,DA,DR,DIC,DIQ,VAFCSEN
"RTN","VAFCPDAT",51,0)
 D PTSEC^DGSEC4(.RESULT,DFN,0,"MPI/PD Patient Inquiry^MPI/PD Patient Inquiry")
"RTN","VAFCPDAT",52,0)
 I RESULT(1)=-1 W !!,"Access denied: Required parameters not defined" G QUIT
"RTN","VAFCPDAT",53,0)
 I RESULT(1)>0 W ?50,"***PATIENT MARKED SENSITIVE***"
"RTN","VAFCPDAT",54,0)
 I RESULT(1)=3 W !!,"Access not allowed on your own PATIENT (#2) file entry" G QUIT
"RTN","VAFCPDAT",55,0)
 I RESULT(1)=4 W !!,"Access denied: Your SSN is not defined" G QUIT
"RTN","VAFCPDAT",56,0)
 I RESULT(1)<3 D
"RTN","VAFCPDAT",57,0)
 . I RESULT(1)=1 D NOTICE^DGSEC4(.VAFCSEN,DFN,"RPC - VAFC REMOTE PDAT FROM THE MPI^MPI/PD Patient Inquiry (Remote)",2) ;IA #3027
"RTN","VAFCPDAT",58,0)
 . I RESULT(1)=2 D NOTICE^DGSEC4(.VAFCSEN,DFN,"RPC - VAFC REMOTE PDAT FROM THE MPI^MPI/PD Patient Inquiry (Remote)",3) ;IA #3027
"RTN","VAFCPDAT",59,0)
 W !,"Printed ",HDT," at ",SITENAM,!,LN
"RTN","VAFCPDAT",60,0)
 S $Y=$Y+1
"RTN","VAFCPDAT",61,0)
 ;next 7 lines modified for **707
"RTN","VAFCPDAT",62,0)
 W !,"ICN    : ",ICN  ;CMOR removed  **837, MVI_918
"RTN","VAFCPDAT",63,0)
 W !,"SSN    : ",SSN
"RTN","VAFCPDAT",64,0)
 I SSNVER]"" W !?9,"SSN Verification Status: ",SSNVER
"RTN","VAFCPDAT",65,0)
 I SSNVER="",PREAS]"" W !?9,"Pseudo SSN Reason: ",PREAS
"RTN","VAFCPDAT",66,0)
 I SSNVER]"",PREAS]"" W !?9,"Pseudo SSN Reason      : ",PREAS
"RTN","VAFCPDAT",67,0)
 W !,"Sex    : ",SEX
"RTN","VAFCPDAT",68,0)
 W !,"Claim #: ",CLAIM
"RTN","VAFCPDAT",69,0)
 W !,"Date of Birth: ",DOB
"RTN","VAFCPDAT",70,0)
 I DOD]"" W !,"Date of Death: ",DOD
"RTN","VAFCPDAT",71,0)
 I MBI]"" W !,"Multiple Birth Indicator: ",MBI  ;**707
"RTN","VAFCPDAT",72,0)
 I TIN]"" W !,"DoD Temporary ID Number : ",TIN  ;**837, MVI_883
"RTN","VAFCPDAT",73,0)
 I FIN]"" W !,"DoD Foreign ID Number   : ",FIN  ;**837, MVI_883
"RTN","VAFCPDAT",74,0)
 W !,"Address:" I BAI'="" W " (Bad Address Indicator: ",BAI,")"
"RTN","VAFCPDAT",75,0)
 I STR1'="" W !?9,STR1
"RTN","VAFCPDAT",76,0)
 I STR2'="" W !?9,STR2
"RTN","VAFCPDAT",77,0)
 I STR3'="" W !?9,STR3
"RTN","VAFCPDAT",78,0)
 I COUNTRY=""!(CCODE="USA") D   ;USA Address  **863 - MVI_1902 (ptd)
"RTN","VAFCPDAT",79,0)
 .I CTY]"" W !?9,$E(CTY,1,20)_", "_$G(ST)_" "_$G(ZIP)
"RTN","VAFCPDAT",80,0)
 I COUNTRY]"",CCODE'="USA" D   ;Foreign Address
"RTN","VAFCPDAT",81,0)
 .I CTY]""!(PROVINCE]"")!(POSTCODE]"") D
"RTN","VAFCPDAT",82,0)
 ..I PROVINCE]"" W !?9,CTY_", "_PROVINCE_" ("_CNAME_")  "_POSTCODE
"RTN","VAFCPDAT",83,0)
 ..I PROVINCE="" W !?9,CTY_", "_"("_CNAME_")  "_POSTCODE
"RTN","VAFCPDAT",84,0)
 I PHN'="" W !,"Phone #: ",PHN
"RTN","VAFCPDAT",85,0)
 I SIGEN]"" W !,"Self-Identified Gender Identity: ",SIGEN  ;**876 - MVI_3432 (cml)  **902 - MVI_4730 (cml)
"RTN","VAFCPDAT",86,0)
 I $G(IOSL)<30&($E(IOST,1,2)="C-") D
"RTN","VAFCPDAT",87,0)
 .I $Y>23 D
"RTN","VAFCPDAT",88,0)
 ..S DIR(0)="E" D  D ^DIR K DIR I 'Y S QFLG=1
"RTN","VAFCPDAT",89,0)
 ...S SS=22-$Y F JJ=1:1:SS W !
"RTN","VAFCPDAT",90,0)
 ..S $Y=0
"RTN","VAFCPDAT",91,0)
 I QFLG=1 G QUIT
"RTN","VAFCPDAT",92,0)
 ;
"RTN","VAFCPDAT",93,0)
TF ;List Treating Facilities for this patient
"RTN","VAFCPDAT",94,0)
 D TFHDR
"RTN","VAFCPDAT",95,0)
 K TFARR
"RTN","VAFCPDAT",96,0)
 S TF=0 F  S TF=$O(^DGCN(391.91,"APAT",DFN,TF)) Q:'TF  D
"RTN","VAFCPDAT",97,0)
 .S TFIEN=$O(^DGCN(391.91,"APAT",DFN,TF,0))
"RTN","VAFCPDAT",98,0)
 . S DIC="^DGCN(391.91,",DR=".02;.03;.07",DA=TFIEN,DIQ(0)="EI",DIQ="TFDATA"
"RTN","VAFCPDAT",99,0)
 . D EN^DIQ1 K DIC,DA,DR,DIQ
"RTN","VAFCPDAT",100,0)
 . S INST="",STATION=""
"RTN","VAFCPDAT",101,0)
 . S INST=$G(TFDATA(391.91,TFIEN,.02,"I"))
"RTN","VAFCPDAT",102,0)
 . I INST'="" D
"RTN","VAFCPDAT",103,0)
 .. S DIC=4,DR="99",DA=INST,DIQ(0)="E",DIQ="STA"
"RTN","VAFCPDAT",104,0)
 .. D EN^DIQ1 K DIC,DA,DR,DIQ
"RTN","VAFCPDAT",105,0)
 .. S STATION=$G(STA(4,INST,99,"E"))
"RTN","VAFCPDAT",106,0)
 . S TFNM=$G(TFDATA(391.91,TFIEN,.02,"E"))
"RTN","VAFCPDAT",107,0)
 . S LSTDT=$G(TFDATA(391.91,TFIEN,.03,"I")) S:LSTDT="" LSTDT="none found"
"RTN","VAFCPDAT",108,0)
 . S LSTSORT=9999999
"RTN","VAFCPDAT",109,0)
 . I +LSTDT S LSTSORT=9999999-LSTDT,LSTDT=$$FMTE^XLFDT($E(LSTDT,1,12))
"RTN","VAFCPDAT",110,0)
 . S REACODE=$G(TFDATA(391.91,TFIEN,.07,"E")) S REASON="none found"
"RTN","VAFCPDAT",111,0)
 . I REACODE'="" D
"RTN","VAFCPDAT",112,0)
 .. S DIC="^VAT(391.72,",DIC(0)="Z",X=REACODE D ^DIC K DIC,X
"RTN","VAFCPDAT",113,0)
 .. S REASON=$P($G(Y(0)),"^",4)
"RTN","VAFCPDAT",114,0)
 . S TFARR(LSTSORT,TFNM)=TFIEN_"^"_REASON_"^"_$G(STATION)_"^"_LSTDT
"RTN","VAFCPDAT",115,0)
 I '$D(TFARR) W !,"No Treating Facilities found." G SUB
"RTN","VAFCPDAT",116,0)
 S LSTSORT=0 F  S LSTSORT=$O(TFARR(LSTSORT)) Q:'LSTSORT  D  G:QFLG QUIT
"RTN","VAFCPDAT",117,0)
 .S TFNM="" F  S TFNM=$O(TFARR(LSTSORT,TFNM)) Q:TFNM=""  D  Q:QFLG
"RTN","VAFCPDAT",118,0)
 ..S REASON=$P(TFARR(LSTSORT,TFNM),"^",2)
"RTN","VAFCPDAT",119,0)
 ..S STATION=$P(TFARR(LSTSORT,TFNM),"^",3)
"RTN","VAFCPDAT",120,0)
 ..S LSTDT=$P(TFARR(LSTSORT,TFNM),"^",4)
"RTN","VAFCPDAT",121,0)
 ..I $Y+3>IOSL&($E(IOST,1,2)="C-") D  Q:QFLG
"RTN","VAFCPDAT",122,0)
 ...S LNQ=22 D SS Q:QFLG
"RTN","VAFCPDAT",123,0)
 ...W @IOF,!,"MPI/PD data for: ",NAME,"  (DFN #",DFN,")",!,LN2 D TFHDR
"RTN","VAFCPDAT",124,0)
 ..W !,$E(TFNM,1,20),?22,$G(STATION),?32,LSTDT,?54,REASON
"RTN","VAFCPDAT",125,0)
SUB ;removed listing of subscribers for RG*1.0*23
"RTN","VAFCPDAT",126,0)
HIS ;find ICN history
"RTN","VAFCPDAT",127,0)
 I '$O(^DPT(DFN,"MPIFHIS",0)) G CONT
"RTN","VAFCPDAT",128,0)
 ;
"RTN","VAFCPDAT",129,0)
 I $Y+4>IOSL&($E(IOST,1,2)="C-") D  G:QFLG QUIT
"RTN","VAFCPDAT",130,0)
 .S LNQ=22 D SS Q:QFLG
"RTN","VAFCPDAT",131,0)
 .W @IOF,!,"MPI/PD data for: ",NAME,"  (DFN #",DFN,")",!,LN2
"RTN","VAFCPDAT",132,0)
 D ICNHDR
"RTN","VAFCPDAT",133,0)
 S HIS=0 F  S HIS=$O(^DPT(DFN,"MPIFHIS",HIS)) Q:'HIS  D  G:QFLG QUIT
"RTN","VAFCPDAT",134,0)
 .S DIC=2,DR="992",DR(2.0992)=".01;1;3",DA=DFN,DA(2.0992)=HIS ;**863 - MVI_2351 (ptd)
"RTN","VAFCPDAT",135,0)
 .S DIQ(0)="E",DIQ="HISNODE"
"RTN","VAFCPDAT",136,0)
 .D EN^DIQ1 K DIC,DA,DR,DIQ
"RTN","VAFCPDAT",137,0)
 .S HISICN=$G(HISNODE(2.0992,HIS,.01,"E"))
"RTN","VAFCPDAT",138,0)
 .S HISCHK=$G(HISNODE(2.0992,HIS,1,"E")) ;**863 - MVI_2351 (ptd) history checksum
"RTN","VAFCPDAT",139,0)
 .S HFULLICN=HISICN_$S(HISCHK]"":"V"_HISCHK,1:"") ;**863 - MVI_2351 (ptd) History full ICN
"RTN","VAFCPDAT",140,0)
 .S HISDT=$G(HISNODE(2.0992,HIS,3,"E"))
"RTN","VAFCPDAT",141,0)
 .I $Y+3>IOSL&($E(IOST,1,2)="C-") D  Q:QFLG
"RTN","VAFCPDAT",142,0)
 ..S LNQ=22 D SS Q:QFLG
"RTN","VAFCPDAT",143,0)
 ..W @IOF,!,"MPI/PD data for: ",NAME,"  (DFN #",DFN,")",!,LN2 D ICNHDR
"RTN","VAFCPDAT",144,0)
 .W !,HFULLICN I HISDT]"" W "  - changed ",HISDT ;**863 - MVI_2351 (ptd)
"RTN","VAFCPDAT",145,0)
 ;
"RTN","VAFCPDAT",146,0)
CONT ;Continue to VAFCPDT2 for extended data
"RTN","VAFCPDAT",147,0)
 ;D CMORHIS^VAFCPDT2  
"RTN","VAFCPDAT",148,0)
 ;CMOR History removed, called changed to EXT^VAFCPDT2  **837, MVI_918
"RTN","VAFCPDAT",149,0)
 D EXT^VAFCPDT2
"RTN","VAFCPDAT",150,0)
DONE ;
"RTN","VAFCPDAT",151,0)
 I QFLG G QUIT
"RTN","VAFCPDAT",152,0)
 I ($E(IOST,1,2)="C-") S LNQ=24 D SS
"RTN","VAFCPDAT",153,0)
 ;
"RTN","VAFCPDAT",154,0)
QUIT ;
"RTN","VAFCPDAT",155,0)
 K %,CMOR,DIC,DIR,DIRUT,DNODE,GOT,HDT,HFULLICN,HIS,HISCHK,HISDT,HISICN,JJ,LIEN
"RTN","VAFCPDAT",156,0)
 K LINST,LN,LSTDT,MNODE,REACODE,REASON,SCN,SCORE,SITE,SITEIEN,SITENAM,SITENUM
"RTN","VAFCPDAT",157,0)
 K SS,SUBN,SUBARR,TERM,TERMDT,TF,TFARR,TFDATA,TFIEN,TFNM,Y,D,CHG,CHGNODE
"RTN","VAFCPDAT",158,0)
 K HISNODE,DIFF,INST,RGDFN,SCRDT,STATION,STA,LN2,NAME,LSTSORT,LNQ,QFLG,MBI
"RTN","VAFCPDAT",159,0)
 Q
"RTN","VAFCPDAT",160,0)
TFHDR ;
"RTN","VAFCPDAT",161,0)
 W !!,"Treating Facilities:",?22,"Station:",?32,"DT Last Treated",?54,"Event Reason"
"RTN","VAFCPDAT",162,0)
 W !,"--------------------",?22,"--------",?32,"---------------",?54,"------------"
"RTN","VAFCPDAT",163,0)
 Q
"RTN","VAFCPDAT",164,0)
ICNHDR W !!,"ICN History:",!,"------------"
"RTN","VAFCPDAT",165,0)
 Q
"RTN","VAFCPDAT",166,0)
 ;
"RTN","VAFCPDAT",167,0)
SS S DIR(0)="E" D  D ^DIR K DIR I 'Y S QFLG=1
"RTN","VAFCPDAT",168,0)
 .S SS=LNQ-$Y F JJ=1:1:SS W !
"RTN","VAFCPDAT",169,0)
 Q
"RTN","VAFCQRY")
0^5^B23196961^B14904724
"RTN","VAFCQRY",1,0)
VAFCQRY ;BIR/DLR-Query for patient demographics ; 11/19/14 5:07pm
"RTN","VAFCQRY",2,0)
 ;;5.3;Registration;**428,575,627,707,863,902**;Aug 13, 1993;Build 2
"RTN","VAFCQRY",3,0)
 ;   
"RTN","VAFCQRY",4,0)
IN ;process in the patient query
"RTN","VAFCQRY",5,0)
 N IEN,HLA,VAFCCNT,ICN,CLAIM,SG,VAFCER,VAFC,DFN,STATE,CITY,SUBCOMP,COMP,REP,LVL,LVL2,VAFC,SSN,SAVEDFN
"RTN","VAFCQRY",6,0)
 S VAFCCNT=1,VAFCER=1
"RTN","VAFCQRY",7,0)
 F VAFC=1:1 X HLNEXT Q:HLQUIT'>0  S SG=$E(HLNODE,1,3) D:$T(@SG)]"" @SG
"RTN","VAFCQRY",8,0)
 S SAVEDFN=$G(DFN)
"RTN","VAFCQRY",9,0)
 D CHKID^VAFCQRY2(.ICN,.SSN,.DFN)
"RTN","VAFCQRY",10,0)
 I $G(DFN)'>0 D
"RTN","VAFCQRY",11,0)
 . ;**863 MVI_2352 if merged send back merged record info for update
"RTN","VAFCQRY",12,0)
 . I SAVEDFN,$D(^DPT(SAVEDFN,-9)) D  Q
"RTN","VAFCQRY",13,0)
 .. N DFN,ICN
"RTN","VAFCQRY",14,0)
 .. S DFN=^DPT(SAVEDFN,-9),ICN=$$GETICN^MPIF001(+DFN)
"RTN","VAFCQRY",15,0)
 .. S VAFCER="-1^New Primary record "_DFN_" at site with ICN "_ICN
"RTN","VAFCQRY",16,0)
 . S VAFCER="-1^Unknown ICN#"_$G(ICN)_" and SSN#"_$G(SSN)
"RTN","VAFCQRY",17,0)
 S ^TMP("HLA",$J,VAFCCNT)="MSA"_HL("FS")_"AA"_HL("FS")_HL("MID")_HL("FS")_$S(+$G(VAFCER)'>0:$P(VAFCER,"^",2),1:""),VAFCCNT=VAFCCNT+1
"RTN","VAFCQRY",18,0)
 S ^TMP("HLA",$J,VAFCCNT)=VAFCQRD,VAFCCNT=VAFCCNT+1
"RTN","VAFCQRY",19,0)
 I $G(VAFCER)>0 D BLDRSP(DFN,.VAFCCNT)
"RTN","VAFCQRY",20,0)
 D LINK^HLUTIL3(SITE,.VAFC) S IEN=$O(VAFC(0)) S HLL("LINKS",1)="^"_VAFC(IEN)
"RTN","VAFCQRY",21,0)
 D GENACK^HLMA1(HL("EID"),HLMTIENS,HL("EIDS"),"GM",1,.HLRESLTA,"",.HL)
"RTN","VAFCQRY",22,0)
 K VAFCER,VAFCID,COMP,SITE,VAFCFS,VAFCRCV,VAFCQRD,^TMP("HLA",$J)
"RTN","VAFCQRY",23,0)
 Q
"RTN","VAFCQRY",24,0)
RESP ;Response processing initiated from the MPI.
"RTN","VAFCQRY",25,0)
 Q
"RTN","VAFCQRY",26,0)
ROUTE ;Routine logic initiated from the MPI.
"RTN","VAFCQRY",27,0)
 Q
"RTN","VAFCQRY",28,0)
BLDRSP(DFN,VAFCCNT) ;
"RTN","VAFCQRY",29,0)
 N EVN,PID,PD1,SEQ,ERR,CNT,X,PV2,RADE,LABE,PRES
"RTN","VAFCQRY",30,0)
 N SIDG,ZEL,ZSP,NAMECOMP,OLD,PV1,DODF
"RTN","VAFCQRY",31,0)
 ;construct EVN (for TF Event Type AND Last Treatment Date)
"RTN","VAFCQRY",32,0)
 S SEQ="1,2" D BLDEVN(DFN,.SEQ,.EVN,.HL,"A19",.ERR) S ^TMP("HLA",$J,VAFCCNT)=EVN(1) S VAFCCNT=VAFCCNT+1
"RTN","VAFCQRY",33,0)
 ;construct PID
"RTN","VAFCQRY",34,0)
 S SEQ="ALL" D BLDPID(DFN,1,.SEQ,.PID,.HL,.ERR) S ^TMP("HLA",$J,VAFCCNT)=PID(1) S X=1,CNT=1 F  S X=$O(PID(X)) Q:'X  I $D(PID(X)) S ^TMP("HLA",$J,VAFCCNT,CNT)=PID(X),CNT=CNT+1
"RTN","VAFCQRY",35,0)
 S VAFCCNT=VAFCCNT+1
"RTN","VAFCQRY",36,0)
 ;construct PD1 **707
"RTN","VAFCQRY",37,0)
 ;S SEQ="3" D BLDPD1(DFN,.SEQ,.PD1,.HL,.ERR) S ^TMP("HLA",$J,VAFCCNT)=PD1(1)
"RTN","VAFCQRY",38,0)
 S PD1=$$PD1^VAFCSB I PD1'="" S ^TMP("HLA",$J,VAFCCNT)=PD1,VAFCCNT=VAFCCNT+1 ;**707
"RTN","VAFCQRY",39,0)
 S PV1=$$PV1^VAFCSB I PV1'="" S ^TMP("HLA",$J,VAFCCNT)=PV1,VAFCCNT=VAFCCNT+1 ;**707
"RTN","VAFCQRY",40,0)
 S PV2=$$PV2^VAFCSB I PV2'="" S ^TMP("HLA",$J,VAFCCNT)=PV2,VAFCCNT=VAFCCNT+1 ;**707
"RTN","VAFCQRY",41,0)
 S PRES=$$PHARA^VAFCSB I PRES'="" S ^TMP("HLA",$J,VAFCCNT)=PRES,VAFCCNT=VAFCCNT+1 ;**707
"RTN","VAFCQRY",42,0)
 S LABE=$$LABE^VAFCSB I LABE'="" S ^TMP("HLA",$J,VAFCCNT)=LABE,VAFCCNT=VAFCCNT+1 ;**707
"RTN","VAFCQRY",43,0)
 S RADE=$$RADE^VAFCSB I RADE'="" S ^TMP("HLA",$J,VAFCCNT)=RADE,VAFCCNT=VAFCCNT+1 ;**707
"RTN","VAFCQRY",44,0)
 S SIDG=$$SIG^VAFCSB(DFN) I $G(SIDG)'="" S ^TMP("HLA",$J,VAFCCNT)=SIDG,VAFCCNT=VAFCCNT+1  ;**902 MVI_4634 (ckn) - OBX FOR SELF ID GENDER
"RTN","VAFCQRY",45,0)
 S NAMECOMP=$$NAMEOBX^VAFCSB(DFN) I $G(NAMECOMP)'="" S ^TMP("HLA",$J,VAFCCNT)=NAMECOMP,VAFCCNT=VAFCCNT+1  ;**902 MVI_4634 (ckn): OBX for Patient .01 and Name Components
"RTN","VAFCQRY",46,0)
 S OLD=$$OLD(DFN) I $G(OLD)'="" S ^TMP("HLA",$J,VAFCCNT)=OLD,VAFCCNT=VAFCCNT+1  ;**902 MVI_4634 (ckn) - OBX to mark and Older record
"RTN","VAFCQRY",47,0)
 S DODF=$$DODF^VAFCSB(DFN) I $G(DODF)'="" S ^TMP("HLA",$J,VAFCCNT)=DODF,VAFCCNT=VAFCCNT+1  ;**902 MVI_4898 (ckn) : OBX for DOD fields
"RTN","VAFCQRY",48,0)
 ;** PATCH 575
"RTN","VAFCQRY",49,0)
 ;construct ZPD segment
"RTN","VAFCQRY",50,0)
 S SEQ="1,17,21,34" ;**707 Added 1, 21 and 34 to ZPD fields
"RTN","VAFCQRY",51,0)
 S ^TMP("HLA",$J,VAFCCNT)=$$EN1^VAFHLZPD(DFN,SEQ)
"RTN","VAFCQRY",52,0)
 S VAFCCNT=VAFCCNT+1
"RTN","VAFCQRY",53,0)
 ;**902 MVI_4634 (ckn) - Add ZSP and ZEL segments
"RTN","VAFCQRY",54,0)
 S ZSP=$$EN^VAFHLZSP(DFN) I $G(ZSP)'="" S ^TMP("HLA",$J,VAFCCNT)=ZSP,VAFCCNT=VAFCCNT+1  ;ZSP segment
"RTN","VAFCQRY",55,0)
 S ZEL=$$EN^VAFHLZEL(DFN,"1,8,9",1) I $G(ZEL)'="" S ^TMP("HLA",$J,VAFCCNT)=ZEL,VAFCCNT=VAFCCNT+1  ;ZEL segment
"RTN","VAFCQRY",56,0)
 Q
"RTN","VAFCQRY",57,0)
MSH ;process MSH segment
"RTN","VAFCQRY",58,0)
 S VAFCFS=HL("FS")
"RTN","VAFCQRY",59,0)
 S HLQ=HL("Q"),HLFS=HL("FS"),HLECH=HL("ECH")
"RTN","VAFCQRY",60,0)
 S VAFCID=HL("MID")
"RTN","VAFCQRY",61,0)
 S COMP=$E(HL("ECH"),1)
"RTN","VAFCQRY",62,0)
 S REP=$E(HL("ECH"),2)
"RTN","VAFCQRY",63,0)
 S SUBCOMP=$E(HL("ECH"),4)
"RTN","VAFCQRY",64,0)
 S SITE=$$LKUP^XUAF4($P($P(HLNODE,HL("FS"),4),COMP))
"RTN","VAFCQRY",65,0)
 Q
"RTN","VAFCQRY",66,0)
QRD ;process QRD segment
"RTN","VAFCQRY",67,0)
 N QRD,X,IDS,WSF,ID,QRDAA,QRDNTC
"RTN","VAFCQRY",68,0)
 S VAFCQRD=HLNODE
"RTN","VAFCQRY",69,0)
 S VAFCRCV=$P(VAFCQRD,HL("FS"),5)
"RTN","VAFCQRY",70,0)
 S IDS=$P(VAFCQRD,HL("FS"),9)
"RTN","VAFCQRY",71,0)
 F X=1:1:$L(IDS,REP) S WSF=$P(IDS,REP,X) D
"RTN","VAFCQRY",72,0)
 . ;get id, assigning authority, and name type code
"RTN","VAFCQRY",73,0)
 . S ID=$P(WSF,COMP),QRDAA=$P($P(WSF,COMP,9),SUBCOMP),QRDNTC=$P(WSF,COMP,10)
"RTN","VAFCQRY",74,0)
 . ;check assigning authority(0363) AND name type code(0203)
"RTN","VAFCQRY",75,0)
 . I QRDAA="USVHA" D
"RTN","VAFCQRY",76,0)
 .. I QRDNTC="NI" S ICN=ID  ;National unique individual identifier
"RTN","VAFCQRY",77,0)
 .. I QRDNTC="PI" S DFN=ID  ;Patient internal identifier
"RTN","VAFCQRY",78,0)
 . I QRDAA="USSSA" D
"RTN","VAFCQRY",79,0)
 .. I QRDNTC="SS" S SSN=ID  ;Social Security number
"RTN","VAFCQRY",80,0)
 Q
"RTN","VAFCQRY",81,0)
BLDEVN(DFN,SEQ,EVN,HL,EVR,ERR) ;build EVN for TF last treatment date and event reason
"RTN","VAFCQRY",82,0)
 ; At this point only sequence one and two are supported
"RTN","VAFCQRY",83,0)
 ; Variable list
"RTN","VAFCQRY",84,0)
 ;  DFN - internal PATIENT (#2) number
"RTN","VAFCQRY",85,0)
 ;  SEQ - variable consisting of sequence numbers delimited by commas
"RTN","VAFCQRY",86,0)
 ;        that will be used to build the message
"RTN","VAFCQRY",87,0)
 ;  EVN (passed by reference) - array location to place EVN segment result, the array can have existing values when passed.
"RTN","VAFCQRY",88,0)
 ;   HL - array that contains the necessary HL variables (init^hlsub)
"RTN","VAFCQRY",89,0)
 ;  EVR - event reason that triggered this message
"RTN","VAFCQRY",90,0)
 ;  ERR - array that is used to return an error
"RTN","VAFCQRY",91,0)
 ;
"RTN","VAFCQRY",92,0)
 D BLDEVN^VAFCQRY2(DFN,SEQ,.EVN,.HL,EVR,.ERR)
"RTN","VAFCQRY",93,0)
 Q
"RTN","VAFCQRY",94,0)
BLDPD1(DFN,SEQ,PD1,HL,ERR) ;
"RTN","VAFCQRY",95,0)
 ; At this point only sequence 3 is supported
"RTN","VAFCQRY",96,0)
 ; Variable list
"RTN","VAFCQRY",97,0)
 ;  DFN - internal PATIENT (#2) number
"RTN","VAFCQRY",98,0)
 ;  SEQ - variable consisting of sequence numbers delimited by commas
"RTN","VAFCQRY",99,0)
 ;        that will be used to build the message
"RTN","VAFCQRY",100,0)
 ;  PD1 (passed by reference) - array location to place PD1 segment result, the array can have existing values when passed.
"RTN","VAFCQRY",101,0)
 ;   HL - array that contains the necessary HL variables (init^hlsub)
"RTN","VAFCQRY",102,0)
 ;  ERR - array that is used to return an error
"RTN","VAFCQRY",103,0)
 ;
"RTN","VAFCQRY",104,0)
 D BLDPD1^VAFCQRY2(DFN,SEQ,.PD1,.HL,.ERR)
"RTN","VAFCQRY",105,0)
 Q
"RTN","VAFCQRY",106,0)
BLDPID(DFN,CNT,SEQ,PID,HL,ERR) ;build PID from File #2
"RTN","VAFCQRY",107,0)
 ;The required sequences 3 and 5 will be returned and at this point
"RTN","VAFCQRY",108,0)
 ;sequences 1-3,5-8,10-14,16,17,19,22-24 and 29 are supported
"RTN","VAFCQRY",109,0)
 ;
"RTN","VAFCQRY",110,0)
 ; At this point only sequence one and two are supported
"RTN","VAFCQRY",111,0)
 ; Variable list
"RTN","VAFCQRY",112,0)
 ;  DFN - internal PATIENT (#2) number
"RTN","VAFCQRY",113,0)
 ;  CNT - value to be place in PID seq#1 (SET ID)
"RTN","VAFCQRY",114,0)
 ;  SEQ - variable consisting of sequence numbers delimited by commas
"RTN","VAFCQRY",115,0)
 ;        that will be used to build the message
"RTN","VAFCQRY",116,0)
 ;  PID (passed by reference) - array location to place PID segment
"RTN","VAFCQRY",117,0)
 ;        result, the array can have existing values when passed.
"RTN","VAFCQRY",118,0)
 ;   HL - array that contains the necessary HL variables (init^hlsub)
"RTN","VAFCQRY",119,0)
 ;  ERR - array that is used to return an error
"RTN","VAFCQRY",120,0)
 ;
"RTN","VAFCQRY",121,0)
 ;if this is a mismatch a null or """" should be passed in, so that
"RTN","VAFCQRY",122,0)
 ;the ICN will be removed at the site
"RTN","VAFCQRY",123,0)
 ;
"RTN","VAFCQRY",124,0)
 D BLDPID^VAFCQRY1(DFN,CNT,SEQ,.PID,.HL,.ERR)
"RTN","VAFCQRY",125,0)
 Q
"RTN","VAFCQRY",126,0)
OLD(DFN) ; **902 MVI_4634 (ckn) Return OBX segment to flag a record as "old"
"RTN","VAFCQRY",127,0)
 Q $S($D(^XTMP("MPIF OLD RECORDS",DFN))#2:"OBX"_HL("FS")_HL("FS")_"CE"_HL("FS")_"OLDER RECORD"_HL("FS")_HL("FS")_"Y",1:"")
"RTN","VAFCSB")
0^6^B32788021^B15691481
"RTN","VAFCSB",1,0)
VAFCSB ;BIR/CMC-CONT ADT PROCESSOR TO RETRIGGER A08 or A04 MESSAGES WITH AL/AL (COMMIT/APPLICATION) ACKNOWLEDGEMENTS ; 11/26/14 12:03pm
"RTN","VAFCSB",2,0)
 ;;5.3;Registration;**707,756,825,876,902**;Aug 13, 1993;Build 2
"RTN","VAFCSB",3,0)
 ;
"RTN","VAFCSB",4,0)
 ;Reference to $$XAMDT^RAO7UTL1 is supported by IA #4875
"RTN","VAFCSB",5,0)
 ;Reference to RESUTLS^LRPXAPI is supported by IA #4245
"RTN","VAFCSB",6,0)
 ;
"RTN","VAFCSB",7,0)
PV2() ;build pv2 segment
"RTN","VAFCSB",8,0)
 N PV2,LSTA,APPT,VASD,VAIP,VARP,VAROOT
"RTN","VAFCSB",9,0)
 S PV2=""
"RTN","VAFCSB",10,0)
 ;get next outpatient appointment
"RTN","VAFCSB",11,0)
 K ^UTILITY("VASD",$J) S VASD("F")=DT D SDA^VADPT
"RTN","VAFCSB",12,0)
 S APPT=$P($G(^UTILITY("VASD",$J,1,"I")),"^")
"RTN","VAFCSB",13,0)
 I APPT'="" S $P(PV2,HL("FS"),9)=$$HLDATE^HLFNC(APPT)
"RTN","VAFCSB",14,0)
 ;GET LAST ADMISSION DATE
"RTN","VAFCSB",15,0)
 K VAIP S VAIP("D")="LAST",VAIP("M")=0 D IN5^VADPT
"RTN","VAFCSB",16,0)
 ; **825,CR_1184: for PV2-14, it will be re-set as the 15th piece
"RTN","VAFCSB",17,0)
 ; in PV2 segment a few lines below
"RTN","VAFCSB",18,0)
 ; I VAIP(2)="1^ADMISSION" S $P(PV2,HL("FS"),15)=$$HLDATE^HLFNC($P(VAIP(3),"^"))
"RTN","VAFCSB",19,0)
 I VAIP(2)="1^ADMISSION" S $P(PV2,HL("FS"),14)=$$HLDATE^HLFNC($P(VAIP(3),"^"))
"RTN","VAFCSB",20,0)
 ;get last registration
"RTN","VAFCSB",21,0)
 S VAROOT="VARP"
"RTN","VAFCSB",22,0)
 D REG^VADPT
"RTN","VAFCSB",23,0)
 I $D(VARP(1,"I")),$G(VARP(1,"I"))>0 S $P(PV2,HL("FS"),46)=$$HLDATE^HLFNC($P(VARP(1,"I"),"^"),"DT"),$P(PV2,HL("FS"),24)="CR"
"RTN","VAFCSB",24,0)
 ;**756 ^ ONLY RETURN DATE FOR LAST REGISTRATION AS HL7 STANDARD CAN ONLY HAVE DATE
"RTN","VAFCSB",25,0)
 I PV2'="" S PV2="PV2"_HL("FS")_PV2
"RTN","VAFCSB",26,0)
 Q PV2
"RTN","VAFCSB",27,0)
PHARA() ;build obx to show active prescriptions
"RTN","VAFCSB",28,0)
 N RET S RET=""
"RTN","VAFCSB",29,0)
 I '$$PATCH^XPDUTL("PSS*1.0*101") Q RET
"RTN","VAFCSB",30,0)
 N PHARM,DGLIST
"RTN","VAFCSB",31,0)
 S PHARM="" D PROF^PSO52API(DFN,"DGLIST")
"RTN","VAFCSB",32,0)
 I +$G(^TMP($J,"DGLIST",DFN,0))>0 S PHARM="OBX"_HL("FS")_HL("FS")_"CE"_HL("FS")_"ACTIVE PRESCRIPTIONS"_HL("FS")_HL("FS")_"Y"
"RTN","VAFCSB",33,0)
 ;**756 CE added as the data type
"RTN","VAFCSB",34,0)
 Q PHARM
"RTN","VAFCSB",35,0)
SIG(DFN) ;**876 MVI_3467 (ckn) Build OBX for Self Identified Gender
"RTN","VAFCSB",36,0)
 N SIG,SIGE,SIGTMP,OBX S OBX=""
"RTN","VAFCSB",37,0)
 ;I '$$PATCH^XPDUTL("DG*5.3*876") Q OBX
"RTN","VAFCSB",38,0)
 S DIC=2,DA=DFN,DR=".024",DIQ="SIGTMP",DIQ(0)="I,E,N" D EN^DIQ1
"RTN","VAFCSB",39,0)
 I '$D(SIGTMP) K DA,DR,DIQ  Q OBX
"RTN","VAFCSB",40,0)
 S SIG=$G(SIGTMP(2,DFN,DR,"I")),SIGE=$G(SIGTMP(2,DFN,DR,"E"))
"RTN","VAFCSB",41,0)
 S OBX="OBX"_HL("FS")_HL("FS")_"CE"_HL("FS")_"SELF ID GENDER"_HL("FS")_HL("FS")_SIG_$E(HL("ECH"),1)_SIGE
"RTN","VAFCSB",42,0)
 K DA,DR,DIC,DIQ
"RTN","VAFCSB",43,0)
 Q OBX
"RTN","VAFCSB",44,0)
DODF(DFN) ;**902 MVI_4898 (ckn) Build OBX for DOD fields
"RTN","VAFCSB",45,0)
 N DODTMP,DODEB,DODLEB,DODSRC,DODLUPD,DODSRCI,DODSRCE,CS,DODLNAM
"RTN","VAFCSB",46,0)
 N DODFNAM,DODMNAM,DODEBE,DODEBI,DODLEBE,DODLEBI
"RTN","VAFCSB",47,0)
 S CS=$E(HL("ECH")),SC=$E(HL("ECH"),4)
"RTN","VAFCSB",48,0)
 S DIC=2,DA=DFN,DR=".352;.353;.354;.355",DIQ="DODTMP",DIQ(0)="I,E,N" D EN^DIQ1
"RTN","VAFCSB",49,0)
 S DODSRCI=$G(DODTMP(2,DFN,.353,"I")),DODSRCE=$G(DODTMP(2,DFN,.353,"E")),DODSRC=HL("Q")
"RTN","VAFCSB",50,0)
 I DODSRCE'="" S DODSRC=DODSRCI_CS_DODSRCE_CS_"L"
"RTN","VAFCSB",51,0)
 S DODLUPD=$G(DODTMP(2,DFN,.354,"I")) S DODLUPD=$S(DODLUPD="":HL("Q"),1:$$HLDATE^HLFNC(DODLUPD))
"RTN","VAFCSB",52,0)
 ;If LAST EDITED BY field(#.355) have value, use it to populate sequence 16 of OBX
"RTN","VAFCSB",53,0)
 ;If LAST EDITED BY field(#.355) does not have value, use DEATH ENTERED BY field(#.352) to populate sequence 16 of OBX
"RTN","VAFCSB",54,0)
 ;If both fields empty, send double quotes in sequence 16 of OBX
"RTN","VAFCSB",55,0)
 S DODLEB=HL("Q") ;Default seq 16
"RTN","VAFCSB",56,0)
 S DODEBE=$G(DODTMP(2,DFN,.352,"E")),DODEBI=$G(DODTMP(2,DFN,.352,"I")) ;DOD Entered by
"RTN","VAFCSB",57,0)
 S DODLEBE=$G(DODTMP(2,DFN,.355,"E")),DODLEBI=$G(DODTMP(2,DFN,.355,"I")) ;DOD Last Edited By
"RTN","VAFCSB",58,0)
 I DODLEBE'="" D
"RTN","VAFCSB",59,0)
 .S DODLEBE=$$HLNAME^HLFNC(DODLEBE,CS),DODLNAM=$S($P(DODLEBE,CS)="":HL("Q"),1:$P(DODLEBE,CS)),DODFNAM=$S($P(DODLEBE,CS,2)="":HL("Q"),1:$P(DODLEBE,CS,2)),DODMNAM=$S($P(DODLEBE,CS,3)="":HL("Q"),1:$P(DODLEBE,CS,3))
"RTN","VAFCSB",60,0)
 .S DODLEB=$S(DODLEBI="":HL("Q"),1:DODLEBI)_CS_DODLNAM_CS_DODFNAM_CS_DODMNAM_CS_CS_CS_CS_CS_"USVHA"_SC_SC_"0363"_CS_"L"_CS_CS_CS_"PN"_CS_"VA FACILITY ID"_SC_$P($$SITE^VASITE(),"^",3)_SC_"L"
"RTN","VAFCSB",61,0)
 I DODLEBE="",(DODEBE'="") D
"RTN","VAFCSB",62,0)
 .S DODEBE=$$HLNAME^HLFNC(DODEBE,CS),DODLNAM=$S($P(DODEBE,CS)="":HL("Q"),1:$P(DODEBE,CS)),DODFNAM=$S($P(DODEBE,CS,2)="":HL("Q"),1:$P(DODEBE,CS,2)),DODMNAM=$S($P(DODEBE,CS,3)="":HL("Q"),1:$P(DODEBE,CS,3))
"RTN","VAFCSB",63,0)
 .S DODLEB=$S(DODEBI="":HL("Q"),1:DODEBI)_CS_DODLNAM_CS_DODFNAM_CS_DODMNAM_CS_CS_CS_CS_CS_"USVHA"_SC_SC_"0363"_CS_"L"_CS_CS_CS_"PN"_CS_"VA FACILITY ID"_SC_$P($$SITE^VASITE(),"^",3)_SC_"L"
"RTN","VAFCSB",64,0)
 S OBX="OBX"_HL("FS")_HL("FS")_"CE"_HL("FS")_"DATE OF DEATH DATA"_HL("FS")_HL("FS")_DODSRC_HL("FS")_HL("FS")_HL("FS")_HL("FS")_HL("FS")_HL("FS")_"R"_HL("FS")_HL("FS")_HL("FS")_DODLUPD_HL("FS")_HL("FS")_$G(DODLEB)
"RTN","VAFCSB",65,0)
 K DA,DR,DIC,DIQ
"RTN","VAFCSB",66,0)
 Q OBX
"RTN","VAFCSB",67,0)
NAMEOBX(DFN) ;**876,MVI_3453 (mko): Build OBX for Patient .01 and Name Components
"RTN","VAFCSB",68,0)
 N FS
"RTN","VAFCSB",69,0)
 S FS=HL("FS")
"RTN","VAFCSB",70,0)
 Q "OBX"_FS_FS_"CE"_FS_"NAME COMPONENTS"_FS_FS_$$NAMECOMP(DFN,$E(HL("ECH")))
"RTN","VAFCSB",71,0)
NAMEERR(DFN) ;**876,MVI_3453 (mko): Build ERR for Patient .01 and Name Components
"RTN","VAFCSB",72,0)
 N CS,SC
"RTN","VAFCSB",73,0)
 S CS=$E(HL("ECH")),SC=$E(HL("ECH"),4)
"RTN","VAFCSB",74,0)
 Q "ERR"_HL("FS")_CS_CS_CS_SC_$$NAMECOMP(DFN,SC)
"RTN","VAFCSB",75,0)
NAMECOMP(DFN,DELIM) ;**876,MVI_3453 (mko): Return Patient .01 and Name Components
"RTN","VAFCSB",76,0)
 N DIHELP,DIMSG,DIERR,MSG,NC,NCIEN,NCIENS,NCPTR,TARG
"RTN","VAFCSB",77,0)
 S NC=$P($G(^DPT(DFN,0)),"^")
"RTN","VAFCSB",78,0)
 S NCPTR=$P($G(^DPT(DFN,"NAME")),"^") Q:'NCPTR NC
"RTN","VAFCSB",79,0)
 S NCIEN=$$FIND1^DIC(20,"","","`"_NCPTR,"","","MSG") Q:'NCIEN NC
"RTN","VAFCSB",80,0)
 S NCIENS=NCIEN_","
"RTN","VAFCSB",81,0)
 D GETS^DIQ(20,NCIENS,"1:5","","TARG","MSG") Q:$G(DIERR) NC
"RTN","VAFCSB",82,0)
 S NC=NC_DELIM_TARG(20,NCIENS,1)_DELIM_TARG(20,NCIENS,2)_DELIM_TARG(20,NCIENS,3)_DELIM_TARG(20,NCIENS,5)_DELIM_TARG(20,NCIENS,4)
"RTN","VAFCSB",83,0)
 Q NC
"RTN","VAFCSB",84,0)
LABE() ;BUILD OBX FOR LAST LAB TEST DATE
"RTN","VAFCSB",85,0)
 N OBX S OBX=""
"RTN","VAFCSB",86,0)
 I '$$PATCH^XPDUTL("LR*5.2*295") Q OBX
"RTN","VAFCSB",87,0)
 N LAB,LAB2,EN
"RTN","VAFCSB",88,0)
 S LAB="" K ^TMP("DGLAB",$J) D RESULTS^LRPXAPI("DGLAB",DFN,"C")
"RTN","VAFCSB",89,0)
 S EN=$O(^TMP("DGLAB",$J,"")) I EN'="" S LAB=$P($G(^TMP("DGLAB",$J,EN)),"^")
"RTN","VAFCSB",90,0)
 K ^TMP("DGLAB",$J) D RESULTS^LRPXAPI("DGLAB",DFN,"A")
"RTN","VAFCSB",91,0)
 S EN=$O(^TMP("DGLAB",$J,"")) I EN'="" S LAB2=$P($G(^TMP("DGLAB",$J,EN)),"^") I LAB2>LAB S LAB=LAB2
"RTN","VAFCSB",92,0)
 K ^TMP("DGLAB",$J) D RESULTS^LRPXAPI("DGLAB",DFN,"M")
"RTN","VAFCSB",93,0)
 S EN=$O(^TMP("DGLAB",$J,"")) I EN'="" S LAB2=$P($G(^TMP("DGLAB",$J,EN)),"^") I LAB2>LAB S LAB=LAB2
"RTN","VAFCSB",94,0)
 I LAB'="" D
"RTN","VAFCSB",95,0)
 .S $P(OBX,HL("FS"),2)="TS" ;**756 added the data type
"RTN","VAFCSB",96,0)
 .S $P(OBX,HL("FS"),3)="LAST LAB TEST DATE/TIME"
"RTN","VAFCSB",97,0)
 .S $P(OBX,HL("FS"),11)="F"
"RTN","VAFCSB",98,0)
 .S $P(OBX,HL("FS"),14)=$$HLDATE^HLFNC(LAB)
"RTN","VAFCSB",99,0)
 .S OBX="OBX"_HL("FS")_OBX
"RTN","VAFCSB",100,0)
 Q OBX
"RTN","VAFCSB",101,0)
RADE() ;BUILD OBX FOR LAST RADIOLOGY TEST DATE
"RTN","VAFCSB",102,0)
 N RET S RET=""
"RTN","VAFCSB",103,0)
 I '$$PATCH^XPDUTL("RA*5.0*76") Q RET
"RTN","VAFCSB",104,0)
 N RAD,RADE
"RTN","VAFCSB",105,0)
 S RAD="",RADE=$$XAMDT^RAO7UTL1(DFN) I +RADE<1 Q RAD
"RTN","VAFCSB",106,0)
 I +RADE>0 D
"RTN","VAFCSB",107,0)
 .S $P(OBX,HL("FS"),2)="TS" ;**756 added the data type
"RTN","VAFCSB",108,0)
 .S $P(RAD,HL("FS"),3)="LAST RADIOLOGY EXAM DATE/TIME"
"RTN","VAFCSB",109,0)
 .S $P(RAD,HL("FS"),11)="F"
"RTN","VAFCSB",110,0)
 .S $P(RAD,HL("FS"),14)=$$HLDATE^HLFNC(RADE)
"RTN","VAFCSB",111,0)
 .S RAD="OBX"_HL("FS")_RAD
"RTN","VAFCSB",112,0)
 Q RAD
"RTN","VAFCSB",113,0)
PD1() ;BUILD PD1 segment
"RTN","VAFCSB",114,0)
 ;PREFERRED FACILITY -- NOT GOING TO BE PASSED PER IMDQ 9/7/06
"RTN","VAFCSB",115,0)
 N TEAM,PD1
"RTN","VAFCSB",116,0)
 S PD1=""
"RTN","VAFCSB",117,0)
 ;S TEAM=$$PREF^DGENPTA(DFN)
"RTN","VAFCSB",118,0)
 ;I TEAM'="" S PD1="PD1"_HL("FS")_HL("FS")_HL("FS")_$$STA^XUAF4(TEAM)
"RTN","VAFCSB",119,0)
 Q PD1
"RTN","VAFCSB",120,0)
PV1() ;BUILD PV1 SEGMENT
"RTN","VAFCSB",121,0)
 ;CURRENTLY ADMITTED?
"RTN","VAFCSB",122,0)
 N PV1,VAINDT
"RTN","VAFCSB",123,0)
 S PV1=""
"RTN","VAFCSB",124,0)
 S VAINDT=DT
"RTN","VAFCSB",125,0)
 D INP^VADPT
"RTN","VAFCSB",126,0)
 I $G(VAIN(1))'="" S $P(PV1,HL("FS"),44)=$$HLDATE^HLFNC($P(VAIN(7),"^")),PV1="PV1"_HL("FS")_PV1
"RTN","VAFCSB",127,0)
 K VAIN
"RTN","VAFCSB",128,0)
 Q PV1
"RTN","VAFCTR")
0^3^B4435550^B3892761
"RTN","VAFCTR",1,0)
VAFCTR ;BIR/CMC,ERC,PTD-Monitoring fields for MPI/PD via DG field monitoring ; 3/30/07
"RTN","VAFCTR",2,0)
 ;;5.3;Registration;**575,648,653,712,876,902**;Aug 13, 1993;Build 2
"RTN","VAFCTR",3,0)
 Q  ; quit if called from the top
"RTN","VAFCTR",4,0)
 ;
"RTN","VAFCTR",5,0)
MPIPD ; protocol entry point for monitoring fields via DG field monitoring
"RTN","VAFCTR",6,0)
 ; Currently monitoring for fields:
"RTN","VAFCTR",7,0)
 ; 1 ALIAS - .01 of the multiple
"RTN","VAFCTR",8,0)
 ; 2 RACE INFORMATION - .01 of the multiple
"RTN","VAFCTR",9,0)
 ; 6 ETHNICITY INFORMATION - .01 of the multiple
"RTN","VAFCTR",10,0)
 ; 994 MULTIPLE BIRTH INDICATOR
"RTN","VAFCTR",11,0)
 ; .525 POW STAUTS INDICATED?
"RTN","VAFCTR",12,0)
 ; .0906 PSEUDO SSN REASON
"RTN","VAFCTR",13,0)
 ; .121 BAD ADDRESS INDICATOR
"RTN","VAFCTR",14,0)
 ; .133 EMAIL ADDRESS
"RTN","VAFCTR",15,0)
 ; .134 PHONE NUMBER [CELLULAR]
"RTN","VAFCTR",16,0)
 ; .024 SELF IDENTIFIED GENDER **876
"RTN","VAFCTR",17,0)
 ; 391 TYPE ;**876
"RTN","VAFCTR",18,0)
 ; 1901 VETERAN Y/N? **876
"RTN","VAFCTR",19,0)
 ; .323 PERIOD OF SERVICE **876
"RTN","VAFCTR",20,0)
 ; .352 DEATH ENTERED BY **902 MVI_4735 (jfw)
"RTN","VAFCTR",21,0)
 ; .353 SOURCE OF NOTIFICATION **902 MVI_4735 (jfw)
"RTN","VAFCTR",22,0)
 ; .354 DATE OF DEATH LAST UPDATED **902 MVI_4735 (jfw)
"RTN","VAFCTR",23,0)
 ; .355 LAST EDITED BY **902 MVI_4735 (jfw)
"RTN","VAFCTR",24,0)
 ;
"RTN","VAFCTR",25,0)
 N MVIRSLT
"RTN","VAFCTR",26,0)
 I $G(DGFILE)'=2&($G(DGFILE)'=2.01)&($G(DGFILE)'=2.02)&($G(DGFILE)'=2.06) Q
"RTN","VAFCTR",27,0)
 S DGFIELD=$G(DGFIELD)
"RTN","VAFCTR",28,0)
 ;I DGFIELD'=.01&(DGFIELD'=994)&(DGFIELD'=.525)&(DGFIELD'=.0906)&(DGFIELD'=.121)&(DGFIELD'=.133)&(DGFIELD'=.134)&(DGFIELD'=391)&(DGFIELD'=1901)&(DGFIELD'=.323)&(DGFIELD'=.024) Q
"RTN","VAFCTR",29,0)
 ;**902 MVI_4735 (jfw) Add 4 new fields to list (Break apart long If line above)
"RTN","VAFCTR",30,0)
 S MVIRSLT=(DGFIELD'=.01)&(DGFIELD'=994)&(DGFIELD'=.525)&(DGFIELD'=.0906)&(DGFIELD'=.121)&(DGFIELD'=.133)
"RTN","VAFCTR",31,0)
 S MVIRSLT=MVIRSLT&(DGFIELD'=.134)&(DGFIELD'=391)&(DGFIELD'=1901)&(DGFIELD'=.323)&(DGFIELD'=.024)
"RTN","VAFCTR",32,0)
 S MVIRSLT=MVIRSLT&(DGFIELD'=.352)&(DGFIELD'=.353)&(DGFIELD'=.354)&(DGFIELD'=.355)
"RTN","VAFCTR",33,0)
 Q:(MVIRSLT)
"RTN","VAFCTR",34,0)
 I $T(AVAFC^VAFCDD01)="" Q
"RTN","VAFCTR",35,0)
 ;The fields below are not multiples
"RTN","VAFCTR",36,0)
 ;I (DGFIELD=994)!(DGFIELD=.525)!(DGFIELD=.0906)!(DGFIELD=.121)!(DGFIELD=.133)!(DGFIELD=.134)!(DGFIELD=.024)!(DGFIELD=391)!(DGFIELD=1901)!(DGFIELD=.323) S VAFCF=DGFIELD_";" D AVAFC^VAFCDD01(DGDA)
"RTN","VAFCTR",37,0)
 ;**902 MVI_4735 (jfw) Add 4 new fields to list (Break apart long If line above)
"RTN","VAFCTR",38,0)
 S MVIRSLT=(DGFIELD=994)!(DGFIELD=.525)!(DGFIELD=.0906)!(DGFIELD=.121)!(DGFIELD=.133)
"RTN","VAFCTR",39,0)
 S MVIRSLT=MVIRSLT!(DGFIELD=.134)!(DGFIELD=.024)!(DGFIELD=391)!(DGFIELD=1901)!(DGFIELD=.323)
"RTN","VAFCTR",40,0)
 S MVIRSLT=MVIRSLT!(DGFIELD=.352)!(DGFIELD=.353)!(DGFIELD=.354)!(DGFIELD=.355)
"RTN","VAFCTR",41,0)
 I MVIRSLT S VAFCF=DGFIELD_";" D AVAFC^VAFCDD01(DGDA)
"RTN","VAFCTR",42,0)
 ;The fields below ARE multiples
"RTN","VAFCTR",43,0)
 I DGFILE=2.01 S VAFCF="1;" D AVAFC^VAFCDD01(DGDA(1)) ;ALIAS
"RTN","VAFCTR",44,0)
 I DGFILE=2.02 S VAFCF="2.02,.01;" D AVAFC^VAFCDD01(DGDA(1)) ;RACE INFORMATION
"RTN","VAFCTR",45,0)
 I DGFILE=2.06 S VAFCF="2.06,.01;" D AVAFC^VAFCDD01(DGDA(1)) ;ETHNICITY INFORMATION
"RTN","VAFCTR",46,0)
 Q
"SEC","^DD",2,2,991.1,8.5)
CIRNDELETE
"UP",2,2.0991,-1)
2^MPIFICNHIS
"UP",2,2.0991,0)
2.0991
"VER")
8.0^22.0
"^DD",2,2,.354,0)
DATE OF DEATH LAST UPDATED^Da^^.35;4^S %DT="EX" D ^%DT S X=Y K:Y<1 X
"^DD",2,2,.354,1,0)
^.1
"^DD",2,2,.354,1,1,0)
2^AENR354^MUMPS
"^DD",2,2,.354,1,1,1)
D EVENT^IVMPLOG(DA)
"^DD",2,2,.354,1,1,2)
D EVENT^IVMPLOG(DA)
"^DD",2,2,.354,1,1,3)
 DO NOT DELETE
"^DD",2,2,.354,1,1,"%D",0)
^.101^2^2^3050606^^^^
"^DD",2,2,.354,1,1,"%D",1,0)
This cross-reference is used to notify HEC of changes that may affect
"^DD",2,2,.354,1,1,"%D",2,0)
enrollment.
"^DD",2,2,.354,1,1,"DT")
3050606
"^DD",2,2,.354,3)
Enter the date that the DATE OF DEATH for this patient was last updated.
"^DD",2,2,.354,21,0)
^.001^2^2^3141020^^^
"^DD",2,2,.354,21,1,0)
This is a date/time value that represents the date/time the date of death 
"^DD",2,2,.354,21,2,0)
field (.351) was last modified/entered/deleted.
"^DD",2,2,.354,"AUDIT")
y
"^DD",2,2,.354,"DT")
3141222
"^DD",2,2,.355,0)
LAST EDITED BY^P200'a^VA(200,^.35;5^Q
"^DD",2,2,.355,3)
The name of the person who last edited the DATE OF DEATH.
"^DD",2,2,.355,21,0)
^.001^2^2^3141020^^
"^DD",2,2,.355,21,1,0)
This is the local user ID of the person that last made a modification to 
"^DD",2,2,.355,21,2,0)
the date of death (.351) field.
"^DD",2,2,.355,"AUDIT")
y
"^DD",2,2,.355,"DT")
3141222
"^DD",2,2,991.1,0)
FULL ICN^FXa^^MPI;10^K:$L(X)>29!($L(X)<8)!($S($L($P(X,"V"))>16:1,$L($P(X,"V",2))=6:'(X?1.N1"V"6N),1:'(X?1.N1"V"12N))) X
"^DD",2,2,991.1,1,0)
^.1
"^DD",2,2,991.1,1,1,0)
2^AFICN
"^DD",2,2,991.1,1,1,1)
S ^DPT("AFICN",$E(X,1,30),DA)=""
"^DD",2,2,991.1,1,1,2)
K ^DPT("AFICN",$E(X,1,30),DA)
"^DD",2,2,991.1,1,1,"%D",0)
^^2^2^3141008^
"^DD",2,2,991.1,1,1,"%D",1,0)
This is a non-lookup cross-reference for the FULL ICN (Integration 
"^DD",2,2,991.1,1,1,"%D",2,0)
Control Number) field.
"^DD",2,2,991.1,1,1,"DT")
3141008
"^DD",2,2,991.1,3)
Enter the local or national Integration Control Number (ICN) assigned to the patient.
"^DD",2,2,991.1,21,0)
^^7^7^3141008^
"^DD",2,2,991.1,21,1,0)
This field can only be edited by CIRN!
"^DD",2,2,991.1,21,2,0)
 
"^DD",2,2,991.1,21,3,0)
The entire Integration Control Number (ICN), which is based on the ASTM
"^DD",2,2,991.1,21,4,0)
E-1714 standard format of a 16 digit identifier, 1 character delimiter,
"^DD",2,2,991.1,21,5,0)
6 digit checksum, followed by an optional 6 digit encryption scheme.
"^DD",2,2,991.1,21,6,0)
 
"^DD",2,2,991.1,21,7,0)
ICN is a machine to machine identifier for a patient.
"^DD",2,2,991.1,"AUDIT")
y
"^DD",2,2,991.1,"DT")
3141008
"^DD",2,2,991.91,0)
FULL ICN HISTORY^2.0991A^^MPIFICNHIS;0
"^DD",2,2,991.91,21,0)
^.001^2^2^3141008^^
"^DD",2,2,991.91,21,1,0)
Maintains the history of all of the full Integration Control Numbers
"^DD",2,2,991.91,21,2,0)
(ICNs) assigned to patients.
"^DD",2,2.0991,0)
FULL ICN HISTORY SUB-FIELD^^.01^1
"^DD",2,2.0991,0,"DT")
3141008
"^DD",2,2.0991,0,"NM","FULL ICN HISTORY")

"^DD",2,2.0991,0,"UP")
2
"^DD",2,2.0991,.01,0)
FULL ICN HISTORY^FXa^^0;1^K:$L(X)>29!($L(X)<8)!($S($L($P(X,"V"))>16:1,$L($P(X,"V",2))=6:'(X?1.N1"V"6N),1:'(X?1.N1"V"12N))) X
"^DD",2,2.0991,.01,1,0)
^.1
"^DD",2,2.0991,.01,1,1,0)
2^AAFICN^MUMPS
"^DD",2,2.0991,.01,1,1,1)
S ^DPT("AFICN",$E(X,1,30),DA(1))=""
"^DD",2,2.0991,.01,1,1,2)
K ^DPT("AFICN",$E(X,1,30),DA(1))
"^DD",2,2.0991,.01,1,1,"%D",0)
^^3^3^3141008^
"^DD",2,2.0991,.01,1,1,"%D",1,0)
This cross-reference was created to allow all Integration Control 
"^DD",2,2.0991,.01,1,1,"%D",2,0)
Numbers (ICNs) in the FULL ICN HISTORY Sub-File to remain in the 
"^DD",2,2.0991,.01,1,1,"%D",3,0)
AFICN cross-reference when re-indexing.
"^DD",2,2.0991,.01,1,1,"DT")
3141008
"^DD",2,2.0991,.01,3)
Enter the local or national Integration Control Number (ICN) assigned to the patient.
"^DD",2,2.0991,.01,21,0)
^^6^6^3141008^
"^DD",2,2.0991,.01,21,1,0)
This field can only be edited by CIRN!
"^DD",2,2.0991,.01,21,2,0)
 
"^DD",2,2.0991,.01,21,3,0)
The FULL ICN (Integration Control Number) HISTORY value, allows for 
"^DD",2,2.0991,.01,21,4,0)
tracking of changes in the ICN for each patient. These entries will 
"^DD",2,2.0991,.01,21,5,0)
be used by mumps code to perform lookups when an ICN for a patient 
"^DD",2,2.0991,.01,21,6,0)
can't be found, to see if it was previously used.
"^DD",2,2.0991,.01,"AUDIT")
y
"^DD",2,2.0991,.01,"DT")
3141008
"BLD",3012,6)
^797
**END**
**END**

