Released DG*5.3*859 SEQ #788
Extracted from mail message
**KIDS**:DG*5.3*859^

**INSTALL NAME**
DG*5.3*859
"BLD",9498,0)
DG*5.3*859^REGISTRATION^0^3140428^y
"BLD",9498,1,0)
^^5^5^3131205^
"BLD",9498,1,1,0)
Patch DG*5.3*859 addresses an issue with the DG Home Telehealth mail 
"BLD",9498,1,2,0)
alerts that users receive when an HL7 message does not receive the
"BLD",9498,1,3,0)
proper acknowledgement and an error alert is created.  Users are finding
"BLD",9498,1,4,0)
it difficult to research the alert received without more information 
"BLD",9498,1,5,0)
included in the message.
"BLD",9498,4,0)
^9.64PA^^
"BLD",9498,6.3)
8
"BLD",9498,"KRN",0)
^9.67PA^779.2^20
"BLD",9498,"KRN",.4,0)
.4
"BLD",9498,"KRN",.401,0)
.401
"BLD",9498,"KRN",.402,0)
.402
"BLD",9498,"KRN",.403,0)
.403
"BLD",9498,"KRN",.5,0)
.5
"BLD",9498,"KRN",.84,0)
.84
"BLD",9498,"KRN",3.6,0)
3.6
"BLD",9498,"KRN",3.8,0)
3.8
"BLD",9498,"KRN",9.2,0)
9.2
"BLD",9498,"KRN",9.8,0)
9.8
"BLD",9498,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",9498,"KRN",9.8,"NM",1,0)
DGHTRTX^^0^B16565775
"BLD",9498,"KRN",9.8,"NM","B","DGHTRTX",1)

"BLD",9498,"KRN",19,0)
19
"BLD",9498,"KRN",19.1,0)
19.1
"BLD",9498,"KRN",101,0)
101
"BLD",9498,"KRN",409.61,0)
409.61
"BLD",9498,"KRN",771,0)
771
"BLD",9498,"KRN",779.2,0)
779.2
"BLD",9498,"KRN",870,0)
870
"BLD",9498,"KRN",8989.51,0)
8989.51
"BLD",9498,"KRN",8989.52,0)
8989.52
"BLD",9498,"KRN",8994,0)
8994
"BLD",9498,"KRN","B",.4,.4)

"BLD",9498,"KRN","B",.401,.401)

"BLD",9498,"KRN","B",.402,.402)

"BLD",9498,"KRN","B",.403,.403)

"BLD",9498,"KRN","B",.5,.5)

"BLD",9498,"KRN","B",.84,.84)

"BLD",9498,"KRN","B",3.6,3.6)

"BLD",9498,"KRN","B",3.8,3.8)

"BLD",9498,"KRN","B",9.2,9.2)

"BLD",9498,"KRN","B",9.8,9.8)

"BLD",9498,"KRN","B",19,19)

"BLD",9498,"KRN","B",19.1,19.1)

"BLD",9498,"KRN","B",101,101)

"BLD",9498,"KRN","B",409.61,409.61)

"BLD",9498,"KRN","B",771,771)

"BLD",9498,"KRN","B",779.2,779.2)

"BLD",9498,"KRN","B",870,870)

"BLD",9498,"KRN","B",8989.51,8989.51)

"BLD",9498,"KRN","B",8989.52,8989.52)

"BLD",9498,"KRN","B",8994,8994)

"BLD",9498,"QDEF")
^^^^^^^^^^YES
"BLD",9498,"QUES",0)
^9.62^^
"BLD",9498,"REQB",0)
^9.611^1^1
"BLD",9498,"REQB",1,0)
DG*5.3*644^2
"BLD",9498,"REQB","B","DG*5.3*644",1)

"MBREQ")
0
"PKG",5,-1)
1^1
"PKG",5,0)
REGISTRATION^DG^PATIENT REGISTRATION, ADMISSION, DISCHARGE, EMBOSSER 
"PKG",5,20,0)
^9.402P^^
"PKG",5,22,0)
^9.49I^1^1
"PKG",5,22,1,0)
5.3^2930813
"PKG",5,22,1,"PAH",1,0)
859^3140428
"PKG",5,22,1,"PAH",1,1,0)
^^5^5^3140428
"PKG",5,22,1,"PAH",1,1,1,0)
Patch DG*5.3*859 addresses an issue with the DG Home Telehealth mail 
"PKG",5,22,1,"PAH",1,1,2,0)
alerts that users receive when an HL7 message does not receive the
"PKG",5,22,1,"PAH",1,1,3,0)
proper acknowledgement and an error alert is created.  Users are finding
"PKG",5,22,1,"PAH",1,1,4,0)
it difficult to research the alert received without more information 
"PKG",5,22,1,"PAH",1,1,5,0)
included in the message.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","DGHTRTX")
0^1^B16565775^B14862223
"RTN","DGHTRTX",1,0)
DGHTRTX ;ALB/JRC - Home Telehealth HL7 Message Monitoring Routine ;10 January 2005 ; 1/17/14 12:02pm
"RTN","DGHTRTX",2,0)
 ;;5.3;Registration;**644,859**;Aug 13, 1993;Build 8
"RTN","DGHTRTX",3,0)
 ;
"RTN","DGHTRTX",4,0)
 ;This routine when tasked will run at predetermined time intervals
"RTN","DGHTRTX",5,0)
 ;and check to see if there are any HTH HL7 messages that have not
"RTN","DGHTRTX",6,0)
 ;received an application acknowledgment. If it finds messages that
"RTN","DGHTRTX",7,0)
 ;have not received AAs, it will retransmit the HL7 messages up to the
"RTN","DGHTRTX",8,0)
 ;number of times defined in the "DG HTH # OF RETRANSMITS" parameter.
"RTN","DGHTRTX",9,0)
 ;If no AA is received after the 5th try an alert is sent to the
"RTN","DGHTRTX",10,0)
 ;DGHTERR mailgroup. After the 5th try an extended wait time is used
"RTN","DGHTRTX",11,0)
 ;(12 hours) and the process starts a new.
"RTN","DGHTRTX",12,0)
 ;
"RTN","DGHTRTX",13,0)
EN ;entry point from tasked option, $O thru home telehealth file
"RTN","DGHTRTX",14,0)
 ;(#391.31) "HTHNOACK" xref and find messages to retransmit
"RTN","DGHTRTX",15,0)
 N MSGID,NODE,STATUS,RECORD,TRANS,TYPE,ERROR,RETRANS,DTIME,XTIME
"RTN","DGHTRTX",16,0)
 N DGCOUNT,DGDATE,CNT
"RTN","DGHTRTX",17,0)
 S (MSGID,NODE,TRANS,ERROR)="",TYPE=1,CNT=0
"RTN","DGHTRTX",18,0)
 K ^TMP($J,"DGHT")
"RTN","DGHTRTX",19,0)
 ;Get number of allowed retransmissions from parameter file
"RTN","DGHTRTX",20,0)
 S RETRANS=$$GET^XPAR("SYS","DG HTH # OF RETRANSMITS")
"RTN","DGHTRTX",21,0)
 ;Get time interval parameters, convert them to seconds
"RTN","DGHTRTX",22,0)
 S DTIME=$$GET^XPAR("SYS","DG HTH DEFAULT WAIT TIME")*60
"RTN","DGHTRTX",23,0)
 S XTIME=$$GET^XPAR("SYS","DG HTH EXTENDED WAIT TIME")*60
"RTN","DGHTRTX",24,0)
 ;Resolve record to update using MSGID cross reference
"RTN","DGHTRTX",25,0)
 F  S MSGID=$O(^DGHT(391.31,"HTHNOACK",MSGID)) Q:MSGID=""  D
"RTN","DGHTRTX",26,0)
 .S RECORD=$O(^DGHT(391.31,"D",MSGID,0)) Q:'RECORD
"RTN","DGHTRTX",27,0)
 .S TRANS=$O(^DGHT(391.31,"D",MSGID,RECORD,0)) Q:'TRANS
"RTN","DGHTRTX",28,0)
 .S NODE=$G(^DGHT(391.31,"HTHNOACK",MSGID,RECORD,TRANS))
"RTN","DGHTRTX",29,0)
 .Q:NODE=""
"RTN","DGHTRTX",30,0)
 .S DGCOUNT=$P(NODE,U,1),DGDATE=$P(NODE,U,2)
"RTN","DGHTRTX",31,0)
 .;Check outgoing message status
"RTN","DGHTRTX",32,0)
 .;               0 = message doesn't exist
"RTN","DGHTRTX",33,0)
 .;               1 = waiting in queue
"RTN","DGHTRTX",34,0)
 .;             1.5 = opening connection
"RTN","DGHTRTX",35,0)
 .;             1.7 = awaiting response, # of retries
"RTN","DGHTRTX",36,0)
 .;               2 = awaiting application ack
"RTN","DGHTRTX",37,0)
 .;               3 = successfully completed
"RTN","DGHTRTX",38,0)
 .;               4 = error
"RTN","DGHTRTX",39,0)
 .;               8 = being generated
"RTN","DGHTRTX",40,0)
 .;               9 = awaiting processing
"RTN","DGHTRTX",41,0)
 .S STATUS=+$$MSGSTAT^HLUTIL(MSGID)
"RTN","DGHTRTX",42,0)
 .;If status=3 kill xref and quit
"RTN","DGHTRTX",43,0)
 .I STATUS=3 D KILLXREF^DGHTXREF(MSGID) Q
"RTN","DGHTRTX",44,0)
 .D CHKMSG
"RTN","DGHTRTX",45,0)
 I $O(^TMP($J,"DGHT",0)) D MESSAGE K ^TMP($J)
"RTN","DGHTRTX",46,0)
 Q
"RTN","DGHTRTX",47,0)
 ;
"RTN","DGHTRTX",48,0)
RTX ;Retransmit message
"RTN","DGHTRTX",49,0)
 N X,DGDATE
"RTN","DGHTRTX",50,0)
 S X=$$MSGACT^HLUTIL(MSGID,2)
"RTN","DGHTRTX",51,0)
 ;Update counter and trans date
"RTN","DGHTRTX",52,0)
 S DGDATE=$$NOW^XLFDT()
"RTN","DGHTRTX",53,0)
 D SETXREF^DGHTXREF(MSGID,1,1)
"RTN","DGHTRTX",54,0)
 Q
"RTN","DGHTRTX",55,0)
 ;
"RTN","DGHTRTX",56,0)
MESSAGE ;Build bulletin and send to mail group
"RTN","DGHTRTX",57,0)
 ;      Input: Home telehealth patient record
"RTN","DGHTRTX",58,0)
 ;      Output:
"RTN","DGHTRTX",59,0)
 ;
"RTN","DGHTRTX",60,0)
 N MSGTEXT,XMTEXT,XMSUB,XMY,XMCHAN,XMZ,XMDUZ,MSGTYPE,NODE0,NODE1
"RTN","DGHTRTX",61,0)
 N RECORD,TNODE
"RTN","DGHTRTX",62,0)
 ;Get records from ^tmp global
"RTN","DGHTRTX",63,0)
 S (RECORD,CNT)=0 F  S RECORD=$O(^TMP($J,"DGHT",RECORD)) Q:'RECORD  D
"RTN","DGHTRTX",64,0)
 .S TRANS=0 F  S TRANS=$O(^TMP($J,"DGHT",RECORD,TRANS)) Q:'TRANS  D
"RTN","DGHTRTX",65,0)
 ..S TNODE=^TMP($J,"DGHT",RECORD,TRANS)
"RTN","DGHTRTX",66,0)
 ..S MSGID=$P(TNODE,U,2),ERROR=$P(TNODE,U,2)
"RTN","DGHTRTX",67,0)
 ..;Get 0th node and trans nodes
"RTN","DGHTRTX",68,0)
 ..S NODE0=$G(^DGHT(391.31,RECORD,0))
"RTN","DGHTRTX",69,0)
 ..S NODE1=$G(^DGHT(391.31,RECORD,"TRAN",TRANS,0)),MSGTYPE=$P(NODE1,U,4)
"RTN","DGHTRTX",70,0)
 ..S MSGTYPE=$S(MSGTYPE="A":"Sign-up/Activation",MSGTYPE="I":"Inactivation",1:""),CNT=CNT+1
"RTN","DGHTRTX",71,0)
 ..S MSGTEXT(CNT)="Home Telehealth "_MSGTYPE_" was REJECTED",CNT=CNT+1
"RTN","DGHTRTX",72,0)
 ..S MSGTEXT(CNT)=" ",CNT=CNT+1
"RTN","DGHTRTX",73,0)
 ..S MSGTEXT(CNT)="Date:       "_$$FMTE^XLFDT($$NOW^XLFDT(),1),CNT=CNT+1
"RTN","DGHTRTX",74,0)
 ..S MSGTEXT(CNT)="Patient:    "_$$GET1^DIQ(2,$P(NODE0,U,2),.01,"E")
"RTN","DGHTRTX",75,0)
 ..S CNT=CNT+1,MSGTEXT(CNT+1)="Message ID: "_MSGID,CNT=CNT+1
"RTN","DGHTRTX",76,0)
 ..S MSGTEXT(CNT)="Error Code: "_ERROR,CNT=CNT+1
"RTN","DGHTRTX",77,0)
 ..S MSGTEXT(CNT)="",CNT=CNT+1
"RTN","DGHTRTX",78,0)
 ..S MSGTEXT(CNT)="Message ID:        "_$P(TNODE,U,1),CNT=CNT+1
"RTN","DGHTRTX",79,0)
 ..S MSGTEXT(CNT)="Activation Date:   "_$$GET1^DIQ(391.31,RECORD,5),CNT=CNT+1
"RTN","DGHTRTX",80,0)
 ..S MSGTEXT(CNT)="Vendor:            "_$$GET1^DIQ(391.31,RECORD,2),CNT=CNT+1
"RTN","DGHTRTX",81,0)
 ;Send message to mail group
"RTN","DGHTRTX",82,0)
 S XMSUB="Home Telehealth Patient "_MSGTYPE_" Reject"
"RTN","DGHTRTX",83,0)
 S XMTEXT="MSGTEXT("
"RTN","DGHTRTX",84,0)
 S XMY("G.DGHTERR")=""
"RTN","DGHTRTX",85,0)
 S XMCHAN=1
"RTN","DGHTRTX",86,0)
 S XMDUZ="Home Telehealth Patient "_MSGTYPE
"RTN","DGHTRTX",87,0)
 D ^XMD
"RTN","DGHTRTX",88,0)
 Q
"RTN","DGHTRTX",89,0)
 ;
"RTN","DGHTRTX",90,0)
CHKMSG ;Check message for retransmission
"RTN","DGHTRTX",91,0)
 N DIFF
"RTN","DGHTRTX",92,0)
 S DIFF=$$FMDIFF^XLFDT($$NOW^XLFDT(),DGDATE,2)
"RTN","DGHTRTX",93,0)
 I DGCOUNT<RETRANS D  Q
"RTN","DGHTRTX",94,0)
 .I DIFF>DTIME D RTX I (DGCOUNT+1)=RETRANS D  Q
"RTN","DGHTRTX",95,0)
 ..S ERROR=$S('STATUS:"HL7 MESSAGE DOES NOT EXIST. REQUIRES MANUAL RETRANSMISSION",1:"DEFAULT MAXIMUM RETRANSMISSIONS REACHED")
"RTN","DGHTRTX",96,0)
 ..S ^TMP($J,"DGHT",RECORD,TRANS)=MSGID_U_ERROR
"RTN","DGHTRTX",97,0)
 I DIFF>XTIME S DGCOUNT=0 D RTX Q
"RTN","DGHTRTX",98,0)
 Q
"VER")
8.0^22.0
"BLD",9498,6)
^788
**END**
**END**

