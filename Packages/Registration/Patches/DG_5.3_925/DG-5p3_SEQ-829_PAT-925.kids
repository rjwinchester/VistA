Released DG*5.3*925 SEQ #829
Extracted from mail message
**KIDS**:DG*5.3*925^

**INSTALL NAME**
DG*5.3*925
"BLD",9920,0)
DG*5.3*925^REGISTRATION^0^3170609^y
"BLD",9920,4,0)
^9.64PA^^
"BLD",9920,6)
2^
"BLD",9920,6.3)
15
"BLD",9920,"ABPKG")
n
"BLD",9920,"KRN",0)
^9.67PA^779.2^20
"BLD",9920,"KRN",.4,0)
.4
"BLD",9920,"KRN",.4,"NM",0)
^9.68A^^
"BLD",9920,"KRN",.401,0)
.401
"BLD",9920,"KRN",.402,0)
.402
"BLD",9920,"KRN",.403,0)
.403
"BLD",9920,"KRN",.5,0)
.5
"BLD",9920,"KRN",.5,"NM",0)
^9.68A^^
"BLD",9920,"KRN",.84,0)
.84
"BLD",9920,"KRN",3.6,0)
3.6
"BLD",9920,"KRN",3.8,0)
3.8
"BLD",9920,"KRN",9.2,0)
9.2
"BLD",9920,"KRN",9.8,0)
9.8
"BLD",9920,"KRN",9.8,"NM",0)
^9.68A^5^4
"BLD",9920,"KRN",9.8,"NM",1,0)
DGRP1^^0^B40910302
"BLD",9920,"KRN",9.8,"NM",2,0)
DGRPD^^0^B71290433
"BLD",9920,"KRN",9.8,"NM",4,0)
DGADDUTL^^0^B59041473
"BLD",9920,"KRN",9.8,"NM",5,0)
DGADDUT2^^0^B7195938
"BLD",9920,"KRN",9.8,"NM","B","DGADDUT2",5)

"BLD",9920,"KRN",9.8,"NM","B","DGADDUTL",4)

"BLD",9920,"KRN",9.8,"NM","B","DGRP1",1)

"BLD",9920,"KRN",9.8,"NM","B","DGRPD",2)

"BLD",9920,"KRN",19,0)
19
"BLD",9920,"KRN",19,"NM",0)
^9.68A^^
"BLD",9920,"KRN",19.1,0)
19.1
"BLD",9920,"KRN",101,0)
101
"BLD",9920,"KRN",409.61,0)
409.61
"BLD",9920,"KRN",771,0)
771
"BLD",9920,"KRN",779.2,0)
779.2
"BLD",9920,"KRN",870,0)
870
"BLD",9920,"KRN",8989.51,0)
8989.51
"BLD",9920,"KRN",8989.52,0)
8989.52
"BLD",9920,"KRN",8994,0)
8994
"BLD",9920,"KRN","B",.4,.4)

"BLD",9920,"KRN","B",.401,.401)

"BLD",9920,"KRN","B",.402,.402)

"BLD",9920,"KRN","B",.403,.403)

"BLD",9920,"KRN","B",.5,.5)

"BLD",9920,"KRN","B",.84,.84)

"BLD",9920,"KRN","B",3.6,3.6)

"BLD",9920,"KRN","B",3.8,3.8)

"BLD",9920,"KRN","B",9.2,9.2)

"BLD",9920,"KRN","B",9.8,9.8)

"BLD",9920,"KRN","B",19,19)

"BLD",9920,"KRN","B",19.1,19.1)

"BLD",9920,"KRN","B",101,101)

"BLD",9920,"KRN","B",409.61,409.61)

"BLD",9920,"KRN","B",771,771)

"BLD",9920,"KRN","B",779.2,779.2)

"BLD",9920,"KRN","B",870,870)

"BLD",9920,"KRN","B",8989.51,8989.51)

"BLD",9920,"KRN","B",8989.52,8989.52)

"BLD",9920,"KRN","B",8994,8994)

"BLD",9920,"QDEF")
^^^^NO^^^^NO^^NO
"BLD",9920,"QUES",0)
^9.62^^
"BLD",9920,"REQB",0)
^9.611^3^2
"BLD",9920,"REQB",2,0)
DG*5.3*907^1
"BLD",9920,"REQB",3,0)
DG*5.3*915^1
"BLD",9920,"REQB","B","DG*5.3*907",2)

"BLD",9920,"REQB","B","DG*5.3*915",3)

"MBREQ")
0
"PKG",47,-1)
1^1
"PKG",47,0)
REGISTRATION^DG^PATIENT REGISTRATION, ADMISSION, DISCHARGE, EMBOSSER 
"PKG",47,20,0)
^9.402P^^
"PKG",47,22,0)
^9.49I^1^1
"PKG",47,22,1,0)
5.3^2930813^2960613
"PKG",47,22,1,"PAH",1,0)
925^3170609^101056
"PKG",47,22,1,"PAH",1,1,0)
^^7^7^3170609
"PKG",47,22,1,"PAH",1,1,1,0)
The following enhancements are included in this patch:
"PKG",47,22,1,"PAH",1,1,2,0)
Adding EDIPI to header line
"PKG",47,22,1,"PAH",1,1,3,0)
Display Health Benefit Plans Currently Assigned to Veteran
"PKG",47,22,1,"PAH",1,1,4,0)
Changed label Permanent Address to Mailing Address
"PKG",47,22,1,"PAH",1,1,5,0)
Changed label Temporary Address to Temporary Mailing Address
"PKG",47,22,1,"PAH",1,1,6,0)
Display Residential Address
"PKG",47,22,1,"PAH",1,1,7,0)
Expanded Health Benefit Plan details
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
4
"RTN","DGADDUT2")
0^5^B7195938^B7090344
"RTN","DGADDUT2",1,0)
DGADDUT2 ;ALB/ERC,CKN,LBD - CONTINUATION OF ADDRESS UTILITIES ; 2/27/12 4:26pm
"RTN","DGADDUT2",2,0)
 ;;5.3;Registration;**688,851,925**; AUG 13, 1993;Build 15
"RTN","DGADDUT2",3,0)
 ;a continuation of utilities from DGADDUTL
"RTN","DGADDUT2",4,0)
 ;
"RTN","DGADDUT2",5,0)
UPDDTTM(DFN,TYPE) ; Update the PATIENT file #2 with the current date and time
"RTN","DGADDUT2",6,0)
 ;
"RTN","DGADDUT2",7,0)
 N %H,%,X,%Y,%D,%M,%I,ADDDTTM,DIE,DA,DR
"RTN","DGADDUT2",8,0)
 D NOW^%DTC
"RTN","DGADDUT2",9,0)
 S ADDDTTM=%,DIE="^DPT(",DA=DFN
"RTN","DGADDUT2",10,0)
 ;
"RTN","DGADDUT2",11,0)
 ; If it's the Temporary Address, the field is .12113
"RTN","DGADDUT2",12,0)
 ; If not, it should be the Permanent Address and the default field is .118
"RTN","DGADDUT2",13,0)
 S DR=$S(TYPE="TEMP":".12113///^S X=ADDDTTM",1:".118///^S X=ADDDTTM")
"RTN","DGADDUT2",14,0)
 D ^DIE
"RTN","DGADDUT2",15,0)
 Q
"RTN","DGADDUT2",16,0)
UPDADDLG(DFN,DGPRIOR,DGINPUT) ; Update the IVM ADDRESS CHANGE LOG file #301.7
"RTN","DGADDUT2",17,0)
 ;
"RTN","DGADDUT2",18,0)
 N DGDATA
"RTN","DGADDUT2",19,0)
 ; Zero node:
"RTN","DGADDUT2",20,0)
 S DGDATA(.01)=DGINPUT(.118)
"RTN","DGADDUT2",21,0)
 S DGDATA(1)=DFN
"RTN","DGADDUT2",22,0)
 S DGDATA(2)=DGINPUT(.122)
"RTN","DGADDUT2",23,0)
 S DGDATA(3)=DGINPUT(.119)
"RTN","DGADDUT2",24,0)
 S DGDATA(3.5)=DGINPUT(.12)
"RTN","DGADDUT2",25,0)
 ;
"RTN","DGADDUT2",26,0)
 ; One node:
"RTN","DGADDUT2",27,0)
 S DGDATA(4)=DGPRIOR(.118)
"RTN","DGADDUT2",28,0)
 S DGDATA(5)=DGPRIOR(.122)
"RTN","DGADDUT2",29,0)
 S DGDATA(6)=DGPRIOR(.12)
"RTN","DGADDUT2",30,0)
 S DGDATA(7)=DGPRIOR(.119)
"RTN","DGADDUT2",31,0)
 S DGDATA(8)=DGPRIOR(.131)
"RTN","DGADDUT2",32,0)
 S DGDATA(9)=DGPRIOR(.111)
"RTN","DGADDUT2",33,0)
 S DGDATA(10)=DGPRIOR(.112)
"RTN","DGADDUT2",34,0)
 S DGDATA(11)=DGPRIOR(.114)
"RTN","DGADDUT2",35,0)
 S DGDATA(12)=DGPRIOR(.117)
"RTN","DGADDUT2",36,0)
 S DGDATA(13)=DGPRIOR(.115)
"RTN","DGADDUT2",37,0)
 S DGDATA(14)=DGPRIOR(.1112)
"RTN","DGADDUT2",38,0)
 S DGDATA(15)=DGPRIOR(.1171)
"RTN","DGADDUT2",39,0)
 S DGDATA(16)=DGPRIOR(.1172)
"RTN","DGADDUT2",40,0)
 S DGDATA(17)=DGPRIOR(.1173)
"RTN","DGADDUT2",41,0)
 S DGDATA(18)=DGPRIOR(.121)
"RTN","DGADDUT2",42,0)
 S DGDATA(19)=DGPRIOR(.113)
"RTN","DGADDUT2",43,0)
 ;
"RTN","DGADDUT2",44,0)
 I $$ADD^DGENDBS(301.7,,.DGDATA) ;
"RTN","DGADDUT2",45,0)
 Q
"RTN","DGADDUT2",46,0)
CNTRY(DGARR) ;
"RTN","DGADDUT2",47,0)
 ;where DGARR is an array of values which includes a node for "CNTRY"
"RTN","DGADDUT2",48,0)
 ;DGARR("CNTRY") is returned in upper case display mode
"RTN","DGADDUT2",49,0)
 ;called from DGREGARP
"RTN","DGADDUT2",50,0)
 N DGC
"RTN","DGADDUT2",51,0)
 S DGC=$G(DGARR("CNTRY"))
"RTN","DGADDUT2",52,0)
 I '$D(^HL(779.004,"B",DGC)) Q ""
"RTN","DGADDUT2",53,0)
 S DGC=$$COUNTRY^DGADDUTL(DGC)
"RTN","DGADDUT2",54,0)
 S DGARR("CNTRY")=DGC
"RTN","DGADDUT2",55,0)
 Q
"RTN","DGADDUT2",56,0)
 ;
"RTN","DGADDUT2",57,0)
DISPADD(DFN) ;Display Permanent Address (DG*5.3*851)
"RTN","DGADDUT2",58,0)
 Q:'$G(DFN)
"RTN","DGADDUT2",59,0)
 N DGRP,DGA1,DGA2,DGA,DGAD,DGI,DGCC,DGUN,FOR
"RTN","DGADDUT2",60,0)
 ;Get current address & phone data
"RTN","DGADDUT2",61,0)
 S DGRP(.11)=$G(^DPT(DFN,.11)),DGRP(.13)=$G(^DPT(DFN,.13))
"RTN","DGADDUT2",62,0)
 S DGUN="UNANSWERED"
"RTN","DGADDUT2",63,0)
 ;Format address data
"RTN","DGADDUT2",64,0)
 S DGAD=.11,(DGA1,DGA2)=1 D A^DGRPU
"RTN","DGADDUT2",65,0)
 ;Display address
"RTN","DGADDUT2",66,0)
 ;jam DG*5.3*925 RM#788099 Add/Edit Residential Address - change label to Permanent Mailing Address:
"RTN","DGADDUT2",67,0)
 W !!," Permanent Mailing Address: "
"RTN","DGADDUT2",68,0)
 W !,?11,$S($D(DGA(1)):DGA(1),1:"NONE ON FILE")
"RTN","DGADDUT2",69,0)
 S DGI=1 F  S DGI=$O(DGA(DGI)) Q:'DGI  W !,?11,DGA(DGI)
"RTN","DGADDUT2",70,0)
 ; only print county info if it's a US address
"RTN","DGADDUT2",71,0)
 I '$$FORIEN^DGADDUTL($P(DGRP(.11),U,10)) D
"RTN","DGADDUT2",72,0)
 . S DGCC=$S($D(^DIC(5,+$P(DGRP(.11),U,5),1,+$P(DGRP(.11),U,7),0)):$E($P(^(0),U,1),1,20)_$S($P(^(0),U,3)]"":" ("_$P(^(0),U,3)_")",1:""),1:DGUN)
"RTN","DGADDUT2",73,0)
 S DGCC=$S($G(DGCC)]"":"County: "_DGCC,1:"")
"RTN","DGADDUT2",74,0)
 W !?3,DGCC
"RTN","DGADDUT2",75,0)
 ;Display phone numbers
"RTN","DGADDUT2",76,0)
 W !?4,"Phone: ",$S($P(DGRP(.13),U,1)]"":$P(DGRP(.13),U,1),1:DGUN)
"RTN","DGADDUT2",77,0)
 W !?3,"Office: ",$S($P(DGRP(.13),U,2)]"":$P(DGRP(.13),U,2),1:DGUN)
"RTN","DGADDUT2",78,0)
 ;Display Bad Address Indicator
"RTN","DGADDUT2",79,0)
 W !?1,"Bad Addr: ",$$EXTERNAL^DILFD(2,.121,"",$P(DGRP(.11),U,16))
"RTN","DGADDUT2",80,0)
 Q
"RTN","DGADDUTL")
0^4^B59041473^B57517976
"RTN","DGADDUTL",1,0)
DGADDUTL ;ALB/PHH,EG,BAJ,ERC,CKN,TDM,LBD-PATIENT ADDRESS ; 8/19/13 11:13am
"RTN","DGADDUTL",2,0)
 ;;5.3;Registration;**658,695,730,688,808,851,872,915,925**;Aug 13, 1993;Build 15
"RTN","DGADDUTL",3,0)
 Q
"RTN","DGADDUTL",4,0)
ADDR ; validate/edit Patient address (entry for DG ADDRESS UPDATE option)
"RTN","DGADDUTL",5,0)
 N %,QUIT,DIC,Y,DFN,USERSEL
"RTN","DGADDUTL",6,0)
ADDRLOOP ;
"RTN","DGADDUTL",7,0)
 W !!
"RTN","DGADDUTL",8,0)
 K DIC,Y,DFN,USERSEL
"RTN","DGADDUTL",9,0)
 S DIC="^DPT(",DIC(0)="AEMZQ",DIC("A")="Veteran Name/SSN: " D ^DIC
"RTN","DGADDUTL",10,0)
 I $D(DTOUT)!($D(DUOUT)) Q
"RTN","DGADDUTL",11,0)
 Q:Y'>0
"RTN","DGADDUTL",12,0)
 ;
"RTN","DGADDUTL",13,0)
 S DFN=+Y,QUIT=0
"RTN","DGADDUTL",14,0)
 L +^DPT(DFN):3 E  W !!,"Patient is being edited. Try again later."  G ADDR
"RTN","DGADDUTL",15,0)
 F  D  Q:QUIT
"RTN","DGADDUTL",16,0)
 .W !!,"Do you want to update the (P)ermanent Address, (T)emporary Address, or (B)oth? "
"RTN","DGADDUTL",17,0)
 .R USERSEL:300
"RTN","DGADDUTL",18,0)
 .I '$T S USERSEL="^"
"RTN","DGADDUTL",19,0)
 .I USERSEL["^"!(USERSEL="") S QUIT=1 Q
"RTN","DGADDUTL",20,0)
 .S USERSEL=$TR(USERSEL,"ptb","PTB")
"RTN","DGADDUTL",21,0)
 .I USERSEL'="P",USERSEL'="T",USERSEL'="B" D  Q
"RTN","DGADDUTL",22,0)
 ..W !,"Invalid selection!"
"RTN","DGADDUTL",23,0)
 .I USERSEL="P"!(USERSEL="B") W ! D UPDATE(DFN,"PERM")
"RTN","DGADDUTL",24,0)
 .I USERSEL="T"!(USERSEL="B") D UPDATE(DFN,"TEMP")
"RTN","DGADDUTL",25,0)
 .S QUIT=1
"RTN","DGADDUTL",26,0)
 L -^DPT(DFN)
"RTN","DGADDUTL",27,0)
 G ADDRLOOP
"RTN","DGADDUTL",28,0)
ADD(DFN) ; validate/edit Patient address (entry point for routine DGREG)
"RTN","DGADDUTL",29,0)
 ;         Input  -- DFN
"RTN","DGADDUTL",30,0)
 ;
"RTN","DGADDUTL",31,0)
 N RETVAL,ADDYN
"RTN","DGADDUTL",32,0)
 ;Display the permanent address (DG*5.3*851)
"RTN","DGADDUTL",33,0)
 D DISPADD^DGADDUT2(DFN)
"RTN","DGADDUTL",34,0)
 S (RETVAL,ADDYN)=0
"RTN","DGADDUTL",35,0)
 F  D  Q:ADDYN
"RTN","DGADDUTL",36,0)
 .;jam DG*5.3*925 RM#788099 Add/Edit Residential address - Change prompt to Permanent Mailing Address:
"RTN","DGADDUTL",37,0)
 .S ADDYN=$$ADDYN("Do you want to edit the Patient's Permanent Mailing Address")
"RTN","DGADDUTL",38,0)
 .S RETVAL=ADDYN
"RTN","DGADDUTL",39,0)
 .I ADDYN'=1,ADDYN'=2 S (ADDYN,RETVAL)=0
"RTN","DGADDUTL",40,0)
 .I 'ADDYN W !?5,"Enter 'YES' to edit Patient's Address or 'NO' to continue."
"RTN","DGADDUTL",41,0)
 I ADDYN=1,$G(DFN)'="",$D(^DPT(DFN,0)) D
"RTN","DGADDUTL",42,0)
 .D UPDATE(DFN,"PERM")
"RTN","DGADDUTL",43,0)
 .S RETVAL=1
"RTN","DGADDUTL",44,0)
 Q RETVAL
"RTN","DGADDUTL",45,0)
ADDYN(PROMPT) ; Yes/No Prompt to Edit/Validate Address
"RTN","DGADDUTL",46,0)
 ;         Input  -- None
"RTN","DGADDUTL",47,0)
 ;         Output --  1 = YES
"RTN","DGADDUTL",48,0)
 ;                    2 = NO
"RTN","DGADDUTL",49,0)
 ;                   -1 = Aborted
"RTN","DGADDUTL",50,0)
 ;
"RTN","DGADDUTL",51,0)
 N %
"RTN","DGADDUTL",52,0)
 W !,PROMPT
"RTN","DGADDUTL",53,0)
 D YN^DICN
"RTN","DGADDUTL",54,0)
 Q %
"RTN","DGADDUTL",55,0)
UPDATE(DFN,TYPE) ; Update the Address
"RTN","DGADDUTL",56,0)
 ;         Input  -- TYPE = "PERM" for Permanent Address
"RTN","DGADDUTL",57,0)
 ;                        = "TEMP" for Temporary Address
"RTN","DGADDUTL",58,0)
 ;         Output -- None
"RTN","DGADDUTL",59,0)
 ;         
"RTN","DGADDUTL",60,0)
 I TYPE'="PERM",TYPE'="TEMP" Q
"RTN","DGADDUTL",61,0)
 I TYPE="PERM" D
"RTN","DGADDUTL",62,0)
 .W !
"RTN","DGADDUTL",63,0)
 .N FLG S (FLG(1),FLG(2))=1
"RTN","DGADDUTL",64,0)
 .D ADDRED(DFN,.FLG)
"RTN","DGADDUTL",65,0)
 ;
"RTN","DGADDUTL",66,0)
 I TYPE="TEMP" D
"RTN","DGADDUTL",67,0)
 .D EDITTADR(DFN)
"RTN","DGADDUTL",68,0)
 Q
"RTN","DGADDUTL",69,0)
UPDDTTM(DFN,TYPE) ; Update the PATIENT file #2 with the current date and time
"RTN","DGADDUTL",70,0)
 ;
"RTN","DGADDUTL",71,0)
 D UPDDTTM^DGADDUT2(DFN,TYPE)
"RTN","DGADDUTL",72,0)
 Q
"RTN","DGADDUTL",73,0)
ADDRED(DFN,FLG) ; Address Edit (Code copied from DGREGAED and modified)
"RTN","DGADDUTL",74,0)
 ;Input:
"RTN","DGADDUTL",75,0)
 ;  DFN (required) - Internal Entry # of Patient File (#2)
"RTN","DGADDUTL",76,0)
 ;  FLG (optional) - Flags of 1 or 0; if null, 0 is assumed. Details:
"RTN","DGADDUTL",77,0)
 ;    FLG(1) - if 1, let user edit phone numbers (field #.131 and #.132)
"RTN","DGADDUTL",78,0)
 ;    FLG(2) - if 1, display before & after address for user confirmation
"RTN","DGADDUTL",79,0)
 N SRC,%,DGINPUT,I,X,Y
"RTN","DGADDUTL",80,0)
 S SRC="ADDUTL"
"RTN","DGADDUTL",81,0)
 D EN^DGREGAED(DFN,.FLG,SRC)
"RTN","DGADDUTL",82,0)
 ;
"RTN","DGADDUTL",83,0)
 ; Update the Date/Time Stamp
"RTN","DGADDUTL",84,0)
 ;The next line was disabled to fix problem of Date/Time stamp being
"RTN","DGADDUTL",85,0)
 ;updated even if no changes were made (DG*5.3*851).
"RTN","DGADDUTL",86,0)
 ;D UPDDTTM(DFN,TYPE)
"RTN","DGADDUTL",87,0)
 Q
"RTN","DGADDUTL",88,0)
GETPRIOR(DFN,DGPRIOR) ; Get prior address fields.
"RTN","DGADDUTL",89,0)
 N DGCURR,DGN,DGARRY,DGCIEN,DGST,DGCNTY
"RTN","DGADDUTL",90,0)
 D GETS^DIQ(2,DFN_",",".111;.112;.113;.114;.115;.117;.1112;.131;.132;.121;.118;.119;.12;.122;.1171:.1173","I","DGCURR")
"RTN","DGADDUTL",91,0)
 F DGN=.111,.112,.113,.114,.115,.117,.1112,.131,.132,.121,.118,.119,.12,.122,.1171,.1172,.1173 D
"RTN","DGADDUTL",92,0)
 . S DGARRY("OLD",DGN)=$G(DGCURR(2,DFN_",",DGN,"I"))
"RTN","DGADDUTL",93,0)
 M DGPRIOR=DGARRY("OLD")
"RTN","DGADDUTL",94,0)
 Q
"RTN","DGADDUTL",95,0)
GETUPDTS(DFN,DGINPUT) ; Get current address fields.
"RTN","DGADDUTL",96,0)
 N DGCURR,DGN,DGARRY
"RTN","DGADDUTL",97,0)
 D GETS^DIQ(2,DFN_",",".118;.119;.12;.122","I","DGCURR")
"RTN","DGADDUTL",98,0)
 F DGN=.118,.119,.12,.122 D
"RTN","DGADDUTL",99,0)
 . S DGARRY("NEW",DGN)=$G(DGCURR(2,DFN_",",DGN,"I"))
"RTN","DGADDUTL",100,0)
 M DGINPUT=DGARRY("NEW")
"RTN","DGADDUTL",101,0)
 Q
"RTN","DGADDUTL",102,0)
FILEYN(DGOLD,DGNEW) ; Determine whether or not to file to #301.7
"RTN","DGADDUTL",103,0)
 N RETVAL
"RTN","DGADDUTL",104,0)
 S RETVAL=0
"RTN","DGADDUTL",105,0)
 D
"RTN","DGADDUTL",106,0)
 .I DGOLD(.111)'=$G(DGNEW(.111)) S RETVAL=1 Q
"RTN","DGADDUTL",107,0)
 .I DGOLD(.112)'=$G(DGNEW(.112)) S RETVAL=1 Q
"RTN","DGADDUTL",108,0)
 .I DGOLD(.113)'=$G(DGNEW(.113)) S RETVAL=1 Q
"RTN","DGADDUTL",109,0)
 .I DGOLD(.114)'=$G(DGNEW(.114)) S RETVAL=1 Q
"RTN","DGADDUTL",110,0)
 .I DGOLD(.115)'=$P($G(DGNEW(.115)),"^",2) S RETVAL=1 Q
"RTN","DGADDUTL",111,0)
 .I DGOLD(.1112)'=$G(DGNEW(.1112)) S RETVAL=1 Q
"RTN","DGADDUTL",112,0)
 .I DGOLD(.117)'=$P($G(DGNEW(.117)),"^",2) S RETVAL=1 Q
"RTN","DGADDUTL",113,0)
 .I DGOLD(.131)'=$G(DGNEW(.131)) S RETVAL=1 Q
"RTN","DGADDUTL",114,0)
 .I DGOLD(.1171)'=$G(DGNEW(.1171)) S RETVAL=1 Q
"RTN","DGADDUTL",115,0)
 .I DGOLD(.1172)'=$G(DGNEW(.1172)) S RETVAL=1 Q
"RTN","DGADDUTL",116,0)
 .I DGOLD(.1173)'=$P($G(DGNEW(.1173)),"^",2) S RETVAL=1 Q
"RTN","DGADDUTL",117,0)
 .I DGOLD(.121)'=$G(DGNEW(.121)) S RETVAL=1 Q
"RTN","DGADDUTL",118,0)
 Q RETVAL
"RTN","DGADDUTL",119,0)
FOREIGN(DFN,CIEN,FILE,FIELD,COUNTRY) ;
"RTN","DGADDUTL",120,0)
 ; ** NOTE we have to default the value for "US" into the prompt if it is blank
"RTN","DGADDUTL",121,0)
 N FORGN,DA,DIR,DTOUT,DUOUT,DIROUT,DONE,INDX
"RTN","DGADDUTL",122,0)
 S:'$G(FILE) FILE=2  I '$G(FIELD) S FIELD=.1173
"RTN","DGADDUTL",123,0)
 S DIR(0)=FILE_","_FIELD,DONE=0 S:DFN DA=DFN
"RTN","DGADDUTL",124,0)
 S DIR("B")=$E($$CNTRYI^DGADDUTL(CIEN),1,19) I DIR("B")=-1 S DIR("B")="UNKNOWN COUNTRY"
"RTN","DGADDUTL",125,0)
 F  D  Q:DONE
"RTN","DGADDUTL",126,0)
 . D ^DIR
"RTN","DGADDUTL",127,0)
 . I $D(DTOUT) S DONE=1,FORGN=-1 Q
"RTN","DGADDUTL",128,0)
 . I $D(DUOUT)!$D(DIROUT) W !,"EXIT NOT ALLOWED" Q
"RTN","DGADDUTL",129,0)
 . I $D(DIRUT) W !,"This is a required response." Q
"RTN","DGADDUTL",130,0)
 . S COUNTRY=$P($G(Y),"^",2),FORGN=$$FORIEN($P($G(Y),"^")),DONE=1
"RTN","DGADDUTL",131,0)
 Q FORGN
"RTN","DGADDUTL",132,0)
UPDADDLG(DFN,DGPRIOR,DGINPUT) ; Update the IVM ADDRESS CHANGE LOG file #301.7
"RTN","DGADDUTL",133,0)
 ;
"RTN","DGADDUTL",134,0)
 D UPDADDLG^DGADDUT2(DFN,.DGPRIOR,.DGINPUT)
"RTN","DGADDUTL",135,0)
 Q
"RTN","DGADDUTL",136,0)
EDITTADR(DFN) ; Edit Temporary Address
"RTN","DGADDUTL",137,0)
 N DGPRIOR,DGCH,DGRPAN,DGDR,DGRPS
"RTN","DGADDUTL",138,0)
 I $G(DFN)="" Q
"RTN","DGADDUTL",139,0)
 ;I ($G(DFN)'?.N) Q
"RTN","DGADDUTL",140,0)
 ;
"RTN","DGADDUTL",141,0)
 ; Get the current Temporary Address and display it
"RTN","DGADDUTL",142,0)
 D GETTADR(DFN,.DGPRIOR)
"RTN","DGADDUTL",143,0)
 D DISPTADR(DFN,.DGPRIOR)
"RTN","DGADDUTL",144,0)
 W !!
"RTN","DGADDUTL",145,0)
 ;
"RTN","DGADDUTL",146,0)
 S DGCH=5,DGRPAN="1,2,3,4,5,",DGDR="",DGRPS=1
"RTN","DGADDUTL",147,0)
 D CHOICE^DGRPP
"RTN","DGADDUTL",148,0)
 D ^DGRPE
"RTN","DGADDUTL",149,0)
 ; Update the Date/Time Stamp
"RTN","DGADDUTL",150,0)
 D UPDDTTM(DFN,TYPE)
"RTN","DGADDUTL",151,0)
 Q
"RTN","DGADDUTL",152,0)
GETTADR(DFN,DGPRIOR) ; Get prior temporary address fields.
"RTN","DGADDUTL",153,0)
 N DGCURR,DGN,DGARRY,DGCIEN,DGST,DGCNTY
"RTN","DGADDUTL",154,0)
 D GETS^DIQ(2,DFN_",",".1211;.1212;.1213;.1214;.1215;.1216;.1217;.1218;.12105;.1219;.12111;.12112;.12113;.12114;.1221:.1223","I","DGCURR")
"RTN","DGADDUTL",155,0)
 F DGN=.1211,.1212,.1213,.1214,.1215,.1216,.1217,.1218,.12105,.1219,.12111,.12112,.12113,.12114,.1221,.1222,.1223 D
"RTN","DGADDUTL",156,0)
 .S DGARRY("OLD",DGN)=$G(DGCURR(2,DFN_",",DGN,"I"))
"RTN","DGADDUTL",157,0)
 M DGPRIOR=DGARRY("OLD")
"RTN","DGADDUTL",158,0)
 Q
"RTN","DGADDUTL",159,0)
DISPTADR(DFN,DGARRY) ; Display Temporary Address
"RTN","DGADDUTL",160,0)
 N DGADRACT,DGADR1,DGADR2,DGADR3,DGCITY,DGSTATE,DGZIP
"RTN","DGADDUTL",161,0)
 N DGCOUNTY,DGPHONE,DGFROMDT,DGTODT,DGPROV,DGPCODE,DGCNTRY,DGFORN
"RTN","DGADDUTL",162,0)
 ;
"RTN","DGADDUTL",163,0)
 S DGADRACT=$G(DGARRY(.12105))
"RTN","DGADDUTL",164,0)
 S DGADR1=$G(DGARRY(.1211))
"RTN","DGADDUTL",165,0)
 S DGADR2=$G(DGARRY(.1212))
"RTN","DGADDUTL",166,0)
 S DGADR3=$G(DGARRY(.1213))
"RTN","DGADDUTL",167,0)
 S DGCITY=$G(DGARRY(.1214))
"RTN","DGADDUTL",168,0)
 S DGSTATE=$G(DGARRY(.1215))
"RTN","DGADDUTL",169,0)
 S DGZIP=$G(DGARRY(.1216))
"RTN","DGADDUTL",170,0)
 S DGCOUNTY=$G(DGARRY(.12111))
"RTN","DGADDUTL",171,0)
 I DGCOUNTY'="",DGSTATE'="",$D(^DIC(5,DGSTATE,1,DGCOUNTY,0)) D
"RTN","DGADDUTL",172,0)
 .S DGCOUNTY=$P(^DIC(5,DGSTATE,1,DGCOUNTY,0),"^")_$S($P(^DIC(5,DGSTATE,1,DGCOUNTY,0),"^",4)'="":"("_$P(^DIC(5,DGSTATE,1,DGCOUNTY,0),"^",4)_")",1:"")
"RTN","DGADDUTL",173,0)
 ;changing to remove display of empty (), will only display if a code is in the 4th piece of the state file-Patch 872
"RTN","DGADDUTL",174,0)
 ;S DGCOUNTY=$P(^DIC(5,DGSTATE,1,DGCOUNTY,0),"^")_"( "_$P(^DIC(5,DGSTATE,1,DGCOUNTY,0),"^",4)
"RTN","DGADDUTL",175,0)
 I DGADRACT'="Y" S DGCOUNTY="NOT APPLICABLE"
"RTN","DGADDUTL",176,0)
 I DGSTATE'="",$D(^DIC(5,DGSTATE,0)) S DGSTATE=$P(^DIC(5,DGSTATE,0),"^",2)
"RTN","DGADDUTL",177,0)
 S DGPROV=$G(DGARRY(.1221))
"RTN","DGADDUTL",178,0)
 S DGPCODE=$G(DGARRY(.1222))
"RTN","DGADDUTL",179,0)
 S DGCNTRY=$G(DGARRY(.1223))
"RTN","DGADDUTL",180,0)
 S DGFORN=$$FORIEN(DGCNTRY)
"RTN","DGADDUTL",181,0)
 I DGCNTRY]"" S DGCNTRY=$$CNTRYI(DGCNTRY)
"RTN","DGADDUTL",182,0)
 S DGPHONE=$G(DGARRY(.1219))
"RTN","DGADDUTL",183,0)
 S DGFROMDT=$$FMTE^XLFDT($G(DGARRY(.1217)))
"RTN","DGADDUTL",184,0)
 S DGTODT=$$FMTE^XLFDT($G(DGARRY(.1218)))
"RTN","DGADDUTL",185,0)
 ;
"RTN","DGADDUTL",186,0)
 ;jam DG*5.3*925 RM#788099 Add/Edit Residential address - Change field label to Temporary Mailing Address:
"RTN","DGADDUTL",187,0)
 W !!,"Temporary Mailing Address: "
"RTN","DGADDUTL",188,0)
 I DGADRACT="Y" D
"RTN","DGADDUTL",189,0)
 .W:DGADR1'="" !?9,DGADR1
"RTN","DGADDUTL",190,0)
 .W:DGADR2'="" !?9,DGADR2
"RTN","DGADDUTL",191,0)
 .W:DGADR3'="" !?9,DGADR3
"RTN","DGADDUTL",192,0)
 .I DGFORN=0 D
"RTN","DGADDUTL",193,0)
 ..W !?9,$S(DGCITY'="":DGCITY,1:"")_$S(DGCITY'="":",",1:" ")_$S(DGSTATE'="":DGSTATE,1:"")_" "_$S(DGZIP'="":DGZIP,1:"")
"RTN","DGADDUTL",194,0)
 .I DGFORN W !?8,$S(DGPCODE'="":DGPCODE,1:"")_" "_$S(DGCITY'="":DGCITY,1:"")_$S(DGCITY'="":",",1:" ")_$S(DGPROV'="":DGPROV,1:"")
"RTN","DGADDUTL",195,0)
 ;commenting out, causes address to print 2x. Patch 872
"RTN","DGADDUTL",196,0)
 ;W !?9,$S(DGCITY'="":DGCITY,1:"")_","_$S(DGSTATE'="":DGSTATE,1:"")_" "_$S(DGZIP'="":DGZIP,1:"")
"RTN","DGADDUTL",197,0)
 ;Removing lines from dot structure Patch 872
"RTN","DGADDUTL",198,0)
 W !," County: "_DGCOUNTY
"RTN","DGADDUTL",199,0)
 W !,"  Phone: "_DGPHONE
"RTN","DGADDUTL",200,0)
 W !,"From/To: "_$P(DGFROMDT,",")_","_$P(DGFROMDT,", ",2)_"-"_$P(DGTODT,",")_","_$P(DGTODT,", ",2)
"RTN","DGADDUTL",201,0)
 ;
"RTN","DGADDUTL",202,0)
 I $G(DGARRY(.12105))="N" D
"RTN","DGADDUTL",203,0)
 .W:$G(DGARRY(.1211))="" !?9,"NO TEMPORARY ADDRESS"
"RTN","DGADDUTL",204,0)
 .W:$G(DGARRY(.1212))="" !?9,""
"RTN","DGADDUTL",205,0)
 .W !," County: NOT APPLICABLE"
"RTN","DGADDUTL",206,0)
 .W !,"  Phone: NOT APPLICABLE"
"RTN","DGADDUTL",207,0)
 .W !,"From/To: NOT APPLICABLE"
"RTN","DGADDUTL",208,0)
 Q
"RTN","DGADDUTL",209,0)
COUNTRY(DGC) ;
"RTN","DGADDUTL",210,0)
 ;where DGC is the external value of the country
"RTN","DGADDUTL",211,0)
 ;return value is in upper case display mode
"RTN","DGADDUTL",212,0)
 ;if DGC is invalid, return -1
"RTN","DGADDUTL",213,0)
 N DGCC,DGIEN
"RTN","DGADDUTL",214,0)
 ; if input is NULL change to US
"RTN","DGADDUTL",215,0)
 I $G(DGC)="" S DGC="USA"
"RTN","DGADDUTL",216,0)
 ; Get IEN from B index, error if not found
"RTN","DGADDUTL",217,0)
 S DGIEN=$O(^HL(779.004,"B",DGC,"")) Q:DGIEN']"" -1
"RTN","DGADDUTL",218,0)
 ; xlate IEN to POSTAL NAME
"RTN","DGADDUTL",219,0)
 S DGCC=$P(^HL(779.004,DGIEN,"SDS"),U,3)
"RTN","DGADDUTL",220,0)
 ; if POSTAL NAME = "<NULL>" return DESCRIPTION
"RTN","DGADDUTL",221,0)
 I DGCC="<NULL>" D
"RTN","DGADDUTL",222,0)
 . S DGCC=$$UPPER^DGUTL($P(^HL(779.004,DGIEN,0),U,2))
"RTN","DGADDUTL",223,0)
 Q DGCC
"RTN","DGADDUTL",224,0)
FOR(DGC) ;returns a 1 if address is foreign, a 0 if domestic, -1 if DGC is not valid
"RTN","DGADDUTL",225,0)
 ; DGC is the external value of the country (.01 field of file 779.004)
"RTN","DGADDUTL",226,0)
 N DGFOR
"RTN","DGADDUTL",227,0)
 S DGFOR=0
"RTN","DGADDUTL",228,0)
 I $G(DGC)="" Q DGFOR
"RTN","DGADDUTL",229,0)
 I '$D(^HL(779.004,"B",DGC)) Q -1
"RTN","DGADDUTL",230,0)
 I DGC'="USA" S DGFOR=1
"RTN","DGADDUTL",231,0)
 Q DGFOR
"RTN","DGADDUTL",232,0)
CNTRYI(DGIEN) ;where DGC is the internal value of the country
"RTN","DGADDUTL",233,0)
 ;return DGC as the display value for the country
"RTN","DGADDUTL",234,0)
 ;if the input value is not a valid IEN, return -1
"RTN","DGADDUTL",235,0)
 ;if the input value is null, return null
"RTN","DGADDUTL",236,0)
 N DGCC
"RTN","DGADDUTL",237,0)
 I $G(DGIEN)="" Q ""
"RTN","DGADDUTL",238,0)
 I '$D(^HL(779.004,DGIEN,0)) Q -1
"RTN","DGADDUTL",239,0)
 ; xlate IEN to POSTAL NAME
"RTN","DGADDUTL",240,0)
 S DGCC=$P(^HL(779.004,DGIEN,"SDS"),U,3)
"RTN","DGADDUTL",241,0)
 ; if POSTAL NAME = "<NULL>" return DESCRIPTION
"RTN","DGADDUTL",242,0)
 I DGCC="<NULL>" D
"RTN","DGADDUTL",243,0)
 . S DGCC=$$UPPER^DGUTL($P(^HL(779.004,DGIEN,0),U,2))
"RTN","DGADDUTL",244,0)
 Q DGCC
"RTN","DGADDUTL",245,0)
FORIEN(DGC) ;returns a 1 if address is foreign, a 0 if domestic, -1 if DGC is invalid
"RTN","DGADDUTL",246,0)
 ;DGC is the IEN of the country file (#779.004)
"RTN","DGADDUTL",247,0)
 N DGFOR
"RTN","DGADDUTL",248,0)
 S DGFOR=0
"RTN","DGADDUTL",249,0)
 I $G(DGC)="" Q DGFOR
"RTN","DGADDUTL",250,0)
 I DGC'?1.3N Q -1
"RTN","DGADDUTL",251,0)
 I '$D(^HL(779.004,DGC,0)) Q -1
"RTN","DGADDUTL",252,0)
 I DGC]"",(DGC'=$O(^HL(779.004,"B","USA",""))) S DGFOR=1
"RTN","DGADDUTL",253,0)
 Q DGFOR
"RTN","DGRP1")
0^1^B40910302^B40184484
"RTN","DGRP1",1,0)
DGRP1 ;ALB/MRL,ERC,BAJ,PWC - DEMOGRAPHIC DATA ; 8/15/08 11:30am
"RTN","DGRP1",2,0)
 ;;5.3;Registration;**109,161,506,244,546,570,629,638,649,700,653,688,750,851,907,925**;Aug 13, 1993;Build 15
"RTN","DGRP1",3,0)
 ;
"RTN","DGRP1",4,0)
EN ;
"RTN","DGRP1",5,0)
 S (DGRPS,DGRPW)=1 D H^DGRPU F I=0,.11,.121,.122,.13,.15,.24,57,"SSN" S DGRP(I)=$S($D(^DPT(DFN,I)):^(I),1:"")
"RTN","DGRP1",6,0)
 I $P(DGRP(.15),"^",2)]"" S Z="APPLICANT IS LISTED AS 'INELIGIBLE' FOR TREATMENT!",DGRPCM=1 D WW^DGRPV S DGRPCM=0
"RTN","DGRP1",7,0)
 ;I $P(DGRP(.15),"^",3)]"" S Z="APPLICANT IS LISTED AS 'MISSING'.  NOTIFY APPROPRIATE PERSONNEL!",DGRPCM=1 D WW^DGRPV S DGRPCM=0
"RTN","DGRP1",8,0)
 ;Retrieve SSN Verification status DG*5.3*688 BAJ 11/22/2005
"RTN","DGRP1",9,0)
 N SSNV D GETSTAT(.SSNV)
"RTN","DGRP1",10,0)
 W ! S Z=1 D WW^DGRPV W "    Name: " S Z=$P(DGRP(0),"^",1),Z1=31 D WW1^DGRPV
"RTN","DGRP1",11,0)
 ;Display SSN and SSN Verification status DG*5.3*688 BAJ 11/22/2005
"RTN","DGRP1",12,0)
 W "SS: " S X=$P(DGRP(0),"^",9),Z=$E(X,1,3)_"-"_$E(X,4,5)_"-"_$E(X,6,10),Z1=13 D WW1^DGRPV W SSNV
"RTN","DGRP1",13,0)
 W ! S Z="",Z1=8 D WW1^DGRPV S Y=$P(DGRP(0),"^",3) X ^DD("DD") W "DOB: ",Y
"RTN","DGRP1",14,0)
 ;add Pseuso SSN Reason - DG*5.3*653, ERC
"RTN","DGRP1",15,0)
 I $P(DGRP(0),U,9)["P" D
"RTN","DGRP1",16,0)
 . N DGSPACE
"RTN","DGRP1",17,0)
 . S DGSPACE=10-$L(Y) ;adjust to maintain spacing on screen
"RTN","DGRP1",18,0)
 . S Z1=12+DGSPACE D WW1^DGRPV W "PSSN Reason: "
"RTN","DGRP1",19,0)
 . I $P(DGRP(0),U,9)["P" D
"RTN","DGRP1",20,0)
 . . N DGREAS D SSNREAS(.DGREAS)
"RTN","DGRP1",21,0)
 . . Q:$G(DGREAS)']""
"RTN","DGRP1",22,0)
 . . W DGREAS
"RTN","DGRP1",23,0)
 D GETNCAL  ;Display name component, sex, and alias information
"RTN","DGRP1",24,0)
 S Z=3,DGRPX=DGRP(0) D WW^DGRPV W " Remarks: ",$S($P(DGRPX,"^",10)]"":$E($P(DGRPX,"^",10),1,65),1:"NO REMARKS ENTERED FOR THIS PATIENT") S DGAD=.11,(DGA1,DGA2)=1 D A^DGRPU I $P(DGRP(.121),"^",9)="Y" S DGAD=.121,DGA1=1,DGA2=2 D A^DGRPU
"RTN","DGRP1",25,0)
 ;jam DG*5.3*925 RM#788099 Add/Edit Residential Address - change label to Permanent Mailing Address:
"RTN","DGRP1",26,0)
 S Z=4 D WW^DGRPV W " Permanent Mailing Address: " S Z=" ",Z1=17
"RTN","DGRP1",27,0)
 ;jam DG*5.3*925 RM#788099 Add/Edit Residential address - Change field label to Temporary Mailing Address:
"RTN","DGRP1",28,0)
 D WW1^DGRPV S Z=5,DGRPW=0 D WW^DGRPV W " Temporary Mailing Address: "
"RTN","DGRP1",29,0)
 W !?9
"RTN","DGRP1",30,0)
 S Z1=39,Z=$S($D(DGA(1)):DGA(1),1:"NONE ON FILE") D WW1^DGRPV W $S($D(DGA(2)):DGA(2),1:"NO TEMPORARY ADDRESS")
"RTN","DGRP1",31,0)
 ; loop through DGA array beginning with DGA(2) and print data at ?9 (odds) and ?48 (evens)
"RTN","DGRP1",32,0)
 S I=2 F I1=0:0 S I=$O(DGA(I)) Q:I=""  W:(I#2)!($X>50) !?9 W:'(I#2) ?48 W DGA(I)
"RTN","DGRP1",33,0)
 D COUNTY(.DGRP)  ; print County if applicable
"RTN","DGRP1",34,0)
 W !?4,"Phone: ",$S($P(DGRP(.13),U,1)]"":$P(DGRP(.13),U,1),1:DGRPU),?44,"Phone: ",$S($P(DGRP(.121),U,9)'="Y":"NOT APPLICABLE",$P(DGRP(.121),U,10)]"":$P(DGRP(.121),U,10),1:DGRPU)
"RTN","DGRP1",35,0)
 S X="NOT APPLICABLE" I $P(DGRP(.121),U,9)="Y" S Y=$P(DGRP(.121),U,7) X:Y]"" ^DD("DD") S X=$S(Y]"":Y,1:DGRPU)_"-",Y=$P(DGRP(.121),U,8) X:Y]"" ^DD("DD") S X=X_$S(Y]"":Y,1:DGRPU)
"RTN","DGRP1",36,0)
 W !?3,"Office: ",$S($P(DGRP(.13),U,2)]"":$P(DGRP(.13),U,2),1:DGRPU),?42,"From/To: ",X
"RTN","DGRP1",37,0)
 W !?1,"Bad Addr: ",$$EXTERNAL^DILFD(2,.121,"",$P(DGRP(.11),U,16))
"RTN","DGRP1",38,0)
 ;
"RTN","DGRP1",39,0)
 ; ***  Additional displays added for Pre-Registration
"RTN","DGRP1",40,0)
 I $G(DGPRFLG)=1 D
"RTN","DGRP1",41,0)
 . W !
"RTN","DGRP1",42,0)
 . N I,MIS1,X,X1,SA1,TP1,X2,X3,ES1,ADDRDTTM
"RTN","DGRP1",43,0)
 . I $D(^DIA(2,"B",DFN)) S X="" F I=1:1 S X=$O(^DIA(2,"B",DFN,X)) Q:X<1  I $P(^DIA(2,X,0),U,3)=.05 S MIS1=$P(^DIA(2,X,0),U,2)
"RTN","DGRP1",44,0)
 . W:$D(MIS1)>0 !," [MARITAL STATUS CHANGED:] "_$$FMTE^XLFDT(MIS1,"5D")
"RTN","DGRP1",45,0)
 . I $D(^DIA(2,"B",DFN)) S X1="" F I=1:1 S X1=$O(^DIA(2,"B",DFN,X1)) Q:X1<1  S:$P(^DIA(2,X1,0),U,3)=.111 SA1=$P(^DIA(2,X1,0),U,2)
"RTN","DGRP1",46,0)
 . W:$D(SA1)>0 !," [STREET ADDRESS LAST CHANGED:] "_$$FMTE^XLFDT(SA1,"5D")
"RTN","DGRP1",47,0)
 . I $D(^DIA(2,"B",DFN)) S X2="" F I=1:1 S X2=$O(^DIA(2,"B",DFN,X2)) Q:X2<1  S:$P(^DIA(2,X2,0),U,3)=.131 TP1=$P(^DIA(2,X2,0),U,2)
"RTN","DGRP1",48,0)
 . S ADDRDTTM=$P($G(^DPT(DFN,.11)),"^",13)
"RTN","DGRP1",49,0)
 . I ADDRDTTM'="" W !," [PERMANENT ADDRESS LAST CHANGED:] "_$$FMTE^XLFDT(ADDRDTTM,"5D")
"RTN","DGRP1",50,0)
 . W:$D(TP1)>0 !," [HOME PHONE NUMBER CHANGED:] "_$$FMTE^XLFDT(TP1,"5D")
"RTN","DGRP1",51,0)
 . I $D(^DIA(2,"B",DFN)) S X3="" F I=1:1 S X3=$O(^DIA(2,"B",DFN,X3)) Q:X3<1  S:$P(^DIA(2,X3,0),U,3)=.31115 ES1=$P(^DIA(2,X3,0),U,2)
"RTN","DGRP1",52,0)
 . W:$D(ES1)>0 !," [EMPLOYMENT STATUS CHANGED:] "_$$FMTE^XLFDT(ES1,"5D")
"RTN","DGRP1",53,0)
 . ; The IB Insurance API does not provide date entered or edited information, so this information will not be displayed for preregistration
"RTN","DGRP1",54,0)
 . I $$INSUR^IBBAPI(DFN,"","AR",.DGDATA,"1,10,11") F DGI=0:0 S DGI=$O(DGDATA("IBBAPI","INSUR",DGI)) Q:'DGI  D
"RTN","DGRP1",55,0)
 .. W !," [INSURANCE:] ",$P(DGDATA("IBBAPI","INSUR",DGI,1),U,2)
"RTN","DGRP1",56,0)
 .. W "  EFFECTIVE DATE: ",$$FMTE^XLFDT(DGDATA("IBBAPI","INSUR",DGI,10),"5D"),"  EXPIRATION DATE: ",$$FMTE^XLFDT(DGDATA("IBBAPI","INSUR",DGI,11),"5D")
"RTN","DGRP1",57,0)
 ;
"RTN","DGRP1",58,0)
 G ^DGRPP
"RTN","DGRP1",59,0)
 ;
"RTN","DGRP1",60,0)
GETNCAL ;Get name component values
"RTN","DGRP1",61,0)
 N DGCOMP,DGNC,DGI,DGA,DGALIAS,DGX,DGRPW
"RTN","DGRP1",62,0)
 S DGNC="Family^Given^Middle^Prefix^Suffix^Degree"
"RTN","DGRP1",63,0)
 S DGCOMP=+$G(^DPT(DFN,"NAME"))_","
"RTN","DGRP1",64,0)
 I DGCOMP D GETS^DIQ(20,DGCOMP,"1:6",,"DGCOMP")
"RTN","DGRP1",65,0)
 ;Get alias values
"RTN","DGRP1",66,0)
 S DGA=0 F DGI=1:1:5 D  Q:'$D(DGALIAS(DGI))
"RTN","DGRP1",67,0)
A2 .S DGA=$O(^DPT(DFN,.01,DGA))
"RTN","DGRP1",68,0)
 .I 'DGA D:DGI=1  Q
"RTN","DGRP1",69,0)
 ..S DGALIAS(DGI)="< No alias entries on file >" Q
"RTN","DGRP1",70,0)
 .I DGI=5 S DGALIAS(DGI)="< More alias entries on file >" Q
"RTN","DGRP1",71,0)
 .S DGX=$G(^DPT(DFN,.01,DGA,0)) G:'$L(DGX) A2
"RTN","DGRP1",72,0)
 .S DGALIAS(DGI)=$P(DGX,U),DGX=$P(DGX,U,2)
"RTN","DGRP1",73,0)
 .I $L(DGX) D
"RTN","DGRP1",74,0)
 ..S DGX=" "_$E(DGX,1,3)_"-"_$E(DGX,4,5)_"-"_$E(DGX,6,9)
"RTN","DGRP1",75,0)
 ..; BAJ DG*5.2*700 retrofit 06/22/06
"RTN","DGRP1",76,0)
 ..S DGALIAS(DGI)=$E(DGALIAS(DGI),1,19)
"RTN","DGRP1",77,0)
 ..S $E(DGALIAS(DGI),20)=DGX Q
"RTN","DGRP1",78,0)
 .S DGALIAS(DGI)=$E(DGALIAS(DGI),1,32)
"RTN","DGRP1",79,0)
 .Q  ;
"RTN","DGRP1",80,0)
 ;Display name component, sex, multiple birth indicator and alias data
"RTN","DGRP1",81,0)
 F DGI=1:1:6 D
"RTN","DGRP1",82,0)
 .W !?5,$J($P(DGNC,U,DGI),6),": ",$E($G(DGCOMP(20,DGCOMP,DGI)),1,$S(DGI=1:28,1:27))
"RTN","DGRP1",83,0)
 .; BAJ DG*5.3*700 retrofit 06/22/06
"RTN","DGRP1",84,0)
 .; ob - 10/22/14 added "Birth" on the next line
"RTN","DGRP1",85,0)
 .I DGI=1 S (Z,DGRPW)=1 W ?37,"Birth Sex: " S X=$P(DGRP(0),"^",2),Z=$S(X="M":"MALE",X="F":"FEMALE",1:DGRPU),Z1=3 D WW1^DGRPV ;DG*5.3*907
"RTN","DGRP1",86,0)
 .I DGI=1 S (Z,DGRPW)=1 W ?56,"MBI: " S X=$P($G(^DPT(DFN,"MPIMB")),U),Z=$S(X="N":"NO",X="Y":"*MULTIPLE BIRTH*",1:DGRPU),Z1=16 D WW1^DGRPV
"RTN","DGRP1",87,0)
 .I DGI=2 S DGRPW=0,Z=2 W ?37 D WW^DGRPV W " Alias: "
"RTN","DGRP1",88,0)
 .I DGI>1 W ?47,$G(DGALIAS(DGI-1))
"RTN","DGRP1",89,0)
 .Q
"RTN","DGRP1",90,0)
 ;*** display Self-Identified Gender Identity DG*5.3*907
"RTN","DGRP1",91,0)
 ;Get node with SIGI in it already done at EN+1
"RTN","DGRP1",92,0)
 W !?5,"Self-Identified Gender Identity: "
"RTN","DGRP1",93,0)
 S X=$P(DGRP(.24),"^",4),Z=$S(X="M":"MALE",X="F":"FEMALE",X="TM":"TRANSMALE/TRANSMAN/FEMALE-TO-MALE",X="TF":"TRANSFEMALE/TRANSWOMAN/MALE-TO-FEMALE",X="O":"OTHER",X="N":"INDIVIDUAL CHOOSES NOT TO ANSWER",1:DGRPU) W Z ;D WW1^DGRPV
"RTN","DGRP1",94,0)
 ; *** end of change 
"RTN","DGRP1",95,0)
 Q
"RTN","DGRP1",96,0)
GETSTAT(SSNV) ;get SSN VERIFIED STATUS DG*5.3*688 BAJ 11/22/2005
"RTN","DGRP1",97,0)
 N T
"RTN","DGRP1",98,0)
 S T=$P($G(^DPT(DFN,"SSN")),"^",2)
"RTN","DGRP1",99,0)
 S SSNV=$S(T=2:"INVALID",T=4:"VERIFIED",1:"")
"RTN","DGRP1",100,0)
 Q
"RTN","DGRP1",101,0)
 ;
"RTN","DGRP1",102,0)
SSNREAS(DGREAS) ;get Pseuso SSN Reason - DG*5.3*653, ERC
"RTN","DGRP1",103,0)
 S DGREAS=$P(DGRP("SSN"),U)
"RTN","DGRP1",104,0)
 I $G(DGREAS)']"" Q
"RTN","DGRP1",105,0)
 S DGREAS=$S(DGREAS="R":"Refused to Provide",DGREAS="S":"SSN Unknown/Follow-up Required",DGREAS="N":"No SSN Assigned",1:"< None Entered >")
"RTN","DGRP1",106,0)
 Q
"RTN","DGRP1",107,0)
COUNTY(DGRP) ;retrieve and print County info if a US address
"RTN","DGRP1",108,0)
 N DGCC,CNODE,FNODE,FPCE,FILE,IEN,CNTRY,PLINE
"RTN","DGRP1",109,0)
 ; data location of Permanent Address County info
"RTN","DGRP1",110,0)
 S FNODE=.11,FPCE=10,DGCC=""
"RTN","DGRP1",111,0)
 ; only print county info if it's a US address
"RTN","DGRP1",112,0)
 S IEN=$P(DGRP(FNODE),U,FPCE) I '$$FORIEN^DGADDUTL(IEN) D
"RTN","DGRP1",113,0)
 . S DGCC=$S($D(^DIC(5,+$P(DGRP(FNODE),U,5),1,+$P(DGRP(FNODE),U,7),0)):$E($P(^(0),U,1),1,20)_$S($P(^(0),U,3)]"":" ("_$P(^(0),U,3)_")",1:""),1:DGRPU)
"RTN","DGRP1",114,0)
 S PLINE=$S(DGCC]"":"County: "_DGCC,1:"")
"RTN","DGRP1",115,0)
 W !?3,PLINE
"RTN","DGRP1",116,0)
 S DGCC=""
"RTN","DGRP1",117,0)
 ; data location of Temporary address County info
"RTN","DGRP1",118,0)
 S CNODE=.121,FNODE=.122,FPCE=3
"RTN","DGRP1",119,0)
 ; only print county info if it's a US address
"RTN","DGRP1",120,0)
 S IEN=$P(DGRP(FNODE),U,FPCE) I '$$FORIEN^DGADDUTL(IEN) D
"RTN","DGRP1",121,0)
 . S DGCC=$S($P(DGRP(CNODE),U,9)'="Y":"NOT APPLICABLE",$D(^DIC(5,+$P(DGRP(CNODE),U,5),1,+$P(DGRP(CNODE),U,11),0)):$E($P(^(0),U,1),1,20)_$S($P(^(0),U,3)]"":" ("_$P(^(0),U,3)_")",1:""),1:DGRPU)
"RTN","DGRP1",122,0)
 S PLINE=$S(DGCC]"":"County: "_DGCC,1:"")
"RTN","DGRP1",123,0)
 W ?43,PLINE
"RTN","DGRP1",124,0)
 Q
"RTN","DGRP1",125,0)
 ;
"RTN","DGRPD")
0^2^B71290433^B69759113
"RTN","DGRPD",1,0)
DGRPD ;ALB/MRL/MLR/JAN/LBD/EG/BRM/JRC/BAJ-PATIENT INQUIRY (NEW) ; July 09, 2014
"RTN","DGRPD",2,0)
 ;;5.3;Registration;**109,124,121,57,161,149,286,358,436,445,489,498,506,513,518,550,545,568,585,677,703,688,887,907,925**;Aug 13, 1993;Build 15
"RTN","DGRPD",3,0)
 ;  *286*  Newing variables X,Y in OKLINE subroutine
"RTN","DGRPD",4,0)
 ;  *358*  If a patient is on a domiciliary ward, don't display MEANS
"RTN","DGRPD",5,0)
 ;         TEST required/Medication Copayment Exemption messages
"RTN","DGRPD",6,0)
 ;  *436*  If an inpatient is not on a domiciliary ward, don't display
"RTN","DGRPD",7,0)
 ;         Medication Copayment Exemption message
"RTN","DGRPD",8,0)
 ;  *545*  Add death information near the remarks field
"RTN","DGRPD",9,0)
 ;  *677*  Added Emergency Response
"RTN","DGRPD",10,0)
 ;  *688*  Modified to display Country and Foreign Address
"RTN","DGRPD",11,0)
SEL K DFN,DGRPOUT W ! S DIC="^DPT(",DIC(0)="AEQMZ" D ^DIC G Q:Y'>0 S DFN=+Y N Y W ! S DIR(0)="E" D ^DIR G SEL:$D(DTOUT)!($D(DUOUT)) D EN G SEL
"RTN","DGRPD",12,0)
EN ;call to display patient inquiry - input DFN
"RTN","DGRPD",13,0)
 ;MPI/PD CHANGE
"RTN","DGRPD",14,0)
 S DGCMOR="UNSPECIFIED",DGMPI=$G(^DPT(+DFN,"MPI"))
"RTN","DGRPD",15,0)
 S DGLOCATN=$$FIND1^DIC(4,"","MX","`"_+$P(DGMPI,U,3)),DGLOCATN=$S(+DGLOCATN>0:$P($$NS^XUAF4(DGLOCATN),U),1:"NOT LISTED")
"RTN","DGRPD",16,0)
 I $D(DGMPI),$D(DGLOCATN) S DGCMOR=$P(DGLOCATN,"^")
"RTN","DGRPD",17,0)
 ;END MPI/PD CHANGE
"RTN","DGRPD",18,0)
 K DGRPOUT,DGHOW S DGABBRV=$S($D(^DG(43,1,0)):+$P(^(0),"^",38),1:0),DGRPU="UNSPECIFIED" D DEM^VADPT,HDR^DGRPD1 F I=0,.11,.13,.121,.122,.31,.32,.36,.361,.141,.3 S DGRP(I)=$S($D(^DPT(DFN,I)):^(I),1:"")
"RTN","DGRPD",19,0)
 S DGAD=.11,(DGA1,DGA2)=1 D A^DGRPU S DGTMPAD=0 I $P(DGRP(.121),"^",9)="Y" S DGTMPAD=$S('$P(DGRP(.121),"^",8):1,$P(DGRP(.121),"^",8)'<DT:1,1:0) I DGTMPAD S DGAD=.121,DGA1=1,DGA2=2 D A^DGRPU
"RTN","DGRPD",20,0)
 ;jam DG*5.3*925 RM#788099 Add/Edit Residential address - move addresses down 1 line below the field labels
"RTN","DGRPD",21,0)
 ; and change labels to "Permanent Mailing Address" and "Temporary Mailing Address"
"RTN","DGRPD",22,0)
 W ?1,"Permanent Mailing Address: ",?40,"Temporary Mailing Address: "
"RTN","DGRPD",23,0)
 W !,?9,$S($D(DGA(1)):DGA(1),1:"NONE ON FILE"),?48,$S($D(DGA(2)):DGA(2),1:"NO TEMPORARY MAILING")
"RTN","DGRPD",24,0)
 S I=2 F I1=0:0 S I=$O(DGA(I)) Q:I=""  W:(I#2)!($X>50) !?9 W:'(I#2) ?48 W DGA(I)
"RTN","DGRPD",25,0)
 S DGCC=+$P(DGRP(.11),U,7),DGST=+$P(DGRP(.11),U,5),DGCC=$S($D(^DIC(5,DGST,1,DGCC,0)):$E($P(^(0),U,1),1,20)_$S($P(^(0),U,3)]"":" ("_$P(^(0),U,3)_")",1:""),1:DGRPU)
"RTN","DGRPD",26,0)
 N DGCNTRY,DGFORGN S DGCNTRY=$P(DGRP(.11),"^",10),DGFORGN=$$FORIEN^DGADDUTL(DGCNTRY) I 'DGFORGN W !?2,"County: ",DGCC
"RTN","DGRPD",27,0)
 S X="NOT APPLICABLE" I DGTMPAD S Y=$P(DGRP(.121),U,7) X:Y]"" ^DD("DD") S X=$S(Y]"":Y,1:DGRPU)_"-",Y=$P(DGRP(.121),U,8) X:Y]"" ^DD("DD") S X=X_$S(Y]"":Y,1:DGRPU)
"RTN","DGRPD",28,0)
 N DGSKIP S DGSKIP=$S(DGFORGN:"!,?42,""From/To: """,1:"?42, ""From/To: """)
"RTN","DGRPD",29,0)
 W @DGSKIP,X,!?3,"Phone: ",$S($P(DGRP(.13),U,1)]"":$P(DGRP(.13),U,1),1:DGRPU),?44,"Phone: ",$S('DGTMPAD:X,$P(DGRP(.121),U,10)]"":$P(DGRP(.121),U,10),1:DGRPU) K DGTMPADW
"RTN","DGRPD",30,0)
 W !?2,"Office: ",$S($P(DGRP(.13),U,2)]"":$P(DGRP(.13),U,2),1:DGRPU)
"RTN","DGRPD",31,0)
 W !?4,"Cell: ",$S($P(DGRP(.13),U,4)]"":$P(DGRP(.13),U,4),1:DGRPU)
"RTN","DGRPD",32,0)
 W !?2,"E-mail: ",$S($P(DGRP(.13),U,3)]"":$P(DGRP(.13),U,3),1:DGRPU)
"RTN","DGRPD",33,0)
 W !,"Bad Addr: ",$$EXTERNAL^DILFD(2,.121,"",$$BADADR^DGUTL3(+DFN))
"RTN","DGRPD",34,0)
 D CA
"RTN","DGRPD",35,0)
 N DGEMER S DGEMER=$$EXTERNAL^DILFD(2,.181,"",$P($G(^DPT(DFN,.18)),"^"))
"RTN","DGRPD",36,0)
 W:DGEMER]"" !?32,"Emergency Response: ",DGEMER
"RTN","DGRPD",37,0)
 I 'DGABBRV W !!?4,"POS: ",$S($D(^DIC(21,+$P(DGRP(.32),"^",3),0)):$P(^(0),"^",1),1:DGRPU),?42,"Claim #: ",$S($P(DGRP(.31),"^",3)]"":$P(DGRP(.31),"^",3),1:"UNSPECIFIED")
"RTN","DGRPD",38,0)
 I 'DGABBRV W !?2,"Relig: ",$S($D(^DIC(13,+$P(DGRP(0),"^",8),0)):$P(^(0),"^",1),1:DGRPU),?46,"Birth Sex: ",$S($P(VADM(5),"^",2)]"":$P(VADM(5),"^",2),1:"UNSPECIFIED") ; DG*5.3*907
"RTN","DGRPD",39,0)
 I 'DGABBRV W ! D
"RTN","DGRPD",40,0)
 .N RACE,ETHNIC,PTR,VAL,X,DIWL,DIWR,DIWF
"RTN","DGRPD",41,0)
 .K ^UTILITY($J,"W")
"RTN","DGRPD",42,0)
 .S PTR=0 F  S PTR=+$O(^DPT(DFN,.02,PTR)) Q:'PTR  D
"RTN","DGRPD",43,0)
 ..S VAL=+$G(^DPT(DFN,.02,PTR,0))
"RTN","DGRPD",44,0)
 ..Q:$$INACTIVE^DGUTL4(VAL,1)
"RTN","DGRPD",45,0)
 ..S VAL=$$PTR2TEXT^DGUTL4(VAL,1) S:+$O(^DPT(DFN,.02,PTR)) VAL=VAL_", "
"RTN","DGRPD",46,0)
 ..S X=VAL,DIWL=0,DIWR=30,DIWF="" D ^DIWP
"RTN","DGRPD",47,0)
 .M RACE=^UTILITY($J,"W",0) S:$G(RACE(1,0))="" RACE(1,0)="UNANSWERED"
"RTN","DGRPD",48,0)
 .K ^UTILITY($J,"W")
"RTN","DGRPD",49,0)
 .S PTR=0 F  S PTR=+$O(^DPT(DFN,.06,PTR)) Q:'PTR  D
"RTN","DGRPD",50,0)
 ..S VAL=+$G(^DPT(DFN,.06,PTR,0))
"RTN","DGRPD",51,0)
 ..Q:$$INACTIVE^DGUTL4(VAL,2)
"RTN","DGRPD",52,0)
 ..S VAL=$$PTR2TEXT^DGUTL4(VAL,2) S:+$O(^DPT(DFN,.06,PTR)) VAL=VAL_", "
"RTN","DGRPD",53,0)
 ..S X=VAL,DIWL=0,DIWR=30,DIWF="" D ^DIWP
"RTN","DGRPD",54,0)
 .M ETHNIC=^UTILITY($J,"W",0) S:$G(ETHNIC(1,0))="" ETHNIC(1,0)="UNANSWERED"
"RTN","DGRPD",55,0)
 .K ^UTILITY($J,"W")
"RTN","DGRPD",56,0)
 .W ?3,"Race: ",RACE(1,0),?40,"Ethnicity: ",ETHNIC(1,0)
"RTN","DGRPD",57,0)
 .F X=2:1 Q:'$D(RACE(X,0))&'$D(ETHNIC(X,0))  W !,?9,$G(RACE(X,0)),?51,$G(ETHNIC(X,0))
"RTN","DGRPD",58,0)
 I '$$OKLINE^DGRPD1(16) G Q
"RTN","DGRPD",59,0)
 D LANGUAGE
"RTN","DGRPD",60,0)
 I '$$OKLINE^DGRPD1(10) G Q
"RTN","DGRPD",61,0)
 ;display cv status #4156
"RTN","DGRPD",62,0)
 N DGCV S DGCV=$$CVEDT^DGCV(+DFN)
"RTN","DGRPD",63,0)
 W !!,?2,"Combat Vet Status: "_$S($P(DGCV,U,3)=1:"ELIGIBLE",$P(DGCV,U,3)="":"NOT ELIGIBLE",1:"EXPIRED") I DGCV>0 W ?45,"End Date: "_$$FMTE^XLFDT($P(DGCV,U,2),"5DZ")
"RTN","DGRPD",64,0)
 ;display primary eligibility
"RTN","DGRPD",65,0)
 S X1=DGRP(.36),X=$P(DGRP(.361),"^",1) W !,"Primary Eligibility: ",$S($D(^DIC(8,+X1,0)):$P(^(0),"^",1)_" ("_$S(X="V":"VERIFIED",X="P":"PENDING VERIFICATION",X="R":"PENDING REVERIFICATION",1:"NOT VERIFIED")_")",1:DGRPU)
"RTN","DGRPD",66,0)
 W !,"Other Eligibilities: " F I=0:0 S I=$O(^DIC(8,I)) Q:'I  I $D(^DIC(8,I,0)),I'=+X1 S X=$P(^(0),"^",1)_", " I $D(^DPT("AEL",DFN,I)) W:$X+$L(X)>79 !?21 W X
"RTN","DGRPD",67,0)
 I '$$OKLINE^DGRPD1(16) G Q
"RTN","DGRPD",68,0)
 ;employability status
"RTN","DGRPD",69,0)
 W !?6,"Unemployable: ",$S($P(DGRP(.3),U,5)="Y":"YES",1:"NO")
"RTN","DGRPD",70,0)
 I '$$OKLINE^DGRPD1(19) G Q
"RTN","DGRPD",71,0)
 ;display the catastrophic disability review date if there is one
"RTN","DGRPD",72,0)
 D CATDIS^DGRPD1
"RTN","DGRPD",73,0)
 I $G(DGPRFLG)=1 G Q:'$$OKLINE^DGRPD1(19) D
"RTN","DGRPD",74,0)
 . N DGPDT,DGPTM
"RTN","DGRPD",75,0)
 . W !,$$REPEAT^XLFSTR("-",78)
"RTN","DGRPD",76,0)
 . S DGPDT="",DGPDT=$O(^DGS(41.41,"ADC",DFN,DGPDT),-1)
"RTN","DGRPD",77,0)
 . W !,"[PRE-REGISTER DATE:]  "_$S(DGPDT]"":$$FMTE^XLFDT(DGPDT,"1D"),1:"NONE ON FILE")
"RTN","DGRPD",78,0)
 . S DGPTM=$$PCTEAM^DGSDUTL(DFN)
"RTN","DGRPD",79,0)
 . I $P(DGPTM,U,2)]"" W !,"[PRIMARY CARE TEAM:] "_$P(DGPTM,U,2)
"RTN","DGRPD",80,0)
 . W !,$$REPEAT^XLFSTR("-",78)
"RTN","DGRPD",81,0)
 ; Check if patient is an inpatient and on a DOM ward
"RTN","DGRPD",82,0)
 ; If inpatient is on a DOM ward, don't display MT or CP messages
"RTN","DGRPD",83,0)
 ; If inpatient is NOT on a DOM ward, don't display CP message
"RTN","DGRPD",84,0)
 N DGDOM,DGDOM1,VAHOW,VAROOT,VAINDT,VAIP,VAERR
"RTN","DGRPD",85,0)
 G Q:'$$OKLINE^DGRPD1(16)
"RTN","DGRPD",86,0)
 D DOM^DGMTR
"RTN","DGRPD",87,0)
 I '$G(DGDOM) D
"RTN","DGRPD",88,0)
 .D DIS^DGMTU(DFN)
"RTN","DGRPD",89,0)
 .D IN5^VADPT
"RTN","DGRPD",90,0)
 .I $G(VAIP(1))="" D DISP^IBARXEU(DFN,DT,3,1)
"RTN","DGRPD",91,0)
 ;I 'DGABBRV,$E(IOST,1,2)="C-" F I=$Y:1:20 W !
"RTN","DGRPD",92,0)
 D DIS^EASECU(DFN)   ;Added for LTC III (DG*5.3*518)
"RTN","DGRPD",93,0)
 S VAIP("L")=""
"RTN","DGRPD",94,0)
 I $$OKLINE^DGRPD1(14) D INP
"RTN","DGRPD",95,0)
 I '$G(DGRPOUT),($$OKLINE^DGRPD1(10)) D SA ;*KNR*
"RTN","DGRPD",96,0)
 ;MPI/PD CHANGE
"RTN","DGRPD",97,0)
Q D KVA^VADPT K %DT,D0,D1,DGA,DGA1,DGA2,DGABBRV,DGAD,DGCC,DGCMOR,DGDOM,DGLOCATN,DGMPI,DGRP,DGRPU,DGS,DGST,DGXFR0,DIC,DIR,DTOUT,DUOUT,DIRUT,DIROUT,I,I1,L,LDM,POP,SDCT,VA,X,X1,Y Q
"RTN","DGRPD",98,0)
CA ;Confidential Address
"RTN","DGRPD",99,0)
 W !!?1,"Confidential Address:  ",?44,"Confidential Address Categories:"
"RTN","DGRPD",100,0)
 N DGCABEG,DGCAEND,DGA,DGARRAY,DGERROR
"RTN","DGRPD",101,0)
 S DGCABEG=$P(DGRP(.141),U,7),DGCAEND=$P(DGRP(.141),U,8)
"RTN","DGRPD",102,0)
 I 'DGCABEG!(DGCABEG>DT)!(DGCAEND&(DGCAEND<DT)) D  Q
"RTN","DGRPD",103,0)
 .W !?9,"NO CONFIDENTIAL ADDRESS"
"RTN","DGRPD",104,0)
 .W !?1,"From/To: NOT APPLICABLE"
"RTN","DGRPD",105,0)
 S DGAD=.141,(DGA1,DGA2)=1
"RTN","DGRPD",106,0)
 D AL^DGRPU(30)
"RTN","DGRPD",107,0)
 D GETS^DIQ(2,DFN,".141*,","E","DGARRAY","DGERROR")
"RTN","DGRPD",108,0)
 ;Format Confidential Address categories
"RTN","DGRPD",109,0)
 N DGIEN,DGCAST
"RTN","DGRPD",110,0)
 S DGIEN=0
"RTN","DGRPD",111,0)
 S DGA2=2
"RTN","DGRPD",112,0)
 F  S DGIEN=$O(DGARRAY(2.141,DGIEN)) Q:'DGIEN  D
"RTN","DGRPD",113,0)
 .S DGA(DGA2)=DGARRAY(2.141,DGIEN,.01,"E")
"RTN","DGRPD",114,0)
 .S DGCAST=DGARRAY(2.141,DGIEN,1,"E")
"RTN","DGRPD",115,0)
 .S DGA(DGA2)=DGA(DGA2)_"("_$S(DGCAST="YES":"Active",1:"Inactive")_")"
"RTN","DGRPD",116,0)
 .S DGA2=DGA2+2
"RTN","DGRPD",117,0)
 S I=0 F I1=0:0 S I=$O(DGA(I)) Q:I=""  W:(I#2)!($X>43) !?9 W:'(I#2) ?44 W DGA(I)
"RTN","DGRPD",118,0)
 W !?1,"From/To:  ",$$FMTE^XLFDT(DGCABEG)_"-"_$S(DGCAEND'="":$$FMTE^XLFDT(DGCAEND),1:"UNANSWERED")
"RTN","DGRPD",119,0)
 Q
"RTN","DGRPD",120,0)
INP S VAIP("D")="L" D INP^DGPMV10
"RTN","DGRPD",121,0)
 S DGPMT=0
"RTN","DGRPD",122,0)
 D CS^DGPMV10 K DGPMT,DGPMIFN K:'$D(DGSWITCH) DGPMVI,DGPMDCD Q
"RTN","DGRPD",123,0)
SA F I=0:0 S I=$O(^DGS(41.1,"B",DFN,I)) G CL:'I S X=^DGS(41.1,I,0) I $P(X,"^",2)>(DT-1),$P(X,"^",13)']"",'$P(X,"^",17) S L=$P(X,"^",2) D:$$OKLINE^DGRPD1(17) SAA Q:$G(DGRPOUT)
"RTN","DGRPD",124,0)
 Q
"RTN","DGRPD",125,0)
SAA ;Scheduled Admit Data
"RTN","DGRPD",126,0)
 W !!?14,"Scheduled Admit"
"RTN","DGRPD",127,0)
 W:$D(^DIC(42,+$P(X,U,8),0)) " on ward "_$P(^(0),U)
"RTN","DGRPD",128,0)
 W:$D(^DIC(45.7,+$P(X,U,9),0)) " for treating specialty "_$P(^(0),U)
"RTN","DGRPD",129,0)
 W " on "_$$FMTE^XLFDT(L,"5DZ")
"RTN","DGRPD",130,0)
 Q  ;SAA
"RTN","DGRPD",131,0)
 ;
"RTN","DGRPD",132,0)
CL G FA:$O(^DPT(DFN,"DE",0))="" S SDCT=0 F I=0:0 S I=$O(^DPT(DFN,"DE",I)) Q:'I  I $D(^(I,0)),$P(^(0),"^",2)'="I",$O(^(0)) S SDCT=SDCT+1 W:SDCT=1 !!,"Currently enrolled in " W:$X>50 !?22 W $S($D(^SC(+^(0),0)):$P(^(0),"^",1)_", ",1:"")
"RTN","DGRPD",133,0)
 ;
"RTN","DGRPD",134,0)
FA ;
"RTN","DGRPD",135,0)
 N DGARRAY,SDCNT
"RTN","DGRPD",136,0)
 S DGARRAY("FLDS")="1;2;3;18",DGARRAY(4)=DFN,DGARRAY(1)=DT,DGARRAY("SORT")="P"
"RTN","DGRPD",137,0)
 S SDCNT=$$SDAPI^SDAMA301(.DGARRAY),CT=0 W !!,"Future Appointments: "
"RTN","DGRPD",138,0)
 ;if there is lower subscripts hanging from the 101 node,
"RTN","DGRPD",139,0)
 ;then it is a valid appointment, otherwise it is
"RTN","DGRPD",140,0)
 ;an error eg 01/20/2005
"RTN","DGRPD",141,0)
 ;G:'$$OKLINE^DGRPD1(13) RMK ;*///*
"RTN","DGRPD",142,0)
 I $D(^TMP($J,"SDAMA301",101))=1 W "Appointment Database is Unavailable" G RMK
"RTN","DGRPD",143,0)
 I $O(^TMP($J,"SDAMA301",DFN,DT))'>0 W "NONE" G RMK
"RTN","DGRPD",144,0)
 ;
"RTN","DGRPD",145,0)
 W ?22,"Date",?33,"Time",?39,"Clinic",!?22 F I=22:1:75 W "="
"RTN","DGRPD",146,0)
 F FA=DT:0 S FA=$O(^TMP($J,"SDAMA301",DFN,FA)) G RMK:'FA D  Q:CT>5
"RTN","DGRPD",147,0)
 .N STAT S STAT=$P($P(^TMP($J,"SDAMA301",DFN,FA),U,3),";")
"RTN","DGRPD",148,0)
 .S C=+$P(^TMP($J,"SDAMA301",DFN,FA),U,2) I STAT'["C" D
"RTN","DGRPD",149,0)
 ..D COV
"RTN","DGRPD",150,0)
 ..N DGAPPT S DGAPPT=$$FMTE^XLFDT($E(FA,1,12),"5Z")
"RTN","DGRPD",151,0)
 ..W !?22,$P(DGAPPT,"@"),?33,$P(DGAPPT,"@",2)
"RTN","DGRPD",152,0)
 ..W ?39,$P($P(^TMP($J,"SDAMA301",DFN,FA),U,2),";",2)," ",COV
"RTN","DGRPD",153,0)
 ..Q
"RTN","DGRPD",154,0)
 I $O(^TMP($J,"SDAMA301",DFN,FA))>0 W !,"See Scheduling options for additional appointments."
"RTN","DGRPD",155,0)
RMK I '$G(DGRPOUT),($$OKLINE^DGRPD1(15)) W !!,"Remarks: ",$P(^DPT(DFN,0),"^",10) ;*///*
"RTN","DGRPD",156,0)
 D GETS^DIQ(2,DFN_",",".351;.353;.354;.355","E","PDTHINFO")
"RTN","DGRPD",157,0)
 W !!
"RTN","DGRPD",158,0)
 W "Date of Death Information"
"RTN","DGRPD",159,0)
 W !,?5,"Date of Death: ",$G(PDTHINFO(2,DFN_",",.351,"E"))
"RTN","DGRPD",160,0)
 W !,?5,"Source of Notification: ",$G(PDTHINFO(2,DFN_",",.353,"E"))
"RTN","DGRPD",161,0)
 W !,?5,"Updated Date/Time: ",$G(PDTHINFO(2,DFN_",",.354,"E"))
"RTN","DGRPD",162,0)
 W !,?5,"Last Edited By: ",$G(PDTHINFO(2,DFN_",",.355,"E")),!
"RTN","DGRPD",163,0)
 I $$OKLINE^DGRPD1(14) D EC^DGRPD1
"RTN","DGRPD",164,0)
 K DGARRAY,SDCNT,^TMP($J,"SDAMA301"),ADM,L,TRN,DIS,SSN,FA,C,COV,NOW,CT,DGD,DGD1,I ;Y killed after dghinqky
"RTN","DGRPD",165,0)
 Q
"RTN","DGRPD",166,0)
COV S COV=$S(+$P(^TMP($J,"SDAMA301",DFN,FA),U,18)=7:" (Collateral) ",1:"")
"RTN","DGRPD",167,0)
 S COV=COV_$S(STAT["NT":" * NO ACTION TAKEN *",STAT["N":" * NO-SHOW *",1:""),CT=CT+1 Q
"RTN","DGRPD",168,0)
 Q
"RTN","DGRPD",169,0)
 ;
"RTN","DGRPD",170,0)
OREN S XQORQUIT=1 Q:'$D(ORVP)  S DFN=+ORVP D EN R !!,"Press RETURN to CONTINUE: ",X:DTIME
"RTN","DGRPD",171,0)
 Q
"RTN","DGRPD",172,0)
LANGUAGE ; Get language data *///*
"RTN","DGRPD",173,0)
 S DGLANGDT=9999999,(DGPRFLAN,DGLANG0)=""
"RTN","DGRPD",174,0)
 S DGLANGDT=$O(^DPT(DFN,.207,"B",DGLANGDT),-1)
"RTN","DGRPD",175,0)
 I DGLANGDT="" G L1
"RTN","DGRPD",176,0)
 S DGLANGDA=$O(^DPT(DFN,.207,"B",DGLANGDT,0))
"RTN","DGRPD",177,0)
 S DGLANG0=$G(^DPT(DFN,.207,DGLANGDA,0)),Y=$P(DGLANG0,U),DGPRFLAN=$P(DGLANG0,U,2)
"RTN","DGRPD",178,0)
 S Y=DGLANGDT X ^DD("DD") S DGLANGDT=Y
"RTN","DGRPD",179,0)
L1 W !!,"Language Date/Time: ",$S(DGLANGDT="":"UNANSWERED",1:DGLANGDT),!
"RTN","DGRPD",180,0)
 W ?1,"Preferred Language: ",$S(DGPRFLAN="":"UNANSWERED",1:DGPRFLAN)
"RTN","DGRPD",181,0)
 K DGLANGDT,DGPRFLAN,DGLANG0,DGLANGDA
"RTN","DGRPD",182,0)
 Q
"VER")
8.0^22.2
"BLD",9920,6)
^829
**END**
**END**

