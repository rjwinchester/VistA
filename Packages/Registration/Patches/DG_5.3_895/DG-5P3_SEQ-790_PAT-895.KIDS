Released DG*5.3*895 SEQ #790
Extracted from mail message
**KIDS**:DG*5.3*895^

**INSTALL NAME**
DG*5.3*895
"BLD",9736,0)
DG*5.3*895^REGISTRATION^0^3141023^y
"BLD",9736,1,0)
^^5^5^3141023^^^^
"BLD",9736,1,1,0)
Patch DG*5.3*895 addresses 2 issues:
"BLD",9736,1,2,0)
      
"BLD",9736,1,3,0)
 1.)  Deletion of admission can cause orphaned nodes
"BLD",9736,1,4,0)
 2.)  Inconsistency 55 issue with service connected veterans who agree to 
"BLD",9736,1,5,0)
      copay, but decline to provide income data
"BLD",9736,4,0)
^9.64PA^^
"BLD",9736,6.3)
11
"BLD",9736,"ABPKG")
n
"BLD",9736,"KRN",0)
^9.67PA^779.2^20
"BLD",9736,"KRN",.4,0)
.4
"BLD",9736,"KRN",.4,"NM",0)
^9.68A^^
"BLD",9736,"KRN",.401,0)
.401
"BLD",9736,"KRN",.401,"NM",0)
^9.68A^^
"BLD",9736,"KRN",.402,0)
.402
"BLD",9736,"KRN",.403,0)
.403
"BLD",9736,"KRN",.5,0)
.5
"BLD",9736,"KRN",.84,0)
.84
"BLD",9736,"KRN",3.6,0)
3.6
"BLD",9736,"KRN",3.8,0)
3.8
"BLD",9736,"KRN",9.2,0)
9.2
"BLD",9736,"KRN",9.8,0)
9.8
"BLD",9736,"KRN",9.8,"NM",0)
^9.68A^3^3
"BLD",9736,"KRN",9.8,"NM",1,0)
DGPMV3^^0^B26767743
"BLD",9736,"KRN",9.8,"NM",2,0)
DGPMVDL^^0^B17431597
"BLD",9736,"KRN",9.8,"NM",3,0)
DGRPC2^^0^B73474535
"BLD",9736,"KRN",9.8,"NM","B","DGPMV3",1)

"BLD",9736,"KRN",9.8,"NM","B","DGPMVDL",2)

"BLD",9736,"KRN",9.8,"NM","B","DGRPC2",3)

"BLD",9736,"KRN",19,0)
19
"BLD",9736,"KRN",19,"NM",0)
^9.68A^^
"BLD",9736,"KRN",19.1,0)
19.1
"BLD",9736,"KRN",19.1,"NM",0)
^9.68A^^
"BLD",9736,"KRN",101,0)
101
"BLD",9736,"KRN",101,"NM",0)
^9.68A^^
"BLD",9736,"KRN",409.61,0)
409.61
"BLD",9736,"KRN",771,0)
771
"BLD",9736,"KRN",779.2,0)
779.2
"BLD",9736,"KRN",870,0)
870
"BLD",9736,"KRN",8989.51,0)
8989.51
"BLD",9736,"KRN",8989.52,0)
8989.52
"BLD",9736,"KRN",8994,0)
8994
"BLD",9736,"KRN","B",.4,.4)

"BLD",9736,"KRN","B",.401,.401)

"BLD",9736,"KRN","B",.402,.402)

"BLD",9736,"KRN","B",.403,.403)

"BLD",9736,"KRN","B",.5,.5)

"BLD",9736,"KRN","B",.84,.84)

"BLD",9736,"KRN","B",3.6,3.6)

"BLD",9736,"KRN","B",3.8,3.8)

"BLD",9736,"KRN","B",9.2,9.2)

"BLD",9736,"KRN","B",9.8,9.8)

"BLD",9736,"KRN","B",19,19)

"BLD",9736,"KRN","B",19.1,19.1)

"BLD",9736,"KRN","B",101,101)

"BLD",9736,"KRN","B",409.61,409.61)

"BLD",9736,"KRN","B",771,771)

"BLD",9736,"KRN","B",779.2,779.2)

"BLD",9736,"KRN","B",870,870)

"BLD",9736,"KRN","B",8989.51,8989.51)

"BLD",9736,"KRN","B",8989.52,8989.52)

"BLD",9736,"KRN","B",8994,8994)

"BLD",9736,"QDEF")
^^^^^^^^^^YES
"BLD",9736,"QUES",0)
^9.62^^
"BLD",9736,"REQB",0)
^9.611^3^3
"BLD",9736,"REQB",1,0)
DG*5.3*517^2
"BLD",9736,"REQB",2,0)
DG*5.3*715^2
"BLD",9736,"REQB",3,0)
DG*5.3*858^2
"BLD",9736,"REQB","B","DG*5.3*517",1)

"BLD",9736,"REQB","B","DG*5.3*715",2)

"BLD",9736,"REQB","B","DG*5.3*858",3)

"MBREQ")
0
"PKG",5,-1)
1^1
"PKG",5,0)
REGISTRATION^DG^PATIENT REGISTRATION, ADMISSION, DISCHARGE, EMBOSSER 
"PKG",5,20,0)
^9.402P^^
"PKG",5,22,0)
^9.49I^1^1
"PKG",5,22,1,0)
5.3^2930813
"PKG",5,22,1,"PAH",1,0)
895^3141023
"PKG",5,22,1,"PAH",1,1,0)
^^5^5^3141023
"PKG",5,22,1,"PAH",1,1,1,0)
Patch DG*5.3*895 addresses 2 issues:
"PKG",5,22,1,"PAH",1,1,2,0)
      
"PKG",5,22,1,"PAH",1,1,3,0)
 1.)  Deletion of admission can cause orphaned nodes
"PKG",5,22,1,"PAH",1,1,4,0)
 2.)  Inconsistency 55 issue with service connected veterans who agree to 
"PKG",5,22,1,"PAH",1,1,5,0)
      copay, but decline to provide income data
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
3
"RTN","DGPMV3")
0^1^B26767743^B23327624
"RTN","DGPMV3",1,0)
DGPMV3 ;ALB/MIR - ENTER TRANSACTION INFORMATION; 8 MAY 89 ; 3/18/13 11:24am
"RTN","DGPMV3",2,0)
 ;;5.3;Registration;**34,54,62,95,692,715,895**;Aug 13, 1993;Build 11
"RTN","DGPMV3",3,0)
 K ^UTILITY("DGPM",$J)
"RTN","DGPMV3",4,0)
 D NOW^%DTC S DGNOW=%,DGPMHY=DGPMY,DGPMOUT=0 G:'DGPMN DT S X=DGPMY
"RTN","DGPMV3",5,0)
 S DGPM0ND=DGPMY_"^"_DGPMT_"^"_DFN_"^^^^^^^^^^^"_$S("^1^4^"[("^"_DGPMT_"^"):"",1:DGPMCA)
"RTN","DGPMV3",6,0)
 ;
"RTN","DGPMV3",7,0)
 I DGPMT=1 S $P(DGPM0ND,"^",25)=$S(DGPMSA:1,1:0)
"RTN","DGPMV3",8,0)
 ;-- provider change
"RTN","DGPMV3",9,0)
 I DGPMT=6,$D(DGPMPC) S DGPM0ND=$$PRODAT(DGPM0ND)
"RTN","DGPMV3",10,0)
 D NEW G Q:Y'>0 S (DA,DGPMDA)=+Y
"RTN","DGPMV3",11,0)
 S:DGPMT=1!(DGPMT=4) DGPMCA=DA,DGPMAN=^DGPM(DA,0) D VAR G DR
"RTN","DGPMV3",12,0)
DT D VAR G:DGPM1X DR S (DGPMY,Y)=DGPMHY X ^DD("DD") W !,DGPMUC," DATE: ",Y,"// " R X:DTIME G Q:'$T!(X["^") I X="" G DR
"RTN","DGPMV3",13,0)
 S %DT="SRXE",%DT(0)="-NOW" I X["?"!(Y<0) D HELP^%DTC G DT
"RTN","DGPMV3",14,0)
 I X="@",$G(DGPMUC)="ADMISSION" D CPTCK  ; DG*5.3*895 Check for 801 screen data
"RTN","DGPMV3",15,0)
 I X="@" G OKD
"RTN","DGPMV3",16,0)
 D ^%DT I Y<0 D HELP^%DTC G DT
"RTN","DGPMV3",17,0)
 K %DT S DGPMY=Y D CHK^DGPMV30:(X]"")&(DGPMY'=+DGPMP) I $D(DGPME) S DGPMY=DGPMHY W !,DGPME K DGPME G DT
"RTN","DGPMV3",18,0)
DR ;select input template for transaction type
"RTN","DGPMV3",19,0)
 S DIE="^DGPM(" I "^1^4^6^"[("^"_DGPMT_"^"),DGPMN S DIE("NO^")=""
"RTN","DGPMV3",20,0)
 S DGODSPT=$S('$D(^DGPM(DGPMCA,"ODS")):0,^("ODS"):1,1:0)
"RTN","DGPMV3",21,0)
 S DR=$S(DGPMT=1:"[DGPM ADMIT]",DGPMT=2:"[DGPM TRANSFER]",DGPMT=3:"[DGPM DISCHARGE]",DGPMT=4:"[DGPM CHECK-IN LODGER]",DGPMT=5:"[DGPM LODGER CHECK-OUT]",DGPMT=6:"[DGPM SPECIALTY TRANSFER]",1:"") G Q:DR="" K DQ,DG D ^DIE K DIE
"RTN","DGPMV3",22,0)
 I $D(Y)#2 S DGPMOUT=1
"RTN","DGPMV3",23,0)
 ;Modified in patch dg*5.3*692 to include privacy indicator node "DIR"
"RTN","DGPMV3",24,0)
 K DGZ S (^UTILITY("DGPM",$J,DGPMT,DGPMDA,"A"),DGPMA)=$S($D(^DGPM(DGPMDA,0)):^(0)_$S($G(^("DIR"))'="":U_^("DIR"),1:""),1:"")
"RTN","DGPMV3",25,0)
 D:DGPMT'=4 @("^DGPMV3"_DGPMT)
"RTN","DGPMV3",26,0)
 I DGPMT=4,$S('$D(^DGPM(DGPMDA,"LD")):1,'$P(^("LD"),"^",1):1,1:0) S DIK="^DGPM(",DA=DGPMDA W !,"Incomplete check-in...deleted" D ^DIK K DIK S DGPMA=""
"RTN","DGPMV3",27,0)
 S (^UTILITY("DGPM",$J,DGPMT,DGPMDA,"A"),DGPMA)=$G(^DGPM(DGPMDA,0))_$S($G(^("DIR"))'="":U_^("DIR"),1:"") I DGPMT=6 S Y=DGPMDA D AFTER^DGPMV36
"RTN","DGPMV3",28,0)
EVENTS ;
"RTN","DGPMV3",29,0)
 I DGPMT=4!(DGPMT=5) D RESET^DGPMDDLD
"RTN","DGPMV3",30,0)
 I DGPMT'=4&(DGPMT'=5) D RESET^DGPMDDCN I (DGPMT'=6) D SI^DGPMV33
"RTN","DGPMV3",31,0)
 D:DGPMA]"" START^DGPWB(DFN)
"RTN","DGPMV3",32,0)
 D EN^DGPMVBM ;notify building management if room-bed change
"RTN","DGPMV3",33,0)
 S DGOK=0 F I=0:0 S I=$O(^UTILITY("DGPM",$J,I)) Q:'I  F J=0:0 S J=$O(^UTILITY("DGPM",$J,I,J)) Q:'J  I ^(J,"A")'=^("P") S DGOK=1 Q
"RTN","DGPMV3",34,0)
 I DGOK D ^DGPMEVT ;Invoke Movement Event Driver
"RTN","DGPMV3",35,0)
Q S:$D(DGPMBYP) DGPMBYP=DGPMDA
"RTN","DGPMV3",36,0)
 K DGIDX,DGOWD,DGOTY ;variables set in DGPMGLC - G&L corrections
"RTN","DGPMV3",37,0)
 K DGODS,DGODSPT ;ods variables
"RTN","DGPMV3",38,0)
 K %DT,DA,DGER,DGNOW,DGOK,DGPM0,DGPM0ND,DGPM2,DGPMA,DGPMAB,DGPMABL,DGPMDA,DGPMER,DGPMHY,DGPMNI,DGPMOC,DGPMOS,DGPMOUT,DGPMP,DGPMPHY,DGPMPHY0,DGPMPTF,DGPMSP,DGPMTYP,DGPMTN,DGPMWD,DGT,DGSV,DGX,DGX1
"RTN","DGPMV3",39,0)
 K DIC,DIE,DIK,DR,I,I1,J,K,X,X1,X2,Y,^UTILITY("DGPM",$J) Q
"RTN","DGPMV3",40,0)
 ;
"RTN","DGPMV3",41,0)
OKD K %DT W ! S DGPMER=0,(^UTILITY("DGPM",$J,DGPMT,DGPMDA,"P"),DGPMP)=^DGPM(DGPMDA,0),Y=DGPMDA D:DGPMT=6 PRIOR^DGPMV36 D @("D"_DGPMT_"^DGPMVDL"_$S(DGPMT>2:1,1:"")) G Q:DGPMER
"RTN","DGPMV3",42,0)
 W !,"Are you sure you want to delete this movement" S %=2 D YN^DICN G Q:%<0,DT:%=2 I '% W !?5,"Answer yes to delete this ",DGPMUC," or no to continue" G OKD
"RTN","DGPMV3",43,0)
 D @(DGPMT_"^DGPMVDL"_$S(DGPMT>2:1,1:""))
"RTN","DGPMV3",44,0)
 I DGPMT'=3,(DGPMT'=5) S DIK="^DGPM(",DA=DGPMDA D ^DIK:DGPMDA
"RTN","DGPMV3",45,0)
 S (^UTILITY("DGPM",$J,DGPMT,DGPMDA,"A"),DGPMA)=$S($P(DGPMP,"^",18)'=47:"",1:^DGPM(+DGPMDA,0)) I DGPMT=6 S Y=DGPMDA D AFTER^DGPMV36
"RTN","DGPMV3",46,0)
 I DGPMDA,$O(^DGPM("APHY",DGPMDA,0)) S DIK="^DGPM(",DA=+$O(^(0)) I $D(^DGPM(+DA,0)) S ^UTILITY("DGPM",$J,6,DA,"P")=^(0),^("A")="",Y=DA D PRIOR^DGPMV36,^DIK S Y=DA D AFTER^DGPMV36
"RTN","DGPMV3",47,0)
 G EVENTS
"RTN","DGPMV3",48,0)
VAR ;Set up variables
"RTN","DGPMV3",49,0)
 ;Modified in patch dg*5.3*692 to include privacy indicator node "DIR"
"RTN","DGPMV3",50,0)
 S DA=DGPMDA,(^UTILITY("DGPM",$J,DGPMT,DGPMDA,"P"),DGPMP)=$S(DGPMN=1:"",1:$G(^DGPM(DA,0))_$S($G(^("DIR"))'="":U_^("DIR"),1:""),1:"") ;DGPMP=Before edit
"RTN","DGPMV3",51,0)
 I DGPMT=6 S Y=DGPMDA D PRIOR^DGPMV36
"RTN","DGPMV3",52,0)
 S DGX=DGPMY+($P(DGPMP,"^",22)/10000000)
"RTN","DGPMV3",53,0)
 S X=$O(^DGPM("APMV",DFN,DGPMCA,(9999999.9999999-DGX))),X1=$O(^DGPM("APMV",DFN,DGPMCA,+X,0)) S DGPM0=$S($D(^DGPM(+X1,0)):^(0),1:"") ;DGPM0=prior movement
"RTN","DGPMV3",54,0)
 S X=$O(^DGPM("APCA",DFN,DGPMCA,+DGX)),X=$O(^(+X,0)),DGPM2=$S($D(^DGPM(+X,0)):^(0),1:"") ;DGPM2=next movement
"RTN","DGPMV3",55,0)
 S DGPMABL=0 I DGPM2,$D(^DG(405.2,+$P(DGPM2,"^",18),"E")) S DGPMABL=+^("E") ;is the next movement an absence?
"RTN","DGPMV3",56,0)
 I DGPMT=6 S Y=DGPMDA D PRIOR^DGPMV36
"RTN","DGPMV3",57,0)
 Q
"RTN","DGPMV3",58,0)
NEW ;Entry point to add a new entry to ^DGPM
"RTN","DGPMV3",59,0)
 D NEW^DGPMV301 ; continuation of routine DGPMV3 in DGPMV301
"RTN","DGPMV3",60,0)
 Q
"RTN","DGPMV3",61,0)
 ;
"RTN","DGPMV3",62,0)
PRODAT(NODE) ;-- This function will add the ward and other data from the
"RTN","DGPMV3",63,0)
 ; previous TS movement to the provider TS movement.
"RTN","DGPMV3",64,0)
 ;
"RTN","DGPMV3",65,0)
 N X,Y
"RTN","DGPMV3",66,0)
 S Y=NODE,X=$O(^DGPM("ATS",DFN,DGPMCA,9999999.9999999-$P(NODE,U))) I X S X=$O(^(X,0)) I X S X=$O(^(X,0)) I X S X=^DGPM(X,0)
"RTN","DGPMV3",67,0)
 S $P(Y,U,4)=$P(X,U,4),$P(Y,U,9)=$P(X,U,9)
"RTN","DGPMV3",68,0)
 Q Y
"RTN","DGPMV3",69,0)
 ;
"RTN","DGPMV3",70,0)
CPTCK ; DG*5.3*895 Admission Deletion - Check to see if there is 801 screen data on file (DGPMFLG = okay to delete)
"RTN","DGPMV3",71,0)
 N DGPMDA,DGPMI,DGPMFLG
"RTN","DGPMV3",72,0)
 S DGPMDA=$P($G(DGPMAN),U,16),DGPMI=0,DGPMFLG=1
"RTN","DGPMV3",73,0)
 Q:DGPMDA=""
"RTN","DGPMV3",74,0)
 F  S I=$O(^DGCPT(46,"C",DGPMDA,DGPMI)) Q:'DGPMI  I '$G(^DGCPT(46,DGPMI,9)) S DGPMFLG=0
"RTN","DGPMV3",75,0)
 I DGPMFLG S DGPMI=0 F  S DGPMI=$O(^DGICD9(46.1,"C",DGPMDA,DGPMI)) Q:'DGPMI  I '$G(^DGICD9(46.1,DGPMI,9)) S DGPMFLG=0
"RTN","DGPMV3",76,0)
 I 'DGPMFLG W !!,"CANNOT DELETE THE ADMISSION. THE PTF HAS ACTIVE ORDERS OR CPT ENTRIES." S X="^" H 2 W !
"RTN","DGPMV3",77,0)
 Q
"RTN","DGPMV3",78,0)
 ;
"RTN","DGPMVDL")
0^2^B17431597^B16911207
"RTN","DGPMVDL",1,0)
DGPMVDL ;ALB/MIR - DELETE PATIENT MOVEMENTS ; 2/13/04 1:01pm
"RTN","DGPMVDL",2,0)
 ;;5.3;Registration;**161,517,895**;Aug 13, 1993;Build 11
"RTN","DGPMVDL",3,0)
 ;
"RTN","DGPMVDL",4,0)
 ;D_DGPMT - these lines are used as DEL nodes.  If DGPMER=1, movement can
"RTN","DGPMVDL",5,0)
 ;          not be deleted.
"RTN","DGPMVDL",6,0)
 ;DGPMT   - once the movement is to be deleted, these are the other
"RTN","DGPMVDL",7,0)
 ;          updates that must also occur.
"RTN","DGPMVDL",8,0)
 ;
"RTN","DGPMVDL",9,0)
D1 S DGPMER=0 F I=0:0 S I=$O(^DGPM("APMV",DFN,DGPMCA,I)) Q:I'>0  S J=$O(^(I,0)) I $D(^DGPM(J,0)),($P(^(0),"^",15)]"") S DGPMER=1 Q
"RTN","DGPMVDL",10,0)
 I DGPMER W !,"Cannot delete before ASIH transfers are removed" Q
"RTN","DGPMVDL",11,0)
 I $P(DGPMAN,"^",21),$P(DGPMAN,"^",17) S DGPMER=1 W !,"Must delete discharge first"
"RTN","DGPMVDL",12,0)
 I $O(^DGPT("ACENSUS",+$P(DGPMAN,U,16),0)) S DGPMER=1 W !,"Cannot delete while PTF Census record #",$O(^(0))," is closed."
"RTN","DGPMVDL",13,0)
 Q
"RTN","DGPMVDL",14,0)
1 ;S DA=$P(DGPMAN,U,16),DIK="^DGPT(",FLAG=1,I=0 F  S I=$O(^DGCPT(46,"C",DA,I)) Q:'I  I '$G(^DGCPT(I,9)) S FLAG=0 Q
"RTN","DGPMVDL",15,0)
 ;I FLAG S I=0 F  S I=$O(^DGICD9(46.1,"C",DA,I)) Q:'I  I '$G(^DGICD9(I,9)) S FLAG=0 Q
"RTN","DGPMVDL",16,0)
 ;DG*5.3*895 corrects issue with deleting admissions
"RTN","DGPMVDL",17,0)
 S DA=$P(DGPMAN,U,16),DIK="^DGPT(",FLAG=1,I=0 F  S I=$O(^DGCPT(46,"C",DA,I)) Q:'I  I '$G(^DGCPT(46,I,9)) S FLAG=0 Q
"RTN","DGPMVDL",18,0)
 I FLAG S I=0 F  S I=$O(^DGICD9(46.1,"C",DA,I)) Q:'I  I '$G(^DGICD9(46.1,I,9)) S FLAG=0 Q
"RTN","DGPMVDL",19,0)
 I 'FLAG W !,"CANNOT DELETE THE PTF RECORD WHEN THERE ARE ACTIVE ORDERS OR CPT ENTRIES." K FLAG H 2 Q
"RTN","DGPMVDL",20,0)
 S DGMSG="Patient admission has been deleted for admit date: "_$$FMTE^XLFDT(+DGPMAN,"5DZ"),DGMSG1="Deleted Admission"
"RTN","DGPMVDL",21,0)
 D MSG^DGPTMSG1 S DA=$P(DGPMAN,U,16),DIK="^DGPT(" D ^DIK:DA>0 K FLAG,I,DA,DIK ; delete PTF record
"RTN","DGPMVDL",22,0)
 S DA=$O(^DGS(41.1,"AMVT",DGPMDA,0)) I DA S DIE="^DGS(41.1,",DR="17///@" D ^DIE ;remove scheduled admission reference in 41.1
"RTN","DGPMVDL",23,0)
 F DGI=DGPMDA:0 S DGI=$O(^DGPM("CA",DGPMDA,DGI)) Q:'DGI  I $D(^DGPM(DGI,0)) S DGPMTYP=$P(^(0),"^",2),DA=DGI,DIK="^DGPM(",^UTILITY("DGPM",$J,DGPMTYP,DA,"P")=^(0),^("A")="" D ^DIK
"RTN","DGPMVDL",24,0)
 S DGX=$P(DGPMAN,"^",21) G Q1:'DGX S DIK="^DGPM(",DA=DGX I $D(^DGPM(+DA,0)) S DGX1=^(0),^UTILITY("DGPM",$J,2,DA,"P")=^(0),^("A")="" D ^DIK W !,"ASIH transfer deleted",!
"RTN","DGPMVDL",25,0)
 G Q1:($P(DGX1,"^",18)'=13) S DGPMADM=$P(DGX1,"^",14) D DD^DGPMVDL1
"RTN","DGPMVDL",26,0)
Q1 K ORQUIT Q
"RTN","DGPMVDL",27,0)
Q Q
"RTN","DGPMVDL",28,0)
D2 ;Can this transfer be deleted?
"RTN","DGPMVDL",29,0)
 I $P(DGPMP,"^",18)=43,($P(DGPM2,"^",18)=42) S DGPMER=0 Q
"RTN","DGPMVDL",30,0)
 I DGPM2,'$D(^DG(405.1,+$P(DGPM2,"^",4),"F",+$P(DGPM0,"^",4),0)) S DGPMER=1 W !,"Cannot delete transfer - would create an invalid transfer pair" Q
"RTN","DGPMVDL",31,0)
 I "^13^44^"[("^"_$P(DGPMP,"^",18)_"^") S DGPMER=1 W !,"Must delete through corresponding hospital admission" Q
"RTN","DGPMVDL",32,0)
 I $P(DGPMP,"^",18)=14,$P(DGPMAN,"^",17) S DGPMER=1 W !,"Cannot delete while discharge exists" Q
"RTN","DGPMVDL",33,0)
 I $D(^DGPM(+$P(DGPMP,"^",15),0)),$D(^DGP(45.84,+$P(^(0),"^",16))) S DGPMER=1 W !,"Cannot delete when corresponding admission PTF closed out" Q
"RTN","DGPMVDL",34,0)
 I "^14^43^45^"[("^"_$P(DGPMP,"^",18)_"^"),("^13^14^43^44^45^"[("^"_$P(DGPM2,"^",18)_"^")) S DGX=$S($D(^DG(405.1,+$P(DGPM2,"^",4),0)):$P(^(0),"^",1),1:"") W !,DGX," movement must be removed first" S DGPMER=1 Q
"RTN","DGPMVDL",35,0)
 Q
"RTN","DGPMVDL",36,0)
2 I DGPMABL,DGPM0 S DGPMND=DGPM0 D AB^DGPMV32
"RTN","DGPMVDL",37,0)
 S DGPMTYP=$P(DGPMP,"^",18) I DGPMTYP=43 S DGPMADM=DGPMCA D DD^DGPMVDL1 Q
"RTN","DGPMVDL",38,0)
 I DGPMTYP=45 Q:'$P(DGPMP,"^",22)  S DGX=$O(^DGPM("APTT3",DFN,DGPMP+.0000001,0)) I $D(^DGPM(+DGX,0)) S DGPMADM=$P(^(0),"^",14) D DD^DGPMVDL1 Q
"RTN","DGPMVDL",39,0)
 Q:DGPMTYP'=14  S DGX=0 F I=(9999999.9999999-DGPMP):0 S I=$O(^DGPM("ATID2",DFN,I)) Q:'I  S DGJ=$O(^(I,0)) I $D(^DGPM(+DGJ,0)),("^13^43^44^"[("^"_$P(^(0),"^",18)_"^")) S DGX=1 Q
"RTN","DGPMVDL",40,0)
 Q:'DGX  I "^13^44^"[("^"_$P(^DGPM(DGJ,0),"^",18)_"^") S DGPMADM=$P(^(0),"^",15) I $P(DGPMP,"^",22) D DD^DGPMVDL1
"RTN","DGPMVDL",41,0)
 Q:$P(^DGPM(DGJ,0),"^",18)=44  S DGPMAB=+^DGPM(DGJ,0) D ASIHOF^DGPMV321 ;recreate 30 days
"RTN","DGPMVDL",42,0)
 Q
"RTN","DGRPC2")
0^3^B73474535^B71389194
"RTN","DGRPC2",1,0)
DGRPC2 ;ALB/MRL/SCK/PJR/BAJ/LBD/BDB - CHECK CONSISTENCY OF PATIENT DATA (CONT) ; 10/14/10 9:56am
"RTN","DGRPC2",2,0)
 ;;5.3;Registration;**45,69,108,121,205,218,342,387,470,467,489,505,507,528,451,564,570,657,688,780,797,858,895**;Aug 13, 1993;Build 11
"RTN","DGRPC2",3,0)
 ;
"RTN","DGRPC2",4,0)
43 ;off
"RTN","DGRPC2",5,0)
44 ;off
"RTN","DGRPC2",6,0)
45 ;off
"RTN","DGRPC2",7,0)
46 ;off
"RTN","DGRPC2",8,0)
47 ;off
"RTN","DGRPC2",9,0)
 S DGLST=$S(DGCHK[",47,":47,DGCHK[",46,":46,DGCHK[",45,":45,DGCHK[",44,":44,1:DGLST)
"RTN","DGRPC2",10,0)
 D NEXT G @DGLST
"RTN","DGRPC2",11,0)
48 I DGVT S DGD=DGP(.362) I DGCHK[(",48,"),($P(DGD,"^",17)="Y"),($P(DGD,"^",6)="") S X=48 D COMB
"RTN","DGRPC2",12,0)
 D NEXT G @DGLST
"RTN","DGRPC2",13,0)
49 ;
"RTN","DGRPC2",14,0)
50 ; insurance checks
"RTN","DGRPC2",15,0)
 I DGCHK[",49,"!(DGCHK[",50,") D  S DGLST=$S(DGCHK["50":50,1:49)
"RTN","DGRPC2",16,0)
 . N COV,INS,X
"RTN","DGRPC2",17,0)
 . S X=0,COV=$S($P(DGP(.31),"^",11)="Y":1,1:0)
"RTN","DGRPC2",18,0)
 . S INS=$$INSUR^IBBAPI(DFN,DT,"R")
"RTN","DGRPC2",19,0)
 . I COV,'INS S X=49 ; yes, but none
"RTN","DGRPC2",20,0)
 . I 'COV,INS S X=50 ; not yes, but some
"RTN","DGRPC2",21,0)
 . I DGCHK[(","_X_",") D COMB
"RTN","DGRPC2",22,0)
 D NEXT G @DGLST
"RTN","DGRPC2",23,0)
51 D NEXT G @DGLST ; 51 disabled
"RTN","DGRPC2",24,0)
 S X=$S($D(^DIC(21,+$P(DGP(.32),"^",3),0)):$P(^(0),"^",3),1:"")
"RTN","DGRPC2",25,0)
 I X="Z"&($P(DGP(.32),"^",5)'=7)&($P(DGP(.32),"^",10)'=7)&($P(DGP(.32),"^",15)'=7)!($P(DGP(.32),"^",5)=7&(X'="Z")) S X=51 D COMB
"RTN","DGRPC2",26,0)
 ;
"RTN","DGRPC2",27,0)
52 I $P(DGP(.31),"^",11)']"" S X=52 D COMB ;automatically on
"RTN","DGRPC2",28,0)
 D NEXT G @DGLST
"RTN","DGRPC2",29,0)
53 I $P(DGP(.311),"^",15)']"" S X=53 D COMB ;automatically on
"RTN","DGRPC2",30,0)
 D NEXT G @DGLST
"RTN","DGRPC2",31,0)
54 ;
"RTN","DGRPC2",32,0)
55 ;BELOW IS USED BY BOTH 54 & 55
"RTN","DGRPC2",33,0)
 N DGMT
"RTN","DGRPC2",34,0)
 S DGLST=$S(DGCHK["55":55,1:54)
"RTN","DGRPC2",35,0)
 I $G(^DPT(DFN,.35)),(^(.35)<+($E(DT,1,3)_"0000")) D NEXT G @DGLST ; patient died before current year
"RTN","DGRPC2",36,0)
 N DGE S DGE=+$O(^DIC(8.1,"B","SERVICE CONNECTED 50% to 100%",0))
"RTN","DGRPC2",37,0)
 I $P($G(^DPT(DFN,.3)),U,2)'<50!($P($G(^DIC(8,+$G(^DPT(DFN,.36)),0)),U,9)=DGE) D NEXT G @DGLST ;50-100% SC
"RTN","DGRPC2",38,0)
 S DGPTYP=$G(^DG(391,+DGP("TYPE"),"S")),DGISYR=$E(DT,1,3)-1_"0000" I '$P(DGPTYP,"^",8)&('$P(DGPTYP,"^",9)) K DGPTYP,DGISYR D NEXT G @DGLST ; screens 8 and 9 off
"RTN","DGRPC2",39,0)
 ; If current/not outdated means test exits, pass to income retrieval
"RTN","DGRPC2",40,0)
 ; Patch 780
"RTN","DGRPC2",41,0)
 S DGMT=$$LST^DGMTU(DFN)
"RTN","DGRPC2",42,0)
 ;DG*5.3*858 MT less than 1 year old as of "VFA Start Date" and point forward do not expire
"RTN","DGRPC2",43,0)
 I DGMT,$$OLDMTPF^DGMTU4($P(DGMT,U,2)) S DGMT=""
"RTN","DGRPC2",44,0)
 D ALL^DGMTU21(DFN,"VSD",$S(DGMT:$P(DGMT,U,2),1:DT),"IP",$S(DGMT:DGMT,1:""))
"RTN","DGRPC2",45,0)
 I '$P(DGPTYP,"^",8)!(DGCHK'["54") G JUST55 ; screen 8 off OR JUST 55 IN CHK
"RTN","DGRPC2",46,0)
 S DGFL=0 I $D(DGREL("S")),($$SSN^DGMTU1(+DGREL("S"))']"") S DGFL=1
"RTN","DGRPC2",47,0)
 I 'DGFL F I=0:0 S I=$O(DGREL("D",I)) Q:'I  I $$SSN^DGMTU1(+DGREL("D",I))']"" S DGFL=1 Q
"RTN","DGRPC2",48,0)
 I DGFL S X=54 D COMB
"RTN","DGRPC2",49,0)
JUST55 I DGCHK'["55" D NEXT G @DGLST
"RTN","DGRPC2",50,0)
 S DGLST=55
"RTN","DGRPC2",51,0)
 I '$P(DGPTYP,"^",9) D NEXT G @DGLST ; screen 9 off
"RTN","DGRPC2",52,0)
 D TOT^DGRP9(.DGINC) S DGFL=0
"RTN","DGRPC2",53,0)
 F DGD="V","S","D" I $D(DGTOT(DGD)) F I=8:1:17 I $P(DGTOT(DGD),"^",I)]"" S DGFL=1 Q
"RTN","DGRPC2",54,0)
 I 'DGFL N DGAPD,DG55 D  I 'DGAPD&('DG55)  S X=55 D COMB
"RTN","DGRPC2",55,0)
 . S DGAPD=+$$LST^DGMTU(DFN),DGAPD=+$P($G(^DGMT(408.31,+DGAPD,0)),U,11)
"RTN","DGRPC2",56,0)
 . S DG55=$$CHECK55(DFN) ; **507, Additional Income Checks
"RTN","DGRPC2",57,0)
 D NEXT G @DGLST
"RTN","DGRPC2",58,0)
56 I DGVT S DGD=DGP(.3) I DGCHK[(",56,"),($P(DGD,"^",11)="Y"),($P(DGP(.362),"^",20)="") S X=56 D COMB
"RTN","DGRPC2",59,0)
 D NEXT G END^DGRPC3:$S('+DGLST:1,+DGLST=99:1,1:0) G @DGLST
"RTN","DGRPC2",60,0)
57 I $P(DGP(.38),U,1) D
"RTN","DGRPC2",61,0)
 .N X1,X2
"RTN","DGRPC2",62,0)
 .S X1=$P(DGP(.38),U,2)
"RTN","DGRPC2",63,0)
 .S X=$P($G(^DG(43,1,0)),U,46) S X2=$S(X:X,1:365) D C^%DTC
"RTN","DGRPC2",64,0)
 .I X<DT S X=57 D COMB
"RTN","DGRPC2",65,0)
 D NEXT G @DGLST
"RTN","DGRPC2",66,0)
58 ;58 - EC Claim - No Gulf/Som Svc
"RTN","DGRPC2",67,0)
 ;off
"RTN","DGRPC2",68,0)
 ;DG*5.3*688 changed the wording of Environmental Contaminants
"RTN","DGRPC2",69,0)
 ;so if this cc is ever activated the text in ^DGIN(38.6,58 
"RTN","DGRPC2",70,0)
 ;needs to be changed to Southwest Asia Conditions.
"RTN","DGRPC2",71,0)
 D NEXT G @DGLST
"RTN","DGRPC2",72,0)
59 ;59 - incomplete Catastrophic Disability info
"RTN","DGRPC2",73,0)
 I $$HASCAT^DGENCDA(DFN) D
"RTN","DGRPC2",74,0)
 .I '$P(DGP(.39),"^",2) S X=59 D COMB
"RTN","DGRPC2",75,0)
 D NEXT G @DGLST
"RTN","DGRPC2",76,0)
60 ;60 - Location of agent orange exposure unanswered
"RTN","DGRPC2",77,0)
 I DGVT,$P(DGP(.321),"^",2)="Y",$P(DGP(.321),"^",13)="" S X=60 D COMB
"RTN","DGRPC2",78,0)
 D NEXT G @DGLST
"RTN","DGRPC2",79,0)
61 ;61 - Incomplete Phone Number
"RTN","DGRPC2",80,0)
 ; DG*5.3*657 BAJ Phone number check modified
"RTN","DGRPC2",81,0)
 ; Home phone check is disabled
"RTN","DGRPC2",82,0)
 ; Work phone is required only if pt is employed
"RTN","DGRPC2",83,0)
 N EMPST
"RTN","DGRPC2",84,0)
 S EMPST=","_$P($G(^DPT(DFN,.311)),U,15)_","
"RTN","DGRPC2",85,0)
 I ",1,2,4,"[EMPST,($P(DGP(.13),"^",2)="") S X=61 D COMB
"RTN","DGRPC2",86,0)
 D NEXT G @DGLST
"RTN","DGRPC2",87,0)
62 ;62 - Missing Emergency Contact Name
"RTN","DGRPC2",88,0)
 I $P(DGP(.33),"^")="" S X=62 D COMB
"RTN","DGRPC2",89,0)
 D NEXT G @DGLST
"RTN","DGRPC2",90,0)
63 ;Confidential Address check
"RTN","DGRPC2",91,0)
 N STR63,J,DGI,DGERR
"RTN","DGRPC2",92,0)
 S DGERR=0
"RTN","DGRPC2",93,0)
 I $P(DGP(.141),U,9)="Y",$P($$CAACT^DGRPCADD(DFN),U) D
"RTN","DGRPC2",94,0)
 . ; country is either NULL or non-numeric
"RTN","DGRPC2",95,0)
 . I '$P(DGP(.141),U,16) S DGERR=1 Q
"RTN","DGRPC2",96,0)
 . ; country is not in Country file
"RTN","DGRPC2",97,0)
 . I '$D(^HL(779.004,$P(DGP(.141),"^",16))) S DGERR=1 Q
"RTN","DGRPC2",98,0)
 . S STR63="1,4,5,6" I $$FORIEN^DGADDUTL($P(DGP(.141),"^",16)) S STR63="1,4"
"RTN","DGRPC2",99,0)
 . F J=1:1:$L(STR63,",") S DGI=$P(STR63,",",J) Q:DGERR  I $P(DGP(.141),U,DGI)="" S DGERR=1
"RTN","DGRPC2",100,0)
 I DGERR S X=63 D COMB
"RTN","DGRPC2",101,0)
 D NEXT G @DGLST
"RTN","DGRPC2",102,0)
64 ;64 - Place of Birth City/State Missing ;**505
"RTN","DGRPC2",103,0)
 I $P(DGP(0),"^",11)=""!($P(DGP(0),"^",12)="") S X=64 D COMB
"RTN","DGRPC2",104,0)
 D NEXT G @DGLST
"RTN","DGRPC2",105,0)
65 ;65 - Mother's Maiden Name Missing ;**505
"RTN","DGRPC2",106,0)
 I $P(DGP(.24),"^",3)="" S X=65 D COMB
"RTN","DGRPC2",107,0)
 D NEXT G @DGLST
"RTN","DGRPC2",108,0)
66 ;66 - Pseudo SSN in use ;**505
"RTN","DGRPC2",109,0)
 ; DG*5.3*657 BAJ 11/20/2005 Removed from CC.  Pseudo notice appears in Patient List
"RTN","DGRPC2",110,0)
 ;I $P(DGP(0),"^",9)["P" S X=66 D COMB
"RTN","DGRPC2",111,0)
 ; off
"RTN","DGRPC2",112,0)
 D NEXT G @DGLST
"RTN","DGRPC2",113,0)
67 ;67 - Serv Sep Date [Last] missing or imprecise, patch 528
"RTN","DGRPC2",114,0)
 N DGG
"RTN","DGRPC2",115,0)
 S DGG=$$CVELIG^DGCV(DFN)
"RTN","DGRPC2",116,0)
 I $G(DGG)["A"!($G(DGG)["F") S X=67 D COMB
"RTN","DGRPC2",117,0)
 D NEXT G @DGLST
"RTN","DGRPC2",118,0)
68 ;used for 68-71, for Combat Vet, DG*5.3*528
"RTN","DGRPC2",119,0)
69 ;
"RTN","DGRPC2",120,0)
70 ;
"RTN","DGRPC2",121,0)
71 ;
"RTN","DGRPC2",122,0)
 ;68 - Combat To Date missing or imprecise, patch 528
"RTN","DGRPC2",123,0)
 ;69 - Yugoslavia To Date missing or imprecise, patch 528
"RTN","DGRPC2",124,0)
 ;70 - Somalia To Date missing or imprecise, patch 528
"RTN","DGRPC2",125,0)
 ;71 - Persian Gulf To Date missing or imprecise, patch 528
"RTN","DGRPC2",126,0)
 N DGG
"RTN","DGRPC2",127,0)
 S DGG=$$CVELIG^DGCV(DFN)
"RTN","DGRPC2",128,0)
 I DGG["B"!(DGG["G") S X=68 D COMB
"RTN","DGRPC2",129,0)
 I DGG["C"!(DGG["H") S X=69 D COMB
"RTN","DGRPC2",130,0)
 I DGG["D"!(DGG["I") S X=70 D COMB
"RTN","DGRPC2",131,0)
 I DGG["E"!(DGG["J") S X=71 D COMB
"RTN","DGRPC2",132,0)
 S DGLST=71
"RTN","DGRPC2",133,0)
 D NEXT G @DGLST
"RTN","DGRPC2",134,0)
72 ;; MSE - Required Fields
"RTN","DGRPC2",135,0)
 S:'$G(MSECHK) MSECHK=$$MSCK^DGMSCK I MSERR S X=72 D COMB
"RTN","DGRPC2",136,0)
 D NEXT G @DGLST
"RTN","DGRPC2",137,0)
73 ;; An MSE FROM date precedes an MSE TO date
"RTN","DGRPC2",138,0)
 S:'$G(MSECHK) MSECHK=$$MSCK^DGMSCK I MSDATERR D NEXT G @DGLST
"RTN","DGRPC2",139,0)
 N I1
"RTN","DGRPC2",140,0)
 ;Use MSE data in DGPMSE array, if it exists (DG*5.3*797)
"RTN","DGRPC2",141,0)
 I $D(DGPMSE) D  D NEXT G @DGLST
"RTN","DGRPC2",142,0)
 .N OUT S I1=0 F  S I1=$O(DGPMSE(I1)) Q:'I1!($G(OUT))  D
"RTN","DGRPC2",143,0)
 ..I $P(DGPMSE(I1),U,7) Q  ;Don't check MSE verified by HEC
"RTN","DGRPC2",144,0)
 ..I '$$B4^DGRPDT($P(DGPMSE(I1),U),$P(DGPMSE(I1),U,2),1) S X=73 D COMB S (MSERR,MSDATERR,OUT)=1 Q
"RTN","DGRPC2",145,0)
 ;Otherwise, use MSE data in DGP(.32)
"RTN","DGRPC2",146,0)
 F I1=6,11,16 I '$$B4^DGRPDT($P(DGP(.32),"^",I1),$P(DGP(.32),"^",I1+1),1) S X=73 D COMB S (MSERR,MSDATERR)=1 Q
"RTN","DGRPC2",147,0)
 D NEXT G @DGLST
"RTN","DGRPC2",148,0)
74 ;; Conflict Date Missing or Incomplete
"RTN","DGRPC2",149,0)
 S:'$G(CONCHK) CONCHK=$$CNCK^DGMSCK I CONERR S X=74 D COMB
"RTN","DGRPC2",150,0)
 D NEXT G @DGLST
"RTN","DGRPC2",151,0)
75 ;; Conflict TO date precedes FROM date
"RTN","DGRPC2",152,0)
76 ;; Conflict Date out of range for conflict
"RTN","DGRPC2",153,0)
 S:'$G(CONCHK) CONCHK=$$CNCK^DGMSCK
"RTN","DGRPC2",154,0)
 S LOC="",(I5,I6)=0 F I1=1:1 S LOC=$O(CONSPEC(LOC)) Q:LOC=""  I CONARR(LOC)=1 D
"RTN","DGRPC2",155,0)
 .N FROMDAT,FROMPC,TODAT,TOPC,NODE,DATA
"RTN","DGRPC2",156,0)
 .S DATA=CONSPEC(LOC)
"RTN","DGRPC2",157,0)
 .S NODE=$P(DATA,",",1),FROMPC=$P(DATA,",",3),TOPC=$P(DATA,",",4)
"RTN","DGRPC2",158,0)
 .S FROMDAT=$P(DGP(NODE),"^",FROMPC),TODAT=$P(DGP(NODE),"^",TOPC)
"RTN","DGRPC2",159,0)
 .I '$$B4^DGRPDT(FROMDAT,TODAT,1) S X=75 D COMB:'I5&(DGCHK[(",75,")) S CONARR(LOC)=2,I5=1 Q
"RTN","DGRPC2",160,0)
 .I DGCHK'[(",76,") Q
"RTN","DGRPC2",161,0)
 .S:'$G(RANSET) RANSET=$$RANGE^DGMSCK
"RTN","DGRPC2",162,0)
 .I '$$RWITHIN^DGRPDT($P(RANGE(LOC),"^",1),$P(RANGE(LOC),"^",2),FROMDAT,TODAT) S X=76 D COMB:'I6 S CONARR(LOC)=2,I6=1
"RTN","DGRPC2",163,0)
 .Q
"RTN","DGRPC2",164,0)
 S DGLST=76 D NEXT G @DGLST
"RTN","DGRPC2",165,0)
77 ;; Date out of range for POW Location
"RTN","DGRPC2",166,0)
 ;; Check turned off by EVC project (DG*5.3*688)
"RTN","DGRPC2",167,0)
 D NEXT G @DGLST
"RTN","DGRPC2",168,0)
78 ;; Date out of range for Combat Location
"RTN","DGRPC2",169,0)
 S:'$G(RANSET) RANSET=$$RANGE^DGMSCK
"RTN","DGRPC2",170,0)
 ;; Don't check if Combat Data Incomplete or if Combat TO precedes FROM
"RTN","DGRPC2",171,0)
 I ((","_DGER_",")[(",39,"))!((","_DGER_",")[(",40,")) D NEXT G @DGLST
"RTN","DGRPC2",172,0)
 I $P(DGP(.52),"^",11)'="Y" D NEXT G @DGLST ;; Don't check if no COMBAT
"RTN","DGRPC2",173,0)
 S LOC=$$COMPOW^DGRPMS($P(DGP(.52),"^",12)) I LOC="" D NEXT G @DGLST
"RTN","DGRPC2",174,0)
 I '$$RWITHIN^DGRPDT($P(RANGE(LOC),"^",1),$P(RANGE(LOC),"^",2),$P(DGP(.52),"^",13),$P(DGP(.52),"^",14)) S X=78 D COMB
"RTN","DGRPC2",175,0)
 D NEXT G @DGLST
"RTN","DGRPC2",176,0)
COMB S DGCT=DGCT+1,DGER=DGER_X_",",DGLST=X Q
"RTN","DGRPC2",177,0)
 ;
"RTN","DGRPC2",178,0)
NEXT S I=$F(DGCHK,(","_+DGLST_",")),DGLST=+$E(DGCHK,I,999) I +DGLST,+DGLST<79 Q
"RTN","DGRPC2",179,0)
 S:'DGLST DGLST="END^DGRPC3" I +DGLST S DGLST=DGLST_"^DGRPC3"
"RTN","DGRPC2",180,0)
 Q
"RTN","DGRPC2",181,0)
FIND F I=DGLST:1:99 I DGCHK[(","_I_",") Q
"RTN","DGRPC2",182,0)
 I DGNCK,(I>17),(I<36) S DGLST=36 G FIND
"RTN","DGRPC2",183,0)
 I I,I<99 S DGLST=I G @(DGLST_$S(DGLST>78:"^DGRPC3",DGLST>42:"",DGLST>17:"^DGRPC1",1:"^DGRPC"))
"RTN","DGRPC2",184,0)
 G END^DGRPC3
"RTN","DGRPC2",185,0)
 ;
"RTN","DGRPC2",186,0)
CHECK55(DFN) ;Business rules for additional 55-INCOME DATA MISSING checks
"RTN","DGRPC2",187,0)
 ;  Modeled from DGMTR checks.
"RTN","DGRPC2",188,0)
 ;  Input  DFN - IEN from PATIENT File #2
"RTN","DGRPC2",189,0)
 ;
"RTN","DGRPC2",190,0)
 ;  Output 1 - If Income check passes additional business rules
"RTN","DGRPC2",191,0)
 ;         0 - If Income check fails additional business rules
"RTN","DGRPC2",192,0)
 ;
"RTN","DGRPC2",193,0)
 N VAMB,VASV,VA,VADMVT,VAEL,VAINDT,DGRTN,DGMED,DG,DG1,DGWARD,DGSRVC,DGCOPAY
"RTN","DGRPC2",194,0)
 ;
"RTN","DGRPC2",195,0)
 S DGRTN=0
"RTN","DGRPC2",196,0)
 D MB^VADPT I +VAMB(7) S DGRTN=1 G Q55  ; Check if receiving VA Disability
"RTN","DGRPC2",197,0)
 D SVC^VADPT I +VASV(4) S DGRTN=1 G Q55  ; check if POW status indicated
"RTN","DGRPC2",198,0)
 I +VASV(9),(+VASV(9,1)=3) S DGRTN=1 G Q55  ; Check if Purple Heart Status is Confirmed
"RTN","DGRPC2",199,0)
 D GETS^DIQ(2,DFN_",",".381:.383","I","DGMED")
"RTN","DGRPC2",200,0)
 I $G(DGMED(2,DFN_",",.381,"I")) S DGRTN=1 G Q55  ; Check if eligible for Medicaid
"RTN","DGRPC2",201,0)
 D ADM^VADPT2 ; Check for current admission to DOM ward 
"RTN","DGRPC2",202,0)
 I +$G(VADMVT) D  G:DGRTN Q55
"RTN","DGRPC2",203,0)
 . Q:'$$GET1^DIQ(43,1,16,"I")  ; Has Dom wards?
"RTN","DGRPC2",204,0)
 . S DGWARD=$$GET1^DIQ(405,VADMVT,.06,"I") ; Get ward location
"RTN","DGRPC2",205,0)
 . S DGSRVC=$$GET1^DIQ(42,DGWARD,.03,"I") ; Get ward service
"RTN","DGRPC2",206,0)
 . S:DGSRVC="D" DGRTN=1 ; If ward service is 'D', then return 1
"RTN","DGRPC2",207,0)
 ;
"RTN","DGRPC2",208,0)
 ; Additional checks for 0% SC
"RTN","DGRPC2",209,0)
 D ELIG^VADPT
"RTN","DGRPC2",210,0)
 I +VAEL(3),'$P(VAEL(3),U,2) D  ; Check if service connected with % of zero
"RTN","DGRPC2",211,0)
 . I +VAMB(4) S DGRTN=1 Q  ; Check if receiving a VA pension
"RTN","DGRPC2",212,0)
 . S DG=0 ; Check for secondary eligibilities
"RTN","DGRPC2",213,0)
 . F  S DG=$O(VAEL(1,DG)) Q:'DG  D  Q:DGRTN
"RTN","DGRPC2",214,0)
 . . F DG1=2,4,15,16,17,18 I DG=DG1 S DGRTN=1 Q
"RTN","DGRPC2",215,0)
 ; DG*5.3*657 BAJ
"RTN","DGRPC2",216,0)
 ; Additional business rules
"RTN","DGRPC2",217,0)
 ; Do NOT file inconsistency for the following:
"RTN","DGRPC2",218,0)
 ; 1. Service Connected = YES, Eligibility Code is "SC LESS THAN 50%", SC % is 10-49, A&A = "YES"
"RTN","DGRPC2",219,0)
 ; 2. Service Connected = YES, Eligibility Code is "SC LESS THAN 50%", SC % is 10-49, VA Pension = "YES"
"RTN","DGRPC2",220,0)
 ; 3. Patient Type is "NSC Veteran" and A&A = "YES"
"RTN","DGRPC2",221,0)
 ; 4. Patient Type is "NSC Veteran" and VA Pension = "YES"
"RTN","DGRPC2",222,0)
 ; Arrays elements used:
"RTN","DGRPC2",223,0)
 ; .. VAEL(3) $P 1 = SERVICE CONNECTED? $P 2 = SC %
"RTN","DGRPC2",224,0)
 ; .. VAEL(6) $P 2 = PATIENT TYPE, "B" INDEX VALUE
"RTN","DGRPC2",225,0)
 ; .. VAMB(1) $P 1 = RECEIVING A&A
"RTN","DGRPC2",226,0)
 ; .. VAMB(4) $P 1 = RECEIVING VA PENSION
"RTN","DGRPC2",227,0)
 I $P(VAEL(1),"^",2)="SC LESS THAN 50%",+VAEL(3) S PCNT=$P(VAEL(3),"^",2) I PCNT'<10,PCNT'>50 S DGRTN=$S(+VAMB(1):1,VAMB(4):1,1:DGRTN)
"RTN","DGRPC2",228,0)
 ; DG*5.3*895 Check if service connected between 0% & 50% and copay exempt
"RTN","DGRPC2",229,0)
 S DGCOPAY=$O(^DGMT(408.31,"C",DFN,""))
"RTN","DGRPC2",230,0)
 I DGCOPAY I $G(PCNT)>0,$G(PCNT)'>50,$P($G(^DGMT(408.31,DGCOPAY,2)),U,3)=8 S DGRTN=1
"RTN","DGRPC2",231,0)
 I $P($G(VAEL(6)),"^",2)="NSC VETERAN" S DGRTN=$S(+VAMB(1):1,VAMB(4):1,1:DGRTN)
"RTN","DGRPC2",232,0)
 ;
"RTN","DGRPC2",233,0)
Q55 D KVAR^VADPT
"RTN","DGRPC2",234,0)
 Q $G(DGRTN)
"VER")
8.0^22.0
"BLD",9736,6)
^790
**END**
**END**

